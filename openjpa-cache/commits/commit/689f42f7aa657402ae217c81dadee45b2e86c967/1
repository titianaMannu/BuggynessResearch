{"sha":"689f42f7aa657402ae217c81dadee45b2e86c967","node_id":"MDY6Q29tbWl0MjA2MzY0OjY4OWY0MmY3YWE2NTc0MDJhZTIxN2M4MWRhZGVlNDViMmU4NmM5Njc=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-04-10T15:18:42Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-04-10T15:18:42Z"},"message":"OPENJPA-1625: making the creation of StateManagerImpl consistent by calling newStateManagerImpl consistently.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@932743 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a0368a90df28da4d9328c07df33dace537d8749b","url":"https://api.github.com/repos/apache/openjpa/git/trees/a0368a90df28da4d9328c07df33dace537d8749b"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/689f42f7aa657402ae217c81dadee45b2e86c967","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/689f42f7aa657402ae217c81dadee45b2e86c967","html_url":"https://github.com/apache/openjpa/commit/689f42f7aa657402ae217c81dadee45b2e86c967","comments_url":"https://api.github.com/repos/apache/openjpa/commits/689f42f7aa657402ae217c81dadee45b2e86c967/comments","author":null,"committer":null,"parents":[{"sha":"33e8df53bd3ea521634391064139938a0058364b","url":"https://api.github.com/repos/apache/openjpa/commits/33e8df53bd3ea521634391064139938a0058364b","html_url":"https://github.com/apache/openjpa/commit/33e8df53bd3ea521634391064139938a0058364b"}],"stats":{"total":16,"additions":8,"deletions":8},"files":[{"sha":"185a73b3f497c76e9d345efb0a90130056fb7de2","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","status":"modified","additions":8,"deletions":8,"changes":16,"blob_url":"https://github.com/apache/openjpa/blob/689f42f7aa657402ae217c81dadee45b2e86c967/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/689f42f7aa657402ae217c81dadee45b2e86c967/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java?ref=689f42f7aa657402ae217c81dadee45b2e86c967","patch":"@@ -2588,7 +2588,7 @@ else if (idType == ClassMetaData.ID_UNKNOWN)\n                 pc.pcReplaceStateManager(null);\n \n             // create new sm\n-            sm = new StateManagerImpl(id, meta, this);\n+            sm = newStateManagerImpl(id, meta);\n             if ((_flags & FLAG_ACTIVE) != 0) {\n                 if (explicit)\n                     sm.initialize(pc, PCState.PNEW);\n@@ -2622,8 +2622,8 @@ private void cascadeTransient(int op, Object obj, OpCallbacks call,\n \n         ClassMetaData meta = _conf.getMetaDataRepositoryInstance().\n             getMetaData(obj.getClass(), _loader, true);\n-        StateManagerImpl sm = new StateManagerImpl(StateManagerId.\n-            newInstance(this), meta, this);\n+        StateManagerImpl sm = newStateManagerImpl(StateManagerId.\n+            newInstance(this), meta);\n         sm.initialize(pc, PCState.TLOADED);\n         try {\n             switch (op) {\n@@ -2799,7 +2799,7 @@ public OpenJPAStateManager embed(Object obj, Object id,\n             if (id == null)\n                 id = StateManagerId.newInstance(this);\n \n-            StateManagerImpl sm = new StateManagerImpl(id, meta, this);\n+            StateManagerImpl sm = newStateManagerImpl(id, meta);\n             sm.setOwner((StateManagerImpl) owner, ownerMeta);\n \n             PersistenceCapable copy;\n@@ -2876,7 +2876,7 @@ OpenJPAStateManager copy(OpenJPAStateManager copy, PCState state) {\n                     getMetaDataRepositoryInstance();\n                 ClassMetaData meta = repos.getMetaData(type, _loader, true);\n                 // construct a new state manager with all info known\n-                sm = new StateManagerImpl(oid, meta, this);\n+                sm = newStateManagerImpl(oid, meta);\n                 sm.setObjectId(oid);\n                 sm.initialize(sm.getMetaData().getDescribedType(), state);\n             }\n@@ -3515,8 +3515,8 @@ public void transactionalAll(Collection objs, boolean updateVersion,\n                         meta = _conf.getMetaDataRepositoryInstance().\n                             getMetaData(obj.getClass(), _loader, true);\n \n-                        sm = new StateManagerImpl\n-                            (StateManagerId.newInstance(this), meta, this);\n+                        sm = newStateManagerImpl\n+                            (StateManagerId.newInstance(this), meta);\n                         sm.initialize(assertPersistenceCapable(obj),\n                             PCState.TCLEAN);\n                     } else if (sm.isPersistent()) {\n@@ -3587,7 +3587,7 @@ public void transactional(Object obj, boolean updateVersion,\n                 ClassMetaData meta = _conf.getMetaDataRepositoryInstance().\n                     getMetaData(obj.getClass(), _loader, true);\n                 Object id = StateManagerId.newInstance(this);\n-                sm = new StateManagerImpl(id, meta, this);\n+                sm = newStateManagerImpl(id, meta);\n                 sm.initialize(assertPersistenceCapable(obj),\n                     PCState.TCLEAN);\n             }"}]}

