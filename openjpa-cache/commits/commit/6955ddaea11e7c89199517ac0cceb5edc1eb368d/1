{"sha":"6955ddaea11e7c89199517ac0cceb5edc1eb368d","node_id":"MDY6Q29tbWl0MjA2MzY0OjY5NTVkZGFlYTExZTdjODkxOTk1MTdhYzBjY2ViNWVkYzFlYjM2OGQ=","commit":{"author":{"name":"Heath Thomann","email":"hthomann@apache.org","date":"2016-04-01T15:50:32Z"},"committer":{"name":"Heath Thomann","email":"hthomann@apache.org","date":"2016-04-01T15:50:32Z"},"message":"OPENJPA-2636: Updated a Map in Configurations to avoid a ClassLoader leak.  Ported 2.2.x changes to trunk.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1737411 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"9ca2d759c60e7081c081f0a5e3cb467b06d8d58b","url":"https://api.github.com/repos/apache/openjpa/git/trees/9ca2d759c60e7081c081f0a5e3cb467b06d8d58b"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/6955ddaea11e7c89199517ac0cceb5edc1eb368d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/6955ddaea11e7c89199517ac0cceb5edc1eb368d","html_url":"https://github.com/apache/openjpa/commit/6955ddaea11e7c89199517ac0cceb5edc1eb368d","comments_url":"https://api.github.com/repos/apache/openjpa/commits/6955ddaea11e7c89199517ac0cceb5edc1eb368d/comments","author":null,"committer":null,"parents":[{"sha":"459a2f084162c1879a96c7720f5638774064ec46","url":"https://api.github.com/repos/apache/openjpa/commits/459a2f084162c1879a96c7720f5638774064ec46","html_url":"https://github.com/apache/openjpa/commit/459a2f084162c1879a96c7720f5638774064ec46"}],"stats":{"total":4,"additions":3,"deletions":1},"files":[{"sha":"484624a4c6272a36dde45e84c027d919bad9ab57","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/6955ddaea11e7c89199517ac0cceb5edc1eb368d/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java","raw_url":"https://github.com/apache/openjpa/raw/6955ddaea11e7c89199517ac0cceb5edc1eb368d/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java?ref=6955ddaea11e7c89199517ac0cceb5edc1eb368d","patch":"@@ -196,7 +196,9 @@ public static Object newInstance(String clsName, Configuration conf,\n         Object key = loader == null ? NULL_LOADER : loader;\n         Map<String,Class<?>> loaderCache = (Map<String,Class<?>>) _loaders.get(key);\n         if (loaderCache == null) { // We don't have a cache for this loader.\n-            loaderCache = new ConcurrentHashMap<String,Class<?>>();\n+            //OPENJPA-2636: Changed to HARD/WEAK to avoid Classloader leak:\n+            loaderCache = new ConcurrentReferenceHashMap(ConcurrentReferenceHashMap.HARD,\n+                    ConcurrentReferenceHashMap.WEAK);            \n             _loaders.put(key, loaderCache);\n         } else {  // We have a cache for this loader.\n             cls = (Class<?>) loaderCache.get(clsName);"}]}

