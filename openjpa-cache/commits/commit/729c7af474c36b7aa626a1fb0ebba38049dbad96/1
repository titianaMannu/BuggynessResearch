{"sha":"729c7af474c36b7aa626a1fb0ebba38049dbad96","node_id":"MDY6Q29tbWl0MjA2MzY0OjcyOWM3YWY0NzRjMzZiN2FhNjI2YTFmYjBlYmJhMzgwNDlkYmFkOTY=","commit":{"author":{"name":"David J. Wisneski","email":"wisneskid@apache.org","date":"2007-04-04T18:45:40Z"},"committer":{"name":"David J. Wisneski","email":"wisneskid@apache.org","date":"2007-04-04T18:45:40Z"},"message":"changes for OPENJPA-184.Appending DB2Diagnosable information to the exception.No logging done.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@525572 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"71e287da98fc69c05456f3210608d54b7f0395ec","url":"https://api.github.com/repos/apache/openjpa/git/trees/71e287da98fc69c05456f3210608d54b7f0395ec"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/729c7af474c36b7aa626a1fb0ebba38049dbad96","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/729c7af474c36b7aa626a1fb0ebba38049dbad96","html_url":"https://github.com/apache/openjpa/commit/729c7af474c36b7aa626a1fb0ebba38049dbad96","comments_url":"https://api.github.com/repos/apache/openjpa/commits/729c7af474c36b7aa626a1fb0ebba38049dbad96/comments","author":null,"committer":null,"parents":[{"sha":"6fe50aa4337eb318ebbcb13ba84909c1df22dc9b","url":"https://api.github.com/repos/apache/openjpa/commits/6fe50aa4337eb318ebbcb13ba84909c1df22dc9b","html_url":"https://github.com/apache/openjpa/commit/6fe50aa4337eb318ebbcb13ba84909c1df22dc9b"}],"stats":{"total":47,"additions":45,"deletions":2},"files":[{"sha":"7f77d77af7f0395a45eb6e44084dc4fbb7865ad2","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":36,"deletions":1,"changes":37,"blob_url":"https://github.com/apache/openjpa/blob/729c7af474c36b7aa626a1fb0ebba38049dbad96/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/729c7af474c36b7aa626a1fb0ebba38049dbad96/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=729c7af474c36b7aa626a1fb0ebba38049dbad96","patch":"@@ -442,4 +442,39 @@ public SQLBuffer toSelect(Select sel, boolean forUpdate,\n             append(\" \").append(rowClause);\r\n         return buf;\r\n     }\r\n-}\r\n+\r\n+    /** Append exception information from SQLCA to the exsisting \r\n+     *  exception meassage\r\n+     */\r\n+    public String appendExtendedExceptionMsg(String msg, SQLException sqle){\r\n+       final String GETSQLCA =\"getSqlca\";\r\n+       String exceptionMsg = new String();\r\n+       try {\r\n+            Method sqlcaM2 = sqle.getNextException().getClass()\r\n+                             .getMethod(GETSQLCA,null);\r\n+            Object sqlca = sqlcaM2.invoke(sqle.getNextException(),\r\n+                                          new Object[] {});\r\n+            Method  getSqlErrpMethd = sqlca.getClass().\r\n+            getMethod(\"getSqlErrp\", null);\r\n+            Method  getSqlWarnMethd = sqlca.getClass().\r\n+            getMethod(\"getSqlWarn\", null);\r\n+            Method  getSqlErrdMethd = sqlca.getClass().\r\n+            getMethod(\"getSqlErrd\", null);\r\n+            exceptionMsg = exceptionMsg.concat( \"SQLCA OUTPUT\" + \r\n+                    \"[Errp=\" +getSqlErrpMethd.invoke(sqlca,new Object[]{})\r\n+                    + \", Errd=\" + Arrays.toString((int[])\r\n+                            (getSqlErrdMethd.invoke(sqlca, new Object[]{}))));\r\n+            String Warn = new String((char[])getSqlWarnMethd.\r\n+                    invoke(sqlca, new Object[]{}));\r\n+            if(Warn.trim().length() != 0)\r\n+                exceptionMsg = exceptionMsg.concat(\", Warn=\" +Warn + \"]\" ); \r\n+            else\r\n+                exceptionMsg = exceptionMsg.concat( \"]\" ); \r\n+            msg = msg.concat(exceptionMsg);\r\n+            return msg;\r\n+        } catch (Throwable t) {\r\n+            return sqle.getMessage();\r\n+        }\r\n+    }\r\n+\r\n+   }\n\\ No newline at end of file"},{"sha":"f05c8f59c7629f8917f17c92cb603717ff9ccf99","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/729c7af474c36b7aa626a1fb0ebba38049dbad96/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/729c7af474c36b7aa626a1fb0ebba38049dbad96/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=729c7af474c36b7aa626a1fb0ebba38049dbad96","patch":"@@ -2470,7 +2470,14 @@ public void appendCast(SQLBuffer buf, FilterValue val, int type) {\n         buf.append(getTypeName(type));\n         buf.append(post);\n     }\n-\n+    \n+    /** Append any database specific exception message to \n+     *  the exsisting exception message\n+     */\n+     public String appendExtendedExceptionMsg(String msg, SQLException sqle) {\n+         return msg; \n+     }\n+    \n     ///////////\n     // DDL SQL\n     ///////////"},{"sha":"c9cc8b145a78e70022076acf3d9e0dbe451c0bfe","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLExceptions.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/729c7af474c36b7aa626a1fb0ebba38049dbad96/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLExceptions.java","raw_url":"https://github.com/apache/openjpa/raw/729c7af474c36b7aa626a1fb0ebba38049dbad96/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLExceptions.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLExceptions.java?ref=729c7af474c36b7aa626a1fb0ebba38049dbad96","patch":"@@ -87,6 +87,7 @@ public static OpenJPAException getStore(String msg, SQLException se,\n         Object failed, DBDictionary dict) {\n         if (msg == null)\n             msg = se.getClass().getName();\n+        msg = dict.appendExtendedExceptionMsg(msg,se);\n         SQLException[] ses = getSQLExceptions(se);\n         if (dict == null)\n             return new StoreException(msg).setFailedObject(failed)."}]}

