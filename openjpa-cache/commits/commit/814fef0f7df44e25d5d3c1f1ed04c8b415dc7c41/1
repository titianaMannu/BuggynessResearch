{"sha":"814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","node_id":"MDY6Q29tbWl0MjA2MzY0OjgxNGZlZjBmN2RmNDRlMjVkNWQzYzFmMWVkMDRjOGI0MTVkYzdjNDE=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-02-04T19:38:27Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-02-04T19:38:27Z"},"message":"OPENJPA-1493: performance fix in getTableIndex\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@906614 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f8463c6d88674f93b372c2e9a8110b79fe23760e","url":"https://api.github.com/repos/apache/openjpa/git/trees/f8463c6d88674f93b372c2e9a8110b79fe23760e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","html_url":"https://github.com/apache/openjpa/commit/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","comments_url":"https://api.github.com/repos/apache/openjpa/commits/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/comments","author":null,"committer":null,"parents":[{"sha":"ec0eeedf35d6250433d1a185ade1a894c44387ad","url":"https://api.github.com/repos/apache/openjpa/commits/ec0eeedf35d6250433d1a185ade1a894c44387ad","html_url":"https://github.com/apache/openjpa/commit/ec0eeedf35d6250433d1a185ade1a894c44387ad"}],"stats":{"total":39,"additions":36,"deletions":3},"files":[{"sha":"d7c2800a33fa855afe6df4463c9cf0784f461f30","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/SelectConstructor.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/SelectConstructor.java","raw_url":"https://github.com/apache/openjpa/raw/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/SelectConstructor.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/SelectConstructor.java?ref=814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","patch":"@@ -166,7 +166,9 @@ private Select newSelect(ExpContext ctx, Select parent,\n                 subsel.setParent(sel, subquery.getCandidateAlias());\n             }\n         }\n-     \n+        if (HasContainsExpressionVisitor.hasContains(exps.filter)) {\n+            sel.setHasSubselect(true);\n+        }\n         initialize(sel, ctx, exps, state);\n \n         if (!sel.getAutoDistinct()) {"},{"sha":"a0ebd75c1770972803b250a42ab1a8a3e3401399","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/LogicalUnion.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/apache/openjpa/blob/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/LogicalUnion.java","raw_url":"https://github.com/apache/openjpa/raw/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/LogicalUnion.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/LogicalUnion.java?ref=814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","patch":"@@ -443,6 +443,14 @@ public void setParent(Select parent, String path) {\n             throw new UnsupportedException(_loc.get(\"union-element\"));\n         }\n \n+        public void setHasSubselect(boolean hasSub) {\n+            sel.setHasSubselect(hasSub);\n+        }\n+        \n+        public boolean getHasSubselect() {\n+            return sel.getHasSubselect();    \n+        }\n+        \n         public Select getFromSelect() {\n             return null;\n         }"},{"sha":"effe2f0a7b8e331ee4e3dd0e93140a25deb661c6","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/Select.java","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/apache/openjpa/blob/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/Select.java","raw_url":"https://github.com/apache/openjpa/raw/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/Select.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/Select.java?ref=814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","patch":"@@ -719,4 +719,18 @@ public SelectExecutor eagerClone(FieldMapping key, int eagerType,\n      * @param schemaAlias\n      */\n     public void setSchemaAlias(String schemaAlias);\n+    \n+    /**\n+     * Set the flag to indicate whether this Select has\n+     * internally generated subselect \n+     */\n+    public void setHasSubselect(boolean hasSub);\n+    \n+    /**\n+     * Return the flag to indicate whether this Select has\n+     * internally generated subselect\n+     * @return\n+     */\n+    public boolean getHasSubselect();\n+   \n }"},{"sha":"61ad9231780724e84b10112b1f8febf80584782e","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SelectImpl.java","status":"modified","additions":11,"deletions":1,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SelectImpl.java","raw_url":"https://github.com/apache/openjpa/raw/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SelectImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SelectImpl.java?ref=814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","patch":"@@ -158,6 +158,7 @@\n     private List _subsels = null;\n     private SelectImpl _parent = null;\n     private String _subPath = null;\n+    private boolean _hasSub = false;\n \n     // from select if this select selects from a tmp table created by another\n     private SelectImpl _from = null;\n@@ -559,6 +560,14 @@ public void setParent(Select parent, String path) {\n         }\n     }\n     \n+    public void setHasSubselect(boolean hasSub) {\n+        _hasSub = hasSub;\n+    }\n+    \n+    public boolean getHasSubselect() {\n+        return _hasSub;    \n+    }\n+    \n     public Map getAliases() {\n         return _aliases;\n     }\n@@ -1990,8 +1999,9 @@ private int getTableIndex(Table table, PathJoins pj, boolean create) {\n         if (pj != null && pj.path() != null)\n             key = new Key(pj.path().toString(), key);\n \n-        if (_ctx != null && (_parent != null || _subsels != null))\n+        if (_ctx != null && (_parent != null || _subsels != null || _hasSub)) {\n             i = findAliasForQuery(table, pj, key, create);\n+        }\n \n         if (i != null)\n             return i.intValue();"},{"sha":"2ad1629698c000758c564be58119679250779c31","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/criteria/TestTypesafeCriteria.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/criteria/TestTypesafeCriteria.java","raw_url":"https://github.com/apache/openjpa/raw/814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/criteria/TestTypesafeCriteria.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/criteria/TestTypesafeCriteria.java?ref=814fef0f7df44e25d5d3c1f1ed04c8b415dc7c41","patch":"@@ -1161,7 +1161,6 @@ public void testValue4() {\n         executeAndCompareSQL(q, sql);\n     }\n \n-    @AllowFailure(message=\"The expected sql string is incorrect\")\n     public void testValues5() {\n         String sql = \"SELECT t0.name, t2.id, t2.label FROM CR_ITEM t0 \"\n             + \"INNER JOIN CR_ITEM_photos t1 ON t0.id = t1.ITEM_ID \""}]}

