{"sha":"8248d81a683ff3a23cccfee3394e5784bdf14760","node_id":"MDY6Q29tbWl0MjA2MzY0OjgyNDhkODFhNjgzZmYzYTIzY2NjZmVlMzM5NGU1Nzg0YmRmMTQ3NjA=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-03-02T21:24:01Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-03-02T21:24:01Z"},"message":"OPENJPA-1547: fix subquery syntax error for NOT IN (subquery with MEMBER OF)\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@918188 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c4ea029d539549c6ea73df4f68870107aaae5327","url":"https://api.github.com/repos/apache/openjpa/git/trees/c4ea029d539549c6ea73df4f68870107aaae5327"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/8248d81a683ff3a23cccfee3394e5784bdf14760","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/8248d81a683ff3a23cccfee3394e5784bdf14760","html_url":"https://github.com/apache/openjpa/commit/8248d81a683ff3a23cccfee3394e5784bdf14760","comments_url":"https://api.github.com/repos/apache/openjpa/commits/8248d81a683ff3a23cccfee3394e5784bdf14760/comments","author":null,"committer":null,"parents":[{"sha":"a515a71fec4d9b083061d3cd0c0e0f9067f2e17a","url":"https://api.github.com/repos/apache/openjpa/commits/a515a71fec4d9b083061d3cd0c0e0f9067f2e17a","html_url":"https://github.com/apache/openjpa/commit/a515a71fec4d9b083061d3cd0c0e0f9067f2e17a"}],"stats":{"total":36,"additions":35,"deletions":1},"files":[{"sha":"c415417619d6b9f45a1fc2414ec02243231c649a","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/8248d81a683ff3a23cccfee3394e5784bdf14760/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java","raw_url":"https://github.com/apache/openjpa/raw/8248d81a683ff3a23cccfee3394e5784bdf14760/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java?ref=8248d81a683ff3a23cccfee3394e5784bdf14760","patch":"@@ -163,7 +163,8 @@ public Expression or(Expression exp1, Expression exp2) {\n     }\n \n     public Expression not(Expression exp) {\n-        if (!(exp instanceof IsNotEmptyExpression) &&\n+        if (!(exp instanceof IsNotEmptyExpression) && \n+            !(exp instanceof InSubQExpression) &&\n             HasContainsExpressionVisitor.hasContains(exp))\n             return new NotContainsExpression((Exp) exp);\n         return new NotExpression((Exp) exp);"},{"sha":"efb20dbdb7b3110bfbefd2e68543dee3913fa0ef","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","status":"modified","additions":33,"deletions":0,"changes":33,"blob_url":"https://github.com/apache/openjpa/blob/8248d81a683ff3a23cccfee3394e5784bdf14760/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","raw_url":"https://github.com/apache/openjpa/raw/8248d81a683ff3a23cccfee3394e5784bdf14760/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java?ref=8248d81a683ff3a23cccfee3394e5784bdf14760","patch":"@@ -284,6 +284,12 @@ public void createEntityA_Coll_String() {\n         EntityManager em = emf.createEntityManager();\n         EntityTransaction tran = em.getTransaction();\n         createEntityA_Coll_String(em, ID);\n+        \n+        EntityB1 b = new EntityB1();\n+        b.setId(ID);\n+        b.setName(\"b\" + ID);\n+        em.persist(b);\n+        \n         tran.begin();\n         em.flush();\n         tran.commit();\n@@ -1329,6 +1335,33 @@ public void queryEntityA_Coll_String() {\n             }\n             em.clear();\n         }\n+        \n+        String[] queryWithParameters = {\n+                \"select b.name from \" + \n+                    \"EntityB1 b \" + \n+                    \"WHERE b.id in \" + \n+                    \"(select a.id FROM EntityA_Coll_String a where ?1 MEMBER OF a.nickNames)\",\n+                \"select b.name from \" + \n+                    \"EntityB1 b \" + \n+                    \"WHERE b.id not in \" + \n+                    \"(select a.id FROM EntityA_Coll_String a where ?1 MEMBER OF a.nickNames)\"\n+        };\n+            \n+        for (int i = 0; i < queryWithParameters.length; i++) {\n+            Query q1 = em.createQuery(queryWithParameters[i]);\n+            q1.setParameter(1, \"nickName_10\");\n+            rs = q1.getResultList();\n+            switch (i) {\n+            case 0:\n+                String obj = (String)rs.get(0);\n+                assertEquals(\"b1\", obj);\n+                break;\n+            case 1:\n+                assertTrue(rs.size() == 0);\n+                break;\n+            }\n+        }        \n+        \n         EntityTransaction tran = em.getTransaction();\n         tran.begin();\n         Query q = em.createQuery(\"select a from EntityA_Coll_String a\");"}]}

