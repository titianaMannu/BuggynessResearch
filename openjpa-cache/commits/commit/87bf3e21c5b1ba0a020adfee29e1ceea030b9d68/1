{"sha":"87bf3e21c5b1ba0a020adfee29e1ceea030b9d68","node_id":"MDY6Q29tbWl0MjA2MzY0Ojg3YmYzZTIxYzViMWJhMGEwMjBhZGZlZTI5ZTFjZWVhMDMwYjlkNjg=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-11-17T23:09:42Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-11-17T23:09:42Z"},"message":"OPENJPA-1384:\nTry current classloader when loading DBDictionary.\nSubmitted By: B.J. Reed\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.2.x@881612 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c4a0f99ae9eeb96894874485143313c0920eb59d","url":"https://api.github.com/repos/apache/openjpa/git/trees/c4a0f99ae9eeb96894874485143313c0920eb59d"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/87bf3e21c5b1ba0a020adfee29e1ceea030b9d68","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/87bf3e21c5b1ba0a020adfee29e1ceea030b9d68","html_url":"https://github.com/apache/openjpa/commit/87bf3e21c5b1ba0a020adfee29e1ceea030b9d68","comments_url":"https://api.github.com/repos/apache/openjpa/commits/87bf3e21c5b1ba0a020adfee29e1ceea030b9d68/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"23ba9e0c63f0beff3fc71308bd8f2c541e644ab5","url":"https://api.github.com/repos/apache/openjpa/commits/23ba9e0c63f0beff3fc71308bd8f2c541e644ab5","html_url":"https://github.com/apache/openjpa/commit/23ba9e0c63f0beff3fc71308bd8f2c541e644ab5"}],"stats":{"total":12,"additions":12,"deletions":0},"files":[{"sha":"aab3ed77b500b039a59743a223ea8ff0559f5db6","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java","status":"modified","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/87bf3e21c5b1ba0a020adfee29e1ceea030b9d68/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java","raw_url":"https://github.com/apache/openjpa/raw/87bf3e21c5b1ba0a020adfee29e1ceea030b9d68/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java?ref=87bf3e21c5b1ba0a020adfee29e1ceea030b9d68","patch":"@@ -122,6 +122,18 @@ private static DBDictionary newDBDictionary(JDBCConfiguration conf,\n                         DBDictionary.class)));\n             dict = (DBDictionary) AccessController.doPrivileged(\n                 J2DoPrivHelper.newInstanceAction(c));\n+        } catch (ClassNotFoundException cnfe) {\n+            // if the dictionary was not found, make another attempt\n+            // at loading the dictionary using the current thread.\n+            try {\n+                Class c = Thread.currentThread().getContextClassLoader().loadClass(dclass);\n+                dict = (DBDictionary) AccessController.doPrivileged(\n+                        J2DoPrivHelper.newInstanceAction(c));\n+            } catch (Exception e) {\n+                if (e instanceof PrivilegedActionException)\n+                    e = ((PrivilegedActionException) e).getException();\n+                throw new UserException(e).setFatal(true);\n+            }\n         } catch (Exception e) {\n             if (e instanceof PrivilegedActionException)\n                 e = ((PrivilegedActionException) e).getException();"}]}

