{"sha":"8a7ef392f3827e8d519b1076fd4d8f6c012420c4","node_id":"MDY6Q29tbWl0MjA2MzY0OjhhN2VmMzkyZjM4MjdlOGQ1MTliMTA3NmZkNGQ4ZjZjMDEyNDIwYzQ=","commit":{"author":{"name":"Heath Thomann","email":"hthomann@apache.org","date":"2011-08-08T18:53:55Z"},"committer":{"name":"Heath Thomann","email":"hthomann@apache.org","date":"2011-08-08T18:53:55Z"},"message":"OPENJPA-1691: Added property for forward compatibility, documented property and migration considerations.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1155056 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7b3b46611805d4e90adca97f7227fe40b347cfab","url":"https://api.github.com/repos/apache/openjpa/git/trees/7b3b46611805d4e90adca97f7227fe40b347cfab"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/8a7ef392f3827e8d519b1076fd4d8f6c012420c4","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/8a7ef392f3827e8d519b1076fd4d8f6c012420c4","html_url":"https://github.com/apache/openjpa/commit/8a7ef392f3827e8d519b1076fd4d8f6c012420c4","comments_url":"https://api.github.com/repos/apache/openjpa/commits/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/comments","author":null,"committer":null,"parents":[{"sha":"45bceaa9912d3dc7e1100d1531b55e662b390e84","url":"https://api.github.com/repos/apache/openjpa/commits/45bceaa9912d3dc7e1100d1531b55e662b390e84","html_url":"https://github.com/apache/openjpa/commit/45bceaa9912d3dc7e1100d1531b55e662b390e84"}],"stats":{"total":59,"additions":59,"deletions":0},"files":[{"sha":"4d7936f6a78c64590d0e0114a948aed65cffa131","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","status":"modified","additions":33,"deletions":0,"changes":33,"blob_url":"https://github.com/apache/openjpa/blob/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java?ref=8a7ef392f3827e8d519b1076fd4d8f6c012420c4","patch":"@@ -104,6 +104,25 @@\n      * configure statements that it detects are operating on unicode fields.\n      */\n     public boolean useSetFormOfUseForUnicode = true;\n+    \n+    /**\n+     * This variable was used prior to 2.1.x to indicate that OpenJPA should attempt to use\n+     * a Reader-based JDBC 4.0 method to set Clob or XML data.  It allowed XMLType and \n+     * Clob values larger than 4000 bytes to be used.  For 2.1.x+, code was added to allow\n+     * said functionality by default (see OPENJPA-1691).  For forward compatibility, this \n+     * variable should not be removed.\n+     */\n+    @Deprecated\n+    public boolean supportsSetClob = false;  \n+    \n+    /**\n+     * If a user sets the previous variable (supportsSetClob) to true, we should log a\n+     * warning indicating that the variable no longer has an effect due to the code changes\n+     * of OPENJPA-1691.  We only want to log the warning once per instance, thus this\n+     * variable will be used to indicate if the warning should be printed or not.  \n+     */\n+    @Deprecated\n+    private boolean logSupportsSetClobWarning = true;\n \n     /**\n      * Type constructor for XML column, used in INSERT and UPDATE statements.\n@@ -572,6 +591,20 @@ public void setBinaryStream(PreparedStatement stmnt, int idx,\n     public void setClobString(PreparedStatement stmnt, int idx, String val,\n         Column col)\n         throws SQLException {\n+    \t\n+    \t//We need a place to detect if the user is setting the 'supportsSetClob' property.\n+    \t//While in previous releases this property had meaning, it is no longer useful\n+    \t//given the code added via OPENJPA-1691.  As such, we need to warn user's the\n+    \t//property no longer has meaning.  While it would be nice to have a better way\n+    \t//to detect if the supportsSetClob property has been set, the best we can do\n+    \t//is detect the variable in this code path as this is the path a user's code\n+    \t//would go down if they are still executing code which actually made use of\n+    \t//the support provided via setting supportsSetClob.\n+    \tif (supportsSetClob && logSupportsSetClobWarning){\n+    \t\tlog.warn(_loc.get(\"oracle-set-clob-warning\"));\n+    \t\tlogSupportsSetClobWarning=false;\n+    \t}\n+\n         if (col.isXML()) {\n             if (isJDBC4) {\n                 // This JDBC 4 method handles values longer than 4000 bytes."},{"sha":"37ed4ef73da682301d5352dc7286d9a634e15833","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties?ref=8a7ef392f3827e8d519b1076fd4d8f6c012420c4","patch":"@@ -221,3 +221,6 @@ sequencesql-override: Going to override the DB2 specific default for the \\\n     string and the string set in the property and will further allow openJPA to use the \\\n     string defined by the property rather than the default string for DB2.\n invalid-locking-mode: Invalid locking mode for SolidDB: \"{0}\"\n+oracle-set-clob-warning: Setting the supportsSetClob property on the OracleDictionary no longer has an \\\n+    effect.  Code has been added to allow, by default, the functionality provided in previous releases \\\n+    via the supportsSetClob property."},{"sha":"f3b67946d4cd84ff0f0e87e72493e21156275f95","filename":"openjpa-project/src/doc/manual/migration_considerations.xml","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-project/src/doc/manual/migration_considerations.xml","raw_url":"https://github.com/apache/openjpa/raw/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-project/src/doc/manual/migration_considerations.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/migration_considerations.xml?ref=8a7ef392f3827e8d519b1076fd4d8f6c012420c4","patch":"@@ -433,6 +433,17 @@\n                     </itemizedlist>    \n                 </para>\n             </section>\n+            <section id=\"SupportsSetClob\">\n+                <title>\n+                    supportsSetClob property.  \n+                </title>\n+                <!-- See OPENJPA-1691 for details. -->\n+                <para>\n+                    In the OpenJPA 2.1.x release, code was added to OpenJPA to allow the setting of Clob or XML data larger than 4000 bytes.  This functionality\n+                    was eventually back ported to previous releases, and enabeld by the supportsSetClob property on the OracleDictionary.  Setting this property \n+                    has no effect in 2.1.x and later releases and any occurrence of it should be removed.\n+                </para>\n+            </section>            \n         </section>\n     </section>\n </appendix>"},{"sha":"2b8e01be7def77a302697e9c1e365efffe552f47","filename":"openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","status":"modified","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","raw_url":"https://github.com/apache/openjpa/raw/8a7ef392f3827e8d519b1076fd4d8f6c012420c4/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml?ref=8a7ef392f3827e8d519b1076fd4d8f6c012420c4","patch":"@@ -3865,6 +3865,18 @@ on database configuration, e.g. encoding. This property defines the maximum size\n CLOB to persist with the embedded method. Defaults to 4000 characters.\n                     </para>\n                 </listitem>\n+                <listitem id=\"OracleDictionary.SupportsSetClob\">\n+                    <para>\n+<literal>SupportsSetClob</literal>: This property was used in previous releases \n+to indicate that OpenJPA should attempt to use a Reader-based JDBC 4.0 method to \n+set Clob or XML data.  It allowed XMLType and Clob values larger than 4000 bytes \n+to be used.  For this release, and newer, code was added to allow said \n+functionality by default (see OPENJPA-1691).  For forward compatibility, this \n+property still remains, however it has been deprecated and will eventually be\n+removed.  Setting this property has no effect and any occurrence of it should\n+be removed.\n+                    </para>\n+                </listitem>                \n                 <listitem id=\"OracleDictionary.UseSetFormOfUseForUnicode\">\n                     <para>\n <literal>UseSetFormOfUseForUnicode</literal>: Prior to Oracle 10i, statements"}]}

