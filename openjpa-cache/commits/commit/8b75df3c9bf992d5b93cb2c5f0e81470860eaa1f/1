{"sha":"8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f","node_id":"MDY6Q29tbWl0MjA2MzY0OjhiNzVkZjNjOWJmOTkyZDViOTNjYjJjNWYwZTgxNDcwODYwZWFhMWY=","commit":{"author":{"name":"Helen Xu","email":"helenxu@apache.org","date":"2013-04-16T18:04:55Z"},"committer":{"name":"Helen Xu","email":"helenxu@apache.org","date":"2013-04-16T18:04:55Z"},"message":"OPENJPA-2369, eliminate the duplicate call to getUnloadedInternal function.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1468536 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"4784b2b8442fa162cc874e27401bdd3af1e9c4d8","url":"https://api.github.com/repos/apache/openjpa/git/trees/4784b2b8442fa162cc874e27401bdd3af1e9c4d8"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f","html_url":"https://github.com/apache/openjpa/commit/8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f","comments_url":"https://api.github.com/repos/apache/openjpa/commits/8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f/comments","author":null,"committer":null,"parents":[{"sha":"96751867c9dd063df97478c0ab759372dfd235d2","url":"https://api.github.com/repos/apache/openjpa/commits/96751867c9dd063df97478c0ab759372dfd235d2","html_url":"https://github.com/apache/openjpa/commit/96751867c9dd063df97478c0ab759372dfd235d2"}],"stats":{"total":9,"additions":6,"deletions":3},"files":[{"sha":"c3329055b5226f26060af8d67fc08f1fb0782d97","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","status":"modified","additions":6,"deletions":3,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java?ref=8b75df3c9bf992d5b93cb2c5f0e81470860eaa1f","patch":"@@ -3145,11 +3145,13 @@ protected void loadField(int field, int lockLevel, boolean forWrite,\n         FetchConfiguration fetch = _broker.getFetchConfiguration();\n         FieldMetaData fmd = _meta.getField(field);\n         BitSet fields = null;\n+        boolean unloadedDFGFieldMarked = false;\n \n         // if this is a dfg field or we need to load our dfg, do so\n-        if (fgs && (_flags & FLAG_LOADED) == 0)\n+        if (fgs && (_flags & FLAG_LOADED) == 0){\n             fields = getUnloadedInternal(fetch, LOAD_FGS, null);\n-        \n+            unloadedDFGFieldMarked = true;\n+        }\n         // check for load fetch group\n         String lfg = fmd.getLoadFetchGroup();\n         boolean lfgAdded = false;\n@@ -3172,7 +3174,8 @@ protected void loadField(int field, int lockLevel, boolean forWrite,\n             }\n         } else if (fmd.isInDefaultFetchGroup() && fields == null) {\n             // no load group but dfg: add dfg fields if we haven't already\n-            fields = getUnloadedInternal(fetch, LOAD_FGS, null);\n+            if (!unloadedDFGFieldMarked)\n+                fields = getUnloadedInternal(fetch, LOAD_FGS, null);\n         } else if (!_loaded.get(fmd.getIndex())) {\n             // no load group or dfg: load individual field\n             if (fields == null)"}]}

