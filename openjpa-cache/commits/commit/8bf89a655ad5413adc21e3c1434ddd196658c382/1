{"sha":"8bf89a655ad5413adc21e3c1434ddd196658c382","node_id":"MDY6Q29tbWl0MjA2MzY0OjhiZjg5YTY1NWFkNTQxM2FkYzIxZTNjMTQzNGRkZDE5NjY1OGMzODI=","commit":{"author":{"name":"David J. Wisneski","email":"wisneskid@apache.org","date":"2007-06-19T19:44:58Z"},"committer":{"name":"David J. Wisneski","email":"wisneskid@apache.org","date":"2007-06-19T19:44:58Z"},"message":"OPENJPA-240, packaging/renaming/JAXB dependency cleanups\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@548834 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"17a767c718f7cd5011f41f8f148d9888c98e519f","url":"https://api.github.com/repos/apache/openjpa/git/trees/17a767c718f7cd5011f41f8f148d9888c98e519f"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/8bf89a655ad5413adc21e3c1434ddd196658c382","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/8bf89a655ad5413adc21e3c1434ddd196658c382","html_url":"https://github.com/apache/openjpa/commit/8bf89a655ad5413adc21e3c1434ddd196658c382","comments_url":"https://api.github.com/repos/apache/openjpa/commits/8bf89a655ad5413adc21e3c1434ddd196658c382/comments","author":null,"committer":null,"parents":[{"sha":"79827a90f673b12d008d87c689898a53a35b0826","url":"https://api.github.com/repos/apache/openjpa/commits/79827a90f673b12d008d87c689898a53a35b0826","html_url":"https://github.com/apache/openjpa/commit/79827a90f673b12d008d87c689898a53a35b0826"}],"stats":{"total":108,"additions":102,"deletions":6},"files":[{"sha":"54f5d0b333586392e505d49fbb93d21d7b65f9ad","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java","status":"added","additions":97,"deletions":0,"changes":97,"blob_url":"https://github.com/apache/openjpa/blob/8bf89a655ad5413adc21e3c1434ddd196658c382/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java","raw_url":"https://github.com/apache/openjpa/raw/8bf89a655ad5413adc21e3c1434ddd196658c382/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java?ref=8bf89a655ad5413adc21e3c1434ddd196658c382","patch":"@@ -0,0 +1,97 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.    \n+ */\n+package org.apache.openjpa.jdbc.meta.strats;\n+\n+import java.io.StringReader;\n+import java.io.StringWriter;\n+import java.io.Writer;\n+\n+import javax.xml.bind.JAXBContext;\n+import javax.xml.bind.JAXBException;\n+import javax.xml.bind.Marshaller;\n+import javax.xml.bind.Unmarshaller;\n+import javax.xml.transform.stream.StreamSource;\n+\n+import org.apache.openjpa.jdbc.kernel.JDBCStore;\n+import org.apache.openjpa.jdbc.meta.ValueMapping;\n+import org.apache.openjpa.jdbc.meta.strats.AbstractValueHandler;\n+import org.apache.openjpa.jdbc.schema.Column;\n+import org.apache.openjpa.jdbc.schema.ColumnIO;\n+import org.apache.openjpa.meta.JavaTypes;\n+import org.apache.openjpa.util.InternalException;\n+\n+/**\n+ * Base class for xml value handlers.\n+ *\n+ * @author Catalina Wei\n+ * @since 1.0\n+ */\n+public class XMLValueHandler\n+    extends AbstractValueHandler {\n+    private static final String PROXY_SUFFIX = \"$proxy\";\n+\n+    public Column[] map(ValueMapping vm, String name, ColumnIO io,\n+        boolean adapt) {\n+        Column col = new Column();\n+        col.setName(name);\n+        col.setJavaType(JavaTypes.STRING);\n+        col.setSize(-1);\n+        col.setTypeName(vm.getMappingRepository().getDBDictionary()\n+            .xmlTypeName);\n+        return new Column[]{ col };\n+    }\n+\n+    public Object toDataStoreValue(ValueMapping vm, Object val,\n+        JDBCStore store) {\n+        // check for null value.\n+        if (val == null) \n+            return null;\n+        try {\n+            JAXBContext jc = JAXBContext.newInstance(\n+                // on update val is a proxy, that can not be marshalled.\n+                // so we get original type if val is a proxy.\n+                (val.getClass().getName().endsWith(PROXY_SUFFIX))\n+                     ? val.getClass().getSuperclass()\n+                     : val.getClass());\n+            Marshaller m = jc.createMarshaller();            \n+            Writer result = new StringWriter();\n+            m.marshal( val, result );\n+            return result.toString();\n+        }\n+        catch(JAXBException je) {\n+            throw new InternalException(je);\n+        }\n+    }\n+\n+    public Object toObjectValue(ValueMapping vm, Object val) {\n+        // check for null value.\n+        if (val == null) \n+            return null;\n+        try {\n+            String packageName = vm.getDeclaredType().getPackage().getName();\n+            JAXBContext jc = JAXBContext.newInstance(packageName);\n+            Unmarshaller u = jc.createUnmarshaller();\n+            return u.unmarshal(new StreamSource(new StringReader\n+                    (val.toString())));\n+        }\n+        catch(JAXBException je) {\n+            throw new InternalException(je);\n+        }\n+    }\n+}"},{"sha":"46302e0ebc08000fdcc9a2a81ddf82716042a0ab","filename":"openjpa-kernel/pom.xml","status":"modified","additions":0,"deletions":5,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/8bf89a655ad5413adc21e3c1434ddd196658c382/openjpa-kernel/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/8bf89a655ad5413adc21e3c1434ddd196658c382/openjpa-kernel/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/pom.xml?ref=8bf89a655ad5413adc21e3c1434ddd196658c382","patch":"@@ -59,11 +59,6 @@\n             <version>${pom.version}</version>\r\n             <scope>compile</scope>\r\n         </dependency>\r\n-\t    <dependency>\r\n-\t\t    <groupId>javax.xml.bind</groupId>\r\n-\t\t    <artifactId>jaxb-api</artifactId>\r\n-\t\t    <version>2.1</version>\r\n-\t    </dependency>\r\n         <dependency>\r\n             <groupId>org.apache.geronimo.specs</groupId>\r\n             <artifactId>geronimo-jms_1.1_spec</artifactId>\r"},{"sha":"dabd691bb5aaa9dda03a933ded9f49e33f1790e6","filename":"openjpa-persistence-jdbc/pom.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/8bf89a655ad5413adc21e3c1434ddd196658c382/openjpa-persistence-jdbc/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/8bf89a655ad5413adc21e3c1434ddd196658c382/openjpa-persistence-jdbc/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/pom.xml?ref=8bf89a655ad5413adc21e3c1434ddd196658c382","patch":"@@ -357,6 +357,11 @@\n             <version>${pom.version}</version>\n             <scope>compile</scope>\n         </dependency>\n+\t    <dependency>\n+\t\t    <groupId>javax.xml.bind</groupId>\n+\t\t    <artifactId>jaxb-api</artifactId>\n+\t\t    <version>2.1</version>\n+\t    </dependency>\n         <dependency>\n             <groupId>commons-dbcp</groupId>\n             <artifactId>commons-dbcp</artifactId>"},{"sha":"8548ad14c103baa360038600315a984dbc6e5b8a","filename":"pom.xml","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/8bf89a655ad5413adc21e3c1434ddd196658c382/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/8bf89a655ad5413adc21e3c1434ddd196658c382/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/pom.xml?ref=8bf89a655ad5413adc21e3c1434ddd196658c382","patch":"@@ -124,7 +124,6 @@\n                 <module>openjpa-persistence-jdbc</module>\r\n                 <module>openjpa-kernel-5</module>\r\n                 <module>openjpa-jdbc-5</module>\r\n-        \t\t<module>openjpa-xmlmapping-5</module>\r\n                 <module>openjpa-examples</module>\r\n             </modules>\r\n         </profile>\r"}]}

