{"sha":"8cb82a6f330d3fb6032750fc94236ffaa43ad01a","node_id":"MDY6Q29tbWl0MjA2MzY0OjhjYjgyYTZmMzMwZDNmYjYwMzI3NTBmYzk0MjM2ZmZhYTQzYWQwMWE=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2008-08-01T19:03:34Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2008-08-01T19:03:34Z"},"message":"OPENJPA-485: ORDER BY clause in JPQL generates syntactically wrong SQL for TABLE_PER_CLASS inheritance hierarchy\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@681781 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"2ec495e490b155bed071d581ca76185c9deb0b16","url":"https://api.github.com/repos/apache/openjpa/git/trees/2ec495e490b155bed071d581ca76185c9deb0b16"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/8cb82a6f330d3fb6032750fc94236ffaa43ad01a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/8cb82a6f330d3fb6032750fc94236ffaa43ad01a","html_url":"https://github.com/apache/openjpa/commit/8cb82a6f330d3fb6032750fc94236ffaa43ad01a","comments_url":"https://api.github.com/repos/apache/openjpa/commits/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/comments","author":null,"committer":null,"parents":[{"sha":"6ae99af762b82f03a2a72df2e21aba0e6bf6f1c4","url":"https://api.github.com/repos/apache/openjpa/commits/6ae99af762b82f03a2a72df2e21aba0e6bf6f1c4","html_url":"https://github.com/apache/openjpa/commit/6ae99af762b82f03a2a72df2e21aba0e6bf6f1c4"}],"stats":{"total":56,"additions":26,"deletions":30},"files":[{"sha":"c8e8f7ee2182892128afffba69f263aac62ae036","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/PCPath.java","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/PCPath.java","raw_url":"https://github.com/apache/openjpa/raw/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/PCPath.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/PCPath.java?ref=8cb82a6f330d3fb6032750fc94236ffaa43ad01a","patch":"@@ -488,8 +488,11 @@ else if (action.op == Action.UNBOUND_VAR) {\n                     }\n \n                     for (; from != null && from != to;\n-                        from = from.getJoinablePCSuperclassMapping())\n+                        from = from.getJoinablePCSuperclassMapping()) {\n+                    \tpstate.field = from.getFieldMapping(pstate.field\n+                    \t    .getName());\n                         pstate.joins = from.joinSuperclass(pstate.joins, false);\n+                    }\n                 }\n                 // nothing more to do from here on as we encountered an xpath action\n                 if (action.op == Action.GET_XPATH)"},{"sha":"72685e2f878293e767ee9388603a16dc502b7083","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/clauses/TestEJBClauses.java","status":"modified","additions":7,"deletions":10,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/clauses/TestEJBClauses.java","raw_url":"https://github.com/apache/openjpa/raw/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/clauses/TestEJBClauses.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/clauses/TestEJBClauses.java?ref=8cb82a6f330d3fb6032750fc94236ffaa43ad01a","patch":"@@ -165,16 +165,13 @@ public void testClausePathExpr() {\n         String failure = \"SELECT DISTINCT s \" +\r\n             \"FROM Student s WHERE\" +\r\n             \" s.department.name = 'CompSci1'\";\r\n-\r\n-        try {\r\n-            List ls = em.createQuery(failure).getResultList();\r\n-            fail(\r\n-                \"cannot compose path expressions from a path expression that evaluates to a collection.\");\r\n-        }\r\n-        catch (Exception e) {\r\n-            //\r\n-        }\r\n-\r\n+        // Changes related to OPENJPA-485 allows this query to pass.\r\n+        // The query is not kosher as it does navigate through a \r\n+        // collection-valued-path-expression (s.department.name) where\r\n+        // department is a Collection. \r\n+        // But we allow this because of the convenience of the query expression \r\n+        List ls = em.createQuery(failure).getResultList();\r\n+        assertFalse(ls.isEmpty());\r\n         endEm(em);\r\n     }\r\n \r"},{"sha":"5c0db50c9f1f861a5df12e18528c8bcdad7a02d4","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/managedinterface/TestManagedInterfaces.java","status":"modified","additions":15,"deletions":19,"changes":34,"blob_url":"https://github.com/apache/openjpa/blob/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/managedinterface/TestManagedInterfaces.java","raw_url":"https://github.com/apache/openjpa/raw/8cb82a6f330d3fb6032750fc94236ffaa43ad01a/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/managedinterface/TestManagedInterfaces.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/managedinterface/TestManagedInterfaces.java?ref=8cb82a6f330d3fb6032750fc94236ffaa43ad01a","patch":"@@ -330,26 +330,22 @@ public void testMixedQuery() {\n         createMixed();\r\n \r\n         OpenJPAEntityManager em = emf.createEntityManager();\r\n-        try {\r\n-            Query q = em.createQuery(\"select o from MixedInterface o \" +\r\n-                \"where o.intField = 4\");\r\n-            Collection c = q.getResultList();\r\n-            Set seen = new HashSet();\r\n-            assertEquals(2, c.size());\r\n-            MixedInterface pc;\r\n-            for (Iterator it = c.iterator(); it.hasNext();) {\r\n-                pc = (MixedInterface) it.next();\r\n-                assertEquals(4, pc.getIntField());\r\n-                seen.add(pc.getClass());\r\n-            }\r\n-            assertEquals(2, seen.size());\r\n-\r\n-            fail(\"OPENJPA-481\");\r\n-        } catch (PersistenceException e) {\r\n-            // expected\r\n-        } finally {\r\n-            em.close();\r\n+        Query q = em.createQuery(\"select o from MixedInterface o \" +\r\n+            \"where o.intField = 4\");\r\n+        Collection c = q.getResultList();\r\n+        Set seen = new HashSet();\r\n+        assertEquals(2, c.size());\r\n+        MixedInterface pc;\r\n+        for (Iterator it = c.iterator(); it.hasNext();) {\r\n+            pc = (MixedInterface) it.next();\r\n+            assertEquals(4, pc.getIntField());\r\n+            seen.add(pc.getClass());\r\n         }\r\n+        assertEquals(2, seen.size());\r\n+        \r\n+        // Changes of OPENJPA-485 had the positive (but unintended) consequence\r\n+        // of making this case pass, which was failing before as reported in\r\n+        // OPENJPA-481\r\n     }\r\n \r\n     public void testQueryForMixedInterfaceImpls() {\r"}]}

