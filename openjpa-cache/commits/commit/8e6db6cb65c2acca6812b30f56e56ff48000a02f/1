{"sha":"8e6db6cb65c2acca6812b30f56e56ff48000a02f","node_id":"MDY6Q29tbWl0MjA2MzY0OjhlNmRiNmNiNjVjMmFjY2E2ODEyYjMwZjU2ZTU2ZmY0ODAwMGEwMmY=","commit":{"author":{"name":"Kevin W. Sutter","email":"kwsutter@apache.org","date":"2008-09-08T21:32:17Z"},"committer":{"name":"Kevin W. Sutter","email":"kwsutter@apache.org","date":"2008-09-08T21:32:17Z"},"message":"OPENJPA-715.  Committing the testcase provided by Ekin Sokmen and the patch provided by Fay Wang.  Committing the change for both the 1.2.x service stream and 1.3.0 snapshot (trunk).\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@693282 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a1e506e7a7c81f39a111d0e98310e08e9447fa17","url":"https://api.github.com/repos/apache/openjpa/git/trees/a1e506e7a7c81f39a111d0e98310e08e9447fa17"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/8e6db6cb65c2acca6812b30f56e56ff48000a02f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/8e6db6cb65c2acca6812b30f56e56ff48000a02f","html_url":"https://github.com/apache/openjpa/commit/8e6db6cb65c2acca6812b30f56e56ff48000a02f","comments_url":"https://api.github.com/repos/apache/openjpa/commits/8e6db6cb65c2acca6812b30f56e56ff48000a02f/comments","author":null,"committer":null,"parents":[{"sha":"52a0f630978ee7687057e5eda128f67233a98939","url":"https://api.github.com/repos/apache/openjpa/commits/52a0f630978ee7687057e5eda128f67233a98939","html_url":"https://github.com/apache/openjpa/commit/52a0f630978ee7687057e5eda128f67233a98939"}],"stats":{"total":10,"additions":7,"deletions":3},"files":[{"sha":"7532cdf23650202baf12060c42e57fc07803d954","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/8e6db6cb65c2acca6812b30f56e56ff48000a02f/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java","raw_url":"https://github.com/apache/openjpa/raw/8e6db6cb65c2acca6812b30f56e56ff48000a02f/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java?ref=8e6db6cb65c2acca6812b30f56e56ff48000a02f","patch":"@@ -356,7 +356,7 @@ protected Column addPrimaryKeyColumn(Table table) {\n     }\n \n     /**\n-     * Return the primary key value for the given class.\n+     * Return the primary key value for the sequence table for the given class.\n      */\n     protected Object getPrimaryKey(ClassMapping mapping) {\n         return Numbers.valueOf(0);"},{"sha":"9bf1fc0fe95fcf87738f2555000536543bbfa621","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/8e6db6cb65c2acca6812b30f56e56ff48000a02f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","raw_url":"https://github.com/apache/openjpa/raw/8e6db6cb65c2acca6812b30f56e56ff48000a02f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java?ref=8e6db6cb65c2acca6812b30f56e56ff48000a02f","patch":"@@ -755,8 +755,12 @@ private void preFlushPC(ValueMetaData vmd, Object obj, boolean logical,\n                     .setFailedObject(obj);\n         } else {\n             sm = _broker.getStateManager(obj);\n-            if (sm == null || !sm.isProvisional())\n+            if (sm == null || !sm.isProvisional()) { \n                 sm = _broker.persist(obj, null, true, call);\n+                // ensure generated IDs get assigned properly\n+                if (!logical)\n+                    ((StateManagerImpl)sm).assignObjectId(false, true);\n+            }\n         }\n \n         if (sm != null) {"},{"sha":"d592e66cdf1a760cf0c24c1c3e5ac2d612bdf309","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/8e6db6cb65c2acca6812b30f56e56ff48000a02f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/8e6db6cb65c2acca6812b30f56e56ff48000a02f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java?ref=8e6db6cb65c2acca6812b30f56e56ff48000a02f","patch":"@@ -512,7 +512,7 @@ public boolean assignObjectId(boolean flush) {\n      * Ask store manager to assign our oid, optionally flushing and\n      * optionally recaching on the new oid.\n      */\n-    private boolean assignObjectId(boolean flush, boolean preFlushing) {\n+    boolean assignObjectId(boolean flush, boolean preFlushing) {\n         if (_oid != null || isEmbedded() || !isPersistent())\n             return true;\n "}]}

