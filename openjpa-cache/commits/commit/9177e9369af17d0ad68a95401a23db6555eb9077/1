{"sha":"9177e9369af17d0ad68a95401a23db6555eb9077","node_id":"MDY6Q29tbWl0MjA2MzY0OjkxNzdlOTM2OWFmMTdkMGFkNjhhOTU0MDFhMjNkYjY1NTVlYjkwNzc=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-08-26T22:01:25Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-08-26T22:01:25Z"},"message":"OPENJPA-1266: JDBC escape syntax for date, time, timestamp support\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@808198 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"efad1feb9529a2e9e057888a54d7a12a77eded75","url":"https://api.github.com/repos/apache/openjpa/git/trees/efad1feb9529a2e9e057888a54d7a12a77eded75"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9177e9369af17d0ad68a95401a23db6555eb9077","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9177e9369af17d0ad68a95401a23db6555eb9077","html_url":"https://github.com/apache/openjpa/commit/9177e9369af17d0ad68a95401a23db6555eb9077","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9177e9369af17d0ad68a95401a23db6555eb9077/comments","author":null,"committer":null,"parents":[{"sha":"f68c531a5ba53768e00daa7fad5749f4ad31da6b","url":"https://api.github.com/repos/apache/openjpa/commits/f68c531a5ba53768e00daa7fad5749f4ad31da6b","html_url":"https://github.com/apache/openjpa/commit/f68c531a5ba53768e00daa7fad5749f4ad31da6b"}],"stats":{"total":40,"additions":11,"deletions":29},"files":[{"sha":"3db39989c4ffeef9c0479a1b84e2de6b047f831b","filename":"openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt","status":"modified","additions":3,"deletions":15,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/9177e9369af17d0ad68a95401a23db6555eb9077/openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt","raw_url":"https://github.com/apache/openjpa/raw/9177e9369af17d0ad68a95401a23db6555eb9077/openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt?ref=9177e9369af17d0ad68a95401a23db6555eb9077","patch":"@@ -293,23 +293,11 @@ TOKEN : /* literals */\n \t  )\r\n \t  \"'\"\r\n \t>\r\n-\t| < DATE_LITERAL: \"{d '\" ([\"0\"-\"9\"])([\"0\"-\"9\"])([\"0\"-\"9\"])([\"0\"-\"9\"]) (\"-\") \r\n-\t                   ([\"0\"-\"1\"])([\"0\"-\"9\"]) (\"-\") \r\n-\t                   ([\"0\"-\"3\"])([\"0\"-\"9\"]) \"'}\" \r\n+\t| < DATE_LITERAL: \"{d '\" ([\"0\"-\"9\", \"-\"])* \"'}\" \r\n \t>\r\n-\t| < TIME_LITERAL: \"{t '\" ([\"0\"-\"2\"])([\"0\"-\"9\"]) (\":\") \r\n-\t                   ([\"0\"-\"6\"])([\"0\"-\"9\"]) (\":\") \r\n-\t                   ([\"0\"-\"6\"])([\"0\"-\"9\"]) \"'}\" \r\n+\t| < TIME_LITERAL: \"{t '\" ([\"0\"-\"9\", \":\"])* \"'}\" \r\n \t>\r\n-\t| < TIMESTAMP_LITERAL: \"{ts '\" ([\"0\"-\"9\"])([\"0\"-\"9\"])([\"0\"-\"9\"])([\"0\"-\"9\"]) (\"-\") \r\n-\t                   ([\"0\"-\"1\"])([\"0\"-\"9\"]) (\"-\") \r\n-\t                   ([\"0\"-\"3\"])([\"0\"-\"9\"]) (\" \")\r\n-\t                   ([\"0\"-\"2\"])([\"0\"-\"9\"]) (\":\") \r\n-\t                   ([\"0\"-\"6\"])([\"0\"-\"9\"]) (\":\") \r\n-\t                   ([\"0\"-\"6\"])([\"0\"-\"9\"]) \r\n-\t                   ((\".\") ([\"0\"-\"9\"]) ([\"0\"-\"9\"])? ([\"0\"-\"9\"])? ([\"0\"-\"9\"])?\r\n-\t                   ([\"0\"-\"9\"])? ([\"0\"-\"9\"])? )?\r\n-\t                   \"'}\" \r\n+\t| < TIMESTAMP_LITERAL: \"{ts '\" ([\"0\"-\"9\", \"-\", \":\", \" \", \".\"])* \"'}\" \r\n \t>\r\n }\r\n \r"},{"sha":"39acd54cd3775ca87786e3a088ed6d738103b126","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestJDBCEscapeDate.java","status":"modified","additions":8,"deletions":14,"changes":22,"blob_url":"https://github.com/apache/openjpa/blob/9177e9369af17d0ad68a95401a23db6555eb9077/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestJDBCEscapeDate.java","raw_url":"https://github.com/apache/openjpa/raw/9177e9369af17d0ad68a95401a23db6555eb9077/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestJDBCEscapeDate.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestJDBCEscapeDate.java?ref=9177e9369af17d0ad68a95401a23db6555eb9077","patch":"@@ -55,14 +55,16 @@ public void testJDBCEscape() {\n         \n         String[] jpql = {\n             \"select a from Employee a where a.hireDate >= {d '2009-08-25'}\",\n+            \"select a from Employee a where a.hireDate >= {d '2009-8-5'}\",\n             \"select a from Employee a where a.hireTime >= {t '00:00:00'}\",\n             \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00'}\",\n+            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.'}\",\n             \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.1'}\",\n-            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.11'}\",\n-            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.111'}\",\n-            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.1111'}\",\n-            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.11111'}\",\n-            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.111111'}\",\n+            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.12'}\",\n+            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.123'}\",\n+            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.1234'}\",\n+            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.12345'}\",\n+            \"select a from Employee a where a.hireTimestamp >= {ts '2009-08-25 00:00:00.123456'}\",\n             \"select {t '00:00:00'}, a.empId from Employee a\",\n         };\n \n@@ -72,16 +74,8 @@ public void testJDBCEscape() {\n             Assert.assertEquals(1, results.size());\n         }\n \n-        String wrongTs = \"select a from Employee a where a.hireTimestamp > {ts '2009-08-25 00:00:00.1111111'}\";\n-        try {\n-            Query q = em.createQuery(wrongTs);\n-            List results = q.getResultList();\n-            Assert.fail();\n-        } catch (Exception ex) {\n-        }\n-\n         em.getTransaction().begin();\n-        String update = \"update Employee a set a.hireTimestamp = {ts '2009-08-25 00:00:00.111111'} where a.empId = 1\";\n+        String update = \"update Employee a set a.hireTimestamp = {ts '2009-08-25 00:00:00.123456'} where a.empId = 1\";\n         Query q = em.createQuery(update);\n         int updateCnt = q.executeUpdate();\n         em.getTransaction().commit();"}]}

