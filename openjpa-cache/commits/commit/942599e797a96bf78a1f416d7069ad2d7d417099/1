{"sha":"942599e797a96bf78a1f416d7069ad2d7d417099","node_id":"MDY6Q29tbWl0MjA2MzY0Ojk0MjU5OWU3OTdhOTZiZjc4YTFmNDE2ZDcwNjlhZDJkN2Q0MTcwOTk=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-01-03T03:02:45Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-01-03T03:02:45Z"},"message":"deleteTableContents optimization for MySQL. This is disabled by default, as MySQL may fail if using InnoDB + delete constraints.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@492032 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ce00240e0ef17196359a9a2fc08450ae55002527","url":"https://api.github.com/repos/apache/openjpa/git/trees/ce00240e0ef17196359a9a2fc08450ae55002527"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/942599e797a96bf78a1f416d7069ad2d7d417099","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/942599e797a96bf78a1f416d7069ad2d7d417099","html_url":"https://github.com/apache/openjpa/commit/942599e797a96bf78a1f416d7069ad2d7d417099","comments_url":"https://api.github.com/repos/apache/openjpa/commits/942599e797a96bf78a1f416d7069ad2d7d417099/comments","author":null,"committer":null,"parents":[{"sha":"04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","url":"https://api.github.com/repos/apache/openjpa/commits/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","html_url":"https://github.com/apache/openjpa/commit/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a"}],"stats":{"total":25,"additions":25,"deletions":0},"files":[{"sha":"99cf381e692d2301dc3056cce7da1e9e6d825c3d","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","status":"modified","additions":25,"deletions":0,"changes":25,"blob_url":"https://github.com/apache/openjpa/blob/942599e797a96bf78a1f416d7069ad2d7d417099/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/942599e797a96bf78a1f416d7069ad2d7d417099/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java?ref=942599e797a96bf78a1f416d7069ad2d7d417099","patch":"@@ -50,6 +50,15 @@\n      */\n     public boolean driverDeserializesBlobs = true;\n \n+    /**\n+     * Whether to inline multi-table bulk-delete operations into MySQL's \n+     * combined <code>DELETE FROM foo, bar, baz</code> syntax. \n+     * Defaults to false, since this may fail in the presence of InnoDB tables\n+     * with foreign keys.\n+     * @see http://dev.mysql.com/doc/refman/5.0/en/delete.html\n+     */\n+    public boolean optimizeMultiTableDeletes = false;\n+\n     public MySQLDictionary() {\n         platform = \"MySQL\";\n         validationSQL = \"SELECT NOW()\";\n@@ -130,6 +139,22 @@ protected String getForeignKeyConstraintSQL(ForeignKey fk) {\n             return null;\n         return super.getForeignKeyConstraintSQL(fk);\n     }\n+    \n+    public String[] getDeleteTableContentsSQL(Table[] tables) {\n+        // mysql >= 4 supports more-optimal delete syntax\n+        if (!optimizeMultiTableDeletes)\n+            return super.getDeleteTableContentsSQL(tables);\n+        else {\n+            StringBuffer buf = new StringBuffer(tables.length * 8);\n+            buf.append(\"DELETE FROM \");\n+            for (int i = 0; i < tables.length; i++) {\n+                buf.append(tables[i].getFullName());\n+                if (i < tables.length - 1)\n+                    buf.append(\", \");\n+            }\n+            return new String[] { buf.toString() };\n+        }\n+    }\n \n     protected void appendSelectRange(SQLBuffer buf, long start, long end) {\n         buf.append(\" LIMIT \").appendValue(start).append(\", \");"}]}

