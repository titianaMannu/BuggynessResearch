{"sha":"946781881847f4dee118aa286f3dd788781913d9","node_id":"MDY6Q29tbWl0MjA2MzY0Ojk0Njc4MTg4MTg0N2Y0ZGVlMTE4YWEyODZmM2RkNzg4NzgxOTEzZDk=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2009-09-18T20:06:12Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2009-09-18T20:06:12Z"},"message":"OPENJPA-1310 SQLServer requires JAXB marshalled XML to be in UTF-16 instead of UTF-8.  Also updated some of the XmlElement names to match the case used in the XmlType annotation.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@816767 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"00a41918ae27700b4dc08877b4fe66b78c8307c4","url":"https://api.github.com/repos/apache/openjpa/git/trees/00a41918ae27700b4dc08877b4fe66b78c8307c4"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/946781881847f4dee118aa286f3dd788781913d9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/946781881847f4dee118aa286f3dd788781913d9","html_url":"https://github.com/apache/openjpa/commit/946781881847f4dee118aa286f3dd788781913d9","comments_url":"https://api.github.com/repos/apache/openjpa/commits/946781881847f4dee118aa286f3dd788781913d9/comments","author":null,"committer":null,"parents":[{"sha":"3f43e3dd0e2c17b00e467dd2841b8a9c3bb0c8f1","url":"https://api.github.com/repos/apache/openjpa/commits/3f43e3dd0e2c17b00e467dd2841b8a9c3bb0c8f1","html_url":"https://github.com/apache/openjpa/commit/3f43e3dd0e2c17b00e467dd2841b8a9c3bb0c8f1"}],"stats":{"total":58,"additions":48,"deletions":10},"files":[{"sha":"dbf3188a2d2c1e7677fc9581be1cc5ffdd4ba337","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/946781881847f4dee118aa286f3dd788781913d9/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java","raw_url":"https://github.com/apache/openjpa/raw/946781881847f4dee118aa286f3dd788781913d9/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/XMLValueHandler.java?ref=946781881847f4dee118aa286f3dd788781913d9","patch":"@@ -69,7 +69,9 @@ public Object toDataStoreValue(ValueMapping vm, Object val,\n                 (val.getClass().getName().endsWith(PROXY_SUFFIX))\n                      ? val.getClass().getSuperclass()\n                      : val.getClass());\n-            Marshaller m = jc.createMarshaller();            \n+            Marshaller m = jc.createMarshaller();\n+            // Some DBs, like MS SQL Server, require a different encoding than the JAXB default of UTF-8\n+            m.setProperty(\"jaxb.encoding\", store.getDBDictionary().getXMLTypeEncoding());\n             Writer result = new StringWriter();\n             m.marshal( val, result );\n             return result.toString();"},{"sha":"660f30471f51e618a2a61b3c35ba1d8f06fbe80c","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":29,"deletions":0,"changes":29,"blob_url":"https://github.com/apache/openjpa/blob/946781881847f4dee118aa286f3dd788781913d9/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/946781881847f4dee118aa286f3dd788781913d9/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=946781881847f4dee118aa286f3dd788781913d9","patch":"@@ -311,6 +311,7 @@\n     public String varbinaryTypeName = \"VARBINARY\";\n     public String varcharTypeName = \"VARCHAR\";\n     public String xmlTypeName = \"XML\";\n+    public String xmlTypeEncoding = \"UTF-8\";\n     public String getStringVal = \"\";\n \n     // schema metadata\n@@ -5028,6 +5029,34 @@ public void setDelimitIds(boolean delimitIds) {\n         this.delimitIds = delimitIds;\n     }\n     \n+    /**\n+     * @return supportsXMLColumn\n+     */\n+    public boolean getSupportsXMLColumn() {\n+        return supportsXMLColumn;\n+    }\n+\n+    /**\n+     * @param b boolean representing if XML columns are supported\n+     */\n+    public void setSupportsXMLColumn(boolean b) {\n+        supportsXMLColumn = b;\n+    }\n+    \n+    /**\n+     * @return xmlTypeEncoding\n+     */\n+    public String getXMLTypeEncoding() {\n+        return xmlTypeEncoding;\n+    }\n+\n+    /**\n+     * @param encoding database required JAXB encoding for the XML value\n+     */\n+    public void setXMLTypeEncoding(String encoding) {\n+        xmlTypeEncoding = encoding;\n+    }\n+    \n     // TODO: Should we pass in combining char, or just assume '_'?\n     public String combineNames(String... names) {\n         boolean delimited = false;"},{"sha":"3ad85fd9d2673833e6dc82cece6a8774a9a814d0","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","status":"modified","additions":9,"deletions":2,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/946781881847f4dee118aa286f3dd788781913d9/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/946781881847f4dee118aa286f3dd788781913d9/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java?ref=946781881847f4dee118aa286f3dd788781913d9","patch":"@@ -70,7 +70,7 @@ public void connectedConfiguration(Connection conn) throws SQLException {\n                     driverVendor = VENDOR_MICROSOFT;\n                     // serverMajorVersion of 8==2000, 9==2005, 10==2008\n                     if (meta.getDatabaseMajorVersion() >= 9)\n-                        supportsXMLColumn = true;\n+                        setSupportsXMLColumn(true);\n                     if (meta.getDriverMajorVersion() >= 2) {\n                         // see http://blogs.msdn.com/jdbcteam/archive/2007/05/\\\n                         // 02/what-is-adaptive-response-buffering-and-why-\\\n@@ -104,7 +104,7 @@ else if (url != null &&\n                                 versionString.indexOf(\" \"));\n                         int version = Integer.parseInt(versionString);\n                         if (version >= 2005)\n-                            supportsXMLColumn = true;\n+                            setSupportsXMLColumn(true);\n                     }\n                 }\n             } else {\n@@ -254,6 +254,13 @@ public String getSchemaCase() {\n         return schemaCase;\n     }\n \n+    @Override\n+    public void setSupportsXMLColumn(boolean b) {\n+        super.setSupportsXMLColumn(b);\n+        // MS SQL Server requires XML data in UTF-16 or UCS-2 instead of JAXB default of UTF-8\n+        super.setXMLTypeEncoding(\"UTF-16\");\n+    }\n+    \n     @Override\n     protected Boolean matchErrorState(int subtype, Set<String> errorStates,\n         SQLException ex) {"},{"sha":"aa0e7a4aabccb3c93209ebf3ca0ab689c03f72ee","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/Address.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/946781881847f4dee118aa286f3dd788781913d9/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/Address.java","raw_url":"https://github.com/apache/openjpa/raw/946781881847f4dee118aa286f3dd788781913d9/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/Address.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/Address.java?ref=946781881847f4dee118aa286f3dd788781913d9","patch":"@@ -55,11 +55,11 @@\n })\n public class Address {\n \n-    @XmlElement(name = \"Name\")\n+    @XmlElement(name = \"name\")\n     protected String name;\n-    @XmlElement(name = \"Street\")\n+    @XmlElement(name = \"street\")\n     protected List<String> street;\n-    @XmlElement(name = \"City\")\n+    @XmlElement(name = \"city\")\n     protected String city;\n \n     /**"},{"sha":"e099903589dba4b2b450e39dbcea95f1f668c0bd","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/CANAddress.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/946781881847f4dee118aa286f3dd788781913d9/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/CANAddress.java","raw_url":"https://github.com/apache/openjpa/raw/946781881847f4dee118aa286f3dd788781913d9/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/CANAddress.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/CANAddress.java?ref=946781881847f4dee118aa286f3dd788781913d9","patch":"@@ -51,9 +51,9 @@\n     extends Address\n {\n \n-    @XmlElement(name = \"Province\")\n+    @XmlElement(name = \"province\")\n     protected String province;\n-    @XmlElement(name = \"PostalCode\")\n+    @XmlElement(name = \"postalCode\")\n     protected String postalCode;\n \n     /**"},{"sha":"74232f8a7370b8c1c35c3aa11b7a7a32b9bc7ca5","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/USAAddress.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/946781881847f4dee118aa286f3dd788781913d9/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/USAAddress.java","raw_url":"https://github.com/apache/openjpa/raw/946781881847f4dee118aa286f3dd788781913d9/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/USAAddress.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/xmlmapping/xmlbindings/myaddress/USAAddress.java?ref=946781881847f4dee118aa286f3dd788781913d9","patch":"@@ -50,9 +50,9 @@\n     extends Address\n {\n \n-    @XmlElement(name = \"State\")\n+    @XmlElement(name = \"state\")\n     protected String state;\n-    @XmlElement(name = \"ZIP\")\n+    @XmlElement(name = \"zip\")\n     protected int zip;\n \n     /**"}]}

