{"sha":"968634a738b10ff695d59c1ff05fef2ba425681f","node_id":"MDY6Q29tbWl0MjA2MzY0Ojk2ODYzNGE3MzhiMTBmZjY5NWQ1OWMxZmYwNWZlZjJiYTQyNTY4MWY=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2010-01-19T18:53:16Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2010-01-19T18:53:16Z"},"message":"OPENJPA-1470 Java 2 Security permission violation on getClassLoader caused JEE container unable to enhance entities on the fly.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@900905 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f7796052a5fd4c6c63a9cde82c552f219b3c0168","url":"https://api.github.com/repos/apache/openjpa/git/trees/f7796052a5fd4c6c63a9cde82c552f219b3c0168"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/968634a738b10ff695d59c1ff05fef2ba425681f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/968634a738b10ff695d59c1ff05fef2ba425681f","html_url":"https://github.com/apache/openjpa/commit/968634a738b10ff695d59c1ff05fef2ba425681f","comments_url":"https://api.github.com/repos/apache/openjpa/commits/968634a738b10ff695d59c1ff05fef2ba425681f/comments","author":null,"committer":null,"parents":[{"sha":"3bff9645033db9d990e80187a76b6de08e840aa8","url":"https://api.github.com/repos/apache/openjpa/commits/3bff9645033db9d990e80187a76b6de08e840aa8","html_url":"https://github.com/apache/openjpa/commit/3bff9645033db9d990e80187a76b6de08e840aa8"}],"stats":{"total":11,"additions":6,"deletions":5},"files":[{"sha":"6ba4c9ac0acb224f39e5a225ba06a6343b9d84c5","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/enhance/PCEnhancer.java","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/968634a738b10ff695d59c1ff05fef2ba425681f/openjpa-kernel/src/main/java/org/apache/openjpa/enhance/PCEnhancer.java","raw_url":"https://github.com/apache/openjpa/raw/968634a738b10ff695d59c1ff05fef2ba425681f/openjpa-kernel/src/main/java/org/apache/openjpa/enhance/PCEnhancer.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/enhance/PCEnhancer.java?ref=968634a738b10ff695d59c1ff05fef2ba425681f","patch":"@@ -495,23 +495,24 @@ public void setBytecodeWriter(BytecodeWriter writer) {\n      * @return <code>ENHANCE_*</code> constant\n      */\n     public int run() {\n+        Class<?> type = _managedType.getType();\n         try {\n             // if managed interface, skip\n             if (_pc.isInterface())\n                 return ENHANCE_INTERFACE;\n \n             // check if already enhanced\n-            ClassLoader loader = _managedType.getType().getClassLoader();\n+            ClassLoader loader = AccessController.doPrivileged(J2DoPrivHelper.getClassLoaderAction(type));\n             for (Class<?> iface : _managedType.getDeclaredInterfaceTypes()) {\n                 if (iface.getName().equals(PCTYPE.getName())) {\n                     if (_log.isTraceEnabled()) {\n-                        _log.trace(_loc.get(\"pc-type\", _managedType.getType(), loader));\n+                        _log.trace(_loc.get(\"pc-type\", type, loader));\n                     }\n                     return ENHANCE_NONE;\n                 }\n             }\n             if (_log.isTraceEnabled()) {\n-                _log.trace(_loc.get(\"enhance-start\", _managedType.getType(), loader));\n+                _log.trace(_loc.get(\"enhance-start\", type, loader));\n             }\n \n \n@@ -541,13 +542,13 @@ public int run() {\n             }\n \n             if (_log.isWarnEnabled())\n-                _log.warn(_loc.get(\"pers-aware\", _managedType.getType(), loader));\n+                _log.warn(_loc.get(\"pers-aware\", type, loader));\n             return ENHANCE_AWARE;\n         } catch (OpenJPAException ke) {\n             throw ke;\n         } catch (Exception e) {\n             throw new GeneralException(_loc.get(\"enhance-error\",\n-                _managedType.getType().getName(), e.getMessage()), e);\n+                type.getName(), e.getMessage()), e);\n         }\n     }\n "}]}

