{"sha":"97aca65ddc006b3bd868faadc3893222b0609cd6","node_id":"MDY6Q29tbWl0MjA2MzY0Ojk3YWNhNjVkZGMwMDZiM2JkODY4ZmFhZGMzODkzMjIyYjA2MDljZDY=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-10-03T03:42:01Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-10-03T03:42:01Z"},"message":"OPENJPA-1237: allow customized MappingRepository\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@821236 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c32d4d7a79730681eb33840622b6855e1487b3a3","url":"https://api.github.com/repos/apache/openjpa/git/trees/c32d4d7a79730681eb33840622b6855e1487b3a3"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/97aca65ddc006b3bd868faadc3893222b0609cd6","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/97aca65ddc006b3bd868faadc3893222b0609cd6","html_url":"https://github.com/apache/openjpa/commit/97aca65ddc006b3bd868faadc3893222b0609cd6","comments_url":"https://api.github.com/repos/apache/openjpa/commits/97aca65ddc006b3bd868faadc3893222b0609cd6/comments","author":null,"committer":null,"parents":[{"sha":"31c4790c328fa208ed8b9e3c4ed4bb8b168b9c50","url":"https://api.github.com/repos/apache/openjpa/commits/31c4790c328fa208ed8b9e3c4ed4bb8b168b9c50","html_url":"https://github.com/apache/openjpa/commit/31c4790c328fa208ed8b9e3c4ed4bb8b168b9c50"}],"stats":{"total":11,"additions":10,"deletions":1},"files":[{"sha":"b641526592ad29ccc61eb924e4d5d9c2b9623f15","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/JDBCBrokerFactory.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/97aca65ddc006b3bd868faadc3893222b0609cd6/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/JDBCBrokerFactory.java","raw_url":"https://github.com/apache/openjpa/raw/97aca65ddc006b3bd868faadc3893222b0609cd6/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/JDBCBrokerFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/JDBCBrokerFactory.java?ref=97aca65ddc006b3bd868faadc3893222b0609cd6","patch":"@@ -86,6 +86,10 @@ public JDBCBrokerFactory(JDBCConfiguration conf) {\n         super(conf);\n     }\n \n+    public JDBCBrokerFactory(JDBCConfiguration conf, boolean earlyInit) {\n+        super(conf, earlyInit);\n+    }\n+    \n     public Map<String,Object> getProperties() {\n         // add platform property\n         Map<String,Object> props = super.getProperties();"},{"sha":"2cf1d319f023538555e900412c1d08940c6ac984","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/97aca65ddc006b3bd868faadc3893222b0609cd6/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java","raw_url":"https://github.com/apache/openjpa/raw/97aca65ddc006b3bd868faadc3893222b0609cd6/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java?ref=97aca65ddc006b3bd868faadc3893222b0609cd6","patch":"@@ -150,10 +150,13 @@ public static AbstractBrokerFactory getPooledFactoryForKey(Object key) {\n         return (AbstractBrokerFactory) _pool.get(key);\n     }\n \n+    protected AbstractBrokerFactory(OpenJPAConfiguration config) {\n+       this(config, true); \n+    }\n     /**\n      * Constructor. Configuration must be provided on construction.\n      */\n-    protected AbstractBrokerFactory(OpenJPAConfiguration config) {\n+    protected AbstractBrokerFactory(OpenJPAConfiguration config, boolean earlyInit) {\n         _conf = config;\n         _brokers = newBrokerSet();\n         getPcClassLoaders();\n@@ -164,6 +167,8 @@ protected AbstractBrokerFactory(OpenJPAConfiguration config) {\n                 _conf.getConnectionRetainModeConstant(), false).close(); \n         }\n \n+        if (!earlyInit)\n+            return;\n         // This eager metadata loading is invoked at construction. \n         // It can not happen during the MetaDataRepository configuration because \n         // within a container environment an uninitialized repository must be passed"}]}

