{"sha":"97b94f6aa90375ea6f39533144e4bf9477813a01","node_id":"MDY6Q29tbWl0MjA2MzY0Ojk3Yjk0ZjZhYTkwMzc1ZWE2ZjM5NTMzMTQ0ZTRiZjk0Nzc4MTNhMDE=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-08-02T03:51:38Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-08-02T03:51:38Z"},"message":"OPENJPA256 this class differs from most plugins in that the plugin type is the standard java interface Map.class (rather than an openjpa-specific interface), which means that the ClassLoader used to load the implementation will be the system class loader; this presents a problem if OpenJPA is not in the system classpath, so work around the problem by catching the IllegalArgumentException (which is what we wrap the ClassNotFoundException in) and try again, this time using this class' ClassLoader.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@562011 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"1aa2700a91560879b1417cdd2ef9228b4542c19e","url":"https://api.github.com/repos/apache/openjpa/git/trees/1aa2700a91560879b1417cdd2ef9228b4542c19e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/97b94f6aa90375ea6f39533144e4bf9477813a01","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/97b94f6aa90375ea6f39533144e4bf9477813a01","html_url":"https://github.com/apache/openjpa/commit/97b94f6aa90375ea6f39533144e4bf9477813a01","comments_url":"https://api.github.com/repos/apache/openjpa/commits/97b94f6aa90375ea6f39533144e4bf9477813a01/comments","author":null,"committer":null,"parents":[{"sha":"f61968f30255063c02971f041a0111e5dcf84220","url":"https://api.github.com/repos/apache/openjpa/commits/f61968f30255063c02971f041a0111e5dcf84220","html_url":"https://github.com/apache/openjpa/commit/f61968f30255063c02971f041a0111e5dcf84220"}],"stats":{"total":19,"additions":18,"deletions":1},"files":[{"sha":"bbaebdd82ea16d97bd4e6bfa07614c30370777c7","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/conf/QueryCompilationCacheValue.java","status":"modified","additions":18,"deletions":1,"changes":19,"blob_url":"https://github.com/apache/openjpa/blob/97b94f6aa90375ea6f39533144e4bf9477813a01/openjpa-kernel/src/main/java/org/apache/openjpa/conf/QueryCompilationCacheValue.java","raw_url":"https://github.com/apache/openjpa/raw/97b94f6aa90375ea6f39533144e4bf9477813a01/openjpa-kernel/src/main/java/org/apache/openjpa/conf/QueryCompilationCacheValue.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/conf/QueryCompilationCacheValue.java?ref=97b94f6aa90375ea6f39533144e4bf9477813a01","patch":"@@ -54,7 +54,24 @@ public QueryCompilationCacheValue(String prop) {\n     public Object newInstance(String clsName, Class type,\r\n         Configuration conf, boolean fatal) {\r\n         // make sure map handles concurrency\r\n-        Map map = (Map) super.newInstance(clsName, type, conf, fatal);\r\n+        Map map;\r\n+        \r\n+        try {\r\n+            map = (Map) super.newInstance(clsName, type, conf, fatal);\r\n+        } catch (IllegalArgumentException iae) {\r\n+            // OPENJPA256: this class differs from most plugins in that\r\n+            // the plugin type is the standard java interface Map.class (rather\r\n+            // than an openjpa-specific interface), which means that the\r\n+            // ClassLoader used to load the implementation will be the system\r\n+            // class loader; this presents a problem if OpenJPA is not in the\r\n+            // system classpath, so work around the problem by catching\r\n+            // the IllegalArgumentException (which is what we wrap the\r\n+            // ClassNotFoundException in) and try again, this time using\r\n+            // this class' ClassLoader.\r\n+            map = (Map) super.newInstance(clsName,\r\n+                QueryCompilationCacheValue.class, conf, fatal);\r\n+        }\r\n+\r\n         if (map != null && !(map instanceof Hashtable)\r\n             && !(map instanceof CacheMap)\r\n             && !(map instanceof ConcurrentMap))\r"}]}

