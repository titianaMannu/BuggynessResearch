{"sha":"99a69bef3315bc0434be8a54281b3f1802fbe6f8","node_id":"MDY6Q29tbWl0MjA2MzY0Ojk5YTY5YmVmMzMxNWJjMDQzNGJlOGE1NDI4MWIzZjE4MDJmYmU2Zjg=","commit":{"author":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-05-21T03:19:08Z"},"committer":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-05-21T03:19:08Z"},"message":"OPENJPA-605 Informix will throw an exception when a unique index is explictily created on the primary key columns\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@658542 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"12e7e2619e6392f0a753afc04defade98fbf8505","url":"https://api.github.com/repos/apache/openjpa/git/trees/12e7e2619e6392f0a753afc04defade98fbf8505"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/99a69bef3315bc0434be8a54281b3f1802fbe6f8","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/99a69bef3315bc0434be8a54281b3f1802fbe6f8","html_url":"https://github.com/apache/openjpa/commit/99a69bef3315bc0434be8a54281b3f1802fbe6f8","comments_url":"https://api.github.com/repos/apache/openjpa/commits/99a69bef3315bc0434be8a54281b3f1802fbe6f8/comments","author":null,"committer":null,"parents":[{"sha":"b3f87ba1ec0288c6b6dabf2c15c2a8c5c66f9cc9","url":"https://api.github.com/repos/apache/openjpa/commits/b3f87ba1ec0288c6b6dabf2c15c2a8c5c66f9cc9","html_url":"https://github.com/apache/openjpa/commit/b3f87ba1ec0288c6b6dabf2c15c2a8c5c66f9cc9"}],"stats":{"total":17,"additions":17,"deletions":0},"files":[{"sha":"85f71c8e3a388821bb57f43825b4fd110954182f","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/99a69bef3315bc0434be8a54281b3f1802fbe6f8/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java","raw_url":"https://github.com/apache/openjpa/raw/99a69bef3315bc0434be8a54281b3f1802fbe6f8/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java?ref=99a69bef3315bc0434be8a54281b3f1802fbe6f8","patch":"@@ -986,6 +986,23 @@ public boolean dropSequence(Sequence seq)\n      */\n     public boolean createIndex(Index idx, Table table)\n         throws SQLException {\n+        // Informix will automatically create a unique index for the \n+        // primary key, so don't create another index again\n+        if (_dict.platform.indexOf(\"Informix\") > -1) {\n+            Column[] cols = idx.getColumns();\n+            Column[] pkCols = table.getPrimaryKey().getColumns();\n+            if (cols.length == pkCols.length) {\n+                String[] colNames = new String[cols.length];\n+                String[] pkColNames = new String[cols.length];\n+                for (int i = 0; i < cols.length; i++) \n+                    colNames[i] = cols[i].getName();\n+                for (int i = 0; i < pkCols.length; i++) \n+                    pkColNames[i] = pkCols[i].getName();\n+                if (java.util.Arrays.equals(colNames, pkColNames))\n+                    return true;\n+            }\n+        }\n+\n         int max = _dict.maxIndexesPerTable;\n \n         int len = table.getIndexes().length;"}]}

