{"sha":"9af2df4d096a08955ed878f15654d0ca4c192cb2","node_id":"MDY6Q29tbWl0MjA2MzY0OjlhZjJkZjRkMDk2YTA4OTU1ZWQ4NzhmMTU2NTRkMGNhNGMxOTJjYjI=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-08-23T02:43:02Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-08-23T02:43:02Z"},"message":"Added generation of a /META-INF/revision.properties file that will hold the current subversion revision that was used when creating the jars; also made org.apache.openjpa.conf.OpenJPAVersion output this information when it is found\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@433850 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ba0d11be9fe24652b28d443bf748fcd94e6c094c","url":"https://api.github.com/repos/apache/openjpa/git/trees/ba0d11be9fe24652b28d443bf748fcd94e6c094c"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9af2df4d096a08955ed878f15654d0ca4c192cb2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9af2df4d096a08955ed878f15654d0ca4c192cb2","html_url":"https://github.com/apache/openjpa/commit/9af2df4d096a08955ed878f15654d0ca4c192cb2","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9af2df4d096a08955ed878f15654d0ca4c192cb2/comments","author":null,"committer":null,"parents":[{"sha":"9246ee92bcf12e0282905be4a1fdb8156c275664","url":"https://api.github.com/repos/apache/openjpa/commits/9246ee92bcf12e0282905be4a1fdb8156c275664","html_url":"https://github.com/apache/openjpa/commit/9246ee92bcf12e0282905be4a1fdb8156c275664"}],"stats":{"total":50,"additions":42,"deletions":8},"files":[{"sha":"9cc13f6ebd842d0c0c8da65e4ebcd6f9cffd234e","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAVersion.java","status":"modified","additions":25,"deletions":2,"changes":27,"blob_url":"https://github.com/apache/openjpa/blob/9af2df4d096a08955ed878f15654d0ca4c192cb2/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAVersion.java","raw_url":"https://github.com/apache/openjpa/raw/9af2df4d096a08955ed878f15654d0ca4c192cb2/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAVersion.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAVersion.java?ref=9af2df4d096a08955ed878f15654d0ca4c192cb2","patch":"@@ -16,7 +16,9 @@\n package org.apache.openjpa.conf;\n \n import java.io.File;\n+import java.io.InputStream;\n import java.util.Date;\n+import java.util.Properties;\n import java.util.StringTokenizer;\n \n /**\n@@ -39,6 +41,7 @@\n     public static final int MINOR_RELEASE;\n     public static final int PATCH_RELEASE;\n     public static final String RELEASE_STATUS;\n+    public static final int REVISION_NUMBER;\n \n     static {\n         Package pack = OpenJPAVersion.class.getPackage();\n@@ -47,7 +50,6 @@\n             vers = \"0.0.0\";\n \n         VERSION_NUMBER = vers;\n-        VERSION_ID = VERSION_NUMBER;\n \n         StringTokenizer tok = new StringTokenizer(VERSION_NUMBER, \".-\");\n \n@@ -71,10 +73,29 @@\n             patch = 0;\n         }\n \n+        int revision = 0;\n+        try {\n+            InputStream in = OpenJPAVersion.class.\n+                getResourceAsStream(\"/META-INF/revision.properties\");\n+            if (in != null) {\n+                try {\n+                    Properties props = new Properties();\n+                    props.load(in);\n+                    revision = Integer.parseInt\n+                        (props.getProperty(\"revision.number\"));\n+                } finally {\n+                    in.close();\n+                }\n+            }\n+        } catch (Exception e) {\n+        }\n+\n         MAJOR_RELEASE = major;\n         MINOR_RELEASE = minor;\n         PATCH_RELEASE = patch;\n         RELEASE_STATUS = tok.hasMoreTokens() ? tok.nextToken(\"!\") : \"\";\n+        REVISION_NUMBER = revision;\n+        VERSION_ID = VERSION_NUMBER + \"-r\" + REVISION_NUMBER;\n     }\n \n     public static void main(String [] args) {\n@@ -83,10 +104,12 @@ public static void main(String [] args) {\n \n     public String toString() {\n         StringBuffer buf = new StringBuffer(80 * 30);\n-        buf.append(\"OpenJPA\");\n+        buf.append(\"OpenJPA \");\n         buf.append(VERSION_NUMBER);\n         buf.append(\"\\n\");\n         buf.append(\"version id: \").append(VERSION_ID);\n+        buf.append(\"\\n\");\n+        buf.append(\"revision: \").append(REVISION_NUMBER);\n         buf.append(\"\\n\\n\");\n \n         getProperty(\"os.name\", buf).append(\"\\n\");"},{"sha":"7554cae0793a6b85debdbdd2cedeb0966c0de211","filename":"pom.xml","status":"modified","additions":17,"deletions":6,"changes":23,"blob_url":"https://github.com/apache/openjpa/blob/9af2df4d096a08955ed878f15654d0ca4c192cb2/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/9af2df4d096a08955ed878f15654d0ca4c192cb2/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/pom.xml?ref=9af2df4d096a08955ed878f15654d0ca4c192cb2","patch":"@@ -161,23 +161,35 @@\n             </plugin>\n             <!--\n                 get the svn revision number and set it in the\n-                project.revision setting - disabled for now\n+                subversion.revision setting - disabled for now\n                 since we need to be able to build from sources\n                 zip (when there is no .svn/ metadata)\n             -->\n-            <!--\n             <plugin>\n                 <artifactId>maven-antrun-plugin</artifactId>\n                 <executions>\n                     <execution>\n-                        <phase>compile</phase>\n+                        <id>set subversion revision</id>\n+                        <phase>package</phase>\n                         <configuration>\n                             <tasks>\n+                                <property name=\"tmpdir\"\n+                                    value=\"${java.io.tmpdir}/openjpamvntmp\"/>\n+                                <condition property=\"outdir\"\n+                                    value=\"${project.build.outputDirectory}\">\n+                                    <available type=\"dir\"\n+                                    file=\"${project.build.outputDirectory}\"/>\n+                                </condition>\n+\n+                                <property name=\"outdir\" value=\"${tmpdir}\"/>\n+\n                                 <xmlproperty file=\"${basedir}/.svn/entries\"\n                                     collapseAttributes=\"true\"/>\n-                                <property name=\"project.revision\"\n+                                <property name=\"subversion.revision\"\n                                     value=\"${wc-entries.entry.revision}\"/>\n-                                <echo>Revision: ${project.revision}</echo>\n+                                <mkdir dir=\"${outdir}/META-INF\"/>\n+                                <echo file=\"${outdir}/META-INF/revision.properties\">revision.number=${subversion.revision}</echo>\n+                                <delete dir=\"${tmpdir}\"/>\n                             </tasks>\n                         </configuration>\n                         <goals>\n@@ -186,7 +198,6 @@\n                     </execution>\n                 </executions>\n             </plugin>\n-            -->\n         </plugins>\n     </build>\n     <reporting>"}]}

