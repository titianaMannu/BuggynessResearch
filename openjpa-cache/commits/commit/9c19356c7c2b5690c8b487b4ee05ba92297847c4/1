{"sha":"9c19356c7c2b5690c8b487b4ee05ba92297847c4","node_id":"MDY6Q29tbWl0MjA2MzY0OjljMTkzNTZjN2MyYjU2OTBjOGI0ODdiNGVlMDViYTkyMjk3ODQ3YzQ=","commit":{"author":{"name":"A. Abram White","email":"awhite@apache.org","date":"2008-04-07T16:18:26Z"},"committer":{"name":"A. Abram White","email":"awhite@apache.org","date":"2008-04-07T16:18:26Z"},"message":"Fix for OPENJPA-554.\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@645589 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"77261e47f4dd80555096b478d8cfe978f7bf80fc","url":"https://api.github.com/repos/apache/openjpa/git/trees/77261e47f4dd80555096b478d8cfe978f7bf80fc"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9c19356c7c2b5690c8b487b4ee05ba92297847c4","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9c19356c7c2b5690c8b487b4ee05ba92297847c4","html_url":"https://github.com/apache/openjpa/commit/9c19356c7c2b5690c8b487b4ee05ba92297847c4","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9c19356c7c2b5690c8b487b4ee05ba92297847c4/comments","author":null,"committer":null,"parents":[{"sha":"1b5aac791d776726ada8fdc6b39ec71d13262f3e","url":"https://api.github.com/repos/apache/openjpa/commits/1b5aac791d776726ada8fdc6b39ec71d13262f3e","html_url":"https://github.com/apache/openjpa/commit/1b5aac791d776726ada8fdc6b39ec71d13262f3e"}],"stats":{"total":13,"additions":9,"deletions":4},"files":[{"sha":"a47794298025826ae84f2f42e893488aa257d9bc","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/GetMapValue.java","status":"modified","additions":6,"deletions":3,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/9c19356c7c2b5690c8b487b4ee05ba92297847c4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/GetMapValue.java","raw_url":"https://github.com/apache/openjpa/raw/9c19356c7c2b5690c8b487b4ee05ba92297847c4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/GetMapValue.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/GetMapValue.java?ref=9c19356c7c2b5690c8b487b4ee05ba92297847c4","patch":"@@ -45,15 +45,17 @@\n \n     private final Val _map;\n     private final Val _key;\n+    private final String _alias;\n     private ClassMetaData _meta = null;\n     private Class _cast = null;\n \n     /**\n      * Constructor. Provide the map and key to operate on.\n      */\n-    public GetMapValue(Val map, Val key) {\n+    public GetMapValue(Val map, Val key, String alias) {\n         _map = map;\n         _key = key;\n+        _alias = alias;\n     }\n \n     public ClassMetaData getMetaData() {\n@@ -111,7 +113,8 @@ public Object toDataStoreValue(Select sel, ExpContext ctx, ExpState state,\n \n     public void select(Select sel, ExpContext ctx, ExpState state, \n         boolean pks) {\n-        sel.select(newSQLBuffer(sel, ctx, state), this);\n+        sel.select(newSQLBuffer(sel, ctx, state).append(\" AS \").append(_alias),\n+            this);\n     }\n \n     public void selectColumns(Select sel, ExpContext ctx, ExpState state,\n@@ -127,7 +130,7 @@ public void groupBy(Select sel, ExpContext ctx, ExpState state) {\n \n     public void orderBy(Select sel, ExpContext ctx, ExpState state, \n         boolean asc) {\n-        sel.orderBy(newSQLBuffer(sel, ctx, state), asc, false);\n+        sel.orderBy(_alias, asc, false);\n     }\n \n     private SQLBuffer newSQLBuffer(Select sel, ExpContext ctx, ExpState state) {"},{"sha":"d3f760a1839bc9f01d337b4b1de7da2e3b3b2800","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/9c19356c7c2b5690c8b487b4ee05ba92297847c4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java","raw_url":"https://github.com/apache/openjpa/raw/9c19356c7c2b5690c8b487b4ee05ba92297847c4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/JDBCExpressionFactory.java?ref=9c19356c7c2b5690c8b487b4ee05ba92297847c4","patch":"@@ -58,6 +58,7 @@\n \n     private final ClassMapping _type;\n     private final SelectConstructor _cons = new SelectConstructor();\n+    private int _getMapValueAlias = 0;\n \n     /**\n      * Constructor. Supply the type we're querying against.\n@@ -396,6 +397,7 @@ public Value getObjectId(Value val) {\n     }\n \n     public Value getMapValue(Value map, Value arg) {\n-        return new GetMapValue((Val) map, (Val) arg);\n+        return new GetMapValue((Val) map, (Val) arg, \n+            \"gmv\" + _getMapValueAlias++);\n     }\n }"}]}

