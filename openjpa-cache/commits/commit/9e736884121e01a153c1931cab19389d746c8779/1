{"sha":"9e736884121e01a153c1931cab19389d746c8779","node_id":"MDY6Q29tbWl0MjA2MzY0OjllNzM2ODg0MTIxZTAxYTE1M2MxOTMxY2FiMTkzODlkNzQ2Yzg3Nzk=","commit":{"author":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2010-01-19T22:33:11Z"},"committer":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2010-01-19T22:33:11Z"},"message":"OPENJPA-1115 Eliminate alias conversion on configurations that do not require conversion.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@900985 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"eba90f8787e3b0cbe9abc4508c7bc6b58f9ad597","url":"https://api.github.com/repos/apache/openjpa/git/trees/eba90f8787e3b0cbe9abc4508c7bc6b58f9ad597"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9e736884121e01a153c1931cab19389d746c8779","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9e736884121e01a153c1931cab19389d746c8779","html_url":"https://github.com/apache/openjpa/commit/9e736884121e01a153c1931cab19389d746c8779","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9e736884121e01a153c1931cab19389d746c8779/comments","author":null,"committer":null,"parents":[{"sha":"245bb82d34f2ca92f96aa77c0784008745d13852","url":"https://api.github.com/repos/apache/openjpa/commits/245bb82d34f2ca92f96aa77c0784008745d13852","html_url":"https://github.com/apache/openjpa/commit/245bb82d34f2ca92f96aa77c0784008745d13852"}],"stats":{"total":45,"additions":39,"deletions":6},"files":[{"sha":"764b31dfa911e4ca5b5c8abdc1ab7a0509100cea","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DBIdentifierUtilImpl.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DBIdentifierUtilImpl.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DBIdentifierUtilImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DBIdentifierUtilImpl.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -419,6 +419,10 @@ else if (CASE_LOWER.equals(delimCase)) {\n      * Converts a column alias to use the appropriate delimiters\n      */\n     public String convertAlias(String alias) {\n+        if (!needsConversion(getIdentifierConfiguration())) {\n+            return alias;\n+        }\n+\n         String[] names = Normalizer.splitName(alias);\n         if (names.length <= 1) {\n             // Nothing to split"},{"sha":"3c6a7688003b10c6f2aab0dcf22c7e068d480198","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DefaultIdentifierConfiguration.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DefaultIdentifierConfiguration.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DefaultIdentifierConfiguration.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/identifier/DefaultIdentifierConfiguration.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -29,6 +29,7 @@\n \n     private DBIdentifierRule normalizingRule = new DBIdentifierRule();\n     private Map<String, IdentifierRule> normalizingRules = new HashMap<String, IdentifierRule>();\n+    private final String conversionKey = getLeadingDelimiter() + getIdentifierDelimiter() + getTrailingDelimiter();\n \n     public DefaultIdentifierConfiguration() {\n         normalizingRules.put(IdentifierRule.DEFAULT_RULE, normalizingRule);\n@@ -78,4 +79,8 @@ public String getTrailingDelimiter() {\n     public boolean getSupportsDelimitedIdentifiers() {\n         return true;\n     }\n+    \n+    public String getConversionKey() {\n+        return conversionKey;\n+    }\n }"},{"sha":"c9f6daa2f8d7d3c931aa8560f476370a4e1aacc8","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -373,6 +373,7 @@\n     public String delimitedCase = SCHEMA_CASE_PRESERVE;\n     public String catalogSeparator = \".\";\n     private String defaultSchemaName = null;\n+    private String conversionKey = null;\n        \n     // Naming utility and naming rules\n     private DBIdentifierUtil namingUtil = null;\n@@ -5361,4 +5362,12 @@ public void setDefaultSchemaName(String defaultSchemaName) {\n     public String getDefaultSchemaName() {\n         return defaultSchemaName;\n     }\n+    \n+    public String getConversionKey() {\n+        if (conversionKey == null) {\n+            conversionKey = getLeadingDelimiter() + getIdentifierDelimiter() +\n+            getTrailingDelimiter();\n+        }\n+        return conversionKey;\n+    }\n }"},{"sha":"2ec646b001efdbdebdd3f5c65f09c7ad58baa756","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierConfiguration.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierConfiguration.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierConfiguration.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierConfiguration.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -86,4 +86,13 @@\n      * @return upper, lower, or preserve\n      */\n     public String getSchemaCase();\n+    \n+    /**\n+     * Returns a key that can be used to determine whether conversion\n+     * should take place.  Id configurations should create a key unique\n+     * to their configuration.  The typical key is:\n+     * leading delimiter (\") + name separator(.) + trailing delimiter(\")\n+     * @return\n+     */\n+    public String getConversionKey();\n }"},{"sha":"33be3a0ee6e6bcb56acdcfb00cab9c677b50345f","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierUtilImpl.java","status":"modified","additions":2,"deletions":4,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierUtilImpl.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierUtilImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/identifier/IdentifierUtilImpl.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -503,10 +503,8 @@ public String combineFull(IdentifierConfiguration config, String rule, String fu\n     }    \n \n \n-    private boolean needsConversion(IdentifierConfiguration config) {\n-        return !(config.getLeadingDelimiter().equals(getIdentifierConfiguration().getLeadingDelimiter()) &&\n-                 config.getTrailingDelimiter().equals(getIdentifierConfiguration().getTrailingDelimiter()) &&\n-                 config.getIdentifierDelimiter().equals(getIdentifierConfiguration().getIdentifierDelimiter()));\n+    protected boolean needsConversion(IdentifierConfiguration config) {\n+        return !(config.getConversionKey().equals(getIdentifierConfiguration().getConversionKey()));\n     }\n \n     private IdentifierRule[] getNamingRules(String[] rules) {"},{"sha":"d41a801b61cecd9a746d97aedc471f46ee34d56a","filename":"openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/IdConfigurationTestImpl.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/IdConfigurationTestImpl.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/IdConfigurationTestImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/IdConfigurationTestImpl.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -28,7 +28,8 @@\n public class IdConfigurationTestImpl implements IdentifierConfiguration {\n \n     Map<String, IdentifierRule> _rules = new HashMap<String, IdentifierRule>();\n-    \n+    private final String conversionKey = getLeadingDelimiter() + getIdentifierDelimiter() + getTrailingDelimiter();\n+\n     public IdConfigurationTestImpl() {\n         _rules.put(\"DEFAULT\", _defRule);\n     }\n@@ -84,4 +85,7 @@ public boolean getSupportsDelimitedIdentifiers() {\n         return true;\n     }\n \n+    public String getConversionKey() {\n+        return conversionKey;\n+    }\n }"},{"sha":"3f523ca15fdd042a34c8e3c67409a73a6ff349f1","filename":"openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/NewIdConfigurationTestImpl.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/NewIdConfigurationTestImpl.java","raw_url":"https://github.com/apache/openjpa/raw/9e736884121e01a153c1931cab19389d746c8779/openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/NewIdConfigurationTestImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/test/java/org/apache/openjpa/lib/identifier/NewIdConfigurationTestImpl.java?ref=9e736884121e01a153c1931cab19389d746c8779","patch":"@@ -28,7 +28,8 @@\n public class NewIdConfigurationTestImpl implements IdentifierConfiguration {\n \n     Map<String, IdentifierRule> _rules = new HashMap<String, IdentifierRule>();\n-    \n+    private final String conversionKey = getLeadingDelimiter() + getIdentifierDelimiter() + getTrailingDelimiter();\n+\n     public NewIdConfigurationTestImpl() {\n         _rules.put(\"DEFAULT\", _defRule);\n     }\n@@ -84,4 +85,7 @@ public boolean getSupportsDelimitedIdentifiers() {\n         return true;\n     }\n \n+    public String getConversionKey() {\n+        return conversionKey;\n+    }\n }"}]}

