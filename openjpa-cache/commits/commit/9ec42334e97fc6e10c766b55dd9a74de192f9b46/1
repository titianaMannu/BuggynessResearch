{"sha":"9ec42334e97fc6e10c766b55dd9a74de192f9b46","node_id":"MDY6Q29tbWl0MjA2MzY0OjllYzQyMzM0ZTk3ZmM2ZTEwYzc2NmI1NWRkOWE3NGRlMTkyZjliNDY=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-02-19T03:10:33Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-02-19T03:10:33Z"},"message":"OPENJPA-1512 minor updates to BundleActivator support\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@911684 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a2bf665be0883e92bc6a35dca3467c0a6845a4a9","url":"https://api.github.com/repos/apache/openjpa/git/trees/a2bf665be0883e92bc6a35dca3467c0a6845a4a9"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9ec42334e97fc6e10c766b55dd9a74de192f9b46","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9ec42334e97fc6e10c766b55dd9a74de192f9b46","html_url":"https://github.com/apache/openjpa/commit/9ec42334e97fc6e10c766b55dd9a74de192f9b46","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9ec42334e97fc6e10c766b55dd9a74de192f9b46/comments","author":null,"committer":null,"parents":[{"sha":"e512e15ba03eb735f8ddc374969cafe4555c7143","url":"https://api.github.com/repos/apache/openjpa/commits/e512e15ba03eb735f8ddc374969cafe4555c7143","html_url":"https://github.com/apache/openjpa/commit/e512e15ba03eb735f8ddc374969cafe4555c7143"}],"stats":{"total":15,"additions":9,"deletions":6},"files":[{"sha":"1ab99effe953bfa63475197a6b3795f769182308","filename":"openjpa/src/main/java/org/apache/openjpa/osgi/PersistenceActivator.java","status":"modified","additions":9,"deletions":6,"changes":15,"blob_url":"https://github.com/apache/openjpa/blob/9ec42334e97fc6e10c766b55dd9a74de192f9b46/openjpa/src/main/java/org/apache/openjpa/osgi/PersistenceActivator.java","raw_url":"https://github.com/apache/openjpa/raw/9ec42334e97fc6e10c766b55dd9a74de192f9b46/openjpa/src/main/java/org/apache/openjpa/osgi/PersistenceActivator.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa/src/main/java/org/apache/openjpa/osgi/PersistenceActivator.java?ref=9ec42334e97fc6e10c766b55dd9a74de192f9b46","patch":"@@ -23,6 +23,7 @@\n import org.apache.openjpa.persistence.PersistenceProviderImpl;\n import org.osgi.framework.BundleActivator;\n import org.osgi.framework.BundleContext;\n+import org.osgi.framework.ServiceRegistration;\n \n \n /**\n@@ -36,24 +37,26 @@\n     // following would be set by Aries to expose their OSGi enabled provider\n     public static final String PERSISTENCE_PROVIDER = PersistenceProvider.class.getName();\n     public static final String OSGI_PERSISTENCE_PROVIDER = PersistenceProviderImpl.class.getName();\n-    private static BundleContext ctx;\n+    private ServiceRegistration svcReg = null;\n \n     /* (non-Javadoc)\n      * @see org.osgi.framework.BundleActivator#start(org.osgi.framework.BundleContext)\n      */\n-    public void start(BundleContext arg0) throws Exception {\n-        ctx = arg0;\n+    public void start(BundleContext ctx) throws Exception {\n         PersistenceProvider provider = new PersistenceProviderImpl();\n         Hashtable<String, String> props = new Hashtable<String, String>();\n         props.put(PERSISTENCE_PROVIDER_ARIES, OSGI_PERSISTENCE_PROVIDER);\n-        ctx.registerService(PERSISTENCE_PROVIDER, provider, props);\n+        svcReg = ctx.registerService(PERSISTENCE_PROVIDER, provider, props);\n     }\n \n     /* (non-Javadoc)\n      * @see org.osgi.framework.BundleActivator#stop(org.osgi.framework.BundleContext)\n      */\n-    public void stop(BundleContext arg0) throws Exception {\n-        // no-op\n+    public void stop(BundleContext ctx) throws Exception {\n+        if (svcReg != null) {\n+            svcReg.unregister();\n+            svcReg = null;\n+        }\n     }\n \n }"}]}

