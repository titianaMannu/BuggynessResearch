{"sha":"9ee5383721d40820f36cfbc30618b8a56e9b348b","node_id":"MDY6Q29tbWl0MjA2MzY0OjllZTUzODM3MjFkNDA4MjBmMzZjZmJjMzA2MThiOGE1NmU5YjM0OGI=","commit":{"author":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-07-06T19:06:19Z"},"committer":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-07-06T19:06:19Z"},"message":"OPENJPA-1155 Committing code contributed by Dianne Richards.  This update ensures that all entities, especially those loaded during detachment get cascaded during detach.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@791568 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"0a045e4025c7646dc0057c8a0e95dc5b18efefa4","url":"https://api.github.com/repos/apache/openjpa/git/trees/0a045e4025c7646dc0057c8a0e95dc5b18efefa4"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9ee5383721d40820f36cfbc30618b8a56e9b348b","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9ee5383721d40820f36cfbc30618b8a56e9b348b","html_url":"https://github.com/apache/openjpa/commit/9ee5383721d40820f36cfbc30618b8a56e9b348b","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9ee5383721d40820f36cfbc30618b8a56e9b348b/comments","author":null,"committer":null,"parents":[{"sha":"10bd4e70de8de17ec165e1103fce62b6ae8c33ea","url":"https://api.github.com/repos/apache/openjpa/commits/10bd4e70de8de17ec165e1103fce62b6ae8c33ea","html_url":"https://github.com/apache/openjpa/commit/10bd4e70de8de17ec165e1103fce62b6ae8c33ea"}],"stats":{"total":13,"additions":11,"deletions":2},"files":[{"sha":"2ab7e6b0d687cd8efbcc8ca2e52a4e3ebb53dc7d","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","status":"modified","additions":11,"deletions":2,"changes":13,"blob_url":"https://github.com/apache/openjpa/blob/9ee5383721d40820f36cfbc30618b8a56e9b348b/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/9ee5383721d40820f36cfbc30618b8a56e9b348b/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java?ref=9ee5383721d40820f36cfbc30618b8a56e9b348b","patch":"@@ -3321,8 +3321,17 @@ else if (!sm.getMetaData().isDetachable()) {\n \n         if (call == null)\n             call = _call;\n-        new DetachManager(this, true, call).detachAll\n-            (new ManagedObjectCollection(states));\n+        // Make sure ALL entities are detached, even new ones that are loaded\n+        // during the detach processing\n+        boolean origCascade = _compat.getCascadeWithDetach();\n+        _compat.setCascadeWithDetach(true);        \n+        try {\n+            new DetachManager(this, true, call)\n+                .detachAll(new ManagedObjectCollection(states));\n+        } \n+        finally {\n+            _compat.setCascadeWithDetach(origCascade);\n+        }\n     }\n \n     public Object attach(Object obj, boolean copyNew, OpCallbacks call) {"}]}

