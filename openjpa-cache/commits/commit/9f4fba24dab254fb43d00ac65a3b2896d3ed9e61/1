{"sha":"9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","node_id":"MDY6Q29tbWl0MjA2MzY0OjlmNGZiYTI0ZGFiMjU0ZmI0M2QwMGFjNjVhM2IyODk2ZDNlZDllNjE=","commit":{"author":{"name":"Mark Struberg","email":"struberg@apache.org","date":"2011-12-27T10:59:45Z"},"committer":{"name":"Mark Struberg","email":"struberg@apache.org","date":"2011-12-27T10:59:45Z"},"message":"OPENJPA-2100 fix filterPersistenceCapable \n\nFixing a bug which got introduced in r1091279 and caused entities\nwhich contained enums to be broken.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1224892 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"dd27e770f597323ae66841102a83181bd7ac72de","url":"https://api.github.com/repos/apache/openjpa/git/trees/dd27e770f597323ae66841102a83181bd7ac72de"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","html_url":"https://github.com/apache/openjpa/commit/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","comments_url":"https://api.github.com/repos/apache/openjpa/commits/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/comments","author":{"login":"struberg","id":79310,"node_id":"MDQ6VXNlcjc5MzEw","avatar_url":"https://avatars.githubusercontent.com/u/79310?v=4","gravatar_id":"","url":"https://api.github.com/users/struberg","html_url":"https://github.com/struberg","followers_url":"https://api.github.com/users/struberg/followers","following_url":"https://api.github.com/users/struberg/following{/other_user}","gists_url":"https://api.github.com/users/struberg/gists{/gist_id}","starred_url":"https://api.github.com/users/struberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/struberg/subscriptions","organizations_url":"https://api.github.com/users/struberg/orgs","repos_url":"https://api.github.com/users/struberg/repos","events_url":"https://api.github.com/users/struberg/events{/privacy}","received_events_url":"https://api.github.com/users/struberg/received_events","type":"User","site_admin":false},"committer":{"login":"struberg","id":79310,"node_id":"MDQ6VXNlcjc5MzEw","avatar_url":"https://avatars.githubusercontent.com/u/79310?v=4","gravatar_id":"","url":"https://api.github.com/users/struberg","html_url":"https://github.com/struberg","followers_url":"https://api.github.com/users/struberg/followers","following_url":"https://api.github.com/users/struberg/following{/other_user}","gists_url":"https://api.github.com/users/struberg/gists{/gist_id}","starred_url":"https://api.github.com/users/struberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/struberg/subscriptions","organizations_url":"https://api.github.com/users/struberg/orgs","repos_url":"https://api.github.com/users/struberg/repos","events_url":"https://api.github.com/users/struberg/events{/privacy}","received_events_url":"https://api.github.com/users/struberg/received_events","type":"User","site_admin":false},"parents":[{"sha":"14d8109f9581045e1efdc347601209baedc2d5b5","url":"https://api.github.com/repos/apache/openjpa/commits/14d8109f9581045e1efdc347601209baedc2d5b5","html_url":"https://github.com/apache/openjpa/commit/14d8109f9581045e1efdc347601209baedc2d5b5"}],"stats":{"total":85,"additions":57,"deletions":28},"files":[{"sha":"2928307a19ebe80a11e4c3f351d9c03c010d015c","filename":"openjpa-tools/openjpa-maven-plugin/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-tools/openjpa-maven-plugin/pom.xml?ref=9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","patch":"@@ -115,6 +115,10 @@\n             <groupId>org.apache.geronimo.specs</groupId>\n             <artifactId>geronimo-validation_1.0_spec</artifactId>\n         </dependency>\n+        <dependency>\n+            <groupId>org.apache.bval</groupId>\n+            <artifactId>org.apache.bval.bundle</artifactId>\n+        </dependency>\n         <dependency>\n             <groupId>log4j</groupId>\n             <artifactId>log4j</artifactId>"},{"sha":"6d3d9148788712f5b97e77791b8a68f9b951349f","filename":"openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/main/java/org/apache/openjpa/tools/maven/testentity/TestEntity.java","status":"modified","additions":42,"deletions":24,"changes":66,"blob_url":"https://github.com/apache/openjpa/blob/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/main/java/org/apache/openjpa/tools/maven/testentity/TestEntity.java","raw_url":"https://github.com/apache/openjpa/raw/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/main/java/org/apache/openjpa/tools/maven/testentity/TestEntity.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/main/java/org/apache/openjpa/tools/maven/testentity/TestEntity.java?ref=9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","patch":"@@ -20,42 +20,60 @@\n \n import javax.persistence.Entity;\n import javax.persistence.Id;\n+import javax.persistence.Enumerated;\n+import javax.persistence.EnumType;\n \n \n @Entity\n public class TestEntity {\n \n-  @Id\n-  private int xint1;\n+    @Id\n+    private int xint1;\n \n-  private String string1;\n+    private String string1;\n \n-  protected TestEntity() {\n-  }\n+    public enum SampleEnum {\n+        Option1, Option2, Option3\n+    }\n \n-  public TestEntity(int int1, String string1) {\n-    this.xint1 = int1;\n-    this.string1 = string1;\n-  }\n+    @Enumerated(EnumType.STRING)\n+    private SampleEnum myEnum;\n \n-  public int getInt1() {\n-    return xint1;\n-  }\n \n-  public void setInt1(int int1) {\n-    this.xint1 = int1;\n-  }\n+    protected TestEntity() {\n+    }\n \n-  public String getString1() {\n-    return string1;\n-  }\n+    public TestEntity(int int1, String string1) {\n+        this.xint1 = int1;\n+        this.string1 = string1;\n+    }\n \n-  public void setString1(String string1) {\n-    this.string1 = string1;\n-  }\n+    public int getInt1() {\n+        return xint1;\n+    }\n \n-  public String toString()  {\n-    return xint1 + \":\" + string1;\n-  }\n+    public void setInt1(int int1) {\n+        this.xint1 = int1;\n+    }\n+\n+    public String getString1() {\n+        return string1;\n+    }\n+\n+    public void setString1(String string1) {\n+        this.string1 = string1;\n+    }\n+\n+    public String toString()  {\n+        return xint1 + \":\" + string1;\n+    }\n+\n+    public SampleEnum getMyEnum() {\n+        return myEnum;\n+    }\n+\n+    public void setMyEnum(SampleEnum myEnum) {\n+        this.myEnum = myEnum;\n+    }\n \n }"},{"sha":"a2fc0a6763d14412eaa17cf1e66ceb96232e6372","filename":"openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/java/org/apache/openjpa/tools/maven/test/ItDefaultSettingsTest.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/java/org/apache/openjpa/tools/maven/test/ItDefaultSettingsTest.java","raw_url":"https://github.com/apache/openjpa/raw/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/java/org/apache/openjpa/tools/maven/test/ItDefaultSettingsTest.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/java/org/apache/openjpa/tools/maven/test/ItDefaultSettingsTest.java?ref=9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","patch":"@@ -43,7 +43,8 @@\n     private final static String SQL_FILE = \"database.sql\";\n     \n     /** if the SQL generation has been successful, the following result should be in the SQL file */\n-    private final static String VALID_SQL = \"CREATE TABLE TestEntity (xint1 INTEGER NOT NULL, string1 VARCHAR(255), PRIMARY KEY (xint1));\";\n+    private final static String VALID_SQL = \"CREATE TABLE TestEntity (xint1 INTEGER NOT NULL, myEnum VARCHAR(20), \"\n+                                            + \"string1 VARCHAR(255), PRIMARY KEY (xint1));\";\n     \n     private final static String TEST_ENTITY_CLASS = \"org.apache.openjpa.tools.maven.testentity.TestEntity\";\n "},{"sha":"0ae75b587bc031dd9108ee04c3878c795591f567","filename":"openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/resources/reference_schema.orig_xml","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/resources/reference_schema.orig_xml","raw_url":"https://github.com/apache/openjpa/raw/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/resources/reference_schema.orig_xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-tools/openjpa-maven-plugin/src/it/default_settings/src/test/resources/reference_schema.orig_xml?ref=9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","patch":"@@ -4,7 +4,8 @@\n         <table name=\"TestEntity\">\n             <pk column=\"xint1\"/>\n             <column name=\"xint1\" type=\"integer\" not-null=\"true\"/>\n+            <column name=\"myEnum\" type=\"varchar\" size=\"20\"/>\n             <column name=\"string1\" type=\"varchar\" size=\"255\"/>\n         </table>\n     </schema>\n-</schemas>\n\\ No newline at end of file\n+</schemas>"},{"sha":"0263972763a3cdcba9b128421ca80d5bd6ecb34c","filename":"openjpa-tools/openjpa-maven-plugin/src/main/java/org/apache/openjpa/tools/maven/AbstractOpenJpaMappingToolMojo.java","status":"modified","additions":7,"deletions":2,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/main/java/org/apache/openjpa/tools/maven/AbstractOpenJpaMappingToolMojo.java","raw_url":"https://github.com/apache/openjpa/raw/9f4fba24dab254fb43d00ac65a3b2896d3ed9e61/openjpa-tools/openjpa-maven-plugin/src/main/java/org/apache/openjpa/tools/maven/AbstractOpenJpaMappingToolMojo.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-tools/openjpa-maven-plugin/src/main/java/org/apache/openjpa/tools/maven/AbstractOpenJpaMappingToolMojo.java?ref=9f4fba24dab254fb43d00ac65a3b2896d3ed9e61","patch":"@@ -22,6 +22,7 @@\n import java.io.File;\n import java.io.IOException;\n import java.sql.SQLException;\n+import java.util.Iterator;\n import java.util.List;\n \n import javax.persistence.Entity;\n@@ -130,8 +131,11 @@ private void filterPersistenceCapable(List<File> files, Options opts) {\n         MetaDataRepository repo = conf.newMetaDataRepositoryInstance();\n         ClassArgParser cap = repo.getMetaDataFactory().newClassArgParser();\n \n-        for(File classPath : files) { \n-            Class<?>[] classes = cap.parseTypes(classPath.getAbsolutePath());\n+        Iterator<File> fileIt = files.iterator();\n+        while (fileIt.hasNext()) {\n+            File classPath = fileIt.next();\n+\n+            Class[] classes = cap.parseTypes(classPath.getAbsolutePath());\n \n             if (classes == null) {\n                 getLog().info(\"Found no classes for \" + classPath.getAbsolutePath());\n@@ -146,6 +150,7 @@ private void filterPersistenceCapable(List<File> files, Options opts) {\n                                 + PersistenceCapable.class.getName());\n                     } else {\n                         getLog().debug(\"Removing non-entity class \" + classPath);\n+                        fileIt.remove();\n                     }\n                 }\n             }"}]}

