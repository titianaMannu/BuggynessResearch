{"sha":"a0e342833b93eda1c06965eb7dc206a215071e15","node_id":"MDY6Q29tbWl0MjA2MzY0OmEwZTM0MjgzM2I5M2VkYTFjMDY5NjVlYjdkYzIwNmEyMTUwNzFlMTU=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-04-08T20:05:54Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-04-08T20:05:54Z"},"message":"OPENJPA-1616 Exclude TestTimeoutException tests on HSQLDB as it uses supportsSelectForUpdate=false\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/2.0.x@932085 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7e8a45baf6ba726f4484a97128b4f50741bf9f07","url":"https://api.github.com/repos/apache/openjpa/git/trees/7e8a45baf6ba726f4484a97128b4f50741bf9f07"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/a0e342833b93eda1c06965eb7dc206a215071e15","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/a0e342833b93eda1c06965eb7dc206a215071e15","html_url":"https://github.com/apache/openjpa/commit/a0e342833b93eda1c06965eb7dc206a215071e15","comments_url":"https://api.github.com/repos/apache/openjpa/commits/a0e342833b93eda1c06965eb7dc206a215071e15/comments","author":null,"committer":null,"parents":[{"sha":"05a73cdf95dc59eef022871738424489d7801f4c","url":"https://api.github.com/repos/apache/openjpa/commits/05a73cdf95dc59eef022871738424489d7801f4c","html_url":"https://github.com/apache/openjpa/commit/05a73cdf95dc59eef022871738424489d7801f4c"}],"stats":{"total":21,"additions":19,"deletions":2},"files":[{"sha":"f2cc56b3c7da6ba9c5a37c19adae443e8cfbab8b","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestTimeoutException.java","status":"modified","additions":19,"deletions":2,"changes":21,"blob_url":"https://github.com/apache/openjpa/blob/a0e342833b93eda1c06965eb7dc206a215071e15/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestTimeoutException.java","raw_url":"https://github.com/apache/openjpa/raw/a0e342833b93eda1c06965eb7dc206a215071e15/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestTimeoutException.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestTimeoutException.java?ref=a0e342833b93eda1c06965eb7dc206a215071e15","patch":"@@ -24,10 +24,11 @@\n import javax.persistence.Query;\n import javax.persistence.QueryTimeoutException;\n \n-import junit.framework.AssertionFailedError;\n-\n+import org.apache.openjpa.jdbc.conf.JDBCConfiguration;\n import org.apache.openjpa.jdbc.sql.DB2Dictionary;\n+import org.apache.openjpa.jdbc.sql.DBDictionary;\n import org.apache.openjpa.jdbc.sql.OracleDictionary;\n+import org.apache.openjpa.persistence.OpenJPAEntityManagerFactorySPI;\n import org.apache.openjpa.persistence.exception.PObject;\n import org.apache.openjpa.persistence.test.SingleEMFTestCase;\n import org.apache.openjpa.util.OpenJPAException;\n@@ -42,7 +43,23 @@\n     private final Class<?> entityClass = PObject.class;\n \n     public void setUp() {\n+        // TODO - Hack until OPENJPA-1594 is addressed\n         setUnsupportedDatabases(OracleDictionary.class, DB2Dictionary.class);\n+        \n+        // Disable tests for any DB that has supportsSelectForUpdate==false, like HSQLDictionary\n+        OpenJPAEntityManagerFactorySPI tempEMF = emf;\n+        if (tempEMF == null) {\n+            tempEMF = createEMF();\n+        }\n+        assertNotNull(tempEMF);\n+        DBDictionary dict = ((JDBCConfiguration)tempEMF.getConfiguration()).getDBDictionaryInstance();\n+        assertNotNull(dict);\n+        if (!dict.supportsSelectForUpdate)\n+            setTestsDisabled(true);\n+        if (emf == null) {\n+            closeEMF(tempEMF);\n+        }\n+\n         if (isTestsDisabled())\n             return;\n         super.setUp(entityClass, CLEAR_TABLES);"}]}

