{"sha":"a4a94f5331993bc50bf1f2168246e91c2864141f","node_id":"MDY6Q29tbWl0MjA2MzY0OmE0YTk0ZjUzMzE5OTNiYzUwYmYxZjIxNjgyNDZlOTFjMjg2NDE0MWY=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-08-05T02:56:41Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-08-05T02:56:41Z"},"message":"OPENJPA-1226: fix merge entities with nested embeddables\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@801052 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"e677e9339fdafc12b1be52ca862cd560b80ce32c","url":"https://api.github.com/repos/apache/openjpa/git/trees/e677e9339fdafc12b1be52ca862cd560b80ce32c"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/a4a94f5331993bc50bf1f2168246e91c2864141f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/a4a94f5331993bc50bf1f2168246e91c2864141f","html_url":"https://github.com/apache/openjpa/commit/a4a94f5331993bc50bf1f2168246e91c2864141f","comments_url":"https://api.github.com/repos/apache/openjpa/commits/a4a94f5331993bc50bf1f2168246e91c2864141f/comments","author":null,"committer":null,"parents":[{"sha":"baaec8148b70880ef52b269e0a5ee7c61f6bf005","url":"https://api.github.com/repos/apache/openjpa/commits/baaec8148b70880ef52b269e0a5ee7c61f6bf005","html_url":"https://github.com/apache/openjpa/commit/baaec8148b70880ef52b269e0a5ee7c61f6bf005"}],"stats":{"total":11,"additions":9,"deletions":2},"files":[{"sha":"b8f48a1ee658e8ae073d18182d0eb71c3bb863f9","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/DetachedStateManager.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/a4a94f5331993bc50bf1f2168246e91c2864141f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/DetachedStateManager.java","raw_url":"https://github.com/apache/openjpa/raw/a4a94f5331993bc50bf1f2168246e91c2864141f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/DetachedStateManager.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/DetachedStateManager.java?ref=a4a94f5331993bc50bf1f2168246e91c2864141f","patch":"@@ -118,7 +118,7 @@ public Object attach(AttachManager manager, Object toAttach,\n \n         // pre-load for efficiency: current field values for restore, dependent\n         // for delete\n-        FieldMetaData[] fields = meta.getFields();\n+        FieldMetaData[] fields = sm.getMetaData().getFields(); \n         int restore = broker.getRestoreState();\n         if (_dirty.length() > 0) {\n             BitSet load = new BitSet(fields.length);"},{"sha":"61b6046e4181bf703d36cf1e9a190c3e0483dc70","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/a4a94f5331993bc50bf1f2168246e91c2864141f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/a4a94f5331993bc50bf1f2168246e91c2864141f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java?ref=a4a94f5331993bc50bf1f2168246e91c2864141f","patch":"@@ -146,7 +146,7 @@ public Object attach(AttachManager manager, Object toAttach,\n         int detach = (isNew) ? DETACH_ALL : broker.getDetachState();\n         FetchConfiguration fetch = broker.getFetchConfiguration();\n         try {\n-            FieldMetaData[] fmds = meta.getFields();\n+            FieldMetaData[] fmds = sm.getMetaData().getFields(); \n             for (int i = 0; i < fmds.length; i++) {\n                 switch (detach) {\n                     case DETACH_ALL:"},{"sha":"a464fe7f0482dd5e0774835f959830be65278ea8","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/a4a94f5331993bc50bf1f2168246e91c2864141f/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","raw_url":"https://github.com/apache/openjpa/raw/a4a94f5331993bc50bf1f2168246e91c2864141f/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java?ref=a4a94f5331993bc50bf1f2168246e91c2864141f","patch":"@@ -897,6 +897,13 @@ public void findEntityA_Coll_Embed_Embed() {\n         EntityA_Coll_Embed_Embed a =\n             em.find(EntityA_Coll_Embed_Embed.class, ID);\n         checkEntityA_Coll_Embed_Embed(a);\n+        \n+        em.clear();\n+        em.getTransaction().begin();\n+        Embed_Embed embed = createEmbed_Embed(em, ID, 100);\n+        a.addEmbed(embed);\n+        em.merge(a);\n+        em.getTransaction().commit();\n         em.close();\n     }\n "}]}

