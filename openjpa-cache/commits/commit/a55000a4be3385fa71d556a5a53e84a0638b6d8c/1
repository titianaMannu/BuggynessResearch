{"sha":"a55000a4be3385fa71d556a5a53e84a0638b6d8c","node_id":"MDY6Q29tbWl0MjA2MzY0OmE1NTAwMGE0YmUzMzg1ZmE3MWQ1NTZhNWE1M2U4NGEwNjM4YjZkOGM=","commit":{"author":{"name":"Richard G. Curtis","email":"curtisr7@apache.org","date":"2012-08-03T15:33:00Z"},"committer":{"name":"Richard G. Curtis","email":"curtisr7@apache.org","date":"2012-08-03T15:33:00Z"},"message":"OPENJPA-2229: Honor JoinColumn.name when mapping a uni-directional OneToOne that is in a SecondaryTable.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1369042 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"e8a73268f6b83866d7ca6a53daf1daf9b6172ed5","url":"https://api.github.com/repos/apache/openjpa/git/trees/e8a73268f6b83866d7ca6a53daf1daf9b6172ed5"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/a55000a4be3385fa71d556a5a53e84a0638b6d8c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/a55000a4be3385fa71d556a5a53e84a0638b6d8c","html_url":"https://github.com/apache/openjpa/commit/a55000a4be3385fa71d556a5a53e84a0638b6d8c","comments_url":"https://api.github.com/repos/apache/openjpa/commits/a55000a4be3385fa71d556a5a53e84a0638b6d8c/comments","author":null,"committer":null,"parents":[{"sha":"bcda87c67b6e35d3236e04c0bc699da6f6d5022f","url":"https://api.github.com/repos/apache/openjpa/commits/bcda87c67b6e35d3236e04c0bc699da6f6d5022f","html_url":"https://github.com/apache/openjpa/commit/bcda87c67b6e35d3236e04c0bc699da6f6d5022f"}],"stats":{"total":145,"additions":144,"deletions":1},"files":[{"sha":"2d65c97f1cdca1f6d35bb797b65f4668a68f06ef","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingRepository.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingRepository.java","raw_url":"https://github.com/apache/openjpa/raw/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingRepository.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingRepository.java?ref=a55000a4be3385fa71d556a5a53e84a0638b6d8c","patch":"@@ -1095,7 +1095,9 @@ public boolean isUni1To1JT(FieldMapping field) {\n             field.getAssociationType() == FieldMetaData.ONE_TO_ONE && \n             hasJoinTable(field) && \n             !isBidirectional(field)) {\n-            field.getValueMapping().getValueInfo().setColumns(field.getElementMapping().getValueInfo().getColumns());\n+            List<Column> cols = field.getElementMapping().getValueInfo().getColumns();\n+            if (cols != null && cols.size() > 0)\n+                field.getValueMapping().getValueInfo().setColumns(cols);\n             return true;\n         }\n         return false;"},{"sha":"c1d3af54a36e91b94960ebe43c566804dd77d9e6","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/PChild.java","status":"added","additions":56,"deletions":0,"changes":56,"blob_url":"https://github.com/apache/openjpa/blob/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/PChild.java","raw_url":"https://github.com/apache/openjpa/raw/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/PChild.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/PChild.java?ref=a55000a4be3385fa71d556a5a53e84a0638b6d8c","patch":"@@ -0,0 +1,56 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.    \r\n+ */\r\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.    \r\n+ */\r\n+package org.apache.openjpa.meta;\r\n+\r\n+import javax.persistence.Basic;\r\n+import javax.persistence.Entity;\r\n+import javax.persistence.GeneratedValue;\r\n+import javax.persistence.Id;\r\n+import javax.persistence.Version;\r\n+\r\n+@Entity\r\n+public class PChild {\r\n+    @Id\r\n+    @GeneratedValue\r\n+    int idChild;\r\n+    \r\n+    @Version\r\n+    int version;\r\n+    \r\n+    @Basic\r\n+    String basic;\r\n+}\r"},{"sha":"79a4be651caca31e323b762b6f5da70a7d9bc219","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/Parent.java","status":"added","additions":44,"deletions":0,"changes":44,"blob_url":"https://github.com/apache/openjpa/blob/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/Parent.java","raw_url":"https://github.com/apache/openjpa/raw/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/Parent.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/Parent.java?ref=a55000a4be3385fa71d556a5a53e84a0638b6d8c","patch":"@@ -0,0 +1,44 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.    \r\n+ */\r\n+package org.apache.openjpa.meta;\r\n+\r\n+import javax.persistence.Entity;\r\n+import javax.persistence.GeneratedValue;\r\n+import javax.persistence.Id;\r\n+import javax.persistence.JoinColumn;\r\n+import javax.persistence.OneToOne;\r\n+import javax.persistence.PrimaryKeyJoinColumn;\r\n+import javax.persistence.SecondaryTable;\r\n+\r\n+@Entity\r\n+@SecondaryTable(name = \"ParentSecondaryTable\", pkJoinColumns = \r\n+    { @PrimaryKeyJoinColumn(name = \"idParent\", referencedColumnName = \"idParent\") })\r\n+public class Parent {\r\n+\r\n+    @Id\r\n+    @GeneratedValue\r\n+    int idParent;\r\n+\r\n+    String child_ref;\r\n+\r\n+    @OneToOne\r\n+    @JoinColumn(name = \"CHILD_REF\", table = \"ParentSecondaryTable\", referencedColumnName = \"idChild\")\r\n+    PChild child;\r\n+\r\n+}\r"},{"sha":"ec4d0e0bd6ba52d2796175ae6eec959e2c59e1f3","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/TestSecondaryTable.java","status":"added","additions":41,"deletions":0,"changes":41,"blob_url":"https://github.com/apache/openjpa/blob/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/TestSecondaryTable.java","raw_url":"https://github.com/apache/openjpa/raw/a55000a4be3385fa71d556a5a53e84a0638b6d8c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/TestSecondaryTable.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/meta/TestSecondaryTable.java?ref=a55000a4be3385fa71d556a5a53e84a0638b6d8c","patch":"@@ -0,0 +1,41 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.    \r\n+ */\r\n+package org.apache.openjpa.meta;\r\n+\r\n+import org.apache.openjpa.jdbc.meta.FieldMapping;\r\n+import org.apache.openjpa.persistence.test.SingleEMFTestCase;\r\n+\r\n+public class TestSecondaryTable extends SingleEMFTestCase {\r\n+    public void setUp() {\r\n+        setUp(Parent.class, PChild.class\r\n+        // Hard code to 2.0 p.xml value. If the p.xml is 1.0, this value will be changed to false, and the test\r\n+        // won't fail.\r\n+            , \"openjpa.Compatibility\", \"NonDefaultMappingAllowed=true\");\r\n+    }\r\n+\r\n+    /**\r\n+     * Added for OPENJPA-22229.\r\n+     */\r\n+    public void testMappingInfo() {\r\n+        FieldMapping fm = getMapping(Parent.class).getFieldMapping(\"child\");\r\n+        assertNotNull(fm);\r\n+        assertEquals(\"CHILD_REF\", fm.getColumns()[0].getIdentifier().getName());\r\n+    }\r\n+\r\n+}\r"}]}

