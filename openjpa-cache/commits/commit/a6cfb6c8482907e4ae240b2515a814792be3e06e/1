{"sha":"a6cfb6c8482907e4ae240b2515a814792be3e06e","node_id":"MDY6Q29tbWl0MjA2MzY0OmE2Y2ZiNmM4NDgyOTA3ZTRhZTI0MGIyNTE1YTgxNDc5MmJlM2UwNmU=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2010-08-11T14:06:10Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2010-08-11T14:06:10Z"},"message":"OPENJPA-1668: allow non-default sequence sql strings for z/os and iseries\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@984413 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"61e9379f26184dec1ae9b3b9c7e6664b65f5c0ac","url":"https://api.github.com/repos/apache/openjpa/git/trees/61e9379f26184dec1ae9b3b9c7e6664b65f5c0ac"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/a6cfb6c8482907e4ae240b2515a814792be3e06e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/a6cfb6c8482907e4ae240b2515a814792be3e06e","html_url":"https://github.com/apache/openjpa/commit/a6cfb6c8482907e4ae240b2515a814792be3e06e","comments_url":"https://api.github.com/repos/apache/openjpa/commits/a6cfb6c8482907e4ae240b2515a814792be3e06e/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"7b1d5067d6be77ad953a907d7ca12027acc975bd","url":"https://api.github.com/repos/apache/openjpa/commits/7b1d5067d6be77ad953a907d7ca12027acc975bd","html_url":"https://github.com/apache/openjpa/commit/7b1d5067d6be77ad953a907d7ca12027acc975bd"}],"stats":{"total":37,"additions":30,"deletions":7},"files":[{"sha":"61d5c9e3dba037fcd1b677633f1b4de30cfe1b70","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":20,"deletions":6,"changes":26,"blob_url":"https://github.com/apache/openjpa/blob/a6cfb6c8482907e4ae240b2515a814792be3e06e/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/a6cfb6c8482907e4ae240b2515a814792be3e06e/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=a6cfb6c8482907e4ae240b2515a814792be3e06e","patch":"@@ -19,7 +19,6 @@\n package org.apache.openjpa.jdbc.sql;\n \n import java.io.ByteArrayInputStream;\n-import java.io.CharArrayReader;\n import java.io.InputStream;\n import java.io.Reader;\n import java.lang.reflect.Method;\n@@ -83,6 +82,9 @@\n     protected static final String useKeepUpdateLockClause    = \"USE AND KEEP UPDATE LOCKS\";\n     protected static final String useKeepExclusiveLockClause = \"USE AND KEEP EXCLUSIVE LOCKS\";\n     protected static final String forReadOnlyClause = \"FOR READ ONLY\";\n+    protected static final String defaultSequenceSQL \n+        = \"SELECT SEQSCHEMA AS SEQUENCE_SCHEMA, SEQNAME AS SEQUENCE_NAME FROM SYSCAT.SEQUENCES\";\n+\n     protected String databaseProductName = \"\";\n     protected String databaseProductVersion = \"\";\n     protected int maj = 0;\n@@ -97,7 +99,7 @@ public DB2Dictionary() {\n \n         nextSequenceQuery = \"VALUES NEXTVAL FOR {0}\";\n \n-        sequenceSQL = \"SELECT SEQSCHEMA AS SEQUENCE_SCHEMA, SEQNAME AS SEQUENCE_NAME FROM SYSCAT.SEQUENCES\";\n+        sequenceSQL = defaultSequenceSQL;\n         sequenceSchemaSQL = \"SEQSCHEMA = ?\";\n         sequenceNameSQL = \"SEQNAME = ?\";\n         characterColumnSize = 254;\n@@ -357,8 +359,14 @@ else if (isDB2UDBV82OrLater())\n                 + \"SYSIBM.SYSDUMMY1\";\n             nextSequenceQuery = \"SELECT NEXTVAL FOR {0} FROM \"\n                 + \"SYSIBM.SYSDUMMY1\";\n-            sequenceSQL = \"SELECT SCHEMA AS SEQUENCE_SCHEMA, \"\n-                + \"NAME AS SEQUENCE_NAME FROM SYSIBM.SYSSEQUENCES\";\n+            // allow users to set a non default sequenceSQL. \n+            if (defaultSequenceSQL.equals(sequenceSQL)){            \t\n+\t            sequenceSQL = \"SELECT SCHEMA AS SEQUENCE_SCHEMA, \"\n+\t                + \"NAME AS SEQUENCE_NAME FROM SYSIBM.SYSSEQUENCES\";\n+\t            \n+                if (log.isTraceEnabled())\n+                    log.trace(_loc.get(\"sequencesql-override\", new Object[] {defaultSequenceSQL, sequenceSQL}));\n+            }\n             sequenceSchemaSQL = \"SCHEMA = ?\";\n             sequenceNameSQL = \"NAME = ?\";\n             if (maj == 8) {\n@@ -375,8 +383,14 @@ else if (isDB2UDBV82OrLater())\n                 + \"SYSIBM.SYSDUMMY1\";\n             validationSQL = \"SELECT DISTINCT(CURRENT TIMESTAMP) FROM \"\n                 + \"QSYS2.SYSTABLES\";\n-            sequenceSQL = \"SELECT SEQUENCE_SCHEMA, \"\n-                + \"SEQUENCE_NAME FROM QSYS2.SYSSEQUENCES\";\n+            // allow users to set a non default sequenceSQL.\n+            if (defaultSequenceSQL.equals(sequenceSQL)){            \n+\t            sequenceSQL = \"SELECT SEQUENCE_SCHEMA, \"\n+\t                + \"SEQUENCE_NAME FROM QSYS2.SYSSEQUENCES\";\n+\t            \n+                if (log.isTraceEnabled())\n+                    log.trace(_loc.get(\"sequencesql-override\", new Object[] {defaultSequenceSQL, sequenceSQL}));\n+            }\n             sequenceSchemaSQL = \"SEQUENCE_SCHEMA = ?\";\n             sequenceNameSQL = \"SEQUENCE_NAME = ?\";\n             break;"},{"sha":"c0e49486a80be66073893728c77daab0a084c83d","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","status":"modified","additions":10,"deletions":1,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/a6cfb6c8482907e4ae240b2515a814792be3e06e/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/a6cfb6c8482907e4ae240b2515a814792be3e06e/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties?ref=a6cfb6c8482907e4ae240b2515a814792be3e06e","patch":"@@ -211,4 +211,13 @@ can-not-execute: Unable to execute {0}.\n psql-owned-seq-warning: Unable to determine which sequences are owned by the database. \\\n \tOpenJPA will consider all sequences suffixed with \"_seq\" as database managed.  This\n \tmay result in improper creation or removal of sequences with this suffix. The \\\n-\toriginal PostgreSQL driver exception is being logged for your reference.\n\\ No newline at end of file\n+\toriginal PostgreSQL driver exception is being logged for your reference.\n+sequencesql-override: Going to override the DB2 specific default for the \\\n+    DBDictionary.sequenceSQL string, which is: \"{0}\" \\\n+    with the value of: \"{1}\", which is the default sequenceSQL string for DB2 on the give operating system.  \\\n+    If the user intends to use a value of: \"{0}\" by defining it as a DBDictionary property, \\\n+    please change the case of at least one of the charaters of the string defined in \\\n+    the property.  This will allow openJPA to detect a difference between the DB2 default \\\n+    string and the string set in the property and will further allow openJPA to use the \\\n+    string defined by the property rather than the default string for DB2.\n+"}]}

