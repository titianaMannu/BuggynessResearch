{"sha":"a904e327287363459ea896987433b26c868713d5","node_id":"MDY6Q29tbWl0MjA2MzY0OmE5MDRlMzI3Mjg3MzYzNDU5ZWE4OTY5ODc0MzNiMjZjODY4NzEzZDU=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2008-09-09T15:09:32Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2008-09-09T15:09:32Z"},"message":"OPENJPA-695 making nightly-upload profile more friendly.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@693481 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ae960b03c0b31d0d7a56fcbed3220ae67fe80e77","url":"https://api.github.com/repos/apache/openjpa/git/trees/ae960b03c0b31d0d7a56fcbed3220ae67fe80e77"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/a904e327287363459ea896987433b26c868713d5","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/a904e327287363459ea896987433b26c868713d5","html_url":"https://github.com/apache/openjpa/commit/a904e327287363459ea896987433b26c868713d5","comments_url":"https://api.github.com/repos/apache/openjpa/commits/a904e327287363459ea896987433b26c868713d5/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"4aa64410ad95dc18d774e58e8dc6eb3ce30a1532","url":"https://api.github.com/repos/apache/openjpa/commits/4aa64410ad95dc18d774e58e8dc6eb3ce30a1532","html_url":"https://github.com/apache/openjpa/commit/4aa64410ad95dc18d774e58e8dc6eb3ce30a1532"}],"stats":{"total":62,"additions":39,"deletions":23},"files":[{"sha":"5ad12a79eb47825ec58b3589c59deed7ace4add9","filename":"openjpa-project/pom.xml","status":"modified","additions":39,"deletions":23,"changes":62,"blob_url":"https://github.com/apache/openjpa/blob/a904e327287363459ea896987433b26c868713d5/openjpa-project/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/a904e327287363459ea896987433b26c868713d5/openjpa-project/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/pom.xml?ref=a904e327287363459ea896987433b26c868713d5","patch":"@@ -79,6 +79,10 @@\n         <docbook.target>${project.basedir}/target/manual</docbook.target>\n         <docbook.version>1.67.2</docbook.version>\n         <local.repository>${settings.localRepository}</local.repository>\n+\n+        <!-- authentication for nightly uploads -->\n+        <nightly.user.name>${user.name}</nightly.user.name>\n+        <nightly.password>passw0rd</nightly.password>\n         </properties>\n \n         <build>\n@@ -303,6 +307,17 @@\n                 </pluginRepository>\n             </pluginRepositories>\n         </profile>\n+        <!-- \n+          Upload distribution files, javadoc and manual to openjpa.apache.org/builds/latest. \n+          This profile is designed to be run nightly by a continuous build server, but can\n+          also be run manually.\n+\n+          The nightly.user.name and nightly.password properties need to be set prior to using\n+          this profile, ie : \n+          $ mvn -Dnightly.user.name=mikedd -Dnightly.password=mikesPassword -Pnightly-upload package\n+          or (using a profile defined in $user.home/.m2/settings.xml )\n+          $ mvn -Pnightly-upload,mikes-nightly-credentials package\n+          -->\n         <profile>\n             <id>nightly-upload</id>\n             <build>\n@@ -313,7 +328,7 @@\n                             <execution>\n                                 <phase>package</phase>\n                                 <configuration>\n-                                    <tasks> \n+                                    <tasks>\n                                         <mkdir dir=\"target/site/tempDocs\"/>\n                                         <unzip dest=\"target/site/tempDocs\">\n                                             <fileset dir=\"target/site/downloads\">\n@@ -324,36 +339,37 @@\n                                                 <include name=\"**/manual/**\"/>\n                                             </patternset>\n                                         </unzip>\n-                                        <chmod perm=\"g+rw\">\n-                                             <fileset dir=\"target/site/downloads\"/>\n-                                        </chmod>\n-                                        <!-- chmod returns 255 on the javadoc and manual dirs -->\n-                                        <exec executable=\"chmod\">\n-                                            <arg value=\"-R\"/>\n-                                            <arg value=\"g+w\"/>\n-                                            <arg value=\"target/site/tempDocs\"/>\n-                                        </exec>\n+                                        <move todir=\"target/site/tempDocs/docs\">\n+                                            <fileset dir=\"target/site/tempDocs/apache-openjpa-${pom.version}/docs\"/> \n+                                        </move>\n+                                        <scp todir=\"${nightly.user.name}:${nightly.password}@people.apache.org:/www/openjpa.apache.org/builds/latest/downloads\">\n+                                            <fileset dir=\"target/site/downloads\"/>\n+                                        </scp>\n                                         \n-                                        <!-- From the ant manual if we need to \n-                                             preserve permissions we should use exec\n-                                          -->\n-                                        <exec executable=\"scp\">\n-                                            <arg value=\"-rp\"/>\n-                                            <arg value=\"target/site/downloads\"/>\n-                                            <arg value=\"people.apache.org:/www/openjpa.apache.org/builds/latest/\"/>\n-                                        </exec>\n-                                        <exec executable=\"scp\">\n-                                            <arg value=\"-rp\"/>\n-                                            <arg value=\"target/site/tempDocs/apache-openjpa-${pom.version}/docs/\"/>\n-                                            <arg value=\"people.apache.org:/www/openjpa.apache.org/builds/latest/\"/>\n-                                        </exec>\n+                                        <scp todir=\"${nightly.user.name}:${nightly.password}@people.apache.org:/www/openjpa.apache.org/builds/latest/docs\">\n+                                            <fileset dir=\"target/site/tempDocs/docs\"/> \n+                                        </scp>\n+                                        <sshexec host=\"people.apache.org\" \n+                                                 username=\"${nightly.user.name}\" \n+                                                 password=\"${nightly.password}\"\n+                                                 command=\"chmod -R g+w /www/openjpa.apache.org/builds/latest\"/>\n+                                        <delete>\n+                                            <fileset dir=\"target/site/tempDocs\"/>\n+                                        </delete>\n                                     </tasks>\n                                 </configuration>\n                                 <goals>\n                                     <goal>run</goal>\n                                 </goals>\n                             </execution>\n                         </executions>\n+                        <dependencies>\n+                            <dependency>\n+                                <groupId>org.apache.ant</groupId>\n+                                <artifactId>ant-jsch</artifactId>\n+                                <version>1.7.0</version>\n+                            </dependency>\n+                        </dependencies>\n                     </plugin>\n                 </plugins>\n             </build>"}]}

