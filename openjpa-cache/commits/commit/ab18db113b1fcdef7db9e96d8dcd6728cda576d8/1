{"sha":"ab18db113b1fcdef7db9e96d8dcd6728cda576d8","node_id":"MDY6Q29tbWl0MjA2MzY0OmFiMThkYjExM2IxZmNkZWY3ZGI5ZTk2ZDhkY2Q2NzI4Y2RhNTc2ZDg=","commit":{"author":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-11-10T17:53:32Z"},"committer":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-11-10T17:53:32Z"},"message":"OPENJPA-1248 Set null or empty_lob as appropriate when inserting a new streaming lob for update on Oracle.  Also configured test to retain connection over the life of the tx and updated manual to document this requirement.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@834564 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"27ba677224bbfdf88b6eddfadc50388d3d12e11f","url":"https://api.github.com/repos/apache/openjpa/git/trees/27ba677224bbfdf88b6eddfadc50388d3d12e11f"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/ab18db113b1fcdef7db9e96d8dcd6728cda576d8","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/ab18db113b1fcdef7db9e96d8dcd6728cda576d8","html_url":"https://github.com/apache/openjpa/commit/ab18db113b1fcdef7db9e96d8dcd6728cda576d8","comments_url":"https://api.github.com/repos/apache/openjpa/commits/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/comments","author":null,"committer":null,"parents":[{"sha":"8f2ed40ac949820ad33faa6520249b672f4be6c8","url":"https://api.github.com/repos/apache/openjpa/commits/8f2ed40ac949820ad33faa6520249b672f4be6c8","html_url":"https://github.com/apache/openjpa/commit/8f2ed40ac949820ad33faa6520249b672f4be6c8"}],"stats":{"total":39,"additions":33,"deletions":6},"files":[{"sha":"9b5a18c86cb03bb5ee9935dc5059f8b5b6b6ba8f","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","status":"modified","additions":11,"deletions":5,"changes":16,"blob_url":"https://github.com/apache/openjpa/blob/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java?ref=ab18db113b1fcdef7db9e96d8dcd6728cda576d8","patch":"@@ -1161,9 +1161,12 @@ private void appendXmlExtractValue(SQLBuffer buf, FilterValue val) {\n     \n     public void insertClobForStreamingLoad(Row row, Column col, Object ob)\n         throws SQLException {\n-        if (ob == null)\n+        if (ob == null) {\n             col.setType(Types.OTHER);\n-        row.setNull(col);\n+            row.setNull(col);\n+        } else {\n+            row.setClob(col, getEmptyClob());\n+        }\n     }\n \n     public int getBatchUpdateCount(PreparedStatement ps) throws SQLException {\n@@ -1202,8 +1205,11 @@ protected Boolean matchErrorState(int subtype, Set<String> errorStates,\n     @Override\n     public void insertBlobForStreamingLoad(Row row, Column col, \n         JDBCStore store, Object ob, Select sel) throws SQLException {\n-        if (ob == null)\n+        if (ob == null) {\n             col.setType(Types.OTHER);\n-        row.setNull(col);\n-    }    \n+            row.setNull(col);\n+        } else {\n+            row.setBlob(col, getEmptyBlob());\n+        }\n+    }\n }"},{"sha":"b25f0582e3b1076a92198f29177ed412004ea7f3","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/strats/AbstractLobTest.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/strats/AbstractLobTest.java","raw_url":"https://github.com/apache/openjpa/raw/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/strats/AbstractLobTest.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/strats/AbstractLobTest.java?ref=ab18db113b1fcdef7db9e96d8dcd6728cda576d8","patch":"@@ -49,7 +49,8 @@\n     public void setUp() throws Exception {\n         super.setUp(getLobEntityClass(), CLEAR_TABLES,\n             \"openjpa.DataCache\", \"true\",\n-            \"openjpa.RemoteCommitProvider\", \"sjvm\");\n+            \"openjpa.RemoteCommitProvider\", \"sjvm\",\n+            \"openjpa.ConnectionRetainMode\", \"transaction\");\n     }\n \n     public boolean isDatabaseSupported() {"},{"sha":"e19a49984bb3db63a925fa5095c5d35ee3be3e2c","filename":"openjpa-project/src/doc/manual/supported_databases.xml","status":"modified","additions":20,"deletions":0,"changes":20,"blob_url":"https://github.com/apache/openjpa/blob/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/openjpa-project/src/doc/manual/supported_databases.xml","raw_url":"https://github.com/apache/openjpa/raw/ab18db113b1fcdef7db9e96d8dcd6728cda576d8/openjpa-project/src/doc/manual/supported_databases.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/supported_databases.xml?ref=ab18db113b1fcdef7db9e96d8dcd6728cda576d8","patch":"@@ -1153,6 +1153,26 @@ Floats and doubles may lose precision when stored.\n CLOB columns cannot be used in queries.\n                     </para>\n                 </listitem>\n+                <listitem>\n+                    <para>\n+The use of LOBs with persistent attributes of a streaming data type (ex. \n+<literal>java.io.InputStream</literal> or <literal>java.io.Reader</literal>) may \n+require the same connection to be used over the life of the transaction or \n+entity manager.  If the same connection is not used for persistent operations\n+a <literal>java.io.IOException</literal> with message <literal>Closed Connection\n+</literal> may result.  The OpenJPA property <literal>openjpa.ConnectionRetainMode</literal>\n+can be used to control how OpenJPA uses datastore connections.  See \n+<xref linkend=\"ref_guide_dbsetup_retain\"/> for details.\n+            <example id=\"dbsupport_oracle_retain_connection\">\n+                <title>\n+                    Property to retain connection over the lifetime of the entity manager\n+                </title>\n+<programlisting>\n+openjpa.ConnectionRetainMode: always\n+</programlisting> \n+            </example>\n+                    </para>\n+                </listitem>\n             </itemizedlist>\n         </section>\n     </section>"}]}

