{"sha":"ac6dab1d076a47319c82aac23a2ef5413fd1ecbe","node_id":"MDY6Q29tbWl0MjA2MzY0OmFjNmRhYjFkMDc2YTQ3MzE5YzgyYWFjMjNhMmVmNTQxM2ZkMWVjYmU=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2009-12-21T19:57:11Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2009-12-21T19:57:11Z"},"message":"OPENJPA-1440: Allow COUNT(*) syntax when DBDictionary.useWildCardForCount=true\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@892949 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"adc75935f4519befb2da53d64703ce3128ad5d7e","url":"https://api.github.com/repos/apache/openjpa/git/trees/adc75935f4519befb2da53d64703ce3128ad5d7e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/ac6dab1d076a47319c82aac23a2ef5413fd1ecbe","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/ac6dab1d076a47319c82aac23a2ef5413fd1ecbe","html_url":"https://github.com/apache/openjpa/commit/ac6dab1d076a47319c82aac23a2ef5413fd1ecbe","comments_url":"https://api.github.com/repos/apache/openjpa/commits/ac6dab1d076a47319c82aac23a2ef5413fd1ecbe/comments","author":null,"committer":null,"parents":[{"sha":"14a02417927de84ff33c127459d3c5375eedf093","url":"https://api.github.com/repos/apache/openjpa/commits/14a02417927de84ff33c127459d3c5375eedf093","html_url":"https://github.com/apache/openjpa/commit/14a02417927de84ff33c127459d3c5375eedf093"}],"stats":{"total":17,"additions":17,"deletions":0},"files":[{"sha":"e58ffbbf0a4b97461c59228962e012f5632766c9","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/Count.java","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/ac6dab1d076a47319c82aac23a2ef5413fd1ecbe/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/Count.java","raw_url":"https://github.com/apache/openjpa/raw/ac6dab1d076a47319c82aac23a2ef5413fd1ecbe/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/Count.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/exps/Count.java?ref=ac6dab1d076a47319c82aac23a2ef5413fd1ecbe","patch":"@@ -18,6 +18,7 @@\n  */\n package org.apache.openjpa.jdbc.kernel.exps;\n \n+import org.apache.openjpa.jdbc.sql.SQLBuffer;\n import org.apache.openjpa.jdbc.sql.Select;\n \n /**\n@@ -51,5 +52,21 @@ protected String getOperator() {\n     public boolean isAggregate() {\n         return true;\n     }\n+    \n+    /**\n+     * Overrides SQL formation by replacing COUNT(column) by COUNT(*) when specific conditions are met and\n+     * DBDictionary configuration <code>useWildCardForCount</code> is set.\n+     */\n+    @Override\n+    public void appendTo(Select sel, ExpContext ctx, ExpState state, SQLBuffer sql, int index) {\n+        super.appendTo(sel, ctx, state, sql, index);\n+        if (ctx.store.getDBDictionary().useWildCardForCount && state.joins.isEmpty()) {\n+            String s = sql.getSQL();\n+            if (s.startsWith(\"COUNT(\") && s.endsWith(\")\")) {\n+                sql.replaceSqlString(\"COUNT(\".length(), s.length()-1, \"*\");\n+            }\n+        }\n+    }\n+\n }\n "}]}

