{"sha":"ad5f05112a06dbd0592f4bd158900037e32f2ccd","node_id":"C_kwDOAAMmHNoAKGFkNWYwNTExMmEwNmRiZDA1OTJmNGJkMTU4OTAwMDM3ZTMyZjJjY2Q","commit":{"author":{"name":"Benjamin Marwell","email":"bmarwell@apache.org","date":"2021-11-30T11:44:19Z"},"committer":{"name":"Benjamin Marwell","email":"bmarwell@apache.org","date":"2021-11-30T11:44:19Z"},"message":"[OPENJPA-2891] default for addGeneratedOption, use switch","tree":{"sha":"2dd6009531364df08e6c5942ba895a40dd207cdb","url":"https://api.github.com/repos/apache/openjpa/git/trees/2dd6009531364df08e6c5942ba895a40dd207cdb"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/ad5f05112a06dbd0592f4bd158900037e32f2ccd","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/ad5f05112a06dbd0592f4bd158900037e32f2ccd","html_url":"https://github.com/apache/openjpa/commit/ad5f05112a06dbd0592f4bd158900037e32f2ccd","comments_url":"https://api.github.com/repos/apache/openjpa/commits/ad5f05112a06dbd0592f4bd158900037e32f2ccd/comments","author":{"login":"bmarwell","id":1413391,"node_id":"MDQ6VXNlcjE0MTMzOTE=","avatar_url":"https://avatars.githubusercontent.com/u/1413391?v=4","gravatar_id":"","url":"https://api.github.com/users/bmarwell","html_url":"https://github.com/bmarwell","followers_url":"https://api.github.com/users/bmarwell/followers","following_url":"https://api.github.com/users/bmarwell/following{/other_user}","gists_url":"https://api.github.com/users/bmarwell/gists{/gist_id}","starred_url":"https://api.github.com/users/bmarwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bmarwell/subscriptions","organizations_url":"https://api.github.com/users/bmarwell/orgs","repos_url":"https://api.github.com/users/bmarwell/repos","events_url":"https://api.github.com/users/bmarwell/events{/privacy}","received_events_url":"https://api.github.com/users/bmarwell/received_events","type":"User","site_admin":false},"committer":{"login":"bmarwell","id":1413391,"node_id":"MDQ6VXNlcjE0MTMzOTE=","avatar_url":"https://avatars.githubusercontent.com/u/1413391?v=4","gravatar_id":"","url":"https://api.github.com/users/bmarwell","html_url":"https://github.com/bmarwell","followers_url":"https://api.github.com/users/bmarwell/followers","following_url":"https://api.github.com/users/bmarwell/following{/other_user}","gists_url":"https://api.github.com/users/bmarwell/gists{/gist_id}","starred_url":"https://api.github.com/users/bmarwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bmarwell/subscriptions","organizations_url":"https://api.github.com/users/bmarwell/orgs","repos_url":"https://api.github.com/users/bmarwell/repos","events_url":"https://api.github.com/users/bmarwell/events{/privacy}","received_events_url":"https://api.github.com/users/bmarwell/received_events","type":"User","site_admin":false},"parents":[{"sha":"fe423839f134be2d6a13fcbc3e4d91961b869340","url":"https://api.github.com/repos/apache/openjpa/commits/fe423839f134be2d6a13fcbc3e4d91961b869340","html_url":"https://github.com/apache/openjpa/commit/fe423839f134be2d6a13fcbc3e4d91961b869340"}],"stats":{"total":39,"additions":25,"deletions":14},"files":[{"sha":"10874449c7e0b779032dc3eca85f8bc7ea07f8df","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/meta/AnnotationProcessor6.java","status":"modified","additions":25,"deletions":14,"changes":39,"blob_url":"https://github.com/apache/openjpa/blob/ad5f05112a06dbd0592f4bd158900037e32f2ccd/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/meta/AnnotationProcessor6.java","raw_url":"https://github.com/apache/openjpa/raw/ad5f05112a06dbd0592f4bd158900037e32f2ccd/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/meta/AnnotationProcessor6.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/meta/AnnotationProcessor6.java?ref=ad5f05112a06dbd0592f4bd158900037e32f2ccd","patch":"@@ -317,21 +317,27 @@ private void annotate(SourceCode source, String originalClass) {\n         SourceCode.Class cls = source.getTopLevelClass();\n         cls.addAnnotation(StaticMetamodel.class.getName())\n             .addArgument(\"value\", originalClass + \".class\", false);\n-        if (\"false\".equals(this.addGeneratedOption)) {\n-            return;\n-        }\n \n-        if (\"force\".equals(this.addGeneratedOption)) {\n-            cls.addAnnotation(javax.annotation.Generated.class.getName())\n-                    .addArgument(\"value\", this.getClass().getName())\n-                    .addArgument(\"date\", this.generationDate.toString());\n-        }\n-\n-        // only add the annotation if it is on the classpath for Java 6+.\n-        if (generatedAnnotation != null && generatedSourceVersion >= 6) {\n-            cls.addAnnotation(generatedAnnotation.getName())\n-                    .addArgument(\"value\", this.getClass().getName())\n-                    .addArgument(\"date\", this.generationDate.toString());\n+        switch (this.addGeneratedOption) {\n+            case \"false\":\n+                return;\n+\n+            case \"force\":\n+                cls.addAnnotation(javax.annotation.Generated.class.getName())\n+                        .addArgument(\"value\", this.getClass().getName())\n+                        .addArgument(\"date\", this.generationDate.toString());\n+                break;\n+\n+            case \"auto\":\n+                // fall through\n+            default:\n+                // only add the annotation if it is on the classpath for Java 6+.\n+                if (generatedAnnotation != null && generatedSourceVersion >= 6) {\n+                    cls.addAnnotation(generatedAnnotation.getName())\n+                            .addArgument(\"value\", this.getClass().getName())\n+                            .addArgument(\"date\", this.generationDate.toString());\n+                }\n+                break;\n         }\n     }\n \n@@ -398,6 +404,11 @@ private void setHeader() {\n \n     private void setAddGeneratedAnnotation() {\n         this.addGeneratedOption = getOptionValue(\"openjpa.addGeneratedAnnotation\");\n+\n+        if (this.addGeneratedOption == null) {\n+            this.addGeneratedOption = \"auto\";\n+        }\n+\n         // only add the annotation if it is on the classpath for Java 6+.\n         try {\n             this.generatedAnnotation = Class.forName(\"javax.annotation.Generated\", false, null);"}]}

