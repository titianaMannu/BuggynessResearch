{"sha":"b44715211e61211da14969d1dbdc73bae737bd08","node_id":"MDY6Q29tbWl0MjA2MzY0OmI0NDcxNTIxMWU2MTIxMWRhMTQ5NjlkMWRiZGM3M2JhZTczN2JkMDg=","commit":{"author":{"name":"Kevin W. Sutter","email":"kwsutter@apache.org","date":"2010-02-22T18:53:45Z"},"committer":{"name":"Kevin W. Sutter","email":"kwsutter@apache.org","date":"2010-02-22T18:53:45Z"},"message":"OPENJPA-1516.  Introduce prepareForPooling method on EntityManagerImpl to allow for more efficient EntityManager \"clear\" operations.  This also allows to go outside of the spec just a bit and clean up resources before pooling as well.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@915015 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"19c0e6f9462a75123023b5cbd03be5da541b5fb0","url":"https://api.github.com/repos/apache/openjpa/git/trees/19c0e6f9462a75123023b5cbd03be5da541b5fb0"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/b44715211e61211da14969d1dbdc73bae737bd08","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/b44715211e61211da14969d1dbdc73bae737bd08","html_url":"https://github.com/apache/openjpa/commit/b44715211e61211da14969d1dbdc73bae737bd08","comments_url":"https://api.github.com/repos/apache/openjpa/commits/b44715211e61211da14969d1dbdc73bae737bd08/comments","author":null,"committer":null,"parents":[{"sha":"52e2d925446c06995ebd0979eb1cf93160a8cc31","url":"https://api.github.com/repos/apache/openjpa/commits/52e2d925446c06995ebd0979eb1cf93160a8cc31","html_url":"https://github.com/apache/openjpa/commit/52e2d925446c06995ebd0979eb1cf93160a8cc31"}],"stats":{"total":17,"additions":17,"deletions":0},"files":[{"sha":"9509216269b7822a04e40deb55f99761c662c223","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/b44715211e61211da14969d1dbdc73bae737bd08/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/b44715211e61211da14969d1dbdc73bae737bd08/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java?ref=b44715211e61211da14969d1dbdc73bae737bd08","patch":"@@ -1108,6 +1108,23 @@ static int toFlushBeforeQueries(FlushModeType flushMode) {\n         throw new ArgumentException(flushMode.toString(), null, null, false);\n     }\n \n+    /*\n+     * Used by Java EE Containers that wish to pool OpenJPA EntityManagers.  The specification\n+     * doesn't allow the closing of connections with the clear() method.  By introducing this\n+     * new method, we can do additional processing (and maybe more efficient processing) to \n+     * properly prepare an EM for pooling.\n+     */\n+    public void prepareForPooling() {\n+        assertNotCloseInvoked();\n+        clear();\n+        _broker.lock();  // since this direct close path is not protected...\n+        try {\n+            _broker.getStoreManager().close();\n+        } finally {\n+            _broker.unlock();\n+        }\n+    }\n+    \n     public void clear() {\n         assertNotCloseInvoked();\n         _broker.detachAll(this, false);"}]}

