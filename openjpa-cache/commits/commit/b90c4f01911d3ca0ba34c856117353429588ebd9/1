{"sha":"b90c4f01911d3ca0ba34c856117353429588ebd9","node_id":"MDY6Q29tbWl0MjA2MzY0OmI5MGM0ZjAxOTExZDNjYTBiYTM0Yzg1NjExNzM1MzQyOTU4OGViZDk=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-01-06T12:02:29Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-01-06T12:02:29Z"},"message":"OPENJPA-1453 cleanup classpaths for jpa.classes and tsant\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@896412 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"88dbebb17f174b277060f13960afb3a886108011","url":"https://api.github.com/repos/apache/openjpa/git/trees/88dbebb17f174b277060f13960afb3a886108011"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/b90c4f01911d3ca0ba34c856117353429588ebd9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/b90c4f01911d3ca0ba34c856117353429588ebd9","html_url":"https://github.com/apache/openjpa/commit/b90c4f01911d3ca0ba34c856117353429588ebd9","comments_url":"https://api.github.com/repos/apache/openjpa/commits/b90c4f01911d3ca0ba34c856117353429588ebd9/comments","author":null,"committer":null,"parents":[{"sha":"bfd07edf3fe65f7ee7b4bc756d694f1bd1759479","url":"https://api.github.com/repos/apache/openjpa/commits/bfd07edf3fe65f7ee7b4bc756d694f1bd1759479","html_url":"https://github.com/apache/openjpa/commit/bfd07edf3fe65f7ee7b4bc756d694f1bd1759479"}],"stats":{"total":41,"additions":26,"deletions":15},"files":[{"sha":"823d5e7a7ba7ca14e572f660de7180e6b8b89cc4","filename":"openjpa-integration/tck/pom.xml","status":"modified","additions":26,"deletions":15,"changes":41,"blob_url":"https://github.com/apache/openjpa/blob/b90c4f01911d3ca0ba34c856117353429588ebd9/openjpa-integration/tck/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/b90c4f01911d3ca0ba34c856117353429588ebd9/openjpa-integration/tck/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-integration/tck/pom.xml?ref=b90c4f01911d3ca0ba34c856117353429588ebd9","patch":"@@ -123,16 +123,12 @@\n \n                         <unzip overwrite=\"false\" src=\"${tck.zip}\" dest=\"${tck.base}\" />\n \n-                        <!-- FIXME - Make sure we're using the Geronimo Spec -->\n+                        <!-- \n+                            Setup jpa.classes to only use the Maven artifacts\n+                            that we specified as dependencies\n+                        -->\n                         <path id=\"cp\">\n                             <path refid=\"maven.compile.classpath\" />\n-\n-                            <!-- use official JPA API instead of GM's -->\n-                            <fileset dir=\"${tck.dir}/lib\">\n-                                <include name=\"**/*.jar\" />\n-                            </fileset>\n-                            <pathelement path=\"${java.class.path}\" />\n-                            <pathelement path=\"${db.jar}\" />\n                         </path>\n                         <pathconvert property=\"cp.property\" refid=\"cp\" />\n \n@@ -147,8 +143,8 @@\n                         <property name=\"jpatck.pkg.dir\" value=\"com\" />\n                         <property name=\"jpatck.test\" value=\"\" />\n \n-                        <property name=\"jpatck.reports.dir\" value=\"${tck.dir}/../reports\" />\n-                        <property name=\"jpatck.work.dir\" value=\"${tck.dir}/../work\" />\n+                        <property name=\"jpatck.reports.dir\" value=\"${tck.base}/reports\" />\n+                        <property name=\"jpatck.work.dir\" value=\"${tck.base}/work\" />\n                         <property name=\"tck.log\" value=\"${tck.base}/openjpa-tck.log\" />\n \n                         <property name=\"openjpa.properties\" value=\"${tck.dir}/openjpa-provier.properties\" />\n@@ -164,8 +160,14 @@ openjpa.FetchBatchSize: -1\n openjpa.Compatibility: StrictIdentityValues=true\n openjpa.Sequence: time\n openjpa.Log: DefaultLevel=${openjpa.log.level}\n-openjpa.jdbc.DBDictionary: StoreCharsAsNumbers=false\n+openjpa.jdbc.DBDictionary: StoreCharsAsNumbers=true\n openjpa.jdbc.SchemaFactory: native(ForeignKeys=true)\n+openjpa.jdbc.SynchronizeMappings: buildSchema(ForeignKeys=true)\n+                        </echo>\n+\n+                        <!-- create an empty DDL file for the TCK dbinit -->\n+                        <echo append=\"false\" file=\"${tck.dir}/sql/${db.name}/${db.name}.ddl.persistence.sql\">\n+;\n                         </echo>\n \n                         <!-- Append OpenJPA-specific configuration -->\n@@ -182,7 +184,8 @@ jpa.home=${tck.dir}\n work.dir=${jpatck.work.dir}\n report.dir=${jpatck.reports.dir}\n jpa.classes=${cp.property}\n-database.classes=${jpa.classes}\n+# jpa.classes includes Derby, so only set database.classes for other DBs\n+database.classes=\n # Need to specify java.* classes, both in Windows/UNIX locations as well as Mac.\n # This includes a few different possible locations; only one of them needs to \n # actually work for a given environment.\n@@ -225,7 +228,12 @@ databaseName=${db.name}\n                             persistent classes to work (like the SignatureTest)\n                         -->\n                         <replace file=\"${jpatck.config}\">\n-                            <replacefilter token=\"-Ddeliverable.class=${deliverable.class}\" value=\"-Ddeliverable.class=${deliverable.class} -javaagent:${agent}${agent.properties} -Dopenjpa.MetaDataFactory=jpa(DefaultAccessType=PROPERTY)\" />\n+                            <replacefilter token=\"-Ddeliverable.class=${deliverable.class}\" value=\"-Ddeliverable.class=${deliverable.class} -javaagent:${agent}${agent.properties} -Dopenjpa.MetaDataFactory=jpa(DefaultAccessType=PROPERTY)\"/>\n+                        </replace>\n+\n+                        <!-- Fix path for java.security.policy -->\n+                        <replace file=\"${jpatck.config}\">\n+                            <replacefilter token=\"-Djava.security.policy=${bin.dir}/harness.policy\" value=\"-Djava.security.policy=${ts.home}/bin/harness.policy\"/>\n                         </replace>\n \n                         <!-- make a macro for the TCK harness launcher -->\n@@ -243,8 +251,8 @@ databaseName=${db.name}\n                                     <arg value=\"com.sun.ant.TSLogger\" />\n                                     <arg value=\"@{target}\" />\n \n-                                    <env key=\"TS_HOME\" value=\"..\" />\n-                                    <sysproperty key=\"ts.home\" value=\"..\" />\n+                                    <env key=\"TS_HOME\" value=\"${tck.dir}\" />\n+                                    <sysproperty key=\"ts.home\" value=\"${tck.dir}\" />\n \n                                     <env key=\"ANT_HOME\" value=\"${tck.dir}/tools/ant\" />\n                                     <sysproperty key=\"ant.home\" value=\"${tck.dir}/tools/ant\" />\n@@ -259,6 +267,9 @@ databaseName=${db.name}\n                                         <fileset dir=\"${tck.dir}/tools/ant/lib\">\n                                             <include name=\"**/*.jar\" />\n                                         </fileset>\n+                                        <fileset dir=\"${tck.dir}/lib\">\n+                                            <include name=\"**/*.jar\" />\n+                                        </fileset>\n                                     </classpath>\n                                 </java>\n                             </sequential>"}]}

