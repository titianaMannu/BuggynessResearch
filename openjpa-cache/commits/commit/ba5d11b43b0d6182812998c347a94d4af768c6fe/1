{"sha":"ba5d11b43b0d6182812998c347a94d4af768c6fe","node_id":"MDY6Q29tbWl0MjA2MzY0OmJhNWQxMWI0M2IwZDYxODI4MTI5OThjMzQ3YTk0ZDRhZjc2OGM2ZmU=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2008-03-06T04:12:11Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2008-03-06T04:12:11Z"},"message":"OPENJPA-532 This patch enables command runnable to process once when no persistence unit is found by the tool commands. This allows command option(s) which does not require pu definition to function properly.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@634150 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"0097f4d18414b420f10146bfa9514a349c661c0e","url":"https://api.github.com/repos/apache/openjpa/git/trees/0097f4d18414b420f10146bfa9514a349c661c0e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/ba5d11b43b0d6182812998c347a94d4af768c6fe","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/ba5d11b43b0d6182812998c347a94d4af768c6fe","html_url":"https://github.com/apache/openjpa/commit/ba5d11b43b0d6182812998c347a94d4af768c6fe","comments_url":"https://api.github.com/repos/apache/openjpa/commits/ba5d11b43b0d6182812998c347a94d4af768c6fe/comments","author":null,"committer":null,"parents":[{"sha":"85c7a33365815ecc5b630ae5ce9b51f60b2ad7cb","url":"https://api.github.com/repos/apache/openjpa/commits/85c7a33365815ecc5b630ae5ce9b51f60b2ad7cb","html_url":"https://github.com/apache/openjpa/commit/85c7a33365815ecc5b630ae5ce9b51f60b2ad7cb"}],"stats":{"total":31,"additions":21,"deletions":10},"files":[{"sha":"b5726c962c01d4a3967fd282c0a0e14aa0441fc8","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java","status":"modified","additions":21,"deletions":10,"changes":31,"blob_url":"https://github.com/apache/openjpa/blob/ba5d11b43b0d6182812998c347a94d4af768c6fe/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java","raw_url":"https://github.com/apache/openjpa/raw/ba5d11b43b0d6182812998c347a94d4af768c6fe/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Configurations.java?ref=ba5d11b43b0d6182812998c347a94d4af768c6fe","patch":"@@ -686,21 +686,32 @@ public static boolean runAgainstAllAnchors(Options opts,\n             opts.remove(\"p\");\n \n         boolean ret = true;\n-        for (Iterator iter = anchors.iterator(); iter.hasNext(); ) {\n-            Options clonedOptions = (Options) opts.clone();\n-            clonedOptions.setProperty(\"properties\", iter.next().toString());\n-            try {\n-                ret &= runnable.run(clonedOptions);\n-            } catch (Exception e) {\n-                if (!(e instanceof RuntimeException))\n-                    throw new RuntimeException(e);\n-                else\n-                    throw (RuntimeException) e;\n+        if (anchors.size() == 0) {\n+            ret = launchRunnable(opts, runnable);\n+        } else {\n+            for (Iterator iter = anchors.iterator(); iter.hasNext(); ) { \n+                Options clonedOptions = (Options) opts.clone();\n+                clonedOptions.setProperty(\"properties\", iter.next().toString());\n+                ret &= launchRunnable(clonedOptions, runnable);\n             }\n         }\n         return ret;\n     }\n \n+    private static boolean launchRunnable(Options opts,\n+        Configurations.Runnable runnable) {\n+        boolean ret = true;\n+        try {\n+            ret = runnable.run(opts);\n+        } catch (Exception e) {\n+            if (!(e instanceof RuntimeException))\n+                throw new RuntimeException(e);\n+            else\n+                throw (RuntimeException) e;\n+        }\n+        return ret;\n+    }\n+\n     public interface Runnable {\n         public boolean run(Options opts) throws Exception;\n     }"}]}

