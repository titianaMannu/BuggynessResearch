{"sha":"bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c","node_id":"MDY6Q29tbWl0MjA2MzY0OmJmNmRhMGI1ZmUyYTFlMGRjMjJhMGQ3NDhmYjdjMjYyMDdlYjY1OWM=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-04-22T18:42:43Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-04-22T18:42:43Z"},"message":"OPENJPA-576. Committing on behalf of Sandeep Srivastava.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.1.x@650607 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ffa81452e873b59c7d1c2c534d4b72e28d4beafd","url":"https://api.github.com/repos/apache/openjpa/git/trees/ffa81452e873b59c7d1c2c534d4b72e28d4beafd"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c","html_url":"https://github.com/apache/openjpa/commit/bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c","comments_url":"https://api.github.com/repos/apache/openjpa/commits/bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c/comments","author":null,"committer":null,"parents":[{"sha":"44e06d03a31c2a2a4f08fbccc6b3021b230ad427","url":"https://api.github.com/repos/apache/openjpa/commits/44e06d03a31c2a2a4f08fbccc6b3021b230ad427","html_url":"https://github.com/apache/openjpa/commit/44e06d03a31c2a2a4f08fbccc6b3021b230ad427"}],"stats":{"total":27,"additions":20,"deletions":7},"files":[{"sha":"304782b946f2049dfe005a2c4fa3c39f1c59f4af","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/EmbedFieldStrategy.java","status":"modified","additions":20,"deletions":7,"changes":27,"blob_url":"https://github.com/apache/openjpa/blob/bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/EmbedFieldStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/EmbedFieldStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/EmbedFieldStrategy.java?ref=bf6da0b5fe2a1e0dc22a0d748fb7c26207eb659c","patch":"@@ -405,6 +405,13 @@ public void load(OpenJPAStateManager sm, JDBCStore store,\n             return;\n         }\n \n+        if (fetch.requiresFetch(field.getFieldMetaData()) \n+            != JDBCFetchConfiguration.FETCH_LOAD) {\n+          return;\n+        } else {\n+          fetch = fetch.traverseJDBC(field.getFieldMetaData());\n+        }\n+        \n         //### note: without a null indicator column, the above indicatesNull()\n         //### call will always return false, meaning we always have to assume\n         //### we selected the embedded object fields and load the object\n@@ -417,7 +424,7 @@ public void load(OpenJPAStateManager sm, JDBCStore store,\n \n         FieldMapping[] fields = field.getEmbeddedMapping().getFieldMappings();\n         Object eres, processed;\n-        boolean loaded = false;\n+        boolean loaded = true;\n         for (int i = 0; i < fields.length; i++) {\n             eres = res.getEager(fields[i]);\n             res.startDataRequest(fields[i]);\n@@ -429,18 +436,24 @@ else if (eres != null) {\n                         fields[i].loadEagerParallel(em, store, fetch, eres);\n                     if (processed != eres)\n                         res.putEager(fields[i], processed);\n-                } else\n+                } else {\n                     fields[i].load(em, store, fetch, res);\n-                loaded |= em.getLoaded().get(i);\n+                }\n+                FieldMetaData fm = fields[i].getFieldMetaData();\n+                loaded &= em.getLoaded().get(i) || \n+                    (fm != null && fetch.requiresFetch(fm)\n+                        != FetchConfiguration.FETCH_LOAD);\n             } finally {\n                 res.endDataRequest();\n             }\n         }\n \n-        // after loading everything from result, load the rest of the\n-        // configured fields\n-        if (loaded)\n-            em.load(fetch);\n+        // After loading everything from result, load the rest of the\n+        // configured fields if anything is missing.\n+        if (!loaded) {\n+          em.load(fetch);\n+        }\n+        \n     }\n \n     /**"}]}

