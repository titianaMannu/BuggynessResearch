{"sha":"c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","node_id":"MDY6Q29tbWl0MjA2MzY0OmMxNWY0NzM5NDljYTcyYTk3MmRjNzVmNjFjNWYwYjQzYTlkZDFlOWY=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-01-22T22:11:39Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-01-22T22:11:39Z"},"message":"OPENJPA-1460: back out the previous change until the visibility scope of orm.xml is fully agreed upon.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@902291 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7d209057769558100fa1340f2cf7fcc114f9130c","url":"https://api.github.com/repos/apache/openjpa/git/trees/7d209057769558100fa1340f2cf7fcc114f9130c"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","html_url":"https://github.com/apache/openjpa/commit/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","comments_url":"https://api.github.com/repos/apache/openjpa/commits/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/comments","author":null,"committer":null,"parents":[{"sha":"671417a73a8d3c3548792da6886f207bca99b72d","url":"https://api.github.com/repos/apache/openjpa/commits/671417a73a8d3c3548792da6886f207bca99b72d","html_url":"https://github.com/apache/openjpa/commit/671417a73a8d3c3548792da6886f207bca99b72d"}],"stats":{"total":56,"additions":2,"deletions":54},"files":[{"sha":"523524edab3f8e9b8ac859758e7055f4e42ad05c","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfiguration.java","status":"modified","additions":0,"deletions":18,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfiguration.java","raw_url":"https://github.com/apache/openjpa/raw/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfiguration.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfiguration.java?ref=c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","patch":"@@ -18,7 +18,6 @@\n  */\n package org.apache.openjpa.conf;\n \n-import java.net.URL;\n import java.util.Collection;\n import java.util.Map;\n \n@@ -1800,22 +1799,5 @@\n      * @since 2.0.0\n      */\n     public String getDataCacheMode();\n-    \n-    /**\n-     * Set the persistent unit root url.\n-     * \n-     * @see PersistenceUnitInfo#getPersistenceUnitRootUrl()\n-     * \n-     * @param the persistent unit root url\n-     * @since 2.0.0\n-     */\n-    public void setPersistenceUnitRootUrl(URL url);\n-    \n-    /**\n-     * Return the persistent unit rool URL\n-     * @return URL\n-     * @since 2.0.0\n-     */\n-    public URL getPersistenceUnitRootUrl();\n }\n "},{"sha":"eb29d6919ce3305c6a9a71f9a09cd678c2905ae7","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java","status":"modified","additions":1,"deletions":11,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java","raw_url":"https://github.com/apache/openjpa/raw/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java?ref=c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","patch":"@@ -18,7 +18,6 @@\n  */\n package org.apache.openjpa.conf;\n \n-import java.net.URL;\n import java.util.Collection;\n import java.util.HashSet;\n import java.util.Map;\n@@ -178,7 +177,7 @@\n     private Collection<String> supportedOptions = new HashSet<String>(33);\n     private final StoreFacadeTypeRegistry _storeFacadeRegistry = new StoreFacadeTypeRegistry();\n     private BrokerFactoryEventManager _brokerFactoryEventManager = new BrokerFactoryEventManager(this);\n-    private URL _puRootUrl;    \n+        \n \n     /**\n      * Default constructor. Attempts to load global properties.\n@@ -1695,14 +1694,5 @@ public void setDataCacheMode(String mode) {\n     public String getDataCacheMode() {\n         return dataCacheMode.getString();\n     }\n-    \n-    public void setPersistenceUnitRootUrl(URL url) {\n-        this._puRootUrl = url;\n-    }\n-    \n-    public URL getPersistenceUnitRootUrl() {\n-        return _puRootUrl;\n-    }\n-    \n }\n "},{"sha":"18766983faeb9101e2730804a27d355310982102","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/meta/AbstractCFMetaDataFactory.java","status":"modified","additions":1,"deletions":20,"changes":21,"blob_url":"https://github.com/apache/openjpa/blob/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-kernel/src/main/java/org/apache/openjpa/meta/AbstractCFMetaDataFactory.java","raw_url":"https://github.com/apache/openjpa/raw/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-kernel/src/main/java/org/apache/openjpa/meta/AbstractCFMetaDataFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/meta/AbstractCFMetaDataFactory.java?ref=c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","patch":"@@ -752,28 +752,8 @@ protected ClassMetaData getDefiningMetaData(QueryMetaData query,\n                     if (log.isTraceEnabled())\n                         log.trace(_loc.get(\"scanning-resource\", rsrc));\n                     mitr = new ResourceMetaDataIterator(rsrc, loader);\n-                    \n-                    URL puUrl  = repos.getConfiguration().getPersistenceUnitRootUrl();\n-                    String puUrlString = puUrl == null ? null : puUrl.toString();\n-                    if (log.isTraceEnabled())\n-                        log.trace(_loc.get(\"pu-root-url\", puUrlString));\n-                    \n-                    List<URL> urls = new ArrayList<URL>(3);\n                     while (mitr.hasNext()) {\n                         url = (URL) mitr.next();\n-                        String urlString = url.toString();\n-                        if (log.isTraceEnabled())\n-                            log.trace(_loc.get(\"resource-url\", urlString));\n-                        if (puUrlString != null) {\n-                            if (urlString.indexOf(puUrlString) != -1)\n-                                urls.add(url);\n-                        } else \n-                            urls.add(url);\n-                    }\n-                    mitr.close();\n-                    \n-                    for (Object obj : urls) {\n-                        url = (URL) obj;\n                         clss = cparser.parseTypeNames(new URLMetaDataIterator\n                             (url));\n                         List<String> newNames = Arrays.asList(clss);\n@@ -783,6 +763,7 @@ protected ClassMetaData getDefiningMetaData(QueryMetaData query,\n                         names.addAll(newNames);\n                         mapPersistentTypeNames(url, clss);\n                     }\n+                    mitr.close();\n                 }\n             }\n         }"},{"sha":"287c0d3ac3cfc63603dc84e10c61016e74e2054d","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java","status":"modified","additions":0,"deletions":5,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java","raw_url":"https://github.com/apache/openjpa/raw/c15f473949ca72a972dc75f61c5f0b43a9dd1e9f/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java?ref=c15f473949ca72a972dc75f61c5f0b43a9dd1e9f","patch":"@@ -187,11 +187,6 @@ public OpenJPAEntityManagerFactory createContainerEntityManagerFactory(Persisten\n                 }\n             }\n \n-            OpenJPAConfiguration conf = factory.getConfiguration();\n-            // OPENJPA-1460 Fix scope visibility of orm.xml when it is packaged in both ear file and war file\n-            conf.setPersistenceUnitRootUrl(pui.getPersistenceUnitRootUrl());\n-            _log = conf.getLog(OpenJPAConfiguration.LOG_RUNTIME);\n-\n             // Create appropriate LifecycleEventManager\n             loadValidator(factory);\n             "}]}

