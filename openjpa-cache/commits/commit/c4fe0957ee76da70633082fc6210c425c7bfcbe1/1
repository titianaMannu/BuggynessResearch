{"sha":"c4fe0957ee76da70633082fc6210c425c7bfcbe1","node_id":"MDY6Q29tbWl0MjA2MzY0OmM0ZmUwOTU3ZWU3NmRhNzA2MzMwODJmYzYyMTBjNDI1YzdiZmNiZTE=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-01-04T22:55:49Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-01-04T22:55:49Z"},"message":"OPENJPA-1453 Merge some of the tck2-profile updates into tck-profile and chnage the tsant macro in tck2-profile to not fail the build when errors occur\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@895819 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"3974bf2ca9e27be2221f27b1391c6751cb94564e","url":"https://api.github.com/repos/apache/openjpa/git/trees/3974bf2ca9e27be2221f27b1391c6751cb94564e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/c4fe0957ee76da70633082fc6210c425c7bfcbe1","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/c4fe0957ee76da70633082fc6210c425c7bfcbe1","html_url":"https://github.com/apache/openjpa/commit/c4fe0957ee76da70633082fc6210c425c7bfcbe1","comments_url":"https://api.github.com/repos/apache/openjpa/commits/c4fe0957ee76da70633082fc6210c425c7bfcbe1/comments","author":null,"committer":null,"parents":[{"sha":"3320287392e035415d7867ac7312d9109d02306a","url":"https://api.github.com/repos/apache/openjpa/commits/3320287392e035415d7867ac7312d9109d02306a","html_url":"https://github.com/apache/openjpa/commit/3320287392e035415d7867ac7312d9109d02306a"}],"stats":{"total":45,"additions":39,"deletions":6},"files":[{"sha":"93f28a76830512e212d145d364da092aea62f52e","filename":"openjpa-integration/tck/pom.xml","status":"modified","additions":39,"deletions":6,"changes":45,"blob_url":"https://github.com/apache/openjpa/blob/c4fe0957ee76da70633082fc6210c425c7bfcbe1/openjpa-integration/tck/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/c4fe0957ee76da70633082fc6210c425c7bfcbe1/openjpa-integration/tck/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-integration/tck/pom.xml?ref=c4fe0957ee76da70633082fc6210c425c7bfcbe1","patch":"@@ -231,7 +231,7 @@ databaseName=${db.name}\n                             <attribute name=\"buildfile\" />\n                             <attribute name=\"target\" />\n                             <sequential>\n-                                <java classname=\"org.apache.tools.ant.launch.Launcher\" fork=\"true\" failonerror=\"true\" dir=\"${tck.dir}/src\" append=\"true\" output=\"${tck.log}\" timeout=\"7200000\">\n+                                <java classname=\"org.apache.tools.ant.launch.Launcher\" fork=\"true\" failonerror=\"false\" dir=\"${tck.dir}/src\" append=\"true\" output=\"${tck.log}\" timeout=\"7200000\" resultproperty=\"tsant.result\">\n                                     <arg value=\"-emacs\" />\n                                     <arg value=\"-buildfile\" />\n                                     <arg value=\"@{buildfile}\" />\n@@ -266,9 +266,11 @@ databaseName=${db.name}\n \n                         <!-- first initialize the database -->\n                         <tsant buildfile=\"${tck.dir}/bin/initdb.xml\" target=\"init.database\" />\n+                        <echo>TCK initdb.xml returned result=${tsant.result}</echo>\n \n                         <!-- now run the TCK -->\n                         <tsant buildfile=\"${tck.dir}/bin/build.xml\" target=\"runclient\" />\n+                        <echo>TCK build.xml returned result=${tsant.result}</echo>\n \n                         <!-- archive the results -->\n                         <property name=\"tck.results.archive\" value=\"${tck.base}/openjpa-tck-results.zip\" />\n@@ -371,7 +373,7 @@ databaseName=${db.name}\n                   <phase>integration-test</phase>\n                   <configuration>\n                     <tasks>\n-                        <echo>Running Sun JPA TCK</echo>\n+                        <echo>Running Sun JPA 1.0b TCK</echo>\n \n                         <property name=\"tck.zip\" value=\"${settings.localRepository}/../privaterepos/jpa-1_0b-tck.zip\" />\n                          <available property=\"tck.available\" file=\"${tck.zip}\" />\n@@ -411,6 +413,7 @@ databaseName=${db.name}\n                         <property name=\"jpatck.pkg.dir\" value=\"com\" />\n                         <property name=\"jpatck.test\" value=\"\" />\n \n+                        <property name=\"jpatck.reports.dir\" value=\"${tck.dir}/../reports\" />\n                         <property name=\"jpatck.work.dir\" value=\"${tck.dir}/../work\" />\n                         <property name=\"tck.log\" value=\"${tck.base}/openjpa-tck.log\" />\n \n@@ -443,7 +446,7 @@ openjpa.jdbc.SchemaFactory: native(ForeignKeys=true)\n \n jpa.home=${tck.dir}\n work.dir=${jpatck.work.dir}\n-report.dir=${tck.dir}/../reports\n+report.dir=${jpatck.reports.dir}\n jpa.classes=${cp.property}\n database.classes=${jpa.classes}\n # Need to specify java.* classes, both in Windows/UNIX locations as well as Mac.\n@@ -537,9 +540,39 @@ databaseName=${db.name}\n \n                         <!-- archive the results -->\n                         <property name=\"tck.results.archive\" value=\"${tck.base}/openjpa-tck-results.zip\" />\n-                        <zip destfile=\"${tck.results.archive}\" basedir=\"${jpatck.work.dir}\" />\n+                        <zip destfile=\"${tck.results.archive}\">\n+                            <fileset dir=\"${jpatck.work.dir}\" />\n+                            <fileset dir=\"${jpatck.reports.dir}\" />\n+                        </zip>\n                         <echo>Results archive at: ${tck.results.archive}</echo>\n \n+                        <!-- Figure out the Passed/Failed counts -->\n+                        <resourcecount property=\"count.passed\">\n+                          <tokens>\n+                            <concat>\n+                              <filterchain>\n+                                <tokenfilter>\n+                                  <containsstring contains=\"Passed.\"/>\n+                                </tokenfilter>\n+                              </filterchain>\n+                              <fileset dir=\"${jpatck.reports.dir}\" includes=\"summary.txt\" />\n+                            </concat>\n+                          </tokens>\n+                        </resourcecount>\n+                        <resourcecount property=\"count.failed\">\n+                          <tokens>\n+                            <concat>\n+                              <filterchain>\n+                                <tokenfilter>\n+                                  <containsstring contains=\"Failed.\"/>\n+                                </tokenfilter>\n+                              </filterchain>\n+                              <fileset dir=\"${jpatck.reports.dir}\" includes=\"summary.txt\" />\n+                            </concat>\n+                          </tokens>\n+                        </resourcecount>\n+                        <echo>TCK Results - Passed: ${count.passed}, Failed: ${count.failed}</echo>\n+\n                         <!--\n                             The TCK's Java process doesn't actually fail when\n                             tests fail, so we need to parse the results file\n@@ -549,9 +582,9 @@ databaseName=${db.name}\n                         <condition property=\"jpatck.failed\">\n                             <contains string=\"${jpatck.results}\" substring=\"Completed test run: not ok\" />\n                         </condition>\n-                        <fail if=\"jpatck.failed\">Some tests failed</fail>\n+                        <fail if=\"jpatck.failed\">${count.failed} tests failed</fail>\n                         <!-- else -->\n-                        <echo>JPA TCK Passed 100%!</echo>\n+                        <echo>Pased JPA 1.0b TCK!</echo>\n \n                     </tasks>\n                   </configuration>"}]}

