{"sha":"c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","node_id":"MDY6Q29tbWl0MjA2MzY0OmM2NDU5MzkxYzhhODY2OGNmYzBlY2Q3YmE3ZGU5NWY3YjBmOTU2YmQ=","commit":{"author":{"name":"Milosz Tylenda","email":"mtylenda@apache.org","date":"2010-01-03T17:55:35Z"},"committer":{"name":"Milosz Tylenda","email":"mtylenda@apache.org","date":"2010-01-03T17:55:35Z"},"message":"OPENJPA-1248: Add limited support of LOB streaming on SQL Server; wording corrections.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@895453 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"730e94f2e68f84d097db08149f66874cd8a2c660","url":"https://api.github.com/repos/apache/openjpa/git/trees/730e94f2e68f84d097db08149f66874cd8a2c660"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","html_url":"https://github.com/apache/openjpa/commit/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","comments_url":"https://api.github.com/repos/apache/openjpa/commits/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/comments","author":null,"committer":null,"parents":[{"sha":"e5d2bd435f0c0fe502ed21a7df97672406d225c9","url":"https://api.github.com/repos/apache/openjpa/commits/e5d2bd435f0c0fe502ed21a7df97672406d225c9","html_url":"https://github.com/apache/openjpa/commit/e5d2bd435f0c0fe502ed21a7df97672406d225c9"}],"stats":{"total":62,"additions":57,"deletions":5},"files":[{"sha":"367acb46f66a89aa97f075df5405e5c1882dc288","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","status":"modified","additions":42,"deletions":2,"changes":44,"blob_url":"https://github.com/apache/openjpa/blob/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java?ref=c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","patch":"@@ -16,21 +16,27 @@\n  */\n package org.apache.openjpa.jdbc.sql;\n \n+import java.io.InputStream;\n+import java.io.Reader;\n+import java.sql.Blob;\n+import java.sql.Clob;\n import java.sql.Connection;\n import java.sql.DatabaseMetaData;\n+import java.sql.ResultSet;\n import java.sql.SQLException;\n import java.sql.Types;\n import java.util.Set;\n \n+import org.apache.openjpa.jdbc.kernel.JDBCStore;\n import org.apache.openjpa.jdbc.kernel.exps.FilterValue;\n-import org.apache.openjpa.kernel.Filters;\n import org.apache.openjpa.jdbc.schema.Column;\n+import org.apache.openjpa.kernel.Filters;\n import org.apache.openjpa.lib.util.Localizer;\n import org.apache.openjpa.meta.JavaTypes;\n import org.apache.openjpa.util.StoreException;\n \n /**\n- * Dictionary for MS SQLServer.\n+ * Dictionary for Microsoft SQL Server.\n  */\n public class SQLServerDictionary extends AbstractSQLServerDictionary {\n \n@@ -277,4 +283,38 @@ protected Boolean matchErrorState(int subtype, Set<String> errorStates,\n         }\n         return recoverable;\n     }\n+\n+    /**\n+     * Obtain an {@link InputStream} by using {@link ResultSet#getBlob(int)} and\n+     * {@link Blob#getBinaryStream()}.\n+     * Unfortunately this will load entire BLOB into memory.\n+     * The alternative {@link ResultSet#getBinaryStream(int)} provides true streaming but\n+     * the stream can be consumed only as long as {@link ResultSet} is open.\n+     */\n+    @Override\n+    public InputStream getLOBStream(JDBCStore store, ResultSet rs, int column) throws SQLException {\n+        Blob blob = rs.getBlob(column);\n+        if (blob == null) {\n+            return null;\n+        }\n+        return blob.getBinaryStream();\n+    }\n+\n+    /**\n+     * Obtain a {@link Reader} by using {@link ResultSet#getClob(int)} and\n+     * {@link Clob#getCharacterStream()}.\n+     * Unfortunately this will load entire CLOB into memory.\n+     * The alternative {@link ResultSet#getCharacterStream(int)} provides true streaming but\n+     * the stream can be consumed only as long as {@link ResultSet} is open.\n+     */\n+    @Override\n+    public Reader getCharacterStream(ResultSet rs, int column) throws SQLException {\n+        Clob clob = rs.getClob(column);\n+        if (clob == null) {\n+            return null;\n+        }\n+        return clob.getCharacterStream();\n+    }\n+\n+    \n }"},{"sha":"56919a79a96916c4d5088b714b914be6dba4137f","filename":"openjpa-project/src/doc/manual/ref_guide_mapping.xml","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/openjpa-project/src/doc/manual/ref_guide_mapping.xml","raw_url":"https://github.com/apache/openjpa/raw/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/openjpa-project/src/doc/manual/ref_guide_mapping.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/ref_guide_mapping.xml?ref=c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","patch":"@@ -2501,7 +2501,7 @@ version is 8.3-603)\n                   </listitem>\n                   <listitem>\n                       <para>\n-SQLServer 2005\n+SQL Server 2005\n                       </para>\n                   </listitem>\n               </itemizedlist>\n@@ -2825,6 +2825,11 @@ Oracle\n PostgreSQL\n                     </para>\n                 </listitem>\n+                <listitem>\n+                    <para>\n+SQL Server\n+                    </para>\n+                </listitem>\n             </itemizedlist>\n             <para>\n See <xref linkend=\"supported_databases\"/> for possible database-specific"},{"sha":"0f6896899bb1d9ebf61fa7ea63a1dce63e88439f","filename":"openjpa-project/src/doc/manual/supported_databases.xml","status":"modified","additions":9,"deletions":2,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/openjpa-project/src/doc/manual/supported_databases.xml","raw_url":"https://github.com/apache/openjpa/raw/c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd/openjpa-project/src/doc/manual/supported_databases.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/supported_databases.xml?ref=c6459391c8a8668cfc0ecd7ba7de95f7b0f956bd","patch":"@@ -863,7 +863,7 @@ Using the Sun JDBC-ODBC bridge to connect is not supported.\n         </title>\n         <example id=\"example_props_sqlserver\">\n             <title>\n-                Example properties for Microsoft SQLServer\n+                Example properties for Microsoft SQL Server\n             </title>\n <programlisting>\n openjpa.ConnectionDriverName: com.microsoft.sqlserver.jdbc.SQLServerDriver\n@@ -937,6 +937,13 @@ generated values with SQL Server you should use GenerationType.IDENTITY,\n GenerationType.TABLE, or GenerationType.AUTO.\n                     </para> \n                 </listitem>\n+                <listitem>\n+                    <para>\n+The use of <link linkend=\"ref_guide_streamsupport\">LOB streaming</link> is limited.\n+When reading LOB data from the database, the Microsoft SQL Server driver will\n+actually load all the data into memory at the same time.\n+                    </para>\n+                </listitem>\n             </itemizedlist>\n         </section>\n     </section>\n@@ -1062,7 +1069,7 @@ to any value greater than zero will enable streaming result sets.\n                     <para>\n The use of <link linkend=\"ref_guide_streamsupport\">LOB streaming</link> is limited.\n When reading LOB data from the database, the MySQL JDBC driver will actually\n-load all the data in memory at the same time.\n+load all the data into memory at the same time.\n                     </para>\n                 </listitem>\n             </itemizedlist>"}]}

