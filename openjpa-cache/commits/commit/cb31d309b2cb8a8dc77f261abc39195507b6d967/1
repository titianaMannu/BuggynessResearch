{"sha":"cb31d309b2cb8a8dc77f261abc39195507b6d967","node_id":"MDY6Q29tbWl0MjA2MzY0OmNiMzFkMzA5YjJjYjhhOGRjNzdmMjYxYWJjMzkxOTU1MDdiNmQ5Njc=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2009-10-28T14:45:15Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2009-10-28T14:45:15Z"},"message":"OPENJPA-839 Create source jars for all artifacts by using maven-shade-plugin for the aggregate jars.  Also, removed OSGi metadata from openjpa.jar, as this will be handled by a new openjpa-osgi.jar instead.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@830564 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"bb91fa9ff6ec5ced28474510a8ac9e89b6756227","url":"https://api.github.com/repos/apache/openjpa/git/trees/bb91fa9ff6ec5ced28474510a8ac9e89b6756227"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/cb31d309b2cb8a8dc77f261abc39195507b6d967","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/cb31d309b2cb8a8dc77f261abc39195507b6d967","html_url":"https://github.com/apache/openjpa/commit/cb31d309b2cb8a8dc77f261abc39195507b6d967","comments_url":"https://api.github.com/repos/apache/openjpa/commits/cb31d309b2cb8a8dc77f261abc39195507b6d967/comments","author":null,"committer":null,"parents":[{"sha":"5016fc69f876b56f961f062b538440af8bdc7497","url":"https://api.github.com/repos/apache/openjpa/commits/5016fc69f876b56f961f062b538440af8bdc7497","html_url":"https://github.com/apache/openjpa/commit/5016fc69f876b56f961f062b538440af8bdc7497"}],"stats":{"total":211,"additions":102,"deletions":109},"files":[{"sha":"d6d5a072fbc6e64b6f8874dbf0227944132ded62","filename":"openjpa-all/pom.xml","status":"modified","additions":33,"deletions":0,"changes":33,"blob_url":"https://github.com/apache/openjpa/blob/cb31d309b2cb8a8dc77f261abc39195507b6d967/openjpa-all/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/cb31d309b2cb8a8dc77f261abc39195507b6d967/openjpa-all/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-all/pom.xml?ref=cb31d309b2cb8a8dc77f261abc39195507b6d967","patch":"@@ -34,6 +34,21 @@\n \n     <build>\n         <plugins>\n+            <!--\n+                 Need to disable source plugin here, as it overwrites the shade\n+                 plugin created sources jar.\n+            -->\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-source-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>attach-sources</id>\n+                        <phase>none</phase>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+            <!-- Create our aggregate all JAR -->\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-shade-plugin</artifactId>\n@@ -47,13 +62,26 @@\n                             <createDependencyReducedPom>true</createDependencyReducedPom>\n                             <createSourcesJar>true</createSourcesJar>\n                             <keepDependenciesWithProvidedScope>true</keepDependenciesWithProvidedScope>\n+                            <!-- \n+                                 Have to do this again here, as these settings\n+                                 from shaded openjpa.jar get lost in the shading\n+                            -->\n                             <transformers>\n+                                <!-- Need to concatinate the services resources:\n+                                 org.apache.openjpa.lib.conf.ProductDerivation\n+                                 javax.persistence.spi.PersistenceProvider\n+                                 org.apache.openjpa.kernel.exps.ExpressionParser\n+                                -->\n+                                <transformer implementation=\"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer\"/>\n+                                <!-- Need to add some MANIFEST.MF metadata -->\n                                 <transformer implementation=\"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer\">\n                                     <manifestEntries>\n                                         <Main-Class>org.apache.openjpa.conf.OpenJPAVersion</Main-Class>\n                                         <Premain-Class>org.apache.openjpa.enhance.PCEnhancerAgent</Premain-Class>\n                                         <Agent-Class>org.apache.openjpa.enhance.InstrumentationFactory</Agent-Class>\n                                         <Can-Redefine-Classes>true</Can-Redefine-Classes>\n+                                        <Can-Retransform-Classes>true</Can-Retransform-Classes>\n+                                        <Implementation-Title>Apache OpenJPA Aggregate JAR with dependencies</Implementation-Title>\n                                         <Specification-Title>JSR-317 Java Persistence</Specification-Title>\n                                         <Specification-Vendor>Sun Microsystems, Inc.</Specification-Vendor>\n                                         <Specification-Version>2.0</Specification-Version>\n@@ -66,6 +94,7 @@\n             </plugin>\n         </plugins>\n     </build>\n+\n     <dependencies>\n         <!--\n             Only include openjpa.jar and its required dependencies here, which\n@@ -76,6 +105,8 @@\n             <artifactId>openjpa</artifactId>\n             <version>${pom.version}</version>\n         </dependency>\n+\n+        <!-- Non-OpenJPA JARs to pull in -->\n         <dependency>\n             <groupId>net.sourceforge.serp</groupId>\n             <artifactId>serp</artifactId>\n@@ -104,11 +135,13 @@\n             <groupId>org.apache.geronimo.specs</groupId>\n             <artifactId>geronimo-jpa_2.0_spec</artifactId>\n         </dependency>\n+\n         <!-- optional runtime dependencies -->\n         <dependency>\n             <groupId>org.apache.geronimo.specs</groupId>\n             <artifactId>geronimo-jms_1.1_spec</artifactId>\n         </dependency>\n+\n         <!-- excluded optional runtime dependencies\n         <dependency>\n             <groupId>org.apache.geronimo.specs</groupId>"},{"sha":"ad905a9ce944a2671bb8f817e84962c011c9f758","filename":"openjpa-jdbc/pom.xml","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/cb31d309b2cb8a8dc77f261abc39195507b6d967/openjpa-jdbc/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/cb31d309b2cb8a8dc77f261abc39195507b6d967/openjpa-jdbc/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/pom.xml?ref=cb31d309b2cb8a8dc77f261abc39195507b6d967","patch":"@@ -42,11 +42,12 @@\n         <dependency>\n             <groupId>javax.xml.bind</groupId>\n             <artifactId>jaxb-api</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>com.sun.xml.bind</groupId>\n             <artifactId>jaxb-impl</artifactId>\n-            <scope>runtime</scope>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>hsqldb</groupId>"},{"sha":"382f8670e623b5abe9222cb9e174a4bfc153fa7a","filename":"openjpa/pom.xml","status":"modified","additions":50,"deletions":107,"changes":157,"blob_url":"https://github.com/apache/openjpa/blob/cb31d309b2cb8a8dc77f261abc39195507b6d967/openjpa/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/cb31d309b2cb8a8dc77f261abc39195507b6d967/openjpa/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa/pom.xml?ref=cb31d309b2cb8a8dc77f261abc39195507b6d967","patch":"@@ -34,198 +34,141 @@\n \n     <build>\n         <plugins>\n+            <!--\n+                 Need to disable source plugin here, as it overwrites the shade\n+                 plugin created sources jar.\n+            -->\n             <plugin>\n-                <!--\n-                    Manually build an aggregate jar of all the other\n-                    openjpa-* jars using ant. We cannot use the assembly\n-                    plugin, since it doesn't provide support for appending\n-                    multiple same-named files to each other (which is\n-                    required for correctly aggregating services files).\n-                -->\n                 <groupId>org.apache.maven.plugins</groupId>\n-                <artifactId>maven-antrun-plugin</artifactId>\n+                <artifactId>maven-source-plugin</artifactId>\n                 <executions>\n                     <execution>\n-                        <id>build-single-jar</id>\n-                        <phase>compile</phase>\n-                        <configuration>\n-                            <tasks>\n-                                <unjar overwrite=\"false\" dest=\"${basedir}/target/classes\">\n-                                    <fileset dir=\"${basedir}/..\">\n-                                        <include name=\"*/target/openjpa-*.jar\" />\n-                                        <exclude name=\"*/target/openjpa-examples-*.jar\" />\n-                                        <exclude name=\"*/target/openjpa-all-*.jar\" />\n-                                        <exclude name=\"**/*-tests.jar\" />\n-                                        <exclude name=\"**/*-sources.jar\" />\n-                                        <exclude name=\"**/*-javadoc.jar\" />\n-                                        <exclude name=\"openjpa-integration/**/target/openjpa-all-*.jar\" />\n-                                    </fileset>\n-                                </unjar>\n-\n-                                <!--\n-                                    need to manually concatinate the services \n-                                    resources so they are aggregated\n-                                -->\n-                                <macrodef name=\"aggregate-file\">\n-                                   <attribute name=\"servicename\" />\n-                                    <sequential>\n-                                        <echo>Building service: @{servicename}</echo>\n-                                        <concat destfile=\"${basedir}/target/classes/META-INF/services/@{servicename}\">\n-                                            <fileset dir=\"${basedir}/..\" includes=\"*/src/main/resources/META-INF/services/@{servicename}\" />\n-                                        </concat>\n-                                    </sequential>\n-                                </macrodef>\n-\n-                                <aggregate-file servicename=\"org.apache.openjpa.lib.conf.ProductDerivation\" />\n-                                <aggregate-file servicename=\"javax.persistence.spi.PersistenceProvider\" />\n-                                <aggregate-file servicename=\"org.apache.openjpa.kernel.exps.ExpressionParser\" />\n-                            </tasks>\n-                        </configuration>\n-                        <goals>\n-                            <goal>run</goal>\n-                        </goals>\n+                        <id>attach-sources</id>\n+                        <phase>none</phase> \n                     </execution>\n                 </executions>\n             </plugin>\n-\n-            <!--\n-                create enhancer pre-main and agent-main attributes\n-            -->\n+            <!-- Create our aggregate JAR -->\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n-                <artifactId>maven-jar-plugin</artifactId>\n-                <configuration>\n-                    <archive>\n-                        <manifestFile>${project.build.outputDirectory}/META-INF/MANIFEST.MF</manifestFile>\n-                        <manifest>\n-                           <mainClass>org.apache.openjpa.conf.OpenJPAVersion</mainClass>\n-                        </manifest>\n-                        <manifestEntries>\n-                            <Premain-Class>\n-                                org.apache.openjpa.enhance.PCEnhancerAgent\n-                            </Premain-Class>\n-                            <Can-Redefine-Classes>true</Can-Redefine-Classes>\n-                            <Agent-Class>\n-                                org.apache.openjpa.enhance.InstrumentationFactory\n-                            </Agent-Class>\n-                            <Can-Redefine-Classes>true</Can-Redefine-Classes>                            \n-                            <Can-Retransform-Classes>true</Can-Retransform-Classes>\n-                        </manifestEntries>\n-                    </archive>\n-                </configuration>\n-            </plugin>\n-\n-            <plugin>\n-                <groupId>org.apache.felix</groupId>\n-                <artifactId>maven-bundle-plugin</artifactId>\n-                <extensions>true</extensions>\n-                <configuration>\n-                    <instructions>\n-                        <Bundle-Name>${artifactId}</Bundle-Name>\n-                        <Bundle-SymbolicName>${groupId}.${artifactId};singleton=true</Bundle-SymbolicName>\n-                        <Bundle-DocURL>http://openjpa.apache.org/documentation.html</Bundle-DocURL>\n-                        <Implementation-Title>Apache OpenJPA</Implementation-Title>\n-                        <Implementation-Version>${project.version}</Implementation-Version>\n-                        <Specification-Title>JSR-317 Java Persistence</Specification-Title>\n-                        <Specification-Vendor>Sun Microsystems, Inc.</Specification-Vendor>\n-                        <Specification-Version>2.0</Specification-Version>\n-                        <!-- OSGi Bundle Metadata -->\n-                        <Private-Package>org.openjpa.lib.ant*,org.apache.jdbc.ant*,META-INF*</Private-Package>\n-                        <Export-Package>!META-INF*,!org.openjpa.lib.ant*,!org.apache.jdbc.ant*,org.apache.openjpa*</Export-Package>\n-                        <Import-Package>com.ibm.*;resolution:=optional,org.postgresql.*;resolution:=optional,org.apache.tools.ant.*;resolution:=optional,org.apache.log4j.*;resolution:=optional,javax.activation.xa*;resolution:=optional,javax.jms.*;resolution:=optional,javax.transaction.*;resolution:=optional,javax.validation.*;resolution:=optional,javax.xml.bind.*;resolution:=optional,serp.*;resolution:=optional,*</Import-Package>\n-                        <!-- Eclipse metadata -->\n-                        <Eclipse-Autostart>false</Eclipse-Autostart>\n-                        <Bundle-ClassPath>.</Bundle-ClassPath>\n-                    </instructions>\n-                    <unpackBundle>true</unpackBundle>\n-                </configuration>\n+                <artifactId>maven-shade-plugin</artifactId>\n                 <executions>\n                     <execution>\n-                        <id>bundle-manifest</id>\n-                        <phase>process-classes</phase>\n+                        <phase>package</phase>\n                         <goals>\n-                            <goal>manifest</goal>\n+                            <goal>shade</goal>\n                         </goals>\n+                        <configuration>\n+                            <createDependencyReducedPom>true</createDependencyReducedPom>\n+                            <createSourcesJar>true</createSourcesJar>\n+                            <keepDependenciesWithProvidedScope>true</keepDependenciesWithProvidedScope>\n+                            <transformers>\n+                                <!-- Need to concatinate the services resources:\n+                                 org.apache.openjpa.lib.conf.ProductDerivation\n+                                 javax.persistence.spi.PersistenceProvider\n+                                 org.apache.openjpa.kernel.exps.ExpressionParser\n+                                -->\n+                                <transformer implementation=\"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer\"/>\n+                                <!-- Need to add some MANIFEST.MF metadata -->\n+                                <transformer implementation=\"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer\">\n+                                    <manifestEntries>\n+                                        <Main-Class>org.apache.openjpa.conf.OpenJPAVersion</Main-Class>\n+                                        <Premain-Class>org.apache.openjpa.enhance.PCEnhancerAgent</Premain-Class>\n+                                        <Agent-Class>org.apache.openjpa.enhance.InstrumentationFactory</Agent-Class>\n+                                        <Can-Redefine-Classes>true</Can-Redefine-Classes>\n+                                        <Can-Retransform-Classes>true</Can-Retransform-Classes>\n+                                        <Implementation-Title>Apache OpenJPA Aggregate JAR</Implementation-Title>\n+                                        <Specification-Title>JSR-317 Java Persistence</Specification-Title>\n+                                        <Specification-Vendor>Sun Microsystems, Inc.</Specification-Vendor>\n+                                        <Specification-Version>2.0</Specification-Version>\n+                                    </manifestEntries>\n+                                </transformer>\n+                            </transformers>\n+                        </configuration>\n                     </execution>\n                 </executions>\n             </plugin>\n         </plugins>\n     </build>\n+\n     <dependencies>\n+        <!-- JARs to include in aggregate JAR via maven-shade-plugin -->\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-lib</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-kernel</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-jdbc</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-persistence</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-persistence-jdbc</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-xmlstore</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n             <artifactId>openjpa-slice</artifactId>\n             <version>${pom.version}</version>\n-            <scope>provided</scope>\n         </dependency>\n+\n+        <!-- JARs NOT included in aggregate JAR via maven-shade-plugin -->\n         <dependency>\n             <groupId>net.sourceforge.serp</groupId>\n             <artifactId>serp</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>commons-logging</groupId>\n             <artifactId>commons-logging</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>commons-lang</groupId>\n             <artifactId>commons-lang</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>commons-collections</groupId>\n             <artifactId>commons-collections</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>commons-pool</groupId>\n             <artifactId>commons-pool</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.geronimo.specs</groupId>\n             <artifactId>geronimo-jta_1.1_spec</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.geronimo.specs</groupId>\n             <artifactId>geronimo-jpa_2.0_spec</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n-        <!-- optional dependencies -->\n         <dependency>\n             <groupId>org.apache.geronimo.specs</groupId>\n             <artifactId>geronimo-jms_1.1_spec</artifactId>\n+            <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.apache.geronimo.specs</groupId>"},{"sha":"dd8b0704cd8bb617f503ee6d1f692261d6e9f0c6","filename":"pom.xml","status":"modified","additions":17,"deletions":1,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/cb31d309b2cb8a8dc77f261abc39195507b6d967/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/cb31d309b2cb8a8dc77f261abc39195507b6d967/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/pom.xml?ref=cb31d309b2cb8a8dc77f261abc39195507b6d967","patch":"@@ -572,6 +572,7 @@\n             </dependency>\n         </dependencies>\n     </dependencyManagement>\n+\n     <dependencies>\n         <dependency>\n             <groupId>junit</groupId>\n@@ -580,6 +581,7 @@\n             <scope>test</scope>\n         </dependency>\n     </dependencies>\n+\n     <build>\n         <pluginManagement>\n             <plugins>\n@@ -711,7 +713,7 @@\n                 <plugin>\n                     <groupId>org.apache.maven.plugins</groupId>\n                     <artifactId>maven-source-plugin</artifactId>\n-                    <version>2.0.4</version>\n+                    <version>2.1.1</version>\n                 </plugin>\n                 <plugin>\n                     <groupId>org.apache.maven.plugins</groupId>\n@@ -839,8 +841,22 @@\n                     </execution>\n                 </executions>\n             </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-source-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>attach-sources</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>jar</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n \t</plugins>\n     </build>\n+\n     <reporting>\n         <plugins>\n             <plugin>"}]}

