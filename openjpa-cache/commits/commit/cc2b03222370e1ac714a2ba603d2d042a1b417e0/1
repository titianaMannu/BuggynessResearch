{"sha":"cc2b03222370e1ac714a2ba603d2d042a1b417e0","node_id":"MDY6Q29tbWl0MjA2MzY0OmNjMmIwMzIyMjM3MGUxYWM3MTRhMmJhNjAzZDJkMDQyYTFiNDE3ZTA=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-10-03T00:18:37Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-10-03T00:18:37Z"},"message":"OPENJPA-368 -- putting Vikram's patch in 1.0.x. 'svn merge -c 581443 ../../trunk'\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.0.x@581444 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"b65a9f6b78cd764ede3982dc8c0e5bb411add2db","url":"https://api.github.com/repos/apache/openjpa/git/trees/b65a9f6b78cd764ede3982dc8c0e5bb411add2db"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/cc2b03222370e1ac714a2ba603d2d042a1b417e0","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/cc2b03222370e1ac714a2ba603d2d042a1b417e0","html_url":"https://github.com/apache/openjpa/commit/cc2b03222370e1ac714a2ba603d2d042a1b417e0","comments_url":"https://api.github.com/repos/apache/openjpa/commits/cc2b03222370e1ac714a2ba603d2d042a1b417e0/comments","author":null,"committer":null,"parents":[{"sha":"4cc061e5dc19c60f76468f43aed7436026a73c01","url":"https://api.github.com/repos/apache/openjpa/commits/4cc061e5dc19c60f76468f43aed7436026a73c01","html_url":"https://github.com/apache/openjpa/commit/4cc061e5dc19c60f76468f43aed7436026a73c01"}],"stats":{"total":11,"additions":6,"deletions":5},"files":[{"sha":"93b2279a47ea49f036e7f8f71512df9c4bff6e31","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/cc2b03222370e1ac714a2ba603d2d042a1b417e0/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java","raw_url":"https://github.com/apache/openjpa/raw/cc2b03222370e1ac714a2ba603d2d042a1b417e0/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java?ref=cc2b03222370e1ac714a2ba603d2d042a1b417e0","patch":"@@ -45,7 +45,7 @@\n \n     protected int type = TYPE_DEFAULT;\n     protected Object current = null;\n-    private transient Transaction _outerTransaction;\n+    private static ThreadLocal _outerTransaction = new ThreadLocal();\n \n     /**\n      * Records the sequence type.\n@@ -155,7 +155,7 @@ else if (suspendInJTA()) {\n             try {\n                 TransactionManager tm = getConfiguration()\n                     .getManagedRuntimeInstance().getTransactionManager();\n-                _outerTransaction = tm.suspend();\n+                _outerTransaction.set(tm.suspend());\n                 tm.begin();\n                 return store.getConnection();\n             } catch (Exception e) {\n@@ -188,13 +188,14 @@ protected void closeConnection(Connection conn) {\n                 tm.commit();\n                 try { conn.close(); } catch (SQLException se) {}\n \n-                if (_outerTransaction != null)\n-                    tm.resume(_outerTransaction);\n+                Transaction outerTxn = (Transaction)_outerTransaction.get();\n+                if (outerTxn != null)\n+                    tm.resume(outerTxn);\n \n             } catch (Exception e) {\n                 throw new StoreException(e);\n             } finally {\n-                _outerTransaction = null;\n+                _outerTransaction.set(null);\n             }\n         } else {\n             try {"}]}

