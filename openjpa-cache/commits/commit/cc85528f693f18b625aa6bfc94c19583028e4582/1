{"sha":"cc85528f693f18b625aa6bfc94c19583028e4582","node_id":"MDY6Q29tbWl0MjA2MzY0OmNjODU1MjhmNjkzZjE4YjYyNWFhNmJmYzk0YzE5NTgzMDI4ZTQ1ODI=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2008-07-11T13:48:50Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2008-07-11T13:48:50Z"},"message":"OPENJPA-656 : raise informational error on initial connection failure\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@675952 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c52c3475e05fb6f903d32170abee388b3555978a","url":"https://api.github.com/repos/apache/openjpa/git/trees/c52c3475e05fb6f903d32170abee388b3555978a"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/cc85528f693f18b625aa6bfc94c19583028e4582","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/cc85528f693f18b625aa6bfc94c19583028e4582","html_url":"https://github.com/apache/openjpa/commit/cc85528f693f18b625aa6bfc94c19583028e4582","comments_url":"https://api.github.com/repos/apache/openjpa/commits/cc85528f693f18b625aa6bfc94c19583028e4582/comments","author":null,"committer":null,"parents":[{"sha":"07919b9becd533a113949dce397a2d6ba1879f69","url":"https://api.github.com/repos/apache/openjpa/commits/07919b9becd533a113949dce397a2d6ba1879f69","html_url":"https://github.com/apache/openjpa/commit/07919b9becd533a113949dce397a2d6ba1879f69"}],"stats":{"total":33,"additions":30,"deletions":3},"files":[{"sha":"a0779931bdd587e06b4718e7487b698a93f734ac","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/DataSourceFactory.java","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/DataSourceFactory.java","raw_url":"https://github.com/apache/openjpa/raw/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/DataSourceFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/DataSourceFactory.java?ref=cc85528f693f18b625aa6bfc94c19583028e4582","patch":"@@ -237,7 +237,14 @@ public static DecoratingDataSource installDBDictionary(DBDictionary dict,\n \n             return ds;\n         } catch (Exception e) {\n-            throw new StoreException(e).setFatal(true);\n+        \tthrow new StoreException(_loc.get(\"conn-failed\", factory2 \n+        \t  ? new Object[]{conf.getConnection2DriverName(), \n+        \t\t\t         conf.getConnection2URL(), \n+        \t\t\t         conf.getConnection2Properties()}\n+        \t  : new Object[]{conf.getConnectionDriverName(),\n+        \t\t             conf.getConnectionURL(), \n+        \t\t             conf.getConnectionProperties()}),\n+        \t\t             e);\n         } finally {\n             if (conn != null)\n                 try {"},{"sha":"0644845a5e7ee026b9580585377fe820e7723fdb","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SimpleDriverDataSource.java","status":"modified","additions":11,"deletions":1,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SimpleDriverDataSource.java","raw_url":"https://github.com/apache/openjpa/raw/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SimpleDriverDataSource.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SimpleDriverDataSource.java?ref=cc85528f693f18b625aa6bfc94c19583028e4582","patch":"@@ -30,7 +30,9 @@\n \n import org.apache.openjpa.jdbc.sql.DBDictionary;\n import org.apache.openjpa.lib.util.J2DoPrivHelper;\n+import org.apache.openjpa.lib.util.Localizer;\n import org.apache.openjpa.util.StoreException;\n+import org.apache.openjpa.util.UserException;\n \n /**\n  * Non-pooling driver data source.\n@@ -46,6 +48,9 @@\n     private Properties _connectionFactoryProperties;\n     private Driver _driver;\n     private ClassLoader _classLoader;\n+    \n+    protected static Localizer _loc = \n+    \tLocalizer.forPackage(SimpleDriverDataSource.class);\n \n     public Connection getConnection()\n         throws SQLException {\n@@ -70,7 +75,12 @@ public Connection getConnection(String username, String password)\n \n     public Connection getConnection(Properties props)\n         throws SQLException {\n-        return getDriver().connect(_connectionURL, props);\n+    \tConnection con = getDriver().connect(_connectionURL, props);\n+    \tif (con == null) {\n+        \tthrow new UserException(_loc.get(\"conn-failed\",\n+        \t\t\t_connectionDriverName, _connectionURL, props));\n+        }\n+        return con;\n     }\n \n     public int getLoginTimeout() {"},{"sha":"cab55e1bef5782aabf0393cddd2d999ea85c868b","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/schema/localizer.properties","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/schema/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/schema/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/schema/localizer.properties?ref=cc85528f693f18b625aa6bfc94c19583028e4582","patch":"@@ -148,4 +148,6 @@ no-custom-ds: use a custom DataSource\n delete-table-contents: An error occurred while attempting to delete all \\\n     records from all mapped tables.\n set-auto-commit: DataSource connection setAutoCommit to \"{0}\"\n-\n+conn-failed: Failed to connect to DataSource. Verify Driver \"{0}\", URL \"{1}\" \\\n+\tand connection properties \"{2}\" are correct. See the nested exception for \\\n+\tfurther details."},{"sha":"bb831727ee46097c135034ba3849b10a98030c5b","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/util/StoreException.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/apache/openjpa/blob/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-kernel/src/main/java/org/apache/openjpa/util/StoreException.java","raw_url":"https://github.com/apache/openjpa/raw/cc85528f693f18b625aa6bfc94c19583028e4582/openjpa-kernel/src/main/java/org/apache/openjpa/util/StoreException.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/util/StoreException.java?ref=cc85528f693f18b625aa6bfc94c19583028e4582","patch":"@@ -47,6 +47,14 @@ public StoreException(Throwable cause) {\n         super(cause);\n     }\n \n+    public StoreException(String msg, Throwable cause) {\n+        super(msg, cause);\n+    }\n+\n+    public StoreException(Message msg, Throwable cause) {\n+        super(msg.getMessage(), cause);\n+    }\n+    \n     public int getType() {\n         return STORE;\n     }"}]}

