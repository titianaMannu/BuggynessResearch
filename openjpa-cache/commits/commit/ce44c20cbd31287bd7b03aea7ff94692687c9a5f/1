{"sha":"ce44c20cbd31287bd7b03aea7ff94692687c9a5f","node_id":"MDY6Q29tbWl0MjA2MzY0OmNlNDRjMjBjYmQzMTI4N2JkN2IwM2FlYTdmZjk0NjkyNjg3YzlhNWY=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-01-25T21:59:50Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-01-25T21:59:50Z"},"message":"OPENJPA-437\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.0.x@615368 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"5831520c68cd0cd1442a0953d627f64c067bface","url":"https://api.github.com/repos/apache/openjpa/git/trees/5831520c68cd0cd1442a0953d627f64c067bface"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/ce44c20cbd31287bd7b03aea7ff94692687c9a5f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/ce44c20cbd31287bd7b03aea7ff94692687c9a5f","html_url":"https://github.com/apache/openjpa/commit/ce44c20cbd31287bd7b03aea7ff94692687c9a5f","comments_url":"https://api.github.com/repos/apache/openjpa/commits/ce44c20cbd31287bd7b03aea7ff94692687c9a5f/comments","author":null,"committer":null,"parents":[{"sha":"3a7f54f3d920614e5ec58855b432248d2845f08c","url":"https://api.github.com/repos/apache/openjpa/commits/3a7f54f3d920614e5ec58855b432248d2845f08c","html_url":"https://github.com/apache/openjpa/commit/3a7f54f3d920614e5ec58855b432248d2845f08c"}],"stats":{"total":7,"additions":4,"deletions":3},"files":[{"sha":"940ab43822a30e8eb780965c49bd1e9c480e8d6e","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/ce44c20cbd31287bd7b03aea7ff94692687c9a5f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java","raw_url":"https://github.com/apache/openjpa/raw/ce44c20cbd31287bd7b03aea7ff94692687c9a5f/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractBrokerFactory.java?ref=ce44c20cbd31287bd7b03aea7ff94692687c9a5f","patch":"@@ -46,7 +46,6 @@\n import org.apache.openjpa.lib.log.Log;\n import org.apache.openjpa.lib.util.J2DoPrivHelper;\n import org.apache.openjpa.lib.util.Localizer;\n-import org.apache.openjpa.lib.util.ReferenceHashSet;\n import org.apache.openjpa.lib.util.JavaVersions;\n import org.apache.openjpa.lib.util.concurrent.ConcurrentHashMap;\n import org.apache.openjpa.lib.util.concurrent.ConcurrentReferenceHashSet;\n@@ -134,7 +133,8 @@ protected static AbstractBrokerFactory getPooledFactory(Map map) {\n      */\n     protected AbstractBrokerFactory(OpenJPAConfiguration config) {\n         _conf = config;\n-        _pcClassLoaders = new ReferenceHashSet(ReferenceHashSet.WEAK);\n+        _pcClassLoaders = new ConcurrentReferenceHashSet(\n+            ConcurrentReferenceHashSet.WEAK);\n     }\n \n     /**\n@@ -256,7 +256,7 @@ private void loadPersistentTypes(ClassLoader envLoader) {\n             if (clss.isEmpty())\n                 _pcClassNames = Collections.EMPTY_SET;\n             else {\n-                _pcClassNames = new ConcurrentReferenceHashSet(\n+                Collection c = new ConcurrentReferenceHashSet(\n                     ConcurrentReferenceHashSet.HARD);\n                 for (Iterator itr = clss.iterator(); itr.hasNext();) {\n                     Class cls = (Class) itr.next();\n@@ -265,6 +265,7 @@ private void loadPersistentTypes(ClassLoader envLoader) {\n                         toRedefine.add(cls);\n                 }\n                 _pcClassLoaders.add(loader);\n+                _pcClassNames = c;\n             }\n             _persistentTypesLoaded = true;\n         } else {"}]}

