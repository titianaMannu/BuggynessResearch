{"sha":"cfea146c2953a8b46abed0f5de50cf42701ccf7b","node_id":"MDY6Q29tbWl0MjA2MzY0OmNmZWExNDZjMjk1M2E4YjQ2YWJlZDBmNWRlNTBjZjQyNzAxY2NmN2I=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2009-11-16T18:27:20Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2009-11-16T18:27:20Z"},"message":"OPENJPA-1381: Ignore preapared query if lock mode changes\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@880891 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"1e566e2256a207070cd2ec829af83e42b9697a44","url":"https://api.github.com/repos/apache/openjpa/git/trees/1e566e2256a207070cd2ec829af83e42b9697a44"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/cfea146c2953a8b46abed0f5de50cf42701ccf7b","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/cfea146c2953a8b46abed0f5de50cf42701ccf7b","html_url":"https://github.com/apache/openjpa/commit/cfea146c2953a8b46abed0f5de50cf42701ccf7b","comments_url":"https://api.github.com/repos/apache/openjpa/commits/cfea146c2953a8b46abed0f5de50cf42701ccf7b/comments","author":null,"committer":null,"parents":[{"sha":"5143d0cafd3ccd45a973f5945561675d87a5e81c","url":"https://api.github.com/repos/apache/openjpa/commits/5143d0cafd3ccd45a973f5945561675d87a5e81c","html_url":"https://github.com/apache/openjpa/commit/5143d0cafd3ccd45a973f5945561675d87a5e81c"}],"stats":{"total":8,"additions":6,"deletions":2},"files":[{"sha":"303a8d3217f67165e3dd2554c4a36f6866b50868","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jdbc/sqlcache/TestPreparedQueryCache.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/cfea146c2953a8b46abed0f5de50cf42701ccf7b/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jdbc/sqlcache/TestPreparedQueryCache.java","raw_url":"https://github.com/apache/openjpa/raw/cfea146c2953a8b46abed0f5de50cf42701ccf7b/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jdbc/sqlcache/TestPreparedQueryCache.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jdbc/sqlcache/TestPreparedQueryCache.java?ref=cfea146c2953a8b46abed0f5de50cf42701ccf7b","patch":"@@ -751,6 +751,7 @@ public void testPreparedQueryIgnoredWhenLockModeIsSet() {\n         em.getTransaction().begin();\n         Query q2 = em.createQuery(jpql);\n         assertEquals(QueryLanguages.LANG_PREPARED_SQL, OpenJPAPersistence.cast(q2).getLanguage());\n+        q2.getLockMode();\n         q2.setLockMode(LockModeType.OPTIMISTIC);\n         assertEquals(JPQLParser.LANG_JPQL, OpenJPAPersistence.cast(q2).getLanguage());\n         List<Author> authors2 = q2.getResultList();"},{"sha":"b6555c9dee902b349a9fd8b22dc6ad5113a89af7","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java","status":"modified","additions":5,"deletions":2,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/cfea146c2953a8b46abed0f5de50cf42701ccf7b/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java","raw_url":"https://github.com/apache/openjpa/raw/cfea146c2953a8b46abed0f5de50cf42701ccf7b/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java?ref=cfea146c2953a8b46abed0f5de50cf42701ccf7b","patch":"@@ -377,9 +377,12 @@ public boolean isNative() {\n \t */\n \tvoid assertJPQLOrCriteriaQuery() {\n         String language = getLanguage();\n-        if (!(JPQLParser.LANG_JPQL.equals(language) || CriteriaBuilderImpl.LANG_CRITERIA.equals(language))) {\n-            throw new IllegalStateException(_loc.get(\"not-jpql-or-criteria-query\").getMessage());\n+        if (JPQLParser.LANG_JPQL.equals(language) \n+         || QueryLanguages.LANG_PREPARED_SQL.equals(language)\n+         || CriteriaBuilderImpl.LANG_CRITERIA.equals(language)) {\n+            return;\n         }\n+        throw new IllegalStateException(_loc.get(\"not-jpql-or-criteria-query\").getMessage());\n \t}\n \n \tpublic OpenJPAQuery<X> closeAll() {"}]}

