{"sha":"d2264b92bb5aea7f7e345421ad845879f1fd8179","node_id":"MDY6Q29tbWl0MjA2MzY0OmQyMjY0YjkyYmI1YWVhN2Y3ZTM0NTQyMWFkODQ1ODc5ZjFmZDgxNzk=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-01-07T20:09:05Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-01-07T20:09:05Z"},"message":"Port of r603666 to 1.0.x. Change Services.getImplementorClasses(Class) and Services.getImplementorClasses(Class,ClassLoader) to filter out implementations that are not assignable to the Class argument. This allows the Services call to be more fault-tolerant in environments with odd classloader configurations.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.0.x@609766 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"15684544140f8d63cf3141ddeef5774a8e6330f8","url":"https://api.github.com/repos/apache/openjpa/git/trees/15684544140f8d63cf3141ddeef5774a8e6330f8"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/d2264b92bb5aea7f7e345421ad845879f1fd8179","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/d2264b92bb5aea7f7e345421ad845879f1fd8179","html_url":"https://github.com/apache/openjpa/commit/d2264b92bb5aea7f7e345421ad845879f1fd8179","comments_url":"https://api.github.com/repos/apache/openjpa/commits/d2264b92bb5aea7f7e345421ad845879f1fd8179/comments","author":null,"committer":null,"parents":[{"sha":"cae90a6cf2731b91b6a6b409d42578b77fcbec5a","url":"https://api.github.com/repos/apache/openjpa/commits/cae90a6cf2731b91b6a6b409d42578b77fcbec5a","html_url":"https://github.com/apache/openjpa/commit/cae90a6cf2731b91b6a6b409d42578b77fcbec5a"}],"stats":{"total":18,"additions":17,"deletions":1},"files":[{"sha":"e50280fd5300cc6c969f325a337938f379a324f6","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Services.java","status":"modified","additions":17,"deletions":1,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/d2264b92bb5aea7f7e345421ad845879f1fd8179/openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Services.java","raw_url":"https://github.com/apache/openjpa/raw/d2264b92bb5aea7f7e345421ad845879f1fd8179/openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Services.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Services.java?ref=d2264b92bb5aea7f7e345421ad845879f1fd8179","patch":"@@ -25,7 +25,9 @@\n import java.net.URL;\n import java.security.AccessController;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.Enumeration;\n+import java.util.HashSet;\n import java.util.List;\n import java.util.Set;\n import java.util.StringTokenizer;\n@@ -145,7 +147,21 @@ private static void addResources(URL url, Set set) throws IOException {\n \n     public static Class[] getImplementorClasses(Class serviceClass,\n         ClassLoader loader) {\n-        return getImplementorClasses(serviceClass.getName(), loader);\n+        Set invalid = new HashSet();\n+        Class[] classes = getImplementorClasses(serviceClass.getName(), loader);\n+\n+        // filter out any classes that have any classloader issues wrt.\n+        // the specified service class.\n+        for (int i = 0; i < classes.length; i++)\n+            if (!serviceClass.isAssignableFrom(classes[i]))\n+                invalid.add(classes[i]);\n+        if (invalid.size() != 0) {\n+            List list = new ArrayList(Arrays.asList(classes));\n+            list.removeAll(invalid);\n+            return (Class[]) list.toArray(new Class[list.size()]);\n+        } else {\n+            return classes;\n+        }\n     }\n \n     /**"}]}

