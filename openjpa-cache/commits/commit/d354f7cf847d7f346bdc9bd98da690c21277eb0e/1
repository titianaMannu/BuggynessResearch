{"sha":"d354f7cf847d7f346bdc9bd98da690c21277eb0e","node_id":"MDY6Q29tbWl0MjA2MzY0OmQzNTRmN2NmODQ3ZDdmMzQ2YmRjOWJkOThkYTY5MGMyMTI3N2ViMGU=","commit":{"author":{"name":"Richard G. Curtis","email":"curtisr7@apache.org","date":"2012-01-13T22:59:33Z"},"committer":{"name":"Richard G. Curtis","email":"curtisr7@apache.org","date":"2012-01-13T22:59:33Z"},"message":"OPENJPA-2107: Only reset Broker.flushed flag if initializing a new Statemanager.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1231375 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7d772c3f63b3e4d4952351c2fbf9487a09c66edc","url":"https://api.github.com/repos/apache/openjpa/git/trees/7d772c3f63b3e4d4952351c2fbf9487a09c66edc"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/d354f7cf847d7f346bdc9bd98da690c21277eb0e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/d354f7cf847d7f346bdc9bd98da690c21277eb0e","html_url":"https://github.com/apache/openjpa/commit/d354f7cf847d7f346bdc9bd98da690c21277eb0e","comments_url":"https://api.github.com/repos/apache/openjpa/commits/d354f7cf847d7f346bdc9bd98da690c21277eb0e/comments","author":null,"committer":null,"parents":[{"sha":"e267cdd56224e960e05c0842f2c99047e7cd532e","url":"https://api.github.com/repos/apache/openjpa/commits/e267cdd56224e960e05c0842f2c99047e7cd532e","html_url":"https://github.com/apache/openjpa/commit/e267cdd56224e960e05c0842f2c99047e7cd532e"}],"stats":{"total":21,"additions":13,"deletions":8},"files":[{"sha":"5253b4db064dd73d0e976aa3b317895c61f69d4c","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","status":"modified","additions":5,"deletions":4,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/d354f7cf847d7f346bdc9bd98da690c21277eb0e/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/d354f7cf847d7f346bdc9bd98da690c21277eb0e/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/BrokerImpl.java?ref=d354f7cf847d7f346bdc9bd98da690c21277eb0e","patch":"@@ -4110,10 +4110,11 @@ protected void setStateManager(Object id, StateManagerImpl sm, int status) {\n         lock();\n         try {\n             switch (status) {\n-                case STATUS_INIT:                \t\n-                \tif (_compat.getResetFlushFlagForCascadePersist()){//OPENJPA-2051                \t\n-                \t\t_flags &= ~FLAG_FLUSHED;\n-                \t}\n+                case STATUS_INIT:\n+                    // Only reset the flushed flag is this is a new instance.\n+                    if (sm.isNew() && _compat.getResetFlushFlagForCascadePersist()) {// OPENJPA-2051\n+                        _flags &= ~FLAG_FLUSHED;\n+                    }\n                     _cache.add(sm);\n                     break;\n                 case STATUS_TRANSIENT:"},{"sha":"1dd04edd92d45d23e3fee7de1e29b50f6bf92248","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSimple.java","status":"modified","additions":8,"deletions":4,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/d354f7cf847d7f346bdc9bd98da690c21277eb0e/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSimple.java","raw_url":"https://github.com/apache/openjpa/raw/d354f7cf847d7f346bdc9bd98da690c21277eb0e/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSimple.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSimple.java?ref=d354f7cf847d7f346bdc9bd98da690c21277eb0e","patch":"@@ -51,12 +51,16 @@ public void testSimple() throws java.io.IOException {\n         {\n             EntityManager em = currentEntityManager();\n             startTx(em);\n-            List l = em.createQuery(\"SELECT o FROM Entity1 o \"\n-                + \"WHERE o.stringField = 'testSimple'\").getResultList();\n-            assertSize(1, l);\n-            endTx(em);\n+            em.persist(new Entity1(1, \"testSimple\", 12));\n+            List<Entity1> l =\n+                em.createQuery(\"SELECT o FROM Entity1 o \" + \"WHERE o.stringField = 'testSimple'\", Entity1.class)\n+                    .getResultList();\n+            assertSize(2, l);\n+            rollbackTx(em);\n+            em.clear();\n             endEm(em);\n         }\n+        \n \n         // test Update\n         {"}]}

