{"sha":"d3956a7d98811c749774afa8731c14a5330909b5","node_id":"MDY6Q29tbWl0MjA2MzY0OmQzOTU2YTdkOTg4MTFjNzQ5Nzc0YWZhODczMWMxNGE1MzMwOTA5YjU=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-09-25T00:19:36Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-09-25T00:19:36Z"},"message":"Override \"ON DELETE SET NULL\" foreign keys if the foreign column is \"NOT NULL\".\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@449532 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"6d7d999f93219c2922cfbdeb219fd5d54f1ea07f","url":"https://api.github.com/repos/apache/openjpa/git/trees/6d7d999f93219c2922cfbdeb219fd5d54f1ea07f"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/d3956a7d98811c749774afa8731c14a5330909b5","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/d3956a7d98811c749774afa8731c14a5330909b5","html_url":"https://github.com/apache/openjpa/commit/d3956a7d98811c749774afa8731c14a5330909b5","comments_url":"https://api.github.com/repos/apache/openjpa/commits/d3956a7d98811c749774afa8731c14a5330909b5/comments","author":null,"committer":null,"parents":[{"sha":"a8c1fad16c19a92ea3585965cc4ca08459d01723","url":"https://api.github.com/repos/apache/openjpa/commits/a8c1fad16c19a92ea3585965cc4ca08459d01723","html_url":"https://github.com/apache/openjpa/commit/a8c1fad16c19a92ea3585965cc4ca08459d01723"}],"stats":{"total":14,"additions":11,"deletions":3},"files":[{"sha":"d04037bf7a80ed281b8b32bc853f61c0f37c3955","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":11,"deletions":3,"changes":14,"blob_url":"https://github.com/apache/openjpa/blob/d3956a7d98811c749774afa8731c14a5330909b5/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/d3956a7d98811c749774afa8731c14a5330909b5/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=d3956a7d98811c749774afa8731c14a5330909b5","patch":"@@ -2908,12 +2908,20 @@ protected String getForeignKeyConstraintSQL(ForeignKey fk) {\n             || !supportsUpdateAction(fk.getUpdateAction()))\n             return null;\n \n-        String delAction = getActionName(fk.getDeleteAction());\n-        String upAction = getActionName(fk.getUpdateAction());\n-\n         Column[] locals = fk.getColumns();\n         Column[] foreigns = fk.getPrimaryKeyColumns();\n \n+        int delActionId = fk.getDeleteAction();\n+        if (delActionId == ForeignKey.ACTION_NULL) {\n+            for (int i = 0; i < foreigns.length; i++) {\n+                if (foreigns[i].isNotNull())\n+                    delActionId = ForeignKey.ACTION_NONE;\n+            }\n+        }\n+\n+        String delAction = getActionName(delActionId);\n+        String upAction = getActionName(fk.getUpdateAction());\n+\n         StringBuffer buf = new StringBuffer();\n         if (fk.getName() != null\n             && CONS_NAME_BEFORE.equals(constraintNameMode))"}]}

