{"sha":"d81cbbd8bba4f3808e29c86cfec7b01425ccca06","node_id":"MDY6Q29tbWl0MjA2MzY0OmQ4MWNiYmQ4YmJhNGYzODA4ZTI5Yzg2Y2ZlYzdiMDE0MjVjY2NhMDY=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2010-03-25T22:53:14Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2010-03-25T22:53:14Z"},"message":"OPENJPA-1599 - Retain em method user input property map content from modifications.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/2.0.x@927630 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"1874ab849a716522c095b136c6e81bf3184fc4cf","url":"https://api.github.com/repos/apache/openjpa/git/trees/1874ab849a716522c095b136c6e81bf3184fc4cf"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/d81cbbd8bba4f3808e29c86cfec7b01425ccca06","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/d81cbbd8bba4f3808e29c86cfec7b01425ccca06","html_url":"https://github.com/apache/openjpa/commit/d81cbbd8bba4f3808e29c86cfec7b01425ccca06","comments_url":"https://api.github.com/repos/apache/openjpa/commits/d81cbbd8bba4f3808e29c86cfec7b01425ccca06/comments","author":null,"committer":null,"parents":[{"sha":"7382ba2f8442511aa59750af23c932f4e5534f2b","url":"https://api.github.com/repos/apache/openjpa/commits/7382ba2f8442511aa59750af23c932f4e5534f2b","html_url":"https://github.com/apache/openjpa/commit/7382ba2f8442511aa59750af23c932f4e5534f2b"}],"stats":{"total":10,"additions":10,"deletions":0},"files":[{"sha":"d26fb0194d338ec08f89f0f369216fb7b6c91322","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/apache/openjpa/blob/d81cbbd8bba4f3808e29c86cfec7b01425ccca06/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/d81cbbd8bba4f3808e29c86cfec7b01425ccca06/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java?ref=d81cbbd8bba4f3808e29c86cfec7b01425ccca06","patch":"@@ -33,6 +33,7 @@\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.EnumSet;\n+import java.util.HashMap;\n import java.util.IdentityHashMap;\n import java.util.Map;\n import java.util.Set;\n@@ -487,6 +488,7 @@ public void setLifecycleListenerCallbackMode(int callbackMode) {\n     @SuppressWarnings(\"unchecked\")\n     public <T> T find(Class<T> cls, Object oid, LockModeType mode, Map<String, Object> properties) {\n         assertNotCloseInvoked();\n+        properties = cloneProperties(properties);\n         configureCurrentCacheModes(pushFetchPlan(), properties);\n         configureCurrentFetchPlan(getFetchPlan(), properties, mode, true);\n         try {\n@@ -1186,6 +1188,7 @@ public void lock(Object entity, LockModeType mode, Map<String, Object> propertie\n         assertNotCloseInvoked();\n         assertValidAttchedEntity(LOCK, entity);\n         _broker.assertActiveTransaction();\n+        properties = cloneProperties(properties);\n         configureCurrentCacheModes(pushFetchPlan(), properties);\n         configureCurrentFetchPlan(getFetchPlan(), properties, mode, false);\n         try {\n@@ -1808,4 +1811,11 @@ Object convertUserValue(String key, Object value, Class<?> targetType) {\n         }\n         return value;\n     }\n+\n+    private Map<String, Object> cloneProperties(Map<String, Object> properties) {\n+        if (properties != null) {\n+            properties = new HashMap<String, Object>(properties);\n+        }\n+        return properties;\n+    }\n }"}]}

