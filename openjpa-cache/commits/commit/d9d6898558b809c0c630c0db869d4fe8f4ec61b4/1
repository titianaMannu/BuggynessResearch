{"sha":"d9d6898558b809c0c630c0db869d4fe8f4ec61b4","node_id":"MDY6Q29tbWl0MjA2MzY0OmQ5ZDY4OTg1NThiODA5YzBjNjMwYzBkYjg2OWQ0ZmU4ZjRlYzYxYjQ=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2009-11-16T21:49:59Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2009-11-16T21:49:59Z"},"message":"OPENJPA-1051\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@880980 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"9c607561d51aa27677975c74f4ba47ddbe532356","url":"https://api.github.com/repos/apache/openjpa/git/trees/9c607561d51aa27677975c74f4ba47ddbe532356"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/d9d6898558b809c0c630c0db869d4fe8f4ec61b4","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/d9d6898558b809c0c630c0db869d4fe8f4ec61b4","html_url":"https://github.com/apache/openjpa/commit/d9d6898558b809c0c630c0db869d4fe8f4ec61b4","comments_url":"https://api.github.com/repos/apache/openjpa/commits/d9d6898558b809c0c630c0db869d4fe8f4ec61b4/comments","author":null,"committer":null,"parents":[{"sha":"9a7bab2a6a54849fe98de374be278f3c303e68ec","url":"https://api.github.com/repos/apache/openjpa/commits/9a7bab2a6a54849fe98de374be278f3c303e68ec","html_url":"https://github.com/apache/openjpa/commit/9a7bab2a6a54849fe98de374be278f3c303e68ec"}],"stats":{"total":41,"additions":5,"deletions":36},"files":[{"sha":"e3eb123491960bc1c6279f0f7c3df0d921ee0141","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingDefaultsImpl.java","status":"modified","additions":4,"deletions":15,"changes":19,"blob_url":"https://github.com/apache/openjpa/blob/d9d6898558b809c0c630c0db869d4fe8f4ec61b4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingDefaultsImpl.java","raw_url":"https://github.com/apache/openjpa/raw/d9d6898558b809c0c630c0db869d4fe8f4ec61b4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingDefaultsImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/MappingDefaultsImpl.java?ref=d9d6898558b809c0c630c0db869d4fe8f4ec61b4","patch":"@@ -539,9 +539,7 @@ public void populateDataStoreIdColumns(ClassMapping cls, Table table,\n             else if (_dsIdName != null)\n                 cols[i].setName(_dsIdName + i);\n             correctName(table, cols[i]);\n-            table.addSubColumn(cols[i].getName());\n         }\n-        table.resetSubColumns();\n     }\n \n     /**\n@@ -553,7 +551,9 @@ protected void correctName(Table table, Column col) {\n             String name = col.getName();\n             if (_removeHungarianNotation)\n                 name = removeHungarianNotation(name);\n-            col.setName(dict.getValidColumnName(name, table));\n+            String correctedName = dict.getValidColumnName(name, table);\n+            col.setName(correctedName);\n+            table.addCorrectedColumnName(correctedName, true);\n         }\n     }\n \n@@ -584,9 +584,7 @@ else if (_versName != null) {\n             } else if (_versName != null)\n                 cols[i].setName(_versName + i);\n             correctName(table, cols[i]);\n-            table.addSubColumn(cols[i].getName());\n         }\n-        table.resetSubColumns();\n     }\n \n     public void populateColumns(Discriminator disc, Table table,\n@@ -597,9 +595,7 @@ public void populateColumns(Discriminator disc, Table table,\n             else if (_discName != null)\n                 cols[i].setName(_discName + i);\n             correctName(table, cols[i]);\n-            table.addSubColumn(cols[i].getName());\n         }\n-        table.resetSubColumns();\n     }\n \n     public void populateJoinColumn(ClassMapping cm, Table local, Table foreign,\n@@ -624,11 +620,8 @@ else if (target instanceof Column)\n \n     public void populateColumns(ValueMapping vm, String name, Table table,\n         Column[] cols) {\n-        for (int i = 0; i < cols.length; i++) {\n+        for (int i = 0; i < cols.length; i++)\n             correctName(table, cols[i]);\n-            table.addSubColumn(cols[i].getName());\n-        }\n-        table.resetSubColumns();\n     }\n \n     public boolean populateOrderColumns(FieldMapping fm, Table table,\n@@ -639,9 +632,7 @@ public boolean populateOrderColumns(FieldMapping fm, Table table,\n             else if (_orderName != null)\n                 cols[i].setName(_orderName + i);\n             correctName(table, cols[i]);\n-            table.addSubColumn(cols[i].getName());\n         }\n-        table.resetSubColumns();\n         return _orderLists && (JavaTypes.ARRAY == fm.getTypeCode()\n             || List.class.isAssignableFrom(fm.getType()));\n     }\n@@ -654,9 +645,7 @@ public boolean populateNullIndicatorColumns(ValueMapping vm, String name,\n             else if (_nullIndName != null)\n                 cols[i].setName(_nullIndName + i);\n             correctName(table, cols[i]);\n-            table.addSubColumn(cols[i].getName());\n         }\n-        table.resetSubColumns();\n         return _addNullInd;\n     }\n "},{"sha":"a3cc7c2a64ab75710358c8267c57110185fcb840","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/NameSet.java","status":"modified","additions":1,"deletions":21,"changes":22,"blob_url":"https://github.com/apache/openjpa/blob/d9d6898558b809c0c630c0db869d4fe8f4ec61b4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/NameSet.java","raw_url":"https://github.com/apache/openjpa/raw/d9d6898558b809c0c630c0db869d4fe8f4ec61b4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/NameSet.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/NameSet.java?ref=d9d6898558b809c0c630c0db869d4fe8f4ec61b4","patch":"@@ -39,17 +39,13 @@\n \n     private Set _names = null;\n \n-    // an additional names Set for checking name duplication\n-    private Set _subNames = null;\n-\n     /**\n      * Return true if the given name is in use already.\n      */\n     public boolean isNameTaken(String name) {\n         if (name == null)\n             return true;\n-        return (_names != null && _names.contains(name.toUpperCase())) ||\n-            (_subNames != null && _subNames.contains(name.toUpperCase()));\n+        return _names != null && _names.contains(name.toUpperCase());\n     }\n \n     /**\n@@ -81,20 +77,4 @@ protected void removeName(String name) {\n         if (name != null && _names != null)\n             _names.remove(name.toUpperCase());\n     }\n-\n-    /**\n-    * Attempt to add the given name to the set.\n-    *\n-    * @param name the name to add\n-    */\n-    protected void addSubName(String name) {\n-        if (_subNames == null) {\n-            _subNames = new HashSet();\n-        }\n-        _subNames.add(name.toUpperCase());\n-    }\n-\n-    protected void resetSubNames() {\n-        _subNames = null;\n-    }\n }"}]}

