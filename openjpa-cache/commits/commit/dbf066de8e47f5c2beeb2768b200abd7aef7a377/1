{"sha":"dbf066de8e47f5c2beeb2768b200abd7aef7a377","node_id":"MDY6Q29tbWl0MjA2MzY0OmRiZjA2NmRlOGU0N2Y1YzJiZWViMjc2OGIyMDBhYmQ3YWVmN2EzNzc=","commit":{"author":{"name":"Milosz Tylenda","email":"mtylenda@apache.org","date":"2011-08-21T15:34:37Z"},"committer":{"name":"Milosz Tylenda","email":"mtylenda@apache.org","date":"2011-08-21T15:34:37Z"},"message":"OPENJPA-867: Use 3-argument version of LOCATE-like SQL function where possible, instead of a trick with SUBSTRING.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1160003 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ced3b27bf9bd2b2cbf4aae3cfa538f9a1379528e","url":"https://api.github.com/repos/apache/openjpa/git/trees/ced3b27bf9bd2b2cbf4aae3cfa538f9a1379528e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/dbf066de8e47f5c2beeb2768b200abd7aef7a377","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/dbf066de8e47f5c2beeb2768b200abd7aef7a377","html_url":"https://github.com/apache/openjpa/commit/dbf066de8e47f5c2beeb2768b200abd7aef7a377","comments_url":"https://api.github.com/repos/apache/openjpa/commits/dbf066de8e47f5c2beeb2768b200abd7aef7a377/comments","author":null,"committer":null,"parents":[{"sha":"49f069f268f5be2dda8e7e4bd45ef8d738dbdbdd","url":"https://api.github.com/repos/apache/openjpa/commits/49f069f268f5be2dda8e7e4bd45ef8d738dbdbdd","html_url":"https://github.com/apache/openjpa/commit/49f069f268f5be2dda8e7e4bd45ef8d738dbdbdd"}],"stats":{"total":87,"additions":62,"deletions":25},"files":[{"sha":"b940ae83812ed4482af31bf51f89aa92f43ad982","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/AbstractSQLServerDictionary.java","status":"modified","additions":0,"deletions":17,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/AbstractSQLServerDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/AbstractSQLServerDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/AbstractSQLServerDictionary.java?ref=dbf066de8e47f5c2beeb2768b200abd7aef7a377","patch":"@@ -136,21 +136,4 @@ public void substring(SQLBuffer buf, FilterValue str, FilterValue start,\n             buf.append(\" - 1))\");\n         }\n     }\n-\n-    public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n-        FilterValue start) {\n-        buf.append(\"(CHARINDEX(\");\n-        find.appendTo(buf);\n-        buf.append(\", \");\n-        if (start != null)\n-            substring(buf, str, start, null);\n-        else\n-            str.appendTo(buf);\n-        buf.append(\")\");\n-        if (start != null) {\n-            buf.append(\" - 1 + \");\n-            start.appendTo(buf);\n-        }\n-        buf.append(\")\");\n-    }\n }"},{"sha":"0bedcff84ac7bceb4a097bf60dd8347bb1a9f0a2","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/H2Dictionary.java","status":"modified","additions":4,"deletions":8,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/H2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/H2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/H2Dictionary.java?ref=dbf066de8e47f5c2beeb2768b200abd7aef7a377","patch":"@@ -229,16 +229,12 @@ protected void appendSelectRange(SQLBuffer buf, long start, long end,\n     @Override\n     public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n         FilterValue start) {\n-        buf.append(\"(POSITION(\");\n+        buf.append(\"LOCATE(\");\n         find.appendTo(buf);\n-        buf.append(\" IN \");\n-        if (start != null)\n-            substring(buf, str, start, null);\n-        else\n-            str.appendTo(buf);\n-        buf.append(\")\");\n+        buf.append(\", \");\n+        str.appendTo(buf);\n         if (start != null) {\n-            buf.append(\" - 1 + \");\n+            buf.append(\", \");\n             start.appendTo(buf);\n         }\n         buf.append(\")\");"},{"sha":"309c74a43f0da347ed0d7873b2807dc12709fe85","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/apache/openjpa/blob/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java?ref=dbf066de8e47f5c2beeb2768b200abd7aef7a377","patch":"@@ -477,5 +477,19 @@ else if (col.getSize() <= 16777215)\n             return super.getTypeName(col);\n         }\n     }\n+\n+    @Override\n+    public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n+        FilterValue start) {\n+        buf.append(\"LOCATE(\");\n+        find.appendTo(buf);\n+        buf.append(\", \");\n+        str.appendTo(buf);\n+        if (start != null) {\n+            buf.append(\", \");\n+            start.appendTo(buf);\n+        }\n+        buf.append(\")\");\n+    }\n }\n "},{"sha":"36568040ead23122fcf698eff91ec19d3d35b63f","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/apache/openjpa/blob/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java?ref=dbf066de8e47f5c2beeb2768b200abd7aef7a377","patch":"@@ -1416,4 +1416,18 @@ public String getIsNotNullSQL(String colAlias, int colType) {\n         }\n         return super.getIsNotNullSQL(colAlias, colType);\n     }\n+\n+    @Override\n+    public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n+        FilterValue start) {\n+        buf.append(\"INSTR(\");\n+        str.appendTo(buf);\n+        buf.append(\", \");\n+        find.appendTo(buf);\n+        if (start != null) {\n+            buf.append(\", \");\n+            start.appendTo(buf);\n+        }\n+        buf.append(\")\");\n+    }\n }"},{"sha":"d483666bb4490c138942734e23d9a02f64666eb6","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","status":"modified","additions":13,"deletions":0,"changes":13,"blob_url":"https://github.com/apache/openjpa/blob/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java?ref=dbf066de8e47f5c2beeb2768b200abd7aef7a377","patch":"@@ -328,4 +328,17 @@ public Reader getCharacterStream(ResultSet rs, int column) throws SQLException {\n         return clob.getCharacterStream();\n     }\n \n+    @Override\n+    public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n+        FilterValue start) {\n+        buf.append(\"CHARINDEX(\");\n+        find.appendTo(buf);\n+        buf.append(\", \");\n+        str.appendTo(buf);\n+        if (start != null) {\n+            buf.append(\", \");\n+            start.appendTo(buf);\n+        }\n+        buf.append(\")\");\n+    }\n }"},{"sha":"890e47c83242158a459620d59d8557878ac71ae7","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/dbf066de8e47f5c2beeb2768b200abd7aef7a377/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java?ref=dbf066de8e47f5c2beeb2768b200abd7aef7a377","patch":"@@ -30,6 +30,7 @@\n \n import org.apache.commons.lang.StringUtils;\n import org.apache.openjpa.jdbc.identifier.DBIdentifier.DBIdentifierType;\n+import org.apache.openjpa.jdbc.kernel.exps.FilterValue;\n import org.apache.openjpa.jdbc.schema.Column;\n import org.apache.openjpa.jdbc.schema.ForeignKey;\n import org.apache.openjpa.jdbc.schema.Index;\n@@ -485,4 +486,20 @@ public String getIdentityColumnName() {\n         return identityColumnName;       \n     }\n \n+    public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n+        FilterValue start) {\n+        buf.append(\"(CHARINDEX(\");\n+        find.appendTo(buf);\n+        buf.append(\", \");\n+        if (start != null)\n+            substring(buf, str, start, null);\n+        else\n+            str.appendTo(buf);\n+        buf.append(\")\");\n+        if (start != null) {\n+            buf.append(\" - 1 + \");\n+            start.appendTo(buf);\n+        }\n+        buf.append(\")\");\n+    }\n }"}]}

