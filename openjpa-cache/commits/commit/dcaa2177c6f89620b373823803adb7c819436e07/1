{"sha":"dcaa2177c6f89620b373823803adb7c819436e07","node_id":"MDY6Q29tbWl0MjA2MzY0OmRjYWEyMTc3YzZmODk2MjBiMzczODIzODAzYWRiN2M4MTk0MzZlMDc=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-11-17T21:55:21Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-11-17T21:55:21Z"},"message":"OPENJPA-1890: fix NPE when an embeddable is set to a managed entity more than once\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1036244 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"6a34c952840ee1ce2c1db7bcfb744e09a65f5555","url":"https://api.github.com/repos/apache/openjpa/git/trees/6a34c952840ee1ce2c1db7bcfb744e09a65f5555"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/dcaa2177c6f89620b373823803adb7c819436e07","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/dcaa2177c6f89620b373823803adb7c819436e07","html_url":"https://github.com/apache/openjpa/commit/dcaa2177c6f89620b373823803adb7c819436e07","comments_url":"https://api.github.com/repos/apache/openjpa/commits/dcaa2177c6f89620b373823803adb7c819436e07/comments","author":null,"committer":null,"parents":[{"sha":"ea5db0fbb3ba898f5afbb086a748e25b2ad57531","url":"https://api.github.com/repos/apache/openjpa/commits/ea5db0fbb3ba898f5afbb086a748e25b2ad57531","html_url":"https://github.com/apache/openjpa/commit/ea5db0fbb3ba898f5afbb086a748e25b2ad57531"}],"stats":{"total":7,"additions":5,"deletions":2},"files":[{"sha":"33c372cd58205961b1d860b82669c28c03de36f2","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","status":"modified","additions":5,"deletions":2,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/dcaa2177c6f89620b373823803adb7c819436e07/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","raw_url":"https://github.com/apache/openjpa/raw/dcaa2177c6f89620b373823803adb7c819436e07/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java?ref=dcaa2177c6f89620b373823803adb7c819436e07","patch":"@@ -311,8 +311,11 @@ private void delete(boolean immediate, OpCallbacks call, boolean deref) {\n             // works on external value\n             if ((immediate || fmd.isEmbeddedPC())\n                 && fmd.getCascadeDelete() == ValueMetaData.CASCADE_IMMEDIATE) {\n-                if (fmd.isEmbeddedPC() && deref)\n-                    dereferenceEmbedDependent(_broker.getStateManagerImpl(objval, false));\n+                if (fmd.isEmbeddedPC() && deref) {\n+                    StateManagerImpl sm = _broker.getStateManagerImpl(objval, false);\n+                    if (sm != null) \n+                        dereferenceEmbedDependent(sm);\n+                }\n                 delete(fmd, objval, call);\n             }\n             else if (fmd.getCascadeDelete() == ValueMetaData.CASCADE_AUTO)"}]}

