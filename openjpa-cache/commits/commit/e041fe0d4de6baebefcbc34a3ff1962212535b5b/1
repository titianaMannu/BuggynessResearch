{"sha":"e041fe0d4de6baebefcbc34a3ff1962212535b5b","node_id":"MDY6Q29tbWl0MjA2MzY0OmUwNDFmZTBkNGRlNmJhZWJlZmNiYzM0YTNmZjE5NjIyMTI1MzViNWI=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-05-21T16:35:28Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-05-21T16:35:28Z"},"message":"OPENJPA-237 Copy aliases array so it can't get modified by reference\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@540199 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ea36e89f9dd540e1d8d701d01fb41b1099718bfe","url":"https://api.github.com/repos/apache/openjpa/git/trees/ea36e89f9dd540e1d8d701d01fb41b1099718bfe"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e041fe0d4de6baebefcbc34a3ff1962212535b5b","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e041fe0d4de6baebefcbc34a3ff1962212535b5b","html_url":"https://github.com/apache/openjpa/commit/e041fe0d4de6baebefcbc34a3ff1962212535b5b","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e041fe0d4de6baebefcbc34a3ff1962212535b5b/comments","author":null,"committer":null,"parents":[{"sha":"81e89bcd80c73dad3e457906b6efcf58c1823e32","url":"https://api.github.com/repos/apache/openjpa/commits/81e89bcd80c73dad3e457906b6efcf58c1823e32","html_url":"https://github.com/apache/openjpa/commit/81e89bcd80c73dad3e457906b6efcf58c1823e32"}],"stats":{"total":45,"additions":44,"deletions":1},"files":[{"sha":"f78dd98624499adc052789ed1002fdcaa8985abd","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Value.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/e041fe0d4de6baebefcbc34a3ff1962212535b5b/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Value.java","raw_url":"https://github.com/apache/openjpa/raw/e041fe0d4de6baebefcbc34a3ff1962212535b5b/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Value.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/Value.java?ref=e041fe0d4de6baebefcbc34a3ff1962212535b5b","patch":"@@ -100,9 +100,13 @@ public void setLoadKey(String loadKey) {\n     /**\n      * Aliases for the value in the form key1, value1, key2, value2, ...\n      * All alias values must be in string form.\n+     * <p>\n+     * To avoid potential side-effects, this method copies the array passed in.\n      */\n     public void setAliases(String[] aliases) {\n-        this.aliases = aliases;\n+        String [] aStrings = new String[aliases.length];\n+        System.arraycopy(aliases, 0, aStrings, 0, aStrings.length);\n+        this.aliases = aStrings;\n     }\n \n     /**"},{"sha":"3ab23f9321597e04b178d4ea8d93a17d108da09a","filename":"openjpa-lib/src/test/java/org/apache/openjpa/lib/conf/TestValue.java","status":"added","additions":39,"deletions":0,"changes":39,"blob_url":"https://github.com/apache/openjpa/blob/e041fe0d4de6baebefcbc34a3ff1962212535b5b/openjpa-lib/src/test/java/org/apache/openjpa/lib/conf/TestValue.java","raw_url":"https://github.com/apache/openjpa/raw/e041fe0d4de6baebefcbc34a3ff1962212535b5b/openjpa-lib/src/test/java/org/apache/openjpa/lib/conf/TestValue.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/test/java/org/apache/openjpa/lib/conf/TestValue.java?ref=e041fe0d4de6baebefcbc34a3ff1962212535b5b","patch":"@@ -0,0 +1,39 @@\n+package org.apache.openjpa.lib.conf;\n+\n+import junit.framework.TestCase;\n+\n+public class TestValue extends TestCase {\n+    \n+    private static class SimpleValue extends Value {\n+\n+        protected String getInternalString() {\n+            return null;\n+        }\n+\n+        public Class getValueType() {\n+            return null;\n+        }\n+\n+        protected void setInternalObject(Object obj) {\n+            \n+        }\n+\n+        protected void setInternalString(String str) {\n+        }\n+        \n+    }\n+    \n+    public void testSetAliasesByValue() {\n+        String alias = \"alias\";\n+        String aName = \"Johnny\";\n+        String bName = \"Pete\";\n+        String [] aStrings = { alias, aName };\n+        \n+        SimpleValue sValue = new SimpleValue();\n+        sValue.setAliases(aStrings);\n+        sValue.setAlias(alias, bName);\n+        assertEquals(\"Did not set the new alias\", bName, \n+                sValue.getAliases()[1]);\n+        assertEquals(\"Array of aliases not set by value\", aName, aStrings[1]);\n+    }\n+}"}]}

