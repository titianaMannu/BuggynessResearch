{"sha":"e400abcef5f9368e384f056c4ff41efcff7cf303","node_id":"MDY6Q29tbWl0MjA2MzY0OmU0MDBhYmNlZjVmOTM2OGUzODRmMDU2YzRmZjQxZWZjZmY3Y2YzMDM=","commit":{"author":{"name":"Jody Grassel","email":"jgrassel@apache.org","date":"2011-09-08T20:07:16Z"},"committer":{"name":"Jody Grassel","email":"jgrassel@apache.org","date":"2011-09-08T20:07:16Z"},"message":"OPENJPA-1993: Deadlock Potential with ORM XML Processing\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1166880 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f514b1ff2475cac98eb6848d576a160284d5b094","url":"https://api.github.com/repos/apache/openjpa/git/trees/f514b1ff2475cac98eb6848d576a160284d5b094"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e400abcef5f9368e384f056c4ff41efcff7cf303","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e400abcef5f9368e384f056c4ff41efcff7cf303","html_url":"https://github.com/apache/openjpa/commit/e400abcef5f9368e384f056c4ff41efcff7cf303","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e400abcef5f9368e384f056c4ff41efcff7cf303/comments","author":null,"committer":null,"parents":[{"sha":"e0568bde7d671c9838701820454bfc0960a753ce","url":"https://api.github.com/repos/apache/openjpa/commits/e0568bde7d671c9838701820454bfc0960a753ce","html_url":"https://github.com/apache/openjpa/commit/e0568bde7d671c9838701820454bfc0960a753ce"}],"stats":{"total":29,"additions":21,"deletions":8},"files":[{"sha":"423f8d3101c1f139a02e4f699a2e851069ec635c","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/meta/XMLMetaDataParser.java","status":"modified","additions":17,"deletions":8,"changes":25,"blob_url":"https://github.com/apache/openjpa/blob/e400abcef5f9368e384f056c4ff41efcff7cf303/openjpa-lib/src/main/java/org/apache/openjpa/lib/meta/XMLMetaDataParser.java","raw_url":"https://github.com/apache/openjpa/raw/e400abcef5f9368e384f056c4ff41efcff7cf303/openjpa-lib/src/main/java/org/apache/openjpa/lib/meta/XMLMetaDataParser.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/meta/XMLMetaDataParser.java?ref=e400abcef5f9368e384f056c4ff41efcff7cf303","patch":"@@ -378,14 +378,20 @@ protected void parseNewResource(Reader xml, String sourceName)\n             _sourceName = sourceName;\n             \n             SAXParser parser = null;\n+            boolean overrideCL = _overrideContextClassloader;\n             ClassLoader oldLoader = null;\n+            ClassLoader newLoader = null;           \n             \n             try {\n-                if (_overrideContextClassloader == true) {\n-                    oldLoader = (ClassLoader) AccessController.doPrivileged(\n-                        J2DoPrivHelper.getContextClassLoaderAction());\n-                    AccessController.doPrivileged(J2DoPrivHelper.setContextClassLoaderAction(\n-                        XMLMetaDataParser.class.getClassLoader()));\n+                if (overrideCL == true) {\n+                    oldLoader =\n+                        (ClassLoader) AccessController.doPrivileged(J2DoPrivHelper.getContextClassLoaderAction());\n+                    newLoader = XMLMetaDataParser.class.getClassLoader();\n+                    AccessController.doPrivileged(J2DoPrivHelper.setContextClassLoaderAction(newLoader));\n+                    \n+                    if (_log != null && _log.isTraceEnabled()) {\n+                        _log.trace(_loc.get(\"override-contextclassloader-begin\", oldLoader, newLoader));\n+                    }                   \n                 }\n                 \n                 parser = XMLFactory.getSAXParser(validating, true);\n@@ -419,13 +425,16 @@ protected void parseNewResource(Reader xml, String sourceName)\n                 ioe.initCause(se);\n                 throw ioe;\n             } finally {\n-                if (_overrideContextClassloader == true && oldLoader != null) {\n+                if (overrideCL == true) {\n                     // Restore the old ContextClassloader\n                     try {\n+                        if (_log != null && _log.isTraceEnabled()) {\n+                            _log.trace(_loc.get(\"override-contextclassloader-end\", newLoader, oldLoader));\n+                        }\n                         AccessController.doPrivileged(J2DoPrivHelper.setContextClassLoaderAction(oldLoader));\n                     } catch (Throwable t) {\n-                        if (_log != null && _log.isTraceEnabled()) {\n-                            _log.trace(_loc.get(\"restore-contextclassloader-failed\"));\n+                        if (_log != null && _log.isWarnEnabled()) {\n+                            _log.warn(_loc.get(\"restore-contextclassloader-failed\"));\n                         }\n                     }\n                 }"},{"sha":"5512f101f4e01b0fc7cdc9981153a4409b719223","filename":"openjpa-lib/src/main/resources/org/apache/openjpa/lib/meta/localizer.properties","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/e400abcef5f9368e384f056c4ff41efcff7cf303/openjpa-lib/src/main/resources/org/apache/openjpa/lib/meta/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/e400abcef5f9368e384f056c4ff41efcff7cf303/openjpa-lib/src/main/resources/org/apache/openjpa/lib/meta/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/resources/org/apache/openjpa/lib/meta/localizer.properties?ref=e400abcef5f9368e384f056c4ff41efcff7cf303","patch":"@@ -25,6 +25,10 @@ cant-diff-elems: Unable to differentiate between given package and class \\\n \telements for class arg parsing.  No element can be a complete prefix of \\\n \tanother.\n class-arg: Error extracting class information from \"{0}\".\n+override-contextclassloader-begin: Overriding thread context classloader \\\n+    from \"{0}\" to \"{1}\".\n+override-contextclassloader-end: Restoring thread context classloader \\\n+    from \"{0}\" to \"{1}\".\n restore-contextclassloader-failed: An error occurred restoring the Thread's \\\n     context classloader.\n parse-error: An error was encountered while parsing element \"{0}\".  Make sure \\"}]}

