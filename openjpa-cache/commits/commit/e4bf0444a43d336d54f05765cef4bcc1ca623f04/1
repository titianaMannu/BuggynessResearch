{"sha":"e4bf0444a43d336d54f05765cef4bcc1ca623f04","node_id":"MDY6Q29tbWl0MjA2MzY0OmU0YmYwNDQ0YTQzZDMzNmQ1NGYwNTc2NWNlZjRiY2MxY2E2MjNmMDQ=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-01-30T09:37:59Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-01-30T09:37:59Z"},"message":"Added openjpa-integration/tck/pom.xml which can be used to run the JPA TCK (provided it exist locally) against the OpenJPA build.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@501356 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"b1ba72a7cdccb4f27252972a089dd60c4c9697b2","url":"https://api.github.com/repos/apache/openjpa/git/trees/b1ba72a7cdccb4f27252972a089dd60c4c9697b2"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e4bf0444a43d336d54f05765cef4bcc1ca623f04","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e4bf0444a43d336d54f05765cef4bcc1ca623f04","html_url":"https://github.com/apache/openjpa/commit/e4bf0444a43d336d54f05765cef4bcc1ca623f04","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e4bf0444a43d336d54f05765cef4bcc1ca623f04/comments","author":null,"committer":null,"parents":[{"sha":"0273937971eb0769d11e789dc33a222d826e8e8e","url":"https://api.github.com/repos/apache/openjpa/commits/0273937971eb0769d11e789dc33a222d826e8e8e","html_url":"https://github.com/apache/openjpa/commit/0273937971eb0769d11e789dc33a222d826e8e8e"}],"stats":{"total":289,"additions":289,"deletions":0},"files":[{"sha":"95c6c3c8a647f02218b589be5a4bbe189fc785d1","filename":"openjpa-integration/pom.xml","status":"added","additions":33,"deletions":0,"changes":33,"blob_url":"https://github.com/apache/openjpa/blob/e4bf0444a43d336d54f05765cef4bcc1ca623f04/openjpa-integration/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/e4bf0444a43d336d54f05765cef4bcc1ca623f04/openjpa-integration/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-integration/pom.xml?ref=e4bf0444a43d336d54f05765cef4bcc1ca623f04","patch":"@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+ Copyright 2006 The Apache Software Foundation.\n+ \n+ Licensed under the Apache License, Version 2.0 (the \"License\");\n+ you may not use this file except in compliance with the License.\n+ You may obtain a copy of the License at\n+ \n+ http://www.apache.org/licenses/LICENSE-2.0\n+ \n+ Unless required by applicable law or agreed to in writing, software\n+ distributed under the License is distributed on an \"AS IS\" BASIS,\n+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ See the License for the specific language governing permissions and\n+ limitations under the License.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0\n+        http://maven.apache.org/maven-v4_0_0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>openjpa-integration</artifactId>\n+    <packaging>pom</packaging>\n+    <name>OpenJPA Integration Tests</name>\n+    <parent>\n+        <groupId>org.apache.openjpa</groupId>\n+        <artifactId>openjpa</artifactId>\n+        <version>0.9.7-incubating-SNAPSHOT</version>\n+    </parent>\n+    <modules>\n+        <module>tck</module>\n+    </modules>\n+</project>"},{"sha":"11802077ce9909ee91d849e873bd8bcf4f593baf","filename":"openjpa-integration/tck/pom.xml","status":"added","additions":255,"deletions":0,"changes":255,"blob_url":"https://github.com/apache/openjpa/blob/e4bf0444a43d336d54f05765cef4bcc1ca623f04/openjpa-integration/tck/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/e4bf0444a43d336d54f05765cef4bcc1ca623f04/openjpa-integration/tck/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-integration/tck/pom.xml?ref=e4bf0444a43d336d54f05765cef4bcc1ca623f04","patch":"@@ -0,0 +1,255 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+ Copyright 2006 The Apache Software Foundation.\n+ \n+ Licensed under the Apache License, Version 2.0 (the \"License\");\n+ you may not use this file except in compliance with the License.\n+ You may obtain a copy of the License at\n+ \n+ http://www.apache.org/licenses/LICENSE-2.0\n+ \n+ Unless required by applicable law or agreed to in writing, software\n+ distributed under the License is distributed on an \"AS IS\" BASIS,\n+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ See the License for the specific language governing permissions and\n+ limitations under the License.\n+-->\n+\n+<!--\n+    This build file is used to run the JPA TCK. It assumes that you have\n+    the TCK zip file located at:\n+\n+        ${user.home}/.m2/privaterepos/jpa-1_0a-tck.zip\n+\n+    If you have that file in a different location, it can be specified with\n+    the \"tck.zip\" system property.\n+\n+    To run a specific package of tests, use the \"jpatck.pkg.dir\" system\n+    property to specify the parent directory of the tests you want to run.\n+    E.g.:\n+\n+        mvn integration-test -Djpatck.pkg.dir=com/sun/ts/tests/ejb30/persistence/inheritance/mappedsc/descriptors\n+\n+    The TCK running process will do the following:\n+\n+    1. Fine the TCK zip file and extract it\n+    2. Create an openjpa-provier.properties file with the OpenJPA config\n+    3. Modify the TCK's main configuration file (ts.jte) to use OpenJPA\n+    4. Run the database initialization script\n+    5. Run the TCK script\n+    6. Parse the TCK result log to determine whether to fail the build or not\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0\n+        http://maven.apache.org/maven-v4_0_0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>tck</artifactId>\n+    <packaging>pom</packaging>\n+    <name>OpenJPA JPA TCK Integration Tests</name>\n+    <parent>\n+        <groupId>org.apache.openjpa</groupId>\n+        <artifactId>openjpa-integration</artifactId>\n+        <version>0.9.7-incubating-SNAPSHOT</version>\n+    </parent>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <artifactId>maven-antrun-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>run-tck</id>\n+                        <phase>integration-test</phase>\n+                        <configuration>\n+                        <tasks>\n+                        <echo>Running Sun JPA TCK</echo>\n+\n+                        <property name=\"tck.zip\" value=\n+                            \"${user.home}/.m2/privaterepos/jpa-1_0a-tck.zip\"/>\n+\n+                        <!-- patch from Anderson for mappedBy bug -->\n+                        <property name=\"tck.patch\" value=\n+                            \"${user.home}/.m2/privaterepos/jpa-tck-inheritance-mappedBy.jar\"/>\n+\n+                        <available property=\"tck.available\" file=\"${tck.zip}\"/>\n+                        <fail unless=\"tck.available\">The TCK file ${tck.zip} does not exist. This file must be downloaded separately in order to be able to run the JPA TCK</fail>\n+\n+                        <available property=\"tck.patch.available\" file=\"${tck.patch}\"/>\n+                        <fail unless=\"tck.patch.available\">The TCK patch ${tck.patch} does not exist. This file must be downloaded separately in order to be able to run the JPA TCK</fail>\n+\n+                        <property name=\"tck.base\"\n+                            value=\"${basedir}/target/tck\"/>\n+                        <property name=\"tck.dir\" value=\"${tck.base}/jpatck\"/>\n+\n+                        <path id=\"cp\">\n+                            <path refid=\"maven.compile.classpath\"/>\n+                        </path>\n+                        <pathconvert property=\"cp.property\" refid=\"cp\"/>\n+\n+                        <unzip overwrite=\"false\"\n+                            src=\"${tck.zip}\" dest=\"${tck.base}\"/>\n+\n+                        <!-- unpack the patch over the TCK -->\n+                        <unzip overwrite=\"true\"\n+                            src=\"${tck.patch}\" dest=\"${tck.dir}\"/>\n+\n+                        <property name=\"db.driver\"\n+                            value=\"org.apache.derby.jdbc.EmbeddedDriver\"/>\n+                        <property name=\"db.url\"\n+                            value=\"jdbc:derby:derby-database;create=true\"/>\n+                        <property name=\"db.username\" value=\"nousername\"/>\n+                        <property name=\"db.password\" value=\"nopassword\"/>\n+\n+                        <property name=\"jpatck.pkg.dir\" value=\"com\"/>\n+\n+                        <property name=\"jpatck.work.dir\"\n+                            value=\"${tck.dir}/../work\"/>\n+\n+                        <property name=\"openjpa.properties\"\n+                            value=\"${tck.dir}/openjpa-provier.properties\"/>\n+\n+                        <!-- create the OpenJPA properties for the TCK run -->\n+                        <echo append=\"false\" file=\"${openjpa.properties}\">\n+javax.persistence.provider: org.apache.openjpa.persistence.PersistenceProviderImpl\n+openjpa.ConnectionDriverName: ${db.driver}\n+openjpa.ConnectionURL: ${db.url}\n+openjpa.ConnectionUserName: ${db.username}\n+openjpa.ConnectionPassword: ${db.password}\n+openjpa.FetchBatchSize: -1\n+openjpa.Compatibility: StrictIdentityValues=true\n+openjpa.Sequence: time\n+openjpa.Log: DefaultLevel=WARN\n+openjpa.jdbc.DBDictionary: StoreCharsAsNumbers=false\n+openjpa.jdbc.SchemaFactory: native(ForeignKeys=true)\n+                        </echo>\n+\n+                        <!-- Append OpenJPA-specific configuration -->\n+                        <property name=\"jpatck.config\"\n+                            value=\"${tck.dir}/bin/ts.jte\"/>\n+\n+                        <echo append=\"true\" file=\"${jpatck.config}\">\n+#########################################################################\n+## OpenJPA specific properties follow\n+#########################################################################\n+\n+jpa.home=${tck.dir}\n+work.dir=${jpatck.work.dir}\n+report.dir=${tck.dir}/../reports\n+jpa.classes=${cp.property}\n+database.classes=${cp.property}\n+persistence.unit.properties.file.full.path=${openjpa.properties}\n+database.user=${db.username}\n+database.passwd=${db.password}\n+database.url=${db.url}\n+database.driver=${db.driver}\n+                        </echo>\n+\n+                        <path id=\"agent.path\">\n+                            <fileset dir=\"../../openjpa-all/target\">\n+                                <include name=\"**/*.jar\"/>\n+                            </fileset>\n+                        </path>\n+                        <pathconvert property=\"agent\" refid=\"agent.path\"/>\n+                        <echo>AGENT: ${agent}</echo>\n+\n+                        <!--\n+                            Replace the existing javaagent argument (which\n+                            uses Toplink's enhancer) with our own. Also, we\n+                            need to specify the default MetaDataFactory in\n+                            order to allow tests that don't have any\n+                            persistent classes to work (like the SignatureTest)\n+                        -->\n+                        <replace file=\"${jpatck.config}\">\n+                            <replacefilter token=\"-javaagent:${jpa.home}/lib/toplink-essentials-agent.jar\" value=\"-javaagent:${agent} -Dopenjpa.MetaDataFactory=jpa(DefaultAccessType=PROPERTY)\"/>\n+                        </replace>\n+\n+\n+                        <!-- make a macro for the TCK harness launcher -->\n+                        <macrodef name=\"tsant\">\n+                            <attribute name=\"buildfile\"/>\n+                            <attribute name=\"target\"/>\n+                            <sequential>\n+                                <java classname=\n+                                    \"org.apache.tools.ant.launch.Launcher\"\n+                                    fork=\"true\" failonerror=\"true\"\n+                                    dir=\"${tck.dir}/src\" timeout=\"7200000\">\n+                                    <arg value=\"-emacs\"/>\n+                                    <arg value=\"-buildfile\"/>\n+                                    <arg value=\"@{buildfile}\"/>\n+                                    <arg value=\"-listener\"/>\n+                                    <arg value=\"com.sun.ant.TSBuildListener\"/>\n+                                    <arg value=\"-logger\"/>\n+                                    <arg value=\"com.sun.ant.TSLogger\"/>\n+                                    <arg value=\"@{target}\"/>\n+\n+                                    <env key=\"TS_HOME\" value=\"..\"/>\n+                                    <sysproperty key=\"ts.home\" value=\"..\"/>\n+\n+                                    <env key=\"ANT_HOME\"\n+                                        value=\"${tck.dir}/tools/ant\"/>\n+                                    <sysproperty key=\"ant.home\"\n+                                        value=\"${tck.dir}/tools/ant\"/>\n+\n+                                    <sysproperty key=\"pkg.dir\"\n+                                        value=\"${jpatck.pkg.dir}\"/>\n+\n+                                    <classpath>\n+                                        <fileset dir=\"${tck.dir}/tools/ant/lib\">\n+                                            <include name=\"**/*.jar\"/>\n+                                        </fileset>\n+                                        <fileset dir=\"${tck.dir}/lib\">\n+                                            <include name=\"**/*.jar\"/>\n+                                        </fileset>\n+                                        <path refid=\"cp\"/>\n+                                    </classpath>\n+                                </java>\n+                            </sequential>\n+                        </macrodef>\n+\n+\n+                        <!-- first initialize the database -->\n+                        <tsant buildfile=\"${tck.dir}/bin/initdb.xml\"\n+                            target=\"init.database\"/>\n+\n+                        <!-- now run the TCK -->\n+                        <tsant buildfile=\"${tck.dir}/bin/build.xml\"\n+                            target=\"runclient\"/>\n+\n+                        <!--\n+                            The TCK's Java process doesn't actually fail when\n+                            tests fail, so we need to parse the results file\n+                            for a string indicating whether or not it passed.\n+                        -->\n+                        <loadfile property=\"jpatck.results\"\n+                            srcfile=\"${jpatck.work.dir}/jtData/log.txt\"/>\n+                        <condition property=\"jpatck.failed\">\n+                            <contains string=\"${jpatck.results}\"\n+                                substring=\"Completed test run: not ok\"/>\n+                        </condition>\n+                        <fail if=\"jpatck.failed\">Some tests failed</fail>\n+                        </tasks>\n+                        </configuration>\n+                        <goals>\n+                            <goal>run</goal>\n+                        </goals>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+        </plugins>\n+    </build>\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.apache.openjpa</groupId>\n+            <artifactId>openjpa-all</artifactId>\n+            <version>${pom.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.derby</groupId>\n+            <artifactId>derby</artifactId>\n+            <version>10.2.1.6</version>\n+            <scope>compile</scope>\n+        </dependency>\n+    </dependencies>\n+</project>\n+"},{"sha":"cdc5f00685bb0a6df60126fa5adc816dc41394e4","filename":"pom.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/e4bf0444a43d336d54f05765cef4bcc1ca623f04/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/e4bf0444a43d336d54f05765cef4bcc1ca623f04/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/pom.xml?ref=e4bf0444a43d336d54f05765cef4bcc1ca623f04","patch":"@@ -103,6 +103,7 @@\n         <module>openjpa-xmlstore</module>\n         <module>openjpa-all</module>\n         <module>openjpa-project</module>\n+        <module>openjpa-integration</module>\n     </modules>\n     <profiles>\n         <profile>"}]}

