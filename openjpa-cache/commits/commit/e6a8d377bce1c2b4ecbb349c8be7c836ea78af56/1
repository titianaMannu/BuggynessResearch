{"sha":"e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","node_id":"MDY6Q29tbWl0MjA2MzY0OmU2YThkMzc3YmNlMWMyYjRlY2JiMzQ5YzhiZTdjODM2ZWE3OGFmNTY=","commit":{"author":{"name":"Heath Thomann","email":"hthomann@apache.org","date":"2012-05-15T00:42:09Z"},"committer":{"name":"Heath Thomann","email":"hthomann@apache.org","date":"2012-05-15T00:42:09Z"},"message":"OPENJPA-2067: Added code, gated by the new DBDictionary.useJDBC4SetBinaryStream prop, to use a JDBC 4.0 version of setBinaryStream.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1338494 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"63d875433334ca4cd426ea9befa7b5ffd42d36c1","url":"https://api.github.com/repos/apache/openjpa/git/trees/63d875433334ca4cd426ea9befa7b5ffd42d36c1"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","html_url":"https://github.com/apache/openjpa/commit/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/comments","author":null,"committer":null,"parents":[{"sha":"32d2a850110157fb9e29e38ea1a957d1747e3852","url":"https://api.github.com/repos/apache/openjpa/commits/32d2a850110157fb9e29e38ea1a957d1747e3852","html_url":"https://github.com/apache/openjpa/commit/32d2a850110157fb9e29e38ea1a957d1747e3852"}],"stats":{"total":48,"additions":47,"deletions":1},"files":[{"sha":"4568c2c63c72f0c89947ccebcdbd2e63698552ab","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/apache/openjpa/blob/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","patch":"@@ -28,6 +28,7 @@\n import java.io.Reader;\n import java.io.StringReader;\n import java.io.Writer;\n+import java.lang.reflect.Method;\n import java.math.BigDecimal;\n import java.math.BigInteger;\n import java.sql.Array;\n@@ -291,6 +292,7 @@\n     public boolean useGetObjectForBlobs = false;\n     public boolean useGetStringForClobs = false;\n     public boolean useSetStringForClobs = false;\n+    public boolean useJDBC4SetBinaryStream = true;//OPENJPA-2067\n     public int maxEmbeddedBlobSize = -1;\n     public int maxEmbeddedClobSize = -1;\n     public int inClauseLimit = -1;\n@@ -969,6 +971,19 @@ public void setBigInteger(PreparedStatement stmnt, int idx, BigInteger val,\n     public void setBinaryStream(PreparedStatement stmnt, int idx,\n         InputStream val, int length, Column col)\n         throws SQLException {\n+    \t\n+    \t//OPENJPA-2067: If the user has set the 'useJDBC4SetBinaryStream' property\n+    \t//then lets use the JDBC 4.0 version of the setBinaryStream method.\n+\t\tif (useJDBC4SetBinaryStream) {\n+\t\t\tif (isJDBC4){\n+\t\t\t\tstmnt.setBinaryStream(idx, val);\n+\t\t\t\treturn;\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tlog.trace(_loc.get(\"jdbc4-setbinarystream-unsupported\"));\n+\t\t\t}\n+\t\t}\n+\n         stmnt.setBinaryStream(idx, val, length);\n     }\n "},{"sha":"79b5b6da1582c4e56804ea3567c1aab4f0bd4aec","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties?ref=e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","patch":"@@ -223,6 +223,10 @@ sequencesql-override: Going to override the DB2 specific default for the \\\n invalid-locking-mode: Invalid locking mode for SolidDB: \"{0}\"\n oracle-set-clob-warning: Setting the supportsSetClob property on the OracleDictionary no longer has an \\\n     effect.  The functionality provided by the supportsSetClob property  is now enabled, by default.\n+jdbc4-setbinarystream-unsupported: The JRE or JDBC level in use does not support the \\\n+    JDBC 4.0 version of the \"java.sql.PreparedStatement.setBinaryStream\" method which is \\\n+    necessary when the property \"openjpa.jdbc.DBDictionary=useJDBC4SetBinaryStream\" is \\\n+    set to true.  A prior version of this method will be used.    \n sequence-cache-warning: Setting the useNativeSequenceCache property on the DBDictionary no longer has an \\\n     effect.  Code has been added to allow, by default, the functionality provided in previous releases \\\n     via the useNativeSequenceCache property."},{"sha":"fe3b7618b3c83ae3980d701ac8ddf95942f04c6a","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/jdbc/LoggingConnectionDecorator.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/apache/openjpa/blob/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-lib/src/main/java/org/apache/openjpa/lib/jdbc/LoggingConnectionDecorator.java","raw_url":"https://github.com/apache/openjpa/raw/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-lib/src/main/java/org/apache/openjpa/lib/jdbc/LoggingConnectionDecorator.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/jdbc/LoggingConnectionDecorator.java?ref=e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","patch":"@@ -1429,7 +1429,13 @@ public void setBinaryStream(int i1, InputStream is, int i2)\n                 setLogParameter(i1, \"InputStream\", is);\n                 super.setBinaryStream(i1, is, i2);\n             }\n-\n+            \n+            public void setBinaryStream(int i1, InputStream is)\n+            throws SQLException {\n+            \tsetLogParameter(i1, \"InputStream\", is);\n+            \tsuper.setBinaryStream(i1, is);            \t\n+            }\n+            \n             public void clearParameters() throws SQLException {\n                 clearLogParameters(false);\n                 super.clearParameters();"},{"sha":"55430c97ddd358827f6555d5dad5fdafe9a33b30","filename":"openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","status":"modified","additions":21,"deletions":0,"changes":21,"blob_url":"https://github.com/apache/openjpa/blob/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","raw_url":"https://github.com/apache/openjpa/raw/e6a8d377bce1c2b4ecbb349c8be7c836ea78af56/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml?ref=e6a8d377bce1c2b4ecbb349c8be7c836ea78af56","patch":"@@ -3451,6 +3451,27 @@ ResultSet.getString</methodname> will be used to obtain clob data rather than\n <methodname>ResultSet.getCharacterStream</methodname>.\n                     </para>\n                 </listitem>\n+\n+                <listitem id=\"DBDictionary.UseJDBC4SetBinaryStream\">\n+                    <para>\n+                    <indexterm>\n+                        <primary>\n+                            JDBC\n+                        </primary>\n+                        <secondary>\n+                            UseJDBC4SetBinaryStream\n+                        </secondary>\n+                    </indexterm>\n+<literal>UseJDBC4SetBinaryStream</literal>: When true, an attempt will be made to obtain\n+a JDBC 4.0 version of <methodname>PreparedStatement.setBinaryStream</methodname>.  \n+When false, a <methodname>setBinaryStream</methodname> is used which takes the length of the\n+stream.  OpenJPA uses a -1 for the length since OpenJPA doesn't know the length of the stream.\n+A few JDBC drivers check the length and throw an exception when the length is less than zero.\n+When this property is set to true, and an applicable JDK and JDBC 4.0 driver is available, a\n+version of <methodname>setBinaryStream</methodname> will be used which does not take a length. \n+The default value of this property is true.\n+                    </para>\n+                </listitem>\n                 <listitem id=\"DBDictionary.UseNativeSequenceCache\">\n                     <para>\n                     <indexterm>"}]}

