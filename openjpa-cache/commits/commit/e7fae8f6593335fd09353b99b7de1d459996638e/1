{"sha":"e7fae8f6593335fd09353b99b7de1d459996638e","node_id":"MDY6Q29tbWl0MjA2MzY0OmU3ZmFlOGY2NTkzMzM1ZmQwOTM1M2I5OWI3ZGUxZDQ1OTk5NjYzOGU=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-10-20T00:55:47Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-10-20T00:55:47Z"},"message":"Added target for signing the release.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@465941 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7a574310d09678bce727f335d89bf5af00677beb","url":"https://api.github.com/repos/apache/openjpa/git/trees/7a574310d09678bce727f335d89bf5af00677beb"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e7fae8f6593335fd09353b99b7de1d459996638e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e7fae8f6593335fd09353b99b7de1d459996638e","html_url":"https://github.com/apache/openjpa/commit/e7fae8f6593335fd09353b99b7de1d459996638e","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e7fae8f6593335fd09353b99b7de1d459996638e/comments","author":null,"committer":null,"parents":[{"sha":"ad0c62208011cccbdafcb3ec721880b8ef94fad5","url":"https://api.github.com/repos/apache/openjpa/commits/ad0c62208011cccbdafcb3ec721880b8ef94fad5","html_url":"https://github.com/apache/openjpa/commit/ad0c62208011cccbdafcb3ec721880b8ef94fad5"}],"stats":{"total":68,"additions":66,"deletions":2},"files":[{"sha":"53132eb65aaaf4005ecea1ab8088cc4327ed9fde","filename":"openjpa-project/pom.xml","status":"modified","additions":66,"deletions":2,"changes":68,"blob_url":"https://github.com/apache/openjpa/blob/e7fae8f6593335fd09353b99b7de1d459996638e/openjpa-project/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/e7fae8f6593335fd09353b99b7de1d459996638e/openjpa-project/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/pom.xml?ref=e7fae8f6593335fd09353b99b7de1d459996638e","patch":"@@ -7,6 +7,13 @@\n         To build the distribution files from project root:\r\n \r\n         mvn clean compile package -Dtest=false\r\n+\r\n+        To build and deploy a full digned release with docs, run:\r\n+\r\n+            mvn clean deploy -Pjavadoc-profile,docbook-profile,sign-release\r\n+\r\n+        Note that to sign the release, you need to have created a GPG\r\n+        key. See http://apache.org/dev/release-signing.html\r\n     -->\r\n     <modelVersion>4.0.0</modelVersion>\r\n     <artifactId>openjpa-project</artifactId>\r\n@@ -17,6 +24,13 @@\n         <artifactId>openjpa</artifactId>\r\n         <version>0.9.6-incubating-SNAPSHOT</version>\r\n     </parent>\r\n+\r\n+    <properties>\r\n+        <openjpa.release.keyAlias>${user.name}@apache.org</openjpa.release.keyAlias>\r\n+        <openjpa.assembly.finalName>openjpa-${version}</openjpa.assembly.finalName>\r\n+        <openjpa.assembly.outputDirectory>${project.basedir}/target/assembly</openjpa.assembly.outputDirectory>\r\n+    </properties>\r\n+\r\n     <build>\r\n         <!-- needed to let maven pass the \"compile\" phase -->\r\n         <testSourceDirectory>/none/</testSourceDirectory>\r\n@@ -133,8 +147,8 @@\n                         </goals>\r\n                         <configuration>\r\n                             <descriptor>assembly.xml</descriptor>\r\n-                            <finalName>openjpa-${version}</finalName>\r\n-                            <outputDirectory>${project.basedir}/target/assembly</outputDirectory>\r\n+                            <finalName>${openjpa.assembly.finalName}</finalName>\r\n+                            <outputDirectory>${openjpa.assembly.outputDirectory}</outputDirectory>\r\n                             <workDirectory>target/work</workDirectory>\r\n                         </configuration>\r\n                     </execution>\r\n@@ -252,6 +266,56 @@\n                 </property>\r\n             </activation>\r\n         </profile>\r\n+\r\n+        <!-- sign the release files -->\r\n+        <profile>\r\n+            <id>sign-release</id>\r\n+            <build>\r\n+                <plugins>\r\n+                    <plugin>\r\n+                        <artifactId>maven-antrun-plugin</artifactId>\r\n+                        <executions>\r\n+                            <execution>\r\n+                                <phase>deploy</phase>\r\n+                                <configuration>\r\n+                                    <tasks>\r\n+                                    <echo>Signing release files...</echo>\r\n+                                    <macrodef name=\"sign-file\">\r\n+                                        <attribute name=\"file\" />\r\n+                                        <sequential>\r\n+                                        <delete failonerror=\"false\"\r\n+                                            file=\"@{file}.asc\"/>\r\n+                                        <exec executable=\"gpg\"\r\n+                                            failonerror=\"true\">\r\n+                                            <arg value=\"--batch\"/>\r\n+                                            <arg value=\"--verbose\"/>\r\n+                                            <arg value=\"--default-key\"/>\r\n+                                            <arg value=\"${openjpa.release.keyAlias}\"/>\r\n+                                            <arg value=\"--armor\"/>\r\n+                                            <arg value=\"--detach-sig\"/>\r\n+                                            <arg value=\"@{file}\"/>\r\n+                                        </exec>\r\n+                                        </sequential>\r\n+                                    </macrodef>\r\n+                                    <sign-file file=\"${openjpa.assembly.outputDirectory}/${openjpa.assembly.finalName}.zip\"/>\r\n+                                    <sign-file file=\"${openjpa.assembly.outputDirectory}/${openjpa.assembly.finalName}-sources.zip\"/>\r\n+                                    </tasks>\r\n+                                </configuration>\r\n+                                <goals>\r\n+                                    <goal>run</goal>\r\n+                                </goals>\r\n+                            </execution>\r\n+                        </executions>\r\n+                    </plugin>\r\n+                </plugins>\r\n+            </build>\r\n+            <activation>\r\n+                <property>\r\n+                    <name>sign</name>\r\n+                    <value>true</value>\r\n+                </property>\r\n+            </activation>\r\n+        </profile>\r\n     </profiles>\r\n \r\n     <!-- need to explicitly list dependencies for assembly to work -->\r"}]}

