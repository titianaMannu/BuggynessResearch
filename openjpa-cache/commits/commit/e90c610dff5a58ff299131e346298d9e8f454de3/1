{"sha":"e90c610dff5a58ff299131e346298d9e8f454de3","node_id":"MDY6Q29tbWl0MjA2MzY0OmU5MGM2MTBkZmY1YTU4ZmYyOTkxMzFlMzQ2Mjk4ZDllOGY0NTRkZTM=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2007-09-18T20:10:39Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2007-09-18T20:10:39Z"},"message":"OPENJPA-338 for 1.0.x. Committing Teresa's patch\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.0.x@577038 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"dd59508e71f90b4a2f2752aed14e79205df26914","url":"https://api.github.com/repos/apache/openjpa/git/trees/dd59508e71f90b4a2f2752aed14e79205df26914"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e90c610dff5a58ff299131e346298d9e8f454de3","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e90c610dff5a58ff299131e346298d9e8f454de3","html_url":"https://github.com/apache/openjpa/commit/e90c610dff5a58ff299131e346298d9e8f454de3","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e90c610dff5a58ff299131e346298d9e8f454de3/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"2663cb3e32a116f3be0681d603923680bd0267d6","url":"https://api.github.com/repos/apache/openjpa/commits/2663cb3e32a116f3be0681d603923680bd0267d6","html_url":"https://github.com/apache/openjpa/commit/2663cb3e32a116f3be0681d603923680bd0267d6"}],"stats":{"total":52,"additions":52,"deletions":0},"files":[{"sha":"c98937325210287e93c59b07b144487a2b24eb16","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":41,"deletions":0,"changes":41,"blob_url":"https://github.com/apache/openjpa/blob/e90c610dff5a58ff299131e346298d9e8f454de3/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/e90c610dff5a58ff299131e346298d9e8f454de3/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=e90c610dff5a58ff299131e346298d9e8f454de3","patch":"@@ -695,4 +695,45 @@ public void indexOf(SQLBuffer buf, FilterValue str, FilterValue find,\n         }\r\n         buf.append(\") - 1)\");\r\n     }\r\n+\r\n+    /** \r\n+     * Cast the specified value to the specified type.\r\n+     *\r\n+     * @param buf the buffer to append the cast to\r\n+     * @param val the value to cast\r\n+     * @param type the type of the case, e.g. {@link Types#NUMERIC}\r\n+     */\r\n+    public void appendCast(SQLBuffer buf, FilterValue val, int type) {\r\n+\r\n+        // Convert the cast function: \"CAST({0} AS {1})\"\r\n+        int firstParam = castFunction.indexOf(\"{0}\");\r\n+        String pre = castFunction.substring(0, firstParam); // \"CAST(\"\r\n+        String mid = castFunction.substring(firstParam + 3);\r\n+        int secondParam = mid.indexOf(\"{1}\");\r\n+        String post;\r\n+        if (secondParam > -1) {\r\n+            post = mid.substring(secondParam + 3); // \")\"\r\n+            mid = mid.substring(0, secondParam); // \" AS \"\r\n+        } else\r\n+            post = \"\";\r\n+\r\n+        // No need to add CAST if the value is a constant\r\n+        if (val instanceof Lit || val instanceof Param) {\r\n+            buf.append(pre);\r\n+            val.appendTo(buf);\r\n+            buf.append(mid);\r\n+            buf.append(getTypeName(type));\r\n+            appendLength(buf, type);\r\n+            buf.append(post);\r\n+        } else {\r\n+            val.appendTo(buf);\r\n+            String sqlString = buf.getSQL(false);\r\n+            if (sqlString.endsWith(\"?\")) {\r\n+                // case \"(?\" - convert to \"CAST(? AS type\"\r\n+                String str = \"CAST(? AS \" + getTypeName(type) + \")\";\r\n+                buf.replaceSqlString(sqlString.length() - 1,\r\n+                        sqlString.length(), str);\r\n+            }\r\n+        }\r\n+    }\r\n }\r"},{"sha":"4a96a7a42eaf3dffd15df1f24bc53ace3d800a5d","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/e90c610dff5a58ff299131e346298d9e8f454de3/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java","raw_url":"https://github.com/apache/openjpa/raw/e90c610dff5a58ff299131e346298d9e8f454de3/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java?ref=e90c610dff5a58ff299131e346298d9e8f454de3","patch":"@@ -606,6 +606,17 @@ public void addCastForParam(String oper, Val val) {\n         }\n     }\n \n+    /**\n+     * Replace current buffer string with the new string\n+     * \n+     * @param start replace start position\n+     * @param end replace end position\n+     * @param newString\n+     */\n+    public void replaceSqlString(int start, int end, String newString) {\n+        _sql.replace(start, end, newString);\n+    }\n+    \n     /**\n      * Represents a subselect.\n      */"}]}

