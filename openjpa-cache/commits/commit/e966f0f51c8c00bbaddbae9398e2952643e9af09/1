{"sha":"e966f0f51c8c00bbaddbae9398e2952643e9af09","node_id":"MDY6Q29tbWl0MjA2MzY0OmU5NjZmMGY1MWM4YzAwYmJhZGRiYWU5Mzk4ZTI5NTI2NDNlOWFmMDk=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2013-03-20T22:52:18Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2013-03-20T22:52:18Z"},"message":"OPENJPA-2355: Allow more than two input argument to CONCAT()\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1459091 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"db58f87d505c7f8c1e39be5aaac163f33d1542ba","url":"https://api.github.com/repos/apache/openjpa/git/trees/db58f87d505c7f8c1e39be5aaac163f33d1542ba"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/e966f0f51c8c00bbaddbae9398e2952643e9af09","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/e966f0f51c8c00bbaddbae9398e2952643e9af09","html_url":"https://github.com/apache/openjpa/commit/e966f0f51c8c00bbaddbae9398e2952643e9af09","comments_url":"https://api.github.com/repos/apache/openjpa/commits/e966f0f51c8c00bbaddbae9398e2952643e9af09/comments","author":null,"committer":null,"parents":[{"sha":"085ea3eb07cf8f6b4758e0bc0f50b3e829b1364e","url":"https://api.github.com/repos/apache/openjpa/commits/085ea3eb07cf8f6b4758e0bc0f50b3e829b1364e","html_url":"https://github.com/apache/openjpa/commit/085ea3eb07cf8f6b4758e0bc0f50b3e829b1364e"}],"stats":{"total":21,"additions":17,"deletions":4},"files":[{"sha":"ef71c72e9d37e8d4ed3361408fecb439b531942c","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/jpql/JPQLExpressionBuilder.java","status":"modified","additions":14,"deletions":3,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/e966f0f51c8c00bbaddbae9398e2952643e9af09/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/jpql/JPQLExpressionBuilder.java","raw_url":"https://github.com/apache/openjpa/raw/e966f0f51c8c00bbaddbae9398e2952643e9af09/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/jpql/JPQLExpressionBuilder.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/jpql/JPQLExpressionBuilder.java?ref=e966f0f51c8c00bbaddbae9398e2952643e9af09","patch":"@@ -1297,11 +1297,22 @@ else if (node.getChildCount() == 2\n                 return factory.trim(val1, trimChar, trimWhere);\n \n             case JJTCONCAT:\n-                val1 = getValue(left(node));\n-                val2 = getValue(right(node));\n+                if (node.children.length < 2)\n+                \tthrow parseException(EX_USER, \"less-child-count\",\n+                        new Object[]{ Integer.valueOf(2), node,\n+                            Arrays.asList(node.children) }, null);\n+\n+                val1 = getValue(firstChild(node));\n+                val2 = getValue(secondChild(node));\n                 setImplicitType(val1, TYPE_STRING);\n                 setImplicitType(val2, TYPE_STRING);\n-                return factory.concat(val1, val2);\n+                Value concat = factory.concat(val1, val2);\n+                for (int i = 2; i < node.children.length; i++) {\n+                \tval2 = getValue(node.children[i]);\n+                    setImplicitType(val2, TYPE_STRING);\n+                \tconcat = factory.concat(concat, val2);\n+                }\n+                return concat;\n \n             case JJTSUBSTRING:\n                 // Literals are forced to be Integers because PostgreSQL rejects Longs in SUBSTRING parameters."},{"sha":"e80d0f217ee75a711a2f01739a538fd59491d27e","filename":"openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/e966f0f51c8c00bbaddbae9398e2952643e9af09/openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt","raw_url":"https://github.com/apache/openjpa/raw/e966f0f51c8c00bbaddbae9398e2952643e9af09/openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/jjtree/org/apache/openjpa/kernel/jpql/JPQL.jjt?ref=e966f0f51c8c00bbaddbae9398e2952643e9af09","patch":"@@ -1195,7 +1195,7 @@ void functions_returning_strings() : { }\n \r\n void concat() #CONCAT : { }\r\n {\r\n-\t<CONCAT> \"(\" string_expression() <COMMA> string_expression() \")\"\r\n+\t<CONCAT> \"(\" string_expression() <COMMA> string_expression() [ <COMMA> string_expression() ] \")\"\r\n }\r\n \r\n \r"},{"sha":"5720fff14a918a9b52ebcdc2a29b64bfb69d613c","filename":"openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/e966f0f51c8c00bbaddbae9398e2952643e9af09/openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/e966f0f51c8c00bbaddbae9398e2952643e9af09/openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties?ref=e966f0f51c8c00bbaddbae9398e2952643e9af09","patch":"@@ -40,6 +40,8 @@ unknown-comp: Unknown comparison operator \"{0}\".\n wrong-child-count: Wrong number of arguments to expression \\\n \tof type \"{1}\": should have been {0}, but the following arguments \\\n \twere specified: \"{2}\".\n+less-child-count: Insufficient number of argument to expression \\\n+\tof type \"{1}\": should have been at least {0}, but were: \"{2}\"\n not-schema-name: The name \"{0}\" is not a recognized entity or identifier. \\\n     Known entity names: {1}\n not-schema-name-hint: The name \"{0}\" is not a recognized entity or identifier. \\"}]}

