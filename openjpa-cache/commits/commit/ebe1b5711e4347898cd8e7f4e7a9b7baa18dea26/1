{"sha":"ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26","node_id":"MDY6Q29tbWl0MjA2MzY0OmViZTFiNTcxMWU0MzQ3ODk4Y2Q4ZTdmNGU3YTliN2JhYTE4ZGVhMjY=","commit":{"author":{"name":"A. Abram White","email":"awhite@apache.org","date":"2007-03-02T21:57:03Z"},"committer":{"name":"A. Abram White","email":"awhite@apache.org","date":"2007-03-02T21:57:03Z"},"message":"Fix a couple of errors in the code to default to the non-finalizing broker\nin PersistenceProviderImpl.createContainerManagedEntityManagerFactory:\n  1) Don't add to the given Map, because it might be read-only.  \n  2) Prefix the BrokerImpl property correctly when adding it.\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@513974 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f28594c25d5b6f324f40ad15a7a0234fcf02157d","url":"https://api.github.com/repos/apache/openjpa/git/trees/f28594c25d5b6f324f40ad15a7a0234fcf02157d"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26","html_url":"https://github.com/apache/openjpa/commit/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26","comments_url":"https://api.github.com/repos/apache/openjpa/commits/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26/comments","author":null,"committer":null,"parents":[{"sha":"6e30b565b7ec7e409d40985b72a8ab98477ce84b","url":"https://api.github.com/repos/apache/openjpa/commits/6e30b565b7ec7e409d40985b72a8ab98477ce84b","html_url":"https://github.com/apache/openjpa/commit/6e30b565b7ec7e409d40985b72a8ab98477ce84b"}],"stats":{"total":20,"additions":10,"deletions":10},"files":[{"sha":"edbee2b6dabaf7f9b495ec5a1c42e07149ffddbb","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java","raw_url":"https://github.com/apache/openjpa/raw/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/conf/OpenJPAConfigurationImpl.java?ref=ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26","patch":"@@ -71,7 +71,7 @@\n \n     // openjpa properties\n     public ObjectValue classResolverPlugin;\n-    public BrokerValue brokerPlugin;\n+    public ObjectValue brokerPlugin;\n     public ObjectValue dataCachePlugin;\n     public ObjectValue dataCacheManagerPlugin;\n     public IntValue dataCacheTimeout;"},{"sha":"a0fa1032fc7ac3d763f3dd231794f29f99db1575","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java","status":"modified","additions":9,"deletions":9,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java","raw_url":"https://github.com/apache/openjpa/raw/ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/PersistenceProviderImpl.java?ref=ebe1b5711e4347898cd8e7f4e7a9b7baa18dea26","patch":"@@ -83,15 +83,6 @@ public EntityManagerFactory createContainerEntityManagerFactory(\n         PersistenceUnitInfo pui, Map m) {\n         PersistenceProductDerivation pd = new PersistenceProductDerivation();\n         try {\n-            // if the BrokerImpl hasn't been specified, switch to the\n-            // non-finalizing one, since anything claiming to be a container\n-            // should be doing proper resource management.\n-            if (!Configurations.containsProperty(BrokerValue.KEY,\n-                pui.getProperties())\n-                && !Configurations.containsProperty(BrokerValue.KEY, m)) {\n-                m.put(BrokerValue.KEY, BrokerValue.NON_FINALIZING_ALIAS);\n-            }\n-\n             ConfigurationProvider cp = pd.load(pui, m);\n             if (cp == null)\n                 return null;\n@@ -102,6 +93,15 @@ public EntityManagerFactory createContainerEntityManagerFactory(\n             pui.addTransformer(new ClassTransformerImpl(cp, ctOpts, \n                 pui.getNewTempClassLoader()));\n \n+            // if the BrokerImpl hasn't been specified, switch to the\n+            // non-finalizing one, since anything claiming to be a container\n+            // should be doing proper resource management.\n+            if (!Configurations.containsProperty(BrokerValue.KEY,\n+                cp.getProperties())) {\n+                cp.addProperty(\"openjpa.\" + BrokerValue.KEY, \n+                    BrokerValue.NON_FINALIZING_ALIAS);\n+            }\n+\n             BrokerFactory factory = Bootstrap.newBrokerFactory(cp, \n                 pui.getClassLoader());\n             return OpenJPAPersistence.toEntityManagerFactory(factory);"}]}

