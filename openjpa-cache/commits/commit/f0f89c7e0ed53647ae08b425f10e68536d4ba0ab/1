{"sha":"f0f89c7e0ed53647ae08b425f10e68536d4ba0ab","node_id":"MDY6Q29tbWl0MjA2MzY0OmYwZjg5YzdlMGVkNTM2NDdhZTA4YjQyNWYxMGU2ODUzNmQ0YmEwYWI=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2010-03-12T02:25:52Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2010-03-12T02:25:52Z"},"message":"OPENJPA-1561: Cache criteria query\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@922119 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"22d6cf689ddcabf5197977b9a3885edd6da6b954","url":"https://api.github.com/repos/apache/openjpa/git/trees/22d6cf689ddcabf5197977b9a3885edd6da6b954"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/f0f89c7e0ed53647ae08b425f10e68536d4ba0ab","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/f0f89c7e0ed53647ae08b425f10e68536d4ba0ab","html_url":"https://github.com/apache/openjpa/commit/f0f89c7e0ed53647ae08b425f10e68536d4ba0ab","comments_url":"https://api.github.com/repos/apache/openjpa/commits/f0f89c7e0ed53647ae08b425f10e68536d4ba0ab/comments","author":null,"committer":null,"parents":[{"sha":"0c65e3c409fe83da4d6c91c6512307c2206047d8","url":"https://api.github.com/repos/apache/openjpa/commits/0c65e3c409fe83da4d6c91c6512307c2206047d8","html_url":"https://github.com/apache/openjpa/commit/0c65e3c409fe83da4d6c91c6512307c2206047d8"}],"stats":{"total":7,"additions":5,"deletions":2},"files":[{"sha":"7568efeeb9dae61ac5ceca7a90dabecbb55f9858","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java","status":"modified","additions":5,"deletions":2,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/f0f89c7e0ed53647ae08b425f10e68536d4ba0ab/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java","raw_url":"https://github.com/apache/openjpa/raw/f0f89c7e0ed53647ae08b425f10e68536d4ba0ab/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/QueryImpl.java?ref=f0f89c7e0ed53647ae08b425f10e68536d4ba0ab","patch":"@@ -150,7 +150,8 @@ public FetchPlan getFetchPlan() {\n \t}\n \n \tpublic String getQueryString() {\n-\t\treturn _query.getQueryString();\n+\t\tString result = _query.getQueryString();\n+\t\treturn result != null ? result : _id;\n \t}\n \n \tpublic boolean getIgnoreChanges() {\n@@ -291,6 +292,8 @@ private Object execute() {\n                 postExecute(result);\n             }\n             return result;\n+\t\t} catch (LockTimeoutException e) {\n+\t\t    throw new QueryTimeoutException(e.getMessage(), new Throwable[]{e}, getQueryString(), e.isFatal());\n \t\t} finally {\n \t\t    unlock();\n \t\t}\n@@ -528,7 +531,7 @@ private boolean preExecute(Map params) {\n             }\n             stats.recordExecution(pq.getOriginalQuery());\n         } else {\n-            stats.recordExecution(_query.getQueryString());\n+            stats.recordExecution(getQueryString());\n         }\n         return registered == Boolean.TRUE;\n     }"}]}

