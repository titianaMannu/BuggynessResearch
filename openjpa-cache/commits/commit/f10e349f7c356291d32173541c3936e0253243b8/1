{"sha":"f10e349f7c356291d32173541c3936e0253243b8","node_id":"MDY6Q29tbWl0MjA2MzY0OmYxMGUzNDlmN2MzNTYyOTFkMzIxNzM1NDFjMzkzNmUwMjUzMjQzYjg=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2011-03-29T16:38:59Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2011-03-29T16:38:59Z"},"message":"OPENJPA-1968 Set DATETIME2 based on db version and also set the correct date_precision for DATETIME2 type.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1086639 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"0b382b8523ca4859baadcc720a943d54f76b4a6d","url":"https://api.github.com/repos/apache/openjpa/git/trees/0b382b8523ca4859baadcc720a943d54f76b4a6d"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/f10e349f7c356291d32173541c3936e0253243b8","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/f10e349f7c356291d32173541c3936e0253243b8","html_url":"https://github.com/apache/openjpa/commit/f10e349f7c356291d32173541c3936e0253243b8","comments_url":"https://api.github.com/repos/apache/openjpa/commits/f10e349f7c356291d32173541c3936e0253243b8/comments","author":null,"committer":null,"parents":[{"sha":"59c9ec99af799b442c38cbe97efbe2fe9cb258d7","url":"https://api.github.com/repos/apache/openjpa/commits/59c9ec99af799b442c38cbe97efbe2fe9cb258d7","html_url":"https://github.com/apache/openjpa/commit/59c9ec99af799b442c38cbe97efbe2fe9cb258d7"}],"stats":{"total":21,"additions":11,"deletions":10},"files":[{"sha":"5a4e95f32406f0b094e8fda99143e59f6f607df6","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","status":"modified","additions":11,"deletions":10,"changes":21,"blob_url":"https://github.com/apache/openjpa/blob/f10e349f7c356291d32173541c3936e0253243b8/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/f10e349f7c356291d32173541c3936e0253243b8/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLServerDictionary.java?ref=f10e349f7c356291d32173541c3936e0253243b8","patch":"@@ -71,13 +71,21 @@ public void connectedConfiguration(Connection conn) throws SQLException {\n         String driverName = meta.getDriverName();\n         String url = meta.getURL();\n         if (driverVendor == null) {\n+            // serverMajorVersion of 8==2000, 9==2005, 10==2008\n+            if (meta.getDatabaseMajorVersion() >= 9)\n+                setSupportsXMLColumn(true);\n+            if (meta.getDatabaseMajorVersion() >= 10) {\n+                // MSSQL 2008 supports new date, time and datetime2 types\n+                // Use DATETIME2 which has 100ns vs. 3.333msec precision\n+                dateTypeName = \"DATETIME2\";\n+                timeTypeName = \"DATETIME2\";\n+                timestampTypeName = \"DATETIME2\";\n+                datePrecision = MICRO / 10;\n+            }\n             if (driverName != null) {\n                 if (driverName.startsWith(\"Microsoft SQL Server\")) {\n                     // v1.1, 1.2, 2.0 or 3.0 driver\n                     driverVendor = VENDOR_MICROSOFT;\n-                    // serverMajorVersion of 8==2000, 9==2005, 10==2008\n-                    if (meta.getDatabaseMajorVersion() >= 9)\n-                        setSupportsXMLColumn(true);\n                     if (meta.getDriverMajorVersion() >= 2) {\n                         // see http://blogs.msdn.com/jdbcteam/archive/2007/05/\\\n                         // 02/what-is-adaptive-response-buffering-and-why-\\\n@@ -87,13 +95,6 @@ public void connectedConfiguration(Connection conn) throws SQLException {\n                         // and disableStatementPooling=true\n                         requiresWarnings = false;\n                     }\n-                    if (meta.getDatabaseMajorVersion() >= 10) {\n-                        // MSSQL 2008 supports new date, time and datetime2 types\n-                        // Use DATETIME2 which has 100ns vs. 3.333msec precision\n-                        dateTypeName = \"DATETIME2\";\n-                        timeTypeName = \"DATETIME2\";\n-                        timestampTypeName = \"DATETIME2\";\n-                    }\n                 } else {\n                     if (\"NetDirect JSQLConnect\".equals(driverName))\n                         driverVendor = VENDOR_NETDIRECT;"}]}

