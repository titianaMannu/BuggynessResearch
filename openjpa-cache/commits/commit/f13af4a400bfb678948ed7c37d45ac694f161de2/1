{"sha":"f13af4a400bfb678948ed7c37d45ac694f161de2","node_id":"MDY6Q29tbWl0MjA2MzY0OmYxM2FmNGE0MDBiZmI2Nzg5NDhlZDdjMzdkNDVhYzY5NGYxNjFkZTI=","commit":{"author":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-08-31T17:42:03Z"},"committer":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-08-31T17:42:03Z"},"message":"OPENJPA-1272 Test was not cleaning up after itself properly.  This was causing failures on some build configurations.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@809671 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"6e1a00bafa0232b38881480d79680097715279c6","url":"https://api.github.com/repos/apache/openjpa/git/trees/6e1a00bafa0232b38881480d79680097715279c6"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/f13af4a400bfb678948ed7c37d45ac694f161de2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/f13af4a400bfb678948ed7c37d45ac694f161de2","html_url":"https://github.com/apache/openjpa/commit/f13af4a400bfb678948ed7c37d45ac694f161de2","comments_url":"https://api.github.com/repos/apache/openjpa/commits/f13af4a400bfb678948ed7c37d45ac694f161de2/comments","author":null,"committer":null,"parents":[{"sha":"f214d9f3971bd2f0b5c25574664c57841025dd7b","url":"https://api.github.com/repos/apache/openjpa/commits/f214d9f3971bd2f0b5c25574664c57841025dd7b","html_url":"https://github.com/apache/openjpa/commit/f214d9f3971bd2f0b5c25574664c57841025dd7b"}],"stats":{"total":164,"additions":107,"deletions":57},"files":[{"sha":"4ef3d45634406eb500423790af05e863f26fcbea","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java","status":"modified","additions":31,"deletions":8,"changes":39,"blob_url":"https://github.com/apache/openjpa/blob/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java","raw_url":"https://github.com/apache/openjpa/raw/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java?ref=f13af4a400bfb678948ed7c37d45ac694f161de2","patch":"@@ -54,19 +54,42 @@ public void testElementCollectionAssocOverrides() {\n             \"embed-persistence.xml\", props);\n \n         EntityManager em = emf1.createEntityManager();\n+\n+        XMLAssocOverEntityA ea = new XMLAssocOverEntityA();\n+        XMLAssocOverEntityB eb = new XMLAssocOverEntityB();\n+        XMLAssocOverEntityB meb = new XMLAssocOverEntityB();\n+        XMLAssocOverEmbed emb = new XMLAssocOverEmbed();\n+        eb.setName(\"XMLAssocOverEntityB\");\n+        meb.setName(\"XMLAssocOverEntityBM21\");\n+        List<XMLAssocOverEntityA> eaList1 = new ArrayList<XMLAssocOverEntityA>();\n+        eaList1.add(ea);\n+        List<XMLAssocOverEntityA> eaList2 = new ArrayList<XMLAssocOverEntityA>();        \n+        eaList2.add(ea);\n+        eb.setEaList(eaList1);\n+        meb.setEaList(eaList2);\n+        emb.setName(\"XMLAssocOverEmbed\");\n+        emb.setEb(eb);\n+        emb.setMeb(meb);\n+        List<XMLAssocOverEmbed> embList = new ArrayList<XMLAssocOverEmbed>();\n+        embList.add(emb);\n+        ea.setEmbA(embList);\n+        \n         em.getTransaction().begin();\n+        em.persist(ea);\n         em.getTransaction().commit();\n         em.close();\n-        // The above should trigger schema definition\n-                \n-        assertSQLFragnments(_sql, \"CREATE TABLE XML_EMBALIST .*\" +\n+        try {\n+            assertSQLFragnments(_sql, \"CREATE TABLE XML_EMBALIST .*\" +\n                 \" .*emba_entb.*emba_mentb\");\n         \n-        try {\n-            if (emf1 != null)\n-                cleanupEMF(emf1);\n-        } catch (Exception e) {\n-            fail(e.getMessage());\n+        } \n+        finally {\n+            try {\n+                if (emf1 != null)\n+                    cleanupEMF(emf1);\n+            } catch (Exception e) {\n+                fail(e.getMessage());\n+            }\n         }\n     }\n "},{"sha":"dae25fa4b5459e1210189f69569264f6eff8fb43","filename":"openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","raw_url":"https://github.com/apache/openjpa/raw/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml?ref=f13af4a400bfb678948ed7c37d45ac694f161de2","patch":"@@ -50,6 +50,7 @@\n         <mapping-file>org/apache/openjpa/persistence/jdbc/order/order-orm-3.xml</mapping-file>\n         <mapping-file>org/apache/openjpa/persistence/inheritance/orm.xml</mapping-file>\n         <mapping-file>org/apache/openjpa/persistence/orm.xml</mapping-file>\n+        <mapping-file>org/apache/openjpa/persistence/embed/embed-assoc-over-orm.xml</mapping-file>\n         <properties>\n             <property name=\"openjpa.jdbc.SynchronizeMappings\"\n                 value=\"buildSchema(ForeignKeys=true)\"/>"},{"sha":"7cf2c643a7df27c79e7e6b578f0e1b9b243dd1b0","filename":"openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-assoc-over-orm.xml","status":"added","additions":72,"deletions":0,"changes":72,"blob_url":"https://github.com/apache/openjpa/blob/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-assoc-over-orm.xml","raw_url":"https://github.com/apache/openjpa/raw/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-assoc-over-orm.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-assoc-over-orm.xml?ref=f13af4a400bfb678948ed7c37d45ac694f161de2","patch":"@@ -0,0 +1,72 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+ Licensed to the Apache Software Foundation (ASF) under one\n+ or more contributor license agreements.  See the NOTICE file\n+ distributed with this work for additional information\n+ regarding copyright ownership.  The ASF licenses this file\n+ to you under the Apache License, Version 2.0 (the\n+ \"License\"); you may not use this file except in compliance\n+ with the License.  You may obtain a copy of the License at\n+\n+ http://www.apache.org/licenses/LICENSE-2.0\n+\n+ Unless required by applicable law or agreed to in writing,\n+ software distributed under the License is distributed on an\n+ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ KIND, either express or implied.  See the License for the\n+ specific language governing permissions and limitations\n+ under the License.\n+-->\n+<!-- AtestCatalog metadata in xml -->\n+<entity-mappings xmlns=\"http://java.sun.com/xml/ns/persistence/orm\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://java.sun.com/xml/ns/persistence/orm orm_2_0.xsd\"\n+    version=\"2.0\">\n+    \n+    <entity class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityA\">\n+        <attributes>\n+            <id name=\"id\">\n+                <generated-value/>\n+            </id>\n+            <element-collection name=\"embaList\">\n+                <association-override name=\"eb\">\n+                    <join-column name=\"emba_entb\" />\n+                </association-override>\n+                <association-override name=\"meb\">\n+                    <join-column name=\"emba_mentb\" />\n+                </association-override>\n+                <collection-table name=\"XML_EMBALIST\"/>\n+            </element-collection>\n+        </attributes>\n+    </entity>\n+    \n+    <entity class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityB\">\n+        <attributes>\n+            <id name=\"id\">\n+                <generated-value/>\n+            </id>\n+            <basic name=\"name\"/>\n+            <one-to-many name=\"eaList\">\n+                <cascade>\n+                    <cascade-all />\n+                </cascade>\n+            </one-to-many>\n+        </attributes>\n+    </entity>\n+\n+    <embeddable class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEmbed\">\n+        <attributes>\n+            <basic name=\"name\"/>\n+            <many-to-one name=\"meb\">\n+                <cascade>\n+                    <cascade-all />\n+                </cascade>\n+            </many-to-one>\n+            <one-to-one name=\"eb\">\n+                <cascade>\n+                    <cascade-all />\n+                </cascade>\n+            </one-to-one>\n+        </attributes>\n+    </embeddable>    \n+</entity-mappings>\n\\ No newline at end of file"},{"sha":"1b71f744e8838983f8648cf995a7a32fd9b03acd","filename":"openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml","status":"modified","additions":1,"deletions":47,"changes":48,"blob_url":"https://github.com/apache/openjpa/blob/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml","raw_url":"https://github.com/apache/openjpa/raw/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml?ref=f13af4a400bfb678948ed7c37d45ac694f161de2","patch":"@@ -216,36 +216,6 @@ version=\"2.0\">\n         </attributes>\n     </entity>    \n \n-    <entity class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityA\">\n-        <attributes>\n-            <id name=\"id\">\n-                <generated-value/>\n-            </id>\n-            <element-collection name=\"embaList\">\n-                <association-override name=\"eb\">\n-                    <join-column name=\"emba_entb\" />\n-                </association-override>\n-                <association-override name=\"meb\">\n-                    <join-column name=\"emba_mentb\" />\n-                </association-override>\n-                <collection-table name=\"XML_EMBALIST\"/>\n-            </element-collection>\n-        </attributes>\n-    </entity>\n-    \n-    <entity class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityB\">\n-        <attributes>\n-            <id name=\"id\">\n-                <generated-value/>\n-            </id>\n-            <basic name=\"name\"/>\n-            <one-to-many name=\"eaList\">\n-                <cascade>\n-                    <cascade-all />\n-                </cascade>\n-            </one-to-many>\n-        </attributes>\n-    </entity>\n     <embeddable \n         class=\"org.apache.openjpa.persistence.embed.attrOverrides.AddressXml\" \n         access=\"FIELD\">\n@@ -303,21 +273,5 @@ version=\"2.0\">\n                 <column name=\"shouldNotExist\" />\n             </basic>\n         </attributes>\n-    </embeddable>\n-    \n-    <embeddable class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEmbed\">\n-        <attributes>\n-            <basic name=\"name\"/>\n-            <many-to-one name=\"meb\">\n-                <cascade>\n-                    <cascade-all />\n-                </cascade>\n-            </many-to-one>\n-            <one-to-one name=\"eb\">\n-                <cascade>\n-                    <cascade-all />\n-                </cascade>\n-            </one-to-one>\n-        </attributes>\n-    </embeddable>\n+    </embeddable>    \n </entity-mappings>\n\\ No newline at end of file"},{"sha":"0cb208bc794f8cedb46f8c5cc0086b12553b9195","filename":"openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml","raw_url":"https://github.com/apache/openjpa/raw/f13af4a400bfb678948ed7c37d45ac694f161de2/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml?ref=f13af4a400bfb678948ed7c37d45ac694f161de2","patch":"@@ -21,12 +21,12 @@\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n     version=\"2.0\">\n     <persistence-unit name=\"AssocOverPU\">\n-        <mapping-file>org/apache/openjpa/persistence/embed/embed-orm.xml</mapping-file>\n+        <mapping-file>org/apache/openjpa/persistence/embed/embed-assoc-over-orm.xml</mapping-file>\n         <class>org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEmbed</class>\n         <class>org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityA</class>\n         <class>org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityB</class>\n             <properties>\n-                <property name=\"openjpa.jdbc.SynchronizeMappings\" value=\"buildSchema\"/>                \n+                <property name=\"openjpa.jdbc.SynchronizeMappings\" value=\"buildSchema(SchemaAction='drop,add')\"/>                \n             </properties>\n     </persistence-unit>\n </persistence>"}]}

