{"sha":"f56a7555a7f05be898ab6dbe11ff7de6246a8231","node_id":"MDY6Q29tbWl0MjA2MzY0OmY1NmE3NTU1YTdmMDViZTg5OGFiNmRiZTExZmY3ZGU2MjQ2YTgyMzE=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-09-11T23:17:27Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2006-09-11T23:17:27Z"},"message":"Don't bother using a subselect in bulk UPDATE or DELETE clauses if there is no where condition, since it does the exact same think as an unqulaified bulk operation.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@442385 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"46971834fbd172ebd4d2ecb9ce175aaa96798d03","url":"https://api.github.com/repos/apache/openjpa/git/trees/46971834fbd172ebd4d2ecb9ce175aaa96798d03"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/f56a7555a7f05be898ab6dbe11ff7de6246a8231","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/f56a7555a7f05be898ab6dbe11ff7de6246a8231","html_url":"https://github.com/apache/openjpa/commit/f56a7555a7f05be898ab6dbe11ff7de6246a8231","comments_url":"https://api.github.com/repos/apache/openjpa/commits/f56a7555a7f05be898ab6dbe11ff7de6246a8231/comments","author":null,"committer":null,"parents":[{"sha":"1defd23037cbe55ef05902efc21d11b9a2afe972","url":"https://api.github.com/repos/apache/openjpa/commits/1defd23037cbe55ef05902efc21d11b9a2afe972","html_url":"https://github.com/apache/openjpa/commit/1defd23037cbe55ef05902efc21d11b9a2afe972"}],"stats":{"total":13,"additions":11,"deletions":2},"files":[{"sha":"9b7168d4b0f33b717d0ccb7f632e4561bf17ef51","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":11,"deletions":2,"changes":13,"blob_url":"https://github.com/apache/openjpa/blob/f56a7555a7f05be898ab6dbe11ff7de6246a8231/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/f56a7555a7f05be898ab6dbe11ff7de6246a8231/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=f56a7555a7f05be898ab6dbe11ff7de6246a8231","patch":"@@ -1792,15 +1792,24 @@ protected SQLBuffer toBulkOperation(ClassMapping mapping, Select sel,\n             return sql;\n         }\n \n+        Table table = mapping.getTable();\n+        String tableName = getFullName(table, false);\n+\n+        // only use a  subselect if the where is not empty; otherwise\n+        // an unqualified delete or update will work\n+        if (sel.getWhere() == null || sel.getWhere().isEmpty()) {\n+            sql.append(tableName);\n+            appendUpdates(sel, store, sql, params, updateParams, false);\n+            return sql;\n+        }\n+\n         // we need to use a subselect if we are to bulk delete where\n         // the select includes multiple tables; if the database\n         // doesn't support it, then we need to sigal this by returning null\n         if (!supportsSubselect || !supportsCorrelatedSubselect)\n             return null;\n \n         Column[] pks = mapping.getPrimaryKeyColumns();\n-        Table table = mapping.getTable();\n-        String tableName = getFullName(table, false);\n         sel.clearSelects();\n         sel.setDistinct(true);\n "}]}

