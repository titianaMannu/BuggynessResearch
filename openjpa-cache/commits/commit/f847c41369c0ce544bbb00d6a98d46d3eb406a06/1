{"sha":"f847c41369c0ce544bbb00d6a98d46d3eb406a06","node_id":"MDY6Q29tbWl0MjA2MzY0OmY4NDdjNDEzNjljMGNlNTQ0YmJiMDBkNmE5OGQ0NmQzZWI0MDZhMDY=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2010-07-22T15:06:07Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2010-07-22T15:06:07Z"},"message":"OPENJPA-1742: add documentation\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/2.0.x@966702 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"4cd761fa6defe7f552ea6a0cf54467e92c9b200a","url":"https://api.github.com/repos/apache/openjpa/git/trees/4cd761fa6defe7f552ea6a0cf54467e92c9b200a"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/f847c41369c0ce544bbb00d6a98d46d3eb406a06","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/f847c41369c0ce544bbb00d6a98d46d3eb406a06","html_url":"https://github.com/apache/openjpa/commit/f847c41369c0ce544bbb00d6a98d46d3eb406a06","comments_url":"https://api.github.com/repos/apache/openjpa/commits/f847c41369c0ce544bbb00d6a98d46d3eb406a06/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"d39c5806886fb5c81c2b959e5e0a602e7c93352c","url":"https://api.github.com/repos/apache/openjpa/commits/d39c5806886fb5c81c2b959e5e0a602e7c93352c","html_url":"https://github.com/apache/openjpa/commit/d39c5806886fb5c81c2b959e5e0a602e7c93352c"}],"stats":{"total":105,"additions":105,"deletions":0},"files":[{"sha":"0572b2b8a88d08af6884540804ac12357f1b4a3e","filename":"openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","status":"modified","additions":105,"deletions":0,"changes":105,"blob_url":"https://github.com/apache/openjpa/blob/f847c41369c0ce544bbb00d6a98d46d3eb406a06/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","raw_url":"https://github.com/apache/openjpa/raw/f847c41369c0ce544bbb00d6a98d46d3eb406a06/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-project/src/doc/manual/ref_guide_dbsetup.xml?ref=f847c41369c0ce544bbb00d6a98d46d3eb406a06","patch":"@@ -370,6 +370,111 @@ properties are outlined in <xref linkend=\"ref_guide_conf\"/>.\n </programlisting>\n             </example>\n         </section>\n+        <section id=\"ref_guide_dbsetup_setDSatRuntime\">\n+            <title>Setting the DataSource at runtime</title>\n+            <indexterm zone=\"ref_guide_dbsetup_setDSatRuntime\">\n+                <primary>connections</primary>\n+                <secondary>override configuration</secondary>\n+            </indexterm>\n+            <para> \n+As mentioned above, the JTA and Non-JTA DataSources may be passed in as configuration properties\n+at EntityManagerFactory creation. Either the JPA standard properties (\n+<literal>javax.persistence.jtaDataSource</literal>, <literal>java.persistence.nonJtaDataSource</literal>) \n+or their OpenJPA specific equivalents (<literal>openjpa.ConnectionFactoryName</literal>, \n+<literal>openjpa.ConnectionFactory2Name</literal>) may be used. One usecase for this function is to \n+store production connection information in configuration files but override the value when testing. \n+            </para>\n+            <para>\n+            <example>\n+                <programlisting>Map&lt;Object,Object&gt; props = new HashMap&lt;Object,Object&gt;();\n+props.put(\"javax.persistence.jtaDataSource\", \"jdbc/myDataSource\");\n+props.put(\"javax.persistence.nonJtaDataSource\", \"jdbc/myNonJTADataSource\");\n+emf = Persistence.createEntityManagerFactory(\"example\", props);</programlisting>\n+            </example>\n+            </para>\n+                <section id=\"ref_guide_dbsetup_setDSPerEM\">\n+                <title>Using different datasources for each EntityManager</title> \n+                <para>\n+The JPA specification allows the DataSource (ConnectionFactory) to be specified on the \n+EntityManagerFactory.OpenJPA extends this support and allows each EntityManager to override the \n+DataSource from the EntityManagerFactory. It's expected that the EntityManagerFactory will also be \n+configured with a valid jta / nonJta DataSource. The DataSource configured on the \n+EntityManagerFactory will be used to obtain a DBDictionary and (rarely) to gather some information\n+about the database in use (e.g. version, JDBC driver version). \n+                </para>\n+                <para>\n+                    If the EntityManagerFactory is not configured with a valid DataSource there are\n+                    a few additional caveats. \n+                    <itemizedlist>\n+                        <listitem><para>The <literal>openjpa.DBDictionary</literal> property must be\n+                        used to ensure the correct DBDictionary is used.</para></listitem>\n+                        <listitem><para>OpenJPA will always attempt to obtain a datasource from JNDI\n+                        based on the configuration for the EntityManagerFactory. When a JNDI name is\n+                        specified on the EntityManager this lookup happens slightly earlier than \n+                        normal. If the lookup fails the JNDI name provided at EntityManager creation\n+                        will be set into the EntityManagerFactory's configuration and used in\n+                        subsequent attempts. </para></listitem>\n+                    </itemizedlist>\n+                </para>\n+                <section id=\"ref_guide_dbsetup_setDSBenefits\">\n+                    <title>Benefits</title>\n+                    <para>\n+                    In effect this option allows a single set of entity definitions to be shared \n+                    between multiple database instances or schemas within an instance. This can be\n+                    highly beneficial when there are a large number of entity definitions (e.g. >\n+                    200), or a large number of databases / schemas in use.\n+                    </para> \n+                </section>\n+                <section id=\"ref_guide_dbsetup_setDSLimitations\">\n+                    <title>Limitations</title>\n+                    <para>\n+                        <itemizedlist>\n+                            <listitem>\n+                                <para>The same database type and version must be used by each \n+                                EntityManager. OpenJPA will use the same DBDictionary for each\n+                                EntityManager and will make no attempt to alter SQL syntax \n+                                between EntityManager instances. \n+                            </para>\n+                            </listitem>\n+                            <listitem><para>It is the application's responsibility to ensure \n+                            that the schema is identical on each database.</para></listitem>\n+                            <listitem><para>The application may not specify schema names for \n+                            individual entities.</para></listitem>\n+                            <listitem>\n+                                <para>The DataSource (ConnectionFactory) name may only be \n+                                specified when the EntityManager is created. The datasource \n+                                may not be switched while an EntityManager is in use.\n+                                </para>\n+                            </listitem>\n+                            <listitem><para>The L2 cache (DataCache) should not be used if \n+                            different DataSources are specified for each EntityManager</para>\n+                            </listitem>\n+                            <listitem><para>SynchronizeMappings should not be used with this \n+                            feature.</para></listitem>\n+                            <listitem><para>Table and Sequence generators should not be used \n+                            with this feature.</para></listitem>\n+                            <listitem><para>It is not required, but is recommended that the \n+                            <literal>openjpa.DBDictionary</literal> property be specified when \n+                            using this feature</para></listitem> \n+                        </itemizedlist>\n+                    </para> \n+                </section>\n+                <section id=\"ref_guide_dbsetup_setDSError\">\n+                    <title>Error handling</title>\n+                    <para>\n+                    If a JTA DataSource is not available when the EntityManager is created an \n+                    <link linkend=\"\"><literal>ArgumentException</literal></link> will be thrown.\n+                    The EntityManager will not fall back on the JTA DataSource defined in the \n+                    configuration. \n+                    </para> \n+                    <para>\n+                    The same logic applies if a Non-JTA DataSource is not available when the \n+                    EntityManager is created. OpenJPA will not fall back to the configured \n+                    non-JTA DataSource.\n+                    </para>\n+                </section>\n+            </section>\n+        </section>\n     </section>\n     <section id=\"ref_guide_dbsetup_sqlconn\">\n         <title>"}]}

