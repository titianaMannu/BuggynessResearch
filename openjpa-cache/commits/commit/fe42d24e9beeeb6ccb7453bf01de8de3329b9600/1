{"sha":"fe42d24e9beeeb6ccb7453bf01de8de3329b9600","node_id":"MDY6Q29tbWl0MjA2MzY0OmZlNDJkMjRlOWJlZWViNmNjYjc0NTNiZjAxZGU4ZGUzMzI5Yjk2MDA=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2006-10-07T09:22:29Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2006-10-07T09:22:29Z"},"message":"made ProductDerivations a bit more fault-tolerant -- when a failure occurs while loading ProductDerivation instances defined in services files, the system continues to start up with the ProductDerivations that did load, and a warning is printed to stderr. Note that this means that people using the uber-jar in 1.3 or 1.4 environments, or without having javax.persistence in their classpath, for example, will see warnings on stderr.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@453875 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"9128162f7fea98d86f10f2e99a8484c6116c3d42","url":"https://api.github.com/repos/apache/openjpa/git/trees/9128162f7fea98d86f10f2e99a8484c6116c3d42"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/fe42d24e9beeeb6ccb7453bf01de8de3329b9600","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/fe42d24e9beeeb6ccb7453bf01de8de3329b9600","html_url":"https://github.com/apache/openjpa/commit/fe42d24e9beeeb6ccb7453bf01de8de3329b9600","comments_url":"https://api.github.com/repos/apache/openjpa/commits/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/comments","author":null,"committer":null,"parents":[{"sha":"2ada6c32922f40d755d48aab1ef69d1480773829","url":"https://api.github.com/repos/apache/openjpa/commits/2ada6c32922f40d755d48aab1ef69d1480773829","html_url":"https://github.com/apache/openjpa/commit/2ada6c32922f40d755d48aab1ef69d1480773829"}],"stats":{"total":39,"additions":22,"deletions":17},"files":[{"sha":"06610582f6dd4b876d8814f3cbfcb9cada67ad78","filename":"openjpa-kernel/src/main/resources/org/apache/openjpa/conf/localizer.properties","status":"modified","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/apache/openjpa/blob/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/openjpa-kernel/src/main/resources/org/apache/openjpa/conf/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/openjpa-kernel/src/main/resources/org/apache/openjpa/conf/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/resources/org/apache/openjpa/conf/localizer.properties?ref=fe42d24e9beeeb6ccb7453bf01de8de3329b9600","patch":"@@ -536,13 +536,3 @@ no-named-cf: use a DataSource bound to JNDI\n diff-specs: Attempt to configure for multiple specifications.  Was configured \\\n \tfor \"{0}\".  Attempt to now configure for \"{1}\".  This attempt will be \\\n \tignored.\n-no-product-derivations: Your system is missing product derivations.  Product \\\n-    derivations provide configuration options for supported data stores and \\\n-    specifications.  You must have a META-INF/services/{0} file in your \\\n-    classpath listing the available derivation classes, and some listed class \\\n-    must be instantiable.  Typically this file is bundled as part of the \\\n-    distribution.  Have you unbundled it, or unbundled its listed classes? \\\n-    If you are using ant, a common solution to this problem is to place \\\n-    the jar libraries of the OpenJPA distribution in the \\\n-    $'{user.home}/.ant/lib directory. Another common cause of this problem \\\n-    is an overly-restrictive security manager."},{"sha":"e58a94b5b6c6bd6fbc32436a44984b19d371d1d3","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java","status":"modified","additions":9,"deletions":7,"changes":16,"blob_url":"https://github.com/apache/openjpa/blob/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java","raw_url":"https://github.com/apache/openjpa/raw/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java?ref=fe42d24e9beeeb6ccb7453bf01de8de3329b9600","patch":"@@ -36,15 +36,17 @@\n     private static final ProductDerivation[] _derivations;\n     private static final String[] _prefixes;\n     static {\n-        Class[] pdcls = Services.getImplementorClasses(ProductDerivation.class,\n-            ProductDerivation.class.getClassLoader());\n-        List derivations = new ArrayList(pdcls.length);\n-        for (int i = 0; i < pdcls.length; i++) {\n+        ClassLoader cl = ProductDerivation.class.getClassLoader();\n+        String pds = Services.getImplementors(ProductDerivation.class, cl);\n+        List derivations = new ArrayList(pds.length);\n+        for (int i = 0; i < pds.length; i++) {\n             try {\n-                derivations.add(pdcls[i].newInstance());\n+                Class cls = Class.forName(pds[i], true, cl);\n+                derivations.add(cls.newInstance());\n             } catch (Throwable t) {\n-                // invalid service\n-                t.printStackTrace();\n+                Localizer loc = Localizer.forPackage(ProductDerivations.class);\n+                System.err.println(loc.get(\"bad-product-derivation\", pds[i], \n+                    t));\n             }\n         }\n "},{"sha":"506eaba850c0824b305b870164649ec7198c1f12","filename":"openjpa-lib/src/main/resources/org/apache/openjpa/lib/conf/localizer.properties","status":"modified","additions":13,"deletions":0,"changes":13,"blob_url":"https://github.com/apache/openjpa/blob/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/openjpa-lib/src/main/resources/org/apache/openjpa/lib/conf/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/fe42d24e9beeeb6ccb7453bf01de8de3329b9600/openjpa-lib/src/main/resources/org/apache/openjpa/lib/conf/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/resources/org/apache/openjpa/lib/conf/localizer.properties?ref=fe42d24e9beeeb6ccb7453bf01de8de3329b9600","patch":"@@ -58,6 +58,19 @@ plugin-creation-exception: An exception occurred while creating a plugin for \\\n     value {0}. This exception will be consumed.\n anchor-only: You cannot supply a configuration unit name only.  You must also \\\n     supply the name of the resource in which the unit appears.\n+no-product-derivations: Your system is missing product derivations.  Product \\\n+    derivations provide configuration options for supported data stores and \\\n+    specifications.  You must have a META-INF/services/{0} file in your \\\n+    classpath listing the available derivation classes, and some listed class \\\n+    must be instantiable.  Typically this file is bundled as part of the \\\n+    distribution.  Have you unbundled it, or unbundled its listed classes? \\\n+    If you are using ant, a common solution to this problem is to place \\\n+    the jar libraries of the OpenJPA distribution in the \\\n+    $'{user.home}/.ant/lib directory. Another common cause of this problem \\\n+    is an overly-restrictive security manager.\n+bad-product-derivation: An error occurred while attempting to load {0}. This \\\n+    may indicate a corrupt system configuration, or may just be the result \\\n+    of the inclusion of unused OpenJPA modules in your classpath. Error: {1}\n \n Log-name: Log factory\n Log-desc: LogFactory and configuration"}]}

