{"sha":"fe44661dc2614e44953e0d9aaba56e89954ccab5","node_id":"MDY6Q29tbWl0MjA2MzY0OmZlNDQ2NjFkYzI2MTRlNDQ5NTNlMGQ5YWFiYTU2ZTg5OTU0Y2NhYjU=","commit":{"author":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-08-28T21:29:36Z"},"committer":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2009-08-28T21:29:36Z"},"message":"OPENJPA-1272 Add testcases for association overrides applied to element collection with domain featureSelection defined in XML.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@809035 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f6ee675e0a9ffe6c3056f12177f9dfd589e8f59b","url":"https://api.github.com/repos/apache/openjpa/git/trees/f6ee675e0a9ffe6c3056f12177f9dfd589e8f59b"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/fe44661dc2614e44953e0d9aaba56e89954ccab5","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/fe44661dc2614e44953e0d9aaba56e89954ccab5","html_url":"https://github.com/apache/openjpa/commit/fe44661dc2614e44953e0d9aaba56e89954ccab5","comments_url":"https://api.github.com/repos/apache/openjpa/commits/fe44661dc2614e44953e0d9aaba56e89954ccab5/comments","author":null,"committer":null,"parents":[{"sha":"fdcbdccae05b5006770f9965b45cab5526c7655d","url":"https://api.github.com/repos/apache/openjpa/commits/fdcbdccae05b5006770f9965b45cab5526c7655d","html_url":"https://github.com/apache/openjpa/commit/fdcbdccae05b5006770f9965b45cab5526c7655d"}],"stats":{"total":349,"additions":349,"deletions":0},"files":[{"sha":"3bec4ef1a3e27de254183a5262fdc79c11767cbd","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java","status":"added","additions":120,"deletions":0,"changes":120,"blob_url":"https://github.com/apache/openjpa/blob/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java","raw_url":"https://github.com/apache/openjpa/raw/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/TestAssocOverridesXML.java?ref=fe44661dc2614e44953e0d9aaba56e89954ccab5","patch":"@@ -0,0 +1,120 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.    \n+ */\n+package org.apache.openjpa.persistence.embed.attrOverrides;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+import javax.persistence.EntityManager;\n+\n+import org.apache.openjpa.lib.jdbc.AbstractJDBCListener;\n+import org.apache.openjpa.lib.jdbc.JDBCEvent;\n+import org.apache.openjpa.lib.jdbc.JDBCListener;\n+import org.apache.openjpa.persistence.OpenJPAEntityManagerFactorySPI;\n+import org.apache.openjpa.persistence.OpenJPAPersistence;\n+import org.apache.openjpa.persistence.jdbc.SQLSniffer;\n+import org.apache.openjpa.persistence.test.AbstractPersistenceTestCase;\n+\n+public class TestAssocOverridesXML  extends AbstractPersistenceTestCase{ \n+\n+    protected List<String> _sql = new ArrayList<String>();\n+\n+    /**\n+     * Test association overrides defined within an embedded of an element\n+     * collection\n+     */\n+    public void testElementCollectionAssocOverrides() {\n+\n+        _sql.clear();\n+        HashMap<String, Object> props = new HashMap<String, Object>();\n+        props.put(\"openjpa.jdbc.JDBCListeners\", \n+            new JDBCListener[] { new SQLListener() });\n+        OpenJPAEntityManagerFactorySPI emf1 = \n+            (OpenJPAEntityManagerFactorySPI)OpenJPAPersistence.\n+            createEntityManagerFactory(\"AssocOverPU\",\n+            \"org/apache/openjpa/persistence/embed/\" +\n+            \"embed-persistence.xml\", props);\n+\n+        EntityManager em = emf1.createEntityManager();\n+        em.getTransaction().begin();\n+        em.getTransaction().commit();\n+        em.close();\n+        // The above should trigger schema definition\n+                \n+        assertSQLFragnments(_sql, \"CREATE TABLE XML_EMBALIST .*\" +\n+                \" .*emba_entb.*emba_mentb\");\n+        \n+        try {\n+            if (emf1 != null)\n+                cleanupEMF(emf1);\n+        } catch (Exception e) {\n+            fail(e.getMessage());\n+        }\n+    }\n+\n+    void assertSQLFragnments(List<String> list, String... keys) {\n+        if (SQLSniffer.matches(list, keys))\n+            return;\n+        fail(\"None of the following \" + list.size() + \" SQL \\r\\n\" + \n+                toString(list) + \"\\r\\n contains all keys \\r\\n\"\n+                + toString(Arrays.asList(keys)));\n+    }\n+\n+    private static String toString(List<String> list) {\n+        StringBuffer buf = new StringBuffer();\n+        for (String s : list)\n+            buf.append(s).append(\"\\r\\n\");\n+        return buf.toString();\n+    }\n+    \n+    /**\n+     * Closes a specific entity manager factory and cleans up \n+     * associated tables.\n+     */\n+    private void cleanupEMF(OpenJPAEntityManagerFactorySPI emf1) \n+      throws Exception {\n+\n+        if (emf1 == null)\n+            return;\n+\n+        try {\n+            clear(emf1);\n+        } catch (Exception e) {\n+            // if a test failed, swallow any exceptions that happen\n+            // during tear-down, as these just mask the original problem.\n+            if (testResult.wasSuccessful())\n+                throw e;\n+        } finally {\n+            closeEMF(emf1);\n+        }\n+    }    \n+\n+    public class SQLListener\n+        extends AbstractJDBCListener {\n+\n+        @Override\n+        public void beforeExecuteStatement(JDBCEvent event) {\n+            if (event.getSQL() != null && _sql != null) {\n+                _sql.add(event.getSQL());\n+        }\n+    }\n+}\n+}"},{"sha":"7b4c016e55e08960b19102b569ac77f4fc4f33fb","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEmbed.java","status":"added","additions":52,"deletions":0,"changes":52,"blob_url":"https://github.com/apache/openjpa/blob/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEmbed.java","raw_url":"https://github.com/apache/openjpa/raw/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEmbed.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEmbed.java?ref=fe44661dc2614e44953e0d9aaba56e89954ccab5","patch":"@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.openjpa.persistence.embed.attrOverrides;\n+\n+public class XMLAssocOverEmbed {\n+    \n+    private String name;\n+    \n+    private XMLAssocOverEntityB eb;\n+\n+    private XMLAssocOverEntityB meb;\n+    \n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setEb(XMLAssocOverEntityB eb) {\n+        this.eb = eb;\n+    }\n+\n+    public XMLAssocOverEntityB getEb() {\n+        return eb;\n+    }\n+\n+    public void setMeb(XMLAssocOverEntityB meb) {\n+        this.meb = meb;\n+    }\n+\n+    public XMLAssocOverEntityB getMeb() {\n+        return meb;\n+    }\n+}"},{"sha":"ec92cabd91c02f5032bbf2dfec5126657e670420","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityA.java","status":"added","additions":44,"deletions":0,"changes":44,"blob_url":"https://github.com/apache/openjpa/blob/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityA.java","raw_url":"https://github.com/apache/openjpa/raw/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityA.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityA.java?ref=fe44661dc2614e44953e0d9aaba56e89954ccab5","patch":"@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.openjpa.persistence.embed.attrOverrides;\n+\n+import java.util.List;\n+\n+public class XMLAssocOverEntityA {\n+\n+    private int id;\n+    \n+    private List<XMLAssocOverEmbed> embaList;\n+\n+    public void setEmbA(List<XMLAssocOverEmbed> embA) {\n+        this.embaList = embA;\n+    }\n+\n+    public List<XMLAssocOverEmbed> getEmbA() {\n+        return embaList;\n+    }\n+\n+    public void setId(int id) {\n+        this.id = id;\n+    }\n+\n+    public int getId() {\n+        return id;\n+    }    \n+}"},{"sha":"ab2f4ef894f429c8e5206852e15b09ed921b4b67","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityB.java","status":"added","additions":55,"deletions":0,"changes":55,"blob_url":"https://github.com/apache/openjpa/blob/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityB.java","raw_url":"https://github.com/apache/openjpa/raw/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityB.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/attrOverrides/XMLAssocOverEntityB.java?ref=fe44661dc2614e44953e0d9aaba56e89954ccab5","patch":"@@ -0,0 +1,55 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.openjpa.persistence.embed.attrOverrides;\n+\n+import java.util.List;\n+\n+public class XMLAssocOverEntityB {\n+\n+    private int id;\n+    \n+    private String name;\n+    \n+    private List<XMLAssocOverEntityA> eaList;\n+\n+    public void setId(int id) {\n+        this.id = id;\n+    }\n+\n+    public int getId() {\n+        return id;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setEaList(List<XMLAssocOverEntityA> eaList) {\n+        this.eaList = eaList;\n+    }\n+\n+    public List<XMLAssocOverEntityA> getEaList() {\n+        return eaList;\n+    }\n+    \n+}"},{"sha":"8ada256791d576fe3a8373581b0950d2015b4775","filename":"openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml","status":"modified","additions":46,"deletions":0,"changes":46,"blob_url":"https://github.com/apache/openjpa/blob/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml","raw_url":"https://github.com/apache/openjpa/raw/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-orm.xml?ref=fe44661dc2614e44953e0d9aaba56e89954ccab5","patch":"@@ -216,6 +216,36 @@ version=\"2.0\">\n         </attributes>\n     </entity>    \n \n+    <entity class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityA\">\n+        <attributes>\n+            <id name=\"id\">\n+                <generated-value/>\n+            </id>\n+            <element-collection name=\"embaList\">\n+                <association-override name=\"eb\">\n+                    <join-column name=\"emba_entb\" />\n+                </association-override>\n+                <association-override name=\"meb\">\n+                    <join-column name=\"emba_mentb\" />\n+                </association-override>\n+                <collection-table name=\"XML_EMBALIST\"/>\n+            </element-collection>\n+        </attributes>\n+    </entity>\n+    \n+    <entity class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityB\">\n+        <attributes>\n+            <id name=\"id\">\n+                <generated-value/>\n+            </id>\n+            <basic name=\"name\"/>\n+            <one-to-many name=\"eaList\">\n+                <cascade>\n+                    <cascade-all />\n+                </cascade>\n+            </one-to-many>\n+        </attributes>\n+    </entity>\n     <embeddable \n         class=\"org.apache.openjpa.persistence.embed.attrOverrides.AddressXml\" \n         access=\"FIELD\">\n@@ -274,4 +304,20 @@ version=\"2.0\">\n             </basic>\n         </attributes>\n     </embeddable>\n+    \n+    <embeddable class=\"org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEmbed\">\n+        <attributes>\n+            <basic name=\"name\"/>\n+            <many-to-one name=\"meb\">\n+                <cascade>\n+                    <cascade-all />\n+                </cascade>\n+            </many-to-one>\n+            <one-to-one name=\"eb\">\n+                <cascade>\n+                    <cascade-all />\n+                </cascade>\n+            </one-to-one>\n+        </attributes>\n+    </embeddable>\n </entity-mappings>\n\\ No newline at end of file"},{"sha":"3660f778da009cbd44c2d52eecd5d0b1318942ab","filename":"openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml","status":"added","additions":32,"deletions":0,"changes":32,"blob_url":"https://github.com/apache/openjpa/blob/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml","raw_url":"https://github.com/apache/openjpa/raw/fe44661dc2614e44953e0d9aaba56e89954ccab5/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/embed/embed-persistence.xml?ref=fe44661dc2614e44953e0d9aaba56e89954ccab5","patch":"@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+ Licensed to the Apache Software Foundation (ASF) under one\n+ or more contributor license agreements.  See the NOTICE file\n+ distributed with this work for additional information\n+ regarding copyright ownership.  The ASF licenses this file\n+ to you under the Apache License, Version 2.0 (the\n+ \"License\"); you may not use this file except in compliance\n+ with the License.  You may obtain a copy of the License at\n+\n+ http://www.apache.org/licenses/LICENSE-2.0\n+\n+ Unless required by applicable law or agreed to in writing,\n+ software distributed under the License is distributed on an\n+ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ KIND, either express or implied.  See the License for the\n+ specific language governing permissions and limitations\n+ under the License.\n+-->\n+<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    version=\"2.0\">\n+    <persistence-unit name=\"AssocOverPU\">\n+        <mapping-file>org/apache/openjpa/persistence/embed/embed-orm.xml</mapping-file>\n+        <class>org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEmbed</class>\n+        <class>org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityA</class>\n+        <class>org.apache.openjpa.persistence.embed.attrOverrides.XMLAssocOverEntityB</class>\n+            <properties>\n+                <property name=\"openjpa.jdbc.SynchronizeMappings\" value=\"buildSchema\"/>                \n+            </properties>\n+    </persistence-unit>\n+</persistence>"}]}

