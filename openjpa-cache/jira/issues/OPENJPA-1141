{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12428375","self":"https://issues.apache.org/jira/rest/api/2/issue/12428375","key":"OPENJPA-1141","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313681","id":"12313681","description":"","name":"1.2.2","archived":false,"released":true,"releaseDate":"2010-01-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313326","id":"12313326","description":"","name":"1.3.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314149","id":"12314149","description":"2.0.0 Beta","name":"2.0.0-beta","archived":false,"released":true,"releaseDate":"2010-01-28"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161425","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313102","id":"12313102","description":"","name":"1.2.0","archived":false,"released":true,"releaseDate":"2008-08-12"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12333074","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12333074","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12469803","key":"OPENJPA-1736","self":"https://issues.apache.org/jira/rest/api/2/issue/12469803","fields":{"summary":"Mappings with foreign keys as identity fields sometimes not resolved correctly","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"204200","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yann","name":"yann","key":"yann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yann","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yann","name":"yann","key":"yann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yann","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1141/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3b6f5bb4[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5222cd86[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6a9c6d6c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2e96d344[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@15c97c7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@536bb3f3[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5a1553ff[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@4281a70a[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2706f232[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@297c390a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@59061d71[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@167048ac[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2010-01-08T00:07:29.864+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1141/watchers","watchCount":1,"isWatching":false},"created":"2009-06-19T15:35:19.958+0000","updated":"2011-01-17T14:28:20.400+0000","timeoriginalestimate":null,"description":"We have the NPE shown below in a reproducible testcase (ZIP attached to JIRA ...).\n\nWe've reduced our complex intended target domain featureSelection (about 200+ Entities) to a simpler featureSelection with only 3 classes which illustrate the problem: You'll find attached a test project with a first entity which has a a OneToMany (with an ElementJoinColumns, but that shouldn't matter?) to a second entity has a ManyToOne to a third entity. The middle entity has a Composite ID Class including a ManyToOne as a key, which according to http://openjpa.apache.org/builds/1.2.0/apache-openjpa-1.2.0/docs/manual/ref_guide_pc_oid.html#ref_guide_pc_oid_entitypk is supported, so this seems a bug in OpenJPA's mapping algos, somehow?\n\n<openjpa-1.2.1-r752877:753278 nonfatal general error> org.apache.openjpa.persistence.PersistenceException: null\n        at org.apache.openjpa.kernel.QueryImpl.compileForCompilation(QueryImpl.java:610)\n        at org.apache.openjpa.kernel.QueryImpl.compileForExecutor(QueryImpl.java:667)\n        at org.apache.openjpa.kernel.QueryImpl.getOperation(QueryImpl.java:1492)\n        at org.apache.openjpa.kernel.DelegatingQuery.getOperation(DelegatingQuery.java:123)\n        at org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:243)\n        at org.apache.openjpa.persistence.QueryImpl.getResultList(QueryImpl.java:294)\n        at testcase.TestMappingProblem.doTest(TestMappingProblem.java:42)\n        at testcase.TestMappingProblem.testIt(TestMappingProblem.java:20)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at junit.framework.TestCase.runTest(TestCase.java:154)\n        at junit.framework.TestCase.runBare(TestCase.java:127)\n        at junit.framework.TestResult$1.protect(TestResult.java:106)\n        at junit.framework.TestResult.runProtected(TestResult.java:124)\n        at junit.framework.TestResult.run(TestResult.java:109)\n        at junit.framework.TestCase.run(TestCase.java:118)\n        at junit.framework.TestSuite.runTest(TestSuite.java:208)\n        at junit.framework.TestSuite.run(TestSuite.java:203)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213)\n        at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)\n        at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127)\n        at org.apache.maven.surefire.Surefire.run(Surefire.java:177)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:345)\n        at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1009)\nCaused by: java.lang.NullPointerException\n        at org.apache.openjpa.jdbc.meta.MappingInfo.mergeJoinColumn(MappingInfo.java:1400)\n        at org.apache.openjpa.jdbc.meta.MappingInfo.createJoins(MappingInfo.java:1206)\n        at org.apache.openjpa.jdbc.meta.MappingInfo.createForeignKey(MappingInfo.java:968)\n        at org.apache.openjpa.jdbc.meta.ValueMappingInfo.getTypeJoin(ValueMappingInfo.java:104)\n        at org.apache.openjpa.jdbc.meta.strats.RelationFieldStrategy.map(RelationFieldStrategy.java:157)\n        at org.apache.openjpa.jdbc.meta.FieldMapping.setStrategy(FieldMapping.java:121)\n        at org.apache.openjpa.jdbc.meta.RuntimeStrategyInstaller.installStrategy(RuntimeStrategyInstaller.java:80)\n        at org.apache.openjpa.jdbc.meta.FieldMapping.resolveMapping(FieldMapping.java:454)\n        at org.apache.openjpa.jdbc.meta.FieldMapping.resolve(FieldMapping.java:419)\n        at org.apache.openjpa.jdbc.meta.ClassMapping.resolveNonRelationMappings(ClassMapping.java:869)\n        at org.apache.openjpa.jdbc.meta.MappingRepository.prepareMapping(MappingRepository.java:339)\n        at org.apache.openjpa.meta.MetaDataRepository.preMapping(MetaDataRepository.java:662)\n        at org.apache.openjpa.meta.MetaDataRepository.resolve(MetaDataRepository.java:549)\n        at org.apache.openjpa.meta.MetaDataRepository.getMetaData(MetaDataRepository.java:308)\n        at org.apache.openjpa.meta.MetaDataRepository.getMetaData(MetaDataRepository.java:363)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder.getClassMetaData(JPQLExpressionBuilder.java:159)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder.resolveClassMetaData(JPQLExpressionBuilder.java:139)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder.getCandidateMetaData(JPQLExpressionBuilder.java:225)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder.getCandidateMetaData(JPQLExpressionBuilder.java:195)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder.getCandidateType(JPQLExpressionBuilder.java:188)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder.access$600(JPQLExpressionBuilder.java:69)\n        at org.apache.openjpa.kernel.jpql.JPQLExpressionBuilder$ParsedJPQL.populate(JPQLExpressionBuilder.java:1756)\n        at org.apache.openjpa.kernel.jpql.JPQLParser.populate(JPQLParser.java:56)\n        at org.apache.openjpa.kernel.ExpressionStoreQuery.populateFromCompilation(ExpressionStoreQuery.java:153)\n        at org.apache.openjpa.kernel.QueryImpl.newCompilation(QueryImpl.java:658)\n        at org.apache.openjpa.kernel.QueryImpl.compilationFromCache(QueryImpl.java:639)\n        at org.apache.openjpa.kernel.QueryImpl.compileForCompilation(QueryImpl.java:605)\n        ... 33 more","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12414202","id":"12414202","filename":"ddl.sql","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vorburger","name":"vorburger","key":"vorburger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vorburger&avatarId=27053","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vorburger&avatarId=27053","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vorburger&avatarId=27053","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vorburger&avatarId=27053"},"displayName":"Michael Vorburger","active":true,"timeZone":"Europe/Berlin"},"created":"2009-07-22T10:22:54.847+0000","size":278,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12414202/ddl.sql"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12423204","id":"12423204","filename":"OpenJPA-1.2.x-OJ1141_10226009.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-26T15:05:04.647+0000","size":32472,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12423204/OpenJPA-1.2.x-OJ1141_10226009.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12423461","id":"12423461","filename":"OpenJPA-1.3.x_OJ1141.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-28T15:47:03.819+0000","size":33307,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12423461/OpenJPA-1.3.x_OJ1141.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12468557","id":"12468557","filename":"openjpa-1141.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ragesteel","name":"ragesteel","key":"ragesteel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Sakovich","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-17T14:28:20.268+0000","size":8195,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12468557/openjpa-1141.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12423231","id":"12423231","filename":"OpenJPA-Trunk_OJ1141.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-26T19:15:15.258+0000","size":32617,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12423231/OpenJPA-Trunk_OJ1141.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12425147","id":"12425147","filename":"OpenJPA-Trunk_OJ1141-2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-16T21:36:37.789+0000","size":15573,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12425147/OpenJPA-Trunk_OJ1141-2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12411233","id":"12411233","filename":"TestMappingProblem.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yann","name":"yann","key":"yann","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yann","active":true,"timeZone":"Etc/UTC"},"created":"2009-06-19T15:35:56.300+0000","size":6772,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12411233/TestMappingProblem.zip"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"NPE  at org.apache.openjpa.jdbc.meta.MappingInfo.mergeJoinColumn(MappingInfo.java:1400)","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12728200","id":"12728200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"body":"The entities contain comments indicating that they were generated. Did you use the OpenJPA ReverseMappingTool, or something else (ie Dali)? \n\nIf you used the OpenJPAReverseMappingTool then would it be possible to see the table ddl that resulted in these entities? It looks like some annotations need to be added to complete the mappings. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"created":"2009-07-07T17:15:32.113+0000","updated":"2009-07-07T17:15:32.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12729286","id":"12729286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"body":"See http://n2.nabble.com/NPE-at-org.apache.openjpa.jdbc.meta.MappingInfo.mergeJoinColumn(MappingInfo.java%3A1400)-tt3120428.html#a3231887\nfor an explanation of the root cause of this error.\n\nIt also affects 2.0.0-M2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-09T14:52:15.986+0000","updated":"2009-07-09T14:53:18.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12733526","id":"12733526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"body":"There seems to be no problem with the mapping of the supplied testcase as such. The reported exception is caused while OpenJPA resolves the primary key fields of NotepadEntity. Since one of the primary key fields of NotepadEntity is the id of another entity, namely TypeEntity, the primary key fields of NotepadEntity may only be completely resolved after TypeEntity has been resolved. However, the mapping data resolution algorithm of OpenJPA doesn't take into account this type of dependency between entities.\n\nSee org.apache.openjpa.jdbc.meta.ClassMapping, methods resolveNonRelationMappings() and resolveMapping(). Inside the latter, there already seems to be a workaround for this deficiency of OpenJPAs resolution strategy. Here is says in line 838 (I'm referencing to the 2.0.0-M2 source):\n  // set resolve mode to force this field mapping to be \n  // resolved again. The need to resolve again occurs when \n  // a primary key is a relation field with the foreign key\n  // annotation. In this situation, this primary key field\n  // mapping is resolved during the call to \n  // resolveNonRelationMapping. Since it is a relation\n  // field, the foreign key will be constructed. However, \n  // the primary key of the parent entity may not have been \n  // resolved yet, resulting in missing information in the fk\n\nUnfortunately, there are situations such as in the reported test case that cause an exception before the code following the above comment runs. A more promising strategy would be to resolve the entities in the correct order taking into account the dependencies of their primary key fields. Then this workaround would not be needed at all and the reported exception would no longer happen.\n\nOf course, the code responsible for determining the correct order of entity resolution would have to deal with cycles, which may occur as the result of incorrect mappings. However, I can't think of any situation where cyclic references of primary key fields between entities would make any sense, so this case can probably reported as an error and remain unhandled.\n\nOh, btw. I would be glad to help testing any fix for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-21T07:55:36.296+0000","updated":"2009-07-21T07:55:36.296+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12734065","id":"12734065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vorburger","name":"vorburger","key":"vorburger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vorburger&avatarId=27053","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vorburger&avatarId=27053","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vorburger&avatarId=27053","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vorburger&avatarId=27053"},"displayName":"Michael Vorburger","active":true,"timeZone":"Europe/Berlin"},"body":"Michael Dick, in response to your questions (as also via IBM PMR 44438 500 624) : \n\nAttached a ddl.sql which represents the three physical tables that PortfolioEntity, NotepadEntity & TypeEntity need to map to. This is a simplified subset of a more complex existing (non changeable) real-world target DDL schema.  Note that the defect (NPE) occurs inside OpenJPA within jdbc.meta.MappingInfo BEFORE any SQL at all is actually executed - this DDL is FYI as requested, but the initially provided test case actually fails with NPE and demonstrates the problem WITHOUT any DB / DDL. See Martin Dirichs comments above.\n\nRegarding the comment in the .java that says \"This file has been automatically generated, DO NOT MODIFY!\", please ignore that - strictly speaking all those *Entity classes (not just Notepad) were generated from some kind of in-house meta description, but NOT by the OpenJPAReverseMapping tool, but by a proprietary code gen. tool. That should be irrelevant for the purposes of this discussion though, please just assume for this discussion that it was hand-written, i.e. the generator could be adapted by us if there is a solution in adding any annotations as you suggest - but which?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vorburger","name":"vorburger","key":"vorburger","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=vorburger&avatarId=27053","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=vorburger&avatarId=27053","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=vorburger&avatarId=27053","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=vorburger&avatarId=27053"},"displayName":"Michael Vorburger","active":true,"timeZone":"Europe/Berlin"},"created":"2009-07-22T10:28:52.547+0000","updated":"2009-07-22T10:28:52.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12734088","id":"12734088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"body":"Hi Michael,\n\nI haven't taken a look at this issue since I made the earlier remarks, I'll take another look this morning and get back to you. Martin's comments above are intriguing though - at first glance I thought it was an incomplete mapping issue, but now I'm not sure. \n\nThanks for the explanation of how the entities get generated, too by the way. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"created":"2009-07-22T12:14:56.062+0000","updated":"2009-07-22T12:14:56.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12734159","id":"12734159","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjreed","name":"bjreed","key":"bjreed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barrett Jay Reed","active":true,"timeZone":"Etc/UTC"},"body":"One thing I tried was playing around with the entities and persisting them before creating/running the query.\n\nLooks like persisting a TypeEntity (even one that's not used) seems to tweak the algorithm enough to get around the NullPointerException.\n\nI changed the doTest method to do the following:\n\n    public void testIt () throws Exception {\n        EntityManager em = emf.createEntityManager();\n\n        em.getTransaction().begin();\n        TypeEntity te = new TypeEntity();\n        em.persist(te);\n\n        Query query = em.createQuery(\"SELECT o from Portfolio o\");\n        query.getResultList();\n        em.getTransaction().commit();\n        em.close();\n\n    }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjreed","name":"bjreed","key":"bjreed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barrett Jay Reed","active":true,"timeZone":"Etc/UTC"},"created":"2009-07-22T15:42:09.031+0000","updated":"2009-07-22T15:42:09.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12734167","id":"12734167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"body":"Spoke with B.J. offline and he agreed to look at the issue. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"created":"2009-07-22T15:53:18.074+0000","updated":"2009-07-22T15:53:18.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12744046","id":"12744046","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjreed","name":"bjreed","key":"bjreed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barrett Jay Reed","active":true,"timeZone":"Etc/UTC"},"body":"Can someone else take a look at this?  I had only agreed originally to look at the work around and have not had much of a chance to try to actually fix the problem.  By having it assigned to me, I'm afraid that someone more capable may be kept from looking into this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjreed","name":"bjreed","key":"bjreed","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barrett Jay Reed","active":true,"timeZone":"Etc/UTC"},"created":"2009-08-17T12:51:13.780+0000","updated":"2009-08-17T12:51:13.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12768966","id":"12768966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"body":"Update based on suggestions from code review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-22T23:23:39.789+0000","updated":"2009-10-22T23:23:39.789+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12770049","id":"12770049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"body":"Updated version of the patch, dated 10 26 2009.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-26T15:05:04.703+0000","updated":"2009-10-26T15:05:04.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12770146","id":"12770146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"body":"OpenJPA-1141 patch for trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-26T19:15:15.345+0000","updated":"2009-10-26T19:15:15.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12770968","id":"12770968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"body":"Patch for OpenJPA 1.3.x","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fyrewyld","name":"fyrewyld","key":"fyrewyld","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fyrewyld&avatarId=28040","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fyrewyld&avatarId=28040","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fyrewyld&avatarId=28040","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fyrewyld&avatarId=28040"},"displayName":"Jody Grassel","active":true,"timeZone":"America/Chicago"},"created":"2009-10-28T15:47:03.872+0000","updated":"2009-10-28T15:47:03.872+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12778555","id":"12778555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"body":"I have tested patch OpenJPA-Trunk_OJ1141.patch with my application. Unfortunately, the patch doesn't seem to eliminate the problem. There seemed to be no difference at all.\n\nDigging further into this issue, I could spot in the code why the patch did not solve the problem. The patch adds a line to the bottom of MetaDataRepository.processBuffer() to reorder entities for further processing. Method processBuffer() is a bit strange at first view:\n\nprivate List<ClassMetaData> processBuffer(ClassMetaData meta, InheritanceOrderedMetaDataList buffer, int mode) {\n    // if we're already processing a metadata, just buffer this one; when\n    // the initial metadata finishes processing, we traverse the buffer\n    // and process all the others that were introduced during reentrant calls\n    if (!buffer.add(meta) || buffer.size() != 1)\n        return null;\n\n    // continually pop a metadata and process it until we run out; note\n    // that each processing call might place more metas in the buffer as\n    // one class tries to access metadata for another; also note that the\n    // buffer orders itself from least to most derived\n    ClassMetaData buffered;\n    List<ClassMetaData> processed = new ArrayList<ClassMetaData>(5);\n    while (!buffer.isEmpty()) {\n        buffered = buffer.peek();\n        buffered.resolve(mode);\n        processed.add(buffered);\n        buffer.remove(buffered);\n    }\n\n    // this line is added by the patch\n    processed = resolveFKInPKDependenciesOrdering(processed);\n\n    return processed;\n}\n\nThus, the iteration within processBuffer() is only executed if the supplied list of entity meta data solely contains one item, which is also supplied as first parameter to the method. This puzzle is solved, of course, by taking into account that the line \"buffered.resolve(mode);\" may lead to recursive calls to processBuffer(), thereby growing the list of meta data while iterating over it in the outermost call.\n\nNote that the patch only adds a line behind the while loop. However, exceptions similar to the one reported in this JIRA issue occur within the while loop, during the recursion. The patch may happen to eliminate the meta data resolution problem for the supplied test setup, it does not work for the general case.\n\nThe root problem lies in the usage of an InheritanceOrderedMetaDataList as buffer. This kind of list makes sure that new meta data entries put into the list are always inserted behind any meta data entries of super classes. This is fine, but it is not enough. If entities use other entities for their primary key fields, this is a dependency not taken into account by the InheritanceOrderedMetaDataList. Instead, entities not inheriting from each other are simply ordered alphabetically when inserted into the list.\n\nThis is the real flaw of using the InheritanceOrderedMetaDataList in this context. Since resolving the meta data of an entity is only guaranteed to work if both super classes and entites referred to in the primary key fields are already resolved beforehand, the usage of InheritanceOrderedMetaDataList is error prone.\n\nThere exists another approach to remove this kind of meta data resolution problems: Use a simple ArrayList instead of InheritanceOrderedMetaDataList. In the process of resolving the meta data for an entity, the current code already takes into account all possible dependencies between entities. In short, ClassMetaData.resolveMeta() works as follows:\n  - resolve super class of current entity, if applicable\n  - resolve primary key field entities of current entity, if applicable\nBoth of these actions lead to calls to MetaDataRepository.processBuffer() with the respective entity meta data before processBuffer() is finally called for the current entity. Thus, all entities the current entity is dependent on are put into the buffer before the current entity. A simple array list thus is sufficient to let all entities be processed in the correct order.\n\nI've attached a corresponding patch called OpenJPA-Trunk_OJ1141-2.patch which implements these considerations. Although this patch removes the special logic within MetaDataRepository introduced by the original patch, the test cases of the original patch continue to work flawlessly as does the test suite attached to this JIRA issue. What is more, this fix is also able to cope with the mapping of my application, which happens to have many instances of foreign key references in primary keys as well as sub/superclass dependencies.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichs","name":"dirichs","key":"dirichs","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Dirichs","active":true,"timeZone":"Etc/UTC"},"created":"2009-11-16T21:36:37.848+0000","updated":"2009-11-16T21:36:37.848+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12428375/comment/12982649","id":"12982649","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ragesteel","name":"ragesteel","key":"ragesteel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Sakovich","active":true,"timeZone":"Etc/UTC"},"body":"I'm encountered simular NullPointerException at org.apache.openjpa.jdbc.meta.MappingInfo.mergeJoinColumn(MappingInfo.java:1415), when trying to use Entities as part of Primary Key in 1.2.2. There is no such problem in 2.0.0 and 2.0.1.\nI've prepare minimal set of Entities that reproduces this error.\nIf I remove @JoinColumns from LineItem.order or remove Item.items  problem goes away. If I rename Product to Customer (with corresponding changes in other classes)  problem goes away too.\n\n<openjpa-1.2.2-r422266:898935 nonfatal general error> org.apache.openjpa.persistence.PersistenceException: null\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.newBroker(AbstractBrokerFactory.java:196)\n\tat org.apache.openjpa.kernel.DelegatingBrokerFactory.newBroker(DelegatingBrokerFactory.java:142)\n\tat org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:192)\n\tat org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:145)\n\tat org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:56)\n\tat org.apache.openjpa.test.TestMapping.testMapping(TestMapping.java:11)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.junit.runners.featureSelection.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.featureSelection.ReflectiveCallable.run(ReflectiveCallable.java:15)\n\tat org.junit.runners.featureSelection.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n\tat org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:59)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:115)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.Surefire.run(Surefire.java:180)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:350)\n\tat org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1021)\nCaused by: java.lang.NullPointerException\n\tat org.apache.openjpa.jdbc.meta.MappingInfo.mergeJoinColumn(MappingInfo.java:1415)\n\tat org.apache.openjpa.jdbc.meta.MappingInfo.createJoins(MappingInfo.java:1206)\n\tat org.apache.openjpa.jdbc.meta.MappingInfo.createForeignKey(MappingInfo.java:968)\n\tat org.apache.openjpa.jdbc.meta.ValueMappingInfo.getTypeJoin(ValueMappingInfo.java:104)\n\tat org.apache.openjpa.jdbc.meta.strats.RelationFieldStrategy.map(RelationFieldStrategy.java:157)\n\tat org.apache.openjpa.jdbc.meta.FieldMapping.setStrategy(FieldMapping.java:121)\n\tat org.apache.openjpa.jdbc.meta.RuntimeStrategyInstaller.installStrategy(RuntimeStrategyInstaller.java:80)\n\tat org.apache.openjpa.jdbc.meta.FieldMapping.resolveMapping(FieldMapping.java:454)\n\tat org.apache.openjpa.jdbc.meta.FieldMapping.resolve(FieldMapping.java:419)\n\tat org.apache.openjpa.jdbc.meta.ClassMapping.resolveNonRelationMappings(ClassMapping.java:871)\n\tat org.apache.openjpa.jdbc.meta.MappingRepository.prepareMapping(MappingRepository.java:418)\n\tat org.apache.openjpa.meta.MetaDataRepository.preMapping(MetaDataRepository.java:757)\n\tat org.apache.openjpa.meta.MetaDataRepository.resolve(MetaDataRepository.java:644)\n\tat org.apache.openjpa.meta.MetaDataRepository.getMetaDataInternal(MetaDataRepository.java:393)\n\tat org.apache.openjpa.meta.MetaDataRepository.getMetaDataLocking(MetaDataRepository.java:366)\n\tat org.apache.openjpa.meta.MetaDataRepository.getMetaData(MetaDataRepository.java:360)\n\tat org.apache.openjpa.enhance.PCEnhancer.<init>(PCEnhancer.java:253)\n\tat org.apache.openjpa.enhance.PCEnhancer.<init>(PCEnhancer.java:224)\n\tat org.apache.openjpa.enhance.PCEnhancer.<init>(PCEnhancer.java:192)\n\tat org.apache.openjpa.enhance.ManagedClassSubclasser.prepareUnenhancedClasses(ManagedClassSubclasser.java:121)\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.loadPersistentTypes(AbstractBrokerFactory.java:310)\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.initializeBroker(AbstractBrokerFactory.java:228)\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.newBroker(AbstractBrokerFactory.java:190)\n\t... 32 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ragesteel","name":"ragesteel","key":"ragesteel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Igor Sakovich","active":true,"timeZone":"Etc/UTC"},"created":"2011-01-17T14:28:20.328+0000","updated":"2011-01-17T14:28:20.328+0000"}],"maxResults":14,"total":14,"startAt":0},"customfield_12311820":"0|i0zbpr:","customfield_12314139":null}}

