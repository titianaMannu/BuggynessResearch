{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12439523","self":"https://issues.apache.org/jira/rest/api/2/issue/12439523","key":"OPENJPA-1367","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313326","id":"12313326","description":"","name":"1.3.0","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314802","id":"12314802","description":"2.0.0 Beta 2","name":"2.0.0-beta2","archived":false,"released":true,"releaseDate":"2010-02-27"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161636","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313328","id":"12313328","description":"","name":"1.2.1","archived":false,"released":true,"releaseDate":"2009-03-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313624","id":"12313624","description":"OpenJPA 2.0.0 Milestone 1","name":"2.0.0-M1","archived":false,"released":true,"releaseDate":"2009-01-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313483","id":"12313483","description":"Early Access 2","name":"2.0.0-M2","archived":false,"released":true,"releaseDate":"2009-06-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314148","id":"12314148","description":"Early Access 3","name":"2.0.0-M3","archived":false,"released":true,"releaseDate":"2009-10-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314149","id":"12314149","description":"2.0.0 Beta","name":"2.0.0-beta","archived":false,"released":true,"releaseDate":"2010-01-28"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311306","id":"12311306","name":"docs","description":"Issues related to the OpenJPA documentation. This refers to static documentation, not to error messages and the like, which should be in the diagnostics component."},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311310","id":"12311310","name":"sql","description":"Issues to do with SQL, including generation of SQL. Issues that have to do with JDBC (i.e., execution of SQL statements and result set processing) should be filed in the jdbc component."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"247693","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomasm","name":"thomasm","key":"tmueller","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Mueller","active":true,"timeZone":"Europe/Zurich"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomasm","name":"thomasm","key":"tmueller","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Mueller","active":true,"timeZone":"Europe/Zurich"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1367/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6644cc20[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7b7d104b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7f2d07a0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6cc1af46[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@20486e05[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@58b5aef8[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f32b249[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@2e688f76[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4d33f4f8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@380451c8[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@62fe1c7b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@8872c6d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2010-02-08T19:30:17.216+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1367/watchers","watchCount":0,"isWatching":false},"created":"2009-10-30T13:00:06.540+0000","updated":"2010-03-09T18:31:23.896+0000","timeoriginalestimate":null,"description":"The documentation says that the H2 database does not support cross joins:\n\nhttp://openjpa.apache.org/builds/1.2.1/apache-openjpa-1.2.1/docs/manual/dbsupport_h2.html\nhttp://openjpa.apache.org/builds/2.0.0-M3/apache-openjpa-2.0.0-M3/docs/manual/main.html\n\nH2 does support cross join since a long time (I don't remember what version). See: http://www.h2database.com/html/grammar.html#table_expression (CROSS). A condition is not required for cross join.\n\nI think the documentation should be changed, and probably the H2Dictionary should be changed as well (crossJoinClause = \"CROSS JOIN\"; requiresConditionForCrossJoin = false;).\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12431097","id":"12431097","filename":"OPENJPA-1367.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-01-22T05:22:43.883+0000","size":4044,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12431097/OPENJPA-1367.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12431098","id":"12431098","filename":"openjpa-h2-test-results.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-01-22T05:22:43.921+0000","size":7766,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12431098/openjpa-h2-test-results.txt"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"H2 Database Engine does support cross join","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439523/comment/12803610","id":"12803610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"body":"I've run the test cases using H2 Database-1.2.127 with current trunk revision: r901901 Please refer to the attached test-results.txt file for more details. \n\nDescriptions for the changes in attached patch:\n1. H2Dictionary changes:\n    a)  as per this issue comment: crossJoinClause = \"CROSS JOIN\"; requiresConditionForCrossJoin = false;\n    b) Return Types.BOOLEAN for Types.BIT in getPreferredType(type) because of warning message shown while running MappingTool. The message looked like this:\n        4396  workflow-entities  WARN   [main] openjpa.jdbc.Schema - Existing column \"ACTIVE\" on table         \"OPENJPA.WORKFLOW_TASK_GROUP\" is incompatible with the same column in the given schema definition. Existing column:\n         Full Name: WORKFLOW_TASK_GROUP.ACTIVE\n        Type: unknown(16)\n         Size: 1\n         Default: null\n         Not Null: false\n         Given column:\n         Full Name: workflow_task_group.active\n         Type: bit\n         Size: 0\n         Default: null\n         Not Null: false\n\n   c) H2 requires limit to be present for using offset. http://www.h2database.com/html/grammar.html#select\n\n2. Changes to sql-error-state-codes.xml :   added missing error-codes (caused some test failures!)\n3. TestMultipleSchemaNames.java :   Similar to Postgres, H2 requires schema to be created as as it does not create them automatically.\n\n4. And in the documentation: I've changed the comment 'H2 does not support cross joins' to 'None' \n    But as the following test cases fail,  may be it should be explained here. I'll leave it to someone with more knowledge about these failures.\n   a) module openjpa-peristence-jdbc -> All the tests completed successfully, except for the error in following test:\n          org.apache.openjpa.persistence.sequence.TestSequence   => error in: testMultiThreadedNativeSequences\n   b) module openjpa-peristence-locking  Tests run: 185, Failures: 43, Errors: 0, Skipped: 0\n\nHope this patch can be integrated into OpenJpa-2.0!\n\nThanks,\nPrashant","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-01-22T05:22:43.926+0000","updated":"2010-01-22T05:22:43.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439523/comment/12804096","id":"12804096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"body":"Hi, Prashant,\n\nThank you very much for your patch! I will look into it.\n\nBriefly looking, I have a question on the LIMIT clause. Do you know whether \"LIMIT 0\" means \"return all rows\" or \"return no rows\"? If \"return no rows\", we would need to issue \"LIMIT big_constant\" instead.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-23T15:32:20.767+0000","updated":"2010-01-23T15:32:20.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439523/comment/12804122","id":"12804122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"body":"Actually I tried it with H2, it returns 'all rows' for 'limit 0'.  and Long.MAX_VALUE should also work. So, either of them should be fine.\n\nThanks,\nPrashant","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-01-23T18:32:07.422+0000","updated":"2010-01-23T18:32:07.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439523/comment/12806810","id":"12806810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"body":"Prashant, I have applied your patch into 2.0.x branch, with slight modifications:\n- Removed a few variable assignments in H2Dictionary since DBDictionary already assigns the same values to them.\n- Modified a bit SQL error codes file. A caveat here is the difference between SQL state and SQL error code. It is handled by DBDictionary.matchErrorState method which uses SQL states to determine exception type unless the method is overriden. I found some H2 source file [1] helpful here.\n\nAs for org.apache.openjpa.persistence.sequence.TestSequence, it is failing because of a deadlock in INSERT statement. I believe this is because H2 uses table level locking and this test executes a lot of parallel inserts into two tables. I also ran the test with MVCC option turned on in H2 which is supposed to use row level locking but I ended up with OutOfMemoryError (although I only tried in-memory database). Anyway having only one test failing in openjpa-persistence-jdbc module is a very good result.\n\nUnfortunately I am currently not familiar with internals of openjpa-peristence-locking tests and do not have enough time to dig into them now. As you have noted in your attachment, the results are better with MVCC option turned on. I can only guess that the tests fail mainly due to different locking semantics in H2 than the tests assume.\n\nI am going to apply the patch also to the 1.3.x branch and then mark the issue resolved. If you would like to continue work on the mentioned failing tests, please open a new issue.\n\n\nThomas, thank you for pointing the CROSS JOIN issue. The patch applied contains the fix.\n\n\n[1] http://kickjava.com/src/org/h2/message/Message.java.htm\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"created":"2010-01-31T11:47:27.978+0000","updated":"2010-01-31T11:47:27.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439523/comment/12829442","id":"12829442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"body":"Milosz Tylenda, thanks for reviewing and applying the patch.\n\nI've noticed an exception 'Connection not closed' being shown in database log (*.trace.db) for almost every test although the test passes! \ntrace.db file grows upto 9.5mb after running full persistence-jdbc tests. Is it because the entity manager is not closed at the end of each test? Or is some other configuration missing for h2?\nfor ex.: mvn -Ptest-h2 -Dtest=TestException test\n\nthrows the following exception:\n[code]\n02-04 12:08:42 jdbc[13]: Connection not closed\njava.lang.Exception: Stack Trace\n\tat org.h2.jdbc.JdbcConnection.<init>(JdbcConnection.java:121)\n\tat org.h2.jdbc.JdbcConnection.<init>(JdbcConnection.java:94)\n\tat org.h2.Driver.connect(Driver.java:58)\n\tat org.apache.commons.dbcp.DriverConnectionFactory.createConnection(DriverConnectionFactory.java:38)\n\tat org.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java:294)\n\tat org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1148)\n\tat org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:96)\n\tat org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:880)\n\tat org.apache.openjpa.lib.jdbc.DelegatingDataSource.getConnection(DelegatingDataSource.java:131)\n\tat org.apache.openjpa.lib.jdbc.DecoratingDataSource.getConnection(DecoratingDataSource.java:106)\n\tat org.apache.openjpa.jdbc.sql.DBDictionaryFactory.newDBDictionary(DBDictionaryFactory.java:91)\n\tat org.apache.openjpa.jdbc.conf.JDBCConfigurationImpl.getDBDictionaryInstance(JDBCConfigurationImpl.java:595)\n\tat org.apache.openjpa.jdbc.meta.MappingRepository.endConfiguration(MappingRepository.java:1489)\n\tat org.apache.openjpa.lib.conf.Configurations.configureInstance(Configurations.java:507)\n\tat org.apache.openjpa.lib.conf.Configurations.configureInstance(Configurations.java:432)\n\tat org.apache.openjpa.lib.conf.PluginValue.instantiate(PluginValue.java:104)\n\tat org.apache.openjpa.conf.MetaDataRepositoryValue.instantiate(MetaDataRepositoryValue.java:68)\n\tat org.apache.openjpa.lib.conf.ObjectValue.instantiate(ObjectValue.java:83)\n\tat org.apache.openjpa.conf.OpenJPAConfigurationImpl.newMetaDataRepositoryInstance(OpenJPAConfigurationImpl.java:920)\n\tat org.apache.openjpa.conf.OpenJPAConfigurationImpl.getMetaDataRepositoryInstance(OpenJPAConfigurationImpl.java:911)\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.makeReadOnly(AbstractBrokerFactory.java:619)\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.newBroker(AbstractBrokerFactory.java:188)\n\tat org.apache.openjpa.kernel.DelegatingBrokerFactory.newBroker(DelegatingBrokerFactory.java:152)\n\tat org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:200)\n\tat org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:151)\n\tat org.apache.openjpa.persistence.exception.TestException.testIllegalArgumennExceptionOnInvalidNamedQuery(TestException.java:188)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat junit.framework.TestCase.runTest(TestCase.java:154)\n\tat org.apache.openjpa.persistence.test.AbstractPersistenceTestCase.runTest(AbstractPersistenceTestCase.java:514)\n\tat junit.framework.TestCase.runBare(TestCase.java:127)\n\tat org.apache.openjpa.persistence.test.AbstractPersistenceTestCase.runBare(AbstractPersistenceTestCase.java:501)\n\tat org.apache.openjpa.persistence.test.AbstractPersistenceTestCase.runBare(AbstractPersistenceTestCase.java:477)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat org.apache.openjpa.persistence.test.AbstractPersistenceTestCase.run(AbstractPersistenceTestCase.java:177)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127)\n\tat org.apache.maven.surefire.Surefire.run(Surefire.java:177)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:345)\n\tat org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1009)\n[/code]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prashantbhat","name":"prashantbhat","key":"prashantbhat","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prashant Bhat","active":true,"timeZone":"Asia/Shanghai"},"created":"2010-02-04T04:45:29.506+0000","updated":"2010-02-04T04:45:49.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12439523/comment/12830202","id":"12830202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"body":"Prashant, most likely some (or even most of) connections are still open at the end of test but not because of not closing EntityManagers. The cause is rather a connection pool (Apache DPCP) being used by the test suite. I haven't seen the exceptions you mention, maybe because I did not enable trace log in H2.\n\nLooking at your stack trace, I would say you use H2 in kind of one-connection-only mode. Is this the case? I am not very familiar with H2.\n\nI don't have answer for your question on H2 configuration. I would try tweaking DBCP connection properties and H2 settings. If you have an IDE with OpenJPA source, you can also try running some test from there, without DBCP. Below I am including my settings for your reference:\n\n        <profile>\n            <id>test-h2-milosz</id>\n            <properties>\n                <test-custom>true</test-custom>\n                <openjpa.custom.driverjar>/alt/jdbc/h2-1.1.118.jar</openjpa.custom.driverjar>\n                <openjpa.custom.driverclass>org.h2.Driver</openjpa.custom.driverclass>\n                <openjpa.custom.url>jdbc:h2:mem:oj;DB_CLOSE_DELAY=-1</openjpa.custom.url>\n                <openjpa.custom.username>sa</openjpa.custom.username>\n                <openjpa.custom.password></openjpa.custom.password>\n                <dbcp.args>\n                     MaxActive=100,MaxIdle=10,MaxWait=10000,timeBetweenEvictionRunsMillis=2000,minEvictableIdleTimeMillis=1000\n                </dbcp.args>\n            </properties>\n        </profile>\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-05T18:05:21.551+0000","updated":"2010-02-05T18:05:21.551+0000"}],"maxResults":6,"total":6,"startAt":0},"customfield_12311820":"0|i16s5j:","customfield_12314139":null}}

