{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12457359","self":"https://issues.apache.org/jira/rest/api/2/issue/12457359","key":"OPENJPA-1536","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314857","id":"12314857","description":"2.0.0 Beta 3","name":"2.0.0-beta3","archived":false,"released":true,"releaseDate":"2010-03-29"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161799","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314149","id":"12314149","description":"2.0.0 Beta","name":"2.0.0-beta","archived":false,"released":true,"releaseDate":"2010-01-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314802","id":"12314802","description":"2.0.0 Beta 2","name":"2.0.0-beta2","archived":false,"released":true,"releaseDate":"2010-02-27"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311310","id":"12311310","name":"sql","description":"Issues to do with SQL, including generation of SQL. Issues that have to do with JDBC (i.e., execution of SQL statements and result set processing) should be filed in the jdbc component."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"202816","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1536/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7d7bd3d9[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4d960169[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@24a146bb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@59c1860f[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2c02812d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@169ba738[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@38a1bfce[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@6d05b72b[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5536584f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1edf97b6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2bb5046c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@6b4952de[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2010-02-25T05:08:20.044+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1536/watchers","watchCount":0,"isWatching":false},"created":"2010-02-24T22:55:52.908+0000","updated":"2010-03-23T18:33:58.830+0000","timeoriginalestimate":null,"description":"Have the following entities:\n\n@Entity\n@Table(name=\"CEmployee\")\n@Inheritance(strategy=InheritanceType.JOINED)\n@DiscriminatorColumn(name=\"EMP_TYPEL\", discriminatorType=DiscriminatorType.INTEGER)\npublic class Employee {\n    @Id\n    private int id;\n    \n    private String lastName;\n    private String firstName;\n\n    private int vacationDays;\n    \n    @ManyToOne\n    private Manager manager;\n    \n    @ManyToOne\n    private Department department;\n    \n    @OneToOne(cascade=CascadeType.ALL)\n    private CommentBlock commentBlock;\n    \n    @Version\n    private long version;\n...\n\n}\n\n@Entity\n@Table(name=\"CDepartment\")\npublic class Department {\n    @Id\n    private int id;\n    \n    private String departmentName;\n    \n    @ManyToOne\n    private Manager departmentManager;\n    \n    @OneToMany(mappedBy=\"department\")\n    private List<Employee> employeeList;\n...\n}\n\n@Entity\n@DiscriminatorValue(\"2\")\npublic class FTEmployee extends Employee {\n    private double salary;\n...\n\n@Entity\n@DiscriminatorValue(\"3\")\npublic class Manager extends FTEmployee {\n    @OneToMany(mappedBy=\"manager\")\n    private List<Employee> managesList;\n...\n}\n\nIn the test, three departments, and 11 employees are created - 3 employees are managers, each which own a department.  Two of the managers have Manager(id=1) as their manager.\nManager(id=1) is the CEO so it has no manager (this value is set null.)  \n\nThe problem is that a simple find for Employee(id=1) (which should return Manager(id=1)) returns null, the criteria of the SELECT fails to locate the correct row.  The SQL generated by the find is as follows:\n\nSELECT t2.EMP_TYPEL, t2.version, t3.id, t3.version, t3.lastUpdate, t4.id, t7.id, \nt7.EMP_TYPEL, t7.version, t7.COMMENTBLOCK_ID, t7.DEPARTMENT_ID, t7.firstName, \nt7.lastName, t7.vacationDays, t6.salary, t4.departmentName, t2.firstName, \nt2.lastName, t10.id, t10.EMP_TYPEL, t10.version, t10.COMMENTBLOCK_ID, \nt10.DEPARTMENT_ID, t10.firstName, t10.lastName, t10.vacationDays, t9.salary, \nt2.vacationDays, t1.salary \nFROM Manager t0 \nINNER JOIN FTEmployee t1 ON t0.id = t1.id \nINNER JOIN CEmployee t2 ON t1.id = t2.id \nLEFT OUTER JOIN CCommentBlock t3 ON t2.COMMENTBLOCK_ID = t3.id \nLEFT OUTER JOIN CDepartment t4 ON t2.DEPARTMENT_ID = t4.id \nLEFT OUTER JOIN Manager t8 ON t2.MANAGER_ID = t8.id \nLEFT OUTER JOIN Manager t5 ON t4.DEPARTMENTMANAGER_ID = t5.id \nLEFT OUTER JOIN FTEmployee t9 ON t8.id = t9.id \nLEFT OUTER JOIN FTEmployee t6 ON t5.id = t6.id \nLEFT OUTER JOIN CEmployee t10 ON t9.id = t10.id \nLEFT OUTER JOIN CEmployee t7 ON t6.id = t7.id \nWHERE t2.EMP_TYPEL = ? AND \n      t7.EMP_TYPEL = ? AND \n      t10.EMP_TYPEL = ? AND \n      t0.id = ?  optimize for 1 row [params=(int) 3, (int) 3, (int) 3, (int) 1]\n\nThis 0-result sql is caused by the retrieval of the eager toOne field, Manager. \nNote that the LEFT OUTER JOIN betweent t2 and t8 is to retrieve the Manager.\nLEFT OUTER JOIN already takes care of possible null manager case. However, \nthe where clause did not consider the possible null manager case. \nThe correct clause should be: \n\nWHERE t2.EMP_TYPEL = ? AND \n      (t7.EMP_TYPEL = ? OR t7.EMP_TYPEL IS NULL) AND \n     (t10.EMP_TYPEL = ? OR t10.EMP_TYPEL IS NULL) AND \n      t0.id = ?  optimize for 1 row [params=(int) 3, (int) 3, (int) 3, (int) 1]\n\n \n\n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12436918","id":"12436918","filename":"OPENJPA-1536.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-24T22:58:25.460+0000","size":904,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12436918/OPENJPA-1536.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042","disabled":false}],"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"SQL with outer join cannot handle null columns when inheritance is involved","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12457359/comment/12838079","id":"12838079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Fay,\nI have reviewed your patch, and it looks good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2010-02-24T23:20:33.883+0000","updated":"2010-02-24T23:20:33.883+0000"}],"maxResults":1,"total":1,"startAt":0},"customfield_12311820":"0|i0z367:","customfield_12314139":null}}

