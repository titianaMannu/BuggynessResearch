{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12469301","self":"https://issues.apache.org/jira/rest/api/2/issue/12469301","key":"OPENJPA-1726","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314542","id":"12314542","description":"","name":"2.1.0","archived":false,"released":true,"releaseDate":"2011-02-21"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161973","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314542","id":"12314542","description":"","name":"2.1.0","archived":false,"released":true,"releaseDate":"2011-02-21"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12338759","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12338759","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12468078","key":"OPENJPA-1710","self":"https://issues.apache.org/jira/rest/api/2/issue/12468078","fields":{"summary":"OpenJPA generates ABSTIME for a TIMESTAMP field for Postgres 8.4","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12338747","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12338747","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12505188","key":"OPENJPA-1985","self":"https://issues.apache.org/jira/rest/api/2/issue/12505188","fields":{"summary":"ClassCastException in max(Timestamp) function on PostgreSQL","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"288896","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1726/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6bce02c[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2f286414[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f2d5e0c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@63c98339[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@66285f11[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3cf5fa4[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@66f7bcef[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@49083b43[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6d7c25a4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@143765d0[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f7cb37d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@47264bf2[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2010-07-27T16:31:44.596+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1726/watchers","watchCount":0,"isWatching":false},"created":"2010-07-14T22:46:28.784+0000","updated":"2011-04-27T17:33:38.852+0000","timeoriginalestimate":null,"description":null,"customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12449598","id":"12449598","filename":"OPENJPA-1726.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-15T22:15:35.943+0000","size":1642,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12449598/OPENJPA-1726.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12449605","id":"12449605","filename":"OPENJPA-1726-2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-16T00:16:07.797+0000","size":3301,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12449605/OPENJPA-1726-2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12450770","id":"12450770","filename":"TestMixedLockManagerFindPermutation_trace.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-28T23:26:49.331+0000","size":3798,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12450770/TestMixedLockManagerFindPermutation_trace.zip"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Clean up OpenJPA test case failures for PostgreSQL","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469301/comment/12888940","id":"12888940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"body":"TestIdClassCompanyModel.testBasicQueries fails with the following exception:\n\nCaused by: org.apache.openjpa.lib.jdbc.ReportingSQLException: ERROR: function pg_catalog.substring(character varying, bigint) does not exist\nHint: No function matches the given name and argument types. You might need to add explicit type casts.\nPosition: 658 {prepstmnt 795758045 SELECT t0.id, t0.DTYPE, t0.firstName, t2.id, t2.city, t2.phoneNumber, t2.postalCode, t2.state, t2.streetAddress, t0.lastName, t1.id, t3.id, t3.city, t3.phoneNumber, t3.postalCode, t3.state, t3.streetAddress, t1.name, t0.hireDate, t4.id, t4.DTYPE, t4.firstName, t4.HOMEADDRESS_ID, t4.lastName, t4.COMPANY_ID, t4.hireDate, t4.title, t4.salary, t0.title, t0.salary, t0.wage, t0.weeklyHours FROM IDC_Person t0 INNER JOIN IDC_Company t1 ON t0.COMPANY_ID = t1.id LEFT OUTER JOIN IDC_Address t2 ON t0.HOMEADDRESS_ID = t2.id LEFT OUTER JOIN IDC_Person t4 ON t0.MANAGER_ID = t4.id LEFT OUTER JOIN IDC_Address t3 ON t1.ADDRESS_ID = t3.id WHERE (((POSITION(t1.name IN SUBSTRING(?, ((? - ?) + 1))) - 1 + (? - ?)) + ?) > ?) AND t0.DTYPE IN (?, ?, ?) AND (t4.DTYPE IS NULL OR t4.DTYPE IN (?)) [params=?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?]} [code=0, state=42883]\nFailedObject: select x from IDC_Employee x where locate(x.company.name, 'x', 1) > 0 [java.lang.String]\n\nIn the push-down sql:\n(((POSITION(t0.firstName IN SUBSTRING(?, ((? - ?) + 1))) - 1 + (? - ?)) + ?) > ?)\n\nOpenJPA set the parameters as follows:\n\n        pstmt.setString(1, \"x\");\n        pstmt.setLong(2, 1);\n        pstmt.setInt(3, 1);\n        pstmt.setLong(4, 1);\n        pstmt.setInt(5, 1);\n        pstmt.setInt(6, 1);\n        pstmt.setLong(7, 0);\n\nThe second parameter is set to type Long, which causes the error that the function pg_catalog.substring(character varying, bigint) does not exist. It turns out the for Postgres, the start index in the locate function must be int:\n\nhttp://www.postgresql.org/docs/8.1/static/functions-string.html\nsubstring(string [from int] [for int])\n\nThe fix is to modify JPQLExpressionBuilder to create a Lit of Integer value for the locateFromIndex.\n\nAlthough this fix affects all database, it is reasonable to assume that the start index in the locate function is in the integer range.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-15T22:15:36.001+0000","updated":"2010-07-15T22:15:36.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469301/comment/12888968","id":"12888968","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"body":"TestTypeSafeCondExpression.testTrimFunc1 and testTrimFunc2 fail in Postgres when the criteria API is used:\n\nCaused by: org.apache.openjpa.lib.jdbc.ReportingSQLException: ERROR: function pg_catalog.btrim(character varying, integer) does not exist\nHint: No function matches the given name and argument types. You might need to add explicit type casts.\nPosition: 8 {prepstmnt 598291031 SELECT TRIM(BOTH ? FROM t0.compName) FROM CompUser t0 WHERE (t0.name = ?) [params=?, ?]} [code=0, state=42883]\n\nIn these test cases, OpenJPA criteria API sets the trim character as the Character type, resulting in the call of PreparedStatement.setInt for the trim character (via DBDictionary.setChar). Postgres therefore throws error that function pg_catalog.btrim(character varying, integer) does not exist. The patch OPENJPA-1726-2.patch modifies the trim character  to String type to fix this problem.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-16T00:16:07.855+0000","updated":"2010-07-16T00:16:07.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469301/comment/12890082","id":"12890082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"body":"The following four OpenJPA test cases fail with the same error:\n\nTestGeneratedValues.testDefaultValues\nTestGeneratedValues.testCustomSequenceGeneratorWithIndirection\nTestGeneratedValues.testUUIDGenerators\nTestNonstandardMappingAnnotations.testInsertAndRetrieve\n\nCaused by: <openjpa-2.1.0-SNAPSHOT-rexported fatal general error> org.apache.openjpa.persistence.PersistenceException: ERROR: invalid byte sequence for encoding \"UTF8\": 0x00. Hint: This error can also happen if the byte sequence does not match the encoding expected by the server, which is controlled by \"client_encoding\".\n\nThis error is caused by the two auto-generated uuid values (uuidstring and uuidT4string) In the entity, org.apache.openjpa.persistence.generationtype.GeneratedValues:  \n\n    @GeneratedValue(generator=\"uuid-string\")\n    private String uuidstring;\n\n    @GeneratedValue(generator=\"uuid-type4-string\")\n    private String uuidT4string;\n\nThese two fields are populated in a way that org.apache.openjpa.lib.util.UUIDGenerator first randomly generates byte[] and then converts it to a String using charset \"ISO-8859-1\". The resulting string may contain 0x00, causing invalid byte sequence for encoding \"UTF8\": 0x00. The failures are not deterministic as the UUID values are randomly generated. One way to fix this problem is to exclude Postgres from running these four test cases. Any comments are welcome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-19T22:58:23.323+0000","updated":"2010-07-19T22:58:23.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469301/comment/12890272","id":"12890272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"I ran into some issues with uuid-string and uuid-type4-string a while back.  This problem isn't specific to PostgreSQL, but looks to be even more prevalent on that platform since it stores data in UTF-8.  UTF-8 is particularly picky about character values.  To be honest, I wouldn't ever recommend the use of uuid-string or uuid-type4-string since they generate integral byte values and plug them in as character data without taking into account the character encoding of either the client or database column.  Depending on the conversion, the id may get converted to some other value or fail to convert (like we are witnessing on PostgreSQL).  A better choice would have been to convert the values to ASCII base-10 numeric characters.  This is not something we can change now though, since there may be existing applications happily running with the current generation strategy.  The use of uuid-hex or uuid-type4-hex is a much better choice since the key value includes only invariant characters.\n\nSince this could fail intermittently on any platform a better choice might be to either discontinue testing uuid-string or uuid-type4-string (while continuing to test uuid-hex and uuid-type4-hex) or test the -string variants separately, excluding PostgreSQL.  I'm OK with either, or simply excluding the test from running on PostgreSQL as you suggested.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2010-07-20T14:47:01.983+0000","updated":"2010-07-20T14:47:01.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469301/comment/12893421","id":"12893421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"body":"\tThe failing test cases running on Postgres are now in TestMixedLockManagerFindPermutation. This test case spawns three threads and the pass/no pass of the test cases depends on the timing.  \n\n\tOne example is TestMixedLockManagerFindPermutation.testFindReadPessimisticRead when the second child thread is doing rollback: \n        commonFindTest(\n            \"testFind(Read,Commit/PessimisticRead,Rollback)\",\n            LockModeType.READ, Act.CommitTx, 1, null,\n            LockModeType.PESSIMISTIC_READ, Act.RollbackTx, 1, null);\n\n\tIn the failing trace file, you can easily see that the find by the second child [Thread-8] is before the jdbc commit of the update statement by the first child [Thread-7], even though the commit action is issued by Thread-7 before the find by Thread-8.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-28T23:23:22.787+0000","updated":"2010-07-28T23:23:22.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469301/comment/12893423","id":"12893423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"body":"The zip file contains trace log for success run and failing run to illustrate the timing issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=faywang","name":"faywang","key":"faywang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fay Wang","active":true,"timeZone":"Etc/UTC"},"created":"2010-07-28T23:26:49.408+0000","updated":"2010-07-28T23:26:49.408+0000"}],"maxResults":6,"total":6,"startAt":0},"customfield_12311820":"0|i1dtmf:","customfield_12314139":null}}

