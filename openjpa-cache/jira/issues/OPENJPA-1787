{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12473823","self":"https://issues.apache.org/jira/rest/api/2/issue/12473823","key":"OPENJPA-1787","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316191","id":"12316191","description":"OpenJPA 2.1.x maintenance release","name":"2.1.1","archived":false,"released":true,"releaseDate":"2011-07-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315910","id":"12315910","description":"OpenJPA 2.2.0 Release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2012-02-20"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"162029","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314532","id":"12314532","description":"2.0.1 Release","name":"2.0.1","archived":false,"released":true,"releaseDate":"2010-08-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314542","id":"12314542","description":"","name":"2.1.0","archived":false,"released":true,"releaseDate":"2011-02-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315910","id":"12315910","description":"OpenJPA 2.2.0 Release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2012-02-20"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311304","id":"12311304","name":"jpa","description":"Java Persistence API interface"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311302","id":"12311302","name":"kernel","description":"Kernel"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"56264","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1787/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4013f9f9[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@555fde97[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@379b2bbe[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1c1be0bc[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@519826fa[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@7ff58c5f[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@11dd8ec4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@52009243[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@42bfd10f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@117b2a73[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6c2d3d36[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@3a69287a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2011-03-16T18:52:14.911+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-1787/watchers","watchCount":1,"isWatching":false},"created":"2010-09-10T16:23:51.050+0000","updated":"2012-10-15T18:24:45.637+0000","timeoriginalestimate":null,"description":"The bean validation is not working correctly\n\nIf you try to merge a new entity.\n\n        EntityManager em = entityManagerFactory.createEntityManager();\n        Person person = new Person();\n        person.setName(\"Oliver\");                               // Employee.name is annotated @NotNull \n        person = em.merge(person);                            \n\nyou get a ConstraintValidationException, although name is set. \n\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454528","id":"12454528","filename":"com.example.TestEmployeeDAO.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-14T08:15:35.956+0000","size":4822,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454528/com.example.TestEmployeeDAO.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12473363","id":"12473363","filename":"OPENJPA-1787_2.1.x.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-11T03:53:59.454+0000","size":3036,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12473363/OPENJPA-1787_2.1.x.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12473408","id":"12473408","filename":"OPENJPA-1787_jUnits_2.1.x.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-11T17:29:28.312+0000","size":9822,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12473408/OPENJPA-1787_jUnits_2.1.x.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454309","id":"12454309","filename":"openjpa-1787.tar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-10T16:28:05.692+0000","size":7416,"mimeType":"application/x-tar","content":"https://issues.apache.org/jira/secure/attachment/12454309/openjpa-1787.tar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12472438","id":"12472438","filename":"testcase-openjpa-1787.tar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-02T18:30:56.826+0000","size":3449,"mimeType":"application/x-tar","content":"https://issues.apache.org/jira/secure/attachment/12472438/testcase-openjpa-1787.tar"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Bean validation fails merging a new entity","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/12908077","id":"12908077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"Here is a testcase.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-10T16:28:05.758+0000","updated":"2010-09-10T16:28:05.758+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/12908769","id":"12908769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=drwoods","name":"drwoods","key":"drwoods","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=drwoods&avatarId=20433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=drwoods&avatarId=20433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=drwoods&avatarId=20433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=drwoods&avatarId=20433"},"displayName":"Donald Woods","active":true,"timeZone":"America/New_York"},"body":"Can you provide more details about your application and environment?  You marked affects 2.0.1 and 2.1.0, so which jars are you using?  The openjpa-2.x.x.jar does not include the BVAL API or implementation.  If you grab the latest openjpa-all-2.1.0-SNAPSHOT.jar then that includes the Apache Geronimo Validation API and Apache Bean Validation implementation.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=drwoods","name":"drwoods","key":"drwoods","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=drwoods&avatarId=20433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=drwoods&avatarId=20433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=drwoods&avatarId=20433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=drwoods&avatarId=20433"},"displayName":"Donald Woods","active":true,"timeZone":"America/New_York"},"created":"2010-09-13T12:56:05.408+0000","updated":"2010-09-13T12:56:05.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/12908772","id":"12908772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=drwoods","name":"drwoods","key":"drwoods","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=drwoods&avatarId=20433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=drwoods&avatarId=20433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=drwoods&avatarId=20433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=drwoods&avatarId=20433"},"displayName":"Donald Woods","active":true,"timeZone":"America/New_York"},"body":"So after looking at your example, I'm not sure why you opened a JIRA....\nYou're using Hibernate Validator 4.0.2.GA, which we support.\nThe Employee.name is marked with @NotNull.\nBut in your code snippet above, you are setting the Name, so what is the behavior you're expecting?  @NotNull should only throw an exception if you didn't call setName() before trying to merge/persist the entity.....\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=drwoods","name":"drwoods","key":"drwoods","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=drwoods&avatarId=20433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=drwoods&avatarId=20433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=drwoods&avatarId=20433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=drwoods&avatarId=20433"},"displayName":"Donald Woods","active":true,"timeZone":"America/New_York"},"created":"2010-09-13T13:04:56.993+0000","updated":"2010-09-13T13:04:56.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/12908778","id":"12908778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"OK, I think I described the issue not clear enough.\n\nAs you said right, @NotNull should only throw an exception, if name is not set. \nThe problem is, that I get an exception (javax.validation.ConstraintViolationException), \nalthough I called setName().\n\nUsing persist instead of merge is working as expected. I added added test method to \ndemonstrate this.\n\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-13T13:32:19.281+0000","updated":"2010-09-13T13:32:19.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/12909000","id":"12909000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=drwoods","name":"drwoods","key":"drwoods","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=drwoods&avatarId=20433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=drwoods&avatarId=20433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=drwoods&avatarId=20433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=drwoods&avatarId=20433"},"displayName":"Donald Woods","active":true,"timeZone":"America/New_York"},"body":"Can you attach your stack trace?  I just ran into a scenario where an entity not using Validation is causing the Apache Bean Validation provider to throw an exception due to entity.hashCode() throwing a NPE....\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=drwoods","name":"drwoods","key":"drwoods","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=drwoods&avatarId=20433","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=drwoods&avatarId=20433","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=drwoods&avatarId=20433","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=drwoods&avatarId=20433"},"displayName":"Donald Woods","active":true,"timeZone":"America/New_York"},"created":"2010-09-13T21:11:55.635+0000","updated":"2010-09-13T21:11:55.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/12909143","id":"12909143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"Here is my test output.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2010-09-14T08:15:36.024+0000","updated":"2010-09-14T08:15:36.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13001526","id":"13001526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"A new simple testcase without dependencies to spring, etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-02T18:30:56.844+0000","updated":"2011-03-02T18:30:56.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13001564","id":"13001564","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"I finally found the place in the source code where the data gets lost.\n\nIf you merge a new entity the BrokerImpl first tries to attach the entity via the AttachManager.\nThe AttachManager uses an AttachStrategy to persist the new entity. \n\nHere ist the code snippet from the org.apache.openjpa.kernel.AttachStrategy class with my comments\n\n    protected StateManagerImpl persist(AttachManager manager,\n        PersistenceCapable pc, ClassMetaData meta, Object appId, \n        boolean explicit) {\n        PersistenceCapable newInstance;\n\n        if (!manager.getCopyNew())\n            newInstance = pc;                                                                       <--- calling this would fix the issue \n        else if (appId == null) {\n            newInstance = pc.pcNewInstance(null, false);                                <--- but this is called, pc.pcNewInstance returns an new instance, person.name is set to null\n\t}\n        else\n            newInstance = pc.pcNewInstance(null, appId, false);\n\n        return (StateManagerImpl) manager.getBroker().persist                       <-- this calls finally BrokerImpl.persistInternal(...) and fails because person.name is null  \n            (newInstance, appId, explicit, manager.getBehavior());\n    }\n\nFor my testcases this issue could be fixed by replacing the first if statement with \"if (manager.getCopyNew())\".\nI'm absolutely not sure, if it is really that easy. I guess not.\n\nMaybe another good place to fix the problem is EntityManagerImpl.merge() which also sets the AttachManager's copyNew flag.\n\nPlease could someone with more insight into openjpa verify this solution.\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-02T19:22:11.771+0000","updated":"2011-03-02T19:22:11.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13004237","id":"13004237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"body":"The main problem with your proposed solution is that it would change the way merge works. EntityManager.merge creates a new copy of the entity and it's the copy of the entity that becomes part of the persistence context - not the entity you passed in. Your change would eliminate the copy.\n\nI think the real issue here is that the data hasn't been copied into the new instance before validation occurs. I'm not familiar with this code path, and I haven't had a chance to try your testcase yet, but I'd start by looking at the code where we copy the fields into a new instance. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"created":"2011-03-08T21:41:01.204+0000","updated":"2011-03-08T21:41:01.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005059","id":"13005059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"Hi Michael,\nthank you for your answer. I thought that it would not be so easy to solve this issue. Unfortunately.\n\nI agree with you that the main problem here is that a copy action is missing and I guess AttachStrategy.persist is the right place to add some kind of copy functionality.\n\nI started looking into the source code of the enhanced class from the test. PersistenceCapable declares a public method to copy fields (pcCopyFields(...)).\nUnfortunately you can't use in AttachStrategy.persist, because the entity to persist has no statemanager at this point (an exception InvalidStateException will be the result).\n\nMy suggestion is to modify the class enhancement and remove the StateManager check in pcCopyFields (I don't see the need for this check). \nAfterwards you can use pcCopyFields in AttachStrategy.persist by adding something like \n\n   ...\n        if (manager.getCopyNew()) {\n            int[] fields = new int[meta.getFields().length];\n            for (int i = 0; i < fields.length; i++)\n                fields[i] = i;\n            newInstance.pcCopyFields(pc, fields);\n        }\n   ...\n\nThis solution works for my testcase.\n\nAs an alternative you can modify (or add an additional) newInstance to copy the data.\n\nI have no real experience with OpenJPA. Perhaps there is a much better solution.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-10T13:43:48.137+0000","updated":"2011-03-10T13:43:48.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005093","id":"13005093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"Can you post a stack trace of the problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2011-03-10T15:00:15.921+0000","updated":"2011-03-10T15:00:15.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005193","id":"13005193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"Hi Rick,\n\nthis is the stack trace from my testcase.\n\n2004  OpenJpaTestcase  TRACE  [main] openjpa.Runtime - An exception occurred while ending the transaction.  This exception will be re-thrown.\n<openjpa-2.2.0-SNAPSHOT-r422266:1078811 fatal store error> org.apache.openjpa.util.StoreException: The transaction cannot be committed, because it was already marked for rollback only.  The transaction will be rolled back instead. The cause of the rollback-only status is reported in the embedded stack.\n\tat org.apache.openjpa.kernel.LocalManagedRuntime.commit(LocalManagedRuntime.java:89)\n\tat org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1497)\n\tat org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java:933)\n\tat org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:565)\n\tat testcase.openjpa.OpenJpaTest.testValidation(OpenJpaTest.java:24)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.junit.runners.featureSelection.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.featureSelection.ReflectiveCallable.run(ReflectiveCallable.java:15)\n\tat org.junit.runners.featureSelection.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n\tat org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:59)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:115)\n\tat org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.Surefire.run(Surefire.java:180)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:350)\n\tat org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1021)\nCaused by: javax.validation.ConstraintViolationException: A validation constraint failure occurred for class \"testcase.openjpa.Person\".\n\tat org.apache.openjpa.persistence.validation.ValidatorImpl.validate(ValidatorImpl.java:282)\n\tat org.apache.openjpa.validation.ValidatingLifecycleEventManager.fireEvent(ValidatingLifecycleEventManager.java:122)\n\tat org.apache.openjpa.kernel.BrokerImpl.fireLifecycleEvent(BrokerImpl.java:790)\n\tat org.apache.openjpa.kernel.BrokerImpl.persistInternal(BrokerImpl.java:2606)\n\tat org.apache.openjpa.kernel.BrokerImpl.persist(BrokerImpl.java:2544)\n\tat org.apache.openjpa.kernel.AttachStrategy.persist(AttachStrategy.java:95)\n\tat org.apache.openjpa.kernel.VersionAttachStrategy.attach(VersionAttachStrategy.java:102)\n\tat org.apache.openjpa.kernel.AttachManager.attach(AttachManager.java:251)\n\tat org.apache.openjpa.kernel.AttachManager.attach(AttachManager.java:104)\n\tat org.apache.openjpa.kernel.BrokerImpl.attach(BrokerImpl.java:3433)\n\tat org.apache.openjpa.kernel.DelegatingBroker.attach(DelegatingBroker.java:1214)\n\tat org.apache.openjpa.persistence.EntityManagerImpl.merge(EntityManagerImpl.java:873)\n\tat testcase.openjpa.OpenJpaTest.testValidation(OpenJpaTest.java:22)\n\t... 26 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-10T17:36:21.044+0000","updated":"2011-03-10T17:36:21.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005251","id":"13005251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"I tracked down the source of the problem.  When merging a new entity, OpenJPA persists a new \"empty\" entity, sets (or retrieves) an ID for the new entity, and then merges in the object passed in.  The problem is that the during the persist of the empty entity, a PRE_PERSIST lifecycle event gets fired, causing validation to occur.  I've found that not only is validation occurring prematurely, but OpenJPA violates the JPA specification for the PrePersist callback as well.  \n\n<jpa 1.0 & 2.0 spec - section 3.5.2>\nFor entities to which the merge operation has been applied and causes the creation of newly managed instances, the PrePersist callback methods will be invoked for the managed instance after the entity state has been copied to it.\n<jpa 1.0 & 2.0 spec - section 3.5.2/>\n\nBy adding this simple callback to the Person class, it showed that a PrePersist callback occurred before the entity was fully populated. \nclass Person {\n...\n\n    @PrePersist\n    public void prePersist() {\n        System.out.println(\"PrePersist getName()=\" + this.getName());\n    }\n}\n\nResult:  PrePersist getName()=null\n\nI think the solution will be to disable this callback for the case where a new entity is created specifically for the purposes of a merge.  Working on a fix...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-10T19:06:49.224+0000","updated":"2011-03-10T19:06:49.224+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005475","id":"13005475","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"Attaching patch for 2.1.x release that prevents the persist path from firing a premature pre-persist event on new entities produced in a merge operation.  I am seeing some jUnit failures that test order/look schema related rather than related to this change.  I am looking into those failures and producing additional test cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-11T03:53:59.480+0000","updated":"2011-03-11T03:53:59.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005733","id":"13005733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"Attached jUnits for inclusion in the bean validation integration module.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-11T17:29:28.335+0000","updated":"2011-03-11T17:29:28.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13005817","id":"13005817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"Committed code and jUnit patches to trunk.  I was able to get clean local and server based builds today.  I'm not sure what was up yesterday.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-11T20:33:43.626+0000","updated":"2011-03-11T20:33:43.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13006993","id":"13006993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"body":"Perfect. You fixed the issue. Both my test case as well as my real project are working now. Thank you very much.\n\nBTW. I found something probably wrong in the ValidatingLifecycleEventManager\n\n...\n    @Override\n    public boolean hasUpdateListeners(Object source, ClassMetaData meta) {\n        if (_validator == null) {            \n            return super.hasUpdateListeners(source, meta);\n        }\n        return _validator.validating(source, LifecycleEvent.BEFORE_PERSIST) ||    <--- LifecycleEvent.BEFORE_UPDATE\n            super.hasUpdateListeners(source, meta);\n    }\n\n    @Override\n    public boolean hasPersistListeners(Object source, ClassMetaData meta) {\n        if (_validator == null) {            \n            return super.hasPersistListeners(source, meta);\n        }\n        return _validator.validating(source, LifecycleEvent.BEFORE_UPDATE) ||    <--- LifecycleEvent.BEFORE_PERSIST\n            super.hasPersistListeners(source, meta);        \n    }\n...\n\nAlthough it has no effect for my testcase, it looks not correct. Maybe you verify this.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oringel","name":"oringel","key":"oringel","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Ringel","active":true,"timeZone":"Etc/UTC"},"created":"2011-03-15T16:24:06.984+0000","updated":"2011-03-15T16:24:06.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13007006","id":"13007006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"Great!  I'm glad it fixed the problem.  I just checked the code into the 2.1.x stream as well.\n\nYes, the has*Listeners methods in the VLEM do look suspect.  Thanks for reporting it.  I'll do some verification and will open a new JIRA if it turns out to be a bug.  I'm about 99% certain it is...  Both pre-persist and pre-update validation are enabled by default.  So, the bug will not surface unless non-default validation groups are specified.  Looks like we are missing a test variation or three.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-15T16:46:09.552+0000","updated":"2011-03-15T16:46:09.552+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13007316","id":"13007316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"It looks like the hasPersistListeners and hasUpdateListeners methods in the VLEM are implemented simply for the sake of consistency and, as far as I can tell, are not actually called within OpenJPA.  Event type checking is all within the fireEvent method itself and testing shows it to work as expected.  The hasDeleteListeners method (which is implemented correctly) does get called by JDBCStoreQuery for specific in-memory operations.  For the sake of consistency, and in the event that an external plugin may be calling these methods (they are public), I'll check in the simple code fix and some additional test cases that further verify validation is working as expected, based on the event type and specified validation group (or lack thereof).  This JIRA will be used to make these changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-16T02:17:18.701+0000","updated":"2011-03-16T02:17:18.701+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13007624","id":"13007624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"body":"Committed has*Listeners fix + additional testcases to trunk under rev 1082259.  I don't think this additional change necessarily needs to be backported since it doesn't appear to cause any real problem, but it certainly could be.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=techhusky","name":"techhusky","key":"techhusky","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Bauer","active":true,"timeZone":"America/Chicago"},"created":"2011-03-16T18:52:14.940+0000","updated":"2011-03-16T18:52:14.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13198944","id":"13198944","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"body":"Close issue in preparation for 2.2.0 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-02-02T16:54:10.820+0000","updated":"2012-02-02T16:54:10.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13249471","id":"13249471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"body":"Did this bug fix make it into 2.2.0?\n\nI have exactly the same problem using @Basic(optional=false)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"created":"2012-04-08T04:25:52.298+0000","updated":"2012-04-08T04:25:52.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13249473","id":"13249473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"body":"Or more accurately, when the merge cascades more than one relationship. i.e. the non-null field is\n\nInvoice.Customer.Contact.name\n\nand I call\n\nmerge(invoice)\n\nThe Customer validates okay, but validation annotations on the Contact all fail because the fields are null.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"created":"2012-04-08T04:38:23.981+0000","updated":"2012-04-08T04:38:23.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13250050","id":"13250050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"According to Albert's comment on 02/02/2012 and the svn commit messages, this problem was resolved in the 2.2.0 release.  Are you still experiencing a similar problem with 2.2.0?  Or, were you just asking?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2012-04-09T18:43:29.163+0000","updated":"2012-04-09T18:43:29.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13451219","id":"13451219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"body":"I have this problem in 2.2.0\n\n    <dependency>\n      <groupId>org.apache.openjpa</groupId>\n      <artifactId>openjpa</artifactId>\n      <version>2.2.0</version>\n      <scope>compile</scope>\n    </dependency>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"created":"2012-09-08T01:52:58.500+0000","updated":"2012-09-08T01:52:58.500+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13451264","id":"13451264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"body":"I've hit this bug again with cascade merging. Validations on the nested object fail because the fields are all null. Maybe the fireEvents flag isn't properly handled when cascading?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"created":"2012-09-08T06:26:36.829+0000","updated":"2012-09-08T06:26:36.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473823/comment/13476328","id":"13476328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"body":"I've opened OPENJPA-2279 and attached a failing unit test for the problem I described.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rogerkeays","name":"rogerkeays","key":"rogerkeays","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Roger Keays","active":true,"timeZone":"America/Bogota"},"created":"2012-10-15T18:24:45.637+0000","updated":"2012-10-15T18:24:45.637+0000"}],"maxResults":27,"total":27,"startAt":0},"customfield_12311820":"0|i09zxz:","customfield_12314139":null}}

