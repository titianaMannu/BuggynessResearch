{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12525645","self":"https://issues.apache.org/jira/rest/api/2/issue/12525645","key":"OPENJPA-2056","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315910","id":"12315910","description":"OpenJPA 2.2.0 Release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2012-02-20"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"44266","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314019","id":"12314019","description":"JPA2 release","name":"2.0.0","archived":false,"released":true,"releaseDate":"2010-04-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314532","id":"12314532","description":"2.0.1 Release","name":"2.0.1","archived":false,"released":true,"releaseDate":"2010-08-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316191","id":"12316191","description":"OpenJPA 2.1.x maintenance release","name":"2.1.1","archived":false,"released":true,"releaseDate":"2011-07-25"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311310","id":"12311310","name":"sql","description":"Issues to do with SQL, including generation of SQL. Issues that have to do with JDBC (i.e., execution of SQL statements and result set processing) should be filed in the jdbc component."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"289101","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gbjbaaha","name":"gbjbaaha","key":"gbjbaaha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Hastie","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gbjbaaha","name":"gbjbaaha","key":"gbjbaaha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Hastie","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2056/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@5b3a9ac0[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@72771a43[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@119c1422[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@5b73a150[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@21f38956[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@44e42696[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@35a8072c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@739749e8[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4e93d7f5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@2ba69827[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5ec27b18[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@1753a121[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2011-10-09T11:17:35.458+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2056/watchers","watchCount":1,"isWatching":false},"created":"2011-10-04T10:41:39.187+0000","updated":"2012-02-02T17:14:27.204+0000","timeoriginalestimate":null,"description":"Noticed an issue with the Postgres DBDictionary definition after updating Postgres from version 8.4 to 9.1:-\n\nHere's what you get in the Postgres trace file when executing some JPA driven queries where an SQL LIKE is involved:-\n\n2011-09-30 14:29:41 BST ERROR:  invalid escape string\n2011-09-30 14:29:41 BST HINT:  Escape string must be empty or one character.\n2011-09-30 14:29:41 BST STATEMENT:  SELECT t0.id, t0.identificationMask, t0.productName FROM DBTYPE t0 WHERE (t0.identificationMask LIKE $1 ESCAPE '\\\\')\n2011-09-30 14:29:41 BST ERROR:  current transaction is aborted, commands ignored until end of transaction block\n\nThis appears to be down to a change the Postgres project have made to escape string handling:-\n  http://www.postgresql.org/docs/9.1/static/release-9-1.html (see section E.2.2.1)\n\nYou appear to be able to override the default DBDictionary setting for this as follows to get things working again:-\n<property name=\"openjpa.jdbc.DBDictionary\" value=\"postgres(SearchStringEscape=\\)\"/>\n\nSo, does this mean OpenJPA needs a version dependent dictionary definition for Postgres from now on? Anybody got any better solutions or care to confirm what I'm seeing?\n\nI've also posted this to the Postgres JDBC mailing list in case they have any comments. ","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Postgres V9.1 issue with LIKE clause and Escape Strings","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"Running against a Postgres database at version 9.1","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12525645/comment/13120000","id":"13120000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gbjbaaha","name":"gbjbaaha","key":"gbjbaaha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Hastie","active":true,"timeZone":"Etc/UTC"},"body":"I think there are several solutions to this problem, but ideally we need something that is backwards compatible with previous Postgres releases. I'm no expect on the internals of OpenJPA, but here are some suggestions:\n\n1. Determine from the current connection the setting of \"standard_conforming_strings\" (Needs SQL statement \"SHOW standard_conforming_strings;\"). This can then be used to influence the escape string to being either \"\\\\\" or \"\\\\\\\\\" in the Dictionary impl as required. ASFAIK Postgres at V9.1 returns \"ON\" and earlier releases return \"OFF\".\n\nHere are some links to the Postgres documentation covering this topic:-\n  http://www.postgresql.org/docs/9.1/interactive/runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS\n  http://www.postgresql.org/docs/9.1/interactive/sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE\n\n2. Use an explicitly escaped string like E'\\\\' to force escape interpretation, making the string independent of the standards_conforming_strings param.\n\nUntil this is fixed, there are several workarounds for the problem:-\n\n1. Set a property in the persistence.xml as follows to override the default PGDictionary setting:-\n    <property name=\"openjpa.jdbc.DBDictionary\" value=\"postgres(SearchStringEscape=\\)\"/>\n2. In the Postgres configuration file (postgresql.conf) make the setting under \"VERSION/PLATFORM COMPATIBILITY\" :-\n  standard_conforming_strings = off\n\nOption 1 is preferred as not all users may have access to the Postgres configuration files.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gbjbaaha","name":"gbjbaaha","key":"gbjbaaha","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Hastie","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-04T10:52:51.938+0000","updated":"2011-10-04T10:52:51.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12525645/comment/13120590","id":"13120590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ringerc","name":"ringerc","key":"ringerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Ringer","active":true,"timeZone":"Etc/UTC"},"body":"Note that standard_conforming_strings was introduced in PostgreSQL 8.2. While this is the oldest release still supported by the PostgreSQL team, and will be exiting support in December this year, people seem to routinely run old and unsupported releases. Questions about PostgreSQL 7.4 are not uncommon on the mailing list. On prior versions, \"SHOW standard_conforming_strings\" will report an error.\n\nIt's not particularly likely that people running such ancient versions of PostgreSQL will upgrade OpenJPA, but in an org where DBA/sysadmin is very separate from dev, or where legacy and actively maintained apps coexist in the same DBs, it's not impossible. It's worth handling.\n\nI think the escape string syntax E'' was introduced in PostgreSQL 8.1, but haven't tested to verify that. You should probably not rely on it if people using ancient versions is a realistic possibility.\n\nThe best answer will probably be to always escape strings. Just \"SELECT version()\" to decide whether the explicit escape-string syntax should be used, or if, as older versions that lack standard_conforming_strings, all strings should be assumed to be subject to escape processing. That makes OpenJPA independent of the standard_conforming_strings parameter.\n\nIt's also important to be aware of the backslash_quote parameter, which is another compatibility option that can cause pain. Escape single quotes by doubling them, not by using \\', to avoid issues with this. backslash_quote exists as far back as at least PostgreSQL 7.4, as does support for SQL-standard '' style quote escapes. If OpenJPA currently escapes quotes using \\' this should be changed to avoid another potential bug.\n\nI know all this is ugly; transitioning toward better standards conformance often is in cases where no 100%-compatible approach can exist. Unfortunately, standard_conforming_strings will be a wart for quite a long time and it is a setting people DO mess with, so it's important to handle it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ringerc","name":"ringerc","key":"ringerc","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig Ringer","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-04T23:50:17.856+0000","updated":"2011-10-04T23:50:17.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12525645/comment/13123664","id":"13123664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"body":"Hi Andrew & Craig. Thanks for the extensive information. The escape string now depends on PostgreSQL version:\n1. 9.0 and older use '\\\\'.\n2. 9.1 and later use '\\'.\n\nI expect this to be a good solution for the vast majority of users. Those with PostgreSQL 9.0 and older who have set standard_conforming_strings to ON can use the SearchStringEscape property workaround proposed by Andrew. Also, setting a DBDictionary property called RequiresSearchStringEscapeForLike to false might help in such cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=milosz","name":"milosz","key":"milosz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Milosz Tylenda","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-09T11:28:43.785+0000","updated":"2011-10-09T11:28:43.785+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12525645/comment/13198986","id":"13198986","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"body":"Close issue in preparation for 2.2.0 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-02-02T17:14:27.195+0000","updated":"2012-02-02T17:14:27.195+0000"}],"maxResults":4,"total":4,"startAt":0},"customfield_12311820":"0|i1duvz:","customfield_12314139":null}}

