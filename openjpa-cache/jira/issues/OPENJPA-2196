{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12555953","self":"https://issues.apache.org/jira/rest/api/2/issue/12555953","key":"OPENJPA-2196","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323356","id":"12323356","description":"OpenJPA 2.2.2 Release","name":"2.2.2","archived":false,"released":true,"releaseDate":"2013-04-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323484","id":"12323484","description":"OpenJPA 2.2.1.x Maintenance Release","name":"2.2.1.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12319463","id":"12319463","description":"OpenJPA 2.3.0","name":"2.3.0","archived":false,"released":true,"releaseDate":"2013-11-24"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"240170","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":14400,"timeestimate":14400,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315910","id":"12315910","description":"OpenJPA 2.2.0 Release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2012-02-20"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12354929","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12354929","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12439900","key":"OPENJPA-1376","self":"https://issues.apache.org/jira/rest/api/2/issue/12439900","fields":{"summary":"@SequenceGenerator allocationSize incorrect implementation","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12354930","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12354930","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12530384","key":"OPENJPA-2069","self":"https://issues.apache.org/jira/rest/api/2/issue/12530384","fields":{"summary":"Natvie sequence problems uncovered after OPENJPA-1376","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12378197","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378197","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12678313","key":"OPENJPA-2450","self":"https://issues.apache.org/jira/rest/api/2/issue/12678313","fields":{"summary":"Option to disable execution of ALTER SEQUENCE...INCREMENT BY statement for sequences.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311304","id":"12311304","name":"jpa","description":"Java Persistence API interface"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":14400,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"3403","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hendimarcos","name":"hendimarcos","key":"hendimarcos","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hendi Marcos Ramos Silva","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hendimarcos","name":"hendimarcos","key":"hendimarcos","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hendi Marcos Ramos Silva","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":14400,"percent":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":14400,"percent":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2196/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@46babc48[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4885c2c4[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@780d040f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1ef86a28[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@418d6282[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1ffbf745[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f46a5c9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@52b23723[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7881c685[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3800570f[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d2c52b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@419ae17d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-07-25T18:40:33.421+0000","workratio":0,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2196/watchers","watchCount":5,"isWatching":false},"created":"2012-05-16T04:41:22.729+0000","updated":"2013-11-08T20:47:55.188+0000","timeoriginalestimate":14400,"description":"Sorry my bad english ..\n\nwhen annotated a entity with @SequenceGenerator and with allocationSize = 1 and initialValue = 1, the method DBDictionary.commonCreateAlterSequenceSQL is creating a alter sequence sql invalid for Postgres 9.1.\nDespite the documentation of postgres inform you that the other parameters are optional (http://www.postgresql.org/docs/9.1/static/sql-altersequence.html), an error occurs in executing the sql below.\n\nEg: ALTER SEQUENCE schema_experimento.usuario_sq (no other attributes)\n\nEven the method NativeJDBCSeq.udpateSql being fault tolerant, the connection is marked for rollback and not allowing run the next val of sequence.\n\nHêndi Marcos","customfield_10010":null,"timetracking":{"originalEstimate":"4h","remainingEstimate":"4h","originalEstimateSeconds":14400,"remainingEstimateSeconds":14400},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12535673","id":"12535673","filename":"OPENJPA-2196-2.2.0.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=snortasprocket","name":"snortasprocket","key":"snortasprocket","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Parkerson","active":true,"timeZone":"America/Havana"},"created":"2012-07-09T13:58:15.126+0000","size":4179,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12535673/OPENJPA-2196-2.2.0.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042","disabled":false}],"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Create Sequence Postgres 9.1","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"OpenJPA-2.2.0\nTransaction-type JTA\nPostgres 9.1\nJBoss 6.1","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555953/comment/13397505","id":"13397505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Through another discussion on the OpenJPA mailing list (http://openjpa.208410.n2.nabble.com/Postgres-sequence-current-transaction-is-aborted-td7580299.html), we've come to the bottom of this issue.  The creation of this \"alter sequence..\" statement stops prematurely when it's discovered that the sequence allocation size is not greater than 1.  I think this conditional should be greater than 0 (instead of 1).  Regardless, we have to be smarter with creating these \"create/alter sequence..\" statements so that they are complete before attempting to execute.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2012-06-20T13:45:49.017+0000","updated":"2012-06-20T13:49:30.425+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555953/comment/13397508","id":"13397508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Albert, I'm going to assign to you since this issue is in the area of the sequence updates you did via openjpa-1376 and openjpa-2069.  Good luck!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2012-06-20T13:47:21.368+0000","updated":"2012-06-20T13:47:21.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555953/comment/13397619","id":"13397619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Since the title of this JIRA is generic enough, I'm also going to post the other issue that came about due to the discussion on the mailing list (http://openjpa.208410.n2.nabble.com/Postgres-sequence-current-transaction-is-aborted-td7580299.html).\n\nWe have an issue with the permissions required to alter a database sequence with Postgres.  Or, at least, that's the only database that seems to be reporting this error.  With the changes introduced by OpenJPA-1376 and OpenJPA-2069, we are now blindly attempting to issue an \"alter sequence..\".  This is not good for Postgres users since only the owner of the Sequence can alter it.  So far, we must be lucking out with the other databases.\n\nA couple of things that need to be re-looked at for this Sequence update.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2012-06-20T16:35:59.495+0000","updated":"2012-06-20T16:35:59.495+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555953/comment/13404076","id":"13404076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=snortasprocket","name":"snortasprocket","key":"snortasprocket","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Parkerson","active":true,"timeZone":"America/Havana"},"body":"Consider, also, this scenario, where OpenJPA is using PostgreSQL and the owner of sequence is not the same user of the client (but client does have the {{USAGE}} grant on the sequence to call nextval, etc.). Let i be the initial starting value of the database sequence.\n\n1. An OpenJPA application connects to the database, and inserts n records into the database where n > 1 and n < allocationSize. On the first insert, the {{ALTER SEQUENCE}} call is made fails silently (although PostgreSQL will log an error serverside, but since the exception is swallowed by the client, no one is the wiser -- including the code that \"thinks\" it has the next allocationSize ids cached. The database, however, still thinks that next sequence number is i+1.\n\n2. If the application is stopped and restarted, the next insert will fail due to a duplicate key violation (because, since the first ALTER SEQUENCE failed, the database still thinks its current sequence is i+1, but OpenJPA allowed that record to be inserted in the first run.\n\nI'm not seeing the behavior where the ALTER SEQUENCE call marks the transaction for rollback, though. I *think* I'm in a JTA-managed transaction, too... so not sure about that. Looking at the code in NativeJDBCSeq.allocateInternal, it appears that a new connection is grabbed from the store; not sure that connection is under JTA.\n\nAt minimum, I think that OpenJPA should detect the failure to ALTER SEQUENCE and not cache allocationSize values (perhaps logging to WARN level the first time this happens per session per sequence). Additionally, the original DBDictionary.commonCreateAlterSequenceSQL should always specify INCREMENT BY even if it is set to 1, as that breaks the \"workaround\" for users who wish emulate previous OpenJPA behavior using useNativeSequenceCache=False.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=snortasprocket","name":"snortasprocket","key":"snortasprocket","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Parkerson","active":true,"timeZone":"America/Havana"},"created":"2012-06-29T18:03:28.089+0000","updated":"2012-06-29T18:03:28.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555953/comment/13409478","id":"13409478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=snortasprocket","name":"snortasprocket","key":"snortasprocket","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Parkerson","active":true,"timeZone":"America/Havana"},"body":"This patch works around the case where the ALTER SEQUENCE statement fails to execute (which will happen on PostgreSQL if the sequence is not owned by the current connection's user). A warning message is logged for each sequence indicating that the sequence was not modified and that sequence values are not cached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=snortasprocket","name":"snortasprocket","key":"snortasprocket","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Parkerson","active":true,"timeZone":"America/Havana"},"created":"2012-07-09T13:58:15.146+0000","updated":"2012-07-09T13:58:15.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555953/comment/13422491","id":"13422491","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"body":"I only commit the fix in trunk (2.3.0). If you need fixes in 2.2.x, you need to work with the release manager for inclusion.  2.2.x is a maintenance release for WebSphere, one can request a service call to the WebSphere product, if needed.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=allee8285","name":"allee8285","key":"allee8285","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Albert Lee","active":true,"timeZone":"America/Chicago"},"created":"2012-07-25T18:40:33.506+0000","updated":"2012-07-25T18:40:33.506+0000"}],"maxResults":6,"total":6,"startAt":0},"customfield_12311820":"0|i00xrr:","customfield_12314139":null}}

