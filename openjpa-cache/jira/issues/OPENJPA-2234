{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12599438","self":"https://issues.apache.org/jira/rest/api/2/issue/12599438","key":"OPENJPA-2234","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319463","id":"12319463","description":"OpenJPA 2.3.0","name":"2.3.0","archived":false,"released":true,"releaseDate":"2013-11-24"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"240132","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314532","id":"12314532","description":"2.0.1 Release","name":"2.0.1","archived":false,"released":true,"releaseDate":"2010-08-30"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"3365","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2234/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@f9eecc[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@208540ca[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@65da88e5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6fd31784[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@424e80a3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3c4dd922[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@d61f3ee[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7a79aaf1[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4c847685[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1ed222fe[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1c2e5c49[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2bb7531f[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-10-16T21:32:56.495+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2234/watchers","watchCount":4,"isWatching":false},"created":"2012-07-19T10:06:09.521+0000","updated":"2015-06-06T21:19:14.033+0000","timeoriginalestimate":null,"description":"While working with Spring Data, we came across a potential bug in OpenJPA.\n\nThe bug was provoked by a query lookup module in Spring Data JPA, but it has its roots in AbstractBrokerFactory class, which seems to require transaction existence in order to create EntityManager (which is contrary to JPA spec).\n\nI have already been in touch with Spring Data JPA author (where I filed a bug against Spring Data JPA) who actually pointed me to file a bug here.\n\nI have extensively documented my findings on this thread (http://stackoverflow.com/questions/10688040/spring-data-jpa-fails-to-invoke-jtatransactionmanager), so I'll rather post the link, instead of repeating the whole thing here.\n\nAll that being said, I am not entirely sure what actually happened and am no authority whatsoever on JPA spec.","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"EntityManager instance creation needs TX activity","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"- JDK 1.5\n- Spring 3.1.1.RELEASE\n- Spring Data JPA 1.1 GA (issue confirmed on version 1.0.3)\n- Atomikos 3.7.0\n- OpenJPA 2.0.1\n- DB2 9.7\n","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13418289","id":"13418289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"Erik -\n\nThanks for the thorough SO writeup. Unfortunately I think you're assessment of where the problems lies isn't quite correct. If you were to look at the OpenJPA code: \n\n    boolean syncWithManagedTransaction(BrokerImpl broker, boolean begin) {\n        Transaction trans;\n        try {\n            ManagedRuntime mr = broker.getManagedRuntime();\n            TransactionManager tm = mr.getTransactionManager();\n            trans = tm.getTransaction(); <<< line 720\n\nyou will notice that the NPE is coming from not having a TransactionManager, not that you don't have a transaction.\n\n\nI see the following line in your persistence configuration :\n\n<entry key=\"openjpa.ManagedRuntime\" value=\"invocation(TransactionManagerMethod=com.atomikos.icatch.jta.TransactionManagerImp.getTransactionManager)\" />\n\nWe can start out with an easy one, is the getTransactionManager method static? If not, try changing that.\n\nThanks,\nRick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-07-19T13:47:12.129+0000","updated":"2012-07-19T13:47:12.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13419104","id":"13419104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"body":"Hello, Rick, thanks for your quick response.\n\nRegarding persistence configuration, I've checked - getTransactionManager() method _is_ static.\n\nRegarding problem assessment - I agree with you; I've actually noticed that Spring doesn't set the TransactionManager (PlatformTransactionManager's setter is not invoked), hence we get NPE@line 720. The problem happens while bootstrapping Spring application context - more specifically, while Spring Data JPA performs query lookup. Now, if you were to check comments in SO writeup, you'll notice that in correspondence with Oliver Gierke (Spring Data JPA project lead), he had stated that OpenJPA is actually not conforming here to JPA specification, since by JPA spec, no tx activity is needed during query creation (i.e. while executing entityManager.createQuery(...)).\n\nAs I said, I am far from understanding every nook and cranny in any of the participating modules (be it OpenJPA, Spring Data JPA or the JPA2 specification itself), however, his arguments do seem convincing, at least to me.\n\nIs there anything else we could try?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"created":"2012-07-20T12:59:09.634+0000","updated":"2012-07-20T12:59:09.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13419259","id":"13419259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"The root issue is that you configured OpenJPA to call com.atomikos.icatch.jta.TransactionManagerImp.getTransactionManager() to get a TransactionManager instance and that method returned null. \n\nThe OpenJPA runtime requires that we have a TransactionManager (Not a transaction, just a manager) to function properly. I believe Oliver is incorrect in stating that we're in violation of the spec in this regards.\n\n> Is there anything else we could try? \nPerhaps Oliver could help you/us understand why you have the configuration you do, and why it is returning a null TransactionManager?\n\nThanks,\nRick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-07-20T15:32:21.131+0000","updated":"2012-07-20T15:32:21.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13455059","id":"13455059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliver.gierke","name":"oliver.gierke","key":"oliver.gierke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=oliver.gierke&avatarId=29138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=oliver.gierke&avatarId=29138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=oliver.gierke&avatarId=29138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=oliver.gierke&avatarId=29138"},"displayName":"Oliver Drotbohm","active":true,"timeZone":"Europe/Berlin"},"body":"I didn't suspect OpenJPA to violate the spec. All I was stumbling above was that apparently the EntityManagerFactory bootstrap code tries to access a TransactionManager which effectively can't be in place at that time as usually the Txmanager works with the EntityManagerFactory in turn. At least OpenJPA behaves very different compared to other JPA providers and I wondered why this early TxManager lookup is required.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliver.gierke","name":"oliver.gierke","key":"oliver.gierke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=oliver.gierke&avatarId=29138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=oliver.gierke&avatarId=29138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=oliver.gierke&avatarId=29138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=oliver.gierke&avatarId=29138"},"displayName":"Oliver Drotbohm","active":true,"timeZone":"Europe/Berlin"},"created":"2012-09-13T17:47:45.673+0000","updated":"2012-09-13T17:47:45.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13457144","id":"13457144","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"> that apparently the EntityManagerFactory bootstrap code tries to access a TransactionManager which effectively can't be in place at that time as usually the Txmanager works with the EntityManagerFactory in turn.\nI don't follow your comment? The exception occurs at EntityManager creation, not EntityManagerFactory.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-09-17T16:50:21.031+0000","updated":"2012-09-17T16:50:21.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472296","id":"13472296","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"Closing as invalid. Please reopen with additional data if you disagree.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-10-09T12:13:43.453+0000","updated":"2012-10-09T12:13:43.453+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472349","id":"13472349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliver.gierke","name":"oliver.gierke","key":"oliver.gierke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=oliver.gierke&avatarId=29138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=oliver.gierke&avatarId=29138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=oliver.gierke&avatarId=29138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=oliver.gierke&avatarId=29138"},"displayName":"Oliver Drotbohm","active":true,"timeZone":"Europe/Berlin"},"body":"How is the TransactionManager expected to be set on the EntityManagerFactory then? I cannot see any API on EntityManagerFactoryImpl which could have been invoked. I'd also argue that the implementation should shield against the transaction manager being null more explicitly if it is mandatory rather than throwing a generic NPE. There seems to be a configuration/setup error by the user and that should be communicated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliver.gierke","name":"oliver.gierke","key":"oliver.gierke","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=oliver.gierke&avatarId=29138","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=oliver.gierke&avatarId=29138","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=oliver.gierke&avatarId=29138","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=oliver.gierke&avatarId=29138"},"displayName":"Oliver Drotbohm","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-09T13:07:33.778+0000","updated":"2012-10-09T13:07:33.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472358","id":"13472358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Olivier, it is done thanks to the managed runtime\n\njust configure <entry key=\"openjpa.ManagedRuntime\" value=\"invocation(TransactionManagerMethod=foo.TxMgrHolder.getTransactionManager)\" /> \n\nfor spring you can return a proxy which will get the tx mgr from the app ctx - btw then you'll need to deal with spring/openjpa lifecycle","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-09T13:18:56.764+0000","updated":"2012-10-09T13:18:56.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472373","id":"13472373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"> I'd also argue that the implementation should shield against the transaction manager being null more explicitly if it is mandatory rather than throwing a generic NPE.\nAgreed. I'll add that sometime this morning.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-10-09T13:44:22.401+0000","updated":"2012-10-09T13:44:22.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472381","id":"13472381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"body":"> Hi Olivier, it is done thanks to the managed runtime....\n\nHello, Romain, if you check the StackOverflow link in the problem description, you'll notice that ManagedRuntime property has indeed been set, but had not prevented NPE from being thrown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-09T13:52:13.132+0000","updated":"2012-10-09T13:52:13.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472385","id":"13472385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"this means spring is not started, just need to be started before","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-09T13:55:55.340+0000","updated":"2012-10-09T13:55:55.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472421","id":"13472421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"Committed revision 1396043 to trunk.\n\nNow we'll throw the following exception when we encounter a nullTransactionManager.\n\n<openjpa-2.3.0-SNAPSHOT-r422266:1393779M fatal internal error> org.apache.openjpa.util.InternalException: Received a null javax.transaction.TransactionManager from the openjpa.ManagedRuntime \"org.apache.openjpa.ee.TestNullTransactionManagerFromRuntime$ManagedRuntimeNullTransactionManager@64686468\".\n\tat org.apache.openjpa.kernel.AbstractBrokerFactory.syncWithManagedTransaction(AbstractBrokerFactory.java:727)\n\tat org.apache.openjpa.kernel.BrokerImpl.initialize(BrokerImpl.java:391)\n\tat org.apache.openjpa.kernel.BrokerImpl.initialize(BrokerImpl.java:325)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-10-09T14:25:09.140+0000","updated":"2012-10-09T14:25:09.140+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472524","id":"13472524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"body":"Thx, Rick for this - I just wonder is there any way to recover from this exception? Also, is there any chance of backporting this to 2.0.x branch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erikkis","name":"erikkis","key":"erikkis","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erik Kis","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-09T16:35:52.632+0000","updated":"2012-10-09T16:35:52.632+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13472626","id":"13472626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"Erik - Honestly, I'm not aware of any way to recover. I suspect I could log a warning, but other parts of the runtime would blow chunks with a similar NPE due to the missing TM. It seemed safer to detect this condition and fail fast.\n\nIt is unlikely that this change will make it into 2.0.x as that is a WebSphere managed branch... but I'll shoot a note to the branch owner to see what he thinks.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-10-09T18:48:15.006+0000","updated":"2012-10-09T18:48:15.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599438/comment/13477369","id":"13477369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"I talked with the branch owner and he said that to get this change into 2.0.x you'd need to go through WebSphere support and get PMR opened to get the thumbs up to merge this change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2012-10-16T21:32:49.199+0000","updated":"2012-10-16T21:32:49.199+0000"}],"maxResults":15,"total":15,"startAt":0},"customfield_12311820":"0|i00xjb:","customfield_12314139":null}}

