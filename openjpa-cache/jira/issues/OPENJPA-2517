{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12727288","self":"https://issues.apache.org/jira/rest/api/2/issue/12727288","key":"OPENJPA-2517","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324305","id":"12324305","description":"OpenJPA 2.2.x Maintenance Release","name":"2.2.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12332295","id":"12332295","description":"OpenJPA 2.4.1","name":"2.4.1","archived":false,"released":true,"releaseDate":"2016-02-21"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"405394","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315910","id":"12315910","description":"OpenJPA 2.2.0 Release","name":"2.2.0","archived":false,"released":true,"releaseDate":"2012-02-20"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12319943","id":"12319943","description":"OpenJPA 2.2.1 Release","name":"2.2.1","archived":false,"released":true,"releaseDate":"2012-11-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323356","id":"12323356","description":"OpenJPA 2.2.2 Release","name":"2.2.2","archived":false,"released":true,"releaseDate":"2013-04-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12319463","id":"12319463","description":"OpenJPA 2.3.0","name":"2.3.0","archived":false,"released":true,"releaseDate":"2013-11-24"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"405419","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2517/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2702a35c[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@d9212f6[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7fe471a3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@627cc90b[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6cb792e9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@505dd261[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@ce8c8a0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@8586ca7[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@58a8879f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@66589831[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2cbff192[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@67c99df6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2015-10-12T20:51:56.437+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2517/watchers","watchCount":7,"isWatching":false},"created":"2014-07-15T08:50:03.109+0000","updated":"2019-09-13T15:35:45.272+0000","timeoriginalestimate":null,"description":"The value of the \"javax.persistence.query.timeout\" property have been passed to the java.sql.Statement.setQueryTimeout(int) in milliseconds rather than seconds.\n\nThe query timeout milliseconds should be converted to seconds.\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655723","id":"12655723","filename":"OPENJPA-2517.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-07-15T09:06:27.998+0000","size":891,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12655723/OPENJPA-2517.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12750933","id":"12750933","filename":"OPENJPA-2517-2.2.x.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"created":"2015-08-18T00:04:01.707+0000","size":4269,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12750933/OPENJPA-2517-2.2.x.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12655722","id":"12655722","filename":"openjpa-querytimeout-bug.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-07-15T09:02:00.839+0000","size":5663,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12655722/openjpa-querytimeout-bug.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12739111","id":"12739111","filename":"openjpa-querytimeout-working.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"created":"2015-06-11T19:53:34.813+0000","size":6034,"mimeType":"application/x-zip","content":"https://issues.apache.org/jira/secure/attachment/12739111/openjpa-querytimeout-working.zip"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042","disabled":false}],"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Incorrect the time unit of query timeout value.","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14061856","id":"14061856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"body":"Attached Maven project for bug reproduction (openjpa-querytimeout-bug.zip).\nPlease run command 'mvn clean test'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-07-15T09:02:00.845+0000","updated":"2014-07-15T09:03:29.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14063486","id":"14063486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"I took a look at your fix and it looks good. I'll try to take some time to work this into trunk sometime later this week. Is there a particular release that you need this fix committed into?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2014-07-16T13:33:50.159+0000","updated":"2014-07-16T13:33:50.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14065853","id":"14065853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"body":"Thank you, Rick.\n\nThe release of my project is planned still ahead, so I don't immediately need this fix.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-07-18T01:11:34.714+0000","updated":"2014-07-18T01:11:34.714+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14071664","id":"14071664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"body":"I dug into this one a bit and it appears that the root issue is that when we implemented this support, it was against a non-final version of the JPA-2.0 spec. If you take a look at OPENJPA-878, you'll see the following comment :\n\nSupport default query hint for query timeout as defined in section 3.6.4 of the spec.\nA new hint can be supplied for Java SE and Java EE environments -\njavax.persistence.query.timeout // query timeout in seconds\n\nI looked back through some non-final revisions of the spec, and this property did indeed change from seconds to milliseconds.\n\nThat being said, I'm somewhat afraid to just fix this problem as users of OpenJPA could be unknowingly relying on this behavior(bug). In addition to fixing the bug, I believe that we'll need to add a compatibility switch to support running with javax.persistence.query.timeout as seconds.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=curtisr7","name":"curtisr7","key":"curtisr7","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Richard G. Curtis","active":true,"timeZone":"America/Chicago"},"created":"2014-07-23T12:39:54.887+0000","updated":"2014-07-23T12:39:54.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14071756","id":"14071756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"body":"I have a good understanding of the root of this problem, and also compatibility issues.\n\nI agree with an idea of compatibility switch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2014-07-23T14:05:52.289+0000","updated":"2014-07-23T14:05:52.289+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14071814","id":"14071814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Just to be clear...  We would change the OpenJPA default processing to be compliant with the spec, and introduce the compatibility switch to use the wrong behavior.  I'm sure Rick understood that approach, but I wanted to be clear in the JIRA.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2014-07-23T14:57:32.258+0000","updated":"2014-07-23T14:57:32.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14561358","id":"14561358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"body":"HI!  I've been looking at this issue and running my findings by Rick Curtis.  I'll detail my findings, but basically OpenJPA already converts the query timeout from milliseconds to seconds, so things are working as expected.....I think the expectations in the test are incorrect.\n\nI think we have a couple of issues going on:\n1) We missed the fact that OpenJPA code does actually convert the timeout to seconds (see DBDictionary.setStatementQueryTimeout) so it is not needed as is proposed in the fix attached to this JIRA.\n2) The originator (and those of us initially looking at this JIRA) missed the fact that a 'persist' is used (rather than a query) in the provided test and as such are expecting a query timeout to apply to EM operations.\n\nLet me touch on each of these: First, if you look at TestQueryTimeout [1] you can see that the query timeout is very extensively tested.  So I think this property is tested well and working well.  Next, I found that OpenJPA does convert the timeout from milliseconds to seconds, see here in DBDictionary.setStatementQueryTimeout:\n\n    /**\n     * Allow subclasses to provide DB unique override implementations of\n     * setting query timeouts, while preserving the default timeout logic\n     * in the public setQueryTimeout method.\n     * @param stmnt\n     * @param timeout in milliseconds\n     * @throws SQLException\n     */\n    protected void setStatementQueryTimeout(PreparedStatement stmnt, \n        int timeout) throws SQLException {\n        // JDBC uses seconds, so we'll do a simple round-down conversion here\n        stmnt.setQueryTimeout(timeout / 1000);\n    }\n\n\nGiven this, I decided to run the test sent into this JIRA.  In doing so, it finally hit me that the test is doing a 'persist' while some other thread has locked the same row in the DB.  So the user is  expecting the query timeout to apply to all EM operations.  However, the query timeout should only apply to a query (the spec implies this).  Again, if you look at  TestQueryTimeout, you'll see a test method with comments:\n\n   /**\n     * Scenario being tested: 6) PU Query timeout hints do not affect EM\n     * operations like updating Entities returned by EM.find()/findAll()\n     * Expected Results: The DELAY function is being called and the update\n     * takes 2000+ msecs to complete.\n     */\n    public void testQueryTimeout6() {\n\n\nIn other words, this method verifies that the 'find', which takes longer than the query timeout, doesn't time out.  So I believe the intentions are to not apply the query timeout to EM find, etc.\n\nI can understand the confusion here because the Spec is not 100% clear here.  I think a person needs to read the spec closely on this property.  Let me point out a few entries which imply the query timeout is limited to the Query interface (and queries).  First, the javax.persistence.query.timeout is defined here: \n\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n3.8.9 Query Hints\nThe following hint is defined by this specification for use in query configuration.\n\njavax.persistence.query.timeout // time in milliseconds\n\nThis hint may be used with the Query or TypedQuery setHint method or the NamedQuery and\nNamedNativeQuery annotations. It may also be passed as a property to the Persistence.createEntityManagerFactory\nmethod and used in the properties element of the persistence.\nxml file.\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n\nThis appears to be referred to as the \"query timeout\" throughout the rest of the spec.  Next, If you look at the Query interface (section 3.8.1), it makes reference to a \"query timeout\".....the other hits of \"query timeout\" throughout the spec deal with the Query interface or query operations.  The methods on the EM interface talk about a \"timeout\", but never a \"query timeout\".  \nTo me, this implies that the query.timeout only applies to the Query methods.\n\nFinally, in working with the test of OJ2517, I added a test where a query is used and verified correctness of the query timeout.  The test works as I'd expect for Derby and H2 (I choose H2 because that is the database in use in the original test sent in).  Let me attach my test, named openjpa-querytimeout-working.zip in case someone wants to look at it or try it out.\n\nI propose this JIRA be closed if folks agree with my findings.\n\nThanks,\n\nHeath Thomann\n\n[1] https://fisheye6.atlassian.com/browse/openjpa/branches/2.2.x/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestQueryTimeout.java?r=1244807","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"created":"2015-05-27T17:48:59.409+0000","updated":"2015-05-27T17:48:59.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14591209","id":"14591209","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"body":"Heath, Thank you for a detailed report.\n\nAs you pointed out, I misunderstood that 'javax.persistence.query.timeout' will be applied also in 'EntitiManger.persist' method.\n\nI think that there is no problem with closing this issue.\n\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-06-18T04:13:59.188+0000","updated":"2015-06-18T04:13:59.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14659426","id":"14659426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"body":"OK, I have talked to Rick Curtis and Kevin Sutter about this some more and I have to add some more details and slightly back track.  This post is going to be extremely long, however, I want to add lots of details for history sake.  In this post I'm also going to do something that is probably very unorthodox, and that is I'm going to explain the way EclipseLink (ECL) handles the 'javax.persistence.query.timeout' (QT for short).  I know, I know, I shouldn't mix the two, however it appears that two major JPA providers are incorrectly handling the QT so I think it is worth pointing this out as it may also help to justify our final proposed handling of QT.  :)\n\nI'd suggest the reader read the email I sent to Rick and Kevin for back ground [1].  This email details what OpenJPA is doing wrong when it comes to handling of the QT during a find/update scenario.  Basically OpenJPA does two things wrong:\n\n1) It applies the \"javax.persistence.query.timeout\" value to a find/update (an EM operation).\n2) It uses units of seconds, rather than milliseconds, in the find/update case.\n\nAs I explained back on May 27th, the spec is slightly vague about the application of QT.  But after a careful read, you can see that the QT should NOT apply to EM operations, only Query operations.  Therefore, #1 by OpenJPA (and ECL) is incorrect.  However, given that OpenJPA has applied the QT to EM operations since the inception of QT, we feel it is best to continue to do so.  We do not what to fix this and break all users who may directly or indirectly rely on this.  At some point we could add options to enable/disable this (although OpenJPA does allow a user to disable the QT.....actually this is the default value).   Also keep in mind that the JPA 2.0 and 2.1 specs both point out that the QT is just a hint, and a user should not completely depend on it, so I think there is further wiggle room for interpretation and implementation.  Furthermore, customer's have argued that the QT should apply to all operations; both EM and Query.  IMHO I agree with them.....it seems odd that one can control a timeout for a query, but NOT for an exactly same find/update operation.   \nNext, given that we are not going to change things, we do feel we should address #2.  We do feel we should do as the originator of this JIRA suggested, that is, to properly convert the QT value in 'ConfiguringConnectionDecorator' to milliseconds, from seconds.  The DBDictionary converts the QT from milliseconds to seconds, the 'ConfiguringConnectionDecorator' should follow suite for consistency.\n\n\n[1] Email to Kevin Sutter, Rick Curtis, et al.:\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>EMAIL START>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\nHey Team!  I need help with a likely bug in OpenJPA (and ECL?) with our javax.persistence.query.timeout (QT for short) usage.  I know some of you worked on a QT issue on ECL.....my issue might also apply to ECL.  This issue takes a bit of time to describe so settle in with a cup of coffee or tea.  Basically though the root question is: should the QT apply to a finder+update (EM operation, no Query)?  If so both OJ and ECL have a bug.\nTo start, you could read my details in OJ2517, and look at the test.  But even these details aren't exactly the same as my latest issue.  In the JIRA the user was expecting the QT to apply to a EM.find/update scenario.  In other words, they expected the QT to apply to ALL EM operations.  However, as I explained in the JIRA the QT should only apply to javax.persistence.Query operations......Kevin's email [removed] seemed to back this up, the spec 'implies' this, and the TestQueryTimout test written by Pinaki would seem to offer further proof.  However, I've found a scenario where both OJ and ECL apply the QT to an EM.find/update.  Let me explain exactly what I mean by a 'EM.find/update' by using a code snippet to describe the scenario:\n\nThread 1 (T1) uses JDBC to 'lock' a row with id 1, in a table name Bug, and then sleeps, as follows:\n\nint jdbcDelayTime = 9000;\nConnection conn = .......     \nStatement stmt = conn.createStatement();\nstmt.execute(\"UPDATE Bug set title = 'a' where bugId = 1\");\nSystem.out.println(\"\\nJDBC Thread will now sleep for \" + jdbcDelayTime + \" ms\");\n// emulate long process to hold lock on the row:\nThread.sleep(jdbcDelayTime); \n\nThread 2 (T2) uses JPA to find entity Bug with id=1 and update it while T1 sleeps:\n\nint jpaQueryTimeoutMillis = 6000;\n//The QT is in units of milliseconds as per the spec:\nprops.put(\"javax.persistence.query.timeout\", jpaQueryTimeoutMillis);\n.....\nem.getTransaction().begin();\nBug b = em.find(Bug.class, 1);\nb.setTitle(\"update by find\");            \n//The 'commit' will hang waiting for the lock on the row:\nem.getTransaction().commit();\n\n\nWith this test, you can see that the QT is set to 6000ms and T1 will sleep for 9000ms, in other words T1 will sleep longer than QT.  Because we are doing a find/update the QT will have no effect on the scenario (at least the allusion is it doesn't have an effect, as I'll explain in a moment).  Therefore the outcome is that T2 will wait until it gets the row lock (after about 9000ms) and after it gets the lock it will successfully update the entity.  If on the other hand, you change the find/update to something like the follow, On OpenJPA (but not ECL due to bug Bug 456067 ) would get a query timeout type of exception (QTE) after 6000ms:\n\n            Query q = em.createQuery(\"UPDATE Bug o SET o.title = 'my title' where o.bugId = 1\");\n            q.executeUpdate();            \n            em.getTransaction().commit();\n\nSo, at this time, all is as expected (assume we all agree that the QT should NOT have an effect on the find/update scenario) - expect for ECL in the query case due to Bug 456067 , however if I update the test to take into account ECL uses seconds I can get a QTE in the ECL case, so once ECL fixes the bug all will be the same for OJ and ECL.  \nNext, I will explain why the scenario is giving the \"allusion\" that the find/update is not effected by the QT.  In the above find/update scenario, change 'jdbcDelayTime' from 9000ms to say 9000000ms (i.e. 9000 seconds).  Leave QT at 6000ms.  In this case, we will get a QTE after approx. 6000 seconds.  Yes, 6000 seconds, NOT milliseconds.  In the Query scenario, the results are the same, we'd get a QTE after 6 seconds.  Therefore, for a Query, life is good and the QT is behaving properly.  However, for the find/update scenario, I think we have to ask ourselves two questions:\n\n1) Why is the QT having an effect on the find/update (and should it)?\n2) Why is the QT being treated as seconds, rather than ms, in the find/update case.\n\nFor #1, I won't go into a ton of details at this time since this note is getting so long, but basically 'ConfiguringConnectionDecorator' does a 'setQueryTimeout' during the prepare and create of a statement.  So the timeout would seem to be set on the statement ALWAYS, regardless of whether a query is performed or find/update.  Furthermore, the value is not divided by 1000 (i.e. not converted from ms, to seconds, so the QT value is treated as seconds in this case).  This would explain why there is the 'allusion' that the QT has no effect on a find/update scenario when the QT is larger than the JDBC sleep time in my scenario.....because we *think* we are setting the QT in millis, yet seconds are actually used by the JDBC driver, it seems like the ST has no effect......it is only when the QT is less than the JDBC sleep time that we see the QT does actually have an effect on the find/update case.  Now, in the case of a Query, there are places where we call 'setQueryTimeout' on the Statement a seconds time.  One such place is the JDBCStoreQuery which calls the dictionary which in turn calls 'setQueryTimeout'.  In this case, the QT is divided by 1000 to convert the JPA spec defined QT units of millis to the JDBC expected units of seconds.  Therefore, in the query case, the QT is properly handled (well at least for OJ, not for ECL).    \nIn conclusion, I'd say we have a bug here either way and one of the following options needs to be taken (for OpenJPA): \na) if the QT should not effect the find/update, then we need to detect this path and not call 'setQueryTimeout' in the 'ConfiguringConnectionDecorator'.\nb) If the QT should effect the find/update, then we need to convert from millis to seconds.\n\nPhew.....thoughts?  I'd be glad to discuss this on the phone if that would be easier.\n\nThanks,\n\nHeath\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>EMAIL END>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n\nThanks,\n\nHeath Thomann","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"created":"2015-08-06T03:35:21.516+0000","updated":"2015-08-06T03:35:21.516+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14700486","id":"14700486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"body":"HI!  I'm attaching a test fix which will allow a user to set a property (I've chosen openjpa.jdbc.DBDictionary.allowQueryTimeoutOnFindUpdate) which when set will apply the javax.persistence.query.timeout, in milliseconds, to EntityManager operations.  As I explained in my previous post, today the query.timeout is applied to EM operations in seconds.  Please review and provide feedback.\n\nThanks,\n\nHeath Thomann  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"created":"2015-08-18T00:04:01.710+0000","updated":"2015-08-18T00:04:01.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14727929","id":"14727929","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 1700884 from [~jpaheath] in branch 'openjpa/branches/2.2.x'\n[ https://svn.apache.org/r1700884 ]\n\nOPENJPA-2517: Option to allow the javax.persistence.query.timeout property to apply to EntityManager operations.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-02T20:04:19.493+0000","updated":"2015-09-02T20:04:19.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14727932","id":"14727932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 1700885 from [~jpaheath] in branch 'openjpa/trunk'\n[ https://svn.apache.org/r1700885 ]\n\nOPENJPA-2517: Option to allow the javax.persistence.query.timeout property to apply to EntityManager operations.  Ported 2.2.x changes to trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2015-09-02T20:06:42.927+0000","updated":"2015-09-02T20:06:42.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14940771","id":"14940771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"body":"Hi! I confirmed the commit. No problem. Thank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mskb","name":"mskb","key":"mskb","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Masafumi Koba","active":true,"timeZone":"Asia/Tokyo"},"created":"2015-10-02T05:11:01.997+0000","updated":"2015-10-02T05:11:01.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/14940809","id":"14940809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"body":"Heath, thanks for porting this over to trunk as well. Thus I've added 2.4.1 to the 'fixed in' versions. Could you please add the other branches where you applied this fix as well so we can properly keep track of it in our release notes? txs!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"created":"2015-10-02T06:21:54.486+0000","updated":"2015-10-02T06:21:54.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/15204390","id":"15204390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"body":"HI!  I've recently taken another look at this issue.  I wanted to try to summarize all the comments made so far, and add some clarification.  Basically, there are three issues with OpenJPA's handling of  javax.persistence.query.timeout (QT for short):\n\n1) OpenJPA applies the QT to all EM operations (e.g find/update).\n2) OpenJPA uses seconds as the QT rather than milliseconds in #1.\n3) OpenJPA doesn't round up QT values less than 1000.\n\nIt is explained in previous comments that, as per the JPA Spec, the QT should only apply to Query operations (methods on the Query interface).  Let me be clear and state that OpenJPA does properly apply the QT to Query operations.  There are no issues for Query operations.  The issues here are with the QT being applied to EM operations (#1).  Given the fact that the QT is applied to EM operations when it shouldn't, #2 and #3 are moot.  However, since it was decided not to remove the QT from EM operations because of the risk of regression, #2 and #3 are not consistent with the way the QT is handled for Query operations.  For Query operations, OpenJPA rounds the QT to 1000 if the user sets the QT to a value less than 1000.  Furthermore, for Query operations OpenJPA converts the milliseconds to seconds and passes that value to the JDBC driver since the driver expects units of seconds.  \n\nThe purpose of the fix provider in this JIRA, and the property openjpa.jdbc.DBDictionary.allowQueryTimeoutOnFindUpdate, was to continue to allow #1, but resolve #2 and #3.  In other words, we did not want to run the risk of regressing users by change #1 such that the QT no longer applies to all EM operations.  At a later date, and another JIRA, we could investigate a change to provide a property to fix #1 by restricting the QT to only Query operations.  The fix of this JIRA however fixes #2 and #3 in order to maintain a consistent story between EM operations and Query operations.  In other words, when property openjpa.jdbc.DBDictionary.allowQueryTimeoutOnFindUpdate is set to true, the QT will be converted to milliseconds, and any value less than 1000 will be rounded up to 1000. \n\nFinally, I would like to note that a user can set the QT to 0 to entirely disable the setting of a timeout.  This would disabled the QT for both Query and EM operations.\n\nThanks,\n\nHeath","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpaheath","name":"jpaheath","key":"jpaheath","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heath Thomann","active":true,"timeZone":"America/Denver"},"created":"2016-03-21T14:54:42.794+0000","updated":"2016-03-21T14:54:42.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/16927888","id":"16927888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gshank","name":"gshank","key":"gshank","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gshank&avatarId=22258","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gshank&avatarId=22258","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gshank&avatarId=22258","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gshank&avatarId=22258"},"displayName":"Gary Shank","active":true,"timeZone":"America/Havana"},"body":"This so-called \"fix\" is not working for me. I'm using openjpa-all-2.4.3.jar and if I specify javax.persistence.query.timeout as 3600000 milliseconds (1 hr), my dbinit fails just creating the tables due to timeouts. If I specify the timeout as 3600 seconds (1hr), the dbinit works but other of my regression tests fail with timeouts. If I specify the timeout as seconds AND specify openjpa.jdbc.DBDictionary.allowQueryTimeoutOnFindUpdate=true, the dbinit works but regression tests still fail with timeouts.  I also tried setting the timeout = 1000 with the allowQueryTimeoutOnFindUpdate=true and still no luck.  I'm going to using openjpa-all-3.1.0.jar next but I'm predicting the same results.  All we want is to set the query timeout.  I know 1hr seems ridiculously long but there is a reason for that but even shorter times don't work so it doesn't seem to matter what I set it as.  Please HELP!  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gshank","name":"gshank","key":"gshank","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gshank&avatarId=22258","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gshank&avatarId=22258","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gshank&avatarId=22258","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gshank&avatarId=22258"},"displayName":"Gary Shank","active":true,"timeZone":"America/Havana"},"created":"2019-09-11T18:26:48.480+0000","updated":"2019-09-11T18:26:48.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12727288/comment/16929296","id":"16929296","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gshank","name":"gshank","key":"gshank","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gshank&avatarId=22258","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gshank&avatarId=22258","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gshank&avatarId=22258","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gshank&avatarId=22258"},"displayName":"Gary Shank","active":true,"timeZone":"America/Havana"},"body":"Follow-up:  I tested using openjpa-all-3.1.0.jar and it seems to be working fine when I specify javax.persistence.query.timeout=3600 (seconds).   My dbinit (create tables) still fails if I specify it as 3600000 millis.  I was hoping to get some query timeouts by setting javax.persistence.query.timeout=1 but apparently my database is able to perform all my test queries in less than a second.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gshank","name":"gshank","key":"gshank","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gshank&avatarId=22258","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gshank&avatarId=22258","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gshank&avatarId=22258","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gshank&avatarId=22258"},"displayName":"Gary Shank","active":true,"timeZone":"America/Havana"},"created":"2019-09-13T15:35:45.272+0000","updated":"2019-09-13T15:35:45.272+0000"}],"maxResults":17,"total":17,"startAt":0},"customfield_12311820":"0|i1xrjj:","customfield_12314139":null}}

