{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12371987","self":"https://issues.apache.org/jira/rest/api/2/issue/12371987","key":"OPENJPA-261","fields":{"fixVersions":[],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160589","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312340","id":"12312340","description":"","name":"0.9.7","archived":true,"released":true,"releaseDate":"2007-04-27"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":null,"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311302","id":"12311302","name":"kernel","description":"Kernel"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"201694","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-261/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7aef4046[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@597318aa[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@581ac210[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@196d27f1[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@79fc240c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1b48798f[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@154c32b4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@656ecd43[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d2a59a6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@25f6c38d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@515b9c15[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@424c57a8[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2007-07-20T16:26:01.739+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-261/watchers","watchCount":0,"isWatching":false},"created":"2007-06-19T22:02:35.862+0000","updated":"2007-07-20T16:26:01.735+0000","timeoriginalestimate":null,"description":"While I was testing against the openjpa code, I got an UnsupportedOperationException in the BrokerImpl.endtransaction() method. The method set the transState to an empty Collection if there is no cache for transactions. Later the code got an UnsupportedOperationException.\n\nOriginal code:\n\nCollection transStates = _transCache;\n        if (transStates == null)\n            transStates = Collections.EMPTY_LIST;\n.....\nfor (Iterator itr = transStates.iterator(); itr.hasNext();) {\n            sm = (StateManagerImpl) itr.next();\n            try {\n                if (rollback) {\n                    // tell objects that may have been derefed then flushed\n                    // (and therefore deleted) to un-deref\n                    sm.setDereferencedDependent(false, false);\n                    sm.rollback();\n                } else\n                    sm.commit();\n            } catch (RuntimeException re) {\n                exceps = add(exceps, re);\n            }\n         }\n\nI put a check before this \"for\" loop then the UnsupportedOperationException\ndisappeared.\nif (!transStates.isEmpty()) {   \n        \tfor (Iterator itr = transStates.iterator(); itr.hasNext();) {\n            sm = (StateManagerImpl) itr.next();\n            try {\n                if (rollback) {\n                    // tell objects that may have been derefed then flushed\n                    // (and therefore deleted) to un-deref\n                    sm.setDereferencedDependent(false, false);\n                    sm.rollback();\n                } else\n                    sm.commit();\n            } catch (RuntimeException re) {\n                exceps = add(exceps, re);\n            }\n         }\n        }\nThe NPE.patch is attached to this JIRA. ","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12360293","id":"12360293","filename":"JIAR261_test.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-21T15:38:58.356+0000","size":5144,"mimeType":"application/x-zip-compressed","content":"https://issues.apache.org/jira/secure/attachment/12360293/JIAR261_test.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12360145","id":"12360145","filename":"NPE.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-19T22:04:48.741+0000","size":1249,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12360145/NPE.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12360174","id":"12360174","filename":"OPENJPA-261.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-20T05:52:24.219+0000","size":743,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12360174/OPENJPA-261.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12360175","id":"12360175","filename":"OPENJPA-261-Java5.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-20T05:52:24.339+0000","size":46610,"mimeType":"application/java-archive","content":"https://issues.apache.org/jira/secure/attachment/12360175/OPENJPA-261-Java5.jar"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"UnsupportedOperationException occurred in BrokerImpl.java","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"Window XP","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12506310","id":"12506310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"Patch for OPENJPA-261","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-19T22:04:52.677+0000","updated":"2007-06-19T22:04:52.677+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12506312","id":"12506312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"body":"So you're saying that Collections.EMPTY_LIST.iterator() is returning null? That seems surprising. What version of Java are you using? Can you check if your Java version is returning null from Collecitons.EMPTY_LIST.iterator()?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-19T22:08:38.015+0000","updated":"2007-06-19T22:08:38.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12506371","id":"12506371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clr","name":"clr","key":"clr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clr&avatarId=38583","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clr&avatarId=38583","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clr&avatarId=38583","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clr&avatarId=38583"},"displayName":"Craig L Russell","active":true,"timeZone":"America/Los_Angeles"},"body":"There is still something fishy about the reported symptoms. With an empty collection, the itr.hasNext() will return false, and the for loop will never be executed. So the problem must be further down where the transStates empty collection is being used.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clr","name":"clr","key":"clr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=clr&avatarId=38583","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=clr&avatarId=38583","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=clr&avatarId=38583","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=clr&avatarId=38583"},"displayName":"Craig L Russell","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-20T02:50:44.318+0000","updated":"2007-06-20T02:50:44.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12506401","id":"12506401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"body":"Update from Teresa's email:\n\nSorry it was not NPE, it was UnsupportedOperationException. I had the NPE\nbefore and somehow mixed up with two. Anyway, it caused by :\njava.lang.UnsupportedOperationException: IteratorChains must contain at\nleast one Iterator\n\nThe Collecitons.EMPTY_LIST.iterator() does not return null.\nHere is the exception stack:\n\n4781 emptest TRACE [main] openjpa.Runtime - An exception occurred while\nending the transaction. This exception will be re-thrown.\n\n<0.0.0 nonfatal user error> org.apache.openjpa.util.NoTransactionException:\nCan only perform operation while a transaction is active.\n\nat org.apache.openjpa.kernel.BrokerImpl.assertActiveTransaction(\nBrokerImpl.java:4307)\n\nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(BrokerImpl.java\n:1806)\n\nat org.apache.openjpa.kernel.LocalManagedRuntime.rollback(\nLocalManagedRuntime.java:123)\n\nat org.apache.openjpa.kernel.LocalManagedRuntime.commit(\nLocalManagedRuntime.java:104)\n\nat org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1319)\n\nat org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java\n:869)\n\nat org.apache.openjpa.persistence.EntityManagerImpl.commit(\nEntityManagerImpl.java:409)\n\nat tutorial.ejb.TestEmpsPerClass.main(TestEmpsPerClass.java:135)\n\n4781 emptest TRACE [main] openjpa.Runtime - An exception occurred while\nending the transaction. This exception will be re-thrown.\n\n<0.0.0 nonfatal store error> org.apache.openjpa.util.StoreException:\nIteratorChains must contain at least one Iterator\n\nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(BrokerImpl.java\n:1833)\n\nat org.apache.openjpa.kernel.LocalManagedRuntime.commit(\nLocalManagedRuntime.java:93)\n\nat org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1319)\n\nat org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java\n:869)\n\nat org.apache.openjpa.persistence.EntityManagerImpl.commit(\nEntityManagerImpl.java:409)\n\nat tutorial.ejb.TestEmpsPerClass.main(TestEmpsPerClass.java:135)\n\nCaused by: java.lang.UnsupportedOperationException: IteratorChains must\ncontain at least one Iterator\n\nat\norg.apache.commons.collections.iterators.IteratorChain.checkChainIntegrity(Unknown\nSource)\n\nat org.apache.commons.collections.iterators.IteratorChain.lockChain(Unknown\nSource)\n\nat org.apache.commons.collections.iterators.IteratorChain.hasNext(Unknown\nSource)\n\nat org.apache.openjpa.kernel.BrokerImpl.endTransaction(BrokerImpl.java:2196)\n\nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(BrokerImpl.java\n:1809)\n\n... 5 more\n\n<0.0.0 fatal store error> org.apache.openjpa.persistence.RollbackException:\nIteratorChains must contain at least one Iterator\n\nat org.apache.openjpa.persistence.EntityManagerImpl.commit(\nEntityManagerImpl.java:420)\n\nat tutorial.ejb.TestEmpsPerClass.main(TestEmpsPerClass.java:135)\n\nCaused by: <0.0.0 nonfatal general error>\norg.apache.openjpa.persistence.PersistenceException: IteratorChains must\ncontain at least one Iterator\n\nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(BrokerImpl.java\n:1833)\n\nat org.apache.openjpa.kernel.LocalManagedRuntime.commit(\nLocalManagedRuntime.java:93)\n\nat org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1319)\n\nat org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java\n:869)\n\nat org.apache.openjpa.persistence.EntityManagerImpl.commit(\nEntityManagerImpl.java:409)\n\n... 1 more\n\nCaused by: java.lang.UnsupportedOperationException: IteratorChains must\ncontain at least one Iterator\n\nat\norg.apache.commons.collections.iterators.IteratorChain.checkChainIntegrity(Unknown\nSource)\n\nat org.apache.commons.collections.iterators.IteratorChain.lockChain(Unknown\nSource)\n\nat org.apache.commons.collections.iterators.IteratorChain.hasNext(Unknown\nSource)update different fields\n\nat org.apache.openjpa.kernel.BrokerImpl.endTransaction(BrokerImpl.java:2196)\n\nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(BrokerImpl.java\n:1809)\n\n... 5 more\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-20T05:40:12.352+0000","updated":"2007-06-20T05:40:12.352+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12506402","id":"12506402","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"body":"So I saw exactly this problem a few days ago, and fixed the code that was leading to the IteratorChain problem. Upon doing so, I just ended up uncovering a new problem.\n\nAttached is a patch that gets past this exception; I expect that you will just get a new exception, probably about the managed cache being corrupt. Can you try it out?\n\nThe jar contains a a compiled version of the patch; because of some other changes that I'm working on in my environment, the jar has a dependency on Java 5; if you are still using JDK1.4, you'll need to manually apply the patch (or convince another OpenJPA developer to do so, and post the jar). If you are using Java 5, just put the jar in the front of your classpath, or update the contents of openjpa.jar with the classes listed in the jar.\n\nAlso, can you describe what your test case is doing, or better yet, attach your test case to this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pcl","name":"pcl","key":"pcl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrick Linskey","active":true,"timeZone":"America/Los_Angeles"},"created":"2007-06-20T05:52:24.377+0000","updated":"2007-06-20T05:52:24.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12506936","id":"12506936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"Patrick,\nAfter I applied your changes and I got the NPE in your changes:\n\nif ((_dirty == null || _dirty.isEmpty() \n&& \n_clean == null || _clean .isEmpty())) \n\n\nException in thread \"main\" <0.0.0 fatal store error> \n\norg.apache.openjpa.persistence.RollbackException : null \nat org.apache.openjpa.persistence.EntityManagerImpl.commit(\n\nEntityManagerImpl.java:420) \nat tutorial.ejb.TestEmpsPerClass.main(\n\nTestEmpsPerClass.java:56) \nCaused by: <0.0.0 nonfatal general error> \n\norg.apache.openjpa.persistence.PersistenceException: null \nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(\n\nBrokerImpl.java:1834) \nat org.apache.openjpa.kernel.LocalManagedRuntime.commit(\n\nLocalManagedRuntime.java:93) \nat org.apache.openjpa.kernel.BrokerImpl.commit(\n\nBrokerImpl.java:1320) \nat org.apache.openjpa.kernel.DelegatingBroker.commit(\n\nDelegatingBroker.java:869) \nat org.apache.openjpa.persistence.EntityManagerImpl.commit(\n\nEntityManagerImpl.java:409) \n... 1 more\n\nCaused by: \n\njava.lang.NullPointerException \nat org.apache.openjpa.kernel.BrokerImpl$TransactionalCache.iterator(\n\nBrokerImpl.java:4691) \nat org.apache.openjpa.kernel.BrokerImpl.endTransaction(\n\nBrokerImpl.java:2194) \nat org.apache.openjpa.kernel.BrokerImpl.afterCompletion(\n\nBrokerImpl.java:1810) \n- Show quoted text -\n\nI attached the testcase JIAR261_test.zip file here.\n \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-21T15:38:42.186+0000","updated":"2007-06-21T15:40:12.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12371987/comment/12514235","id":"12514235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"It seems to me that the bug was fixed in the recent OPENJPA build. So close this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-07-20T16:26:01.725+0000","updated":"2007-07-20T16:26:01.725+0000"}],"maxResults":7,"total":7,"startAt":0},"customfield_12311820":"0|i0yw8v:","customfield_12314139":null}}

