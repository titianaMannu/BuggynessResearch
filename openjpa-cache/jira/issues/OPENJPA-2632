{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12946975","self":"https://issues.apache.org/jira/rest/api/2/issue/12946975","key":"OPENJPA-2632","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12334871","id":"12334871","description":"OpenJPA-2.4.2","name":"2.4.2","archived":false,"released":true,"releaseDate":"2017-01-03"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332295","id":"12332295","description":"OpenJPA 2.4.1","name":"2.4.1","archived":false,"released":true,"releaseDate":"2016-02-21"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2632/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@78214c4e[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5f4c2a73[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1be8cf05[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@25c971b9[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@17d30f40[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3344633b[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6e0902b1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@a3f270[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f05442b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1fc8b34b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@39f22689[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@265d63b5[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2016-03-14T21:58:08.441+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2632/watchers","watchCount":6,"isWatching":false},"created":"2016-03-04T13:42:04.186+0000","updated":"2017-01-03T07:37:36.989+0000","timeoriginalestimate":null,"description":"in my case i'm using an ear with multiple war files.\n\nthe entities are located in ear/lib and my select new result class and the service which loads it are located in a war (doesn't matter if in WEB-INF/lib or WEB-INF/classes)\n\nopenJPA uses the CL stored in QueryImpl but this one can not load my class.\n\nimo if the class can not be loaded with the stored class loader, we can try to use the TCCL to load the class.","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12792483","id":"12792483","filename":"OPENJPA-2632.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-10T10:15:30.973+0000","size":6835,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12792483/OPENJPA-2632.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"select new not working if result class is not in same classloader","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15179891","id":"15179891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user rsandtner opened a pull request:\n\n    https://github.com/apache/openjpa/pull/4\n\n    OPENJPA-2632 use TCCL as fallback\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/rsandtner/openjpa OPENJPA-2632\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/openjpa/pull/4.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #4\n    \n----\ncommit b44db2f7754c785da44f084849e7caac9ff216e9\nAuthor: rsandtner <rsandtner@apache.org>\nDate:   2016-03-04T13:44:25Z\n\n    OPENJPA-2632 use TCCL as fallback\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-04T13:47:14.710+0000","updated":"2016-03-04T13:47:14.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15179906","id":"15179906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"pull request is also available here https://github.com/apache/openjpa/pull/4\npatch was made with git\n\ni've no idea how to add a unit test for this issue. you can reproduce the issue with https://github.com/struberg/was_bugs/tree/master/was_bug19\n\n{{mvn clean install tomee:run}} in was_bug19_ear\nbrowse to http://localhost:8080/was_bug19\nclick 'Insert Data' -> 1000 entries will be inserted\nclick the 'Load Data' -> kawumm...\n\nafter appliing the patch just do the same with {{-Dopenjpa.version=2.4.2-SNAPSHOT}} and it should work","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-04T13:57:45.039+0000","updated":"2016-03-04T13:57:45.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15179911","id":"15179911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"[~rsandtner]not sure i get it, if entities are in a parent classloader it should work.Falling back on tccl can create a mess in OSGi and it shoudlnt be done since the broker should be limited to one classloader and not drag all classes (suppose you have 2 wars with the same class names)\n\nTo add a test propably just create a hierarchic classloader (you can take batchee url class loader first impl).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-04T14:01:52.333+0000","updated":"2016-03-04T14:01:52.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15180260","id":"15180260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"[~rmannibucau] my problem is, that the class for my 'select new' can not be found by the CL stored in query impl. {{Strings.toClass(name, _loader)}} blows up with a {{ClassNotFoundException}} which is catched away by {{catch (Throwable t)}} and wrapped in an {{IllegalArgumentException(t.toString())}}.\n\nmissed to write the exact problem in the issue description... \n\nbut of course i think the fallback in the provided patch is in the wrong place... maybe it is better to load the result class from TCCL as fallback where we try to find the constructor in {{JPQLExpressionBuilder}}? and if that fails too, then throw the 'no-constructor' exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-04T17:56:23.554+0000","updated":"2016-03-04T17:56:23.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15180322","id":"15180322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"[~rsandtner] can you try to describe or draw the classloader hierarchy you have (making explicit where is the entity and the broker classloaders). I understand you do a em.createxxxQuery(..., Foo.class) with Foo in WEB-INF/* and em in lib/META-INF/persistence.xml so it sounds normal it fails. Do I miss something?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-04T18:27:53.732+0000","updated":"2016-03-04T18:27:53.732+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182720","id":"15182720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"hey,\n\nmy ear looks like this (simplified for the sample - see also https://github.com/struberg/was_bugs/tree/master/was_bug19)\n\n{noformat}\near\n| - lib\n|    | - myjar\n|    |      | - TheEntity.class\n|    |      | - persistence.xml\n| - mywar\n|    | - WEB-INF\n|    |      | - classes\n|    |      |      | - Result.class\n|    |      |      | - ServiceUsingResult.class\n{noformat}\n\nas i understand, the entity gets loaded via the ear-CL and this did not know the {{Result.class}}. i've not found any restrictions in the spec that the result class must be in the same classloader as the entity. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-07T07:56:18.644+0000","updated":"2016-03-07T07:56:18.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182758","id":"15182758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"[~rsandtner] you are right no restriction but it is an open door to leak - in particular with the enhancement the spec implies in some cases. What about adding your patch if a flag is set in the persistence unit properties? If not set or false then keep current behavior, if set to true use your patch. wdyt?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-07T08:47:06.405+0000","updated":"2016-03-07T08:47:06.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182776","id":"15182776","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"[~rmannibucau] sounds good... but let me try to resolve the class via TCCL only for {{select new}}. i think this way it is more secure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-07T09:01:47.495+0000","updated":"2016-03-07T09:01:47.495+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182841","id":"15182841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"[~rmannibucau] can you take a look to the second patch pls.\n{{OPENJPA-2632_onlySelectNew.patch}}\n\nbut this one neither makes me happy - maybe you have a better idea?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-07T10:19:42.431+0000","updated":"2016-03-07T10:19:42.431+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182848","id":"15182848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"Think the flag is a good compromise (in particular cause openjpa is used in OSGi). Also take care Thread.currentThread().getContextClassLoader() can be null and IIRC openjpa has a utility method for that going through security manager if needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-07T10:22:28.418+0000","updated":"2016-03-07T10:22:28.418+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182969","id":"15182969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"[~rmannibucau] can you pls take a another look if the 'fix' is acceptable now? https://github.com/rsandtner/openjpa/tree/OPENJPA-2632","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-07T12:58:53.461+0000","updated":"2016-03-07T12:58:53.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182974","id":"15182974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"looks good","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-07T13:01:07.267+0000","updated":"2016-03-07T13:01:07.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15182985","id":"15182985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"body":"what is the next step now? pull request or a patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsandtner","name":"rsandtner","key":"rsandtner","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Reinhard Sandtner","active":true,"timeZone":"Europe/Vienna"},"created":"2016-03-07T13:16:59.566+0000","updated":"2016-03-07T13:16:59.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15193525","id":"15193525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"body":"+1 looks good.\n\nSmallish things to check:\n\n+                        if (System.getSecurityManager() == null) {\n\nshouldn't that be != null? \n\nWe also need to add the new flag to our documentation openjpa.option.UseTCCLinSelectNew","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-14T16:03:37.657+0000","updated":"2016-03-14T16:03:37.657+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15193649","id":"15193649","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 1734966 from [~struberg] in branch 'openjpa/trunk'\n[ https://svn.apache.org/r1734966 ]\n\nOPENJPA-2632 fallback to TCCL for select new if class cannot be found\n\nThat might happen if the entities are loaded within a shared ear lib\nbut the actual \"select new\" is performed from another ClassLoader (e.g. WAR)\nContributed by Reinhard Sandtner (apacheId: rsandtner). Txs for the patch!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-14T17:07:39.286+0000","updated":"2016-03-14T17:07:39.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15194232","id":"15194232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"body":"patch applied, txs Reinhard!\nWill just add some docs for it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"created":"2016-03-14T21:58:08.490+0000","updated":"2016-03-14T21:58:08.490+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15196936","id":"15196936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit 1735190 from [~struberg] in branch 'openjpa/trunk'\n[ https://svn.apache.org/r1735190 ]\n\nOPENJPA-2632 add documentation for the new UseTCCLinSelectNew config switch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2016-03-16T07:27:10.527+0000","updated":"2016-03-16T07:27:10.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12946975/comment/15794422","id":"15794422","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ilgrosso","name":"ilgrosso","key":"ilgrosso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ilgrosso&avatarId=13240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ilgrosso&avatarId=13240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ilgrosso&avatarId=13240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ilgrosso&avatarId=13240"},"displayName":"Francesco Chicchiriccò","active":true,"timeZone":"Europe/Rome"},"body":"Bulk close for 2.4.2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ilgrosso","name":"ilgrosso","key":"ilgrosso","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ilgrosso&avatarId=13240","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ilgrosso&avatarId=13240","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ilgrosso&avatarId=13240","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ilgrosso&avatarId=13240"},"displayName":"Francesco Chicchiriccò","active":true,"timeZone":"Europe/Rome"},"created":"2017-01-03T07:37:36.918+0000","updated":"2017-01-03T07:37:36.918+0000"}],"maxResults":18,"total":18,"startAt":0},"customfield_12311820":"0|i2u5nr:","customfield_12314139":null}}

