{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"13383264","self":"https://issues.apache.org/jira/rest/api/2/issue/13383264","key":"OPENJPA-2876","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12350116","id":"12350116","description":"","name":"3.2.1","archived":false,"released":false}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"9223372036854775807","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12338127","id":"12338127","description":"OpenJPA-3.0.0 (first JPA-2.1 spec release)","name":"3.0.0","archived":false,"released":true,"releaseDate":"2018-06-12"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311310","id":"12311310","name":"sql","description":"Issues to do with SQL, including generation of SQL. Issues that have to do with JDBC (i.e., execution of SQL statements and result set processing) should be filed in the jdbc component."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2876/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@f6b9233[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d331c8[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@40ff961[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1fc9c559[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2e024a74[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@495e87eb[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3261ab50[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@63d34348[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5f3ef4ac[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6262517f[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5d665d48[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@24568caf[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2021-06-16T11:02:05.766+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-2876/watchers","watchCount":3,"isWatching":false},"created":"2021-06-10T18:54:23.047+0000","updated":"2021-06-16T11:02:05.837+0000","timeoriginalestimate":null,"description":"Seems we trashed the SQL refresh feature along the way to JPA-2.0.\r\n\r\nI have a sample with an Entity 'Customer' with just an ID.  Then I add a column {{OTHER_NAME}} and generate the result with {{sqlAction=refresh}}\r\n\r\nIn OpenJPA-2.4.3 we get the following output:\r\n{noformat}\r\nALTER TABLE CUSTOMER ADD COLUMN OTHER_NAME VARCHAR(255);\r\n{noformat}\r\n\r\nIn OpenJPA-3.0.0 onwards we get this:\r\n{noformat}\r\nALTER TABLE CUSTOMER ADD COLUMN OTHER_NAME VARCHAR(255);\r\nCREATE TABLE CUSTOMER (ID BIGINT NOT NULL, active VARCHAR(1), OTHER_NAME VARCHAR(255), specialCustomer VARCHAR(1) NOT NULL, PRIMARY KEY (ID));\r\nCREATE TABLE OPENJPA_SEQUENCE_TABLE (ID TINYINT NOT NULL, SEQUENCE_VALUE BIGINT, PRIMARY KEY (ID));\r\nCREATE TABLE PUBLIC.CUSTOMER (ID BIGINT, ACTIVE VARCHAR(1), NAME VARCHAR(255), SPECIALCUSTOMER VARCHAR(1));\r\n{noformat}\r\n\r\nIt seems like we do not only run the MappingAction 'refresh' but also a 'build' plus we do it also without Schema and with the current Schema (PUBLIC).","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"running 'refresh' schema action creates wrong SQL output","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/13383264/comment/17361204","id":"17361204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"body":"git-bisect tells us it was commit af8ea38f87a778401ca1c679f7087d3a0d5a52cc\r\n OPENJPA-2554 JPA 2.1 - Schema Generation","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=struberg","name":"struberg","key":"struberg","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=struberg&avatarId=41313","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=struberg&avatarId=41313","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=struberg&avatarId=41313","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=struberg&avatarId=41313"},"displayName":"Mark Struberg","active":true,"timeZone":"Europe/Berlin"},"created":"2021-06-10T20:09:02.832+0000","updated":"2021-06-10T20:09:02.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13383264/comment/17361218","id":"17361218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"body":"[~struberg] guess it is the `if (_writer == null)` tests which should get removed since it is handled in the impl and shouldn't be an issue until new code expected a writer which is a bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=romain.manni-bucau","name":"romain.manni-bucau","key":"romain.manni-bucau","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=romain.manni-bucau&avatarId=18453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romain.manni-bucau&avatarId=18453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romain.manni-bucau&avatarId=18453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romain.manni-bucau&avatarId=18453"},"displayName":"Romain Manni-Bucau","active":true,"timeZone":"Europe/Berlin"},"created":"2021-06-10T20:39:55.240+0000","updated":"2021-06-10T20:39:55.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13383264/comment/17364237","id":"17364237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit f8d258594f55cdf06db16f2321a6ae6c6342616e in openjpa's branch refs/heads/master from Mark Struberg\n[ https://gitbox.apache.org/repos/asf?p=openjpa.git;h=f8d2585 ]\n\nOPENJPA-2876 unit test to show wrong SQL\n\nsqlAction=refresh right now also generates the full DB.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2021-06-16T11:01:49.495+0000","updated":"2021-06-16T11:01:49.495+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/13383264/comment/17364238","id":"17364238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"body":"Commit c6f42826b72940aa771a394d42173b2f7fec0428 in openjpa's branch refs/heads/master from Mark Struberg\n[ https://gitbox.apache.org/repos/asf?p=openjpa.git;h=c6f4282 ]\n\nOPENJPA-2876 fix schema 'refresh'\n\nAlso had to fix the schema handling via persistence.xml.\nThinkfully this section has excellent unit test coverage.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","key":"jira-bot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true,"timeZone":"Etc/UTC"},"created":"2021-06-16T11:01:50.977+0000","updated":"2021-06-16T11:01:50.977+0000"}],"maxResults":4,"total":4,"startAt":0},"customfield_12311820":"0|z0rutk:","customfield_12314139":null}}

