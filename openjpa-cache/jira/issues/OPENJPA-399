{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12380120","self":"https://issues.apache.org/jira/rest/api/2/issue/12380120","key":"OPENJPA-399","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312687","id":"12312687","description":"","name":"1.0.1","archived":false,"released":true,"releaseDate":"2007-11-09"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160721","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312687","id":"12312687","description":"","name":"1.0.1","archived":false,"released":true,"releaseDate":"2007-11-09"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12322765","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322765","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12411111","key":"OPENJPA-842","self":"https://issues.apache.org/jira/rest/api/2/issue/12411111","fields":{"summary":"Handling of default schema","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"204165","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-399/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4f00ebc4[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4ca99328[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2c20d758[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2c903127[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@41d0a571[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@17463b5c[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3df6b4fb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@10c2a36b[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@547d772f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@72c73a27[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7a1e09e8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7fc2343b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2007-12-13T15:10:08.343+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-399/watchers","watchCount":0,"isWatching":false},"created":"2007-10-10T22:48:18.740+0000","updated":"2010-03-09T18:32:40.717+0000","timeoriginalestimate":null,"description":"Two entities have the same table name but with different schema, only one table is created. In addition, when two entities use the generatedType.AUTO for ID, only one OPENJPA_SEQUENCE-TABLE is created.\n\nThe problem due to the SchemaGroup.findTable() which only looked for a table name from all the schemas. Once the table was found in one of the schema then it exited and assumed that the table existed. Same problem in the TableJDBCSeq.addSchema().\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12367669","id":"12367669","filename":"OPENJPA_399.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-12T23:05:30.218+0000","size":39390,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12367669/OPENJPA_399.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12367906","id":"12367906","filename":"OPENJPA-399_2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-17T20:57:57.202+0000","size":3917,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12367906/OPENJPA-399_2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12368612","id":"12368612","filename":"OPENJPA-399_3.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-29T17:04:02.782+0000","size":3739,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12368612/OPENJPA-399_3.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"openjpa did not handle multiple schema names with same table name","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"JDK1.5, OPENJPA verison 580425","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12533899","id":"12533899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"Example of the problem:\n@Entity(name=\"Dog\")\n@Table(name=\"DOGTAB\")\n\n@IdClass(DogId.class)\npublic class Dog implements Serializable\n\t\n{\n\t@Id\n                     @GeneratedValue(strategy=GenerationType.AUTO)\n\tprivate int id2;\n..\n)\n\n@Entity(name=\"Dog2\")\n@Table(name=\"DOGTAB\")\n\n@IdClass(DogId.class)\npublic class Dog2 implements Serializable\n\t\n{\n\t@Id\n\t@GeneratedValue(strategy=GenerationType.AUTO)\n\tprivate int id2;\n..\n)\n\nAlthough the datasource uses different schema name, openjpa only created one table for DOG but not DOG2.\n\n\nThe current architecture based on the following assumption: \nEach PU has one JDBCConfiguration, each JDBCConfiguration has only one SeqValue and one TableJDBCSeq instance. These are singletons. During the JDBCConfiguration instantate phase, the TableJDBCSeq was created and setup the default schema. At this point, there was no correlation between the actual schema with the table and with the entity class. Each entity class has the SchemaGroup which contains all the schemas within this PU, but you can tell which schema is used for this entity. \n\nThe ultimate solution is to change the JDBCConfiguration to know the entity and its schema info at the instantiation phase. Then makes the seqValue and TableJDBCSeq as singleton for each schema. I tried to figure out how to make it work but failed. I can't find any correlation between entity, schema and table name at the configuration instantiation phase.. ..\n\nMy current solution is  based on the current architecture and fix it in the TableJDBCSeq and NativeJDBCSeq. Since the TableJDBCSeq /NativeJDBCSeq is a singleton, so I put the logic to add the seq table name for each schema for this SchemaGroup.. Then during the Insert and Update the seq table, the table name will be fully quality with the schema name, so we can insert to the correct seq table.. \n\nThere are some restrictions for using multiple schemas for the same table name that we need to document:\n\n1) If multiple entities have the same table name,  then they must be qualified with the schema name either thru the annotation or xml mapping. If one of entity does not have a schema and one entity has a schema, it still fails when the application executes again.\n2) If multiple entities have the generatedType.AUTO, SEQUENCE, TABLE for ID and using the same table name, then each entity must have the schema name.\n3) For those entities which have its unique table name within the PU, then the schema name is not required even though the entity using the generatedType of AUTO, SEQUENCE and TABLE. -- this is today's implementation.\n\nFor the generatedType.SEQUENCE, if multiple entities use different scehmas for the same table and the sequence generator are the same, then only one sequence  is created and is used for all the entities. However, if each entity has its own sequence generator, then each generator will have its own sequence. For example,\n@Entity(name=\"Dog\")\n@Table(name=\"DOGTAB\", schema=\"DB2ADMIN\")\n\n@IdClass(DogId.class)\npublic class Dog implements Serializable\n\t\n{\n\t@Id\n\t@SequenceGenerator(name=\"myseq\",sequenceName=\"order_seq2\")\n\t@GeneratedValue(strategy=GenerationType.SEQUENCE,generator=\"myseq\")\n\tprivate int id2;\n..\n)\n\n@Entity(name=\"Dog2\")\n@Table(name=\"DOGTAB\", schema=\"TWC\")\n\n@IdClass(DogId.class)\npublic class Dog2 implements Serializable\n\t\n{\n\t@Id\n\t@SequenceGenerator(name=\"mysequence\",sequenceName=\"order_seq9\")\n\t@GeneratedValue(strategy=GenerationType.SEQUENCE,generator=\"mysequence\")\n\tprivate int id2;\n..\n)\nThe output will be like this:\nexecuting prepstmnt 538058770 VALUES NEXTVAL FOR order_seq2\nexecuting prepstmnt 1078214724 VALUES NEXTVAL FOR order_seq9\n\nthe id values are :\nafter find, dog1 id2  = 425 and dog name =helloDog\nafter find, dog11 id2  = 426 and dog name =helloDog1a\nafter find, dog3 id2  = 5 and dog name =helloDog2\nafter find, dog31 id2  = 6 and dog name =helloDog2a\n\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-10T23:08:50.432+0000","updated":"2007-10-10T23:08:50.432+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12533900","id":"12533900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"attach the patch..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-10T23:10:09.751+0000","updated":"2007-10-10T23:10:09.751+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12534056","id":"12534056","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Teresa,\nI haven't reviewed your patch yet, but I'd like to get some clarification on the problem first...\n\n>  Although the datasource uses different schema name, openjpa only created one table for DOG but not DOG2.\n\nIt seems that your code example is dependent on another configuration somewhere.  Either a persistence.xml or orm.xml that would differentiate the schema name.  Is that correct?  Your text mentions a \"datasource uisng a different schema name\", but I'm not sure what you meant by that.  Basically, you are saying that attempting to use the same table with different schemas causes a problem because we are currently not differentiating between tables with different schemas.  Right?\n\n>  2) If multiple entities have the generatedType.AUTO, SEQUENCE, TABLE for ID and using the same table name, then each entity must have the schema name.\n\nNot sure I follow this.  Are you stating the use of different schemas is an absolute requirement for id generation?  Or, only if you are interested in keeping the id generations separate from each other?  I'm trying to figure out what limitations exist under what conditions.\n\nAnd, your last example with multiple sequence generators...  Did you have to change something to allow this to work?  This sounds like normal, expected behavior.  Did you fix something in this area?\n\nFinally, as part of the patch, it sounds like you are suggesting some documentation updates.  Are you going to include the necessary documentation updates to clarify these restrictions?  Since it sounds like we are totally broke with some of these scenarios, I'm okay with fixing the problem(s) with documentation updates.  But, I don't want to fix something without documenting how it's supposed to work for our customers.  Or, how we can make it work for our customers.\n\nI'll take a look at your patch next, but I wanted to get started with these questions.\n\nThanks,\nKevin\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-10-11T14:41:08.861+0000","updated":"2007-10-11T14:41:08.861+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12534167","id":"12534167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"attach 2nd patch and test case:\n1) I removed the NativeJDBCSeq code since it worked as design.\n2) Include the documentation changes in the OpenJPA manaual and Ref guide\n3) inlcude the test case","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-11T21:39:44.450+0000","updated":"2007-10-11T21:39:44.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12534211","id":"12534211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Comments on the patches...  Overall, the concept and logic looks good.  I just have a few questions/comments about the proposed code changes.  Ping me if you have any questions on my abbreviated comments.  Thanks.\n\no  The restriction about requiring schema names for all tables if you use schema names for at least one of the entities using the same table name...  I'm okay with this restriction, but is there anyway that we could detect this condition?  That is, if we detect the use of a \"null\" schema with other existing schema names, couldn't we flag this a configuration error?\n\no  Any updated patches should be attached to the Issue with the same name.  JIRA keeps track of the older versions automatically, so you don't have to continually add a \"version number\" to your patch files.\n\no  The testcases should be provided as part of the patch file.  Makes it much easier to merge the new files into an existing project.  It also removes the confusion with different project names (ie. openjpa10x_2 doesn't match my project name).\n\no  The testcases need the Apache licensing...  :-)  Take a look, you'll understand.\n\no  In TableJDBCSeq, the getStatus method updates are interesting.  So, the previous implementation of this method didn't act on the input parameter at all?  That's strange.  Also, the javadoc for this method indicates that the input parameter (mapping) could be null.  Is it okay for your code to use \"null\" as a key for the HashMap?\n\no  In that same file, why not just initialize _stat to the new HashMap() (similar to the original \"new Status()\")?  And, the original declaration was final.  If you use an initializer, couldn't we go back to the \"final\" declaration?  Maybe I'm missing the reasons for your current _stat initialization.\n\no  In the addSchema() method, there's no longer a \"fast path\" return conditional at the beginning of the method.  Isn't there any means of bypassing all of the processing if the table/schema already exists?\n\no  I'm not following your code at the end of the addSchema() method with the \"Index idx\" processing.  It looks like this index processing is a side-effect of calling addSchema().  Is that your intent?  At a minimum, this requires additional comments, but maybe it requires some re-factoring to make this clearer.\n\no  The processing of generating the tableName is repeated in at least three areas of TableJDBCSeq.  Could a common utility method be used instead so as not to repeat the code?\n\no  I don't understand the comments for Column.resetTableName().  Doesn't \"reset\" mean to modify an existing set, yet the comment indicates that this can only be called on columns without a table set.\n\no  The cleanup in LocalConstraint.addColumn() looks good.\n\no  The logic in SchemaGroup.findTable and SchemaGroup.findSequence seems to be very close.  Can any of this code be shared in a private utility method?\n\nThat's it,\nKevin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-10-12T03:29:32.009+0000","updated":"2007-10-12T03:29:32.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12534409","id":"12534409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"Kevin,\nThanks for the comments. I fixed the code based on your comments. However, I can't determine the configuration error because I can't tell whether the null schema is valid or not. \n\nFor the question about HashMap, yes, HashMap can handle the null key . Here is the info from java doc:\n\"Hash table based implementation of the Map interface. This implementation provides all of the optional map operations, and permits null values and the null key\"\n\nFor the last question about the logic in SchemaGroup.findTable and findSequence. It is not necessary to combine them together since they have different return object. Instead of adding more checking in a common method, the current way may be ok..\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-12T21:17:43.127+0000","updated":"2007-10-12T21:17:43.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12534411","id":"12534411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"attach final patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-12T21:22:10.780+0000","updated":"2007-10-12T21:22:10.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12535400","id":"12535400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"I discovered another problem in GeneratedType.Sequence. If the entity did not declare a schema name  and the table name was unique, the sequence was created successfully the first time. However, when I ran the test again, it can't find the sequence.  \nSince the sequence name is unique within a system, therefore, we can let all sequences create in the default schema. IN this case, we can use the null schema name to search the sequences from the db. The fix will be :\n\nIndex: openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaGenerator.java\n===================================================================\n--- openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaGenerator.java\t(revision 585254)\n+++ openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaGenerator.java\t(working copy)\n@@ -819,8 +819,10 @@\n         if (_log.isTraceEnabled())\n             _log.trace(_loc.get(\"gen-seqs\", schemaName, sequenceName));\n \n+        // since all the sequences are generated under the default schema\n+        // therefore, we can use the null schemaname to search\n         Sequence[] seqs = _dict.getSequences(meta, conn.getCatalog(),\n-            schemaName, sequenceName, conn);\n+            null, sequenceName, conn);\n \n         SchemaGroup group = getSchemaGroup();\n         Schema schema;\nIndex: openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java\n===================================================================\n--- openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java\t(revision 585254)\n+++ openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java\t(working copy)\n@@ -94,7 +94,7 @@\n             \"LONG VARCHAR FOR BIT DATA\", \"LONG VARCHAR\", \"LONG VARGRAPHIC\",\n         }));\n         systemSchemas = new String(\n-                \"SYSCAT, SYSIBM, SYSSTAT, SYSIBMADM, SYSTOOLS\");\n+                \"SYSCAT,SYSIBM,SYSSTAT,SYSIBMADM,SYSTOOLS\");\n         maxConstraintNameLength = 18;\n         maxIndexNameLength = 18;\n         maxColumnNameLength = 30;\nIndex: openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java\n===================================================================\n--- openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java\t(revision 585254)\n+++ openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java\t(working copy)\n@@ -3341,7 +3341,7 @@\n         try {\n             int idx = 1;\n             if (schemaName != null)\n-                stmnt.setString(idx++, schemaName);\n+                stmnt.setString(idx++, schemaName.toUpperCase());\n             if (sequenceName != null)\n                 stmnt.setString(idx++, sequenceName);\n \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-17T04:01:59.894+0000","updated":"2007-10-17T04:01:59.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12535741","id":"12535741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"There was another problem occurred in SQLServer that the dict.getColumns() can't find the table names because openjpa alway convert the table name to upper case. The table name is case sensive on SQLServer, therefore, no tables are found. Openjpa created the tables again and failed with duplicate tables.\n\nThe fix will introduce a getSchemaCase() method on DBDictionary. SQLServerDictionary overrides this method to return the SCHEMA_CASE_PERSERVE.\n\nOriginal code in  DBDictionary on the convertSchemaCase :\n protected String convertSchemaCase(String objectName) {\n        if (objectName == null)\n            return null;\n\n        if (SCHEMA_CASE_LOWER.equals(schemaCase))\n            return objectName.toLowerCase();\n        if (SCHEMA_CASE_PRESERVE.equals(schemaCase))\n            return objectName;\n        return objectName.toUpperCase();\n    }\n\nFix will be :\n\n protected String convertSchemaCase(String objectName) {\n        if (objectName == null)\n            return null;\n\n        String scase = getSchemaCase();\n        if (SCHEMA_CASE_LOWER.equals(scase))\n            return objectName.toLowerCase();\n        if (SCHEMA_CASE_PRESERVE.equals(scase))\n            return objectName;\n        return objectName.toUpperCase();\n    }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-17T20:57:57.338+0000","updated":"2007-10-17T20:57:57.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12538538","id":"12538538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"We only need to create the index for the OPENJPA_SEQUENCE_TABLE for DB2/ZOS only. Therefore, move the index creation code to the DB2Dictionary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-10-29T16:28:43.000+0000","updated":"2007-10-29T16:28:43.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12380120/comment/12551530","id":"12551530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"body":"Problem has been resolved","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tckan1","name":"tckan1","key":"tckan1","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Teresa Kan","active":true,"timeZone":"Etc/UTC"},"created":"2007-12-13T15:10:08.156+0000","updated":"2007-12-13T15:10:08.156+0000"}],"maxResults":11,"total":11,"startAt":0},"customfield_12311820":"0|i0zbhz:","customfield_12314139":null}}

