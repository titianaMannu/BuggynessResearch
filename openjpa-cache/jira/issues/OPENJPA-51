{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12350212","self":"https://issues.apache.org/jira/rest/api/2/issue/12350212","key":"OPENJPA-51","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312969","id":"12312969","description":"","name":"1.0.3","archived":false,"released":true,"releaseDate":"2008-07-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313102","id":"12313102","description":"","name":"1.2.0","archived":false,"released":true,"releaseDate":"2008-08-12"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160388","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312341","id":"12312341","description":"","name":"1.0.0","archived":false,"released":true,"releaseDate":"2007-08-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312687","id":"12312687","description":"","name":"1.0.1","archived":false,"released":true,"releaseDate":"2007-11-09"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312846","id":"12312846","description":"","name":"1.0.2","archived":false,"released":true,"releaseDate":"2008-02-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312969","id":"12312969","description":"","name":"1.0.3","archived":false,"released":true,"releaseDate":"2008-07-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313301","id":"12313301","description":"","name":"1.0.4","archived":false,"released":true,"releaseDate":"2010-09-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313102","id":"12313102","description":"","name":"1.2.0","archived":false,"released":true,"releaseDate":"2008-08-12"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311309","id":"12311309","name":"query","description":"Issues related to query execution, including the JPQL parser and internal query representation."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"202479","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"subtasks":[{"id":"12400198","key":"OPENJPA-658","self":"https://issues.apache.org/jira/rest/api/2/issue/12400198","fields":{"summary":"select count(o) in subquery  or not exists subquery generates SQL with syntax error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}},{"id":"12401951","key":"OPENJPA-681","self":"https://issues.apache.org/jira/rest/api/2/issue/12401951","fields":{"summary":"Subquery generates SQL with syntax error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}},{"id":"12403459","key":"OPENJPA-708","self":"https://issues.apache.org/jira/rest/api/2/issue/12403459","fields":{"summary":"sub-sub-query generates SQL with syntax error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype","name":"Sub-task","subtask":true,"avatarId":21146}}}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-51/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4f58ced2[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3c6e76d8[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@676e4fe0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@28793d63[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@259cfb3f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@267a923[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@17e3e7c0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7690527a[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@34170a94[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@b869384[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@353b8d3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@77242941[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2008-07-14T04:10:09.678+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-51/watchers","watchCount":0,"isWatching":false},"created":"2006-09-19T01:12:45.000+0000","updated":"2016-09-21T14:21:39.274+0000","timeoriginalestimate":null,"description":"451 - bad sql pushdown sub select is missing from clause\n TEST451; select e from EmpBean e where e.empid > any (select e1.empid from DeptBean d, in(d.emps) e1 where d.no = 200) \n28344  TRACE  [main] openjpa.jdbc.SQL - <t 1094861122, conn 295440796> [0 ms] executing prepstmnt 81790176 SELECT t0.empid, t0.bonus, t2.deptno, t2.budget, t2.name, t0.execLevel, t0.hireDate, t0.hireTime, t0.hireTimestamp, t3.street, t3.city, t3.state, t3.zip, t0.isManager, t0.name, t0.salary, t4.street, t4.city, t4.state, t4.zip FROM EmpBean t0 LEFT OUTER JOIN DeptBean t2 ON t0.dept_deptno = t2.deptno LEFT OUTER JOIN AddressBean t3 ON t0.home_street = t3.street LEFT OUTER JOIN AddressBean t4 ON t0.work_street = t4.street WHERE (t0.empid = ANY((SELECT t1.deptno FROM DeptBean t1)))\ns/b\nselect t1.empid  FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t1.dept_deptno = t3.deptno WHERE t1.empid > ANY((SELECT t5.empid FROM DeptBean t4 INNER JOIN EmpBean t5 ON t4.deptno = t5.dept_deptno  WHERE (CAST(t4.deptno AS BIGINT) = ?))) {int 200}\n\n<0|false|0.0.0> org.apache.openjpa.persistence.PersistenceException: Syntax error: Encountered \"WHERE\" at line 1, column 520. {SELECT t2.empid, t2.bonus, t3.deptno, t3.budget, t3.name, t2.execLevel, t2.hireDate, t2.hireTime, t2.hireTimestamp, t4.street, t4.city, t4.state, t4.zip, t2.isManager, t2.name, t2.salary, t5.street, t5.city, t5.state, t5.zip FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t2.dept_deptno = t3.deptno LEFT OUTER JOIN AddressBean t4 ON t2.home_street = t4.street LEFT OUTER JOIN AddressBean t5 ON t2.work_street = t5.street WHERE (t2.empid > ANY((SELECT t1.empid FROM  WHERE (CAST(t0.deptno AS BIGINT) = CAST(? AS BIGINT)))))} [code=30000, state=42X01]\n\tat org.apache.openjpa.jdbc.sql.DBDictionary.newStoreException(DBDictionary.java:3713)\n\tat org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:94)\n\tat org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:80)\n\tat org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:56)\n\tat org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.handleCheckedException(SelectResultObjectProvider.java:152)\n\tat org.apache.openjpa.lib.rop.EagerResultList.<init>(EagerResultList.java:37)\n\tat org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1161)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:936)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:746)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:716)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:712)\n\tat org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:512)\n\tat org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:216)\n\tat org.apache.openjpa.persistence.QueryImpl.getResultList(QueryImpl.java:254)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.createAndRunQuery(JFLoopQueryTestcase.java:187)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testFileQuery(JFLoopQueryTestcase.java:536)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testRunQueryLoopImpl(JFLoopQueryTestcase.java:591)\n\tat com.ibm.ws.query.tests.JFLoopQueryTest.testRunQueryLoop(JFLoopQueryTest.java:265)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat junit.extensions.jfunc.TestletWrapper.runBare(TestletWrapper.java:116)\n\tat junit.extensions.jfunc.TestletWrapper$1.protect(TestletWrapper.java:106)\n\tat junit.framework.TestResult.runProtected(Unknown Source)\n\tat junit.extensions.jfunc.TestletWrapper.run(TestletWrapper.java:109)\n\tat junit.framework.TestSuite.runTest(Unknown Source)\n\tat junit.framework.TestSuite.run(Unknown Source)\n\tat junit.extensions.jfunc.JFuncSuite.run(JFuncSuite.java:134)\n\tat junit.extensions.jfunc.textui.JFuncRunner.doRun(JFuncRunner.java:76)\n\tat junit.extensions.jfunc.textui.JFuncRunner.start(JFuncRunner.java:398)\n\tat junit.extensions.jfunc.textui.JFuncRunner.main(JFuncRunner.java:218)\nCaused by: org.apache.openjpa.lib.jdbc.ReportingSQLException: Syntax error: Encountered \"WHERE\" at line 1, column 520. {SELECT t2.empid, t2.bonus, t3.deptno, t3.budget, t3.name, t2.execLevel, t2.hireDate, t2.hireTime, t2.hireTimestamp, t4.street, t4.city, t4.state, t4.zip, t2.isManager, t2.name, t2.salary, t5.street, t5.city, t5.state, t5.zip FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t2.dept_deptno = t3.deptno LEFT OUTER JOIN AddressBean t4 ON t2.home_street = t4.street LEFT OUTER JOIN AddressBean t5 ON t2.work_street = t5.street WHERE (t2.empid > ANY((SELECT t1.empid FROM  WHERE (CAST(t0.deptno AS BIGINT) = CAST(? AS BIGINT)))))} [code=30000, state=42X01]\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator.wrap(LoggingConnectionDecorator.java:193)\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator.access$6(LoggingConnectionDecorator.java:189)\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection.prepareStatement(LoggingConnectionDecorator.java:217)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.lib.jdbc.ConfiguringConnectionDecorator$ConfiguringConnection.prepareStatement(ConfiguringConnectionDecorator.java:137)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.jdbc.kernel.JDBCStoreManager$RefCountConnection.prepareStatement(JDBCStoreManager.java:1305)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:149)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:463)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:443)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:322)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:295)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion$UnionSelect.execute(LogicalUnion.java:397)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:208)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:198)\n\tat org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.open(SelectResultObjectProvider.java:91)\n\tat org.apache.openjpa.lib.rop.EagerResultList.<init>(EagerResultList.java:31)\n\t... 26 more\nNestedThrowables:\nERROR 42X01: Syntax error: Encountered \"WHERE\" at line 1, column 520.\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(Unknown Source)\n\tat org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)\n\tat org.apache.commons.dbcp.DelegatingConnection.prepareStatement(DelegatingConnection.java:185)\n\tat org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.prepareStatement(PoolingDataSource.java:278)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:162)\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection.prepareStatement(LoggingConnectionDecorator.java:214)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.lib.jdbc.ConfiguringConnectionDecorator$ConfiguringConnection.prepareStatement(ConfiguringConnectionDecorator.java:137)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.jdbc.kernel.JDBCStoreManager$RefCountConnection.prepareStatement(JDBCStoreManager.java:1305)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:149)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:463)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:443)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:322)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:295)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion$UnionSelect.execute(LogicalUnion.java:397)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:208)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:198)\n\tat org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.open(SelectResultObjectProvider.java:91)\n\tat org.apache.openjpa.lib.rop.EagerResultList.<init>(EagerResultList.java:31)\n\tat org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1161)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:936)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:746)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:716)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:712)\n\tat org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:512)\n\tat org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:216)\n\tat org.apache.openjpa.persistence.QueryImpl.getResultList(QueryImpl.java:254)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.createAndRunQuery(JFLoopQueryTestcase.java:187)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testFileQuery(JFLoopQueryTestcase.java:536)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testRunQueryLoopImpl(JFLoopQueryTestcase.java:591)\n\tat com.ibm.ws.query.tests.JFLoopQueryTest.testRunQueryLoop(JFLoopQueryTest.java:265)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat junit.extensions.jfunc.TestletWrapper.runBare(TestletWrapper.java:116)\n\tat junit.extensions.jfunc.TestletWrapper$1.protect(TestletWrapper.java:106)actual  TEST451; select e from EmpBean e where e.empid > any (select e1.empid from DeptBean d, in(d.emps) e1 where d.no = 200) \n                                                                                                                                                                                                                                                                                                                                         e                                                                                                                                                                                                                                                                                                                                           \n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ \nSyntax error: Encountered \"WHERE\" at line 1, column 520. {SELECT t2.empid, t2.bonus, t3.deptno, t3.budget, t3.name, t2.execLevel, t2.hireDate, t2.hireTime, t2.hireTimestamp, t4.street, t4.city, t4.state, t4.zip, t2.isManager, t2.name, t2.salary, t5.street, t5.city, t5.state, t5.zip FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t2.dept_deptno = t3.deptno LEFT OUTER JOIN AddressBean t4 ON t2.home_street = t4.street LEFT OUTER JOIN AddressBean t5 ON t2.work_street = t5.street WHERE (t2.empid > ANY((SELECT t1.empid FROM  WHERE (CAST(t0.deptno AS BIGINT) = CAST(? AS BIGINT)))))} [code=30000, state=42X01] \n TEST451; 1 tuple\n\nexpected and actual line lengths do NOT match for line 2\n  [ FAILED 451- bucket = fvtfull, query = select e from EmpBean e where e.empid > any (select e1.empid from DeptBean d, in(d.emps) e1 where d.no = 200)  : \n   DIFFERENCE-locations based on expected-(\ndiff at line 2 position 1 EXPECTED [[]  ACTUAL [ ] \n[( class com.dw.test.EmpBean  empid=4 name=george salary=0.0 dept=200)]\n                                                                                                                                                                                                                                                                                                                                         e                                                                                                                                                                                                                                                                                                                                           \n) \n   EXPECTED(\n TEST451; select e from EmpBean e where e.empid > any (select e1.empid from DeptBean d, in(d.emps) e1 where d.no = 200) \n[( class com.dw.test.EmpBean  empid=4 name=george salary=0.0 dept=200)]\n[( class com.dw.test.EmpBean  empid=9 name=harry salary=0.0 dept=210)]\n[( class com.dw.test.EmpBean  empid=10 name=Catalina Wei salary=0.0 dept=0)]\n[( class com.dw.test.EmpBean  empid=5 name=ritika salary=0.0 dept=220)]\n[( class com.dw.test.EmpBean  empid=6 name=ahmad salary=0.0 dept=100)]\n[( class com.dw.test.EmpBean  empid=7 name=charlene salary=0.0 dept=210)]\n[( class com.dw.test.EmpBean  empid=8 name=Tom Rayburn salary=0.0 dept=100)]\n TEST451; 7 tuples ) \n   ACTUAL(\n TEST451; select e from EmpBean e where e.empid > any (select e1.empid from DeptBean d, in(d.emps) e1 where d.no = 200) \n                                                                                                                                                                                                                                                                                                                                         e                                                                                                                                                                                                                                                                                                                                           \n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ \nSyntax error: Encountered \"WHERE\" at line 1, column 520. {SELECT t2.empid, t2.bonus, t3.deptno, t3.budget, t3.name, t2.execLevel, t2.hireDate, t2.hireTime, t2.hireTimestamp, t4.street, t4.city, t4.state, t4.zip, t2.isManager, t2.name, t2.salary, t5.street, t5.city, t5.state, t5.zip FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t2.dept_deptno = t3.deptno LEFT OUTER JOIN AddressBean t4 ON t2.home_street = t4.street LEFT OUTER JOIN AddressBean t5 ON t2.work_street = t5.street WHERE (t2.empid > ANY((SELECT t1.empid FROM  WHERE (CAST(t0.deptno AS BIGINT) = CAST(? AS BIGINT)))))} [code=30000, state=42X01] \n TEST451; 1 tuple) ]\n\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12341169","id":"12341169","filename":"failureEntities.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"created":"2006-09-20T01:14:09.000+0000","size":7071,"mimeType":"application/x-zip-compressed","content":"https://issues.apache.org/jira/secure/attachment/12341169/failureEntities.jar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12360336","id":"12360336","filename":"openjpa-51.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-22T01:11:43.005+0000","size":3196,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12360336/openjpa-51.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12357307","id":"12357307","filename":"SelectImpl.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-14T20:03:14.991+0000","size":2962,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12357307/SelectImpl.java.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12356650","id":"12356650","filename":"SelectImpl.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T17:51:37.317+0000","size":3211,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12356650/SelectImpl.java.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"bad sql pushdown, sub select is missing from clause","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"Windows xp, db2, derby ","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12436071","id":"12436071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"body":"removed testcase references.\nrun on version 443432.\n\nEJBQL:\nselect e from EmpBean e where e.empid > any (select e1.empid from DeptBean d, in(d.emps) e1 where d.no = 200) \n\nOPENJPA ERROR OR SQL PUSHDOWN:\n <0|false|0.0.0> org.apache.openjpa.persistence.PersistenceException: Syntax error: Encountered \"WHERE\" at line 1, column 520. {SELECT t2.empid, t2.bonus, t3.deptno, t3.budget, t3.name, t2.execLevel, t2.hireDate, t2.hireTime, t2.hireTimestamp, t4.street, t4.city, t4.state, t4.zip, t2.isManager, t2.name, t2.salary, t5.street, t5.city, t5.state, t5.zip FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t2.dept_deptno = t3.deptno LEFT OUTER JOIN AddressBean t4 ON t2.home_street = t4.street LEFT OUTER JOIN AddressBean t5 ON t2.work_street = t5.street WHERE (t2.empid > ANY((SELECT t1.empid FROM  WHERE (CAST(t0.deptno AS BIGINT) = CAST(? AS BIGINT)))))} [code=30000, state=42X01]\n\tat org.apache.openjpa.jdbc.sql.DBDictionary.newStoreException(DBDictionary.java:3713)\n\tat org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:94)\n\tat org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:80)\n\tat org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:56)\n\tat org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.handleCheckedException(SelectResultObjectProvider.java:152)\n\tat org.apache.openjpa.lib.rop.EagerResultList.<init>(EagerResultList.java:37)\n\tat org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1161)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:936)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:746)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:716)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:712)\n\tat org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:512)\n\tat org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:216)\n\tat org.apache.openjpa.persistence.QueryImpl.getResultList(QueryImpl.java:254)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.createAndRunQuery(JFLoopQueryTestcase.java:187)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testFileQuery(JFLoopQueryTestcase.java:536)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testRunQueryLoopImpl(JFLoopQueryTestcase.java:591)\n\tat com.ibm.ws.query.tests.JFLoopQueryTest.testRunQueryLoop(JFLoopQueryTest.java:265)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat junit.extensions.jfunc.TestletWrapper.runBare(TestletWrapper.java:116)\n\tat junit.extensions.jfunc.TestletWrapper$1.protect(TestletWrapper.java:106)\n\tat junit.framework.TestResult.runProtected(Unknown Source)\n\tat junit.extensions.jfunc.TestletWrapper.run(TestletWrapper.java:109)\n\tat junit.framework.TestSuite.runTest(Unknown Source)\n\tat junit.framework.TestSuite.run(Unknown Source)\n\tat junit.extensions.jfunc.JFuncSuite.run(JFuncSuite.java:134)\n\tat junit.extensions.jfunc.textui.JFuncRunner.doRun(JFuncRunner.java:76)\n\tat junit.extensions.jfunc.textui.JFuncRunner.start(JFuncRunner.java:398)\n\tat junit.extensions.jfunc.textui.JFuncRunner.main(JFuncRunner.java:218)\nCaused by: org.apache.openjpa.lib.jdbc.ReportingSQLException: Syntax error: Encountered \"WHERE\" at line 1, column 520. {SELECT t2.empid, t2.bonus, t3.deptno, t3.budget, t3.name, t2.execLevel, t2.hireDate, t2.hireTime, t2.hireTimestamp, t4.street, t4.city, t4.state, t4.zip, t2.isManager, t2.name, t2.salary, t5.street, t5.city, t5.state, t5.zip FROM DeptBean t0 INNER JOIN EmpBean t1 ON t0.deptno = t1.dept_deptno LEFT OUTER JOIN DeptBean t3 ON t2.dept_deptno = t3.deptno LEFT OUTER JOIN AddressBean t4 ON t2.home_street = t4.street LEFT OUTER JOIN AddressBean t5 ON t2.work_street = t5.street WHERE (t2.empid > ANY((SELECT t1.empid FROM  WHERE (CAST(t0.deptno AS BIGINT) = CAST(? AS BIGINT)))))} [code=30000, state=42X01]\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator.wrap(LoggingConnectionDecorator.java:193)\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator.access$6(LoggingConnectionDecorator.java:189)\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection.prepareStatement(LoggingConnectionDecorator.java:217)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.lib.jdbc.ConfiguringConnectionDecorator$ConfiguringConnection.prepareStatement(ConfiguringConnectionDecorator.java:137)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.jdbc.kernel.JDBCStoreManager$RefCountConnection.prepareStatement(JDBCStoreManager.java:1305)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:149)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:463)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:443)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:322)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:295)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion$UnionSelect.execute(LogicalUnion.java:397)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:208)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:198)\n\tat org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.open(SelectResultObjectProvider.java:91)\n\tat org.apache.openjpa.lib.rop.EagerResultList.<init>(EagerResultList.java:31)\n\t... 26 more\nNestedThrowables:\nERROR 42X01: Syntax error: Encountered \"WHERE\" at line 1, column 520.\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(Unknown Source)\n\tat org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)\n\tat org.apache.commons.dbcp.DelegatingConnection.prepareStatement(DelegatingConnection.java:185)\n\tat org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.prepareStatement(PoolingDataSource.java:278)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:162)\n\tat org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection.prepareStatement(LoggingConnectionDecorator.java:214)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.lib.jdbc.ConfiguringConnectionDecorator$ConfiguringConnection.prepareStatement(ConfiguringConnectionDecorator.java:137)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:160)\n\tat org.apache.openjpa.jdbc.kernel.JDBCStoreManager$RefCountConnection.prepareStatement(JDBCStoreManager.java:1305)\n\tat org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:149)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:463)\n\tat org.apache.openjpa.jdbc.sql.SQLBuffer.prepareStatement(SQLBuffer.java:443)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:322)\n\tat org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:295)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion$UnionSelect.execute(LogicalUnion.java:397)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:208)\n\tat org.apache.openjpa.jdbc.sql.LogicalUnion.execute(LogicalUnion.java:198)\n\tat org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.open(SelectResultObjectProvider.java:91)\n\tat org.apache.openjpa.lib.rop.EagerResultList.<init>(EagerResultList.java:31)\n\tat org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1161)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:936)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:746)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:716)\n\tat org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:712)\n\tat org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:512)\n\tat org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:216)\n\tat org.apache.openjpa.persistence.QueryImpl.getResultList(QueryImpl.java:254)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.createAndRunQuery(JFLoopQueryTestcase.java:187)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testFileQuery(JFLoopQueryTestcase.java:536)\n\tat com.ibm.ws.query.utils.JFLoopQueryTestcase.testRunQueryLoopImpl(JFLoopQueryTestcase.java:591)\n\tat com.ibm.ws.query.tests.JFLoopQueryTest.testRunQueryLoop(JFLoopQueryTest.java:265)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:615)\n\tat junit.extensions.jfunc.TestletWrapper.runBare(TestletWrapper.java:116)\n\tat junit.extensions.jfunc.TestletWrapper$1.protect(TestletWrapper.java:106)\n\n\nSUGGESTED SQL PUSHDOWN:\nselect t0.empid, t0.bonus, t2.deptno, t2.budget, t2.name, t0.execLevel, t0.hireDate, t0.hireTime, t0.hireTimestamp, t3.street, t3.city, t3.state, t3.zip, t0.isManager, t0.name, t0.salary, t4.street, t4.city, t4.state, t4.zip FROM EmpBean t0 LEFT OUTER JOIN DeptBean t2 ON t0.dept_deptno = t2.deptno LEFT OUTER JOIN AddressBean t3 ON t0.home_street = t3.street LEFT OUTER JOIN AddressBean t4 ON t0.work_street = t4.street WHERE t0.empid > ANY((select t5.empid FROM DeptBean t4 INNER JOIN EmpBean t5 ON t4.deptno = t5.dept_deptno  WHERE (CAST(t4.deptno AS BIGINT) = ?))) {int 200}\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"created":"2006-09-20T01:13:08.000+0000","updated":"2006-09-20T01:13:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12436072","id":"12436072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"body":"entity java files and derby ddl script to use to recreate this issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ghongell","name":"ghongell","key":"ghongell","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Hongell","active":true,"timeZone":"Etc/UTC"},"created":"2006-09-20T01:14:09.000+0000","updated":"2006-09-20T01:14:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12491902","id":"12491902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe, \nI am working on issue OPENJPA-51 for David Wisneski.\nI need some education before attempting to resolve this issue.\nHow aliases in the subqueries are created and resolved ?\nConsider the following 2 queries:\n    1. select o from Customer c, in(c.orders)o where o.amount > (select sum(o2.amount) from c.orders o2)\n     2. select o from Order where o.amount > (select sum(o2.amount) from Customer c, in(c.orders) o2)\n\nAside from the semantic difference, in the 2 queries, the syntax difference is where \"Customer c \" is defined.\nWhen Customer c is defined in the subquery, the generated SQL has syntax error, essentially the FROM clause is missing the body and t2 in the selections is undefined:\nSELECT t2.oid, t2.version, t2.amount, t2.customer_countryCode, t2.customer_id, t2.delivered \nFROM TCUSTOMER t0 INNER JOIN TORDER t1 ON t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id WHERE (t2.amount > (SELECT SUM(t1.amount) FROM  ))\n\nUnder the debugger, it shows in which SelectImpl the aliases/tables are created/defined:\n\n    Query 1:                            _aliases                          _tables\n       SelectImpl (main):    TCUSTOMER=0              0=TCUSTOMER t0\n                                           TORDER=1                      1=TORDER t1\n                                           \"oders.o\"\n       SelectImpl(subQ):    TORDER=2                       2=TORDER t2\n                                           \"orders\"\n                                           TORDER=3\n                                           \"jpqlalias1:\"\n\n   Query 2 (all aliase/tables are in the main SelectImpl, null in subQ's SelectImpl)\n     SelectImpl(main):       TCUSTOMER=0                  0=TCUSTOMER t0\n                                           \"jpqlalias1:\"\n                                           TORDER=1                          1=TORDER t1\n                                           \"jpqlalias1:.orders.o2\"\n                                           TORDER=2                           2=TORDER t2\n                                            \n      \nIt seems to me that openjpa assumes the alias defined in subquery is always derived from (i.e. correlated to) the main select.\nCorrect me if I am wrong.\nI have tried changing the method in SelectImpl.findAlias(Table....)\n to call  recordTableAlias() for subselect when the alias was found in parent select by the following code fragment:\n          if (!fromParent && _parent != null) {\n            boolean removeFromParent = key.toString().contains(\":\");  //+\n            alias = _parent.findAlias(table, key, removeFromParent, this);  //false => removeFromParent\n            if (alias != null) {\n                if (removeFromParent)                     //+\n                    recordTableAlias(table, key, alias);  //+\n                return alias;\n            }\n        }\n\nafter this change, the SQL generates OK, but I do not think it is correct, because the subselect is missing the join predicate (missing where clause) for the path c.orders.\nIn debugging, I saw selectJoins for c.order s were created; one for the parent select and one for the subselect. But somehow the one created for subselect disappeared \n( or never got set in SelectImpl's _join field for subselect), the main SelectImpl's _join field seems to have the selectJoin for c.orders \n( but no SQL predicate was generated out of this selectJoin). \nShould the selectionJoin on the parent be moved to subselect ? How/When should this be done? \nAm I on the right track of resolving this issue? \nYour input is much appreciated.\n\nCatalina\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-04-26T07:42:00.682+0000","updated":"2007-04-26T07:42:00.682+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12492996","id":"12492996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe,\nCould you please verify and comment on the patch I am providing for this issue.\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T01:27:32.122+0000","updated":"2007-05-02T01:27:32.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493126","id":"12493126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"body":"I don't remember how any of that stuff works at all.  However, the following line in findAlias is suspect:\n\n_removeAliasFromParent = key.toString().contains(\":\");\n\nfindAlias is called a lot with different keys.  Setting a member field that is used in other methods based\non whether the latest key happens to match a certain criteria seems like it could lead to arbitrary\nresults in different circumstances.  If there is a continuous thread of logic that links the last call to\nfindAlias with the other methods where _removeAliasFromParent is used, it needs to be make more\nexplicit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T16:02:41.559+0000","updated":"2007-05-02T16:02:41.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493158","id":"12493158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe,\nBased on your comment, I have revised my patch. \nPlease verify if the new patch is a better solution.\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T17:51:37.464+0000","updated":"2007-05-02T17:51:37.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493172","id":"12493172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"body":"No, this is no better.  And now you've changed the meaning of the code.  Before, the remove-from-parent\nlogic was based on the key to the last call to findAlias.  Now it's based on the key to any previous call to findAlias\n(so long as 0 <= alias <= 16 ??!!).  The fact that you changed the meaning of the patch seemingly without intent\nand still feel it is correct doesn't give me any confidence in it.\n\np.s. The boolean array is pointless since you never flip the\nboolean values -- you only ever set to true that I see, and then test if any index is true later.  So you could just as \neasily get by with a single boolean where you \"|=\" its value each time.\n\np.p.s. I notice that you also have a \"boolean removed = false\" \nlocal declared in one method and you never change its value, making the local pointless too, unless\nyou meant to assign it a new value based on something somewhere.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T18:44:50.854+0000","updated":"2007-05-02T18:44:50.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493192","id":"12493192","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe,\nI make some mistake in my previous patch, attaching a revised version.\nyour conceren about removedAliasFromParent[] flag once set, was never reset;  that is purposely done.\nIn case any flag (base on number of aliases created so far) is on, there is potentially duplicate joins in the parent select (those joins were initially created for aliases initially attached in parent which was removed from parent, and now attached on subselect),  we need to remove the duplicate joins on the parent, since there is one also created for subselect. The duplicate joins once removed, will never be seen on the next call to removeJoinsFromParent().\nThe local boolean flag is set when joins are indeed removed from parent. Otherwise the normal processing of removing duplcate joins from subselect is performed.\n\nI think there is a much better solution to this issue, that is to create SelectImpl when a \"SELECT\" is encountered, rather than delaying it later as it is currently done. \nCurrent code creates aliases for the subselect to come later -- in the middle of alias creating for subselect, there isn't a SelectImpl created for subselect yet.. So the alias is temporarily attached under the parent SelectImpl.  (This could be based on the assumption that any alias defined in subselect is correated to outer subselect). ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T19:59:34.106+0000","updated":"2007-05-02T19:59:34.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493200","id":"12493200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"body":"OK, I see.  You still shouldn't be using a fixed array.  Use a BitSet.  \n\nAs to the rest... as I said before, I don't remember how this stuff works.  So it could be wrong\nand I wouldn't know it without doing more code-diving than I have time for.  It's our fault for \nnot having enough tests checked into OpenJPA.  So after changing it to use a BitSet, \nassuming it passes all your tests, I'd vote to commit it.  Once that happens we'll see how it\nfairs against our more extensive Kodo test suite.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T20:28:05.621+0000","updated":"2007-05-02T20:28:05.621+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493221","id":"12493221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wisneskid","name":"wisneskid","key":"wisneskid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Wisneski","active":true,"timeZone":"Etc/UTC"},"body":"fixed in r534623","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=wisneskid","name":"wisneskid","key":"wisneskid","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Wisneski","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-02T21:41:06.161+0000","updated":"2007-05-02T21:41:06.161+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493723","id":"12493723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"body":"I have to reopen this, as the fix is causing a regression in our test suite.  Given an entity EntityA with a field \"b\" of type EntityB, the following JPQL:\n\nselect a from EntityA a where \n  exists (select b from a.b b where b.intfield = 1) \n    or \n  exists (select b from a.b b where b.intfield = 0)\n\nis getting translated to:\n\nSELECT t1.ID, t1.TYP, t1.A FROM ENTITYA t1 WHERE (\n  EXISTS (SELECT t0.ID FROM ENTITYB t0 WHERE t0.INTFIELD = 1 AND t1.B = t0.ID))\n   OR\n  EXISTS (SELECT t2.ID FROM ENTITYB t2, ENTITYA t3 WHERE t2.INTFIELD = 0 AND t3.B = t2.ID))\n)\n\nNotice that the first correlated subselect is fine, but the second has lost its correlation -- it creates a new alias for  EntityA's table. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-04T15:44:28.579+0000","updated":"2007-05-04T15:44:28.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12493764","id":"12493764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe,\nIs it really a regression?  I replaced the copy of SelectImpl with revision 52881 (the original without my fixes),\nthe similar query I ran gets \"missing FROM body\":\n\n1078  demo  TRACE  [main] openjpa.Query - Executing query: select c from Customer c where exists(select o from c.orders o where o.oid = 1) or exists(select o from c.orders o where o.oid = 2)\n1156  demo  TRACE  [main] openjpa.jdbc.SQL - <t 1094861122, conn 1643274738> executing prepstmnt 2138865532 SELECT t0.countryCode, t0.id, t0.version, t0.city, t0.state, t0.street, t0.zip, t0.name FROM  WHERE (EXISTS (SELECT t2.oid FROM TORDER t2 WHERE (CAST(t2.oid AS BIGINT) = CAST(? AS BIGINT) AND t1.oid = t2.oid) AND t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id ) OR EXISTS (SELECT t3.oid FROM TORDER t3 WHERE (CAST(t3.oid AS BIGINT) = CAST(? AS BIGINT) AND t1.oid = t3.oid) AND t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id ))  [params=(long) 1, (long) 2]\n1172  demo  TRACE  [main] openjpa.jdbc.SQL - <t 1094861122, conn 1643274738> [16 ms] spent\n1172  demo  TRACE  [main] openjpa.jdbc.JDBC - <t 1094861122, conn 0> [0 ms] close\nException: <0.0.0 nonfatal general error> org.apache.openjpa.persistence.PersistenceException: DB2 SQL error: SQLCODE: -104, SQLSTATE: 42601, SQLERRMC: (;t0.name FROM  WHERE;WHERE {prepstmnt 2138865532 SELECT t0.countryCode, t0.id, t0.version, t0.city, t0.state, t0.street, t0.zip, t0.name FROM  WHERE (EXISTS (SELECT t2.oid FROM TORDER t2 WHERE (CAST(t2.oid AS BIGINT) = CAST(? AS BIGINT) AND t1.oid = t2.oid) AND t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id ) OR EXISTS (SELECT t3.oid FROM TORDER t3 WHERE (CAST(t3.oid AS BIGINT) = CAST(? AS BIGINT) AND t1.oid = t3.oid) AND t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id ))  [params=(long) 1, (long) 2]} [code=-104, state=42601]SQLCA OUTPUT[Errp=SQLNP012, Errd=[-2145779603, 0, 0, 0, -705, 0]]\n<0.0.0 nonfatal general error> org.apache.openjpa.persistence.PersistenceException: DB2 SQL error: SQLCODE: -104, SQLSTATE: 42601, SQLERRMC: (;t0.name FROM  WHERE;WHERE {prepstmnt 2138865532 SELECT t0.countryCode, t0.id, t0.version, t0.city, t0.state, t0.street, t0.zip, t0.name FROM  WHERE (EXISTS (SELECT t2.oid FROM TORDER t2 WHERE (CAST(t2.oid AS BIGINT) = CAST(? AS BIGINT) AND t1.oid = t2.oid) AND t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id ) OR EXISTS (SELECT t3.oid FROM TORDER t3 WHERE (CAST(t3.oid AS BIGINT) = CAST(? AS BIGINT) AND t1.oid = t3.oid) AND t0.countryCode = t1.customer_countryCode AND t0.id = t1.customer_id ))  [params=(long) 1, (long) 2]} [code=-104, state=42601]SQLCA OUTPUT[Errp=SQLNP012, Errd=[-2145779603, 0, 0, 0, -705, 0]]\n\nAre you sure your query ever worked before this fix ?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-04T18:27:48.176+0000","updated":"2007-05-04T18:27:48.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12494070","id":"12494070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"body":"Yes, the test was passing before.  Have you tried against a to-one relation rather than a to-many?\nPerhaps it was never working against a to-many.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-07T16:02:32.501+0000","updated":"2007-05-07T16:02:32.501+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12494138","id":"12494138","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe,\nYou are right, the code before theispatch  (SelectImpl.java revision 52881) worked for to-one relation, \nbut never worked for to-many relation.\n\nDo you have any idea of fixing this problem?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-07T21:34:03.950+0000","updated":"2007-05-07T21:34:03.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12494583","id":"12494583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprudhom","name":"mprudhom","key":"mprudhom","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mprudhom&avatarId=45285","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mprudhom&avatarId=45285","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mprudhom&avatarId=45285","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mprudhom&avatarId=45285"},"displayName":"Marc Prud'hommeaux","active":true,"timeZone":"America/New_York"},"body":"This patch caused 17 TCK tests to start failing, so it needs to be reverted as soon as possible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprudhom","name":"mprudhom","key":"mprudhom","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mprudhom&avatarId=45285","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mprudhom&avatarId=45285","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mprudhom&avatarId=45285","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mprudhom&avatarId=45285"},"displayName":"Marc Prud'hommeaux","active":true,"timeZone":"America/New_York"},"created":"2007-05-09T22:02:56.066+0000","updated":"2007-05-09T22:02:56.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12495770","id":"12495770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"Abe,\nCould you please verify if this patch regress your tests ?\nthanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-05-14T20:03:15.146+0000","updated":"2007-05-14T20:03:15.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12507082","id":"12507082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"The attached patch  passed TCK on derby.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2007-06-22T01:11:43.060+0000","updated":"2007-06-22T01:11:43.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12613232","id":"12613232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"A sub-task OPENJPA-658 is opened for outstanding issues remaining in subqueries.\nFix committed under r676467 is for  subqueries that are not correlated to its outer select,\nexamples:\n\n   1.     \"select o.oid from Order o where o.customer.name =\" +\n                \" (select max(o2.customer.name) from Order o2\" +\n                \" where o.customer.cid.id = o2.customer.cid.id)\",\n    2.    \"select o from Order o where o.customer.name =\" +\n                \" (select max(o2.customer.name) from Order o2\" +\n                \" where o.customer.cid.id = o2.customer.cid.id)\",\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-14T04:10:09.655+0000","updated":"2008-07-14T04:10:09.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12613374","id":"12613374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"fix in 1.0.3 and 1.2.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-14T17:05:00.045+0000","updated":"2008-07-14T17:05:00.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12613511","id":"12613511","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"body":"The query string with the following subquery resulting a SQL with syntax error:\n\"select o1.oid from Order o1 where o1.oid in \" +\n            \" (select distinct o.oid from OrderItem i, Order o\" +\n            \" where i.quantity > 10 and o.amount > 1000 and i.lid = o.oid)\"\n\nThis kind of subquery is more like a SQL style subquery, and subquery is not correlated to its outer query.\n\nRather than creating yet another sub-task (OPENJPA-658, sub-task of this issue addressing some outstanding subquery problems),\nthe fix for this subquery problem is checked in under this issue, - svn  revision : r676787.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fancy","name":"fancy","key":"fancy","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Catalina Wei","active":true,"timeZone":"Etc/UTC"},"created":"2008-07-15T02:17:41.503+0000","updated":"2008-07-15T02:17:41.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12350212/comment/12740747","id":"12740747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dezzio","name":"dezzio","key":"dezzio","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Ezzio","active":true,"timeZone":"America/New_York"},"body":"From trunk, merged fix to 1.1.x branch at 802200","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dezzio","name":"dezzio","key":"dezzio","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Ezzio","active":true,"timeZone":"America/New_York"},"created":"2009-08-07T21:24:05.269+0000","updated":"2009-08-07T21:24:05.269+0000"}],"maxResults":21,"total":21,"startAt":0},"customfield_12311820":"0|i0z13b:","customfield_12314139":null}}

