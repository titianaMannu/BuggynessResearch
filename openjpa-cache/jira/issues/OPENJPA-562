{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12393460","self":"https://issues.apache.org/jira/rest/api/2/issue/12393460","key":"OPENJPA-562","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160878","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":86400,"timeestimate":86400,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":null,"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311302","id":"12311302","name":"kernel","description":"Kernel"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":86400,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"202663","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-562/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7748a43b[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@748e9b5c[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@166a025[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1b28f2e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7b98be9a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@25e39f77[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@11b07466[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@46e4281[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3a3c40f8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@31d78ef[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@119c2fae[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@67900d56[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2008-04-08T22:36:41.799+0000","workratio":0,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-562/watchers","watchCount":1,"isWatching":false},"created":"2008-04-08T21:35:42.336+0000","updated":"2010-03-09T18:32:49.901+0000","timeoriginalestimate":86400,"description":"Consider the following snippet of an entity definition:\n\n/**\n * <p>Entity used to test parsing of @OrderBy.</p>\n *\n * @author Abe White\n */\n@Entity\npublic class OrderByEntity {\n\n    @Id\n    private long id;\n    private String string;\n\n    @PersistentCollection\n    @OrderBy\n    private List<String> strings = new ArrayList();\n\n}\n\nThe @PersistentCollection annotation maps the declaration to the default collection table named orderbyentity_strings. The join column name in the container table is also defaulted to orderbyentity_id and the name of the Element column name is defaulted to element. \n\nThe test code initially added string elements to the strings list and persisted it.\n\n        OrderByEntity pc = new OrderByEntity();\n        pc.setId(1L);\n        pc.getStrings().add(\"2\");\n        pc.getStrings().add(\"1\");\n        pc.getStrings().add(\"3\");\n\nOn a subsequent load of the persistent collection data by executing the following code, we hit into an NPE.\n\n        pc = em.find(OrderByEntity.class, 1L);\n        List<String> strings = pc.getStrings();\n\njava.lang.NullPointerException\nat org.apache.openjpa.meta.FieldMetaData.getOrders(FieldMetaData.java:1127)\nat org.apache.openjpa.jdbc.meta.strats.StoreCollectionFieldStrategy.selectEager(StoreCollectionFieldStrategy.java:207)\nat org.apache.openjpa.jdbc.meta.strats.StoreCollectionFieldStrategy.selectEagerJoin(StoreCollectionFieldStrategy.java:171)\nat org.apache.openjpa.jdbc.meta.FieldMapping.selectEagerJoin(FieldMapping.java:713)\nat org.apache.openjpa.jdbc.kernel.JDBCStoreManager.select(JDBCStoreManager.java:927)\nat org.apache.openjpa.jdbc.kernel.JDBCStoreManager.load(JDBCStoreManager.java:503)\nat org.apache.openjpa.kernel.DelegatingStoreManager.load(DelegatingStoreManager.java:116)\nat org.apache.openjpa.datacache.DataCacheStoreManager.load(DataCacheStoreManager.java:368)\nat org.apache.openjpa.kernel.DelegatingStoreManager.load(DelegatingStoreManager.java:116)\nat org.apache.openjpa.kernel.ROPStoreManager.load(ROPStoreManager.java:78)\nat org.apache.openjpa.kernel.StateManagerImpl.loadFields(StateManagerImpl.java:2911)\nat org.apache.openjpa.kernel.StateManagerImpl.loadField(StateManagerImpl.java:2989)\nat kodo.kernel.ProfilingStateManager.loadField(ProfilingStateManager.java:68)\nat org.apache.openjpa.kernel.StateManagerImpl.beforeAccessField(StateManagerImpl.java:1489)\nat kodo.kernel.ProfilingStateManager.beforeAccessField(ProfilingStateManager.java:49)\nat org.apache.openjpa.kernel.StateManagerImpl.accessingField(StateManagerImpl.java:1474)\n\nThis problem is reported with OpenJPA version:\n\n$ java org.apache.openjpa.conf.OpenJPAVersion\nOpenJPA 1.1.0-SNAPSHOT\nversion id: openjpa-1.1.0-SNAPSHOT-r420667:634150\nApache svn revision: 420667:634150\n\nos.name: Windows XP\nos.version: 5.1\nos.arch: x86\n\njava.version: 1.6.0_05\njava.vendor: BEA Systems, Inc.\n\nThe NPE occurs when the FieldMetadata.getOrders() method is invoked when trying to load the data in the strings collection field. The code is trying to get the ClassMetadata for the element type and then check the FieldMetadata is present in the declared fields. It fails because the element data type is java.lang.String and there is no ClassMetadata for it. By simply adding a null check for the returned class metadata this issue I could fix locally.\n\nHere is the outout of the svn diff command.\n\nC:\\apache_openjpa_project\\openjpa>svn diff\nIndex: openjpa-kernel/src/main/java/org/apache/openjpa/meta/FieldMetaData.java\n===================================================================\n--- openjpa-kernel/src/main/java/org/apache/openjpa/meta/FieldMetaData.java\n(revision 643944)\n+++ openjpa-kernel/src/main/java/org/apache/openjpa/meta/FieldMetaData.java\n(working copy)\n@@ -1124,9 +1124,11 @@\n                     //set \"isUsedInOrderBy\" to the field\n                     ClassMetaData elemCls = getElement()\n                         .getDeclaredTypeMetaData();\n-                    FieldMetaData fmd = elemCls.getDeclaredField(decs[i]);\n-                    if (fmd != null)\n-                       fmd.setUsedInOrderBy(true);\n+                    if (elemCls != null) {\n+                      FieldMetaData fmd = elemCls.getDeclaredField(decs[i]);\n+                      if (fmd != null)\n+                        fmd.setUsedInOrderBy(true);\n+                    }\n                 }\n                 _orders = orders;\n             }\n","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12379687","id":"12379687","filename":"openjpa-1.1.0-SNAPSHOT-r420667.634150.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-08T21:41:37.233+0000","size":1042,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12379687/openjpa-1.1.0-SNAPSHOT-r420667.634150.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"NPE when trying to invoke FieldMetada.getOrders() when a PersistenCollection field is being loaded.","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"This error occured on Microsoft Windows XP SP2, Java version = 1.6.0 with mySQL 5.0 Database.","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393460/comment/12586973","id":"12586973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"body":"The patch containing the fix for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-08T21:41:37.237+0000","updated":"2008-04-08T21:41:37.237+0000"}],"maxResults":1,"total":1,"startAt":0},"customfield_12311820":"0|i0z287:","customfield_12314139":null}}

