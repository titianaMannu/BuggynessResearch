{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12393768","self":"https://issues.apache.org/jira/rest/api/2/issue/12393768","key":"OPENJPA-568","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160884","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":86400,"timeestimate":86400,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":null,"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311302","id":"12311302","name":"kernel","description":"Kernel"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":86400,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"203159","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-568/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@768fed9[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1675055e[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7ca06550[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@42c1c06f[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@499368e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@4e7c5367[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3189251d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7d0749fb[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@30e73d93[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1c2cb783[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6475d8d6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@23fa1d32[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2008-04-18T15:12:48.780+0000","workratio":0,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-568/watchers","watchCount":0,"isWatching":false},"created":"2008-04-11T16:28:38.937+0000","updated":"2010-03-09T18:32:50.096+0000","timeoriginalestimate":86400,"description":"The test deletes and instance and creates another with the same primary keys and encounters an exception while making the new one persistent.\n\nHere is the snippet from the test code:\n\n        pm.currentTransaction().begin();\n        MappingTest2 test2c = new MappingTest2();\n        test2c.setPk1(test2b.getPk1());\n        test2c.setPk2(test2b.getPk2());\n        pm.deletePersistent(test2b);\n\n        test4.getNManyMap().put(\"key2\", test2);\n        test4.getManyManyMap().remove(test2b);\n        test4.getManyManyMap().put(test2, test2);\n        pm.makePersistent(test2c);\n        test4.setInverseOneOne(test2c);\n\n        MappingTest4 test4c = new MappingTest4();\n        test4c.setInverseOwnerOneOne(test2c);\n        test2c.setOneOneOwner(test4c);\n        pm.makePersistent(test4c);\n        pm.currentTransaction().commit();\n\n\nThe problem with this issue was that the JDO PersistenceManager. makePersistent() is failing with the following exception:\n\n[testlogic] <openjpa-1.1.0-SNAPSHOT-r420667:634150 nonfatal user error>\nkodo.jdo.UserException: Operation attempted on a deleted instance.\n[testlogic] FailedObject: kodo.jdbc.meta.MappingTest2-3::4\n[testlogic] \tat org.apache.openjpa.kernel.PCState.error(PCState.java:443)\n[testlogic] \tat \norg.apache.openjpa.kernel.PDeletedState.beforeOptimisticWrite(PDeletedState.java:76)\n[testlogic] \tat \norg.apache.openjpa.kernel.StateManagerImpl.dirty(StateManagerImpl.java:1571)\n[testlogic] \tat \norg.apache.openjpa.kernel.StateManagerImpl.settingObjectField(StateManagerImpl.java:1898)\n[testlogic] \tat \norg.apache.openjpa.kernel.AttachStrategy.attachField(AttachStrategy.java:204)\n[testlogic] \tat \norg.apache.openjpa.kernel.VersionAttachStrategy.attach(VersionAttachStrategy.java:164)\n[testlogic] \tat \norg.apache.openjpa.kernel.AttachManager.attach(AttachManager.java:241)\n[testlogic] \tat \norg.apache.openjpa.kernel.VersionAttachStrategy.attachInPlace(VersionAttachStrategy.java:267)\n[testlogic] \tat \norg.apache.openjpa.kernel.VersionAttachStrategy.attachFieldsInPlace(VersionAttachStrategy.java:218)\n[testlogic] \tat \norg.apache.openjpa.kernel.VersionAttachStrategy.attach(VersionAttachStrategy.java:133)\n[testlogic] \tat \norg.apache.openjpa.kernel.AttachManager.attach(AttachManager.java:241)\n[testlogic] \tat \norg.apache.openjpa.kernel.AttachManager.attach(AttachManager.java:101)\n[testlogic] \tat \norg.apache.openjpa.kernel.BrokerImpl.attach(BrokerImpl.java:3191)\n[testlogic] \tat kodo.kernel.KodoBroker.attach(KodoBroker.java:251)\n[testlogic] \tat \norg.apache.openjpa.kernel.DelegatingBroker.attach(DelegatingBroker.java:1142)\n[testlogic] \tat \nkodo.jdo.PersistenceManagerImpl.makePersistent(PersistenceManagerImpl.java:496)\n[testlogic] \tat \nkodo.jdbc.kernel.TestFlush.testDeleteAndReInsert(TestFlush.java:124)\n\nSynopsis:\n\nWhen the second call to pm.makePersistent(test2c) is made it is not attached correctly. The effect of the prior pm.deletePersistent(test2b) which deletes the object with the same key is kept in the persistence context and hence when a relation is established with the deleted entity the third pm.makePersistent(test4c) call throws the above exception.\n\nThe fix that I have is to correct the logic in the org.apache.openjpa.kernel.VersionAttachStrategy.attach() method where it tries to make a determination of whether this is a new object by also checking whether the existing entity is deleted or not. And that fixes the problem. I will attach it as a patch shortly.\n\nThanks\n\nSandeep","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12379932","id":"12379932","filename":"openjpa-1.1.0-SNAPSHOT-r420667.634150.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-11T16:44:40.717+0000","size":741,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12379932/openjpa-1.1.0-SNAPSHOT-r420667.634150.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Delete, re-insert and setting relationship in the same transaction results in ","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"This problem is reported with OpenJPA version: \n\n$ java org.apache.openjpa.conf.OpenJPAVersion \nOpenJPA 1.1.0-SNAPSHOT \nversion id: openjpa-1.1.0-SNAPSHOT-r420667:634150 \nApache svn revision: 420667:634150 \n\nos.name: Windows XP \nos.version: 5.1 \nos.arch: x86 \n\njava.version: 1.6.0_05 \njava.vendor: BEA Systems, Inc. ","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393768/comment/12588021","id":"12588021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"body":"The fix to the VersionAttachStrategy class that addresses this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-11T16:44:40.746+0000","updated":"2008-04-11T16:44:40.746+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393768/comment/12588067","id":"12588067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"body":"As of revision 646082, I believe this patch is invalid.  The patch was to fix some of the side effects of the original 245 fix, but this revision redid the 245 fix in a manner that eliminated the offending side effects.  \n\nMy hunch is that the test mentioned in this report will now pass even without this patch.  There are some esoteric configurations, though (like detached state being disabled) where a test like this might still fail.  I believe the proper fix is to amend BrokerImpl.isDetached(Object) to pass the OID_NODELETED flag when it makes its call to find(...).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=awhite","name":"awhite","key":"awhite","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A. Abram White","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-11T18:24:16.338+0000","updated":"2008-04-11T18:24:16.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12393768/comment/12590480","id":"12590480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"body":"This problem is resolved by the prior fixes at change 646082.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-04-18T15:12:48.548+0000","updated":"2008-04-18T15:12:48.548+0000"}],"maxResults":3,"total":3,"startAt":0},"customfield_12311820":"0|i0z5af:","customfield_12314139":null}}

