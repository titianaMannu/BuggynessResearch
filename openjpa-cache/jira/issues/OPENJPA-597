{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12395679","self":"https://issues.apache.org/jira/rest/api/2/issue/12395679","key":"OPENJPA-597","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160913","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":86400,"timeestimate":86400,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":null,"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":86400,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"202668","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":86400,"percent":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":86400,"percent":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-597/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@513ef579[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@e7cd99a[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@48b8d85e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@20e078da[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@44f91f77[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@71a94706[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7fdd0b45[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5cd89acc[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@50d62487[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6bfcd8ec[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7c6c71f5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@647a8a4e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2008-05-16T20:55:32.296+0000","workratio":0,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-597/watchers","watchCount":1,"isWatching":false},"created":"2008-05-09T03:03:56.679+0000","updated":"2010-03-09T18:32:51.813+0000","timeoriginalestimate":86400,"description":"If we have a JPQL query like this:\nint countDeleted = em.createQuery('Delete from Person o').executeUpdate();\n\nWe get an exception on MySQL because the converted SQL with an alias gives a syntax error :\n\n[testlogic] java.lang.Exception: org.apache.openjpa.lib.jdbc.ReportingSQLException: \nYou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version \nfor the right syntax to use near '' at line 1 {prepstmnt 2137108 DELETE FROM DYN_DESC_PERSON t0 [reused=0]} [code=1064, state=42000]\n[testlogic] \tat org.apache.openjpa.util.Exceptions.replaceNestedThrowables(Exceptions.java:242)\n[testlogic] \tat org.apache.openjpa.persistence.PersistenceException.writeObject(PersistenceException.java:100)\n\nFor mySQL version 5.0 the MySQLDBDictionary defaults for supportsSubselect and allowsAliasInBulkClause are both true. For these params the DBDictionary.toBulkOperation() generates a sql like DELETE FROM DYN_DESC_PERSON t0 which does not work in mySQL. \n\nThe syntax for DELETE statements that use table aliases changed between MySQL 4.0 and 4.1. In MySQL 4.0, you should use the true table name to refer to any table from which rows should be deleted: \n\nDELETE test FROM test AS t1, test2 WHERE ...\nIn MySQL 4.1, if you declare an alias for a table, you must use the alias when referring to the table: \n\nDELETE t1 FROM test AS t1, test2 WHERE ...","customfield_10010":null,"timetracking":{"originalEstimate":"24h","remainingEstimate":"24h","originalEstimateSeconds":86400,"remainingEstimateSeconds":86400},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12381732","id":"12381732","filename":"OPENJPA-597.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-09T03:09:42.726+0000","size":3632,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12381732/OPENJPA-597.patch"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"JPQL delete query with an alias for tablename and without any further clauses gives an error on MySQL","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"OpenJPA 1.1.0-SNAPSHOT\nversion id: openjpa-1.1.0-SNAPSHOT-r422266:653008\nApache svn revision: 422266:653008\n\nos.name: Windows XP\nos.version: 5.1\nos.arch: x86\n\njava.version: 1.6.0_05\njava.vendor: BEA Systems, Inc.","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12395679/comment/12595456","id":"12595456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"body":"Patch to optionally include either the table names or the aliass as the delete targets in the DELETE sql that is generated based on the requiresTargetForDelete that defaults to false and set to true in the mysql dictionary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-09T03:09:42.782+0000","updated":"2008-05-09T03:09:42.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12395679/comment/12595624","id":"12595624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"body":"Will the resulting SQL work for all versions of MySQL (3.0, 4.0, 4.1 and 5.0)?  From the description it looks like we should generate different SQL for 4.0 and 4.1, but I don't see any code to do that in the patch. \n\nIf the resulting SQL will work with all supported versions of MySQL then I'm fine with that - if it will only work with 5.0 and 4.1 (for example) then I think we should be smart enough to detect which version we're dealing with and initialize MySQLDictionary appropriately. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikedd","name":"mikedd","key":"mikedd","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Dick","active":true,"timeZone":"America/Chicago"},"created":"2008-05-09T14:57:28.905+0000","updated":"2008-05-09T14:57:28.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12395679/comment/12596135","id":"12596135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"body":"Yes it will work with all versions of mySQL.  The following snippet in the getDeleteTargets() method generates:\n\nFor 4.1 and higher: DELETE t0 FROM DYN_DESC_PERSON t0 \nFor earlier versions:  DELETE DYN_DESC_PERSON FROM DYN_DESC_PERSON\n\nif (allowsAliasInBulkClause) {\n+            deleteTargets.append(tableAlias.substring(spaceIndex + 1));\n+          } else {\n+            deleteTargets.append(tableAlias.substring(0, spaceIndex));\n+          }\n\nThe MySQLDictionary sets the allowsAliasInBulkClause propety to false for in the connectedConfiguration method for mysql version earlier than 4.1, the default value for this property is true which is valid for version 4.1 and higher.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeeps%40bea.com","name":"sandeeps@bea.com","key":"sandeeps@bea.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Shrivastava","active":true,"timeZone":"Etc/UTC"},"created":"2008-05-12T17:11:39.031+0000","updated":"2008-05-12T17:11:39.031+0000"}],"maxResults":3,"total":3,"startAt":0},"customfield_12311820":"0|i0z29b:","customfield_12314139":null}}

