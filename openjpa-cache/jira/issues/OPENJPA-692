{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12402066","self":"https://issues.apache.org/jira/rest/api/2/issue/12402066","key":"OPENJPA-692","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313326","id":"12313326","description":"","name":"1.3.0","archived":false,"released":false}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161004","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"203572","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-692/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@15b4b5b4[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@212a268b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@9fbca37[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7915bbfd[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5af8db85[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@75882ec7[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2275e833[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@766b65d3[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6a53bc68[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5e1959f3[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@53200673[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7e48a439[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2008-08-25T14:06:06.422+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-692/watchers","watchCount":0,"isWatching":false},"created":"2008-08-09T19:13:09.614+0000","updated":"2010-04-22T20:32:46.803+0000","timeoriginalestimate":null,"description":"Originally reported in user group message [1] by Frank Schwarz \n\nIf\na) Entities A and B that are related in a one-to-many and many-to-one bi-directional relation (typical Parent-Child pattern)\nb) mapped using a JoinTable instead of conventional mappedBy \n\nthen\nupdate/delete operation fails with OptimisticException (which itself is a catch-all and sometimes misleading). \n\n\nTypical mapping that encounters this error:\n\npublic class Person {\n\t@Id\n\tprivate long ssn;\n\t\n\t@OneToMany(cascade=CascadeType.ALL)\n\t@JoinTable(name=\"J_PERSON_ADDRESSES\",\n\t\t\tjoinColumns               = @JoinColumn(name=\"PERSON_SSN\",    referencedColumnName=\"SSN\"),\n\t\t\tinverseJoinColumns = @JoinColumn(name=\"ADDRESS_PHONE\", referencedColumnName=\"PHONE\"))\n    private Set<Address> addresses = new HashSet<Address>();\n\npublic class Address {\n   @Id\n   private String phone;\n\t\n    @ManyToOne\n    @JoinColumn(table=\"J_PERSON_ADDRESSES\", referencedColumnName=\"SSN\")\n    private Person person;\n\n[1] http://n2.nabble.com/bidirectional-one-to-many-relationship-with-join-table-tc678479.html\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Bi-directional One-to-Many mapping with a JoinTable fails for Update or Delete operation","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402066/comment/12621217","id":"12621217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fs5","name":"fs5","key":"fs5","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Schwarz","active":true,"timeZone":"Etc/UTC"},"body":"I did some additional testing with Hibernate3. It seems that Hibernate is very robust on this topic.\n\nThe following mappings worked as expected:\n1.\n@Entity\npublic class Person {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.SEQUENCE)\n\tprivate long id;\n\n\t@OneToMany(mappedBy = \"person\", cascade = CascadeType.ALL)\n\t@JoinTable(name=\"PERSON_ADDRESS\",\n                  joinColumns=@JoinColumn(name=\"PERSON_ID\", referencedColumnName=\"ID\"),\n                  inverseJoinColumns=@JoinColumn(name=\"ADDRESS_ID\", referencedColumnName=\"ID\"))\n\tprivate Set<Address> addresses = new HashSet<Address>();\n}\n\n@Entity\n@SecondaryTable(name=\"PERSON_ADDRESS\", pkJoinColumns=@PrimaryKeyJoinColumn(name=\"ADDRESS_ID\"))\npublic class Address {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.SEQUENCE)\n\tprivate long id;\n\n\t@ManyToOne\n\t@JoinColumn(table=\"PERSON_ADDRESS\", referencedColumnName=\"ID\")\n\tprivate Person person;\n}\n------%<----------------\n\n2.\n@Entity\npublic class Person {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.SEQUENCE)\n\tprivate long id;\n\n\t@OneToMany(mappedBy = \"person\", cascade = CascadeType.ALL)\n\tprivate Set<Address> addresses = new HashSet<Address>();\n}\n\n@Entity\n@SecondaryTable(name=\"PERSON_ADDRESS\", pkJoinColumns=@PrimaryKeyJoinColumn(name=\"ADDRESS_ID\"))\npublic class Address {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.SEQUENCE)\n\tprivate long id;\n\n\t@ManyToOne\n\t@JoinColumn(table=\"PERSON_ADDRESS\") \n\tprivate Person person;\n}\n------%<----------------\n\n3.\n@Entity\npublic class Person {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.SEQUENCE)\n\tprivate long id;\n\n\t@OneToMany(mappedBy = \"person\", cascade = CascadeType.ALL)\n\tprivate Set<Address> addresses = new HashSet<Address>();\n}\n\n@Entity\npublic class Address {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.SEQUENCE)\n\tprivate long id;\n\n\t@ManyToOne\n\t@JoinTable(name=\"PERSON_ADDRESS\", joinColumns=@JoinColumn(name=\"ADDRESS_ID\"))\n\tprivate Person person;\n}\n\n\nNot working with Hibernate is leaving out the \"mappedBy\" attribute of the Person.addresses field annotation in the first mapping example.\n\nPersonally, I would like to see the third example mapping working. It uses minimal annotations but remains semantically understandable. And it conforms with the spirit of JSR220 disapproving additional annotations on a \"mapped-by\" field.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fs5","name":"fs5","key":"fs5","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Schwarz","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-10T08:09:32.037+0000","updated":"2008-08-10T08:09:32.037+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402066/comment/12621361","id":"12621361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"body":"With SVN Commit 68442, OpenJPA addresses the bi-directional mapping with a JoinTable when mapping is annotated is two independent mappings at both ends of the relationship i.e. no 'mappedBy' attribute links the two ends.\nCan you try that mapping with these latest changes to let us know whether that works for you? I have tested them and the check-in test cases are available with revision 68443.\n\nThe other variants you have mentioned with @SecondaryTable annotations need to be tested with OpenJPA. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-08-11T06:32:10.023+0000","updated":"2008-08-11T06:32:10.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402066/comment/12621390","id":"12621390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fs5","name":"fs5","key":"fs5","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Schwarz","active":true,"timeZone":"Etc/UTC"},"body":"I tried the mapping as specified in the description field of this case.\n\nIt works with current trunk (revision 684688/1.3.0-SNAPSHOT). Schema, SQL statements and runtime behavior are OK with one exception:\n\nDissolving relationship, e.g.:\n\t\t\tAddress address = person.getAddresses().iterator().next();\n\t\t\tperson.getAddresses().remove(address);\n\t\t\taddress.setPerson(null);\n\nleads to UPDATE PERSON_ADDRESS SET PERSON_SSN = ? WHERE ADDRESS_PHONE = ? [params=(null) null, (long) 3]\nActually it has to be DELETE FROM PERSON_ADDRESS WHERE ADDRESS_PHONE = ? [params=(long) 3]. Otherwise the join-table will get filled with meaningless <NULL, ADDRESS_PHONE> tupels\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fs5","name":"fs5","key":"fs5","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Schwarz","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-11T09:34:47.278+0000","updated":"2008-08-11T09:34:47.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402066/comment/12621712","id":"12621712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fs5","name":"fs5","key":"fs5","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Schwarz","active":true,"timeZone":"Etc/UTC"},"body":"With latest changes in trunk the dissolution of associations seems to work, i.e. an SQL delete statement is now used instead of an SQL update-set-null statement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fs5","name":"fs5","key":"fs5","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Frank Schwarz","active":true,"timeZone":"Etc/UTC"},"created":"2008-08-12T06:46:39.091+0000","updated":"2008-08-12T06:46:39.091+0000"}],"maxResults":4,"total":4,"startAt":0},"customfield_12311820":"0|i0z7u7:","customfield_12314139":null}}

