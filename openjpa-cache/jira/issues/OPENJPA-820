{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12410312","self":"https://issues.apache.org/jira/rest/api/2/issue/12410312","key":"OPENJPA-820","fields":{"fixVersions":[],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161125","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313483","id":"12313483","description":"Early Access 2","name":"2.0.0-M2","archived":false,"released":true,"releaseDate":"2009-06-03"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12322747","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322747","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12410528","key":"OPENJPA-825","self":"https://issues.apache.org/jira/rest/api/2/issue/12410528","fields":{"summary":"slices: hangs with multithreaded true","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312619","id":"12312619","name":"slice","description":"Extends OpenJPA to work with horizontally partitioned distributed databases."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"201678","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-820/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@55fbcc3[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@36654fad[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@30efb877[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2ceb91e0[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@35ffeeb7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@88c2209[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@456d0f6f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@35f9e2b3[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7f3938ed[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@16ccc169[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3b77a2a8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4161230f[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2010-03-15T21:30:35.031+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-820/watchers","watchCount":1,"isWatching":false},"created":"2008-12-09T23:02:36.733+0000","updated":"2010-04-22T20:32:54.062+0000","timeoriginalestimate":null,"description":"Thank you for fixing that PCPath issue!  Now I can move on to find the next bug to fix. :)  And I didn't have to wait long:\n\nI am trying to run the simple query below, against 2 slices.\n\nselect this from com.protrade.fandom.data.entities.TeamFanJersey this  where this.teamFan = :p0\n\n\nThese are the two queries run on the low level databases:\n\nSELECT t0.JDOID, t0.JERSEYLEVEL, t0.TEAMFAN_JDOID FROM TEAMFANJERSEY t0 WHERE (t0.TEAMFAN_JDOID IS NULL)\n\nSELECT t0.JDOID, t0.JERSEYLEVEL, t0.TEAMFAN_JDOID FROM TEAMFANJERSEY t0 WHERE (t0.TEAMFAN_JDOID = 8574250)\n\n\nAs you can see, the query run against Slice1 thinks the parameter is Null, while the query run against Slice2, knows the proper value of the parameter.  This SQL is the lowlevel sql sent through the Mysql Driver (mysql driver logging).\n\nI guess it's another bug in the DistributedPreparedStatement not properly setting parameters to all sub statements.. just a guess.\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12395771","id":"12395771","filename":"bad-log.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T23:24:43.917+0000","size":3656914,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12395771/bad-log.txt"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"slices: a simple query is failing (unique, but totally sending wrong parameters to SQL)","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655008","id":"12655008","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"Alright, so it's not DistributedPreparedStatement, since this goes through the DistributedStoreQuery.  So I have no clue to give you.  Some how one of the slice queries loses the parameter....","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-09T23:18:57.178+0000","updated":"2008-12-09T23:18:57.178+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655397","id":"12655397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"Pinaki Poddar wrote:\n>> select this from com.protrade.fandom.data.entities.TeamFanJersey this \n> where this.teamFan = :p0\n> 1. What is the value of the query parameter 'p0'? If p0 is persisted in one\n> slice only, then in other slices the query should compare with IS NULL. \n> \n> \n> I had added a test case of the above form in\n> ...openjpa.slice.TestQuery#testQueryParameterEntity. And that test verifies\n> proper parameter binding and returns the correct result.\n> \n> May be something more is happening in your use case. Post the relevant\n> portion of the failing use case.\n> ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T22:52:33.677+0000","updated":"2008-12-10T22:52:33.677+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655398","id":"12655398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"Question:\n\np0 is a persisted object, thus persisted in one slice. BUT I don't get your assertion that \"then in other slices the query should compare with IS NULL.\"  There is no reason to force this assertion in the code.  Anyhow, where in the code would this behavior be applied?  I might not be too smart or the code might be more complicated than I thought, but I have not seen anything that would do that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T22:53:01.532+0000","updated":"2008-12-10T22:53:01.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655405","id":"12655405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"I'll try posting the \"relevant portion of the failing use case\", but I just did.  There is a simple query, and it's failing, I already told you the query above, and pointed out the generated SQL that openjpa is executing against the slices..  and I have no clue how that would come about..\n\nbut here are more details.\n\nI have two slices.  One is the full database that I have been using for non-slice work.  The second is a fully empty database with just the same schema, that I use for slices testing.  So TeamFan and TeamFanJersey objects all exist in the same database.\n\nIn my code I am trying to do something like:\n\nattainTeamFanJersey( TeamFan fan );\n\nwhich then calls the query listed below, to see if there is a TeamFanJersey for that TeamFan.  If null, then it creates one.\n\nselect this from com.protrade.fandom.data.entities.TeamFanJersey this where this.teamFan = :p0 \n\nWhat I expect is that it will always return a value since I KNOW that a TeamFan and TeamFanJersey both exist in Slice1.\n\nFor some reason OpenJPA returns null randomly, thus for some reason OpenJPA can't find a valid TeamFanJersey, even though I know it exists.  When I was looking at the logs, that's when I saw the weird case that it seemed to be checking for NULL instead of the propery TeamFan id for one of the two slices.. weird.\n\n\nWhen this happens, then my code assume that there is no TeamFanJersey, then it creates one.  But now there are 2 TeamFanJersey objects related to that TeamFan.\n\n\nNow the kicker.  When the code creates a second TeamFanJersey, it properly creates that object.  And at times it creates that on Slice2.  But then when I execute the query again, at a later time ( same request, or another request ).\n\nselect this from com.protrade.fandom.data.entities.TeamFanJersey this where this.teamFan = :p0\n\nIt then finds BOTH TeamFanJersey objects.. which my code complains since it's expecting only 1 TeamFanJersey, not 2.. (getSingleResult).\n\n\n\nSo, here we are:\n\nThe query works most of the time, but seems to fail randomly.\nThe failure seems to be related to the low level SQL that it generates and runs against each Slice, in that it doesn't generate the same SQL.. weird.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T23:03:53.471+0000","updated":"2008-12-10T23:03:53.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655407","id":"12655407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"the annoying part, is that it seems intermittent :(\n\nI can't reproduce it at the moment :(\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T23:09:52.355+0000","updated":"2008-12-10T23:09:52.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655417","id":"12655417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"huge log file, where it failed..\n\nif you search for TEAMFANJERSEY, you will see the SQL that was executed against the Slices..\n\nSlice1 has all the data, Slice2 is empty.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T23:24:43.942+0000","updated":"2008-12-10T23:24:43.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12655421","id":"12655421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"There, I got a run where it fails. \n\nIf you look at the log file and search for TEAMFANJERSEY, you will see the first SQL query:\n\nSELECT t0.JDOID, t0.JERSEYLEVEL, t0.TEAMFAN_JDOID FROM TEAMFANJERSEY t0 WHERE (t0.TEAMFAN_JDOID IS NULL)\n\nthen the second:\n\nSELECT t0.JDOID, t0.JERSEYLEVEL, t0.TEAMFAN_JDOID FROM TEAMFANJERSEY t0 WHERE (t0.TEAMFAN_JDOID = 8574250)\n\nI can only assume that the first query was run against Slice1 (where TeamFanJersey is actually located), and the second against Slice2 (which is empty).  Thus the query returns null.. which causes my code to create a TeamFanJersey (which happens to go into Slice2), which causes all future executions of the query above to return 2 TeamFanJersey objects.. a failure, so you'll see a tonne of exceptions through the rest of the log:\n\n...NonUniqueResultException: The query on candidate type \"class com.protrade.fandom.data.entities.TeamFanJersey\" with filter \"select this from com.protrade.fandom.data.entities.TeamFanJersey this  where this.teamFan = :p0\" was configured to have a unique result, but more than one instance matched the query.\n\n\n\n\nLet me know what else I can do to help us figure this out! :) :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-10T23:27:57.108+0000","updated":"2008-12-10T23:27:57.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410312/comment/12656668","id":"12656668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"So it looks that this is caused by the ParallelExecutor executing the sub queries using multiple threads, without using proper locking: openjpa.Multithreaded=true.  So it looks like the root cause of this bug is OPENJPA-825.\n\nBut I would keep this bug open until that is fixed..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T17:32:05.209+0000","updated":"2008-12-15T17:32:05.209+0000"}],"maxResults":8,"total":8,"startAt":0},"customfield_12311820":"0|i0yw5b:","customfield_12314139":null}}

