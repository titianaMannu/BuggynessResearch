{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12410528","self":"https://issues.apache.org/jira/rest/api/2/issue/12410528","key":"OPENJPA-825","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313624","id":"12313624","description":"OpenJPA 2.0.0 Milestone 1","name":"2.0.0-M1","archived":false,"released":true,"releaseDate":"2009-01-29"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161129","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313483","id":"12313483","description":"Early Access 2","name":"2.0.0-M2","archived":false,"released":true,"releaseDate":"2009-06-03"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12322747","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322747","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12410312","key":"OPENJPA-820","self":"https://issues.apache.org/jira/rest/api/2/issue/12410312","fields":{"summary":"slices: a simple query is failing (unique, but totally sending wrong parameters to SQL)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12322746","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322746","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12410622","key":"OPENJPA-826","self":"https://issues.apache.org/jira/rest/api/2/issue/12410622","fields":{"summary":"moving some code outside of lock boundaries, that don't need to be locked","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312619","id":"12312619","name":"slice","description":"Extends OpenJPA to work with horizontally partitioned distributed databases."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"201680","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-825/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@43f43ed1[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d51f0fa[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f393ca2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7d9ddb9f[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4d887048[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6cdbeef2[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2a4113e7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@39137413[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@37974949[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@4888d37[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2674786a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@465235b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2009-09-12T04:47:23.093+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-825/watchers","watchCount":1,"isWatching":false},"created":"2008-12-11T23:40:42.039+0000","updated":"2010-03-09T17:53:50.522+0000","timeoriginalestimate":null,"description":"When I turned on openjpa.Multithreaded as a possible fix for another bug, I see that the system hangs.  Attached are going to be a log file, and jstack, showing how it system hung on the very first query. ( it did execute a few find() operations, but those are not executed via ParallelExecutor ).","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12395890","id":"12395890","filename":"hang-multithread.jstack","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-11T23:41:11.641+0000","size":35430,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12395890/hang-multithread.jstack"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12395891","id":"12395891","filename":"hang-multithread.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-11T23:41:37.488+0000","size":180859,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12395891/hang-multithread.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12396253","id":"12396253","filename":"hang-multithread-2.jstack","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-16T23:10:55.310+0000","size":41467,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12396253/hang-multithread-2.jstack"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"slices: hangs with multithreaded true","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410528/comment/12655814","id":"12655814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"jstack, showing where the query hangs..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-11T23:41:11.658+0000","updated":"2008-12-11T23:41:11.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410528/comment/12655815","id":"12655815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"the log file to show how the system hung on a query...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-11T23:41:37.527+0000","updated":"2008-12-11T23:41:37.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410528/comment/12656365","id":"12656365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"body":"Multithreaded mode of OpenJPA kernel and parallel database operation in Slice\n===============================================================\n\nBackground\n   a) OpenJPA allows multiple threads to execute a single instance of EntityManager. By default, OpenJPA assumes that a single thread is invoking operations on a particular instance of EntityManager. \n   openjpa.Multithreaded configuration property can be set to true to signal multithreaded acceess. Under multithreaded mode, OpenJPA kernel classes acquire an instance-level Reentrant lock before almost any of its methods and \n   releases the lock on the method's finally block.\n\n   b) Slice executes most of the frequent database operations (query, flush) on individual slice in separate threads.\n\n\n   These two threading models conflict and give rise to a classic deadlock scenario as follows:\n\n   1. Assume EntityManager instance em, a Query instance Q created by E, openjpa.Multithreaded=true, a user thread UT and three slices S1,S2,S3\n\n   2. T calls em.x() or Q.y()\n\n   3. em/Q acquires a reentrant lock L on thread UT and invokes lower-layer method which eventually invokes Slice operations\n\n   4. Slice spawns three threads ST1, ST2, ST3 and on each of these threads invoke identical operation S.z()\n\n   5. If S.z() on ST1 invokes any operation of em/Q then ST1 can not acquire L as it is acquired by em/Q in step 3 and yet to be released. The architecture of Slice makes it typical that S.z() invokes one or more method on em or Q. \n\n   6. em.x()/Q.y() can not release L till  S.z() finishes   \n\n   7. S.z() can not finish because ST1 waits for L to be released by UT\n\n\n\nObservations\n==========\n  a) openjpa.Multithreaded is a non-default option and single threaded operation on em is more prevalent. Note that single threaded access does not imply that em can only be invoked only on UT. It is perfectly permissible to \nstart a transaction of em on some thread UT, commit the transaction and then start another transaction on same em on a different thread UT2 under default mode of openjpa.Multithreaded=false.\n\n  b) Execution of common database operations on each slice S1, S2,... in parallel has definite performance benefit and should be the default choice. And this is at par with the default choice of openjpa.Multithreaded=false\n\n\nPossible solutions\n===============\n  1. Under openjpa.Multithreaded=true, execute database operation on all slices on the same user thread UT. Otherwise, execute database operation on each slice on separate thread\n  2. Modify OpenJPA kernel's threading featureSelection to make it more fine-grained, read/write sensitive\n  3. Detect deadlock and throw exception as ST1 waits on L\n  \nMy preferred solution is (1). ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"created":"2008-12-14T04:53:04.255+0000","updated":"2008-12-14T04:53:04.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410528/comment/12656666","id":"12656666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"I have to add that because Slices does execute the Query using multiple threads ( ST1, ST2, ST3 mentioned above ).  It is explicitly accessing the EM in a multi-threaded manner, thus breaking the whole assumptions that you can only access the EM with one thread.\n\nTHUS:\n\nSlices REQUIRES openjpa.Multithreaded=true !!!!!!!!!!!!\n\nConceptually, if you will be executing the EM with multiple threads, you have to use openjpa.Multithreaded=true.  And if you don't you will see corruption and weird behavior, which another issue (OPENJPA-820) shows exactly that Slices with openjpa.Multithread=false can have erratic behavior, with invalid results for queries.  Thus if you run Slices with openjpa.Multithreaded=false, then any query you run could be returning invalid values!\n\nI just wanted to go on record stating that this bug (OPENJPA-825) is an either/or proposition, or only an issue if you run with openjpa.Multithreaded=true, because currently Slices requires openjpa.Multithreaded=true.  Thus though the easy solution is #1, that is the most un-performant of any of them, so it's a great short-term solution.  And #3 is useless because deadlocks ARE GUARANTEED to occur (OPENJPA-820), because most of the code uses a global lock, there is no way around deadlocks.  #2 is the only long-term solution...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-15T17:26:03.731+0000","updated":"2008-12-15T17:26:03.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410528/comment/12657211","id":"12657211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"body":"another jstack of openjpa slices hanging: within the StateManager...\n\n1) I have applied the patch from OPENJPA-826, that removes the first hang spot in QueryImpl.isUnique\n    (this was the hang shown in the first stack trace I attached)\n\n2) I have disabled the current work around to this bug applied by Pinaki\n    (the work around currently turns off ParallelExecutor when Multithreaded=true)\n    (I have disabled the work around to test a parallel execution, to find and fix hangs)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fern","name":"fern","key":"fern","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernando Padilla","active":true,"timeZone":"Etc/UTC"},"created":"2008-12-16T23:10:55.364+0000","updated":"2008-12-16T23:10:55.364+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12410528/comment/12677055","id":"12677055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"body":"Two primary objectives or hard constraints\n1. Slice must execute database operations in parallel. Otherwise the basic purpose of working with distributed data in an efficient manner is defeated.\n2. OpenJPA's threading featureSelection should not be altered. Threading featureSelection is hard to retrofit and OpenJPA's current threading featureSelection is battle-tested. Any fundamental alteration is a risk not worth taking.\n\nOne approach to meet the above criteria and address this difficult reported issue is to incorporate a variation on threading featureSelection for Slice module. Let each slice run on a specialized SliceThread which acts like a child of a parent 'user' thread. The parent thread is the thread that invoked the Broker/EntityManager operation. When the control reaches to Slice for executing database operation, let Slice spawn specialized SliceThread. Let a SliceThread use its parent's lock. But do this only for Broker and not for Query (which has its own reentrant lock). ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"created":"2009-02-26T16:31:16.335+0000","updated":"2009-02-26T16:31:16.335+0000"}],"maxResults":6,"total":6,"startAt":0},"customfield_12311820":"0|i0yw5r:","customfield_12314139":null}}

