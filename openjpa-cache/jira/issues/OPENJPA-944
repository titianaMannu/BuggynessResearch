{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12415697","self":"https://issues.apache.org/jira/rest/api/2/issue/12415697","key":"OPENJPA-944","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314149","id":"12314149","description":"2.0.0 Beta","name":"2.0.0-beta","archived":false,"released":true,"releaseDate":"2010-01-28"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"161242","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312341","id":"12312341","description":"","name":"1.0.0","archived":false,"released":true,"releaseDate":"2007-08-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312687","id":"12312687","description":"","name":"1.0.1","archived":false,"released":true,"releaseDate":"2007-11-09"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312846","id":"12312846","description":"","name":"1.0.2","archived":false,"released":true,"releaseDate":"2008-02-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312969","id":"12312969","description":"","name":"1.0.3","archived":false,"released":true,"releaseDate":"2008-07-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312344","id":"12312344","description":"","name":"1.1.0","archived":false,"released":true,"releaseDate":"2008-05-22"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313102","id":"12313102","description":"","name":"1.2.0","archived":false,"released":true,"releaseDate":"2008-08-12"}],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[{"id":"12323573","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12323573","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12414274","key":"OPENJPA-911","self":"https://issues.apache.org/jira/rest/api/2/issue/12414274","fields":{"summary":"Issue with FetchAttribute recursionDepth ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ppoddar%40apache.org","name":"ppoddar@apache.org","key":"ppoddar@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pinaki Poddar","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12311300","id":"12311300","name":"jdbc","description":"jdbc interface"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12311302","id":"12311302","name":"kernel","description":"Kernel"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"201682","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-944/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6e392930[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4b5cf6f4[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@9c3cc7d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@250460e7[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@23c336ce[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@2dd887b0[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3aef1652[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3c6a4ab0[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6256eb5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6fa99cc6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2db65ae7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4367ba2b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2010-01-18T21:36:05.035+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-944/watchers","watchCount":1,"isWatching":false},"created":"2009-02-26T18:58:03.334+0000","updated":"2010-03-09T18:31:10.574+0000","timeoriginalestimate":null,"description":"A problem with loading recursively referenced entities was found when there is a complex relation of the following kind:\nLeaf <-> BranchConnection <-> Branch(1) <- Branch(2) <- ...\nwhere Branch has a self reference to itself.\n\nUsing a FetchPlan with a fetch group that has a fetch attribute with recursionDepth=-1 does not produce the expected result and only the first of the Branch nodes is loaded. \nLoading a Leaf with 5 branches in a row and traversing through them fails right on level 3 (starting from 5 downwards) which leads to the thought that OpenJPA loads only the first element (along with its direct parent).\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12405970","id":"12405970","filename":"fix_recursive_entity_loading-OPENJPA-944-openjpa1.0.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-21T00:07:26.372+0000","size":1948,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12405970/fix_recursive_entity_loading-OPENJPA-944-openjpa1.0.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12405971","id":"12405971","filename":"fix_recursive_entity_loading-OPENJPA-944-openjpa1.2.1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-21T00:07:26.404+0000","size":1979,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12405971/fix_recursive_entity_loading-OPENJPA-944-openjpa1.2.1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12401060","id":"12401060","filename":"openjpa_complex_relation_recursion_test.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-26T18:59:35.121+0000","size":16613,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12401060/openjpa_complex_relation_recursion_test.zip"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10042","value":"Patch Available","id":"10042","disabled":false}],"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"FetchAttribute.recursionDepth = -1 does not load properly self referenced entities in a complex relation","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"JDK: Sun 1.5\nDatabase: Derby 10.2.2.0\nOS: Windows XP ","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415697/comment/12677102","id":"12677102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"body":"Attached a test case that shows the error. I tried the test case with 1.0.0, 1.0.1, 1.0.3, 1.1.0 and 1.2.0 and even with the latest trunk code but neither of them work.\n\nFor running the test case unzip the zip file and execute from a shell:\n  mvn install\n\nThe provided test case extends SingleEMFTestCase and can directly be copied into openjpa-persistence-jdbc/src/test for being executed within there as well.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-26T18:59:35.127+0000","updated":"2009-02-26T22:21:52.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415697/comment/12677108","id":"12677108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"body":"Could be related to OPENJPA-911. The only difference is that the attached to this bug test case works for release 1.0.0 whilst my test case does not work for any released version of OpenJPA.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"created":"2009-02-26T19:20:06.689+0000","updated":"2009-02-26T19:20:06.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415697/comment/12700993","id":"12700993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"body":"Attached patch files for fixing that issue for OpenJPA versions 1.0.1 and 1.2.1. The same changes could be used for the other versions as well.\n\nI think the problem is that the recursion depth is not calculated properly. When the FetchConfiguration is created for every field-to-field relation only the type of the FieldMetaData is taken into consideration. This causes a confusion of what the real recursion depth is. \nFor example if the field BranchConnection.branch refers to Branch and Branch.parent has a reference to Branch then there is the following field metadata:\n\n|| Field || From Type || Recursion Depth ||\n| branch | Branch | 1 |\n| parent | Branch | -1 |\n\nWhen the mappings are built and OpenJPA gets to BranchConnection.branch - > Branch.parent and tries to add the new field Branch.parent it will try to find an already existing limit and will compare the From Type of the new field to the From Type of the existing mappings (parents of the new mapping).\nAs the second mapping in the table has not been created yet it will grab the first one which is not what we expect and will set recursion depth 1. This prevents from getting the real recursion depth and only the first parent of the Branch connected to BranchConnection will be loaded.\n\nFor fixing this behavior a new check for the field name was added. This makes sure that when the recursion depth is being determined only the mappings that are of the same kind (fromField and fromType) will be taken into consideration.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yzhivkov","name":"yzhivkov","key":"yzhivkov","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yanko Zhivkov","active":true,"timeZone":"Etc/UTC"},"created":"2009-04-21T00:07:26.411+0000","updated":"2009-04-21T00:07:26.411+0000"}],"maxResults":3,"total":3,"startAt":0},"customfield_12311820":"0|i0yw67:","customfield_12314139":null}}

