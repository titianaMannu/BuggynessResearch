{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12360119","self":"https://issues.apache.org/jira/rest/api/2/issue/12360119","key":"OPENJPA-98","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312340","id":"12312340","description":"","name":"0.9.7","archived":true,"released":true,"releaseDate":"2007-04-27"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12312320":null,"customfield_12310420":"160435","customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[],"customfield_12311120":null,"customfield_12313826":null,"customfield_12312339":null,"issuelinks":[],"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"202516","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-98/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6ada9142[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@49e58a17[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@71269511[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@14760c10[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d37cfb0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@709b6428[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@35d0e937[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@11627511[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@526b62c2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@79fae683[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4bd131da[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@49990f4c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310351","id":"12310351","key":"OPENJPA","name":"OpenJPA","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310351&avatarId=10043","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310351&avatarId=10043","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310351&avatarId=10043","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310351&avatarId=10043"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10252","id":"10252","description":"","name":"OpenJPA"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2007-02-05T17:34:50.533+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/OPENJPA-98/watchers","watchCount":1,"isWatching":false},"created":"2007-01-09T20:28:59.323+0000","updated":"2007-07-31T18:59:34.374+0000","timeoriginalestimate":null,"description":"I have a simple test program that uses OpenJPA 0.9.6 to insert an object into a db in one transaction (t1) and retrieve it in another transaction (t2).  The program hangs in 30-50% of the executions right before the call to entitymanager.find() (used to retrieve the object in t2).  I'm using OpenJPA runtime enhancement.\n\n\nBy looking at the JVM dump, I can see the following deadlock:\n1LKDEADLOCK    Deadlock detected !!!\nNULL           ---------------------\nNULL           \n2LKDEADLOCKTHR  Thread \"main\" (0x0015EC00)\n3LKDEADLOCKWTR    is waiting for:\n4LKDEADLOCKMON      sys_mon_t:0x41E40548 infl_mon_t: 0x41E40588:\n4LKDEADLOCKOBJ      java/lang/Object@00D41010/00D4101C: \n3LKDEADLOCKOWN    which is owned by:\n2LKDEADLOCKTHR  Thread \"Finalizer thread\" (0x41B36200)\n3LKDEADLOCKWTR    which is waiting for:\n4LKDEADLOCKMON      sys_mon_t:0x0035CD38 infl_mon_t: 0x0035CD78:\n4LKDEADLOCKOBJ      sun/misc/Launcher$AppClassLoader@00D4E5B0/00D4E5BC: \n3LKDEADLOCKOWN    which is owned by:\n2LKDEADLOCKTHR  Thread \"main\" (0x0015EC00)\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12348582","id":"12348582","filename":"console.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-09T20:30:55.440+0000","size":80163,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12348582/console.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12348581","id":"12348581","filename":"javacore.20070109.114312.3868.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-09T20:30:55.424+0000","size":57934,"mimeType":"application/x-zip-compressed","content":"https://issues.apache.org/jira/secure/attachment/12348581/javacore.20070109.114312.3868.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12348580","id":"12348580","filename":"play.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-09T20:30:55.260+0000","size":6183,"mimeType":"application/x-zip-compressed","content":"https://issues.apache.org/jira/secure/attachment/12348580/play.zip"}],"customfield_12312340":null,"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12310041":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Java deadlock when insert in t1 and find in t2 when using IBM JVM 1.5.0","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12314138":null,"customfield_12314137":null,"environment":"OpenJPA:\n0.9.6\n\nJava:\njava version \"1.5.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build pwi32dev-20061002a (SR3)\n)\nIBM J9 VM (build 2.3, J2RE 1.5.0 IBM J9 2.3 Windows XP x86-32 j9vmwi3223-2006100\n1 (JIT enabled)\nJ9VM - 20060915_08260_lHdSMR\nJIT  - 20060908_1811_r8\nGC   - 20060906_AA)\nJCL  - 20061002\n\nDB:\nDerby 10.2.1.6","customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463388","id":"12463388","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"body":"Attachments:\nplay.zip - the Eclipse project used to reproduce this problem\njavacore.20070109.114312.3868.zip - java dump after the deadlock occured\nconsole.txt - java console of the test program after the deadlock occured","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-09T20:33:44.521+0000","updated":"2007-01-09T20:33:44.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463391","id":"12463391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"body":"I cannot reproduce this problem with Sun JDK 1.5.0_04.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vtatavu","name":"vtatavu","key":"vtatavu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlad Tatavu","active":true,"timeZone":"Etc/UTC"},"created":"2007-01-09T20:37:05.039+0000","updated":"2007-01-09T20:37:05.039+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463636","id":"12463636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"I'll take ownership of this report (for now, at least).\n\nI can now reproduce the problem.  Using the runtime enhancement and using previously created database tables, the problem reproduces itself quite easily.\n\nFrom looking at the resulting stack traces for the deadlock, the dynamic enhancement processing is definitely the source of the problem.  If the classes were statically enhanced before the execution, this particular problem would not surface.  But, I don't see any processing within the dynamic enhancement class loader that should cause this type of deadlock.\n\nHere are snippets from the javacore thread dump for the two deadlocked threads:\n\n3XMTHREADINFO      \"main\" (TID:0x41DF8C00, sys_thread_t:0x0038B9D8, state:B, native ID:0x00001744) prio=5\n4XESTACKTRACE          at com/ibm/oti/vm/BootstrapClassLoader.loadClass(BootstrapClassLoader.java:63(Compiled Code))\n4XESTACKTRACE          at java/lang/ClassLoader.loadClass(ClassLoader.java:587(Compiled Code))\n4XESTACKTRACE          at java/lang/ClassLoader.loadClass(ClassLoader.java:587(Compiled Code))\n4XESTACKTRACE          at sun/misc/Launcher$AppClassLoader.loadClass(Launcher.java:327(Compiled Code))\n4XESTACKTRACE          at java/lang/ClassLoader.loadClass(ClassLoader.java:563(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/jdbc/kernel/JDBCStoreManager.getManagedType(JDBCStoreManager.java:562)\n4XESTACKTRACE          at org/apache/openjpa/kernel/DelegatingStoreManager.getManagedType(DelegatingStoreManager.java:140)\n4XESTACKTRACE          at org/apache/openjpa/kernel/BrokerImpl.newStateManagerImpl(BrokerImpl.java:1136)\n4XESTACKTRACE          at org/apache/openjpa/kernel/BrokerImpl.find(BrokerImpl.java:826)\n4XESTACKTRACE          at org/apache/openjpa/kernel/BrokerImpl.find(BrokerImpl.java:743)\n4XESTACKTRACE          at org/apache/openjpa/kernel/DelegatingBroker.find(DelegatingBroker.java:169)\n4XESTACKTRACE          at org/apache/openjpa/persistence/EntityManagerImpl.find(EntityManagerImpl.java:346)\n4XESTACKTRACE          at com/ibm/ws/persistence/tests/simple/TestInsertAndFind.test001(TestInsertAndFind.java:51)\n:\n\n3XMTHREADINFO      \"Finalizer thread\" (TID:0x41ED6200, sys_thread_t:0x42299718, state:B, native ID:0x00001078) prio=5\n4XESTACKTRACE          at java/lang/ClassLoader.loadClass(ClassLoader.java:563(Compiled Code))\n4XESTACKTRACE          at java/lang/Class.forNameImpl(Native Method)\n4XESTACKTRACE          at java/lang/Class.forName(Class.java:160(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/lib/util/TemporaryClassLoader.loadClass(TemporaryClassLoader.java:55(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/lib/util/TemporaryClassLoader.loadClass(TemporaryClassLoader.java:40(Compiled Code))\n4XESTACKTRACE          at java/lang/Class.forNameImpl(Native Method)\n4XESTACKTRACE          at java/lang/Class.forName(Class.java:160(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/enhance/PCClassFileTransformer.needsEnhance(PCClassFileTransformer.java:171(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/enhance/PCClassFileTransformer.transform(PCClassFileTransformer.java:117(Compiled Code))\n:\n\nAs the \"find\" operation is performed in the main thread, additional classes need to be loaded to satisfy the request.  As part of that class loading, the runtime enhancement is kicked off to determine whether the classes being loaded need to be enhanced or not.\n\nAs part of this checking, the following conditional is executed:\n\n        if (name.startsWith(\"java.\") || name.startsWith(\"javax.\")\n            || name.startsWith(\"sun.\"))\n            return Class.forName(name, resolve, getClass().getClassLoader());\n\nThis call to Class.forName() eventually requests the same lock that is already in place on the Main thread.  Everytime I hit this deadlock, it's the same stack traces.  And, it's always at the same spot in the testcode.  But, like Vlad and I have mentioned, it doesn't deadlock on every execution.\n\nMy gut reaction at this point is that we have a problem with the IBM JDK.  But, I wanted to post my findings to this Issue to see if this description jogs any memory bits from the original OpenJPA authors.\n\nThanks,\nKevin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-01-10T17:15:56.674+0000","updated":"2007-01-10T17:15:56.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463713","id":"12463713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprudhom","name":"mprudhom","key":"mprudhom","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mprudhom&avatarId=45285","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mprudhom&avatarId=45285","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mprudhom&avatarId=45285","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mprudhom&avatarId=45285"},"displayName":"Marc Prud'hommeaux","active":true,"timeZone":"America/New_York"},"body":"I've never seen any problem like this. It is interesting that the finalizer thread is causing the problem. Do you have a deeper stack for the \"Finalizer thread\"?\n\nAlso, I wonder if running your test with the \"-verbose:class\" would help identify the class in question, and thereby shed some more light on the problem (or alternately putting a printf in TemporaryClassLoader.loadClass()).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprudhom","name":"mprudhom","key":"mprudhom","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mprudhom&avatarId=45285","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mprudhom&avatarId=45285","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mprudhom&avatarId=45285","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mprudhom&avatarId=45285"},"displayName":"Marc Prud'hommeaux","active":true,"timeZone":"America/New_York"},"created":"2007-01-10T20:47:49.554+0000","updated":"2007-01-10T20:47:49.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463732","id":"12463732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"Yes, I already did that printf thing.  It varies on exactly which class is \"caught\", but, of course, it always starts with java.*, or javax.*, or sun.* (since that's the conditional).\n\nAs far as the rest of the call stack...  I attached the javacore to this Issue so you can look at the whole thing.  But, the complete finalizer thread is as follows:\n\n3XMTHREADINFO      \"Finalizer thread\" (TID:0x41ED5F00, sys_thread_t:0x42299718, state:B, native ID:0x0000165C) prio=5\n4XESTACKTRACE          at java/lang/ClassLoader.loadClass(ClassLoader.java:563(Compiled Code))\n4XESTACKTRACE          at java/lang/Class.forNameImpl(Native Method)\n4XESTACKTRACE          at java/lang/Class.forName(Class.java:160(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/lib/util/TemporaryClassLoader.loadClass(TemporaryClassLoader.java:56(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/lib/util/TemporaryClassLoader.loadClass(TemporaryClassLoader.java:40(Compiled Code))\n4XESTACKTRACE          at java/lang/Class.forNameImpl(Native Method)\n4XESTACKTRACE          at java/lang/Class.forName(Class.java:160(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/enhance/PCClassFileTransformer.needsEnhance(PCClassFileTransformer.java:171(Compiled Code))\n4XESTACKTRACE          at org/apache/openjpa/enhance/PCClassFileTransformer.transform(PCClassFileTransformer.java:117(Compiled Code))\n4XESTACKTRACE          at sun/instrument/TransformerManager.transform(TransformerManager.java:141(Compiled Code))\n4XESTACKTRACE          at sun/instrument/InstrumentationImpl.transform(InstrumentationImpl.java:174(Compiled Code))\n4XESTACKTRACE          at com/ibm/oti/vm/VM.findClassOrNull(Native Method)\n4XESTACKTRACE          at com/ibm/oti/vm/BootstrapClassLoader.loadClass(BootstrapClassLoader.java:64(Compiled Code))\n4XESTACKTRACE          at java/lang/ref/ReferenceQueue.enqueue(ReferenceQueue.java:125)\n4XESTACKTRACE          at java/lang/ref/Reference.enqueueImpl(Reference.java:93)\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-01-10T22:08:38.315+0000","updated":"2007-01-10T22:08:38.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463745","id":"12463745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprudhom","name":"mprudhom","key":"mprudhom","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mprudhom&avatarId=45285","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mprudhom&avatarId=45285","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mprudhom&avatarId=45285","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mprudhom&avatarId=45285"},"displayName":"Marc Prud'hommeaux","active":true,"timeZone":"America/New_York"},"body":"I wonder what would happen if we replaced:\n\n   return Class.forName(name, resolve, getClass().getClassLoader());\n\nwith:\n\n  return super.loadClass(name, resolve);\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mprudhom","name":"mprudhom","key":"mprudhom","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mprudhom&avatarId=45285","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mprudhom&avatarId=45285","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mprudhom&avatarId=45285","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mprudhom&avatarId=45285"},"displayName":"Marc Prud'hommeaux","active":true,"timeZone":"America/New_York"},"created":"2007-01-10T22:55:08.316+0000","updated":"2007-01-10T22:55:08.316+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12463755","id":"12463755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"We're thinking along the same lines...  The super.loadClass just ends up in the same ClassLoader.loadClass code with the same deadlock.  Sorry that I didn't post this earlier.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-01-10T23:21:07.413+0000","updated":"2007-01-10T23:21:07.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12466068","id":"12466068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"This looks to be a problem with the IBM JDK.  I reported the problem to IBM and I have just tested a possible fix for the problem.  So far, it looks good.  Since the original problem was intermittent, I guess I can't be sure that it's resolved.  But, after a couple days of testing, it looks to be standing up.  I am checking on the availability of a patch or updated version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-01-19T15:02:13.844+0000","updated":"2007-01-19T15:02:13.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12467396","id":"12467396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"IBM has indicated that the fix will be available in SR5 for JDK 5.  I'm still checking on an interim iFix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-01-25T14:48:14.768+0000","updated":"2007-01-25T14:48:14.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12470287","id":"12470287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"This problem will be resolved in SR5 of the IBM v5 JDK.  The availability of an interim iFix is still being investigated.  The Sun v5 JDK does not seem to exhibit this behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-02-05T17:34:50.516+0000","updated":"2007-02-05T17:34:50.516+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12360119/comment/12516772","id":"12516772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"body":"This problem was resolved with IBM JDK 5 SR 5.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kwsutter","name":"kwsutter","key":"kwsutter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kevin W. Sutter","active":true,"timeZone":"America/Chicago"},"created":"2007-07-31T18:59:34.370+0000","updated":"2007-07-31T18:59:34.370+0000"}],"maxResults":11,"total":11,"startAt":0},"customfield_12311820":"0|i0z1bj:","customfield_12314139":null}}

