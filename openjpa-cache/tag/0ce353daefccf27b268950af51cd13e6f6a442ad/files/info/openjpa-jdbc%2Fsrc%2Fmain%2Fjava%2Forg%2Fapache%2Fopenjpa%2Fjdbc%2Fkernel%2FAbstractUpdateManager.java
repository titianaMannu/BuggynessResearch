{"sha":"f4c9a3a4df3dae4ec90f8dd95d73585cb658f892","node_id":"MDQ6QmxvYjIwNjM2NDpmNGM5YTNhNGRmM2RhZTRlYzkwZjhkZDk1ZDczNTg1Y2I2NThmODky","size":13626,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f4c9a3a4df3dae4ec90f8dd95d73585cb658f892","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29u\nZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5EaXNjcmltaW5hdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WZXJzaW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFT\ndGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLlBDU3RhdGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYu\nQ29uZmlndXJhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5j\nb25mLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CgovKioKICogQmFzZSB1cGRh\ndGUgbWFuYWdlciB3aXRoIGNvbW1vbiBmdW5jdGlvbmFsaXR5LgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEFi\nc3RyYWN0VXBkYXRlTWFuYWdlcgogICAgaW1wbGVtZW50cyBVcGRhdGVNYW5h\nZ2VyLCBDb25maWd1cmFibGUgewoKICAgIHByb3RlY3RlZCBKREJDQ29uZmln\ndXJhdGlvbiBjb25mID0gbnVsbDsKICAgIHByb3RlY3RlZCBEQkRpY3Rpb25h\ncnkgZGljdCA9IG51bGw7CgogICAgcHVibGljIHZvaWQgc2V0Q29uZmlndXJh\ndGlvbihDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICB0aGlzLmNvbmYg\nPSAoSkRCQ0NvbmZpZ3VyYXRpb24pIGNvbmY7CiAgICAgICAgZGljdCA9IHRo\naXMuY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAg\nIHB1YmxpYyBDb2xsZWN0aW9uIGZsdXNoKENvbGxlY3Rpb24gc3RhdGVzLCBK\nREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBz\ndG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VyIHBzTWdyID0gbmV3UHJlcGFy\nZWRTdGF0ZW1lbnRNYW5hZ2VyKHN0b3JlLAogICAgICAgICAgICAgICAgY29u\nbik7CiAgICAgICAgICAgIHJldHVybiBmbHVzaChzdGF0ZXMsIHN0b3JlLCBw\nc01ncik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsg\nY29ubi5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBmbHVzaChD\nb2xsZWN0aW9uIHN0YXRlcywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIFBy\nZXBhcmVkU3RhdGVtZW50TWFuYWdlciBwc01ncikgewogICAgICAgIC8vIHJ1\nbiB0aHJvdWdoIGFsbCB0aGUgc3RhdGVzIGFuZCB1cGRhdGUgdGhlbSBhcyBu\nZWNlc3NhcnkKICAgICAgICBSb3dNYW5hZ2VyIHJvd01nciA9IG5ld1Jvd01h\nbmFnZXIoKTsKICAgICAgICBDb2xsZWN0aW9uIGN1c3RvbXMgPSBuZXcgTGlu\na2VkTGlzdCgpOwogICAgICAgIENvbGxlY3Rpb24gZXhjZXBzID0gbnVsbDsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgZXhjZXBzID0gcG9wdWxh\ndGVSb3dNYW5hZ2VyKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpdHIubmV4dCgp\nLAogICAgICAgICAgICAgICAgcm93TWdyLCBzdG9yZSwgZXhjZXBzLCBjdXN0\nb21zKTsKCiAgICAgICAgLy8gZmx1c2ggcm93cwogICAgICAgIGV4Y2VwcyA9\nIGZsdXNoKHJvd01nciwgcHNNZ3IsIGV4Y2Vwcyk7CgogICAgICAgIC8vIG5v\ndyBkbyBhbnkgY3VzdG9tIG1hcHBpbmdzCiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBjdXN0b21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAoKEN1c3RvbU1h\ncHBpbmcpIGl0ci5uZXh0KCkpLmV4ZWN1dGUoc3RvcmUpOwogICAgICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIGRpY3QpKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkRXhjZXB0aW9uKGV4Y2Vwcywga2UpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyByZXR1cm4gYWxsIGV4Y2VwdGlvbnMKICAgICAg\nICBDb2xsZWN0aW9uIHBzRXhjZXBzID0gcHNNZ3IuZ2V0RXhjZXB0aW9ucygp\nOwogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHBzRXhjZXBzOwogICAgICAgIGlmIChwc0V4Y2VwcyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZXhjZXBzOwogICAgICAgIGV4Y2Vwcy5hZGRB\nbGwocHNFeGNlcHMpOwogICAgICAgIHJldHVybiBleGNlcHM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcge0BsaW5rIFJvd01hbmFnZXJ9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgUm93TWFuYWdlciBu\nZXdSb3dNYW5hZ2VyKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcg\ne0BsaW5rIFByZXBhcmVkU3RhdGVtZW50TWFuYWdlcn0uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBhYnN0cmFjdCBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXIg\nbmV3UHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VyKAogICAgICAgIEpEQkNTdG9y\nZSBzdG9yZSwgQ29ubmVjdGlvbiBjb25uKTsKCiAgICAvKioKICAgICAqIEZs\ndXNoIGFsbCByb3dzIG9mIHRoZSBnaXZlbiByb3cgbWFuYWdlci4gQWRkIGV4\nY2VwdGlvbnMgdG8KICAgICAqIDxjb2RlPmV4Y2VwczwvY29kZT4gKHdoaWNo\nIG1heSBzdGFydCBhcyBudWxsKSB1c2luZwogICAgICoge0BsaW5rICNhZGRF\neGNlcHRpb259LiBSZXR1cm4gPGNvZGU+ZXhjZXBzPC9jb2RlPi4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IENvbGxlY3Rpb24gZmx1c2goUm93\nTWFuYWdlciByb3dNZ3IsCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnRNYW5h\nZ2VyIHBzTWdyLCBDb2xsZWN0aW9uIGV4Y2Vwcyk7CgogICAgLyoqCiAgICAg\nKiBQb3B1bGF0ZSB0aGUgcm93IG1hbmFnZXIgd2l0aCByb3dzIHRvIGJlIGZs\ndXNoZWQgZm9yIHRoZSBnaXZlbiBzdGF0ZS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZXhjZXBzIGV4Y2VwdGlvbnMgZW5jb3VudGVyZWQgd2hlbiBmbHVzaGlu\nZyB3aWxsIGJlIGFkZGVkIHRvCiAgICAgKiB0aGlzIGxpc3QgYW5kIHJldHVy\nbmVkOyB0aGUgbGlzdCBtYXkgYmUgbnVsbCBpbml0aWFsbHkKICAgICAqIEBw\nYXJhbSBjdXN0b21zIGJ1ZmZlciBjdXN0b20gbWFwcGluZ3MKICAgICAqIEBy\nZXR1cm4gdGhlIGV4Y2VwdGlvbnMgbGlzdAogICAgICovCiAgICBwcml2YXRl\nIENvbGxlY3Rpb24gcG9wdWxhdGVSb3dNYW5hZ2VyKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sCiAgICAgICAgUm93TWFuYWdlciByb3dNZ3IsIEpEQkNTdG9y\nZSBzdG9yZSwgQ29sbGVjdGlvbiBleGNlcHMsCiAgICAgICAgQ29sbGVjdGlv\nbiBjdXN0b21zKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQml0U2V0\nIGRpcnR5OwogICAgICAgICAgICBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBD\nU3RhdGUuUE5FVyAmJiAhc20uaXNGbHVzaGVkKCkpIHsKICAgICAgICAgICAg\nICAgIGluc2VydChzbSwgKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEo\nKSwgcm93TWdyLCBzdG9yZSwKICAgICAgICAgICAgICAgICAgICBjdXN0b21z\nKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0g\nUENTdGF0ZS5QTkVXRkxVU0hFRERFTEVURUQKICAgICAgICAgICAgICAgIHx8\nIHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBERUxFVEVEKSB7CiAgICAg\nICAgICAgICAgICBkZWxldGUoc20sIChDbGFzc01hcHBpbmcpIHNtLmdldE1l\ndGFEYXRhKCksIHJvd01nciwgc3RvcmUsCiAgICAgICAgICAgICAgICAgICAg\nY3VzdG9tcyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoKGRpcnR5ID0gSW1w\nbEhlbHBlci5nZXRVcGRhdGVGaWVsZHMoc20pKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICB1cGRhdGUoc20sIGRpcnR5LCAoQ2xhc3NNYXBwaW5nKSBz\nbS5nZXRNZXRhRGF0YSgpLCByb3dNZ3IsCiAgICAgICAgICAgICAgICAgICAg\nc3RvcmUsIGN1c3RvbXMpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNtLmlz\nVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkpIHsKICAgICAgICAgICAgICAgIHVw\nZGF0ZUluZGljYXRvcnMoc20sIChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFE\nYXRhKCksIHJvd01nciwKICAgICAgICAgICAgICAgICAgICBzdG9yZSwgY3Vz\ndG9tcywgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc20uaXNWZXJz\naW9uQ2hlY2tSZXF1aXJlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoISgo\nQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpKS5nZXRWZXJzaW9uKCku\nCiAgICAgICAgICAgICAgICAgICAgY2hlY2tWZXJzaW9uKHNtLCBzdG9yZSwg\nZmFsc2UpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4Y2Vw\ndGlvbihleGNlcHMsIG5ldyBPcHRpbWlzdGljRXhjZXB0aW9uKHNtLgogICAg\nICAgICAgICAgICAgICAgICAgICBnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMs\nIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIGRpY3QpKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGV4\nY2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIGtlKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGV4Y2VwczsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gZXhjZXB0aW9uIHRvIHRoZSBnaXZlbiBsaXN0LCB3aGlj\naCBtYXkgc3RhcnQgb3V0IGFzIG51bGwuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBDb2xsZWN0aW9uIGFkZEV4Y2VwdGlvbihDb2xsZWN0aW9uIGV4Y2Vwcywg\nRXhjZXB0aW9uIGVycikgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCkK\nICAgICAgICAgICAgZXhjZXBzID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAg\nICBleGNlcHMuYWRkKGVycik7CiAgICAgICAgcmV0dXJuIGV4Y2VwczsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBtZXRob2QgdG8gaW5zZXJ0\nIHRoZSBnaXZlbiBpbnN0YW5jZSwgYmFzZSBjbGFzcyBmaXJzdC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBSb3dNYW5hZ2Vy\nIHJvd01nciwgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0aW9uIGN1c3RvbXMp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQm9vbGVh\nbiBjdXN0b20gPSBtYXBwaW5nLmlzQ3VzdG9tSW5zZXJ0KHNtLCBzdG9yZSk7\nCiAgICAgICAgaWYgKCFCb29sZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQog\nICAgICAgICAgICBtYXBwaW5nLmN1c3RvbUluc2VydChzbSwgc3RvcmUpOwog\nICAgICAgIGlmIChjdXN0b20uZXF1YWxzKEJvb2xlYW4uVFJVRSkpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IG1h\ncHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAg\nICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICBpbnNlcnQoc20sIHN1\ncCwgcm93TWdyLCBzdG9yZSwgY3VzdG9tcyk7CgogICAgICAgIG1hcHBpbmcu\naW5zZXJ0KHNtLCBzdG9yZSwgcm93TWdyKTsKICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmaWVsZHMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgQml0U2V0IGRpcnR5ID0gc20uZ2V0RGlydHkoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAoZGlydHkuZ2V0KGZpZWxkc1tpXS5nZXRJbmRl\neCgpKQogICAgICAgICAgICAgICAgJiYgIWJ1ZmZlckN1c3RvbUluc2VydChm\naWVsZHNbaV0sIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAgICAg\nICBmaWVsZHNbaV0uaW5zZXJ0KHNtLCBzdG9yZSwgcm93TWdyKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKSB7CiAgICAgICAgICAgIFZl\ncnNpb24gdmVycyA9IG1hcHBpbmcuZ2V0VmVyc2lvbigpOwogICAgICAgICAg\nICBpZiAoIWJ1ZmZlckN1c3RvbUluc2VydCh2ZXJzLCBzbSwgc3RvcmUsIGN1\nc3RvbXMpKQogICAgICAgICAgICAgICAgdmVycy5pbnNlcnQoc20sIHN0b3Jl\nLCByb3dNZ3IpOwogICAgICAgICAgICBEaXNjcmltaW5hdG9yIGRzYyA9IG1h\ncHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpOwogICAgICAgICAgICBpZiAoIWJ1\nZmZlckN1c3RvbUluc2VydChkc2MsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAg\nICAgICAgICAgICAgICBkc2MuaW5zZXJ0KHNtLCBzdG9yZSwgcm93TWdyKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgZ2l2ZW4g\nbWFwcGluZyB1c2VzIGEgY3VzdG9tIGluc2VydCwgcGxhY2VzIGEKICAgICAq\nIHtAbGluayBDdXN0b21NYXBwaW5nfSBzdHJ1Y3QgZm9yIGl0IGluIHRoZSBn\naXZlbiBjb2xsZWN0aW9uIGFuZAogICAgICogcmV0dXJucyB0cnVlLCBlbHNl\nIHJldHVybnMgZmFsc2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBi\ndWZmZXJDdXN0b21JbnNlcnQoU3RyYXRlZ3kgc3RyYXQsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0\naW9uIGN1c3RvbXMpIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IHN0cmF0\nLmlzQ3VzdG9tSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKCFCb29s\nZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAgICAgICBjdXN0b21z\nLmFkZChuZXcgQ3VzdG9tTWFwcGluZyhDdXN0b21NYXBwaW5nLklOU0VSVCwg\nc20sIHN0cmF0KSk7CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRS5lcXVh\nbHMoY3VzdG9tKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBt\nZXRob2QgdG8gZGVsZXRlIHRoZSBnaXZlbiBpbnN0YW5jZSwgYmFzZSBjbGFz\ncyBsYXN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZGVsZXRlKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAg\nICAgIFJvd01hbmFnZXIgcm93TWdyLCBKREJDU3RvcmUgc3RvcmUsIENvbGxl\nY3Rpb24gY3VzdG9tcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBCb29sZWFuIGN1c3RvbSA9IG1hcHBpbmcuaXNDdXN0b21EZWxl\ndGUoc20sIHN0b3JlKTsKICAgICAgICBpZiAoIUJvb2xlYW4uRkFMU0UuZXF1\nYWxzKGN1c3RvbSkpCiAgICAgICAgICAgIG1hcHBpbmcuY3VzdG9tRGVsZXRl\nKHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMo\nY3VzdG9tKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmaWVsZHMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBp\nbmdzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tRGVsZXRl\nKGZpZWxkc1tpXSwgc20sIHN0b3JlLCBjdXN0b21zKSkKICAgICAgICAgICAg\nICAgIGZpZWxkc1tpXS5kZWxldGUoc20sIHN0b3JlLCByb3dNZ3IpOwoKICAg\nICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwID09IG51bGwp\nIHsKICAgICAgICAgICAgVmVyc2lvbiB2ZXJzID0gbWFwcGluZy5nZXRWZXJz\naW9uKCk7CiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tRGVsZXRlKHZl\ncnMsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAgICAgICB2ZXJz\nLmRlbGV0ZShzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAgICAgIERpc2Ny\naW1pbmF0b3IgZHNjID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCk7CiAg\nICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tRGVsZXRlKGRzYywgc20sIHN0\nb3JlLCBjdXN0b21zKSkKICAgICAgICAgICAgICAgIGRzYy5kZWxldGUoc20s\nIHN0b3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgICAgICBtYXBwaW5nLmRl\nbGV0ZShzbSwgc3RvcmUsIHJvd01ncik7CgogICAgICAgIGlmIChzdXAgIT0g\nbnVsbCkKICAgICAgICAgICAgZGVsZXRlKHNtLCBzdXAsIHJvd01nciwgc3Rv\ncmUsIGN1c3RvbXMpOwogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjYnVm\nZmVyQ3VzdG9tSW5zZXJ0CiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBi\ndWZmZXJDdXN0b21EZWxldGUoU3RyYXRlZ3kgc3RyYXQsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0\naW9uIGN1c3RvbXMpIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IHN0cmF0\nLmlzQ3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKCFCb29s\nZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAgICAgICBjdXN0b21z\nLmFkZChuZXcgQ3VzdG9tTWFwcGluZyhDdXN0b21NYXBwaW5nLkRFTEVURSwg\nc20sIHN0cmF0KSk7CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRS5lcXVh\nbHMoY3VzdG9tKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBt\nZXRob2QgdG8gdXBkYXRlIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBCaXRTZXQgZGlydHksCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nIFJvd01hbmFnZXIgcm93TWdyLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAg\nQ29sbGVjdGlvbiBjdXN0b21zKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBCb29sZWFuIGN1c3RvbSA9IG1hcHBpbmcuaXNDdXN0b21VcGRhdGUo\nc20sIHN0b3JlKTsKICAgICAgICBpZiAoIUJvb2xlYW4uRkFMU0UuZXF1YWxz\nKGN1c3RvbSkpCiAgICAgICAgICAgIG1hcHBpbmcuY3VzdG9tVXBkYXRlKHNt\nLCBzdG9yZSk7CiAgICAgICAgaWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMoY3Vz\ndG9tKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyB1cGRhdGUg\nYWxsIGZpZWxkcyBiZWZvcmUgYWxsIG1hcHBpbmdzIHNvIHRoYXQgdGhlIG1h\ncHBpbmdzIGNhbgogICAgICAgIC8vIGRldGVjdCB3aGV0aGVyIGFueSBmaWVs\nZHMgaW4gdGhlaXIgcm93cyBoYXZlIGJlZW4gbW9kaWZpZWQKICAgICAgICBG\naWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVs\nZE1hcHBpbmdzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVs\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGRpcnR5LmdldChm\naWVsZHNbaV0uZ2V0SW5kZXgoKSkKICAgICAgICAgICAgICAgICYmICFidWZm\nZXJDdXN0b21VcGRhdGUoZmllbGRzW2ldLCBzbSwgc3RvcmUsIGN1c3RvbXMp\nKQogICAgICAgICAgICAgICAgZmllbGRzW2ldLnVwZGF0ZShzbSwgc3RvcmUs\nIHJvd01ncik7CiAgICAgICAgfQoKICAgICAgICBDbGFzc01hcHBpbmcgc3Vw\nID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsK\nICAgICAgICBpZiAoc3VwID09IG51bGwpCiAgICAgICAgICAgIHVwZGF0ZUlu\nZGljYXRvcnMoc20sIG1hcHBpbmcsIHJvd01nciwgc3RvcmUsIGN1c3RvbXMs\nIGZhbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHVwZGF0ZShzbSwg\nZGlydHksIHN1cCwgcm93TWdyLCBzdG9yZSwgY3VzdG9tcyk7CiAgICAgICAg\nbWFwcGluZy51cGRhdGUoc20sIHN0b3JlLCByb3dNZ3IpOwogICAgfQoKICAg\nIC8qKgogICAgICogVXBkYXRlIHZlcnNpb24gYW5kIGRpc2NyaW1pbmF0b3Ig\naW5kaWNhdG9ycy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUlu\nZGljYXRvcnMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsCiAgICAgICAgUm93TWFuYWdlciByb3dNZ3IsIEpEQkNTdG9y\nZSBzdG9yZSwgQ29sbGVjdGlvbiBjdXN0b21zLAogICAgICAgIGJvb2xlYW4g\ndmVyc2lvblVwZGF0ZU9ubHkpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoaWxlIChtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpICE9IG51bGwpCiAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAgICBW\nZXJzaW9uIHZlcnMgPSBtYXBwaW5nLmdldFZlcnNpb24oKTsKICAgICAgICBp\nZiAoIWJ1ZmZlckN1c3RvbVVwZGF0ZSh2ZXJzLCBzbSwgc3RvcmUsIGN1c3Rv\nbXMpKQogICAgICAgICAgICB2ZXJzLnVwZGF0ZShzbSwgc3RvcmUsIHJvd01n\ncik7CgogICAgICAgIGlmICh2ZXJzaW9uVXBkYXRlT25seSkgewogICAgICAg\nICAgICAvLyBpZiB3ZSBhcmUgb25seSB1cGRhdGluZyB0aGUgdmVyc2lvbiBj\nb2x1bW4sIHdlIG5lZWQgdG8gYWRkCiAgICAgICAgICAgIC8vIGluIHRoZSBw\ncmltYXJ5IGtleSBzZWxlY3QKICAgICAgICAgICAgbWFwcGluZy51cGRhdGUo\nc20sIHN0b3JlLCByb3dNZ3IpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIC8vIG90aGVyd2lzZSB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB3ZSB1cGRh\ndGUgdGhlIGRpc2NyaW1pbmF0b3IgdG9vCiAgICAgICAgICAgIERpc2NyaW1p\nbmF0b3IgZHNjID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCk7CiAgICAg\nICAgICAgIGlmICghYnVmZmVyQ3VzdG9tVXBkYXRlKGRzYywgc20sIHN0b3Jl\nLCBjdXN0b21zKSkKICAgICAgICAgICAgICAgIGRzYy51cGRhdGUoc20sIHN0\nb3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEBzZWUgI2J1ZmZlckN1c3RvbUluc2VydAogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gYnVmZmVyQ3VzdG9tVXBkYXRlKFN0cmF0ZWd5IHN0cmF0LCBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgQ29sbGVjdGlvbiBjdXN0b21zKSB7CiAgICAgICAgQm9vbGVhbiBjdXN0\nb20gPSBzdHJhdC5pc0N1c3RvbVVwZGF0ZShzbSwgc3RvcmUpOwogICAgICAg\nIGlmICghQm9vbGVhbi5GQUxTRS5lcXVhbHMoY3VzdG9tKSkKICAgICAgICAg\nICAgY3VzdG9tcy5hZGQobmV3IEN1c3RvbU1hcHBpbmcoQ3VzdG9tTWFwcGlu\nZy5VUERBVEUsIHNtLCBzdHJhdCkpOwogICAgICAgIHJldHVybiBCb29sZWFu\nLlRSVUUuZXF1YWxzKGN1c3RvbSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBF\neGVjdXRlcyBjdXN0b21pemVkIG1hcHBpbmcgdXBkYXRlcy4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ3VzdG9tTWFwcGluZyB7CgogICAg\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElOU0VSVCA9IDA7CiAgICAg\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVVBEQVRFID0gMTsKICAgICAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBERUxFVEUgPSAzOwoKICAgICAg\nICBwcml2YXRlIGZpbmFsIGludCBfYWN0aW9uOwogICAgICAgIHByaXZhdGUg\nZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBfc207CiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBTdHJhdGVneSBfc3RyYXQ7CgogICAgICAgIHB1YmxpYyBDdXN0\nb21NYXBwaW5nKGludCBhY3Rpb24sIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIFN0cmF0ZWd5IHN0cmF0KSB7CiAgICAgICAgICAgIF9hY3Rpb24gPSBhY3Rp\nb247CiAgICAgICAgICAgIF9zbSA9IHNtOwogICAgICAgICAgICBfc3RyYXQg\nPSBzdHJhdDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGV4ZWN1\ndGUoSkRCQ1N0b3JlIHN0b3JlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgc3dpdGNoIChfYWN0aW9uKSB7CiAgICAgICAgICAgIGNhc2Ug\nSU5TRVJUOgogICAgICAgICAgICAgICAgX3N0cmF0LmN1c3RvbUluc2VydChf\nc20sIHN0b3JlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIFVQREFURToKICAgICAgICAgICAgICAgIF9zdHJhdC5jdXN0b21V\ncGRhdGUoX3NtLCBzdG9yZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBERUxFVEU6CiAgICAgICAgICAgICAgICBfc3RyYXQu\nY3VzdG9tRGVsZXRlKF9zbSwgc3RvcmUpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

