{"sha":"62d837b2c9d9701840a5d51ed1d62ec7185011ff","node_id":"MDQ6QmxvYjIwNjM2NDo2MmQ4MzdiMmM5ZDk3MDE4NDBhNWQ1MWVkMWQ2MmVjNzE4NTAxMWZm","size":51858,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/62d837b2c9d9701840a5d51ed1d62ec7185011ff","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9y\ndCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNl\ncHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7CmltcG9ydCBqYXZh\nLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBv\ncnQgamF2YXguc3FsLkRhdGFTb3VyY2U7CgppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmV2ZW50Lk9ycGhhbmVkS2V5QWN0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5EaXNjcmlt\naW5hdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5G\naWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pblN5bnRheGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5TUUxFeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlNRTEZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlNlbGVjdEV4ZWN1dG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLlVuaW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tNYW5hZ2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVRdWVyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNz\naW9uUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJj\nLkRlbGVnYXRpbmdDb25uZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nU3Rh\ndGVtZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuTWVy\nZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnJvcC5SZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAq\nIFN0b3JlTWFuYWdlciBwbHVnaW4gdGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUg\ncGVyc2lzdGVudCBkYXRhIGluIGEKICogcmVsYXRpb25hbCBkYXRhIHN0b3Jl\nLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgSkRCQ1N0b3JlTWFuYWdlciAKICAgIGltcGxlbWVudHMg\nU3RvcmVNYW5hZ2VyLCBKREJDU3RvcmUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoSkRCQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0\nZSBTdG9yZUNvbnRleHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkND\nb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgREJEaWN0\naW9uYXJ5IF9kaWN0ID0gbnVsbDsKICAgIHByaXZhdGUgU1FMRmFjdG9yeSBf\nc3FsID0gbnVsbDsKICAgIHByaXZhdGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9\nIG51bGw7CiAgICBwcml2YXRlIERhdGFTb3VyY2UgX2RzID0gbnVsbDsKICAg\nIHByaXZhdGUgUmVmQ291bnRDb25uZWN0aW9uIF9jb25uID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfYWN0aXZlID0gZmFsc2U7CgogICAgLy8gdHJh\nY2sgdGhlIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRo\nZW0KICAgIHByaXZhdGUgU2V0IF9zdG1udHMgPSBDb2xsZWN0aW9ucy5zeW5j\naHJvbml6ZWRTZXQobmV3IEhhc2hTZXQoKSk7CgogICAgcHVibGljIFN0b3Jl\nQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBfY3R4Owog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0\nIGN0eCkgewogICAgICAgIF9jdHggPSBjdHg7CiAgICAgICAgX2NvbmYgPSAo\nSkRCQ0NvbmZpZ3VyYXRpb24pIGN0eC5nZXRDb25maWd1cmF0aW9uKCk7CiAg\nICAgICAgX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgp\nOwogICAgICAgIF9zcWwgPSBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2Uo\nKTsKCiAgICAgICAgTG9ja01hbmFnZXIgbG0gPSBjdHguZ2V0TG9ja01hbmFn\nZXIoKTsKICAgICAgICBpZiAobG0gaW5zdGFuY2VvZiBKREJDTG9ja01hbmFn\nZXIpCiAgICAgICAgICAgIF9sbSA9IChKREJDTG9ja01hbmFnZXIpIGxtOwoK\nICAgICAgICBpZiAoIWN0eC5pc01hbmFnZWQoKSAmJiBfY29uZi5pc0Nvbm5l\nY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgX2RzID0g\nX2NvbmYuZ2V0RGF0YVNvdXJjZTIoY3R4KTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3VyY2UoY3R4KTsKCiAgICAg\nICAgaWYgKF9jb25mLmdldFVwZGF0ZU1hbmFnZXJJbnN0YW5jZSgpLm9yZGVy\nRGlydHkoKSkKICAgICAgICAgICAgY3R4LnNldE9yZGVyRGlydHlPYmplY3Rz\nKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBn\nZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAg\nIH0KCiAgICBwdWJsaWMgREJEaWN0aW9uYXJ5IGdldERCRGljdGlvbmFyeSgp\nIHsKICAgICAgICByZXR1cm4gX2RpY3Q7CiAgICB9CgogICAgcHVibGljIFNR\nTEZhY3RvcnkgZ2V0U1FMRmFjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX3Nx\nbDsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0xvY2tNYW5hZ2VyIGdldExvY2tN\nYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfbG07CiAgICB9CgogICAgcHVi\nbGljIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCkgewogICAgICAgIHJldHVybiAoSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbikgX2N0eC5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBiZWdpbk9wdGltaXN0aWMoKSB7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcm9sbGJhY2tPcHRpbWlzdGljKCkgewogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGJlZ2luKCkgewogICAgICAgIF9hY3RpdmUgPSB0cnVlOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoIV9jdHguaXNNYW5hZ2Vk\nKCkgfHwgIV9jb25mLmlzQ29ubmVjdGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgp\nKQogICAgICAgICAgICAgICAgJiYgX2Nvbm4uZ2V0QXV0b0NvbW1pdCgpKQog\nICAgICAgICAgICAgICAgX2Nvbm4uc2V0QXV0b0NvbW1pdChmYWxzZSk7CiAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAg\nIF9hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0\naW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBjb21taXQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5l\nY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgIF9j\nb25uLmNvbW1pdCgpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX2Nvbm4u\ncm9sbGJhY2soKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlMikgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIC8v\nIGFscmVhZHkgcm9sbGVkIGJhY2sgb3Vyc2VsdmVzPwogICAgICAgIGlmICgh\nX2FjdGl2ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbAogICAgICAgICAgICAgICAg\nJiYgKCFfY3R4LmlzTWFuYWdlZCgpIHx8ICFfY29uZgogICAgICAgICAgICAg\nICAgICAgIC5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9kZU1hbmFnZWQoKSkpCiAg\nICAgICAgICAgICAgICBfY29ubi5yb2xsYmFjaygpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXRhaW5Db25uZWN0aW9uKCkgewog\nICAgICAgIGNvbm5lY3QoZmFsc2UpOwogICAgICAgIF9jb25uLnNldFJldGFp\nbih0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlQ29ubmVj\ndGlvbigpIHsKICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbCkKICAgICAgICAg\nICAgX2Nvbm4uc2V0UmV0YWluKGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGdldENsaWVudENvbm5lY3Rpb24oKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBDbGllbnRDb25uZWN0aW9uKGdldENvbm5lY3Rpb24oKSk7CiAgICB9\nCgogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29ubmVjdGlvbigpIHsKICAg\nICAgICBjb25uZWN0KHRydWUpOwogICAgICAgIHJldHVybiBfY29ubjsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hl\ncmUgY29uZGl0aW9ucyBvbiBiYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlm\nIHN1YmNsYXNzCiAgICAgICAgLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50\naWZpZXIKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01h\ncHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIGV4aXN0\ncyhtYXBwaW5nLCBzbS5nZXRPYmplY3RJZCgpLCBjb250ZXh0KTsKICAgIH0K\nCiAgICBwcml2YXRlIGJvb2xlYW4gZXhpc3RzKENsYXNzTWFwcGluZyBtYXBw\naW5nLCBPYmplY3Qgb2lkLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8v\nIGFkZCB3aGVyZSBjb25kaXRpb25zIG9uIGJhc2UgY2xhc3MgdG8gYXZvaWQg\nam9pbnMgaWYgc3ViY2xhc3MKICAgICAgICAvLyBkb2Vzbid0IHVzZSBvaWQg\nYXMgaWRlbnRpZmllcgogICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1Nl\nbGVjdCgpOwogICAgICAgIHdoaWxlIChtYXBwaW5nLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIG1hcHBp\nbmcgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nOwoKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywg\ndGhpcyk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHNlbC5n\nZXRDb3VudCh0aGlzKSAhPSAwOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdl\ndFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIHN5bmNWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLmdldFZlcnNpb24o\nKS5jaGVja1ZlcnNpb24oc20sIHRoaXMsIHRydWUpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBpbnQgY29tcGFyZVZlcnNpb24oT3BlbkpQQVN0YXRl\nTWFuYWdlciBzdGF0ZSwgT2JqZWN0IHYxLCBPYmplY3QgdjIpIHsKICAgICAg\nICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHN0YXRl\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVy\nc2lvbigpLmNvbXBhcmVWZXJzaW9uKHYxLCB2Mik7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBQQ1N0YXRlIHN0YXRlLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBDb25uZWN0aW9uSW5m\nbyBpbmZvID0gKENvbm5lY3Rpb25JbmZvKSBjb250ZXh0OwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBpbml0aWFsaXplU3RhdGUoc20sIHN0\nYXRlLCAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbilmZXRjaCwgCiAgICAgICAg\nICAgICAgICBpbmZvKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3Rv\ncmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbml0aWFsaXplIGEgbmV3bHktbG9hZGVkIGluc3RhbmNlLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gaW5pdGlhbGl6ZVN0YXRlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIFBDU3RhdGUgc3RhdGUsCiAgICAgICAgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgQ29ubmVjdGlvbkluZm8gaW5mbykK\nICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0T2JqZWN0SWQo\nKTsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBp\nbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGluZm8gIT0gbnVs\nbCAmJiBpbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBy\nZXMgPSBpbmZvLnJlc3VsdDsKICAgICAgICAgICAgICAgIGluZm8uc20gPSBz\nbTsKICAgICAgICAgICAgICAgIGlmIChpbmZvLm1hcHBpbmcgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwog\nICAgICAgICAgICAgICAgbWFwcGluZyA9IGluZm8ubWFwcGluZzsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQKICAg\nICAgICAgICAgICAgICYmICEoKE9wZW5KUEFJZCkgb2lkKS5oYXNTdWJjbGFz\nc2VzKCkpIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3Vz\ndG9tTG9hZChzbSwgbWFwcGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAg\nICAgICAgIGlmIChjdXN0b20gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gY3VzdG9tLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAg\nICAgcmVzID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5n\nLCBmZXRjaCwKICAgICAgICAgICAgICAgICAgICBTZWxlY3QuU1VCU19FWEFD\nVCk7CiAgICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVj\ndFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAocmVz\nICE9IG51bGwgJiYgIXJlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3MgPSBtYXBwaW5nLgogICAg\nICAgICAgICAgICAgICAgIGdldEluZGVwZW5kZW50QXNzaWduYWJsZU1hcHBp\nbmdzKCk7CiAgICAgICAgICAgICAgICBpZiAobWFwcGluZ3MubGVuZ3RoID09\nIDEpIHsKICAgICAgICAgICAgICAgICAgICBtYXBwaW5nID0gbWFwcGluZ3Nb\nMF07CiAgICAgICAgICAgICAgICAgICAgQm9vbGVhbiBjdXN0b20gPSBjdXN0\nb21Mb2FkKHNtLCBtYXBwaW5nLCBzdGF0ZSwgZmV0Y2gpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChjdXN0b20gIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGN1c3RvbS5ib29sZWFuVmFsdWUoKTsKICAgICAg\nICAgICAgICAgICAgICByZXMgPSBnZXRJbml0aWFsaXplU3RhdGVSZXN1bHQo\nc20sIG1hcHBpbmcsIGZldGNoLAogICAgICAgICAgICAgICAgICAgICAgICBT\nZWxlY3QuU1VCU19BTllfSk9JTkFCTEUpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChyZXMgPT0gbnVsbCAmJiAhc2VsZWN0UHJpbWFyeUtleShzbSwgbWFw\ncGluZywgZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAg\nICAgICByZXMgPSBnZXRJbml0aWFsaXplU3RhdGVVbmlvblJlc3VsdChzbSwg\nbWFwcGluZywgbWFwcGluZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgIGZl\ndGNoKTsKICAgICAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAhcmVz\nLm5leHQoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZpZ3VyZSBvdXQgd2hhdCB0\neXBlIG9mIG9iamVjdCB0aGlzIGlzOyB0aGUgc3RhdGUgbWFuYWdlcgogICAg\nICAgICAgICAvLyBvbmx5IGd1YXJhbnRlZXMgdG8gcHJvdmlkZSBhIGJhc2Ug\nY2xhc3MKICAgICAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAgICAgICAgaWYg\nKHJlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgdHlwZSA9IG1hcHBpbmcu\nZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIGlmIChyZXMuZ2V0QmFzZU1hcHBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIG1hcHBpbmcgPSByZXMuZ2V0QmFzZU1hcHBp\nbmcoKTsKICAgICAgICAgICAgICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KG1h\ncHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG1hcHBpbmcuZ2V0RGlz\nY3JpbWluYXRvcigpLmdldENsYXNzKHRoaXMsIG1hcHBpbmcsCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcyk7CiAgICAgICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgICAgIHJlcy5lbmREYXRhUmVxdWVzdCgp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBpbml0aWFsaXplIHRoZSBzdGF0ZSBtYW5hZ2VyOyB0aGlzIG1heSBj\naGFuZ2UgdGhlIG1hcHBpbmcKICAgICAgICAgICAgLy8gYW5kIHRoZSBvYmpl\nY3QgaWQgaW5zdGFuY2UgaWYgdGhlIHR5cGUgYXMgZGV0ZXJtaW5lZAogICAg\nICAgICAgICAvLyBmcm9tIHRoZSBpbmRpY2F0b3IgaXMgYSBzdWJjbGFzcyBv\nZiBleHBlY3RlZCB0eXBlCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUodHlw\nZSwgc3RhdGUpOwoKICAgICAgICAgICAgLy8gbG9hZCB0aGUgc2VsZWN0ZWQg\nbWFwcGluZ3MgaW50byB0aGUgZ2l2ZW4gc3RhdGUgbWFuYWdlcgogICAgICAg\nICAgICBpZiAocmVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHJl\nLWdldCB0aGUgbWFwcGluZyBpbiBjYXNlIHRoZSBpbnN0YW5jZSB3YXMgYSBz\ndWJjbGFzcwogICAgICAgICAgICAgICAgbWFwcGluZyA9IChDbGFzc01hcHBp\nbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICBsb2FkKG1h\ncHBpbmcsIHNtLCBmZXRjaCwgcmVzKTsKICAgICAgICAgICAgICAgIG1hcHBp\nbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmIChpbmZvID09\nIG51bGwgfHwgcmVzICE9IGluZm8ucmVzdWx0KSkKICAgICAgICAgICAgICAg\nIHJlcy5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHRoZSBtYXBwaW5nIHRvIGN1c3RvbSBsb2FkIGRhdGEuIFJldHVy\nbiBudWxsIGlmIHRoZSBtYXBwaW5nCiAgICAgKiBkb2VzIG5vdCB1c2UgY3Vz\ndG9tIGxvYWRpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiBjdXN0\nb21Mb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBt\nYXBwaW5nLAogICAgICAgIFBDU3RhdGUgc3RhdGUsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRF\neGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gY2hlY2sgdG8g\nc2VlIGlmIHRoZSBtYXBwaW5nIHRha2VzIGNhcmUgb2YgaW5pdGlhbGl6YXRp\nb24KICAgICAgICBpZiAoIW1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywg\nc3RhdGUsIGZldGNoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpICE9IG51bGwpIHsKICAg\nICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNtLCB0\naGlzKTsKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZWxlY3QgdGhlIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0\nYW5jZSBhbmQgcmV0dXJuIHRoZSByZXN1bHQuIFJldHVybgogICAgICogbnVs\nbCBpZiB0aGVyZSBpcyBubyBkYXRhIGluIHRoZSBjdXJyZW50IGZldGNoIGdy\nb3VwcyB0byBzZWxlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0IGdl\ndEluaXRpYWxpemVTdGF0ZVJlc3VsdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgc3VicykKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxl\nY3QoKTsKICAgICAgICBpZiAoIXNlbGVjdChzZWwsIG1hcHBpbmcsIHN1YnMs\nIHNtLCBudWxsLCBmZXRjaCwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbi5FQUdFUl9KT0lOLCB0cnVlLCBmYWxzZSkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNt\nLmdldE9iamVjdElkKCksIG1hcHBpbmcsIHRoaXMpOwogICAgICAgIHJldHVy\nbiBzZWwuZXhlY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZWxlY3QgYSB1bmlvbiBvZiB0aGUgZGF0YSBmb3IgdGhlIGdpdmVu\nIGluc3RhbmNlIGZyb20gcG9zc2libGUgY29uY3JldGUKICAgICAqIG1hcHBp\nbmdzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KICAgICAqLwogICAgcHJpdmF0\nZSBSZXN1bHQgZ2V0SW5pdGlhbGl6ZVN0YXRlVW5pb25SZXN1bHQoZmluYWwg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01hcHBpbmcg\nbWFwcGluZywgZmluYWwgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3MsCiAgICAg\nICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgSkRCQ1N0b3JlTWFuYWdl\nciBzdG9yZSA9IHRoaXM7CiAgICAgICAgZmluYWwgaW50IGVhZ2VyID0gTWF0\naC5taW4oZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUoKSwKICAgICAgICAgICAg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKTsKCiAgICAgICAg\nVW5pb24gdW5pb24gPSBfc3FsLm5ld1VuaW9uKG1hcHBpbmdzLmxlbmd0aCk7\nCiAgICAgICAgdW5pb24uc2V0U2luZ2xlUmVzdWx0KHRydWUpOwogICAgICAg\nIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBm\nZXRjaC5FQUdFUl9KT0lOKQogICAgICAgICAgICB1bmlvbi5hYm9ydFVuaW9u\nKCk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3Rvcigp\nIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWws\nIGludCBpKSB7CiAgICAgICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmdz\nW2ldLCBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEUsIHN0b3JlLCBmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICBlYWdlcik7CiAgICAgICAgICAgICAgICBz\nZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmdz\nW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAg\nICByZXR1cm4gdW5pb24uZXhlY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZWxlY3QgcHJpbWFyeSBrZXkgZGF0YSB0byBtYWtl\nIHN1cmUgdGhlIGdpdmVuIGluc3RhbmNlIGV4aXN0cywgbG9ja2luZwogICAg\nICogaWYgbmVlZGVkLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc2Vs\nZWN0UHJpbWFyeUtleShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIC8vIHNlbGVjdCBwa3MgZnJvbSBiYXNlIGNsYXNzIHJlY29yZCB0byBlbnN1\ncmUgaXQgZXhpc3RzIGFuZCBsb2NrCiAgICAgICAgLy8gaXQgaWYgbmVlZGVk\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2UgPSBtYXBwaW5nOwogICAgICAg\nIHdoaWxlIChiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nICE9IG51bGwpCiAgICAgICAgICAgIGJhc2UgPSBiYXNlLmdldEpvaW5hYmxl\nUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAgICBTZWxlY3Qgc2VsID0g\nX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBzZWwuc2VsZWN0KGJhc2UuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKSk7CiAgICAgICAgc2VsLndoZXJlUHJpbWFy\neUtleShzbS5nZXRPYmplY3RJZCgpLCBiYXNlLCB0aGlzKTsKICAgICAgICBS\nZXN1bHQgZXhpc3RzID0gc2VsLmV4ZWN1dGUodGhpcywgZmV0Y2gpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghZXhpc3RzLm5leHQoKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHJl\nY29yZCBsb2NrZWQ/CiAgICAgICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAh\nPSBudWxsICYmIGV4aXN0cy5pc0xvY2tpbmcoKSkKICAgICAgICAgICAgICAg\nIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBleGlzdHMu\nY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAog\nICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZl\nbCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGpmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRj\naDsKCiAgICAgICAgLy8gZ2V0IGEgY29ubmVjdGlvbiwgb3IgcmV1c2UgY3Vy\ncmVudCBvbmUKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5l\nY3Rpb25JbmZvKSBjb250ZXh0OwogICAgICAgIFJlc3VsdCByZXMgPSBudWxs\nOwogICAgICAgIGlmIChpbmZvICE9IG51bGwpIHsKICAgICAgICAgICAgLy8g\naWYgaW5pdGlhbGl6ZSgpIGZhaWxzIHRvIGxvYWQgcmVxdWlyZWQgZmllbGRz\nLCB0aGVuIHRoaXMgbWV0aG9kCiAgICAgICAgICAgIC8vIGlzIGNhbGxlZDsg\nbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8gdXNlIHRoZSBnaXZlbiByZXN1bHQg\naWYgaXQncwogICAgICAgICAgICAvLyB0aGUgc2FtZSBvbmUgd2UganVzdCBm\nYWlsZWQgdG8gY29tcGxldGVseSBpbml0aWFsaXplKCkgd2l0aAogICAgICAg\nICAgICBpZiAoaW5mby5zbSAhPSBzbSkKICAgICAgICAgICAgICAgIHJlcyA9\nIGluZm8ucmVzdWx0OwogICAgICAgICAgICBpbmZvLnNtID0gbnVsbDsKICAg\nICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgdGhlcmUn\ncyBhbiBleGlzdGluZyByZXN1bHQsIGxvYWQgYWxsIHdlIGNhbiBmcm9tIGl0\nCiAgICAgICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFw\ncGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHJlcyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBq\nZmV0Y2gsIHJlcyk7CiAgICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVs\nZHMoc20sIGZpZWxkcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGlmIHRoZSBpbnN0YW5jZSBpcyBob2xsb3cgYW5kIHRoZXJlJ3MgYSBjdXN0\nb21pemVkCiAgICAgICAgICAgIC8vIGdldCBieSBpZCBtZXRob2QsIHVzZSBp\ndAogICAgICAgICAgICBpZiAoc20uZ2V0TG9hZGVkKCkubGVuZ3RoKCkgPT0g\nMCAKICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuY3VzdG9tTG9hZChzbSwg\ndGhpcywgbnVsbCwgamZldGNoKSkKICAgICAgICAgICAgICAgIHJlbW92ZUxv\nYWRlZEZpZWxkcyhzbSwgZmllbGRzKTsKCiAgICAgICAgICAgIC8vIyMjIHNl\nbGVjdCBpcyBraW5kIG9mIGEgYmlnIG9iamVjdCwgYW5kIGluIHNvbWUgY2Fz\nZXMgd2UgZG9uJ3QKICAgICAgICAgICAgLy8jIyMgdXNlIGl0Li4uIHdvdWxk\nIGl0IGJlIHdvcnRoIGl0IHRvIGhhdmUgYSBzbWFsbCBzaGVsbCBzZWxlY3QK\nICAgICAgICAgICAgLy8jIyMgb2JqZWN0IHRoYXQgb25seSBjcmVhdGVzIGEg\ncmVhbCBzZWxlY3Qgd2hlbiBhY3R1YWxseSB1c2VkPwoKICAgICAgICAgICAg\nU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIGlm\nIChzZWxlY3Qoc2VsLCBtYXBwaW5nLCBTZWxlY3QuU1VCU19FWEFDVCwgc20s\nIGZpZWxkcywgamZldGNoLAogICAgICAgICAgICAgICAgRWFnZXJGZXRjaE1v\nZGVzLkVBR0VSX0pPSU4sIHRydWUsIGZhbHNlKSkgewogICAgICAgICAgICAg\nICAgc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBw\naW5nLCB0aGlzKTsKICAgICAgICAgICAgICAgIHJlcyA9IHNlbC5leGVjdXRl\nKHRoaXMsIGpmZXRjaCwgbG9ja0xldmVsKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXMubmV4dCgpKQogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nICAgICAgICAgbG9hZChtYXBwaW5nLCBzbSwgamZldGNoLCByZXMpOwogICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBy\nZXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gbm93IGFsbG93IHRoZSBmaWVsZHMgdG8gbG9hZCB0\naGVtc2VsdmVzIGluZGl2aWR1YWxseSB0b28KICAgICAgICAgICAgRmllbGRN\nYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkcy5nZXQoaSkgJiYgIXNtLmdl\ndExvYWRlZCgpLmdldChpKSkKICAgICAgICAgICAgICAgICAgICBmbXNbaV0u\nbG9hZChzbSwgdGhpcywgamZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pKTsK\nICAgICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNt\nLCB0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBj\nYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cg\nU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGxpc3QgZm9ybWVkIGJ5\nIHJlbW92aW5nIGFsbCBsb2FkZWQgZmllbGRzIGZyb20gdGhlIGdpdmVuIG9u\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUxvYWRlZEZpZWxk\ncyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzKSB7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IGZpZWxkcy5sZW5ndGgoKTsg\naSA8IGxlbjsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAm\nJiBzbS5nZXRMb2FkZWQoKS5nZXQoaSkpCiAgICAgICAgICAgICAgICBmaWVs\nZHMuY2xlYXIoaSk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gbG9h\nZEFsbChDb2xsZWN0aW9uIHNtcywgUENTdGF0ZSBzdGF0ZSwgaW50IGxvYWQs\nCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29u\ndGV4dCkgewogICAgICAgIHJldHVybiBJbXBsSGVscGVyLmxvYWRBbGwoc21z\nLCB0aGlzLCBzdGF0ZSwgbG9hZCwgZmV0Y2gsIGNvbnRleHQpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGJlZm9yZVN0YXRlQ2hhbmdlKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIFBDU3RhdGUgZnJvbVN0YXRlLAogICAgICAgIFBDU3Rh\ndGUgdG9TdGF0ZSkgewogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGZs\ndXNoKENvbGxlY3Rpb24gc21zKSB7CiAgICAgICAgcmV0dXJuIF9jb25mLmdl\ndFVwZGF0ZU1hbmFnZXJJbnN0YW5jZSgpLmZsdXNoKHNtcywgdGhpcyk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gY2FuY2VsQWxsKCkgewogICAgICAg\nIC8vIG5vdGUgdGhhdCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBsb2NrIHRoZSBj\nb250ZXh0LCBzaW5jZQogICAgICAgIC8vIHdlIHdhbnQgdG8gYWxsb3cgYSBk\naWZmZXJlbnQgdGhyZWFkIHRvIGJlIGFibGUgdG8gY2FuY2VsIHRoZQogICAg\nICAgIC8vIG91dHN0YW5kaW5nIHN0YXRlbWVudCBvbiBhIGRpZmZlcmVudCBj\nb250ZXh0CgogICAgICAgIENvbGxlY3Rpb24gc3RtbnRzOwogICAgICAgIHN5\nbmNocm9uaXplZCAoX3N0bW50cykgewogICAgICAgICAgICBpZiAoX3N0bW50\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIHN0bW50cyA9IG5ldyBBcnJheUxpc3QoX3N0bW50cyk7CiAg\nICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHN0bW50cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykK\nICAgICAgICAgICAgICAgICgoU3RhdGVtZW50KSBpdHIubmV4dCgpKS5jYW5j\nZWwoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gYXNzaWduT2JqZWN0SWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAg\naWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9u\nSWRzLmFzc2lnbihzbSwgdGhpcywgcHJlRmx1c2gpOwoKICAgICAgICAvLyBk\nYXRhc3RvcmUgaWRlbnRpdHkKICAgICAgICBPYmplY3QgdmFsID0gSW1wbEhl\nbHBlci5nZW5lcmF0ZUlkZW50aXR5VmFsdWUoX2N0eCwgbWV0YSwKICAgICAg\nICAgICAgSmF2YVR5cGVzLkxPTkcpOwogICAgICAgIGlmICh2YWwgPT0gbnVs\nbCAmJiBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0\nZWdpZXMuTkFUSVZFKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICB2YWwgPSBnZXREYXRh\nU3RvcmVJZFNlcXVlbmNlKG1ldGEpLm5leHQoX2N0eCwgbWV0YSk7CiAgICAg\nICAgc20uc2V0T2JqZWN0SWQobmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKSk7\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gYXNzaWduRmllbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgaW50IGZp\nZWxkLAogICAgICAgIGJvb2xlYW4gcHJlRmx1c2gpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIE9iamVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRl\nRmllbGRWYWx1ZShfY3R4LCBmbWQpOwogICAgICAgIGlmICh2YWwgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHNtLnN0b3Jl\nKGZpZWxkLCB2YWwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIHB1YmxpYyBDbGFzcyBnZXRNYW5hZ2VkVHlwZShPYmplY3Qgb2lkKSB7CiAg\nICAgICAgaWYgKG9pZCBpbnN0YW5jZW9mIElkKQogICAgICAgICAgICByZXR1\ncm4gKChJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgcHVibGljIENsYXNzIGdldERhdGFTdG9yZUlkVHlwZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQuY2xhc3M7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBjb3B5RGF0YVN0b3JlSWQoT2Jq\nZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgSWQgaWQg\nPSAoSWQpIG9pZDsKICAgICAgICByZXR1cm4gbmV3IElkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCBpZC5nZXRJZCgpLCBpZC5oYXNTdWJjbGFzc2VzKCkp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3RGF0YVN0b3JlSWQoT2Jq\nZWN0IHZhbCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJu\nIElkLm5ld0luc3RhbmNlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB2YWwp\nOwogICAgfQoKICAgIHB1YmxpYyBJZCBuZXdEYXRhU3RvcmVJZChsb25nIGlk\nLCBDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBzdWJzKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBJZChtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKSwg\naWQsIHN1YnMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92\naWRlciBleGVjdXRlRXh0ZW50KENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAg\nICBmaW5hbCBib29sZWFuIHN1YmNsYXNzZXMsIEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENs\nYXNzTWFwcGluZykgbWV0YTsKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdb\nXSBtYXBwaW5nczsKICAgICAgICBpZiAoc3ViY2xhc3NlcykKICAgICAgICAg\nICAgbWFwcGluZ3MgPSBtYXBwaW5nLmdldEluZGVwZW5kZW50QXNzaWduYWJs\nZU1hcHBpbmdzKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBtYXBwaW5n\ncyA9IG5ldyBDbGFzc01hcHBpbmdbXSB7IG1hcHBpbmcgfTsKCiAgICAgICAg\nUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAgICBm\naW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGpmZXRjaCA9IChKREJDRmV0\nY2hDb25maWd1cmF0aW9uKSBmZXRjaDsKICAgICAgICBpZiAoamZldGNoLmdl\ndFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGpmZXRjaC5FQUdFUl9K\nT0lOKQogICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3Zp\nZGVyW21hcHBpbmdzLmxlbmd0aF07CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGNoZWNrIGZvciBjdXN0b20gbG9hZHMKICAgICAgICAgICAgUmVz\ndWx0T2JqZWN0UHJvdmlkZXIgcm9wOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICByb3AgPSBtYXBwaW5nc1tpXS5jdXN0b21Mb2FkKHRoaXMsIHN1YmNs\nYXNzZXMsIGpmZXRjaCwgMCwKICAgICAgICAgICAgICAgICAgICBMb25nLk1B\nWF9WQUxVRSk7CiAgICAgICAgICAgICAgICBpZiAocm9wICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAocm9wcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3Zp\nZGVyW21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgcm9w\nc1tpXSA9IHJvcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaWYgd2UncmUgc2VsZWN0aW5nIGluZGVwZW5kZW50\nIG1hcHBpbmdzIHNlcGFyYXRlbHkgb3IgaGF2ZQogICAgICAgICAgICAvLyBj\ndXN0b20gbG9hZHMsIGRvIGluZGl2aWR1YWwgc2VsZWN0cyBmb3IgZWFjaCBj\nbGFzcwogICAgICAgICAgICByb3AgPSBudWxsOwogICAgICAgICAgICBpZiAo\ncm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHJvcHNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIFNlbGVjdCBz\nZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgICAgICAgICAgICAgIHNl\nbC5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgQml0U2V0IHBh\nZ2VkID0gc2VsZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaV0sIGpmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJvcHNbaV0gPSBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQ\ncm92aWRlcihzZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBw\naW5nc1tpXSwgdGhpcywgamZldGNoKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBuZXcgUGFn\naW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCwgcGFnZWQs\nIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGlmIChyb3BzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiByb3BzWzBdOwogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3BzKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gcGVyZm9ybSBhIHVuaW9uIG9uIGFsbCBp\nbmRlcGVuZGVudCBjbGFzc2VzCiAgICAgICAgICAgIFVuaW9uIHVuaW9uID0g\nX3NxbC5uZXdVbmlvbihtYXBwaW5ncy5sZW5ndGgpOwogICAgICAgICAgICB1\nbmlvbi5zZXRMUlModHJ1ZSk7CiAgICAgICAgICAgIGZpbmFsIEJpdFNldFtd\nIHBhZ2VkID0gbmV3IEJpdFNldFttYXBwaW5ncy5sZW5ndGhdOwogICAgICAg\nICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGlu\ndCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlZFtpZHhdID0gc2Vs\nZWN0RXh0ZW50KHNlbCwgbWFwcGluZ3NbaWR4XSwgamZldGNoLAogICAgICAg\nICAgICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyB1c2luZyBwYWdp\nbmcgcm9wIGlmIGFueSB1bmlvbiBlbGVtZW50IGhhcyBwYWdlZCBmaWVsZHMK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYWdlZC5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VkW2ldICE9IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlcih1bmlvbiwgbWFwcGluZ3MsCiAgICAgICAgICAgICAg\nICAgICAgICAgIEpEQkNTdG9yZU1hbmFnZXIudGhpcywgamZldGNoLCBwYWdl\nZCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcih1bmlv\nbiwgbWFwcGluZ3NbMF0sIHRoaXMsCiAgICAgICAgICAgICAgICBqZmV0Y2gp\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBn\naXZlbiBtYXBwaW5nIGZvciB1c2UgaW4gYW4gZXh0ZW50LCByZXR1cm5pbmcg\ncGFnZWQgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldCBzZWxl\nY3RFeHRlbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBz\ndWJjbGFzc2VzKSB7CiAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xhc3Nlcykg\nPyBTZWxlY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05PTkU7CiAg\nICAgICAgLy8gZGVjaWRlIGJldHdlZW4gcGFnaW5nIGFuZCBzdGFuZGFyZCBp\ndGVyYXRpb24KICAgICAgICBCaXRTZXQgcGFnZWQgPSBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlci5nZXRQYWdlZEZpZWxkcyhzZWwsIG1hcHBpbmcsCiAg\nICAgICAgICAgIHRoaXMsIGZldGNoLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nLkVBR0VSX1BBUkFMTEVMLAogICAgICAgICAgICBMb25nLk1BWF9WQUxVRSk7\nCiAgICAgICAgaWYgKHBhZ2VkID09IG51bGwpCiAgICAgICAgICAgIHNlbC5z\nZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAog\nICAgICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9Q\nQVJBTExFTCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWwuc2VsZWN0\nSWRlbnRpZmllcihtYXBwaW5nLCBzdWJzLCB0aGlzLCBmZXRjaCwKICAgICAg\nICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTik7\nCiAgICAgICAgcmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIHB1YmxpYyBTdG9y\nZVF1ZXJ5IG5ld1F1ZXJ5KFN0cmluZyBsYW5ndWFnZSkgewogICAgICAgIEV4\ncHJlc3Npb25QYXJzZXIgZXAgPSBRdWVyeUxhbmd1YWdlcy5wYXJzZXJGb3JM\nYW5ndWFnZShsYW5ndWFnZSk7CiAgICAgICAgaWYgKGVwICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBuZXcgSkRCQ1N0b3JlUXVlcnkodGhpcywgZXAp\nOwogICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMo\nbGFuZ3VhZ2UpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNRTFN0b3JlUXVl\ncnkodGhpcyk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVi\nbGljIEZldGNoQ29uZmlndXJhdGlvbiBuZXdGZXRjaENvbmZpZ3VyYXRpb24o\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nSW1wbCgpOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0RGF0YVN0b3JlSWRT\nZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0\nYS5nZXRJZGVudGl0eVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5B\nVElWRQogICAgICAgICAgICB8fCBtZXRhLmdldElkZW50aXR5U3RyYXRlZ3ko\nKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgcmV0dXJu\nIF9jb25mLmdldFNlcXVlbmNlSW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgU2VxIGdldFZhbHVlU2VxdWVuY2Uo\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBpZiAoX2Nv\nbm4gIT0gbnVsbCkKICAgICAgICAgICAgX2Nvbm4uZnJlZSgpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8KICAgIC8vIFV0aWxpdGllcwogICAgLy8vLy8v\nLy8vLy8vLwoKICAgIC8qKgogICAgICogQ29ubmVjdCB0byB0aGUgZGIuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBjb25uZWN0KGJvb2xlYW4gcmVmKSB7\nCiAgICAgICAgX2N0eC5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gY29ubmVjdCBpZiB0aGUgY29ubmVjdGlvbiBpcyBjdXJyZW50bHkg\nbnVsbCwgb3IgaWYKICAgICAgICAgICAgLy8gdGhlIGNvbm5lY3Rpb24gaGFz\nIGJlZW4gY2xvc2VkIG91dCBmcm9tIHVuZGVyIHVzCiAgICAgICAgICAgIGlm\nIChfY29ubiA9PSBudWxsKQogICAgICAgICAgICAgICAgX2Nvbm4gPSBjb25u\nZWN0SW50ZXJuYWwoKTsKICAgICAgICAgICAgaWYgKHJlZikKICAgICAgICAg\nICAgICAgIF9jb25uLnJlZigpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdl\ndFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgX2N0eC51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25uZWN0IHRvIHRoZSBkYXRhYmFzZS4gVGhpcyBtZXRob2Qg\naXMgc2VwYXJhdGVkIG91dCBzbyB0aGF0IGl0CiAgICAgKiBjYW4gYmUgb3Zl\ncnJpZGRlbi4KICAgICAqLwogICAgcHJvdGVjdGVkIFJlZkNvdW50Q29ubmVj\ndGlvbiBjb25uZWN0SW50ZXJuYWwoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gbmV3IFJlZkNvdW50Q29ubmVjdGlvbihfZHMuZ2V0\nQ29ubmVjdGlvbigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhl\nIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBvaWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBPYmplY3QgZmluZChPYmplY3Qgb2lkLCBWYWx1ZU1hcHBpbmcgdm0sIAog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAg\nICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIE9iamVjdCBwYyA9IF9jdHguZmluZChvaWQsIGZldGNoLCBudWxs\nLCBudWxsLCAwKTsKICAgICAgICBpZiAocGMgPT0gbnVsbCAmJiB2bSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIE9ycGhhbmVkS2V5QWN0aW9uIGFjdGlvbiA9\nIF9jb25mLmdldE9ycGhhbmVkS2V5QWN0aW9uSW5zdGFuY2UoKTsKICAgICAg\nICAgICAgcGMgPSBhY3Rpb24ub3JwaGFuKG9pZCwgbnVsbCwgdm0pOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcGM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBMb2FkIHRoZSBvYmplY3QgaW4gdGhlIGN1cnJlbnQgcm93IG9mIHRoZSBn\naXZlbiByZXN1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgbG9hZChD\nbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgUmVzdWx0IHJlc3VsdCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFtYXBwaW5nLmlz\nTWFwcGVkKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYwogICAgICAgICAgICAgICAgLmdldCgidmlydHVhbC1t\nYXBwaW5nIiwgbWFwcGluZykpOwoKICAgICAgICAvLyBnZXQgdGhlIG9iamVj\ndCBpZCBmb3IgdGhlIHJvdzsgYmFzZSBjbGFzcyBzZWxlY3RzIHBrIGNvbHVt\nbnMKICAgICAgICBDbGFzc01hcHBpbmcgYmFzZSA9IG1hcHBpbmc7CiAgICAg\nICAgd2hpbGUgKGJhc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgYmFzZSA9IGJhc2UuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgT2JqZWN0IG9pZCA9\nIGJhc2UuZ2V0T2JqZWN0SWQodGhpcywgcmVzdWx0LCBudWxsLCB0cnVlLCBu\ndWxsKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gbmV3\nIENvbm5lY3Rpb25JbmZvKCk7CiAgICAgICAgaW5mby5yZXN1bHQgPSByZXN1\nbHQ7CiAgICAgICAgaW5mby5tYXBwaW5nID0gbWFwcGluZzsKICAgICAgICBy\nZXR1cm4gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGluZm8sIDAp\nOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gc3RhdGUg\nbWFuYWdlciB3aXRoIGRhdGEgZnJvbSB0aGUgcmVzdWx0IHNldC4gT25seQog\nICAgICogbWFwcGluZ3Mgb3JpZ2luYWxseSBzZWxlY3RlZCB3aWxsIGJlIGxv\nYWRlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvYWQoQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcykgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRmllbGRNYXBwaW5nIGVhZ2Vy\nVG9NYW55ID0gbG9hZChtYXBwaW5nLCBzbSwgZmV0Y2gsIHJlcywgbnVsbCk7\nCiAgICAgICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAg\nIGVhZ2VyVG9NYW55LmxvYWRFYWdlckpvaW4oc20sIHRoaXMsIGZldGNoLnRy\nYXZlcnNlSkRCQyhlYWdlclRvTWFueSksCiAgICAgICAgICAgICAgICByZXMp\nOwogICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBudWxsICYmIHJlcy5p\nc0xvY2tpbmcoKSkKICAgICAgICAgICAgX2xtLmxvYWRlZEZvclVwZGF0ZShz\nbSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBmaWVsZHMgb2Yg\ndGhlIGdpdmVuIG1hcHBpbmcuIFJldHVybiBhbnkgdG8tbWFueSBlYWdlciBm\naWVsZAogICAgICogd2l0aG91dCBsb2FkaW5nIGl0LgogICAgICovCiAgICBw\ncml2YXRlIEZpZWxkTWFwcGluZyBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEZpZWxkTWFwcGluZyBl\nYWdlclRvTWFueSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAobWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBmZXRjaCwg\ncmVzKSkKICAgICAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwoKICAgICAg\nICAvLyBsb2FkIHN1cGVyY2xhc3MgZGF0YTsgYmFzZSBjbGFzcyBsb2FkcyB2\nZXJzaW9uCiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBpbmcu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYg\nKHBhcmVudCAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueSA9IGxv\nYWQocGFyZW50LCBzbSwgZmV0Y2gsIHJlcywgZWFnZXJUb01hbnkpOwogICAg\nICAgIGVsc2UgaWYgKHNtLmdldFZlcnNpb24oKSA9PSBudWxsKQogICAgICAg\nICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5sb2FkKHNtLCB0aGlzLCByZXMp\nOwoKICAgICAgICAvLyBsb2FkIHVubG9hZGVkIGZpZWxkcwogICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RGVmaW5lZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICBPYmplY3QgZXJlcywgcHJvY2Vzc2VkOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmIChmbXNbaV0uaXNQcmltYXJ5S2V5KCkgfHwgc20uZ2V0\nTG9hZGVkKCkuZ2V0KGZtc1tpXS5nZXRJbmRleCgpKSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2hl\nY2sgZm9yIGVhZ2VyIHJlc3VsdCwgYW5kIGlmIG5vdCBwcmVzZW50IGRvIHN0\nYW5kYXJkIGxvYWQKICAgICAgICAgICAgZXJlcyA9IHJlcy5nZXRFYWdlcihm\nbXNbaV0pOwogICAgICAgICAgICByZXMuc3RhcnREYXRhUmVxdWVzdChmbXNb\naV0pOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICBpZiAoZXJl\ncyA9PSByZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWFnZXJUb01h\nbnkgPT0gbnVsbCAmJiBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBlYWdlclRvTWFueSA9IGZtc1tpXTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtc1tpXS5sb2FkRWFnZXJKb2luKHNtLCB0aGlzLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBy\nZXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcmVzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQgPSBmbXNbaV0ubG9h\nZEVhZ2VyUGFyYWxsZWwoc20sIHRoaXMsIAogICAgICAgICAgICAgICAgICAg\nIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZXJlcyk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHByb2Nlc3NlZCAhPSBlcmVzKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXMucHV0RWFnZXIoZm1zW2ldLCBwcm9jZXNzZWQp\nOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nZm1zW2ldLmxvYWQoc20sIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhmbXNb\naV0pLCByZXMpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgcmVzLmVuZERhdGFSZXF1ZXN0KCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAg\nIC8qKgogICAgICogRm9yIGltcGxlbWVudGF0aW9uIHVzZSBvbmx5LgogICAg\nICogUmV0dXJuIGEgc2VsZWN0IGZvciB0aGUgcHJvcGVyIG1hcHBpbmdzLiBS\nZXR1cm4gbnVsbCBpZiBubyBzZWxlY3QgaXMKICAgICAqIG5lZWRlZC4gVGhl\nIG1ldGhvZCBpcyBkZXNpZ25lZCB0byBiZSBjb21wbGVtZW50YXJ5IHRvIHRo\nZSBsb2FkIG1ldGhvZHMuCiAgICAgKgogICAgICogQHBhcmFtIHNlbCBzZWxl\nY3QgdG8gYnVpbGQgb24KICAgICAqIEBwYXJhbSBtYXBwaW5nIHRoZSBtYXBw\naW5nIGZvciB0aGUgYmFzZSB0eXBlIHRvIHNlbGVjdCBmb3IKICAgICAqIEBw\nYXJhbSBzdWJzIHdoZXRoZXIgdGhlIHNlbGVjdCBtaWdodCBpbmNsdWRlIHN1\nYmNsYXNzZXMgb2YgdGhlCiAgICAgKiBnaXZlbiBtYXBwaW5nCiAgICAgKiBA\ncGFyYW0gc20gc3RhdGUgbWFuYWdlciBpZiBhbiBpbnN0YW5jZSBpcyBiZWlu\nZyBsb2FkZWQgb3IKICAgICAqIGluaXRpYWxpemVkLCBlbHNlIG51bGwKICAg\nICAqIEBwYXJhbSBmaWVsZHMgaWYgYSBzdGF0ZSBtYW5hZ2VyIGlzIGJlaW5n\nIGxvYWRlZCwgdGhlIHNldCBvZgogICAgICogZmllbGRzIHRoYXQgbXVzdCBi\nZSBsb2FkZWQgaW4gb3JkZXIsIGVsc2UgbnVsbAogICAgICogQHBhcmFtIGZl\ndGNoIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uOyB1c2VkIGlmIG5vIHNwZWNp\nZmljIGZpZWxkcwogICAgICogbXVzdCBiZSBsb2FkZWQsIGFuZCB1c2VkIHdo\nZW4gc2VsZWN0aW5nIHJlbGF0aW9ucwogICAgICogQHBhcmFtIGVhZ2VyIGVh\nZ2VyIGZldGNoIG1vZGUgdG8gdXNlCiAgICAgKiBAcGFyYW0gaWRlbnQgd2hl\ndGhlciB0byBzZWxlY3QgcHJpbWFyeSBrZXkgY29sdW1ucyBhcyBkaXN0aW5j\ndAogICAgICogaWRlbnRpZmllcnMKICAgICAqIEBwYXJhbSBvdXRlciB3aGV0\naGVyIHdlJ3JlIG91dGVyLWpvaW5pbmcgdG8gdGhpcyB0eXBlCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgdGhlIHNlbGVjdCBpcyByZXF1aXJlZCwgZmFsc2Ug\nb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChT\nZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YnMsCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgZWFn\nZXIsIGJvb2xlYW4gaWRlbnQsIGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAv\nLyBhZGQgY2xhc3MgY29uZGl0aW9ucyBzbyB0aGF0IHRoZXkncmUgY2xvbmVk\nIGZvciBhbnkgYmF0Y2hlZCBzZWxlY3RzCiAgICAgICAgYm9vbGVhbiBqb2lu\nZWRTdXBlcnMgPSBmYWxzZTsKICAgICAgICBpZiAoKHNtID09IG51bGwgfHwg\nc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKQogICAgICAg\nICAgICAmJiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSB8fCBzdWJz\nID09IFNlbGVjdC5TVUJTX05PTkUpKSB7CiAgICAgICAgICAgIGxvYWRTdWJj\nbGFzc2VzKG1hcHBpbmcpOyAKICAgICAgICAgICAgSm9pbnMgam9pbnMgPSAo\nb3V0ZXIpID8gc2VsLm5ld091dGVySm9pbnMoKSA6IG51bGw7CiAgICAgICAg\nICAgIGpvaW5lZFN1cGVycyA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigp\nLmFkZENsYXNzQ29uZGl0aW9ucyhzZWwsCiAgICAgICAgICAgICAgICBzdWJz\nID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFLCBqb2lucyk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBjcmVhdGUgYWxsIG91ciBlYWdlciBzZWxlY3RzIHNvIHRo\nYXQgdGhvc2UgZmllbGRzIGFyZSByZXNlcnZlZAogICAgICAgIC8vIGFuZCBj\nYW5ub3QgYmUgcmV1c2VkIGR1cmluZyB0aGUgYWN0dWFsIGVhZ2VyIHNlbGVj\ndCBwcm9jZXNzLAogICAgICAgIC8vIHByZXZlbnRpbmcgaW5maW5pdGUgcmVj\ndXJzaW9uCiAgICAgICAgZWFnZXIgPSBNYXRoLm1pbihlYWdlciwgZmV0Y2gu\nZ2V0RWFnZXJGZXRjaE1vZGUoKSk7CiAgICAgICAgRmllbGRNYXBwaW5nIGVh\nZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNlbCwgbWFwcGluZywg\nc20sIGZpZWxkcywKICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyKTsKCiAgICAg\nICAgLy8gc2VsZWN0IGFsbCBiYXNlIGNsYXNzIG1hcHBpbmdzOyBkbyB0aGlz\nIGFmdGVyIGJhdGNoaW5nIHNvIHRoYXQKICAgICAgICAvLyB0aGUgam9pbnMg\nbmVlZGVkIGJ5IHRoZXNlIHNlbGVjdHMgZG9uJ3QgZ2V0IGluIHRoZSBXSEVS\nRSBjbGF1c2UKICAgICAgICAvLyBvZiB0aGUgYmF0Y2hlZCBzZWxlY3RzCiAg\nICAgICAgaW50IHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBtYXBw\naW5nLCBtYXBwaW5nLCBzbSwgZmllbGRzLAogICAgICAgICAgICBmZXRjaCwg\nZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkU3VwZXJzKTsKCiAg\nICAgICAgLy8gc2VsZWN0IGVhZ2VyIHRvLW1hbnkgcmVsYXRpb25zIGxhc3Qg\nYmVjYXVzZSBkdXJpbmcgbG9hZCB0aGV5CiAgICAgICAgLy8gYWR2YW5jZSB0\naGUgcmVzdWx0IHNldCBhbmQgY291bGQgZXhoYXVzdCBpdCwgc28gbm8gb3Ro\nZXIgbWFwcGluZ3MKICAgICAgICAvLyBjYW4gbG9hZCBhZnRlcndvcmRzCiAg\nICAgICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAgIGVh\nZ2VyVG9NYW55LnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCB0aGlzLCAKICAg\nICAgICAgICAgICAgIGZldGNoLnRyYXZlcnNlSkRCQyhlYWdlclRvTWFueSks\nIGVhZ2VyKTsKCiAgICAgICAgLy8gb3B0aW9uYWxseSBzZWxlY3Qgc3ViY2xh\nc3MgbWFwcGluZ3MKICAgICAgICBpZiAoc3VicyA9PSBTZWxlY3QuU1VCU19K\nT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJMRSkK\nICAgICAgICAgICAgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhzZWwsIG1hcHBp\nbmcsIHNtLCBmZXRjaCk7CiAgICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAg\nICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7CiAgICAgICAgcmV0dXJu\nIHNlbGQgPiAwOwogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGUgZmll\nbGRzIG9mIHRoaXMgbWFwcGluZyBhcyByZXNlcnZlZCBzbyB0aGF0IGVhZ2Vy\nIGZldGNoZXMgY2FuJ3QKICAgICAqIGdldCBpbnRvIGluZmluaXRlIHJlY3Vy\nc2l2ZSBzaXR1YXRpb25zLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkTWFw\ncGluZyBjcmVhdGVFYWdlclNlbGVjdHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nQml0U2V0IGZpZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwK\nICAgICAgICBpbnQgZWFnZXIpIHsKICAgICAgICBpZiAobWFwcGluZyA9PSBu\ndWxsIHx8IGVhZ2VyID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJf\nTk9ORSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEZpZWxk\nTWFwcGluZyBlYWdlclRvTWFueSA9IGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWws\nIAogICAgICAgICAgICBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpLCBzbSwgZmllbGRzLCBmZXRjaCwgZWFnZXIpOwoKICAgICAg\nICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVs\nZE1hcHBpbmdzKCk7CiAgICAgICAgYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNl\nbC5oYXNFYWdlckpvaW4oZmFsc2UpOwogICAgICAgIGludCBzZWxzOwogICAg\nICAgIGludCBqdHlwZTsKICAgICAgICBpbnQgbW9kZTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBtb2RlID0gZm1zW2ldLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAg\nICAgIGlmIChtb2RlID09IGZldGNoLkVBR0VSX05PTkUpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKCFyZXF1aXJlc1NlbGVj\ndChmbXNbaV0sIHNtLCBmaWVsZHMsIGZldGNoKSkKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRo\nIGpvaW4gZmlyc3QKICAgICAgICAgICAganR5cGUgPSAoZm1zW2ldLmdldE51\nbGxWYWx1ZSgpID09IGZtc1tpXS5OVUxMX0VYQ0VQVElPTikgCiAgICAgICAg\nICAgICAgICA/IHNlbC5FQUdFUl9JTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsK\nICAgICAgICAgICAgaWYgKG1vZGUgIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwg\nJiYgIWZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAgICAg\nICAgICYmIGZtc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwg\ndGhpcywgZmV0Y2gpID4gMAogICAgICAgICAgICAgICAgJiYgc2VsLmVhZ2Vy\nQ2xvbmUoZm1zW2ldLCBqdHlwZSwgZmFsc2UsIDEpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGJvb2xlYW4gaGFz\nSm9pbiA9IGZldGNoLmhhc0pvaW4oZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNl\nKSk7CgogICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBw\ncmVmZXJyZWQgc2VsZWN0IG1vZGUgb2Ygam9pbiBvciBkb2VzIG5vdAogICAg\nICAgICAgICAvLyBoYXZlIGEgcHJlZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRv\naW5nIGEgYnktaWQgbG9va3VwLCB0cnkKICAgICAgICAgICAgLy8gdG8gdXNl\nIGEgdG8tbWFueSBqb2luIGFsc28uICBjdXJyZW50bHkgd2UgbGltaXQgZWFn\nZXIKICAgICAgICAgICAgLy8gb3V0ZXIgam9pbnMgdG8gbm9uLUxSUywgbm9u\nLXJhbmdlZCBzZWxlY3RzIHRoYXQgZG9uJ3QgYWxyZWFkeQogICAgICAgICAg\nICAvLyBoYXZlIGFuIGVhZ2VyIHRvLW1hbnkgam9pbgogICAgICAgICAgICBp\nZiAoKGhhc0pvaW4gfHwgbW9kZSA9PSBmZXRjaC5FQUdFUl9KT0lOIAogICAg\nICAgICAgICAgICAgfHwgKG1vZGUgPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAh\nPSBudWxsKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5pc0VhZ2VyU2Vs\nZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYmICFpbkVhZ2VySm9pbgog\nICAgICAgICAgICAgICAgJiYgIXNlbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAg\nICAgICAgICAgICAgICYmICghc2VsLmdldEF1dG9EaXN0aW5jdCgpIHx8ICgh\nc2VsLmlzTFJTKCkKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRTdGFydElu\nZGV4KCkgPT0gMCAKICAgICAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRl\neCgpID09IExvbmcuTUFYX1ZBTFVFKSkKICAgICAgICAgICAgICAgICYmIGZt\nc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0\nY2gpID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHNlbC5lYWdlckNsb25l\nKGZtc1tpXSwganR5cGUsIHRydWUsIDEpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGZpbmFsbHksIHRyeSBwYXJhbGxlbAog\nICAgICAgICAgICBpZiAoZWFnZXIgPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwK\nICAgICAgICAgICAgICAgICYmIChzZWxzID0gZm1zW2ldLnN1cHBvcnRzU2Vs\nZWN0KHNlbCwgc2VsLkVBR0VSX1BBUkFMTEVMLCBzbSwKICAgICAgICAgICAg\nICAgIHRoaXMsIGZldGNoKSkgIT0gMCkKICAgICAgICAgICAgICAgIHNlbC5l\nYWdlckNsb25lKGZtc1tpXSwgU2VsZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAg\nICAgICAgICAgICAgICAgICBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgp\nLCBzZWxzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55\nOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZl\nbiBmaWVsZCBuZWVkcyB0byBiZSBzZWxlY3RlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiByZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBp\nbmcgZm0sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0\nIGZpZWxkcywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAg\nICAgIGlmIChmaWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZp\nZWxkcy5nZXQoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKHNtICE9IG51\nbGwgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAg\nICAgICAgICAgICYmIHNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgp\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBm\nZXRjaC5yZXF1aXJlc0ZldGNoKGZtKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNlbGVjdCB0aGUgZmllbGQgbWFwcGluZ3Mgb2YgdGhlIGdpdmVuIGNsYXNz\nIGFuZCBhbGwgaXRzIHN1cGVyY2xhc3Nlcy4KICAgICAqCiAgICAgKiBAcGFy\nYW0gc2VsIHRoZSBzZWxlY3QgdG8gdXNlCiAgICAgKiBAcGFyYW0gbWFwcGlu\nZyB0aGUgbW9zdC1kZXJpdmVkIHR5cGUgdG8gc2VsZWN0IGZvcgogICAgICog\nQHBhcmFtIG9yaWcgdGhlIG9yaWdpbmFsIG1hcHBpbmcgdHlwZSBzZWxlY3Rl\nZAogICAgICogQHBhcmFtIHNtIHRoZSBpbnN0YW5jZSBiZWluZyBzZWxlY3Rl\nZCBmb3IsIG9yIG51bGwgaWYgbm9uZQogICAgICogQHBhcmFtIGZpZWxkcyB0\naGUgZmllbGRzIHRvIGxvYWQKICAgICAqIEBwYXJhbSBmZXRjaCBmZXRjaCBj\nb25maWd1cmF0aW9uIHRvIHVzZSBmb3IgbG9hZGluZyByZWxhdGlvbnMKICAg\nICAqIEBwYXJhbSBlYWdlciB0aGUgZWFnZXIgZmV0Y2ggbW9kZSB0byB1c2UK\nICAgICAqIEBwYXJhbSBqb2luZWQgd2hldGhlciB0aGUgY2xhc3MgaGFzIGFs\ncmVhZHkgYmVlbiBqb2luZWQgZG93biB0bwogICAgICogaXRzIGJhc2UgY2xh\nc3MKICAgICAqIEByZXR1cm4gJmd0OyAwIGlmIHRoZSBzZWxlY3QgaXMgcmVx\ndWlyZWQsIDAgaWYgZGF0YSB3YXMKICAgICAqIHNlbGVjdGVkIGJ1dCBpcyBu\nb3QgcmVxdWlyZWQsIGFuZCAmbHQ7IDAgaWYgbm90aGluZyB3YXMgc2VsZWN0\nZWQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgc2VsZWN0QmFzZU1hcHBpbmdz\nKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIENs\nYXNzTWFwcGluZyBvcmlnLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRT\nZXQgZmllbGRzLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGludCBlYWdlciwgRmllbGRNYXBwaW5nIGVhZ2VyVG9NYW55LAogICAg\nICAgIGJvb2xlYW4gaWRlbnQsIGJvb2xlYW4gam9pbmVkKSB7CiAgICAgICAg\nQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHBhcmVudCA9PSBudWxs\nICYmICFtYXBwaW5nLmlzTWFwcGVkKCkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInZpcnR1YWwtbWFw\ncGluZyIsIG1hcHBpbmcuCiAgICAgICAgICAgICAgICBnZXREZXNjcmliZWRU\neXBlKCkpKTsKCiAgICAgICAgaW50IHNlbGQgPSAtMTsKICAgICAgICBpbnQg\ncHNlbGQgPSAtMTsKCiAgICAgICAgLy8gYmFzZSBjbGFzcyBzZWxlY3RzIHBr\ncywgZXRjCiAgICAgICAgaWYgKHBhcmVudCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIGlmIG5vIGluc3RhbmNlLCBzZWxlY3QgcGtzCiAgICAgICAgICAg\nIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoaWRlbnQp\nCiAgICAgICAgICAgICAgICAgICAgc2VsLnNlbGVjdElkZW50aWZpZXIobWFw\ncGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmcu\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAgICAgICAgICAgICAgICBzZWxk\nID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbm8gaW5z\ndGFuY2Ugb3Igbm90IGluaXRpYWxpemVkIGFuZCBub3QgZXhhY3Qgb2lkLCBz\nZWxlY3QgdHlwZQogICAgICAgICAgICBpZiAoKHNtID09IG51bGwgfHwgKHNt\nLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAg\nICAgICAgICYmICghKHNtLmdldE9iamVjdElkKCkgaW5zdGFuY2VvZiBPcGVu\nSlBBSWQpIAogICAgICAgICAgICAgICAgfHwgKChPcGVuSlBBSWQpIHNtLmdl\ndE9iamVjdElkKCkpLmhhc1N1YmNsYXNzZXMoKSkpKQogICAgICAgICAgICAg\nICAgJiYgbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCkuc2VsZWN0KHNlbCwg\nb3JpZykpCiAgICAgICAgICAgICAgICBzZWxkID0gMTsKCiAgICAgICAgICAg\nIC8vIGlmIG5vIGluc3RhbmNlIG9yIG5vIHZlcnNpb24sIHNlbGVjdCB2ZXJz\naW9uCiAgICAgICAgICAgIGlmICgoc20gPT0gbnVsbCB8fCBzbS5nZXRWZXJz\naW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0\nVmVyc2lvbigpLnNlbGVjdChzZWwsIG9yaWcpKQogICAgICAgICAgICAgICAg\nc2VsZCA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVj\ndXJzZSBvbiBwYXJlbnQKICAgICAgICAgICAgcHNlbGQgPSBzZWxlY3RCYXNl\nTWFwcGluZ3Moc2VsLCBwYXJlbnQsIG9yaWcsIHNtLCBmaWVsZHMsCiAgICAg\nICAgICAgICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwg\nam9pbmVkKTsKICAgICAgICB9CgogICAgICAgIC8vIHNlbGVjdCB0aGUgbWFw\ncGluZ3MgaW4gdGhlIGdpdmVuIGZpZWxkcyBzZXQsIG9yIGJhc2VkIG9uIGZl\ndGNoCiAgICAgICAgLy8gY29uZmlndXJhdGlvbiBpZiBubyBmaWVsZHMgZ2l2\nZW4KICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERl\nZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgU2VsZWN0RXhlY3V0b3Ig\nZXNlbDsKICAgICAgICBpbnQgZnNlbGQ7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gc2tp\ncCBlYWdlciB0by1tYW55IHNlbGVjdDsgd2UgZG8gdGhhdCBzZXBhcmF0ZWx5\nIGluIGNhbGxpbmcKICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAg\nIGlmIChmbXNbaV0gPT0gZWFnZXJUb01hbnkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBlYWdlciBzZWxl\nY3QKICAgICAgICAgICAgZXNlbCA9IHNlbC5nZXRFYWdlcihmbXNbaV0pOwog\nICAgICAgICAgICBpZiAoZXNlbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZXNlbCA9PSBzZWwpCiAgICAgICAgICAgICAgICAgICAgZm1zW2ld\nLnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAg\nICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGVhZ2VyKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBmbXNb\naV0uc2VsZWN0RWFnZXJQYXJhbGxlbChlc2VsLCBzbSwgdGhpcywgCiAgICAg\nICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNbaV0pLCBl\nYWdlcik7CiAgICAgICAgICAgICAgICBzZWxkID0gTWF0aC5tYXgoMCwgc2Vs\nZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxdWlyZXNTZWxlY3QoZm1z\nW2ldLCBzbSwgZmllbGRzLCBmZXRjaCkpIHsKICAgICAgICAgICAgICAgIGZz\nZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0aGlzLCAKICAgICAgICAg\nICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZWFnZXIpOwog\nICAgICAgICAgICAgICAgc2VsZCA9IE1hdGgubWF4KGZzZWxkLCBzZWxkKTsK\nICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRTZWxlY3QoZm1zW2ldLCBzZWws\nIHNtLCBmZXRjaCkpIHsKICAgICAgICAgICAgICAgIGZzZWxkID0gZm1zW2ld\nLnNlbGVjdChzZWwsIHNtLCB0aGlzLCAKICAgICAgICAgICAgICAgIAlmZXRj\naC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZmV0Y2guRUFHRVJfTk9ORSk7Cgog\nICAgICAgICAgICAgICAgLy8gZG9uJ3QgdXBncmFkZSBzZWxkIHRvID4gMCBi\nYXNlZCBvbiB0aGVzZSBmaWVsZHMsIHNpbmNlCiAgICAgICAgICAgICAgICAv\nLyB0aGV5J3JlIG5vdCBpbiB0aGUgY2FsY3VsYXRlZCBmaWVsZCBzZXQKICAg\nICAgICAgICAgICAgIGlmIChmc2VsZCA+PSAwICYmIHNlbGQgPCAwKQogICAg\nICAgICAgICAgICAgICAgIHNlbGQgPSAwOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBqb2luIHRvIHBhcmVudCB0YWJsZSBpZiB0aGUg\ncGFyZW50IC8gYW55IGFuY2VzdG9ycyBoYXZlIHNlbGVjdGVkCiAgICAgICAg\nLy8gYW55dGhpbmcKICAgICAgICBpZiAoIWpvaW5lZCAmJiBwc2VsZCA+PSAw\nICYmIHBhcmVudC5nZXRUYWJsZSgpICE9IG1hcHBpbmcuZ2V0VGFibGUoKSkK\nICAgICAgICAgICAgc2VsLndoZXJlKG1hcHBpbmcuam9pblN1cGVyY2xhc3Mo\nc2VsLm5ld0pvaW5zKCksIGZhbHNlKSk7CgogICAgICAgIC8vIHJldHVybiB0\naGUgaGlnaGVzdCB2YWx1ZQogICAgICAgIHJldHVybiBNYXRoLm1heChwc2Vs\nZCwgc2VsZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIHNlbGVjdGlu\nZyBmaWVsZGVzLCBhIHNwZWNpYWwgY2FzZSBpcyBtYWRlIGZvciBtYXBwaW5n\ncyB0aGF0IHVzZQogICAgICogMi1wYXJ0IHNlbGVjdHMgdGhhdCBhcmVuJ3Qg\nZXhwbGljaXRseSAqbm90KiBpbiB0aGUgZGZnIHNvIHRoYXQgdGhleQogICAg\nICogY2FuIGdldCB0aGVpciBwcmltYXJ5IHRhYmxlIGRhdGEuIFRoaXMgbWV0\naG9kIHRlc3RzIGZvciB0aGF0IHNwZWNpYWwKICAgICAqIGNhc2UgYXMgYW4g\nb3B0aW1pemF0aW9uLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gb3B0\nU2VsZWN0KEZpZWxkTWFwcGluZyBmbSwgU2VsZWN0IHNlbCwKICAgICAgICBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgcmV0dXJuICFmbS5pc0luRGVmYXVsdEZldGNo\nR3JvdXAoKSAKICAgICAgICAgICAgJiYgIWZtLmlzRGVmYXVsdEZldGNoR3Jv\ndXBFeHBsaWNpdCgpCiAgICAgICAgICAgICYmIChzbSA9PSBudWxsIHx8IHNt\nLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCAKICAgICAgICAg\nICAgfHwgIXNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAg\nICAgICAgICAgJiYgZm0uc3VwcG9ydHNTZWxlY3Qoc2VsLCBzZWwuVFlQRV9U\nV09fUEFSVCwgc20sIHRoaXMsIGZldGNoKSA+IDA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZWxlY3QgZmllbGQgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUg\nZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbiBmb3IKICAgICAqIHN1YmNsYXNz\nZXMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIHNl\nbCB0aGUgc2VsZWN0IHRvIHVzZQogICAgICogQHBhcmFtIG1hcHBpbmcgdGhl\nIHR5cGUgd2hvc2Ugc3ViY2xhc3NlcyB0byBzZWxlY3QKICAgICAqIEBwYXJh\nbSBzbSB0aGUgaW5zdGFuY2UgYmVpbmcgc2VsZWN0ZWQgZm9yLCBvciBudWxs\nIGlmIG5vbmUKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2ggY29uZmln\ndXJhdGlvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0U3ViY2xh\nc3NNYXBwaW5ncyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgbG9hZFN1YmNsYXNzZXMobWFw\ncGluZyk7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3ViTWFwcGluZ3MgPSBt\nYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7CiAgICAg\nICAgaWYgKHN1Yk1hcHBpbmdzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIHNlbGVjdCBhbGwgc3ViY2xhc3MgbWFwcGlu\nZ3MgdGhhdCBtYXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAg\nIC8vIGFuZCB3aG9zZSB0YWJsZSBpcyBpbiB0aGUgbGlzdCBvZiB0aG9zZSBz\nZWxlY3RlZCBzbyBmYXI7IHRoaXMKICAgICAgICAvLyB3YXkgd2Ugc2VsZWN0\nIHRoZSBtYXggcG9zc2libGUgd2l0aG91dCBzZWxlY3RpbmcgYW55IHRhYmxl\ncyB0aGF0CiAgICAgICAgLy8gYXJlbid0IHByZXNlbnQgaW4gYWxsIHBvc3Np\nYmxlIHF1ZXJ5IG1hdGNoZXM7IGEgc3BlY2lhbCBjYXNlCiAgICAgICAgLy8g\naXMgbWFkZSBmb3IgbWFwcGluZ3MgdGhhdCB1c2UgMi1wYXJ0IHNlbGVjdHMg\ndGhhdCBhcmVuJ3QKICAgICAgICAvLyBleHBsaWNpdGx5ICpub3QqIGluIHRo\nZSBkZWZhdWx0IHNvIHRoYXQgdGhleSBjYW4gZ2V0IHRoZWlyCiAgICAgICAg\nLy8gcHJpbWFyeSB0YWJsZSBkYXRhCiAgICAgICAgRmllbGRNYXBwaW5nW10g\nZm1zOwogICAgICAgIGJvb2xlYW4gam9pbmVkOwogICAgICAgIGJvb2xlYW4g\nY2FuSm9pbiA9IF9kaWN0LmpvaW5TeW50YXggIT0gSm9pblN5bnRheGVzLlNZ\nTlRBWF9UUkFESVRJT05BTAogICAgICAgICAgICAmJiBmZXRjaC5nZXRTdWJj\nbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBmZXRjaC5FQUdFUl9OT05FOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3ViTWFwcGluZ3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFzdWJNYXBwaW5nc1tpXS5zdXBw\nb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHRoaXMsIG1hcHBpbmcsCiAgICAg\nICAgICAgICAgICBmZXRjaCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgc28gdGhhdCBpZiB3ZSBjYW4n\ndCBqb2luLCB3ZSBwcmV0ZW5kIHdlIGFscmVhZHkgaGF2ZQogICAgICAgICAg\nICBqb2luZWQgPSAhY2FuSm9pbjsKICAgICAgICAgICAgZm1zID0gc3ViTWFw\ncGluZ3NbaV0uZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbXMubGVuZ3RoOyBqKyspIHsKICAg\nICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBpbiBvbmUgb2YgY29uZmlndXJl\nZCBmZXRjaCBncm91cHMKICAgICAgICAgICAgCWlmICghZmV0Y2gucmVxdWly\nZXNGZXRjaChmbXNbal0pIAogICAgICAgICAgICAgICAgICAgICYmICgoIWZt\nc1tqXS5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgICAg\nICAgICAmJiBmbXNbal0uaXNEZWZhdWx0RmV0Y2hHcm91cEV4cGxpY2l0KCkp\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1zW2pdLnN1cHBvcnRzU2VsZWN0\nKHNlbCwgc2VsLlRZUEVfVFdPX1BBUlQsIHNtLCB0aGlzLCAKICAgICAgICAg\nICAgICAgICAgICBmZXRjaCkgPD0gMCkpIAogICAgICAgICAgICAJCWNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGNhbiBqb2luIHRvIHRo\nZSBzdWJjbGFzcywgZG8gc287IG11Y2ggYmV0dGVyIGNoYW5jZQogICAgICAg\nICAgICAgICAgLy8gdGhhdCB0aGUgZmllbGQgd2lsbCBiZSBhYmxlIHRvIHNl\nbGVjdCBpdHNlbGYgd2l0aG91dCBqb2lucwogICAgICAgICAgICAgICAgaWYg\nKCFqb2luZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYXJrIGpvaW5l\nZCB3aGV0aGVyIG9yIG5vdCB3ZSBqb2luLCBzbyB3ZSBkb24ndCBoYXZlIHRv\nCiAgICAgICAgICAgICAgICAgICAgLy8gdGVzdCBjb25kaXRpb25zIGFnYWlu\nIGZvciB0aGlzIHN1YmNsYXNzCiAgICAgICAgICAgICAgICAgICAgam9pbmVk\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzZWwud2hlcmUoam9pblN1\nYmNsYXNzKHNlbCwgbWFwcGluZywgc3ViTWFwcGluZ3NbaV0sIG51bGwpKTsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiBjYW4g\nc2VsZWN0IHdpdGggdGFibGVzIGFscmVhZHkgc2VsZWN0ZWQsIGRvIGl0CiAg\nICAgICAgICAgICAgICBpZiAoZm1zW2pdLnN1cHBvcnRzU2VsZWN0KHNlbCwg\nc2VsLlRZUEVfSk9JTkxFU1MsIHNtLCB0aGlzLAogICAgICAgICAgICAgICAg\nICAgIGZldGNoKSA+IDApCiAgICAgICAgICAgICAgICAgICAgZm1zW2pdLnNl\nbGVjdChzZWwsIG51bGwsIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhmbXNb\nal0pLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaC5FQUdFUl9OT05F\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gam9pbiBmcm9tIGNsYXNzIHRvIGl0cyBz\ndWJjbGFzcy4gUmVjdXJzaXZlIHRvIGFsbG93CiAgICAgKiBmb3IgbXVsdGlw\nbGUgaG9wcywgc3RhcnRpbmcgZnJvbSB0aGUgYmFzZSBjbGFzcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgSm9pbnMgam9pblN1YmNsYXNzKFNlbGVj\ndCBzZWwsIENsYXNzTWFwcGluZyBiYXNlLAogICAgICAgIENsYXNzTWFwcGlu\nZyBzdWIsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKHN1YiA9PSBiYXNl\nIHx8IHN1Yi5nZXRUYWJsZSgpID09IGJhc2UuZ2V0VGFibGUoKQogICAgICAg\nICAgICB8fCBzZWwuaXNTZWxlY3RlZChzdWIuZ2V0VGFibGUoKSkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyByZWN1cnNlIGZpcnN0\nIHNvIHdlIGdvIGxlYXN0LT5tb3N0IGRlcml2ZWQKICAgICAgICBDbGFzc01h\ncHBpbmcgc3VwID0gc3ViLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpOwogICAgICAgIGpvaW5zID0gam9pblN1YmNsYXNzKHNlbCwgYmFzZSwg\nc3VwLCBqb2lucyk7CiAgICAgICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAg\nICAgICAgIGpvaW5zID0gc2VsLm5ld0pvaW5zKCk7CiAgICAgICAgcmV0dXJu\nIHN1Yi5qb2luU3VwZXJjbGFzcyhqb2lucywgdHJ1ZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlcyBzdXJlIGFsbCBzdWJjbGFzc2VzIG9mIHRoZSBn\naXZlbiB0eXBlIGFyZSBsb2FkZWQgaW4gdGhlIEpWTS4KICAgICAqIFRoaXMg\naXMgdXN1YWxseSBkb25lIGF1dG9tYXRpY2FsbHkuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGxvYWRTdWJjbGFzc2VzKENsYXNzTWFwcGluZyBtYXBwaW5n\nKSB7CiAgICAgICAgRGlzY3JpbWluYXRvciBkc2MgPSBtYXBwaW5nLmdldERp\nc2NyaW1pbmF0b3IoKTsKICAgICAgICBpZiAoZHNjLmdldFN1YmNsYXNzZXNM\nb2FkZWQoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB0\naGUgc3ViY2xhc3MgbGlzdCBpcyBzZXQsIG5vIG5lZWQgdG8gbG9hZCBzdWJz\nCiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0UmVwb3NpdG9yeSgpLmdldFBlcnNp\nc3RlbnRUeXBlTmFtZXMoZmFsc2UsCiAgICAgICAgICAgIF9jdHguZ2V0Q2xh\nc3NMb2FkZXIoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBkc2Muc2V0U3Vi\nY2xhc3Nlc0xvYWRlZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZHNjLmxvYWRTdWJj\nbGFzc2VzKHRoaXMpOwogICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRF\neGNlcHRpb24gY25mZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVF\neGNlcHRpb24oY25mZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3Rv\ncmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYWtlIHRoZSBzdGF0ZW1lbnQgYSBjYW5kaWRhdGUgZm9yIGNhbmNlbGxh\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJlZm9yZUV4ZWN1dGVT\ndGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAgX3N0bW50cy5h\nZGQoc3RtbnQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBz\ndGF0ZW1lbnQgZnJvbSB0aGUgY2FuY2VsbGFibGUgc2V0LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KFN0YXRlbWVu\ndCBzdG1udCkgewogICAgICAgIF9zdG1udHMucmVtb3ZlKHN0bW50KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcmV0dXJuZWQgdG8gY2xp\nZW50IGNvZGUuIE1ha2VzIHN1cmUgaXRzIHdyYXBwZWQgY29ubmVjdGlvbgog\nICAgICogcmVmIGNvdW50IGlzIGRlY3JlbWVudGVkIG9uIGZpbmFsaXplLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBDbGllbnRDb25uZWN0\naW9uIGV4dGVuZHMgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gewoKICAgICAgICBw\ncml2YXRlIGJvb2xlYW4gX2Nsb3NlZCA9IGZhbHNlOwoKICAgICAgICBwdWJs\naWMgQ2xpZW50Q29ubmVjdGlvbihDb25uZWN0aW9uIGNvbm4pIHsKICAgICAg\nICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBjbG9zZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAg\nICBfY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3VwZXIuY2xvc2UoKTsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIGZpbmFsaXplKCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmICghX2Nsb3Nl\nZCkKICAgICAgICAgICAgICAgIGNsb3NlKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ29ubmVjdGlvbiB3cmFwcGVyIHRoYXQga2VlcHMg\nYW4gaW50ZXJuYWwgcmVmIGNvdW50IHNvIHRoYXQgaXQga25vd3MKICAgICAq\nIHdoZW4gdG8gcmVhbGx5IGNsb3NlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nY2xhc3MgUmVmQ291bnRDb25uZWN0aW9uIGV4dGVuZHMgRGVsZWdhdGluZ0Nv\nbm5lY3Rpb24gewoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX3JldGFpbiA9\nIGZhbHNlOwogICAgICAgIHByaXZhdGUgaW50IF9yZWZzID0gMDsKICAgICAg\nICBwcml2YXRlIGJvb2xlYW4gX2ZyZWVkID0gZmFsc2U7CgogICAgICAgIHB1\nYmxpYyBSZWZDb3VudENvbm5lY3Rpb24oQ29ubmVjdGlvbiBjb25uKSB7CiAg\nICAgICAgICAgIHN1cGVyKGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gZ2V0UmV0YWluKCkgewogICAgICAgICAgICByZXR1cm4g\nX3JldGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldFJl\ndGFpbihib29sZWFuIHJldGFpbikgewogICAgICAgICAgICBpZiAoX3JldGFp\nbiAmJiAhcmV0YWluICYmIF9yZWZzIDw9IDApCiAgICAgICAgICAgICAgICBm\ncmVlKCk7CiAgICAgICAgICAgIF9yZXRhaW4gPSByZXRhaW47CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCByZWYoKSB7CiAgICAgICAgICAgIC8v\nIGRvbid0IGhhdmUgdG8gbG9jazsgY2FsbGVkIGZyb20gY29ubmVjdCgpLCB3\naGljaCBpcyBsb2NrZWQKICAgICAgICAgICAgX3JlZnMrKzsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIC8vIGxvY2sgYXQgYnJva2VyIGxldmVsIHRv\nIGF2b2lkIGRlYWRsb2NrcwogICAgICAgICAgICBfY3R4LmxvY2soKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9yZWZzLS07CiAgICAg\nICAgICAgICAgICBpZiAoX3JlZnMgPD0gMCAmJiAhX3JldGFpbikKICAgICAg\nICAgICAgICAgICAgICBmcmVlKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICBfY3R4LnVubG9jaygpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBmcmVlKCkgewogICAg\nICAgICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBkbyBub3QgY2xvc2UgdGhlIHVu\nZGVybHlpbmcgY29ubmVjdGlvbgogICAgICAgICAgICAvLyBtdWx0aXBsZSB0\naW1lczsgdGhpcyBjb3VsZCBoYXBwZW4gaWYgc29tZW9uZSAoZS5nLiwgYW4K\nICAgICAgICAgICAgLy8gRXh0ZW50KSBob2xkcyBhIFJlZkNvbm5lY3Rpb24s\nIGFuZCB0aGVuIGNsb3NlcyBpdCAoZS5nLiwgaW4KICAgICAgICAgICAgLy8g\ndGhlIGZpbmFsaXplcikgYWZ0ZXIgdGhlIFN0b3JlTWFuYWdlciBoYXMgYWxy\nZWFkeSBiZWVuIGNsb3NlZC4KICAgICAgICAgICAgaWYgKF9mcmVlZCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBnZXREZWxlZ2F0ZSgpLmNsb3NlKCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9mcmVlZCA9IHRydWU7CiAgICAgICAgICAgIF9jb25uID0g\nbnVsbDsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQg\nY3JlYXRlU3RhdGVtZW50KGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2VsU3RhdGVtZW50\nKHN1cGVyLmNyZWF0ZVN0YXRlbWVudChmYWxzZSksCiAgICAgICAgICAgICAg\nICBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAg\nICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChpbnQgcnNU\neXBlLCBpbnQgcnNDb25jdXIsCiAgICAgICAgICAgIGJvb2xlYW4gd3JhcCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nQ2FuY2VsU3RhdGVtZW50KHN1cGVyLmNyZWF0ZVN0YXRlbWVudChyc1R5cGUs\nIHJzQ29uY3VyLAogICAgICAgICAgICAgICAgZmFsc2UpLCBSZWZDb3VudENv\nbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQg\nUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3Fs\nLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICByZXR1cm4gbmV3IENhbmNlbFByZXBhcmVkU3Rh\ndGVtZW50KHN1cGVyLnByZXBhcmVTdGF0ZW1lbnQoc3FsLAogICAgICAgICAg\nICAgICAgZmFsc2UpLCBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7CiAgICAg\nICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJl\ncGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBpbnQgcnNUeXBlLAogICAgICAg\nICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2VsUHJlcGFy\nZWRTdGF0ZW1lbnQoc3VwZXIucHJlcGFyZVN0YXRlbWVudChzcWwsCiAgICAg\nICAgICAgICAgICByc1R5cGUsIHJzQ29uY3VyLCBmYWxzZSksIFJlZkNvdW50\nQ29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTdGF0ZW1lbnQgdHlwZSB0aGF0IGFkZHMgYW5kIHJlbW92ZXMgaXRz\nZWxmIGZyb20gdGhlIHNldCBvZiBhY3RpdmUKICAgICAqIHN0YXRlbWVudHMg\nc28gdGhhdCBpdCBjYW4gYmUgY2FuY2VsZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgY2xhc3MgQ2FuY2VsU3RhdGVtZW50IGV4dGVuZHMgRGVsZWdhdGluZ1N0\nYXRlbWVudCB7CgogICAgICAgIHB1YmxpYyBDYW5jZWxTdGF0ZW1lbnQoU3Rh\ndGVtZW50IHN0bW50LCBDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAg\nc3VwZXIoc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBleGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRo\naXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIHN1cGVyLmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0\naGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoU3RyaW5nIHNxbCwgYm9vbGVh\nbiB3cmFwKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVj\ndXRlUXVlcnkoc3FsLCB3cmFwKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3ZlcyBpdHNlbGYg\nZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVtZW50cyBzbyB0\naGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAgcHJpdmF0ZSBj\nbGFzcyBDYW5jZWxQcmVwYXJlZFN0YXRlbWVudCBleHRlbmRzIERlbGVnYXRp\nbmdQcmVwYXJlZFN0YXRlbWVudCB7CgogICAgICAgIHB1YmxpYyBDYW5jZWxQ\ncmVwYXJlZFN0YXRlbWVudChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgCiAg\nICAgICAgICAgIENvbm5lY3Rpb24gY29ubikgewogICAgICAgICAgICBzdXBl\ncihzdG1udCwgY29ubik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50\nIGV4ZWN1dGVVcGRhdGUoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRl\nVXBkYXRlKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBSZXN1bHRTZXQgZXhl\nY3V0ZVF1ZXJ5KGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIu\nZXhlY3V0ZVF1ZXJ5KHdyYXApOwogICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50W10g\nZXhlY3V0ZUJhdGNoKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZXhlY3V0ZUJh\ndGNoKCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

