{"sha":"be3a2c3bac001750c1ea916d53537946518590c4","node_id":"MDQ6QmxvYjIwNjM2NDpiZTNhMmMzYmFjMDAxNzUwYzFlYTkxNmQ1MzUzNzk0NjUxODU5MGM0","size":26288,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/be3a2c3bac001750c1ea916d53537946518590c4","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9y\ndCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEu\ndXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5FeHBDb250ZXh0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuR2V0\nQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuSkRCQ0V4cHJlc3Npb25GYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuSkRCQ1N0cmluZ0NvbnRhaW5z\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMu\nSkRCQ1dpbGRjYXJkTWF0Y2g7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5rZXJuZWwuZXhwcy5RdWVyeUV4cHJlc3Npb25zU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TUUxFbWJl\nZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLlNRTEV4cHJlc3Npb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuZXhwcy5TUUxWYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5WZXJ0aWNhbENsYXNz\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hl\nbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuU1FMRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkV4cHJlc3Npb25TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5PcmRlcmluZ01lcmdlZFJlc3VsdE9iamVjdFByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4\ncHJlc3Npb25GYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5leHBzLkV4cHJlc3Npb25QYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJl\nc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5yb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2Vw\ndGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEpEQkMg\ncXVlcnkgaW1wbGVtZW50YXRpb24uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBKREJDU3RvcmVRdWVy\neSAKICAgIGV4dGVuZHMgRXhwcmVzc2lvblN0b3JlUXVlcnkgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFRhYmxlIElOVkFMSUQgPSBuZXcgVGFibGUo\nKTsKCiAgICAvLyBhZGQgYWxsIHN0YW5kYXJkIGZpbHRlciBhbmQgYWdncmVn\nYXRlIGxpc3RlbmVycyB0byB0aGVzZSBtYXBzCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBNYXAgX2xpc3RlbmVycyA9IG5ldyBIYXNoTWFwKCk7CgogICAg\nc3RhdGljIHsKICAgICAgICAvLyBkZXByZWNhdGVkIGV4dGVuc2lvbnMKICAg\nICAgICBfbGlzdGVuZXJzLnB1dChKREJDU3RyaW5nQ29udGFpbnMuVEFHLCBu\nZXcgSkRCQ1N0cmluZ0NvbnRhaW5zKCkpOwogICAgICAgIF9saXN0ZW5lcnMu\ncHV0KEpEQkNXaWxkY2FyZE1hdGNoLlRBRywgbmV3IEpEQkNXaWxkY2FyZE1h\ndGNoKCkpOwogICAgICAgIF9saXN0ZW5lcnMucHV0KFNRTEV4cHJlc3Npb24u\nVEFHLCBuZXcgU1FMRXhwcmVzc2lvbigpKTsKICAgICAgICBfbGlzdGVuZXJz\nLnB1dChTUUxWYWx1ZS5UQUcsIG5ldyBTUUxWYWx1ZSgpKTsKCiAgICAgICAg\nLy8gamRiYy1zcGVjaWZpYyBleHRlbnNpb25zCiAgICAgICAgX2xpc3RlbmVy\ncy5wdXQoR2V0Q29sdW1uLlRBRywgbmV3IEdldENvbHVtbigpKTsKICAgICAg\nICBfbGlzdGVuZXJzLnB1dChTUUxFbWJlZC5UQUcsIG5ldyBTUUxFbWJlZCgp\nKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIHRyYW5zaWVudCBKREJDU3Rv\ncmUgX3N0b3JlOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBzdG9yZSBtYW5hZ2VyLgogICAgICovCiAgICBwdWJsaWMgSkRCQ1N0b3Jl\nUXVlcnkoSkRCQ1N0b3JlIHN0b3JlLCBFeHByZXNzaW9uUGFyc2VyIHBhcnNl\ncikgewogICAgICAgIHN1cGVyKHBhcnNlcik7CiAgICAgICAgX3N0b3JlID0g\nc3RvcmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN0b3Jl\nLgogICAgICovCiAgICBwdWJsaWMgSkRCQ1N0b3JlIGdldFN0b3JlKCkgewog\nICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9CgogICAgcHVibGljIEZpbHRl\nckxpc3RlbmVyIGdldEZpbHRlckxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAg\nICAgICByZXR1cm4gKEZpbHRlckxpc3RlbmVyKSBfbGlzdGVuZXJzLmdldCh0\nYWcpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3Q29tcGlsYXRpb25L\nZXkoKSB7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9\nIChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBjdHgKICAgICAgICAgICAgLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBOdW1iZXJz\nLnZhbHVlT2YoZmV0Y2guZ2V0Sm9pblN5bnRheCgpKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpIHsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xh\nc3NNZXRhRGF0YVtdIGdldEluZGVwZW5kZW50RXhwcmVzc2lvbkNhbmRpZGF0\nZXMoCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YmNs\nYXNzZXMpIHsKICAgICAgICBpZiAoIXN1YmNsYXNzZXMpCiAgICAgICAgICAg\nIHJldHVybiBuZXcgQ2xhc3NNYXBwaW5nW10geyAoQ2xhc3NNYXBwaW5nKSBt\nZXRhIH07CiAgICAgICAgcmV0dXJuICgoQ2xhc3NNYXBwaW5nKSBtZXRhKS5n\nZXRJbmRlcGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBFeHByZXNzaW9uRmFjdG9yeSBnZXRFeHByZXNzaW9uRmFj\ndG9yeShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbmV3\nIEpEQkNFeHByZXNzaW9uRmFjdG9yeSgoQ2xhc3NNYXBwaW5nKSBtZXRhKTsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhl\nY3V0ZVF1ZXJ5KEV4ZWN1dG9yIGV4LAogICAgICAgIENsYXNzTWV0YURhdGEg\nYmFzZSwgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLCBib29sZWFuIHN1YmNsYXNz\nZXMsCiAgICAgICAgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywgUXVlcnlF\neHByZXNzaW9uc1tdIGV4cHMsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICBS\nYW5nZSByYW5nZSkgewogICAgICAgIGlmIChtZXRhcy5sZW5ndGggPiAxICYm\nIGV4cHNbMF0uaXNBZ2dyZWdhdGUoKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oTG9jYWxpemVyLmZvclBhY2thZ2UoSkRCQ1N0b3Jl\nUXVlcnkuY2xhc3MpLgogICAgICAgICAgICAgICAgZ2V0KCJtdWx0LW1hcHBp\nbmctYWdncmVnYXRlIiwgQXJyYXlzLmFzTGlzdChtZXRhcykpKTsKCiAgICAg\nICAgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3MgPSAoQ2xhc3NNYXBwaW5nW10p\nIG1ldGFzOwogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gg\nPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgCiAgICAgICAgICAgIGN0eC5n\nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBpZiAoZXhwc1swXS5m\nZXRjaFBhdGhzICE9IG51bGwpIHsKICAgICAgICAgICAgZmV0Y2guYWRkRmll\nbGRzKEFycmF5cy5hc0xpc3QoZXhwc1swXS5mZXRjaFBhdGhzKSk7CiAgICAg\nICAgICAgIGZldGNoLmFkZEpvaW5zKEFycmF5cy5hc0xpc3QoZXhwc1swXS5m\nZXRjaFBhdGhzKSk7CiAgICAgICAgfQoKICAgICAgICBpbnQgZWFnZXIgPSBj\nYWxjdWxhdGVFYWdlck1vZGUoZXhwc1swXSwgcmFuZ2Uuc3RhcnQsIHJhbmdl\nLmVuZCk7CiAgICAgICAgaW50IHN1YmNsYXNzTW9kZSA9IGZldGNoLmdldFN1\nYmNsYXNzRmV0Y2hNb2RlKChDbGFzc01hcHBpbmcpIGJhc2UpOwogICAgICAg\nIERCRGljdGlvbmFyeSBkaWN0ID0gX3N0b3JlLmdldERCRGljdGlvbmFyeSgp\nOwogICAgICAgIGxvbmcgc3RhcnQgPSAobWFwcGluZ3MubGVuZ3RoID09IDEg\nJiYgZGljdC5zdXBwb3J0c1NlbGVjdFN0YXJ0SW5kZXgpIAogICAgICAgICAg\nICA/IHJhbmdlLnN0YXJ0IDogMEw7CiAgICAgICAgbG9uZyBlbmQgPSAoZGlj\ndC5zdXBwb3J0c1NlbGVjdEVuZEluZGV4KSA/IHJhbmdlLmVuZCA6IExvbmcu\nTUFYX1ZBTFVFOwoKICAgICAgICBRdWVyeUV4cHJlc3Npb25zU3RhdGVbXSBz\ndGF0ZXMgPSBuZXcgUXVlcnlFeHByZXNzaW9uc1N0YXRlW2V4cHMubGVuZ3Ro\nXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgc3RhdGVzW2ldID0gbmV3IFF1ZXJ5RXhwcmVz\nc2lvbnNTdGF0ZSgpOwogICAgICAgIEV4cENvbnRleHQgY3R4ID0gbmV3IEV4\ncENvbnRleHQoX3N0b3JlLCBwYXJhbXMsIGZldGNoKTsKCiAgICAgICAgLy8g\nYWRkIHNlbGVjdHMgd2l0aCBwb3B1bGF0ZSBXSEVSRSBjb25kaXRpb25zIHRv\nIGxpc3QKICAgICAgICBMaXN0IHNlbHMgPSBuZXcgQXJyYXlMaXN0KG1hcHBp\nbmdzLmxlbmd0aCk7CiAgICAgICAgTGlzdCBzZWxNYXBwaW5ncyA9IG5ldyBB\ncnJheUxpc3QobWFwcGluZ3MubGVuZ3RoKTsKICAgICAgICBCaXRTZXQgc3Vi\nY2xhc3NCaXRzID0gbmV3IEJpdFNldCgpOwogICAgICAgIEJpdFNldCBuZXh0\nQml0cyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICBib29sZWFuIHVuaW9uYWJs\nZSA9IGNyZWF0ZVdoZXJlU2VsZWN0cyhzZWxzLCBtYXBwaW5ncywgc2VsTWFw\ncGluZ3MsCiAgICAgICAgICAgIHN1YmNsYXNzZXMsIHN1YmNsYXNzQml0cywg\nbmV4dEJpdHMsIGZhY3RzLCBleHBzLCBzdGF0ZXMsIGN0eCwKICAgICAgICAg\nICAgc3ViY2xhc3NNb2RlKQogICAgICAgICAgICAmJiBzdWJjbGFzc01vZGUg\nPT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOCiAgICAgICAg\nICAgICYmIHN0YXJ0ID09IDAKICAgICAgICAgICAgJiYgZW5kID09IExvbmcu\nTUFYX1ZBTFVFOwoKICAgICAgICAvLyB3ZSBtaWdodCB3YW50IHRvIHVzZSBs\ncnMgc2V0dGluZ3MgaWYgd2UgY2FuJ3QgdXNlIHRoZSByYW5nZQogICAgICAg\nIGlmIChzZWxzLnNpemUoKSA+IDEpCiAgICAgICAgICAgIHN0YXJ0ID0gMEw7\nCiAgICAgICAgYm9vbGVhbiBscnMgPSByYW5nZS5scnMgfHwgKGZldGNoLmdl\ndEZldGNoQmF0Y2hTaXplKCkgPj0gMCAKICAgICAgICAgICAgJiYgKHN0YXJ0\nICE9IHJhbmdlLnN0YXJ0IHx8IGVuZCAhPSByYW5nZS5lbmQpKTsKCiAgICAg\nICAgUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAg\nICBSZXN1bHRPYmplY3RQcm92aWRlciByb3AgPSBudWxsOwogICAgICAgIGlm\nICh1bmlvbmFibGUpIHsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSBfc3Rv\ncmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1VuaW9uKAogICAgICAgICAgICAgICAg\nKFNlbGVjdFtdKSBzZWxzLnRvQXJyYXkobmV3IFNlbGVjdFtzZWxzLnNpemUo\nKV0pKTsKICAgICAgICAgICAgQml0U2V0W10gcGFnZWQgPSBwb3B1bGF0ZVVu\naW9uKHVuaW9uLCBtYXBwaW5ncywgc3ViY2xhc3NlcywgZmFjdHMsCiAgICAg\nICAgICAgICAgICBleHBzLCBzdGF0ZXMsIGN0eCwgbHJzLCBlYWdlciwgc3Rh\ncnQsIGVuZCk7CiAgICAgICAgICAgIHVuaW9uLnNldExSUyhscnMpOwogICAg\nICAgICAgICByb3AgPSBleGVjdXRlVW5pb24odW5pb24sIG1hcHBpbmdzLCBl\neHBzLCBzdGF0ZXMsIGN0eCwgcGFnZWQpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGlmIChzZWxzLnNpemUoKSA+IDEpCiAgICAgICAgICAgICAg\nICByb3BzID0gbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW3NlbHMuc2l6ZSgp\nXTsKCiAgICAgICAgICAgIFNlbGVjdCBzZWw7CiAgICAgICAgICAgIEJpdFNl\ndCBwYWdlZDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGlkeCA9IDA7\nIGkgPCBzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBzZWwg\nPSAoU2VsZWN0KSBzZWxzLmdldChpKTsKICAgICAgICAgICAgICAgIHBhZ2Vk\nID0gcG9wdWxhdGVTZWxlY3Qoc2VsLCAoQ2xhc3NNYXBwaW5nKSBzZWxNYXBw\naW5ncy5nZXQoaSksCiAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3NCaXRz\nLmdldChpKSwgKEpEQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFjdHNbaWR4XSwK\nICAgICAgICAgICAgICAgICAgICBleHBzW2lkeF0sIHN0YXRlc1tpZHhdLCBj\ndHgsIGxycywgZWFnZXIsIHN0YXJ0LCBlbmQpOwoKICAgICAgICAgICAgICAg\nIHJvcCA9IGV4ZWN1dGVTZWxlY3Qoc2VsLCAoQ2xhc3NNYXBwaW5nKSBzZWxN\nYXBwaW5ncy5nZXQoaSksCiAgICAgICAgICAgICAgICAgICAgZXhwc1tpZHhd\nLCBzdGF0ZXNbaWR4XSwgY3R4LCBwYWdlZCwgc3RhcnQsIGVuZCk7CiAgICAg\nICAgICAgICAgICBpZiAocm9wcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHJvcHNbaV0gPSByb3A7CgogICAgICAgICAgICAgICAgaWYgKG5leHRC\naXRzLmdldChpKSkKICAgICAgICAgICAgICAgICAgICBpZHgrKzsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHJvcHMgIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoZXhwc1swXS5hc2NlbmRpbmcubGVuZ3RoID09\nIDApCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgTWVyZ2VkUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIocm9wcyk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgcm9wID0gbmV3IE9yZGVyaW5nTWVyZ2VkUmVzdWx0T2JqZWN0\nUHJvdmlkZXIocm9wcywKICAgICAgICAgICAgICAgICAgICBleHBzWzBdLmFz\nY2VuZGluZywgZXgsIHRoaXMsIHBhcmFtcyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIG5lZWQgdG8gZmFrZSByZXN1bHQgcmFuZ2U/\nCiAgICAgICAgaWYgKChyb3BzICE9IG51bGwgJiYgcmFuZ2UuZW5kICE9IExv\nbmcuTUFYX1ZBTFVFKSAKICAgICAgICAgICAgfHwgc3RhcnQgIT0gcmFuZ2Uu\nc3RhcnQgfHwgZW5kICE9IHJhbmdlLmVuZCkKICAgICAgICAgICAgcm9wID0g\nbmV3IFJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCByYW5nZS5zdGFy\ndCwgcmFuZ2UuZW5kKTsKICAgICAgICByZXR1cm4gcm9wOwogICAgfQoKICAg\nIC8qKgogICAgICogU2VsZWN0IGRhdGEgZm9yIHRoZSBnaXZlbiB1bmlvbiwg\ncmV0dXJuaW5nIHBhZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBC\naXRTZXRbXSBwb3B1bGF0ZVVuaW9uKFVuaW9uIHVuaW9uLCBmaW5hbCBDbGFz\nc01hcHBpbmdbXSBtYXBwaW5ncywKICAgICAgICBmaW5hbCBib29sZWFuIHN1\nYmNsYXNzZXMsIGZpbmFsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsCiAg\nICAgICAgZmluYWwgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMsIGZpbmFsIFF1\nZXJ5RXhwcmVzc2lvbnNTdGF0ZVtdIHN0YXRlcywKICAgICAgICBmaW5hbCBF\neHBDb250ZXh0IGN0eCwgZmluYWwgYm9vbGVhbiBscnMsIGZpbmFsIGludCBl\nYWdlciwKICAgICAgICBmaW5hbCBsb25nIHN0YXJ0LCBmaW5hbCBsb25nIGVu\nZCkgewogICAgICAgIGZpbmFsIEJpdFNldFtdIHBhZ2VkID0gKGV4cHNbMF0u\ncHJvamVjdGlvbnMubGVuZ3RoID4gMCkgPyBudWxsCiAgICAgICAgICAgIDog\nbmV3IEJpdFNldFttYXBwaW5ncy5sZW5ndGhdOwogICAgICAgIHVuaW9uLnNl\nbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAg\nICAgICAgICBCaXRTZXQgYml0cyA9IHBvcHVsYXRlU2VsZWN0KHNlbCwgbWFw\ncGluZ3NbaWR4XSwgc3ViY2xhc3NlcywKICAgICAgICAgICAgICAgICAgICAo\nSkRCQ0V4cHJlc3Npb25GYWN0b3J5KSBmYWN0c1tpZHhdLCBleHBzW2lkeF0s\nIHN0YXRlc1tpZHhdLAogICAgICAgICAgICAgICAgICAgIGN0eCwgIGxycywg\nZWFnZXIsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICAgICAgaWYgKHBhZ2Vk\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcGFnZWRbaWR4XSA9IGJp\ndHM7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4g\ncGFnZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZGF0YSBmb3Ig\ndGhlIGdpdmVuIHNlbGVjdCwgcmV0dXJuaW5nIHBhZ2VkIGZpZWxkcy4KICAg\nICAqLwogICAgcHJpdmF0ZSBCaXRTZXQgcG9wdWxhdGVTZWxlY3QoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgYm9vbGVhbiBz\ndWJjbGFzc2VzLCBKREJDRXhwcmVzc2lvbkZhY3RvcnkgZmFjdCwgUXVlcnlF\neHByZXNzaW9ucyBleHBzLAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0\nZSBzdGF0ZSwgRXhwQ29udGV4dCBjdHgsIGJvb2xlYW4gbHJzLCBpbnQgZWFn\nZXIsCiAgICAgICAgbG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBz\nZWwuc2V0TFJTKGxycyk7CiAgICAgICAgc2VsLnNldFJhbmdlKHN0YXJ0LCBl\nbmQpOwoKICAgICAgICBCaXRTZXQgcGFnZWQgPSBudWxsOwogICAgICAgIGlm\nIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAg\nIHBhZ2VkID0gUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIuZ2V0UGFnZWRG\naWVsZHMoc2VsLCBtYXBwaW5nLAogICAgICAgICAgICAgICAgX3N0b3JlLCBj\ndHguZmV0Y2gsIGVhZ2VyLCBlbmQgLSBzdGFydCk7CiAgICAgICAgICAgIGlm\nIChwYWdlZCAhPSBudWxsKQogICAgICAgICAgICAgICAgZWFnZXIgPSBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU47CiAgICAgICAgfQoKICAg\nICAgICBmYWN0LmdldFNlbGVjdENvbnN0cnVjdG9yKCkuc2VsZWN0KHNlbCwg\nY3R4LCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBleHBzLAogICAgICAgICAgICBz\ndGF0ZSwgZWFnZXIpOwogICAgICAgIHJldHVybiBwYWdlZDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEV4ZWN1dGUgdGhlIGdpdmVuIHVuaW9uLgogICAgICov\nCiAgICBwcml2YXRlIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVVbmlv\nbihVbmlvbiB1bmlvbiwKICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5n\ncywgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMsIAogICAgICAgIFF1ZXJ5RXhw\ncmVzc2lvbnNTdGF0ZVtdIHN0YXRlcywgRXhwQ29udGV4dCBjdHgsIEJpdFNl\ndFtdIHBhZ2VkKSB7CiAgICAgICAgaWYgKGV4cHNbMF0ucHJvamVjdGlvbnMu\nbGVuZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9qZWN0aW9u\nUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIGV4cHMsIHN0YXRlcywgY3R4\nKTsKCiAgICAgICAgaWYgKHBhZ2VkICE9IG51bGwpCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgcGFnZWQubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBpZiAocGFnZWRbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHVu\naW9uLCBtYXBwaW5ncywKICAgICAgICAgICAgICAgICAgICAgICAgX3N0b3Jl\nLCBjdHguZmV0Y2gsIHBhZ2VkLCBMb25nLk1BWF9WQUxVRSk7CgogICAgICAg\nIHJldHVybiBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcih1bmlv\nbiwgbWFwcGluZ3NbMF0sIF9zdG9yZSwKICAgICAgICAgICAgY3R4LmZldGNo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgdGhlIGdpdmVuIHNl\nbGVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHRPYmplY3RQcm92aWRl\nciBleGVjdXRlU2VsZWN0KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBw\naW5nLAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcywgUXVlcnlFeHBy\nZXNzaW9uc1N0YXRlIHN0YXRlLCBFeHBDb250ZXh0IGN0eCwgCiAgICAgICAg\nQml0U2V0IHBhZ2VkLCBsb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgICAg\nIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nIHJldHVybiBuZXcgUHJvamVjdGlvblJlc3VsdE9iamVjdFByb3ZpZGVyKHNl\nbCwgZXhwcywgc3RhdGUsIGN0eCk7CiAgICAgICAgaWYgKHBhZ2VkICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgUGFnaW5nUmVzdWx0T2JqZWN0\nUHJvdmlkZXIoc2VsLCBtYXBwaW5nLCBfc3RvcmUsIAogICAgICAgICAgICAg\nICAgY3R4LmZldGNoLCBwYWdlZCwgZW5kIC0gc3RhcnQpOwogICAgICAgIHJl\ndHVybiBuZXcgSW5zdGFuY2VSZXN1bHRPYmplY3RQcm92aWRlcihzZWwsIG1h\ncHBpbmcsIF9zdG9yZSwgCiAgICAgICAgICAgIGN0eC5mZXRjaCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgc2VsZWN0cyB3aXRoIFdI\nRVJFIGNvbmRpdGlvbnMgbmVlZGVkIHRvIGV4ZWN1dGUgdGhlIHF1ZXJ5CiAg\nICAgKiBmb3IgdGhlIGdpdmVuIG1hcHBpbmdzLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gY3JlYXRlV2hlcmVTZWxlY3RzKExpc3Qgc2VscywgQ2xh\nc3NNYXBwaW5nW10gbWFwcGluZ3MsCiAgICAgICAgTGlzdCBzZWxNYXBwaW5n\ncywgYm9vbGVhbiBzdWJjbGFzc2VzLCBCaXRTZXQgc3ViY2xhc3NCaXRzLAog\nICAgICAgIEJpdFNldCBuZXh0Qml0cywgRXhwcmVzc2lvbkZhY3RvcnlbXSBm\nYWN0cywgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMsCiAgICAgICAgUXVlcnlF\neHByZXNzaW9uc1N0YXRlW10gc3RhdGVzLCBFeHBDb250ZXh0IGN0eCwgaW50\nIHN1YmNsYXNzTW9kZSkgewogICAgICAgIENsYXNzTWFwcGluZ1tdIHZlcnRz\nOwogICAgICAgIGJvb2xlYW4gdW5pb25hYmxlID0gdHJ1ZTsKICAgICAgICBT\nZWxlY3Qgc2VsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGlu\nZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHZl\ncnRpY2FsIG1hcHBpbmdzIHRvIHNlbGVjdCBzZXBhcmF0ZWx5CiAgICAgICAg\nICAgIHZlcnRzID0gZ2V0VmVydGljYWxNYXBwaW5ncyhtYXBwaW5nc1tpXSwg\nc3ViY2xhc3NlcywgZXhwc1tpXSwKICAgICAgICAgICAgICAgIHN1YmNsYXNz\nTW9kZSk7CiAgICAgICAgICAgIGlmICh2ZXJ0cy5sZW5ndGggPT0gMSAmJiBz\ndWJjbGFzc2VzKQogICAgICAgICAgICAgICAgc3ViY2xhc3NCaXRzLnNldChz\nZWxzLnNpemUoKSk7CgogICAgICAgICAgICAvLyBjcmVhdGUgY3JpdGVyaWEg\nc2VsZWN0IGFuZCBjbG9uZSBmb3IgZWFjaCB2ZXJ0IG1hcHBpbmcKICAgICAg\nICAgICAgc2VsID0gKChKREJDRXhwcmVzc2lvbkZhY3RvcnkpIGZhY3RzW2ld\nKS5nZXRTZWxlY3RDb25zdHJ1Y3RvcigpLgogICAgICAgICAgICAgICAgZXZh\nbHVhdGUoY3R4LCBudWxsLCBudWxsLCBleHBzW2ldLCBzdGF0ZXNbaV0pOwog\nICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHZlcnRzLmxlbmd0aDsg\naisrKSB7CiAgICAgICAgICAgICAgICBzZWxNYXBwaW5ncy5hZGQodmVydHNb\nal0pOwogICAgICAgICAgICAgICAgaWYgKGogPT0gdmVydHMubGVuZ3RoIC0g\nMSkgewogICAgICAgICAgICAgICAgICAgIG5leHRCaXRzLnNldChzZWxzLnNp\nemUoKSk7CiAgICAgICAgICAgICAgICAgICAgc2Vscy5hZGQoc2VsKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNlbHMu\nYWRkKHNlbC5mdWxsQ2xvbmUoMSkpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyB0dXJuIG9mZiB1bmlvbmluZyBpZiBhIGdpdmVuIGluZGVwZW5k\nZW50IG1hcHBpbmcgcmVxdWlyZXMKICAgICAgICAgICAgLy8gbXVsdGlwbGUg\nc2VsZWN0cywgb3IgaWYgd2UncmUgdXNpbmcgRlJPTSBzZWxlY3RzCiAgICAg\nICAgICAgIGlmICh2ZXJ0cy5sZW5ndGggPiAxIHx8IHNlbC5nZXRGcm9tU2Vs\nZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHVuaW9uYWJsZSA9IGZh\nbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdW5pb25hYmxlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCB0aGUgdmVydGljYWwgbWFw\ncGluZ3MgdG8gc2VsZWN0IHNlcGFyYXRlbHkuIERlcGVuZHMgb24KICAgICAq\nIHN1YmNsYXNzIGZldGNoIG1vZGUgYW5kIHRoZSB0eXBlIG9mIHF1ZXJ5Lgog\nICAgICovCiAgICBwcml2YXRlIENsYXNzTWFwcGluZ1tdIGdldFZlcnRpY2Fs\nTWFwcGluZ3MoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgYm9vbGVh\nbiBzdWJjbGFzc2VzLCBRdWVyeUV4cHJlc3Npb25zIGV4cHMsIGludCBzdWJj\nbGFzc01vZGUpIHsKICAgICAgICBpZiAoIXN1YmNsYXNzZXMgfHwgZXhwcy5w\ncm9qZWN0aW9ucy5sZW5ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gbmV3\nIENsYXNzTWFwcGluZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBpZiAoc3Vi\nY2xhc3NNb2RlICE9IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFS\nQUxMRUwKICAgICAgICAgICAgfHwgIWhhc1ZlcnRpY2FsU3ViY2xhc3Nlcyht\nYXBwaW5nKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBDbGFzc01hcHBpbmdb\nXSB7IG1hcHBpbmcgfTsKCiAgICAgICAgTGlzdCBzdWJzID0gbmV3IEFycmF5\nTGlzdCg0KTsKICAgICAgICBhZGRTdWJjbGFzc2VzKG1hcHBpbmcsIHN1YnMp\nOwogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIHN1YnMudG9BcnJh\neShuZXcgQ2xhc3NNYXBwaW5nW3N1YnMuc2l6ZSgpXSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVyIHRvIGFkZCBtYXBwaW5ncyBm\nb3Igc3ViY2xhc3NlcyB0byB0aGUgZ2l2ZW4gbGlzdC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzZXMoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIENvbGxlY3Rpb24gc3VicykgewogICAgICAgIC8vIHBvc3NpYmxlIGZ1\ndHVyZSBvcHRpbWl6YXRpb25zOgogICAgICAgIC8vIC0gaWYgbm8gZmllbGRz\nIGluIG1ldGEgb3IgaXRzIHN1YmNsYXNzZXMgKGFuZCBub3QgaW4gYW4KICAg\nICAgICAvLyAgIGFscmVhZHktc2VsZWN0ZWQgdGFibGUpIGFyZSBpbiB0aGUg\nY3VycmVudCBmZXRjaAogICAgICAgIC8vICAgY29uZmlndXJhdGlvbiwgc3Rv\ncCBjcmVhdGluZyBuZXcgZXhlY3V0b3JzCiAgICAgICAgLy8gLSBhbGxvdyBh\nbiBleGVjdXRvciB0byBzZWxlY3QgYSByYW5nZSBvZiBzdWJjbGFzc2VzLCBy\nYXRoZXIKICAgICAgICAvLyAgIHRoYW4ganVzdCBhbGwgc3ViY2xhc3NlcyAv\nIG5vIHN1YmNsYXNzZXM7IHRoaXMgd291bGQKICAgICAgICAvLyAgIGFsbG93\nIHVzIHRvIGRvIGp1c3Qgb25lIHF1ZXJ5IHBlciBhY3R1YWwgdmVydGljYWxs\neS1tYXBwZWQKICAgICAgICAvLyAgIHN1YmNsYXNzLCByYXRoZXIgdGhhbiBv\nbmUgcGVyIG1hcHBlZCBzdWJjbGFzcywgYXMgaXMgaGFwcGVuaW5nIG5vdwoK\nICAgICAgICBzdWJzLmFkZChtYXBwaW5nKTsKICAgICAgICBpZiAoIWhhc1Zl\ncnRpY2FsU3ViY2xhc3NlcyhtYXBwaW5nKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyByZWN1cnNlIG9uIGltbWVkaWF0ZSBzdWJjbGFzc2Vz\nCiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3ViTWFwcGluZ3MgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzdWJNYXBwaW5ncy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKHN1Yk1hcHBpbmdzW2ldLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpID09IG1hcHBpbmcpCiAgICAgICAgICAgICAgICBh\nZGRTdWJjbGFzc2VzKHN1Yk1hcHBpbmdzW2ldLCBzdWJzKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBjbGFzcyBo\nYXMgYW55IHZlcnRpY2FsIHN1YmNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gaGFzVmVydGljYWxTdWJjbGFzc2VzKENsYXNz\nTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3Vi\ncyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmIChzdWJzW2ldLmdldFN0cmF0ZWd5KCkgaW5zdGFu\nY2VvZiBWZXJ0aWNhbENsYXNzU3RyYXRlZ3kpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgZWFnZXIgbW9kZSBkZXBlbmRzIG9uIHRoZSB1bmlx\ndWUgc2V0dGluZyBhbmQgcmFuZ2UuIElmIHRoZSByYW5nZQogICAgICogcHJv\nZHVjZXMgMCByZXN1bHRzLCB1c2UgZWFnZXIgc2V0dGluZyBvZiBub25lLiBJ\nZiBpdCBwcm9kdWNlcyAxIHJlc3VsdAogICAgICogb3IgdGhlIHF1ZXJ5IGlz\nIHVuaXF1ZSwgdXNlIGFuIGVhZ2VyIHNldHRpbmcgb2Ygc2luZ2xlLiBPdGhl\ncndpc2UgdXNlCiAgICAgKiBhbiBlYWdlciBtb2RlIG9mIG11bHRpcGxlLgog\nICAgICovCiAgICBwcml2YXRlIGludCBjYWxjdWxhdGVFYWdlck1vZGUoUXVl\ncnlFeHByZXNzaW9ucyBleHBzLCBsb25nIHN0YXJ0LAogICAgICAgIGxvbmcg\nZW5kKSB7CiAgICAgICAgaWYgKGV4cHMucHJvamVjdGlvbnMubGVuZ3RoID4g\nMCB8fCBzdGFydCA+PSBlbmQpCiAgICAgICAgICAgIHJldHVybiBFYWdlckZl\ndGNoTW9kZXMuRUFHRVJfTk9ORTsKICAgICAgICBpZiAoZW5kIC0gc3RhcnQg\nPT0gMSB8fCBjdHguaXNVbmlxdWUoKSkKICAgICAgICAgICAgcmV0dXJuIEVh\nZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9KT0lOOwogICAgICAgIHJldHVybiBFYWdl\nckZldGNoTW9kZXMuRUFHRVJfUEFSQUxMRUw7CiAgICB9CgogICAgcHJvdGVj\ndGVkIE51bWJlciBleGVjdXRlRGVsZXRlKEV4ZWN1dG9yIGV4LCBDbGFzc01l\ndGFEYXRhIGJhc2UsCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLCBi\nb29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMs\nCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMsIE9iamVjdFtdIHBh\ncmFtcykgewogICAgICAgIHJldHVybiBleGVjdXRlQnVsa09wZXJhdGlvbihl\neCwgYmFzZSwgbWV0YXMsIHN1YmNsYXNzZXMsIGZhY3RzLCBleHBzLAogICAg\nICAgICAgICBwYXJhbXMsIG51bGwpOwogICAgfQoKICAgIHByb3RlY3RlZCBO\ndW1iZXIgZXhlY3V0ZVVwZGF0ZShFeGVjdXRvciBleCwgQ2xhc3NNZXRhRGF0\nYSBiYXNlLAogICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcywgYm9vbGVh\nbiBzdWJjbGFzc2VzLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLAogICAg\nICAgIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLCBPYmplY3RbXSBwYXJhbXMp\nIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZUJ1bGtPcGVyYXRpb24oZXgsIGJh\nc2UsIG1ldGFzLCBzdWJjbGFzc2VzLCBmYWN0cywgZXhwcywKICAgICAgICAg\nICAgcGFyYW1zLCBleHBzWzBdLnVwZGF0ZXMpOwogICAgfQoKICAgIHByaXZh\ndGUgTnVtYmVyIGV4ZWN1dGVCdWxrT3BlcmF0aW9uKEV4ZWN1dG9yIGV4LCBD\nbGFzc01ldGFEYXRhIGJhc2UsCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1l\ndGFzLCBib29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10g\nZmFjdHMsCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIGV4cHMsIE9iamVj\ndFtdIHBhcmFtcywgTWFwIHVwZGF0ZXMpIHsKICAgICAgICAvLyB3ZSBjYW5u\nb3QgZXhlY3V0ZSBhIGJ1bGsgZGVsZXRlIHN0YXRlbWVudCB3aGVuIGhhdmUg\nbWFwcGluZ3MgaW4KICAgICAgICAvLyBtdWx0aXBsZSB0YWJsZXMsIHNvIGlu\nZGljYXRlIHdlIHdhbnQgdG8gdXNlIGluLW1lbW9yeSB3aXRoIG51bGwKICAg\nICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IChDbGFzc01hcHBpbmdb\nXSkgbWV0YXM7CiAgICAgICAgYm9vbGVhbiBpc1VwZGF0ZSA9IHVwZGF0ZXMg\nIT0gbnVsbCAmJiB1cGRhdGVzLnNpemUoKSA+IDA7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoIWlzU2luZ2xlVGFibGVNYXBwaW5nKG1hcHBpbmdzW2ldLCBz\ndWJjbGFzc2VzKSAmJiAhaXNVcGRhdGUpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgICAgIGlmICghaXNVcGRhdGUpIHsKICAgICAg\nICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSBhbnkgZGVsZXRlIGNhbGxiYWNr\ncywgd2UgbmVlZCB0bwogICAgICAgICAgICAgICAgLy8gZXhlY3V0ZSBpbi1t\nZW1vcnkgc28gdGhlIGNhbGxiYWNrcyBhcmUgaW52b2tlZAogICAgICAgICAg\nICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIG1nciA9IGN0eC5nZXRTdG9y\nZUNvbnRleHQoKS5nZXRCcm9rZXIoKQogICAgICAgICAgICAgICAgICAgIC5n\nZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGlm\nIChtZ3IuaGFzRGVsZXRlTGlzdGVuZXJzKG51bGwsIG1hcHBpbmdzW2ldKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSAKICAgICAgICAgICAg\nY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIEV4cENvbnRl\neHQgY3R4ID0gbmV3IEV4cENvbnRleHQoX3N0b3JlLCBwYXJhbXMsIGZldGNo\nKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9zdG9yZS5nZXREQkRp\nY3Rpb25hcnkoKTsKICAgICAgICBRdWVyeUV4cHJlc3Npb25zU3RhdGVbXSBz\ndGF0ZSA9IG5ldyBRdWVyeUV4cHJlc3Npb25zU3RhdGVbZXhwcy5sZW5ndGhd\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGUubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIHN0YXRlW2ldID0gbmV3IFF1ZXJ5RXhwcmVzc2lv\nbnNTdGF0ZSgpOwoKICAgICAgICBTUUxCdWZmZXJbXSBzcWwgPSBuZXcgU1FM\nQnVmZmVyW21hcHBpbmdzLmxlbmd0aF07CiAgICAgICAgSkRCQ0V4cHJlc3Np\nb25GYWN0b3J5IGpkYmNGYWN0b3J5OwogICAgICAgIFNlbGVjdCBzZWw7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBqZGJjRmFjdG9yeSA9IChKREJDRXhwcmVzc2lv\nbkZhY3RvcnkpIGZhY3RzW2ldOwogICAgICAgICAgICBzZWwgPSBqZGJjRmFj\ndG9yeS5nZXRTZWxlY3RDb25zdHJ1Y3RvcigpLmV2YWx1YXRlKGN0eCwgbnVs\nbCwgbnVsbCwKICAgICAgICAgICAgICAgIGV4cHNbaV0sIHN0YXRlW2ldKTsK\nICAgICAgICAgICAgamRiY0ZhY3RvcnkuZ2V0U2VsZWN0Q29uc3RydWN0b3Io\nKS5zZWxlY3Qoc2VsLCBjdHgsIG1hcHBpbmdzW2ldLCAKICAgICAgICAgICAg\nICAgIHN1YmNsYXNzZXMsIGV4cHNbaV0sIHN0YXRlW2ldLCAKICAgICAgICAg\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSk7Cgog\nICAgICAgICAgICAvLyBzcGVjaWZpY2F0aW9uIG9mIHRoZSAidWRwYXRlcyIg\nbWFwIGluZGljYXRlcyB0aGF0IHRoaXMgaXMKICAgICAgICAgICAgLy8gYW4g\ndXBkYXRlIHF1ZXJ5OyBvdGhlcndpc2UsIHRoaXMgaXMgYSBkZWxldGUgc3Rh\ndGVtZW50CiAgICAgICAgICAgIC8vIFRoZSBidWxrIG9wZXJhdGlvbiB3aWxs\nIHJldHVybiBudWxsIHRvIGluZGljYXRlIHRoYXQgdGhlIGRhdGFiYXNlCiAg\nICAgICAgICAgIC8vIGRvZXMgbm90IHN1cHBvcnQgdGhlIHJlcXVlc3QgYnVs\nayBkZWxldGUgb3BlcmF0aW9uOyBpbgogICAgICAgICAgICAvLyB0aGlzIGNh\nc2UsIHdlIG5lZWQgdG8gcGVyZm9ybSB0aGUgcXVlcnkgaW4tbWVtb3J5IGFu\nZAogICAgICAgICAgICAvLyBtYW51YWxseSBkZWxldGUgdGhlIGluc3RhbmNl\ncwogICAgICAgICAgICBpZiAodXBkYXRlcyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgc3FsW2ldID0gZGljdC50b0RlbGV0ZShtYXBwaW5nc1tpXSwgc2Vs\nLCBfc3RvcmUsIHBhcmFtcyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIHNxbFtpXSA9IGRpY3QudG9VcGRhdGUobWFwcGluZ3NbaV0sIHNl\nbCwgX3N0b3JlLCBwYXJhbXMsCiAgICAgICAgICAgICAgICAgICAgdXBkYXRl\ncyk7CgogICAgICAgICAgICBpZiAoc3FsW2ldID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIHdl\nIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGhhdmUgYW4gYWN0aXZlIHN0b3JlIGNv\nbm5lY3Rpb24KICAgICAgICBfc3RvcmUuZ2V0Q29udGV4dCgpLmJlZ2luU3Rv\ncmUoKTsKCiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gX3N0b3JlLmdldENv\nbm5lY3Rpb24oKTsKICAgICAgICBsb25nIGNvdW50ID0gMDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzcWwubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHN0bW50ID0gbnVsbDsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc3RtbnQgPSBzcWxbaV0u\ncHJlcGFyZVN0YXRlbWVudChjb25uKTsKICAgICAgICAgICAgICAgICAgICBj\nb3VudCArPSBzdG1udC5leGVjdXRlVXBkYXRlKCk7CiAgICAgICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIGlmIChzdG1udCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5j\nbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9u\ncy5nZXRTdG9yZShzZSwgY3R4LCBfc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7IGNvbm4u\nY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGNvdW50KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGdpdmVuIG1hcHBpbmcg\nb2NjdXBpZXMgb25seSBvbmUgdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBpc1NpbmdsZVRhYmxlTWFwcGluZyhDbGFzc01hcHBpbmcgbWFw\ncGluZywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgcm9vdCA9IG1hcHBpbmc7CiAgICAgICAgd2hpbGUgKHJv\nb3QuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgcm9vdCA9IHJvb3QuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKGhhc1ZlcnRpY2FsU3ViY2xhc3Nl\ncyhyb290KSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAv\nLyB3ZSBjYW5ub3QgZXhlY3V0ZSBhIGJ1bGsgZGVsZXRlIGlmIGFueSBvZiB0\naGUKICAgICAgICAvLyBmaWVsZCBtYXBwaW5ncyBmb3IgdGhlIGNhbmRpZGF0\nZXMgaGF2ZSBjb2x1bW5zCiAgICAgICAgLy8gaW4gYW55IG90aGVyIHRhYmxl\nLCBzaW5jZSBidWxrIGRlbGV0aW5nIGp1c3QgZnJvbSB0aGUKICAgICAgICAv\nLyBjbGFzcyB3aWxsIGxlYXZlIGRhbmdsaW5nIHJlbGF0aW9uczsgd2UgbWln\naHQgYmUgYWJsZQogICAgICAgIC8vIHRvIGlzc3VlIGJ1bGsgZGVsZXRlcyBz\nZXBhcmF0ZWx5IGZvciB0aGUgam9pbnMgKHBvc3NpYmx5CiAgICAgICAgLy8g\ndXNpbmcgYSB0ZW1wb3JhcnkgdGFibGUgdG8gc2VsZWN0IHRoZSBwcmltYXJ5\nIGtleXMgZm9yCiAgICAgICAgLy8gYWxsIHRoZSByZWxhdGVkIHRhYmxlcyBh\nbmQgdGhlbiBpc3NpbmcgYSBkZWxldGUgYWdhaW5zdCB0aG9zZQogICAgICAg\nIC8vIGtleXMpLCBidXQgdGhhdCBsb2dpYyBpcyBub3QgY3VycmVudGx5IGlt\ncGxlbWVudGVkCiAgICAgICAgVGFibGUgdGFibGUgPSBnZXRUYWJsZShtYXBw\naW5nLmdldEZpZWxkTWFwcGluZ3MoKSwgbnVsbCk7CiAgICAgICAgaWYgKHRh\nYmxlID09IElOVkFMSUQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgaWYgKHN1YmNsYXNzZXMpIHsKICAgICAgICAgICAgLy8gaWYgd2Ug\nYXJlIGluY2x1ZGluZyBzdWJjbGFzc2VzLCB3ZSBhbHNvIG5lZWQgdG8gZ2F0\naGVyCiAgICAgICAgICAgIC8vIGFsbCB0aGUgbWFwcGluZ3MgZm9yIGFsbCBr\nbm93biBzdWJjbGFzc2VzCiAgICAgICAgICAgIENsYXNzTWFwcGluZ1tdIHN1\nYnMgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBzdWJzICE9IG51bGwgJiYg\naSA8IHN1YnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYmxl\nID0gZ2V0VGFibGUoc3Vic1tpXS5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygp\nLCB0YWJsZSk7CiAgICAgICAgICAgICAgICBpZiAodGFibGUgPT0gSU5WQUxJ\nRCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNpbmdsZSB0YWJsZSBmb3IgdGhl\nIGdpdmVuIGZpZWxkcywgb3IgSU5WQUxJRCBpZiB0aGV5CiAgICAgKiB1c2Ug\nbXVsdGlwbGUgdGFibGVzLgogICAgICovCiAgICBwcml2YXRlIFRhYmxlIGdl\ndFRhYmxlKEZpZWxkTWFwcGluZ1tdIGZpZWxkcywgVGFibGUgdGFibGUpIHsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB0YWJsZSA9IGdldFRhYmxlKGZpZWxkc1tpXSwg\ndGFibGUpOwogICAgICAgICAgICBpZiAodGFibGUgPT0gSU5WQUxJRCkKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ndGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHRhYmxl\nIGZvciB0aGUgZmllbGQgaWYgdGhlIGdpdmVuIHRhYmxlIGhhc24ndCBiZWVu\nIHNldAogICAgICogeWV0LCBvciBpZiB0aGUgdGFibGVzIG1hdGNoLiBJZiB0\naGUgZmllbGQgdXNlcyBhIGRpZmZlcmVudCB0YWJsZSwKICAgICAqIHJldHVy\nbnMgSU5WQUxJRC4gQWxzbyByZXR1cm5zIElOVkFMSUQgaWYgZmllbGQgaXMg\nZGVwZW5kZW50LgogICAgICovCiAgICBwcml2YXRlIFRhYmxlIGdldFRhYmxl\nKEZpZWxkTWFwcGluZyBmbSwgVGFibGUgdGFibGUpIHsKICAgICAgICBpZiAo\nZm0uZ2V0Q2FzY2FkZURlbGV0ZSgpICE9IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9OT05FKQogICAgICAgICAgICByZXR1cm4gSU5WQUxJRDsKCiAgICAgICAg\nQ29sdW1uW10gY29sdW1ucyA9IGZtLmdldENvbHVtbnMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgY29sdW1ucyAhPSBudWxsICYmIGkgPCBjb2x1bW5z\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0YWJsZSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGFibGUgPSBjb2x1bW5zW2ldLmdldFRhYmxl\nKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRhYmxlICE9IGNvbHVtbnNbaV0u\nZ2V0VGFibGUoKSkKICAgICAgICAgICAgICAgIHJldHVybiBJTlZBTElEOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdGFibGU7CiAgICB9CgogICAgcHJv\ndGVjdGVkIE51bWJlciBleGVjdXRlVXBkYXRlKENsYXNzTWV0YURhdGEgYmFz\nZSwgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLAogICAgICAgIGJvb2xlYW4gc3Vi\nY2xhc3NlcywgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywKICAgICAgICBR\ndWVyeUV4cHJlc3Npb25zW10gcGFyc2VkLCBPYmplY3RbXSBwYXJhbXMpIHsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhDbGFzc01ldGFEYXRhIGJhc2Us\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzLCBib29sZWFuIHN1YmNs\nYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsCiAgICAgICAgUXVl\ncnlFeHByZXNzaW9uc1tdIGV4cHMsIE9iamVjdFtdIHBhcmFtcywgUmFuZ2Ug\ncmFuZ2UpIHsKICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IChD\nbGFzc01hcHBpbmdbXSkgbWV0YXM7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBjdHgu\nCiAgICAgICAgICAgIGdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAg\nIGlmIChleHBzWzBdLmZldGNoUGF0aHMgIT0gbnVsbCkgewogICAgICAgICAg\nICBmZXRjaC5hZGRGaWVsZHMoQXJyYXlzLmFzTGlzdChleHBzWzBdLmZldGNo\nUGF0aHMpKTsKICAgICAgICAgICAgZmV0Y2guYWRkSm9pbnMoQXJyYXlzLmFz\nTGlzdChleHBzWzBdLmZldGNoUGF0aHMpKTsKICAgICAgICB9CgogICAgICAg\nIGludCBlYWdlciA9IGNhbGN1bGF0ZUVhZ2VyTW9kZShleHBzWzBdLCByYW5n\nZS5zdGFydCwgcmFuZ2UuZW5kKTsKICAgICAgICBlYWdlciA9IE1hdGgubWlu\nKGVhZ2VyLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4pOwog\nICAgICAgIGludCBzdWJjbGFzc01vZGUgPSBmZXRjaC5nZXRTdWJjbGFzc0Zl\ndGNoTW9kZSgoQ2xhc3NNYXBwaW5nKSBiYXNlKTsKICAgICAgICBEQkRpY3Rp\nb25hcnkgZGljdCA9IF9zdG9yZS5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAg\nICBsb25nIHN0YXJ0ID0gKG1hcHBpbmdzLmxlbmd0aCA9PSAxICYmIGRpY3Qu\nc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4KSAKICAgICAgICAgICAgPyByYW5n\nZS5zdGFydCA6IDBMOwogICAgICAgIGxvbmcgZW5kID0gKGRpY3Quc3VwcG9y\ndHNTZWxlY3RFbmRJbmRleCkgPyByYW5nZS5lbmQgOiBMb25nLk1BWF9WQUxV\nRTsKCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlW10gc3RhdGVzID0g\nbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtleHBzLmxlbmd0aF07CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIHN0YXRlc1tpXSA9IG5ldyBRdWVyeUV4cHJlc3Npb25zU3Rh\ndGUoKTsKICAgICAgICBFeHBDb250ZXh0IGN0eCA9IG5ldyBFeHBDb250ZXh0\nKF9zdG9yZSwgcGFyYW1zLCBmZXRjaCk7CgogICAgICAgIC8vIGFkZCBzZWxl\nY3RzIHdpdGggcG9wdWxhdGUgV0hFUkUgY29uZGl0aW9ucyB0byBsaXN0CiAg\nICAgICAgTGlzdCBzZWxzID0gbmV3IEFycmF5TGlzdChtYXBwaW5ncy5sZW5n\ndGgpOwogICAgICAgIExpc3Qgc2VsTWFwcGluZ3MgPSBuZXcgQXJyYXlMaXN0\nKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgQml0U2V0IHN1YmNsYXNzQml0\ncyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICBCaXRTZXQgbmV4dEJpdHMgPSBu\nZXcgQml0U2V0KCk7CiAgICAgICAgYm9vbGVhbiB1bmlvbmFibGUgPSBjcmVh\ndGVXaGVyZVNlbGVjdHMoc2VscywgbWFwcGluZ3MsIHNlbE1hcHBpbmdzLAog\nICAgICAgICAgICBzdWJjbGFzc2VzLCBzdWJjbGFzc0JpdHMsIG5leHRCaXRz\nLCBmYWN0cywgZXhwcywgc3RhdGVzLCBjdHgsIAogICAgICAgICAgICBzdWJj\nbGFzc01vZGUpICYmIHN1YmNsYXNzTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uLkVBR0VSX0pPSU47CiAgICAgICAgaWYgKHNlbHMuc2l6ZSgpID4g\nMSkKICAgICAgICAgICAgc3RhcnQgPSAwTDsKCiAgICAgICAgaWYgKHVuaW9u\nYWJsZSkgewogICAgICAgICAgICBVbmlvbiB1bmlvbiA9IF9zdG9yZS5nZXRT\nUUxGYWN0b3J5KCkubmV3VW5pb24oCiAgICAgICAgICAgICAgICAoU2VsZWN0\nW10pIHNlbHMudG9BcnJheShuZXcgU2VsZWN0W3NlbHMuc2l6ZSgpXSkpOwog\nICAgICAgICAgICBwb3B1bGF0ZVVuaW9uKHVuaW9uLCBtYXBwaW5ncywgc3Vi\nY2xhc3NlcywgZmFjdHMsIGV4cHMsIHN0YXRlcywgY3R4LAogICAgICAgICAg\nICAgICAgZmFsc2UsIGVhZ2VyLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAg\naWYgKHVuaW9uLmlzVW5pb24oKSkKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgU3RyaW5nW10ge3VuaW9uLnRvU2VsZWN0KGZhbHNlLCBmZXRjaCkuZ2V0\nU1FMKHRydWUpfTsKICAgICAgICAgICAgc2VscyA9IEFycmF5cy5hc0xpc3Qo\ndW5pb24uZ2V0U2VsZWN0cygpKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBTZWxlY3Qgc2VsOwogICAgICAgICAgICBmb3IgKGludCBpID0gMCwg\naWR4ID0gMDsgaSA8IHNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAg\nICAgIHNlbCA9IChTZWxlY3QpIHNlbHMuZ2V0KGkpOwogICAgICAgICAgICAg\nICAgcG9wdWxhdGVTZWxlY3Qoc2VsLCAoQ2xhc3NNYXBwaW5nKSBzZWxNYXBw\naW5ncy5nZXQoaSksCiAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3NCaXRz\nLmdldChpKSwgKEpEQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFjdHNbaWR4XSwK\nICAgICAgICAgICAgICAgICAgICBleHBzW2lkeF0sIHN0YXRlc1tpZHhdLCBj\ndHgsIGZhbHNlLCBlYWdlciwgc3RhcnQsIGVuZCk7CiAgICAgICAgICAgICAg\nICBpZiAobmV4dEJpdHMuZ2V0KGkpKQogICAgICAgICAgICAgICAgICAgIGlk\neCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBTdHJpbmdb\nXSBzcWwgPSBuZXcgU3RyaW5nW3NlbHMuc2l6ZSgpXTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHNlbHMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAg\nIHNxbFtpXSA9ICgoU2VsZWN0KSBzZWxzLmdldChpKSkudG9TZWxlY3QoZmFs\nc2UsIGZldGNoKS5nZXRTUUwodHJ1ZSk7CiAgICAgICAgcmV0dXJuIHNxbDsK\nICAgIH0KfQo=\n","encoding":"base64"}

