{"sha":"db84dbf4da32bb9566b145f4907e5b91801b32d2","node_id":"MDQ6QmxvYjIwNjM2NDpkYjg0ZGJmNGRhMzJiYjk1NjZiMTQ1ZjQ5MDdlNWI5MTgwMWIzMmQy","size":15119,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/db84dbf4da32bb9566b145f4907e5b91801b32d2","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNl\ncHRpb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkJpdFNldDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNxbC5TZWxlY3RFeGVjdXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3NlYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwoK\nLyoqCiAqIE9iamVjdCBwcm92aWRlciBpbXBsZW1lbnRhdGlvbiB0aGF0IGZl\ndGNoZXMgb25lIHBhZ2Ugb2YgcmVzdWx0cyBhdCBhCiAqIGEgdGltZSBhcyBp\ndCBzY3JvbGxzLiBJZiB0aGUge0BsaW5rICNnZXRQYWdlZEZpZWxkc30gbWV0\naG9kIHJldHVybnMgYQogKiBub24tbnVsbCBiaXQgc2V0LCB0aGlzIHRoaXMg\ncHJvdmlkZXIgaXMgYSBnb29kIGZpdCBmb3IgeW91ciBjb25maWd1cmF0aW9u\nLgogKiBUaGUgbWV0aG9kIHRlc3RzIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9u\nczoKICogPHVsPgogKiA8bGk+VGhlIGVhZ2VyIGZldGNoIG1vZGUgaXMgPGNv\nZGU+cGFyYWxsZWw8L2NvZGU+LjwvbGk+CiAqIDxsaT5UaGUgc2VsZWN0J3Mg\ncmVzdWx0IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbGFyZ2UgcmVzdWx0IHNl\ndC48L2xpPgogKiA8bGk+VGhlIG1hcHBpbmcgYmVpbmcgc2VsZWN0ZWQgaGFz\nIGZpZWxkcyB0aGF0IHVzZSBwYXJhbGxlbCBzZWxlY3RzCiAqIHVuZGVyIHRo\nZSBjdXJyZW50IGZldGNoIGNvbmZpZ3VyYXRpb24uPC9saT4KICogPC91bD4K\nICogIFRvIHVzZSB0aGlzIHByb3ZpZGVyLCBzZWxlY3QgdGhlIGNhbmRpZGF0\nZSBtYXBwaW5nIHdpdGggZWFnZXIgZmV0Y2gKICogbW9kZSBzZXQgdG8gPGNv\nZGU+am9pbjwvY29kZT4uIFRoaXMgcHJvdmlkZXIgd2lsbCB0YWtlIGNhcmUg\nb2YgcGVyZm9ybWluZwogKiA8Y29kZT5wYXJhbGxlbDwvY29kZT4gbW9kZSBi\nYXRjaCBzZWxlY3RzIGZvciBlYWNoIHBhZ2UgaXQgcmVhZHMuCiAqCiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFz\ncyBQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcgogICAgZXh0ZW5kcyBTZWxl\nY3RSZXN1bHRPYmplY3RQcm92aWRlciB7CgogICAgcHJpdmF0ZSBmaW5hbCBD\nbGFzc01hcHBpbmdbXSBfbWFwcGluZ3M7CiAgICBwcml2YXRlIGZpbmFsIE9i\namVjdFtdIF9wYWdlOwogICAgcHJpdmF0ZSBmaW5hbCBpbnRbXSBfaWR4czsK\nICAgIHByaXZhdGUgZmluYWwgQml0U2V0W10gX3BhZ2VkOwogICAgcHJpdmF0\nZSBpbnQgX3BvcyA9IC0xOyAvLyBsb2dpY2FsIHBvcwogICAgcHJpdmF0ZSBp\nbnQgX3BhZ2VQb3MgPSAtMTsgLy8gcG9zIG9mIHBhZ2Ugc3RhcnQKCiAgICAv\nKioKICAgICAqIFJldHVybiBhIGJpdCBzZXQgcmVwcmVzZW50aW5nIGJhdGNo\nIHNlbGVjdCBmaWVsZHMgdGhhdCB3aWxsIGJlIHBhZ2VkLAogICAgICogb3Ig\nbnVsbCBpZiBubyBmaWVsZHMgbmVlZCBwYWdpbmcsIHdoaWNoIGluZGljYXRl\ncyB0aGF0IHRoaXMgcHJvdmlkZXIKICAgICAqIHNob3VsZCBub3QgYmUgdXNl\nZC4KICAgICAqCiAgICAgKiBAc2VlICNQYWdpbmdSZXN1bHRPYmplY3RQcm92\naWRlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIEJpdFNldCBnZXRQYWdl\nZEZpZWxkcyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGludCBlYWdlck1vZGUsCiAgICAgICAgbG9uZyBzaXplKSB7CiAg\nICAgICAgLy8gaWYgd2UgaGF2ZSBhIHJhbmdlIHRoZW4gd2UgYWx3YXlzIHVz\nZSBwYWdpbmcgaWYgdGhlcmUgYXJlIGFueQogICAgICAgIC8vIGVhZ2VyIHNl\nbGVjdCBmaWVsZHM7IG90aGVyd2lzZSBpdCBkZXBlbmRzIG9uIGxycyBhbmQg\nZmV0Y2ggc2V0dGluZ3MKICAgICAgICBpZiAoc2l6ZSA9PSBMb25nLk1BWF9W\nQUxVRSB8fCAhc2VsLmdldEF1dG9EaXN0aW5jdCgpKSB7CiAgICAgICAgICAg\nIC8vIG5vdCBscnM/CiAgICAgICAgICAgIGlmICghc2VsLmlzTFJTKCkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgLy8gbm90\nIGNvbmZpZ3VyZWQgZm9yIGxhenkgbG9hZGluZz8KICAgICAgICAgICAgaWYg\nKGZldGNoLmdldEZldGNoQmF0Y2hTaXplKCkgPCAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBub3QgY29u\nZmlndXJlZCBmb3IgZWFnZXIgc2VsZWN0cz8KICAgICAgICBlYWdlck1vZGUg\nPSBNYXRoLm1pbihlYWdlck1vZGUsIGZldGNoLmdldEVhZ2VyRmV0Y2hNb2Rl\nKCkpOwogICAgICAgIGlmIChlYWdlck1vZGUgIT0gZmV0Y2guRUFHRVJfUEFS\nQUxMRUwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBh\ncmUgdGhlcmUgYW55IG1hcHBpbmdzIHRoYXQgcmVxdWlyZSBiYXRjaGVkIHNl\nbGVjdHM/CiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5n\nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgIEJpdFNldCBwYWdl\nZCA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFmZXRjaC5yZXF1aXJlc0Zl\ndGNoKGZtc1tpXSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIGlmIChmbXNbaV0uc3VwcG9ydHNTZWxlY3Qoc2VsLCBzZWwuRUFH\nRVJfUEFSQUxMRUwsIG51bGwsIHN0b3JlLAogICAgICAgICAgICAgICAgZmV0\nY2gpID4gMCAmJiAoZm1zW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSB8fCBm\nbXNbaV0uCiAgICAgICAgICAgICAgICBzdXBwb3J0c1NlbGVjdChzZWwsIHNl\nbC5FQUdFUl9PVVRFUiwgbnVsbCwgc3RvcmUsIGZldGNoKSA9PSAwKSkKICAg\nICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VkID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgcGFnZWQgPSBuZXcgQml0U2V0KCk7CiAg\nICAgICAgICAgICAgICBwYWdlZC5zZXQoZm1zW2ldLmdldEluZGV4KCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYWdlZDsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAgICoKICAg\nICAqIEBwYXJhbSBzZWwgdGhlIHNlbGVjdCB0byBleGVjdXRlCiAgICAgKiBA\ncGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBvZiB0aGUgcmVzdWx0IG9iamVj\ndHMKICAgICAqIEBwYXJhbSBzdG9yZSB0aGUgc3RvcmUgbWFuYWdlciB0byBk\nZWxlZ2F0ZSBsb2FkaW5nIHRvCiAgICAgKiBAcGFyYW0gZmV0Y2ggdGhlIGZl\ndGNoIGNvbmZpZ3VyYXRpb24sIG9yIG51bGwgZm9yIGRlZmF1bHQKICAgICAq\nIEBwYXJhbSBwYWdlZCB0aGUgYml0IHNldCByZXR1cm5lZCBmcm9tIHtAbGlu\nayAjZ2V0UGFnZWRGaWVsZHN9CiAgICAgKiBAcGFyYW0gc2l6ZSB0aGUga25v\nd24gbWF4aW11bSBzaXplIG9mIHRoZSByZXN1bHQsIG9yCiAgICAgKiB7QGxp\nbmsgTG9uZyNNQVhfVkFMVUV9IGZvciBubyBrbm93biBsaW1pdAogICAgICov\nCiAgICBwdWJsaWMgUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIoU2VsZWN0\nRXhlY3V0b3Igc2VsLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBK\nREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nCiAgICAgICAgQml0U2V0IHBhZ2VkLCBsb25nIHNpemUpIHsKICAgICAgICB0\naGlzKHNlbCwgbmV3IENsYXNzTWFwcGluZ1tdeyBtYXBwaW5nIH0sIHN0b3Jl\nLCBmZXRjaCwKICAgICAgICAgICAgbmV3IEJpdFNldFtdeyBwYWdlZCB9LCBz\naXplKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAg\nICoKICAgICAqIEBwYXJhbSBzZWwgdGhlIHNlbGVjdCB0byBleGVjdXRlCiAg\nICAgKiBAcGFyYW0gbWFwcGluZ3MgdGhlIG1hcHBpbmdzIGZvciB0aGUgaW5k\nZXBlbmRlbnQgY2xhc3NlcyBvZiB0aGUKICAgICAqIHJlc3VsdCBvYmplY3Rz\nCiAgICAgKiBAcGFyYW0gc3RvcmUgdGhlIHN0b3JlIG1hbmFnZXIgdG8gZGVs\nZWdhdGUgbG9hZGluZyB0bwogICAgICogQHBhcmFtIGZldGNoIHRoZSBmZXRj\naCBjb25maWd1cmF0aW9uLCBvciBudWxsIGZvciBkZWZhdWx0CiAgICAgKiBA\ncGFyYW0gcGFnZWQgdGhlIGJpdCBzZXRzIHJldHVybmVkIGZyb20ge0BsaW5r\nICNnZXRQYWdlZEZpZWxkc30KICAgICAqIGZvciBlYWNoIHNlbGVjdCBpbiB0\naGUgcG9zc2libGUgdW5pb24KICAgICAqIEBwYXJhbSBzaXplIHRoZSBrbm93\nbiBtYXhpbXVtIHNpemUgb2YgdGhlIHJlc3VsdCwgb3IKICAgICAqIHtAbGlu\nayBMb25nI01BWF9WQUxVRX0gZm9yIG5vIGtub3duIGxpbWl0CiAgICAgKi8K\nICAgIHB1YmxpYyBQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcihTZWxlY3RF\neGVjdXRvciBzZWwsCiAgICAgICAgQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3Ms\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwKICAgICAgICBCaXRTZXRbXSBwYWdlZCwgbG9uZyBzaXplKSB7CiAgICAg\nICAgc3VwZXIoc2VsLCBzdG9yZSwgZmV0Y2gpOwogICAgICAgIF9tYXBwaW5n\ncyA9IG1hcHBpbmdzOwogICAgICAgIF9wYWdlZCA9IHBhZ2VkOwoKICAgICAg\nICAvLyBkb24ndCBsZXQgc3lzdGVtIGNvbnN0cnVjdCB0aGlzIHR5cGUgb2Yg\ncm9wIGZvciBzdHVwaWQgc2l6ZXMKICAgICAgICBpZiAoc2l6ZSA8PSAxKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oInNpemU9\nIiArIHNpemUpOwoKICAgICAgICAvLyB0cnkgdG8gZmluZCBhIGdvb2QgcGFn\nZSBzaXplLiAgaWYgdGhlIGtub3duIHNpemUgPCBiYXRjaCBzaXplLCB1c2UK\nICAgICAgICAvLyBpdC4gIGlmIHRoZSBiYXRjaCBzaXplIGlzIHNldCwgdGhl\nbiB1c2UgdGhhdDsgaWYgaXQncyBzb3J0YSBjbG9zZQogICAgICAgIC8vIHRv\nIHRoZSBzaXplLCB0aGVuIHVzZSB0aGUgc2l6ZSAvIDIgdG8gZ2V0IHR3byBm\ndWxsIHBhZ2VzIHJhdGhlcgogICAgICAgIC8vIHRoYW4gYSBwb3NzaWJsZSBi\naWcgb25lIGFuZCBzbWFsbCBvbmUuICBjYXAgZXZlcnl0aGluZyBhdCA1MC4K\nICAgICAgICBpbnQgYmF0Y2ggPSBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKS5n\nZXRGZXRjaEJhdGNoU2l6ZSgpOwogICAgICAgIGludCBwYWdlU2l6ZTsKICAg\nICAgICBpZiAoc2l6ZSA8PSBiYXRjaCAmJiBzaXplIDw9IDUwKQogICAgICAg\nICAgICBwYWdlU2l6ZSA9IChpbnQpIHNpemU7CiAgICAgICAgZWxzZSBpZiAo\nYmF0Y2ggPiAwICYmIGJhdGNoIDw9IDUwKSB7CiAgICAgICAgICAgIGlmIChz\naXplIDw9IGJhdGNoICogMikgewogICAgICAgICAgICAgICAgaWYgKHNpemUg\nJSAyID09IDApCiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemUgPSAoaW50\nKSAoc2l6ZSAvIDIpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHBhZ2VTaXplID0gKGludCkgKHNpemUgLyAyICsgMSk7CiAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgcGFnZVNpemUgPSBi\nYXRjaDsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPD0gNTApCiAgICAgICAg\nICAgIHBhZ2VTaXplID0gKGludCkgc2l6ZTsKICAgICAgICBlbHNlIGlmIChz\naXplIDw9IDEwMCkgewogICAgICAgICAgICBpZiAoc2l6ZSAlIDIgPT0gMCkK\nICAgICAgICAgICAgICAgIHBhZ2VTaXplID0gKGludCkgKHNpemUgLyAyKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGFnZVNpemUgPSAo\naW50KSAoc2l6ZSAvIDIgKyAxKTsKICAgICAgICB9IGVsc2UKICAgICAgICAg\nICAgcGFnZVNpemUgPSA1MDsKCiAgICAgICAgX3BhZ2UgPSBuZXcgT2JqZWN0\nW3BhZ2VTaXplXTsKICAgICAgICBpZiAoX3BhZ2VkLmxlbmd0aCA+IDEpCiAg\nICAgICAgICAgIF9pZHhzID0gbmV3IGludFtwYWdlU2l6ZV07CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBfaWR4cyA9IG51bGw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHBhZ2Ugc2l6ZSBpbiB1c2UuCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0UGFnZVNpemUoKSB7CiAgICAgICAgcmV0dXJu\nIF9wYWdlLmxlbmd0aDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBvcGVuKCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5v\ncGVuKCk7CiAgICAgICAgX3BvcyA9IC0xOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIG5leHQoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIF9wb3MrKzsKICAgICAgICBpZiAoaW5QYWdlKCkpCiAgICAgICAg\nICAgIHJldHVybiBfcGFnZVtfcG9zIC0gX3BhZ2VQb3NdICE9IG51bGw7CiAg\nICAgICAgaWYgKCFzdXBlci5uZXh0KCkpIHsKICAgICAgICAgICAgc2V0U2l6\nZShfcG9zKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBhYnNvbHV0ZShpbnQgcG9zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIF9wb3MgPSBwb3M7CiAgICAgICAgaWYgKGluUGFnZSgp\nKQogICAgICAgICAgICByZXR1cm4gX3BhZ2VbX3BvcyAtIF9wYWdlUG9zXSAh\nPSBudWxsOwogICAgICAgIHJldHVybiBzdXBlci5hYnNvbHV0ZShwb3MpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0UmVzdWx0T2JqZWN0KCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWluUGFn\nZSgpKQogICAgICAgICAgICBmaWxsUGFnZSgpOwogICAgICAgIHJldHVybiBf\ncGFnZVtfcG9zIC0gX3BhZ2VQb3NdOwogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB3aGV0aGVyIG91ciBjdXJyZW50IHBvc2l0aW9uIGlzIHdpdGhpbiB0\naGUgY2FjaGVkIHBhZ2Ugb2YgcmVzdWx0cy4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGluUGFnZSgpIHsKICAgICAgICByZXR1cm4gX3BhZ2VQb3Mg\nIT0gLTEgJiYgX3BvcyA+PSBfcGFnZVBvcwogICAgICAgICAgICAmJiBfcG9z\nIDwgX3BhZ2VQb3MgKyBfcGFnZS5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTdGFydCBhIG5ldyBwYWdlIGF0IHRoZSBwcmVzZW50IHBvc2l0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmlsbFBhZ2UoKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGNsZWFyIHBhZ2UK\nICAgICAgICBBcnJheXMuZmlsbChfcGFnZSwgbnVsbCk7CgogICAgICAgIC8v\nIGNhY2hlIHJlc3VsdCBvYmplY3RzCiAgICAgICAgSkRCQ1N0b3JlTWFuYWdl\nciBzdG9yZU1nciA9IChKREJDU3RvcmVNYW5hZ2VyKSBnZXRTdG9yZSgpOwog\nICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nOwogICAgICAgIFJlc3VsdCBy\nZXM7CiAgICAgICAgaW50IGlkeDsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IF9wYWdlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcyA9IGdl\ndFJlc3VsdCgpOwogICAgICAgICAgICBpZHggPSByZXMuaW5kZXhPZigpOwog\nICAgICAgICAgICBpZiAoX2lkeHMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9pZHhzW2ldID0gaWR4OwogICAgICAgICAgICBtYXBwaW5nID0gcmVzLmdl\ndEJhc2VNYXBwaW5nKCk7CiAgICAgICAgICAgIGlmIChtYXBwaW5nID09IG51\nbGwpCiAgICAgICAgICAgICAgICBtYXBwaW5nID0gX21hcHBpbmdzW2lkeF07\nCgogICAgICAgICAgICAvLyByYXRoZXIgdGhhbiB1c2UgdGhlIHN0YW5kYXJk\nIHJlc3VsdC5sb2FkKCksIHdlIGdvIGRpcmVjdCB0bwogICAgICAgICAgICAv\nLyB0aGUgc3RvcmUgbWFuYWdlciBzbyB3ZSBjYW4gcGFzcyBpbiBvdXIgZWFn\nZXItZmV0Y2hlZCBmaWVsZHMgYXMKICAgICAgICAgICAgLy8gZmllbGRzIHRv\nIGV4Y2x1ZGUgZnJvbSB0aGUgaW5pdGlhbCBsb2FkIG9mIHRoZSBvYmplY3Rz\nCiAgICAgICAgICAgIF9wYWdlW2ldID0gc3RvcmVNZ3IubG9hZChtYXBwaW5n\nLCBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIF9w\nYWdlZFtpZHhdLCByZXMpOwogICAgICAgICAgICBpZiAoaSAhPSBfcGFnZS5s\nZW5ndGggLSAxICYmICFnZXRSZXN1bHQoKS5uZXh0KCkpIHsKICAgICAgICAg\nICAgICAgIHNldFNpemUoX3BvcyArIGkgKyAxKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBs\nb2FkIGRhdGEgZm9yIGVhZ2VyIGZpZWxkcwogICAgICAgIF9wYWdlUG9zID0g\nX3BvczsKICAgICAgICBpZiAoX3BhZ2VbMF0gIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX3BhZ2UubGVuZ3RoID4gMSAmJiBfcGFnZVsxXSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgbG9hZEVhZ2VyRmllbGRzKCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGV4ZWN1dGVFYWdlclNlbGVjdHMo\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVuIHRoZXJl\nIGlzIG9ubHkgb25lIGluc3RhbmNlIGluIGEgcGFnZSwgbG9hZCBmaWVsZHMg\nYXMgbm9ybWFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbG9hZEVhZ2Vy\nRmllbGRzKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpbnQgaWR4ID0gKF9pZHhzID09IG51bGwpID8gMCA6IF9pZHhzWzBdOwog\nICAgICAgIGlmIChfcGFnZWRbaWR4XSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIEpEQkNTdG9yZSBzdG9yZSA9IGdldFN0b3JlKCk7\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IHN0b3JlLmdldENv\nbnRleHQoKS5nZXRTdGF0ZU1hbmFnZXIoX3BhZ2VbMF0pOwogICAgICAgIGZv\nciAoaW50IGkgPSAwLCBsZW4gPSBfcGFnZWRbaWR4XS5sZW5ndGgoKTsgaSA8\nIGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfcGFnZWRbaWR4XS5nZXQo\naSkpIHsKICAgICAgICAgICAgICAgIF9tYXBwaW5nc1tpZHhdLmdldEZpZWxk\nTWFwcGluZyhpKS5sb2FkKHNtLCBzdG9yZSwKICAgICAgICAgICAgICAgICAg\nICBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIGVhZ2VyIGJhdGNo\nIHNlbGVjdHMgZm9yIGN1cnJlbnQgcGFnZSBvZiByZXN1bHRzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgZXhlY3V0ZUVhZ2VyU2VsZWN0cygpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9pZHhzID09\nIG51bGwpIHsKICAgICAgICAgICAgZXhlY3V0ZUVhZ2VyU2VsZWN0cyhfbWFw\ncGluZ3NbMF0sIF9wYWdlZFswXSwgMCwgX3BhZ2UubGVuZ3RoKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaW50IHN0YXJ0ID0g\nMDsKICAgICAgICBpbnQgaWR4ID0gX2lkeHNbMF07CiAgICAgICAgaW50IHBv\ncyA9IDA7CiAgICAgICAgZm9yICg7IHBvcyA8IF9wYWdlLmxlbmd0aCAmJiBf\ncGFnZVtwb3NdICE9IG51bGw7IHBvcysrKSB7CiAgICAgICAgICAgIGlmIChp\nZHggIT0gX2lkeHNbcG9zXSkgewogICAgICAgICAgICAgICAgaWYgKF9wYWdl\nZFtpZHhdICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZUVh\nZ2VyU2VsZWN0cyhfbWFwcGluZ3NbaWR4XSwgX3BhZ2VkW2lkeF0sIHN0YXJ0\nLAogICAgICAgICAgICAgICAgICAgICAgICBwb3MpOwogICAgICAgICAgICAg\nICAgc3RhcnQgPSBwb3M7CiAgICAgICAgICAgICAgICBpZHggPSBfaWR4c1tw\nb3NdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGFy\ndCA8IHBvcyAmJiBfcGFnZWRbaWR4XSAhPSBudWxsKSAvLyBjbGVhbnVwIHJl\nbWFpbmRlcgogICAgICAgICAgICBleGVjdXRlRWFnZXJTZWxlY3RzKF9tYXBw\naW5nc1tpZHhdLCBfcGFnZWRbaWR4XSwgc3RhcnQsIHBvcyk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBMb2FkIGVhZ2VyIGJhdGNoIHNlbGVjdHMgZm9yIHRo\nZSBnaXZlbiBtYXBwaW5nIGFuZCBpdHMgc3VwZXJjbGFzc2VzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgZXhlY3V0ZUVhZ2VyU2VsZWN0cyhDbGFzc01h\ncHBpbmcgbWFwcGluZywgQml0U2V0IHBhZ2VkLAogICAgICAgIGludCBzdGFy\ndCwgaW50IGVuZCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBiYXNlIGNhc2UKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHJlY3Vyc2Ugb24g\nc3VwZXJjbGFzcwogICAgICAgIGV4ZWN1dGVFYWdlclNlbGVjdHMobWFwcGlu\nZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSwgcGFnZWQsCiAg\nICAgICAgICAgIHN0YXJ0LCBlbmQpOwoKICAgICAgICAvLyBmaWd1cmUgb3V0\nIGhvdyBtYW55IGJhdGNoIHNlbGVjdHMgdG8gZG8gb24gdGhpcyBtYXBwaW5n\nCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXREZWZp\nbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgIGludCBzZWxzID0gMDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKHBhZ2VkLmdldChmbXNbaV0uZ2V0SW5kZXgoKSkpCiAg\nICAgICAgICAgICAgICBzZWxzKys7CiAgICAgICAgaWYgKHNlbHMgPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBjcmVhdGUgd2hlcmUg\nY29uZGl0aW9uIGxpbWl0aW5nIGluc3RhbmNlcyB0byB0aGlzIHBhZ2UKICAg\nICAgICBKREJDU3RvcmUgc3RvcmUgPSBnZXRTdG9yZSgpOwogICAgICAgIFNl\nbGVjdCBzZWwgPSBzdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7\nCiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoc3RvcmUu\nZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAgIENvbHVtbltdIHBrcyA9IG1h\ncHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBpZiAocGtz\nLmxlbmd0aCA9PSAxKQogICAgICAgICAgICBpbkNvbnRhaW5zKHNlbCwgYnVm\nLCBtYXBwaW5nLCBwa3MsIHN0YXJ0LCBlbmQpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgb3JDb250YWlucyhzZWwsIGJ1ZiwgbWFwcGluZywgcGtzLCBz\ndGFydCwgZW5kKTsKICAgICAgICBzZWwud2hlcmUoYnVmKTsKCiAgICAgICAg\nU3RvcmVDb250ZXh0IGN0eCA9IHN0b3JlLmdldENvbnRleHQoKTsKICAgICAg\nICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0gZ2V0RmV0Y2hDb25m\naWd1cmF0aW9uKCk7CiAgICAgICAgLy8gZG8gZWFjaCBiYXRjaCBzZWxlY3QK\nICAgICAgICBPYmplY3QgcmVzOwogICAgICAgIGludCBlc2VscyA9IDA7CiAg\nICAgICAgU2VsZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQgdW5pb25z\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmICghcGFnZWQuZ2V0KGZtc1tpXS5nZXRJbmRl\neCgpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\ndW5pb25zID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwgU2VsZWN0LkVB\nR0VSX1BBUkFMTEVMLCBudWxsLAogICAgICAgICAgICAgICAgc3RvcmUsIGZl\ndGNoKTsKICAgICAgICAgICAgaWYgKHVuaW9ucyA9PSAwKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyB3ZSBkb24ndCBuZWVk\nIHRvIGNsb25lIGlmIHRoaXMgaXMgdGhlIGxhc3Qgc2VsZWN0CiAgICAgICAg\nICAgIGVzZWxzKys7CiAgICAgICAgICAgIGlmIChlc2VscyA8IHNlbHMgfHwg\ndW5pb25zID4gMSkKICAgICAgICAgICAgICAgIGVzZWwgPSBzZWwud2hlcmVD\nbG9uZSh1bmlvbnMpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBlc2VsID0gc2VsOwoKICAgICAgICAgICAgLy8gZ2V0IHJlc3VsdAogICAg\nICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJhbGxlbChlc2VsLCBudWxs\nLCBzdG9yZSwgZmV0Y2gsCiAgICAgICAgICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVMKTsKICAgICAgICAgICAgcmVzID0g\nZXNlbC5leGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAvLyBhbmQgbG9hZCByZXN1bHQgaW50byBwYWdl\nZCBpbnN0YW5jZXMKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSBzdGFy\ndDsgaiA8IGVuZCAmJiBfcGFnZVtqXSAhPSBudWxsOyBqKyspCiAgICAgICAg\nICAgICAgICAgICAgcmVzID0gZm1zW2ldLmxvYWRFYWdlclBhcmFsbGVsKGN0\neC5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgICAgICAgICAgICAgKF9w\nYWdlW2pdKSwgc3RvcmUsIGZldGNoLCByZXMpOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgaWYgKHJlcyBpbnN0YW5jZW9mIENs\nb3NlYWJsZSkKICAgICAgICAgICAgICAgICAgICB0cnkgeyAoKENsb3NlYWJs\nZSkgcmVzKS5jbG9zZSgpOyB9IGNhdGNoIChFeGNlcHRpb24gZSkge30KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhbiBJTiBjbGF1c2UgbGltaXRpbmcgdGhlIHJlc3VsdHMgdG8gdGhl\nIGN1cnJlbnQgcGFnZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGluQ29u\ndGFpbnMoU2VsZWN0IHNlbCwgU1FMQnVmZmVyIGJ1ZiwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsCiAgICAgICAgQ29sdW1uW10gcGtzLCBpbnQgc3RhcnQsIGlu\ndCBlbmQpIHsKICAgICAgICBidWYuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlh\ncyhwa3NbMF0pKS5hcHBlbmQoIiBJTiAoIik7CiAgICAgICAgZm9yIChpbnQg\naSA9IHN0YXJ0OyBpIDwgZW5kICYmIF9wYWdlW2ldICE9IG51bGw7IGkrKykg\newogICAgICAgICAgICBpZiAoaSA+IHN0YXJ0KQogICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVl\nKG1hcHBpbmcudG9EYXRhU3RvcmVWYWx1ZShfcGFnZVtpXSwgcGtzLAogICAg\nICAgICAgICAgICAgZ2V0U3RvcmUoKSksIHBrc1swXSk7CiAgICAgICAgfQog\nICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBPUiBjb25kaXRpb25zIGxpbWl0aW5nIHRoZSByZXN1bHRzIHRv\nIHRoZSBjdXJlbnQgcGFnZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG9y\nQ29udGFpbnMoU2VsZWN0IHNlbCwgU1FMQnVmZmVyIGJ1ZiwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsCiAgICAgICAgQ29sdW1uW10gcGtzLCBpbnQgc3RhcnQs\nIGludCBlbmQpIHsKICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0gbmV3IFN0\ncmluZ1twa3MubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHBrcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgYWxpYXNlc1tpXSA9IHNl\nbC5nZXRDb2x1bW5BbGlhcyhwa3NbaV0pOwoKICAgICAgICBPYmplY3RbXSB2\nYWxzOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gc3RhcnQ7IGkgPCBlbmQgJiYgX3BhZ2VbaV0gIT0gbnVsbDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChpID4gc3RhcnQpCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIgT1IgIik7CgogICAgICAgICAgICB2YWxzID0gKE9i\namVjdFtdKSBtYXBwaW5nLnRvRGF0YVN0b3JlVmFsdWUoX3BhZ2VbaV0sIHBr\ncywKICAgICAgICAgICAgICAgIGdldFN0b3JlKCkpOwogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIoIik7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBq\nIDwgdmFscy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKGog\nPiAwKQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGFsaWFzZXNbal0pOwogICAg\nICAgICAgICAgICAgaWYgKHZhbHNbal0gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFsc1tqXSwgcGtzW2pd\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKCIpIik7\nCiAgICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KfQo=\n","encoding":"base64"}

