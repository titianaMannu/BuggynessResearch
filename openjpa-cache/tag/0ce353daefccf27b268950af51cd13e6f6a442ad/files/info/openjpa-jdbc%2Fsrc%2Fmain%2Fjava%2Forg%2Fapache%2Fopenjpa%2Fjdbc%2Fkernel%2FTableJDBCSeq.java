{"sha":"6af4a9f488d69e0b61e12fecae54e91268137cdd","node_id":"MDQ6QmxvYjIwNjM2NDo2YWY0YTlmNDg4ZDY5ZTBiNjFlMTJmZWNhZTU0ZTkxMjY4MTM3Y2Rk","size":21663,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6af4a9f488d69e0b61e12fecae54e91268137cdd","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBqYXZhLnNxbC5Db25uZWN0\naW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9y\ndCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNl\ncHRpb247CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJh\ndGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TY2hlbWE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hVG9vbDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmFi\nbGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5D\nb25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRT\ndGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBv\ncnQgc2VycC51dGlsLlN0cmluZ3M7CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gTk9U\nRTogRG8gbm90IGNoYW5nZSBwcm9wZXJ0eSBuYW1lczsgc2VlIFNlcXVlbmNl\nTWV0YURhdGEKLy8gYW5kIFNlcXVlbmNlTWFwcGluZyBmb3Igc3RhbmRhcmQg\ncHJvcGVydHkgbmFtZXMuCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLyoqCiAqIHtAbGlu\nayBKREJDU2VxfSBpbXBsZW1lbnRhdGlvbiB0aGF0IHVzZXMgYSBkYXRhYmFz\nZSB0YWJsZQogKiBmb3Igc2VxdWVuY2UgbnVtYmVyIGdlbmVyYXRpb24uIFRo\naXMgYmFzZSBpbXBsZW1lbnRhdGlvbiB1c2VzIGEgc2luZ2xlCiAqIHJvdyBm\nb3IgYSBnbG9iYWwgc2VxdWVuY2UgbnVtYmVyLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFRhYmxlSkRCQ1NlcQogICAgZXh0\nZW5kcyBBYnN0cmFjdEpEQkNTZXEKICAgIGltcGxlbWVudHMgQ29uZmlndXJh\nYmxlIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nRFJPUCA9ICJkcm9wIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5n\nIEFDVElPTl9BREQgPSAiYWRkIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIEFDVElPTl9HRVQgPSAiZ2V0IjsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgU3RyaW5nIEFDVElPTl9TRVQgPSAic2V0IjsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQ\nYWNrYWdlCiAgICAgICAgKFRhYmxlSkRCQ1NlcS5jbGFzcyk7CgogICAgcHJp\ndmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CiAgICBwcml2\nYXRlIExvZyBfbG9nID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9hbGxvYyA9\nIDUwOwogICAgcHJpdmF0ZSBmaW5hbCBTdGF0dXMgX3N0YXQgPSBuZXcgU3Rh\ndHVzKCk7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3RhYmxlID0gIk9QRU5KUEFf\nU0VRVUVOQ0VfVEFCTEUiOwogICAgcHJpdmF0ZSBTdHJpbmcgX3NlcUNvbHVt\nbk5hbWUgPSAiU0VRVUVOQ0VfVkFMVUUiOwogICAgcHJpdmF0ZSBTdHJpbmcg\nX3BrQ29sdW1uTmFtZSA9ICJJRCI7CgogICAgcHJpdmF0ZSBDb2x1bW4gX3Nl\ncUNvbHVtbiA9IG51bGw7CiAgICBwcml2YXRlIENvbHVtbiBfcGtDb2x1bW4g\nPSBudWxsOwoKICAgIC8qKgogICAgICogVGhlIHNlcXVlbmNlIHRhYmxlIG5h\nbWUuIERlZmF1bHRzIHRvIDxjb2RlPk9QRU5KUEFfU0VRVUVOQ0VfVEFCTEU8\nL2NvZGU+LgogICAgICogQnkgZGVmYXVsdCwgdGhlIHRhYmxlIHdpbGwgYmUg\ncGxhY2VkIGluIHRoZSBmaXJzdCBzY2hlbWEgbGlzdGVkIGluIHlvdXIKICAg\nICAqIDxjb2RlPm9wZW5qcGEuamRiYy5TY2hlbWFzPC9jb2RlPiBwcm9wZXJ0\neSwgb3IgaW4gdGhlIGRlZmF1bHQgc2NoZW1hIGlmCiAgICAgKiB0aGUgcHJv\ncGVydHkgaXMgbm90IGdpdmVuLiBJZiB5b3Ugc3BlY2lmeSBhIHRhYmxlIG5h\nbWUgaW4gdGhlIGZvcm0KICAgICAqIDxjb2RlPiZsdDtzY2hlbWEmZ3Q7LiZs\ndDt0YWJsZSZndDs8L2NvZGU+LCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEKICAg\nICAqIHdpbGwgYmUgdXNlZC4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRUYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3RhYmxlOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHNlcXVlbmNlIHRhYmxlIG5hbWUuIERlZmF1bHRz\nIHRvIDxjb2RlPk9QRU5KUEFfU0VRVUVOQ0VfVEFCTEU8L2NvZGU+LgogICAg\nICogQnkgZGVmYXVsdCwgdGhlIHRhYmxlIHdpbGwgYmUgcGxhY2VkIGluIHRo\nZSBmaXJzdCBzY2hlbWEgbGlzdGVkIGluIHlvdXIKICAgICAqIDxjb2RlPm9w\nZW5qcGEuamRiYy5TY2hlbWFzPC9jb2RlPiBwcm9wZXJ0eSwgb3IgaW4gdGhl\nIGRlZmF1bHQgc2NoZW1hIGlmCiAgICAgKiB0aGUgcHJvcGVydHkgaXMgbm90\nIGdpdmVuLiBJZiB5b3Ugc3BlY2lmeSBhIHRhYmxlIG5hbWUgaW4gdGhlIGZv\ncm0KICAgICAqIDxjb2RlPiZsdDtzY2hlbWEmZ3Q7LiZsdDt0YWJsZSZndDs8\nL2NvZGU+LCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEKICAgICAqIHdpbGwgYmUg\ndXNlZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGFibGUoU3RyaW5n\nIG5hbWUpIHsKICAgICAgICBfdGFibGUgPSBuYW1lOwogICAgfQoKICAgIC8q\nKgogICAgICogQGRlcHJlY2F0ZWQgVXNlIHtAbGluayAjc2V0VGFibGV9LiBS\nZXRhaW5lZCBmb3IKICAgICAqIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5CXdp\ndGggYXV0by1jb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRUYWJsZU5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBzZXRUYWJs\nZShuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRo\nZSBjb2x1bW4gdGhhdCBob2xkcyB0aGUgc2VxdWVuY2UgdmFsdWUuIERlZmF1\nbHRzCiAgICAgKiB0byA8Y29kZT5TRVFVRU5DRV9WQUxVRTwvY29kZT4uCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U2VxdWVuY2VDb2x1bW4oKSB7\nCiAgICAgICAgcmV0dXJuIF9zZXFDb2x1bW5OYW1lOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG5hbWUgb2YgdGhlIGNvbHVtbiB0aGF0IGhvbGRzIHRo\nZSBzZXF1ZW5jZSB2YWx1ZS4gRGVmYXVsdHMKICAgICAqIHRvIDxjb2RlPlNF\nUVVFTkNFX1ZBTFVFPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0U2VxdWVuY2VDb2x1bW4oU3RyaW5nIHNlcXVlbmNlQ29sdW1uKSB7CiAg\nICAgICAgX3NlcUNvbHVtbk5hbWUgPSBzZXF1ZW5jZUNvbHVtbjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSB0YWJsZSdzIHByaW1h\ncnkga2V5IGNvbHVtbi4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPklEPC9j\nb2RlPi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRQcmltYXJ5S2V5\nQ29sdW1uKCkgewogICAgICAgIHJldHVybiBfcGtDb2x1bW5OYW1lOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIG5hbWUgb2YgdGhlIHRhYmxlJ3MgcHJp\nbWFyeSBrZXkgY29sdW1uLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+SUQ8\nL2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmltYXJ5S2V5\nQ29sdW1uKFN0cmluZyBwcmltYXJ5S2V5Q29sdW1uKSB7CiAgICAgICAgX3Br\nQ29sdW1uTmFtZSA9IHByaW1hcnlLZXlDb2x1bW47CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBzZXF1ZW5jZXMgdG8gYWxs\nb2NhdGUgZm9yIGVhY2ggdXBkYXRlIG9mIHRoZQogICAgICogc2VxdWVuY2Ug\ndGFibGUuIFNlcXVlbmNlIG51bWJlcnMgd2lsbCBiZSBncmFiYmVkIGluIGJs\nb2NrcyBvZiB0aGlzCiAgICAgKiB2YWx1ZSB0byByZWR1Y2UgdGhlIG51bWJl\nciBvZiB0cmFuc2FjdGlvbnMgdGhhdCBtdXN0IGJlIHBlcmZvcm1lZCBvbgog\nICAgICogdGhlIHNlcXVlbmNlIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldEFsbG9jYXRlKCkgewogICAgICAgIHJldHVybiBfYWxsb2M7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBzZXF1\nZW5jZXMgdG8gYWxsb2NhdGUgZm9yIGVhY2ggdXBkYXRlIG9mIHRoZQogICAg\nICogc2VxdWVuY2UgdGFibGUuIFNlcXVlbmNlIG51bWJlcnMgd2lsbCBiZSBn\ncmFiYmVkIGluIGJsb2NrcyBvZiB0aGlzCiAgICAgKiB2YWx1ZSB0byByZWR1\nY2UgdGhlIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgdGhhdCBtdXN0IGJlIHBl\ncmZvcm1lZCBvbgogICAgICogdGhlIHNlcXVlbmNlIHRhYmxlLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRBbGxvY2F0ZShpbnQgYWxsb2MpIHsKICAg\nICAgICBfYWxsb2MgPSBhbGxvYzsKICAgIH0KCiAgICAvKioKICAgICAqIEBk\nZXByZWNhdGVkIFVzZSB7QGxpbmsgI3NldEFsbG9jYXRlfS4gUmV0YWluZWQg\nZm9yIGJhY2t3YXJkcwogICAgICogY29tcGF0aWJpbGl0eSBvZiBhdXRvLWNv\nbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEluY3Jl\nbWVudChpbnQgaW5jKSB7CiAgICAgICAgc2V0QWxsb2NhdGUoaW5jKTsKICAg\nIH0KCiAgICBwdWJsaWMgSkRCQ0NvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJh\ndGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBfY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgY29uZjsK\nICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9u\nLkxPR19SVU5USU1FKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENv\nbmZpZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29u\nZmlndXJhdGlvbigpIHsKICAgICAgICBidWlsZFRhYmxlKCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYWRkU2NoZW1hKENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBTY2hlbWFHcm91cCBncm91cCkgewogICAgICAgIC8vIHRhYmxlIGFscmVh\nZHkgZXhpc3RzPwogICAgICAgIGlmIChncm91cC5pc0tub3duVGFibGUoX3Rh\nYmxlKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJpbmcgc2No\nZW1hTmFtZSA9IFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoX3RhYmxlKTsKICAg\nICAgICBpZiAoc2NoZW1hTmFtZS5sZW5ndGgoKSA9PSAwKQogICAgICAgICAg\nICBzY2hlbWFOYW1lID0gU2NoZW1hcy5nZXROZXdUYWJsZVNjaGVtYShfY29u\nZik7CgogICAgICAgIC8vIGNyZWF0ZSB0YWJsZSBpbiB0aGlzIGdyb3VwCiAg\nICAgICAgU2NoZW1hIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFO\nYW1lKTsKICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAgICAgICAg\nIHNjaGVtYSA9IGdyb3VwLmFkZFNjaGVtYShzY2hlbWFOYW1lKTsKICAgICAg\nICBzY2hlbWEuaW1wb3J0VGFibGUoX3BrQ29sdW1uLmdldFRhYmxlKCkpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBPYmplY3QgbmV4dEludGVybmFsKEpEQkNT\ndG9yZSBzdG9yZSwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcpCiAgICAgICAgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgbmVlZGVkLCBncmFiIHRo\nZSBuZXh0IGhhbmRmdWwgb2YgaWRzCiAgICAgICAgU3RhdHVzIHN0YXQgPSBn\nZXRTdGF0dXMobWFwcGluZyk7CiAgICAgICAgaWYgKHN0YXQgPT0gbnVsbCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLXNlcS10eXBlIiwKICAgICAgICAgICAgICAgIGdldENs\nYXNzKCksIG1hcHBpbmcpKTsKCiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkIChzdGF0KSB7CiAgICAgICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgc2VxIGlzIGF0IGxlYXN0IDEsIHNpbmNlIGF1dG9h\nc3NpZ25lZCBpZHMgb2YgMCBjYW4KICAgICAgICAgICAgICAgIC8vIGNvbmZs\naWN0IHdpdGggdW5pbml0aWFsaXplZCB2YWx1ZXMKICAgICAgICAgICAgICAg\nIHN0YXQuc2VxID0gTWF0aC5tYXgoc3RhdC5zZXEsIDEpOwogICAgICAgICAg\nICAgICAgaWYgKHN0YXQuc2VxIDwgc3RhdC5tYXgpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihzdGF0LnNlcSsrKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBhbGxvY2F0ZVNlcXVlbmNlKHN0b3Jl\nLCBtYXBwaW5nLCBzdGF0LCBfYWxsb2MsIHRydWUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGN1cnJlbnRJbnRlcm5hbChKREJD\nU3RvcmUgc3RvcmUsIENsYXNzTWFwcGluZyBtYXBwaW5nKQogICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIGlmIChjdXJyZW50ID09IG51bGwp\nIHsKICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gZ2V0Q29ubmVjdGlv\nbihzdG9yZSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBs\nb25nIGN1ciA9IGdldFNlcXVlbmNlKG1hcHBpbmcsIGNvbm4pOwogICAgICAg\nICAgICAgICAgaWYgKGN1ciAhPSAtMSkKICAgICAgICAgICAgICAgICAgICBj\ndXJyZW50ID0gTnVtYmVycy52YWx1ZU9mKGN1cik7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBjbG9zZUNvbm5lY3Rpb24oY29u\nbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1\ncGVyLmN1cnJlbnRJbnRlcm5hbChzdG9yZSwgbWFwcGluZyk7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIHZvaWQgYWxsb2NhdGVJbnRlcm5hbChpbnQgY291bnQs\nIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGlu\nZykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdGF0\ndXMgc3RhdCA9IGdldFN0YXR1cyhtYXBwaW5nKTsKICAgICAgICBpZiAoc3Rh\ndCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHdoaWxl\nICh0cnVlKSB7CiAgICAgICAgICAgIGludCBhdmFpbGFibGU7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoc3RhdCkgewogICAgICAgICAgICAgICAgYXZh\naWxhYmxlID0gKGludCkgKHN0YXQubWF4IC0gc3RhdC5zZXEpOwogICAgICAg\nICAgICAgICAgaWYgKGF2YWlsYWJsZSA+PSBjb3VudCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxs\nb2NhdGVTZXF1ZW5jZShzdG9yZSwgbWFwcGluZywgc3RhdCwgY291bnQgLSBh\ndmFpbGFibGUsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGFwcHJvcHJpYXRlIHN0YXR1cyBvYmplY3QgZm9y\nIHRoZSBnaXZlbiBjbGFzcywgb3IgbnVsbAogICAgICogaWYgY2Fubm90IGhh\nbmRsZSB0aGUgZ2l2ZW4gY2xhc3MuIFRoZSBtYXBwaW5nIG1heSBiZSBudWxs\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdHVzIGdldFN0YXR1cyhDbGFz\nc01hcHBpbmcgbWFwcGluZykgewogICAgICAgIHJldHVybiBfc3RhdDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgcHJpbWFyeSBrZXkgY29sdW1u\nIHRvIHRoZSBnaXZlbiB0YWJsZSBhbmQgcmV0dXJuIGl0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ29sdW1uIGFkZFByaW1hcnlLZXlDb2x1bW4oVGFibGUg\ndGFibGUpIHsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25mLmdl\ndERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgQ29sdW1uIHBrQ29s\ndW1uID0gdGFibGUuYWRkQ29sdW1uKGRpY3QuZ2V0VmFsaWRDb2x1bW5OYW1l\nCiAgICAgICAgICAgIChnZXRQcmltYXJ5S2V5Q29sdW1uKCksIHRhYmxlKSk7\nCiAgICAgICAgcGtDb2x1bW4uc2V0VHlwZShkaWN0LmdldFByZWZlcnJlZFR5\ncGUoVHlwZXMuVElOWUlOVCkpOwogICAgICAgIHBrQ29sdW1uLnNldEphdmFU\neXBlKEphdmFUeXBlcy5JTlQpOwogICAgICAgIHJldHVybiBwa0NvbHVtbjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJpbWFyeSBrZXkg\ndmFsdWUgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE9iamVjdCBnZXRQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5n\nKSB7CiAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZigwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIG9iamVjdC1sZXZlbCByZXBy\nZXNlbnRhdGlvbiBvZiB0aGUgc2VxdWVuY2UgdGFibGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBidWlsZFRhYmxlKCkgewogICAgICAgIFN0cmluZyB0\nYWJsZU5hbWUgPSBTdHJpbmdzLmdldENsYXNzTmFtZShfdGFibGUpOwogICAg\nICAgIFN0cmluZyBzY2hlbWFOYW1lID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFt\nZShfdGFibGUpOwogICAgICAgIGlmIChzY2hlbWFOYW1lLmxlbmd0aCgpID09\nIDApCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBTY2hlbWFzLmdldE5ld1Rh\nYmxlU2NoZW1hKF9jb25mKTsKCiAgICAgICAgU2NoZW1hR3JvdXAgZ3JvdXAg\nPSBuZXcgU2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWEgc2NoZW1hID0g\nZ3JvdXAuYWRkU2NoZW1hKHNjaGVtYU5hbWUpOwoKICAgICAgICBUYWJsZSB0\nYWJsZSA9IHNjaGVtYS5hZGRUYWJsZSh0YWJsZU5hbWUpOwogICAgICAgIF9w\na0NvbHVtbiA9IGFkZFByaW1hcnlLZXlDb2x1bW4odGFibGUpOwogICAgICAg\nIFByaW1hcnlLZXkgcGsgPSB0YWJsZS5hZGRQcmltYXJ5S2V5KCk7CiAgICAg\nICAgcGsuYWRkQ29sdW1uKF9wa0NvbHVtbik7CgogICAgICAgIERCRGljdGlv\nbmFyeSBkaWN0ID0gX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsK\nICAgICAgICBfc2VxQ29sdW1uID0gdGFibGUuYWRkQ29sdW1uKGRpY3QuZ2V0\nVmFsaWRDb2x1bW5OYW1lCiAgICAgICAgICAgIChfc2VxQ29sdW1uTmFtZSwg\ndGFibGUpKTsKICAgICAgICBfc2VxQ29sdW1uLnNldFR5cGUoZGljdC5nZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLkJJR0lOVCkpOwogICAgICAgIF9zZXFDb2x1\nbW4uc2V0SmF2YVR5cGUoSmF2YVR5cGVzLkxPTkcpOwogICAgfQoKICAgIC8q\nKgogICAgICogVXBkYXRlcyB0aGUgbWF4IGF2YWlsYWJsZSBzZXF1ZW5jZSB2\nYWx1ZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFsbG9jYXRlU2VxdWVu\nY2UoSkRCQ1N0b3JlIHN0b3JlLCBDbGFzc01hcHBpbmcgbWFwcGluZywKICAg\nICAgICBTdGF0dXMgc3RhdCwgaW50IGFsbG9jLCBib29sZWFuIHVwZGF0ZVN0\nYXRTZXEpIAogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIENvbm5lY3Rpb24gY29ubiA9IGdldENvbm5lY3Rpb24oc3RvcmUpOwogICAg\nICAgIHRyeSB7IAogICAgICAgICAgICBpZiAoc2V0U2VxdWVuY2UobWFwcGlu\nZywgc3RhdCwgYWxsb2MsIHVwZGF0ZVN0YXRTZXEsIGNvbm4pKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0\nb3JlKF9sb2MuZ2V0KCJiYWQtc2VxLXVwIiwgX3RhYmxlKSwKICAgICAgICAg\nICAgICAgIHNlLCBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjbG9zZUNvbm5lY3Rp\nb24oY29ubik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIHBvc3NpYmxlIHRoYXQgd2UgbWlnaHQgZ2V0IGVycm9y\ncyB3aGVuIGluc2VydGluZyBpZgogICAgICAgICAgICAvLyBhbm90aGVyIHRo\ncmVhZC9wcm9jZXNzIGlzIGluc2VydGluZyBzYW1lIHBrIGF0IHNhbWUgdGlt\nZQogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsKICAgICAg\nICAgICAgY29ubiA9IF9jb25mLmdldERhdGFTb3VyY2UyKHN0b3JlLmdldENv\nbnRleHQoKSkuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaW5zZXJ0U2VxdWVuY2UobWFwcGluZywgY29ubik7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICAgICAgZXJyID0gc2U7CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlKCk7IH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gbm93IHdlIHNob3VsZCBiZSBhYmxlIHRvIHVwZGF0ZS4uLgogICAg\nICAgICAgICBjb25uID0gZ2V0Q29ubmVjdGlvbihzdG9yZSk7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoIXNldFNlcXVlbmNlKG1h\ncHBpbmcsIHN0YXQsIGFsbG9jLCB1cGRhdGVTdGF0U2VxLCBjb25uKSkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyAoZXJyICE9IG51bGwpID8gZXJyIDog\nbmV3IFNRTEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICAgICAoIm5vLXNlcS1yb3ciLCBtYXBwaW5nLCBfdGFibGUpLmdldE1lc3Nh\nZ2UoKSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICBjbG9zZUNvbm5lY3Rpb24oY29ubik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UyKSB7CiAgICAgICAgICAgIHRo\ncm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoX2xvYy5nZXQoImJhZC1zZXEt\ndXAiLCBfdGFibGUpLAogICAgICAgICAgICAgICAgc2UyLCBfY29uZi5nZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpKTsKICAgICAgICB9IAogICAgfQoKICAg\nIC8qKgogICAgICogSW5zZXJ0cyB0aGUgaW5pdGlhbCBzZXF1ZW5jZSBpbmZv\ncm1hdGlvbiBpbnRvIHRoZSBkYXRhYmFzZSwgaWYgYW55LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgaW5zZXJ0U2VxdWVuY2UoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbnNlcnQtc2VxIikp\nOwoKICAgICAgICBPYmplY3QgcGsgPSBnZXRQcmltYXJ5S2V5KG1hcHBpbmcp\nOwogICAgICAgIGlmIChwayA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtc2VxLXR5\ncGUiLAogICAgICAgICAgICAgICAgZ2V0Q2xhc3MoKSwgbWFwcGluZykpOwoK\nICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25mLmdldERCRGljdGlv\nbmFyeUluc3RhbmNlKCk7CiAgICAgICAgU1FMQnVmZmVyIGluc2VydCA9IG5l\ndyBTUUxCdWZmZXIoZGljdCkuYXBwZW5kKCJJTlNFUlQgSU5UTyAiKS4KICAg\nICAgICAgICAgYXBwZW5kKF9wa0NvbHVtbi5nZXRUYWJsZSgpKS5hcHBlbmQo\nIiAoIikuCiAgICAgICAgICAgIGFwcGVuZChfcGtDb2x1bW4pLmFwcGVuZCgi\nLCAiKS5hcHBlbmQoX3NlcUNvbHVtbikuCiAgICAgICAgICAgIGFwcGVuZCgi\nKSBWQUxVRVMgKCIpLgogICAgICAgICAgICBhcHBlbmRWYWx1ZShwaywgX3Br\nQ29sdW1uKS5hcHBlbmQoIiwgIikuCiAgICAgICAgICAgIGFwcGVuZFZhbHVl\nKE51bWJlcnMudmFsdWVPZigxKSwgX3NlcUNvbHVtbikuYXBwZW5kKCIpIik7\nCgogICAgICAgIGJvb2xlYW4gd2FzQXV0byA9IGNvbm4uZ2V0QXV0b0NvbW1p\ndCgpOwogICAgICAgIGlmICghd2FzQXV0bykKICAgICAgICAgICAgY29ubi5z\nZXRBdXRvQ29tbWl0KHRydWUpOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3Rt\nbnQgPSBpbnNlcnQucHJlcGFyZVN0YXRlbWVudChjb25uKTsKICAgICAgICAg\nICAgc3RtbnQuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7fQogICAgICAgICAgICBpZiAoIXdhc0F1dG8pCiAgICAgICAgICAg\nICAgICBjb25uLnNldEF1dG9Db21taXQoZmFsc2UpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY3VycmVudCBzZXF1ZW5j\nZSB2YWx1ZSwgb3IgLTEgaWYgdW5hdHRhaW5hYmxlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgbG9uZyBnZXRTZXF1ZW5jZShDbGFzc01hcHBpbmcgbWFwcGlu\nZywgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImdldC1zZXEiKSk7CgogICAg\nICAgIE9iamVjdCBwayA9IGdldFByaW1hcnlLZXkobWFwcGluZyk7CiAgICAg\nICAgaWYgKHBrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAg\nICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25h\ncnlJbnN0YW5jZSgpOwogICAgICAgIFNRTEJ1ZmZlciBzZWwgPSBuZXcgU1FM\nQnVmZmVyKGRpY3QpLmFwcGVuZChfc2VxQ29sdW1uKTsKICAgICAgICBTUUxC\ndWZmZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKGRpY3QpLmFwcGVuZChfcGtD\nb2x1bW4pLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgIGFwcGVuZFZhbHVl\nKHBrLCBfcGtDb2x1bW4pOwogICAgICAgIFNRTEJ1ZmZlciB0YWJsZXMgPSBu\nZXcgU1FMQnVmZmVyKGRpY3QpLmFwcGVuZChfc2VxQ29sdW1uLmdldFRhYmxl\nKCkpOwoKICAgICAgICBTUUxCdWZmZXIgc2VsZWN0ID0gZGljdC50b1NlbGVj\ndChzZWwsIG51bGwsIHRhYmxlcywgd2hlcmUsIG51bGwsCiAgICAgICAgICAg\nIG51bGwsIG51bGwsIGZhbHNlLCBkaWN0LnN1cHBvcnRzU2VsZWN0Rm9yVXBk\nYXRlLCAwLCBMb25nLk1BWF9WQUxVRSk7CgogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gc2VsZWN0LnByZXBhcmVTdGF0ZW1lbnQoY29ubik7\nCiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAg\nICAgICBpZiAoIXJzLm5leHQoKSkKICAgICAgICAgICAgICAgIHJldHVybiAt\nMTsKICAgICAgICAgICAgcmV0dXJuIGRpY3QuZ2V0TG9uZyhycywgMSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIHRyeSB7IHN0bW50LmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHcmFicyB0aGUgbmV4dCBoYW5kZnVs\nIG9mIHNlcXVlbmNlIG51bWJlcnMuCiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIHRoZSBzZXF1ZW5jZSB3YXMgdXBkYXRlZCwgZmFsc2UgaWYgbm8g\nc2VxdWVuY2UKICAgICAqIHJvdyBleGlzdGVkIGZvciB0aGlzIG1hcHBpbmcK\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc2V0U2VxdWVuY2UoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIFN0YXR1cyBzdGF0LCBpbnQgaW5jLAogICAg\nICAgIGJvb2xlYW4gdXBkYXRlU3RhdFNlcSwgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoInVwZGF0ZS1zZXEiKSk7CgogICAgICAgIE9iamVjdCBwayA9IGdl\ndFByaW1hcnlLZXkobWFwcGluZyk7CiAgICAgICAgaWYgKHBrID09IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1zZXEtdHlwZSIsCiAgICAgICAgICAgICAgICBnZXRD\nbGFzcygpLCBtYXBwaW5nKSk7CgogICAgICAgIERCRGljdGlvbmFyeSBkaWN0\nID0gX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBT\nUUxCdWZmZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKGRpY3QpLmFwcGVuZChf\ncGtDb2x1bW4pLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgIGFwcGVuZFZh\nbHVlKHBrLCBfcGtDb2x1bW4pOwoKICAgICAgICAvLyBsb29wIHVudGlsIHdl\nIGhhdmUgYSBzdWNjZXNzZnVsIGF0b21pYyBzZWxlY3QvdXBkYXRlIHNlcXVl\nbmNlCiAgICAgICAgbG9uZyBjdXIgPSAwOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50OwogICAgICAgIFJlc3VsdFNldCByczsKICAgICAgICBT\nUUxCdWZmZXIgdXBkOwogICAgICAgIGZvciAoaW50IHVwZGF0ZXMgPSAwOyB1\ncGRhdGVzID09IDA7KSB7CiAgICAgICAgICAgIHN0bW50ID0gbnVsbDsKICAg\nICAgICAgICAgcnMgPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgY3VyID0gZ2V0U2VxdWVuY2UobWFwcGluZywgY29ubik7CiAg\nICAgICAgICAgICAgICBpZiAoY3VyID09IC0xKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUg\ndGhlIHZhbHVlCiAgICAgICAgICAgICAgICB1cGQgPSBuZXcgU1FMQnVmZmVy\nKGRpY3QpOwogICAgICAgICAgICAgICAgdXBkLmFwcGVuZCgiVVBEQVRFICIp\nLmFwcGVuZChfc2VxQ29sdW1uLmdldFRhYmxlKCkpLgogICAgICAgICAgICAg\nICAgICAgIGFwcGVuZCgiIFNFVCAiKS5hcHBlbmQoX3NlcUNvbHVtbikuYXBw\nZW5kKCIgPSAiKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmRWYWx1ZShO\ndW1iZXJzLnZhbHVlT2YoY3VyICsgaW5jKSwgX3NlcUNvbHVtbikuCiAgICAg\nICAgICAgICAgICAgICAgYXBwZW5kKCIgV0hFUkUgIikuYXBwZW5kKHdoZXJl\nKS5hcHBlbmQoIiBBTkQgIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5k\nKF9zZXFDb2x1bW4pLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgICAgICAg\nICAgYXBwZW5kVmFsdWUoTnVtYmVycy52YWx1ZU9mKGN1ciksIF9zZXFDb2x1\nbW4pOwoKICAgICAgICAgICAgICAgIHN0bW50ID0gdXBkLnByZXBhcmVTdGF0\nZW1lbnQoY29ubik7CiAgICAgICAgICAgICAgICB1cGRhdGVzID0gc3RtbnQu\nZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgaWYgKHJzICE9IG51bGwpIAogICAgICAgICAgICAgICAg\nICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkge30KICAgICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gc2V0dXAgbmV3IHNlcXVlbmNlIHJhbmdlCiAgICAgICAg\nc3luY2hyb25pemVkIChzdGF0KSB7CiAgICAgICAgICAgIGlmICh1cGRhdGVT\ndGF0U2VxICYmIHN0YXQuc2VxIDwgY3VyKQogICAgICAgICAgICAgICAgc3Rh\ndC5zZXEgPSBjdXI7CiAgICAgICAgICAgIGlmIChzdGF0Lm1heCA8IGN1ciAr\nIGluYykKICAgICAgICAgICAgICAgIHN0YXQubWF4ID0gY3VyICsgaW5jOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZXMgdGhlIHNlcXVlbmNlIHRhYmxlIGluIHRoZSBEQi4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgcmVmcmVzaFRhYmxlKCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2xvZy5pc0lu\nZm9FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgi\nbWFrZS1zZXEtdGFibGUiKSk7CgogICAgICAgIC8vIGNyZWF0ZSB0aGUgdGFi\nbGUKICAgICAgICBTY2hlbWFUb29sIHRvb2wgPSBuZXcgU2NoZW1hVG9vbChf\nY29uZik7CiAgICAgICAgdG9vbC5zZXRJZ25vcmVFcnJvcnModHJ1ZSk7CiAg\nICAgICAgdG9vbC5jcmVhdGVUYWJsZShfcGtDb2x1bW4uZ2V0VGFibGUoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wcyB0aGUgc2VxdWVuY2UgdGFi\nbGUgaW4gdGhlIERCLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBkcm9wVGFi\nbGUoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy5pbmZv\nKF9sb2MuZ2V0KCJkcm9wLXNlcS10YWJsZSIpKTsKCiAgICAgICAgLy8gZHJv\ncCB0aGUgdGFibGUKICAgICAgICBTY2hlbWFUb29sIHRvb2wgPSBuZXcgU2No\nZW1hVG9vbChfY29uZik7CiAgICAgICAgdG9vbC5zZXRJZ25vcmVFcnJvcnMo\ndHJ1ZSk7CiAgICAgICAgdG9vbC5kcm9wVGFibGUoX3BrQ29sdW1uLmdldFRh\nYmxlKCkpOwogICAgfQoKICAgIC8vLy8vLy8vLwogICAgLy8gTWFpbgogICAg\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBVc2FnZTogamF2YSBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGVKREJDU2VxdWVuY2UgW29w\ndGlvbl0qCiAgICAgKiAtYWN0aW9uLy1hICZsdDthZGQgfCBkcm9wIHwgZ2V0\nIHwgc2V0Jmd0OyBbdmFsdWVdCiAgICAgKiAgV2hlcmUgdGhlIGZvbGxvd2lu\nZyBvcHRpb25zIGFyZSByZWNvZ25pemVkLgogICAgICogPHVsPgogICAgICog\nPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZsdDtwcm9wZXJ0aWVzIGZpbGUgb3Ig\ncmVzb3VyY2UmZ3Q7PC9pPjogVGhlCiAgICAgKiBwYXRoIG9yIHJlc291cmNl\nIG5hbWUgb2YgYSBPcGVuSlBBIHByb3BlcnRpZXMgZmlsZSBjb250YWluaW5n\nCiAgICAgKiBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSBsaWNlbnNlIGtleQlh\nbmQgY29ubmVjdGlvbiBkYXRhIGFzCiAgICAgKiBvdXRsaW5lZCBpbiB7QGxp\nbmsgSkRCQ0NvbmZpZ3VyYXRpb259LiBPcHRpb25hbC48L2xpPgogICAgICog\nPGxpPjxpPi0mbHQ7cHJvcGVydHkgbmFtZSZndDsgJmx0O3Byb3BlcnR5IHZh\nbHVlJmd0OzwvaT46IEFsbCBiZWFuCiAgICAgKiBwcm9wZXJ0aWVzIG9mIHRo\nZSBPcGVuSlBBIHtAbGluayBKREJDQ29uZmlndXJhdGlvbn0gY2FuIGJlIHNl\ndCBieQogICAgICogdXNpbmcgdGhlaXIJbmFtZXMgYW5kIHN1cHBseWluZyBh\nIHZhbHVlLiBGb3IgZXhhbXBsZToKICAgICAqIDxjb2RlPi1saWNlbnNlS2V5\nIGFkc2xmamE4M3IzbGthZGY8L2NvZGU+PC9saT4KICAgICAqIDwvdWw+CiAg\nICAgKiAgVGhlIHZhcmlvdXMgYWN0aW9ucyBhcmUgYXMgZm9sbG93cy4KICAg\nICAqIDx1bD4KICAgICAqIDxsaT48aT5hZGQ8L2k+OiBDcmVhdGUgdGhlIHNl\ncXVlbmNlIHRhYmxlLjwvbGk+CiAgICAgKiA8bGk+PGk+ZHJvcDwvaT46IERy\nb3AgdGhlIHNlcXVlbmNlIHRhYmxlLjwvbGk+CiAgICAgKiA8bGk+PGk+Z2V0\nPC9pPjogUHJpbnQgdGhlIGN1cnJlbnQgc2VxdWVuY2UgdmFsdWUuPC9saT4K\nICAgICAqIDxsaT48aT5zZXQ8L2k+OiBTZXQgdGhlIHNlcXVlbmNlIHZhbHVl\nLjwvbGk+CiAgICAgKiA8L3VsPgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKQogICAgICAgIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7\nCiAgICAgICAgYXJncyA9IG9wdHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAg\nICAgICAgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBKREJDQ29uZmln\ndXJhdGlvbkltcGwoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nIXJ1bihjb25mLCBhcmdzLCBvcHRzKSkKICAgICAgICAgICAgICAgIFN5c3Rl\nbS5vdXQucHJpbnRsbihfbG9jLmdldCgic2VxLXVzYWdlIikpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVy\nbnMgZmFsc2UgaWYgaW52YWxpZCBvcHRpb25zIHdlcmUgZ2l2ZW4uCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBPcHRpb25zIG9w\ndHMpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9w\ndHMuY29udGFpbnNLZXkoImhlbHAiKSB8fCBvcHRzLmNvbnRhaW5zS2V5KCIt\naGVscCIpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFN0\ncmluZyBhY3Rpb24gPSBvcHRzLnJlbW92ZVByb3BlcnR5KCJhY3Rpb24iLCAi\nYSIsIG51bGwpOwogICAgICAgIENvbmZpZ3VyYXRpb25zLnBvcHVsYXRlQ29u\nZmlndXJhdGlvbihjb25mLCBvcHRzKTsKICAgICAgICByZXR1cm4gcnVuKGNv\nbmYsIGFyZ3MsIGFjdGlvbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSdW4g\ndGhlIHRvb2wuIFJldHVybiBmYWxzZSBpZiBhbiBpbnZhbGlkIG9wdGlvbiB3\nYXMgZ2l2ZW4uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBy\ndW4oSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAg\nICAgICBTdHJpbmcgYWN0aW9uKQogICAgICAgIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEgfHwgKGFyZ3MubGVuZ3Ro\nICE9IDAKICAgICAgICAgICAgJiYgIUFDVElPTl9TRVQuZXF1YWxzKGFjdGlv\nbikpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFRhYmxl\nSkRCQ1NlcSBzZXEgPSBuZXcgVGFibGVKREJDU2VxKCk7CiAgICAgICAgU3Ry\naW5nIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhjb25m\nLmdldFNlcXVlbmNlKCkpOwogICAgICAgIENvbmZpZ3VyYXRpb25zLmNvbmZp\nZ3VyZUluc3RhbmNlKHNlcSwgY29uZiwgcHJvcHMpOwoKICAgICAgICBpZiAo\nQUNUSU9OX0RST1AuZXF1YWxzKGFjdGlvbikpCiAgICAgICAgICAgIHNlcS5k\ncm9wVGFibGUoKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fQURELmVxdWFs\ncyhhY3Rpb24pKQogICAgICAgICAgICBzZXEucmVmcmVzaFRhYmxlKCk7CiAg\nICAgICAgZWxzZSBpZiAoQUNUSU9OX0dFVC5lcXVhbHMoYWN0aW9uKSB8fCBB\nQ1RJT05fU0VULmVxdWFscyhhY3Rpb24pKSB7CiAgICAgICAgICAgIENvbm5l\nY3Rpb24gY29ubiA9IGNvbmYuZ2V0RGF0YVNvdXJjZTIobnVsbCkuZ2V0Q29u\nbmVjdGlvbigpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nbG9uZyBjdXIgPSBzZXEuZ2V0U2VxdWVuY2UobnVsbCwgY29ubik7CiAgICAg\nICAgICAgICAgICBpZiAoQUNUSU9OX0dFVC5lcXVhbHMoYWN0aW9uKSkKICAg\nICAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oY3VyKTsKICAg\nICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvbmcg\nc2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHNldCA9IExvbmcucGFyc2VMb25n\nKGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgICAgICAgICAgc2V0ID0gY3VyICsgc2VxLmdldEFsbG9jYXRlKCk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHNldCA8IGN1cikKICAgICAgICAg\nICAgICAgICAgICAgICAgc2V0ID0gY3VyOwogICAgICAgICAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBTdGF0dXMgc3RhdCA9\nIHNlcS5nZXRTdGF0dXMobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNlcS5zZXRTZXF1ZW5jZShudWxsLCBzdGF0LCAoaW50KSAoc2V0IC0gY3Vy\nKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4pOwog\nICAgICAgICAgICAgICAgICAgICAgICBzZXQgPSBzdGF0LnNlcTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVy\nci5wcmludGxuKHNldCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBu\nZmUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xv\nc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBzdHJ1Y3QgdG8gaG9sZCBzdGF0dXMgaW5mb3JtYXRpb24uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU3RhdHVzIHsKCiAgICAg\nICAgcHVibGljIGxvbmcgc2VxID0gMUw7CiAgICAgICAgcHVibGljIGxvbmcg\nbWF4ID0gMEw7CiAgICB9Cn0K\n","encoding":"base64"}

