{"sha":"f1571b076cfc3833915475131600c9c642d392ba","node_id":"MDQ6QmxvYjIwNjM2NDpmMTU3MWIwNzZjZmMzODMzOTE1NDc1MTMxNjAwYzljNjQyZDM5MmJh","size":7051,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f1571b076cfc3833915475131600c9c642d392ba","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Db250YWluZXJGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuTFJTTWFwRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlJlbGF0aW9uU3RyYXRlZ2llczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktl\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsdGVyczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CgovKioK\nICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGdpdmVuIG1hcCdzIGtleS4K\nICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICovCmNsYXNzIEdl\ndE1hcFZhbHVlCiAgICBleHRlbmRzIEFic3RyYWN0VmFsIHsKCiAgICBwcml2\nYXRlIGZpbmFsIFZhbCBfbWFwOwogICAgcHJpdmF0ZSBmaW5hbCBWYWwgX2tl\neTsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBfbWV0YSA9IG51bGw7CiAg\nICBwcml2YXRlIENsYXNzIF9jYXN0ID0gbnVsbDsKCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdG9yLiBQcm92aWRlIHRoZSBtYXAgYW5kIGtleSB0byBvcGVy\nYXRlIG9uLgogICAgICovCiAgICBwdWJsaWMgR2V0TWFwVmFsdWUoVmFsIG1h\ncCwgVmFsIGtleSkgewogICAgICAgIF9tYXAgPSBtYXA7CiAgICAgICAgX2tl\neSA9IGtleTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRN\nZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0TWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzVmFyaWFibGUoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nfQoKICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKCkgewogICAgICAgIGlmIChf\nY2FzdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2Nhc3Q7CiAgICAg\nICAgcmV0dXJuIF9tYXAuZ2V0VHlwZSgpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEltcGxpY2l0VHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAgX2Nh\nc3QgPSB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBFeHBTdGF0ZSBpbml0aWFs\naXplKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBpbnQgZmxhZ3MpIHsK\nICAgICAgICBFeHBTdGF0ZSBtYXBTdGF0ZSA9IF9tYXAuaW5pdGlhbGl6ZShz\nZWwsIGN0eCwgMCk7CiAgICAgICAgRXhwU3RhdGUga2V5U3RhdGUgPSBfa2V5\nLmluaXRpYWxpemUoc2VsLCBjdHgsIDApOwogICAgICAgIHJldHVybiBuZXcg\nR2V0TWFwVmFsdWVFeHBTdGF0ZShzZWwuYW5kKG1hcFN0YXRlLmpvaW5zLCBr\nZXlTdGF0ZS5qb2lucyksCiAgICAgICAgICAgIG1hcFN0YXRlLCBrZXlTdGF0\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHByZXNzaW9uIHN0YXRlLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBHZXRNYXBWYWx1ZUV4\ncFN0YXRlCiAgICAgICAgZXh0ZW5kcyBFeHBTdGF0ZSB7CgogICAgICAgIHB1\nYmxpYyBmaW5hbCBFeHBTdGF0ZSBtYXBTdGF0ZTsKICAgICAgICBwdWJsaWMg\nZmluYWwgRXhwU3RhdGUga2V5U3RhdGU7CgogICAgICAgIHB1YmxpYyBHZXRN\nYXBWYWx1ZUV4cFN0YXRlKEpvaW5zIGpvaW5zLCBFeHBTdGF0ZSBtYXBTdGF0\nZSwgCiAgICAgICAgICAgIEV4cFN0YXRlIGtleVN0YXRlKSB7CiAgICAgICAg\nICAgIHN1cGVyKGpvaW5zKTsKICAgICAgICAgICAgdGhpcy5tYXBTdGF0ZSA9\nIG1hcFN0YXRlOwogICAgICAgICAgICB0aGlzLmtleVN0YXRlID0ga2V5U3Rh\ndGU7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRh\nU3RvcmVWYWx1ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUsIAogICAgICAgIE9iamVjdCB2YWwpIHsKICAgICAgICBHZXRN\nYXBWYWx1ZUV4cFN0YXRlIGdzdGF0ZSA9IChHZXRNYXBWYWx1ZUV4cFN0YXRl\nKSBzdGF0ZTsKICAgICAgICByZXR1cm4gX21hcC50b0RhdGFTdG9yZVZhbHVl\nKHNlbCwgY3R4LCBnc3RhdGUubWFwU3RhdGUsIHZhbCk7CiAgICB9CgoKICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0\neCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gcGtzKSB7CiAg\nICAgICAgc2VsLnNlbGVjdChuZXdTUUxCdWZmZXIoc2VsLCBjdHgsIHN0YXRl\nKSwgdGhpcyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0Q29sdW1u\ncyhTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUs\nCiAgICAgICAgYm9vbGVhbiBwa3MpIHsKICAgICAgICBHZXRNYXBWYWx1ZUV4\ncFN0YXRlIGdzdGF0ZSA9IChHZXRNYXBWYWx1ZUV4cFN0YXRlKSBzdGF0ZTsK\nICAgICAgICBfbWFwLnNlbGVjdENvbHVtbnMoc2VsLCBjdHgsIGdzdGF0ZS5t\nYXBTdGF0ZSwgdHJ1ZSk7CiAgICAgICAgX2tleS5zZWxlY3RDb2x1bW5zKHNl\nbCwgY3R4LCBnc3RhdGUua2V5U3RhdGUsIHRydWUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGdyb3VwQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgs\nIEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAgc2VsLmdyb3VwQnkobmV3U1FM\nQnVmZmVyKHNlbCwgY3R4LCBzdGF0ZSkpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIG9yZGVyQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0\nYXRlIHN0YXRlLCAKICAgICAgICBib29sZWFuIGFzYykgewogICAgICAgIHNl\nbC5vcmRlckJ5KG5ld1NRTEJ1ZmZlcihzZWwsIGN0eCwgc3RhdGUpLCBhc2Ms\nIGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIFNRTEJ1ZmZlciBuZXdTUUxC\ndWZmZXIoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0\nYXRlKSB7CiAgICAgICAgY2FsY3VsYXRlVmFsdWUoc2VsLCBjdHgsIHN0YXRl\nLCBudWxsLCBudWxsKTsKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNR\nTEJ1ZmZlcihjdHguc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAg\nIGFwcGVuZFRvKHNlbCwgY3R4LCBzdGF0ZSwgYnVmLCAwKTsKICAgICAgICBy\nZXR1cm4gYnVmOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZChFeHBD\nb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIFJlc3VsdCByZXMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIEZpbHRl\ncnMuY29udmVydChyZXMuZ2V0T2JqZWN0KHRoaXMsCiAgICAgICAgICAgIEph\ndmFTUUxUeXBlcy5KREJDX0RFRkFVTFQsIG51bGwpLCBnZXRUeXBlKCkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNhbGN1bGF0ZVZhbHVlKFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nVmFsIG90aGVyLCBFeHBTdGF0ZSBvdGhlclN0YXRlKSB7CiAgICAgICAgR2V0\nTWFwVmFsdWVFeHBTdGF0ZSBnc3RhdGUgPSAoR2V0TWFwVmFsdWVFeHBTdGF0\nZSkgc3RhdGU7CiAgICAgICAgX21hcC5jYWxjdWxhdGVWYWx1ZShzZWwsIGN0\neCwgZ3N0YXRlLm1hcFN0YXRlLCBudWxsLCBudWxsKTsKICAgICAgICBfa2V5\nLmNhbGN1bGF0ZVZhbHVlKHNlbCwgY3R4LCBnc3RhdGUua2V5U3RhdGUsIG51\nbGwsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgbGVuZ3RoKFNlbGVj\ndCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSkgewogICAg\nICAgIHJldHVybiAxOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZFRv\nKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwg\nCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgaW50IGluZGV4KSB7CiAgICAgICAg\naWYgKCEoX21hcCBpbnN0YW5jZW9mIFBDUGF0aCkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAg\nICAgIGlmICghKF9rZXkgaW5zdGFuY2VvZiBDb25zdCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwoK\nICAgICAgICBHZXRNYXBWYWx1ZUV4cFN0YXRlIGdzdGF0ZSA9IChHZXRNYXBW\nYWx1ZUV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBQQ1BhdGggbWFwID0gKFBD\nUGF0aCkgX21hcDsKICAgICAgICBPYmplY3Qga2V5ID0gKChDb25zdCkgX2tl\neSkuZ2V0VmFsdWUoY3R4LCBnc3RhdGUua2V5U3RhdGUpOwogICAgICAgIEZp\nZWxkTWFwcGluZyBmaWVsZCA9IG1hcC5nZXRGaWVsZE1hcHBpbmcoZ3N0YXRl\nLm1hcFN0YXRlKTsKICAgICAgICBpZiAoIShmaWVsZC5nZXRTdHJhdGVneSgp\nIGluc3RhbmNlb2YgTFJTTWFwRmllbGRTdHJhdGVneSkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwoK\nICAgICAgICBMUlNNYXBGaWVsZFN0cmF0ZWd5IHN0cmF0ID0gKExSU01hcEZp\nZWxkU3RyYXRlZ3kpIGZpZWxkLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nW10gY2xzcyA9IHN0cmF0LmdldEluZGVwZW5kZW50VmFsdWVN\nYXBwaW5ncyh0cnVlKTsKICAgICAgICBpZiAoY2xzcyAhPSBudWxsICYmIGNs\nc3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgdGhyb3cgUmVsYXRpb25TdHJh\ndGVnaWVzLnVuam9pbmFibGUoZmllbGQpOwoKICAgICAgICBDbGFzc01hcHBp\nbmcgY2xzID0gKGNsc3MubGVuZ3RoID09IDApID8gbnVsbCA6IGNsc3NbMF07\nCiAgICAgICAgRm9yZWlnbktleSBmayA9IHN0cmF0LmdldEpvaW5Gb3JlaWdu\nS2V5KGNscyk7CgogICAgICAgIC8vIG1hbnVhbGx5IGNyZWF0ZSBhIHN1YnNl\nbGVjdCBmb3IgdGhlIE1hcCdzIHZhbHVlCiAgICAgICAgc3FsLmFwcGVuZCgi\nKFNFTEVDVCAiKTsKICAgICAgICBDb2x1bW5bXSB2YWx1ZXMgPSBmaWVsZC5n\nZXRFbGVtZW50TWFwcGluZygpLmdldENvbHVtbnMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIs\nICIpOwogICAgICAgICAgICBzcWwuYXBwZW5kKHZhbHVlc1tpXS5nZXRGdWxs\nTmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgc3FsLmFwcGVuZCgiIEZST00g\nIikuYXBwZW5kKHZhbHVlc1swXS5nZXRUYWJsZSgpLmdldEZ1bGxOYW1lKCkp\nLgogICAgICAgICAgICBhcHBlbmQoIiBXSEVSRSAiKTsKCiAgICAgICAgLy8g\nYWRkIGluIHRoZSBqb2lucwogICAgICAgIENvbnRhaW5lckZpZWxkU3RyYXRl\nZ3kuYXBwZW5kVW5hbGlhc2VkSm9pbihzcWwsIHNlbCwgbnVsbCwgCiAgICAg\nICAgICAgIGN0eC5zdG9yZS5nZXREQkRpY3Rpb25hcnkoKSwgZmllbGQsIGZr\nKTsKICAgICAgICBzcWwuYXBwZW5kKCIgQU5EICIpOwoKICAgICAgICBrZXkg\nPSBzdHJhdC50b0tleURhdGFTdG9yZVZhbHVlKGtleSwgY3R4LnN0b3JlKTsK\nICAgICAgICBDb2x1bW5bXSBjb2xzID0gc3RyYXQuZ2V0S2V5Q29sdW1ucyhj\nbHMpOwogICAgICAgIE9iamVjdFtdIHZhbHMgPSAoY29scy5sZW5ndGggPT0g\nMSkgPyBudWxsIDogKE9iamVjdFtdKSBrZXk7CgogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBz\ncWwuYXBwZW5kKGNvbHNbaV0uZ2V0RnVsbE5hbWUoKSk7CiAgICAgICAgICAg\nIGlmICh2YWxzID09IG51bGwpCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5k\nKChrZXkgPT0gbnVsbCkgPyAiIElTICIgOiAiID0gIikuCiAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kVmFsdWUoa2V5LCBjb2xzW2ldKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgodmFsc1tpXSA9\nPSBudWxsKSA/ICIgSVMgIiA6ICIgPSAiKS4KICAgICAgICAgICAgICAgICAg\nICBhcHBlbmRWYWx1ZSh2YWxzW2ldLCBjb2xzW2ldKTsKICAgICAgICB9CiAg\nICAgICAgc3FsLmFwcGVuZCgiKSIpOwogICAgfQp9Cg==\n","encoding":"base64"}

