{"sha":"e7baae8c444139e649a791bacaf0f36e5d816220","node_id":"MDQ6QmxvYjIwNjM2NDplN2JhYWU4YzQ0NDEzOWU2NDlhNzkxYmFjYWYwZjM2ZTVkODE2MjIw","size":26082,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e7baae8c444139e649a791bacaf0f36e5d816220","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3RJ\ndGVyYXRvcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5PYmpl\nY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVt\nYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEJ1ZmZlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoq\nCiAqIEEgcGF0aCByZXByZXNlbnRzIGEgdHJhdmVyc2FsIGludG8gZmllbGRz\nIG9mIGEgY2FuZGlkYXRlIG9iamVjdC4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICovCmNsYXNzIFBDUGF0aAogICAgZXh0ZW5kcyBBYnN0cmFjdFZhbAog\nICAgaW1wbGVtZW50cyBKREJDUGF0aCB7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IFBBVEggPSAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEJPVU5EX1ZBUiA9IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgVU5CT1VORF9WQVIgPSAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IFVOQUNDRVNTRURfVkFSID0gMzsKCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKFBD\nUGF0aC5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01hcHBpbmcg\nX2NhbmRpZGF0ZTsKICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nIF9jbGFzcyA9\nIG51bGw7CiAgICBwcml2YXRlIExpbmtlZExpc3QgX2FjdGlvbnMgPSBudWxs\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9rZXkgPSBmYWxzZTsKICAgIHByaXZh\ndGUgaW50IF90eXBlID0gUEFUSDsKICAgIHByaXZhdGUgU3RyaW5nIF92YXJO\nYW1lID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3MgX2Nhc3QgPSBudWxsOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9jaWQgPSBmYWxzZTsKCiAgICAvKioKICAg\nICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgd2l0aCB0aGUgJ3RoaXMnIHB0\nci4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFzc01hcHBpbmcgdHlw\nZSkgewogICAgICAgIF9jYW5kaWRhdGUgPSB0eXBlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRoZSBnaXZl\nbiB2YXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFzc01h\ncHBpbmcgY2FuZGlkYXRlLCBWYXJpYWJsZSB2YXIpIHsKICAgICAgICBfY2Fu\nZGlkYXRlID0gY2FuZGlkYXRlOwogICAgICAgIF9hY3Rpb25zID0gbmV3IExp\nbmtlZExpc3QoKTsKCiAgICAgICAgUENQYXRoIG90aGVyID0gdmFyLmdldFBD\nUGF0aCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7\nCiAgICAgICAgaWYgKG90aGVyID09IG51bGwpIHsKICAgICAgICAgICAgX3R5\ncGUgPSBVTkJPVU5EX1ZBUjsKICAgICAgICAgICAgYWN0aW9uLm9wID0gQWN0\naW9uLlVOQk9VTkRfVkFSOwogICAgICAgICAgICBhY3Rpb24uZGF0YSA9IHZh\ncjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBib3VuZCB2YXJp\nYWJsZTsgY29weSBwYXRoCiAgICAgICAgICAgIF90eXBlID0gVU5BQ0NFU1NF\nRF9WQVI7CiAgICAgICAgICAgIF9hY3Rpb25zLmFkZEFsbChvdGhlci5fYWN0\naW9ucyk7CiAgICAgICAgICAgIF9rZXkgPSBvdGhlci5fa2V5OwoKICAgICAg\nICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLlZBUjsKICAgICAgICAgICAgYWN0\naW9uLmRhdGEgPSB2YXIuZ2V0TmFtZSgpOwogICAgICAgIH0KICAgICAgICBf\nYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IHZhci5nZXRU\neXBlKCk7IC8vIGluaXRpYWwgdHlwZSBpcyB2YXIgdHlwZQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRoZSBn\naXZlbiBzdWJxdWVyeS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChTdWJR\nIHN1YikgewogICAgICAgIF9jYW5kaWRhdGUgPSBzdWIuZ2V0Q2FuZGlkYXRl\nKCk7CiAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2VkTGlzdCgpOwoKICAg\nICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwogICAgICAgIGFj\ndGlvbi5vcCA9IEFjdGlvbi5TVUJRVUVSWTsKICAgICAgICBhY3Rpb24uZGF0\nYSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgICAgIF9hY3Rpb25z\nLmFkZChhY3Rpb24pOwogICAgICAgIF9jYXN0ID0gc3ViLmdldFR5cGUoKTsg\nLy8gaW5pdGlhbCB0eXBlIGlzIHN1YnF1ZXJ5IHR5cGUKICAgICAgICBfdmFy\nTmFtZSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBwYXRoIGFzIGEgYmluZGluZyBvZiB0aGUgZ2l2\nZW4gdmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZFZhcmlh\nYmxlQWN0aW9uKFZhcmlhYmxlIHZhcikgewogICAgICAgIF92YXJOYW1lID0g\ndmFyLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\ncnVlIGlmIHRoaXMgaXMgYSBib3VuZCB2YXJpYWJsZSB0aGF0IGhhcyBub3Qg\nYmVlbiBhY2Nlc3NlZAogICAgICogYWZ0ZXIgYmluZGluZy4gVXNlZnVsIGZv\nciBmaWx0ZXJzIGxpa2UKICAgICAqICJjb2xsLmNvbnRhaW5zICh2YXIpICZh\nbXA7JmFtcDsgdmFyID09IG51bGwiLCB3aGljaCBzaG91bGQgcmVhbGx5CiAg\nICAgKiBqdXN0IGFjdCBsaWtlICJjb2xsLmNvbnRhaW5zIChudWxsKSIuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVW5hY2Nlc3NlZFZhcmlhYmxl\nKCkgewogICAgICAgIHJldHVybiBfdHlwZSA9PSBVTkFDQ0VTU0VEX1ZBUjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMgaXMg\nYSBwYXRoIGludm9sdmluZyBhIHZhcmlhYmxlLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBpc1ZhcmlhYmxlUGF0aCgpIHsKICAgICAgICByZXR1cm4g\nX3R5cGUgIT0gUEFUSDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoaXMg\ncGF0aCBpcyBwYXJ0IG9mIGEgY29udGFpbnMgY2xhdXNlLCB0aGVuIGFsaWFz\nIGl0IHRvIHRoZQogICAgICogcHJvcGVyIGNvbnRhaW5zIGlkIGJlZm9yZSBp\nbml0aWFsaXphdGlvbi4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXpl\nZCB2b2lkIHNldENvbnRhaW5zSWQoU3RyaW5nIGlkKSB7CiAgICAgICAgaWYg\nKF9jaWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gdHJlYXQg\naXQganVzdCBsaWtlIGEgdW5pcXVlIHZhcmlhYmxlCiAgICAgICAgQWN0aW9u\nIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24ub3AgPSBB\nY3Rpb24uVkFSOwogICAgICAgIGFjdGlvbi5kYXRhID0gaWQ7CiAgICAgICAg\naWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIF9hY3Rpb25zID0g\nbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9u\nKTsKICAgICAgICBfY2lkID0gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xh\nc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX2Ns\nYXNzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1ldGFEYXRhKENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9jbGFzcyA9IChDbGFzc01hcHBp\nbmcpIG1ldGE7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNLZXkoKSB7\nCiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyBnZXRQYXRoKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gKF92YXJOYW1lID09IG51bGwpID8gIiIgOiBf\ndmFyTmFtZSArICIuIjsKCiAgICAgICAgU3RyaW5nQnVmZmVyIHBhdGggPSBu\nZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rp\nb24pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0g\nQWN0aW9uLlZBUiB8fCBhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQog\nICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoYWN0aW9uLmRhdGEpOwogICAg\nICAgICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRf\nVkFSKQogICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoKChWYXJpYWJsZSkg\nYWN0aW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGVsc2UgCiAg\nICAgICAgICAgICAgICBwYXRoLmFwcGVuZCgoKEZpZWxkTWFwcGluZykgYWN0\naW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHBhdGguYXBwZW5k\nKCcuJyk7CiAgICAgICAgfQogICAgICAgIGlmIChfdmFyTmFtZSAhPSBudWxs\nKQogICAgICAgICAgICBwYXRoLmFwcGVuZChfdmFyTmFtZSkuYXBwZW5kKCcu\nJyk7CiAgICAgICAgcmV0dXJuIHBhdGgudG9TdHJpbmcoKTsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldENsYXNzTWFwcGluZyhFeHBTdGF0\nZSBzdGF0ZSkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0\naEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CiAgICAgICAgaWYg\nKF9rZXkpIHsKICAgICAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRLZXko\nKS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAg\nICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFR5\ncGVNYXBwaW5nKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJu\nIHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBw\naW5nKCk7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5m\naWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBwaW5n\nKEV4cFN0YXRlIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuICgoUGF0aEV4cFN0\nYXRlKSBzdGF0ZSkuZmllbGQ7CiAgICB9CgogICAgcHVibGljIENvbHVtbltd\nIGdldENvbHVtbnMoRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBQYXRoRXhw\nU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAg\naWYgKHBzdGF0ZS5jb2xzID09IG51bGwpCiAgICAgICAgICAgIHBzdGF0ZS5j\nb2xzID0gY2FsY3VsYXRlQ29sdW1ucyhwc3RhdGUpOwogICAgICAgIHJldHVy\nbiBwc3RhdGUuY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBjb2x1\nbW5zIHVzZWQgYnkgdGhpcyBwYXRoLgogICAgICovCiAgICBwcml2YXRlIENv\nbHVtbltdIGNhbGN1bGF0ZUNvbHVtbnMoUGF0aEV4cFN0YXRlIHBzdGF0ZSkg\newogICAgICAgIGlmIChfa2V5KSB7CiAgICAgICAgICAgIGlmICghcHN0YXRl\nLmpvaW5lZFJlbCAKICAgICAgICAgICAgICAgICYmIHBzdGF0ZS5maWVsZC5n\nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGpvaW5SZWxhdGlvbihwc3RhdGUsIF9rZXksIGZhbHNlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHBzdGF0ZS5qb2luZWRSZWwgCiAg\nICAgICAgICAgICAgICAmJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCkuZ2V0VHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1\ncm4gcHN0YXRlLmZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRUeXBlTWFwcGlu\nZygpLgogICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlDb2x1bW5z\nKCk7CiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFw\ncGluZygpLmdldENvbHVtbnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHBz\ndGF0ZS5maWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN3aXRjaCAocHN0\nYXRlLmZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcgZWxl\nbSA9IHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChwc3RhdGUuam9pbmVkUmVsICYmIGVsZW0uZ2V0\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBlbGVtLmdldFR5cGVNYXBwaW5nKCkuZ2V0UHJpbWFy\neUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbS5n\nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGVsZW0uZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygpOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKHBzdGF0ZS5qb2luZWRSZWwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlwZU1hcHBpbmcoKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlDb2x1bW5z\nKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoX2Ns\nYXNzID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9DT0xVTU5TCiAgICAgICAg\nICAgIDogX2NsYXNzLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZSgpIHsKICAgICAgICBpZiAo\nX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIEFjdGlvbiBhY3Rpb24gPSAoQWN0aW9uKSBfYWN0aW9ucy5nZXRM\nYXN0KCk7CiAgICAgICAgcmV0dXJuIGFjdGlvbi5vcCA9PSBBY3Rpb24uVU5C\nT1VORF9WQVIgfHwgYWN0aW9uLm9wID09IEFjdGlvbi5WQVI7IAogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGdldChGaWVsZE1ldGFEYXRhIGZpZWxkLCBib29s\nZWFuIG51bGxUcmF2ZXJzYWwpIHsKICAgICAgICBpZiAoX2FjdGlvbnMgPT0g\nbnVsbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAgICAg\nICAgYWN0aW9uLm9wID0gKG51bGxUcmF2ZXJzYWwpID8gQWN0aW9uLkdFVF9P\nVVRFUiA6IEFjdGlvbi5HRVQ7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBmaWVs\nZDsKICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBpZiAo\nX3R5cGUgPT0gVU5BQ0NFU1NFRF9WQVIpCiAgICAgICAgICAgIF90eXBlID0g\nQk9VTkRfVkFSOwogICAgICAgIF9jYXN0ID0gbnVsbDsKICAgICAgICBfa2V5\nID0gZmFsc2U7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lk\nIGdldEtleSgpIHsKICAgICAgICBpZiAoX2NpZCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyBjaGFuZ2UgdGhlIGxhc3QgYWN0aW9uIHRvIGEg\nZ2V0IGtleQogICAgICAgIEFjdGlvbiBhY3Rpb24gPSAoQWN0aW9uKSBfYWN0\naW9ucy5nZXRMYXN0KCk7CiAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLkdF\nVF9LRVk7CiAgICAgICAgX2Nhc3QgPSBudWxsOwogICAgICAgIF9rZXkgPSB0\ncnVlOwogICAgfQoKICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGxhc3QoKSB7\nCiAgICAgICAgQWN0aW9uIGFjdCA9IGxhc3RGaWVsZEFjdGlvbigpOwogICAg\nICAgIHJldHVybiAoYWN0ID09IG51bGwpID8gbnVsbCA6IChGaWVsZE1ldGFE\nYXRhKSBhY3QuZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbGFzdCBhY3Rpb24gdGhhdCBnZXRzIGEgZmllbGQuCiAgICAgKi8KICAg\nIHByaXZhdGUgQWN0aW9uIGxhc3RGaWVsZEFjdGlvbigpIHsKICAgICAgICBp\nZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIExpc3RJdGVyYXRvciBpdHIgPSBfYWN0aW9ucy5saXN0SXRl\ncmF0b3IoX2FjdGlvbnMuc2l6ZSgpKTsKICAgICAgICBBY3Rpb24gcHJldjsK\nICAgICAgICB3aGlsZSAoaXRyLmhhc1ByZXZpb3VzKCkpIHsKICAgICAgICAg\nICAgcHJldiA9IChBY3Rpb24pIGl0ci5wcmV2aW91cygpOwogICAgICAgICAg\nICBpZiAocHJldi5vcCA9PSBBY3Rpb24uR0VUIHx8IHByZXYub3AgPT0gQWN0\naW9uLkdFVF9PVVRFUgogICAgICAgICAgICAgICAgfHwgcHJldi5vcCA9PSBB\nY3Rpb24uR0VUX0tFWSkKICAgICAgICAgICAgICAgIHJldHVybiBwcmV2Owog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJs\naWMgQ2xhc3MgZ2V0VHlwZSgpIHsKICAgICAgICBpZiAoX2Nhc3QgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIF9jYXN0OwogICAgICAgIEFjdGlvbiBh\nY3QgPSBsYXN0RmllbGRBY3Rpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZsZCA9IChhY3QgPT0gbnVsbCkgPyBudWxsIDogKEZpZWxkTWV0YURhdGEp\nIGFjdC5kYXRhOwogICAgICAgIGJvb2xlYW4ga2V5ID0gYWN0ICE9IG51bGwg\nJiYgYWN0Lm9wID09IEFjdGlvbi5HRVRfS0VZOwogICAgICAgIGlmIChmbGQg\nIT0gbnVsbCkgewogICAgICAgICAgICBzd2l0Y2ggKGZsZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGlmIChmbGQuZ2V0RGVjbGFy\nZWRUeXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAg\nICAgIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBCeXRlW10uY2xhc3MK\nICAgICAgICAgICAgICAgICAgICAgICAgfHwgZmxkLmdldERlY2xhcmVkVHlw\nZSgpID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8\nfCBmbGQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3Mp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFy\nZWRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRF\nbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgaWYgKGtl\neSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRLZXko\nKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZmxkLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFy\nZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9jbGFzcyAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gX2NsYXNzLmdldERlc2NyaWJlZFR5cGUo\nKTsKICAgICAgICByZXR1cm4gT2JqZWN0LmNsYXNzOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldEltcGxpY2l0VHlwZShDbGFzcyB0eXBlKSB7CiAgICAg\nICAgX2Nhc3QgPSB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBFeHBTdGF0ZSBp\nbml0aWFsaXplKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBpbnQgZmxh\nZ3MpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gbmV3IFBhdGhF\neHBTdGF0ZShzZWwubmV3Sm9pbnMoKSk7CiAgICAgICAgYm9vbGVhbiBrZXkg\nPSBmYWxzZTsKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIgPSBmYWxzZTsK\nICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gX2NhbmRpZGF0ZTsKCiAgICAg\nICAgLy8gaXRlcmF0ZSB0byB0aGUgZmluYWwgZmllbGQKICAgICAgICBDbGFz\nc01hcHBpbmcgb3duZXI7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGZyb20sIHRv\nOwogICAgICAgIEFjdGlvbiBhY3Rpb247CiAgICAgICAgVmFyaWFibGUgdmFy\nOwogICAgICAgIEl0ZXJhdG9yIGl0ciA9IChfYWN0aW9ucyA9PSBudWxsKSA/\nIG51bGwgOiBfYWN0aW9ucy5pdGVyYXRvcigpOwogICAgICAgIEZpZWxkTWFw\ncGluZyBmaWVsZDsKICAgICAgICB3aGlsZSAoaXRyICE9IG51bGwgJiYgaXRy\nLmhhc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9uKSBp\ndHIubmV4dCgpOwoKICAgICAgICAgICAgLy8gdHJlYXQgc3VicXVlcmllcyBs\naWtlIHZhcmlhYmxlcyBmb3IgYWxpYXMgZ2VuZXJhdGlvbiBwdXJwb3Nlcwog\nICAgICAgICAgICBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5WQVIpCiAgICAg\nICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0VmFy\naWFibGUoKFN0cmluZykgYWN0aW9uLmRhdGEpOwogICAgICAgICAgICBlbHNl\nIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAgICAgICAg\nICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFN1YnNlbGVj\ndCgoU3RyaW5nKSBhY3Rpb24uZGF0YSk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKGFjdGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VORF9WQVIpIHsKICAgICAgICAg\nICAgICAgIC8vIHVuYm91bmQgdmFycyBhcmUgY3Jvc3Mtam9pbmVkIHRvIHRo\nZSBjYW5kaWRhdGUgdGFibGUKICAgICAgICAgICAgICAgIHZhciA9IChWYXJp\nYWJsZSkgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAgICByZWwgPSAoQ2xh\nc3NNYXBwaW5nKSB2YXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgICAg\nIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5zZXRWYXJpYWJsZSh2YXIu\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBz\ndGF0ZS5qb2lucy5jcm9zc0pvaW4oX2NhbmRpZGF0ZS5nZXRUYWJsZSgpLCAK\nICAgICAgICAgICAgICAgICAgICByZWwuZ2V0VGFibGUoKSk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBtb3ZlIHBhc3QgdGhl\nIHByZXZpb3VzIGZpZWxkLCBpZiBhbnkKICAgICAgICAgICAgICAgIGZpZWxk\nID0gKEZpZWxkTWFwcGluZykgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAg\nICBpZiAocHN0YXRlLmZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBpZiB0aGlzIGlzIHRoZSBzZWNvbmQtdG8tbGFzdCBmaWVsZCBh\nbmQgdGhlIGxhc3QgaXMKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcmVs\nYXRlZCBmaWVsZCB0aGlzIGZpZWxkIGpvaW5zIHRvLCBubyBuZWVkIHRvCiAg\nICAgICAgICAgICAgICAgICAgLy8gdHJhdmVyc2U6IGp1c3QgdXNlIHRoaXMg\nZmllbGQncyBmayBjb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgaWYgKCFp\ndHIuaGFzTmV4dCgpICYmIChmbGFncyAmIEpPSU5fUkVMKSA9PSAwCiAgICAg\nICAgICAgICAgICAgICAgICAgICYmIGlzSm9pbmVkRmllbGQocHN0YXRlLmZp\nZWxkLCBrZXksIGZpZWxkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBw\nc3RhdGUuY21wZmllbGQgPSBmaWVsZDsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIHJlbCA9IHRyYXZlcnNlRmllbGQocHN0YXRlLCBrZXksIGZvcmNl\nT3V0ZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAvLyBtYXJrIGlmIHRoZSBuZXh0IHRyYXZlcnNhbCBzaG91bGQgZ28g\ndGhyb3VnaAogICAgICAgICAgICAgICAgLy8gdGhlIGtleSByYXRoZXIgdGhh\nbiB2YWx1ZQogICAgICAgICAgICAgICAga2V5ID0gYWN0aW9uLm9wID09IEFj\ndGlvbi5HRVRfS0VZOwogICAgICAgICAgICAgICAgZm9yY2VPdXRlciB8PSBh\nY3Rpb24ub3AgPT0gQWN0aW9uLkdFVF9PVVRFUjsKCiAgICAgICAgICAgICAg\nICAvLyBnZXQgbWFwcGluZyBmb3IgdGhlIGN1cnJlbnQgZmllbGQKICAgICAg\nICAgICAgICAgIHBzdGF0ZS5maWVsZCA9IGZpZWxkOwogICAgICAgICAgICAg\nICAgb3duZXIgPSBwc3RhdGUuZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7\nCiAgICAgICAgICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldE1hbmFnZW1l\nbnQoKSAKICAgICAgICAgICAgICAgICAgICAhPSBGaWVsZE1hcHBpbmcuTUFO\nQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vbi1wZXJzLWZpZWxkIiwgCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5maWVsZCkpOwoKICAgICAg\nICAgICAgICAgIC8vIGZpbmQgdGhlIG1vc3QtZGVyaXZlZCB0eXBlIGJldHdl\nZW4gdGhlIGRlY2xhcmVkIHJlbGF0aW9uCiAgICAgICAgICAgICAgICAvLyB0\neXBlIGFuZCB0aGUgZmllbGQncyBvd25lciwgYW5kIGpvaW4gZnJvbSB0aGF0\nIHR5cGUgdG8KICAgICAgICAgICAgICAgIC8vIHRoZSBsZXNzZXIgZGVyaXZl\nZCB0eXBlCiAgICAgICAgICAgICAgICBpZiAocmVsICE9IG93bmVyICYmIHJl\nbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbC5nZXRE\nZXNjcmliZWRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbQogICAgICAgICAgICAg\nICAgICAgICAgICAob3duZXIuZ2V0RGVzY3JpYmVkVHlwZSgpKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBmcm9tID0gb3duZXI7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHRvID0gcmVsOwogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSByZWw7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHRvID0gb3duZXI7CiAgICAgICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmb3IgKDsgZnJvbSAh\nPSBudWxsICYmIGZyb20gIT0gdG87CiAgICAgICAgICAgICAgICAgICAgICAg\nIGZyb20gPSBmcm9tLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nKQogICAgICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBmcm9t\nLmpvaW5TdXBlcmNsYXNzKHBzdGF0ZS5qb2lucywgZmFsc2UpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlm\nIChfdmFyTmFtZSAhPSBudWxsKQogICAgICAgICAgICBwc3RhdGUuam9pbnMg\nPSBwc3RhdGUuam9pbnMuc2V0VmFyaWFibGUoX3Zhck5hbWUpOwoKICAgICAg\nICAvLyBpZiB3ZSdyZSBub3QgY29tcGFyaW5nIHRvIG51bGwgb3IgZG9pbmcg\nYW4gaXNFbXB0eSwgdGhlbgogICAgICAgIC8vIGpvaW4gaW50byB0aGUgZGF0\nYSBvbiB0aGUgZmluYWwgZmllbGQ7IG9idmlvdXNseSB3ZSBjYW4ndCBkbyB0\naGVzZQogICAgICAgIC8vIGpvaW5zIHdoZW4gY29tcGFyaW5nIHRvIG51bGwg\nYi9jIHRoZSB3aG9sZSBwdXJwb3NlIGlzIHRvIHNlZQogICAgICAgIC8vIHdo\nZXRoZXIgdGhlIGpvaW5zIGV2ZW4gZXhpc3QKICAgICAgICBpZiAoKGZsYWdz\nICYgTlVMTF9DTVApID09IDApCiAgICAgICAgICAgIHRyYXZlcnNlRmllbGQo\ncHN0YXRlLCBrZXksIGZvcmNlT3V0ZXIsIHRydWUpOwogICAgICAgIHBzdGF0\nZS5qb2luZWRSZWwgPSBmYWxzZTsKICAgICAgICBpZiAoKGZsYWdzICYgSk9J\nTl9SRUwpICE9IDApCiAgICAgICAgICAgIGpvaW5SZWxhdGlvbihwc3RhdGUs\nIGtleSwgZm9yY2VPdXRlciB8fCAoZmxhZ3MgJiBGT1JDRV9PVVRFUikgIT0g\nMCwKICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICByZXR1cm4gcHN0\nYXRlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhl\nIGdpdmVuIHNvdXJjZSBmaWVsZCBqb2lucyB0byB0aGUgZ2l2ZW4gdGFyZ2V0\nIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlz\nSm9pbmVkRmllbGQoRmllbGRNYXBwaW5nIHNyYywgYm9vbGVhbiBrZXksIAog\nICAgICAgIEZpZWxkTWFwcGluZyB0YXJnZXQpIHsKICAgICAgICBWYWx1ZU1h\ncHBpbmcgdm07CiAgICAgICAgc3dpdGNoIChzcmMuZ2V0VHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAg\nIHZtID0gc3JjLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgdm0gPSAoa2V5KSA/IHNyYy5nZXRLZXlNYXBwaW5nKCkg\nOiBzcmMuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdm0g\nPSBzcmM7CiAgICAgICAgfQogICAgICAgIGlmICh2bS5nZXRKb2luRGlyZWN0\naW9uKCkgIT0gVmFsdWVNYXBwaW5nLkpPSU5fRk9SV0FSRCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIEZvcmVpZ25LZXkgZmsgPSB2bS5n\nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsgCiAgICAgICAgCiAgICAgICAgLy8gZm9y\nZWlnbiBrZXkgbXVzdCBqb2luIHRvIHRhcmdldCBjb2x1bW5zCiAgICAgICAg\nQ29sdW1uW10gcmVscyA9IGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1\nbW5bXSBwa3MgPSB0YXJnZXQuZ2V0Q29sdW1ucygpOyAKICAgICAgICBpZiAo\ncmVscy5sZW5ndGggIT0gcGtzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVscy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb2x1\nbW4ocmVsc1tpXSkgIT0gcGtzW2ldKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgog\nICAgICogRXhwcmVzc2lvbiBzdGF0ZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgUGF0aEV4cFN0YXRlCiAgICAgICAgZXh0ZW5kcyBFeHBT\ndGF0ZSB7CgogICAgICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZmllbGQgPSBu\ndWxsOwogICAgICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgY21wZmllbGQgPSBu\ndWxsOwogICAgICAgIHB1YmxpYyBDb2x1bW5bXSBjb2xzID0gbnVsbDsKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBqb2luZWRSZWwgPSBmYWxzZTsKCiAgICAg\nICAgcHVibGljIFBhdGhFeHBTdGF0ZShKb2lucyBqb2lucykgewogICAgICAg\nICAgICBzdXBlcihqb2lucyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVHJhdmVyc2UgaW50byB0aGUgcHJldmlvdXMgZmllbGQgb2YgYSBy\nZWxhdGlvbiBwYXRoLgogICAgICoKICAgICAqIEBwYXJhbSBsYXN0IHdoZXRo\nZXIgdGhpcyBpcyB0aGUgbGFzdCBmaWVsZCBpbiB0aGUgcGF0aAogICAgICog\nQHJldHVybiB0aGUgbWFwcGluZyBvZiB0aGUgcmVsYXRlZCB0eXBlLCBvciBu\ndWxsCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nIHRyYXZlcnNl\nRmllbGQoUGF0aEV4cFN0YXRlIHBzdGF0ZSwgYm9vbGVhbiBrZXksIAogICAg\nICAgIGJvb2xlYW4gZm9yY2VPdXRlciwgYm9vbGVhbiBsYXN0KSB7CiAgICAg\nICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgLy8gdHJhdmVyc2UgaW50byBmaWVsZCB2YWx1\nZQogICAgICAgIGlmIChrZXkpCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9\nIHBzdGF0ZS5maWVsZC5qb2luS2V5KHBzdGF0ZS5qb2lucywgZm9yY2VPdXRl\ncik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBw\nc3RhdGUuZmllbGQuam9pbihwc3RhdGUuam9pbnMsIGZvcmNlT3V0ZXIpOwoK\nICAgICAgICAvLyBpZiB0aGlzIGlzbid0IHRoZSBsYXN0IGZpZWxkLCB0cmF2\nZXJzZSBpbnRvIHRoZSByZWxhdGlvbgogICAgICAgIGlmICghbGFzdCkKICAg\nICAgICAgICAgam9pblJlbGF0aW9uKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVy\nLCB0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJuIHRoZSBtYXBpbmcgb2YgdGhl\nIHJlbGF0ZWQgdHlwZSwgaWYgYW55CiAgICAgICAgaWYgKGtleSkKICAgICAg\nICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0\nVHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVs\nZW1lbnQoKS5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAg\nICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVs\nZC5nZXRUeXBlTWFwcGluZygpOwogICAgfQoKICAgIC8qKgogICAgICogSm9p\nbiBpbnRvIHRoZSByZWxhdGlvbiByZXByZXNlbnRlZCBieSB0aGUgY3VycmVu\ndCBmaWVsZCwgaWYgYW55LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgam9p\nblJlbGF0aW9uKFBhdGhFeHBTdGF0ZSBwc3RhdGUsIGJvb2xlYW4ga2V5LCAK\nICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIsIGJvb2xlYW4gdHJhdmVyc2Up\nIHsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoa2V5KQogICAgICAgICAgICBwc3Rh\ndGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pbktleVJlbGF0aW9uKHBzdGF0\nZS5qb2lucywgCiAgICAgICAgICAgICAgICBmb3JjZU91dGVyLCB0cmF2ZXJz\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBw\nc3RhdGUuZmllbGQuam9pblJlbGF0aW9uKHBzdGF0ZS5qb2lucywgZm9yY2VP\ndXRlciwKICAgICAgICAgICAgICAgIHRyYXZlcnNlKTsKICAgICAgICBwc3Rh\ndGUuam9pbmVkUmVsID0gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIHRvRGF0YVN0b3JlVmFsdWUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgs\nIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBPYmplY3QgdmFsKSB7CiAgICAg\nICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRl\nOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZCA9IChwc3RhdGUuY21wZmll\nbGQgIT0gbnVsbCkgPyBwc3RhdGUuY21wZmllbGQgCiAgICAgICAgICAgIDog\ncHN0YXRlLmZpZWxkOwogICAgICAgIGlmIChmaWVsZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChfa2V5KQogICAgICAgICAgICAgICAgcmV0dXJuIGZp\nZWxkLnRvS2V5RGF0YVN0b3JlVmFsdWUodmFsLCBjdHguc3RvcmUpOwogICAg\nICAgICAgICBpZiAoZmllbGQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSAhPSBKYXZhVHlwZXMuT0JKRUNUKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZpZWxkLnRvRGF0YVN0b3JlVmFsdWUodmFsLCBjdHguc3RvcmUp\nOwoKICAgICAgICAgICAgdmFsID0gZmllbGQuZ2V0RXh0ZXJuYWxWYWx1ZSh2\nYWwsIGN0eC5zdG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAgICAgICByZXR1\ncm4gZmllbGQudG9EYXRhU3RvcmVWYWx1ZSh2YWwsIGN0eC5zdG9yZSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfY2xhc3MudG9EYXRhU3RvcmVWYWx1\nZSh2YWwsIF9jbGFzcy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLAogICAgICAg\nICAgICBjdHguc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUs\nIAogICAgICAgIGJvb2xlYW4gcGtzKSB7CiAgICAgICAgc2VsZWN0Q29sdW1u\ncyhzZWwsIGN0eCwgc3RhdGUsIHBrcyk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VsZWN0Q29sdW1ucyhTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gcGtzKSB7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSBnZXRDbGFzc01hcHBpbmcoc3Rh\ndGUpOwogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0\nYXRlKSBzdGF0ZTsKICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8ICFw\nc3RhdGUuam9pbmVkUmVsKQogICAgICAgICAgICBzZWwuc2VsZWN0KGdldENv\nbHVtbnMoc3RhdGUpLCBwc3RhdGUuam9pbnMpOwogICAgICAgIGVsc2UgaWYg\nKHBrcykKICAgICAgICAgICAgc2VsLnNlbGVjdChtYXBwaW5nLmdldFByaW1h\ncnlLZXlDb2x1bW5zKCksIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZzsgYWxsb3cgYW55\nIHN1YnMgYmVjYXVzZSB3ZSBrbm93IHRoaXMgbXVzdAogICAgICAgICAgICAv\nLyBiZSBlaXRoZXIgYSByZWxhdGlvbiwgaW4gd2hpY2ggY2FzZSBpdCB3aWxs\nIGFscmVhZHkgYmUKICAgICAgICAgICAgLy8gY29uc3RyYWluZWQgYnkgdGhl\nIGpvaW5zLCBvciAndGhpcycsIGluIHdoaWNoIGNhc2UgdGhlCiAgICAgICAg\nICAgIC8vIEpEQkNFeHByZXNzaW9uRmFjdG9yeSB0YWtlcyBjYXJlIG9mIGFk\nZGluZyBjbGFzcyBjb25kaXRpb25zIGZvcgogICAgICAgICAgICAvLyB0aGUg\nY2FuZGlkYXRlIGNsYXNzIG9uIHRoZSBzZWxlY3QKICAgICAgICAgICAgaW50\nIHN1YnMgPSAoX3R5cGUgPT0gVU5CT1VORF9WQVIpID8gU2VsZWN0LlNVQlNf\nSk9JTkFCTEUKICAgICAgICAgICAgICAgIDogU2VsZWN0LlNVQlNfQU5ZX0pP\nSU5BQkxFOwogICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBpbmcsIHN1YnMs\nIGN0eC5zdG9yZSwgY3R4LmZldGNoLAogICAgICAgICAgICAgICAgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FLCBzZWwub3V0ZXIocHN0YXRl\nLmpvaW5zKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdy\nb3VwQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0\nYXRlKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSBnZXRDbGFz\nc01hcHBpbmcoc3RhdGUpOwogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAobWFwcGluZyA9\nPSBudWxsIHx8ICFwc3RhdGUuam9pbmVkUmVsKQogICAgICAgICAgICBzZWwu\nZ3JvdXBCeShnZXRDb2x1bW5zKHN0YXRlKSwgc2VsLm91dGVyKHBzdGF0ZS5q\nb2lucykpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBpbnQgc3VicyA9\nIChfdHlwZSA9PSBVTkJPVU5EX1ZBUikgPyBTZWxlY3QuU1VCU19KT0lOQUJM\nRQogICAgICAgICAgICAgICAgOiBTZWxlY3QuU1VCU19BTllfSk9JTkFCTEU7\nCiAgICAgICAgICAgIHNlbC5ncm91cEJ5KG1hcHBpbmcsIHN1YnMsIGN0eC5z\ndG9yZSwgY3R4LmZldGNoLCAKICAgICAgICAgICAgICAgIHNlbC5vdXRlcihw\nc3RhdGUuam9pbnMpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgb3JkZXJCeShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgc2Vs\nLm9yZGVyQnkoZ2V0Q29sdW1ucyhzdGF0ZSksIGFzYywgc2VsLm91dGVyKHN0\nYXRlLmpvaW5zKSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\nbG9hZChFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIFJlc3VsdCBy\nZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGxvYWQoY3R4LCBzdGF0ZSwgcmVzLCBmYWxzZSk7CiAgICB9CgogICAg\nT2JqZWN0IGxvYWQoRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCBS\nZXN1bHQgcmVzLCBib29sZWFuIHBrcykKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IGdldENs\nYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0\nZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChtYXBwaW5n\nICE9IG51bGwgJiYgKHBzdGF0ZS5maWVsZCA9PSBudWxsIAogICAgICAgICAg\nICB8fCAhcHN0YXRlLmZpZWxkLmlzRW1iZWRkZWQoKSkpIHsKICAgICAgICAg\nICAgaWYgKHBrcykKICAgICAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLmdl\ndE9iamVjdElkKGN0eC5zdG9yZSwgcmVzLCBudWxsLCB0cnVlLCAKICAgICAg\nICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgICAgICAgICByZXR1\ncm4gcmVzLmxvYWQobWFwcGluZywgY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHBz\ndGF0ZS5qb2lucyk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QgcmV0Owog\nICAgICAgIGlmIChfa2V5KQogICAgICAgICAgICByZXQgPSBwc3RhdGUuZmll\nbGQubG9hZEtleVByb2plY3Rpb24oY3R4LnN0b3JlLCBjdHguZmV0Y2gsIHJl\ncywgCiAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgcmV0ID0gcHN0YXRlLmZpZWxkLmxvYWRQcm9qZWN0\naW9uKGN0eC5zdG9yZSwgY3R4LmZldGNoLCByZXMsIAogICAgICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zKTsKICAgICAgICBpZiAoX2Nhc3QgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0ID0gRmlsdGVycy5jb252ZXJ0KHJldCwgX2Nhc3Qp\nOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nY2FsY3VsYXRlVmFsdWUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4\ncFN0YXRlIHN0YXRlLCAKICAgICAgICBWYWwgb3RoZXIsIEV4cFN0YXRlIG90\naGVyU3RhdGUpIHsKICAgICAgICAvLyB3ZSBkb24ndCBjcmVhdGUgdGhlIFNR\nTCBiL2MgaXQgZm9yY2VzIHRoZSBTZWxlY3QgdG8gY2FjaGUgYWxpYXNlcwog\nICAgICAgIC8vIGZvciB0aGUgdGFibGVzIHdlIHVzZSwgYW5kIHRoZXNlIGFs\naWFzZXMgbWlnaHQgbm90IGV2ZXIgYmUgdXNlZCBpZgogICAgICAgIC8vIHdl\nIGV2ZW50dWFsbHkgY2FsbCBhcHBlbmRJc0VtcHR5IG9yIGFwcGVuZElzTnVs\nbCByYXRoZXIgdGhhbiBhcHBlbmRUbwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nbGVuZ3RoKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBz\ndGF0ZSkgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5zKHN0YXRlKS5sZW5n\ndGg7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kVG8oU2VsZWN0IHNl\nbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBT\nUUxCdWZmZXIgc3FsLCBpbnQgaW5kZXgpIHsKICAgICAgICBDb2x1bW4gY29s\nID0gZ2V0Q29sdW1ucyhzdGF0ZSlbaW5kZXhdOwoKICAgICAgICAvLyBpZiBz\nZWxlY3QgaXMgbnVsbCwgaXQgbWVhbnMgd2UgYXJlIG5vdCBhbGlhc2luZyBj\nb2x1bW5zCiAgICAgICAgLy8gKGUuZy4sIGR1cmluZyBhIGJ1bGsgdXBkYXRl\nKQogICAgICAgIGlmIChzZWwgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFw\ncGVuZChjb2wuZ2V0TmFtZSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHNxbC5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbCwgc3RhdGUuam9p\nbnMpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc0VtcHR5KFNl\nbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAg\nICAgICAgU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBw\nc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0\nYXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoRkFM\nU0UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFw\ncGVuZElzRW1wdHkoc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYXBwZW5kSXNOb3RFbXB0eShTZWxlY3Qgc2VsLCBF\neHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1\nZmZlciBzcWwpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBh\ndGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9\nPSBudWxsKQogICAgICAgICAgICBzcWwuYXBwZW5kKEZBTFNFKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc05vdEVt\ncHR5KHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGFwcGVuZFNpemUoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgs\nIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAg\nICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0\nYXRlOwogICAgICAgIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAg\nICAgICAgc3FsLmFwcGVuZCgiMSIpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgcHN0YXRlLmZpZWxkLmFwcGVuZFNpemUoc3FsLCBzZWwsIHBzdGF0ZS5q\nb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNOdWxsKFNl\nbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAg\nICAgICAgU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBw\nc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0\nYXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoRkFM\nU0UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFw\ncGVuZElzTnVsbChzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBhcHBlbmRJc05vdE51bGwoU2VsZWN0IHNlbCwgRXhw\nQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBTUUxCdWZm\nZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRo\nRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUuZmllbGQgPT0g\nbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVuZChUUlVFKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc05vdE51bGwo\nc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9CgogICAgcHVibGljIGlu\ndCBoYXNoQ29kZSgpIHsKICAgICAgICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGUuaGFzaENvZGUoKTsKICAg\nICAgICByZXR1cm4gX2NhbmRpZGF0ZS5oYXNoQ29kZSgpIF4gX2FjdGlvbnMu\naGFzaENvZGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMo\nT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICghKG90aGVyIGlu\nc3RhbmNlb2YgUENQYXRoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIFBDUGF0aCBwYXRoID0gKFBDUGF0aCkgb3RoZXI7CiAgICAgICAg\ncmV0dXJuIE9iamVjdFV0aWxzLmVxdWFscyhfY2FuZGlkYXRlLCBwYXRoLl9j\nYW5kaWRhdGUpCiAgICAgICAgICAgICYmIE9iamVjdFV0aWxzLmVxdWFscyhf\nYWN0aW9ucywgcGF0aC5fYWN0aW9ucyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBIZWxwZXIgY2xhc3MgcmVwcmVzZW50aW5nIGFuIGFjdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQWN0aW9uIHsKCiAgICAgICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgR0VUID0gMDsKICAgICAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBHRVRfT1VURVIgPSAxOwogICAgICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IEdFVF9LRVkgPSAyOwogICAgICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IFZBUiA9IDM7CiAgICAgICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgU1VCUVVFUlkgPSA0OwogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IFVOQk9VTkRfVkFSID0gNTsKICAgICAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBDQVNUID0gNjsKCiAgICAgICAgcHVi\nbGljIGludCBvcCA9IC0xOwogICAgICAgIHB1YmxpYyBPYmplY3QgZGF0YSA9\nIG51bGw7CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAg\nICAgICAgICAgIHJldHVybiBvcCArICJ8IiArIGRhdGE7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBp\nZiAoZGF0YSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG9wOwog\nICAgICAgICAgICByZXR1cm4gb3AgXiBkYXRhLmhhc2hDb2RlKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90\naGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIEFjdGlvbiBhID0g\nKEFjdGlvbikgb3RoZXI7CiAgICAgICAgICAgIHJldHVybiBvcCA9PSBhLm9w\nCiAgICAgICAgICAgICAgICAmJiBPYmplY3RVdGlscy5lcXVhbHMoZGF0YSwg\nYS5kYXRhKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

