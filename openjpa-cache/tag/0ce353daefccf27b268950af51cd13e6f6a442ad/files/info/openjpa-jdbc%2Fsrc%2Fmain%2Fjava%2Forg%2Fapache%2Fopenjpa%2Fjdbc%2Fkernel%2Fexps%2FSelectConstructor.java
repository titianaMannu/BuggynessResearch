{"sha":"90269cbf6a33ea449056e87978ae367908e4d890","node_id":"MDQ6QmxvYjIwNjM2NDo5MDI2OWNiZjZhMzNlYTQ0OTA1NmU4Nzk3OGFlMzY3OTA4ZTRkODkw","size":14091,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/90269cbf6a33ea449056e87978ae367908e4d890","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzOwoKaW1wb3J0IGphdmEudXRpbC5I\nYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BYnN0cmFjdEV4cHJlc3Np\nb25WaXNpdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLkNvbnN0YW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLkV4cHJlc3Npb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZTsKCi8qKgogKiBUdXJucyBw\nYXJzZWQgcXVlcmllcyBpbnRvIHNlbGVjdHMuCiAqCiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBTZWxlY3RD\nb25zdHJ1Y3RvciB7CgogICAgcHJpdmF0ZSBib29sZWFuIF9leHRlbnQgPSBm\nYWxzZTsKCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHdlIGtub3cg\ndGhlIHNlbGVjdCB0byBoYXZlIG9uIGNyaXRlcmlhOyB0byBiZSBhbiBleHRl\nbnQuCiAgICAgKiBOb3RlIHRoYXQgZXZlbiBpZiB0aGlzIG1ldGhvZCByZXR1\ncm5zIGZhbHNlLCB7QGxpbmsgI2V2YWx1YXRlfSBtYXkgc3RpbGwKICAgICAq\nIHJldHVybiBudWxsIGlmIHdlIGhhdmVuJ3QgY2FjaGVkIHdoZXRoZXIgdGhl\nIHF1ZXJ5IGlzIGFuIGV4dGVudCB5ZXQuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGlzRXh0ZW50KCkgewogICAgICAgIHJldHVybiBfZXh0ZW50Owog\nICAgfQoKICAgIC8qKgogICAgICogRXZhbHVhdGUgdGhlIGV4cHJlc3Npb24s\nIHJldHVybmluZyBhIG5ldyBzZWxlY3QgYW5kIGZpbGxpbmcgaW4gYW55CiAg\nICAgKiBhc3NvY2lhdGVkIGV4cHJlc3Npb24gc3RhdGUuIFVzZSB7QGxpbmsg\nI3NlbGVjdH0gdG8gdGhlbiBzZWxlY3QgdGhlIGRhdGEuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBjdHggZmlsbCB3aXRoIGV4ZWN1dGlvbiBjb250ZXh0CiAg\nICAgKiBAcGFyYW0gc3RhdGUgd2lsbCBiZSBmaWxsZWQgd2l0aCBleHByZXNz\naW9uIHN0YXRlCiAgICAgKi8KICAgIHB1YmxpYyBTZWxlY3QgZXZhbHVhdGUo\nRXhwQ29udGV4dCBjdHgsIFNlbGVjdCBwYXJlbnQsIFN0cmluZyBhbGlhcywg\nCiAgICAgICAgUXVlcnlFeHByZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJlc3Np\nb25zU3RhdGUgc3RhdGUpIHsKICAgICAgICAvLyBhbHJlYWR5IGtub3cgdGhh\ndCB0aGlzIHF1ZXJ5IGlzIGVxdWl2YWxlbnQgdG8gYW4gZXh0ZW50PwogICAg\nICAgIFNlbGVjdCBzZWw7CiAgICAgICAgaWYgKF9leHRlbnQpIHsKICAgICAg\nICAgICAgc2VsID0gY3R4LnN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdTZWxl\nY3QoKTsKICAgICAgICAgICAgc2VsLnNldEF1dG9EaXN0aW5jdCgoZXhwcy5k\naXN0aW5jdCAmIGV4cHMuRElTVElOQ1RfQVVUTykgIT0gMCk7CiAgICAgICAg\nICAgIHJldHVybiBzZWw7CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUg\nYSBuZXcgc2VsZWN0IGFuZCBpbml0aWFsaXplIGl0IHdpdGggdGhlIGpvaW5z\nIG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGUgY3JpdGVyaWEgb2YgdGhpcyBx\ndWVyeQogICAgICAgIHNlbCA9IG5ld1NlbGVjdChjdHgsIHBhcmVudCwgYWxp\nYXMsIGV4cHMsIHN0YXRlKTsKCiAgICAgICAgLy8gY3JlYXRlIHdoZXJlIGNs\nYXVzZTsgaWYgdGhlcmUgYXJlIG5vIHdoZXJlIGNvbmRpdGlvbnMgYW5kCiAg\nICAgICAgLy8gbm8gb3JkZXJpbmcgb3IgcHJvamVjdGlvbnMsIHdlIHJldHVy\nbiBudWxsIHRvIHNpZ25pZnkgdGhhdCB0aGlzCiAgICAgICAgLy8gcXVlcnkg\nc2hvdWxkIGJlIHRyZWF0ZWQgbGlrZSBhbiBleHRlbnQKICAgICAgICBTZWxl\nY3QgaW5uZXIgPSBzZWwuZ2V0RnJvbVNlbGVjdCgpOwogICAgICAgIFNRTEJ1\nZmZlciB3aGVyZSA9IGJ1aWxkV2hlcmUoKGlubmVyICE9IG51bGwpID8gaW5u\nZXIgOiBzZWwsIGN0eCwgCiAgICAgICAgICAgIHN0YXRlLmZpbHRlciwgZXhw\ncy5maWx0ZXIpOwogICAgICAgIGlmICh3aGVyZSA9PSBudWxsICYmIGV4cHMu\ncHJvamVjdGlvbnMubGVuZ3RoID09IDAKICAgICAgICAgICAgJiYgZXhwcy5v\ncmRlcmluZy5sZW5ndGggPT0gMAogICAgICAgICAgICAmJiAoc2VsLmdldEpv\naW5zKCkgPT0gbnVsbCB8fCBzZWwuZ2V0Sm9pbnMoKS5pc0VtcHR5KCkpKSB7\nCiAgICAgICAgICAgIF9leHRlbnQgPSB0cnVlOwogICAgICAgICAgICBzZWwu\nc2V0QXV0b0Rpc3RpbmN0KChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5D\nVF9BVVRPKSAhPSAwKTsKICAgICAgICAgICAgcmV0dXJuIHNlbDsKICAgICAg\nICB9CgogICAgICAgIC8vIG5vdyBzZXQgc3FsIGNyaXRlcmlhOyBpdCBnb2Vz\nIG9uIHRoZSBpbm5lciBzZWxlY3QgaWYgcHJlc2VudAogICAgICAgIGlmIChp\nbm5lciAhPSBudWxsKQogICAgICAgICAgICBpbm5lci53aGVyZSh3aGVyZSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWwud2hlcmUod2hlcmUpOwoK\nICAgICAgICAvLyBhcHBseSBncm91cGluZyBhbmQgaGF2aW5nLiAgdGhpcyBk\nb2VzIG5vdCBzZWxlY3QgdGhlIGdyb3VwaW5nCiAgICAgICAgLy8gY29sdW1u\ncywganVzdCBidWlsZHMgdGhlIEdST1VQIEJZIGNsYXVzZXMuICB3ZSBkb24n\ndCBidWlsZCB0aGUKICAgICAgICAvLyBPUkRFUiBCWSBjbGF1c2VzIHlldCBi\nZWNhdXNlIGlmIHdlIGRlY2lkZSB0byBhZGQgdGhpcyBzZWxlY3QKICAgICAg\nICAvLyB0byBhIHVuaW9uLCB0aGUgT1JERVIgQlkgdmFsdWVzIGdldCBhbGlh\nc2VkIGRpZmZlcmVudGx5CiAgICAgICAgaWYgKGV4cHMuaGF2aW5nICE9IG51\nbGwpIHsKICAgICAgICAgICAgRXhwIGhhdmluZ0V4cCA9IChFeHApIGV4cHMu\naGF2aW5nOwogICAgICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1\nZmZlcihjdHguc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAgICAg\nICBoYXZpbmdFeHAuYXBwZW5kVG8oc2VsLCBjdHgsIHN0YXRlLmhhdmluZywg\nYnVmKTsKICAgICAgICAgICAgc2VsLmhhdmluZyhidWYpOwogICAgICAgIH0K\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMuZ3JvdXBpbmcubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICgoVmFsKSBleHBzLmdyb3VwaW5nW2ld\nKS5ncm91cEJ5KHNlbCwgY3R4LCBzdGF0ZS5ncm91cGluZ1tpXSk7CiAgICAg\nICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIG5ldyBzZWxlY3Qgd2l0aCBleHByZXNzaW9ucyBpbml0aWFsaXplZC4KICAg\nICAqLwogICAgcHJpdmF0ZSBTZWxlY3QgbmV3U2VsZWN0KEV4cENvbnRleHQg\nY3R4LCBTZWxlY3QgcGFyZW50LAogICAgICAgIFN0cmluZyBhbGlhcywgUXVl\ncnlFeHByZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJlc3Npb25zU3RhdGUgc3Rh\ndGUpIHsKICAgICAgICBTZWxlY3Qgc2VsID0gY3R4LnN0b3JlLmdldFNRTEZh\nY3RvcnkoKS5uZXdTZWxlY3QoKTsKICAgICAgICBzZWwuc2V0QXV0b0Rpc3Rp\nbmN0KChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9BVVRPKSAhPSAw\nKTsKICAgICAgICBzZWwuc2V0Sm9pblN5bnRheChjdHguZmV0Y2guZ2V0Sm9p\nblN5bnRheCgpKTsKICAgICAgICBzZWwuc2V0UGFyZW50KHBhcmVudCwgYWxp\nYXMpOwogICAgICAgIGluaXRpYWxpemUoc2VsLCBjdHgsIGV4cHMsIHN0YXRl\nKTsKCiAgICAgICAgaWYgKCFzZWwuZ2V0QXV0b0Rpc3RpbmN0KCkpIHsKICAg\nICAgICAgICAgaWYgKChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9U\nUlVFKSAhPSAwKQogICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KHRy\ndWUpOwogICAgICAgICAgICBlbHNlIGlmICgoZXhwcy5kaXN0aW5jdCAmIGV4\ncHMuRElTVElOQ1RfRkFMU0UpICE9IDApCiAgICAgICAgICAgICAgICBzZWwu\nc2V0RGlzdGluY3QoZmFsc2UpOwogICAgICAgIH0gZWxzZSBpZiAoZXhwcy5w\ncm9qZWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGlmICghc2Vs\nLmlzRGlzdGluY3QoKSAmJiAoZXhwcy5kaXN0aW5jdCAmIGV4cHMuRElTVElO\nQ1RfVFJVRSkgIT0gMCl7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgc2Vs\nZWN0IGlzIG5vdCBkaXN0aW5jdCBidXQgdGhlIHF1ZXJ5IGlzLCBmb3JjZQog\nICAgICAgICAgICAgICAgLy8gdGhlIHNlbGVjdCB0byBiZSBkaXN0aW5jdAog\nICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KHRydWUpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHNlbC5pc0Rpc3RpbmN0KCkpIHsKICAgICAgICAg\nICAgICAgIC8vIHdoZW4gYWdncmVnYXRpbmcgZGF0YSBvciBtYWtpbmcgYSBu\nb24tZGlzdGluY3QgcHJvamVjdGlvbgogICAgICAgICAgICAgICAgLy8gZnJv\nbSBhIGRpc3RpbmN0IHNlbGVjdCwgd2UgaGF2ZSB0byBzZWxlY3QgZnJvbSBh\nIHRtcAogICAgICAgICAgICAgICAgLy8gdGFibGUgZm9ybWVkIGJ5IGEgZGlz\ndGluY3Qgc3Vic2VsZWN0IGluIHRoZSBmcm9tIGNsYXVzZTsKICAgICAgICAg\nICAgICAgIC8vIHRoaXMgc3Vic2VsZWN0IHNlbGVjdHMgdGhlIHBrcyBvZiB0\naGUgY2FuZGlkYXRlICh0bwogICAgICAgICAgICAgICAgLy8gZ2V0IHVuaXF1\nZSBjYW5kaWRhdGUgdmFsdWVzKSBhbmQgbmVlZGVkIGZpZWxkIHZhbHVlcyBh\nbmQKICAgICAgICAgICAgICAgIC8vIGFwcGxpZXMgdGhlIHdoZXJlIGNvbmRp\ndGlvbnM7IHRoZSBvdXRlciBzZWxlY3QgYXBwbGllcwogICAgICAgICAgICAg\nICAgLy8gb3JkZXJpbmcsIGdyb3VwaW5nLCBldGMKICAgICAgICAgICAgICAg\nIGJvb2xlYW4gYWdnID0gZXhwcy5pc0FnZ3JlZ2F0ZSgpOwogICAgICAgICAg\nICAgICAgYm9vbGVhbiBjYW5kaWRhdGUgPSBQcm9qZWN0aW9uRXhwcmVzc2lv\nblZpc2l0b3IuCiAgICAgICAgICAgICAgICAgICAgaGFzQ2FuZGlkYXRlUHJv\namVjdGlvbnMoZXhwcy5wcm9qZWN0aW9ucyk7CiAgICAgICAgICAgICAgICBp\nZiAoYWdnIHx8IChjYW5kaWRhdGUgCiAgICAgICAgICAgICAgICAgICAgJiYg\nKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX1RSVUUpID09IDApKSB7\nCiAgICAgICAgICAgICAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBjdHgu\nc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAgICAgICAgICAgICAg\nZGljdC5hc3NlcnRTdXBwb3J0KGRpY3Quc3VwcG9ydHNTdWJzZWxlY3QsCiAg\nICAgICAgICAgICAgICAgICAgICAgICJTdXBwb3J0c1N1YnNlbGVjdCIpOwoK\nICAgICAgICAgICAgICAgICAgICBTZWxlY3QgaW5uZXIgPSBzZWw7CiAgICAg\nICAgICAgICAgICAgICAgc2VsID0gY3R4LnN0b3JlLmdldFNRTEZhY3Rvcnko\nKS5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0UGFy\nZW50KHBhcmVudCwgYWxpYXMpOwogICAgICAgICAgICAgICAgICAgIHNlbC5z\nZXREaXN0aW5jdChhZ2cKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKGV4\ncHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX1RSVUUpICE9IDApOwogICAg\nICAgICAgICAgICAgICAgIHNlbC5zZXRGcm9tU2VsZWN0KGlubmVyKTsKCiAg\nICAgICAgICAgICAgICAvLyBhdXRvLWRpc3RpbmN0aW5nIGhhcHBlbnMgdG8g\nZ2V0IHVuaXF1ZSBjYW5kaWRhdGUgaW5zdGFuY2VzCiAgICAgICAgICAgICAg\nICAvLyBiYWNrOyBkb24ndCBhdXRvLWRpc3RpbmN0IGlmIHRoZSB1c2VyIGlz\nbid0IHNlbGVjdGluZyAKICAgICAgICAgICAgICAgIC8vIGNhbmRpZGF0ZSBk\nYXRhCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFjYW5kaWRhdGUgCiAg\nICAgICAgICAgICAgICAgICAgJiYgKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJ\nU1RJTkNUX1RSVUUpID09IDApIAogICAgICAgICAgICAgICAgICAgIHNlbC5z\nZXREaXN0aW5jdChmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHNlbDsKICAgIH0KCiAgICAvKioKICAgICAqIEluaXRp\nYWxpemUgYWxsIGV4cHJlc3Npb25zLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgaW5pdGlhbGl6ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgUXVl\ncnlFeHByZXNzaW9ucyBleHBzLCAKICAgICAgICBRdWVyeUV4cHJlc3Npb25z\nU3RhdGUgc3RhdGUpIHsKICAgICAgICBNYXAgY29udGFpbnMgPSBudWxsOwog\nICAgICAgIGlmIChIYXNDb250YWluc0V4cHJlc3Npb25WaXNpdG9yLmhhc0Nv\nbnRhaW5zKGV4cHMuZmlsdGVyKQogICAgICAgICAgICB8fCBIYXNDb250YWlu\nc0V4cHJlc3Npb25WaXNpdG9yLmhhc0NvbnRhaW5zKGV4cHMuaGF2aW5nKSkK\nICAgICAgICAgICAgY29udGFpbnMgPSBuZXcgSGFzaE1hcCg3KTsKCiAgICAg\nICAgLy8gaW5pdGlhbGl6ZSBmaWx0ZXIgYW5kIGhhdmluZyBleHByZXNzaW9u\ncwogICAgICAgIEV4cCBmaWx0ZXJFeHAgPSAoRXhwKSBleHBzLmZpbHRlcjsK\nICAgICAgICBzdGF0ZS5maWx0ZXIgPSBmaWx0ZXJFeHAuaW5pdGlhbGl6ZShz\nZWwsIGN0eCwgY29udGFpbnMpOwogICAgICAgIEV4cCBoYXZpbmdFeHAgPSAo\nRXhwKSBleHBzLmhhdmluZzsKICAgICAgICBpZiAoaGF2aW5nRXhwICE9IG51\nbGwpCiAgICAgICAgICAgIHN0YXRlLmhhdmluZyA9IGhhdmluZ0V4cC5pbml0\naWFsaXplKHNlbCwgY3R4LCBjb250YWlucyk7CgogICAgICAgIC8vIGdldCB0\naGUgdG9wLWxldmVsIGpvaW5zIGFuZCBudWxsIHRoZSBleHByZXNzaW9uJ3Mg\nam9pbnMKICAgICAgICAvLyBhdCB0aGUgc2FtZSB0aW1lIHNvIHRoZXkgYXJl\nbid0IGluY2x1ZGVkIGluIHRoZSB3aGVyZS9oYXZpbmcgU1FMCiAgICAgICAg\nSm9pbnMgZmlsdGVySm9pbnMgPSBzdGF0ZS5maWx0ZXIuam9pbnM7CiAgICAg\nICAgSm9pbnMgaGF2aW5nSm9pbnMgPSAoc3RhdGUuaGF2aW5nID09IG51bGwp\nID8gbnVsbCA6IHN0YXRlLmhhdmluZy5qb2luczsKICAgICAgICBKb2lucyBq\nb2lucyA9IHNlbC5hbmQoZmlsdGVySm9pbnMsIGhhdmluZ0pvaW5zKTsKCiAg\nICAgICAgLy8gaW5pdGlhbGl6ZSByZXN1bHQgdmFsdWVzCiAgICAgICAgaWYg\nKGV4cHMucHJvamVjdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBz\ndGF0ZS5wcm9qZWN0aW9ucyA9IG5ldyBFeHBTdGF0ZVtleHBzLnByb2plY3Rp\nb25zLmxlbmd0aF07CiAgICAgICAgICAgIFZhbCByZXN1bHRWYWw7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXhwcy5wcm9qZWN0aW9ucy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcmVzdWx0VmFsID0gKFZh\nbCkgZXhwcy5wcm9qZWN0aW9uc1tpXTsKICAgICAgICAgICAgICAgIC8vIGhh\ndmUgdG8gam9pbiB0aHJvdWdoIHRvIHJlbGF0ZWQgdHlwZSBmb3IgcGMgb2Jq\nZWN0IAogICAgICAgICAgICAgICAgLy8gcHJvamVjdGlvbnM7IHRoaXMgZW5z\ndXJlcyB0aGF0IHdlIGhhdmUgYWxsIG91ciBqb2lucyBjYWNoZWQKICAgICAg\nICAgICAgICAgIHN0YXRlLnByb2plY3Rpb25zW2ldID0gcmVzdWx0VmFsLmlu\naXRpYWxpemUoc2VsLCBjdHgsIAogICAgICAgICAgICAgICAgICAgIFZhbC5K\nT0lOX1JFTCB8IFZhbC5GT1JDRV9PVVRFUik7CiAgICAgICAgICAgICAgICBq\nb2lucyA9IHNlbC5hbmQoam9pbnMsIHN0YXRlLnByb2plY3Rpb25zW2ldLmpv\naW5zKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaW5p\ndGlhbGl6ZSBncm91cGluZwogICAgICAgIGlmIChleHBzLmdyb3VwaW5nLmxl\nbmd0aCA+IDApIHsKICAgICAgICAgICAgc3RhdGUuZ3JvdXBpbmcgPSBuZXcg\nRXhwU3RhdGVbZXhwcy5ncm91cGluZy5sZW5ndGhdOwogICAgICAgICAgICBW\nYWwgZ3JvdXBWYWw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZXhwcy5ncm91cGluZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nZ3JvdXBWYWwgPSAoVmFsKSBleHBzLmdyb3VwaW5nW2ldOwogICAgICAgICAg\nICAgICAgLy8gaGF2ZSB0byBqb2luIHRocm91Z2ggdG8gcmVsYXRlZCB0eXBl\nIGZvciBwYyBvYmplY3QgZ3JvdXBpbmdzOwogICAgICAgICAgICAgICAgLy8g\ndGhpcyBlbnN1cmVzIHRoYXQgd2UgaGF2ZSBhbGwgb3VyIGpvaW5zIGNhY2hl\nZAogICAgICAgICAgICAgICAgc3RhdGUuZ3JvdXBpbmdbaV0gPSBncm91cFZh\nbC5pbml0aWFsaXplKHNlbCwgY3R4LCBWYWwuSk9JTl9SRUwpOwogICAgICAg\nICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5zLCBzdGF0ZS5ncm91cGlu\nZ1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIGluaXRpYWxpemUgb3JkZXJpbmcKICAgICAgICBpZiAoZXhwcy5vcmRl\ncmluZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHN0YXRlLm9yZGVyaW5n\nID0gbmV3IEV4cFN0YXRlW2V4cHMub3JkZXJpbmcubGVuZ3RoXTsKICAgICAg\nICAgICAgVmFsIG9yZGVyVmFsOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGV4cHMub3JkZXJpbmcubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIG9yZGVyVmFsID0gKFZhbCkgZXhwcy5vcmRlcmluZ1tpXTsKICAg\nICAgICAgICAgICAgIHN0YXRlLm9yZGVyaW5nW2ldID0gb3JkZXJWYWwuaW5p\ndGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAgICAgICBqb2lucyA9\nIHNlbC5hbmQoam9pbnMsIHN0YXRlLm9yZGVyaW5nW2ldLmpvaW5zKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzZWwud2hlcmUoam9pbnMp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSB3aGVyZSBzcWwu\nCiAgICAgKi8KICAgIHByaXZhdGUgU1FMQnVmZmVyIGJ1aWxkV2hlcmUoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAg\nICAgICBFeHByZXNzaW9uIGZpbHRlcikgewogICAgICAgIC8vIGNyZWF0ZSB3\naGVyZSBidWZmZXIKICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBuZXcgU1FM\nQnVmZmVyKGN0eC5zdG9yZS5nZXREQkRpY3Rpb25hcnkoKSk7CiAgICAgICAg\nd2hlcmUuYXBwZW5kKCIoIik7CiAgICAgICAgRXhwIGZpbHRlckV4cCA9IChF\neHApIGZpbHRlcjsKICAgICAgICBmaWx0ZXJFeHAuYXBwZW5kVG8oc2VsLCBj\ndHgsIHN0YXRlLCB3aGVyZSk7CgogICAgICAgIGlmICh3aGVyZS5zcWxFcXVh\nbHMoIigiKSB8fCB3aGVyZS5zcWxFcXVhbHMoIigxID0gMSIpKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gd2hlcmUuYXBwZW5k\nKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGRhdGEg\nZm9yIHRoaXMgcXVlcnkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsCiAgICAgICAgYm9vbGVhbiBzdWJjbGFzc2VzLCBRdWVyeUV4cHJl\nc3Npb25zIGV4cHMsIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZSBzdGF0ZSwKICAg\nICAgICBpbnQgZWFnZXIpIHsKICAgICAgICBTZWxlY3QgaW5uZXIgPSBzZWwu\nZ2V0RnJvbVNlbGVjdCgpOwogICAgICAgIFZhbCB2YWw7CiAgICAgICAgSm9p\nbnMgam9pbnMgPSBudWxsOwogICAgICAgIGlmIChzZWwuZ2V0U3Vic2VsZWN0\nUGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgIGpvaW5zID0gc2VsLm5ld0pv\naW5zKCkuc2V0U3Vic2VsZWN0KHNlbC5nZXRTdWJzZWxlY3RQYXRoKCkpOwoK\nICAgICAgICAvLyBidWlsZCBvcmRlcmluZyBjbGF1c2VzIGJlZm9yZSBzZWxl\nY3Qgc28gdGhhdCBhbnkgZWFnZXIgam9pbgogICAgICAgIC8vIG9yZGVyaW5n\nIGdldHMgYXBwbGllZCBhZnRlciBxdWVyeSBvcmRlcmluZwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZXhwcy5vcmRlcmluZy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgKChWYWwpIGV4cHMub3JkZXJpbmdbaV0pLm9yZGVyQnko\nc2VsLCBjdHgsIHN0YXRlLm9yZGVyaW5nW2ldLAogICAgICAgICAgICAgICAg\nZXhwcy5hc2NlbmRpbmdbaV0pOwoKICAgICAgICAvLyBpZiBubyByZXN1bHQg\nc3RyaW5nIHNldCwgc2VsZWN0IG1hdGNoaW5nIG9iamVjdHMgbGlrZSBub3Jt\nYWwKICAgICAgICBpZiAoZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGggPT0gMCAm\nJiBzZWwuZ2V0UGFyZW50KCkgPT0gbnVsbCkgewogICAgICAgICAgICBpbnQg\nc3VicyA9IChzdWJjbGFzc2VzKSA/IFNlbGVjdC5TVUJTX0pPSU5BQkxFIDog\nU2VsZWN0LlNVQlNfTk9ORTsKICAgICAgICAgICAgc2VsLnNlbGVjdElkZW50\naWZpZXIobWFwcGluZywgc3VicywgY3R4LnN0b3JlLCBjdHguZmV0Y2gsIGVh\nZ2VyKTsKICAgICAgICB9IGVsc2UgaWYgKGV4cHMucHJvamVjdGlvbnMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgLy8gc3Vic2VsZWN0IGZvciBvYmpl\nY3RzOyB3ZSByZWFsbHkganVzdCBuZWVkIHRoZSBwcmltYXJ5IGtleSB2YWx1\nZXMKICAgICAgICAgICAgc2VsLnNlbGVjdChtYXBwaW5nLmdldFByaW1hcnlL\nZXlDb2x1bW5zKCksIGpvaW5zKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAvLyBpZiB3ZSBoYXZlIGFuIGlubmVyIHNlbGVjdCwgd2UgbmVlZCB0\nbyBzZWxlY3QgdGhlIGNhbmRpZGF0ZQogICAgICAgICAgICAvLyBjbGFzcycg\ncGsgY29sdW1ucyB0byBndWFyYW50ZWUgdW5pcXVlIGluc3RhbmNlcwogICAg\nICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGlu\nbmVyLnNlbGVjdChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIGpv\naW5zKTsKCiAgICAgICAgICAgIC8vIHNlbGVjdCBlYWNoIHJlc3VsdCB2YWx1\nZTsgbm8gbmVlZCB0byBwYXNzIG9uIHRoZSBlYWdlciBtb2RlIHNpbmNlCiAg\nICAgICAgICAgIC8vIHVuZGVyIHByb2plY3Rpb25zIHdlIGFsd2F5cyB1c2Ug\nRUFHRVJfTk9ORQogICAgICAgICAgICBib29sZWFuIHBrcyA9IHNlbC5nZXRQ\nYXJlbnQoKSAhPSBudWxsOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGV4cHMucHJvamVjdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIHZhbCA9IChWYWwpIGV4cHMucHJvamVjdGlvbnNbaV07CiAgICAg\nICAgICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICB2YWwuc2VsZWN0Q29sdW1ucyhpbm5lciwgY3R4LCBzdGF0ZS5wcm9q\nZWN0aW9uc1tpXSwgcGtzKTsKICAgICAgICAgICAgICAgIHZhbC5zZWxlY3Qo\nc2VsLCBjdHgsIHN0YXRlLnByb2plY3Rpb25zW2ldLCBwa3MpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgaGF2aW5nIGNvbHVt\nbnMgYXJlIHNlbGVjdGVkIHNpbmNlIGl0IGlzIHJlcXVpcmVkIGJ5IAogICAg\nICAgICAgICAvLyBzb21lIERCcy4gIHB1dCB0aGVtIGxhc3Qgc28gdGhleSBk\nb24ndCBhZmZlY3QgcmVzdWx0IHByb2Nlc3NpbmcKICAgICAgICAgICAgaWYg\nKGV4cHMuaGF2aW5nICE9IG51bGwgJiYgaW5uZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICgoRXhwKSBleHBzLmhhdmluZykuc2VsZWN0Q29sdW1ucyhp\nbm5lciwgY3R4LCBzdGF0ZS5oYXZpbmcsIAogICAgICAgICAgICAgICAgICAg\nIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgLy8gc2VsZWN0IG9yZGVyaW5n\nIGNvbHVtbnMsIHNpbmNlIGl0IGlzIHJlcXVpcmVkIGJ5IHNvbWUgREJzLiAg\ncHV0IHRoZW0KICAgICAgICAvLyBsYXN0IHNvIHRoZXkgZG9uJ3QgYWZmZWN0\nIHJlc3VsdCBwcm9jZXNzaW5nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBleHBzLm9yZGVyaW5nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZh\nbCA9IChWYWwpIGV4cHMub3JkZXJpbmdbaV07CiAgICAgICAgICAgIGlmIChp\nbm5lciAhPSBudWxsKQogICAgICAgICAgICAgICAgdmFsLnNlbGVjdENvbHVt\nbnMoaW5uZXIsIGN0eCwgc3RhdGUub3JkZXJpbmdbaV0sIHRydWUpOwogICAg\nICAgICAgICB2YWwuc2VsZWN0KHNlbCwgY3R4LCBzdGF0ZS5vcmRlcmluZ1tp\nXSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgY29uZGl0aW9u\ncyBsaW1pdGluZyB0aGUgcHJvamVjdGlvbnMgdG8gdGhlIHByb3BlciBjbGFz\nc2VzOyBpZgogICAgICAgIC8vIHRoaXMgaXNuJ3QgYSBwcm9qZWN0aW9uIHRo\nZW4gdGhleSB3aWxsIGFscmVhZHkgYmUgYWRkZWQKICAgICAgICBpZiAoZXhw\ncy5wcm9qZWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGN0eC5z\ndG9yZS5sb2FkU3ViY2xhc3NlcyhtYXBwaW5nKTsKICAgICAgICAgICAgbWFw\ncGluZy5nZXREaXNjcmltaW5hdG9yKCkuYWRkQ2xhc3NDb25kaXRpb25zKChp\nbm5lciAhPSBudWxsKSAKICAgICAgICAgICAgICAgID8gaW5uZXIgOiBzZWws\nIHN1YmNsYXNzZXMsIGpvaW5zKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVc2VkIHRvIGNoZWNrIHdoZXRoZXIgYSBxdWVyeSdzIHJlc3Vs\ndCBwcm9qZWN0aW9ucyBhcmUgb24gdGhlIGNhbmRpZGF0ZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJvamVjdGlvbkV4cHJlc3Npb25W\naXNpdG9yCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdEV4cHJlc3Npb25WaXNp\ndG9yIHsKCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9jYW5kaWRhdGUgPSBm\nYWxzZTsKICAgICAgICBwcml2YXRlIGludCBfbGV2ZWwgPSAwOwoKICAgICAg\nICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaGFzQ2FuZGlkYXRlUHJvamVjdGlv\nbnMoVmFsdWVbXSBwcm9qcykgewogICAgICAgICAgICBQcm9qZWN0aW9uRXhw\ncmVzc2lvblZpc2l0b3IgdiA9IG5ldyBQcm9qZWN0aW9uRXhwcmVzc2lvblZp\nc2l0b3IoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwcm9q\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcHJvanNbaV0uYWNj\nZXB0VmlzaXQodik7CiAgICAgICAgICAgICAgICBpZiAodi5fY2FuZGlkYXRl\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGVudGVyKFZhbHVlIHZhbCkgewogICAgICAgICAg\nICBpZiAoIV9jYW5kaWRhdGUpIHsKICAgICAgICAgICAgICAgIF9jYW5kaWRh\ndGUgPSAoX2xldmVsID09IDAgJiYgdmFsIGluc3RhbmNlb2YgQ29uc3RhbnQp\nCiAgICAgICAgICAgICAgICAgICAgfHwgKHZhbCBpbnN0YW5jZW9mIFBDUGF0\naCAKICAgICAgICAgICAgICAgICAgICAmJiAhKChQQ1BhdGgpIHZhbCkuaXNW\nYXJpYWJsZVBhdGgoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2xl\ndmVsKys7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBleGl0KFZh\nbHVlIHZhbCkgewogICAgICAgICAgICBfbGV2ZWwtLTsKICAgICAgICB9CiAg\nICB9Cn0K\n","encoding":"base64"}

