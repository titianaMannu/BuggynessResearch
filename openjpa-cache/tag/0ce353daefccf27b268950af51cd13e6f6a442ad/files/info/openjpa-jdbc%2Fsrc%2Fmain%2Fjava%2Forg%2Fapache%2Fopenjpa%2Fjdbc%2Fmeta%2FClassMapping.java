{"sha":"e32136fb88d974c594daa3f86b668361de338fb9","node_id":"MDQ6QmxvYjIwNjM2NDplMzIxMzZmYjg4ZDk3NGM1OTRkYWEzZjg2YjY2ODM2MWRlMzM4ZmI5","size":32067,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e32136fb88d974c594daa3f86b668361de338fb9","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0\naW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5zZXQuTGlzdE9yZGVy\nZWRTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJz\naXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lQ2xhc3NT\ndHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hl\nbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC5Sb3dNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNhdGlvbklkczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7\nCgovKioKICogU3BlY2lhbGl6YXRpb24gb2YgbWV0YWRhdGEgZm9yIHJlbGF0\naW9uYWwgZGF0YWJhc2VzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8K\ncHVibGljIGNsYXNzIENsYXNzTWFwcGluZwogICAgZXh0ZW5kcyBDbGFzc01l\ndGFEYXRhCiAgICBpbXBsZW1lbnRzIENsYXNzU3RyYXRlZ3kgewoKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgQ2xhc3NNYXBwaW5nW10gRU1QVFlfTUFQUElO\nR1MgPSBuZXcgQ2xhc3NNYXBwaW5nWzBdOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoQ2xhc3NNYXBwaW5nLmNsYXNzKTsKCiAgICBwcml2YXRlIGZp\nbmFsIENsYXNzTWFwcGluZ0luZm8gX2luZm87CiAgICBwcml2YXRlIGZpbmFs\nIERpc2NyaW1pbmF0b3IgX2Rpc2NyaW07CiAgICBwcml2YXRlIGZpbmFsIFZl\ncnNpb24gX3ZlcnNpb247CiAgICBwcml2YXRlIENsYXNzU3RyYXRlZ3kgX3N0\ncmF0ZWd5ID0gbnVsbDsKCiAgICBwcml2YXRlIFRhYmxlIF90YWJsZSA9IG51\nbGw7CiAgICBwcml2YXRlIENvbHVtbklPIF9pbyA9IG51bGw7CiAgICBwcml2\nYXRlIENvbHVtbltdIF9jb2xzID0gU2NoZW1hcy5FTVBUWV9DT0xVTU5TOwog\nICAgcHJpdmF0ZSBGb3JlaWduS2V5IF9mayA9IG51bGw7CiAgICBwcml2YXRl\nIGludCBfc3ViY2xhc3NNb2RlID0gSW50ZWdlci5NQVhfVkFMVUU7CgogICAg\ncHJpdmF0ZSBDbGFzc01hcHBpbmdbXSBfam9pblN1Yk1hcHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBDbGFzc01hcHBpbmdbXSBfYXNzaWduTWFwcyA9IG51bGw7\nCgogICAgLy8gbWFwcyBjb2x1bW5zIHRvIGpvaW5hYmxlcwogICAgcHJpdmF0\nZSBmaW5hbCBNYXAgX2pvaW5hYmxlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9u\naXplZE1hcChuZXcgSGFzaE1hcCgpKTsKCiAgICAvKioKICAgICAqIENvbnN0\ncnVjdG9yLiBTdXBwbHkgZGVzY3JpYmVkIHR5cGUgYW5kIG93bmluZyByZXBv\nc2l0b3J5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNYXBwaW5nKENs\nYXNzIHR5cGUsIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAg\nc3VwZXIodHlwZSwgcmVwb3MpOwogICAgICAgIF9kaXNjcmltID0gcmVwb3Mu\nbmV3RGlzY3JpbWluYXRvcih0aGlzKTsKICAgICAgICBfdmVyc2lvbiA9IHJl\ncG9zLm5ld1ZlcnNpb24odGhpcyk7CiAgICAgICAgX2luZm8gPSByZXBvcy5u\nZXdNYXBwaW5nSW5mbyh0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVt\nYmVkZGVkIGNvbnN0cnVjdG9yLiBTdXBwbHkgZW1iZWRkaW5nIHZhbHVlIGFu\nZCBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHJvdGVjdGVkIENs\nYXNzTWFwcGluZyhWYWx1ZU1ldGFEYXRhIHZtZCkgewogICAgICAgIHN1cGVy\nKHZtZCk7CiAgICAgICAgX2Rpc2NyaW0gPSBnZXRNYXBwaW5nUmVwb3NpdG9y\neSgpLm5ld0Rpc2NyaW1pbmF0b3IodGhpcyk7CiAgICAgICAgX3ZlcnNpb24g\nPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLm5ld1ZlcnNpb24odGhpcyk7CiAg\nICAgICAgX2luZm8gPSBnZXRNYXBwaW5nUmVwb3NpdG9yeSgpLm5ld01hcHBp\nbmdJbmZvKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGNsYXNz\nIGRpc2NyaW1pbmF0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBEaXNjcmltaW5h\ndG9yIGdldERpc2NyaW1pbmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIF9kaXNj\ncmltOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHZlcnNpb24gaW5kaWNh\ndG9yLgogICAgICovCiAgICBwdWJsaWMgVmVyc2lvbiBnZXRWZXJzaW9uKCkg\newogICAgICAgIHJldHVybiBfdmVyc2lvbjsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLwogICAgLy8gUnVudGltZQogICAgLy8vLy8vLy8vLy8KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgb2lkIHZhbHVlIHN0b3JlZCBpbiB0aGUgcmVz\ndWx0LiBUaGlzIGltcGxlbWVudGF0aW9uIHdpbGwKICAgICAqIHJlY3Vyc2Ug\ndW50aWwgaXQgZmluZHMgYW4gYW5jZXN0b3IgY2xhc3Mgd2hvIHVzZXMgb2lk\nIHZhbHVlcyBmb3IgaXRzCiAgICAgKiBwcmltYXJ5IGtleS4KICAgICAqCiAg\nICAgKiBAcGFyYW0gZmsgaWYgbm9uLW51bGwsIHVzZSB0aGUgbG9jYWwgY29s\ndW1ucyBvZiB0aGUgZ2l2ZW4gZm9yZWlnbgogICAgICoga2V5IGluIHBsYWNl\nIG9mIHRoaXMgY2xhc3MnIHByaW1hcnkga2V5IGNvbHVtbnMKICAgICAqIEBz\nZWUgI2lzUHJpbWFyeUtleU9iamVjdElkCiAgICAgKi8KICAgIHB1YmxpYyBP\nYmplY3QgZ2V0T2JqZWN0SWQoSkRCQ1N0b3JlIHN0b3JlLCBSZXN1bHQgcmVz\nLCBGb3JlaWduS2V5IGZrLAogICAgICAgIGJvb2xlYW4gc3VicywgSm9pbnMg\nam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nVmFsdWVNYXBwaW5nIGVtYmVkID0gZ2V0RW1iZWRkaW5nTWFwcGluZygpOwog\nICAgICAgIGlmIChlbWJlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZW1iZWQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0RGVmaW5pbmdNYXBwaW5nKCku\nCiAgICAgICAgICAgICAgICBnZXRPYmplY3RJZChzdG9yZSwgcmVzLCBmaywg\nc3Vicywgam9pbnMpOwoKICAgICAgICByZXR1cm4gZ2V0T2JqZWN0SWQodGhp\ncywgc3RvcmUsIHJlcywgZmssIHN1YnMsIGpvaW5zKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgZm9yIHB1YmxpYyA8Y29kZT5n\nZXRPYmplY3RJZDwvY29kZT4gbWV0aG9kLgogICAgICovCiAgICBwcml2YXRl\nIE9iamVjdCBnZXRPYmplY3RJZChDbGFzc01hcHBpbmcgY2xzLCBKREJDU3Rv\ncmUgc3RvcmUsIFJlc3VsdCByZXMsCiAgICAgICAgRm9yZWlnbktleSBmaywg\nYm9vbGVhbiBzdWJzLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWlzUHJpbWFyeUtleU9iamVjdElk\nKHRydWUpKQogICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWFw\ncGluZygpLmdldE9iamVjdElkKGNscywgc3RvcmUsIHJlcywgZmssCiAgICAg\nICAgICAgICAgICBzdWJzLCBqb2lucyk7CiAgICAgICAgaWYgKGdldElkZW50\naXR5VHlwZSgpID09IElEX1VOS05PV04pCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwoKICAgICAgICBDb2x1bW5bXSBwa3Mg\nPSBnZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGlmIChnZXRJZGVu\ndGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RPUkUpIHsKICAgICAgICAgICAgQ29s\ndW1uIGNvbCA9IChmayA9PSBudWxsKSA/IHBrc1swXSA6IGZrLmdldENvbHVt\nbihwa3NbMF0pOwogICAgICAgICAgICBsb25nIGlkID0gcmVzLmdldExvbmco\nY29sLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVybiAoaWQgPT0gMCAmJiBy\nZXMud2FzTnVsbCgpKSA/IG51bGwKICAgICAgICAgICAgICAgIDogc3RvcmUu\nbmV3RGF0YVN0b3JlSWQoaWQsIGNscywgc3Vicyk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBhcHBsaWNhdGlvbiBpZGVudGl0eQogICAgICAgIE9iamVjdFtd\nIHZhbHMgPSBuZXcgT2JqZWN0W2dldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5n\ndGhdOwogICAgICAgIEZpZWxkTWFwcGluZyBmbTsKICAgICAgICBKb2luYWJs\nZSBqb2luOwogICAgICAgIGludCBwa0lkeDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyB3\nZSBrbm93IHRoYXQgYWxsIHBrIGNvbHVtbiBqb2luIG1hcHBpbmdzIHVzZSBw\ncmltYXJ5IGtleSBmaWVsZHMsCiAgICAgICAgICAgIC8vIGNhdXNlIHRoaXMg\nbWFwcGluZyB1c2VzIHRoZSBvaWQgYXMgaXRzIHByaW1hcnkga2V5ICh3ZSBy\nZWN1cnNlZAogICAgICAgICAgICAvLyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRo\nZSBtZXRob2QgdG8gZW5zdXJlIHRoaXMpCiAgICAgICAgICAgIGpvaW4gPSBh\nc3NlcnRKb2luYWJsZShwa3NbaV0pOwogICAgICAgICAgICBmbSA9IGdldEZp\nZWxkTWFwcGluZyhqb2luLmdldEZpZWxkSW5kZXgoKSk7CiAgICAgICAgICAg\nIHBrSWR4ID0gZm0uZ2V0UHJpbWFyeUtleUluZGV4KCk7CgogICAgICAgICAg\nICAvLyBjb3VsZCBoYXZlIGFscmVhZHkgc2V0IHZhbHVlIHdpdGggcHJldmlv\ndXMgbXVsdGktY29sdW1uIGpvaW5hYmxlCiAgICAgICAgICAgIGlmICh2YWxz\nW3BrSWR4XSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXMuc3RhcnRE\nYXRhUmVxdWVzdChmbSk7CiAgICAgICAgICAgICAgICB2YWxzW3BrSWR4XSA9\nIGpvaW4uZ2V0UHJpbWFyeUtleVZhbHVlKHJlcywgam9pbi5nZXRDb2x1bW5z\nKCksCiAgICAgICAgICAgICAgICAgICAgZmssIHN0b3JlLCBqb2lucyk7CiAg\nICAgICAgICAgICAgICByZXMuZW5kRGF0YVJlcXVlc3QoKTsKICAgICAgICAg\nICAgICAgIGlmICh2YWxzW3BrSWR4XSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIE9iamVjdCBvaWQgPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1\nZXModmFscywgY2xzKTsKICAgICAgICBpZiAoIXN1YnMgJiYgb2lkIGluc3Rh\nbmNlb2YgT3BlbkpQQUlkKQogICAgICAgICAgICAoKE9wZW5KUEFJZCkgb2lk\nKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKGNscy5nZXREZXNjcmliZWRUeXBl\nKCkpOwogICAgICAgIHJldHVybiBvaWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGdpdmVuIGNvbHVtbiB2YWx1ZShzKSBmb3IgdGhlIGdp\ndmVuIG9iamVjdC4gVGhlIGdpdmVuCiAgICAgKiBjb2x1bW5zIHdpbGwgYmUg\ncHJpbWFyeSBrZXkgY29sdW1ucyBvZiB0aGlzIG1hcHBpbmcsIGJ1dCBtYXkg\nYmUgaW4KICAgICAqIGFueSBvcmRlci4gSWYgdGhlcmUgaXMgb25seSBvbmUg\nY29sdW1uLCByZXR1cm4gaXRzIHZhbHVlLiBJZiB0aGVyZQogICAgICogYXJl\nIG11bHRpcGxlIGNvbHVtbnMsIHJldHVybiBhbiBvYmplY3QgYXJyYXkgb2Yg\ndGhlaXIgdmFsdWVzLCBpbiB0aGUKICAgICAqIHNhbWUgb3JkZXIgdGhlIGNv\nbHVtbnMgYXJlIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IHRv\nRGF0YVN0b3JlVmFsdWUoT2JqZWN0IG9iaiwgQ29sdW1uW10gY29scywgSkRC\nQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgT2JqZWN0IHJldCA9IChjb2xzLmxl\nbmd0aCA9PSAxKSA/IG51bGwgOiBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsK\nCiAgICAgICAgLy8gaW4gdGhlIHBhc3Qgd2UndmUgYmVlbiBsZW5pZW50IGFi\nb3V0IGJlaW5nIGFibGUgdG8gdHJhbnNsYXRlIG9iamVjdHMKICAgICAgICAv\nLyBmcm9tIG90aGVyIHBlcnNpc3RlbmNlIGNvbnRleHRzLCBzbyB0cnkgdG8g\nZ2V0IHNtIGRpcmVjdGx5IGZyb20KICAgICAgICAvLyBpbnN0YW5jZSBiZWZv\ncmUgYXNraW5nIG91ciBjb250ZXh0CiAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVu\nY2VDYXBhYmxlKQogICAgICAgICAgICBzbSA9IChPcGVuSlBBU3RhdGVNYW5h\nZ2VyKSAoKFBlcnNpc3RlbmNlQ2FwYWJsZSkgb2JqKS4KICAgICAgICAgICAg\nICAgIHBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzbSA9IHN0b3JlLmdldENvbnRleHQoKS5nZXRTdGF0ZU1hbmFnZXIo\nb2JqKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHJldDsKCiAgICAgICAgT2JqZWN0IHZhbDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\ndmFsID0gYXNzZXJ0Sm9pbmFibGUoY29sc1tpXSkuZ2V0Sm9pblZhbHVlKHNt\nLCBjb2xzW2ldLCBzdG9yZSk7CiAgICAgICAgICAgIGlmIChjb2xzLmxlbmd0\naCA9PSAxKQogICAgICAgICAgICAgICAgcmV0ID0gdmFsOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAoKE9iamVjdFtdKSByZXQpW2ldID0g\ndmFsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2luYWJsZSBmb3IgdGhlIGdpdmVu\nIGNvbHVtbiwgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIGlmCiAgICAgKiBub25l\nIGlzIGF2YWlsYWJsZS4KICAgICAqLwogICAgcHVibGljIEpvaW5hYmxlIGFz\nc2VydEpvaW5hYmxlKENvbHVtbiBjb2wpIHsKICAgICAgICBKb2luYWJsZSBq\nb2luID0gZ2V0Sm9pbmFibGUoY29sKTsKICAgICAgICBpZiAoam9pbiA9PSBu\ndWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLWpvaW5hYmxlIiwKICAgICAgICAgICAgICAgIGNvbC5n\nZXRGdWxsTmFtZSgpKSk7CiAgICAgICAgcmV0dXJuIGpvaW47CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHtAbGluayBKb2luYWJsZX0gZm9y\nIHRoZSBnaXZlbiBjb2x1bW4uIEFueSBjb2x1bW4gdGhhdAogICAgICogYW5v\ndGhlciBtYXBwaW5nIGpvaW5zIHRvIG11c3QgYmUgY29udHJvbGxlZCBieSBh\nIGpvaW5hYmxlLgogICAgICovCiAgICBwdWJsaWMgSm9pbmFibGUgZ2V0Sm9p\nbmFibGUoQ29sdW1uIGNvbCkgewogICAgICAgIEpvaW5hYmxlIGpvaW47CiAg\nICAgICAgaWYgKGdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICBqb2luID0gZ2V0RW1iZWRkaW5nTWFwcGluZygpLmdldEZp\nZWxkTWFwcGluZygpLgogICAgICAgICAgICAgICAgZ2V0RGVmaW5pbmdNYXBw\naW5nKCkuZ2V0Sm9pbmFibGUoY29sKTsKICAgICAgICAgICAgaWYgKGpvaW4g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBqb2luOwogICAgICAg\nIH0KICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGpvaW4gPSBzdXAuZ2V0Sm9pbmFibGUoY29sKTsKICAg\nICAgICAgICAgaWYgKGpvaW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBqb2luOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKEpvaW5hYmxl\nKSBfam9pbmFibGVzLmdldChjb2wpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkIHRoZSBnaXZlbiBjb2x1bW4tdG8tam9pbmFibGUgbWFwcGluZy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pbmFibGUoQ29sdW1uIGNvbCwg\nSm9pbmFibGUgam9pbmFibGUpIHsKICAgICAgICAvLyBkb24ndCBsZXQgbm9u\nLXBrIG92ZXJyaWRlIHBrCiAgICAgICAgSm9pbmFibGUgam9pbiA9IChKb2lu\nYWJsZSkgX2pvaW5hYmxlcy5nZXQoY29sKTsKICAgICAgICBpZiAoam9pbiA9\nPSBudWxsIHx8IChqb2luLmdldEZpZWxkSW5kZXgoKSAhPSAtMQogICAgICAg\nICAgICAmJiBnZXRGaWVsZChqb2luLmdldEZpZWxkSW5kZXgoKSkuZ2V0UHJp\nbWFyeUtleUluZGV4KCkgPT0gLTEpKQogICAgICAgICAgICBfam9pbmFibGVz\nLnB1dChjb2wsIGpvaW5hYmxlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB3aGV0aGVyIHRoZSBjb2x1bW5zIG9mIHRoZSBnaXZlbiBmb3JlaWdu\nIGtleSB0byB0aGlzIG1hcHBpbmcKICAgICAqIGNhbiBiZSB1c2VkIHRvIGNv\nbnN0cnVjdCBhbiBvYmplY3QgaWQgZm9yIHRoaXMgdHlwZS4gVGhpcyBpcyBh\nCiAgICAgKiByZWxhdGl2ZWx5IGV4cGVuc2l2ZSBvcGVyYXRpb247IGl0cyBy\nZXN1bHRzIHNob3VsZCBiZSBjYWNoZWQuCiAgICAgKgogICAgICogQHJldHVy\nbiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBpZiB0aGUgZm9yZWlnbiBrZXkgY29u\ndGFpbnMgYWxsIG9pZAogICAgICogY29sdW1ucywgPGNvZGU+bnVsbDwvY29k\nZT4gaWYgaXQgY29udGFpbnMgb25seSBzb21lIGNvbHVtbnMsCiAgICAgKiBv\nciB7QGxpbmsgQm9vbGVhbiNGQUxTRX0gaWYgaXQgY29udGFpbnMgbm9uLW9p\nZCBjb2x1bW5zCiAgICAgKi8KICAgIHB1YmxpYyBCb29sZWFuIGlzRm9yZWln\nbktleU9iamVjdElkKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICAvLyBpZiB0\naGlzIG1hcHBpbmcncyBwcmltYXJ5IGtleSBjYW4ndCBjb25zdHJ1Y3QgYW4g\nb2lkLCB0aGVuIG5vIHdheQogICAgICAgIC8vIGZvcmVpZ24ga2V5IGNhbgog\nICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9VTktOT1dOIHx8\nICFpc1ByaW1hcnlLZXlPYmplY3RJZChmYWxzZSkpCiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyB3aXRoIGRhdGFzdG9y\nZSBpZGVudGl0eSwgaXQncyBhbGwgb3Igbm90aGluZwogICAgICAgIENvbHVt\nbltdIGNvbHMgPSBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAg\nIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RPUkUpIHsKICAg\nICAgICAgICAgaWYgKGNvbHMubGVuZ3RoICE9IDEgfHwgY29sc1swXSAhPSBn\nZXRQcmltYXJ5S2V5Q29sdW1ucygpWzBdKQogICAgICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFu\nLlRSVUU7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayB0aGUgam9pbiBt\nYXBwaW5nIGZvciBlYWNoIHBrIGNvbHVtbiB0byBzZWUgaWYgaXQgbGlua3Mg\ndXAgdG8KICAgICAgICAvLyBhIHByaW1hcnkga2V5IGZpZWxkCiAgICAgICAg\nSm9pbmFibGUgam9pbjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgam9pbiA9IGFzc2VydEpv\naW5hYmxlKGNvbHNbaV0pOwogICAgICAgICAgICBpZiAoam9pbi5nZXRGaWVs\nZEluZGV4KCkgIT0gLTEKICAgICAgICAgICAgICAgICYmIGdldEZpZWxkKGpv\naW4uZ2V0RmllbGRJbmRleCgpKS5nZXRQcmltYXJ5S2V5SW5kZXgoKSA9PSAt\nMSkKICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaWYgYWxsIHByaW1hcnkga2V5IGxpbmtzLCBz\nZWUgd2hldGhlciB3ZSBqb2luIHRvIGFsbCBwa3MKICAgICAgICBpZiAoaXNQ\ncmltYXJ5S2V5T2JqZWN0SWQodHJ1ZSkKICAgICAgICAgICAgJiYgY29scy5s\nZW5ndGggPT0gZ2V0UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLy8vLy8vLwogICAgLy8gT1JNCiAgICAvLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBSYXcgbWFwcGluZyBkYXRhLgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nSW5mbyBnZXRNYXBwaW5nSW5mbygpIHsK\nICAgICAgICByZXR1cm4gX2luZm87CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgc3RyYXRlZ3kgdXNlZCB0byBtYXAgdGhpcyBtYXBwaW5nLgogICAgICov\nCiAgICBwdWJsaWMgQ2xhc3NTdHJhdGVneSBnZXRTdHJhdGVneSgpIHsKICAg\nICAgICByZXR1cm4gX3N0cmF0ZWd5OwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHN0cmF0ZWd5IHVzZWQgdG8gbWFwIHRoaXMgbWFwcGluZy4gVGhlIDxj\nb2RlPmFkYXB0PC9jb2RlPgogICAgICogcGFyYW1ldGVyIGRldGVybWluZXMg\nd2hldGhlciB0byBhZGFwdCB3aGVuIG1hcHBpbmcgdGhlIHN0cmF0ZWd5Owog\nICAgICogdXNlIG51bGwgaWYgdGhlIHN0cmF0ZWd5IHNob3VsZCBub3QgYmUg\nbWFwcGVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJhdGVneShD\nbGFzc1N0cmF0ZWd5IHN0cmF0ZWd5LCBCb29sZWFuIGFkYXB0KSB7CiAgICAg\nICAgLy8gc2V0IHN0cmF0ZWd5IGZpcnN0IHNvIHdlIGNhbiBhY2Nlc3MgaXQg\nZHVyaW5nIG1hcHBpbmcKICAgICAgICBDbGFzc1N0cmF0ZWd5IG9yaWcgPSBf\nc3RyYXRlZ3k7CiAgICAgICAgX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICAg\nICAgaWYgKHN0cmF0ZWd5ICE9IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIHN0cmF0ZWd5LnNldENsYXNzTWFwcGluZyh0aGlz\nKTsKICAgICAgICAgICAgICAgIGlmIChhZGFwdCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIHN0cmF0ZWd5Lm1hcChhZGFwdC5ib29sZWFuVmFsdWUo\nKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgICAgIC8vIHJlc2V0IHN0cmF0ZWd5CiAgICAgICAg\nICAgICAgICBfc3RyYXRlZ3kgPSBvcmlnOwogICAgICAgICAgICAgICAgdGhy\nb3cgcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgbWFwcGluZydzIHByaW1hcnkgdGFibGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBUYWJsZSBnZXRUYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nX3RhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1hcHBpbmcncyBw\ncmltYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUYWJs\nZShUYWJsZSB0YWJsZSkgewogICAgICAgIF90YWJsZSA9IHRhYmxlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGNvbHVtbnMgdGhpcyBtYXBwaW5nIHVz\nZXMgdG8gdW5pcXVlbHkgaWRlbnRpZnkgYW4gb2JqZWN0LgogICAgICogVGhl\nc2Ugd2lsbCB0eXBpY2FsbHkgYmUgdGhlIHByaW1hcnkga2V5IGNvbHVtbnMg\nb3IgdGhlIGNvbHVtbnMgdGhpcwogICAgICogY2xhc3MgdXNlcyB0byBsaW5r\nIHRvIGl0cyBzdXBlcmNsYXNzIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMg\nQ29sdW1uW10gZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSB7CiAgICAgICAgaWYg\nKF9jb2xzLmxlbmd0aCA9PSAwICYmIGdldElkZW50aXR5VHlwZSgpID09IElE\nX0FQUExJQ0FUSU9OCiAgICAgICAgICAgICYmIGlzTWFwcGVkKCkpIHsKICAg\nICAgICAgICAgRmllbGRNYXBwaW5nW10gcGtzID0gZ2V0UHJpbWFyeUtleUZp\nZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBjb2xzID0g\nbmV3IEFycmF5TGlzdChwa3MubGVuZ3RoKTsKICAgICAgICAgICAgQ29sdW1u\nW10gZmllbGRDb2xzOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZmllbGRDb2xz\nID0gcGtzW2ldLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGogPSAwOyBqIDwgZmllbGRDb2xzLmxlbmd0aDsgaisrKQogICAgICAg\nICAgICAgICAgICAgIGNvbHMuYWRkKGZpZWxkQ29sc1tqXSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgX2NvbHMgPSAoQ29sdW1uW10pIGNvbHMudG9B\ncnJheShuZXcgQ29sdW1uW2NvbHMuc2l6ZSgpXSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBj\nb2x1bW5zIHRoaXMgbWFwcGluZyB1c2VzIHRvIHVuaXF1ZWx5IGlkZW50aWZ5\nIGFuIG9iamVjdC4KICAgICAqIFRoZXNlIHdpbGwgdHlwaWNhbGx5IGJlIHRo\nZSBwcmltYXJ5IGtleSBjb2x1bW5zIG9yIHRoZSBjb2x1bW5zIHRoaXMKICAg\nICAqIGNsYXNzIHVzZXMgdG8gbGluayB0byBpdHMgc3VwZXJjbGFzcyB0YWJs\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJpbWFyeUtleUNvbHVt\nbnMoQ29sdW1uW10gY29scykgewogICAgICAgIGlmIChjb2xzID09IG51bGwp\nCiAgICAgICAgICAgIGNvbHMgPSBTY2hlbWFzLkVNUFRZX0NPTFVNTlM7CiAg\nICAgICAgX2NvbHMgPSBjb2xzOwogICAgfQoKICAgIC8qKgogICAgICogSS9P\nIGluZm9ybWF0aW9uIG9uIHRoZSBrZXkgY29sdW1ucyAvIGpvaW4ga2V5Lgog\nICAgICovCiAgICBwdWJsaWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAg\nICAgICAgcmV0dXJuIChfaW8gPT0gbnVsbCkgPyBDb2x1bW5JTy5VTlJFU1RS\nSUNURUQgOiBfaW87CiAgICB9CgogICAgLyoqCiAgICAgKiBJL08gaW5mb3Jt\nYXRpb24gb24gdGhlIGtleSBjb2x1bW5zIC8gam9pbiBrZXkuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldENvbHVtbklPKENvbHVtbklPIGlvKSB7CiAg\nICAgICAgX2lvID0gaW87CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JlaWdu\nIGtleSBsaW5raW5nIHRoZSBwcmltYXJ5IGtleSBjb2x1bW5zIHRvIHRoZSBz\ndXBlcmNsYXNzIHRhYmxlLAogICAgICogb3IgbnVsbCBpZiBub25lLgogICAg\nICovCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRKb2luRm9yZWlnbktleSgp\nIHsKICAgICAgICByZXR1cm4gX2ZrOwogICAgfQoKICAgIC8qKgogICAgICog\nRm9yZWlnbiBrZXkgbGlua2luZyB0aGUgcHJpbWFyeSBrZXkgY29sdW1ucyB0\nbyB0aGUgc3VwZXJjbGFzcyB0YWJsZSwKICAgICAqIG9yIG51bGwgaWYgbm9u\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pbkZvcmVpZ25LZXko\nRm9yZWlnbktleSBmaykgewogICAgICAgIF9mayA9IGZrOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHJlZlNjaGVtYUNvbXBvbmVudHMoKSB7CiAgICAgICAg\naWYgKGdldEVtYmVkZGluZ01ldGFEYXRhKCkgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoX3RhYmxlICE9IG51bGwgJiYgX3RhYmxlLmdldFByaW1hcnlL\nZXkoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgX3RhYmxlLmdldFByaW1h\ncnlLZXkoKS5yZWYoKTsKICAgICAgICAgICAgaWYgKF9mayAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX2ZrLnJlZigpOwogICAgICAgICAgICBDb2x1bW5b\nXSBwa3MgPSBnZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIHBrc1tpXS5yZWYoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBnZXRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgZmllbGRzW2ldLnJlZlNjaGVt\nYUNvbXBvbmVudHMoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbGVhciBtYXBwaW5nIGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgc3RyYXRl\nZ3kuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyTWFwcGluZygpIHsK\nICAgICAgICBfc3RyYXRlZ3kgPSBudWxsOwogICAgICAgIF9jb2xzID0gU2No\nZW1hcy5FTVBUWV9DT0xVTU5TOwogICAgICAgIF9mayA9IG51bGw7CiAgICAg\nICAgX3RhYmxlID0gbnVsbDsKICAgICAgICBfaW5mby5jbGVhcigpOwogICAg\nICAgIHNldFJlc29sdmUoTU9ERV9NQVBQSU5HIHwgTU9ERV9NQVBQSU5HX0lO\nSVQsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSB7QGxp\nbmsgTWFwcGluZ0luZm99IHdpdGggb3VyIGN1cnJlbnQgbWFwcGluZyBpbmZv\ncm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc3luY01hcHBpbmdJ\nbmZvKCkgewogICAgICAgIGlmIChnZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09\nIG51bGwpCiAgICAgICAgICAgIF9pbmZvLnN5bmNXaXRoKHRoaXMpOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICBfaW5mby5jbGVhcigpOwogICAgICAg\nICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBnZXRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgZmllbGRzW2ldLnN5bmNNYXBw\naW5nSW5mbygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCiAgICAvLyBNZXRhRGF0YSBpbnRlcmZhY2UKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXREZXNj\ncmliZWRUeXBlKENsYXNzIHR5cGUpIHsKICAgICAgICBzdXBlci5zZXREZXNj\ncmliZWRUeXBlKHR5cGUpOwogICAgICAgIC8vIHRoaXMgbWV0aG9kIGNhbGxl\nZCBmcm9tIHN1cGVyY2xhc3MgY29uc3RydWN0b3IsIHNvIF9pbmZvIG5vdCB5\nZXQKICAgICAgICAvLyBpbml0aWFsaXplZAogICAgICAgIGlmIChfaW5mbyAh\nPSBudWxsKQogICAgICAgICAgICBfaW5mby5zZXRDbGFzc05hbWUodHlwZS5n\nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN1YmNsYXNz\nIGZldGNoIG1vZGUsIGFzIG9uZSBvZiB0aGUgZWFnZXIgY29uc3RhbnRzIGlu\nCiAgICAgKiB7QGxpbmsgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbn0uCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0U3ViY2xhc3NGZXRjaE1vZGUoKSB7CiAg\nICAgICAgaWYgKF9zdWJjbGFzc01vZGUgPT0gSW50ZWdlci5NQVhfVkFMVUUp\nIHsKICAgICAgICAgICAgaWYgKGdldFBDU3VwZXJjbGFzcygpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfc3ViY2xhc3NNb2RlID0gZ2V0UENTdXBlcmNs\nYXNzTWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdldFN1YmNsYXNz\nRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIF9zdWJjbGFzc01vZGUgPSBGZXRjaENvbmZpZ3VyYXRpb24uREVGQVVMVDsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdWJjbGFzc01vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgc3ViY2xhc3MgZmV0Y2ggbW9kZSwgYXMg\nb25lIG9mIHRoZSBlYWdlciBjb25zdGFudHMgaW4KICAgICAqIHtAbGluayBK\nREJDRmV0Y2hDb25maWd1cmF0aW9ufS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0U3ViY2xhc3NGZXRjaE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBf\nc3ViY2xhc3NNb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICog\ne0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0UmVwb3NpdG9yeX0uCiAgICAgKi8K\nICAgIHB1YmxpYyBNYXBwaW5nUmVwb3NpdG9yeSBnZXRNYXBwaW5nUmVwb3Np\ndG9yeSgpIHsKICAgICAgICByZXR1cm4gKE1hcHBpbmdSZXBvc2l0b3J5KSBn\nZXRSZXBvc2l0b3J5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGlu\nayBDbGFzc01ldGFEYXRhI2dldEVtYmVkZGluZ01ldGFEYXRhfQogICAgICov\nCiAgICBwdWJsaWMgVmFsdWVNYXBwaW5nIGdldEVtYmVkZGluZ01hcHBpbmco\nKSB7CiAgICAgICAgcmV0dXJuIChWYWx1ZU1hcHBpbmcpIGdldEVtYmVkZGlu\nZ01ldGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRy\ndWUgaWYgdGhpcyBjbGFzcyBkb2VzIG5vdCB1c2UgdGhlICJub25lIiBzdHJh\ndGVneSAoaW5jbHVkaW5nCiAgICAgKiBpZiBpdCBoYXMgYSBudWxsIHN0cmF0\nZWd5LCBhbmQgdGhlcmVmb3JlIGlzIHByb2JhYmx5IGluIHRoZSBwcm9jZXNz\nIG9mCiAgICAgKiBiZWluZyBtYXBwZWQpLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc01hcHBlZCgpIHsKICAgICAgICBpZiAoIXN1cGVyLmlzTWFw\ncGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAo\nX3N0cmF0ZWd5ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfc3RyYXRl\nZ3kgIT0gTm9uZUNsYXNzU3RyYXRlZ3kuZ2V0SW5zdGFuY2UoKTsKICAgICAg\nICByZXR1cm4gIU5vbmVDbGFzc1N0cmF0ZWd5LkFMSUFTLmVxdWFscyhfaW5m\nby5nZXRTdHJhdGVneSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\nbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0Bs\naW5rIENsYXNzTWV0YURhdGEjZ2V0UENTdXBlcmNsYXNzTWV0YURhdGF9Lgog\nICAgICovCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nIGdldFBDU3VwZXJjbGFz\nc01hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmcpIGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAg\nICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldE1hcHBlZFBDU3VwZXJjbGFz\nc01ldGFEYXRhfS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZyBn\nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgewogICAgICAgIHJldHVy\nbiAoQ2xhc3NNYXBwaW5nKSBnZXRNYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuZWFyZXN0\nIG1hcHBlZCBzdXBlcmNsYXNzIHRoYXQgY2FuIGpvaW4gdG8gdGhpcyBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZyBnZXRKb2luYWJs\nZVBDU3VwZXJjbGFzc01hcHBpbmcoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHN1cCA9IGdldE1hcHBlZFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAg\nICBpZiAoc3VwID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIGlmIChfZmsgIT0gbnVsbCB8fCBfdGFibGUgPT0gbnVsbCB8fCBf\ndGFibGUuZXF1YWxzKHN1cC5nZXRUYWJsZSgpKSkKICAgICAgICAgICAgcmV0\ndXJuIHN1cDsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJv\nbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0UENTdWJjbGFzc01l\ndGFEYXRhc30uCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmdbXSBn\nZXRQQ1N1YmNsYXNzTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChDbGFz\nc01hcHBpbmdbXSkgZ2V0UENTdWJjbGFzc01ldGFEYXRhcygpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0g\nY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRNYXBw\nZWRQQ1N1YmNsYXNzTWV0YURhdGFzfS4KICAgICAqLwogICAgcHVibGljIENs\nYXNzTWFwcGluZ1tdIGdldE1hcHBlZFBDU3ViY2xhc3NNYXBwaW5ncygpIHsK\nICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZ1tdKSBnZXRNYXBwZWRQQ1N1\nYmNsYXNzTWV0YURhdGFzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gbWFwcGVkIHN1YmNsYXNzZXMgdGhhdCBhcmUgcmVhY2hhYmxlIHZpYSBq\nb2lucy4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFwcGluZ1tdIGdldEpv\naW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCkgewogICAgICAgIENsYXNzTWFw\ncGluZ1tdIHN1YnMgPSBnZXRNYXBwZWRQQ1N1YmNsYXNzTWFwcGluZ3MoKTsg\nLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX2pvaW5TdWJNYXBzID09\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3RoID09IDApCiAg\nICAgICAgICAgICAgICBfam9pblN1Yk1hcHMgPSBzdWJzOwogICAgICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgICAgIExpc3Qgam9pbmFibGUgPSBuZXcg\nQXJyYXlMaXN0KHN1YnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNTdWJKb2luYWJsZShzdWJzW2ldKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgam9pbmFibGUuYWRkKHN1YnNbaV0pOwogICAgICAg\nICAgICAgICAgX2pvaW5TdWJNYXBzID0gKENsYXNzTWFwcGluZ1tdKSBqb2lu\nYWJsZS50b0FycmF5CiAgICAgICAgICAgICAgICAgICAgKG5ldyBDbGFzc01h\ncHBpbmdbam9pbmFibGUuc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9qb2luU3ViTWFwczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB3aGV0aGVyIHdlIGNhbiByZWFjaCB0aGUgZ2l2\nZW4gc3ViY2xhc3MgdmlhIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gaXNTdWJKb2luYWJsZShDbGFzc01hcHBpbmcgc3ViKSB7CiAgICAg\nICAgaWYgKHN1YiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgaWYgKHN1YiA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICByZXR1cm4gaXNTdWJKb2luYWJsZShzdWIuZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgY2xvc2VzdC1kZXJpdmVkIGxpc3Qgb2Ygbm9u\nLWludGVyLWpvaW5hYmxlIG1hcHBlZCB0eXBlcwogICAgICogYXNzaWduYWJs\nZSB0byB0aGlzIHR5cGUuIE1heSByZXR1cm4gdGhpcyBtYXBwaW5nLgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0SW5kZXBlbmRlbnRB\nc3NpZ25hYmxlTWFwcGluZ3MoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10g\nc3VicyA9IGdldE1hcHBlZFBDU3ViY2xhc3NNYXBwaW5ncygpOyAvLyBjaGVj\na3MgZm9yIG5ldwogICAgICAgIGlmIChfYXNzaWduTWFwcyA9PSBudWxsKSB7\nCiAgICAgICAgICAgIC8vIHJlbW92ZSB1bm1hcHBlZCBzdWJzCiAgICAgICAg\nICAgIGlmIChzdWJzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICBp\nZiAoaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICBfYXNzaWduTWFw\ncyA9IG5ldyBDbGFzc01hcHBpbmdbXXsgdGhpcyB9OwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9hc3NpZ25NYXBzID0gc3Vi\nczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGludCBz\naXplID0gKGludCkgKHN1YnMubGVuZ3RoICogMS4zMyArIDIpOwogICAgICAg\nICAgICAgICAgU2V0IGluZGVwZW5kZW50ID0gTGlzdE9yZGVyZWRTZXQuZGVj\nb3JhdGUobmV3IEhhc2hTZXQoc2l6ZSksCiAgICAgICAgICAgICAgICAgICAg\nbmV3IEFycmF5TGlzdChzdWJzLmxlbmd0aCArIDEpKTsKICAgICAgICAgICAg\nICAgIGlmIChpc01hcHBlZCgpKQogICAgICAgICAgICAgICAgICAgIGluZGVw\nZW5kZW50LmFkZCh0aGlzKTsKICAgICAgICAgICAgICAgIGluZGVwZW5kZW50\nLmFkZEFsbChBcnJheXMuYXNMaXN0KHN1YnMpKTsKCiAgICAgICAgICAgICAg\nICAvLyByZW1vdmUgYWxsIG1hcHBpbmdzIHRoYXQgaGF2ZSBhIHN1cGVyY2xh\nc3MgbWFwcGluZyBpbiB0aGUgc2V0CiAgICAgICAgICAgICAgICBDbGFzc01h\ncHBpbmcgbWFwLCBzdXA7CiAgICAgICAgICAgICAgICBMaXN0IGNsZWFyID0g\nbnVsbDsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gaW5k\nZXBlbmRlbnQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgICAgICBtYXAgPSAoQ2xhc3NNYXBwaW5nKSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAgICAgIHN1cCA9IG1hcC5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nc3VwICE9IG51bGwgJiYgaW5kZXBlbmRlbnQuY29udGFpbnMoc3VwKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xlYXIgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyID0gbmV3IEFycmF5TGlz\ndChpbmRlcGVuZGVudC5zaXplKCkgLSAxKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgY2xlYXIuYWRkKG1hcCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNsZWFyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgaW5kZXBlbmRlbnQucmVtb3Zl\nQWxsKGNsZWFyKTsKCiAgICAgICAgICAgICAgICBfYXNzaWduTWFwcyA9IChD\nbGFzc01hcHBpbmdbXSkgaW5kZXBlbmRlbnQudG9BcnJheQogICAgICAgICAg\nICAgICAgICAgIChuZXcgQ2xhc3NNYXBwaW5nW2luZGVwZW5kZW50LnNpemUo\nKV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nYXNzaWduTWFwczsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNl\nIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbSB7QGxpbmsgQ2xhc3NNZXRh\nRGF0YSNnZXRGaWVsZHN9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBw\naW5nW10gZ2V0RmllbGRNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKEZp\nZWxkTWFwcGluZ1tdKSBnZXRGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQog\nICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0RGVjbGFyZWRGaWVsZHN9\nLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0RGVjbGFy\nZWRGaWVsZE1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBw\naW5nW10pIGdldERlY2xhcmVkRmllbGRzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20K\nICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldFByaW1hcnlLZXlGaWVs\nZHN9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0UHJp\nbWFyeUtleUZpZWxkTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChGaWVs\nZE1hcHBpbmdbXSkgZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2Fz\ndCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRWZXJzaW9u\nRmllbGR9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGdldFZl\ncnNpb25GaWVsZE1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1h\ncHBpbmcpIGdldFZlcnNpb25GaWVsZCgpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWZhdWx0RmV0Y2hHcm91\ncEZpZWxkc30uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBn\nZXREZWZhdWx0RmV0Y2hHcm91cEZpZWxkTWFwcGluZ3MoKSB7CiAgICAgICAg\ncmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVmYXVsdEZldGNoR3JvdXBG\naWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1l\ndGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNz\nTWV0YURhdGEjZ2V0RGVmaW5lZEZpZWxkc30uCiAgICAgKi8KICAgIHB1Ymxp\nYyBGaWVsZE1hcHBpbmdbXSBnZXREZWZpbmVkRmllbGRNYXBwaW5ncygpIHsK\nICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWZpbmVkRmll\nbGRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRo\nb2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01l\ndGFEYXRhI2dldEZpZWxkc0luTGlzdGluZ09yZGVyfS4KICAgICAqLwogICAg\ncHVibGljIEZpZWxkTWFwcGluZ1tdIGdldEZpZWxkTWFwcGluZ3NJbkxpc3Rp\nbmdPcmRlcigpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBn\nZXRGaWVsZHNJbkxpc3RpbmdPcmRlcigpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWZpbmVkRmllbGRzSW5M\naXN0aW5nT3JkZXJ9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5n\nW10gZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3NJbkxpc3RpbmdPcmRlcigpIHsK\nICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWZpbmVkRmll\nbGRzSW5MaXN0aW5nT3JkZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbSB7QGxpbmsg\nQ2xhc3NNZXRhRGF0YSNnZXRGaWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBG\naWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBwaW5nKGludCBpbmRleCkgewogICAg\nICAgIHJldHVybiAoRmllbGRNYXBwaW5nKSBnZXRGaWVsZChpbmRleCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVy\nZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dl\ndERlY2xhcmVkRmllbGR9LgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBw\naW5nIGdldERlY2xhcmVkRmllbGRNYXBwaW5nKGludCBpbmRleCkgewogICAg\nICAgIHJldHVybiAoRmllbGRNYXBwaW5nKSBnZXREZWNsYXJlZEZpZWxkKGlu\nZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhv\nZCB0byBwZXJmb3JtIGNhc3QgZnJvbSB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNn\nZXRGaWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0\nRmllbGRNYXBwaW5nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChG\naWVsZE1hcHBpbmcpIGdldEZpZWxkKG5hbWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9t\nCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWNsYXJlZEZpZWxk\nfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXREZWNsYXJl\nZEZpZWxkTWFwcGluZyhTdHJpbmcgbmFtZSkgewogICAgICAgIHJldHVybiAo\nRmllbGRNYXBwaW5nKSBnZXREZWNsYXJlZEZpZWxkKG5hbWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0g\nY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWNs\nYXJlZFVubWFuYWdlZEZpZWxkc30uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZE1hcHBpbmdbXSBnZXREZWNsYXJlZFVubWFuYWdlZEZpZWxkTWFwcGluZ3Mo\nKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBpbmdbXSkgZ2V0RGVjbGFy\nZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICog\ne0BsaW5rIENsYXNzTWV0YURhdGEjYWRkRGVjbGFyZWRGaWVsZH0uCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgYWRkRGVjbGFyZWRGaWVsZE1h\ncHBpbmcoU3RyaW5nIG5hbWUsIENsYXNzIHR5cGUpIHsKICAgICAgICByZXR1\ncm4gKEZpZWxkTWFwcGluZykgYWRkRGVjbGFyZWRGaWVsZChuYW1lLCB0eXBl\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWFwcGluZyhi\nb29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBzdXBlci5yZXNvbHZlTWFwcGlu\nZyhydW50aW1lKTsKCiAgICAgICAgLy8gbWFwIGNsYXNzIHN0cmF0ZWd5OyBp\ndCBtYXkgYWxyZWFkeSBiZSBtYXBwZWQgYnkgdGhlIHJlcG9zaXRvcnkgYmVm\nb3JlCiAgICAgICAgLy8gdGhlIHJlc29sdmUgcHJvY2VzcyBiZWdpbnMKICAg\nICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IGdldE1hcHBpbmdSZXBv\nc2l0b3J5KCk7CiAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxsKQogICAg\nICAgICAgICByZXBvcy5nZXRTdHJhdGVneUluc3RhbGxlcigpLmluc3RhbGxT\ndHJhdGVneSh0aGlzKTsKICAgICAgICBMb2cgbG9nID0gZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJzdHJhdGVneSIs\nIHRoaXMsIF9zdHJhdGVneS5nZXRBbGlhcygpKSk7CgogICAgICAgIC8vIG1h\na2Ugc3VyZSB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxkcyBhcmUgZGVmaW5l\nZCBpZiB3ZSdyZSBtYXBwZWQ7CiAgICAgICAgLy8gYWxzbyBtYXkgaGF2ZSBi\nZWVuIGRvbmUgYnkgcmVwb3NpdG9yeSBhbHJlYWR5CiAgICAgICAgZGVmaW5l\nU3VwZXJjbGFzc0ZpZWxkcyhnZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKSA9PSBudWxsKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBldmVyeXRoaW5n\nIHRoYXQgZG9lc24ndCByZWx5IG9uIGFueSByZWxhdGlvbnMgdG8gYXZvaWQK\nICAgICAgICAvLyByZWN1cnNpb24sIHRoZW4gcmVzb2x2ZSBhbGwgZmllbGRz\nCiAgICAgICAgcmVzb2x2ZU5vblJlbGF0aW9uTWFwcGluZ3MoKTsKICAgICAg\nICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBnZXRGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIGlmIChmbXNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09\nIHRoaXMpCiAgICAgICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RFX01B\nUFBJTkcpOwogICAgICAgIGZtcyA9IGdldERlY2xhcmVkVW5tYW5hZ2VkRmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1z\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RF\nX01BUFBJTkcpOwoKICAgICAgICAvLyBtYXJrIG1hcHBlZCBjb2x1bW5zCiAg\nICAgICAgaWYgKF9jb2xzICE9IG51bGwpIHsKICAgICAgICAgICAgQ29sdW1u\nSU8gaW8gPSBnZXRDb2x1bW5JTygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaW8uaXNJbnNlcnRhYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAg\nICAgICAgICBfY29sc1tpXS5zZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9J\nTlNFUlQsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGlvLmlzVXBkYXRh\nYmxlKGksIGZhbHNlKSkKICAgICAgICAgICAgICAgICAgICBfY29sc1tpXS5z\nZXRGbGFnKENvbHVtbi5GTEFHX0RJUkVDVF9VUERBVEUsIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVz\nb2x2ZSBub24tcmVsYXRpb24gZmllbGQgbWFwcGluZ3Mgc28gdGhhdCB3aGVu\nIHdlIGRvIHJlbGF0aW9uCiAgICAgKiBtYXBwaW5ncyB0aGV5IGNhbiByZWx5\nIG9uIHRoZW0gZm9yIGpvaW5zLgogICAgICovCiAgICB2b2lkIHJlc29sdmVO\nb25SZWxhdGlvbk1hcHBpbmdzKCkgewogICAgICAgIC8vIG1ha2Ugc3VyZSBw\ncmltYXJ5IGtleSBmaWVsZHMgYXJlIHJlc29sdmVkIGZpcnN0IGJlY2F1c2Ug\nb3RoZXIKICAgICAgICAvLyBmaWVsZHMgbWlnaHQgcmVseSBvbiB0aGVtCiAg\nICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gZ2V0UHJpbWFyeUtleUZpZWxk\nTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgZm1zW2ldLnJlc29sdmUoTU9ERV9N\nQVBQSU5HKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBkZWZpbmVkIGZpZWxkcyB0\naGF0IGFyZSBzYWZlOyB0aGF0IGRvbid0IHJlbHkgb24gb3RoZXIgdHlwZXMK\nICAgICAgICAvLyBhbHNvIGJlaW5nIHJlc29sdmVkLiAgZG9uJ3QgdXNlIGdl\ndERlZmluZWRGaWVsZHMgYi9jIGl0IHJlbGllcyBvbgogICAgICAgIC8vIHdo\nZXRoZXIgZmllbGRzIGFyZSBtYXBwZWQsIHdoaWNoIGlzbid0IGtub3duIHll\ndAogICAgICAgIGZtcyA9IGdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgaWYgKGZtc1tpXS5nZXREZWZpbmluZ01ldGFEYXRhKCkgPT0gdGhpcwog\nICAgICAgICAgICAgICAgJiYgIWZtc1tpXS5pc1R5cGVQQygpICYmICFmbXNb\naV0uZ2V0S2V5KCkuaXNUeXBlUEMoKQogICAgICAgICAgICAgICAgJiYgIWZt\nc1tpXS5nZXRFbGVtZW50KCkuaXNUeXBlUEMoKSkKICAgICAgICAgICAgICAg\nIGZtc1tpXS5yZXNvbHZlKE1PREVfTUFQUElORyk7CgogICAgICAgIF9kaXNj\ncmltLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgICAgICBfdmVyc2lvbi5y\nZXNvbHZlKE1PREVfTUFQUElORyk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgaW5pdGlhbGl6ZU1hcHBpbmcoKSB7CiAgICAgICAgc3VwZXIuaW5pdGlh\nbGl6ZU1hcHBpbmcoKTsKCiAgICAgICAgRmllbGRNYXBwaW5nW10gZmllbGRz\nID0gZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nZmllbGRzW2ldLnJlc29sdmUoTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAg\nIF9kaXNjcmltLnJlc29sdmUoTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAg\nIF92ZXJzaW9uLnJlc29sdmUoTU9ERV9NQVBQSU5HX0lOSVQpOwogICAgICAg\nIF9zdHJhdGVneS5pbml0aWFsaXplKCk7CiAgICB9CgogICAgcHJvdGVjdGVk\nIHZvaWQgY2xlYXJEZWZpbmVkRmllbGRDYWNoZSgpIHsKICAgICAgICAvLyBq\ndXN0IG1ha2UgdGhpcyBtZXRob2QgYXZhaWxhYmxlIHRvIG90aGVyIGNsYXNz\nZXMgaW4gdGhpcyBwYWNrYWdlCiAgICAgICAgc3VwZXIuY2xlYXJEZWZpbmVk\nRmllbGRDYWNoZSgpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGNsZWFy\nU3ViY2xhc3NDYWNoZSgpIHsKICAgICAgICBzdXBlci5jbGVhclN1YmNsYXNz\nQ2FjaGUoKTsKICAgICAgICBfam9pblN1Yk1hcHMgPSBudWxsOwogICAgICAg\nIF9hc3NpZ25NYXBzID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nb3B5KENsYXNzTWV0YURhdGEgY2xzKSB7CiAgICAgICAgc3VwZXIuY29weShj\nbHMpOwogICAgICAgIGlmIChfc3ViY2xhc3NNb2RlID09IEludGVnZXIuTUFY\nX1ZBTFVFKQogICAgICAgICAgICBfc3ViY2xhc3NNb2RlID0gKChDbGFzc01h\ncHBpbmcpIGNscykuZ2V0U3ViY2xhc3NGZXRjaE1vZGUoKTsKICAgIH0KCiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiB2YWxpZGF0ZURhdGFTdG9yZUV4dGVuc2lv\nblByZWZpeChTdHJpbmcgcHJlZml4KSB7CiAgICAgICAgcmV0dXJuICJqZGJj\nLSIuZXF1YWxzKHByZWZpeCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENsYXNzU3RyYXRlZ3kgaW1wbGVt\nZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIFN0cmluZyBnZXRBbGlhcygpIHsKICAgICAgICByZXR1\ncm4gYXNzZXJ0U3RyYXRlZ3koKS5nZXRBbGlhcygpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIG1hcChib29sZWFuIGFkYXB0KSB7CiAgICAgICAgYXNzZXJ0\nU3RyYXRlZ3koKS5tYXAoYWRhcHQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGluaXRpYWxpemUoKSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5pbml0\naWFsaXplKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5zZXJ0KE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdl\nciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBh\nc3NlcnRTdHJhdGVneSgpLmluc2VydChzbSwgc3RvcmUsIHJtKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0ZWd5KCku\ndXBkYXRlKHNtLCBzdG9yZSwgcm0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGRlbGV0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3Rv\ncmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5kZWxldGUoc20sIHN0b3Jl\nLCBybSk7CiAgICB9CgogICAgcHVibGljIEJvb2xlYW4gaXNDdXN0b21JbnNl\ncnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7\nCiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuaXNDdXN0b21JbnNl\ncnQoc20sIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgQm9vbGVhbiBpc0N1\nc3RvbVVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5pc0N1\nc3RvbVVwZGF0ZShzbSwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyBCb29s\nZWFuIGlzQ3VzdG9tRGVsZXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpE\nQkNTdG9yZSBzdG9yZSkgewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVn\neSgpLmlzQ3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY3VzdG9tSW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmN1c3RvbUluc2VydChzbSwg\nc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGN1c3RvbVVwZGF0ZShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRl\nZ3koKS5jdXN0b21VcGRhdGUoc20sIHN0b3JlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBjdXN0b21EZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tRGVsZXRlKHNtLCBz\ndG9yZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2xhc3NNYXBwaW5n\nKENsYXNzTWFwcGluZyBvd25lcikgewogICAgICAgIGFzc2VydFN0cmF0ZWd5\nKCkuc2V0Q2xhc3NNYXBwaW5nKG93bmVyKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc1ByaW1hcnlLZXlPYmplY3RJZChib29sZWFuIGhhc0FsbCkg\newogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzUHJpbWFyeUtl\neU9iamVjdElkKGhhc0FsbCk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpv\naW5TdXBlcmNsYXNzKEpvaW5zIGpvaW5zLCBib29sZWFuIHRvVGhpcykgewog\nICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmpvaW5TdXBlcmNsYXNz\nKGpvaW5zLCB0b1RoaXMpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzRWFnZXJTZWxlY3QoU2VsZWN0IHNlbCwgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIENsYXNzTWFwcGlu\nZyBiYXNlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuc3VwcG9ydHNFYWdlclNlbGVj\ndChzZWwsIHNtLCBzdG9yZSwgYmFzZSwKICAgICAgICAgICAgZmV0Y2gpOwog\nICAgfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBjdXN0b21M\nb2FkKEpEQkNTdG9yZSBzdG9yZSwgYm9vbGVhbiBzdWJjbGFzc2VzLAogICAg\nICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGxvbmcgc3RhcnRJ\nZHgsIGxvbmcgZW5kSWR4KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmN1c3RvbUxvYWQo\nc3RvcmUsIHN1YmNsYXNzZXMsIGZldGNoLAogICAgICAgICAgICBzdGFydElk\neCwgZW5kSWR4KTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjdXN0b21M\nb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwK\nICAgICAgICBQQ1N0YXRlIHN0YXRlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24sIENsYXNzTm90\nRm91bmRFeGNlcHRpb24gewogICAgICAgIHJldHVybiBhc3NlcnRTdHJhdGVn\neSgpLmN1c3RvbUxvYWQoc20sIHN0b3JlLCBzdGF0ZSwgZmV0Y2gpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXN1bHQpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGFzc2VydFN0\ncmF0ZWd5KCkuY3VzdG9tTG9hZChzbSwgc3RvcmUsIGZldGNoLCByZXN1bHQp\nOwogICAgfQoKICAgIHByaXZhdGUgQ2xhc3NTdHJhdGVneSBhc3NlcnRTdHJh\ndGVneSgpIHsKICAgICAgICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAg\nIHJldHVybiBfc3RyYXRlZ3k7CiAgICB9Cn0K\n","encoding":"base64"}

