{"sha":"9208395c86dc24aeafce9b947a7214b006ddb42e","node_id":"MDQ6QmxvYjIwNjM2NDo5MjA4Mzk1Yzg2ZGMyNGFlYWZjZTliOTQ3YTcyMTRiMDA2ZGRiNDJl","size":6213,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9208395c86dc24aeafce9b947a7214b006ddb42e","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTW9kaWZpZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5zdHJhdHMuTm9uZURpc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1cGVyY2xhc3NE\naXNjcmltaW5hdG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5WYWx1ZU1hcERpc2NyaW1pbmF0b3JTdHJh\ndGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5D\nb2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nTWV0YURhdGFFeGNlcHRpb247CgovKioKICogSW5mb3JtYXRpb24gYWJvdXQg\ndGhlIG1hcHBpbmcgZnJvbSBhIGRpc2NyaW1pbmF0b3IgdG8gdGhlIHNjaGVt\nYSwgaW4KICogcmF3IGZvcm0uIFRoZSBjb2x1bW5zIGFuZCB0YWJsZXMgdXNl\nZCBpbiBtYXBwaW5nIGluZm8gd2lsbCBub3QgYmUgcGFydCBvZgogKiB0aGUg\ne0BsaW5rIFNjaGVtYUdyb3VwfSB1c2VkIGF0IHJ1bnRpbWUuIFJhdGhlciwg\ndGhleSB3aWxsIGJlIHN0cnVjdHMKICogd2l0aCB0aGUgcmVsZXZhbnQgcGll\nY2VzIG9mIGluZm9ybWF0aW9uIGZpbGxlZCBpbi4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBEaXNjcmltaW5hdG9yTWFwcGlu\nZ0luZm8KICAgIGV4dGVuZHMgTWFwcGluZ0luZm8gewoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvLmNsYXNz\nKTsKCiAgICBwcml2YXRlIFN0cmluZyBfdmFsdWUgPSBudWxsOwoKICAgIC8q\nKgogICAgICogUmF3IGRpc2NyaW1pbmF0b3IgdmFsdWUgc3RyaW5nLgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbHVlKCkgewogICAgICAgIHJl\ndHVybiBfdmFsdWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSYXcgZGlzY3Jp\nbWluYXRvciB2YWx1ZSBzdHJpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFZhbHVlKFN0cmluZyB2YWx1ZSkgewogICAgICAgIF92YWx1ZSA9IHZh\nbHVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkaXNjcmlt\naW5hdG9yIHZhbHVlIGFzIGFuIG9iamVjdCBvZiB0aGUgcmlnaHQgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRWYWx1ZShEaXNjcmltaW5h\ndG9yIGRpc2NyaW0sIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAoZGlz\nY3JpbS5nZXRWYWx1ZSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBk\naXNjcmltLmdldFZhbHVlKCk7CiAgICAgICAgaWYgKF92YWx1ZSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZGlzY3JpbS5nZXRNYXBwaW5nUmVwb3Np\ndG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAg\nZ2V0RGlzY3JpbWluYXRvclZhbHVlKGRpc2NyaW0sIGFkYXB0KTsKCiAgICAg\nICAgaWYgKF92YWx1ZS5sZW5ndGgoKSA+IDAgJiYgKF92YWx1ZS5jaGFyQXQo\nMCkgPT0gJy0nIAogICAgICAgICAgICB8fCBDaGFyYWN0ZXIuaXNEaWdpdChf\ndmFsdWUuY2hhckF0KDApKSkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGlmIChfdmFsdWUuaW5kZXhPZignLicpID09IC0xKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW50ZWdlcihfdmFsdWUpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoX3ZhbHVlKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZGlzY3JpbS12YWx1ZSIsCiAgICAgICAgICAgICAgICAgICAg\nZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKSwgX3ZhbHVlKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCJudWxsIi5lcXVhbHNJZ25v\ncmVDYXNlKF92YWx1ZSkpCiAgICAgICAgICAgIHJldHVybiBEaXNjcmltaW5h\ndG9yLk5VTEw7CgogICAgICAgIC8vIHN0cmlwIHF1b3RlcwogICAgICAgIGlm\nIChfdmFsdWUubGVuZ3RoKCkgPiAwICYmIF92YWx1ZS5jaGFyQXQoMCkgPT0g\nJ1wnJykKICAgICAgICAgICAgcmV0dXJuIF92YWx1ZS5zdWJzdHJpbmcoMSwg\nX3ZhbHVlLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgcmV0dXJuIF92YWx1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29sdW1ucyBzZXQg\nZm9yIHRoaXMgZGlzY3JpbWluYXRvciwgYmFzZWQgb24gdGhlIGdpdmVuCiAg\nICAgKiB0ZW1wbGF0ZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBn\nZXRDb2x1bW5zKERpc2NyaW1pbmF0b3IgZGlzY3JpbSwgQ29sdW1uW10gdG1w\nbGF0ZXMsCiAgICAgICAgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIFRhYmxl\nIHRhYmxlID0gZGlzY3JpbS5nZXRDbGFzc01hcHBpbmcoKS5nZXRUYWJsZSgp\nOwogICAgICAgIGRpc2NyaW0uZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRN\nYXBwaW5nRGVmYXVsdHMoKS5wb3B1bGF0ZUNvbHVtbnMKICAgICAgICAgICAg\nKGRpc2NyaW0sIHRhYmxlLCB0bXBsYXRlcyk7CiAgICAgICAgcmV0dXJuIGNy\nZWF0ZUNvbHVtbnMoZGlzY3JpbSwgbnVsbCwgdG1wbGF0ZXMsIHRhYmxlLCBh\nZGFwdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGluZGV4\nIHRvIHNldCBvbiB0aGUgZGlzY3JpbWluYXRvciBjb2x1bW5zLCBvciBudWxs\nIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBnZXRJbmRleChE\naXNjcmltaW5hdG9yIGRpc2NyaW0sIENvbHVtbltdIGNvbHMsIGJvb2xlYW4g\nYWRhcHQpIHsKICAgICAgICBJbmRleCBpZHggPSBudWxsOwogICAgICAgIGlm\nIChjb2xzLmxlbmd0aCA+IDApCiAgICAgICAgICAgIGlkeCA9IGRpc2NyaW0u\nZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4K\nICAgICAgICAgICAgICAgIGdldEluZGV4KGRpc2NyaW0sIGNvbHNbMF0uZ2V0\nVGFibGUoKSwgY29scyk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUluZGV4KGRp\nc2NyaW0sIG51bGwsIGlkeCwgY29scywgYWRhcHQpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3luY2hyb25pemUgaW50ZXJuYWwgaW5mb3JtYXRpb24gd2l0\naCB0aGUgbWFwcGluZyBkYXRhIGZvciB0aGUgZ2l2ZW4KICAgICAqIGRpc2Ny\naW1pbmF0b3IuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN5bmNXaXRoKERp\nc2NyaW1pbmF0b3IgZGlzYykgewogICAgICAgIGNsZWFyKGZhbHNlKTsKCiAg\nICAgICAgLy8gc2V0IGlvIGJlZm9yZSBzeW5jaW5nIGNvbHMKICAgICAgICBz\nZXRDb2x1bW5JTyhkaXNjLmdldENvbHVtbklPKCkpOwogICAgICAgIHN5bmND\nb2x1bW5zKGRpc2MsIGRpc2MuZ2V0Q29sdW1ucygpLCBkaXNjLmdldFZhbHVl\nKCkgIT0gbnVsbAogICAgICAgICAgICAmJiAhKGRpc2MuZ2V0VmFsdWUoKWlu\nc3RhbmNlb2YgU3RyaW5nKSk7CiAgICAgICAgc3luY0luZGV4KGRpc2MsIGRp\nc2MuZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKGRpc2MuZ2V0VmFsdWUoKSA9\nPSBEaXNjcmltaW5hdG9yLk5VTEwpCiAgICAgICAgICAgIF92YWx1ZSA9ICJu\ndWxsIjsKICAgICAgICBlbHNlIGlmIChkaXNjLmdldFZhbHVlKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgX3ZhbHVlID0gZGlzYy5nZXRWYWx1ZSgpLnRvU3Ry\naW5nKCk7CgogICAgICAgIGlmIChkaXNjLmdldFN0cmF0ZWd5KCkgPT0gbnVs\nbAogICAgICAgICAgICB8fCBkaXNjLmdldFN0cmF0ZWd5KClpbnN0YW5jZW9m\nIFN1cGVyY2xhc3NEaXNjcmltaW5hdG9yU3RyYXRlZ3kpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgLy8gZXhwbGljaXQgZGlzY3JpbWluYXRvciBz\ndHJhdGVneSBpZjoKICAgICAgICAvLyAtIHVubWFwcGVkIGNsYXNzIGFuZCBk\naXNjcmltaW5hdG9yIGlzIG1hcHBlZAogICAgICAgIC8vIC0gZmluYWwgYmFz\nZSBjbGFzcyBhbmQgZGlzY3JpbWluYXRvciBpcyBtYXBwZWQKICAgICAgICAv\nLyAtIHRhYmxlLXBlci1jbGFzcyBzdWJjbGFzcyBhbmQgZGlzY3JpbWluYXRv\nciBpcyBtYXBwZWQKICAgICAgICAvLyAtIG1hcHBlZCBzdWJjbGFzcyBhbmQg\nZG9lc24ndCByZWx5IG9uIHN1cGVyY2xhc3MgZGlzY3JpbWluYXRvcgogICAg\nICAgIC8vIC0gbWFwcGVkIGJhc2UgY2xhc3MgYW5kIGRvZXNuJ3QgdXNlIHZh\nbHVlLW1hcCBzdHJhdGVneSB3aXRoIHZhbHVlCiAgICAgICAgLy8gICBhbmQg\naXNuJ3QgYSBmaW5hbCBjbGFzcyB0aGF0IHVzZXMgdGhlIGZpbmFsIHN0cmF0\nZWd5CiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IGRpc2MuZ2V0Q2xhc3NN\nYXBwaW5nKCk7CiAgICAgICAgU3RyaW5nIHN0cmF0ID0gZGlzYy5nZXRTdHJh\ndGVneSgpLmdldEFsaWFzKCk7CiAgICAgICAgYm9vbGVhbiBzeW5jID0gZmFs\nc2U7CgogICAgICAgIGlmICghY2xzLmlzTWFwcGVkKCkKICAgICAgICAgICAg\nfHwgKGNscy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBu\ndWxsCiAgICAgICAgICAgICYmIE1vZGlmaWVyLmlzRmluYWwoY2xzLmdldERl\nc2NyaWJlZFR5cGUoKS5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHx8\nIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0gbnVs\nbAogICAgICAgICAgICAmJiBjbHMuZ2V0TWFwcGVkUENTdXBlcmNsYXNzTWFw\ncGluZygpICE9IG51bGwpKQogICAgICAgICAgICBzeW5jID0gIU5vbmVEaXNj\ncmltaW5hdG9yU3RyYXRlZ3kuQUxJQVMuZXF1YWxzKHN0cmF0KTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN5bmMgPSBjbHMuZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgfHwg\nX3ZhbHVlID09IG51bGwKICAgICAgICAgICAgICAgIHx8ICFWYWx1ZU1hcERp\nc2NyaW1pbmF0b3JTdHJhdGVneS5BTElBUy5lcXVhbHMoc3RyYXQpOwoKICAg\nICAgICBpZiAoc3luYykKICAgICAgICAgICAgc2V0U3RyYXRlZ3koc3RyYXQp\nOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyKGJvb2xlYW4gY2Fu\nRmxhZ3MpIHsKICAgICAgICBzdXBlci5jbGVhcihjYW5GbGFncyk7CiAgICAg\nICAgX3ZhbHVlID0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb3B5\nKE1hcHBpbmdJbmZvIGluZm8pIHsKICAgICAgICBzdXBlci5jb3B5KGluZm8p\nOwogICAgICAgIGlmICghKGluZm8gaW5zdGFuY2VvZiBEaXNjcmltaW5hdG9y\nTWFwcGluZ0luZm8pKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlm\nIChfdmFsdWUgPT0gbnVsbCkKICAgICAgICAgICAgX3ZhbHVlID0gKChEaXNj\ncmltaW5hdG9yTWFwcGluZ0luZm8pIGluZm8pLmdldFZhbHVlKCk7CiAgICB9\nCn0K\n","encoding":"base64"}

