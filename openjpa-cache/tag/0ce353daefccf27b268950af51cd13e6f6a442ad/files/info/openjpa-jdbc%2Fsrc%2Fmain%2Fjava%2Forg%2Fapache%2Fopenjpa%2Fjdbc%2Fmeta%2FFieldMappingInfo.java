{"sha":"9106e5fc32c34e55fb715ca0830671e911afe28e","node_id":"MDQ6QmxvYjIwNjM2NDo5MTA2ZTVmYzMyYzM0ZTU1ZmI3MTVjYTA4MzA2NzFlOTExYWZlMjhl","size":11009,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/9106e5fc32c34e55fb715ca0830671e911afe28e","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW5J\nTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3Jl\naWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi54bWwuQ29tbWVudGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5NZXRhRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBJbmZvcm1hdGlvbiBhYm91\ndCB0aGUgbWFwcGluZyBmcm9tIGEgZmllbGQgdG8gdGhlIHNjaGVtYSwgaW4g\ncmF3IGZvcm0uCiAqIFRoZSBjb2x1bW5zIGFuZCB0YWJsZXMgdXNlZCBpbiBt\nYXBwaW5nIGluZm8gd2lsbCBub3QgYmUgcGFydCBvZiB0aGUKICoge0BsaW5r\nIFNjaGVtYUdyb3VwfSB1c2VkIGF0IHJ1bnRpbWUuIFJhdGhlciwgdGhleSB3\naWxsIGJlIHN0cnVjdHMKICogd2l0aCB0aGUgcmVsZXZhbnQgcGllY2VzIG9m\nIGluZm9ybWF0aW9uIGZpbGxlZCBpbi4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICovCnB1YmxpYyBjbGFzcyBGaWVsZE1hcHBpbmdJbmZvCiAgICBleHRl\nbmRzIE1hcHBpbmdJbmZvCiAgICBpbXBsZW1lbnRzIENvbW1lbnRhYmxlIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEZpZWxkTWFwcGluZ0luZm8u\nY2xhc3MpOwoKICAgIHByaXZhdGUgU3RyaW5nIF90YWJsZU5hbWUgPSBudWxs\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9vdXRlciA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBDb2x1bW4gX29yZGVyQ29sID0gbnVsbDsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfY2FuT3JkZXJDb2wgPSB0cnVlOwogICAgcHJpdmF0ZSBTdHJpbmdb\nXSBfY29tbWVudHMgPSBudWxsOwoKICAgIC8qKgogICAgICogVGhlIHVzZXIt\nc3VwcGxpZWQgbmFtZSBvZiB0aGUgdGFibGUgZm9yIHRoaXMgZmllbGQuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VGFibGVOYW1lKCkgewogICAg\nICAgIHJldHVybiBfdGFibGVOYW1lOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHVzZXItc3VwcGxpZWQgbmFtZSBvZiB0aGUgdGFibGUgZm9yIHRoaXMg\nZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRhYmxlTmFtZShT\ndHJpbmcgdGFibGVOYW1lKSB7CiAgICAgICAgX3RhYmxlTmFtZSA9IHRhYmxl\nTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGZpZWxk\nJ3MgdGFibGUgaXMgam9pbmVkIHRvIHRoZSBjbGFzcyB0YWJsZSB0aHJvdWdo\nIGFuCiAgICAgKiBvdXRlciBqb2luLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0pvaW5PdXRlcigpIHsKICAgICAgICByZXR1cm4gX291dGVyOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZmllbGQncyB0YWJs\nZSBpcyBqb2luZWQgdG8gdGhlIGNsYXNzIHRhYmxlIHRocm91Z2ggYW4KICAg\nICAqIG91dGVyIGpvaW4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpv\naW5PdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgX291dGVyID0gb3V0\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSYXcgc3ludGhldGljIG9yZGVy\naW5nIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIENvbHVtbiBnZXRPcmRl\nckNvbHVtbigpIHsKICAgICAgICByZXR1cm4gX29yZGVyQ29sOwogICAgfQoK\nICAgIC8qKgogICAgICogUmF3IHN5bnRoZXRpYyBvcmRlcmluZyBjb2x1bW4u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9yZGVyQ29sdW1uKENvbHVt\nbiBvcmRlcikgewogICAgICAgIF9vcmRlckNvbCA9IG9yZGVyOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB3ZSBjYW4gaGF2ZSBhbiBvcmRlcmlu\nZyBjb2x1bW4uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNhbk9yZGVy\nQ29sdW1uKCkgewogICAgICAgIHJldHVybiBfY2FuT3JkZXJDb2w7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHdlIGNhbiBoYXZlIGFuIG9yZGVy\naW5nIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FuT3Jk\nZXJDb2x1bW4oYm9vbGVhbiBjYW5PcmRlcikgewogICAgICAgIF9jYW5PcmRl\nckNvbCA9IGNhbk9yZGVyOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSB0YWJsZSBmb3IgdGhlIGdpdmVuIGZpZWxkLCBvciBudWxsIGlmIG5v\nIHRhYmxlIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgVGFibGUgZ2V0VGFi\nbGUoZmluYWwgRmllbGRNYXBwaW5nIGZpZWxkLCBib29sZWFuIGNyZWF0ZSwK\nICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKF90YWJsZU5h\nbWUgPT0gbnVsbCAmJiAhY3JlYXRlKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgVGFibGUgdGFibGUgPSBmaWVsZC5nZXREZWZpbmluZ01h\ncHBpbmcoKS5nZXRUYWJsZSgpOwogICAgICAgIFNjaGVtYSBzY2hlbWEgPSAo\ndGFibGUgPT0gbnVsbCkgPyBudWxsIDogdGFibGUuZ2V0U2NoZW1hKCk7Cgog\nICAgICAgIC8vIGlmIHdlIGhhdmUgbm8gam9pbiBjb2x1bW5zIGRlZmluZWQs\nIHRoZXJlIG1heSBiZSBjbGFzcy1sZXZlbCBqb2luCiAgICAgICAgLy8gaW5m\nb3JtYXRpb24gd2l0aCBhIG1vcmUgZnVsbHktcXVhbGlmaWVkIG5hbWUgZm9y\nIG91ciB0YWJsZQogICAgICAgIFN0cmluZyB0YWJsZU5hbWUgPSBfdGFibGVO\nYW1lOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCAmJiBnZXRDb2x1\nbW5zKCkuaXNFbXB0eSgpKQogICAgICAgICAgICB0YWJsZU5hbWUgPSBmaWVs\nZC5nZXREZWZpbmluZ01hcHBpbmcoKS5nZXRNYXBwaW5nSW5mbygpLgogICAg\nICAgICAgICAgICAgZ2V0U2Vjb25kYXJ5VGFibGVOYW1lKHRhYmxlTmFtZSk7\nCgogICAgICAgIHJldHVybiBjcmVhdGVUYWJsZShmaWVsZCwgbmV3IFRhYmxl\nRGVmYXVsdHMoKSB7CiAgICAgICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0KFNj\naGVtYSBzY2hlbWEpIHsKICAgICAgICAgICAgICAgIC8vIGRlbGF5IHRoaXMg\nc28gdGhhdCB3ZSBkb24ndCBkbyBzY2hlbWEgcmVmbGVjdGlvbiBmb3IgdW5p\ncXVlCiAgICAgICAgICAgICAgICAvLyB0YWJsZSBuYW1lIHVubGVzcyBuZWNl\nc3NhcnkKICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRNYXBwaW5n\nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAg\nICAgICAgICAgIGdldFRhYmxlTmFtZShmaWVsZCwgc2NoZW1hKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0sIHNjaGVtYSwgdGFibGVOYW1lLCBhZGFwdCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGpvaW4gZnJvbSB0\naGUgZmllbGQgdGFibGUgdG8gdGhlIG93bmluZyBjbGFzcyB0YWJsZS4KICAg\nICAqLwogICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0Sm9pbihmaW5hbCBGaWVs\nZE1hcHBpbmcgZmllbGQsIFRhYmxlIHRhYmxlLAogICAgICAgIGJvb2xlYW4g\nYWRhcHQpIHsKICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vIGpvaW4gY29sdW1u\ncyBkZWZpbmVkLCBjaGVjayBjbGFzcy1sZXZlbCBqb2luCiAgICAgICAgTGlz\ndCBjb2xzID0gZ2V0Q29sdW1ucygpOwogICAgICAgIGlmIChjb2xzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgY29scyA9IGZpZWxkLmdldERlZmluaW5nTWFw\ncGluZygpLmdldE1hcHBpbmdJbmZvKCkuCiAgICAgICAgICAgICAgICBnZXRT\nZWNvbmRhcnlUYWJsZUpvaW5Db2x1bW5zKF90YWJsZU5hbWUpOwoKICAgICAg\nICBGb3JlaWduS2V5RGVmYXVsdHMgZGVmID0gbmV3IEZvcmVpZ25LZXlEZWZh\ndWx0cygpIHsKICAgICAgICAgICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0KFRh\nYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWduLCBib29sZWFuIGludmVyc2UpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRNYXBwaW5nUmVwb3Np\ndG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAg\nICAgIGdldEpvaW5Gb3JlaWduS2V5KGZpZWxkLCBsb2NhbCwgZm9yZWlnbik7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBvcHVs\nYXRlKFRhYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWduLCBDb2x1bW4gY29sLAog\nICAgICAgICAgICAgICAgT2JqZWN0IHRhcmdldCwgYm9vbGVhbiBpbnZlcnNl\nLCBpbnQgcG9zLCBpbnQgY29scykgewogICAgICAgICAgICAgICAgZmllbGQu\nZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4K\nICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUpvaW5Db2x1bW4oZmllbGQs\nIGxvY2FsLCBmb3JlaWduLCBjb2wsIHRhcmdldCwKICAgICAgICAgICAgICAg\nICAgICAgICAgcG9zLCBjb2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH07\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IGZpZWxkLmdldERlZmluaW5n\nTWFwcGluZygpOwogICAgICAgIHJldHVybiBjcmVhdGVGb3JlaWduS2V5KGZp\nZWxkLCAiam9pbiIsIGNvbHMsIGRlZiwgdGFibGUsIGNscywgY2xzLAogICAg\nICAgICAgICBmYWxzZSwgYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICog\nVW5pcXVlIGNvbnN0cmFpbnQgb24gdGhlIGZpZWxkIGpvaW4uCiAgICAgKi8K\nICAgIHB1YmxpYyBVbmlxdWUgZ2V0Sm9pblVuaXF1ZShGaWVsZE1hcHBpbmcg\nZmllbGQsIGJvb2xlYW4gZGVmLAogICAgICAgIGJvb2xlYW4gYWRhcHQpIHsK\nICAgICAgICBGb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0Sm9pbkZvcmVpZ25L\nZXkoKTsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIFVuaXF1ZSB1bnEgPSBudWxsOwogICAgICAg\nIGlmIChmay5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAg\ndW5xID0gZmllbGQuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5n\nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgIGdldEpvaW5VbmlxdWUoZmll\nbGQsIGZrLmdldFRhYmxlKCksIGZrLmdldENvbHVtbnMoKSk7CiAgICAgICAg\ncmV0dXJuIGNyZWF0ZVVuaXF1ZShmaWVsZCwgImpvaW4iLCB1bnEsIGZrLmdl\ndENvbHVtbnMoKSwgYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICogSW5k\nZXggb24gdGhlIGZpZWxkIGpvaW4uCiAgICAgKi8KICAgIHB1YmxpYyBJbmRl\neCBnZXRKb2luSW5kZXgoRmllbGRNYXBwaW5nIGZpZWxkLCBib29sZWFuIGFk\nYXB0KSB7CiAgICAgICAgRm9yZWlnbktleSBmayA9IGZpZWxkLmdldEpvaW5G\nb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBJbmRleCBpZHggPSBudWxsOwog\nICAgICAgIGlmIChmay5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAg\nICAgICAgaWR4ID0gZmllbGQuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRN\nYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgIGdldEpvaW5JbmRl\neChmaWVsZCwgZmsuZ2V0VGFibGUoKSwgZmsuZ2V0Q29sdW1ucygpKTsKICAg\nICAgICByZXR1cm4gY3JlYXRlSW5kZXgoZmllbGQsICJqb2luIiwgaWR4LCBm\nay5nZXRDb2x1bW5zKCksIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgb3JkZXJpbmcgY29sdW1uIGZvciB0aGlzIGZpZWxkLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW4gZ2V0\nT3JkZXJDb2x1bW4oRmllbGRNYXBwaW5nIGZpZWxkLCBUYWJsZSB0YWJsZSwK\nICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKF9vcmRlckNv\nbCAhPSBudWxsICYmIGZpZWxkLmdldE9yZGVyRGVjbGFyYXRpb24oKSAhPSBu\ndWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm9yZGVyLWNvbmZsaWN0IiwgZmllbGQpKTsKCiAgICAgICAg\nLy8gcmVzZXQgSU8KICAgICAgICBzZXRDb2x1bW5JTyhudWxsKTsKCiAgICAg\nICAgLy8gaGFzIHVzZXIgaGFzIGV4cGxpY2l0bHkgdHVybmVkIG9yZGVyaW5n\nIG9mZj8KICAgICAgICBpZiAoIV9jYW5PcmRlckNvbCB8fCBmaWVsZC5nZXRP\ncmRlckRlY2xhcmF0aW9uKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIC8vIGlmIG5vIGRlZmF1bHRzIHJldHVybiBudWxs\nCiAgICAgICAgTWFwcGluZ0RlZmF1bHRzIGRlZiA9IGZpZWxkLmdldE1hcHBp\nbmdSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgIGdldE1hcHBpbmdEZWZhdWx0\ncygpOwogICAgICAgIGlmIChfb3JkZXJDb2wgPT0gbnVsbCAmJiAoIWFkYXB0\nICYmICFkZWYuZGVmYXVsdE1pc3NpbmdJbmZvKCkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sdW1uIHRtcGxhdGUgPSBuZXcgQ29s\ndW1uKCk7CiAgICAgICAgdG1wbGF0ZS5zZXROYW1lKCJvcmRyIik7CiAgICAg\nICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAg\nICBpZiAoIWRlZi5wb3B1bGF0ZU9yZGVyQ29sdW1ucyhmaWVsZCwgdGFibGUs\nIG5ldyBDb2x1bW5bXXsgdG1wbGF0ZSB9KQogICAgICAgICAgICAmJiBfb3Jk\nZXJDb2wgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIGlmIChfb3JkZXJDb2wgIT0gbnVsbCAmJiAoX29yZGVyQ29sLmdldEZs\nYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKQogICAgICAgICAgICB8fCBf\nb3JkZXJDb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpKSB7\nCiAgICAgICAgICAgIENvbHVtbklPIGlvID0gbmV3IENvbHVtbklPKCk7CiAg\nICAgICAgICAgIGlvLnNldEluc2VydGFibGUoMCwgIV9vcmRlckNvbC5nZXRG\nbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkpOwogICAgICAgICAgICBp\nby5zZXRVcGRhdGFibGUoMCwgIV9vcmRlckNvbC5nZXRGbGFnKENvbHVtbi5G\nTEFHX1VOVVBEQVRBQkxFKSk7CiAgICAgICAgICAgIHNldENvbHVtbklPKGlv\nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtZXJnZUNvbHVtbihmaWVs\nZCwgIm9yZGVyIiwgdG1wbGF0ZSwgdHJ1ZSwgX29yZGVyQ29sLCB0YWJsZSwK\nICAgICAgICAgICAgYWRhcHQsIGRlZi5kZWZhdWx0TWlzc2luZ0luZm8oKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jaHJvbml6ZSBpbnRlcm5hbCBp\nbmZvcm1hdGlvbiB3aXRoIHRoZSBtYXBwaW5nIGRhdGEgZm9yIHRoZSBnaXZl\nbgogICAgICogZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN5bmNX\naXRoKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAgICAgIGNsZWFyKGZhbHNl\nKTsKCiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCkgIT0g\nbnVsbCkKICAgICAgICAgICAgX3RhYmxlTmFtZSA9IGZpZWxkLmdldE1hcHBp\nbmdSZXBvc2l0b3J5KCkuZ2V0REJEaWN0aW9uYXJ5KCkuCiAgICAgICAgICAg\nICAgICBnZXRGdWxsTmFtZShmaWVsZC5nZXRUYWJsZSgpLCB0cnVlKTsKCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIGRlZiA9IGZpZWxkLmdldERlZmluaW5nTWFw\ncGluZygpOwogICAgICAgIHNldENvbHVtbklPKGZpZWxkLmdldEpvaW5Db2x1\nbW5JTygpKTsKICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXko\nKSAhPSBudWxsICYmIGRlZi5nZXRUYWJsZSgpICE9IG51bGwpCiAgICAgICAg\nICAgIHN5bmNGb3JlaWduS2V5KGZpZWxkLCBmaWVsZC5nZXRKb2luRm9yZWln\nbktleSgpLAogICAgICAgICAgICAgICAgZmllbGQuZ2V0VGFibGUoKSwgZGVm\nLmdldFRhYmxlKCkpOwogICAgICAgIF9vdXRlciA9IGZpZWxkLmlzSm9pbk91\ndGVyKCk7CgogICAgICAgIHN5bmNJbmRleChmaWVsZCwgZmllbGQuZ2V0Sm9p\nbkluZGV4KCkpOwogICAgICAgIHN5bmNVbmlxdWUoZmllbGQsIGZpZWxkLmdl\ndEpvaW5VbmlxdWUoKSk7CiAgICAgICAgc3luY09yZGVyQ29sdW1uKGZpZWxk\nKTsKICAgICAgICBzeW5jU3RyYXRlZ3koZmllbGQpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3luY2hyb25pemUgaW50ZXJuYWwgbWFwcGluZyBzdHJhdGVn\neSBpbmZvcm1hdGlvbiB3aXRoIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc3luY1N0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVs\nZCkgewogICAgICAgIHNldFN0cmF0ZWd5KG51bGwpOwogICAgICAgIGlmIChm\naWVsZC5nZXRIYW5kbGVyKCkgIT0gbnVsbCB8fCBmaWVsZC5nZXRTdHJhdGVn\neSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nZXhwbGljaXQgc3RyYXRlZ3kgaWYgdGhlIHN0cmF0ZWd5IGlzbid0IHRoZSBl\neHBlY3RlZCBkZWZhdWx0CiAgICAgICAgU3RyYXRlZ3kgc3RyYXQgPSBmaWVs\nZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmRlZmF1bHRTdHJhdGVneQogICAg\nICAgICAgICAoZmllbGQsIGZhbHNlKTsKICAgICAgICBpZiAoc3RyYXQgPT0g\nbnVsbCB8fCAhc3RyYXQuZ2V0QWxpYXMoKS5lcXVhbHMoZmllbGQuZ2V0QWxp\nYXMoKSkpCiAgICAgICAgICAgIHNldFN0cmF0ZWd5KGZpZWxkLmdldEFsaWFz\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU3luY2hyb25pemUgaW50ZXJu\nYWwgb3JkZXIgY29sdW1uIGluZm9ybWF0aW9uIHdpdGggdGhlIGdpdmVuIGZp\nZWxkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzeW5jT3JkZXJDb2x1bW4o\nRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGZpZWxkLmdldE9y\nZGVyQ29sdW1uKCkgIT0gbnVsbCkKICAgICAgICAgICAgX29yZGVyQ29sID0g\nc3luY0NvbHVtbihmaWVsZCwgZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSwgMSwg\nZmFsc2UsCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUYWJsZSgpLCBudWxs\nLCBudWxsLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfb3Jk\nZXJDb2wgPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc1Nj\naGVtYUNvbXBvbmVudHMoKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmhhc1Nj\naGVtYUNvbXBvbmVudHMoKSB8fCBfdGFibGVOYW1lICE9IG51bGwKICAgICAg\nICAgICAgfHwgX29yZGVyQ29sICE9IG51bGw7CiAgICB9CgogICAgcHJvdGVj\ndGVkIHZvaWQgY2xlYXIoYm9vbGVhbiBjYW5GbGFncykgewogICAgICAgIHN1\ncGVyLmNsZWFyKGNhbkZsYWdzKTsKICAgICAgICBfdGFibGVOYW1lID0gbnVs\nbDsKICAgICAgICBfb3JkZXJDb2wgPSBudWxsOwogICAgICAgIGlmIChjYW5G\nbGFncykKICAgICAgICAgICAgX2Nhbk9yZGVyQ29sID0gdHJ1ZTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjb3B5KE1hcHBpbmdJbmZvIGluZm8pIHsKICAg\nICAgICBzdXBlci5jb3B5KGluZm8pOwogICAgICAgIGlmICghKGluZm8gaW5z\ndGFuY2VvZiBGaWVsZE1hcHBpbmdJbmZvKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBGaWVsZE1hcHBpbmdJbmZvIGZpbmZvID0gKEZpZWxkTWFw\ncGluZ0luZm8pIGluZm87CiAgICAgICAgaWYgKF90YWJsZU5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgX3RhYmxlTmFtZSA9IGZpbmZvLmdldFRhYmxlTmFt\nZSgpOwogICAgICAgIGlmICghX291dGVyKQogICAgICAgICAgICBfb3V0ZXIg\nPSBmaW5mby5pc0pvaW5PdXRlcigpOwogICAgICAgIGlmIChfY2FuT3JkZXJD\nb2wgJiYgX29yZGVyQ29sID09IG51bGwpCiAgICAgICAgICAgIF9jYW5PcmRl\nckNvbCA9IGZpbmZvLmNhbk9yZGVyQ29sdW1uKCk7CiAgICAgICAgaWYgKF9j\nYW5PcmRlckNvbCAmJiBmaW5mby5nZXRPcmRlckNvbHVtbigpICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKF9vcmRlckNvbCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX29yZGVyQ29sID0gbmV3IENvbHVtbigpOwogICAgICAgICAg\nICBfb3JkZXJDb2wuY29weShmaW5mby5nZXRPcmRlckNvbHVtbigpKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZ1tdIGdldENvbW1lbnRz\nKCkgewogICAgICAgIHJldHVybiAoX2NvbW1lbnRzID09IG51bGwpID8gRU1Q\nVFlfQ09NTUVOVFMgOiBfY29tbWVudHM7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Q29tbWVudHMoU3RyaW5nW10gY29tbWVudHMpIHsKICAgICAgICBf\nY29tbWVudHMgPSBjb21tZW50czsKICAgIH0KfQo=\n","encoding":"base64"}

