{"sha":"7879833ae969a3b1a310064e3bd8471f9b09f44d","node_id":"MDQ6QmxvYjIwNjM2NDo3ODc5ODMzYWU5NjlhM2IxYTMxMDA2NGUzYmQ4NDcxZjliMDlmNDRk","size":65500,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7879833ae969a3b1a310064e3bd8471f9b09f44d","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgamF2YS5zcWwuVHlwZXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1u\nSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9y\nZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuTWV0YURhdGFDb250ZXh0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgppbXBvcnQg\nc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQmFzZSBjbGFzcyBzdG9yaW5n\nIHJhdyBtYXBwaW5nIGluZm9ybWF0aW9uOyBkZWZpbmVzIHV0aWxpdHkgbWV0\naG9kcyBmb3IKICogY29udmVydGluZyByYXcgbWFwcGluZyBpbmZvcm1hdGlv\nbiB0byBmdWxsIG1hcHBpbmcgdG8gdGhlIHNjaGVtYS4KICoKICogQGF1dGhv\nciBBYmUgV2hpdGUKICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBNYXBwaW5n\nSW5mbyB7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSk9JTl9OT05F\nID0gMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEpPSU5fRk9SV0FS\nRCA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBKT0lOX0lOVkVS\nU0UgPSAyOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdCBOVUxM\nID0gbmV3IE9iamVjdCgpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAo\nTWFwcGluZ0luZm8uY2xhc3MpOwoKICAgIHByaXZhdGUgU3RyaW5nIF9zdHJh\ndGVneSA9IG51bGw7CiAgICBwcml2YXRlIExpc3QgX2NvbHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBJbmRleCBfaWR4ID0gbnVsbDsKICAgIHByaXZhdGUgVW5p\ncXVlIF91bnEgPSBudWxsOwogICAgcHJpdmF0ZSBGb3JlaWduS2V5IF9mayA9\nIG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NhbklkeCA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2NhblVucSA9IHRydWU7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2NhbkZLID0gdHJ1ZTsKICAgIHByaXZhdGUgaW50IF9qb2lu\nID0gSk9JTl9OT05FOwogICAgcHJpdmF0ZSBDb2x1bW5JTyBfaW8gPSBudWxs\nOwoKICAgIC8qKgogICAgICogTWFwcGluZyBzdHJhdGVneSBuYW1lLgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFN0cmF0ZWd5KCkgewogICAgICAg\nIHJldHVybiBfc3RyYXRlZ3k7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXBw\naW5nIHN0cmF0ZWd5IG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFN0cmF0ZWd5KFN0cmluZyBzdHJhdGVneSkgewogICAgICAgIF9zdHJhdGVn\neSA9IHN0cmF0ZWd5OwogICAgfQoKICAgIC8qKgogICAgICogUmF3IGNvbHVt\nbiBkYXRhLgogICAgICovCiAgICBwdWJsaWMgTGlzdCBnZXRDb2x1bW5zKCkg\newogICAgICAgIHJldHVybiAoX2NvbHMgPT0gbnVsbCkgPyBDb2xsZWN0aW9u\ncy5FTVBUWV9MSVNUIDogX2NvbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nYXcgY29sdW1uIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENv\nbHVtbnMoTGlzdCBjb2xzKSB7CiAgICAgICAgX2NvbHMgPSBjb2xzOwogICAg\nfQoKICAgIC8qKgogICAgICogUmF3IGluZGV4LgogICAgICovCiAgICBwdWJs\naWMgSW5kZXggZ2V0SW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9pZHg7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSYXcgaW5kZXguCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEluZGV4KEluZGV4IGlkeCkgewogICAgICAgIF9pZHgg\nPSBpZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFy\nayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm9uLWluZGV4YWJsZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gY2FuSW5kZXgoKSB7CiAgICAgICAgcmV0\ndXJuIF9jYW5JZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBj\nYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm9uLWluZGV4YWJsZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FuSW5kZXgoYm9vbGVhbiBp\nbmRleGFibGUpIHsKICAgICAgICBfY2FuSWR4ID0gaW5kZXhhYmxlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmF3IGZvcmVpZ24ga2V5IGluZm9ybWF0aW9u\nLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleSBnZXRGb3JlaWduS2V5\nKCkgewogICAgICAgIHJldHVybiBfZms7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoRm9yZWlnbktleSBmaykgewogICAg\nICAgIF9mayA9IGZrOwogICAgICAgIGlmIChmayAhPSBudWxsICYmIF9qb2lu\nID09IEpPSU5fTk9ORSkKICAgICAgICAgICAgX2pvaW4gPSBKT0lOX0ZPUldB\nUkQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFyayBj\nb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm90IGhhdmluZyBhIGZvcmVpZ24ga2V5\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5Gb3JlaWduS2V5KCkg\newogICAgICAgIHJldHVybiBfY2FuRks7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgdXNlciBjYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm90\nIGhhdmluZyBhIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRDYW5Gb3JlaWduS2V5KGJvb2xlYW4gZmthYmxlKSB7CiAgICAgICAg\nX2NhbkZLID0gZmthYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUmF3IHVu\naXF1ZSBjb25zdHJhaW50IGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJs\naWMgVW5pcXVlIGdldFVuaXF1ZSgpIHsKICAgICAgICByZXR1cm4gX3VucTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJhdyB1bmlxdWUgY29uc3RyYWludCBp\nbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VW5pcXVl\nKFVuaXF1ZSB1bnEpIHsKICAgICAgICBfdW5xID0gdW5xOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHVzZXIgY2FuIG1hcmsgY29sdW1ucyBhcyBleHBs\naWNpdGx5IG5vdCBoYXZpbmcgYSB1bmlxdWUgY29uc3RyYWludC4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gY2FuVW5pcXVlKCkgewogICAgICAgIHJl\ndHVybiBfY2FuVW5xOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHVzZXIg\nY2FuIG1hcmsgY29sdW1ucyBhcyBleHBsaWNpdGx5IG5vdCBoYXZpbmcgYSB1\nbmlxdWUgY29uc3RyYWludC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQ2FuVW5pcXVlKGJvb2xlYW4gdW5pcXVhYmxlKSB7CiAgICAgICAgX2NhblVu\ncSA9IHVuaXF1YWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIEkvTyBmb3Ig\ndGhlIGNvbHVtbnMgY3JlYXRlZCBieSB0aGUgbGFzdCBjYWxsIHRvIHtAbGlu\nayAjY3JlYXRlQ29sdW1uc30sCiAgICAgKiBvciBmb3IgdGhlIGZvcmVpZ24g\na2V5IGNyZWF0ZWQgYnkgdGhlIGxhc3QgY2FsbCB0bwogICAgICoge0BsaW5r\nICNjcmVhdGVGb3JlaWduS2V5fS4gVGhpcyBpcyBhbHNvIGV4cGVjdGVkIHRv\nIGJlIHNldCBjb3JyZWN0bHkKICAgICAqIHByaW9yIHRvIGNhbGxzIHRvIHtA\nbGluayAjc3luY0NvbHVtbnN9IGFuZCB7QGxpbmsgI3N5bmNGb3JlaWduS2V5\nfS4KICAgICAqLwogICAgcHVibGljIENvbHVtbklPIGdldENvbHVtbklPKCkg\newogICAgICAgIHJldHVybiBfaW87CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nL08gZm9yIHRoZSBjb2x1bW5zIGNyZWF0ZWQgYnkgdGhlIGxhc3QgY2FsbCB0\nbyB7QGxpbmsgI2NyZWF0ZUNvbHVtbnN9LAogICAgICogb3IgZm9yIHRoZSBm\nb3JlaWduIGtleSBjcmVhdGVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8KICAgICAq\nIHtAbGluayAjY3JlYXRlRm9yZWlnbktleX0uIFRoaXMgaXMgYWxzbyBleHBl\nY3RlZCB0byBiZSBzZXQgY29ycmVjdGx5CiAgICAgKiBwcmlvciB0byBjYWxs\ncyB0byB7QGxpbmsgI3N5bmNDb2x1bW5zfSBhbmQge0BsaW5rICNzeW5jRm9y\nZWlnbktleX0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENvbHVtbklP\nKENvbHVtbklPIGlvKSB7CiAgICAgICAgX2lvID0gaW87CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEaXJlY3Rpb24gb2YgdGhlIGpvaW4gdGhhdCB0aGUgY29s\ndW1ucyBvZiB0aGlzIG1hcHBpbmcgaW5mbyBmb3JtLiBUaGlzCiAgICAgKiBp\ncyB1c3VhbGx5IGF1dG9tYXRpY2FsbHkgc2V0IGJ5IHtAbGluayAjY3JlYXRl\nRm9yZWlnbktleX0uIFRoaXMgZmxhZwogICAgICogaXMgYWxzbyBleHBlY3Rl\nZCB0byBiZSBzZXQgY29ycmVjdGx5IHByaW9yIHRvIGNhbGxzIHRvCiAgICAg\nKiB7QGxpbmsgI3N5bmNGb3JlaWduS2V5fSBpZiB0aGUgam9pbiBpcyBpbnZl\ncnNlZC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRKb2luRGlyZWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBfam9pbjsKICAgIH0KCiAgICAvKioKICAg\nICAqIERpcmVjdGlvbiBvZiB0aGUgam9pbiB0aGF0IHRoZSBjb2x1bW5zIG9m\nIHRoaXMgbWFwcGluZyBpbmZvIGZvcm0uIFRoaXMKICAgICAqIGlzIHVzdWFs\nbHkgYXV0b21hdGljYWxseSBzZXQgYnkge0BsaW5rICNjcmVhdGVGb3JlaWdu\nS2V5fS4gVGhpcyBmbGFnCiAgICAgKiBpcyBhbHNvIGV4cGVjdGVkIHRvIGJl\nIHNldCBjb3JyZWN0bHkgcHJpb3IgdG8gY2FsbHMgdG8KICAgICAqIHtAbGlu\nayAjc3luY0ZvcmVpZ25LZXl9IGlmIHRoZSBqb2luIGlzIGludmVyc2VkLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luRGlyZWN0aW9uKGludCBq\nb2luKSB7CiAgICAgICAgX2pvaW4gPSBqb2luOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2xlYXIgYWxsIG1hcHBpbmcgaW5mb3JtYXRpb24uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgIGNsZWFyKHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgbWFwcGluZyBpbmZvcm1h\ndGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gY2FuRmxhZ3Mgd2hldGhlciB0\nbyBjbGVhciBpbmZvcm1hdGlvbiBhYm91dCB3aGV0aGVyIHdlCiAgICAgKiBj\nYW4gcGxhY2UgaW5kZXhlZCwgZm9yZWlnbiBrZXlzLCBldGMgb24gdGhpcyBt\nYXBwaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyKGJvb2xl\nYW4gY2FuRmxhZ3MpIHsKICAgICAgICBfc3RyYXRlZ3kgPSBudWxsOwogICAg\nICAgIF9jb2xzID0gbnVsbDsKICAgICAgICBfaW8gPSBudWxsOwogICAgICAg\nIF9pZHggPSBudWxsOwogICAgICAgIF91bnEgPSBudWxsOwogICAgICAgIF9m\nayA9IG51bGw7CiAgICAgICAgX2pvaW4gPSBKT0lOX05PTkU7CiAgICAgICAg\naWYgKGNhbkZsYWdzKSB7CiAgICAgICAgICAgIF9jYW5JZHggPSB0cnVlOwog\nICAgICAgICAgICBfY2FuRksgPSB0cnVlOwogICAgICAgICAgICBfY2FuVW5x\nID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb3B5\nIG1pc3NpbmcgaW5mbyBmcm9tIHRoZSBpbnN0YW5jZSB0byB0aGlzIG9uZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgY29weShNYXBwaW5nSW5mbyBpbmZv\nKSB7CiAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxsKQogICAgICAgICAg\nICBfc3RyYXRlZ3kgPSBpbmZvLmdldFN0cmF0ZWd5KCk7CiAgICAgICAgaWYg\nKF9jYW5JZHggJiYgX2lkeCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChp\nbmZvLmdldEluZGV4KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9pZHgg\nPSBpbmZvLmdldEluZGV4KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIF9jYW5JZHggPSBpbmZvLmNhbkluZGV4KCk7CiAgICAgICAgfQog\nICAgICAgIGlmIChfY2FuVW5xICYmIF91bnEgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoaW5mby5nZXRVbmlxdWUoKSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3VucSA9IGluZm8uZ2V0VW5pcXVlKCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIF9jYW5VbnEgPSBpbmZvLmNhblVuaXF1ZSgp\nOwogICAgICAgIH0KICAgICAgICBpZiAoX2NhbkZLICYmIF9mayA9PSBudWxs\nKSB7CiAgICAgICAgICAgIGlmIChpbmZvLmdldEZvcmVpZ25LZXkoKSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX2ZrID0gaW5mby5nZXRGb3JlaWduS2V5\nKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYW5GSyA9\nIGluZm8uY2FuRm9yZWlnbktleSgpOwogICAgICAgIH0KCiAgICAgICAgTGlz\ndCBjb2xzID0gZ2V0Q29sdW1ucygpOwogICAgICAgIExpc3QgaWNvbHMgPSBp\nbmZvLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoIWljb2xzLmlzRW1wdHko\nKSAmJiAoY29scy5pc0VtcHR5KCkKICAgICAgICAgICAgfHwgY29scy5zaXpl\nKCkgPT0gaWNvbHMuc2l6ZSgpKSkgewogICAgICAgICAgICBpZiAoY29scy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBjb2xzID0gbmV3IEFycmF5TGlz\ndChpY29scy5zaXplKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGljb2xzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAo\nY29scy5zaXplKCkgPT0gaSkKICAgICAgICAgICAgICAgICAgICBjb2xzLmFk\nZChuZXcgQ29sdW1uKCkpOwogICAgICAgICAgICAgICAgKChDb2x1bW4pIGNv\nbHMuZ2V0KGkpKS5jb3B5KChDb2x1bW4pIGljb2xzLmdldChpKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc2V0Q29sdW1ucyhjb2xzKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlz\nIGluZm8gaGFzIGNvbHVtbnMsIGZvcmVpZ24ga2V5IGluZm9ybWF0aW9uLCBp\nbmRleAogICAgICogaW5mb3JtYXRpb24sIGV0Yy4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzU2NoZW1hQ29tcG9uZW50cygpIHsKICAgICAgICBy\nZXR1cm4gKF9jb2xzICE9IG51bGwgJiYgIV9jb2xzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgfHwgX2lkeCAhPSBudWxsCiAgICAgICAgICAgIHx8IF91bnEg\nIT0gbnVsbAogICAgICAgICAgICB8fCBfZmsgIT0gbnVsbAogICAgICAgICAg\nICB8fCAhX2NhbklkeAogICAgICAgICAgICB8fCAhX2NhbkZLCiAgICAgICAg\nICAgIHx8ICFfY2FuVW5xOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0\nIHRoYXQgdGhlIHVzZXIgZGlkIG5vdCBzdXBwbHkgYW55IGNvbHVtbnMsIGlu\nZGV4LCB1bmlxdWUKICAgICAqIGNvbnN0cmFpbnQsIG9yIGZvcmVpZ24ga2V5\nIGZvciB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE5vU2NoZW1hQ29tcG9uZW50cyhNZXRhRGF0YUNvbnRleHQgY29udGV4\ndCwgYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX2NvbHMgPT0gbnVsbCB8\nfCBfY29scy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYXNzZXJ0Tm9JbmRl\neChjb250ZXh0LCBkaWUpOwogICAgICAgICAgICBhc3NlcnROb1VuaXF1ZShj\nb250ZXh0LCBkaWUpOwogICAgICAgICAgICBhc3NlcnROb0ZvcmVpZ25LZXko\nY29udGV4dCwgZGllKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgidW5leHBlY3RlZC1j\nb2xzIiwgY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgY29u\ndGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fybihtc2cpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhpcyBpbmZvIGhhcyB0\naGUgZ2l2ZW4gc3RyYXRlZ3kgb3Igbm8gc3RyYXRlZ3kuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFzc2VydFN0cmF0ZWd5KE1ldGFEYXRhQ29udGV4dCBj\nb250ZXh0LCBPYmplY3QgY29udGV4dFN0cmF0LAogICAgICAgIE9iamVjdCBl\neHBlY3RlZCwgYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoY29udGV4dFN0\ncmF0ID09IGV4cGVjdGVkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIFN0cmluZyBzdHJhdDsKICAgICAgICBpZiAoY29udGV4dFN0cmF0ID09IG51\nbGwpIHsKICAgICAgICAgICAgaWYgKF9zdHJhdGVneSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoX3N0cmF0ZWd5\nLmVxdWFscyhleHBlY3RlZC5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChleHBlY3RlZCBp\nbnN0YW5jZW9mIFN0cmF0ZWd5CiAgICAgICAgICAgICAgICAmJiBfc3RyYXRl\nZ3kuZXF1YWxzKCgoU3RyYXRlZ3kpIGV4cGVjdGVkKS5nZXRBbGlhcygpKSkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgc3RyYXQgPSBf\nc3RyYXRlZ3k7CiAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0U3RyYXQgaW5z\ndGFuY2VvZiBTdHJhdGVneSkKICAgICAgICAgICAgc3RyYXQgPSAoKFN0cmF0\nZWd5KSBjb250ZXh0U3RyYXQpLmdldEFsaWFzKCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzdHJhdCA9IGNvbnRleHRTdHJhdC5nZXRDbGFzcygpLmdl\ndE5hbWUoKTsKCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgidW5l\neHBlY3RlZC1zdHJhdGVneSIsIGNvbnRleHQsIGV4cGVjdGVkLAogICAgICAg\nICAgICBzdHJhdCk7CiAgICAgICAgaWYgKGRpZSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fybihtc2cpOwogICAgfQoK\nICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhlIHVzZXIgZGlkIG5vdCB0\ncnkgdG8gcGxhY2UgYW4gaW5kZXggb24gdGhpcyBtYXBwaW5nLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb0luZGV4KE1ldGFEYXRhQ29udGV4\ndCBjb250ZXh0LCBib29sZWFuIGRpZSkgewogICAgICAgIGlmIChfaWR4ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBt\nc2cgPSBfbG9jLmdldCgidW5leHBlY3RlZC1pbmRleCIsIGNvbnRleHQpOwog\nICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2VydCB0aGF0IHRoZSB1c2VyIGRpZCBub3QgdHJ5IHRvIHBsYWNlIGEg\ndW5pcXVlIGNvbnN0cmFpbnQgb24gdGhpcwogICAgICogbWFwcGluZy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9VbmlxdWUoTWV0YURhdGFD\nb250ZXh0IGNvbnRleHQsIGJvb2xlYW4gZGllKSB7CiAgICAgICAgaWYgKF91\nbnEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBNZXNz\nYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLXVuaXF1ZSIsIGNvbnRl\neHQpOwogICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVw\nb3NpdG9yeSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFzc2VydCB0aGF0IHRoZSB1c2VyIGRpZCBub3QgdHJ5IHRvIHBs\nYWNlIGEgZm9yZWlnbiBrZXkgb24gdGhpcyBtYXBwaW5nLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBhc3NlcnROb0ZvcmVpZ25LZXkoTWV0YURhdGFDb250\nZXh0IGNvbnRleHQsIGJvb2xlYW4gZGllKSB7CiAgICAgICAgaWYgKF9mayA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0ZWQtZmsiLCBjb250ZXh0KTsKICAg\nICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRvcnko\nKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NlcnQgdGhhdCB0aGUgdXNlciBkaWQgbm90IHRyeSB0byBqb2luLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb0pvaW4oTWV0YURhdGFDb250\nZXh0IGNvbnRleHQsIGJvb2xlYW4gZGllKSB7CiAgICAgICAgYm9vbGVhbiBq\nb2luID0gZmFsc2U7CiAgICAgICAgaWYgKF9jb2xzICE9IG51bGwpIHsKICAg\nICAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7ICFqb2luICYmIGkgPCBfY29scy5zaXplKCk7IGkrKykgewogICAgICAg\nICAgICAgICAgY29sID0gKENvbHVtbikgX2NvbHMuZ2V0KGkpOwogICAgICAg\nICAgICAgICAgaWYgKGNvbC5nZXRUYXJnZXQoKSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIGpvaW4gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGlmICgham9pbikKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLWpv\naW4iLCBjb250ZXh0KTsKICAgICAgICBpZiAoZGllKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24obXNnKTsKICAgICAgICBjb250\nZXh0LmdldFJlcG9zaXRvcnkoKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaW5kIG9yIGdlbmVyYXRlIGEgdGFibGUgZm9y\nIGEgbWFwcGluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0aGUg\nbWFwcGluZyB0aGF0IHVzZXMgdGhlIHRhYmxlCiAgICAgKiBAcGFyYW0gZGVm\nIGRlZmF1bHQgdGFibGUgbmFtZSBwcm92aWRlcgogICAgICogQHBhcmFtIHNj\naGVtYSBkZWZhdWx0IHNjaGVtYSBpZiBrbm93biwgb3IgbnVsbAogICAgICog\nQHBhcmFtIGdpdmVuIGdpdmVuIHRhYmxlIG5hbWUKICAgICAqIEBwYXJhbSBh\nZGFwdCB3aGV0aGVyIHdlIGNhbiBhbHRlciB0aGUgc2NoZW1hIG9yIG1hcHBp\nbmdzCiAgICAgKi8KICAgIHB1YmxpYyBUYWJsZSBjcmVhdGVUYWJsZShNZXRh\nRGF0YUNvbnRleHQgY29udGV4dCwgVGFibGVEZWZhdWx0cyBkZWYsCiAgICAg\nICAgU2NoZW1hIHNjaGVtYSwgU3RyaW5nIGdpdmVuLCBib29sZWFuIGFkYXB0\nKSB7CiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGlu\nZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAg\nIGlmIChnaXZlbiA9PSBudWxsICYmIChkZWYgPT0gbnVsbCB8fCAoIWFkYXB0\nCiAgICAgICAgICAgICYmICFyZXBvcy5nZXRNYXBwaW5nRGVmYXVsdHMoKS5k\nZWZhdWx0TWlzc2luZ0luZm8oKSkpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXRhYmxlIiwgY29udGV4\ndCkpOwoKICAgICAgICAvLyBpZiBubyBnaXZlbiBhbmQgYWRhcHRpbmcgb3Ig\nZGVmYXVsdGluZyBtaXNzaW5nIGluZm8sIHVzZSB0ZW1wbGF0ZQogICAgICAg\nIFNjaGVtYUdyb3VwIGdyb3VwID0gcmVwb3MuZ2V0U2NoZW1hR3JvdXAoKTsK\nICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAgaWYg\nKGdpdmVuID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lID0gU2NoZW1hcy5n\nZXROZXdUYWJsZVNjaGVtYSgoSkRCQ0NvbmZpZ3VyYXRpb24pCiAgICAgICAg\nICAgICAgICAgICAgcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgICAg\nICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1l\nKTsKICAgICAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRTY2hlbWEoc2NoZW1h\nTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2l2ZW4gPSBkZWYu\nZ2V0KHNjaGVtYSk7CiAgICAgICAgfQoKICAgICAgICAvLyBsb29rIGZvciBu\nYW1lZCB0YWJsZQogICAgICAgIFRhYmxlIHRhYmxlID0gZ3JvdXAuZmluZFRh\nYmxlKGdpdmVuKTsKICAgICAgICBpZiAodGFibGUgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIHRhYmxlOwogICAgICAgIGlmICghYWRhcHQpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLXRhYmxlIiwgZ2l2ZW4sIGNvbnRleHQpKTsKCiAgICAgICAgLy8gbmFt\nZWQgdGFibGUgZG9lc24ndCBleGlzdDsgZmlndXJlIG91dCB3aGF0IHNjaGVt\nYSB0byBjcmVhdGUgbmV3CiAgICAgICAgLy8gdGFibGUgaW4KICAgICAgICBp\nbnQgZG90SWR4ID0gZ2l2ZW4ubGFzdEluZGV4T2YoJy4nKTsKICAgICAgICBp\nZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgIHNjaGVtYSA9IG51bGw7\nCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBnaXZlbi5zdWJzdHJpbmcoMCwg\nZG90SWR4KTsKICAgICAgICAgICAgZ2l2ZW4gPSBnaXZlbi5zdWJzdHJpbmco\nZG90SWR4ICsgMSk7CiAgICAgICAgfSBlbHNlIGlmIChzY2hlbWEgPT0gbnVs\nbCkKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IFNjaGVtYXMuZ2V0TmV3VGFi\nbGVTY2hlbWEoKEpEQkNDb25maWd1cmF0aW9uKQogICAgICAgICAgICAgICAg\ncmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpKTsKCiAgICAgICAgaWYgKHNjaGVt\nYSA9PSBudWxsKSB7CiAgICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmdldFNj\naGVtYShzY2hlbWFOYW1lKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuYWRkU2NoZW1h\nKHNjaGVtYU5hbWUpOwogICAgICAgIH0KCiAgICAgICAgdGFibGUgPSBzY2hl\nbWEuZ2V0VGFibGUoZ2l2ZW4pOwogICAgICAgIGlmICh0YWJsZSA9PSBudWxs\nKQogICAgICAgICAgICB0YWJsZSA9IHNjaGVtYS5hZGRUYWJsZShnaXZlbik7\nCiAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0cmlldmUvY3JlYXRlIGNvbHVtbnMgb24gdGhlIGdpdmVuIHRhYmxlIGJ5\nIG1lcmdpbmcgdGhlIGdpdmVuCiAgICAgKiB0ZW1wbGF0ZSBpbmZvcm1hdGlv\nbiB3aXRoIGFueSB1c2VyLXByb3ZpZGVkIGluZm9ybWF0aW9uLgogICAgICoK\nICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJp\nZXZpbmcgY29sdW1ucyBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXggbG9jYWxp\nemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBhcmFtIHRt\ncGxhdGVzIHRlbXBsYXRlIGNvbHVtbnMKICAgICAqIEBwYXJhbSB0YWJsZSB0\naGUgdGFibGUgZm9yIHRoZSBjb2x1bW5zCiAgICAgKiBAcGFyYW0gYWRhcHQg\nd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5nIG9y\nIHNjaGVtYQogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sdW1uW10gY3JlYXRl\nQ29sdW1ucyhNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgU3RyaW5nIHByZWZp\neCwKICAgICAgICBDb2x1bW5bXSB0bXBsYXRlcywgVGFibGUgdGFibGUsIGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBhc3NlcnRUYWJsZShjb250ZXh0LCB0\nYWJsZSk7CiAgICAgICAgaWYgKHByZWZpeCA9PSBudWxsKQogICAgICAgICAg\nICBwcmVmaXggPSAiZ2VuZXJpYyI7CgogICAgICAgIC8vIHRoZSB1c2VyIGhh\ncyB0byBnaXZlIHRoZSByaWdodCBudW1iZXIgb2YgZXhwZWN0ZWQgY29sdW1u\ncyBmb3IgdGhpcwogICAgICAgIC8vIG1hcHBpbmcsIG9yIG5vbmUgYXQgYWxs\nIGlmIHdlJ3JlIGFkYXB0aW5nLiAgY2FuJ3QganVzdCBnaXZlbiBvbmUgb2YK\nICAgICAgICAvLyBuIGNvbHVtbnMgYmVjYXVzZSB3ZSBkb24ndCBrbm93IHdo\naWNoIG9mIHRoZSBuIGNvbHVtbnMgdGhlIGluZm8KICAgICAgICAvLyBhcHBs\naWVzIHRvCiAgICAgICAgTGlzdCBnaXZlbiA9IGdldENvbHVtbnMoKTsKICAg\nICAgICBib29sZWFuIGZpbGwgPSAoKE1hcHBpbmdSZXBvc2l0b3J5KSBjb250\nZXh0LmdldFJlcG9zaXRvcnkoKSkuCiAgICAgICAgICAgIGdldE1hcHBpbmdE\nZWZhdWx0cygpLmRlZmF1bHRNaXNzaW5nSW5mbygpOwogICAgICAgIGlmICgo\nIWdpdmVuLmlzRW1wdHkoKSB8fCAoIWFkYXB0ICYmICFmaWxsKSkKICAgICAg\nICAgICAgJiYgZ2l2ZW4uc2l6ZSgpICE9IHRtcGxhdGVzLmxlbmd0aCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKHByZWZpeCArICItbnVtLWNvbHMiLAogICAgICAgICAgICAgICAgY29udGV4\ndCwgU3RyaW5nLnZhbHVlT2YodG1wbGF0ZXMubGVuZ3RoKSwKICAgICAgICAg\nICAgICAgIFN0cmluZy52YWx1ZU9mKGdpdmVuLnNpemUoKSkpKTsKCiAgICAg\nICAgQ29sdW1uW10gY29scyA9IG5ldyBDb2x1bW5bdG1wbGF0ZXMubGVuZ3Ro\nXTsKICAgICAgICBfaW8gPSBudWxsOwogICAgICAgIENvbHVtbiBjb2w7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0bXBsYXRlcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBjb2wgPSAoZ2l2ZW4uaXNFbXB0eSgpKSA/IG51\nbGwgOiAoQ29sdW1uKSBnaXZlbi5nZXQoaSk7CiAgICAgICAgICAgIGNvbHNb\naV0gPSBtZXJnZUNvbHVtbihjb250ZXh0LCBwcmVmaXgsIHRtcGxhdGVzW2ld\nLCB0cnVlLCBjb2wsCiAgICAgICAgICAgICAgICB0YWJsZSwgYWRhcHQsIGZp\nbGwpOwogICAgICAgICAgICBzZXRJT0Zyb21Db2x1bW5GbGFncyhjb2wsIGkp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29sczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgcHJvcGVyIGludGVybmFsIGNvbHVtbiBJL08g\nbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjb2x1bW4ncyBmbGFncy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHNldElPRnJvbUNvbHVtbkZsYWdzKENvbHVt\nbiBjb2wsIGludCBpKSB7CiAgICAgICAgaWYgKGNvbCA9PSBudWxsIHx8ICgh\nY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKQogICAgICAg\nICAgICAmJiAhY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUp\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2lvID09IG51\nbGwpCiAgICAgICAgICAgIF9pbyA9IG5ldyBDb2x1bW5JTygpOwogICAgICAg\nIF9pby5zZXRJbnNlcnRhYmxlKGksICFjb2wuZ2V0RmxhZyhDb2x1bW4uRkxB\nR19VTklOU0VSVEFCTEUpKTsKICAgICAgICBfaW8uc2V0VXBkYXRhYmxlKGks\nICFjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhlIGdpdmVuIHRhYmxl\nIGlzIG5vbi1udWxsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lk\nIGFzc2VydFRhYmxlKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBUYWJsZSB0\nYWJsZSkgewogICAgICAgIGlmICh0YWJsZSA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInVubWFw\ncGVkIiwgY29udGV4dCkpOwogICAgfQoKICAgIC8qKgogICAgICogTWVyZ2Ug\ndGhlIGdpdmVuIGNvbHVtbnMgaWYgcG9zc2libGUuCiAgICAgKgogICAgICog\nQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBj\nb2x1bW5zIGZvcgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJy\nb3IgbWVzc2FnZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gdG1wbGF0ZSB0\nZW1wbGF0ZSBmb3IgZXhwZWN0ZWQgY29sdW1uIGluZm9ybWF0aW9uCiAgICAg\nKiBAcGFyYW0gY29tcGF0IHdoZXRoZXIgdGhlIGV4aXN0aW5nIGNvbHVtbiB0\neXBlIG11c3QgYmUgY29tcGF0aWJsZQogICAgICogd2l0aCB0aGUgdHlwZSBv\nZiB0aGUgdGVtcGxhdGUgY29sdW1uCiAgICAgKiBAcGFyYW0gZ2l2ZW4gdGhl\nIGdpdmVuIGNvbHVtbiBpbmZvcm1hdGlvbiBmcm9tIG1hcHBpbmcgaW5mbwog\nICAgICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhlIGNvbHVtbnMK\nICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2RpZnkgdGhl\nIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKiBAcGFyYW0gZmls\nbCB3aGV0aGVyIHRvIGRlZmF1bHQgbWlzc2luZyBjb2x1bW4gaW5mb3JtYXRp\nb24KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBDb2x1bW4gbWVyZ2VD\nb2x1bW4oTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFN0cmluZyBwcmVmaXgs\nCiAgICAgICAgQ29sdW1uIHRtcGxhdGUsIGJvb2xlYW4gY29tcGF0LCBDb2x1\nbW4gZ2l2ZW4sIFRhYmxlIHRhYmxlLAogICAgICAgIGJvb2xlYW4gYWRhcHQs\nIGJvb2xlYW4gZmlsbCkgewogICAgICAgIGFzc2VydFRhYmxlKGNvbnRleHQs\nIHRhYmxlKTsKCiAgICAgICAgLy8gaWYgbm90IGFkYXB0aW5nIG11c3QgcHJv\ndmlkZSBjb2x1bW4gbmFtZSBhdCBhIG1pbmltdW0KICAgICAgICBTdHJpbmcg\nY29sTmFtZSA9IChnaXZlbiA9PSBudWxsKSA/IG51bGwgOiBnaXZlbi5nZXRO\nYW1lKCk7CiAgICAgICAgaWYgKGNvbE5hbWUgPT0gbnVsbCAmJiAhYWRhcHQg\nJiYgIWZpbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldChwcmVmaXggKyAiLW5vLWNvbC1uYW1lIiwKICAgICAg\nICAgICAgICAgIGNvbnRleHQpKTsKCiAgICAgICAgLy8gZGV0ZXJtaW5lIHRo\nZSBjb2x1bW4gbmFtZSBiYXNlZCBvbiBnaXZlbiBpbmZvLCBvciB0ZW1wbGF0\nZSBpZiBub25lOwogICAgICAgIC8vIGFsc28gbWFrZSBzdXJlIHRoYXQgaWYg\ndGhlIHVzZXIgZ2F2ZSBhIGNvbHVtbiBuYW1lLCBoZSBkaWRuJ3QgdHJ5CiAg\nICAgICAgLy8gdG8gcHV0IHRoZSBjb2x1bW4gaW4gYW4gdW5leHBlY3RlZCB0\nYWJsZQogICAgICAgIGlmIChjb2xOYW1lID09IG51bGwpCiAgICAgICAgICAg\nIGNvbE5hbWUgPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICBpbnQgZG90\nSWR4ID0gY29sTmFtZS5sYXN0SW5kZXhPZignLicpOwogICAgICAgIGlmIChk\nb3RJZHggPT0gMCkKICAgICAgICAgICAgY29sTmFtZSA9IGNvbE5hbWUuc3Vi\nc3RyaW5nKDEpOwogICAgICAgIGVsc2UgaWYgKGRvdElkeCAhPSAtMSkgewog\nICAgICAgICAgICBmaW5kVGFibGUoY29udGV4dCwgY29sTmFtZS5zdWJzdHJp\nbmcoMCwgZG90SWR4KSwgdGFibGUsCiAgICAgICAgICAgICAgICBudWxsLCBu\ndWxsKTsKICAgICAgICAgICAgY29sTmFtZSA9IGNvbE5hbWUuc3Vic3RyaW5n\nKGRvdElkeCArIDEpOwogICAgICAgIH0KCiAgICAgICAgLy8gZmluZCBleGlz\ndGluZyBjb2x1bW4KICAgICAgICBDb2x1bW4gY29sID0gdGFibGUuZ2V0Q29s\ndW1uKGNvbE5hbWUpOwogICAgICAgIGlmIChjb2wgPT0gbnVsbCAmJiAhYWRh\ncHQpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldChwcmVmaXggKyAiLWJhZC1jb2wtbmFtZSIsCiAgICAgICAgICAg\nICAgICBjb250ZXh0LCBjb2xOYW1lLCB0YWJsZSkpOwoKICAgICAgICBNYXBw\naW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgY29u\ndGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRp\nY3QgPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKTsKCiAgICAgICAgLy8gdXNl\nIGluZm9ybWF0aW9uIGZyb20gdGVtcGxhdGUgY29sdW1uIGJ5IGRlZmF1bHQs\nIGFsbG93aW5nIGFueQogICAgICAgIC8vIHVzZXItZ2l2ZW4gc3BlY2lmaWNz\nIHRvIG92ZXJyaWRlIGl0CiAgICAgICAgaW50IHR5cGUgPSB0bXBsYXRlLmdl\ndFR5cGUoKTsKICAgICAgICBpbnQgc2l6ZSA9IHRtcGxhdGUuZ2V0U2l6ZSgp\nOwogICAgICAgIGlmICh0eXBlID09IFR5cGVzLk9USEVSKQogICAgICAgICAg\nICB0eXBlID0gZGljdC5nZXRKREJDVHlwZSh0bXBsYXRlLmdldEphdmFUeXBl\nKCksIHNpemUgPT0gLTEpOwogICAgICAgIGJvb2xlYW4gdHR5cGUgPSB0cnVl\nOwogICAgICAgIGludCBvdHlwZSA9IHR5cGU7CiAgICAgICAgU3RyaW5nIHR5\ncGVOYW1lID0gdG1wbGF0ZS5nZXRUeXBlTmFtZSgpOwogICAgICAgIEJvb2xl\nYW4gbm90TnVsbCA9IG51bGw7CiAgICAgICAgaWYgKHRtcGxhdGUuaXNOb3RO\ndWxsRXhwbGljaXQoKSkKICAgICAgICAgICAgbm90TnVsbCA9ICh0bXBsYXRl\nLmlzTm90TnVsbCgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgaW50IGRlY2ltYWxzID0gdG1wbGF0ZS5nZXREZWNpbWFsRGln\naXRzKCk7CiAgICAgICAgU3RyaW5nIGRlZlN0ciA9IHRtcGxhdGUuZ2V0RGVm\nYXVsdFN0cmluZygpOwogICAgICAgIGJvb2xlYW4gYXV0b0Fzc2lnbiA9IHRt\ncGxhdGUuaXNBdXRvQXNzaWduZWQoKTsKICAgICAgICBib29sZWFuIHJlbGF0\naW9uSWQgPSB0bXBsYXRlLmlzUmVsYXRpb25JZCgpOwogICAgICAgIFN0cmlu\nZyB0YXJnZXRGaWVsZCA9IHRtcGxhdGUuZ2V0VGFyZ2V0RmllbGQoKTsKICAg\nICAgICBpZiAoZ2l2ZW4gIT0gbnVsbCkgewogICAgICAgICAgICAvLyB1c2Ug\nZ2l2ZW4gdHlwZSBpZiBwcm92aWRlZCwgYnV0IHdhcm4gaWYgaXQgaXNuJ3Qg\nY29tcGF0aWJsZSB3aXRoCiAgICAgICAgICAgIC8vIHRoZSBleHBlY3RlZCBj\nb2x1bW4gdHlwZQogICAgICAgICAgICBpZiAoZ2l2ZW4uZ2V0VHlwZSgpICE9\nIFR5cGVzLk9USEVSKSB7CiAgICAgICAgICAgICAgICB0dHlwZSA9IGZhbHNl\nOwogICAgICAgICAgICAgICAgaWYgKGNvbXBhdCAmJiAhZ2l2ZW4uaXNDb21w\nYXRpYmxlKHR5cGUsIHNpemUpKSB7CiAgICAgICAgICAgICAgICAgICAgTG9n\nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldChwcmVmaXggKyAiLWluY29tcGF0LWNvbCIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LCBjb2xOYW1l\nLCBTY2hlbWFzLmdldEpEQkNOYW1lKHR5cGUpKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBvdHlwZSA9IGdpdmVuLmdldFR5cGUoKTsK\nICAgICAgICAgICAgICAgIHR5cGUgPSBkaWN0LmdldFByZWZlcnJlZFR5cGUo\nb3R5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVOYW1lID0g\nZ2l2ZW4uZ2V0VHlwZU5hbWUoKTsKICAgICAgICAgICAgc2l6ZSA9IGdpdmVu\nLmdldFNpemUoKTsKICAgICAgICAgICAgZGVjaW1hbHMgPSBnaXZlbi5nZXRE\nZWNpbWFsRGlnaXRzKCk7CgogICAgICAgICAgICAvLyBsZWF2ZSB0aGlzIGlu\nZm8gYXMgdGhlIHRlbXBsYXRlIGRlZmF1bHRzIHVubGVzcyB0aGUgdXNlcgog\nICAgICAgICAgICAvLyBleHBsaWNpdGx5IHR1cm5zIGl0IG9uIGluIHRoZSBn\naXZlbiBjb2x1bW4KICAgICAgICAgICAgaWYgKGdpdmVuLmlzTm90TnVsbEV4\ncGxpY2l0KCkpCiAgICAgICAgICAgICAgICBub3ROdWxsID0gKGdpdmVuLmlz\nTm90TnVsbCgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgICAgIGlmIChnaXZlbi5nZXREZWZhdWx0U3RyaW5nKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGRlZlN0ciA9IGdpdmVuLmdldERlZmF1bHRT\ndHJpbmcoKTsKICAgICAgICAgICAgaWYgKGdpdmVuLmlzQXV0b0Fzc2lnbmVk\nKCkpCiAgICAgICAgICAgICAgICBhdXRvQXNzaWduID0gdHJ1ZTsKICAgICAg\nICAgICAgaWYgKGdpdmVuLmlzUmVsYXRpb25JZCgpKQogICAgICAgICAgICAg\nICAgcmVsYXRpb25JZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBk\nZWZhdWx0IGNoYXIgY29sdW1uIHNpemUgaWYgb3JpZ2luYWwgdHlwZSBpcyBj\naGFyICh0ZXN0IG9yaWdpbmFsCiAgICAgICAgLy8gdHlwZSByYXRoZXIgdGhh\nbiBmaW5hbCB0eXBlIGJlY2F1c2Ugb3JpZyBtaWdodCBiZSBjbG9iLCB0cmFu\nc2xhdGVkCiAgICAgICAgLy8gdG8gYW4gdW5zaXplZCB2YXJjaGFyLCB3aGlj\naCBpcyBzdXBwb3J0ZWQgYnkgc29tZSBkYnMpCiAgICAgICAgaWYgKHNpemUg\nPT0gMCAmJiAob3R5cGUgPT0gVHlwZXMuVkFSQ0hBUiB8fCBvdHlwZSA9PSBU\neXBlcy5DSEFSKSkKICAgICAgICAgICAgc2l6ZSA9IGRpY3QuY2hhcmFjdGVy\nQ29sdW1uU2l6ZTsKCiAgICAgICAgLy8gY3JlYXRlIGNvbHVtbiwgb3IgbWFr\nZSBzdXJlIGV4aXN0aW5nIGNvbHVtbiBtYXRjaGVzIGV4cGVjdGVkIHR5cGUK\nICAgICAgICBpZiAoY29sID09IG51bGwpIHsKICAgICAgICAgICAgY29sID0g\ndGFibGUuYWRkQ29sdW1uKGNvbE5hbWUpOwogICAgICAgICAgICBjb2wuc2V0\nVHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2UgaWYgKChjb21wYXQgfHwgIXR0\neXBlKSAmJiAhY29sLmlzQ29tcGF0aWJsZSh0eXBlLCBzaXplKSkgewogICAg\nICAgICAgICAvLyBpZiBleGlzdGluZyBjb2x1bW4gaXNuJ3QgY29tcGF0aWJs\nZSB3aXRoIGRlc2lyZWQgdHlwZSwgZGllIGlmCiAgICAgICAgICAgIC8vIGNh\nbid0IGFkYXB0LCBlbHNlIHdhcm4gYW5kIGNoYW5nZSB0aGUgZXhpc3Rpbmcg\nY29sdW1uIHR5cGUKICAgICAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdl\ndChwcmVmaXggKyAiLWJhZC1jb2wiLCBjb250ZXh0LAogICAgICAgICAgICAg\nICAgU2NoZW1hcy5nZXRKREJDTmFtZSh0eXBlKSwgY29sLmdldERlc2NyaXB0\naW9uKCkpOwogICAgICAgICAgICBpZiAoIWFkYXB0KQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7CiAgICAgICAg\nICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2coKTsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihtc2cpOwoKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7CiAgICAg\nICAgfSBlbHNlIGlmIChnaXZlbiAhPSBudWxsICYmIGdpdmVuLmdldFR5cGUo\nKSAhPSBUeXBlcy5PVEhFUikgewogICAgICAgICAgICAvLyBhcyBsb25nIGFz\nIHR5cGVzIGFyZSBjb21wYXRpYmxlLCBzZXQgY29sdW1uIHRvIGV4cGVjdGVk\nIHR5cGUKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBhbHdheXMgc2V0IHRoZSBqYXZhIHR5cGUgYW5kIGF1\ndG9hc3NpZ24gdG8gZXhwZWN0ZWQgdmFsdWVzLCBldmVuIG9uCiAgICAgICAg\nLy8gYW4gZXhpc3RpbmcgY29sdW1uLCBzaW5jZSB3ZSBkb24ndCBnZXQgdGhp\ncyBmcm9tIHRoZSBEQgogICAgICAgIGlmIChjb21wYXQpCiAgICAgICAgICAg\nIGNvbC5zZXRKYXZhVHlwZSh0bXBsYXRlLmdldEphdmFUeXBlKCkpOwogICAg\nICAgIGVsc2UgaWYgKGNvbC5nZXRKYXZhVHlwZSgpID09IEphdmFUeXBlcy5P\nQkpFQ1QpIHsKICAgICAgICAgICAgaWYgKGdpdmVuICE9IG51bGwgJiYgZ2l2\nZW4uZ2V0SmF2YVR5cGUoKSAhPSBKYXZhVHlwZXMuT0JKRUNUKQogICAgICAg\nICAgICAgICAgY29sLnNldEphdmFUeXBlKGdpdmVuLmdldEphdmFUeXBlKCkp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb2wuc2V0SmF2\nYVR5cGUoSmF2YVR5cGVzLmdldFR5cGVDb2RlCiAgICAgICAgICAgICAgICAg\nICAgKFNjaGVtYXMuZ2V0SmF2YVR5cGUoY29sLmdldFR5cGUoKSwgY29sLmdl\ndFNpemUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29sLmdldERlY2lt\nYWxEaWdpdHMoKSkpKTsKICAgICAgICB9CiAgICAgICAgY29sLnNldEF1dG9B\nc3NpZ25lZChhdXRvQXNzaWduKTsKICAgICAgICBjb2wuc2V0UmVsYXRpb25J\nZChyZWxhdGlvbklkKTsKICAgICAgICBjb2wuc2V0VGFyZ2V0RmllbGQodGFy\nZ2V0RmllbGQpOwoKICAgICAgICAvLyB3ZSBuZWVkIHRoaXMgZm9yIHJ1bnRp\nbWUsIGFuZCB0aGUgZHluYW1pYyBzY2hlbWEgZmFjdG9yeSBtaWdodAogICAg\nICAgIC8vIG5vdCBrbm93IGl0LCBzbyBzZXQgaXQgZXZlbiBpZiBub3QgYWRh\ncHRpbmcKICAgICAgICBpZiAoZGVmU3RyICE9IG51bGwpCiAgICAgICAgICAg\nIGNvbC5zZXREZWZhdWx0U3RyaW5nKGRlZlN0cik7CiAgICAgICAgaWYgKG5v\ndE51bGwgIT0gbnVsbCkKICAgICAgICAgICAgY29sLnNldE5vdE51bGwobm90\nTnVsbC5ib29sZWFuVmFsdWUoKSk7CgogICAgICAgIC8vIGFkZCBvdGhlciBk\nZXRhaWxzIGlmIGFkYXB0aW5nCiAgICAgICAgaWYgKGFkYXB0KSB7CiAgICAg\nICAgICAgIGlmICh0eXBlTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nY29sLnNldFR5cGVOYW1lKHR5cGVOYW1lKTsKICAgICAgICAgICAgaWYgKHNp\nemUgIT0gMCkKICAgICAgICAgICAgICAgIGNvbC5zZXRTaXplKHNpemUpOwog\nICAgICAgICAgICBpZiAoZGVjaW1hbHMgIT0gMCkKICAgICAgICAgICAgICAg\nIGNvbC5zZXREZWNpbWFsRGlnaXRzKGRlY2ltYWxzKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGNvbDsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQg\ndGhlIHRhYmxlIG5hbWVkIGJ5IGEgY29sdW1uIG9yIHRhcmdldC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gY29udGV4dCBjb250ZXh0IGZvciBlcnJvciBtZXNz\nYWdlcywgZXRjLgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxlIG5hbWUs\nIHBvc3NpYmx5IGluY2x1ZGluZyBzY2hlbWEKICAgICAqIEBwYXJhbSBleHBl\nY3RlZCB0aGUgZXhwZWN0ZWQgdGFibGU7IG1heSBiZSBudWxsCiAgICAgKiBA\ncGFyYW0gaW52ZXJzZSB0aGUgcG9zc2libGUgaW52ZXJzZSB0YWJsZTsgbWF5\nIGJlIG51bGwKICAgICAqIEBwYXJhbSByZWwgaWYgd2UncmUgZmluZGluZyB0\naGUgdGFyZ2V0IHRhYmxlIG9mIGEgam9pbiwgdGhlCiAgICAgKiBqb2luZWQt\ndG8gdHlwZTsgYWxsb3dzIHVzIHRvIGFsc28gbG9vayBpbiBpdHMgc3VwZXJj\nbGFzcyB0YWJsZXMKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgVGFibGUg\nZmluZFRhYmxlKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgbmFt\nZSwKICAgICAgICBUYWJsZSBleHBlY3RlZCwgVGFibGUgaW52ZXJzZSwgQ2xh\nc3NNYXBwaW5nIHJlbCkgewogICAgICAgIC8vIGlzIHRoaXMgdGhlIGV4cGVj\ndGVkIHRhYmxlPwogICAgICAgIGlmIChleHBlY3RlZCA9PSBudWxsICYmIHJl\nbCAhPSBudWxsKQogICAgICAgICAgICBleHBlY3RlZCA9IHJlbC5nZXRUYWJs\nZSgpOwogICAgICAgIGlmIChleHBlY3RlZCAhPSBudWxsICYmIGlzVGFibGVO\nYW1lKG5hbWUsIGV4cGVjdGVkKSkKICAgICAgICAgICAgcmV0dXJuIGV4cGVj\ndGVkOwoKICAgICAgICAvLyBjaGVjayBmb3IgaW52ZXJzZQogICAgICAgIGlm\nIChpbnZlcnNlICE9IG51bGwgJiYgaXNUYWJsZU5hbWUobmFtZSwgaW52ZXJz\nZSkpCiAgICAgICAgICAgIHJldHVybiBpbnZlcnNlOwoKICAgICAgICAvLyBz\ndXBlcmNsYXNzIHRhYmxlPwogICAgICAgIGlmIChyZWwgIT0gbnVsbCkKICAg\nICAgICAgICAgcmVsID0gcmVsLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpOwogICAgICAgIHdoaWxlIChyZWwgIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoaXNUYWJsZU5hbWUobmFtZSwgcmVsLmdldFRhYmxlKCkpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlbC5nZXRUYWJsZSgpOwogICAgICAg\nICAgICByZWwgPSByZWwuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBub25lIG9mIHRoZSBwb3NzaWJs\nZSB0YWJsZXMKICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoImNvbC13cm9uZy10YWJsZSIsIGNvbnRleHQsCiAgICAgICAg\nICAgIGV4cGVjdGVkLCBuYW1lKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gd2hldGhlciB0aGUgZ2l2ZW4gbmFtZSBtYXRjaGVzIHRoZSBnaXZl\nbiB0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBp\nc1RhYmxlTmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAg\nICByZXR1cm4gbmFtZS5lcXVhbHNJZ25vcmVDYXNlKHRhYmxlLmdldE5hbWUo\nKSkKICAgICAgICAgICAgfHwgbmFtZS5lcXVhbHNJZ25vcmVDYXNlKHRhYmxl\nLmdldEZ1bGxOYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0cmll\ndmUvY3JlYXRlIGFuIGluZGV4IG9uIHRoZSBnaXZlbiBjb2x1bW5zIGJ5IG1l\ncmdpbmcgdGhlIGdpdmVuCiAgICAgKiB0ZW1wbGF0ZSBpbmZvcm1hdGlvbiB3\naXRoIGFueSB1c2VyLXByb3ZpZGVkIGluZm9ybWF0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZp\nbmcgYW4gaW5kZXggZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXpl\nZCBlcnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSB0bXBs\nYXRlIHRlbXBsYXRlIGZvciBleHBlY3RlZCBpbmRleCBpbmZvcm1hdGlvbgog\nICAgICogQHBhcmFtIGNvbHMgdGhlIGluZGV4ZWQgY29sdW1ucwogICAgICog\nQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3Rp\nbmcgbWFwcGluZyBvciBzY2hlbWEKICAgICAqLwogICAgcHJvdGVjdGVkIElu\nZGV4IGNyZWF0ZUluZGV4KE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBTdHJp\nbmcgcHJlZml4LAogICAgICAgIEluZGV4IHRtcGxhdGUsIENvbHVtbltdIGNv\nbHMsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAocHJlZml4ID09IG51\nbGwpCiAgICAgICAgICAgIHByZWZpeCA9ICJnZW5lcmljIjsKCiAgICAgICAg\nLy8gY2FuJ3QgY3JlYXRlIGFuIGluZGV4IGlmIHRoZXJlIGFyZSBubyBjb2xz\nCiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAw\nKSB7CiAgICAgICAgICAgIGlmIChfaWR4ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJl\nZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLW5vLWluZGV4LWNvbHMiLCBj\nb250ZXh0KSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgLy8gbG9vayBmb3IgYW4gZXhpc3RpbmcgaW5kZXggb24gdGhl\nc2UgY29sdW1ucwogICAgICAgIFRhYmxlIHRhYmxlID0gY29sc1swXS5nZXRU\nYWJsZSgpOwogICAgICAgIEluZGV4W10gaWR4cyA9IHRhYmxlLmdldEluZGV4\nZXMoKTsKICAgICAgICBJbmRleCBleGlzdCA9IG51bGw7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBpZHhzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmIChpZHhzW2ldLmNvbHVtbnNNYXRjaChjb2xzKSkgewogICAgICAg\nICAgICAgICAgZXhpc3QgPSBpZHhzW2ldOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHJlbW92\nZSBleGlzdGluZyBpbmRleD8KICAgICAgICBpZiAoIV9jYW5JZHgpIHsKICAg\nICAgICAgICAgaWYgKGV4aXN0ID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChw\ncmVmaXggKyAiLWluZGV4LWV4aXN0cyIsCiAgICAgICAgICAgICAgICAgICAg\nY29udGV4dCkpOwogICAgICAgICAgICB0YWJsZS5yZW1vdmVJbmRleChleGlz\ndCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgd2UgaGF2ZSBhbiBleGlzdGluZyBpbmRleCwgbWVyZ2UgZ2l2\nZW4gaW5mbyBpbnRvIGl0CiAgICAgICAgaWYgKGV4aXN0ICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKF9pZHggIT0gbnVsbCAmJiBfaWR4LmlzVW5pcXVl\nKCkgJiYgIWV4aXN0LmlzVW5pcXVlKCkpIHsKICAgICAgICAgICAgICAgIGlm\nICghYWRhcHQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAg\nICAgICAgICArICItaW5kZXgtbm90LXVuaXF1ZSIsIGNvbnRleHQpKTsKICAg\nICAgICAgICAgICAgIGV4aXN0LnNldFVuaXF1ZSh0cnVlKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gZXhpc3Q7CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiBubyBkZWZhdWx0cyByZXR1cm4gbnVsbAogICAgICAgIE1h\ncHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBj\nb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBib29sZWFuIGZpbGwg\nPSByZXBvcy5nZXRNYXBwaW5nRGVmYXVsdHMoKS5kZWZhdWx0TWlzc2luZ0lu\nZm8oKTsKICAgICAgICBpZiAoX2lkeCA9PSBudWxsICYmICh0bXBsYXRlID09\nIG51bGwgfHwgKCFhZGFwdCAmJiAhZmlsbCkpKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIG5hbWUgPSBudWxsOwogICAgICAg\nIGJvb2xlYW4gdW5xOwogICAgICAgIGlmIChfaWR4ICE9IG51bGwpIHsKICAg\nICAgICAgICAgbmFtZSA9IF9pZHguZ2V0TmFtZSgpOwogICAgICAgICAgICB1\nbnEgPSBfaWR4LmlzVW5pcXVlKCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgIHVucSA9IHRtcGxhdGUuaXNVbmlxdWUoKTsKCiAgICAgICAgLy8gaWYg\nbm8gbmFtZSBwcm92aWRlZCBieSB1c2VyIGluZm8sIG1ha2Ugb25lCiAgICAg\nICAgaWYgKG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAodG1wbGF0\nZSAhPSBudWxsKQogICAgICAgICAgICAgICAgbmFtZSA9IHRtcGxhdGUuZ2V0\nTmFtZSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG5h\nbWUgPSBjb2xzWzBdLmdldE5hbWUoKTsKICAgICAgICAgICAgICAgIG5hbWUg\nPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKS5nZXRWYWxpZEluZGV4TmFtZShu\nYW1lLCB0YWJsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIEluZGV4IGlkeCA9IHRhYmxlLmFkZEluZGV4KG5hbWUpOwogICAgICAgIGlk\neC5zZXRVbmlxdWUodW5xKTsKICAgICAgICBpZHguc2V0Q29sdW1ucyhjb2xz\nKTsKICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0cmlldmUvY3JlYXRlIGEgdW5pcXVlIGNvbnN0cmFpbnQgb24gdGhlIGdp\ndmVuIGNvbHVtbnMgYnkgbWVyZ2luZyB0aGUKICAgICAqIGdpdmVuIHRlbXBs\nYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXItcHJvdmlkZWQgaW5mb3Jt\nYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBp\nbmcgd2UncmUgcmV0cmlldmluZyBhIGNvbnN0cmFpbnQgZm9yCiAgICAgKiBA\ncGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVm\naXgKICAgICAqIEBwYXJhbSB0bXBsYXRlIHRlbXBsYXRlIGZvciBleHBlY3Rl\nZCB1bmlxdWUgaW5mb3JtYXRpb24KICAgICAqIEBwYXJhbSBjb2xzIHRoZSBj\nb25zdHJhaW50IGNvbHVtbnMKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVy\nIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1h\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBVbmlxdWUgY3JlYXRlVW5pcXVlKE1l\ndGFEYXRhQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgcHJlZml4LAogICAgICAg\nIFVuaXF1ZSB0bXBsYXRlLCBDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFkYXB0\nKSB7CiAgICAgICAgaWYgKHByZWZpeCA9PSBudWxsKQogICAgICAgICAgICBw\ncmVmaXggPSAiZ2VuZXJpYyI7CgogICAgICAgIC8vIGNhbid0IGNyZWF0ZSBh\nIGNvbnN0cmFpbnQgaWYgdGhlcmUgYXJlIG5vIGNvbHMKICAgICAgICBpZiAo\nY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3RoID09IDApIHsKICAgICAgICAg\nICAgaWYgKF91bnEgIT0gbnVsbCB8fCB0bXBsYXRlICE9IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAgKyAiLW5vLXVuaXF1ZS1j\nb2xzIiwgY29udGV4dCkpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CgogICAgICAgIC8vIGxvb2sgZm9yIGFuIGV4aXN0aW5nIGNvbnN0\ncmFpbnQgb24gdGhlc2UgY29sdW1ucwogICAgICAgIFRhYmxlIHRhYmxlID0g\nY29sc1swXS5nZXRUYWJsZSgpOwogICAgICAgIFVuaXF1ZVtdIHVucXMgPSB0\nYWJsZS5nZXRVbmlxdWVzKCk7CiAgICAgICAgVW5pcXVlIGV4aXN0ID0gbnVs\nbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHVucXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKHVucXNbaV0uY29sdW1uc01hdGNoKGNv\nbHMpKSB7CiAgICAgICAgICAgICAgICBleGlzdCA9IHVucXNbaV07CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gcmVtb3ZlIGV4aXN0aW5nIHVuaXF1ZT8KICAgICAgICBpZiAo\nIV9jYW5VbnEpIHsKICAgICAgICAgICAgaWYgKGV4aXN0ID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCFh\nZGFwdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2Vw\ndGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICIt\ndW5pcXVlLWV4aXN0cyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgdGFibGUu\ncmVtb3ZlVW5pcXVlKGV4aXN0KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyBubyBkZWZhdWx0czsgcmV0dXJuIGV4\naXN0aW5nIGNvbnN0cmFpbnQgKGlmIGFueSkKICAgICAgICBpZiAodG1wbGF0\nZSA9PSBudWxsICYmIF91bnEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGV4aXN0OwoKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChN\nYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAg\nICAgICAgaWYgKGV4aXN0ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF91\nbnEgIT0gbnVsbCAmJiBfdW5xLmlzRGVmZXJyZWQoKSAmJiAhZXhpc3QuaXNE\nZWZlcnJlZCgpKSB7CiAgICAgICAgICAgICAgICBMb2cgbG9nID0gcmVwb3Mu\nZ2V0TG9nKCk7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldChw\ncmVmaXggKyAiLWRlZmVyLXVuaXF1ZSIsIGNvbnRleHQpKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gZXhpc3Q7CiAgICAgICAgfQoKICAg\nICAgICAvLyBkaWN0IGNhbid0IGhhbmRsZSB1bmlxdWUgY29uc3RyYWludHM/\nCiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSByZXBvcy5nZXREQkRpY3Rp\nb25hcnkoKTsKICAgICAgICBpZiAoX3VucSAhPSBudWxsICYmICFkaWN0LnN1\ncHBvcnRzVW5pcXVlQ29uc3RyYWludHMpIHsKICAgICAgICAgICAgTG9nIGxv\nZyA9IHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0\nKHByZWZpeCArICItdW5pcXVlLXN1cHBvcnQiLCBjb250ZXh0KSk7CiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVh\nbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1p\nc3NpbmdJbmZvKCk7CiAgICAgICAgaWYgKCFhZGFwdCAmJiAhZmlsbCAmJiBf\ndW5xID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBTdHJpbmcgbmFtZTsKICAgICAgICBib29sZWFuIGRlZmVycmVkOwogICAg\nICAgIGlmIChfdW5xICE9IG51bGwpIHsKICAgICAgICAgICAgbmFtZSA9IF91\nbnEuZ2V0TmFtZSgpOwogICAgICAgICAgICBkZWZlcnJlZCA9IF91bnEuaXNE\nZWZlcnJlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWUg\nPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVmZXJyZWQgPSB0\nbXBsYXRlLmlzRGVmZXJyZWQoKTsKICAgICAgICB9CgogICAgICAgIGlmIChk\nZWZlcnJlZCAmJiAhZGljdC5zdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMp\nIHsKICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItY3JlYXRlLWRlZmVy\nLXVuaXF1ZSIsCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCwgZGljdC5w\nbGF0Zm9ybSkpOwogICAgICAgICAgICBkZWZlcnJlZCA9IGZhbHNlOwogICAg\nICAgIH0KCiAgICAgICAgVW5pcXVlIHVucSA9IHRhYmxlLmFkZFVuaXF1ZShu\nYW1lKTsKICAgICAgICB1bnEuc2V0RGVmZXJyZWQoZGVmZXJyZWQpOwogICAg\nICAgIHVucS5zZXRDb2x1bW5zKGNvbHMpOwogICAgICAgIHJldHVybiB1bnE7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZS9jcmVhdGUgYSBmb3Jl\naWduIGtleSAocG9zc2libHkgbG9naWNhbCkgb24gdGhlIGdpdmVuIGNvbHVt\nbnMKICAgICAqIGJ5IG1lcmdpbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGluZm9y\nbWF0aW9uIHdpdGggYW55IHVzZXItcHJvdmlkZWQKICAgICAqIGluZm9ybWF0\naW9uLgogICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5n\nIHdlJ3JlIHJldHJpZXZpbmcgYSBrZXkgZm9yCiAgICAgKiBAcGFyYW0gcHJl\nZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAq\nIEBwYXJhbSBnaXZlbiB0aGUgY29sdW1ucyBnaXZlbiBieSB0aGUgdXNlcgog\nICAgICogQHBhcmFtIGRlZiBkZWZhdWx0cyBwcm92aWRlcgogICAgICogQHBh\ncmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhlIGtleQogICAgICogQHBhcmFt\nIGNscyB0eXBlIHdlJ3JlIGpvaW5pbmcgZnJvbQogICAgICogQHBhcmFtIHJl\nbCB0YXJnZXQgdHlwZSB3ZSdyZSBqb2luaW5nIHRvCiAgICAgKiBAcGFyYW0g\naW52ZXJzYWJsZSB3aGV0aGVyIHRoZSBmb3JlaWduIGtleSBjYW4gYmUgaW52\nZXJzZWQKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2Rp\nZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBGb3JlaWduS2V5IGNyZWF0ZUZvcmVpZ25LZXkoTWV0YURh\ndGFDb250ZXh0IGNvbnRleHQsCiAgICAgICAgU3RyaW5nIHByZWZpeCwgTGlz\ndCBnaXZlbiwgRm9yZWlnbktleURlZmF1bHRzIGRlZiwgVGFibGUgdGFibGUs\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNscywgQ2xhc3NNYXBwaW5nIHJlbCwg\nYm9vbGVhbiBpbnZlcnNhYmxlLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAg\nYXNzZXJ0VGFibGUoY29udGV4dCwgdGFibGUpOwogICAgICAgIGlmIChwcmVm\naXggPT0gbnVsbCkKICAgICAgICAgICAgcHJlZml4ID0gImdlbmVyaWMiOwoK\nICAgICAgICAvLyBjb2xsZWN0IHRoZSBmb3JlaWduIGtleSBjb2x1bW5zIGFu\nZCB0aGVpciB0YXJnZXRzCiAgICAgICAgT2JqZWN0W11bXSBqb2lucyA9IGNy\nZWF0ZUpvaW5zKGNvbnRleHQsIHByZWZpeCwgdGFibGUsIGNscywgcmVsLAog\nICAgICAgICAgICBnaXZlbiwgZGVmLCBpbnZlcnNhYmxlLCBhZGFwdCk7CiAg\nICAgICAgX2pvaW4gPSBKT0lOX0ZPUldBUkQ7CgogICAgICAgIC8vIGVzdGFi\nbGlzaCBsb2NhbCB0YWJsZSB1c2luZyBhbnkgam9pbiBiZXR3ZWVuIHR3byBj\nb2x1bW5zOyBpZiB3ZSBvbmx5CiAgICAgICAgLy8gZmluZCBjb25zdGFudCBq\nb2lucywgdGhlbiBrZWVwIGRlZmF1bHQgbG9jYWwgdGFibGUgKGRpcmVjdGlv\nbmxlc3MpCiAgICAgICAgVGFibGUgbG9jYWwgPSB0YWJsZTsKICAgICAgICBU\nYWJsZSBmb3JlaWduID0gcmVsLmdldFRhYmxlKCk7CiAgICAgICAgVGFibGUg\ndG1wOwogICAgICAgIGJvb2xlYW4gY29uc3RhbnQgPSBmYWxzZTsKICAgICAg\nICBib29sZWFuIGxvY2FsU2V0ID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoam9pbnNbaV1bMV1pbnN0YW5jZW9mIENvbHVtbikgewogICAgICAgICAg\nICAgICAgdG1wID0gKChDb2x1bW4pIGpvaW5zW2ldWzBdKS5nZXRUYWJsZSgp\nOwogICAgICAgICAgICAgICAgaWYgKCFsb2NhbFNldCkgewogICAgICAgICAg\nICAgICAgICAgIGxvY2FsID0gdG1wOwogICAgICAgICAgICAgICAgICAgIGxv\nY2FsU2V0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG1w\nICE9IGxvY2FsKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiLW11bHQtZmstdGFibGVzIiwgY29udGV4dCwgbG9jYWws\nIHRtcCkpOwogICAgICAgICAgICAgICAgZm9yZWlnbiA9ICgoQ29sdW1uKSBq\nb2luc1tpXVsxXSkuZ2V0VGFibGUoKTsKCiAgICAgICAgICAgICAgICBpZiAo\nam9pbnNbaV1bMl0gPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAg\nICAgIF9qb2luID0gSk9JTl9JTlZFUlNFOwogICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgIGNvbnN0YW50ID0gdHJ1ZTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGlmIHRoaXMgaXMgbm90IGEgY29uc3RhbnQgam9pbiwgbG9v\nayBmb3IgZXhpc3RpbmcgZm9yZWlnbiBrZXkKICAgICAgICAvLyBvbiBsb2Nh\nbCBjb2x1bW5zCiAgICAgICAgRm9yZWlnbktleSBleGlzdCA9IG51bGw7CiAg\nICAgICAgaWYgKCFjb25zdGFudCAmJiBsb2NhbC5nZXRGb3JlaWduS2V5cygp\nLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgQ29sdW1uW10gY29scyA9IG5l\ndyBDb2x1bW5bam9pbnMubGVuZ3RoXTsKICAgICAgICAgICAgQ29sdW1uW10g\ncGtzID0gbmV3IENvbHVtbltqb2lucy5sZW5ndGhdOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBjb2xzW2ldID0gKENvbHVtbikgam9pbnNbaV1bMF07CiAg\nICAgICAgICAgICAgICBwa3NbaV0gPSAoQ29sdW1uKSBqb2luc1tpXVsxXTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9\nIGxvY2FsLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZmtzW2ldLmdldENvbnN0YW50Q29sdW1ucygpLmxlbmd0aCA9PSAw\nCiAgICAgICAgICAgICAgICAgICAgJiYgZmtzW2ldLmdldENvbnN0YW50UHJp\nbWFyeUtleUNvbHVtbnMoKS5sZW5ndGggPT0gMAogICAgICAgICAgICAgICAg\nICAgICYmIGZrc1tpXS5jb2x1bW5zTWF0Y2goY29scywgcGtzKSkgewogICAg\nICAgICAgICAgICAgICAgIGV4aXN0ID0gZmtzW2ldOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBNYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9\nIChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7\nCiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSByZXBvcy5nZXREQkRpY3Rp\nb25hcnkoKTsKICAgICAgICBpZiAoZXhpc3QgIT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBtYWtlIGV4aXN0aW5nIGtleSBsb2dpY2FsPwogICAgICAgICAg\nICBpZiAoIV9jYW5GSykgewogICAgICAgICAgICAgICAgaWYgKGV4aXN0Lmdl\ndERlbGV0ZUFjdGlvbigpICE9IGV4aXN0LkFDVElPTl9OT05FICYmICFhZGFw\ndCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAg\nICsgIi1may1leGlzdHMiLCBjb250ZXh0KSk7CiAgICAgICAgICAgICAgICBl\neGlzdC5zZXREZWxldGVBY3Rpb24oZXhpc3QuQUNUSU9OX05PTkUpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAoX2ZrICE9IG51bGwgJiYgX2Zr\nLmlzRGVmZXJyZWQoKSAmJiAhZXhpc3QuaXNEZWZlcnJlZCgpKSB7CiAgICAg\nICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldChwcmVmaXggKyAiLWRlZmVyLWZr\nIiwgY29udGV4dCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBh\nbGxvdyB1c2VyLWdpdmVuIGluZm8gdG8gb3ZlcnJpZGUgZXhpc3Rpbmcga2V5\nIGlmIHdlJ3JlIGFkYXB0aW5nOwogICAgICAgICAgICAvLyB0ZW1wbGF0ZSBp\nbmZvIGNhbm5vdCBvdmVycmlkZSBleGlzdGluZyBrZXkKICAgICAgICAgICAg\naWYgKGFkYXB0ICYmIF9mayAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoX2ZrLmdldFVwZGF0ZUFjdGlvbigpICE9IEZvcmVpZ25LZXkuQUNUSU9O\nX05PTkUpCiAgICAgICAgICAgICAgICAgICAgZXhpc3Quc2V0VXBkYXRlQWN0\naW9uKF9may5nZXRVcGRhdGVBY3Rpb24oKSk7CiAgICAgICAgICAgICAgICBp\nZiAoX2ZrLmdldERlbGV0ZUFjdGlvbigpICE9IEZvcmVpZ25LZXkuQUNUSU9O\nX05PTkUpCiAgICAgICAgICAgICAgICAgICAgZXhpc3Quc2V0RGVsZXRlQWN0\naW9uKF9may5nZXREZWxldGVBY3Rpb24oKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgc2V0SU9Gcm9tSm9pbnMoZXhpc3QsIGpvaW5zKTsKICAgICAg\nICAgICAgcmV0dXJuIGV4aXN0OwogICAgICAgIH0KCiAgICAgICAgU3RyaW5n\nIG5hbWUgPSBudWxsOwogICAgICAgIGludCBkZWxBY3Rpb24gPSBGb3JlaWdu\nS2V5LkFDVElPTl9OT05FOwogICAgICAgIGludCB1cEFjdGlvbiA9IEZvcmVp\nZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAgYm9vbGVhbiBkZWZlcnJlZCA9\nIGZhbHNlOwogICAgICAgIGJvb2xlYW4gZmlsbCA9IHJlcG9zLmdldE1hcHBp\nbmdEZWZhdWx0cygpLmRlZmF1bHRNaXNzaW5nSW5mbygpOwogICAgICAgIEZv\ncmVpZ25LZXkgdG1wbGF0ZSA9IChkZWYgPT0gbnVsbCkgPyBudWxsCiAgICAg\nICAgICAgIDogZGVmLmdldChsb2NhbCwgZm9yZWlnbiwgX2pvaW4gPT0gSk9J\nTl9JTlZFUlNFKTsKICAgICAgICBpZiAoX2ZrICE9IG51bGwgJiYgKHRtcGxh\ndGUgPT0gbnVsbCB8fCAoIWFkYXB0ICYmICFmaWxsKSkpIHsKICAgICAgICAg\nICAgLy8gaWYgbm90IGFkYXB0aW5nIG9yIG5vIHRlbXBsYXRlIGluZm8gdXNl\nIGdpdmVuIGRhdGEKICAgICAgICAgICAgbmFtZSA9IF9may5nZXROYW1lKCk7\nCiAgICAgICAgICAgIGRlbEFjdGlvbiA9IF9may5nZXREZWxldGVBY3Rpb24o\nKTsKICAgICAgICAgICAgdXBBY3Rpb24gPSBfZmsuZ2V0VXBkYXRlQWN0aW9u\nKCk7CiAgICAgICAgICAgIGRlZmVycmVkID0gX2ZrLmlzRGVmZXJyZWQoKTsK\nICAgICAgICB9IGVsc2UgaWYgKF9jYW5GSyAmJiAoYWRhcHQgfHwgZmlsbCkp\nIHsKICAgICAgICAgICAgaWYgKF9mayA9PSBudWxsICYmIHRtcGxhdGUgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgLy8gbm8gdXNlciBnaXZlbiBpbmZv\nOyB1c2UgdGVtcGxhdGUgZGF0YQogICAgICAgICAgICAgICAgbmFtZSA9IHRt\ncGxhdGUuZ2V0TmFtZSgpOwogICAgICAgICAgICAgICAgZGVsQWN0aW9uID0g\ndG1wbGF0ZS5nZXREZWxldGVBY3Rpb24oKTsKICAgICAgICAgICAgICAgIHVw\nQWN0aW9uID0gdG1wbGF0ZS5nZXRVcGRhdGVBY3Rpb24oKTsKICAgICAgICAg\nICAgICAgIGRlZmVycmVkID0gdG1wbGF0ZS5pc0RlZmVycmVkKCk7CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAoX2ZrICE9IG51bGwgJiYgdG1wbGF0ZSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtZXJnZSB1c2VyIGFuZCB0ZW1w\nbGF0ZSBkYXRhLCBhbHdheXMgbGV0dGluZyB1c2VyIGluZm8gd2luCiAgICAg\nICAgICAgICAgICBuYW1lID0gX2ZrLmdldE5hbWUoKTsKICAgICAgICAgICAg\nICAgIGlmIChuYW1lID09IG51bGwgJiYgdG1wbGF0ZS5nZXROYW1lKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBuYW1lID0gdG1wbGF0ZS5nZXRO\nYW1lKCk7CiAgICAgICAgICAgICAgICBkZWxBY3Rpb24gPSBfZmsuZ2V0RGVs\nZXRlQWN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoZGVsQWN0aW9uID09\nIEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgICAgICAgICAg\nZGVsQWN0aW9uID0gdG1wbGF0ZS5nZXREZWxldGVBY3Rpb24oKTsKICAgICAg\nICAgICAgICAgIHVwQWN0aW9uID0gX2ZrLmdldFVwZGF0ZUFjdGlvbigpOwog\nICAgICAgICAgICAgICAgaWYgKHVwQWN0aW9uID09IEZvcmVpZ25LZXkuQUNU\nSU9OX05PTkUpCiAgICAgICAgICAgICAgICAgICAgdXBBY3Rpb24gPSB0bXBs\nYXRlLmdldFVwZGF0ZUFjdGlvbigpOwogICAgICAgICAgICAgICAgZGVmZXJy\nZWQgPSBfZmsuaXNEZWZlcnJlZCgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBpZiAoIWRpY3Quc3VwcG9ydHNEZWxldGVBY3Rpb24oZGVs\nQWN0aW9uKQogICAgICAgICAgICB8fCAhZGljdC5zdXBwb3J0c1VwZGF0ZUFj\ndGlvbih1cEFjdGlvbikpIHsKICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9z\nLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCAr\nICItdW5zdXBwb3J0ZWQtZmstYWN0aW9uIiwgY29udGV4dCkpOwogICAgICAg\nICAgICBkZWxBY3Rpb24gPSBGb3JlaWduS2V5LkFDVElPTl9OT05FOwogICAg\nICAgICAgICB1cEFjdGlvbiA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAg\nICAgICAgfQogICAgICAgIGlmIChkZWZlcnJlZCAmJiAhZGljdC5zdXBwb3J0\nc0RlZmVycmVkQ29uc3RyYWludHMpIHsKICAgICAgICAgICAgTG9nIGxvZyA9\nIHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KHBy\nZWZpeCArICItY3JlYXRlLWRlZmVyLWZrIiwKICAgICAgICAgICAgICAgICAg\nICBjb250ZXh0LCBkaWN0LnBsYXRmb3JtKSk7CiAgICAgICAgICAgIGRlZmVy\ncmVkID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgZm9y\nZWlnbiBrZXkgd2l0aCBtZXJnZWQgaW5mbwogICAgICAgIEZvcmVpZ25LZXkg\nZmsgPSBsb2NhbC5hZGRGb3JlaWduS2V5KG5hbWUpOwogICAgICAgIGZrLnNl\ndERlbGV0ZUFjdGlvbihkZWxBY3Rpb24pOwogICAgICAgIGZrLnNldFVwZGF0\nZUFjdGlvbih1cEFjdGlvbik7CiAgICAgICAgZmsuc2V0RGVmZXJyZWQoZGVm\nZXJyZWQpOwoKICAgICAgICAvLyBhZGQgam9pbnMgdG8ga2V5CiAgICAgICAg\nQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5z\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbCA9IChDb2x1bW4pIGpv\naW5zW2ldWzBdOwogICAgICAgICAgICBpZiAoam9pbnNbaV1bMV1pbnN0YW5j\nZW9mIENvbHVtbikKICAgICAgICAgICAgICAgIGZrLmpvaW4oY29sLCAoQ29s\ndW1uKSBqb2luc1tpXVsxXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKChqb2lu\nc1tpXVsyXSA9PSBCb29sZWFuLlRSVUUpICE9IChfam9pbiA9PSBKT0lOX0lO\nVkVSU0UpKQogICAgICAgICAgICAgICAgZmsuam9pbkNvbnN0YW50KGpvaW5z\nW2ldWzFdLCBjb2wpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBmay5qb2luQ29uc3RhbnQoY29sLCBqb2luc1tpXVsxXSk7CiAgICAgICAg\nfQogICAgICAgIHNldElPRnJvbUpvaW5zKGZrLCBqb2lucyk7CiAgICAgICAg\ncmV0dXJuIGZrOwogICAgfQoKICAgIC8qKgogICAgICogVXNlIHRoZSBqb2lu\nIGluZm9ybWF0aW9uIHRvIHBvcHVsYXRlIG91ciBpbnRlcm5hbCBjb2x1bW4g\nSS9PIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRJT0Zyb21K\nb2lucyhGb3JlaWduS2V5IGZrLCBPYmplY3RbXVtdIGpvaW5zKSB7CiAgICAg\nICAgTGlzdCBjb2xzID0gZ2V0Q29sdW1ucygpOwogICAgICAgIF9pbyA9IG51\nbGw7CiAgICAgICAgaWYgKGNvbHMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGludCBjb25zdElkeCA9IDA7CiAgICAgICAgaW50\nIGlkeDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGNvbnN0IGNvbHVtbnMgYXJlIGlu\nZGV4ZWQgYWZ0ZXIgc3RkIGpvaW4gY29sdW1ucyBpbiBmayBJTwogICAgICAg\nICAgICBpZiAoam9pbnNbaV1bMV1pbnN0YW5jZW9mIENvbHVtbikKICAgICAg\nICAgICAgICAgIGlkeCA9IGkgLSBjb25zdElkeDsKICAgICAgICAgICAgZWxz\nZSBpZiAoKGpvaW5zW2ldWzJdID09IEJvb2xlYW4uVFJVRSkgPT0gKF9qb2lu\nID09IEpPSU5fSU5WRVJTRSkpCiAgICAgICAgICAgICAgICBpZHggPSBmay5n\nZXRDb2x1bW5zKCkubGVuZ3RoICsgY29uc3RJZHgrKzsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIHNl\ndElPRnJvbUNvbHVtbkZsYWdzKChDb2x1bW4pIGNvbHMuZ2V0KGkpLCBpZHgp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBvciBy\nZXRyaWV2ZSB0aGUgZm9yZWlnbiBrZXkgam9pbnMuCiAgICAgKgogICAgICog\nQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBh\nIGtleSBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXggbG9jYWxpemVkIGVycm9y\nIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBhcmFtIHRhYmxlIHRoZSB0\nYWJsZSBmb3IgdGhlIGtleQogICAgICogQHBhcmFtIGNscyB0eXBlIHdlJ3Jl\nIGpvaW5pbmcgZnJvbSwgaWYgYXBwbGljYWJsZQogICAgICogQHBhcmFtIHJl\nbCB0YXJnZXQgdHlwZSB3ZSdyZSBqb2luaW5nIHRvCiAgICAgKiBAcGFyYW0g\nZ2l2ZW4gdGhlIGNvbHVtbnMgZ2l2ZW4gYnkgdGhlIHVzZXIKICAgICAqIEBw\nYXJhbSBkZWYgZm9yZWlnbiBrZXkgZGVmYXVsdHMgcHJvdmlkZXIKICAgICAq\nIEBwYXJhbSBpbnZlcnNhYmxlIHdoZXRoZXIgdGhlIGZvcmVpZ24ga2V5IGNh\nbiBiZSBpbnZlcnNlZAogICAgICogQHBhcmFtIGFkYXB0IHdoZXRoZXIgd2Ug\nY2FuIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGluZyBvciBzY2hlbWEKICAg\nICAqIEByZXR1cm4gYXJyYXkgb2YgdHVwbGVzIHdoZXJlIHRoZSBmaXJzdCBl\nbGVtZW50IGlzIHRoZQogICAgICogbG9jYWwgY29sdW1uIChvciBpbiB0aGUg\nY2FzZSBvZiBhIGNvbnN0YW50IGpvaW4gdGhlCiAgICAgKiBzb2xlIGNvbHVt\nbiksIHRoZSBzZWNvbmQgaXMgdGhlIHRhcmdldCBjb2x1bW4gKG9yCiAgICAg\nKiBjb25zdGFudCksIGFuZCB0aGUgdGhpcmQgaXMge0BsaW5rIEJvb2xlYW4j\nVFJVRX0gaWYKICAgICAqIHRoaXMgaXMgYW4gaW52ZXJzZSBqb2luCiAgICAg\nKi8KICAgIHByaXZhdGUgT2JqZWN0W11bXSBjcmVhdGVKb2lucyhNZXRhRGF0\nYUNvbnRleHQgY29udGV4dCwKICAgICAgICBTdHJpbmcgcHJlZml4LCBUYWJs\nZSB0YWJsZSwgQ2xhc3NNYXBwaW5nIGNscywgQ2xhc3NNYXBwaW5nIHJlbCwK\nICAgICAgICBMaXN0IGdpdmVuLCBGb3JlaWduS2V5RGVmYXVsdHMgZGVmLCBi\nb29sZWFuIGludmVyc2FibGUsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBN\nYXBwaW5nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkg\nY29udGV4dC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgYm9vbGVhbiBmaWxs\nID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJ\nbmZvKCk7CiAgICAgICAgT2JqZWN0W11bXSBqb2luczsKCiAgICAgICAgLy8g\naWYgbm8gY29sdW1ucyBnaXZlbiwganVzdCBjcmVhdGUgbWlycm9ycyBvZiB0\nYXJnZXQgY29sdW1ucwogICAgICAgIGlmIChnaXZlbi5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgaWYgKCFhZGFwdCAmJiAhZmlsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVm\naXggKyAiLW5vLWZrLWNvbHMiLAogICAgICAgICAgICAgICAgICAgIGNvbnRl\neHQpKTsKCiAgICAgICAgICAgIENvbHVtbltdIHRhcmdldHMgPSByZWwuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBuZXcg\nT2JqZWN0W3RhcmdldHMubGVuZ3RoXVszXTsKICAgICAgICAgICAgQ29sdW1u\nIHRtcGxhdGU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGFy\nZ2V0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdG1wbGF0ZSA9\nIG5ldyBDb2x1bW4oKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUuc2V0TmFt\nZSh0YXJnZXRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICB0bXBs\nYXRlLnNldEphdmFUeXBlKHRhcmdldHNbaV0uZ2V0SmF2YVR5cGUoKSk7CiAg\nICAgICAgICAgICAgICB0bXBsYXRlLnNldFR5cGUodGFyZ2V0c1tpXS5nZXRU\neXBlKCkpOwogICAgICAgICAgICAgICAgdG1wbGF0ZS5zZXRUeXBlTmFtZSh0\nYXJnZXRzW2ldLmdldFR5cGVOYW1lKCkpOwogICAgICAgICAgICAgICAgdG1w\nbGF0ZS5zZXRTaXplKHRhcmdldHNbaV0uZ2V0U2l6ZSgpKTsKICAgICAgICAg\nICAgICAgIHRtcGxhdGUuc2V0RGVjaW1hbERpZ2l0cyh0YXJnZXRzW2ldLmdl\ndERlY2ltYWxEaWdpdHMoKSk7CgogICAgICAgICAgICAgICAgaWYgKGRlZiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGRlZi5wb3B1bGF0ZSh0YWJs\nZSwgcmVsLmdldFRhYmxlKCksIHRtcGxhdGUsIHRhcmdldHNbaV0sCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZhbHNlLCBpLCB0YXJnZXRzLmxlbmd0aCk7\nCiAgICAgICAgICAgICAgICBqb2luc1tpXVswXSA9IG1lcmdlQ29sdW1uKGNv\nbnRleHQsIHByZWZpeCwgdG1wbGF0ZSwgdHJ1ZSwKICAgICAgICAgICAgICAg\nICAgICBudWxsLCB0YWJsZSwgYWRhcHQsIGZpbGwpOwogICAgICAgICAgICAg\nICAgam9pbnNbaV1bMV0gPSB0YXJnZXRzW2ldOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBqb2luczsKICAgICAgICB9CgogICAgICAgIC8v\nIHVzZSBnaXZlbiBjb2x1bW5zIHRvIGNyZWF0ZSBqb2luLiAgd2UgZG9uJ3Qg\ndHJ5IHRvIHVzZSBhbnkgb2YgdGhlCiAgICAgICAgLy8gdGVtcGxhdGUgY29s\ndW1ucywgZXZlbiBpZiB0aGUgdXNlciBkb2Vzbid0IGdpdmUgYSBjb2x1bW4g\nbGlua2luZyB0bwogICAgICAgIC8vIGV2ZXJ5IHByaW1hcnkga2V5IG9mIHRo\nZSB0YXJnZXQgdHlwZSAtLSB1c2VycyBhcmUgYWxsb3dlZCB0byBjcmVhdGUK\nICAgICAgICAvLyBwYXJ0aWFsIGpvaW5zLiAgdGhpcyBtZWFucywgdGhvdWdo\nLCB0aGF0IGlmIGEgdXNlciB3YW50cyB0byBzcGVjaWZ5CiAgICAgICAgLy8g\naW5mbyBmb3Igb25lIGpvaW4gY29sdW1uLCBoZSBoYXMgdG8gYXQgbGVhc3Qg\nY3JlYXRlIGVsZW1lbnRzIGZvcgogICAgICAgIC8vIGFsbCBvZiB0aGVtCgog\nICAgICAgIGpvaW5zID0gbmV3IE9iamVjdFtnaXZlbi5zaXplKCldWzNdOwog\nICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2wgPSAoQ29s\ndW1uKSBnaXZlbi5nZXQoaSk7CiAgICAgICAgICAgIG1lcmdlSm9pbkNvbHVt\nbihjb250ZXh0LCBwcmVmaXgsIGNvbCwgam9pbnMsIGksIHRhYmxlLCBjbHMs\nIHJlbCwKICAgICAgICAgICAgICAgIGRlZiwgaW52ZXJzYWJsZSAmJiAhY29s\nLmdldEZsYWcoQ29sdW1uLkZMQUdfUEtfSk9JTiksIGFkYXB0LAogICAgICAg\nICAgICAgICAgZmlsbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBqb2lu\nczsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBvciByZXRyaWV2ZSBh\nIGZvcmVpZ24ga2V5IGNvbHVtbiBmb3IgYSBqb2luLgogICAgICoKICAgICAq\nIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHdlJ3JlIHJldHJpZXZpbmcg\nYSBrZXkgZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJv\nciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSBnaXZlbiB0aGUg\nZ2l2ZW4gbG9jYWwgZm9yZWlnbiBrZXkgY29sdW1uCiAgICAgKiBAcGFyYW0g\nam9pbnMgYXJyYXkgb2Ygam9pbnMKICAgICAqIEBwYXJhbSBpZHggaW5kZXgg\nb2YgdGhlIGpvaW4gYXJyYXkgdG8gcG9wdWxhdGUKICAgICAqIEBwYXJhbSB0\nYWJsZSB0aGUgdGFibGUgZm9yIHRoZSBrZXkKICAgICAqIEBwYXJhbSBjbHMg\ndGhlIHR5cGUgd2UncmUgam9pbmluZyBmcm9tCiAgICAgKiBAcGFyYW0gcmVs\nIHRhcmdldCB0eXBlIHdlJ3JlIGpvaW5pbmcgdG8KICAgICAqIEBwYXJhbSBk\nZWYgZm9yZWlnbiBrZXkgZGVmYXVsdHMgcHJvdmlkZXI7CiAgICAgKiB1c2Ug\nbnVsbCB0byBtaXJyb3IgdGFyZ2V0IGNvbHVtbiBuYW1lcwogICAgICogQHBh\ncmFtIGludmVyc2FibGUgd2hldGhlciB0aGUgZm9yZWlnbiBrZXkgY2FuIGJl\nIGludmVyc2VkCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4g\nbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVtYQogICAgICog\nQHBhcmFtIGZpbGwgd2hldGhlciB0byBkZWZhdWx0IG1pc3NpbmcgY29sdW1u\nIGluZm9ybWF0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtZXJnZUpv\naW5Db2x1bW4oTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFN0cmluZyBwcmVm\naXgsCiAgICAgICAgQ29sdW1uIGdpdmVuLCBPYmplY3RbXVtdIGpvaW5zLCBp\nbnQgaWR4LCBUYWJsZSB0YWJsZSwgQ2xhc3NNYXBwaW5nIGNscywKICAgICAg\nICBDbGFzc01hcHBpbmcgcmVsLCBGb3JlaWduS2V5RGVmYXVsdHMgZGVmLCBi\nb29sZWFuIGludmVyc2FibGUsCiAgICAgICAgYm9vbGVhbiBhZGFwdCwgYm9v\nbGVhbiBmaWxsKSB7CiAgICAgICAgLy8gZGVmYXVsdCB0byB0aGUgcHJpbWFy\neSBrZXkgY29sdW1uIG5hbWUgaWYgdGhpcyBpcyBhIHBrIGpvaW4KICAgICAg\nICBTdHJpbmcgbmFtZSA9IGdpdmVuLmdldE5hbWUoKTsKICAgICAgICBpZiAo\nbmFtZSA9PSBudWxsICYmIGdpdmVuICE9IG51bGwKICAgICAgICAgICAgJiYg\nZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19QS19KT0lOKSAmJiBjbHMgIT0g\nbnVsbCkgewogICAgICAgICAgICBDb2x1bW5bXSBwa3MgPSBjbHMuZ2V0UHJp\nbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgaWYgKHBrcy5sZW5ndGgg\nPT0gMSkKICAgICAgICAgICAgICAgIG5hbWUgPSBwa3NbMF0uZ2V0TmFtZSgp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgd2UgY2FuJ3QgYWRhcHQsIHRo\nZW4gdGhlIHVzZXIgbXVzdCBhdCBsZWFzdCBnaXZlIGEgY29sdW1uIG5hbWUK\nICAgICAgICBpZiAobmFtZSA9PSBudWxsICYmICFhZGFwdCAmJiAhZmlsbCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KHByZWZpeCArICItbm8tZmtjb2wtbmFtZSIsCiAgICAgICAgICAgICAg\nICBjb250ZXh0KSk7CgogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB0aGUg\nY29sdW1uIGlzbid0IGluIHRoZSBleHBlY3RlZCB0YWJsZTsgaXQgbWlnaHQK\nICAgICAgICAvLyBiZSBhbiBpbnZlcnNlIGpvaW4gb3IgYSBqb2luIHRvIGEg\nYmFzZSBjbGFzcyBvZiB0aGUgdGFyZ2V0IHR5cGUKICAgICAgICBUYWJsZSBs\nb2NhbCA9IHRhYmxlOwogICAgICAgIFRhYmxlIGZvcmVpZ24gPSByZWwuZ2V0\nVGFibGUoKTsKICAgICAgICBib29sZWFuIGZ1bGxOYW1lID0gZmFsc2U7CiAg\nICAgICAgYm9vbGVhbiBpbnZlcnNlID0gZmFsc2U7CiAgICAgICAgaWYgKG5h\nbWUgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgZG90SWR4ID0gbmFtZS5s\nYXN0SW5kZXhPZignLicpOwogICAgICAgICAgICBpZiAoZG90SWR4ICE9IC0x\nKSB7CiAgICAgICAgICAgICAgICAvLyBhbGxvdyB1c2Ugb2YgJy4nIHdpdGhv\ndXQgcHJlZml4IHRvIG1lYW4gInVzZSBleHBlY3RlZAogICAgICAgICAgICAg\nICAgLy8gZm9yZWlnbiB0YWJsZSIKICAgICAgICAgICAgICAgIGlmIChkb3RJ\nZHggPT0gMCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCA9IGZvcmVpZ247\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9j\nYWwgPSBmaW5kVGFibGUoY29udGV4dCwgbmFtZS5zdWJzdHJpbmcoMCwgZG90\nSWR4KSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwsIGZvcmVpZ24s\nIG51bGwpOwogICAgICAgICAgICAgICAgZnVsbE5hbWUgPSB0cnVlOwogICAg\nICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEp\nOwoKICAgICAgICAgICAgICAgIC8vIGlmIGludmVyc2Ugam9pbiwgdGhlbiBz\nd2FwIGxvY2FsIGFuZCBmb3JlaWduIHRhYmxlcwogICAgICAgICAgICAgICAg\naWYgKGxvY2FsICE9IHRhYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgZm9y\nZWlnbiA9IHRhYmxlOwogICAgICAgICAgICAgICAgICAgIGludmVyc2UgPSB0\ncnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGJvb2xlYW4gZm9yY2VJbnZlcnNlID0gIWZ1bGxOYW1lICYm\nIF9qb2luID09IEpPSU5fSU5WRVJTRTsKICAgICAgICBpZiAoZm9yY2VJbnZl\ncnNlKSB7CiAgICAgICAgICAgIGxvY2FsID0gZm9yZWlnbjsKICAgICAgICAg\nICAgZm9yZWlnbiA9IHRhYmxlOwogICAgICAgICAgICBpbnZlcnNlID0gdHJ1\nZTsKICAgICAgICB9CgogICAgICAgIC8vIGRldGVybWluZSB0YXJnZXQKICAg\nICAgICBTdHJpbmcgdGFyZ2V0TmFtZSA9IGdpdmVuLmdldFRhcmdldCgpOwog\nICAgICAgIE9iamVjdCB0YXJnZXQgPSBudWxsOwogICAgICAgIFRhYmxlIHR0\nYWJsZSA9IG51bGw7CiAgICAgICAgYm9vbGVhbiBjb25zdGFudCA9IGZhbHNl\nOwogICAgICAgIGJvb2xlYW4gZnVsbFRhcmdldCA9IGZhbHNlOwogICAgICAg\nIGlmICh0YXJnZXROYW1lID09IG51bGwgJiYgZ2l2ZW4uZ2V0VGFyZ2V0Rmll\nbGQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0Y2xz\nID0gKGludmVyc2UpID8gY2xzIDogcmVsOwogICAgICAgICAgICBTdHJpbmcg\nZmllbGROYW1lID0gZ2l2ZW4uZ2V0VGFyZ2V0RmllbGQoKTsKICAgICAgICAg\nICAgaW50IGRvdElkeCA9IGZpZWxkTmFtZS5sYXN0SW5kZXhPZignLicpOwog\nICAgICAgICAgICBmdWxsVGFyZ2V0ID0gZG90SWR4ICE9IC0xOwoKICAgICAg\nICAgICAgaWYgKGRvdElkeCA9PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBh\nbGxvdyB1c2Ugb2YgJy4nIHdpdGhvdXQgcHJlZml4IHRvIG1lYW4gInVzZSBl\neHBlY3RlZCBsb2NhbAogICAgICAgICAgICAgICAgLy8gY2xzIjsgYnV0IGlm\nIHdlIGFscmVhZHkgaW52ZXJzZWQgbm8gbmVlZCB0byBzd2l0Y2ggYWdhaW4K\nICAgICAgICAgICAgICAgIGlmICghaW52ZXJzZSkKICAgICAgICAgICAgICAg\nICAgICB0Y2xzID0gY2xzOwogICAgICAgICAgICAgICAgZmllbGROYW1lID0g\nZmllbGROYW1lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChkb3RJZHggPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBtdXN0IGJlIGNs\nYXNzICsgZmllbGQgbmFtZQogICAgICAgICAgICAgICAgdGNscyA9IGZpbmRD\nbGFzc01hcHBpbmcoY29udGV4dCwgZmllbGROYW1lLnN1YnN0cmluZwogICAg\nICAgICAgICAgICAgICAgICgwLCBkb3RJZHgpLCBjbHMsIHJlbCk7CiAgICAg\nICAgICAgICAgICBmaWVsZE5hbWUgPSBmaWVsZE5hbWUuc3Vic3RyaW5nKGRv\ndElkeCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0Y2xz\nID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAg\nKyAiLWJhZC1ma3RhcmdldGNscyIsIGNvbnRleHQsIGZpZWxkTmFtZSwgbmFt\nZSkpOwoKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0gdGNscy5n\nZXRGaWVsZE1hcHBpbmcoZmllbGROYW1lKTsKICAgICAgICAgICAgaWYgKGZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAg\nICAgKyAiLWJhZC1ma3RhcmdldGZpZWxkIiwgbmV3IE9iamVjdFtdeyBjb250\nZXh0LCBmaWVsZE5hbWUsCiAgICAgICAgICAgICAgICAgICAgbmFtZSwgdGNs\ncyB9KSk7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRDb2x1bW5zKCkubGVu\nZ3RoICE9IDEpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAg\nKyAiLWZrdGFyZ2V0ZmllbGQtY29scyIsIGNvbnRleHQsIGZpZWxkTmFtZSwg\nbmFtZSkpOwogICAgICAgICAgICB0dGFibGUgPSAoZmllbGQuZ2V0Sm9pbkZv\ncmVpZ25LZXkoKSAhPSBudWxsKSA/IGZpZWxkLmdldFRhYmxlKCkKICAgICAg\nICAgICAgICAgIDogZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuZ2V0VGFi\nbGUoKTsKICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IGZpZWxkLmdldENvbHVt\nbnMoKVswXS5nZXROYW1lKCk7CiAgICAgICAgfSBlbHNlIGlmICh0YXJnZXRO\nYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHRhcmdldE5hbWUuY2hh\nckF0KDApID09ICdcJycpIHsKICAgICAgICAgICAgICAgIGNvbnN0YW50ID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldE5hbWUuc3Vi\nc3RyaW5nKDEsIHRhcmdldE5hbWUubGVuZ3RoKCkgLSAxKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmICh0YXJnZXROYW1lLmNoYXJBdCgwKSA9PSAnLScKICAg\nICAgICAgICAgICAgIHx8IHRhcmdldE5hbWUuY2hhckF0KDApID09ICcuJwog\nICAgICAgICAgICAgICAgfHwgQ2hhcmFjdGVyLmlzRGlnaXQodGFyZ2V0TmFt\nZS5jaGFyQXQoMCkpKSB7CiAgICAgICAgICAgICAgICBjb25zdGFudCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIGlmICh0YXJnZXROYW1lLmluZGV4T2YoJy4nKSA9PSAtMSkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGFyZ2V0ID0gbmV3IEludGVnZXIodGFyZ2V0TmFt\nZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICB0YXJnZXQgPSBuZXcgRG91YmxlKHRhcmdldE5hbWUpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nLWJhZC1ma2NvbnN0IiwgY29udGV4dCwgdGFyZ2V0TmFtZSwgbmFtZSkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCJudWxs\nIi5lcXVhbHNJZ25vcmVDYXNlKHRhcmdldE5hbWUpKQogICAgICAgICAgICAg\nICAgY29uc3RhbnQgPSB0cnVlOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIGludCBkb3RJZHggPSB0YXJnZXROYW1lLmxhc3RJbmRleE9m\nKCcuJyk7CiAgICAgICAgICAgICAgICBmdWxsVGFyZ2V0ID0gZG90SWR4ICE9\nIC0xOwogICAgICAgICAgICAgICAgaWYgKGRvdElkeCA9PSAwKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gYWxsb3cgdXNlIG9mICcuJyB3aXRob3V0IHBy\nZWZpeCB0byBtZWFuICJ1c2UgZXhwZWN0ZWQKICAgICAgICAgICAgICAgICAg\nICAvLyBsb2NhbCB0YWJsZSIsIGJ1dCBpZ25vcmUgaWYgd2UncmUgYWxyZWFk\neSBpbnZlcnNlZAogICAgICAgICAgICAgICAgICAgIGlmICghaW52ZXJzZSkK\nICAgICAgICAgICAgICAgICAgICAgICAgdHRhYmxlID0gbG9jYWw7CiAgICAg\nICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IHRhcmdldE5hbWUuc3Vic3Ry\naW5nKDEpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb3RJZHggIT0g\nLTEpIHsKICAgICAgICAgICAgICAgICAgICB0dGFibGUgPSBmaW5kVGFibGUo\nY29udGV4dCwgdGFyZ2V0TmFtZS5zdWJzdHJpbmcoMCwKICAgICAgICAgICAg\nICAgICAgICAgICAgZG90SWR4KSwgZm9yZWlnbiwgbG9jYWwsIChpbnZlcnNl\nKSA/IGNscyA6IHJlbCk7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFt\nZSA9IHRhcmdldE5hbWUuc3Vic3RyaW5nKGRvdElkeCArIDEpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAv\nLyB1c2UgZXhwbGljaXQgdGFyZ2V0IHRhYmxlIGlmIGF2YWlsYWJsZQogICAg\nICAgIGlmICh0dGFibGUgPT0gbG9jYWwgJiYgbG9jYWwgIT0gZm9yZWlnbikg\newogICAgICAgICAgICAvLyBzd2FwLCB1bmxlc3MgdXNlciBnYXZlIGluY29t\ncGF0aWJsZSB0YWJsZSBpbiBjb2x1bW4gbmFtZQogICAgICAgICAgICBpZiAo\nZnVsbE5hbWUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAgICAg\nKyAiLWJhZC1ma3RhcmdldC1pbnZlcnNlIiwgbmV3IE9iamVjdFtdeyBjb250\nZXh0LCBuYW1lLAogICAgICAgICAgICAgICAgICAgIGZvcmVpZ24sIHR0YWJs\nZSB9KSk7CiAgICAgICAgICAgIGxvY2FsID0gZm9yZWlnbjsKICAgICAgICAg\nICAgZm9yZWlnbiA9IHR0YWJsZTsKICAgICAgICB9IGVsc2UgaWYgKHR0YWJs\nZSAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHR0YWJsZSBtaWdodCBiZSBh\nIHRhYmxlIG9mIGEgYmFzZSBjbGFzcyBvZiB0aGUgdGFyZ2V0CiAgICAgICAg\nICAgIGZvcmVpZ24gPSB0dGFibGU7CiAgICAgICAgfQoKICAgICAgICAvLyBj\naGVjayB0byBzZWUgaWYgd2UgaW52ZXJzZWQ7IGlmIHRoaXMgaXMgYSBzYW1l\nLXRhYmxlIGpvaW4sIHRoZW4KICAgICAgICAvLyBjb25zaWRlciBpdCBhbiBp\nbXBsaWNpdCBpbnZlcnNlIGlmIHRoZSB1c2VyIGluY2x1ZGVzIHRoZSB0YWJs\nZSBuYW1lCiAgICAgICAgLy8gaW4gdGhlIGNvbHVtbiBuYW1lLCBidXQgbm90\nIGluIHRoZSBjb2x1bW4gdGFyZ2V0LCBvciBpZiB0aGUgdXNlcgogICAgICAg\nIC8vIGdpdmVzIG5vIGNvbHVtbiBuYW1lIGJ1dCBhIGZ1bGwgdGFyZ2V0IG5h\nbWUKICAgICAgICBpbnZlcnNlID0gaW52ZXJzZSB8fCBsb2NhbCAhPSB0YWJs\nZSB8fCAobG9jYWwgPT0gZm9yZWlnbgogICAgICAgICAgICAmJiAoKGZ1bGxO\nYW1lICYmICFmdWxsVGFyZ2V0KSB8fCAobmFtZSA9PSBudWxsICYmIGZ1bGxU\nYXJnZXQpKSk7CiAgICAgICAgaWYgKCFpbnZlcnNhYmxlICYmICFjb25zdGFu\ndCAmJiBpbnZlcnNlKSB7CiAgICAgICAgICAgIGlmIChsb2NhbCA9PSBmb3Jl\naWduKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1i\nYWQtZmstc2VsZi1pbnZlcnNlIiwgY29udGV4dCwgbG9jYWwpKTsKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHBy\nZWZpeCArICItYmFkLWZrLWludmVyc2UiLAogICAgICAgICAgICAgICAgY29u\ndGV4dCwgbG9jYWwsIHRhYmxlKSk7CiAgICAgICAgfQogICAgICAgIGlmIChu\nYW1lID09IG51bGwgJiYgY29uc3RhbnQpCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAgICAg\nICAgICAgICsgIi1uby1ma2NvbC1uYW1lLWFkYXB0IiwgY29udGV4dCkpOwoK\nICAgICAgICBpZiAobmFtZSA9PSBudWxsICYmIHRhcmdldE5hbWUgPT0gbnVs\nbCkgewogICAgICAgICAgICAvLyBpZiBubyBuYW1lIG9yIHRhcmdldCBpcyBw\ncm92aWRlZCBhbmQgdGhlcmUncyBtb3JlIHRoYW4gb25lIGxpa2VseQogICAg\nICAgICAgICAvLyBqb2luIHBvc3NpYmlsaXR5LCB0b28gYW1iaWd1b3VzCiAg\nICAgICAgICAgIFByaW1hcnlLZXkgcGsgPSBmb3JlaWduLmdldFByaW1hcnlL\nZXkoKTsKICAgICAgICAgICAgaWYgKGpvaW5zLmxlbmd0aCAhPSAxIHx8IHBr\nID09IG51bGwgfHwgcGsuZ2V0Q29sdW1ucygpLmxlbmd0aCAhPSAxKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1uby1ma2NvbC1u\nYW1lLWFkYXB0IiwgY29udGV4dCkpOwoKICAgICAgICAgICAgLy8gYXNzdW1l\nIHRhcmdldCBpcyBwayBjb2x1bW4KICAgICAgICAgICAgdGFyZ2V0TmFtZSA9\nIHBrLmdldENvbHVtbnMoKVswXS5nZXROYW1lKCk7CiAgICAgICAgfSBlbHNl\nIGlmIChuYW1lICE9IG51bGwgJiYgdGFyZ2V0TmFtZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIGlmIG9uZSBwcmltYXJ5IGtleSBjb2x1bW4gdXNlIGl0\nIGZvciB0YXJnZXQ7IGlmIG11bHRpcGxlIGpvaW5zCiAgICAgICAgICAgIC8v\nIGxvb2sgZm9yIGEgZm9yZWlnbiBjb2x1bW4gd2l0aCBzYW1lIG5hbWUgYXMg\nbG9jYWwgY29sdW1uCiAgICAgICAgICAgIFByaW1hcnlLZXkgcGsgPSBmb3Jl\naWduLmdldFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgaWYgKGpvaW5zLmxl\nbmd0aCA9PSAxICYmIHBrICE9IG51bGwgJiYgcGsuZ2V0Q29sdW1ucygpLmxl\nbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IHBrLmdl\ndENvbHVtbnMoKVswXS5nZXROYW1lKCk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKGZvcmVpZ24uZ2V0Q29sdW1uKG5hbWUpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0YXJnZXROYW1lID0gbmFtZTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KHByZWZpeAogICAgICAgICAgICAgICAgICAgICsgIi1uby1ma2NvbC10\nYXJnZXQtYWRhcHQiLCBjb250ZXh0LCBuYW1lKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBmaW5kIHRoZSB0YXJnZXQgY29sdW1uLCBhbmQgY3JlYXRlIHRl\nbXBsYXRlIGZvciBsb2NhbCBjb2x1bW4gYmFzZWQKICAgICAgICAvLyBvbiBp\ndAogICAgICAgIENvbHVtbiB0bXBsYXRlID0gbmV3IENvbHVtbigpOwogICAg\nICAgIHRtcGxhdGUuc2V0TmFtZShuYW1lKTsKICAgICAgICBpZiAoIWNvbnN0\nYW50KSB7CiAgICAgICAgICAgIENvbHVtbiB0Y29sID0gZm9yZWlnbi5nZXRD\nb2x1bW4odGFyZ2V0TmFtZSk7CiAgICAgICAgICAgIGlmICh0Y29sID09IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQocHJlZml4ICsgIi1iYWQtZmt0YXJnZXQiLAogICAgICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgY29udGV4dCwgdGFyZ2V0TmFt\nZSwgbmFtZSwgZm9yZWlnbiB9KSk7CgogICAgICAgICAgICBpZiAobmFtZSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdG1wbGF0ZS5zZXROYW1lKHRjb2wu\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZSh0\nY29sLmdldEphdmFUeXBlKCkpOwogICAgICAgICAgICB0bXBsYXRlLnNldFR5\ncGUodGNvbC5nZXRUeXBlKCkpOwogICAgICAgICAgICB0bXBsYXRlLnNldFR5\ncGVOYW1lKHRjb2wuZ2V0VHlwZU5hbWUoKSk7CiAgICAgICAgICAgIHRtcGxh\ndGUuc2V0U2l6ZSh0Y29sLmdldFNpemUoKSk7CiAgICAgICAgICAgIHRtcGxh\ndGUuc2V0RGVjaW1hbERpZ2l0cyh0Y29sLmdldERlY2ltYWxEaWdpdHMoKSk7\nCiAgICAgICAgICAgIHRhcmdldCA9IHRjb2w7CiAgICAgICAgfSBlbHNlIGlm\nICh0YXJnZXQgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHRtcGxh\ndGUuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLlNUUklORyk7CiAgICAgICAgZWxz\nZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSW50ZWdlcikKICAgICAgICAgICAg\ndG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAgICBl\nbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAg\nIHRtcGxhdGUuc2V0SmF2YVR5cGUoSmF2YVR5cGVzLkRPVUJMRSk7CgogICAg\nICAgIC8vIHBvcHVsYXRlIHRlbXBsYXRlLCBidXQgbGV0IHVzZXItZ2l2ZW4g\nbmFtZSBvdmVycmlkZSBkZWZhdWx0IG5hbWUKICAgICAgICBpZiAoZGVmICE9\nIG51bGwpCiAgICAgICAgICAgIGRlZi5wb3B1bGF0ZShsb2NhbCwgZm9yZWln\nbiwgdG1wbGF0ZSwgdGFyZ2V0LCBpbnZlcnNlLCBpZHgsCiAgICAgICAgICAg\nICAgICBqb2lucy5sZW5ndGgpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwp\nCiAgICAgICAgICAgIHRtcGxhdGUuc2V0TmFtZShuYW1lKTsKCiAgICAgICAg\nLy8gY3JlYXRlIG9yIG1lcmdlIGxvY2FsIGNvbHVtbgogICAgICAgIENvbHVt\nbiBjb2wgPSBtZXJnZUNvbHVtbihjb250ZXh0LCBwcmVmaXgsIHRtcGxhdGUs\nIHRydWUsIGdpdmVuLCBsb2NhbCwKICAgICAgICAgICAgYWRhcHQsIGZpbGwp\nOwoKICAgICAgICBqb2luc1tpZHhdWzBdID0gY29sOwogICAgICAgIGpvaW5z\nW2lkeF1bMV0gPSB0YXJnZXQ7CiAgICAgICAgaWYgKGludmVyc2UpCiAgICAg\nICAgICAgIGpvaW5zW2lkeF1bMl0gPSBCb29sZWFuLlRSVUU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBGaW5kIHRoZSB0YXJnZXQgY2xhc3MgbWFwcGluZyBn\naXZlbiB0aGUgdXNlcidzIGNsYXNzIG5hbWUuCiAgICAgKgogICAgICogQHBh\ncmFtIGNvbnRleHQgZm9yIGVycm9yIG1lc3NhZ2VzCiAgICAgKiBAcGFyYW0g\nY2xzTmFtZSBjbGFzcyBuYW1lIGdpdmVuIGJ5IHVzZXIKICAgICAqIEBwYXJh\nbSBjbHMgb3JpZ2luYWwgc291cmNlIG1hcHBpbmcKICAgICAqIEBwYXJhbSBy\nZWwgb3JpZ2luYWwgdGFyZ2V0IG1hcHBpbmcKICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgQ2xhc3NNYXBwaW5nIGZpbmRDbGFzc01hcHBpbmcoTWV0YURh\ndGFDb250ZXh0IGNvbnRleHQsCiAgICAgICAgU3RyaW5nIGNsc05hbWUsIENs\nYXNzTWFwcGluZyBjbHMsIENsYXNzTWFwcGluZyByZWwpIHsKICAgICAgICBp\nZiAoaXNDbGFzc01hcHBpbmdOYW1lKGNsc05hbWUsIGNscykpCiAgICAgICAg\nICAgIHJldHVybiBjbHM7CiAgICAgICAgaWYgKGlzQ2xhc3NNYXBwaW5nTmFt\nZShjbHNOYW1lLCByZWwpKQogICAgICAgICAgICByZXR1cm4gcmVsOwogICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidGFy\nZ2V0LXdyb25nLWNscyIsIG5ldyBPYmplY3RbXQogICAgICAgICAgICB7IGNv\nbnRleHQsIGNsc05hbWUsIGNscywgcmVsIH0pKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBuYW1lIG1hdGNoZXMg\ndGhlIGdpdmVuIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGJvb2xlYW4gaXNDbGFzc01hcHBpbmdOYW1lKFN0cmluZyBuYW1lLCBDbGFz\nc01hcHBpbmcgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKG5hbWUuZXF1YWxz\nKGNscy5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKQogICAgICAgICAg\nICB8fCBuYW1lLmVxdWFscyhTdHJpbmdzLmdldENsYXNzTmFtZShjbHMuZ2V0\nRGVzY3JpYmVkVHlwZSgpKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIHJldHVybiBpc0NsYXNzTWFwcGluZ05hbWUobmFtZSwgY2xzLmdl\ndFBDU3VwZXJjbGFzc01hcHBpbmcoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXRzIGludGVybmFsIGNvbHVtbiBpbmZvcm1hdGlvbiB0byBtYXRjaCB0\naGUgZ2l2ZW4gbWFwcGVkIGNvbHVtbnMuCiAgICAgKgogICAgICogQHBhcmFt\nIGZvcmNlSkRCQ1R5cGUgd2hldGhlciB0byBmb3JjZSB0aGUgamRiYy10eXBl\nIG9mIHRoZSBjb2x1bW5zCiAgICAgKiB0byBiZSBzZXQsIGV2ZW4gd2hlbiBp\ndCBtYXRjaGVzIHRoZSBkZWZhdWx0IGZvciB0aGUgY29sdW1ucycgamF2YSB0\neXBlCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHN5bmNDb2x1bW5zKE1l\ndGFEYXRhQ29udGV4dCBjb250ZXh0LCBDb2x1bW5bXSBjb2xzLAogICAgICAg\nIGJvb2xlYW4gZm9yY2VKREJDVHlwZSkgewogICAgICAgIGlmIChjb2xzID09\nIG51bGwgfHwgY29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgX2NvbHMg\nPSBudWxsOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBfY29scyA9IG5l\ndyBBcnJheUxpc3QoY29scy5sZW5ndGgpOwogICAgICAgICAgICBDb2x1bW4g\nY29sOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbCA9IHN5bmNDb2x1bW4o\nY29udGV4dCwgY29sc1tpXSwgY29scy5sZW5ndGgsCiAgICAgICAgICAgICAg\nICAgICAgZm9yY2VKREJDVHlwZSwgY29sc1tpXS5nZXRUYWJsZSgpLCBudWxs\nLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzZXRDb2x1bW5GbGFn\nc0Zyb21JTyhjb2wsIGkpOwogICAgICAgICAgICAgICAgX2NvbHMuYWRkKGNv\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgSS9PIGZsYWdzIG9uIHRoZSBjb2x1bW4uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBzZXRDb2x1bW5GbGFnc0Zyb21JTyhDb2x1bW4gY29s\nLCBpbnQgaSkgewogICAgICAgIGlmIChfaW8gPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VO\nVVBEQVRBQkxFLCAhX2lvLmlzVXBkYXRhYmxlKGksIGZhbHNlKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFLCAhX2lv\nLmlzSW5zZXJ0YWJsZShpLCBmYWxzZSkpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0cyBpbnRlcm5hbCBpbmRleCBpbmZvcm1hdGlvbiB0byBtYXRjaCBn\naXZlbiBtYXBwZWQgaW5kZXguCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHN5bmNJbmRleChNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgSW5kZXggaWR4\nKSB7CiAgICAgICAgaWYgKGlkeCA9PSBudWxsKSB7CiAgICAgICAgICAgIF9p\nZHggPSBudWxsOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBfY2FuSWR4ID0gdHJ1ZTsKICAgICAgICBfaWR4ID0gbmV3IEluZGV4\nKCk7CiAgICAgICAgX2lkeC5zZXROYW1lKGlkeC5nZXROYW1lKCkpOwogICAg\nICAgIF9pZHguc2V0VW5pcXVlKGlkeC5pc1VuaXF1ZSgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldHMgaW50ZXJuYWwgY29uc3RyYWludCBpbmZvcm1h\ndGlvbiB0byBtYXRjaCBnaXZlbiBtYXBwZWQgY29uc3RyYWludC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgc3luY1VuaXF1ZShNZXRhRGF0YUNvbnRl\neHQgY29udGV4dCwgVW5pcXVlIHVucSkgewogICAgICAgIGlmICh1bnEgPT0g\nbnVsbCkgewogICAgICAgICAgICBfdW5xID0gbnVsbDsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX2NhblVucSA9IHRydWU7CiAg\nICAgICAgX3VucSA9IG5ldyBVbmlxdWUoKTsKICAgICAgICBfdW5xLnNldE5h\nbWUodW5xLmdldE5hbWUoKSk7CiAgICAgICAgX3VucS5zZXREZWZlcnJlZCh1\nbnEuaXNEZWZlcnJlZCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMg\naW50ZXJuYWwgY29uc3RyYWludCBhbmQgY29sdW1uIGluZm9ybWF0aW9uIHRv\nIG1hdGNoIGdpdmVuIG1hcHBlZAogICAgICogY29uc3RyYWludC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gbG9jYWwgZGVmYXVsdCBsb2NhbCB0YWJsZQogICAg\nICogQHBhcmFtIHRhcmdldCBkZWZhdWx0IHRhcmdldCB0YWJsZQogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBzeW5jRm9yZWlnbktleShNZXRhRGF0YUNv\nbnRleHQgY29udGV4dCwgRm9yZWlnbktleSBmaywKICAgICAgICBUYWJsZSBs\nb2NhbCwgVGFibGUgdGFyZ2V0KSB7CiAgICAgICAgaWYgKGZrID09IG51bGwp\nIHsKICAgICAgICAgICAgX2ZrID0gbnVsbDsKICAgICAgICAgICAgX2NvbHMg\nPSBudWxsOwogICAgICAgICAgICBfam9pbiA9IEpPSU5fTk9ORTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoX2pvaW4gPT0g\nSk9JTl9OT05FKQogICAgICAgICAgICBfam9pbiA9IEpPSU5fRk9SV0FSRDsK\nCiAgICAgICAgaWYgKGZrLmlzTG9naWNhbCgpKQogICAgICAgICAgICBfZmsg\nPSBudWxsOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBfY2FuRksgPSB0\ncnVlOwogICAgICAgICAgICBfZmsgPSBuZXcgRm9yZWlnbktleSgpOwogICAg\nICAgICAgICBfZmsuc2V0TmFtZShmay5nZXROYW1lKCkpOwogICAgICAgICAg\nICBfZmsuc2V0RGVsZXRlQWN0aW9uKGZrLmdldERlbGV0ZUFjdGlvbigpKTsK\nICAgICAgICAgICAgX2ZrLnNldFVwZGF0ZUFjdGlvbihmay5nZXRVcGRhdGVB\nY3Rpb24oKSk7CiAgICAgICAgICAgIF9may5zZXREZWZlcnJlZChmay5pc0Rl\nZmVycmVkKCkpOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9\nIGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBwa0NvbHMgPSBm\nay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIGNj\nb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAgICAgT2JqZWN0\nW10gY3MgPSBmay5nZXRDb25zdGFudHMoKTsKICAgICAgICBDb2x1bW5bXSBj\ncGtDb2xzID0gZmsuZ2V0Q29uc3RhbnRQcmltYXJ5S2V5Q29sdW1ucygpOwog\nICAgICAgIE9iamVjdFtdIGNwa3MgPSBmay5nZXRQcmltYXJ5S2V5Q29uc3Rh\nbnRzKCk7CgogICAgICAgIGludCBzaXplID0gY29scy5sZW5ndGggKyBjY29s\ncy5sZW5ndGggKyBjcGtDb2xzLmxlbmd0aDsKICAgICAgICBfY29scyA9IG5l\ndyBBcnJheUxpc3Qoc2l6ZSk7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgY29sID0gc3luY0NvbHVtbihjb250ZXh0LCBjb2xzW2ldLCBz\naXplLCBmYWxzZSwgbG9jYWwsCiAgICAgICAgICAgICAgICB0YXJnZXQsIHBr\nQ29sc1tpXSwgX2pvaW4gPT0gSk9JTl9JTlZFUlNFKTsKICAgICAgICAgICAg\nc2V0Q29sdW1uRmxhZ3NGcm9tSU8oY29sLCBpKTsKICAgICAgICAgICAgX2Nv\nbHMuYWRkKGNvbCk7CiAgICAgICAgfQogICAgICAgIE9iamVjdCBjb25zdGFu\ndDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNjb2xzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGNvbnN0YW50ID0gKGNzW2ldID09IG51bGwp\nID8gTlVMTCA6IGNzW2ldOwogICAgICAgICAgICBjb2wgPSBzeW5jQ29sdW1u\nKGNvbnRleHQsIGNjb2xzW2ldLCBzaXplLCBmYWxzZSwgbG9jYWwsCiAgICAg\nICAgICAgICAgICB0YXJnZXQsIGNvbnN0YW50LCBfam9pbiA9PSBKT0lOX0lO\nVkVSU0UpOwogICAgICAgICAgICBzZXRDb2x1bW5GbGFnc0Zyb21JTyhjb2ws\nIGNvbHMubGVuZ3RoICsgaSk7CiAgICAgICAgICAgIF9jb2xzLmFkZChjb2wp\nOwogICAgICAgIH0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNwa0Nv\nbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3RhbnQgPSAoY3Br\nc1tpXSA9PSBudWxsKSA/IE5VTEwgOiBjcGtzW2ldOwogICAgICAgICAgICBf\nY29scy5hZGQoc3luY0NvbHVtbihjb250ZXh0LCBjcGtDb2xzW2ldLCBzaXpl\nLCBmYWxzZSwgdGFyZ2V0LAogICAgICAgICAgICAgICAgbG9jYWwsIGNvbnN0\nYW50LCBfam9pbiAhPSBKT0lOX0lOVkVSU0UpKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBnaXZlbiBj\nb2x1bW4gd2l0aCB0aGUgcmF3IG1hcHBpbmcgaW5mb3JtYXRpb24KICAgICAq\nIHNldCBjb3JyZWN0bHksIGFuZCB3aXRob3V0IHNldHRpbmdzIHRoYXQgbWF0\nY2ggZGVmYXVsdHMuCiAgICAgKgogICAgICogQHBhcmFtIG51bSB0aGUgbnVt\nYmVyIG9mIGNvbHVtbnMgZm9yIHRoaXMgbWFwcGluZwogICAgICogQHBhcmFt\nIGZvcmNlSkRCQ1R5cGUgd2hldGhlciB0aGUgamRiYy10eXBlIG9mIHRoZSBj\ncmVhdGVkIGNvbHVtbgogICAgICogc2hvdWxkIGJlIHNldCwgZXZlbiBpZiBp\ndCBtYXRjaGVzIHRoZSBkZWZhdWx0CiAgICAgKiBmb3IgdGhlIGdpdmVuIGNv\nbHVtbidzIGphdmEgdHlwZQogICAgICogQHBhcmFtIGNvbFRhYmxlIGV4cGVj\ndGVkIHRhYmxlIGZvciB0aGUgY29sdW1uCiAgICAgKiBAcGFyYW0gdGFyZ2V0\nVGFibGUgZXhwZWN0ZWQgdGFyZ2V0IHRhYmxlIGZvciBqb2luIGNvbHVtbgog\nICAgICogQHBhcmFtIHRhcmdldCB0YXJnZXQgY29sdW1uIG9yIG9iamVjdCBm\nb3Igam9pbiBjb2x1bW47IGZvciBhCiAgICAgKiBjb25zdGFudCBudWxsIHRh\ncmdldCwgdXNlIHtAbGluayAjTlVMTH0KICAgICAqIEBwYXJhbSBpbnZlcnNl\nIHdoZXRoZXIgam9pbiBjb2x1bW4gaXMgZm9yIGludmVyc2Ugam9pbgogICAg\nICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIENvbHVtbiBzeW5jQ29sdW1uKE1l\ndGFEYXRhQ29udGV4dCBjb250ZXh0LCBDb2x1bW4gY29sLAogICAgICAgIGlu\ndCBudW0sIGJvb2xlYW4gZm9yY2VKREJDVHlwZSwgVGFibGUgY29sVGFibGUs\nIFRhYmxlIHRhcmdldFRhYmxlLAogICAgICAgIE9iamVjdCB0YXJnZXQsIGJv\nb2xlYW4gaW52ZXJzZSkgewogICAgICAgIC8vIHVzZSBmdWxsIG5hbWUgZm9y\nIGNvbHMgdGhhdCBhcmVuJ3QgaW4gdGhlIGV4cGVjdGVkIHRhYmxlLCBvciB0\naGF0CiAgICAgICAgLy8gYXJlIGludmVyc2Ugam9pbnMKICAgICAgICBEQkRp\nY3Rpb25hcnkgZGljdCA9ICgoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQu\nZ2V0UmVwb3NpdG9yeSgpKS4KICAgICAgICAgICAgZ2V0REJEaWN0aW9uYXJ5\nKCk7CiAgICAgICAgQ29sdW1uIGNvcHkgPSBuZXcgQ29sdW1uKCk7CiAgICAg\nICAgaWYgKGNvbC5nZXRUYWJsZSgpICE9IGNvbFRhYmxlIHx8IGludmVyc2Up\nCiAgICAgICAgICAgIGNvcHkuc2V0TmFtZShkaWN0LmdldEZ1bGxOYW1lKGNv\nbC5nZXRUYWJsZSgpLCB0cnVlKQogICAgICAgICAgICAgICAgKyAiLiIgKyBj\nb2wuZ2V0TmFtZSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvcHku\nc2V0TmFtZShjb2wuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8gc2V0IHRhcmdl\ndCBpZiBub3QgZGVmYXVsdAogICAgICAgIGlmICh0YXJnZXQgIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAodGFyZ2V0ID09IE5VTEwpCiAgICAgICAgICAg\nICAgICBjb3B5LnNldFRhcmdldCgibnVsbCIpOwogICAgICAgICAgICBlbHNl\nIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBDb2x1bW4pIHsKICAgICAgICAgICAg\nICAgIENvbHVtbiB0Y29sID0gKENvbHVtbikgdGFyZ2V0OwogICAgICAgICAg\nICAgICAgaWYgKCghaW52ZXJzZSAmJiB0Y29sLmdldFRhYmxlKCkgIT0gdGFy\nZ2V0VGFibGUpCiAgICAgICAgICAgICAgICAgICAgfHwgKGludmVyc2UgJiYg\ndGNvbC5nZXRUYWJsZSgpICE9IGNvbFRhYmxlKSkKICAgICAgICAgICAgICAg\nICAgICBjb3B5LnNldFRhcmdldChkaWN0LmdldEZ1bGxOYW1lKHRjb2wuZ2V0\nVGFibGUoKSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgKyAiLiIg\nKyB0Y29sLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICgh\nZGVmYXVsdFRhcmdldChjb2wsIHRjb2wsIG51bSkpCiAgICAgICAgICAgICAg\nICAgICAgY29weS5zZXRUYXJnZXQodGNvbC5nZXROYW1lKCkpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIE51bWJlcikKICAg\nICAgICAgICAgICAgIGNvcHkuc2V0VGFyZ2V0KHRhcmdldC50b1N0cmluZygp\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgY29weS5zZXRU\nYXJnZXQoIiciICsgdGFyZ2V0ICsgIiciKTsKICAgICAgICB9IGVsc2UgaWYg\nKG51bSA+IDEpCiAgICAgICAgICAgIGNvcHkuc2V0VGFyZ2V0RmllbGQoY29s\nLmdldFRhcmdldEZpZWxkKCkpOwoKICAgICAgICBpZiAoY29sLmdldFNpemUo\nKSAhPSAwICYmIGNvbC5nZXRTaXplKCkgIT0gZGljdC5jaGFyYWN0ZXJDb2x1\nbW5TaXplCiAgICAgICAgICAgICYmIChjb2wuZ2V0U2l6ZSgpICE9IC0xIHx8\nICFjb2wuaXNMb2IoKSkpCiAgICAgICAgICAgIGNvcHkuc2V0U2l6ZShjb2wu\nZ2V0U2l6ZSgpKTsKICAgICAgICBpZiAoY29sLmdldERlY2ltYWxEaWdpdHMo\nKSAhPSAwKQogICAgICAgICAgICBjb3B5LnNldERlY2ltYWxEaWdpdHMoY29s\nLmdldERlY2ltYWxEaWdpdHMoKSk7CiAgICAgICAgaWYgKGNvbC5nZXREZWZh\ndWx0U3RyaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgY29weS5zZXREZWZh\ndWx0U3RyaW5nKGNvbC5nZXREZWZhdWx0U3RyaW5nKCkpOwogICAgICAgIGlm\nIChjb2wuaXNOb3ROdWxsKCkgJiYgIWNvbC5pc1ByaW1hcnlLZXkoKQogICAg\nICAgICAgICAmJiAoIWlzUHJpbWl0aXZlKGNvbC5nZXRKYXZhVHlwZSgpKSB8\nfCBpc0ZvcmVpZ25LZXkoY29sKSkpCiAgICAgICAgICAgIGNvcHkuc2V0Tm90\nTnVsbCh0cnVlKTsKCiAgICAgICAgLy8gc2V0IHR5cGUgbmFtZSBpZiBub3Qg\nZGVmYXVsdAogICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IGNvbC5nZXRUeXBl\nTmFtZSgpOwogICAgICAgIGlmICh0eXBlTmFtZSAhPSBudWxsIHx8IGNvcHku\nZ2V0U2l6ZSgpICE9IDAKICAgICAgICAgICAgfHwgY29weS5nZXREZWNpbWFs\nRGlnaXRzKCkgIT0gMCkgewogICAgICAgICAgICAvLyBpcyB0aGlzIHRoZSBk\naWN0IGRlZmF1bHQgdHlwZT8gaGF2ZSB0byBlbnN1cmUgamRiYy10eXBlIHNl\ndAogICAgICAgICAgICAvLyBwcmlvciB0byBmaW5kaW5nIGRpY3QgZGVmYXVs\ndAogICAgICAgICAgICBjb3B5LnNldFR5cGUoY29sLmdldFR5cGUoKSk7CiAg\nICAgICAgICAgIFN0cmluZyBkZWZOYW1lID0gZGljdC5nZXRUeXBlTmFtZShj\nb3B5KTsKICAgICAgICAgICAgY29weS5zZXRUeXBlKFR5cGVzLk9USEVSKTsK\nCiAgICAgICAgICAgIC8vIGNvcHkgc2hvdWxkIG5vdCBoYXZlIHNpemUgaW5m\nbyBzZXQgaWYgaXQgaXNuJ3QgdXNlZCBpbiB0eXBlIG5hbWUKICAgICAgICAg\nICAgYm9vbGVhbiBkZWZTaXplZCA9IGRlZk5hbWUuaW5kZXhPZignKCcpICE9\nIC0xOwogICAgICAgICAgICBpZiAoIWRlZlNpemVkKSB7CiAgICAgICAgICAg\nICAgICBpZiAoY29weS5nZXRTaXplKCkgPiAwKQogICAgICAgICAgICAgICAg\nICAgIGNvcHkuc2V0U2l6ZSgwKTsKICAgICAgICAgICAgICAgIGNvcHkuc2V0\nRGVjaW1hbERpZ2l0cygwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKHR5cGVOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSB0byBzdHJpcCBzaXplIGZvciBjb21wYXJpc29uCiAgICAgICAg\nICAgICAgICBpZiAodHlwZU5hbWUuaW5kZXhPZignKCcpID09IC0xICYmIGRl\nZlNpemVkKQogICAgICAgICAgICAgICAgICAgIGRlZk5hbWUgPSBkZWZOYW1l\nLnN1YnN0cmluZygwLCBkZWZOYW1lLmluZGV4T2YoJygnKSk7CiAgICAgICAg\nICAgICAgICBpZiAoIXR5cGVOYW1lLmVxdWFsc0lnbm9yZUNhc2UoZGVmTmFt\nZSkpCiAgICAgICAgICAgICAgICAgICAgY29weS5zZXRUeXBlTmFtZSh0eXBl\nTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHNl\ndCBqZGJjLXR5cGUgaWYgbm90IGRlZmF1bHQgb3IgaWYgZm9yY2VkCiAgICAg\nICAgaWYgKGZvcmNlSkRCQ1R5cGUKICAgICAgICAgICAgfHwgKHRhcmdldCAh\nPSBudWxsICYmICEodGFyZ2V0IGluc3RhbmNlb2YgQ29sdW1uKQogICAgICAg\nICAgICAmJiBjb2wuZ2V0VHlwZSgpICE9IFR5cGVzLlZBUkNIQVIpCiAgICAg\nICAgICAgIHx8IGRpY3QuZ2V0SkRCQ1R5cGUoY29sLmdldEphdmFUeXBlKCks\nIGZhbHNlKSAhPSBjb2wuZ2V0VHlwZSgpKQogICAgICAgICAgICBjb3B5LnNl\ndFR5cGUoY29sLmdldFR5cGUoKSk7CgogICAgICAgIHJldHVybiBjb3B5Owog\nICAgfQoKICAgIC8qKiAKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZl\nbiBjb2x1bW4gYmVsb25ncyB0byBhIGZvcmVpZ24ga2V5LgogICAgICovIAog\nICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0ZvcmVpZ25LZXkoQ29sdW1u\nIGNvbCkgCiAgICB7ICAgICAgIAogICAgICAgIGlmIChjb2wuZ2V0VGFibGUo\nKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nRm9yZWlnbktleVtdIGZrcyA9IGNvbC5nZXRUYWJsZSgpLmdldEZvcmVpZ25L\nZXlzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBma3MubGVuZ3Ro\nOyBpKyspIAogICAgICAgICAgICBpZiAoZmtzW2ldLmNvbnRhaW5zQ29sdW1u\nKGNvbCkgCiAgICAgICAgICAgICAgICB8fCBma3NbaV0uY29udGFpbnNDb25z\ndGFudENvbHVtbihjb2wpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHR5cGUgY29kZSByZXByZXNlbnRz\nIGEgcHJpbWl0aXZlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29s\nZWFuIGlzUHJpbWl0aXZlKGludCB0eXBlKSB7CiAgICAgICAgc3dpdGNoICh0\neXBlKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGUgZ2l2ZW4gdGFyZ2V0IGNvbHVtbiBtYXRjaGVzIHRoZSBkZWZhdWx0Lgog\nICAgICogSWYgdGhlcmUgaXMgb25seSBvbmUgY29sdW1uIGludm9sdmVkIGlu\nIHRoZSBqb2luIGFuZCBpdCBsaW5rcyB0byB0aGUKICAgICAqIHNpbmdsZSB0\nYXJnZXQgdGFibGUgcGsgY29sdW1uLCBvciBpZiB0aGUgY29sdW1uIG5hbWUg\naXMgdGhlIHNhbWUgYXMKICAgICAqIHRoZSB0YXJnZXQgY29sdW1uIG5hbWUs\nIHRoZW4gdGhlIHRhcmdldCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBkZWZhdWx0VGFyZ2V0KENvbHVtbiBj\nb2wsIENvbHVtbiB0YXJnZXRDb2wsCiAgICAgICAgaW50IG51bSkgewogICAg\nICAgIGlmIChjb2wuZ2V0TmFtZSgpLmVxdWFscyh0YXJnZXRDb2wuZ2V0TmFt\nZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKG51\nbSA+IDEpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgUHJp\nbWFyeUtleSBwayA9IHRhcmdldENvbC5nZXRUYWJsZSgpLmdldFByaW1hcnlL\nZXkoKTsKICAgICAgICBpZiAocGsgPT0gbnVsbCB8fCBway5nZXRDb2x1bW5z\nKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICByZXR1cm4gdGFyZ2V0Q29sID09IHBrLmdldENvbHVtbnMoKVswXTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFN1cHBsaWVzIGRlZmF1bHQgdGFibGUg\naW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50ZXJm\nYWNlIFRhYmxlRGVmYXVsdHMgewoKICAgICAgICAvKioKICAgICAgICAgKiBS\nZXR1cm4gdGhlIGRlZmF1bHQgdGFibGUgbmFtZS4KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgU3RyaW5nIGdldChTY2hlbWEgc2NoZW1hKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFN1cHBsaWVzIGRlZmF1bHQgZm9yZWlnbiBrZXkg\naW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50ZXJm\nYWNlIEZvcmVpZ25LZXlEZWZhdWx0cyB7CgogICAgICAgIC8qKgogICAgICAg\nICAqIFJldHVybiBhIGRlZmF1bHQgZm9yZWlnbiBrZXkgZm9yIHRoZSBnaXZl\nbiB0YWJsZXMsIG9yIG51bGwgdG8KICAgICAgICAgKiBjcmVhdGUgYSBsb2dp\nY2FsIGZvcmVpZ24ga2V5IG9ubHkuIERvIG5vdCBmaWxsIGluIHRoZSBjb2x1\nbW5zIG9mCiAgICAgICAgICogdGhlIGZvcmVpZ24ga2V5LCBvbmx5IGF0dHJp\nYnV0ZXMgbGlrZSBpdHMgbmFtZSwgZGVsZXRlIGFjdGlvbiwgZXRjLgogICAg\nICAgICAqIERvIG5vdCBhZGQgdGhlIGZvcmVpZ24ga2V5IHRvIHRoZSB0YWJs\nZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgRm9yZWlnbktleSBnZXQo\nVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIGJvb2xlYW4gaW52ZXJzZSk7\nCgogICAgICAgIC8qKgogICAgICAgICAqIFBvcHVsYXRlIHRoZSBnaXZlbiBm\nb3JlaWduIGtleSBjb2x1bW4gd2l0aCBkZWZhdWx0cy4KICAgICAgICAgKgog\nICAgICAgICAqIEBwYXJhbSB0YXJnZXQgdGhlIHRhcmdldCBjb2x1bW4gb3Ig\nY29uc3RhbnQgdmFsdWUKICAgICAgICAgKiBAcGFyYW0gcG9zIHRoZSBpbmRl\neCBvZiB0aGlzIGNvbHVtbiBpbiB0aGUgZm9yZWlnbiBrZXkKICAgICAgICAg\nKiBAcGFyYW0gY29scyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIGZv\ncmVpZ24ga2V5CiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgcG9w\ndWxhdGUoVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIENvbHVtbiBjb2ws\nCiAgICAgICAgICAgIE9iamVjdCB0YXJnZXQsIGJvb2xlYW4gaW52ZXJzZSwg\naW50IHBvcywgaW50IGNvbHMpOwoJfQp9Cg==\n","encoding":"base64"}

