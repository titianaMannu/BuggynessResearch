{"sha":"d149c94fe52ca238ea181c92492338ae1023ffe7","node_id":"MDQ6QmxvYjIwNjM2NDpkMTQ5Yzk0ZmU1MmNhMjM4ZWExODFjOTI0OTIzMzhhZTEwMjNmZmU3","size":4723,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d149c94fe52ca238ea181c92492338ae1023ffe7","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwoKLyoqCiAqIEF0dGVtcHRzIHRv\nIGluc3RhbGwgdXNpbmcgdGhlIGdpdmVuIG1hcHBpbmcgaW5mb3JtYXRpb24u\nIElmIHRoYXQKICogZmFpbHMsIGNsZWFycyB0aGUgbWFwcGluZyBpbmZvcm1h\ndGlvbiBhbmQgY29uc3RydWN0cyBuZXcgbWFwcGluZ3MuCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICogQHNpbmNlIDAuNC4wCiAq\nLwpwdWJsaWMgY2xhc3MgUmVmcmVzaFN0cmF0ZWd5SW5zdGFsbGVyCiAgICBl\neHRlbmRzIFN0cmF0ZWd5SW5zdGFsbGVyIHsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nCiAgICAgICAgKFJlZnJlc2hTdHJhdGVneUluc3RhbGxlci5jbGFzcyk7Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvcjsgc3VwcGx5IGNvbmZpZ3VyYXRp\nb24uCiAgICAgKi8KICAgIHB1YmxpYyBSZWZyZXNoU3RyYXRlZ3lJbnN0YWxs\nZXIoTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBzdXBlcihy\nZXBvcyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNBZGFwdGluZygp\nIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBpbnN0YWxsU3RyYXRlZ3koQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAg\nIENsYXNzU3RyYXRlZ3kgc3RyYXQgPSByZXBvcy5uYW1lZFN0cmF0ZWd5KGNs\ncyk7CiAgICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgIHN0\ncmF0ID0gcmVwb3MuZGVmYXVsdFN0cmF0ZWd5KGNscywgdHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgY2xzLnNldFN0cmF0ZWd5KHN0cmF0LCBC\nb29sZWFuLlRSVUUpOwogICAgICAgIH0gY2F0Y2ggKE1ldGFEYXRhRXhjZXB0\naW9uIG1kZSkgewogICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgY3VzdG9t\nIHN0cmF0ZWd5LCBkb24ndCBhdHRlbXB0IHRvIG92ZXJyaWRlCiAgICAgICAg\nICAgIGlmIChpc0N1c3RvbVN0cmF0ZWd5KHN0cmF0KSkKICAgICAgICAgICAg\nICAgIHRocm93IG1kZTsKCiAgICAgICAgICAgIHJlcG9zLmdldExvZygpLndh\ncm4oX2xvYy5nZXQoImZhdGFsLWNoYW5nZSIsIGNscywKICAgICAgICAgICAg\nICAgIG1kZS5nZXRNZXNzYWdlKCkpKTsKICAgICAgICAgICAgY2xzLmNsZWFy\nTWFwcGluZygpOwogICAgICAgICAgICBjbHMuc2V0U3RyYXRlZ3kocmVwb3Mu\nZGVmYXVsdFN0cmF0ZWd5KGNscywgdHJ1ZSksIEJvb2xlYW4uVFJVRSk7CiAg\nICAgICAgfQogICAgICAgIGNscy5zZXRTb3VyY2VNb2RlKGNscy5NT0RFX01B\nUFBJTkcsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluc3RhbGxT\ndHJhdGVneShGaWVsZE1hcHBpbmcgZmllbGQpIHsKICAgICAgICBGaWVsZFN0\ncmF0ZWd5IHN0cmF0ZWd5ID0gcmVwb3MubmFtZWRTdHJhdGVneShmaWVsZCwg\ndHJ1ZSk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09IG51bGwpCiAgICAgICAg\nICAgIHN0cmF0ZWd5ID0gcmVwb3MuZGVmYXVsdFN0cmF0ZWd5KGZpZWxkLCB0\ncnVlLCB0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmaWVsZC5z\nZXRTdHJhdGVneShzdHJhdGVneSwgQm9vbGVhbi5UUlVFKTsKICAgICAgICB9\nIGNhdGNoIChNZXRhRGF0YUV4Y2VwdGlvbiBtZGUpIHsKICAgICAgICAgICAg\nLy8gaWYgdGhpcyBpcyBhIGN1c3RvbSBzdHJhdGVneSwgZG9uJ3Qgb3ZlcnJp\nZGUKICAgICAgICAgICAgaWYgKGlzQ3VzdG9tU3RyYXRlZ3koc3RyYXRlZ3kp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbWRlOwoKICAgICAgICAgICAgcmVw\nb3MuZ2V0TG9nKCkud2FybihfbG9jLmdldCgiZmF0YWwtY2hhbmdlIiwgZmll\nbGQsCiAgICAgICAgICAgICAgICBtZGUuZ2V0TWVzc2FnZSgpKSk7CiAgICAg\nICAgICAgIGZpZWxkLmNsZWFyTWFwcGluZygpOwogICAgICAgICAgICBmaWVs\nZC5zZXRIYW5kbGVyKG51bGwpOwogICAgICAgICAgICBmaWVsZC5nZXRLZXlN\nYXBwaW5nKCkuc2V0SGFuZGxlcihudWxsKTsKICAgICAgICAgICAgZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKS5zZXRIYW5kbGVyKG51bGwpOwogICAgICAg\nICAgICBmaWVsZC5zZXRTdHJhdGVneShyZXBvcy5kZWZhdWx0U3RyYXRlZ3ko\nZmllbGQsIHRydWUsIHRydWUpLAogICAgICAgICAgICAgICAgQm9vbGVhbi5U\nUlVFKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5zdGFs\nbFN0cmF0ZWd5KFZlcnNpb24gdmVyc2lvbikgewogICAgICAgIFZlcnNpb25T\ndHJhdGVneSBzdHJhdCA9IHJlcG9zLm5hbWVkU3RyYXRlZ3kodmVyc2lvbik7\nCiAgICAgICAgaWYgKHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgIHN0cmF0\nID0gcmVwb3MuZGVmYXVsdFN0cmF0ZWd5KHZlcnNpb24sIHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHZlcnNpb24uc2V0U3RyYXRlZ3koc3Ry\nYXQsIEJvb2xlYW4uVFJVRSk7CiAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFF\neGNlcHRpb24gbWRlKSB7CiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBj\ndXN0b20gc3RyYXRlZ3ksIGRvbid0IGF0dGVtcHQgdG8gb3ZlcnJpZGUKICAg\nICAgICAgICAgaWYgKGlzQ3VzdG9tU3RyYXRlZ3koc3RyYXQpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbWRlOwoKICAgICAgICAgICAgcmVwb3MuZ2V0TG9n\nKCkud2FybihfbG9jLmdldCgiZmF0YWwtY2hhbmdlIiwgdmVyc2lvbiwKICAg\nICAgICAgICAgICAgIG1kZS5nZXRNZXNzYWdlKCkpKTsKICAgICAgICAgICAg\ndmVyc2lvbi5jbGVhck1hcHBpbmcoKTsKICAgICAgICAgICAgdmVyc2lvbi5z\nZXRTdHJhdGVneShyZXBvcy5kZWZhdWx0U3RyYXRlZ3kodmVyc2lvbiwgdHJ1\nZSksCiAgICAgICAgICAgICAgICBCb29sZWFuLlRSVUUpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbnN0YWxsU3RyYXRlZ3koRGlzY3Jp\nbWluYXRvciBkaXNjcmltKSB7CiAgICAgICAgRGlzY3JpbWluYXRvclN0cmF0\nZWd5IHN0cmF0ID0gcmVwb3MubmFtZWRTdHJhdGVneShkaXNjcmltKTsKICAg\nICAgICBpZiAoc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgc3RyYXQgPSBy\nZXBvcy5kZWZhdWx0U3RyYXRlZ3koZGlzY3JpbSwgdHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZGlzY3JpbS5zZXRTdHJhdGVneShzdHJhdCwg\nQm9vbGVhbi5UUlVFKTsKICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4Y2Vw\ndGlvbiBtZGUpIHsKICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGN1c3Rv\nbSBzdHJhdGVneSwgZG9uJ3QgYXR0ZW1wdCB0byBvdmVycmlkZQogICAgICAg\nICAgICBpZiAoaXNDdXN0b21TdHJhdGVneShzdHJhdCkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBtZGU7CgogICAgICAgICAgICByZXBvcy5nZXRMb2coKS53\nYXJuKF9sb2MuZ2V0KCJmYXRhbC1jaGFuZ2UiLCBkaXNjcmltLAogICAgICAg\nICAgICAgICAgbWRlLmdldE1lc3NhZ2UoKSkpOwoKICAgICAgICAgICAgLy8g\ncmV0YWluIG9sZCBkaXNjcmltaW5hdG9yIHZlcnNpb24sIGlmIGFueQogICAg\nICAgICAgICBTdHJpbmcgdmFsID0gZGlzY3JpbS5nZXRNYXBwaW5nSW5mbygp\nLmdldFZhbHVlKCk7CiAgICAgICAgICAgIGRpc2NyaW0uY2xlYXJNYXBwaW5n\nKCk7CiAgICAgICAgICAgIGRpc2NyaW0uZ2V0TWFwcGluZ0luZm8oKS5zZXRW\nYWx1ZSh2YWwpOwogICAgICAgICAgICBkaXNjcmltLnNldFN0cmF0ZWd5KHJl\ncG9zLmRlZmF1bHRTdHJhdGVneShkaXNjcmltLCB0cnVlKSwKICAgICAgICAg\nICAgICAgIEJvb2xlYW4uVFJVRSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHN0cmF0ZWd5IGlz\nIG5vdCBhIGJ1aWx0LWluIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGJvb2xlYW4gaXNDdXN0b21TdHJhdGVneShTdHJhdGVneSBzdHJhdCkg\newogICAgICAgIHJldHVybiAhc3RyYXQuZ2V0Q2xhc3MoKS5nZXROYW1lKCku\nc3RhcnRzV2l0aCgib3JnLmFwYWNoZS5vcGVuanBhLiIpOwogICAgfQp9Cg==\n","encoding":"base64"}

