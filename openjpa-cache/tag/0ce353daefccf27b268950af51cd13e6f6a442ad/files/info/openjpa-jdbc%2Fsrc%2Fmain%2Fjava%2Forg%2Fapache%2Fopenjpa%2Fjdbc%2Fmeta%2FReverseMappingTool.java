{"sha":"2581d1be631b777110ccfbc3983c3c11f2454f99","node_id":"MDQ6QmxvYjIwNjM2NDoyNTgxZDFiZTYzMWI3NzcxMTBjY2ZiYzM5ODNjM2MxMWYyNDU0Zjk5","size":73921,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2581d1be631b777110ccfbc3983c3c11f2454f99","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgamF2YS5pby5CdWZmZXJlZFJl\nYWRlcjsKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmls\nZUlucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklucHV0\nU3RyZWFtUmVhZGVyOwppbXBvcnQgamF2YS5pby5TdHJpbmdXcml0ZXI7Cmlt\ncG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5U\neXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5Qcm9wZXJ0aWVzOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1w\nb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZW5oYW5jZS5BcHBsaWNhdGlvbklkVG9vbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkNvZGVHZW5lcmF0b3I7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5GdWxsQ2xhc3NTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkhhbmRsZXJG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuTWF4RW1iZWRkZWRCbG9iRmllbGRTdHJhdGVneTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLk1heEVt\nYmVkZGVkQ2xvYkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5Ob25lRGlzY3JpbWluYXRvclN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuUHJpbWl0aXZlRmllbGRTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlJlbGF0aW9uQ29sbGVjdGlvbklu\ndmVyc2VLZXlGaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMubWV0YS5zdHJhdHMuUmVsYXRpb25Db2xsZWN0aW9uVGFibGVG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nbWV0YS5zdHJhdHMuUmVsYXRpb25GaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuU3RhdGVDb21wYXJp\nc29uVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5zdHJhdHMuU3RyaW5nRmllbGRTdHJhdGVneTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1YmNsYXNz\nSm9pbkRpc2NyaW1pbmF0b3JTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLlN1cGVyY2xhc3NEaXNjcmltaW5h\ndG9yU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLnN0cmF0cy5TdXBlcmNsYXNzVmVyc2lvblN0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVmVydGljYWxD\nbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdlbmVyYXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFQYXJz\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2No\nZW1hczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5U\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5V\nbmlxdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nWE1MU2NoZW1hUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuQ29kZUZvcm1hdDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5GaWxlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuTWV0YURhdGFGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFNb2RlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLk5vbmVNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7CmltcG9ydCBzZXJwLmJ5\ndGVjb2RlLkJDQ2xhc3NMb2FkZXI7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlBy\nb2plY3Q7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBSZXZl\ncnNlLW1hcHMgYSBzY2hlbWEgaW50byBjbGFzcyBtYXBwaW5ncyBhbmQgdGhl\nIGFzc2ljaWF0ZWQgamF2YQogKiBjb2RlLiBHZW5lcmF0ZXMgYSBKYXZhIGNv\nZGUgZmlsZXMgZm9yIHBlcnNpc3RlbnQgY2xhc3NlcyBhbmQgYXNzb2NpYXRl\nZAogKiBpZGVudGl0eSBjbGFzc2VzIGFuZCBtZXRhZGF0YS4KICoKICogQGF1\ndGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBSZXZlcnNlTWFwcGlu\nZ1Rvb2wKICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcywgQ2xvbmVhYmxl\nIHsKCiAgICAvKioKICAgICAqIFVubWFwcGVkIHRhYmxlLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUQUJMRV9OT05FID0gMDsKCiAg\nICAvKioKICAgICAqIFByaW1hcnkgdGFibGUgZm9yIGEgbmV3IGJhc2UgY2xh\nc3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRBQkxF\nX0JBU0UgPSAxOwoKICAgIC8qKgogICAgICogU2Vjb25kYXJ5IHRhYmxlIG9m\nIGFuIGV4aXN0aW5nIGNsYXNzLiBUaGVyZSBpcyBleGFjdGx5IG9uZSByb3cg\naW4KICAgICAqIHRoaXMgdGFibGUgZm9yIGVhY2ggcm93IGluIHRoZSBwcmlt\nYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu\ndCBUQUJMRV9TRUNPTkRBUlkgPSAyOwoKICAgIC8qKgogICAgICogU2Vjb25k\nYXJ5IHRhYmxlIG9mIGFuIGV4aXN0aW5nIGNsYXNzLiBUaGVyZSBpcyB6ZXJv\nIG9yIG9uZSByb3cgaW4KICAgICAqIHRoaXMgdGFibGUgZm9yIGVhY2ggcm93\nIGluIHRoZSBwcmltYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBUQUJMRV9TRUNPTkRBUllfT1VURVIgPSAzOwoKICAg\nIC8qKgogICAgICogQXNzb2NpYXRpb24gdGFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IFRBQkxFX0FTU09DSUFUSU9OID0gNDsK\nCiAgICAvKioKICAgICAqIFN1YmNsYXNzIHRhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBUQUJMRV9TVUJDTEFTUyA9IDU7Cgog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgTEVWRUxfUEFDS0FHRSA9\nICJwYWNrYWdlIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIExF\nVkVMX0NMQVNTID0gImNsYXNzIjsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFJl\ndmVyc2VNYXBwaW5nVG9vbC5jbGFzcyk7CgogICAgLy8gbWFwIGphdmEga2V5\nd29yZHMgdG8gcmVsYXRlZCB3b3JkcyB0byB1c2UgaW4gdGhlaXIgcGxhY2UK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1hcCBfamF2YUtleXdvcmRzID0g\nbmV3IEhhc2hNYXAoKTsKCiAgICBzdGF0aWMgewogICAgICAgIElucHV0U3Ry\nZWFtIGluID0gUmV2ZXJzZU1hcHBpbmdUb29sLmNsYXNzLmdldFJlc291cmNl\nQXNTdHJlYW0KICAgICAgICAgICAgKCJqYXZhLWtleXdvcmRzLnJzcmMiKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmdbXSBrZXl3b3JkcyA9\nIFN0cmluZ3Muc3BsaXQobmV3IEJ1ZmZlcmVkUmVhZGVyCiAgICAgICAgICAg\nICAgICAobmV3IElucHV0U3RyZWFtUmVhZGVyKGluKSkucmVhZExpbmUoKSwg\nIiwiLCAwKTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwga2V5\nd29yZHMubGVuZ3RoOyBpICs9IDIpCiAgICAgICAgICAgICAgICBfamF2YUtl\neXdvcmRzLnB1dChrZXl3b3Jkc1tpXSwga2V5d29yZHNbaSArIDFdKTsKICAg\nICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlu\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIGZpbmFsIEpEQkNDb25maWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBm\naW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgTWFwIF90YWJsZXMg\nPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBmaW5hbCBQcm9qZWN0IF9w\ncm9qZWN0ID0gbmV3IFByb2plY3QoKTsKICAgIHByaXZhdGUgZmluYWwgQkND\nbGFzc0xvYWRlciBfbG9hZGVyID0gbmV3IEJDQ2xhc3NMb2FkZXIoX3Byb2pl\nY3QpOwogICAgcHJpdmF0ZSBTdHJhdGVneUluc3RhbGxlciBfc3RyYXQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3BhY2thZ2UgPSBudWxsOwogICAg\ncHJpdmF0ZSBGaWxlIF9kaXIgPSBudWxsOwogICAgcHJpdmF0ZSBNYXBwaW5n\nUmVwb3NpdG9yeSBfcmVwb3MgPSBudWxsOwogICAgcHJpdmF0ZSBTY2hlbWFH\ncm91cCBfc2NoZW1hID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfbnVs\nbEFzT2JqID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Jsb2JBc09i\naiA9IGZhbHNlOwogICAgcHJpdmF0ZSBQcm9wZXJ0aWVzIF90eXBlTWFwID0g\nbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfdXNlRksgPSBmYWxzZTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfdXNlU2NoZW1hID0gZmFsc2U7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX3BrT25Kb2luID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX2RhdGFzdG9yZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9idWlsdGluID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfaW5uZXIg\nPSBmYWxzZTsKICAgIHByaXZhdGUgU3RyaW5nIF9pZFN1ZmZpeCA9ICJJZCI7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2ludmVyc2UgPSB0cnVlOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9kZXRhY2hhYmxlID0gZmFsc2U7CiAgICBwcml2YXRl\nIENvZGVGb3JtYXQgX2Zvcm1hdCA9IG51bGw7CiAgICBwcml2YXRlIFJldmVy\nc2VDdXN0b21pemVyIF9jdXN0b20gPSBudWxsOwogICAgcHJpdmF0ZSBTdHJp\nbmcgX2Rpc2NTdHJhdCA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfdmVy\nc1N0cmF0ID0gbnVsbDsKCiAgICAvLyB3ZSBoYXZlIHRvIHRyYWNrIGZpZWxk\nIG5hbWVzIHRoYXQgd2VyZSBjcmVhdGVkIGJ1dCB0aGVuIGFiYW5kb25lZCBi\neQogICAgLy8gdGhlIGN1c3RvbWl6ZXIgc28gdGhhdCB3ZSBkb24ndCBhdHRl\nbXB0IHRvIHVzZSB0aGVtIGFnYWluOyBkb2luZyBzbyBjYW4KICAgIC8vIG1l\nc3MgdXAgY2VydGFpbiBjdXN0b21pemVycyAoYnVnIDg4MSkKICAgIHByaXZh\ndGUgU2V0IF9hYmFuZG9uZWRGaWVsZE5hbWVzID0gbnVsbDsKCiAgICAvKioK\nICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAg\nICAqLwogICAgcHVibGljIFJldmVyc2VNYXBwaW5nVG9vbChKREJDQ29uZmln\ndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2NvbmYgPSBjb25mOwogICAgICAg\nIF9sb2cgPSBjb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfTUVU\nQURBVEEpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBpbnRl\ncm5hbCBzdHJhdGVneSBpbnN0YWxsZXIuCiAgICAgKi8KICAgIHByaXZhdGUg\nU3RyYXRlZ3lJbnN0YWxsZXIgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKSB7CiAg\nICAgICAgaWYgKF9zdHJhdCA9PSBudWxsKQogICAgICAgICAgICBfc3RyYXQg\nPSBuZXcgUmV2ZXJzZVN0cmF0ZWd5SW5zdGFsbGVyKGdldFJlcG9zaXRvcnko\nKSk7CiAgICAgICAgcmV0dXJuIF9zdHJhdDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgY29uZmlndXJhdGlvbiBwcm92aWRlZCBvbiBjb25z\ndHJ1Y3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlv\nbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbG9nIHRvIHdyaXRl\nIHRvLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAg\nICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZGVmYXVsdCBwYWNrYWdlIGZvciB0aGUgZ2VuZXJhdGVkIGNsYXNzZXMs\nIG9yIG51bGwgaWYgdW5zZXQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0UGFja2FnZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF9wYWNrYWdlOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBkZWZhdWx0IHBhY2thZ2Ug\nZm9yIHRoZSBnZW5lcmF0ZWQgY2xhc3NlczsgdXNlIG51bGwgdG8KICAgICAq\nIGluZGljYXRlIG5vIHBhY2thZ2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFBhY2thZ2VOYW1lKFN0cmluZyBwYWNrYWdlTmFtZSkgewogICAgICAg\nIF9wYWNrYWdlID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChwYWNrYWdlTmFt\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZmlsZSB0byBvdXRwdXQg\ndGhlIGdlbmVyYXRlZCBjb2RlIHRvLCBvciBudWxsIGZvcgogICAgICogdGhl\nIGN1cnJlbnQgZGlyZWN0b3J5LiBJZiB0aGUgZGlyZWN0b3J5IG1hdGNoZXMg\ndGhlIHBhY2thZ2UsIGl0IHdpbGwKICAgICAqIGJlIHVzZWQuIE90aGVyd2lz\nZSwgdGhlIHBhY2thZ2Ugc3RydWN0dXJlIHdpbGwgYmUgY3JlYXRlZCB1bmRl\ncgogICAgICogdGhpcyBkaXJlY3RvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBG\naWxlIGdldERpcmVjdG9yeSgpIHsKICAgICAgICByZXR1cm4gX2RpcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBmaWxlIHRvIG91dHB1dCB0aGUgZ2Vu\nZXJhdGVkIGNvZGUgdG8sIG9yIG51bGwgZm9yCiAgICAgKiB0aGUgY3VycmVu\ndCBkaXJlY3RvcnkuIElmIHRoZSBkaXJlY3RvcnkgbWF0Y2hlcyB0aGUgcGFj\na2FnZSwgaXQgd2lsbAogICAgICogYmUgdXNlZC4gT3RoZXJ3aXNlLCB0aGUg\ncGFja2FnZSBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhdGVkIHVuZGVyCiAgICAg\nKiB0aGlzIGRpcmVjdG9yeS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nRGlyZWN0b3J5KEZpbGUgZGlyKSB7CiAgICAgICAgX2RpciA9IGRpcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBzY2hlbWEg\nbmFtZSB3aWxsIGJlIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQKICAgICAq\nIGNsYXNzIG5hbWUgZm9yIGVhY2ggdGFibGUuIERlZmF1bHRzIHRvIGZhbHNl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRVc2VTY2hlbWFOYW1l\nKCkgewogICAgICAgIHJldHVybiBfdXNlU2NoZW1hOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHdoZXRoZXIgdGhlIHNjaGVtYSBuYW1lIHdpbGwgYmUg\naW5jbHVkZWQgaW4gdGhlIGdlbmVyYXRlZAogICAgICogY2xhc3MgbmFtZSBm\nb3IgZWFjaCB0YWJsZS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldFVzZVNjaGVtYU5hbWUoYm9vbGVhbiB1c2VTY2hl\nbWEpIHsKICAgICAgICBfdXNlU2NoZW1hID0gdXNlU2NoZW1hOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGZvcmVpZ24ga2V5\nIG5hbWUgd2lsbCBiZSB1c2VkIHRvIGdlbmVyYXRlCiAgICAgKiByZWxhdGlv\nbiBuYW1lcy4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGdldFVzZUZvcmVpZ25LZXlOYW1lKCkgewogICAgICAgIHJl\ndHVybiBfdXNlRks7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgd2hldGhl\nciB0aGUgZm9yZWlnbiBrZXkgbmFtZSB3aWxsIGJlIHVzZWQgdG8gZ2VuZXJh\ndGUKICAgICAqIHJlbGF0aW9uIG5hbWVzLiBEZWZhdWx0cyB0byBmYWxzZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VXNlRm9yZWlnbktleU5hbWUo\nYm9vbGVhbiB1c2VGSykgewogICAgICAgIF91c2VGSyA9IHVzZUZLOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgZXZlbiBudWxsYWJs\nZSBjb2x1bW5zIHdpbGwgYmUgbWFwcGVkIHRvIHdyYXBwZXJzCiAgICAgKiBy\nYXRoZXIgdGhhbiBwcmltaXRpdmVzLiBEZWZhdWx0cyB0byBmYWxzZS4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0TnVsbGFibGVBc09iamVjdCgp\nIHsKICAgICAgICByZXR1cm4gX251bGxBc09iajsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB3aGV0aGVyIGV2ZW4gbnVsbGFibGUgY29sdW1ucyB3aWxs\nIGJlIG1hcHBlZCB0byB3cmFwcGVycwogICAgICogcmF0aGVyIHRoYW4gcHJp\nbWl0aXZlcy4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldE51bGxhYmxlQXNPYmplY3QoYm9vbGVhbiBudWxsQXNPYmop\nIHsKICAgICAgICBfbnVsbEFzT2JqID0gbnVsbEFzT2JqOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hldGhlciB0byByZXZlcnNlLW1hcCBibG9iIGNvbHVt\nbnMgYXMgY29udGFpbmluZyBzZXJpYWxpemVkIEphdmEKICAgICAqIG9iamVj\ndHMsIHJhdGhlciB0aGFuIHRoZSBkZWZhdWx0IG9mIHVzaW5nIGEgYnl0ZVtd\nIGZpZWxkLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRCbG9iQXNP\nYmplY3QoKSB7CiAgICAgICAgcmV0dXJuIF9ibG9iQXNPYmo7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHJldmVyc2UtbWFwIGJsb2IgY29s\ndW1ucyBhcyBjb250YWluaW5nIHNlcmlhbGl6ZWQgSmF2YQogICAgICogb2Jq\nZWN0cywgcmF0aGVyIHRoYW4gdGhlIGRlZmF1bHQgb2YgdXNpbmcgYSBieXRl\nW10gZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2JBc09i\namVjdChib29sZWFuIGJsb2JBc09iaikgewogICAgICAgIF9ibG9iQXNPYmog\nPSBibG9iQXNPYmo7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgb2YgSkRC\nQy1uYW1lIHRvIEphdmEtdHlwZS1uYW1lIGVudHJpZXMgdGhhdCBhbGxvd3Mg\nY3VzdG9taXphdGlvbgogICAgICogb2YgcmV2ZXJzZSBtYXBwaW5nIGNvbHVt\nbnMgdG8gZmllbGQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyBQcm9wZXJ0\naWVzIGdldFR5cGVNYXAoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlTWFwOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFwIG9mIEpEQkMtbmFtZSB0byBKYXZh\nLXR5cGUtbmFtZSBlbnRyaWVzIHRoYXQgYWxsb3dzIGN1c3RvbWl6YXRpb24K\nICAgICAqIG9mIHJldmVyc2UgbWFwcGluZyBjb2x1bW5zIHRvIGZpZWxkIHR5\ncGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlTWFwKFByb3Bl\ncnRpZXMgdHlwZU1hcCkgewogICAgICAgIF90eXBlTWFwID0gdHlwZU1hcDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIGpvaW4gdGFi\nbGVzIGFyZSBhbGxvd2VkIHRvIGhhdmUgcHJpbWFyeSBrZXlzLCBmYWxzZQog\nICAgICogaWYgYWxsIHByaW1hcnkga2V5IHRhYmxlcyB3aWxsIGJlIG1hcHBl\nZCBhcyBwZXJzaXN0ZW50IGNsYXNzZXMuCiAgICAgKiBEZWZhdWx0cyB0byBm\nYWxzZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0UHJpbWFyeUtl\neU9uSm9pbigpIHsKICAgICAgICByZXR1cm4gX3BrT25Kb2luOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgam9pbiB0YWJsZXMgYXJl\nIGFsbG93ZWQgdG8gaGF2ZSBwcmltYXJ5IGtleXMsIGZhbHNlCiAgICAgKiBp\nZiBhbGwgcHJpbWFyeSBrZXkgdGFibGVzIHdpbGwgYmUgbWFwcGVkIGFzIHBl\ncnNpc3RlbnQgY2xhc3Nlcy4KICAgICAqIERlZmF1bHRzIHRvIGZhbHNlLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQcmltYXJ5S2V5T25Kb2luKGJv\nb2xlYW4gcGtPbkpvaW4pIHsKICAgICAgICBfcGtPbkpvaW4gPSBwa09uSm9p\nbjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIGRhdGFz\ndG9yZSBpZGVudGl0eSB3aGVuIHBvc3NpYmxlLiBEZWZhdWx0cyB0byBmYWxz\nZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0VXNlRGF0YVN0b3Jl\nSWRlbnRpdHkoKSB7CiAgICAgICAgcmV0dXJuIF9kYXRhc3RvcmU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBkYXRhc3RvcmUgaWRl\nbnRpdHkgd2hlbiBwb3NzaWJsZS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFVzZURhdGFTdG9yZUlkZW50aXR5KGJv\nb2xlYW4gZGF0YXN0b3JlKSB7CiAgICAgICAgX2RhdGFzdG9yZSA9IGRhdGFz\ndG9yZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIGJ1\naWx0IGluIGlkZW50aXR5IGNsYXNzZXMgd2hlbiBwb3NzaWJsZS4gRGVmYXVs\ndHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0VXNl\nQnVpbHRpbklkZW50aXR5Q2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIF9idWls\ndGluOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2UgYnVp\nbHQgaW4gaWRlbnRpdHkgY2xhc3NlcyB3aGVuIHBvc3NpYmxlLiBEZWZhdWx0\ncyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRVc2VCdWls\ndGluSWRlbnRpdHlDbGFzcyhib29sZWFuIGJ1aWx0aW4pIHsKICAgICAgICBf\nYnVpbHRpbiA9IGJ1aWx0aW47CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIG9yIG5vdCB0byBnZW5lcmF0ZSBpbm5lciBjbGFzc2VzIHdoZW4gY3Jl\nYXRpbmcgYXBwbGljYXRpb24KICAgICAqIGlkZW50aXR5IGNsYXNzZXMuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldElubmVySWRlbnRpdHlDbGFz\nc2VzKCkgewogICAgICAgIHJldHVybiBfaW5uZXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0byBnZW5lcmF0ZSBpbm5lciBjbGFz\nc2VzIHdoZW4gY3JlYXRpbmcgYXBwbGljYXRpb24KICAgICAqIGlkZW50aXR5\nIGNsYXNzZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElubmVySWRl\nbnRpdHlDbGFzc2VzKGJvb2xlYW4gaW5uZXIpIHsKICAgICAgICBfaW5uZXIg\nPSBpbm5lcjsKICAgIH0KCiAgICAvKioKICAgICAqIFN1ZmZpeCB1c2VkIHRv\nIGNyZWF0ZSBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzcyBuYW1lIGZyb20g\nYSBjbGFzcyBuYW1lLAogICAgICogb3IgaW4gdGhlIGNhc2Ugb2YgaW5uZXIg\naWRlbnRpdHkgY2xhc3NlcywgdGhlIGlubmVyIGNsYXNzIG5hbWUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0SWRlbnRpdHlDbGFzc1N1ZmZpeCgp\nIHsKICAgICAgICByZXR1cm4gX2lkU3VmZml4OwogICAgfQoKICAgIC8qKgog\nICAgICogU3VmZml4IHVzZWQgdG8gY3JlYXRlIGFwcGxpY2F0aW9uIGlkZW50\naXR5IGNsYXNzIG5hbWUgZnJvbSBhIGNsYXNzIG5hbWUsCiAgICAgKiBvciBp\nbiB0aGUgY2FzZSBvZiBpbm5lciBpZGVudGl0eSBjbGFzc2VzLCB0aGUgaW5u\nZXIgY2xhc3MgbmFtZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SWRl\nbnRpdHlDbGFzc1N1ZmZpeChTdHJpbmcgc3VmZml4KSB7CiAgICAgICAgX2lk\nU3VmZml4ID0gc3VmZml4OwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0byBnZW5lcmF0ZSBpbnZlcnNlIDEtbWFueS8xLTEgcmVsYXRpb25zIGZv\nciBhbGwgbWFueS0xLzEtMQogICAgICogcmVsYXRpb25zLiBEZWZhdWx0cyB0\nbyB0cnVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJbnZlcnNl\nUmVsYXRpb25zKCkgewogICAgICAgIHJldHVybiBfaW52ZXJzZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgaW52ZXJzZSAx\nLW1hbnkvMS0xIHJlbGF0aW9ucyBmb3IgYWxsIG1hbnktMS8xLTEKICAgICAq\nIHJlbGF0aW9ucy4gRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0SW52ZXJzZVJlbGF0aW9ucyhib29sZWFuIGludmVyc2Up\nIHsKICAgICAgICBfaW52ZXJzZSA9IGludmVyc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRvIG1ha2UgZ2VuZXJhdGVkIGNsYXNzZXMgZGV0\nYWNoYWJsZS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGdldERldGFjaGFibGUoKSB7CiAgICAgICAgcmV0dXJuIF9k\nZXRhY2hhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBt\nYWtlIGdlbmVyYXRlZCBjbGFzc2VzIGRldGFjaGFibGUuIERlZmF1bHRzIHRv\nIGZhbHNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hhYmxl\nKGJvb2xlYW4gZGV0YWNoYWJsZSkgewogICAgICAgIF9kZXRhY2hhYmxlID0g\nZGV0YWNoYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlZmF1bHQgZGlz\nY3JpbWluYXRvciBzdHJhdGVneSBmb3IgYmFzZSBjbGFzcyBtYXBwaW5ncy4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXREaXNjcmltaW5hdG9yU3Ry\nYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9kaXNjU3RyYXQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWZhdWx0IGRpc2NyaW1pbmF0b3Igc3RyYXRlZ3kg\nZm9yIGJhc2UgY2xhc3MgbWFwcGluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERpc2NyaW1pbmF0b3JTdHJhdGVneShTdHJpbmcgZGlzY1N0cmF0\nKSB7CiAgICAgICAgX2Rpc2NTdHJhdCA9IGRpc2NTdHJhdDsKICAgIH0KCiAg\nICAvKioKICAgICAqIERlZmF1bHQgdmVyc2lvbiBzdHJhdGVneSBmb3IgYmFz\nZSBjbGFzcyBtYXBwaW5ncy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRWZXJzaW9uU3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF92ZXJzU3Ry\nYXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWZhdWx0IHZlcnNpb24gc3Ry\nYXRlZ3kgZm9yIGJhc2UgY2xhc3MgbWFwcGluZ3MuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFZlcnNpb25TdHJhdGVneShTdHJpbmcgdmVyc2lvblN0\ncmF0KSB7CiAgICAgICAgX3ZlcnNTdHJhdCA9IHZlcnNpb25TdHJhdDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBjb2RlIGZvcm1hdHRlciBmb3IgdGhl\nIGdlbmVyYXRlZCBKYXZhIGNvZGUuCiAgICAgKi8KICAgIHB1YmxpYyBDb2Rl\nRm9ybWF0IGdldENvZGVGb3JtYXQoKSB7CiAgICAgICAgcmV0dXJuIF9mb3Jt\nYXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNvZGUgZm9ybWF0\ndGVyIGZvciB0aGUgZ2VuZXJhdGVkIEphdmEgY29kZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Q29kZUZvcm1hdChDb2RlRm9ybWF0IGZvcm1hdCkg\newogICAgICAgIF9mb3JtYXQgPSBmb3JtYXQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGN1c3RvbWl6ZXIgaW4gdXNlLCBvciBudWxsIGlm\nIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBSZXZlcnNlQ3VzdG9taXplciBn\nZXRDdXN0b21pemVyKCkgewogICAgICAgIHJldHVybiBfY3VzdG9tOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBjdXN0b21pemVyLiBUaGUgY29u\nZmlndXJhdGlvbiBvbiB0aGUgY3VzdG9taXplciwgaWYgYW55LAogICAgICog\nc2hvdWxkIGFscmVhZHkgYmUgc2V0LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRDdXN0b21pemVyKFJldmVyc2VDdXN0b21pemVyIGN1c3RvbWl6ZXIp\nIHsKICAgICAgICBpZiAoY3VzdG9taXplciAhPSBudWxsKQogICAgICAgICAg\nICBjdXN0b21pemVyLnNldFRvb2wodGhpcyk7CiAgICAgICAgX2N1c3RvbSA9\nIGN1c3RvbWl6ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG1hcHBpbmcgcmVwb3NpdG9yeSB1c2VkIHRvIGhvbGQgZ2VuZXJhdGVkIG1h\ncHBpbmdzLiBZb3UKICAgICAqIGNhbiBhbHNvIHVzZSB0aGUgcmVwb3NpdG9y\neSB0byBzZWVkIHRoZSBzY2hlbWEgZ3JvdXAgdG8gZ2VuZXJhdGUKICAgICAq\nIGNsYXNzZXMgZnJvbS4KICAgICAqLwogICAgcHVibGljIE1hcHBpbmdSZXBv\nc2l0b3J5IGdldFJlcG9zaXRvcnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNyZWF0ZSBlbXB0eSByZXBvc2l0\nb3J5CiAgICAgICAgICAgIF9yZXBvcyA9IF9jb25mLm5ld01hcHBpbmdSZXBv\nc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgX3JlcG9zLnNldE1ldGFE\nYXRhRmFjdG9yeShOb25lTWV0YURhdGFGYWN0b3J5LmdldEluc3RhbmNlKCkp\nOwogICAgICAgICAgICBfcmVwb3Muc2V0TWFwcGluZ0RlZmF1bHRzKE5vbmVN\nYXBwaW5nRGVmYXVsdHMuZ2V0SW5zdGFuY2UoKSk7CiAgICAgICAgICAgIF9y\nZXBvcy5zZXRSZXNvbHZlKE1PREVfTk9ORSk7CiAgICAgICAgICAgIF9yZXBv\ncy5zZXRWYWxpZGF0ZShfcmVwb3MuVkFMSURBVEVfTk9ORSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIHJlcG9zaXRvcnkgdG8gdXNlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRSZXBvc2l0b3J5KE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9z\nKSB7CiAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHNjaGVtYSBncm91cCB0byByZXZlcnNlIG1hcC4g\nSWYgbm9uZSBoYXMgYmVlbiBzZXQsIHRoZQogICAgICogc2NoZW1hIHdpbGwg\nYmUgZ2VuZXJhdGVkIGZyb20gdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBw\ndWJsaWMgU2NoZW1hR3JvdXAgZ2V0U2NoZW1hR3JvdXAoKSB7CiAgICAgICAg\naWYgKF9zY2hlbWEgPT0gbnVsbCkgewogICAgICAgICAgICBTY2hlbWFHZW5l\ncmF0b3IgZ2VuID0gbmV3IFNjaGVtYUdlbmVyYXRvcihfY29uZik7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnZW4uZ2VuZXJhdGVTY2hl\nbWFzKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9y\nZShzZSwKICAgICAgICAgICAgICAgICAgICBfY29uZi5nZXREQkRpY3Rpb25h\ncnlJbnN0YW5jZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfc2No\nZW1hID0gZ2VuLmdldFNjaGVtYUdyb3VwKCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBfc2NoZW1hOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBzY2hlbWEgdG8gcmV2ZXJzZSBtYXAuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldFNjaGVtYUdyb3VwKFNjaGVtYUdyb3VwIHNjaGVtYSkgewogICAg\nICAgIF9zY2hlbWEgPSBzY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGdlbmVyYXRlZCBtYXBwaW5ncy4KICAgICAqLwogICAgcHVi\nbGljIENsYXNzTWFwcGluZ1tdIGdldE1hcHBpbmdzKCkgewogICAgICAgIHJl\ndHVybiBnZXRSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ3MoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEdlbmVyYXRlIG1hcHBpbmdzIGFuZCBjbGFzcyBjb2Rl\nIGZvciB0aGUgY3VycmVudCBzY2hlbWEgZ3JvdXAuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAvLyBtYXAgYmFzZSBjbGFzc2Vz\nIGZpcnN0CiAgICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IGdldFNjaGVtYUdy\nb3VwKCkuZ2V0U2NoZW1hcygpOwogICAgICAgIFRhYmxlW10gdGFibGVzOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB0YWJsZXMgPSBzY2hlbWFzW2ldLmdldFRhYmxl\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYmxlcy5s\nZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIGlmIChpc0Jhc2VUYWJsZSh0\nYWJsZXNbal0pKQogICAgICAgICAgICAgICAgICAgIG1hcEJhc2VDbGFzcyh0\nYWJsZXNbal0pOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFwIHZlcnRpY2Fs\nIHN1YmNsYXNzZXMKICAgICAgICBTZXQgc3VicyA9IG51bGw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIHRhYmxlcyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFibGVzLmxlbmd0aDsg\naisrKSB7CiAgICAgICAgICAgICAgICBpZiAoIV90YWJsZXMuY29udGFpbnNL\nZXkodGFibGVzW2pdKQogICAgICAgICAgICAgICAgICAgICYmIGdldFNlY29u\nZGFyeVR5cGUodGFibGVzW2pdLCBmYWxzZSkgPT0gVEFCTEVfU1VCQ0xBU1Mp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3VicyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICBzdWJzID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgICAgICAgICBzdWJzLmFkZCh0YWJsZXNbal0pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlm\nIChzdWJzICE9IG51bGwpCiAgICAgICAgICAgIG1hcFN1YmNsYXNzZXMoc3Vi\ncyk7CgogICAgICAgIC8vIG1hcCBmaWVsZHMgaW4gdGhlIHByaW1hcnkgdGFi\nbGVzIG9mIHRoZSBjbGFzc2VzCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNsczsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF90YWJsZXMudmFsdWVzKCku\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgY2xz\nID0gKENsYXNzTWFwcGluZykgaXRyLm5leHQoKTsKICAgICAgICAgICAgbWFw\nQ29sdW1ucyhjbHMsIGNscy5nZXRUYWJsZSgpLCBudWxsLCBmYWxzZSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBtYXAgYXNzb2NpYXRpb24gdGFibGVzLCBq\nb2luIHRhYmxlcywgYW5kIHNlY29uZGFyeSB0YWJsZXMKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgdGFibGVzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJsZXMubGVuZ3RoOyBqKysp\nCiAgICAgICAgICAgICAgICBpZiAoIV90YWJsZXMuY29udGFpbnNLZXkodGFi\nbGVzW2pdKSkKICAgICAgICAgICAgICAgICAgICBtYXBUYWJsZSh0YWJsZXNb\nal0sIGdldFNlY29uZGFyeVR5cGUodGFibGVzW2pdLCBmYWxzZSkpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gbWFwIGRpc2NyaW1pbmF0b3JzIGFuZCB2ZXJz\naW9ucywgbWFrZSBzdXJlIGlkZW50aXR5IHR5cGUgaXMgY29ycmVjdCwKICAg\nICAgICAvLyBzZXQgc2ltcGxlIGZpZWxkIGNvbHVtbiBqYXZhIHR5cGVzLCBh\nbmQgcmVmIHNjaGVtYSBjb21wb25lbnRzIHNvCiAgICAgICAgLy8gd2UgY2Fu\nIHRlbGwgd2hhdCBpcyB1bm1hcHBlZAogICAgICAgIEZpZWxkTWFwcGluZ1td\nIGZpZWxkczsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF90YWJsZXMu\ndmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgY2xzID0gKENsYXNzTWFwcGluZykgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgY2xzLnJlZlNjaGVtYUNvbXBvbmVudHMoKTsKICAgICAgICAgICAg\naWYgKGNscy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0U3RyYXRlZ3koKSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgZ2V0U3RyYXRlZ3lJbnN0YWxsZXIoKS5p\nbnN0YWxsU3RyYXRlZ3kKICAgICAgICAgICAgICAgICAgICAoY2xzLmdldERp\nc2NyaW1pbmF0b3IoKSk7CiAgICAgICAgICAgIGNscy5nZXREaXNjcmltaW5h\ndG9yKCkucmVmU2NoZW1hQ29tcG9uZW50cygpOwogICAgICAgICAgICBpZiAo\nY2xzLmdldFZlcnNpb24oKS5nZXRTdHJhdGVneSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBnZXRTdHJhdGVneUluc3RhbGxlcigpLmluc3RhbGxTdHJh\ndGVneShjbHMuZ2V0VmVyc2lvbigpKTsKICAgICAgICAgICAgY2xzLmdldFZl\ncnNpb24oKS5yZWZTY2hlbWFDb21wb25lbnRzKCk7CgogICAgICAgICAgICAv\nLyBkb3VibGUtY2hlY2sgaWRlbnRpdHkgdHlwZTsgaWYgaXQgd2FzIHNldCBm\nb3IgYnVpbHRpbiBpZGVudGl0eQogICAgICAgICAgICAvLyBpdCBtaWdodCBo\nYXZlIHRvIHN3aXRjaCB0byBzdGQgYXBwbGljYXRpb24gaWRlbnRpdHkgaWYg\ncGsgZmllbGQKICAgICAgICAgICAgLy8gbm90IGNvbXBhdGlibGUKICAgICAg\nICAgICAgaWYgKGNscy5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsCiAgICAg\nICAgICAgICAgICAmJiBjbHMuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nYXBwaW5nLklEX0FQUExJQ0FUSU9OKSB7CiAgICAgICAgICAgICAgICBpZiAo\nY2xzLmdldFByaW1hcnlLZXlGaWVsZHMoKS5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLXBrLWZpZWxkcyIsIGNscykpOwogICAgICAgICAgICAgICAg\naWYgKGNscy5nZXRPYmplY3RJZFR5cGUoKSA9PSBudWxsCiAgICAgICAgICAg\nICAgICAgICAgfHwgKGNscy5pc09wZW5KUEFJZGVudGl0eSgpICYmICFpc0J1\naWx0aW5JZGVudGl0eShjbHMpKSkKICAgICAgICAgICAgICAgICAgICBzZXRP\nYmplY3RJZFR5cGUoY2xzKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjbHMu\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0RBVEFTVE9S\nRSkKICAgICAgICAgICAgICAgIGNscy5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nWzBdLnNldEphdmFUeXBlKEphdmFUeXBlcy5MT05HKTsKCiAgICAgICAgICAg\nIC8vIHNldCBqYXZhIHR5cGVzIGZvciBzaW1wbGUgZmllbGRzOwogICAgICAg\nICAgICBmaWVsZHMgPSBjbHMuZ2V0RGVjbGFyZWRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmaWVsZHNbaV0ucmVmU2NoZW1h\nQ29tcG9uZW50cygpOwogICAgICAgICAgICAgICAgc2V0Q29sdW1uSmF2YVR5\ncGUoZmllbGRzW2ldKTsKICAgICAgICAgICAgICAgIHNldENvbHVtbkphdmFU\neXBlKGZpZWxkc1tpXS5nZXRFbGVtZW50TWFwcGluZygpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2V0IHRoZSBqYXZhIHR5cGVz\nIG9mIGZvcmVpZ24ga2V5IGNvbHVtbnM7IHdlIGNvdWxkbid0IGRvIHRoaXMK\nICAgICAgICAvLyBlYXJsaWVyIGJlY2F1c2Ugd2UgcmVseSBvbiB0aGUgbGlu\na2VkLXRvIGNvbHVtbnMgdG8gZG8gaXQKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF90YWJsZXMudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgY2xzID0gKENsYXNzTWFwcGluZykgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgc2V0Rm9yZWlnbktleUphdmFUeXBlKGNs\ncy5nZXRKb2luRm9yZWlnbktleSgpKTsKCiAgICAgICAgICAgIGZpZWxkcyA9\nIGNscy5nZXREZWNsYXJlZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHNldEZvcmVpZ25LZXlKYXZhVHlwZShmaWVsZHNbaV0u\nZ2V0Sm9pbkZvcmVpZ25LZXkoKSk7CiAgICAgICAgICAgICAgICBzZXRGb3Jl\naWduS2V5SmF2YVR5cGUoZmllbGRzW2ldLmdldEZvcmVpZ25LZXkoKSk7CiAg\nICAgICAgICAgICAgICBzZXRGb3JlaWduS2V5SmF2YVR5cGUoZmllbGRzW2ld\nLmdldEVsZW1lbnRNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRm9yZWlnbktleSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gYWxsb3cgY3VzdG9taXplciB0byBtYXAgdW5tYXBwZWQgdGFibGVz\nLCBhbmQgd2FybiBhYm91dCBhbnl0aGluZwogICAgICAgIC8vIHRoYXQgZW5k\ncyB1cCB1bm1hcHBlZAogICAgICAgIENvbHVtbltdIGNvbHM7CiAgICAgICAg\nQ29sbGVjdGlvbiB1bm1hcHBlZENvbHMgPSBuZXcgQXJyYXlMaXN0KDUpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICB0YWJsZXMgPSBzY2hlbWFzW2ldLmdldFRhYmxl\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYmxlcy5s\nZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgdW5tYXBwZWRDb2xzLmNs\nZWFyKCk7CiAgICAgICAgICAgICAgICBjb2xzID0gdGFibGVzW2pdLmdldENv\nbHVtbnMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwg\nY29scy5sZW5ndGg7IGsrKykKICAgICAgICAgICAgICAgICAgICBpZiAoY29s\nc1trXS5nZXRSZWZDb3VudCgpID09IDApCiAgICAgICAgICAgICAgICAgICAg\nICAgIHVubWFwcGVkQ29scy5hZGQoY29sc1trXSk7CgogICAgICAgICAgICAg\nICAgaWYgKHVubWFwcGVkQ29scy5zaXplKCkgPT0gY29scy5sZW5ndGgpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX2N1c3RvbSA9PSBudWxsIHx8ICFf\nY3VzdG9tLnVubWFwcGVkVGFibGUodGFibGVzW2pdKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJ1bm1hcC10YWJsZSIs\nIHRhYmxlc1tqXSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1bm1h\ncHBlZENvbHMuc2l6ZSgpID4gMCkKICAgICAgICAgICAgICAgICAgICBfbG9n\nLmluZm8oX2xvYy5nZXQoInVubWFwLWNvbHMiLCB0YWJsZXNbal0sIHVubWFw\ncGVkQ29scykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlm\nIChfY3VzdG9tICE9IG51bGwpCiAgICAgICAgICAgIF9jdXN0b20uY2xvc2Uo\nKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBtYXBwaW5ncwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gX3RhYmxlcy52YWx1ZXMoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgKChDbGFzc01hcHBpbmcpIGl0\nci5uZXh0KCkpLnJlc29sdmUoTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1hcCB0aGUgdGFibGUgb2YgdGhlIGdp\ndmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtYXBUYWJsZShU\nYWJsZSB0YWJsZSwgaW50IHR5cGUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUp\nIHsKICAgICAgICAgICAgY2FzZSBUQUJMRV9TRUNPTkRBUlk6CiAgICAgICAg\nICAgIGNhc2UgVEFCTEVfU0VDT05EQVJZX09VVEVSOgogICAgICAgICAgICAg\nICAgbWFwU2Vjb25kYXJ5VGFibGUodGFibGUsIHR5cGUgIT0gVEFCTEVfU0VD\nT05EQVJZKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIFRBQkxFX0FTU09DSUFUSU9OOgogICAgICAgICAgICAgICAgbWFwQXNz\nb2NpYXRpb25UYWJsZSh0YWJsZSk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgZ2l2ZW4gY2xhc3MgaXMgY29tcGF0aWJsZSB3aXRoIGJ1aWx0aW4g\naWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4g\naXNCdWlsdGluSWRlbnRpdHkoQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZpZWxkcyA9IGNscy5nZXRQcmltYXJ5S2V5Rmll\nbGRNYXBwaW5ncygpOwogICAgICAgIGlmIChmaWVsZHMubGVuZ3RoICE9IDEp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGZp\nZWxkc1swXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TVFJJTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIEphdmEgdHlwZSBvZiB0aGUgY29sdW1uIGZvciB0aGUgZ2l2ZW4gdmFsdWUu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgc2V0Q29sdW1uSmF2\nYVR5cGUoVmFsdWVNYXBwaW5nIHZtKSB7CiAgICAgICAgQ29sdW1uW10gY29s\ncyA9IHZtLmdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5sZW5ndGgg\nPT0gMSkKICAgICAgICAgICAgY29sc1swXS5zZXRKYXZhVHlwZSh2bS5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBKYXZhIHR5cGUgb2YgdGhlIGZvcmVpZ24ga2V5IGNvbHVtbnMuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgc2V0Rm9yZWlnbktleUph\ndmFUeXBlKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIENvbHVtbltdIGNvbHMg\nPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gcGtzID0gZmsu\nZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2xz\nW2ldLmdldEphdmFUeXBlKCkgPT0gSmF2YVR5cGVzLk9CSkVDVCkKICAgICAg\nICAgICAgICAgIGNvbHNbaV0uc2V0SmF2YVR5cGUocGtzW2ldLmdldEphdmFU\neXBlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogVXNlcyB7QGxpbmsgQ29k\nZUdlbmVyYXRvcn1zIHRvIHdyaXRlIHRoZSBKYXZhIGNvZGUgZm9yIHRoZSBn\nZW5lcmF0ZWQKICAgICAqIG1hcHBpbmdzIHRvIHRoZSBwcm9wZXIgcGFja2Fn\nZXMuCiAgICAgKgogICAgICogQHJldHVybiBhIGxpc3Qgb2Yge0BsaW5rIEZp\nbGV9IGluc3RhbmNlcyB0aGF0IHdlcmUgd3JpdHRlbgogICAgICovCiAgICBw\ndWJsaWMgTGlzdCByZWNvcmRDb2RlKCkKICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIHJldHVybiByZWNvcmRDb2RlKG51bGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIGNvZGUgZm9yIHRoZSB0b29s\nLgogICAgICoKICAgICAqIEBwYXJhbSBvdXRwdXQgaWYgbnVsbCwgdGhlbiBw\nZXJmb3JtIHRoZSB3cml0ZSBkaXJlY3RseQogICAgICogdG8gdGhlIGZpbGVz\neXN0ZW07IG90aGVyd2lzZSwgcG9wdWxhdGUgdGhlCiAgICAgKiBzcGVjaWZp\nZWQgbWFwIHdpdGgga2V5cyBhcyB0aGUgZ2VuZXJhdGVkCiAgICAgKiB7QGxp\nbmsgQ2xhc3NNYXBwaW5nfSBhbmQgdmFsdWVzIGFzIGEKICAgICAqIHtAbGlu\nayBTdHJpbmd9IHRoYXQgY29udGFpbnMgdGhlIGdlbmVyYXRlZCBjb2RlCiAg\nICAgKiBAcmV0dXJuIGEgbGlzdCBvZiB7QGxpbmsgRmlsZX0gaW5zdGFuY2Vz\nIHRoYXQgd2VyZSB3cml0dGVuCiAgICAgKi8KICAgIHB1YmxpYyBMaXN0IHJl\nY29yZENvZGUoTWFwIG91dHB1dCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIExpc3Qgd3JpdHRlbiA9IG5ldyBMaW5rZWRMaXN0KCk7\nCgogICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0gZ2V0TWFwcGlu\nZ3MoKTsKICAgICAgICBSZXZlcnNlQ29kZUdlbmVyYXRvciBnZW47CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAoX2xvZy5pc0luZm9FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLmluZm8oX2xvYy5nZXQoImNsYXNzLWNvZGUiLCBt\nYXBwaW5nc1tpXSkpOwoKICAgICAgICAgICAgQXBwbGljYXRpb25JZFRvb2wg\nYWlkID0gbmV3QXBwbGljYXRpb25JZFRvb2wobWFwcGluZ3NbaV0pOwogICAg\nICAgICAgICBnZW4gPSBuZXcgUmV2ZXJzZUNvZGVHZW5lcmF0b3IobWFwcGlu\nZ3NbaV0sIGFpZCk7CiAgICAgICAgICAgIGdlbi5nZW5lcmF0ZUNvZGUoKTsK\nCiAgICAgICAgICAgIGlmIChvdXRwdXQgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgZ2VuLndyaXRlQ29kZSgpOwogICAgICAgICAgICAgICAgd3JpdHRl\nbi5hZGQoZ2VuLmdldEZpbGUoKSk7CiAgICAgICAgICAgICAgICBpZiAoYWlk\nICE9IG51bGwgJiYgIWFpZC5pc0lubmVyQ2xhc3MoKSkKICAgICAgICAgICAg\nICAgICAgICBhaWQucmVjb3JkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBTdHJpbmdXcml0ZXIgd3JpdGVyID0gbmV3IFN0cmlu\nZ1dyaXRlcigpOwogICAgICAgICAgICAgICAgZ2VuLndyaXRlQ29kZSh3cml0\nZXIpOwogICAgICAgICAgICAgICAgb3V0cHV0LnB1dChtYXBwaW5nc1tpXS5n\nZXREZXNjcmliZWRUeXBlKCksIHdyaXRlci50b1N0cmluZygpKTsKCiAgICAg\nICAgICAgICAgICBpZiAoYWlkICE9IG51bGwgJiYgIWFpZC5pc0lubmVyQ2xh\nc3MoKSkgewogICAgICAgICAgICAgICAgICAgIHdyaXRlciA9IG5ldyBTdHJp\nbmdXcml0ZXIoKTsKICAgICAgICAgICAgICAgICAgICBhaWQuc2V0V3JpdGVy\nKHdyaXRlcik7CiAgICAgICAgICAgICAgICAgICAgYWlkLnJlY29yZCgpOwog\nICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXQobWFwcGluZ3NbaV0uZ2V0\nT2JqZWN0SWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRl\nci50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gd3JpdHRlbjsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdyaXRlIHRoZSBnZW5lcmF0ZWQgbWV0YWRhdGEgdG8g\ndGhlIHByb3BlciBwYWNrYWdlcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRo\nZSBzZXQgb2YgbWV0YWRhdGEge0BsaW5rIEZpbGV9cyB0aGF0IHdlcmUgd3Jp\ndHRlbgogICAgICovCiAgICBwdWJsaWMgQ29sbGVjdGlvbiByZWNvcmRNZXRh\nRGF0YShib29sZWFuIHBlckNsYXNzKQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHJlY29yZE1ldGFEYXRhKHBlckNsYXNz\nLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBjb2Rl\nIGZvciB0aGUgdG9vbC4KICAgICAqCiAgICAgKiBAcGFyYW0gb3V0cHV0IGlm\nIG51bGwsIHRoZW4gcGVyZm9ybSB0aGUgd3JpdGUgZGlyZWN0bHkKICAgICAq\nIHRvIHRoZSBmaWxlc3lzdGVtOyBvdGhlcndpc2UsIHBvcHVsYXRlIHRoZQog\nICAgICogc3BlY2lmaWVkIG1hcCB3aXRoIGtleXMgYXMgdGhlIGdlbmVyYXRl\nZAogICAgICoge0BsaW5rIENsYXNzTWFwcGluZ30gYW5kIHZhbHVlcyBhcyBh\nCiAgICAgKiB7QGxpbmsgU3RyaW5nfSB0aGF0IGNvbnRhaW5zIHRoZSBnZW5l\ncmF0ZWQgY29kZQogICAgICogQHJldHVybiB0aGUgc2V0IG9mIG1ldGFkYXRh\nIHtAbGluayBGaWxlfXMgdGhhdCB3ZXJlIHdyaXR0ZW4KICAgICAqLwogICAg\ncHVibGljIENvbGxlY3Rpb24gcmVjb3JkTWV0YURhdGEoYm9vbGVhbiBwZXJD\nbGFzcywgTWFwIG91dHB1dCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIC8vIHByZXRlbmQgbWFwcGluZ3MgYXJlIGFsbCByZXNvbHZl\nZAogICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0gZ2V0TWFwcGlu\nZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBtYXBwaW5nc1tpXS5zZXRSZXNvbHZl\nKE1PREVfTUVUQSB8IE1PREVfTUFQUElORywgdHJ1ZSk7CgogICAgICAgIC8v\nIHN0b3JlIGluIHVzZXIncyBjb25maWd1cmVkIElPCiAgICAgICAgTWV0YURh\ndGFGYWN0b3J5IG1kZiA9IF9jb25mLm5ld01ldGFEYXRhRmFjdG9yeUluc3Rh\nbmNlKCk7CiAgICAgICAgbWRmLnNldFJlcG9zaXRvcnkoZ2V0UmVwb3NpdG9y\neSgpKTsKICAgICAgICBtZGYuc2V0U3RvcmVEaXJlY3RvcnkoX2Rpcik7CiAg\nICAgICAgaWYgKHBlckNsYXNzKQogICAgICAgICAgICBtZGYuc2V0U3RvcmVN\nb2RlKE1ldGFEYXRhRmFjdG9yeS5TVE9SRV9QRVJfQ0xBU1MpOwogICAgICAg\nIG1kZi5zdG9yZShtYXBwaW5ncywgbmV3IFF1ZXJ5TWV0YURhdGFbMF0sIG5l\ndyBTZXF1ZW5jZU1ldGFEYXRhWzBdLAogICAgICAgICAgICBNT0RFX01FVEEg\nfCBNT0RFX01BUFBJTkcsIG91dHB1dCk7CgogICAgICAgIFNldCBmaWxlcyA9\nIG5ldyBUcmVlU2V0KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBt\nYXBwaW5ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKG1hcHBpbmdz\nW2ldLmdldFNvdXJjZUZpbGUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nZmlsZXMuYWRkKG1hcHBpbmdzW2ldLmdldFNvdXJjZUZpbGUoKSk7CiAgICAg\nICAgcmV0dXJuIGZpbGVzOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJh\ndGUgYW5kIHdyaXRlIHRoZSBhcHBsaWNhdGlvbiBpZGVudGl0eSBjb2RlLgog\nICAgICovCiAgICBwcml2YXRlIEFwcGxpY2F0aW9uSWRUb29sIG5ld0FwcGxp\nY2F0aW9uSWRUb29sKENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAg\nQXBwbGljYXRpb25JZFRvb2wgdG9vbDsKICAgICAgICBpZiAobWFwcGluZy5n\nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01hcHBpbmcuSURfQVBQTElDQVRJ\nT04KICAgICAgICAgICAgJiYgIW1hcHBpbmcuaXNPcGVuSlBBSWRlbnRpdHko\nKQogICAgICAgICAgICAmJiBtYXBwaW5nLmdldFBDU3VwZXJjbGFzcygpID09\nIG51bGwpIHsKICAgICAgICAgICAgdG9vbCA9IG5ldyBBcHBsaWNhdGlvbklk\nVG9vbChfY29uZiwgbWFwcGluZy5nZXREZXNjcmliZWRUeXBlKCksCiAgICAg\nICAgICAgICAgICBtYXBwaW5nKTsKICAgICAgICAgICAgdG9vbC5zZXREaXJl\nY3RvcnkoX2Rpcik7CiAgICAgICAgICAgIHRvb2wuc2V0Q29kZUZvcm1hdChf\nZm9ybWF0KTsKICAgICAgICAgICAgaWYgKCF0b29sLnJ1bigpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB0b29s\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBNZXRo\nb2RzIGZvciBjdXN0b21pemVycyB0byB1c2UKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgY2xhc3MgbWFwcGluZyBmb3IgdGhlIGdpdmVuIHRhYmxlLCBvciBudWxs\nIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0\nQ2xhc3NNYXBwaW5nKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIChD\nbGFzc01hcHBpbmcpIF90YWJsZXMuZ2V0KHRhYmxlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBjbGFzcyB0byBiZSBtYXBwZWQgdG8g\nYSB0YWJsZS4gVGhlIGNsYXNzIHdpbGwgc3RhcnQgb3V0CiAgICAgKiB3aXRo\nIGEgZGVmYXVsdCBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzcyBzZXQuCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgbmV3Q2xhc3NNYXBwaW5n\nKENsYXNzIGNscywgVGFibGUgdGFibGUpIHsKICAgICAgICBDbGFzc01hcHBp\nbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIGdldFJlcG9zaXRvcnkoKS5h\nZGRNZXRhRGF0YShjbHMpOwogICAgICAgIENsYXNzIHN1cCA9IG1hcHBpbmcu\nZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBp\nZiAoc3VwID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgc2V0T2JqZWN0\nSWRUeXBlKG1hcHBpbmcpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWFw\ncGluZy5zZXRQQ1N1cGVyY2xhc3Moc3VwKTsKICAgICAgICBtYXBwaW5nLnNl\ndFRhYmxlKHRhYmxlKTsKICAgICAgICBpZiAoX2RldGFjaGFibGUpCiAgICAg\nICAgICAgIG1hcHBpbmcuc2V0RGV0YWNoYWJsZSh0cnVlKTsKICAgICAgICBf\ndGFibGVzLnB1dCh0YWJsZSwgbWFwcGluZyk7CiAgICAgICAgcmV0dXJuIG1h\ncHBpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIGNs\nYXNzJyBvYmplY3RpZC1jbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNldE9iamVjdElkVHlwZShDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAg\nU3RyaW5nIG5hbWUgPSBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKTsKICAgICAgICBpZiAoX2lubmVyKQogICAgICAgICAgICBuYW1lICs9ICIk\nIjsKICAgICAgICBuYW1lICs9IF9pZFN1ZmZpeDsKICAgICAgICBjbHMuc2V0\nT2JqZWN0SWRUeXBlKGdlbmVyYXRlQ2xhc3MobmFtZSwgbnVsbCksIGZhbHNl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGEgbmV3IGNsYXNz\nIHdpdGggdGhlIGdpdmVuIG5hbWUuIElmIGEgbm9uLW51bGwgcGFyZW50IGNs\nYXNzCiAgICAgKiBpcyBnaXZlbiwgaXQgd2lsbCBiZSBzZXQgYXMgdGhlIHN1\ncGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZW5lcmF0ZUNs\nYXNzKFN0cmluZyBuYW1lLCBDbGFzcyBwYXJlbnQpIHsKICAgICAgICBCQ0Ns\nYXNzIGJjID0gX3Byb2plY3QubG9hZENsYXNzKG5hbWUsIG51bGwpOwogICAg\nICAgIGlmIChwYXJlbnQgIT0gbnVsbCkKICAgICAgICAgICAgYmMuc2V0U3Vw\nZXJjbGFzcyhwYXJlbnQpOwogICAgICAgIGJjLmFkZERlZmF1bHRDb25zdHJ1\nY3RvcigpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gQ2xh\nc3MuZm9yTmFtZShuYW1lLCBmYWxzZSwgX2xvYWRlcik7CiAgICAgICAgfSBj\nYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihjbmZlLnRvU3RyaW5n\nKCksIGNuZmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB3aGV0aGVyIHRoZSBnaXZlbiBmb3JlaWduIGtleSBpcyB1bmlxdWUu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVW5pcXVlKEZvcmVpZ25L\nZXkgZmspIHsKICAgICAgICBQcmltYXJ5S2V5IHBrID0gZmsuZ2V0VGFibGUo\nKS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgaWYgKHBrICE9IG51bGwgJiYg\ncGsuY29sdW1uc01hdGNoKGZrLmdldENvbHVtbnMoKSkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIEluZGV4W10gaWR4ID0gZmsuZ2V0VGFi\nbGUoKS5nZXRJbmRleGVzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBpZHgubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChpZHhbaV0uaXNV\nbmlxdWUoKSAmJiBpZHhbaV0uY29sdW1uc01hdGNoKGZrLmdldENvbHVtbnMo\nKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBVbmlx\ndWVbXSB1bnEgPSBmay5nZXRUYWJsZSgpLmdldFVuaXF1ZXMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHVucS5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgaWYgKHVucVtpXS5jb2x1bW5zTWF0Y2goZmsuZ2V0Q29sdW1ucygp\nKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBnaXZlbiB0\nYWJsZSBoYXMgYSBzaW5nbGUgdW5pcXVlIGZvcmVpZ24ga2V5IG9yIGEgZm9y\nZWlnbgogICAgICoga2V5IHRoYXQgbWF0Y2hlcyB0aGUgcHJpbWFyeSBrZXks\nIHJldHVybiBpdC4gRWxzZSByZXR1cm4gbnVsbC4KICAgICAqLwogICAgcHVi\nbGljIEZvcmVpZ25LZXkgZ2V0VW5pcXVlRm9yZWlnbktleShUYWJsZSB0YWJs\nZSkgewogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSB0YWJsZS5nZXRGb3Jl\naWduS2V5cygpOwogICAgICAgIFByaW1hcnlLZXkgcGsgPSB0YWJsZS5nZXRQ\ncmltYXJ5S2V5KCk7CiAgICAgICAgRm9yZWlnbktleSB1bnEgPSBudWxsOwog\nICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBma3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBrICE9\nIG51bGwgJiYgcGsuY29sdW1uc01hdGNoKGZrc1tpXS5nZXRDb2x1bW5zKCkp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZrc1tpXTsKICAgICAgICAgICAg\naWYgKCFpc1VuaXF1ZShma3NbaV0pKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICBpZiAodW5x\nID09IG51bGwpCiAgICAgICAgICAgICAgICB1bnEgPSBma3NbaV07CiAgICAg\nICAgfQogICAgICAgIHJldHVybiAoY291bnQgPT0gMSkgPyB1bnEgOiBudWxs\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGV4aXN0aW5nIHVuaXF1ZSBj\nb25zdHJhaW50cyBhbmQgaW5kZXhlcyB0byB0aGUgZ2l2ZW4gZmllbGQncyBq\nb2luLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRKb2luQ29uc3RyYWlu\ndHMoRmllbGRNYXBwaW5nIGZpZWxkKSB7CiAgICAgICAgRm9yZWlnbktleSBm\nayA9IGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZr\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgSW5kZXgg\naWR4ID0gZmluZEluZGV4KGZrLmdldENvbHVtbnMoKSk7CiAgICAgICAgaWYg\nKGlkeCAhPSBudWxsKQogICAgICAgICAgICBmaWVsZC5zZXRKb2luSW5kZXgo\naWR4KTsKICAgICAgICBVbmlxdWUgdW5xID0gZmluZFVuaXF1ZShmay5nZXRD\nb2x1bW5zKCkpOwogICAgICAgIGlmICh1bnEgIT0gbnVsbCkKICAgICAgICAg\nICAgZmllbGQuc2V0Sm9pblVuaXF1ZSh1bnEpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIGV4aXN0aW5nIHVuaXF1ZSBjb25zdHJhaW50cyBhbmQgaW5k\nZXhlcyB0byB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFkZENvbnN0cmFpbnRzKFZhbHVlTWFwcGluZyB2bSkgewogICAgICAg\nIENvbHVtbltdIGNvbHMgPSAodm0uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwp\nCiAgICAgICAgICAgID8gdm0uZ2V0Rm9yZWlnbktleSgpLmdldENvbHVtbnMo\nKSA6IHZtLmdldENvbHVtbnMoKTsKICAgICAgICBJbmRleCBpZHggPSBmaW5k\nSW5kZXgoY29scyk7CiAgICAgICAgaWYgKGlkeCAhPSBudWxsKQogICAgICAg\nICAgICB2bS5zZXRWYWx1ZUluZGV4KGlkeCk7CiAgICAgICAgVW5pcXVlIHVu\ncSA9IGZpbmRVbmlxdWUoY29scyk7CiAgICAgICAgaWYgKHVucSAhPSBudWxs\nKQogICAgICAgICAgICB2bS5zZXRWYWx1ZVVuaXF1ZSh1bnEpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBpbmRleCB3aXRoIHRoZSBnaXZl\nbiBjb2x1bW5zLgogICAgICovCiAgICBwcml2YXRlIEluZGV4IGZpbmRJbmRl\neChDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8\nfCBjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgVGFibGUgdGFibGUgPSBjb2xzWzBdLmdldFRhYmxlKCk7CiAg\nICAgICAgSW5kZXhbXSBpZHhzID0gdGFibGUuZ2V0SW5kZXhlcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWR4cy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKGlkeHNbaV0uY29sdW1uc01hdGNoKGNvbHMpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGlkeHNbaV07CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHVuaXF1ZSBj\nb25zdHJpYW50IHdpdGggdGhlIGdpdmVuIGNvbHVtbnMuCiAgICAgKi8KICAg\nIHByaXZhdGUgVW5pcXVlIGZpbmRVbmlxdWUoQ29sdW1uW10gY29scykgewog\nICAgICAgIGlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFRhYmxlIHRhYmxl\nID0gY29sc1swXS5nZXRUYWJsZSgpOwogICAgICAgIFVuaXF1ZVtdIHVucXMg\nPSB0YWJsZS5nZXRVbmlxdWVzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCB1bnFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAodW5xc1tp\nXS5jb2x1bW5zTWF0Y2goY29scykpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndW5xc1tpXTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8K\nCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiB0YWJs\nZSBpcyBhIGJhc2UgY2xhc3MgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGlzQmFzZVRhYmxlKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgaWYg\nKHRhYmxlLmdldFByaW1hcnlLZXkoKSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaW50IHR5cGUgPSBnZXRTZWNvbmRhcnlU\neXBlKHRhYmxlLCB0cnVlKTsKICAgICAgICBpZiAodHlwZSAhPSAtMSkKICAg\nICAgICAgICAgcmV0dXJuIHR5cGUgPT0gVEFCTEVfQkFTRTsKICAgICAgICBp\nZiAoX2N1c3RvbSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2N1c3Rv\nbS5nZXRUYWJsZVR5cGUodGFibGUsIFRBQkxFX0JBU0UpID09IFRBQkxFX0JB\nU0U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDYWxjdWxhdGUgdGhlIHR5cGUgb2YgdGhlIHNlY29uZGFyeSBnaXZlbiB0\nYWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0U2Vjb25kYXJ5VHlw\nZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBtYXliZUJhc2UpIHsKICAgICAgICBp\nbnQgdHlwZTsKICAgICAgICBGb3JlaWduS2V5W10gZmtzID0gdGFibGUuZ2V0\nRm9yZWlnbktleXMoKTsKICAgICAgICBpZiAoZmtzLmxlbmd0aCA9PSAyCiAg\nICAgICAgICAgICYmICh0YWJsZS5nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbCB8\nfCBfcGtPbkpvaW4pCiAgICAgICAgICAgICYmIGZrc1swXS5nZXRDb2x1bW5z\nKCkubGVuZ3RoICsgZmtzWzFdLmdldENvbHVtbnMoKS5sZW5ndGgKICAgICAg\nICAgICAgPT0gdGFibGUuZ2V0Q29sdW1ucygpLmxlbmd0aAogICAgICAgICAg\nICAmJiAoIWlzVW5pcXVlKGZrc1swXSkgfHwgIWlzVW5pcXVlKGZrc1sxXSkp\nKQogICAgICAgICAgICB0eXBlID0gVEFCTEVfQVNTT0NJQVRJT047CiAgICAg\nICAgZWxzZSBpZiAobWF5YmVCYXNlICYmIHRhYmxlLmdldFByaW1hcnlLZXko\nKSAhPSBudWxsKQogICAgICAgICAgICB0eXBlID0gLTE7CiAgICAgICAgZWxz\nZSBpZiAoZ2V0VW5pcXVlRm9yZWlnbktleSh0YWJsZSkgIT0gbnVsbCkKICAg\nICAgICAgICAgdHlwZSA9IFRBQkxFX1NFQ09OREFSWTsKICAgICAgICBlbHNl\nIGlmIChma3MubGVuZ3RoID09IDEpCiAgICAgICAgICAgIHR5cGUgPSBUQUJM\nRV9OT05FOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdHlwZSA9IC0xOwoK\nICAgICAgICBpZiAoX2N1c3RvbSAhPSBudWxsICYmIHR5cGUgIT0gLTEpCiAg\nICAgICAgICAgIHR5cGUgPSBfY3VzdG9tLmdldFRhYmxlVHlwZSh0YWJsZSwg\ndHlwZSk7CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBdHRlbXB0IHRvIGNyZWF0ZSBhIGJhc2UgY2xhc3MgZnJvbSB0aGUg\nZ2l2ZW4gdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtYXBCYXNl\nQ2xhc3MoVGFibGUgdGFibGUpIHsKICAgICAgICBDbGFzc01hcHBpbmcgY2xz\nID0gbmV3Q2xhc3NNYXBwaW5nKHRhYmxlLCBudWxsKTsKICAgICAgICBpZiAo\nY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\nY2hlY2sgZm9yIGRhdGFzdG9yZSBpZGVudGl0eSBhbmQgYnVpbHRpbiBpZGVu\ndGl0eTsgZm9yIG5vdwogICAgICAgIC8vIHdlIGFzc3VtZSB0aGF0IGFueSBu\nb24tZGF0YXN0b3JlIHNpbmdsZSBwcmltYXJ5IGtleSBjb2x1bW4gd2lsbCB1\nc2UKICAgICAgICAvLyBidWlsdGluIGlkZW50aXR5OyBpZiB3ZSBkaXNjb3Zl\nciB0aGF0IHRoZSBwcmltYXJ5IGtleSBmaWVsZCBpcwogICAgICAgIC8vIG5v\ndCBjb21wYXRpYmxlIHdpdGggYnVpbHRpbiBpZGVudGl0eSBsYXRlciwgdGhl\nbiB3ZSdsbCBhc3NpZ24KICAgICAgICAvLyBhbiBhcHBsaWNhdGlvbiBpZGVu\ndGl0eSBjbGFzcwogICAgICAgIENvbHVtbltdIHBrcyA9IHRhYmxlLmdldFBy\naW1hcnlLZXkoKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgY2xzLnNldFByaW1h\ncnlLZXlDb2x1bW5zKHBrcyk7CiAgICAgICAgaWYgKHBrcy5sZW5ndGggPT0g\nMSAmJiBfZGF0YXN0b3JlCiAgICAgICAgICAgICYmIHBrc1swXS5pc0NvbXBh\ndGlibGUoVHlwZXMuQklHSU5ULCAwKSkgewogICAgICAgICAgICBjbHMuc2V0\nT2JqZWN0SWRUeXBlKG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgY2xzLnNl\ndElkZW50aXR5VHlwZShDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFKTsKICAg\nICAgICB9IGVsc2UgaWYgKHBrcy5sZW5ndGggPT0gMSAmJiBfYnVpbHRpbikK\nICAgICAgICAgICAgY2xzLnNldE9iamVjdElkVHlwZShudWxsLCBmYWxzZSk7\nCiAgICAgICAgY2xzLnNldFN0cmF0ZWd5KG5ldyBGdWxsQ2xhc3NTdHJhdGVn\neSgpLCBudWxsKTsKICAgICAgICBpZiAoX2N1c3RvbSAhPSBudWxsKQogICAg\nICAgICAgICBfY3VzdG9tLmN1c3RvbWl6ZShjbHMpOwogICAgfQoKICAgIC8q\nKgogICAgICogQXR0ZW1wdCB0byBjcmVhdGUgYSB2ZXJ0aWNhbCBzdWJjbGFz\nc2VzIGZyb20gdGhlIGdpdmVuIHRhYmxlcy4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIG1hcFN1YmNsYXNzZXMoU2V0IHRhYmxlcykgewogICAgICAgIC8v\nIGxvb3AgdGhyb3VnaCB0YWJsZXMgdW50aWwgZWl0aGVyIGFsbCBhcmUgbWFw\ncGVkIG9yIG5vbmUgbGluayB0bwogICAgICAgIC8vIGEgbWFwcGVkIGJhc2Ug\nY2xhc3MgdGFibGUKICAgICAgICBDbGFzc01hcHBpbmcgYmFzZSwgc3ViOwog\nICAgICAgIFRhYmxlIHRhYmxlID0gbnVsbDsKICAgICAgICBGb3JlaWduS2V5\nIGZrID0gbnVsbDsKICAgICAgICB3aGlsZSAoIXRhYmxlcy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgLy8gZmluZCBhIHRhYmxlIHdpdGggYSBmb3JlaWdu\nIGtleSBsaW5raW5nIHRvIGEgbWFwcGVkIHRhYmxlCiAgICAgICAgICAgIGJh\nc2UgPSBudWxsOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRh\nYmxlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgdGFibGUgPSAoVGFibGUpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBmayA9IGdldFVuaXF1ZUZvcmVpZ25LZXkodGFibGUpOwogICAgICAg\nICAgICAgICAgaWYgKGZrID09IG51bGwgJiYgdGFibGUuZ2V0Rm9yZWlnbktl\neXMoKS5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgICAgICBmayA9IHRh\nYmxlLmdldEZvcmVpZ25LZXlzKClbMF07CiAgICAgICAgICAgICAgICBlbHNl\nIGlmIChmayA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGl0ci5yZW1v\ndmUoKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIGJhc2UgPSAoQ2xhc3NNYXBwaW5nKSBfdGFibGVzLmdldChmay5nZXRQ\ncmltYXJ5S2V5VGFibGUoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJh\nc2UgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpdHIucmVt\nb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICAvLyBpZiBubyB0YWJsZXMgbGluayB0byBhIGJhc2Ug\ndGFibGUsIG5vdGhpbmcgbGVmdCB0byBkbwogICAgICAgICAgICBpZiAoYmFz\nZSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAg\nICAgc3ViID0gbmV3Q2xhc3NNYXBwaW5nKHRhYmxlLCBiYXNlLmdldERlc2Ny\naWJlZFR5cGUoKSk7CiAgICAgICAgICAgIHN1Yi5zZXRKb2luRm9yZWlnbktl\neShmayk7CiAgICAgICAgICAgIHN1Yi5zZXRQcmltYXJ5S2V5Q29sdW1ucyhm\nay5nZXRDb2x1bW5zKCkpOwogICAgICAgICAgICBzdWIuc2V0SWRlbnRpdHlU\neXBlKGJhc2UuZ2V0SWRlbnRpdHlUeXBlKCkpOwogICAgICAgICAgICBzdWIu\nc2V0U3RyYXRlZ3kobmV3IFZlcnRpY2FsQ2xhc3NTdHJhdGVneSgpLCBudWxs\nKTsKICAgICAgICAgICAgaWYgKF9jdXN0b20gIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9jdXN0b20uY3VzdG9taXplKHN1Yik7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQXR0ZW1wdCB0byByZXZlcnNlIG1hcCB0aGUg\nZ2l2ZW4gdGFibGUgYXMgYW4gYXNzb2NpYXRpb24gdGFibGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBtYXBBc3NvY2lhdGlvblRhYmxlKFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlLmdldEZv\ncmVpZ25LZXlzKCk7CiAgICAgICAgaWYgKGZrcy5sZW5ndGggIT0gMikKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFzc01hcHBpbmcgY2xzMSA9\nIChDbGFzc01hcHBpbmcpIF90YWJsZXMuZ2V0CiAgICAgICAgICAgIChma3Nb\nMF0uZ2V0UHJpbWFyeUtleVRhYmxlKCkpOwogICAgICAgIENsYXNzTWFwcGlu\nZyBjbHMyID0gKENsYXNzTWFwcGluZykgX3RhYmxlcy5nZXQKICAgICAgICAg\nICAgKGZrc1sxXS5nZXRQcmltYXJ5S2V5VGFibGUoKSk7CiAgICAgICAgaWYg\nKGNsczEgPT0gbnVsbCB8fCBjbHMyID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgLy8gYWRkIGEgcmVsYXRpb24gZnJvbSBlYWNoIGNs\nYXNzIHRvIHRoZSBvdGhlciB0aHJvdWdoIHRoZQogICAgICAgIC8vIGFzc29j\naWF0aW9uIHRhYmxlCiAgICAgICAgU3RyaW5nIG5hbWUgPSBnZXRSZWxhdGlv\nbk5hbWUoY2xzMi5nZXREZXNjcmliZWRUeXBlKCksIHRydWUsIGZrc1sxXSwK\nICAgICAgICAgICAgZmFsc2UsIGNsczEpOwogICAgICAgIEZpZWxkTWFwcGlu\nZyBmaWVsZDEgPSBuZXdGaWVsZE1hcHBpbmcobmFtZSwgU2V0LmNsYXNzLCBu\ndWxsLCBma3NbMV0sCiAgICAgICAgICAgIGNsczEpOwogICAgICAgIGlmIChm\naWVsZDEgIT0gbnVsbCkgewogICAgICAgICAgICBmaWVsZDEuc2V0Sm9pbkZv\ncmVpZ25LZXkoZmtzWzBdKTsKICAgICAgICAgICAgYWRkSm9pbkNvbnN0cmFp\nbnRzKGZpZWxkMSk7CiAgICAgICAgICAgIFZhbHVlTWFwcGluZyB2bSA9IGZp\nZWxkMS5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgICAgICB2bS5zZXRE\nZWNsYXJlZFR5cGUoY2xzMi5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAg\nICAgICB2bS5zZXRGb3JlaWduS2V5KGZrc1sxXSk7CiAgICAgICAgICAgIGFk\nZENvbnN0cmFpbnRzKHZtKTsKICAgICAgICAgICAgZmllbGQxLnNldFN0cmF0\nZWd5KG5ldyBSZWxhdGlvbkNvbGxlY3Rpb25UYWJsZUZpZWxkU3RyYXRlZ3ko\nKSwKICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgICAgICBpZiAoX2N1\nc3RvbSAhPSBudWxsKQogICAgICAgICAgICAgICAgX2N1c3RvbS5jdXN0b21p\nemUoZmllbGQxKTsKICAgICAgICB9CgogICAgICAgIG5hbWUgPSBnZXRSZWxh\ndGlvbk5hbWUoY2xzMS5nZXREZXNjcmliZWRUeXBlKCksIHRydWUsIGZrc1sw\nXSwKICAgICAgICAgICAgZmFsc2UsIGNsczIpOwogICAgICAgIEZpZWxkTWFw\ncGluZyBmaWVsZDIgPSBuZXdGaWVsZE1hcHBpbmcobmFtZSwgU2V0LmNsYXNz\nLCBudWxsLCBma3NbMF0sCiAgICAgICAgICAgIGNsczIpOwogICAgICAgIGlm\nIChmaWVsZDIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBmaWVsZDIuc2V0Sm9pbkZvcmVpZ25LZXkoZmtzWzFdKTsKICAgICAgICBh\nZGRKb2luQ29uc3RyYWludHMoZmllbGQyKTsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgdm0gPSBmaWVsZDIuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICB2\nbS5zZXREZWNsYXJlZFR5cGUoY2xzMS5nZXREZXNjcmliZWRUeXBlKCkpOwog\nICAgICAgIHZtLnNldEZvcmVpZ25LZXkoZmtzWzBdKTsKICAgICAgICBhZGRD\nb25zdHJhaW50cyh2bSk7CiAgICAgICAgaWYgKGZpZWxkMSAhPSBudWxsICYm\nIGZpZWxkMS5nZXRNYXBwZWRCeSgpID09IG51bGwpCiAgICAgICAgICAgIGZp\nZWxkMi5zZXRNYXBwZWRCeShmaWVsZDEuZ2V0TmFtZSgpKTsKICAgICAgICBm\naWVsZDIuc2V0U3RyYXRlZ3kobmV3IFJlbGF0aW9uQ29sbGVjdGlvblRhYmxl\nRmllbGRTdHJhdGVneSgpLCBudWxsKTsKICAgICAgICBpZiAoX2N1c3RvbSAh\nPSBudWxsKQogICAgICAgICAgICBfY3VzdG9tLmN1c3RvbWl6ZShmaWVsZDIp\nOwogICAgfQoKICAgIC8qKgogICAgICogQXR0ZW1wdCB0byByZXZlcnNlIG1h\ncCB0aGUgZ2l2ZW4gdGFibGUgYXMgYSBzZWNvbmRhcnkgdGFibGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBtYXBTZWNvbmRhcnlUYWJsZShUYWJsZSB0\nYWJsZSwgYm9vbGVhbiBvdXRlcikgewogICAgICAgIEZvcmVpZ25LZXkgZmsg\nPSBnZXRVbmlxdWVGb3JlaWduS2V5KHRhYmxlKTsKICAgICAgICBpZiAoZmsg\nPT0gbnVsbCAmJiB0YWJsZS5nZXRGb3JlaWduS2V5cygpLmxlbmd0aCA9PSAx\nKQogICAgICAgICAgICBmayA9IHRhYmxlLmdldEZvcmVpZ25LZXlzKClbMF07\nCiAgICAgICAgZWxzZSBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSAoQ2xhc3NNYXBwaW5n\nKSBfdGFibGVzLmdldChmay5nZXRQcmltYXJ5S2V5VGFibGUoKSk7CiAgICAg\nICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgbWFwQ29sdW1ucyhjbHMsIHRhYmxlLCBmaywgb3V0ZXIpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWFwIHRoZSBjb2x1bW5zIG9mIHRoZSBnaXZlbiB0\nYWJsZSB0byBmaWVsZHMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBtYXBDb2x1bW5zKENsYXNzTWFwcGluZyBjbHMsIFRh\nYmxlIHRhYmxlLCBGb3JlaWduS2V5IGpvaW4sCiAgICAgICAgYm9vbGVhbiBv\ndXRlcikgewogICAgICAgIC8vIGZpcnN0IG1hcCBmb3JlaWduIGtleXMgdG8g\ncmVsYXRpb25zCiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlLmdl\ndEZvcmVpZ25LZXlzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\na3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChma3NbaV0gIT0gam9p\nbiAmJiBma3NbaV0gIT0gY2xzLmdldEpvaW5Gb3JlaWduS2V5KCkpCiAgICAg\nICAgICAgICAgICBtYXBGb3JlaWduS2V5KGNscywgZmtzW2ldLCBqb2luLCBv\ndXRlcik7CgogICAgICAgIC8vIG1hcCBhbnkgY29sdW1ucyBub3QgY29udHJv\nbGxlZCBieSBmb3JlaWduIGtleXM7IGFsc28gZm9yY2UgcHJpbWFyeQogICAg\nICAgIC8vIGtleSBjb2xzIHRvIGdldCBtYXBwZWQgdG8gc2ltcGxlIGZpZWxk\ncyBldmVuIGlmIHRoZSBjb2x1bW5zIGFyZQogICAgICAgIC8vIGFsc28gZm9y\nZWlnbiBrZXkgY29sdW1ucwogICAgICAgIFByaW1hcnlLZXkgcGsgPSAoam9p\nbiAhPSBudWxsKSA/IG51bGwgOiB0YWJsZS5nZXRQcmltYXJ5S2V5KCk7CiAg\nICAgICAgYm9vbGVhbiBwa2NvbDsKICAgICAgICBDb2x1bW5bXSBjb2xzID0g\ndGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwa2NvbCA9IHBr\nICE9IG51bGwgJiYgcGsuY29udGFpbnNDb2x1bW4oY29sc1tpXSk7CiAgICAg\nICAgICAgIGlmIChwa2NvbCAmJiBjbHMuZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nQ2xhc3NNYXBwaW5nLklEX0RBVEFTVE9SRSkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICBpZiAoKGNscy5nZXRQQ1N1cGVyY2xhc3Mo\nKSA9PSBudWxsICYmIHBrY29sKQogICAgICAgICAgICAgICAgfHwgIWlzRm9y\nZWlnbktleUNvbHVtbihjb2xzW2ldKSkKICAgICAgICAgICAgICAgIG1hcENv\nbHVtbihjbHMsIGNvbHNbaV0sIGpvaW4sIG91dGVyKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBnaXZlbiBjb2x1bW4g\nYXBwZWFycyBpbiBhbnkgZm9yZWlnbiBrZXlzLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBib29sZWFuIGlzRm9yZWlnbktleUNvbHVtbihDb2x1bW4g\nY29sKSB7CiAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IGNvbC5nZXRUYWJs\nZSgpLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBma3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChma3NbaV0u\nY29udGFpbnNDb2x1bW4oY29sKSkKICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE1hcCBhIGZvcmVpZ24ga2V5IHRvIGEgcmVsYXRpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBtYXBGb3JlaWduS2V5KENsYXNzTWFwcGluZyBj\nbHMsIEZvcmVpZ25LZXkgZmssCiAgICAgICAgRm9yZWlnbktleSBqb2luLCBi\nb29sZWFuIG91dGVyKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbCA9IChD\nbGFzc01hcHBpbmcpIF90YWJsZXMuZ2V0KGZrLmdldFByaW1hcnlLZXlUYWJs\nZSgpKTsKICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgU3RyaW5nIG5hbWUgPSBnZXRSZWxhdGlvbk5hbWUo\ncmVsLmdldERlc2NyaWJlZFR5cGUoKSwgZmFsc2UsIGZrLAogICAgICAgICAg\nICBmYWxzZSwgY2xzKTsKICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQxID0g\nbmV3RmllbGRNYXBwaW5nKG5hbWUsIHJlbC5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgIG51bGwsIGZrLCBjbHMpOwogICAgICAgIGlmIChmaWVs\nZDEgIT0gbnVsbCkgewogICAgICAgICAgICBmaWVsZDEuc2V0Sm9pbkZvcmVp\nZ25LZXkoam9pbik7CiAgICAgICAgICAgIGZpZWxkMS5zZXRKb2luT3V0ZXIo\nb3V0ZXIpOwogICAgICAgICAgICBhZGRKb2luQ29uc3RyYWludHMoZmllbGQx\nKTsKICAgICAgICAgICAgZmllbGQxLnNldEZvcmVpZ25LZXkoZmspOwogICAg\nICAgICAgICBhZGRDb25zdHJhaW50cyhmaWVsZDEpOwogICAgICAgICAgICBm\naWVsZDEuc2V0U3RyYXRlZ3kobmV3IFJlbGF0aW9uRmllbGRTdHJhdGVneSgp\nLCBudWxsKTsKICAgICAgICAgICAgaWYgKF9jdXN0b20gIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9jdXN0b20uY3VzdG9taXplKGZpZWxkMSk7CiAgICAg\nICAgfQogICAgICAgIGlmICghX2ludmVyc2UgfHwgam9pbiAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGNyZWF0ZSBpbnZlcnNl\nIHJlbGF0aW9uCiAgICAgICAgYm9vbGVhbiB1bnEgPSBpc1VuaXF1ZShmayk7\nCiAgICAgICAgbmFtZSA9IGdldFJlbGF0aW9uTmFtZShjbHMuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLCAhdW5xLCBmaywgdHJ1ZSwgcmVsKTsKICAgICAgICBDbGFz\ncyB0eXBlID0gKHVucSkgPyBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpIDogU2V0\nLmNsYXNzOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZDIgPSBuZXdGaWVs\nZE1hcHBpbmcobmFtZSwgdHlwZSwgbnVsbCwgZmssIHJlbCk7CiAgICAgICAg\naWYgKGZpZWxkMiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgaWYgKGZpZWxkMSAhPSBudWxsKQogICAgICAgICAgICBmaWVsZDIuc2V0\nTWFwcGVkQnkoZmllbGQxLmdldE5hbWUoKSk7CiAgICAgICAgaWYgKHVucSkg\newogICAgICAgICAgICBmaWVsZDIuc2V0Rm9yZWlnbktleShmayk7CiAgICAg\nICAgICAgIGZpZWxkMi5zZXRKb2luRGlyZWN0aW9uKGZpZWxkMi5KT0lOX0lO\nVkVSU0UpOwogICAgICAgICAgICBmaWVsZDIuc2V0U3RyYXRlZ3kobmV3IFJl\nbGF0aW9uRmllbGRTdHJhdGVneSgpLCBudWxsKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBWYWx1ZU1hcHBpbmcgdm0gPSBmaWVsZDIuZ2V0RWxl\nbWVudE1hcHBpbmcoKTsKICAgICAgICAgICAgdm0uc2V0RGVjbGFyZWRUeXBl\nKGNscy5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICB2bS5zZXRG\nb3JlaWduS2V5KGZrKTsKICAgICAgICAgICAgdm0uc2V0Sm9pbkRpcmVjdGlv\nbih2bS5KT0lOX0VYUEVDVEVEX0lOVkVSU0UpOwogICAgICAgICAgICBmaWVs\nZDIuc2V0U3RyYXRlZ3kobmV3IFJlbGF0aW9uQ29sbGVjdGlvbkludmVyc2VL\nZXlGaWVsZFN0cmF0ZWd5KCksCiAgICAgICAgICAgICAgICBudWxsKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKF9jdXN0b20gIT0gbnVsbCkKICAgICAgICAg\nICAgX2N1c3RvbS5jdXN0b21pemUoZmllbGQyKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1hcCBhIGNvbHVtbiB0byBhIHNpbXBsZSBmaWVsZC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIG1hcENvbHVtbihDbGFzc01hcHBpbmcgY2xz\nLCBDb2x1bW4gY29sLCBGb3JlaWduS2V5IGpvaW4sCiAgICAgICAgYm9vbGVh\nbiBvdXRlcikgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RmllbGROYW1l\nKGNvbC5nZXROYW1lKCksIGNscyk7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGdl\ndEZpZWxkVHlwZShjb2wsIGZhbHNlKTsKICAgICAgICBGaWVsZE1hcHBpbmcg\nZmllbGQgPSBuZXdGaWVsZE1hcHBpbmcobmFtZSwgdHlwZSwgY29sLCBudWxs\nLCBjbHMpOwogICAgICAgIGZpZWxkLnNldFNlcmlhbGl6ZWQodHlwZSA9PSBP\nYmplY3QuY2xhc3MpOwogICAgICAgIGZpZWxkLnNldEpvaW5Gb3JlaWduS2V5\nKGpvaW4pOwogICAgICAgIGZpZWxkLnNldEpvaW5PdXRlcihvdXRlcik7CiAg\nICAgICAgYWRkSm9pbkNvbnN0cmFpbnRzKGZpZWxkKTsKICAgICAgICBmaWVs\nZC5zZXRDb2x1bW5zKG5ldyBDb2x1bW5bXXsgY29sIH0pOwogICAgICAgIGFk\nZENvbnN0cmFpbnRzKGZpZWxkKTsKICAgICAgICBpZiAoY29sLmlzUHJpbWFy\neUtleSgpCiAgICAgICAgICAgICYmIGNscy5nZXRJZGVudGl0eVR5cGUoKSAh\nPSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFKQogICAgICAgICAgICBmaWVs\nZC5zZXRQcmltYXJ5S2V5KHRydWUpOwoKICAgICAgICBGaWVsZFN0cmF0ZWd5\nIHN0cmF0OwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAg\nICAgICAgIHN0cmF0ID0gbmV3IFByaW1pdGl2ZUZpZWxkU3RyYXRlZ3koKTsK\nICAgICAgICBlbHNlIGlmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkNMT0IK\nICAgICAgICAgICAgJiYgX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2Uo\nKS5tYXhFbWJlZGRlZENsb2JTaXplICE9IC0xKQogICAgICAgICAgICBzdHJh\ndCA9IG5ldyBNYXhFbWJlZGRlZENsb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICAg\nICAgZWxzZSBpZiAoY29sLmlzTG9iKCkKICAgICAgICAgICAgJiYgX2NvbmYu\nZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKS5tYXhFbWJlZGRlZEJsb2JTaXpl\nICE9IC0xKQogICAgICAgICAgICBzdHJhdCA9IG5ldyBNYXhFbWJlZGRlZEJs\nb2JGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgZWxzZSBpZiAodHlwZSA9PSBT\ndHJpbmcuY2xhc3MpCiAgICAgICAgICAgIHN0cmF0ID0gbmV3IFN0cmluZ0Zp\nZWxkU3RyYXRlZ3koKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0cmF0\nID0gbmV3IEhhbmRsZXJGaWVsZFN0cmF0ZWd5KCk7CiAgICAgICAgZmllbGQu\nc2V0U3RyYXRlZ3koc3RyYXQsIG51bGwpOwogICAgICAgIGlmIChfY3VzdG9t\nICE9IG51bGwpCiAgICAgICAgICAgIF9jdXN0b20uY3VzdG9taXplKGZpZWxk\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGNsYXNzIG1hcHBp\nbmcgZm9yIHRoZSBnaXZlbiB0YWJsZSwgb3IgcmV0dXJuIG51bGwgaWYKICAg\nICAqIGN1c3RvbWl6ZXIgcmVqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBD\nbGFzc01hcHBpbmcgbmV3Q2xhc3NNYXBwaW5nKFRhYmxlIHRhYmxlLCBDbGFz\ncyBwYXJlbnQpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGdldENsYXNzTmFt\nZSh0YWJsZSk7CiAgICAgICAgaWYgKF9jdXN0b20gIT0gbnVsbCkKICAgICAg\nICAgICAgbmFtZSA9IF9jdXN0b20uZ2V0Q2xhc3NOYW1lKHRhYmxlLCBuYW1l\nKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gbmV3Q2xhc3NNYXBwaW5nKGdlbmVy\nYXRlQ2xhc3MobmFtZSwgcGFyZW50KSwgdGFibGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgZmllbGQgbWFwcGluZyBmb3IgdGhlIGdpdmVu\nIGluZm8sIG9yIHJldHVybiBudWxsIGlmCiAgICAgKiBjdXN0b21pemVyIHJl\namVjdHMuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgbmV3Rmll\nbGRNYXBwaW5nKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBlLCBDb2x1bW4gY29s\nLAogICAgICAgIEZvcmVpZ25LZXkgZmssIENsYXNzTWFwcGluZyBkZWMpIHsK\nICAgICAgICBpZiAoX2N1c3RvbSAhPSBudWxsKSB7CiAgICAgICAgICAgIENv\nbHVtbltdIGNvbHMgPSAoZmsgPT0gbnVsbCkgPyBuZXcgQ29sdW1uW117IGNv\nbCB9CiAgICAgICAgICAgICAgICA6IGZrLmdldENvbHVtbnMoKTsKICAgICAg\nICAgICAgU3RyaW5nIG5ld05hbWUgPSBfY3VzdG9tLmdldEZpZWxkTmFtZShk\nZWMsIGNvbHMsIGZrLCBuYW1lKTsKICAgICAgICAgICAgaWYgKG5ld05hbWUg\nPT0gbnVsbCB8fCAhbmV3TmFtZS5lcXVhbHMobmFtZSkpIHsKICAgICAgICAg\nICAgICAgIGlmIChfYWJhbmRvbmVkRmllbGROYW1lcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9hYmFuZG9uZWRGaWVsZE5hbWVzID0gbmV3IEhh\nc2hTZXQoKTsKICAgICAgICAgICAgICAgIF9hYmFuZG9uZWRGaWVsZE5hbWVz\nLmFkZChkZWMuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKQogICAgICAg\nICAgICAgICAgICAgICsgIi4iICsgbmFtZSk7CiAgICAgICAgICAgICAgICBp\nZiAobmV3TmFtZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgICAgICAgICAgbmFtZSA9IG5ld05hbWU7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEZpZWxkTWFwcGluZyBmaWVs\nZCA9IGRlYy5hZGREZWNsYXJlZEZpZWxkTWFwcGluZyhuYW1lLCB0eXBlKTsK\nICAgICAgICBmaWVsZC5zZXRFeHBsaWNpdCh0cnVlKTsKICAgICAgICByZXR1\ncm4gZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBKYXZh\nIGlkZW50aWZpZXItZm9ybWF0dGVkIG5hbWUgZm9yIHRoZSBnaXZlbiB0YWJs\nZQogICAgICogbmFtZSwgdXNpbmcgdGhlIGRlZmF1bHQgcGFja2FnZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q2xhc3NOYW1lKFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdC\ndWZmZXIoKTsKICAgICAgICBpZiAoZ2V0UGFja2FnZU5hbWUoKSAhPSBudWxs\nKQogICAgICAgICAgICBidWYuYXBwZW5kKGdldFBhY2thZ2VOYW1lKCkpLmFw\ncGVuZCgiLiIpOwoKICAgICAgICBTdHJpbmdbXSBzdWJzOwogICAgICAgIFN0\ncmluZyBuYW1lID0gcmVwbGFjZUludmFsaWRDaGFyYWN0ZXJzKHRhYmxlLmdl\ndFNjaGVtYU5hbWUoKSk7CiAgICAgICAgaWYgKF91c2VTY2hlbWEgJiYgbmFt\nZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChhbGxVcHBlckNhc2UobmFt\nZSkpCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgp\nOwogICAgICAgICAgICBzdWJzID0gU3RyaW5ncy5zcGxpdChuYW1lLCAiXyIs\nIDApOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKFN0cmluZ1V0\naWxzLmNhcGl0YWxpc2Uoc3Vic1tpXSkpOwogICAgICAgIH0KCiAgICAgICAg\nbmFtZSA9IHJlcGxhY2VJbnZhbGlkQ2hhcmFjdGVycyh0YWJsZS5nZXROYW1l\nKCkpOwogICAgICAgIGlmIChhbGxVcHBlckNhc2UobmFtZSkpCiAgICAgICAg\nICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgc3VicyA9\nIFN0cmluZ3Muc3BsaXQobmFtZSwgIl8iLCAwKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nLy8gbWFrZSBzdXJlIHRoZSBuYW1lIGNhbid0IGNvbmZsaWN0IHdpdGggZ2Vu\nZXJhdGVkIGlkIGNsYXNzIG5hbWVzOwogICAgICAgICAgICAvLyBpZiB0aGUg\nbmFtZSB3b3VsZCBlbmQgaW4gJ0lkJywgbWFrZSBpdCBlbmQgaW4gJ0lkZW50\nJwogICAgICAgICAgICBpZiAoaSA9PSBzdWJzLmxlbmd0aCAtIDEgJiYgc3Vi\nc1tpXS5lcXVhbHNJZ25vcmVDYXNlKCJpZCIpKQogICAgICAgICAgICAgICAg\nc3Vic1tpXSA9ICJpZGVudCI7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoU3Ry\naW5nVXRpbHMuY2FwaXRhbGlzZShzdWJzW2ldKSk7CiAgICAgICAgfQoKICAg\nICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBkZWZhdWx0IEphdmEgaWRlbnRpZmllci1mb3JtYXR0\nZWQgbmFtZSBmb3IgdGhlIGdpdmVuCiAgICAgKiBjb2x1bW4vdGFibGUgbmFt\nZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGaWVsZE5hbWUoU3Ry\naW5nIG5hbWUsIENsYXNzTWFwcGluZyBkZWMpIHsKICAgICAgICBuYW1lID0g\ncmVwbGFjZUludmFsaWRDaGFyYWN0ZXJzKG5hbWUpOwogICAgICAgIGlmIChh\nbGxVcHBlckNhc2UobmFtZSkpCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnRv\nTG93ZXJDYXNlKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBuYW1lID0g\nQ2hhcmFjdGVyLnRvTG93ZXJDYXNlKG5hbWUuY2hhckF0KDApKSArIG5hbWUu\nc3Vic3RyaW5nKDEpOwoKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3\nIFN0cmluZ0J1ZmZlcigpOwogICAgICAgIFN0cmluZ1tdIHN1YnMgPSBTdHJp\nbmdzLnNwbGl0KG5hbWUsICJfIiwgMCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzdWJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChp\nID4gMCkKICAgICAgICAgICAgICAgIHN1YnNbaV0gPSBTdHJpbmdVdGlscy5j\nYXBpdGFsaXNlKHN1YnNbaV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKHN1\nYnNbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0VW5pcXVlTmFt\nZShidWYudG9TdHJpbmcoKSwgZGVjKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGRlZmF1bHQgamF2YSBpZGVudGlmaWVyLWZvcm1hdHRlZCBm\naWVsZCByZWxhdGlvbiBuYW1lCiAgICAgKiBmb3IgdGhlIGdpdmVuIGNsYXNz\nIG5hbWUuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldFJlbGF0aW9u\nTmFtZShDbGFzcyBmaWVsZFR5cGUsIGJvb2xlYW4gY29sbCwKICAgICAgICBG\nb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIENsYXNzTWFwcGluZyBk\nZWMpIHsKICAgICAgICBpZiAoX3VzZUZLICYmIGZrLmdldE5hbWUoKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RmllbGROYW1l\nKGZrLmdldE5hbWUoKSwgZGVjKTsKICAgICAgICAgICAgaWYgKGludmVyc2Ug\nJiYgY29sbCkKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgIkludmVy\nc2VzIjsKICAgICAgICAgICAgZWxzZSBpZiAoaW52ZXJzZSkKICAgICAgICAg\nICAgICAgIG5hbWUgPSBuYW1lICsgIkludmVyc2UiOwogICAgICAgICAgICBy\nZXR1cm4gZ2V0VW5pcXVlTmFtZShuYW1lLCBkZWMpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gZ2V0IGp1c3QgdGhlIGNsYXNzIG5hbWUsIHcvbyBwYWNrYWdl\nCiAgICAgICAgU3RyaW5nIG5hbWUgPSBmaWVsZFR5cGUuZ2V0TmFtZSgpOwog\nICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhuYW1lLmxhc3RJbmRleE9m\nKCcuJykgKyAxKTsKCiAgICAgICAgLy8gbWFrZSB0aGUgZmlyc3QgY2hhcmFj\ndGVyIGxvd2VyY2FzZSBhbmQgcGx1cmFsaXplIGlmIGEgY29sbGVjdGlvbgog\nICAgICAgIG5hbWUgPSBDaGFyYWN0ZXIudG9Mb3dlckNhc2UobmFtZS5jaGFy\nQXQoMCkpICsgbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgaWYgKGNvbGwg\nJiYgIW5hbWUuZW5kc1dpdGgoInMiKSkKICAgICAgICAgICAgbmFtZSArPSAi\ncyI7CgogICAgICAgIHJldHVybiBnZXRVbmlxdWVOYW1lKG5hbWUsIGRlYyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2\nZW4gc3RyaW5nIGlzIGFsbCB1cHBlcmNhc2UgbGV0dGVycy4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBhbGxVcHBlckNhc2UoU3RyaW5n\nIHN0cikgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RyLmxlbmd0\naCgpOyBpKyspIHsKICAgICAgICAgICAgaWYgKENoYXJhY3Rlci5pc0xldHRl\ncihzdHIuY2hhckF0KGkpKQogICAgICAgICAgICAgICAgJiYgIUNoYXJhY3Rl\nci5pc1VwcGVyQ2FzZShzdHIuY2hhckF0KGkpKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIGNoYXJhY3RlcnMgbm90\nIGFsbG93ZWQgaW4gSmF2YSBuYW1lcyB3aXRoIGFuIHVuZGVyc2NvcmU7CiAg\nICAgKiBwYWNrYWdlLXByaXZhdGUgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAg\nIHN0YXRpYyBTdHJpbmcgcmVwbGFjZUludmFsaWRDaGFyYWN0ZXJzKFN0cmlu\nZyBzdHIpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzdHIp\nKQogICAgICAgICAgICByZXR1cm4gc3RyOwoKICAgICAgICBTdHJpbmdCdWZm\nZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcihzdHIpOwogICAgICAgIGNoYXIg\nYzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJ1Zi5sZW5ndGgoKTsg\naSsrKSB7CiAgICAgICAgICAgIGMgPSBidWYuY2hhckF0KGkpOwogICAgICAg\nICAgICBpZiAoYyA9PSAnJCcgfHwgIUNoYXJhY3Rlci5pc0phdmFJZGVudGlm\naWVyUGFydChzdHIuY2hhckF0KGkpKSkKICAgICAgICAgICAgICAgIGJ1Zi5z\nZXRDaGFyQXQoaSwgJ18nKTsKICAgICAgICB9CgogICAgICAgIC8vIHN0cmlw\nIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHVuZGVyc2NvcmVzCiAgICAgICAgaW50\nIHN0YXJ0ID0gMDsKICAgICAgICB3aGlsZSAoc3RhcnQgPCBidWYubGVuZ3Ro\nKCkgJiYgYnVmLmNoYXJBdChzdGFydCkgPT0gJ18nKQogICAgICAgICAgICBz\ndGFydCsrOwogICAgICAgIGludCBlbmQgPSBidWYubGVuZ3RoKCkgLSAxOwog\nICAgICAgIHdoaWxlIChlbmQgPj0gMCAmJiBidWYuY2hhckF0KGVuZCkgPT0g\nJ18nKQogICAgICAgICAgICBlbmQtLTsKCiAgICAgICAgLy8gcG9zc2libGUg\ndGhhdCBhbGwgY2hhcnMgaW4gbmFtZSBhcmUgaW52YWxpZAogICAgICAgIGlm\nIChzdGFydCA+IGVuZCkKICAgICAgICAgICAgcmV0dXJuICJ4IjsKICAgICAg\nICByZXR1cm4gYnVmLnN1YnN0cmluZyhzdGFydCwgZW5kICsgMSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNb2RpZmllcyB0aGUgZ2l2ZW4gbmFtZSBhcyBu\nZWNlc3NhcnkgdG8gZW5zdXJlIHRoYXQgaXQgaXNuJ3QgYWxyZWFkeQogICAg\nICogdGFrZW4gYnkgYSBmaWVsZCBpbiB0aGUgZ2l2ZW4gcGFyZW50LgogICAg\nICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRVbmlxdWVOYW1lKFN0cmluZyBu\nYW1lLCBDbGFzc01hcHBpbmcgZGVjKSB7CiAgICAgICAgLy8gbWFrZSBzdXJl\nIHRoZSBuYW1lIGlzbid0IGEga2V5d29yZAogICAgICAgIGlmIChfamF2YUtl\neXdvcmRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAgICBuYW1lID0g\nKFN0cmluZykgX2phdmFLZXl3b3Jkcy5nZXQobmFtZSk7CgogICAgICAgIC8v\nIHRoaXMgaXMgdGhlIHNhbWUgYWxnb3JpdGhtIHVzZWQgaW4gREJEaWN0aW9u\nYXJ5IHRvIGdldCB1bmlxdWUgbmFtZXMKICAgICAgICBTdHJpbmcgcHJlZml4\nID0gZGVjLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkgKyAiLiI7CiAg\nICAgICAgZm9yIChpbnQgdmVyc2lvbiA9IDIsIGNoYXJzID0gMTsKICAgICAg\nICAgICAgZGVjLmdldERlY2xhcmVkRmllbGQobmFtZSkgIT0gbnVsbAogICAg\nICAgICAgICAgICAgfHwgKF9hYmFuZG9uZWRGaWVsZE5hbWVzICE9IG51bGwK\nICAgICAgICAgICAgICAgICYmIF9hYmFuZG9uZWRGaWVsZE5hbWVzLmNvbnRh\naW5zKHByZWZpeCArIG5hbWUpKTsgdmVyc2lvbisrKSB7CiAgICAgICAgICAg\nIGlmICh2ZXJzaW9uID4gMikKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1l\nLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCgpIC0gY2hhcnMpOwogICAgICAg\nICAgICBpZiAodmVyc2lvbiA+PSBNYXRoLnBvdygxMCwgY2hhcnMpKQogICAg\nICAgICAgICAgICAgY2hhcnMrKzsKICAgICAgICAgICAgbmFtZSA9IG5hbWUg\nKyB2ZXJzaW9uOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFtZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVmYXVsdCBmaWVsZCB0\neXBlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwdWJsaWMg\nQ2xhc3MgZ2V0RmllbGRUeXBlKENvbHVtbiBjb2wsIGJvb2xlYW4gZm9yY2VP\nYmplY3QpIHsKICAgICAgICAvLyBjaGVjayB0aGUgY3VzdG9tIHR5cGUgbWFw\nIHRvIHNlZSBpZiB3ZSd2ZSBvdmVycmlkZGVuIHRoZQogICAgICAgIC8vIGRl\nZmF1bHQgdHlwZSB0byBjcmVhdGUgZm9yIGEgcmF3IFNRTCB0eXBlIG5hbWUK\nICAgICAgICBDbGFzcyB0eXBlID0gbnVsbDsKICAgICAgICBpZiAoX3R5cGVN\nYXAgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBmaXJzdCB0cnkgIlRZUEUo\nU0laRSxERUNJTUFMUykiLCB0aGVuICJUWVBFKFNJWkUpLCB0aGVuICJUWVBF\nIgogICAgICAgICAgICBTdHJpbmdbXSBwcm9wTmFtZXMgPSBuZXcgU3RyaW5n\nW117CiAgICAgICAgICAgICAgICBjb2wuZ2V0VHlwZU5hbWUoKSArICIoIiAr\nIGNvbC5nZXRTaXplKCkgKyAiLCIKICAgICAgICAgICAgICAgICAgICArIGNv\nbC5nZXREZWNpbWFsRGlnaXRzKCkgKyAiKSIsCiAgICAgICAgICAgICAgICBj\nb2wuZ2V0VHlwZU5hbWUoKSArICIoIiArIGNvbC5nZXRTaXplKCkgKyAiKSIs\nCiAgICAgICAgICAgICAgICBjb2wuZ2V0VHlwZU5hbWUoKQogICAgICAgICAg\nICB9OwoKICAgICAgICAgICAgU3RyaW5nIHR5cGVOYW1lID0gbnVsbDsKICAg\nICAgICAgICAgU3RyaW5nIHR5cGVTcGVjID0gbnVsbDsKICAgICAgICAgICAg\naW50IG5hbWVJZHggPSAwOwogICAgICAgICAgICBmb3IgKDsgdHlwZVNwZWMg\nPT0gbnVsbCAmJiBuYW1lSWR4IDwgcHJvcE5hbWVzLmxlbmd0aDsgbmFtZUlk\neCsrKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvcE5hbWVzW25hbWVJZHhd\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICAgICAgdHlwZVNwZWMgPSBTdHJpbmdVdGlscy50cmltVG9OdWxs\nKF90eXBlTWFwLmdldFByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgKHBy\nb3BOYW1lc1tuYW1lSWR4XSkpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVT\ncGVjICE9IG51bGwpIAogICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lID0g\ncHJvcE5hbWVzW25hbWVJZHhdOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmICh0eXBlU3BlYyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2xvZy5p\nbmZvKF9sb2MuZ2V0KCJyZXZlcnNlLXR5cGUiLCB0eXBlTmFtZSwgdHlwZVNw\nZWMpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgibm8tcmV2ZXJzZS10eXBlIiwKICAgICAgICAgICAg\nICAgICAgICBwcm9wTmFtZXNbcHJvcE5hbWVzLmxlbmd0aCAtIDFdKSk7Cgog\nICAgICAgICAgICBpZiAodHlwZVNwZWMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHR5cGUgPSBTdHJpbmdzLnRvQ2xhc3ModHlwZVNwZWMsIF9jb25mLgog\nICAgICAgICAgICAgICAgICAgIGdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgp\nLmdldENsYXNzTG9hZGVyCiAgICAgICAgICAgICAgICAgICAgKFJldmVyc2VN\nYXBwaW5nVG9vbC5jbGFzcywgbnVsbCkpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAgICAgdHlwZSA9IFNjaGVtYXMu\nZ2V0SmF2YVR5cGUoY29sLmdldFR5cGUoKSwgY29sLmdldFNpemUoKSwKICAg\nICAgICAgICAgICAgIGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpOwogICAgICAg\nIGlmICh0eXBlID09IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICBpZiAo\nIV9ibG9iQXNPYmopCiAgICAgICAgICAgICAgICByZXR1cm4gYnl0ZVtdLmNs\nYXNzOwogICAgICAgICAgICByZXR1cm4gdHlwZTsKICAgICAgICB9CgogICAg\nICAgIC8vIHRyZWF0IGNoYXJzIHNwZWNpYWxseTsgaWYgdGhlIGRpY3Rpb25h\ncnkgaGFzIHN0b3JlQ2hhcnNBc051bWJlcnMKICAgICAgICAvLyBzZXQsIHRo\nZW4gd2UgY2FuJ3QgcmV2ZXJzZSBtYXAgaW50byBhIGNoYXI7IHVzZSBhIHN0\ncmluZyBhbmQgdGVsbAogICAgICAgIC8vIHRoZSB1c2VyIHdoeSB3ZSBhcmUg\nZG9pbmcgc28KICAgICAgICBpZiAodHlwZSA9PSBjaGFyLmNsYXNzCiAgICAg\nICAgICAgICYmIF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCkuc3Rv\ncmVDaGFyc0FzTnVtYmVycykgewogICAgICAgICAgICB0eXBlID0gU3RyaW5n\nLmNsYXNzOwogICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImNhbnQtdXNl\nLWNoYXIiLCBjb2wuZ2V0RnVsbE5hbWUoKSkpOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIHJldHVy\nbiB0eXBlOwogICAgICAgIGlmICghZm9yY2VPYmplY3QgJiYgKGNvbC5pc05v\ndE51bGwoKSB8fCAhX251bGxBc09iaikpCiAgICAgICAgICAgIHJldHVybiB0\neXBlOwoKICAgICAgICAvLyBjb252ZXJ0IHRoZSB0eXBlIGludG8gdGhlIGFw\ncHJvcHJpYXRlIHdyYXBwZXIgY2xhc3MKICAgICAgICBzd2l0Y2ggKHR5cGUu\nZ2V0TmFtZSgpLmNoYXJBdCgwKSkgewogICAgICAgICAgICBjYXNlJ2InOgog\nICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gYm9vbGVhbi5jbGFzcykKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5jbGFzczsKICAgICAg\nICAgICAgICAgIHJldHVybiBCeXRlLmNsYXNzOwogICAgICAgICAgICBjYXNl\nJ2MnOgogICAgICAgICAgICAgICAgcmV0dXJuIENoYXJhY3Rlci5jbGFzczsK\nICAgICAgICAgICAgY2FzZSdkJzoKICAgICAgICAgICAgICAgIHJldHVybiBE\nb3VibGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UnZic6CiAgICAgICAgICAg\nICAgICByZXR1cm4gRmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UnaSc6\nCiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsKICAgICAg\nICAgICAgY2FzZSdsJzoKICAgICAgICAgICAgICAgIHJldHVybiBMb25nLmNs\nYXNzOwogICAgICAgICAgICBjYXNlJ3MnOgogICAgICAgICAgICAgICAgcmV0\ndXJuIFNob3J0LmNsYXNzOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IHRvb2wg\nd2l0aCB0aGUgc2FtZSBzZXR0aW5ncyBhcyB0aGlzIG9uZS4gVXNlZCBpbiB3\nb3JrYmVuY2guCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7\nCiAgICAgICAgUmV2ZXJzZU1hcHBpbmdUb29sIHRvb2wgPSBuZXcgUmV2ZXJz\nZU1hcHBpbmdUb29sKF9jb25mKTsKICAgICAgICB0b29sLnNldFNjaGVtYUdy\nb3VwKGdldFNjaGVtYUdyb3VwKCkpOwogICAgICAgIHRvb2wuc2V0UGFja2Fn\nZU5hbWUoZ2V0UGFja2FnZU5hbWUoKSk7CiAgICAgICAgdG9vbC5zZXREaXJl\nY3RvcnkoZ2V0RGlyZWN0b3J5KCkpOwogICAgICAgIHRvb2wuc2V0VXNlU2No\nZW1hTmFtZShnZXRVc2VTY2hlbWFOYW1lKCkpOwogICAgICAgIHRvb2wuc2V0\nVXNlRm9yZWlnbktleU5hbWUoZ2V0VXNlRm9yZWlnbktleU5hbWUoKSk7CiAg\nICAgICAgdG9vbC5zZXROdWxsYWJsZUFzT2JqZWN0KGdldE51bGxhYmxlQXNP\nYmplY3QoKSk7CiAgICAgICAgdG9vbC5zZXRCbG9iQXNPYmplY3QoZ2V0Qmxv\nYkFzT2JqZWN0KCkpOwogICAgICAgIHRvb2wuc2V0UHJpbWFyeUtleU9uSm9p\nbihnZXRQcmltYXJ5S2V5T25Kb2luKCkpOwogICAgICAgIHRvb2wuc2V0VXNl\nRGF0YVN0b3JlSWRlbnRpdHkoZ2V0VXNlRGF0YVN0b3JlSWRlbnRpdHkoKSk7\nCiAgICAgICAgdG9vbC5zZXRVc2VCdWlsdGluSWRlbnRpdHlDbGFzcyhnZXRV\nc2VCdWlsdGluSWRlbnRpdHlDbGFzcygpKTsKICAgICAgICB0b29sLnNldElu\nbmVySWRlbnRpdHlDbGFzc2VzKGdldElubmVySWRlbnRpdHlDbGFzc2VzKCkp\nOwogICAgICAgIHRvb2wuc2V0SWRlbnRpdHlDbGFzc1N1ZmZpeChnZXRJZGVu\ndGl0eUNsYXNzU3VmZml4KCkpOwogICAgICAgIHRvb2wuc2V0SW52ZXJzZVJl\nbGF0aW9ucyhnZXRJbnZlcnNlUmVsYXRpb25zKCkpOwogICAgICAgIHRvb2wu\nc2V0RGV0YWNoYWJsZShnZXREZXRhY2hhYmxlKCkpOwogICAgICAgIHRvb2wu\nc2V0Q3VzdG9taXplcihnZXRDdXN0b21pemVyKCkpOwogICAgICAgIHRvb2wu\nc2V0Q29kZUZvcm1hdChnZXRDb2RlRm9ybWF0KCkpOwogICAgICAgIHJldHVy\nbiB0b29sOwogICAgfQoKICAgIC8vLy8vLy8vCiAgICAvLyBNYWluCiAgICAv\nLy8vLy8vLwoKICAgIC8qKgogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5SZXZlcnNlTWFwcGluZ1Rvb2wKICAgICAq\nIFtvcHRpb25dKiAmbHQ7LnNjaGVtYSBmaWxlIG9yIHJlc291cmNlJmd0OyoK\nICAgICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJlY29n\nbml6ZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3BlcnRpZXMv\nLXAgJmx0O3Byb3BlcnRpZXMgZmlsZSBvciByZXNvdXJjZSZndDs8L2k+OiBU\naGUKICAgICAqIHBhdGggb3IgcmVzb3VyY2UgbmFtZSBvZiBhIE9wZW5KUEEg\ncHJvcGVydGllcyBmaWxlIGNvbnRhaW5pbmcKICAgICAqIGluZm9ybWF0aW9u\nIHN1Y2ggYXMgdGhlIGxpY2Vuc2Uga2V5CWRhdGEgYXMgb3V0bGluZWQgaW4K\nICAgICAqIHtAbGluayBPcGVuSlBBQ29uZmlndXJhdGlvbn0uIE9wdGlvbmFs\nLjwvbGk+CiAgICAgKiA8bGk+PGk+LSZsdDtwcm9wZXJ0eSBuYW1lJmd0OyAm\nbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7PC9pPjogQWxsIGJlYW4KICAgICAqIHBy\nb3BlcnRpZXMgb2YgdGhlIE9wZW5KUEEge0BsaW5rIEpEQkNDb25maWd1cmF0\naW9ufSBjYW4gYmUgc2V0IGJ5CiAgICAgKiB1c2luZyB0aGVpcgluYW1lcyBh\nbmQgc3VwcGx5aW5nIGEgdmFsdWUuIEZvciBleGFtcGxlOgogICAgICogPGNv\nZGU+LWxpY2Vuc2VLZXkgYWRzbGZqYTgzcjNsa2FkZjwvY29kZT48L2xpPgog\nICAgICogPGxpPjxpPi1zY2hlbWFzLy1zICZsdDtzY2hlbWFzIGFuZCB0YWJs\nZXMmZ3Q7PC9pPjogQ29tbWEtc2VwYXJhdGVkCiAgICAgKiBsaXN0IG9mIHNj\naGVtYXMgYW5kIHRhYmxlcyB0byByZXZlcnNlLW1hcC48L2xpPgogICAgICog\nPGxpPjxpPi1wYWNrYWdlLy1wa2cgJmx0O3BhY2thZ2UgbmFtZSZndDs8L2k+\nOiBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZQogICAgICogZm9yIGFsbCBnZW5l\ncmF0ZWQgY2xhc3Nlcy4gRGVmYXVsdHMgdG8gbm8gcGFja2FnZS48L2xpPgog\nICAgICogPGxpPjxpPi1kaXJlY3RvcnkvLWQgJmx0O291dHB1dCBkaXJlY3Rv\ncnkmZ3Q7PC9pPjogVGhlIGRpcmVjdG9yeSB3aGVyZQogICAgICogYWxsIGdl\nbmVyYXRlZCBjb2RlIHNob3VsZCBiZSBwbGFjZWQuIERlZmF1bHRzIHRvIHRo\nZSBjdXJyZW50CiAgICAgKiBkaXJlY3RvcnkuPC9saT4KICAgICAqIDxsaT48\naT4tdXNlU2NoZW1hTmFtZS8tc24gJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7\nPC9pPjogU2V0IHRoaXMgZmxhZyB0bwogICAgICogdHJ1ZSB0byBpbmNsdWRl\nIHRoZSBzY2hlbWEgbmFtZSBhcyBwYXJ0IG9mIHRoZSBnZW5lcmF0ZWQgY2xh\nc3MgbmFtZQogICAgICogZm9yIGVhY2ggdGFibGUuPC9saT4KICAgICAqIDxs\naT48aT4tdXNlRm9yZWlnbktleU5hbWUvLWZrbiAmbHQ7dHJ1ZS90IHwgZmFs\nc2UvZiZndDs8L2k+OiBTZXQgdGhpcwogICAgICogZmxhZyB0byB0cnVlIHRv\nIHVzZSB0aGUgZm9yZWlnbiBrZXkgbmFtZSB0byBnZW5lcmF0ZSBmaWVsZHMK\nICAgICAqIHJlcHJlc2VudGluZyByZWxhdGlvbnMgYmV0d2VlbiBjbGFzc2Vz\nLjwvbGk+CiAgICAgKiA8bGk+PGk+LW51bGxhYmxlQXNPYmplY3QvLW5vICZs\ndDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0byB0cnVlCiAgICAg\nKiB0byBtYWtlIGFsbCBudWxsYWJsZSBjb2x1bW5zIG1hcCB0byBvYmplY3Qg\ndHlwZXM7IGNvbHVtbnMgdGhhdCB3b3VsZAogICAgICogbm9ybWFsbHkgbWFw\nIHRvIGEgcHJpbWl0aXZlIHdpbGwgbWFwIHRvIHRoZSBhcHByb3ByaWF0ZSB3\ncmFwcGVyCiAgICAgKiB0eXBlIGluc3RlYWQuPC9saT4KICAgICAqIDxsaT48\naT4tYmxvYkFzT2JqZWN0Ly1ibyAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8\nL2k+OiBTZXQgdG8gdHJ1ZQogICAgICogdG8gbWFrZSBhbGwgYmluYXJ5IGNv\nbHVtbnMgbWFwIHRvIE9iamVjdCByYXRoZXIgdGhhbiBieXRlW10uPC9saT4K\nICAgICAqIDxsaT48aT4tdHlwZU1hcC8tdHlwICZsdDt0eXBlcyZndDs8L2k+\nOiBEZWZhdWx0IG1hcHBpbmcgb2YgU1FMIHR5cGUKICAgICAqIG5hbWVzIHRv\nIEphdmEgY2xhc3Nlcy48L2xpPgogICAgICogPGxpPjxpPi1wcmltYXJ5S2V5\nT25Kb2luLy1wa2ogJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0\nIHRvIHRydWUKICAgICAqIHRvIGFsbG93IHByaW1hcnkga2V5cyBvbiBqb2lu\nIHRhYmxlcy48L2xpPgogICAgICogPGxpPjxpPi11c2VEYXRhc3RvcmVJZGVu\ndGl0eS8tZHMgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0IHRv\nCiAgICAgKiB0cnVlIHRvIHVzZSBkYXRhc3RvcmUgaWRlbnRpdHkgd2hlcmUg\ncG9zc2libGUuPC9saT4KICAgICAqIDxsaT48aT4tdXNlQnVpbHRpbklkZW50\naXR5Q2xhc3MvLWJpYyAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBT\nZXQKICAgICAqIHRvIGZhbHNlIHRvIG5ldmVyIHVzZSBPcGVuSlBBJ3MgYnVp\nbHRpbiBhcHBsaWNhdGlvbiBpZGVudGl0eQogICAgICogY2xhc3Nlcy48L2xp\nPgogICAgICogPGxpPjxpPi1pbm5lcklkZW50aXR5Q2xhc3Nlcy8taW5uICZs\ndDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0bwogICAgICogdHJ1\nZSB0byBnZW5lcmF0ZSB0aGUgYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3Nl\ncyBhcyBpbm5lciBjbGFzc2VzLjwvbGk+CiAgICAgKiA8bGk+PGk+LWlkZW50\naXR5Q2xhc3NTdWZmaXgvLWlzICZsdDtzdWZmaXgmZ3Q7PC9pPjogU3VmZml4\nIHRvIGFwcGVuZAogICAgICogdG8gY2xhc3MgbmFtZXMgdG8gY3JlYXRlIGlk\nZW50aXR5IGNsYXNzIG5hbWUsIG9yIGZvciBpbm5lciBpZGVudGl0eQogICAg\nICogY2xhc3NlcywgdGhlIGlubmVyIGNsYXNzIG5hbWUuPC9saT4KICAgICAq\nIDxsaT48aT4taW52ZXJzZVJlbGF0aW9ucy8taXIgJmx0O3RydWUvdCB8IGZh\nbHNlL2YmZ3Q7PC9pPjogU2V0IHRvCiAgICAgKiBmYWxzZSB0byBwcmV2ZW50\nIHRoZSBjcmVhdGlvbiBvZiBpbnZlcnNlIDEtbWFueS8xLTEgcmVsYXRpb25z\nIGZvcgogICAgICogZWFjaCBlbmNvdW50ZXJlZCBtYW55LTEvMS0xIHJlbGF0\naW9uLjwvbGk+CiAgICAgKiA8bGk+PGk+LWRldGFjaGFibGUvLWRldCAmbHQ7\ndHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBTZXQgdG8KICAgICAqIHRydWUg\ndG8gbWFrZSBnZW5lcmF0ZWQgY2xhc3NlcyBkZXRhY2hhYmxlLjwvbGk+CiAg\nICAgKiA8bGk+PGk+LWRpc2NyaW1pbmF0b3JTdHJhdGVneS8tZHMgJmx0O3N0\ncmF0ZWd5Jmd0OzwvaT46IFRoZSBkZWZhdWx0CiAgICAgKiBkaXNjcmltaW5h\ndG9yIHN0cmF0ZWd5IHRvIHBsYWNlIG9uIGJhc2UgY2xhc3Nlcy48L2xpPgog\nICAgICogPGxpPjxpPi12ZXJzaW9uU3RyYXRlZ3kvLXZzICZsdDtzdHJhdGVn\neSZndDs8L2k+OiBUaGUgZGVmYXVsdAogICAgICogdmVyc2lvbiBzdHJhdGVn\neSB0byBwbGFjZSBvbiBiYXNlIGNsYXNzZXMuPC9saT4KICAgICAqIDxsaT48\naT4tbWV0YWRhdGEvLW1kICZsdDtjbGFzcyB8IHBhY2thZ2UmZ3Q7PC9pPjog\nU3BlY2lmeSB0aGUgbGV2ZWwgdGhlCiAgICAgKiBtZXRhZGF0YSBzaG91bGQg\nYmUgZ2VuZXJhdGVkIGF0LiBEZWZhdWx0cyB0byBnZW5lcmF0aW5nIGEKICAg\nICAqIHNpbmdsZSBwYWNrYWdlLWxldmVsIG1ldGFkYXRhIGZpbGUuPC9saT4K\nICAgICAqIDxsaT48aT4tY3VzdG9taXplckNsYXNzLy1jYyAmbHQ7Y2xhc3Mg\nbmFtZSZndDs8L2k+OiBUaGUgZnVsbCBjbGFzcwogICAgICogbmFtZSBvZiBh\nIHtAbGluayBSZXZlcnNlQ3VzdG9taXplcn0gaW1wbGVtZW50YXRpb24gdG8g\ndXNlIHRvCiAgICAgKiBjdXN0b21pemUgdGhlIHJldmVyc2UgbWFwcGluZyBw\ncm9jZXNzLiBPcHRpb25hbC48L2xpPgogICAgICogPGxpPjxpPi1jdXN0b21p\nemVyUHJvcGVydGllcy8tY3AgJmx0O3Byb3BlcnRpZXMgZmlsZSBvciByZXNv\ndXJjZSZndDs8L2k+CiAgICAgKiA6IFRoZSBwYXRoIG9yIHJlc291cmNlIG5h\nbWUgb2YgYSBwcm9wZXJ0aWVzIGZpbGUgdGhhdCB3aWxsIGJlCiAgICAgKiBw\nYXNzZWQgdG8gdGhlIHJldmVyc2UgY3VzdG9taXplciBvbiBpbml0aWFsaXph\ndGlvbi4gT3B0aW9uYWwuPC9saT4KICAgICAqIDxsaT48aT4tY3VzdG9taXpl\nci8tYy4mbHQ7cHJvcGVydHkgbmFtZSZndDsgJmx0OyBwcm9wZXJ0eSB2YWx1\nZSZndDs8L2k+CiAgICAgKiA6IEFyZ3VtZW50cyBsaWtlIHRoaXMgd2lsbCBi\nZSB1c2VkIHRvIGNvbmZpZ3VyZSB0aGUgYmVhbgogICAgICogcHJvcGVydGll\ncyBvZiB0aGUge0BsaW5rIFJldmVyc2VDdXN0b21pemVyfS48L2xpPgogICAg\nICogPGxpPjxpPi1jb2RlRm9ybWF0Ly1jZi4mbHQ7cHJvcGVydHkgbmFtZSZn\ndDsgJmx0OyBwcm9wZXJ0eSB2YWx1ZSZndDs8L2k+CiAgICAgKiA6IEFyZ3Vt\nZW50cyBsaWtlIHRoaXMgd2lsbCBiZSB1c2VkIHRvIGNvbmZpZ3VyZSB0aGUg\nYmVhbgogICAgICogcHJvcGVydGllcyBvZiB0aGUgaW50ZXJuYWwge0BsaW5r\nIENvZGVGb3JtYXR9LjwvbGk+CiAgICAgKiA8L3VsPgogICAgICogIEVhY2gg\nc2NoZW1hIGdpdmVuIGFzIGFuIGFyZ3VtZW50IHdpbGwgYmUgcmV2ZXJzZS1t\nYXBwZWQgaW50bwogICAgICogcGVyc2lzdGVudCBjbGFzc2VzIGFuZCBhc3Nv\nY2lhdGVkIG1ldGFkYXRhLiBJZiBubyBhcmd1bWVudHMgYXJlIGdpdmVuLAog\nICAgICogdGhlIGRhdGFiYXNlIHNjaGVtYXMgZGVmaW5lZCBieSB0aGUgc3lz\ndGVtIGNvbmZpZ3VyYXRpb24gd2lsbCBiZQogICAgICogcmV2ZXJzZS1tYXBw\nZWQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmlu\nZ1tdIGFyZ3MpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBTUUxFeGNl\ncHRpb24gewogICAgICAgIE9wdGlvbnMgb3B0cyA9IG5ldyBPcHRpb25zKCk7\nCiAgICAgICAgYXJncyA9IG9wdHMuc2V0RnJvbUNtZExpbmUoYXJncyk7CiAg\nICAgICAgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBKREJDQ29uZmln\ndXJhdGlvbkltcGwoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nIXJ1bihjb25mLCBhcmdzLCBvcHRzKSkKICAgICAgICAgICAgICAgIFN5c3Rl\nbS5vdXQucHJpbnRsbihfbG9jLmdldCgicmV2dG9vbC11c2FnZSIpKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjb25mLmNsb3NlKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUnVuIHRoZSB0b29sLiBS\nZXR1cm5zIGZhbHNlIGlmIGludmFsaWQgb3B0aW9ucyB3ZXJlIGdpdmVuLgog\nICAgICoKICAgICAqIEBzZWUgI21haW4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBib29sZWFuIHJ1bihKREJDQ29uZmlndXJhdGlvbiBjb25mLCBTdHJp\nbmdbXSBhcmdzLAogICAgICAgIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9w\ndHMuY29udGFpbnNLZXkoImhlbHAiKSB8fCBvcHRzLmNvbnRhaW5zS2V5KCIt\naGVscCIpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8v\nIGZsYWdzCiAgICAgICAgRmxhZ3MgZmxhZ3MgPSBuZXcgRmxhZ3MoKTsKICAg\nICAgICBmbGFncy5wYWNrYWdlTmFtZSA9IG9wdHMucmVtb3ZlUHJvcGVydHkK\nICAgICAgICAgICAgKCJwYWNrYWdlIiwgInBrZyIsIGZsYWdzLnBhY2thZ2VO\nYW1lKTsKICAgICAgICBmbGFncy5kaXJlY3RvcnkgPSBGaWxlcy5nZXRGaWxl\nCiAgICAgICAgICAgIChvcHRzLnJlbW92ZVByb3BlcnR5KCJkaXJlY3Rvcnki\nLCAiZCIsIG51bGwpLCBudWxsKTsKICAgICAgICBmbGFncy51c2VTY2hlbWFO\nYW1lID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAg\nKCJ1c2VTY2hlbWFOYW1lIiwgInNuIiwgZmxhZ3MudXNlU2NoZW1hTmFtZSk7\nCiAgICAgICAgZmxhZ3MudXNlRm9yZWlnbktleU5hbWUgPSBvcHRzLnJlbW92\nZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInVzZUZvcmVpZ25LZXlO\nYW1lIiwgImZrbiIsIGZsYWdzLnVzZUZvcmVpZ25LZXlOYW1lKTsKICAgICAg\nICBmbGFncy5udWxsYWJsZUFzT2JqZWN0ID0gb3B0cy5yZW1vdmVCb29sZWFu\nUHJvcGVydHkKICAgICAgICAgICAgKCJudWxsYWJsZUFzT2JqZWN0IiwgIm5v\nIiwgZmxhZ3MubnVsbGFibGVBc09iamVjdCk7CiAgICAgICAgZmxhZ3MuYmxv\nYkFzT2JqZWN0ID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAg\nICAgICAgKCJibG9iQXNPYmplY3QiLCAiYm8iLCBmbGFncy5ibG9iQXNPYmpl\nY3QpOwogICAgICAgIGZsYWdzLnByaW1hcnlLZXlPbkpvaW4gPSBvcHRzLnJl\nbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInByaW1hcnlLZXlP\nbkpvaW4iLCAicGtqIiwgZmxhZ3MucHJpbWFyeUtleU9uSm9pbik7CiAgICAg\nICAgZmxhZ3MudXNlRGF0YVN0b3JlSWRlbnRpdHkgPSBvcHRzLnJlbW92ZUJv\nb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInVzZURhdGFzdG9yZUlkZW50\naXR5IiwgImRzIiwgZmxhZ3MudXNlRGF0YVN0b3JlSWRlbnRpdHkpOwogICAg\nICAgIGZsYWdzLnVzZUJ1aWx0aW5JZGVudGl0eUNsYXNzID0gb3B0cy5yZW1v\ndmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJ1c2VCdWlsdGluSWRl\nbnRpdHlDbGFzcyIsICJiaWMiLCBmbGFncy51c2VCdWlsdGluSWRlbnRpdHlD\nbGFzcyk7CiAgICAgICAgZmxhZ3MuaW5uZXJJZGVudGl0eUNsYXNzZXMgPSBv\ncHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImlubmVy\nSWRlbnRpdHlDbGFzc2VzIiwgImlubiIsIGZsYWdzLmlubmVySWRlbnRpdHlD\nbGFzc2VzKTsKICAgICAgICBmbGFncy5pZGVudGl0eUNsYXNzU3VmZml4ID0g\nb3B0cy5yZW1vdmVQcm9wZXJ0eQogICAgICAgICAgICAoImlkZW50aXR5Q2xh\nc3NTdWZmaXgiLCAiaXMiLCBmbGFncy5pZGVudGl0eUNsYXNzU3VmZml4KTsK\nICAgICAgICBmbGFncy5pbnZlcnNlUmVsYXRpb25zID0gb3B0cy5yZW1vdmVC\nb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJpbnZlcnNlUmVsYXRpb25z\nIiwgImlyIiwgZmxhZ3MuaW52ZXJzZVJlbGF0aW9ucyk7CiAgICAgICAgZmxh\nZ3MuZGV0YWNoYWJsZSA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAg\nICAgICAgICAgICgiZGV0YWNoYWJsZSIsICJkZXQiLCBmbGFncy5kZXRhY2hh\nYmxlKTsKICAgICAgICBmbGFncy5kaXNjcmltaW5hdG9yU3RyYXRlZ3kgPSBv\ncHRzLnJlbW92ZVByb3BlcnR5CiAgICAgICAgICAgICgiZGlzY3JpbWluYXRv\nclN0cmF0ZWd5IiwgImRzIiwgZmxhZ3MuZGlzY3JpbWluYXRvclN0cmF0ZWd5\nKTsKICAgICAgICBmbGFncy52ZXJzaW9uU3RyYXRlZ3kgPSBvcHRzLnJlbW92\nZVByb3BlcnR5CiAgICAgICAgICAgICgidmVyc2lvblN0cmF0ZWd5IiwgInZz\nIiwgZmxhZ3MudmVyc2lvblN0cmF0ZWd5KTsKICAgICAgICBmbGFncy5tZXRh\nRGF0YUxldmVsID0gb3B0cy5yZW1vdmVQcm9wZXJ0eQogICAgICAgICAgICAo\nIm1ldGFkYXRhIiwgIm1kIiwgZmxhZ3MubWV0YURhdGFMZXZlbCk7CgogICAg\nICAgIFN0cmluZyB0eXBlTWFwID0gb3B0cy5yZW1vdmVQcm9wZXJ0eSgidHlw\nZU1hcCIsICJ0eXAiLCBudWxsKTsKICAgICAgICBpZiAodHlwZU1hcCAhPSBu\ndWxsKQogICAgICAgICAgICBmbGFncy50eXBlTWFwID0gQ29uZmlndXJhdGlv\nbnMucGFyc2VQcm9wZXJ0aWVzKHR5cGVNYXApOwoKICAgICAgICAvLyByZW1h\ncCB0aGUgLXMgc2hvcnRjdXQgdG8gdGhlICJzY2hlbWFzIiBwcm9wZXJ0eSBu\nYW1lIHNvIHRoYXQgaXQKICAgICAgICAvLyBnZXRzIHNldCBpbnRvIHRoZSBj\nb25maWd1cmF0aW9uCiAgICAgICAgaWYgKG9wdHMuY29udGFpbnNLZXkoInMi\nKSkKICAgICAgICAgICAgb3B0cy5wdXQoInNjaGVtYXMiLCBvcHRzLmdldCgi\ncyIpKTsKCiAgICAgICAgLy8gY3VzdG9taXplcgogICAgICAgIFN0cmluZyBj\ndXN0b21DbHMgPSBvcHRzLnJlbW92ZVByb3BlcnR5KCJjdXN0b21pemVyQ2xh\nc3MiLCAiY2MiLAogICAgICAgICAgICBQcm9wZXJ0aWVzUmV2ZXJzZUN1c3Rv\nbWl6ZXIuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICBGaWxlIGN1c3RvbUZp\nbGUgPSBGaWxlcy5nZXRGaWxlCiAgICAgICAgICAgIChvcHRzLnJlbW92ZVBy\nb3BlcnR5KCJjdXN0b21pemVyUHJvcGVydGllcyIsICJjcCIsIG51bGwpLCBu\ndWxsKTsKICAgICAgICBQcm9wZXJ0aWVzIGN1c3RvbVByb3BzID0gbmV3IFBy\nb3BlcnRpZXMoKTsKICAgICAgICBpZiAoY3VzdG9tRmlsZSAhPSBudWxsICYm\nIGN1c3RvbUZpbGUuZXhpc3RzKCkpCiAgICAgICAgICAgIGN1c3RvbVByb3Bz\nLmxvYWQobmV3IEZpbGVJbnB1dFN0cmVhbShjdXN0b21GaWxlKSk7CgogICAg\nICAgIC8vIHNlcGFyYXRlIHRoZSBwcm9wZXJ0aWVzIGZvciB0aGUgY3VzdG9t\naXplciBhbmQgY29kZSBmb3JtYXQKICAgICAgICBPcHRpb25zIGN1c3RvbU9w\ndHMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIE9wdGlvbnMgZm9ybWF0T3B0\ncyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgTWFwLkVudHJ5IGVudHJ5Owog\nICAgICAgIFN0cmluZyBrZXk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBvcHRzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgp\nOwogICAgICAgICAgICBrZXkgPSAoU3RyaW5nKSBlbnRyeS5nZXRLZXkoKTsK\nICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCJjdXN0b21pemVyLiIp\nKSB7CiAgICAgICAgICAgICAgICBjdXN0b21PcHRzLnB1dChrZXkuc3Vic3Ry\naW5nKDExKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICBp\ndHIucmVtb3ZlKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5LnN0YXJ0\nc1dpdGgoImMuIikpIHsKICAgICAgICAgICAgICAgIGN1c3RvbU9wdHMucHV0\nKGtleS5zdWJzdHJpbmcoMiksIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKGtleS5zdGFydHNXaXRoKCJjb2RlRm9ybWF0LiIpKSB7CiAgICAgICAgICAg\nICAgICBmb3JtYXRPcHRzLnB1dChrZXkuc3Vic3RyaW5nKDExKSwgZW50cnku\nZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoa2V5LnN0YXJ0c1dpdGgoImNmLiIpKSB7\nCiAgICAgICAgICAgICAgICBmb3JtYXRPcHRzLnB1dChrZXkuc3Vic3RyaW5n\nKDMpLCBlbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGl0ci5y\nZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nY29kZSBmb3JtYXQKICAgICAgICBpZiAoIWZvcm1hdE9wdHMuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIGZsYWdzLmZvcm1hdCA9IG5ldyBDb2RlRm9ybWF0\nKCk7CiAgICAgICAgICAgIGZvcm1hdE9wdHMuc2V0SW50byhmbGFncy5mb3Jt\nYXQpOwogICAgICAgIH0KCiAgICAgICAgLy8gc2V0dXAgYSBjb25maWd1cmF0\naW9uIGluc3RhbmNlIHdpdGggY21kLWxpbmUgaW5mbwogICAgICAgIENvbmZp\nZ3VyYXRpb25zLnBvcHVsYXRlQ29uZmlndXJhdGlvbihjb25mLCBvcHRzKTsK\nICAgICAgICBDbGFzc0xvYWRlciBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVz\nb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihS\nZXZlcnNlTWFwcGluZ1Rvb2wuY2xhc3MsIG51bGwpOwoKICAgICAgICAvLyBj\ndXN0b21pemVyCiAgICAgICAgZmxhZ3MuY3VzdG9taXplciA9IChSZXZlcnNl\nQ3VzdG9taXplcikgQ29uZmlndXJhdGlvbnMuCiAgICAgICAgICAgIG5ld0lu\nc3RhbmNlKGN1c3RvbUNscywgbG9hZGVyKTsKICAgICAgICBpZiAoZmxhZ3Mu\nY3VzdG9taXplciAhPSBudWxsKSB7CiAgICAgICAgICAgIENvbmZpZ3VyYXRp\nb25zLmNvbmZpZ3VyZUluc3RhbmNlKGZsYWdzLmN1c3RvbWl6ZXIsIGNvbmYs\nCiAgICAgICAgICAgICAgICBjdXN0b21PcHRzKTsKICAgICAgICAgICAgZmxh\nZ3MuY3VzdG9taXplci5zZXRDb25maWd1cmF0aW9uKGN1c3RvbVByb3BzKTsK\nICAgICAgICB9CgogICAgICAgIHJ1bihjb25mLCBhcmdzLCBmbGFncywgbG9h\nZGVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJ1biB0aGUgdG9vbC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2\nb2lkIHJ1bihKREJDQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdz\nLAogICAgICAgIEZsYWdzIGZsYWdzLCBDbGFzc0xvYWRlciBsb2FkZXIpCiAg\nICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBTUUxFeGNlcHRpb24gewogICAg\nICAgIC8vIHBhcnNlIHRoZSBzY2hlbWEgdG8gcmV2ZXJzZS1tYXAKICAgICAg\nICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nTE9HX1RPT0wpOwogICAgICAgIFNjaGVtYUdyb3VwIHNjaGVtYTsKICAgICAg\nICBpZiAoYXJncy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICBsb2cuaW5m\nbyhfbG9jLmdldCgicmV2dG9vbC1ydW5uaW5nIikpOwogICAgICAgICAgICBT\nY2hlbWFHZW5lcmF0b3IgZ2VuID0gbmV3IFNjaGVtYUdlbmVyYXRvcihjb25m\nKTsKICAgICAgICAgICAgZ2VuLmdlbmVyYXRlU2NoZW1hcygpOwogICAgICAg\nICAgICBzY2hlbWEgPSBnZW4uZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBTY2hlbWFQYXJzZXIgcGFyc2VyID0gbmV3\nIFhNTFNjaGVtYVBhcnNlcihjb25mKTsKICAgICAgICAgICAgRmlsZSBmaWxl\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGZpbGUgPSBGaWxlcy5nZXRGaWxl\nKGFyZ3NbaV0sIGxvYWRlcik7CiAgICAgICAgICAgICAgICBsb2cuaW5mbyhf\nbG9jLmdldCgicmV2dG9vbC1ydW5uaW5nLWZpbGUiLCBmaWxlKSk7CiAgICAg\nICAgICAgICAgICBwYXJzZXIucGFyc2UoZmlsZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc2NoZW1hID0gcGFyc2VyLmdldFNjaGVtYUdyb3VwKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBmbGFncwogICAgICAgIFJldmVyc2VN\nYXBwaW5nVG9vbCB0b29sID0gbmV3IFJldmVyc2VNYXBwaW5nVG9vbChjb25m\nKTsKICAgICAgICB0b29sLnNldFNjaGVtYUdyb3VwKHNjaGVtYSk7CiAgICAg\nICAgdG9vbC5zZXRQYWNrYWdlTmFtZShmbGFncy5wYWNrYWdlTmFtZSk7CiAg\nICAgICAgdG9vbC5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsKICAg\nICAgICB0b29sLnNldFVzZVNjaGVtYU5hbWUoZmxhZ3MudXNlU2NoZW1hTmFt\nZSk7CiAgICAgICAgdG9vbC5zZXRVc2VGb3JlaWduS2V5TmFtZShmbGFncy51\nc2VGb3JlaWduS2V5TmFtZSk7CiAgICAgICAgdG9vbC5zZXROdWxsYWJsZUFz\nT2JqZWN0KGZsYWdzLm51bGxhYmxlQXNPYmplY3QpOwogICAgICAgIHRvb2wu\nc2V0QmxvYkFzT2JqZWN0KGZsYWdzLmJsb2JBc09iamVjdCk7CiAgICAgICAg\ndG9vbC5zZXRUeXBlTWFwKGZsYWdzLnR5cGVNYXApOwogICAgICAgIHRvb2wu\nc2V0UHJpbWFyeUtleU9uSm9pbihmbGFncy5wcmltYXJ5S2V5T25Kb2luKTsK\nICAgICAgICB0b29sLnNldFVzZURhdGFTdG9yZUlkZW50aXR5KGZsYWdzLnVz\nZURhdGFTdG9yZUlkZW50aXR5KTsKICAgICAgICB0b29sLnNldFVzZUJ1aWx0\naW5JZGVudGl0eUNsYXNzKGZsYWdzLnVzZUJ1aWx0aW5JZGVudGl0eUNsYXNz\nKTsKICAgICAgICB0b29sLnNldElubmVySWRlbnRpdHlDbGFzc2VzKGZsYWdz\nLmlubmVySWRlbnRpdHlDbGFzc2VzKTsKICAgICAgICB0b29sLnNldElkZW50\naXR5Q2xhc3NTdWZmaXgoZmxhZ3MuaWRlbnRpdHlDbGFzc1N1ZmZpeCk7CiAg\nICAgICAgdG9vbC5zZXRJbnZlcnNlUmVsYXRpb25zKGZsYWdzLmludmVyc2VS\nZWxhdGlvbnMpOwogICAgICAgIHRvb2wuc2V0RGV0YWNoYWJsZShmbGFncy5k\nZXRhY2hhYmxlKTsKICAgICAgICB0b29sLnNldEN1c3RvbWl6ZXIoZmxhZ3Mu\nY3VzdG9taXplcik7CiAgICAgICAgdG9vbC5zZXRDb2RlRm9ybWF0KGZsYWdz\nLmZvcm1hdCk7CgogICAgICAgIC8vIHJ1bgogICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJyZXZ0b29sLW1hcCIpKTsKICAgICAgICB0b29sLnJ1bigpOwog\nICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJyZXZ0b29sLXdyaXRlLWNvZGUi\nKSk7CiAgICAgICAgdG9vbC5yZWNvcmRDb2RlKCk7CiAgICAgICAgbG9nLmlu\nZm8oX2xvYy5nZXQoInJldnRvb2wtd3JpdGUtbWV0YWRhdGEiKSk7CiAgICAg\nICAgdG9vbC5yZWNvcmRNZXRhRGF0YShMRVZFTF9DTEFTUy5lcXVhbHMoZmxh\nZ3MubWV0YURhdGFMZXZlbCkpOwogICAgfQoKICAgIC8qKgogICAgICogSG9s\nZGVyIGZvciBydW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nY2xhc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgU3RyaW5nIHBhY2thZ2VO\nYW1lID0gbnVsbDsKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3RvcnkgPSBu\ndWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIHVzZVNjaGVtYU5hbWUgPSBm\nYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiB1c2VGb3JlaWduS2V5TmFt\nZSA9IGZhbHNlOwogICAgICAgIHB1YmxpYyBib29sZWFuIG51bGxhYmxlQXNP\nYmplY3QgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBibG9iQXNP\nYmplY3QgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgUHJvcGVydGllcyB0eXBl\nTWFwID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBwcmltYXJ5S2V5\nT25Kb2luID0gZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdXNlRGF0\nYVN0b3JlSWRlbnRpdHkgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VCdWlsdGluSWRlbnRpdHlDbGFzcyA9IHRydWU7CiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gaW5uZXJJZGVudGl0eUNsYXNzZXMgPSBmYWxzZTsKICAg\nICAgICBwdWJsaWMgU3RyaW5nIGlkZW50aXR5Q2xhc3NTdWZmaXggPSAiSWQi\nOwogICAgICAgIHB1YmxpYyBib29sZWFuIGludmVyc2VSZWxhdGlvbnMgPSB0\ncnVlOwogICAgICAgIHB1YmxpYyBib29sZWFuIGRldGFjaGFibGUgPSBmYWxz\nZTsKICAgICAgICBwdWJsaWMgU3RyaW5nIG1ldGFEYXRhTGV2ZWwgPSBMRVZF\nTF9QQUNLQUdFOwogICAgICAgIHB1YmxpYyBTdHJpbmcgZGlzY3JpbWluYXRv\nclN0cmF0ZWd5ID0gbnVsbDsKICAgICAgICBwdWJsaWMgU3RyaW5nIHZlcnNp\nb25TdHJhdGVneSA9IG51bGw7CiAgICAgICAgcHVibGljIFJldmVyc2VDdXN0\nb21pemVyIGN1c3RvbWl6ZXIgPSBudWxsOwogICAgICAgIHB1YmxpYyBDb2Rl\nRm9ybWF0IGZvcm1hdCA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBV\nc2VkIHRvIGluc3RhbGwgZGlzY3JpbWluYXRvciBhbmQgdmVyc2lvbiBzdHJh\ndGVnaWVzIG9uCiAgICAgKiByZXZlcnNlLW1hcHBlZCBjbGFzc2VzLgogICAg\nICovCiAgICBwcml2YXRlIGNsYXNzIFJldmVyc2VTdHJhdGVneUluc3RhbGxl\ncgogICAgICAgIGV4dGVuZHMgU3RyYXRlZ3lJbnN0YWxsZXIgewoKICAgICAg\nICBwdWJsaWMgUmV2ZXJzZVN0cmF0ZWd5SW5zdGFsbGVyKE1hcHBpbmdSZXBv\nc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgICAgIHN1cGVyKHJlcG9zKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGluc3RhbGxTdHJhdGVneShD\nbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgaW5zdGFsbFN0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGluc3RhbGxTdHJhdGVneShWZXJz\naW9uIHZlcnNpb24pIHsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9\nIHZlcnNpb24uZ2V0Q2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAgIGlmIChj\nbHMuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHZlcnNpb24uc2V0U3RyYXRlZ3kobmV3IFN1cGVyY2xhc3NWZXJzaW9uU3Ry\nYXRlZ3koKSwgbnVsbCk7CiAgICAgICAgICAgIGVsc2UgaWYgKF92ZXJzU3Ry\nYXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgVmVyc2lvblN0cmF0ZWd5\nIHN0cmF0ID0gcmVwb3MuaW5zdGFudGlhdGVWZXJzaW9uU3RyYXRlZ3kKICAg\nICAgICAgICAgICAgICAgICAoX3ZlcnNTdHJhdCwgdmVyc2lvbik7CiAgICAg\nICAgICAgICAgICB2ZXJzaW9uLnNldFN0cmF0ZWd5KHN0cmF0LCBudWxsKTsK\nICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICB2ZXJzaW9uLnNl\ndFN0cmF0ZWd5KG5ldyBTdGF0ZUNvbXBhcmlzb25WZXJzaW9uU3RyYXRlZ3ko\nKSwKICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGluc3RhbGxTdHJhdGVneShEaXNjcmltaW5hdG9y\nIGRpc2NyaW0pIHsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IGRp\nc2NyaW0uZ2V0Q2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAgIGlmIChjbHMu\nZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nZGlzY3JpbS5zZXRTdHJhdGVneShuZXcgU3VwZXJjbGFzc0Rpc2NyaW1pbmF0\nb3JTdHJhdGVneSgpLAogICAgICAgICAgICAgICAgICAgIG51bGwpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKCFoYXNTdWJjbGFzc2VzKGNscykpIHsKICAg\nICAgICAgICAgICAgIGRpc2NyaW0uc2V0U3RyYXRlZ3koTm9uZURpc2NyaW1p\nbmF0b3JTdHJhdGVneS5nZXRJbnN0YW5jZSgpLAogICAgICAgICAgICAgICAg\nICAgIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9kaXNjU3RyYXQg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgRGlzY3JpbWluYXRvclN0cmF0\nZWd5IHN0cmF0ID0gcmVwb3MuCiAgICAgICAgICAgICAgICAgICAgaW5zdGFu\ndGlhdGVEaXNjcmltaW5hdG9yU3RyYXRlZ3koX2Rpc2NTdHJhdCwgZGlzY3Jp\nbSk7CiAgICAgICAgICAgICAgICBkaXNjcmltLnNldFN0cmF0ZWd5KHN0cmF0\nLCBudWxsKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBk\naXNjcmltLnNldFN0cmF0ZWd5KG5ldyBTdWJjbGFzc0pvaW5EaXNjcmltaW5h\ndG9yU3RyYXRlZ3koKSwKICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBjbGFzcyBoYXMgYW55IG1hcHBlZCBwZXJzaXN0ZW50IHN1\nYmNsYXNzZXMuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBib29sZWFu\nIGhhc1N1YmNsYXNzZXMoQ2xhc3NNYXBwaW5nIGNscykgewogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhW10gbWV0YXMgPSByZXBvcy5nZXRNZXRhRGF0YXMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRhcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChtZXRhc1tpXS5nZXRQQ1N1\ncGVyY2xhc3MoKSA9PSBjbHMuZ2V0RGVzY3JpYmVkVHlwZSgpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRXh0ZW5z\naW9uIG9mIHRoZSB7QGxpbmsgQ29kZUdlbmVyYXRvcn0gdG8gYWxsb3cgdXNl\ncnMgdG8gY3VzdG9taXplCiAgICAgKiB0aGUgZm9ybWF0dGluZyBvZiB0aGVp\nciBnZW5lcmF0ZWQgY2xhc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFz\ncyBSZXZlcnNlQ29kZUdlbmVyYXRvcgogICAgICAgIGV4dGVuZHMgQ29kZUdl\nbmVyYXRvciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNYXBwaW5n\nIF9tYXBwaW5nOwogICAgICAgIHByaXZhdGUgZmluYWwgQXBwbGljYXRpb25J\nZFRvb2wgX2FwcGlkOwoKICAgICAgICBwdWJsaWMgUmV2ZXJzZUNvZGVHZW5l\ncmF0b3IoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgICAgIEFwcGxp\nY2F0aW9uSWRUb29sIGFpZCkgewogICAgICAgICAgICBzdXBlcihtYXBwaW5n\nKTsKICAgICAgICAgICAgc3VwZXIuc2V0RGlyZWN0b3J5KF9kaXIpOwogICAg\nICAgICAgICBzdXBlci5zZXRDb2RlRm9ybWF0KF9mb3JtYXQpOwoKICAgICAg\nICAgICAgX21hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgICAgICBpZiAoYWlk\nICE9IG51bGwgJiYgYWlkLmlzSW5uZXJDbGFzcygpKQogICAgICAgICAgICAg\nICAgX2FwcGlkID0gYWlkOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBfYXBwaWQgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogSWYgdGhlcmUgaXMgYW4gaW5uZXIgYXBwbGljYXRpb24gaWRl\nbnRpdHkgY2xhc3MsIHRoZW4KICAgICAgICAgKiBhZGQgaXQgdG8gdGhlIGJv\ndHRvbSBvZiB0aGUgY2xhc3MgY29kZS4KICAgICAgICAgKi8KICAgICAgICBw\ncm90ZWN0ZWQgdm9pZCBjbG9zZUNsYXNzQnJhY2UoQ29kZUZvcm1hdCBjb2Rl\nKSB7CiAgICAgICAgICAgIGlmIChfYXBwaWQgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgY29kZS5hZnRlclNlY3Rpb24oKTsKICAgICAgICAgICAgICAg\nIGNvZGUuYXBwZW5kKF9hcHBpZC5nZXRDb2RlKCkpOwogICAgICAgICAgICAg\nICAgY29kZS5lbmRsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN1\ncGVyLmNsb3NlQ2xhc3NCcmFjZShjb2RlKTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIEFkZCB0aGUgbGlzdCBvZiBpbXBvcnRzIGZvciBh\nbnkgaW5uZXIgYXBwIGlkIGNsYXNzZXMKICAgICAgICAgKgogICAgICAgICAq\nIEByZXR1cm4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgU2V0IGdldElt\ncG9ydFBhY2thZ2VzKCkgewogICAgICAgICAgICBTZXQgcGtncyA9IHN1cGVy\nLmdldEltcG9ydFBhY2thZ2VzKCk7CiAgICAgICAgICAgIGlmIChfYXBwaWQg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBrZ3MuYWRkQWxsKF9hcHBpZC5n\nZXRJbXBvcnRQYWNrYWdlcygpKTsKICAgICAgICAgICAgcmV0dXJuIHBrZ3M7\nCiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldENsYXNz\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIChfY3VzdG9tID09IG51bGwp\nID8gbnVsbCA6IF9jdXN0b20uZ2V0Q2xhc3NDb2RlKF9tYXBwaW5nKTsKICAg\nICAgICB9CgogICAgICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0SW5pdGlhbFZh\nbHVlKEZpZWxkTWV0YURhdGEgZmllbGQpIHsKICAgICAgICAgICAgaWYgKF9j\ndXN0b20gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICByZXR1cm4gX2N1c3RvbS5nZXRJbml0aWFsVmFsdWUoKEZp\nZWxkTWFwcGluZykgZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIFN0cmluZyBnZXREZWNsYXJhdGlvbihGaWVsZE1ldGFEYXRhIGZpZWxk\nKSB7CiAgICAgICAgICAgIGlmIChfY3VzdG9tID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIF9jdXN0\nb20uZ2V0RGVjbGFyYXRpb24oKEZpZWxkTWFwcGluZykgZmllbGQpOwogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0cmluZyBnZXRGaWVsZENvZGUo\nRmllbGRNZXRhRGF0YSBmaWVsZCkgewogICAgICAgICAgICBpZiAoX2N1c3Rv\nbSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgICAgIHJldHVybiBfY3VzdG9tLmdldEZpZWxkQ29kZSgoRmllbGRNYXBw\naW5nKSBmaWVsZCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

