{"sha":"49af05f8fcda6eb7a9339f5ba3cd4387ccf55f95","node_id":"MDQ6QmxvYjIwNjM2NDo0OWFmMDVmOGZjZGE2ZWI3YTkzMzlmNWJhM2NkNDM4N2NjZjU1Zjk1","size":11704,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/49af05f8fcda6eb7a9339f5ba3cd4387ccf55f95","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGE7CgppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW5J\nTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3Jl\naWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlVuaXF1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5N\nZXRhRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBJbmZvcm1hdGlvbiBhYm91dCB0\naGUgbWFwcGluZyBmcm9tIGEgZmllbGQgdmFsdWUgdG8gdGhlIHNjaGVtYSwg\naW4KICogcmF3IGZvcm0uIFRoZSBjb2x1bW5zIGFuZCB0YWJsZXMgdXNlZCBp\nbiBtYXBwaW5nIGluZm8gd2lsbCBub3QgYmUgcGFydCBvZgogKiB0aGUge0Bs\naW5rIFNjaGVtYUdyb3VwfSB1c2VkIGF0IHJ1bnRpbWUuIFJhdGhlciwgdGhl\neSB3aWxsIGJlIHN0cnVjdHMKICogd2l0aCB0aGUgcmVsZXZhbnQgcGllY2Vz\nIG9mIGluZm9ybWF0aW9uIGZpbGxlZCBpbi4KICoKICogQGF1dGhvciBBYmUg\nV2hpdGUKICovCnB1YmxpYyBjbGFzcyBWYWx1ZU1hcHBpbmdJbmZvCiAgICBl\neHRlbmRzIE1hcHBpbmdJbmZvIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAg\nICAgKFZhbHVlTWFwcGluZ0luZm8uY2xhc3MpOwoKICAgIHByaXZhdGUgYm9v\nbGVhbiBfY3JpdGVyaWEgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBf\nY2FuTnVsbCA9IHRydWU7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVz\nZSBjbGFzcyBjcml0ZXJpYSB3aGVuIGpvaW5pbmcgdG8gcmVsYXRlZCB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRVc2VDbGFzc0NyaXRl\ncmlhKCkgewogICAgICAgIHJldHVybiBfY3JpdGVyaWE7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBjbGFzcyBjcml0ZXJpYSB3aGVu\nIGpvaW5pbmcgdG8gcmVsYXRlZCB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRVc2VDbGFzc0NyaXRlcmlhKGJvb2xlYW4gY3JpdGVyaWEpIHsK\nICAgICAgICBfY3JpdGVyaWEgPSBjcml0ZXJpYTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdXNlciBoYXMgZXhwbGljaXRseSB0dXJuZWQgbnVs\nbCBpbmRpY2F0b3IgY29sdW1uIG9mZi4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gY2FuSW5kaWNhdGVOdWxsKCkgewogICAgICAgIHJldHVybiBfY2Fu\nTnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdXNlciBoYXMg\nZXhwbGljaXRseSB0dXJuZWQgbnVsbCBpbmRpY2F0b3IgY29sdW1uIG9mZi4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2FuSW5kaWNhdGVOdWxsKGJv\nb2xlYW4gaW5kKSB7CiAgICAgICAgX2Nhbk51bGwgPSBpbmQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGpvaW4gZnJvbSB0aGlzIHZhbHVl\nIHRvIGl0cyByZWxhdGVkIHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIG5h\nbWUgYmFzZSBuYW1lIGZvciB2YWx1ZSBtYXBwaW5nCiAgICAgKiBAcGFyYW0g\naW52ZXJzYWJsZSB3aGV0aGVyIGFuIGludmVyc2Ugam9pbiBpcyBhbGxvd2Vk\nCiAgICAgKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldFR5cGVKb2luKGZp\nbmFsIFZhbHVlTWFwcGluZyB2YWwsIGZpbmFsIFN0cmluZyBuYW1lLAogICAg\nICAgIGJvb2xlYW4gaW52ZXJzYWJsZSwgYm9vbGVhbiBhZGFwdCkgewogICAg\nICAgIENsYXNzTWFwcGluZyByZWwgPSB2YWwuZ2V0VHlwZU1hcHBpbmcoKTsK\nICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBGb3JlaWduS2V5RGVmYXVsdHMgZGVmID0gbmV3IEZv\ncmVpZ25LZXlEZWZhdWx0cygpIHsKICAgICAgICAgICAgcHVibGljIEZvcmVp\nZ25LZXkgZ2V0KFRhYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWduLCBib29sZWFu\nIGludmVyc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2YWwuZ2V0TWFw\ncGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAg\nICAgICAgICAgICAgICBnZXRGb3JlaWduS2V5KHZhbCwgbmFtZSwgbG9jYWws\nIGZvcmVpZ24sIGludmVyc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFibGUgZm9y\nZWlnbiwgQ29sdW1uIGNvbCwKICAgICAgICAgICAgICAgIE9iamVjdCB0YXJn\nZXQsIGJvb2xlYW4gaW52ZXJzZSwgaW50IHBvcywgaW50IGNvbHMpIHsKICAg\nICAgICAgICAgICAgIHZhbC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1h\ncHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRl\nRm9yZWlnbktleUNvbHVtbih2YWwsIG5hbWUsIGxvY2FsLCBmb3JlaWduLCBj\nb2wsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCwgaW52ZXJzZSwg\ncG9zLCBjb2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAg\ncmV0dXJuIGNyZWF0ZUZvcmVpZ25LZXkodmFsLCBudWxsLCBnZXRDb2x1bW5z\nKCksIGRlZiwKICAgICAgICAgICAgdmFsLmdldEZpZWxkTWFwcGluZygpLmdl\ndFRhYmxlKCksIHZhbC5nZXRGaWVsZE1hcHBpbmcoKS4KICAgICAgICAgICAg\nZ2V0RGVmaW5pbmdNYXBwaW5nKCksIHJlbCwgaW52ZXJzYWJsZSwgYWRhcHQp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2luIGZyb20g\ndGhlIHJlbGF0ZWQgdHlwZSB0byB0aGlzIHZhbHVlLgogICAgICovCiAgICBw\ndWJsaWMgRm9yZWlnbktleSBnZXRJbnZlcnNlVHlwZUpvaW4oZmluYWwgVmFs\ndWVNYXBwaW5nIHZhbCwKICAgICAgICBmaW5hbCBTdHJpbmcgbmFtZSwgYm9v\nbGVhbiBhZGFwdCkgewogICAgICAgIENsYXNzTWFwcGluZyByZWwgPSB2YWwu\nZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAocmVsID09IG51bGwgfHwg\ncmVsLmdldFRhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIEZvcmVpZ25LZXlEZWZhdWx0cyBkZWYgPSBuZXcgRm9y\nZWlnbktleURlZmF1bHRzKCkgewogICAgICAgICAgICBwdWJsaWMgRm9yZWln\nbktleSBnZXQoVGFibGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIGJvb2xlYW4g\naW52ZXJzZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbC5nZXRNYXBw\naW5nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAg\nICAgICAgICAgICAgIGdldEZvcmVpZ25LZXkodmFsLCBuYW1lLCBsb2NhbCwg\nZm9yZWlnbiwgIWludmVyc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFibGUgZm9y\nZWlnbiwgQ29sdW1uIGNvbCwKICAgICAgICAgICAgICAgIE9iamVjdCB0YXJn\nZXQsIGJvb2xlYW4gaW52ZXJzZSwgaW50IHBvcywgaW50IGNvbHMpIHsKICAg\nICAgICAgICAgICAgIHZhbC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1h\ncHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRl\nRm9yZWlnbktleUNvbHVtbih2YWwsIG5hbWUsIGxvY2FsLCBmb3JlaWduLCBj\nb2wsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCwgIWludmVyc2Us\nIHBvcywgY29scyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAg\nIHJldHVybiBjcmVhdGVGb3JlaWduS2V5KHZhbCwgbnVsbCwgZ2V0Q29sdW1u\ncygpLCBkZWYsIHJlbC5nZXRUYWJsZSgpLAogICAgICAgICAgICByZWwsIHZh\nbC5nZXRGaWVsZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBpbmcoKSwgZmFs\nc2UsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nY29sdW1ucyBmb3IgdGhpcyB2YWx1ZSwgYmFzZWQgb24gdGhlIGdpdmVuIHRl\nbXBsYXRlcy4KICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdldENvbHVt\nbnMoVmFsdWVNYXBwaW5nIHZhbCwgU3RyaW5nIG5hbWUsCiAgICAgICAgQ29s\ndW1uW10gdG1wbGF0ZXMsIFRhYmxlIHRhYmxlLCBib29sZWFuIGFkYXB0KSB7\nCiAgICAgICAgb3JkZXJDb2x1bW5zQnlUYXJnZXRGaWVsZCh2YWwsIHRtcGxh\ndGVzLCBhZGFwdCk7CiAgICAgICAgdmFsLmdldE1hcHBpbmdSZXBvc2l0b3J5\nKCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkucG9wdWxhdGVDb2x1bW5zCiAgICAg\nICAgICAgICh2YWwsIG5hbWUsIHRhYmxlLCB0bXBsYXRlcyk7CiAgICAgICAg\ncmV0dXJuIGNyZWF0ZUNvbHVtbnModmFsLCBudWxsLCB0bXBsYXRlcywgdGFi\nbGUsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgZ2l2ZW4g\nY29sdW1ucyBtYXRjaCB1cCB3aXRoIHRoZSB0YXJnZXQgZmllbGRzIHN1cHBs\naWVkIG9uIHRoZQogICAgICogdGVtcGxhdGVzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgb3JkZXJDb2x1bW5zQnlUYXJnZXRGaWVsZChWYWx1ZU1hcHBp\nbmcgdmFsLCBDb2x1bW5bXSB0bXBsYXRlcywKICAgICAgICBib29sZWFuIGFk\nYXB0KSB7CiAgICAgICAgaWYgKHRtcGxhdGVzLmxlbmd0aCA8IDIgfHwgdG1w\nbGF0ZXNbMF0uZ2V0VGFyZ2V0RmllbGQoKSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgTGlzdCBjb2xzID0gZ2V0Q29sdW1ucygpOwog\nICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSB8fCBjb2xzLnNpemUoKSAhPSB0\nbXBsYXRlcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\naW50IHBvcyA9IDA7CiAgICAgICAgQ29sdW1uIGN1ciA9IChDb2x1bW4pIGNv\nbHMuZ2V0KDApOwogICAgICAgIENvbHVtbiBuZXh0OwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29scy5zaXplKCk7IGkrKykgewogICAgICAgICAg\nICBpZiAoY3VyLmdldFRhcmdldEZpZWxkKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tdGFyZ2V0ZmllbGQiLCB2YWwpKTsKCiAgICAgICAgICAgIHBvcyA9IGZp\nbmRUYXJnZXRGaWVsZCh0bXBsYXRlcywgY3VyLmdldFRhcmdldEZpZWxkKCkp\nOwogICAgICAgICAgICBpZiAocG9zID09IC0xKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdGFy\nZ2V0ZmllbGQiLAogICAgICAgICAgICAgICAgICAgIHZhbCwgY3VyLmdldFRh\ncmdldEZpZWxkKCkpKTsKCiAgICAgICAgICAgIG5leHQgPSAoQ29sdW1uKSBj\nb2xzLmdldChwb3MpOwogICAgICAgICAgICBjb2xzLnNldChwb3MsIGN1cik7\nCiAgICAgICAgICAgIGN1ciA9IG5leHQ7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgdGVtcGxh\ndGUgY29sdW1uIHdpdGggdGhlIGdpdmVuIHRhcmdldCBmaWVsZC4KICAgICAq\nLwogICAgcHVibGljIGludCBmaW5kVGFyZ2V0RmllbGQoQ29sdW1uW10gdG1w\nbGF0ZXMsIFN0cmluZyB0YXJnZXQpIHsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAo\ndGFyZ2V0LmVxdWFscyh0bXBsYXRlc1tpXS5nZXRUYXJnZXRGaWVsZCgpKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgIHJldHVybiAtMTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBjb25zdHJh\naW50IGZvciB0aGUgZ2l2ZW4gY29sdW1ucywgb3IgbnVsbCBpZiBub25lLgog\nICAgICovCiAgICBwdWJsaWMgVW5pcXVlIGdldFVuaXF1ZShWYWx1ZU1hcHBp\nbmcgdmFsLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAg\nIENvbHVtbltdIGNvbHMgPSB2YWwuZ2V0Q29sdW1ucygpOwogICAgICAgIGlm\nIChjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgVW5pcXVlIHVucSA9IHZhbC5nZXRNYXBwaW5nUmVwb3NpdG9y\neSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICBnZXRVbmlx\ndWUodmFsLCBuYW1lLCBjb2xzWzBdLmdldFRhYmxlKCksIGNvbHMpOwogICAg\nICAgIHJldHVybiBjcmVhdGVVbmlxdWUodmFsLCBudWxsLCB1bnEsIGNvbHMs\nIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBpbmRl\neCBmb3IgdGhlIGdpdmVuIGNvbHVtbnMsIG9yIG51bGwgaWYgbm9uZS4KICAg\nICAqLwogICAgcHVibGljIEluZGV4IGdldEluZGV4KFZhbHVlTWFwcGluZyB2\nYWwsIFN0cmluZyBuYW1lLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgQ29s\ndW1uW10gY29scyA9IHZhbC5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNv\nbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBJbmRleCBpZHggPSB2YWwuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5n\nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAgZ2V0SW5kZXgodmFs\nLCBuYW1lLCBjb2xzWzBdLmdldFRhYmxlKCksIGNvbHMpOwogICAgICAgIHJl\ndHVybiBjcmVhdGVJbmRleCh2YWwsIG51bGwsIGlkeCwgY29scywgYWRhcHQp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudWxsIGluZGlj\nYXRvciBjb2x1bW4gZm9yIHRoaXMgdmFsdWUsIG9yIG51bGwgaWYgbm9uZS4K\nICAgICAqLwogICAgcHVibGljIENvbHVtbiBnZXROdWxsSW5kaWNhdG9yQ29s\ndW1uKFZhbHVlTWFwcGluZyB2YWwsIFN0cmluZyBuYW1lLAogICAgICAgIFRh\nYmxlIHRhYmxlLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgLy8gcmVzZXQg\nSU8KICAgICAgICBzZXRDb2x1bW5JTyhudWxsKTsKCiAgICAgICAgLy8gaGFz\nIHRoZSB1c2VyIGV4cGxpY2l0bHkgdHVybmVkIG51bGwgaW5kaWNhdG9yIG9m\nZj8KICAgICAgICBpZiAoIV9jYW5OdWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgLy8gZXh0cmFjdCBnaXZlbiBudWxsLWluZCBjb2x1\nbW4KICAgICAgICBMaXN0IGNvbHMgPSBnZXRDb2x1bW5zKCk7CiAgICAgICAg\nQ29sdW1uIGdpdmVuID0gKGNvbHMuaXNFbXB0eSgpKSA/IG51bGwgOiAoQ29s\ndW1uKSBjb2xzLmdldCgwKTsKICAgICAgICBNYXBwaW5nRGVmYXVsdHMgZGVm\nID0gdmFsLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1\nbHRzKCk7CiAgICAgICAgaWYgKGdpdmVuID09IG51bGwgJiYgKCFhZGFwdCAm\nJiAhZGVmLmRlZmF1bHRNaXNzaW5nSW5mbygpKSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIENvbHVtbiB0bXBsYXRlID0gbmV3IENvbHVt\nbigpOwogICAgICAgIHRtcGxhdGUuc2V0TmFtZShuYW1lICsgIl9udWxsIik7\nCiAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsK\nICAgICAgICBpZiAoIWRlZi5wb3B1bGF0ZU51bGxJbmRpY2F0b3JDb2x1bW5z\nKHZhbCwgbmFtZSwgdGFibGUsIG5ldyBDb2x1bW5bXQogICAgICAgICAgICB7\nIHRtcGxhdGUgfSkgJiYgZ2l2ZW4gPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGlmIChnaXZlbiAhPSBudWxsICYmIChnaXZl\nbi5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkKICAgICAgICAg\nICAgfHwgZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkp\nKSB7CiAgICAgICAgICAgIENvbHVtbklPIGlvID0gbmV3IENvbHVtbklPKCk7\nCiAgICAgICAgICAgIGlvLnNldEluc2VydGFibGUoMCwgIWdpdmVuLmdldEZs\nYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKSk7CiAgICAgICAgICAgIGlv\nLnNldFVwZGF0YWJsZSgwLCAhZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19V\nTlVQREFUQUJMRSkpOwogICAgICAgICAgICBzZXRDb2x1bW5JTyhpbyk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiBnaXZlbi5n\nZXROYW1lKCkgIT0gbnVsbCkgewogICAgICAgICAgICAvLyB0ZXN0IGlmIGdp\ndmVuIGNvbHVtbiBuYW1lIGlzIGFjdHVhbGx5IGEgZmllbGQgbmFtZSwgaW4g\nd2hpY2gKICAgICAgICAgICAgLy8gY2FzZSB3ZSB1c2UgaXRzIGNvbHVtbiBh\ncyB0aGUgbnVsbCBpbmRpY2F0b3IgY29sdW1uCiAgICAgICAgICAgIENsYXNz\nTWFwcGluZyBlbWJlZCA9IHZhbC5nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAg\nICAgICAgICAgRmllbGRNYXBwaW5nIGVmbSA9IChlbWJlZCA9PSBudWxsKSA/\nIG51bGwKICAgICAgICAgICAgICAgIDogZW1iZWQuZ2V0RmllbGRNYXBwaW5n\nKGdpdmVuLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmIChlZm0gIT0gbnVs\nbCAmJiBlZm0uZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nICAgICBnaXZlbi5zZXROYW1lKGVmbS5nZXRDb2x1bW5zKClbMF0uZ2V0TmFt\nZSgpKTsKICAgICAgICB9CiAgICAgICAgYm9vbGVhbiBjb21wYXQgPSBnaXZl\nbiA9PSBudWxsIHx8IGdpdmVuLmdldE5hbWUoKSA9PSBudWxsCiAgICAgICAg\nICAgIHx8IHRhYmxlID09IG51bGwgfHwgIXRhYmxlLmlzTmFtZVRha2VuKGdp\ndmVuLmdldE5hbWUoKSk7CgogICAgICAgIHJldHVybiBtZXJnZUNvbHVtbih2\nYWwsICJudWxsLWluZCIsIHRtcGxhdGUsIGNvbXBhdCwgZ2l2ZW4sCiAgICAg\nICAgICAgIHRhYmxlLCBhZGFwdCwgZGVmLmRlZmF1bHRNaXNzaW5nSW5mbygp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIGludGVybmFs\nIGluZm9ybWF0aW9uIHdpdGggdGhlIG1hcHBpbmcgZGF0YSBmb3IgdGhlIGdp\ndmVuCiAgICAgKiB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc3lu\nY1dpdGgoVmFsdWVNYXBwaW5nIHZhbCkgewogICAgICAgIGNsZWFyKGZhbHNl\nKTsKCiAgICAgICAgX2NyaXRlcmlhID0gdmFsLmdldFVzZUNsYXNzQ3JpdGVy\naWEoKTsKICAgICAgICBzZXRDb2x1bW5JTyh2YWwuZ2V0Q29sdW1uSU8oKSk7\nCiAgICAgICAgaWYgKHZhbC5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbCAmJiB2\nYWwuZ2V0VHlwZU1hcHBpbmcoKSAhPSBudWxsCiAgICAgICAgICAgICYmIHZh\nbC5nZXRUeXBlTWFwcGluZygpLmdldFRhYmxlKCkgIT0gbnVsbCkgewogICAg\nICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSB2YWwuZ2V0RmllbGRNYXBwaW5n\nKCk7CiAgICAgICAgICAgIFRhYmxlIGxvY2FsID0gKGZtLmdldEpvaW5Gb3Jl\naWduS2V5KCkgIT0gbnVsbCkgPyBmbS5nZXRUYWJsZSgpCiAgICAgICAgICAg\nICAgICA6IGZtLmdldERlZmluaW5nTWFwcGluZygpLmdldFRhYmxlKCk7CiAg\nICAgICAgICAgIFRhYmxlIGZvcmVpZ247CiAgICAgICAgICAgIGlmICh2YWwu\nZ2V0Sm9pbkRpcmVjdGlvbigpID09IFZhbHVlTWFwcGluZy5KT0lOX0VYUEVD\nVEVEX0lOVkVSU0UpIHsKICAgICAgICAgICAgICAgIGZvcmVpZ24gPSBsb2Nh\nbDsKICAgICAgICAgICAgICAgIGxvY2FsID0gdmFsLmdldFR5cGVNYXBwaW5n\nKCkuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIHNldEpvaW5EaXJlY3Rp\nb24oSk9JTl9GT1JXQVJEKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIGZvcmVpZ24gPSB2YWwuZ2V0VHlwZU1hcHBpbmcoKS5nZXRU\nYWJsZSgpOwogICAgICAgICAgICAgICAgc2V0Sm9pbkRpcmVjdGlvbigodmFs\nLmdldEpvaW5EaXJlY3Rpb24oKSA9PSB2YWwuSk9JTl9GT1JXQVJEKQogICAg\nICAgICAgICAgICAgICAgID8gSk9JTl9GT1JXQVJEIDogSk9JTl9JTlZFUlNF\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzeW5jRm9yZWlnbktleSh2\nYWwsIHZhbC5nZXRGb3JlaWduS2V5KCksIGxvY2FsLCBmb3JlaWduKTsKICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgc3luY0NvbHVtbnModmFsLCB2YWwu\nZ2V0Q29sdW1ucygpLCBmYWxzZSk7CgogICAgICAgIHN5bmNJbmRleCh2YWws\nIHZhbC5nZXRWYWx1ZUluZGV4KCkpOwogICAgICAgIHN5bmNVbmlxdWUodmFs\nLCB2YWwuZ2V0VmFsdWVVbmlxdWUoKSk7CgogICAgICAgIC8vIGV4cGxpY2l0\nIGhhbmRsZXIgc3RyYXRlZ3kgaWYgdGhlIGhhbmRsZXIgaXNuJ3QgdGhlIGV4\ncGVjdGVkIGRlZmF1bHQKICAgICAgICBpZiAodmFsLmdldEhhbmRsZXIoKSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIFZhbHVlSGFuZGxlciBkZWYgPSB2YWwu\nZ2V0RmllbGRNYXBwaW5nKCkuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS4KICAg\nICAgICAgICAgICAgIGRlZmF1bHRIYW5kbGVyKHZhbCk7CiAgICAgICAgICAg\nIGlmIChkZWYgPT0gbnVsbCB8fCB2YWwuZ2V0SGFuZGxlcigpLmdldENsYXNz\nKCkgIT0gZGVmLmdldENsYXNzKCkpCiAgICAgICAgICAgICAgICBzZXRTdHJh\ndGVneSh2YWwuZ2V0SGFuZGxlcigpLmdldENsYXNzKCkuZ2V0TmFtZSgpKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXIoYm9v\nbGVhbiBjYW5GbGFncykgewogICAgICAgIHN1cGVyLmNsZWFyKGNhbkZsYWdz\nKTsKICAgICAgICBpZiAoY2FuRmxhZ3MpIHsKICAgICAgICAgICAgX2NyaXRl\ncmlhID0gZmFsc2U7CiAgICAgICAgICAgIF9jYW5OdWxsID0gdHJ1ZTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShNYXBwaW5nSW5m\nbyBpbmZvKSB7CiAgICAgICAgc3VwZXIuY29weShpbmZvKTsKICAgICAgICBp\nZiAoIShpbmZvIGluc3RhbmNlb2YgVmFsdWVNYXBwaW5nSW5mbykpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyB2aW5m\nbyA9IChWYWx1ZU1hcHBpbmdJbmZvKSBpbmZvOwogICAgICAgIGlmICghX2Ny\naXRlcmlhKQogICAgICAgICAgICBfY3JpdGVyaWEgPSB2aW5mby5nZXRVc2VD\nbGFzc0NyaXRlcmlhKCk7CiAgICAgICAgaWYgKF9jYW5OdWxsKQogICAgICAg\nICAgICBfY2FuTnVsbCA9IHZpbmZvLmNhbkluZGljYXRlTnVsbCgpOwogICAg\nfQp9Cg==\n","encoding":"base64"}

