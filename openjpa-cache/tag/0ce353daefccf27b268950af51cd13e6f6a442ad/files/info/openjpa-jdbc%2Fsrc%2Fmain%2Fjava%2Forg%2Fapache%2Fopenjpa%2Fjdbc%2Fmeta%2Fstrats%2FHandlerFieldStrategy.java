{"sha":"c58c873017714069584b90ac89e30bc1bb7fe8ff","node_id":"MDQ6QmxvYjIwNjM2NDpjNThjODczMDE3NzE0MDY5NTg0YjkwYWM4OWUzMGJjMWJiN2ZlOGZm","size":14166,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c58c873017714069584b90ac89e30bc1bb7fe8ff","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5r\nZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkVtYmVkZGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSm9pbmFibGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlSGFuZGxl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29s\ndW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5Sb3c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93\nTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5T\nUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVu\nSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgovKioKICogTWFwcGluZyBm\nb3IgYSBzaW5nbGUtdmFsdWVkIGZpZWxkIHRoYXQgZGVsZWdhdGVzIHRvIGEg\ne0BsaW5rIFZhbHVlSGFuZGxlcn0uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqIEBzaW5jZSAwLjQuMAogKi8KcHVibGljIGNsYXNzIEhhbmRsZXJGaWVs\nZFN0cmF0ZWd5CiAgICBleHRlbmRzIEFic3RyYWN0RmllbGRTdHJhdGVneQog\nICAgaW1wbGVtZW50cyBKb2luYWJsZSwgRW1iZWRkYWJsZSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChIYW5kbGVyRmllbGRTdHJh\ndGVneS5jbGFzcyk7CgogICAgcHJpdmF0ZSBDb2x1bW5bXSBfY29scyA9IG51\nbGw7CiAgICBwcml2YXRlIENvbHVtbklPIF9pbyA9IG51bGw7CiAgICBwcml2\nYXRlIE9iamVjdFtdIF9hcmdzID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfbG9hZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9sb2IgPSBm\nYWxzZTsKCiAgICBwdWJsaWMgdm9pZCBtYXAoYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIGlmIChmaWVsZC5nZXRIYW5kbGVyKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nby1oYW5kbGVyIiwgZmllbGQpKTsKICAgICAgICBhc3NlcnROb3RNYXBwZWRC\neSgpOwoKICAgICAgICAvLyBtYXAgam9pbiBrZXkgKGlmIGFueSkKICAgICAg\nICBmaWVsZC5tYXBKb2luKGFkYXB0LCBmYWxzZSk7CiAgICAgICAgZmllbGQu\nZ2V0S2V5TWFwcGluZygpLmdldFZhbHVlSW5mbygpLmFzc2VydE5vU2NoZW1h\nQ29tcG9uZW50cwogICAgICAgICAgICAoZmllbGQuZ2V0S2V5KCksICFhZGFw\ndCk7CiAgICAgICAgZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1\nZUluZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMKICAgICAgICAgICAg\nKGZpZWxkLmdldEVsZW1lbnQoKSwgIWFkYXB0KTsKCiAgICAgICAgX2lvID0g\nbmV3IENvbHVtbklPKCk7CiAgICAgICAgX2NvbHMgPSBIYW5kbGVyU3RyYXRl\nZ2llcy5tYXAoZmllbGQsIGZpZWxkLmdldE5hbWUoKSwgX2lvLCBhZGFwdCk7\nCiAgICAgICAgaWYgKGZpZWxkLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1\nZVN0cmF0ZWdpZXMuQVVUT0FTU0lHTikgewogICAgICAgICAgICAvLyBmaXJz\ndCBzZWUgaWYgYW55IGNvbHVtbnMgYWxyZWFkeSBtYXJrZWQgYXV0b2Fzc2ln\nbjsgaWYgbm90IG1hcmsKICAgICAgICAgICAgLy8gdGhlbSBhbGwKICAgICAg\nICAgICAgYm9vbGVhbiBtYXJrZWQgPSBmYWxzZTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7ICFtYXJrZWQgJiYgaSA8IF9jb2xzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgaWYgKF9jb2xzW2ldLmlzQXV0b0Fzc2lnbmVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgbWFya2VkID0gdHJ1ZTsKICAgICAg\nICAgICAgaWYgKCFtYXJrZWQpCiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\nICAgIF9jb2xzW2ldLnNldEF1dG9Bc3NpZ25lZCh0cnVlKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGFkZCBwcmltYXJ5IGtleSBjb2x1bW5zIHRvIHRhYmxl\nIHBrIGlmIGxvZ2ljYWwKICAgICAgICBmaWVsZC5tYXBQcmltYXJ5S2V5KGFk\nYXB0KTsKICAgICAgICBQcmltYXJ5S2V5IHBrID0gZmllbGQuZ2V0VGFibGUo\nKS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgaWYgKGZpZWxkLmlzUHJpbWFy\neUtleSgpICYmIHBrICE9IG51bGwgJiYgKGFkYXB0IHx8IHBrLmlzTG9naWNh\nbCgpKSkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIHBrLmFkZENvbHVtbihfY29s\nc1tpXSk7CgogICAgICAgIC8vIHNldCBqb2luYWJsZQogICAgICAgIGlmICgh\nZmllbGQuZ2V0SGFuZGxlcigpLm9iamVjdFZhbHVlUmVxdWlyZXNMb2FkKGZp\nZWxkKSkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZpZWxkLmdldERlZmluaW5n\nTWFwcGluZygpLnNldEpvaW5hYmxlKF9jb2xzW2ldLCB0aGlzKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXplKCkgewogICAgICAgIF9sb2Fk\nID0gZmllbGQuZ2V0SGFuZGxlcigpLm9iamVjdFZhbHVlUmVxdWlyZXNMb2Fk\nKGZpZWxkKTsKICAgICAgICBpZiAoX2xvYWQpCiAgICAgICAgICAgIGZpZWxk\nLnNldFVzZXNJbnRlcm1lZGlhdGUodHJ1ZSk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7ICFfbG9iICYmIGkgPCBfY29scy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgX2xvYiA9IF9jb2xzW2ldLmlzTG9iKCk7CgogICAgICAgIE9iamVj\ndCBhcmdzID0gZmllbGQuZ2V0SGFuZGxlcigpLmdldFJlc3VsdEFyZ3VtZW50\nKGZpZWxkKTsKICAgICAgICBpZiAoYXJncyA9PSBudWxsKQogICAgICAgICAg\nICBfYXJncyA9IG51bGw7CiAgICAgICAgZWxzZSBpZiAoX2NvbHMubGVuZ3Ro\nID09IDEpCiAgICAgICAgICAgIF9hcmdzID0gbmV3IE9iamVjdFtdeyBhcmdz\nIH07CiAgICAgICAgZWxzZQogICAgICAgICAgICBfYXJncyA9IChPYmplY3Rb\nXSkgYXJnczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2Vy\nIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFJv\ndyByb3cgPSBmaWVsZC5nZXRSb3coc20sIHN0b3JlLCBybSwgUm93LkFDVElP\nTl9JTlNFUlQpOwogICAgICAgIGlmIChyb3cgIT0gbnVsbCkKICAgICAgICAg\nICAgSGFuZGxlclN0cmF0ZWdpZXMuc2V0KGZpZWxkLCBzbS5mZXRjaChmaWVs\nZC5nZXRJbmRleCgpKSwgc3RvcmUsCiAgICAgICAgICAgICAgICByb3csIF9j\nb2xzLCBfaW8sIGZpZWxkLmdldE51bGxWYWx1ZSgpID09CiAgICAgICAgICAg\nICAgICBGaWVsZE1hcHBpbmcuTlVMTF9OT05FKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0\nb3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIFJvdyByb3cgPSBmaWVsZC5nZXRSb3coc20s\nIHN0b3JlLCBybSwgUm93LkFDVElPTl9VUERBVEUpOwogICAgICAgIGlmIChy\nb3cgIT0gbnVsbCkKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMuc2V0\nKGZpZWxkLCBzbS5mZXRjaChmaWVsZC5nZXRJbmRleCgpKSwgc3RvcmUsCiAg\nICAgICAgICAgICAgICByb3csIF9jb2xzLCBfaW8sIGZpZWxkLmdldE51bGxW\nYWx1ZSgpID09CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcuTlVMTF9O\nT05FKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJt\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGZpZWxk\nLmRlbGV0ZVJvdyhzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IHN1cHBvcnRzU2VsZWN0KFNlbGVjdCBzZWwsIGludCB0eXBlLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmICgo\ndHlwZSA9PSBTZWxlY3QuVFlQRV9KT0lOTEVTUyAmJiBzZWwuaXNTZWxlY3Rl\nZChmaWVsZC5nZXRUYWJsZSgpKSkKICAgICAgICAgICAgfHwgKF9sb2FkICYm\nIHR5cGUgPT0gc2VsLlRZUEVfVFdPX1BBUlQpKQogICAgICAgICAgICByZXR1\ncm4gMTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIHNlbGVjdChTZWxlY3Qgc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBK\nREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIGlmIChfY29scy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAgICBp\nZiAoc20gIT0gbnVsbCAmJiBzbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0\nSW5kZXgoKSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAg\nICAgIGlmIChzZWwuaXNEaXN0aW5jdCgpICYmIF9sb2IgJiYgIWZpZWxkLmlz\nUHJpbWFyeUtleSgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAg\nc2VsLnNlbGVjdChfY29scywgZmllbGQuam9pbihzZWwpKTsKICAgICAgICBy\nZXR1cm4gMTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVzKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfY29scy5sZW5n\ndGggPT0gMCB8fCAhcmVzLmNvbnRhaW5zQWxsKF9jb2xzKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBPYmplY3QgdmFsID0gSGFuZGxlclN0cmF0\nZWdpZXMubG9hZERhdGFTdG9yZShmaWVsZCwgcmVzLCBudWxsLCBfY29scyk7\nCiAgICAgICAgaWYgKCFfbG9hZCkKICAgICAgICAgICAgc20uc3RvcmUoZmll\nbGQuZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAg\nICAgICAgdG9PYmplY3RWYWx1ZShmaWVsZCwgdmFsKSk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHZhbCA9IE5VTEw7CiAgICAgICAgICAgIHNtLnNldEludGVybWVkaWF0\nZShmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpE\nQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIC8vIGV2ZW4gaWYgbm8gY29sdW1ucywgYWxsb3cgYSBoYW5kbGVyIHRvIGxv\nYWQgYSBnZW5lcmF0ZWQgdmFsdWUKICAgICAgICBpZiAoX2NvbHMubGVuZ3Ro\nID09IDApIHsKICAgICAgICAgICAgaWYgKF9sb2FkKQogICAgICAgICAgICAg\nICAgc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxl\ncigpLgogICAgICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFsdWUoZmllbGQs\nIG51bGwsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwgZmll\nbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgICAgIHRvT2JqZWN0\nVmFsdWUoZmllbGQsIG51bGwpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgLy8gbG9hZCBjYWNoZWQgaW50ZXJtZWRpYXRlIHZh\nbHVlPwogICAgICAgIGlmIChfbG9hZCkgewogICAgICAgICAgICBPYmplY3Qg\nZHMgPSBzbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSk7CiAg\nICAgICAgICAgIGlmIChkcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoZHMgPT0gTlVMTCkKICAgICAgICAgICAgICAgICAgICBkcyA9IG51bGw7\nCiAgICAgICAgICAgICAgICBzbS5zdG9yZShmaWVsZC5nZXRJbmRleCgpLCBm\naWVsZC5nZXRIYW5kbGVyKCkuCiAgICAgICAgICAgICAgICAgICAgdG9PYmpl\nY3RWYWx1ZShmaWVsZCwgZHMsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgU2VsZWN0IHNlbCA9IHN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdT\nZWxlY3QoKTsKICAgICAgICBzZWwuc2VsZWN0KF9jb2xzKTsKICAgICAgICBm\naWVsZC53aGVyZVByaW1hcnlLZXkoc2VsLCBzbSwgc3RvcmUpOwoKICAgICAg\nICBSZXN1bHQgcmVzID0gc2VsLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsKICAg\nICAgICBPYmplY3QgdmFsID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAocmVzLm5leHQoKSkKICAgICAgICAgICAgICAgIHZhbCA9IEhh\nbmRsZXJTdHJhdGVnaWVzLmxvYWREYXRhU3RvcmUoZmllbGQsIHJlcywgbnVs\nbCwgX2NvbHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJl\ncy5jbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgbG9hZEVtYmVkZGVkKHNt\nLCBzdG9yZSwgZmV0Y2gsIHZhbCk7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9y\nZSkgewogICAgICAgIHJldHVybiBIYW5kbGVyU3RyYXRlZ2llcy50b0RhdGFT\ndG9yZVZhbHVlKGZpZWxkLCB2YWwsIF9jb2xzLCBzdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYXBwZW5kSXNOdWxsKFNRTEJ1ZmZlciBzcWwsIFNl\nbGVjdCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2lu\nKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\nY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+IDApCiAg\nICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhfY29sc1tpXSwgam9p\nbnMpKS5hcHBlbmQoIiBJUyAiKS4KICAgICAgICAgICAgICAgIGFwcGVuZFZh\nbHVlKG51bGwsIF9jb2xzW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYXBwZW5kSXNOb3ROdWxsKFNRTEJ1ZmZlciBzcWwsIFNlbGVj\ndCBzZWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2luKGpv\naW5zLCBmYWxzZSk7CiAgICAgICAgaWYgKF9jb2xzLmxlbmd0aCA+IDEpCiAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIigiKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nIChpID4gMCkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBPUiAiKTsK\nICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoX2Nv\nbHNbaV0sIGpvaW5zKSkuCiAgICAgICAgICAgICAgICBhcHBlbmQoIiBJUyBO\nT1QgIikuYXBwZW5kVmFsdWUobnVsbCwgX2NvbHNbaV0pOwogICAgICAgIH0K\nICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID4gMSkKICAgICAgICAgICAgc3Fs\nLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEpv\naW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIpIHsKICAgICAgICByZXR1\ncm4gZmllbGQuam9pbihqb2lucywgZm9yY2VPdXRlciwgZmFsc2UpOwogICAg\nfQoKICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oSm9pbnMgam9pbnMs\nIGJvb2xlYW4gZm9yY2VPdXRlciwKICAgICAgICBib29sZWFuIHRyYXZlcnNl\nKSB7CiAgICAgICAgaWYgKHRyYXZlcnNlKQogICAgICAgICAgICBIYW5kbGVy\nU3RyYXRlZ2llcy5hc3NlcnRKb2luYWJsZShmaWVsZCk7CiAgICAgICAgcmV0\ndXJuIGpvaW5zOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZFByb2pl\nY3Rpb24oSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLAogICAgICAgIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBIYW5k\nbGVyU3RyYXRlZ2llcy5sb2FkT2JqZWN0KGZpZWxkLCBudWxsLCBzdG9yZSwg\nZmV0Y2gsIHJlcywKICAgICAgICAgICAgam9pbnMsIF9jb2xzLCBfbG9hZCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNWZXJzaW9uYWJsZSgpIHsK\nICAgICAgICByZXR1cm4gIV9sb2IgJiYgIWZpZWxkLmlzSm9pbk91dGVyKCkK\nICAgICAgICAgICAgJiYgZmllbGQuZ2V0SGFuZGxlcigpLmlzVmVyc2lvbmFi\nbGUoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdl\nciBybSwKICAgICAgICBPYmplY3QgcHJldlZhbHVlKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFJvdyByb3cgPSBmaWVsZC5nZXRS\nb3coc20sIHN0b3JlLCBybSwgUm93LkFDVElPTl9VUERBVEUpOwogICAgICAg\nIGlmIChyb3cgIT0gbnVsbCkKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdp\nZXMud2hlcmUoZmllbGQsIHByZXZWYWx1ZSwgc3RvcmUsIHJvdywgX2NvbHMp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAg\nLy8gSm9pbmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBpbnQgZ2V0RmllbGRJbmRleCgp\nIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0SW5kZXgoKTsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGdldFByaW1hcnlLZXlWYWx1ZShSZXN1bHQgcmVz\nLCBDb2x1bW5bXSBjb2xzLCBGb3JlaWduS2V5IGZrLAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSwgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBPYmplY3Qg\ndmFsID0gbnVsbDsKICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMSkgewog\nICAgICAgICAgICBjb2wgPSBjb2xzWzBdOwogICAgICAgICAgICBpZiAoZmsg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbCA9IGZrLmdldENvbHVtbihj\nb2wpOwogICAgICAgICAgICB2YWwgPSByZXMuZ2V0T2JqZWN0KGNvbCwgZmll\nbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgZ2V0UmVzdWx0QXJn\ndW1lbnQoZmllbGQpLCBqb2lucyk7CiAgICAgICAgfSBlbHNlIGlmIChjb2xz\nLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgT2JqZWN0W10gdmFscyA9IG5l\ndyBPYmplY3RbY29scy5sZW5ndGhdOwogICAgICAgICAgICBPYmplY3RbXSBh\ncmdzID0gKE9iamVjdFtdKSBmaWVsZC5nZXRIYW5kbGVyKCkuCiAgICAgICAg\nICAgICAgICBnZXRSZXN1bHRBcmd1bWVudChmaWVsZCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgdmFscy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgY29sID0gY29sc1tpXTsKICAgICAgICAgICAgICAgIGlm\nIChmayAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbCA9IGZrLmdl\ndENvbHVtbihjb2wpOwogICAgICAgICAgICAgICAgdmFsc1tpXSA9IHJlcy5n\nZXRPYmplY3QoY29sLCAoYXJncyA9PSBudWxsKSA/IG51bGwgOiBhcmdzW2ld\nLAogICAgICAgICAgICAgICAgICAgIGpvaW5zKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICB2YWwgPSB2YWxzOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZmllbGQuZ2V0SGFuZGxlcigpLnRvT2JqZWN0VmFsdWUoZmllbGQsIHZh\nbCk7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoKSB7\nCiAgICAgICAgcmV0dXJuIF9jb2xzOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3RbXSBnZXRSZXN1bHRBcmd1bWVudHMoKSB7CiAgICAgICAgcmV0dXJuIF9h\ncmdzOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Sm9pblZhbHVlKE9i\namVjdCBmaWVsZFZhbCwgQ29sdW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlKSB7\nCiAgICAgICAgT2JqZWN0IHZhbCA9IEhhbmRsZXJTdHJhdGVnaWVzLnRvRGF0\nYVN0b3JlVmFsdWUoZmllbGQsIGZpZWxkVmFsLAogICAgICAgICAgICBfY29s\ncywgc3RvcmUpOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCB8fCBfY29scy5s\nZW5ndGggPCAyKQogICAgICAgICAgICByZXR1cm4gdmFsOwoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBpZiAoX2NvbHNbaV0gPT0gY29sKQogICAgICAgICAgICAgICAgcmV0\ndXJuICgoT2JqZWN0W10pIHZhbClbaV07CiAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBn\nZXRKb2luVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ29sdW1uIGNv\nbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4g\nZ2V0Sm9pblZhbHVlKHNtLmZldGNoKGZpZWxkLmdldEluZGV4KCkpLCBjb2ws\nIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQXNzaWdu\nZWRWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3Rv\ncmUsCiAgICAgICAgQ29sdW1uIGNvbCwgT2JqZWN0IGF1dG9JbmMpIHsKICAg\nICAgICBPYmplY3QgZGF0YTsKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09\nIDEpCiAgICAgICAgICAgIGRhdGEgPSBKYXZhVHlwZXMuY29udmVydChhdXRv\nSW5jLCBjb2wuZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIC8vIG11bHRpcGxlIGNvbHVtbnM7IGhhdmUgdG8gZ2V0IGN1cnJl\nbnQgdmFsdWUsIHJlcGxhY2UgdGhpcyBjb2wncwogICAgICAgICAgICAvLyB2\nYWx1ZSB3aXRoIHRoZSBnaXZlbiBvbmUsIGFuZCByZXNldAogICAgICAgICAg\nICBkYXRhID0gZmllbGQuZ2V0SGFuZGxlcigpLnRvRGF0YVN0b3JlVmFsdWUo\nZmllbGQsCiAgICAgICAgICAgICAgICBzbS5mZXRjaChmaWVsZC5nZXRJbmRl\neCgpKSwgc3RvcmUpOwogICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgZGF0YSA9IG5ldyBPYmplY3RbX2NvbHMubGVuZ3Ro\nXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9jb2xzW2ldID09IGNv\nbCkgewogICAgICAgICAgICAgICAgICAgICgoT2JqZWN0W10pIGRhdGEpW2ld\nID0gSmF2YVR5cGVzLmNvbnZlcnQoYXV0b0luYywgCiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbC5nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgT2JqZWN0IHZhbCA9IGZpZWxkLmdldEhhbmRs\nZXIoKS50b09iamVjdFZhbHVlKGZpZWxkLCBkYXRhKTsKICAgICAgICBzbS5z\ndG9yZShmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFbWJlZGRhYmxlIGlt\ncGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRDb2x1bW5JTygpIHsKICAgICAg\nICByZXR1cm4gX2lvOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9FbWJl\nZGRlZERhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9y\nZSkgewogICAgICAgIC8vIGRvbid0IHVzZSBIYW5kbGVyU3RyYXRlZ2llcy50\nb0RhdGFTdG9yZVZhbHVlIGIvYyB3ZSB3YW50IHJlbGF0aW9uIGlkcwogICAg\nICAgIC8vIHRvIGJlIHJlcHJlc2VudGVkIGJ5IHN0YXRlIG1hbmFnZXJzLCBu\nb3QgdGhlIHNlcmlhbGl6ZWQgaWQgdmFsdWUKICAgICAgICB2YWwgPSBmaWVs\nZC5nZXRIYW5kbGVyKCkudG9EYXRhU3RvcmVWYWx1ZShmaWVsZCwgdmFsLCBz\ndG9yZSk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsICYmIF9jb2xzLmxlbmd0\naCA+IDEpCiAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0W19jb2xzLmxl\nbmd0aF07CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IHRvRW1iZWRkZWRPYmplY3RWYWx1ZShPYmplY3QgdmFsKSB7CiAg\nICAgICAgaWYgKCFfbG9hZCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmdl\ndEhhbmRsZXIoKS50b09iamVjdFZhbHVlKGZpZWxkLCB2YWwpOwogICAgICAg\nIHJldHVybiBVTlNVUFBPUlRFRDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBs\nb2FkRW1iZWRkZWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3Jl\nIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIE9iamVjdCB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsICYmIF9jb2xzLmxlbmd0aCA+IDEpCiAg\nICAgICAgICAgIHZhbCA9IG5ldyBPYmplY3RbX2NvbHMubGVuZ3RoXTsKICAg\nICAgICBpZiAoX2xvYWQpCiAgICAgICAgICAgIHNtLnN0b3JlKGZpZWxkLmdl\ndEluZGV4KCksIGZpZWxkLmdldEhhbmRsZXIoKS4KICAgICAgICAgICAgICAg\nIHRvT2JqZWN0VmFsdWUoZmllbGQsIHZhbCwgc20sIHN0b3JlLCBmZXRjaCkp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc3RvcmUoZmllbGQuZ2V0\nSW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAg\ndG9PYmplY3RWYWx1ZShmaWVsZCwgdmFsKSk7CiAgICB9Cn0K\n","encoding":"base64"}

