{"sha":"e9cfd684d5ae8fc46fba2dca29b8c1ae7c24af90","node_id":"MDQ6QmxvYjIwNjM2NDplOWNmZDY4NGQ1YWU4ZmM0NmZiYTJkY2EyOWI4YzFhZTdjMjRhZjkw","size":16016,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e9cfd684d5ae8fc46fba2dca29b8c1ae7c24af90","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuTm9TdWNoRWxlbWVudEV4\nY2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlVuaW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkNsb3Nl\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2Nh\nbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BYnN0cmFj\ndExSU1Byb3h5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW52YWxpZFN0YXRlRXhjZXB0aW9uOwoKLyoqCiAqIExhcmdlIHJlc3VsdCBz\nZXQgbWFwLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KY2xhc3MgTFJT\nUHJveHlNYXAKICAgIGV4dGVuZHMgQWJzdHJhY3RMUlNQcm94eU1hcCB7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2Nh\nbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChMUlNQcm94eU1hcC5jbGFzcyk7\nCgogICAgcHJpdmF0ZSBmaW5hbCBMUlNNYXBGaWVsZFN0cmF0ZWd5IF9zdHJh\ndDsKCiAgICBwdWJsaWMgTFJTUHJveHlNYXAoTFJTTWFwRmllbGRTdHJhdGVn\neSBzdHJhdCwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAg\nIHN1cGVyKHN0cmF0LmdldEZpZWxkTWFwcGluZygpLmdldEtleSgpLmdldERl\nY2xhcmVkVHlwZSgpLAogICAgICAgICAgICBzdHJhdC5nZXRGaWVsZE1hcHBp\nbmcoKS5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCksIGNvbmYpOwog\nICAgICAgIF9zdHJhdCA9IHN0cmF0OwogICAgfQoKICAgIHByb3RlY3RlZCBz\neW5jaHJvbml6ZWQgaW50IGNvdW50KCkgewogICAgICAgIGJvb2xlYW4gZGVy\naXZlZFZhbCA9IF9zdHJhdC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRFbGVtZW50\nKCkuCiAgICAgICAgICAgIGdldFZhbHVlTWFwcGVkQnkoKSAhPSBudWxsOwog\nICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIGNsc3MgPSAoZGVyaXZlZFZh\nbCkKICAgICAgICAgICAgPyBfc3RyYXQuZ2V0SW5kZXBlbmRlbnRLZXlNYXBw\naW5ncyhmYWxzZSkKICAgICAgICAgICAgOiBfc3RyYXQuZ2V0SW5kZXBlbmRl\nbnRWYWx1ZU1hcHBpbmdzKGZhbHNlKTsKICAgICAgICBmaW5hbCBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtID0gYXNzZXJ0T3duZXIoKTsKICAgICAgICBmaW5h\nbCBKREJDU3RvcmUgc3RvcmUgPSBnZXRTdG9yZSgpOwogICAgICAgIFVuaW9u\nIHVuaW9uID0gc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1VuaW9uCiAgICAg\nICAgICAgIChNYXRoLm1heCgxLCBjbHNzLmxlbmd0aCkpOwogICAgICAgIHVu\naW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAg\nICAgICAgICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gKGNsc3MubGVuZ3Ro\nID09IDApID8gbnVsbCA6IGNsc3NbaWR4XTsKICAgICAgICAgICAgICAgIHNl\nbC53aGVyZUZvcmVpZ25LZXkoX3N0cmF0LmdldEpvaW5Gb3JlaWduS2V5KGNs\ncyksCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgX3N0\ncmF0LmdldEZpZWxkTWFwcGluZygpLgogICAgICAgICAgICAgICAgICAgIGdl\ndERlZmluaW5nTWFwcGluZygpLCBzdG9yZSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9KTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHVu\naW9uLmdldENvdW50KHN0b3JlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzZSwgc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYXNLZXkoT2JqZWN0\nIGtleSkgewogICAgICAgIHJldHVybiBoYXMoa2V5LCB0cnVlKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYXNWYWx1ZShPYmplY3QgdmFsdWUp\nIHsKICAgICAgICByZXR1cm4gaGFzKHZhbHVlLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBib29sZWFuIGhhcyhmaW5hbCBPYmplY3Qgb2JqLCBmaW5h\nbCBib29sZWFuIGtleSkgewogICAgICAgIGZpbmFsIGJvb2xlYW4gZGVyaXZl\nZEtleSA9IGtleSAmJiBfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCkuCiAgICAg\nICAgICAgIGdldEtleSgpLmdldFZhbHVlTWFwcGVkQnkoKSAhPSBudWxsOwog\nICAgICAgIGZpbmFsIGJvb2xlYW4gZGVyaXZlZFZhbCA9ICFrZXkgJiYgX3N0\ncmF0LmdldEZpZWxkTWFwcGluZygpLgogICAgICAgICAgICBnZXRFbGVtZW50\nKCkuZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51bGw7CgogICAgICAgIGZpbmFs\nIENsYXNzTWFwcGluZ1tdIGNsc3MgPSAoKGtleSAmJiAhZGVyaXZlZEtleSkg\nfHwgZGVyaXZlZFZhbCkKICAgICAgICAgICAgPyBfc3RyYXQuZ2V0SW5kZXBl\nbmRlbnRLZXlNYXBwaW5ncyhkZXJpdmVkVmFsKQogICAgICAgICAgICA6IF9z\ndHJhdC5nZXRJbmRlcGVuZGVudFZhbHVlTWFwcGluZ3MoZGVyaXZlZEtleSk7\nCiAgICAgICAgZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGFzc2Vy\ndE93bmVyKCk7CiAgICAgICAgZmluYWwgSkRCQ1N0b3JlIHN0b3JlID0gZ2V0\nU3RvcmUoKTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxG\nYWN0b3J5KCkubmV3VW5pb24KICAgICAgICAgICAgKE1hdGgubWF4KDEsIGNs\nc3MubGVuZ3RoKSk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5T\nZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNl\nbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBjbHMgPSAoY2xzcy5sZW5ndGggPT0gMCkgPyBudWxsIDogY2xzc1tp\nZHhdOwogICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWlnbktleShfc3Ry\nYXQuZ2V0Sm9pbkZvcmVpZ25LZXkoY2xzKSwKICAgICAgICAgICAgICAgICAg\nICBzbS5nZXRPYmplY3RJZCgpLCBfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVmaW5pbmdNYXBwaW5nKCksIHN0\nb3JlKTsKCiAgICAgICAgICAgICAgICBKb2lucyBqb2lucyA9IG51bGw7CiAg\nICAgICAgICAgICAgICBDb2x1bW5bXSBjb2xzOwogICAgICAgICAgICAgICAg\nT2JqZWN0IHZhbDsKICAgICAgICAgICAgICAgIGlmIChrZXkpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAoZGVyaXZlZEtleSkKICAgICAgICAgICAgICAg\nICAgICAgICAgam9pbnMgPSBfc3RyYXQuam9pblZhbHVlUmVsYXRpb24oc2Vs\nLm5ld0pvaW5zKCksIGNscyk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0g\nX3N0cmF0LnRvS2V5RGF0YVN0b3JlVmFsdWUob2JqLCBzdG9yZSk7CiAgICAg\nICAgICAgICAgICAgICAgY29scyA9IF9zdHJhdC5nZXRLZXlDb2x1bW5zKGNs\ncyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIGlmIChkZXJpdmVkVmFsKQogICAgICAgICAgICAgICAgICAgICAgICBq\nb2lucyA9IF9zdHJhdC5qb2luS2V5UmVsYXRpb24oc2VsLm5ld0pvaW5zKCks\nIGNscyk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gX3N0cmF0LnRvRGF0\nYVN0b3JlVmFsdWUob2JqLCBzdG9yZSk7CiAgICAgICAgICAgICAgICAgICAg\nY29scyA9IF9zdHJhdC5nZXRWYWx1ZUNvbHVtbnMoY2xzKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIE9iamVjdFtdIHZhbHMgPSAoY29s\ncy5sZW5ndGggPT0gMSkgPyBudWxsIDogKE9iamVjdFtdKSB2YWw7CiAgICAg\nICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0gbmV3IFNRTEJ1ZmZlcihzdG9y\nZS5nZXREQkRpY3Rpb25hcnkoKSk7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHNx\nbC5hcHBlbmQoIiBBTkQgIik7CgogICAgICAgICAgICAgICAgICAgIHNxbC5h\ncHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbaV0sIGpvaW5zKSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHZhbHMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgodmFsID09IG51bGwpID8gIiBJ\nUyAiIDogIiA9ICIpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBw\nZW5kVmFsdWUodmFsLCBjb2xzW2ldKTsKICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoKHZhbHNb\naV0gPT0gbnVsbCkgPyAiIElTICIgOiAiID0gIikuCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhcHBlbmRWYWx1ZSh2YWxzW2ldLCBjb2xzW2ldKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbC53aGVyZShz\ncWwsIGpvaW5zKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICByZXR1cm4gdW5pb24uZ2V0Q291bnQoc3Rv\ncmUpID4gMDsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwg\nc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBrZXlzKGZpbmFsIE9iamVjdCBvYmop\nIHsKICAgICAgICBmaW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gYXNz\nZXJ0T3duZXIoKTsKICAgICAgICBmaW5hbCBKREJDU3RvcmUgc3RvcmUgPSBn\nZXRTdG9yZSgpOwogICAgICAgIGlmIChfc3RyYXQuZ2V0RmllbGRNYXBwaW5n\nKCkuZ2V0S2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51bGwpIHsKICAg\nICAgICAgICAgT2JqZWN0IGtleSA9IF9zdHJhdC5kZXJpdmVLZXkoc3RvcmUs\nIG9iaik7CiAgICAgICAgICAgIGlmIChoYXNLZXkoa2V5KSkKICAgICAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5zaW5nbGV0b24oa2V5KTsKICAg\nICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAg\nICAgfQoKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSBjbHNzID0gX3N0\ncmF0LmdldEluZGVwZW5kZW50S2V5TWFwcGluZ3ModHJ1ZSk7CiAgICAgICAg\nZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IHN0b3JlLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIGZpbmFsIEpvaW5zW10g\ncmVzSm9pbnMgPSBuZXcgSm9pbnNbTWF0aC5tYXgoMSwgY2xzcy5sZW5ndGgp\nXTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0b3J5\nKCkubmV3VW5pb24KICAgICAgICAgICAgKE1hdGgubWF4KDEsIGNsc3MubGVu\nZ3RoKSk7CiAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2Rl\nKF9zdHJhdC5nZXRGaWVsZE1hcHBpbmcoKS4KICAgICAgICAgICAgZ2V0S2V5\nTWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCkpICE9IGZldGNoLkVBR0VSX0pP\nSU4pCiAgICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICB1\nbmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGlkeCkgewog\nICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IChjbHNzLmxlbmd0\naCA9PSAwKSA/IG51bGwgOiBjbHNzW2lkeF07CiAgICAgICAgICAgICAgICBz\nZWwud2hlcmVGb3JlaWduS2V5KF9zdHJhdC5nZXRKb2luRm9yZWlnbktleShj\nbHMpLAogICAgICAgICAgICAgICAgICAgIHNtLmdldE9iamVjdElkKCksIF9z\ndHJhdC5nZXRGaWVsZE1hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUpOwogICAgICAgICAgICAgICAg\naWYgKF9zdHJhdC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRFbGVtZW50KCkuZ2V0\nVmFsdWVNYXBwZWRCeSgpCiAgICAgICAgICAgICAgICAgICAgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICByZXNKb2luc1tpZHhdID0gX3N0cmF0Lmpv\naW5LZXlSZWxhdGlvbihzZWwubmV3Sm9pbnMoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgY2xzKTsKCiAgICAgICAgICAgICAgICBPYmplY3QgdmFsID0g\nX3N0cmF0LnRvRGF0YVN0b3JlVmFsdWUob2JqLCBzdG9yZSk7CiAgICAgICAg\nICAgICAgICBDb2x1bW5bXSBjb2xzID0gX3N0cmF0LmdldFZhbHVlQ29sdW1u\ncyhjbHMpOwogICAgICAgICAgICAgICAgT2JqZWN0W10gdmFscyA9IChjb2xz\nLmxlbmd0aCA9PSAxKSA/IG51bGwgOiAoT2JqZWN0W10pIHZhbDsKICAgICAg\nICAgICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBuZXcgU1FMQnVmZmVyKHN0b3Jl\nLmdldERCRGljdGlvbmFyeSgpKTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgICAgIGlmIChpID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgc3Fs\nLmFwcGVuZCgiIEFORCAiKTsKCiAgICAgICAgICAgICAgICAgICAgc3FsLmFw\ncGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sc1tpXSkpOwogICAgICAgICAg\nICAgICAgICAgIGlmICh2YWxzID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNxbC5hcHBlbmQoKHZhbCA9PSBudWxsKSA/ICIgSVMgIiA6ICIg\nPSAiKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFZhbHVl\nKHZhbCwgY29sc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCh2YWxzW2ldID09IG51\nbGwpID8gIiBJUyAiIDogIiA9ICIpLgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYXBwZW5kVmFsdWUodmFsc1tpXSwgY29sc1tpXSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWwud2hlcmUoc3FsKTsKCiAg\nICAgICAgICAgICAgICBpZiAocmVzSm9pbnNbaWR4XSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIHJlc0pvaW5zW2lkeF0gPSBfc3RyYXQuam9pbktl\neVJlbGF0aW9uKHNlbC5uZXdKb2lucygpLAogICAgICAgICAgICAgICAgICAg\nICAgICBjbHMpOwogICAgICAgICAgICAgICAgX3N0cmF0LnNlbGVjdEtleShz\nZWwsIGNscywgc20sIHN0b3JlLCBmZXRjaCwgcmVzSm9pbnNbaWR4XSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgUmVzdWx0IHJlcyA9\nIG51bGw7CiAgICAgICAgQ29sbGVjdGlvbiBrZXlzID0gbmV3IEFycmF5TGlz\ndCgzKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXMgPSB1bmlvbi5l\neGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgICAgIHdoaWxlIChyZXMu\nbmV4dCgpKQogICAgICAgICAgICAgICAga2V5cy5hZGQoX3N0cmF0LmxvYWRL\nZXkoc20sIHN0b3JlLCBmZXRjaCwgcmVzLAogICAgICAgICAgICAgICAgICAg\nIHJlc0pvaW5zW3Jlcy5pbmRleE9mKCldKSk7CiAgICAgICAgICAgIHJldHVy\nbiBrZXlzOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBz\ndG9yZS5nZXREQkRpY3Rpb25hcnkoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmVzLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBP\nYmplY3QgdmFsdWUoZmluYWwgT2JqZWN0IG9iaikgewogICAgICAgIGZpbmFs\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBhc3NlcnRPd25lcigpOwogICAg\nICAgIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSA9IGdldFN0b3JlKCk7CiAgICAg\nICAgaWYgKF9zdHJhdC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRFbGVtZW50KCku\nZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51bGwpIHsKICAgICAgICAgICAgT2Jq\nZWN0IHZhbCA9IF9zdHJhdC5kZXJpdmVWYWx1ZShzdG9yZSwgb2JqKTsKICAg\nICAgICAgICAgaWYgKGhhc1ZhbHVlKHZhbCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdmFsOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nCgogICAgICAgIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gg\nPSBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBmaW5h\nbCBDbGFzc01hcHBpbmdbXSBjbHNzID0gX3N0cmF0LmdldEluZGVwZW5kZW50\nVmFsdWVNYXBwaW5ncyh0cnVlKTsKICAgICAgICBmaW5hbCBKb2luc1tdIHJl\nc0pvaW5zID0gbmV3IEpvaW5zW01hdGgubWF4KDEsIGNsc3MubGVuZ3RoKV07\nCiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0b3J5KCku\nbmV3VW5pb24KICAgICAgICAgICAgKE1hdGgubWF4KDEsIGNsc3MubGVuZ3Ro\nKSk7CiAgICAgICAgdW5pb24uc2V0U2luZ2xlUmVzdWx0KHRydWUpOwogICAg\nICAgIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShfc3RyYXQuZ2V0\nRmllbGRNYXBwaW5nKCkuCiAgICAgICAgICAgIGdldEVsZW1lbnRNYXBwaW5n\nKCkuZ2V0VHlwZU1hcHBpbmcoKSkKICAgICAgICAgICAgIT0gSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKQogICAgICAgICAgICB1bmlvbi5h\nYm9ydFVuaW9uKCk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5T\nZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNl\nbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBjbHMgPSAoY2xzcy5sZW5ndGggPT0gMCkgPyBudWxsIDogY2xzc1tp\nZHhdOwogICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWlnbktleShfc3Ry\nYXQuZ2V0Sm9pbkZvcmVpZ25LZXkoY2xzKSwKICAgICAgICAgICAgICAgICAg\nICBzbS5nZXRPYmplY3RJZCgpLCBfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVmaW5pbmdNYXBwaW5nKCksIHN0\nb3JlKTsKICAgICAgICAgICAgICAgIGlmIChfc3RyYXQuZ2V0RmllbGRNYXBw\naW5nKCkuZ2V0S2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpCiAgICAgICAgICAg\nICAgICAgICAgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXNKb2lu\nc1tpZHhdID0gX3N0cmF0LmpvaW5WYWx1ZVJlbGF0aW9uKHNlbC5uZXdKb2lu\ncygpLAogICAgICAgICAgICAgICAgICAgICAgICBjbHMpOwoKICAgICAgICAg\nICAgICAgIE9iamVjdCBrZXkgPSBfc3RyYXQudG9LZXlEYXRhU3RvcmVWYWx1\nZShvYmosIHN0b3JlKTsKICAgICAgICAgICAgICAgIENvbHVtbltdIGNvbHMg\nPSBfc3RyYXQuZ2V0S2V5Q29sdW1ucyhjbHMpOwogICAgICAgICAgICAgICAg\nT2JqZWN0W10gdmFscyA9IChjb2xzLmxlbmd0aCA9PSAxKSA/IG51bGwgOiAo\nT2JqZWN0W10pIGtleTsKICAgICAgICAgICAgICAgIFNRTEJ1ZmZlciBzcWwg\nPSBuZXcgU1FMQnVmZmVyKHN0b3JlLmdldERCRGljdGlvbmFyeSgpKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiIEFORCAiKTsKCiAgICAg\nICAgICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMo\nY29sc1tpXSwgcmVzSm9pbnNbaWR4XSkpOwogICAgICAgICAgICAgICAgICAg\nIGlmICh2YWxzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNx\nbC5hcHBlbmQoKGtleSA9PSBudWxsKSA/ICIgSVMgIiA6ICIgPSAiKS4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFZhbHVlKGtleSwgY29s\nc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICBzcWwuYXBwZW5kKCh2YWxzW2ldID09IG51bGwpID8gIiBJ\nUyAiIDogIiA9ICIpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBw\nZW5kVmFsdWUodmFsc1tpXSwgY29sc1tpXSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBzZWwud2hlcmUoc3FsLCByZXNKb2luc1tpZHhd\nKTsKCiAgICAgICAgICAgICAgICBpZiAocmVzSm9pbnNbaWR4XSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHJlc0pvaW5zW2lkeF0gPSBfc3RyYXQu\nam9pblZhbHVlUmVsYXRpb24oc2VsLm5ld0pvaW5zKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNscyk7CiAgICAgICAgICAgICAgICBfc3RyYXQuc2Vs\nZWN0VmFsdWUoc2VsLCBjbHMsIHNtLCBzdG9yZSwgZmV0Y2gsIHJlc0pvaW5z\nW2lkeF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIFJl\nc3VsdCByZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ncyA9IHVuaW9uLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsKICAgICAgICAgICAg\naWYgKHJlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gX3N0cmF0\nLmxvYWRWYWx1ZShzbSwgc3RvcmUsIGZldGNoLCByZXMsCiAgICAgICAgICAg\nICAgICAgICAgcmVzSm9pbnNbcmVzLmluZGV4T2YoKV0pOwogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9y\nZShzZSwgc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90\nZWN0ZWQgSXRlcmF0b3IgaXRyKCkgewogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20gPSBhc3NlcnRPd25lcigpOwogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSA9IGdldFN0b3JlKCk7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCA9IHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEpvaW5zW10gam9pbnMgPSBuZXcg\nSm9pbnNbMl07CiAgICAgICAgICAgIFJlc3VsdFtdIHJlcyA9IF9zdHJhdC5n\nZXRSZXN1bHRzKHNtLCBzdG9yZSwgZmV0Y2gsIGZldGNoLkVBR0VSX0pPSU4s\nCiAgICAgICAgICAgICAgICBqb2lucywgdHJ1ZSk7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgUmVzdWx0SXRlcmF0b3Ioc20sIHN0b3JlLCBmZXRjaCwgcmVz\nLCBqb2lucyk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nCiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2Us\nIHN0b3JlLmdldERCRGljdGlvbmFyeSgpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSBPcGVuSlBBU3RhdGVNYW5hZ2VyIGFzc2VydE93bmVyKCkg\newogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBnZXRPd25lcigp\nOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJscnMtbm8tb3du\nZXIiLAogICAgICAgICAgICAgICAgX3N0cmF0LmdldEZpZWxkTWFwcGluZygp\nKSk7CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIHByaXZhdGUgSkRC\nQ1N0b3JlIGdldFN0b3JlKCkgewogICAgICAgIHJldHVybiAoSkRCQ1N0b3Jl\nKSBnZXRPd25lcigpLmdldENvbnRleHQoKS5nZXRTdG9yZU1hbmFnZXIoKS4K\nICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENsb3NlYWJsZSBpdGVyYXRvciBidWlsdCBhcm91bmQg\na2V5IGFuZCB2YWx1ZSBKREJDIHJlc3VsdHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgY2xhc3MgUmVzdWx0SXRlcmF0b3IKICAgICAgICBpbXBsZW1lbnRzIEl0\nZXJhdG9yLCBDbG9zZWFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgX3NtOwogICAgICAgIHByaXZhdGUgZmluYWwg\nSkRCQ1N0b3JlIF9zdG9yZTsKICAgICAgICBwcml2YXRlIGZpbmFsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gX2ZldGNoOwogICAgICAgIHByaXZhdGUgZmlu\nYWwgUmVzdWx0W10gX3JlczsKICAgICAgICBwcml2YXRlIGZpbmFsIEpvaW5z\nW10gX2pvaW5zOwogICAgICAgIHByaXZhdGUgQm9vbGVhbiBfbmV4dCA9IG51\nbGw7CgogICAgICAgIHB1YmxpYyBSZXN1bHRJdGVyYXRvcihPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdFtdIHJlcywgSm9p\nbnNbXSBqb2lucykgewogICAgICAgICAgICBfc20gPSBzbTsKICAgICAgICAg\nICAgX3N0b3JlID0gc3RvcmU7CiAgICAgICAgICAgIF9mZXRjaCA9IGZldGNo\nOwogICAgICAgICAgICBfcmVzID0gcmVzOwogICAgICAgICAgICBfam9pbnMg\nPSBqb2luczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc05leHQoKSB7CiAgICAgICAgICAgIGlmIChfbmV4dCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIF9uZXh0\nID0gKF9yZXNbMF0ubmV4dCgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9uZXh0LmJvb2xlYW5W\nYWx1ZSgpICYmIF9yZXNbMV0gIT0gX3Jlc1swXSkKICAgICAgICAgICAgICAg\nICAgICAgICAgX3Jlc1sxXS5uZXh0KCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfc3RvcmUuZ2V0REJE\naWN0aW9uYXJ5KCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBfbmV4dC5ib29sZWFuVmFsdWUoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAgICAg\nICAgICAgaWYgKCFoYXNOZXh0KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTm9TdWNoRWxlbWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICBfbmV4\ndCA9IG51bGw7CgogICAgICAgICAgICBib29sZWFuIGtleURlcml2ZWQgPSBf\nc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0S2V5KCkuCiAgICAgICAgICAg\nICAgICBnZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbDsKICAgICAgICAgICAg\nYm9vbGVhbiB2YWxEZXJpdmVkID0gX3N0cmF0LmdldEZpZWxkTWFwcGluZygp\nLmdldEVsZW1lbnQoKS4KICAgICAgICAgICAgICAgIGdldFZhbHVlTWFwcGVk\nQnkoKSAhPSBudWxsOwogICAgICAgICAgICBFbnRyeSBlbnRyeSA9IG5ldyBF\nbnRyeSgpOwogICAgICAgICAgICB0cnkgewoKICAgICAgICAgICAgICAgIGlm\nICgha2V5RGVyaXZlZCkKICAgICAgICAgICAgICAgICAgICBlbnRyeS5rZXkg\nPSBfc3RyYXQubG9hZEtleShfc20sIF9zdG9yZSwgX2ZldGNoLCBfcmVzWzBd\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zWzBdKTsKICAgICAg\nICAgICAgICAgIGlmICghdmFsRGVyaXZlZCkKICAgICAgICAgICAgICAgICAg\nICBlbnRyeS52YWwgPSBfc3RyYXQubG9hZFZhbHVlKF9zbSwgX3N0b3JlLCBf\nZmV0Y2gsIF9yZXNbMV0sIAogICAgICAgICAgICAgICAgICAgICAgICBfam9p\nbnNbMV0pOwogICAgICAgICAgICAgICAgaWYgKGtleURlcml2ZWQpCiAgICAg\nICAgICAgICAgICAgICAgZW50cnkua2V5ID0gX3N0cmF0LmRlcml2ZUtleShf\nc3RvcmUsIGVudHJ5LnZhbCk7CiAgICAgICAgICAgICAgICBpZiAodmFsRGVy\naXZlZCkKICAgICAgICAgICAgICAgICAgICBlbnRyeS52YWwgPSBfc3RyYXQu\nZGVyaXZlVmFsdWUoX3N0b3JlLCBlbnRyeS5rZXkpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGVudHJ5OwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlv\nbnMuZ2V0U3RvcmUoc2UsIF9zdG9yZS5nZXREQkRpY3Rpb25hcnkoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJl\nbW92ZSgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3Bl\ncmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBjbG9zZSgpIHsKICAgICAgICAgICAgX25leHQgPSBCb29sZWFuLkZB\nTFNFOwogICAgICAgICAgICBfcmVzWzBdLmNsb3NlKCk7CiAgICAgICAgICAg\nIGlmIChfcmVzWzFdICE9IF9yZXNbMF0pCiAgICAgICAgICAgICAgICBfcmVz\nWzFdLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTWFwLkVudHJ5IHN0cnVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nY2xhc3MgRW50cnkKICAgICAgICBpbXBsZW1lbnRzIE1hcC5FbnRyeSB7Cgog\nICAgICAgIHB1YmxpYyBPYmplY3Qga2V5OwogICAgICAgIHB1YmxpYyBPYmpl\nY3QgdmFsOwoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldEtleSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0VmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB2YWw7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHNldFZhbHVlKE9i\namVjdCB2YWwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVk\nT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQp9Cgo=\n","encoding":"base64"}

