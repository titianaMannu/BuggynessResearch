{"sha":"e80afea8a36eba93c3e2248d348c037ec0afd6b7","node_id":"MDQ6QmxvYjIwNjM2NDplODBhZmVhOGEzNmViYTkzYzNlMjI0OGQzNDhjMDM3ZWMwYWZkNmI3","size":34458,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e80afea8a36eba93c3e2248d348c037ec0afd6b7","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQg\namF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRW1iZWRkYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2lu\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuTWFw\ncGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVjdXRvcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5VbmlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNhdGlvbklkczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBNYXBw\naW5nIGZvciBhIHNpbmdsZS12YWx1ZWQgcmVsYXRpb24gdG8gYW5vdGhlciBl\nbnRpdHkuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBzaW5jZSAwLjQu\nMAogKi8KcHVibGljIGNsYXNzIFJlbGF0aW9uRmllbGRTdHJhdGVneQogICAg\nZXh0ZW5kcyBBYnN0cmFjdEZpZWxkU3RyYXRlZ3kKICAgIGltcGxlbWVudHMg\nSm9pbmFibGUsIEVtYmVkZGFibGUgewoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAg\nICAgICAoUmVsYXRpb25GaWVsZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcml2\nYXRlIEJvb2xlYW4gX2ZrT2lkID0gbnVsbDsKCiAgICBwdWJsaWMgdm9pZCBt\nYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChmaWVsZC5nZXRUeXBl\nQ29kZSgpICE9IEphdmFUeXBlcy5QQyB8fCBmaWVsZC5pc0VtYmVkZGVkUEMo\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub3QtcmVsYXRpb24iLCBmaWVsZCkpOwoKICAgICAgICBmaWVs\nZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hl\nbWFDb21wb25lbnRzCiAgICAgICAgICAgIChmaWVsZC5nZXRLZXkoKSwgIWFk\nYXB0KTsKICAgICAgICBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFZh\nbHVlSW5mbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cwogICAgICAgICAg\nICAoZmllbGQuZ2V0RWxlbWVudCgpLCAhYWRhcHQpOwogICAgICAgIGJvb2xl\nYW4gY3JpdGVyaWEgPSBmaWVsZC5nZXRWYWx1ZUluZm8oKS5nZXRVc2VDbGFz\nc0NyaXRlcmlhKCk7CgogICAgICAgIC8vIGNoZWNrIGZvciBuYW1lZCBpbnZl\ncnNlCiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZCA9IGZpZWxkLmdldE1h\ncHBlZEJ5TWFwcGluZygpOwogICAgICAgIGlmIChtYXBwZWQgIT0gbnVsbCkg\newogICAgICAgICAgICBmaWVsZC5nZXRNYXBwaW5nSW5mbygpLmFzc2VydE5v\nU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsKICAgICAgICAgICAg\nZmllbGQuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRz\nKGZpZWxkLCAhYWRhcHQpOwogICAgICAgICAgICBtYXBwZWQucmVzb2x2ZSht\nYXBwZWQuTU9ERV9NRVRBIHwgbWFwcGVkLk1PREVfTUFQUElORyk7CgogICAg\nICAgICAgICBpZiAoIW1hcHBlZC5nZXREZWZpbmluZ01hcHBpbmcoKS5pc01h\ncHBlZCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJtYXBwZWQtYnktdW5tYXBwZWQiLAogICAgICAg\nICAgICAgICAgICAgIGZpZWxkLCBtYXBwZWQpKTsKCiAgICAgICAgICAgIGlm\nIChtYXBwZWQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIHsKICAg\nICAgICAgICAgICAgIGlmIChtYXBwZWQuZ2V0Sm9pbkRpcmVjdGlvbigpID09\nIG1hcHBlZC5KT0lOX0ZPUldBUkQpIHsKICAgICAgICAgICAgICAgICAgICBm\naWVsZC5zZXRKb2luRGlyZWN0aW9uKGZpZWxkLkpPSU5fSU5WRVJTRSk7CiAg\nICAgICAgICAgICAgICAgICAgZmllbGQuc2V0Q29sdW1ucyhtYXBwZWQuZ2V0\nRGVmaW5pbmdNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICAgICAgICAgIGdl\ndFByaW1hcnlLZXlDb2x1bW5zKCkpOwogICAgICAgICAgICAgICAgfSBlbHNl\nIGlmIChpc1R5cGVVbmpvaW5lZFN1YmNsYXNzKG1hcHBlZCkpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgibWFwcGVkLWludmVyc2Ut\ndW5qb2luZWQiLCBmaWVsZC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgbWFwcGVk\nKSk7CgogICAgICAgICAgICAgICAgZmllbGQuc2V0Rm9yZWlnbktleShtYXBw\nZWQuZ2V0Rm9yZWlnbktleQogICAgICAgICAgICAgICAgICAgIChmaWVsZC5n\nZXREZWZpbmluZ01hcHBpbmcoKSkpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKG1hcHBlZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlw\nZXMuUEMpIHsKICAgICAgICAgICAgICAgIGlmIChpc1R5cGVVbmpvaW5lZFN1\nYmNsYXNzKG1hcHBlZC5nZXRFbGVtZW50TWFwcGluZygpKSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJtYXBwZWQtaW52ZXJzZS11\nbmpvaW5lZCIsIGZpZWxkLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpLCBtYXBwZWQp\nKTsKCiAgICAgICAgICAgICAgICAvLyB3YXJuIHRoZSB1c2VyIGFib3V0IG1h\na2luZyB0aGUgY29sbGVjdGlvbiBzaWRlIHRoZSBvd25lcgogICAgICAgICAg\nICAgICAgTG9nIGxvZyA9IGZpZWxkLmdldFJlcG9zaXRvcnkoKS5nZXRMb2co\nKTsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNJbmZvRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJjb2xsLW93\nbmVyIiwgZmllbGQsIG1hcHBlZCkpOwogICAgICAgICAgICAgICAgZmllbGQu\nc2V0Rm9yZWlnbktleShtYXBwZWQuZ2V0RWxlbWVudE1hcHBpbmcoKS4KICAg\nICAgICAgICAgICAgICAgICBnZXRGb3JlaWduS2V5KCkpOwogICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgibm90LWludi1yZWxhdGlvbiIsCiAgICAgICAg\nICAgICAgICAgICAgZmllbGQsIG1hcHBlZCkpOwoKICAgICAgICAgICAgZmll\nbGQuc2V0VXNlQ2xhc3NDcml0ZXJpYShjcml0ZXJpYSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIHRoaXMgaXMgbmVjZXNz\nYXJ5IHRvIHN1cHBvcnQgb3BlbmpwYSAzIG1hcHBpbmdzLCB3aGljaCBkaWRu\nJ3QKICAgICAgICAvLyBkaWZmZXJlbnRpYXRlIGJldHdlZW4gc2Vjb25kYXJ5\nIHRhYmxlIGpvaW5zIGFuZCByZWxhdGlvbnMgYnVpbHQKICAgICAgICAvLyBh\ncm91bmQgYW4gaW52ZXJzZSBrZXk6IGNoZWNrIHRvIHNlZSBpZiB3ZSdyZSBt\nYXBwZWQgYXMgYSBzZWNvbmRhcnkKICAgICAgICAvLyB0YWJsZSBqb2luIGJ1\ndCB3ZSdyZSBpbiB0aGUgdGFibGUgb2YgdGhlIHJlbGF0ZWQgdHlwZSwgYW5k\nIGlmIHNvCiAgICAgICAgLy8gc3dpdGNoIG91ciBqb2luIG1hcHBpbmcgaW5m\nbyB0byBvdXIgdmFsdWUgbWFwcGluZyBpbmZvCiAgICAgICAgU3RyaW5nIHRh\nYmxlTmFtZSA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCkuZ2V0VGFibGVOYW1l\nKCk7CiAgICAgICAgVGFibGUgdGFibGUgPSBmaWVsZC5nZXRUeXBlTWFwcGlu\nZygpLmdldFRhYmxlKCk7CiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyB2aW5m\nbyA9IGZpZWxkLmdldFZhbHVlSW5mbygpOwogICAgICAgIGlmICh0YWJsZU5h\nbWUgIT0gbnVsbCAmJiB0YWJsZSAhPSBudWxsCiAgICAgICAgICAgICYmICh0\nYWJsZU5hbWUuZXF1YWxzSWdub3JlQ2FzZSh0YWJsZS5nZXROYW1lKCkpCiAg\nICAgICAgICAgIHx8IHRhYmxlTmFtZS5lcXVhbHNJZ25vcmVDYXNlKHRhYmxl\nLmdldEZ1bGxOYW1lKCkpKSkgewogICAgICAgICAgICB2aW5mby5zZXRKb2lu\nRGlyZWN0aW9uKE1hcHBpbmdJbmZvLkpPSU5fSU5WRVJTRSk7CiAgICAgICAg\nICAgIHZpbmZvLnNldENvbHVtbnMoZmllbGQuZ2V0TWFwcGluZ0luZm8oKS5n\nZXRDb2x1bW5zKCkpOwogICAgICAgICAgICBmaWVsZC5nZXRNYXBwaW5nSW5m\nbygpLnNldFRhYmxlTmFtZShudWxsKTsKICAgICAgICAgICAgZmllbGQuZ2V0\nTWFwcGluZ0luZm8oKS5zZXRDb2x1bW5zKG51bGwpOwogICAgICAgIH0KCiAg\nICAgICAgZmllbGQubWFwSm9pbihhZGFwdCwgZmFsc2UpOwogICAgICAgIGlm\nIChmaWVsZC5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkpIHsKICAgICAg\nICAgICAgRm9yZWlnbktleSBmayA9IHZpbmZvLmdldFR5cGVKb2luKGZpZWxk\nLCBmaWVsZC5nZXROYW1lKCksIHRydWUsCiAgICAgICAgICAgICAgICBhZGFw\ndCk7CiAgICAgICAgICAgIGZpZWxkLnNldEZvcmVpZ25LZXkoZmspOwogICAg\nICAgICAgICBmaWVsZC5zZXRDb2x1bW5JTyh2aW5mby5nZXRDb2x1bW5JTygp\nKTsKICAgICAgICAgICAgaWYgKHZpbmZvLmdldEpvaW5EaXJlY3Rpb24oKSA9\nPSB2aW5mby5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAgICAgICBmaWVsZC5z\nZXRKb2luRGlyZWN0aW9uKGZpZWxkLkpPSU5fSU5WRVJTRSk7CiAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgIFJlbGF0aW9uU3RyYXRlZ2llcy5tYXBSZWxh\ndGlvblRvVW5tYXBwZWRQQyhmaWVsZCwgZmllbGQuZ2V0TmFtZSgpLAogICAg\nICAgICAgICAgICAgYWRhcHQpOwoKICAgICAgICBmaWVsZC5zZXRVc2VDbGFz\nc0NyaXRlcmlhKGNyaXRlcmlhKTsKICAgICAgICBmaWVsZC5tYXBQcmltYXJ5\nS2V5KGFkYXB0KTsKICAgICAgICBQcmltYXJ5S2V5IHBrID0gZmllbGQuZ2V0\nVGFibGUoKS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgaWYgKGZpZWxkLmlz\nUHJpbWFyeUtleSgpKSB7CiAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSBm\naWVsZC5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIGlmIChwayAhPSBudWxs\nICYmIChhZGFwdCB8fCBway5pc0xvZ2ljYWwoKSkpCiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICAgICAgcGsuYWRkQ29sdW1uKGNvbHNbaV0pOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKS5zZXRK\nb2luYWJsZShjb2xzW2ldLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8v\nIG1hcCBjb25zdHJhaW50cyBhZnRlciBwayBzbyB3ZSBkb24ndCByZS1pbmRl\neCAvIHJlLXVuaXF1ZSBwayBjb2wKICAgICAgICBmaWVsZC5tYXBDb25zdHJh\naW50cyhmaWVsZC5nZXROYW1lKCksIGFkYXB0KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIG91ciBkZWZpbmluZyBtYXBwaW5nIGlz\nIGFuIHVuam9pbmVkIHN1YmNsYXNzIG9mCiAgICAgKiB0aGUgdHlwZSBvZiB0\naGUgZ2l2ZW4gdmFsdWUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBp\nc1R5cGVVbmpvaW5lZFN1YmNsYXNzKFZhbHVlTWFwcGluZyBtYXBwZWQpIHsK\nICAgICAgICBDbGFzc01hcHBpbmcgZGVmID0gZmllbGQuZ2V0RGVmaW5pbmdN\nYXBwaW5nKCk7CiAgICAgICAgZm9yICg7IGRlZiAhPSBudWxsOyBkZWYgPSBk\nZWYuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpCiAgICAgICAg\nICAgIGlmIChkZWYgPT0gbWFwcGVkLmdldFR5cGVNYXBwaW5nKCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsKICAgICAg\nICBmaWVsZC5zZXRVc2VzSW50ZXJtZWRpYXRlKHRydWUpOwoKICAgICAgICBG\nb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0Rm9yZWlnbktleSgpOwogICAgICAg\nIGlmIChmayA9PSBudWxsKQogICAgICAgICAgICBfZmtPaWQgPSBCb29sZWFu\nLlRSVUU7CiAgICAgICAgZWxzZSBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlv\nbigpICE9IEZpZWxkTWFwcGluZy5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAg\nIF9ma09pZCA9IGZpZWxkLmdldFR5cGVNYXBwaW5nKCkuaXNGb3JlaWduS2V5\nT2JqZWN0SWQoZmspOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluc2VydChP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01h\nbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGZpZWxkLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHJlbCA9\nIFJlbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIKICAgICAgICAg\nICAgKHNtLmZldGNoT2JqZWN0RmllbGQoZmllbGQuZ2V0SW5kZXgoKSksIHN0\nb3JlLmdldENvbnRleHQoKSk7CiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5E\naXJlY3Rpb24oKSA9PSBmaWVsZC5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAg\nIHVwZGF0ZUludmVyc2Uoc20sIHJlbCwgc3RvcmUsIHJtKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgUm93IHJvdyA9IGZpZWxkLmdldFJvdyhzbSwg\nc3RvcmUsIHJtLCBSb3cuQUNUSU9OX0lOU0VSVCk7CiAgICAgICAgICAgIGlm\nIChyb3cgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZpZWxkLnNldEZvcmVp\nZ25LZXkocm93LCByZWwpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3Jl\nIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciByZWwgPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5h\nZ2VyCiAgICAgICAgICAgIChzbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkLmdl\ndEluZGV4KCkpLCBzdG9yZS5nZXRDb250ZXh0KCkpOwoKICAgICAgICBpZiAo\nZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpPSU5fSU5WRVJT\nRSkgewogICAgICAgICAgICBudWxsSW52ZXJzZShzbSwgcm0pOwogICAgICAg\nICAgICB1cGRhdGVJbnZlcnNlKHNtLCByZWwsIHN0b3JlLCBybSk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgUm93IHJvdyA9IGZpZWxkLmdldFJv\ndyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNUSU9OX1VQREFURSk7CiAgICAgICAg\nICAgIGlmIChyb3cgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZpZWxkLnNl\ndEZvcmVpZ25LZXkocm93LCByZWwpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBkZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRC\nQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGZp\nZWxkLmdldEpvaW5EaXJlY3Rpb24oKSA9PSBmaWVsZC5KT0lOX0lOVkVSU0Up\nIHsKICAgICAgICAgICAgaWYgKHNtLmdldExvYWRlZCgpLmdldChmaWVsZC5n\nZXRJbmRleCgpKSkgewogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciByZWwgPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2Vy\nKHNtLgogICAgICAgICAgICAgICAgICAgIGZldGNoT2JqZWN0RmllbGQoZmll\nbGQuZ2V0SW5kZXgoKSksIHN0b3JlLmdldENvbnRleHQoKSk7CiAgICAgICAg\nICAgICAgICB1cGRhdGVJbnZlcnNlKHNtLCByZWwsIHN0b3JlLCBybSk7CiAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgbnVsbEludmVyc2Uo\nc20sIHJtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWVsZC5k\nZWxldGVSb3coc20sIHN0b3JlLCBybSk7CgogICAgICAgICAgICAvLyBpZiBv\ndXIgZm9yZWlnbiBrZXkgaGFzIGEgZGVsZXRlIGFjdGlvbiwgd2UgbmVlZCB0\nbyBzZXQgdGhlCiAgICAgICAgICAgIC8vIHJlbGF0ZWQgb2JqZWN0IHNvIGNv\nbnN0cmFpbnRzIGNhbiBiZSBldmFsdWF0ZWQKICAgICAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciByZWwgPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3Rh\ndGVNYW5hZ2VyCiAgICAgICAgICAgICAgICAoc20uZmV0Y2hPYmplY3RGaWVs\nZChmaWVsZC5nZXRJbmRleCgpKSwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAg\nICAgICAgICAgaWYgKHJlbCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBG\nb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0Rm9yZWlnbktleSgoQ2xhc3NNYXBw\naW5nKQogICAgICAgICAgICAgICAgICAgIHJlbC5nZXRNZXRhRGF0YSgpKTsK\nICAgICAgICAgICAgICAgIGlmIChmay5nZXREZWxldGVBY3Rpb24oKSA9PSBG\nb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVCkgewogICAgICAgICAgICAgICAg\nICAgIFJvdyByb3cgPSBmaWVsZC5nZXRSb3coc20sIHN0b3JlLCBybSwgUm93\nLkFDVElPTl9ERUxFVEUpOwogICAgICAgICAgICAgICAgICAgIHJvdy5zZXRG\nb3JlaWduS2V5KGZrLCBudWxsLCByZWwpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nTnVsbCBpbnZlcnNlIHJlbGF0aW9ucyB0aGF0IHJlZmVyZW5jZSB0aGUgZ2l2\nZW4gb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbnVsbEludmVy\nc2UoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUm93TWFuYWdlciBybSkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQu\nZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIEZvcmVpZ25LZXkgZmsgPSBmaWVsZC5nZXRGb3JlaWduS2V5KCk7\nCiAgICAgICAgQ29sdW1uSU8gaW8gPSBmaWVsZC5nZXRDb2x1bW5JTygpOwog\nICAgICAgIGlmICghaW8uaXNBbnlVcGRhdGFibGUoZmssIHRydWUpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG51bGwgaW52ZXJzZSBpZiBu\nb3QgYWxyZWFkeSBlbmZvcmNlZCBieSBmawogICAgICAgIGlmIChmaWVsZC5n\nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpLmxlbmd0aCAhPSAxKQogICAg\nICAgICAgICB0aHJvdyBSZWxhdGlvblN0cmF0ZWdpZXMudW5pbnZlcnNhYmxl\nKGZpZWxkKTsKICAgICAgICBSb3cgcm93ID0gcm0uZ2V0QWxsUm93cyhmay5n\nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX1VQREFURSk7CiAgICAgICAgcm93LnNl\ndEZvcmVpZ25LZXkoZmssIGlvLCBudWxsKTsKICAgICAgICByb3cud2hlcmVG\nb3JlaWduS2V5KGZrLCBzbSk7CiAgICAgICAgcm0uZmx1c2hBbGxSb3dzKHJv\ndyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCB1cGRhdGVz\nIHRoZSBpbnZlcnNlIGNvbHVtbnMgb2Ygb3VyIHJlbGF0aW9uCiAgICAgKiB3\naXRoIHRoZSBnaXZlbiBvYmplY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB1cGRhdGVJbnZlcnNlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgcmVsLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwg\nUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgRm9yZWlnbktleSBmayA9IGZpZWxkLmdldEZvcmVpZ25LZXko\nKTsKICAgICAgICBDb2x1bW5JTyBpbyA9IGZpZWxkLmdldENvbHVtbklPKCk7\nCgogICAgICAgIGludCBhY3Rpb247CiAgICAgICAgaWYgKHJlbC5pc05ldygp\nICYmICFyZWwuaXNGbHVzaGVkKCkpIHsKICAgICAgICAgICAgaWYgKHNtLmlz\nRGVsZXRlZCgpIHx8ICFpby5pc0FueUluc2VydGFibGUoZmssIGZhbHNlKSkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYWN0aW9uID0g\nUm93LkFDVElPTl9JTlNFUlQ7CiAgICAgICAgfSBlbHNlIGlmIChyZWwuaXNE\nZWxldGVkKCkpIHsKICAgICAgICAgICAgaWYgKHJlbC5pc0ZsdXNoZWQoKSB8\nfCAhc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05fREVMRVRFOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzbS5pc0RlbGV0ZWQoKSkKICAg\nICAgICAgICAgICAgIHNtID0gbnVsbDsKICAgICAgICAgICAgaWYgKCFpby5p\nc0FueVVwZGF0YWJsZShmaywgc20gPT0gbnVsbCkpCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05fVVBE\nQVRFOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxkLmdldEluZGVwZW5k\nZW50VHlwZU1hcHBpbmdzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRo\ncm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmludmVyc2FibGUoZmllbGQpOwoK\nICAgICAgICAvLyBnZXQgdGhlIHJvdyBmb3IgdGhlIGludmVyc2Ugb2JqZWN0\nOyB0aGUgcm93IG1pZ2h0IGJlIGluIGEgc2Vjb25kYXJ5CiAgICAgICAgLy8g\ndGFibGUgaWYgdGhlcmUgaXMgYSBmaWVsZCBjb250cm9sbGluZyB0aGUgZm9y\nZWlnbiBrZXkKICAgICAgICBSb3cgcm93ID0gbnVsbDsKICAgICAgICBGaWVs\nZE1hcHBpbmdbXSBpbnZzID0gZmllbGQuZ2V0SW52ZXJzZU1hcHBpbmdzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpbnZzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChpbnZzW2ldLmdldE1hcHBlZEJ5TWV0YURh\ndGEoKSA9PSBmaWVsZAogICAgICAgICAgICAgICAgJiYgaW52c1tpXS5nZXRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAg\ncm93ID0gaW52c1tpXS5nZXRSb3cocmVsLCBzdG9yZSwgcm0sIGFjdGlvbik7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBDbGFzc01hcHBpbmcgcmVsTWFwcGluZyA9IGZpZWxkLmdl\ndFR5cGVNYXBwaW5nKCk7CiAgICAgICAgaWYgKHJvdyA9PSBudWxsKQogICAg\nICAgICAgICByb3cgPSBybS5nZXRSb3cocmVsTWFwcGluZy5nZXRUYWJsZSgp\nLCBhY3Rpb24sIHJlbCwgdHJ1ZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMg\nYW4gdXBkYXRlLCB0aGlzIG1pZ2h0IGJlIHRoZSBvbmx5IG1vZCB0byB0aGUg\ncm93LCBzbwogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgd2hlcmUgY29uZGl0\naW9uIGlzIHNldAogICAgICAgIGlmIChhY3Rpb24gPT0gUm93LkFDVElPTl9V\nUERBVEUKICAgICAgICAgICAgJiYgcm93LmdldFRhYmxlKCkgPT0gcmVsTWFw\ncGluZy5nZXRUYWJsZSgpKQogICAgICAgICAgICByb3cud2hlcmVQcmltYXJ5\nS2V5KHJlbCk7CgogICAgICAgIC8vIHVwZGF0ZSB0aGUgaW52ZXJzZSBwb2lu\ndGVyIHdpdGggb3VyIG9pZCB2YWx1ZQogICAgICAgIHJvdy5zZXRGb3JlaWdu\nS2V5KGZrLCBpbywgc20pOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc3VwcG9y\ndHNTZWxlY3QoU2VsZWN0IHNlbCwgaW50IHR5cGUsIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gU2Vs\nZWN0LlRZUEVfSk9JTkxFU1MpCiAgICAgICAgICAgIHJldHVybiAoZmllbGQu\nZ2V0Sm9pbkRpcmVjdGlvbigpICE9IGZpZWxkLkpPSU5fSU5WRVJTRQogICAg\nICAgICAgICAgICAgJiYgc2VsLmlzU2VsZWN0ZWQoZmllbGQuZ2V0VGFibGUo\nKSkpID8gMSA6IDA7CiAgICAgICAgaWYgKHR5cGUgPT0gU2VsZWN0LlRZUEVf\nVFdPX1BBUlQpCiAgICAgICAgICAgIHJldHVybiAxOwoKICAgICAgICAvLyBh\nbHJlYWR5IGNhY2hlZD8KICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAg\nICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0SW50ZXJtZWRpYXRlKGZpZWxk\nLmdldEluZGV4KCkpOwogICAgICAgICAgICBpZiAoc3RvcmUuZ2V0Q29udGV4\ndCgpLmZpbmRDYWNoZWQob2lkLCBudWxsKSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBDbGFzc01hcHBp\nbmdbXSBjbHNzID0gZmllbGQuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3Mo\nKTsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBT\nZWxlY3QuRUFHRVJfUEFSQUxMRUw6CiAgICAgICAgICAgICAgICByZXR1cm4g\nY2xzcy5sZW5ndGg7CiAgICAgICAgICAgIGNhc2UgU2VsZWN0LkVBR0VSX09V\nVEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIChjbHNzLmxlbmd0aCA9PSAx\nICYmIHN0b3JlLmdldERCRGljdGlvbmFyeSgpLmNhbk91dGVySm9pbgogICAg\nICAgICAgICAgICAgICAgIChzZWwuZ2V0Sm9pblN5bnRheCgpLCBmaWVsZC5n\nZXRGb3JlaWduS2V5KGNsc3NbMF0pKSkgPyAxIDoKICAgICAgICAgICAgICAg\nICAgICAwOwogICAgICAgICAgICBjYXNlIFNlbGVjdC5FQUdFUl9JTk5FUjoK\nICAgICAgICAgICAgICAgIHJldHVybiAoY2xzcy5sZW5ndGggPT0gMSkgPyAx\nIDogMDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJl\ndHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxl\nY3RFYWdlclBhcmFsbGVsKFNlbGVjdEV4ZWN1dG9yIHNlbCwKICAgICAgICBm\naW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgZmluYWwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIGZpbmFsIENs\nYXNzTWFwcGluZ1tdIGNsc3MgPSBmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVN\nYXBwaW5ncygpOwogICAgICAgIGlmICghKHNlbCBpbnN0YW5jZW9mIFVuaW9u\nKSkKICAgICAgICAgICAgc2VsZWN0RWFnZXJQYXJhbGxlbCgoU2VsZWN0KSBz\nZWwsIGNsc3NbMF0sIHN0b3JlLCBmZXRjaCwgZWFnZXJNb2RlKTsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSAoVW5pb24pIHNl\nbDsKICAgICAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2Rl\nIChmaWVsZC5nZXRUeXBlTWFwcGluZygpKSAKICAgICAgICAgICAgICAgICE9\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTikKICAgICAgICAg\nICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICAgICAgdW5pb24u\nc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAg\nICAgICAgICAgICAgICAgICAgc2VsZWN0RWFnZXJQYXJhbGxlbChzZWwsIGNs\nc3NbaWR4XSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAgICAgICAgICAg\nICBlYWdlck1vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGFu\nIGVhZ2VyIHBhcmFsbGVsIHNlbGVjdC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHNlbGVjdEVhZ2VyUGFyYWxsZWwoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIGNscywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlck1vZGUpIHsKICAgICAgICBz\nZWwuc2VsZWN0UHJpbWFyeUtleShmaWVsZC5nZXREZWZpbmluZ01hcHBpbmco\nKSk7CiAgICAgICAgLy8gc2V0IGEgdmFyaWFibGUgbmFtZSB0aGF0IGRvZXMg\nbm90IGNvbmZsaWN0IHdpdGggYW55IGluIHRoZSBxdWVyeTsKICAgICAgICAv\nLyB1c2luZyBhIHZhcmlhYmxlIGd1YXJhbnRlZXMgdGhhdCB0aGUgc2VsZWN0\nZWQgZGF0YSB3aWxsIHVzZSBkaWZmZXJlbnQKICAgICAgICAvLyBhbGlhc2Vz\nIGFuZCBqb2lucyB0aGFuIGFueSBleGlzdGluZyBXSEVSRSBjb25kaXRpb25z\nIG9uIHRoaXMgZmllbGQKICAgICAgICAvLyB0aGF0IG1pZ2h0IG90aGVyd2lz\nZSBsaW1pdCB0aGUgcmVsYXRpb25zIHRoYXQgbWF0Y2gKICAgICAgICBKb2lu\ncyBqb2lucyA9IHNlbC5uZXdKb2lucygpLnNldFZhcmlhYmxlKCIqIik7CiAg\nICAgICAgZWFnZXJKb2luKGpvaW5zLCBjbHMsIHRydWUpOwogICAgICAgIHNl\nbC5zZWxlY3QoY2xzLCBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIHN0\nb3JlLCBmZXRjaCwgZWFnZXJNb2RlLCAKICAgICAgICAgICAgam9pbnMpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdEVhZ2VySm9pbihTZWxlY3Qg\nc2VsLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9y\nZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVh\nZ2VyTW9kZSkgewogICAgICAgIC8vIGxpbWl0IHRoZSBlYWdlciBtb2RlIHRv\nIHNpbmdsZSBvbiByZWN1cnNpdmUgZWFnZXIgZmV0Y2hpbmcgYi9jCiAgICAg\nICAgLy8gYXQgdGhpcyBwb2ludCB0aGUgc2VsZWN0IGhhcyBiZWVuIG1vZGlm\naWVkIGFuZCBhbiBhdHRlbXB0IHRvCiAgICAgICAgLy8gY2xvbmUgaXQgZm9y\nIGEgdG8tbWFueSBlYWdlciBzZWxlY3QgY2FuIHJlc3VsdCBpbiBhIGNsb25l\nIHRoYXQKICAgICAgICAvLyBwcm9kdWNlcyBpbnZhbGlkIFNRTAogICAgICAg\nIENsYXNzTWFwcGluZyBjbHMgPSBmaWVsZC5nZXRJbmRlcGVuZGVudFR5cGVN\nYXBwaW5ncygpWzBdOwogICAgICAgIHNlbC5zZWxlY3QoY2xzLCBmaWVsZC5n\nZXRTZWxlY3RTdWJjbGFzc2VzKCksIHN0b3JlLCBmZXRjaCwKICAgICAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOLAogICAgICAg\nICAgICBlYWdlckpvaW4oc2VsLm5ld0pvaW5zKCksIGNscywgZmFsc2UpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgam9pbnMgbmVlZGVkIHRv\nIHNlbGVjdC9sb2FkIGVhZ2VyIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUg\nSm9pbnMgZWFnZXJKb2luKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgY2xz\nLCBib29sZWFuIGZvcmNlSW5uZXIpIHsKICAgICAgICBib29sZWFuIGludmVy\nc2UgPSBmaWVsZC5nZXRKb2luRGlyZWN0aW9uKCkgPT0gZmllbGQuSk9JTl9J\nTlZFUlNFOwogICAgICAgIGlmICghaW52ZXJzZSkgewogICAgICAgICAgICBq\nb2lucyA9IGpvaW4oam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAgam9pbnMg\nPSBzZXRFbWJlZGRlZFZhcmlhYmxlKGpvaW5zKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGFuZCBqb2luIGludG8gcmVsYXRpb24KICAgICAgICBGb3JlaWdu\nS2V5IGZrID0gZmllbGQuZ2V0Rm9yZWlnbktleShjbHMpOwogICAgICAgIGlm\nICghZm9yY2VJbm5lciAmJiBmaWVsZC5nZXROdWxsVmFsdWUoKSAhPSBGaWVs\nZE1hcHBpbmcuTlVMTF9FWENFUFRJT04pCiAgICAgICAgICAgIHJldHVybiBq\nb2lucy5vdXRlckpvaW5SZWxhdGlvbihmaWVsZC5nZXROYW1lKCksIGZrLCBm\naWVsZC4KICAgICAgICAgICAgICAgIGdldFR5cGVNYXBwaW5nKCksIGZpZWxk\nLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgaW52ZXJzZSwgZmFsc2UpOwogICAg\nICAgIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgp\nLCBmaywgZmllbGQuZ2V0VHlwZU1hcHBpbmcoKSwgCiAgICAgICAgICAgIGZp\nZWxkLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgaW52ZXJzZSwgZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogSWYgam9pbmluZyBmcm9tIGFuIGVtYmVk\nZGVkIG93bmVyLCB1c2UgdmFyaWFibGUgdG8gY3JlYXRlIGEgdW5pcXVlCiAg\nICAgKiBhbGlhcyBpbiBjYXNlIG93bmVyIGNvbnRhaW5zIG90aGVyIHNhbWUt\ndHlwZWQgZW1iZWRkZWQgcmVsYXRpb25zLgogICAgICovCiAgICBwcml2YXRl\nIEpvaW5zIHNldEVtYmVkZGVkVmFyaWFibGUoSm9pbnMgam9pbnMpIHsKICAg\nICAgICBpZiAoZmllbGQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmdldEVtYmVk\nZGluZ01ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGpv\naW5zOwogICAgICAgIHJldHVybiBqb2lucy5zZXRWYXJpYWJsZShmaWVsZC5n\nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAgICAgICAgICAgIGdldEVtYmVkZGlu\nZ01ldGFEYXRhKCkuZ2V0RmllbGRNZXRhRGF0YSgpLmdldE5hbWUoKSk7CiAg\nICB9CgogICAgcHVibGljIGludCBzZWxlY3QoU2VsZWN0IHNlbCwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlck1vZGUpIHsK\nICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxk\nLkpPSU5fSU5WRVJTRSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAg\nIC8vIGFscmVhZHkgY2FjaGVkIG9pZD8KICAgICAgICBpZiAoc20gIT0gbnVs\nbCAmJiBzbS5nZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSkgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGlmICghQm9v\nbGVhbi5UUlVFLmVxdWFscyhfZmtPaWQpKQogICAgICAgICAgICByZXR1cm4g\nLTE7CiAgICAgICAgc2VsLnNlbGVjdChmaWVsZC5nZXRDb2x1bW5zKCksIGZp\nZWxkLmpvaW4oc2VsKSk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBsb2FkRWFnZXJQYXJhbGxlbChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IHJlcykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBwcm9jZXNzIGJhdGNoZWQg\ncmVzdWx0cyBpZiB3ZSBoYXZlbid0IGFscmVhZHkKICAgICAgICBNYXAgcmVs\nczsKICAgICAgICBpZiAocmVzIGluc3RhbmNlb2YgUmVzdWx0KQogICAgICAg\nICAgICByZWxzID0gcHJvY2Vzc0VhZ2VyUGFyYWxsZWxSZXN1bHQoc20sIHN0\nb3JlLCBmZXRjaCwgKFJlc3VsdCkgcmVzKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHJlbHMgPSAoTWFwKSByZXM7CgogICAgICAgIC8vIHN0b3JlIG9i\namVjdCBmb3IgdGhpcyBvaWQgaW4gaW5zdGFuY2UKICAgICAgICBzbS5zdG9y\nZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCByZWxzLnJlbW92ZShzbS5nZXRP\nYmplY3RJZCgpKSk7CiAgICAgICAgcmV0dXJuIHJlbHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQcm9jZXNzIHRoZSBnaXZlbiBiYXRjaGVkIHJlc3VsdC4K\nICAgICAqLwogICAgcHJpdmF0ZSBNYXAgcHJvY2Vzc0VhZ2VyUGFyYWxsZWxS\nZXN1bHQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3Vs\ndCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gZG8gc2FtZSBqb2lucyBhcyBmb3IgbG9hZAogICAgICAgIC8vIyMjIGNo\nZWF0OiB3ZSBrbm93IHR5cGljYWwgcmVzdWx0IGpvaW5zIG9ubHkgY2FyZSBh\nYm91dCB0aGUgcmVsYXRpb24KICAgICAgICAvLyMjIyBwYXRoOyB0aHVzIHdl\nIGNhbiBpZ25vcmUgZGlmZmVyZW50IG1hcHBpbmdzCiAgICAgICAgQ2xhc3NN\nYXBwaW5nW10gY2xzcyA9IGZpZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBp\nbmdzKCk7CiAgICAgICAgSm9pbnMgam9pbnMgPSByZXMubmV3Sm9pbnMoKS5z\nZXRWYXJpYWJsZSgiKiIpOwogICAgICAgIGVhZ2VySm9pbihqb2lucywgY2xz\nc1swXSwgdHJ1ZSk7CgogICAgICAgIE1hcCByZWxzID0gbmV3IEhhc2hNYXAo\nKTsKICAgICAgICBDbGFzc01hcHBpbmcgb3duZXIgPSBmaWVsZC5nZXREZWZp\nbmluZ01hcHBpbmcoKTsKICAgICAgICBDbGFzc01hcHBpbmcgY2xzOwogICAg\nICAgIE9iamVjdCBvaWQ7CiAgICAgICAgd2hpbGUgKHJlcy5uZXh0KCkpIHsK\nICAgICAgICAgICAgY2xzID0gcmVzLmdldEJhc2VNYXBwaW5nKCk7CiAgICAg\nICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNscyA9\nIGNsc3NbMF07CiAgICAgICAgICAgIG9pZCA9IG93bmVyLmdldE9iamVjdElk\nKHN0b3JlLCByZXMsIG51bGwsIHRydWUsIG51bGwpOwogICAgICAgICAgICBy\nZWxzLnB1dChvaWQsIHJlcy5sb2FkKGNscywgc3RvcmUsIGZldGNoLCBqb2lu\ncykpOwogICAgICAgIH0KICAgICAgICByZXMuY2xvc2UoKTsKCiAgICAgICAg\ncmV0dXJuIHJlbHM7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZEVhZ2Vy\nSm9pbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0\nIHJlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgY2xzID0gZmllbGQuZ2V0SW5kZXBlbmRlbnRUeXBlTWFw\ncGluZ3MoKVswXTsKICAgICAgICBzbS5zdG9yZU9iamVjdChmaWVsZC5nZXRJ\nbmRleCgpLCByZXMubG9hZChjbHMsIHN0b3JlLCBmZXRjaCwKICAgICAgICAg\nICAgZWFnZXJKb2luKHJlcy5uZXdKb2lucygpLCBjbHMsIGZhbHNlKSkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5EaXJlY3Rp\nb24oKSA9PSBmaWVsZC5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAvLyBjYWNoZWQgb2lkPwogICAgICAgIGlmIChzbSAhPSBu\ndWxsICYmIHNtLmdldEludGVybWVkaWF0ZShmaWVsZC5nZXRJbmRleCgpKSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKCFCb29s\nZWFuLlRSVUUuZXF1YWxzKF9ma09pZCkpCiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICBpZiAoIXJlcy5jb250YWluc0FsbChmaWVsZC5nZXRDb2x1bW5z\nKCkpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGdldCB0aGUg\ncmVsYXRlZCBvYmplY3QncyBvaWQKICAgICAgICBDbGFzc01hcHBpbmcgcmVs\nTWFwcGluZyA9IGZpZWxkLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgT2Jq\nZWN0IG9pZCA9IG51bGw7CiAgICAgICAgaWYgKHJlbE1hcHBpbmcuaXNNYXBw\nZWQoKSkgewogICAgICAgICAgICBvaWQgPSByZWxNYXBwaW5nLmdldE9iamVj\ndElkKHN0b3JlLCByZXMsIGZpZWxkLmdldEZvcmVpZ25LZXkoKSwKICAgICAg\nICAgICAgICAgIGZpZWxkLmdldFBvbHltb3JwaGljKCkgIT0gVmFsdWVNYXBw\naW5nLlBPTFlfRkFMU0UsIG51bGwpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIENvbHVtbltdIGNvbHMgPSBmaWVsZC5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgICAgIGlmIChyZWxNYXBwaW5nLmdldElkZW50aXR5VHlwZSgpID09\nIENsYXNzTWFwcGluZy5JRF9EQVRBU1RPUkUpIHsKICAgICAgICAgICAgICAg\nIGxvbmcgaWQgPSByZXMuZ2V0TG9uZyhjb2xzWzBdKTsKICAgICAgICAgICAg\nICAgIGlmICghcmVzLndhc051bGwoKSkKICAgICAgICAgICAgICAgICAgICBv\naWQgPSBzdG9yZS5uZXdEYXRhU3RvcmVJZChpZCwgcmVsTWFwcGluZywgdHJ1\nZSk7CiAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgLy8g\nYXBwbGljYXRpb24gaWQKICAgICAgICAgICAgICAgIGlmIChjb2xzLmxlbmd0\naCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IHZhbCA9IHJl\ncy5nZXRPYmplY3QoY29sc1swXSwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBvaWQgPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMobmV3IE9i\namVjdFtdeyB2YWwgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl\nbE1hcHBpbmcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBPYmplY3RbXSB2YWxzID0gbmV3IE9iamVjdFtjb2xzLmxl\nbmd0aF07CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbHNbaV0gPSByZXMuZ2V0T2JqZWN0KGNvbHNbaV0sIG51bGwsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsc1tpXSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChpID09IGNvbHMubGVuZ3RoIC0gMSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG9pZCA9IEFwcGxpY2F0aW9uSWRz\nLmZyb21QS1ZhbHVlcyh2YWxzLCByZWxNYXBwaW5nKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAg\nc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwgbnVsbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzbS5zZXRJbnRlcm1lZGlhdGUoZmllbGQu\nZ2V0SW5kZXgoKSwgb2lkKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2Fk\nKGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGZpbmFsIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIC8vIGNoZWNrIGZvciBjYWNoZWQgb2lkIHZhbHVlLCBvciBsb2FkIG9pZCBp\nZiBubyB3YXkgdG8gam9pbgogICAgICAgIGlmIChCb29sZWFuLlRSVUUuZXF1\nYWxzKF9ma09pZCkpIHsKICAgICAgICAgICAgT2JqZWN0IG9pZCA9IHNtLmdl\ndEludGVybWVkaWF0ZShmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICAgICAg\naWYgKG9pZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgdmFs\nID0gc3RvcmUuZmluZChvaWQsIGZpZWxkLCBmZXRjaCk7CiAgICAgICAgICAg\nICAgICBzbS5zdG9yZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSByZWxzID0gZmllbGQu\nZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsKICAgICAgICBmaW5hbCBp\nbnQgc3VicyA9IGZpZWxkLmdldFNlbGVjdFN1YmNsYXNzZXMoKTsKICAgICAg\nICBmaW5hbCBKb2luc1tdIHJlc0pvaW5zID0gbmV3IEpvaW5zW3JlbHMubGVu\nZ3RoXTsKCiAgICAgICAgLy8gc2VsZWN0IHJlbGF0ZWQgbWFwcGluZyBjb2x1\nbW5zOyBqb2luaW5nIGZyb20gdGhlIHJlbGF0ZWQgdHlwZQogICAgICAgIC8v\nIGJhY2sgdG8gb3VyIGZrIHRhYmxlIGlmIG5vdCBhbiBpbnZlcnNlIG1hcHBp\nbmcgKGluIHdoaWNoIGNhc2Ugd2UKICAgICAgICAvLyBjYW4ganVzdCBtYWtl\nIHN1cmUgdGhlIGludmVyc2UgY29scyA9PSBvdXIgcGsgdmFsdWVzKQogICAg\nICAgIFVuaW9uIHVuaW9uID0gc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1Vu\naW9uKHJlbHMubGVuZ3RoKTsKICAgICAgICB1bmlvbi5zZXRTaW5nbGVSZXN1\nbHQodHJ1ZSk7CiAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hN\nb2RlKGZpZWxkLmdldFR5cGVNYXBwaW5nKCkpCiAgICAgICAgICAgICE9IEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTikKICAgICAgICAgICAg\ndW5pb24uYWJvcnRVbmlvbigpOwogICAgICAgIHVuaW9uLnNlbGVjdChuZXcg\nVW5pb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICBp\nZiAoZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpID09IGZpZWxkLkpPSU5fSU5W\nRVJTRSkKICAgICAgICAgICAgICAgICAgICBzZWwud2hlcmVGb3JlaWduS2V5\nKGZpZWxkLmdldEZvcmVpZ25LZXkocmVsc1tpZHhdKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgZmllbGQuZ2V0RGVmaW5p\nbmdNYXBwaW5nKCksIHN0b3JlKTsKICAgICAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHJlc0pvaW5zW2lkeF0gPSBzZWwubmV3Sm9p\nbnMoKS5qb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgICAgICBmaWVsZC5nZXRGb3JlaWduS2V5KHJlbHNbaWR4XSks\nIHJlbHNbaWR4XSwKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgIGZpZWxkLndoZXJlUHJpbWFyeUtleShzZWwsIHNtLCBzdG9y\nZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWwuc2Vs\nZWN0KHJlbHNbaWR4XSwgc3Vicywgc3RvcmUsIGZldGNoLCBmZXRjaC5FQUdF\nUl9KT0lOLCAKICAgICAgICAgICAgICAgICAgICByZXNKb2luc1tpZHhdKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBSZXN1bHQgcmVz\nID0gdW5pb24uZXhlY3V0ZShzdG9yZSwgZmV0Y2gpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBudWxsOwogICAgICAgICAgICBp\nZiAocmVzLm5leHQoKSkKICAgICAgICAgICAgICAgIHZhbCA9IHJlcy5sb2Fk\nKHJlbHNbcmVzLmluZGV4T2YoKV0sIHN0b3JlLCBmZXRjaCwKICAgICAgICAg\nICAgICAgICAgICByZXNKb2luc1tyZXMuaW5kZXhPZigpXSk7CiAgICAgICAg\nICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIHZhbCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRhU3RvcmVW\nYWx1ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBy\nZXR1cm4gUmVsYXRpb25TdHJhdGVnaWVzLnRvRGF0YVN0b3JlVmFsdWUoZmll\nbGQsIHZhbCwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVu\nZElzTnVsbChTUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lu\ncykgewogICAgICAgIC8vIGlmIG5vIGludmVyc2UsIGp1c3Qgam9pbiB0byBt\nYXBwaW5nJ3MgdGFibGUgKHVzdWFsbHkgYSBuby1vcAogICAgICAgIC8vIGJl\nY2F1c2UgaXQnbGwgYmUgaW4gdGhlIHByaW1hcnkgdGFibGUpIGFuZCBzZWUg\naWYgZmsgY29scyBhcmUgbnVsbDsKICAgICAgICAvLyBpZiBpbnZlcnNlLCB0\naGVuIHdlIGhhdmUgdG8gZG8gYSBzdWItc2VsZWN0IHRvIHNlZSBpZiBhbnkg\naW52ZXJzZQogICAgICAgIC8vIG9iamVjdHMgcG9pbnQgYmFjayB0byB0aGlz\nIGZpZWxkJ3Mgb3duZXIKICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVj\ndGlvbigpICE9IGZpZWxkLkpPSU5fSU5WRVJTRSkgewogICAgICAgICAgICAv\nLyMjIyBwcm9iYWJseSBuZWVkIHNvbWUgc29ydCBvZiBzdWJzZWxlY3QgaGVy\nZSBvbiBmayBjb25zdGFudHMKICAgICAgICAgICAgam9pbnMgPSBqb2luKGpv\naW5zLCBmYWxzZSk7CiAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSBmaWVs\nZC5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIGlmIChjb2xzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiMSA8PiAxIik7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoc2Vs\nLmdldENvbHVtbkFsaWFzKGNvbHNbMF0sIGpvaW5zKSkuCiAgICAgICAgICAg\nICAgICAgICAgYXBwZW5kKCIgSVMgIikuYXBwZW5kVmFsdWUobnVsbCwgY29s\nc1swXSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRlc3RJbnZlcnNl\nTnVsbChzcWwsIHNlbCwgam9pbnMsIHRydWUpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGFwcGVuZElzTm90TnVsbChTUUxCdWZmZXIgc3FsLCBTZWxlY3Qg\nc2VsLCBKb2lucyBqb2lucykgewogICAgICAgIC8vIGlmIG5vIGludmVyc2Us\nIGp1c3Qgam9pbiB0byBtYXBwaW5nJ3MgdGFibGUgKHVzdWFsbHkgYSBuby1v\ncAogICAgICAgIC8vIGJlY2F1c2UgaXQnbGwgYmUgaW4gdGhlIHByaW1hcnkg\ndGFibGUpIGFuZCBzZWUgaWYgZmsgY29scyBhcmVuJ3QKICAgICAgICAvLyBu\ndWxsOyBpZiBpbnZlcnNlLCB0aGVuIHdlIGhhdmUgdG8gZG8gYSBzdWItc2Vs\nZWN0IHRvIHNlZSBpZiBhbnkKICAgICAgICAvLyBpbnZlcnNlIG9iamVjdHMg\ncG9pbnQgYmFjayB0byB0aGlzIGZpZWxkJ3Mgb3duZXIKICAgICAgICBpZiAo\nZmllbGQuZ2V0Sm9pbkRpcmVjdGlvbigpICE9IGZpZWxkLkpPSU5fSU5WRVJT\nRSkgewogICAgICAgICAgICAvLyMjIyBwcm9iYWJseSBuZWVkIHNvbWUgc29y\ndCBvZiBzdWJzZWxlY3QgaGVyZSBvbiBmayBjb25zdGFudHMKICAgICAgICAg\nICAgam9pbnMgPSBqb2luKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIENv\nbHVtbltdIGNvbHMgPSBmaWVsZC5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAg\nIGlmIChjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCgiMSA9IDEiKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sc1swXSwgam9p\nbnMpKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoIiBJUyBOT1QgIiku\nYXBwZW5kVmFsdWUobnVsbCwgY29sc1swXSk7CiAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgIHRlc3RJbnZlcnNlTnVsbChzcWwsIHNlbCwgam9pbnMsIGZh\nbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBTUUwgZm9yIGEg\nc3ViLXNlbGVjdCB0ZXN0aW5nIHdoZXRoZXIgYW4gaW52ZXJzZSBvYmplY3Qg\nZXhpc3RzCiAgICAgKiBmb3IgdGhpcyByZWxhdGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHRlc3RJbnZlcnNlTnVsbChTUUxCdWZmZXIgc3FsLCBT\nZWxlY3Qgc2VsLCBKb2lucyBqb2lucywKICAgICAgICBib29sZWFuIGVtcHR5\nKSB7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBmaWVsZC5nZXRNYXBw\naW5nUmVwb3NpdG9yeSgpLmdldERCRGljdGlvbmFyeSgpOwogICAgICAgIGRp\nY3QuYXNzZXJ0U3VwcG9ydChkaWN0LnN1cHBvcnRzU3Vic2VsZWN0LCAiU3Vw\ncG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgaWYgKGZpZWxkLmdldEluZGVw\nZW5kZW50VHlwZU1hcHBpbmdzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAg\nIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmludmVyc2FibGUoZmllbGQp\nOwoKICAgICAgICBpZiAoZW1wdHkpCiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nIjAgPSAiKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nIjAgPCAiKTsKCiAgICAgICAgRm9yZWlnbktleSBmayA9IGZpZWxkLmdldEZv\ncmVpZ25LZXkoKTsKICAgICAgICBDb250YWluZXJGaWVsZFN0cmF0ZWd5LmFw\ncGVuZEpvaW5Db3VudChzcWwsIHNlbCwgam9pbnMsIGRpY3QsIGZpZWxkLAog\nICAgICAgICAgICBmayk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpvaW4o\nSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRlcikgewogICAgICAgIC8v\nIGlmIHdlJ3JlIG5vdCBpbiBhbiBpbnZlcnNlIG9iamVjdCB0YWJsZSBqb2lu\nIG5vcm1hbGx5LCBvdGhlcndpc2UKICAgICAgICAvLyBhbHJlYWR5IHRyYXZl\ncnNlZCB0aGUgcmVsYXRpb247IGp1c3Qgam9pbiBiYWNrIHRvIG93bmVyIHRh\nYmxlCiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5EaXJlY3Rpb24oKSAhPSBm\naWVsZC5KT0lOX0lOVkVSU0UpCiAgICAgICAgICAgIHJldHVybiBmaWVsZC5q\nb2luKGpvaW5zLCBmb3JjZU91dGVyLCBmYWxzZSk7CiAgICAgICAgQ2xhc3NN\nYXBwaW5nW10gY2xzcyA9IGZpZWxkLmdldEluZGVwZW5kZW50VHlwZU1hcHBp\nbmdzKCk7CiAgICAgICAgaWYgKGNsc3MubGVuZ3RoICE9IDEpCiAgICAgICAg\nICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmludmVyc2FibGUoZmll\nbGQpOwogICAgICAgIGlmIChmb3JjZU91dGVyKQogICAgICAgICAgICByZXR1\ncm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgZmllbGQuZ2V0Rm9yZWlnbktleSgpLCBjbHNzWzBd\nLCBmaWVsZC5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIAogICAgICAgICAgICAg\nICAgdHJ1ZSwgZmFsc2UpOwogICAgICAgIHJldHVybiBqb2lucy5qb2luUmVs\nYXRpb24oZmllbGQuZ2V0TmFtZSgpLCBmaWVsZC5nZXRGb3JlaWduS2V5KCks\nCiAgICAgICAgICAgIGNsc3NbMF0sIGZpZWxkLmdldFNlbGVjdFN1YmNsYXNz\nZXMoKSwgdHJ1ZSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBq\nb2luUmVsYXRpb24oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRlciwK\nICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7CiAgICAgICAgLy8gaWYgdGhp\ncyBpcyBhbiBpbnZlcnNlIG1hcHBpbmcgaXQncyBhbHJlYWR5IGpvaW5lZCB0\nbyB0aGUgcmVsYXRpb24KICAgICAgICBpZiAoZmllbGQuZ2V0Sm9pbkRpcmVj\ndGlvbigpID09IGZpZWxkLkpPSU5fSU5WRVJTRSkKICAgICAgICAgICAgcmV0\ndXJuIGpvaW5zOwogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBmaWVs\nZC5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwogICAgICAgIGlmIChj\nbHNzLmxlbmd0aCAhPSAxKSB7CiAgICAgICAgICAgIGlmICh0cmF2ZXJzZSkK\nICAgICAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmpv\naW5hYmxlKGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwogICAg\nICAgIH0KCiAgICAgICAgam9pbnMgPSBzZXRFbWJlZGRlZFZhcmlhYmxlKGpv\naW5zKTsKICAgICAgICBpZiAoZm9yY2VPdXRlcikKICAgICAgICAgICAgcmV0\ndXJuIGpvaW5zLm91dGVySm9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwg\nCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRGb3JlaWduS2V5KGNsc3NbMF0p\nLCBjbHNzWzBdLCAKICAgICAgICAgICAgICAgIGZpZWxkLmdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgICAgICByZXR1cm4gam9p\nbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0Rm9y\nZWlnbktleShjbHNzWzBdKSwKICAgICAgICAgICAgY2xzc1swXSwgZmllbGQu\nZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwgZmFsc2UpOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSm9pbmFi\nbGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBpbnQgZ2V0RmllbGRJbmRleCgpIHsKICAgICAg\nICByZXR1cm4gZmllbGQuZ2V0SW5kZXgoKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGdldFByaW1hcnlLZXlWYWx1ZShSZXN1bHQgcmVzLCBDb2x1bW5b\nXSBjb2xzLCBGb3JlaWduS2V5IGZrLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIHJlbG1hcHBpbmcgPSBmaWVsZC5nZXRU\neXBlTWFwcGluZygpOwogICAgICAgIGlmIChyZWxtYXBwaW5nLmdldElkZW50\naXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5JRF9EQVRBU1RPUkUpIHsKICAg\nICAgICAgICAgQ29sdW1uIGNvbCA9IGNvbHNbMF07CiAgICAgICAgICAgIGlm\nIChmayAhPSBudWxsKQogICAgICAgICAgICAgICAgY29sID0gZmsuZ2V0Q29s\ndW1uKGNvbCk7ICAgCiAgICAgICAgICAgIGxvbmcgaWQgPSByZXMuZ2V0TG9u\nZyhjb2wsIGpvaW5zKTsKICAgICAgICAgICAgaWYgKGZpZWxkLmdldE9iamVj\ndElkRmllbGRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5MT05HKQogICAgICAg\nICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihpZCk7CiAgICAgICAg\nICAgIHJldHVybiBzdG9yZS5uZXdEYXRhU3RvcmVJZChpZCwgcmVsbWFwcGlu\nZywgZmllbGQuZ2V0UG9seW1vcnBoaWMoKSAKICAgICAgICAgICAgICAgICE9\nIFZhbHVlTWFwcGluZy5QT0xZX0ZBTFNFKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChyZWxtYXBwaW5nLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAg\nICAgIHJldHVybiAoKEpvaW5hYmxlKSByZWxtYXBwaW5nLmdldFByaW1hcnlL\nZXlGaWVsZE1hcHBpbmdzKClbMF0uCiAgICAgICAgICAgICAgICBnZXRTdHJh\ndGVneSgpKS5nZXRQcmltYXJ5S2V5VmFsdWUocmVzLCBjb2xzLCBmaywgc3Rv\ncmUsIGpvaW5zKTsKCiAgICAgICAgaWYgKGNvbHMgPT0gZ2V0Q29sdW1ucygp\nICYmIGZrID09IG51bGwpCiAgICAgICAgICAgIGZrID0gZmllbGQuZ2V0Rm9y\nZWlnbktleSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZmsgPSBjcmVh\ndGVUcmFuc2xhdGluZ0ZvcmVpZ25LZXkocmVsbWFwcGluZywgY29scywgZmsp\nOyAKICAgICAgICByZXR1cm4gcmVsbWFwcGluZy5nZXRPYmplY3RJZChzdG9y\nZSwgcmVzLCBmaywKICAgICAgICAgICAgZmllbGQuZ2V0UG9seW1vcnBoaWMo\nKSAhPSBWYWx1ZU1hcHBpbmcuUE9MWV9GQUxTRSwgam9pbnMpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgZmF1eCBmb3JlaWduIGtleSB0aGF0\nIHRyYW5zbGF0ZXMgYmV0d2VlbiB0aGUgY29sdW1ucyB0byBwdWxsCiAgICAg\nKiB0aGUgZGF0YSBmcm9tIGFuZCBvdXIgcmVsYXRlZCB0eXBlJ3MgcHJpbWFy\neSBrZXkgY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBGb3JlaWduS2V5\nIGNyZWF0ZVRyYW5zbGF0aW5nRm9yZWlnbktleShDbGFzc01hcHBpbmcgcmVs\nbWFwcGluZywKICAgICAgICBDb2x1bW5bXSBnY29scywgRm9yZWlnbktleSBn\nZmspIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0Rm9yZWln\nbktleSgpOyAKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZmsuZ2V0Q29sdW1u\ncygpOwoKICAgICAgICBGb3JlaWduS2V5IHRmayA9IG51bGw7CiAgICAgICAg\nQ29sdW1uIHRjb2w7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBnY29s\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0Y29sID0gZ2NvbHNbaV07\nCiAgICAgICAgICAgIGlmIChnZmsgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRjb2wgPSBnZmsuZ2V0Q29sdW1uKHRjb2wpOwogICAgICAgICAgICBpZiAo\ndGZrID09IG51bGwpCiAgICAgICAgICAgICAgICB0ZmsgPSBuZXcgRm9yZWln\nbktleShudWxsLCB0Y29sLmdldFRhYmxlKCkpOwogICAgICAgICAgICB0Zmsu\nam9pbih0Y29sLCBmay5nZXRQcmltYXJ5S2V5Q29sdW1uKGNvbHNbaV0pKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRmazsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEpvaW5WYWx1ZShPYmplY3QgZmllbGRWYWwsIENvbHVt\nbiBjb2wsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIE9iamVjdCBvID0g\nZmllbGQuZ2V0Rm9yZWlnbktleSgpLmdldENvbnN0YW50KGNvbCk7CiAgICAg\nICAgaWYgKG8gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG87CiAgICAg\nICAgY29sID0gZmllbGQuZ2V0Rm9yZWlnbktleSgpLmdldFByaW1hcnlLZXlD\nb2x1bW4oY29sKTsKICAgICAgICBpZiAoY29sID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwoKICAgICAgICBD\nbGFzc01hcHBpbmcgcmVsbWFwcGluZyA9IGZpZWxkLmdldFR5cGVNYXBwaW5n\nKCk7CiAgICAgICAgSm9pbmFibGUgaiA9IGZpZWxkLmdldFR5cGVNYXBwaW5n\nKCkuYXNzZXJ0Sm9pbmFibGUoY29sKTsKICAgICAgICBpZiAoSW1wbEhlbHBl\nci5pc01hbmFnZWFibGUoZmllbGRWYWwpKQogICAgICAgICAgICBmaWVsZFZh\nbCA9IHN0b3JlLmdldENvbnRleHQoKS5nZXRPYmplY3RJZChmaWVsZFZhbCk7\nCiAgICAgICAgaWYgKGZpZWxkVmFsIGluc3RhbmNlb2YgT3BlbkpQQUlkKQog\nICAgICAgICAgICBmaWVsZFZhbCA9ICgoT3BlbkpQQUlkKSBmaWVsZFZhbCku\nZ2V0SWRPYmplY3QoKTsKICAgICAgICBlbHNlIGlmIChyZWxtYXBwaW5nLmdl\ndE9iamVjdElkVHlwZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgcmVsbWFw\ncGluZy5nZXRPYmplY3RJZFR5cGUoKS5pc0luc3RhbmNlKGZpZWxkVmFsKSkg\newogICAgICAgICAgICBPYmplY3RbXSBwa3MgPSBBcHBsaWNhdGlvbklkcy50\nb1BLVmFsdWVzKGZpZWxkVmFsLCByZWxtYXBwaW5nKTsKICAgICAgICAgICAg\nZmllbGRWYWwgPSBwa3NbcmVsbWFwcGluZy5nZXRGaWVsZChqLmdldEZpZWxk\nSW5kZXgoKSkuCiAgICAgICAgICAgICAgICBnZXRQcmltYXJ5S2V5SW5kZXgo\nKV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBqLmdldEpvaW5WYWx1ZShm\naWVsZFZhbCwgY29sLCBzdG9yZSk7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBnZXRKb2luVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ29sdW1u\nIGNvbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1\ncm4gZ2V0Sm9pblZhbHVlKHNtLmZldGNoKGZpZWxkLmdldEluZGV4KCkpLCBj\nb2wsIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQXNz\naWduZWRWYWx1ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgQ29sdW1uIGNvbCwgT2JqZWN0IGF1dG9JbmMpIHsK\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAg\nIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nRW1iZWRkYWJsZSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1u\ncygpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0Q29sdW1ucygpOwogICAg\nfQoKICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRDb2x1bW5JTygpIHsKICAgICAg\nICByZXR1cm4gZmllbGQuZ2V0Q29sdW1uSU8oKTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0W10gZ2V0UmVzdWx0QXJndW1lbnRzKCkgewogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9FbWJlZGRl\nZERhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkg\newogICAgICAgIHJldHVybiB0b0RhdGFTdG9yZVZhbHVlKHZhbCwgc3RvcmUp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9FbWJlZGRlZE9iamVjdFZh\nbHVlKE9iamVjdCB2YWwpIHsKICAgICAgICByZXR1cm4gVU5TVVBQT1JURUQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZEVtYmVkZGVkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgdmFsKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENsYXNzTWFwcGluZyBy\nZWxNYXBwaW5nID0gZmllbGQuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBP\nYmplY3Qgb2lkOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAg\nICAgb2lkID0gbnVsbDsKICAgICAgICBlbHNlIGlmIChyZWxNYXBwaW5nLmdl\ndElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5JRF9EQVRBU1RPUkUp\nCiAgICAgICAgICAgIG9pZCA9IHN0b3JlLm5ld0RhdGFTdG9yZUlkKCgoTnVt\nYmVyKSB2YWwpLmxvbmdWYWx1ZSgpLCByZWxNYXBwaW5nLAogICAgICAgICAg\nICAgICAgZmllbGQuZ2V0UG9seW1vcnBoaWMoKSAhPSBWYWx1ZU1hcHBpbmcu\nUE9MWV9GQUxTRSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIE9iamVj\ndFtdIHBrcyA9IChnZXRDb2x1bW5zKCkubGVuZ3RoID09IDEpID8gbmV3IE9i\namVjdFtdeyB2YWwgfQogICAgICAgICAgICAgICAgOiAoT2JqZWN0W10pIHZh\nbDsKICAgICAgICAgICAgYm9vbGVhbiBudWxscyA9IHRydWU7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBudWxscyAmJiBpIDwgcGtzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgbnVsbHMgPSBwa3NbaV0gPT0gbnVsbDsK\nICAgICAgICAgICAgaWYgKG51bGxzKQogICAgICAgICAgICAgICAgb2lkID0g\nbnVsbDsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBvaWQg\nPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMocGtzLCByZWxNYXBwaW5n\nKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRQb2x5bW9ycGhpYygp\nID09IFZhbHVlTWFwcGluZy5QT0xZX0ZBTFNFCiAgICAgICAgICAgICAgICAg\nICAgJiYgb2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkKSB7CiAgICAgICAgICAg\nICAgICAgICAgKChPcGVuSlBBSWQpIG9pZCkuc2V0TWFuYWdlZEluc3RhbmNl\nVHlwZShyZWxNYXBwaW5nLgogICAgICAgICAgICAgICAgICAgICAgICBnZXRE\nZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAg\nICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIG51bGwp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc2V0SW50ZXJtZWRpYXRl\nKGZpZWxkLmdldEluZGV4KCksIG9pZCk7CiAgICB9Cn0K\n","encoding":"base64"}

