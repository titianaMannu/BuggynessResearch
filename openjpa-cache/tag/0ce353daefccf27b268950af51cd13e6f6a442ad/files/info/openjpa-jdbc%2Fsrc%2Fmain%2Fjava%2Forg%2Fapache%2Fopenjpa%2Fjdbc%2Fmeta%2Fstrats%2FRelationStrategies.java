{"sha":"3eaef989425a990473abf2bc8f632f0a8327032c","node_id":"MDQ6QmxvYjIwNjM2NDozZWFlZjk4OTQyNWE5OTA0NzNhYmYyYmM4ZjYzMmYwYTgzMjcwMzJj","size":7525,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3eaef989425a990473abf2bc8f632f0a8327032c","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5K\nREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5GaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRldGFjaGVkVmFs\ndWVTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKCi8qKgogKiBIZWxwZXIg\nbWV0aG9kcyBmb3IgcmVsYXRpb24gbWFwcGluZ3MuCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgUmVsYXRpb25TdHJhdGVnaWVz\nIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nIExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFJlbGF0aW9uU3RyYXRl\nZ2llcy5jbGFzcyk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gZXhjZXB0\naW9uIGluZGljYXRpbmcgdGhhdCB3ZSBjYW5ub3Qgam9pbiB0byB0aGUgZ2l2\nZW4gcmVsYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgTWV0YURh\ndGFFeGNlcHRpb24gdW5qb2luYWJsZShWYWx1ZU1hcHBpbmcgdm0pIHsKICAg\nICAgICByZXR1cm4gbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJj\nYW50LWpvaW4iLCB2bSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGFuIGV4Y2VwdGlvbiBpbmRpY2F0aW5nIHRoYXQgdGhlIHJlbGF0aW9uIGNh\nbm5vdCBiZSBsb2FkZWQKICAgICAqIGJlY2F1c2UgaXQgaGFzIGluZGVwZW5k\nZW50IHN1YmNsYXNzZXMgYW5kIGRvZXMgbm90IHJlcHJlc2VudCBhIGZ1bGwg\nb2lkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE1ldGFEYXRhRXhjZXB0\naW9uIHVubG9hZGFibGUoVmFsdWVNYXBwaW5nIHZtKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1sb2Fk\nIiwgdm0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBleGNl\ncHRpb24gaW5kaWNhdGluZyB0aGF0IHRoZSByZWxhdGlvbiBpcyBpbnZhbGlk\nCiAgICAgKiBiZWNhdXNlIGl0IGhhcyBpcyBiYXNlZCBvbiBhbiBpbnZlcnNl\nIGZvcmVpZ24ga2V5IGFuZCBoYXMgaW5kZXBlbmRlbnQKICAgICAqIHN1YmNs\nYXNzZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgTWV0YURhdGFFeGNl\ncHRpb24gdW5pbnZlcnNhYmxlKFZhbHVlTWFwcGluZyB2bSkgewogICAgICAg\nIHJldHVybiBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImNhbnQt\naW52ZXJzZSIsIHZtKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGdpdmVuIG9iamVjdCBhcyBpdHMgZm9yZWlnbiBrZXkgdmFsdWVzLgog\nICAgICoKICAgICAqIEBzZWUgRmllbGRTdHJhdGVneSN0b0RhdGFTdG9yZVZh\nbHVlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IHRvRGF0YVN0\nb3JlVmFsdWUoVmFsdWVNYXBwaW5nIHZtLCBPYmplY3QgdmFsLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIENsYXNzTWFwcGluZyByZWw7\nCiAgICAgICAgaWYgKHZhbCA9PSBudWxsIHx8IHZhbC5nZXRDbGFzcygpID09\nIHZtLmdldFR5cGUoKSkgCiAgICAgICAgICAgIHJlbCA9IHZtLmdldFR5cGVN\nYXBwaW5nKCk7IC8vIGNvbW1vbiBjYXNlCiAgICAgICAgZWxzZQogICAgICAg\nICAgICByZWwgPSB2bS5nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBp\nbmcodmFsLmdldENsYXNzKCksCiAgICAgICAgICAgICAgICBzdG9yZS5nZXRD\nb250ZXh0KCkuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CgogICAgICAgIENv\nbHVtbltdIGNvbHM7CiAgICAgICAgaWYgKHZtLmdldEpvaW5EaXJlY3Rpb24o\nKSA9PSBWYWx1ZU1hcHBpbmcuSk9JTl9JTlZFUlNFKQogICAgICAgICAgICBj\nb2xzID0gcmVsLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBjb2xzID0gdm0uZ2V0Rm9yZWlnbktleShyZWwpLmdl\ndFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgcmV0dXJuIHJlbC50b0Rh\ndGFTdG9yZVZhbHVlKHZhbCwgY29scywgc3RvcmUpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFwIGEgbG9naWNhbCBmb3JlaWduIGtleSB0byBhbiB1bm1h\ncHBlZCBiYXNlIGNsYXNzIHJlbGF0aW9uLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIHZvaWQgbWFwUmVsYXRpb25Ub1VubWFwcGVkUEMoVmFsdWVNYXBw\naW5nIHZtLAogICAgICAgIFN0cmluZyBuYW1lLCBib29sZWFuIGFkYXB0KSB7\nCiAgICAgICAgaWYgKHZtLmdldFR5cGVNYXBwaW5nKCkuZ2V0SWRlbnRpdHlU\neXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX1VOS05PV04pCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicmVsLXRv\nLXVua25vd25pZCIsIHZtKSk7CgogICAgICAgIFZhbHVlTWFwcGluZ0luZm8g\ndmluZm8gPSB2bS5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBDb2x1bW5bXSB0\nbXBsYXRlcyA9IG5ld1VubWFwcGVkUENUZW1wbGF0ZUNvbHVtbnModm0sIG5h\nbWUpOwogICAgICAgIHZtLnNldENvbHVtbnModmluZm8uZ2V0Q29sdW1ucyh2\nbSwgbmFtZSwgdG1wbGF0ZXMsCiAgICAgICAgICAgIHZtLmdldEZpZWxkTWFw\ncGluZygpLmdldFRhYmxlKCksIGFkYXB0KSk7CiAgICAgICAgdm0uc2V0Q29s\ndW1uSU8odmluZm8uZ2V0Q29sdW1uSU8oKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgdGVtcGxhdGUgY29sdW1ucyBmb3IgYSBsb2dpY2FsIGZv\ncmVpZ24ga2V5IHRvIGFuIHVubWFwcGVkIGJhc2UKICAgICAqIGNsYXNzIHJl\nbGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDb2x1bW5bXSBu\nZXdVbm1hcHBlZFBDVGVtcGxhdGVDb2x1bW5zKFZhbHVlTWFwcGluZyB2bSwK\nICAgICAgICBTdHJpbmcgbmFtZSkgewogICAgICAgIENsYXNzTWFwcGluZyBy\nZWwgPSB2bS5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIGlmIChyZWwuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNYXBwaW5nLklEX0RBVEFTVE9SRSkg\newogICAgICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAg\nICAgICAgICBjb2wuc2V0TmFtZShuYW1lKTsKICAgICAgICAgICAgY29sLnNl\ndEphdmFUeXBlKEphdmFUeXBlcy5MT05HKTsKICAgICAgICAgICAgY29sLnNl\ndFJlbGF0aW9uSWQodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ29s\ndW1uW117IGNvbCB9OwogICAgICAgIH0KCiAgICAgICAgRmllbGRNYXBwaW5n\nW10gcGtzID0gcmVsLmdldFByaW1hcnlLZXlGaWVsZE1hcHBpbmdzKCk7CiAg\nICAgICAgQ29sdW1uW10gY29scyA9IG5ldyBDb2x1bW5bcGtzLmxlbmd0aF07\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgY29sc1tpXSA9IG1hcFByaW1hcnlLZXkodm0sIHBr\nc1tpXSk7CiAgICAgICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAxKQogICAg\nICAgICAgICAgICAgY29sc1tpXS5zZXROYW1lKG5hbWUpOwogICAgICAgICAg\nICBlbHNlIGlmIChjb2xzW2ldLmdldE5hbWUoKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgY29sc1tpXS5zZXROYW1lKG5hbWUgKyAiXyIgKyBwa3NbaV0u\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nY29sc1tpXS5zZXROYW1lKG5hbWUgKyAiXyIgKyBjb2xzW2ldLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGNvbHNbaV0uc2V0VGFyZ2V0RmllbGQocGtzW2ld\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGNvbHNbaV0uc2V0UmVsYXRpb25J\nZCh0cnVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbHM7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBkZWZhdWx0IGNvbHVtbiBmb3Ig\ndGhlIGdpdmVuIHByaW1hcnkga2V5IGZpZWxkLiBVc2VzIHRoZQogICAgICog\ndXNlcidzIHJhdyBtYXBwaW5nIGluZm8gaWYgZ2l2ZW4uIE9ubHkgc3VwcG9y\ndHMgc2ltcGxlIGZpZWxkIHR5cGVzLgogICAgICogVGhlIGNvbHVtbiBuYW1l\nIHdpbGwgYmUgc2V0IHRvIHRoZSBuYW1lIG9mIHRoZSByZWxhdGVkIHByaW1h\ncnkga2V5CiAgICAgKiBjb2x1bW4sIGlmIGFueS4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgQ29sdW1uIG1hcFByaW1hcnlLZXkoVmFsdWVNYXBwaW5n\nIHZtLCBGaWVsZE1hcHBpbmcgcGspIHsKICAgICAgICBMaXN0IGNvbHMgPSBw\nay5nZXRWYWx1ZUluZm8oKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgaWYgKGNv\nbHMuc2l6ZSgpID4gMSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtdW5tYXBwZWQtcmVsIiwgdm0sIHBr\nKSk7CgogICAgICAgIENvbHVtbiB0bXBsYXRlID0gbnVsbDsKICAgICAgICBp\nZiAoY29scy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgdG1wbGF0ZSA9IChD\nb2x1bW4pIGNvbHMuZ2V0KDApOwoKICAgICAgICBDb2x1bW4gY29sID0gbmV3\nIENvbHVtbigpOwogICAgICAgIHN3aXRjaCAocGsuZ2V0VHlwZUNvZGUoKSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9P\nQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuU1RSSU5HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdJ\nTlRFR0VSOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFM\nOgogICAgICAgICAgICAgICAgY29sLnNldEphdmFUeXBlKHBrLmdldFR5cGVD\nb2RlKCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBjb2wuc2V0SmF2\nYVR5cGUoSmF2YVNRTFR5cGVzLmdldERhdGVUeXBlQ29kZShway5nZXRUeXBl\nKCkpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKAogICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJiYWQtdW5tYXBw\nZWQtcmVsIiwgdm0sIHBrKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodG1w\nbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGNvbC5zZXROYW1lKHRtcGxh\ndGUuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgY29sLnNldFR5cGUodG1wbGF0\nZS5nZXRUeXBlKCkpOwogICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUodG1w\nbGF0ZS5nZXRUeXBlTmFtZSgpKTsKICAgICAgICAgICAgY29sLnNldFNpemUo\ndG1wbGF0ZS5nZXRTaXplKCkpOwogICAgICAgICAgICBjb2wuc2V0RGVjaW1h\nbERpZ2l0cyh0bXBsYXRlLmdldERlY2ltYWxEaWdpdHMoKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBjb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBpbnN0YW5j\nZSwgdXNpbmcgYSBkZXRhY2hlZAogICAgICogc3RhdGUgbWFuYWdlciBpZiB0\naGUgaW5zdG5hY2UgaXMgbm90IG1hbmFnZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgT3BlbkpQQVN0YXRlTWFuYWdlciBnZXRTdGF0ZU1hbmFnZXIo\nT2JqZWN0IG9iaiwKICAgICAgICBTdG9yZUNvbnRleHQgY3R4KSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gY3R4LmdldFN0YXRl\nTWFuYWdlcihvYmopOwogICAgICAgIGlmIChzbSA9PSBudWxsKSAvLyBtdXN0\nIGJlIGRldGFjaGVkCiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoZWRW\nYWx1ZVN0YXRlTWFuYWdlcihvYmosIGN0eCk7CiAgICAgICAgcmV0dXJuIHNt\nOwogICAgfQp9Cg==\n","encoding":"base64"}

