{"sha":"6dfa8474e58ba28a89ff97ff6c862278c2e9e0bd","node_id":"MDQ6QmxvYjIwNjM2NDo2ZGZhODQ3NGU1OGJhMjhhODlmZjk3ZmY2Yzg2MjI3OGMyZTllMGJk","size":13584,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6dfa8474e58ba28a89ff97ff6c862278c2e9e0bd","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkZpZWxkTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhbmdlVHJhY2tlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94aWVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CgovKioKICogTWFw\ncyBhIHJlbGF0aW9uIHRvIGEgc2V0IG9mIG90aGVyIG9iamVjdHMgdXNpbmcg\nYW4gaW52ZXJzZQogKiBmb3JlaWduIGtleSBpbiB0aGUgcmVsYXRlZCBvYmpl\nY3QgdGFibGUuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMg\nYWJzdHJhY3QgY2xhc3MgUmVsYXRpb25Ub01hbnlJbnZlcnNlS2V5RmllbGRT\ndHJhdGVneQogICAgZXh0ZW5kcyBTdG9yZUNvbGxlY3Rpb25GaWVsZFN0cmF0\nZWd5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFJlbGF0aW9uVG9N\nYW55SW52ZXJzZUtleUZpZWxkU3RyYXRlZ3kuY2xhc3MpOwoKICAgIHByaXZh\ndGUgYm9vbGVhbiBfb3JkZXJJbnNlcnQgPSBmYWxzZTsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfb3JkZXJVcGRhdGUgPSBmYWxzZTsKCiAgICBwcm90ZWN0ZWQg\nQ2xhc3NNYXBwaW5nW10gZ2V0SW5kZXBlbmRlbnRFbGVtZW50TWFwcGluZ3Mo\nYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIHJldHVybiBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgZ2V0Sm9pbkZvcmVp\nZ25LZXkoQ2xhc3NNYXBwaW5nIGVsZW0pIHsKICAgICAgICByZXR1cm4gZmll\nbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRGb3JlaWduS2V5KGVsZW0pOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHNlbGVjdEVsZW1lbnQoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAgICAgICAgSkRCQ1N0b3JlIHN0\nb3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJN\nb2RlLAogICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsLnNlbGVj\ndChlbGVtLCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwKICAgICAgICAgICAgc3RvcmUsIGZldGNoLCBlYWdlck1v\nZGUsIGpvaW5zKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGxvYWRF\nbGVtZW50KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9y\nZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1\nbHQgcmVzLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgZWxlbSA9IHJlcy5nZXRCYXNl\nTWFwcGluZygpOwogICAgICAgIGlmIChlbGVtID09IG51bGwpCiAgICAgICAg\nICAgIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldEluZGVw\nZW5kZW50VHlwZU1hcHBpbmdzKClbMF07CiAgICAgICAgcmV0dXJuIHJlcy5s\nb2FkKGVsZW0sIHN0b3JlLCBmZXRjaCwgam9pbnMpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcg\nZWxlbSkgewogICAgICAgIFZhbHVlTWFwcGluZyB2bSA9IGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgRm9yZWlnbktleSBmayA9IHZtLmdl\ndEZvcmVpZ25LZXkoZWxlbSk7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG93bmVy\nID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgd2hpbGUg\nKGZrLmdldFByaW1hcnlLZXlUYWJsZSgpICE9IG93bmVyLmdldFRhYmxlKCkp\nIHsKICAgICAgICAgICAgam9pbnMgPSBvd25lci5qb2luU3VwZXJjbGFzcyhq\nb2lucywgZmFsc2UpOwogICAgICAgICAgICBvd25lciA9IG93bmVyLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOyAKICAgICAgICAgICAgaWYg\nKG93bmVyID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpv\naW5zLmpvaW5SZWxhdGlvbihmaWVsZC5nZXROYW1lKCksIGZrLCBlbGVtLCAK\nICAgICAgICAgICAgdm0uZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCB0cnVlLCB0\ncnVlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgSm9pbnMgam9pbkVsZW1lbnRS\nZWxhdGlvbihKb2lucyBqb2lucywgQ2xhc3NNYXBwaW5nIGVsZW0pIHsKICAg\nICAgICByZXR1cm4gam9pblJlbGF0aW9uKGpvaW5zLCBmYWxzZSwgZmFsc2Up\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1hcChib29sZWFuIGFkYXB0KSB7\nCiAgICAgICAgZmllbGQuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFD\nb21wb25lbnRzKGZpZWxkLCAhYWRhcHQpOwogICAgICAgIGZpZWxkLmdldEtl\neU1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBv\nbmVudHMKICAgICAgICAgICAgKGZpZWxkLmdldEtleSgpLCAhYWRhcHQpOwoK\nICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZpZWxkLmdldEVsZW1lbnRN\nYXBwaW5nKCk7CiAgICAgICAgaWYgKGVsZW0uZ2V0VHlwZUNvZGUoKSAhPSBK\nYXZhVHlwZXMuUEMgfHwgZWxlbS5pc0VtYmVkZGVkUEMoKQogICAgICAgICAg\nICB8fCAhZWxlbS5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm90LWVsZW0tcmVsYXRpb24iLCBmaWVsZCkpOwoKICAgICAgICAvLyBjaGVj\nayBmb3IgbmFtZWQgaW52ZXJzZQogICAgICAgIEZpZWxkTWFwcGluZyBtYXBw\nZWQgPSBmaWVsZC5nZXRNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICBGaWVs\nZE1hcHBpbmdJbmZvIGZpbmZvID0gZmllbGQuZ2V0TWFwcGluZ0luZm8oKTsK\nICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0gZWxlbS5nZXRWYWx1\nZUluZm8oKTsKICAgICAgICBib29sZWFuIGNyaXRlcmlhID0gdmluZm8uZ2V0\nVXNlQ2xhc3NDcml0ZXJpYSgpOwogICAgICAgIGlmIChtYXBwZWQgIT0gbnVs\nbCkgewogICAgICAgICAgICBtYXBwZWQucmVzb2x2ZShtYXBwZWQuTU9ERV9N\nRVRBIHwgbWFwcGVkLk1PREVfTUFQUElORyk7CiAgICAgICAgICAgIGlmICgh\nKG1hcHBlZC5nZXRTdHJhdGVneSgpaW5zdGFuY2VvZiBSZWxhdGlvbkZpZWxk\nU3RyYXRlZ3kpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtaW52LXJlbGF0aW9uIiwKICAgICAg\nICAgICAgICAgICAgICBmaWVsZCwgbWFwcGVkKSk7CiAgICAgICAgICAgIHZp\nbmZvLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cyhlbGVtLCAhYWRhcHQpOwog\nICAgICAgICAgICBlbGVtLnNldEZvcmVpZ25LZXkobWFwcGVkLmdldEZvcmVp\nZ25LZXkKICAgICAgICAgICAgICAgIChmaWVsZC5nZXREZWZpbmluZ01hcHBp\nbmcoKSkpOwogICAgICAgICAgICBlbGVtLnNldENvbHVtbnMobWFwcGVkLmdl\ndERlZmluaW5nTWFwcGluZygpLgogICAgICAgICAgICAgICAgZ2V0UHJpbWFy\neUtleUNvbHVtbnMoKSk7CiAgICAgICAgICAgIGVsZW0uc2V0Sm9pbkRpcmVj\ndGlvbihWYWx1ZU1hcHBpbmcuSk9JTl9FWFBFQ1RFRF9JTlZFUlNFKTsKICAg\nICAgICAgICAgZWxlbS5zZXRVc2VDbGFzc0NyaXRlcmlhKGNyaXRlcmlhKTsK\nCiAgICAgICAgICAgIGZpZWxkLnNldE9yZGVyQ29sdW1uKGZpbmZvLmdldE9y\nZGVyQ29sdW1uKGZpZWxkLAogICAgICAgICAgICAgICAgbWFwcGVkLmdldEZv\ncmVpZ25LZXkoKS5nZXRUYWJsZSgpLCBhZGFwdCkpOwogICAgICAgICAgICBm\naWVsZC5zZXRPcmRlckNvbHVtbklPKGZpbmZvLmdldENvbHVtbklPKCkpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBtYXAg\naW52ZXJzZSBmb3JlaWduIGtleSBpbiByZWxhdGVkIHRhYmxlCiAgICAgICAg\nRm9yZWlnbktleSBmayA9IHZpbmZvLmdldEludmVyc2VUeXBlSm9pbihlbGVt\nLCBmaWVsZC5nZXROYW1lKCksIGFkYXB0KTsKICAgICAgICBlbGVtLnNldEZv\ncmVpZ25LZXkoZmspOwogICAgICAgIGVsZW0uc2V0Q29sdW1uSU8odmluZm8u\nZ2V0Q29sdW1uSU8oKSk7CiAgICAgICAgZWxlbS5zZXRDb2x1bW5zKGVsZW0u\nZ2V0VHlwZU1hcHBpbmcoKS5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAg\nICAgICBlbGVtLnNldEpvaW5EaXJlY3Rpb24oVmFsdWVNYXBwaW5nLkpPSU5f\nRVhQRUNURURfSU5WRVJTRSk7CiAgICAgICAgZWxlbS5zZXRVc2VDbGFzc0Ny\naXRlcmlhKGNyaXRlcmlhKTsKICAgICAgICBlbGVtLm1hcENvbnN0cmFpbnRz\nKGZpZWxkLmdldE5hbWUoKSwgYWRhcHQpOwoKICAgICAgICBmaWVsZC5zZXRP\ncmRlckNvbHVtbihmaW5mby5nZXRPcmRlckNvbHVtbihmaWVsZCwgZmsuZ2V0\nVGFibGUoKSwKICAgICAgICAgICAgYWRhcHQpKTsKICAgICAgICBmaWVsZC5z\nZXRPcmRlckNvbHVtbklPKGZpbmZvLmdldENvbHVtbklPKCkpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoKSB7CiAgICAgICAgQ29sdW1u\nIG9yZGVyID0gZmllbGQuZ2V0T3JkZXJDb2x1bW4oKTsKICAgICAgICBfb3Jk\nZXJJbnNlcnQgPSBmaWVsZC5nZXRPcmRlckNvbHVtbklPKCkuaXNJbnNlcnRh\nYmxlKG9yZGVyLCBmYWxzZSk7CiAgICAgICAgX29yZGVyVXBkYXRlID0gZmll\nbGQuZ2V0T3JkZXJDb2x1bW5JTygpLmlzVXBkYXRhYmxlKG9yZGVyLCBmYWxz\nZSk7CgogICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKTsKICAgICAgICBMb2cgbG9nID0gZmllbGQuZ2V0UmVw\nb3NpdG9yeSgpLmdldExvZygpOwogICAgICAgIGlmIChmaWVsZC5nZXRNYXBw\nZWRCeSgpID09IG51bGwKICAgICAgICAgICAgJiYgZWxlbS5nZXRVc2VDbGFz\nc0NyaXRlcmlhKCkgJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAg\nICAgICBGb3JlaWduS2V5IGZrID0gZWxlbS5nZXRGb3JlaWduS2V5KCk7CiAg\nICAgICAgICAgIGlmIChlbGVtLmdldENvbHVtbklPKCkuaXNBbnlVcGRhdGFi\nbGUoZmssIGZhbHNlKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2Mu\nZ2V0KCJjbGFzcy1jcml0LW93bmVyIiwgZmllbGQpKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQuZ2V0\nTWFwcGVkQnkoKSA9PSBudWxsIHx8IF9vcmRlckluc2VydCB8fCBfb3JkZXJV\ncGRhdGUpCiAgICAgICAgICAgIGluc2VydChzbSwgcm0sIHNtLmZldGNoT2Jq\nZWN0KGZpZWxkLmdldEluZGV4KCkpKTsKICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFJvd01hbmFnZXIg\ncm0sIE9iamVjdCB2YWxzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpICE9IG51bGwgJiYg\nIV9vcmRlckluc2VydCAmJiAhX29yZGVyVXBkYXRlKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gdG9Db2xsZWN0aW9u\nKHZhbHMpOwogICAgICAgIGlmIChjb2xsID09IG51bGwgfHwgY29sbC5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNYXBw\naW5nIHJlbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1h\ncHBpbmcoKTsKICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsg\naWR4KyspCiAgICAgICAgICAgIHVwZGF0ZUludmVyc2Uoc20uZ2V0Q29udGV4\ndCgpLCBpdHIubmV4dCgpLCByZWwsIHJtLCBzbSwgaWR4KTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRC\neSgpICE9IG51bGwgJiYgIV9vcmRlckluc2VydCAmJiAhX29yZGVyVXBkYXRl\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE9iamVjdCBvYmogPSBz\nbS5mZXRjaE9iamVjdChmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICBDaGFu\nZ2VUcmFja2VyIGN0ID0gbnVsbDsKICAgICAgICBpZiAob2JqIGluc3RhbmNl\nb2YgUHJveHkpIHsKICAgICAgICAgICAgUHJveHkgcHJveHkgPSAoUHJveHkp\nIG9iajsKICAgICAgICAgICAgaWYgKFByb3hpZXMuaXNPd25lcihwcm94eSwg\nc20sIGZpZWxkLmdldEluZGV4KCkpKQogICAgICAgICAgICAgICAgY3QgPSBw\ncm94eS5nZXRDaGFuZ2VUcmFja2VyKCk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBpZiBubyBmaW5lLWdyYWluZWQgY2hhbmdlIHRyYWNraW5nIHRoZW4ganVz\ndCBkZWxldGUgYW5kIHJlaW5zZXJ0CiAgICAgICAgaWYgKGN0ID09IG51bGwg\nfHwgIWN0LmlzVHJhY2tpbmcoKSkgewogICAgICAgICAgICBkZWxldGUoc20s\nIHN0b3JlLCBybSk7CiAgICAgICAgICAgIGluc2VydChzbSwgcm0sIG9iaik7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG51\nbGwgaW52ZXJzZSBjb2x1bW5zIGZvciBkZWxldGVzIGFuZCB1cGRhdGUgdGhl\nbSB3aXRoIG91ciBvaWQgZm9yCiAgICAgICAgLy8gaW5zZXJ0cwogICAgICAg\nIENsYXNzTWFwcGluZyByZWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9\nIHN0b3JlLmdldENvbnRleHQoKTsKICAgICAgICBpZiAoZmllbGQuZ2V0TWFw\ncGVkQnkoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gcmVt\nID0gY3QuZ2V0UmVtb3ZlZCgpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHJlbS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgIHVwZGF0ZUludmVyc2UoY3R4LCBpdHIubmV4dCgpLCByZWws\nIHJtLCBudWxsLCAwKTsKICAgICAgICB9CgogICAgICAgIENvbGxlY3Rpb24g\nYWRkID0gY3QuZ2V0QWRkZWQoKTsKICAgICAgICBpbnQgc2VxID0gY3QuZ2V0\nTmV4dFNlcXVlbmNlKCk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBh\nZGQuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgc2VxKyspCiAgICAgICAg\nICAgIHVwZGF0ZUludmVyc2UoY3R4LCBpdHIubmV4dCgpLCByZWwsIHJtLCBz\nbSwgc2VxKTsKICAgICAgICBpZiAoZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAh\nPSBudWxsKQogICAgICAgICAgICBjdC5zZXROZXh0U2VxdWVuY2Uoc2VxKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5n\nZXRNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gaWYgbnVsbGFibGUsIG51bGwgYW55IGV4aXN0aW5nIGludmVy\nc2UgY29sdW1ucyB0aGF0IHJlZmVyIHRvIHRoaXMgb2JqCiAgICAgICAgVmFs\ndWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwog\nICAgICAgIENvbHVtbklPIGlvID0gZWxlbS5nZXRDb2x1bW5JTygpOwogICAg\nICAgIEZvcmVpZ25LZXkgZmsgPSBlbGVtLmdldEZvcmVpZ25LZXkoKTsKICAg\nICAgICBpZiAoIWVsZW0uZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpICYmIGlvLmlz\nQW55VXBkYXRhYmxlKGZrLCB0cnVlKSkgeyAKICAgICAgICAgICAgYXNzZXJ0\nSW52ZXJzYWJsZSgpOwogICAgICAgICAgICBSb3cgcm93ID0gcm0uZ2V0QWxs\nUm93cyhmay5nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX1VQREFURSk7CiAgICAg\nICAgICAgIHJvdy5zZXRGb3JlaWduS2V5KGZrLCBpbywgbnVsbCk7CiAgICAg\nICAgICAgIHJvdy53aGVyZUZvcmVpZ25LZXkoZmssIHNtKTsKICAgICAgICAg\nICAgcm0uZmx1c2hBbGxSb3dzKHJvdyk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIGlmICghc20uZ2V0TG9hZGVkKCkuZ2V0KGZp\nZWxkLmdldEluZGV4KCkpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIHVwZGF0ZSBmayBvbiBlYWNoIGZpZWxkIHZhbHVlIHJvdwogICAgICAg\nIENsYXNzTWFwcGluZyByZWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9\nIHN0b3JlLmdldENvbnRleHQoKTsKICAgICAgICBDb2xsZWN0aW9uIG9ianMg\nPSB0b0NvbGxlY3Rpb24oc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgo\nKSkpOwogICAgICAgIGlmIChvYmpzICE9IG51bGwgJiYgIW9ianMuaXNFbXB0\neSgpKQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICB1cGRh\ndGVJbnZlcnNlIChjdHgsIGl0ci5uZXh0KCksIHJlbCwgcm0sIHNtLCAwKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIHVwZGF0ZXMgdGhl\nIGludmVyc2UgY29sdW1ucyBvZiBhIDEtTSByZWxhdGVkIG9iamVjdAogICAg\nICogd2l0aCB0aGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgdXBkYXRlSW52ZXJzZShTdG9yZUNvbnRleHQgY3R4LCBPYmplY3QgaW52\nZXJzZSwKICAgICAgICBDbGFzc01hcHBpbmcgcmVsLCBSb3dNYW5hZ2VyIHJt\nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQgaWR4KQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgaW52c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2Vy\nKGludmVyc2UsCiAgICAgICAgICAgIGN0eCk7CiAgICAgICAgaWYgKGludnNt\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWVN\nYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAg\nICAgIEZvcmVpZ25LZXkgZmsgPSBlbGVtLmdldEZvcmVpZ25LZXkoKTsKICAg\nICAgICBDb2x1bW5JTyBpbyA9IGVsZW0uZ2V0Q29sdW1uSU8oKTsKICAgICAg\nICBDb2x1bW4gb3JkZXIgPSBmaWVsZC5nZXRPcmRlckNvbHVtbigpOwoKICAg\nICAgICBpbnQgYWN0aW9uOwogICAgICAgIGJvb2xlYW4gd3JpdGVhYmxlOwog\nICAgICAgIGJvb2xlYW4gb3JkZXJXcml0ZWFibGU7CiAgICAgICAgaWYgKGlu\ndnNtLmlzTmV3KCkgJiYgIWludnNtLmlzRmx1c2hlZCgpKSB7CiAgICAgICAg\nICAgIC8vIG5vIG5lZWQgdG8gbnVsbCBpbnZlcnNlIGNvbHVtbnMgb2YgbmV3\nIGluc3RhbmNlCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsIHx8IHNtLmlz\nRGVsZXRlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICB3cml0ZWFibGUgPSBpby5pc0FueUluc2VydGFibGUoZmssIGZhbHNlKTsK\nICAgICAgICAgICAgb3JkZXJXcml0ZWFibGUgPSBfb3JkZXJJbnNlcnQ7CiAg\nICAgICAgICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05fSU5TRVJUOwogICAgICAg\nIH0gZWxzZSBpZiAoaW52c20uaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAg\nLy8gbm8gbmVlZCB0byBudWxsIGludmVyc2UgY29sdW1ucyBvZiBkZWxldGVk\nIGluc3RhbmNlCiAgICAgICAgICAgIGlmIChpbnZzbS5pc0ZsdXNoZWQoKSB8\nfCBzbSA9PSBudWxsIHx8ICFzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgd3JpdGVhYmxlID0gdHJ1ZTsKICAg\nICAgICAgICAgb3JkZXJXcml0ZWFibGUgPSBmYWxzZTsKICAgICAgICAgICAg\nYWN0aW9uID0gUm93LkFDVElPTl9ERUxFVEU7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uaXNEZWxldGVkKCkp\nCiAgICAgICAgICAgICAgICBzbSA9IG51bGw7CiAgICAgICAgICAgIHdyaXRl\nYWJsZSA9IGlvLmlzQW55VXBkYXRhYmxlKGZrLCBzbSA9PSBudWxsKTsKICAg\nICAgICAgICAgb3JkZXJXcml0ZWFibGUgPSBmaWVsZC5nZXRPcmRlckNvbHVt\nbklPKCkuaXNVcGRhdGFibGUKICAgICAgICAgICAgICAgIChvcmRlciwgc20g\nPT0gbnVsbCk7CiAgICAgICAgICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05fVVBE\nQVRFOwogICAgICAgIH0KICAgICAgICBpZiAoIXdyaXRlYWJsZSAmJiAhb3Jk\nZXJXcml0ZWFibGUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYXNz\nZXJ0SW52ZXJzYWJsZSgpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGFuIHVw\nZGF0ZSwgdGhpcyBtaWdodCBiZSB0aGUgb25seSBtb2QgdG8gdGhlIHJvdywg\nc28KICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHdoZXJlIGNvbmRpdGlvbiBp\ncyBzZXQKICAgICAgICBSb3cgcm93ID0gcm0uZ2V0Um93KGZrLmdldFRhYmxl\nKCksIGFjdGlvbiwgaW52c20sIHRydWUpOwogICAgICAgIGlmIChhY3Rpb24g\nPT0gUm93LkFDVElPTl9VUERBVEUpCiAgICAgICAgICAgIHJvdy53aGVyZVBy\naW1hcnlLZXkoaW52c20pOwoKICAgICAgICAvLyB1cGRhdGUgdGhlIGludmVy\nc2UgcG9pbnRlciB3aXRoIG91ciBvaWQgdmFsdWUKICAgICAgICBpZiAod3Jp\ndGVhYmxlKQogICAgICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaywgaW8s\nIHNtKTsKICAgICAgICBpZiAob3JkZXJXcml0ZWFibGUpCiAgICAgICAgICAg\nIHJvdy5zZXRJbnQob3JkZXIsIGlkeCk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCB0b0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBz\ndG9yZSkgewogICAgICAgIENsYXNzTWFwcGluZyBjbSA9IGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICByZXR1\ncm4gY20udG9EYXRhU3RvcmVWYWx1ZSh2YWwsIGNtLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCksIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9p\nbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyKSB7CiAgICAgICAg\nVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBlbGVtLmdldEluZGVw\nZW5kZW50VHlwZU1hcHBpbmdzKCk7CiAgICAgICAgaWYgKGNsc3MubGVuZ3Ro\nICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51\nbmpvaW5hYmxlKGVsZW0pOwogICAgICAgIGlmIChmb3JjZU91dGVyKQogICAg\nICAgICAgICByZXR1cm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQu\nZ2V0TmFtZSgpLCAKICAgICAgICAgICAgICAgIGVsZW0uZ2V0Rm9yZWlnbktl\neShjbHNzWzBdKSwgY2xzc1swXSwKICAgICAgICAgICAgICAgIGVsZW0uZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpLCB0cnVlLCB0cnVlKTsKICAgICAgICByZXR1\ncm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgZWxlbS5n\nZXRGb3JlaWduS2V5KGNsc3NbMF0pLAogICAgICAgICAgICBjbHNzWzBdLCBl\nbGVtLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIGFzc2VydEludmVyc2FibGUoKSB7CiAgICAg\nICAgVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGlu\nZygpOwogICAgICAgIGlmIChlbGVtLmdldEluZGVwZW5kZW50VHlwZU1hcHBp\nbmdzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9u\nU3RyYXRlZ2llcy51bmludmVyc2FibGUoZWxlbSk7CiAgICB9Cn0K\n","encoding":"base64"}

