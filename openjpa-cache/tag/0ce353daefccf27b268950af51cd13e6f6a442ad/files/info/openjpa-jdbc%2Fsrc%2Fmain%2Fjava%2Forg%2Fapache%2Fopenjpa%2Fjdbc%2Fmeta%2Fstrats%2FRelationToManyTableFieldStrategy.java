{"sha":"c845302fcbdafee496b786d1a8c33740e1907b12","node_id":"MDQ6QmxvYjIwNjM2NDpjODQ1MzAyZmNiZGFmZWU0OTZiNzg2ZDFhOGMzMzc0MGUxOTA3YjEy","size":10441,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c845302fcbdafee496b786d1a8c33740e1907b12","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkZpZWxkTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhbmdlVHJhY2tlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveGllczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5OwoKLyoqCiAqIE1hcHMg\nYSBzZXQgb2YgcmVsYXRlZCBvYmplY3RzIHRocm91Z2ggYW4gYXNzb2NpYXRp\nb24gdGFibGUuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMg\nYWJzdHJhY3QgY2xhc3MgUmVsYXRpb25Ub01hbnlUYWJsZUZpZWxkU3RyYXRl\nZ3kKICAgIGV4dGVuZHMgU3RvcmVDb2xsZWN0aW9uRmllbGRTdHJhdGVneSB7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChSZWxhdGlvblRvTWFueVRh\nYmxlRmllbGRTdHJhdGVneS5jbGFzcyk7CgogICAgcHJvdGVjdGVkIENsYXNz\nTWFwcGluZ1tdIGdldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKGJvb2xl\nYW4gdHJhdmVyc2UpIHsKICAgICAgICByZXR1cm4gKHRyYXZlcnNlKQogICAg\nICAgICAgICA/IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0SW5kZXBl\nbmRlbnRUeXBlTWFwcGluZ3MoKQogICAgICAgICAgICA6IENsYXNzTWFwcGlu\nZy5FTVBUWV9NQVBQSU5HUzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRm9yZWln\nbktleSBnZXRKb2luRm9yZWlnbktleShDbGFzc01hcHBpbmcgZWxlbSkgewog\nICAgICAgIHJldHVybiBmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpOwogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIHNlbGVjdEVsZW1lbnQoU2VsZWN0IHNl\nbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3Jl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2Rl\nLAogICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsLnNlbGVjdChl\nbGVtLCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFNlbGVjdFN1YmNs\nYXNzZXMoKSwKICAgICAgICAgICAgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUs\nIGpvaW5zKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGxvYWRFbGVt\nZW50KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwK\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQg\ncmVzLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBDbGFzc01hcHBpbmcgZWxlbSA9IHJlcy5nZXRCYXNlTWFw\ncGluZygpOwogICAgICAgIGlmIChlbGVtID09IG51bGwpCiAgICAgICAgICAg\nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldEluZGVwZW5k\nZW50VHlwZU1hcHBpbmdzKClbMF07CiAgICAgICAgcmV0dXJuIHJlcy5sb2Fk\nKGVsZW0sIHN0b3JlLCBmZXRjaCwgam9pbnMpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgZWxl\nbSkgewogICAgICAgIHJldHVybiBqb2luKGpvaW5zLCBmYWxzZSk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIEpvaW5zIGpvaW5FbGVtZW50UmVsYXRpb24oSm9p\nbnMgam9pbnMsIENsYXNzTWFwcGluZyBlbGVtKSB7CiAgICAgICAgVmFsdWVN\nYXBwaW5nIHZtID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAg\nICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwg\ndm0uZ2V0Rm9yZWlnbktleShlbGVtKSwgCiAgICAgICAgICAgIGVsZW0sIHZt\nLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBtYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAg\nIGZpZWxkLmdldFZhbHVlSW5mbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50\ncyhmaWVsZCwgIWFkYXB0KTsKICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5n\nKCkuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAg\nICAgICAgICAgIChmaWVsZC5nZXRLZXkoKSwgIWFkYXB0KTsKCiAgICAgICAg\nVmFsdWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygp\nOwogICAgICAgIGlmIChlbGVtLmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVz\nLlBDIHx8IGVsZW0uaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWVsZW0tcmVs\nYXRpb24iLCBmaWVsZCkpOwoKICAgICAgICAvLyBjaGVjayBmb3IgbmFtZWQg\naW52ZXJzZQogICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWQgPSBmaWVsZC5n\nZXRNYXBwZWRCeU1hcHBpbmcoKTsKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZv\nIHZpbmZvID0gZWxlbS5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBib29sZWFu\nIGNyaXRlcmlhID0gdmluZm8uZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpOwogICAg\nICAgIGlmIChtYXBwZWQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAobWFw\ncGVkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5Q\nQykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm90LWludi1yZWxhdGlvbi1jb2xsIiwKICAgICAgICAg\nICAgICAgICAgICBmaWVsZCwgbWFwcGVkKSk7CiAgICAgICAgICAgIGZpZWxk\nLmdldE1hcHBpbmdJbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzKGZp\nZWxkLCAhYWRhcHQpOwogICAgICAgICAgICB2aW5mby5hc3NlcnROb1NjaGVt\nYUNvbXBvbmVudHMoZWxlbSwgIWFkYXB0KTsKICAgICAgICAgICAgbWFwcGVk\nLnJlc29sdmUobWFwcGVkLk1PREVfTUVUQSB8IG1hcHBlZC5NT0RFX01BUFBJ\nTkcpOwoKICAgICAgICAgICAgaWYgKCFtYXBwZWQuZ2V0RGVmaW5pbmdNYXBw\naW5nKCkuaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibWFwcGVkLWJ5LXVubWFwcGVk\nIiwKICAgICAgICAgICAgICAgICAgICBmaWVsZCwgbWFwcGVkKSk7CgogICAg\nICAgICAgICBmaWVsZC5zZXRKb2luRm9yZWlnbktleShtYXBwZWQuZ2V0RWxl\nbWVudE1hcHBpbmcoKS4KICAgICAgICAgICAgICAgIGdldEZvcmVpZ25LZXko\nZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkpKTsKICAgICAgICAgICAgZWxl\nbS5zZXRGb3JlaWduS2V5KG1hcHBlZC5nZXRKb2luRm9yZWlnbktleSgpKTsK\nICAgICAgICAgICAgZWxlbS5zZXRVc2VDbGFzc0NyaXRlcmlhKGNyaXRlcmlh\nKTsKICAgICAgICAgICAgZmllbGQuc2V0T3JkZXJDb2x1bW4obWFwcGVkLmdl\ndE9yZGVyQ29sdW1uKCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICBmaWVsZC5tYXBKb2luKGFkYXB0LCB0cnVlKTsKICAgICAg\nICBpZiAoZWxlbS5nZXRUeXBlTWFwcGluZygpLmlzTWFwcGVkKCkpIHsKICAg\nICAgICAgICAgRm9yZWlnbktleSBmayA9IHZpbmZvLmdldFR5cGVKb2luKGVs\nZW0sICJlbGVtZW50IiwgZmFsc2UsIGFkYXB0KTsKICAgICAgICAgICAgZWxl\nbS5zZXRGb3JlaWduS2V5KGZrKTsKICAgICAgICAgICAgZWxlbS5zZXRDb2x1\nbW5JTyh2aW5mby5nZXRDb2x1bW5JTygpKTsKICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgUmVsYXRpb25TdHJhdGVnaWVzLm1hcFJlbGF0aW9uVG9Vbm1h\ncHBlZFBDKGVsZW0sICJlbGVtZW50IiwgYWRhcHQpOwogICAgICAgIGVsZW0u\nc2V0VXNlQ2xhc3NDcml0ZXJpYShjcml0ZXJpYSk7CiAgICAgICAgZWxlbS5t\nYXBDb25zdHJhaW50cygiZWxlbWVudCIsIGFkYXB0KTsKCiAgICAgICAgRmll\nbGRNYXBwaW5nSW5mbyBmaW5mbyA9IGZpZWxkLmdldE1hcHBpbmdJbmZvKCk7\nCiAgICAgICAgQ29sdW1uIG9yZGVyQ29sID0gZmluZm8uZ2V0T3JkZXJDb2x1\nbW4oZmllbGQsIGZpZWxkLmdldFRhYmxlKCksIGFkYXB0KTsKICAgICAgICBm\naWVsZC5zZXRPcmRlckNvbHVtbihvcmRlckNvbCk7CiAgICAgICAgZmllbGQu\nc2V0T3JkZXJDb2x1bW5JTyhmaW5mby5nZXRDb2x1bW5JTygpKTsKICAgICAg\nICBmaWVsZC5tYXBQcmltYXJ5S2V5KGFkYXB0KTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0\nb3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpID09\nIG51bGwpCiAgICAgICAgICAgIGluc2VydChzbSwgcm0sIHNtLmZldGNoT2Jq\nZWN0KGZpZWxkLmdldEluZGV4KCkpKTsKICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFJvd01hbmFnZXIg\ncm0sIE9iamVjdCB2YWxzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIENvbGxlY3Rpb24gY29sbCA9IHRvQ29sbGVjdGlvbih2YWxz\nKTsKICAgICAgICBpZiAoY29sbCA9PSBudWxsIHx8IGNvbGwuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFJvdyByb3cgPSBybS5n\nZXRTZWNvbmRhcnlSb3coZmllbGQuZ2V0VGFibGUoKSwgUm93LkFDVElPTl9J\nTlNFUlQpOwogICAgICAgIHJvdy5zZXRGb3JlaWduS2V5KGZpZWxkLmdldEpv\naW5Gb3JlaWduS2V5KCksIGZpZWxkLmdldEpvaW5Db2x1bW5JTygpLAogICAg\nICAgICAgICBzbSk7CgogICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmll\nbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBTdG9yZUNvbnRleHQg\nY3R4ID0gc20uZ2V0Q29udGV4dCgpOwogICAgICAgIENvbHVtbiBvcmRlciA9\nIGZpZWxkLmdldE9yZGVyQ29sdW1uKCk7CiAgICAgICAgYm9vbGVhbiBzZXRP\ncmRlciA9IGZpZWxkLmdldE9yZGVyQ29sdW1uSU8oKS5pc0luc2VydGFibGUo\nb3JkZXIsIGZhbHNlKTsKICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIGVzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4Kysp\nIHsKICAgICAgICAgICAgZXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0\nYXRlTWFuYWdlcihpdHIubmV4dCgpLCBjdHgpOwogICAgICAgICAgICBlbGVt\nLnNldEZvcmVpZ25LZXkocm93LCBlc20pOwogICAgICAgICAgICBpZiAoc2V0\nT3JkZXIpCiAgICAgICAgICAgICAgICByb3cuc2V0SW50KG9yZGVyLCBpZHgp\nOwogICAgICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhyb3cpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJt\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\naWVsZC5nZXRNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgT2JqZWN0IG9iaiA9IHNtLmZldGNoT2JqZWN0KGZpZWxk\nLmdldEluZGV4KCkpOwogICAgICAgIENoYW5nZVRyYWNrZXIgY3QgPSBudWxs\nOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAg\nICAgICBQcm94eSBwcm94eSA9IChQcm94eSkgb2JqOwogICAgICAgICAgICBp\nZiAoUHJveGllcy5pc093bmVyKHByb3h5LCBzbSwgZmllbGQuZ2V0SW5kZXgo\nKSkpCiAgICAgICAgICAgICAgICBjdCA9IHByb3h5LmdldENoYW5nZVRyYWNr\nZXIoKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG5vIGZpbmUtZ3JhaW5l\nZCBjaGFuZ2UgdHJhY2tpbmcgdGhlbiBqdXN0IGRlbGV0ZSBhbmQgcmVpbnNl\ncnQKICAgICAgICBpZiAoY3QgPT0gbnVsbCB8fCAhY3QuaXNUcmFja2luZygp\nKSB7CiAgICAgICAgICAgIGRlbGV0ZShzbSwgc3RvcmUsIHJtKTsKICAgICAg\nICAgICAgaW5zZXJ0KHNtLCBybSwgb2JqKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHN0b3Jl\nLmdldENvbnRleHQoKTsKICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9IGZp\nZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBlc207CgogICAgICAgIC8vIGRlbGV0ZSB0aGUgcmVtb3Zlcwog\nICAgICAgIENvbGxlY3Rpb24gcmVtID0gY3QuZ2V0UmVtb3ZlZCgpOwogICAg\nICAgIGlmICghcmVtLmlzRW1wdHkoKSkgewogICAgICAgICAgICBSb3cgZGVs\nUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksCiAg\nICAgICAgICAgICAgICBSb3cuQUNUSU9OX0RFTEVURSk7CiAgICAgICAgICAg\nIGRlbFJvdy53aGVyZUZvcmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25L\nZXkoKSwgc20pOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBy\nZW0uaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIGVzbSA9IFJlbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIo\naXRyLm5leHQoKSwgY3R4KTsKICAgICAgICAgICAgICAgIGVsZW0ud2hlcmVG\nb3JlaWduS2V5KGRlbFJvdywgZXNtKTsKICAgICAgICAgICAgICAgIHJtLmZs\ndXNoU2Vjb25kYXJ5Um93KGRlbFJvdyk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIGluc2VydCB0aGUgYWRkcwogICAgICAgIENvbGxl\nY3Rpb24gYWRkID0gY3QuZ2V0QWRkZWQoKTsKICAgICAgICBpZiAoIWFkZC5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgUm93IGFkZFJvdyA9IHJtLmdldFNl\nY29uZGFyeVJvdyhmaWVsZC5nZXRUYWJsZSgpLAogICAgICAgICAgICAgICAg\nUm93LkFDVElPTl9JTlNFUlQpOwogICAgICAgICAgICBhZGRSb3cuc2V0Rm9y\nZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpLAogICAgICAgICAg\nICAgICAgZmllbGQuZ2V0Sm9pbkNvbHVtbklPKCksIHNtKTsKCiAgICAgICAg\nICAgIGludCBzZXEgPSBjdC5nZXROZXh0U2VxdWVuY2UoKTsKICAgICAgICAg\nICAgQ29sdW1uIG9yZGVyID0gZmllbGQuZ2V0T3JkZXJDb2x1bW4oKTsKICAg\nICAgICAgICAgYm9vbGVhbiBzZXRPcmRlciA9IGZpZWxkLmdldE9yZGVyQ29s\ndW1uSU8oKS5pc0luc2VydGFibGUob3JkZXIsCiAgICAgICAgICAgICAgICBm\nYWxzZSk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYWRkLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IHNlcSsrKSB7CiAgICAgICAgICAg\nICAgICBlc20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2Vy\nKGl0ci5uZXh0KCksIGN0eCk7CiAgICAgICAgICAgICAgICBlbGVtLnNldEZv\ncmVpZ25LZXkoYWRkUm93LCBlc20pOwogICAgICAgICAgICAgICAgaWYgKHNl\ndE9yZGVyKQogICAgICAgICAgICAgICAgICAgIGFkZFJvdy5zZXRJbnQob3Jk\nZXIsIHNlcSk7CiAgICAgICAgICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJv\ndyhhZGRSb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcmRl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgY3Quc2V0TmV4dFNlcXVlbmNl\nKHNlcSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0\nZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJv\nd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgUm93IHJvdyA9IHJtLmdldEFsbFJvd3MoZmllbGQuZ2V0VGFibGUo\nKSwgUm93LkFDVElPTl9ERUxFVEUpOwogICAgICAgIHJvdy53aGVyZUZvcmVp\nZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwgc20pOwogICAgICAg\nIHJtLmZsdXNoQWxsUm93cyhyb3cpOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgdG9EYXRhU3RvcmVWYWx1ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3Rv\ncmUpIHsKICAgICAgICByZXR1cm4gUmVsYXRpb25TdHJhdGVnaWVzLnRvRGF0\nYVN0b3JlVmFsdWUoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKSwKICAgICAg\nICAgICAgdmFsLCBzdG9yZSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIGpv\naW4oSm9pbnMgam9pbnMsIGJvb2xlYW4gZm9yY2VPdXRlcikgewogICAgICAg\nIHJldHVybiBmaWVsZC5qb2luKGpvaW5zLCBmb3JjZU91dGVyLCB0cnVlKTsK\nICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKEpvaW5zIGpv\naW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsCiAgICAgICAgYm9vbGVhbiB0cmF2\nZXJzZSkgewogICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0\nRWxlbWVudE1hcHBpbmcoKTsKICAgICAgICBDbGFzc01hcHBpbmdbXSBjbHNz\nID0gZWxlbS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOwogICAgICAg\nIGlmIChjbHNzLmxlbmd0aCAhPSAxKSB7CiAgICAgICAgICAgIGlmICh0cmF2\nZXJzZSkKICAgICAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2ll\ncy51bmpvaW5hYmxlKGVsZW0pOwogICAgICAgICAgICByZXR1cm4gam9pbnM7\nCiAgICAgICAgfQogICAgICAgIGlmIChmb3JjZU91dGVyKQogICAgICAgICAg\nICByZXR1cm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgZWxlbS5nZXRGb3JlaWduS2V5KGNsc3Nb\nMF0pLCBjbHNzWzBdLCAKICAgICAgICAgICAgICAgIGVsZW0uZ2V0U2VsZWN0\nU3ViY2xhc3NlcygpLCBmYWxzZSwgZmFsc2UpOwogICAgICAgIHJldHVybiBq\nb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLCBlbGVtLmdldEZv\ncmVpZ25LZXkoY2xzc1swXSksCiAgICAgICAgICAgIGNsc3NbMF0sIGVsZW0u\nZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBmYWxzZSwgZmFsc2UpOwogICAgfQp9\nCg==\n","encoding":"base64"}

