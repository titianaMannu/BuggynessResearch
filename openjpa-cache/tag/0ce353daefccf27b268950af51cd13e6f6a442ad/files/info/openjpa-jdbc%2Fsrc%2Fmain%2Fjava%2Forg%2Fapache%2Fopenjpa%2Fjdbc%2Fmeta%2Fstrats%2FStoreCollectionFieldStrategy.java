{"sha":"8787eedd18af240e3d8f21a1f116b80e05541b25","node_id":"MDQ6QmxvYjIwNjM2NDo4Nzg3ZWVkZDE4YWYyNDBlM2Q4ZjIxYTFmMTE2YjgwZTA1NTQxYjI1","size":20254,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8787eedd18af240e3d8f21a1f116b80e05541b25","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEuc3FsLlNR\nTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLkpEQkNTdG9yZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLkZpZWxkU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVjdXRvcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5VbmlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlByb3h5OwoKLyoqCiAqIEJhc2UgY2xhc3MgZm9yIHN0\ncmF0ZWdpZXMgdGhhdCBhcmUgc3RvcmVkIGFzIGEgY29sbGVjdGlvbiwgZXZl\nbiBpZgogKiB0aGVpciBmaWVsZCB2YWx1ZSBpcyBzb21ldGhpbmcgZWxzZS4g\nSGFuZGxlcyBkYXRhIGxvYWRpbmcgYW5kIGJhc2ljIHF1ZXJ5CiAqIGZ1bmN0\naW9uYWxpdHkuIFN1YmNsYXNzZXMgbXVzdCBpbXBsZW1lbnQgYWJzdHJhY3Qg\nbWV0aG9kcyBhbmQKICogaW5zZXJ0L3VwZGF0ZS9kZWxldGUgYmVoYXZpb3Ig\nYXMgd2VsbCBhcyBvdmVycmlkaW5nCiAqIHtAbGluayBGaWVsZFN0cmF0ZWd5\nI3RvRGF0YVN0b3JlVmFsdWV9LCB7QGxpbmsgRmllbGRTdHJhdGVneSNqb2lu\nfSwgYW5kCiAqIHtAbGluayBGaWVsZFN0cmF0ZWd5I2pvaW5SZWxhdGlvbn0g\naWYgbmVjZXNzYXJ5LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVi\nbGljIGFic3RyYWN0IGNsYXNzIFN0b3JlQ29sbGVjdGlvbkZpZWxkU3RyYXRl\nZ3kKICAgIGV4dGVuZHMgQ29udGFpbmVyRmllbGRTdHJhdGVneSB7CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZvcmVpZ24ga2V5IHVzZWQgdG8gam9p\nbiB0byB0aGUgb3duaW5nIGZpZWxkIGZvciB0aGUgZ2l2ZW4KICAgICAqIGVs\nZW1lbnQgbWFwcGluZyBmcm9tIHtAbGluayAjZ2V0SW5kZXBlbmRlbnRFbGVt\nZW50TWFwcGluZ3N9IChvciBudWxsKS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGFic3RyYWN0IEZvcmVpZ25LZXkgZ2V0Sm9pbkZvcmVpZ25LZXkoQ2xhc3NN\nYXBwaW5nIGVsZW0pOwoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRoaXMg\nbWV0aG9kIHRvIHNlbGVjdCB0aGUgZWxlbWVudHMgb2YgdGhpcyBmaWVsZCBm\nb3IgdGhlCiAgICAgKiBnaXZlbiBlbGVtZW50IG1hcHBpbmcgZnJvbSB7QGxp\nbmsgI2dldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzfQogICAgICogKG9y\nIG51bGwpLiBFbGVtZW50cyBvZiB0aGUgcmVzdWx0IHdpbGwgYmUgbG9hZGVk\nIHdpdGgKICAgICAqIHtAbGluayAjbG9hZEVsZW1lbnR9LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCBzZWxlY3RFbGVtZW50KFNlbGVj\ndCBzZWwsIENsYXNzTWFwcGluZyBlbGVtLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nTW9kZSwKICAgICAgICBKb2lucyBqb2lucyk7CgogICAgLyoqCiAgICAgKiBM\nb2FkIGFuIGVsZW1lbnQgb2YgdGhlIGNvbGxlY3Rpb24uIFRoZSBnaXZlbiBz\ndGF0ZSBtYW5hZ2VyIG1pZ2h0IGJlCiAgICAgKiBudWxsIGlmIHRoZSBsb2Fk\nIGlzIGZvciBhIHByb2plY3Rpb24gb3IgZm9yIHByb2Nlc3NpbmcgZWFnZXIg\ncGFyYWxsZWwKICAgICAqIHJlc3VsdHMuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBhYnN0cmFjdCBPYmplY3QgbG9hZEVsZW1lbnQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEpvaW5zIGpvaW5zKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb247CgogICAgLyoqCiAgICAgKiBK\nb2luIHRoaXMgdmFsdWUncyB0YWJsZSB0byB0aGUgdGFibGUgZm9yIHRoZSBn\naXZlbiBlbGVtZW50IG1hcHBpbmcKICAgICAqIGZyb20ge0BsaW5rICNnZXRJ\nbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5nc30gKG9yIG51bGwpLgogICAgICoK\nICAgICAqIEBzZWUgRmllbGRNYXBwaW5nI2pvaW5SZWxhdGlvbgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgSm9pbnMgam9pbkVsZW1lbnRSZWxh\ndGlvbihKb2lucyBqb2lucywKICAgICAgICBDbGFzc01hcHBpbmcgZWxlbSk7\nCgogICAgLyoqCiAgICAgKiBKb2luIHRvIHRoZSBvd25pbmcgZmllbGQgdGFi\nbGUgZm9yIHRoZSBnaXZlbiBlbGVtZW50IG1hcHBpbmcgZnJvbQogICAgICog\ne0BsaW5rICNnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5nc30gKG9yIG51\nbGwpLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgSm9pbnMgam9p\nbihKb2lucyBqb2lucywgQ2xhc3NNYXBwaW5nIGVsZW0pOwoKICAgIC8qKgog\nICAgICogUmV0dXJuIGEgbGFyZ2UgcmVzdWx0IHNldCBwcm94eSBmb3IgdGhp\ncyBmaWVsZC4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IFByb3h5\nIG5ld0xSU1Byb3h5KE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYpOwoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgZmllbGQgdmFsdWUgdG8gYSBjb2xs\nZWN0aW9uLiBIYW5kbGVzIGNvbGxlY3Rpb25zIGFuZAogICAgICogYXJyYXlz\nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9u\nIHRvQ29sbGVjdGlvbihPYmplY3QgdmFsKSB7CiAgICAgICAgaWYgKGZpZWxk\nLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkNPTExFQ1RJT04pCiAgICAg\nICAgICAgIHJldHVybiAoQ29sbGVjdGlvbikgdmFsOwogICAgICAgIHJldHVy\nbiBKYXZhVHlwZXMudG9MaXN0KHZhbCwgZmllbGQuZ2V0RWxlbWVudCgpLmdl\ndFR5cGUoKSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFu\nIGl0ZW0gdG8gdGhlIGRhdGEgc3RydWN0dXJlIHJlcHJlc2VudGluZyBhIGZp\nZWxkIHZhbHVlLgogICAgICogQnkgZGVmYXVsdCwgYXNzdW1lcyB0aGUgc3Ry\ndWN0dXJlIGlzIGEgY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgYWRkKEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0IGNvbGwsIE9iamVj\ndCBvYmopIHsKICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwpLmFkZChvYmop\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZmlyc3QgaW5k\nZXBlbmRlbnQgZWxlbWVudCBtYXBwaW5nLCBvciBudWxsLgogICAgICovCiAg\nICBwcml2YXRlIENsYXNzTWFwcGluZyBnZXREZWZhdWx0RWxlbWVudE1hcHBp\nbmcoYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIENsYXNzTWFwcGluZ1td\nIGVsZW1zID0gZ2V0SW5kZXBlbmRlbnRFbGVtZW50TWFwcGluZ3ModHJhdmVy\nc2UpOwogICAgICAgIHJldHVybiAoZWxlbXMubGVuZ3RoID09IDApID8gbnVs\nbCA6IGVsZW1zWzBdOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc3VwcG9ydHNT\nZWxlY3QoU2VsZWN0IHNlbCwgaW50IHR5cGUsIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKGZpZWxkLmlzTFJTKCkp\nCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmICh0eXBlID09IFNl\nbGVjdC5FQUdFUl9QQVJBTExFTCkKICAgICAgICAgICAgcmV0dXJuIE1hdGgu\nbWF4KDEsIGdldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRydWUpLmxl\nbmd0aCk7CiAgICAgICAgaWYgKHR5cGUgIT0gU2VsZWN0LkVBR0VSX0lOTkVS\nICYmIHR5cGUgIT0gU2VsZWN0LkVBR0VSX09VVEVSKQogICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICBpZiAoZ2V0SW5kZXBlbmRlbnRFbGVtZW50TWFw\ncGluZ3ModHJ1ZSkubGVuZ3RoID4gMSkKICAgICAgICAgICAgcmV0dXJuIDA7\nCiAgICAgICAgcmV0dXJuICh0eXBlID09IFNlbGVjdC5FQUdFUl9JTk5FUiB8\nfCBzdG9yZS5nZXREQkRpY3Rpb25hcnkoKS4KICAgICAgICAgICAgY2FuT3V0\nZXJKb2luKHNlbC5nZXRKb2luU3ludGF4KCksIGdldEpvaW5Gb3JlaWduS2V5\nCiAgICAgICAgICAgICAgICAoZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5nKGZh\nbHNlKSkpKSA/IDEgOiAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndEVhZ2VyUGFyYWxsZWwoU2VsZWN0RXhlY3V0b3Igc2VsLAogICAgICAgIGZp\nbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGZpbmFsIEpEQkNTdG9yZSBz\ndG9yZSwKICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBmaW5hbCBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgaWYgKCEoc2Vs\nIGluc3RhbmNlb2YgVW5pb24pKQogICAgICAgICAgICBzZWxlY3RFYWdlcigo\nU2VsZWN0KSBzZWwsIGdldERlZmF1bHRFbGVtZW50TWFwcGluZyh0cnVlKSwg\nc20sCiAgICAgICAgICAgICAgICBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwg\ndHJ1ZSwgZmFsc2UpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBmaW5h\nbCBDbGFzc01hcHBpbmdbXSBlbGVtcyA9IGdldEluZGVwZW5kZW50RWxlbWVu\ndE1hcHBpbmdzKHRydWUpOwogICAgICAgICAgICBVbmlvbiB1bmlvbiA9IChV\nbmlvbikgc2VsOwogICAgICAgICAgICBpZiAoZmV0Y2guZ2V0U3ViY2xhc3NG\nZXRjaE1vZGUoZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS4KICAgICAgICAg\nICAgICAgIGdldFR5cGVNYXBwaW5nKCkpICE9IGZldGNoLkVBR0VSX0pPSU4p\nCiAgICAgICAgICAgICAgICB1bmlvbi5hYm9ydFVuaW9uKCk7CiAgICAgICAg\nICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50\nIGlkeCkgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdEVhZ2VyKHNlbCwg\nZWxlbXNbaWR4XSwgc20sIHN0b3JlLCBmZXRjaCwgZWFnZXJNb2RlLCAKICAg\nICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2VsZWN0RWFnZXJKb2luKFNlbGVjdCBzZWwsIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlKSB7\nCiAgICAgICAgLy8gd2UgbGltaXQgZnVydGhlciBlYWdlciBmZXRjaGVzIHRv\nIGpvaW5zLCBiZWNhdXNlIGFmdGVyIHRoaXMgcG9pbnQKICAgICAgICAvLyB0\naGUgc2VsZWN0IGhhcyBiZWVuIG1vZGlmaWVkIHN1Y2ggdGhhdCBwYXJhbGxl\nbCBjbG9uZXMgbWF5IHByb2R1Y2UKICAgICAgICAvLyBpbnZhbGlkIHNxbAog\nICAgICAgIHNlbGVjdEVhZ2VyKHNlbCwgZ2V0RGVmYXVsdEVsZW1lbnRNYXBw\naW5nKHRydWUpLCBzbSwgc3RvcmUsIGZldGNoLCAKICAgICAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOLCBmYWxzZSwKICAgICAg\nICAgICAgZmllbGQuZ2V0TnVsbFZhbHVlKCkKICAgICAgICAgICAgICAgICE9\nIEZpZWxkTWFwcGluZy5OVUxMX0VYQ0VQVElPTik7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNFYWdlclNlbGVjdFRvTWFueSgpIHsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBvdXIg\nZGF0YSBlYWdlcmx5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0\nRWFnZXIoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGVsZW0sCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIGludCBlYWdlck1v\nZGUsIGJvb2xlYW4gc2VsZWN0T2lkLCBib29sZWFuIG91dGVyKSB7CiAgICAg\nICAgLy8gZm9yY2UgZGlzdGluY3QgaWYgdGhlcmUgd2FzIGEgdG8tbWFueSBq\nb2luIHRvIGF2b2lkIGR1cHMsIGJ1dAogICAgICAgIC8vIGlmIHRoaXMgaXMg\nYSBwYXJhbGxlbCBzZWxlY3QgZG9uJ3QgbWFrZSBkaXN0aW5jdCBiYXNlZCBv\nbiB0aGUKICAgICAgICAvLyBlYWdlciBqb2lucyBhbG9uZSBpZiB0aGUgb3Jp\nZ2luYWwgd2Fzbid0IGRpc3RpbmN0CiAgICAgICAgaWYgKGVhZ2VyTW9kZSA9\nPSBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX1BBUkFMTEVMKSB7CiAg\nICAgICAgICAgIGlmIChzZWwuaGFzSm9pbih0cnVlKSkKICAgICAgICAgICAg\nICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoIXNlbC5pc0Rpc3RpbmN0KCkpCiAgICAgICAgICAgICAgICBzZWwuc2V0\nRGlzdGluY3QoZmFsc2UpOyAvLyBzZXQgZXhwbGljaXRseSBzbyByZW1lbWJl\ncmVkCiAgICAgICAgfQoKICAgICAgICAvLyBzZXQgYSB2YXJpYWJsZSBuYW1l\nIHRoYXQgZG9lcyBub3QgY29uZmxpY3Qgd2l0aCBhbnkgaW4gdGhlIHF1ZXJ5\nOwogICAgICAgIC8vIHVzaW5nIGEgdmFyaWFibGUgZ3VhcmFudGVlcyB0aGF0\nIHRoZSBzZWxlY3RlZCBkYXRhIHdpbGwgdXNlIGRpZmZlcmVudAogICAgICAg\nIC8vIGFsaWFzZXMgYW5kIGpvaW5zIHRoYW4gYW55IGV4aXN0aW5nIFdIRVJF\nIGNvbmRpdGlvbnMgb24gdGhpcyBmaWVsZAogICAgICAgIC8vIHRoYXQgbWln\naHQgb3RoZXJ3aXNlIGxpbWl0IHRoZSBlbGVtZW50cyBvZiB0aGUgZmllbGQg\ndGhhdCBtYXRjaAogICAgICAgIGlmIChzZWxlY3RPaWQpCiAgICAgICAgICAg\nIHNlbC5vcmRlckJ5UHJpbWFyeUtleShmaWVsZC5nZXREZWZpbmluZ01hcHBp\nbmcoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwu\nbmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgIGpvaW5zID0g\nam9pbihqb2lucywgZWxlbSk7CgogICAgICAgIC8vIG9yZGVyLCByZWYgY29s\ncwogICAgICAgIGlmIChmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwg\nfHwgZmllbGQuZ2V0T3JkZXJzKCkubGVuZ3RoID4gMAogICAgICAgICAgICB8\nfCAhc2VsZWN0T2lkKSB7CiAgICAgICAgICAgIGlmIChvdXRlcikKICAgICAg\nICAgICAgICAgIGpvaW5zID0gc2VsLm91dGVyKGpvaW5zKTsKICAgICAgICAg\nICAgaWYgKCFzZWxlY3RPaWQpIHsKICAgICAgICAgICAgICAgIENvbHVtbltd\nIHJlZnMgPSBnZXRKb2luRm9yZWlnbktleShlbGVtKS5nZXRDb2x1bW5zKCk7\nCiAgICAgICAgICAgICAgICBzZWwub3JkZXJCeShyZWZzLCB0cnVlLCBqb2lu\ncywgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmllbGQub3Jk\nZXJMb2NhbChzZWwsIGVsZW0sIGpvaW5zKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHNlbGVjdCBkYXRhCiAgICAgICAgam9pbnMgPSBqb2luRWxlbWVudFJl\nbGF0aW9uKGpvaW5zLCBlbGVtKTsKICAgICAgICBpZiAob3V0ZXIpCiAgICAg\nICAgICAgIGpvaW5zID0gc2VsLm91dGVyKGpvaW5zKTsKICAgICAgICBmaWVs\nZC5vcmRlclJlbGF0aW9uKHNlbCwgZWxlbSwgam9pbnMpOwogICAgICAgIHNl\nbGVjdEVsZW1lbnQoc2VsLCBlbGVtLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9k\nZSwgam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbG9hZEVhZ2Vy\nUGFyYWxsZWwoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0\nb3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9i\namVjdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gcHJvY2VzcyBiYXRjaGVkIHJlc3VsdHMgaWYgd2UgaGF2ZW4ndCBh\nbHJlYWR5CiAgICAgICAgTWFwIHJlbHM7CiAgICAgICAgaWYgKHJlcyBpbnN0\nYW5jZW9mIFJlc3VsdCkKICAgICAgICAgICAgcmVscyA9IHByb2Nlc3NFYWdl\nclBhcmFsbGVsUmVzdWx0KHNtLCBzdG9yZSwgZmV0Y2gsIChSZXN1bHQpIHJl\ncyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZWxzID0gKE1hcCkgcmVz\nOwoKICAgICAgICAvLyBsb29rIHVwIHRoZSBjb2xsZWN0aW9uIGZvciB0aGlz\nIG9pZCwgYW5kIHN0b3JlIGluIGluc3RhbmNlCiAgICAgICAgT2JqZWN0IGNv\nbGwgPSByZWxzLnJlbW92ZShzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBp\nZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAg\nICAgICAgICAgIHNtLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIEph\ndmFUeXBlcy50b0FycmF5CiAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb24p\nIGNvbGwsIGZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlKCkpKTsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgaWYgKGNvbGwgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvbGwgPSBzbS5uZXdQcm94eShmaWVsZC5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgo\nKSwgY29sbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWxzOwogICAg\nfQoKICAgIC8qKgogICAgICogUHJvY2VzcyB0aGUgZ2l2ZW4gYmF0Y2hlZCBy\nZXN1bHQuCiAgICAgKi8KICAgIHByaXZhdGUgTWFwIHByb2Nlc3NFYWdlclBh\ncmFsbGVsUmVzdWx0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGRvIHNhbWUgam9pbnMgYXMgZm9yIGxvYWQKICAgICAgICAv\nLyMjIyBjaGVhdDogd2Uga25vdyB0eXBpY2FsIHJlc3VsdCBqb2lucyBvbmx5\nIGNhcmUgYWJvdXQgdGhlIHJlbGF0aW9uCiAgICAgICAgLy8jIyMgcGF0aDsg\ndGh1cyB3ZSBjYW4gaWdub3JlIGRpZmZlcmVudCBtYXBwaW5ncwogICAgICAg\nIENsYXNzTWFwcGluZyBlbGVtID0gZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5n\nKHRydWUpOwogICAgICAgIEpvaW5zIGRhdGFKb2lucyA9IHJlcy5uZXdKb2lu\ncygpLnNldFZhcmlhYmxlKCIqIik7CiAgICAgICAgZGF0YUpvaW5zID0gam9p\nbihkYXRhSm9pbnMsIGVsZW0pOwogICAgICAgIGRhdGFKb2lucyA9IGpvaW5F\nbGVtZW50UmVsYXRpb24oZGF0YUpvaW5zLCBlbGVtKTsKICAgICAgICBKb2lu\ncyBvcmRlckpvaW5zID0gbnVsbDsKICAgICAgICBpZiAoZmllbGQuZ2V0T3Jk\nZXJDb2x1bW4oKSAhPSBudWxsKSB7CiAgICAgICAgICAgIG9yZGVySm9pbnMg\nPSByZXMubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgICAg\nICBvcmRlckpvaW5zID0gam9pbihvcmRlckpvaW5zLCBlbGVtKTsKICAgICAg\nICB9CgogICAgICAgIE1hcCByZWxzID0gbmV3IEhhc2hNYXAoKTsKICAgICAg\nICBDbGFzc01hcHBpbmcgb3duZXJNYXBwaW5nID0gZmllbGQuZ2V0RGVmaW5p\nbmdNYXBwaW5nKCk7CiAgICAgICAgT2JqZWN0IG5leHRPaWQsIG9pZCA9IG51\nbGw7CiAgICAgICAgT2JqZWN0IGNvbGwgPSBudWxsOwogICAgICAgIGludCBz\nZXEgPSAwOwogICAgICAgIHdoaWxlIChyZXMubmV4dCgpKSB7CiAgICAgICAg\nICAgIC8vIGV4dHJhY3QgdGhlIG93bmVyIGlkIHZhbHVlCiAgICAgICAgICAg\nIG5leHRPaWQgPSBnZXROZXh0T2JqZWN0SWQob3duZXJNYXBwaW5nLCBzdG9y\nZSwgcmVzLCBvaWQpOwogICAgICAgICAgICBpZiAobmV4dE9pZCAhPSBvaWQp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBvbGQgY29sbCB3YXMgYW4g\nb3JkZXJlZCB0cmFja2luZyBwcm94eSwgc2V0CiAgICAgICAgICAgICAgICAv\nLyBpdHMgc2VxIHZhbHVlIHRvIHRoZSBsYXN0IG9yZGVyIHZhbCB3ZSByZWFk\nCiAgICAgICAgICAgICAgICBpZiAoc2VxICE9IDAgJiYgY29sbCBpbnN0YW5j\nZW9mIFByb3h5KQogICAgICAgICAgICAgICAgICAgICgoUHJveHkpIGNvbGwp\nLmdldENoYW5nZVRyYWNrZXIoKS5zZXROZXh0U2VxdWVuY2Uoc2VxKTsKCiAg\nICAgICAgICAgICAgICAvLyBzdGFydCBhIG5ldyBjb2xsZWN0aW9uCiAgICAg\nICAgICAgICAgICBvaWQgPSBuZXh0T2lkOwogICAgICAgICAgICAgICAgc2Vx\nID0gMDsKICAgICAgICAgICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgp\nID09IEphdmFUeXBlcy5BUlJBWSkKICAgICAgICAgICAgICAgICAgICBjb2xs\nID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIGNvbGwgPSBzbS5uZXdQcm94eShmaWVsZC5nZXRJ\nbmRleCgpKTsKICAgICAgICAgICAgICAgIHJlbHMucHV0KG9pZCwgY29sbCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRPcmRl\nckNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXEgPSByZXMu\nZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29sdW1uKCksIG9yZGVySm9pbnMpICsg\nMTsKICAgICAgICAgICAgYWRkKHN0b3JlLCBjb2xsLCBsb2FkRWxlbWVudChu\ndWxsLCBzdG9yZSwgZmV0Y2gsIHJlcywgZGF0YUpvaW5zKSk7CiAgICAgICAg\nfQogICAgICAgIHJlcy5jbG9zZSgpOwoKICAgICAgICByZXR1cm4gcmVsczsK\nICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgdGhlIG9pZCB2YWx1ZSBm\ncm9tIHRoZSBnaXZlbiByZXN1bHQuIElmIHRoZSBuZXh0IG9pZCBpcyB0aGUK\nICAgICAqIHNhbWUgYXMgdGhlIGdpdmVuIG9uZSwgcmV0dXJucyB0aGUgZ2l2\nZW4gSlZNIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBn\nZXROZXh0T2JqZWN0SWQoQ2xhc3NNYXBwaW5nIG93bmVyLCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgUmVzdWx0IHJlcywgT2JqZWN0IG9pZCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiB0aGlzIGlz\nIGEgZGF0YXN0b3JlIGlkIGNsYXNzIHdlIGNhbiBhdm9pZCBjcmVhdGluZyBh\nIG5ldyBvaWQKICAgICAgICAvLyBvYmplY3QgZm9yIHRoZSBjb21tb24gY2Fz\nZQogICAgICAgIGlmIChvaWQgIT0gbnVsbCAmJiBvd25lci5nZXRJZGVudGl0\neVR5cGUoKSA9PSBDbGFzc01hcHBpbmcuSURfREFUQVNUT1JFCiAgICAgICAg\nICAgICYmIG93bmVyLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKSB7CiAg\nICAgICAgICAgIGxvbmcgbmlkID0gcmVzLmdldExvbmcob3duZXIuZ2V0UHJp\nbWFyeUtleUNvbHVtbnMoKVswXSk7CiAgICAgICAgICAgIGxvbmcgaWQgPSAo\nKElkKSBvaWQpLmdldElkKCk7CiAgICAgICAgICAgIHJldHVybiAobmlkID09\nIGlkKSA/IG9pZCA6IHN0b3JlLm5ld0RhdGFTdG9yZUlkKG5pZCwgb3duZXIs\nIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG5vaWQgPSBvd25l\nci5nZXRPYmplY3RJZChzdG9yZSwgcmVzLCBudWxsLCB0cnVlLCBudWxsKTsK\nICAgICAgICBpZiAobm9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICByZXR1cm4gKG5vaWQuZXF1YWxzKG9pZCkpID8gb2lk\nIDogbm9pZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkRWFnZXJKb2lu\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBSZXN1bHQgcmVz\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGlu\naXRpYWxpemUgZmllbGQgdmFsdWUKICAgICAgICBPYmplY3QgY29sbDsKICAg\nICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJS\nQVkpCiAgICAgICAgICAgIGNvbGwgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBjb2xsID0gc20ubmV3UHJveHkoZmllbGQu\nZ2V0SW5kZXgoKSk7CgogICAgICAgIEpvaW5zIGRhdGFKb2lucyA9IG51bGw7\nCiAgICAgICAgSm9pbnMgcmVmSm9pbnMgPSByZXMubmV3Sm9pbnMoKS5zZXRW\nYXJpYWJsZSgiKiIpOwogICAgICAgIGpvaW4ocmVmSm9pbnMsIGZhbHNlKTsK\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIG93bmVyTWFwcGluZyA9IGZpZWxkLmdl\ndERlZmluaW5nTWFwcGluZygpOwogICAgICAgIE9iamVjdCByZWYgPSBudWxs\nOwogICAgICAgIGludCBzZXEgPSAwOwogICAgICAgIGludCB0eXBlSWR4ID0g\ncmVzLmluZGV4T2YoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgdHJ1ZTsg\naSsrKSB7CiAgICAgICAgICAgIC8vIGV4dHJhY3QgdGhlIG93bmVyIGlkIHZh\nbHVlCiAgICAgICAgICAgIHJlZiA9IGdldE5leHRSZWYob3duZXJNYXBwaW5n\nLCBzdG9yZSwgcmVzLCByZWYsIHJlZkpvaW5zKTsKICAgICAgICAgICAgaWYg\nKHJlZiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgb2xk\nIGNvbGwgd2FzIGFuIG9yZGVyZWQgdHJhY2tpbmcgcHJveHksIHNldAogICAg\nICAgICAgICAgICAgLy8gaXRzIHNlcSB2YWx1ZSB0byB0aGUgbGFzdCBvcmRl\nciB2YWwgd2UgcmVhZAogICAgICAgICAgICAgICAgaWYgKHNlcSAhPSAwICYm\nIGNvbGwgaW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAgICAgICAgICAo\nKFByb3h5KSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCkuc2V0TmV4dFNlcXVl\nbmNlKHNlcSk7CiAgICAgICAgICAgICAgICBpZiAoaSAhPSAwKQogICAgICAg\nICAgICAgICAgICAgIHJlcy5wdXNoQmFjaygpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRvIHNhbWUg\nam9pbnMgYXMgZm9yIGxvYWQKICAgICAgICAgICAgaWYgKGRhdGFKb2lucyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRhSm9pbnMgPSByZXMubmV3\nSm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwogICAgICAgICAgICAgICAgZGF0\nYUpvaW5zID0gam9pbihkYXRhSm9pbnMsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGRhdGFKb2lucyA9IGpvaW5SZWxhdGlvbihkYXRhSm9pbnMsIGZhbHNl\nLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVs\nZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nZXEgPSByZXMuZ2V0SW50KGZpZWxkLmdldE9yZGVyQ29sdW1uKCksIHJlZkpv\naW5zKSArIDE7CiAgICAgICAgICAgIHJlcy5zZXRCYXNlTWFwcGluZyhudWxs\nKTsKICAgICAgICAgICAgYWRkKHN0b3JlLCBjb2xsLCBsb2FkRWxlbWVudChz\nbSwgc3RvcmUsIGZldGNoLCByZXMsIGRhdGFKb2lucykpOwogICAgICAgICAg\nICBpZiAoIXJlcy5uZXh0KCkgfHwgcmVzLmluZGV4T2YoKSAhPSB0eXBlSWR4\nKSB7CiAgICAgICAgICAgICAgICByZXMucHVzaEJhY2soKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBsb2FkIHRoZSBjb2xsZWN0aW9uIGludG8gdGhlIG9iamVjdAogICAg\nICAgIGlmIChmaWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJB\nWSkKICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgo\nKSwgSmF2YVR5cGVzLnRvQXJyYXkKICAgICAgICAgICAgICAgICgoQ29sbGVj\ndGlvbikgY29sbCwgZmllbGQuZ2V0RWxlbWVudCgpLmdldFR5cGUoKSkpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQu\nZ2V0SW5kZXgoKSwgY29sbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHRy\nYWN0IHRoZSByZWZlcmVuY2UgY29sdW1uIHZhbHVlKHMpIGZyb20gdGhlIGdp\ndmVuIHJlc3VsdC4gSWYgdGhlCiAgICAgKiBleHRyYWN0ZWQgcmVzdWx0IGlz\nIHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IG9uZSBvciB0aGUgY3VycmVudAog\nICAgICogb25lIGlzIG51bGwsIHJldHVybnMgdGhlIGV4dHJhY3RlZCByZXN1\nbHQuIEVsc2UgcmV0dXJucyBudWxsLgogICAgICovCiAgICBwcml2YXRlIE9i\namVjdCBnZXROZXh0UmVmKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDU3Rv\ncmUgc3RvcmUsCiAgICAgICAgUmVzdWx0IHJlcywgT2JqZWN0IHJlZiwgSm9p\nbnMgcmVmSm9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ29sdW1uW10gY29scyA9IGdldEpvaW5Gb3JlaWduS2V5KGdldERl\nZmF1bHRFbGVtZW50TWFwcGluZyhmYWxzZSkpLgogICAgICAgICAgICBnZXRD\nb2x1bW5zKCk7CiAgICAgICAgT2JqZWN0IHZhbDsKICAgICAgICBpZiAoY29s\ncy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICB2YWwgPSByZXMuZ2V0T2Jq\nZWN0KGNvbHNbMF0sIG51bGwsIHJlZkpvaW5zKTsKICAgICAgICAgICAgaWYg\nKHZhbCA9PSBudWxsIHx8IChyZWYgIT0gbnVsbCAmJiAhdmFsLmVxdWFscyhy\nZWYpKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICByZXR1cm4gdmFsOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0W10gcmVm\ncyA9IChPYmplY3RbXSkgcmVmOwogICAgICAgIGlmIChyZWZzID09IG51bGwp\nCiAgICAgICAgICAgIHJlZnMgPSBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgdmFsID0gcmVzLmdldE9iamVjdChjb2xzW2ldLCBu\ndWxsLCByZWZKb2lucyk7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAo\ncmVmc1tpXSAhPSBudWxsICYmICF2YWwuZXF1YWxzKHJlZnNbaV0pKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJlZnNbaV0g\nPSB2YWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWZzOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGxvYWQoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgZmluYWwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIGZpbmFsIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmlzTFJTKCkpIHsKICAg\nICAgICAgICAgUHJveHkgY29sbCA9IG5ld0xSU1Byb3h5KHN0b3JlLmdldENv\nbmZpZ3VyYXRpb24oKSk7CgogICAgICAgICAgICAvLyBpZiB0aGlzIGlzIG9y\nZGVyZWQgd2UgbmVlZCB0byBrbm93IHRoZSBuZXh0IHNlcSB0byB1c2UgaW4g\nY2FzZQogICAgICAgICAgICAvLyBvYmplY3RzIGFyZSBhZGRlZCB0byB0aGUg\nY29sbGVjdGlvbgogICAgICAgICAgICBpZiAoZmllbGQuZ2V0T3JkZXJDb2x1\nbW4oKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBkb24ndCBh\nbGxvdyBvcmRlcmluZyB0YWJsZSBwZXIgY2xhc3Mgb25lLW1hbnkncywgc28K\nICAgICAgICAgICAgICAgIC8vIHdlIGtub3cgd2UgZG9uJ3QgbmVlZCBhIHVu\naW9uCiAgICAgICAgICAgICAgICBTZWxlY3Qgc2VsID0gc3RvcmUuZ2V0U1FM\nRmFjdG9yeSgpLm5ld1NlbGVjdCgpOwogICAgICAgICAgICAgICAgc2VsLnNl\ndEFnZ3JlZ2F0ZSh0cnVlKTsKICAgICAgICAgICAgICAgIFN0cmluZ0J1ZmZl\nciBzcWwgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgICAgICAgICBz\ncWwuYXBwZW5kKCJNQVgoIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5k\nKHNlbC5nZXRDb2x1bW5BbGlhcyhmaWVsZC5nZXRPcmRlckNvbHVtbigpKSku\nCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCIpIik7CiAgICAgICAgICAg\nICAgICBzZWwuc2VsZWN0KHNxbC50b1N0cmluZygpLCBmaWVsZCk7CiAgICAg\nICAgICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gZ2V0RGVmYXVsdEVsZW1l\nbnRNYXBwaW5nKGZhbHNlKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZUZv\ncmVpZ25LZXkoZ2V0Sm9pbkZvcmVpZ25LZXkocmVsKSwKICAgICAgICAgICAg\nICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBmaWVsZC5nZXREZWZpbmluZ01h\ncHBpbmcoKSwgc3RvcmUpOwoKICAgICAgICAgICAgICAgIFJlc3VsdCByZXMg\nPSBzZWwuZXhlY3V0ZShzdG9yZSwgZmV0Y2gpOwogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXMubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIGNvbGwuZ2V0Q2hhbmdlVHJhY2tlcigpLnNldE5leHRT\nZXF1ZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAocmVzLmdldEludChm\naWVsZCkgKyAxKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc20uc3RvcmVPYmplY3RGaWVs\nZChmaWVsZC5nZXRJbmRleCgpLCBjb2xsKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgLy8gc2VsZWN0IGRhdGEgZm9yIHRoaXMg\nc20KICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSBlbGVtcyA9IGdldElu\nZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRydWUpOwogICAgICAgIGZpbmFs\nIEpvaW5zW10gcmVzSm9pbnMgPSBuZXcgSm9pbnNbTWF0aC5tYXgoMSwgZWxl\nbXMubGVuZ3RoKV07CiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRT\nUUxGYWN0b3J5KCkubmV3VW5pb24KICAgICAgICAgICAgKE1hdGgubWF4KDEs\nIGVsZW1zLmxlbmd0aCkpOwogICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5p\nb24uU2VsZWN0b3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICBDbGFz\nc01hcHBpbmcgZWxlbSA9IChlbGVtcy5sZW5ndGggPT0gMCkgPyBudWxsIDog\nZWxlbXNbaWR4XTsKICAgICAgICAgICAgICAgIHJlc0pvaW5zW2lkeF0gPSBz\nZWxlY3RBbGwoc2VsLCBlbGVtLCBzbSwgc3RvcmUsIGZldGNoLAogICAgICAg\nICAgICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfUEFS\nQUxMRUwpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8v\nIGNyZWF0ZSBwcm94eQogICAgICAgIE9iamVjdCBjb2xsOwogICAgICAgIENo\nYW5nZVRyYWNrZXIgY3QgPSBudWxsOwogICAgICAgIGlmIChmaWVsZC5nZXRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAgICAgICAgICAgY29s\nbCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgY29sbCA9IHNtLm5ld1Byb3h5KGZpZWxkLmdldEluZGV4KCkpOwogICAg\nICAgICAgICBpZiAoY29sbCBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAg\nICAgICAgY3QgPSAoKFByb3h5KSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBsb2FkIHZhbHVlcwogICAgICAgIFJl\nc3VsdCByZXMgPSB1bmlvbi5leGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaW50IHNlcSA9IDA7CiAgICAgICAgICAg\nIHdoaWxlIChyZXMubmV4dCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoY3Qg\nIT0gbnVsbCAmJiBmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgc2VxID0gcmVzLmdldEludChmaWVsZC5nZXRP\ncmRlckNvbHVtbigpKTsKICAgICAgICAgICAgICAgIGFkZChzdG9yZSwgY29s\nbCwgbG9hZEVsZW1lbnQoc20sIHN0b3JlLCBmZXRjaCwgcmVzLAogICAgICAg\nICAgICAgICAgICAgIHJlc0pvaW5zW3Jlcy5pbmRleE9mKCldKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKGN0ICE9IG51bGwgJiYgZmllbGQu\nZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAgICAgICAgICAgICAgY3Qu\nc2V0TmV4dFNlcXVlbmNlKHNlcSArIDEpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gc2V0IGludG8gc20KICAgICAgICBpZiAoZmllbGQuZ2V0VHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAgICAgICAgICAgIHNtLnN0b3JlT2Jq\nZWN0KGZpZWxkLmdldEluZGV4KCksIEphdmFUeXBlcy50b0FycmF5CiAgICAg\nICAgICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwsIGZpZWxkLmdldEVsZW1l\nbnQoKS5nZXRUeXBlKCkpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNt\nLnN0b3JlT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIGNvbGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2VsZWN0IGRhdGEgZm9yIGxvYWRpbmcsIHN0YXJ0\naW5nIGluIGZpZWxkIHRhYmxlLgogICAgICovCiAgICBwcm90ZWN0ZWQgSm9p\nbnMgc2VsZWN0QWxsKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBlbGVtLAog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9y\nZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQg\nZWFnZXJNb2RlKSB7CiAgICAgICAgc2VsLndoZXJlRm9yZWlnbktleShnZXRK\nb2luRm9yZWlnbktleShlbGVtKSwgc20uZ2V0T2JqZWN0SWQoKSwKICAgICAg\nICAgICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCksIHN0b3JlKTsKCiAg\nICAgICAgLy8gb3JkZXIgZmlyc3QsIHRoZW4gc2VsZWN0IHNvIHRoYXQgaWYg\ndGhlIHByb2plY3Rpb24gaW50cm9kdWNlcwogICAgICAgIC8vIGFkZGl0aW9u\nYWwgb3JkZXJpbmcsIGl0IHdpbGwgYmUgYWZ0ZXIgb3VyIHJlcXVpcmVkIG9y\nZGVyaW5nCiAgICAgICAgZmllbGQub3JkZXJMb2NhbChzZWwsIGVsZW0sIG51\nbGwpOwogICAgICAgIEpvaW5zIGpvaW5zID0gam9pbkVsZW1lbnRSZWxhdGlv\nbihzZWwubmV3Sm9pbnMoKSwgZWxlbSk7CiAgICAgICAgZmllbGQub3JkZXJS\nZWxhdGlvbihzZWwsIGVsZW0sIGpvaW5zKTsKICAgICAgICBzZWxlY3RFbGVt\nZW50KHNlbCwgZWxlbSwgc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5z\nKTsKICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBsb2FkUHJvamVjdGlvbihKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgUmVzdWx0IHJlcywgSm9p\nbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIGxvYWRFbGVtZW50KG51bGwsIHN0b3JlLCBmZXRjaCwgcmVz\nLCBqb2lucyk7CiAgICB9CgogICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgZ2V0\nSm9pbkZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJuIGdldEpvaW5Gb3Jl\naWduS2V5KGdldERlZmF1bHRFbGVtZW50TWFwcGluZyhmYWxzZSkpOwogICAg\nfQp9Cg==\n","encoding":"base64"}

