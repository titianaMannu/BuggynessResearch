{"sha":"c8c2eaa2c9877ef61715ce0149d0864cecdfa6cd","node_id":"MDQ6QmxvYjIwNjM2NDpjOGMyZWFhMmM5ODc3ZWY2MTcxNWNlMDE0OWQwODY0Y2VjZGZhNmNk","size":4804,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c8c2eaa2c9877ef61715ce0149d0864cecdfa6cd","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzOwoKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0Owpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0\nOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuRGlzY3JpbWluYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwoKLyoq\nCiAqIE1hcHMgbWV0YWRhdGEtZ2l2ZW4gdmFsdWVzIHRvIGNsYXNzZXMuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgVmFsdWVN\nYXBEaXNjcmltaW5hdG9yU3RyYXRlZ3kKICAgIGV4dGVuZHMgSW5WYWx1ZURp\nc2NyaW1pbmF0b3JTdHJhdGVneSB7CgogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgQUxJQVMgPSAidmFsdWUtbWFwIjsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKFZhbHVlTWFwRGlzY3JpbWluYXRvclN0cmF0ZWd5LmNs\nYXNzKTsKCiAgICBwcml2YXRlIE1hcCBfdmFscyA9IG51bGw7CgogICAgcHVi\nbGljIFN0cmluZyBnZXRBbGlhcygpIHsKICAgICAgICByZXR1cm4gQUxJQVM7\nCiAgICB9CgogICAgcHJvdGVjdGVkIGludCBnZXRKYXZhVHlwZSgpIHsKICAg\nICAgICBPYmplY3QgdmFsID0gZGlzYy5nZXRWYWx1ZSgpOwogICAgICAgIGlm\nICh2YWwgIT0gbnVsbCAmJiB2YWwgIT0gRGlzY3JpbWluYXRvci5OVUxMKQog\nICAgICAgICAgICByZXR1cm4gSmF2YVR5cGVzLmdldFR5cGVDb2RlKHZhbC5n\nZXRDbGFzcygpKTsKCiAgICAgICAgLy8gaWYgdGhlIHVzZXIgd2FudHMgdGhl\nIHR5cGUgdG8gYmUgbnVsbCwgd2UgbmVlZCBhIGpkYmMtdHlwZQogICAgICAg\nIC8vIG9uIHRoZSBjb2x1bW4gb3IgYW4gZXhpc3RpbmcgY29sdW1uIHRvIGZp\nZ3VyZSBvdXQgdGhlIGphdmEgdHlwZQogICAgICAgIERpc2NyaW1pbmF0b3JN\nYXBwaW5nSW5mbyBpbmZvID0gZGlzYy5nZXRNYXBwaW5nSW5mbygpOwogICAg\nICAgIExpc3QgY29scyA9IGluZm8uZ2V0Q29sdW1ucygpOwogICAgICAgIENv\nbHVtbiBjb2wgPSAoY29scy5pc0VtcHR5KCkpID8gbnVsbCA6IChDb2x1bW4p\nIGNvbHMuZ2V0KDApOwogICAgICAgIGlmIChjb2wgIT0gbnVsbCkgewogICAg\nICAgICAgICBpZiAoY29sLmdldEphdmFUeXBlKCkgIT0gSmF2YVR5cGVzLk9C\nSkVDVCkKICAgICAgICAgICAgICAgIHJldHVybiBjb2wuZ2V0SmF2YVR5cGUo\nKTsKICAgICAgICAgICAgaWYgKGNvbC5nZXRUeXBlKCkgIT0gVHlwZXMuT1RI\nRVIpCiAgICAgICAgICAgICAgICByZXR1cm4gSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKFNjaGVtYXMuZ2V0SmF2YVR5cGUKICAgICAgICAgICAgICAgICAgICAo\nY29sLmdldFR5cGUoKSwgY29sLmdldFNpemUoKSwgY29sLmdldERlY2ltYWxE\naWdpdHMoKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gSmF2YVR5cGVz\nLlNUUklORzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGdldERpc2Ny\naW1pbmF0b3JWYWx1ZShDbGFzc01hcHBpbmcgY2xzKSB7CiAgICAgICAgT2Jq\nZWN0IHZhbCA9IGNscy5nZXREaXNjcmltaW5hdG9yKCkuZ2V0VmFsdWUoKTsK\nICAgICAgICByZXR1cm4gKHZhbCA9PSBEaXNjcmltaW5hdG9yLk5VTEwpID8g\nbnVsbCA6IHZhbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3MgZ2V0Q2xh\nc3MoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93\ncyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3ZhbHMg\nPT0gbnVsbCkgewogICAgICAgICAgICBDbGFzc01hcHBpbmcgY2xzID0gZGlz\nYy5nZXRDbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5n\nW10gc3VicyA9IGNscy5nZXRKb2luYWJsZVBDU3ViY2xhc3NNYXBwaW5ncygp\nOwogICAgICAgICAgICBNYXAgbWFwID0gbmV3IEhhc2hNYXAoKGludCkgKChz\ndWJzLmxlbmd0aCArIDEpICogMS4zMyArIDEpKTsKICAgICAgICAgICAgbWFw\nRGlzY3JpbWluYXRvclZhbHVlKGNscywgbWFwKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzdWJzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgbWFwRGlzY3JpbWluYXRvclZhbHVlKHN1YnNbaV0sIG1hcCk7CiAg\nICAgICAgICAgIF92YWxzID0gbWFwOwogICAgICAgIH0KCiAgICAgICAgU3Ry\naW5nIHN0ciA9ICh2YWwgPT0gbnVsbCkgPyBudWxsIDogdmFsLnRvU3RyaW5n\nKCk7CiAgICAgICAgQ2xhc3MgY2xzID0gKENsYXNzKSBfdmFscy5nZXQoc3Ry\nKTsKICAgICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBjbHM7CiAgICAgICAgdGhyb3cgbmV3IENsYXNzTm90Rm91bmRFeGNlcHRp\nb24oX2xvYy5nZXQoInVua25vd24tZGlzY3JpbS12YWx1ZSIsCiAgICAgICAg\nICAgIG5ldyBPYmplY3RbXXsgc3RyLCBkaXNjLmdldENsYXNzTWFwcGluZygp\nLmdldERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TmFtZSgpLCBu\nZXcgVHJlZVNldChfdmFscy5rZXlTZXQoKSkgfSkuZ2V0TWVzc2FnZSgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1hcCB0aGUgc3RyaW5naWZpZWQgdmVy\nc2lvbiBvZiB0aGUgZGlzY3JpbWluYXRvciB2YWx1ZSBvZiB0aGUgZ2l2ZW4g\ndHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBtYXBEaXNj\ncmltaW5hdG9yVmFsdWUoQ2xhc3NNYXBwaW5nIGNscywgTWFwIG1hcCkgewog\nICAgICAgIC8vIHBvc3NpYmxlIHRoYXQgc29tZSB0eXBlcyB3aWxsIG5ldmVy\nIGJlIHBlcnNpc3RlZCBhbmQgdGhlcmVmb3JlCiAgICAgICAgLy8gY2FuIGhh\ndmUgbm8gZGlzY3JpbWluYXRvciB2YWx1ZQogICAgICAgIE9iamVjdCB2YWwg\nPSBjbHMuZ2V0RGlzY3JpbWluYXRvcigpLmdldFZhbHVlKCk7CiAgICAgICAg\naWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIFN0cmluZyBzdHIgPSAodmFsID09IERpc2NyaW1pbmF0b3IuTlVMTCkgPyBu\ndWxsIDogdmFsLnRvU3RyaW5nKCk7CiAgICAgICAgQ2xhc3MgZXhpc3QgPSAo\nQ2xhc3MpIG1hcC5nZXQoc3RyKTsKICAgICAgICBpZiAoZXhpc3QgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJkdXAtZGlzY3JpbS12YWx1ZSIsCiAgICAgICAgICAgICAgICBz\ndHIsIGV4aXN0LCBjbHMpKTsKICAgICAgICBtYXAucHV0KHN0ciwgY2xzLmdl\ndERlc2NyaWJlZFR5cGUoKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbWFw\nKGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBPYmplY3QgdmFsID0gZGlzYy5n\nZXRNYXBwaW5nSW5mbygpLmdldFZhbHVlKGRpc2MsIGFkYXB0KTsKICAgICAg\nICBpZiAodmFsID09IG51bGwgJiYgIU1vZGlmaWVyLmlzQWJzdHJhY3QoZGlz\nYy5nZXRDbGFzc01hcHBpbmcoKS4KICAgICAgICAgICAgZ2V0RGVzY3JpYmVk\nVHlwZSgpLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1kaXNjcmltLXZhbHVl\nIiwKICAgICAgICAgICAgICAgIGRpc2MuZ2V0Q2xhc3NNYXBwaW5nKCkpKTsK\nCiAgICAgICAgLy8gd2Ugc2V0IHRoZSB2YWx1ZSBiZWZvcmUgbWFwcGluZyB0\nbyB1c2UgdG8gY2FsY3VsYXRlIHRoZSB0ZW1wbGF0ZQogICAgICAgIC8vIGNv\nbHVtbidzIGphdmEgdHlwZQogICAgICAgIGRpc2Muc2V0VmFsdWUodmFsKTsK\nICAgICAgICBzdXBlci5tYXAoYWRhcHQpOwogICAgfQp9Cg==\n","encoding":"base64"}

