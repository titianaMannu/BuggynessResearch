{"sha":"4a48c5fcc12daf38e7d03bef41c02cbae9428fec","node_id":"MDQ6QmxvYjIwNjM2NDo0YTQ4YzVmY2MxMmRhZjM4ZTdkMDNiZWY0MWMwMmNiYWU5NDI4ZmVj","size":51384,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4a48c5fcc12daf38e7d03bef41c02cbae9428fec","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYTsKCmltcG9ydCBqYXZhLmlvLkZpbGU7Cmlt\ncG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5Qcmlu\ndFdyaXRlcjsKaW1wb3J0IGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5z\ncWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURh\ndGE7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZh\nLnNxbC5TdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFz\naFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEu\ndXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0\nIGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29uZmlndXJh\ndGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogVGhlIFNjaGVtYVRv\nb2wgaXMgdXNlZCB0byBtYW5hZ2UgdGhlIGRhdGFiYXNlIHNjaGVtYS4gTm90\nZSB0aGF0IHRoZQogKiB0b29sIG5ldmVyIGFkZHMgb3IgZHJvcHMgdW5pcXVl\nIGNvbnN0cmFpbnRzIGZyb20gZXhpc3RpbmcgdGFibGVzLCBiZWNhdXNlCiAq\nIEpEQkMge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9IGRvZXMgbm90IGluY2x1\nZGUgaW5mb3JtYXRpb24gb24gdGhlc2UKICogY29uc3RyYWludHMuCiAqCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5\nCiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hVG9vbCB7CgogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0FERCA9ICJhZGQiOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0RST1AgPSAiZHJvcCI7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fUkVUQUlO\nID0gInJldGFpbiI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBB\nQ1RJT05fUkVGUkVTSCA9ICJyZWZyZXNoIjsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgU3RyaW5nIEFDVElPTl9CVUlMRCA9ICJidWlsZCI7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fUkVGTEVDVCA9ICJyZWZs\nZWN0IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9D\nUkVBVEVEQiA9ICJjcmVhdGVEQiI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIFN0cmluZyBBQ1RJT05fRFJPUERCID0gImRyb3BEQiI7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fSU1QT1JUID0gImltcG9ydCI7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fRVhQT1JU\nID0gImV4cG9ydCI7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmdb\nXSBBQ1RJT05TID0gbmV3IFN0cmluZ1tdewogICAgICAgIEFDVElPTl9BREQs\nCiAgICAgICAgQUNUSU9OX0RST1AsCiAgICAgICAgQUNUSU9OX1JFVEFJTiwK\nICAgICAgICBBQ1RJT05fUkVGUkVTSCwKICAgICAgICBBQ1RJT05fQlVJTEQs\nCiAgICAgICAgQUNUSU9OX1JFRkxFQ1QsCiAgICAgICAgQUNUSU9OX0NSRUFU\nRURCLAogICAgICAgIEFDVElPTl9EUk9QREIsCiAgICAgICAgQUNUSU9OX0lN\nUE9SVCwKICAgICAgICBBQ1RJT05fRVhQT1JULAogICAgfTsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5m\nb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYVRvb2wuY2xhc3MpOwoKICAgIHBy\naXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBwcml2\nYXRlIGZpbmFsIERhdGFTb3VyY2UgX2RzOwogICAgcHJpdmF0ZSBmaW5hbCBM\nb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0\nOwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX2FjdGlvbjsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfaWdub3JlRXJycyA9IGZhbHNlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9vcGVuanBhVGFibGVzID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX2Ryb3BUYWJsZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9kcm9wU2VxcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3BrcyA9\nIHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAgICBw\ncml2YXRlIGJvb2xlYW4gX2luZGV4ZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9zZXFzID0gdHJ1ZTsKICAgIHByaXZhdGUgUHJpbnRXcml0ZXIg\nX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9ncm91\ncCA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9kYiA9IG51bGw7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Z1bGxEQiA9IGZhbHNlOwoKICAgIC8q\nKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gVG9vbHMgY29uc3RydWN0\nZWQgdGhpcyB3YXkgd2lsbCBub3QgaGF2ZSBhbgogICAgICogYWN0aW9uLCBz\nbyB0aGUge0BsaW5rICNydW4oKX0gbWV0aG9kIHdpbGwgYmUgYSBuby1vcC4K\nICAgICAqLwogICAgcHVibGljIFNjaGVtYVRvb2woSkRCQ0NvbmZpZ3VyYXRp\nb24gY29uZikgewogICAgICAgIHRoaXMoY29uZiwgbnVsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB0b29sIHRvIHBlcmZvcm0gdGhl\nIGdpdmVuIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRvb2wo\nSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nIGFjdGlvbikgewogICAg\nICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiAhQXJyYXlzLmFzTGlzdChBQ1RJ\nT05TKS5jb250YWlucyhhY3Rpb24pKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJhY3Rpb24gPT0gIiArIGFjdGlv\nbik7CgogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBfYWN0aW9uID0g\nYWN0aW9uOwogICAgICAgIF9kcyA9IGNvbmYuZ2V0RGF0YVNvdXJjZTIobnVs\nbCk7CiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0\naW9uLkxPR19TQ0hFTUEpOwoKICAgICAgICAvLyBpbml0aWFsaXplIHRoaXMg\ndXAtZnJvbnQ7IG90aGVyd2lzZSB0aGUgZGJkaWN0aW9uYXJ5ZmFjdG9yeSBt\naWdodAogICAgICAgIC8vIHRyeSB0byB0YWtlIGEgY29ubmVjdGlvbiB0byBp\nbml0aWFsaXplIHdoZW4gd2UndmUgYWxyZWFkeSBnb3Qgb25lOgogICAgICAg\nIC8vIGJhZCBuZXdzIGlmIHRoZSBtYXggcG9vbCBpcyAxCiAgICAgICAgX2Rp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIGFjdGlvbiBzdXBwbGllZCBvbiBjb25zdHJ1\nY3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0QWN0aW9uKCkg\newogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAgfQoKICAgIC8qKgogICAg\nICogSWYgdHJ1ZSwgU1FMRXhjZXB0aW9ucyB0aHJvd24gZHVyaW5nIHNjaGVt\nYSBtYW5pcHVsYXRpb24gd2lsbCBiZQogICAgICogcHJpbnRlZCBidXQgaWdu\nb3JlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlRXJy\nb3JzKCkgewogICAgICAgIHJldHVybiBfaWdub3JlRXJyczsKICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHRydWUsIFNRTEV4Y2VwdGlvbnMgdGhyb3duIGR1\ncmluZyBzY2hlbWEgbWFuaXB1bGF0aW9uIHdpbGwgYmUKICAgICAqIHByaW50\nZWQgYnV0IGlnbm9yZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEln\nbm9yZUVycm9ycyhib29sZWFuIGlnbm9yZUVycnMpIHsKICAgICAgICBfaWdu\nb3JlRXJycyA9IGlnbm9yZUVycnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIHRvIGFjdCBvbiBzcGVjaWFsIHRhYmxlcyB1c2VkIGJ5IE9wZW5K\nUEEgY29tcG9uZW50cwogICAgICogZm9yIGJvb2trZWVwaW5nLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcGVuSlBBVGFibGVzKCkgewogICAg\nICAgIHJldHVybiBfb3BlbmpwYVRhYmxlczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdG8gYWN0IG9uIHNwZWNpYWwgdGFibGVzIHVzZWQgYnkg\nT3BlbkpQQSBjb21wb25lbnRzCiAgICAgKiBmb3IgYm9va2tlZXBpbmcuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9wZW5KUEFUYWJsZXMoYm9vbGVh\nbiBvcGVuanBhVGFibGVzKSB7CiAgICAgICAgX29wZW5qcGFUYWJsZXMgPSBv\ncGVuanBhVGFibGVzOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdHJ1ZSwg\ndGFibGVzIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNlZCB3aWxsIGJlIGRyb3Bw\nZWQuIERlZmF1bHRzIHRvCiAgICAgKiB0cnVlLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXREcm9wVGFibGVzKCkgewogICAgICAgIHJldHVybiBf\nZHJvcFRhYmxlczsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRydWUsIHRh\nYmxlcyB0aGF0IGFwcGVhciB0byBiZSB1bnVzZWQgd2lsbCBiZSBkcm9wcGVk\nLiBEZWZhdWx0cyB0bwogICAgICogdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RHJvcFRhYmxlcyhib29sZWFuIGRyb3BUYWJsZXMpIHsKICAg\nICAgICBfZHJvcFRhYmxlcyA9IGRyb3BUYWJsZXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJZiB0cnVlLCBzZXF1ZW5jZXMgdGhhdCBhcHBlYXIgdG8gYmUg\ndW51c2VkIHdpbGwgYmUgZHJvcHBlZC4gRGVmYXVsdHMKICAgICAqIHRvIHRy\ndWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldERyb3BTZXF1ZW5j\nZXMoKSB7CiAgICAgICAgcmV0dXJuIF9kcm9wU2VxczsKICAgIH0KCiAgICAv\nKioKICAgICAqIElmIHRydWUsIHNlcXVlbmNlcyB0aGF0IGFwcGVhciB0byBi\nZSB1bnVzZWQgd2lsbCBiZSBkcm9wcGVkLiBEZWZhdWx0cwogICAgICogdG8g\ndHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJvcFNlcXVlbmNl\ncyhib29sZWFuIGRyb3BTZXFzKSB7CiAgICAgICAgX2Ryb3BTZXFzID0gZHJv\ncFNlcXM7CiAgICAgICAgaWYgKGRyb3BTZXFzKQogICAgICAgICAgICBzZXRT\nZXF1ZW5jZXModHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuIERlZmF1bHRzIHRv\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFNlcXVlbmNl\ncygpIHsKICAgICAgICByZXR1cm4gX3NlcXM7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXaGV0aGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQu\nIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9IHNl\ncXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGluZGV4ZXMgb24g\nZXhpc3RpbmcgdGFibGVzIHNob3VsZCBiZSBtYW5pcHVsYXRlZC4KICAgICAq\nIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGdldEluZGV4ZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pbmRleGVzOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbmRleGVzIG9uIGV4aXN0aW5n\nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAgICAgKiBEZWZhdWx0\ncyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRleGVz\nKGJvb2xlYW4gaW5kZXhlcykgewogICAgICAgIF9pbmRleGVzID0gaW5kZXhl\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBrZXlz\nIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAg\nICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBnZXRGb3JlaWduS2V5cygpIHsKICAgICAgICByZXR1cm4gX2ZrczsK\nICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBrZXlzIG9u\nIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAgICAg\nKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRGb3JlaWduS2V5cyhib29sZWFuIGZrcykgewogICAgICAgIF9ma3MgPSBm\na3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkga2V5\ncyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgog\nICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZ2V0UHJpbWFyeUtleXMoKSB7CiAgICAgICAgcmV0dXJuIF9wa3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkga2V5cyBv\nbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgogICAg\nICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0UHJpbWFyeUtleXMoYm9vbGVhbiBwa3MpIHsKICAgICAgICBfcGtzID0g\ncGtzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmVhbSB0byB3cml0\nZSB0byBmb3IgdGhlIGNyZWF0aW9uIG9mIFNRTCBzY3JpcHRzLiBJZiB0aGUK\nICAgICAqIHN0cmVhbSBpcyBub24tbnVsbCwgYWxsIFNRTCB3aWxsIGJlIHdy\naXR0ZW4gdG8gdGhpcyBzdHJlYW0gcmF0aGVyIHRoYW4KICAgICAqIGV4ZWN1\ndGVkIGFnYWluc3QgdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBwdWJsaWMg\nV3JpdGVyIGdldFdyaXRlcigpIHsKICAgICAgICByZXR1cm4gX3dyaXRlcjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJlYW0gdG8gd3JpdGUgdG8g\nZm9yIHRoZSBjcmVhdGlvbiBvZiBTUUwgc2NyaXB0cy4gSWYgdGhlCiAgICAg\nKiBzdHJlYW0gaXMgbm9uLW51bGwsIGFsbCBTUUwgd2lsbCBiZSB3cml0dGVu\nIHRvIHRoaXMgc3RyZWFtIHJhdGhlciB0aGFuCiAgICAgKiBleGVjdXRlZCBh\nZ2FpbnN0IHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0V3JpdGVyKFdyaXRlciB3cml0ZXIpIHsKICAgICAgICBpZiAod3JpdGVy\nID09IG51bGwpCiAgICAgICAgICAgIF93cml0ZXIgPSBudWxsOwogICAgICAg\nIGVsc2UgaWYgKHdyaXRlciBpbnN0YW5jZW9mIFByaW50V3JpdGVyKQogICAg\nICAgICAgICBfd3JpdGVyID0gKFByaW50V3JpdGVyKSB3cml0ZXI7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBfd3JpdGVyID0gbmV3IFByaW50V3JpdGVy\nKHdyaXRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNj\naGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAqLwogICAg\ncHVibGljIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3VwKCkgewogICAgICAg\nIHJldHVybiBfZ3JvdXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U2NoZW1hR3JvdXAoU2NoZW1hR3JvdXAgZ3Jv\ndXApIHsKICAgICAgICBfZ3JvdXAgPSBncm91cDsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLwogICAgLy8gQWN0aW9ucwogICAgLy8vLy8vLy8vLy8KCiAgICAv\nKioKICAgICAqIFJ1biB0aGUgdG9vbCBhY3Rpb24uCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHJ1bigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKF9hY3Rpb24gPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpZiAoQUNUSU9OX0FERC5lcXVhbHMoX2FjdGlvbikp\nCiAgICAgICAgICAgIGFkZCgpOwogICAgICAgIGVsc2UgaWYgKEFDVElPTl9E\nUk9QLmVxdWFscyhfYWN0aW9uKSkKICAgICAgICAgICAgZHJvcCgpOwogICAg\nICAgIGVsc2UgaWYgKEFDVElPTl9SRVRBSU4uZXF1YWxzKF9hY3Rpb24pKQog\nICAgICAgICAgICByZXRhaW4oKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05f\nUkVGUkVTSC5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIHJlZnJlc2go\nKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fQlVJTEQuZXF1YWxzKF9hY3Rp\nb24pKQogICAgICAgICAgICBidWlsZCgpOwogICAgICAgIGVsc2UgaWYgKEFD\nVElPTl9DUkVBVEVEQi5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIGNy\nZWF0ZURCKCk7CiAgICAgICAgZWxzZSBpZiAoQUNUSU9OX0RST1BEQi5lcXVh\nbHMoX2FjdGlvbikpCiAgICAgICAgICAgIGRyb3BEQigpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyBhbnkgY29tcG9uZW50cyBwcmVzZW50IGluIHRo\nZSBzY2hlbWEgcmVwb3NpdG9yeSBidXQgYWJzZW50IGZyb20KICAgICAqIHRo\nZSBkYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAg\nICovCiAgICB2b2lkIGFkZCgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYWRkKGdldERCU2NoZW1hR3JvdXAoZmFsc2UpLCBhc3Nl\ncnRTY2hlbWFHcm91cCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3Bz\nIGFsbCBzY2hlbWEgY29tcG9uZW50cyBpbiB0aGUgc2NoZW1hIHJlcG9zaXRv\ncnkgdGhhdCBhbHNvIGV4aXN0CiAgICAgKiBpbiB0aGUgZGF0YWJhc2UuIFBh\nY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAgdm9pZCBk\ncm9wKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBk\ncm9wKGdldERCU2NoZW1hR3JvdXAoZmFsc2UpLCBhc3NlcnRTY2hlbWFHcm91\ncCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3BzIGRhdGFiYXNlIGNv\nbXBvbmVudHMgdGhhdCBhcmUgbm90IG1lbnRpb25lZCBpbiB0aGUgc2NoZW1h\nCiAgICAgKiByZXBvc2l0b3J5LiBQYWNrYWdlLXByaXZhdGUgZm9yIHRlc3Rp\nbmcuCiAgICAgKi8KICAgIHZvaWQgcmV0YWluKCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXRhaW4oZ2V0REJTY2hlbWFHcm91\ncCh0cnVlKSwgYXNzZXJ0U2NoZW1hR3JvdXAoKSwKICAgICAgICAgICAgZ2V0\nRHJvcFRhYmxlcygpLCBnZXREcm9wU2VxdWVuY2VzKCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyBhbnkgY29tcG9uZW50cyBwcmVzZW50IGluIHRo\nZSBzY2hlbWEgcmVwb3NpdG9yeSBidXQgYWJzZW50IGZyb20KICAgICAqIHRo\nZSBkYXRhYmFzZSwgYW5kIGRyb3BzIHVudXNlZCBkYXRhYmFzZSBjb21wb25l\nbnRzLgogICAgICogUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAg\nICovCiAgICB2b2lkIHJlZnJlc2goKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIFNjaGVtYUdyb3VwIGxvY2FsID0gYXNzZXJ0U2No\nZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWFHcm91cCBkYiA9IGdldERCU2No\nZW1hR3JvdXAodHJ1ZSk7CiAgICAgICAgcmV0YWluKGRiLCBsb2NhbCwgZ2V0\nRHJvcFRhYmxlcygpLCBnZXREcm9wU2VxdWVuY2VzKCkpOwogICAgICAgIGFk\nZChkYiwgbG9jYWwpOwogICAgfQoKICAgIC8qKgogICAgICogUmUtZXhlY3V0\nZSBhbGwgU1FMIHVzZWQgZm9yIHRoZSBjcmVhdGlvbiBvZiB0aGUgY3VycmVu\ndCBkYXRhYmFzZTsKICAgICAqIHRoaXMgYWN0aW9uIGlzIHVzdWFsbHkgdXNl\nZCB3aGVuIGNyZWF0aW5nIFNRTCBzY3JpcHRzLgogICAgICogUGFja2FnZS1w\ncml2YXRlIGZvciB0ZXN0aW5nLgogICAgICovCiAgICB2b2lkIGNyZWF0ZURC\nKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTY2hl\nbWFHcm91cCBncm91cCA9IG5ldyBTY2hlbWFHcm91cCgpOwogICAgICAgIGdy\nb3VwLmFkZFNjaGVtYSgpOwogICAgICAgIGFkZChncm91cCwgZ2V0REJTY2hl\nbWFHcm91cCh0cnVlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZS1leGVj\ndXRlIGFsbCBTUUwgdXNlZCBmb3IgdGhlIGNyZWF0aW9uIG9mIHRoZSBjdXJy\nZW50IGRhdGFiYXNlOwogICAgICogdGhpcyBhY3Rpb24gaXMgdXN1YWxseSB1\nc2VkIHdoZW4gY3JlYXRpbmcgU1FMIHNjcmlwdHMuCiAgICAgKiBQYWNrYWdl\nLXByaXZhdGUgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgYnVpbGQo\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNjaGVt\nYUdyb3VwIGdyb3VwID0gbmV3IFNjaGVtYUdyb3VwKCk7CiAgICAgICAgZ3Jv\ndXAuYWRkU2NoZW1hKCk7CiAgICAgICAgYWRkKGdyb3VwLCBhc3NlcnRTY2hl\nbWFHcm91cCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3AgdGhlIGN1\ncnJlbnQgZGF0YWJhc2UuIFBhY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGluZy4K\nICAgICAqLwogICAgdm9pZCBkcm9wREIoKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldGFpbihnZXREQlNjaGVtYUdyb3VwKHRy\ndWUpLCBuZXcgU2NoZW1hR3JvdXAoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIGNoYW5nZXMgbWFkZSB0byB0aGUg\nREIgaW4gdGhlIGN1cnJlbnQge0BsaW5rIFNjaGVtYUZhY3Rvcnl9LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKSB7CiAgICAgICAgaWYgKF9k\nYiAhPSBudWxsICYmIF93cml0ZXIgPT0gbnVsbCkKICAgICAgICAgICAgX2Nv\nbmYuZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCkuc3RvcmVTY2hlbWEoX2Ri\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxsIGRhdGFiYXNlIGNv\nbXBvbmVudHMgaW4gdGhlIHJlcG9zaXRvcnkgc2NoZW1hIHRoYXQgYXJlIG5v\ndAogICAgICogcHJlc2VudCBpbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ugc2NoZW1h\nIHRvIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZChTY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3MpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWRkIHNlcXVlbmNl\ncwogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSByZXBvcy5nZXRTY2hlbWFz\nKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBpZiAoX3NlcXMp\nIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBzZXFzOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHNlcXMgPSBzY2hlbWFzW2ldLmdldFNlcXVlbmNlcygp\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBzZXFzLmxl\nbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRiLmZpbmRT\nZXF1ZW5jZShzZXFzW2pdKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGNyZWF0\nZVNlcXVlbmNlKHNlcXNbal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNjaGVtYSA9IGRiLmdldFNjaGVtYShzZXFzW2pdLmdldFNjaGVtYU5hbWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVtYSA9IGRiLmFk\nZFNjaGVtYShzZXFzW2pdLmdldFNjaGVtYU5hbWUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHNjaGVtYS5pbXBvcnRTZXF1ZW5jZShzZXFzW2pdKTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJhZGQtc2VxIiwgc2Vxc1tqXSkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRhbnQgaW4gdGhpcyBtZXRob2Q7\nIHN0YXJ0IHdpdGggY29sdW1ucwogICAgICAgIFRhYmxlW10gdGFiczsKICAg\nICAgICBUYWJsZSBkYlRhYmxlOwogICAgICAgIENvbHVtbltdIGNvbHM7CiAg\nICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNj\naGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAg\nY29scyA9IHRhYnNbal0uZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAg\nZGJUYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGsgPSAwOyBrIDwgY29scy5sZW5ndGg7IGsrKykgewog\nICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgY29sID0gZGJUYWJsZS5nZXRDb2x1bW4o\nY29sc1trXS5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoY29sID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChhZGRDb2x1bW4oY29sc1trXSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRDb2x1bW4oY29sc1trXSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJhZGQtY29s\nIiwgY29sc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\naWYgKCFjb2xzW2tdLmVxdWFsc0NvbHVtbihjb2wpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImJhZC1jb2wi\nLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY29sLCBkYlRhYmxlLCBjb2wuZ2V0RGVzY3JpcHRpb24oKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzW2tdLmdldERlc2NyaXB0\naW9uKCkgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBwcmltYXJ5IGtleXMKICAgICAgICBp\nZiAoX3BrcykgewogICAgICAgICAgICBQcmltYXJ5S2V5IHBrOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxl\ncygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJz\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgcGsgPSB0YWJz\nW2pdLmdldFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgICAgICAgICBkYlRh\nYmxlID0gZGIuZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAg\nICAgIGlmIChwayAhPSBudWxsICYmICFway5pc0xvZ2ljYWwoKSAmJiBkYlRh\nYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRi\nVGFibGUuZ2V0UHJpbWFyeUtleSgpID09IG51bGwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICYmIGFkZFByaW1hcnlLZXkocGspKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRQcmltYXJ5S2V5KHBr\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZGJUYWJsZS5n\nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiYWRkLXBrIiwgcGssIHRhYnNb\nal0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXBrLmVx\ndWFsc1ByaW1hcnlLZXkoZGJUYWJsZS5nZXRQcmltYXJ5S2V5KCkpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJi\nYWQtcGsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFi\nbGUuZ2V0UHJpbWFyeUtleSgpLCBkYlRhYmxlKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyB0YWJsZXMKICAgICAgICBTZXQgbmV3VGFibGVz\nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNj\naGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAg\naWYgKGRiLmZpbmRUYWJsZSh0YWJzW2pdKSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlmIChjcmVh\ndGVUYWJsZSh0YWJzW2pdKSkgewogICAgICAgICAgICAgICAgICAgIG5ld1Rh\nYmxlcy5hZGQodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAgc2NoZW1h\nID0gZGIuZ2V0U2NoZW1hKHRhYnNbal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHNjaGVtYSA9IGRiLmFkZFNjaGVtYSh0YWJzW2pd\nLmdldFNjaGVtYU5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgc2NoZW1h\nLmltcG9ydFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJhZGQt\ndGFibGUiLCB0YWJzW2pdKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIGluZGV4ZXMKICAgICAgICBJbmRleFtdIGlkeHM7CiAgICAg\nICAgSW5kZXggaWR4OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2No\nZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAvLyBj\ncmVhdGUgaW5kZXhlcyBvbiBuZXcgdGFibGVzIGV2ZW4gaWYgaW5kZXhlcwog\nICAgICAgICAgICAgICAgLy8gaGF2ZSBiZWVuIHR1cm5lZCBvZmYKICAgICAg\nICAgICAgICAgIGlmICghX2luZGV4ZXMgJiYgIW5ld1RhYmxlcy5jb250YWlu\ncyh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICBpZHhzID0gdGFic1tqXS5nZXRJbmRleGVzKCk7CiAg\nICAgICAgICAgICAgICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHRhYnNbal0p\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCBpZHhzLmxl\nbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRiVGFibGUg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZHggPSBmaW5k\nSW5kZXgoZGJUYWJsZSwgaWR4c1trXSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChpZHggPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGNyZWF0ZUluZGV4KGlkeHNba10sIGRiVGFibGUpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuaW1wb3J0SW5k\nZXgoaWR4c1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJhZGQtaW5kZXgiLCBpZHhzW2tdLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0YWJzW2pdKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSBpZiAoIWlkeHNba10uZXF1YWxzSW5kZXgoaWR4\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiYmFkLWluZGV4IiwgaWR4LCBkYlRhYmxlKSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBmb3JlaWduIGtleXMKICAgICAgICBGb3Jl\naWduS2V5W10gZmtzOwogICAgICAgIEZvcmVpZ25LZXkgZms7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAg\nICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKysp\nIHsKICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBmb3JlaWduIGtleXMgb24g\nbmV3IHRhYmxlcyBldmVuIGlmIGZrcwogICAgICAgICAgICAgICAgLy8gaGF2\nZSBiZWVuIHR1cm5lZCBvZmYKICAgICAgICAgICAgICAgIGlmICghX2ZrcyAm\nJiAhbmV3VGFibGVzLmNvbnRhaW5zKHRhYnNbal0pKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGZrcyA9IHRhYnNb\nal0uZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICAgICAgICAgIGRiVGFibGUg\nPSBkYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBrID0gMDsgayA8IGZrcy5sZW5ndGg7IGsrKykgewogICAgICAgICAg\nICAgICAgICAgIGlmICghZmtzW2tdLmlzTG9naWNhbCgpICYmIGRiVGFibGUg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBmayA9IGZpbmRG\nb3JlaWduS2V5KGRiVGFibGUsIGZrc1trXSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChmayA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoYWRkRm9yZWlnbktleShma3Nba10pKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuaW1wb3J0Rm9yZWlnbktl\neShma3Nba10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiYWRkLWZrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmtzW2tdLCB0YWJzW2pdKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAoIWZrc1trXS5lcXVhbHNGb3JlaWduS2V5KGZrKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiYmFkLWZrIiwgZmssIGRiVGFibGUpKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wcyBhbGwgZGF0YWJhc2UgY29t\ncG9uZW50cyB0aGF0IGFyZSBpbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ugc2NoZW1h\nCiAgICAgKiBidXQgbm90IGluIHRoZSByZXBvc2l0b3J5IHNjaGVtYS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJldGFpbihTY2hlbWFHcm91cCBkYiwg\nU2NoZW1hR3JvdXAgcmVwb3MsIGJvb2xlYW4gdGFibGVzLAogICAgICAgIGJv\nb2xlYW4gc2VxdWVuY2VzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBkYi5nZXRTY2hlbWFzKCk7\nCiAgICAgICAgaWYgKF9zZXFzICYmIHNlcXVlbmNlcykgewogICAgICAgICAg\nICBTZXF1ZW5jZVtdIHNlcXM7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nc2VxcyA9IHNjaGVtYXNbaV0uZ2V0U2VxdWVuY2VzKCk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBqID0gMDsgaiA8IHNlcXMubGVuZ3RoOyBqKyspIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxlKHNlcXNbal0p\nKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocmVwb3MuZmluZFNlcXVlbmNlKHNlcXNbal0pID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BTZXF1\nZW5jZShzZXFzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNj\naGVtYXNbaV0ucmVtb3ZlU2VxdWVuY2Uoc2Vxc1tqXSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1zZXEiLCBzZXFzW2pdKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRh\nbnQgaW4gdGhpcyBtZXRob2Q7IHN0YXJ0IHdpdGggZm9yZWlnbiBrZXlzCiAg\nICAgICAgVGFibGVbXSB0YWJzOwogICAgICAgIFRhYmxlIHJlcG9zVGFibGU7\nCiAgICAgICAgaWYgKF9ma3MpIHsKICAgICAgICAgICAgRm9yZWlnbktleVtd\nIGZrczsKICAgICAgICAgICAgRm9yZWlnbktleSBmazsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFi\nbGUodGFic1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgICAgIGZrcyA9IHRhYnNbal0uZ2V0Rm9yZWln\nbktleXMoKTsKICAgICAgICAgICAgICAgICAgICByZXBvc1RhYmxlID0gcmVw\nb3MuZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAgICAgIGlm\nICghdGFibGVzICYmIHJlcG9zVGFibGUgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGZv\nciAoaW50IGsgPSAwOyBrIDwgZmtzLmxlbmd0aDsgaysrKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChma3Nba10uaXNMb2dpY2FsKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZrID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHJlcG9zVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZrID0gZmluZEZvcmVpZ25LZXkocmVwb3NUYWJsZSwgZmtz\nW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcG9zVGFibGUg\nPT0gbnVsbCB8fCBmayA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB8fCAhZmtzW2tdLmVxdWFsc0ZvcmVpZ25LZXkoZmspKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcEZvcmVpZ25LZXkoZmtz\nW2tdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2pd\nLnJlbW92ZUZvcmVpZ25LZXkoZmtzW2tdKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBfbG9nLndhcm4oX2xvYy5nZXQoImRyb3AtZmsiLCBma3Nba10sCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbal0pKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gcHJpbWFyeSBrZXlzCiAgICAgICAgaWYgKF9wa3MpIHsKICAg\nICAgICAgICAgUHJpbWFyeUtleSBwazsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykg\newogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUodGFic1tq\nXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgICAgIHBrID0gdGFic1tqXS5nZXRQcmltYXJ5S2V5KCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHBrICE9IG51bGwgJiYgcGsuaXNMb2dp\nY2FsKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAg\nICAgICAgICAgICAgICAgICByZXBvc1RhYmxlID0gcmVwb3MuZmluZFRhYmxl\nKHRhYnNbal0pOwogICAgICAgICAgICAgICAgICAgIGlmIChwayAhPSBudWxs\nICYmIHJlcG9zVGFibGUgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAg\nICAmJiAocmVwb3NUYWJsZS5nZXRQcmltYXJ5S2V5KCkgPT0gbnVsbAogICAg\nICAgICAgICAgICAgICAgICAgICB8fCAhcGsuZXF1YWxzUHJpbWFyeUtleShy\nZXBvc1RhYmxlLmdldFByaW1hcnlLZXkoKSkpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChkcm9wUHJpbWFyeUtleShwaykpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB0YWJzW2pdLnJlbW92ZVByaW1hcnlLZXkoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLXBrIiwgcGss\nIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNv\nbHVtbnMKICAgICAgICBDb2x1bW5bXSBjb2xzOwogICAgICAgIENvbHVtbiBj\nb2w7CiAgICAgICAgQ29sbGVjdGlvbiBkcm9wcyA9IG5ldyBMaW5rZWRMaXN0\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRh\nYmxlcygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMu\nbGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFi\nbGUodGFic1tqXSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICBjb2xzID0gdGFic1tqXS5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgICAgICAgICByZXBvc1RhYmxlID0gcmVwb3MuZmluZFRhYmxlKHRh\nYnNbal0pOwogICAgICAgICAgICAgICAgaWYgKHJlcG9zVGFibGUgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwg\nY29scy5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICBj\nb2wgPSByZXBvc1RhYmxlLmdldENvbHVtbihjb2xzW2tdLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wgPT0gbnVsbCB8fCAh\nY29sc1trXS5lcXVhbHNDb2x1bW4oY29sKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHRhYnNbal0uZ2V0Q29sdW1ucygpLmxlbmd0aCA9\nPSAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BzLmFk\nZCh0YWJzW2pdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKGRyb3BDb2x1bW4oY29sc1trXSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdGFic1tqXS5yZW1vdmVDb2x1bW4oY29sc1trXSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLWNv\nbCIsIGNvbHNba10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm93IHRhYmxlcwogICAgICAg\nIGlmICh0YWJsZXMpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJz\nID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykKICAgICAgICAg\nICAgICAgICAgICBpZiAoISFpc0Ryb3BwYWJsZSh0YWJzW2pdKQogICAgICAg\nICAgICAgICAgICAgICAgICAmJiByZXBvcy5maW5kVGFibGUodGFic1tqXSkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHMuYWRkKHRh\nYnNbal0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRyb3BU\nYWJsZXMoZHJvcHMsIGRiKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3Bz\nIGFsbCBkYXRhYmFzZSBjb21wb25lbnRzIGluIHRoZSBnaXZlbiByZXBvc2l0\nb3J5IHNjaGVtYS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRyb3AoU2No\nZW1hR3JvdXAgZGIsIFNjaGVtYUdyb3VwIHJlcG9zKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGRyb3Agc2VxdWVuY2VzCiAg\nICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IHJlcG9zLmdldFNjaGVtYXMoKTsK\nICAgICAgICBpZiAoX3NlcXMpIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBz\nZXFzOwogICAgICAgICAgICBTZXF1ZW5jZSBkYlNlcTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBzZXFzID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMo\nKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2Vxcy5s\nZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9w\ncGFibGUoc2Vxc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAgICAgICAgIGRiU2VxID0gZGIuZmluZFNlcXVl\nbmNlKHNlcXNbal0pOwogICAgICAgICAgICAgICAgICAgIGlmIChkYlNlcSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wU2Vx\ndWVuY2Uoc2Vxc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBk\nYlNlcS5nZXRTY2hlbWEoKS5yZW1vdmVTZXF1ZW5jZShkYlNlcSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1zZXEiLCBzZXFzW2pd\nKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjYWxjdWxhdGUg\ndGFibGVzIHRvIGRyb3A7IHdlIGNhbiBvbmx5IGRyb3AgdGFibGVzIGlmIHdl\nJ3JlIHN1cmUKICAgICAgICAvLyB0aGUgdXNlciBsaXN0ZWQgdGhlIGVudGly\nZSB0YWJsZSBkZWZpbml0aW9uIGluIHRoZSBzdHVmZiB0aGV5IHdhbnQKICAg\nICAgICAvLyBkcm9wcGVkOyBlbHNlIHRoZXkgbWlnaHQganVzdCB3YW50IHRv\nIGRyb3AgYSBmZXcgY29sdW1ucwogICAgICAgIENvbGxlY3Rpb24gZHJvcHMg\nPSBuZXcgTGlua2VkTGlzdCgpOwogICAgICAgIFRhYmxlW10gdGFiczsKICAg\nICAgICBUYWJsZSBkYlRhYmxlOwogICAgICAgIENvbHVtbltdIGRiQ29sczsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVz\nKCk7CiAgICAgICAgICAgIHRhYmxlczoKICAgICAgICAgICAgZm9yIChpbnQg\naiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoIWlzRHJvcHBhYmxlKHRhYnNbal0pKQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgZGJUYWJsZSA9IGRiLmZp\nbmRUYWJsZSh0YWJzW2pdKTsKICAgICAgICAgICAgICAgIGlmIChkYlRhYmxl\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICAgICAgZGJDb2xzID0gZGJUYWJsZS5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGRiQ29scy5sZW5n\ndGg7IGsrKykKICAgICAgICAgICAgICAgICAgICBpZiAodGFic1tqXS5nZXRD\nb2x1bW4oZGJDb2xzW2tdLmdldE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgY29udGludWUgdGFibGVzOwoKICAgICAgICAgICAg\nICAgIGRyb3BzLmFkZCh0YWJzW2pdKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLy8gb3JkZXIgaXMgaW1wb3J0YW50IGluIHRoaXMgbWV0\naG9kOyBzdGFydCB3aXRoIGZvcmVpZ24ga2V5cyBtZW50aW9uZWQKICAgICAg\nICAvLyBpbiB0aGUgZHJvcCBzY2hlbWEKICAgICAgICBpZiAoX2Zrcykgewog\nICAgICAgICAgICBGb3JlaWduS2V5W10gZmtzOwogICAgICAgICAgICBGb3Jl\naWduS2V5IGZrOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNj\naGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYnMgPSBz\nY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKCFpc0Ryb3BwYWJsZSh0YWJzW2pdKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAg\nZmtzID0gdGFic1tqXS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICAg\nICAgICAgIGRiVGFibGUgPSBkYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAg\nICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCBma3MubGVuZ3Ro\nOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZrc1trXS5p\nc0xvZ2ljYWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgZmsgPSBudWxsOwogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmsgPSBmaW5kRm9yZWlnbktleShk\nYlRhYmxlLCBma3Nba10pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nZGJUYWJsZSA9PSBudWxsIHx8IGZrID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChkcm9wRm9yZWlnbktleShma3Nba10pKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGRiVGFibGUgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBkYlRhYmxlLnJlbW92ZUZvcmVpZ25L\nZXkoZmspOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiZHJvcC1mayIsIGZrc1trXSwgdGFic1tqXSkpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gYWxzbyBkcm9wIGltcG9ydGVkIGZvcmVpZ24ga2V5cyBm\nb3IgdGFibGVzIHRoYXQgd2lsbCBiZSBkcm9wcGVkCiAgICAgICAgICAgIFRh\nYmxlIHRhYjsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBkcm9w\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgdGFiID0gKFRhYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\nZGJUYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWIpOwogICAgICAgICAgICAgICAg\naWYgKGRiVGFibGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgICAgICBma3MgPSBkYi5maW5kRXhwb3J0ZWRG\nb3JlaWduS2V5cyhkYlRhYmxlLmdldFByaW1hcnlLZXkoKSk7CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgICAgIGlmIChkcm9wRm9yZWlnbktleShma3Nb\naV0pKQogICAgICAgICAgICAgICAgICAgICAgICBkYlRhYmxlLnJlbW92ZUZv\ncmVpZ25LZXkoZmtzW2ldKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJv\ncC1mayIsIGZrc1tpXSwgZGJUYWJsZSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBkcm9wIHRoZSB0\nYWJsZXMgd2UgY2FsY3VsYXRlZCBhYm92ZQogICAgICAgIGRyb3BUYWJsZXMo\nZHJvcHMsIGRiKTsKCiAgICAgICAgLy8gY29sdW1ucwogICAgICAgIENvbHVt\nbltdIGNvbHM7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAg\nICAgICAgICAgICAgaWYgKCFpc0Ryb3BwYWJsZSh0YWJzW2pdKSkKICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbHMg\nPSB0YWJzW2pdLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAgIGRiVGFi\nbGUgPSBkYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBrID0gMDsgayA8IGNvbHMubGVuZ3RoOyBrKyspIHsKICAgICAg\nICAgICAgICAgICAgICBjb2wgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nIGlmIChkYlRhYmxlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbCA9IGRiVGFibGUuZ2V0Q29sdW1uKGNvbHNba10uZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSA9PSBudWxsIHx8IGNv\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BDb2x1bW4oY29sc1trXSkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRiVGFibGUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUucmVtb3Zl\nQ29sdW1uKGNvbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgi\nZHJvcC1jb2wiLCBjb2xzW2tdLCB0YWJzW2pdKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhl\nIHRhYmxlIGlzIGRyb3BwYWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIGlzRHJvcHBhYmxlKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJu\nIF9vcGVuanBhVGFibGVzCiAgICAgICAgICAgIHx8ICghdGFibGUuZ2V0TmFt\nZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgiT1BFTkpQQV8iKQogICAg\nICAgICAgICAmJiAhdGFibGUuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkuc3Rh\ncnRzV2l0aCgiSkRPXyIpKTsgLy8gbGVnYWN5CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgc2VxdWVuY2UgaXMgZHJvcHBhYmxl\nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNEcm9wcGFibGUoU2Vx\ndWVuY2Ugc2VxKSB7CiAgICAgICAgcmV0dXJuIF9vcGVuanBhVGFibGVzCiAg\nICAgICAgICAgIHx8ICghc2VxLmdldE5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0\nYXJ0c1dpdGgoIk9QRU5KUEFfIikKICAgICAgICAgICAgJiYgIXNlcS5nZXRO\nYW1lKCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJKRE9fIikpOyAvLyBs\nZWdhY3kKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgYW4gaW5kZXggaW4g\ndGhlIGdpdmVuIHRhYmxlIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gb25lLgog\nICAgICovCiAgICBwcml2YXRlIEluZGV4IGZpbmRJbmRleChUYWJsZSBkYlRh\nYmxlLCBJbmRleCBpZHgpIHsKICAgICAgICBJbmRleFtdIGlkeHMgPSBkYlRh\nYmxlLmdldEluZGV4ZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGlkeHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChpZHguY29sdW1u\nc01hdGNoKGlkeHNbaV0uZ2V0Q29sdW1ucygpKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBpZHhzW2ldOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogRmluZCBhIGZvcmVpZ24ga2V5IGluIHRoZSBnaXZl\nbiB0YWJsZSB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIG9uZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBGb3JlaWduS2V5IGZpbmRGb3JlaWduS2V5KFRhYmxlIGRi\nVGFibGUsIEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsuZ2V0Q29u\nc3RhbnRDb2x1bW5zKCkubGVuZ3RoID4gMAogICAgICAgICAgICB8fCBmay5n\nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgRm9yZWlnbktleVtdIGZr\ncyA9IGRiVGFibGUuZ2V0Rm9yZWlnbktleXMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZrcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYg\nKGZrLmNvbHVtbnNNYXRjaChma3NbaV0uZ2V0Q29sdW1ucygpLAogICAgICAg\nICAgICAgICAgZmtzW2ldLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZrc1tpXTsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gY29s\nbGVjdGlvbiBvZiB0YWJsZXMgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLiBP\ncmRlcnMKICAgICAqIHRoZSByZW1vdmFscyBhY2NvcmRpbmcgdG8gZm9yZWln\nbiBrZXkgY29uc3RyYWludHMgb24gdGhlIHRhYmxlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGRyb3BUYWJsZXMoQ29sbGVjdGlvbiB0YWJsZXMsIFNj\naGVtYUdyb3VwIGNoYW5nZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAodGFibGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBUYWJsZSB0YWJsZTsKICAgICAgICBUYWJsZSBj\naGFuZ2VUYWJsZTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHRhYmxl\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICB0\nYWJsZSA9IChUYWJsZSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGRy\nb3BUYWJsZSh0YWJsZSkpIHsKICAgICAgICAgICAgICAgIGNoYW5nZVRhYmxl\nID0gY2hhbmdlLmZpbmRUYWJsZSh0YWJsZSk7CiAgICAgICAgICAgICAgICBp\nZiAoY2hhbmdlVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBj\naGFuZ2VUYWJsZS5nZXRTY2hlbWEoKS5yZW1vdmVUYWJsZShjaGFuZ2VUYWJs\nZSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJkcm9wLXRhYmxlIiwgdGFibGUpKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHRhYmxlIHRv\nIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90\naGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVUYWJs\nZShUYWJsZSB0YWJsZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRDcmVhdGVUYWJs\nZVNRTCh0YWJsZSkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUg\nZ2l2ZW4gdGFibGUgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoK\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNj\nZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZHJvcFRhYmxlKFRhYmxlIHRhYmxlKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0\nLmdldERyb3BUYWJsZVNRTCh0YWJsZSkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHRoZSBnaXZlbiBzZXF1ZW5jZSB0byB0aGUgZGF0YWJhc2Ugc2No\nZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0\naW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gY3JlYXRlU2VxdWVuY2UoU2VxdWVuY2Ugc2Vx\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBleGVjdXRlU1FMKF9kaWN0LmdldENyZWF0ZVNlcXVlbmNlU1FMKHNlcSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4gc2VxdWVu\nY2UgZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBm\nYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZHJv\ncFNlcXVlbmNlKFNlcXVlbmNlIHNlcSkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRE\ncm9wU2VxdWVuY2VTUUwoc2VxKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgdGhlIGdpdmVuIGluZGV4IHRvIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAg\nICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2Fz\nIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBjcmVhdGVJbmRleChJbmRleCBpZHgsIFRhYmxlIHRhYmxl\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGludCBt\nYXggPSBfZGljdC5tYXhJbmRleGVzUGVyVGFibGU7CgogICAgICAgIGludCBs\nZW4gPSB0YWJsZS5nZXRJbmRleGVzKCkubGVuZ3RoOwogICAgICAgIGlmICh0\nYWJsZS5nZXRQcmltYXJ5S2V5KCkgIT0gbnVsbCkKICAgICAgICAgICAgbGVu\nICs9IHRhYmxlLmdldFByaW1hcnlLZXkoKS5nZXRDb2x1bW5zKCkubGVuZ3Ro\nOwoKICAgICAgICBpZiAobGVuID49IG1heCkgewogICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoInRvby1tYW55LWluZGV4ZXMiLCBpZHgsIHRhYmxl\nLCBtYXggKyAiIikpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQoKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRDcmVh\ndGVJbmRleFNRTChpZHgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3Ag\ndGhlIGdpdmVuIGluZGV4IGZyb20gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMg\nc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGRyb3BJbmRleChJbmRleCBpZHgpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2Rp\nY3QuZ2V0RHJvcEluZGV4U1FMKGlkeCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHRoZSBnaXZlbiBjb2x1bW4gdG8gdGhlIGRhdGFiYXNlIHNjaGVt\nYS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlv\nbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGFkZENvbHVtbihDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRl\nU1FMKF9kaWN0LmdldEFkZENvbHVtblNRTChjb2wpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIERyb3AgdGhlIGdpdmVuIGNvbHVtbiBmcm9tIHRoZSBkYXRh\nYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRo\nZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBkcm9wQ29sdW1uKENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0RHJvcENvbHVtblNRTChjb2wpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gcHJpbWFyeSBr\nZXkgdG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFs\nc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGFkZFBy\naW1hcnlLZXkoUHJpbWFyeUtleSBwaykKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRB\nZGRQcmltYXJ5S2V5U1FMKHBrKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\ncm9wIHRoZSBnaXZlbiBwcmltYXJ5IGtleSBmcm9tIHRoZSBkYXRhYmFzZSBz\nY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVy\nYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBkcm9wUHJpbWFyeUtleShQcmltYXJ5S2V5\nIHBrKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBleGVjdXRlU1FMKF9kaWN0LmdldERyb3BQcmltYXJ5S2V5U1FMKHBr\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGZvcmVp\nZ24ga2V5IHRvIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICog\nQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWws\nIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBh\nZGRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2RpY3Qu\nZ2V0QWRkRm9yZWlnbktleVNRTChmaykpOwogICAgfQoKICAgIC8qKgogICAg\nICogRHJvcCB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgZnJvbSB0aGUgZGF0YWJh\nc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUg\nb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gZHJvcEZvcmVpZ25LZXkoRm9yZWln\nbktleSBmaykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXREcm9wRm9yZWlnbktleVNR\nTChmaykpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkYXRh\nYmFzZSBzY2hlbWEuCiAgICAgKi8KICAgIHB1YmxpYyBTY2hlbWFHcm91cCBn\nZXREQlNjaGVtYUdyb3VwKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBnZXREQlNjaGVtYUdyb3VwKHRydWUpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERCU2NoZW1hR3JvdXAoU2NoZW1h\nR3JvdXAgZGIpIHsKICAgICAgICBfZGIgPSBkYjsKICAgICAgICBpZiAoZGIg\nIT0gbnVsbCkKICAgICAgICAgICAgX2Z1bGxEQiA9IHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZnVsbCBpZiBmYWxzZSwgb25seSB0aGUgdGFi\nbGVzIG5hbWVkIGluIHRoZSBzZXQgc2NoZW1hCiAgICAgKiByZXBvc2l0b3J5\nIHdpbGwgYmUgZ2VuZXJhdGVkCiAgICAgKi8KICAgIHByaXZhdGUgU2NoZW1h\nR3JvdXAgZ2V0REJTY2hlbWFHcm91cChib29sZWFuIGZ1bGwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9kYiA9PSBudWxs\nIHx8IChmdWxsICYmICFfZnVsbERCKSkgewogICAgICAgICAgICBTY2hlbWFH\nZW5lcmF0b3IgZ2VuID0gbmV3IFNjaGVtYUdlbmVyYXRvcihfY29uZik7CiAg\nICAgICAgICAgIGdlbi5zZXRQcmltYXJ5S2V5cyhfcGtzKTsKICAgICAgICAg\nICAgZ2VuLnNldEZvcmVpZ25LZXlzKF9ma3MpOwogICAgICAgICAgICBnZW4u\nc2V0SW5kZXhlcyhfaW5kZXhlcyk7CiAgICAgICAgICAgIGlmIChmdWxsKQog\nICAgICAgICAgICAgICAgZ2VuLmdlbmVyYXRlU2NoZW1hcygpOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGdlbmVyYXRlIG9ubHkg\ndGhlIHRhYmxlcyBpbiB0aGUgZ2l2ZW4gcmVwb3NpdG9yeQogICAgICAgICAg\nICAgICAgLy8gZ3JvdXA7IHNvbWUgbWF5IG5vdCBleGlzdCB5ZXQsIHdoaWNo\nIGlzIE9LOyB3ZSBqdXN0IG5lZWQKICAgICAgICAgICAgICAgIC8vIHRvIG1h\na2Ugc3VyZSB3ZSBjYW4gZGV0ZWN0IHRoZSBjaGFuZ2VzIHRvIHRoZSBvbmVz\nIHRoYXQKICAgICAgICAgICAgICAgIC8vIGRvIGV4aXN0CiAgICAgICAgICAg\nICAgICBDb2xsZWN0aW9uIHRhYmxlcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAg\nICAgICAgICAgICAgICBTY2hlbWFHcm91cCBncm91cCA9IGFzc2VydFNjaGVt\nYUdyb3VwKCk7CiAgICAgICAgICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0g\nZ3JvdXAuZ2V0U2NoZW1hcygpOwogICAgICAgICAgICAgICAgVGFibGVbXSB0\nYWJzOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hl\nbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdGFicyA9\nIHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmICh0YWJzW2pdLmdldFNjaGVtYU5hbWUo\nKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVz\nLmFkZCgiLiIgKyB0YWJzW2pdLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRh\nYmxlcy5hZGQodGFic1tqXS5nZXRGdWxsTmFtZSgpKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBp\nZiAoIXRhYmxlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgZ2Vu\nLmdlbmVyYXRlU2NoZW1hcygoU3RyaW5nW10pIHRhYmxlcy50b0FycmF5CiAg\nICAgICAgICAgICAgICAgICAgICAgIChuZXcgU3RyaW5nW3RhYmxlcy5zaXpl\nKCldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2RiID0gZ2VuLmdl\ndFNjaGVtYUdyb3VwKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZGI7\nCiAgICB9CgogICAgcHJpdmF0ZSBTY2hlbWFHcm91cCBhc3NlcnRTY2hlbWFH\ncm91cCgpIHsKICAgICAgICBTY2hlbWFHcm91cCBsb2NhbCA9IGdldFNjaGVt\nYUdyb3VwKCk7CiAgICAgICAgaWYgKGxvY2FsID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInRvb2wtbm9yZXBvcyIpKTsKICAgICAgICByZXR1cm4gbG9jYWw7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8v\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBFeGVjdXRlcyB0aGUgZ2l2ZW4g\nYXJyYXkgb2Ygbm9uLXNlbGVjdGluZyBTUUwgc3RhdGVtZW50cywgY29ycmVj\ndGx5CiAgICAgKiBsb2dnaW5nIHRoZSBTUUwgY2FsbHMgYW5kIG9wdGlvbmFs\nbHkgaWdub3JpbmcgZXJyb3JzLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiB0aGVyZSB3YXMgU1FMIHRvIGV4ZWN1dGUgYW5kIHRoZSBjYWxscyB3\nZXJlCiAgICAgKiBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAq\nLwogICAgcHJpdmF0ZSBib29sZWFuIGV4ZWN1dGVTUUwoU3RyaW5nW10gc3Fs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGlm\nIG5vIHNxbCwgcHJvYmFibHkgYi9jIGRpY3Rpb25hcnkgZG9lc24ndCBzdXBw\nb3J0IG9wZXJhdGlvbgogICAgICAgIGlmIChzcWwubGVuZ3RoID09IDApCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgYm9vbGVhbiBlcnIg\nPSBmYWxzZTsKICAgICAgICBpZiAoX3dyaXRlciA9PSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIHRoaXMgaXMgb3V0c2lkZSB0aGUgdHJ5LWNhdGNoIGJlY2F1\nc2UgYSBmYWlsdXJlIGhlcmUgaXMKICAgICAgICAgICAgLy8gcmVhbGx5IGJh\nZCwgYW5kIHNob3VsZCBub3QgYmUgaWdub3JlZC4KICAgICAgICAgICAgQ29u\nbmVjdGlvbiBjb25uID0gX2RzLmdldENvbm5lY3Rpb24oKTsKICAgICAgICAg\nICAgU3RhdGVtZW50IHN0YXRlbWVudCA9IG51bGw7CiAgICAgICAgICAgIGJv\nb2xlYW4gd2FzQXV0byA9IHRydWU7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICB3YXNBdXRvID0gY29ubi5nZXRBdXRvQ29tbWl0KCk7CiAg\nICAgICAgICAgICAgICBpZiAoIXdhc0F1dG8pCiAgICAgICAgICAgICAgICAg\nICAgY29ubi5zZXRBdXRvQ29tbWl0KHRydWUpOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzcWwubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBzb21lIGNvbm5lY3Rpb25zIHJlcXVpcmUgdGhhdCByb2xsYmFjayBiZQog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxsZWQgb24gdGhlIGNvbm5l\nY3Rpb24gYmVmb3JlIGFueSBEREwgc3RhdGVtZW50cwogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBjYW4gYmUgcnVuIG9uIGl0LCBldmVuIHdoZW4gYXV0\nb2NvbW1pdCBpcyBvbi4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhp\ncyBpcyBzb21ldGltZXMgYmVjYXVzZSB0aGUgY29ubmVjdGlvbiBkb2VzIG5v\ndAogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbGxvdyBEREwgc3RhdGVt\nZW50cyB3aGVuIHRoZXJlIGFyZSBtdWx0aXBsZQogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBjb21tYW5kcyBpc3N1ZWQgb24gdGhlIGNvbm5lY3Rpb24s\nIGFuZCB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29ubmVjdGlv\nbiBwb29sIG1heSBoYXZlIGlzc3VlZCBzb21lIHZhbGlkYXRpb24gU1FMLgog\nICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY29ubi5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZW1l\nbnQgPSBjb25uLmNyZWF0ZVN0YXRlbWVudCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICBzdGF0ZW1lbnQuZXhlY3V0ZVVwZGF0ZShzcWxbaV0pOwoKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gc29tZSBjb25uZWN0aW9ucyBzZWVt\nIHRvIHJlcXVpcmUgYW4gZXhwbGljaXQKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gY29tbWl0IGZvciBEREwgc3RhdGVtZW50cywgZXZlbiB3aGVuIGF1\ndG9jb21taXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXMgb24uIFRo\nZSBEYXRhRGlyZWN0IGRyaXZlcnMgc2VlbSB0byBzdWZmZXIgZnJvbQogICAg\nICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGxpbWl0YXRpb24uCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb25uLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgZXJyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAg\naGFuZGxlRXhjZXB0aW9uKHNlKTsKICAgICAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGVtZW50\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudC5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgaWYgKCF3YXNBdXRvKQogICAgICAgICAgICAgICAgICAgIGNvbm4uc2V0\nQXV0b0NvbW1pdChmYWxzZSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzcWwubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBfd3JpdGVyLnByaW50bG4oc3FsW2ldICsgIjsiKTsKICAgICAg\nICAgICAgX3dyaXRlci5mbHVzaCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0\ndXJuICFlcnI7CiAgICB9CgogICAgLyoqCiAgICAgKiBIYW5kbGUgdGhlIGdp\ndmVuIGV4Y2VwdGlvbiwgbG9nZ2luZyBpdCBhbmQgb3B0aW9uYWxseSBpZ25v\ncmluZyBpdCwKICAgICAqIGRlcGVuZGluZyBvbiB0aGUgZmxhZ3MgdGhpcyBT\nY2hlbWFUb29sIHdhcyBjcmVhdGVkIHdpdGguCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBoYW5kbGVFeGNlcHRpb24oU1FMRXhjZXB0aW9uIHNxbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIV9pZ25v\ncmVFcnJzKQogICAgICAgICAgICB0aHJvdyBzcWw7CiAgICAgICAgX2xvZy53\nYXJuKHNxbC5nZXRNZXNzYWdlKCksIHNxbCk7CiAgICB9CgogICAgLy8vLy8v\nLy8KICAgIC8vIE1haW4KICAgIC8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBV\nc2FnZTogamF2YSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2No\nZW1hVG9vbCBbb3B0aW9uXSoKICAgICAqIFstYWN0aW9uLy1hICZsdDthZGQg\nfCByZXRhaW4gfCBkcm9wIHwgcmVmcmVzaCB8IGNyZWF0ZURCIHwgZHJvcERC\nCiAgICAgKiB8IGJ1aWxkIHwgcmVmbGVjdCB8IGltcG9ydCB8IGV4cG9ydCZn\ndDtdCiAgICAgKiAmbHQ7LnNjaGVtYSBmaWxlIG9yIHJlc291cmNlJmd0OyoK\nICAgICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJlY29n\nbml6ZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3BlcnRpZXMv\nLXAgJmx0O3Byb3BlcnRpZXMgZmlsZSBvciByZXNvdXJjZSZndDs8L2k+OiBU\naGUKICAgICAqIHBhdGggb3IgcmVzb3VyY2UgbmFtZSBvZiBhIE9wZW5KUEEg\ncHJvcGVydGllcyBmaWxlIGNvbnRhaW5pbmcKICAgICAqIGluZm9ybWF0aW9u\nIHN1Y2ggYXMgdGhlIGxpY2Vuc2Uga2V5CWFuZCBjb25uZWN0aW9uIGRhdGEg\nYXMKICAgICAqIG91dGxpbmVkIGluIHtAbGluayBKREJDQ29uZmlndXJhdGlv\nbn0uIE9wdGlvbmFsLjwvbGk+CiAgICAgKiA8bGk+PGk+LSZsdDtwcm9wZXJ0\neSBuYW1lJmd0OyAmbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7PC9pPjogQWxsIGJl\nYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIE9wZW5KUEEge0BsaW5rIEpE\nQkNDb25maWd1cmF0aW9ufSBjYW4gYmUgc2V0IGJ5CiAgICAgKiB1c2luZyB0\naGVpcgluYW1lcyBhbmQgc3VwcGx5aW5nIGEgdmFsdWUuIEZvciBleGFtcGxl\nOgogICAgICogPGNvZGU+LWxpY2Vuc2VLZXkgYWRzbGZqYTgzcjNsa2FkZjwv\nY29kZT48L2xpPgogICAgICogPGxpPjxpPi1pZ25vcmVFcnJvcnMvLWkgJmx0\nO3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogSWYgZmFsc2UsIGFuCiAgICAg\nKiBleGNlcHRpb24gd2lsbCB3aWxsIGJlIHRocm93biBpZiB0aGUgdG9vbCBl\nbmNvdW50ZXJzIGFueSBkYXRhYmFzZQogICAgICogZXhjZXB0aW9uczsgZGVm\nYXVsdHMgdG8gPGNvZGU+ZmFsc2U8L2NvZGU+LjwvbGk+CiAgICAgKiA8bGk+\nPGk+LWZpbGUvLWYgJmx0O3N0ZG91dCB8IG91dHB1dCBmaWxlIG9yIHJlc291\ncmNlJmd0OzwvaT46IFVzZSB0aGlzCiAgICAgKiBvcHRpb24gdG8gd3JpdGUg\nYSBTUUwgc2NyaXB0IGZvciB0aGUgcGxhbm5lZCBzY2hlbWEgbW9kaWZpY2F0\naW9ucywKICAgICAqIHJhdGhlciB0aGFuIGNvbW1pdHRpbmcgdGhlbSB0byB0\naGUgZGF0YWJhc2UuIFRoaXMgb3B0aW9uIGFsc28KICAgICAqIGFwcGxpZXMg\ndG8gdGhlIDxjb2RlPmV4cG9ydDwvY29kZT4gYW5kIDxjb2RlPnJlZmxlY3Q8\nL2NvZGU+IGFjdGlvbnMuPC9saT4KICAgICAqIDxsaT48aT4tb3BlbmpwYVRh\nYmxlcy8ta3QgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogVW5kZXIg\ndGhlCiAgICAgKiA8Y29kZT5yZWZsZWN0PC9jb2RlPiBhY3Rpb24sIHdoZXRo\nZXIgdG8gcmVmbGVjdCBvbiB0YWJsZXMgd2l0aAogICAgICogdGhlIG5hbWUg\nPGNvZGU+T1BFTkpQQV8qPC9jb2RlPi4gVW5kZXIgb3RoZXIgYWN0aW9ucywg\nd2hldGhlciB0bwogICAgICogZHJvcCBzdWNoIHRhYmxlcy4gRGVmYXVsdHMg\ndG8gPGNvZGU+ZmFsc2U8L2NvZGU+LjwvbGk+CiAgICAgKiA8bGk+PGk+LWRy\nb3BUYWJsZXMvLWR0ICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFNl\ndCB0aGlzIG9wdGlvbiB0bwogICAgICogdHJ1ZSB0byBkcm9wIHRhYmxlcyB0\naGF0IGFwcGVhciB0byBiZSB1bnVzZWQgZHVyaW5nCiAgICAgKiA8Y29kZT5y\nZXRhaW48L2NvZGU+CWFuZCA8Y29kZT5yZWZyZXNoPC9jb2RlPiBhY3Rpb25z\nLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+dHJ1ZTwvY29kZT4uPC9saT4K\nICAgICAqIDxsaT48aT4tZHJvcFNlcXVlbmNlcy8tZHNxICZsdDt0cnVlL3Qg\nfCBmYWxzZS9mJmd0OzwvaT46IFNldCB0aGlzIG9wdGlvbgogICAgICogdG8g\ndHJ1ZSB0byBkcm9wIHNlcXVlbmNlcyB0aGF0IGFwcGVhciB0byBiZSB1bnVz\nZWQgZHVyaW5nCiAgICAgKiA8Y29kZT5yZXRhaW48L2NvZGU+CWFuZCA8Y29k\nZT5yZWZyZXNoPC9jb2RlPiBhY3Rpb25zLiBEZWZhdWx0cyB0bwogICAgICog\nPGNvZGU+dHJ1ZTwvY29kZT4uPC9saT4KICAgICAqIDxsaT48aT4tcHJpbWFy\neUtleXMvLXBrICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFdoZXRo\nZXIgcHJpbWFyeQogICAgICoga2V5cyBvbiBleGlzdGluZyB0YWJsZXMgYXJl\nIG1hbmlwdWxhdGVkLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAgICAgKiA8\nbGk+PGk+LWZvcmVpZ25LZXlzLy1mayAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZn\ndDs8L2k+OiBXaGV0aGVyIGZvcmVpZ24KICAgICAqIGtleXMgb24gZXhpc3Rp\nbmcgdGFibGVzIGFyZSBtYW5pcHVsYXRlZC4gRGVmYXVsdHMgdG8gdHJ1ZS48\nL2xpPgogICAgICogPGxpPjxpPi1pbmRleGVzLy1peCAmbHQ7dHJ1ZS90IHwg\nZmFsc2UvZiZndDs8L2k+OiBXaGV0aGVyIGluZGV4ZXMKICAgICAqIG9uIGV4\naXN0aW5nIHRhYmxlcyBhcmUgbWFuaXB1bGF0ZWQuIERlZmF1bHRzIHRvIHRy\ndWUuPC9saT4KICAgICAqIDxsaT48aT4tc2VxdWVuY2VzLy1zcSAmbHQ7dHJ1\nZS90IHwgZmFsc2UvZiZndDs8L2k+OiBXaGV0aGVyIHRvCiAgICAgKiBtYW5p\ncHVsYXRlIHNlcXVlbmNlcy4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgogICAg\nICogPGxpPjxpPi1yZWNvcmQvLXIgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7\nPC9pPjogU2V0IHRoaXMgb3B0aW9uIHRvCiAgICAgKiA8Y29kZT5mYWxzZTwv\nY29kZT4gdG8gcHJldmVudCB3cml0aW5nIHRoZSBzY2hlbWEgY2hhbmdlcyB0\nbyB0aGUKICAgICAqIGN1cnJlbnQge0BsaW5rIFNjaGVtYUZhY3Rvcnl9Ljwv\nbGk+CiAgICAgKiA8L3VsPgogICAgICogIFRoZSB2YXJpb3VzIGFjdGlvbnMg\nYXJlIGFzIGZvbGxvd3MuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+YWRk\nPC9pPjogQnJpbmcgdGhlIHNjaGVtYSB1cC10by1kYXRlIHdpdGggdGhlIGxh\ndGVzdAogICAgICogY2hhbmdlcyB0byB0aGUgc2NoZW1hIFhNTCBkYXRhIGJ5\nIGFkZGluZyB0YWJsZXMsIGNvbHVtbnMsCiAgICAgKiBpbmRleGVzLCBldGMu\nIFRoaXMgYWN0aW9uIG5ldmVyIGRyb3BzIGFueSBkYXRhLiBUaGlzIGlzIHRo\nZQogICAgICogZGVmYXVsdCBhY3Rpb24uPC9saT4KICAgICAqIDxsaT48aT5y\nZXRhaW48L2k+OiBLZWVwIGFsbCBzY2hlbWEgY29tcG9uZW50cyBpbiB0aGUg\nc2NoZW1hIFhNTCwgYnV0CiAgICAgKiBkcm9wIHRoZSByZXN0IGZyb20gdGhl\nIGRhdGFiYXNlLiBUaGlzIGFjdGlvbiBuZXZlciBhZGRzIGFueSBkYXRhLjwv\nbGk+CiAgICAgKiA8bGk+PGk+ZHJvcDwvaT46IERyb3AgYWxsIHRoZSBzY2hl\nbWEgY29tcG9uZW50cyBpbiB0aGUgc2NoZW1hIFhNTC48L2xpPgogICAgICog\nPGxpPjxpPnJlZnJlc2g8L2k+OiBFcXVpdmFsZW50IHRvIHJldGFpbiwgdGhl\nbiBhZGQuPC9saT4KICAgICAqIDxsaT48aT5jcmVhdGVEQjwvaT46IEV4ZWN1\ndGUgU1FMIHRvIHJlLWNyZWF0ZSB0aGUgY3VycmVudCBkYXRhYmFzZS4KICAg\nICAqIFRoaXMgYWN0aW9uIGlzIHR5cGljYWxseSB1c2VkIGluIGNvbmp1Y3Rp\nb24gd2l0aCB0aGUKICAgICAqIDxjb2RlPmZpbGU8L2NvZGU+IG9wdGlvbi48\nL2xpPgogICAgICogPGxpPjxpPmJ1aWxkPC9pPjogRXhlY3V0ZSBTUUwgdG8g\nYnVpbGQgdGhlIHNjaGVtYSBkZWZpbmVkIGluIHRoZSBYTUwuCiAgICAgKiBC\nZWNhdXNlIGl0IGRvZXNuJ3QgdGFrZSB0aGUgY3VycmVudCBkYXRhYmFzZSBz\nY2hlbWEgaW50byBhY2NvdW50LAogICAgICogdGhpcyBhY3Rpb24gaXMgdHlw\naWNhbGx5IHVzZWQgaW4gY29uanVjdGlvbiB3aXRoIHRoZQogICAgICogPGNv\nZGU+ZmlsZTwvY29kZT4gb3B0aW9uLjwvbGk+CiAgICAgKiA8bGk+PGk+cmVm\nbGVjdDwvaT46IFJlZmxlY3Qgb24gdGhlIGN1cnJlbnQgZGF0YWJhc2Ugc2No\nZW1hLiBXcml0ZSB0aGUKICAgICAqIHNjaGVtYSdzIFhNTCByZXByZXNlbnRh\ndGlvbiB0byB0aGUgZmlsZSBzcGVjaWZpZWQgd2l0aCB0aGUKICAgICAqIDxj\nb2RlPmZpbGU8L2NvZGU+IG9wdGlvbiwgb3IgdG8gc3Rkb3V0IGlmIG5vIGZp\nbGUgaXMgZ2l2ZW4uPC9saT4KICAgICAqIDxsaT48aT5kcm9wREI8L2k+OiBF\neGVjdXRlIFNRTCB0byBkcm9wIHRoZSBjdXJyZW50IGRhdGFiYXNlLiBUaGlz\nCiAgICAgKiBhY3Rpb24gaW1wbGllcyA8Y29kZT5kcm9wVGFibGVzPC9jb2Rl\nPi48L2xpPgogICAgICogPGxpPjxpPmltcG9ydDwvaT46IEltcG9ydCB0aGUg\nZ2l2ZW4gWE1MIHNjaGVtYSBkZWZpbml0aW9uIGludG8gdGhlCiAgICAgKiBj\ndXJyZW50IHtAbGluayBTY2hlbWFGYWN0b3J5fS48L2xpPgogICAgICogPGxp\nPjxpPmV4cG9ydDwvaT46IEV4cG9ydCB0aGUgY3VycmVudCB7QGxpbmsgU2No\nZW1hRmFjdG9yeX0ncyByZWNvcmRlZAogICAgICogc2NoZW1hIHRvIGFuIFhN\nTCBzY2hlbWEgZGVmaW5pdGlvbiBmaWxlLjwvbGk+CiAgICAgKiA8L3VsPgog\nICAgICogIEV4YW1wbGVzOgogICAgICogPHVsPgogICAgICogPGxpPldyaXRl\nIGEgc2NyaXB0IHRvIHN0ZG91dCB0byByZS1jcmVhdGUgdGhlIGN1cnJlbnQg\nZGF0YWJhc2UKICAgICAqIHNjaGVtYTo8YnIgLz4KICAgICAqIDxjb2RlPmph\ndmEgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2wg\nLWYgc3Rkb3V0IAogICAgICogLWEgY3JlYXRlREI8L2NvZGU+PC9saT4KICAg\nICAqIDxsaT5Ecm9wIHRoZSBjdXJyZW50IGRhdGFiYXNlIHNjaGVtYTo8YnIg\nLz4KICAgICAqIDxjb2RlPmphdmEgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLlNjaGVtYVRvb2wgCiAgICAgKiAtYSBkcm9wREI8L2NvZGU+PC9s\naT4KICAgICAqIDxsaT5DcmVhdGUgYSBzY2hlbWEgYmFzZWQgb24gYW4gWE1M\nIHNjaGVtYSBkZWZpbml0aW9uIGZpbGU6PGJyIC8+CiAgICAgKiA8Y29kZT5q\nYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFUb29s\nIAogICAgICogbXlzY2hlbWEueG1sPC9jb2RlPjwvbGk+CiAgICAgKiA8L3Vs\nPgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdb\nXSBhcmdzKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwog\nICAgICAgIGFyZ3MgPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwogICAg\nICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgSkRCQ0NvbmZpZ3Vy\nYXRpb25JbXBsKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFy\ndW4oY29uZiwgYXJncywgb3B0cykpCiAgICAgICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oX2xvYy5nZXQoInRvb2wtdXNhZ2UiKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJu\ncyBmYWxzZSBpZiBhbnkgaW52YWxpZCBvcHRpb25zIHdlcmUgZ2l2ZW4uCiAg\nICAgKgogICAgICogQHNlZSAjbWFpbgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGJvb2xlYW4gcnVuKEpEQkNDb25maWd1cmF0aW9uIGNvbmYsIFN0cmlu\nZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRzKQogICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAob3B0\ncy5jb250YWluc0tleSgiaGVscCIpIHx8IG9wdHMuY29udGFpbnNLZXkoIi1o\nZWxwIikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgRmxh\nZ3MgZmxhZ3MgPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kcm9wVGFi\nbGVzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAg\nKCJkcm9wVGFibGVzIiwgImR0IiwgZmxhZ3MuZHJvcFRhYmxlcyk7CiAgICAg\nICAgZmxhZ3MuZHJvcFNlcXVlbmNlcyA9IG9wdHMucmVtb3ZlQm9vbGVhblBy\nb3BlcnR5CiAgICAgICAgICAgICgiZHJvcFNlcXVlbmNlcyIsICJkc3EiLCBm\nbGFncy5kcm9wU2VxdWVuY2VzKTsKICAgICAgICBmbGFncy5pZ25vcmVFcnJv\ncnMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAo\nImlnbm9yZUVycm9ycyIsICJpIiwgZmxhZ3MuaWdub3JlRXJyb3JzKTsKICAg\nICAgICBmbGFncy5vcGVuanBhVGFibGVzID0gb3B0cy5yZW1vdmVCb29sZWFu\nUHJvcGVydHkKICAgICAgICAgICAgKCJvcGVuanBhVGFibGVzIiwgIm90Iiwg\nZmxhZ3Mub3BlbmpwYVRhYmxlcyk7CiAgICAgICAgZmxhZ3MucHJpbWFyeUtl\neXMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAo\nInByaW1hcnlLZXlzIiwgInBrIiwgZmxhZ3MucHJpbWFyeUtleXMpOwogICAg\nICAgIGZsYWdzLmZvcmVpZ25LZXlzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJv\ncGVydHkKICAgICAgICAgICAgKCJmb3JlaWduS2V5cyIsICJma3MiLCBmbGFn\ncy5mb3JlaWduS2V5cyk7CiAgICAgICAgZmxhZ3MuaW5kZXhlcyA9IG9wdHMu\ncmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiaW5kZXhlcyIs\nICJpeCIsIGZsYWdzLmluZGV4ZXMpOwogICAgICAgIGZsYWdzLnNlcXVlbmNl\ncyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgi\nc2VxdWVuY2VzIiwgInNxIiwgZmxhZ3Muc2VxdWVuY2VzKTsKICAgICAgICBm\nbGFncy5yZWNvcmQgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eSgicmVj\nb3JkIiwgInIiLCBmbGFncy5yZWNvcmQpOwogICAgICAgIGZsYWdzLmFjdGlv\nbiA9IG9wdHMucmVtb3ZlUHJvcGVydHkoImFjdGlvbiIsICJhIiwgZmxhZ3Mu\nYWN0aW9uKTsKICAgICAgICBTdHJpbmcgZmlsZU5hbWUgPSBvcHRzLnJlbW92\nZVByb3BlcnR5KCJmaWxlIiwgImYiLCBudWxsKTsKICAgICAgICBTdHJpbmcg\nc2NoZW1hcyA9IG9wdHMucmVtb3ZlUHJvcGVydHkoInMiKTsKICAgICAgICBp\nZiAoc2NoZW1hcyAhPSBudWxsKQogICAgICAgICAgICBvcHRzLnNldFByb3Bl\ncnR5KCJzY2hlbWFzIiwgc2NoZW1hcyk7CgogICAgICAgIC8vIHNldHVwIGEg\nY29uZmlndXJhdGlvbiBpbnN0YW5jZSB3aXRoIGNtZC1saW5lIGluZm8KICAg\nICAgICBDb25maWd1cmF0aW9ucy5wb3B1bGF0ZUNvbmZpZ3VyYXRpb24oY29u\nZiwgb3B0cyk7CgogICAgICAgIC8vIGNyZWF0ZSBzY3JpcHQgd3JpdGVyCiAg\nICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gY29uZi5nZXRDbGFzc1Jlc29s\ndmVySW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoU2No\nZW1hVG9vbC5jbGFzcywgbnVsbCk7CiAgICAgICAgZmxhZ3Mud3JpdGVyID0g\nRmlsZXMuZ2V0V3JpdGVyKGZpbGVOYW1lLCBsb2FkZXIpOwoKICAgICAgICBy\nZXR1cm4gcnVuKGNvbmYsIGFyZ3MsIGZsYWdzLCBsb2FkZXIpOwogICAgfQoK\nICAgIC8qKgogICAgICogUnVuIHRoZSB0b29sLiBSZXR1cm4gZmFsc2UgaWYg\naW52YWxpZCBvcHRpb25zIHdlcmUgZ2l2ZW4uCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgYm9vbGVhbiBydW4oSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwg\nU3RyaW5nW10gYXJncywKICAgICAgICBGbGFncyBmbGFncywgQ2xhc3NMb2Fk\nZXIgbG9hZGVyKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24uTE9HX1RPT0wpOwogICAgICAgIGlmIChBQ1RJT05f\nUkVGTEVDVC5lcXVhbHMoZmxhZ3MuYWN0aW9uKSkgewogICAgICAgICAgICBp\nZiAoYXJncy5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICBpZiAoZmxhZ3Mud3JpdGVyID09IG51bGwpCiAg\nICAgICAgICAgICAgICBmbGFncy53cml0ZXIgPSBuZXcgUHJpbnRXcml0ZXIo\nU3lzdGVtLm91dCk7CgogICAgICAgICAgICBTY2hlbWFHZW5lcmF0b3IgZ2Vu\nID0gbmV3IFNjaGVtYUdlbmVyYXRvcihjb25mKTsKICAgICAgICAgICAgZ2Vu\nLnNldFByaW1hcnlLZXlzKGZsYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICAg\nICAgZ2VuLnNldEluZGV4ZXMoZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgICAg\nIGdlbi5zZXRGb3JlaWduS2V5cyhmbGFncy5mb3JlaWduS2V5cyk7CiAgICAg\nICAgICAgIGdlbi5zZXRTZXF1ZW5jZXMoZmxhZ3Muc2VxdWVuY2VzKTsKICAg\nICAgICAgICAgZ2VuLnNldE9wZW5KUEFUYWJsZXMoZmxhZ3Mub3BlbmpwYVRh\nYmxlcyk7CgogICAgICAgICAgICBTdHJpbmcgc2NoZW1hcyA9IGNvbmYuZ2V0\nU2NoZW1hcygpOwogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShzY2hlbWFzKSkKICAgICAgICAgICAgICAgIHNjaGVtYXMgPSAiYWxsIjsK\nICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInNjaC1yZWZsZWN0Iiwg\nc2NoZW1hcykpOwogICAgICAgICAgICBnZW4uZ2VuZXJhdGVTY2hlbWFzKCk7\nCgogICAgICAgICAgICAvLyByZWNvcmQgdGhlIHNjaGVtYQogICAgICAgICAg\nICBsb2cuaW5mbyhfbG9jLmdldCgic2NoLXJlZmxlY3Qtd3JpdGUiKSk7CiAg\nICAgICAgICAgIFNjaGVtYVNlcmlhbGl6ZXIgc2VyID0gbmV3IFhNTFNjaGVt\nYVNlcmlhbGl6ZXIoY29uZik7CiAgICAgICAgICAgIHNlci5hZGRBbGwoZ2Vu\nLmdldFNjaGVtYUdyb3VwKCkpOwogICAgICAgICAgICBzZXIuc2VyaWFsaXpl\nKGZsYWdzLndyaXRlciwgc2VyLlBSRVRUWSk7CiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09\nIDAKICAgICAgICAgICAgJiYgIUFDVElPTl9DUkVBVEVEQi5lcXVhbHMoZmxh\nZ3MuYWN0aW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0RST1BEQi5lcXVh\nbHMoZmxhZ3MuYWN0aW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0VYUE9S\nVC5lcXVhbHMoZmxhZ3MuYWN0aW9uKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICAvLyBwYXJzZSBpbiB0aGUgYXJndW1lbnRzCiAgICAg\nICAgU2NoZW1hUGFyc2VyIHBhcnNlciA9IG5ldyBYTUxTY2hlbWFQYXJzZXIo\nY29uZik7CiAgICAgICAgcGFyc2VyLnNldERlbGF5Q29uc3RyYWludFJlc29s\ndmUodHJ1ZSk7CiAgICAgICAgRmlsZSBmaWxlOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBm\naWxlID0gRmlsZXMuZ2V0RmlsZShhcmdzW2ldLCBsb2FkZXIpOwogICAgICAg\nICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9vbC1ydW5uaW5nIiwgZmlsZSkp\nOwogICAgICAgICAgICBwYXJzZXIucGFyc2UoZmlsZSk7CiAgICAgICAgfQog\nICAgICAgIHBhcnNlci5yZXNvbHZlQ29uc3RyYWludHMoKTsKCiAgICAgICAg\naWYgKEFDVElPTl9JTVBPUlQuZXF1YWxzKGZsYWdzLmFjdGlvbikpIHsKICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtaW1wb3J0LXN0b3Jl\nIikpOwogICAgICAgICAgICBTY2hlbWFHcm91cCBzY2hlbWEgPSBwYXJzZXIu\nZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICAgICAgY29uZi5nZXRTY2hlbWFG\nYWN0b3J5SW5zdGFuY2UoKS5zdG9yZVNjaGVtYShzY2hlbWEpOwogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKEFDVElP\nTl9FWFBPUlQuZXF1YWxzKGZsYWdzLmFjdGlvbikpIHsKICAgICAgICAgICAg\naWYgKGZsYWdzLndyaXRlciA9PSBudWxsKQogICAgICAgICAgICAgICAgZmxh\nZ3Mud3JpdGVyID0gbmV3IFByaW50V3JpdGVyKFN5c3RlbS5vdXQpOwoKICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtZXhwb3J0LWdlbiIp\nKTsKICAgICAgICAgICAgU2NoZW1hR3JvdXAgc2NoZW1hID0gY29uZi5nZXRT\nY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5yZWFkU2NoZW1hKCk7CgogICAgICAg\nICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9vbC1leHBvcnQtd3JpdGUiKSk7\nCiAgICAgICAgICAgIFNjaGVtYVNlcmlhbGl6ZXIgc2VyID0gbmV3IFhNTFNj\naGVtYVNlcmlhbGl6ZXIoY29uZik7CiAgICAgICAgICAgIHNlci5hZGRBbGwo\nc2NoZW1hKTsKICAgICAgICAgICAgc2VyLnNlcmlhbGl6ZShmbGFncy53cml0\nZXIsIHNlci5QUkVUVFkpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICB9CgogICAgICAgIFNjaGVtYVRvb2wgdG9vbCA9IG5ldyBTY2hlbWFU\nb29sKGNvbmYsIGZsYWdzLmFjdGlvbik7CiAgICAgICAgdG9vbC5zZXRJZ25v\ncmVFcnJvcnMoZmxhZ3MuaWdub3JlRXJyb3JzKTsKICAgICAgICB0b29sLnNl\ndERyb3BUYWJsZXMoZmxhZ3MuZHJvcFRhYmxlcyk7CiAgICAgICAgdG9vbC5z\nZXRTZXF1ZW5jZXMoZmxhZ3Muc2VxdWVuY2VzKTsgLy8gc2V0IGJlZm9yZSBk\ncm9wc2VxcwogICAgICAgIHRvb2wuc2V0RHJvcFNlcXVlbmNlcyhmbGFncy5k\ncm9wU2VxdWVuY2VzKTsKICAgICAgICB0b29sLnNldFByaW1hcnlLZXlzKGZs\nYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICB0b29sLnNldEZvcmVpZ25LZXlz\nKGZsYWdzLmZvcmVpZ25LZXlzKTsKICAgICAgICB0b29sLnNldEluZGV4ZXMo\nZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgdG9vbC5zZXRPcGVuSlBBVGFibGVz\nKGZsYWdzLm9wZW5qcGFUYWJsZXMpOwogICAgICAgIGlmIChhcmdzLmxlbmd0\naCA+IDApCiAgICAgICAgICAgIHRvb2wuc2V0U2NoZW1hR3JvdXAocGFyc2Vy\nLmdldFNjaGVtYUdyb3VwKCkpOwogICAgICAgIGlmIChmbGFncy53cml0ZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgdG9vbC5zZXRXcml0ZXIoZmxhZ3Mud3Jp\ndGVyKTsKCiAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInRvb2wtYWN0aW9u\nIiwgZmxhZ3MuYWN0aW9uKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ndG9vbC5ydW4oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAoZmxhZ3MucmVjb3JkKSB7CiAgICAgICAgICAgICAgICBsb2cuaW5mbyhf\nbG9jLmdldCgidG9vbC1yZWNvcmQiKSk7CiAgICAgICAgICAgICAgICB0b29s\nLnJlY29yZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlm\nIChmbGFncy53cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgZmxhZ3Mud3Jp\ndGVyLmZsdXNoKCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIC8qKgogICAgICogUnVuIGZsYWdzLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGNsYXNzIEZsYWdzIHsKCiAgICAgICAgcHVibGljIFN0cmluZyBhY3Rp\nb24gPSBBQ1RJT05fQUREOwogICAgICAgIHB1YmxpYyBXcml0ZXIgd3JpdGVy\nID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBkcm9wVGFibGVzID0g\ndHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBkcm9wU2VxdWVuY2VzID0g\ndHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpZ25vcmVFcnJvcnMgPSBm\nYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBvcGVuanBhVGFibGVzID0g\nZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xlYW4gcHJpbWFyeUtleXMgPSB0\ncnVlOwogICAgICAgIHB1YmxpYyBib29sZWFuIGZvcmVpZ25LZXlzID0gdHJ1\nZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpbmRleGVzID0gdHJ1ZTsKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBzZXF1ZW5jZXMgPSB0cnVlOwogICAgICAg\nIHB1YmxpYyBib29sZWFuIHJlY29yZCA9IHRydWU7CiAgICB9Cn0K\n","encoding":"base64"}

