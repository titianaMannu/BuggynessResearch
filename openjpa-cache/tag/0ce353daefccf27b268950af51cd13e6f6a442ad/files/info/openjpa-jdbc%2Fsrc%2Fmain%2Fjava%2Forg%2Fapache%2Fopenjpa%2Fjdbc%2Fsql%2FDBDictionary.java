{"sha":"aa401c0748315af768f8aac200d0fdc4d49ece77","node_id":"MDQ6QmxvYjIwNjM2NDphYTQwMWMwNzQ4MzE1YWY3NjhmOGFhYzIwMGQwZmRjNGQ0OWVjZTc3","size":134752,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/aa401c0748315af768f8aac200d0fdc4d49ece77","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbDsKCmltcG9ydCBqYXZhLmlvLkJ1ZmZlcmVkUmVh\nZGVyOwppbXBvcnQgamF2YS5pby5CeXRlQXJyYXlJbnB1dFN0cmVhbTsKaW1w\nb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLklucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcjsKaW1w\nb3J0IGphdmEuaW8uUmVhZGVyOwppbXBvcnQgamF2YS5pby5TdHJpbmdSZWFk\nZXI7CmltcG9ydCBqYXZhLmlvLldyaXRlcjsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lkludm9jYXRpb25UYXJnZXRFeGNlcHRpb247CmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLm1hdGguQmlnRGVj\naW1hbDsKaW1wb3J0IGphdmEubWF0aC5CaWdJbnRlZ2VyOwppbXBvcnQgamF2\nYS5zcWwuQXJyYXk7CmltcG9ydCBqYXZhLnNxbC5CbG9iOwppbXBvcnQgamF2\nYS5zcWwuQ2xvYjsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9y\ndCBqYXZhLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwu\nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZWY7CmltcG9y\ndCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNl\ncHRpb247CmltcG9ydCBqYXZhLnNxbC5TUUxXYXJuaW5nOwppbXBvcnQgamF2\nYS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuVGltZTsKaW1wb3J0\nIGphdmEuc3FsLlRpbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwpp\nbXBvcnQgamF2YS50ZXh0Lk1lc3NhZ2VGb3JtYXQ7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0\nIGphdmEudXRpbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2\nYS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7\nCmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YXguc3FsLkRhdGFT\nb3VyY2U7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5n\nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpE\nQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhwQ29udGV4\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkV4cFN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2Vy\nbmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5WYWw7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFTb3VyY2VG\nYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuTmFtZVNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlvbkRlY29yYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5Mb2dnaW5n\nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5SZWZlcmVudGlhbEludGVncml0eUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlNlcmlhbGl6YXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9y\ndGVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nVXNlckV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBv\ncnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQ2xhc3Mgd2hpY2ggYWxs\nb3dzIHRoZSBjcmVhdGlvbiBvZiBTUUwgZHluYW1pY2FsbHksIGluIGEKICog\nZGF0YWJhc2UgYWdub3N0aWMgZmFzaGlvbi4gU3ViY2xhc3MgZm9yIHRoZSBu\ndWFuY2VzIG9mIGRpZmZlcmVudCBkYXRhIHN0b3Jlcy4KICovCnB1YmxpYyBj\nbGFzcyBEQkRpY3Rpb25hcnkKICAgIGltcGxlbWVudHMgQ29uZmlndXJhYmxl\nLCBDb25uZWN0aW9uRGVjb3JhdG9yLCBKb2luU3ludGF4ZXMsCiAgICBMb2dn\naW5nQ29ubmVjdGlvbkRlY29yYXRvci5TUUxXYXJuaW5nSGFuZGxlciB7Cgog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVkVORE9SX09USEVSID0g\nIm90aGVyIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFZFTkRP\nUl9EQVRBRElSRUNUID0gImRhdGFkaXJlY3QiOwoKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIFNDSEVNQV9DQVNFX1VQUEVSID0gInVwcGVyIjsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNDSEVNQV9DQVNFX0xP\nV0VSID0gImxvd2VyIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5n\nIFNDSEVNQV9DQVNFX1BSRVNFUlZFID0gInByZXNlcnZlIjsKCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIFN0cmluZyBDT05TX05BTUVfQkVGT1JFID0gImJl\nZm9yZSI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBDT05TX05B\nTUVfTUlEID0gIm1pZCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmlu\nZyBDT05TX05BTUVfQUZURVIgPSAiYWZ0ZXIiOwoKICAgIHByb3RlY3RlZCBz\ndGF0aWMgZmluYWwgaW50IFJBTkdFX1BPU1RfU0VMRUNUID0gMDsKICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BSRV9ESVNUSU5DVCA9\nIDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9QT1NU\nX0RJU1RJTkNUID0gMjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50\nIFJBTkdFX1BPU1RfTE9DSyA9IDM7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgTkFOTyA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBNSUNSTyA9IE5BTk8gKiAxMDAwOwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBmaW5hbCBpbnQgTUlMTEkgPSBNSUNSTyAqIDEwMDA7CiAgICBwcm90ZWN0\nZWQgc3RhdGljIGZpbmFsIGludCBDRU5USSA9IE1JTExJICogMTA7CiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBERUNJID0gTUlMTEkgKiAxMDA7\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBTRUMgPSBNSUxMSSAq\nIDEwMDA7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFNRV9B\nTlkgPSAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFNRV9U\nQUJMRSA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBOQU1F\nX1NFUVVFTkNFID0gMjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgWkVST19EQVRFX1NUUiA9CiAgICAgICAgIiciICsgbmV3IGphdmEuc3Fs\nLkRhdGUoMCkgKyAiJyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgWkVST19USU1FX1NUUiA9ICInIiArIG5ldyBUaW1lKDApICsgIiciOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFpFUk9fVElNRVNUQU1Q\nX1NUUiA9CiAgICAgICAgIiciICsgbmV3IFRpbWVzdGFtcCgwKSArICInIjsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKERCRGljdGlvbmFyeS5jbGFz\ncyk7CgogICAgLy8gc2NoZW1hIGRhdGEKICAgIHB1YmxpYyBTdHJpbmcgcGxh\ndGZvcm0gPSAiR2VuZXJpYyI7CiAgICBwdWJsaWMgU3RyaW5nIGRyaXZlclZl\nbmRvciA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIGNhdGFsb2dTZXBhcmF0\nb3IgPSAiLiI7CiAgICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVQcmltYXJ5S2V5\ncyA9IHRydWU7CiAgICBwdWJsaWMgU3RyaW5nIGNvbnN0cmFpbnROYW1lTW9k\nZSA9IENPTlNfTkFNRV9CRUZPUkU7CiAgICBwdWJsaWMgaW50IG1heFRhYmxl\nTmFtZUxlbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQgbWF4Q29sdW1uTmFt\nZUxlbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQgbWF4Q29uc3RyYWludE5h\nbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heEluZGV4TmFtZUxl\nbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQgbWF4SW5kZXhlc1BlclRhYmxl\nID0gSW50ZWdlci5NQVhfVkFMVUU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0ZvcmVpZ25LZXlzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzVGltZXN0YW1wTmFub3MgPSB0cnVlOwogICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50cyA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSZXN0cmljdERlbGV0ZUFj\ndGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0Nhc2Nh\nZGVEZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNOdWxsRGVsZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzRGVmYXVsdERlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3RyaWN0VXBkYXRlQWN0aW9uID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQ2FzY2FkZVVwZGF0\nZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051\nbGxVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNEZWZhdWx0VXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhBZGRDb2x1bW4gPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aERy\nb3BDb2x1bW4gPSB0cnVlOwogICAgcHVibGljIFN0cmluZyByZXNlcnZlZFdv\ncmRzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtU2NoZW1hcyA9\nIG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIHN5c3RlbVRhYmxlcyA9IG51bGw7\nCiAgICBwdWJsaWMgU3RyaW5nIGZpeGVkU2l6ZVR5cGVOYW1lcyA9IG51bGw7\nCiAgICBwdWJsaWMgU3RyaW5nIHNjaGVtYUNhc2UgPSBTQ0hFTUFfQ0FTRV9V\nUFBFUjsKCiAgICAvLyBzcWwKICAgIHB1YmxpYyBTdHJpbmcgdmFsaWRhdGlv\nblNRTCA9IG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIGNsb3NlUG9vbFNRTCA9\nIG51bGw7CiAgICBwdWJsaWMgU3RyaW5nIGluaXRpYWxpemF0aW9uU1FMID0g\nbnVsbDsKICAgIHB1YmxpYyBpbnQgam9pblN5bnRheCA9IFNZTlRBWF9TUUw5\nMjsKICAgIHB1YmxpYyBTdHJpbmcgb3V0ZXJKb2luQ2xhdXNlID0gIkxFRlQg\nT1VURVIgSk9JTiI7CiAgICBwdWJsaWMgU3RyaW5nIGlubmVySm9pbkNsYXVz\nZSA9ICJJTk5FUiBKT0lOIjsKICAgIHB1YmxpYyBTdHJpbmcgY3Jvc3NKb2lu\nQ2xhdXNlID0gIkNST1NTIEpPSU4iOwogICAgcHVibGljIGJvb2xlYW4gcmVx\ndWlyZXNDb25kaXRpb25Gb3JDcm9zc0pvaW4gPSBmYWxzZTsKICAgIHB1Ymxp\nYyBTdHJpbmcgZm9yVXBkYXRlQ2xhdXNlID0gIkZPUiBVUERBVEUiOwogICAg\ncHVibGljIFN0cmluZyB0YWJsZUZvclVwZGF0ZUNsYXVzZSA9IG51bGw7CiAg\nICBwdWJsaWMgU3RyaW5nIGRpc3RpbmN0Q291bnRDb2x1bW5TZXBhcmF0b3Ig\nPSBudWxsOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTZWxlY3RGb3JV\ncGRhdGUgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2Nr\naW5nV2l0aERpc3RpbmN0Q2xhdXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcyA9IHRydWU7\nCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoT3JkZXJD\nbGF1c2UgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2Nr\naW5nV2l0aE91dGVySm9pbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0xvY2tpbmdXaXRoSW5uZXJKb2luID0gdHJ1ZTsKICAgIHB1Ymxp\nYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhTZWxlY3RSYW5nZSA9IHRy\ndWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1F1ZXJ5VGltZW91dCA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzaW11bGF0ZUxvY2tpbmcgPSBm\nYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU3Vic2VsZWN0ID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQ29ycmVsYXRlZFN1\nYnNlbGVjdCA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0hh\ndmluZyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1NlbGVj\ndFN0YXJ0SW5kZXggPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzU2VsZWN0RW5kSW5kZXggPSBmYWxzZTsKICAgIHB1YmxpYyBpbnQgcmFu\nZ2VQb3NpdGlvbiA9IFJBTkdFX1BPU1RfU0VMRUNUOwogICAgcHVibGljIGJv\nb2xlYW4gcmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCA9IGZhbHNlOwogICAg\ncHVibGljIGJvb2xlYW4gYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNNdWx0aXBsZU5vbnRyYW5z\nYWN0aW9uYWxSZXN1bHRTZXRzID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcg\nc2VhcmNoU3RyaW5nRXNjYXBlID0gIlxcIjsKICAgIHB1YmxpYyBib29sZWFu\nIHJlcXVpcmVzQ2FzdEZvck1hdGhGdW5jdGlvbnMgPSBmYWxzZTsKICAgIHB1\nYmxpYyBib29sZWFuIHJlcXVpcmVzQ2FzdEZvckNvbXBhcmlzb25zID0gZmFs\nc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c01vZE9wZXJhdG9yID0g\nZmFsc2U7CgogICAgLy8gZnVuY3Rpb25zCiAgICBwdWJsaWMgU3RyaW5nIGNh\nc3RGdW5jdGlvbiA9ICJDQVNUKHswfSBBUyB7MX0pIjsKICAgIHB1YmxpYyBT\ndHJpbmcgdG9Mb3dlckNhc2VGdW5jdGlvbiA9ICJMT1dFUih7MH0pIjsKICAg\nIHB1YmxpYyBTdHJpbmcgdG9VcHBlckNhc2VGdW5jdGlvbiA9ICJVUFBFUih7\nMH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgc3RyaW5nTGVuZ3RoRnVuY3Rpb24g\nPSAiQ0hBUl9MRU5HVEgoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpdExl\nbmd0aEZ1bmN0aW9uID0gIihPQ1RFVF9MRU5HVEgoezB9KSAqIDgpIjsKICAg\nIHB1YmxpYyBTdHJpbmcgdHJpbUxlYWRpbmdGdW5jdGlvbiA9ICJUUklNKExF\nQURJTkcgJ3sxfScgRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgdHJp\nbVRyYWlsaW5nRnVuY3Rpb24gPSAiVFJJTShUUkFJTElORyAnezF9JyBGUk9N\nIHswfSkiOwogICAgcHVibGljIFN0cmluZyB0cmltQm90aEZ1bmN0aW9uID0g\nIlRSSU0oQk9USCAnezF9JyBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmlu\nZyBjb25jYXRlbmF0ZUZ1bmN0aW9uID0gIih7MH18fHsxfSkiOwogICAgcHVi\nbGljIFN0cmluZyBjb25jYXRlbmF0ZURlbGltaXRlciA9ICInT1BFTkpQQVRP\nS0VOJyI7CiAgICBwdWJsaWMgU3RyaW5nIHN1YnN0cmluZ0Z1bmN0aW9uTmFt\nZSA9ICJTVUJTVFJJTkciOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50RGF0\nZUZ1bmN0aW9uID0gIkNVUlJFTlRfREFURSI7CiAgICBwdWJsaWMgU3RyaW5n\nIGN1cnJlbnRUaW1lRnVuY3Rpb24gPSAiQ1VSUkVOVF9USU1FIjsKICAgIHB1\nYmxpYyBTdHJpbmcgY3VycmVudFRpbWVzdGFtcEZ1bmN0aW9uID0gIkNVUlJF\nTlRfVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcgZHJvcFRhYmxlU1FM\nID0gIkRST1AgVEFCTEUgezB9IjsKCiAgICAvLyB0eXBlcwogICAgcHVibGlj\nIGJvb2xlYW4gc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwgPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzID0g\nZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yZUNoYXJzQXNOdW1iZXJz\nID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdldEJ5dGVzRm9yQmxv\nYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZVNldEJ5dGVzRm9y\nQmxvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHVzZUdldE9iamVj\ndEZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiB1c2VHZXRT\ndHJpbmdGb3JDbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gdXNl\nU2V0U3RyaW5nRm9yQ2xvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBpbnQgbWF4\nRW1iZWRkZWRCbG9iU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBtYXhFbWJl\nZGRlZENsb2JTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGRhdGVQcmVjaXNp\nb24gPSBNSUxMSTsKICAgIHB1YmxpYyBpbnQgY2hhcmFjdGVyQ29sdW1uU2l6\nZSA9IDI1NTsKICAgIHB1YmxpYyBTdHJpbmcgYXJyYXlUeXBlTmFtZSA9ICJB\nUlJBWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpZ2ludFR5cGVOYW1lID0gIkJJ\nR0lOVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJpbmFyeVR5cGVOYW1lID0gIkJJ\nTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpdFR5cGVOYW1lID0gIkJJVCI7\nCiAgICBwdWJsaWMgU3RyaW5nIGJsb2JUeXBlTmFtZSA9ICJCTE9CIjsKICAg\nIHB1YmxpYyBTdHJpbmcgYm9vbGVhblR5cGVOYW1lID0gIkJPT0xFQU4iOwog\nICAgcHVibGljIFN0cmluZyBjaGFyVHlwZU5hbWUgPSAiQ0hBUiI7CiAgICBw\ndWJsaWMgU3RyaW5nIGNsb2JUeXBlTmFtZSA9ICJDTE9CIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOwogICAgcHVibGljIFN0\ncmluZyBkZWNpbWFsVHlwZU5hbWUgPSAiREVDSU1BTCI7CiAgICBwdWJsaWMg\nU3RyaW5nIGRpc3RpbmN0VHlwZU5hbWUgPSAiRElTVElOQ1QiOwogICAgcHVi\nbGljIFN0cmluZyBkb3VibGVUeXBlTmFtZSA9ICJET1VCTEUiOwogICAgcHVi\nbGljIFN0cmluZyBmbG9hdFR5cGVOYW1lID0gIkZMT0FUIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgaW50ZWdlclR5cGVOYW1lID0gIklOVEVHRVIiOwogICAgcHVi\nbGljIFN0cmluZyBqYXZhT2JqZWN0VHlwZU5hbWUgPSAiSkFWQV9PQkpFQ1Qi\nOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyYmluYXJ5VHlwZU5hbWUgPSAi\nTE9OR1ZBUkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGxvbmdWYXJjaGFy\nVHlwZU5hbWUgPSAiTE9OR1ZBUkNIQVIiOwogICAgcHVibGljIFN0cmluZyBu\ndWxsVHlwZU5hbWUgPSAiTlVMTCI7CiAgICBwdWJsaWMgU3RyaW5nIG51bWVy\naWNUeXBlTmFtZSA9ICJOVU1FUklDIjsKICAgIHB1YmxpYyBTdHJpbmcgb3Ro\nZXJUeXBlTmFtZSA9ICJPVEhFUiI7CiAgICBwdWJsaWMgU3RyaW5nIHJlYWxU\neXBlTmFtZSA9ICJSRUFMIjsKICAgIHB1YmxpYyBTdHJpbmcgcmVmVHlwZU5h\nbWUgPSAiUkVGIjsKICAgIHB1YmxpYyBTdHJpbmcgc21hbGxpbnRUeXBlTmFt\nZSA9ICJTTUFMTElOVCI7CiAgICBwdWJsaWMgU3RyaW5nIHN0cnVjdFR5cGVO\nYW1lID0gIlNUUlVDVCI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbWVUeXBlTmFt\nZSA9ICJUSU1FIjsKICAgIHB1YmxpYyBTdHJpbmcgdGltZXN0YW1wVHlwZU5h\nbWUgPSAiVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcgdGlueWludFR5\ncGVOYW1lID0gIlRJTllJTlQiOwogICAgcHVibGljIFN0cmluZyB2YXJiaW5h\ncnlUeXBlTmFtZSA9ICJWQVJCSU5BUlkiOwogICAgcHVibGljIFN0cmluZyB2\nYXJjaGFyVHlwZU5hbWUgPSAiVkFSQ0hBUiI7CgogICAgLy8gc2NoZW1hIG1l\ndGFkYXRhCiAgICBwdWJsaWMgYm9vbGVhbiB1c2VTY2hlbWFOYW1lID0gdHJ1\nZTsKICAgIHB1YmxpYyBTdHJpbmcgdGFibGVUeXBlcyA9ICJUQUJMRSI7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1NjaGVtYUZvckdldFRhYmxlcyA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1NjaGVtYUZvckdl\ndENvbHVtbnMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNO\ndWxsVGFibGVGb3JHZXRDb2x1bW5zID0gdHJ1ZTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0UHJpbWFyeUtleXMgPSBmYWxz\nZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0\nSW5kZXhJbmZvID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc051bGxUYWJsZUZvckdldEltcG9ydGVkS2V5cyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gdXNlR2V0QmVzdFJvd0lkZW50aWZpZXJGb3JQcmltYXJ5\nS2V5cyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNBdXRv\nQ29tbWl0Rm9yTWV0YURhdGEgPSBmYWxzZTsKCiAgICAvLyBhdXRvLWluY3Jl\nbWVudAogICAgcHVibGljIGludCBtYXhBdXRvQXNzaWduTmFtZUxlbmd0aCA9\nIDMxOwogICAgcHVibGljIFN0cmluZyBhdXRvQXNzaWduQ2xhdXNlID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fzc2lnblR5cGVOYW1lID0gbnVs\nbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzQXV0b0Fzc2lnbiA9IGZh\nbHNlOwogICAgcHVibGljIFN0cmluZyBsYXN0R2VuZXJhdGVkS2V5UXVlcnkg\nPSBudWxsOwogICAgcHVibGljIFN0cmluZyBuZXh0U2VxdWVuY2VRdWVyeSA9\nIG51bGw7CgogICAgcHJvdGVjdGVkIEpEQkNDb25maWd1cmF0aW9uIGNvbmYg\nPSBudWxsOwogICAgcHJvdGVjdGVkIExvZyBsb2cgPSBudWxsOwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gY29ubmVjdGVkID0gZmFsc2U7CiAgICBwcm90ZWN0\nZWQgZmluYWwgU2V0IHJlc2VydmVkV29yZFNldCA9IG5ldyBIYXNoU2V0KCk7\nCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHN5c3RlbVNjaGVtYVNldCA9IG5l\ndyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHN5c3RlbVRh\nYmxlU2V0ID0gbmV3IEhhc2hTZXQoKTsKICAgIHByb3RlY3RlZCBmaW5hbCBT\nZXQgZml4ZWRTaXplVHlwZU5hbWVTZXQgPSBuZXcgSGFzaFNldCgpOwoKICAg\nIC8vIHdoZW4gd2Ugc3RvcmUgdmFsdWVzIHRoYXQgbG9zZSBwcmVjaW9uLCB0\ncmFjayB0aGUgdHlwZXMgc28gdGhhdCB0aGUKICAgIC8vIGZpcnN0IHRpbWUg\naXQgaGFwcGVucyB3ZSBjYW4gd2FybiB0aGUgdXNlcgogICAgcHJpdmF0ZSBT\nZXQgX3ByZWNpc2lvbldhcm5lZFR5cGVzID0gbnVsbDsKCiAgICAvLyBjYWNo\nZSBsb2IgbWV0aG9kcwogICAgcHJpdmF0ZSBNZXRob2QgX3NldEJ5dGVzID0g\nbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9zZXRTdHJpbmcgPSBudWxsOwog\nICAgcHJpdmF0ZSBNZXRob2QgX3NldENoYXJTdHJlYW0gPSBudWxsOwoKICAg\nIHB1YmxpYyBEQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgZml4ZWRTaXplVHlw\nZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewog\nICAgICAgICAgICAiQklHSU5UIiwgIkJJVCIsICJCTE9CIiwgIkNMT0IiLCAi\nREFURSIsICJERUNJTUFMIiwgIkRJU1RJTkNUIiwKICAgICAgICAgICAgIkRP\nVUJMRSIsICJGTE9BVCIsICJJTlRFR0VSIiwgIkpBVkFfT0JKRUNUIiwgIk5V\nTEwiLCAiTlVNRVJJQyIsCiAgICAgICAgICAgICJPVEhFUiIsICJSRUFMIiwg\nIlJFRiIsICJTTUFMTElOVCIsICJTVFJVQ1QiLCAiVElNRSIsICJUSU1FU1RB\nTVAiLAogICAgICAgICAgICAiVElOWUlOVCIsCiAgICAgICAgfSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4g\ndGhlIGRpY3Rpb25hcnkgZmlyc3Qgc2VlcyBhbnkgY29ubmVjdGlvbi4KICAg\nICAqIEl0IGlzIHVzZWQgdG8gaW5pdGlhbGl6ZSBkaWN0aW9uYXJ5IG1ldGFk\nYXRhIGlmIG5lZWRlZC4gSWYgeW91CiAgICAgKiBvdmVycmlkZSB0aGlzIG1l\ndGhvZCwgYmUgc3VyZSB0byBjYWxsCiAgICAgKiA8Y29kZT5zdXBlci5jb25u\nZWN0ZWRDb25maWd1cmF0aW9uPC9jb2RlPi4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgY29ubmVjdGVkQ29uZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFj\nb25uZWN0ZWQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBsb2cudHJhY2UoREJEaWN0aW9uYXJ5RmFjdG9yeS50b1N0cmluZwogICAg\nICAgICAgICAgICAgICAgICAgICAoY29ubi5nZXRNZXRhRGF0YSgpKSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBjb25uZWN0ZWQgPSB0cnVlOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlc3VsdFNldCB3\ncmFwcGVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FM\nIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBBcnJheSBnZXRBcnJheShSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIHJzLmdldEFycmF5KGNvbHVtbik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIElucHV0U3RyZWFtIGdldEFzY2lpU3Ry\nZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QXNjaWlTdHJl\nYW0oY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nQmlnRGVjaW1hbCBnZXRCaWdEZWNpbWFsKFJlc3VsdFNldCBycywgaW50IGNv\nbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpIHsKICAgICAgICAgICAg\nU3RyaW5nIHN0ciA9IGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICAg\nICAgcmV0dXJuIChzdHIgPT0gbnVsbCkgPyBudWxsIDogbmV3IEJpZ0RlY2lt\nYWwoc3RyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJzLmdldEJpZ0Rl\nY2ltYWwoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gdmFsdWUgYXMgYW4gdW5rbm93biBudW1l\ncmljIHR5cGU7CiAgICAgKiB3ZSB0cnkgZnJvbSB0aGUgbW9zdCBnZW5lcmlj\nIHRvIHRoZSBsZWFzdCBnZW5lcmljLgogICAgICovCiAgICBwdWJsaWMgTnVt\nYmVyIGdldE51bWJlcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gdHJ5IGZyb20g\ndGhlIG1vc3QgZ2VuZXJpYywgYW5kIGlmIGVycm9ycyBvY2N1ciwgdHJ5CiAg\nICAgICAgLy8gbGVzcyBnZW5lcmljIHR5cGVzOyB0aGlzIGVuYWJsZXMgdXMg\ndG8gaGFuZGxlIHZhbHVlcwogICAgICAgIC8vIGxpa2UgRG91YmxlLk5hTiB3\naXRob3V0IGhhdmluZyB0byBpbnRyb3NwZWN0IG9uIHRoZQogICAgICAgIC8v\nIFJlc3VsdFNldE1ldGFEYXRhIChidWcgIzEwNTMpLiBub3RlIHRoYXQgd2Ug\naGFuZGxlCiAgICAgICAgLy8gZ2VuZXJpYyBleGNlcHRpb25zLCBzaW5jZSBz\nb21lIGRyaXZlcnMgbWF5IHRocm93CiAgICAgICAgLy8gTnVtYmVyRm9ybWF0\nRXhjZXB0aW9ucywgd2hlcmVhcyBvdGhlcnMgbWF5IHRocm93IFNRTEV4Y2Vw\ndGlvbnMKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZ2V0Qmln\nRGVjaW1hbChycywgY29sdW1uKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZTEpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgRG91YmxlKGdldERvdWJsZShycywgY29sdW1uKSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMikgewogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0\nKGdldEZsb2F0KHJzLCBjb2x1bW4pKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlMykgewogICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVl\nT2YoZ2V0TG9uZyhycywgY29sdW1uKSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGU0KSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nTnVtYmVycy52YWx1ZU9mKGdldEludChycywgY29sdW1uKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlNSkgewogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAoZTEgaW5zdGFuY2VvZiBSdW50aW1lRXhjZXB0aW9uKQogICAgICAgICAg\nICAgICAgdGhyb3coUnVudGltZUV4Y2VwdGlvbikgZTE7CiAgICAgICAgICAg\nIGlmIChlMSBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikKICAgICAgICAgICAg\nICAgIHRocm93KFNRTEV4Y2VwdGlvbikgZTE7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8g\ndGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgQmlnSW50ZWdlciBnZXRCaWdJbnRlZ2VyKFJlc3VsdFNldCBycywgaW50\nIGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpIHsKICAgICAgICAg\nICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAg\nICAgICAgcmV0dXJuIChzdHIgPT0gbnVsbCkgPyBudWxsIDogbmV3IEJpZ0Rl\nY2ltYWwoc3RyKS50b0JpZ0ludGVnZXIoKTsKICAgICAgICB9CiAgICAgICAg\nQmlnRGVjaW1hbCBiZCA9IGdldEJpZ0RlY2ltYWwocnMsIGNvbHVtbik7CiAg\nICAgICAgcmV0dXJuIChiZCA9PSBudWxsKSA/IG51bGwgOiBiZC50b0JpZ0lu\ndGVnZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgSW5w\ndXRTdHJlYW0gZ2V0QmluYXJ5U3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNv\nbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0QmluYXJ5U3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIEJsb2IgZ2V0QmxvYihSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJsb2IoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldEJsb2JPYmplY3Qo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBKREJDU3RvcmUgc3RvcmUpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5wdXRTdHJl\nYW0gaW4gPSBudWxsOwogICAgICAgIGlmICh1c2VHZXRCeXRlc0ZvckJsb2Jz\nIHx8IHVzZUdldE9iamVjdEZvckJsb2JzKSB7CiAgICAgICAgICAgIGJ5dGVb\nXSBieXRlcyA9IGdldEJ5dGVzKHJzLCBjb2x1bW4pOwogICAgICAgICAgICBp\nZiAoYnl0ZXMgIT0gbnVsbCAmJiBieXRlcy5sZW5ndGggPiAwKQogICAgICAg\nICAgICAgICAgaW4gPSBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0oYnl0ZXMp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEJsb2IgYmxvYiA9IGdl\ndEJsb2IocnMsIGNvbHVtbik7CiAgICAgICAgICAgIGlmIChibG9iICE9IG51\nbGwgJiYgYmxvYi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBpbiA9\nIGJsb2IuZ2V0QmluYXJ5U3RyZWFtKCk7CiAgICAgICAgfQogICAgICAgIGlm\nIChpbiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHN0b3JlID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gU2VyaWFsaXphdGlvbi5kZXNlcmlhbGl6ZShp\nbiwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRl\nc2VyaWFsaXplKGluLCBzdG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nbi5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBp\nb2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRCb29sZWFuKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Qm9vbGVhbihjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlIGdldEJ5dGUoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCeXRlKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJ5dGVbXSBnZXRCeXRl\ncyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxvYnMp\nCiAgICAgICAgICAgIHJldHVybiBycy5nZXRCeXRlcyhjb2x1bW4pOwogICAg\nICAgIGlmICh1c2VHZXRPYmplY3RGb3JCbG9icykKICAgICAgICAgICAgcmV0\ndXJuIChieXRlW10pIHJzLmdldE9iamVjdChjb2x1bW4pOwoKICAgICAgICBC\nbG9iIGJsb2IgPSBnZXRCbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChi\nbG9iID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGludCBsZW5ndGggPSAoaW50KSBibG9iLmxlbmd0aCgpOwogICAgICAgIGlm\nIChsZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIGJsb2IuZ2V0Qnl0ZXMoMSwgbGVuZ3RoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLiBDb252ZXJ0cyB0aGUgZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFt\ncH0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIENhbGVuZGFyIGdl\ndENhbGVuZGFyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBEYXRlIGQgPSBnZXREYXRl\nKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBDYWxlbmRhciBjYWwgPSBDYWxl\nbmRhci5nZXRJbnN0YW5jZSgpOwogICAgICAgIGNhbC5zZXRUaW1lKGQpOwog\nICAgICAgIHJldHVybiBjYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIGNoYXIgZ2V0Q2hhcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0\nb3JlQ2hhcnNBc051bWJlcnMpCiAgICAgICAgICAgIHJldHVybiAoY2hhcikg\nZ2V0SW50KHJzLCBjb2x1bW4pOwoKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0\nU3RyaW5nKHJzLCBjb2x1bW4pOwogICAgICAgIHJldHVybiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShzdHIpKSA/IDAgOiBzdHIuY2hhckF0KDApOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBSZWFkZXIgZ2V0Q2hhcmFjdGVy\nU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Q2hhcmFj\ndGVyU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIENsb2IgZ2V0Q2xvYihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIHJzLmdldENsb2IoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRT\nZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENsb2JTdHJpbmcoUmVzdWx0U2V0IHJzLCBp\nbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICh1c2VHZXRTdHJpbmdGb3JDbG9icykKICAgICAgICAgICAgcmV0\ndXJuIHJzLmdldFN0cmluZyhjb2x1bW4pOwoKICAgICAgICBDbG9iIGNsb2Ig\nPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChjbG9iID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChjbG9i\nLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAg\nICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZlIHN0cmluZ3Mgb3ZlciBJ\nbnRlZ2VyLk1BWF9WQUxVRSBjaGFycwogICAgICAgIHJldHVybiBjbG9iLmdl\ndFN1YlN0cmluZygxLCAoaW50KSBjbG9iLmxlbmd0aCgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLiBDb252ZXJ0cyB0aGUgZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFt\ncH0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIERhdGUgZ2V0RGF0\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgVGltZXN0YW1wIHRzdGFtcCA9IGdldFRp\nbWVzdGFtcChycywgY29sdW1uLCBudWxsKTsKICAgICAgICBpZiAodHN0YW1w\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAv\nLyBnZXQgdGhlIGZyYWN0aW9uYWwgc2Vjb25kcyBjb21wb25lbnQsIHJvdW5k\naW5nIGF3YXkgYW55dGhpbmcgYmV5b25kCiAgICAgICAgLy8gbWlsbGlzZWNv\nbmRzCiAgICAgICAgaW50IGZyYWN0aW9uYWwgPSAoaW50KSBNYXRoLnJvdW5k\nKHRzdGFtcC5nZXROYW5vcygpIC8gKGRvdWJsZSkgTUlMTEkpOwoKICAgICAg\nICAvLyBnZXQgdGhlIG1pbGxpcyBjb21wb25lbnQ7IHNvbWUgSkRCQyBkcml2\nZXJzIHJvdW5kIHRoaXMgdG8gdGhlCiAgICAgICAgLy8gbmVhcmVzdCBzZWNv\nbmQsIHdoaWxlIG90aGVycyBkbyBub3QKICAgICAgICBsb25nIG1pbGxpcyA9\nICh0c3RhbXAuZ2V0VGltZSgpIC8gMTAwMEwpICogMTAwMEw7CiAgICAgICAg\ncmV0dXJuIG5ldyBEYXRlKG1pbGxpcyArIGZyYWN0aW9uYWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBqYXZhLnNxbC5EYXRlIGdldERh\ndGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0RGF0ZShjb2x1bW4p\nOwogICAgICAgIHJldHVybiBycy5nZXREYXRlKGNvbHVtbiwgY2FsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgZG91YmxlIGdldERvdWJs\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldERvdWJsZShjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCBn\nZXRGbG9hdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEZsb2F0\nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRJbnQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRJbnQo\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgTG9j\nYWxlIGdldExvY2FsZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIHN0ciA9\nIGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShzdHIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgU3RyaW5nW10gcGFyYW1zID0gU3RyaW5ncy5zcGxpdChzdHIsICJf\nIiwgMyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPCAzKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gbmV3IExvY2FsZShw\nYXJhbXNbMF0sIHBhcmFtc1sxXSwgcGFyYW1zWzJdKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgbG9uZyBnZXRMb25nKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcnMuZ2V0TG9uZyhjb2x1bW4pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0KFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAobWFwID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBycy5nZXRPYmplY3QoY29sdW1uKTsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0T2JqZWN0KGNvbHVtbiwgbWFwKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgUmVmIGdldFJlZihSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4sIE1hcCBtYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFJlZihjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzaG9ydCBnZXRTaG9ydChS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFNob3J0KGNvbHVtbik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRT\ndHJpbmcoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRTdHJpbmco\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgVGlt\nZSBnZXRUaW1lKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIg\nY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldFRpbWUo\nY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0VGltZShjb2x1bW4sIGNh\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFRpbWVzdGFt\ncCBnZXRUaW1lc3RhbXAoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxl\nbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0\nVGltZXN0YW1wKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldFRpbWVz\ndGFtcChjb2x1bW4sIGNhbCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcmVwYXJlZFN0YXRlbWVudCB3cmFw\ncGVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEFycmF5KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBBcnJh\neSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRBcnJheShpZHgsIHZhbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEFzY2lpU3RyZWFtKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LAogICAgICAgIElucHV0U3RyZWFtIHZhbCwgaW50IGxl\nbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzdG1udC5zZXRBc2NpaVN0cmVhbShpZHgsIHZhbCwgbGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgQmlnRGVjaW1hbCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoKGNvbCAhPSBudWxsICYmIGNvbC5pc0NvbXBhdGlibGUoVHlwZXMu\nVkFSQ0hBUiwgMCkpCiAgICAgICAgICAgIHx8IChjb2wgPT0gbnVsbCAmJiBz\ndG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykpCiAgICAgICAgICAgIHNldFN0\ncmluZyhzdG1udCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29sKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNldEJpZ0RlY2ltYWwoaWR4LCB2\nYWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRCaWdJbnRlZ2VyKFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50LCBpbnQgaWR4LCBCaWdJbnRlZ2VyIHZhbCwKICAgICAgICBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBlcy5W\nQVJDSEFSLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9PSBudWxsICYmIHN0\nb3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSkKICAgICAgICAgICAgc2V0U3Ry\naW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmluZygpLCBjb2wpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCBu\nZXcgQmlnRGVjaW1hbCh2YWwpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCaW5hcnlT\ndHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAg\nICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNl\ndEJpbmFyeVN0cmVhbShpZHgsIHZhbCwgbGVuZ3RoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIg\ndG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQmxvYihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQmxvYiB2\nYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgsIHZhbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuIFVzZXMgdGhlCiAgICAgKiB7QGxpbmsgI3Nl\ncmlhbGl6ZX0gbWV0aG9kIHRvIHNlcmlhbGl6ZSB0aGUgdmFsdWUuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2JPYmplY3QoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVjdCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIHNlcmlh\nbGl6ZSh2YWwsIHN0b3JlKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qm9vbGVhbihQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgYm9vbGVhbiB2YWws\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXRJbnQoaWR4LCAodmFsKSA/IDEgOiAw\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Qnl0ZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwg\naW50IGlkeCwgYnl0ZSB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0Qnl0ZShpZHgsIHZh\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVl\nIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldEJ5dGVzKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBieXRlW10gdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZVNl\ndEJ5dGVzRm9yQmxvYnMpCiAgICAgICAgICAgIHN0bW50LnNldEJ5dGVzKGlk\neCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldEJpbmFyeVN0\ncmVhbShzdG1udCwgaWR4LCBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0odmFs\nKSwKICAgICAgICAgICAgICAgIHZhbC5sZW5ndGgsIGNvbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1l\ndGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldENoYXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGNo\nYXIgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0\naWJsZShUeXBlcy5JTlRFR0VSLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9\nPSBudWxsICYmIHN0b3JlQ2hhcnNBc051bWJlcnMpKQogICAgICAgICAgICBz\nZXRJbnQoc3RtbnQsIGlkeCwgKGludCkgdmFsLCBjb2wpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIFN0cmluZy52\nYWx1ZU9mKHZhbCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1l\nbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENoYXJhY3RlclN0cmVh\nbShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwKICAgICAgICBS\nZWFkZXIgdmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldENoYXJhY3Rl\nclN0cmVhbShpZHgsIHZhbCwgbGVuZ3RoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2xvYihQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgQ2xvYiB2YWwsIENv\nbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc3RtbnQuc2V0Q2xvYihpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRo\nZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENsb2JT\ndHJpbmcoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIFN0cmlu\nZyB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlU2V0U3RyaW5nRm9yQ2xvYnMp\nCiAgICAgICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgsIHZhbCk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHNldCByZWFkZXIgZnJvbSBzdHJp\nbmcKICAgICAgICAgICAgU3RyaW5nUmVhZGVyIGluID0gbmV3IFN0cmluZ1Jl\nYWRlcih2YWwpOwogICAgICAgICAgICBzZXRDaGFyYWN0ZXJTdHJlYW0oc3Rt\nbnQsIGlkeCwgaW4sIHZhbC5sZW5ndGgoKSwgY29sKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEg\ncGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldERhdGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBp\nZHgsIERhdGUgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0\nVHlwZSgpID09IFR5cGVzLkRBVEUpCiAgICAgICAgICAgIHNldERhdGUoc3Rt\nbnQsIGlkeCwgbmV3IGphdmEuc3FsLkRhdGUodmFsLmdldFRpbWUoKSksIG51\nbGwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAoY29sICE9IG51bGwgJiYgY29s\nLmdldFR5cGUoKSA9PSBUeXBlcy5USU1FKQogICAgICAgICAgICBzZXRUaW1l\nKHN0bW50LCBpZHgsIG5ldyBUaW1lKHZhbC5nZXRUaW1lKCkpLCBudWxsLCBj\nb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0\nbW50LCBpZHgsIG5ldyBUaW1lc3RhbXAodmFsLmdldFRpbWUoKSksIG51bGws\nIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldERhdGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsIGphdmEuc3FsLkRhdGUgdmFsLAogICAgICAgIENhbGVu\nZGFyIGNhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0\nbW50LnNldERhdGUoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc3RtbnQuc2V0RGF0ZShpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIg\ndG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQ2FsZW5kYXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIENh\nbGVuZGFyIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGJ5IGRlZmF1bHQgd2UgbWVy\nZWx5IGRlbGVnYXRlIHRoZSB0aGUgRGF0ZSBwYXJhbWV0ZXIKICAgICAgICBz\nZXREYXRlKHN0bW50LCBpZHgsIHZhbC5nZXRUaW1lKCksIGNvbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFy\nYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldERvdWJsZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgZG91YmxlIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldERvdWJsZShp\nZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEZsb2F0KFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50LCBpbnQgaWR4LCBmbG9hdCB2YWwsCiAgICAgICAgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1u\ndC5zZXRGbG9hdChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEludChQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50IHZhbCwgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1u\ndC5zZXRJbnQoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMb25nKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBsb25nIHZhbCwgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1u\ndC5zZXRMb25nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TG9jYWxlKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBMb2NhbGUgdmFsLAogICAg\nICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC5nZXRMYW5ndWFn\nZSgpICsgIl8iICsgdmFsLmdldENvdW50cnkoKQogICAgICAgICAgICArICJf\nIiArIHZhbC5nZXRWYXJpYW50KCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVycyB0byB0\naGUgc3RhdGVtZW50LiBUaGUgY29sdW1uCiAgICAgKiB0eXBlIHdpbGwgY29t\nZSBmcm9tIHtAbGluayBUeXBlc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE51bGwoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGlu\ndCBjb2xUeXBlLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0TnVsbChpZHgsIGNv\nbFR5cGUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXROdW1iZXIoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIE51bWJlciBudW0sCiAgICAgICAgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBj\naGVjayBmb3Iga25vd24gZmxvYXRpbmcgcG9pbnQgdHlwZXMgdG8gZ2l2ZSBk\ncml2ZXIgYSBjaGFuY2UgdG8KICAgICAgICAvLyBoYW5kbGUgc3BlY2lhbCBu\ndW1iZXJzIGxpa2UgTmFOIGFuZCBpbmZpbml0eTsgYnVnICMxMDUzCiAgICAg\nICAgaWYgKG51bSBpbnN0YW5jZW9mIERvdWJsZSkKICAgICAgICAgICAgc2V0\nRG91YmxlKHN0bW50LCBpZHgsICgoRG91YmxlKSBudW0pLmRvdWJsZVZhbHVl\nKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAobnVtIGluc3RhbmNlb2YgRmxv\nYXQpCiAgICAgICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoRmxvYXQp\nIG51bSkuZmxvYXRWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCBuZXcgQmlnRGVjaW1h\nbChudW0udG9TdHJpbmcoKSksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVycyB0byB0aGUg\nc3RhdGVtZW50LiBUaGUgY29sdW1uCiAgICAgKiB0eXBlIHdpbGwgY29tZSBm\ncm9tIHtAbGluayBUeXBlc30uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndE9iamVjdChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2Jq\nZWN0IHZhbCwKICAgICAgICBpbnQgY29sVHlwZSwgQ29sdW1uIGNvbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29sVHlw\nZSA9PSAtMSB8fCBjb2xUeXBlID09IFR5cGVzLk9USEVSKQogICAgICAgICAg\nICBzdG1udC5zZXRPYmplY3QoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgc3RtbnQuc2V0T2JqZWN0KGlkeCwgdmFsLCBjb2xUeXBlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMg\nYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0UmVmKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBSZWYgdmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHN0bW50LnNldFJlZihpZHgsIHZhbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEg\ncGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFNob3J0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBzaG9ydCB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRTaG9ydChp\nZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFN0cmluZyhQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldFN0cmluZyhpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRpbWUoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIFRpbWUgdmFsLAogICAg\nICAgIENhbGVuZGFyIGNhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAg\nICAgICAgIHN0bW50LnNldFRpbWUoaWR4LCB2YWwpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc3RtbnQuc2V0VGltZShpZHgsIHZhbCwgY2FsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0VGltZXN0YW1wKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LAogICAgICAgIFRpbWVzdGFtcCB2YWwsIENhbGVuZGFyIGNhbCwg\nQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBkbyBub3QgaW5zZXJ0IGRhdGVzIGF0\nIGEgZ3JlYXRlciBwcmVjaXNpb24gdGhhbgogICAgICAgIC8vIHRoYXQgYXQg\nd2hpY2ggdGhleSB3aWxsIGJlIHJldHVybmVkIGJ5IGEgU0VMRUNUCiAgICAg\nICAgaW50IHJvdW5kZWQgPSAoaW50KSBNYXRoLnJvdW5kKHZhbC5nZXROYW5v\ncygpIC8KICAgICAgICAgICAgKGRvdWJsZSkgZGF0ZVByZWNpc2lvbik7CiAg\nICAgICAgaW50IG5hbm9zID0gcm91bmRlZCAqIGRhdGVQcmVjaXNpb247CiAg\nICAgICAgaWYgKG5hbm9zID4gOTk5OTk5OTk5KSB7CiAgICAgICAgICAgIC8v\nIHJvbGxvdmVyIHRvIG5leHQgc2Vjb25kCiAgICAgICAgICAgIHZhbC5zZXRU\naW1lKHZhbC5nZXRUaW1lKCkgKyAxMDAwKTsKICAgICAgICAgICAgbmFub3Mg\nPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN1cHBvcnRzVGltZXN0YW1w\nTmFub3MpCiAgICAgICAgICAgIHZhbC5zZXROYW5vcyhuYW5vcyk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICB2YWwuc2V0TmFub3MoMCk7CgogICAgICAg\nIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQuc2V0VGltZXN0\nYW1wKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50\nLnNldFRpbWVzdGFtcChpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCBhIGNvbHVtbiB2YWx1ZSBpbnRvIGEgcHJlcGFyZWQgc3Rh\ndGVtZW50LgogICAgICoKICAgICAqIEBwYXJhbSBzdG1udCB0aGUgcHJlcGFy\nZWQgc3RhdGVtZW50IHRvIHBhcmFtZXRlcml6ZQogICAgICogQHBhcmFtIGlk\neCB0aGUgaW5kZXggb2YgdGhlIHBhcmFtZXRlciBpbiB0aGUgcHJlcGFyZWQg\nc3RhdGVtZW50CiAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSBvZiB0aGUg\nY29sdW1uCiAgICAgKiBAcGFyYW0gY29sIHRoZSBjb2x1bW4gYmVpbmcgc2V0\nCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgZmllbGQgbWFwcGluZyB0eXBlIGNv\nZGUgZm9yIHRoZSB2YWx1ZQogICAgICogQHBhcmFtIHN0b3JlIHRoZSBzdG9y\nZSBtYW5hZ2VyIGZvciB0aGUgY3VycmVudCBjb250ZXh0CiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldFR5cGVkKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wsIGlu\ndCB0eXBlLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHNldE51bGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVz\nLk9USEVSIDogY29sLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNpemVk\nIHM7CiAgICAgICAgQ2FsZW5kYXJkIGM7CiAgICAgICAgc3dpdGNoICh0eXBl\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAg\nICAgICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJvb2xlYW4pIHZhbCku\nYm9vbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBzZXRC\neXRlKHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAo\nKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VC\nTEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAg\nICAgICAgICAgICAgICBzZXREb3VibGUoc3RtbnQsIGlkeCwgKChOdW1iZXIp\nIHZhbCkuZG91YmxlVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAg\nICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuZmxvYXRW\nYWx1ZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgIHNldEludChzdG1udCwg\naWR4LCAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxP\nTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAg\nICAgICAgICAgICAgc2V0TG9uZyhzdG1udCwgaWR4LCAoKE51bWJlcikgdmFs\nKS5sb25nVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgc2V0\nU2hvcnQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgp\nLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIGlmIChjb2wg\nIT0gbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CCiAgICAg\nICAgICAgICAgICAgICAgfHwgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5MT05H\nVkFSQ0hBUikpCiAgICAgICAgICAgICAgICAgICAgc2V0Q2xvYlN0cmluZyhz\ndG1udCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBp\nZHgsIChTdHJpbmcpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAg\nICAgICAgICBzZXRCbG9iT2JqZWN0KHN0bW50LCBpZHgsIHZhbCwgY29sLCBz\ndG9yZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHNldERhdGUoc3Rt\nbnQsIGlkeCwgKERhdGUpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgICAgIHNldENhbGVuZGFyKHN0bW50LCBpZHgsIChDYWxlbmRh\ncikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAg\nICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIChCaWdEZWNpbWFsKSB2YWws\nIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIHNldEJp\nZ0ludGVnZXIoc3RtbnQsIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAgICBzZXROdW1iZXIoc3RtbnQs\nIGlkeCwgKE51bWJlcikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAg\nICAgICAgICAgIHNldExvY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWws\nIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgogICAgICAgICAgICAgICAgc2V0\nQXJyYXkoc3RtbnQsIGlkeCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nQVNDSUlfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXplZCkgdmFs\nOwogICAgICAgICAgICAgICAgc2V0QXNjaWlTdHJlYW0oc3RtbnQsIGlkeCwg\nKElucHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nQklOQVJZX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZh\nbDsKICAgICAgICAgICAgICAgIHNldEJpbmFyeVN0cmVhbShzdG1udCwgaWR4\nLCAoSW5wdXRTdHJlYW0pIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5CTE9COgogICAgICAgICAgICAgICAgc2V0QmxvYihzdG1udCwgaWR4LCAo\nQmxvYikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJZVEVTOgogICAgICAgICAgICAg\nICAgc2V0Qnl0ZXMoc3RtbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNR\nTFR5cGVzLkNIQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXpl\nZCkgdmFsOwogICAgICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0\nbW50LCBpZHgsIChSZWFkZXIpIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxU\neXBlcy5DTE9COgogICAgICAgICAgICAgICAgc2V0Q2xvYihzdG1udCwgaWR4\nLCAoQ2xvYikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAg\nICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyZCkgewogICAg\nICAgICAgICAgICAgICAgIGMgPSAoQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAg\nICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0\nZSkgYy52YWx1ZSwgYy5jYWxlbmRhciwKICAgICAgICAgICAgICAgICAgICAg\nICAgY29sKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAg\nICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZh\nbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFTUUxUeXBlcy5SRUY6CiAgICAgICAgICAgICAgICBz\nZXRSZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJ\nTUU6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5k\nYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZh\nbDsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIChU\naW1lKSBjLnZhbHVlLCBjLmNhbGVuZGFyLCBjb2wpOwogICAgICAgICAgICAg\nICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwg\naWR4LCAoVGltZSkgdmFsLCBudWxsLCBjb2wpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUVTVEFN\nUDoKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRh\ncmQpIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFs\nOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4\nLCAoVGltZXN0YW1wKSBjLnZhbHVlLCBjLmNhbGVuZGFyLAogICAgICAgICAg\nICAgICAgICAgICAgICBjb2wpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0bW50LCBpZHgsIChU\naW1lc3RhbXApIHZhbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYg\nKGNvbCAhPSBudWxsICYmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IK\nICAgICAgICAgICAgICAgICAgICB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVz\nLlZBUkJJTkFSWSkpCiAgICAgICAgICAgICAgICAgICAgc2V0QmxvYk9iamVj\ndChzdG1udCwgaWR4LCB2YWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNldE9iamVjdChzdG1udCwg\naWR4LCB2YWwsIGNvbC5nZXRUeXBlKCksIGNvbCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IGEgY29tcGxldGVseSB1bmtub3duIHBh\ncmFtZXRlciBpbnRvIGEgcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRVbmtub3duKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2l6ZWQg\nc2l6ZWQgPSBudWxsOwogICAgICAgIENhbGVuZGFyZCBjYWxkID0gbnVsbDsK\nICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgU2l6ZWQpIHsKICAgICAgICAg\nICAgc2l6ZWQgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgdmFsID0gc2l6\nZWQudmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBD\nYWxlbmRhcmQpIHsKICAgICAgICAgICAgY2FsZCA9IChDYWxlbmRhcmQpIHZh\nbDsKICAgICAgICAgICAgdmFsID0gY2FsZC52YWx1ZTsKICAgICAgICB9Cgog\nICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgc2V0TnVsbChz\ndG1udCwgaWR4LCAoY29sID09IG51bGwpID8gVHlwZXMuT1RIRVIgOiBjb2wu\nZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHNldFN0\ncmluZyhzdG1udCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBJbnRlZ2VyKQogICAgICAgICAg\nICBzZXRJbnQoc3RtbnQsIGlkeCwgKChJbnRlZ2VyKSB2YWwpLmludFZhbHVl\nKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQm9v\nbGVhbikKICAgICAgICAgICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJv\nb2xlYW4pIHZhbCkuYm9vbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgTG9uZykKICAgICAgICAgICAgc2V0TG9u\nZyhzdG1udCwgaWR4LCAoKExvbmcpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRmxvYXQpCiAgICAg\nICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoRmxvYXQpIHZhbCkuZmxv\nYXRWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIERvdWJsZSkKICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgs\nICgoRG91YmxlKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQnl0ZSkKICAgICAgICAgICAgc2V0\nQnl0ZShzdG1udCwgaWR4LCAoKEJ5dGUpIHZhbCkuYnl0ZVZhbHVlKCksIGNv\nbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQ2hhcmFjdGVy\nKQogICAgICAgICAgICBzZXRDaGFyKHN0bW50LCBpZHgsICgoQ2hhcmFjdGVy\nKSB2YWwpLmNoYXJWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZh\nbCBpbnN0YW5jZW9mIFNob3J0KQogICAgICAgICAgICBzZXRTaG9ydChzdG1u\ndCwgaWR4LCAoKFNob3J0KSB2YWwpLnNob3J0VmFsdWUoKSwgY29sKTsKICAg\nICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBMb2NhbGUpCiAgICAgICAg\nICAgIHNldExvY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQmlnRGVjaW1hbCkK\nICAgICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVj\naW1hbCkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIEJpZ0ludGVnZXIpCiAgICAgICAgICAgIHNldEJpZ0ludGVnZXIoc3Rt\nbnQsIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICAgICAgc2V0QXJy\nYXkoc3RtbnQsIGlkeCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgQmxvYikKICAgICAgICAgICAgc2V0Qmxv\nYihzdG1udCwgaWR4LCAoQmxvYikgdmFsLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIGJ5dGVbXSkKICAgICAgICAgICAgc2V0Qnl0\nZXMoc3RtbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAgICAgIGVs\nc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENsb2IpCiAgICAgICAgICAgIHNldENs\nb2Ioc3RtbnQsIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBSZWYpCiAgICAgICAgICAgIHNldFJlZihz\ndG1udCwgaWR4LCAoUmVmKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAo\ndmFsIGluc3RhbmNlb2YgamF2YS5zcWwuRGF0ZSkKICAgICAgICAgICAgc2V0\nRGF0ZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0ZSkgdmFsLAogICAgICAg\nICAgICAgICAgKGNhbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRh\nciwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1l\nc3RhbXApCiAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAo\nVGltZXN0YW1wKSB2YWwsCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBudWxs\nKSA/IG51bGwgOiBjYWxkLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIFRpbWUpCiAgICAgICAgICAgIHNldFRpbWUo\nc3RtbnQsIGlkeCwgKFRpbWUpIHZhbCwKICAgICAgICAgICAgICAgIChjYWxk\nID09IG51bGwpID8gbnVsbCA6IGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAg\nICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICAgICAg\nc2V0RGF0ZShzdG1udCwgaWR4LCAoRGF0ZSkgdmFsLCBjb2wpOwogICAgICAg\nIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyKQogICAgICAgICAg\nICBzZXREYXRlKHN0bW50LCBpZHgsICgoQ2FsZW5kYXIpIHZhbCkuZ2V0VGlt\nZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJl\nYWRlcikKICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBp\nZHgsIChSZWFkZXIpIHZhbCwKICAgICAgICAgICAgICAgIChzaXplZCA9PSBu\ndWxsKSA/IDAgOiBzaXplZC5zaXplLCBjb2wpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJh\nZC1wYXJhbSIsIHZhbC5nZXRDbGFzcygpKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHNlcmlhbGl6ZWQgYnl0ZXMgZm9yIHRoZSBnaXZl\nbiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlW10gc2VyaWFsaXpl\nKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICh2YWwgaW5zdGFuY2Vv\nZiBTZXJpYWxpemVkRGF0YSkKICAgICAgICAgICAgcmV0dXJuICgoU2VyaWFs\naXplZERhdGEpIHZhbCkuYnl0ZXM7CiAgICAgICAgcmV0dXJuIFNlcmlhbGl6\nYXRpb24uc2VyaWFsaXplKHZhbCwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5z\nZXRCeXRlczwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVj\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Qnl0ZXMoT2JqZWN0IGJs\nb2IsIGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChfc2V0Qnl0ZXMgPT0gbnVsbCkgewogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgX3NldEJ5dGVzID0gYmxvYi5nZXRD\nbGFzcygpLmdldE1ldGhvZCgic2V0Qnl0ZXMiLAogICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBieXRlW10uY2xhc3MgfSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9z\nZXRCeXRlcywgYmxvYiwKICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBOdW1i\nZXJzLnZhbHVlT2YoMUwpLCBkYXRhIH0pOwogICAgfQoKICAgIC8qKgogICAg\nICogSW52b2tlIHRoZSBKREsgMS40IDxjb2RlPnNldFN0cmluZzwvY29kZT4g\nbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CCiAgICAgKiBvYmplY3QuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHB1dFN0cmluZyhPYmplY3QgY2xvYiwgU3Ry\naW5nIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKF9zZXRTdHJpbmcgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgX3NldFN0cmluZyA9IGNsb2IuZ2V0Q2xhc3Mo\nKS5nZXRNZXRob2QoInNldFN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IENsYXNzW117IGxvbmcuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBpbnZva2VQdXRMb2JNZXRob2QoX3NldFN0\ncmluZywgY2xvYiwKICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBOdW1iZXJz\nLnZhbHVlT2YoMUwpLCBkYXRhIH0pOwogICAgfQoKICAgIC8qKgogICAgICog\nSW52b2tlIHRoZSBKREsgMS40IDxjb2RlPnNldENoYXJhY3RlclN0cmVhbTwv\nY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbgogICAgICogQ0xPQiBvYmplY3Qu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dENoYXJzKE9iamVjdCBjbG9i\nLCBjaGFyW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoX3NldENoYXJTdHJlYW0gPT0gbnVsbCkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgX3NldENoYXJTdHJlYW0gPSBj\nbG9iLmdldENsYXNzKCkuZ2V0TWV0aG9kCiAgICAgICAgICAgICAgICAgICAg\nKCJzZXRDaGFyYWN0ZXJTdHJlYW0iLCBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFz\ncyB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgV3JpdGVyIHdyaXRlciA9\nIChXcml0ZXIpIGludm9rZVB1dExvYk1ldGhvZChfc2V0Q2hhclN0cmVhbSwg\nY2xvYiwKICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBOdW1iZXJzLnZhbHVl\nT2YoMUwpIH0pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdyaXRlci53\ncml0ZShkYXRhKTsKICAgICAgICAgICAgd3JpdGVyLmZsdXNoKCk7CiAgICAg\nICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTUUxFeGNlcHRpb24oaW9lLnRvU3RyaW5nKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgZ2l2ZW4gTE9C\nIG1ldGhvZCBvbiB0aGUgZ2l2ZW4gdGFyZ2V0IHdpdGggdGhlIGdpdmVuIGRh\ndGEuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBpbnZva2VQ\ndXRMb2JNZXRob2QoTWV0aG9kIG1ldGhvZCwgT2JqZWN0IHRhcmdldCwKICAg\nICAgICBPYmplY3RbXSBhcmdzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBtZXRob2Qu\naW52b2tlKHRhcmdldCwgYXJncyk7CiAgICAgICAgfSBjYXRjaCAoSW52b2Nh\ndGlvblRhcmdldEV4Y2VwdGlvbiBpdGUpIHsKICAgICAgICAgICAgVGhyb3dh\nYmxlIHQgPSBpdGUuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAg\nIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAg\nICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24odCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhh\ndCBhIHBhcnRpY3VsYXIgdmFsdWUgY291bGQgbm90IGJlIHN0b3JlZCBwcmVj\naXNlbHkuCiAgICAgKiBBZnRlciB0aGUgZmlyc3Qgd2FybmluZyBmb3IgYSBw\nYXJ0aWN1bGFyIHR5cGUsIG1lc3NhZ2VzCiAgICAgKiB3aWxsIGJlIHR1cm5l\nZCBpbnRvIHRyYWNlIG1lc3NhZ2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBzdG9yYWdlV2FybmluZyhPYmplY3Qgb3JpZywgT2JqZWN0IGNvbnZl\ncnRlZCkgewogICAgICAgIGJvb2xlYW4gd2FybjsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKF9wcmVjaXNpb25XYXJu\nZWRUeXBlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3ByZWNpc2lvbldh\ncm5lZFR5cGVzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgd2FybiA9\nIF9wcmVjaXNpb25XYXJuZWRUeXBlcy5hZGQob3JpZy5nZXRDbGFzcygpKTsK\nICAgICAgICB9CgogICAgICAgIGlmIChzdG9yYWdlTGltaXRhdGlvbnNGYXRh\nbCB8fCAod2FybiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICB8fCAoIXdhcm4gJiYgbG9nLmlzVHJhY2VFbmFibGVkKCkpKSB7CiAgICAg\nICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInN0b3JhZ2UtcmVzdHJp\nY3Rpb24iLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICBwbGF0Zm9y\nbSwKICAgICAgICAgICAgICAgIG9yaWcsCiAgICAgICAgICAgICAgICBvcmln\nLmdldENsYXNzKCkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgY29udmVy\ndGVkLAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzdG9yYWdl\nTGltaXRhdGlvbnNGYXRhbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihtc2cpOwoKICAgICAgICAgICAgaWYgKHdhcm4pCiAg\nICAgICAgICAgICAgICBsb2cud2Fybihtc2cpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBsb2cudHJhY2UobXNnKTsKICAgICAgICB9CiAg\nICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBUeXBlcwogICAgLy8vLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsg\nVHlwZXN9IGNvbnN0YW50IGZvciB0aGUgZ2l2ZW4KICAgICAqIHtAbGluayBK\nYXZhVHlwZXN9IG9yIHtAbGluayBKYXZhU1FMVHlwZXN9IGNvbnN0YW50Lgog\nICAgICovCiAgICBwdWJsaWMgaW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlw\nZUNvZGUsIGJvb2xlYW4gbG9iKSB7CiAgICAgICAgaWYgKGxvYikgewogICAg\nICAgICAgICBzd2l0Y2ggKG1ldGFUeXBlQ29kZSkgewogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQVNDSUlfU1RSRUFNOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKG1ldGFUeXBlQ29kZSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJJVCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuVElOWUlOVCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgaWYgKHN0b3JlQ2hhcnNBc051\nbWJlcnMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJl\nZFR5cGUoVHlwZXMuSU5URUdFUik7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5DSEFSKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuRE9VQkxFKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBl\nKFR5cGVzLlJFQUwpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5JTlRFR0VS\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CSUdJTlQpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuU01BTExJTlQpOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPQ0FMRToKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVND\nSUlfU1RSRUFNOgogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5DSEFS\nX1NUUkVBTToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CSUdJTlRFR0VSOgogICAgICAgICAgICAgICAgaWYgKHN0b3JlTGFyZ2VO\ndW1iZXJzQXNTdHJpbmdzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklHSU5UKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAg\nICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5W\nQVJDSEFSKTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk5VTUJFUjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVy\nc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkFSUkFZKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhU1FMVHlwZXMuQklOQVJZX1NUUkVBTToKICAgICAgICAg\nICAgY2FzZSBKYXZhU1FMVHlwZXMuQkxPQjoKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuQllURVM6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICBjYXNlIEph\ndmFTUUxUeXBlcy5TUUxfREFURToKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRBVEUpOwogICAgICAgICAgICBjYXNl\nIEphdmFTUUxUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRSk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVy\ncmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9IHR5\ncGUgZm9yIHRoZSBnaXZlbiBvbmUuIFJldHVybnMKICAgICAqIHRoZSBnaXZl\nbiB0eXBlIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nUHJlZmVycmVkVHlwZShpbnQgdHlwZSkgewogICAgICAgIHJldHVybiB0eXBl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQg\nZGF0YWJhc2UgdHlwZSBuYW1lIGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3MgdHlw\nZQogICAgICogZnJvbSB7QGxpbmsgVHlwZXN9LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFR5cGVOYW1lKENvbHVtbiBjb2wpIHsKICAgICAgICBp\nZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoY29sLmdldFR5cGVOYW1lKCkpKQog\nICAgICAgICAgICByZXR1cm4gYXBwZW5kU2l6ZShjb2wsIGNvbC5nZXRUeXBl\nTmFtZSgpKTsKCiAgICAgICAgaWYgKGNvbC5pc0F1dG9Bc3NpZ25lZCgpICYm\nIGF1dG9Bc3NpZ25UeXBlTmFtZSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gYXBwZW5kU2l6ZShjb2wsIGF1dG9Bc3NpZ25UeXBlTmFtZSk7CgogICAg\nICAgIHJldHVybiBhcHBlbmRTaXplKGNvbCwgZ2V0VHlwZU5hbWUoY29sLmdl\ndFR5cGUoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\ndHlwZSBuYW1lIGZvciB0aGUgc3BlY2lmaWMgY29uc3RhbnQgYXMgZGVmaW5l\nZAogICAgICogYnkge0BsaW5rIGphdmEuc3FsLlR5cGVzfS4KICAgICAqCiAg\nICAgKiBAcGFyYW0gdHlwZSB0aGUgdHlwZQogICAgICogQHJldHVybiB0aGUg\nbmFtZSBmb3IgdGhlIHR5cGUKICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRUeXBlTmFtZShpbnQgdHlwZSkgewogICAgICAgIHN3aXRjaCAodHlwZSkg\newogICAgICAgICAgICBjYXNlIFR5cGVzLkFSUkFZOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGFycmF5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuQklHSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIGJpZ2ludFR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJJTkFSWToKICAgICAgICAg\nICAgICAgIHJldHVybiBiaW5hcnlUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CSVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gYml0VHlwZU5h\nbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQkxPQjoKICAgICAgICAgICAg\nICAgIHJldHVybiBibG9iVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgMTY6\nIC8vIEpESyAxLjQgaW50cm9kdWNlcyBUeXBlcy5CT09MRUFOLCB3aG9zZSB2\nYWx1ZSBpcyAxNgogICAgICAgICAgICAgICAgcmV0dXJuIGJvb2xlYW5UeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DSEFSOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGNoYXJUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIGNsb2JUeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGRhdGVUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5ERUNJTUFMOgogICAgICAgICAgICAgICAgcmV0dXJuIGRlY2ltYWxUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ESVNUSU5DVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBkaXN0aW5jdFR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBk\nb3VibGVUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBmbG9hdFR5cGVOYW1lOwogICAgICAg\nICAgICBjYXNlIFR5cGVzLklOVEVHRVI6CiAgICAgICAgICAgICAgICByZXR1\ncm4gaW50ZWdlclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkpB\nVkFfT0JKRUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIGphdmFPYmplY3RU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQklOQVJZ\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmdWYXJiaW5hcnlUeXBlTmFt\nZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiBsb25nVmFyY2hhclR5cGVOYW1lOwogICAgICAg\nICAgICBjYXNlIFR5cGVzLk5VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVtZXJpY1R5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLk9USEVSOgogICAgICAgICAgICAgICAgcmV0\ndXJuIG90aGVyVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVB\nTDoKICAgICAgICAgICAgICAgIHJldHVybiByZWFsVHlwZU5hbWU7CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuUkVGOgogICAgICAgICAgICAgICAgcmV0dXJu\nIHJlZlR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5U\nOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtYWxsaW50VHlwZU5hbWU7CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuU1RSVUNUOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHN0cnVjdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLlRJTUU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZVR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAg\nICAgIHJldHVybiB0aW1lc3RhbXBUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5USU5ZSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbnlp\nbnRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5WQVJCSU5BUlk6\nCiAgICAgICAgICAgICAgICByZXR1cm4gdmFyYmluYXJ5VHlwZU5hbWU7CiAg\nICAgICAgICAgIGNhc2UgVHlwZXMuVkFSQ0hBUjoKICAgICAgICAgICAgICAg\nIHJldHVybiB2YXJjaGFyVHlwZU5hbWU7CiAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gb3RoZXJUeXBlTmFtZTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFk\nZCBzaXplIHByb3BlcnRpZXMgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAg\nICogSWYgcHJlc2VudCwgdGhlIHN0cmluZyAiezB9IiB3aWxsIGJlIHJlcGxh\nY2VkIHdpdGggdGhlIHNpemUgZGVmaW5pdGlvbjsKICAgICAqIG90aGVyd2lz\nZSB0aGUgc2l6ZSBkZWZpbml0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhl\nIHR5cGUgbmFtZS4KICAgICAqIElmIHlvdXIgZGF0YWJhc2UgaGFzIGNvbHVt\nbiB0eXBlcyB0aGF0IGRvbid0IGFsbG93IHNpemUgZGVmaW5pdGlvbnMsCiAg\nICAgKiBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byByZXR1cm4gdGhlIHVuYWx0\nZXJlZCB0eXBlIG5hbWUgZm9yIGNvbHVtbnMgb2YKICAgICAqIHRob3NlIHR5\ncGVzIChvciBhZGQgdGhlIHR5cGUgbmFtZXMgdG8gdGhlCiAgICAgKiA8Y29k\nZT5maXhlZFNpemVUeXBlTmFtZVNldDwvY29kZT4pLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nIGFwcGVuZFNpemUoQ29sdW1uIGNvbCwgU3RyaW5n\nIHR5cGVOYW1lKSB7CiAgICAgICAgaWYgKGZpeGVkU2l6ZVR5cGVOYW1lU2V0\nLmNvbnRhaW5zKHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAg\nICByZXR1cm4gdHlwZU5hbWU7CiAgICAgICAgaWYgKHR5cGVOYW1lLmluZGV4\nT2YoJygnKSAhPSAtMSkKICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lOwoK\nICAgICAgICBTdHJpbmcgc2l6ZSA9IG51bGw7CiAgICAgICAgaWYgKGNvbC5n\nZXRTaXplKCkgPiAwKSB7CiAgICAgICAgICAgIFN0cmluZ0J1ZmZlciBidWYg\nPSBuZXcgU3RyaW5nQnVmZmVyKDEwKTsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiKCIpLmFwcGVuZChjb2wuZ2V0U2l6ZSgpKTsKICAgICAgICAgICAgaWYg\nKGNvbC5nZXREZWNpbWFsRGlnaXRzKCkgPiAwKQogICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiLCAiKS5hcHBlbmQoY29sLmdldERlY2ltYWxEaWdpdHMo\nKSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgICAgICAgICAg\nc2l6ZSA9IGJ1Zi50b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgaW50\nIGlkeCA9IHR5cGVOYW1lLmluZGV4T2YoInswfSIpOwogICAgICAgIGlmIChp\nZHggPT0gLTEgJiYgc2l6ZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndHlwZU5hbWUgKyBzaXplOwogICAgICAgIGlmIChpZHggPT0gLTEpCiAgICAg\nICAgICAgIHJldHVybiB0eXBlTmFtZTsKCiAgICAgICAgLy8gcmVwbGFjZSAn\nezB9JyB3aXRoIHNpemUKICAgICAgICBTdHJpbmcgcmV0ID0gdHlwZU5hbWUu\nc3Vic3RyaW5nKDAsIGlkeCk7CiAgICAgICAgaWYgKHNpemUgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0ID0gcmV0ICsgc2l6ZTsKICAgICAgICBpZiAodHlw\nZU5hbWUubGVuZ3RoKCkgPiBpZHggKyAzKQogICAgICAgICAgICByZXQgPSBy\nZXQgKyB0eXBlTmFtZS5zdWJzdHJpbmcoaWR4ICsgMyk7CiAgICAgICAgcmV0\ndXJuIHJldDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0\ncwogICAgLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFNldCB0aGUgbmFt\nZSBvZiB0aGUgam9pbiBzeW50YXggdG8gdXNlOiBzcWw5MiwgdHJhZGl0aW9u\nYWwsIGRhdGFiYXNlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEpvaW5T\neW50YXgoU3RyaW5nIHN5bnRheCkgewogICAgICAgIGlmICgic3FsOTIiLmVx\ndWFscyhzeW50YXgpKQogICAgICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFY\nX1NRTDkyOwogICAgICAgIGVsc2UgaWYgKCJ0cmFkaXRpb25hbCIuZXF1YWxz\nKHN5bnRheCkpCiAgICAgICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfVFJB\nRElUSU9OQUw7CiAgICAgICAgZWxzZSBpZiAoImRhdGFiYXNlIi5lcXVhbHMo\nc3ludGF4KSkKICAgICAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9EQVRB\nQkFTRTsKICAgICAgICBlbHNlIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShz\neW50YXgpKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uKHN5bnRheCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBTUUwgc3RyaW5nIHRvIGFjdCBhcyBhIHBsYWNlaG9sZGVyIGZvciB0\naGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFBsYWNlaG9sZGVyVmFsdWVTdHJpbmcoQ29sdW1uIGNvbCkgewogICAgICAg\nIHN3aXRjaCAoY29sLmdldFR5cGUoKSkgewogICAgICAgICAgICBjYXNlIFR5\ncGVzLkJJR0lOVDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSVQ6CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBU\neXBlcy5OVU1FUklDOgogICAgICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5U\nOgogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTllJTlQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gIjAiOwogICAgICAgICAgICBjYXNlIFR5cGVzLkNIQVI6\nCiAgICAgICAgICAgICAgICByZXR1cm4gKHN0b3JlQ2hhcnNBc051bWJlcnMp\nID8gIjAiIDogIicgJyI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0xPQjoK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5WQVJDSEFSOgogICAgICAgICAgICAgICAgcmV0dXJu\nICInJyI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuREFURToKICAgICAgICAg\nICAgICAgIHJldHVybiBaRVJPX0RBVEVfU1RSOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLkRFQ0lNQUw6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuRE9VQkxF\nOgogICAgICAgICAgICBjYXNlIFR5cGVzLkZMT0FUOgogICAgICAgICAgICBj\nYXNlIFR5cGVzLlJFQUw6CiAgICAgICAgICAgICAgICByZXR1cm4gIjAuMCI7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElNRToKICAgICAgICAgICAgICAg\nIHJldHVybiBaRVJPX1RJTUVfU1RSOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX1RJTUVT\nVEFNUF9TVFI7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gIk5VTEwiOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhIFNFTEVDVCBDT1VOVCBzdGF0ZW1lbnQgaW4gdGhlIHBy\nb3BlciBqb2luIHN5bnRheCBmb3IgdGhlCiAgICAgKiBnaXZlbiBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50\nKFNlbGVjdCBzZWwpIHsKICAgICAgICBTUUxCdWZmZXIgc2VsZWN0U1FMID0g\nbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBTUUxCdWZmZXIgZnJvbTsK\nICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpOwogICAgICAg\nIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAg\nIGZyb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwgZmFsc2UpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgZnJvbSA9IGdldEZyb20oc2VsLCBmYWxzZSk7CiAg\nICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0V2hlcmUoc2VsLCBmYWxzZSk7\nCgogICAgICAgIC8vIGlmIG5vIGdyb3VwaW5nIGFuZCBubyByYW5nZSwgd2Ug\nbWlnaHQgYmUgYWJsZSB0byBnZXQgYnkgd2l0aG91dAogICAgICAgIC8vIGEg\nc3Vic2VsZWN0CiAgICAgICAgaWYgKHNlbC5nZXRHcm91cGluZygpID09IG51\nbGwgJiYgc2VsLmdldFN0YXJ0SW5kZXgoKSA9PSAwCiAgICAgICAgICAgICYm\nIHNlbC5nZXRFbmRJbmRleCgpID09IExvbmcuTUFYX1ZBTFVFKSB7CiAgICAg\nICAgICAgIC8vIGlmIHRoZSBzZWxlY3QgaGFzIG5vIGlkZW50aWZpZXIgY29s\ncywgdXNlIENPVU5UKCopCiAgICAgICAgICAgIExpc3QgYWxpYXNlcyA9ICgh\nc2VsLmlzRGlzdGluY3QoKSkgPyBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUCiAg\nICAgICAgICAgICAgICA6IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNlcygpOwog\nICAgICAgICAgICBpZiAoYWxpYXNlcy5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKCopIik7CiAgICAgICAg\nICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9t\nLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAg\nICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSBzaW5nbGUgZGlz\ndGluY3QgY29sLCB1c2UgQ09VTlQoRElTVElOQ1QgY29sKQogICAgICAgICAg\nICBpZiAoYWxpYXNlcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICAgICAg\nc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoRElTVElOQ1QgIikuCiAgICAgICAg\nICAgICAgICAgICAgYXBwZW5kKGFsaWFzZXMuZ2V0KDApLnRvU3RyaW5nKCkp\nLmFwcGVuZCgiKSIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0\nKHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51\nbGwsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25n\nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNh\nbiB3ZSBjb21iaW5lIGRpc3RpbmN0IGNvbHM/CiAgICAgICAgICAgIGlmIChk\naXN0aW5jdENvdW50Q29sdW1uU2VwYXJhdG9yICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKERJU1RJTkNUICIp\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2Vz\nLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAw\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQo\nIiAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVu\nZChkaXN0aW5jdENvdW50Q29sdW1uU2VwYXJhdG9yKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiICIpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBw\nZW5kKGFsaWFzZXMuZ2V0KGkpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiKSIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwgbnVs\nbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51bGwsCiAgICAgICAgICAg\nICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHNpbmNlIHdlIGNh\nbid0IGNvbWJpbmUgZGlzdGluY3QgY29scywgd2UgaGF2ZSB0byBwZXJmb3Jt\nIGFuIG91dGVyCiAgICAgICAgLy8gQ09VTlQoKikgc2VsZWN0IHVzaW5nIHRo\nZSBvcmlnaW5hbCBzZWxlY3QgYXMgYSBzdWJzZWxlY3QgaW4gdGhlCiAgICAg\nICAgLy8gRlJPTSBjbGF1c2UKICAgICAgICBhc3NlcnRTdXBwb3J0KHN1cHBv\ncnRzU3Vic2VsZWN0LCAiU3VwcG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAg\nU1FMQnVmZmVyIHN1YlNlbGVjdCA9IGdldFNlbGVjdHMoc2VsLCB0cnVlLCBm\nYWxzZSk7CiAgICAgICAgU1FMQnVmZmVyIHN1YkZyb20gPSBmcm9tOwogICAg\nICAgIGZyb20gPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGZyb20u\nYXBwZW5kKCIoIik7CiAgICAgICAgZnJvbS5hcHBlbmQodG9TZWxlY3Qoc3Vi\nU2VsZWN0LCBudWxsLCBzdWJGcm9tLCB3aGVyZSwKICAgICAgICAgICAgc2Vs\nLmdldEdyb3VwaW5nKCksIHNlbC5nZXRIYXZpbmcoKSwgbnVsbCwgc2VsLmlz\nRGlzdGluY3QoKSwKICAgICAgICAgICAgZmFsc2UsIHNlbC5nZXRTdGFydElu\nZGV4KCksIHNlbC5nZXRFbmRJbmRleCgpKSk7CiAgICAgICAgZnJvbS5hcHBl\nbmQoIikiKTsKICAgICAgICBpZiAocmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVj\ndCkKICAgICAgICAgICAgZnJvbS5hcHBlbmQoIiAiKS5hcHBlbmQoU2VsZWN0\nLkZST01fU0VMRUNUX0FMSUFTKTsKCiAgICAgICAgc2VsZWN0U1FMLmFwcGVu\nZCgiQ09VTlQoKikiKTsKICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0\nU1FMLCBudWxsLCBmcm9tLCBudWxsLCBudWxsLCBudWxsLCBudWxsLAogICAg\nICAgICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIERFTEVURSBzdGF0ZW1lbnQg\nZm9yIHRoZSBzcGVjaWZpZWQgU2VsZWN0LiBJZiB0aGUKICAgICAqIGRhdGFi\nYXNlIGRvZXMgbm90IHN1cHBvcnQgdGhlIGJ1bGsgZGVsZXRlIHN0YXRlbWVu\ndCAoc3VjaCBhcwogICAgICogY2FzZXMgd2hlcmUgYSBzdWJzZWxlY3QgaXMg\ncmVxdWlyZWQgYW5kIHRoZSBkYXRhYmFzZSBkb2Vzbid0IHN1cHBvcnQKICAg\nICAqIHN1YnNlbGVjdHMpLCB0aGlzIG1ldGhvZCBzaG91bGQgcmV0dXJuIG51\nbGwuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9EZWxldGUoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIFNlbGVjdCBzZWwsCiAgICAgICAgSkRCQ1N0\nb3JlIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4g\ndG9CdWxrT3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwgc3RvcmUsIHBhcmFtcywg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b1VwZGF0ZShD\nbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNlbCwKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIE9iamVjdFtdIHBhcmFtcywgTWFwIHVwZGF0ZXMpIHsK\nICAgICAgICByZXR1cm4gdG9CdWxrT3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwg\nc3RvcmUsIHBhcmFtcywgdXBkYXRlcyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBTUUwgZm9yIGEgYnVsayBvcGVyYXRpb24sIGVpdGhl\nciBhIERFTEVURSBvciBhbiBVUERBVEUuCiAgICAgKgogICAgICogQHBhcmFt\nIG1hcHBpbmcgdGhlIG1hcHBuZyBhZ2FpbnN0IHdoaWNoIHdlIGFyZSBvcGVy\nYXRpbmcKICAgICAqIEBwYXJhbSBzZWwgdGhlIFNlbGVjdCB0aGF0IHdpbGwg\nY29uc3RpdHV0ZSB0aGUgV0hFUkUgY2xhdXNlCiAgICAgKiBAcGFyYW0gc3Rv\ncmUgdGhlIGN1cnJlbnQgc3RvcmUKICAgICAqIEBwYXJhbSB1cGRhdGVQYXJh\nbXMgdGhlIE1hcCB0aGF0IGhvbGRzIHRoZSB1cGRhdGUgcGFyYW1ldGVyczsg\nYSBudWxsCiAgICAgKiB2YWx1ZSBpbmRpY2F0ZXMgdGhhdCB0aGlzIGlzIGEg\nZGVsZXRlIG9wZXJhdGlvbgogICAgICogQHJldHVybiB0aGUgU1FMQnVmZmVy\nIGZvciB0aGUgdXBkYXRlLCBvciA8ZW0+bnVsbDwvZW0+IGlmIGl0IGlzIG5v\ndAogICAgICogcG9zc2libGUgdG8gcGVyZm9ybSB0aGUgYnVsayB1cGRhdGUK\nICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciB0b0J1bGtPcGVyYXRp\nb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFNlbGVjdCBzZWwsCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVQ\nYXJhbXMpIHsKICAgICAgICBTUUxCdWZmZXIgc3FsID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgICBpZiAodXBkYXRlUGFyYW1zID09IG51bGwpCiAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIkRFTEVURSBGUk9NICIpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3FsLmFwcGVuZCgiVVBEQVRFICIpOwogICAg\nICAgIHNlbC5hZGRKb2luQ2xhc3NDb25kaXRpb25zKCk7CgogICAgICAgIC8v\nIGlmIHRoZXJlIGlzIG9ubHkgYSBzaW5nbGUgdGFibGUgaW4gdGhlIHNlbGVj\ndCwgdGhlbiB3ZSBjYW4KICAgICAgICAvLyBqdXN0IGlzc3VlIGEgc2luZ2xl\nIERFTEVURSBGUk9NIFRBQkxFIFdIRVJFIDxjb25kaXRpb25zPgogICAgICAg\nIC8vIHN0YXRlbWVudDsgb3RoZXJ3aXNlLCBzaW5jZSBTUUwgZG9lc24ndCBh\nbGxvdyBkZWxldGluZwogICAgICAgIC8vIGZyb20gb25lIG9mIGEgbXVsdGkt\ndGFibGUgc2VsZWN0LCB3ZSBuZWVkIHRvIGlzc3VlIGEgc3Vic2VsZWN0CiAg\nICAgICAgLy8gbGlrZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSBFWElTVFMK\nICAgICAgICAvLyAoU0VMRUNUIDEgRlJPTSBUQUJMRSB0MCBXSEVSRSB0MC5J\nRCA9IFRBQkxFLklEKTsgYWxzbywgc29tZQogICAgICAgIC8vIGRhdGFiYXNl\ncyBkbyBub3QgYWxsb3cgYWxpYXNlcyBpbiBkZWxldGUgc3RhdGVtZW50cywg\nd2hpY2gKICAgICAgICAvLyBhbHNvIGNhdXNlcyB1cyB0byB1c2UgYSBzdWJz\nZWxlY3QKICAgICAgICBpZiAoc2VsLmdldFRhYmxlQWxpYXNlcygpLnNpemUo\nKSA9PSAxICYmIHN1cHBvcnRzU3Vic2VsZWN0CiAgICAgICAgICAgICYmIGFs\nbG93c0FsaWFzSW5CdWxrQ2xhdXNlKSB7CiAgICAgICAgICAgIFNRTEJ1ZmZl\nciBmcm9tOwogICAgICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxlY3Qo\nc2VsLCBmYWxzZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIGZyb20gPSBnZXRGcm9tKHNlbCwgZmFsc2UpOwoKICAgICAgICAgICAgc3Fs\nLmFwcGVuZChmcm9tKTsKICAgICAgICAgICAgYXBwZW5kVXBkYXRlcyhzZWws\nIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFyYW1zLAogICAgICAgICAg\nICAgICAgYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpOwoKICAgICAgICAgICAg\nU1FMQnVmZmVyIHdoZXJlID0gc2VsLmdldFdoZXJlKCk7CiAgICAgICAgICAg\nIGlmICh3aGVyZSAhPSBudWxsICYmICF3aGVyZS5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBXSEVSRSAiKTsKICAgICAgICAg\nICAgICAgIHNxbC5hcHBlbmQod2hlcmUpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiBzcWw7CiAgICAgICAgfQoKICAgICAgICBUYWJsZSB0\nYWJsZSA9IG1hcHBpbmcuZ2V0VGFibGUoKTsKICAgICAgICBTdHJpbmcgdGFi\nbGVOYW1lID0gZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKTsKCiAgICAgICAg\nLy8gb25seSB1c2UgYSAgc3Vic2VsZWN0IGlmIHRoZSB3aGVyZSBpcyBub3Qg\nZW1wdHk7IG90aGVyd2lzZQogICAgICAgIC8vIGFuIHVucXVhbGlmaWVkIGRl\nbGV0ZSBvciB1cGRhdGUgd2lsbCB3b3JrCiAgICAgICAgaWYgKHNlbC5nZXRX\naGVyZSgpID09IG51bGwgfHwgc2VsLmdldFdoZXJlKCkuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICAg\nICAgYXBwZW5kVXBkYXRlcyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBk\nYXRlUGFyYW1zLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybiBzcWw7CiAg\nICAgICAgfQoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHVzZSBhIHN1YnNlbGVj\ndCBpZiB3ZSBhcmUgdG8gYnVsayBkZWxldGUgd2hlcmUKICAgICAgICAvLyB0\naGUgc2VsZWN0IGluY2x1ZGVzIG11bHRpcGxlIHRhYmxlczsgaWYgdGhlIGRh\ndGFiYXNlCiAgICAgICAgLy8gZG9lc24ndCBzdXBwb3J0IGl0LCB0aGVuIHdl\nIG5lZWQgdG8gc2lnYWwgdGhpcyBieSByZXR1cm5pbmcgbnVsbAogICAgICAg\nIGlmICghc3VwcG9ydHNTdWJzZWxlY3QgfHwgIXN1cHBvcnRzQ29ycmVsYXRl\nZFN1YnNlbGVjdCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIENvbHVtbltdIHBrcyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMo\nKTsKICAgICAgICBzZWwuY2xlYXJTZWxlY3RzKCk7CiAgICAgICAgc2VsLnNl\ndERpc3RpbmN0KHRydWUpOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlIG9ubHkg\nYSBzaW5nbGUgUEssIHdlIGNhbiB1c2UgYSBub24tY29ycmVsYXRlZAogICAg\nICAgIC8vIHN1YnF1ZXJ5ICh1c2luZyBhbiBJTiBzdGF0ZW1lbnQpLCB3aGlj\naCBpcyBtdWNoIGZhc3RlciB0aGFuCiAgICAgICAgLy8gYSBjb3JyZWxhdGVk\nIHN1YnF1ZXJ5IChzaW5jZSBhIGNvcnJlbGF0ZWQgc3VicXVlcnkgbmVlZHMK\nICAgICAgICAvLyB0byBiZSBleGVjdXRlZCBvbmNlIGZvciBlYWNoIHJvdyBp\nbiB0aGUgdGFibGUpCiAgICAgICAgaWYgKHBrcy5sZW5ndGggPT0gMSkgewog\nICAgICAgICAgICBzZWwuc2VsZWN0KHBrc1swXSk7CiAgICAgICAgICAgIHNx\nbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICAgICAgYXBwZW5kVXBkYXRl\ncyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFyYW1zLCBmYWxz\nZSk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiBXSEVSRSAiKS4KICAgICAg\nICAgICAgICAgIGFwcGVuZChwa3NbMF0pLmFwcGVuZCgiIElOICgiKS4KICAg\nICAgICAgICAgICAgIGFwcGVuZChzZWwudG9TZWxlY3QoZmFsc2UsIG51bGwp\nKS5hcHBlbmQoIikiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBz\nZWwuY2xlYXJTZWxlY3RzKCk7CiAgICAgICAgICAgIHNlbC5zZXREaXN0aW5j\ndChmYWxzZSk7CgogICAgICAgICAgICAvLyBzaW5jZSB0aGUgc2VsZWN0IGlz\nIHVzaW5nIGEgY29ycmVsYXRlZCBzdWJxdWVyeSwgd2UKICAgICAgICAgICAg\nLy8gb25seSBuZWVkIHRvIHNlbGVjdCBhIGJvZ3VzIHZpcnR1YWwgY29sdW1u\nCiAgICAgICAgICAgIHNlbC5zZWxlY3QoIjEiLCBudWxsKTsKCiAgICAgICAg\nICAgIC8vIGFkZCBpbiB0aGUgam9pbnMgdG8gdGhlIHRhYmxlCiAgICAgICAg\nICAgIENvbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRQcmltYXJ5S2V5KCkuZ2V0\nQ29sdW1ucygpOwogICAgICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNR\nTEJ1ZmZlcih0aGlzKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCIpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGlmIChpID4gMCkKICAgICAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwoKICAgICAgICAgICAgICAg\nIC8vIGFkZCBpbiAidDAuUEsgPSBNWVRBQkxFLlBLIgogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sc1tpXSwgbnVs\nbCkpLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5k\nKHRhYmxlKS5hcHBlbmQoY2F0YWxvZ1NlcGFyYXRvcikuYXBwZW5kKGNvbHNb\naV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiki\nKTsKICAgICAgICAgICAgc2VsLndoZXJlKGJ1ZiwgbnVsbCk7CgogICAgICAg\nICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVu\nZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFt\ncywgZmFsc2UpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgRVhJ\nU1RTICgiKS4KICAgICAgICAgICAgICAgIGFwcGVuZChzZWwudG9TZWxlY3Qo\nZmFsc2UsIG51bGwpKS5hcHBlbmQoIikiKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHNxbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRV\ncGRhdGVzKFNlbGVjdCBzZWwsIEpEQkNTdG9yZSBzdG9yZSwgU1FMQnVmZmVy\nIHNxbCwKICAgICAgICBPYmplY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVQYXJh\nbXMsIGJvb2xlYW4gYWxsb3dBbGlhcykgewogICAgICAgIGlmICh1cGRhdGVQ\nYXJhbXMgPT0gbnVsbCB8fCB1cGRhdGVQYXJhbXMuc2l6ZSgpID09IDApCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gbWFudWFsbHkgYnVpbGQg\ndXAgdGhlIFNFVCBjbGF1c2UgZm9yIHRoZSBVUERBVEUgc3RhdGVtZW50CiAg\nICAgICAgc3FsLmFwcGVuZCgiIFNFVCAiKTsKICAgICAgICBFeHBDb250ZXh0\nIGN0eCA9IG5ldyBFeHBDb250ZXh0KHN0b3JlLCBwYXJhbXMsIAogICAgICAg\nICAgICBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpID0gdXBkYXRlUGFyYW1zLmVudHJ5U2V0KCkuaXRl\ncmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE1hcC5FbnRy\neSBuZXh0ID0gKE1hcC5FbnRyeSkgaS5uZXh0KCk7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gKEZpZWxkTWV0YURhdGEpIG5leHQuZ2V0S2V5\nKCk7CiAgICAgICAgICAgIFZhbCB2YWwgPSAoVmFsKSBuZXh0LmdldFZhbHVl\nKCk7CgogICAgICAgICAgICBDb2x1bW4gY29sID0gKChGaWVsZE1hcHBpbmcp\nIGZtZCkuZ2V0Q29sdW1ucygpWzBdOwogICAgICAgICAgICBzcWwuYXBwZW5k\nKGNvbC5nZXROYW1lKCkpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgPSAi\nKTsKCiAgICAgICAgICAgIEV4cFN0YXRlIHN0YXRlID0gdmFsLmluaXRpYWxp\nemUoc2VsLCBjdHgsIDApOwogICAgICAgICAgICB2YWwuY2FsY3VsYXRlVmFs\ndWUoc2VsLCBjdHgsIHN0YXRlLCBudWxsLCBudWxsKTsKCiAgICAgICAgICAg\nIC8vIGFwcGVuZCB0aGUgdmFsdWUgd2l0aCBhIG51bGwgZm9yIHRoZSBTZWxl\nY3Q7IGkKICAgICAgICAgICAgLy8gaW5kaWNhdGVzIHRoYXQgdGhlCiAgICAg\nICAgICAgIGludCBsZW5ndGggPSB2YWwubGVuZ3RoKHNlbCwgY3R4LCBzdGF0\nZSk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgbGVuZ3RoOyBq\nKyspCiAgICAgICAgICAgICAgICB2YWwuYXBwZW5kVG8oKGFsbG93QWxpYXMp\nID8gc2VsIDogbnVsbCwgY3R4LCBzdGF0ZSwgc3FsLCBqKTsKCiAgICAgICAg\nICAgIGlmIChpLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIHNxbC5hcHBl\nbmQoIiwgIik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgU0VMRUNUIHN0YXRlbWVudCBpbiB0aGUgcHJvcGVyIGpvaW4gc3lu\ndGF4IGZvciB0aGUgZ2l2ZW4KICAgICAqIGluc3RhbmNlLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNlbGVjdCBzZWwsIGJvb2xl\nYW4gZm9yVXBkYXRlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gpIHsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygp\nOwogICAgICAgIGJvb2xlYW4gdXBkYXRlID0gZm9yVXBkYXRlICYmIHNlbC5n\nZXRGcm9tU2VsZWN0KCkgPT0gbnVsbDsKICAgICAgICBTUUxCdWZmZXIgc2Vs\nZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIGZhbHNlLCB1cGRhdGUpOwogICAgICAg\nIFNRTEJ1ZmZlciBvcmRlcmluZyA9IG51bGw7CiAgICAgICAgaWYgKCFzZWwu\naXNBZ2dyZWdhdGUoKSB8fCBzZWwuZ2V0R3JvdXBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICBvcmRlcmluZyA9IHNlbC5nZXRPcmRlcmluZygpOwogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNl\nbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tU2Vs\nZWN0KHNlbCwgZm9yVXBkYXRlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGZyb20gPSBnZXRGcm9tKHNlbCwgdXBkYXRlKTsKICAgICAgICBTUUxCdWZm\nZXIgd2hlcmUgPSBnZXRXaGVyZShzZWwsIHVwZGF0ZSk7CiAgICAgICAgcmV0\ndXJuIHRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIGZyb20sIHdoZXJlLCBzZWwu\nZ2V0R3JvdXBpbmcoKSwKICAgICAgICAgICAgc2VsLmdldEhhdmluZygpLCBv\ncmRlcmluZywgc2VsLmlzRGlzdGluY3QoKSwgZm9yVXBkYXRlLAogICAgICAg\nICAgICBzZWwuZ2V0U3RhcnRJbmRleCgpLCBzZWwuZ2V0RW5kSW5kZXgoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvcnRpb24gb2Yg\ndGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0d2VlbiB0aGUgRlJPTSBrZXl3b3Jk\nCiAgICAgKiBhbmQgdGhlIFdIRVJFIGtleXdvcmQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTUUxCdWZmZXIgZ2V0RnJvbShTZWxlY3Qgc2VsLCBib29sZWFu\nIGZvclVwZGF0ZSkgewogICAgICAgIFNRTEJ1ZmZlciBmcm9tU1FMID0gbmV3\nIFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBDb2xsZWN0aW9uIGFsaWFzZXMg\nPSBzZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAgICAgICAgaWYgKGFsaWFzZXMu\nc2l6ZSgpIDwgMiB8fCBzZWwuZ2V0Sm9pblN5bnRheCgpICE9IFNZTlRBWF9T\nUUw5MikgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFz\nZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIGZyb21TUUwuYXBwZW5kKGl0ci5uZXh0KCkudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxlRm9yVXBkYXRl\nQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5h\ncHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAg\nICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAg\nICAgICAgZnJvbVNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBJdGVyYXRvciBpdHIgPSBzZWwu\nZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGJvb2xlYW4gZmlyc3Qg\nPSB0cnVlOwogICAgICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewog\nICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQodG9TUUw5MkpvaW4oKEpv\naW4pIGl0ci5uZXh0KCksIGZvclVwZGF0ZSwKICAgICAgICAgICAgICAgICAg\nICBmaXJzdCkpOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZnJvbVNRTDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgRlJPTSBjbGF1c2Ug\nZm9yIGEgc2VsZWN0IHRoYXQgc2VsZWN0cyBmcm9tIGEgdG1wIHRhYmxlCiAg\nICAgKiBjcmVhdGVkIGJ5IGFuIGlubmVyIHNlbGVjdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWws\nIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVmZmVyIGZyb21T\nUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGZyb21TUUwuYXBw\nZW5kKCIoIik7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQodG9TZWxlY3Qoc2Vs\nLmdldEZyb21TZWxlY3QoKSwgZm9yVXBkYXRlLCBudWxsKSk7CiAgICAgICAg\nZnJvbVNRTC5hcHBlbmQoIikiKTsKICAgICAgICBpZiAocmVxdWlyZXNBbGlh\nc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAi\nKS5hcHBlbmQoU2VsZWN0LkZST01fU0VMRUNUX0FMSUFTKTsKICAgICAgICBy\nZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgV0hFUkUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRlbWVudCwgb3Ig\nbnVsbCBpZiBubyB3aGVyZQogICAgICogY29uZGl0aW9ucy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRXaGVyZShTZWxlY3Qgc2VsLCBi\nb29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIEpvaW5zIGpvaW5zID0gc2Vs\nLmdldEpvaW5zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRKb2luU3ludGF4KCkg\nPT0gU1lOVEFYX1NRTDkyCiAgICAgICAgICAgIHx8IGpvaW5zID09IG51bGwg\nfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gc2VsLmdl\ndFdoZXJlKCk7CgogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxC\ndWZmZXIodGhpcyk7CiAgICAgICAgaWYgKHNlbC5nZXRXaGVyZSgpICE9IG51\nbGwpCiAgICAgICAgICAgIHdoZXJlLmFwcGVuZChzZWwuZ2V0V2hlcmUoKSk7\nCiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5h\ncHBlbmQod2hlcmUsIGpvaW5zKTsKICAgICAgICByZXR1cm4gd2hlcmU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFu\nY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAq\nIHRoZSB0cmFkaXRpb25hbCBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciB0b1RyYWRpdGlvbmFsSm9pbihKb2luIGpvaW4pIHsKICAgICAg\nICBGb3JlaWduS2V5IGZrID0gam9pbi5nZXRGb3JlaWduS2V5KCk7CiAgICAg\nICAgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBib29sZWFuIGludmVyc2UgPSBqb2luLmlzRm9yZWlnbktleUlu\ndmVyc2VkKCk7CiAgICAgICAgQ29sdW1uW10gZnJvbSA9IChpbnZlcnNlKSA/\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5n\nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG8gPSAoaW52ZXJzZSkg\nPyBmay5nZXRDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpOwoKICAgICAgICAvLyBkbyBjb2x1bW4gam9pbnMKICAg\nICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAg\nICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZnJvbS5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICBp\nZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFO\nRCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgp\nKS5hcHBlbmQoIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4u\nZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0b1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBkbyBjb25zdGFudCBqb2lucwogICAgICAgIENv\nbHVtbltdIGNvbnN0Q29scyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RDb2xzLmxlbmd0aDsg\naSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1\nZShmay5nZXRDb25zdGFudChjb25zdENvbHNbaV0pLCBjb25zdENvbHNbaV0p\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAg\nICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0pOwogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMigpKS5hcHBl\nbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoY29uc3RDb2xz\nW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNvbnN0Q29sc1tpXSksIGNvbnN0\nQ29sc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb25zdENv\nbHNQSyA9IGZrLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnN0Q29sc1BLLmxlbmd0aDsg\naSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9p\nbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAg\nICAgYXBwZW5kKGNvbnN0Q29sc1BLW2ldKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlL\nZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlLZXlDb25zdGFudChj\nb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAgICAgY29uc3RDb2xz\nUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLgogICAgICAg\nICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNQS1tpXSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBV\nc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2lu\naW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBTUUw5MiBzdHlsZS4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NRTDkySm9pbihKb2luIGpv\naW4sIGJvb2xlYW4gZm9yVXBkYXRlLCBib29sZWFuIGZpcnN0KSB7CiAgICAg\nICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAg\nICAgaWYgKGZpcnN0KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5n\nZXRUYWJsZTEoKSkuYXBwZW5kKCIgIikuCiAgICAgICAgICAgICAgICBhcHBl\nbmQoam9pbi5nZXRBbGlhczEoKSk7CiAgICAgICAgICAgIGlmIChmb3JVcGRh\ndGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVD\nbGF1c2UpOwogICAgICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwog\nICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQob3V0ZXJKb2luQ2xhdXNlKTsKICAg\nICAgICBlbHNlIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5O\nRVIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoaW5uZXJKb2luQ2xhdXNlKTsK\nICAgICAgICBlbHNlIC8vIGNyb3NzCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nY3Jvc3NKb2luQ2xhdXNlKTsKICAgICAgICBidWYuYXBwZW5kKCIgIik7Cgog\nICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTIoKSkuYXBwZW5kKCIg\nIikuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpOwogICAgICAgIGlmIChmb3JV\ncGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNs\nYXVzZSk7CgogICAgICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBu\ndWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKHRv\nVHJhZGl0aW9uYWxKb2luKGpvaW4pKTsKICAgICAgICBlbHNlIGlmIChyZXF1\naXJlc0NvbmRpdGlvbkZvckNyb3NzSm9pbiAmJgogICAgICAgICAgICBqb2lu\nLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfQ1JPU1MpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBPTiAoMSA9IDEpIik7CgogICAgICAgIHJldHVybiBidWY7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5z\ndGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAg\nICAqIHRoZSBkYXRhYmFzZSdzIG5hdGl2ZSBzeW50YXguIFRocm93cyBhbiBl\neGNlcHRpb24gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b05hdGl2ZUpvaW4oSm9pbiBqb2luKSB7CiAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIGlmIHRoZSBnaXZlbiBmb3JlaWduIGtleSBjYW4gYmUg\nZWFnZXJseSBsb2FkZWQgdXNpbmcgb3RoZXIgam9pbnMuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGNhbk91dGVySm9pbihpbnQgc3ludGF4LCBGb3Jl\naWduS2V5IGZrKSB7CiAgICAgICAgcmV0dXJuIHN5bnRheCAhPSBTWU5UQVhf\nVFJBRElUSU9OQUw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRo\nZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZl\nciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZl\nciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIg\nb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JV\ncGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgcmV0dXJu\nIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVj\ndHMsIGZyb20sIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBv\ncmRlciwgZGlzdGluY3QsIGZvclVwZGF0ZSwgc3RhcnQsIGVuZCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlICJTRUxFQ1QiIG9wZXJhdGlv\nbiBjbGF1c2UsIGFkZGluZyBhbnkgYXZhaWxhYmxlIGhpbnRzLCBldGMuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U2VsZWN0T3BlcmF0aW9uKEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4g\nIlNFTEVDVCI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNR\nTCBmb3IgdGhlIGdpdmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9w\nLCBTUUxCdWZmZXIgc2VsZWN0cywgCiAgICAgICAgU1FMQnVmZmVyIGZyb20s\nIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLCBTUUxCdWZmZXIg\naGF2aW5nLCAKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4gZGlz\ndGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCAKICAgICAg\nICBsb25nIGVuZCkgewogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FM\nQnVmZmVyKHRoaXMpOwogICAgICAgIGJ1Zi5hcHBlbmQob3ApOwoKICAgICAg\nICBib29sZWFuIHJhbmdlID0gc3RhcnQgIT0gMCB8fCBlbmQgIT0gTG9uZy5N\nQVhfVkFMVUU7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRpb24g\nPT0gUkFOR0VfUFJFX0RJU1RJTkNUKQogICAgICAgICAgICBhcHBlbmRTZWxl\nY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQpOwogICAgICAgIGlmIChkaXN0aW5j\ndCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIERJU1RJTkNUIik7CiAgICAg\nICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9E\nSVNUSU5DVCkKICAgICAgICAgICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVmLCBz\ndGFydCwgZW5kKTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChz\nZWxlY3RzKS5hcHBlbmQoIiBGUk9NICIpLmFwcGVuZChmcm9tKTsKCiAgICAg\nICAgaWYgKHdoZXJlICE9IG51bGwgJiYgIXdoZXJlLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIFdIRVJFICIpLmFwcGVuZCh3aGVyZSk7\nCiAgICAgICAgaWYgKGdyb3VwICE9IG51bGwgJiYgIWdyb3VwLmlzRW1wdHko\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEdST1VQIEJZICIpLmFwcGVu\nZChncm91cCk7CiAgICAgICAgaWYgKGhhdmluZyAhPSBudWxsICYmICFoYXZp\nbmcuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3Vw\ncG9ydHNIYXZpbmcsICJTdXBwb3J0c0hhdmluZyIpOwogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgSEFWSU5HICIpLmFwcGVuZChoYXZpbmcpOwogICAgICAg\nIH0KICAgICAgICBpZiAob3JkZXIgIT0gbnVsbCAmJiAhb3JkZXIuaXNFbXB0\neSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgT1JERVIgQlkgIikuYXBw\nZW5kKG9yZGVyKTsKICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlv\nbiA9PSBSQU5HRV9QT1NUX1NFTEVDVCkKICAgICAgICAgICAgYXBwZW5kU2Vs\nZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5kKTsKCiAgICAgICAgaWYgKGZvclVw\nZGF0ZSAmJiAhc2ltdWxhdGVMb2NraW5nKSB7CiAgICAgICAgICAgIGFzc2Vy\ndFN1cHBvcnQoc3VwcG9ydHNTZWxlY3RGb3JVcGRhdGUsICJTdXBwb3J0c1Nl\nbGVjdEZvclVwZGF0ZSIpOwogICAgICAgICAgICBpZiAoZm9yVXBkYXRlQ2xh\ndXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgIiku\nYXBwZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQogICAgICAgIGlm\nIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfTE9DSykK\nICAgICAgICAgICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5k\nKTsKICAgICAgICByZXR1cm4gYnVmOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhpcyBkaWN0aW9uYXJ5IGNhbiBzZWxlY3QgcmFuZ2VzLAogICAgICog\ndXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB0aGUgcmFuZ2UgU1FMLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRTZWxlY3RSYW5nZShTUUxC\ndWZmZXIgYnVmLCBsb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwb3J0aW9uIG9mIHRoZSBzZWxlY3Qg\nc3RhdGVtZW50IGJldHdlZW4gdGhlIFNFTEVDVCBrZXl3b3JkCiAgICAgKiBh\nbmQgdGhlIEZST00ga2V5d29yZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNR\nTEJ1ZmZlciBnZXRTZWxlY3RzKFNlbGVjdCBzZWwsIGJvb2xlYW4gZGlzdGlu\nY3RJZGVudGlmaWVycywKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSkgewog\nICAgICAgIC8vIGFwcGVuZCB0aGUgYWxpYXNlcyBmb3IgYWxsIHRoZSBjb2x1\nbW5zCiAgICAgICAgU1FMQnVmZmVyIHNlbGVjdFNRTCA9IG5ldyBTUUxCdWZm\nZXIodGhpcyk7CiAgICAgICAgTGlzdCBhbGlhc2VzOwogICAgICAgIGlmIChk\naXN0aW5jdElkZW50aWZpZXJzKQogICAgICAgICAgICBhbGlhc2VzID0gc2Vs\nLmdldElkZW50aWZpZXJBbGlhc2VzKCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBhbGlhc2VzID0gc2VsLmdldFNlbGVjdEFsaWFzZXMoKTsKCiAgICAg\nICAgT2JqZWN0IGFsaWFzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nYWxpYXNlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBhbGlhcyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhbGlh\ncyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgICAgIHNlbGVj\ndFNRTC5hcHBlbmQoKFNRTEJ1ZmZlcikgYWxpYXMpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGFsaWFzLnRv\nU3RyaW5nKCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAg\nICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzZWxlY3RTUUw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRydWUgaWYgYSAiRk9SIFVQREFURSIgY2xhdXNlIGNh\nbiBiZSB1c2VkIGZvciB0aGUgc3BlY2lmaWVkCiAgICAgKiBTZWxlY3Qgb2Jq\nZWN0LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tp\nbmcoU2VsZWN0IHNlbCkgewogICAgICAgIGlmIChzZWwuaXNBZ2dyZWdhdGUo\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3Vw\ncG9ydHNTZWxlY3RGb3JVcGRhdGUpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhTZWxlY3RSYW5n\nZSAmJiAoc2VsLmdldFN0YXJ0SW5kZXgoKSAhPSAwCiAgICAgICAgICAgIHx8\nIHNlbC5nZXRFbmRJbmRleCgpICE9IExvbmcuTUFYX1ZBTFVFKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBvbmx5IGlubmVyIHNl\nbGVjdCBpcyBsb2NrZWQKICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3Qo\nKSAhPSBudWxsKQogICAgICAgICAgICBzZWwgPSBzZWwuZ2V0RnJvbVNlbGVj\ndCgpOwoKICAgICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5j\ndENsYXVzZSAmJiBzZWwuaXNEaXN0aW5jdCgpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoTXVs\ndGlwbGVUYWJsZXMKICAgICAgICAgICAgJiYgc2VsLmdldFRhYmxlQWxpYXNl\ncygpLnNpemUoKSA+IDEpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhPcmRlckNsYXVzZSAmJiBz\nZWwuZ2V0T3JkZXJpbmcoKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoT3V0ZXJK\nb2luIHx8ICFzdXBwb3J0c0xvY2tpbmdXaXRoSW5uZXJKb2luKSB7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc2VsLmdldEpvaW5JdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgSm9pbiBq\nb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nIXN1cHBvcnRzTG9ja2luZ1dpdGhPdXRlckpvaW4KICAgICAgICAgICAgICAg\nICAgICAmJiBqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAg\nICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoSW5uZXJKb2luCiAgICAgICAg\nICAgICAgICAgICAgJiYgam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lO\nTkVSKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBmYWxzZSBpZiB0aGUgZ2l2ZW4gc2Vs\nZWN0IHJlcXVpcmVzIGEgZm9yd2FyZC1vbmx5IHJlc3VsdCBzZXQuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNjZXNzUmVz\ndWx0U2V0KFNlbGVjdCBzZWwsCiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUp\nIHsKICAgICAgICByZXR1cm4gIXNlbC5pc0FnZ3JlZ2F0ZSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhlIGdpdmVuIGRpY3Rpb25h\ncnkgZmxhZyBpcyB0cnVlLiBJZiBpdCBpcyBub3QgdHJ1ZSwKICAgICAqIHRo\ncm93IGFuIGVycm9yIHNheWluZyB0aGF0IHRoZSBnaXZlbiBzZXR0aW5nIG5l\nZWRzIHRvIHJldHVybiB0cnVlIGZvcgogICAgICogdGhlIGN1cnJlbnQgb3Bl\ncmF0aW9uIHRvIHdvcmsuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzc2Vy\ndFN1cHBvcnQoYm9vbGVhbiBmZWF0dXJlLCBTdHJpbmcgcHJvcGVydHkpIHsK\nICAgICAgICBpZiAoIWZlYXR1cmUpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiZmVhdHVyZS1ub3Qtc3Vw\ncG9ydGVkIiwKICAgICAgICAgICAgICAgIGdldENsYXNzKCksIHByb3BlcnR5\nKSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFF1\nZXJ5IGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAv\nKioKICAgICAqIEludm9rZSB0aGlzIGRhdGFiYXNlJ3Mgc3Vic3RyaW5nIGZ1\nbmN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZm\nZXIgdG8gd3JpdGUgdGhlIHN1YnN0cmluZyBpbnZvY2F0aW9uIHRvCiAgICAg\nKiBAcGFyYW0gc3RyIGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSB0\nYXJnZXQgc3RyaW5nCiAgICAgKiBAcGFyYW0gc3RhcnQgYSBxdWVyeSB2YWx1\nZSByZXByZXNlbnRpbmcgdGhlIHN0YXJ0IGluZGV4CiAgICAgKiBAcGFyYW0g\nZW5kIGEgcXVlcnkgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBlbmQgaW5kZXgs\nIG9yIG51bGwgZm9yIG5vbmUKICAgICAqLwogICAgcHVibGljIHZvaWQgc3Vi\nc3RyaW5nKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHN0ciwgRmlsdGVy\nVmFsdWUgc3RhcnQsCiAgICAgICAgRmlsdGVyVmFsdWUgZW5kKSB7CiAgICAg\nICAgYnVmLmFwcGVuZChzdWJzdHJpbmdGdW5jdGlvbk5hbWUpLmFwcGVuZCgi\nKCgiKTsKICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYu\nYXBwZW5kKCIpLCAoIik7CiAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsK\nICAgICAgICBidWYuYXBwZW5kKCIgKyAxKSIpOwogICAgICAgIGlmIChlbmQg\nIT0gbnVsbCkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIsICgiKTsKICAg\nICAgICAgICAgZW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiAtICgiKTsKICAgICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVm\nKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSkiKTsKICAgICAgICB9CiAg\nICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIC8qKgogICAgICog\nSW52b2tlIHRoaXMgZGF0YWJhc2UncyBpbmRleE9mIGZ1bmN0aW9uLgogICAg\nICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUg\ndGhlIGluZGV4T2YgaW52b2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0ciBh\nIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmluZwog\nICAgICogQHBhcmFtIGZpbmQgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcg\ndGhlIHNlYXJjaCBzdHJpbmcKICAgICAqIEBwYXJhbSBzdGFydCBhIHF1ZXJ5\nIHZhbHVlIHJlcHJlc2VudGluZyB0aGUgc3RhcnQgaW5kZXgsIG9yIG51bGwK\nICAgICAqIHRvIHN0YXJ0IGF0IHRoZSBiZWdpbm5pbmcKICAgICAqLwogICAg\ncHVibGljIHZvaWQgaW5kZXhPZihTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1\nZSBzdHIsIEZpbHRlclZhbHVlIGZpbmQsCiAgICAgICAgRmlsdGVyVmFsdWUg\nc3RhcnQpIHsKICAgICAgICBidWYuYXBwZW5kKCIoSU5TVFIoKCIpOwogICAg\nICAgIGlmIChzdGFydCAhPSBudWxsKQogICAgICAgICAgICBzdWJzdHJpbmco\nYnVmLCBzdHIsIHN0YXJ0LCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHN0ci5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiks\nICgiKTsKICAgICAgICBmaW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVm\nLmFwcGVuZCgiKSkgLSAxIik7CiAgICAgICAgaWYgKHN0YXJ0ICE9IG51bGwp\nIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICsgIik7CiAgICAgICAgICAg\nIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgfQogICAgICAgIGJ1Zi5h\ncHBlbmQoIikiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCB0aGUg\nbnVtZXJpYyBwYXJ0cyBvZiBhIG1hdGhlbWF0aWNhbCBmdW5jdGlvbi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRl\nIHRoZSBtYXRoIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gb3AgdGhlIG1hdGhl\nbWF0aWNhbCBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxo\ncyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIG1hdGggZnVuY3Rpb24KICAg\nICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgbWF0\naCBmdW5jdGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBtYXRoRnVuY3Rp\nb24oU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMs\nCiAgICAgICAgRmlsdGVyVmFsdWUgcmhzKSB7CiAgICAgICAgYm9vbGVhbiBj\nYXN0bGhzID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBjYXN0cmhzID0gZmFs\nc2U7CiAgICAgICAgQ2xhc3MgbGMgPSBGaWx0ZXJzLndyYXAobGhzLmdldFR5\ncGUoKSk7CiAgICAgICAgQ2xhc3MgcmMgPSBGaWx0ZXJzLndyYXAocmhzLmdl\ndFR5cGUoKSk7CiAgICAgICAgaW50IHR5cGUgPSAwOwogICAgICAgIGlmIChy\nZXF1aXJlc0Nhc3RGb3JNYXRoRnVuY3Rpb25zICYmIChsYyAhPSByYwogICAg\nICAgICAgICB8fCAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFu\ndCgpKSkpIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IEZpbHRlcnMucHJvbW90\nZShsYywgcmMpOwogICAgICAgICAgICB0eXBlID0gZ2V0SkRCQ1R5cGUoSmF2\nYVR5cGVzLmdldFR5cGVDb2RlKGMpLCBmYWxzZSk7CiAgICAgICAgICAgIGlm\nICh0eXBlICE9IFR5cGVzLlZBUkJJTkFSWSAmJiB0eXBlICE9IFR5cGVzLkJM\nT0IpIHsKICAgICAgICAgICAgICAgIGNhc3RsaHMgPSAobGhzLmlzQ29uc3Rh\nbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8fCBsYyAhPSBjOwogICAgICAg\nICAgICAgICAgY2FzdHJocyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5p\nc0NvbnN0YW50KCkpIHx8IHJjICE9IGM7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIGJvb2xlYW4gbW9kID0gIk1PRCIuZXF1YWxzKG9wKTsK\nICAgICAgICBpZiAobW9kKSB7CiAgICAgICAgICAgIGlmIChzdXBwb3J0c01v\nZE9wZXJhdG9yKQogICAgICAgICAgICAgICAgb3AgPSAiJSI7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQob3ApOwogICAg\nICAgIH0KICAgICAgICBidWYuYXBwZW5kKCIoIik7CgogICAgICAgIGlmIChj\nYXN0bGhzKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgbGhzLCB0eXBl\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxocy5hcHBlbmRUbyhidWYp\nOwoKICAgICAgICBpZiAobW9kKQogICAgICAgICAgICBidWYuYXBwZW5kKCIs\nICIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7CgogICAgICAgIGlmIChjYXN0cmhz\nKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgcmhzLCB0eXBlKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHJocy5hcHBlbmRUbyhidWYpOwoKICAg\nICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgYSBjb21wYXJpc29uLgogICAgICoKICAgICAqIEBwYXJhbSBidWYg\ndGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlzb24KICAgICAq\nIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24gdG8gcGVyZm9y\nbQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhl\nIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQg\nc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBjb21wYXJpc29uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVy\nVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocykgewogICAgICAg\nIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gY2Fz\ndHJocyA9IGZhbHNlOwogICAgICAgIENsYXNzIGxjID0gRmlsdGVycy53cmFw\nKGxocy5nZXRUeXBlKCkpOwogICAgICAgIENsYXNzIHJjID0gRmlsdGVycy53\ncmFwKHJocy5nZXRUeXBlKCkpOwogICAgICAgIGludCB0eXBlID0gMDsKICAg\nICAgICBpZiAocmVxdWlyZXNDYXN0Rm9yQ29tcGFyaXNvbnMgJiYgKGxjICE9\nIHJjCiAgICAgICAgICAgIHx8IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5p\nc0NvbnN0YW50KCkpKSkgewogICAgICAgICAgICBDbGFzcyBjID0gRmlsdGVy\ncy5wcm9tb3RlKGxjLCByYyk7CiAgICAgICAgICAgIHR5cGUgPSBnZXRKREJD\nVHlwZShKYXZhVHlwZXMuZ2V0VHlwZUNvZGUoYyksIGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKHR5cGUgIT0gVHlwZXMuVkFSQklOQVJZICYmIHR5cGUgIT0g\nVHlwZXMuQkxPQikgewogICAgICAgICAgICAgICAgY2FzdGxocyA9IChsaHMu\naXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpIHx8IGxjICE9IGM7\nCiAgICAgICAgICAgICAgICBjYXN0cmhzID0gKGxocy5pc0NvbnN0YW50KCkg\nJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwgcmMgIT0gYzsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNhc3RsaHMpCiAgICAgICAgICAg\nIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5cGUpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7CgogICAgICAgIGJ1Zi5hcHBl\nbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwoKICAgICAgICBpZiAo\nY2FzdHJocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIHJocywgdHlw\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByaHMuYXBwZW5kVG8oYnVm\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBTUUwgZm9yIHRoZSBn\naXZlbiBudW1lcmljIHZhbHVlIHRvIHRoZSBidWZmZXIsIGNhc3RpbmcgYXMg\nbmVlZGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmROdW1l\ncmljQ2FzdChTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSB2YWwpIHsKICAg\nICAgICBpZiAodmFsLmlzQ29uc3RhbnQoKSkKICAgICAgICAgICAgYXBwZW5k\nQ2FzdChidWYsIHZhbCwgVHlwZXMuTlVNRVJJQyk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICB2YWwuYXBwZW5kVG8oYnVmKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENhc3QgdGhlIHNwZWNpZmllZCB2YWx1ZSB0byB0aGUgc3BlY2lm\naWVkIHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgYnVmZmVy\nIHRvIGFwcGVuZCB0aGUgY2FzdCB0bwogICAgICogQHBhcmFtIHZhbCB0aGUg\ndmFsdWUgdG8gY2FzdAogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUgb2Yg\ndGhlIGNhc2UsIGUuZy4ge0BsaW5rIFR5cGVzI05VTUVSSUN9CiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGFwcGVuZENhc3QoU1FMQnVmZmVyIGJ1ZiwgRmls\ndGVyVmFsdWUgdmFsLCBpbnQgdHlwZSkgewogICAgICAgIC8vIENvbnZlcnQg\ndGhlIGNhc3QgZnVuY3Rpb246ICJDQVNUKHswfSBBUyB7MX0pIgogICAgICAg\nIGludCBmaXJzdFBhcmFtID0gY2FzdEZ1bmN0aW9uLmluZGV4T2YoInswfSIp\nOwogICAgICAgIFN0cmluZyBwcmUgPSBjYXN0RnVuY3Rpb24uc3Vic3RyaW5n\nKDAsIGZpcnN0UGFyYW0pOyAvLyAiQ0FTVCgiCiAgICAgICAgU3RyaW5nIG1p\nZCA9IGNhc3RGdW5jdGlvbi5zdWJzdHJpbmcoZmlyc3RQYXJhbSArIDMpOwog\nICAgICAgIGludCBzZWNvbmRQYXJhbSA9IG1pZC5pbmRleE9mKCJ7MX0iKTsK\nICAgICAgICBTdHJpbmcgcG9zdDsKICAgICAgICBpZiAoc2Vjb25kUGFyYW0g\nPiAtMSkgewogICAgICAgICAgICBwb3N0ID0gbWlkLnN1YnN0cmluZyhzZWNv\nbmRQYXJhbSArIDMpOyAvLyAiKSIKICAgICAgICAgICAgbWlkID0gbWlkLnN1\nYnN0cmluZygwLCBzZWNvbmRQYXJhbSk7IC8vICIgQVMgIgogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICBwb3N0ID0gIiI7CgogICAgICAgIGJ1Zi5hcHBl\nbmQocHJlKTsKICAgICAgICB2YWwuYXBwZW5kVG8oYnVmKTsKICAgICAgICBi\ndWYuYXBwZW5kKG1pZCk7CiAgICAgICAgYnVmLmFwcGVuZChnZXRUeXBlTmFt\nZSh0eXBlKSk7CiAgICAgICAgYnVmLmFwcGVuZChwb3N0KTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLwogICAgLy8gRERMIFNRTAogICAgLy8vLy8vLy8vLy8K\nCiAgICAvKioKICAgICAqIEluY3JlbWVudCB0aGUgcmVmZXJlbmNlIGNvdW50\nIG9mIGFueSB0YWJsZSBjb21wb25lbnRzIHRoYXQgdGhpcwogICAgICogZGlj\ndGlvbmFyeSBhZGRzIHRoYXQgYXJlIG5vdCB1c2VkIGJ5IG1hcHBpbmdzLiBE\nb2VzIG5vdGhpbmcgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgcmVmU2NoZW1hQ29tcG9uZW50cyhUYWJsZSB0YWJsZSkgewogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBuYW1lIG9mIHRoZSB0\nYWJsZSwgaW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAogICAgICog\nYnkge0BsaW5rICNjYXRhbG9nU2VwYXJhdG9yfSkuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0RnVsbE5hbWUoVGFibGUgdGFibGUsIGJvb2xlYW4g\nbG9naWNhbCkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCB0YWJs\nZS5nZXRTY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpZiAobG9naWNhbCB8fCAiLiIu\nZXF1YWxzKGNhdGFsb2dTZXBhcmF0b3IpKQogICAgICAgICAgICByZXR1cm4g\ndGFibGUuZ2V0RnVsbE5hbWUoKTsKICAgICAgICByZXR1cm4gdGFibGUuZ2V0\nU2NoZW1hTmFtZSgpICsgY2F0YWxvZ1NlcGFyYXRvciArIHRhYmxlLmdldE5h\nbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZ1bGwg\nbmFtZSBvZiB0aGUgaW5kZXgsIGluY2x1ZGluZyB0aGUgc2NoZW1hIChkZWxp\nbWl0ZWQKICAgICAqIGJ5IHRoZSByZXN1bHQgb2Yge0BsaW5rICNjYXRhbG9n\nU2VwYXJhdG9yfSkuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0RnVs\nbE5hbWUoSW5kZXggaW5kZXgpIHsKICAgICAgICBpZiAoIXVzZVNjaGVtYU5h\nbWUgfHwgaW5kZXguZ2V0U2NoZW1hTmFtZSgpID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBpbmRleC5nZXROYW1lKCk7CiAgICAgICAgaWYgKCIuIi5l\ncXVhbHMoY2F0YWxvZ1NlcGFyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBp\nbmRleC5nZXRGdWxsTmFtZSgpOwogICAgICAgIHJldHVybiBpbmRleC5nZXRT\nY2hlbWFOYW1lKCkgKyBjYXRhbG9nU2VwYXJhdG9yICsgaW5kZXguZ2V0TmFt\nZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBu\nYW1lIG9mIHRoZSBzZXF1ZW5jZSwgaW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRl\nbGltaXRlZAogICAgICogYnkgdGhlIHJlc3VsdCBvZiB7QGxpbmsgI2NhdGFs\nb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRG\ndWxsTmFtZShTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBpZiAoIXVzZVNjaGVt\nYU5hbWUgfHwgc2VxLmdldFNjaGVtYU5hbWUoKSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gc2VxLmdldE5hbWUoKTsKICAgICAgICBpZiAoIi4iLmVx\ndWFscyhjYXRhbG9nU2VwYXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIHNl\ncS5nZXRGdWxsTmFtZSgpOwogICAgICAgIHJldHVybiBzZXEuZ2V0U2NoZW1h\nTmFtZSgpICsgY2F0YWxvZ1NlcGFyYXRvciArIHNlcS5nZXROYW1lKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdl\ncyB0byB0aGUgZ2l2ZW4gdGFibGUgbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAg\nICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0VmFsaWRUYWJsZU5hbWUoU3RyaW5nIG5hbWUsIFNjaGVtYSBz\nY2hlbWEpIHsKICAgICAgICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikp\nCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAg\nICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCBzY2hlbWEuZ2V0U2NoZW1h\nR3JvdXAoKSwKICAgICAgICAgICAgbWF4VGFibGVOYW1lTGVuZ3RoLCBOQU1F\nX1RBQkxFKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vz\nc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBzZXF1ZW5jZSBuYW1lIHRvIG1h\na2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFNlcXVlbmNlTmFtZShTdHJp\nbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHdoaWxlIChuYW1l\nLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vi\nc3RyaW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJTXyIg\nKyBuYW1lLCBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKSwKICAgICAgICAgICAg\nbWF4VGFibGVOYW1lTGVuZ3RoLCBOQU1FX1NFUVVFTkNFKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRo\nZSBnaXZlbiBjb2x1bW4gbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBm\nb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0VmFsaWRDb2x1bW5OYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkg\newogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAg\nICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVy\nbiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLCBtYXhDb2x1bW5OYW1lTGVu\nZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFu\neSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkg\nbmFtZSB0byBtYWtlIGl0CiAgICAgKiB2YWxpZCBmb3IgdGhlIGN1cnJlbnQg\nREIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRQcmltYXJ5\nS2V5TmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICB3\naGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUg\nPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVW\nYWxpZCgiUF8iICsgbmFtZSwgdGFibGUuZ2V0U2NoZW1hKCkuZ2V0U2NoZW1h\nR3JvdXAoKSwKICAgICAgICAgICAgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgs\nIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5l\nY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBmb3JlaWduIGtleSBuYW1l\nIHRvIG1ha2UgaXQKICAgICAqIHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZEZvcmVpZ25LZXlO\nYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSwKICAgICAgICBUYWJsZSB0\nb1RhYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIp\nKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgU3RyaW5nIHRhYmxlTmFtZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAg\nICBpbnQgbGVuID0gTWF0aC5taW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsK\nICAgICAgICBuYW1lID0gIkZfIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4p\nICsgIl8iICsgbmFtZTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChu\nYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAg\nICAgICAgICBtYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIGluZGV4IG5hbWUgdG8gbWFrZSBpdCB2YWxpZAog\nICAgICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFZhbGlkSW5kZXhOYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0\nYWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkK\nICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAg\nIFN0cmluZyB0YWJsZU5hbWUgPSB0YWJsZS5nZXROYW1lKCk7CiAgICAgICAg\naW50IGxlbiA9IE1hdGgubWluKHRhYmxlTmFtZS5sZW5ndGgoKSwgNyk7CiAg\nICAgICAgbmFtZSA9ICJJXyIgKyBzaG9ydGVuKHRhYmxlTmFtZSwgbGVuKSAr\nICJfIiArIG5hbWU7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQobmFt\nZSwgdGFibGUuZ2V0U2NoZW1hKCkuZ2V0U2NoZW1hR3JvdXAoKSwKICAgICAg\nICAgICAgbWF4SW5kZXhOYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0\naGUgZ2l2ZW4gdW5pcXVlIGNvbnN0cmFpbnQgbmFtZSB0byBtYWtlCiAgICAg\nKiBpdCB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0VmFsaWRVbmlxdWVOYW1lKFN0cmluZyBuYW1lLCBU\nYWJsZSB0YWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgo\nIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwog\nICAgICAgIFN0cmluZyB0YWJsZU5hbWUgPSB0YWJsZS5nZXROYW1lKCk7CiAg\nICAgICAgaW50IGxlbiA9IE1hdGgubWluKHRhYmxlTmFtZS5sZW5ndGgoKSwg\nNyk7CiAgICAgICAgbmFtZSA9ICJVXyIgKyBzaG9ydGVuKHRhYmxlTmFtZSwg\nbGVuKSArICJfIiArIG5hbWU7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFs\naWQobmFtZSwgdGFibGUuZ2V0U2NoZW1hKCkuZ2V0U2NoZW1hR3JvdXAoKSwK\nICAgICAgICAgICAgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgsIE5BTUVfQU5Z\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW4gdGhlIHNwZWNpZmll\nZCBuYW1lIHRvIHRoZSBzcGVjaWZpZWQgdGFyZ2V0IG5hbWUuIFRoaXMgd2ls\nbAogICAgICogYmUgZG9uZSBieSBmaXJzdCBzdHJpcHBpbmcgb3V0IHRoZSB2\nb3dlbHMsIGFuZCB0aGVuIHJlbW92aW5nCiAgICAgKiBjaGFyYWN0ZXJzIGZy\nb20gdGhlIG1pZGRsZSBvZiB0aGUgd29yZCB1bnRpbCBpdCByZWFjaGVzIHRo\nZSB0YXJnZXQKICAgICAqIGxlbmd0aC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHN0YXRpYyBTdHJpbmcgc2hvcnRlbihTdHJpbmcgbmFtZSwgaW50IHRhcmdl\ndExlbmd0aCkgewogICAgICAgIGlmIChuYW1lID09IG51bGwgfHwgbmFtZS5s\nZW5ndGgoKSA8PSB0YXJnZXRMZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBu\nYW1lOwoKICAgICAgICBTdHJpbmdCdWZmZXIgbm0gPSBuZXcgU3RyaW5nQnVm\nZmVyKG5hbWUpOwogICAgICAgIHdoaWxlIChubS5sZW5ndGgoKSA+IHRhcmdl\ndExlbmd0aCkgewogICAgICAgICAgICBpZiAoIXN0cmlwVm93ZWwobm0pKSB7\nCiAgICAgICAgICAgICAgICAvLyBjdXQgb3V0IHRoZSBtaWRkbGUgY2hhcgog\nICAgICAgICAgICAgICAgbm0ucmVwbGFjZShubS5sZW5ndGgoKSAvIDIsIChu\nbS5sZW5ndGgoKSAvIDIpICsgMSwgIiIpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBubS50b1N0cmluZygpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVtb3ZlIHZvd2VscyBmcm9tIHRoZSBzcGVjaWZpZWQg\nU3RyaW5nQnVmZmVyLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBh\nbnkgdm93ZWxzIGhhdmUgYmVlbiByZW1vdmVkCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJvb2xlYW4gc3RyaXBWb3dlbChTdHJpbmdCdWZmZXIgbmFt\nZSkgewogICAgICAgIGlmIChuYW1lID09IG51bGwgfHwgbmFtZS5sZW5ndGgo\nKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGNo\nYXJbXSB2b3dlbHMgPSB7ICdBJywgJ0UnLCAnSScsICdPJywgJ1UnLCB9Owog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdm93ZWxzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGludCBpbmRleCA9IG5hbWUudG9TdHJpbmcoKS50\nb1VwcGVyQ2FzZSgpLmluZGV4T2Yodm93ZWxzW2ldKTsKICAgICAgICAgICAg\naWYgKGluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICBuYW1lLnJlcGxh\nY2UoaW5kZXgsIGluZGV4ICsgMSwgIiIpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2hvcnRlbnMgdGhl\nIGdpdmVuIG5hbWUgdG8gdGhlIGdpdmVuIG1heGltdW0gbGVuZ3RoLCB0aGVu\nIGNoZWNrcyB0aGF0CiAgICAgKiBpdCBpcyBub3QgYSByZXNlcnZlZCB3b3Jk\nLiBJZiBpdCBpcyByZXNlcnZlZCwgYXBwZW5kcyBhICIwIi4gSWYKICAgICAq\nIHRoZSBuYW1lIGNvbmZsaWN0cyB3aXRoIGFuIGV4aXN0aW5nIHNjaGVtYSBj\nb21wb25lbnQsIHRoZSBsYXN0CiAgICAgKiBjaGFyYWN0ZXIgaXMgcmVwbGFj\nZSB3aXRoICcwJywgdGhlbiAnMScsIGV0Yy4KICAgICAqIE5vdGUgdGhhdCB0\naGUgZ2l2ZW4gbWF4IGxlbiBtYXkgYmUgMCBpZiB0aGUgZGF0YWJhc2UgbWV0\nYWRhdGEgaXMKICAgICAqIGluY29tcGxldGUuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBTdHJpbmcgbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNl\ndCBzZXQsIGludCBtYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlKSB7CiAg\nICAgICAgaWYgKG1heExlbiA8IDEpCiAgICAgICAgICAgIG1heExlbiA9IDI1\nNTsKICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA+IG1heExlbikKICAgICAg\nICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG1heExlbik7CiAgICAg\nICAgaWYgKHJlc2VydmVkV29yZFNldC5jb250YWlucyhuYW1lLnRvVXBwZXJD\nYXNlKCkpKSB7CiAgICAgICAgICAgIGlmIChuYW1lLmxlbmd0aCgpID09IG1h\neExlbikKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygw\nLCBuYW1lLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgICAgIG5hbWUgKz0gIjAi\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbm93IG1ha2Ugc3VyZSB0aGUgbmFt\nZSBpcyB1bmlxdWUKICAgICAgICBpZiAoc2V0ICE9IG51bGwpIHsKICAgICAg\nICAgICAgb3V0ZXI6CiAgICAgICAgICAgIGZvciAoaW50IHZlcnNpb24gPSAx\nLCBjaGFycyA9IDE7IHRydWU7IHZlcnNpb24rKykgewogICAgICAgICAgICAg\nICAgLy8gZm9yIHRhYmxlIG5hbWVzLCB3ZSBjaGVjayBmb3IgdGhlIHRhYmxl\nIGl0c2VsZiBpbiBjYXNlIHRoZQogICAgICAgICAgICAgICAgLy8gbmFtZSBz\nZXQgaXMgbGF6eSBhYm91dCBzY2hlbWEgcmVmbGVjdGlvbgogICAgICAgICAg\nICAgICAgc3dpdGNoIChuYW1lVHlwZSkgewogICAgICAgICAgICAgICAgICAg\nIGNhc2UgTkFNRV9UQUJMRToKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKCEoKFNjaGVtYUdyb3VwKSBzZXQpLmlzS25vd25UYWJsZShuYW1lKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBj\nYXNlIE5BTUVfU0VRVUVOQ0U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nICghKChTY2hlbWFHcm91cCkgc2V0KS5pc0tub3duU2VxdWVuY2UobmFtZSkp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjsKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZXQu\naXNOYW1lVGFrZW4obmFtZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBicmVhayBvdXRlcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAvLyBhIHNpbmdsZSBjaGFyIGZvciB0aGUgdmVyc2lvbiBpcyBwcm9i\nYWJseSBlbm91Z2gsIGJ1dCBtaWdodAogICAgICAgICAgICAgICAgLy8gYXMg\nd2VsbCBiZSBnZW5lcmFsIGFib3V0IGl0Li4uCiAgICAgICAgICAgICAgICBp\nZiAodmVyc2lvbiA+IDEpCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5h\nbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoKCkgLSBjaGFycyk7CiAgICAg\nICAgICAgICAgICBpZiAodmVyc2lvbiA+PSBNYXRoLnBvdygxMCwgY2hhcnMp\nKQogICAgICAgICAgICAgICAgICAgIGNoYXJzKys7CiAgICAgICAgICAgICAg\nICBpZiAobmFtZS5sZW5ndGgoKSArIGNoYXJzID4gbWF4TGVuKQogICAgICAg\nICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBtYXhMZW4g\nLSBjaGFycyk7CiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSArIHZlcnNp\nb247CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5h\nbWUudG9VcHBlckNhc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBjcmVhdGUgdGhlIGdp\ndmVuIHRhYmxlLCBjb21wbGV0ZQogICAgICogd2l0aCBjb2x1bW5zLiBJbmRl\neGVzIGFuZCBjb25zdHJhaW50cyB3aWxsIGJlIGNyZWF0ZWQgc2VwYXJhdGVs\neS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldENyZWF0ZVRhYmxl\nU1FMKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9\nIG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJDUkVB\nVEUgVEFCTEUgIikuYXBwZW5kKGdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSkp\nLgogICAgICAgICAgICBhcHBlbmQoIiAoIik7CgogICAgICAgIENvbHVtbltd\nIGNvbHMgPSB0YWJsZS5nZXRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nIChpID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0RGVjbGFyZUNvbHVtblNRTChjb2xz\nW2ldLCBmYWxzZSkpOwogICAgICAgIH0KCiAgICAgICAgUHJpbWFyeUtleSBw\nayA9IHRhYmxlLmdldFByaW1hcnlLZXkoKTsKICAgICAgICBTdHJpbmcgcGtT\ndHI7CiAgICAgICAgaWYgKHBrICE9IG51bGwpIHsKICAgICAgICAgICAgcGtT\ndHIgPSBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChwayk7CiAgICAgICAg\nICAgIGlmIChwa1N0ciAhPSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiLCAiKS5hcHBlbmQocGtTdHIpOwogICAgICAgIH0KCiAgICAgICAg\nVW5pcXVlW10gdW5xcyA9IHRhYmxlLmdldFVuaXF1ZXMoKTsKICAgICAgICBT\ndHJpbmcgdW5xU3RyOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5x\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1bnFTdHIgPSBnZXRVbmlx\ndWVDb25zdHJhaW50U1FMKHVucXNbaV0pOwogICAgICAgICAgICBpZiAodW5x\nU3RyICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIp\nLmFwcGVuZCh1bnFTdHIpOwogICAgICAgIH0KCiAgICAgICAgYnVmLmFwcGVu\nZCgiKSIpOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0\ncmluZygpIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJp\nZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gdGFibGUu\nIEluZGV4ZXMKICAgICAqIHdpbGwgYmUgZHJvcHBlZCBzZXBhcmF0ZWx5LiBS\nZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIFRBQkxFICZsdDt0YWJsZSBuYW1l\nJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZ1tdIGdldERyb3BUYWJsZVNRTChUYWJsZSB0YWJsZSkgewogICAgICAg\nIFN0cmluZyBkcm9wID0gTWVzc2FnZUZvcm1hdC5mb3JtYXQoZHJvcFRhYmxl\nU1FMLCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgIGdldEZ1bGxOYW1lKHRh\nYmxlLCBmYWxzZSkgfSk7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsg\nZHJvcCB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVz\nIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gc2VxdWVu\nY2UuIFJldHVybnMKICAgICAqIDxjb2RlPkNSRUFURSBTRVFVRU5DRSAmbHQ7\nc2VxdWVuY2UgbmFtZSZndDtbIFNUQVJUIFdJVEggJmx0O3N0YXJ0Jmd0O10K\nICAgICAqIFsgSU5DUkVNRU5UIEJZICZsdDtpbmNyZW1lbnQmZ3Q7XTwvY29k\nZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdl\ndENyZWF0ZVNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkgewogICAgICAgIGlm\nIChuZXh0U2VxdWVuY2VRdWVyeSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJp\nbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJDUkVBVEUgU0VRVUVO\nQ0UgIik7CiAgICAgICAgYnVmLmFwcGVuZChnZXRGdWxsTmFtZShzZXEpKTsK\nICAgICAgICBpZiAoc2VxLmdldEluaXRpYWxWYWx1ZSgpICE9IDApCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBTVEFSVCBXSVRIICIpLmFwcGVuZChzZXEu\nZ2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgIGlmIChzZXEuZ2V0SW5jcmVt\nZW50KCkgPiAxKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgSU5DUkVNRU5U\nIEJZICIpLmFwcGVuZChzZXEuZ2V0SW5jcmVtZW50KCkpOwogICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVu\ndHMgdG8gZHJvcCB0aGUgZ2l2ZW4gc2VxdWVuY2UuIFJldHVybnMKICAgICAq\nIDxjb2RlPkRST1AgU0VRVUVOQ0UgJmx0O3NlcXVlbmNlIG5hbWUmZ3Q7PC9j\nb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10g\nZ2V0RHJvcFNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkgewogICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nW117ICJEUk9QIFNFUVVFTkNFICIgKyBnZXRGdWxs\nTmFtZShzZXEpIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBz\nZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gY3JlYXRlIHRoZSBnaXZlbiBp\nbmRleC4gUmV0dXJucwogICAgICogPGNvZGU+Q1JFQVRFIFtVTklRVUVdIElO\nREVYICZsdDtpbmRleCBuYW1lJmd0OyBPTiAmbHQ7dGFibGUgbmFtZSZndDsK\nICAgICAqICgmbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4gYnkgZGVmYXVsdC4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldENyZWF0ZUluZGV4U1FM\nKEluZGV4IGluZGV4KSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJDUkVBVEUg\nIik7CiAgICAgICAgaWYgKGluZGV4LmlzVW5pcXVlKCkpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIlVOSVFVRSAiKTsKICAgICAgICBidWYuYXBwZW5kKCJJ\nTkRFWCAiKS5hcHBlbmQoaW5kZXguZ2V0TmFtZSgpKTsKCiAgICAgICAgYnVm\nLmFwcGVuZCgiIE9OICIpLmFwcGVuZChnZXRGdWxsTmFtZShpbmRleC5nZXRU\nYWJsZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAoIikuYXBw\nZW5kKFN0cmluZ3Muam9pbihpbmRleC5nZXRDb2x1bW5zKCksICIsICIpKS4K\nICAgICAgICAgICAgYXBwZW5kKCIpIik7CgogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117IGJ1Zi50b1N0cmluZygpIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJv\ncCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMKICAgICAqIDxjb2RlPkRST1Ag\nSU5ERVggJmx0O2luZGV4IG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcEluZGV4U1FMKElu\nZGV4IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkRS\nT1AgSU5ERVggIiArIGdldEZ1bGxOYW1lKGluZGV4KSB9OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRz\nIHRvIGFkZCB0aGUgZ2l2ZW4gY29sdW1uIHRvCiAgICAgKiBpdHMgdGFibGUu\nIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBv\ncnRlZC4gUmV0dXJucwogICAgICogPGNvZGU+QUxURVIgVEFCTEUgJmx0O3Rh\nYmxlIG5hbWUmZ3Q7IEFERCAoJmx0O2NvbCBkZWMmZ3Q7KTwvY29kZT4KICAg\nICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBn\nZXRBZGRDb2x1bW5TUUwoQ29sdW1uIGNvbHVtbikgewogICAgICAgIGlmICgh\nc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbikKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdbMF07CgogICAgICAgIFN0cmluZyBkZWMgPSBn\nZXREZWNsYXJlQ29sdW1uU1FMKGNvbHVtbiwgdHJ1ZSk7CiAgICAgICAgaWYg\nKGRlYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1sw\nXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUg\nIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgp\nLCBmYWxzZSkgKyAiIEFERCAiICsgZGVjIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJv\ncCB0aGUgZ2l2ZW4gY29sdW1uIGZyb20KICAgICAqIGl0cyB0YWJsZS4gUmV0\ndXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVk\nLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUg\nbmFtZSZndDsgRFJPUCBDT0xVTU4gJmx0O2NvbCBuYW1lJmd0OzwvY29kZT4K\nICAgICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXREcm9wQ29sdW1uU1FMKENvbHVtbiBjb2x1bW4pIHsKICAgICAgICBp\nZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhEcm9wQ29sdW1uKQogICAgICAg\nICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3\nIFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1\nbGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAg\nKyAiIERST1AgQ09MVU1OICIgKyBjb2x1bW4gfTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBh\nZGQgdGhlIGdpdmVuIHByaW1hcnkga2V5IHRvCiAgICAgKiBpdHMgdGFibGUu\nIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBv\ncnRlZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3Rh\nYmxlIG5hbWUmZ3Q7IEFERAogICAgICogJmx0O3BrIGNvbnMgc3FsICZndDs8\nL2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXRBZGRQcmltYXJ5S2V5U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAg\nICBTdHJpbmcgcGtzcWwgPSBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChw\nayk7CiAgICAgICAgaWYgKHBrc3FsID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUo\ncGsuZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiArIHBrc3FsIH07CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0\nYXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgZnJvbQog\nICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3Bl\ncmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFM\nVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTlNUUkFJTlQK\nICAgICAqICZsdDtwayBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BQcmltYXJ5S2V5U1FM\nKFByaW1hcnlLZXkgcGspIHsKICAgICAgICBpZiAocGsuZ2V0TmFtZSgpID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAg\nICAgICAgICsgZ2V0RnVsbE5hbWUocGsuZ2V0VGFibGUoKSwgZmFsc2UpCiAg\nICAgICAgICAgICsgIiBEUk9QIENPTlNUUkFJTlQgIiArIHBrLmdldE5hbWUo\nKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkg\ndG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlm\nIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8Y29k\nZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQURECiAgICAgKiAm\nbHQ7ZmsgY29ucyBzcWwgJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZEZvcmVpZ25LZXlTUUwoRm9y\nZWlnbktleSBmaykgewogICAgICAgIFN0cmluZyBma1NRTCA9IGdldEZvcmVp\nZ25LZXlDb25zdHJhaW50U1FMKGZrKTsKICAgICAgICBpZiAoZmtTUUwgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAg\nICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAg\nICAgICAgKyBnZXRGdWxsTmFtZShmay5nZXRUYWJsZSgpLCBmYWxzZSkgKyAi\nIEFERCAiICsgZmtTUUwgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZl\nbiBmb3JlaWduIGtleSBmcm9tCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBh\nbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4KICAg\nICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUm\nZ3Q7IERST1AgQ09OU1RSQUlOVAogICAgICogJmx0O2ZrIG5hbWUmZ3Q7PC9j\nb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10g\nZ2V0RHJvcEZvcmVpZ25LZXlTUUwoRm9yZWlnbktleSBmaykgewogICAgICAg\nIGlmIChmay5nZXROYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsg\nIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShmay5n\nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAgKyAiIERST1AgQ09OU1RS\nQUlOVCAiICsgZmsuZ2V0TmFtZSgpIH07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdpdmVuIGNv\nbHVtbi4gVGhpcyBtZXRob2QgaXMgdXNlZAogICAgICogZm9yIGVhY2ggY29s\ndW1uIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRlVGFibGVTUUx9IGFu\nZAogICAgICoge0BsaW5rICNnZXRBZGRDb2x1bW5TUUx9LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIGdldERlY2xhcmVDb2x1bW5TUUwoQ29sdW1u\nIGNvbCwgYm9vbGVhbiBhbHRlcikgewogICAgICAgIFN0cmluZ0J1ZmZlciBi\ndWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZChj\nb2wpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5h\nbWUoY29sKSk7CgogICAgICAgIC8vIGNhbid0IGFkZCBjb25zdHJhaW50cyB0\nbyBhIGNvbHVtbiB3ZSdyZSBhZGRpbmcgYWZ0ZXIgdGFibGUKICAgICAgICAv\nLyBjcmVhdGlvbiwgY2F1c2Ugc29tZSBkYXRhIG1pZ2h0IGFscmVhZHkgYmUg\naW5zZXJ0ZWQKICAgICAgICBpZiAoIWFsdGVyKSB7CiAgICAgICAgICAgIGlm\nIChjb2wuZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwgJiYgIWNvbC5pc0F1\ndG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIERF\nRkFVTFQgIikuYXBwZW5kKGNvbC5nZXREZWZhdWx0U3RyaW5nKCkpOwogICAg\nICAgICAgICBpZiAoY29sLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIE5PVCBOVUxMIik7CiAgICAgICAgfQogICAgICAgIGlm\nIChjb2wuaXNBdXRvQXNzaWduZWQoKSkgewogICAgICAgICAgICBpZiAoIXN1\ncHBvcnRzQXV0b0Fzc2lnbikKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9s\nb2MuZ2V0KCJpbnZhbGlkLWF1dG9hc3NpZ24iLCBwbGF0Zm9ybSwgY29sKSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKGF1dG9Bc3NpZ25DbGF1c2UgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQoYXV0\nb0Fzc2lnbkNsYXVzZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYu\ndG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGVjbGFyYXRpb24gU1FMIGZvciB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkuIFRo\naXMgbWV0aG9kIGlzCiAgICAgKiB1c2VkIGZyb20gd2l0aGluIHtAbGluayAj\nZ2V0Q3JlYXRlVGFibGVTUUx9IGFuZAogICAgICoge0BsaW5rICNnZXRBZGRQ\ncmltYXJ5S2V5U1FMfS4gUmV0dXJucwogICAgICogPGNvZGU+Q09OU1RSQUlO\nVCAmbHQ7cGsgbmFtZSZndDsgUFJJTUFSWSBLRVkgKCZsdDtjb2wgbGlzdCZn\ndDspPC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFN0cmluZyBnZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChQcmlt\nYXJ5S2V5IHBrKSB7CiAgICAgICAgLy8gaWYgd2UgaGF2ZSBkaXNhYmxlZCB0\naGUgY3JlYXRpb24gb2YgcHJpbWFyeSBrZXlzLCBhYm9ydCBoZXJlCiAgICAg\nICAgaWYgKCFjcmVhdGVQcmltYXJ5S2V5cykKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CgogICAgICAgIFN0cmluZyBuYW1lID0gcGsuZ2V0TmFtZSgpOwog\nICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgcmVzZXJ2ZWRXb3JkU2V0LmNv\nbnRhaW5zKG5hbWUudG9VcHBlckNhc2UoKSkpCiAgICAgICAgICAgIG5hbWUg\nPSBudWxsOwoKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1ZmZlcigpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgQ09OU19O\nQU1FX0JFRk9SRS5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5hcHBlbmQobmFtZSku\nYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiUFJJTUFSWSBLRVkg\nIik7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVfTUlE\nLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYu\nYXBwZW5kKG5hbWUpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQo\nIigiKS5hcHBlbmQoU3RyaW5ncy5qb2luKHBrLmdldENvbHVtbnMoKSwgIiwg\nIikpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsKICAgICAgICBpZiAobmFt\nZSAhPSBudWxsICYmIENPTlNfTkFNRV9BRlRFUi5lcXVhbHMoY29uc3RyYWlu\ndE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIENPTlNUUkFJ\nTlQgIikuYXBwZW5kKG5hbWUpOwogICAgICAgIHJldHVybiBidWYudG9TdHJp\nbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFy\nYXRpb24gU1FMIGZvciB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXksIG9yIG51bGwg\naWYgaXQgaXMKICAgICAqIG5vdCBzdXBwb3J0ZWQuIFRoaXMgbWV0aG9kIGlz\nIHVzZWQgZnJvbSB3aXRoaW4KICAgICAqIHtAbGluayAjZ2V0Q3JlYXRlVGFi\nbGVTUUx9IGFuZCB7QGxpbmsgI2dldEFkZEZvcmVpZ25LZXlTUUx9LiBSZXR1\ncm5zCiAgICAgKiA8Y29kZT5DT05TVFJBSU5UICZsdDtjb25zIG5hbWUmZ3Q7\nIEZPUkVJR04gS0VZICgmbHQ7Y29sIGxpc3QmZ3Q7KQogICAgICogUkVGRVJF\nTkNFUyAmbHQ7Zm9yZWlnbiB0YWJsZSZndDsgKCZsdDtjb2wgbGlzdCZndDsp\nCiAgICAgKiBbT04gREVMRVRFICZsdDthY3Rpb24mZ3Q7XSBbT04gVVBEQVRF\nICZsdDthY3Rpb24mZ3Q7XTwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0cmluZyBnZXRGb3JlaWduS2V5Q29uc3RyYWludFNR\nTChGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVp\nZ25LZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\nZmsuZ2V0RGVsZXRlQWN0aW9uKCkgPT0gRm9yZWlnbktleS5BQ1RJT05fTk9O\nRSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGZrLmlz\nRGVmZXJyZWQoKSAmJiAhc3VwcG9ydHNEZWZlcnJlZENvbnN0cmFpbnRzKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoIXN1cHBvcnRz\nRGVsZXRlQWN0aW9uKGZrLmdldERlbGV0ZUFjdGlvbigpKQogICAgICAgICAg\nICB8fCAhc3VwcG9ydHNVcGRhdGVBY3Rpb24oZmsuZ2V0VXBkYXRlQWN0aW9u\nKCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sdW1u\nW10gbG9jYWxzID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltd\nIGZvcmVpZ25zID0gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKCiAgICAg\nICAgaW50IGRlbEFjdGlvbklkID0gZmsuZ2V0RGVsZXRlQWN0aW9uKCk7CiAg\nICAgICAgaWYgKGRlbEFjdGlvbklkID09IEZvcmVpZ25LZXkuQUNUSU9OX05V\nTEwpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmb3JlaWdu\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZvcmVpZ25z\nW2ldLmlzTm90TnVsbCgpKQogICAgICAgICAgICAgICAgICAgIGRlbEFjdGlv\nbklkID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGRlbEFjdGlvbiA9IGdldEFjdGlv\nbk5hbWUoZGVsQWN0aW9uSWQpOwogICAgICAgIFN0cmluZyB1cEFjdGlvbiA9\nIGdldEFjdGlvbk5hbWUoZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwoKICAgICAg\nICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAg\nICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbAogICAgICAgICAgICAmJiBD\nT05TX05BTUVfQkVGT1JFLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZChm\nay5nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQo\nIkZPUkVJR04gS0VZICIpOwogICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0g\nbnVsbCAmJiBDT05TX05BTUVfTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1v\nZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKGZrLmdldE5hbWUoKSkuYXBw\nZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJp\nbmdzLmpvaW4obG9jYWxzLCAiLCAiKSkuYXBwZW5kKCIpIik7CiAgICAgICAg\nYnVmLmFwcGVuZCgiIFJFRkVSRU5DRVMgIik7CiAgICAgICAgYnVmLmFwcGVu\nZChnZXRGdWxsTmFtZShmb3JlaWduc1swXS5nZXRUYWJsZSgpLCBmYWxzZSkp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAoIikuYXBwZW5kKFN0cmluZ3Muam9p\nbihmb3JlaWducywgIiwgIikpLmFwcGVuZCgiKSIpOwogICAgICAgIGlmIChk\nZWxBY3Rpb24gIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9O\nIERFTEVURSAiKS5hcHBlbmQoZGVsQWN0aW9uKTsKICAgICAgICBpZiAodXBB\nY3Rpb24gIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9OIFVQ\nREFURSAiKS5hcHBlbmQodXBBY3Rpb24pOwogICAgICAgIGlmIChmay5pc0Rl\nZmVycmVkKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJTklUSUFMTFkg\nREVGRVJSRUQiKTsKICAgICAgICBpZiAoc3VwcG9ydHNEZWZlcnJlZENvbnN0\ncmFpbnRzKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgREVGRVJSQUJMRSIp\nOwogICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbAogICAgICAgICAg\nICAmJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9k\nZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5UICIpLmFw\ncGVuZChmay5nZXROYW1lKCkpOwogICAgICAgIHJldHVybiBidWYudG9TdHJp\nbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbmFtZSBv\nZiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgYWN0aW9uLgogICAgICovCiAgICBw\ncml2YXRlIFN0cmluZyBnZXRBY3Rpb25OYW1lKGludCBhY3Rpb24pIHsKICAg\nICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIEZvcmVp\nZ25LZXkuQUNUSU9OX0NBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4g\nIkNBU0NBREUiOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9O\nX05VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNFVCBOVUxMIjsKICAg\nICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOgogICAg\nICAgICAgICAgICAgcmV0dXJuICJTRVQgREVGQVVMVCI7CiAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZGF0YWJh\nc2Ugc3VwcG9ydHMgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGRlbGV0ZSBhY3Rp\nb24uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVsZXRl\nQWN0aW9uKGludCBhY3Rpb24pIHsKICAgICAgICBpZiAoYWN0aW9uID09IEZv\ncmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIGlmICghc3VwcG9ydHNGb3JlaWduS2V5cykKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAg\nICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Q6CiAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNSZXN0cmljdERlbGV0ZUFj\ndGlvbjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9DQVND\nQURFOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzQ2FzY2FkZURl\nbGV0ZUFjdGlvbjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElP\nTl9OVUxMOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzTnVsbERl\nbGV0ZUFjdGlvbjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElP\nTl9ERUZBVUxUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzRGVm\nYXVsdERlbGV0ZUFjdGlvbjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgZGF0YWJhc2Ugc3VwcG9ydHMgdGhl\nIGdpdmVuIGZvcmVpZ24ga2V5IHVwZGF0ZSBhY3Rpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzVXBkYXRlQWN0aW9uKGludCBhY3Rp\nb24pIHsKICAgICAgICBpZiAoYWN0aW9uID09IEZvcmVpZ25LZXkuQUNUSU9O\nX05PTkUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICgh\nc3VwcG9ydHNGb3JlaWduS2V5cykKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgIGNhc2Ug\nRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Q6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gc3VwcG9ydHNSZXN0cmljdFVwZGF0ZUFjdGlvbjsKICAgICAgICAg\nICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9DQVNDQURFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cHBvcnRzQ2FzY2FkZVVwZGF0ZUFjdGlvbjsKICAg\nICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9OVUxMOgogICAgICAg\nICAgICAgICAgcmV0dXJuIHN1cHBvcnRzTnVsbFVwZGF0ZUFjdGlvbjsKICAg\nICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9ERUZBVUxUOgogICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzRGVmYXVsdFVwZGF0ZUFjdGlv\nbjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdpdmVuIHVuaXF1ZSBj\nb25zdHJhaW50LiBUaGlzCiAgICAgKiBtZXRob2QgaXMgdXNlZCBmcm9tIHdp\ndGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfS4KICAgICAqIFJldHVy\nbnMJPGNvZGU+Q09OU1RSQUlOVCAmbHQ7bmFtZSZndDsgVU5JUVVFICgmbHQ7\nY29sIGxpc3QmZ3Q7KTwvY29kZT4KICAgICAqIGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0VW5pcXVlQ29uc3RyYWludFNR\nTChVbmlxdWUgdW5xKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c1VuaXF1ZUNv\nbnN0cmFpbnRzCiAgICAgICAgICAgIHx8ICh1bnEuaXNEZWZlcnJlZCgpICYm\nICFzdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAodW5xLmdldE5hbWUoKSAhPSBu\ndWxsCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9CRUZPUkUuZXF1YWxzKGNv\nbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNP\nTlNUUkFJTlQgIikuYXBwZW5kKHVucS5nZXROYW1lKCkpLmFwcGVuZCgiICIp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIlVOSVFVRSAiKTsKICAgICAgICBpZiAo\ndW5xLmdldE5hbWUoKSAhPSBudWxsICYmIENPTlNfTkFNRV9NSUQuZXF1YWxz\nKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\ndW5xLmdldE5hbWUoKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4odW5xLmdldENvbHVtbnMoKSwg\nIiwgIikpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsKICAgICAgICBpZiAo\ndW5xLmlzRGVmZXJyZWQoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElO\nSVRJQUxMWSBERUZFUlJFRCIpOwogICAgICAgIGlmIChzdXBwb3J0c0RlZmVy\ncmVkQ29uc3RyYWludHMpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBERUZF\nUlJBQkxFIik7CiAgICAgICAgaWYgKHVucS5nZXROYW1lKCkgIT0gbnVsbAog\nICAgICAgICAgICAmJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFp\nbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJB\nSU5UICIpLmFwcGVuZCh1bnEuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4g\nYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBEYXRhYmFzZSBtZXRhZGF0YQogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2Vk\nIHRvIGZpbHRlciBzeXN0ZW0gdGFibGVzIGZyb20gZGF0YWJhc2UgbWV0YWRh\ndGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdGFibGUgbmFt\nZSByZXByZXNlbnRzIGEgc3lzdGVtIHRhYmxlIHRoYXQKICAgICAqIHNob3Vs\nZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gQnkgZGVm\nYXVsdCwgcmV0dXJucwogICAgICogdHJ1ZSBvbmx5IGlmIHRoZSBnaXZlbiB0\nYWJsZSBpcyBpbiB0aGUgaW50ZXJuYWwgbGlzdCBvZiBzeXN0ZW0gdGFibGVz\nLAogICAgICogb3IgaWYgdGhlIGdpdmVuIHNjaGVtYSBpcyBpbiB0aGUgbGlz\ndCBvZiBzeXN0ZW0gc2NoZW1hcyBhbmQgaXMgbm90CiAgICAgKiB0aGUgdGFy\nZ2V0IHNjaGVtYS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFi\nbGUgbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2NoZW1h\nOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBpZiB0\ncnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQogICAg\nICogdGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtVGFibGUoU3RyaW5nIG5hbWUsIFN0\ncmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsK\nICAgICAgICBpZiAoc3lzdGVtVGFibGVTZXQuY29udGFpbnMobmFtZS50b1Vw\ncGVyQ2FzZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\ncmV0dXJuICF0YXJnZXRTY2hlbWEgJiYgc2NoZW1hICE9IG51bGwKICAgICAg\nICAgICAgJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5zKHNjaGVtYS50b1Vw\ncGVyQ2FzZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBpbmRleGVzIGZyb20gZGF0YWJh\nc2UgbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4g\naW5kZXggbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIGluZGV4IHRoYXQKICAg\nICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlv\nbi4gUmV0dXJucyBmYWxzZSBieSBkZWZhdWx0LgogICAgICoKICAgICAqIEBw\nYXJhbSBuYW1lIHRoZSBpbmRleCBuYW1lCiAgICAgKiBAcGFyYW0gdGFibGUg\ndGhlIGluZGV4IHRhYmxlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlz\nU3lzdGVtSW5kZXgoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHNlcXVlbmNlcyBmcm9t\nIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYgdGhl\nIGdpdmVuIHNlcXVlbmNlIHJlcHJlc2VudHMgYSBzeXN0ZW0gc2VxdWVuY2Ug\ndGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBk\nZWZpbml0aW9uLiBSZXR1cm5zIHRydWUgaWYgc3lzdGVtCiAgICAgKiBzY2hl\nbWEgYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUg\ndGFibGUgbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2No\nZW1hOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBp\nZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQog\nICAgICogdGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3RyaW5nIG5h\nbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hl\nbWEpIHsKICAgICAgICByZXR1cm4gIXRhcmdldFNjaGVtYSAmJiBzY2hlbWEg\nIT0gbnVsbAogICAgICAgICAgICAmJiBzeXN0ZW1TY2hlbWFTZXQuY29udGFp\nbnMoc2NoZW1hLnRvVXBwZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgdGFibGVzIG1hdGNo\naW5nIHRoZSBnaXZlbiBuYW1lIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1Ymxp\nYyBUYWJsZVtdIGdldFRhYmxlcyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0\ncmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJp\nbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NjaGVtYUZv\nckdldFRhYmxlcykKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IG51bGw7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzY2hlbWFOYW1lID0gZ2V0U2NoZW1h\nTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpOwoKICAgICAgICBTdHJpbmdb\nXSB0eXBlcyA9IFN0cmluZ3Muc3BsaXQodGFibGVUeXBlcywgIiwiLCAwKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICB0eXBlc1tpXSA9IHR5cGVzW2ldLnRyaW0oKTsKCiAg\nICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAg\nUmVzdWx0U2V0IHRhYmxlcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgdGFibGVzID0gbWV0YS5nZXRUYWJsZXMoZ2V0Q2F0YWxvZ05hbWVG\nb3JNZXRhZGF0YShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIHNjaGVtYU5h\nbWUsIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSksIHR5cGVz\nKTsKICAgICAgICAgICAgTGlzdCB0YWJsZUxpc3QgPSBuZXcgQXJyYXlMaXN0\nKCk7CiAgICAgICAgICAgIHdoaWxlICh0YWJsZXMgIT0gbnVsbCAmJiB0YWJs\nZXMubmV4dCgpKQogICAgICAgICAgICAgICAgdGFibGVMaXN0LmFkZChuZXdU\nYWJsZSh0YWJsZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChUYWJsZVtdKSB0\nYWJsZUxpc3QudG9BcnJheShuZXcgVGFibGVbdGFibGVMaXN0LnNpemUoKV0p\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICh0YWJsZXMg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgdGFibGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB0YWJsZSBmcm9t\nIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgVGFibGUgbmV3VGFibGUoUmVzdWx0U2V0IHRh\nYmxlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBUYWJsZSB0ID0gbmV3IFRhYmxlKCk7CiAgICAgICAgdC5zZXROYW1lKHRh\nYmxlTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAgICAgcmV0\ndXJuIHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gZmluZCBzZXF1ZW5jZXMgbWF0Y2hpbmcgdGhlIGdpdmVuIG5h\nbWUgcGF0dGVybi4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgYXJyYXkgYnkg\nZGVmYXVsdCwgYXMgdGhlcmUgaXMgbm8gc3RhbmRhcmQgd2F5IHRvCiAgICAg\nKiByZXRyaWV2ZSBhIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAgICovCiAgICBw\ndWJsaWMgU2VxdWVuY2VbXSBnZXRTZXF1ZW5jZXMoRGF0YWJhc2VNZXRhRGF0\nYSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1h\nTmFtZSwgU3RyaW5nIHNlcXVlbmNlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBz\ndHIgPSBnZXRTZXF1ZW5jZXNTUUwoc2NoZW1hTmFtZSwgc2VxdWVuY2VOYW1l\nKTsKICAgICAgICBpZiAoc3RyID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgU2VxdWVuY2VbMF07CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KHN0cik7CiAgICAgICAg\nUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgrKywg\nc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGlmIChzZXF1ZW5jZU5hbWUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgrKywg\nc2VxdWVuY2VOYW1lKTsKCiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0\nZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3Qgc2VxTGlzdCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHJzLm5leHQoKSkKICAgICAg\nICAgICAgICAgIHNlcUxpc3QuYWRkKG5ld1NlcXVlbmNlKHJzKSk7CiAgICAg\nICAgICAgIHJldHVybiAoU2VxdWVuY2VbXSkgc2VxTGlzdC50b0FycmF5KG5l\ndyBTZXF1ZW5jZVtzZXFMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzZXF1ZW5jZSBmcm9tIHRoZSBp\nbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU2VxdWVuY2UgbmV3U2VxdWVuY2UoUmVzdWx0U2V0IHNl\ncXVlbmNlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBTZXF1ZW5jZSBzZXEgPSBuZXcgU2VxdWVuY2UoKTsKICAgICAgICBz\nZXEuc2V0U2NoZW1hTmFtZShzZXF1ZW5jZU1ldGEuZ2V0U3RyaW5nKCJTRVFV\nRU5DRV9TQ0hFTUEiKSk7CiAgICAgICAgc2VxLnNldE5hbWUoc2VxdWVuY2VN\nZXRhLmdldFN0cmluZygiU0VRVUVOQ0VfTkFNRSIpKTsKICAgICAgICByZXR1\ncm4gc2VxOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBTUUwg\nbmVlZGVkIHRvIHNlbGVjdCB0aGUgbGlzdCBvZiBzZXF1ZW5jZXMuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCBjb2x1bW5zIG1hdGNoaW5nIHRoZSBnaXZl\nbiB0YWJsZSBhbmQKICAgICAqIGNvbHVtbiBwYXR0ZXJucy4KICAgICAqLwog\nICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0\nYSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1h\nTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUsIENv\nbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVs\nbFRhYmxlRm9yR2V0Q29sdW1ucykKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIGlmICghc3VwcG9ydHNTY2hlbWFGb3JHZXRDb2x1bW5zKQog\nICAgICAgICAgICBzY2hlbWFOYW1lID0gbnVsbDsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHNjaGVtYU5hbWUgPSBnZXRTY2hlbWFOYW1lRm9yTWV0YWRh\ndGEoc2NoZW1hTmFtZSk7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0\naW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBjb2xzID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBjb2xzID0gbWV0YS5nZXRDb2x1bW5z\nKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAgICAgICAg\nICAgICAgICBzY2hlbWFOYW1lLCBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0\nYWJsZU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0Q29sdW1uTmFtZUZvck1l\ndGFkYXRhKGNvbHVtbk5hbWUpKTsKCiAgICAgICAgICAgIExpc3QgY29sdW1u\nTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGNv\nbHMgIT0gbnVsbCAmJiBjb2xzLm5leHQoKSkKICAgICAgICAgICAgICAgIGNv\nbHVtbkxpc3QuYWRkKG5ld0NvbHVtbihjb2xzKSk7CiAgICAgICAgICAgIHJl\ndHVybiAoQ29sdW1uW10pIGNvbHVtbkxpc3QudG9BcnJheQogICAgICAgICAg\nICAgICAgKG5ldyBDb2x1bW5bY29sdW1uTGlzdC5zaXplKCldKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoY29scyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb2xz\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb2x1bW4gZnJvbSB0aGUgaW5mb3Jt\nYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENvbHVtbiBuZXdDb2x1bW4oUmVzdWx0U2V0IGNvbE1ldGEpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGMg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgYy5zZXRTY2hlbWFOYW1lKGNvbE1l\ndGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpKTsKICAgICAgICBjLnNldFRh\nYmxlTmFtZShjb2xNZXRhLmdldFN0cmluZygiVEFCTEVfTkFNRSIpKTsKICAg\nICAgICBjLnNldE5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIkNPTFVNTl9OQU1F\nIikpOwogICAgICAgIGMuc2V0VHlwZShjb2xNZXRhLmdldEludCgiREFUQV9U\nWVBFIikpOwogICAgICAgIGMuc2V0VHlwZU5hbWUoY29sTWV0YS5nZXRTdHJp\nbmcoIlRZUEVfTkFNRSIpKTsKICAgICAgICBjLnNldFNpemUoY29sTWV0YS5n\nZXRJbnQoIkNPTFVNTl9TSVpFIikpOwogICAgICAgIGMuc2V0RGVjaW1hbERp\nZ2l0cyhjb2xNZXRhLmdldEludCgiREVDSU1BTF9ESUdJVFMiKSk7CiAgICAg\nICAgYy5zZXROb3ROdWxsKGNvbE1ldGEuZ2V0SW50KCJOVUxMQUJMRSIpCiAg\nICAgICAgICAgID09IERhdGFiYXNlTWV0YURhdGEuY29sdW1uTm9OdWxscyk7\nCgogICAgICAgIFN0cmluZyBkZWYgPSBjb2xNZXRhLmdldFN0cmluZygiQ09M\nVU1OX0RFRiIpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShk\nZWYpICYmICEibnVsbCIuZXF1YWxzSWdub3JlQ2FzZShkZWYpKQogICAgICAg\nICAgICBjLnNldERlZmF1bHRTdHJpbmcoZGVmKTsKICAgICAgICByZXR1cm4g\nYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVt\nYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVuIHRhYmxlIHBh\ndHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBQcmltYXJ5S2V5W10gZ2V0UHJp\nbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLAogICAgICAgIFN0cmlu\nZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFt\nZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh1c2VHZXRCZXN0Um93SWRlbnRpZmllckZvclBy\naW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtleXNG\ncm9tQmVzdFJvd0lkZW50aWZpZXIobWV0YSwgY2F0YWxvZywKICAgICAgICAg\nICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwgY29ubik7CiAgICAgICAg\ncmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlLZXlzKG1ldGEs\nIGNhdGFsb2csCiAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwg\nY29ubik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJs\nZSBwYXR0ZXJuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtd\nIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlLZXlzCiAgICAgICAgKERh\ndGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csIFN0cmluZyBz\nY2hlbWFOYW1lLAogICAgICAgICAgICBTdHJpbmcgdGFibGVOYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBwb3J0c051bGxU\nYWJsZUZvckdldFByaW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAg\nICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcGtzID0gbWV0YS5nZXRQcmltYXJ5S2V5cyhnZXRDYXRhbG9n\nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgZ2V0\nU2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAgICAg\nICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSk7Cgog\nICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxsICYmIHBrcy5uZXh0KCkpCiAg\nICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocGtzKSk7\nCiAgICAgICAgICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBwa0xpc3QudG9B\ncnJheQogICAgICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5W3BrTGlzdC5z\naXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\ncGtzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIHBrcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcHJpbWFyeSBr\nZXkgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXkgbmV3UHJpbWFy\neUtleShSZXN1bHRTZXQgcGtNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIFByaW1hcnlLZXkgcGsgPSBuZXcgUHJpbWFyeUtl\neSgpOwogICAgICAgIHBrLnNldFNjaGVtYU5hbWUocGtNZXRhLmdldFN0cmlu\nZygiVEFCTEVfU0NIRU0iKSk7CiAgICAgICAgcGsuc2V0VGFibGVOYW1lKHBr\nTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAgICAgcGsuc2V0\nQ29sdW1uTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpKTsK\nICAgICAgICBway5zZXROYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlBLX05BTUUi\nKSk7CiAgICAgICAgcmV0dXJuIHBrOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlzIGZv\nciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21CZXN0Um93SWRl\nbnRpZmllcgogICAgICAgIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmlu\nZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwKICAgICAgICAgICAgU3Ry\naW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5hbWUgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1l\ndGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBwa3Mg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBrcyA9IG1ldGEu\nZ2V0QmVzdFJvd0lkZW50aWZpZXIoY2F0YWxvZywgc2NoZW1hTmFtZSwKICAg\nICAgICAgICAgICAgIHRhYmxlTmFtZSwgMCwgZmFsc2UpOwoKICAgICAgICAg\nICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAg\nIHdoaWxlIChwa3MgIT0gbnVsbCAmJiBwa3MubmV4dCgpKSB7CiAgICAgICAg\nICAgICAgICBQcmltYXJ5S2V5IHBrID0gbmV3IFByaW1hcnlLZXkoKTsKICAg\nICAgICAgICAgICAgIHBrLnNldFNjaGVtYU5hbWUoc2NoZW1hTmFtZSk7CiAg\nICAgICAgICAgICAgICBway5zZXRUYWJsZU5hbWUodGFibGVOYW1lKTsKICAg\nICAgICAgICAgICAgIHBrLnNldENvbHVtbk5hbWUocGtzLmdldFN0cmluZygi\nQ09MVU1OX05BTUUiKSk7CiAgICAgICAgICAgICAgICBwa0xpc3QuYWRkKHBr\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKFByaW1hcnlL\nZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgUHJp\nbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBwa3MuY2xvc2UoKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVj\ndCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgaW5kZXhlcyBtYXRjaGluZyB0aGUg\nZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHVibGljIEluZGV4\nW10gZ2V0SW5kZXhJbmZvKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5n\nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0\nYWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLAogICAgICAgIGJvb2xlYW4gYXBw\ncm94LCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBw\nb3J0c051bGxUYWJsZUZvckdldEluZGV4SW5mbykKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNv\nbm4pOwogICAgICAgIFJlc3VsdFNldCBpbmRleGVzID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpbmRleGVzID0gbWV0YS5nZXRJbmRleElu\nZm8oZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9nKSwKICAgICAg\nICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShzY2hlbWFOYW1l\nKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFtZUZvck1ldGFkYXRhKHRh\nYmxlTmFtZSksIHVuaXF1ZSwgYXBwcm94KTsKCiAgICAgICAgICAgIExpc3Qg\naW5kZXhMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGls\nZSAoaW5kZXhlcyAhPSBudWxsICYmIGluZGV4ZXMubmV4dCgpKQogICAgICAg\nICAgICAgICAgaW5kZXhMaXN0LmFkZChuZXdJbmRleChpbmRleGVzKSk7CiAg\nICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkgaW5kZXhMaXN0LnRvQXJyYXko\nbmV3IEluZGV4W2luZGV4TGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAoaW5kZXhlcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpbmRleGVzLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENyZWF0ZSBhIG5ldyBpbmRleCBmcm9tIHRoZSBpbmZvcm1hdGlv\nbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0\nZWQgSW5kZXggbmV3SW5kZXgoUmVzdWx0U2V0IGlkeE1ldGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5kZXggaWR4ID0gbmV3\nIEluZGV4KCk7CiAgICAgICAgaWR4LnNldFNjaGVtYU5hbWUoaWR4TWV0YS5n\nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIikpOwogICAgICAgIGlkeC5zZXRUYWJs\nZU5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAg\nICAgaWR4LnNldENvbHVtbk5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIkNPTFVN\nTl9OQU1FIikpOwogICAgICAgIGlkeC5zZXROYW1lKGlkeE1ldGEuZ2V0U3Ry\naW5nKCJJTkRFWF9OQU1FIikpOwogICAgICAgIGlkeC5zZXRVbmlxdWUoIWlk\neE1ldGEuZ2V0Qm9vbGVhbigiTk9OX1VOSVFVRSIpKTsKICAgICAgICByZXR1\ncm4gaWR4OwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUg\nc2NoZW1hIHRvIHJldHVybiBmb3JlaWduIGtleXMgaW1wb3J0ZWQgYnkgdGhl\nIGdpdmVuCiAgICAgKiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJs\naWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFE\nYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hl\nbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzdXBw\nb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRh\nYmxlRm9yR2V0SW1wb3J0ZWRLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAg\nICAgICAgUmVzdWx0U2V0IGtleXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGtleXMgPSBtZXRhLmdldEltcG9ydGVkS2V5cyhnZXRDYXRh\nbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAg\nZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAg\nICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSk7\nCgogICAgICAgICAgICBMaXN0IGltcG9ydGVkS2V5TGlzdCA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGtleXMgIT0gbnVsbCAmJiBr\nZXlzLm5leHQoKSkKICAgICAgICAgICAgICAgIGltcG9ydGVkS2V5TGlzdC5h\nZGQobmV3Rm9yZWlnbktleShrZXlzKSk7CiAgICAgICAgICAgIHJldHVybiAo\nRm9yZWlnbktleVtdKSBpbXBvcnRlZEtleUxpc3QudG9BcnJheQogICAgICAg\nICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ltcG9ydGVkS2V5TGlzdC5zaXpl\nKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoa2V5\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBrZXlzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBmb3JlaWduIGtl\neSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktleSBuZXdGb3JlaWdu\nS2V5KFJlc3VsdFNldCBma01ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRm9yZWlnbktleSBmayA9IG5ldyBGb3JlaWduS2V5\nKCk7CiAgICAgICAgZmsuc2V0U2NoZW1hTmFtZShma01ldGEuZ2V0U3RyaW5n\nKCJGS1RBQkxFX1NDSEVNIikpOwogICAgICAgIGZrLnNldFRhYmxlTmFtZShm\na01ldGEuZ2V0U3RyaW5nKCJGS1RBQkxFX05BTUUiKSk7CiAgICAgICAgZmsu\nc2V0Q29sdW1uTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS0NPTFVNTl9OQU1F\nIikpOwogICAgICAgIGZrLnNldE5hbWUoZmtNZXRhLmdldFN0cmluZygiRktf\nTkFNRSIpKTsKICAgICAgICBmay5zZXRQcmltYXJ5S2V5U2NoZW1hTmFtZShm\na01ldGEuZ2V0U3RyaW5nKCJQS1RBQkxFX1NDSEVNIikpOwogICAgICAgIGZr\nLnNldFByaW1hcnlLZXlUYWJsZU5hbWUoZmtNZXRhLmdldFN0cmluZygiUEtU\nQUJMRV9OQU1FIikpOwogICAgICAgIGZrLnNldFByaW1hcnlLZXlDb2x1bW5O\nYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBLQ09MVU1OX05BTUUiKSk7CiAgICAg\nICAgZmsuc2V0S2V5U2VxdWVuY2UoZmtNZXRhLmdldEludCgiS0VZX1NFUSIp\nKTsKICAgICAgICBmay5zZXREZWZlcnJlZChma01ldGEuZ2V0SW50KCJERUZF\nUlJBQklMSVRZIikKICAgICAgICAgICAgPT0gRGF0YWJhc2VNZXRhRGF0YS5p\nbXBvcnRlZEtleUluaXRpYWxseURlZmVycmVkKTsKCiAgICAgICAgaW50IGRl\nbCA9IGZrTWV0YS5nZXRJbnQoIkRFTEVURV9SVUxFIik7CiAgICAgICAgc3dp\ndGNoIChkZWwpIHsKICAgICAgICAgICAgY2FzZSBEYXRhYmFzZU1ldGFEYXRh\nLmltcG9ydGVkS2V5U2V0TnVsbDoKICAgICAgICAgICAgICAgIGZrLnNldERl\nbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9OVUxMKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIERhdGFiYXNlTWV0YURh\ndGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0OgogICAgICAgICAgICAgICAgZmsu\nc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFVTFQpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgRGF0YWJh\nc2VNZXRhRGF0YS5pbXBvcnRlZEtleUNhc2NhZGU6CiAgICAgICAgICAgICAg\nICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FE\nRSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihGb3JlaWdu\nS2V5LkFDVElPTl9SRVNUUklDVCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZrOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgdGFibGUgbmFtZSB0aGF0IHdpbGwgYmUgdXNl\nZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGlu\nayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YShTdHJpbmcgdGFibGVOYW1l\nKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKHRhYmxlTmFt\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBzY2hlbWEg\nbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0\naW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRTY2hlbWFOYW1lRm9yTWV0\nYWRhdGEoU3RyaW5nIHNjaGVtYU5hbWUpIHsKICAgICAgICBpZiAoc2NoZW1h\nTmFtZSA9PSBudWxsKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gY29uZi5n\nZXRTY2hlbWEoKTsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2Uo\nc2NoZW1hTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRo\nZSBjYXRhbG9nIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmlu\nZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRh\nRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q2F0YWxv\nZ05hbWVGb3JNZXRhZGF0YShTdHJpbmcgY2F0YWxvZ05hbWUpIHsKICAgICAg\nICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY2F0YWxvZ05hbWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY29sdW1uIG5hbWUgdGhh\ndCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAg\nICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q29sdW1uTmFtZUZvck1ldGFkYXRhKFN0\ncmluZyBjb2x1bW5OYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hl\nbWFDYXNlKGNvbHVtbk5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIHNjaGVtYSBuYW1lIHRvIGEgbmFtZSB0aGF0\nIHRoZSBkYXRhYmFzZSB3aWxsCiAgICAgKiBiZSBhYmxlIHRvIHVuZGVyc3Rh\nbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgY29udmVydFNjaGVt\nYUNhc2UoU3RyaW5nIG9iamVjdE5hbWUpIHsKICAgICAgICBpZiAob2JqZWN0\nTmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgaWYgKFNDSEVNQV9DQVNFX0xPV0VSLmVxdWFscyhzY2hlbWFDYXNlKSkK\nICAgICAgICAgICAgcmV0dXJuIG9iamVjdE5hbWUudG9Mb3dlckNhc2UoKTsK\nICAgICAgICBpZiAoU0NIRU1BX0NBU0VfUFJFU0VSVkUuZXF1YWxzKHNjaGVt\nYUNhc2UpKQogICAgICAgICAgICByZXR1cm4gb2JqZWN0TmFtZTsKICAgICAg\nICByZXR1cm4gb2JqZWN0TmFtZS50b1VwcGVyQ2FzZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUHJlcGFyZWQgdGhlIGNvbm5lY3Rpb24gZm9yIG1ldGFk\nYXRhIG9wZXJhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZv\ncmVNZXRhZGF0YU9wZXJhdGlvbihDb25uZWN0aW9uIGMpIHsKICAgICAgICBp\nZiAocmVxdWlyZXNBdXRvQ29tbWl0Rm9yTWV0YURhdGEpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGMucm9sbGJhY2soKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsKICAgICAgICAg\nICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCFj\nLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgICAgICBjLnNldEF1\ndG9Db21taXQodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFNlcXVl\nbmNlcyBhbmQgQXV0by1Bc3NpZ24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxhc3QgZ2Vu\nZXJhdGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICogVGhy\nb3dzIGFuIGV4Y2VwdGlvbiBieSBkZWZhdWx0IGlmIHtAbGluayAjbGFzdEdl\nbmVyYXRlZEtleVF1ZXJ5fSBpcyBudWxsLgogICAgICovCiAgICBwdWJsaWMg\nT2JqZWN0IGdldEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9u\nIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWF1dG8t\nYXNzaWduIikpOwoKICAgICAgICAvLyByZXBsYWNlIHRoaW5ncyBsaWtlICJT\nRUxFQ1QgTUFYKHswfSkgRlJPTSB7MX0iCiAgICAgICAgU3RyaW5nIHF1ZXJ5\nID0gbGFzdEdlbmVyYXRlZEtleVF1ZXJ5OwogICAgICAgIGlmIChxdWVyeS5p\nbmRleE9mKCd7JykgIT0gLTEpIC8vIG9ubHkgaWYgdGhlIHRva2VuIGlzIGlu\nIHRoZSBzdHJpbmcKICAgICAgICB7CiAgICAgICAgICAgIHF1ZXJ5ID0gTWVz\nc2FnZUZvcm1hdC5mb3JtYXQocXVlcnksIG5ldyBPYmplY3RbXXsKICAgICAg\nICAgICAgICAgIGNvbC5nZXROYW1lKCksIGdldEZ1bGxOYW1lKGNvbC5nZXRU\nYWJsZSgpLCBmYWxzZSksCiAgICAgICAgICAgICAgICBnZXRHZW5lcmF0ZWRL\nZXlTZXF1ZW5jZU5hbWUoY29sKSwKICAgICAgICAgICAgfSk7CiAgICAgICAg\nfQoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJl\ncGFyZVN0YXRlbWVudChxdWVyeSk7CiAgICAgICAgUmVzdWx0U2V0IHJzID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBycyA9IHN0bW50LmV4\nZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBpZiAoIXJzLm5leHQoKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tZ2Vua2V5IikpOwogICAgICAgICAgICBPYmplY3Qga2V5ID0gcnMu\nZ2V0T2JqZWN0KDEpOwogICAgICAgICAgICBpZiAoa2V5ID09IG51bGwpCiAg\nICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC1nZW5r\nZXkiLCBjb2wpKTsKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBzZSkge30KICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fSAKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNlcXVlbmNlIG5hbWUgdXNl\nZCBieSBkYXRhYmFzZXMgZm9yIHRoZSBnaXZlbiBhdXRvYXNzaWduZWQKICAg\nICAqIGNvbHVtbi4gVGhpcyBpcyBvbmx5IHVzZWQgYnkgZGF0YWJhc2VzIHRo\nYXQgcmVxdWlyZSBhbiBleHBsaWNpdCBuYW1lCiAgICAgKiB0byBiZSB1c2Vk\nIGZvciBhdXRvLWFzc2lnbiBzdXBwb3J0LgogICAgICovCiAgICBwcm90ZWN0\nZWQgU3RyaW5nIGdldEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShDb2x1bW4g\nY29sKSB7CiAgICAgICAgU3RyaW5nIHRuYW1lID0gY29sLmdldFRhYmxlTmFt\nZSgpOwogICAgICAgIFN0cmluZyBjbmFtZSA9IGNvbC5nZXROYW1lKCk7CiAg\nICAgICAgaW50IG1heCA9IG1heEF1dG9Bc3NpZ25OYW1lTGVuZ3RoOwogICAg\nICAgIGludCBleHRyYUNoYXJzID0gLW1heCArIHRuYW1lLmxlbmd0aCgpICsg\nMSAvLyA8dG5hbWU+ICsgJ18nCiAgICAgICAgICAgICsgY25hbWUubGVuZ3Ro\nKCkgKyA0OyAvLyA8Y25hbWU+ICsgJ19TRVEnCiAgICAgICAgaWYgKGV4dHJh\nQ2hhcnMgPiAwKSB7CiAgICAgICAgICAgIC8vIHRoaXMgYXNzdW1lcyB0aGF0\nIHRuYW1lIGlzIGxvbmdlciB0aGFuIGV4dHJhQ2hhcnMKICAgICAgICAgICAg\ndG5hbWUgPSB0bmFtZS5zdWJzdHJpbmcoMCwgdG5hbWUubGVuZ3RoKCkgLSBl\neHRyYUNoYXJzKTsKICAgICAgICB9CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIobWF4KTsKICAgICAgICBidWYuYXBwZW5k\nKHRuYW1lKS5hcHBlbmQoIl8iKS5hcHBlbmQoY25hbWUpLmFwcGVuZCgiX1NF\nUSIpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25m\naWd1cmFibGUgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1cmF0\naW9uKENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIHRoaXMuY29uZiA9\nIChKREJDQ29uZmlndXJhdGlvbikgY29uZjsKICAgICAgICB0aGlzLmxvZyA9\nIHRoaXMuY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMp\nOwoKICAgICAgICAvLyB3YXJuIGFib3V0IHVuc3VwcG9ydGVkIGRpY3RzCiAg\nICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkgJiYgIWlzU3VwcG9ydGVk\nKCkpCiAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJkaWN0LW5vdC1z\ndXBwb3J0ZWQiLCBnZXRDbGFzcygpKSk7CiAgICB9CgogICAgcHJpdmF0ZSBi\nb29sZWFuIGlzU3VwcG9ydGVkKCkgewogICAgICAgIC8vIGlmIHRoaXMgaXMg\nYSBjdXN0b20gZGljdCwgdHJhdmVyc2UgdG8gd2hhdGV2ZXIgb3BlbmpwYSBk\naWN0IGl0IGV4dGVuZHMKICAgICAgICBDbGFzcyBjID0gZ2V0Q2xhc3MoKTsK\nICAgICAgICB3aGlsZSAoIWMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoIm9yZy5h\ncGFjaGUub3BlbmpwYS4iKSkKICAgICAgICAgICAgYyA9IGMuZ2V0U3VwZXJj\nbGFzcygpOwoKICAgICAgICAvLyB0aGUgZ2VuZXJpYyBkYmRpY3Rpb25hcnkg\naXMgbm90IGNvbnNpZGVyZWQgYSBzdXBwb3J0ZWQgZGljdDsgYWxsCiAgICAg\nICAgLy8gb3RoZXIgY29uY3JldGUgZGljdGlvbmFyaWVzIGFyZQogICAgICAg\nIGlmIChjID09IERCRGljdGlvbmFyeS5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIC8vIGlu\naXRpYWxpemUgdGhlIHNldCBvZiByZXNlcnZlZCBTUUw5MiB3b3JkcyBmcm9t\nIHJlc291cmNlCiAgICAgICAgSW5wdXRTdHJlYW0gaW4gPSBEQkRpY3Rpb25h\ncnkuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbQogICAgICAgICAgICAoInNx\nbC1rZXl3b3Jkcy5yc3JjIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nU3RyaW5nIGtleXdvcmRzID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBJbnB1\ndFN0cmVhbVJlYWRlcihpbikpLgogICAgICAgICAgICAgICAgcmVhZExpbmUo\nKTsKICAgICAgICAgICAgaW4uY2xvc2UoKTsKICAgICAgICAgICAgcmVzZXJ2\nZWRXb3JkU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQK\nICAgICAgICAgICAgICAgIChrZXl3b3JkcywgIiwiLCAwKSkpOwogICAgICAg\nIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHRyeSB7IGluLmNsb3NlKCk7IH0gY2F0Y2ggKElP\nRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgYWRk\naXRpb25hbCByZXNlcnZlZCB3b3JkcyBzZXQgYnkgdXNlcgogICAgICAgIGlm\nIChyZXNlcnZlZFdvcmRzICE9IG51bGwpCiAgICAgICAgICAgIHJlc2VydmVk\nV29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAg\nICAgICAgICAgICAgICAocmVzZXJ2ZWRXb3Jkcy50b1VwcGVyQ2FzZSgpLCAi\nLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBzeXN0ZW0gc2NoZW1hcyBzZXQg\nYnkgdXNlcgogICAgICAgIGlmIChzeXN0ZW1TY2hlbWFzICE9IG51bGwpCiAg\nICAgICAgICAgIHN5c3RlbVNjaGVtYVNldC5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoc3lzdGVtU2NoZW1h\ncy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBz\neXN0ZW0gdGFibGVzIHNldCBieSB1c2VyCiAgICAgICAgaWYgKHN5c3RlbVRh\nYmxlcyAhPSBudWxsKQogICAgICAgICAgICBzeXN0ZW1UYWJsZVNldC5hZGRB\nbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAg\nICAoc3lzdGVtVGFibGVzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKCiAg\nICAgICAgLy8gYWRkIGZpeGVkIHNpemUgdHlwZSBuYW1lcyBzZXQgYnkgdGhl\nIHVzZXIKICAgICAgICBpZiAoZml4ZWRTaXplVHlwZU5hbWVzICE9IG51bGwp\nCiAgICAgICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFsbChBcnJh\neXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChmaXhl\nZFNpemVUeXBlTmFtZXMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwoKICAg\nICAgICAvLyBpZiB1c2VyIGhhcyB1bnNldCBzZXF1ZW5jZSBzcWwsIG51bGwg\naXQgb3V0IHNvIHdlIGtub3cgc2VxdWVuY2VzCiAgICAgICAgLy8gYXJlbid0\nIHN1cHBvcnRlZAogICAgICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gU3RyaW5n\nVXRpbHMudHJpbVRvTnVsbChuZXh0U2VxdWVuY2VRdWVyeSk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIENvbm5lY3Rpb25EZWNvcmF0b3IgaW1wbGVtZW50YXRpb24KICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBEZWNvcmF0ZSB0aGUgZ2l2ZW4gY29ubmVjdGlvbiBpZiBuZWVk\nZWQuIFNvbWUgZGF0YWJhc2VzIHJlcXVpcmUgc3BlY2lhbAogICAgICogaGFu\nZGxpbmcgZm9yIEpEQkMgYnVncy4gVGhpcyBpbXBsZW1lbnRhdGlvbiBpc3N1\nZXMgYW55CiAgICAgKiB7QGxpbmsgI2luaXRpYWxpemF0aW9uU1FMfSB0aGF0\nIGhhcyBiZWVuIHNldCBmb3IgdGhlIGRpY3Rpb25hcnkgYnV0CiAgICAgKiBk\nb2VzIG5vdCBkZWNvcmVhdGUgdGhlIGNvbm5lY3Rpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyBDb25uZWN0aW9uIGRlY29yYXRlKENvbm5lY3Rpb24gY29ubikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWNv\nbm5lY3RlZCkKICAgICAgICAgICAgY29ubmVjdGVkQ29uZmlndXJhdGlvbihj\nb25uKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaW5pdGlh\nbGl6YXRpb25TUUwpKSB7CiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50ID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KGluaXRpYWxpemF0\naW9uU1FMKTsKICAgICAgICAgICAgICAgIHN0bW50LmV4ZWN1dGUoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb25u\nOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhl\nCiAgICAgKiB7QGxpbmsgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FM\nV2FybmluZ0hhbmRsZXJ9IGludGVyZmFjZQogICAgICogdGhhdCBhbGxvd3Mg\nY3VzdG9taXphdGlvbiBvZiB0aGUgYWN0aW9ucyB0byBwZXJmb3JtIHdoZW4g\nYQogICAgICoge0BsaW5rIFNRTFdhcm5pbmd9IG9jY3VycyBhdCBhbnkgcG9p\nbnQgb24gYSB7QGxpbmsgQ29ubmVjdGlvbn0sCiAgICAgKiB7QGxpbmsgU3Rh\ndGVtZW50fSwgb3Ige0BsaW5rIFJlc3VsdFNldH0uIFRoaXMgbWV0aG9kIG1h\neQogICAgICogYmUgdXNlZCBkZXRlcm1pbmUgdGhvc2Ugd2FybmluZ3MgdGhl\nIGFwcGxpY2F0aW9uIHdhbnRzIHRvCiAgICAgKiBjb25zaWRlciBjcml0aWNh\nbCBmYWlsdXJlcywgYW5kIHRocm93IHRoZSB3YXJuaW5nIGluIHRob3NlCiAg\nICAgKiBjYXNlcy4gQnkgZGVmYXVsdCwgdGhpcyBtZXRob2QgZG9lcyBub3Ro\naW5nLgogICAgICoKICAgICAqIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNv\ncmF0b3Ijc2V0V2FybmluZ0FjdGlvbgogICAgICogQHNlZSBMb2dnaW5nQ29u\nbmVjdGlvbkRlY29yYXRvciNzZXRXYXJuaW5nSGFuZGxlcgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBoYW5kbGVXYXJuaW5nKFNRTFdhcm5pbmcgd2Fybmlu\nZykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIG5ldyBleGNlcHRpb24gdGhhdCB3cmFwcyA8\nY29kZT5jYXVzZXM8L2NvZGU+LgogICAgICogSG93ZXZlciwgdGhlIGRldGFp\nbHMgb2YgZXhhY3RseSB3aGF0IHR5cGUgb2YgZXhjZXB0aW9uIGlzIHJldHVy\nbmVkIGNhbgogICAgICogYmUgZGV0ZXJtaW5lZCBieSB0aGUgaW1wbGVtZW50\nYXRpb24uIFRoaXMgbWF5IHRha2UgaW50byBhY2NvdW50CiAgICAgKiBEQi1z\ncGVjaWZpYyBleGNlcHRpb24gaW5mb3JtYXRpb24gaW4gPGNvZGU+Y2F1c2Vz\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFFeGNlcHRpb24g\nbmV3U3RvcmVFeGNlcHRpb24oU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uW10g\nY2F1c2VzLAogICAgICAgIE9iamVjdCBmYWlsZWQpIHsKICAgICAgICBpZiAo\nY2F1c2VzLmxlbmd0aCA+IDAgJiYgIjIzMDAwIi5lcXVhbHMoY2F1c2VzWzBd\nLmdldFNRTFN0YXRlKCkpKQogICAgICAgICAgICByZXR1cm4gbmV3IFJlZmVy\nZW50aWFsSW50ZWdyaXR5RXhjZXB0aW9uKG1zZykuCiAgICAgICAgICAgICAg\nICBzZXRGYWlsZWRPYmplY3QoZmFpbGVkKS5zZXROZXN0ZWRUaHJvd2FibGVz\nKGNhdXNlcyk7CiAgICAgICAgcmV0dXJuIG5ldyBTdG9yZUV4Y2VwdGlvbiht\nc2cpLnNldEZhaWxlZE9iamVjdChmYWlsZWQpLgogICAgICAgICAgICBzZXRO\nZXN0ZWRUaHJvd2FibGVzKGNhdXNlcyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbG9zZXMgdGhlIHNwZWNpZmllZCB7QGxpbmsgRGF0YVNvdXJjZX0gYW5k\nIHJlbGVhc2VzIGFueQogICAgICogcmVzb3VyY2VzIGFzc29jaWF0ZWQgd2l0\naCBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YVNvdXJjZSB0aGUgRGF0\nYVNvdXJjZSB0byBjbG9zZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9z\nZURhdGFTb3VyY2UoRGF0YVNvdXJjZSBkYXRhU291cmNlKSB7CiAgICAgICAg\nRGF0YVNvdXJjZUZhY3RvcnkuY2xvc2VEYXRhU291cmNlKGRhdGFTb3VyY2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBieSBzb21lIG1hcHBpbmdz\nIHRvIHJlcHJlc2VudCBkYXRhIHRoYXQgaGFzIGFscmVhZHkgYmVlbgogICAg\nICogc2VyaWFsaXplZCBzbyB0aGF0IHdlIGRvbid0IGhhdmUgdG8gc2VyaWFs\naXplIG11bHRpcGxlIHRpbWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGNsYXNzIFNlcmlhbGl6ZWREYXRhIHsKCiAgICAgICAgcHVibGljIGZpbmFs\nIGJ5dGVbXSBieXRlczsKCiAgICAgICAgcHVibGljIFNlcmlhbGl6ZWREYXRh\nKGJ5dGVbXSBieXRlcykgewogICAgICAgICAgICB0aGlzLmJ5dGVzID0gYnl0\nZXM7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

