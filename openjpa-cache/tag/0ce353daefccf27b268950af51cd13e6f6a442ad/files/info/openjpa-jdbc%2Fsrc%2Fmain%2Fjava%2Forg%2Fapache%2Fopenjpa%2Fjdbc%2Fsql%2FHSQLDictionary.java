{"sha":"cdf596110e7f5a070ee931802e310691f8c15473","node_id":"MDQ6QmxvYjIwNjM2NDpjZGY1OTYxMTBlN2Y1YTA3MGVlOTMxODAyZTMxMDY5MWY4YzE1NDcz","size":10933,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/cdf596110e7f5a070ee931802e310691f8c15473","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbDsKCmltcG9ydCBqYXZhLm1hdGguQmlnRGVjaW1h\nbDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZhLnNx\nbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRT\ndGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9y\ndCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7Cmlt\ncG9ydCBvcmcuaHNxbGRiLlRyYWNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlJlZmVyZW50aWFsSW50ZWdy\naXR5RXhjZXB0aW9uOwoKLyoqCiAqIERpY3Rpb25hcnkgZm9yIEh5cGVyc29u\naWMgU1FMIGRhdGFiYXNlLgogKi8KcHVibGljIGNsYXNzIEhTUUxEaWN0aW9u\nYXJ5CiAgICBleHRlbmRzIERCRGljdGlvbmFyeSB7CgogICAgLyoqCiAgICAg\nKiBTZXRzIHdoZXRoZXIgSFNRTCBzaG91bGQgdXNlICJDUkVBVEVEIENBQ0hF\nRCBUQUJMRSIgcmF0aGVyIHRoYW4KICAgICAqICJDUkVBVEUgVEFCTEUiLCB3\naGljaCBhbGxvd3MgZGlzay1iYXNlZCBkYXRhYmFzZSBvcGVyYXRpb25zLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBjYWNoZVRhYmxlcyA9IGZhbHNl\nOwoKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9vbmVCdWZmZXIgPSBuZXcgU1FM\nQnVmZmVyKHRoaXMpLmFwcGVuZCgiMSIpOwoKICAgIHB1YmxpYyBIU1FMRGlj\ndGlvbmFyeSgpIHsKICAgICAgICBwbGF0Zm9ybSA9ICJIU1FMIjsKICAgICAg\nICB2YWxpZGF0aW9uU1FMID0gIkNBTEwgMSI7CiAgICAgICAgY2xvc2VQb29s\nU1FMID0gIlNIVVRET1dOIjsKCiAgICAgICAgc3VwcG9ydHNBdXRvQXNzaWdu\nID0gdHJ1ZTsKICAgICAgICBsYXN0R2VuZXJhdGVkS2V5UXVlcnkgPSAiQ0FM\nTCBJREVOVElUWSgpIjsKICAgICAgICBhdXRvQXNzaWduQ2xhdXNlID0gIklE\nRU5USVRZIjsKICAgICAgICBhdXRvQXNzaWduVHlwZU5hbWUgPSAiSU5URUdF\nUiI7CiAgICAgICAgbmV4dFNlcXVlbmNlUXVlcnkgPSAiU0VMRUNUIE5FWFQg\nVkFMVUUgRk9SIHswfSBGUk9NIgogICAgICAgICAgICArICIgSU5GT1JNQVRJ\nT05fU0NIRU1BLlNZU1RFTV9TRVFVRU5DRVMiOwogICAgICAgIGNyb3NzSm9p\nbkNsYXVzZSA9ICJKT0lOIjsKICAgICAgICByZXF1aXJlc0NvbmRpdGlvbkZv\nckNyb3NzSm9pbiA9IHRydWU7CiAgICAgICAgc3RyaW5nTGVuZ3RoRnVuY3Rp\nb24gPSAiTEVOR1RIKHswfSkiOwogICAgICAgIHRyaW1MZWFkaW5nRnVuY3Rp\nb24gPSAiTFRSSU0oezB9KSI7CiAgICAgICAgdHJpbVRyYWlsaW5nRnVuY3Rp\nb24gPSAiUlRSSU0oezB9KSI7CiAgICAgICAgdHJpbUJvdGhGdW5jdGlvbiA9\nICJMVFJJTShSVFJJTSh7MH0pKSI7CgogICAgICAgIC8vIEhTUUwgMS44LjAg\nZG9lcyBzdXBwb3J0IHNjaGVtYSBuYW1lcyBpbiB0aGUgdGFibGUgKCJzY2hl\nbWEudGFibGUiKSwKICAgICAgICAvLyBidXQgZG9lc24ndCBzdXBwb3J0IGl0\nIGZvciBjb2x1bW5zIHJlZmVyZW5jZXMgKCJzY2hlbWEudGFibGUuY29sdW1u\nIikKICAgICAgICB1c2VTY2hlbWFOYW1lID0gZmFsc2U7CiAgICAgICAgc3Vw\ncG9ydHNTZWxlY3RGb3JVcGRhdGUgPSBmYWxzZTsKICAgICAgICBzdXBwb3J0\nc1NlbGVjdFN0YXJ0SW5kZXggPSB0cnVlOwogICAgICAgIHN1cHBvcnRzU2Vs\nZWN0RW5kSW5kZXggPSB0cnVlOwogICAgICAgIHJhbmdlUG9zaXRpb24gPSBS\nQU5HRV9QUkVfRElTVElOQ1Q7CiAgICAgICAgc3VwcG9ydHNEZWZlcnJlZENv\nbnN0cmFpbnRzID0gZmFsc2U7CgogICAgICAgIHVzZUdldE9iamVjdEZvckJs\nb2JzID0gdHJ1ZTsKICAgICAgICBibG9iVHlwZU5hbWUgPSAiVkFSQklOQVJZ\nIjsKICAgICAgICBkb3VibGVUeXBlTmFtZSA9ICJOVU1FUklDIjsKCiAgICAg\nICAgc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRQcmltYXJ5S2V5cyA9IHRydWU7\nCiAgICAgICAgc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8gPSB0\ncnVlOwoKICAgICAgICByZXF1aXJlc0Nhc3RGb3JNYXRoRnVuY3Rpb25zID0g\ndHJ1ZTsKICAgICAgICByZXF1aXJlc0Nhc3RGb3JDb21wYXJpc29ucyA9IHRy\ndWU7CgogICAgICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwoQXJyYXlzLmFz\nTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJCRUZPUkUiLCAiQklH\nSU5UIiwgIkJJTkFSWSIsICJDQUNIRUQiLCAiREFURVRJTUUiLCAiTElNSVQi\nLAogICAgICAgICAgICAiTE9OR1ZBUkJJTkFSWSIsICJMT05HVkFSQ0hBUiIs\nICJPQkpFQ1QiLCAiT1RIRVIiLAogICAgICAgICAgICAiU0FWRVBPSU5UIiwg\nIlRFTVAiLCAiVEVYVCIsICJUUklHR0VSIiwgIlRJTllJTlQiLAogICAgICAg\nICAgICAiVkFSQklOQVJZIiwgIlZBUkNIQVJfSUdOT1JFQ0FTRSIsCiAgICAg\nICAgfSkpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0SkRCQ1R5cGUoaW50\nIG1ldGFUeXBlQ29kZSwgYm9vbGVhbiBsb2IpIHsKICAgICAgICBpbnQgdHlw\nZSA9IHN1cGVyLmdldEpEQkNUeXBlKG1ldGFUeXBlQ29kZSwgbG9iKTsKICAg\nICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUeXBlcy5C\nSUdJTlQ6CiAgICAgICAgICAgICAgICBpZiAobWV0YVR5cGVDb2RlID09IEph\ndmFUeXBlcy5CSUdJTlRFR0VSKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBUeXBlcy5OVU1FUklDOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgZ2V0UHJlZmVycmVkVHlwZShpbnQgdHlwZSkgewogICAgICAgIHN3aXRj\naCAodHlwZSkgewogICAgICAgICAgICBjYXNlIFR5cGVzLkNMT0I6CiAgICAg\nICAgICAgICAgICByZXR1cm4gVHlwZXMuVkFSQ0hBUjsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5CTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIFR5cGVz\nLlZBUkJJTkFSWTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5nZXRQcmVmZXJyZWRUeXBlKHR5cGUpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkUHJpbWFy\neUtleVNRTChQcmltYXJ5S2V5IHBrKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbMF07CiAgICB9CgogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BQ\ncmltYXJ5S2V5U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ1swXTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0\nQWRkQ29sdW1uU1FMKENvbHVtbiBjb2x1bW4pIHsKICAgICAgICByZXR1cm4g\nbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdl\ndEZ1bGxOYW1lKGNvbHVtbi5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAg\nICAgKyAiIEFERCBDT0xVTU4gIiArIGdldERlY2xhcmVDb2x1bW5TUUwoY29s\ndW1uLCB0cnVlKSB9OwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRD\ncmVhdGVUYWJsZVNRTChUYWJsZSB0YWJsZSkgewogICAgICAgIFN0cmluZ0J1\nZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFw\ncGVuZCgiQ1JFQVRFICIpOwogICAgICAgIGlmIChjYWNoZVRhYmxlcykKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiQ0FDSEVEICIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIlRBQkxFICIpLmFwcGVuZChnZXRGdWxsTmFtZSh0YWJsZSwgZmFs\nc2UpKS5hcHBlbmQoIiAoIik7CgogICAgICAgIENvbHVtbltdIGNvbHMgPSB0\nYWJsZS5nZXRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpID4gMCkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoZ2V0RGVjbGFyZUNvbHVtblNRTChjb2xzW2ldLCBmYWxz\nZSkpOwogICAgICAgIH0KCiAgICAgICAgUHJpbWFyeUtleSBwayA9IHRhYmxl\nLmdldFByaW1hcnlLZXkoKTsKICAgICAgICBTdHJpbmcgcGtTdHI7CiAgICAg\nICAgaWYgKHBrICE9IG51bGwpIHsKICAgICAgICAgICAgcGtTdHIgPSBnZXRQ\ncmltYXJ5S2V5Q29uc3RyYWludFNRTChwayk7CiAgICAgICAgICAgIGlmICgh\nU3RyaW5nVXRpbHMuaXNFbXB0eShwa1N0cikpCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIsICIpLmFwcGVuZChwa1N0cik7CiAgICAgICAgfQoKICAg\nICAgICBVbmlxdWVbXSB1bnFzID0gdGFibGUuZ2V0VW5pcXVlcygpOwogICAg\nICAgIFN0cmluZyB1bnFTdHI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCB1bnFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVucVN0ciA9IGdl\ndFVuaXF1ZUNvbnN0cmFpbnRTUUwodW5xc1tpXSk7CiAgICAgICAgICAgIGlm\nICh1bnFTdHIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiwgIikuYXBwZW5kKHVucVN0cik7CiAgICAgICAgfQoKICAgICAgICBidWYu\nYXBwZW5kKCIpIik7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVm\nLnRvU3RyaW5nKCkgfTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndFByaW1hcnlLZXlDb25zdHJhaW50U1FMKFByaW1hcnlLZXkgcGspIHsKICAg\nICAgICBDb2x1bW5bXSBjb2xzID0gcGsuZ2V0Q29sdW1ucygpOwogICAgICAg\nIGlmIChjb2xzLmxlbmd0aCA9PSAxICYmIGNvbHNbMF0uaXNBdXRvQXNzaWdu\nZWQoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJu\nIHN1cGVyLmdldFByaW1hcnlLZXlDb25zdHJhaW50U1FMKHBrKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3RlbUluZGV4KFN0cmluZyBuYW1l\nLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJldHVybiBuYW1lLnRvVXBwZXJD\nYXNlKCkuc3RhcnRzV2l0aCgiU1lTXyIpOwogICAgfQoKICAgIHByb3RlY3Rl\nZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBT\ndHJpbmcgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1\nZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJT\nRUxFQ1QgU0VRVUVOQ0VfU0NIRU1BLCBTRVFVRU5DRV9OQU1FIEZST00gIiku\nCiAgICAgICAgICAgIGFwcGVuZCgiSU5GT1JNQVRJT05fU0NIRU1BLlNZU1RF\nTV9TRVFVRU5DRVMiKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxs\nIHx8IHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCIgV0hFUkUgIik7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVs\nbCkgewogICAgICAgICAgICBidWYuYXBwZW5kKCJTRVFVRU5DRV9TQ0hFTUEg\nPSA/Iik7CiAgICAgICAgICAgIGlmIChzZXF1ZW5jZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAg\nfQogICAgICAgIGlmIChzZXF1ZW5jZU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiU0VRVUVOQ0VfTkFNRSA9ID8iKTsKICAgICAgICBy\nZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIFNR\nTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxl\nY3RzLCAKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdoZXJl\nLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBoYXZpbmcsIAogICAgICAg\nIFNRTEJ1ZmZlciBvcmRlciwgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBm\nb3JVcGRhdGUsIGxvbmcgc3RhcnQsIAogICAgICAgIGxvbmcgZW5kKSB7CiAg\nICAgICAgLy8gaHNxbCByZXF1aXJlcyBvcmRlcmluZyB3aGVuIGxpbWl0IGlz\nIHVzZWQKICAgICAgICBpZiAoKHN0YXJ0ICE9IDAgfHwgZW5kICE9IExvbmcu\nTUFYX1ZBTFVFKQogICAgICAgICAgICAmJiAob3JkZXIgPT0gbnVsbCB8fCBv\ncmRlci5pc0VtcHR5KCkpKQogICAgICAgICAgICBvcmRlciA9IF9vbmVCdWZm\nZXI7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRvT3BlcmF0aW9uKG9wLCBzZWxl\nY3RzLCBmcm9tLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAg\nb3JkZXIsIGRpc3RpbmN0LCBmb3JVcGRhdGUsIHN0YXJ0LCBlbmQpOwogICAg\nfQoKICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5zKERhdGFiYXNlTWV0\nYURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIFN0cmluZyBjb2x1bW5OYW1l\nLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IHN1cGVyLmdldENvbHVtbnMo\nbWV0YSwgY2F0YWxvZywgc2NoZW1hTmFtZSwgdGFibGVOYW1lLAogICAgICAg\nICAgICBjb2x1bW5OYW1lLCBjb25uKTsKCiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGNvbHMgIT0gbnVsbCAmJiBpIDwgY29scy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKCJCT09MRUFOIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNb\naV0uZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNl\ndFR5cGUoVHlwZXMuQklUKTsKICAgICAgICByZXR1cm4gY29sczsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXREb3VibGUoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIGRvdWJsZSB2YWwsCiAgICAgICAgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBI\nU1FMIGhhcyBhIGJ1ZyB3aGVyZSBpdCBjYW5ub3Qgc3RvcmUgYSBkb3VibGUg\naWYgaXQgaXMKICAgICAgICAvLyBleGFjdGx5IHRoZSBzYW1lIGFzIExvbmcu\nTUFYX1ZBTFVFIG9yIE1JTl9WQUxVRQogICAgICAgIGlmICh2YWwgPT0gTG9u\nZy5NQVhfVkFMVUUgfHwgdmFsID09IExvbmcuTUlOX1ZBTFVFKSB7CiAgICAg\nICAgICAgIHN0bW50LnNldExvbmcoaWR4LCAobG9uZyl2YWwpOwogICAgICAg\nIH0gZWxzZSAgewogICAgICAgICAgICBzdXBlci5zZXREb3VibGUoc3RtbnQs\nIGlkeCwgdmFsLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRCaWdEZWNpbWFsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBCaWdEZWNpbWFsIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGhzcWwg\nY2FuJ3QgY29tcGFyZSBhIEJpZ0RlY2ltYWwgZXF1YWwgdG8gYW55IG90aGVy\nIHR5cGUsIHNvIHRyeQogICAgICAgIC8vIHRvIHNldCB0eXBlIGJhc2VkIG9u\nIGNvbHVtbgogICAgICAgIGludCB0eXBlID0gKHZhbCA9PSBudWxsIHx8IGNv\nbCA9PSBudWxsKSA/IEphdmFUeXBlcy5CSUdERUNJTUFMCiAgICAgICAgICAg\nIDogY29sLmdldEphdmFUeXBlKCk7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAg\nIHNldERvdWJsZShzdG1udCwgaWR4LCB2YWwuZG91YmxlVmFsdWUoKSwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVRfT0JKOgogICAgICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgs\nIHZhbC5mbG9hdFZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHN1cGVy\nLnNldEJpZ0RlY2ltYWwoc3RtbnQsIGlkeCwgdmFsLCBjb2wpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRTZWxlY3RSYW5n\nZShTUUxCdWZmZXIgYnVmLCBsb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAg\nICAgIC8vIEhTUUwgZG9lc24ndCBwYXJhbWV0ZXJzIGluIHJhbmdlCiAgICAg\nICAgYnVmLmFwcGVuZCgiIExJTUlUICIpLmFwcGVuZChTdHJpbmcudmFsdWVP\nZihzdGFydCkpLmFwcGVuZCgiICIpOwogICAgICAgIGlmIChlbmQgPT0gTG9u\nZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoU3RyaW5nLnZh\nbHVlT2YoMCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnVmLmFwcGVu\nZChTdHJpbmcudmFsdWVPZihlbmQgLSBzdGFydCkpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHN1YnN0cmluZyhTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1\nZSBzdHIsIEZpbHRlclZhbHVlIHN0YXJ0LAogICAgICAgIEZpbHRlclZhbHVl\nIGVuZCkgewogICAgICAgIGJ1Zi5hcHBlbmQoc3Vic3RyaW5nRnVuY3Rpb25O\nYW1lKS5hcHBlbmQoIigoIik7CiAgICAgICAgc3RyLmFwcGVuZFRvKGJ1Zik7\nCiAgICAgICAgYnVmLmFwcGVuZCgiKSwgKCIpOwogICAgICAgIHN0YXJ0LmFw\ncGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiICsgMSkiKTsKICAg\nICAgICBpZiAoZW5kICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiLCAoIik7CiAgICAgICAgICAgIGFwcGVuZE51bWVyaWNDYXN0KGJ1Ziwg\nZW5kKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIC0gKCIpOwogICAgICAg\nICAgICBhcHBlbmROdW1lcmljQ2FzdChidWYsIHN0YXJ0KTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiKSkiKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFw\ncGVuZCgiKSIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluZGV4T2YoU1FM\nQnVmZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBmaW5k\nLAogICAgICAgIEZpbHRlclZhbHVlIHN0YXJ0KSB7CiAgICAgICAgYnVmLmFw\ncGVuZCgiKExPQ0FURSgiKTsKICAgICAgICBmaW5kLmFwcGVuZFRvKGJ1Zik7\nCiAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICBzdHIuYXBwZW5k\nVG8oYnVmKTsKICAgICAgICBpZiAoc3RhcnQgIT0gbnVsbCkgewogICAgICAg\nICAgICBidWYuYXBwZW5kKCIsICgiKTsKICAgICAgICAgICAgc3RhcnQuYXBw\nZW5kVG8oYnVmKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICsgMSkiKTsK\nICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgiKSAtIDEpIik7CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBnZXRQbGFjZWhvbGRlclZhbHVlU3RyaW5n\nKENvbHVtbiBjb2wpIHsKICAgICAgICBTdHJpbmcgdHlwZSA9IGdldFR5cGVO\nYW1lKGNvbC5nZXRUeXBlKCkpOwogICAgICAgIGludCBpZHggPSB0eXBlLmlu\nZGV4T2YoInswfSIpOwogICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAgICAg\nICAgICAgU3RyaW5nIHByZSA9IHR5cGUuc3Vic3RyaW5nKDAsIGlkeCk7CiAg\nICAgICAgICAgIGlmICh0eXBlLmxlbmd0aCgpID4gaWR4ICsgMykKICAgICAg\nICAgICAgICAgIHR5cGUgPSBwcmUgKyB0eXBlLnN1YnN0cmluZyhpZHggKyAz\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdHlwZSA9IHBy\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICJOVUxMIEFTICIgKyB0eXBl\nOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBRXhjZXB0aW9uIG5ld1N0b3Jl\nRXhjZXB0aW9uKFN0cmluZyBtc2csIFNRTEV4Y2VwdGlvbltdIGNhdXNlcywK\nICAgICAgICBPYmplY3QgZmFpbGVkKSB7CiAgICAgICAgT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSA9IHN1cGVyLm5ld1N0b3JlRXhjZXB0aW9uKG1zZywgY2F1c2Vz\nLCBmYWlsZWQpOwogICAgICAgIGlmIChrZSBpbnN0YW5jZW9mIFJlZmVyZW50\naWFsSW50ZWdyaXR5RXhjZXB0aW9uCiAgICAgICAgICAgICYmIGNhdXNlc1sw\nXS5nZXRFcnJvckNvZGUoKSA9PSAtVHJhY2UuVklPTEFUSU9OX09GX1VOSVFV\nRV9JTkRFWCkgewogICAgICAgICAgICAoKFJlZmVyZW50aWFsSW50ZWdyaXR5\nRXhjZXB0aW9uKSBrZSkuc2V0SW50ZWdyaXR5VmlvbGF0aW9uCiAgICAgICAg\nICAgICAgICAoUmVmZXJlbnRpYWxJbnRlZ3JpdHlFeGNlcHRpb24uSVZfVU5J\nUVVFKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGtlOwogICAgfQp9Cg==\n","encoding":"base64"}

