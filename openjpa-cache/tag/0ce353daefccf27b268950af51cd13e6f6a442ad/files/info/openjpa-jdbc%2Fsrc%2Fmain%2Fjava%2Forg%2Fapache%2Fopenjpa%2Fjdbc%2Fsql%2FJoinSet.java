{"sha":"799da038586af6e1cc42ef5da7fdb2e5d05bbca1","node_id":"MDQ6QmxvYjIwNjM2NDo3OTlkYTAzODU4NmFmNmUxY2M0MmVmNWRhN2ZkYjJlNWQwNWJiY2Ex","size":11881,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/799da038586af6e1cc42ef5da7fdb2e5d05bbca1","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbDsKCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTm9TdWNoRWxlbWVu\ndEV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5P\nYmplY3RVdGlsczsKCi8qKgogKiBTZXQgdHlwZSB0aGF0IHJlY29nbml6ZXMg\ndGhhdCBpbm5lciBqb2lucyBzaG91bGQgdGFrZSBwcmVjZWRlbmNlCiAqIG92\nZXIgb3RoZXJ3aXNlIGVxdWFsIG91dGVyIGpvaW5zLgogKgogKiBAYXV0aG9y\nIEFiZSBXaGl0ZQogKi8KY2xhc3MgSm9pblNldCB7CgogICAgLy8gdGhlIGpv\naW5zIGFyZSBzdG9yZWQgYXMgYW4gYWRqYWNlbmN5IGxpc3QgZ3JhcGguICBp\ndCdzIGEgcmVhc29uYWJseQogICAgLy8gZWZmaWNpZW50IHJlcHJlc2VudGF0\naW9uIHdpdGggTygxKSBsb29rdXAsIGFkZCwgcmVtb3ZlIG9wZXJhdGlvbnMg\nZm9yCiAgICAvLyB0eXBpY2FsIHNldHMgb2Ygam9pbnMsIGFuZCBpdCBtZWFu\ncyB3ZSdkIGhhdmUgdG8gY3JlYXRlIGEgZ3JhcGggYW55d2F5CiAgICAvLyB3\naGVuIGpvaW5JdGVyYXRvcigpIGlzIGNhbGxlZAogICAgcHJpdmF0ZSBmaW5h\nbCBMaXN0IF9ncmFwaCA9IG5ldyBBcnJheUxpc3QoKTsKICAgIHByaXZhdGUg\naW50IF9zaXplID0gMDsKICAgIHByaXZhdGUgTGlzdCBfc29ydGVkID0gbnVs\nbDsKCiAgICBwdWJsaWMgSm9pblNldCgpIHsKICAgIH0KCiAgICBwdWJsaWMg\nSm9pblNldChKb2luU2V0IGNvcHkpIHsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvcHkuX2dyYXBoLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChjb3B5Ll9ncmFwaC5nZXQoaSkgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9ncmFwaC5hZGQobnVsbCk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIF9ncmFwaC5hZGQoKChOb2RlKSBjb3B5Ll9ncmFwaC5nZXQo\naSkpLmNsb25lKCkpOwogICAgICAgIH0KICAgICAgICBfc2l6ZSA9IGNvcHku\nX3NpemU7CiAgICAgICAgX3NvcnRlZCA9IGNvcHkuX3NvcnRlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVjb3JkZWQgam9pbiBtYXRj\naGluZyB0aGUgZ2l2ZW4gam9pbidzIGFsaWFzZXMuCiAgICAgKi8KICAgIHB1\nYmxpYyBKb2luIGdldFJlY29yZGVkSm9pbihKb2luIGpvaW4pIHsKICAgICAg\nICBpZiAoam9pbiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBOb2RlIG5vZGUgPSBnZXROb2RlKGpvaW4sIGpvaW4uZ2V0SW5k\nZXgxKCkpOwogICAgICAgIHJldHVybiAobm9kZSA9PSBudWxsKSA/IG51bGwg\nOiBub2RlLmpvaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG5vZGUgZm9yIHRoZSBzcGVjaWZpZWQgam9pbiBhbmQgaW5kZXguCiAgICAg\nKi8KICAgIHByaXZhdGUgTm9kZSBnZXROb2RlKEpvaW4gam9pbiwgaW50IGlk\neCkgewogICAgICAgIGlmIChfZ3JhcGguc2l6ZSgpIDw9IGlkeCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgTm9kZSBub2RlID0gKE5vZGUp\nIF9ncmFwaC5nZXQoaWR4KTsKICAgICAgICBmb3IgKDsgbm9kZSAhPSBudWxs\nOyBub2RlID0gbm9kZS5uZXh0KQogICAgICAgICAgICBpZiAobm9kZS5qb2lu\nLmVxdWFscyhqb2luKSkKICAgICAgICAgICAgICAgIHJldHVybiBub2RlOwog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBsb2dpY2FsIGxhc3Qgam9pbi4KICAgICAqLwogICAgcHVibGlj\nIEpvaW4gbGFzdCgpIHsKICAgICAgICBpZiAoX3NpemUgPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgTm9kZSBub2RlID0gKE5vZGUp\nIF9ncmFwaC5nZXQoX2dyYXBoLnNpemUoKSAtIDEpOwogICAgICAgIHdoaWxl\nIChub2RlLm5leHQgIT0gbnVsbCkKICAgICAgICAgICAgbm9kZSA9IG5vZGUu\nbmV4dDsKICAgICAgICByZXR1cm4gbm9kZS5qb2luOwogICAgfQoKICAgIC8q\nKgogICAgICogSXRlcmF0b3Igb3ZlciBqb2lucyB0aGF0IHByZXBhcmVzIHRo\nZW0gZm9yIFNRTCB0cmFuc2xhdGlvbi4KICAgICAqLwogICAgcHVibGljIEl0\nZXJhdG9yIGpvaW5JdGVyYXRvcigpIHsKICAgICAgICBpZiAoX3NpemUgPCAy\nKQogICAgICAgICAgICByZXR1cm4gaXRlcmF0b3IoKTsKICAgICAgICBpZiAo\nX3NvcnRlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3NvcnRlZC5p\ndGVyYXRvcigpOwoKICAgICAgICBMaXN0IHNvcnRlZCA9IG5ldyBBcnJheUxp\nc3QoX3NpemUpOwogICAgICAgIExpbmtlZExpc3QgcXVldWUgPSBuZXcgTGlu\na2VkTGlzdCgpOwogICAgICAgIEJpdFNldCBzZWVuID0gbmV3IEJpdFNldChf\nZ3JhcGguc2l6ZSgpICogX2dyYXBoLnNpemUoKQogICAgICAgICAgICArIF9n\ncmFwaC5zaXplKCkpOwoKICAgICAgICAvLyB0cmF2ZXJzZSBncmFwaAogICAg\nICAgIE5vZGUgbjsKICAgICAgICBpbnQgaWR4LCBzaWR4OwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX2dyYXBoLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgIC8vIHNlZWQgcXVldWUgd2l0aCBuZXh0IHNldCBvZiBkaXNjb25u\nZWN0ZWQgam9pbnMKICAgICAgICAgICAgZm9yIChuID0gKE5vZGUpIF9ncmFw\naC5nZXQoaSk7IG4gIT0gbnVsbDsgbiA9IG4ubmV4dCkgewogICAgICAgICAg\nICAgICAgc2lkeCA9IGdldFNlZW5JbmRleChuLmpvaW4pOwogICAgICAgICAg\nICAgICAgaWYgKCFzZWVuLmdldChzaWR4KSkgewogICAgICAgICAgICAgICAg\nICAgIHNlZW4uc2V0KHNpZHgpOwogICAgICAgICAgICAgICAgICAgIHF1ZXVl\nLmFkZChuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAocXVldWUuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAvLyB0cmF2ZXJzZSBmcm9tIHRob3Nl\nIGpvaW5zIHRvIHJlYWNoYWJsZXMKICAgICAgICAgICAgd2hpbGUgKCFxdWV1\nZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIG4gPSAoTm9kZSkgcXVl\ndWUucmVtb3ZlRmlyc3QoKTsKCiAgICAgICAgICAgICAgICAvLyBkb24ndCBy\nZXBlYXQgYSBqb2luIHRvIGEgdGFibGUgd2UndmUgYWxyZWFkeSBqb2luZWQs\nIGJ1dAogICAgICAgICAgICAgICAgLy8gZG8gdHJhdmVyc2UgdGhyb3VnaCBp\ndCBpbiB0aGUgZ3JhcGggKHRoZSBmaXJzdCBpbmRleGVzIG9mCiAgICAgICAg\nICAgICAgICAvLyB0aGUgc2VlZW4gYml0c2V0IGFyZSByZXNlcnZlZCBmb3Ig\nam9pbmVkLXRvIHRhYmxlcykKICAgICAgICAgICAgICAgIGlkeCA9IChuLmZv\ncndhcmQpID8gbi5qb2luLmdldEluZGV4MigpIDogbi5qb2luLmdldEluZGV4\nMSgpOwogICAgICAgICAgICAgICAgaWYgKCFzZWVuLmdldChpZHgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgc29ydGVkLmFkZCgobi5mb3J3YXJkKSA/IG4u\nam9pbiA6IG4uam9pbi5yZXZlcnNlKCkpOwogICAgICAgICAgICAgICAgICAg\nIHNlZW4uc2V0KGlkeCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgZm9yIChuID0gKE5vZGUpIF9ncmFwaC5nZXQoaWR4KTsgbiAhPSBu\ndWxsOyBuID0gbi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgc2lkeCA9\nIGdldFNlZW5JbmRleChuLmpvaW4pOwogICAgICAgICAgICAgICAgICAgIGlm\nICghc2Vlbi5nZXQoc2lkeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2Vlbi5zZXQoc2lkeCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVl\nLmFkZChuKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX3NvcnRlZCA9\nIHNvcnRlZDsKICAgICAgICByZXR1cm4gX3NvcnRlZC5pdGVyYXRvcigpOwog\nICAgfQoKICAgIC8qKgogICAgICogV2UgY3JlYXRlIGEgdW5pcXVlIGluZGV4\nIGZvciByZWNvcmRpbmcgc2VlbiBub2RlcyBieQogICAgICogdHJlYXRpbmcg\ndGhlIGpvaW5lZCBpbmRleGVzIGFzIGEgYmFzZSAobWF4LWluZGV4KSBudW1i\nZXIuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldFNlZW5JbmRleChKb2lu\nIGpvaW4pIHsKICAgICAgICAvLyB3ZSByZXNlcnZlIGluZGV4ZXMgMC4uLl9n\ncmFwaC5zaXplKCkgZm9yIGpvaW5lZCB0YWJsZXMKICAgICAgICByZXR1cm4g\nam9pbi5nZXRJbmRleDEoKSAqIF9ncmFwaC5zaXplKCkgKyBqb2luLmdldElu\nZGV4MigpCiAgICAgICAgICAgICsgX2dyYXBoLnNpemUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBhZGQoSm9pbiBqb2luKSB7CiAgICAgICAgaWYg\nKGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9PVVRFUikgewogICAgICAg\nICAgICAvLyBvdXRlciBzaG91bGRuJ3Qgb3ZlcnJpZGUgYW55IG90aGVyIGpv\naW4gdHlwZQogICAgICAgICAgICBpZiAoIWNvbnRhaW5zKGpvaW4pKSB7CiAg\nICAgICAgICAgICAgICBhZGROb2RlKGpvaW4pOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVwbGFjZSBhbnkgZXhp\nc3Rpbmcgam9pbiB3aXRoIHRoaXMgb25lCiAgICAgICAgTm9kZSBub2RlID0g\nZ2V0Tm9kZShqb2luLCBqb2luLmdldEluZGV4MSgpKTsKICAgICAgICBpZiAo\nbm9kZSAhPSBudWxsKSB7CiAgICAgICAgICAgIG5vZGUuam9pbiA9IGpvaW47\nCiAgICAgICAgICAgIGdldE5vZGUoam9pbiwgam9pbi5nZXRJbmRleDIoKSku\nam9pbiA9IGpvaW47CiAgICAgICAgICAgIF9zb3J0ZWQgPSBudWxsOwogICAg\nICAgIH0gZWxzZQogICAgICAgICAgICBhZGROb2RlKGpvaW4pOwogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGFkZEFs\nbChKb2luU2V0IGpzKSB7CiAgICAgICAgaWYgKGpzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBib29sZWFuIGFkZGVk\nID0gZmFsc2U7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBqcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgYWRkZWQgPSBh\nZGQoKEpvaW4pIGl0ci5uZXh0KCkpIHx8IGFkZGVkOwogICAgICAgIHJldHVy\nbiBhZGRlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZSBq\nb2luIHRvIG91ciBncmFwaC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZE5vZGUoSm9pbiBqb2luKSB7CiAgICAgICAgX3NvcnRlZCA9IG51bGw7Cgog\nICAgICAgIGludCBzaXplID0gTWF0aC5tYXgoam9pbi5nZXRJbmRleDEoKSwg\nam9pbi5nZXRJbmRleDIoKSkgKyAxOwogICAgICAgIHdoaWxlIChfZ3JhcGgu\nc2l6ZSgpIDwgc2l6ZSkKICAgICAgICAgICAgX2dyYXBoLmFkZChudWxsKTsK\nCiAgICAgICAgTm9kZSBub2RlID0gKE5vZGUpIF9ncmFwaC5nZXQoam9pbi5n\nZXRJbmRleDEoKSk7CiAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkKICAgICAg\nICAgICAgX2dyYXBoLnNldChqb2luLmdldEluZGV4MSgpLCBuZXcgTm9kZShq\nb2luLCB0cnVlKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHdoaWxl\nIChub2RlLm5leHQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG5vZGUgPSBu\nb2RlLm5leHQ7CiAgICAgICAgICAgIG5vZGUubmV4dCA9IG5ldyBOb2RlKGpv\naW4sIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgbm9kZSA9IChOb2RlKSBf\nZ3JhcGguZ2V0KGpvaW4uZ2V0SW5kZXgyKCkpOwogICAgICAgIGlmIChub2Rl\nID09IG51bGwpCiAgICAgICAgICAgIF9ncmFwaC5zZXQoam9pbi5nZXRJbmRl\neDIoKSwgbmV3IE5vZGUoam9pbiwgZmFsc2UpKTsKICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgd2hpbGUgKG5vZGUubmV4dCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgbm9kZSA9IG5vZGUubmV4dDsKICAgICAgICAgICAgbm9kZS5u\nZXh0ID0gbmV3IE5vZGUoam9pbiwgZmFsc2UpOwogICAgICAgIH0KICAgICAg\nICBfc2l6ZSsrOwogICAgfQoKICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRv\ncigpIHsKICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yKCkgewogICAgICAg\nICAgICBwcml2YXRlIE5vZGUgX25leHQgPSBudWxsOwogICAgICAgICAgICBw\ncml2YXRlIGludCBfaWR4ID0gLTE7CgogICAgICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNOZXh0KCkgewogICAgICAgICAgICAgICAgaWYgKF9uZXh0ICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAg\nICAgICAgICAgICAgd2hpbGUgKCsrX2lkeCA8IF9ncmFwaC5zaXplKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBfbmV4dCA9IChOb2RlKSBfZ3JhcGguZ2V0\nKF9pZHgpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChfbmV4dCAhPSBu\ndWxsICYmICFfbmV4dC5mb3J3YXJkKQogICAgICAgICAgICAgICAgICAgICAg\nICBfbmV4dCA9IF9uZXh0Lm5leHQ7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9uZXh0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nT2JqZWN0IG5leHQoKSB7CiAgICAgICAgICAgICAgICBpZiAoIWhhc05leHQo\nKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9TdWNoRWxlbWVu\ndEV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgSm9pbiBqID0gX25leHQu\nam9pbjsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAg\nICBfbmV4dCA9IF9uZXh0Lm5leHQ7CiAgICAgICAgICAgICAgICB9IHdoaWxl\nIChfbmV4dCAhPSBudWxsICYmICFfbmV4dC5mb3J3YXJkKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgdm9pZCByZW1vdmUoKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICAg\nICAgfQogICAgICAgIH07CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gcmVt\nb3ZlKEpvaW4gam9pbikgewogICAgICAgIGlmIChqb2luID09IG51bGwgfHwg\nX2dyYXBoLnNpemUoKSA8PSBqb2luLmdldEluZGV4MSgpKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHJlbW92ZShqb2luLCBqb2lu\nLmdldEluZGV4MSgpKSkgewogICAgICAgICAgICBfc2l6ZS0tOwogICAgICAg\nICAgICByZXR1cm4gcmVtb3ZlKGpvaW4sIGpvaW4uZ2V0SW5kZXgyKCkpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFYWNoIGpvaW4gaXMgcmVjb3JkZWQgb25lIGF0IGl0cyBmaXJz\ndCBpbmRleCBhbmQgb25jZSBhdCBpdHMgc2Vjb25kOwogICAgICogcmVtb3Zl\nIHRoZSBqb2luIGF0IG9uZSBvZiBpdHMgaW5kZXhlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIHJlbW92ZShKb2luIGpvaW4sIGludCBpZHgpIHsK\nICAgICAgICBOb2RlIG5vZGUgPSAoTm9kZSkgX2dyYXBoLmdldChpZHgpOwog\nICAgICAgIGZvciAoTm9kZSBwcmV2ID0gbnVsbDsgbm9kZSAhPSBudWxsOyBw\ncmV2ID0gbm9kZSwgbm9kZSA9IG5vZGUubmV4dCkgewogICAgICAgICAgICBp\nZiAoIW5vZGUuam9pbi5lcXVhbHMoam9pbikpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIGlmIChwcmV2ICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBwcmV2Lm5leHQgPSBub2RlLm5leHQ7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgX2dyYXBoLnNldChpZHgsIG5vZGUu\nbmV4dCk7CiAgICAgICAgICAgICAgICAvLyB0cmltIHRvIHNpemUKICAgICAg\nICAgICAgICAgIHdoaWxlICghX2dyYXBoLmlzRW1wdHkoKSAmJiBfZ3JhcGgu\nZ2V0KGlkeCkgPT0gbnVsbAogICAgICAgICAgICAgICAgICAgICYmIGlkeCA9\nPSBfZ3JhcGguc2l6ZSgpIC0gMSkKICAgICAgICAgICAgICAgICAgICBfZ3Jh\ncGgucmVtb3ZlKGlkeC0tKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChKb2luU2V0IGpz\nKSB7CiAgICAgICAgYm9vbGVhbiByZW1kID0gZmFsc2U7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgcmVtZCA9IHJlbW92ZSgoSm9pbikgaXRyLm5leHQo\nKSkgfHwgcmVtZDsKICAgICAgICByZXR1cm4gcmVtZDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiByZXRhaW5BbGwoSm9pblNldCBqcykgewogICAgICAg\nIGJvb2xlYW4gcmVtZCA9IGZhbHNlOwogICAgICAgIEpvaW4gam9pbjsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGl0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGpvaW4gPSAoSm9pbikgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgaWYgKCFqcy5jb250YWlucyhqb2luKSkKICAgICAg\nICAgICAgICAgIHJlbWQgPSByZW1vdmUoam9pbik7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiByZW1kOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgIF9ncmFwaC5jbGVhcigpOwogICAgICAgIF9zb3J0ZWQg\nPSBudWxsOwogICAgICAgIF9zaXplID0gMDsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBjb250YWlucyhKb2luIGpvaW4pIHsKICAgICAgICByZXR1cm4g\nZ2V0UmVjb3JkZWRKb2luKGpvaW4pICE9IG51bGw7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gY29udGFpbnNBbGwoSm9pblNldCBqcykgewogICAgICAg\nIGlmIChqcy5fc2l6ZSA+IF9zaXplIHx8IGpzLl9ncmFwaC5zaXplKCkgPiBf\nZ3JhcGguc2l6ZSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBqcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgaWYgKCFjb250YWlucygoSm9pbikgaXRy\nLm5leHQoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNF\nbXB0eSgpIHsKICAgICAgICByZXR1cm4gX3NpemUgPT0gMDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgcmV0dXJuIF9zaXplOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIp\nIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBKb2lu\nU2V0KSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVy\nbiBfZ3JhcGguZXF1YWxzKCgoSm9pblNldCkgb3RoZXIpLl9ncmFwaCk7CiAg\nICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1\ncm4gX2dyYXBoLmhhc2hDb2RlKCk7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3\nIFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlsiKTsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGl0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIjwiKS5hcHBlbmQo\naXRyLm5leHQoKSkuYXBwZW5kKCI+Iik7CiAgICAgICAgICAgIGlmIChpdHIu\naGFzTmV4dCgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQoIl0iKS50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogQSBncmFwaCBub2RlLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBOb2RlCiAgICAgICAg\naW1wbGVtZW50cyBDbG9uZWFibGUgewoKICAgICAgICBwdWJsaWMgSm9pbiBq\nb2luOwogICAgICAgIHB1YmxpYyBOb2RlIG5leHQ7CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gZm9yd2FyZDsKCiAgICAgICAgcHVibGljIE5vZGUoSm9pbiBq\nb2luLCBib29sZWFuIGZvcndhcmQpIHsKICAgICAgICAgICAgdGhpcy5qb2lu\nID0gam9pbjsKICAgICAgICAgICAgdGhpcy5mb3J3YXJkID0gZm9yd2FyZDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAg\nICAgICAgICAgIGludCBycyA9IDE3OwogICAgICAgICAgICBycyA9IDM3ICog\ncnMgKyBqb2luLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIGlmIChuZXh0ICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBycyA9IDM3ICogcnMgKyBuZXh0Lmhh\nc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiByczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsK\nICAgICAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBOb2RlKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgTm9kZSBu\nb2RlID0gKE5vZGUpIG90aGVyOwogICAgICAgICAgICByZXR1cm4gT2JqZWN0\nVXRpbHMuZXF1YWxzKGpvaW4sIG5vZGUuam9pbikKICAgICAgICAgICAgICAg\nICYmIE9iamVjdFV0aWxzLmVxdWFscyhuZXh0LCBub2RlLm5leHQpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBjbG9uZSgpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIE5vZGUgbm9kZSA9IChOb2Rl\nKSBzdXBlci5jbG9uZSgpOwogICAgICAgICAgICAgICAgaWYgKG5vZGUubmV4\ndCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG5vZGUubmV4dCA9IChO\nb2RlKSBub2RlLm5leHQuY2xvbmUoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBub2RlOwogICAgICAgICAgICB9IGNhdGNoIChDbG9uZU5vdFN1cHBvcnRl\nZEV4Y2VwdGlvbiBjbnNlKSB7CiAgICAgICAgICAgICAgICAvLyBjYW4ndCBo\nYXBwZW4KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5n\nKCkgewogICAgICAgICAgICByZXR1cm4gam9pbiArICIoIiArICgoZm9yd2Fy\nZCkgPyAiZm9yd2FyZCIgOiAiYmFja3dhcmQiKSArICIpIgogICAgICAgICAg\nICAgICAgKyAiOyBuZXh0OiAiICsgbmV4dDsKICAgICAgICB9CiAgICB9Cn0J\nCg==\n","encoding":"base64"}

