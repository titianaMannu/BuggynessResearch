{"sha":"6fab6bc8811dbaa19fe95d9496290cd9e8230dd4","node_id":"MDQ6QmxvYjIwNjM2NDo2ZmFiNmJjODgxMWRiYWExOWZlOTVkOTQ5NjI5MGNkOWU4MjMwZGQ0","size":39655,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6fab6bc8811dbaa19fe95d9496290cd9e8230dd4","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbDsKCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5J\nbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGph\ndmEuc3FsLkNsb2I7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBv\ncnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3Fs\nLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0\nOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5z\ncWwuU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBv\ncnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5D\nYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuRGVsZWdhdGluZ0RhdGFiYXNlTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuRGVs\nZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlN0b3JlRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGls\nLk51bWJlcnM7CgovKioKICogRGljdGlvbmFyeSBmb3IgT3JhY2xlLgogKi8K\ncHVibGljIGNsYXNzIE9yYWNsZURpY3Rpb25hcnkKICAgIGV4dGVuZHMgREJE\naWN0aW9uYXJ5IHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBT\nRUxFQ1RfSElOVCA9ICJvcGVuanBhLmhpbnQuT3JhY2xlU2VsZWN0SGludCI7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBWRU5ET1JfT1JBQ0xF\nID0gIm9yYWNsZSI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEJF\nSEFWRV9PVEhFUiA9IDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nQkVIQVZFX09SQUNMRSA9IDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgQkVIQVZFX0RBVEFESVJFQ1QzMSA9IDI7CgogICAgcHJpdmF0ZSBzdGF0\naWMgQmxvYiBFTVBUWV9CTE9CID0gbnVsbDsKICAgIHByaXZhdGUgc3RhdGlj\nIENsb2IgRU1QVFlfQ0xPQiA9IG51bGw7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChPcmFjbGVEaWN0aW9uYXJ5LmNsYXNzKTsKCiAgICAvKioKICAg\nICAqIElmIHRydWUsIHRoZW4gc2ltdWxhdGUgYXV0by1hc3NpZ25lZCB2YWx1\nZXMgaW4gT3JhY2xlIGJ5CiAgICAgKiB1c2luZyBhIHRyaWdnZXIgdGhhdCBp\nbnNlcnRzIGEgc2VxdWVuY2UgdmFsdWUgaW50byB0aGUKICAgICAqIHByaW1h\ncnkga2V5IHZhbHVlIHdoZW4gYSByb3cgaXMgaW5zZXJ0ZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHVzZVRyaWdnZXJzRm9yQXV0b0Fzc2lnbiA9\nIGZhbHNlOwoKICAgIC8qKgogICAgICogVGhlIGdsb2JhbCBzZXF1ZW5jZSBu\nYW1lIHRvIHVzZSBmb3IgYXV0b2Fzc2lnbiBzaW11bGF0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nIGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUgPSBu\ndWxsOwoKICAgIC8qKgogICAgICogRmxhZyB0byB1c2UgT3BlbkpQQSAwLjMg\nc3R5bGUgbmFtaW5nIGZvciBhdXRvIGFzc2lnbiBzZXF1ZW5jZSBuYW1lIGFu\nZAogICAgICogdHJpZ2dlciBuYW1lIGZvciBiYWNrd2FyZHMgY29tcGF0aWJp\nbGl0eS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gb3BlbmpwYTNHZW5l\ncmF0ZWRLZXlOYW1lcyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogSWYgdHJ1\nZSwgdGhlbiBPcGVuSlBBIHdpbGwgYXR0ZW1wdCB0byB1c2UgdGhlIHNwZWNp\nYWwKICAgICAqIE9yYWNsZVByZXBhcmVkU3RhdGVtZW50LnNldEZvcm1PZlVz\nZSBtZXRob2QgdG8KICAgICAqIGNvbmZpZ3VyZSBzdGF0ZW1lbnRzIHRoYXQg\naXQgZGV0ZWN0cyBhcmUgb3BlcmF0aW5nIG9uIHVuaWNvZGUgZmllbGRzLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB1c2VTZXRGb3JtT2ZVc2VGb3JV\nbmljb2RlID0gdHJ1ZTsKCiAgICAvLyBzb21lIG9yYWNsZSBkcml2ZXJzIGhh\ndmUgcHJvYmxlbXMgd2l0aCBzZWxlY3QgZm9yIHVwZGF0ZTsgd2FybiB0aGUK\nICAgIC8vIGZpcnN0IHRpbWUgbG9ja2luZyBpcyBhdHRlbXB0ZWQKICAgIHBy\naXZhdGUgYm9vbGVhbiBfY2hlY2tlZFVwZGF0ZUJ1ZyA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF93YXJuZWRDaGFyQ29sdW1uID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX3dhcm5lZE5jaGFyQ29sdW1uID0gZmFsc2U7\nCiAgICBwcml2YXRlIGludCBfZHJpdmVyQmVoYXZpb3IgPSAtMTsKCiAgICAv\nLyBjYWNoZSBsb2IgbWV0aG9kcwogICAgcHJpdmF0ZSBNZXRob2QgX3B1dEJ5\ndGVzID0gbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9wdXRTdHJpbmcgPSBu\ndWxsOwogICAgcHJpdmF0ZSBNZXRob2QgX3B1dENoYXJzID0gbnVsbDsKCiAg\nICBwdWJsaWMgT3JhY2xlRGljdGlvbmFyeSgpIHsKICAgICAgICBwbGF0Zm9y\nbSA9ICJPcmFjbGUiOwogICAgICAgIHZhbGlkYXRpb25TUUwgPSAiU0VMRUNU\nIFNZU0RBVEUgRlJPTSBEVUFMIjsKICAgICAgICBuZXh0U2VxdWVuY2VRdWVy\neSA9ICJTRUxFQ1QgezB9Lk5FWFRWQUwgRlJPTSBEVUFMIjsKICAgICAgICBz\ndHJpbmdMZW5ndGhGdW5jdGlvbiA9ICJMRU5HVEgoezB9KSI7CiAgICAgICAg\nam9pblN5bnRheCA9IFNZTlRBWF9EQVRBQkFTRTsKICAgICAgICBtYXhUYWJs\nZU5hbWVMZW5ndGggPSAzMDsKICAgICAgICBtYXhDb2x1bW5OYW1lTGVuZ3Ro\nID0gMzA7CiAgICAgICAgbWF4SW5kZXhOYW1lTGVuZ3RoID0gMzA7CiAgICAg\nICAgbWF4Q29uc3RyYWludE5hbWVMZW5ndGggPSAzMDsKICAgICAgICBtYXhF\nbWJlZGRlZEJsb2JTaXplID0gNDAwMDsKICAgICAgICBtYXhFbWJlZGRlZENs\nb2JTaXplID0gNDAwMDsKCiAgICAgICAgc3VwcG9ydHNEZWZlcnJlZENvbnN0\ncmFpbnRzID0gdHJ1ZTsKICAgICAgICBzdXBwb3J0c0xvY2tpbmdXaXRoRGlz\ndGluY3RDbGF1c2UgPSBmYWxzZTsKICAgICAgICBzdXBwb3J0c1NlbGVjdFN0\nYXJ0SW5kZXggPSB0cnVlOwogICAgICAgIHN1cHBvcnRzU2VsZWN0RW5kSW5k\nZXggPSB0cnVlOwoKICAgICAgICBzeXN0ZW1TY2hlbWFTZXQuYWRkQWxsKEFy\ncmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAgICAiQ1RYU1lT\nIiwgIk1EU1lTIiwgIlNZUyIsICJTWVNURU0iLCAiV0tTWVMiLCAiV01TWVMi\nLCAiWERCIiwKICAgICAgICB9KSk7CgogICAgICAgIGJpZ2ludFR5cGVOYW1l\nID0gIk5VTUJFUnswfSI7CiAgICAgICAgYml0VHlwZU5hbWUgPSAiTlVNQkVS\nezB9IjsKICAgICAgICBkZWNpbWFsVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsK\nICAgICAgICBkb3VibGVUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAg\nIGludGVnZXJUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIG51bWVy\naWNUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIHNtYWxsaW50VHlw\nZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICB0aW55aW50VHlwZU5hbWUg\nPSAiTlVNQkVSezB9IjsKICAgICAgICBsb25nVmFyY2hhclR5cGVOYW1lID0g\nIkxPTkciOwogICAgICAgIGJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwogICAg\nICAgIHZhcmJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwogICAgICAgIGxvbmdW\nYXJiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICB0aW1lVHlwZU5h\nbWUgPSAiREFURSI7CiAgICAgICAgdmFyY2hhclR5cGVOYW1lID0gIlZBUkNI\nQVIyezB9IjsKICAgICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRBbGwo\nQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJMT05H\nIFJBVyIsICJSQVciLCAiTE9ORyIsICJSRUYiLAogICAgICAgIH0pKTsKICAg\nICAgICByZXNlcnZlZFdvcmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3\nIFN0cmluZ1tdewogICAgICAgICAgICAiQUNDRVNTIiwgIkFVRElUIiwgIkNM\nVVNURVIiLCAiQ09NTUVOVCIsICJDT01QUkVTUyIsICJFWENMVVNJVkUiLAog\nICAgICAgICAgICAiRklMRSIsICJJREVOVElGSUVEIiwgIklOQ1JFTUVOVCIs\nICJJTkRFWCIsICJJTklUSUFMIiwgIkxPQ0siLAogICAgICAgICAgICAiTE9O\nRyIsICJNQVhFWFRFTlRTIiwgIk1JTlVTIiwgIk1PREUiLCAiTk9BVURJVCIs\nICJOT0NPTVBSRVNTIiwKICAgICAgICAgICAgIk5PV0FJVCIsICJPRkZMSU5F\nIiwgIk9OTElORSIsICJQQ1RGUkVFIiwgIlJPVyIsCiAgICAgICAgfSkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgc3VwZXIuZW5kQ29uZmlndXJhdGlvbigpOwogICAgICAgIGlmICh1\nc2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHN1cHBvcnRz\nQXV0b0Fzc2lnbiA9IHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29u\nbmVjdGVkQ29uZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuY29ubmVjdGVk\nQ29uZmlndXJhdGlvbihjb25uKTsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9y\nID09IG51bGwpIHsKICAgICAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBTdHJpbmcgdXJs\nID0gKG1ldGEuZ2V0VVJMKCkgPT0gbnVsbCkgPyAiIiA6IG1ldGEuZ2V0VVJM\nKCk7CiAgICAgICAgICAgIFN0cmluZyBkcml2ZXJOYW1lID0gbWV0YS5nZXRE\ncml2ZXJOYW1lKCk7CiAgICAgICAgICAgIFN0cmluZyBtZXRhZGF0YUNsYXNz\nTmFtZTsKICAgICAgICAgICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBEZWxlZ2F0\naW5nRGF0YWJhc2VNZXRhRGF0YSkKICAgICAgICAgICAgICAgIG1ldGFkYXRh\nQ2xhc3NOYW1lID0gKChEZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSkgbWV0\nYSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdhdGUo\nKS5nZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbWV0YWRhdGFDbGFzc05hbWUgPSBtZXRhLmdldENsYXNz\nKCkuZ2V0TmFtZSgpOwoKICAgICAgICAgICAgLy8gY2hlY2sgYm90aCB0aGUg\nZHJpdmVyIGNsYXNzIG5hbWUgYW5kIHRoZSBVUkwgZm9yIGtub3duIHBhdHRl\ncm5zCiAgICAgICAgICAgIGlmIChtZXRhZGF0YUNsYXNzTmFtZS5zdGFydHNX\naXRoKCJvcmFjbGUuIikKICAgICAgICAgICAgICAgIHx8IHVybC5pbmRleE9m\nKCJqZGJjOm9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAgfHwgIk9y\nYWNsZSBKREJDIGRyaXZlciIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAg\nICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfT1JBQ0xFICsgbWV0\nYS5nZXREcml2ZXJNYWpvclZlcnNpb24oKQogICAgICAgICAgICAgICAgICAg\nICsgbWV0YS5nZXREcml2ZXJNaW5vclZlcnNpb24oKTsKCiAgICAgICAgICAg\nICAgICAvLyB3YXJuIHNxbDkyCiAgICAgICAgICAgICAgICBpZiAobWV0YS5n\nZXREYXRhYmFzZVByb2R1Y3RWZXJzaW9uKCkuaW5kZXhPZigiUmVsZWFzZSA4\nLiIpID4gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoam9pblN5bnRheCA9PSBTWU5UQVhfU1FMOTIgJiYgbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4o\nX2xvYy5nZXQoIm9yYWNsZS1zeW50YXgiKSk7CiAgICAgICAgICAgICAgICAg\nICAgam9pblN5bnRheCA9IFNZTlRBWF9EQVRBQkFTRTsKICAgICAgICAgICAg\nICAgICAgICBkYXRlVHlwZU5hbWUgPSAiREFURSI7IC8vIGFkZGVkIG9yYWNs\nZSA5CiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wVHlwZU5hbWUgPSAi\nREFURSI7IC8vIGFkZGVkIG9yYWNsZSA5CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3RhcnRz\nV2l0aCgiY29tLmRkdGVrLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5k\nZXhPZigiamRiYzpkYXRhZGlyZWN0Om9yYWNsZToiKSAhPSAtMQogICAgICAg\nICAgICAgICAgfHwgIk9yYWNsZSIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAg\nICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfREFUQURJUkVD\nVCArIG1ldGEuZ2V0RHJpdmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAg\nICAgICAgICArIG1ldGEuZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CiAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0g\nVkVORE9SX09USEVSOwogICAgICAgIH0KICAgICAgICBjYWNoZURyaXZlckJl\naGF2aW9yKGRyaXZlclZlbmRvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nYWNoZSBjb25zdGFudCBmb3IgZHJpdmVycyB3aXRoIGJlaGF2aW9ycyB3ZSBo\nYXZlIHRvIGRlYWwgd2l0aC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNh\nY2hlRHJpdmVyQmVoYXZpb3IoU3RyaW5nIGRyaXZlclZlbmRvcikgewogICAg\nICAgIGlmIChfZHJpdmVyQmVoYXZpb3IgIT0gLTEpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgZHJpdmVyVmVuZG9yID0gZHJpdmVyVmVuZG9yLnRv\nTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKGRyaXZlclZlbmRvci5zdGFydHNX\naXRoKFZFTkRPUl9PUkFDTEUpKQogICAgICAgICAgICBfZHJpdmVyQmVoYXZp\nb3IgPSBCRUhBVkVfT1JBQ0xFOwogICAgICAgIGVsc2UgaWYgKGRyaXZlclZl\nbmRvci5lcXVhbHMoVkVORE9SX0RBVEFESVJFQ1QgKyAiMzAiKQogICAgICAg\nICAgICB8fCBkcml2ZXJWZW5kb3IuZXF1YWxzKFZFTkRPUl9EQVRBRElSRUNU\nICsgIjMxIikpCiAgICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFW\nRV9EQVRBRElSRUNUMzE7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHJp\ndmVyQmVoYXZpb3IgPSBCRUhBVkVfT1RIRVI7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBFbnN1cmUgdGhhdCB0aGUgZHJpdmVyIHZlbmRvciBoYXMgYmVlbiBz\nZXQsIGFuZCBpZiBub3QsIHNldCBpdCBub3cuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGVuc3VyZURyaXZlclZlbmRvcigpIHsKICAgICAgICBpZiAoZHJp\ndmVyVmVuZG9yICE9IG51bGwpIHsKICAgICAgICAgICAgY2FjaGVEcml2ZXJC\nZWhhdmlvcihkcml2ZXJWZW5kb3IpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoIm9yYWNsZS1jb25uZWN0aW5n\nLWZvci1kcml2ZXIiKSk7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25uID0gY29uZi5nZXRE\nYXRhU291cmNlMihudWxsKS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAg\nIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIHRoaXMpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChjb25uICE9IG51bGwpCiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmcoU2VsZWN0IHNlbCkgewogICAgICAg\nIGlmICghc3VwZXIuc3VwcG9ydHNMb2NraW5nKHNlbCkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gIXJlcXVpcmVzU3Vic2Vs\nZWN0Rm9yUmFuZ2Uoc2VsLmdldFN0YXJ0SW5kZXgoKSwKICAgICAgICAgICAg\nc2VsLmdldEVuZEluZGV4KCksIHNlbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRP\ncmRlcmluZygpKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdl\ndFNlbGVjdHMoU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZp\nZXJzLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8g\naWYgcmFuZ2UgZG9lc24ndCByZXF1aXJlIGEgc3Vic2VsZWN0IGNhbiB1c2Ug\nc3VwZXIKICAgICAgICBpZiAoIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uo\nc2VsLmdldFN0YXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVuZElu\nZGV4KCksIHNlbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygpKSkK\nICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNlbGVjdHMoc2VsLCBkaXN0\naW5jdElkZW50aWZpZXJzLCBmb3JVcGRhdGUpOwoKICAgICAgICAvLyBpZiB0\naGVyZSBhcmUgbm8gam9pbnMgaW52b2x2ZWQgb3Igd2UncmUgdXNpbmcgYSBm\ncm9tIHNlbGVjdCBzbwogICAgICAgIC8vIHRoYXQgYWxsIGNvbHMgYWxyZWFk\neSBoYXZlIHVuaXF1ZSBhbGlhc2VzLCBjYW4gdXNlIHN1cGVyCiAgICAgICAg\naWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCB8fCBzZWwuZ2V0VGFi\nbGVBbGlhc2VzKCkuc2l6ZSgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmdldFNlbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50aWZpZXJzLCBmb3JV\ncGRhdGUpOwoKICAgICAgICAvLyBzaW5jZSBub25lIG9mIHRoZSBjb25kaXRp\nb25zIGFib3ZlIHdlcmUgbWV0LCB3ZSdyZSBkZWFsaW5nIHdpdGgKICAgICAg\nICAvLyBhIHNlbGVjdCB0aGF0IHVzZXMgam9pbnMgYW5kIHJlcXVpcmVzIHN1\nYnNlbGVjdHMgdG8gc2VsZWN0IHRoZQogICAgICAgIC8vIHByb3BlciByYW5n\nZTsgYWxpYXMgYWxsIGNvbHVtbiB2YWx1ZXMgc28gdGhhdCB0aGV5IGFyZSB1\nbmlxdWUgd2l0aGluCiAgICAgICAgLy8gdGhlIHN1YnNlbGVjdAogICAgICAg\nIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwog\nICAgICAgIExpc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVu\ndGlmaWVycykKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlm\naWVyQWxpYXNlcygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNl\ncyA9IHNlbC5nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBh\nbGlhczsKICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBhbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGkr\nKykgewogICAgICAgICAgICBhbGlhcyA9IGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGlmIChhbGlhcyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoKFNRTEJ1ZmZlcikgYWxpYXMpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBw\nZW5kKGFsaWFzLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBzZWxlY3RTUUwu\nYXBwZW5kKCIgQVMgYyIpLmFwcGVuZChTdHJpbmcudmFsdWVPZihpKSk7CiAg\nICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAg\nc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHNlbGVjdFNRTDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5P\ndXRlckpvaW4oaW50IHN5bnRheCwgRm9yZWlnbktleSBmaykgewogICAgICAg\nIGlmICghc3VwZXIuY2FuT3V0ZXJKb2luKHN5bnRheCwgZmspKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGZrICE9IG51bGwgJiYg\nc3ludGF4ID09IFNZTlRBWF9EQVRBQkFTRSkgewogICAgICAgICAgICBpZiAo\nZmsuZ2V0Q29uc3RhbnRzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGZrLmdldFByaW1hcnlL\nZXlDb25zdGFudHMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvTmF0aXZlSm9pbihKb2luIGpv\naW4pIHsKICAgICAgICBpZiAoam9pbi5nZXRUeXBlKCkgIT0gSm9pbi5UWVBF\nX09VVEVSKQogICAgICAgICAgICByZXR1cm4gdG9UcmFkaXRpb25hbEpvaW4o\nam9pbik7CgogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBqb2luLmdldEZvcmVp\nZ25LZXkoKTsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIGJvb2xlYW4gaW52ZXJzZSA9IGpvaW4u\naXNGb3JlaWduS2V5SW52ZXJzZWQoKTsKICAgICAgICBDb2x1bW5bXSBmcm9t\nID0gKGludmVyc2UpID8gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKQogICAg\nICAgICAgICA6IGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0\nbyA9IChpbnZlcnNlKSA/IGZrLmdldENvbHVtbnMoKQogICAgICAgICAgICA6\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CgogICAgICAgIC8vIGRvIGNv\nbHVtbiBqb2lucwogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVm\nZmVyKHRoaXMpOwogICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmcm9tLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7\nCiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpv\naW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLmFwcGVuZChmcm9tW2ldKTsK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoam9pbi5nZXRBbGlhczIoKSkuYXBwZW5kKCIuIikuYXBwZW5k\nKHRvW2ldKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCspIik7CiAgICAg\nICAgfQoKICAgICAgICAvLyBjaGVjayBjb25zdGFudCBqb2lucwogICAgICAg\nIGlmIChmay5nZXRDb25zdGFudENvbHVtbnMoKS5sZW5ndGggPiAwKQogICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm9y\nYWNsZS1jb25zdGFudCIsCiAgICAgICAgICAgICAgICBqb2luLmdldFRhYmxl\nMSgpLCBqb2luLmdldFRhYmxlMigpKSkuc2V0RmF0YWwodHJ1ZSk7CgogICAg\nICAgIGlmIChmay5nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJvcmFjbGUtY29uc3RhbnQiLAogICAgICAgICAgICAgICAg\nam9pbi5nZXRUYWJsZTEoKSwgam9pbi5nZXRUYWJsZTIoKSkpLnNldEZhdGFs\nKHRydWUpOwogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgcHVibGlj\nIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0LCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciB0YWJs\nZXMsIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAg\nIFNRTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBi\nb29sZWFuIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFy\ndCwgbG9uZyBlbmQpIHsKICAgICAgICBpZiAoIV9jaGVja2VkVXBkYXRlQnVn\nKSB7CiAgICAgICAgICAgIGVuc3VyZURyaXZlclZlbmRvcigpOwogICAgICAg\nICAgICBpZiAoZm9yVXBkYXRlICYmIF9kcml2ZXJCZWhhdmlvciA9PSBCRUhB\nVkVfREFUQURJUkVDVDMxKQogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xv\nYy5nZXQoImRkLWxvY2stYnVnIikpOwogICAgICAgICAgICBfY2hlY2tlZFVw\nZGF0ZUJ1ZyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBubyBy\nYW5nZSwgdXNlIHN0YW5kYXJkIHNlbGVjdAogICAgICAgIGlmIChzdGFydCA9\nPSAwICYmIGVuZCA9PSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLnRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hl\ncmUsIGdyb3VwLCBoYXZpbmcsCiAgICAgICAgICAgICAgICBvcmRlciwgZGlz\ndGluY3QsIGZvclVwZGF0ZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwoKICAgICAg\nICAvLyBpZiBubyBza2lwLCBvcmRlcmluZywgb3IgZGlzdGluY3QgY2FuIHVz\nZSByb3dudW0gZGlyZWN0bHkKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3\nIFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpZiAoIXJlcXVpcmVzU3Vic2Vs\nZWN0Rm9yUmFuZ2Uoc3RhcnQsIGVuZCwgZGlzdGluY3QsIG9yZGVyKSkgewog\nICAgICAgICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCh3aGVyZSkuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKCJST1dOVU0gPD0g\nIikuYXBwZW5kVmFsdWUoZW5kKTsKICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLnRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgYnVmLCBncm91cCwg\naGF2aW5nLAogICAgICAgICAgICAgICAgb3JkZXIsIGRpc3RpbmN0LCBmb3JV\ncGRhdGUsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGlmIHRoZXJlIGlzIG9yZGVyaW5nLCBza2lwLCBvciBkaXN0aW5jdCB3\nZSBoYXZlIHRvIHVzZSBzdWJzZWxlY3RzCiAgICAgICAgU1FMQnVmZmVyIHNl\nbCA9IHN1cGVyLnRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hl\ncmUsCiAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5j\ndCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSk7CgogICAgICAgIC8v\nIGlmIG5vIHNraXAsIGNhbiB1c2Ugc2luZ2xlIG5lc3RlZCBzdWJzZWxlY3QK\nICAgICAgICBpZiAoc3RhcnQgPT0gMCkgewogICAgICAgICAgICBidWYuYXBw\nZW5kKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCkgKyAiICogRlJPTSAoIik7\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VsKTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiKSBXSEVSRSBST1dOVU0gPD0gIikuYXBwZW5kVmFsdWUoZW5k\nKTsKICAgICAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgICB9CgogICAgICAg\nIC8vIHdpdGggYSBza2lwLCB3ZSBoYXZlIHRvIHVzZSBhIGRvdWJsZS1uZXN0\nZWQgc3Vic2VsZWN0IHRvIHB1dAogICAgICAgIC8vIHdoZXJlIGNvbmRpdGlv\nbnMgb24gdGhlIHJvd251bQogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0U2VsZWN0\nT3BlcmF0aW9uKGZldGNoKQogICAgICAgICAgICArICIgKiBGUk9NIChTRUxF\nQ1Qgci4qLCBST1dOVU0gUk5VTSBGUk9NICgiKTsKICAgICAgICBidWYuYXBw\nZW5kKHNlbCk7CiAgICAgICAgYnVmLmFwcGVuZCgiKSByIik7CiAgICAgICAg\naWYgKGVuZCAhPSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIFdIRVJFIFJPV05VTSA8PSAiKS5hcHBlbmRWYWx1ZShlbmQpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoIikgV0hFUkUgUk5VTSA+ICIpLmFwcGVuZFZh\nbHVlKHN0YXJ0KTsKICAgICAgICByZXR1cm4gYnVmOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHNlbGVjdCB3aXRoIHRoZSBn\naXZlbiBwYXJhbWV0ZXJzIG5lZWRzIGEKICAgICAqIHN1YnNlbGVjdCB0byBh\ncHBseSBhIHJhbmdlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gcmVx\ndWlyZXNTdWJzZWxlY3RGb3JSYW5nZShsb25nIHN0YXJ0LCBsb25nIGVuZCwK\nICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBTUUxCdWZmZXIgb3JkZXIpIHsK\nICAgICAgICBpZiAoc3RhcnQgPT0gMCAmJiBlbmQgPT0gTG9uZy5NQVhfVkFM\nVUUpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4g\nc3RhcnQgIT0gMCB8fCBkaXN0aW5jdCB8fCAob3JkZXIgIT0gbnVsbCAmJiAh\nb3JkZXIuaXNFbXB0eSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNr\nIHRvIHNlZSBpZiB3ZSBoYXZlIHNldCB0aGUge0BsaW5rICNTRUxFQ1RfSElO\nVH0gaW4gdGhlCiAgICAgKiBmZXRjaCBjb25maWd1cmFpdG9uLCBhbmQgaWYg\nc28sIGFwcGVuZCB0aGUgT3JhY2hlIGhpbnQgYWZ0ZXIgdGhlCiAgICAgKiAi\nU0VMRUNUIiBwYXJ0IG9mIHRoZSBxdWVyeS4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRTZWxlY3RPcGVyYXRpb24oSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCkgewogICAgICAgIE9iamVjdCBoaW50ID0gZmV0Y2ggPT0g\nbnVsbCA/IG51bGwgOiBmZXRjaC5nZXRIaW50KFNFTEVDVF9ISU5UKTsKICAg\nICAgICBTdHJpbmcgc2VsZWN0ID0gIlNFTEVDVCI7CiAgICAgICAgaWYgKGhp\nbnQgIT0gbnVsbCkKICAgICAgICAgICAgc2VsZWN0ICs9ICIgIiArIGhpbnQ7\nCiAgICAgICAgcmV0dXJuIHNlbGVjdDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdWJzdHJpbmcoU1FMQnVmZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgc3RyLCBG\naWx0ZXJWYWx1ZSBzdGFydCwKICAgICAgICBGaWx0ZXJWYWx1ZSBlbmQpIHsK\nICAgICAgICBidWYuYXBwZW5kKCJTVUJTVFIoIik7CiAgICAgICAgc3RyLmFw\ncGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiLCAoIik7CiAgICAg\nICAgc3RhcnQuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIg\nKyAxKSIpOwogICAgICAgIGlmIChlbmQgIT0gbnVsbCkgewogICAgICAgICAg\nICBidWYuYXBwZW5kKCIsICgiKTsKICAgICAgICAgICAgZW5kLmFwcGVuZFRv\nKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAtICIpOwogICAgICAg\nICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgICAgICBidWYuYXBw\nZW5kKCIpIik7CiAgICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJpbmcoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBvcmFjbGUgTkNIQVIvTlZBUkNIQVIvTkNMT0IgdW5pY29kZSBjb2x1\nbW5zIHJlcXVpcmUgc29tZQogICAgICAgIC8vIHNwZWNpYWwgaGFuZGxpbmcg\ndG8gY29uZmlndXJlIHRoZW0gY29ycmVjdGx5OyBzZWU6CiAgICAgICAgLy8g\naHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2hub2xvZ3kvc2FtcGxlX2NvZGUv\ndGVjaC9qYXZhLwogICAgICAgIC8vIHNxbGpfamRiYy9maWxlcy85aV9qZGJj\nL05DSEFSc3VwcG9ydDRVbmljb2RlU2FtcGxlL1JlYWRtZS5odG1sCiAgICAg\nICAgU3RyaW5nIHR5cGVOYW1lID0gKGNvbCA9PSBudWxsKSA/IG51bGwgOiBj\nb2wuZ2V0VHlwZU5hbWUoKTsKICAgICAgICBpZiAodXNlU2V0Rm9ybU9mVXNl\nRm9yVW5pY29kZSAmJiB0eXBlTmFtZSAhPSBudWxsICYmCiAgICAgICAgICAg\nICh0eXBlTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoIm52YXJjaGFy\nIikgfHwKICAgICAgICAgICAgICAgIHR5cGVOYW1lLnRvTG93ZXJDYXNlKCku\nc3RhcnRzV2l0aCgibmNoYXIiKSB8fAogICAgICAgICAgICAgICAgdHlwZU5h\nbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJuY2xvYiIpKSkgewogICAg\nICAgICAgICBTdGF0ZW1lbnQgaW5uZXIgPSBzdG1udDsKICAgICAgICAgICAg\naWYgKGlubmVyIGluc3RhbmNlb2YgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVt\nZW50KQogICAgICAgICAgICAgICAgaW5uZXIgPSAoKERlbGVnYXRpbmdQcmVw\nYXJlZFN0YXRlbWVudCkgaW5uZXIpLgogICAgICAgICAgICAgICAgICAgIGdl\ndElubmVybW9zdERlbGVnYXRlKCk7CiAgICAgICAgICAgIGlmIChpc09yYWNs\nZVByZXBhcmVkU3RhdGVtZW50KGlubmVyKSkgewogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBpbm5lci5nZXRDbGFzcygpLmdl\ndE1ldGhvZCgic2V0Rm9ybU9mVXNlIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IENsYXNzW117IGludC5jbGFzcywgc2hvcnQuY2xhc3MgfSkuCiAg\nICAgICAgICAgICAgICAgICAgICAgIGludm9rZShpbm5lciwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBuZXcgSW50ZWdlcihpZHgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJvcmFjbGUuamRiYy5P\ncmFjbGVQcmVwYXJlZFN0YXRlbWVudCIpLgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBnZXRGaWVsZCgiRk9STV9OQ0hBUiIpLmdldChu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2Fybihl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgh\nX3dhcm5lZE5jaGFyQ29sdW1uICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgIF93YXJuZWROY2hhckNvbHVtbiA9IHRydWU7CiAg\nICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgidW5jb25maWd1cmVk\nLW5jaGFyLWNvbHMiKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIGNhbGwgc2V0Rml4ZWRDSEFSIGZvciBmaXhlZCB3aWR0aCBjaGFy\nYWN0ZXIgY29sdW1ucyB0byBnZXQgcGFkZGluZwogICAgICAgIC8vIHNlbWFu\ndGljcwogICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlwZSgp\nID09IFR5cGVzLkNIQVIKICAgICAgICAgICAgJiYgdmFsICE9IG51bGwgJiYg\ndmFsLmxlbmd0aCgpICE9IGNvbC5nZXRTaXplKCkpIHsKICAgICAgICAgICAg\nU3RhdGVtZW50IGlubmVyID0gc3RtbnQ7CiAgICAgICAgICAgIGlmIChpbm5l\nciBpbnN0YW5jZW9mIERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCkKICAg\nICAgICAgICAgICAgIGlubmVyID0gKChEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0\nZW1lbnQpIGlubmVyKS4KICAgICAgICAgICAgICAgICAgICBnZXRJbm5lcm1v\nc3REZWxlZ2F0ZSgpOwogICAgICAgICAgICBpZiAoaXNPcmFjbGVQcmVwYXJl\nZFN0YXRlbWVudChpbm5lcikpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgaW5uZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2Qo\nInNldEZpeGVkQ0hBUiIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBD\nbGFzc1tdeyBpbnQuY2xhc3MsIFN0cmluZy5jbGFzcyB9KS4KICAgICAgICAg\nICAgICAgICAgICAgICAgaW52b2tlKGlubmVyLCBuZXcgT2JqZWN0W117IG5l\ndyBJbnRlZ2VyKGlkeCksIHZhbCB9KTsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKGUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIV93YXJu\nZWRDaGFyQ29sdW1uICYmIGxvZy5pc1dhcm5FbmFibGVkKCkpIHsKICAgICAg\nICAgICAgICAgIF93YXJuZWRDaGFyQ29sdW1uID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJ1bnBhZGRlZC1jaGFyLWNvbHMi\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3VwZXIuc2V0\nU3RyaW5nKHN0bW50LCBpZHgsIHZhbCwgY29sKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXROdWxsKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBpbnQgY29sVHlwZSwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjb2xUeXBlID09\nIFR5cGVzLkJMT0IgJiYgX2RyaXZlckJlaGF2aW9yID09IEJFSEFWRV9PUkFD\nTEUpCiAgICAgICAgICAgIHN0bW50LnNldEJsb2IoaWR4LCBnZXRFbXB0eUJs\nb2IoKSk7CiAgICAgICAgZWxzZSBpZiAoY29sVHlwZSA9PSBUeXBlcy5DTE9C\nICYmIF9kcml2ZXJCZWhhdmlvciA9PSBCRUhBVkVfT1JBQ0xFKQogICAgICAg\nICAgICBzdG1udC5zZXRDbG9iKGlkeCwgZ2V0RW1wdHlDbG9iKCkpOwogICAg\nICAgIGVsc2UgaWYgKChjb2xUeXBlID09IFR5cGVzLlNUUlVDVCB8fCBjb2xU\neXBlID09IFR5cGVzLk9USEVSKQogICAgICAgICAgICAmJiBjb2wgIT0gbnVs\nbCAmJiBjb2wuZ2V0VHlwZU5hbWUoKSAhPSBudWxsKQogICAgICAgICAgICBz\ndG1udC5zZXROdWxsKGlkeCwgVHlwZXMuU1RSVUNULCBjb2wuZ2V0VHlwZU5h\nbWUoKSk7CiAgICAgICAgICAgIC8vIHNvbWUgdmVyc2lvbnMgb2YgdGhlIE9y\nYWNsZSBKREJDIGRyaXZlciB3aWxsIGZhaWwgaWYgY2FsbGluZwogICAgICAg\nICAgICAvLyBzZXROdWxsIHdpdGggREFURTsgc2VlIGJ1ZyAjMTE3MQogICAg\nICAgIGVsc2UgaWYgKGNvbFR5cGUgPT0gVHlwZXMuREFURSkKICAgICAgICAg\nICAgc3VwZXIuc2V0TnVsbChzdG1udCwgaWR4LCBUeXBlcy5USU1FU1RBTVAs\nIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdXBlci5zZXROdWxs\nKHN0bW50LCBpZHgsIGNvbFR5cGUsIGNvbCk7CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZyBnZXRDbG9iU3RyaW5nKFJlc3VsdFNldCBycywgaW50IGNvbHVt\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nX2RyaXZlckJlaGF2aW9yICE9IEJFSEFWRV9PUkFDTEUpCiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5nZXRDbG9iU3RyaW5nKHJzLCBjb2x1bW4pOwoKICAg\nICAgICBDbG9iIGNsb2IgPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAg\nIGlmIChjbG9iID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIGlmIChjbG9iLmdldENsYXNzKCkuZ2V0TmFtZSgpLmVxdWFscygi\nb3JhY2xlLnNxbC5DTE9CIikpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGlmICgoKEJvb2xlYW4pIENsYXNzLmZvck5hbWUoIm9yYWNs\nZS5zcWwuQ0xPQiIpLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGhvZCgi\naXNFbXB0eUxvYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICAg\nICAgaW52b2tlKGNsb2IsIG5ldyBPYmplY3RbMF0pKS4KICAgICAgICAgICAg\nICAgICAgICBib29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIC8vIHBvc3NpYmx5IGRpZmZlcmVudCB2ZXJz\naW9uIG9mIHRoZSBkcml2ZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoY2xvYi5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZl\nIHN0cmluZ3Mgb3ZlciA0IGJpbGxpb24gY2hhcnMKICAgICAgICByZXR1cm4g\nY2xvYi5nZXRTdWJTdHJpbmcoMSwgKGludCkgY2xvYi5sZW5ndGgoKSk7CiAg\nICB9CgogICAgcHVibGljIFRpbWVzdGFtcCBnZXRUaW1lc3RhbXAoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuZ2V0VGltZXN0YW1wKHJzLCBjb2x1bW4sIGNhbCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBhZSkg\newogICAgICAgICAgICAgICAgLy8gQ1IyOTU2MDQ6IGlzc3VlIGEgd2Fybmlu\nZyB0aGlzIHRoaXMgYnVnIGNhbiBiZSBnb3R0ZW4KICAgICAgICAgICAgICAg\nIC8vIGFyb3VuZCB3aXRoIFN1cHBvcnRzVGltZXN0YW1wTmFub3M9ZmFsc2UK\nICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJvcmFjbGUtdGlt\nZXN0YW1wLWJ1ZyIpLCBhZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBhZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIE9y\nYWNsZSBidWcgd2hlcmUgbmFub3Mgbm90IHJldHVybmVkIGZyb20gY2FsbCB3\naXRoIENhbGVuZGFyCiAgICAgICAgLy8gcGFyYW1ldGVyCiAgICAgICAgVGlt\nZXN0YW1wIHRzID0gcnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAg\nICAgICBpZiAodHMgIT0gbnVsbCAmJiB0cy5nZXROYW5vcygpID09IDApCiAg\nICAgICAgICAgIHRzLnNldE5hbm9zKHJzLmdldFRpbWVzdGFtcChjb2x1bW4p\nLmdldE5hbm9zKCkpOwogICAgICAgIHJldHVybiB0czsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldE9iamVjdChSZXN1bHRTZXQgcnMsIGludCBjb2x1\nbW4sIE1hcCBtYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gcmVjZW50IG9yYWNsZSBkaXJ2ZXJzIHJldHVybiBvcmFjbGUt\nc3BlY2lmaWMgdHlwZXMgZm9yIHRpbWVzdGFtcHMKICAgICAgICAvLyBhbmQg\nZGF0ZXMKICAgICAgICBPYmplY3Qgb2JqID0gc3VwZXIuZ2V0T2JqZWN0KHJz\nLCBjb2x1bW4sIG1hcCk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoIm9yYWNsZS5zcWwu\nREFURSIuZXF1YWxzKG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAg\nICAgICAgIG9iaiA9IGNvbnZlcnRGcm9tT3JhY2xlVHlwZShvYmosICJkYXRl\nVmFsdWUiKTsKICAgICAgICBlbHNlIGlmICgib3JhY2xlLnNxbC5USU1FU1RB\nTVAiLmVxdWFscyhvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAg\nICAgICBvYmogPSBjb252ZXJ0RnJvbU9yYWNsZVR5cGUob2JqLCAidGltZXN0\nYW1wVmFsdWUiKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCBhbiBvYmplY3QgZnJvbSBpdHMgcHJvcHJpZXRh\ncnkgT3JhY2xlIHR5cGUgdG8gdGhlIHN0YW5kYXJkCiAgICAgKiBKYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb252ZXJ0\nRnJvbU9yYWNsZVR5cGUoT2JqZWN0IG9iaiwKICAgICAgICBTdHJpbmcgY29u\ndmVydE1ldGhvZCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBNZXRob2QgbSA9IG9iai5nZXRDbGFz\ncygpLmdldE1ldGhvZChjb252ZXJ0TWV0aG9kLCAoQ2xhc3NbXSkgbnVsbCk7\nCiAgICAgICAgICAgIHJldHVybiBtLmludm9rZShvYmosIChPYmplY3RbXSkg\nbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAg\nICAgICAgaWYgKHQgaW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0\naW9uKQogICAgICAgICAgICAgICAgdCA9ICgoSW52b2NhdGlvblRhcmdldEV4\nY2VwdGlvbikgdCkuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAg\nIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAg\nICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBu\nZXcgU1FMRXhjZXB0aW9uKHQuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VN\nZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcg\nc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5h\nbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gc3VwZXIuZ2V0Q29sdW1u\ncyhtZXRhLCBjYXRhbG9nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsCiAgICAg\nICAgICAgIGNvbHVtbk5hbWUsIGNvbm4pOwoKICAgICAgICBmb3IgKGludCBp\nID0gMDsgY29scyAhPSBudWxsICYmIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGlmIChjb2xzW2ldLmdldFR5cGVOYW1lKCkgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAo\nY29sc1tpXS5nZXRUeXBlTmFtZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0\naCgiVElNRVNUQU1QIikpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5\ncGUoVHlwZXMuVElNRVNUQU1QKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkJM\nT0IiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgpKSkK\nICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5CTE9CKTsK\nICAgICAgICAgICAgZWxzZSBpZiAoIkNMT0IiLmVxdWFsc0lnbm9yZUNhc2Uo\nY29sc1tpXS5nZXRUeXBlTmFtZSgpKQogICAgICAgICAgICAgICAgfHwgIk5D\nTE9CIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkp\nCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQ0xPQik7\nCiAgICAgICAgICAgIGVsc2UgaWYgKCJGTE9BVCIuZXF1YWxzSWdub3JlQ2Fz\nZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29s\nc1tpXS5zZXRUeXBlKFR5cGVzLkZMT0FUKTsKICAgICAgICAgICAgZWxzZSBp\nZiAoIk5WQVJDSEFSIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlw\nZU5hbWUoKSkpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlw\nZXMuVkFSQ0hBUik7CiAgICAgICAgICAgIGVsc2UgaWYgKCJOQ0hBUiIuZXF1\nYWxzSWdub3JlQ2FzZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAg\nICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLkNIQVIpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gY29sczsKICAgIH0KCiAgICBwdWJsaWMgUHJp\nbWFyeUtleVtdIGdldFByaW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0\nYSwKICAgICAgICBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVm\nID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNF\nTEVDVCB0MC5PV05FUiBBUyBUQUJMRV9TQ0hFTSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgidDAuVEFCTEVfTkFNRSBBUyBUQUJMRV9OQU1FLCAiKS4KICAg\nICAgICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFN\nRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1F\nIEFTIFBLX05BTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExf\nQ09OU19DT0xVTU5TIHQwLCBBTExfQ09OU1RSQUlOVFMgdDEgIikuCiAgICAg\nICAgICAgIGFwcGVuZCgiV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0g\ndDEuQ09OU1RSQUlOVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFO\nRCB0MS5DT05TVFJBSU5UX1RZUEUgPSAnUCciKTsKICAgICAgICBpZiAoc2No\nZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5E\nIHQwLk9XTkVSID0gPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVs\nbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1F\nID0gPyIpOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNv\nbm4ucHJlcGFyZVN0YXRlbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAg\nUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4Kyss\nIHNjaGVtYU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAg\nIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0\ncmluZyhzdG1udCwgaWR4KyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBu\ndWxsKTsKCiAgICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7\nCiAgICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwog\nICAgICAgICAgICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpCiAg\nICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocnMpKTsK\nICAgICAgICAgICAgcmV0dXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0Fy\ncmF5CiAgICAgICAgICAgICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNp\nemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChy\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBycy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIEluZGV4W10gZ2V0SW5kZXhJbmZv\nKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAg\nICAgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xl\nYW4gdW5pcXVlLCBib29sZWFuIGFwcHJveCwKICAgICAgICBDb25uZWN0aW9u\nIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAg\nICBidWYuYXBwZW5kKCJTRUxFQ1QgdDAuSU5ERVhfT1dORVIgQVMgVEFCTEVf\nU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUg\nQVMgVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RF\nKHQxLlVOSVFVRU5FU1MsICdVTklRVUUnLCAwLCAnTk9OVU5JUVVFJywgMSkg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgiQVMgTk9OX1VOSVFVRSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgidDAuSU5ERVhfTkFNRSBBUyBJTkRFWF9OQU1F\nLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBD\nT0xVTU5fTkFNRSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJGUk9NIEFMTF9J\nTkRfQ09MVU1OUyB0MCwgQUxMX0lOREVYRVMgdDEgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgiV0hFUkUgdDAuSU5ERVhfT1dORVIgPSB0MS5PV05FUiAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDAuSU5ERVhfTkFNRSA9IHQxLklO\nREVYX05BTUUiKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxFX09XTkVSID0g\nPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwoKICAg\nICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0\nYXRlbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVzdWx0U2V0IHJz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4ID0g\nMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNjaGVtYU5hbWUu\ndG9VcHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICh0YWJsZU5h\nbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwg\naWR4KyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKCiAgICAg\nICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAg\nIExpc3QgaWR4TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICAg\nICAgaWR4TGlzdC5hZGQobmV3SW5kZXgocnMpKTsKICAgICAgICAgICAgcmV0\ndXJuIChJbmRleFtdKSBpZHhMaXN0LnRvQXJyYXkobmV3IEluZGV4W2lkeExp\nc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdl\ndEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBj\nYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFi\nbGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGRlbEFjdGlvbiA9IG5l\ndyBTdHJpbmdCdWZmZXIoIkRFQ09ERSh0MS5ERUxFVEVfUlVMRSIpLgogICAg\nICAgICAgICBhcHBlbmQoIiwgJ05PIEFDVElPTicsICIpLmFwcGVuZChtZXRh\nLmltcG9ydGVkS2V5Tm9BY3Rpb24pLgogICAgICAgICAgICBhcHBlbmQoIiwg\nJ1JFU1RSSUNUJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlSZXN0cmlj\ndCkuCiAgICAgICAgICAgIGFwcGVuZCgiLCAnQ0FTQ0FERScsICIpLmFwcGVu\nZChtZXRhLmltcG9ydGVkS2V5Q2FzY2FkZSkuCiAgICAgICAgICAgIGFwcGVu\nZCgiLCAnU0VUIE5VTEwnLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtleVNl\ndE51bGwpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1NFVCBERUZBVUxUJywg\nIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0KS4KICAgICAg\nICAgICAgYXBwZW5kKCIpIik7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYg\nPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VM\nRUNUIHQyLk9XTkVSIEFTIFBLVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAg\nICBhcHBlbmQoInQyLlRBQkxFX05BTUUgQVMgUEtUQUJMRV9OQU1FLCAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJ0Mi5DT0xVTU5fTkFNRSBBUyBQS0NPTFVN\nTl9OQU1FLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5PV05FUiBBUyBG\nS1RBQkxFX1NDSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJM\nRV9OQU1FIEFTIEZLVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVu\nZCgidDAuQ09MVU1OX05BTUUgQVMgRktDT0xVTU5fTkFNRSwgIikuCiAgICAg\nICAgICAgIGFwcGVuZCgidDAuUE9TSVRJT04gQVMgS0VZX1NFUSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZChkZWxBY3Rpb24pLmFwcGVuZCgiIEFTIERFTEVU\nRV9SVUxFLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT05TVFJBSU5U\nX05BTUUgQVMgRktfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVD\nT0RFKHQxLkRFRkVSUkVELCAnREVGRVJSRUQnLCAiKS4KICAgICAgICAgICAg\nYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCkuCiAg\nICAgICAgICAgIGFwcGVuZCgiLCAnSU1NRURJQVRFJywgIikuCiAgICAgICAg\nICAgIGFwcGVuZChtZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5SW1tZWRpYXRl\nKS4KICAgICAgICAgICAgYXBwZW5kKCIpIEFTIERFRkVSUkFCSUxJVFkgIiku\nCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xVTU5TIHQw\nLCBBTExfQ09OU1RSQUlOVFMgdDEsICIpLgogICAgICAgICAgICBhcHBlbmQo\nIkFMTF9DT05TX0NPTFVNTlMgdDIgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\nV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAgYXBw\nZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RSQUlOVF9O\nQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05TVFJBSU5U\nX1RZUEUgPSAnUicgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJf\nT1dORVIgPSB0Mi5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQg\ndDEuUl9DT05TVFJBSU5UX05BTUUgPSB0Mi5DT05TVFJBSU5UX05BTUUgIiku\nCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQwLlBPU0lUSU9OID0gdDIuUE9T\nSVRJT04iKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0gPyIpOwogICAg\nICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIiBPUkRFUiBCWSB0Mi5PV05FUiwgdDIuVEFCTEVfTkFNRSwgdDAu\nUE9TSVRJT04iKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQg\nPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAg\nICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaW50IGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hlbWFOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlk\neCsrLCBzY2hlbWFOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwogICAgICAg\nICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBlckNhc2Uo\nKSwgbnVsbCk7CgogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVy\neSgpOwogICAgICAgICAgICBMaXN0IGZrTGlzdCA9IG5ldyBBcnJheUxpc3Qo\nKTsKICAgICAgICAgICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgp\nKQogICAgICAgICAgICAgICAgZmtMaXN0LmFkZChuZXdGb3JlaWduS2V5KHJz\nKSk7CiAgICAgICAgICAgIHJldHVybiAoRm9yZWlnbktleVtdKSBma0xpc3Qu\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ZrTGlz\ndC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAocnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgcnMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVh\ndGVUYWJsZVNRTChUYWJsZSB0YWJsZSkgewogICAgICAgIC8vIG9ubHkgb3Zl\ncnJpZGUgaWYgd2UgYXJlIHNpbXVsYXRpbmcgYXV0by1pbmNyZW1lbmV0IHdp\ndGggdHJpZ2dlcnMKICAgICAgICBTdHJpbmdbXSBjcmVhdGUgPSBzdXBlci5n\nZXRDcmVhdGVUYWJsZVNRTCh0YWJsZSk7CiAgICAgICAgaWYgKCF1c2VUcmln\nZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBjcmVhdGU7\nCgogICAgICAgIENvbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRDb2x1bW5zKCk7\nCiAgICAgICAgTGlzdCBzZXFzID0gbnVsbDsKICAgICAgICBTdHJpbmcgc2Vx\nLCB0cmlnOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBjb2xzICE9IG51bGwg\nJiYgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFj\nb2xzW2ldLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHNlcXMgPSBuZXcgQXJyYXlMaXN0KDQpOwoKICAgICAgICAgICAg\nc2VxID0gYXV0b0Fzc2lnblNlcXVlbmNlTmFtZTsKICAgICAgICAgICAgaWYg\nKHNlcSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAob3BlbmpwYTNH\nZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgICAgICAgICBzZXEgPSBn\nZXRPcGVuSlBBM0dlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2xzW2ldKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXEg\nPSBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAg\nICAgICAgICAgICBzZXFzLmFkZCgiQ1JFQVRFIFNFUVVFTkNFICIgKyBzZXEg\nKyAiIFNUQVJUIFdJVEggMSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChvcGVuanBhM0dlbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICAg\nICAgdHJpZyA9IGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUo\nY29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRy\naWcgPSBnZXRHZW5lcmF0ZWRLZXlUcmlnZ2VyTmFtZShjb2xzW2ldKTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgdHJpZ2dlciB0aGF0IHdpbGwgaW5z\nZXJ0IG5ldyB2YWx1ZXMgaW50bwogICAgICAgICAgICAvLyB0aGUgdGFibGUg\nd2hlbmV2ZXIgYSByb3cgaXMgY3JlYXRlZAogICAgICAgICAgICBzZXFzLmFk\nZCgiQ1JFQVRFIE9SIFJFUExBQ0UgVFJJR0dFUiAiICsgdHJpZwogICAgICAg\nICAgICAgICAgKyAiIEJFRk9SRSBJTlNFUlQgT04gIiArIHRhYmxlLmdldE5h\nbWUoKQogICAgICAgICAgICAgICAgKyAiIEZPUiBFQUNIIFJPVyBCRUdJTiBT\nRUxFQ1QgIiArIHNlcSArICIubmV4dHZhbCBJTlRPICIKICAgICAgICAgICAg\nICAgICsgIjpuZXcuIiArIGNvbHNbaV0uZ2V0TmFtZSgpICsgIiBGUk9NIERV\nQUw7ICIKICAgICAgICAgICAgICAgICsgIkVORCAiICsgdHJpZyArICI7Iik7\nCiAgICAgICAgfQogICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBjcmVhdGU7CgogICAgICAgIC8vIGNvbWJpbmUgY3JlYXRl\nIHRhYmxlIHNxbCBhbmQgY3JlYXRlIHNlcWVuY2VzIHNxbAogICAgICAgIFN0\ncmluZ1tdIHNxbCA9IG5ldyBTdHJpbmdbY3JlYXRlLmxlbmd0aCArIHNlcXMu\nc2l6ZSgpXTsKICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNyZWF0ZSwgMCwg\nc3FsLCAwLCBjcmVhdGUubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNlcXMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIHNxbFtjcmVh\ndGUubGVuZ3RoICsgaV0gPSAoU3RyaW5nKSBzZXFzLmdldChpKTsKICAgICAg\nICByZXR1cm4gc3FsOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRD\ncmVhdGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBTdHJp\nbmdbXSBzcWwgPSBzdXBlci5nZXRDcmVhdGVTZXF1ZW5jZVNRTChzZXEpOwog\nICAgICAgIGlmIChzZXEuZ2V0QWxsb2NhdGUoKSA+IDEpCiAgICAgICAgICAg\nIHNxbFswXSArPSAiIENBQ0hFICIgKyBzZXEuZ2V0QWxsb2NhdGUoKTsKICAg\nICAgICByZXR1cm4gc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcg\nZ2V0U2VxdWVuY2VzU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2Vx\ndWVuY2VOYW1lKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgU0VR\nVUVOQ0VfT1dORVIgQVMgU0VRVUVOQ0VfU0NIRU1BLCAiKS4KICAgICAgICAg\nICAgYXBwZW5kKCJTRVFVRU5DRV9OQU1FIEZST00gQUxMX1NFUVVFTkNFUyIp\nOwogICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwgfHwgc2VxdWVuY2VO\nYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAi\nKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX09XTkVSID0gPyIpOwogICAgICAg\nICAgICBpZiAoc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAo\nc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIlNFUVVFTkNFX05BTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0\ncmluZygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2Vx\ndWVuY2UoU3RyaW5nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9v\nbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAgICAgICBpZiAoc3VwZXIuaXNTeXN0\nZW1TZXF1ZW5jZShuYW1lLCBzY2hlbWEsIHRhcmdldFNjaGVtYSkpCiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBmaWx0ZXIgb3V0IGdl\nbmVyYXRlZCBzZXF1ZW5jZXMgdXNlZCBmb3IgYXV0by1hc3NpZ24KICAgICAg\nICByZXR1cm4gKGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUgIT0gbnVsbAogICAg\nICAgICAgICAmJiBuYW1lLmVxdWFsc0lnbm9yZUNhc2UoYXV0b0Fzc2lnblNl\ncXVlbmNlTmFtZSkpCiAgICAgICAgICAgIHx8IChhdXRvQXNzaWduU2VxdWVu\nY2VOYW1lID09IG51bGwKICAgICAgICAgICAgJiYgbmFtZS50b1VwcGVyQ2Fz\nZSgpLnN0YXJ0c1dpdGgoIlNUXyIpKTsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKCF1c2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVy\nbiBOdW1iZXJzLnZhbHVlT2YoMEwpOwoKICAgICAgICAvLyBpZiB3ZSBzaW11\nbGF0ZSBhdXRvLWFzc2lnbmVkIGNvbHVtbnMgdXNpbmcgdHJpZ2dlcnMgYW5k\nCiAgICAgICAgLy8gc2VxdWVuY2VzLCB0aGVuIHJldHVybiB0aGUgY3VycmVu\ndCB2YWx1ZSBvZiB0aGUgc2VxdWVuY2UKICAgICAgICAvLyBmcm9tIGF1dG9B\nc3NpZ25TZXF1ZW5jZU5hbWUKICAgICAgICBTdHJpbmcgc2VxID0gYXV0b0Fz\nc2lnblNlcXVlbmNlTmFtZTsKICAgICAgICBpZiAoc2VxID09IG51bGwgJiYg\nb3BlbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgc2VxID0g\nZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAg\nICAgICBlbHNlIGlmIChzZXEgPT0gbnVsbCkKICAgICAgICAgICAgc2VxID0g\nZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQo\nIlNFTEVDVCAiICsgc2VxCiAgICAgICAgICAgICsgIi5jdXJydmFsIEZST00g\nRFVBTCIpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsK\nICAgICAgICAgICAgcnMubmV4dCgpOwogICAgICAgICAgICByZXR1cm4gTnVt\nYmVycy52YWx1ZU9mKHJzLmdldExvbmcoMSkpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7fQogICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVHJpZ2dlciBuYW1lIGZvciBzaW11bGF0aW5nIGF1dG8tYXNz\naWduIHZhbHVlcyBvbiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nIGdldEdlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENv\nbHVtbiBjb2wpIHsKICAgICAgICAvLyByZXBsYWNlIHRyYWlsaW5nIF9TRVEg\nd2l0aCBfVFJHCiAgICAgICAgU3RyaW5nIHNlcU5hbWUgPSBnZXRHZW5lcmF0\nZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAgICByZXR1cm4gc2VxTmFt\nZS5zdWJzdHJpbmcoMCwgc2VxTmFtZS5sZW5ndGgoKSAtIDMpICsgIlRSRyI7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgT3BlbkpQQSAzLWNv\nbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0by1hc3NpZ24gc2VxdWVuY2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldE9wZW5KUEEzR2VuZXJhdGVk\nS2V5U2VxdWVuY2VOYW1lKENvbHVtbiBjb2wpIHsKICAgICAgICBUYWJsZSB0\nYWJsZSA9IGNvbC5nZXRUYWJsZSgpOwogICAgICAgIHJldHVybiBtYWtlTmFt\nZVZhbGlkKCJTRVFfIiArIHRhYmxlLmdldE5hbWUoKSwgdGFibGUuZ2V0U2No\nZW1hKCkuCiAgICAgICAgICAgIGdldFNjaGVtYUdyb3VwKCksIG1heFRhYmxl\nTmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyBhIE9wZW5KUEEgMy1jb21wYXRpYmxlIG5hbWUgZm9yIGFuIGF1\ndG8tYXNzaWduIHRyaWdnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5n\nIGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUoQ29sdW1uIGNv\nbCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gY29sLmdldFRhYmxlKCk7CiAg\nICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlRSSUdfIiArIHRhYmxlLmdl\ndE5hbWUoKSwgdGFibGUuZ2V0U2NoZW1hKCkuCiAgICAgICAgICAgIGdldFNj\naGVtYUdyb3VwKCksIG1heFRhYmxlTmFtZUxlbmd0aCwgTkFNRV9BTlkpOwog\nICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1\ndEJ5dGVzPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIEJMT0Igb2JqZWN0\nLgogICAgICogVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGJsb2IgaXMg\nd3JhcHBlZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lmaWMgY2xh\nc3M7IGZvciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0aGluIGRy\naXZlcgogICAgICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMgd2l0aCB0\naGUgc2FtZSBtZXRob2RzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRC\neXRlcyhPYmplY3QgYmxvYiwgYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGJsb2IgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChfcHV0Qnl0ZXMgPT0gbnVs\nbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3B1dEJ5\ndGVzID0gYmxvYi5nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0Qnl0ZXMiLAog\nICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBi\neXRlW10uY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRp\nb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tl\nUHV0TG9iTWV0aG9kKF9wdXRCeXRlcywgYmxvYiwgZGF0YSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbnZva2UgT3JhY2xlJ3MgPGNvZGU+cHV0U3RyaW5n\nPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIENMT0Igb2JqZWN0LgogICAg\nICogVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGNsb2IgaXMgd3JhcHBl\nZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lmaWMgY2xhc3M7IGZv\nciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0aGluIGRyaXZlcgog\nICAgICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMgd2l0aCB0aGUgc2Ft\nZSBtZXRob2RzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRTdHJpbmco\nT2JqZWN0IGNsb2IsIFN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChfcHV0U3RyaW5nID09IG51bGwpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9wdXRTdHJpbmcg\nPSBjbG9iLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJwdXRTdHJpbmciLAogICAg\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBTdHJp\nbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0\nTG9iTWV0aG9kKF9wdXRTdHJpbmcsIGNsb2IsIGRhdGEpOwogICAgfQoKICAg\nIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1dENoYXJzPC9j\nb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIENMT0IKICAgICAqIG9iamVjdC4g\nVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGNsb2IgaXMgd3JhcHBlZCBp\nbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lmaWMgY2xhc3M7IGZvciBl\neGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0aGluIGRyaXZlcgogICAg\nICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMgd2l0aCB0aGUgc2FtZSBt\nZXRob2RzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRDaGFycyhPYmpl\nY3QgY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKF9wdXRDaGFycyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0Q2hhcnMgPSBjbG9i\nLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJwdXRDaGFycyIsCiAgICAgICAgICAg\nICAgICAgICAgbmV3IENsYXNzW117IGxvbmcuY2xhc3MsIGNoYXJbXS5jbGFz\ncyB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpbnZva2VQdXRMb2JNZXRo\nb2QoX3B1dENoYXJzLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZSB0aGUgZ2l2ZW4gTE9CIG1ldGhvZCBvbiB0aGUgZ2l2ZW4g\ndGFyZ2V0IHdpdGggdGhlIGdpdmVuIGRhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIHZvaWQgaW52b2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRo\nb2QsIE9iamVjdCB0YXJnZXQsCiAgICAgICAgT2JqZWN0IGRhdGEpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgbWV0aG9kLmludm9rZSh0YXJnZXQsIG5ldyBPYmplY3RbXXsgTnVt\nYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgICAgICB9IGNhdGNoIChJ\nbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uIGl0ZSkgewogICAgICAgICAgICBU\naHJvd2FibGUgdCA9IGl0ZS5nZXRUYXJnZXRFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgaWYgKHQgaW5zdGFuY2VvZiBTUUxFeGNlcHRpb24pCiAgICAgICAg\nICAgICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIHQ7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbih0KTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIENsb2IgZ2V0RW1wdHlDbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoRU1QVFlfQ0xPQiAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gRU1QVFlfQ0xPQjsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXR1cm4gRU1QVFlfQ0xPQiA9IChDbG9iKSBDbGFzcy5mb3JOYW1l\nKCJvcmFjbGUuc3FsLkNMT0IiKS4KICAgICAgICAgICAgICAgIGdldE1ldGhv\nZCgiZW1wdHlfbG9iIiwgbmV3IENsYXNzWzBdKS4KICAgICAgICAgICAgICAg\nIGludm9rZShudWxsLCBuZXcgT2JqZWN0WzBdKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhj\nZXB0aW9uKGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgQmxvYiBnZXRFbXB0eUJsb2IoKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChFTVBUWV9CTE9CICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CTE9COwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBFTVBUWV9CTE9CID0gKEJsb2Ip\nIENsYXNzLmZvck5hbWUoIm9yYWNsZS5zcWwuQkxPQiIpLgogICAgICAgICAg\nICAgICAgZ2V0TWV0aG9kKCJlbXB0eV9sb2IiLCBuZXcgQ2xhc3NbMF0pLgog\nICAgICAgICAgICAgICAgaW52b2tlKG51bGwsIG5ldyBPYmplY3RbMF0pOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTUUxFeGNlcHRpb24oZS5nZXRNZXNzYWdlKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzT3JhY2xl\nUHJlcGFyZWRTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5hbWUoIm9yYWNs\nZS5qZGJjLk9yYWNsZVByZXBhcmVkU3RhdGVtZW50IikuCiAgICAgICAgICAg\nICAgICBpc0luc3RhbmNlKHN0bW50KTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQogICAgfQp9Cg==\n","encoding":"base64"}

