{"sha":"dda80366968afa3a22be4bd0d5f86bfdb56a6e48","node_id":"MDQ6QmxvYjIwNjM2NDpkZGE4MDM2Njk2OGFmYTNhMjJiZTRiZDBkNWY4NmJmZGI1NmE2ZTQ4","size":14135,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/dda80366968afa3a22be4bd0d5f86bfdb56a6e48","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbDsKCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRp\nb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuT2JqZWN0VXRp\nbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNz\nTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nUmVsYXRpb25JZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioK\nICogUHJpbWFyeSB0YWJsZSByb3cgdGhhdCB0cmFja3MgZm9yZWlnbiBrZXlz\nIGFuZCBhdXRvLWluYyBjb2x1bW5zLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgUHJpbWFyeVJvdwog\nICAgZXh0ZW5kcyBSb3dJbXBsIHsKCiAgICAvLyBWQUxJRCBmbGFnIGluIHN1\ncGVyY2xhc3MgdXNlcyAyIDw8IDAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGJ5dGUgUEtfU0VUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgYnl0ZSBQS19XSEVSRSA9IDIgPDwgMjsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGJ5dGUgREVQRU5ERU5UID0gMiA8PCA0OwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoUHJpbWFyeVJvdy5jbGFzcyk7CgogICAgcHJpdmF0\nZSBPcGVuSlBBU3RhdGVNYW5hZ2VyIF9wayA9IG51bGw7CiAgICBwcml2YXRl\nIENvbHVtbklPIF9wa0lPID0gbnVsbDsKICAgIHByaXZhdGUgT3BlbkpQQVN0\nYXRlTWFuYWdlcltdIF9ma1NldCA9IG51bGw7CiAgICBwcml2YXRlIENvbHVt\nbklPW10gX2ZrSU8gPSBudWxsOwogICAgcHJpdmF0ZSBPcGVuSlBBU3RhdGVN\nYW5hZ2VyW10gX2ZrV2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBPcGVuSlBB\nU3RhdGVNYW5hZ2VyW10gX3JlbFNldCA9IG51bGw7CiAgICBwcml2YXRlIFJl\nbGF0aW9uSWRbXSBfY2FsbGJhY2tzID0gbnVsbDsKICAgIHByaXZhdGUgT2Jq\nZWN0IF9mYWlsZWQgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX2lkeCA9IC0x\nOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSB0YWJsZSBh\nbmQgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgUHJpbWFyeVJvdyhUYWJs\nZSB0YWJsZSwgaW50IGFjdGlvbiwgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25l\ncikgewogICAgICAgIHN1cGVyKHRhYmxlLCBhY3Rpb24pOwogICAgICAgIF9w\nayA9IG93bmVyOwogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGlzIHJv\ndyBhcyBkZXBlbmRlbnQgb24gc29tZSBvdGhlciByb3cuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzRGVwZW5kZW50KCkgewogICAgICAgIHJldHVy\nbiAoZmxhZ3MgJiBERVBFTkRFTlQpID4gMDsKICAgIH0KCiAgICAvKioKICAg\nICAqIE1hcmsgdGhpcyByb3cgYXMgZGVwZW5kZW50IG9uIHNvbWUgb3RoZXIg\ncm93LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXBlbmRlbnQoYm9v\nbGVhbiBkZXBlbmRlbnQpIHsKICAgICAgICBpZiAoZGVwZW5kZW50KQogICAg\nICAgICAgICBmbGFncyB8PSBERVBFTkRFTlQ7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBmbGFncyAmPSB+REVQRU5ERU5UOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIGluZGV4IG9mIHRoaXMgcm93IGluIG9yZGVyZWQgcm93IGxp\nc3QuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0SW5kZXgoKSB7CiAgICAg\nICAgcmV0dXJuIF9pZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgaW5k\nZXggb2YgdGhpcyByb3cgaW4gb3JkZXJlZCByb3cgbGlzdC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0SW5kZXgoaW50IGlkeCkgewogICAgICAgIF9p\nZHggPSBpZHg7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRGYWlsZWRP\nYmplY3QoKSB7CiAgICAgICAgcmV0dXJuIF9mYWlsZWQ7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0RmFpbGVkT2JqZWN0KE9iamVjdCBmYWlsZWQpIHsK\nICAgICAgICBfZmFpbGVkID0gZmFpbGVkOwogICAgfQoKICAgIHB1YmxpYyBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIGdldFByaW1hcnlLZXkoKSB7CiAgICAgICAg\ncmV0dXJuIF9wazsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRQcmltYXJ5\nS2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0UHJpbWFyeUtleShudWxsLCBzbSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UHJpbWFyeUtleShDb2x1bW5J\nTyBpbywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIF9wayA9\nIHNtOwogICAgICAgIGZsYWdzIHw9IFBLX1NFVDsKICAgICAgICBfcGtJTyA9\nIGlvOwoKICAgICAgICAvLyBmb3JjZSB2YWxpZAogICAgICAgIHNldFZhbGlk\nKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlUHJpbWFyeUtl\neShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIF9wayA9IHNtOwogICAgICAgIGZsYWdzIHw9\nIFBLX1dIRVJFOwoKICAgICAgICAvLyBmb3JjZSB2YWxpZAogICAgICAgIGlm\nIChnZXRBY3Rpb24oKSA9PSBBQ1RJT05fREVMRVRFKQogICAgICAgICAgICBz\nZXRWYWxpZCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgSS9PIGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4gc2V0IGZvcmVpZ24g\na2V5LgogICAgICovCiAgICBwdWJsaWMgQ29sdW1uSU8gZ2V0Rm9yZWlnbktl\neUlPKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICByZXR1cm4gKF9ma0lPID09\nIG51bGwpID8gbnVsbCA6IF9ma0lPW2ZrLmdldEluZGV4KCldOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBmb3IgdGhlIGdpdmVu\nIGZvcmVpZ24ga2V5LiBWYWx1ZXMgbm90IG5lZWRlZCBmb3IKICAgICAqIGNv\nbnN0cmFpbnQgYW5hbHlzZXMgYXJlIG5vdCByZWNvcmRlZC4KICAgICAqLwog\nICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0Rm9yZWlnbktleVNl\ndChGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgcmV0dXJuIChfZmtTZXQgPT0g\nbnVsbCkgPyBudWxsIDogX2ZrU2V0W2ZrLmdldEluZGV4KCldOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBmb3IgdGhlIGdpdmVu\nIGZvcmVpZ24ga2V5LiBWYWx1ZXMgbm90IG5lZWRlZCBmb3IKICAgICAqIGNv\nbnN0cmFpbnQgYW5hbHlzZXMgYXJlIG5vdCByZWNvcmRlZC4KICAgICAqLwog\nICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0Rm9yZWlnbktleVdo\nZXJlKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICByZXR1cm4gKF9ma1doZXJl\nID09IG51bGwpID8gbnVsbCA6IF9ma1doZXJlW2ZrLmdldEluZGV4KCldOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoRm9yZWlnbktl\neSBmaywgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRGb3JlaWduS2V5KGZrLCBudWxs\nLCBzbSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Rm9yZWlnbktleShG\nb3JlaWduS2V5IGZrLCBDb2x1bW5JTyBpbywKICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmICghZGVsYXlGb3JlaWduS2V5KGZrLCBzbSwgdHJ1ZSkpCiAg\nICAgICAgICAgIHN1cGVyLnNldEZvcmVpZ25LZXkoZmssIGlvLCBzbSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICByZWNvcmRGb3JlaWduS2V5KGZrLCBp\nbywgc20sIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlRm9y\nZWlnbktleShGb3JlaWduS2V5IGZrLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICgh\nZGVsYXlGb3JlaWduS2V5KGZrLCBzbSwgZmFsc2UpKQogICAgICAgICAgICBz\ndXBlci53aGVyZUZvcmVpZ25LZXkoZmssIHNtKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJlY29yZEZvcmVpZ25LZXkoZmssIG51bGwsIHNtLCBmYWxz\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xlYXJGb3JlaWduS2V5KEZv\ncmVpZ25LZXkgZmspCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3VwZXIuY2xlYXJGb3JlaWduS2V5KGZrKTsKICAgICAgICBpZiAo\nX2ZrU2V0ICE9IG51bGwpCiAgICAgICAgICAgIF9ma1NldFtmay5nZXRJbmRl\neCgpXSA9IG51bGw7CiAgICAgICAgaWYgKF9ma0lPICE9IG51bGwpCiAgICAg\nICAgICAgIF9ma0lPW2ZrLmdldEluZGV4KCldID0gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHRoaXMgaXMgYSBkZWxldGUsIGRlbGF5IGZvcmVp\nZ24ga2V5cyB0byBvdGhlciBkZWxldGVkIG9iamVjdHMgaWYKICAgICAqIHRo\nZSBrZXkgaXMgcmVzdHJpY3RlZC4gSWYgdGhpcyBpcyBhbiB1cGRhdGUgb3Ig\naW5zZXJ0LCBkZWxheSBmb3JlaWduCiAgICAgKiBrZXlzIHRvIG90aGVyIGlu\nc2VydHMgaWYgdGhlIGtleSBpcyBub3QgbG9naWNhbC4gSWYgdGhlIGZvcmVp\nZ24ga2V5CiAgICAgKiBpcyB0byBhIG5ldyByZWNvcmQgYW5kIHRoZSBjb2x1\nbW5zIGFyZSBhdXRvLWluYywgcmVjb3JkIGl0LgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gZGVsYXlGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgYm9vbGVhbiBzZXQpIHsK\nICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBpZiAoZ2V0QWN0aW9uKCkgPT0gQUNUSU9OX0RFTEVU\nRSkKICAgICAgICAgICAgcmV0dXJuIHNtLmlzRGVsZXRlZCgpICYmICFmay5p\nc0RlZmVycmVkKCkKICAgICAgICAgICAgICAgICYmIGZrLmdldERlbGV0ZUFj\ndGlvbigpID09IEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUOwoKICAgICAg\nICBpZiAoIXNtLmlzTmV3KCkgfHwgc20uaXNGbHVzaGVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIWZrLmlzRGVmZXJyZWQo\nKSAmJiAhZmsuaXNMb2dpY2FsKCkpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIGlmIChmay5pc1ByaW1hcnlLZXlBdXRvQXNzaWduZWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkIGEgZGVsYXllZCBmb3Jl\naWduIGtleS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZEZvcmVp\nZ25LZXkoRm9yZWlnbktleSBmaywgQ29sdW1uSU8gaW8sCiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgYm9vbGVhbiBzZXQpIHsKICAgICAgICBp\nZiAoc2V0KSB7CiAgICAgICAgICAgIC8vIGZvcmNlIHZhbGlkCiAgICAgICAg\nICAgIGlmIChjYW5TZXRBbnkoaW8sIGZrLmdldENvbHVtbnMoKS5sZW5ndGgK\nICAgICAgICAgICAgICAgICsgZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCkubGVu\nZ3RoLCBmYWxzZSkpCiAgICAgICAgICAgICAgICBzZXRWYWxpZCh0cnVlKTsK\nCiAgICAgICAgICAgIGlmIChfZmtTZXQgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9ma1NldCA9IG5ldyBPcGVuSlBBU3RhdGVNYW5hZ2VyW2dldFRhYmxl\nKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0Rm9yZWlnbktleXMoKS5sZW5n\ndGhdOwogICAgICAgICAgICBfZmtTZXRbZmsuZ2V0SW5kZXgoKV0gPSBzbTsK\nCiAgICAgICAgICAgIGlmIChfZmtJTyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2ZrSU9bZmsuZ2V0SW5kZXgoKV0gPSBpbzsKICAgICAgICAgICAgZWxz\nZSBpZiAoaW8gIT0gbnVsbCAmJiAoKGdldEFjdGlvbigpID09IEFDVElPTl9J\nTlNFUlQKICAgICAgICAgICAgICAgICYmICFpby5pc0FsbEluc2VydGFibGUo\nZmssIGZhbHNlKSkKICAgICAgICAgICAgICAgIHx8IChnZXRBY3Rpb24oKSAh\nPSBBQ1RJT05fSU5TRVJUCiAgICAgICAgICAgICAgICAmJiAhaW8uaXNBbGxV\ncGRhdGFibGUoZmssIGZhbHNlKSkpKSB7CiAgICAgICAgICAgICAgICBfZmtJ\nTyA9IG5ldyBDb2x1bW5JT1tfZmtTZXQubGVuZ3RoXTsKICAgICAgICAgICAg\nICAgIF9ma0lPW2ZrLmdldEluZGV4KCldID0gaW87CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBmb3JjZSB2YWxpZAog\nICAgICAgICAgICBpZiAoZ2V0QWN0aW9uKCkgPT0gQUNUSU9OX0RFTEVURSkK\nICAgICAgICAgICAgICAgIHNldFZhbGlkKHRydWUpOwoKICAgICAgICAgICAg\naWYgKF9ma1doZXJlID09IG51bGwpCiAgICAgICAgICAgICAgICBfZmtXaGVy\nZSA9IG5ldyBPcGVuSlBBU3RhdGVNYW5hZ2VyW2dldFRhYmxlKCkuCiAgICAg\nICAgICAgICAgICAgICAgZ2V0Rm9yZWlnbktleXMoKS5sZW5ndGhdOwogICAg\nICAgICAgICBfZmtXaGVyZVtmay5nZXRJbmRleCgpXSA9IHNtOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVjb3JkZWQg\ndmFsdWUgZm9yIHRoZSBnaXZlbiByZWxhdGlvbiBpZCBjb2x1bW4uIE9ubHkK\nICAgICAqIHZhbHVlcyB0aGF0IGFyZSBkZXBlbmRlbnQgb24gYSBuZXcsIHVu\nZmx1c2hlZCBhdXRvLWFzc2lnbmVkIGluc3RhbmNlCiAgICAgKiBhcmUgcmVj\nb3JkZWQuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIGdldFJlbGF0aW9uSWRTZXQoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVy\nbiAoX3JlbFNldCA9PSBudWxsKSA/IG51bGwgOiBfcmVsU2V0W2dldFJlbGF0\naW9uSWRJbmRleChjb2wpXTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgcmVjb3JkZWQgY2FsbGJhY2tzIGZvciB0aGUgZ2l2ZW4gcmVsYXRp\nb24gaWQgY29sdW1uLiBPbmx5CiAgICAgKiB2YWx1ZXMgdGhhdCBhcmUgZGVw\nZW5kZW50IG9uIGEgbmV3LCB1bmZsdXNoZWQgYXV0by1hc3NpZ25lZCBpbnN0\nYW5jZQogICAgICogYXJlIHJlY29yZGVkLgogICAgICovCiAgICBwdWJsaWMg\nUmVsYXRpb25JZCBnZXRSZWxhdGlvbklkQ2FsbGJhY2soQ29sdW1uIGNvbCkg\newogICAgICAgIHJldHVybiAoX2NhbGxiYWNrcyA9PSBudWxsKSA/IG51bGwK\nICAgICAgICAgICAgOiBfY2FsbGJhY2tzW2dldFJlbGF0aW9uSWRJbmRleChj\nb2wpXTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZWxhdGlvbklkKENv\nbHVtbiBjb2wsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgUmVs\nYXRpb25JZCByZWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHNtID09IG51bGwgfHwgc20uZ2V0T2JqZWN0SWQoKSAhPSBu\ndWxsIHx8ICFzbS5pc05ldygpCiAgICAgICAgICAgIHx8IHNtLmlzRmx1c2hl\nZCgpIHx8ICFpc1ByaW1hcnlLZXlBdXRvQXNzaWduZWQoc20pKQogICAgICAg\nICAgICBzdXBlci5zZXRSZWxhdGlvbklkKGNvbCwgc20sIHJlbCk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChfcmVsU2V0ID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIENvbHVtbltdIGNvbHMgPSBnZXRUYWJsZSgpLmdl\ndFJlbGF0aW9uSWRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBfcmVsU2V0\nID0gbmV3IE9wZW5KUEFTdGF0ZU1hbmFnZXJbY29scy5sZW5ndGhdOwogICAg\nICAgICAgICAgICAgX2NhbGxiYWNrcyA9IG5ldyBSZWxhdGlvbklkW2NvbHMu\nbGVuZ3RoXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbnQgaWR4ID0g\nZ2V0UmVsYXRpb25JZEluZGV4KGNvbCk7CiAgICAgICAgICAgIF9yZWxTZXRb\naWR4XSA9IHNtOwogICAgICAgICAgICBfY2FsbGJhY2tzW2lkeF0gPSByZWw7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyUmVsYXRp\nb25JZChDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN1cGVyLmNsZWFyUmVsYXRpb25JZChjb2wpOwogICAgICAg\nIGlmIChfcmVsU2V0ICE9IG51bGwpIHsKICAgICAgICAgICAgaW50IGlkeCA9\nIGdldFJlbGF0aW9uSWRJbmRleChjb2wpOwogICAgICAgICAgICBfcmVsU2V0\nW2lkeF0gPSBudWxsOwogICAgICAgICAgICBfY2FsbGJhY2tzW2lkeF0gPSBu\ndWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgaW5kZXggaW50byBvdXIgcmVsYXRpb24gaWQgYXJyYXkgb2YgdGhlIHZh\nbHVlIGZvciB0aGUKICAgICAqIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBpbnQgZ2V0UmVsYXRpb25JZEluZGV4KENvbHVtbiBjb2wpIHsK\nICAgICAgICBDb2x1bW5bXSBjb2xzID0gZ2V0VGFibGUoKS5nZXRSZWxhdGlv\nbklkQ29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29s\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbHNbaV0gPT0gY29s\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgcmV0dXJuIC0x\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgYW55IHBy\naW1hcnkga2V5IGNvbHVtbnMgb2YgdGhlIGdpdmVuIGluc3RhbmNlIGFyZQog\nICAgICogYXV0by1hc3NpZ25lZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgYm9vbGVhbiBpc1ByaW1hcnlLZXlBdXRvQXNzaWduZWQoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSkgewogICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSAo\nQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHdoaWxl\nIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgY2xzID0gY2xzLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpOwogICAgICAgIENvbHVtbltdIGNvbHMgPSBjbHMuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2xzW2ld\nLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHJvdGVjdGVk\nIHZvaWQgc2V0T2JqZWN0KENvbHVtbiBjb2wsIE9iamVjdCB2YWwsIGludCBt\nZXRhVHlwZSwKICAgICAgICBib29sZWFuIG92ZXJyaWRlRGVmYXVsdCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBtYWtlIHN1\ncmUgd2UncmUgbm90IHNldHRpbmcgdHdvIGRpZmZlcmVudCB2YWx1ZXMKICAg\nICAgICBPYmplY3QgcHJldiA9IGdldFNldChjb2wpOwogICAgICAgIGlmIChw\ncmV2ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHByZXYgPT0gTlVMTCkK\nICAgICAgICAgICAgICAgIHByZXYgPSBudWxsOwogICAgICAgICAgICBpZiAo\nIXJvd1ZhbHVlRXF1YWxzKHByZXYsIHZhbCkpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImRp\nZmYtdmFsdWVzIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIGNvbC5nZXRGdWxsTmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAo\ncHJldiA9PSBudWxsKSA/IG51bGwgOiBwcmV2LmdldENsYXNzKCksIHByZXYs\nCiAgICAgICAgICAgICAgICAgICAgICAgICh2YWwgPT0gbnVsbCkgPyBudWxs\nIDogdmFsLmdldENsYXNzKCksIHZhbCB9KSkuCiAgICAgICAgICAgICAgICAg\nICAgc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgc3VwZXIuc2V0T2JqZWN0KGNvbCwgdmFsLCBtZXRhVHlwZSwgb3Zl\ncnJpZGVEZWZhdWx0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\ncnVlIGlmIHRoZSB0d28gdmFsdWVzIHNob3VsZCBiZSBjb25zaWRlcmVkIGVx\ndWFsLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIHJvd1Zh\nbHVlRXF1YWxzKE9iamVjdCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAgaWYg\nKE9iamVjdFV0aWxzLmVxdWFscyhvMSwgbzIpKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIG51bWVyaWMgZXF1YWxp\ndHkgKGJ1ZyAjMTE1MSkKICAgICAgICByZXR1cm4gbzEgaW5zdGFuY2VvZiBO\ndW1iZXIgJiYgbzIgaW5zdGFuY2VvZiBOdW1iZXIKICAgICAgICAgICAgJiYg\nKChOdW1iZXIpIG8xKS5kb3VibGVWYWx1ZSgpID09ICgoTnVtYmVyKSBvMiku\nZG91YmxlVmFsdWUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\nbmVyYXRlU1FMKERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKChmbGFncyAmIFBLX1NFVCkgPiAwKQogICAgICAg\nICAgICAgICAgc3VwZXIuc2V0UHJpbWFyeUtleShfcGtJTywgX3BrKTsKICAg\nICAgICAgICAgaWYgKChmbGFncyAmIFBLX1dIRVJFKSA+IDApCiAgICAgICAg\nICAgICAgICBzdXBlci53aGVyZVByaW1hcnlLZXkoX3BrKTsKICAgICAgICAg\nICAgaWYgKF9ma1NldCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBGb3Jl\naWduS2V5W10gZmtzID0gZ2V0VGFibGUoKS5nZXRGb3JlaWduS2V5cygpOwog\nICAgICAgICAgICAgICAgQ29sdW1uSU8gaW87CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IF9ma1NldC5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIGlmIChfZmtTZXRbaV0gIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpbyA9IChfZmtJTyA9PSBudWxsKSA/IG51\nbGwgOiBfZmtJT1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXIu\nc2V0Rm9yZWlnbktleShma3NbaV0sIGlvLCBfZmtTZXRbaV0pOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoX3JlbFNldCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBDb2x1bW5bXSBjb2xzID0gZ2V0VGFibGUoKS5nZXRSZWxhdGlv\nbklkQ29sdW1ucygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfcmVsU2V0Lmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAg\nIGlmIChfcmVsU2V0W2ldICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHN1cGVyLnNldFJlbGF0aW9uSWQoY29sc1tpXSwgX3JlbFNldFtpXSwg\nX2NhbGxiYWNrc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKF9ma1doZXJlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEZvcmVpZ25L\nZXlbXSBma3MgPSBnZXRUYWJsZSgpLmdldEZvcmVpZ25LZXlzKCk7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9ma1doZXJlLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChfZmtXaGVyZVtpXSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzdXBlci53aGVyZUZv\ncmVpZ25LZXkoZmtzW2ldLCBfZmtXaGVyZVtpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBk\naWN0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLmdlbmVyYXRl\nU1FMKGRpY3QpOwogICAgfQoKICAgIHByb3RlY3RlZCBSb3dJbXBsIG5ld0lu\nc3RhbmNlKFRhYmxlIHRhYmxlLCBpbnQgYWN0aW9uKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBQcmltYXJ5Um93KHRhYmxlLCBhY3Rpb24sIF9wayk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgY29weUludG8oUm93SW1wbCByb3csIGJvb2xl\nYW4gd2hlcmVPbmx5KSB7CiAgICAgICAgc3VwZXIuY29weUludG8ocm93LCB3\naGVyZU9ubHkpOwogICAgICAgIGlmICghKHJvdyBpbnN0YW5jZW9mIFByaW1h\ncnlSb3cpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFByaW1hcnlS\nb3cgcHJvdyA9IChQcmltYXJ5Um93KSByb3c7CiAgICAgICAgcHJvdy5fcGsg\nPSBfcGs7CiAgICAgICAgcHJvdy5fcGtJTyA9IF9wa0lPOwogICAgICAgIGlm\nICgoZmxhZ3MgJiBQS19XSEVSRSkgPiAwKQogICAgICAgICAgICBwcm93LmZs\nYWdzIHw9IFBLX1dIRVJFOwogICAgICAgIGlmICghd2hlcmVPbmx5ICYmIChm\nbGFncyAmIFBLX1NFVCkgPiAwKQogICAgICAgICAgICBwcm93LmZsYWdzIHw9\nIFBLX1NFVDsKCiAgICAgICAgaWYgKF9ma1doZXJlICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKHByb3cuX2ZrV2hlcmUgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHByb3cuX2ZrV2hlcmUgPSBuZXcgT3BlbkpQQVN0YXRlTWFuYWdl\ncltfZmtXaGVyZS5sZW5ndGhdOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXlj\nb3B5KF9ma1doZXJlLCAwLCBwcm93Ll9ma1doZXJlLCAwLCBfZmtXaGVyZS5s\nZW5ndGgpOwogICAgICAgIH0KICAgICAgICBpZiAoIXdoZXJlT25seSAmJiBf\nZmtTZXQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAocHJvdy5fZmtTZXQg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHByb3cuX2ZrU2V0ID0gbmV3IE9w\nZW5KUEFTdGF0ZU1hbmFnZXJbX2ZrU2V0Lmxlbmd0aF07CiAgICAgICAgICAg\nIFN5c3RlbS5hcnJheWNvcHkoX2ZrU2V0LCAwLCBwcm93Ll9ma1NldCwgMCwg\nX2ZrU2V0Lmxlbmd0aCk7CiAgICAgICAgICAgIGlmIChfZmtJTyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvdy5fZmtJTyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHByb3cuX2ZrSU8gPSBuZXcgQ29sdW1uSU9b\nX2ZrSU8ubGVuZ3RoXTsKICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNv\ncHkoX2ZrSU8sIDAsIHByb3cuX2ZrSU8sIDAsIF9ma0lPLmxlbmd0aCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCF3aGVyZU9ubHkg\nJiYgX3JlbFNldCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChwcm93Ll9y\nZWxTZXQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcHJvdy5fcmVsU2V0\nID0gbmV3IE9wZW5KUEFTdGF0ZU1hbmFnZXJbX3JlbFNldC5sZW5ndGhdOwog\nICAgICAgICAgICAgICAgcHJvdy5fY2FsbGJhY2tzID0gbmV3IFJlbGF0aW9u\nSWRbX2NhbGxiYWNrcy5sZW5ndGhdOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIFN5c3RlbS5hcnJheWNvcHkoX3JlbFNldCwgMCwgcHJvdy5fcmVsU2V0\nLCAwLCBfcmVsU2V0Lmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkoX2NhbGxiYWNrcywgMCwgcHJvdy5fY2FsbGJhY2tzLCAwLAogICAg\nICAgICAgICAgICAgX2NhbGxiYWNrcy5sZW5ndGgpOwogICAgICAgIH0KICAg\nIH0KfQo=\n","encoding":"base64"}

