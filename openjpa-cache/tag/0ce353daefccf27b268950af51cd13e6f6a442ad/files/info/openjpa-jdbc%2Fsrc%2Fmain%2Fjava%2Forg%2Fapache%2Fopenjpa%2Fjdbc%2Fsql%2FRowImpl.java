{"sha":"38180c59596ee9b299b55631c9384ce1c32be5a9","node_id":"MDQ6QmxvYjIwNjM2NDozODE4MGM1OTU5NmVlOWIyOTliNTU2MzFjOTM4NGNlMWMzMmJlNWE5","size":28438,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/38180c59596ee9b299b55631c9384ce1c32be5a9","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbDsKCmltcG9ydCBqYXZhLmlvLklucHV0U3RyZWFt\nOwppbXBvcnQgamF2YS5pby5SZWFkZXI7CmltcG9ydCBqYXZhLm1hdGguQmln\nRGVjaW1hbDsKaW1wb3J0IGphdmEubWF0aC5CaWdJbnRlZ2VyOwppbXBvcnQg\namF2YS5zcWwuQXJyYXk7CmltcG9ydCBqYXZhLnNxbC5CbG9iOwppbXBvcnQg\namF2YS5zcWwuQ2xvYjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVkU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5zcWwuVGltZTsKaW1wb3J0IGphdmEuc3FsLlRpbWVzdGFtcDsKaW1wb3J0\nIGphdmEudXRpbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwpp\nbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkphdmFTUUxUeXBlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSm9pbmFibGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlJlbGF0aW9uSWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklP\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVp\nZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5K\nUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoK\nLyoqCiAqIEJhc2ljIHtAbGluayBSb3d9IGltcGxlbWVudGF0aW9uLgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMg\nY2xhc3MgUm93SW1wbAogICAgaW1wbGVtZW50cyBSb3csIENsb25lYWJsZSB7\nCgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBPYmplY3QgTlVMTCA9IG5l\ndyBPYmplY3QoKTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFZB\nTElEID0gMiA8PCAwOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBS\nQVcgPSBJbnRlZ2VyLk1JTl9WQUxVRTsKCiAgICBwcm90ZWN0ZWQgYnl0ZSBm\nbGFncyA9IDA7CiAgICBwcml2YXRlIGZpbmFsIFRhYmxlIF90YWJsZTsKICAg\nIHByaXZhdGUgZmluYWwgaW50IF9hY3Rpb247CiAgICBwcml2YXRlIGZpbmFs\nIE9iamVjdFtdIF92YWxzOwogICAgcHJpdmF0ZSBmaW5hbCBpbnRbXSBfdHlw\nZXM7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3NxbCA9IG51bGw7CgogICAgLyoq\nCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFyYW0gdGFi\nbGUgdGhlIHRhYmxlIHRoZSByb3cgaXMgYSBwYXJ0IG9mCiAgICAgKiBAcGFy\nYW0gYWN0aW9uIHRoZSBhY3Rpb24gb24gdGhlIHJvdwogICAgICovCiAgICBw\ndWJsaWMgUm93SW1wbChUYWJsZSB0YWJsZSwgaW50IGFjdGlvbikgewogICAg\nICAgIF90YWJsZSA9IHRhYmxlOwogICAgICAgIF9hY3Rpb24gPSBhY3Rpb247\nCgogICAgICAgIC8vIHdlIG5lZWQgcm9vbSBmb3IgdmFsdWVzIGFuZCB0eXBl\ncyBmb3IgYWxsIGNvbHVtbnM7IGlmIGFuIHVwZGF0ZSBvcgogICAgICAgIC8v\nIGRlbGV0ZSwgdGhlbiB3ZSBuZWVkIHRvIGRvdWJsZSB0aGF0IGZvciB3aGVy\nZSBjb2x1bW4gY29uZGl0aW9ucwogICAgICAgIGludCBsZW4gPSB0YWJsZS5n\nZXRDb2x1bW5zKCkubGVuZ3RoOwogICAgICAgIGlmIChhY3Rpb24gIT0gQUNU\nSU9OX0lOU0VSVCkKICAgICAgICAgICAgbGVuICo9IDI7CiAgICAgICAgX3Zh\nbHMgPSBuZXcgT2JqZWN0W2xlbl07CiAgICAgICAgX3R5cGVzID0gbmV3IGlu\ndFtsZW5dOwogICAgfQoKICAgIHB1YmxpYyBUYWJsZSBnZXRUYWJsZSgpIHsK\nICAgICAgICByZXR1cm4gX3RhYmxlOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0QWN0aW9uKCkgewogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzVmFsaWQoKSB7CiAgICAgICAgcmV0dXJu\nIChmbGFncyAmIFZBTElEKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFZhbGlkKGJvb2xlYW4gdmFsaWQpIHsKICAgICAgICBpZiAodmFsaWQp\nCiAgICAgICAgICAgIGZsYWdzIHw9IFZBTElEOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgZmxhZ3MgJj0gflZBTElEOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhpcyBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCB0cmFjayBwcmltYXJ5\nIGtleXMuCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIGdldFByaW1hcnlLZXkoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90\nIHRyYWNrIGZhaWxlZCBvYmplY3RzLgogICAgICovCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldEZhaWxlZE9iamVjdCgpIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24gZG9l\ncyBub3QgdHJhY2sgZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEZhaWxlZE9iamVjdChPYmplY3QgZmFpbGVkKSB7CiAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZWNvbmRhcnkgcm93cyBjYW5ub3QgYmUgZGVwZW5kZW50\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlcGVuZGVudCgpIHsK\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHZhbHVlIHNldCBmb3IgdXBkYXRlIG9uIHRoZSBnaXZlbiBj\nb2x1bW4uCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0U2V0KENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gX3ZhbHNbZ2V0U2V0SW5kZXgoY29s\nKV07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIHNl\ndCBmb3Igd2hlcmUgb24gdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAg\ncHVibGljIE9iamVjdCBnZXRXaGVyZShDb2x1bW4gY29sKSB7CiAgICAgICAg\ncmV0dXJuIF92YWxzW2dldFdoZXJlSW5kZXgoY29sKV07CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0UHJpbWFyeUtleShPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndFByaW1hcnlLZXkobnVsbCwgc20pOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFByaW1hcnlLZXkoQ29sdW1uSU8gaW8sIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmx1c2hQcmltYXJ5S2V5KHNtLCBpbywgdHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmx1\nc2hQcmltYXJ5S2V5KHNtLCBudWxsLCBmYWxzZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBGbHVzaCB0aGUgcHJpbWFyeSBrZXkgdmFsdWVzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgZmx1c2hQcmltYXJ5S2V5KE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIENvbHVtbklPIGlvLAogICAgICAgIGJvb2xlYW4gc2V0\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENsYXNz\nTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURh\ndGEoKTsKICAgICAgICB3aGlsZSAobWFwcGluZy5nZXRUYWJsZSgpICE9IF90\nYWJsZSkKICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0UENTdXBl\ncmNsYXNzTWFwcGluZygpOwogICAgICAgIENvbHVtbltdIGNvbHMgPSBtYXBw\naW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgZmx1c2hKb2lu\nVmFsdWVzKHNtLCBjb2xzLCBjb2xzLCBpbywgc2V0KTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc2V0Rm9yZWlnbktleShmaywgbnVsbCwgc20pOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldEZvcmVpZ25LZXkoRm9yZWlnbktleSBm\naywgQ29sdW1uSU8gaW8sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmbHVz\naEZvcmVpZ25LZXkoZmssIGlvLCBzbSwgdHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgZmx1c2hGb3JlaWduS2V5KGZrLCBudWxsLCBzbSwgZmFs\nc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYSBjaXJjdWxhciBm\nb3JlaWduIGtleS4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXJGb3Jl\naWduS2V5KEZvcmVpZ25LZXkgZmspCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgX3NxbCA9IG51bGw7CiAgICAgICAgQ29sdW1uW10g\nY29scyA9IGZrLmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIF92YWxzW2dl\ndFNldEluZGV4KGNvbHNbaV0pXSA9IG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBGbHVzaCB0aGUgZm9yZWlnbiBrZXkgdmFsdWVzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgZmx1c2hGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmss\nIENvbHVtbklPIGlvLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIGJvb2xlYW4gc2V0KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGZsdXNoSm9pblZhbHVlcyhzbSwgZmsuZ2V0UHJpbWFyeUtleUNv\nbHVtbnMoKSwgZmsuZ2V0Q29sdW1ucygpLAogICAgICAgICAgICBpbywgc2V0\nKTsKICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAgICAg\nICAgIGludCBsZW4gPSBmay5nZXRDb2x1bW5zKCkubGVuZ3RoOwogICAgICAg\nICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBpbnQgdHlwZTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBvYmogPSBmay5nZXRDb25zdGFudChjb2xzW2ld\nKTsKICAgICAgICAgICAgICAgIHR5cGUgPSBjb2xzW2ldLmdldEphdmFUeXBl\nKCk7CiAgICAgICAgICAgICAgICBpZiAoc2V0ICYmIGNhblNldChpbywgaSAr\nIGxlbiwgb2JqID09IG51bGwpKQogICAgICAgICAgICAgICAgICAgIHNldE9i\namVjdChjb2xzW2ldLCBvYmosIHR5cGUsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGVsc2UgaWYgKCFzZXQpCiAgICAgICAgICAgICAgICAgICAgd2hlcmVP\nYmplY3QoY29sc1tpXSwgb2JqLCB0eXBlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSBnaXZlbiBp\nbnN0YW5jZSB2YWx1ZSB0byB0aGUgZ2l2ZW4gY29sdW1ucy4gTm90ZSB0aGF0\nCiAgICAgKiBmb3JlaWduIGtleXMgbWF5IGluY2x1ZGUgY29sdW1ucyBhbHNv\nIG1hcHBlZCBieSBzaW1wbGUgdmFsdWVzLiBXZQogICAgICogdXNlIGEgcHJp\nb3JpdHkgbWVjaGFuaXNtIHRvIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBsZXQg\ndGhlIG51bGxpbmcKICAgICAqIG9mIGEgZm9yZWlnbiBrZXkgbnVsbCBjb2x1\nbW5zIGFsc28gb3duZWQgYnkgc2ltcGxlIHZhbHVlcy4KICAgICAqCiAgICAg\nKiBAcGFyYW0gdG8gdGhlIGluc3RhbmNlIGJlaW5nIGpvaW5lZCB0bwogICAg\nICogQHBhcmFtIHRvQ29scyB0aGUgY29sdW1ucyBiZWluZyBqb2luZWQgdG8K\nICAgICAqIEBwYXJhbSBmcm9tQ29scyB0aGUgY29sdW1ucyBiZWluZyBqb2lu\nZWQgZnJvbQogICAgICogQHBhcmFtIGlvIGluZm9ybWF0aW9uIGFib3V0IEkv\nTyBjYXBhYmlsaXRpZXMgaW4gdGhpcyBjb250ZXh0CiAgICAgKiBAcGFyYW0g\nc2V0IHdoZXRoZXIgdGhpcyBzaG91bGQgYmUgZmx1c2hlZCBhcyBhbiB1cGRh\ndGUgb3IKICAgICAqIGFzIGEgd2hlcmUgY29uZGl0aW9uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBmbHVzaEpvaW5WYWx1ZXMoT3BlbkpQQVN0YXRlTWFu\nYWdlciB0bywgQ29sdW1uW10gdG9Db2xzLAogICAgICAgIENvbHVtbltdIGZy\nb21Db2xzLCBDb2x1bW5JTyBpbywgYm9vbGVhbiBzZXQpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRvID09IG51bGwpIHsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmcm9tQ29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHNldCAmJiBjYW5TZXQo\naW8sIGksIHRydWUpKQogICAgICAgICAgICAgICAgICAgIHNldE51bGwoZnJv\nbUNvbHNbaV0pOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXNldCkKICAg\nICAgICAgICAgICAgICAgICB3aGVyZU51bGwoZnJvbUNvbHNbaV0pOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAg\nICAgaWYgKHNldCAmJiAhY2FuU2V0QW55KGlvLCBmcm9tQ29scy5sZW5ndGgs\nIGZhbHNlKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFzc01h\ncHBpbmcgdG9NYXBwaW5nID0gKENsYXNzTWFwcGluZykgdG8uZ2V0TWV0YURh\ndGEoKTsKICAgICAgICBKb2luYWJsZSBqb2luOwogICAgICAgIE9iamVjdCB2\nYWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0b0NvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgLy8gZG9uJ3QgZXZlbiB0cmFuc2xhdGUg\nam9pbiB2YWx1ZSBpZiB1bnNldHRhYmxlCiAgICAgICAgICAgIGlmIChzZXQp\nIHsKICAgICAgICAgICAgICAgIGlmIChfYWN0aW9uID09IEFDVElPTl9JTlNF\nUlQgJiYgZnJvbUNvbHNbaV0uaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICghY2Fu\nU2V0KGlvLCBpLCBmYWxzZSkpCiAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGpvaW4gPSB0b01hcHBp\nbmcuYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ldKTsKICAgICAgICAgICAgdmFs\nID0gam9pbi5nZXRKb2luVmFsdWUodG8sIHRvQ29sc1tpXSwgKEpEQkNTdG9y\nZSkgdG8uCiAgICAgICAgICAgICAgICBnZXRDb250ZXh0KCkuZ2V0U3RvcmVN\nYW5hZ2VyKCkuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKSk7CiAgICAgICAgICAg\nIGlmIChzZXQgJiYgdmFsID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlm\nIChjYW5TZXQoaW8sIGksIHRydWUpKQogICAgICAgICAgICAgICAgICAgIHNl\ndE51bGwoZnJvbUNvbHNbaV0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNl\ndCAmJiB2YWwgaW5zdGFuY2VvZiBSYXcpCiAgICAgICAgICAgICAgICBzZXRS\nYXcoZnJvbUNvbHNbaV0sIHZhbC50b1N0cmluZygpKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoc2V0KQogICAgICAgICAgICAgICAgc2V0T2JqZWN0KGZyb21D\nb2xzW2ldLCB2YWwsIHRvQ29sc1tpXS5nZXRKYXZhVHlwZSgpLCBmYWxzZSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgd2hlcmVOdWxsKGZyb21Db2xzW2ldKTsKICAgICAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgUmF3KQogICAgICAgICAgICAgICAgd2hl\ncmVSYXcoZnJvbUNvbHNbaV0sIHZhbC50b1N0cmluZygpKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgd2hlcmVPYmplY3QoZnJvbUNvbHNb\naV0sIHZhbCwgdG9Db2xzW2ldLmdldEphdmFUeXBlKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIGFueSBvZiB0\naGUgZ2l2ZW4gY29sdW1uIGluZGV4ZXMgYXJlIHNldHRhYmxlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjYW5TZXRBbnkoQ29sdW1uSU8gaW8s\nIGludCBpLCBib29sZWFuIG51bGxWYWx1ZSkgewogICAgICAgIGlmIChpbyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nX2FjdGlvbiA9PSBBQ1RJT05fSU5TRVJUKQogICAgICAgICAgICByZXR1cm4g\naW8uaXNBbnlJbnNlcnRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAgaWYg\nKF9hY3Rpb24gPT0gQUNUSU9OX1VQREFURSkKICAgICAgICAgICAgcmV0dXJu\nIGlvLmlzQW55VXBkYXRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBp\nZiB0aGUgZ2l2ZW4gY29sdW1uIGluZGV4IGlzIHNldHRhYmxlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjYW5TZXQoQ29sdW1uSU8gaW8sIGlu\ndCBpLCBib29sZWFuIG51bGxWYWx1ZSkgewogICAgICAgIGlmIChpbyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoX2Fj\ndGlvbiA9PSBBQ1RJT05fSU5TRVJUKQogICAgICAgICAgICByZXR1cm4gaW8u\naXNJbnNlcnRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAgaWYgKF9hY3Rp\nb24gPT0gQUNUSU9OX1VQREFURSkKICAgICAgICAgICAgcmV0dXJuIGlvLmlz\nVXBkYXRhYmxlKGksIG51bGxWYWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVsYXRpb25JZChDb2x1bW4g\nY29sLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIFJlbGF0aW9u\nSWQgcmVsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHNldE9iamVjdChjb2wsIHJlbC50b1JlbGF0aW9uRGF0YVN0b3JlVmFsdWUo\nc20sIGNvbCksCiAgICAgICAgICAgIGNvbC5nZXRKYXZhVHlwZSgpLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhIGNpcmN1bGFyIHJl\nbGF0aW9uIGlkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbGVhclJlbGF0\naW9uSWQoQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBfc3FsID0gbnVsbDsKICAgICAgICBfdmFsc1tnZXRTZXRJ\nbmRleChjb2wpXSA9IG51bGw7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nQXJyYXkoQ29sdW1uIGNvbCwgQXJyYXkgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2\nYVNRTFR5cGVzLkFSUkFZLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0QXNjaWlTdHJlYW0oQ29sdW1uIGNvbCwgSW5wdXRTdHJlYW0gdmFs\nLCBpbnQgbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldE9iamVjdChjb2wsICh2YWwgPT0gbnVsbCkgPyBudWxsIDog\nbmV3IFNpemVkKHZhbCwgbGVuZ3RoKSwKICAgICAgICAgICAgSmF2YVNRTFR5\ncGVzLkFTQ0lJX1NUUkVBTSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEJpZ0RlY2ltYWwoQ29sdW1uIGNvbCwgQmlnRGVjaW1hbCB2YWwp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2Jq\nZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuQklHREVDSU1BTCwgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEJpZ0ludGVnZXIoQ29sdW1uIGNv\nbCwgQmlnSW50ZWdlciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuQklH\nSU5URUdFUiwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEJp\nbmFyeVN0cmVhbShDb2x1bW4gY29sLCBJbnB1dFN0cmVhbSB2YWwsIGludCBs\nZW5ndGgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nc2V0T2JqZWN0KGNvbCwgKHZhbCA9PSBudWxsKSA/IG51bGwgOiBuZXcgU2l6\nZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAgICBKYXZhU1FMVHlwZXMuQklO\nQVJZX1NUUkVBTSwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndEJsb2IoQ29sdW1uIGNvbCwgQmxvYiB2YWwpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZh\nU1FMVHlwZXMuQkxPQiwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldEJvb2xlYW4oQ29sdW1uIGNvbCwgYm9vbGVhbiB2YWwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwg\nKCh2YWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSksCiAgICAg\nICAgICAgIEphdmFUeXBlcy5CT09MRUFOLCBmYWxzZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0Qnl0ZShDb2x1bW4gY29sLCBieXRlIHZhbCkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3Qo\nY29sLCBuZXcgQnl0ZSh2YWwpLCBKYXZhVHlwZXMuQllURSwgZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVzKENvbHVtbiBjb2wsIGJ5\ndGVbXSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuQllURVMsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYWxlbmRhcihDb2x1\nbW4gY29sLCBDYWxlbmRhciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMu\nQ0FMRU5EQVIsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRD\naGFyKENvbHVtbiBjb2wsIGNoYXIgdmFsKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2wsIG5ldyBDaGFyYWN0\nZXIodmFsKSwgSmF2YVR5cGVzLkNIQVIsIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRDaGFyYWN0ZXJTdHJlYW0oQ29sdW1uIGNvbCwgUmVh\nZGVyIHZhbCwgaW50IGxlbmd0aCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCAodmFsID09IG51bGwpID8g\nbnVsbCA6IG5ldyBTaXplZCh2YWwsIGxlbmd0aCksCiAgICAgICAgICAgIEph\ndmFTUUxUeXBlcy5DSEFSX1NUUkVBTSwgZmFsc2UpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldENsb2IoQ29sdW1uIGNvbCwgQ2xvYiB2YWwpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0KGNv\nbCwgdmFsLCBKYXZhU1FMVHlwZXMuQ0xPQiwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldERhdGUoQ29sdW1uIGNvbCwgRGF0ZSB2YWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0T2JqZWN0\nKGNvbCwgdmFsLCBKYXZhVHlwZXMuREFURSwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldERhdGUoQ29sdW1uIGNvbCwgamF2YS5zcWwuRGF0\nZSB2YWwsIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgIGlmICh2YWwgPT0g\nbnVsbCB8fCBjYWwgPT0gbnVsbCkKICAgICAgICAgICAgb2JqID0gdmFsOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgb2JqID0gbmV3IENhbGVuZGFyZCh2\nYWwsIGNhbCk7CiAgICAgICAgc2V0T2JqZWN0KGNvbCwgb2JqLCBKYXZhU1FM\nVHlwZXMuU1FMX0RBVEUsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXREb3VibGUoQ29sdW1uIGNvbCwgZG91YmxlIHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBu\nZXcgRG91YmxlKHZhbCksIEphdmFUeXBlcy5ET1VCTEUsIGZhbHNlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGbG9hdChDb2x1bW4gY29sLCBmbG9h\ndCB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nc2V0T2JqZWN0KGNvbCwgbmV3IEZsb2F0KHZhbCksIEphdmFUeXBlcy5GTE9B\nVCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEludChDb2x1\nbW4gY29sLCBpbnQgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHNldE9iamVjdChjb2wsIE51bWJlcnMudmFsdWVPZih2YWwp\nLCBKYXZhVHlwZXMuSU5ULCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0TG9uZyhDb2x1bW4gY29sLCBsb25nIHZhbCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCBOdW1i\nZXJzLnZhbHVlT2YodmFsKSwgSmF2YVR5cGVzLkxPTkcsIGZhbHNlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUoQ29sdW1uIGNvbCwgTG9j\nYWxlIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBzZXRPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5MT0NBTEUsIGZhbHNl\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROdWxsKENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0TnVs\nbChjb2wsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROdWxs\nKENvbHVtbiBjb2wsIGJvb2xlYW4gb3ZlcnJpZGVEZWZhdWx0KQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldE9iamVjdChjb2ws\nIG51bGwsIGNvbC5nZXRKYXZhVHlwZSgpLCBvdmVycmlkZURlZmF1bHQpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE51bWJlcihDb2x1bW4gY29sLCBO\ndW1iZXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHNldE9iamVjdChjb2wsIHZhbCwgSmF2YVR5cGVzLk5VTUJFUiwgZmFs\nc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJhdyhDb2x1bW4gY29s\nLCBTdHJpbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHNldE9iamVjdChjb2wsIHZhbCwgUkFXLCBmYWxzZSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0U2hvcnQoQ29sdW1uIGNvbCwgc2hvcnQg\ndmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndE9iamVjdChjb2wsIG5ldyBTaG9ydCh2YWwpLCBKYXZhVHlwZXMuU0hPUlQs\nIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTdHJpbmcoQ29s\ndW1uIGNvbCwgU3RyaW5nIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzZXRPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5T\nVFJJTkcsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1l\nKENvbHVtbiBjb2wsIFRpbWUgdmFsLCBDYWxlbmRhciBjYWwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG9iajsKICAg\nICAgICBpZiAodmFsID09IG51bGwgfHwgY2FsID09IG51bGwpCiAgICAgICAg\nICAgIG9iaiA9IHZhbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG9iaiA9\nIG5ldyBDYWxlbmRhcmQodmFsLCBjYWwpOwogICAgICAgIHNldE9iamVjdChj\nb2wsIG9iaiwgSmF2YVNRTFR5cGVzLlRJTUUsIGZhbHNlKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRUaW1lc3RhbXAoQ29sdW1uIGNvbCwgVGltZXN0\nYW1wIHZhbCwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgaWYgKHZhbCA9\nPSBudWxsIHx8IGNhbCA9PSBudWxsKQogICAgICAgICAgICBvYmogPSB2YWw7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBvYmogPSBuZXcgQ2FsZW5kYXJk\nKHZhbCwgY2FsKTsKICAgICAgICBzZXRPYmplY3QoY29sLCBvYmosIEphdmFT\nUUxUeXBlcy5USU1FU1RBTVAsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRPYmplY3QoQ29sdW1uIGNvbCwgT2JqZWN0IHZhbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsIGluc3Rh\nbmNlb2YgUmF3KQogICAgICAgICAgICBzZXRPYmplY3QoY29sLCB2YWwsIFJB\nVywgZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0T2JqZWN0\nKGNvbCwgdmFsLCBjb2wuZ2V0SmF2YVR5cGUoKSwgZmFsc2UpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHdoZXJlQXJyYXkoQ29sdW1uIGNvbCwgQXJyYXkg\ndmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdo\nZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuU1FMX0FSUkFZKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZUFzY2lpU3RyZWFtKENvbHVt\nbiBjb2wsIElucHV0U3RyZWFtIHZhbCwgaW50IGxlbmd0aCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2ws\nICh2YWwgPT0gbnVsbCkgPyBudWxsIDogbmV3IFNpemVkKHZhbCwgbGVuZ3Ro\nKSwKICAgICAgICAgICAgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVCaWdEZWNpbWFsKENvbHVtbiBj\nb2wsIEJpZ0RlY2ltYWwgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMu\nQklHREVDSU1BTCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVCaWdJ\nbnRlZ2VyKENvbHVtbiBjb2wsIEJpZ0ludGVnZXIgdmFsKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwg\ndmFsLCBKYXZhVHlwZXMuQklHSU5URUdFUik7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmVCaW5hcnlTdHJlYW0oQ29sdW1uIGNvbCwgSW5wdXRTdHJl\nYW0gdmFsLCBpbnQgbGVuZ3RoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgKHZhbCA9PSBudWxsKSA/\nIG51bGwgOiBuZXcgU2l6ZWQodmFsLCBsZW5ndGgpLAogICAgICAgICAgICBK\nYXZhU1FMVHlwZXMuQklOQVJZX1NUUkVBTSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmVCbG9iKENvbHVtbiBjb2wsIEJsb2IgdmFsKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNv\nbCwgdmFsLCBKYXZhU1FMVHlwZXMuQkxPQik7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmVCb29sZWFuKENvbHVtbiBjb2wsIGJvb2xlYW4gdmFsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2Jq\nZWN0KGNvbCwgKCh2YWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRSksCiAgICAgICAgICAgIEphdmFUeXBlcy5CT09MRUFOKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB3aGVyZUJ5dGUoQ29sdW1uIGNvbCwgYnl0ZSB2YWwp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hlcmVP\nYmplY3QoY29sLCBuZXcgQnl0ZSh2YWwpLCBKYXZhVHlwZXMuQllURSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVCeXRlcyhDb2x1bW4gY29sLCBi\neXRlW10gdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhU1FMVHlwZXMuQllURVMp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQ2FsZW5kYXIoQ29sdW1u\nIGNvbCwgQ2FsZW5kYXIgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMu\nQ0FMRU5EQVIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlQ2hhcihD\nb2x1bW4gY29sLCBjaGFyIHZhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2wsIG5ldyBDaGFyYWN0ZXIo\ndmFsKSwgSmF2YVR5cGVzLkNIQVIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdoZXJlQ2hhcmFjdGVyU3RyZWFtKENvbHVtbiBjb2wsIFJlYWRlciB2YWws\nIGludCBsZW5ndGgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgd2hlcmVPYmplY3QoY29sLCAodmFsID09IG51bGwpID8gbnVsbCA6\nIG5ldyBTaXplZCh2YWwsIGxlbmd0aCksCiAgICAgICAgICAgIEphdmFTUUxU\neXBlcy5DSEFSX1NUUkVBTSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmVDbG9iKENvbHVtbiBjb2wsIENsb2IgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBK\nYXZhU1FMVHlwZXMuQ0xPQik7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hl\ncmVEYXRlKENvbHVtbiBjb2wsIERhdGUgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBK\nYXZhVHlwZXMuREFURSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVE\nYXRlKENvbHVtbiBjb2wsIGphdmEuc3FsLkRhdGUgdmFsLCBDYWxlbmRhciBj\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgT2Jq\nZWN0IG9iajsKICAgICAgICBpZiAodmFsID09IG51bGwgfHwgY2FsID09IG51\nbGwpCiAgICAgICAgICAgIG9iaiA9IHZhbDsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIG9iaiA9IG5ldyBDYWxlbmRhcmQodmFsLCBjYWwpOwogICAgICAg\nIHdoZXJlT2JqZWN0KGNvbCwgb2JqLCBKYXZhU1FMVHlwZXMuU1FMX0RBVEUp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlRG91YmxlKENvbHVtbiBj\nb2wsIGRvdWJsZSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgd2hlcmVPYmplY3QoY29sLCBuZXcgRG91YmxlKHZhbCksIEph\ndmFUeXBlcy5ET1VCTEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJl\nRmxvYXQoQ29sdW1uIGNvbCwgZmxvYXQgdmFsKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgbmV3IEZs\nb2F0KHZhbCksIEphdmFUeXBlcy5GTE9BVCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmVJbnQoQ29sdW1uIGNvbCwgaW50IHZhbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB3aGVyZU9iamVjdChjb2ws\nIE51bWJlcnMudmFsdWVPZih2YWwpLCBKYXZhVHlwZXMuSU5UKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB3aGVyZUxvbmcoQ29sdW1uIGNvbCwgbG9uZyB2\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hl\ncmVPYmplY3QoY29sLCBOdW1iZXJzLnZhbHVlT2YodmFsKSwgSmF2YVR5cGVz\nLkxPTkcpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlTG9jYWxlKENv\nbHVtbiBjb2wsIExvY2FsZSB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIEphdmFUeXBl\ncy5MT0NBTEUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlTnVsbChD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIHdoZXJlT2JqZWN0KGNvbCwgbnVsbCwgY29sLmdldEphdmFUeXBlKCkp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlTnVtYmVyKENvbHVtbiBj\nb2wsIE51bWJlciB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIEphdmFUeXBlcy5OVU1C\nRVIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlUmF3KENvbHVtbiBj\nb2wsIFN0cmluZyB2YWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIFJBVyk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgd2hlcmVTaG9ydChDb2x1bW4gY29sLCBzaG9ydCB2\nYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgd2hl\ncmVPYmplY3QoY29sLCBuZXcgU2hvcnQodmFsKSwgSmF2YVR5cGVzLlNIT1JU\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVN0cmluZyhDb2x1bW4g\nY29sLCBTdHJpbmcgdmFsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBKYXZhVHlwZXMuU1RS\nSU5HKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVRpbWUoQ29sdW1u\nIGNvbCwgVGltZSB2YWwsIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgIGlm\nICh2YWwgPT0gbnVsbCB8fCBjYWwgPT0gbnVsbCkKICAgICAgICAgICAgb2Jq\nID0gdmFsOwogICAgICAgIGVsc2UKICAgICAgICAgICAgb2JqID0gbmV3IENh\nbGVuZGFyZCh2YWwsIGNhbCk7CiAgICAgICAgd2hlcmVPYmplY3QoY29sLCBv\nYmosIEphdmFTUUxUeXBlcy5USU1FKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB3aGVyZVRpbWVzdGFtcChDb2x1bW4gY29sLCBUaW1lc3RhbXAgdmFsLCBD\nYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgT2JqZWN0IG9iajsKICAgICAgICBpZiAodmFsID09IG51bGwgfHwg\nY2FsID09IG51bGwpCiAgICAgICAgICAgIG9iaiA9IHZhbDsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIG9iaiA9IG5ldyBDYWxlbmRhcmQodmFsLCBjYWwp\nOwogICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgb2JqLCBKYXZhU1FMVHlwZXMu\nVElNRVNUQU1QKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZU9iamVj\ndChDb2x1bW4gY29sLCBPYmplY3QgdmFsKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBSYXcpCiAg\nICAgICAgICAgIHdoZXJlT2JqZWN0KGNvbCwgdmFsLCBSQVcpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgd2hlcmVPYmplY3QoY29sLCB2YWwsIGNvbC5n\nZXRKYXZhVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCBzZXQg\nY29sdW1uIG1ldGhvZHMgZGVsZWdhdGUgdG8gdGhpcyBvbmUuIFNldCB0aGUg\nZ2l2ZW4gb2JqZWN0CiAgICAgKiB1bmxlc3MgdGhpcyBpcyBhbiBpbnNlcnQg\nYW5kIHRoZSBnaXZlbiBjb2x1bW4gaXMgYXV0by1hc3NpZ25lZC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgc2V0T2JqZWN0KENvbHVtbiBjb2wsIE9i\namVjdCB2YWwsIGludCBtZXRhVHlwZSwKICAgICAgICBib29sZWFuIG92ZXJy\naWRlRGVmYXVsdCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBuZXZlciBzZXQgYXV0byBpbmNyZW1lbnQgY29sdW1ucyBhbmQg\naG9ub3IgY29sdW1uIGRlZmF1bHRzCiAgICAgICAgaWYgKF9hY3Rpb24gPT0g\nQUNUSU9OX0lOU0VSVCkgewogICAgICAgICAgICBpZiAoY29sLmlzQXV0b0Fz\nc2lnbmVkKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIGlmICghb3ZlcnJpZGVEZWZhdWx0ICYmIHZhbCA9PSBudWxsIAogICAgICAg\nICAgICAgICAgJiYgY29sLmdldERlZmF1bHRTdHJpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAo\ndmFsID09IG51bGwgJiYgY29sLmlzTm90TnVsbCgpKQogICAgICAgICAgICB2\nYWwgPSBKYXZhU1FMVHlwZXMuZ2V0RW1wdHlWYWx1ZShjb2wuZ2V0SmF2YVR5\ncGUoKSk7CiAgICAgICAgZmx1c2goY29sLCB2YWwsIG1ldGFUeXBlLCB0cnVl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbCB3aGVyZSBjb2x1bW4gbWV0\naG9kcyBkZWxlZ2F0ZSB0byB0aGlzIG9uZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgd2hlcmVPYmplY3QoQ29sdW1uIGNvbCwgT2JqZWN0IHZhbCwg\naW50IG1ldGFUeXBlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGZsdXNoKGNvbCwgdmFsLCBtZXRhVHlwZSwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogRmx1c2ggdGhlIGdpdmVuIHZhbHVlIGFzIGEg\nc2V0IG9yIHdoZXJlIGNvbmRpdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGZsdXNoKENvbHVtbiBjb2wsIE9iamVjdCB2YWwsIGludCBtZXRhVHlw\nZSwgYm9vbGVhbiBzZXQpIHsKICAgICAgICBpbnQgaWR4ID0gKHNldCkgPyBn\nZXRTZXRJbmRleChjb2wpIDogZ2V0V2hlcmVJbmRleChjb2wpOwogICAgICAg\nIF90eXBlc1tpZHhdID0gbWV0YVR5cGU7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICBfdmFsc1tpZHhdID0gTlVMTDsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIF92YWxzW2lkeF0gPSB2YWw7CiAgICAgICAgaWYg\nKHNldCB8fCBfYWN0aW9uID09IEFDVElPTl9ERUxFVEUpCiAgICAgICAgICAg\nIHNldFZhbGlkKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBTUUwgZm9yIHRoZSBvcGVyYXRpb24gb24gdGhpcyByb3cuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U1FMKERCRGljdGlvbmFyeSBkaWN0\nKSB7CiAgICAgICAgaWYgKCFpc1ZhbGlkKCkpCiAgICAgICAgICAgIHJldHVy\nbiAiIjsKICAgICAgICBpZiAoX3NxbCA9PSBudWxsKQogICAgICAgICAgICBf\nc3FsID0gZ2VuZXJhdGVTUUwoZGljdCk7CiAgICAgICAgcmV0dXJuIF9zcWw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgU1FMIGZvciB0\naGlzIHJvdzsgdGhlIHJlc3VsdCBvZiB0aGlzIG1ldGhvZCBpcyBjYWNoZWQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2VuZXJhdGVTUUwoREJE\naWN0aW9uYXJ5IGRpY3QpIHsKICAgICAgICBzd2l0Y2ggKGdldEFjdGlvbigp\nKSB7CiAgICAgICAgICAgIGNhc2UgQUNUSU9OX1VQREFURToKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRVcGRhdGVTUUwoZGljdCk7CiAgICAgICAgICAg\nIGNhc2UgQUNUSU9OX0lOU0VSVDoKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRJbnNlcnRTUUwoZGljdCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0RGVsZXRlU1FMKGRpY3QpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZvciBh\nIHByZXBhcmVkIHN0YXRlbWVudCB1cGRhdGUgb24gdGhpcyByb3cuCiAgICAg\nKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldFVwZGF0ZVNRTChEQkRpY3Rpb25h\ncnkgZGljdCkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3Ry\naW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiVVBEQVRFICIpLmFw\ncGVuZChkaWN0LmdldEZ1bGxOYW1lKGdldFRhYmxlKCksIGZhbHNlKSkuCiAg\nICAgICAgICAgIGFwcGVuZCgiIFNFVCAiKTsKCiAgICAgICAgQ29sdW1uW10g\nY29scyA9IGdldFRhYmxlKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGJvb2xl\nYW4gaGFzVmFsID0gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfdmFsc1tp\nXSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICBpZiAoaGFzVmFsKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nLCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChjb2xzW2ldKTsKICAgICAg\nICAgICAgaWYgKF90eXBlc1tpXSA9PSBSQVcpCiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgPSAiKS5hcHBlbmQoX3ZhbHNbaV0pOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgPSA/Iik7CiAg\nICAgICAgICAgIGhhc1ZhbCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBh\ncHBlbmRXaGVyZShidWYpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZvciBh\nIHByZXBhcmVkIHN0YXRlbWVudCBpbnNlcnQgb24gdGhpcyByb3cuCiAgICAg\nKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEluc2VydFNRTChEQkRpY3Rpb25h\ncnkgZGljdCkgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3Ry\naW5nQnVmZmVyKCk7CiAgICAgICAgU3RyaW5nQnVmZmVyIHZhbHMgPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiSU5TRVJUIElO\nVE8gIikuCiAgICAgICAgICAgIGFwcGVuZChkaWN0LmdldEZ1bGxOYW1lKGdl\ndFRhYmxlKCksIGZhbHNlKSkuYXBwZW5kKCIgKCIpOwoKICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gZ2V0VGFibGUoKS5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nYm9vbGVhbiBoYXNWYWwgPSBmYWxzZTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKF92\nYWxzW2ldID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIGlmIChoYXNWYWwpIHsKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiwgIik7CiAgICAgICAgICAgICAgICB2YWxzLmFwcGVuZCgiLCAi\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKGNvbHNb\naV0pOwogICAgICAgICAgICBpZiAoX3R5cGVzW2ldID09IFJBVykKICAgICAg\nICAgICAgICAgIHZhbHMuYXBwZW5kKF92YWxzW2ldKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgdmFscy5hcHBlbmQoIj8iKTsKICAgICAg\nICAgICAgaGFzVmFsID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJ1Zi5h\ncHBlbmQoIikgVkFMVUVTICgiKS5hcHBlbmQodmFscy50b1N0cmluZygpKS5h\ncHBlbmQoIikiKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgYSBwcmVw\nYXJlZCBzdGF0ZW1lbnQgZGVsZXRlIG9uIHRoaXMgcm93LgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyBnZXREZWxldGVTUUwoREJEaWN0aW9uYXJ5IGRp\nY3QpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1\nZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkRFTEVURSBGUk9NICIpLgog\nICAgICAgICAgICBhcHBlbmQoZGljdC5nZXRGdWxsTmFtZShnZXRUYWJsZSgp\nLCBmYWxzZSkpOwogICAgICAgIGFwcGVuZFdoZXJlKGJ1Zik7CiAgICAgICAg\ncmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQXBwZW5kcyB0aGUgd2hlcmUgY2xhdXNlIG9udG8gdGhlIGdpdmVuIHNxbCBi\ndWZmZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRXaGVyZShT\ndHJpbmdCdWZmZXIgYnVmKSB7CiAgICAgICAgQ29sdW1uW10gY29scyA9IGdl\ndFRhYmxlKCkuZ2V0Q29sdW1ucygpOwogICAgICAgIGJvb2xlYW4gaGFzV2hl\ncmUgPSBmYWxzZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKF92YWxzW2dldFdoZXJl\nSW5kZXgoY29sc1tpXSldID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIGlmICghaGFzV2hlcmUpCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgV0hFUkUgIik7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CgogICAgICAg\nICAgICAvLyBzcWxzZXJ2ZXIgc2VlbXMgdG8gaGF2ZSBwcm9ibGVtcyB1c2lu\nZyBudWxsIHBhcmFtZXRlcnMgaW4gdGhlCiAgICAgICAgICAgIC8vIHdoZXJl\nIGNsYXVzZQogICAgICAgICAgICBpZiAoX3ZhbHNbZ2V0V2hlcmVJbmRleChj\nb2xzW2ldKV0gPT0gTlVMTCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nY29sc1tpXSkuYXBwZW5kKCIgSVMgTlVMTCIpOwogICAgICAgICAgICBlbHNl\nIGlmIChfdHlwZXNbaV0gPT0gUkFXKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZChjb2xzW2ldKS5hcHBlbmQoIiA9ICIpLmFwcGVuZChfdmFsc1tpXSk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nY29sc1tpXSkuYXBwZW5kKCIgPSA/Iik7CiAgICAgICAgICAgIGhhc1doZXJl\nID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nbnVtYmVyIG9mIHBhcmFtZXRlcnMgdGhhdCB3aWxsIGJlIHNldCBmb3IgdGhp\ncyByb3cuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UGFyYW1ldGVyQ291\nbnQoKSB7CiAgICAgICAgcmV0dXJuIF92YWxzLmxlbmd0aDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEZsdXNoIHRoZSByb3cncyB2YWx1ZXMgdG8gdGhlIGdp\ndmVuIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgZmx1c2goUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIERCRGljdGlvbmFy\neSBkaWN0LAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBmbHVzaChzdG1udCwgMSwgZGlj\ndCwgc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggdGhlIHJv\ndydzIHZhbHVlcyB0byB0aGUgZ2l2ZW4gcHJlcGFyZWQgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBmbHVzaChQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgREJEaWN0aW9uYXJ5IGRpY3QsCiAgICAgICAg\nSkRCQ1N0b3JlIHN0b3JlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIENvbHVtbltdIGNvbHMgPSBnZXRUYWJsZSgpLmdldENvbHVt\nbnMoKTsKCiAgICAgICAgLy8gdGhpcyBzaW1wbGUgbWV0aG9kIHdvcmtzIGJl\nY2F1c2UgdGhlIFNRTCBpcyBhbHdheXMgcHJlcGFyZWQKICAgICAgICAvLyBi\nYXNlZCBvbiB0aGUgaW5kZXhpbmcgb2YgdGhlIGNvbHVtbnMgaW4gdGhlIHRh\nYmxlIG9iamVjdCAtLSB0aGUKICAgICAgICAvLyBzYW1lIG9yZGVyaW5nIHdl\nIHVzZSB3aGVuIHN0b3JpbmcgdmFsdWVzIGFuZCBtZXRhIHR5cGVzLiBza2lw\nCiAgICAgICAgLy8gdXBkYXRlcyB3aGVuIHNldHRpbmcgcGFyYW1zIGZvciBE\nRUxFVEVzOyB0aGUgdXBkYXRlcyBhcmUganVzdCB0aGVyZQogICAgICAgIC8v\nIHRvIGxldCB1cyBldmFsIGZrIGNvbnN0cmFpbnRzCiAgICAgICAgaW50IGkg\nPSAoZ2V0QWN0aW9uKCkgPT0gQUNUSU9OX0RFTEVURSkgPyBjb2xzLmxlbmd0\naCA6IDA7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBPYmplY3QgdmFs\nOwogICAgICAgIGludCBoYWxmID0gX3ZhbHMubGVuZ3RoIC8gMjsKICAgICAg\nICBmb3IgKDsgaSA8IF92YWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChfdmFsc1tpXSA9PSBudWxsKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICAvLyB3ZSBkb24ndCBzZXQgbnVsbCBwYXJhbXMg\naW4gdGhlIFdIRVJFIGNsYXVzZTsgd2UgdXNlIHRoZSBOVUxMCiAgICAgICAg\nICAgIC8vIGtleXdvcmQgaW5zdGVhZCB0byBzYXRpc2Z5IHNxbHNlcnZlcgog\nICAgICAgICAgICBpZiAoX3ZhbHNbaV0gPT0gTlVMTCAmJiBnZXRBY3Rpb24o\nKSAhPSBBQ1RJT05fSU5TRVJUICYmIGkgPj0gaGFsZikKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBhbiB1\ncGRhdGUgdGhlIHZhbHMgYXJyYXkgd2lsbCBiZSAyIHggdGhlIGNvbHMKICAg\nICAgICAgICAgLy8gYXJyYXkgbGVuZ3RoOyBpdCByZXBlYXRzIGZvciB3aGVy\nZSB2YWx1ZXMKICAgICAgICAgICAgaWYgKGkgPCBjb2xzLmxlbmd0aCkKICAg\nICAgICAgICAgICAgIGNvbCA9IGNvbHNbaV07CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIGNvbCA9IGNvbHNbaSAtIGNvbHMubGVuZ3RoXTsK\nCiAgICAgICAgICAgIHZhbCA9IF92YWxzW2ldOwogICAgICAgICAgICBpZiAo\ndmFsID09IE5VTEwpCiAgICAgICAgICAgICAgICB2YWwgPSBudWxsOwoKICAg\nICAgICAgICAgaWYgKHZhbCA9PSBudWxsIHx8IF90eXBlc1tpXSAhPSBSQVcp\nIHsKICAgICAgICAgICAgICAgIGRpY3Quc2V0VHlwZWQoc3RtbnQsIGlkeCwg\ndmFsLCBjb2wsIF90eXBlc1tpXSwgc3RvcmUpOwogICAgICAgICAgICAgICAg\naWR4Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgYXJyYXkgdmFsdWUgYXJyYXkgaW5kZXggZm9yIHRoZSBn\naXZlbiBjb2x1bW4ncyB2YWx1ZS4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQg\nZ2V0U2V0SW5kZXgoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBjb2wu\nZ2V0SW5kZXgoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBhcnJheSB2\nYWx1ZSBhcnJheSBpbmRleCBmb3IgdGhlIGdpdmVuIGNvbHVtbidzIHZhbHVl\nLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRXaGVyZUluZGV4KENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gY29sLmdldEluZGV4KCkgKyBnZXRU\nYWJsZSgpLmdldENvbHVtbnMoKS5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQZXJmb3JtcyBhIHByb3BlciBkZWVwIGNsb25lLgogICAgICovCiAg\nICBwdWJsaWMgT2JqZWN0IGNsb25lKCkgewogICAgICAgIFJvd0ltcGwgY2xv\nbmUgPSBuZXdJbnN0YW5jZShnZXRUYWJsZSgpLCBnZXRBY3Rpb24oKSk7CiAg\nICAgICAgY29weUludG8oY2xvbmUsIGZhbHNlKTsKICAgICAgICByZXR1cm4g\nY2xvbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgcm93\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgUm93SW1wbCBuZXdJbnN0YW5jZShU\nYWJsZSB0YWJsZSwgaW50IGFjdGlvbikgewogICAgICAgIHJldHVybiBuZXcg\nUm93SW1wbCh0YWJsZSwgYWN0aW9uKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvcHkgYWxsIHZhbHVlcyBmcm9tIHRoaXMgcm93IGludG8gdGhlIGdpdmVu\nIG9uZS4KICAgICAqCiAgICAgKiBAcGFyYW0gd2hlcmVPbmx5IGlmIHRydWUs\nIG9ubHkgY29weSB3aGVyZSBjb25kaXRpb25zCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGNvcHlJbnRvKFJvd0ltcGwgcm93LCBib29sZWFuIHdoZXJlT25s\neSkgewogICAgICAgIGludCBhY3Rpb24gPSBnZXRBY3Rpb24oKTsKICAgICAg\nICBpbnQgcm93QWN0aW9uID0gcm93LmdldEFjdGlvbigpOwoKICAgICAgICBp\nbnQgc3RhcnQ7CiAgICAgICAgaW50IGxlbjsKICAgICAgICBpZiAod2hlcmVP\nbmx5KSB7CiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gQUNUSU9OX0lOU0VS\nVCB8fCByb3dBY3Rpb24gPT0gQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAg\nICAgIHN0YXJ0ID0gbGVuID0gMDsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgc3RhcnQgPSBsZW4gPSBfdmFscy5sZW5ndGggLyAyOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXJ0ID0gMDsKICAgICAgICAg\nICAgaWYgKHJvd0FjdGlvbiA9PSBBQ1RJT05fSU5TRVJUICYmIGFjdGlvbiAh\nPSBBQ1RJT05fSU5TRVJUKQogICAgICAgICAgICAgICAgbGVuID0gX3ZhbHMu\nbGVuZ3RoIC8gMjsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nbGVuID0gX3ZhbHMubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgU3lzdGVt\nLmFycmF5Y29weShfdmFscywgc3RhcnQsIHJvdy5fdmFscywgc3RhcnQsIGxl\nbik7CiAgICAgICAgU3lzdGVtLmFycmF5Y29weShfdHlwZXMsIHN0YXJ0LCBy\nb3cuX3R5cGVzLCBzdGFydCwgbGVuKTsKICAgICAgICBpZiAoaXNWYWxpZCgp\nKQogICAgICAgICAgICByb3cuc2V0VmFsaWQodHJ1ZSk7CiAgICB9Cn0KCg==\n","encoding":"base64"}

