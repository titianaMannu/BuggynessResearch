{"sha":"ccf0699acb3582aeb38aef22dd8ca5019594bdaf","node_id":"MDQ6QmxvYjIwNjM2NDpjY2YwNjk5YWNiMzU4MmFlYjM4YWVmMjJkZDhjYTUwMTk1OTRiZGFm","size":20989,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ccf0699acb3582aeb38aef22dd8ca5019594bdaf","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5kYXRhY2FjaGU7CgppbXBvcnQgamF2YS5pby5PYmplY3RTdHJl\nYW1FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1w\nb3J0IGphdmEudXRpbC5BYnN0cmFjdExpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7\nCmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTGV2ZWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29u\ndGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVR\ndWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5B\nZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIucm9wLkxpc3RSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFBy\nb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9i\namVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGlsLk51bWJl\ncnM7CgovKioKICogQSB7QGxpbmsgU3RvcmVRdWVyeX0gaW1wbGVtZW50YXRp\nb24gdGhhdCBjYWNoZXMgdGhlIE9JRHMgaW52b2x2ZWQgaW4KICogdGhlIHF1\nZXJ5LCBhbmQgY2FuIGRldGVybWluZSB3aGV0aGVyIG9yIG5vdCB0aGUgcXVl\ncnkgaGFzIGJlZW4gZGlydGllZC4KICoKICogQGF1dGhvciBQYXRyaWNrIExp\nbnNrZXkKICogQHNpbmNlIDAuMi41LjAKICovCnB1YmxpYyBjbGFzcyBRdWVy\neUNhY2hlU3RvcmVRdWVyeQogICAgaW1wbGVtZW50cyBTdG9yZVF1ZXJ5IHsK\nCiAgICBwcml2YXRlIGZpbmFsIFN0b3JlUXVlcnkgX3F1ZXJ5OwogICAgcHJp\ndmF0ZSBmaW5hbCBRdWVyeUNhY2hlIF9jYWNoZTsKICAgIHByaXZhdGUgU3Rv\ncmVDb250ZXh0IF9zY3R4OwogICAgcHJpdmF0ZSBNZXRhRGF0YVJlcG9zaXRv\ncnkgX3JlcG9zOwoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGluc3Rh\nbmNlIHRoYXQgZGVsZWdhdGVzIHRvIDxjb2RlPnF1ZXJ5PC9jb2RlPiBpZiBu\nbwogICAgICogY2FjaGVkIHJlc3VsdHMgYXJlIGF2YWlsYWJsZS4KICAgICAq\nLwogICAgcHVibGljIFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KFN0b3JlUXVlcnkg\ncXVlcnksIFF1ZXJ5Q2FjaGUgY2FjaGUpIHsKICAgICAgICBfcXVlcnkgPSBx\ndWVyeTsKICAgICAgICBfY2FjaGUgPSBjYWNoZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUge0BsaW5rIFF1ZXJ5Q2FjaGV9IHRoYXQgdGhp\ncyBvYmplY3QgaXMgYXNzb2NpYXRlZCB3aXRoLgogICAgICovCiAgICBwdWJs\naWMgUXVlcnlDYWNoZSBnZXRDYWNoZSgpIHsKICAgICAgICByZXR1cm4gX2Nh\nY2hlOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IGdldERlbGVnYXRlKCkgewogICAgICAg\nIHJldHVybiBfcXVlcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb29rIGlu\nIHRoZSBxdWVyeSBjYWNoZSBmb3IgYSByZXN1bHQgZm9yIHRoZSBnaXZlbiBx\ndWVyeQogICAgICoga2V5LiBPbmx5IGxvb2sgaWYgdGhpcyBxdWVyeSBpcyBi\nZWluZyBleGVjdXRlZCBvdXRzaWRlIGEKICAgICAqIHRyYW5zYWN0aW9uIG9y\nIGluIGEgdHJhbnNhY3Rpb24gd2l0aCBJZ25vcmVDaGFuZ2VzIHNldCB0byB0\ncnVlCiAgICAgKiBvciBpbiBhIHRyYW5zYWN0aW9uIHdpdGggSWdub3JlQ2hh\nbmdlcyBzZXQgdG8gZmFsc2UgYnV0IGluIHdoaWNoCiAgICAgKiBub25lIG9m\nIHRoZSBjbGFzc2VzIGludm9sdmVkIGluIHRoaXMgcXVlcnkgaGF2ZSBiZWVu\nIHRvdWNoZWQuCiAgICAgKiAgQ2FjaGluZyBpcyBub3QgdXNlZCB3aGVuIHVz\naW5nIG9iamVjdCBsb2NraW5nLgogICAgICogVGhpcyBpcyBiZWNhdXNlIHdl\nIG11c3Qgb2J0YWluIGxvY2tzIG9uIHRoZQogICAgICogZGF0YSwgYW5kIGl0\nIGlzIGxpa2VseSB0aGF0IG1ha2luZyBuIHRyaXBzIHRvIHRoZSBkYXRhYmFz\nZSB0bwogICAgICogbWFrZSB0aGUgbG9ja3Mgd2lsbCBiZSBzbG93ZXIgdGhh\nbiBydW5uaW5nIHRoZSBxdWVyeSBhZ2FpbnN0CiAgICAgKiB0aGUgZGF0YWJh\nc2UuCiAgICAgKiAgSWYgdGhlIGZldGNoIGNvbmZpZ3VyYXRpb24gaGFzIHF1\nZXJ5IGNhY2hpbmcgZGlzYWJsZWQsCiAgICAgKiB0aGVuIHRoaXMgbWV0aG9k\nIHJldHVybnMgPGNvZGU+bnVsbDwvY29kZT4uCiAgICAgKiAgUmV0dXJuIHRo\nZSBsaXN0IGlmIHdlIG1lZXQgdGhlIGFib3ZlIGNyaXRlcmlhIGFuZCBpZiBh\nIGxpc3QKICAgICAqIGlzIGZvdW5kIGZvciA8Y29kZT5xazwvY29kZT4uIEVs\nc2UsIHJldHVybgogICAgICogPGNvZGU+bnVsbDwvY29kZT4uCiAgICAgKiAg\nVGhpcyBpbXBsZW1lbnRhdGlvbiBtZWFucyB0aGF0IHF1ZXJpZXMgYWdhaW5z\ndCB0aGUgY2FjaGUKICAgICAqIGFyZSBvZiBSRUFEX0NPTU1JVFRFRCBpc29s\nYXRpb24gbGV2ZWwuIEl0J2QgYmUgbmljZSB0byBzdXBwb3J0CiAgICAgKiBS\nRUFEX1NFUklBTElaQUJMRSAtLSB0byBkbyBzbywgd2UnZCBqdXN0IHJldHVy\nbiBmYWxzZSB3aGVuIGluCiAgICAgKiBhIHRyYW5zYWN0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIExpc3QgY2hlY2tDYWNoZShRdWVyeUtleSBxaykgewog\nICAgICAgIGlmIChxayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBnZXRDb250\nZXh0KCkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKCFm\nZXRjaC5nZXRRdWVyeUNhY2hlKCkpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIGlmIChmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkgPiBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIGdldCB0aGUgY2FjaGVkIG9pZHMKICAgICAgICBRdWVyeVJl\nc3VsdCByZXMgPSBfY2FjaGUuZ2V0KHFrKTsKICAgICAgICBpZiAocmVzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChy\nZXMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVDsKCiAgICAgICAgaW50IHByb2pzID0gZ2V0Q29udGV4dCgp\nLmdldFByb2plY3Rpb25BbGlhc2VzKCkubGVuZ3RoOwogICAgICAgIGlmIChw\ncm9qcyA9PSAwKSB7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZGF0\nYSBjYWNoZSBjb250YWlucyB0aGUgb2lkcyBmb3IgdGhlIHF1ZXJ5IHJlc3Vs\ndDsKICAgICAgICAgICAgLy8gaWYgaXQgZG9lc24ndCwgdGhlbiB1c2luZyB0\naGUgcmVzdWx0IGNvdWxkIGJlIHNsb3dlciB0aGFuIG5vdAogICAgICAgICAg\nICAvLyB1c2luZyBpdCBiZWNhdXNlbyBvZiB0aGUgaW5kaXZpZHVhbCBieS1v\naWQgbG9va3VwcwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBf\ncmVwb3MuZ2V0TWV0YURhdGEoZ2V0Q29udGV4dCgpLgogICAgICAgICAgICAg\nICAgZ2V0Q2FuZGlkYXRlVHlwZSgpLCBfc2N0eC5nZXRDbGFzc0xvYWRlcigp\nLCB0cnVlKTsKICAgICAgICAgICAgQml0U2V0IGlkeHMgPSBtZXRhLmdldERh\ndGFDYWNoZSgpLmNvbnRhaW5zQWxsKHJlcyk7CgogICAgICAgICAgICAvLyBl\ndmVudHVhbGx5IHdlIHNob3VsZCBvcHRpbWl6ZSB0aGlzIHRvIGZpZ3VyZSBv\ndXQgaG93IG1hbnkgb2JqZWN0cwogICAgICAgICAgICAvLyB0aGUgY2FjaGUg\naXMgbWlzc2luZyBhbmQgaWYgb25seSBhIGZldyBkbyBhIGJ1bGsgZmV0Y2gg\nZm9yIHRoZW0KICAgICAgICAgICAgaW50IGxlbiA9IGlkeHMubGVuZ3RoKCk7\nCiAgICAgICAgICAgIGlmIChsZW4gPCByZXMuc2l6ZSgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoIWlkeHMuZ2V0\nKGkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gbmV3IENhY2hlZExpc3QocmVzLCBwcm9qcyAh\nPSAwLCBfc2N0eCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcmFwIHRoZSBy\nZXN1bHQgb2JqZWN0IHByb3ZpZGVyIHJldHVybmVkIGJ5IG91ciBkZWxlZ2F0\nZSBpbiBhCiAgICAgKiBjYWNoaW5nIHByb3ZpZGVyLgogICAgICovCiAgICBw\ncml2YXRlIFJlc3VsdE9iamVjdFByb3ZpZGVyIHdyYXBSZXN1bHQoUmVzdWx0\nT2JqZWN0UHJvdmlkZXIgcm9wLAogICAgICAgIFF1ZXJ5S2V5IGtleSkgewog\nICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJv\ncDsKICAgICAgICByZXR1cm4gbmV3IENhY2hpbmdSZXN1bHRPYmplY3RQcm92\naWRlcihyb3AsIGdldENvbnRleHQoKS4KICAgICAgICAgICAgZ2V0UHJvamVj\ndGlvbkFsaWFzZXMoKS5sZW5ndGggPiAwLCBrZXkpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29weSBhIHByb2plY3Rpb24gZWxlbWVudCBmb3IgY2FjaGlu\nZyAvIHJldHVybmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2Jq\nZWN0IGNvcHlQcm9qZWN0aW9uKE9iamVjdCBvYmosIFN0b3JlQ29udGV4dCBj\ndHgpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIHN3aXRjaCAoSmF2YVR5cGVzLmdldFR5cGVD\nb2RlKG9iai5nZXRDbGFzcygpKSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TVFJJTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xF\nQU5fT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nR19PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICAgICAgcmV0dXJuIG9i\najsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAg\nICAgICAgIHJldHVybiAoKERhdGUpIG9iaikuY2xvbmUoKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAgICAgICAgICAgICAgcmV0\ndXJuICgoTG9jYWxlKSBvYmopLmNsb25lKCk7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgQ2FjaGVk\nT2JqZWN0SWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZyb21PYmpl\nY3RJZCgoKENhY2hlZE9iamVjdElkKSBvYmopLm9pZCwgY3R4KTsKICAgICAg\nICAgICAgICAgIE9iamVjdCBvaWQgPSBjdHguZ2V0T2JqZWN0SWQob2JqKTsK\nICAgICAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IENhY2hlZE9iamVjdElkKG9pZCk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9iamVjdCBiYXNlZCBvbiBp\ndHMgY2FjaGVkIG9pZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2Jq\nZWN0IGZyb21PYmplY3RJZChPYmplY3Qgb2lkLCBTdG9yZUNvbnRleHQgc2N0\neCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIE9iamVjdCBvYmogPSBzY3R4LmZpbmQob2lk\nLCBudWxsLCBudWxsLCBudWxsLCAwKTsKICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbihvaWQpOwogICAgICAgIHJldHVybiBvYmo7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBPYmpl\nY3RTdHJlYW1FeGNlcHRpb24gewogICAgICAgIHJldHVybiBfcXVlcnk7CiAg\nICB9CgogICAgcHVibGljIFF1ZXJ5Q29udGV4dCBnZXRDb250ZXh0KCkgewog\nICAgICAgIHJldHVybiBfcXVlcnkuZ2V0Q29udGV4dCgpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldENvbnRleHQoUXVlcnlDb250ZXh0IHFjdHgpIHsK\nICAgICAgICBfcXVlcnkuc2V0Q29udGV4dChxY3R4KTsKICAgICAgICBfc2N0\neCA9IHFjdHguZ2V0U3RvcmVDb250ZXh0KCk7CiAgICAgICAgX3JlcG9zID0g\nX3NjdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9y\neUluc3RhbmNlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2V0UXVl\ncnkoT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zZXRR\ndWVyeShxdWVyeSk7CiAgICB9CgogICAgcHVibGljIEZpbHRlckxpc3RlbmVy\nIGdldEZpbHRlckxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICByZXR1\ncm4gX3F1ZXJ5LmdldEZpbHRlckxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAg\ncHVibGljIEFnZ3JlZ2F0ZUxpc3RlbmVyIGdldEFnZ3JlZ2F0ZUxpc3RlbmVy\nKFN0cmluZyB0YWcpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldEFnZ3Jl\nZ2F0ZUxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBu\nZXdDb21waWxhdGlvbktleSgpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5l\nd0NvbXBpbGF0aW9uS2V5KCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBu\nZXdDb21waWxhdGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5ld0Nv\nbXBpbGF0aW9uKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcG9wdWxhdGVG\ncm9tQ29tcGlsYXRpb24oT2JqZWN0IGNvbXApIHsKICAgICAgICBfcXVlcnku\ncG9wdWxhdGVGcm9tQ29tcGlsYXRpb24oY29tcCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCkgewogICAgICAgIF9x\ndWVyeS5pbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9u\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNJbk1lbW9y\neUV4ZWN1dGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRz\nSW5NZW1vcnlFeGVjdXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgRXhlY3V0\nb3IgbmV3SW5NZW1vcnlFeGVjdXRvcihDbGFzc01ldGFEYXRhIG1ldGEsIGJv\nb2xlYW4gc3VicykgewogICAgICAgIHJldHVybiBfcXVlcnkubmV3SW5NZW1v\ncnlFeGVjdXRvcihtZXRhLCBzdWJzKTsKICAgIH0KCiAgICBwdWJsaWMgRXhl\nY3V0b3IgbmV3RGF0YVN0b3JlRXhlY3V0b3IoQ2xhc3NNZXRhRGF0YSBtZXRh\nLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBFeGVjdXRvciBleCA9IF9xdWVy\neS5uZXdEYXRhU3RvcmVFeGVjdXRvcihtZXRhLCBzdWJzKTsKICAgICAgICBy\nZXR1cm4gbmV3IFF1ZXJ5Q2FjaGVFeGVjdXRvcihleCwgbWV0YSwgc3Vicyk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNBYnN0cmFjdEV4\nZWN1dG9ycygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzQWJz\ndHJhY3RFeGVjdXRvcnMoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZXF1aXJlc0NhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVy\neS5yZXF1aXJlc0NhbmRpZGF0ZVR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiByZXF1aXJlc1BhcmFtZXRlckRlY2xhcmF0aW9ucygpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5LnJlcXVpcmVzUGFyYW1ldGVyRGVjbGFyYXRp\nb25zKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNQYXJh\nbWV0ZXJEZWNsYXJhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5z\ndXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9ucygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ2FjaGluZyBleGVjdXRvci4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgY2xhc3MgUXVlcnlDYWNoZUV4ZWN1dG9yCiAgICAgICAgaW1w\nbGVtZW50cyBFeGVjdXRvciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgRXhl\nY3V0b3IgX2V4OwogICAgICAgIHByaXZhdGUgZmluYWwgQ2xhc3MgX2NhbmRp\nZGF0ZTsKICAgICAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX3N1YnM7Cgog\nICAgICAgIHB1YmxpYyBRdWVyeUNhY2hlRXhlY3V0b3IoRXhlY3V0b3IgZXgs\nIENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICAgICAgYm9vbGVhbiBzdWJz\nKSB7CiAgICAgICAgICAgIF9leCA9IGV4OwogICAgICAgICAgICBfY2FuZGlk\nYXRlID0gKG1ldGEgPT0gbnVsbCkgPyBudWxsIDogbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCk7CiAgICAgICAgICAgIF9zdWJzID0gc3ViczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRl\nUXVlcnkoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAg\nICAgIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIFF1ZXJ5Q2FjaGVTdG9y\nZVF1ZXJ5IGNxID0gKFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KSBxOwogICAgICAg\nICAgICBRdWVyeUtleSBrZXkgPSBRdWVyeUtleS5uZXdJbnN0YW5jZShjcS5n\nZXRDb250ZXh0KCksCiAgICAgICAgICAgICAgICBfZXguaXNQYWNraW5nKHEp\nLCBwYXJhbXMsIF9jYW5kaWRhdGUsIF9zdWJzLCByYW5nZS5zdGFydCwgCiAg\nICAgICAgICAgICAgICByYW5nZS5lbmQpOwogICAgICAgICAgICBMaXN0IGNh\nY2hlZCA9IGNxLmNoZWNrQ2FjaGUoa2V5KTsKICAgICAgICAgICAgaWYgKGNh\nY2hlZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0\nUmVzdWx0T2JqZWN0UHJvdmlkZXIoY2FjaGVkKTsKCiAgICAgICAgICAgIFJl\nc3VsdE9iamVjdFByb3ZpZGVyIHJvcCA9IF9leC5leGVjdXRlUXVlcnkoY3Eu\nZ2V0RGVsZWdhdGUoKSwKICAgICAgICAgICAgICAgIHBhcmFtcywgcmFuZ2Up\nOwogICAgICAgICAgICByZXR1cm4gY3Eud3JhcFJlc3VsdChyb3AsIGtleSk7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDbGVhciB0aGUg\nY2FjaGVkIHF1ZXJpZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhY2Nlc3MgcGF0\naAogICAgICAgICAqIGNsYXNzZXMgaW4gdGhlIHF1ZXJ5LiBUaGlzIGlzIGRv\nbmUgd2hlbiBidWxrIG9wZXJhdGlvbnMKICAgICAgICAgKiAoc3VjaCBhcyBk\nZWxldGVzIG9yIHVwZGF0ZXMpIGFyZSBwZXJmb3JtZWQgc28gdGhhdCB0aGUK\nICAgICAgICAgKiBjYWNoZSByZW1haW5zIHVwLXRvLWRhdGUuCiAgICAgICAg\nICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGNsZWFyQWNjZXNzc1BhdGgoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIGlmIChxID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nW10gY21kID0gZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhxKTsKICAgICAgICAg\nICAgaWYgKGNtZCA9PSBudWxsIHx8IGNtZC5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIENsYXNzW10gY2xhc3Nl\ncyA9IG5ldyBDbGFzc1tjbWQubGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjbWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBjbGFzc2VzW2ldID0gY21kW2ldLmdldERlc2NyaWJlZFR5cGUoKTsKCiAg\nICAgICAgICAgIFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5IGNxID0gKFF1ZXJ5Q2Fj\naGVTdG9yZVF1ZXJ5KSBxOwogICAgICAgICAgICBjcS5nZXRDYWNoZSgpLm9u\nVHlwZXNDaGFuZ2VkKG5ldyBUeXBlc0NoYW5nZWRFdmVudAogICAgICAgICAg\nICAgICAgKHEuZ2V0Q29udGV4dCgpLCBBcnJheXMuYXNMaXN0KGNsYXNzZXMp\nKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTnVtYmVyIGV4ZWN1dGVE\nZWxldGUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBfZXguZXhlY3V0\nZURlbGV0ZSh1bndyYXAocSksIHBhcmFtcyk7CiAgICAgICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgICAgICBjbGVhckFjY2Vzc3NQYXRoKHEpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTnVtYmVy\nIGV4ZWN1dGVVcGRhdGUoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBf\nZXguZXhlY3V0ZVVwZGF0ZSh1bndyYXAocSksIHBhcmFtcyk7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBjbGVhckFjY2Vzc3NQ\nYXRoKHEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEs\nIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgUmFuZ2UgcmFuZ2UpIHsK\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NUUklOR1M7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCB2YWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsK\nICAgICAgICAgICAgX2V4LnZhbGlkYXRlKHVud3JhcChxKSk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0b3Jl\nUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLCBSYW5nZSByYW5nZSkgewogICAg\nICAgICAgICBfZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5nZSk7IAogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVl\nKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBP\nYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgb3JkZXJJbmRleCkgewogICAgICAg\nICAgICByZXR1cm4gX2V4LmdldE9yZGVyaW5nVmFsdWUodW53cmFwKHEpLCBw\nYXJhbXMsIHJlc3VsdE9iamVjdCwKICAgICAgICAgICAgICAgIG9yZGVySW5k\nZXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW5bXSBnZXRB\nc2NlbmRpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0QXNjZW5kaW5nKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc1BhY2tpbmcoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXguaXNQYWNraW5nKHVud3JhcChxKSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldEFsaWFzKFN0b3Jl\nUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldEFsaWFzKHVu\nd3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3MgZ2V0\nUmVzdWx0Q2xhc3MoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfZXguZ2V0UmVzdWx0Q2xhc3ModW53cmFwKHEpKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRQcm9qZWN0aW9uQWxpYXNlcyhT\ndG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5nZXRQcm9q\nZWN0aW9uQWxpYXNlcyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIENsYXNzW10gZ2V0UHJvamVjdGlvblR5cGVzKFN0b3JlUXVlcnkg\ncSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldFByb2plY3Rpb25UeXBl\ncyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENsYXNz\nTWV0YURhdGFbXSBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKFN0b3JlUXVlcnkg\ncSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldEFjY2Vzc1BhdGhNZXRh\nRGF0YXModW53cmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgZ2V0T3BlcmF0aW9uKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBy\nZXR1cm4gX2V4LmdldE9wZXJhdGlvbih1bndyYXAocSkpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXguaXNBZ2dyZWdhdGUodW53\ncmFwKHEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc0dyb3VwaW5nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4g\nX2V4Lmhhc0dyb3VwaW5nKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgTGlua2VkTWFwIGdldFBhcmFtZXRlclR5cGVzKFN0b3JlUXVl\ncnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldFBhcmFtZXRlclR5\ncGVzKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTWFw\nIGdldFVwZGF0ZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfZXguZ2V0VXBkYXRlcyh1bndyYXAocSkpOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBzdGF0aWMgU3RvcmVRdWVyeSB1bndyYXAoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiAoKFF1ZXJ5Q2FjaGVTdG9yZVF1\nZXJ5KSBxKS5nZXREZWxlZ2F0ZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc3VsdCBsaXN0IGltcGxlbWVudGF0aW9uIGZvciBhIGNh\nY2hlZCBxdWVyeSByZXN1bHQuIFBhY2thZ2UtcHJvdGVjdGVkCiAgICAgKiBm\nb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBD\nYWNoZWRMaXN0CiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdExpc3QKICAgICAg\nICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHByaXZhdGUg\nZmluYWwgUXVlcnlSZXN1bHQgX3JlczsKICAgICAgICBwcml2YXRlIGZpbmFs\nIGJvb2xlYW4gX3Byb2o7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdG9yZUNv\nbnRleHQgX3NjdHg7CgogICAgICAgIHB1YmxpYyBDYWNoZWRMaXN0KFF1ZXJ5\nUmVzdWx0IHJlcywgYm9vbGVhbiBwcm9qLCBTdG9yZUNvbnRleHQgY3R4KSB7\nCiAgICAgICAgICAgIF9yZXMgPSByZXM7CiAgICAgICAgICAgIF9wcm9qID0g\ncHJvajsKICAgICAgICAgICAgX3NjdHggPSBjdHg7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaWR4KSB7CiAgICAgICAgICAg\nIGlmICghX3Byb2opCiAgICAgICAgICAgICAgICByZXR1cm4gZnJvbU9iamVj\ndElkKF9yZXMuZ2V0KGlkeCksIF9zY3R4KTsKCiAgICAgICAgICAgIE9iamVj\ndFtdIGNhY2hlZCA9IChPYmplY3RbXSkgX3Jlcy5nZXQoaWR4KTsKICAgICAg\nICAgICAgaWYgKGNhY2hlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIE9iamVjdFtdIHVuY2FjaGVkID0gbmV3\nIE9iamVjdFtjYWNoZWQubGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjYWNoZWQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICB1bmNhY2hlZFtpXSA9IGNvcHlQcm9qZWN0aW9uKGNhY2hlZFtpXSwgX3Nj\ndHgpOwogICAgICAgICAgICByZXR1cm4gdW5jYWNoZWQ7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmVzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmpl\nY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICAgICAgdGhyb3dzIE9iamVjdFN0\ncmVhbUV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXlM\naXN0KHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEg\nd3JhcHBlciBhcm91bmQgYSB7QGxpbmsgUmVzdWx0T2JqZWN0UHJvdmlkZXJ9\nIHRoYXQgYnVpbGRzIHVwIGEgbGlzdCBvZgogICAgICogYWxsIHRoZSBPSURz\nIGluIHRoaXMgbGlzdCBhbmQgcmVnaXN0ZXJzIHRoYXQgbGlzdCB3aXRoIHRo\nZQogICAgICogcXVlcnkgY2FjaGUuIEFiYW5kb25zIG1vbml0b3JpbmcgYW5k\nIHJlZ2lzdGVyaW5nIGlmIG9uZSBvZiB0aGUgY2xhc3NlcwogICAgICogaW4g\ndGhlIGFjY2VzcyBwYXRoIGlzIG1vZGlmaWVkIHdoaWxlIHRoZSBxdWVyeSBy\nZXN1bHRzIGFyZSBiZWluZyBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUg\nY2xhc3MgQ2FjaGluZ1Jlc3VsdE9iamVjdFByb3ZpZGVyCiAgICAgICAgaW1w\nbGVtZW50cyBSZXN1bHRPYmplY3RQcm92aWRlciwgVHlwZXNDaGFuZ2VkTGlz\ndGVuZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdE9iamVjdFBy\nb3ZpZGVyIF9yb3A7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9w\ncm9qOwogICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlLZXkgX3FrOwogICAg\nICAgIHByaXZhdGUgZmluYWwgVHJlZU1hcCBfZGF0YSA9IG5ldyBUcmVlTWFw\nKCk7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9tYWludGFpbkNhY2hlID0g\ndHJ1ZTsKICAgICAgICBwcml2YXRlIGludCBfcG9zID0gLTE7CgogICAgICAg\nIC8vIHVzZWQgdG8gZGV0ZXJtaW5lIGxpc3Qgc2l6ZSB3aXRob3V0IG5lY2Vz\nc2FyaWx5IGNhbGxpbmcgc2l6ZSgpLAogICAgICAgIC8vIHdoaWNoIG1heSBy\nZXF1aXJlIGEgREIgdHJpcCBvciByZXR1cm4gSW50ZWdlci5NQVhfVkFMVUUK\nICAgICAgICBwcml2YXRlIGludCBfbWF4ID0gLTE7CiAgICAgICAgcHJpdmF0\nZSBpbnQgX3NpemUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKCiAgICAgICAgLyoq\nCiAgICAgICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBkZWxlZ2F0ZSByZXN1\nbHQgcHJvdmlkZXIgYW5kIG91ciBxdWVyeSBrZXkuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIENhY2hpbmdSZXN1bHRPYmplY3RQcm92aWRlcihSZXN1\nbHRPYmplY3RQcm92aWRlciByb3AsCiAgICAgICAgICAgIGJvb2xlYW4gcHJv\naiwgUXVlcnlLZXkga2V5KSB7CiAgICAgICAgICAgIF9yb3AgPSByb3A7CiAg\nICAgICAgICAgIF9wcm9qID0gcHJvajsKICAgICAgICAgICAgX3FrID0ga2V5\nOwogICAgICAgICAgICBfY2FjaGUuYWRkVHlwZXNDaGFuZ2VkTGlzdGVuZXIo\ndGhpcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTdG9w\nIGNhY2hpbmcuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGFi\nb3J0Q2FjaGluZygpIHsKICAgICAgICAgICAgaWYgKCFfbWFpbnRhaW5DYWNo\nZSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIHRo\naXMgY2FuIGJlIGNhbGxlZCB2aWEgYW4gZXZlbnQgZnJvbSBhbm90aGVyIHRo\ncmVhZAogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAg\nICAgICAgICAgIC8vIGl0J3MgaW1wb3J0YW50IHRoYXQgd2Ugc2V0IHRoaXMg\nZmxhZyBmaXJzdCBzbyB0aGF0IGFueQogICAgICAgICAgICAgICAgLy8gc3Vi\nc2VxdWVudCBjYWxscyB0byB0aGlzIG9iamVjdCBhcmUgYnlwYXNzZWQuCiAg\nICAgICAgICAgICAgICBfbWFpbnRhaW5DYWNoZSA9IGZhbHNlOwogICAgICAg\nICAgICAgICAgX2NhY2hlLnJlbW92ZVR5cGVzQ2hhbmdlZExpc3RlbmVyKHRo\naXMpOwogICAgICAgICAgICAgICAgX2RhdGEuY2xlYXIoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2hlY2sg\nd2hldGhlciB3ZSd2ZSBidWZmZXJlZCBhbGwgcmVzdWx0cywgd2hpbGUgb3B0\naW9uYWxseSBhZGRpbmcKICAgICAgICAgKiB0aGUgZ2l2ZW4gcmVzdWx0Lgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBjaGVja0ZpbmlzaGVk\nKE9iamVjdCBvYmosIGJvb2xlYW4gcmVzdWx0KSB7CiAgICAgICAgICAgIC8v\nIHRoaXMgY2FuIGJlIGNhbGxlZCBhdCB0aGUgc2FtZSB0aW1lIGFzIGFib3J0\nQ2FjaGluZyB2aWEKICAgICAgICAgICAgLy8gYSB0eXBlcyBjaGFuZ2VkIGV2\nZW50CiAgICAgICAgICAgIGJvb2xlYW4gZmluaXNoZWQgPSBmYWxzZTsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICBpZiAoX21haW50YWluQ2FjaGUpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEludGVnZXIg\naW5kZXggPSBOdW1iZXJzLnZhbHVlT2YoX3Bvcyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICghX2RhdGEuY29udGFpbnNLZXkoaW5kZXgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QgY2FjaGVkOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZCA9IG51bGw7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghX3Byb2opCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkID0gX3NjdHgu\nZ2V0T2JqZWN0SWQob2JqKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVj\ndFtdIGFyciA9IChPYmplY3RbXSkgb2JqOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIE9iamVjdFtdIGNwID0gbmV3IE9iamVjdFthcnIubGVu\nZ3RoXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY3BbaV0gPSBjb3B5UHJvamVjdGlvbihh\ncnJbaV0sIF9zY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjYWNoZWQgPSBjcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZGF0YS5wdXQo\naW5kZXgsIGNhY2hlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmluaXNo\nZWQgPSBfc2l6ZSA9PSBfZGF0YS5zaXplKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaW5pc2hlZCkgewog\nICAgICAgICAgICAgICAgLy8gYW4gYWJvcnRDYWNoaW5nIGNhbGwgY2FuIHNu\nZWFrIGluIGhlcmUgdmlhIG9uRXhwaXJlOyB0aGUKICAgICAgICAgICAgICAg\nIC8vIGNhY2hlIGlzIGxvY2tlZCBkdXJpbmcgZXZlbnQgZmlyaW5ncywgc28g\ndGhlIGxvY2sgaGVyZSB3aWxsCiAgICAgICAgICAgICAgICAvLyB3YWl0IGZv\nciBpdCAob3Igd2lsbCBmb3JjZSB0aGUgbmV4dCBmaXJpbmcgdG8gd2FpdCkK\nICAgICAgICAgICAgICAgIF9jYWNoZS53cml0ZUxvY2soKTsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIHdlIGRpZG4ndCBhYm9ydAogICAgICAgICAgICAgICAgICAgIGlmIChfbWFp\nbnRhaW5DYWNoZSkgewogICAgICAgICAgICAgICAgICAgICAgICBRdWVyeVJl\nc3VsdCByZXMgPSBuZXcgUXVlcnlSZXN1bHQoX3FrLCBfZGF0YS52YWx1ZXMo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9jYWNoZS5wdXQoX3FrLCBy\nZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydENhY2hpbmcoKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBfY2Fj\naGUud3JpdGVVbmxvY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNSYW5kb21BY2Nlc3MoKSB7CiAgICAgICAgICAgIHJldHVybiBfcm9wLnN1\ncHBvcnRzUmFuZG9tQWNjZXNzKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBvcGVuKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIF9yb3Aub3BlbigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE9iamVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAgICAgICAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0IG9iaiA9IF9y\nb3AuZ2V0UmVzdWx0T2JqZWN0KCk7CiAgICAgICAgICAgIGNoZWNrRmluaXNo\nZWQob2JqLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIG5leHQoKQogICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcysrOwogICAg\nICAgICAgICBib29sZWFuIG5leHQgPSBfcm9wLm5leHQoKTsKICAgICAgICAg\nICAgaWYgKCFuZXh0ICYmIF9wb3MgPT0gX21heCArIDEpIHsKICAgICAgICAg\nICAgICAgIF9zaXplID0gX3BvczsKICAgICAgICAgICAgICAgIGNoZWNrRmlu\naXNoZWQobnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG5l\neHQgJiYgX3BvcyA+IF9tYXgpCiAgICAgICAgICAgICAgICBfbWF4ID0gX3Bv\nczsKICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShpbnQgcG9zKQogICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IHBvczsK\nICAgICAgICAgICAgYm9vbGVhbiB2YWxpZCA9IF9yb3AuYWJzb2x1dGUocG9z\nKTsKICAgICAgICAgICAgaWYgKCF2YWxpZCAmJiBfcG9zID09IF9tYXggKyAx\nKSB7CiAgICAgICAgICAgICAgICBfc2l6ZSA9IF9wb3M7CiAgICAgICAgICAg\nICAgICBjaGVja0ZpbmlzaGVkKG51bGwsIGZhbHNlKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmICh2YWxpZCAmJiBfcG9zID4gX21heCkKICAgICAgICAgICAg\nICAgIF9tYXggPSBfcG9zOwogICAgICAgICAgICByZXR1cm4gdmFsaWQ7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKQogICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF9zaXplICE9\nIEludGVnZXIuTUFYX1ZBTFVFKQogICAgICAgICAgICAgICAgcmV0dXJuIF9z\naXplOwogICAgICAgICAgICBpbnQgc2l6ZSA9IF9yb3Auc2l6ZSgpOwogICAg\nICAgICAgICBfc2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGNoZWNrRmluaXNo\nZWQobnVsbCwgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlc2V0KCkKICAgICAgICAg\nICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9yb3AucmVzZXQo\nKTsKICAgICAgICAgICAgX3BvcyA9IC0xOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgY2xvc2UoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgICAg\nIF9yb3AuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIGhhbmRsZUNoZWNrZWRFeGNlcHRpb24oRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgX3JvcC5oYW5kbGVDaGVja2VkRXhjZXB0aW9uKGUpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgb25UeXBlc0NoYW5nZWQoVHlwZXND\naGFuZ2VkRXZlbnQgZXYpIHsKICAgICAgICAgICAgaWYgKF9xay5jaGFuZ2VJ\nbnZhbGlkYXRlc1F1ZXJ5KGV2LmdldFR5cGVzKCkpKQogICAgICAgICAgICAg\nICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogU3RydWN0IHRvIHJlY29nbml6ZSBjYWNoZWQgb2lkcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ2FjaGVkT2JqZWN0SWQgewoK\nICAgICAgICBwdWJsaWMgZmluYWwgT2JqZWN0IG9pZDsKCiAgICAgICAgcHVi\nbGljIENhY2hlZE9iamVjdElkIChPYmplY3Qgb2lkKQoJCXsKCQkJdGhpcy5v\naWQgPSBvaWQ7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

