{"sha":"1a2b785364112d8a7f5771e858e3aacd9a44e65d","node_id":"MDQ6QmxvYjIwNjM2NDoxYTJiNzg1MzY0MTEyZDhhN2Y1NzcxZTg1OGUzYWFjZDlhNDRlNjVk","size":144727,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1a2b785364112d8a7f5771e858e3aacd9a44e65d","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEuaW8uRXh0ZXJuYWxpemFi\nbGU7CmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5pby5PYmplY3RJbnB1dDsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLk9iamVj\ndE91dHB1dDsKaW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RTdHJlYW1DbGFzczsKaW1wb3J0IGphdmEu\naW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuRmll\nbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBq\nYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmln\ndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNv\nbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIubWV0YS5DbGFzc0FyZ1BhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5GaWxlczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5TZXJ2aWNlczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5UZW1wb3JhcnlDbGFzc0xvYWRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXIuTWVzc2Fn\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBv\nc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVT\ndHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2Vu\nZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuQnl0ZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nQ2hhcklkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRGF0ZUlk\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuU2hvcnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlN0cmluZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3Bl\nbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDRmllbGQ7CmltcG9ydCBzZXJwLmJ5\ndGVjb2RlLkJDTWV0aG9kOwppbXBvcnQgc2VycC5ieXRlY29kZS5Db2RlOwpp\nbXBvcnQgc2VycC5ieXRlY29kZS5Db25zdGFudHM7CmltcG9ydCBzZXJwLmJ5\ndGVjb2RlLkV4Y2VwdGlvbnM7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkZpZWxk\nSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkdldEZpZWxkSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLklmSW5zdHJ1Y3Rpb247\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkluc3RydWN0aW9uOwppbXBvcnQgc2Vy\ncC5ieXRlY29kZS5KdW1wSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkxvYWRJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTWV0\naG9kSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLlRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb247\nCmltcG9ydCBzZXJwLnV0aWwuTnVtYmVyczsKCi8qKgogKiBCeXRlY29kZSBl\nbmhhbmNlciB1c2VkIHRvIGVuaGFuY2UgcGVyc2lzdGVudCBjbGFzc2VzIGZy\nb20gbWV0YWRhdGEuIFRoZQogKiBlbmhhbmNlciBtdXN0IGJlIGludm9rZWQg\nb24gYWxsIHBlcnNpc3RlbmNlLWNhcGFibGUgYW5kIHBlcnNpc3RlbmNlIGF3\nYXJlCiAqIGNsYXNzZXMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpw\ndWJsaWMgY2xhc3MgUENFbmhhbmNlciB7CgogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgRU5IQU5DRV9OT05FID0gMDsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IEVOSEFOQ0VfQVdBUkUgPSAyIDw8IDA7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX0lOVEVSRkFDRSA9IDIgPDwgMTsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VfUEMgPSAyIDw8\nIDI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX09JRCA9\nIDIgPDwgMzsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUFJF\nID0gInBjIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFBDVFlQ\nRSA9IFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzczsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIFN0cmluZyBTTSA9IFBSRSArICJTdGF0ZU1hbmFnZXIiOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgU01UWVBFID0gU3RhdGVN\nYW5hZ2VyLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIElOSEVSSVQgPSBQUkUgKyAiSW5oZXJpdGVkRmllbGRDb3VudCI7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OVEVYVE5BTUUgPSAiR2Vu\nZXJpY0NvbnRleHQiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3Mg\nVVNFUkVYQ0VQID0gVXNlckV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENsYXNzIElOVEVSTkVYQ0VQID0gSW50ZXJuYWxFeGNl\ncHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBI\nRUxQRVJUWVBFID0gUENSZWdpc3RyeS5jbGFzczsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIFN0cmluZyBTVVBFUiA9IFBSRSArICJQQ1N1cGVyY2xhc3Mi\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgT0lERlNUWVBFID0g\nRmllbGRTdXBwbGllci5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIENsYXNzIE9JREZDVFlQRSA9IEZpZWxkQ29uc3VtZXIuY2xhc3M7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZQogICAgICAgIChQQ0VuaGFuY2VyLmNsYXNzKTsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIEF1eGlsaWFyeUVuaGFuY2VyW10gX2F1\neEVuaGFuY2VyczsKICAgIHN0YXRpYyB7CiAgICAgICAgQ2xhc3NbXSBjbGFz\nc2VzID0gU2VydmljZXMuZ2V0SW1wbGVtZW50b3JDbGFzc2VzKAogICAgICAg\nICAgICBBdXhpbGlhcnlFbmhhbmNlci5jbGFzcywgCiAgICAgICAgICAgIEF1\neGlsaWFyeUVuaGFuY2VyLmNsYXNzLmdldENsYXNzTG9hZGVyKCkpOwogICAg\nICAgIExpc3QgYXV4RW5oYW5jZXJzID0gbmV3IEFycmF5TGlzdChjbGFzc2Vz\nLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbGFzc2Vz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBhdXhFbmhhbmNlcnMuYWRkKGNsYXNzZXNbaV0ubmV3SW5zdGFuY2Uo\nKSk7CgkJICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAg\nICAgICAvLyBhdXggZW5oYW5jZXIgbWF5IHJlbHkgb24gbm9uLWV4aXN0YW50\nIHNwZWMgY2xhc3NlcywgZXRjCgkJICAgIH0KCQl9CiAgICAJX2F1eEVuaGFu\nY2VycyA9IChBdXhpbGlhcnlFbmhhbmNlcltdKSBhdXhFbmhhbmNlcnMudG9B\ncnJheQogICAgICAgICAgICAobmV3IEF1eGlsaWFyeUVuaGFuY2VyW2F1eEVu\naGFuY2Vycy5zaXplKCldKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEJD\nQ2xhc3MgX3BjOwogICAgcHJpdmF0ZSBmaW5hbCBNZXRhRGF0YVJlcG9zaXRv\ncnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01ldGFEYXRhIF9t\nZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsKICAgIHByaXZhdGUg\nQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9mYWlsID0g\nZmFsc2U7CiAgICBwcml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2\nYXRlIEJ5dGVjb2RlV3JpdGVyIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0\nZSBNYXAgX2JhY2tpbmdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQg\nX3Zpb2xhdGlvbnMgPSBudWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0\nb3IuIFN1cHBseSBjb25maWd1cmF0aW9uIGFuZCB0eXBlIHRvIGVuaGFuY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYsIENsYXNzIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYs\nIG5ldyBQcm9qZWN0KCkubG9hZENsYXNzKHR5cGUpLCAoTWV0YURhdGFSZXBv\nc2l0b3J5KSBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVj\ndG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbiBhbmQgdHlwZSB0byBlbmhhbmNl\nLgogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmln\ndXJhdGlvbiBjb25mLCBDbGFzc01ldGFEYXRhIHR5cGUpIHsKICAgICAgICB0\naGlzKGNvbmYsIG5ldyBQcm9qZWN0KCkubG9hZENsYXNzKHR5cGUuZ2V0RGVz\nY3JpYmVkVHlwZSgpKSwKICAgICAgICAgICAgdHlwZS5nZXRSZXBvc2l0b3J5\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBjb25maWd1cmF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRo\nZSBieXRlY29kZSByZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAg\nICogZW5oYW5jZTsgdGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJl\nYW0gb3IgZmlsZQogICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVw\nb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9y\nIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0\nb3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0\nIHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJh\ndGlvbiBtaWdodCBiZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lm\naWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1v\ncmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqLwogICAg\ncHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwg\nQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncykgewogICAgICAgIF9wYyA9IHR5cGU7CiAgICAgICAgX2xvZyA9IGNvbmYu\nZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19FTkhBTkNFKTsKCiAg\nICAgICAgaWYgKHJlcG9zID09IG51bGwpIHsKICAgICAgICAgICAgX3JlcG9z\nID0gY29uZi5uZXdNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAg\nICAgICAgICBfcmVwb3Muc2V0U291cmNlTW9kZShNZXRhRGF0YVJlcG9zaXRv\ncnkuTU9ERV9NRVRBKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgX3Jl\ncG9zID0gcmVwb3M7CiAgICAgICAgX21ldGEgPSBfcmVwb3MuZ2V0TWV0YURh\ndGEodHlwZS5nZXRUeXBlKCksIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbiwg\ndHlwZSwgYW5kIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgUENFbmhh\nbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBCQ0NsYXNzIHR5cGUs\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgX3BjID0g\ndHlwZTsKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZp\nZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwogICAgICAgIF9yZXBvcyA9IG1ldGEu\nZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIF9tZXRhID0gbWV0YTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50\nYXRpb24gb2YgdGhlIGNsYXNzIGJlaW5nIG1hbmlwdWxhdGVkLgogICAgICov\nCiAgICBwdWJsaWMgQkNDbGFzcyBnZXRCeXRlY29kZSgpIHsKICAgICAgICBy\nZXR1cm4gX3BjOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbnMgb2YgYW55IG9pZCBjbGFzc2VzIHRo\nYXQgbXVzdCBiZQogICAgICogbWFuaXB1bGF0ZWQuCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2xsZWN0aW9uIGdldE9iamVjdElkQnl0ZWNvZGUoKSB7CiAgICAg\nICAgcmV0dXJuIChfb2lkcyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZ\nX0xJU1QgOiBfb2lkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyBiZWluZyBtYW5pcHVsYXRlZCwg\nb3IgbnVsbCBpZiBub3QKICAgICAqIGEgcGVyc2lzdGVudCB0eXBlLgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsK\nICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBlbmhhbmNlciBzaG91\nbGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0b3IgaWYgb25lIGlz\nIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNzLiBPcGVuSlBBCiAg\nICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0cnVjdG9yICh3aGV0\naGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAgKiBvciBieSB0aGUg\ndXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRBZGREZWZhdWx0Q29uc3RydWN0b3IoKSB7CiAgICAgICAg\ncmV0dXJuIF9kZWZDb25zOwogICAgfQoKICAgIC8qKgogICAgICogQSBib29s\nZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIGFk\nZCBhIG5vLWFyZ3MKICAgICAqIGNvbnN0cnVjdG9yIGlmIG9uZSBpcyBub3Qg\nYWxyZWFkeSBwcmVzZW50IGluIHRoZSBjbGFzcy4gT3BlbkpQQQogICAgICog\ncmVxdWlyZXMgdGhhdCBhIG5vLWFyZyBjb25zdHJ1Y3RvciAod2hldGhlciBj\ncmVhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgICogb3IgYnkgdGhlIHVzZXIp\nIGJlIHByZXNlbnQgaW4gYSBQQy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGJvb2xlYW4gYWRkRGVmYXVsdENv\nbnN0cnVjdG9yKSB7CiAgICAgICAgX2RlZkNvbnMgPSBhZGREZWZhdWx0Q29u\nc3RydWN0b3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZh\naWwgaWYgdGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2Vz\ncyBhbmQKICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQg\nbWF5IGJlIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFj\nY2VzcyByZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGdldEVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucygpIHsKICAgICAgICBy\nZXR1cm4gX2ZhaWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRv\nIGZhaWwgaWYgdGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFj\nY2VzcyBhbmQKICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQg\naXQgbWF5IGJlIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAq\nIGFjY2VzcyByZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyhib29sZWFuIGZhaWwp\nIHsKICAgICAgICBfZmFpbCA9IGZhaWw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgYmFzZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0\nby4gVGhlIHByb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBi\nZSBjcmVhdGVkIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRv\nCiAgICAgKiBvdmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBp\nZiBudWxsLgogICAgICovCiAgICBwdWJsaWMgRmlsZSBnZXREaXJlY3Rvcnko\nKSB7CiAgICAgICAgcmV0dXJuIF9kaXI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgYmFzZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0\nby4gVGhlIHByb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBi\nZSBjcmVhZWQgYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8K\nICAgICAqIG92ZXJ3cml0aW5nIHRoZSBleGlzdGluZyBjbGFzcyBmaWxlIGlm\nIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpcmVjdG9yeShG\naWxlIGRpcikgewogICAgICAgIF9kaXIgPSBkaXI7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGN1cnJlbnQge0BsaW5rIEJ5dGVjb2RlV3Jp\ndGVyfSB0byB3cml0ZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAg\nIHB1YmxpYyBCeXRlY29kZVdyaXRlciBnZXRCeXRlY29kZVdyaXRlcigpIHsK\nICAgICAgICByZXR1cm4gX3dyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUge0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3cml0ZSB0aGUg\nYnl0ZWNvZGUgdG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRCeXRlY29kZVdyaXRlcihCeXRlY29kZVdyaXRlciB3cml0\nZXIpIHsKICAgICAgICBfd3JpdGVyID0gd3JpdGVyOwogICAgfQoKICAgIC8q\nKgogICAgICogUGVyZm9ybSBieXRlY29kZSBlbmhhbmNlbWVudHMuCiAgICAg\nKgogICAgICogQHJldHVybiA8Y29kZT5FTkhBTkNFXyo8L2NvZGU+IGNvbnN0\nYW50CiAgICAgKi8KICAgIHB1YmxpYyBpbnQgcnVuKCkgewogICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImVuaGFuY2Utc3RhcnQiLCBfcGMuZ2V0VHlwZSgpKSk7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIG1hbmFnZWQgaW50\nZXJmYWNlLCBza2lwCiAgICAgICAgICAgIGlmIChfcGMuaXNJbnRlcmZhY2Uo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX0lOVEVSRkFDRTsK\nCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGFscmVhZHkgZW5oYW5jZWQKICAg\nICAgICAgICAgQ2xhc3NbXSBpbnRlcmZhY2VzID0gX3BjLmdldERlY2xhcmVk\nSW50ZXJmYWNlVHlwZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBpbnRlcmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaW50ZXJmYWNlc1tpXS5nZXROYW1lKCkuZXF1YWxzKFBDVFlQRS5n\nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgicGMtdHlwZSIsIF9wYy5nZXRUeXBlKCkpKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCAmJiBlbmhhbmNl\nT2JqZWN0SWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVO\nSEFOQ0VfT0lEOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNF\nX05PTkU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHZhbGlkYXRlIHByb3BlcnRpZXMgYmVmb3JlIHJlcGxhY2lu\nZyBmaWVsZCBhY2Nlc3Mgc28gdGhhdAogICAgICAgICAgICAvLyB3ZSBidWls\nZCB1cCBhIHJlY29yZCBvZiBiYWNraW5nIGZpZWxkcywgZXRjCiAgICAgICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBfbWV0\nYS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJP\nUEVSVFkpCiAgICAgICAgICAgICAgICB2YWxpZGF0ZVByb3BlcnRpZXMoKTsK\nICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKTsK\nICAgICAgICAgICAgcHJvY2Vzc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAgICAg\nIGlmIChfbWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpbnQgcmV0\nID0gRU5IQU5DRV9QQzsKICAgICAgICAgICAgICAgIGVuaGFuY2VDbGFzcygp\nOwogICAgICAgICAgICAgICAgYWRkRmllbGRzKCk7CiAgICAgICAgICAgICAg\nICBhZGRTdGF0aWNJbml0aWFsaXplcigpOwogICAgICAgICAgICAgICAgYWRk\nUENNZXRob2RzKCk7CiAgICAgICAgICAgICAgICBhZGRBY2Nlc3NvcnMoKTsK\nICAgICAgICAgICAgICAgIGFkZEF0dGFjaERldGFjaENvZGUoKTsKICAgICAg\nICAgICAgICAgIGFkZFNlcmlhbGl6YXRpb25Db2RlKCk7CiAgICAgICAgICAg\nICAgICBhZGRDbG9uaW5nQ29kZSgpOwogICAgICAgICAgICAgICAgaWYgKGVu\naGFuY2VPYmplY3RJZCgpKQogICAgICAgICAgICAgICAgICAgIHJldCB8PSBF\nTkhBTkNFX09JRDsKICAgICAgICAgICAgICAgIHJ1bkF1eGlsaWFyeUVuaGFu\nY2VycygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJwZXJzLWF3YXJl\nIiwgX3BjLmdldFR5cGUoKSkpOwogICAgICAgICAgICByZXR1cm4gRU5IQU5D\nRV9BV0FSRTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdy\naXRlIHRoZSBnZW5lcmF0ZWQgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHJlY29yZCgpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICByZWNvcmQoX3BjKTsKICAgICAgICBpZiAoX29pZHMgIT0gbnVs\nbCkKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfb2lkcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIHJlY29y\nZCgoQkNDbGFzcykgaXRyLm5leHQoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXcml0ZSB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZWNvcmQoQkNDbGFzcyBiYykKICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIGlmIChfd3JpdGVyICE9IG51bGwpCiAgICAgICAg\nICAgIF93cml0ZXIud3JpdGUoYmMpOwogICAgICAgIGVsc2UgaWYgKF9kaXIg\nPT0gbnVsbCkKICAgICAgICAgICAgYmMud3JpdGUoKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgRmlsZSBkaXIgPSBGaWxlcy5nZXRQYWNrYWdlRmls\nZShfZGlyLCBiYy5nZXRQYWNrYWdlTmFtZSgpLCB0cnVlKTsKICAgICAgICAg\nICAgYmMud3JpdGUobmV3IEZpbGUoZGlyLCBiYy5nZXRDbGFzc05hbWUoKSAr\nICIuY2xhc3MiKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVmFsaWRhdGUgdGhhdCB0aGUgbWV0aG9kcyBpbiB0aGlzIHByb3BlcnR5LWFj\nY2VzcyBpbnN0YW5jZSBhcmUKICAgICAqIHdyaXR0ZW4gY29ycmVjdGx5LiBU\naGlzIG1ldGhvZCBhbHNvIGdhdGhlcnMgaW5mb3JtYXRpb24gb24gZWFjaAog\nICAgICogcHJvcGVydHkncyBiYWNraW5nIGZpZWxkLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgdmFsaWRhdGVQcm9wZXJ0aWVzKCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMo\nKTsKICAgICAgICBNZXRob2QgbWV0aDsKICAgICAgICBCQ01ldGhvZCBnZXR0\nZXIsIHNldHRlciA9IG51bGw7CiAgICAgICAgQkNGaWVsZCByZXR1cm5lZCwg\nYXNzaWduZWQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIShmbWRzW2ld\nLmdldEJhY2tpbmdNZW1iZXIoKSBpbnN0YW5jZW9mIE1ldGhvZCkpIHsKICAg\nICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktYmFkLW1lbWJl\nciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBmbWRzW2ld\nLCBmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKSB9LAogICAgICAgICAgICAg\nICAgICAgIHRydWUpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIG1ldGggPSAoTWV0aG9kKSBmbWRzW2ld\nLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgZ2V0dGVyID0gX3Bj\nLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICAgICAg\naWYgKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhZGRWaW9s\nYXRpb24oInByb3BlcnR5LW5vLWdldHRlciIsIG5ldyBPYmplY3RbXXsgZm1k\nc1tpXSB9LAogICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdldHRlcik7CiAgICAgICAgICAg\nIGlmIChyZXR1cm5lZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2JhY2tpbmdGaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBf\nYmFja2luZ0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAg\nICBfYmFja2luZ0ZpZWxkcy5wdXQoZ2V0dGVyLmdldE5hbWUoKSwgcmV0dXJu\nZWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2V0\ndGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKGdldFNldHRlck5hbWUoZm1k\nc1tpXSksCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAgICAgaWYgKHNldHRlciA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmV0dXJuZWQgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVy\ndHktbm8tc2V0dGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBmbWRzW2ldIH0sIHRydWUpOwogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBjcmVhdGUgc3ludGhldGljIHNldHRlcgogICAgICAg\nICAgICAgICAgICAgIHNldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKGdldFNl\ndHRlck5hbWUoZm1kc1tpXSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdldERlY2xhcmVkVHlw\nZSgpIH0pOwogICAgICAgICAgICAgICAgICAgIHNldHRlci5tYWtlUHJpdmF0\nZSgpOwogICAgICAgICAgICAgICAgICAgIENvZGUgY29kZSA9IHNldHRlci5n\nZXRDb2RlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRUaGlzKCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS54bG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgICAgIGNvZGUucHV0Zmll\nbGQoKS5zZXRGaWVsZChyZXR1cm5lZCk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmIChzZXR0ZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGFzc2lnbmVkID0gZ2V0QXNzaWduZWRGaWVsZChzZXR0ZXIp\nOwoKICAgICAgICAgICAgaWYgKGFzc2lnbmVkICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmIChfYmFja2luZ0ZpZWxkcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIF9iYWNraW5nRmllbGRzID0gbmV3IEhhc2hNYXAoKTsK\nCiAgICAgICAgICAgICAgICBpZiAoc2V0dGVyICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgX2JhY2tpbmdGaWVsZHMucHV0KHNldHRlci5nZXROYW1l\nKCksIGFzc2lnbmVkLmdldE5hbWUoKSk7CgogICAgICAgICAgICAgICAgaWYg\nKGFzc2lnbmVkICE9IHJldHVybmVkKQogICAgICAgICAgICAgICAgICAgIGFk\nZFZpb2xhdGlvbigicHJvcGVydHktc2V0dGVyLWdldHRlci1taXNtYXRjaCIs\nIG5ldyBPYmplY3RbXQogICAgICAgICAgICAgICAgICAgICAgICB7IGZtZHNb\naV0sIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJldHVybmVkID09IG51bGwpIAog\nICAgICAgICAgICAgICAgICAgICAgICA/IG51bGwgOiByZXR1cm5lZC5nZXRO\nYW1lKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBzZXR0\nZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIFN0cmluZyBnZXRTZXR0ZXJOYW1lKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgcmV0dXJuICJzZXQiICsgU3RyaW5nVXRpbHMu\nY2FwaXRhbGl6ZShmbWQuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgZmllbGQgcmV0dXJuZWQgYnkgdGhlIGdpdmVuIG1l\ndGhvZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2FnZS1wcm90ZWN0\nZWQgYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAgc3RhdGlj\nIEJDRmllbGQgZ2V0UmV0dXJuZWRGaWVsZChCQ01ldGhvZCBtZXRoKSB7CiAg\nICAgICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCBuZXcgQ29kZSgpLnhyZXR1\ncm4oKS5zZXRUeXBlCiAgICAgICAgICAgIChtZXRoLmdldFJldHVyblR5cGUo\nKSksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZmllbGQgYXNzaWduZWQgaW4gdGhlIGdpdmVuIG1ldGhvZCwgb3IgbnVsbCBp\nZiBub25lLgogICAgICogUGFja2FnZS1wcm90ZWN0ZWQgYW5kIHN0YXRpYyBm\nb3IgdGVzdGluZy4KICAgICAqLwogICAgc3RhdGljIEJDRmllbGQgZ2V0QXNz\naWduZWRGaWVsZChCQ01ldGhvZCBtZXRoKSB7CiAgICAgICAgcmV0dXJuIGZp\nbmRGaWVsZChtZXRoLCBuZXcgQ29kZSgpLnB1dGZpZWxkKCksIHRydWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5l\nZCAvIGFzc2lnbmVkIGJ5IDxjb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5zCiAg\nICAgKiBudWxsIGlmIG5vbi1maWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxzLCBw\nYXJhbWV0ZXJzLCB2YXJpYWJsZXMpIGFyZQogICAgICogcmV0dXJuZWQsIG9y\nIGlmIG5vbi1wYXJhbWV0ZXJzIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEJDRmllbGQgZmluZEZpZWxkKEJD\nTWV0aG9kIG1ldGgsIEluc3RydWN0aW9uIHRlbXBsYXRlLAogICAgICAgIGJv\nb2xlYW4gZmluZEFjY2Vzc2VkKSB7CiAgICAgICAgLy8gaWdub3JlIGFueSBz\ndGF0aWMgbWV0aG9kcy4gT3BlbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBwb3J0\ncyBub24tc3RhdGljCiAgICAgICAgLy8gc2V0dGVycyBhbmQgZ2V0dGVycwog\nICAgICAgIGlmIChtZXRoLmlzU3RhdGljKCkpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUoZmFs\nc2UpOwogICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAg\nICAgQkNGaWVsZCBmaWVsZCA9IG51bGwsIGN1cjsKICAgICAgICBJbnN0cnVj\ndGlvbiB0ZW1wbGF0ZUlucywgcHJldklucywgdHdvUHJldkluczsKICAgICAg\nICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewogICAg\nICAgICAgICB0ZW1wbGF0ZUlucyA9IGNvZGUucHJldmlvdXMoKTsKICAgICAg\nICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJl\ndmlvdXMoKTsKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgdHdv\nUHJldklucyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIC8vIGlm\nIHRoZSBvcGNvZGUgdHdvIGJlZm9yZSB0aGUgdGVtcGxhdGUgd2FzIGFuIGFs\nb2FkXzAsIGNoZWNrCiAgICAgICAgICAgIC8vIGFnYWluc3QgdGhlIG1pZGRs\nZSBpbnN0cnVjdGlvbiBiYXNlZCBvbiB3aGF0IHR5cGUgb2YgZmluZAogICAg\nICAgICAgICAvLyB3ZSdyZSBkb2luZwogICAgICAgICAgICBpZiAoISh0d29Q\ncmV2SW5zIGluc3RhbmNlb2YgTG9hZEluc3RydWN0aW9uKQogICAgICAgICAg\nICAgICAgfHwgISgoTG9hZEluc3RydWN0aW9uKSB0d29QcmV2SW5zKS5pc1Ro\naXMoKSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAg\nICAgLy8gaWYgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiB3YXMgYSBnZXRmaWVs\nZCwgdGhlbiBpdCdzIHRoZQogICAgICAgICAgICAvLyBmaWVsZCB0aGF0J3Mg\nYmVpbmcgYWNjZXNzZWQKICAgICAgICAgICAgaWYgKCFmaW5kQWNjZXNzZWQg\nJiYgcHJldklucyBpbnN0YW5jZW9mIEdldEZpZWxkSW5zdHJ1Y3Rpb24pCiAg\nICAgICAgICAgICAgICBjdXIgPSAoKEZpZWxkSW5zdHJ1Y3Rpb24pIHByZXZJ\nbnMpLmdldEZpZWxkKCk7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbWlk\nZGxlIGluc3RydWN0aW9uIHdhcyBhbiB4bG9hZF8xLCB0aGVuIHRoZQogICAg\nICAgICAgICAgICAgLy8gbWF0Y2hlZCBpbnN0cnVjdGlvbiBpcyB0aGUgZmll\nbGQgdGhhdCdzIGJlaW5nIHNldC4KICAgICAgICAgICAgZWxzZSBpZiAoZmlu\nZEFjY2Vzc2VkICYmIHByZXZJbnMgaW5zdGFuY2VvZiBMb2FkSW5zdHJ1Y3Rp\nb24KICAgICAgICAgICAgICAgICYmICgoTG9hZEluc3RydWN0aW9uKSBwcmV2\nSW5zKS5nZXRQYXJhbSgpID09IDApCiAgICAgICAgICAgICAgICBjdXIgPSAo\nKEZpZWxkSW5zdHJ1Y3Rpb24pIHRlbXBsYXRlSW5zKS5nZXRGaWVsZCgpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgICAgIGlmIChmaWVsZCAhPSBudWxsICYmIGN1ciAhPSBmaWVs\nZCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBm\naWVsZCA9IGN1cjsKCiAgICAgICAgICAgIC8vIHJlYWR5IGZvciBuZXh0IHNl\nYXJjaCBpdGVyYXRpb24KICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAg\nICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICBjb2RlLm5leHQoKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVjb3JkIGEgdmlvbGF0aW9uIG9mIHRoZSBwcm9wZXJ0eSBh\nY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkVmlvbGF0aW9uKFN0cmluZyBrZXksIE9iamVjdFtdIGFyZ3MsIGJvb2xl\nYW4gZmF0YWwpIHsKICAgICAgICBpZiAoX3Zpb2xhdGlvbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgX3Zpb2xhdGlvbnMgPSBuZXcgSGFzaFNldCgpOwogICAg\nICAgIF92aW9sYXRpb25zLmFkZChfbG9jLmdldChrZXksIGFyZ3MpKTsKICAg\nICAgICBfZmFpbCB8PSBmYXRhbDsKICAgIH0KCiAgICAvKioKICAgICAqIExv\nZyAvIHRocm93IHJlY29yZGVkIHByb3BlcnR5IGFjY2VzcyB2aW9sYXRpb25z\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1Zpb2xhdGlvbnMo\nKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25zID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHNlcCA9IFN5c3RlbS5nZXRQ\ncm9wZXJ0eSgibGluZS5zZXBhcmF0b3IiKTsKICAgICAgICBTdHJpbmdCdWZm\nZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX3Zpb2xhdGlvbnMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChpdHIubmV4dCgpKTsK\nICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKHNlcCk7CiAgICAgICAgfQogICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQoInByb3BlcnR5LXZpb2xhdGlvbnMiLCBidWYpOwoK\nICAgICAgICBpZiAoX2ZhaWwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLndhcm4obXNnKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlcGxhY2VkIGFsbCBkaXJlY3QgYWNjZXNzIHRvIG1hbmFn\nZWQgZmllbGRzIHdpdGggdGhlIGFwcHJvcHJpYXRlCiAgICAgKiBwY0dldC9w\nY1NldCBtZXRob2QuIE5vdGUgdGhhdCB0aGlzIGluY2x1ZGVzIGFjY2VzcyB0\nbyBmaWVsZHMKICAgICAqIG93bmVkIGJ5IFBlcnNpc3RlbmNlQ2FwYWJsZSBj\nbGFzc2VzIG90aGVyIHRoYW4gdGhpcyBvbmUuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2VzcygpIHsKICAg\nICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgcHV0ZmllbGQvZ2V0ZmllbGQgaW5z\ndHJ1Y3Rpb25zIHRvIHNlYXJjaCBmb3IKICAgICAgICBDb2RlIHRlbXBsYXRl\nID0gbmV3IENvZGUoKTsKICAgICAgICBJbnN0cnVjdGlvbiBwdXQgPSB0ZW1w\nbGF0ZS5wdXRmaWVsZCgpOwogICAgICAgIEluc3RydWN0aW9uIGdldCA9IHRl\nbXBsYXRlLmdldGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1Y3Rpb24gc3RhdCA9\nIHRlbXBsYXRlLmludm9rZXN0YXRpYygpOwoKICAgICAgICAvLyBsb29rIHRo\ncm91Z2ggYWxsIG1ldGhvZHM7IHRoaXMgaXMgZG9uZSBiZWZvcmUgYW55IG1l\ndGhvZHMgYXJlIGFkZGVkCiAgICAgICAgLy8gc28gd2UgZG9uJ3QgbmVlZCB0\nbyB3b3JyeSBhYm91dCBleGNsdWRpbmcgc3ludGhldGljIG1ldGhvZHMuCiAg\nICAgICAgQkNNZXRob2RbXSBtZXRob2RzID0gX3BjLmdldERlY2xhcmVkTWV0\naG9kcygpOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG1ldGhvZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nY29kZSA9IG1ldGhvZHNbaV0uZ2V0Q29kZShmYWxzZSk7CgogICAgICAgICAg\nICAvLyBkb24ndCBtb2RpZnkgdGhlIG1ldGhvZHMgc3BlY2lmaWVkIGJ5IHRo\nZSBhdXhpbGlhcnkgZW5oYW5jZXJzCiAgICAgICAgICAgIGlmIChjb2RlICE9\nIG51bGwgJiYgIXNraXBFbmhhbmNlKG1ldGhvZHNbaV0pKSB7CiAgICAgICAg\nICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBn\nZXQsIHRydWUsIHN0YXQpOwogICAgICAgICAgICAgICAgcmVwbGFjZUFuZFZh\nbGlkYXRlRmllbGRBY2Nlc3MoY29kZSwgcHV0LCBmYWxzZSwgc3RhdCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXBsYWNlcyBhbGwgaW5zdHJ1Y3Rpb25zIG1hdGNoaW5nIHRoZSBnaXZlbiB0\nZW1wbGF0ZSBpbiB0aGUgZ2l2ZW4KICAgICAqIGNvZGUgYmxvY2sgd2l0aCBj\nYWxscyB0byB0aGUgYXBwcm9wcmlhdGUgZ2VuZXJhdGVkIGdldHRlci9zZXR0\nZXIuCiAgICAgKgogICAgICogQHBhcmFtIGNvZGUgdGhlIGNvZGUgYmxvY2sg\ndG8gbW9kaWZ5OyB0aGUgY29kZSBpdGVyYXRvciB3aWxsCiAgICAgKiBiZSBw\nbGFjZWQgYmVmb3JlIHRoZSBmaXJzdCBpbnN0cnVjdGlvbiBvbiBtZXRob2Qg\nc3RhcnQsCiAgICAgKiBhbmQgd2lsbCBiZSBhZnRlciB0aGUgbGFzdCBpbnN0\ncnVjdGlvbiBvbiBtZXRob2QgY29tcGxldGlvbgogICAgICogQHBhcmFtIGlu\ncyB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb24gdG8gc2VhcmNoIGZvcjsgZWl0\naGVyIGEKICAgICAqIGdldGZpZWxkIG9yIHB1dGZpZWxkIGluc3RydWN0aW9u\nCiAgICAgKiBAcGFyYW0gZ2V0IGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGlz\nIGlzIGEgZ2V0IGluc3RydWN0aW9uCiAgICAgKiBAcGFyYW0gc3RhdCB0ZW1w\nbGF0ZSBpbnZva2VzdGF0aWMgaW5zdHJ1Y3Rpb24gdG8gcmVwbGFjZSB3aXRo\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVG\naWVsZEFjY2VzcyhDb2RlIGNvZGUsIEluc3RydWN0aW9uIGlucywKICAgICAg\nICBib29sZWFuIGdldCwgSW5zdHJ1Y3Rpb24gc3RhdCkgewogICAgICAgIGNv\nZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgRmllbGRJbnN0cnVjdGlvbiBm\naTsKICAgICAgICBNZXRob2RJbnN0cnVjdGlvbiBtaTsKICAgICAgICBDbGFz\nc01ldGFEYXRhIG93bmVyOwogICAgICAgIFN0cmluZyBuYW1lLCB0eXBlTmFt\nZSwgbWV0aG9kTmFtZTsKICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3\nYXJkKGlucykpIHsKICAgICAgICAgICAgLy8gYmFjayB1cCB0byB0aGUgbWF0\nY2hlZCBpbnN0cnVjdGlvbgogICAgICAgICAgICBmaSA9IChGaWVsZEluc3Ry\ndWN0aW9uKSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAgIG5hbWUgPSBm\naS5nZXRGaWVsZE5hbWUoKTsKICAgICAgICAgICAgdHlwZU5hbWUgPSBmaS5n\nZXRGaWVsZFR5cGVOYW1lKCk7CiAgICAgICAgICAgIG93bmVyID0gZ2V0UGVy\nc2lzdGVuY2VDYXBhYmxlT3duZXIobmFtZSwKICAgICAgICAgICAgICAgIGZp\nLmdldEZpZWxkRGVjbGFyZXJUeXBlKCkpOwoKICAgICAgICAgICAgaWYgKG93\nbmVyICE9IG51bGwKICAgICAgICAgICAgICAgICYmIG93bmVyLmdldEFjY2Vz\nc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkgewog\nICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgZGlyZWN0bHkgYWNjZXNzaW5n\nIGEgZmllbGQgaW4gYW5vdGhlciBjbGFzcwogICAgICAgICAgICAgICAgLy8g\naGllcmFyY2h5IHRoYXQgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MsIHNvbWV0aGlu\nZyBpcyB3cm9uZwogICAgICAgICAgICAgICAgaWYgKG93bmVyICE9IF9tZXRh\nICYmIG93bmVyLmdldERlY2xhcmVkRmllbGQobmFtZSkgIT0gbnVsbCAmJgog\nICAgICAgICAgICAgICAgICAgIF9tZXRhICE9IG51bGwgJiYgIW93bmVyLmdl\ndERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgICAgICAgICBpc0Fzc2ln\nbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nInByb3BlcnR5LWZpZWxkLWFjY2VzcyIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBPYmplY3RbXXsgX21ldGEsIG93bmVyLCBuYW1lLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRNZXRob2QoKS5nZXROYW1l\nKCkgfSkpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVjdGx5\nIGFjY2Vzc2luZyBhIHByb3BlcnR5LWJhY2tpbmcgZmllbGQgb3V0c2lkZQog\nICAgICAgICAgICAgICAgLy8gdGhlIHByb3BlcnR5IGluIG91ciBvd24gY2xh\nc3MsIG5vdGlmeSB1c2VyCiAgICAgICAgICAgICAgICBpZiAoaXNCYWNraW5n\nRmllbGRPZkFub3RoZXJQcm9wZXJ0eShuYW1lLCBjb2RlKSkKICAgICAgICAg\nICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWZpZWxkLWFjY2Vz\ncyIsIG5ldyBPYmplY3RbXXsgX21ldGEsCiAgICAgICAgICAgICAgICAgICAg\nICAgIG93bmVyLCBuYW1lLCBjb2RlLmdldE1ldGhvZCgpLmdldE5hbWUoKSB9\nLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gbm90IHBlcnNpc3RlbnQgZmllbGQ/CiAgICAgICAgICAgIGlmIChv\nd25lciA9PSBudWxsIHx8IG93bmVyLmdldERlY2xhcmVkRmllbGQobmFtZSkg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gcmVwbGFjZSB0aGUgaW5zdHJ1Y3Rpb24gd2l0aCBhIGNhbGwgdG8g\ndGhlIGdlbmVyYXRlZCBhY2Nlc3MKICAgICAgICAgICAgLy8gbWV0aG9kCiAg\nICAgICAgICAgIG1pID0gKE1ldGhvZEluc3RydWN0aW9uKSBjb2RlLnNldChz\ndGF0KTsKCiAgICAgICAgICAgIC8vIGludm9rZSB0aGUgcHJvcGVyIGFjY2Vz\ncyBtZXRob2QsIHdoZXRoZXIgZ2V0dGVyIG9yIHNldHRlcgogICAgICAgICAg\nICBTdHJpbmcgcHJlZml4ID0gKGdldCkgPyBQUkUgKyAiR2V0IiA6IFBSRSAr\nICJTZXQiOwogICAgICAgICAgICBtZXRob2ROYW1lID0gcHJlZml4ICsgbmFt\nZTsKICAgICAgICAgICAgaWYgKGdldCkgewogICAgICAgICAgICAgICAgbWku\nc2V0TWV0aG9kKGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgICAgICBtZXRob2ROYW1lLCB0eXBlTmFtZSwgbmV3IFN0cmluZ1td\nCiAgICAgICAgICAgICAgICAgICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1l\nKCkgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBt\naS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgICAgIG1ldGhvZE5hbWUsICJ2b2lkIiwgbmV3IFN0cmluZ1td\nCiAgICAgICAgICAgICAgICAgICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1l\nKCksIHR5cGVOYW1lIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGlu\nc3RydWN0aW9uIGFjY2Vzc2VzIGEgZmllbGQgdGhhdCBpcyBhIGJhY2tpbmcK\nICAgICAqIGZpZWxkIG9mIGFub3RoZXIgcHJvcGVydHkgaW4gdGhpcyBwcm9w\nZXJ0eS1hY2Nlc3MgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBpc0JhY2tpbmdGaWVsZE9mQW5vdGhlclByb3BlcnR5KFN0cmluZyBuYW1l\nLCBDb2RlIGNvZGUpIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWUgPSBjb2Rl\nLmdldE1ldGhvZCgpLmdldE5hbWUoKTsKICAgICAgICByZXR1cm4gISI8aW5p\ndD4iLmVxdWFscyhtZXRoTmFtZSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdG\naWVsZHMgIT0gbnVsbAogICAgICAgICAgICAmJiAhbmFtZS5lcXVhbHMoX2Jh\nY2tpbmdGaWVsZHMuZ2V0KG1ldGhOYW1lKSkKICAgICAgICAgICAgJiYgX2Jh\nY2tpbmdGaWVsZHMuY29udGFpbnNWYWx1ZShuYW1lKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBkZWNsYXJp\nbmcgUGVyc2lzdGVuY2VDYXBhYmxlIGNsYXNzIG9mCiAgICAgKiB0aGUgZ2l2\nZW4gZmllbGQuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkTmFtZSB0aGUg\nbmFtZSBvZiB0aGUgZmllbGQKICAgICAqIEBwYXJhbSBvd25lciB0aGUgbm9t\naW5hbCBvd25lciBvZiB0aGUgZmllbGQKICAgICAqIEByZXR1cm4gdGhlIG1l\ndGFkYXRhIGZvciB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIHR5cGUgdGhhdAog\nICAgICogZGVjbGFyZXMgdGhlIGZpZWxkIChhbmQgdGhlcmVmb3JlIGhhcyB0\naGUgc3RhdGljIG1ldGhvZCksIG9yIG51bGwgaWYgbm9uZQogICAgICovCiAg\nICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0UGVyc2lzdGVuY2VDYXBhYmxl\nT3duZXIoU3RyaW5nIGZpZWxkTmFtZSwKICAgICAgICBDbGFzcyBvd25lcikg\newogICAgICAgIC8vIGZpbmQgdGhlIGFjdHVhbCBhbmNlc3RvciBjbGFzcyB0\naGF0IGRlY2xhcmVzIHRoZSBmaWVsZCwgdGhlbgogICAgICAgIC8vIGNoZWNr\nIGlmIHRoZSBjbGFzcyBpcyBwZXJzaXN0ZW50LCBhbmQgaWYgdGhlIGZpZWxk\nIGlzIG1hbmFnZWQKICAgICAgICBmb3IgKDsgIW93bmVyLmdldE5hbWUoKS5l\ncXVhbHMoT2JqZWN0LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgICAgIG93\nbmVyID0gb3duZXIuZ2V0U3VwZXJjbGFzcygpKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBvd25lci5nZXREZWNsYXJlZEZpZWxkKGZp\nZWxkTmFtZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBpZiAob3duZXIuZ2V0TmFtZSgpLmVxdWFscyhPYmplY3Qu\nY2xhc3MuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgICAgaWYgKF9tZXRh\nICE9IG51bGwgJiYgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmlzSW50ZXJm\nYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBfbWV0YTsKCiAgICAgICAgcmV0\ndXJuIF9yZXBvcy5nZXRNZXRhRGF0YShvd25lciwgbnVsbCwgZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhbGwgc3ludGhldGljIG1ldGhv\nZHMgdG8gdGhlIGJ5dGVjb2RlIGJ5IGRlbGVnYXRpbmcgdG8KICAgICAqIHRo\nZSB2YXJpb3VzIGFkZFhYWE1ldGhvZHMgKCkgZnVuY3Rpb25zIGluIHRoaXMg\nY2xhc3MuIEluY2x1ZGVzCiAgICAgKiBhbGwgc3RhdGljIGZpZWxkIGFjY2Vz\ncyBtZXRob2RzLgogICAgICogTm90ZSB0aGF0IHRoZSAnc3RvY2snIG1ldGhv\nZHMgbGlrZSA8Y29kZT5wY0lzVHJhbnNhY3Rpb25hbDwvY29kZT4sCiAgICAg\nKiA8Y29kZT5wY0ZldGNoT2JqZWN0SWQ8L2NvZGU+LCBldGMgYXJlIGRlZmlu\nZWQgb25seSBpbiB0aGUKICAgICAqIGxlYXN0LWRlcml2ZWQgUGVyc2lzdGVu\nY2VDYXBhYmxlIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQ\nQ01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIGFkZENsZWFyRmllbGRzTWV0aG9kKCk7CiAgICAgICAg\nYWRkTmV3SW5zdGFuY2VNZXRob2QodHJ1ZSk7CiAgICAgICAgYWRkTmV3SW5z\ndGFuY2VNZXRob2QoZmFsc2UpOwogICAgICAgIGFkZE1hbmFnZWRGaWVsZENv\ndW50TWV0aG9kKCk7CiAgICAgICAgYWRkUmVwbGFjZUZpZWxkc01ldGhvZHMo\nKTsKICAgICAgICBhZGRQcm92aWRlRmllbGRzTWV0aG9kcygpOwogICAgICAg\nIGFkZENvcHlGaWVsZHNNZXRob2QoKTsKCiAgICAgICAgaWYgKF9tZXRhLmdl\ndFBDU3VwZXJjbGFzcygpID09IG51bGwpIHsKICAgICAgICAgICAgYWRkU3Rv\nY2tNZXRob2RzKCk7CiAgICAgICAgICAgIGFkZEdldFZlcnNpb25NZXRob2Qo\nKTsKICAgICAgICAgICAgYWRkUmVwbGFjZUZsYWdzTWV0aG9kKCk7CiAgICAg\nICAgICAgIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKTsKCiAgICAg\nICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSAhPSBDbGFzc01l\ndGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgYWRkTm9P\ncEFwcGxpY2F0aW9uSWRlbnRpdHlNZXRob2RzKCk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBhZGQgdGhlIGFwcCBpZCBtZXRob2RzIHRvIGVhY2ggc3ViY2xh\nc3MgcmF0aGVyCiAgICAgICAgLy8gdGhhbiBqdXN0IHRoZSBzdXBlcmNsYXNz\nLCBzaW5jZSBpdCBpcyBwb3NzaWJsZSB0byBoYXZlCiAgICAgICAgLy8gYSBz\ndWJjbGFzcyB3aXRoIGFuIGFwcCBpZCBoaWVyYXJjaHkgdGhhdCBtYXRjaGVz\nIHRoZQogICAgICAgIC8vIHBlcnNpc3RlbnQgY2xhc3MgaW5oZXJpdGFuY2Ug\naGllcmFyY2h5CiAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04KICAgICAgICAgICAg\nJiYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpID09IG51bGwgfHwgX21ldGEu\nZ2V0T2JqZWN0SWRUeXBlKCkKICAgICAgICAgICAgIT0gX21ldGEuZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKS5nZXRPYmplY3RJZFR5cGUoKSkpIHsKICAg\nICAgICAgICAgYWRkQ29weUtleUZpZWxkc1RvT2JqZWN0SWRNZXRob2QodHJ1\nZSk7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElkTWV0\naG9kKGZhbHNlKTsKICAgICAgICAgICAgYWRkQ29weUtleUZpZWxkc0Zyb21P\nYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRkQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAgIGFk\nZE5ld09iamVjdElkSW5zdGFuY2VNZXRob2QodHJ1ZSk7CiAgICAgICAgICAg\nIGFkZE5ld09iamVjdElkSW5zdGFuY2VNZXRob2QoZmFsc2UpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG1ldGhvZCB0byBjbGVh\nciBhbGwgcGVyc2lzdGVudCBmaWVsZHM7IHdlJ2xsIGNhbGwgdGhpcyBmcm9t\nCiAgICAgKiB0aGUgbmV3IGluc3RhbmNlIG1ldGhvZCB0byBlbnN1cmUgdGhh\ndCB1bmxvYWRlZCBmaWVsZHMgaGF2ZQogICAgICogZGVmYXVsdCB2YWx1ZXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDbGVhckZpZWxkc01ldGhv\nZCgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gcHJvdGVjdGVkIHZvaWQgcGNDbGVhckZpZWxkcyAoKQogICAg\nICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJDbGVhckZpZWxkcyIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIG51bGwp\nOwogICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1\ncGVyLnBjQ2xlYXJGaWVsZHMgKCkKICAgICAgICBpZiAoX21ldGEuZ2V0UENT\ndXBlcmNsYXNzKCkgIT0gbnVsbCkgewogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0VGhpcygpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiQ2xlYXJGaWVsZHMi\nLCB2b2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAg\nIH0KCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRE\nZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tpXS5n\nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSgwKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwo\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRz\nW2ldKTsKICAgICAgICB9CgogICAgICAgIGNvZGUudnJldHVybigpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\ncyB0aGUgPGNvZGU+cGNOZXdJbnN0YW5jZTwvY29kZT4gbWV0aG9kIHRvIHRo\nZSBieXRlY29kZS4KICAgICAqIFRoZXNlIG1ldGhvZHMgYXJlIHVzZWQgYnkg\ndGhlIGltcGwgaGVscGVyIHRvIGNyZWF0ZSBuZXcKICAgICAqIG1hbmFnZWQg\naW5zdGFuY2VzIGVmZmljaWVudGx5IHdpdGhvdXQgcmVmbGVjdGlvbi4KICAg\nICAqCiAgICAgKiBAcGFyYW0gb2lkIHNldCB0byB0cnVlIHRvIG1pbWljIHRo\nZSBtZXRob2QgdmVyc2lvbiB0aGF0IHRha2VzCiAgICAgKiBhbiBvaWQgdmFs\ndWUgYXMgd2VsbCBhcyBhIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZE5ld0luc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2lkKSB7\nCiAgICAgICAgLy8gcHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBwY05ld0lu\nc3RhbmNlICguLi4pCiAgICAgICAgQ2xhc3NbXSBhcmdzID0KICAgICAgICAg\nICAgKG9pZCkgPyBuZXcgQ2xhc3NbXXsgU01UWVBFLCBPYmplY3QuY2xhc3Ms\nIGJvb2xlYW4uY2xhc3MgfQogICAgICAgICAgICAgICAgOiBuZXcgQ2xhc3Nb\nXXsgU01UWVBFLCBib29sZWFuLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5ld0luc3RhbmNl\nIiwgUENUWVBFLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgYWJz\ndHJhY3QsIHRocm93IGEgVXNlckV4Y2VwdGlvbgogICAgICAgIGlmIChfcGMu\naXNBYnN0cmFjdCgpKSB7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNv\nZGUsIFVTRVJFWENFUCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoK\nICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBYWFggcGMgPSBuZXcgWFhY\nICgpOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAg\naW50IGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW5zdCk7CgogICAgICAgIC8vIGlm\nIChjbGVhcikKICAgICAgICAvLyAgIHBjLnBjQ2xlYXJGaWVsZHMgKCk7CiAg\nICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKChvaWQpID8gMiA6IDEpOwog\nICAgICAgIEp1bXBJbnN0cnVjdGlvbiBub2NsZWFyID0gY29kZS5pZmVxKCk7\nCiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiQ2xlYXJG\naWVsZHMiLCB2b2lkLmNsYXNzLCBudWxsKTsKCiAgICAgICAgLy8gcGMucGNT\ndGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBub2NsZWFyLnNldFRhcmdldChj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCkpOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CgogICAgICAgIC8vIHBjLnBjRmxhZ3MgPSBM\nT0FEX1JFUVVJUkVECiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlu\nc3QpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShQZXJzaXN0\nZW5jZUNhcGFibGUuTE9BRF9SRVFVSVJFRCk7CiAgICAgICAgY29kZS5wdXRm\naWVsZCgpLnNldEZpZWxkKFBSRSArICJGbGFncyIsIGJ5dGUuY2xhc3MpOwoK\nICAgICAgICAvLyBjb3B5IGtleSBmaWVsZHMgZnJvbSBvaWQKICAgICAgICBp\nZiAob2lkKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChp\nbnN0KTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJF\nICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJldHVybiBwYzsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyB0aGUgPGNvZGU+cHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNH\nZXRNYW5hZ2VkRmllbGRDb3VudCAoKTwvY29kZT4KICAgICAqIG1ldGhvZCB0\nbyB0aGUgYnl0ZWNvZGUsIHJldHVybmluZyB0aGUgaW5oZXJpdGVkIGZpZWxk\nIGNvdW50IGFkZGVkCiAgICAgKiB0byB0aGUgbnVtYmVyIG9mIG1hbmFnZWQg\nZmllbGRzIGluIHRoZSBjdXJyZW50IFBlcnNpc3RlbmNlQ2FwYWJsZSBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE1hbmFnZWRGaWVsZENv\ndW50TWV0aG9kKCkgewogICAgICAgIC8vIHByb3RlY3RlZCBzdGF0aWMgaW50\nIHBjR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0TWFuYWdlZEZp\nZWxkQ291bnQiLAogICAgICAgICAgICBpbnQuY2xhc3MsIG51bGwpOwogICAg\nICAgIG1ldGhvZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgbWV0aG9kLm1h\na2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgcGNJ\nbmhlcml0ZWRGaWVsZENvdW50CiAgICAgICAgLy8gYXdoaXRlOiB0aGUgYWJv\ndmUgc2hvdWxkIHdvcmssIGJ1dCBJJ20gc2VlaW5nIGEgbWVzc2VkIHVwIHNp\ndHVhdGlvbgogICAgICAgIC8vIGFsbCBvZiBhIHN1ZGRlbiB3aGVyZSB3aGVu\nIGEgc3ViY2xhc3MgY2FsbHMgdGhpcyBtZXRob2QsIGl0IHNvbWVob3cKICAg\nICAgICAvLyBoYXBwZW5zIGJlZm9yZSA8Y2xpbml0PiBpcyBldmVyIGludm9r\nZWQsIGFuZCBzbyBvdXIKICAgICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291\nbnQgZmllbGQgaXNuJ3QgaW5pdGlhbGl6ZWQhICBzbyBpbnN0ZWFkLAogICAg\nICAgIC8vIHJldHVybiA8ZmllbGRzPiArIDxzdXBlcmNsYXNzPi5wY0dldE1h\nbmFnZWRGaWVsZENvdW50ICgpCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCkubGVuZ3RoKTsKICAg\nICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRU\neXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgUFJFICsgIkdl\ndE1hbmFnZWRGaWVsZENvdW50IiwgaW50LmNsYXNzLmdldE5hbWUoKSwgbnVs\nbCk7CiAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIH0KICAgICAg\nICBjb2RlLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkfSBhbmQKICAgICAq\nIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNQcm92aWRlRmllbGRzfSBt\nZXRob2RzIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFByb3ZpZGVGaWVsZHNNZXRob2RzKCkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgdm9p\nZCBwY1Byb3ZpZGVGaWVsZCAoaW50IGZpZWxkTnVtYmVyKQogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJQcm92\naWRlRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgaW50LmNsYXNzIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhy\nb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVn\naW5Td2l0Y2hNZXRob2QoUFJFICsgIlByb3ZpZGVGaWVsZCIsIGNvZGUpOwoK\nICAgICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRo\ncm93IGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1kcy5s\nZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAgIGNv\nZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAgIFRh\nYmxlU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3aXRj\naCgpOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgICAg\nICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAg\nICAgLy8gPGZpZWxkPiA9IHBjU3RhdGVNYW5hZ2VyLnByb3ZpZGVkPHR5cGU+\nRmllbGQKICAgICAgICAgICAgLy8gICAgICh0aGlzLCBmaWVsZE51bWJlcik7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAgICAg\nICAgICAgICAgICAgIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAicHJv\ndmlkZWQiLCBmYWxzZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGNvZGUu\ndnJldHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWZh\ndWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAg\nICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0\naW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9u\nKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxp\nbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkfSBhbmQKICAg\nICAqIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmllbGRz\nfSBtZXRob2RzIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZFJlcGxhY2VGaWVsZHNNZXRob2RzKCkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMg\ndm9pZCBwY1JlcGxhY2VGaWVsZCAoaW50IGZpZWxkTnVtYmVyKQogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJS\nZXBsYWNlRmllbGQiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgaW50LmNsYXNzIH0pOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcg\ndGhyb3VnaCB0aGUgc3dpdGNoICgpCiAgICAgICAgaW50IHJlbExvY2FsID0g\nYmVnaW5Td2l0Y2hNZXRob2QoUFJFICsgIlJlcGxhY2VGaWVsZCIsIGNvZGUp\nOwoKICAgICAgICAvLyBpZiBubyBmaWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0\nIHRocm93IGV4Y2VwdGlvbgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1k\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29k\nZSwgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAg\nIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3\naXRjaCgpOwogICAgICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAg\nICAgICB0YWJpbnMuc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAg\nICAgICAgLy8gPGZpZWxkPiA9IHBjU3RhdGVNYW5hZ2VyLnJlcGxhY2U8dHlw\nZT5GaWVsZAogICAgICAgICAgICAvLyAgKHRoaXMsIGZpZWxkTnVtYmVyKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGhlIGFkZFNldE1hbmFn\nZWRWYWx1ZUNvZGUgY2FsbCBiZWxvdy4KICAgICAgICAgICAgICAgIHRhYmlu\ncy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwoKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QK\nICAgICAgICAgICAgICAgICAgICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUo\nKSwgInJlcGxhY2UiLCB0cnVlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAg\naWYgKCFmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLmlzUHJpbWl0aXZlKCkp\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAgICAgICAgICAgICAg\nIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAg\nICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRh\ncmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAgICAgICAgICAgKGNvZGUsIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0KCiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIGFkZE11bHRpcGxlRmll\nbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0NvcHlG\naWVsZHN9IG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRDb3B5RmllbGRzTWV0aG9kKCkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMg\ndm9pZCBwY0NvcHlGaWVsZCAoT2JqZWN0IHBjLCBpbnQgZmllbGQpCiAgICAg\nICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nIkNvcHlGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgp\nLAogICAgICAgICAgICBuZXcgU3RyaW5nW117IF9wYy5nZXROYW1lKCksIGlu\ndC5jbGFzcy5nZXROYW1lKCkgfSk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90\nZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhl\nIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNo\nTWV0aG9kKFBSRSArICJDb3B5RmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8g\naWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRp\nb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldERl\nY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCku\nc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaElu\nc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAg\nICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNl\ndEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgLy8gPGZpZWxkPiA9IG90aGVyLjxmaWVsZD47CiAgICAgICAgICAgICAg\nICAvLyBvciBzZXQ8ZmllbGQ+IChvdGhlci5nZXQ8ZmllbGQ+KTsKICAgICAg\nICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGFkZFNl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CgogICAgICAgICAg\nICAgICAgLy8gYnJlYWs7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAg\nICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAg\nICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5j\nbGFzcykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7Cgog\nICAgICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2Qp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBhZGQg\ndGhlIGNvZGUgY29tbW9uIHRvIHRoZSBiZWdpbm5pbmcgb2YgYm90aCB0aGUK\nICAgICAqIHBjUmVwbGFjZUZpZWxkIG1ldGhvZCBhbmQgdGhlIHBjUHJvdmlk\nZUZpZWxkIG1ldGhvZC4gVGhpcyBpbmNsdWRlcwogICAgICogY2FsY3VsYXRp\nbmcgdGhlIHJlbGF0aXZlIGZpZWxkIG51bWJlciBvZiB0aGUgZGVzaXJlZCBm\naWVsZCBhbmQgY2FsbGluZwogICAgICogdGhlIHN1cGVyY2xhc3MgaWYgbmVj\nZXNzYXJ5LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGluZGV4IGluIHdo\naWNoIHRoZSBsb2NhbCB2YXJpYWJsZSBob2xkaW5nIHRoZSByZWxhdGl2ZQog\nICAgICogZmllbGQgbnVtYmVyIGlzIHN0b3JlZAogICAgICovCiAgICBwcml2\nYXRlIGludCBiZWdpblN3aXRjaE1ldGhvZChTdHJpbmcgbmFtZSwgQ29kZSBj\nb2RlKSB7CiAgICAgICAgYm9vbGVhbiBjb3B5ID0gKFBSRSArICJDb3B5Rmll\nbGQiKS5lcXVhbHMobmFtZSk7CiAgICAgICAgaW50IGZpZWxkTnVtYmVyID0g\nKGNvcHkpID8gMSA6IDA7CgogICAgICAgIC8vIGludCByZWwgPSBmaWVsZE51\nbWJlciAtIHBjSW5oZXJpdGVkRmllbGRDb3VudAogICAgICAgIGludCByZWxM\nb2NhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29k\nZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAg\nICAgICAgY29kZS5pc3ViKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRM\nb2NhbChyZWxMb2NhbCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2Fs\nKHJlbExvY2FsKTsKCiAgICAgICAgLy8gc3VwZXI6IGlmIChyZWwgPCAwKSBz\ndXBlci5wY1JlcGxhY2VGaWVsZCAoZmllbGROdW1iZXIpOyByZXR1cm47CiAg\nICAgICAgLy8gbm8gc3VwZXI6IGlmIChyZWwgPCAwKSB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZnZSgpOwogICAgICAgIGlmIChfbWV0YS5n\nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBTdHJp\nbmdbXSBhcmdzOwogICAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAg\nICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgZ2V0VHlwZShfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICBn\nZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0cmluZ1tdeyBpbnQu\nY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5z\nZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAg\nICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLCBu\nYW1lLCAKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBh\ncmdzKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CgogICAgICAgIGlmaW5zLnNldFRh\ncmdldChjb2RlLm5vcCgpKTsKICAgICAgICByZXR1cm4gcmVsTG9jYWw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGhlbHBlciBtZXRob2QsIGdpdmVu\nIHRoZSBwY1JlcGxhY2VGaWVsZCBvciBwY1Byb3ZpZGVGaWVsZAogICAgICog\nbWV0aG9kLCBhZGRzIHRoZSBieXRlY29kZSBmb3IgdGhlIGNvcnJlc3BvbmRp\nbmcgJ3BsdXJhbCcgdmVyc2lvbgogICAgICogb2YgdGhlIG1ldGhvZCAtLSB0\naGUgdmVyc2lvbiB0aGF0IHRha2VzIGFuIGludFtdIG9mIGZpZWxkcyB0bwog\nICAgICogdG8gYWNjZXNzIHJhdGhlciB0aGFuIGEgc2luZ2xlIGZpZWxkLiBU\naGUgbXVsdGlwbGUgZmllbGRzIHZlcnNpb24KICAgICAqIHNpbXBseSBsb29w\ncyB0aHJvdWdoIHRoZSBwcm92aWRlZCBpbmRleGVzIGFuZCBkZWxlZ2F0ZXMg\ndG8gdGhlCiAgICAgKiBzaW5ndWxhciB2ZXJzaW9uIGZvciBlYWNoIG9uZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE11bHRpcGxlRmllbGRzTWV0\naG9kVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUpIHsKICAgICAgICBib29sZWFu\nIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhzaW5nbGUuZ2V0\nTmFtZSgpKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgPG1ldGhvZD5zIChp\nbnRbXSBmaWVsZHMpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKGNvcHkpID8g\nbmV3IENsYXNzW117IE9iamVjdC5jbGFzcywgaW50W10uY2xhc3MgfQogICAg\nICAgICAgICA6IG5ldyBDbGFzc1tdeyBpbnRbXS5jbGFzcyB9OwogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKHNpbmdsZS5n\nZXROYW1lKCkgKyAicyIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3Mp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoK\nICAgICAgICBpbnQgZmllbGROdW1iZXJzID0gMDsKICAgICAgICBpbnQgaW5z\ndCA9IDA7CiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgZmllbGRO\ndW1iZXJzID0gMTsKCiAgICAgICAgICAgIC8vIFhYWCBvdGhlciA9IChYWFgp\nIHBjOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfcGMpOwogICAg\nICAgICAgICBpbnN0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAg\nICAgICAgIC8vIGlmIChvdGhlci5wY1N0YXRlTWFuYWdlciAhPSBwY1N0YXRl\nTWFuYWdlcikKICAgICAgICAgICAgLy8JdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbgogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwoaW5zdCk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgSnVtcEluc3RydWN0\naW9uIGlmaW5zID0gY29kZS5pZmFjbXBlcSgpOwogICAgICAgICAgICB0aHJv\nd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xh\nc3MpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7\nCgogICAgICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkK\nICAgICAgICAgICAgLy8gIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24KICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwg\nU01UWVBFKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgp\nOwogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBpZmlucy5zZXRUYXJn\nZXQoY29kZS5ub3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBmb3IgKGlu\ndCBpID0gMDsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7\nCiAgICAgICAgaW50IGlkeCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7\nCiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpZHgpOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiB0ZXN0aW5zID0gY29kZS5nbzIoKTsKCiAgICAg\nICAgLy8gPG1ldGhvZD4gKGZpZWxkc1tpXSk7CiAgICAgICAgSW5zdHJ1Y3Rp\nb24gYm9keWlucyA9IGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGlmIChjb3B5KQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKGZpZWxkTnVtYmVycyk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2Fs\nKGlkeCk7CiAgICAgICAgY29kZS5pYWxvYWQoKTsKICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2luZ2xlKTsKCiAgICAgICAgLy8g\naSsrOwogICAgICAgIGNvZGUuaWluYygpLnNldEluY3JlbWVudCgxKS5zZXRM\nb2NhbChpZHgpOwoKICAgICAgICAvLyBpIDwgZmllbGRzLmxlbmd0aAogICAg\nICAgIHRlc3RpbnMuc2V0VGFyZ2V0KGNvZGUuaWxvYWQoKS5zZXRMb2NhbChp\nZHgpKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1i\nZXJzKTsKICAgICAgICBjb2RlLmFycmF5bGVuZ3RoKCk7CiAgICAgICAgY29k\nZS5pZmljbXBsdCgpLnNldFRhcmdldChib2R5aW5zKTsKICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIHRoZSAnc3RvY2snIG1ldGhvZHMgdG8gdGhl\nIGJ5dGVjb2RlOyB0aGVzZSBpbmNsdWRlIG1ldGhvZHMKICAgICAqIGxpa2Ug\ne0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0ZldGNoT2JqZWN0SWR9CiAg\nICAgKiBhbmQge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0lzVHJhbnNh\nY3Rpb25hbH0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTdG9ja01l\ndGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIHBjR2V0R2VuZXJpY0NvbnRleHQKICAgICAgICB0cmFu\nc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNsYXJl\nZE1ldGhvZAogICAgICAgICAgICAoImdldCIgKyBDT05URVhUTkFNRSwgKENs\nYXNzW10pIG51bGwpKTsKCiAgICAgICAgLy8gcGNGZXRjaE9iamVjdElkCiAg\nICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChTTVRZUEUu\nZ2V0RGVjbGFyZWRNZXRob2QKICAgICAgICAgICAgKCJmZXRjaE9iamVjdElk\nIiwgKENsYXNzW10pIG51bGwpKTsKCiAgICAgICAgLy8gcGNJc0RlbGV0ZWQK\nICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQ\nRS5nZXREZWNsYXJlZE1ldGhvZAogICAgICAgICAgICAoImlzRGVsZXRlZCIs\nIChDbGFzc1tdKSBudWxsKSk7CgogICAgICAgIC8vIHBjSXNEaXJ0eQogICAg\nICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoU01UWVBFLmdl\ndERlY2xhcmVkTWV0aG9kCiAgICAgICAgICAgICgiaXNEaXJ0eSIsIChDbGFz\nc1tdKSBudWxsKSk7CgogICAgICAgIC8vIHBjSXNOZXcKICAgICAgICB0cmFu\nc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNsYXJl\nZE1ldGhvZAogICAgICAgICAgICAoImlzTmV3IiwgKENsYXNzW10pIG51bGwp\nKTsKCiAgICAgICAgLy8gcGNJc1BlcnNpc3RlbnQKICAgICAgICB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXREZWNsYXJlZE1l\ndGhvZAogICAgICAgICAgICAoImlzUGVyc2lzdGVudCIsIChDbGFzc1tdKSBu\ndWxsKSk7CgogICAgICAgIC8vIHBjSXNUcmFuc2FjdGlvbmFsCiAgICAgICAg\ndHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChTTVRZUEUuZ2V0RGVj\nbGFyZWRNZXRob2QKICAgICAgICAgICAgKCJpc1RyYW5zYWN0aW9uYWwiLCAo\nQ2xhc3NbXSkgbnVsbCkpOwoKICAgICAgICAvLyBwY1NlcmlhbGl6aW5nCiAg\nICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZChTTVRZUEUu\nZ2V0RGVjbGFyZWRNZXRob2QKICAgICAgICAgICAgKCJzZXJpYWxpemluZyIs\nIChDbGFzc1tdKSBudWxsKSk7CgogICAgICAgIC8vIHBjRGlydHkKICAgICAg\nICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKFNNVFlQRS5nZXRE\nZWNsYXJlZE1ldGhvZCgiZGlydHkiLAogICAgICAgICAgICBuZXcgQ2xhc3Nb\nXXsgU3RyaW5nLmNsYXNzIH0pKTsKCiAgICAgICAgLy8gcGNHZXRTdGF0ZU1h\nbmFnZXIKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkdldFN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlci5jbGFzcywgbnVsbCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naC5nZXRDb2RlKHRydWUpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU3RhdGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIGEgc3RvY2sgbWV0aG9kIHRv\nIHRoZSBieXRlY29kZS4gRWFjaAogICAgICogc3RvY2sgbWV0aG9kIHNpbXBs\neSBkZWxlZ2F0ZXMgdG8gYSBjb3JyZXNwb25kaW5nIFN0YXRlTWFuYWdlciBt\nZXRob2QuCiAgICAgKiBHaXZlbiB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhvZCwg\ndGhlbiwgdGhpcyBmdW5jdGlvbiB0cmFuc2xhdGVzIGl0IGludG8KICAgICAq\nIHRoZSB3cmFwcGVyIG1ldGhvZCB0aGF0IHNob3VsZCBiZSBhZGRlZCB0byB0\naGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0cmFuc2xh\ndGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKE1ldGhvZCBtKSB7CiAgICAgICAg\nLy8gZm9ybSB0aGUgbmFtZSBvZiB0aGUgbWV0aG9kIGJ5IHByZXBlbmRpbmcg\nJ3BjJyB0byB0aGUgc20gbWV0aG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBQ\nUkUgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG0uZ2V0TmFtZSgpKTsKICAg\nICAgICBDbGFzc1tdIHBhcmFtcyA9IG0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsK\nICAgICAgICBDbGFzcyByZXR1cm5UeXBlID0gbS5nZXRSZXR1cm5UeXBlKCk7\nCgogICAgICAgIC8vIGFkZCB0aGUgbWV0aG9kIHRvIHRoZSBwYwogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKG5hbWUsIHJl\ndHVyblR5cGUsIHBhcmFtcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdl\nciA9PSBudWxsKSByZXR1cm4gPGRlZmF1bHQ+OwogICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGlmIChy\nZXR1cm5UeXBlLmVxdWFscyhib29sZWFuLmNsYXNzKSkKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICBlbHNl\nIGlmICghcmV0dXJuVHlwZS5lcXVhbHModm9pZC5jbGFzcykpCiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS54\ncmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBlKTsKCiAgICAgICAgLy8gcmV0\ndXJuIHBjU3RhdGVNYW5hZ2VyLjxtZXRob2Q+ICg8YXJncz4pOwogICAgICAg\nIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0o\naSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nbSk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBl\nKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjR2V0\nVmVyc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRWZXJzaW9u\nIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\naWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQo\nKTsKCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1cm4gbnVs\nbDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJuIDx2ZXJz\naW9uRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0gdG9Qcmlt\naXRpdmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3\ncmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkgewog\nICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFwcGVyKTsK\nICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lv\nbkZpZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZp\nZWxkLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5pdD4iLCB2\nb2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB2\nZXJzaW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfQog\nICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1cm4gcGNT\ndGF0ZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlucy5zZXRU\nYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUs\nICJnZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxs\nKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNp\nb24gZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBvciBudWxs\nIGlmCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJpbWl0aXZl\nLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZlV3JhcHBl\ncihGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4u\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBDaGFy\nYWN0ZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAg\ncmV0dXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nICAgIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9ydC5jbGFz\nczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQ\nZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlRmxhZ3N9CiAgICAgKiBtZXRo\nb2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkUmVwbGFjZUZsYWdzTWV0aG9kKCkgewogICAgICAgIC8vIHB1YmxpYyBm\naW5hbCB2b2lkIHBjUmVwbGFjZUZsYWdzICgpCiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VGbGFn\ncyIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIENv\nZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBp\nZiAocGNTdGF0ZU1hbmFnZXIgIT0gbnVsbCkKICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxk\nKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0\naW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgLy8gcGNGbGFncyA9IHBjU3RhdGVNYW5hZ2Vy\nLnJlcGxhY2VGbGFncyAoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQobG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJyZXBsYWNlRmxh\nZ3MiLAogICAgICAgICAgICBieXRlLmNsYXNzLCBudWxsKTsKICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoUFJFICsgIkZsYWdzIiwgYnl0ZS5j\nbGFzcyk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0Bs\naW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VTdGF0ZU1hbmFnZXJ9\nCiAgICAgKiBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgpIHsK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY1JlcGxhY2VTdGF0ZU1hbmFnZXIg\nKFN0YXRlTWFuYWdlciBzbSkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFjZVN0YXRlTWFuYWdlciIs\nCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTTVRZUEUg\nfSk7CiAgICAgICAgbWV0aG9kLnNldFN5bmNocm9uaXplZCh0cnVlKTsKICAg\nICAgICBtZXRob2QuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24o\nU2VjdXJpdHlFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiAocGNTdGF0\nZU1hbmFnZXIgIT0gbnVsbCkKICAgICAgICAvLwlwY1N0YXRlTWFuYWdlciA9\nIHBjU3RhdGVNYW5hZ2VyLnJlcGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBFLCAicmVwbGFjZVN0YXRlTWFu\nYWdlciIsCiAgICAgICAgICAgIFNNVFlQRSwgbmV3IENsYXNzW117IFNNVFlQ\nRSB9KTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8vIFNl\nY3VyaXR5TWFuYWdlciBzZWMgPSBTeXN0ZW0uZ2V0U2VjdXJpdHlNYW5hZ2Vy\nICgpOwogICAgICAgIC8vIGlmIChzZWMgIT0gbnVsbCkKICAgICAgICAvLwkJ\nc2VjLmNoZWNrUGVybWlzc2lvbiAoUGVybWlzc2lvbi5TRVRfU1RBVEVfTUFO\nQUdFUik7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKFN5c3RlbS5jbGFzcywKICAgICAgICAgICAgImdl\ndFNlY3VyaXR5TWFuYWdlciIsIFNlY3VyaXR5TWFuYWdlci5jbGFzcywgbnVs\nbCkpOwoKICAgICAgICAvLyBwY1N0YXRlTWFuYWdlciA9IHNtOwogICAgICAg\nIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBQZXJzaXN0ZW5j\nZUNhcGFibGUgbWV0aG9kcyBkZWFsaW5nIHdpdGggYXBwbGljYXRpb24KICAg\nICAqIGlkZW50aXR5IGFuZCBnaXZlcyB0aGVtIG5vLW9wIGltcGxlbWVudGF0\naW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5vT3BBcHBsaWNh\ndGlvbklkZW50aXR5TWV0aG9kcygpIHsKICAgICAgICAvLyBwdWJsaWMgdm9p\nZCBwY0NvcHlLZXlGaWVsZHNUb09iamVjdElkIChPYmplY3RJZEZpZWxkU3Vw\ncGxpZXIgZnMsCiAgICAgICAgLy8gCU9iamVjdCBvaWQpCiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlL\nZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywg\nbmV3IENsYXNzW117IE9JREZTVFlQRSwgT2JqZWN0LmNsYXNzIH0pOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxk\nc1RvT2JqZWN0SWQgKE9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElk\nIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGND\nb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIChPYmplY3RJZEZpZWxkQ29uc3Vt\nZXIgZmMsCiAgICAgICAgLy8JT2JqZWN0IG9pZCkKICAgICAgICBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21P\nYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPSURGQ1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAg\nLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIChP\nYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBwY05ld09iamVjdElk\nSW5zdGFuY2UgKCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9i\namVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZElu\nc3RhbmNlIChPYmplY3Qgb2JqKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAg\nICAgICAgT2JqZWN0LmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUu\nYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNDb3B5S2V5RmllbGRzVG9P\nYmplY3RJZDwvY29kZT4gbWV0aG9kcwogICAgICogdG8gY2xhc3NlcyB1c2lu\nZyBhcHBsaWNhdGlvbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZENvcHlLZXlGaWVsZHNUb09iamVjdElkTWV0aG9kKGJvb2xlYW4g\nZmllbGRNYW5hZ2VyKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxk\nc1RvT2JqZWN0SWQgKE9iamVjdElkRmllbGRTdXBwbGllciBmcywKICAgICAg\nICAvLwlPYmplY3Qgb2lkKQogICAgICAgIFN0cmluZ1tdIGFyZ3MgPSAoZmll\nbGRNYW5hZ2VyKSA/CiAgICAgICAgICAgIG5ldyBTdHJpbmdbXXsgT0lERlNU\nWVBFLmdldE5hbWUoKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9CiAgICAg\nICAgICAgIDogbmV3IFN0cmluZ1tdeyBPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzaW5n\nbGUgZmllbGQgaWRlbnRpdHkgYWx3YXlzIHRocm93cyBleGNlcHRpb24KICAg\nICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAg\nICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJTlRFUk5FWENFUCk7CiAgICAg\nICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9t\nZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwpIHsKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShpKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21l\ndGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBQUkUgKyAiQ29weUtleUZp\nZWxkc1RvT2JqZWN0SWQiLCB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBPYmplY3QgaWQgPSBvaWQ7CiAgICAg\nICAgaWYgKGZpZWxkTWFuYWdlcikKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDEpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwoKICAgICAgICBpZiAoX21ldGEuaXNPYmpl\nY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAgICAgICAvLyBvaWQgPSAoKE9i\namVjdElkKSBpZCkuZ2V0SWQgKCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywg\nImdldElkIiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyA8b2lkIHR5cGU+IGlkID0gKDxvaWQg\ndHlwZT4pIG9pZDsKICAgICAgICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRP\nYmplY3RJZFR5cGUoKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChp\nZCk7CgogICAgICAgIC8vIGludCBpbmhlcml0ZWQgPSBwY0luaGVyaXRlZEZp\nZWxkQ291bnQ7CiAgICAgICAgaW50IGluaGVyaXRlZCA9IDA7CiAgICAgICAg\naWYgKGZpZWxkTWFuYWdlcikgewogICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAgICAg\nIGluaGVyaXRlZCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAg\nICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoaW5oZXJpdGVkKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlkLjxmaWVsZD4gPSBmcy5mZXRjaDx0eXBl\nPkZpZWxkICg8aW5kZXg+KTsgb3IuLi4KICAgICAgICAvLyBpZC48ZmllbGQ+\nID0gcGMuPGZpZWxkPjsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgQ2xhc3MgdHlw\nZTsKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICBuYW1lID0gZm1kc1tpXS5nZXROYW1lKCk7CiAg\nICAgICAgICAgIHR5cGUgPSBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBl\nKCk7CgogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwog\nICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgICAgICBj\nb2RlLmlsb2FkKCkuc2V0TG9jYWwoaW5oZXJpdGVkKTsKICAgICAgICAgICAg\nICAgIGNvZGUuaWFkZCgpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAoZ2V0\nRmllbGRTdXBwbGllck1ldGhvZCh0eXBlKSk7CgogICAgICAgICAgICAgICAg\nLy8gaWYgdGhlIHR5cGUgb2YgdGhpcyBmaWVsZCBtZXRhIGRhdGEgaXMKICAg\nICAgICAgICAgICAgIC8vIG5vbi1wcmltaXRpdmUgYW5kIG5vbi1zdHJpbmcs\nIGJlIHN1cmUgdG8gY2FzdAogICAgICAgICAgICAgICAgLy8gdG8gdGhlIGFw\ncHJvcHJpYXRlIHR5cGUuCiAgICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQ\ncmltaXRpdmUoKQogICAgICAgICAgICAgICAgICAgICYmICF0eXBlLmdldE5h\nbWUoKS5lcXVhbHMoU3RyaW5nLmNsYXNzLmdldE5hbWUoKSkpCiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKHR5cGUpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwoKICAgICAgICAg\nICAgICAgIC8vIGdldCBpZC9wayBmcm9tIHBjIGluc3RhbmNlCiAgICAgICAg\nICAgICAgICBpZiAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgICAgIGFkZEV4dHJhY3RP\nYmplY3RJZEZpZWxkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgp\nID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAg\nICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKGZpbmREZWNsYXJlZEZpZWxk\nKG9pZFR5cGUsIG5hbWUpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGZpbmREZWNs\nYXJlZE1ldGhvZAogICAgICAgICAgICAgICAgICAgIChvaWRUeXBlLCAic2V0\nIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUobmFtZSksCiAgICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB0eXBlIH0pKTsKICAgICAgICB9\nCiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGNvZGUgdG8gZXh0cmFj\ndCB0aGUgaWQgb2YgdGhlIGdpdmVuIHByaW1hcnkga2V5IHJlbGF0aW9uIGZp\nZWxkIGZvcgogICAgICogc2V0dGluZyBpbnRvIGFuIG9iamVjdGlkIGluc3Rh\nbmNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRXh0cmFjdE9iamVj\ndElkRmllbGRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBGaWVsZE1ldGFEYXRhIHBr\nKSB7CiAgICAgICAgLy8gaWYgKHZhbCAhPSBudWxsKSAKICAgICAgICAvLyAg\ndmFsID0gKChQZXJzaXN0ZW5jZUNhcGFibGUpIHZhbCkucGNGZXRjaE9iamVj\ndElkKCk7CiAgICAgICAgaW50IHBjID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKHBjKTsKICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocGMpOwogICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBpZm51bGwxID0gY29kZS5pZm51bGwoKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOyAKICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChQZXJzaXN0\nZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgIFBSRSArICJGZXRjaE9i\namVjdElkIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBpbnQgb2lk\nID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFz\ndG9yZSgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndExvY2FsKG9pZCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmbnVsbDIg\nPSBjb2RlLmlmbnVsbCgpOyAKCiAgICAgICAgLy8gZm9yIGRhdGFzdG9yZSAv\nIHNpbmdsZS1maWVsZCBpZGVudGl0eToKICAgICAgICAvLyBpZiAodmFsICE9\nIG51bGwpCiAgICAgICAgLy8gICB2YWwgPSAoKE9wZW5KUEFJZCkgdmFsKS5n\nZXRJZCgpOwogICAgICAgIENsYXNzTWV0YURhdGEgcGttZXRhID0gcGsuZ2V0\nRGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBpbnQgcGtjb2RlID0g\ncGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCk7CiAgICAgICAgQ2xhc3Mg\ncGt0eXBlID0gcGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICBp\nZiAocGttZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEu\nSURfREFUQVNUT1JFIAogICAgICAgICAgICAmJiBwa2NvZGUgPT0gSmF2YVR5\ncGVzLkxPTkcpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKG9pZCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShJ\nZC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChJZC5jbGFzcywgImdldElkIiwgCiAgICAgICAgICAgICAgICBs\nb25nLmNsYXNzLCBudWxsKTsKICAgICAgICB9IGVsc2UgaWYgKHBrbWV0YS5n\nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9S\nRSkgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsK\nICAgICAgICB9IGVsc2UgaWYgKHBrbWV0YS5pc09wZW5KUEFJZGVudGl0eSgp\nKSB7CiAgICAgICAgICAgIHN3aXRjaCAocGtjb2RlKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKEJ5dGUuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEU6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKEJ5dGVJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJ5dGVJZC5jbGFzcywgImdl\ndElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZS5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlw\nZXMuQllURV9PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChCeXRlLmNsYXNzLCAiPGluaXQ+IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHtieXRlLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKENoYXJh\nY3Rlci5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsK\nICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQ2hhcklkLmNsYXNzKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoQ2hhcklkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAg\nICAgICBjaGFyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAocGtjb2RlID09IEphdmFUeXBlcy5DSEFSX09CSikKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKENo\nYXJhY3Rlci5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAi\nPGluaXQ+Iiwgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2NoYXIuY2xhc3N9\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShJbnRlZ2VyLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8v\nIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9p\nZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKEludElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoSW50SWQuY2xhc3MsICJnZXRJZCIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuSU5U\nX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKEludGVnZXIuY2xhc3MsICI8aW5pdD4iLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW10ge2ludC5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShMb25nLmNsYXNz\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAg\nICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShMb25nSWQuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChMb25nSWQu\nY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUg\nPT0gSmF2YVR5cGVzLkxPTkdfT0JKKQogICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoTG9uZy5jbGFzcywg\nIjxpbml0PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXSB7bG9uZy5jbGFzc30pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNl\ndFR5cGUoU2hvcnQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTaG9ydElkLmNs\nYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoU2hvcnRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgc2hvcnQuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLlNIT1JUX09CSikK\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKFNob3J0LmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtzaG9y\ndC5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRGF0ZUlkLmNsYXNz\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoRGF0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAg\nICAgICAgICAgICBEYXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNU\nUklORzoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUoU3RyaW5nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChTdHJpbmdJZC5jbGFz\ncywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGVsc2UgaWYgKHBrbWV0YS5nZXRPYmplY3RJZFR5cGUoKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGt0eXBlKTsK\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKG9pZCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdvMiA9IGNvZGUu\nZ28yKCk7CgogICAgICAgIC8vIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAv\nLyAgIHZhbCA9IDxkZWZhdWx0PjsKICAgICAgICBJbnN0cnVjdGlvbiBkZWY7\nCiAgICAgICAgc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoYnl0\nZSkgMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZSgoY2hhcikgMCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgog\nICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKDBEKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDApOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoMEwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgZGVm\nID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChzaG9ydCkgMCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAg\nICAgICAgfQogICAgICAgIGlmbnVsbDEuc2V0VGFyZ2V0KGRlZik7CiAgICAg\nICAgaWZudWxsMi5zZXRUYXJnZXQoZGVmKTsKICAgICAgICBnbzIuc2V0VGFy\nZ2V0KGNvZGUubm9wKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0\naGUgPGNvZGU+cGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkPC9jb2RlPiBt\nZXRob2RzCiAgICAgKiB0byBjbGFzc2VzIHVzaW5nIGFwcGxpY2F0aW9uIGlk\nZW50aXR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxkTWFuYWdlcikK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQg\nKE9iamVjdElkRmllbGRDb25zdW1lciBmYywKICAgICAgICAvLwlPYmplY3Qg\nb2lkKQogICAgICAgIFN0cmluZ1tdIGFyZ3MgPSAoZmllbGRNYW5hZ2VyKSAK\nICAgICAgICAgICAgPyAgbmV3IFN0cmluZ1tdeyBPSURGQ1RZUEUuZ2V0TmFt\nZSgpLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpIH0KICAgICAgICAgICAgOiBu\nZXcgU3RyaW5nW117IE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAg\nICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gY2FsbCBzdXBlcmNs\nYXNzIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3Mo\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAg\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAg\nICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQiLCB2\nb2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZmllbGRNYW5hZ2VyKQogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CgogICAgICAgIGlmICghX21ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgp\nKSB7CiAgICAgICAgICAgIC8vIG9pZCA9ICgoT2JqZWN0SWQpIGlkKS5nZXRJ\nZCAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKE9i\namVjdElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICB9CgogICAg\nICAgIC8vIDxvaWQgdHlwZT4gY2FzdCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAg\nICAgICAgaW50IGlkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAg\nICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwog\nICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAv\nLyBmcy5zdG9yZTx0eXBlPkZpZWxkICg8aW5kZXg+LCBpZC48ZmllbGQ+KTsg\nb3IuLi4KICAgICAgICAvLyB0aGlzLjxmaWVsZD4gPSBpZC48ZmllbGQ+CiAg\nICAgICAgLy8gb3IgZm9yIHNpbmdsZSBmaWVsZCBpZGVudGl0eTogaWQuZ2V0\nSWQgKCkKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAg\nICBDbGFzcyB1bndyYXBwZWQ7CiAgICAgICAgU3RyaW5nIG5hbWU7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNb\naV0uZ2V0TmFtZSgpOwogICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRP\nYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICBpZiAoIWZpZWxkTWFu\nYWdlciAKICAgICAgICAgICAgICAgICYmIGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgewogICAgICAgICAgICAgICAg\nLy8gc20uZ2V0UENQcmltYXJ5S2V5KG9pZCwgaSArIHBjSW5oZXJpdGVkRmll\nbGRDb3VudCk7IAogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOyAv\nLyBsZWF2ZSBvcmlnIG9uIHN0YWNrIHRvIHNldCB2YWx1ZSBpbnRvCiAgICAg\nICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQp\nOwogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkp\nOwogICAgICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJ\nTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pYWRk\nKCk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZChTdGF0ZU1hbmFnZXIuY2xhc3MsIAogICAgICAgICAgICAgICAg\nICAgICJnZXRQQ1ByaW1hcnlLZXkiLCBPYmplY3QuY2xhc3MsIAogICAgICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQu\nY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgdW53cmFwcGVkID0gKGZtZHNb\naV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgCiAg\nICAgICAgICAgICAgICAgICAgPyB0eXBlIDogdW53cmFwU2luZ2xlRmllbGRJ\nZGVudGl0eShmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZE1h\nbmFnZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKGkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3Rh\ndGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwoKICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0g\ndHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChpZCk7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChvaWRU\neXBlID09IE9iamVjdElkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNs\nYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVs\nZE1hbmFnZXIgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdW53cmFwcGVkLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcHBlZCAhPSB0eXBlKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyB1bndyYXBw\nZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgICAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKGZpbmREZWNsYXJlZEZpZWxkKG9pZFR5cGUs\nIG5hbWUpKTsKICAgICAgICAgICAgICAgIGVsc2UgLy8gcHJvcGVydHkKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoZmluZERlY2xhcmVkR2V0dGVyTWV0aG9kCiAgICAgICAgICAgICAgICAg\nICAgICAgIChvaWRUeXBlLCBTdHJpbmdVdGlscy5jYXBpdGFsaXplKG5hbWUp\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFn\nZXIpCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNl\ndE1ldGhvZChnZXRGaWVsZENvbnN1bWVyTWV0aG9kKHR5cGUpKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9CiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGlmIHRoZSBjbGFzcyB1c2VzIHRoZSBDbGFz\ncy9TdHJpbmcgY29uc3RydWN0b3IKICAgICAqIGluc3RlYWQgb2YganVzdCBT\ndHJpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzQ2xhc3NT\ndHJpbmdJZENvbnN0cnVjdG9yKCkgewogICAgICAgIGlmIChfbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9O\nKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAg\naWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAg\naWYgKF9tZXRhLmdldE9iamVjdElkVHlwZSgpID09IE9iamVjdElkLmNsYXNz\nKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgfQoKICAgICAgICBDbGFzcyBv\naWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xh\nc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAg\nICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAg\nICBvaWRUeXBlLmdldENvbnN0cnVjdG9yKG5ldyBDbGFzc1tdeyBTdHJpbmcu\nY2xhc3MgfSk7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwog\nICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhl\nIGdpdmVuIGZpZWxkIGlzIGEgd3JhcHBlci10eXBlIHNpbmdsZSBmaWVsZCBp\nZGVudGl0eSBwcmltYXJ5IGtleSwKICAgICAqIHJldHVybiBpdHMgY29ycmVz\ncG9uZGluZyBwcmltaXRpdmUgY2xhc3MuIEVsc2UgcmV0dXJuIHRoZSBmaWVs\nZCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHVud3JhcFNpbmds\nZUZpZWxkSWRlbnRpdHkoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBp\nZiAoIWZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCkuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5cGUo\nKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGJ5dGUuY2xhc3M7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGNoYXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9P\nQko6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAg\nICByZXR1cm4gc2hvcnQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmcuY2xh\nc3M7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGZldGNoIG1ldGhvZCBv\nZiB0aGUgT2JqZWN0SWRGaWVsZFN1cHBsaWVyIGZvcgogICAgICogYSBmaWVs\nZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBNZXRo\nb2QgZ2V0RmllbGRTdXBwbGllck1ldGhvZChDbGFzcyB0eXBlKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBnZXRNZXRob2QoT0lERlNUWVBFLCB0eXBlLCAiZmV0Y2giLCB0cnVlLCBm\nYWxzZSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBwcm9wZXIgZmV0Y2ggbWV0aG9kIG9mIHRoZSBPYmplY3RJZEZpZWxkQ29u\nc3VtZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9mIHRoZSBnaXZlbiB0eXBlLgog\nICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRGaWVsZENvbnN1bWVyTWV0\naG9kKENsYXNzIHR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChPSURGQ1RZUEUs\nIHR5cGUsICJzdG9yZSIsIGZhbHNlLCBmYWxzZSwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyB0aGUgcGNOZXdPYmplY3RJZEluc3RhbmNl\nIG1ldGhvZCB0byBjbGFzc2VzIHVzaW5nCiAgICAgKiBhcHBsaWNhdGlvbiBp\nZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld09iamVj\ndElkSW5zdGFuY2VNZXRob2QoYm9vbGVhbiBvYmopCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIE9i\namVjdCBwY05ld09iamVjdElkSW5zdGFuY2UgKCkKICAgICAgICBDbGFzc1td\nIGFyZ3MgPSAob2JqKSA/IG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSA6\nIG51bGw7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1l\ndGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICBCb29sZWFuIHVzZXNDbHNT\ndHJpbmcgPSB1c2VzQ2xhc3NTdHJpbmdJZENvbnN0cnVjdG9yKCk7CiAgICAg\nICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwog\nICAgICAgIGlmIChvYmogJiYgdXNlc0Nsc1N0cmluZyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24gKC4uLik7CiAgICAgICAgICAgIFN0cmluZyBtc2cgPSBfbG9jLmdldCgi\nc3RyLWNvbnMiLCBvaWRUeXBlLAogICAgICAgICAgICAgICAgX21ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNs\nYXNzKTsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKG1zZyk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24uY2xhc3MsCiAgICAgICAgICAgICAgICAiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgbmV3IENsYXNzW117IFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAg\nICAgY29kZS5hdGhyb3coKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7\nCgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghX21ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgp\nKSB7CiAgICAgICAgICAgIC8vIG5ldyBPYmplY3RJZCAoY2xzLCBvaWQpCiAg\nICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3Mp\nOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNs\nYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9tZXRhKSk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBuZXcgPG9pZCBjbGFzcz4gKCk7CiAgICAgICAg\nY29kZS5hbmV3KCkuc2V0VHlwZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmR1\ncCgpOwogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpIHx8\nIChvYmogJiYgdXNlc0Nsc1N0cmluZyA9PSBCb29sZWFuLlRSVUUpKQogICAg\nICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBl\nKF9tZXRhKSk7CiAgICAgICAgaWYgKG9iaikgewogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAgICAgICAgICBpZiAo\ndXNlc0Nsc1N0cmluZyA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAg\nICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmcuY2xh\nc3MgfTsKICAgICAgICAgICAgZWxzZSBpZiAodXNlc0Nsc1N0cmluZyA9PSBC\nb29sZWFuLkZBTFNFKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFz\nc1tdeyBTdHJpbmcuY2xhc3MgfTsKICAgICAgICB9IGVsc2UgaWYgKF9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgLy8gbmV3IDx0\neXBlPklkZW50aXR5IChYWFguY2xhc3MsIDxwaz4pOwogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBwayA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMo\nKVswXTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBwayk7CiAgICAgICAgICAgIGlmIChway5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgYWRkRXh0cmFj\ndE9iamVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwgcGspOwogICAgICAgICAg\nICBpZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2JqZWN0SWQuY2xh\nc3MpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNz\nLmNsYXNzLCBPYmplY3QuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywg\ncGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSB9OwogICAgICAgIH0KCiAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICI8\naW5pdD4iLCB2b2lkLmNsYXNzLCBhcmdzKTsKICAgICAgICBpZiAoIV9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVT\naGFyZWQoKSkKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKE9iamVjdElkLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgT2Jq\nZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZW4g\nY29tbXVuaWNhdGluZyB3aXRoIHRoZSBTdGF0ZU1hbmFnZXIsIG1hbnkgbWV0\naG9kcyBhcmUgdXNlZAogICAgICogZGVwZW5kaW5nIG9uIHRoZSBjbGFzcyBv\nZiBzdGF0ZSBiZWluZyBwYXNzZWQuIFRoaXMgbWV0aG9kLAogICAgICogZ2l2\nZW4gdGhlIHR5cGUgb2YgaW5mb3JtYXRpb24gYmVpbmcgcGFzc2VkIGFuZCB0\naGUgcHJlZml4CiAgICAgKiAoJ3Byb3ZpZGVkJywgJ3JlcGxhY2UnLCBldGMp\nIG9mIHRoZSBtZXRob2QgdG8KICAgICAqIGNhbGwsIHJldHVybnMgdGhlIFN0\nYXRlTWFuYWdlciBtZXRob2QgdGhhdCBzaG91bGQgYmUgdXNlZC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBw\nYXNzZWQKICAgICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUg\nbWV0aG9kIHRvIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tz\ndGF0ZSB0eXBlXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwogICAg\nICogQHBhcmFtIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBm\ncm9tIHRoZQogICAgICogU3RhdGVNYW5hZ2VyLCBmYWxzZSBpZiBwYXNzaW5n\nIGl0IHRvIHRoZSBTTQogICAgICogQHBhcmFtIGN1clZhbHVlIHRydWUgaWYg\ndGhlIGN1cnJlbnQgc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAgICAgKiB0\naGUgU3RhdGVNYW5hZ2VyIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8K\nICAgIHByaXZhdGUgTWV0aG9kIGdldFN0YXRlTWFuYWdlck1ldGhvZChDbGFz\ncyB0eXBlLCBTdHJpbmcgcHJlZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBi\nb29sZWFuIGN1clZhbHVlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2QoU01UWVBFLCB0\neXBlLCBwcmVmaXgsIGdldCwgdHJ1ZSwgY3VyVmFsdWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRob2Qgb2YgdGhlIGdpdmVuIG93\nbmVyIHR5cGUgbWF0Y2hpbmcgdGhlIGdpdmVuIGNyaXRlcmlhLgogICAgICoK\nICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5nIHBh\nc3NlZAogICAgICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4IG9mIHRoZSBt\nZXRob2QgdG8gY2FsbDsgYWxsIG1ldGhvZHMKICAgICAqIGVuZCBpbiAnW3N0\nYXRlIHR5cGVdRmllbGQnOyBvbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAgICAg\nKiBAcGFyYW0gZ2V0IHRydWUgaWYgcmVjZWl2aW5nIGluZm9ybWF0aW9uIGZy\nb20gdGhlCiAgICAgKiBvd25lciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0\naGUgb3duZXIKICAgICAqIEBwYXJhbSBoYXNwYyB0cnVlIGlmIHRoZSBwYyBp\ncyBwYXNzZWQgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAqIEBwYXJhbSBj\ndXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJyZW50IHN0YXRlIHZhbHVlIGlzIHBh\nc3NlZCB0bwogICAgICogdGhlIG93bmVyIGFzIGFuIGV4dHJhIGFyZ3VtZW50\nCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldE1ldGhvZChDbGFzcyBv\nd25lciwgQ2xhc3MgdHlwZSwgU3RyaW5nIHByZWZpeCwKICAgICAgICBib29s\nZWFuIGdldCwgYm9vbGVhbiBoYXNwYywgYm9vbGVhbiBjdXJWYWx1ZSkKICAg\nICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAv\nLyBhbGwgbWV0aG9kcyBlbmQgaW4gW2ZpZWxkIHR5cGVdRmllbGQsIHdoZXJl\nIHRoZSBmaWVsZCB0eXBlCiAgICAgICAgLy8gY2FuIGJlIGFueSBvZiB0aGUg\ncHJpbWl0dmUgdHlwZXMgKGJ1dCBjYXBpdGFsaXplZCksICdTdHJpbmcnLAog\nICAgICAgIC8vIG9yICdPYmplY3QnOyBmaWd1cmUgb3V0IHdoYXQgdHlwZSB0\nbyB1c2UKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0eXBlLmdldE5hbWUo\nKTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAg\nICB0eXBlTmFtZSA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVy\nQ2FzZSgpCiAgICAgICAgICAgICAgICArIHR5cGVOYW1lLnN1YnN0cmluZygx\nKTsKICAgICAgICBlbHNlIGlmICh0eXBlLmVxdWFscyhTdHJpbmcuY2xhc3Mp\nKQogICAgICAgICAgICB0eXBlTmFtZSA9ICJTdHJpbmciOwogICAgICAgIGVs\nc2UgewogICAgICAgICAgICB0eXBlTmFtZSA9ICJPYmplY3QiOwogICAgICAg\nICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAgICAgIH0KCiAgICAgICAg\nLy8gdGhlIGZpZWxkIGluZGV4IGlzIGFsd2F5cyBwYXNzZWQgYXMgYW4gYXJn\nOyB0aGUgcGMgaW5zdGFuY2UgYW5kCiAgICAgICAgLy8gdGhlIGN1cnJlbnQg\ndmFsdWUgbWF5IGJlIHBhc3NlZDsgaWYgc2V0dGluZyB0aGUgbmV3IHZhbHVl\nIGlzCiAgICAgICAgLy8gYWxzbyBwYXNzZWQKICAgICAgICBMaXN0IHBsaXN0\nID0gbmV3IEFycmF5TGlzdCg0KTsKICAgICAgICBpZiAoaGFzcGMpCiAgICAg\nICAgICAgIHBsaXN0LmFkZChQQ1RZUEUpOwogICAgICAgIHBsaXN0LmFkZChp\nbnQuY2xhc3MpOwogICAgICAgIGlmICghZ2V0IHx8IGN1clZhbHVlKQogICAg\nICAgICAgICBwbGlzdC5hZGQodHlwZSk7CiAgICAgICAgaWYgKCFnZXQgJiYg\nY3VyVmFsdWUpIHsKICAgICAgICAgICAgcGxpc3QuYWRkKHR5cGUpOwogICAg\nICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHVzZSByZWZsZWN0aW9uIHRvIHJldHVybiB0aGUgcmlnaHQgbWV0\naG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBwcmVmaXggKyB0eXBlTmFtZSAr\nICJGaWVsZCI7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAoQ2xhc3NbXSkg\ncGxpc3QudG9BcnJheShuZXcgQ2xhc3NbcGxpc3Quc2l6ZSgpXSk7CiAgICAg\nICAgcmV0dXJuIG93bmVyLmdldERlY2xhcmVkTWV0aG9kKG5hbWUsIHBhcmFt\ncyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFk\nZCB0aGUgY29kZSBuZWNlc3NhcnkgdG8gdGhyb3cgdGhlIGdpdmVuCiAgICAg\nKiBleGNlcHRpb24gdHlwZSwgc2FucyBtZXNzYWdlLgogICAgICovCiAgICBw\ncml2YXRlIEluc3RydWN0aW9uIHRocm93RXhjZXB0aW9uKENvZGUgY29kZSwg\nQ2xhc3MgdHlwZSkgewogICAgICAgIEluc3RydWN0aW9uIGlucyA9IGNvZGUu\nYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxp\nbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUuYXRocm93\nKCk7CiAgICAgICAgcmV0dXJuIGluczsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRlcmZhY2UgdG8gdGhl\nIGNsYXNzIGJlaW5nIGVuaGFuY2VkLCBhbmQKICAgICAqIGFkZHMgYSBkZWZh\ndWx0IGNvbnN0cnVjdG9yIGZvciB1c2UgYnkgT3BlbkpQQSBpZiBpdCBpcyBu\nb3QgYWxyZWFkeSBwcmVzZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nZW5oYW5jZUNsYXNzKCkgewogICAgICAgIC8vIG1ha2UgdGhlIGNsYXNzIGlt\ncGxlbWVudCBQZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICBfcGMuZGVjbGFy\nZUludGVyZmFjZShQQ1RZUEUpOwoKICAgICAgICAvLyBmaW5kIHRoZSBkZWZh\ndWx0IGNvbnN0cnVjdG9yCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3Bj\nLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4iLCAoU3RyaW5nW10pIG51bGwp\nOwoKICAgICAgICAvLyBhIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcmVxdWly\nZWQKICAgICAgICBpZiAobWV0aG9kID09IG51bGwpIHsKICAgICAgICAgICAg\nQ2xhc3MgdHlwZSA9IF9wYy5nZXRUeXBlKCk7CiAgICAgICAgICAgIGlmICgh\nX2RlZkNvbnMpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgiZW5oYW5jZS1kZWZhdWx0Y29uc3QiLAogICAgICAg\nICAgICAgICAgICAgIHR5cGUpKTsKCiAgICAgICAgICAgIG1ldGhvZCA9IF9w\nYy5hZGREZWZhdWx0Q29uc3RydWN0b3IoKTsKICAgICAgICAgICAgU3RyaW5n\nIGFjY2VzczsKICAgICAgICAgICAgaWYgKF9tZXRhLmlzRGV0YWNoYWJsZSgp\nKSB7CiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbGl6YWJsZSByZXF1aXJl\ncyB0aGF0IHRoZSBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgICAgLy8gYmUg\ncHVibGljLCBzbyBtYWtlIHRoZSBhZGRlZCBjb25zdHJ1Y3RvciBwdWJsaWMK\nICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAg\nICAgICAgICBhY2Nlc3MgPSAicHVibGljIjsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChfcGMuaXNGaW5hbCgpKSB7CiAgICAgICAgICAgICAgICBtZXRob2Qu\nbWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJwcml2\nYXRlIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1l\ndGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3Mg\nPSAicHJvdGVjdGVkIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAo\nIV9tZXRhLmdldERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpICYmIF9s\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJu\nKF9sb2MuZ2V0KCJlbmhhbmNlLWFkZGRlZmF1bHRjb25zdCIsIHR5cGUsIGFj\nY2VzcykpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\ndGhlIGZvbGxvd2luZyBmaWVsZHMgdG8gdGhlIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBpbnN0YW5jZToKICAgICAqIDx1bD4KICAgICAqIDxsaT48Y29kZT5wcml2\nYXRlIHN0YXRpYyBpbnQgcGNJbmhlcml0ZWRGaWVsZENvdW50PC9jb2RlPjwv\nbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgQ2xhc3MgcGNQ\nQ1N1cGVyY2xhc3M8L2NvZGU+CiAgICAgKiA8L2xpPgogICAgICogPGxpPjxj\nb2RlPnByaXZhdGUgc3RhdGljIFN0cmluZ1tdIHBjRmllbGROYW1lczwvY29k\nZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIENsYXNz\nW10gcGNGaWVsZFR5cGVzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+\ncHJpdmF0ZSBzdGF0aWMgYnl0ZVtdIHBjRmllbGRGbGFnczwvY29kZT48L2xp\nPgogICAgICogPGxpPjxjb2RlPnByb3RlY3RlZCB0cmFuc2llbnQgU3RhdGVN\nYW5hZ2VyIHBjU3RhdGVNYW5hZ2VyPC9jb2RlPgogICAgICogaWYgbm8gUGVy\nc2lzdGVuY2VDYXBhYmxlIHN1cGVyY2xhc3MgcHJlc2VudCk8L2xpPgogICAg\nICogPGxpPjxjb2RlPnByb3RlY3RlZCB0cmFuc2llbnQgYnl0ZSBwY0ZsYWdz\nPC9jb2RlPgogICAgICogaWYgbm8gUGVyc2lzdGVuY2VDYXBhYmxlIHN1cGVy\nY2xhc3MgcHJlc2VudCk8L2xpPgogICAgICogPC91bD4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZEZpZWxkcygpIHsKICAgICAgICBfcGMuZGVjbGFy\nZUZpZWxkKElOSEVSSVQsIGludC5jbGFzcykuc2V0U3RhdGljKHRydWUpOwog\nICAgICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkTmFtZXMiLCBT\ndHJpbmdbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9wYy5k\nZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNz\nKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQ\nUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcykuc2V0U3RhdGljKHRy\ndWUpOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoU1VQRVIsIENsYXNzLmNs\nYXNzKS5zZXRTdGF0aWModHJ1ZSk7CgogICAgICAgIGlmIChfbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIEJDRmllbGQg\nZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nICAgICBmaWVsZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGZpZWxk\nLnNldFRyYW5zaWVudCh0cnVlKTsKCiAgICAgICAgICAgIGZpZWxkID0gX3Bj\nLmRlY2xhcmVGaWVsZChQUkUgKyAiRmxhZ3MiLCBieXRlLmNsYXNzKTsKICAg\nICAgICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBm\naWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGNsYXNzIGluaXRpYWxpemF0aW9u\nIG1ldGhvZCAoY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2FyeSkKICAgICAqIHRv\nIGluaXRpYWxpemUgdGhlIHN0YXRpYyBmaWVsZHMgb2YgdGhlIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAgICAqIHRvIHJlZ2lzdGVyIGl0\nIHdpdGggdGhlIGltcGwgaGVscGVyLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7CiAgICAgICAgQ29kZSBjb2Rl\nID0gZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKHRydWUpOwogICAgICAgIGlm\nIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIHBjSW5oZXJpdGVkRmllbGRDb3VudCA9IDxzdXBlckNsYXNzPi5w\nY0dldE1hbmFnZWRGaWVsZENvdW50KCkKICAgICAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAg\nICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5hbWUoKSwg\nCiAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZpZWxkQ291bnQi\nLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAgICAgICAgY29k\nZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwoK\nICAgICAgICAgICAgLy8gcGNQQ1N1cGVyY2xhc3MgPSA8c3VwZXJDbGFzcz47\nCiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGdl\ndFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpKSk7CiAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0\nRmllbGQoU1VQRVIsIENsYXNzLmNsYXNzKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHBjRmllbGROYW1lcyA9IG5ldyBTdHJpbmdbXSB7ICI8bmFtZTE+Iiwg\nIjxuYW1lMj4iLCAuLi4gfTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBjb2Rl\nLmFuZXdhcnJheSgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoZm1kc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBjb2RlLmFh\nc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5z\nZXRGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsK\nCiAgICAgICAgLy8gcGNGaWVsZFR5cGVzID0gbmV3IENsYXNzW10geyA8dHlw\nZTE+LmNsYXNzLCA8dHlwZTI+LmNsYXNzLCAuLi4gfTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNv\nZGUuYW5ld2FycmF5KCkuc2V0VHlwZShDbGFzcy5jbGFzcyk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50\nKCkuc2V0Q2xhc3MoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAg\nICAgICAgIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2Rl\nLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xh\nc3NbXS5jbGFzcyk7CgogICAgICAgIC8vIHBjRmllbGRGbGFncyA9IG5ldyBi\neXRlW10geyA8ZmxhZzE+LCA8ZmxhZzI+LCAuLi4gfTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNv\nZGUubmV3YXJyYXkoKS5zZXRUeXBlKGJ5dGUuY2xhc3MpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShnZXRGaWVsZEZsYWcoZm1kc1tpXSkpOwogICAgICAgICAgICBjb2Rl\nLmJhc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMo\nKS5zZXRGaWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7\nCgogICAgICAgIC8vIFBDUmVnaXN0cnkucmVnaXN0ZXIgKGNscywKICAgICAg\nICAvLwlwY0ZpZWxkTmFtZXMsIHBjRmllbGRUeXBlcywgcGNGaWVsZEZsYWdz\nLAogICAgICAgIC8vICBwY1BDU3VwZXJjbGFzcywgYWxpYXMsIG5ldyBYWFgg\nKCkpOwogICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKF9w\nYyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQUkUgKyAi\nRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsKICAgICAgICBjb2RlLmdl\ndHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3Nb\nXS5jbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQ\nUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7CiAgICAgICAgY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShfbWV0YS5nZXRUeXBl\nQWxpYXMoKSk7CiAgICAgICAgaWYgKF9wYy5pc0Fic3RyYWN0KCkpCiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKCI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxs\nKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0\nTWV0aG9kKEhFTFBFUlRZUEUsICJyZWdpc3RlciIsIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgU3RyaW5nW10u\nY2xhc3MsIENsYXNzW10uY2xhc3MsCiAgICAgICAgICAgICAgICBieXRlW10u\nY2xhc3MsIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MsIFBDVFlQRSB9KTsK\nCiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBmbGFnIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGJ5dGUgZ2V0RmllbGRGbGFnKEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gRmllbGRN\nZXRhRGF0YS5NQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIC0xOwoK\nICAgICAgICBieXRlIGZsYWdzID0gMDsKICAgICAgICBpZiAoZm1kLmdldERl\nY2xhcmVkVHlwZSgpLmlzUHJpbWl0aXZlKCkKICAgICAgICAgICAgfHwgU2Vy\naWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oZm1kLmdldERlY2xh\ncmVkVHlwZSgpKSkKICAgICAgICAgICAgZmxhZ3MgPSBQZXJzaXN0ZW5jZUNh\ncGFibGUuU0VSSUFMSVpBQkxFOwoKICAgICAgICBpZiAoZm1kLmdldE1hbmFn\nZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9UUkFOU0FDVElPTkFM\nKQogICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hF\nQ0tfV1JJVEU7CiAgICAgICAgZWxzZSBpZiAoIWZtZC5pc1ByaW1hcnlLZXko\nKSAmJiAhZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAg\nICBmbGFncyB8PSBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfV1JJVEUKICAg\nICAgICAgICAgICAgIHwgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JFQUQ7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBmbGFncyB8PSBQZXJzaXN0ZW5j\nZUNhcGFibGUuTUVESUFURV9XUklURQogICAgICAgICAgICAgICAgfCBQZXJz\naXN0ZW5jZUNhcGFibGUuTUVESUFURV9SRUFEOwogICAgICAgIHJldHVybiBm\nbGFnczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGNvZGUgdG8g\ncHJvcGVybHkgaGFuZGxlIFBlcnNpc3RlbmNlQ2FwYWJsZSBzZXJpYWxpemF0\naW9uCiAgICAgKiB0byB0aGUgYnl0ZWNvZGUuIFRoaXMgaW5jbHVkZXMgY3Jl\nYXRpbmcgYW5kIGluaXRpYWxpemluZyB0aGUKICAgICAqIHN0YXRpYyA8Y29k\nZT5zZXJpYWxWZXJzaW9uVUlEPC9jb2RlPiBjb25zdGFudCBpZiBub3QgYWxy\nZWFkeSBkZWZpbmVkLAogICAgICogYXMgd2VsbCBhcyBjcmVhdGluZyBhIGN1\nc3RvbSA8Y29kZT53cml0ZU9iamVjdDwvY29kZT4gbWV0aG9kIGlmIHRoZQog\nICAgICogY2xhc3MgaXMgU2VyaWFsaXphYmxlIGFuZCBkb2VzIG5vdCBkZWZp\nbmUgdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNlcmlhbGl6\nYXRpb25Db2RlKCkgewogICAgICAgIGlmIChleHRlcm5hbGl6ZURldGFjaGVk\nKCkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgbm90IGFscmVhZHkgcHJlc2Vu\ndCwgYWRkIGEgc2VyaWFsVmVyc2lvblVJRCBmaWVsZDsgaWYgdGhlIGluc3Rh\nbmNlCiAgICAgICAgLy8gaXMgZGV0YWNoYWJsZSBhbmQgdXNlcyBkZXRhY2hl\nZCBzdGF0ZSB3aXRob3V0IGEgZGVjbGFyZWQgZmllbGQsCiAgICAgICAgLy8g\nY2FuJ3QgYWRkIGEgc2VyaWFsIHZlcnNpb24gVUlEIGJlY2F1c2Ugd2UnbGwg\nYmUgYWRkaW5nIGV4dHJhIGZpZWxkcwogICAgICAgIC8vIHRvIHRoZSBlbmhh\nbmNlZCB2ZXJzaW9uCiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXRE\nZWNsYXJlZEZpZWxkKCJzZXJpYWxWZXJzaW9uVUlEIik7CiAgICAgICAgaWYg\nKGZpZWxkID09IG51bGwpIHsKICAgICAgICAgICAgTG9uZyB1aWQgPSBudWxs\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdWlkID0gTnVt\nYmVycy52YWx1ZU9mKE9iamVjdFN0cmVhbUNsYXNzLmxvb2t1cAogICAgICAg\nICAgICAgICAgICAgIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpLmdldFNl\ncmlhbFZlcnNpb25VSUQoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0LWNoYW5jZSBjYXRj\naCBmb3IgYnVnICMyODMgKHdoaWNoIGNhbiBoYXBwZW4KICAgICAgICAgICAg\nICAgIC8vIGluIGEgdmFyaWV0eSBvZiBDbGFzc0xvYWRpbmcgZW52aXJvbm1l\nbnRzKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhh\nbmNlLXVpZC1hY2Nlc3MiLCBfbWV0YSksIHQpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBhY2Nlc3MgdGhlIHNlcmlh\nbFZlcnNpb25VSUQsIHdlIHdpbGwgaGF2ZSB0bwogICAgICAgICAgICAvLyBz\na2lwIHRoZSBvdmVycmlkZSBvZiB0aGF0IGZpZWxkIGFuZCBub3QgYmUgc2Vy\naWFsaXphdGlvbgogICAgICAgICAgICAvLyBjb21wYXRpYmxlIHdpdGggbm9u\nLWVuaGFuY2VkIGNsYXNzZXMKICAgICAgICAgICAgaWYgKHVpZCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQo\nInNlcmlhbFZlcnNpb25VSUQiLCBsb25nLmNsYXNzKTsKICAgICAgICAgICAg\nICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgICAgICBmaWVs\nZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRG\naW5hbCh0cnVlKTsKCiAgICAgICAgICAgICAgICBDb2RlIGNvZGUgPSBnZXRP\nckNyZWF0ZUNsYXNzSW5pdENvZGUoZmFsc2UpOwogICAgICAgICAgICAgICAg\nY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKHVpZC5sb25nVmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKGZpZWxkKTsKCiAgICAg\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFkZCB3cml0ZSBvYmplY3Qg\nbWV0aG9kCiAgICAgICAgQkNNZXRob2Qgd3JpdGUgPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoIndyaXRlT2JqZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNz\nW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICBib29s\nZWFuIGZ1bGwgPSB3cml0ZSA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7\nCiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdCAoT2Jq\nZWN0T3V0cHV0U3RyZWFtIG91dCkKICAgICAgICAgICAgd3JpdGUgPSBfcGMu\nZGVjbGFyZU1ldGhvZCgid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5j\nbGFzcyB9KTsKICAgICAgICAgICAgd3JpdGUuZ2V0RXhjZXB0aW9ucyh0cnVl\nKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAg\nICB3cml0ZS5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2Rp\nZnlXcml0ZU9iamVjdE1ldGhvZCh3cml0ZSwgZnVsbCk7CgogICAgICAgIC8v\nIGFuZCByZWFkIG9iamVjdAogICAgICAgIEJDTWV0aG9kIHJlYWQgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRPYmplY3QiLAogICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAg\nICAgZnVsbCA9IHJlYWQgPT0gbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewog\nICAgICAgICAgICAvLyBwcml2YXRlIHZvaWQgcmVhZE9iamVjdCAoT2JqZWN0\nSW5wdXRTdHJlYW0gaW4pCiAgICAgICAgICAgIHJlYWQgPSBfcGMuZGVjbGFy\nZU1ldGhvZCgicmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7\nCiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNl\ncHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICByZWFkLmdl\ndEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIHJlYWQubWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5\nUmVhZE9iamVjdE1ldGhvZChyZWFkLCBmdWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGNsYXNzIGJlaW5nIGVuaGFuY2VkIHNob3Vs\nZCBleHRlcm5hbGl6ZSB0byBhIGRldGFjaGVkCiAgICAgKiBpbnN0YW5jZSBy\nYXRoZXIgdGhhbiBzZXJpYWxpemUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBleHRlcm5hbGl6ZURldGFjaGVkKCkgewogICAgICAgIHJldHVybiBD\nbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0YWNo\nZWRTdGF0ZSgpKQogICAgICAgICAgICAmJiBTZXJpYWxpemFibGUuY2xhc3Mu\naXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpCiAg\nICAgICAgICAgICYmICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLmdldERl\ndGFjaFN0YXRlSW5zdGFuY2UoKS4KICAgICAgICAgICAgaXNEZXRhY2hlZFN0\nYXRlVHJhbnNpZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEg\nY3VzdG9tIHdyaXRlT2JqZWN0IG1ldGhvZCB0aGF0IGRlbGVnYXRlcyB0byB0\naGUKICAgICAqIHtAbGluayBPYmplY3RPdXRwdXRTdHJlYW0jZGVmYXVsdFdy\naXRlT2JqZWN0fSBtZXRob2QsCiAgICAgKiBidXQgb25seSBhZnRlciBjYWxs\naW5nIHRoZSBpbnRlcm5hbCA8Y29kZT5wY1NlcmlhbGl6aW5nPC9jb2RlPiBt\nZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtb2RpZnlXcml0ZU9i\namVjdE1ldGhvZChCQ01ldGhvZCBtZXRob2QsIGJvb2xlYW4gZnVsbCkgewog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgLy8gYm9vbCBjbGVh\nciA9IHBjU2VyaWFsaXppbmcgKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKFBSRSArICJTZXJpYWxpemluZyIsCiAgICAgICAgICAg\nIGJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIGludCBjbGVhciA9IGNv\nZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5pc3RvcmUo\nKS5zZXRMb2NhbChjbGVhcik7CgogICAgICAgIGlmIChmdWxsKSB7CiAgICAg\nICAgICAgIC8vIG91dC5kZWZhdWx0V3JpdGVPYmplY3QgKCk7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dFN0cmVh\nbS5jbGFzcywKICAgICAgICAgICAgICAgICJkZWZhdWx0V3JpdGVPYmplY3Qi\nLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgfQoKICAgICAgICBJbnN0cnVjdGlvbiB0bXBsYXRlID0g\nbmV3IENvZGUoKS52cmV0dXJuKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9u\nIHRvcmV0OwogICAgICAgIEluc3RydWN0aW9uIHJldDsKICAgICAgICBjb2Rl\nLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9y\nd2FyZCh0bXBsYXRlKSkgewogICAgICAgICAgICByZXQgPSBjb2RlLnByZXZp\nb3VzKCk7CiAgICAgICAgICAgIC8vIGlmIChjbGVhcikgcGNTZXREZXRhY2hl\nZFN0YXRlIChudWxsKTsKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExv\nY2FsKGNsZWFyKTsKICAgICAgICAgICAgdG9yZXQgPSBjb2RlLmlmZXEoKTsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB0\nb3JldC5zZXRUYXJnZXQocmV0KTsKICAgICAgICAgICAgY29kZS5uZXh0KCk7\nIC8vIGp1bXAgb3ZlciByZXR1cm4KICAgICAgICB9CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgY3VzdG9t\nIHJlYWRPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAg\nICoge0BsaW5rIE9iamVjdElucHV0U3RyZWFtI3JlYWRPYmplY3R9IG1ldGhv\nZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVJlYWRPYmplY3RN\nZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBj\nb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8vIGlmIHRoaXMgaW5zdGFu\nY2UgdXNlcyBzeW50aGV0aWMgZGV0YWNoZWQgc3RhdGUsIG5vdGUgdGhhdCBp\ndCBoYXMKICAgICAgICAvLyBiZWVuIGRlc2VyaWFsaXplZAogICAgICAgIGlm\nIChDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0\nYWNoZWRTdGF0ZSgpKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAg\nICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJT\nZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBpbi5kZWZhdWx0UmVh\nZE9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MsCiAgICAgICAgICAgICAgICAi\nZGVmYXVsdFJlYWRPYmplY3QiLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhl\nIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYW4gaW5z\ndGFuY2UKICAgICAqIGlzIGRldGFjaGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkSXNEZXRhY2hlZE1ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIGJvb2xl\nYW4gcGNJc0RldGFjaGVkICgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIklzRGV0YWNoZWQiLAogICAgICAg\nICAgICBCb29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBtZXRob2QubWFr\nZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwogICAgICAgIHdyaXRlSXNEZXRhY2hlZE1ldGhvZChjb2RlKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZXMgdGhlIGJvZHkgb2YgdGhlIHBjSXNEZXRhY2hlZCgpIG1ldGhv\nZCB0byBkZXRlcm1pbmUgaWYgYW4KICAgICAqIGluc3RhbmNlIGlzIGRldGFj\naGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd3JpdGVJc0RldGFjaGVk\nTWV0aG9kKENvZGUgY29kZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICAvLyBub3QgZGV0YWNoYWJsZTogcmV0dXJu\nIEJvb2xlYW4uRkFMU0UKICAgICAgICBpZiAoIV9tZXRhLmlzRGV0YWNoYWJs\nZSgpKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQo\nQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAg\nICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAv\nLwkJcmV0dXJuIChzbS5pc0RldGFjaGVkICgpKSA/IEJvb2xlYW4uVFJVRSA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9\nIGNvZGUuaWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKFNNVFlQRSwgImlzRGV0YWNoZWQiLAogICAgICAgICAgICBi\nb29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24g\naWZmYWxzZSA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNs\nYXNzKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBpZmZhbHNl\nLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJGQUxTRSIsCiAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsK\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgLy8gaWYgd2UgdXNl\nIGRldGFjaGVkIHN0YXRlOgogICAgICAgIC8vIGlmIChwY0dldERldGFjaGVk\nU3RhdGUgKCkgIT0gbnVsbAogICAgICAgIC8vICAgICAmJiBwY0dldERldGFj\naGVkU3RhdGUgIT0gREVTRVJJQUxJWkVEKQogICAgICAgIC8vICAgICByZXR1\ncm4gQm9vbGVhbi5UUlVFOwogICAgICAgIEJvb2xlYW4gc3RhdGUgPSBfbWV0\nYS51c2VzRGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlv\nbiBub3RkZXNlciA9IG51bGw7CiAgICAgICAgSW5zdHJ1Y3Rpb24gdGFyZ2V0\nOwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLkZBTFNFKSB7CiAgICAg\nICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZmlu\ncyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUuY2xhc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2Jq\nZWN0LmNsYXNzKTsKICAgICAgICAgICAgbm90ZGVzZXIgPSBjb2RlLmlmYWNt\ncGVxKCk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQo\nQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgICAgICBpZiAoc3RhdGUg\nPT0gQm9vbGVhbi5UUlVFKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBo\nYXZlIHRvIHVzZSBkZXRhY2hlZCBzdGF0ZToKICAgICAgICAgICAgICAgIC8v\nIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICAgICAgdGFyZ2V0\nID0gY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAi\nRkFMU0UiLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwog\nICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAg\nICAgICAgICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAg\nICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJn\nZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJn\nZXQpOwogICAgICAgIGlmIChub3RkZXNlciAhPSBudWxsKQogICAgICAgICAg\nICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKCiAgICAgICAgLy8gYWxs\nb3cgdXNlcnMgd2l0aCB2ZXJzaW9uIGZpZWxkcyB0byBtYW51YWxseSBjb25z\ndHJ1Y3QgYSAiZGV0YWNoZWQiCiAgICAgICAgLy8gaW5zdGFuY2UsIHNvIGNo\nZWNrIHZlcnNpb24gYmVmb3JlIHRha2luZyBpbnRvIGFjY291bnQgbm9uLWV4\naXN0ZW50CiAgICAgICAgLy8gZGV0YWNoZWQgc3RhdGUKCiAgICAgICAgLy8g\nY29uc2lkZXIgZGV0YWNoZWQgaWYgdmVyc2lvbiBpcyBub24tZGVmYXVsdAog\nICAgICAgIEZpZWxkTWV0YURhdGEgdmVyc2lvbiA9IF9tZXRhLmdldFZlcnNp\nb25GaWVsZCgpOwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLlRSVUUg\nJiYgdmVyc2lvbiAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmICg8dmVy\nc2lvbj4gIT0gPGRlZmF1bHQ+KQogICAgICAgICAgICAvLwkJcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUs\nIHZlcnNpb24pOwogICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVl\nKGNvZGUsIHZlcnNpb24pOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygp\nLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwgQm9vbGVhbi5jbGFz\ncyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICBp\nZmlucy5zZXRUYXJnZXQoY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29s\nZWFuLmNsYXNzLCAiRkFMU0UiLAogICAgICAgICAgICAgICAgQm9vbGVhbi5j\nbGFzcykpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGV0YWNoZWQg\nc3RhdGU6IGlmIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3RhdGUgYW5kIGl0\nJ3Mgbm90CiAgICAgICAgLy8gc3ludGhldGljIG9yIHRoZSBpbnN0YW5jZSBp\ncyBub3Qgc2VyaWFsaXphYmxlIG9yIHRoZSBzdGF0ZSBpc24ndAogICAgICAg\nIC8vIHRyYW5zaWVudCwgbXVzdCBub3QgYmUgZGV0YWNoZWQKICAgICAgICBp\nZiAoc3RhdGUgPT0gbnVsbAogICAgICAgICAgICAmJiAoIUNsYXNzTWV0YURh\ndGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkp\nCiAgICAgICAgICAgIHx8ICFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpCiAgICAgICAgICAg\nIHx8ICFfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLmdldERldGFjaFN0YXRl\nSW5zdGFuY2UoKS4KICAgICAgICAgICAgaXNEZXRhY2hlZFN0YXRlVHJhbnNp\nZW50KCkpKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBCb29sZWFuLkZBTFNF\nCiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAg\nIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICAvLyBubyBkZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2Ug\ndXNlcyBkZXRhY2hlZCBzdGF0ZSAoYW5kIG11c3QgYmUKICAgICAgICAvLyBz\neW50aGV0aWMgYW5kIHRyYW5zaWVudCBpbiBzZXJpYWxpemFibGUgaW5zdGFu\nY2UgYXQgdGhpcyBwb2ludCksCiAgICAgICAgLy8gbm90IGRldGFjaGVkIGlm\nIHN0YXRlIG5vdCBzZXQgdG8gREVTRVJJQUxJWkVECiAgICAgICAgaWYgKHN0\nYXRlID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNo\nZWRTdGF0ZSAoKSA9PSBudWxsKSAvLyBpbnN0ZWFkIG9mIERFU0VSSUFMSVpF\nRAogICAgICAgICAgICAvLyAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJF\nICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgT2JqZWN0\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9u\nbnVsbCgpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAg\nICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gY29u\nc2lkZXIgZGV0YWNoZWQgaWYgYXV0by1nZW5uZWQgcHJpbWFyeSBrZXlzIGFy\nZSBub24tZGVmYXVsdAogICAgICAgIGlmaW5zID0gbnVsbDsKICAgICAgICBK\ndW1wSW5zdHJ1Y3Rpb24gaWZpbnMyID0gbnVsbDsKICAgICAgICBpZiAoc3Rh\ndGUgIT0gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICYmIF9tZXRhLmdldElk\nZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04p\nIHsKICAgICAgICAgICAgLy8gZm9yIGVhY2ggcGsgZmllbGQ6CiAgICAgICAg\nICAgIC8vIGlmICg8cGs+ICE9IDxkZWZhdWx0PiBbJiYgISIiLmVxdWFscyAo\nPHBrPildKQogICAgICAgICAgICAvLwkJcmV0dXJuIEJvb2xlYW4uVFJVRTsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IF9tZXRhLmdldFBy\naW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBwa3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChw\na3NbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5O\nT05FKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgIHRhcmdldCA9IGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgaWYgKGlmaW5zICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAg\nICAgICAgICAgICBpZiAoaWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgaWZpbnMyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAg\nICAgaWZpbnMyID0gbnVsbDsKCiAgICAgICAgICAgICAgICBhZGRHZXRNYW5h\nZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBp\nZmlucyA9IGlmRGVmYXVsdFZhbHVlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAg\nICAgICAgICBpZiAocGtzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBK\nYXZhVHlwZXMuU1RSSU5HKSB7CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKCIiKTsKICAgICAgICAgICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFN0cmluZy5jbGFzcywgImVxdWFscyIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3Qu\nY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAgaWZpbnMyID0gY29kZS5p\nZm5lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwK\nICAgICAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKTsKICAgICAgICAg\nICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvLyBnaXZlIHVwOyB3ZSBqdXN0IGRvbid0IGtub3cKICAg\nICAgICB0YXJnZXQgPSBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAg\nICAgIGlmIChpZmlucyAhPSBudWxsKQogICAgICAgICAgICBpZmlucy5zZXRU\nYXJnZXQodGFyZ2V0KTsKICAgICAgICBpZiAoaWZpbnMyICE9IG51bGwpCiAg\nICAgICAgICAgIGlmaW5zMi5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbXBhcmUg\ndGhlIGdpdmVuIGZpZWxkIHRvIGl0cyBKYXZhIGRlZmF1bHQsIHJldHVybmlu\nZyB0aGUKICAgICAqIGNvbXBhcmlzb24gaW5zdHJ1Y3Rpb24uIFRoZSBmaWVs\nZCB2YWx1ZSB3aWxsIGFscmVhZHkgYmUgb24gdGhlIHN0YWNrLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBKdW1wSW5zdHJ1Y3Rpb24gaWZEZWZhdWx0\nVmFsdWUoQ29kZSBjb2RlLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwRCk7CiAgICAgICAgICAgICAgICBjb2RlLmRjbXBsKCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgIGNv\nZGUuZmNtcGwoKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEo\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAg\nICAgICAgICBjb2RlLmxjbXAoKTsKICAgICAgICAgICAgICAgIHJldHVybiBj\nb2RlLmlmZXEoKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHJldHVybiBjb2RlLmlmbnVsbCgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gZ2V0IHRoZSBjb2RlIGZv\nciB0aGUgY2xhc3MgaW5pdGlhbGl6ZXIgbWV0aG9kLAogICAgICogY3JlYXRp\nbmcgdGhlIG1ldGhvZCBpZiBpdCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0Lgog\nICAgICovCiAgICBwcml2YXRlIENvZGUgZ2V0T3JDcmVhdGVDbGFzc0luaXRD\nb2RlKGJvb2xlYW4gcmVwbGFjZUxhc3QpIHsKICAgICAgICBCQ01ldGhvZCBj\nbGluaXQgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIjxjbGluaXQ+Iik7CiAg\nICAgICAgQ29kZSBjb2RlOwogICAgICAgIGlmIChjbGluaXQgIT0gbnVsbCkg\newogICAgICAgICAgICBjb2RlID0gY2xpbml0LmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgICAgIGlmIChyZXBsYWNlTGFzdCkgewogICAgICAgICAgICAgICAg\nQ29kZSB0ZW1wbGF0ZSA9IG5ldyBDb2RlKCk7CiAgICAgICAgICAgICAgICBj\nb2RlLnNlYXJjaEZvcndhcmQodGVtcGxhdGUudnJldHVybigpKTsKICAgICAg\nICAgICAgICAgIGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgICAgIGNv\nZGUuc2V0KHRlbXBsYXRlLm5vcCgpKTsKICAgICAgICAgICAgICAgIGNvZGUu\nbmV4dCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2Rl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHN0YXRpYyBpbml0aWFsaXpl\nciBtZXRob2QgaWYgbm9uIGV4aXN0cwogICAgICAgIGNsaW5pdCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKCI8Y2xpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwog\nICAgICAgIGNsaW5pdC5tYWtlUGFja2FnZSgpOwogICAgICAgIGNsaW5pdC5z\nZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgY2xpbml0LnNldEZpbmFsKHRydWUp\nOwoKICAgICAgICBjb2RlID0gY2xpbml0LmdldENvZGUodHJ1ZSk7CiAgICAg\nICAgaWYgKCFyZXBsYWNlTGFzdCkgewogICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gY29kZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYnl0ZWNvZGUgbW9kaWZ5aW5nIHRoZSBjbG9uaW5nIGJlaGF2aW9yIG9m\nIHRoZSBjbGFzcyBiZWluZwogICAgICogZW5oYW5jZWQgdG8gY29ycmVjdGx5\nIHJlcGxhY2UgdGhlIDxjb2RlPnBjRmxhZ3M8L2NvZGU+IGFuZAogICAgICog\nPGNvZGU+cGNTdGF0ZU1hbmFnZXI8L2NvZGU+IGluc3RhbmNlIGZpZWxkcyBv\nZiBhbnkgY2xvbmUgY3JlYXRlZCB3aXRoCiAgICAgKiB0aGVpciBkZWZhdWx0\nIHZhbHVlcy4gQWxzbywgaWYgdGhpcyBjbGFzcyBpcyB0aGUgYmFzZSBQQyB0\neXBlCiAgICAgKiBhbmQgZG9lcyBub3QgZGVjbGFyZWQgYSBjbG9uZSBtZXRo\nb2QsIG9uZSB3aWxsIGJlIGFkZGVkLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkQ2xvbmluZ0NvZGUoKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldFBD\nU3VwZXJjbGFzcygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gYWRkIHRoZSBjbG9uZSBtZXRob2QgaWYgbmVjZXNzYXJ5CiAg\nICAgICAgQkNNZXRob2QgY2xvbmUgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2Qo\nImNsb25lIiwgKFN0cmluZ1tdKSBudWxsKTsKICAgICAgICBTdHJpbmcgc3Vw\nZXJOYW1lID0gX3BjLmdldFN1cGVyY2xhc3NOYW1lKCk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbnVsbDsKICAgICAgICBpZiAoY2xvbmUgPT0gbnVsbCkgewog\nICAgICAgICAgICAvLyBhZGQgY2xvbmUgc3VwcG9ydCBmb3IgYmFzZSBjbGFz\nc2VzCiAgICAgICAgICAgIC8vIHdoaWNoIGFsc28gaW1wbGVtZW50IGNsb25l\nYWJsZQogICAgICAgICAgICBpZiAoIV9wYy5pc0luc3RhbmNlT2YoQ2xvbmVh\nYmxlLmNsYXNzKQogICAgICAgICAgICAgICAgfHwgIXN1cGVyTmFtZS5lcXVh\nbHMoT2JqZWN0LmNsYXNzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5oYW5j\nZS1jbG9uZWFibGUiLCBfcGMuZ2V0VHlwZSgpKSk7CgogICAgICAgICAgICAv\nLyBhZGQgY2xvbmUgbWV0aG9kCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBP\nYmplY3QgY2xvbmUgKCkgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0\naW9uCiAgICAgICAgICAgIGNsb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNs\nb25lIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgY2xvbmUu\nbWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBjbG9uZS5nZXRFeGNlcHRp\nb25zKHRydWUpLmFkZEV4Y2VwdGlvbgogICAgICAgICAgICAgICAgKENsb25l\nTm90U3VwcG9ydGVkRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgY29k\nZSA9IGNsb25lLmdldENvZGUodHJ1ZSk7CgogICAgICAgICAgICAvLyByZXR1\ncm4gc3VwZXIuY2xvbmUgKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoX3BjLmdldFN1cGVyY2xhc3NOYW1lKCksCiAg\nICAgICAgICAgICAgICAiY2xvbmUiLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nLCBudWxsKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2Qg\nY29kZQogICAgICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7\nCiAgICAgICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgdGVtcGxh\ndGUgc3VwZXIuY2xvbmUgKCkgaW5zdHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5z\ndAogICAgICAgIEluc3RydWN0aW9uIHRlbXBsYXRlID0gbmV3IENvZGUoKS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kCiAgICAgICAgICAgIChzdXBlck5h\nbWUsICJjbG9uZSIsIE9iamVjdC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwoK\nICAgICAgICAvLyBmaW5kIGNhbGxzIHRvIHRoZSB0ZW1wbGF0ZSBpbnN0cnVj\ndGlvbjsgb24gbWF0Y2gKICAgICAgICAvLyBjbG9uZSB3aWxsIGJlIG9uIHN0\nYWNrCiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgIGlmIChj\nb2RlLnNlYXJjaEZvcndhcmQodGVtcGxhdGUpKSB7CiAgICAgICAgICAgIC8v\nICgoPHR5cGU+KSBjbG9uZSkucGNTdGF0ZU1hbmFnZXIgPSBudWxsOwogICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoX3BjKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldE51bGwoKTsKICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwoKICAgICAgICAgICAgLy8gKCg8dHlwZT4pIGNs\nb25lKS5wY0ZsYWdzID0gMDsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShQZXJzaXN0ZW5jZUNh\ncGFibGUuUkVBRF9XUklURV9PSyk7CiAgICAgICAgICAgIGNvZGUucHV0Zmll\nbGQoKS5zZXRGaWVsZChQUkUgKyAiRmxhZ3MiLCBieXRlLmNsYXNzKTsKCiAg\nICAgICAgICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAg\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogRW5oYW5jZSB0aGUgUEMncyBvYmplY3QgaWQgY2xh\nc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBlbmhhbmNlT2JqZWN0\nSWQoKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQ2xh\nc3MgY2xzID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgaWYg\nKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBfbWV0YS5nZXRQcmltYXJ5S2V5\nRmllbGRzKCk7CiAgICAgICAgaW50IGFjY2VzcyA9IF9tZXRhLmdldEFjY2Vz\nc1R5cGUoKTsKICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRpdHko\nKSkgewogICAgICAgICAgICBpZiAocGtzWzBdLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSAhPSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICBjbHMgPSBwa3NbMF0uZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgICAgIGFjY2VzcyA9IHBrc1swXS5nZXRFbWJlZGRl\nZE1ldGFEYXRhKCkuZ2V0QWNjZXNzVHlwZSgpOwogICAgICAgICAgICBwa3Mg\nPSBwa3NbMF0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwog\nICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGNhcDsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoYWNjZXNzID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKQogICAg\nICAgICAgICAgICAgbWFrZU9iamVjdElkRmllbGRQdWJsaWMoZmluZERlY2xh\ncmVkRmllbGQoY2xzLAogICAgICAgICAgICAgICAgICAgIHBrc1tpXS5nZXRO\nYW1lKCkpKTsKICAgICAgICAgICAgZWxzZSAvLyBwcm9wZXJ0eQogICAgICAg\nICAgICB7CiAgICAgICAgICAgICAgICBjYXAgPSBTdHJpbmdVdGlscy5jYXBp\ndGFsaXplKHBrc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgbWFr\nZU9iamVjdElkTWV0aG9kUHVibGljKGZpbmREZWNsYXJlZEdldHRlck1ldGhv\nZChjbHMsIGNhcCkpOwogICAgICAgICAgICAgICAgbWFrZU9iamVjdElkTWV0\naG9kUHVibGljKGZpbmREZWNsYXJlZE1ldGhvZChjbHMsICJzZXQiICsgY2Fw\nLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBwa3NbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfb2lkcyAhPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogRmluZCB0aGUgZ2l2ZW4gKHBvc3NpYmx5IHByaXZhdGUpIGZpZWxk\nLgogICAgICovCiAgICBwcml2YXRlIEZpZWxkIGZpbmREZWNsYXJlZEZpZWxk\nKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoY2xzID09\nIG51bGwgfHwgY2xzID09IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBj\nbHMuZ2V0RGVjbGFyZWRGaWVsZChuYW1lKTsKICAgICAgICB9IGNhdGNoIChO\nb1N1Y2hGaWVsZEV4Y2VwdGlvbiBuc2ZlKSB7CiAgICAgICAgICAgIHJldHVy\nbiBmaW5kRGVjbGFyZWRGaWVsZChjbHMuZ2V0U3VwZXJjbGFzcygpLCBuYW1l\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGdldHRlciBtZXRob2Qg\nZm9yIHRoZSBnaXZlbiBjYXBpdGFsaXplZCBwcm9wZXJ0eSBuYW1lLgogICAg\nICovCiAgICBwcml2YXRlIE1ldGhvZCBmaW5kRGVjbGFyZWRHZXR0ZXJNZXRo\nb2QoQ2xhc3MgY2xzLCBTdHJpbmcgYmFzZU5hbWUpIHsKICAgICAgICBNZXRo\nb2QgbWV0aCA9IGZpbmREZWNsYXJlZE1ldGhvZChjbHMsICJnZXQiICsgYmFz\nZU5hbWUsIG51bGwpOwogICAgICAgIGlmIChtZXRoICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBtZXRoOwogICAgICAgIHJldHVybiBmaW5kRGVjbGFy\nZWRNZXRob2QoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCksICJpcyIgKyBiYXNl\nTmFtZSwKICAgICAgICAgICAgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGaW5kIHRoZSBnaXZlbiAocG9zc2libHkgcHJpdmF0ZSkgbWV0aG9kLgog\nICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBmaW5kRGVjbGFyZWRNZXRob2Qo\nQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSwgQ2xhc3NbXSBwYXJhbXMpIHsKICAg\nICAgICBpZiAoY2xzID09IG51bGwgfHwgY2xzID09IE9iamVjdC5jbGFzcykK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBjbHMuZ2V0RGVjbGFyZWRNZXRob2QobmFtZSwgcGFy\nYW1zKTsKICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24g\nbnNtZSkgewogICAgICAgICAgICByZXR1cm4gZmluZERlY2xhcmVkTWV0aG9k\nKGNscy5nZXRTdXBlcmNsYXNzKCksIG5hbWUsIHBhcmFtcyk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogRW5zdXJlIHRoYXQgdGhlIGdpdmVuIG9pZCBmaWVsZCBpcyBw\ndWJsaWMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtYWtlT2JqZWN0SWRG\naWVsZFB1YmxpYyhGaWVsZCBmaWVsZCkgewogICAgICAgIGlmIChNb2RpZmll\nci5pc1B1YmxpYyhmaWVsZC5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgQkNDbGFzcyBiYyA9IGdldE9iamVjdElkQnl0\nZWNvZGUoZmllbGQuZ2V0RGVjbGFyaW5nQ2xhc3MoKSk7CiAgICAgICAgYmMu\nZ2V0RGVjbGFyZWRGaWVsZChmaWVsZC5nZXROYW1lKCkpLm1ha2VQdWJsaWMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0IHRoZSBnaXZl\nbiBvaWQgbWV0aG9kIGlzIHB1YmxpYy4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIG1ha2VPYmplY3RJZE1ldGhvZFB1YmxpYyhNZXRob2QgbWV0aCkgewog\nICAgICAgIGlmIChNb2RpZmllci5pc1B1YmxpYyhtZXRoLmdldE1vZGlmaWVy\ncygpKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBCQ0NsYXNzIGJj\nID0gZ2V0T2JqZWN0SWRCeXRlY29kZShtZXRoLmdldERlY2xhcmluZ0NsYXNz\nKCkpOwogICAgICAgIGJjLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFt\nZSgpLCBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpLgogICAgICAgICAgICBt\nYWtlUHVibGljKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGJ5dGVjb2RlIGZvciB0aGUgZ2l2ZW4gb2lkIGNsYXNzLCBjcmVhdGluZyBh\nbmQgY2FjaGluZyBpdAogICAgICogaWYgbmVjZXNzYXJ5LgogICAgICovCiAg\nICBwcml2YXRlIEJDQ2xhc3MgZ2V0T2JqZWN0SWRCeXRlY29kZShDbGFzcyBj\nbHMpIHsKICAgICAgICBCQ0NsYXNzIGJjID0gX3BjLmdldFByb2plY3QoKS5s\nb2FkQ2xhc3MoY2xzKTsKICAgICAgICBpZiAoX29pZHMgPT0gbnVsbCkKICAg\nICAgICAgICAgX29pZHMgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgIGlm\nICghX29pZHMuY29udGFpbnMoYmMpKSB7CiAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJlbmhhbmNlLW9pZCIsIGJjLmdldE5hbWUoKSkpOwogICAg\nICAgICAgICBfb2lkcy5hZGQoYmMpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gYmM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBhdXhpbGlh\ncnkgZW5oYW5jZXJzIHJlZ2lzdGVyZWQgYXMge0BsaW5rIFNlcnZpY2VzIHNl\ncnZpY2VzfS4KICAgICAqLwogICAgcHVibGljIEF1eGlsaWFyeUVuaGFuY2Vy\nW10gZ2V0QXV4aWxpYXJ5RW5oYW5jZXJzKCkgewoJCXJldHVybiBfYXV4RW5o\nYW5jZXJzOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFsbG93IGFueSBy\nZWdpc3RlcmVkIGF1eGlsaWFyeSBjb2RlIGdlbmVyYXRvcnMgdG8gcnVuLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcnVuQXV4aWxpYXJ5RW5oYW5jZXJz\nKCkgewogICAgCWZvciAoaW50IGkgPSAwOyBpIDwgX2F1eEVuaGFuY2Vycy5s\nZW5ndGg7IGkrKykKICAgIAkJX2F1eEVuaGFuY2Vyc1tpXS5ydW4oX3BjLCBf\nbWV0YSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0\naGUgZ2l2ZW4gbWV0aG9kIGJlIHNraXBwZWQuCiAgICAgKiAKICAgICAqIEBw\nYXJhbSBtZXRob2QgbWV0aG9kIHRvIGJlIHNraXBwZWQgb3Igbm90CiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgYW55IG9mIHRoZSBhdXhpbGlhcnkgZW5oYW5j\nZXJzIHNraXBzIHRoZSBnaXZlbiBtZXRob2QKICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9kIG1ldGhvZCkgewogICAg\nCWZvciAoaW50IGkgPSAwOyBpIDwgX2F1eEVuaGFuY2Vycy5sZW5ndGg7IGkr\nKykKICAgIAkJaWYgKF9hdXhFbmhhbmNlcnNbaV0uc2tpcEVuaGFuY2UobWV0\naG9kKSkKICAgIAkJCXJldHVybiB0cnVlOwogICAgCXJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgc3ludGhldGljIGZpZWxkIGFj\nY2VzcyBtZXRob2RzIHRoYXQgd2lsbCByZXBsYWNlIGFsbCBkaXJlY3QKICAg\nICAqIGZpZWxkIGFjY2Vzc2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkQWNjZXNzb3JzKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRh\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFkZEdldE1l\ndGhvZChpLCBmbWRzW2ldKTsKICAgICAgICAgICAgYWRkU2V0TWV0aG9kKGks\nIGZtZHNbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYSBzdGF0aWMgZ2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxk\nLgogICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGgg\ndGhlIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdl\nciB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmll\nbGQKICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxk\nIHRvIGdldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0aG9k\nKGludCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0\naG9kID0gY3JlYXRlR2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHJlYWRz\nIGFyZSBub3QgY2hlY2tlZCwganVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICAg\nICAgYnl0ZSBmaWVsZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAg\nICBpZiAoKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19S\nRUFEKSA9PSAwCiAgICAgICAgICAgICYmIChmaWVsZEZsYWcgJiBQZXJzaXN0\nZW5jZUNhcGFibGUuTUVESUFURV9SRUFEKSA9PSAwKSB7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAg\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAg\nICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCkpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBkZmc6IGlmIChp\nbnN0LnBjRmxhZ3MgPD0gMCkgcmV0dXJuIGluc3QuPGZpZWxkPjsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBudWxsOwogICAgICAgIGlmICgo\nZmllbGRGbGFnICYgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JFQUQpID4g\nMCkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRy\ndWUpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoUFJF\nICsgIkZsYWdzIiwgYnl0ZS5jbGFzcyk7CiAgICAgICAgICAgIGlmaW5zID0g\nY29kZS5pZmd0KCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0\nVHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gaWYgKGluc3QucGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJu\nIGluc3QuPGZpZWxkPjsKICAgICAgICBJbnN0cnVjdGlvbiBpbnMgPSBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGlmIChpZmlu\ncyAhPSBudWxsKQogICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoaW5zKTsK\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgYWRkR2V0\nTWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIGNvZGUueHJl\ndHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAg\nICAgLy8gaW50IGZpZWxkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGZp\nZWxkaW5kZXg+OwogICAgICAgIGludCBmaWVsZExvY2FsID0gY29kZS5nZXRO\nZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpKTsK\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAg\nICAgIGNvZGUuaWFkZCgpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9j\nYWwoZmllbGRMb2NhbCk7CgogICAgICAgIC8vIGluc3QucGNTdGF0ZU1hbmFn\nZXIuYWNjZXNzaW5nRmllbGQgKGZpZWxkKTsKICAgICAgICAvLyByZXR1cm4g\naW5zdC48ZmllbGQ+OwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgdHJ1ZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChmaWVs\nZExvY2FsKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChTTVRZUEUsICJhY2Nlc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54\ncmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYSBzdGF0aWMgc2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxk\nLgogICAgICogVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGgg\ndGhlIGluc3RhbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdl\nciB0byBzZXQgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gaW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmll\nbGQKICAgICAqIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxk\nIHRvIHNldAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2V0TWV0aG9k\nKGludCBpbmRleCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0\naG9kID0gY3JlYXRlU2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIFBDRW5oYW5j\nZXIgdXNlcyBzdGF0aWMgbWV0aG9kczsgUENTdWJjbGFzc2VyIGRvZXMgbm90\nLgogICAgICAgIGludCBmaXJzdFBhcmFtT2Zmc2V0ID0gZ2V0QWNjZXNzb3JQ\nYXJhbWV0ZXJPZmZzZXQoKTsKCiAgICAgICAgLy8gZGZnOiBpZiAoaW5zdC5w\nY0ZsYWdzID09IDApIGluc3QuPGZpZWxkPiA9IHZhbHVlOwogICAgICAgIEp1\nbXBJbnN0cnVjdGlvbiBpZmlucyA9IG51bGw7CiAgICAgICAgYnl0ZSBmaWVs\nZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAgICBpZiAoKGZpZWxk\nRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURSkgPiAwKSB7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7\nCiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChQUkUgKyAi\nRmxhZ3MiLCBieXRlLmNsYXNzKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2Rl\nLmlmbmUoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCB0cnVlKTsKICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZp\ncnN0UGFyYW1PZmZzZXQpOwogICAgICAgICAgICBhZGRTZXRNYW5hZ2VkVmFs\ndWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgKGluc3QucGNTdGF0ZU1hbmFn\nZXIgPT0gbnVsbCkgaW5zdC48ZmllbGQ+ID0gdmFsdWU7CiAgICAgICAgSW5z\ndHJ1Y3Rpb24gaW5zID0gbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVl\nKTsKICAgICAgICBpZiAoaWZpbnMgIT0gbnVsbCkKICAgICAgICAgICAgaWZp\nbnMuc2V0VGFyZ2V0KGlucyk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGlmaW5zID0gY29kZS5pZm5v\nbm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRy\ndWUpOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFt\nT2Zmc2V0KTsKICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUs\nIGZtZCk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8vIGlu\nc3QucGNTdGF0ZU1hbmFnZXIuc2V0dGluZzxmaWVsZFR5cGU+RmllbGQgKGlu\nc3QsCiAgICAgICAgLy8JcGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGluZGV4\nPiwgaW5zdC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSkpOwogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAg\nIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNz\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwog\nICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29k\nZShjb2RlLCBmbWQpOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShm\naXJzdFBhcmFtT2Zmc2V0KTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoMCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRN\nZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCksICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsK\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0\ndGFjaCAvIGRldGFjaCBtZXRob2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZEF0dGFjaERldGFjaENvZGUoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHNlZSBpZiBh\nbnkgc3VwZXJjbGFzc2VzIGFyZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVh\nbiBwYXJlbnREZXRhY2hhYmxlID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFz\nc01ldGFEYXRhIHBhcmVudCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBw\nYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkgewogICAgICAgICAg\nICBpZiAocGFyZW50LmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAg\nICBwYXJlbnREZXRhY2hhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBw\nYXJlbnQgbm90IGRldGFjaGFibGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRh\nY2ggc3RhdGUgZmllbGRzIGFuZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhv\nZHMKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVs\nbAogICAgICAgICAgICB8fCBwYXJlbnREZXRhY2hhYmxlICE9IF9tZXRhLmlz\nRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgIGFkZElzRGV0YWNoZWRNZXRo\nb2QoKTsKICAgICAgICAgICAgYWRkRGV0YWNoZWRTdGF0ZU1ldGhvZHMoX21l\ndGEudXNlc0RldGFjaGVkU3RhdGUoKQogICAgICAgICAgICAgICAgIT0gQm9v\nbGVhbi5GQUxTRSk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB3ZSBkZXRh\nY2ggb24gc2VyaWFsaXplLCB3ZSBhbHNvIG5lZWQgdG8gaW1wbGVtZW50IHRo\nZQogICAgICAgIC8vIGV4dGVybmFsaXphYmxlIGludGVyZmFjZSB0byB3cml0\nZSBqdXN0IHRoZSBzdGF0ZSBmb3IgdGhlIGZpZWxkcwogICAgICAgIC8vIGJl\naW5nIGRldGFjaGVkCiAgICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNoZWQo\nKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYWRkRGV0\nYWNoRXh0ZXJuYWxpemUocGFyZW50RGV0YWNoYWJsZSwKICAgICAgICAgICAg\nICAgICAgICBfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpICE9IEJvb2xlYW4u\nRkFMU0UpOwogICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gbnNtZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24obnNtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGZpZWxkcyB0byBob2xkIGRl\ndGFjaGVkIHN0YXRlIGFuZCB0aGVpciBhY2Nlc3NvciBtZXRob2RzLgogICAg\nICoKICAgICAqIEBwYXJhbSBpbXBsIHdoZXRoZXIgdG8gZnVsbHkgaW1wbGVt\nZW50IGRldGFjaCBzdGF0ZSBmdW5jdGlvbmFsaXR5CiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGREZXRhY2hlZFN0YXRlTWV0aG9kcyhib29sZWFuIGlt\ncGwpIHsKICAgICAgICBGaWVsZCBkZXRhY2hGaWVsZCA9IF9tZXRhLmdldERl\ndGFjaGVkU3RhdGVGaWVsZCgpOwogICAgICAgIFN0cmluZyBuYW1lID0gbnVs\nbDsKICAgICAgICBTdHJpbmcgZGVjbGFyZXIgPSBudWxsOwogICAgICAgIGlm\nIChpbXBsICYmIGRldGFjaEZpZWxkID09IG51bGwpIHsKICAgICAgICAgICAg\nbmFtZSA9IFBSRSArICJEZXRhY2hlZFN0YXRlIjsKICAgICAgICAgICAgZGVj\nbGFyZXIgPSBfcGMuZ2V0TmFtZSgpOwogICAgICAgICAgICBCQ0ZpZWxkIGZp\nZWxkID0gX3BjLmRlY2xhcmVGaWVsZChuYW1lLCBPYmplY3QuY2xhc3MpOwog\nICAgICAgICAgICBmaWVsZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICBm\naWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChp\nbXBsKSB7CiAgICAgICAgICAgIG5hbWUgPSBkZXRhY2hGaWVsZC5nZXROYW1l\nKCk7CiAgICAgICAgICAgIGRlY2xhcmVyID0gZGV0YWNoRmllbGQuZ2V0RGVj\nbGFyaW5nQ2xhc3MoKS5nZXROYW1lKCk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBwdWJsaWMgT2JqZWN0IHBjR2V0RGV0YWNoZWRTdGF0ZSAoKQogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJH\nZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBu\ndWxsKTsKICAgICAgICBtZXRob2Quc2V0U3RhdGljKGZhbHNlKTsKICAgICAg\nICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAgIGludCBhY2Nlc3MgPSBt\nZXRob2QuZ2V0QWNjZXNzRmxhZ3MoKTsKCiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgaWYgKGltcGwpIHsKICAg\nICAgICAgICAgLy8gcmV0dXJuIHBjRGV0YWNoZWRTdGF0ZTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChkZWNsYXJlciwgbmFtZSwg\nT2JqZWN0LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CgogICAgICAg\nIC8vIHB1YmxpYyB2b2lkIHBjU2V0RGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0\nYXRlKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSAr\nICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywg\nbmV3IENsYXNzIFtdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9k\nLnNldEFjY2Vzc0ZsYWdzKGFjY2Vzcyk7CiAgICAgICAgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAg\nICAgIC8vIHBjRGV0YWNoZWRTdGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLnB1\ndGZpZWxkKCkuc2V0RmllbGQoZGVjbGFyZXIsIG5hbWUsCiAgICAgICAgICAg\nICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICAg\nICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIGV4dGVybmFsaXph\nYmxlIGludGVyZmFjZSB0byBkZXRhY2ggb24gc2VyaWFsaXplLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVh\nbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRT\ndGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBj\nb25zdHJ1Y3RvciBpcyBwdWJsaWMgCiAgICAgICAgLy8gZm9yIGV4dGVybmFs\naXphdGlvbgogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7CiAgICAgICAg\naWYgKCFtZXRoLmlzUHVibGljKCkpIHsKICAgICAgICAgICAgaWYgKF9sb2cu\naXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJlbmhhbmNlLWRlZmNvbnMtZXh0ZXJuIiwgCiAgICAgICAgICAg\nICAgICAgIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpOwogICAgICAgICAg\nICBtZXRoLm1ha2VQdWJsaWMoKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVj\nbGFyZSBleHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UKICAgICAgICBpZiAoIUV4\ndGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRl\ncmZhY2UoRXh0ZXJuYWxpemFibGUuY2xhc3MpOwoKICAgICAgICAvLyBtYWtl\nIHN1cmUgdGhlIHVzZXIgZG9lc24ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4\ndGVybmFsaXphdGlvbiBvcgogICAgICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0\naG9kcwogICAgICAgIENsYXNzW10gaW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0SW5wdXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBDbGFzc1tdIG91dHB1\ndCA9IG5ldyBDbGFzc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsK\nICAgICAgICBpZiAoX3BjLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2JqZWN0\nIiwgaW5wdXQpICE9IG51bGwKICAgICAgICAgICAgfHwgX3BjLmdldERlY2xh\ncmVkTWV0aG9kKCJ3cml0ZU9iamVjdCIsIG91dHB1dCkgIT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImRl\ndGFjaC1jdXN0b20tc2VyIiwgX21ldGEpKTsKICAgICAgICBpbnB1dFswXSA9\nIE9iamVjdElucHV0LmNsYXNzOwogICAgICAgIG91dHB1dFswXSA9IE9iamVj\ndE91dHB1dC5jbGFzczsKICAgICAgICBpZiAoX3BjLmdldERlY2xhcmVkTWV0\naG9kKCJyZWFkRXh0ZXJuYWwiLCBpbnB1dCkgIT0gbnVsbAogICAgICAgICAg\nICB8fCBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCBv\ndXRwdXQpICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJkZXRhY2gtY3VzdG9tLWV4dGVybiIsIF9tZXRh\nKSk7CgogICAgICAgIC8vIGNyZWF0ZSBsaXN0IG9mIGFsbCB1bm1hbmFnZWQg\nc2VyaWFsaXphYmxlIGZpZWxkcwogICAgICAgIEJDRmllbGRbXSBmaWVsZHMg\nPSBfcGMuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBDb2xsZWN0aW9u\nIHVubWdkID0gbmV3IEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAoIWZpZWxkc1tpXS5pc1RyYW5zaWVudCgpICYmICFm\naWVsZHNbaV0uaXNTdGF0aWMoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxk\nc1tpXS5pc0ZpbmFsKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0u\nZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoUFJFKQogICAgICAgICAgICAgICAgJiYg\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7\nCiAgICAgICAgfQoKICAgICAgICBhZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0\nYWNoYWJsZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkUmVhZFVubWFu\nYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICAgICAgYWRkV3Jp\ndGVFeHRlcm5hbChwYXJlbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsK\nICAgICAgICBhZGRXcml0ZVVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNo\nYWJsZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRF\neHRlcm5hbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRS\nZWFkRXh0ZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAg\nIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5l\ndyBDbGFzc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0\naG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZCgicmVhZEV4dGVybmFsIiwg\ndm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2Vw\ncyA9IG1ldGguZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMu\nYWRkRXhjZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNl\ncHMuYWRkRXhjZXB0aW9uKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3Mp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgLy8gc3VwZXIucmVhZEV4dGVybmFsIChpbik7CiAgICAgICAgQ2xh\nc3Mgc3VwID0gX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xh\nc3MoKTsKICAgICAgICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJu\nYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJyZWFkRXh0\nZXJuYWwiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgaW5hcmdzKTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJlYWRVbm1hbmFnZWQgKGluKTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAgICAg\nICAgICBQUkUgKyAiUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJn\ncyk7CgogICAgICAgIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAg\nIC8vIHBjU2V0RGV0YWNoZWRTdGF0ZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElu\ncHV0LmNsYXNzLCAicmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmpl\nY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5j\nbGFzcyB9KTsKCiAgICAgICAgICAgIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdl\nciAoKFN0YXRlTWFuYWdlcikgaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNs\nYXNzLCAicmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoU3RhdGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJSZXBsYWNlU3RhdGVNYW5h\nZ2VyIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBTdGF0ZU1hbmFnZXIuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAv\nLyByZWFkIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICgh\nZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgcmVhZEV4\ndGVybmFsKGNvZGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgICAgIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoK\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxk\ncyBmcm9tIHRoZSBzdHJlYW0gKHBjUmVhZFVubWFuYWdlZCkuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24g\ndW5tZ2QsIGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGlu\nYXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAg\nICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIGluYXJn\ncyk7CiAgICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhj\nZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAg\nICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhj\nZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGlu\nKTsKICAgICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAg\nICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUg\nKyAiUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAg\nICAgaW5hcmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgZGVjbGFy\nZWQgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0Zp\nZWxkIGZpZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2Qu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmll\nbGQgPSAoQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgcmVhZEV4\ndGVybmFsKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgp\nLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRvIHJlYWQgYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFs\naXphdGlvbiBpbnB1dCBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCByZWFkRXh0ZXJuYWwoQ29kZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBD\nbGFzcyB0eXBlLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0cmlu\nZyBtZXRoTmFtZTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7\nCiAgICAgICAgICAgIG1ldGhOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAg\nICAgICAgIG1ldGhOYW1lID0gQ2hhcmFjdGVyLnRvVXBwZXJDYXNlKG1ldGhO\nYW1lLmNoYXJBdCgwKSkKICAgICAgICAgICAgICAgICsgbWV0aE5hbWUuc3Vi\nc3RyaW5nKDEpOwogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFkIiArIG1l\ndGhOYW1lOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9\nICJyZWFkT2JqZWN0IjsKCiAgICAgICAgLy8gPGZpZWxkPiA9IGluLnJlYWQ8\ndHlwZT4gKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgIENsYXNzIHJldCA9ICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6\nIE9iamVjdC5jbGFzczsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgbWV0aE5hbWUsCiAgICAg\nICAgICAgIHJldCwgbnVsbCk7CiAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0\naXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAoZm1k\nID09IG51bGwpCiAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVs\nZChmaWVsZE5hbWUsIHR5cGUpOwogICAgICAgIGVsc2UgewogICAgICAgICAg\nICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAg\nICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9CSkVDVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVO\nREFSOgogICAgICAgICAgICAgICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIC8vICAgc20ucHJveHlEZXRhY2hlZERlc2Vy\naWFsaXplZCAoPGluZGV4Pik7CiAgICAgICAgICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlm\nbnVsbCgpOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdldEluZGV4KCkp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKFNNVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgInBy\nb3h5RGV0YWNoZWREZXNlcmlhbGl6ZWQiLCB2b2lkLmNsYXNzLAogICAgICAg\nICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwog\nICAgICAgICAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBjdXN0b20gd3JpdGVFeHRlcm5hbCBtZXRob2QuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZUV4dGVybmFsKGJvb2xlYW4gcGFy\nZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgQ2xhc3NbXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVjdE91dHB1\ndC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFy\nZU1ldGhvZCgid3JpdGVFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIG91dGFyZ3Mp\nOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNlcHRp\nb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9FeGNl\ncHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29k\nZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIud3JpdGVFeHRlcm5hbCAob3V0\nKTsKICAgICAgICBDbGFzcyBzdXAgPSBnZXRUeXBlKF9tZXRhKS5nZXRTdXBl\ncmNsYXNzKCk7CiAgICAgICAgaWYgKCFwYXJlbnREZXRhY2hhYmxlICYmIEV4\ndGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oc3VwKSkgewog\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3VwLCAid3Jp\ndGVFeHRlcm5hbCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBvdXRh\ncmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHdyaXRlVW5tYW5hZ2VkIChv\ndXQpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YSks\nCiAgICAgICAgICAgIFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZvaWQuY2xh\nc3MsIG91dGFyZ3MpOwoKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0g\nbnVsbDsKICAgICAgICBpZiAoZGV0YWNoZWRTdGF0ZSkgewogICAgICAgICAg\nICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgLy8gICBpZiAoc20u\nd3JpdGVEZXRhY2hlZCAob3V0KSkKICAgICAgICAgICAgLy8gICAgICByZXR1\ncm47CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00s\nIFNNVFlQRSk7CiAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZudWxsID0g\nY29kZS5pZm51bGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5z\nZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChTTVRZUEUsICJ3cml0ZURldGFjaGVkIiwKICAgICAg\nICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG91dGFyZ3MpOwogICAgICAgICAg\nICBnbzIgPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CgogICAgICAgICAgICAvLyBlbHNlCiAgICAgICAgICAgIC8vICAgb3V0\nLndyaXRlT2JqZWN0IChwY0dldERldGFjaGVkU3RhdGUgKCkpOwogICAgICAg\nICAgICBDbGFzc1tdIG9iamFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNs\nYXNzIH07CiAgICAgICAgICAgIGlmbnVsbC5zZXRUYXJnZXQoY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RPdXRw\ndXQuY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2b2lk\nLmNsYXNzLCBvYmphcmdzKTsKICAgICAgICAgICAgLy8gICAgb3V0LndyaXRl\nT2JqZWN0IChudWxsKSAvLyBTdGF0ZU1hbmFnZXIKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoKE9iamVjdCkgbnVsbCk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5j\nbGFzcywKICAgICAgICAgICAgICAgICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xh\nc3MsIG9iamFyZ3MpOwogICAgICAgIH0KICAgICAgICBpZiAoZ28yICE9IG51\nbGwpCiAgICAgICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7Cgog\nICAgICAgIC8vIHdyaXRlIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgIGlmICghZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAg\nICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmbWRzW2ldLmdldE5hbWUoKSwKICAg\nICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCBm\nbWRzW2ldKTsKCiAgICAgICAgLy8gcmV0dXJuCiAgICAgICAgY29kZS52cmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXcml0ZSB1bm1hbmFnZWQgZmllbGRzIHRvIHRoZSBzdHJlYW0g\nKHBjV3JpdGVVbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkV3JpdGVVbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1nZCwgYm9vbGVhbiBw\nYXJlbnREZXRhY2hhYmxlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBDbGFz\nc1tdeyBPYmplY3RPdXRwdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBt\nZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIldyaXRlVW5tYW5hZ2Vk\nIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgb3V0YXJncyk7CiAgICAgICAg\nbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBleGNl\ncHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhjZXBz\nLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBl\nci53cml0ZVVubWFuYWdlZCAob3V0KTsKICAgICAgICBpZiAocGFyZW50RGV0\nYWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFt\nKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRo\nb2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lk\nLmNsYXNzLCAKICAgICAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gd3JpdGUgZGVjbGFyZWQgdW5tYW5hZ2VkIHNlcmlhbGl6\nYWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVsZCkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmaWVsZC5n\nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byB3cml0\nZSBhIGZpZWxkIHRvIGFuIGV4dGVybmFsaXphdGlvbiBvdXRwdXQgc3RyZWFt\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd3JpdGVFeHRlcm5hbChDb2Rl\nIGNvZGUsIFN0cmluZyBmaWVsZE5hbWUsIENsYXNzIHR5cGUsCiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lOwogICAgICAg\nIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpIHsKICAgICAgICAgICAgbWV0aE5h\nbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSBD\naGFyYWN0ZXIudG9VcHBlckNhc2UobWV0aE5hbWUuY2hhckF0KDApKQogICAg\nICAgICAgICAgICAgKyBtZXRoTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\nICAgIG1ldGhOYW1lID0gIndyaXRlIiArIG1ldGhOYW1lOwogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJ3cml0ZU9iamVjdCI7Cgog\nICAgICAgIC8vIG91dC53cml0ZTx0eXBlPiAoPGZpZWxkPik7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlmIChmbWQgPT0gbnVs\nbCkKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGZpZWxk\nTmFtZSwgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgQ2xhc3NbXSBh\ncmdzID0gbmV3IENsYXNzW117IHR5cGUgfTsKICAgICAgICBpZiAodHlwZSA9\nPSBieXRlLmNsYXNzIHx8IHR5cGUgPT0gY2hhci5jbGFzcyB8fCB0eXBlID09\nIHNob3J0LmNsYXNzKQogICAgICAgICAgICBhcmdzWzBdID0gaW50LmNsYXNz\nOwogICAgICAgIGVsc2UgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAg\nICAgICAgIGFyZ3NbMF0gPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNz\nLCBtZXRoTmFtZSwKICAgICAgICAgICAgdm9pZC5jbGFzcywgYXJncyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBmaWVsZCB2YWx1ZSBzcGVj\naWZpZWQgYnkgPGNvZGU+Zm1kPC9jb2RlPiBvbnRvIHRoZSBzdGFjay4KICAg\nICAqIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBjYWxsZWQsIHRoZSBvYmplY3Qg\ndGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9hZGVkCiAgICAgKiBmcm9tIHdp\nbGwgYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2suCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwg\nRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkKICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKGZtZC5nZXROYW1lKCksIGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgZWxzZSAvLyBwcm9wZXJ0eQog\nICAgICAgIHsKICAgICAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBm\nbWQuZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgbWV0aC5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICBtZXRoLmdldFJldHVyblR5cGUoKSwgbWV0aC5nZXRQ\nYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTdG9yZSB0aGUgdmFsdWUgYXQgdGhlIHRvcCBvZiB0aGUgc3RhY2sg\naW50byB0aGUgZmllbGQgdmFsdWUgc3BlY2lmaWVkCiAgICAgKiBieSA8Y29k\nZT5mbWQ8L2NvZGU+LiBCZWZvcmUgdGhpcyBtZXRob2QgaXMgY2FsbGVkLCB0\naGUgZGF0YSB0byBsb2FkIHdpbGwKICAgICAqIGJlIG9uIHRoZSB0b3Agb2Yg\ndGhlIHN0YWNrIGFuZCB0aGUgb2JqZWN0IHRoYXQgdGhlIGRhdGEgc2hvdWxk\nIGJlIGxvYWRlZAogICAgICogaW50byB3aWxsIGJlIHNlY29uZCBpbiB0aGUg\nc3RhY2suCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXRNYW5hZ2Vk\nVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VT\nU19GSUVMRCkKICAgICAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxk\nKGZtZC5nZXROYW1lKCksIGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAg\nICAgZWxzZSAvLyBwcm9wZXJ0eQogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgZ2V0U2V0dGVyTmFtZShmbWQpLAog\nICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgb2Zmc2V0IHRoYXQgdGhlIGZpcnN0IG1lYW5pbmdmdWwgYWNj\nZXNzb3IgcGFyYW1ldGVyIGlzIGF0LgogICAgICovCiAgICBwcml2YXRlIGlu\ndCBnZXRBY2Nlc3NvclBhcmFtZXRlck9mZnNldCgpIHsKICAgICAgICByZXR1\ncm4gKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFD\nQ0VTU19GSUVMRCkgPyAxIDogMDsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUge0BsaW5rIEluc3RydWN0aW9ufXMgdG8gbG9hZCB0aGUgaW5zdGFu\nY2UgdG8gbW9kaWZ5IG9udG8gdGhlCiAgICAgKiBzdGFjaywgYW5kIHJldHVy\nbiBpdC4gSWYgPGNvZGU+dXNlck9iamVjdDwvY29kZT4gaXMgc2V0LAogICAg\nICogdGhlbiA8Y29kZT5jb2RlPC9jb2RlPiB3aWxsIGJlIGFjY2Vzc2luZyBk\nYXRhIGluIHRoZSB1c2VyLXZpc2libGUKICAgICAqIG9iamVjdCAod2hpY2gg\nbWlnaHQgbm90IGJlICd0aGlzJyBpbiBwcm94eWluZyBjb250ZXh0cyksCiAg\nICAgKiBhbmQgdGhlIGxvYWQgY29kZSBzaG91bGQgYmVoYXZlIGFjY29yZGlu\nZ2x5LiBPdGhlcndpc2UsCiAgICAgKiA8Y29kZT5jb2RlPC9jb2RlPiB3aWxs\nIGJlIGFjY2Vzc2luZyBQQy1jb250cmFjdCBkYXRhLCB3aGljaCBtdXN0IGFs\nd2F5cwogICAgICogYmUgaW4gJ3RoaXMnLiBJZiA8Y29kZT5mb3JBY2Nlc29y\nPC9jb2RlPiBpcyBzZXQsIHRoZW4gPGNvZGU+Y29kZTwvY29kZT4KICAgICAq\nIGlzIGluIGFuIGFjY2Vzc29yIG1ldGhvZDsgb3RoZXJ3aXNlLCBpdCBpcyBp\nbiBvbmUgb2YgdGhlIFBDLXNwZWNpZmllZAogICAgICogbWV0aG9kcy4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaXJzdCBpbnN0cnVjdGlvbiBhZGRl\nZCB0byA8Y29kZT5jb2RlPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0ZSBJ\nbnN0cnVjdGlvbiBsb2FkTWFuYWdlZEluc3RhbmNlKENvZGUgY29kZSwKICAg\nICAgICBib29sZWFuIGZvckFjY2Vzc29yKSB7CiAgICAgICAgaWYgKF9tZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCAmJiBmb3JBY2Nlc3NvcikKICAgICAgICAgICAgcmV0dXJuIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUg\nZ2VuZXJhdGVkIGdldHRlciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5m\nbWQ8L2NvZGU+LiBUaGUKICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2ls\nbCB0aGVuIHBvcHVsYXRlIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAg\nICAqLwogICAgcHJpdmF0ZSBCQ01ldGhvZCBjcmVhdGVHZXRNZXRob2QoRmll\nbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXI7CiAg\nICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgPGZp\nZWxkdHlwZT4gcGNHZXQ8ZmllbGQ+IChYWFggaW5zdCkKICAgICAgICAgICAg\nQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXRO\nYW1lKCkpOwogICAgICAgICAgICBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiR2V0IiArIGZtZC5nZXROYW1lKCksIGZtZC4KICAgICAgICAg\nICAgICAgIGdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSwgbmV3IFN0cmlu\nZ1tdeyBfcGMuZ2V0TmFtZSgpIH0pOwogICAgICAgICAgICBnZXR0ZXIuc2V0\nQWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNjZXNzRmxhZ3MoKQogICAgICAgICAg\nICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VTU19UUkFOU0lFTlQgJiB+Q29uc3Rh\nbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAgICAgICAgICAgIGdldHRlci5zZXRT\ndGF0aWModHJ1ZSk7CiAgICAgICAgICAgIGdldHRlci5zZXRGaW5hbCh0cnVl\nKTsKICAgICAgICAgICAgcmV0dXJuIGdldHRlcjsKICAgICAgICB9CgogICAg\nICAgIC8vIHByb3BlcnR5IGFjY2VzczoKICAgICAgICAvLyBjb3B5IHRoZSB1\nc2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBhIG5ldyBuYW1lOyB3ZSBjYW4ndCBq\ndXN0IHJlc2V0CiAgICAgICAgLy8gdGhlIG5hbWUsIGJlY2F1c2UgdGhhdCB3\naWxsIGFsc28gcmVzZXQgYWxsIGNhbGxzIHRvIHRoZSBtZXRob2QKICAgICAg\nICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVtYmVy\nKCk7CiAgICAgICAgZ2V0dGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKG1l\ndGguZ2V0TmFtZSgpLAogICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5\ncGVzKCkpOwogICAgICAgIEJDTWV0aG9kIG5ld2dldHRlciA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArIG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICBt\nZXRoLmdldFJldHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygp\nKTsKICAgICAgICBuZXdnZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZ2V0dGVyLmdl\ndEFjY2Vzc0ZsYWdzKCkpOwogICAgICAgIG5ld2dldHRlci5tYWtlUHJpdmF0\nZSgpOwogICAgICAgIHRyYW5zZmVyQ29kZUF0dHJpYnV0ZXMoZ2V0dGVyLCBu\nZXdnZXR0ZXIpOwogICAgICAgIHJldHVybiBnZXR0ZXI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgdGhlIGdlbmVyYXRlZCBzZXR0ZXIge0BsaW5r\nIEJDTWV0aG9kfSBmb3IgPGNvZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBj\nYWxsaW5nIGVudmlyb25tZW50IHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1l\ndGhvZCdzIGNvZGUgYmxvY2suCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRo\nb2QgY3JlYXRlU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgQkNNZXRob2Qgc2V0dGVyOwogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAg\nICAgICAgICAgLy8gc3RhdGljIHZvaWQgcGNTZXQ8ZmllbGQ+IChYWFggaW5z\ndCwgPGZpZWxkdHlwZT4gdmFsdWUpCiAgICAgICAgICAgIEJDRmllbGQgZmll\nbGQgPSBfcGMuZ2V0RGVjbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgc2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNl\ndCIgKyBmbWQuZ2V0TmFtZSgpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAg\nICAgbmV3IENsYXNzW117IGdldFR5cGUoX21ldGEpLCBmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkgfSk7CiAgICAgICAgICAgIHNldHRlci5zZXRBY2Nlc3NGbGFn\ncyhmaWVsZC5nZXRBY2Nlc3NGbGFncygpCiAgICAgICAgICAgICAgICAmIH5D\nb25zdGFudHMuQUNDRVNTX1RSQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNT\nX1ZPTEFUSUxFKTsKICAgICAgICAgICAgc2V0dGVyLnNldFN0YXRpYyh0cnVl\nKTsKICAgICAgICAgICAgc2V0dGVyLnNldEZpbmFsKHRydWUpOwogICAgICAg\nICAgICByZXR1cm4gc2V0dGVyOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJv\ncGVydHkgYWNjZXNzOgogICAgICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0\nZXIgbWV0aG9kIHRvIGEgbmV3IG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQK\nICAgICAgICAvLyB0aGUgbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyBy\nZXNldCBhbGwgY2FsbHMgdG8gdGhlIG1ldGhvZAogICAgICAgIHNldHRlciA9\nIF9wYy5nZXREZWNsYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZCksCiAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkg\nfSk7CiAgICAgICAgQkNNZXRob2QgbmV3c2V0dGVyID0gX3BjLmRlY2xhcmVN\nZXRob2QoUFJFICsgc2V0dGVyLmdldE5hbWUoKSwKICAgICAgICAgICAgc2V0\ndGVyLmdldFJldHVybk5hbWUoKSwgc2V0dGVyLmdldFBhcmFtTmFtZXMoKSk7\nCiAgICAgICAgbmV3c2V0dGVyLnNldEFjY2Vzc0ZsYWdzKHNldHRlci5nZXRB\nY2Nlc3NGbGFncygpKTsKICAgICAgICBuZXdzZXR0ZXIubWFrZVByaXZhdGUo\nKTsKICAgICAgICB0cmFuc2ZlckNvZGVBdHRyaWJ1dGVzKHNldHRlciwgbmV3\nc2V0dGVyKTsKICAgICAgICByZXR1cm4gc2V0dGVyOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBjb25jcmV0ZSB0eXBlIGZvciB0aGUgZ2l2\nZW4gY2xhc3MsIGkuZS4gaW1wbCBmb3IgbWFuYWdlZAogICAgICogaW50ZXJm\nYWNlcwogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0VHlwZShDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0SW50\nZXJmYWNlSW1wbCgpOwogICAgICAgIHJldHVybiBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBNb3ZlIGNvZGUtcmVs\nYXRlZCBhdHRyaWJ1dGVzIGZyb20gb25lIG1ldGhvZCB0byBhbm90aGVyLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHRyYW5zZmVyQ29kZUF0\ndHJpYnV0ZXMoQkNNZXRob2QgZnJvbSwgQkNNZXRob2QgdG8pIHsKICAgICAg\nICBDb2RlIGNvZGUgPSBmcm9tLmdldENvZGUoZmFsc2UpOwogICAgICAgIGlm\nIChjb2RlICE9IG51bGwpIHsKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRl\nKGNvZGUpOwogICAgICAgICAgICBmcm9tLnJlbW92ZUNvZGUoKTsKICAgICAg\nICB9CgogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gZnJvbS5nZXRFeGNl\ncHRpb25zKGZhbHNlKTsKICAgICAgICBpZiAoZXhjZXBzICE9IG51bGwpCiAg\nICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShleGNlcHMpOwogICAgfQoKICAg\nIC8qKgogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuUENFbmhhbmNlciBbb3B0aW9uXSoKICAgICAqICZsdDtjbGFzcyBu\nYW1lIHwgLmphdmEgZmlsZSB8IC5jbGFzcyBmaWxlIHwgLmpkbyBmaWxlJmd0\nOysKICAgICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJl\nY29nbml6ZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3BlcnRp\nZXMvLXAgJmx0O3Byb3BlcnRpZXMgZmlsZSZndDs8L2k+OiBUaGUgcGF0aCB0\nbyBhIE9wZW5KUEEKICAgICAqIHByb3BlcnRpZXMgZmlsZSBjb250YWluaW5n\nIGluZm9ybWF0aW9uIGFzIG91dGxpbmVkIGluCiAgICAgKiB7QGxpbmsgQ29u\nZmlndXJhdGlvbn07IG9wdGlvbmFsLjwvbGk+CiAgICAgKiA8bGk+PGk+LSZs\ndDtwcm9wZXJ0eSBuYW1lJmd0OyAmbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7PC9p\nPjogQWxsIGJlYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIHN0YW5kYXJk\nIE9wZW5KUEEge0BsaW5rIE9wZW5KUEFDb25maWd1cmF0aW9ufSBjYW4gYmUK\nICAgICAqIHNldCBieSB1c2luZyB0aGVpciBuYW1lcyBhbmQgc3VwcGx5aW5n\nIGEgdmFsdWU7IGZvciBleGFtcGxlOgogICAgICogPGxpPjxpPi1kaXJlY3Rv\ncnkvLWQgJmx0O2J1aWxkIGRpcmVjdG9yeSZndDs8L2k+OiBUaGUgcGF0aCB0\nbyB0aGUgYmFzZQogICAgICogZGlyZWN0b3J5IHdoZXJlIGVuaGFuY2VkIGNs\nYXNzZXMgYXJlIHN0b3JlZC4gQnkgZGVmYXVsdCwgdGhlCiAgICAgKiBlbmhh\nbmNlciBvdmVyd3JpdGVzIHRoZSBvcmlnaW5hbCAuY2xhc3MgZmlsZSB3aXRo\nIHRoZSBlbmhhbmNlZAogICAgICogdmVyc2lvbi4gVXNlIHRoaXMgb3B0aW9u\nIHRvIHN0b3JlIHRoZSBnZW5lcmF0ZWQgLmNsYXNzIGZpbGUgaW4KICAgICAq\nIGFub3RoZXIgZGlyZWN0b3J5LiBUaGUgcGFja2FnZSBzdHJ1Y3R1cmUgd2ls\nbCBiZSBjcmVhdGVkIGJlbmVhdGgKICAgICAqIHRoZSBnaXZlbiBkaXJlY3Rv\ncnkuPC9saT4KICAgICAqIDxsaT48aT4tYWRkRGVmYXVsdENvbnN0cnVjdG9y\nLy1hZGMgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAg\nICogYWRkIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciB0byBwZXJzaXN0ZW50IGNs\nYXNzZXMgbWlzc2luZyBvbmUsIGFzCiAgICAgKiBvcHBvc2VkIHRvIHRocm93\naW5nIGFuIGV4Y2VwdGlvbi4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgogICAg\nICogPGxpPjxpPi10bXBDbGFzc0xvYWRlci8tdGNsIFt0cnVlL3QgfCBmYWxz\nZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGxvYWQgdGhlIHByZS1lbmhh\nbmNlZCBjbGFzc2VzIHVzaW5nIGEgdGVtcG9yYXJ5IGNsYXNzIGxvYWRlci4K\nICAgICAqIERlZmF1bHRzIHRvIHRydWUuIFNldCB0aGlzIHRvIGZhbHNlIHdo\nZW4gYXR0ZW1wdGluZyB0byBkZWJ1ZwogICAgICogY2xhc3MgbG9hZGluZyBl\ncnJvcnMuPC9saT4KICAgICAqIDxsaT48aT4tZW5mb3JjZVByb3BlcnR5UmVz\ndHJpY3Rpb25zLy1lcHIgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjoKICAgICAq\nIFdoZXRoZXIgdG8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgUFJPUEVSVFkg\nYWNjZXNzIGVudGl0eSBhcHBlYXJzCiAgICAgKiB0byBiZSB2aW9sYXRpbmcg\nc3RhbmRhcmQgcHJvcGVydHkgcmVzdHJpY3Rpb25zLiBEZWZhdWx0cyB0byBm\nYWxzZS48L2xpPgogICAgICogPC91bD4KICAgICAqICBFYWNoIGFkZGl0aW9u\nYWwgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgZnVsbCBjbGFzcyBuYW1l\nIG9mIHRoZQogICAgICogdHlwZSB0byBlbmhhbmNlLCB0aGUgcGF0aCB0byB0\naGUgLmphdmEgZmlsZSBmb3IgdGhlIHR5cGUsIHRoZSBwYXRoIHRvCiAgICAg\nKiB0aGUgLmNsYXNzIGZpbGUgZm9yIHRoZSB0eXBlLCBvciB0aGUgcGF0aCB0\nbyBhIC5qZG8gZmlsZSBsaXN0aW5nIG9uZQogICAgICogb3IgbW9yZSB0eXBl\ncyB0byBlbmhhbmNlLgogICAgICogSWYgdGhlIHR5cGUgYmVpbmcgZW5oYW5j\nZWQgaGFzIG1ldGFkYXRhLCBpdCB3aWxsIGJlIGVuaGFuY2VkIGFzIGEKICAg\nICAqIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3MuIElmIG5vdCwgaXQgd2ls\nbCBiZSBjb25zaWRlcmVkIGEgcGVyc2lzdGVuY2UKICAgICAqIGF3YXJlIGNs\nYXNzLCBhbmQgYWxsIGFjY2VzcyB0byBmaWVsZHMgb2YgcGVyc2lzdGVuY2Ug\nY2FwYWJsZSBjbGFzc2VzCiAgICAgKiB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRo\nZSBhcHByb3ByaWF0ZQlnZXQvc2V0IG1ldGhvZC4gSWYgdGhlIHR5cGUKICAg\nICAqIGV4cGxpY2l0bHkgZGVjbGFyZXMgdGhlIHBlcnNpc3RlbmNlLWNhcGFi\nbGUgaW50ZXJmYWNlLCBpdCB3aWxsCiAgICAgKiBub3QgYmUgZW5oYW5jZWQu\nIFRodXMsIGl0IGlzIHNhZmUgdG8gaW52b2tlIHRoZSBlbmhhbmNlciBvbiBj\nbGFzc2VzCiAgICAgKiB0aGF0IGFyZSBhbHJlYWR5IGVuaGFuY2VkLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdz\nKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgT3B0aW9u\ncyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBhcmdzID0gb3B0cy5z\nZXRGcm9tQ21kTGluZShhcmdzKTsKICAgICAgICBPcGVuSlBBQ29uZmlndXJh\ndGlvbiBjb25mID0gbmV3IE9wZW5KUEFDb25maWd1cmF0aW9uSW1wbCgpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghcnVuKGNvbmYsIGFyZ3Ms\nIG9wdHMpKQogICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKF9s\nb2MuZ2V0KCJlbmhhbmNlLXVzYWdlIikpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSdW4gdGhlIHRvb2wuIFJldHVybnMgZmFsc2UgaWYg\naW52YWxpZCBvcHRpb25zIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIFN0\ncmluZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRzKQogICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG9wdHMuY29udGFpbnNL\nZXkoImhlbHAiKSB8fCBvcHRzLmNvbnRhaW5zS2V5KCItaGVscCIpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEZsYWdzIGZsYWdzID0g\nbmV3IEZsYWdzKCk7CiAgICAgICAgZmxhZ3MuZGlyZWN0b3J5ID0gRmlsZXMu\nZ2V0RmlsZShvcHRzLnJlbW92ZVByb3BlcnR5KCJkaXJlY3RvcnkiLCAiZCIs\nCiAgICAgICAgICAgIG51bGwpLCBudWxsKTsKICAgICAgICBmbGFncy5hZGRE\nZWZhdWx0Q29uc3RydWN0b3IgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0\neQogICAgICAgICAgICAoImFkZERlZmF1bHRDb25zdHJ1Y3RvciIsICJhZGMi\nLCBmbGFncy5hZGREZWZhdWx0Q29uc3RydWN0b3IpOwogICAgICAgIGZsYWdz\nLnRtcENsYXNzTG9hZGVyID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkK\nICAgICAgICAgICAgKCJ0bXBDbGFzc0xvYWRlciIsICJ0Y2wiLCBmbGFncy50\nbXBDbGFzc0xvYWRlcik7CiAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5\nUmVzdHJpY3Rpb25zID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAg\nICAgICAgICAgKCJlbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMiLCAiZXBy\nIiwKICAgICAgICAgICAgICAgIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3Ry\naWN0aW9ucyk7CgogICAgICAgIENvbmZpZ3VyYXRpb25zLnBvcHVsYXRlQ29u\nZmlndXJhdGlvbihjb25mLCBvcHRzKTsKICAgICAgICByZXR1cm4gcnVuKGNv\nbmYsIGFyZ3MsIGZsYWdzLCBudWxsLCBudWxsLCBudWxsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEVuaGFuY2UgdGhlIGdpdmVuIGNsYXNzZXMuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBydW4oT3BlbkpQQUNvbmZp\nZ3VyYXRpb24gY29uZiwgU3RyaW5nW10gYXJncywKICAgICAgICBGbGFncyBm\nbGFncywgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zLCBCeXRlY29kZVdyaXRl\nciB3cml0ZXIsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxvYWRlciA9PSBu\ndWxsKQogICAgICAgICAgICBsb2FkZXIgPSBjb25mLmdldENsYXNzUmVzb2x2\nZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIo\nUENFbmhhbmNlci5jbGFzcywgbnVsbCk7CiAgICAgICAgaWYgKGZsYWdzLnRt\ncENsYXNzTG9hZGVyKQogICAgICAgICAgICBsb2FkZXIgPSBuZXcgVGVtcG9y\nYXJ5Q2xhc3NMb2FkZXIobG9hZGVyKTsKCiAgICAgICAgaWYgKHJlcG9zID09\nIG51bGwpIHsKICAgICAgICAgICAgcmVwb3MgPSBjb25mLm5ld01ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIHJlcG9zLnNldFNv\ndXJjZU1vZGUoTWV0YURhdGFSZXBvc2l0b3J5Lk1PREVfTUVUQSk7CiAgICAg\nICAgfQoKICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX1RPT0wpOwogICAgICAgIENvbGxlY3Rpb24gY2xh\nc3NlczsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPT0gMCkgewogICAgICAg\nICAgICBsb2cuaW5mbyhfbG9jLmdldCgicnVubmluZy1hbGwtY2xhc3NlcyIp\nKTsKICAgICAgICAgICAgY2xhc3NlcyA9IHJlcG9zLmxvYWRQZXJzaXN0ZW50\nVHlwZXModHJ1ZSwgbG9hZGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBDbGFzc0FyZ1BhcnNlciBjYXAgPSBjb25mLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0\nYUZhY3RvcnkoKS5uZXdDbGFzc0FyZ1BhcnNlcigpOwogICAgICAgICAgICBj\nYXAuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAgICAgY2xhc3Nl\ncyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNsYXNz\nZXMuYWRkQWxsKEFycmF5cy5hc0xpc3QoY2FwLnBhcnNlVHlwZXMoYXJnc1tp\nXSkpKTsKICAgICAgICB9CgogICAgICAgIFByb2plY3QgcHJvamVjdCA9IG5l\ndyBQcm9qZWN0KCk7CiAgICAgICAgQkNDbGFzcyBiYzsKICAgICAgICBQQ0Vu\naGFuY2VyIGVuaGFuY2VyOwogICAgICAgIGludCBzdGF0dXM7CiAgICAgICAg\nQ2xhc3MgY2xzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2xhc3Nl\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBj\nbHMgPSAoQ2xhc3MpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGxvZy5pbmZv\nKF9sb2MuZ2V0KCJlbmhhbmNlLXJ1bm5pbmciLCBjbHMpKTsKCiAgICAgICAg\nICAgIGJjID0gcHJvamVjdC5sb2FkQ2xhc3MoY2xzKTsKICAgICAgICAgICAg\nZW5oYW5jZXIgPSBuZXcgUENFbmhhbmNlcihjb25mLCBiYywgcmVwb3MpOwog\nICAgICAgICAgICBpZiAod3JpdGVyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBlbmhhbmNlci5zZXRCeXRlY29kZVdyaXRlcih3cml0ZXIpOwogICAgICAg\nICAgICBlbmhhbmNlci5zZXREaXJlY3RvcnkoZmxhZ3MuZGlyZWN0b3J5KTsK\nICAgICAgICAgICAgZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9y\nKGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIHN0\nYXR1cyA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAoc3RhdHVz\nID09IEVOSEFOQ0VfTk9ORSkKICAgICAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJlbmhhbmNlLW5vcnVuIikpOwogICAgICAgICAgICBlbHNlIGlm\nIChzdGF0dXMgPT0gRU5IQU5DRV9JTlRFUkZBQ0UpCiAgICAgICAgICAgICAg\nICBsb2cuaW5mbyhfbG9jLmdldCgiZW5oYW5jZS1pbnRlcmZhY2UiKSk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0FXQVJFKSB7\nCiAgICAgICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgiZW5oYW5jZS1h\nd2FyZSIpKTsKICAgICAgICAgICAgICAgIGVuaGFuY2VyLnJlY29yZCgpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZW5oYW5jZXIu\ncmVjb3JkKCk7CiAgICAgICAgICAgICAgICBpZiAoKHN0YXR1cyAmIEVOSEFO\nQ0VfT0lEKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZy5p\nc0luZm9FbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbiBvaWRzID0gZW5oYW5jZXIuZ2V0T2JqZWN0SWRCeXRlY29kZSgp\nOwogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIG9pZGl0ciA9IG9pZHMuaXRlcmF0b3IoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG9pZGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCgoQkNDbGFz\ncykgb2lkaXRyLm5leHQoKSkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChvaWRpdHIuaGFzTmV4dCgpKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoImVuaGFuY2UtcnVubmluZy1vaWRzIiwgYnVm\nKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHByb2plY3QuY2xlYXIoKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSdW4gZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xh\nc3MgRmxhZ3MgewoKICAgICAgICBwdWJsaWMgRmlsZSBkaXJlY3RvcnkgPSBu\ndWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZERlZmF1bHRDb25zdHJ1\nY3RvciA9IHRydWU7CiAgICAgICAgcHVibGljIGJvb2xlYW4gdG1wQ2xhc3NM\nb2FkZXIgPSB0cnVlOwoJCXB1YmxpYyBib29sZWFuIGVuZm9yY2VQcm9wZXJ0\neVJlc3RyaWN0aW9ucyA9IGZhbHNlOwoJfQoKCS8qKgogCSAqIFBsdWdpbiBp\nbnRlcmZhY2UgZm9yIGFkZGl0aW9uYWwgZW5oYW5jZW1lbnQuCgkgKi8KCXB1\nYmxpYyBzdGF0aWMgaW50ZXJmYWNlIEF1eGlsaWFyeUVuaGFuY2VyCgl7CgkJ\ncHVibGljIHZvaWQgcnVuIChCQ0NsYXNzIGJjLCBDbGFzc01ldGFEYXRhIG1l\ndGEpOwoJCXB1YmxpYyBib29sZWFuIHNraXBFbmhhbmNlKEJDTWV0aG9kIG0p\nOwoJfQp9Cg==\n","encoding":"base64"}

