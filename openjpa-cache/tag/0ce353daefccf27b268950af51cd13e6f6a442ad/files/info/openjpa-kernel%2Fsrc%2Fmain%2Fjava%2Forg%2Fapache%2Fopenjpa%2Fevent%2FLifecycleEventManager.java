{"sha":"b8c8268710cae215b6afab7674038678b3643c14","node_id":"MDQ6QmxvYjIwNjM2NDpiOGM4MjY4NzEwY2FlMjE1YjZhZmFiNzY3NDAzODY3OGIzNjQzYzE0","size":23613,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b8c8268710cae215b6afab7674038678b3643c14","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5ldmVudDsKCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5NZXRhRGF0YURlZmF1bHRzOwoKLyoqCiAqIE1hbmFnZXIgdGhh\ndCBjYW4gYmUgdXNlZCB0byB0cmFjayBhbmQgbm90aWZ5IGxpc3RlbmVycyBv\nbiBsaWZlY3ljbGUgZXZlbnRzLgogKiAgVGhpcyBjbGFzcyBpcyBvcHRpbWl6\nZWQgZm9yIGV2ZW50IGZpcmluZyByYXRoZXIgdGhhbiBmb3IgYWRkaW5nIGFu\nZAogKiByZW1vdmluZyBsaXN0ZW5lcnMsIHdoaWNoIGFyZSBPKG4pIG9wZXJh\ndGlvbnMuIFRoaXMgY2xhc3MgYWxzbyBkb2VzIG5vdAogKiBtYWludGFpbiBw\nZXJmZWN0IHNldCBzZW1hbnRpY3MgZm9yIGxpc3RlbmVyczsgaXQgaXMgcG9z\nc2libGUgdG8gd2luZCB1cAogKiBoYXZpbmcgdGhlIHNhbWUgbGlzdGVuZXIg\naW52b2tlZCBtdWx0aXBsZSB0aW1lcyBmb3IgYSBzaW5nbGUgZXZlbnQgaWYg\naXQKICogaXMgYWRkZWQgdG8gdGhpcyBtYW5hZ2VyIG11bHRpcGxlIHRpbWVz\nIHdpdGggZGlmZmVyZW50IGNsYXNzZXMsIG9yIHdpdGgKICogYSBiYXNlIGNs\nYXNzIGFuZCBpdHMgc3ViY2xhc3MuCiAqCiAqIEBhdXRob3IgU3RldmUgS2lt\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBzaW5jZSAwLjMuMwogKiBAbm9q\nYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgTGlmZWN5Y2xlRXZlbnRNYW5hZ2Vy\nCiAgICBpbXBsZW1lbnRzIENhbGxiYWNrTW9kZXMgewoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIEV4Y2VwdGlvbltdIEVNUFRZX0VYQ0VQVElPTlMgPSBu\nZXcgRXhjZXB0aW9uWzBdOwoKICAgIHByaXZhdGUgTWFwIF9jbGFzc0xpc3Rl\nbmVycyA9IG51bGw7IC8vIGNsYXNzIC0+IGxpc3RlbmVyIGxpc3QKICAgIHBy\naXZhdGUgTGlzdGVuZXJMaXN0IF9saXN0ZW5lcnMgPSBudWxsOwogICAgcHJp\ndmF0ZSBMaXN0IF9hZGRMaXN0ZW5lcnMgPSBuZXcgTGlua2VkTGlzdCgpOwog\nICAgcHJpdmF0ZSBMaXN0IF9yZW1MaXN0ZW5lcnMgPSBuZXcgTGlua2VkTGlz\ndCgpOwogICAgcHJpdmF0ZSBMaXN0IF9leGNlcHMgPSBuZXcgTGlua2VkTGlz\ndCgpOwogICAgcHJpdmF0ZSBib29sZWFuIF9maXJpbmcgPSBmYWxzZTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfZmFpbCA9IGZhbHNlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9mYWlsRmFzdCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0byBmYWlsIGFmdGVyIGZpcnN0IGV4Y2VwdGlvbiB3aGVuIGZpcmlu\nZyBldmVudHMgdG8gbGlzdGVuZXJzLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0ZhaWxGYXN0KCkgewogICAgICAgIHJldHVybiBfZmFpbEZhc3Q7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgYWZ0ZXIg\nZmlyc3QgZXhjZXB0aW9uIHdoZW4gZmlyaW5nIGV2ZW50cyB0byBsaXN0ZW5l\ncnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZhaWxGYXN0KGJvb2xl\nYW4gZmFpbEZhc3QpIHsKICAgICAgICBfZmFpbEZhc3QgPSBmYWlsRmFzdDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlZ2lzdGVyIGEgbGlmZWN5Y2xlIGxp\nc3RlbmVyIGZvciB0aGUgZ2l2ZW4gY2xhc3Nlcy4gSWYgdGhlIGNsYXNzZXMK\nICAgICAqIGFycmF5IGlzIG51bGwsIHJlZ2lzdGVyIGZvciBhbGwgY2xhc3Nl\ncy4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGFkZExp\nc3RlbmVyKE9iamVjdCBsaXN0ZW5lciwgQ2xhc3NbXSBjbGFzc2VzKSB7CiAg\nICAgICAgaWYgKGxpc3RlbmVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICBpZiAoY2xhc3NlcyAhPSBudWxsICYmIGNsYXNzZXMubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX2Zp\ncmluZykgewogICAgICAgICAgICBfYWRkTGlzdGVuZXJzLmFkZChsaXN0ZW5l\ncik7CiAgICAgICAgICAgIF9hZGRMaXN0ZW5lcnMuYWRkKGNsYXNzZXMpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoY2xh\nc3NlcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfbGlzdGVuZXJzID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfbGlzdGVuZXJzID0gbmV3IExpc3Rl\nbmVyTGlzdCg1KTsKICAgICAgICAgICAgX2xpc3RlbmVycy5hZGQobGlzdGVu\nZXIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBp\nZiAoX2NsYXNzTGlzdGVuZXJzID09IG51bGwpCiAgICAgICAgICAgIF9jbGFz\nc0xpc3RlbmVycyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgTGlzdGVuZXJM\naXN0IGxpc3RlbmVyczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNs\nYXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbGlzdGVuZXJzID0g\nKExpc3RlbmVyTGlzdCkgX2NsYXNzTGlzdGVuZXJzLmdldChjbGFzc2VzW2ld\nKTsKICAgICAgICAgICAgaWYgKGxpc3RlbmVycyA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBsaXN0ZW5lcnMgPSBuZXcgTGlzdGVuZXJMaXN0KDMpOwog\nICAgICAgICAgICAgICAgX2NsYXNzTGlzdGVuZXJzLnB1dChjbGFzc2VzW2ld\nLCBsaXN0ZW5lcnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpc3Rl\nbmVycy5hZGQobGlzdGVuZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gbGlzdGVuZXIuCiAgICAgKi8KICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCByZW1vdmVMaXN0ZW5lcihPYmpl\nY3QgbGlzdGVuZXIpIHsKICAgICAgICBpZiAoX2ZpcmluZykgewogICAgICAg\nICAgICBfcmVtTGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChfbGlzdGVuZXJzICE9\nIG51bGwgJiYgX2xpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIpKQogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgaWYgKF9jbGFzc0xpc3RlbmVycyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIExpc3RlbmVyTGlzdCBsaXN0ZW5lcnM7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2NsYXNzTGlzdGVuZXJz\nLnZhbHVlcygpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgbGlzdGVuZXJzID0gKExpc3Rl\nbmVyTGlzdCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVy\ncy5yZW1vdmUobGlzdGVuZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlcmUgYXJl\nIGxpc3RlbmVycyBvciBjYWxsYmFja3MgZm9yIHRoZSBnaXZlbiBzb3VyY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGhhc1BlcnNpc3RMaXN0ZW5l\ncnMoT2JqZWN0IHNvdXJjZSwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgcmV0dXJuIGhhc0NhbGxiYWNrcyhzb3VyY2UsIG1ldGEsIExpZmVjeWNs\nZUV2ZW50LkJFRk9SRV9QRVJTSVNUKQogICAgICAgICAgICB8fCBoYXNDYWxs\nYmFja3Moc291cmNlLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9QRVJT\nSVNUKQogICAgICAgICAgICB8fCBoYXNMaXN0ZW5lcnMoc291cmNlLCBtZXRh\nLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9QRVJTSVNUKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZXJlIGFyZSBsaXN0ZW5lcnMg\nb3IgY2FsbGJhY2tzIGZvciB0aGUgZ2l2ZW4gc291cmNlLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNEZWxldGVMaXN0ZW5lcnMoT2JqZWN0IHNv\ndXJjZSwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIGhh\nc0NhbGxiYWNrcyhzb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9S\nRV9ERUxFVEUpCiAgICAgICAgICAgIHx8IGhhc0NhbGxiYWNrcyhzb3VyY2Us\nIG1ldGEsIExpZmVjeWNsZUV2ZW50LkFGVEVSX0RFTEVURSkKICAgICAgICAg\nICAgfHwgaGFzTGlzdGVuZXJzKHNvdXJjZSwgbWV0YSwgTGlmZWN5Y2xlRXZl\nbnQuQUZURVJfREVMRVRFKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB3aGV0aGVyIHRoZXJlIGFyZSBsaXN0ZW5lcnMgb3IgY2FsbGJhY2tzIGZv\nciB0aGUgZ2l2ZW4gc291cmNlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNDbGVhckxpc3RlbmVycyhPYmplY3Qgc291cmNlLCBDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gaGFzQ2FsbGJhY2tzKHNvdXJj\nZSwgbWV0YSwgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFSKQogICAgICAg\nICAgICB8fCBoYXNDYWxsYmFja3Moc291cmNlLCBtZXRhLCBMaWZlY3ljbGVF\ndmVudC5BRlRFUl9DTEVBUikKICAgICAgICAgICAgfHwgaGFzTGlzdGVuZXJz\nKHNvdXJjZSwgbWV0YSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfQ0xFQVIpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlcmUgYXJl\nIGxpc3RlbmVycyBvciBjYWxsYmFja3MgZm9yIHRoZSBnaXZlbiBzb3VyY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGhhc0xvYWRMaXN0ZW5lcnMo\nT2JqZWN0IHNvdXJjZSwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAg\ncmV0dXJuIGhhc0NhbGxiYWNrcyhzb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2\nZW50LkFGVEVSX0xPQUQpCiAgICAgICAgICAgIHx8IGhhc0xpc3RlbmVycyhz\nb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkFGVEVSX0xPQUQpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlcmUgYXJlIGxp\nc3RlbmVycyBvciBjYWxsYmFja3MgZm9yIHRoZSBnaXZlbiBzb3VyY2UuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGhhc1N0b3JlTGlzdGVuZXJzKE9i\namVjdCBzb3VyY2UsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJl\ndHVybiBoYXNDYWxsYmFja3Moc291cmNlLCBtZXRhLCBMaWZlY3ljbGVFdmVu\ndC5CRUZPUkVfU1RPUkUpCiAgICAgICAgICAgIHx8IGhhc0NhbGxiYWNrcyhz\nb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkFGVEVSX1NUT1JFKQogICAg\nICAgICAgICB8fCBoYXNMaXN0ZW5lcnMoc291cmNlLCBtZXRhLCBMaWZlY3lj\nbGVFdmVudC5BRlRFUl9TVE9SRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gd2hldGhlciB0aGVyZSBhcmUgbGlzdGVuZXJzIG9yIGNhbGxiYWNr\ncyBmb3IgdGhlIGdpdmVuIHNvdXJjZS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaGFzRGlydHlMaXN0ZW5lcnMoT2JqZWN0IHNvdXJjZSwgQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIGhhc0NhbGxiYWNrcyhz\nb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ESVJUWSkKICAg\nICAgICAgICAgfHwgaGFzQ2FsbGJhY2tzKHNvdXJjZSwgbWV0YSwgTGlmZWN5\nY2xlRXZlbnQuQUZURVJfRElSVFkpCiAgICAgICAgICAgIHx8IGhhc0NhbGxi\nYWNrcyhzb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ESVJU\nWV9GTFVTSEVEKQogICAgICAgICAgICB8fCBoYXNDYWxsYmFja3Moc291cmNl\nLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJUWV9GTFVTSEVEKQog\nICAgICAgICAgICB8fCBoYXNMaXN0ZW5lcnMoc291cmNlLCBtZXRhLCBMaWZl\nY3ljbGVFdmVudC5BRlRFUl9ESVJUWSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gd2hldGhlciB0aGVyZSBhcmUgbGlzdGVuZXJzIG9yIGNhbGxi\nYWNrcyBmb3IgdGhlIGdpdmVuIHNvdXJjZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gaGFzRGV0YWNoTGlzdGVuZXJzKE9iamVjdCBzb3VyY2UsIENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBoYXNDYWxsYmFj\na3Moc291cmNlLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5CRUZPUkVfREVUQUNI\nKQogICAgICAgICAgICB8fCBoYXNDYWxsYmFja3Moc291cmNlLCBtZXRhLCBM\naWZlY3ljbGVFdmVudC5BRlRFUl9ERVRBQ0gpCiAgICAgICAgICAgIHx8IGhh\nc0xpc3RlbmVycyhzb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9S\nRV9ERVRBQ0gpCiAgICAgICAgICAgIHx8IGhhc0xpc3RlbmVycyhzb3VyY2Us\nIG1ldGEsIExpZmVjeWNsZUV2ZW50LkFGVEVSX0RFVEFDSCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGVyZSBhcmUgbGlzdGVu\nZXJzIG9yIGNhbGxiYWNrcyBmb3IgdGhlIGdpdmVuIHNvdXJjZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaGFzQXR0YWNoTGlzdGVuZXJzKE9iamVj\ndCBzb3VyY2UsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVy\nbiBoYXNDYWxsYmFja3Moc291cmNlLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5C\nRUZPUkVfQVRUQUNIKQogICAgICAgICAgICB8fCBoYXNDYWxsYmFja3Moc291\ncmNlLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9BVFRBQ0gpCiAgICAg\nICAgICAgIHx8IGhhc0xpc3RlbmVycyhzb3VyY2UsIG1ldGEsIExpZmVjeWNs\nZUV2ZW50LkJFRk9SRV9BVFRBQ0gpCiAgICAgICAgICAgIHx8IGhhc0xpc3Rl\nbmVycyhzb3VyY2UsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkFGVEVSX0FUVEFD\nSCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBhbnkg\nY2FsbGJhY2tzIGFyZSByZWdpc3RlcmVkIGZvciB0aGUgZ2l2ZW4gc291cmNl\nIGFuZAogICAgICogZXZlbnQgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGhhc0NhbGxiYWNrcyhPYmplY3Qgc291cmNlLCBDbGFzc01ldGFE\nYXRhIG1ldGEsIGludCB0eXBlKSB7CiAgICAgICAgTGlmZWN5Y2xlQ2FsbGJh\nY2tzW10gY2FsbGJhY2tzID0gbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0YSgp\nLgogICAgICAgICAgICBnZXRDYWxsYmFja3ModHlwZSk7CiAgICAgICAgaWYg\nKGNhbGxiYWNrcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoY2FsbGJhY2tzW2ldLmhhc0Nh\nbGxiYWNrKHNvdXJjZSwgdHlwZSkpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiBhbnkgbGlzdGVuZXJzIGFyZSByZWdpc3Rl\ncmVkIGZvciB0aGUgZ2l2ZW4gc291cmNlIGFuZAogICAgICogZXZlbnQgdHlw\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgYm9vbGVhbiBo\nYXNMaXN0ZW5lcnMoT2JqZWN0IHNvdXJjZSwKICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEsIGludCB0eXBlKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0TGlm\nZWN5Y2xlTWV0YURhdGEoKS5nZXRJZ25vcmVTeXN0ZW1MaXN0ZW5lcnMoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChmaXJlRXZl\nbnQobnVsbCwgc291cmNlLCBudWxsLCB0eXBlLCBfbGlzdGVuZXJzLCB0cnVl\nLCBudWxsKSAKICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBMaXN0ZW5lckxpc3Qgc3lzdGVt\nID0gbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0U3lzdGVtTGlzdGVuZXJzKCk7\nCiAgICAgICAgaWYgKCFzeXN0ZW0uaXNFbXB0eSgpICYmIGZpcmVFdmVudChu\ndWxsLCBzb3VyY2UsIG51bGwsIHR5cGUsIHN5c3RlbSwKICAgICAgICAgICAg\ndHJ1ZSwgbnVsbCkgPT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICBpZiAoX2NsYXNzTGlzdGVuZXJzICE9IG51bGwp\nIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IHNvdXJjZSA9PSBudWxsID8gbWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkgOgogICAgICAgICAgICAgICAgc291cmNl\nLmdldENsYXNzKCk7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAg\nIGlmIChmaXJlRXZlbnQobnVsbCwgc291cmNlLCBudWxsLCB0eXBlLCAoTGlz\ndGVuZXJMaXN0KQogICAgICAgICAgICAgICAgICAgIF9jbGFzc0xpc3RlbmVy\ncy5nZXQoYyksIHRydWUsIG51bGwpID09IEJvb2xlYW4uVFJVRSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIGMg\nPSBjLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgfSB3aGlsZSAoYyAh\nPSBudWxsICYmIGMgIT0gT2JqZWN0LmNsYXNzKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBs\naWZlY3ljbGUgZXZlbnQgdG8gYWxsIHJlZ2lzdGVyZWQgbGlzdGVuZXJzIHdp\ndGhvdXQgYW4gYXJndW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyBFeGNlcHRp\nb25bXSBmaXJlRXZlbnQoT2JqZWN0IHNvdXJjZSwKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEsIGludCB0eXBlKSB7CiAgICAgICAgcmV0dXJuIGZpcmVF\ndmVudChzb3VyY2UsIG51bGwsIG1ldGEsIHR5cGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogRmlyZSBsaWZlY3ljbGUgZXZlbnQgdG8gYWxsIHJlZ2lzdGVy\nZWQgbGlzdGVuZXJzLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVk\nIEV4Y2VwdGlvbltdIGZpcmVFdmVudChPYmplY3Qgc291cmNlLCBPYmplY3Qg\ncmVsYXRlZCwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEsIGludCB0eXBl\nKSB7CiAgICAgICAgYm9vbGVhbiByZWVudHJhbnQgPSBfZmlyaW5nOwogICAg\nICAgIF9maXJpbmcgPSB0cnVlOwogICAgICAgIExpc3QgZXhjZXB0aW9ucyA9\nIChyZWVudHJhbnQpID8gbmV3IExpbmtlZExpc3QoKSA6IF9leGNlcHM7CiAg\nICAgICAgTWV0YURhdGFEZWZhdWx0cyBkZWYgPSBtZXRhLmdldFJlcG9zaXRv\ncnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAgICAgICAgZ2V0RGVm\nYXVsdHMoKTsKCiAgICAgICAgYm9vbGVhbiBjYWxsYmFja3MgPSBkZWYuZ2V0\nQ2FsbGJhY2tzQmVmb3JlTGlzdGVuZXJzKHR5cGUpOwogICAgICAgIGlmIChj\nYWxsYmFja3MpCiAgICAgICAgICAgIG1ha2VDYWxsYmFja3Moc291cmNlLCBy\nZWxhdGVkLCBtZXRhLCB0eXBlLCBleGNlcHRpb25zKTsKCiAgICAgICAgTGlm\nZWN5Y2xlRXZlbnQgZXYgPSAoTGlmZWN5Y2xlRXZlbnQpIGZpcmVFdmVudChu\ndWxsLCBzb3VyY2UsIHJlbGF0ZWQsCiAgICAgICAgICAgIHR5cGUsIF9saXN0\nZW5lcnMsIGZhbHNlLCBleGNlcHRpb25zKTsKCiAgICAgICAgaWYgKF9jbGFz\nc0xpc3RlbmVycyAhPSBudWxsKSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBz\nb3VyY2UgPT0gbnVsbCA/IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpIDoKICAg\nICAgICAgICAgICAgIHNvdXJjZS5nZXRDbGFzcygpOwogICAgICAgICAgICBk\nbyB7CiAgICAgICAgICAgICAgICBldiA9IChMaWZlY3ljbGVFdmVudCkgZmly\nZUV2ZW50KGV2LCBzb3VyY2UsIHJlbGF0ZWQsIHR5cGUsCiAgICAgICAgICAg\nICAgICAgICAgKExpc3RlbmVyTGlzdCkgX2NsYXNzTGlzdGVuZXJzLmdldChj\nKSwgZmFsc2UsIGV4Y2VwdGlvbnMpOwogICAgICAgICAgICAgICAgYyA9IGMu\nZ2V0U3VwZXJjbGFzcygpOwogICAgICAgICAgICB9IHdoaWxlIChjICE9IG51\nbGwgJiYgYyAhPSBPYmplY3QuY2xhc3MpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gbWFrZSBzeXN0ZW0gbGlzdGVuZXJzCiAgICAgICAgaWYgKCFtZXRhLmdl\ndExpZmVjeWNsZU1ldGFEYXRhKCkuZ2V0SWdub3JlU3lzdGVtTGlzdGVuZXJz\nKCkpIHsKICAgICAgICAgICAgTGlzdGVuZXJMaXN0IHN5c3RlbSA9IG1ldGEu\nZ2V0UmVwb3NpdG9yeSgpLmdldFN5c3RlbUxpc3RlbmVycygpOwogICAgICAg\nICAgICBmaXJlRXZlbnQoZXYsIHNvdXJjZSwgcmVsYXRlZCwgdHlwZSwgc3lz\ndGVtLCBmYWxzZSwgZXhjZXB0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICBp\nZiAoIWNhbGxiYWNrcykKICAgICAgICAgICAgbWFrZUNhbGxiYWNrcyhzb3Vy\nY2UsIHJlbGF0ZWQsIG1ldGEsIHR5cGUsIGV4Y2VwdGlvbnMpOwoKICAgICAg\nICAvLyBjcmVhdGUgcmV0dXJuIGFycmF5IGJlZm9yZSBjbGVhcmluZyBleGNl\ncHRpb25zCiAgICAgICAgRXhjZXB0aW9uW10gcmV0OwogICAgICAgIGlmIChl\neGNlcHRpb25zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0ID0gRU1QVFlf\nRVhDRVBUSU9OUzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldCA9IChF\neGNlcHRpb25bXSkgZXhjZXB0aW9ucy50b0FycmF5CiAgICAgICAgICAgICAg\nICAobmV3IEV4Y2VwdGlvbltleGNlcHRpb25zLnNpemUoKV0pOwoKICAgICAg\nICAvLyBpZiB0aGlzIHdhc24ndCBhIHJlZW50cmFudCBjYWxsLCBjYXRjaCB1\ncCB3aXRoIGNhbGxzIHRvIGFkZAogICAgICAgIC8vIGFuZCByZW1vdmUgbGlz\ndGVuZXJzIG1hZGUgd2hpbGUgZmlyaW5nCiAgICAgICAgaWYgKCFyZWVudHJh\nbnQpIHsKICAgICAgICAgICAgX2ZpcmluZyA9IGZhbHNlOwogICAgICAgICAg\nICBfZmFpbCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoIV9hZGRMaXN0ZW5l\ncnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfYWRkTGlzdGVuZXJzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgICAgIGFkZExpc3RlbmVyKGl0ci5uZXh0KCks\nIChDbGFzc1tdKSBpdHIubmV4dCgpKTsKICAgICAgICAgICAgaWYgKCFfcmVt\nTGlzdGVuZXJzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX3JlbUxpc3RlbmVycy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICByZW1vdmVMaXN0ZW5lcihp\ndHIubmV4dCgpKTsKICAgICAgICAgICAgX2FkZExpc3RlbmVycy5jbGVhcigp\nOwogICAgICAgICAgICBfcmVtTGlzdGVuZXJzLmNsZWFyKCk7CiAgICAgICAg\nICAgIF9leGNlcHMuY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHJldDsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgY2FsbGJhY2tzLCBy\nZWNvcmRpbmcgYW55IGV4Y2VwdGlvbnMgaW4gdGhlIGdpdmVuIGNvbGxlY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBtYWtlQ2FsbGJhY2tzKE9i\namVjdCBzb3VyY2UsIE9iamVjdCByZWxhdGVkLAogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSwgaW50IHR5cGUsIENvbGxlY3Rpb24gZXhjZXB0aW9ucykg\newogICAgICAgIC8vIG1ha2UgbGlmZWN5Y2xlIGNhbGxiYWNrcwogICAgICAg\nIExpZmVjeWNsZUNhbGxiYWNrc1tdIGNhbGxiYWNrcyA9IG1ldGEuZ2V0TGlm\nZWN5Y2xlTWV0YURhdGEoKS4KICAgICAgICAgICAgZ2V0Q2FsbGJhY2tzKHR5\ncGUpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyAhX2ZhaWwgJiYgaSA8IGNh\nbGxiYWNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgY2FsbGJhY2tzW2ldLm1ha2VDYWxsYmFjayhzb3VyY2Us\nIHJlbGF0ZWQsIHR5cGUpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgZXhjZXB0aW9ucy5hZGQoZSk7CiAg\nICAgICAgICAgICAgICBpZiAoX2ZhaWxGYXN0KQogICAgICAgICAgICAgICAg\nICAgIF9mYWlsID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEZpcmUgYW4gZXZlbnQgd2l0aCB0aGUgZ2l2\nZW4gc291cmNlIGFuZCB0eXBlIHRvIHRoZSBnaXZlbiBsaXN0IG9mCiAgICAg\nKiBsaXN0ZW5lcnMuIFRoZSBldmVudCBtYXkgaGF2ZSBhbHJlYWR5IGJlZW4g\nY29uc3RydWN0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGZpcmVF\ndmVudChMaWZlY3ljbGVFdmVudCBldiwgT2JqZWN0IHNvdXJjZSwgT2JqZWN0\nIHJlbCwKICAgICAgICBpbnQgdHlwZSwgTGlzdGVuZXJMaXN0IGxpc3RlbmVy\ncywgYm9vbGVhbiBtb2NrLCBMaXN0IGV4Y2VwdGlvbnMpIHsKICAgICAgICBp\nZiAobGlzdGVuZXJzID09IG51bGwgfHwgIWxpc3RlbmVycy5oYXNMaXN0ZW5l\ncnModHlwZSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBP\nYmplY3QgbGlzdGVuZXI7CiAgICAgICAgYm9vbGVhbiByZXNwb25kczsKICAg\nICAgICBmb3IgKGludCBpID0gMCwgc2l6ZSA9IGxpc3RlbmVycy5zaXplKCk7\nICFfZmFpbCAmJiBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIGxpc3Rl\nbmVyID0gbGlzdGVuZXJzLmdldChpKTsKICAgICAgICAgICAgaWYgKHNpemUg\nPT0gMSkKICAgICAgICAgICAgICAgIHJlc3BvbmRzID0gdHJ1ZTsKICAgICAg\nICAgICAgZWxzZSBpZiAobGlzdGVuZXIgaW5zdGFuY2VvZiBMaXN0ZW5lckFk\nYXB0ZXIpIHsKICAgICAgICAgICAgICAgIHJlc3BvbmRzID0gKChMaXN0ZW5l\nckFkYXB0ZXIpIGxpc3RlbmVyKS5yZXNwb25kc1RvKHR5cGUpOwogICAgICAg\nICAgICAgICAgaWYgKCFyZXNwb25kcykKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBy\nZXNwb25kcyA9IGZhbHNlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNh\nc2UgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFSOgogICAgICAgICAgICAg\nICAgICAgIGNhc2UgTGlmZWN5Y2xlRXZlbnQuQUZURVJfQ0xFQVI6CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25kcyB8fCBsaXN0ZW5lciBp\nbnN0YW5jZW9mIENsZWFyTGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChtb2NrKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoZXYgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBldiA9IG5ldyBMaWZlY3ljbGVFdmVudChzb3VyY2Us\nIHR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUg\nPT0gTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFSKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICgoQ2xlYXJMaXN0ZW5lcikgbGlzdGVuZXIp\nLmJlZm9yZUNsZWFyKGV2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKENsZWFy\nTGlzdGVuZXIpIGxpc3RlbmVyKS5hZnRlckNsZWFyKGV2KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICBjYXNlIExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9QRVJTSVNUOgogICAgICAgICAgICAgICAgICAgIGNhc2UgTGlmZWN5\nY2xlRXZlbnQuQUZURVJfUEVSU0lTVDoKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHJlc3BvbmRzIHx8IGxpc3RlbmVyIGluc3RhbmNlb2YgUGVyc2lz\ndExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbW9jaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGV2ID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZXYgPSBuZXcgTGlmZWN5Y2xlRXZlbnQoc291cmNlLCB0eXBlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IExpZmVjeWNsZUV2\nZW50LkJFRk9SRV9QRVJTSVNUKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICgoUGVyc2lzdExpc3RlbmVyKSBsaXN0ZW5lcikuYmVmb3JlUGVy\nc2lzdChldik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChQZXJzaXN0TGlzdGVu\nZXIpIGxpc3RlbmVyKS5hZnRlclBlcnNpc3QoZXYpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIGNhc2UgTGlmZWN5Y2xlRXZlbnQuQkVGT1JF\nX0RFTEVURToKICAgICAgICAgICAgICAgICAgICBjYXNlIExpZmVjeWNsZUV2\nZW50LkFGVEVSX0RFTEVURToKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHJlc3BvbmRzIHx8IGxpc3RlbmVyIGluc3RhbmNlb2YgRGVsZXRlTGlzdGVu\nZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2NrKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFu\nLlRSVUU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXYgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldiA9IG5l\ndyBMaWZlY3ljbGVFdmVudChzb3VyY2UsIHR5cGUpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gTGlmZWN5Y2xlRXZlbnQuQkVG\nT1JFX0RFTEVURSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAo\nKERlbGV0ZUxpc3RlbmVyKSBsaXN0ZW5lcikuYmVmb3JlRGVsZXRlKGV2KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAoKERlbGV0ZUxpc3RlbmVyKSBsaXN0ZW5l\ncikuYWZ0ZXJEZWxldGUoZXYpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgICAgIGNhc2UgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJUlRZOgogICAg\nICAgICAgICAgICAgICAgIGNhc2UgTGlmZWN5Y2xlRXZlbnQuQUZURVJfRElS\nVFk6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBMaWZlY3ljbGVFdmVudC5C\nRUZPUkVfRElSVFlfRkxVU0hFRDoKICAgICAgICAgICAgICAgICAgICBjYXNl\nIExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZX0ZMVVNIRUQ6CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChyZXNwb25kcyB8fCBsaXN0ZW5lciBpbnN0\nYW5jZW9mIERpcnR5TGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChtb2NrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoZXYgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBldiA9IG5ldyBMaWZlY3ljbGVFdmVudChzb3VyY2UsIHR5\ncGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0eXBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBMaWZl\nY3ljbGVFdmVudC5CRUZPUkVfRElSVFk6CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICgoRGlydHlMaXN0ZW5lcikgbGlzdGVuZXIpLmJl\nZm9yZURpcnR5KGV2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nY2FzZSBMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJUWToKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKChEaXJ0eUxpc3RlbmVyKSBsaXN0\nZW5lcikuYWZ0ZXJEaXJ0eShldik7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNhc2UgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJUlRZX0ZMVVNI\nRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoRGly\ndHlMaXN0ZW5lcikgbGlzdGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuYmVmb3JlRGlydHlGbHVzaGVkKGV2KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBMaWZlY3ljbGVFdmVu\ndC5BRlRFUl9ESVJUWV9GTFVTSEVEOgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAoKERpcnR5TGlzdGVuZXIpIGxpc3RlbmVyKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFmdGVyRGly\ndHlGbHVzaGVkKGV2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBMaWZlY3ljbGVF\ndmVudC5BRlRFUl9MT0FEOgogICAgICAgICAgICAgICAgICAgIGNhc2UgTGlm\nZWN5Y2xlRXZlbnQuQUZURVJfUkVGUkVTSDoKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHJlc3BvbmRzIHx8IGxpc3RlbmVyIGluc3RhbmNlb2YgTG9h\nZExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbW9jaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGV2ID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZXYgPSBuZXcgTGlmZWN5Y2xlRXZlbnQoc291cmNlLCB0eXBlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IExpZmVjeWNsZUV2\nZW50LkFGVEVSX0xPQUQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKChMb2FkTGlzdGVuZXIpIGxpc3RlbmVyKS5hZnRlckxvYWQoZXYpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICgoTG9hZExpc3RlbmVyKSBsaXN0ZW5lciku\nYWZ0ZXJSZWZyZXNoKGV2KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICBjYXNlIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9TVE9SRToKICAgICAg\nICAgICAgICAgICAgICBjYXNlIExpZmVjeWNsZUV2ZW50LkFGVEVSX1NUT1JF\nOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uZHMgfHwgbGlz\ndGVuZXIgaW5zdGFuY2VvZiBTdG9yZUxpc3RlbmVyKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAobW9jaykKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGV2ID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXYgPSBuZXcgTGlmZWN5Y2xlRXZlbnQo\nc291cmNlLCB0eXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nICh0eXBlID09IExpZmVjeWNsZUV2ZW50LkJFRk9SRV9TVE9SRSkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAoKFN0b3JlTGlzdGVuZXIpIGxp\nc3RlbmVyKS5iZWZvcmVTdG9yZShldik7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKChTdG9yZUxpc3RlbmVyKSBsaXN0ZW5lcikuYWZ0ZXJTdG9yZShldik7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBMaWZlY3ljbGVF\ndmVudC5CRUZPUkVfREVUQUNIOgogICAgICAgICAgICAgICAgICAgIGNhc2Ug\nTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVUQUNIOgogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAocmVzcG9uZHMgfHwgbGlzdGVuZXIgaW5zdGFuY2VvZiBE\nZXRhY2hMaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKG1vY2spCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChldiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGV2ID0gbmV3IExpZmVjeWNsZUV2ZW50KHNvdXJjZSwgcmVsLCB0eXBl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IExp\nZmVjeWNsZUV2ZW50LkJFRk9SRV9ERVRBQ0gpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKChEZXRhY2hMaXN0ZW5lcikgbGlzdGVuZXIpLmJl\nZm9yZURldGFjaChldik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChEZXRhY2hM\naXN0ZW5lcikgbGlzdGVuZXIpLmFmdGVyRGV0YWNoKGV2KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgICAgICBjYXNlIExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9BVFRBQ0g6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBMaWZlY3lj\nbGVFdmVudC5BRlRFUl9BVFRBQ0g6CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChyZXNwb25kcyB8fCBsaXN0ZW5lciBpbnN0YW5jZW9mIEF0dGFjaExp\nc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9j\naykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQm9v\nbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYg\nPSBuZXcgTGlmZWN5Y2xlRXZlbnQoc291cmNlLCByZWwsIHR5cGUpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gTGlmZWN5Y2xl\nRXZlbnQuQkVGT1JFX0FUVEFDSCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAoKEF0dGFjaExpc3RlbmVyKSBsaXN0ZW5lcikuYmVmb3JlQXR0\nYWNoKGV2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKEF0dGFjaExpc3RlbmVy\nKSBsaXN0ZW5lcikuYWZ0ZXJBdHRhY2goZXYpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgZXhjZXB0aW9ucy5h\nZGQoZSk7CiAgICAgICAgICAgICAgICBpZiAoX2ZhaWxGYXN0KQogICAgICAg\nICAgICAgICAgICAgIF9mYWlsID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZXY7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnRlcmZhY2UgdGhhdCBmYWNhZGVzIHRvIG90aGVyIGxpZmVjeWNsZSBs\naXN0ZW5lciBpbnRlcmZhY2VzIGNhbgogICAgICogaW1wbGVtZW50IHRvIGNo\nb29zZSB3aGljaCBldmVudHMgdG8gcmVzcG9uZCB0byBiYXNlZCBvbiB0aGVp\nciBkZWxlZ2F0ZS4KICAgICAqIFRoaXMgaXMgbW9yZSBlZmZpY2llbnQgdGhh\nbiByZWdpc3RlcmluZyBhcyBhIGxpc3RlbmVyIGZvciBhbGwgZXZlbnRzCiAg\nICAgKiBidXQgb25seSByZXNwb25kaW5nIHRvIHNvbWUuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIExpc3RlbmVyQWRhcHRlciB7Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMgaW5z\ndGFuY2UgcmVzcG9uZHMgdG8gdGhlIGdpdmVuIGV2ZW50IHR5cGUgZnJvbQog\nICAgICAgICAqIHtAbGluayBMaWZlY3ljbGVFdmVudH0uCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVzcG9uZHNUbyhpbnQgZXZlbnRU\neXBlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dGVuZGVkIGxpc3QgdGhh\ndCB0cmFja3Mgd2hhdCBldmVudCB0eXBlcyBpdHMgZWxlbWVudHMgY2FyZSBh\nYm91dC4KICAgICAqIE1haW50YWlucyBzZXQgc2VtYW50aWNzIGFzIHdlbGwu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTGlzdGVuZXJMaXN0\nCiAgICAgICAgZXh0ZW5kcyBBcnJheUxpc3QgewoKICAgICAgICBwcml2YXRl\nIGludCBfdHlwZXMgPSAwOwoKICAgICAgICBwdWJsaWMgTGlzdGVuZXJMaXN0\nKGludCBzaXplKSB7CiAgICAgICAgICAgIHN1cGVyKHNpemUpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIExpc3RlbmVyTGlzdChMaXN0ZW5lckxpc3Qg\nY29weSkgewogICAgICAgICAgICBzdXBlcihjb3B5KTsKICAgICAgICAgICAg\nX3R5cGVzID0gY29weS5fdHlwZXM7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBoYXNMaXN0ZW5lcnMoaW50IHR5cGUpIHsKICAgICAgICAg\nICAgcmV0dXJuIChfdHlwZXMgJiAoMiA8PCB0eXBlKSkgPiAwOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkKE9iamVjdCBsaXN0ZW5l\ncikgewogICAgICAgICAgICBpZiAoY29udGFpbnMobGlzdGVuZXIpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBzdXBlci5h\nZGQobGlzdGVuZXIpOwogICAgICAgICAgICBfdHlwZXMgfD0gZ2V0RXZlbnRU\neXBlcyhsaXN0ZW5lcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBs\naXN0ZW5lcikgewogICAgICAgICAgICBpZiAoIXN1cGVyLnJlbW92ZShsaXN0\nZW5lcikpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nICAgICAvLyByZWNvbXB1dGUgdHlwZXMgbWFzawogICAgICAgICAgICBfdHlw\nZXMgPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNpemUo\nKTsgaSsrKQogICAgICAgICAgICAgICAgX3R5cGVzIHw9IGdldEV2ZW50VHlw\nZXMoZ2V0KGkpKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBtYXNrIG9mIHRo\nZSBldmVudCB0eXBlcyB0aGUgZ2l2ZW4gbGlzdGVuZXIgcHJvY2Vzc2VzLgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgc3RhdGljIGludCBnZXRFdmVu\ndFR5cGVzKE9iamVjdCBsaXN0ZW5lcikgewogICAgICAgICAgICBpbnQgdHlw\nZXMgPSAwOwogICAgICAgICAgICBpZiAobGlzdGVuZXIgaW5zdGFuY2VvZiBM\naXN0ZW5lckFkYXB0ZXIpIHsKICAgICAgICAgICAgICAgIExpc3RlbmVyQWRh\ncHRlciBhZGFwdGVyID0gKExpc3RlbmVyQWRhcHRlcikgbGlzdGVuZXI7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IExpZmVjeWNsZUV2\nZW50LkFMTF9FVkVOVFMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAg\nICAgaWYgKGFkYXB0ZXIucmVzcG9uZHNUbyhMaWZlY3ljbGVFdmVudC5BTExf\nRVZFTlRTW2ldKSkKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXMgfD0g\nMiA8PCBMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRTW2ldOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHR5cGVzOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAobGlzdGVuZXIgaW5zdGFuY2VvZiBQZXJzaXN0TGlzdGVuZXIpCiAg\nICAgICAgICAgICAgICB0eXBlcyB8PSAyIDw8IExpZmVjeWNsZUV2ZW50LkFG\nVEVSX1BFUlNJU1Q7CiAgICAgICAgICAgIGlmIChsaXN0ZW5lciBpbnN0YW5j\nZW9mIENsZWFyTGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIHR5cGVzIHw9\nIDIgPDwgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFSOwogICAgICAgICAg\nICAgICAgdHlwZXMgfD0gMiA8PCBMaWZlY3ljbGVFdmVudC5BRlRFUl9DTEVB\nUjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGlzdGVuZXIgaW5z\ndGFuY2VvZiBEZWxldGVMaXN0ZW5lcikgewogICAgICAgICAgICAgICAgdHlw\nZXMgfD0gMiA8PCBMaWZlY3ljbGVFdmVudC5CRUZPUkVfREVMRVRFOwogICAg\nICAgICAgICAgICAgdHlwZXMgfD0gMiA8PCBMaWZlY3ljbGVFdmVudC5BRlRF\nUl9ERUxFVEU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpc3Rl\nbmVyIGluc3RhbmNlb2YgRGlydHlMaXN0ZW5lcikgewogICAgICAgICAgICAg\nICAgdHlwZXMgfD0gMiA8PCBMaWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFk7\nCiAgICAgICAgICAgICAgICB0eXBlcyB8PSAyIDw8IExpZmVjeWNsZUV2ZW50\nLkFGVEVSX0RJUlRZOwogICAgICAgICAgICAgICAgdHlwZXMgfD0gMiA8PCBM\naWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFlfRkxVU0hFRDsKICAgICAgICAg\nICAgICAgIHR5cGVzIHw9IDIgPDwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfRElS\nVFlfRkxVU0hFRDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGlz\ndGVuZXIgaW5zdGFuY2VvZiBMb2FkTGlzdGVuZXIpCiAgICAgICAgICAgICAg\nICB0eXBlcyB8PSAyIDw8IExpZmVjeWNsZUV2ZW50LkFGVEVSX0xPQUQ7CiAg\nICAgICAgICAgIGlmIChsaXN0ZW5lciBpbnN0YW5jZW9mIFN0b3JlTGlzdGVu\nZXIpIHsKICAgICAgICAgICAgICAgIHR5cGVzIHw9IDIgPDwgTGlmZWN5Y2xl\nRXZlbnQuQkVGT1JFX1NUT1JFOwogICAgICAgICAgICAgICAgdHlwZXMgfD0g\nMiA8PCBMaWZlY3ljbGVFdmVudC5BRlRFUl9TVE9SRTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAobGlzdGVuZXIgaW5zdGFuY2VvZiBEZXRhY2hM\naXN0ZW5lcikgewogICAgICAgICAgICAgICAgdHlwZXMgfD0gMiA8PCBMaWZl\nY3ljbGVFdmVudC5CRUZPUkVfREVUQUNIOwogICAgICAgICAgICAgICAgdHlw\nZXMgfD0gMiA8PCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ERVRBQ0g7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpc3RlbmVyIGluc3RhbmNlb2Yg\nQXR0YWNoTGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIHR5cGVzIHw9IDIg\nPDwgTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0FUVEFDSDsKICAgICAgICAgICAg\nICAgIHR5cGVzIHw9IDIgPDwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfQVRUQUNI\nOwoJCQl9CgkJCXJldHVybiB0eXBlczsKCQl9Cgl9Cn0K\n","encoding":"base64"}

