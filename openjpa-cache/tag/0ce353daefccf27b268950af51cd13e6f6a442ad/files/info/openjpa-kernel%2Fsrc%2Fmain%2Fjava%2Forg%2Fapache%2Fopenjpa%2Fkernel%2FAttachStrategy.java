{"sha":"26a9b0986aa55711235e5cdae48064ceecbf650e","node_id":"MDQ6QmxvYjIwNjM2NDoyNmE5YjA5ODZhYTU1NzExMjM1ZTVjZGFlNDgwNjRjZWVjYmY2NTBl","size":20039,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/26a9b0986aa55711235e5cdae48064ceecbf650e","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuQXJy\nYXk7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBq\nYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5n\nLk9iamVjdFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFu\nY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogU3RyYXRl\nZ3kgZm9yIGF0dGFjaGluZyBvYmplY3RzLgogKgogKiBAYXV0aG9yIE1hcmMg\nUHJ1ZCdob21tZWF1eAogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZh\nZG9jCiAqLwphYnN0cmFjdCBjbGFzcyBBdHRhY2hTdHJhdGVneQogICAgZXh0\nZW5kcyBUcmFuc2ZlckZpZWxkTWFuYWdlciB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChBdHRhY2hTdHJhdGVneS5jbGFzcyk7CgogICAgLyoqCiAg\nICAgKiBBdHRhY2guCiAgICAgKgogICAgICogQHBhcmFtIG1hbmFnZXIgbWFu\nYWdlciBob2xkaW5nIGNhY2hlIG9mIGF0dGFjaGVkIGluc3RhbmNlcwogICAg\nICogQHBhcmFtIHRvQXR0YWNoIGRldGFjaGVkIGluc3RhbmNlCiAgICAgKiBA\ncGFyYW0gbWV0YSBtZXRhZGF0YSBmb3IgdGhlIGluc3RhbmNlIGJlaW5nIGF0\ndGFjaGVkCiAgICAgKiBAcGFyYW0gaW50byBpbnN0YW5jZSB3ZSdyZSBhdHRh\nY2hpbmcgaW50bwogICAgICogQHBhcmFtIG93bmVyIHN0YXRlIG1hbmFnZXIg\nZm9yIDxjb2RlPmludG88L2NvZGU+CiAgICAgKiBAcGFyYW0gb3duZXJNZXRh\nIGZpZWxkIHdlIHRyYXZlcnNlZCB0byBmaW5kIDxjb2RlPnRvQXR0YWNoPC9j\nb2RlPgogICAgICogQHBhcmFtIGV4cGxpY2l0IHdoZXRoZXIgdG8gbWFrZSBu\nZXcgaW5zdGFuY2VzIGV4cGxpY2l0bHkgcGVyc2lzdGVudAogICAgICovCiAg\nICBwdWJsaWMgYWJzdHJhY3QgT2JqZWN0IGF0dGFjaChBdHRhY2hNYW5hZ2Vy\nIG1hbmFnZXIsCiAgICAgICAgT2JqZWN0IHRvQXR0YWNoLCBDbGFzc01ldGFE\nYXRhIG1ldGEsIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvLAogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgb3duZXIsIFZhbHVlTWV0YURhdGEgb3duZXJN\nZXRhLCBib29sZWFuIGV4cGxpY2l0KTsKCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgaWRlbnRpdHkgb2YgdGhlIGdpdmVuIGRldGFjaGVkIGluc3RhbmNl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgT2JqZWN0IGdldERl\ndGFjaGVkT2JqZWN0SWQoQXR0YWNoTWFuYWdlciBtYW5hZ2VyLAogICAgICAg\nIE9iamVjdCB0b0F0dGFjaCk7CgogICAgLyoqCiAgICAgKiBQcm92aWRlIHRo\nZSBnaXZlbiBmaWVsZCBpbnRvIHRoaXMgZmllbGQgbWFuYWdlci4KICAgICAq\nLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IHZvaWQgcHJvdmlkZUZpZWxkKE9i\namVjdCB0b0F0dGFjaCwgU3RhdGVNYW5hZ2VySW1wbCBzbSwKICAgICAgICBp\nbnQgZmllbGQpOwoKICAgIC8qKgogICAgICogUmV0dXJuIGEgUE5ldy9QTmV3\nUHJvdmlzaW9uYWwgbWFuYWdlZCBvYmplY3QgZm9yIHRoZSBnaXZlbiBkZXRh\nY2hlZCAKICAgICAqIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RhdGVNYW5hZ2VySW1wbCBwZXJzaXN0KEF0dGFjaE1hbmFnZXIgbWFuYWdl\nciwKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIENsYXNzTWV0YURh\ndGEgbWV0YSwgT2JqZWN0IGFwcElkLCAKICAgICAgICBib29sZWFuIGV4cGxp\nY2l0KSB7CiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIG5ld0luc3RhbmNl\nOwogICAgICAgIGlmICghbWFuYWdlci5nZXRDb3B5TmV3KCkpCiAgICAgICAg\nICAgIG5ld0luc3RhbmNlID0gcGM7CiAgICAgICAgZWxzZSBpZiAoYXBwSWQg\nPT0gbnVsbCkgLy8gZGF0YXN0b3JlIGlkZW50aXR5CiAgICAgICAgICAgIG5l\nd0luc3RhbmNlID0gcGMucGNOZXdJbnN0YW5jZShudWxsLCBmYWxzZSk7CiAg\nICAgICAgZWxzZSAvLyBhcHBsaWNhdGlvbiBpZGVudGl0eTogdXNlIGV4aXN0\naW5nIGZpZWxkcwogICAgICAgICAgICBuZXdJbnN0YW5jZSA9IHBjLnBjTmV3\nSW5zdGFuY2UobnVsbCwgYXBwSWQsIGZhbHNlKTsKCiAgICAgICAgcmV0dXJu\nIChTdGF0ZU1hbmFnZXJJbXBsKSBtYW5hZ2VyLmdldEJyb2tlcigpLnBlcnNp\nc3QKICAgICAgICAgICAgKG5ld0luc3RhbmNlLCBhcHBJZCwgZXhwbGljaXQs\nIG1hbmFnZXIuZ2V0QmVoYXZpb3IoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBdHRhY2ggdGhlIGdpdmVuIGZpZWxkIGludG8gdGhlIGdpdmVuIGluc3Rh\nbmNlLgogICAgICoKICAgICAqIEBwYXJhbSB0b0F0dGFjaCB0aGUgZGV0YWNo\nZWQgcGVyc2lzdGVudCBpbnN0YW5jZQogICAgICogQHBhcmFtIHNtIHN0YXRl\nIG1hbmFnZXIgZm9yIHRoZSBtYW5hZ2VkIGluc3RhbmNlIHdlJ3JlIGNvcHlp\nbmcKICAgICAqIGludG87IDxjb2RlPnRvQXR0YWNoPC9jb2RlPiBhbHNvIHVz\nZXMgdGhpcyBzdGF0ZSBtYW5hZ2VyCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFk\nYXRhIG9uIHRoZSBmaWVsZCB3ZSdyZSBjb3B5aW5nCiAgICAgKiBAcGFyYW0g\nbnVsbExvYWRlZCBpZiBmYWxzZSwgbnVsbHMgd2lsbCBiZSBjb25zaWRlcmVk\nIHVubG9hZGVkIGFuZCB3aWxsCiAgICAgKiBub3QgYmUgYXR0YWNoZWQKICAg\nICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gYXR0YWNoRmllbGQoQXR0YWNo\nTWFuYWdlciBtYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gsCiAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSwgRmllbGRNZXRhRGF0YSBmbWQsIGJvb2xlYW4g\nbnVsbExvYWRlZCkgewogICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkKICAg\nICAgICAgICAgfHwgZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFE\nYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvID0gc20uZ2V0\nUGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgaW50IGkgPSBmbWQuZ2V0\nSW5kZXgoKTsKICAgICAgICBwcm92aWRlRmllbGQodG9BdHRhY2gsIHNtLCBp\nKTsKCiAgICAgICAgaW50IHNldCA9IFN0YXRlTWFuYWdlci5TRVRfQVRUQUNI\nOwogICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nQm9vbGVh\nbkZpZWxkKGludG8sIGksIHNtLmZldGNoQm9vbGVhbkZpZWxkKGkpLAogICAg\nICAgICAgICAgICAgICAgIGZldGNoQm9vbGVhbkZpZWxkKGkpLCBzZXQpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEU6CiAgICAgICAgICAgICAgICBzbS5zZXR0aW5nQnl0ZUZpZWxk\nKGludG8sIGksIHNtLmZldGNoQnl0ZUZpZWxkKGkpLAogICAgICAgICAgICAg\nICAgICAgIGZldGNoQnl0ZUZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAg\nICAgICAgICAgICAgICBzbS5zZXR0aW5nQ2hhckZpZWxkKGludG8sIGksIHNt\nLmZldGNoQ2hhckZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgIGZldGNo\nQ2hhckZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAg\nICAgIHNtLnNldHRpbmdEb3VibGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaERv\ndWJsZUZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgIGZldGNoRG91Ymxl\nRmllbGQoaSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBz\nbS5zZXR0aW5nRmxvYXRGaWVsZChpbnRvLCBpLCBzbS5mZXRjaEZsb2F0Rmll\nbGQoaSksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hGbG9hdEZpZWxkKGkp\nLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdJ\nbnRGaWVsZChpbnRvLCBpLCBzbS5mZXRjaEludEZpZWxkKGkpLAogICAgICAg\nICAgICAgICAgICAgIGZldGNoSW50RmllbGQoaSksIHNldCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9O\nRzoKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdMb25nRmllbGQoaW50bywg\naSwgc20uZmV0Y2hMb25nRmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAg\nZmV0Y2hMb25nRmllbGQoaSksIHNldCk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAg\nICAgICAgICBzbS5zZXR0aW5nU2hvcnRGaWVsZChpbnRvLCBpLCBzbS5mZXRj\naFNob3J0RmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgZmV0Y2hTaG9y\ndEZpZWxkKGkpLCBzZXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAg\nIFN0cmluZyBzdmFsID0gZmV0Y2hTdHJpbmdGaWVsZChpKTsKICAgICAgICAg\nICAgICAgIGlmIChzdmFsID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nc20uc2V0dGluZ1N0cmluZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoU3RyaW5n\nRmllbGQoaSksIHN2YWwsCiAgICAgICAgICAgICAgICAgICAgc2V0KTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTE9DQUxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAgICAgICAg\nIHZhbCA9IGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBp\nZiAodmFsID09IG51bGwgJiYgIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgc20uc2V0dGlu\nZ09iamVjdEZpZWxkKGludG8sIGksIHNtLmZldGNoT2JqZWN0RmllbGQoaSks\nIHZhbCwKICAgICAgICAgICAgICAgICAgICBzZXQpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAg\nICAgICAgT2JqZWN0IGZybXBjID0gZmV0Y2hPYmplY3RGaWVsZChpKTsKICAg\nICAgICAgICAgICAgIGlmIChmcm1wYyA9PSBudWxsICYmICFudWxsTG9hZGVk\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgdG9zbSA9IG1hbmFnZXIuZ2V0\nQnJva2VyKCkuZ2V0U3RhdGVNYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAg\nKHNtLmZldGNoT2JqZWN0RmllbGQoaSkpOwogICAgICAgICAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIHRvcGMgPSAodG9zbSA9PSBudWxsKSA/IG51bGwK\nICAgICAgICAgICAgICAgICAgICA6IHRvc20uZ2V0UGVyc2lzdGVuY2VDYXBh\nYmxlKCk7CiAgICAgICAgICAgICAgICBpZiAoZnJtcGMgIT0gbnVsbCB8fCB0\nb3BjICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZm1kLmdl\ndENhc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9O\nRSkKICAgICAgICAgICAgICAgICAgICAgICAgZnJtcGMgPSBnZXRSZWZlcmVu\nY2UobWFuYWdlciwgZnJtcGMsIHNtLCBmbWQpOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBQZXJzaXN0ZW5j\nZUNhcGFibGUgaW50b3BjID0gdG9wYzsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKCFmbWQuaXNFbWJlZGRlZFBDKCkgJiYgZnJtcGMgIT0gbnVsbCAm\nJiB0b3BjICE9IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYm\nICFPYmplY3RVdGlscy5lcXVhbHModG9wYy5wY0ZldGNoT2JqZWN0SWQoKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmFnZXIuZ2V0RGV0YWNo\nZWRPYmplY3RJZChmcm1wYykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpbnRvcGMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZybXBjID0gbWFuYWdlci5hdHRh\nY2goZnJtcGMsIGludG9wYywgc20sIGZtZCwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZnJtcGMgIT0g\ndG9wYykKICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVj\ndEZpZWxkKGludG8sIGksIHRvcGMsIGZybXBjLCBzZXQpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBDb2xs\nZWN0aW9uIGZybWMgPSAoQ29sbGVjdGlvbikgZmV0Y2hPYmplY3RGaWVsZChp\nKTsKICAgICAgICAgICAgICAgIGlmIChmcm1jID09IG51bGwgJiYgIW51bGxM\nb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICAgICAgQ29sbGVjdGlvbiB0b2MgPSAoQ29sbGVjdGlvbikgc20u\nZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgIGlmICgodG9j\nICE9IG51bGwgJiYgIXRvYy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAg\nICAgfHwgZnJtYyAhPSBudWxsICYmICFmcm1jLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChmcm1jID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBpLCB0\nb2MsIG51bGwsIHNldCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAo\ndG9jID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0\ndGluZ09iamVjdEZpZWxkKGludG8sIGksIG51bGwsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhdHRhY2hDb2xsZWN0aW9uKG1hbmFnZXIsIGZybWMs\nIHNtLCBmbWQpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAodG9jIGluc3RhbmNlb2YgU2V0ICYmIGZybWMgaW5zdGFuY2VvZiBTZXQp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VDb2xsZWN0aW9uKG1h\nbmFnZXIsIGZybWMsIHRvYywgc20sIGZtZCk7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdP\nYmplY3RGaWVsZChpbnRvLCBpLCB0b2MsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZXBsYWNlTGlzdChtYW5hZ2VyLCBmcm1jLCB0b2MsIHNtLCBm\nbWQpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBNYXAgZnJtbSA9IChN\nYXApIGZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAo\nZnJtbSA9PSBudWxsICYmICFudWxsTG9hZGVkKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIE1hcCB0b20gPSAo\nTWFwKSBzbS5mZXRjaE9iamVjdEZpZWxkKGkpOwogICAgICAgICAgICAgICAg\naWYgKCh0b20gIT0gbnVsbCAmJiAhdG9tLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgICAgICB8fCAoZnJtbSAhPSBudWxsICYmICFmcm1tLmlzRW1wdHko\nKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJtbSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nT2JqZWN0RmllbGQo\naW50bywgaSwgdG9tLCBudWxsLCBzZXQpOwogICAgICAgICAgICAgICAgICAg\nIGVsc2UgaWYgKHRvbSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBzbS5zZXR0aW5nT2JqZWN0RmllbGQoaW50bywgaSwgbnVsbCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaE1hcChtYW5hZ2VyLCBmcm1t\nLCBzbSwgZm1kKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VNYXAobWFuYWdlciwgZnJt\nbSwgdG9tLCBzbSwgZm1kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJB\nWToKICAgICAgICAgICAgICAgIE9iamVjdCBmcm1hID0gZmV0Y2hPYmplY3RG\naWVsZChpKTsKICAgICAgICAgICAgICAgIGlmIChmcm1hID09IG51bGwgJiYg\nIW51bGxMb2FkZWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgT2JqZWN0IHRvYSA9IHNtLmZldGNoT2JqZWN0\nRmllbGQoaSk7CiAgICAgICAgICAgICAgICBpZiAoKHRvYSAhPSBudWxsICYm\nIEFycmF5LmdldExlbmd0aCh0b2EpID4gMCkKICAgICAgICAgICAgICAgICAg\nICB8fCAoZnJtYSAhPSBudWxsICYmIEFycmF5LmdldExlbmd0aChmcm1hKSA+\nIDApKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZybWEgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxk\nKGludG8sIGksIHRvYSwgbnVsbCwgc2V0KTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmpl\nY3RGaWVsZChpbnRvLCBpLCB0b2EsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICByZXBsYWNlQXJyYXkobWFuYWdlciwgZnJtYSwgdG9hLCBzbSwgZm1k\nKSwgc2V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGZtZC50b1N0cmluZygpKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBtYW5hZ2VkLCBwb3NzaWJseSBob2xsb3cgcmVmZXJl\nbmNlIGZvciB0aGUgZ2l2ZW4gZGV0YWNoZWQKICAgICAqIG9iamVjdC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBnZXRSZWZlcmVuY2UoQXR0YWNo\nTWFuYWdlciBtYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gsCiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgVmFsdWVNZXRhRGF0YSB2bWQpIHsKICAg\nICAgICBpZiAodG9BdHRhY2ggPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgaWYgKG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRh\nY2hlZCh0b0F0dGFjaCkpIHsKICAgICAgICAgICAgT2JqZWN0IG9pZCA9IG1h\nbmFnZXIuZ2V0RGV0YWNoZWRPYmplY3RJZCh0b0F0dGFjaCk7CiAgICAgICAg\nICAgIGlmIChvaWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBt\nYW5hZ2VyLmdldEJyb2tlcigpLmZpbmQob2lkLCBmYWxzZSwgbnVsbCk7CiAg\nICAgICAgfQogICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJjYW50LWNhc2NhZGUtYXR0YWNoIiwKICAgICAgICAgICAgRXhjZXB0\naW9ucy50b1N0cmluZyh0b0F0dGFjaCksIHZtZCwKICAgICAgICAgICAgRXhj\nZXB0aW9ucy50b1N0cmluZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4K\nICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHRvQXR0YWNoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlcGxhY2UgdGhlIGNvbnRlbnRzIG9mIDxjb2Rl\nPnRvYzwvY29kZT4gd2l0aCB0aGUgY29udGVudHMgb2YKICAgICAqIDxjb2Rl\nPmZybWM8L2NvZGU+LiBOZWl0aGVyIGNvbGxlY3Rpb24gaXMgbnVsbC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VDb2xsZWN0aW9uKEF0dGFj\naE1hbmFnZXIgbWFuYWdlciwgQ29sbGVjdGlvbiBmcm1jLAogICAgICAgIENv\nbGxlY3Rpb24gdG9jLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIC8vIGlmIGZybWMgY29sbGVjdGlvbiBp\ncyBlbXB0eSwganVzdCBjbGVhciB0b2MKICAgICAgICBpZiAoZnJtYy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgaWYgKCF0b2MuaXNFbXB0eSgpKQogICAg\nICAgICAgICAgICAgdG9jLmNsZWFyKCk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBwYyBjb2xsZWN0\naW9uLCBhdHRhY2ggYWxsIGluc3RhbmNlcwogICAgICAgIGJvb2xlYW4gcGMg\nPSBmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKTsKICAgICAg\nICBpZiAocGMpCiAgICAgICAgICAgIGZybWMgPSBhdHRhY2hDb2xsZWN0aW9u\nKG1hbmFnZXIsIGZybWMsIHNtLCBmbWQpOwoKICAgICAgICAvLyByZW1vdmUg\nYWxsIGVsZW1lbnRzIGZyb20gdGhlIHRvYyBjb2xsZWN0aW9uIHRoYXQgYXJl\nbid0IGluIGZybWMKICAgICAgICB0b2MucmV0YWluQWxsKGZybWMpOwoKICAg\nICAgICAvLyBub3cgYWRkIGFsbCBlbGVtZW50cyB0aGF0IGFyZSBpbiBmcm1j\nIGJ1dCBub3QgdG9jCiAgICAgICAgaWYgKGZybWMuc2l6ZSgpICE9IHRvYy5z\naXplKCkpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpID0gZnJtYy5p\ndGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIE9i\namVjdCBvYiA9IGkubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKCF0b2Mu\nY29udGFpbnMob2IpKQogICAgICAgICAgICAgICAgICAgIHRvYy5hZGQob2Ip\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGEgbmV3IGNvbGxlY3Rpb24gd2l0aCB0aGUgYXR0YWNoZWQg\nY29udGVudHMgb2YgdGhlIGdpdmVuIG9uZS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIENvbGxlY3Rpb24gYXR0YWNoQ29sbGVjdGlvbihBdHRhY2hNYW5hZ2Vy\nIG1hbmFnZXIsCiAgICAgICAgQ29sbGVjdGlvbiBvcmlnLCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIENv\nbGxlY3Rpb24gY29sbCA9IGNvcHlDb2xsZWN0aW9uKG1hbmFnZXIsIG9yaWcs\nIGZtZCk7CiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQgPSBmbWQuZ2V0RWxl\nbWVudCgpOwogICAgICAgIGlmICghdm1kLmlzRGVjbGFyZWRUeXBlUEMoKSkK\nICAgICAgICAgICAgcmV0dXJuIGNvbGw7CgogICAgICAgIC8vIHVuZm9ydHVu\nYXRlbHkgd2UgaGF2ZSB0byBjbGVhciB0aGUgb3JpZ2luYWwgYW5kIHJlLWFk\nZAogICAgICAgIGNvbGwuY2xlYXIoKTsKICAgICAgICBPYmplY3QgZWxlbTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9yaWcuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgaWYgKHZtZC5nZXRDYXNj\nYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAg\nICAgICAgICAgICAgICBlbGVtID0gZ2V0UmVmZXJlbmNlKG1hbmFnZXIsIGl0\nci5uZXh0KCksIHNtLCB2bWQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBlbGVtID0gbWFuYWdlci5hdHRhY2goaXRyLm5leHQoKSwgbnVs\nbCwgc20sIHZtZCwgZmFsc2UpOwogICAgICAgICAgICBjb2xsLmFkZChlbGVt\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb3BpZXMgdGhlIGdpdmVuIGNvbGxlY3Rpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgQ29sbGVjdGlvbiBjb3B5Q29sbGVjdGlvbihBdHRh\nY2hNYW5hZ2VyIG1hbmFnZXIsIENvbGxlY3Rpb24gb3JpZywKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIENvbGxlY3Rpb24gY29sbCA9\nIG1hbmFnZXIuZ2V0UHJveHlNYW5hZ2VyKCkuY29weUNvbGxlY3Rpb24ob3Jp\nZyk7CiAgICAgICAgaWYgKGNvbGwgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1jb3B5YWJsZSIs\nIGZtZCkpOwogICAgICAgIHJldHVybiBjb2xsOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyBhbiBhdHRhY2hlZCB2ZXJzaW9uIG9mIHRoZSA8Y29k\nZT5mcm1sPC9jb2RlPgogICAgICogbGlzdCBpZiBpdCBpcyBkaWZmZXJlbnQg\ndGhhbiA8Y29kZT50b2w8L2NvZGU+LiBJZiB0aGUgbGlzdHMKICAgICAqIHdp\nbGwgYmUgaWRlbnRpY2FsLCByZXR1cm5zIDxjb2RlPnRvbDwvY29kZT4uIE5l\naXRoZXIgbGlzdCBpcyBudWxsLgogICAgICovCiAgICBwcml2YXRlIENvbGxl\nY3Rpb24gcmVwbGFjZUxpc3QoQXR0YWNoTWFuYWdlciBtYW5hZ2VyLCBDb2xs\nZWN0aW9uIGZybWwsCiAgICAgICAgQ29sbGVjdGlvbiB0b2wsIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nYm9vbGVhbiBwYyA9IGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQ\nQygpOwogICAgICAgIGlmIChwYykKICAgICAgICAgICAgZnJtbCA9IGF0dGFj\naENvbGxlY3Rpb24obWFuYWdlciwgZnJtbCwgc20sIGZtZCk7CgogICAgICAg\nIC8vIGlmIHRoZSBvbmx5IGRpZmYgYmV0d2VlbiBmcm1sIGFuZCB0b2wgaXMg\nc29tZSBhZGRlZCBlbGVtZW50cyBhdAogICAgICAgIC8vIHRoZSBlbmQsIG1h\na2UgdGhlIGNoYW5nZXMgZGlyZWN0bHkgaW4gdG9sCiAgICAgICAgaWYgKGZy\nbWwuc2l6ZSgpID49IHRvbC5zaXplKCkpIHsKICAgICAgICAgICAgSXRlcmF0\nb3IgZnJtaSA9IGZybWwuaXRlcmF0b3IoKTsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciB0b2kgPSB0b2wuaXRlcmF0b3IoKTsgdG9pLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYW4gaW5jb21wYXRp\nYmlsaXR5LCBqdXN0IHJldHVybiBhIGNvcHkgb2YgZnJtbAogICAgICAgICAg\nICAgICAgLy8gKGl0J3MgYWxyZWFkeSBjb3BpZWQgaWYgd2UgYXR0YWNoZWQg\naXQpCiAgICAgICAgICAgICAgICBpZiAoIWVxdWFscyhmcm1pLm5leHQoKSwg\ndG9pLm5leHQoKSwgcGMpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAo\ncGMpID8gZnJtbCA6IGNvcHlDb2xsZWN0aW9uKG1hbmFnZXIsIGZybWwsIGZt\nZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGp1c3QgYWRkIHRo\nZSBleHRyYSBlbGVtZW50cyBpbiBmcm1sIHRvIHRvbCBhbmQgcmV0dXJuIHRv\nbAogICAgICAgICAgICB3aGlsZSAoZnJtaS5oYXNOZXh0KCkpCiAgICAgICAg\nICAgICAgICB0b2wuYWRkKGZybWkubmV4dCgpKTsKICAgICAgICAgICAgcmV0\ndXJuIHRvbDsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBsaXN0cyBhcmUg\nZGlmZmVyZW50OyBqdXN0IG1ha2Ugc3VyZSBmcm1sIGlzIGNvcGllZCBhbmQg\ncmV0dXJuIGl0CiAgICAgICAgcmV0dXJuIChwYykgPyBmcm1sIDogY29weUNv\nbGxlY3Rpb24obWFuYWdlciwgZnJtbCwgZm1kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlcGxhY2UgdGhlIGNvbnRlbnRzIG9mIDxjb2RlPnRvbTwvY29k\nZT4gd2l0aCB0aGUgY29udGVudHMgb2YKICAgICAqIDxjb2RlPmZybW08L2Nv\nZGU+LiBOZWl0aGVyIG1hcCBpcyBudWxsLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcmVwbGFjZU1hcChBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIE1hcCBm\ncm1tLCBNYXAgdG9tLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZybW0uaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgIGlmICghdG9tLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIHRvbS5jbGVhcigpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgcGMgbWFwLCBhdHRh\nY2ggYWxsIGluc3RhbmNlcwogICAgICAgIGJvb2xlYW4ga2V5UEMgPSBmbWQu\nZ2V0S2V5KCkuaXNEZWNsYXJlZFR5cGVQQygpOwogICAgICAgIGJvb2xlYW4g\ndmFsUEMgPSBmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKTsK\nICAgICAgICBpZiAoa2V5UEMgfHwgdmFsUEMpCiAgICAgICAgICAgIGZybW0g\nPSBhdHRhY2hNYXAobWFuYWdlciwgZnJtbSwgc20sIGZtZCk7CgogICAgICAg\nIC8vIG1ha2Ugc3VyZSBhbGwgdGhlIGtleXMgaW4gdGhlIGZyb20gbWFwIGFy\nZSBpbiB0aGUgdHdvIG1hcCwgYW5kCiAgICAgICAgLy8gdGhhdCB0aGV5IGhh\ndmUgdGhlIHNhbWUgdmFsdWVzCiAgICAgICAgZm9yIChJdGVyYXRvciBpID0g\nZnJtbS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICBNYXAuRW50cnkgZW50cnkgPSAoTWFwLkVudHJ5KSBpLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKCF0b20uY29udGFpbnNLZXkoZW50cnku\nZ2V0S2V5KCkpCiAgICAgICAgICAgICAgICB8fCAhZXF1YWxzKHRvbS5nZXQo\nZW50cnkuZ2V0S2V5KCkpLCBlbnRyeS5nZXRWYWx1ZSgpLCB2YWxQQykpIHsK\nICAgICAgICAgICAgICAgIHRvbS5wdXQoZW50cnkuZ2V0S2V5KCksIGVudHJ5\nLmdldFZhbHVlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyByZW1vdmUgYW55IGtleXMgaW4gdGhlIHRvIG1hcCB0aGF0IGFyZW4n\ndCBpbiB0aGUgZnJvbSBtYXAKICAgICAgICBpZiAodG9tLnNpemUoKSAhPSBm\ncm1tLnNpemUoKSkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB0\nb20ua2V5U2V0KCkuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBpZiAoIShmcm1tLmNvbnRhaW5zS2V5KGkubmV4dCgpKSkp\nCiAgICAgICAgICAgICAgICAgICAgaS5yZW1vdmUoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSBh\nbGwgdGhlIHZhbHVlcyBpbiB0aGUgZ2l2ZW4gbWFwIGFyZSBhdHRhY2hlZC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE1hcCBhdHRhY2hNYXAoQXR0YWNoTWFu\nYWdlciBtYW5hZ2VyLCBNYXAgb3JpZywKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIE1hcCBt\nYXAgPSBtYW5hZ2VyLmdldFByb3h5TWFuYWdlcigpLmNvcHlNYXAob3JpZyk7\nCiAgICAgICAgaWYgKG1hcCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm90LWNvcHlhYmxlIiwgZm1k\nKSk7CgogICAgICAgIFZhbHVlTWV0YURhdGEga2V5bWQgPSBmbWQuZ2V0S2V5\nKCk7CiAgICAgICAgVmFsdWVNZXRhRGF0YSB2YWxtZCA9IGZtZC5nZXRFbGVt\nZW50KCk7CiAgICAgICAgaWYgKCFrZXltZC5pc0RlY2xhcmVkVHlwZVBDKCkg\nJiYgIXZhbG1kLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgcmV0\ndXJuIG1hcDsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSB0byByZXBsYWNlIGtl\neXMsIGp1c3QgY2xlYXIgYW5kIHJlLWFkZDsgb3RoZXJ3aXNlCiAgICAgICAg\nLy8gd2UgY2FuIHVzZSB0aGUgZW50cnkgc2V0IHRvIHJlc2V0IHRoZSB2YWx1\nZXMgb25seQogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICBpZiAo\na2V5bWQuaXNEZWNsYXJlZFR5cGVQQygpKSB7CiAgICAgICAgICAgIG1hcC5j\nbGVhcigpOwogICAgICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb3JpZy5lbnRyeVNldCgpLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRy\neSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBr\nZXkgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIGlmIChrZXlt\nZC5nZXRDYXNjYWRlQXR0YWNoKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX05PTkUpCiAgICAgICAgICAgICAgICAgICAga2V5ID0gZ2V0UmVmZXJlbmNl\nKG1hbmFnZXIsIGtleSwgc20sIGtleW1kKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBrZXkgPSBtYW5hZ2VyLmF0dGFjaChr\nZXksIG51bGwsIHNtLCBrZXltZCwgZmFsc2UpOwogICAgICAgICAgICAgICAg\ndmFsID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmICh2\nYWxtZC5pc0RlY2xhcmVkVHlwZVBDKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAodmFsbWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0YURh\ndGEuQ0FTQ0FERV9OT05FKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwg\nPSBnZXRSZWZlcmVuY2UobWFuYWdlciwgdmFsLCBzbSwgdmFsbWQpOwogICAg\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAg\ndmFsID0gbWFuYWdlci5hdHRhY2godmFsLCBudWxsLCBzbSwgdmFsbWQsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1hcC5w\ndXQoa2V5LCB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgT2JqZWN0IHZhbDsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHZhbG1kLmdldENh\nc2NhZGVBdHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORSkK\nICAgICAgICAgICAgICAgICAgICB2YWwgPSBnZXRSZWZlcmVuY2UobWFuYWdl\nciwgZW50cnkuZ2V0VmFsdWUoKSwgc20sIHZhbG1kKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB2YWwgPSBtYW5hZ2VyLmF0\ndGFjaChlbnRyeS5nZXRWYWx1ZSgpLCBudWxsLCBzbSwgdmFsbWQsIAogICAg\nICAgICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICBl\nbnRyeS5zZXRWYWx1ZSh2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBtYXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIGFuIGF0dGFjaGVkIHZlcnNpb24gb2YgdGhlIDxjb2RlPmZybWE8L2Nv\nZGU+CiAgICAgKiBhcnJheSBpZiBpdCBpcyBkaWZmZXJlbnQgdGhhbiA8Y29k\nZT50b2E8L2NvZGU+LiBJZiB0aGUgYXJyYXlzCiAgICAgKiB3aWxsIGJlIGlk\nZW50aWNhbCwgcmV0dXJucyA8Y29kZT50b2E8L2NvZGU+LgogICAgICovCiAg\nICBwcml2YXRlIE9iamVjdCByZXBsYWNlQXJyYXkoQXR0YWNoTWFuYWdlciBt\nYW5hZ2VyLCBPYmplY3QgZnJtYSwKICAgICAgICBPYmplY3QgdG9hLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIGludCBsZW4gPSBBcnJheS5nZXRMZW5ndGgoZnJtYSk7CiAgICAgICAg\nYm9vbGVhbiBkaWZmID0gdG9hID09IG51bGwgfHwgbGVuICE9IEFycmF5Lmdl\ndExlbmd0aCh0b2EpOwoKICAgICAgICAvLyBwb3B1bGF0ZSBhbiBhcnJheSBj\nb3B5IG9uIHRoZSBpbml0aWFsIGFzc3VtcHRpb24gdGhhdCB0aGUgYXJyYXkK\nICAgICAgICAvLyBpcyBkaXJ0eQogICAgICAgIE9iamVjdCBuZXdhID0gQXJy\nYXkubmV3SW5zdGFuY2UoZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5\ncGUoKSwKICAgICAgICAgICAgbGVuKTsKICAgICAgICBWYWx1ZU1ldGFEYXRh\nIHZtZCA9IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgYm9vbGVhbiBwYyA9\nIHZtZC5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgT2JqZWN0IGVsZW07\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAg\nICAgICAgICBlbGVtID0gQXJyYXkuZ2V0KGZybWEsIGkpOwogICAgICAgICAg\nICBpZiAocGMpIHsKICAgICAgICAgICAgICAgIGlmICh2bWQuZ2V0Q2FzY2Fk\nZUF0dGFjaCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKQogICAg\nICAgICAgICAgICAgICAgIGVsZW0gPSBnZXRSZWZlcmVuY2UobWFuYWdlciwg\nZWxlbSwgc20sIHZtZCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgZWxlbSA9IG1hbmFnZXIuYXR0YWNoKGVsZW0sIG51bGws\nIHNtLCB2bWQsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBk\naWZmID0gZGlmZiB8fCAhZXF1YWxzKGVsZW0sIEFycmF5LmdldCh0b2EsIGkp\nLCBwYyk7CiAgICAgICAgICAgIEFycmF5LnNldChuZXdhLCBpLCBlbGVtKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIChkaWZmKSA/IG5ld2EgOiB0b2E7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2\nZW4gb2JqZWN0cyBhcmUgZXF1YWwuIFBDcyBhcmUgY29tcGFyZWQgZm9yCiAg\nICAgKiBvbiBKVk0gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBhLCBPYmplY3QgYiwgYm9vbGVh\nbiBwYykgewogICAgICAgIGlmIChhID09IGIpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIGlmIChwYyB8fCBhID09IG51bGwgfHwgYiA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJcmV0dXJuIGEuZXF1\nYWxzIChiKTsKCX0KfQo=\n","encoding":"base64"}

