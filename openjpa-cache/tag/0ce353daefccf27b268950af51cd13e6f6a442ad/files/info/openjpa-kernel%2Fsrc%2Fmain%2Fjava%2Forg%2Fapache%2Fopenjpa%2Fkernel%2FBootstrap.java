{"sha":"df07c261aa444dca62d6cb122954e245e93e9698","node_id":"MDQ6QmxvYjIwNjM2NDpkZjA3YzI2MWFhNDQ0ZGNhNjJkNmNiMTIyOTU0ZTI0NWU5M2U5Njk4","size":5822,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/df07c261aa444dca62d6cb122954e245e93e9698","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lk1ldGhvZDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5C\ncm9rZXJGYWN0b3J5VmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmNvbmYuQ29uZmlndXJhdGlvblByb3ZpZGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5jb25mLk1hcENvbmZpZ3VyYXRpb25Qcm92aWRl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Qcm9kdWN0\nRGVyaXZhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PcGVuSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBIZWxwZXIgbWV0aG9k\ncyBmb3IgYWNxdWlyaW5nIHtAbGluayBCcm9rZXJGYWN0b3J5fSBvYmplY3Rz\nCiAqCiAqIEBzaW5jZSAwLjQuMC4wCiAqLwpwdWJsaWMgY2xhc3MgQm9vdHN0\ncmFwIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzc1tdIEZBQ1RP\nUllfQVJHUyA9CiAgICAgICAgbmV3IENsYXNzW117IENvbmZpZ3VyYXRpb25Q\ncm92aWRlci5jbGFzcyB9OwoKICAgIHByaXZhdGUgc3RhdGljIExvY2FsaXpl\nciBzX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKEJvb3RzdHJhcC5jbGFz\ncyk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgZmFjdG9yeSBmb3Ig\ndGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBCcm9rZXJGYWN0b3J5IG5ld0Jyb2tlckZhY3RvcnkoKSB7CiAg\nICAgICAgcmV0dXJuIEJvb3RzdHJhcC5uZXdCcm9rZXJGYWN0b3J5KG51bGws\nIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IGZh\nY3RvcnkgZm9yIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uLiBUaGUgY2xhc3Ns\nb2FkZXIKICAgICAqIHdpbGwgYmUgdXNlZCB0byBsb2FkIHRoZSBmYWN0b3J5\nIGNsYXNzLiBJZiBubyBjbGFzc2xvYWRlciBpcyBnaXZlbiwKICAgICAqIHRo\nZSB0aHJlYWQncyBjb250ZXh0IGNsYXNzbG9hZGVyIGlzIHVzZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgQnJva2VyRmFjdG9yeSBuZXdCcm9rZXJG\nYWN0b3J5KENvbmZpZ3VyYXRpb25Qcm92aWRlciBjb25mLAogICAgICAgIENs\nYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBpbnZva2VGYWN0b3J5KGNvbmYsIGxvYWRlciwgIm5ld0luc3Rh\nbmNlIik7CiAgICAgICAgfSBjYXRjaCAoSW52b2NhdGlvblRhcmdldEV4Y2Vw\ndGlvbiBpdGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxlIGNhdXNlID0gaXRl\nLmdldFRhcmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICBpZiAoY2F1c2Ug\naW5zdGFuY2VvZiBPcGVuSlBBRXhjZXB0aW9uKQogICAgICAgICAgICAgICAg\ndGhyb3cgKE9wZW5KUEFFeGNlcHRpb24pIGNhdXNlOwogICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oc19sb2MuZ2V0KCJuZXctYnJv\na2VyZmFjdG9yeS1leGNlcCIsCiAgICAgICAgICAgICAgICBnZXRGYWN0b3J5\nQ2xhc3NOYW1lKGNvbmYsIGxvYWRlcikpLCBjYXVzZSk7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oc19sb2MuZ2V0KCJiYWQtbmV3LWJyb2tlcmZhY3Rvcnki\nLAogICAgICAgICAgICAgICAgZ2V0RmFjdG9yeUNsYXNzTmFtZShjb25mLCBs\nb2FkZXIpKSwgZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgcG9vbGVkIGZhY3RvcnkgZm9yIHRo\nZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgQnJva2VyRmFjdG9yeSBnZXRCcm9rZXJGYWN0b3J5KCkgewogICAg\nICAgIHJldHVybiBCb290c3RyYXAuZ2V0QnJva2VyRmFjdG9yeShudWxsLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHBvb2xlZCBm\nYWN0b3J5IGZvciB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbi4gVGhlIGNsYXNz\nbG9hZGVyCiAgICAgKiB3aWxsIGJlIHVzZWQgdG8gbG9hZCB0aGUgZmFjdG9y\neSBjbGFzcy4gSWYgbm8gY2xhc3Nsb2FkZXIgaXMgZ2l2ZW4sCiAgICAgKiB0\naGUgdGhyZWFkJ3MgY29udGV4dCBjbGFzc2xvYWRlciBpcyB1c2VkLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIEJyb2tlckZhY3RvcnkgZ2V0QnJva2Vy\nRmFjdG9yeShDb25maWd1cmF0aW9uUHJvdmlkZXIgY29uZiwKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAg\nICByZXR1cm4gaW52b2tlRmFjdG9yeShjb25mLCBsb2FkZXIsICJnZXRJbnN0\nYW5jZSIpOwogICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25UYXJnZXRFeGNl\ncHRpb24gaXRlKSB7CiAgICAgICAgICAgIFRocm93YWJsZSBjYXVzZSA9IGl0\nZS5nZXRUYXJnZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAgaWYgKGNhdXNl\nIGluc3RhbmNlb2YgT3BlbkpQQUV4Y2VwdGlvbikKICAgICAgICAgICAgICAg\nIHRocm93IChPcGVuSlBBRXhjZXB0aW9uKSBjYXVzZTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKHNfbG9jLmdldCgiYnJva2Vy\nZmFjdG9yeS1leGNlcCIsCiAgICAgICAgICAgICAgICBnZXRGYWN0b3J5Q2xh\nc3NOYW1lKGNvbmYsIGxvYWRlcikpLCBjYXVzZSk7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oc19sb2MuZ2V0KCJiYWQtYnJva2VyZmFjdG9yeSIsCiAgICAg\nICAgICAgICAgICBnZXRGYWN0b3J5Q2xhc3NOYW1lKGNvbmYsIGxvYWRlcikp\nLCBlKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgQnJva2VyRmFjdG9yeSBpbnZva2VGYWN0b3J5KENvbmZp\nZ3VyYXRpb25Qcm92aWRlciBjb25mLAogICAgICAgIENsYXNzTG9hZGVyIGxv\nYWRlciwgU3RyaW5nIG1ldGhvZE5hbWUpCiAgICAgICAgdGhyb3dzIEludm9j\nYXRpb25UYXJnZXRFeGNlcHRpb24sIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiwK\nICAgICAgICAgICAgSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGNvbmYgPT0gbnVsbCkKICAgICAgICAgICAgY29uZiA9IG5ldyBNYXBD\nb25maWd1cmF0aW9uUHJvdmlkZXIoKTsKICAgICAgICBQcm9kdWN0RGVyaXZh\ndGlvbnMuYmVmb3JlQ29uZmlndXJhdGlvbkNvbnN0cnVjdChjb25mKTsKCiAg\nICAgICAgQ2xhc3MgY2xzID0gZ2V0RmFjdG9yeUNsYXNzKGNvbmYsIGxvYWRl\ncik7CiAgICAgICAgTWV0aG9kIG1ldGg7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgbWV0aCA9IGNscy5nZXRNZXRob2QobWV0aG9kTmFtZSwgRkFDVE9S\nWV9BUkdTKTsgCiAgICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIG5zbWUpIHsKICAgICAgICAgICAgLy8gaGFuZGxlIGNhc2VzIHdoZXJl\nIHRoZXJlIGlzIGEgbWlzbWF0Y2ggYmV0d2VlbiBsb2FkZXJzIGJ5IGZhbGxp\nbmcKICAgICAgICAgICAgLy8gYmFjayB0byB0aGUgY29uZmlndXJhdGlvbidz\nIGNsYXNzIGxvYWRlciBmb3IgYnJva2VyIHJlc29sdXRpb24KICAgICAgICAg\nICAgY2xzID0gZ2V0RmFjdG9yeUNsYXNzKGNvbmYsIGNvbmYuZ2V0Q2xhc3Mo\nKS5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAgbWV0aCA9IGNscy5n\nZXRNZXRob2QobWV0aG9kTmFtZSwgRkFDVE9SWV9BUkdTKTsgCiAgICAgICAg\nfQoKICAgICAgICByZXR1cm4gKEJyb2tlckZhY3RvcnkpIG1ldGguaW52b2tl\nKG51bGwsIG5ldyBPYmplY3RbXXsgY29uZiB9KTsKICAgIH0KCiAgICBwcml2\nYXRlIHN0YXRpYyBTdHJpbmcgZ2V0RmFjdG9yeUNsYXNzTmFtZShDb25maWd1\ncmF0aW9uUHJvdmlkZXIgY29uZiwKICAgICAgICBDbGFzc0xvYWRlciBsb2Fk\nZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZ2V0RmFj\ndG9yeUNsYXNzKGNvbmYsIGxvYWRlcikuZ2V0TmFtZSgpOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHJldHVybiAiPCIg\nKyBlLnRvU3RyaW5nKCkgKyAiPiI7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSW5zdGFudGlhdGUgdGhlIGZhY3RvcnkgY2xhc3MgZGVzaWdu\nYXRlZCBpbiBwcm9wZXJ0aWVzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBDbGFzcyBnZXRGYWN0b3J5Q2xhc3MoQ29uZmlndXJhdGlvblByb3ZpZGVy\nIGNvbmYsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAg\naWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAgICBsb2FkZXIgPSBUaHJl\nYWQuY3VycmVudFRocmVhZCgpLmdldENvbnRleHRDbGFzc0xvYWRlcigpOwoK\nICAgICAgICBPYmplY3QgY2xzID0gQnJva2VyRmFjdG9yeVZhbHVlLmdldChj\nb25mKTsKICAgICAgICBpZiAoY2xzIGluc3RhbmNlb2YgQ2xhc3MpCiAgICAg\nICAgICAgIHJldHVybiAoQ2xhc3MpIGNsczsKCiAgICAgICAgQnJva2VyRmFj\ndG9yeVZhbHVlIHZhbHVlID0gbmV3IEJyb2tlckZhY3RvcnlWYWx1ZSgpOwog\nICAgICAgIHZhbHVlLnNldFN0cmluZygoU3RyaW5nKSBjbHMpOwogICAgICAg\nIFN0cmluZyBjbHNOYW1lID0gdmFsdWUuZ2V0Q2xhc3NOYW1lKCk7CiAgICAg\nICAgaWYgKGNsc05hbWUgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oc19sb2MuZ2V0KCJuby1icm9rZXJmYWN0b3J5Iiwg\nCiAgICAgICAgICAgICAgICBjb25mLmdldFByb3BlcnRpZXMoKSkpLnNldEZh\ndGFsKHRydWUpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nQ2xhc3MuZm9yTmFtZShjbHNOYW1lLCB0cnVlLCBsb2FkZXIpOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKHNfbG9jLmdldCgiYmFkLWJyb2tlcmZhY3Rvcnkt\nY2xhc3MiLAogICAgICAgICAgICAgICAgY2xzTmFtZSksIGUpLnNldEZhdGFs\nKHRydWUpOwoJCX0KCX0KfQo=\n","encoding":"base64"}

