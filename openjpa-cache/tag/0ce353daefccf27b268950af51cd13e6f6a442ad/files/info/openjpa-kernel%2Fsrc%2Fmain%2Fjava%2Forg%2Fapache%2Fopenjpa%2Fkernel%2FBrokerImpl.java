{"sha":"5b3e13fcf73c3d735d5452998092e12d18d0a9c3","node_id":"MDQ6QmxvYjIwNjM2NDo1YjNlMTNmY2Y3M2MzZDczNWQ1NDUyOTk4MDkyZTEyZDE4ZDBhOWMz","size":164835,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5b3e13fcf73c3d735d5452998092e12d18d0a9c3","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0IGph\ndmEudXRpbC5BYnN0cmFjdENvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnJlc291cmNlLk5vdFN1cHBvcnRlZEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmF4LnJlc291cmNlLlJlc291cmNlRXhjZXB0aW9uOwppbXBv\ncnQgamF2YXgucmVzb3VyY2UuY2NpLkNvbm5lY3Rpb247CmltcG9ydCBqYXZh\neC5yZXNvdXJjZS5jY2kuQ29ubmVjdGlvbk1ldGFEYXRhOwppbXBvcnQgamF2\nYXgucmVzb3VyY2UuY2NpLkludGVyYWN0aW9uOwppbXBvcnQgamF2YXgucmVz\nb3VyY2UuY2NpLkludGVyYWN0aW9uU3BlYzsKaW1wb3J0IGphdmF4LnJlc291\ncmNlLmNjaS5Mb2NhbFRyYW5zYWN0aW9uOwppbXBvcnQgamF2YXgucmVzb3Vy\nY2UuY2NpLlJlY29yZDsKaW1wb3J0IGphdmF4LnJlc291cmNlLmNjaS5SZXNv\ndXJjZVdhcm5pbmc7CmltcG9ydCBqYXZheC5yZXNvdXJjZS5jY2kuUmVzdWx0\nU2V0SW5mbzsKaW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN0YXR1czsKaW1w\nb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN5bmNocm9uaXphdGlvbjsKCmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuaXRlcmF0b3JzLkl0\nZXJhdG9yQ2hhaW47CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNvbGxlY3Rpb25zLm1hcC5MaW5rZWRNYXA7CmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuc2V0Lk1hcEJhY2tlZFNldDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0\nYUNhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVlLk1hbmFnZWRS\ndW50aW1lOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENS\nZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBl\ncnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\ndmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZXZlbnQuUmVtb3RlQ29tbWl0RXZlbnRNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5zYWN0aW9uRXZl\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuVHJhbnNhY3Rp\nb25FdmVudE1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VIYXNoU2V0OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZU1hcDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5jb25jdXJyZW50LlJl\nZW50cmFudExvY2s7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5D\nbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5DYWxsYmFja0V4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob1RyYW5z\nYWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuT2JqZWN0RXhpc3RzRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT2JqZWN0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PYmplY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlzdGljRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUnVudGltZUV4Y2VwdGlv\nblRyYW5zbGF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5T\ndG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBDb25jcmV0ZSB7QGxp\nbmsgQnJva2VyfS4gVGhlIGJyb2tlciBoYW5kbGVzIG9iamVjdC1sZXZlbCBi\nZWhhdmlvciwKICogYnV0IGxlYXZlcyBhbGwgaW50ZXJhY3Rpb24gd2l0aCB0\naGUgZGF0YSBzdG9yZSB0byBhIHtAbGluayBTdG9yZU1hbmFnZXJ9CiAqIHRo\nYXQgbXVzdCBiZSBzdXBwbGllZCBhdCBpbml0aWFsaXphdGlvbi4KICoKICog\nQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBCcm9rZXJJbXBs\nCiAgICBpbXBsZW1lbnRzIEJyb2tlciwgRmluZENhbGxiYWNrcyB7CgogICAg\nLyoqCiAgICAgKiBJbmNyZW1lbnRhbCBmbHVzaC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfSU5DID0gMDsKCiAgICAv\nKioKICAgICAqIEZsdXNoIGluIHByZXBhcmF0aW9uIG9mIGNvbW1pdC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfQ09N\nTUlUID0gMTsKCiAgICAvKioKICAgICAqIEZsdXNoIHRvIGNoZWNrIGNvbnNp\nc3RlbmN5IG9mIGNhY2hlLCB0aGVuIGltbWVkaWF0ZWx5IHJvbGxiYWNrIGNo\nYW5nZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50\nIEZMVVNIX1JPTExCQUNLID0gMjsKCiAgICAvKioKICAgICAqIFJ1biBwZXJz\naXN0ZW5jZS1ieS1yZWFjaGFiaWxpdHkgYW5kIG90aGVyIGZsdXNoLXRpbWUg\nb3BlcmF0aW9ucyB3aXRob3V0CiAgICAgKiBhY2Nlc3NpbmcgdGhlIGRhdGFi\nYXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBG\nTFVTSF9MT0dJQ0FMID0gMzsKCiAgICBzdGF0aWMgZmluYWwgaW50IFNUQVRV\nU19JTklUID0gMDsKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTX1RSQU5T\nSUVOVCA9IDE7CiAgICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19PSURfQVNT\nSUdOID0gMjsKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTX0NPTU1JVF9O\nRVcgPSAzOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0FD\nVElWRSA9IDIgPDwgMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX1NUT1JFX0FDVElWRSA9IDIgPDwgMTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBGTEFHX0NMT1NFX0lOVk9LRUQgPSAyIDw8IDI7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19QUkVTVE9SSU5HID0gMiA8\nPCAzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfREVSRUZE\nRUxFVElORyA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGlu\ndCBGTEFHX0ZMVVNISU5HID0gMiA8PCA1OwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfU1RPUkVfRkxVU0hJTkcgPSAyIDw8IDY7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSEVEID0gMiA8PCA3\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hfUkVR\nVUlSRUQgPSAyIDw8IDg7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nRkxBR19SRU1PVEVfTElTVEVORVIgPSAyIDw8IDk7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19SRVRBSU5FRF9DT05OID0gMiA8PCAxMDsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1RSQU5TX0VORElO\nRyA9IDIgPDwgMTE7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPQogICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdlKEJyb2tl\nckltcGwuY2xhc3MpOwoKICAgIC8vCXRoZSBzdG9yZSBtYW5hZ2VyIGluIHVz\nZTsgdGhpcyBtYXkgYmUgYSBkZWNvcmF0b3Igc3VjaCBhcyBhCiAgICAvLwlk\nYXRhIGNhY2hlIHN0b3JlIG1hbmFnZXIgYXJvdW5kIHRoZSBuYXRpdmUgc3Rv\ncmUgbWFuYWdlcgogICAgcHJpdmF0ZSBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2Vy\nIF9zdG9yZSA9IG51bGw7CgogICAgLy8gcmVmIHRvIHByb2R1Y2luZyBmYWN0\nb3J5IGFuZCBjb25maWd1cmF0aW9uCiAgICBwcml2YXRlIEFic3RyYWN0QnJv\na2VyRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CiAgICBwcml2YXRlIE9wZW5K\nUEFDb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgQ29t\ncGF0aWJpbGl0eSBfY29tcGF0ID0gbnVsbDsKICAgIHByaXZhdGUgRmV0Y2hD\nb25maWd1cmF0aW9uIF9mYyA9IG51bGw7CiAgICBwcml2YXRlIExvZyBfbG9n\nID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF91c2VyID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RyaW5nIF9wYXNzID0gbnVsbDsKICAgIHByaXZhdGUgTWFu\nYWdlZFJ1bnRpbWUgX3J1bnRpbWUgPSBudWxsOwogICAgcHJpdmF0ZSBMb2Nr\nTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBJbnZlcnNlTWFuYWdl\nciBfaW0gPSBudWxsOwogICAgcHJpdmF0ZSBmaW5hbCBKQ0FIZWxwZXIgX2pj\nYSA9IG5ldyBKQ0FIZWxwZXIoKTsKICAgIHByaXZhdGUgUmVlbnRyYW50TG9j\nayBfbG9jayA9IG51bGw7CiAgICBwcml2YXRlIE9wQ2FsbGJhY2tzIF9jYWxs\nID0gbnVsbDsKICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0\nb3IgX2V4dHJhbnMgPSBudWxsOwoKICAgIC8vIGNhY2hlIGNsYXNzIGxvYWRl\nciBhc3NvY2lhdGVkIHdpdGggdGhlIGJyb2tlcgogICAgcHJpdmF0ZSBDbGFz\nc0xvYWRlciBfbG9hZGVyID0gVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS4KICAg\nICAgICBnZXRDb250ZXh0Q2xhc3NMb2FkZXIoKTsKCiAgICAvLyB1c2VyIHN0\nYXRlCiAgICBwcml2YXRlIFN5bmNocm9uaXphdGlvbiBfc3luYyA9IG51bGw7\nCiAgICBwcml2YXRlIE1hcCBfdXNlck9iamVjdHMgPSBudWxsOwoKICAgIC8v\nIG1hbmFnZWQgb2JqZWN0IGNhY2hlcwogICAgcHJpdmF0ZSBNYW5hZ2VkQ2Fj\naGUgX2NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgVHJhbnNhY3Rpb25hbENh\nY2hlIF90cmFuc0NhY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF90cmFu\nc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVyZWZDYWNo\nZSA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVyZWZBZGRpdGlvbnMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBNYXAgX2xvYWRpbmcgPSBudWxsOwogICAgcHJp\ndmF0ZSBTZXQgX29wZXJhdGluZyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBf\ncGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICBwcml2YXRlIFNldCBfdXBkYXRl\nZENsc3MgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX2RlbGV0ZWRDbHNzID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZW5kaW5nID0gbnVsbDsKCiAgICAv\nLyB0cmFjayBpbnN0YW5jZXMgdGhhdCBiZWNvbWUgdHJhbnNhY3Rpb25hbCBh\nZnRlciB0aGUgZmlyc3Qgc2F2ZXBvaW50CiAgICAvLyAodGhlIGZpcnN0IHVz\nZXMgdGhlIHRyYW5zYWN0aW9uYWwgY2FjaGUpCiAgICBwcml2YXRlIFNldCBf\nc2F2ZXBvaW50Q2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBMaW5rZWRNYXAg\nX3NhdmVwb2ludHMgPSBudWxsOwogICAgcHJpdmF0ZSBTYXZlcG9pbnRNYW5h\nZ2VyIF9zcG0gPSBudWxsOwoKICAgIC8vIHRyYWNrIG9wZW4gcXVlcmllcyBh\nbmQgZXh0ZW50cyBzbyB3ZSBjYW4gZnJlZSB0aGVpciByZXNvdXJjZXMgb24g\nY2xvc2UKICAgIHByaXZhdGUgUmVmZXJlbmNlSGFzaFNldCBfcXVlcmllcyA9\nIG51bGw7CiAgICBwcml2YXRlIFJlZmVyZW5jZUhhc2hTZXQgX2V4dGVudHMg\nPSBudWxsOwoKICAgIC8vIHRyYWNrIG9wZXJhdGlvbiBzdGFjayBkZXB0aAog\nICAgcHJpdmF0ZSBpbnQgX29wZXJhdGlvbkNvdW50ID0gMDsKCiAgICAvLyBv\ncHRpb25zCiAgICBwcml2YXRlIGJvb2xlYW4gX25vbnRyYW5zUmVhZCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1dyaXRlID0gZmFs\nc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3JldGFpblN0YXRlID0gZmFsc2U7\nCiAgICBwcml2YXRlIGludCBfYXV0b0NsZWFyID0gQ0xFQVJfREFUQVNUT1JF\nOwogICAgcHJpdmF0ZSBpbnQgX3Jlc3RvcmVTdGF0ZSA9IFJFU1RPUkVfSU1N\nVVRBQkxFOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcHRpbWlzdGljID0gZmFs\nc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX2lnbm9yZUNoYW5nZXMgPSBmYWxz\nZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9tYW5hZ2VkID0gZmFsc2U7CiAgICBw\ncml2YXRlIGJvb2xlYW4gX3N5bmNNYW5hZ2VkID0gZmFsc2U7CiAgICBwcml2\nYXRlIGludCBfY29ublJldGFpbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1BTkQ7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2V2aWN0RGF0YUNhY2hlID0gZmFsc2U7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX3BvcHVsYXRlRGF0YUNhY2hlID0gdHJ1\nZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBpbnQgX2F1dG9EZXRhY2ggPSAwOwogICAgcHJp\ndmF0ZSBpbnQgX2RldGFjaFN0YXRlID0gREVUQUNIX0xPQURFRDsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfZGV0YWNoZWROZXcgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9vcmRlckRpcnR5ID0gZmFsc2U7CgogICAgLy8gc3RhdHVz\nCiAgICBwcml2YXRlIGludCBfZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBSdW50\naW1lRXhjZXB0aW9uIF9jbG9zZWQgPSBudWxsOwoKICAgIC8vIGV2ZW50IG1h\nbmFnZXJzCiAgICBwcml2YXRlIFRyYW5zYWN0aW9uRXZlbnRNYW5hZ2VyIF90\ncmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICBwcml2YXRlIGludCBfdHJh\nbnNDYWxsYmFja01vZGUgPSAwOwogICAgcHJpdmF0ZSBMaWZlY3ljbGVFdmVu\ndE1hbmFnZXIgX2xpZmVFdmVudE1hbmFnZXIgPSBudWxsOwogICAgcHJpdmF0\nZSBpbnQgX2xpZmVDYWxsYmFja01vZGUgPSAwOwoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyJ3MgYXV0aGVudGljYXRpb24u\nIFRoaXMgaXMgdGhlIGZpcnN0CiAgICAgKiBtZXRob2QgY2FsbGVkIGFmdGVy\nIGNvbnN0cnVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gdXNlciB0aGUg\ndXNlcm5hbWUgdGhpcyBicm9rZXIgcmVwcmVzZW50czsgdXNlZCB3aGVuIHBv\nb2xpbmcKICAgICAqIGJyb2tlcnMgdG8gbWFrZSBzdXJlIHRoYXQgYSByZXF1\nZXN0IHRvIHRoZSBmYWN0b3J5IGZvcgogICAgICogYSBjb25uZWN0aW9uIHdp\ndGggYW4gZXhwbGljaXQgdXNlciBpcyBkZWxlZ2F0ZWQgdG8gYSBzdWl0YWJs\nZSBicm9rZXIKICAgICAqIEBwYXJhbSBwYXNzIHRoZSBwYXNzd29yZCBmb3Ig\ndGhlIGFib3ZlIHVzZXIKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0QXV0\naGVudGljYXRpb24oU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzKSB7CiAgICAg\nICAgX3VzZXIgPSB1c2VyOwogICAgICAgIF9wYXNzID0gcGFzczsKICAgIH0K\nCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgdGhlIHBlcnNpc3RlbmNlIG1h\nbmFnZXIuIFRoaXMgbWV0aG9kIGlzIGNhbGxlZAogICAgICogYXV0b21hdGlj\nYWxseSBieSB0aGUgZmFjdG9yeSBiZWZvcmUgdXNlLgogICAgICoKICAgICAq\nIEBwYXJhbSBmYWN0b3J5IHRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIHRo\naXMgYnJva2VyCiAgICAgKiBAcGFyYW0gc20gYSBjb25jcmV0ZSBTdG9yZU1h\nbmFnZXIgaW1wbGVtZW50YXRpb24gdG8KICAgICAqIGhhbmRsZSBpbnRlcmFj\ndGlvbiB3aXRoIHRoZSBkYXRhIHN0b3JlCiAgICAgKiBAcGFyYW0gbWFuYWdl\nZCB0aGUgdHJhbnNhY3Rpb24gbW9kZQogICAgICogQHBhcmFtIGNvbm5Nb2Rl\nIHRoZSBjb25uZWN0aW9uIHJldGFpbiBtb2RlCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGluaXRpYWxpemUoQWJzdHJhY3RCcm9rZXJGYWN0b3J5IGZhY3Rv\ncnksCiAgICAgICAgRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBzbSwgYm9vbGVh\nbiBtYW5hZ2VkLCBpbnQgY29ubk1vZGUpIHsKICAgICAgICBfY29uZiA9IGZh\nY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAgIF9jb21wYXQgPSBf\nY29uZi5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKTsKICAgICAgICBfZmFj\ndG9yeSA9IGZhY3Rvcnk7CiAgICAgICAgX2xvZyA9IF9jb25mLmdldExvZyhP\ncGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfUlVOVElNRSk7CiAgICAgICAgX2Nh\nY2hlID0gbmV3IE1hbmFnZWRDYWNoZShuZXdNYW5hZ2VkT2JqZWN0Q2FjaGUo\nKSk7CiAgICAgICAgX29wZXJhdGluZyA9IE1hcEJhY2tlZFNldC5kZWNvcmF0\nZShuZXcgSWRlbnRpdHlNYXAoKSk7CiAgICAgICAgX2Nvbm5SZXRhaW5Nb2Rl\nID0gY29ubk1vZGU7CiAgICAgICAgX21hbmFnZWQgPSBtYW5hZ2VkOwogICAg\nICAgIGlmIChtYW5hZ2VkKQogICAgICAgICAgICBfcnVudGltZSA9IF9jb25m\nLmdldE1hbmFnZWRSdW50aW1lSW5zdGFuY2UoKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF9ydW50aW1lID0gbmV3IExvY2FsTWFuYWdlZFJ1bnRpbWUo\ndGhpcyk7CgogICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbmV3IExpZmVj\neWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAgIF90cmFuc0V2ZW50TWFuYWdl\nciA9IG5ldyBUcmFuc2FjdGlvbkV2ZW50TWFuYWdlcigpOwogICAgICAgIGlu\ndCBjbW9kZSA9IF9jb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNl\nKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1\nbHRzKCkuZ2V0Q2FsbGJhY2tNb2RlKCk7CiAgICAgICAgc2V0TGlmZWN5Y2xl\nTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwogICAgICAgIHNldFRyYW5z\nYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwoKICAgICAgICAv\nLyBzZXR1cCBkZWZhdWx0IG9wdGlvbnMKICAgICAgICBfZmFjdG9yeS5jb25m\naWd1cmVCcm9rZXIodGhpcyk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0byBk\nbyB0aGlzIGFmdGVyIGNvbmZpZ3VyaW5nIGJyb2tlciBzbyB0aGF0IHN0b3Jl\nIG1hbmFnZXIKICAgICAgICAvLyBjYW4gbG9vayB0byBicm9rZXIgY29uZmln\ndXJhdGlvbjsgd2Ugc2V0IGJvdGggc3RvcmUgYW5kIGxvY2sgbWFuYWdlcnMK\nICAgICAgICAvLyBiZWZvcmUgaW5pdGlhbGl6aW5nIHRoZW0gYmVjYXVzZSB0\naGV5IG1heSBlYWNoIHRyeSB0byBhY2Nlc3MgdGhlCiAgICAgICAgLy8gb3Ro\nZXIgaW4gdGhpZXIgaW5pdGlhbGl6YXRpb24KICAgICAgICBfc3RvcmUgPSBz\nbTsKICAgICAgICBfbG0gPSBfY29uZi5uZXdMb2NrTWFuYWdlckluc3RhbmNl\nKCk7CiAgICAgICAgX2ltID0gX2NvbmYubmV3SW52ZXJzZU1hbmFnZXJJbnN0\nYW5jZSgpOwogICAgICAgIF9zcG0gPSBfY29uZi5nZXRTYXZlcG9pbnRNYW5h\nZ2VySW5zdGFuY2UoKTsKICAgICAgICBfc3RvcmUuc2V0Q29udGV4dCh0aGlz\nKTsKICAgICAgICBfbG0uc2V0Q29udGV4dCh0aGlzKTsKCiAgICAgICAgaWYg\nKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJTl9BTFdBWVMpCiAgICAg\nICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICBfZmMgPSBfc3Rv\ncmUubmV3RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgX2ZjLnNldENv\nbnRleHQodGhpcyk7CgogICAgICAgIC8vIHN5bmNoIHdpdGggdGhlIGdsb2Jh\nbCB0cmFuc2FjdGlvbiBpbiBwcm9ncmVzcywgaWYgYW55CiAgICAgICAgaWYg\nKF9mYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIGZh\nbHNlKSkKICAgICAgICAgICAgYmVnaW5JbnRlcm5hbCgpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2xvc2Ugb24gZmluYWxpemUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGZpbmFsaXplKCkKICAgICAgICB0aHJvd3MgVGhyb3dh\nYmxlIHsKICAgICAgICBzdXBlci5maW5hbGl6ZSgpOwogICAgICAgIGlmICgh\naXNDbG9zZWQoKSkKICAgICAgICAgICAgZnJlZSgpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEge0BsaW5rIE1hcH0gdG8gYmUgdXNlZCBmb3Ig\ndGhlIHByaW1hcnkgbWFuYWdlZCBvYmplY3QgY2FjaGUuCiAgICAgKiBNYXBz\nIG9pZHMgdG8gc3RhdGUgbWFuYWdlcnMuIEJ5IGRlZmF1bHQsIHRoaXMgY3Jl\nYXRlcyBhCiAgICAgKiB7QGxpbmsgUmVmZXJlbmNlTWFwfSB3aXRoIHNvZnQg\ndmFsdWVzLgogICAgICovCiAgICBwcm90ZWN0ZWQgTWFwIG5ld01hbmFnZWRP\nYmplY3RDYWNoZSgpIHsKICAgICAgICByZXR1cm4gbmV3IFJlZmVyZW5jZUhh\nc2hNYXAoUmVmZXJlbmNlTWFwLkhBUkQsIFJlZmVyZW5jZU1hcC5TT0ZUKTsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIENvbm5lY3Rpb24g\naW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgQ29ubmVjdGlvbk1ldGFEYXRhIGdl\ndE1ldGFEYXRhKCkKICAgICAgICB0aHJvd3MgUmVzb3VyY2VFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBfamNhOwogICAgfQoKICAgIHB1YmxpYyBJbnRl\ncmFjdGlvbiBjcmVhdGVJbnRlcmFjdGlvbigpCiAgICAgICAgdGhyb3dzIFJl\nc291cmNlRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gX2pjYTsKICAgIH0K\nCiAgICBwdWJsaWMgTG9jYWxUcmFuc2FjdGlvbiBnZXRMb2NhbFRyYW5zYWN0\naW9uKCkKICAgICAgICB0aHJvd3MgUmVzb3VyY2VFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHRTZXRJ\nbmZvIGdldFJlc3VsdFNldEluZm8oKQogICAgICAgIHRocm93cyBSZXNvdXJj\nZUV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIF9qY2E7CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW1w\nbGVtZW50YXRpb24gb2YgU3RvcmVDb250ZXh0CiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEJyb2tlciBnZXRC\ncm9rZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIFByb3BlcnRpZXMKICAgIC8vLy8vLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgc2V0SW1wbGljaXRCZWhhdmlvcihPcENh\nbGxiYWNrcyBjYWxsLAogICAgICAgIFJ1bnRpbWVFeGNlcHRpb25UcmFuc2xh\ndG9yIGV4KSB7CiAgICAgICAgaWYgKF9jYWxsID09IG51bGwpCiAgICAgICAg\nICAgIF9jYWxsID0gY2FsbDsKICAgICAgICBpZiAoX2V4dHJhbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgX2V4dHJhbnMgPSBleDsKICAgIH0KCiAgICBSdW50\naW1lRXhjZXB0aW9uVHJhbnNsYXRvciBnZXRJbnN0YW5jZUV4Y2VwdGlvblRy\nYW5zbGF0b3IoKSB7CiAgICAgICAgcmV0dXJuIChfb3BlcmF0aW9uQ291bnQg\nPT0gMCkgPyBfZXh0cmFucyA6IG51bGw7CiAgICB9CgogICAgcHVibGljIEJy\nb2tlckZhY3RvcnkgZ2V0QnJva2VyRmFjdG9yeSgpIHsKICAgICAgICByZXR1\ncm4gX2ZhY3Rvcnk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFDb25maWd1\ncmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9j\nb25mOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfZmM7CiAg\nICB9CgogICAgcHVibGljIGludCBnZXRDb25uZWN0aW9uUmV0YWluTW9kZSgp\nIHsKICAgICAgICByZXR1cm4gX2Nvbm5SZXRhaW5Nb2RlOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZCgpIHsKICAgICAgICByZXR1cm4g\nX21hbmFnZWQ7CiAgICB9CgogICAgcHVibGljIE1hbmFnZWRSdW50aW1lIGdl\ndE1hbmFnZWRSdW50aW1lKCkgewogICAgICAgIHJldHVybiBfcnVudGltZTsK\nICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NMb2FkZXIo\nKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAgICB9CgogICAgcHVibGlj\nIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgZ2V0U3RvcmVNYW5hZ2VyKCkgewog\nICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9CgogICAgcHVibGljIExvY2tN\nYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfbG07\nCiAgICB9CgogICAgcHVibGljIEludmVyc2VNYW5hZ2VyIGdldEludmVyc2VN\nYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfaW07CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyBnZXRDb25uZWN0aW9uVXNlck5hbWUoKSB7CiAgICAgICAg\ncmV0dXJuIF91c2VyOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29u\nbmVjdGlvblBhc3N3b3JkKCkgewogICAgICAgIHJldHVybiBfcGFzczsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNdWx0aXRocmVhZGVkKCkgewog\nICAgICAgIHJldHVybiBfbXVsdGl0aHJlYWRlZDsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRNdWx0aXRocmVhZGVkKGJvb2xlYW4gbXVsdGl0aHJlYWRl\nZCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfbXVsdGl0aHJl\nYWRlZCA9IG11bHRpdGhyZWFkZWQ7CiAgICAgICAgaWYgKG11bHRpdGhyZWFk\nZWQgJiYgX2xvY2sgPT0gbnVsbCkKICAgICAgICAgICAgX2xvY2sgPSBuZXcg\nUmVlbnRyYW50TG9jaygpOwogICAgICAgIGVsc2UgaWYgKCFtdWx0aXRocmVh\nZGVkKQogICAgICAgICAgICBfbG9jayA9IG51bGw7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsKICAgICAgICByZXR1\ncm4gX2lnbm9yZUNoYW5nZXM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nSWdub3JlQ2hhbmdlcyhib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IHZhbDsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsUmVhZCgpIHsK\nICAgICAgICByZXR1cm4gX25vbnRyYW5zUmVhZDsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsUmVhZChib29sZWFuIHZhbCkg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwtb3AtaW4tcHJlc3Rv\ncmUiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBw\nb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9w\ndGlvbnMoKS5jb250YWlucwogICAgICAgICAgICAoX2NvbmYuT1BUSU9OX05P\nTlRSQU5TX1JFQUQpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgibm9udHJh\nbnMtcmVhZC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICBfbm9udHJhbnNS\nZWFkID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldE5vbnRy\nYW5zYWN0aW9uYWxXcml0ZSgpIHsKICAgICAgICByZXR1cm4gX25vbnRyYW5z\nV3JpdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Tm9udHJhbnNhY3Rp\nb25hbFdyaXRlKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAw\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsKCiAgICAgICAgX25vbnRy\nYW5zV3JpdGUgPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0\nT3B0aW1pc3RpYygpIHsKICAgICAgICByZXR1cm4gX29wdGltaXN0aWM7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0T3B0aW1pc3RpYyhib29sZWFuIHZh\nbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJ0cmFucy1hY3RpdmUi\nLAogICAgICAgICAgICAgICAgIk9wdGltaXN0aWMiKSk7CgogICAgICAgIC8v\nIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0cyBpdAogICAgICAgIGlm\nICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9wdGlvbnMoKS5jb250YWlucyhf\nY29uZi5PUFRJT05fT1BUSU1JU1RJQykpCiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAg\nICAgKCJvcHRpbWlzdGljLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIF9v\ncHRpbWlzdGljID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0UmVz\ndG9yZVN0YXRlKCkgewogICAgICAgIHJldHVybiBfcmVzdG9yZVN0YXRlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlc3RvcmVTdGF0ZShpbnQgdmFs\nKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIs\nCiAgICAgICAgICAgICAgICAiUmVzdG9yZSIpKTsKCiAgICAgICAgX3Jlc3Rv\ncmVTdGF0ZSA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRS\nZXRhaW5TdGF0ZSgpIHsKICAgICAgICByZXR1cm4gX3JldGFpblN0YXRlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJldGFpblN0YXRlKGJvb2xlYW4g\ndmFsKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1w\ncmVzdG9yZSIpKTsKICAgICAgICBfcmV0YWluU3RhdGUgPSB2YWw7CiAgICB9\nCgogICAgcHVibGljIGludCBnZXRBdXRvQ2xlYXIoKSB7CiAgICAgICAgcmV0\ndXJuIF9hdXRvQ2xlYXI7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0\nb0NsZWFyKGludCB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgX2F1dG9DbGVhciA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndEF1dG9EZXRhY2goKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvRGV0YWNoOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFj\naEZsYWdzKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9hdXRv\nRGV0YWNoID0gZGV0YWNoRmxhZ3M7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0QXV0b0RldGFjaChpbnQgZGV0YWNoRmxhZywgYm9vbGVhbiBvbikgewog\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAob24pCiAgICAgICAg\nICAgIF9hdXRvRGV0YWNoIHw9IGRldGFjaEZsYWc7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfYXV0b0RldGFjaCAmPSB+ZGV0YWNoRmxhZzsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IGdldERldGFjaFN0YXRlKCkgewogICAgICAgIHJl\ndHVybiBfZGV0YWNoU3RhdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRGV0YWNoU3RhdGUoaW50IG1vZGUpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgX2RldGFjaFN0YXRlID0gbW9kZTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0RldGFjaGVkTmV3KCkgewogICAgICAgIHJldHVybiBf\nZGV0YWNoZWROZXc7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGV0YWNo\nZWROZXcoYm9vbGVhbiBpc05ldykgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfZGV0YWNoZWROZXcgPSBpc05ldzsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoKSB7\nCiAgICAgICAgcmV0dXJuIF9zeW5jTWFuYWdlZDsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoYm9vbGVh\nbiBzeW5jKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5j\nTWFuYWdlZCA9IHN5bmM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0\nRXZpY3RGcm9tRGF0YUNhY2hlKCkgewogICAgICAgIHJldHVybiBfZXZpY3RE\nYXRhQ2FjaGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RXZpY3RGcm9t\nRGF0YUNhY2hlKGJvb2xlYW4gZXZpY3QpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgX2V2aWN0RGF0YUNhY2hlID0gZXZpY3Q7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9wb3B1bGF0ZURhdGFDYWNoZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRQb3B1bGF0ZURhdGFDYWNoZShib29sZWFuIGNhY2hl\nKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9wb3B1bGF0ZURh\ndGFDYWNoZSA9IGNhY2hlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nTGFyZ2VUcmFuc2FjdGlvbigpIHsKICAgICAgICByZXR1cm4gX2xhcmdlVHJh\nbnNhY3Rpb247CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TGFyZ2VUcmFu\nc2FjdGlvbihib29sZWFuIGxhcmdlVHJhbnNhY3Rpb24pIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgX2xhcmdlVHJhbnNhY3Rpb24gPSBsYXJn\nZVRyYW5zYWN0aW9uOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VXNl\nck9iamVjdChPYmplY3Qga2V5KSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX3Vz\nZXJPYmplY3RzID09IG51bGwpID8gbnVsbCA6IF91c2VyT2JqZWN0cy5nZXQo\na2V5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBw\ndXRVc2VyT2JqZWN0KE9iamVjdCBrZXksIE9iamVjdCB2YWwpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIChfdXNlck9iamVjdHMgPT0gbnVsbCkgPyBudWxsIDogX3VzZXJPYmplY3Rz\nLnJlbW92ZShrZXkpOwoKICAgICAgICAgICAgaWYgKF91c2VyT2JqZWN0cyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3VzZXJPYmplY3RzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgcmV0dXJuIF91c2VyT2JqZWN0cy5wdXQo\na2V5LCB2YWwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8v\nCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9p\nZCBhZGRMaWZlY3ljbGVMaXN0ZW5lcihPYmplY3QgbGlzdGVuZXIsIENsYXNz\nW10gY2xhc3NlcykgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBfbGlmZUV2ZW50TWFuYWdlci5h\nZGRMaXN0ZW5lcihsaXN0ZW5lciwgY2xhc3Nlcyk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZUxpZmVjeWNsZUxpc3RlbmVy\nKE9iamVjdCBsaXN0ZW5lcikgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZh\nbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfbGlmZUV2ZW50TWFu\nYWdlci5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxs\nYmFja01vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9saWZlQ2FsbGJhY2tNb2Rl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExpZmVjeWNsZUxpc3RlbmVy\nQ2FsbGJhY2tNb2RlKGludCBtb2RlKSB7CiAgICAgICAgYmVnaW5PcGVyYXRp\nb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlQ2Fs\nbGJhY2tNb2RlID0gbW9kZTsKICAgICAgICAgICAgX2xpZmVFdmVudE1hbmFn\nZXIuc2V0RmFpbEZhc3QoKG1vZGUgJiBDQUxMQkFDS19GQUlMX0ZBU1QpICE9\nIDApOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdpdmUg\nc3RhdGUgbWFuYWdlcnMgYWNjZXNzIHRvIHRoZSBsaWZlY3ljbGUgZXZlbnQg\nbWFuYWdlci4KICAgICAqLwogICAgcHVibGljIExpZmVjeWNsZUV2ZW50TWFu\nYWdlciBnZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIoKSB7CiAgICAgICAgcmV0\ndXJuIF9saWZlRXZlbnRNYW5hZ2VyOwogICAgfQoKICAgIC8qKgogICAgICog\nRmlyZSBnaXZlbiBsaWZlY3ljbGUgZXZlbnQsIGhhbmRsaW5nIGFueSBleGNl\ncHRpb25zIGFwcHJvcHJpYXRlbHkuCiAgICAgKgogICAgICogQHJldHVybiB3\naGV0aGVyIGV2ZW50cyBhcmUgYmVpbmcgcHJvY2Vzc2VkIGF0IHRoaXMgdGlt\nZQogICAgICovCiAgICBib29sZWFuIGZpcmVMaWZlY3ljbGVFdmVudChPYmpl\nY3Qgc3JjLCBPYmplY3QgcmVsYXRlZCwgQ2xhc3NNZXRhRGF0YSBtZXRhLAog\nICAgICAgIGludCBldmVudFR5cGUpIHsKICAgICAgICBpZiAoX2xpZmVFdmVu\ndE1hbmFnZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhfbGlmZUV2ZW50TWFu\nYWdlci5maXJlRXZlbnQoc3JjLCByZWxhdGVkLCAKICAgICAgICAgICAgbWV0\nYSwgZXZlbnRUeXBlKSwgX2xpZmVDYWxsYmFja01vZGUpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVGFrZSBhY3Rpb25z\nIG9uIGNhbGxiYWNrIGV4Y2VwdGlvbnMgZGVwZW5kaW5nIG9uIGNhbGxiYWNr\nIG1vZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYW5kbGVDYWxsYmFj\na0V4Y2VwdGlvbnMoRXhjZXB0aW9uW10gZXhjZXBzLCBpbnQgbW9kZSkgewog\nICAgICAgIGlmIChleGNlcHMubGVuZ3RoID09IDAgfHwgKG1vZGUgJiBDQUxM\nQkFDS19JR05PUkUpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgT3BlbkpQQUV4Y2VwdGlvbiBjZTsKICAgICAgICBpZiAoZXhjZXBzLmxl\nbmd0aCA9PSAxKQogICAgICAgICAgICBjZSA9IG5ldyBDYWxsYmFja0V4Y2Vw\ndGlvbihleGNlcHNbMF0pOwogICAgICAgIGVsc2UgCiAgICAgICAgICAgIGNl\nID0gbmV3IENhbGxiYWNrRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWxsYmFjay1l\ncnIiKSkuCiAgICAgICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGV4\nY2Vwcyk7CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUk9MTEJBQ0sp\nICE9IDAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAgICAg\nICAgICAgIGNlLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBzZXRSb2xs\nYmFja09ubHlJbnRlcm5hbCgpOwogICAgICAgIH0KICAgICAgICBpZiAoKG1v\nZGUgJiBDQUxMQkFDS19MT0cpICE9IDAgJiYgX2xvZy5pc1dhcm5FbmFibGVk\nKCkpCiAgICAgICAgICAgIF9sb2cud2FybihjZSk7CiAgICAgICAgaWYgKCht\nb2RlICYgQ0FMTEJBQ0tfUkVUSFJPVykgIT0gMCkKICAgICAgICAgICAgdGhy\nb3cgY2U7CiAgICB9CgogICAgcHVibGljIHZvaWQgYWRkVHJhbnNhY3Rpb25M\naXN0ZW5lcihPYmplY3QgdGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3RyYW5zRXZlbnRN\nYW5hZ2VyLmFkZExpc3RlbmVyKHRsKTsKICAgICAgICAgICAgaWYgKHRsIGlu\nc3RhbmNlb2YgUmVtb3RlQ29tbWl0RXZlbnRNYW5hZ2VyKQogICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVNT1RFX0xJU1RFTkVSOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVUcmFuc2FjdGlv\nbkxpc3RlbmVyKE9iamVjdCB0bCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3RyYW5z\nRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKHRsKQogICAgICAgICAgICAg\nICAgJiYgKHRsIGluc3RhbmNlb2YgUmVtb3RlQ29tbWl0RXZlbnRNYW5hZ2Vy\nKSkKICAgICAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19SRU1PVEVfTElT\nVEVORVI7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nVHJhbnNhY3Rpb25MaXN0ZW5lckNhbGxiYWNrTW9kZSgpIHsKICAgICAgICBy\nZXR1cm4gX3RyYW5zQ2FsbGJhY2tNb2RlOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoaW50IG1v\nZGUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgX3RyYW5zQ2FsbGJhY2tNb2RlID0gbW9kZTsK\nICAgICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyLnNldEZhaWxGYXN0KCht\nb2RlICYgQ0FMTEJBQ0tfRkFJTF9GQVNUKSAhPSAwKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGaXJlIGdpdmVuIHRyYW5zYWN0aW9u\nIGV2ZW50LCBoYW5kbGluZyBhbnkgZXhjZXB0aW9ucyBhcHByb3ByaWF0ZWx5\nLgogICAgICoKICAgICAqIEByZXR1cm4gd2hldGhlciBldmVudHMgYXJlIGJl\naW5nIHByb2Nlc3NlZCBhdCB0aGlzIHRpbWUKICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGZpcmVUcmFuc2FjdGlvbkV2ZW50KFRyYW5zYWN0aW9uRXZlbnQg\ndHJhbnMpIHsKICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyICE9IG51\nbGwpCiAgICAgICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhfdHJh\nbnNFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHRyYW5zKSwKICAgICAgICAgICAg\nICAgIF90cmFuc0NhbGxiYWNrTW9kZSk7CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8KICAgIC8vIExvb2t1cHMKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIGJvb2xlYW4gdmFsaWRhdGUsIEZp\nbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGludCBmbGFncyA9IE9JRF9D\nT1BZIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAgICAg\naWYgKCF2YWxpZGF0ZSkKICAgICAgICAgICAgZmxhZ3MgfD0gT0lEX05PVkFM\nSURBVEU7CiAgICAgICAgcmV0dXJuIGZpbmQob2lkLCBfZmMsIG51bGwsIG51\nbGwsIGZsYWdzLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZp\nbmQoT2JqZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRT\nZXQgZXhjbHVkZSwKICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncykg\newogICAgICAgIHJldHVybiBmaW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGVk\nYXRhLCBmbGFncywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRl\ncm5hbCBmaW5kZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgZmlu\nZChPYmplY3Qgb2lkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNl\ndCBleGNsdWRlLAogICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzLCBG\naW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxs\nKQogICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxs\nLnByb2Nlc3NBcmd1bWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVs\nbCkgewogICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUp\nID09IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91\nbmRFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtb2lkIikpOwogICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAg\nICAgfQogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBm\nZXRjaCA9IF9mYzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25h\nbFJlYWQoKTsKCiAgICAgICAgICAgIC8vIGNhY2hlZCBpbnN0YW5jZT8KICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGxCeUlkKG9pZCwKICAgICAgICAgICAgICAgIChmbGFncyAmIE9JRF9B\nTExPV19ORVcpICE9IDAgfHwgKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0g\nMCk7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBpZiAoIXJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZWRhdGEsIGZsYWdz\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0\ndXJuKG9pZCwgc20pOwoKICAgICAgICAgICAgICAgIGlmICghc20uaXNMb2Fk\naW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgYWxs\nIHRoZSBjb25maWd1cmVkIGZpZWxkcyBhcmUgbG9hZGVkOyBkbyB0aGlzCiAg\nICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgbWFraW5nIGluc3RhbmNlIHRy\nYW5zYWN0aW9uYWwgZm9yIGxvY2tpbmcKICAgICAgICAgICAgICAgICAgICBp\nZiAoIXNtLmlzVHJhbnNhY3Rpb25hbCgpICYmIHVzZVRyYW5zYWN0aW9uYWxT\ndGF0ZShmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnRyYW5z\nYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGxvYWRl\nZCA9IHNtLmlzTG9hZGluZygpOwogICAgICAgICAgICAgICAgICAgIGlmICgh\nbG9hZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQgPSBzbS5sb2FkKGZldGNo\nLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBleGNsdWRlLCBlZGF0YSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbiBvbmZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRF\nKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG9uZmU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2Fs\nbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgIC8vIGlmIG5vIGRhdGEgbmVlZGVkIHRvIGJlIGxvYWRlZCBhbmQg\ndGhlIHVzZXIgd2FudHMgdG8KICAgICAgICAgICAgICAgICAgICAvLyB2YWxp\nZGF0ZSwganVzdCBtYWtlIHN1cmUgdGhlIG9iamVjdCBleGlzdHMKICAgICAg\nICAgICAgICAgICAgICBpZiAoIWxvYWRlZCAmJiAoZmxhZ3MgJiBPSURfTk9W\nQUxJREFURSkgPT0gMAogICAgICAgICAgICAgICAgICAgICAgICAmJiBfY29t\ncGF0LmdldFZhbGlkYXRlVHJ1ZUNoZWNrc1N0b3JlKCkKICAgICAgICAgICAg\nICAgICAgICAgICAgJiYgIXNtLmlzVHJhbnNhY3Rpb25hbCgpCiAgICAgICAg\nICAgICAgICAgICAgICAgICYmICFfc3RvcmUuZXhpc3RzKHNtLCBlZGF0YSkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9O\nT0RFTEVURUQpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJk\nZWwtaW5zdGFuY2UiLCBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgb2lkKSku\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qo\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBzaW5j\nZSB0aGUgb2JqZWN0IHdhcyBjYWNoZWQsIHdlIG1heSBuZWVkIHRvIHVwZ3Jh\nZGUgbG9jawogICAgICAgICAgICAgICAgLy8gaWYgY3VycmVudCBsZXZlbCBp\ncyBoaWdoZXIgdGhhbiBsZXZlbCBvZiBpbml0aWFsIGxvYWQKICAgICAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDApIHsKICAg\nICAgICAgICAgICAgICAgICBpbnQgbGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9j\na0xldmVsKCk7CiAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxl\ndmVsLCBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBlZGF0YSk7CiAgICAgICAg\nICAgICAgICAgICAgc20ucmVhZExvY2tlZChsZXZlbCwgZmV0Y2guZ2V0V3Jp\ndGVMb2NrTGV2ZWwoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG5vIGNhY2hl\nZCBzbSBmb3IgYSBuZXcvdHJhbnNpZW50IGlkIHR5cGUsIHdlCiAgICAgICAg\nICAgIC8vIGl0IGRlZmluaXRlbHkgZG9lc24ndCBleGlzdAogICAgICAgICAg\nICBpZiAob2lkIGluc3RhbmNlb2YgU3RhdGVNYW5hZ2VySWQpCiAgICAgICAg\nICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7\nCgogICAgICAgICAgICAvLyBpbml0aWFsaXplIGEgbmV3IHN0YXRlIG1hbmFn\nZXIgZm9yIHRoZSBkYXRhc3RvcmUgaW5zdGFuY2UKICAgICAgICAgICAgc20g\nPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NPUFkp\nICE9IDApOwogICAgICAgICAgICBib29sZWFuIGxvYWQgPSByZXF1aXJlc0xv\nYWQoc20sIGZhbHNlLCBlZGF0YSwgZmxhZ3MpOwogICAgICAgICAgICBzbSA9\nIGluaXRpYWxpemUoc20sIGxvYWQsIGZldGNoLCBlZGF0YSk7CiAgICAgICAg\nICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZs\nYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwg\nbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3Vy\nZSBhbGwgY29uZmlndXJlZCBmaWVsZHMgd2VyZSBsb2FkZWQKICAgICAgICAg\nICAgaWYgKGxvYWQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5M\nT0FEX0ZHUywgZXhjbHVkZSwKICAgICAgICAgICAgICAgICAgICAgICAgZWRh\ndGEsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAg\nICAgICAgICAgICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkK\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVs\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluaXRp\nYWxpemUgYSBuZXdseS1jb25zdHJ1Y3RlZCBzdGF0ZSBtYW5hZ2VyLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBpbml0aWFsaXpl\nKFN0YXRlTWFuYWdlckltcGwgc20sIGJvb2xlYW4gbG9hZCwKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAg\nICAgIGlmICghbG9hZCkgewogICAgICAgICAgICBzbS5pbml0aWFsaXplKHNt\nLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAg\nICAgICAgUENTdGF0ZS5IT0xMT1cpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIFBDU3RhdGUgc3RhdGUgPSAodXNlVHJhbnNhY3Rpb25hbFN0YXRl\nKGZldGNoKSkKICAgICAgICAgICAgICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQ\nQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgc20uc2V0TG9hZGluZyh0\ncnVlKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgh\nX3N0b3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgc20uc2V0TG9hZGluZyhmYWxz\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNt\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rp\nb24gb2lkcywgYm9vbGVhbiB2YWxpZGF0ZSwKICAgICAgICBGaW5kQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9J\nRF9BTExPV19ORVcgfCBPSURfTk9ERUxFVEVEOwogICAgICAgIGlmICghdmFs\naWRhdGUpCiAgICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwog\nICAgICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIF9mYywgbnVsbCwgbnVsbCwg\nZmxhZ3MsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5k\nQWxsKENvbGxlY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBm\nbGFncykgewogICAgICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIGZldGNoLCBl\neGNsdWRlLCBlZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgZmluZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nT2JqZWN0W10gZmluZEFsbChDb2xsZWN0aW9uIG9pZHMsIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0\nIGVkYXRhLCBpbnQgZmxhZ3MsIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIC8vIHRocm93IGFueSBleGNlcHRpb25zIGZvciBudWxsIG9pZHMgdXAg\naW1tZWRpYXRlbHkKICAgICAgICBpZiAob2lkcyA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oIm9pZHMgPT0g\nbnVsbCIpOwogICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkg\nIT0gMCAmJiBvaWRzLmNvbnRhaW5zKG51bGwpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1vaWRzIikpOwoK\nICAgICAgICAvLyB3ZSBoYXZlIHRvIHVzZSBhIG1hcCBvZiBvaWQtPnNtIHJh\ndGhlciB0aGFuIGEgc2ltcGxlCiAgICAgICAgLy8gYXJyYXksIHNvIHRoYXQg\nd2UgbWFrZSBzdXJlIG5vdCB0byBjcmVhdGUgbXVsdGlwbGUgc21zIGZvciBl\ncXVpdmFsZW50CiAgICAgICAgLy8gb2lkcyBpZiB0aGUgdXNlciBoYXMgZHVw\nbGljYXRlcyBpbiB0aGUgZ2l2ZW4gYXJyYXkKICAgICAgICBfbG9hZGluZyA9\nIG5ldyBIYXNoTWFwKChpbnQpIChvaWRzLnNpemUoKSAqIDEuMzMgKyAxKSk7\nCiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9\nIHRoaXM7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAg\nIGZldGNoID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlv\nbmFsUmVhZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVjdGlvbiBvZiBzdGF0\nZSBtYW5hZ2VycyB0byBwYXNzIHRvIHN0b3JlIG1hbmFnZXIKICAgICAgICAg\nICAgTGlzdCBsb2FkID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbTsKICAgICAgICAgICAgYm9vbGVhbiBpbml0aWFsaXplZDsKICAg\nICAgICAgICAgYm9vbGVhbiB0cmFuc1N0YXRlID0gdXNlVHJhbnNhY3Rpb25h\nbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAgT2JqZWN0IG9iaiwgb2lkOwog\nICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGlk\neCsrKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSd2ZSBhbHJlYWR5IHNl\nZW4gdGhpcyBvaWQsIHNraXAgcmVwZWF0cwogICAgICAgICAgICAgICAgb2Jq\nID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIG9pZCA9IGNhbGwucHJv\nY2Vzc0FyZ3VtZW50KG9iaik7CiAgICAgICAgICAgICAgICBpZiAob2lkID09\nIG51bGwgfHwgX2xvYWRpbmcuY29udGFpbnNLZXkob2JqKSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3\nZSBkb24ndCBoYXZlIGEgY2FjaGVkIGluc3RhbmNlIG9yIGl0IGlzIG5vdCB0\ncmFuc2FjdGlvbmFsCiAgICAgICAgICAgICAgICAvLyBhbmQgaXMgaG9sbG93\nIG9yIHdlIG5lZWQgdG8gdmFsaWRhdGUsIGxvYWQgaXQKICAgICAgICAgICAg\nICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQob2lkLCAoZmxhZ3Mg\nJiBPSURfQUxMT1dfTkVXKSAhPSAwCiAgICAgICAgICAgICAgICAgICAgfHwg\nKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCk7CiAgICAgICAgICAgICAg\nICBpbml0aWFsaXplZCA9IHNtICE9IG51bGw7CiAgICAgICAgICAgICAgICBp\nZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNtID0gbmV3\nU3RhdGVNYW5hZ2VySW1wbChvaWQsIChmbGFncyAmIE9JRF9DT1BZKSAhPSAw\nKTsKCiAgICAgICAgICAgICAgICBfbG9hZGluZy5wdXQob2JqLCBzbSk7CiAg\nICAgICAgICAgICAgICBpZiAocmVxdWlyZXNMb2FkKHNtLCBpbml0aWFsaXpl\nZCwgZWRhdGEsIGZsYWdzKSkgewogICAgICAgICAgICAgICAgICAgIHRyYW5z\nU3RhdGUgPSB0cmFuc1N0YXRlIHx8IHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShm\nZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxpemVkICYm\nICFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB0cmFuc1N0YXRlKQogICAgICAg\nICAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3Qob2lkcy5zaXplKCkgLSBp\nZHgpOwogICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSBpZiAoIWluaXRpYWxpemVkKQogICAgICAgICAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXRE\nZXNjcmliZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIFBDU3Rh\ndGUuSE9MTE9XKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGFz\ncyBhbGwgc3RhdGUgbWFuYWdlcnMgaW4gbmVlZCBvZiBsb2FkaW5nIG9yIHZh\nbGlkYXRpb24gdG8gdGhlCiAgICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIK\nICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgUENTdGF0ZSBzdGF0ZSA9ICh0cmFuc1N0YXRlKSA/IFBDU3RhdGUuUENM\nRUFOCiAgICAgICAgICAgICAgICAgICAgOiBQQ1N0YXRlLlBOT05UUkFOUzsK\nICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gX3N0b3JlLmxv\nYWRBbGwobG9hZCwgc3RhdGUsCiAgICAgICAgICAgICAgICAgICAgU3RvcmVN\nYW5hZ2VyLkZPUkNFX0xPQURfTk9ORSwgZmV0Y2gsIGVkYXRhKTsKCiAgICAg\nICAgICAgICAgICAvLyBzZXQgZmFpbGVkIGluc3RhbmNlcyB0byBudWxsCiAg\nICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYg\nT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCk7CiAg\nICAgICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBmYWlsZWQu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9sb2FkaW5nLnB1dChpdHIubmV4dCgpLCBudWxsKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY3Jl\nYXRlIHJlc3VsdHMgYXJyYXk7IG1ha2Ugc3VyZSBhbGwgY29uZmlndXJlZCBm\naWVsZHMgYXJlCiAgICAgICAgICAgIC8vIGxvYWRlZCBpbiBlYWNoIGluc3Rh\nbmNlCiAgICAgICAgICAgIE9iamVjdFtdIHJlc3VsdHMgPSBuZXcgT2JqZWN0\nW29pZHMuc2l6ZSgpXTsKICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSAo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDA7CiAgICAgICAgICAgIGludCBs\nZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAg\naWR4ID0gMDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvaWRz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAg\nICAgICAgICBvaWQgPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgc20g\nPSAoU3RhdGVNYW5hZ2VySW1wbCkgX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAg\nICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiByZXF1aXJlc0xvYWQoc20s\nIHRydWUsIGVkYXRhLCBmbGFncykpIHsKICAgICAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKGZldGNoLCBT\ndGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLAogICAgICAgICAgICAgICAgICAg\nICAgICAJZXhjbHVkZSwgZWRhdGEsIGZhbHNlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGFjdGl2ZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgX2xtLmxvY2soc20sIGxldmVsLCBmZXRjaC5nZXRMb2NrVGltZW91\ndCgpLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5y\nZWFkTG9ja2VkKGxldmVsLCBmZXRjaC5nZXRXcml0ZUxvY2tMZXZlbCgpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICBjYXRjaCAoT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24gb25mZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgKGZsYWdzICYgT0lEX05PVkFMSURBVEUpICE9IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBvbmZlOwogICAg\nICAgICAgICAgICAgICAgICAgICBzbSA9IG51bGw7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVz\ndWx0c1tpZHhdID0gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAg\nIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\ndGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihy\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2xvYWRpbmcg\nPSBudWxsOwogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUgZ2l2\nZW4gaW5zdGFuY2UgbmVlZHMgbG9hZGluZyBiZWZvcmUgYmVpbmcgcmV0dXJu\nZWQKICAgICAqIHRvIHRoZSB1c2VyLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gcmVxdWlyZXNMb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIGJv\nb2xlYW4gaW5pdGlhbGl6ZWQsCiAgICAgICAgT2JqZWN0IGVkYXRhLCBpbnQg\nZmxhZ3MpIHsKICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUp\nID09IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChl\nZGF0YSAhPSBudWxsKSAvLyB0YWtlIGFkdmFudGFnZSBvZiBleGlzdGluZyBy\nZXN1bHQKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGlu\naXRpYWxpemVkICYmIHNtLmdldFBDU3RhdGUoKSAhPSBQQ1N0YXRlLkhPTExP\nVykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghaW5p\ndGlhbGl6ZWQgJiYgc20uZ2V0TWV0YURhdGEoKS5nZXRQQ1N1YmNsYXNzZXMo\nKS5sZW5ndGggPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICByZXR1cm4gIV9jb21wYXQuZ2V0VmFsaWRhdGVGYWxzZVJldHVybnNIb2xs\nb3coKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRv\nIHVzZSBhIHRyYW5zYWN0aW9uYWwgc3RhdGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiB1c2VUcmFuc2FjdGlvbmFsU3RhdGUoRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgIT0gMCAmJiAoIV9vcHRpbWlzdGljCiAgICAgICAgICAgIHx8\nIF9hdXRvQ2xlYXIgPT0gQ0xFQVJfQUxMCiAgICAgICAgICAgIHx8IGZldGNo\nLmdldFJlYWRMb2NrTGV2ZWwoKSAhPSBMT0NLX05PTkUpOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZmluZENhY2hlZChPYmplY3Qgb2lkLCBGaW5kQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAg\nICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxsLnByb2Nl\nc3NBcmd1bWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwp\nOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVN\nYW5hZ2VySW1wbEJ5SWQob2lkLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJu\nIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIENsYXNzIGdldE9iamVjdElkVHlwZShDbGFzcyBj\nbHMpIHsKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAg\nICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgX2xvYWRlciwgZmFsc2UpOwog\nICAgICAgICAgICBpZiAobWV0YSA9PSBudWxsCiAgICAgICAgICAgICAgICB8\nfCBtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURf\nVU5LTk9XTikKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgcmV0dXJuIG1l\ndGEuZ2V0T2JqZWN0SWRUeXBlKCk7CgogICAgICAgICAgICByZXR1cm4gX3N0\nb3JlLmdldERhdGFTdG9yZUlkVHlwZShtZXRhKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld09iamVjdElk\nKENsYXNzIGNscywgT2JqZWN0IHZhbCkgewogICAgICAgIGlmICh2YWwgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xz\nLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgICAgIC8vIGRlbGVnYXRlIHRv\nIHN0b3JlIG1hbmFnZXIgZm9yIGRhdGFzdG9yZSBpZHMKICAgICAgICAgICAg\naWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9EQVRBU1RPUkUpIHsKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFu\nY2VvZiBTdHJpbmcKICAgICAgICAgICAgICAgICAgICAmJiAoKFN0cmluZykg\ndmFsKS5zdGFydHNXaXRoKFN0YXRlTWFuYWdlcklkLlNUUklOR19QUkVGSVgp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2Vy\nSWQoKFN0cmluZykgdmFsKTsKICAgICAgICAgICAgICAgIHJldHVybiBfc3Rv\ncmUubmV3RGF0YVN0b3JlSWQodmFsLCBtZXRhKTsKICAgICAgICAgICAgfSBl\nbHNlIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURh\ndGEuSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIGNscykpOwoK\nICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZwogICAgICAg\nICAgICAgICAgJiYgIV9jb25mLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgp\nLmdldFN0cmljdElkZW50aXR5VmFsdWVzKCkpCiAgICAgICAgICAgIHsKICAg\nICAgICAgICAgICAgIC8vIGJ1ZyAjOTU4OiBzZWN0aW9uIDkuNiBvZiB0aGUg\nSkRPIDEuMC4xIHNwZWNpZmljYXRpb24gc3RhdGVzCiAgICAgICAgICAgICAg\nICAvLyB0aGF0IGEgZmF0YWwgaW50ZXJuYWwgZXhjZXB0aW9uIHNob3VsZCBi\nZSB0aHJvd24gd2hlbgogICAgICAgICAgICAgICAgLy8gaW52b2tpbmcgdGhp\ncyBtZXRob2Qgb24gYW4gYWJzdHJhY3QgY2xhc3MKICAgICAgICAgICAgICAg\nIGlmIChNb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkp\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKF9sb2MuZ2V0KCJvYmplY3RpZC1hYnN0cmFjdCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNscykpOwogICAgICAgICAgICAgICAgcmV0dXJuIFBD\nUmVnaXN0cnkubmV3T2JqZWN0SWQoY2xzLCAoU3RyaW5nKSB2YWwpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAobWV0YS5nZXRPYmplY3RJZFR5\ncGUoKS5pc0Fzc2lnbmFibGVGcm9tKHZhbC5nZXRDbGFzcygpKSkgewogICAg\nICAgICAgICAgICAgaWYgKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYg\nbWV0YS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgT2JqZWN0SWQoY2xzLCB2YWwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nT2JqZWN0W10gYXJyID0gKHZhbCBpbnN0YW5jZW9mIE9iamVjdFtdKSA/IChP\nYmplY3RbXSkgdmFsCiAgICAgICAgICAgICAgICA6IG5ldyBPYmplY3RbXXsg\ndmFsIH07CiAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5mcm9t\nUEtWYWx1ZXMoYXJyLCBtZXRhKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKENsYXNzQ2FzdEV4Y2VwdGlvbiBjY2UpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1pZC12\nYWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpLmdl\ndE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoY2NlKTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3Ig\ndGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAgcHJpdmF0ZSBTdGF0ZU1hbmFn\nZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9pZCwgYm9vbGVh\nbiBjb3B5KSB7CiAgICAgICAgLy8gc2VlIGlmIHdlJ3JlIGluIHRoZSBwcm9j\nZXNzIG9mIGxvYWRpbmcgdGhpcyBvaWQgaW4gYSBsb2FkQWxsIGNhbGwKICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGlmIChfbG9hZGlu\nZyAhPSBudWxsKSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlcklt\ncGwpIF9sb2FkaW5nLmdldChvaWQpOwogICAgICAgICAgICBpZiAoc20gIT0g\nbnVsbCAmJiBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgIH0KCiAgICAgICAg\nLy8gZmluZCBtZXRhZGF0YSBmb3IgdGhlIG9pZAogICAgICAgIENsYXNzIHBj\nVHlwZSA9IF9zdG9yZS5nZXRNYW5hZ2VkVHlwZShvaWQpOwogICAgICAgIE1l\ndGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9jb25mLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nOwogICAgICAgIGlmIChwY1R5cGUgIT0gbnVsbCkKICAgICAgICAgICAgbWV0\nYSA9IHJlcG9zLmdldE1ldGFEYXRhKHBjVHlwZSwgX2xvYWRlciwgdHJ1ZSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBtZXRhID0gcmVwb3MuZ2V0TWV0\nYURhdGEob2lkLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgLy8gY29weSB0\naGUgb2lkIGlmIG5lZWRlZAogICAgICAgIGlmIChjb3B5ICYmIF9jb21wYXQu\nZ2V0Q29weU9iamVjdElkcygpKSB7CiAgICAgICAgICAgIGlmIChtZXRhLmdl\ndElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJ\nT04pCiAgICAgICAgICAgICAgICBvaWQgPSBBcHBsaWNhdGlvbklkcy5jb3B5\nKG9pZCwgbWV0YSk7CiAgICAgICAgICAgIGVsc2UgaWYgKG1ldGEuZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9VTktOT1dOKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm1ldGEtdW5rbm93bmlkIiwgbWV0YSkpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBvaWQgPSBfc3RvcmUuY29weURhdGFTdG9yZUlkKG9p\nZCwgbWV0YSk7CiAgICAgICAgfQoKICAgICAgICBzbSA9IG5ld1N0YXRlTWFu\nYWdlckltcGwob2lkLCBtZXRhKTsKICAgICAgICBzbS5zZXRPYmplY3RJZChv\naWQpOwogICAgICAgIHJldHVybiBzbTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBvaWQgYW5k\nIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2Vy\nSW1wbCBuZXdTdGF0ZU1hbmFnZXJJbXBsKE9iamVjdCBvaWQsCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdGF0\nZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBUcmFuc2FjdGlvbgogICAgLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIHZvaWQgYmVnaW4oKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nImFjdGl2ZSIpKTsKICAgICAgICAgICAgX2ZhY3Rvcnkuc3luY1dpdGhNYW5h\nZ2VkVHJhbnNhY3Rpb24odGhpcywgdHJ1ZSk7CiAgICAgICAgICAgIGJlZ2lu\nSW50ZXJuYWwoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBOb3RpZnkgdGhlIHN0b3JlIG1hbmFnZXIgb2YgYSB0cmFuc2FjdGlvbi4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGJlZ2luSW50ZXJuYWwoKSB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFu\nc2FjdGlvbihfb3B0aW1pc3RpYyk7CiAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX0FDVElWRTsKCiAgICAgICAgICAgIC8vIHN0YXJ0IGxvY2tpbmcKICAg\nICAgICAgICAgaWYgKCFfb3B0aW1pc3RpYykgewogICAgICAgICAgICAgICAg\nX2ZjLnNldFJlYWRMb2NrTGV2ZWwoX2NvbmYuZ2V0UmVhZExvY2tMZXZlbENv\nbnN0YW50KCkpOwogICAgICAgICAgICAgICAgX2ZjLnNldFdyaXRlTG9ja0xl\ndmVsKF9jb25mLmdldFdyaXRlTG9ja0xldmVsQ29uc3RhbnQoKSk7CiAgICAg\nICAgICAgICAgICBfZmMuc2V0TG9ja1RpbWVvdXQoX2NvbmYuZ2V0TG9ja1Rp\nbWVvdXQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2xtLmJlZ2lu\nVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIGlmIChfdHJhbnNFdmVudE1h\nbmFnZXIuaGFzQmVnaW5MaXN0ZW5lcnMoKSkKICAgICAgICAgICAgICAgIGZp\ncmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMs\nCiAgICAgICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9C\nRUdJTiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCkpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgLy8gaWYg\nd2UgYWxyZWFkeSBzdGFydGVkIHRoZSB0cmFuc2FjdGlvbiwgZG9uJ3QgbGV0\nIGl0IGNvbW1pdAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgc2V0Um9sbGJhY2tPbmx5SW50\nZXJuYWwoKTsKICAgICAgICAgICAgdGhyb3cga2Uuc2V0RmF0YWwodHJ1ZSk7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5IHN0YXJ0ZWQgdGhlIHRyYW5zYWN0\naW9uLCBkb24ndCBsZXQgaXQgY29tbWl0CiAgICAgICAgICAgIGlmICgoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICBzZXRS\nb2xsYmFja09ubHlJbnRlcm5hbCgpOwogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24ocmUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51bGwpIHsKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdCA9IF9wZW5kaW5nLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0Lm5l\neHQoKTsKICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAg\nICAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAg\nICAgICAgc2V0RGlydHkoc20sIHRydWUpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIF9wZW5kaW5nID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYmVnaW5TdG9yZSgpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRU\ncmFuc2FjdGlvbk9wZXJhdGlvbigpOwogICAgICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAgICAg\nYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihmYWxzZSk7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQmVnaW4gYSBz\ndG9yZSBtYW5hZ2VyIHRyYW5zYWN0aW9uLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihib29sZWFuIG9w\ndGltaXN0aWMpIHsKICAgICAgICBpZiAoIW9wdGltaXN0aWMpIHsKICAgICAg\nICAgICAgcmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfc3RvcmUu\nYmVnaW4oKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfQUNU\nSVZFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChfY29ublJl\ndGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5fVFJBTlMpCiAgICAgICAgICAgICAg\nICByZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9zdG9yZS5iZWdp\nbk9wdGltaXN0aWMoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBFbmQgdGhlIGN1cnJlbnQgc3RvcmUgbWFuYWdlciB0cmFuc2FjdGlvbi4g\nVGhyb3dzIGFuCiAgICAgKiBleGNlcHRpb24gdG8gc2lnbmFsIGEgZm9yY2Vk\nIHJvbGxiYWNrIGFmdGVyIGZhaWxlZCBjb21taXQsIG90aGVyd2lzZQogICAg\nICogcmV0dXJucyBhbnkgZXhjZXB0aW9uIGVuY291bnRlcmVkIGR1cmluZyB0\naGUgZW5kIHByb2Nlc3MuCiAgICAgKi8KICAgIHByaXZhdGUgUnVudGltZUV4\nY2VwdGlvbiBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbihib29sZWFuIHJv\nbGxiYWNrKSB7CiAgICAgICAgYm9vbGVhbiBmb3JjZWRSb2xsYmFjayA9IGZh\nbHNlOwogICAgICAgIGJvb2xlYW4gcmVsZWFzZUNvbm4gPSBmYWxzZTsKICAg\nICAgICBSdW50aW1lRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NUT1JFX0FDVElW\nRSkgIT0gMCkgewogICAgICAgICAgICAgICAgcmVsZWFzZUNvbm4gPSBfY29u\nblJldGFpbk1vZGUgIT0gQ09OTl9SRVRBSU5fQUxXQVlTOwogICAgICAgICAg\nICAgICAgaWYgKHJvbGxiYWNrKQogICAgICAgICAgICAgICAgICAgIF9zdG9y\nZS5yb2xsYmFjaygpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIF9zdG9yZS5jb21taXQoKTsKICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VDb25uID0gX2Nvbm5SZXRhaW5N\nb2RlID09IENPTk5fUkVUQUlOX1RSQU5TOwogICAgICAgICAgICAgICAgX3N0\nb3JlLnJvbGxiYWNrT3B0aW1pc3RpYygpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIGlmICghcm9sbGJhY2spIHsKICAgICAgICAgICAgICAgIGZv\ncmNlZFJvbGxiYWNrID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRyeSB7IF9z\ndG9yZS5yb2xsYmFjaygpOyB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nMikge30KICAgICAgICAgICAgfQogICAgICAgICAgICBlcnIgPSByZTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nU1RPUkVfQUNUSVZFOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlbGVhc2VD\nb25uKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZWxl\nYXNlQ29ubmVjdGlvbigpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBpZiAoZXJyID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgZXJyID0gcmU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGlmIChmb3JjZWRSb2xsYmFjaykKICAg\nICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgIHJldHVybiBlcnI7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwoKICAgICAgICAgICAgamF2YXgu\ndHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAg\nICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNh\nY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJudWxsLXRyYW5zIikpOwoKICAgICAgICAgICAgLy8gdGhpcyBj\nb21taXQgb24gdGhlIHRyYW5zYWN0aW9uIHdpbGwgY2F1c2Ugb3VyCiAgICAg\nICAgICAgIC8vIGJlZm9yZUNvbXBsZXRpb24gbWV0aG9kIHRvIGJlIGludm9r\nZWQKICAgICAgICAgICAgdHJhbnMuY29tbWl0KCk7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJv\nciIpLCBlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xs\nYmFjaygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRp\nb24oKTsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0\naW9uIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5z\nYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAg\nIGlmICh0cmFucyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJhbnMucm9s\nbGJhY2soKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMt\nZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoX2xvZy5p\nc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShf\nbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGUpOwogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0\naW9uKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImFjdGl2ZSIpKTsKICAgICAg\nICAgICAgaWYgKCFfbWFuYWdlZCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLW5vdC1t\nYW5hZ2VkIikpOwogICAgICAgICAgICBpZiAoX2ZhY3Rvcnkuc3luY1dpdGhN\nYW5hZ2VkVHJhbnNhY3Rpb24odGhpcywgZmFsc2UpKSB7CiAgICAgICAgICAg\nICAgICBiZWdpbkludGVybmFsKCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdEFuZFJlc3Vt\nZSgpIHsKICAgICAgICBlbmRBbmRSZXN1bWUodHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcm9sbGJhY2tBbmRSZXN1bWUoKSB7CiAgICAgICAgZW5k\nQW5kUmVzdW1lKGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZW5k\nQW5kUmVzdW1lKGJvb2xlYW4gY29tbWl0KSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChj\nb21taXQpCiAgICAgICAgICAgICAgICBjb21taXQoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgcm9sbGJhY2soKTsKICAgICAgICAgICAg\nYmVnaW4oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gZ2V0Um9sbGJhY2tPbmx5KCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2Fj\ndGlvbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGltZS5nZXRUcmFu\nc2FjdGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAg\nICBpZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRyYW5zLmdldFN0YXR1cygpID09\nIFN0YXR1cy5TVEFUVVNfTUFSS0VEX1JPTExCQUNLOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNrT25seSgpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwogICAg\nICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbCgpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhlIGN1cnJlbnQgdHJh\nbnNhY3Rpb24gYXMgcm9sbGJhY2stb25seS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNldFJvbGxiYWNrT25seUludGVybmFsKCkgewogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9u\nIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0\naW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC10cmFucyIpKTsK\nICAgICAgICAgICAgdHJhbnMuc2V0Um9sbGJhY2tPbmx5KCk7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U2F2ZXBvaW50KFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24o\nKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgX3Nh\ndmVwb2ludHMuY29udGFpbnNLZXkobmFtZSkpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgic2F2ZXBvaW50LWV4\naXN0cyIsIG5hbWUpKTsKCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19GTFVTSEVEKSAhPSAwCiAgICAgICAgICAgICAgICAmJiAhX3NwbS5zdXBw\nb3J0c0luY3JlbWVudGFsRmx1c2goKSkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAg\nICAgICAgICAgICgic2F2ZXBvaW50LWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7\nCgogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmUgPSBfc3BtLm5l\nd1NhdmVwb2ludChuYW1lLCB0aGlzKTsKICAgICAgICAgICAgaWYgKF9zYXZl\ncG9pbnRzID09IG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgICAgICBzYXZlLnNhdmUoZ2V0VHJhbnNhY3Rpb25hbFN0YXRl\ncygpKTsKICAgICAgICAgICAgICAgIF9zYXZlcG9pbnRzID0gbmV3IExpbmtl\nZE1hcCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\naWYgKF9zYXZlcG9pbnRDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHNhdmUuc2F2ZShDb2xsZWN0aW9ucy5FTVBUWV9MSVNUKTsKICAgICAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2\nZShfc2F2ZXBvaW50Q2FjaGUpOwogICAgICAgICAgICAgICAgICAgIF9zYXZl\ncG9pbnRDYWNoZS5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF9zYXZlcG9pbnRzLnB1dChuYW1lLCBzYXZl\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxl\nYXNlU2F2ZXBvaW50KCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMg\nPT0gbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbGFz\ndHNhdmVwb2ludCIpKTsKICAgICAgICAgICAgcmVsZWFzZVNhdmVwb2ludCgo\nU3RyaW5nKSBfc2F2ZXBvaW50cy5nZXQKICAgICAgICAgICAgICAgIChfc2F2\nZXBvaW50cy5zaXplKCkgLSAxKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9pbnQoU3RyaW5nIHNhdmVwb2lu\ndCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoK\nICAgICAgICAgICAgaW50IGluZGV4ID0gKF9zYXZlcG9pbnRzID09IG51bGwp\nID8gLTEKICAgICAgICAgICAgICAgIDogX3NhdmVwb2ludHMuaW5kZXhPZihz\nYXZlcG9pbnQpOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXNhdmVwb2ludCIsIHNhdmVwb2ludCkpOwoKICAgICAgICAgICAgLy8gY2xl\nYXIgb2xkIGluIHJldmVyc2UKICAgICAgICAgICAgT3BlbkpQQVNhdmVwb2lu\ndCBzYXZlOwogICAgICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMuc2l6ZSgp\nID4gaW5kZXggKyAxKSB7CiAgICAgICAgICAgICAgICBzYXZlID0gKE9wZW5K\nUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92ZQogICAgICAgICAgICAg\nICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAgICAg\nICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMu\ncmVtb3ZlKGluZGV4KTsKICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKHRydWUp\nOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludENhY2hlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuY2xlYXIoKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja1RvU2F2\nZXBvaW50KCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgPT0gbnVs\nbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbGFzdHNhdmVw\nb2ludCIpKTsKICAgICAgICAgICAgcm9sbGJhY2tUb1NhdmVwb2ludCgoU3Ry\naW5nKSBfc2F2ZXBvaW50cy5nZXQKICAgICAgICAgICAgICAgIChfc2F2ZXBv\naW50cy5zaXplKCkgLSAxKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoU3RyaW5nIHNhdmVwb2lu\ndCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoK\nICAgICAgICAgICAgaW50IGluZGV4ID0gKF9zYXZlcG9pbnRzID09IG51bGwp\nID8gLTEKICAgICAgICAgICAgICAgIDogX3NhdmVwb2ludHMuaW5kZXhPZihz\nYXZlcG9pbnQpOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXNhdmVwb2ludCIsIHNhdmVwb2ludCkpOwoKICAgICAgICAgICAgLy8gY2xl\nYXIgb2xkIGluIHJldmVyc2UKICAgICAgICAgICAgT3BlbkpQQVNhdmVwb2lu\ndCBzYXZlOwogICAgICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMuc2l6ZSgp\nID4gaW5kZXggKyAxKSB7CiAgICAgICAgICAgICAgICBzYXZlID0gKE9wZW5K\nUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92ZQogICAgICAgICAgICAg\nICAgICAgIChfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAgICAg\nICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMu\ncmVtb3ZlKGluZGV4KTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzYXZlZCA9\nIHNhdmUucm9sbGJhY2soX3NhdmVwb2ludHMudmFsdWVzKCkpOwogICAgICAg\nICAgICBpZiAoX3NhdmVwb2ludENhY2hlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfc2F2ZXBvaW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgaWYg\nKF90cmFuc0NhY2hlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGJ1\naWxkIHVwIGEgbmV3IGNvbGxlY3Rpb24gb2Ygc3RhdGVzCiAgICAgICAgICAg\nICAgICBUcmFuc2FjdGlvbmFsQ2FjaGUgb2xkVHJhbnNDYWNoZSA9IF90cmFu\nc0NhY2hlOwogICAgICAgICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG5l\nd1RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNhY3Rpb25hbENhY2hlCiAgICAgICAg\nICAgICAgICAgICAgKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAgICAgIF90\ncmFuc0NhY2hlID0gbnVsbDsKCiAgICAgICAgICAgICAgICAvLyBjdXJyZW50\nbHkgdGhlcmUgaXMgdGhlIGFzc3VtcHRpb24gdGhhdCBpbmNyZW1lbnRhbAog\nICAgICAgICAgICAgICAgLy8gZmx1c2ggaXMgZWl0aGVyIGEpIG5vdCBhbGxv\nd2VkLCBvciBiKSByZXF1aXJlZAogICAgICAgICAgICAgICAgLy8gcHJlLXNh\ndmVwb2ludC4gIHRoaXMgc29sdmVzIGEgbnVtYmVyIG9mIGlzc3VlcyBpbmNs\ndWRpbmcKICAgICAgICAgICAgICAgIC8vIHN0b3JpbmcgZmx1c2hlZCBzdGF0\nZXMgYXMgd2VsbCBhcyBPSUQgaGFuZGxpbmcuCiAgICAgICAgICAgICAgICAv\nLyBpZiBmdXR1cmUgcGx1Z2lucyBkbyBub3QgZm9sbG93IHRoaXMsIHdlIG5l\nZWQgdG8gY2FjaGUKICAgICAgICAgICAgICAgIC8vIG1vcmUgaW5mbyBwZXIg\nc3RhdGUKICAgICAgICAgICAgICAgIFNhdmVwb2ludEZpZWxkTWFuYWdlciBm\nbTsKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNhdmVkLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgZm0g\nPSAoU2F2ZXBvaW50RmllbGRNYW5hZ2VyKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICAgICAgICAgIHNtID0gZm0uZ2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAg\nICAgICAgICAgICAgICAgc20ucm9sbGJhY2tUb1NhdmVwb2ludChmbSk7CiAg\nICAgICAgICAgICAgICAgICAgb2xkVHJhbnNDYWNoZS5yZW1vdmUoc20pOwog\nICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIG5ld1RyYW5zQ2FjaGUuYWRkRGlydHkoc20pOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3VHJhbnNDYWNoZS5hZGRDbGVhbihzbSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9sZFRy\nYW5zQ2FjaGUuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrKCk7CiAgICAg\nICAgICAgICAgICAgICAgcmVtb3ZlRnJvbVRyYW5zYWN0aW9uKHNtKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9sZFRyYW5zQ2FjaGUu\nY2xlYXIoKTsKICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlID0gbmV3VHJh\nbnNDYWNoZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZmx1c2goKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gcmV0dXJuIHNpbGVudGx5IGlmIG5vIHRyYW5zIGlzIGFjdGl2ZSwgb3Ig\naWYgdGhpcyBpcyBhIHJlZW50cmFudAogICAgICAgICAgICAvLyBjYWxsLCB3\naGljaCBjYW4gaGFwcGVuIGlmIHRoZSBzdG9yZSBtYW5hZ2VyIHRyaWVzIHRv\nIGdldCBhbgogICAgICAgICAgICAvLyBhdXRvLWluYyBvaWQgZHVyaW5nIGZs\ndXNoCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDAKICAgICAgICAgICAgICAgIHx8IChfZmxhZ3MgJiBGTEFHX1NUT1JFX0ZM\nVVNISU5HKSAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAgICAgLy8gbWFrZSBzdXJlIHRoZSBydW50aW1lIHN1cHBvcnRzIGl0CiAg\nICAgICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRh\naW5zKF9jb25mLk9QVElPTl9JTkNfRkxVU0gpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAg\nICAgICAgICAgICAgICAgKCJpbmNyZW1lbnRhbC1mbHVzaC1ub3Qtc3VwcG9y\ndGVkIikpOwogICAgICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAm\nJiAhX3NhdmVwb2ludHMuaXNFbXB0eSgpCiAgICAgICAgICAgICAgICAmJiAh\nX3NwbS5zdXBwb3J0c0luY3JlbWVudGFsRmx1c2goKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICgic2F2ZXBvaW50LWZsdXNoLW5vdC1zdXBw\nb3J0ZWQiKSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nZmx1c2hTYWZlKEZMVVNIX0lOQyk7CiAgICAgICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBv\nbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkgYmUgaW4gaW5jb25zaXN0ZW50\nIHN0YXRlCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHkoKTsKICAg\nICAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUpOwogICAgICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgICAgICAvLyByb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBt\nYXkgYmUgaW4gaW5jb25zaXN0ZW50IHN0YXRlCiAgICAgICAgICAgICAgICBz\nZXRSb2xsYmFja09ubHkoKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcmVGbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNI\nX0xPR0lDQUwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB2YWxpZGF0ZUNoYW5nZXMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgbm8gdHJh\nbnMsIGp1c3QgcmV0dXJuOyBpZiBhY3RpdmUgZGF0YXN0b3JlIHRyYW5zLCBm\nbHVzaAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAg\nICAgICAgICBmbHVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRp\nbWUgc3VwcG9ydHMgaW5jIGZsdXNoCiAgICAgICAgICAgIGlmICghX2NvbmYu\nc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNf\nRkxVU0gpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVk\nRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbmNy\nZW1lbnRhbC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9ST0xMQkFD\nSyk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNBY3RpdmUoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFH\nX0FDVElWRSkgIT0gMDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNTdG9yZUFjdGl2ZSgpIHsKICAgICAgICAvLyB3ZSBuZWVk\nIHRvIGxvY2sgaGVyZSwgYmVjYXVzZSB3ZSBtaWdodCBiZSBpbiB0aGUgbWlk\nZGxlIG9mIGFuCiAgICAgICAgLy8gYXRvbWljIHRyYW5zYWN0aW9uIHByb2Nl\nc3MgKGUuZy4sIGNvbW1pdEFuZFJlc3VtZSkKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBj\ndXJyZW50IHRyYW5zYWN0aW9uIGlzIGVuZGluZywgaS5lLiBpbiB0aGUgMm5k\nIHBoYXNlCiAgICAgKiBvZiBhIGNvbW1pdCBvciByb2xsYmFjawogICAgICov\nCiAgICBib29sZWFuIGlzVHJhbnNhY3Rpb25FbmRpbmcoKSB7CiAgICAgICAg\ncmV0dXJuIChfZmxhZ3MgJiBGTEFHX1RSQU5TX0VORElORykgIT0gMDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBiZWdpbk9wZXJhdGlvbihib29sZWFu\nIHN5bmNUcmFucykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBpZiAoc3lu\nY1RyYW5zICYmIF9vcGVyYXRpb25Db3VudCA9PSAwICYmIF9zeW5jTWFuYWdl\nZAogICAgICAgICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwKQogICAgICAgICAgICAgICAgc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rp\nb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCsrID09\nIDE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE1hcmsgdGhlIG9wZXJhdGlvbiBvdmVyLiBJZiBvdXRlcm1vc3QgY2FsbGVy\nIG9mIHN0YWNrLCByZXR1cm5zIHRydWUKICAgICAqIGFuZCB3aWxsIGRldGFj\naCBtYW5hZ2VlZCBpbnN0YW5jZXMgaWYgbmVjZXNzYXJ5LgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBlbmRPcGVyYXRpb24oKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA9PSAxICYmIChf\nYXV0b0RldGFjaCAmIERFVEFDSF9OT05UWFJFQUQpICE9IDAKICAgICAgICAg\nICAgICAgICYmIChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkgewogICAg\nICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA8IDEpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsK\nICAgICAgICAgICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCA9PSAxOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX29wZXJh\ndGlvbkNvdW50LS07CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQg\nPT0gMCkKICAgICAgICAgICAgICAgIF9vcGVyYXRpbmcuY2xlYXIoKTsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBTeW5jaHJvbml6YXRpb24gZ2V0U3luY2hyb25pemF0aW9uKCkgewogICAg\nICAgIHJldHVybiBfc3luYzsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRT\neW5jaHJvbml6YXRpb24oU3luY2hyb25pemF0aW9uIHN5bmMpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX3N5bmMgPSBzeW5jOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBTeW5jaHJvbml6YXRp\nb24gaW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGJlZm9yZUNv\nbXBsZXRpb24oKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHVzZXItc3VwcGxpZWQgc3lu\nY2hyb25pemF0aW9uCiAgICAgICAgICAgIGlmIChfc3luYyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgX3N5bmMuYmVmb3JlQ29tcGxldGlvbigpOwoKICAg\nICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0NPTU1JVCk7CiAgICAgICAgfSBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50\ncmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGtlKTsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5k\nLXRyYW5zLWVycm9yIiksIHJlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0\nb3JlRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYWZ0ZXJDb21wbGV0aW9uKGludCBzdGF0dXMpIHsKICAgICAg\nICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX1RSQU5TX0VORElORzsKICAgICAgICAgICAgZW5k\nVHJhbnNhY3Rpb24oc3RhdHVzKTsKICAgICAgICAgICAgaWYgKF9zeW5jICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24o\nc3RhdHVzKTsKCiAgICAgICAgICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRB\nQ0hfQ09NTUlUKSAhPSAwKQogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50\nZXJuYWwobnVsbCk7CgogICAgICAgICAgICAvLyBpbiBhbiBlZSBjb250ZXh0\nLCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHVzZXIgdHJpZWQgdG8gY2xvc2UK\nICAgICAgICAgICAgLy8gdXMgYnV0IHdlIGRpZG4ndCBhY3R1YWxseSBjbG9z\nZSBiZWNhdXNlIHdlIHdlcmUgd2FpdGluZyBvbiB0aGlzCiAgICAgICAgICAg\nIC8vIHRyYW5zYWN0aW9uOyBpZiB0aGF0J3MgdHJ1ZSwgdGhlbiBjbG9zZSBu\nb3cKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0NMT1NFX0lOVk9L\nRUQpICE9IDAKICAgICAgICAgICAgICAgICYmIF9jb21wYXQuZ2V0Q2xvc2VP\nbk1hbmFnZWRDb21taXQoKSkKICAgICAgICAgICAgICAgIGZyZWUoKTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2Up\nOwogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19BQ1RJVkU7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfVFJBTlNfRU5ESU5HOwoKICAgICAgICAgICAgLy8gZXZl\nbnQgbWFuYWdlciBudWxsZWQgaWYgZnJlZWQgYnJva2VyCiAgICAgICAgICAg\nIGlmIChfdHJhbnNFdmVudE1hbmFnZXIgIT0gbnVsbCAKICAgICAgICAgICAg\nICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkg\newogICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRy\nYW5zYWN0aW9uRXZlbnQodGhpcywKICAgICAgICAgICAgICAgICAgICBzdGF0\ndXMgPT0gU3RhdHVzLlNUQVRVU19DT01NSVRURUQKICAgICAgICAgICAgICAg\nICAgICAgICAgPyBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NPTU1JVF9DT01Q\nTEVURQogICAgICAgICAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZl\nbnQuQUZURVJfUk9MTEJBQ0tfQ09NUExFVEUsCiAgICAgICAgICAgICAgICAg\nICAgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCkpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBGbHVzaCBzYWZlbHksIGNhdGNoaW5nIHJlZW50cmFu\ndCBjYWxscy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoU2FmZShp\nbnQgcmVhc29uKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZMVVNI\nSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWVudHJhbnQtZmx1c2giKSk7CgogICAg\nICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNISU5HOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGZsdXNoKHJlYXNvbik7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNISU5HOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSB0cmFuc2FjdGlv\nbmFsIHN0YXRlIHRvIHRoZSBkYXRhIHN0b3JlLiBTdWJjbGFzc2VzIHRoYXQK\nICAgICAqIGN1c3RvbWl6ZSBjb21taXQgYmVoYXZpb3Igc2hvdWxkIG92ZXJy\naWRlIHRoaXMgbWV0aG9kLiBUaGUgbWV0aG9kCiAgICAgKiBhc3N1bWVzIHRo\nYXQgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgaXMgbG9ja2VkLCBpcyBub3Qg\nY2xvc2VkLAogICAgICogYW5kIGhhcyBhbiBhY3RpdmUgdHJhbnNhY3Rpb24u\nCiAgICAgKgogICAgICogQHBhcmFtIHJlYXNvbiBvbmUgb2Yge0BsaW5rICNG\nTFVTSF9JTkN9LCB7QGxpbmsgI0ZMVVNIX0NPTU1JVH0sCiAgICAgKiB7QGxp\nbmsgI0ZMVVNIX1JPTExCQUNLfSwgb3Ige0BsaW5rICNGTFVTSF9MT0dJQ0FM\nfQogICAgICogQHNpbmNlIDAuMi41CiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGZsdXNoKGludCByZWFzb24pIHsKICAgICAgICAvLyB0aGlzIHdpbGwg\nZW5saXN0IHByb3hpZWQgc3RhdGVzIGFzIG5lY2Vzc2FyeSBzbyB3ZSBrbm93\nIHdoZXRoZXIgd2UKICAgICAgICAvLyBoYXZlIGFueXRoaW5nIHRvIGZsdXNo\nCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsID0gZ2V0VHJhbnNh\nY3Rpb25hbFN0YXRlcygpOwoKICAgICAgICAvLyBkbyB3ZSBhY3R1YWxseSBo\nYXZlIHRvIGZsdXNoPyAgb25seSBpZiBvdXIgZmxhZ3Mgc2F5IHNvLCBvciBp\nZgogICAgICAgIC8vIHdlIGhhdmUgdHJhbnNhY3Rpb24gbGlzdGVuZXJzIHRo\nYXQgbmVlZCB0byBiZSBpbnZva2VkIGZvciBjb21taXQKICAgICAgICAvLyAo\nbm8gbmVlZCB0byBpbnZva2UgdGhlbSBvbiBpbmMgZmx1c2ggaWYgbm90aGlu\nZyBpcyBkaXJ0eSkuICB3ZQogICAgICAgIC8vIHNwZWNpYWwgY2FzZSB0aGUg\ncmVtb3RlIGNvbW1pdCBsaXN0ZW5lciB1c2VkIGJ5IHRoZSBkYXRhY2FjaGUg\nY2F1c2UKICAgICAgICAvLyB3ZSBrbm93IGl0IGRvZXNuJ3QgcmVxdWlyZSB0\naGUgY29tbWl0IGV2ZW50IHdoZW4gbm90aGluZyBjaGFuZ2VzCiAgICAgICAg\nYm9vbGVhbiBmbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVE\nKSAhPSAwOwogICAgICAgIGJvb2xlYW4gbGlzdGVuZXJzID0gKF90cmFuc0V2\nZW50TWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpCiAgICAgICAgICAgIHx8\nIF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAg\nICAgICAgJiYgKChfZmxhZ3MgJiBGTEFHX1JFTU9URV9MSVNURU5FUikgPT0g\nMAogICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuZ2V0TGlzdGVu\nZXJzKCkuc2l6ZSgpID4gMSk7CiAgICAgICAgaWYgKCFmbHVzaCAmJiAocmVh\nc29uICE9IEZMVVNIX0NPTU1JVCB8fCAhbGlzdGVuZXJzKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsK\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVTVE9SSU5HOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChmbHVzaCkgewogICAgICAgICAgICAgICAg\nLy8gY2FsbCBwcmUgc3RvcmUgb24gYWxsIGN1cnJlbnRseSB0cmFuc2FjdGlv\nbmFsIG9ianMKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\ndHJhbnNhY3Rpb25hbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAg\nICAgICAgICAgICAgICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0\nKCkpLmJlZm9yZUZsdXNoKHJlYXNvbiwgX2NhbGwpOwogICAgICAgICAgICAg\nICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaG9wZWZ1bGx5IG5vdyBhbGwg\nZGVwZW5kZW50IGluc3RhbmNlcyB0aGF0IGFyZSBnb2luZyB0byBlbmQKICAg\nICAgICAgICAgLy8gdXAgcmVmZXJlbmNlZCBoYXZlIGJlZW4gbWFya2VkIGFz\nIHN1Y2g7IGRlbGV0ZSB1bnJlZmVkCiAgICAgICAgICAgIC8vIGRlcGVuZGVu\ndHMKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVSRUZERUxFVElORzsK\nICAgICAgICAgICAgaWYgKGZsdXNoICYmIF9kZXJlZkNhY2hlICE9IG51bGwg\nJiYgIV9kZXJlZkNhY2hlLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBkZWxldGVEZXJl\nZigoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSk7CiAgICAgICAgICAg\nICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVhc29uICE9IEZMVVNI\nX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIG5vIGRhdGFzdG9y\nZSB0cmFuc2FjdGlvbiwgc3RhcnQgb25lOyBldmVuIGlmIHdlIGRvbid0CiAg\nICAgICAgICAgICAgICAvLyB0aGluayB3ZSdsbCBuZWVkIHRvIGZsdXNoIGF0\nIHRoaXMgcG9pbnQsIG91ciB0cmFuc2FjdGlvbgogICAgICAgICAgICAgICAg\nLy8gbGlzdGVuZXJzIG1pZ2h0IGludHJvZHVjZSBzb21lIGRpcnR5IG9iamVj\ndHMgb3IgaW50ZXJhY3QKICAgICAgICAgICAgICAgIC8vIGRpcmVjdGx5IHdp\ndGggdGhlIGRhdGFiYXNlCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfU1RPUkVfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICAgICAgICAg\nIGJlZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oZmFsc2UpOwoKICAgICAg\nICAgICAgICAgIGlmICgoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlz\ndGVuZXJzKCkKICAgICAgICAgICAgICAgICAgICB8fCBfdHJhbnNFdmVudE1h\nbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAgICAgICAgICAgICAg\nJiYgKGZsdXNoIHx8IHJlYXNvbiA9PSBGTFVTSF9DT01NSVQpKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gZmlyZSBldmVudHMKICAgICAgICAgICAgICAg\nICAgICBtb2JqcyA9IG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbih0cmFu\nc2FjdGlvbmFsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09\nIEZMVVNIX0NPTU1JVAogICAgICAgICAgICAgICAgICAgICAgICAmJiBfdHJh\nbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5z\nYWN0aW9uRXZlbnQodGhpcywgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBUcmFuc2FjdGlvbkV2ZW50LkJFRk9SRV9DT01NSVQsIG1vYmpzLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRh\ndGVkQ2xzcywgX2RlbGV0ZWRDbHNzKSk7CgogICAgICAgICAgICAgICAgICAg\nICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2FjdGlvbmFsLCByZWFzb24pOwog\nICAgICAgICAgICAgICAgICAgICAgICBmbHVzaCA9IChfZmxhZ3MgJiBGTEFH\nX0ZMVVNIX1JFUVVJUkVEKSAhPSAwOwogICAgICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGZsdXNoICYmIF90cmFuc0V2ZW50\nTWFuYWdlci5oYXNGbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlv\nbkV2ZW50KHRoaXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJh\nbnNhY3Rpb25FdmVudC5CRUZPUkVfRkxVU0gsIG1vYmpzLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xz\ncywgX2RlbGV0ZWRDbHNzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoQWRkaXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfUFJFU1RPUklORzsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX0RFUkVGREVMRVRJTkc7CiAgICAgICAgICAgIF90cmFuc0FkZGl0\naW9ucyA9IG51bGw7CiAgICAgICAgICAgIF9kZXJlZkFkZGl0aW9ucyA9IG51\nbGw7CgogICAgICAgICAgICAvLyBhbHNvIGNsZWFyIGRlcmVmZWQgc2V0OyB0\naGUgZGVsZXRlcyBoYXZlIGJlZW4gcmVjb3JkZWQKICAgICAgICAgICAgaWYg\nKF9kZXJlZkNhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGVyZWZD\nYWNoZS5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAgLy8gZmx1c2ggdG8g\nc3RvcmUgbWFuYWdlcgogICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9\nIEZMVVNIX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX1NUT1JFX0ZMVVNISU5HOwogICAgICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywKICAgICAgICAgICAgICAgICAgICBuZXdGbHVzaEV4Y2Vw\ndGlvbihfc3RvcmUuZmx1c2godHJhbnNhY3Rpb25hbCkpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19TVE9SRV9GTFVTSElORzsKCiAgICAgICAgICAgIGlmIChyZWFz\nb24gPT0gRkxVU0hfUk9MTEJBQ0spCiAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbih0cnVl\nKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJ\nQ0FMKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIX1JF\nUVVJUkVEOwoKICAgICAgICAgICAgLy8gbWFyayBzdGF0ZXMgYXMgZmx1c2hl\nZAogICAgICAgICAgICBpZiAoZmx1c2gpIHsKICAgICAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFn\nZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSBtYXkgaGF2\nZSBiZWNvbWUgdHJhbnNpZW50LCBzdWNoIGFzIGlmCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGl0IGlzIGVtYmVkZGVkIGFuZCB0aGUgb3duZXIgaGFz\nIGJlZW4gZGVsZXRlZCBkdXJpbmcKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gdGhpcyBmbHVzaCBwcm9jZXNzOyBidWcgIzExMDAKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRS\nQU5TSUVOVCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJGbHVzaChyZWFz\nb24pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09IEZM\nVVNIX0lOQykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYg\nbm90IGFib3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hlIGZvciBjb21taXQgCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbnl3YXksIHJlLWNhY2hl\nIGRpcnR5IG9iamVjdHMgd2l0aCBkZWZhdWx0IHNvZnQKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHJlZnM7IHdlIGRvbid0IG5lZWQgaGFyZCBy\nZWZzIG5vdyB0aGF0IHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNtLnByb3h5RmllbGRzKHRydWUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmZsdXNoZWQo\nc20pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyB0byBz\naG9ydGN1dCBsaXN0ZW5lcnMgb24gZmFpbAogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwoKICAgICAgICBpZiAoZmx1c2gg\nJiYgcmVhc29uICE9IEZMVVNIX1JPTExCQUNLICYmIHJlYXNvbiAhPSBGTFVT\nSF9MT0dJQ0FMCiAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5o\nYXNGbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIGZpcmVUcmFuc2Fj\ndGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAg\nICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0ZMVVNILCBtb2Jqcywg\nX3BlcnNpc3RlZENsc3MsCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3Ms\nIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEZsdXNoIG5ld2x5LXRyYW5zYWN0aW9uYWwgb2JqZWN0cy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoQWRkaXRpb25zKENvbGxlY3Rpb24g\ndHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikgewogICAgICAgIGJvb2xlYW4g\nbG9vcDsKICAgICAgICBkbyB7CiAgICAgICAgICAgIC8vIGZsdXNoIG5ldyB0\ncmFuc2FjdGlvbmFsIGluc3RhbmNlczsgbm90ZSBsb2dpY2FsIG9yCiAgICAg\nICAgICAgIGxvb3AgPSBmbHVzaFRyYW5zQWRkaXRpb25zKHRyYW5zYWN0aW9u\nYWwsIHJlYXNvbikKICAgICAgICAgICAgICAgIHwgZGVsZXRlRGVyZWZBZGRp\ndGlvbnMoX2RlcmVmQ2FjaGUpOwogICAgICAgIH0gd2hpbGUgKGxvb3ApOwog\nICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggdHJhbnNhY3Rpb25hbCBhZGRp\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBmbHVzaFRyYW5z\nQWRkaXRpb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNv\nbikgewogICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCB8fCBf\ndHJhbnNBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIGtlZXAgbG9jYWwgdHJhbnNhY3Rpb25hbCBs\naXN0IGNvcHkgdXAgdG8gZGF0ZQogICAgICAgIHRyYW5zYWN0aW9uYWwuYWRk\nQWxsKF90cmFuc0FkZGl0aW9ucyk7CgogICAgICAgIC8vIGNvcHkgdGhlIGNo\nYW5nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRoZSBuZXh0IGl0ZXJhdGlv\nbgogICAgICAgIFN0YXRlTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3RhdGVN\nYW5hZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMuCiAgICAgICAgICAgIHRv\nQXJyYXkobmV3IFN0YXRlTWFuYWdlckltcGxbX3RyYW5zQWRkaXRpb25zLnNp\nemUoKV0pOwogICAgICAgIF90cmFuc0FkZGl0aW9ucy5jbGVhcigpOwoKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgc3RhdGVzW2ldLmJlZm9yZUZsdXNoKHJlYXNvbiwgX2Nh\nbGwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAg\nICogRGVsZXRlIG5ldyBkZXJlZmVyZW5jZWQgb2JqZWN0cy4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGRlbGV0ZURlcmVmQWRkaXRpb25zKENvbGxl\nY3Rpb24gZGVyZWZzKSB7CiAgICAgICAgaWYgKF9kZXJlZkFkZGl0aW9ucyA9\nPSBudWxsIHx8IF9kZXJlZkFkZGl0aW9ucy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gcmVtZW1iZXIgdGhlc2Ug\nYWRkaXRpb25zIGluIGNhc2Ugb25lIGJlY29tZXMgZGVyZWZlZCBhZ2FpbiBs\nYXRlcgogICAgICAgIGRlcmVmcy5hZGRBbGwoX2RlcmVmQWRkaXRpb25zKTsK\nCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbFtdIHN0YXRlcyA9IChTdGF0ZU1h\nbmFnZXJJbXBsW10pIF9kZXJlZkFkZGl0aW9ucy4KICAgICAgICAgICAgdG9B\ncnJheShuZXcgU3RhdGVNYW5hZ2VySW1wbFtfZGVyZWZBZGRpdGlvbnMuc2l6\nZSgpXSk7CiAgICAgICAgX2RlcmVmQWRkaXRpb25zLmNsZWFyKCk7CgogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBkZWxldGVEZXJlZihzdGF0ZXNbaV0pOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlIGEgZGVy\nZWZlcmVuY2VkIGRlcGVuZGVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGRlbGV0ZURlcmVmKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBp\nbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0RF\nTEVURSwKICAgICAgICAgICAgc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIHNt\nLCBudWxsKTsKICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pICE9IDApCiAgICAgICAgICAgIHNtLmRlbGV0ZSgpOwogICAgICAg\nIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDAp\nCiAgICAgICAgICAgIHNtLmNhc2NhZGVEZWxldGUoX2NhbGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBhY3Rpb24gdG8gdGFrZSBi\nYXNlZCBvbiB0aGUgdXNlcidzIGdpdmVuIGNhbGxiYWNrcyBhbmQKICAgICAq\nIG91ciBpbXBsaWNpdCBiZWhhdmlvci4KICAgICAqLwogICAgcHJpdmF0ZSBp\nbnQgcHJvY2Vzc0FyZ3VtZW50KGludCBvcCwgT2JqZWN0IG9iaiwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKGNhbGwgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9wLCBvYmosIHNtKTsKICAgICAgICBp\nZiAoX2NhbGwgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9jYWxsLnBy\nb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7CiAgICAgICAgcmV0dXJuIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4gfCBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IHRoZSBwcm9wZXIgZXhjZXB0\naW9uIGJhc2VkIG9uIHRoZSBnaXZlbiBzZXQgb2YgZmx1c2ggZXJyb3JzLCBv\ncgogICAgICogZG8gbm90aGluZyBpZiBubyBlcnJvcnMgb2NjdXJyZWQuCiAg\nICAgKi8KICAgIHByaXZhdGUgT3BlbkpQQUV4Y2VwdGlvbiBuZXdGbHVzaEV4\nY2VwdGlvbihDb2xsZWN0aW9uIGV4Y2VwcykgewogICAgICAgIGlmIChleGNl\ncHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgVGhyb3dhYmxlW10gdCA9IChUaHJvd2Fi\nbGVbXSkgZXhjZXBzLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBUaHJvd2Fi\nbGVbZXhjZXBzLnNpemUoKV0pOwogICAgICAgIExpc3QgZmFpbGVkID0gbmV3\nIEFycmF5TGlzdCh0Lmxlbmd0aCk7CgogICAgICAgIC8vIGNyZWF0ZSBmYXRh\nbCBleGNlcHRpb24gd2l0aCBuZXN0ZWQgZXhjZXB0aW9ucyBmb3IgYWxsIHRo\nZSBmYWlsZWQKICAgICAgICAvLyBvYmplY3RzOyBpZiBhbGwgT0wgZXhjZXB0\naW9ucywgdGhyb3cgYSB0b3AtbGV2ZWwgT0wgZXhjZXB0aW9uCiAgICAgICAg\nYm9vbGVhbiBvcHQgPSB0cnVlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBv\ncHQgJiYgaSA8IHQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgb3B0ID0g\ndFtpXSBpbnN0YW5jZW9mIE9wdGltaXN0aWNFeGNlcHRpb247CiAgICAgICAg\nICAgIGlmIChvcHQpIHsKICAgICAgICAgICAgICAgIE9iamVjdCBmID0gKChP\ncHRpbWlzdGljRXhjZXB0aW9uKSB0W2ldKS5nZXRGYWlsZWRPYmplY3QoKTsK\nICAgICAgICAgICAgICAgIGlmIChmICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgZmFpbGVkLmFkZChmKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAob3B0ICYmICFmYWlsZWQuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24oZmFpbGVkLCB0\nKTsKICAgICAgICBpZiAob3B0KQogICAgICAgICAgICByZXR1cm4gbmV3IE9w\ndGltaXN0aWNFeGNlcHRpb24odCk7CiAgICAgICAgcmV0dXJuIG5ldyBTdG9y\nZUV4Y2VwdGlvbihfbG9jLmdldCgicm9sbGVkLWJhY2siKSkuCiAgICAgICAg\nICAgIHNldE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0YWwodHJ1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGhlIGN1cnJlbnQgdHJhbnNhY3Rp\nb24sIG1ha2luZyBhcHByb3ByaWF0ZSBzdGF0ZSB0cmFuc2l0aW9ucy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZW5kVHJhbnNhY3Rpb24oaW50IHN0\nYXR1cykgewogICAgICAgIC8vIGlmIGEgZGF0YSBzdG9yZSB0cmFuc2FjdGlv\nbiB3YXMgaW4gcHJvZ3Jlc3MsIGRvIHRoZQogICAgICAgIC8vIGFwcHJvcHJp\nYXRlIHRyYW5zYWN0aW9uIGNoYW5nZQogICAgICAgIGJvb2xlYW4gcm9sbGJh\nY2sgPSBzdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19DT01NSVRURUQ7CiAgICAg\nICAgTGlzdCBleGNlcHMgPSBudWxsOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFu\nc2FjdGlvbihyb2xsYmFjaykpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgcm9sbGJhY2sgPSB0cnVlOwog\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCByZSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBnbyBiYWNrIHRvIGRlZmF1bHQgbm9uZSBsb2NrIGxl\ndmVsCiAgICAgICAgX2ZjLnNldFJlYWRMb2NrTGV2ZWwoTE9DS19OT05FKTsK\nICAgICAgICBfZmMuc2V0V3JpdGVMb2NrTGV2ZWwoTE9DS19OT05FKTsKICAg\nICAgICBfZmMuc2V0TG9ja1RpbWVvdXQoLTEpOwoKICAgICAgICBDb2xsZWN0\naW9uIHRyYW5zU3RhdGVzID0gX3RyYW5zQ2FjaGU7CiAgICAgICAgaWYgKHRy\nYW5zU3RhdGVzID09IG51bGwpCiAgICAgICAgICAgIHRyYW5zU3RhdGVzID0g\nQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAgICAgLy8gZmlyZSBhZnRl\nciByb2xsYmFjay9jb21taXQgZXZlbnQKICAgICAgICBDb2xsZWN0aW9uIG1v\nYmpzID0gbnVsbDsKICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhh\nc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIG1vYmpzID0gbmV3IE1h\nbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5zU3RhdGVzKTsKICAgICAgICAg\nICAgaW50IGV2ZW50VHlwZSA9IChyb2xsYmFjaykgPyBUcmFuc2FjdGlvbkV2\nZW50LkFGVEVSX1JPTExCQUNLCiAgICAgICAgICAgICAgICA6IFRyYW5zYWN0\naW9uRXZlbnQuQUZURVJfQ09NTUlUOwogICAgICAgICAgICBmaXJlVHJhbnNh\nY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCBldmVudFR5\ncGUsIG1vYmpzLCAKICAgICAgICAgICAgICAgIF9wZXJzaXN0ZWRDbHNzLCBf\ndXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gbnVsbCB0cmFuc2FjdGlvbmFsIGNhY2hlcyBub3cgc28gdGhhdCBh\nbGwgdGhlIHJlbW92ZUZyb21UcmFuc2FjdGlvbgogICAgICAgIC8vIGNhbGxz\nIGFzIHdlIHRyYW5zaXRpb24gZWFjaCBvYmplY3QgZG9uJ3QgaGF2ZSB0byBk\nbyBhbnkgd29yazsgZG9uJ3QKICAgICAgICAvLyBjbGVhciB0cmFucyBjYWNo\nZSBvYmplY3QgYmVjYXVzZSB3ZSBzdGlsbCBuZWVkIHRoZSB0cmFuc1N0YXRl\ncwogICAgICAgIC8vIHJlZmVyZW5jZSB0byBpdCBiZWxvdwogICAgICAgIF90\ncmFuc0NhY2hlID0gbnVsbDsKICAgICAgICBpZiAoX3BlcnNpc3RlZENsc3Mg\nIT0gbnVsbCkKICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MuY2xlYXIoKTsK\nICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzICE9IG51bGwpCiAgICAgICAgICAg\nIF91cGRhdGVkQ2xzcy5jbGVhcigpOwogICAgICAgIGlmIChfZGVsZXRlZENs\nc3MgIT0gbnVsbCkKICAgICAgICAgICAgX2RlbGV0ZWRDbHNzLmNsZWFyKCk7\nCgogICAgICAgIC8vIG5ldyBjYWNoZSB3b3VsZCBnZXQgY2xlYXJlZCBhbnl3\nYXkgZHVyaW5nIHRyYW5zaXRpb25zLCBidXQgZG9pbmcgc28KICAgICAgICAv\nLyBpbW1lZGlhdGVseSBzYXZlcyB1cyBzb21lIGxvb2t1cHMKICAgICAgICBf\nY2FjaGUuY2xlYXJOZXcoKTsKCiAgICAgICAgLy8gdGVsbCBhbGwgZGVyZWZl\nZCBpbnN0YW5jZXMgdGhleSdyZSBubyBsb25nZXIgZGVyZWZlZDsgd2UgY2Fu\nJ3QKICAgICAgICAvLyByZWx5IG9uIHJvbGxiYWNrIGFuZCBjb21taXQgY2Fs\nbHMgYmVsb3cgY2F1c2Ugc29tZSBpbnN0YW5jZXMgbWlnaHQKICAgICAgICAv\nLyBub3QgYmUgdHJhbnNhY3Rpb25hbAogICAgICAgIGlmIChfZGVyZWZDYWNo\nZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGVyZWZDYWNoZS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVN\nYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuc2V0RGVyZWZlcmVuY2VkRGVwZW5k\nZW50CiAgICAgICAgICAgICAgICAgICAgKGZhbHNlLCBmYWxzZSk7CiAgICAg\nICAgICAgIF9kZXJlZkNhY2hlLmNsZWFyKCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBwZWZvcm0gY29tbWl0IG9yIHJvbGxiYWNrIHN0YXRlIHRyYW5zaXRp\nb25zIG9uIGVhY2ggaW5zdGFuY2UKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNTdGF0ZXMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgc20g\nPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGlmIChyb2xsYmFjaykgewogICAgICAg\nICAgICAgICAgICAgIC8vIHRlbGwgb2JqZWN0cyB0aGF0IG1heSBoYXZlIGJl\nZW4gZGVyZWZlZCB0aGVuIGZsdXNoZWQKICAgICAgICAgICAgICAgICAgICAv\nLyAoYW5kIHRoZXJlZm9yZSBkZWxldGVkKSB0byB1bi1kZXJlZgogICAgICAg\nICAgICAgICAgICAgIHNtLnNldERlcmVmZXJlbmNlZERlcGVuZGVudChmYWxz\nZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrKCk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBz\nbS5jb21taXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgcmUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBu\nb3RpZnkgdGhlIGxvY2sgbWFuYWdlciB0byBjbGVhbiB1cCBhbmQgcmVsZWFz\nZSByZW1haW5pbmcgbG9ja3MKICAgICAgICBfbG0uZW5kVHJhbnNhY3Rpb24o\nKTsKCiAgICAgICAgLy8gY2xlYXIgb2xkIHNhdmVwb2ludHMgaW4gcmV2ZXJz\nZQogICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZTsKICAgICAgICB3aGls\nZSAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiBfc2F2ZXBvaW50cy5zaXplKCkg\nPiAwKSB7CiAgICAgICAgICAgIHNhdmUgPQogICAgICAgICAgICAgICAgKE9w\nZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJlbW92ZShfc2F2ZXBvaW50\ncy5zaXplKCkgLSAxKTsKICAgICAgICAgICAgc2F2ZS5yZWxlYXNlKGZhbHNl\nKTsKICAgICAgICB9CiAgICAgICAgX3NhdmVwb2ludHMgPSBudWxsOwogICAg\nICAgIF9zYXZlcG9pbnRDYWNoZSA9IG51bGw7CgogICAgICAgIC8vIGZpcmUg\nYWZ0ZXIgc3RhdGUgY2hhbmdlIGV2ZW50CiAgICAgICAgaWYgKF90cmFuc0V2\nZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgZmly\nZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywg\nVHJhbnNhY3Rpb25FdmVudC4KICAgICAgICAgICAgICAgIEFGVEVSX1NUQVRF\nX1RSQU5TSVRJT05TLCBtb2JqcywgbnVsbCwgbnVsbCwgbnVsbCkpOwoKICAg\nICAgICAvLyBub3cgY2xlYXIgdHJhbnMgY2FjaGU7IGtlZXAgY2xlYXJlZCB2\nZXJzaW9uIHJhdGhlciB0aGFuCiAgICAgICAgLy8gbnVsbCB0byBhdm9pZCBo\nYXZpbmcgdG8gcmUtY3JlYXRlIHRoZSBzZXQgbGF0ZXI7IG1vcmUgZWZmaWNp\nZW50CiAgICAgICAgaWYgKHRyYW5zU3RhdGVzICE9IENvbGxlY3Rpb25zLkVN\nUFRZX0xJU1QpIHsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSAoVHJhbnNh\nY3Rpb25hbENhY2hlKSB0cmFuc1N0YXRlczsKICAgICAgICAgICAgX3RyYW5z\nQ2FjaGUuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAgIHRocm93TmVzdGVk\nRXhjZXB0aW9ucyhleGNlcHMsIHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBPYmplY3QgbGlmZWN5Y2xlCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT2Jq\nZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHBlcnNpc3Qo\nb2JqLCBudWxsLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBp\nZCwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcmV0dXJu\nIHBlcnNpc3Qob2JqLCBpZCwgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcGVyc2lzdEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBwZXJzaXN0QWxsKG9ianMsIHRydWUsIGNh\nbGwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4g\nb2JqZWN0cy4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGlj\naXQgcGVyc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJz\naXN0IChQTkVXUFJPVklTSU9OQUwpLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBwZXJzaXN0QWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBleHBsaWNp\ndCwgCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChv\nYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVy\nYXRpb24oKTsKCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jq\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBwZXJzaXN0KGl0ci5uZXh0\nKCksIGV4cGxpY2l0LCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNl\ncHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhlIGdpdmVuIGVsZW1lbnQgaXMgbm90IG51bGwsIGFkZCBpdCB0byB0\naGUgZ2l2ZW4gbGlzdCwKICAgICAqIGNyZWF0aW5nIHRoZSBsaXN0IGlmIG5l\nY2Vzc2FyeS4KICAgICAqLwogICAgcHJpdmF0ZSBMaXN0IGFkZChMaXN0IGws\nIE9iamVjdCBvKSB7CiAgICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGw7CiAgICAgICAgaWYgKGwgPT0gbnVsbCkKICAgICAgICAg\nICAgbCA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgbC5hZGQobyk7CiAg\nICAgICAgcmV0dXJuIGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBh\nbiBleGNlcHRpb24gd3JhcHBpbmcgdGhlIGdpdmVuIG5lc3RlZCBleGNlcHRp\nb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdGhyb3dOZXN0ZWRFeGNl\ncHRpb25zKExpc3QgZXhjZXBzLCBib29sZWFuIGRhdGFzdG9yZSkgewogICAg\nICAgIGlmIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKGRhdGFzdG9yZSAmJiBl\neGNlcHMuc2l6ZSgpID09IDEpCiAgICAgICAgICAgIHRocm93IChSdW50aW1l\nRXhjZXB0aW9uKSBleGNlcHMuZ2V0KDApOwoKICAgICAgICBib29sZWFuIGZh\ndGFsID0gZmFsc2U7CiAgICAgICAgVGhyb3dhYmxlW10gdCA9IChUaHJvd2Fi\nbGVbXSkgZXhjZXBzLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBUaHJvd2Fi\nbGVbZXhjZXBzLnNpemUoKV0pOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodFtpXSBpbnN0\nYW5jZW9mIE9wZW5KUEFFeGNlcHRpb24KICAgICAgICAgICAgICAgICYmICgo\nT3BlbkpQQUV4Y2VwdGlvbikgdFtpXSkuaXNGYXRhbCgpKQogICAgICAgICAg\nICAgICAgZmF0YWwgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBPcGVuSlBB\nRXhjZXB0aW9uIGVycjsKICAgICAgICBpZiAoZGF0YXN0b3JlKQogICAgICAg\nICAgICBlcnIgPSBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5lc3Rl\nZC1leGNlcHMiKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBlcnIgPSBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKTsK\nICAgICAgICB0aHJvdyBlcnIuc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5zZXRG\nYXRhbChmYXRhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJzaXN0IHRo\nZSBnaXZlbiBvYmplY3QuICBJbmRpY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFu\nIGV4cGxpY2l0IHBlcnNpc3QKICAgICAqIChQTkVXKSBvciBhIHByb3Zpc29u\nYWwgcGVyc2lzdCAoUE5FV1BST1ZJU0lPTkFMKQogICAgICovCiAgICBwdWJs\naWMgdm9pZCBwZXJzaXN0KE9iamVjdCBvYmosIGJvb2xlYW4gZXhwbGljaXQs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBwZXJzaXN0KG9iaiwgbnVs\nbCwgZXhwbGljaXQsIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVy\nc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5kaWNhdGUgd2hldGhlciB0aGlz\nIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAgICAgKiAoUE5FVykgb3IgYSBw\ncm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9WSVNJT05BTCkuCiAgICAgKiBT\nZWUge0BsaW5rIEJyb2tlcn0gZm9yIGRldGFpbHMgb24gdGhpcyBtZXRob2Qu\nCiAgICAgKi8KICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHBlcnNp\nc3QoT2JqZWN0IG9iaiwgT2JqZWN0IGlkLCBib29sZWFuIGV4cGxpY2l0LAog\nICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRXcml0ZU9wZXJhdGlvbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAgaW50IGFjdGlvbiA9\nIHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9QRVJTSVNULCBvYmos\nIHNtLCBjYWxsKTsKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSBPcENhbGxi\nYWNrcy5BQ1RfTk9ORSkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsKCiAg\nICAgICAgICAgIC8vIEFDVF9DQVNDQURFCiAgICAgICAgICAgIGlmICgoYWN0\naW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkgewogICAgICAgICAg\nICAgICAgaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc20u\nY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENhbGxiYWNr\ncy5PUF9QRVJTSVNULCBvYmosIGNhbGwsCiAgICAgICAgICAgICAgICAgICAg\nICAgICJwZXJzaXN0Iik7CiAgICAgICAgICAgICAgICByZXR1cm4gc207CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFDVF9SVU4KICAgICAgICAg\nICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjOwogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQo\nKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0RXhpc3Rz\nRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgi\ncGVyc2lzdC1kZXRhY2hlZCIsIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkp\nLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qob2Jq\nKTsKCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlzRW1iZWRkZWQoKSkgewog\nICAgICAgICAgICAgICAgICAgIHNtLnBlcnNpc3QoKTsKICAgICAgICAgICAg\nICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0g\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3Qo\nY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGFuIGVtYmVkZGVkIGZp\nZWxkOyBub3RpZnkgdGhlIG93bmVyIHRoYXQgdGhlIHZhbHVlIGhhcwogICAg\nICAgICAgICAgICAgLy8gY2hhbmdlZCBieSBiZWNvbWluZyBpbmRlcGVuZGVu\ndGx5IHBlcnNpc3RlbnQKICAgICAgICAgICAgICAgIHNtLmdldE93bmVyKCku\nZGlydHkoc20uZ2V0T3duZXJNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAg\nICAgIGdldEZpZWxkTWV0YURhdGEoKS5nZXRJbmRleCgpKTsKICAgICAgICAg\nICAgICAgIF9jYWNoZS5wZXJzaXN0KHNtKTsKICAgICAgICAgICAgICAgIHBj\nID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBwYyA9IGFzc2VydFBlcnNpc3RlbmNl\nQ2FwYWJsZShvYmopOwogICAgICAgICAgICAgICAgaWYgKHBjLnBjSXNEZXRh\nY2hlZCgpID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAg\nICAgICAgICAgICAgICAgICAgICgicGVyc2lzdC1kZXRhY2hlZCIsIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcob2JqKSkpLgogICAgICAgICAgICAgICAgICAgICAg\nICBzZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFE\nYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KG9iaiwgbnVsbCwgbWV0YSwgTGlmZWN5\nY2xlRXZlbnQuQkVGT1JFX1BFUlNJU1QpOwoKICAgICAgICAgICAgLy8gY3Jl\nYXRlIGlkIGZvciBpbnN0YW5jZQogICAgICAgICAgICBpZiAoaWQgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgaWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAg\nICAgICAgICAgICBpZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShwYywgbWV0\nYSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtZXRhLmdldElkZW50aXR5\nVHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nbWV0YS11bmtub3duaWQiLCBtZXRhKSk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgaWQgPSBTdGF0ZU1hbmFnZXJJZC5uZXdJ\nbnN0YW5jZSh0aGlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIHdlIGRvbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5zdGFuY2Ug\nY2FjaGVkCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3RoZXIgPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChpZCwgZmFsc2UpOwogICAgICAgICAg\nICBpZiAob3RoZXIgIT0gbnVsbCAmJiAhb3RoZXIuaXNEZWxldGVkKCkgJiYg\nIW90aGVyLmlzTmV3KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2Jq\nZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWNoZS1leGlzdHMiLAog\nICAgICAgICAgICAgICAgICAgIG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSwg\naWQpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKCiAgICAgICAgICAgIC8vIGlm\nIGhhZCBlbWJlZGRlZCBzbSwgbnVsbCBpdAogICAgICAgICAgICBpZiAoc20g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFu\nYWdlcihudWxsKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgc20KICAg\nICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwg\ndGhpcyk7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUp\nICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChleHBsaWNpdCkKICAgICAg\nICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlBORVcp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5FV1BST1ZJU0lPTkFMKTsKICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXpl\nKHBjLCBQQ1N0YXRlLlBOT05UUkFOU05FVyk7CiAgICAgICAgICAgIGlmICgo\nYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAg\nICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAgICAgICAg\nICAgcmV0dXJuIHNtOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVtcG9yYXJpbHkgbWFuYWdlIHRoZSBnaXZlbiBp\nbnN0YW5jZSBpbiBvcmRlciB0byBjYXNjYWRlIHRoZSBnaXZlbgogICAgICog\nb3BlcmF0aW9uIHRocm91Z2ggaXQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBjYXNjYWRlVHJhbnNpZW50KGludCBvcCwgT2JqZWN0IG9iaiwgT3BDYWxs\nYmFja3MgY2FsbCwKICAgICAgICBTdHJpbmcgZXJyT3ApIHsKICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFi\nbGUob2JqKTsKCiAgICAgICAgLy8gaWYgdXNpbmcgZGV0YWNoZWQgc3RhdGUg\nbWFuYWdlciwgZG9uJ3QgcmVwbGFjZQogICAgICAgIGlmIChwYy5wY0dldFN0\nYXRlTWFuYWdlcigpICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ld0Rl\ndGFjaGVkRXhjZXB0aW9uKG9iaiwgZXJyT3ApOwoKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3Mo\nKSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKFN0YXRlTWFuYWdlcklkLgogICAg\nICAgICAgICBuZXdJbnN0YW5jZSh0aGlzKSwgbWV0YSwgdGhpcyk7CiAgICAg\nICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5UTE9BREVEKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1BFUlNJU1Q6CiAgICAgICAgICAg\nICAgICAgICAgc20uY2FzY2FkZVBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJh\nY2tzLk9QX0RFTEVURToKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRl\nRGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBPcENhbGxiYWNrcy5PUF9SRUZSRVNIOgogICAg\nICAgICAgICAgICAgICAgIHNtLmdhdGhlckNhc2NhZGVSZWZyZXNoKGNhbGwp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJu\nYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2Yob3ApKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgc20u\ncmVsZWFzZSh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgZGVsZXRlQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CgogICAg\nICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgICAgIE9iamVj\ndCBvYmo7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICBleGNl\ncHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4\nY2VwcywgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAgICAg\nICBkZWxldGUob2JqLCBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSks\nIGNhbGwpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogSW50ZXJuYWwgZGVsZXRlLgogICAgICovCiAgICB2b2lkIGRl\nbGV0ZShPYmplY3Qgb2JqLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFkZChvYmop\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGludCBhY3Rpb24gPSBw\ncm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLCBvYmosIHNt\nLCBjYWxsKTsKICAgICAgICBpZiAoYWN0aW9uID09IE9wQ2FsbGJhY2tzLkFD\nVF9OT05FKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIEFDVF9D\nQVNDQURFCiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1Rf\nUlVOKSA9PSAwKSB7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgY2FzY2FkZVRyYW5zaWVudChPcENh\nbGxiYWNrcy5PUF9ERUxFVEUsIG9iaiwgY2FsbCwgImRlbGV0ZSIpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBBQ1RfUlVO\nCiAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHNt\nLmlzRGV0YWNoZWQoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgImRlbGV0ZSIpOwogICAgICAgICAgICBpZiAo\nKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAg\nICAgICAgICAgICAgc20uY2FzY2FkZURlbGV0ZShjYWxsKTsKICAgICAgICAg\nICAgc20uZGVsZXRlKCk7CiAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJz\naXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFu\nLlRSVUUpCiAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgImRlbGV0ZSIpOwogICAgfQoKICAgIC8qKgogICAgICogVGhyb3cg\nYW4gZXhjZXB0aW9uIGluZGljYXRpbmcgdGhhdCB0aGUgY3VycmVudCBhY3Rp\nb24gY2FuJ3QgYmUKICAgICAqIHBlcmZvcm1lZCBvbiBhIGRldGFjaGVkIG9i\namVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBPcGVuSlBBRXhjZXB0aW9uIG5l\nd0RldGFjaGVkRXhjZXB0aW9uKE9iamVjdCBvYmosCiAgICAgICAgU3RyaW5n\nIG9wZXJhdGlvbikgewogICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtZGV0YWNoZWQtb3AiLCBvcGVyYXRpb24sCiAgICAg\nICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9i\namVjdChvYmopOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VBbGwo\nQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJl\nbGVhc2UoaXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9u\ncyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcmVsZWFzZShPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpbnQgYWN0\naW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFTEVBU0Us\nIG9iaiwgc20sIGNhbGwpOwoKICAgICAgICAgICAgaWYgKHNtID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICgoYWN0\naW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCAmJiBzbS5pc1BlcnNp\nc3RlbnQoKSkgewogICAgICAgICAgICAgICAgYm9vbGVhbiBwZW5kaW5nID0g\nc20uaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAg\nc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChwZW5kaW5n\nKQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21QZW5kaW5nVHJhbnNh\nY3Rpb24oc20pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRlTWFu\nYWdlciBlbWJlZChPYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBvd25lciwgVmFsdWVNZXRhRGF0YSBvd25lck1l\ndGEpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcgPSBnZXRT\ndGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChv\ncmlnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGFscmVhZHkg\nZW1iZWRkZWQsIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgICAgIGlmIChv\ncmlnLmdldE93bmVyKCkgPT0gb3duZXIgJiYgb3JpZy5nZXRNZXRhRGF0YSgp\nLgogICAgICAgICAgICAgICAgICAgIGdldEVtYmVkZGluZ01ldGFEYXRhKCkg\nPT0gb3duZXJNZXRhKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmln\nOwoKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBtYWtlIHN1cmUgcGMg\naXMgZnVsbHkgbG9hZGVkIGZvciB3aGVuIHdlIGNvcHkgaXRzCiAgICAgICAg\nICAgICAgICAvLyBkYXRhIGJlbG93CiAgICAgICAgICAgICAgICBvcmlnLmxv\nYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxMLCBudWxsLCBudWxs\nLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNyZWF0\nZSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGVtYmVkZGVkIG1ldGFkYXRhCiAg\nICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG93bmVyTWV0YS5nZXRF\nbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1lbWJlZCIsIG93bmVyTWV0YSkpOwoKICAgICAg\nICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IFN0\nYXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwoKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKGlk\nLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgc20uc2V0T3duZXIoKFN0YXRl\nTWFuYWdlckltcGwpIG93bmVyLCBvd25lck1ldGEpOwoKICAgICAgICAgICAg\nUGVyc2lzdGVuY2VDYXBhYmxlIGNvcHk7CiAgICAgICAgICAgIFBDU3RhdGUg\nc3RhdGU7CiAgICAgICAgICAgIENsYXNzIHR5cGUgPSBtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKTsKICAgICAgICAgICAgaWYgKHR5cGUuaXNJbnRlcmZhY2Uo\nKSkKICAgICAgICAgICAgICAgIHR5cGUgPSBtZXRhLmdldEludGVyZmFjZUlt\ncGwoKTsKICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAvLyBnaXZlIGNvcHkgYW5kIHRoZSBvcmlnaW5hbCBpbnN0YW5j\nZSB0aGUgc2FtZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgICAgICAvLyBz\nbyB0aGF0IHdlIGNhbiBjb3B5IGZpZWxkcyBmcm9tIG9uZSB0byB0aGUgb3Ro\nZXIKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgY29weVNNOwog\nICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjOwogICAgICAg\nICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIGNvcHlTTSA9IHNtOwogICAgICAgICAgICAgICAgICAgIHBjID0gYXNz\nZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CiAgICAgICAgICAgICAgICAg\nICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29weVNNID0gb3Jp\nZzsKICAgICAgICAgICAgICAgICAgICBwYyA9IG9yaWcuZ2V0UGVyc2lzdGVu\nY2VDYXBhYmxlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBjb3B5IHRoZSBpbnN0\nYW5jZS4gIHdlIGRvIHRoaXMgZXZlbiBpZiBpdCBkb2Vzbid0IGFscmVhZHkK\nICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIGEgc3RhdGUgbWFuYWdlciBp\nbiBjYXNlIGl0IGlzIGxhdGVyIGFzc2lnbmVkIHRvIGEKICAgICAgICAgICAg\nICAgICAgICAvLyBQQyBmaWVsZDsgYXQgdGhhdCBwb2ludCBpdCdzIHRvbyBs\nYXRlIHRvIGNvcHkKICAgICAgICAgICAgICAgICAgICBjb3B5ID0gUENSZWdp\nc3RyeS5uZXdJbnN0YW5jZSh0eXBlLCBjb3B5U00sIGZhbHNlKTsKICAgICAg\nICAgICAgICAgICAgICBpbnRbXSBmaWVsZHMgPSBuZXcgaW50W21ldGEuZ2V0\nRmllbGRzKCkubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgICAgICAgICAgZmllbGRzW2ldID0gaTsKICAgICAgICAgICAgICAgICAg\nICBjb3B5LnBjQ29weUZpZWxkcyhwYywgZmllbGRzKTsKICAgICAgICAgICAg\nICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRUNPUFk7CiAgICAgICAgICAgICAg\nICAgICAgY29weS5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIobnVsbCk7CiAgICAg\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIC8v\nIGlmIHRoZSBpbnN0YW5jZSBkaWRuJ3QgaGF2ZSBhIHN0YXRlIG1hbmFnZXIg\ndG8gc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgLy8gcmV2ZXJ0IGl0IHRv\nIGJlaW5nIHRyYW5zaWVudAogICAgICAgICAgICAgICAgICAgIGlmIChvcmln\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHBjLnBjUmVwbGFj\nZVN0YXRlTWFuYWdlcihudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvcHkgPSBQQ1JlZ2lz\ndHJ5Lm5ld0luc3RhbmNlKHR5cGUsIHNtLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwICYmICFfb3B0\naW1pc3RpYykKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3RhdGUu\nRUNMRUFOOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHN0YXRlID0gUENTdGF0ZS5FTk9OVFJBTlM7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoY29weSwgc3RhdGUpOwogICAg\nICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJZiBub3QgYWxyZWFkeSBjYWNoZWQsIGNy\nZWF0ZSBhbiBlbXB0eSBjb3B5IG9mIHRoZSBnaXZlbiBzdGF0ZQogICAgICog\nbWFuYWdlciBpbiB0aGUgZ2l2ZW4gc3RhdGUuCiAgICAgKi8KICAgIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgY29weShPcGVuSlBBU3RhdGVNYW5hZ2VyIGNvcHks\nIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgICAgIE9iamVjdCBvaWQgPSBjb3B5LmZldGNoT2JqZWN0SWQoKTsK\nICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IGNvcHkuZ2V0TWFuYWdlZEluc3Rh\nbmNlKCkuZ2V0Q2xhc3MoKTsKICAgICAgICAgICAgaWYgKG9pZCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgIC8vIGNhY2hlZCBpbnN0YW5jZT8KICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG51bGw7CiAgICAgICAgICAgIGlm\nICghY29weS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgICAgICBzbSA9IGdl\ndFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBNZXRhRGF0YVJl\ncG9zaXRvcnkgcmVwb3MgPSBfY29uZi4KICAgICAgICAgICAgICAgICAgICBn\nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEodHlw\nZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAvLyBjb25zdHJ1\nY3QgYSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGFsbCBpbmZvIGtub3duCiAg\nICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBsKG9pZCwg\nbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICBzbS5zZXRPYmplY3RJZChv\naWQpOwogICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShzbS5nZXRNZXRh\nRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwgc3RhdGUpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcmVmcmVzaEFsbChDb2xsZWN0aW9uIG9ianMs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9u\ndHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAg\nICAgICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCks\nIGNhbGwpOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChfb3Bl\ncmF0aW5nLnNpemUoKSA9PSAxKQogICAgICAgICAgICAgICAgcmVmcmVzaElu\ndGVybmFsKF9vcGVyYXRpbmcuaXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZWZyZXNoSW50ZXJu\nYWwoX29wZXJhdGluZywgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHJlZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVh\nZCgpOwoKICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2gob2JqLCBj\nYWxsKTsKICAgICAgICAgICAgaWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoX29wZXJh\ndGluZy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgICAgIHJlZnJlc2hJbnRl\ncm5hbChfb3BlcmF0aW5nLml0ZXJhdG9yKCkubmV4dCgpLCBjYWxsKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmVmcmVzaEludGVybmFs\nKF9vcGVyYXRpbmcsIGNhbGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEdhdGhlcnMgYWxsIG9iamVjdHMgcmVhY2hhYmxlIHRocm91\nZ2ggY2FzY2FkZS1yZWZyZXNoIHJlbGF0aW9ucwogICAgICogaW50byB0aGUg\nb3BlcmF0aW5nIHNldC4KICAgICAqLwogICAgdm9pZCBnYXRoZXJDYXNjYWRl\nUmVmcmVzaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgaWYgKCFfb3BlcmF0aW5nLmFkZChvYmopKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1h\nbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwogICAgICAgIGludCBhY3Rpb24gPSBw\ncm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBz\nbSwgY2FsbCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5B\nQ1RfQ0FTQ0FERSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2Fk\nZVJlZnJlc2goY2FsbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjYXNj\nYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwgY2Fs\nbCwgInJlZnJlc2giKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIGNhbGxlZCB3aXRoIHRoZSBmdWxsIHNldCBvZiBvYmplY3RzIHJl\nYWNoYWJsZSB2aWEKICAgICAqIGNhc2NhZGUtcmVmcmVzaCByZWxhdGlvbnMg\nZnJvbSB0aGUgdXNlci1naXZlbiBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5hbChDb2xsZWN0aW9uIG9ianMs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBpbnN0\nYW5jZXMgdGhhdCBuZWVkIGEgcmVmcmVzaAogICAgICAgICAgICBDb2xsZWN0\naW9uIGxvYWQgPSBudWxsOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChP\ncENhbGxiYWNrcy5PUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAi\ncmVmcmVzaCIpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChz\nbS5iZWZvcmVSZWZyZXNoKHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAobG9hZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0KG9ianMuc2l6ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJ\nc0RldGFjaGVkKCkKICAgICAgICAgICAgICAgICAgICAgICAgPT0gQm9vbGVh\nbi5UUlVFKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRh\nY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZWZyZXNo\nIGFsbAogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBDb2xsZWN0aW9uIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxv\nYWQsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgU3RvcmVNYW5hZ2VyLkZP\nUkNFX0xPQURfUkVGUkVTSCwgX2ZjLCBudWxsKTsKICAgICAgICAgICAgICAg\nIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBuZXdPYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKCiAgICAgICAgICAgICAg\nICAvLyBwZXJmb3JtIHBvc3QtcmVmcmVzaCB0cmFuc2l0aW9ucyBhbmQgbWFr\nZSBzdXJlIGFsbCBmZXRjaAogICAgICAgICAgICAgICAgLy8gZ3JvdXAgZmll\nbGRzIGFyZSBsb2FkZWQKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gbG9hZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxs\nICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgp\nOwogICAgICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVN\nYW5hZ2VySW1wbC5MT0FEX0ZHUywgbnVsbCwgbnVsbCwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBub3cgaW52b2tlIHBvc3RSZWZyZXNoIG9uIGFs\nbCB0aGUgaW5zdGFuY2VzCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0\nYXRlTWFuYWdlckltcGwoaXRyLm5leHQoKSwgdHJ1ZSk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgIXNtLmlzRGV0YWNoZWQoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNt\nLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQu\nQUZURVJfUkVGUkVTSCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0\nZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogT3B0aW1pemF0aW9uIGZvciBzaW5nbGUtb2JqZWN0IHJlZnJlc2gu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5hbChP\nYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFu\nYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNz\nQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2Fs\nbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0g\nMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmIChz\nbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hl\nZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhj\nZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKHNtLmJlZm9yZVJlZnJlc2goZmFsc2UpKSB7CiAgICAgICAgICAgICAg\nICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1Ms\nIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzbS5h\nZnRlclJlZnJlc2goKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGZpcmVMaWZlY3ljbGVFdmVudChzbS5nZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSwgbnVsbCwKICAgICAgICAgICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgp\nLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9SRUZSRVNIKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lz\nRGV0YWNoZWQoKQogICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2Jq\nLCAicmVmcmVzaCIpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHJldHJpZXZlQWxsKENvbGxlY3Rpb24gb2JqcywgYm9v\nbGVhbiBkZmdPbmx5LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICBpZiAob2Jqcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICBy\nZXRyaWV2ZShvYmpzLml0ZXJhdG9yKCkubmV4dCgpLCBkZmdPbmx5LCBjYWxs\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTGlz\ndCBleGNlcHMgPSBudWxsOwogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAg\nICAgICAgIC8vIGNvbGxlY3QgYWxsIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxv\nYWQKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgQ29sbGVj\ndGlvbiBsb2FkID0gbnVsbDsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgQXJyYXlM\naXN0KG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3Mu\nT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAg\nIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtcy5hZGQoc20p\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3Rh\ndGUoKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGxvYWQgPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20p\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChh\nc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQog\nICAgICAgICAgICAgICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChV\nc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBsb2FkIGFsbCBob2xsb3cgaW5zdGFu\nY2VzCiAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0gbnVsbDsKICAg\nICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\naW50IG1vZGUgPSAoZGZnT25seSkgPyBfc3RvcmUuRk9SQ0VfTE9BRF9ERkcK\nICAgICAgICAgICAgICAgICAgICA6IF9zdG9yZS5GT1JDRV9MT0FEX0FMTDsK\nICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2FkQWxsKGxvYWQs\nIG51bGwsIG1vZGUsIF9mYywgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAo\nZmFpbGVkICE9IG51bGwgJiYgIWZhaWxlZC5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgbmV3T2JqZWN0Tm90\nRm91bmRFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHJldHJpZXZlIGFsbCBub24tZmFpbGVkIGluc3RhbmNlcwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSAoU3Rh\ndGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlm\nIChmYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQo\nKSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdGF0ZU1hbmFnZXJJbXBs\nLkxPQURfRkdTCiAgICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJ\nbXBsLkxPQURfQUxMOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAgICAgICAgICAgICAg\nICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhl\neGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXRyaWV2\nZShPYmplY3Qgb2JqLCBib29sZWFuIGRmZ09ubHksIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBh\nc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0\ncnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxs\nYmFja3MuT1BfUkVUUklFVkUsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAg\nICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAg\nICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJy\nZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVu\ndCgpKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25s\neSkgPyBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTCiAgICAgICAgICAgICAg\nICAgICAgICAgIDogU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsKICAgICAg\nICAgICAgICAgICAgICBzbS5iZWZvcmVSZWFkKC0xKTsKICAgICAgICAgICAg\nICAgICAgICBzbS5sb2FkKF9mYywgbW9kZSwgbnVsbCwgbnVsbCwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGFz\nc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAg\nICAgICAgICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJyZXRyaWV2ZSIp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGV2aWN0QWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gZXZpY3QgYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9iamVjdHMKICAg\nICAgICAgICAgQ29sbGVjdGlvbiBjID0gZ2V0TWFuYWdlZFN0YXRlcygpOwog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwp\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0\nZW50KCkgJiYgIXNtLmlzRGlydHkoKSkKICAgICAgICAgICAgICAgICAgICBl\ndmljdChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwgY2FsbCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBldmljdEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBldmljdChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhy\nb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGV2aWN0QWxsKEV4dGVudCBleHRlbnQsIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAoZXh0ZW50ID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2Up\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGV2aWN0IGFsbCBQQ2xl\nYW4gYW5kIFBOb25UcmFucyBvYmplY3RzIGluIGV4dGVudAogICAgICAgICAg\nICBDb2xsZWN0aW9uIGMgPSBnZXRNYW5hZ2VkU3RhdGVzKCk7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIENsYXNzIGNs\nczsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IChT\ndGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKHNtLmlzUGVyc2lzdGVudCgpICYmICFzbS5pc0RpcnR5KCkpIHsKICAg\nICAgICAgICAgICAgICAgICBjbHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldERl\nc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2xzID09\nIGV4dGVudC5nZXRFbGVtZW50VHlwZSgpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHx8IChleHRlbnQuaGFzU3ViY2xhc3NlcygpCiAgICAgICAgICAgICAg\nICAgICAgICAgICYmIGV4dGVudC5nZXRFbGVtZW50VHlwZSgpLmlzQXNzaWdu\nYWJsZUZyb20oY2xzKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGV2aWN0\nKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBjYWxsKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBldmljdChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHBy\nb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9FVklDVCwgb2JqLCBzbSwg\nY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikg\nPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYg\nKHNtID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAg\nICAgICBzbS5ldmljdCgpOwogICAgICAgICAgICBpZiAoX2V2aWN0RGF0YUNh\nY2hlICYmIHNtLmdldE9iamVjdElkKCkgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgRGF0YUNhY2hlIGNhY2hlID0gc20uZ2V0TWV0YURhdGEoKS5nZXRE\nYXRhQ2FjaGUoKTsKICAgICAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGNhY2hlLnJlbW92ZShzbS5nZXRPYmpl\nY3RJZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2Jq\nZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmog\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IF9jYWxsOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gbmV3IERldGFjaE1hbmFnZXIodGhpcywgZmFsc2Us\nIGNhbGwpLmRldGFjaChvYmopOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBkZXRhY2hBbGwoQ29sbGVjdGlv\nbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbmV3IE9iamVj\ndFswXTsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBj\nYWxsID0gX2NhbGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoTWFu\nYWdlcih0aGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoQWxsKG9ianMpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRl\ndGFjaEFsbChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwKQogICAgICAgICAg\nICAgICAgZmx1c2goKTsKICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwo\nY2FsbCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGRldGFjaEFsbEludGVybmFsKE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBDb2xsZWN0aW9uIHN0YXRlcyA9IGdldE1hbmFnZWRTdGF0\nZXMoKTsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gc3RhdGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwp\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICghc20uaXNQZXJzaXN0ZW50\nKCkpCiAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAg\nIGVsc2UgaWYgKCFzbS5nZXRNZXRhRGF0YSgpLmlzRGV0YWNoYWJsZSgpKSB7\nCiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgICAg\nICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGlmIChzdGF0ZXMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNh\nbGwgPSBfY2FsbDsKICAgICAgICBuZXcgRGV0YWNoTWFuYWdlcih0aGlzLCB0\ncnVlLCBjYWxsKS5kZXRhY2hBbGwKICAgICAgICAgICAgKG5ldyBNYW5hZ2Vk\nT2JqZWN0Q29sbGVjdGlvbihzdGF0ZXMpKTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGF0dGFjaChPYmplY3Qgb2JqLCBib29sZWFuIGNvcHlOZXcsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25seSBpZiB0aGlzIGZh\naWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFj\naE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0YWNoKG9iaik7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE9wdGltaXN0aWNFeGNlcHRpb24gb2UpIHsK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seSgpOwogICAgICAgICAg\nICAgICAgdGhyb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gYXR0YWNoQWxsKENvbGxl\nY3Rpb24gb2JqcywgYm9vbGVhbiBjb3B5TmV3LAogICAgICAgIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0WzBdOwoKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25s\neSBpZiB0aGlzIGZhaWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0\naW9uKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEF0dGFjaE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0\nYWNoQWxsKG9ianMpOwogICAgICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGlj\nRXhjZXB0aW9uIG9lKSB7CiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09u\nbHkoKTsKICAgICAgICAgICAgICAgIHRocm93IG9lLnNldEZhdGFsKHRydWUp\nOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9u\ndHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBub250cmFuc2FjdGlvbmFsKGl0ci5uZXh0KCksIGNh\nbGwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1\nZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIG5vbnRyYW5zYWN0\naW9uYWwoT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1bWVu\ndChPcENhbGxiYWNrcy5PUF9OT05UUkFOU0FDVElPTkFMLCBvYmosIHNtLCBj\nYWxsKQogICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9\nPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNtLm5vbnRyYW5zYWN0aW9u\nYWwoKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVy\nYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgdGhlIGdpdmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFs\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlvbmFsQWxsKENv\nbGxlY3Rpb24gb2JqcywgYm9vbGVhbiB1cGRhdGVWZXJzaW9uLAogICAgICAg\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAob2Jqcy5zaXpl\nKCkgPT0gMSkgewogICAgICAgICAgICB0cmFuc2FjdGlvbmFsKG9ianMuaXRl\ncmF0b3IoKS5uZXh0KCksIHVwZGF0ZVZlcnNpb24sIGNhbGwpOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjb2xsZWN0\nIGFsbCBob2xsb3cgaW5zdGFuY2VzIGZvciBsb2FkLCBhbmQgbWFrZSB1bm1h\nbmFuZ2VkCiAgICAgICAgICAgIC8vIGluc3RhbmNlcyB0cmFuc2llbnQtdHJh\nbnNhY3Rpb25hbAogICAgICAgICAgICBDb2xsZWN0aW9uIGxvYWQgPSBudWxs\nOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7\nCiAgICAgICAgICAgIENvbGxlY3Rpb24gc21zID0gbmV3IEFycmF5TGlzdChv\nYmpzLnNpemUoKSk7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsK\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBvYmogPSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0ZU1hbmFn\nZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChw\ncm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJBTlNBQ1RJT05BTCwg\nb2JqLCBzbSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbCkgJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNtID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFuYWdlIHRyYW5z\naWVudCBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhID0g\nX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFz\ncygpLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIChTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0aGlzKSwg\nbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmluaXRp\nYWxpemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5pc1BlcnNpc3RlbnQoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlv\nbigpOwogICAgICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2FkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1Zl\ncnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGRh\ndGVWZXJzaW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0\nVXBkYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hl\nY2svdXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewog\nICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAgICAgICBDb2xs\nZWN0aW9uIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChsb2FkICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9yZS5sb2Fk\nQWxsKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JDRV9MT0FEX05PTkUsCiAgICAg\nICAgICAgICAgICAgICAgX2ZjLCBudWxsKTsKICAgICAgICAgICAgICAgIGlm\nIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAg\nICAgICAgICAgICAgICBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWls\nZWQpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhbnNhY3Rpb25h\nbFN0YXRlc0FsbChzbXMsIGZhaWxlZCwgZXhjZXBzKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgdGhlIGdp\ndmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCB0cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIGJvb2xlYW4gdXBk\nYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sIGNh\nbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAg\nICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAg\nICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIHNtLmxv\nYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBudWxs\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1ZlcnNpb24o\ndHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lvbikKICAg\nICAgICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRydWUpOwog\nICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7\nIC8vIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAgICAgfSBlbHNlIGlmIChz\nbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtYW5hZ2UgdHJhbnNp\nZW50IGluc3RhbmNlCiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1l\ndGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgog\nICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRDbGFzcygp\nLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIE9iamVjdCBpZCA9\nIFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwogICAgICAgICAg\nICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0YSwgdGhp\ncyk7CiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBlcnNp\nc3RlbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAgIFBDU3Rh\ndGUuVENMRUFOKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBj\nYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9u\nIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0cmFuc2FjdGlvbmFsLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNhY3Rpb25hbFN0YXRlc0Fs\nbChDb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlvbiBmYWlsZWQsCiAgICAgICAg\nTGlzdCBleGNlcHMpIHsKICAgICAgICAvLyBtYWtlIGluc3RhbmNlcyB0cmFu\nc2FjdGlvbmFsIGFuZCBtYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVkCiAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRh\naW5zKHNtLmdldElkKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc20udHJhbnNhY3Rp\nb25hbCgpOwogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0YXRlTWFu\nYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhl\neGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gRXh0ZW50LCBRdWVyeQogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICBwdWJsaWMgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFu\nIHN1YmNsYXNzZXMpIHsKICAgICAgICByZXR1cm4gbmV3RXh0ZW50KHR5cGUs\nIHN1YmNsYXNzZXMsIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgRXh0ZW50\nIG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNzZXMsCiAg\nICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nRXh0ZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlzLCB0eXBl\nLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVudHMgPSBuZXcgUmVm\nZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwogICAgICAg\nICAgICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsKCiAgICAgICAgICAgIHJldHVy\nbiBleHRlbnQ7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJhdG9yKENsYXNzIHR5cGUsIGJv\nb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGJvb2xlYW4gaWdub3JlQ2hhbmdlcykgewogICAgICAgIEV4dGVu\ndCBleHRlbnQgPSBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgZmV0Y2gp\nOwogICAgICAgIGV4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKGlnbm9yZUNoYW5n\nZXMpOwogICAgICAgIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsKICAgIH0K\nCiAgICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIENsYXNz\nIGNscywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgUXVlcnkgcSA9IG5ld1F1\nZXJ5KGxhbmcsIHF1ZXJ5KTsKICAgICAgICBxLnNldENhbmRpZGF0ZVR5cGUo\nY2xzLCB0cnVlKTsKICAgICAgICByZXR1cm4gcTsKICAgIH0KCiAgICBwdWJs\naWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBxdWVyeSkg\newogICAgICAgIC8vIGNvbW1vbiBtaXN0YWtlcwogICAgICAgIGlmIChxdWVy\neSBpbnN0YW5jZW9mIEV4dGVudCB8fCBxdWVyeSBpbnN0YW5jZW9mIENsYXNz\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiYmFkLW5ldy1xdWVyeSIpKTsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0b3JlUXVlcnkg\nc3EgPSBfc3RvcmUubmV3UXVlcnkobGFuZyk7CiAgICAgICAgICAgIGlmIChz\ncSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBFeHByZXNzaW9uUGFyc2Vy\nIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2UobGFuZyk7\nCiAgICAgICAgICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBzcSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShlcCk7CiAg\nICAgICAgICAgICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX01F\nVEhPRFFMLmVxdWFscyhsYW5nKSkKICAgICAgICAgICAgICAgICAgICBzcSA9\nIG5ldyBNZXRob2RTdG9yZVF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKGxhbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBRdWVy\neSBxID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNxKTsKICAgICAgICAgICAgcS5z\nZXRJZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAg\naWYgKHF1ZXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBxLnNldFF1ZXJ5\nKHF1ZXJ5KTsKCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMKICAgICAg\nICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgICAgICBf\ncXVlcmllcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hT\nZXQuV0VBSyk7CiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChxKTsKICAgICAg\nICAgICAgcmV0dXJuIHE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBRdWVyeUltcGwgbmV3UXVlcnlJbXBsKFN0cmluZyBs\nYW5nLCBTdG9yZVF1ZXJ5IHNxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBRdWVy\neUltcGwodGhpcywgbGFuZywgc3EpOwogICAgfQoKICAgIHB1YmxpYyBTZXEg\nZ2V0SWRlbnRpdHlTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVsbCk7CiAg\nICB9CgogICAgcHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2Uo\nZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSwgZm1kKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUgZ2l2ZW4gY2xh\nc3MgYW5kIG9wdGlvbmFsIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIFNl\ncSBnZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgLy8gZ2V0IHNlcXVlbmNlIHN0cmF0ZWd5IGZy\nb20gbWV0YWRhdGEKICAgICAgICBpbnQgc3RyYXRlZ3k7CiAgICAgICAgaWYg\nKGZtZCA9PSBudWxsKQogICAgICAgICAgICBzdHJhdGVneSA9IG1ldGEuZ2V0\nSWRlbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RyYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOwoKICAgICAgICAv\nLyB3ZSBjYW4gaGFuZGxlIG5vbi1uYXRpdmUgc3RyYXRlZ2llcyB3aXRob3V0\nIHRoZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgc3dpdGNoIChzdHJhdGVneSkg\newogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX0hFWDoK\nICAgICAgICAgICAgICAgIHJldHVybiBVVUlESGV4U2VxLmdldEluc3RhbmNl\nKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfU1RS\nSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURTdHJpbmdTZXEuZ2V0\nSW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMu\nU0VRVUVOQ0U6CiAgICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIHNt\nZCA9IChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICA/IG1ldGEu\nZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRhKCkKICAgICAgICAgICAgICAg\nICAgICA6IGZtZC5nZXRWYWx1ZVNlcXVlbmNlTWV0YURhdGEoKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBzbWQuZ2V0SW5zdGFuY2UoX2xvYWRlcik7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyB1c2Ugc3Rv\ncmUgbWFuYWdlciBmb3IgbmF0aXZlIHNlcXVlbmNlCiAgICAgICAgICAgICAg\nICBpZiAoZm1kID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0\naGlzIHdpbGwgcmV0dXJuIGEgc2VxdWVuY2UgZXZlbiBmb3IgYXBwIGlkIGNs\nYXNzZXMsIAogICAgICAgICAgICAgICAgICAgIC8vIHdoaWNoIGlzIHdoYXQg\nd2Ugd2FudCBmb3IgYmFja3dhcmRzLWNvbXBhdGliaWxpdHkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gX3N0b3JlLmdldERhdGFTdG9yZUlkU2VxdWVu\nY2UobWV0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXR1cm4gX3N0b3JlLmdldFZhbHVlU2VxdWVuY2UoZm1kKTsKICAgICAgICB9\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIExvY2tpbmcKICAgIC8v\nLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgbG9jayhPYmplY3Qgb2JqLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRy\ndWUpOyAvLyBoYXZlIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdheXMgTk9O\nRQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2sob2JqLCBfZmMuZ2V0\nV3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0KCksIGNhbGwp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9i\namVjdCBvYmosIGludCBsZXZlbCwgaW50IHRpbWVvdXQsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24o\nKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJv\nY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNh\nbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChz\nbSA9PSBudWxsIHx8ICFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgIF9sbS5sb2NrKHNtLCBsZXZlbCwg\ndGltZW91dCwgbnVsbCk7CiAgICAgICAgICAgIHNtLnJlYWRMb2NrZWQobGV2\nZWwsIGxldmVsKTsgLy8gdXNlIHNhbWUgbGV2ZWwgZm9yIGZ1dHVyZSB3cml0\nZQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGxvY2tBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOyAvLyBoYXZl\nIHRvIHN5bmMgb3IgbG9jayBsZXZlbCBhbHdheXMgTk9ORQogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGxvY2tBbGwob2JqcywgX2ZjLmdldFdyaXRlTG9j\na0xldmVsKCksIF9mYy5nZXRMb2NrVGltZW91dCgpLAogICAgICAgICAgICAg\nICAgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGxvY2tBbGwoQ29sbGVjdGlvbiBvYmpzLCBpbnQgbGV2ZWwsIGludCB0aW1l\nb3V0LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBp\nZiAob2Jqcy5zaXplKCkgPT0gMSkgewogICAgICAgICAgICBsb2NrKG9ianMu\naXRlcmF0b3IoKS5uZXh0KCksIGxldmVsLCB0aW1lb3V0LCBjYWxsKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIENvbGxlY3Rpb24g\nc21zID0gbmV3IEFycmF5TGlzdChvYmpzLnNpemUoKSk7CiAgICAgICAgICAg\nIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2JqID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAg\nICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAgICAgJiBP\ncENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYg\nc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICAgICAgc21zLmFk\nZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9sbS5sb2NrQWxs\nKHNtcywgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5l\neHQoKSkucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBD\nb25uZWN0aW9uCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29s\nZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAvLyB0aGlzIG1ldGhvZCBkb2Vz\nIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRvIGFsbG93IGEgZGlmZmVyZW50\nCiAgICAgICAgLy8gdGhyZWFkIHRvIGJlIGFibGUgdG8gY2FuY2VsIG9uIGEg\nbG9ja2VkLXVwIHBlcnNpc3RlbmNlIG1hbmFnZXIKCiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIHdlJ3Jl\nIGZsdXNoaW5nLCBoYXZlIHRvIHNldCByb2xsYmFjayBvbmx5IC0tIGRvIHRo\naXMgYmVmb3JlIHdlCiAgICAgICAgICAgIC8vIGF0dGVtcHQgdG8gY2FuY2Vs\nLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2FuY2VsIG1pZ2h0IGNhc2UgdGhl\nCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHRvIGNvbXBsZXRlIGJlZm9y\nZSB3ZSBoYXZlIGEgY2hhbmNlIHRvIHNldCB0aGUKICAgICAgICAgICAgLy8g\ncm9sbGJhY2sgb25seSBmbGFnCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAgICAgICAgIHNl\ndFJvbGxiYWNrT25seUludGVybmFsKCk7CiAgICAgICAgICAgIHJldHVybiBf\nc3RvcmUuY2FuY2VsQWxsKCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0Q29ubmVjdGlvbigpIHsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRp\nb25zKCkuY29udGFpbnMKICAgICAgICAgICAgKF9jb25mLk9QVElPTl9EQVRB\nU1RPUkVfQ09OTkVDVElPTikpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgiY29ubi1ub3Qtc3VwcG9ydGVk\nIikpOwoKICAgICAgICByZXR1cm4gX3N0b3JlLmdldENsaWVudENvbm5lY3Rp\nb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNDb25uZWN0aW9u\nKCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEZMQUdfUkVUQUlORURfQ09OTikgIT0gMDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRlbGwgc3RvcmUgdG8gcmV0YWluIGNvbm5lY3Rpb24gaWYg\nd2UgaGF2ZW4ndCBhbHJlYWR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncmV0YWluQ29ubmVjdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfUkVUQUlORURfQ09OTikgPT0gMCkgewogICAgICAgICAgICBfc3RvcmUu\ncmV0YWluQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlbGwgc3RvcmUgdG8gcmVsZWFzZSBjb25uZWN0aW9uIGlmIHdlIGhh\ndmUgcmV0YWluZWQgb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVs\nZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX1JFVEFJTkVEX0NPTk4pICE9IDApIHsKICAgICAgICAgICAgX3N0b3JlLnJl\nbGVhc2VDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19SRVRBSU5FRF9DT05OOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8v\nLy8KICAgIC8vIENhY2hlCiAgICAvLy8vLy8vLy8KCiAgICBwdWJsaWMgQ29s\nbGVjdGlvbiBnZXRNYW5hZ2VkT2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRNYW5hZ2VkU3Rh\ndGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBnZXRUcmFuc2FjdGlvbmFsT2JqZWN0cygpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXRUcmFuc2Fj\ndGlvbmFsU3RhdGVzKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgQ29sbGVjdGlvbiBnZXRQZW5kaW5nVHJhbnNhY3Rpb25hbE9iamVjdHMo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxl\nY3Rpb24KICAgICAgICAgICAgICAgIChnZXRQZW5kaW5nVHJhbnNhY3Rpb25h\nbFN0YXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENv\nbGxlY3Rpb24gZ2V0RGlydHlPYmplY3RzKCkgewogICAgICAgIGJlZ2luT3Bl\ncmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKGdldERpcnR5U3RhdGVz\nKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRPcmRlckRpcnR5T2JqZWN0cygpIHsKICAgICAgICByZXR1cm4gX29yZGVy\nRGlydHk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T3JkZXJEaXJ0eU9i\namVjdHMoYm9vbGVhbiBvcmRlcikgewogICAgICAgIF9vcmRlckRpcnR5ID0g\nb3JkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjb3B5IG9m\nIGFsbCBtYW5hZ2VkIHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAgICBwcm90\nZWN0ZWQgQ29sbGVjdGlvbiBnZXRNYW5hZ2VkU3RhdGVzKCkgewogICAgICAg\nIHJldHVybiBfY2FjaGUuY29weSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0ZSBtYW5h\nZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gZ2V0VHJh\nbnNhY3Rpb25hbFN0YXRlcygpIHsKICAgICAgICBpZiAoX3RyYW5zQ2FjaGUg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZ\nX0xJU1Q7CiAgICAgICAgcmV0dXJuIF90cmFuc0NhY2hlLmNvcHkoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5\nIHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVj\ndGlvbiBnZXREaXJ0eVN0YXRlcygpIHsKICAgICAgICBpZiAoX3RyYW5zQ2Fj\naGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVN\nUFRZX0xJU1Q7CgogICAgICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5RGly\ndHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvcHkgb2Yg\nYWxsIHN0YXRlIG1hbmFnZXJzIHdoaWNoIHdpbGwgYmVjb21lCiAgICAgKiB0\ncmFuc2FjdGlvbmFsIHVwb24gdGhlIG5leHQgdHJhbnNhY3Rpb24uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldFBlbmRpbmdUcmFuc2Fj\ndGlvbmFsU3RhdGVzKCkgewogICAgICAgIGlmIChfcGVuZGluZyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsK\nICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdChfcGVuZGluZyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hlZCBTdGF0ZU1hbmFnZXIg\nZm9yIHRoZSBpbnN0YW5jZSB0aGF0IGhhZCB0aGUgZ2l2ZW4gb2lkLgogICAg\nICogVGhpcyBtZXRob2QgbXVzdCBub3QgYmUgY2FsbGVkIG11bHRpcGxlIHRp\nbWVzIGZvciBuZXcgaW5zdGFuY2VzLgogICAgICoKICAgICAqIEBwYXJhbSBp\nZCB0aGUgaWQgcHJldmlvdXNseSB1c2VkIGJ5IHRoZSBpbnN0YW5jZQogICAg\nICogQHBhcmFtIHNtIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgaW5zdGFu\nY2U7IGlmIHRoZSBzdGF0ZQogICAgICogbWFuYWdlciBpcyB0cmFuc2llbnQs\nIHdlJ2xsIHN0b3AgbWFuYWdpbmcgdGhlIGluc3RhbmNlOwogICAgICogaWYg\naXQgaGFzIHVwZGF0ZWQgaXRzIG9pZCwgd2UnbGwgcmUtY2FjaGUgdW5kZXIg\ndGhlIG5ldyBvaWQKICAgICAqIEBwYXJhbSBzdGF0dXMgb25lIG9mIG91ciBT\nVEFUVVMgY29uc3RhbnRzIGRlc2NyaWJpbmcgd2h5IHdlJ3JlCiAgICAgKiBz\nZXR0aW5nIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHZvaWQgc2V0\nU3RhdGVNYW5hZ2VyKE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSwg\naW50IHN0YXR1cykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICAgICAgICAgICAg\nY2FzZSBTVEFUVVNfSU5JVDoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUu\nYWRkKHNtKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgU1RBVFVTX1RSQU5TSUVOVDoKICAgICAgICAgICAgICAg\nICAgICBfY2FjaGUucmVtb3ZlKGlkLCBzbSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNUQVRVU19PSURfQVNT\nSUdOOgogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5hc3NpZ25PYmplY3RJ\nZChpZCwgc20pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBTVEFUVVNfQ09NTUlUX05FVzoKICAgICAgICAgICAg\nICAgICAgICBfY2FjaGUuY29tbWl0TmV3KGlkLCBzbSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBOb3RpZnkgdGhlIGJyb2tlciB0aGF0IHRoZSBnaXZlbiBzdGF0\nZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBv\nZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rp\nb24uCiAgICAgKi8KICAgIHZvaWQgYWRkVG9UcmFuc2FjdGlvbihTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgLy8gd2Ugb25seSBhZGQgY2xlYW4g\naW5zdGFuY2VzIG5vdzsgZGlydHkgaW5zdGFuY2VzIGFyZSBhZGRlZCBpbgog\nICAgICAgIC8vIHRoZSBzZXREaXJ0eSBjYWxsYmFjawogICAgICAgIGlmIChz\nbS5pc0RpcnR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJhbnNDYWNo\nZSA9PSBudWxsKQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXcg\nVHJhbnNhY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE5vdGlmeSB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0\nIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgcmVt\nb3ZlZCBmcm9tIHRoZSBzZXQgb2YgaW5zdGFuY2VzIGludm9sdmVkIGluIHRo\nZSBjdXJyZW50IHRyYW5zYWN0aW9uLgogICAgICovCiAgICB2b2lkIHJlbW92\nZUZyb21UcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfdHJh\nbnNDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUu\ncmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9IG51\nbGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAgX2Rl\ncmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgZ2l2ZW4gaW5zdGFuY2UgaGFz\nIGJlZW4gZGlydGllZC4gVGhpcwogICAgICogbm90aWZpY2F0aW9uIGlzIGdp\ndmVuIHdoZW4gYW4gb2JqZWN0IGZpcnN0IHRyYW5zaXRpb25zIHRvIGEgZGly\ndHkgc3RhdGUsCiAgICAgKiBhbmQgZXZlcnkgdGltZSB0aGUgb2JqZWN0IGlz\nIG1vZGlmaWVkIGJ5IHRoZSB1c2VyIHRoZXJlYWZ0ZXIuCiAgICAgKi8KICAg\nIHZvaWQgc2V0RGlydHkoU3RhdGVNYW5hZ2VySW1wbCBzbSwgYm9vbGVhbiBm\naXJzdERpcnR5KSB7CiAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKQog\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSF9SRVFVSVJFRDsKCiAg\nICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgIV9zYXZlcG9pbnRz\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoX3NhdmVwb2ludENhY2hl\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUgPSBu\nZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuYWRk\nKHNtKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaXJzdERpcnR5ICYmIHNt\nLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAgICAgIGxvY2soKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGNhY2hlIGRpcnR5\nIGluc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAoX3RyYW5zQ2FjaGUgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5ldyBU\ncmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOwogICAgICAgICAgICAg\nICAgX3RyYW5zQ2FjaGUuYWRkRGlydHkoc20pOwoKICAgICAgICAgICAgICAg\nIC8vIGFsc28gcmVjb3JkIHRoYXQgdGhlIGNsYXNzIGlzIGRpcnR5CiAgICAg\nICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAg\nICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3MuYWRkKHNtLmdldE1l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSBpZiAoc20uaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoX2RlbGV0ZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgICAgIF9kZWxldGVkQ2xzcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAg\nICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0\nYSgpLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChfdXBkYXRlZENsc3MgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX3VwZGF0ZWRDbHNzID0g\nbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBfdXBkYXRlZENs\nc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0cmFj\na2luZyBjaGFuZ2VzIGFuZCB0aGlzIGluc3RhbmNlIHdhc24ndCBhbHJlYWR5\nIGRpcnR5LAogICAgICAgICAgICAgICAgLy8gYWRkIHRvIGNoYW5nZWQgc2V0\nOyB3ZSB1c2UgdGhpcyBmb3IgZGV0ZWN0aW5nIGluc3RhbmNlcyB0aGF0CiAg\nICAgICAgICAgICAgICAvLyBlbnRlciB0aGUgdHJhbnNhY3Rpb24gZHVyaW5n\nIHByZSBzdG9yZQogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFH\nX1BSRVNUT1JJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nX3RyYW5zQWRkaXRpb25zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIF90cmFuc0FkZGl0aW9ucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAg\nICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zLmFkZChzbSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgYnJva2VyIHRoYXQgdGhlIGdp\ndmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSBhZGRlZCB0byB0\naGUgc2V0IG9mIGluc3RhbmNlcyB0aGF0IHdpbGwgYmVjb21lIHRyYW5zYWN0\naW9uYWwKICAgICAqIG9uIHRoZSBuZXh0IHRyYW5zYWN0aW9uCiAgICAgKi8K\nICAgIHZvaWQgYWRkVG9QZW5kaW5nVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9wZW5kaW5nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3BlbmRp\nbmcuYWRkKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3Rp\nZnkgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgdGhhdCB0aGUgZ2l2ZW4gc3Rh\ndGUgbWFuYWdlciBzaG91bGQKICAgICAqIGJlIHJlbW92ZWQgZnJvbSB0aGUg\nc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZlZCBpbiB0aGUgbmV4dCB0cmFuc2Fj\ndGlvbi4KICAgICAqLwogICAgdm9pZCByZW1vdmVGcm9tUGVuZGluZ1RyYW5z\nYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBfcGVuZGluZy5yZW1vdmUoc20pOwogICAg\nICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhc20uaXNQZXJz\naXN0ZW50KCkpCiAgICAgICAgICAgICAgICBfZGVyZWZDYWNoZS5yZW1vdmUo\nc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIGRlcmVm\nZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0IHRvIHRoZSBwZXJzaXN0ZW5jZSBt\nYW5hZ2VyJ3MgY2FjaGUuCiAgICAgKiBPbiBmbHVzaCwgdGhlc2Ugb2JqZWN0\ncyB3aWxsIGJlIGRlbGV0ZWQuCiAgICAgKi8KICAgIHZvaWQgYWRkRGVyZWZl\ncmVuY2VkRGVwZW5kZW50KFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgd2Un\ncmUgaW4gdGhlIG1pZGRsZSBvZiBmbHVzaCBhbmQgaW50cm9kdWNpbmcgbW9y\nZSBkZXJlZnMKICAgICAgICAgICAgLy8gdmlhIGluc3RhbmNlIGNhbGxiYWNr\ncywgYWRkIHRoZW0gdG8gdGhlIHNwZWNpYWwgYWRkaXRpb25zIHNldAogICAg\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfREVSRUZERUxFVElORykgIT0g\nMCkgewogICAgICAgICAgICAgICAgaWYgKF9kZXJlZkFkZGl0aW9ucyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIF9kZXJlZkFkZGl0aW9ucyA9IG5l\ndyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICBfZGVyZWZBZGRpdGlvbnMu\nYWRkKHNtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGlmIChfZGVyZWZDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9kZXJlZkNhY2hlID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAg\nIF9kZXJlZkNhY2hlLmFkZChzbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4g\ncHJldmlvdXNseSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdCBmcm9t\nIHRoZQogICAgICogY2FjaGUuIEl0IGlzIG5vdyByZWZlcmVuY2VkLgogICAg\nICovCiAgICB2b2lkIHJlbW92ZURlcmVmZXJlbmNlZERlcGVuZGVudChTdGF0\nZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9IGZhbHNlOwogICAg\nICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zICE9IG51bGwpCiAgICAgICAg\nICAgICAgICByZW1vdmVkID0gX2RlcmVmQWRkaXRpb25zLnJlbW92ZShzbSk7\nCiAgICAgICAgICAgIGlmICghcmVtb3ZlZCAmJiAoX2RlcmVmQ2FjaGUgPT0g\nbnVsbCB8fCAhX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKSkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJub3QtZGVyZWZlZCIsCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9u\ncy50b1N0cmluZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4KICAgICAg\nICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZElu\nc3RhbmNlKCkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhdGFsKHRydWUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkaXJ0eVR5cGUoQ2xh\nc3MgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3MgPSBuZXcgSGFzaFNl\ndCgpOwogICAgICAgICAgICBfdXBkYXRlZENsc3MuYWRkKGNscyk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFBlcnNp\nc3RlZFR5cGVzKCkgewogICAgICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBu\ndWxsIHx8IF9wZXJzaXN0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX3BlcnNpc3Rl\nZENsc3MpOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFVwZGF0\nZWRUeXBlcygpIHsKICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzID09IG51bGwg\nfHwgX3VwZGF0ZWRDbHNzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIENvbGxl\nY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX3VwZGF0ZWRDbHNzKTsK\nICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXREZWxldGVkVHlwZXMo\nKSB7CiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9PSBudWxsIHx8IF9kZWxl\ndGVkQ2xzcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0\naW9ucy5FTVBUWV9MSVNUOwogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51\nbm1vZGlmaWFibGVDb2xsZWN0aW9uKF9kZWxldGVkQ2xzcyk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8KICAgIC8vIENsb3NpbmcKICAgIC8vLy8vLy8vLy8v\nCgogICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9jbG9zZWQgIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nbG9zZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlm\nIGNsb3NpbmcgaW4gYW4gYWN0aXZlIGxvY2FsIHRyYW5zCiAgICAgICAgICAg\nIGlmICghX21hbmFnZWQgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAw\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiYWN0aXZlIikpOwoKICAgICAgICAgICAgLy8gb25s\neSBjbG9zZSBpZiBub3QgYWN0aXZlOyBpZiBhY3RpdmUgbWFuYWdlZCB0cmFu\ncyB3YWl0CiAgICAgICAgICAgIC8vIGZvciBjb21wbGV0aW9uCiAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX0NMT1NFX0lOVk9LRUQ7CgogICAgICAgICAg\nICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAg\nICAgICAgZnJlZSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEZyZWUgdGhlIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgcGVyc2lzdGVu\nY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZnJlZSgp\nIHsKICAgICAgICBSdW50aW1lRXhjZXB0aW9uIGVyciA9IG51bGw7CiAgICAg\nICAgaWYgKChfYXV0b0RldGFjaCAmIERFVEFDSF9DTE9TRSkgIT0gMCkgewog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50\nZXJuYWwoX2NhbGwpOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBlcnIgPSByZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgX3N5bmMgPSBudWxsOwogICAg\nICAgIF91c2VyT2JqZWN0cyA9IG51bGw7CiAgICAgICAgX2NhY2hlLmNsZWFy\nKCk7CiAgICAgICAgX3RyYW5zQ2FjaGUgPSBudWxsOwogICAgICAgIF9wZXJz\naXN0ZWRDbHNzID0gbnVsbDsKICAgICAgICBfdXBkYXRlZENsc3MgPSBudWxs\nOwogICAgICAgIF9kZWxldGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlcmVm\nQ2FjaGUgPSBudWxsOwogICAgICAgIF9wZW5kaW5nID0gbnVsbDsKICAgICAg\nICBfbG9hZGVyID0gbnVsbDsKICAgICAgICBfdHJhbnNFdmVudE1hbmFnZXIg\nPSBudWxsOwogICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyID0gbnVsbDsKCiAg\nICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZlOwogICAgICAgIHdoaWxlIChf\nc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2ZXBvaW50cy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgc2F2ZSA9CiAgICAgICAgICAgICAgICAoT3BlbkpQ\nQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVtb3ZlKF9zYXZlcG9pbnRzLnNp\nemUoKSAtIDEpOwogICAgICAgICAgICBzYXZlLnJlbGVhc2UoZmFsc2UpOwog\nICAgICAgIH0KICAgICAgICBfc2F2ZXBvaW50cyA9IG51bGw7CiAgICAgICAg\nX3NhdmVwb2ludENhY2hlID0gbnVsbDsKCiAgICAgICAgaWYgKF9xdWVyaWVz\nICE9IG51bGwpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBf\ncXVlcmllcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAoKFF1ZXJ5KSBp\ndHIubmV4dCgpKS5jbG9zZVJlc291cmNlcygpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9xdWVyaWVzID0gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIGlmIChfZXh0ZW50cyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIEV4dGVudCBlOwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IF9leHRlbnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICBlID0gKEV4dGVudCkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZS5j\nbG9zZUFsbCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIF9leHRlbnRzID0gbnVsbDsKICAgICAgICB9CgogICAg\nICAgIHRyeSB7IHJlbGVhc2VDb25uZWN0aW9uKCk7IH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHt9CgogICAgICAgIF9sbS5jbG9zZSgpOwogICAg\nICAgIF9zdG9yZS5jbG9zZSgpOwogICAgICAgIF9jbG9zZWQgPSBuZXcgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKCk7CiAgICAgICAgX2ZsYWdzID0gMDsKCiAg\nICAgICAgaWYgKGVyciAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBlcnI7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU3luY2hy\nb25pemF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAg\nICAgICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAg\nICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFN0YXRlIG1hbmFnZW1lbnQKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBuZXdJbnN0YW5jZShD\nbGFzcyBjbHMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgIGlm\nIChjbHMuaXNJbnRlcmZhY2UoKSkgewogICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5j\nZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9hZGVy\nLCB0cnVlKTsKICAgICAgICAgICAgY2xzID0gbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CiAgICAgICAgfSBlbHNlIGlmIChNb2RpZmllci5pc0Fic3RyYWN0\nKGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbihfbG9jLmdldAogICAgICAg\nICAgICAgICAgKCJuZXctYWJzdHJhY3QiLCBjbHMpLmdldE1lc3NhZ2UoKSk7\nCgogICAgICAgIC8vIDEuNSBkb2Vzbid0IGluaXRpYWxpemUgY2xhc3NlcyB3\naXRob3V0IGEgdHJ1ZSBDbGFzcy5mb3JOYW1lCiAgICAgICAgaWYgKCFQQ1Jl\nZ2lzdHJ5LmlzUmVnaXN0ZXJlZChjbHMpKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNscy5nZXROYW1lKCks\nIHRydWUsIGNscy5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShjbHMsIG51\nbGwsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldE9iamVj\ndElkKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgaWYgKG9iaiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlQ2FwYWJsZSkKICAg\nICAgICAgICAgcmV0dXJuICgoUGVyc2lzdGVuY2VDYXBhYmxlKSBvYmopLnBj\nRmV0Y2hPYmplY3RJZCgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZ2V0TG9ja0xldmVsKE9iamVjdCBvKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChvID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IGdldFN0YXRlTWFuYWdlcihvKTsK\nICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIExv\nY2tMZXZlbHMuTE9DS19OT05FOwogICAgICAgIHJldHVybiBnZXRMb2NrTWFu\nYWdlcigpLmdldExvY2tMZXZlbChzbSk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBnZXRWZXJzaW9uKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNl\nQ2FwYWJsZSkKICAgICAgICAgICAgcmV0dXJuICgoUGVyc2lzdGVuY2VDYXBh\nYmxlKSBvYmopLnBjR2V0VmVyc2lvbigpOwogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoT2JqZWN0IG9i\naikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAob2JqIGlu\nc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAgICByZXR1\ncm4gKChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iaikucGNJc0RpcnR5KCk7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzVHJhbnNhY3Rpb25hbChPYmplY3Qgb2JqKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBQZXJzaXN0ZW5j\nZUNhcGFibGUpCiAgICAgICAgICAgIHJldHVybiAoKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSkgb2JqKS5wY0lzVHJhbnNhY3Rpb25hbCgpOwogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlcnNpc3Rl\nbnQoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICBpZiAob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQogICAg\nICAgICAgICByZXR1cm4gKChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iaikucGNJ\nc1BlcnNpc3RlbnQoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNOZXcoT2JqZWN0IG9iaikgewogICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgUGVy\nc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAgICByZXR1cm4gKChQZXJzaXN0\nZW5jZUNhcGFibGUpIG9iaikucGNJc05ldygpOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlbGV0ZWQoT2Jq\nZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAo\nb2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAg\nICByZXR1cm4gKChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iaikucGNJc0RlbGV0\nZWQoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNEZXRhY2hlZChPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYg\nKCEob2JqIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvYmo7CiAgICAgICAgQm9v\nbGVhbiBkZXRhY2hlZCA9IHBjLnBjSXNEZXRhY2hlZCgpOwogICAgICAgIGlm\nIChkZXRhY2hlZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZGV0YWNo\nZWQuYm9vbGVhblZhbHVlKCk7CgogICAgICAgIC8vIGxhc3QgcmVzb3J0OiBp\nbnN0YW5jZSBpcyBkZXRhY2hlZCBpZiBpdCBoYXMgYSBzdG9yZSByZWNvcmQK\nICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0\nYVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0\nYShwYy5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBPYmpl\nY3Qgb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKHBjLCBtZXRhKTsKICAg\nICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICByZXR1cm4gZmluZChvaWQsIG51bGwsIEVYQ0xVREVfQUxM\nLCBudWxsLCAwKSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIGdldFN0YXRlTWFuYWdlcihPYmplY3Qgb2JqKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBnZXRTdGF0ZU1h\nbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gaW5zdGFu\nY2UsIG9yIG51bGwuCiAgICAgKgogICAgICogQHBhcmFtIGFzc2VydFRoaXND\nb250ZXh0IGlmIHRydWUsIHRob3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBnaXZl\nbgogICAgICogb2JqZWN0IGlzIG1hbmFnZWQgYnkgYW5vdGhlciBicm9rZXIK\nICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChPYmplY3Qgb2JqLAogICAgICAgIGJvb2xlYW4gYXNz\nZXJ0VGhpc0NvbnRleHQpIHsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2Yg\nUGVyc2lzdGVuY2VDYXBhYmxlKSB7CiAgICAgICAgICAgIFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIG9iajsKICAgICAg\nICAgICAgaWYgKHBjLnBjR2V0R2VuZXJpY0NvbnRleHQoKSA9PSB0aGlzKQog\nICAgICAgICAgICAgICAgcmV0dXJuIChTdGF0ZU1hbmFnZXJJbXBsKSBwYy5w\nY0dldFN0YXRlTWFuYWdlcigpOwogICAgICAgICAgICBpZiAoYXNzZXJ0VGhp\nc0NvbnRleHQgJiYgcGMucGNHZXRHZW5lcmljQ29udGV4dCgpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgibm90LW1hbmFnZWQiLAogICAgICAgICAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVu\nIG9pZC4KICAgICAqCiAgICAgKiBAcGFyYW0gYWxsb3dOZXcgaWYgdHJ1ZSwg\nb2JqZWN0cyBtYWRlIHBlcnNpc3RlbnQgaW4gdGhlIGN1cnJlbnQKICAgICAq\nIHRyYW5zYWN0aW9uIHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIHNlYXJjaDsg\naWYKICAgICAqIG11bHRpcGxlIG5ldyBvYmplY3RzIG1hdGNoIHRoZSBnaXZl\nbiBvaWQsIGl0IGlzCiAgICAgKiB1bmRlZmluZWQgd2hpY2ggd2lsbCBiZSBy\nZXR1cm5lZAogICAgICovCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1w\nbCBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChPYmplY3Qgb2lkLAogICAgICAg\nIGJvb2xlYW4gYWxsb3dOZXcpIHsKICAgICAgICByZXR1cm4gX2NhY2hlLmdl\ndEJ5SWQob2lkLCBhbGxvd05ldyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGdpdmVuIGluc3RhbmNlIGFzIGEge0BsaW5rIFBlcnNpc3Rl\nbmNlQ2FwYWJsZX0uCiAgICAgKiBJZiB0aGUgaW5zdGFuY2UgaXMgbm90IG1h\nbmFnZWFibGUgdGhyb3cgdGhlIHByb3BlciBleGNlcHRpb24uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZUNhcGFibGUgYXNzZXJ0UGVyc2lz\ndGVuY2VDYXBhYmxlKE9iamVjdCBvYmopIHsKICAgICAgICBpZiAob2JqID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChv\nYmogaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZUNhcGFibGUpCiAgICAgICAgICAg\nIHJldHVybiAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvYmo7CgogICAgICAgIC8v\nIGNoZWNrIGZvciBkaWZmZXJlbmNlIGluc3RhbmNlcyBvZiB0aGUgUGVyc2lz\ndGVuY2VDYXBhYmxlIGludGVyZmFjZQogICAgICAgIC8vIGFuZCB0aHJvdyBh\nIGJldHRlciBlcnJvciB0aGF0IG1lbnRpb25zIHRoZSBjbGFzcyBsb2FkZXJz\nCiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9IG9iai5nZXRDbGFzcygpLmdldElu\ndGVyZmFjZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaW50ZnMgIT0g\nbnVsbCAmJiBpIDwgaW50ZnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\naWYgKGludGZzW2ldLmdldE5hbWUoKS5lcXVhbHMoUGVyc2lzdGVuY2VDYXBh\nYmxlLmNsYXNzLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1sb2FkZXItZGlmZmVy\nZW50IiwKICAgICAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5n\nKG9iaiksCiAgICAgICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzLmdldENsYXNzTG9hZGVyKCksCiAgICAgICAgICAgICAgICAgICAg\naW50ZnNbaV0uZ2V0Q2xhc3NMb2FkZXIoKSkpLnNldEZhaWxlZE9iamVjdChv\nYmopOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3Qg\nZW5oYW5jZWQKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgicGMtY2FzdCIsCiAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJp\nbmcob2JqKSkpLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQoKICAgIC8v\nLy8vLy8vLwogICAgLy8gVXRpbHMKICAgIC8vLy8vLy8vLwoKICAgIHB1Ymxp\nYyB2b2lkIGFzc2VydE9wZW4oKSB7CiAgICAgICAgaWYgKF9jbG9zZWQgIT0g\nbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiY2xvc2VkIiksIF9jbG9zZWQpLgogICAgICAgICAg\nICAgICAgc2V0RmF0YWwodHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE5vVHJhbnNhY3Rpb25FeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1hY3RpdmUi\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBleGNlcHRpb24gaWYg\nYSB0cmFuc2FjdGlvbi1yZWxhdGVkIG9wZXJhdGlvbiBpcyBhdHRlbXB0ZWQg\nYW5kCiAgICAgKiBubyB0cmFuc2FjdGlvbiBpcyBhY3RpdmUuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigp\nIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCkgewogICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAgJiYgIV9ub250cmFuc1JlYWQp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vbi10cmFucy1yZWFkIikpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGFzc2VydFdyaXRlT3BlcmF0aW9uKCkgewogICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDAgJiYgKCFfbm9udHJhbnNXcml0\nZQogICAgICAgICAgICB8fCAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhS\nRUFEKSAhPSAwKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE5vVHJhbnNhY3Rp\nb25FeGNlcHRpb24oX2xvYy5nZXQoIndyaXRlLW9wZXJhdGlvbiIpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBvYmplY3Qgbm90IGZvdW5k\nIGV4Y2VwdGlvbiBjb250YWluaW5nIG5lc3RlZCBleGNlcHRpb25zCiAgICAg\nKiBmb3IgYWxsIG9mIHRoZSBnaXZlbiBmYWlsZWQgb2JqZWN0cy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24g\nbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24KICAgICAgICAoQ29sbGVjdGlv\nbiBmYWlsZWQpIHsKICAgICAgICBUaHJvd2FibGVbXSB0ID0gbmV3IFRocm93\nYWJsZVtmYWlsZWQuc2l6ZSgpXTsKICAgICAgICBpbnQgaWR4ID0gMDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZhaWxlZC5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOyBpZHgrKykKICAgICAgICAgICAgdFtpZHhdID0gbmV3\nIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGl0ci5uZXh0KCkpOwogICAgICAg\nIHJldHVybiBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkLCB0\nKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwogICAgLy8gRmluZENhbGxiYWNrcyBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgT2Jq\nZWN0IHByb2Nlc3NBcmd1bWVudChPYmplY3Qgb2lkKSB7CiAgICAgICAgcmV0\ndXJuIG9pZDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHByb2Nlc3NSZXR1\ncm4oT2JqZWN0IG9pZCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAg\nICAgIHJldHVybiAoc20gPT0gbnVsbCkgPyBudWxsIDogc20uZ2V0TWFuYWdl\nZEluc3RhbmNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBvZiBt\nYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIE1hbmFnZWRDYWNoZSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWFw\nIF9tYWluOyAvLyBvaWQgLT4gc20KICAgICAgICBwcml2YXRlIE1hcCBfY29u\nZmxpY3RzID0gbnVsbDsgLy8gY29uZmxpY3Qgb2lkIC0+IG5ldyBzbQogICAg\nICAgIHByaXZhdGUgTWFwIF9uZXdzID0gbnVsbDsgLy8gdG1wIGlkIC0+IG5l\ndyBzbQogICAgICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfZW1iZWRzID0gbnVs\nbDsgLy8gZW1iZWRkZWQvbm9uLXBlcnNpc3RlbnQgc21zCgogICAgICAgIC8q\nKgogICAgICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgcHJpbWFyeSBjYWNo\nZSBtYXAuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIE1hbmFnZWRDYWNo\nZShNYXAgY2FjaGUpIHsKICAgICAgICAgICAgX21haW4gPSBjYWNoZTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5z\ndGFuY2UgZm9yIHRoZSBnaXZlbiBvaWQsIG9wdGlvbmFsbHkgYWxsb3dpbmcK\nICAgICAgICAgKiBuZXcgaW5zdGFuY2VzLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBTdGF0ZU1hbmFnZXJJbXBsIGdldEJ5SWQoT2JqZWN0IG9pZCwg\nYm9vbGVhbiBhbGxvd05ldykgewogICAgICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAg\nIC8vIGNoZWNrIG1haW4gY2FjaGUgZm9yIG9pZAogICAgICAgICAgICBTdGF0\nZU1hbmFnZXJJbXBsIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLmdl\ndChvaWQpOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtMjsKICAg\nICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8v\nIGlmIGl0J3MgYSBuZXcgaW5zdGFuY2UsIHdlIGtub3cgaXQncyB0aGUgb25s\neSBtYXRjaCwgYmVjYXVzZQogICAgICAgICAgICAgICAgLy8gb3RoZXIgcGVy\ncyBpbnN0YW5jZXMgb3ZlcnJpZGUgbmV3IGluc3RhbmNlcyBpbiBfY2FjaGUK\nICAgICAgICAgICAgICAgIGlmIChzbS5pc05ldygpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiAoYWxsb3dOZXcpID8gc20gOiBudWxsOwogICAgICAg\nICAgICAgICAgaWYgKCFhbGxvd05ldyB8fCAhc20uaXNEZWxldGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAgICAg\nIC8vIHNtIGlzIGRlbGV0ZWQ7IGNoZWNrIGNvbmZsaWN0IGNhY2hlCiAgICAg\nICAgICAgICAgICBpZiAoX2NvbmZsaWN0cyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgc20yID0gKFN0YXRlTWFuYWdlckltcGwpIF9jb25mbGlj\ndHMuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNtMiAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc20yOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBh\ndCB0aGlzIHBvaW50IHNtIGlzIG51bGwgb3IgZGVsZXRlZDsgY2hlY2sgdGhl\nIG5ldyBjYWNoZSBmb3IKICAgICAgICAgICAgLy8gYW55IG1hdGNoZXMuIHRo\naXMgYWxsb3dzIHVzIHRvIG1hdGNoIGFwcCBpZCBvYmplY3RzIHRvIG5ldwog\nICAgICAgICAgICAvLyBpbnN0YW5jZXMgd2l0aG91dCBwZXJtYW5hbnQgb2lk\ncwogICAgICAgICAgICBpZiAoYWxsb3dOZXcgJiYgX25ld3MgIT0gbnVsbCAm\nJiAhX25ld3MuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzbTIgPSAo\nU3RhdGVNYW5hZ2VySW1wbCkgX25ld3MuZ2V0KG9pZCk7CiAgICAgICAgICAg\nICAgICBpZiAoc20yICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHNtMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc207\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsIHRoaXMg\nbWV0aG9kIHdoZW4gYSBuZXcgc3RhdGUgbWFuYWdlciBpbml0aWFsaXplcyBp\ndHNlbGYuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkKFN0\nYXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKCFzbS5pc1Bl\ncnNpc3RlbnQoKSB8fCBzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChfZW1iZWRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nX2VtYmVkcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5jZUhhc2hT\nZXQuV0VBSyk7CiAgICAgICAgICAgICAgICBfZW1iZWRzLmFkZChzbSk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGluaXRpYWxpemluZyBuZXcgaW5zdGFuY2U7IHB1dCBpbiBuZXcg\nY2FjaGUgYmVjYXVzZSB3b24ndCBoYXZlCiAgICAgICAgICAgIC8vIHBlcm1h\nbmVudCBvaWQgeWV0CiAgICAgICAgICAgIGlmIChzbS5pc05ldygpKSB7CiAg\nICAgICAgICAgICAgICBpZiAoX25ld3MgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBfbmV3cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAg\nICBfbmV3cy5wdXQoc20uZ2V0SWQoKSwgc20pOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFs\naXppbmcgcGVyc2lzdGVudCBpbnN0YW5jZTsgcHV0IGluIG1haW4gY2FjaGUK\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBvcmlnID0gKFN0YXRlTWFu\nYWdlckltcGwpIF9tYWluLnB1dAogICAgICAgICAgICAgICAgKHNtLmdldE9i\namVjdElkKCksIHNtKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCks\nIG9yaWcpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoImR1cC1sb2FkIiwKICAgICAgICAgICAgICAgICAgICBz\nbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRpb25zLnRvU3RyaW5nCiAgICAgICAg\nICAgICAgICAgICAgKG9yaWcuZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAg\nICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzdGF0ZSBtYW5h\nZ2VyIGZyb20gdGhlIGNhY2hlIHdoZW4gaXQgdHJhbnNpdGlvbnMKICAgICAg\nICAgKiB0byB0cmFuc2llbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIHZvaWQgcmVtb3ZlKE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgICAgICAvLyBpZiBpdCBoYXMgYSBwZXJtYW5lbnQgb2lkLCBy\nZW1vdmUgZnJvbSBtYWluIC8gY29uZmxpY3QgY2FjaGUsCiAgICAgICAgICAg\nIC8vIGVsc2UgcmVtb3ZlIGZyb20gZW1iZWRkZWQvbm9udHJhbnMgY2FjaGUs\nIGFuZCBpZiBub3QgdGhlcmUKICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20g\nbmV3IGNhY2hlCiAgICAgICAgICAgIE9iamVjdCBvcmlnOwogICAgICAgICAg\nICBpZiAoc20uZ2V0T2JqZWN0SWQoKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBvcmlnID0gX21haW4ucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAg\nIGlmIChvcmlnICE9IHNtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9y\naWcgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX21haW4ucHV0\nKGlkLCBvcmlnKTsgLy8gcHV0IGJhY2sKICAgICAgICAgICAgICAgICAgICBp\nZiAoX2NvbmZsaWN0cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIG9yaWcgPSBfY29uZmxpY3RzLnJlbW92ZShpZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwgJiYgb3JpZyAhPSBzbSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb25mbGljdHMucHV0KGlk\nLCBvcmlnKTsgLy8gcHV0IGJhY2sKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBpZiAoKF9lbWJlZHMgPT0gbnVsbCB8fCAhX2VtYmVkcy5yZW1vdmUoc20p\nKSAmJiBfbmV3cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBvcmlnID0g\nX25ld3MucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgIGlmIChvcmlnICE9\nIG51bGwgJiYgb3JpZyAhPSBzbSkKICAgICAgICAgICAgICAgICAgICBfbmV3\ncy5wdXQoaWQsIG9yaWcpOyAvLyBwdXQgYmFjawogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBBbiBlbWJlZGRlZCBv\nciBub25wZXJzaXN0ZW50IG1hbmFnZWQgaW5zdGFuY2UgaGFzIGJlZW4gcGVy\nc2lzdGVkLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHBlcnNp\nc3QoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoX2Vt\nYmVkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2VtYmVkcy5yZW1vdmUo\nc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQSBuZXcg\naW5zdGFuY2UgaGFzIGp1c3QgYmVlbiBhc3NpZ25lZCBhIHBlcm1hbmVudCBv\naWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYXNzaWduT2Jq\nZWN0SWQoT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgICAgIC8vIGlmIGFzc2lnbmluZyBvaWQsIHJlbW92ZSBmcm9tIG5ldyBj\nYWNoZSBhbmQgcHV0IGluIHByaW1hcnk7IG1heQogICAgICAgICAgICAvLyBu\nb3QgYmUgaW4gbmV3IGNhY2hlIGlmIGFub3RoZXIgbmV3IGluc3RhbmNlIGhh\nZCBzYW1lIGlkCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgb3JpZyA9\nIChTdGF0ZU1hbmFnZXJJbXBsKSBfbmV3cy5yZW1vdmUoaWQpOwogICAgICAg\nICAgICBpZiAob3JpZyAhPSBudWxsICYmIG9yaWcgIT0gc20pCiAgICAgICAg\nICAgICAgICBfbmV3cy5wdXQoaWQsIG9yaWcpOyAvLyBwdXQgYmFjawoKICAg\nICAgICAgICAgLy8gcHV0IGluIG1haW4gY2FjaGUsIGJ1dCBtYWtlIHN1cmUg\nd2UgZG9uJ3QgcmVwbGFjZSBhbm90aGVyCiAgICAgICAgICAgIC8vIGluc3Rh\nbmNlIHdpdGggdGhlIHNhbWUgb2lkCiAgICAgICAgICAgIG9yaWcgPSAoU3Rh\ndGVNYW5hZ2VySW1wbCkgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIHNt\nKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgX21haW4ucHV0KHNtLmdldE9iamVjdElkKCksIG9yaWcpOwogICAg\nICAgICAgICAgICAgaWYgKCFvcmlnLmlzRGVsZXRlZCgpKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJk\ndXAtb2lkLWFzc2lnbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLmdl\ndE9iamVjdElkKCksIEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAg\nICAgICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLgogICAg\nICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFu\nYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICAgICAgICAgIC8vIHNhbWUgb2lk\nIGFzIGRlbGV0ZWQgaW5zdGFuY2U7IHB1dCBpbiBjb25mbGljdCBjYWNoZQog\nICAgICAgICAgICAgICAgaWYgKF9jb25mbGljdHMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBfY29uZmxpY3RzID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICAgICAgICAgIF9jb25mbGljdHMucHV0KHNtLmdldE9iamVjdElkKCks\nIHNtKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogQSBuZXcgaW5zdGFuY2UgaGFzIGNvbW1pdHRlZDsgcmVjYWNo\nZSB1bmRlciBwZXJtYW5lbnQgb2lkLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyB2b2lkIGNvbW1pdE5ldyhPYmplY3QgaWQsIFN0YXRlTWFuYWdlcklt\ncGwgc20pIHsKICAgICAgICAgICAgLy8gaWYgdGhlIGlkIGRpZG4ndCBjaGFu\nZ2UsIHRoZSBpbnN0YW5jZSB3YXMgYWxyZWFkeSBhc3NpZ25lZCBhbgogICAg\nICAgICAgICAvLyBpZCwgYnV0IGl0IGNvdWxkIGhhdmUgYmVlbiBpbiBjb25m\nbGljdCBjYWNoZQogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWc7\nCiAgICAgICAgICAgIGlmIChzbS5nZXRPYmplY3RJZCgpID09IGlkKSB7CiAg\nICAgICAgICAgICAgICBvcmlnID0gKF9jb25mbGljdHMgPT0gbnVsbCkgPyBu\ndWxsCiAgICAgICAgICAgICAgICAgICAgOiAoU3RhdGVNYW5hZ2VySW1wbCkg\nX2NvbmZsaWN0cy5yZW1vdmUoaWQpOwogICAgICAgICAgICAgICAgaWYgKG9y\naWcgPT0gc20pIHsKICAgICAgICAgICAgICAgICAgICBvcmlnID0gKFN0YXRl\nTWFuYWdlckltcGwpIF9tYWluLnB1dChpZCwgc20pOwogICAgICAgICAgICAg\nICAgICAgIGlmIChvcmlnICE9IG51bGwgJiYgIW9yaWcuaXNEZWxldGVkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21haW4ucHV0KHNtLmdldE9i\namVjdElkKCksIG9yaWcpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZHVwLW9pZC1hc3NpZ24i\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQo\nKSwgRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKSkpLnNldEZhaWxlZE9i\namVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG9pZCBjaGFuZ2Vk\nLCBzbyBpdCBtdXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGEgbmV3IGluc3Rh\nbmNlCiAgICAgICAgICAgIC8vIHdpdGhvdXQgYW4gYXNzaWduZWQgb2lkLiAg\ncmVtb3ZlIGl0IGZyb20gdGhlIG5ldyBjYWNoZTsgb2sgaWYKICAgICAgICAg\nICAgLy8gd2UgZW5kIHVwIHJlbW92aW5nIGFub3RoZXIgaW5zdGFuY2Ugd2l0\naCBzYW1lIGlkCiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX25ld3MucmVtb3ZlKGlkKTsKCiAgICAgICAgICAgIC8v\nIGFuZCBwdXQgaW50byBtYWluIGNhY2hlIG5vdyB0aGF0IGlkIGlzIGFzc3Np\nZ25lZAogICAgICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9t\nYWluLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAgICAgICAgICAgIGlm\nIChvcmlnICE9IG51bGwgJiYgb3JpZyAhPSBzbSAmJiAhb3JpZy5pc0RlbGV0\nZWQoKSkgewogICAgICAgICAgICAgICAgLy8gcHV0IGJhY2sgb3JpZyBhbmQg\ndGhyb3cgZXJyb3IKICAgICAgICAgICAgICAgIF9tYWluLnB1dChzbS5nZXRP\nYmplY3RJZCgpLCBvcmlnKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkdXAtb2lkLWFzc2lnbiIsCiAgICAg\nICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgRXhjZXB0aW9ucy50\nb1N0cmluZwogICAgICAgICAgICAgICAgICAgIChzbS5nZXRNYW5hZ2VkSW5z\ndGFuY2UoKSkpKS5zZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAg\nICAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpLnNldEZhdGFsKHRydWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBjYWNoZWQgcGVyc2lzdGVudCBvYmpl\nY3RzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNv\ncHkoKSB7CiAgICAgICAgICAgIC8vIHByb3hpZXMgbm90IGluY2x1ZGVkIGhl\ncmUgYmVjYXVzZSB0aGUgc3RhdGUgbWFuYWdlciBpcyBhbHdheXMKICAgICAg\nICAgICAgLy8gcHJlc2VudCBpbiBvdGhlciBjYWNoZXMgdG9vCgogICAgICAg\nICAgICBpbnQgc2l6ZSA9IF9tYWluLnNpemUoKTsKICAgICAgICAgICAgaWYg\nKF9jb25mbGljdHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0g\nX2NvbmZsaWN0cy5zaXplKCk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfbmV3cy5zaXplKCk7CiAg\nICAgICAgICAgIGlmIChfZW1iZWRzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBzaXplICs9IF9lbWJlZHMuc2l6ZSgpOwogICAgICAgICAgICBpZiAoc2l6\nZSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVN\nUFRZX0xJU1Q7CgogICAgICAgICAgICBMaXN0IGNvcHkgPSBuZXcgQXJyYXlM\naXN0KHNpemUpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9t\nYWluLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAg\nIGlmIChfY29uZmxpY3RzICE9IG51bGwgJiYgIV9jb25mbGljdHMuaXNFbXB0\neSgpKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfY29u\nZmxpY3RzLnZhbHVlcygpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAg\nICAgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgY29weS5h\nZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChfbmV3cyAhPSBudWxs\nICYmICFfbmV3cy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IF9uZXdzLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5u\nZXh0KCkpOwogICAgICAgICAgICBpZiAoX2VtYmVkcyAhPSBudWxsICYmICFf\nZW1iZWRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX2VtYmVkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykK\nICAgICAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAg\nICAgICAgICAgcmV0dXJuIGNvcHk7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBDbGVhciB0aGUgY2FjaGUuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAgICAgICAgICAgIF9tYWluLmNs\nZWFyKCk7CiAgICAgICAgICAgIGlmIChfY29uZmxpY3RzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfY29uZmxpY3RzLmNsZWFyKCk7CiAgICAgICAgICAg\nIGlmIChfbmV3cyAhPSBudWxsKQogICAgICAgICAgICAgICAgX25ld3MuY2xl\nYXIoKTsKICAgICAgICAgICAgaWYgKF9lbWJlZHMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9lbWJlZHMuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIENsZWFyIG5ldyBpbnN0YW5jZXMgd2l0aG91dCBw\nZXJtYW5lbnQgb2lkcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9p\nZCBjbGVhck5ldygpIHsKICAgICAgICAgICAgaWYgKF9uZXdzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfbmV3cy5jbGVhcigpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRyYW5zYWN0aW9uYWwgY2FjaGUgdGhhdCBo\nb2xkcyBzb2Z0IHJlZnMgdG8gY2xlYW4gaW5zdGFuY2VzLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAg\nICAgICBpbXBsZW1lbnRzIFNldCB7CgogICAgICAgIHByaXZhdGUgZmluYWwg\nYm9vbGVhbiBfb3JkZXJEaXJ0eTsKICAgICAgICBwcml2YXRlIFNldCBfZGly\ndHkgPSBudWxsOwogICAgICAgIHByaXZhdGUgU2V0IF9jbGVhbiA9IG51bGw7\nCgogICAgICAgIHB1YmxpYyBUcmFuc2FjdGlvbmFsQ2FjaGUoYm9vbGVhbiBv\ncmRlckRpcnR5KSB7CiAgICAgICAgICAgIF9vcmRlckRpcnR5ID0gb3JkZXJE\naXJ0eTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVy\nbiBhIGNvcHkgb2YgYWxsIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMu\nCiAgICAgICAgICovCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gY29weSgp\nIHsKICAgICAgICAgICAgaWYgKGlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAgICAg\nLy8gc2l6ZSBtYXkgbm90IGJlIGVudGlyZWx5IGFjY3VyYXRlIGR1ZSB0byBy\nZWZzIGV4cGlyaW5nLCBzbwogICAgICAgICAgICAvLyBtYW51YWxseSBjb3B5\nIGVhY2ggb2JqZWN0OyBkb2Vzbid0IG1hdHRlciB0aGlzIHdheSBpZiBzaXpl\nIHRvbwogICAgICAgICAgICAvLyBiaWcgYnkgc29tZQogICAgICAgICAgICBM\naXN0IGNvcHkgPSBuZXcgQXJyYXlMaXN0KHNpemUoKSk7CiAgICAgICAgICAg\nIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX2RpcnR5Lml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwog\nICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9jbGVhbi5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBjb3B5LmFkZChpdHIu\nbmV4dCgpKTsKICAgICAgICAgICAgcmV0dXJuIGNvcHk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gYSBjb3B5IG9mIGFsbCBk\naXJ0eSBzdGF0ZSBtYW5hZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgQ29sbGVjdGlvbiBjb3B5RGlydHkoKSB7CiAgICAgICAgICAgIGlmIChf\nZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgQXJyYXlMaXN0KF9kaXJ0eSk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBUcmFuc2ZlciB0aGUgZ2l2ZW4gaW5z\ndGFuY2UgZnJvbSB0aGUgZGlydHkgY2FjaGUgdG8gdGhlIGNsZWFuIGNhY2hl\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGZsdXNoZWQoU3Rh\ndGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoc20uaXNEaXJ0\neSgpICYmIF9kaXJ0eSAhPSBudWxsICYmIF9kaXJ0eS5yZW1vdmUoc20pKQog\nICAgICAgICAgICAgICAgYWRkQ2xlYW5JbnRlcm5hbChzbSk7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBBZGQgdGhlIGdpdmVuIGluc3Rh\nbmNlIHRvIHRoZSBjbGVhbiBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgdm9pZCBhZGRDbGVhbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAg\nICAgICAgICAgIGlmIChhZGRDbGVhbkludGVybmFsKHNtKSAmJiBfZGlydHkg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kaXJ0eS5yZW1vdmUoc20pOwog\nICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGFkZENsZWFuSW50\nZXJuYWwoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAo\nX2NsZWFuID09IG51bGwpCiAgICAgICAgICAgICAgICBfY2xlYW4gPSBuZXcg\nUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LlNPRlQpOwogICAg\nICAgICAgICByZXR1cm4gX2NsZWFuLmFkZChzbSk7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBBZGQgdGhlIGdpdmVuIGluc3RhbmNlIHRv\nIHRoZSBkaXJ0eSBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBhZGREaXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAg\nICAgIGlmIChfZGlydHkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYg\nKF9vcmRlckRpcnR5KQogICAgICAgICAgICAgICAgICAgIF9kaXJ0eSA9IE1h\ncEJhY2tlZFNldC5kZWNvcmF0ZShuZXcgTGlua2VkTWFwKCkpOwogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9kaXJ0eSA9IG5l\ndyBIYXNoU2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9k\naXJ0eS5hZGQoc20pKQogICAgICAgICAgICAgICAgcmVtb3ZlQ2xlYW5JbnRl\ncm5hbChzbSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBS\nZW1vdmUgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gdGhlIGNhY2hlLgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIHJldHVybiByZW1vdmVDbGVh\nbkludGVybmFsKHNtKQogICAgICAgICAgICAgICAgfHwgKF9kaXJ0eSAhPSBu\ndWxsICYmIF9kaXJ0eS5yZW1vdmUoc20pKTsKICAgICAgICB9CgogICAgICAg\nIHByaXZhdGUgYm9vbGVhbiByZW1vdmVDbGVhbkludGVybmFsKFN0YXRlTWFu\nYWdlckltcGwgc20pIHsKICAgICAgICAgICAgcmV0dXJuIF9jbGVhbiAhPSBu\ndWxsICYmIF9jbGVhbi5yZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIEl0ZXJhdG9yIGl0ZXJhdG9yKCkgewogICAgICAgICAgICBJdGVy\nYXRvckNoYWluIGNoYWluID0gbmV3IEl0ZXJhdG9yQ2hhaW4oKTsKICAgICAg\nICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsICYmICFfZGlydHkuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgY2hhaW4uYWRkSXRlcmF0b3IoX2RpcnR5Lml0\nZXJhdG9yKCkpOwogICAgICAgICAgICBpZiAoX2NsZWFuICE9IG51bGwgJiYg\nIV9jbGVhbi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBjaGFpbi5hZGRJ\ndGVyYXRvcihfY2xlYW4uaXRlcmF0b3IoKSk7CiAgICAgICAgICAgIHJldHVy\nbiBjaGFpbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNv\nbnRhaW5zKE9iamVjdCBvYmopIHsKICAgICAgICAgICAgcmV0dXJuIChfZGly\ndHkgIT0gbnVsbCAmJiBfZGlydHkuY29udGFpbnMob2JqKSkKICAgICAgICAg\nICAgICAgIHx8IChfY2xlYW4gIT0gbnVsbCAmJiBfY2xlYW4uY29udGFpbnMo\nb2JqKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250\nYWluc0FsbChDb2xsZWN0aW9uIGNvbGwpIHsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBjb2xsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgaWYgKCFjb250YWlucyhpdHIubmV4dCgpKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9kaXJ0eS5jbGVhcigpOwogICAgICAgICAgICBpZiAo\nX2NsZWFuICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY2xlYW4uY2xlYXIo\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHko\nKSB7CiAgICAgICAgICAgIHJldHVybiAoX2RpcnR5ID09IG51bGwgfHwgX2Rp\ncnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICYmIChfY2xlYW4gPT0g\nbnVsbCB8fCBfY2xlYW4uaXNFbXB0eSgpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgaW50IHNpemUgPSAw\nOwogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzaXplICs9IF9kaXJ0eS5zaXplKCk7CiAgICAgICAgICAgIGlmIChf\nY2xlYW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0gX2NsZWFu\nLnNpemUoKTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0IG9iaikgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFs\nbChDb2xsZWN0aW9uIGNvbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoT2JqZWN0IG9iaikgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92\nZUFsbChDb2xsZWN0aW9uIGNvbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiByZXRhaW5BbGwoQ29sbGVjdGlvbiBj\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlv\nbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVj\ndFtdIHRvQXJyYXkoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIE9iamVjdFtdIHRvQXJyYXkoT2JqZWN0W10gYXJyKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVuaXF1ZSBp\nZCBmb3Igc3RhdGUgbWFuYWdlcnMgb2YgbmV3IGRhdGFzdG9yZSBpbnN0YW5j\nZXMgd2l0aG91dCBhc3NpZ25lZAogICAgICogb2JqZWN0IGlkcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU3RhdGVNYW5hZ2VySWQKICAg\nICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNUUklOR19QUkVGSVggPSAib3Blbmpw\nYXNtOiI7CgogICAgICAgIHByaXZhdGUgc3RhdGljIGxvbmcgX2dlbmVyYXRv\nciA9IDA7CgogICAgICAgIHByaXZhdGUgZmluYWwgaW50IF9iaGFzaDsKICAg\nICAgICBwcml2YXRlIGZpbmFsIGxvbmcgX2lkOwoKICAgICAgICBwdWJsaWMg\nc3RhdGljIFN0YXRlTWFuYWdlcklkIG5ld0luc3RhbmNlKEJyb2tlciBiKSB7\nCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySWQoU3lzdGVt\nLmlkZW50aXR5SGFzaENvZGUoYiksIF9nZW5lcmF0b3IrKyk7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIFN0YXRlTWFuYWdlcklkKGludCBiaGFzaCwg\nbG9uZyBpZCkgewogICAgICAgICAgICBfYmhhc2ggPSBiaGFzaDsKICAgICAg\nICAgICAgX2lkID0gaWQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Rh\ndGVNYW5hZ2VySWQoU3RyaW5nIHN0cikgewogICAgICAgICAgICBzdHIgPSBz\ndHIuc3Vic3RyaW5nKFNUUklOR19QUkVGSVgubGVuZ3RoKCkpOwogICAgICAg\nICAgICBpbnQgaWR4ID0gc3RyLmluZGV4T2YoJzonKTsKICAgICAgICAgICAg\nX2JoYXNoID0gSW50ZWdlci5wYXJzZUludChzdHIuc3Vic3RyaW5nKDAsIGlk\neCkpOwogICAgICAgICAgICBfaWQgPSBMb25nLnBhcnNlTG9uZyhzdHIuc3Vi\nc3RyaW5nKGlkeCArIDEpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYg\nKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBTdGF0ZU1hbmFn\nZXJJZCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlcklkIHNpZCA9IChTdGF0ZU1hbmFnZXJJZCkgb3Ro\nZXI7CiAgICAgICAgICAgIHJldHVybiBfYmhhc2ggPT0gc2lkLl9iaGFzaCAm\nJiBfaWQgPT0gc2lkLl9pZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiAoaW50KSAoX2lk\nIF4gKF9pZCA+Pj4gMzIpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBTVFJJTkdf\nUFJFRklYICsgX2JoYXNoICsgIjoiICsgX2lkOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENvbGxlY3Rpb24gdHlwZSB0aGF0IGhvbGRzIHN0\nYXRlIG1hbmFnZXJzIGJ1dCB3aG9zZSBpbnRlcmZhY2UgZGVhbHMKICAgICAq\nIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWFuYWdlZCBvYmplY3RzLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNYW5hZ2VkT2JqZWN0Q29s\nbGVjdGlvbgogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RDb2xsZWN0aW9uIHsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDb2xsZWN0aW9uIF9zdGF0ZXM7Cgog\nICAgICAgIHB1YmxpYyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihDb2xsZWN0\naW9uIHN0YXRlcykgewogICAgICAgICAgICBfc3RhdGVzID0gc3RhdGVzOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbGxlY3Rpb24gZ2V0U3RhdGVN\nYW5hZ2VycygpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0ZXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfc3RhdGVzLnNpemUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBJdGVyYXRvcigpIHsKICAgICAgICAgICAgICAgIHByaXZhdGUgZmlu\nYWwgSXRlcmF0b3IgX2l0ciA9IF9zdGF0ZXMuaXRlcmF0b3IoKTsKCiAgICAg\nICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0KCkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBfaXRyLmhhc05leHQoKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdWJsaWMgT2JqZWN0IG5leHQo\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoT3BlbkpQQVN0YXRl\nTWFuYWdlcikgX2l0ci5uZXh0KCkpLgogICAgICAgICAgICAgICAgICAgICAg\nICBnZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCByZW1vdmUoKSB7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIGNsYXNzIHRvIGltcGxlbWVu\ndCBKQ0EgaW50ZXJmYWNlcy4gVGhpcyBpcyBwbGFjZWQgaW4gYQogICAgICog\nc2VwYXJhdGUgY2xhc3Mgc28gdGhhdCBpdHMgbWV0aG9kcyBkbyBub3QgaW50\nZXJmZXJlIHdpdGggdGhlCiAgICAgKiBwZXJzaXN0ZW5jZSBtYW5hZ2VyIEFQ\nSXMuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgSkNBSGVscGVyCiAgICAg\nICAgaW1wbGVtZW50cyBJbnRlcmFjdGlvbiwgUmVzdWx0U2V0SW5mbywgQ29u\nbmVjdGlvbk1ldGFEYXRhIHsKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gSW1wbGVtZW50\nYXRpb24gb2YgSW50ZXJhY3Rpb24gaW50ZXJmYWNlCiAgICAgICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAg\nICBwdWJsaWMgdm9pZCBjbGVhcldhcm5pbmdzKCkgewogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIFJlY29yZCBleGVjdXRlKEludGVyYWN0aW9uU3BlYyBz\ncGVjLCBSZWNvcmQgaW5wdXQpCiAgICAgICAgICAgIHRocm93cyBSZXNvdXJj\nZUV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHRocm93IG5ldyBOb3RTdXBwb3J0\nZWRFeGNlcHRpb24oImV4ZWN1dGUiKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGV4ZWN1dGUoSW50ZXJhY3Rpb25TcGVjIHNwZWMsIFJl\nY29yZCBpbnB1dCwKICAgICAgICAgICAgUmVjb3JkIG91dHB1dCkKICAgICAg\nICAgICAgdGhyb3dzIFJlc291cmNlRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE5vdFN1cHBvcnRlZEV4Y2VwdGlvbigiZXhlY3V0ZSIpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIENvbm5lY3Rpb24gZ2V0Q29ubmVj\ndGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIEJyb2tlckltcGwudGhpczsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZXNvdXJjZVdhcm5pbmcgZ2V0\nV2FybmluZ3MoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgfQoK\nICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgICAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBSZXN1bHRT\nZXRJbmZvIGludGVyZmFjZQogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBkZWxldGVzQXJlRGV0ZWN0ZWQoaW50IHR5cGUpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBpbnNlcnRzQXJlRGV0ZWN0ZWQoaW50IHR5cGUpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBvdGhlcnNEZWxldGVzQXJlVmlzaWJsZShpbnQgdHlwZSkgewogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIG90aGVyc0luc2VydHNBcmVWaXNpYmxlKGludCB0eXBlKSB7\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gb3RoZXJzVXBkYXRlc0FyZVZpc2libGUoaW50IHR5\ncGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBvd25EZWxldGVzQXJlVmlzaWJsZShpbnQg\ndHlwZSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBib29sZWFuIG93bkluc2VydHNBcmVWaXNpYmxlKGlu\ndCB0eXBlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gb3duVXBkYXRlc0FyZVZpc2libGUo\naW50IHR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3VsdFNldFR5\ncGUoaW50IHR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3VsdFR5\ncGVDb25jdXJyZW5jeShpbnQgdHlwZSwKICAgICAgICAgICAgaW50IGNvbmN1\ncnJlbmN5KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gdXBkYXRlc0FyZURldGVjdGVkKGlu\ndCB0eXBlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gSW1wbGVtZW50YXRpb24gb2Yg\nQ29ubmVjdGlvbk1ldGFEYXRhIGludGVyZmFjZQogICAgICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nICAgICAgICBwdWJsaWMgU3RyaW5nIGdldEVJU1Byb2R1Y3ROYW1lKCkgewog\nICAgICAgICAgICByZXR1cm4gX2NvbmYuZ2V0Q29ubmVjdGlvbkRyaXZlck5h\nbWUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0RUlT\nUHJvZHVjdFZlcnNpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAiIjsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0VXNlck5hbWUoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfdXNlcjsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

