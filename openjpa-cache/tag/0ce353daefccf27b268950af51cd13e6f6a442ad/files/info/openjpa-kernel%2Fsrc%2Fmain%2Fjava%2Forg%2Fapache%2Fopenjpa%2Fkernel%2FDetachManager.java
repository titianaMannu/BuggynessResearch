{"sha":"66a67680dae99e6c88d946e9e6772605a3926682","node_id":"MDQ6QmxvYjIwNjM2NDo2NmE2NzY4MGRhZTk5ZTZjODhkOTQ2ZTllNjc3MjYwNWEzOTI2Njgy","size":29184,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/66a67680dae99e6c88d946e9e6772605a3926682","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0OwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuQXJyYXk7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5DYWxl\nbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuSWRlbnRpdHlN\nYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5EZXRhY2hPcHRp\nb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lz\ndGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50\nLkNhbGxiYWNrTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZl\nbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5DYWxsYmFja0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlByb3h5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuUHJveHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBIYW5kbGVzIGRldGFjaGluZyBp\nbnN0YW5jZXMuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAq\nIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBEZXRhY2hNYW5hZ2VyCiAg\nICBpbXBsZW1lbnRzIERldGFjaFN0YXRlIHsKCiAgICBwcml2YXRlIHN0YXRp\nYyBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKERldGFj\naE1hbmFnZXIuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgQnJva2VySW1w\nbCBfYnJva2VyOwogICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9jb3B5Owog\nICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9mdWxsOwogICAgcHJpdmF0ZSBm\naW5hbCBQcm94eU1hbmFnZXIgX3Byb3h5OwogICAgcHJpdmF0ZSBmaW5hbCBE\nZXRhY2hPcHRpb25zIF9vcHRzOwogICAgcHJpdmF0ZSBmaW5hbCBPcENhbGxi\nYWNrcyBfY2FsbDsKICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfZmFpbEZh\nc3Q7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZsdXNoZWQgPSBmYWxzZTsKCiAg\nICAvLyBpZiB3ZSdyZSBub3QgZGV0YWNoaW5nIGZ1bGwsIHdlIG5lZWQgdG8g\ndHJhY2sgYWxsIGRldGFjaGVkIG9iamVjdHM7CiAgICAvLyBpZiB3ZSBhcmUs\nIHRoZW4gd2UgdXNlIGEgc3BlY2lhbCBmaWVsZCBtYW5hZ2VyIGZvciBtb3Jl\nIGVmZmljaWVudAogICAgLy8gZGV0YWNobWVudCB0aGFuIHRoZSBzdGFuZGFy\nZCBvbmUKICAgIHByaXZhdGUgZmluYWwgSWRlbnRpdHlNYXAgX2RldGFjaGVk\nOwogICAgcHJpdmF0ZSBmaW5hbCBEZXRhY2hGaWVsZE1hbmFnZXIgX2Z1bGxG\nTTsKCiAgICAvKioKICAgICAqIFVzZWQgdG8gcHJlcGFyZSBhIGRldGFjaGFi\nbGUgaW5zdGFuY2UgdGhhdCBkb2VzIG5vdCBleHRlcm5hbGl6ZQogICAgICog\nZGV0YWNoZWQgc3RhdGUuCiAgICAgKi8KICAgIHN0YXRpYyBib29sZWFuIHBy\nZVNlcmlhbGl6ZShTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaWYg\nKCFzbS5pc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICBmbHVzaERpcnR5KHNtKTsKCiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICBib29sZWFu\nIHNldFN0YXRlID0gbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkgIT0gbnVsbAog\nICAgICAgICAgICAmJiAhQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxz\nKG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKTsKICAgICAgICBCaXRTZXQgaWR4\ncyA9IChzZXRTdGF0ZSkgPyBuZXcgQml0U2V0KG1ldGEuZ2V0RmllbGRzKCku\nbGVuZ3RoKSA6IG51bGw7CiAgICAgICAgcHJlRGV0YWNoKHNtLmdldEJyb2tl\ncigpLCBzbSwgaWR4cyk7CgogICAgICAgIGlmIChzZXRTdGF0ZSkgewogICAg\nICAgICAgICBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKS5wY1NldERldGFj\naGVkU3RhdGUoZ2V0RGV0YWNoZWRTdGF0ZQogICAgICAgICAgICAgICAgKHNt\nLCBpZHhzKSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gZG9uJ3Qg\nbnVsbCBzdGF0ZQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVzZWQgYnkgY2xhc3NlcyB0aGF0IGV4dGVy\nbmFsaXplIGRldGFjaGVkIHN0YXRlLgogICAgICoKICAgICAqIEByZXR1cm4g\nd2hldGhlciB0byB1c2UgYSBkZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyCiAgICAg\nKi8KICAgIHN0YXRpYyBib29sZWFuIHdyaXRlRGV0YWNoZWRTdGF0ZShTdGF0\nZU1hbmFnZXJJbXBsIHNtLCBPYmplY3RPdXRwdXQgb3V0LAogICAgICAgIEJp\ndFNldCBpZHhzKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKCFzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICBvdXQu\nd3JpdGVPYmplY3QobnVsbCk7IC8vIHN0YXRlCiAgICAgICAgICAgIG91dC53\ncml0ZU9iamVjdChudWxsKTsgLy8gc20KICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gZGlydHkgc3RhdGUgY2F1c2Vz\nIGZsdXNoCiAgICAgICAgZmx1c2hEaXJ0eShzbSk7CgogICAgICAgIEJyb2tl\nciBicm9rZXIgPSBzbS5nZXRCcm9rZXIoKTsKICAgICAgICBwcmVEZXRhY2go\nYnJva2VyLCBzbSwgaWR4cyk7CgogICAgICAgIC8vIHdyaXRlIGRldGFjaGVk\nIHN0YXRlIG9iamVjdCBhbmQgc3RhdGUgbWFuYWdlcgogICAgICAgIERldGFj\naE9wdGlvbnMgb3B0cyA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAg\nICAgICAgICAgIGdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAgICAgICBp\nZiAoIW9wdHMuZ2V0RGV0YWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAg\nICB8fCAhdXNlRGV0YWNoZWRTdGF0ZU1hbmFnZXIoc20sIG9wdHMpKSB7CiAg\nICAgICAgICAgIG91dC53cml0ZU9iamVjdChnZXREZXRhY2hlZFN0YXRlKHNt\nLCBpZHhzKSk7CiAgICAgICAgICAgIG91dC53cml0ZU9iamVjdChudWxsKTsK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBv\ndXQud3JpdGVPYmplY3QobnVsbCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0\nKG5ldyBEZXRhY2hlZFN0YXRlTWFuYWdlcihzbS5nZXRQZXJzaXN0ZW5jZUNh\ncGFibGUoKSwKICAgICAgICAgICAgc20sIGlkeHMsIG9wdHMuZ2V0QWNjZXNz\nVW5sb2FkZWQoKSwgYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSkpOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZHkg\ndGhlIG9iamVjdCBmb3IgZGV0YWNobWVudCwgaW5jbHVkaW5nIGxvYWRpbmcg\ndGhlIGZpZWxkcyB0byBiZQogICAgICogZGV0YWNoZWQgYW5kIHVwZGF0aW5n\nIHZlcnNpb24gaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGlk\neHMgdGhlIGluZGV4ZXMgb2YgZmllbGRzIHRvIGRldGFjaCB3aWxsIGJlIHNl\ndCBhcyBhIHNpZGUKICAgICAqIGVmZmVjdCBvZiB0aGlzIG1ldGhvZAogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHByZURldGFjaChCcm9rZXIg\nYnJva2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAgIEJpdFNldCBp\nZHhzKSB7CiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBleGlzdGluZyBvYmpl\nY3QgaGFzIHRoZSByaWdodCBmaWVsZHMgZmV0Y2hlZDsgY2FsbAogICAgICAg\nIC8vIGV2ZW4gaWYgdXNpbmcgY3VycmVudGx5LWxvYWRlZCBmaWVsZHMgZm9y\nIGRldGFjaCB0byBtYWtlIHN1cmUKICAgICAgICAvLyB2ZXJzaW9uIGlzIHNl\ndAogICAgICAgIGludCBkZXRhY2hNb2RlID0gYnJva2VyLmdldERldGFjaFN0\nYXRlKCk7CiAgICAgICAgaW50IGxvYWRNb2RlID0gU3RhdGVNYW5hZ2VySW1w\nbC5MT0FEX0ZHUzsKICAgICAgICBCaXRTZXQgZXhjbHVkZSA9IG51bGw7CiAg\nICAgICAgaWYgKGRldGFjaE1vZGUgPT0gREVUQUNIX0xPQURFRCkKICAgICAg\nICAgICAgZXhjbHVkZSA9IFN0b3JlQ29udGV4dC5FWENMVURFX0FMTDsKICAg\nICAgICBlbHNlIGlmIChkZXRhY2hNb2RlID09IERFVEFDSF9BTEwpCiAgICAg\nICAgICAgIGxvYWRNb2RlID0gU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0FMTDsK\nICAgICAgICBzbS5sb2FkKGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKSwgbG9hZE1vZGUsIGV4Y2x1ZGUsIG51bGwsIGZhbHNlKTsKCiAgICAgICAg\nLy8gY3JlYXRlIGJpdHNldCBvZiBmaWVsZHMgdG8gZGV0YWNoOyBpZiBtb2Rl\nIGlzIGFsbCB3ZSBjYW4gdXNlCiAgICAgICAgLy8gY3VycmVudGx5IGxvYWRl\nZCBiaXRzZXQgY2xvbmUsIHNpbmNlIHdlIGtub3cgYWxsIGZpZWxkcyBhcmUg\nbG9hZGVkCiAgICAgICAgaWYgKGlkeHMgIT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoZGV0YWNoTW9kZSA9PSBERVRBQ0hfRkdTKQogICAgICAgICAgICAg\nICAgc2V0RmV0Y2hHcm91cEZpZWxkcyhicm9rZXIsIHNtLCBpZHhzKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWR4cy5vcihzbS5nZXRM\nb2FkZWQoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2Vu\nZXJhdGUgdGhlIGRldGFjaGVkIHN0YXRlIGZvciB0aGUgZ2l2ZW4gaW5zdGFu\nY2UuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBnZXREZXRh\nY2hlZFN0YXRlKFN0YXRlTWFuYWdlckltcGwgc20sIEJpdFNldCBmaWVsZHMp\nIHsKICAgICAgICAvLyBpZiBkYXRhc3RvcmUsIHN0b3JlIGlkIGluIGZpcnN0\nIGVsZW1lbnQKICAgICAgICBpbnQgb2Zmc2V0ID0gKHNtLmdldE1ldGFEYXRh\nKCkuZ2V0SWRlbnRpdHlUeXBlKCkgPT0KICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YS5JRF9EQVRBU1RPUkUpID8gMSA6IDA7CgogICAgICAgIC8vIG1ha2Ug\ndmVyc2lvbiBzdGF0ZSBhcnJheSBvbmUgbGFyZ2VyIGZvciBuZXcgaW5zdGFu\nY2VzOyBtYXJrcyBuZXcKICAgICAgICAvLyBpbnN0YW5jZXMgd2l0aG91dCBh\nZmZlY3Rpbmcgc2VyaWFsaXphdGlvbiBzaXplIG11Y2gKICAgICAgICBPYmpl\nY3RbXSBzdGF0ZTsKICAgICAgICBpZiAoc20uaXNOZXcoKSkKICAgICAgICAg\nICAgc3RhdGUgPSBuZXcgT2JqZWN0WzMgKyBvZmZzZXRdOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc3RhdGUgPSBuZXcgT2JqZWN0WzIgKyBvZmZzZXRd\nOwoKICAgICAgICBpZiAob2Zmc2V0ID4gMCkgewogICAgICAgICAgICBPYmpl\nY3QgaWQ7CiAgICAgICAgICAgIGlmIChzbS5pc0VtYmVkZGVkKCkgfHwgc20u\nZ2V0T2JqZWN0SWQoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgaWQgPSBz\nbS5nZXRJZCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBp\nZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAgICAgIHN0YXRlWzBdID0g\naWQudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICAgICAgc3RhdGVbb2Zmc2V0\nXSA9IHNtLmdldFZlcnNpb24oKTsKICAgICAgICBzdGF0ZVtvZmZzZXQgKyAx\nXSA9IGZpZWxkczsKICAgICAgICByZXR1cm4gc3RhdGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGbHVzaCBvciBpbnZva2UgcHJlLXN0b3JlIGNhbGxiYWNr\ncyBvbiB0aGUgZ2l2ZW4gYnJva2VyIGlmCiAgICAgKiBuZWVkZWQuIFJldHVy\nbiB0cnVlIGlmIGZsdXNoZWQvc3RvcmVkLCBmYWxzZSBvdGhlcndpc2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gZmx1c2hEaXJ0eShT\ndGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaWYgKCFzbS5pc0RpcnR5\nKCkgfHwgIXNtLmdldEJyb2tlcigpLmlzQWN0aXZlKCkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gb25seSBmbHVzaCBpZiB0aGVy\nZSBhcmUgYWN0dWFsbHkgYW55IGRpcnR5IG5vbi1mbHVzaGVkIGZpZWxkcwog\nICAgICAgIEJpdFNldCBkaXJ0eUZpZWxkcyA9IHNtLmdldERpcnR5KCk7CiAg\nICAgICAgQml0U2V0IGZsdXNoZWRGaWVsZHMgPSBzbS5nZXRGbHVzaGVkKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkaXJ0eUZpZWxkcy5zaXpl\nKCk7IGkrKykgewogICAgICAgICAgICBpZiAoZGlydHlGaWVsZHMuZ2V0KGkp\nICYmICFmbHVzaGVkRmllbGRzLmdldChpKSkgewogICAgICAgICAgICAgICAg\naWYgKHNtLmdldEJyb2tlcigpLmdldFJvbGxiYWNrT25seSgpKQogICAgICAg\nICAgICAgICAgICAgIHNtLmdldEJyb2tlcigpLnByZUZsdXNoKCk7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc20uZ2V0QnJv\na2VyKCkuZmx1c2goKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGJpdCBzZXQgZm9yIHRo\nZSBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgZmV0Y2ggZ3JvdXBzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHNldEZldGNoR3JvdXBGaWVsZHMo\nQnJva2VyIGJyb2tlciwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtLCBC\naXRTZXQgaWR4cykgewogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCA9IGJyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1ByaW1hcnlLZXko\nKSB8fCBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pKQogICAgICAgICAg\nICAgICAgaWR4cy5zZXQoaSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25z\ndHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFyYW0gYnJva2VyIG93bmluZyBi\ncm9rZXIKICAgICAqIEBwYXJhbSBmdWxsIHdoZXRoZXIgdGhlIGVudGlyZSBi\ncm9rZXIgY2FjaGUgaXMgYmVpbmcgZGV0YWNoZWQ7IGlmCiAgICAgKiB0aGlz\nIGlzIHRoZSBjYXNlLCB3ZSBhc3N1bWUgdGhlIGJyb2tlciBoYXMgYWxyZWFk\neQogICAgICogZmx1c2hlZCBpZiBuZWVkZWQsIGFuZCB0aGF0IHdlJ3JlIGRl\ndGFjaGluZyBpbi1wbGFjZQogICAgICovCiAgICBwdWJsaWMgRGV0YWNoTWFu\nYWdlcihCcm9rZXJJbXBsIGJyb2tlciwgYm9vbGVhbiBmdWxsLCBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAg\nICBfcHJveHkgPSBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldFByb3h5\nTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX29wdHMgPSBicm9rZXIuZ2V0\nQ29uZmlndXJhdGlvbigpLmdldERldGFjaFN0YXRlSW5zdGFuY2UoKTsKICAg\nICAgICBfY29weSA9ICFmdWxsOwogICAgICAgIF9mbHVzaGVkID0gZnVsbDsK\nICAgICAgICBfY2FsbCA9IGNhbGw7CiAgICAgICAgX2ZhaWxGYXN0ID0gKGJy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TWV0YURhdGFSZXBvc2l0b3J5\nSW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCku\nZ2V0RGVmYXVsdHMoKS5nZXRDYWxsYmFja01vZGUoKQogICAgICAgICAgICAm\nIENhbGxiYWNrTW9kZXMuQ0FMTEJBQ0tfRkFJTF9GQVNUKSAhPSAwOwoKICAg\nICAgICAvLyB3ZSBjYW4gb25seSByZWx5IG9uIG91ciAiYWxsIiBzaG9ydGN1\ndHMgaWYgd2Uga25vdyB3ZSB3b24ndCBiZQogICAgICAgIC8vIGxvYWRpbmcg\nYW55IG1vcmUgZGF0YQogICAgICAgIF9mdWxsID0gZnVsbCAmJiBicm9rZXIu\nZ2V0RGV0YWNoU3RhdGUoKSA9PSBEZXRhY2hTdGF0ZS5ERVRBQ0hfTE9BREVE\nOwogICAgICAgIGlmIChfZnVsbCkgewogICAgICAgICAgICBfZGV0YWNoZWQg\nPSBudWxsOwogICAgICAgICAgICBfZnVsbEZNID0gbmV3IERldGFjaEZpZWxk\nTWFuYWdlcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9kZXRh\nY2hlZCA9IG5ldyBJZGVudGl0eU1hcCgpOwogICAgICAgICAgICBfZnVsbEZN\nID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBkZXRhY2hlZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBkZXRhY2goT2JqZWN0IHRvRGV0\nYWNoKSB7CiAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBkZXRhY2hJbnRlcm5hbCh0b0RldGFj\naCk7CiAgICAgICAgfSBjYXRjaCAoQ2FsbGJhY2tFeGNlcHRpb24gY2UpIHsK\nICAgICAgICAgICAgZXhjZXBzID0gbmV3IEFycmF5TGlzdCgxKTsKICAgICAg\nICAgICAgZXhjZXBzLmFkZChjZSk7CiAgICAgICAgICAgIHJldHVybiBudWxs\nOyAvLyB3b24ndCBiZSByZWFjaGVkIGFzIGV4Y2VwdGlvbiB3aWxsIGJlIHJl\ndGhyb3duCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGV4\nY2VwcyA9PSBudWxsIHx8ICFfZmFpbEZhc3QpCiAgICAgICAgICAgICAgICBl\neGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9ucy5zaW5nbGV0\nb24odG9EZXRhY2gpLAogICAgICAgICAgICAgICAgICAgIGV4Y2Vwcyk7CiAg\nICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbnMoZXhjZXBzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gZGV0YWNoZWQgdmVyc2lvbnMgb2YgYWxsIHRoZSBnaXZlbiBp\nbnN0YW5jZXMuIElmIG5vdCBjb3B5aW5nLAogICAgICogbnVsbCB3aWxsIGJl\nIHJldHVybmVkLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNo\nQWxsKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgTGlzdCBleGNl\ncHMgPSBudWxsOwogICAgICAgIExpc3QgZGV0YWNoZWQgPSBudWxsOwogICAg\nICAgIGlmIChfY29weSkKICAgICAgICAgICAgZGV0YWNoZWQgPSBuZXcgQXJy\nYXlMaXN0KGluc3RhbmNlcy5zaXplKCkpOwoKICAgICAgICBib29sZWFuIGZh\naWxGYXN0ID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgT2Jq\nZWN0IGRldGFjaDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBp\nbnN0YW5jZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIGRldGFjaCA9IGRldGFjaEludGVybmFsKGl0ci5uZXh0KCkp\nOwogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAg\nICAgIGRldGFjaGVkLmFkZChkZXRhY2gpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIGlmIChyZSBpbnN0YW5jZW9mIENhbGxiYWNrRXhjZXB0aW9u\nICYmIF9mYWlsRmFzdCkKICAgICAgICAgICAgICAgIGZhaWxGYXN0ID0gdHJ1\nZTsKICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICghZmFpbEZhc3QpCiAg\nICAgICAgICAgICAgICBleGNlcHMgPSBpbnZva2VBZnRlckRldGFjaChpbnN0\nYW5jZXMsIGV4Y2Vwcyk7CiAgICAgICAgICAgIGlmIChfZGV0YWNoZWQgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRhY2hlZC5jbGVhcigpOwogICAg\nICAgIH0KICAgICAgICB0aHJvd0V4Y2VwdGlvbnMoZXhjZXBzKTsKCiAgICAg\nICAgaWYgKF9jb3B5KQogICAgICAgICAgICByZXR1cm4gZGV0YWNoZWQudG9B\ncnJheSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogSW52b2tlIHBvc3REZXRhY2goKSBvbiBhbnkgZGV0YWNoZWQgaW5z\ndGFuY2VzIHRoYXQgaW1wbGVtZW50CiAgICAgKiBQb3N0RGV0YWNoQ2FsbGJh\nY2suIFRoaXMgd2lsbCBiZSBkb25lIGFmdGVyIHRoZSBlbnRpcmUgZ3JhcGgg\naGFzCiAgICAgKiBiZWVuIGRldGFjaGVkLiBUaGlzIG1ldGhvZCBoYXMgdGhl\nIHNpZGUtZWZmZWN0IG9mIGFsc28gY2xlYXJpbmcKICAgICAqIG91dCB0aGUg\nbWFwIG9mIGFsbCBkZXRhY2hlZCBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHBy\naXZhdGUgTGlzdCBpbnZva2VBZnRlckRldGFjaChDb2xsZWN0aW9uIG9ianMs\nIExpc3QgZXhjZXBzKSB7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gKF9mdWxs\nKSA/IG9ianMuaXRlcmF0b3IoKQogICAgICAgICAgICA6IF9kZXRhY2hlZC5l\nbnRyeVNldCgpLml0ZXJhdG9yKCk7CgogICAgICAgIE9iamVjdCBvcmlnLCBk\nZXRhY2hlZDsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CiAgICAgICAgd2hp\nbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgaWYgKF9mdWxsKSB7\nCiAgICAgICAgICAgICAgICBvcmlnID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGRldGFjaGVkID0gb3JpZzsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIG9yaWcgPSBlbnRyeS5nZXRLZXkoKTsKICAg\nICAgICAgICAgICAgIGRldGFjaGVkID0gZW50cnkuZ2V0VmFsdWUoKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvcmlnLCB0cnVlKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2\nZW50KGRldGFjaGVkLCBvcmlnLAogICAgICAgICAgICAgICAgICAgICAgICBz\nbS5nZXRNZXRhRGF0YSgpLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9ERVRBQ0gp\nOwogICAgICAgICAgICB9IGNhdGNoIChDYWxsYmFja0V4Y2VwdGlvbiBjZSkg\newogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgY2UpOwog\nICAgICAgICAgICAgICAgaWYgKF9mYWlsRmFzdCkKICAgICAgICAgICAgICAg\nICAgICBicmVhazsgLy8gZG9uJ3QgY29udGludWUgcHJvY2Vzc2luZwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNlcHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXhjZXB0aW9uIHRvIHRoZSBs\naXN0LgogICAgICovCiAgICBwcml2YXRlIExpc3QgYWRkKExpc3QgZXhjZXBz\nLCBSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9\nPSBudWxsKQogICAgICAgICAgICBleGNlcHMgPSBuZXcgTGlua2VkTGlzdCgp\nOwogICAgICAgIGV4Y2Vwcy5hZGQocmUpOwogICAgICAgIHJldHVybiBleGNl\ncHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBhbGwgZ2F0aGVyZWQg\nZXhjZXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHRocm93RXhj\nZXB0aW9ucyhMaXN0IGV4Y2VwcykgewogICAgICAgIGlmIChleGNlcHMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZXhjZXBz\nLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAoUnVudGltZUV4Y2Vw\ndGlvbikgZXhjZXBzLmdldCgwKTsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKS4KICAgICAgICAg\nICAgc2V0TmVzdGVkVGhyb3dhYmxlcygoVGhyb3dhYmxlW10pIGV4Y2Vwcy50\nb0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMu\nc2l6ZSgpXSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0YWNoLgogICAg\nICovCiAgICBwcml2YXRlIE9iamVjdCBkZXRhY2hJbnRlcm5hbChPYmplY3Qg\ndG9EZXRhY2gpIHsKICAgICAgICBpZiAodG9EZXRhY2ggPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGFscmVhZHkgZGV0\nYWNoZWQ/CiAgICAgICAgaWYgKF9kZXRhY2hlZCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIE9iamVjdCBkZXRhY2hlZCA9IF9kZXRhY2hlZC5nZXQodG9EZXRh\nY2gpOwogICAgICAgICAgICBpZiAoZGV0YWNoZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBkZXRhY2hlZDsKICAgICAgICB9CgogICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdl\nckltcGwodG9EZXRhY2gsIHRydWUpOwogICAgICAgIGlmIChfY2FsbCAhPSBu\ndWxsICYmIChfY2FsbC5wcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1Bf\nREVUQUNILAogICAgICAgICAgICB0b0RldGFjaCwgc20pICYgT3BDYWxsYmFj\na3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRvRGV0YWNo\nOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndG9EZXRhY2g7CgogICAgICAgIC8vIENhbGwgUHJlRGV0YWNoIGZpcnN0IGFz\nIHdlIGNhbid0IHRlbGwgaWYgdGhlIG5ldyBzeXN0ZW0KICAgICAgICAvLyBm\naXJlZCBhbiBldmVudCBvciBqdXN0IGRpZCBub3QgZmFpbC4KICAgICAgICBf\nYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudCh0b0RldGFjaCwgbnVsbCwgc20u\nZ2V0TWV0YURhdGEoKSwKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnQuQkVG\nT1JFX0RFVEFDSCk7CgogICAgICAgIC8vIGFueSBkaXJ0eSBpbnN0YW5jZXMg\nY2F1c2UgYSBmbHVzaCB0byBvY2N1cgogICAgICAgIF9mbHVzaGVkID0gX2Zs\ndXNoZWQgfHwgZmx1c2hEaXJ0eShzbSk7CiAgICAgICAgQml0U2V0IGZpZWxk\ncyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICBwcmVEZXRhY2goX2Jyb2tlciwg\nc20sIGZpZWxkcyk7CgogICAgICAgIC8vIGNyZWF0ZSBhbmQgc3RvcmUgbmV3\nIG9iamVjdCBiZWZvcmUgY29weSB0byBhdm9pZCBlbmRsZXNzIHJlY3Vyc2lv\nbgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IHNtLmdldFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBk\nZXRhY2hlZFBDOwogICAgICAgIGlmIChfY29weSkKICAgICAgICAgICAgZGV0\nYWNoZWRQQyA9IHBjLnBjTmV3SW5zdGFuY2UobnVsbCwgdHJ1ZSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBkZXRhY2hlZFBDID0gcGM7CiAgICAgICAg\naWYgKF9kZXRhY2hlZCAhPSBudWxsKQogICAgICAgICAgICBfZGV0YWNoZWQu\ncHV0KHRvRGV0YWNoLCBkZXRhY2hlZFBDKTsKCiAgICAgICAgLy8gZGV0YWNo\nIGZpZWxkcyBhbmQgc2V0IGRldGFjaGVkIHZhcmlhYmxlcwogICAgICAgIERl\ndGFjaGVkU3RhdGVNYW5hZ2VyIGRldFNNID0gbnVsbDsKICAgICAgICBpZiAo\nX29wdHMuZ2V0RGV0YWNoZWRTdGF0ZU1hbmFnZXIoKQogICAgICAgICAgICAm\nJiB1c2VEZXRhY2hlZFN0YXRlTWFuYWdlcihzbSwgX29wdHMpKQogICAgICAg\nICAgICBkZXRTTSA9IG5ldyBEZXRhY2hlZFN0YXRlTWFuYWdlcihkZXRhY2hl\nZFBDLCBzbSwgZmllbGRzLAogICAgICAgICAgICAgICAgX29wdHMuZ2V0QWNj\nZXNzVW5sb2FkZWQoKSwgX2Jyb2tlci5nZXRNdWx0aXRocmVhZGVkKCkpOwog\nICAgICAgIGlmIChfZnVsbCkgewogICAgICAgICAgICBfZnVsbEZNLnNldFN0\nYXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAgIF9mdWxsRk0uZGV0YWNoVmVy\nc2lvbigpOwogICAgICAgICAgICBfZnVsbEZNLnJlcHJveHkoZGV0U00pOwog\nICAgICAgICAgICBfZnVsbEZNLnNldFN0YXRlTWFuYWdlcihudWxsKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBJbnN0YW5jZURldGFjaEZpZWxk\nTWFuYWdlciBmbSA9IG5ldyBJbnN0YW5jZURldGFjaEZpZWxkTWFuYWdlcgog\nICAgICAgICAgICAgICAgKGRldGFjaGVkUEMsIGRldFNNKTsKICAgICAgICAg\nICAgZm0uc2V0U3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICAgICAgZm0uZGV0\nYWNoRmllbGRzKGZpZWxkcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIUJv\nb2xlYW4uRkFMU0UuZXF1YWxzKHNtLmdldE1ldGFEYXRhKCkudXNlc0RldGFj\naGVkU3RhdGUoKSkpCiAgICAgICAgICAgIGRldGFjaGVkUEMucGNTZXREZXRh\nY2hlZFN0YXRlKGdldERldGFjaGVkU3RhdGUoc20sIGZpZWxkcykpOwogICAg\nICAgIGlmICghX2NvcHkpCiAgICAgICAgICAgIHNtLnJlbGVhc2UoZmFsc2Us\nICFfY29weSk7CiAgICAgICAgaWYgKGRldFNNICE9IG51bGwpCiAgICAgICAg\nICAgIGRldGFjaGVkUEMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKGRldFNNKTsK\nICAgICAgICByZXR1cm4gZGV0YWNoZWRQQzsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBib29sZWFuIHVzZURldGFjaGVkU3RhdGVNYW5hZ2VyKFN0YXRl\nTWFuYWdlckltcGwgc20sCiAgICAgICAgRGV0YWNoT3B0aW9ucyBvcHRzKSB7\nCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEo\nKTsKICAgICAgICByZXR1cm4gIUJvb2xlYW4uRkFMU0UuZXF1YWxzKG1ldGEu\ndXNlc0RldGFjaGVkU3RhdGUoKSkgJiYKICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YS5TWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgp\nKSAmJgogICAgICAgICAgICBvcHRzLmdldERldGFjaGVkU3RhdGVNYW5hZ2Vy\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBCYXNlIGRldGFjaCBmaWVsZCBt\nYW5hZ2VyLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBEZXRh\nY2hGaWVsZE1hbmFnZXIKICAgICAgICBleHRlbmRzIFRyYW5zZmVyRmllbGRN\nYW5hZ2VyIHsKCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwg\nc207CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgc291cmNlIHN0\nYXRlIG1hbmFnZXIuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQg\nc2V0U3RhdGVNYW5hZ2VyKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICAgICAgdGhpcy5zbSA9IHNtOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogVHJhbnNmZXIgdGhlIGN1cnJlbnQgdmVyc2lvbiBvYmplY3Qg\nZnJvbSB0aGUgc3RhdGUgbWFuYWdlciB0byB0aGUKICAgICAgICAgKiBkZXRh\nY2hlZCBpbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9p\nZCBkZXRhY2hWZXJzaW9uKCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0VmVyc2lvbkZpZWxkKCk7CiAg\nICAgICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBKYXZhVHlwZXMuY29u\ndmVydChzbS5nZXRWZXJzaW9uKCksCiAgICAgICAgICAgICAgICBmbWQuZ2V0\nVHlwZUNvZGUoKSk7CiAgICAgICAgICAgIHZhbCA9IGZtZC5nZXRGaWVsZFZh\nbHVlKHZhbCwgc20uZ2V0QnJva2VyKCkpOwogICAgICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAg\nICAgICAgICAgICAgICAgICAgbG9uZ3ZhbCA9ICh2YWwgPT0gbnVsbCkgPyAw\nTCA6ICgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRE9VQkxFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6\nCiAgICAgICAgICAgICAgICAgICAgZGJsdmFsID0gKHZhbCA9PSBudWxsKSA/\nIDBEIDogKChOdW1iZXIpIHZhbCkuZG91YmxlVmFsdWUoKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgb2JqdmFsID0gdmFsOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChnZXREZXRhY2hlZFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpLCB0aGlzLAogICAgICAgICAgICAgICAgZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nVW5wcm94aWVzIHNlY29uZCBjbGFzcyBvYmplY3QgZmllbGRzOyBpbiB0aGUg\nZnV0dXJlIHdlIHNob3VsZAogICAgICAgICAqIGluc3RlYWQgc2V0IHRoZXNl\nIGZpZWxkcyB1cCBmb3IgY2hhbmdlIHRyYWNraW5nLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyB2b2lkIHJlcHJveHkoRGV0YWNoZWRTdGF0ZU1hbmFn\nZXIgZHNtKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAg\nICAgICAgICAgICAgICAgICAgIHNtLnByb3ZpZGVGaWVsZChnZXREZXRhY2hl\nZFBlcnNpc3RlbmNlQ2FwYWJsZSgpLCB0aGlzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChv\nYmp2YWwgaW5zdGFuY2VvZiBQcm94eSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgUHJveHkgcHJveHkgPSAoUHJveHkpIG9ianZhbDsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm94eS5nZXRDaGFuZ2VUcmFj\na2VyKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCkuc3RvcFRyYWNraW5nKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHNtID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkuc2V0T3duZXIo\nbnVsbCwgLTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5LnNldE93bmVy\nKGRzbSwgaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjbGVhcigpOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBp\nbnN0YW5jZSBiZWluZyBkZXRhY2hlZC4KICAgICAgICAgKi8KICAgICAgICBw\ncm90ZWN0ZWQgUGVyc2lzdGVuY2VDYXBhYmxlIGdldERldGFjaGVkUGVyc2lz\ndGVuY2VDYXBhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gc20uZ2V0UGVy\nc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogRmllbGRNYW5hZ2VyIHRoYXQgY2FuIGNvcHkgYWxsIHRoZSBmaWVs\nZHMgZnJvbSBvbmUKICAgICAqIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5j\nZSB0byBhbm90aGVyLiBPbmUgb2YgdGhlCiAgICAgKiBpbnN0YW5jZXMgbXVz\ndCBiZSBtYW5hZ2VkIGJ5IGEgU3RhdGVNYW5hZ2VyLCBhbmQgdGhlCiAgICAg\nKiBvdGhlciBtdXN0IGJlIHVubWFuYWdlZC4KICAgICAqCiAgICAgKiBAYXV0\naG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogICAgICovCiAgICBwcml2YXRlIGNs\nYXNzIEluc3RhbmNlRGV0YWNoRmllbGRNYW5hZ2VyCiAgICAgICAgZXh0ZW5k\ncyBEZXRhY2hGaWVsZE1hbmFnZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFs\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBfdG87CiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBEZXRhY2hlZFN0YXRlTWFuYWdlciBfZGV0U007CgogICAgICAgIC8qKgog\nICAgICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgaW5zdGFuY2UgdG8gdG8g\nY29weSB0by4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgSW5zdGFuY2VE\nZXRhY2hGaWVsZE1hbmFnZXIoUGVyc2lzdGVuY2VDYXBhYmxlIHRvLAogICAg\nICAgICAgICBEZXRhY2hlZFN0YXRlTWFuYWdlciBkZXRTTSkgewogICAgICAg\nICAgICBfdG8gPSB0bzsKICAgICAgICAgICAgX2RldFNNID0gZGV0U007CiAg\nICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUGVyc2lzdGVuY2VDYXBhYmxl\nIGdldERldGFjaGVkUGVyc2lzdGVuY2VDYXBhYmxlKCkgewogICAgICAgICAg\nICByZXR1cm4gX3RvOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogRGV0YWNoIHRoZSBmaWVsZHMgb2YgdGhlIHN0YXRlIG1hbmFnZXIgZ2l2\nZW4gb24gY29uc3RydWN0aW9uIHRvCiAgICAgICAgICogdGhlIHBlcnNpc3Rl\nbmNlIGNhcGFibGUgZ2l2ZW4gb24gY29uc3RydWN0aW9uLgogICAgICAgICAq\nIE9ubHkgdGhlIGZpZWxkcyBpbiB0aGUgZ2l2ZW4gYml0IHNldCB3aWxsIGJl\nIGNvcGllZC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBkZXRh\nY2hGaWVsZHMoQml0U2V0IGZnZmllbGRzKSB7CiAgICAgICAgICAgIFBlcnNp\nc3RlbmNlQ2FwYWJsZSBmcm9tID0gc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxl\nKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBzbS5nZXRN\nZXRhRGF0YSgpLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBzbS5nZXRNZXRhRGF0YSgpLmdldEZp\nZWxkcygpOwoKICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAg\nICAgX3RvLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihzbSk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBzdGFydCB3aXRoIHBrIGZp\nZWxkczogb2JqZWN0cyBtaWdodCByZWx5IG9uIHBrIGZpZWxkcyBmb3IKICAg\nICAgICAgICAgICAgIC8vIGVxdWFscyBhbmQgaGFzaENvZGUgbWV0aG9kcywg\nYW5kIHRoaXMgZW5zdXJlcyB0aGF0IHBrIGZpZWxkcwogICAgICAgICAgICAg\nICAgLy8gYXJlIHNldCBwcm9wZXJseSBpZiB3ZSByZXR1cm4gYW55IHBhcnRp\nYWxseS1kZXRhY2hlZCBvYmplY3RzCiAgICAgICAgICAgICAgICAvLyBkdWUg\ndG8gcmVlbnRyYW50IGNhbGxzIHdoZW4gdHJhdmVyc2luZyByZWxhdGlvbnMK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGRldGFjaEZpZWxkKGZyb20s\nIHBrc1tpXS5nZXRJbmRleCgpLCB0cnVlKTsKICAgICAgICAgICAgICAgIGRl\ndGFjaFZlcnNpb24oKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBp\nZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkgJiYgIWZtZHNbaV0uaXNWZXJz\naW9uKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaEZpZWxkKGZy\nb20sIGksIGZnZmllbGRzLmdldChpKSk7CiAgICAgICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgICAgICAvLyBjbGVhciB0aGUgU3RhdGVNYW5hZ2Vy\nIGZyb20gdGhlIHRhcmdldCBvYmplY3QKICAgICAgICAgICAgICAgIGlmIChf\nY29weSkKICAgICAgICAgICAgICAgICAgICBfdG8ucGNSZXBsYWNlU3RhdGVN\nYW5hZ2VyKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBEZXRhY2ggKG9yIGNsZWFyKSB0aGUgZ2l2ZW4g\nZmllbGQgaW5kZXguCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lk\nIGRldGFjaEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBmcm9tLCBpbnQgaSwg\nYm9vbGVhbiBmZykgewogICAgICAgICAgICAvLyB0ZWxsIHRoZSBzdGF0ZSBt\nYW5hZ2VyIHRvIHByb3ZpZGUgdGhlIGZpZWxkcyBmcm9tIHRoZSBzb3VyY2Ug\ndG8KICAgICAgICAgICAgLy8gdGhpcyBmaWVsZCBtYW5hZ2VyLCB3aGljaCB3\naWxsIHRoZW4gcmVwbGFjZSB0aGUgZmllbGQgd2l0aCBhCiAgICAgICAgICAg\nIC8vIGRldGFjaGVkIHZlcnNpb24KICAgICAgICAgICAgaWYgKGZnKQogICAg\nICAgICAgICAgICAgc20ucHJvdmlkZUZpZWxkKGZyb20sIHRoaXMsIGkpOwog\nICAgICAgICAgICBlbHNlIGlmICghX2NvcHkpIHsKICAgICAgICAgICAgICAg\nIC8vIGlmIG5vdCBjb3B5aW5nIGFuZCBmaWVsZCBzaG91bGQgbm90IGJlIGRl\ndGFjaGVkLCBjbGVhciBpdAogICAgICAgICAgICAgICAgY2xlYXIoKTsKICAg\nICAgICAgICAgICAgIHNtLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBz\ndG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3VyVmFsKSB7\nCiAgICAgICAgICAgIHN1cGVyLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBj\ndXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlz\nLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9y\nZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFsKSB7CiAgICAgICAg\nICAgIHN1cGVyLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUNoYXJGaWVsZChp\nbnQgZmllbGQsIGNoYXIgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVyLnN0\nb3JlQ2hhckZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5y\nZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxkKGludCBmaWVsZCwg\nZG91YmxlIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZURvdWJs\nZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNl\nRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzdG9yZUZsb2F0RmllbGQoaW50IGZpZWxkLCBmbG9hdCBj\ndXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVGbG9hdEZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3Rv\nLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBzdG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1clZhbCkgewogICAg\nICAgICAgICBzdXBlci5zdG9yZUludEZpZWxkKGZpZWxkLCBjdXJWYWwpOwog\nICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUxvbmdGaWVs\nZChpbnQgZmllbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgICAgIHN1cGVy\nLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBz\nbS5yZXBsYWNlRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZVNob3J0RmllbGQoaW50IGZpZWxk\nLCBzaG9ydCBjdXJWYWwpIHsKICAgICAgICAgICAgc3VwZXIuc3RvcmVTaG9y\ndEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNl\nRmllbGQoX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5n\nIGN1clZhbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZVN0cmluZ0ZpZWxk\nKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBzbS5yZXBsYWNlRmllbGQo\nX3RvLCB0aGlzLCBmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBzdG9yZU9iamVjdEZpZWxkKGludCBmaWVsZCwgT2JqZWN0IGN1clZh\nbCkgewogICAgICAgICAgICBzdXBlci5zdG9yZU9iamVjdEZpZWxkKGZpZWxk\nLCBkZXRhY2hGaWVsZChjdXJWYWwsIGZpZWxkKSk7CiAgICAgICAgICAgIHNt\nLnJlcGxhY2VGaWVsZChfdG8sIHRoaXMsIGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgb3duZXIgb2YgdGhlIGZp\nZWxkJ3MgcHJveHkgdG8gdGhlIGRldGFjaGVkIHN0YXRlIG1hbmFnZXIuCiAg\nICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBPYmplY3QgcmVwcm94eShPYmpl\nY3Qgb2JqLCBpbnQgZmllbGQpIHsKICAgICAgICAgICAgaWYgKG9iaiAhPSBu\ndWxsICYmIF9kZXRTTSAhPSBudWxsICYmIG9iaiBpbnN0YW5jZW9mIFByb3h5\nKQogICAgICAgICAgICAgICAgKChQcm94eSkgb2JqKS5zZXRPd25lcihfZGV0\nU00sIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIERldGFjaCB0aGUgZ2l2ZW4gdmFs\ndWUgaWYgbmVlZGVkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgT2Jq\nZWN0IGRldGFjaEZpZWxkKE9iamVjdCBjdXJWYWwsIGludCBmaWVsZCkgewog\nICAgICAgICAgICBpZiAoY3VyVmFsID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\nICAgIE9iamVjdCBuZXdWYWwgPSBudWxsOwogICAgICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChfY29weSkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3By\nb3h5LmNvcHlBcnJheShjdXJWYWwpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gY3VyVmFsOwog\nICAgICAgICAgICAgICAgICAgIGRldGFjaEFycmF5KG5ld1ZhbCwgZm1kKTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3VmFsOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAg\nICAgICAgICBpZiAoX2NvcHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKF9kZXRTTSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBuZXdWYWwgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9wcm94eS5uZXdDb2xsZWN0aW9uUHJveHkoZm1kLmdldFByb3h5VHlwZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0\nRWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0\nYW5jZW9mIENvbXBhcmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKENvbXBhcmF0b3IpIGZtZC5nZXRJbml0aWFsaXpl\ncigpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKChDb2xsZWN0\naW9uKSBuZXdWYWwpLmFkZEFsbCgoQ29sbGVjdGlvbikgY3VyVmFsKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUNvbGxlY3Rpb24oKENv\nbGxlY3Rpb24pIGN1clZhbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IGN1clZhbDsKICAg\nICAgICAgICAgICAgICAgICBkZXRhY2hDb2xsZWN0aW9uKChDb2xsZWN0aW9u\nKSBuZXdWYWwsIChDb2xsZWN0aW9uKSBjdXJWYWwsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtZCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJl\ncHJveHkobmV3VmFsLCBmaWVsZCk7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb3B5KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZGV0U00gIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsID0gX3Byb3h5\nLm5ld01hcFByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRU\neXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdl\ndEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuZ2V0SW5pdGlhbGl6ZXIoKSBpbnN0YW5j\nZW9mIENvbXBhcmF0b3IgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAoQ29tcGFyYXRvcikgZm1kLmdldEluaXRpYWxpemVyKCkgOiBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoTWFwKSBuZXdW\nYWwpLnB1dEFsbCgoTWFwKSBjdXJWYWwpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Zh\nbCA9IF9wcm94eS5jb3B5TWFwKChNYXApIGN1clZhbCk7CiAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Zh\nbCA9IGN1clZhbDsKICAgICAgICAgICAgICAgICAgICBkZXRhY2hNYXAoKE1h\ncCkgbmV3VmFsLCAoTWFwKSBjdXJWYWwsIGZtZCk7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFsLCBmaWVsZCk7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAg\nICAgICAgICBuZXdWYWwgPSAoX2NvcHkpID8gX3Byb3h5LmNvcHlDYWxlbmRh\ncigoQ2FsZW5kYXIpIGN1clZhbCkgOgogICAgICAgICAgICAgICAgICAgICAg\nICBjdXJWYWw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHko\nbmV3VmFsLCBmaWVsZCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICAgICAgICAgIG5ld1ZhbCA9IChfY29weSkg\nPyBfcHJveHkuY29weURhdGUoKERhdGUpIGN1clZhbCkgOiBjdXJWYWw7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcHJveHkobmV3VmFsLCBmaWVs\nZCk7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAgICAgICAg\nICAgICAgICBuZXdWYWwgPSBfcHJveHkuY29weUN1c3RvbShjdXJWYWwpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiByZXByb3h5KChuZXdWYWwgPT0g\nbnVsbCkgPyBjdXJWYWwgOiBuZXdWYWwsIGZpZWxkKTsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZGV0YWNoSW50ZXJuYWwoY3VyVmFsKTsKICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1clZhbDsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nTWFrZSBzdXJlIGFsbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBhcnJheSBh\ncmUgZGV0YWNoZWQuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lk\nIGRldGFjaEFycmF5KE9iamVjdCBhcnJheSwgRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICAgICAgaWYgKCFmbWQuZ2V0RWxlbWVudCgpLmlzRGVjbGFy\nZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nICAgIGludCBsZW4gPSBBcnJheS5nZXRMZW5ndGgoYXJyYXkpOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKQogICAgICAgICAg\nICAgICAgQXJyYXkuc2V0KGFycmF5LCBpLCBkZXRhY2hJbnRlcm5hbChBcnJh\neS5nZXQoYXJyYXksIGkpKSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBNYWtlIHN1cmUgYWxsIHRoZSB2YWx1ZXMgaW4gdGhlIGdpdmVu\nIGNvbGxlY3Rpb24gYXJlIGRldGFjaGVkLgogICAgICAgICAqLwogICAgICAg\nIHByaXZhdGUgdm9pZCBkZXRhY2hDb2xsZWN0aW9uKENvbGxlY3Rpb24gY29s\nbCwgQ29sbGVjdGlvbiBvcmlnLAogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCkgewogICAgICAgICAgICAvLyBjb2xsIGNhbiBiZSBudWxsIGlmIG5v\ndCBjb3B5YWJsZSAobHJzLCBmb3IgaW5zdGFuY2UpCiAgICAgICAgICAgIGlm\nIChfY29weSAmJiBjb2xsID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm90LWNvcHlhYmxlIiwg\nZm1kKSk7CiAgICAgICAgICAgIGlmICghZm1kLmdldEVsZW1lbnQoKS5pc0Rl\nY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAg\nICAgICAgICAvLyB1bmZvcnR1bmF0ZWx5IHdlIGhhdmUgdG8gY2xlYXIgdGhl\nIG9yaWdpbmFsIGFuZCByZS1hZGQgdG8gY29weQogICAgICAgICAgICBpZiAo\nX2NvcHkpCiAgICAgICAgICAgICAgICBjb2xsLmNsZWFyKCk7CiAgICAgICAg\nICAgIE9iamVjdCBkZXRhY2hlZDsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBvcmlnLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBkZXRhY2hlZCA9IGRldGFjaEludGVybmFsKGl0ci5u\nZXh0KCkpOwogICAgICAgICAgICAgICAgaWYgKF9jb3B5KQogICAgICAgICAg\nICAgICAgICAgIGNvbGwuYWRkKGRldGFjaGVkKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogTWFrZSBzdXJlIGFs\nbCB0aGUgdmFsdWVzIGluIHRoZSBnaXZlbiBtYXAgYXJlIGRldGFjaGVkLgog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBkZXRhY2hNYXAoTWFw\nIG1hcCwgTWFwIG9yaWcsIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAg\nICAgIC8vIG1hcCBjYW4gYmUgbnVsbCBpZiBub3QgY29weWFibGUgKGxycywg\nZm9yIGluc3RhbmNlKQogICAgICAgICAgICBpZiAoX2NvcHkgJiYgbWFwID09\nIG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm90LWNvcHlhYmxlIiwgZm1kKSk7CiAgICAgICAgICAg\nIGJvb2xlYW4ga2V5UEMgPSBmbWQuZ2V0S2V5KCkuaXNEZWNsYXJlZFR5cGVQ\nQygpOwogICAgICAgICAgICBib29sZWFuIHZhbFBDID0gZm1kLmdldEVsZW1l\nbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgICAgIGlmICgha2V5\nUEMgJiYgIXZhbFBDKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAgICAgLy8gaWYgd2UgaGF2ZSB0byBjb3B5IGtleXMsIGp1c3QgY2xlYXIg\nYW5kIHJlLWFkZDsgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHdlIGNhbiB1\nc2UgdGhlIGVudHJ5IHNldCB0byByZXNldCB0aGUgdmFsdWVzIG9ubHkKICAg\nICAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgICAgICBpZiAoIV9j\nb3B5IHx8IGtleVBDKSB7CiAgICAgICAgICAgICAgICBpZiAoX2NvcHkpCiAg\nICAgICAgICAgICAgICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAgICAgICAg\nICBPYmplY3Qga2V5LCB2YWw7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IG9yaWcuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg\nICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICAgICAga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGtleVBDKQogICAgICAgICAgICAgICAgICAgICAgICBrZXkg\nPSBkZXRhY2hJbnRlcm5hbChrZXkpOwogICAgICAgICAgICAgICAgICAgIHZh\nbCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHZhbFBDKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBkZXRhY2hJ\nbnRlcm5hbCh2YWwpOwogICAgICAgICAgICAgICAgICAgIGlmIChfY29weSkK\nICAgICAgICAgICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIHZhbCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAg\nICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCAoKTsKCQkJCQllbnRy\neS5zZXRWYWx1ZSAoZGV0YWNoSW50ZXJuYWwgKGVudHJ5LmdldFZhbHVlICgp\nKSk7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0K\n","encoding":"base64"}

