{"sha":"b505c11fd8bf8529cbfba0523e297da19b3b53a4","node_id":"MDQ6QmxvYjIwNjM2NDpiNTA1YzExZmQ4YmY4NTI5Y2JmYmEwNTIzZTI5N2RhMTliM2I1M2E0","size":20846,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b505c11fd8bf8529cbfba0523e297da19b3b53a4","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLkVhZ2VyUmVzdWx0TGlz\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLkxpc3RSZXN1\nbHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIucm9wLlJlc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnJvcC5SZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIucm9wLlNpbXBsZVJlc3VsdExpc3Q7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5XaW5kb3dSZXN1bHRMaXN0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTm9UcmFuc2Fj\ndGlvbkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVzZXJFeGNlcHRpb247CgovKioKICogQWxsb3dzIGNvbmZpZ3VyYXRpb24g\nYW5kIG9wdGltaXphdGlvbiBvZiBob3cgb2JqZWN0cyBhcmUgbG9hZGVkIGZy\nb20KICogdGhlIGRhdGEgc3RvcmUuCiAqCiAqIEBzaW5jZSAwLjMuMAogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICog\nQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEZldGNoQ29uZmlndXJhdGlv\nbkltcGwKICAgIGltcGxlbWVudHMgRmV0Y2hDb25maWd1cmF0aW9uLCBDbG9u\nZWFibGUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBf\nbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoRmV0Y2hDb25m\naWd1cmF0aW9uSW1wbC5jbGFzcyk7CgogICAgLyoqCiAgICAgKiBDb25maWd1\ncmFibGUgc3RhdGUgc2hhcmVkIHRocm91Z2hvdXQgYSB0cmF2ZXJzYWwgY2hh\naW4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgQ29uZmln\ndXJhdGlvblN0YXRlCiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUK\nICAgIHsKICAgICAgICBwdWJsaWMgdHJhbnNpZW50IFN0b3JlQ29udGV4dCBj\ndHggPSBudWxsOwogICAgICAgIHB1YmxpYyBpbnQgZmV0Y2hCYXRjaFNpemUg\nPSAwOwogICAgICAgIHB1YmxpYyBpbnQgbWF4RmV0Y2hEZXB0aCA9IDE7CiAg\nICAgICAgcHVibGljIGJvb2xlYW4gcXVlcnlDYWNoZSA9IHRydWU7CiAgICAg\nICAgcHVibGljIGludCBmbHVzaFF1ZXJ5ID0gMDsKICAgICAgICBwdWJsaWMg\naW50IGxvY2tUaW1lb3V0ID0gLTE7CiAgICAgICAgcHVibGljIGludCByZWFk\nTG9ja0xldmVsID0gTE9DS19OT05FOwogICAgICAgIHB1YmxpYyBpbnQgd3Jp\ndGVMb2NrTGV2ZWwgPSBMT0NLX05PTkU7CiAgICAgICAgcHVibGljIFNldCBm\nZXRjaEdyb3VwcyA9IG51bGw7CiAgICAgICAgcHVibGljIFNldCBmaWVsZHMg\nPSBudWxsOwogICAgICAgIHB1YmxpYyBTZXQgcm9vdENsYXNzZXM7CiAgICAg\nICAgcHVibGljIFNldCByb290SW5zdGFuY2VzOwogICAgICAgIHB1YmxpYyBN\nYXAgaGludHMgPSBudWxsOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgQ29u\nZmlndXJhdGlvblN0YXRlIF9zdGF0ZTsKICAgIHByaXZhdGUgRmV0Y2hDb25m\naWd1cmF0aW9uSW1wbCBfcGFyZW50OwogICAgcHJpdmF0ZSBTdHJpbmcgX2Zy\nb21GaWVsZDsKICAgIHByaXZhdGUgQ2xhc3MgX2Zyb21UeXBlOwogICAgcHJp\ndmF0ZSBpbnQgX2F2YWlsYWJsZVJlY3Vyc2lvbjsKICAgIHByaXZhdGUgaW50\nIF9hdmFpbGFibGVEZXB0aDsKCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0\naW9uSW1wbCgpIHsKICAgICAgICB0aGlzKG51bGwpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBGZXRjaENvbmZpZ3VyYXRpb25JbXBsKENvbmZpZ3VyYXRpb25T\ndGF0ZSBzdGF0ZSkgewogICAgICAgIF9zdGF0ZSA9IChzdGF0ZSA9PSBudWxs\nKSA/IG5ldyBDb25maWd1cmF0aW9uU3RhdGUoKSA6IHN0YXRlOwogICAgICAg\nIF9hdmFpbGFibGVEZXB0aCA9IF9zdGF0ZS5tYXhGZXRjaERlcHRoOwogICAg\nfSAKCiAgICBwdWJsaWMgU3RvcmVDb250ZXh0IGdldENvbnRleHQoKSB7CiAg\nICAgICAgcmV0dXJuIF9zdGF0ZS5jdHg7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4KSB7CiAgICAgICAgLy8g\nY2FuJ3QgcmVzZXQgbm9uLW51bGwgY29udGV4dCB0byBhbm90aGVyIGNvbnRl\neHQKICAgICAgICBpZiAoY3R4ICE9IG51bGwgJiYgX3N0YXRlLmN0eCAhPSBu\ndWxsICYmIGN0eCAhPSBfc3RhdGUuY3R4KQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICBfc3RhdGUuY3R4ID0g\nY3R4OwogICAgICAgIGlmIChjdHggPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyBpbml0aWFsaXplIHRvIGNvbmYgaW5mbwogICAg\nICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYgPSBjdHguZ2V0Q29uZmln\ndXJhdGlvbigpOwogICAgICAgIHNldEZldGNoQmF0Y2hTaXplKGNvbmYuZ2V0\nRmV0Y2hCYXRjaFNpemUoKSk7CiAgICAgICAgc2V0Rmx1c2hCZWZvcmVRdWVy\naWVzKGNvbmYuZ2V0Rmx1c2hCZWZvcmVRdWVyaWVzQ29uc3RhbnQoKSk7CiAg\nICAgICAgY2xlYXJGZXRjaEdyb3VwcygpOwogICAgICAgIGFkZEZldGNoR3Jv\ndXBzKEFycmF5cy5hc0xpc3QoY29uZi5nZXRGZXRjaEdyb3Vwc0xpc3QoKSkp\nOwogICAgICAgIHNldE1heEZldGNoRGVwdGgoY29uZi5nZXRNYXhGZXRjaERl\ncHRoKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvbmUgdGhpcyBpbnN0\nYW5jZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBjbG9uZSgpIHsKICAg\nICAgICBGZXRjaENvbmZpZ3VyYXRpb25JbXBsIGNsb25lID0gbmV3SW5zdGFu\nY2UobnVsbCk7CiAgICAgICAgY2xvbmUuX3N0YXRlLmN0eCA9IF9zdGF0ZS5j\ndHg7CiAgICAgICAgY2xvbmUuX3BhcmVudCA9IF9wYXJlbnQ7CiAgICAgICAg\nY2xvbmUuX2Zyb21GaWVsZCA9IF9mcm9tRmllbGQ7CiAgICAgICAgY2xvbmUu\nX2Zyb21UeXBlID0gX2Zyb21UeXBlOwogICAgICAgIGNsb25lLl9hdmFpbGFi\nbGVSZWN1cnNpb24gPSBfYXZhaWxhYmxlUmVjdXJzaW9uOwogICAgICAgIGNs\nb25lLl9hdmFpbGFibGVEZXB0aCA9IF9hdmFpbGFibGVEZXB0aDsKICAgICAg\nICBjbG9uZS5jb3B5KHRoaXMpOwogICAgICAgIHJldHVybiBjbG9uZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG5ldyBob2xsb3cgaW5zdGFu\nY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGZXRjaENvbmZpZ3VyYXRpb25J\nbXBsIG5ld0luc3RhbmNlKENvbmZpZ3VyYXRpb25TdGF0ZSBzdGF0ZSkgewog\nICAgICAgIHJldHVybiBuZXcgRmV0Y2hDb25maWd1cmF0aW9uSW1wbChzdGF0\nZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29weShGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gpIHsKICAgICAgICBzZXRGZXRjaEJhdGNoU2l6ZShmZXRj\naC5nZXRGZXRjaEJhdGNoU2l6ZSgpKTsKICAgICAgICBzZXRNYXhGZXRjaERl\ncHRoKGZldGNoLmdldE1heEZldGNoRGVwdGgoKSk7CiAgICAgICAgc2V0UXVl\ncnlDYWNoZShmZXRjaC5nZXRRdWVyeUNhY2hlKCkpOwogICAgICAgIHNldEZs\ndXNoQmVmb3JlUXVlcmllcyhmZXRjaC5nZXRGbHVzaEJlZm9yZVF1ZXJpZXMo\nKSk7CiAgICAgICAgc2V0TG9ja1RpbWVvdXQoZmV0Y2guZ2V0TG9ja1RpbWVv\ndXQoKSk7CiAgICAgICAgY2xlYXJGZXRjaEdyb3VwcygpOwogICAgICAgIGFk\nZEZldGNoR3JvdXBzKGZldGNoLmdldEZldGNoR3JvdXBzKCkpOwogICAgICAg\nIGNsZWFyRmllbGRzKCk7CiAgICAgICAgYWRkRmllbGRzKGZldGNoLmdldEZp\nZWxkcygpKTsKCiAgICAgICAgLy8gZG9uJ3QgdXNlIHNldHRlcnMgYmVjYXVz\nZSByZXF1aXJlIGFjdGl2ZSB0cmFuc2FjdGlvbgogICAgICAgIF9zdGF0ZS5y\nZWFkTG9ja0xldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAg\nICAgIF9zdGF0ZS53cml0ZUxvY2tMZXZlbCA9IGZldGNoLmdldFdyaXRlTG9j\na0xldmVsKCk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRGZXRjaEJhdGNo\nU2l6ZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmZldGNoQmF0Y2hTaXpl\nOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0RmV0\nY2hCYXRjaFNpemUoaW50IGZldGNoQmF0Y2hTaXplKSB7CiAgICAgICAgaWYg\nKGZldGNoQmF0Y2hTaXplID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAhPSBu\ndWxsKQogICAgICAgICAgICBmZXRjaEJhdGNoU2l6ZSA9IF9zdGF0ZS5jdHgu\nZ2V0Q29uZmlndXJhdGlvbigpLmdldEZldGNoQmF0Y2hTaXplKCk7CiAgICAg\nICAgaWYgKGZldGNoQmF0Y2hTaXplICE9IERFRkFVTFQpCiAgICAgICAgICAg\nIF9zdGF0ZS5mZXRjaEJhdGNoU2l6ZSA9IGZldGNoQmF0Y2hTaXplOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TWF4\nRmV0Y2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLm1heEZldGNo\nRGVwdGg7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBz\nZXRNYXhGZXRjaERlcHRoKGludCBkZXB0aCkgewogICAgICAgIGlmIChkZXB0\naCA9PSBERUZBVUxUICYmIF9zdGF0ZS5jdHggIT0gbnVsbCkKICAgICAgICAg\nICAgZGVwdGggPSBfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRN\nYXhGZXRjaERlcHRoKCk7CiAgICAgICAgaWYgKGRlcHRoICE9IERFRkFVTFQp\nCiAgICAgICAgewogICAgICAgICAgICBfc3RhdGUubWF4RmV0Y2hEZXB0aCA9\nIGRlcHRoOwogICAgICAgICAgICBpZiAoX3BhcmVudCA9PSBudWxsKQogICAg\nICAgICAgICAgICAgX2F2YWlsYWJsZURlcHRoID0gZGVwdGg7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGdldFF1ZXJ5Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5x\ndWVyeUNhY2hlOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRp\nb24gc2V0UXVlcnlDYWNoZShib29sZWFuIGNhY2hlKSB7CiAgICAgICAgX3N0\nYXRlLnF1ZXJ5Q2FjaGUgPSBjYWNoZTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEZsdXNoQmVmb3JlUXVlcmllcygp\nIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmZsdXNoUXVlcnk7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRGbHVzaEJlZm9yZVF1\nZXJpZXMoaW50IGZsdXNoKSB7CiAgICAgICAgaWYgKGZsdXNoID09IERFRkFV\nTFQgJiYgX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBfc3RhdGUu\nZmx1c2hRdWVyeSA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLgog\nICAgICAgICAgICAgICAgZ2V0Rmx1c2hCZWZvcmVRdWVyaWVzQ29uc3RhbnQo\nKTsKICAgICAgICBlbHNlIGlmIChmbHVzaCAhPSBERUZBVUxUKQogICAgICAg\nICAgICBfc3RhdGUuZmx1c2hRdWVyeSA9IGZsdXNoOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBTZXQgZ2V0RmV0Y2hHcm91cHMo\nKSB7CiAgICAgICAgcmV0dXJuIChfc3RhdGUuZmV0Y2hHcm91cHMgPT0gbnVs\nbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgCiAgICAgICAgICAgIDogX3N0\nYXRlLmZldGNoR3JvdXBzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhh\nc0ZldGNoR3JvdXAoU3RyaW5nIGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIF9z\ndGF0ZS5mZXRjaEdyb3VwcyAhPSBudWxsCiAgICAgICAgICAgICYmIChfc3Rh\ndGUuZmV0Y2hHcm91cHMuY29udGFpbnMoZ3JvdXApCiAgICAgICAgICAgIHx8\nIF9zdGF0ZS5mZXRjaEdyb3Vwcy5jb250YWlucyhGZXRjaEdyb3VwLk5BTUVf\nQUxMKSk7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBh\nZGRGZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLWZnIikpOwoKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5m\nZXRjaEdyb3VwcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLmZl\ndGNoR3JvdXBzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgX3N0YXRl\nLmZldGNoR3JvdXBzLmFkZChuYW1lKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBh\nZGRGZXRjaEdyb3VwcyhDb2xsZWN0aW9uIGdyb3VwcykgewogICAgICAgIGlm\nIChncm91cHMgPT0gbnVsbCB8fCBncm91cHMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGdyb3Vwcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAg\nICAgYWRkRmV0Y2hHcm91cCgoU3RyaW5nKSBpdHIubmV4dCgpKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1\ncmF0aW9uIHJlbW92ZUZldGNoR3JvdXAoU3RyaW5nIGdyb3VwKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3Rh\ndGUuZmV0Y2hHcm91cHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0\nZS5mZXRjaEdyb3Vwcy5yZW1vdmUoZ3JvdXApOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0\naW9uIHJlbW92ZUZldGNoR3JvdXBzKENvbGxlY3Rpb24gZ3JvdXBzKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChf\nc3RhdGUuZmV0Y2hHcm91cHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9z\ndGF0ZS5mZXRjaEdyb3Vwcy5yZW1vdmVBbGwoZ3JvdXBzKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29u\nZmlndXJhdGlvbiBjbGVhckZldGNoR3JvdXBzKCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNo\nR3JvdXBzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hH\ncm91cHMuY2xlYXIoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZXNldEZldGNo\nR3JvdXBzKCkgewogICAgICAgIGNsZWFyRmV0Y2hHcm91cHMoKTsKICAgICAg\nICBpZiAoX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBhZGRGZXRj\naEdyb3VwcyhBcnJheXMuYXNMaXN0KF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJh\ndGlvbigpLgogICAgICAgICAgICAgICAgZ2V0RmV0Y2hHcm91cHNMaXN0KCkp\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU2V0\nIGdldEZpZWxkcygpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5maWVsZHMg\nPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQgOiBfc3RhdGUuZmll\nbGRzOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0ZpZWxkKFN0cmlu\nZyBmaWVsZCkgewogICAgICAgIHJldHVybiBfc3RhdGUuZmllbGRzICE9IG51\nbGwgJiYgX3N0YXRlLmZpZWxkcy5jb250YWlucyhmaWVsZCk7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBhZGRGaWVsZChTdHJpbmcg\nZmllbGQpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShmaWVs\nZCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJudWxsLWZpZWxkIikpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMgPSBuZXcgSGFzaFNldCgp\nOwogICAgICAgICAgICBfc3RhdGUuZmllbGRzLmFkZChmaWVsZCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gYWRkRmllbGRzKENvbGxlY3Rpb24gZmllbGRzKSB7\nCiAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsIHx8IGZpZWxkcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMgPSBuZXcg\nSGFzaFNldCgpOwogICAgICAgICAgICBfc3RhdGUuZmllbGRzLmFkZEFsbChm\naWVsZHMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHJlbW92ZUZpZWxkKFN0cmlu\nZyBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX3N0YXRlLmZpZWxkcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX3N0YXRlLmZpZWxkcy5yZW1vdmUoZmllbGQpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25m\naWd1cmF0aW9uIHJlbW92ZUZpZWxkcyhDb2xsZWN0aW9uIGZpZWxkcykgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nX3N0YXRlLmZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRl\nLmZpZWxkcy5yZW1vdmVBbGwoZmllbGRzKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlv\nbiBjbGVhckZpZWxkcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zdGF0ZS5maWVsZHMuY2xlYXIoKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRM\nb2NrVGltZW91dCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmxvY2tUaW1l\nb3V0OwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0\nTG9ja1RpbWVvdXQoaW50IHRpbWVvdXQpIHsKICAgICAgICBpZiAodGltZW91\ndCA9PSBERUZBVUxUICYmIF9zdGF0ZS5jdHggIT0gbnVsbCkKICAgICAgICAg\nICAgX3N0YXRlLmxvY2tUaW1lb3V0ID0gX3N0YXRlLmN0eC5nZXRDb25maWd1\ncmF0aW9uKCkuZ2V0TG9ja1RpbWVvdXQoKTsKICAgICAgICBlbHNlIGlmICh0\naW1lb3V0ICE9IERFRkFVTFQpCiAgICAgICAgICAgIF9zdGF0ZS5sb2NrVGlt\nZW91dCA9IHRpbWVvdXQ7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cgog\nICAgcHVibGljIGludCBnZXRSZWFkTG9ja0xldmVsKCkgewogICAgICAgIHJl\ndHVybiBfc3RhdGUucmVhZExvY2tMZXZlbDsKICAgIH0KCiAgICBwdWJsaWMg\nRmV0Y2hDb25maWd1cmF0aW9uIHNldFJlYWRMb2NrTGV2ZWwoaW50IGxldmVs\nKSB7CiAgICAgICAgaWYgKF9zdGF0ZS5jdHggPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwogICAg\nICAgICAgICBpZiAobGV2ZWwgPT0gREVGQVVMVCkKICAgICAgICAgICAgICAg\nIF9zdGF0ZS5yZWFkTG9ja0xldmVsID0gX3N0YXRlLmN0eC5nZXRDb25maWd1\ncmF0aW9uKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0UmVhZExvY2tMZXZl\nbENvbnN0YW50KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIF9zdGF0ZS5yZWFkTG9ja0xldmVsID0gbGV2ZWw7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0V3JpdGVM\nb2NrTGV2ZWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS53cml0ZUxvY2tM\nZXZlbDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNl\ndFdyaXRlTG9ja0xldmVsKGludCBsZXZlbCkgewogICAgICAgIGlmIChfc3Rh\ndGUuY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nQWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKGxldmVsID09\nIERFRkFVTFQpCiAgICAgICAgICAgICAgICBfc3RhdGUud3JpdGVMb2NrTGV2\nZWwgPSBfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAg\nICAgICAgICAgICBnZXRXcml0ZUxvY2tMZXZlbENvbnN0YW50KCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9zdGF0ZS53cml0ZUxvY2tM\nZXZlbCA9IGxldmVsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAg\nIH0KCiAgICBwdWJsaWMgUmVzdWx0TGlzdCBuZXdSZXN1bHRMaXN0KFJlc3Vs\ndE9iamVjdFByb3ZpZGVyIHJvcCkgewogICAgICAgIGlmIChyb3AgaW5zdGFu\nY2VvZiBMaXN0UmVzdWx0T2JqZWN0UHJvdmlkZXIpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgU2ltcGxlUmVzdWx0TGlzdChyb3ApOwogICAgICAgIGlmIChf\nc3RhdGUuZmV0Y2hCYXRjaFNpemUgPCAwKQogICAgICAgICAgICByZXR1cm4g\nbmV3IEVhZ2VyUmVzdWx0TGlzdChyb3ApOwogICAgICAgIGlmIChyb3Auc3Vw\ncG9ydHNSYW5kb21BY2Nlc3MoKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBT\naW1wbGVSZXN1bHRMaXN0KHJvcCk7CiAgICAgICAgcmV0dXJuIG5ldyBXaW5k\nb3dSZXN1bHRMaXN0KHJvcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJv\ndyBhbiBleGNlcHRpb24gaWYgbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rp\nb24oKSB7CiAgICAgICAgaWYgKF9zdGF0ZS5jdHggIT0gbnVsbCAmJiAhX3N0\nYXRlLmN0eC5pc0FjdGl2ZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTm9U\ncmFuc2FjdGlvbkV4Y2VwdGlvbihfbG9jLmdldCgibm90LWFjdGl2ZSIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRIaW50KFN0cmluZyBuYW1lLCBP\nYmplY3QgdmFsdWUpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF9zdGF0ZS5oaW50cyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX3N0YXRlLmhpbnRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAg\nICAgICAgX3N0YXRlLmhpbnRzLnB1dChuYW1lLCB2YWx1ZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SGludChTdHJpbmcgbmFtZSkg\newogICAgICAgIHJldHVybiAoX3N0YXRlLmhpbnRzID09IG51bGwpID8gbnVs\nbCA6IF9zdGF0ZS5oaW50cy5nZXQobmFtZSk7CiAgICB9CgogICAgcHVibGlj\nIFNldCBnZXRSb290Q2xhc3NlcygpIHsKICAgICAgICByZXR1cm4gKF9zdGF0\nZS5yb290Q2xhc3NlcyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX1NF\nVCAKICAgICAgICAgICAgOiBfc3RhdGUucm9vdENsYXNzZXM7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRSb290Q2xhc3NlcyhD\nb2xsZWN0aW9uIGNsYXNzZXMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290Q2xhc3NlcyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLnJvb3RDbGFzc2VzLmNsZWFy\nKCk7CiAgICAgICAgICAgIGlmIChjbGFzc2VzICE9IG51bGwgJiYgIWNsYXNz\nZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX3N0YXRlLnJv\nb3RDbGFzc2VzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3N0YXRl\nLnJvb3RDbGFzc2VzID0gbmV3IEhhc2hTZXQoY2xhc3Nlcyk7CiAgICAgICAg\nICAgICAgICBlbHNlIAogICAgICAgICAgICAgICAgICAgIF9zdGF0ZS5yb290\nQ2xhc3Nlcy5hZGRBbGwoY2xhc3Nlcyk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIFNldCBn\nZXRSb290SW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiAoX3N0YXRlLnJv\nb3RJbnN0YW5jZXMgPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5FTVBUWV9TRVQg\nCiAgICAgICAgICAgIDogX3N0YXRlLnJvb3RJbnN0YW5jZXM7CiAgICB9Cgog\nICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRSb290SW5zdGFuY2Vz\nKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUucm9vdEluc3RhbmNl\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLnJvb3RJbnN0YW5j\nZXMuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlcyAhPSBudWxs\nICYmICFpbnN0YW5jZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBp\nZiAoX3N0YXRlLnJvb3RJbnN0YW5jZXMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBfc3RhdGUucm9vdEluc3RhbmNlcyA9IG5ldyBIYXNoU2V0KGlu\nc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAg\nICAgICAgIF9zdGF0ZS5yb290SW5zdGFuY2VzLmFkZEFsbChpbnN0YW5jZXMp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9z\ndGF0ZS5jdHggIT0gbnVsbCkKICAgICAgICAgICAgX3N0YXRlLmN0eC5sb2Nr\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdW5sb2NrKCkgewogICAgICAg\nIGlmIChfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIF9zdGF0ZS5j\ndHgudW5sb2NrKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLwogICAgLy8g\nVHJhdmVyc2FsCiAgICAvLy8vLy8vLy8vLy8vCiAgICAKICAgIHB1YmxpYyBi\nb29sZWFuIHJlcXVpcmVzRmV0Y2goRmllbGRNZXRhRGF0YSBmbSkgewogICAg\nICAgIGlmICghaW5jbHVkZXMoZm0pKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgCiAgICAgICAgQ2xhc3MgdHlwZSA9IGdldFJlbGF0aW9u\nVHlwZShmbSk7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKF9hdmFpbGFibGVEZXB0aCA9\nPSAwKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHdl\nIGNhbiBza2lwIGNhbGN1bGF0aW5nIHJlY3Vyc2lvbiBkZXB0aCBpZiB0aGlz\nIGlzIGEgdG9wLWxldmVsIGNvbmY6CiAgICAgICAgLy8gdGhlIGZpZWxkIGlz\nIGluIG91ciBmZXRjaCBncm91cHMsIHNvIGNhbid0IHBvc3NpYmx5IG5vdCBz\nZWxlY3QKICAgICAgICBpZiAoX3BhcmVudCA9PSBudWxsKSAKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CgogICAgICAgIGludCByZGVwdGggPSBnZXRBdmFp\nbGFibGVSZWN1cnNpb25EZXB0aChmbSwgdHlwZSwgZmFsc2UpOwogICAgICAg\nIHJldHVybiByZGVwdGggPT0gRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSB8\nfCByZGVwdGggPiAwOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gdHJhdmVyc2UoRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIENs\nYXNzIHR5cGUgPSBnZXRSZWxhdGlvblR5cGUoZm0pOwogICAgICAgIGlmICh0\neXBlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwoKICAgICAg\nICBGZXRjaENvbmZpZ3VyYXRpb25JbXBsIGNsb25lID0gbmV3SW5zdGFuY2Uo\nX3N0YXRlKTsKICAgICAgICBjbG9uZS5fcGFyZW50ID0gdGhpczsKICAgICAg\nICBjbG9uZS5fYXZhaWxhYmxlRGVwdGggPSByZWR1Y2UoX2F2YWlsYWJsZURl\ncHRoKTsKICAgICAgICBjbG9uZS5fZnJvbUZpZWxkID0gZm0uZ2V0RnVsbE5h\nbWUoZmFsc2UpOwogICAgICAgIGNsb25lLl9mcm9tVHlwZSA9IHR5cGU7CiAg\nICAgICAgY2xvbmUuX2F2YWlsYWJsZVJlY3Vyc2lvbiA9IGdldEF2YWlsYWJs\nZVJlY3Vyc2lvbkRlcHRoKGZtLCB0eXBlLCB0cnVlKTsKICAgICAgICByZXR1\ncm4gY2xvbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG91ciBj\nb25maWd1cmF0aW9uIHN0YXRlIGluY2x1ZGVzIHRoZSBnaXZlbiBmaWVsZC4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGluY2x1ZGVzKEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgaWYgKChmbWQuaXNJbkRlZmF1bHRGZXRj\naEdyb3VwKCkgCiAgICAgICAgICAgICYmIGhhc0ZldGNoR3JvdXAoRmV0Y2hH\ncm91cC5OQU1FX0RFRkFVTFQpKQogICAgICAgICAgICB8fCBoYXNGZXRjaEdy\nb3VwKEZldGNoR3JvdXAuTkFNRV9BTEwpCiAgICAgICAgICAgIHx8IGhhc0Zp\nZWxkKGZtZC5nZXRGdWxsTmFtZShmYWxzZSkpKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICBTdHJpbmdbXSBmZ3MgPSBmbWQuZ2V0Q3VzdG9t\nRmV0Y2hHcm91cHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZn\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGhhc0ZldGNoR3JvdXAo\nZmdzW2ldKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIHJldHVybiBmYWxzZTsgCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGF2YWlsYWJsZSByZWN1cnNpb24gZGVwdGggdmlhIHRoZSBnaXZlbiBm\naWVsZCBmb3IgdGhlCiAgICAgKiBnaXZlbiB0eXBlLgogICAgICoKICAgICAq\nIEBwYXJhbSB0cmF2ZXJzZSB3aGV0aGVyIHdlJ3JlIHRyYXZlcnNpbmcgdGhl\nIGZpZWxkCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdldEF2YWlsYWJsZVJl\nY3Vyc2lvbkRlcHRoKEZpZWxkTWV0YURhdGEgZm0sIENsYXNzIHR5cGUsIAog\nICAgICAgIGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICAvLyBzZWUgaWYg\ndGhlcmUncyBhIHByZXZpb3VzIGxpbWl0CiAgICAgICAgaW50IGF2YWlsID0g\nSW50ZWdlci5NSU5fVkFMVUU7CiAgICAgICAgZm9yIChGZXRjaENvbmZpZ3Vy\nYXRpb25JbXBsIGYgPSB0aGlzOyBmICE9IG51bGw7IGYgPSBmLl9wYXJlbnQp\nIHsKICAgICAgICAgICAgaWYgKGlzQXNzaWduYWJsZSh0eXBlLCBmLl9mcm9t\nVHlwZSkpIHsKICAgICAgICAgICAgICAgIGF2YWlsID0gZi5fYXZhaWxhYmxl\nUmVjdXJzaW9uOwogICAgICAgICAgICAgICAgaWYgKHRyYXZlcnNlKQogICAg\nICAgICAgICAgICAgICAgIGF2YWlsID0gcmVkdWNlKGF2YWlsKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGlmIChhdmFpbCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAg\nICAgICAKICAgICAgICAvLyBjYWxjdWxhdGUgZmV0Y2ggZ3JvdXBzIG1heAog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGZtLmdldERlZmluaW5nTWV0\nYURhdGEoKTsKICAgICAgICBpbnQgbWF4ID0gSW50ZWdlci5NSU5fVkFMVUU7\nCiAgICAgICAgaWYgKGZtLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAg\nICAgICAgICBtYXggPSBtZXRhLmdldEZldGNoR3JvdXAoRmV0Y2hHcm91cC5O\nQU1FX0RFRkFVTFQpLgogICAgICAgICAgICAgICAgZ2V0UmVjdXJzaW9uRGVw\ndGgoZm0pOwogICAgICAgIFN0cmluZ1tdIGdyb3VwcyA9IGZtLmdldEN1c3Rv\nbUZldGNoR3JvdXBzKCk7CiAgICAgICAgaW50IGN1cjsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgbWF4ICE9IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUg\nCiAgICAgICAgICAgICYmIGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgY3VyID0gbWV0YS5nZXRGZXRjaEdyb3VwKGdyb3Vwc1tpXSku\nZ2V0UmVjdXJzaW9uRGVwdGgoZm0pOwogICAgICAgICAgICBpZiAoY3VyID09\nIEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUgfHwgY3VyID4gbWF4KSAKICAg\nICAgICAgICAgICAgIG1heCA9IGN1cjsKICAgICAgICB9CiAgICAgICAgLy8g\ncmVkdWNlIG1heCBpZiB3ZSdyZSB0cmF2ZXJzaW5nIGEgc2VsZi10eXBlIHJl\nbGF0aW9uCiAgICAgICAgaWYgKHRyYXZlcnNlICYmIG1heCAhPSBJbnRlZ2Vy\nLk1JTl9WQUxVRSAKICAgICAgICAgICAgJiYgaXNBc3NpZ25hYmxlKG1ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpLCB0eXBlKSkKICAgICAgICAgICAgbWF4ID0g\ncmVkdWNlKG1heCk7CgogICAgICAgIC8vIHRha2UgbWluL2RlZmluZWQgb2Yg\ncHJldmlvdXMgYXZhaWwgYW5kIGZldGNoIGdyb3VwIG1heAogICAgICAgIGlm\nIChhdmFpbCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSAmJiBtYXggPT0gSW50ZWdl\nci5NSU5fVkFMVUUpIHsKICAgICAgICAgICAgaW50IGRlZiA9IEZldGNoR3Jv\ndXAuUkVDVVJTSU9OX0RFUFRIX0RFRkFVTFQ7CiAgICAgICAgICAgIHJldHVy\nbiAodHJhdmVyc2UgJiYgaXNBc3NpZ25hYmxlKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLCB0eXBlKSkKICAgICAgICAgICAgICAgID8gZGVmIC0gMSA6IGRl\nZjsKICAgICAgICB9CiAgICAgICAgaWYgKGF2YWlsID09IEludGVnZXIuTUlO\nX1ZBTFVFIHx8IGF2YWlsID09IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUp\nCiAgICAgICAgICAgIHJldHVybiBtYXg7CiAgICAgICAgaWYgKG1heCA9PSBJ\nbnRlZ2VyLk1JTl9WQUxVRSB8fCBtYXggPT0gRmV0Y2hHcm91cC5ERVBUSF9J\nTkZJTklURSkKICAgICAgICAgICAgcmV0dXJuIGF2YWlsOwogICAgICAgIHJl\ndHVybiBNYXRoLm1pbihtYXgsIGF2YWlsKTsKICAgIH0KIAogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHJlbGF0aW9uIHR5cGUgb2YgdGhlIGdpdmVuIGZp\nZWxkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzcyBnZXRSZWxh\ndGlvblR5cGUoRmllbGRNZXRhRGF0YSBmbSkgewogICAgICAgIGlmIChmbS5p\nc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBmbS5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0RWxlbWVudCgpLmlz\nRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgcmV0dXJuIGZtLmdldEVs\nZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0\nS2V5KCkuaXNEZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICByZXR1cm4g\nZm0uZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGVpdGhlciBv\nZiB0aGUgdHdvIHR5cGVzIGlzIGFzc2lnbmFibGUgZnJvbSB0aGUgb3RoZXIu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNBc3NpZ25h\nYmxlKENsYXNzIGMxLCBDbGFzcyBjMikgewogICAgICAgIHJldHVybiBjMSAh\nPSBudWxsICYmIGMyICE9IG51bGwgCiAgICAgICAgICAgICYmIChjMS5pc0Fz\nc2lnbmFibGVGcm9tKGMyKSB8fCBjMi5pc0Fzc2lnbmFibGVGcm9tKGMxKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWR1Y2UgdGhlIGdpdmVuIGxvZ2lj\nYWwgZGVwdGggYnkgMS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50\nIHJlZHVjZShpbnQgZCkgewogICAgICAgIGlmIChkID09IDApCiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIGlmIChkICE9IEZldGNoR3JvdXAuREVQ\nVEhfSU5GSU5JVEUpCiAgICAgICAgICAgIGQtLTsKICAgICAgICByZXR1cm4g\nZDsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGVidWcg\nbWV0aG9kcwogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBGZXRjaENvbmZp\nZ3VyYXRpb24gZ2V0UGFyZW50KCkgewogICAgICAgIHJldHVybiBfcGFyZW50\nOwogICAgfQogICAgCiAgICBib29sZWFuIGlzUm9vdCgpIHsKICAgICAgICBy\nZXR1cm4gX3BhcmVudCA9PSBudWxsOwogICAgfQogICAgCiAgICBGZXRjaENv\nbmZpZ3VyYXRpb24gZ2V0Um9vdCgpIHsKICAgICAgICByZXR1cm4gKGlzUm9v\ndCgpKSA/IHRoaXMgOiBfcGFyZW50LmdldFJvb3QoKTsKICAgIH0KCiAgICBp\nbnQgZ2V0QXZhaWxhYmxlRmV0Y2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4g\nX2F2YWlsYWJsZURlcHRoOwogICAgfQoKICAgIGludCBnZXRBdmFpbGFibGVS\nZWN1cnNpb25EZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2YWlsYWJsZVJl\nY3Vyc2lvbjsKICAgIH0KCiAgICBTdHJpbmcgZ2V0VHJhdmVyc2VkRnJvbUZp\nZWxkKCkgewogICAgICAgIHJldHVybiBfZnJvbUZpZWxkOwogICAgfQoKICAg\nIENsYXNzIGdldFRyYXZlcnNlZEZyb21UeXBlKCkgewogICAgICAgIHJldHVy\nbiBfZnJvbVR5cGU7CiAgICB9CgogICAgTGlzdCBnZXRQYXRoKCkgewogICAg\nICAgIGlmIChpc1Jvb3QoKSkKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIHRyYWNrUGF0aChuZXcg\nQXJyYXlMaXN0KCkpOwogICAgfQogICAgCiAgICBMaXN0IHRyYWNrUGF0aChM\naXN0IHBhdGgpIHsKICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxsKQogICAg\nICAgICAgICBfcGFyZW50LnRyYWNrUGF0aChwYXRoKTsKICAgICAgICBwYXRo\nLmFkZCh0aGlzKTsKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KICAgICAg\nIAogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1\ncm4gIkZldGNoQ29uZmlndXJhdGlvbkAiICsgU3lzdGVtLmlkZW50aXR5SGFz\naENvZGUodGhpcykgCiAgICAgICAgICAgICsgIiAoIiArIF9hdmFpbGFibGVE\nZXB0aCArICIpIiArIGdldFBhdGhTdHJpbmcoKTsKICAgIH0KICAgIAogICAg\ncHJpdmF0ZSBTdHJpbmcgZ2V0UGF0aFN0cmluZygpCiAgICB7CiAgICAgICAg\nTGlzdCBwYXRoID0gZ2V0UGF0aCgpOwogICAgICAgIGlmIChwYXRoLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIFN0cmluZ0J1\nZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCkuYXBwZW5kICgiOiAiKTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhdGguaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgoKEZl\ndGNoQ29uZmlndXJhdGlvbkltcGwpIGl0ci5uZXh0KCkpLgogICAgICAgICAg\nICAgICAgZ2V0VHJhdmVyc2VkRnJvbUZpZWxkKCkpOwogICAgICAgICAgICBp\nZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIi0+Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KfQo=\n","encoding":"base64"}

