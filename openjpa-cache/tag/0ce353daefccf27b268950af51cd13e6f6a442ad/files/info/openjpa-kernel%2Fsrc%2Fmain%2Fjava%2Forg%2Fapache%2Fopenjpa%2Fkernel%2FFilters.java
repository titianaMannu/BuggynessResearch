{"sha":"6136dfe32683d80153becf9645691fb6c990f429","node_id":"MDQ6QmxvYjIwNjM2NDo2MTM2ZGZlMzI2ODNkODAxNTNiZWNmOTY0NTY5MWZiNmM5OTBmNDI5","size":30541,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6136dfe32683d80153becf9645691fb6c990f429","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuZXhwcy5BZ2dyZWdhdGVMaXN0ZW5lcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsK\naW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51dGlsLlN0\ncmluZ3M7CgovKioKICogSGVscGVyIG1ldGhvZHMgZm9yIGRlYWxpbmcgd2l0\naCBxdWVyeSBmaWx0ZXJzLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBA\nbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgRmlsdGVycyB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgQmlnRGVjaW1hbCBaRVJPX0JJR0RFQ0lNQUwg\nPSBuZXcgQmlnRGVjaW1hbCgwRCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBCaWdJbnRlZ2VyIFpFUk9fQklHSU5URUdFUiA9IG5ldyBCaWdJbnRlZ2Vy\nKCIwIik7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE9QX0FERCA9\nIDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1BfU1VCVFJBQ1Qg\nPSAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE9QX01VTFRJUExZ\nID0gMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPUF9ESVZJREUg\nPSAzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE9QX01PRCA9IDQ7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZShGaWx0ZXJzLmNsYXNzKTsKCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgY29ycmVjdCB3cmFwcGVyIHR5cGUgZm9yIHRo\nZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBDbGFz\ncyB3cmFwKENsYXNzIGMpIHsKICAgICAgICBpZiAoIWMuaXNQcmltaXRpdmUo\nKSkKICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgaWYgKGMgPT0gaW50\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsKICAg\nICAgICBpZiAoYyA9PSBmbG9hdC5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nIEZsb2F0LmNsYXNzOwogICAgICAgIGlmIChjID09IGRvdWJsZS5jbGFzcykK\nICAgICAgICAgICAgcmV0dXJuIERvdWJsZS5jbGFzczsKICAgICAgICBpZiAo\nYyA9PSBsb25nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gTG9uZy5jbGFz\nczsKICAgICAgICBpZiAoYyA9PSBib29sZWFuLmNsYXNzKQogICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5jbGFzczsKICAgICAgICBpZiAoYyA9PSBzaG9y\ndC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIFNob3J0LmNsYXNzOwogICAg\nICAgIGlmIChjID09IGJ5dGUuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBC\neXRlLmNsYXNzOwogICAgICAgIGlmIChjID09IGNoYXIuY2xhc3MpCiAgICAg\nICAgICAgIHJldHVybiBDaGFyYWN0ZXIuY2xhc3M7CiAgICAgICAgcmV0dXJu\nIGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvcnJlY3Qg\ncHJpbWl0aXZlIHR5cGUgZm9yIHRoZSBnaXZlbiBjbGFzcywgaWYgaXQgaXMg\nYQogICAgICogd3JhcHBlci4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBD\nbGFzcyB1bndyYXAoQ2xhc3MgYykgewogICAgICAgIGlmIChjLmlzUHJpbWl0\naXZlKCkgfHwgYyA9PSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgIHJldHVy\nbiBjOwogICAgICAgIGlmIChjID09IEludGVnZXIuY2xhc3MpCiAgICAgICAg\nICAgIHJldHVybiBpbnQuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gRmxvYXQu\nY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmbG9hdC5jbGFzczsKICAgICAg\nICBpZiAoYyA9PSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBk\nb3VibGUuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0gTG9uZy5jbGFzcykKICAg\nICAgICAgICAgcmV0dXJuIGxvbmcuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0g\nQm9vbGVhbi5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGJvb2xlYW4uY2xh\nc3M7CiAgICAgICAgaWYgKGMgPT0gU2hvcnQuY2xhc3MpCiAgICAgICAgICAg\nIHJldHVybiBzaG9ydC5jbGFzczsKICAgICAgICBpZiAoYyA9PSBCeXRlLmNs\nYXNzKQogICAgICAgICAgICByZXR1cm4gYnl0ZS5jbGFzczsKICAgICAgICBp\nZiAoYyA9PSBDaGFyYWN0ZXIuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBj\naGFyLmNsYXNzOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgog\nICAgICogR2l2ZW4gdHdvIHR5cGVzLCByZXR1cm4gdHlwZSB0aGV5IHNob3Vs\nZCBib3RoIGJlIGNvbnZlcnRlZAogICAgICogdG8gYmVmb3JlIHBlcmZvcm1p\nbmcgYW55IG9wZXJhdGlvbnMgYmV0d2VlbiB0aGVtLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIENsYXNzIHByb21vdGUoQ2xhc3MgYzEsIENsYXNzIGMy\nKSB7CiAgICAgICAgaWYgKGMxID09IGMyKQogICAgICAgICAgICByZXR1cm4g\ndW53cmFwKGMxKTsKICAgICAgICBDbGFzcyB3MSA9IHdyYXAoYzEpOwogICAg\nICAgIENsYXNzIHcyID0gd3JhcChjMik7CiAgICAgICAgaWYgKHcxID09IHcy\nKQogICAgICAgICAgICByZXR1cm4gdW53cmFwKGMxKTsKCiAgICAgICAgLy8g\nbm90IG51bWJlcnM/CiAgICAgICAgYm9vbGVhbiB3MU51bWJlciA9IE51bWJl\nci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHcxKTsKICAgICAgICBib29sZWFu\nIHcyTnVtYmVyID0gTnVtYmVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odzIp\nOwogICAgICAgIGlmICghdzFOdW1iZXIgfHwgIXcyTnVtYmVyKSB7CiAgICAg\nICAgICAgIC8vIHRoZSBvbmx5IG5vbi1udW1lcmljIHByb21vdGlvbiB3ZSBk\nbyBpcyBzdHJpbmcgdG8gY2hhciwKICAgICAgICAgICAgLy8gb3IgZnJvbSBj\naGFyL3N0cmluZyB0byBudW1iZXIKICAgICAgICAgICAgaWYgKCF3MU51bWJl\ncikgewogICAgICAgICAgICAgICAgaWYgKHcyTnVtYmVyICYmICh3MSA9PSBD\naGFyYWN0ZXIuY2xhc3MgfHwgdzEgPT0gU3RyaW5nLmNsYXNzKSkKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gKHcyID09IEJ5dGUuY2xhc3MgfHwgdzIg\nPT0gU2hvcnQuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgID8gSW50\nZWdlci5jbGFzcyA6IHVud3JhcChjMik7CiAgICAgICAgICAgICAgICBpZiAo\nIXcyTnVtYmVyICYmIHcxID09IENoYXJhY3Rlci5jbGFzcyAmJiB3MiA9PSBT\ndHJpbmcuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmlu\nZy5jbGFzczsKICAgICAgICAgICAgICAgIGlmICh3Mk51bWJlcikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMyKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoIXcyTnVtYmVyKSB7CiAgICAgICAgICAgICAg\nICBpZiAodzFOdW1iZXIgJiYgKHcyID09IENoYXJhY3Rlci5jbGFzcyB8fCB3\nMiA9PSBTdHJpbmcuY2xhc3MpKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiAodzEgPT0gQnl0ZS5jbGFzcyB8fCB3MSA9PSBTaG9ydC5jbGFzcykKICAg\nICAgICAgICAgICAgICAgICAgICAgPyBJbnRlZ2VyLmNsYXNzIDogdW53cmFw\nKGMxKTsKICAgICAgICAgICAgICAgIGlmICghdzFOdW1iZXIgJiYgdzIgPT0g\nQ2hhcmFjdGVyLmNsYXNzICYmIHcxID09IFN0cmluZy5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmNsYXNzOwogICAgICAgICAg\nICAgICAgaWYgKHcxTnVtYmVyKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB1bndyYXAoYzEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBp\nZiBuZWl0aGVyIGFyZSBudW1iZXJzLCB1c2UgbGVhc3QtZGVyaXZlZCBvZiB0\naGUgdHdvLiAgaWYgbmVpdGhlcgogICAgICAgICAgICAvLyBpcyBhc3NpZ25h\nYmxlIGZyb20gdGhlIG90aGVyIGJ1dCBvbmUgaXMgYSBzdGFuZGFyZCB0eXBl\nLCBhc3N1bWUKICAgICAgICAgICAgLy8gdGhlIG90aGVyIGNhbiBiZSBjb252\nZXJ0ZWQgdG8gdGhhdCBzdGFuZGFyZCB0eXBlCiAgICAgICAgICAgIGlmICgh\ndzFOdW1iZXIgJiYgIXcyTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBpZiAo\ndzEgPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB1bndyYXAoYzIpOwogICAgICAgICAgICAgICAgaWYgKHcyID09IE9iamVj\ndC5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMx\nKTsKICAgICAgICAgICAgICAgIGlmICh3MS5pc0Fzc2lnbmFibGVGcm9tKHcy\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMxKTsKICAg\nICAgICAgICAgICAgIGlmICh3Mi5pc0Fzc2lnbmFibGVGcm9tKHcxKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gdW53cmFwKGMyKTsKICAgICAgICAg\nICAgICAgIGlmIChpc05vbnN0YW5kYXJkVHlwZSh3MSkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIChpc05vbnN0YW5kYXJkVHlwZSh3MikpID8gT2Jq\nZWN0LmNsYXNzIDogdW53cmFwKGMyKTsKICAgICAgICAgICAgICAgIGlmIChp\nc05vbnN0YW5kYXJkVHlwZSh3MikpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIChpc05vbnN0YW5kYXJkVHlwZSh3MSkpID8gT2JqZWN0LmNsYXNzIDog\ndW53cmFwKGMxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nT2JqZWN0LmNsYXNzOwogICAgICAgIH0KCiAgICAgICAgaWYgKHcxID09IEJp\nZ0RlY2ltYWwuY2xhc3MgfHwgdzIgPT0gQmlnRGVjaW1hbC5jbGFzcykKICAg\nICAgICAgICAgcmV0dXJuIEJpZ0RlY2ltYWwuY2xhc3M7CiAgICAgICAgaWYg\nKHcxID09IEJpZ0ludGVnZXIuY2xhc3MpIHsKICAgICAgICAgICAgaWYgKHcy\nID09IEZsb2F0LmNsYXNzIHx8IHcyID09IERvdWJsZS5jbGFzcykKICAgICAg\nICAgICAgICAgIHJldHVybiBCaWdEZWNpbWFsLmNsYXNzOwogICAgICAgICAg\nICByZXR1cm4gQmlnSW50ZWdlci5jbGFzczsKICAgICAgICB9CiAgICAgICAg\naWYgKHcyID09IEJpZ0ludGVnZXIuY2xhc3MpIHsKICAgICAgICAgICAgaWYg\nKHcxID09IEZsb2F0LmNsYXNzIHx8IHcxID09IERvdWJsZS5jbGFzcykKICAg\nICAgICAgICAgICAgIHJldHVybiBCaWdEZWNpbWFsLmNsYXNzOwogICAgICAg\nICAgICByZXR1cm4gQmlnSW50ZWdlci5jbGFzczsKICAgICAgICB9CiAgICAg\nICAgaWYgKHcxID09IERvdWJsZS5jbGFzcyB8fCB3MiA9PSBEb3VibGUuY2xh\nc3MpCiAgICAgICAgICAgIHJldHVybiBkb3VibGUuY2xhc3M7CiAgICAgICAg\naWYgKHcxID09IEZsb2F0LmNsYXNzIHx8IHcyID09IEZsb2F0LmNsYXNzKQog\nICAgICAgICAgICByZXR1cm4gZmxvYXQuY2xhc3M7CiAgICAgICAgaWYgKHcx\nID09IExvbmcuY2xhc3MgfHwgdzIgPT0gTG9uZy5jbGFzcykKICAgICAgICAg\nICAgcmV0dXJuIGxvbmcuY2xhc3M7CiAgICAgICAgcmV0dXJuIGludC5jbGFz\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBn\naXZlbiB0eXBlIGlzIG5vdCBhIHN0YW5kYXJkIHBlcnNpc3RlbnQgdHlwZS4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc05vbnN0YW5k\nYXJkVHlwZShDbGFzcyBjKSB7CiAgICAgICAgc3dpdGNoIChKYXZhVHlwZXMu\nZ2V0VHlwZUNvZGUoYykpCiAgICAgICAgewogICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkFSUkFZOgogICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgIGNhc2UgSmF2\nYVR5cGVzLlBDOgogICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6\nCiAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIGFuIGlu\nc3RhbmNlIG9mIHRoZSBmaXJzdCBjbGFzcyBjYW4gYmUgY29udmVydGVkIHRv\nCiAgICAgKiBhbiBpbnN0YW5jZSBvZiB0aGUgc2Vjb25kLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gY2FuQ29udmVydChDbGFzcyBjMSwg\nQ2xhc3MgYzIsIGJvb2xlYW4gc3RyaWN0KSB7CiAgICAgICAgYzEgPSB3cmFw\nKGMxKTsKICAgICAgICBjMiA9IHdyYXAoYzIpOwogICAgICAgIGlmIChjMi5p\nc0Fzc2lnbmFibGVGcm9tKGMxKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCgogICAgICAgIGJvb2xlYW4gYzFOdW1iZXIgPSBOdW1iZXIuY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbShjMSk7CiAgICAgICAgYm9vbGVhbiBjMk51bWJlciA9\nIE51bWJlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGMyKTsKICAgICAgICBp\nZiAoYzFOdW1iZXIgJiYgYzJOdW1iZXIpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIGlmICgoYzFOdW1iZXIgJiYgKGMyID09IENoYXJhY3Rl\nci5jbGFzcwogICAgICAgICAgICB8fCAoIXN0cmljdCAmJiBjMiA9PSBTdHJp\nbmcuY2xhc3MpKSkKICAgICAgICAgICAgfHwgKGMyTnVtYmVyICYmIChjMSA9\nPSBDaGFyYWN0ZXIuY2xhc3MKICAgICAgICAgICAgfHwgKCFzdHJpY3QgJiYg\nYzEgPT0gU3RyaW5nLmNsYXNzKSkpKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICBpZiAoYzEgPT0gU3RyaW5nLmNsYXNzICYmIGMyID09IENo\nYXJhY3Rlci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKGMyID09IFN0cmluZy5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nICFzdHJpY3Q7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhlIGdpdmVu\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGNvbnZl\ncnQoT2JqZWN0IG8sIENsYXNzIHR5cGUpIHsKICAgICAgICBpZiAobyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoby5n\nZXRDbGFzcygpID09IHR5cGUpCiAgICAgICAgICAgIHJldHVybiBvOwoKICAg\nICAgICB0eXBlID0gd3JhcCh0eXBlKTsKICAgICAgICBpZiAodHlwZS5pc0Fz\nc2lnbmFibGVGcm9tKG8uZ2V0Q2xhc3MoKSkpCiAgICAgICAgICAgIHJldHVy\nbiBvOwoKICAgICAgICAvLyB0aGUgb25seSBub24tbnVtZXJpYyBjb252ZXJz\naW9ucyB3ZSBkbyBhcmUgdG8gc3RyaW5nLCBvciBmcm9tCiAgICAgICAgLy8g\nc3RyaW5nL2NoYXIgdG8gbnVtYmVyLCBvciBjYWxlbmRhci9kYXRlCiAgICAg\nICAgYm9vbGVhbiBudW0gPSBvIGluc3RhbmNlb2YgTnVtYmVyOwogICAgICAg\nIGlmICghbnVtKSB7CiAgICAgICAgICAgIGlmICh0eXBlID09IFN0cmluZy5j\nbGFzcykKICAgICAgICAgICAgICAgIHJldHVybiBvLnRvU3RyaW5nKCk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT0gQ2hhcmFjdGVyLmNsYXNzKSB7\nCiAgICAgICAgICAgICAgICBTdHJpbmcgc3RyID0gby50b1N0cmluZygpOwog\nICAgICAgICAgICAgICAgaWYgKHN0ciAhPSBudWxsICYmIHN0ci5sZW5ndGgo\nKSA9PSAxKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFj\ndGVyKHN0ci5jaGFyQXQoMCkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKENh\nbGVuZGFyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkgJiYKICAgICAg\nICAgICAgICAgIG8gaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgICAg\nICBDYWxlbmRhciBjYWwgPSBDYWxlbmRhci5nZXRJbnN0YW5jZSgpOwogICAg\nICAgICAgICAgICAgY2FsLnNldFRpbWUoKERhdGUpIG8pOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGNhbDsKICAgICAgICAgICAgfSBlbHNlIGlmIChEYXRl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkgJiYKICAgICAgICAgICAg\nICAgIG8gaW5zdGFuY2VvZiBDYWxlbmRhcikgewogICAgICAgICAgICAgICAg\ncmV0dXJuICgoQ2FsZW5kYXIpIG8pLmdldFRpbWUoKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChOdW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBl\nKSkgewogICAgICAgICAgICAgICAgSW50ZWdlciBpID0gbnVsbDsKICAgICAg\nICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgQ2hhcmFjdGVyKQogICAgICAg\nICAgICAgICAgICAgIGkgPSBOdW1iZXJzLnZhbHVlT2YoKChDaGFyYWN0ZXIp\nIG8pLmNoYXJWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKG8g\naW5zdGFuY2VvZiBTdHJpbmcgJiYgKChTdHJpbmcpIG8pLmxlbmd0aCgpID09\nIDEpCiAgICAgICAgICAgICAgICAgICAgaSA9IE51bWJlcnMudmFsdWVPZigo\nKFN0cmluZykgbykuY2hhckF0KDApKTsKCiAgICAgICAgICAgICAgICBpZiAo\naSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0g\nSW50ZWdlci5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGk7CiAgICAgICAgICAgICAgICAgICAgbnVtID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAo\nIW51bSkKICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlv\nbihfbG9jLmdldCgiY2FudC1jb252ZXJ0IiwgbywKICAgICAgICAgICAgICAg\nIG8uZ2V0Q2xhc3MoKSwgdHlwZSkuZ2V0TWVzc2FnZSgpKTsKCiAgICAgICAg\naWYgKHR5cGUgPT0gSW50ZWdlci5jbGFzcykgewogICAgICAgICAgICByZXR1\ncm4gTnVtYmVycy52YWx1ZU9mKCgoTnVtYmVyKSBvKS5pbnRWYWx1ZSgpKTsK\nICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gRmxvYXQuY2xhc3MpIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdCgoKE51bWJlcikgbykuZmxvYXRW\nYWx1ZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gRG91YmxlLmNs\nYXNzKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKCgoTnVtYmVy\nKSBvKS5kb3VibGVWYWx1ZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUg\nPT0gTG9uZy5jbGFzcykgewogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52\nYWx1ZU9mKCgoTnVtYmVyKSBvKS5sb25nVmFsdWUoKSk7CiAgICAgICAgfSBl\nbHNlIGlmICh0eXBlID09IEJpZ0RlY2ltYWwuY2xhc3MpIHsKICAgICAgICAg\nICAgLy8gdGhlIEJpZ0RlY2ltYWwgY29uc3RydWN0b3IgZG9lc24ndCBoYW5k\nbGUgdGhlCiAgICAgICAgICAgIC8vICJOYU4iIHN0cmluZyB2ZXJzaW9uIG9m\nIERvdWJsZS5OYU4gYW5kIEZsb2F0Lk5hTiwgbm9yCiAgICAgICAgICAgIC8v\nIGRvZXMgaXQgaGFuZGxlIGluZmluaXR5OyB3ZSBuZWVkIHRvIGluc3RlYWQg\ndXNlIHRoZSBEb3VibGUKICAgICAgICAgICAgLy8gYW5kIEZsb2F0IHZlcnNp\nb25zLCBkZXNwaXRlIHdhbnRpbmcgdG8gY2FzdCBpdCB0byBCaWdEZWNpbWFs\nCiAgICAgICAgICAgIGRvdWJsZSBkdmFsID0gKChOdW1iZXIpIG8pLmRvdWJs\nZVZhbHVlKCk7CiAgICAgICAgICAgIGlmIChEb3VibGUuaXNOYU4oZHZhbCkg\nfHwgRG91YmxlLmlzSW5maW5pdGUoZHZhbCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IERvdWJsZShkdmFsKTsKCiAgICAgICAgICAgIGZsb2F0IGZ2\nYWwgPSAoKE51bWJlcikgbykuZmxvYXRWYWx1ZSgpOwogICAgICAgICAgICBp\nZiAoRmxvYXQuaXNOYU4oZnZhbCkgfHwgRmxvYXQuaXNJbmZpbml0ZShmdmFs\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQoZnZhbCk7Cgog\nICAgICAgICAgICByZXR1cm4gbmV3IEJpZ0RlY2ltYWwoby50b1N0cmluZygp\nKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gQmlnSW50ZWdlci5jbGFz\ncykgewogICAgICAgICAgICByZXR1cm4gbmV3IEJpZ0ludGVnZXIoby50b1N0\ncmluZygpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gU2hvcnQuY2xh\nc3MpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydCgoKE51bWJlcikg\nbykuc2hvcnRWYWx1ZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0g\nQnl0ZS5jbGFzcykgewogICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoKChO\ndW1iZXIpIG8pLmJ5dGVWYWx1ZSgpKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKCgoTnVtYmVyKSBvKS5p\nbnRWYWx1ZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgdGhlIGdpdmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBPYmplY3QgYWRkKE9iamVjdCBvMSwgQ2xhc3MgYzEsIE9iamVjdCBvMiwg\nQ2xhc3MgYzIpIHsKICAgICAgICByZXR1cm4gb3AobzEsIGMxLCBvMiwgYzIs\nIE9QX0FERCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdWJ0cmFjdCB0aGUg\nZ2l2ZW4gdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVj\ndCBzdWJ0cmFjdChPYmplY3QgbzEsIENsYXNzIGMxLCBPYmplY3QgbzIsIENs\nYXNzIGMyKSB7CiAgICAgICAgcmV0dXJuIG9wKG8xLCBjMSwgbzIsIGMyLCBP\nUF9TVUJUUkFDVCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0\naGUgZ2l2ZW4gdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9i\namVjdCBtdWx0aXBseShPYmplY3QgbzEsIENsYXNzIGMxLCBPYmplY3QgbzIs\nIENsYXNzIGMyKSB7CiAgICAgICAgcmV0dXJuIG9wKG8xLCBjMSwgbzIsIGMy\nLCBPUF9NVUxUSVBMWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXZpZGUg\ndGhlIGdpdmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBP\nYmplY3QgZGl2aWRlKE9iamVjdCBvMSwgQ2xhc3MgYzEsIE9iamVjdCBvMiwg\nQ2xhc3MgYzIpIHsKICAgICAgICByZXR1cm4gb3AobzEsIGMxLCBvMiwgYzIs\nIE9QX0RJVklERSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNb2QgdGhlIGdp\ndmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3Qg\nbW9kKE9iamVjdCBvMSwgQ2xhc3MgYzEsIE9iamVjdCBvMiwgQ2xhc3MgYzIp\nIHsKICAgICAgICByZXR1cm4gb3AobzEsIGMxLCBvMiwgYzIsIE9QX01PRCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHRoZSBnaXZlbiBvcGVy\nYXRpb24gb24gdHdvIG51bWJlcnMuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIE9iamVjdCBvcChPYmplY3QgbzEsIENsYXNzIGMxLCBPYmplY3QgbzIs\nIENsYXNzIGMyLCBpbnQgb3ApIHsKICAgICAgICBDbGFzcyBwcm9tb3RlID0g\ncHJvbW90ZShjMSwgYzIpOwogICAgICAgIGlmIChwcm9tb3RlID09IGludC5j\nbGFzcykgewogICAgICAgICAgICBpbnQgbjEgPSAobzEgPT0gbnVsbCkgPyAw\nIDogKChOdW1iZXIpIG8xKS5pbnRWYWx1ZSgpOwogICAgICAgICAgICBpbnQg\nbjIgPSAobzIgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIG8yKS5pbnRWYWx1\nZSgpOwogICAgICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAg\nICAgfQogICAgICAgIGlmIChwcm9tb3RlID09IGZsb2F0LmNsYXNzKSB7CiAg\nICAgICAgICAgIGZsb2F0IG4xID0gKG8xID09IG51bGwpID8gMEYgOiAoKE51\nbWJlcikgbzEpLmZsb2F0VmFsdWUoKTsKICAgICAgICAgICAgZmxvYXQgbjIg\nPSAobzIgPT0gbnVsbCkgPyAwRiA6ICgoTnVtYmVyKSBvMikuZmxvYXRWYWx1\nZSgpOwogICAgICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAg\nICAgfQogICAgICAgIGlmIChwcm9tb3RlID09IGRvdWJsZS5jbGFzcykgewog\nICAgICAgICAgICBkb3VibGUgbjEgPSAobzEgPT0gbnVsbCkgPyAwRCA6ICgo\nTnVtYmVyKSBvMSkuZG91YmxlVmFsdWUoKTsKICAgICAgICAgICAgZG91Ymxl\nIG4yID0gKG8yID09IG51bGwpID8gMEQgOiAoKE51bWJlcikgbzIpLmRvdWJs\nZVZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBvcChuMSwgbjIsIG9wKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKHByb21vdGUgPT0gbG9uZy5jbGFzcykg\newogICAgICAgICAgICBsb25nIG4xID0gKG8xID09IG51bGwpID8gMEwgOiAo\nKE51bWJlcikgbzEpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICBsb25nIG4y\nID0gKG8yID09IG51bGwpID8gMEwgOiAoKE51bWJlcikgbzIpLmxvbmdWYWx1\nZSgpOwogICAgICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAg\nICAgfQogICAgICAgIGlmIChwcm9tb3RlID09IEJpZ0RlY2ltYWwuY2xhc3Mp\nIHsKICAgICAgICAgICAgQmlnRGVjaW1hbCBuMSA9IChvMSA9PSBudWxsKSA/\nIFpFUk9fQklHREVDSU1BTAogICAgICAgICAgICAgICAgOiAoQmlnRGVjaW1h\nbCkgY29udmVydChvMSwgcHJvbW90ZSk7CiAgICAgICAgICAgIEJpZ0RlY2lt\nYWwgbjIgPSAobzIgPT0gbnVsbCkgPyBaRVJPX0JJR0RFQ0lNQUwKICAgICAg\nICAgICAgICAgIDogKEJpZ0RlY2ltYWwpIGNvbnZlcnQobzIsIHByb21vdGUp\nOwogICAgICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChwcm9tb3RlID09IEJpZ0ludGVnZXIuY2xhc3MpIHsK\nICAgICAgICAgICAgQmlnSW50ZWdlciBuMSA9IChvMSA9PSBudWxsKSA/IFpF\nUk9fQklHSU5URUdFUgogICAgICAgICAgICAgICAgOiAoQmlnSW50ZWdlcikg\nY29udmVydChvMSwgcHJvbW90ZSk7CiAgICAgICAgICAgIEJpZ0ludGVnZXIg\nbjIgPSAobzIgPT0gbnVsbCkgPyBaRVJPX0JJR0lOVEVHRVIKICAgICAgICAg\nICAgICAgIDogKEJpZ0ludGVnZXIpIGNvbnZlcnQobzIsIHByb21vdGUpOwog\nICAgICAgICAgICByZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAgICAgfQog\nICAgICAgIC8vIGRlZmF1bHQgdG8gaW50CiAgICAgICAgaW50IG4xID0gKG8x\nID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSBvMSkuaW50VmFsdWUoKTsKICAg\nICAgICBpbnQgbjIgPSAobzIgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIG8y\nKS5pbnRWYWx1ZSgpOwogICAgICAgIHJldHVybiBvcChuMSwgbjIsIG9wKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEg\nbWF0aGVtYXRpY2FsIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0IG9wKGludCBuMSwgaW50IG4yLCBpbnQgb3ApIHsKICAg\nICAgICBpbnQgdG90OwogICAgICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAg\nICAgY2FzZSBPUF9BREQ6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSArIG4y\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1Bf\nU1VCVFJBQ1Q6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAtIG4yOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQ\nTFk6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAqIG4yOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfRElWSURFOgogICAg\nICAgICAgICAgICAgdG90ID0gbjEgLyBuMjsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIE9QX01PRDoKICAgICAgICAgICAgICAg\nIHRvdCA9IG4xICUgbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTnVt\nYmVycy52YWx1ZU9mKHRvdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJlc3VsdCBvZiBhIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBvcChmbG9hdCBuMSwg\nZmxvYXQgbjIsIGludCBvcCkgewogICAgICAgIGZsb2F0IHRvdDsKICAgICAg\nICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgIGNhc2UgT1BfQUREOgogICAg\nICAgICAgICAgICAgdG90ID0gbjEgKyBuMjsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIE9QX1NVQlRSQUNUOgogICAgICAgICAg\nICAgICAgdG90ID0gbjEgLSBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIE9QX01VTFRJUExZOgogICAgICAgICAgICAgICAg\ndG90ID0gbjEgKiBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIE9QX0RJVklERToKICAgICAgICAgICAgICAgIHRvdCA9IG4x\nIC8gbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBPUF9NT0Q6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAlIG4yOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBGbG9hdCh0b3QpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZXN1bHQgb2YgYSBtYXRoZW1h\ndGljYWwgb3BlcmF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBP\nYmplY3Qgb3AoZG91YmxlIG4xLCBkb3VibGUgbjIsIGludCBvcCkgewogICAg\nICAgIGRvdWJsZSB0b3Q7CiAgICAgICAgc3dpdGNoIChvcCkgewogICAgICAg\nICAgICBjYXNlIE9QX0FERDoKICAgICAgICAgICAgICAgIHRvdCA9IG4xICsg\nbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBP\nUF9TVUJUUkFDVDoKICAgICAgICAgICAgICAgIHRvdCA9IG4xIC0gbjI7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9NVUxU\nSVBMWToKICAgICAgICAgICAgICAgIHRvdCA9IG4xICogbjI7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9ESVZJREU6CiAg\nICAgICAgICAgICAgICB0b3QgPSBuMSAvIG4yOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfTU9EOgogICAgICAgICAgICAg\nICAgdG90ID0gbjEgJSBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\nZXcgRG91YmxlKHRvdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHJlc3VsdCBvZiBhIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBvcChsb25nIG4xLCBsb25n\nIG4yLCBpbnQgb3ApIHsKICAgICAgICBsb25nIHRvdDsKICAgICAgICBzd2l0\nY2ggKG9wKSB7CiAgICAgICAgICAgIGNhc2UgT1BfQUREOgogICAgICAgICAg\nICAgICAgdG90ID0gbjEgKyBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIE9QX1NVQlRSQUNUOgogICAgICAgICAgICAgICAg\ndG90ID0gbjEgLSBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIE9QX01VTFRJUExZOgogICAgICAgICAgICAgICAgdG90ID0g\nbjEgKiBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIE9QX0RJVklERToKICAgICAgICAgICAgICAgIHRvdCA9IG4xIC8gbjI7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9N\nT0Q6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAlIG4yOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZih0b3QpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSByZXN1bHQgb2YgYSBtYXRoZW1h\ndGljYWwgb3BlcmF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBP\nYmplY3Qgb3AoQmlnRGVjaW1hbCBuMSwgQmlnRGVjaW1hbCBuMiwgaW50IG9w\nKSB7CiAgICAgICAgc3dpdGNoIChvcCkgewogICAgICAgICAgICBjYXNlIE9Q\nX0FERDoKICAgICAgICAgICAgICAgIHJldHVybiBuMS5hZGQobjIpOwogICAg\nICAgICAgICBjYXNlIE9QX1NVQlRSQUNUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIG4xLnN1YnRyYWN0KG4yKTsKICAgICAgICAgICAgY2FzZSBPUF9NVUxU\nSVBMWToKICAgICAgICAgICAgICAgIHJldHVybiBuMS5tdWx0aXBseShuMik7\nCiAgICAgICAgICAgIGNhc2UgT1BfRElWSURFOgogICAgICAgICAgICAgICAg\naW50IHNjYWxlID0gTWF0aC5tYXgobjEuc2NhbGUoKSwgbjIuc2NhbGUoKSk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gbjEuZGl2aWRlKG4yLCBzY2FsZSwg\nQmlnRGVjaW1hbC5ST1VORF9IQUxGX1VQKTsKICAgICAgICAgICAgY2FzZSBP\nUF9NT0Q6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibW9kLWJpZ2RlY2ltYWwiKSk7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJlc3VsdCBvZiBhIG1hdGhlbWF0aWNhbCBvcGVyYXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBvcChCaWdJbnRlZ2Vy\nIG4xLCBCaWdJbnRlZ2VyIG4yLCBpbnQgb3ApIHsKICAgICAgICBzd2l0Y2gg\nKG9wKSB7CiAgICAgICAgICAgIGNhc2UgT1BfQUREOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG4xLmFkZChuMik7CiAgICAgICAgICAgIGNhc2UgT1BfU1VC\nVFJBQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gbjEuc3VidHJhY3QobjIp\nOwogICAgICAgICAgICBjYXNlIE9QX01VTFRJUExZOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG4xLm11bHRpcGx5KG4yKTsKICAgICAgICAgICAgY2FzZSBP\nUF9ESVZJREU6CiAgICAgICAgICAgICAgICByZXR1cm4gbjEuZGl2aWRlKG4y\nKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlcyB0aGUgZ2l2ZW4gZGVjbGFyYXRpb25zIGlu\ndG8gYSBsaXN0IG9mIHR5cGUsIG5hbWUsIHR5cGUsIG5hbWUuLi4KICAgICAq\nIFJldHVybnMgbnVsbCBpZiBubyBkZWNsYXJhdGlvbnMuIEFzc3VtZXMgZGVj\nbGFyYXRpb24gaXMgbm90IGFuIGVtcHR5CiAgICAgKiBzdHJpbmcgYW5kIGlz\nIGFscmVhZHkgdHJpbW1lZCAodmFsaWQgYXNzdW1wdGlvbnMgZ2l2ZW4gdGhl\nIGNoZWNrcyBtYWRlCiAgICAgKiBpbiBvdXIgc2V0dGVycykuCiAgICAgKgog\nICAgICogQHBhcmFtIGRlY1R5cGUgdGhlIHR5cGUgb2YgZGVjbGFyYXRpb24g\nYmVpbmcgcGFyc2VkLCBmb3IgdXNlIGluCiAgICAgKiBlcnJvciBtZXNzYWdl\ncwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExpc3QgcGFyc2VEZWNsYXJh\ndGlvbihTdHJpbmcgZGVjLCBjaGFyIHNwbGl0LAogICAgICAgIFN0cmluZyBk\nZWNUeXBlKSB7CiAgICAgICAgaWYgKGRlYyA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gd2F0Y2ggZm9yIGNvbW1vbiBt\naXh1cHMgYmV0d2VlbiBjb21tYXMgYW5kIHNlbWlzCiAgICAgICAgY2hhciBi\nYWQgPSAoY2hhcikgMDsKICAgICAgICBpZiAoc3BsaXQgPT0gJywnKQogICAg\nICAgICAgICBiYWQgPSAnOyc7CiAgICAgICAgZWxzZSBpZiAoc3BsaXQgPT0g\nJzsnKQogICAgICAgICAgICBiYWQgPSAnLCc7CgogICAgICAgIGNoYXIgc2Vu\ndGluYWwgPSAnICc7CiAgICAgICAgY2hhciBjdXI7CiAgICAgICAgaW50IHN0\nYXJ0ID0gMDsKICAgICAgICBib29sZWFuIHNraXBTcGFjZSA9IGZhbHNlOwog\nICAgICAgIExpc3QgcmVzdWx0cyA9IG5ldyBBcnJheUxpc3QoNik7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWMubGVuZ3RoKCk7IGkrKykgewog\nICAgICAgICAgICBjdXIgPSBkZWMuY2hhckF0KGkpOwogICAgICAgICAgICBp\nZiAoY3VyID09IGJhZCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGVjIiwgZGVjLCBkZWNUeXBlKSk7\nCiAgICAgICAgICAgIGlmIChjdXIgPT0gJyAnICYmIHNraXBTcGFjZSkgewog\nICAgICAgICAgICAgICAgc3RhcnQrKzsKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBza2lwU3BhY2UgPSBm\nYWxzZTsKICAgICAgICAgICAgaWYgKGN1ciAhPSBzZW50aW5hbCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gaWYgbG9va2lu\nZyBmb3Igc3BhY2VzLCBsb29rIGZvciBzcGxpdCBjaGFyLCBvciB2aWNlIHZl\ncnNhCiAgICAgICAgICAgIHNlbnRpbmFsID0gKHNlbnRpbmFsID09ICcgJykg\nPyBzcGxpdCA6ICcgJzsKICAgICAgICAgICAgcmVzdWx0cy5hZGQoZGVjLnN1\nYnN0cmluZyhzdGFydCwgaSkudHJpbSgpKTsKICAgICAgICAgICAgc3RhcnQg\nPSBpICsgMTsKICAgICAgICAgICAgc2tpcFNwYWNlID0gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIC8vIGFkZCBsYXN0IHRva2VuLCBpZiBhbnkKICAgICAg\nICBpZiAoc3RhcnQgPCBkZWMubGVuZ3RoKCkpCiAgICAgICAgICAgIHJlc3Vs\ndHMuYWRkKGRlYy5zdWJzdHJpbmcoc3RhcnQpKTsKCiAgICAgICAgLy8gaWYg\nbm90IGFuIGV2ZW4gbnVtYmVyIG9mIGVsZW1lbnRzLCBzb21ldGhpbmcgaXMg\nd3JvbmcKICAgICAgICBpZiAocmVzdWx0cy5pc0VtcHR5KCkgfHwgcmVzdWx0\ncy5zaXplKCkgJSAyICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGVjIiwgZGVjLCBkZWNUeXBlKSk7\nCgogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgfQoKICAgIC8qKgogICAg\nICogU3BsaXQgdGhlIGdpdmVuIGV4cHJlc3Npb24gbGlzdCBpbnRvIGRpc3Rp\nbmN0IGV4cHJlc3Npb25zLiBBc3N1bWVzIHRoZQogICAgICogZ2l2ZW4gc3Ry\naW5nIGlzIG5vdCBudWxsIG9yIG9mIHplcm8gbGVuZ3RoIGFuZCBpcyBhbHJl\nYWR5IHRyaW1tZWQKICAgICAqICh2YWxpZCBhc3N1bXB0aW9ucyBnaXZlbiB0\naGUgY2hlY2tzIGluIG91ciBzZXR0ZXJzIGFuZCBiZWZvcmUKICAgICAqIHRo\naXMgbWV0aG9kIGNhbGwpLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIExp\nc3Qgc3BsaXRFeHByZXNzaW9ucyhTdHJpbmcgc3RyLCBjaGFyIHNwbGl0LCBp\nbnQgZXhwZWN0ZWQpIHsKICAgICAgICBpZiAoc3RyID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBMaXN0IGV4cHMgPSBudWxs\nOwogICAgICAgIGludCBwYXJlbkRlcHRoID0gMDsKICAgICAgICBpbnQgYmVn\naW4gPSAwLCBwb3MgPSAwOwogICAgICAgIGJvb2xlYW4gZXNjYXBlID0gZmFs\nc2U7CiAgICAgICAgYm9vbGVhbiBzdHJpbmcgPSBmYWxzZTsKICAgICAgICBi\nb29sZWFuIG5vbnNwYWNlID0gZmFsc2U7CiAgICAgICAgY2hhciBxdW90ZSA9\nIDA7CiAgICAgICAgZm9yIChjaGFyIGM7IHBvcyA8IHN0ci5sZW5ndGgoKTsg\ncG9zKyspIHsKICAgICAgICAgICAgYyA9IHN0ci5jaGFyQXQocG9zKTsKICAg\nICAgICAgICAgaWYgKGMgPT0gJ1xcJykgewogICAgICAgICAgICAgICAgZXNj\nYXBlID0gIWVzY2FwZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICAg\nICAgICAgIGVzY2FwZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoYykgewog\nICAgICAgICAgICAgICAgY2FzZSAnXCcnOgogICAgICAgICAgICAgICAgY2Fz\nZSAnIic6CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmluZyAmJiBxdW90\nZSA9PSBjKQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgPSBmYWxz\nZTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghc3RyaW5nKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHF1b3RlID0gYzsKICAgICAgICAgICAg\nICAgICAgICAgICAgc3RyaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgbm9uc3BhY2UgPSB0cnVlOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAn\nKCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdHJpbmcpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcmVuRGVwdGgrKzsKICAgICAgICAgICAgICAg\nICAgICBub25zcGFjZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlICcpJzoKICAgICAgICAgICAgICAg\nICAgICBpZiAoIXN0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgcGFy\nZW5EZXB0aC0tOwogICAgICAgICAgICAgICAgICAgIG5vbnNwYWNlID0gdHJ1\nZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgJyAnOgogICAgICAgICAgICAgICAgY2FzZSAnXHQnOgogICAgICAg\nICAgICAgICAgY2FzZSAnXG4nOgogICAgICAgICAgICAgICAgY2FzZSAnXHIn\nOgogICAgICAgICAgICAgICAgICAgIGlmIChjID09IHNwbGl0ICYmICFzdHJp\nbmcgJiYgcGFyZW5EZXB0aCA9PSAwICYmIG5vbnNwYWNlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChleHBzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBleHBzID0gbmV3IEFycmF5TGlzdChleHBlY3Rl\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHMuYWRkKHN0ci5zdWJz\ndHJpbmcoYmVnaW4sIHBvcykudHJpbSgpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgYmVnaW4gPSBwb3MgKyAxOwogICAgICAgICAgICAgICAgICAgICAg\nICBub25zcGFjZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGMgPT0gc3BsaXQgJiYgIXN0\ncmluZyAmJiBwYXJlbkRlcHRoID09IDApIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGV4cHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGV4cHMgPSBuZXcgQXJyYXlMaXN0KGV4cGVjdGVkKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZXhwcy5hZGQoc3RyLnN1YnN0cmluZyhiZWdp\nbiwgcG9zKS50cmltKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBiZWdp\nbiA9IHBvcyArIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIG5vbnNwYWNlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBlc2NhcGUgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlm\nIChleHBzID09IG51bGwpIHsKICAgICAgICAgICAgLy8gQ29sbGVjdGlvbnMu\nc2luZ2xldG9uTGlzdCB3YXNuJ3QgYWRkZWQgdW50aWwgMS4zCiAgICAgICAg\nICAgIGV4cHMgPSBuZXcgQXJyYXlMaXN0KDEpOwogICAgICAgICAgICBleHBz\nLmFkZChzdHIpOwogICAgICAgICAgICByZXR1cm4gZXhwczsKICAgICAgICB9\nCgogICAgICAgIC8vIGFkZCBsYXN0IGV4cCBhbmQgcmV0dXJuIGFycmF5CiAg\nICAgICAgU3RyaW5nIGxhc3QgPSBzdHIuc3Vic3RyaW5nKGJlZ2luKS50cmlt\nKCk7CiAgICAgICAgaWYgKGxhc3QubGVuZ3RoKCkgPiAwKQogICAgICAgICAg\nICBleHBzLmFkZChsYXN0KTsKICAgICAgICByZXR1cm4gZXhwczsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gYWNjZXNzIHBhdGggbWV0\nYWRhdGFzIHRvIHRoZSBmdWxsIHBhdGggbGlzdCwgbWFraW5nIHN1cmUKICAg\nICAqIHRvIG1haW50YWluIG9ubHkgYmFzZSBtZXRhZGF0YXMgaW4gdGhlIGxp\nc3QuIFRoZSBnaXZlbiBsaXN0IG1heSBiZSBudWxsLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIExpc3QgYWRkQWNjZXNzUGF0aE1ldGFEYXRhcyhMaXN0\nIG1ldGFzLAogICAgICAgIENsYXNzTWV0YURhdGFbXSBwYXRoKSB7CiAgICAg\nICAgaWYgKHBhdGggPT0gbnVsbCB8fCBwYXRoLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICByZXR1cm4gbWV0YXM7CgogICAgICAgIC8vIGNyZWF0ZSBzZXQg\nb2YgYmFzZSBjbGFzcyBtZXRhZGF0YXMgaW4gYWNjZXNzIHBhdGgKICAgICAg\nICBpZiAobWV0YXMgPT0gbnVsbCkKICAgICAgICAgICAgbWV0YXMgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgaW50IGxhc3QgPSBtZXRhcy5zaXplKCk7\nCgogICAgICAgIC8vIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBwYXRoIG9m\nIHRoaXMgZXhlY3V0b3IsIGNvbXBhcmUgaXQKICAgICAgICAvLyB0byBhbHJl\nYWR5LWdhdGhlcmVkIGVsZW1lbnRzIHRvIHNlZSBpZiBpdCBzaG91bGQgcmVw\nbGFjZQogICAgICAgIC8vIGEgc3ViY2xhc3MgaW4gdGhlIGxpc3Qgb3Igc2hv\ndWxkIGJlIGFkZGVkIGFzIGEgbmV3IGJhc2U7CiAgICAgICAgLy8gYXQgbGVh\nc3QgaXQncyBuXjIgb2YgYSBzbWFsbCBuLi4uCiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhOwogICAgICAgIGJvb2xlYW4gYWRkOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBhZGQgPSB0cnVlOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgYWRk\nICYmIGogPCBsYXN0OyBqKyspIHsKICAgICAgICAgICAgICAgIG1ldGEgPSAo\nQ2xhc3NNZXRhRGF0YSkgbWV0YXMuZ2V0KGopOwoKICAgICAgICAgICAgICAg\nIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9t\nCiAgICAgICAgICAgICAgICAgICAgKHBhdGhbaV0uZ2V0RGVzY3JpYmVkVHlw\nZSgpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGxpc3QgYWxyZWFkeSBj\nb250YWlucyBiYXNlIGNsYXNzCiAgICAgICAgICAgICAgICAgICAgYWRkID0g\nZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGhbaV0uZ2V0\nRGVzY3JpYmVkVHlwZSgpLmlzQXNzaWduYWJsZUZyb20KICAgICAgICAgICAg\nICAgICAgICAobWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gdGhpcyBlbGVtZW50IHJlcGxhY2VzIGl0cyBzdWJj\nbGFzcwogICAgICAgICAgICAgICAgICAgIGFkZCA9IGZhbHNlOwogICAgICAg\nICAgICAgICAgICAgIG1ldGFzLnNldChqLCBwYXRoW2ldKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgbm8g\nYmFzZSBjbGFzcyBvZiBjdXJyZW50IHBhdGggZWxlbWVudCBhbHJlYWR5IGlu\nCiAgICAgICAgICAgIC8vIGxpc3QgYW5kIHBhdGggZWxlbWVudCBkaWRuJ3Qg\ncmVwbGFjZSBhIHN1YmNsYXNzIGluIHRoZQogICAgICAgICAgICAvLyBsaXN0\nLCB0aGVuIGFkZCBpdCBub3cgYXMgYSBuZXcgYmFzZQogICAgICAgICAgICBp\nZiAoYWRkKQogICAgICAgICAgICAgICAgbWV0YXMuYWRkKHBhdGhbaV0pOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZXJ0IHRoZSB1c2VyLWdpdmVuIGhpbnQgdmFsdWUgdG8g\nYW4gYWdncmVnYXRlIGxpc3RlbmVyLgogICAgICogVGhlIGhpbnQgY2FuIGJl\nIGFuIGFnZ3JlZ2F0ZSBsaXN0ZW5lciBpbnN0YW5jZSBvciBjbGFzcyBuYW1l\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIEFnZ3JlZ2F0ZUxpc3RlbmVy\nIGhpbnRUb0FnZ3JlZ2F0ZUxpc3RlbmVyKE9iamVjdCBoaW50LAogICAgICAg\nIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIGlmIChoaW50ID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChoaW50\nIGluc3RhbmNlb2YgQWdncmVnYXRlTGlzdGVuZXIpCiAgICAgICAgICAgIHJl\ndHVybiAoQWdncmVnYXRlTGlzdGVuZXIpIGhpbnQ7CgogICAgICAgIEV4Y2Vw\ndGlvbiBjYXVzZSA9IG51bGw7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFuY2Vv\nZiBTdHJpbmcpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHJldHVybiAoQWdncmVnYXRlTGlzdGVuZXIpIENsYXNzLmZvck5hbWUoKFN0\ncmluZykgaGludCwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBsb2FkZXIp\nLm5ld0luc3RhbmNlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBjYXVzZSA9IGU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1hZ2ctbGlzdGVuZXItaGludCIsIGhpbnQsCiAgICAg\nICAgICAgIGhpbnQuZ2V0Q2xhc3MoKSkpLnNldENhdXNlKGNhdXNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHVzZXItZ2l2ZW4gaGlu\ndCB2YWx1ZSB0byBhbiBhcnJheSBvZiBhZ2dyZWdhdGUgbGlzdGVuZXJzLgog\nICAgICogVGhlIGhpbnQgY2FuIGJlIGFuIGFnZ3JlZ2F0ZSBsaXN0ZW5lciwg\nYWdncmVnYXRlIGxpc3RlbmVyIGFycmF5LAogICAgICogY29sbGVjdGlvbiwg\nb3IgY29tbWEtc2VwYXJhdGVkIGNsYXNzIG5hbWVzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIEFnZ3JlZ2F0ZUxpc3RlbmVyW10gaGludFRvQWdncmVn\nYXRlTGlzdGVuZXJzKE9iamVjdCBoaW50LAogICAgICAgIENsYXNzTG9hZGVy\nIGxvYWRlcikgewogICAgICAgIGlmIChoaW50ID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChoaW50IGluc3RhbmNlb2Yg\nQWdncmVnYXRlTGlzdGVuZXJbXSkKICAgICAgICAgICAgcmV0dXJuIChBZ2dy\nZWdhdGVMaXN0ZW5lcltdKSBoaW50OwogICAgICAgIGlmIChoaW50IGluc3Rh\nbmNlb2YgQWdncmVnYXRlTGlzdGVuZXIpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgQWdncmVnYXRlTGlzdGVuZXJbXXsgKEFnZ3JlZ2F0ZUxpc3RlbmVyKSBo\naW50IH07CiAgICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBDb2xsZWN0aW9u\nKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gYyA9IChDb2xsZWN0aW9uKSBo\naW50OwogICAgICAgICAgICByZXR1cm4gKEFnZ3JlZ2F0ZUxpc3RlbmVyW10p\nIGMudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBBZ2dyZWdhdGVMaXN0\nZW5lcltjLnNpemUoKV0pOwogICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9u\nIGNhdXNlID0gbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9mIFN0\ncmluZykgewogICAgICAgICAgICBTdHJpbmdbXSBjbHNzID0gU3RyaW5ncy5z\ncGxpdCgoU3RyaW5nKSBoaW50LCAiLCIsIDApOwogICAgICAgICAgICBBZ2dy\nZWdhdGVMaXN0ZW5lcltdIGFnZ3MgPSBuZXcgQWdncmVnYXRlTGlzdGVuZXJb\nY2xzcy5sZW5ndGhdOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbHNzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAgICAgICAgIGFnZ3NbaV0gPSAoQWdncmVnYXRlTGlzdGVuZXIp\nIENsYXNzLmZvck5hbWUoY2xzc1tpXSwgdHJ1ZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgbG9hZGVyKS5uZXdJbnN0YW5jZSgpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGFnZ3M7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBjYXVzZSA9IGU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImJhZC1hZ2ctbGlzdGVuZXItaGludCIsIGhpbnQsCiAgICAg\nICAgICAgIGhpbnQuZ2V0Q2xhc3MoKSkpLnNldENhdXNlKGNhdXNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHVzZXItZ2l2ZW4gaGlu\ndCB2YWx1ZSB0byBhIGZpbHRlciBsaXN0ZW5lci4KICAgICAqIFRoZSBoaW50\nIGNhbiBiZSBhIGZpbHRlciBsaXN0ZW5lciBpbnN0YW5jZSBvciBjbGFzcyBu\nYW1lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIEZpbHRlckxpc3RlbmVy\nIGhpbnRUb0ZpbHRlckxpc3RlbmVyKE9iamVjdCBoaW50LAogICAgICAgIENs\nYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIGlmIChoaW50ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChoaW50IGlu\nc3RhbmNlb2YgRmlsdGVyTGlzdGVuZXIpCiAgICAgICAgICAgIHJldHVybiAo\nRmlsdGVyTGlzdGVuZXIpIGhpbnQ7CgogICAgICAgIEV4Y2VwdGlvbiBjYXVz\nZSA9IG51bGw7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBTdHJpbmcp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiAo\nRmlsdGVyTGlzdGVuZXIpIENsYXNzLmZvck5hbWUoKFN0cmluZykgaGludCwg\ndHJ1ZSwKICAgICAgICAgICAgICAgICAgICBsb2FkZXIpLm5ld0luc3RhbmNl\nKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICBjYXVzZSA9IGU7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJh\nZC1maWx0ZXItbGlzdGVuZXItaGludCIsIGhpbnQsCiAgICAgICAgICAgIGhp\nbnQuZ2V0Q2xhc3MoKSkpLnNldENhdXNlKGNhdXNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHVzZXItZ2l2ZW4gaGludCB2YWx1ZSB0\nbyBhbiBhcnJheSBvZiBmaWx0ZXIgbGlzdGVuZXJzLgogICAgICogVGhlIGhp\nbnQgY2FuIGJlIGEgZmlsdGVyIGxpc3RlbmVyLCBmaWx0ZXIgbGlzdGVuZXIg\nYXJyYXksCiAgICAgKiBjb2xsZWN0aW9uLCBvciBjb21tYS1zZXBhcmF0ZWQg\nY2xhc3MgbmFtZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgRmlsdGVy\nTGlzdGVuZXJbXSBoaW50VG9GaWx0ZXJMaXN0ZW5lcnMoT2JqZWN0IGhpbnQs\nCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgaWYgKGhp\nbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKGhpbnQgaW5zdGFuY2VvZiBGaWx0ZXJMaXN0ZW5lcltdKQogICAgICAg\nICAgICByZXR1cm4gKEZpbHRlckxpc3RlbmVyW10pIGhpbnQ7CiAgICAgICAg\naWYgKGhpbnQgaW5zdGFuY2VvZiBGaWx0ZXJMaXN0ZW5lcikKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBGaWx0ZXJMaXN0ZW5lcltdeyAoRmlsdGVyTGlzdGVu\nZXIpIGhpbnQgfTsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9mIENvbGxl\nY3Rpb24pIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiBjID0gKENvbGxlY3Rp\nb24pIGhpbnQ7CiAgICAgICAgICAgIHJldHVybiAoRmlsdGVyTGlzdGVuZXJb\nXSkgYy50b0FycmF5KG5ldyBGaWx0ZXJMaXN0ZW5lcltjLnNpemUoKV0pOwog\nICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9uIGNhdXNlID0gbnVsbDsKICAg\nICAgICBpZiAoaGludCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAg\nICBTdHJpbmdbXSBjbHNzID0gU3RyaW5ncy5zcGxpdCgoU3RyaW5nKSBoaW50\nLCAiLCIsIDApOwogICAgICAgICAgICBGaWx0ZXJMaXN0ZW5lcltdIGZpbHRz\nID0gbmV3IEZpbHRlckxpc3RlbmVyW2Nsc3MubGVuZ3RoXTsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY2xzcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBmaWx0c1tp\nXSA9IChGaWx0ZXJMaXN0ZW5lcikgQ2xhc3MuZm9yTmFtZShjbHNzW2ldLCB0\ncnVlLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXIpLm5ld0luc3Rh\nbmNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmlsdHM7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBj\nYXVzZSA9IGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1maWx0ZXItbGlz\ndGVuZXItaGludCIsIGhpbnQsCiAgICAgICAgICAgIGhpbnQuZ2V0Q2xhc3Mo\nKSkpLnNldENhdXNlKGNhdXNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgdmFsdWUgb2YgdGhlIHByb3BlcnR5IG5hbWVkIGJ5IHRoZSBo\naW50IGtleS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgaGlu\ndFRvR2V0dGVyKE9iamVjdCB0YXJnZXQsIFN0cmluZyBoaW50S2V5KSB7CiAg\nICAgICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGhpbnRLZXkgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE1ldGhvZCBnZXR0\nZXIgPSBJbXBsSGVscGVyLmdldEdldHRlcih0YXJnZXQuZ2V0Q2xhc3MoKSwg\naGludEtleSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGdl\ndHRlci5pbnZva2UodGFyZ2V0LCAoT2JqZWN0W10pIG51bGwpOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIFRocm93YWJs\nZSB0ID0gZTsKICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBJbnZvY2F0\naW9uVGFyZ2V0RXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdCA9ICgoSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbikgZSkuZ2V0VGFyZ2V0RXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJiYWQtZ2V0dGVyLWhpbnQiLAogICAgICAgICAgICAgICAgdGFyZ2V0\nLmdldENsYXNzKCksIGhpbnRLZXkpKS5zZXRDYXVzZSh0KTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBw\ncm9wZXJ0eSBuYW1lZCBieSB0aGUgaGludCBrZXkuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgdm9pZCBoaW50VG9TZXR0ZXIoT2JqZWN0IHRhcmdldCwg\nU3RyaW5nIGhpbnRLZXksCiAgICAgICAgT2JqZWN0IHZhbHVlKSB7CiAgICAg\nICAgaWYgKHRhcmdldCA9PSBudWxsIHx8IGhpbnRLZXkgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBNZXRob2Qgc2V0dGVyID0gSW1w\nbEhlbHBlci5nZXRTZXR0ZXIodGFyZ2V0LmdldENsYXNzKCksIGhpbnRLZXkp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5j\nZW9mIFN0cmluZykgewogICAgICAgICAgICAgICAgaWYgKCJudWxsIi5lcXVh\nbHModmFsdWUpKQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbnVsbDsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB2YWx1\nZSA9IFN0cmluZ3MucGFyc2UoKFN0cmluZykgdmFsdWUsCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNldHRlci5nZXRQYXJhbWV0ZXJUeXBlcygpWzBdKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBzZXR0ZXIuaW52b2tlKHRhcmdl\ndCwgbmV3IE9iamVjdFtdeyB2YWx1ZSB9KTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBUaHJvd2FibGUgdCA9IGU7CiAg\nICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgSW52b2NhdGlvblRhcmdldEV4\nY2VwdGlvbikKICAgICAgICAgICAgICAgIHQgPSAoKEludm9jYXRpb25UYXJn\nZXRFeGNlcHRpb24pIGUpLmdldFRhcmdldEV4Y2VwdGlvbigpOwogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXNl\ndHRlci1oaW50IiwKCQkJCXRhcmdldC5nZXRDbGFzcyAoKSwgaGludEtleSwg\ndmFsdWUpKS5zZXRDYXVzZSAodCk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

