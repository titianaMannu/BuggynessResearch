{"sha":"8d8afc08f0b08cd64273d04600e78ac90c10d83e","node_id":"MDQ6QmxvYjIwNjM2NDo4ZDhhZmMwOGYwYjA4Y2Q2NDI3M2QwNDYwMGU3OGFjOTBjMTBkODNl","size":14295,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8d8afc08f0b08cd64273d04600e78ac90c10d83e","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmRhdGFj\nYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogQ2xhc3Mgd2hp\nY2ggbWFuYWdlcyBpbnZlcnNlIHJlbGF0aW9ucyBiZWZvcmUgZmx1c2hpbmcK\nICogdG8gdGhlIGRhdGFzdG9yZS4gRW5zdXJlcyB0aGF0IGludmVyc2UgZmll\nbGRzIGFyZSBzZXQuCiAqICBDdXJyZW50bHkgbGltaXRlZCB0byBtYW5hZ2lu\nZyBQQyBhbmQgQ29sbGVjdGlvbi10eXBlIHJlbGF0aW9ucy4KICoKICogQGF1\ndGhvciBTdGV2ZSBLaW0KICovCnB1YmxpYyBjbGFzcyBJbnZlcnNlTWFuYWdl\nciBpbXBsZW1lbnRzIENvbmZpZ3VyYWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZQogICAgICAgIChJbnZlcnNlTWFuYWdlci5jbGFzcyk7CgogICAgcHJvdGVj\ndGVkIHN0YXRpYyBmaW5hbCBPYmplY3QgTk9ORSA9IG5ldyBPYmplY3QoKTsK\nCiAgICAvKioKICAgICAqIENvbnN0YW50IHJlcHJlc2VudGluZyB0aGUge0Bs\naW5rICNBQ1RJT05fTUFOQUdFfSBhY3Rpb24KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgQUNUSU9OX01BTkFHRSA9IDA7CgogICAgLyoq\nCiAgICAgKiBDb25zdGFudCByZXByZXNlbnRpbmcgdGhlIHtAbGluayAjQUNU\nSU9OX1dBUk59IGFjdGlvbgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBBQ1RJT05fV0FSTiA9IDE7CgogICAgLyoqCiAgICAgKiBDb25z\ndGFudCByZXByZXNlbnRpbmcgdGhlIHtAbGluayAjQUNUSU9OX0VYQ0VQVElP\nTn0gYWN0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIEFDVElPTl9FWENFUFRJT04gPSAyOwoKICAgIHByaXZhdGUgYm9vbGVhbiBf\nbWFuYWdlTFJTID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfYWN0aW9uID0g\nQUNUSU9OX01BTkFHRTsKICAgIHByaXZhdGUgTG9nIF9sb2c7CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gd2hldGhlciB0byBtYW5hZ2UgTFJTIGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0TWFuYWdlTFJTKCkgewog\nICAgICAgIHJldHVybiBfbWFuYWdlTFJTOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHdoZXRoZXIgdG8gZmFsc2UgTFJTIHJlbGF0aW9ucy4gRGVmYXVs\ndHMgdG8gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1hbmFn\nZUxSUyhib29sZWFuIG1hbmFnZSkgewogICAgICAgIF9tYW5hZ2VMUlMgPSBt\nYW5hZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGFjdGlv\nbiBjb25zdGFudCB0byB1c2UgZHVyaW5nIHJlbGF0aW9uc2hpcCBjaGVja2lu\nZy4KICAgICAqIERlZmF1bHRzIHRvIHtAbGluayAjQUNUSU9OX01BTkFHRX0u\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0QWN0aW9uKCkgewogICAgICAg\nIHJldHVybiBfYWN0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBhY3Rpb24gY29uc3RhbnQgdG8gdXNlIGR1cmluZyByZWxhdGlvbnNoaXAg\nY2hlY2tpbmcuCiAgICAgKiBEZWZhdWx0cyB0byB7QGxpbmsgI0FDVElPTl9N\nQU5BR0V9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBY3Rpb24oaW50\nIGFjdGlvbikgewogICAgICAgIF9hY3Rpb24gPSBhY3Rpb247CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGFjdGlvbiBzdHJpbmcgdG8gdXNlIGR1\ncmluZyByZWxhdGlvbnNoaXAgY2hlY2tpbmcuCiAgICAgKiBPcHRpb25zIGlu\nY2x1ZGUgPGNvZGU+bWFuYWdlLCBleGNlcHRpb24sIHdhcm48L2NvZGU+Lgog\nICAgICogVGhpcyBtZXRob2QgaXMgcHJpbWFyaWx5IGZvciBzdHJpbmctYmFz\nZWQgYXV0b21hdGVkIGNvbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEFjdGlvbihTdHJpbmcgYWN0aW9uKSB7CiAgICAgICAgaWYg\nKCJleGNlcHRpb24iLmVxdWFscyhhY3Rpb24pKQogICAgICAgICAgICBfYWN0\naW9uID0gQUNUSU9OX0VYQ0VQVElPTjsKICAgICAgICBlbHNlIGlmICgid2Fy\nbiIuZXF1YWxzKGFjdGlvbikpCiAgICAgICAgICAgIF9hY3Rpb24gPSBBQ1RJ\nT05fV0FSTjsKICAgICAgICBlbHNlIGlmICgibWFuYWdlIi5lcXVhbHMoYWN0\naW9uKSkKICAgICAgICAgICAgX2FjdGlvbiA9IEFDVElPTl9NQU5BR0U7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uKGFjdGlvbik7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RhcnRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAg\nICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9H\nX1JVTlRJTUUpOwogICAgfQoKICAgIC8qKgogICAgICogQ29ycmVjdCByZWxh\ndGlvbnMgZnJvbSB0aGUgZ2l2ZW4gZGlydHkgZmllbGQgdG8gaW52ZXJzZSBp\nbnN0YW5jZXMuCiAgICAgKiBGaWVsZCA8Y29kZT5mbWQ8L2NvZGU+IG9mIHRo\nZSBpbnN0YW5jZSBtYW5hZ2VkIGJ5IDxjb2RlPnNtPC9jb2RlPiBoYXMKICAg\nICAqIHZhbHVlIDxjb2RlPnZhbHVlPC9jb2RlPi4gRW5zdXJlIHRoYXQgYWxs\nIGludmVyc2VzIHJlbGF0aW9ucyBmcm9tCiAgICAgKiA8Y29kZT52YWx1ZTwv\nY29kZT4gYXJlIGNvbnNpc3RlbnQgd2l0aCB0aGlzLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjb3JyZWN0UmVsYXRpb25zKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIE9iamVjdCB2YWx1\nZSkgewogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9\nIEphdmFUeXBlcy5QQyAmJgogICAgICAgICAgICAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuQ09MTEVDVElPTiB8fAogICAgICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLlBDKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBpZ25vcmUgTFJTIGZpZWxkcwogICAgICAgIGlmICghZ2V0TWFu\nYWdlTFJTKCkgJiYgZm1kLmlzTFJTKCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGludmVyc2VzID0gZm1kLmdldElu\ndmVyc2VNZXRhRGF0YXMoKTsKICAgICAgICBpZiAoaW52ZXJzZXMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gY2xlYXIg\nYW55IHJlc3RvcmFibGUgcmVsYXRpb25zCiAgICAgICAgY2xlYXJJbnZlcnNl\nUmVsYXRpb25zKHNtLCBmbWQsIGludmVyc2VzLCB2YWx1ZSk7CgogICAgICAg\nIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0b3JlQ29udGV4\ndCBjdHggPSBzbS5nZXRDb250ZXh0KCk7CiAgICAgICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgY3JlYXRl\nSW52ZXJzZVJlbGF0aW9ucyhjdHgsIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSwgZm1kLCBpbnZlcnNl\ncyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gKChDb2xsZWN0aW9uKSB2YWx1ZSku\naXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXRyLmhhc05l\neHQoKTspCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZUludmVyc2VS\nZWxhdGlvbnMoY3R4LCBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGl0ci5uZXh0KCksIGZtZCwgaW52ZXJz\nZXMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBp\nbnZlcnNlIHJlbGF0aW9ucyBmb3IgYWxsIHRoZSBnaXZlbiBpbnZlcnNlIGZp\nZWxkcy4KICAgICAqIEEgcmVsYXRpb24gZXhpc3RzIGZyb20gPGNvZGU+ZnJv\nbVJlZjwvY29kZT4gdG8gPGNvZGU+dG9SZWY8L2NvZGU+OyB0aGlzCiAgICAg\nKiBtZXRob2QgY3JlYXRlcyB0aGUgaW52ZXJzZXMuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGNyZWF0ZUludmVyc2VSZWxhdGlvbnMoU3RvcmVDb250\nZXh0IGN0eCwKICAgICAgICBPYmplY3QgZnJvbVJlZiwgT2JqZWN0IHRvUmVm\nLCBGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\naW52ZXJzZXMpIHsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG90aGVy\nID0gY3R4LmdldFN0YXRlTWFuYWdlcih0b1JlZik7CiAgICAgICAgaWYgKG90\naGVyID09IG51bGwgfHwgb3RoZXIuaXNEZWxldGVkKCkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgYm9vbGVhbiBvd25lZDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGludmVyc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghZ2V0TWFuYWdlTFJTKCkgJiYgaW52ZXJzZXNbaV0uaXNM\nUlMoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nLy8gaWYgdGhpcyBpcyB0aGUgb3duZWQgc2lkZSBvZiB0aGUgcmVsYXRpb24g\nYW5kIGhhcyBub3QgeWV0IGJlZW4KICAgICAgICAgICAgLy8gbG9hZGVkLCBu\nbyBwb2ludCBpbiBzZXR0aW5nIGl0IG5vdywgY2F1c2UgaXQnbGwgaGF2ZSB0\naGUgY29ycmVjdAogICAgICAgICAgICAvLyB2YWx1ZSB0aGUgbmV4dCB0aW1l\nIGl0IGlzIGxvYWRlZCBhZnRlciB0aGUgZmx1c2gKICAgICAgICAgICAgb3du\nZWQgPSBmbWQgPT0gaW52ZXJzZXNbaV0uZ2V0TWFwcGVkQnlNZXRhRGF0YSgp\nCiAgICAgICAgICAgICAgICAmJiBfYWN0aW9uID09IEFDVElPTl9NQU5BR0UK\nICAgICAgICAgICAgICAgICYmICFpc0xvYWRlZChvdGhlciwgaW52ZXJzZXNb\naV0uZ2V0SW5kZXgoKSk7CgogICAgICAgICAgICBzd2l0Y2ggKGludmVyc2Vz\nW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFv\nd25lZCB8fCBpbnZlcnNlc1tpXS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAg\nICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FV\nVE8pCiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlRmllbGQob3RoZXIs\nIGludmVyc2VzW2ldLCBOT05FLCBmcm9tUmVmKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNP\nTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvd25lZCB8fCBp\nbnZlcnNlc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAg\nICAgICAgICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9BVVRPKQogICAgICAgICAgICAgICAgICAgICAgICBhZGRUb0NvbGxlY3Rp\nb24ob3RoZXIsIGludmVyc2VzW2ldLCBmcm9tUmVmKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBmaWVs\nZCBpcyBsb2FkZWQgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGlzTG9hZGVkKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIGludCBmaWVsZCkgewogICAgICAgIGlmIChzbS5nZXRMb2FkZWQo\nKS5nZXQoZmllbGQpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAg\nICAgLy8gaWYgdGhlIGZpZWxkIGlzbid0IGxvYWRlZCBpbiB0aGUgc3RhdGUg\nbWFuYWdlciwgaXQgc3RpbGwgbWlnaHQgYmUKICAgICAgICAvLyBsb2FkZWQg\naW4gdGhlIGRhdGEgY2FjaGUsIGluIHdoaWNoIGNhc2Ugd2Ugc3RpbGwgaGF2\nZSB0byBjb3JyZWN0CiAgICAgICAgLy8gaXQgdG8ga2VlcCB0aGUgY2FjaGUg\naW4gc3luYwogICAgICAgIERhdGFDYWNoZSBjYWNoZSA9IHNtLmdldE1ldGFE\nYXRhKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gY2Fu\nJ3QgcmV0cmlldmUgYW4gZW1iZWRkZWQgb2JqZWN0IGRpcmVjdGx5LCBzbyBh\nbHdheXMgYXNzdW1lIHRoZQogICAgICAgIC8vIGZpZWxkIGlzIGxvYWRlZCBh\nbmQgbmVlZHMgdG8gYmUgY29ycmVjdGVkCiAgICAgICAgaWYgKHNtLmlzRW1i\nZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIFBD\nRGF0YSBwYyA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAg\nICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIHJldHVybiBwYy5pc0xvYWRlZChmaWVsZCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZW1vdmUgYWxsIHJlbGF0aW9ucyBiZXR3ZWVuIHRoZSBp\nbml0aWFsIHZhbHVlIG9mIDxjb2RlPmZtZDwvY29kZT4gZm9yCiAgICAgKiB0\naGUgaW5zdGFuY2UgbWFuYWdlZCBieSA8Y29kZT5zbTwvY29kZT4gYW5kIGl0\ncyBpbnZlcnNlcy4gUmVsYXRpb25zCiAgICAgKiBzaGFyZWQgd2l0aCA8Y29k\nZT5uZXdWYWx1ZTwvY29kZT4gY2FuIGJlIGxlZnQgaW50YWN0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhckludmVyc2VSZWxhdGlvbnMoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCwgRmllbGRNZXRhRGF0YVtdIGludmVyc2VzLCBPYmplY3QgbmV3VmFsdWUp\nIHsKICAgICAgICAvLyBkb24ndCBib3RoZXIgY2xlYXJpbmcgdW5mbHVzaGVk\nIG5ldyBpbnN0YW5jZXMKICAgICAgICBpZiAoc20uaXNOZXcoKSAmJiAhc20u\nZ2V0Rmx1c2hlZCgpLmdldChmbWQuZ2V0SW5kZXgoKSkpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAgICAgT2JqZWN0IGluaXRp\nYWwgPSBzbS5mZXRjaEluaXRpYWxGaWVsZChmbWQuZ2V0SW5kZXgoKSk7CiAg\nICAgICAgICAgIGNsZWFySW52ZXJzZVJlbGF0aW9ucyhzbSwgaW5pdGlhbCwg\nZm1kLCBpbnZlcnNlcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nQ29sbGVjdGlvbiBpbml0aWFsID0gKENvbGxlY3Rpb24pCiAgICAgICAgICAg\nICAgICBzbS5mZXRjaEluaXRpYWxGaWVsZChmbWQuZ2V0SW5kZXgoKSk7CiAg\nICAgICAgICAgIGlmIChpbml0aWFsID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm47CgogICAgICAgICAgICAvLyBjbGVhciBhbGwgcmVsYXRpb25z\nIG5vdCBhbHNvIGluIHRoZSBuZXcgdmFsdWUKICAgICAgICAgICAgQ29sbGVj\ndGlvbiBjb2xsID0gKENvbGxlY3Rpb24pIG5ld1ZhbHVlOwogICAgICAgICAg\nICBPYmplY3QgZWxlbTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBpbml0aWFsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAg\nICAgICAgICAgICBlbGVtID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmIChjb2xsID09IG51bGwgfHwgIWNvbGwuY29udGFpbnMoZWxlbSkpCiAg\nICAgICAgICAgICAgICAgICAgY2xlYXJJbnZlcnNlUmVsYXRpb25zKHNtLCBl\nbGVtLCBmbWQsIGludmVyc2VzKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBpbnZlcnNlIHRoZSBy\nZWxhdGlvbnMgZnJvbSA8Y29kZT52YWw8L2NvZGU+IHRvIHRoZSBpbnN0YW5j\nZQogICAgICogbWFuYWdlZCBieSA8Y29kZT5zbTwvY29kZT4uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGNsZWFySW52ZXJzZVJlbGF0aW9ucyhPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgdmFsLAogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kLCBGaWVsZE1ldGFEYXRhW10gaW52ZXJzZXMpIHsKICAg\nICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG90aGVyID0gc20uZ2V0Q29udGV4\ndCgpLmdldFN0YXRlTWFuYWdlcih2YWwpOwogICAgICAgIGlmIChvdGhlciA9\nPSBudWxsIHx8IG90aGVyLmlzRGVsZXRlZCgpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGJvb2xlYW4gb3duZWQ7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBpbnZlcnNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoIWdldE1hbmFnZUxSUygpICYmIGludmVyc2VzW2ldLmlzTFJTKCkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGlm\nIHRoaXMgaXMgdGhlIG93bmVkIHNpZGUgb2YgdGhlIHJlbGF0aW9uIGFuZCBo\nYXMgbm90IHlldCBiZWVuCiAgICAgICAgICAgIC8vIGxvYWRlZCwgbm8gcG9p\nbnQgaW4gc2V0dGluZyBpdCBub3csIGNhdXNlIGl0J2xsIGhhdmUgdGhlIGNv\ncnJlY3QKICAgICAgICAgICAgLy8gdmFsdWUgdGhlIG5leHQgdGltZSBpdCBp\ncyBsb2FkZWQgYWZ0ZXIgdGhlIGZsdXNoCiAgICAgICAgICAgIG93bmVkID0g\nZm1kID09IGludmVyc2VzW2ldLmdldE1hcHBlZEJ5TWV0YURhdGEoKQogICAg\nICAgICAgICAgICAgJiYgX2FjdGlvbiA9PSBBQ1RJT05fTUFOQUdFCiAgICAg\nICAgICAgICAgICAmJiAhaXNMb2FkZWQob3RoZXIsIGludmVyc2VzW2ldLmdl\ndEluZGV4KCkpOwoKICAgICAgICAgICAgc3dpdGNoIChpbnZlcnNlc1tpXS5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgICAgIGlmICghb3duZWQg\nfHwgaW52ZXJzZXNbaV0uZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAg\nICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKQog\nICAgICAgICAgICAgICAgICAgICAgICBzdG9yZU51bGwob3RoZXIsIGludmVy\nc2VzW2ldLCBzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgICAgIGlmICghb3duZWQg\nfHwgaW52ZXJzZXNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVEZWxldGUo\nKQogICAgICAgICAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfQVVUTykKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRnJv\nbUNvbGxlY3Rpb24ob3RoZXIsIGludmVyc2VzW2ldLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgbnVsbCB2YWx1ZSBhdCB0\naGUgZ2l2ZW4gZmllbGQuIFZlcmlmeSB0aGF0IHRoZSBnaXZlbiBjb21wYXJl\nCiAgICAgKiB2YWx1ZSBpcyB0aGUgdmFsdWUgYmVpbmcgbnVsbGVkLiBQYXNz\nIE5PTkUgZm9yIG5vIGNvbXBhcmlzb24uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHN0b3JlTnVsbChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBGaWVs\nZE1ldGFEYXRhIGZtZCwKICAgICAgICBPYmplY3QgY29tcGFyZSkgewogICAg\nICAgIHN0b3JlRmllbGQoc20sIGZtZCwgY29tcGFyZSwgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTdG9yZSBhIGdpdmVuIHZhbHVlIGF0IHRoZSBn\naXZlbiBmaWVsZC4gQ29tcGFyZSB0aGUgZ2l2ZW4KICAgICAqIGFyZ3VtZW50\nIGlmIG5vdCBOT05FLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9y\nZUZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEg\nZm1kLAogICAgICAgIE9iamVjdCBjb21wYXJlLCBPYmplY3QgdmFsKSB7CiAg\nICAgICAgT2JqZWN0IG9sZFZhbHVlID0gc20uZmV0Y2hPYmplY3RGaWVsZChm\nbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgaWYgKG9sZFZhbHVlID09IHZhbCkK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChjb21wYXJlICE9IE5P\nTkUgJiYgb2xkVmFsdWUgIT0gY29tcGFyZSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBzd2l0Y2ggKF9hY3Rpb24pIHsKICAgICAgICAgICAgY2Fz\nZSBBQ1RJT05fTUFOQUdFOgogICAgICAgICAgICAgICAgc20uc2V0dGluZ09i\namVjdEZpZWxkKHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpLAogICAgICAg\nICAgICAgICAgICAgIGZtZC5nZXRJbmRleCgpLAogICAgICAgICAgICAgICAg\nICAgIG9sZFZhbHVlLCB2YWwsIE9wZW5KUEFTdGF0ZU1hbmFnZXIuU0VUX1VT\nRVIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nQUNUSU9OX1dBUk46CiAgICAgICAgICAgICAgICB3YXJuQ29uc2lzdGVuY3ko\nc20sIGZtZCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBBQ1RJT05fRVhDRVBUSU9OOgogICAgICAgICAgICAgICAgdGhyb3dF\neGNlcHRpb24oc20sIGZtZCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBn\naXZlbiBpbnN0YW5jZSBmcm9tIHRoZSBjb2xsZWN0aW9uLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCByZW1vdmVGcm9tQ29sbGVjdGlvbihPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kLAog\nICAgICAgIE9iamVjdCB2YWwpIHsKICAgICAgICBDb2xsZWN0aW9uIGNvbGwg\nPSAoQ29sbGVjdGlvbikgc20uZmV0Y2hPYmplY3RGaWVsZChmbWQuZ2V0SW5k\nZXgoKSk7CiAgICAgICAgaWYgKGNvbGwgIT0gbnVsbCkgewogICAgICAgICAg\nICBzd2l0Y2ggKF9hY3Rpb24pIHsKICAgICAgICAgICAgICAgIGNhc2UgQUNU\nSU9OX01BTkFHRToKICAgICAgICAgICAgICAgICAgICByZW1vdmU6CiAgICAg\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNvbGwucmVtb3ZlKHZh\nbCk7IGkrKykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0gMCAm\nJiBjb2xsIGluc3RhbmNlb2YgU2V0KQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWsgcmVtb3ZlOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBBQ1RJT05fV0FSTjoKICAgICAgICAg\nICAgICAgICAgICBpZiAoY29sbC5jb250YWlucyh2YWwpKQogICAgICAgICAg\nICAgICAgICAgICAgICB3YXJuQ29uc2lzdGVuY3koc20sIGZtZCk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFD\nVElPTl9FWENFUFRJT046CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGwu\nY29udGFpbnModmFsKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dF\neGNlcHRpb24oc20sIGZtZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUg\nZ2l2ZW4gdmFsdWUgdG8gdGhlIGNvbGxlY3Rpb24gYXQgdGhlIHNlbGVjdGVk\nIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRUb0NvbGxl\nY3Rpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgRmllbGRNZXRhRGF0YSBm\nbWQsCiAgICAgICAgT2JqZWN0IHZhbCkgewogICAgICAgIENvbGxlY3Rpb24g\nY29sbCA9IChDb2xsZWN0aW9uKSBzbS5mZXRjaE9iamVjdEZpZWxkKGZtZC5n\nZXRJbmRleCgpKTsKICAgICAgICBpZiAoY29sbCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIGNvbGwgPSAoQ29sbGVjdGlvbikgc20ubmV3RmllbGRQcm94eShm\nbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgIHNtLnN0b3JlT2JqZWN0Rmll\nbGQoZm1kLmdldEluZGV4KCksIGNvbGwpOwogICAgICAgIH0KICAgICAgICBp\nZiAoIWNvbGwuY29udGFpbnModmFsKSkgewogICAgICAgICAgICBzd2l0Y2gg\nKF9hY3Rpb24pIHsKICAgICAgICAgICAgICAgIGNhc2UgQUNUSU9OX01BTkFH\nRToKICAgICAgICAgICAgICAgICAgICBjb2xsLmFkZCh2YWwpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBQ1RJ\nT05fV0FSTjoKICAgICAgICAgICAgICAgICAgICB3YXJuQ29uc2lzdGVuY3ko\nc20sIGZtZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIEFDVElPTl9FWENFUFRJT046CiAgICAgICAgICAgICAg\nICAgICAgdGhyb3dFeGNlcHRpb24oc20sIGZtZCk7CiAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIExvZyBhbiBpbmNvbnNpc3RlbmN5IHdh\ncm5pbmcKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgd2FybkNvbnNpc3Rl\nbmN5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAg\nICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImludmVyc2UtY29uc2lzdGVuY3ki\nLCBmbWQsIHNtLmdldElkKCksCiAgICAgICAgICAgICAgICBzbS5nZXRDb250\nZXh0KCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGFuIGluY29u\nc2lzdGVuY3kgZXhjZXB0aW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIHRocm93RXhjZXB0aW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgiaW52ZXJzZS1jb25zaXN0ZW5jeSIsCiAg\nICAgICAgICAgIGZtZCwgc20uZ2V0SWQoKSwgc20uZ2V0Q29udGV4dCgpKSku\nc2V0RmFpbGVkT2JqZWN0CiAgICAgICAgICAgIChzbS5nZXRNYW5hZ2VkSW5z\ndGFuY2UoKSkuc2V0RmF0YWwodHJ1ZSk7Cgl9Cn0K\n","encoding":"base64"}

