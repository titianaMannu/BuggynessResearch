{"sha":"d8463b06d47e7c9fbce4f9c68351514c9fcda31c","node_id":"MDQ6QmxvYjIwNjM2NDpkODQ2M2IwNmQ0N2U3YzlmYmNlNGY5YzY4MzUxNTE0YzlmY2RhMzFj","size":68718,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d8463b06d47e7c9fbce4f9c68351514c9fcda31c","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0SXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmxhbmcuT2JqZWN0VXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkFnZ3JlZ2F0ZUxp\nc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBz\nLkNvbnN0YW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5l\neHBzLkZpbHRlckxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5y\nb3AuRWFnZXJSZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5yb3AuTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SYW5nZVJlc3VsdE9iamVjdFBy\nb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVz\ndWx0TGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJl\nc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5SZWZlcmVuY2VIYXNoU2V0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLmNvbmN1cnJlbnQuUmVlbnRyYW50TG9jazsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0\nb3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFs\naWRTdGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAq\nIEltcGxlbWVudGF0aW9uIG9mIHRoZSB7QGxpbmsgUXVlcnl9IGludGVyZmFj\nZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFF1ZXJ5SW1wbAogICAgaW1wbGVtZW50cyBRdWVyeSB7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZShRdWVyeUltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUg\nZmluYWwgU3RyaW5nIF9sYW5ndWFnZTsKICAgIHByaXZhdGUgZmluYWwgU3Rv\ncmVRdWVyeSBfc3RvcmVRdWVyeTsKICAgIHByaXZhdGUgdHJhbnNpZW50IGZp\nbmFsIEJyb2tlckltcGwgX2Jyb2tlcjsKICAgIHByaXZhdGUgdHJhbnNpZW50\nIGZpbmFsIExvZyBfbG9nOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NM\nb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAgLy8gcXVlcnkgaGFzIGl0cyBv\nd24gaW50ZXJuYWwgbG9jawogICAgcHJpdmF0ZSBmaW5hbCBSZWVudHJhbnRM\nb2NrIF9sb2NrID0gbmV3IFJlZW50cmFudExvY2soKTsKCiAgICAvLyB1bnBh\ncnNlZCBzdGF0ZQogICAgcHJpdmF0ZSBDbGFzcyBfY2xhc3MgPSBudWxsOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9zdWJjbGFzc2VzID0gdHJ1ZTsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfcmVhZE9ubHkgPSBmYWxzZTsKICAgIHByaXZhdGUg\nU3RyaW5nIF9xdWVyeSA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfcGFy\nYW1zID0gbnVsbDsKCiAgICAvLyBwYXJzZWQgc3RhdGUKICAgIHByaXZhdGUg\ndHJhbnNpZW50IENvbXBpbGF0aW9uIF9jb21waWxlZCA9IG51bGw7CiAgICBw\ncml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9jb21waWxpbmcgPSBmYWxzZTsK\nICAgIHByaXZhdGUgdHJhbnNpZW50IFJlc3VsdFBhY2tlciBfcGFja2VyID0g\nbnVsbDsKCiAgICAvLyBjYW5kaWRhdGVzCiAgICBwcml2YXRlIHRyYW5zaWVu\ndCBDb2xsZWN0aW9uIF9jb2xsZWN0aW9uID0gbnVsbDsKICAgIHByaXZhdGUg\ndHJhbnNpZW50IEV4dGVudCBfZXh0ZW50ID0gbnVsbDsKCiAgICAvLyBsaXN0\nZW5lcnMKICAgIHByaXZhdGUgTWFwIF9maWx0TGlzdGVuZXJzID0gbnVsbDsK\nICAgIHByaXZhdGUgTWFwIF9hZ2dMaXN0ZW5lcnMgPSBudWxsOwoKICAgIC8v\nIGNvbmZpZ3VyYXRpb24gZm9yIGxvYWRpbmcgb2JqZWN0cwogICAgcHJpdmF0\nZSBGZXRjaENvbmZpZ3VyYXRpb24gX2ZjID0gbnVsbDsKICAgIHByaXZhdGUg\nYm9vbGVhbiBfaWdub3JlQ2hhbmdlcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBD\nbGFzcyBfcmVzdWx0TWFwcGluZ1Njb3BlID0gbnVsbDsKICAgIHByaXZhdGUg\nU3RyaW5nIF9yZXN1bHRNYXBwaW5nTmFtZSA9IG51bGw7CgogICAgLy8gdGhl\nc2UgZmllbGRzIHNob3VsZCBvbmx5IGJlIHVzZWQgZGlyZWN0bHkgYWZ0ZXIg\nd2UgaGF2ZSBhIGNvbXBpbGF0aW9uLAogICAgLy8gYmVjYXVzZSB0aGVpciB2\nYWx1ZXMgbWF5IGJlIGVuY29kZWQgaW4gdGhlIHF1ZXJ5IHN0cmluZwogICAg\ncHJpdmF0ZSBCb29sZWFuIF91bmlxdWUgPSBudWxsOwogICAgcHJpdmF0ZSBD\nbGFzcyBfcmVzdWx0Q2xhc3MgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2ll\nbnQgbG9uZyBfc3RhcnRJZHggPSAwOwogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nbG9uZyBfZW5kSWR4ID0gTG9uZy5NQVhfVkFMVUU7CiAgICBwcml2YXRlIHRy\nYW5zaWVudCBib29sZWFuIF9yYW5nZVNldCA9IGZhbHNlOwoKICAgIC8vIHJl\nbWVtYmVyIHRoZSBsaXN0IG9mIGFsbCB0aGUgcmVzdWx0cyB3ZSBoYXZlIHJl\ndHVybmVkIHNvIHdlCiAgICAvLyBjYW4gZnJlZSB0aGVpciByZXNvdXJjZXMg\nd2hlbiBjbG9zZSBvciBjbG9zZUFsbCBpcyBjYWxsZWQKICAgIHByaXZhdGUg\ndHJhbnNpZW50IGZpbmFsIENvbGxlY3Rpb24gX3Jlc3VsdExpc3RzID0gbmV3\nIFJlZmVyZW5jZUhhc2hTZXQKICAgICAgICAoUmVmZXJlbmNlSGFzaFNldC5X\nRUFLKTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHF1ZXJ5IG1hbmFn\nZWQgYnkgdGhlIGdpdmVuIGJyb2tlci4KICAgICAqLwogICAgcHVibGljIFF1\nZXJ5SW1wbChCcm9rZXIgYnJva2VyLCBTdHJpbmcgbGFuZ3VhZ2UsIFN0b3Jl\nUXVlcnkgc3RvcmVRdWVyeSkgewogICAgICAgIF9icm9rZXIgPSAoQnJva2Vy\nSW1wbCkgYnJva2VyOwogICAgICAgIF9sYW5ndWFnZSA9IGxhbmd1YWdlOwog\nICAgICAgIF9zdG9yZVF1ZXJ5ID0gc3RvcmVRdWVyeTsKICAgICAgICBfZmMg\nPSAoRmV0Y2hDb25maWd1cmF0aW9uKSBicm9rZXIuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCkuY2xvbmUoKTsKICAgICAgICBfbG9nID0gYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKS5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9H\nX1FVRVJZKTsKICAgICAgICBfc3RvcmVRdWVyeS5zZXRDb250ZXh0KHRoaXMp\nOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmUgcXVlcnku\nCiAgICAgKi8KICAgIHB1YmxpYyBTdG9yZVF1ZXJ5IGdldFN0b3JlUXVlcnko\nKSB7CiAgICAgICAgcmV0dXJuIF9zdG9yZVF1ZXJ5OwogICAgfQoKICAgIHB1\nYmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiBfYnJv\na2VyOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeSBnZXRRdWVyeSgpIHsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVDb250\nZXh0IGdldFN0b3JlQ29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2Jyb2tl\ncjsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldExhbmd1YWdlKCkgewog\nICAgICAgIHJldHVybiBfbGFuZ3VhZ2U7CiAgICB9CgogICAgcHVibGljIEZl\ndGNoQ29uZmlndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgcmV0dXJuIF9mYzsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFF1ZXJ5U3RyaW5nKCkgewogICAgICAgIHJldHVybiBfcXVlcnk7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsKICAg\nICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9pZ25vcmVDaGFu\nZ2VzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldElnbm9yZUNoYW5nZXMo\nYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgLy8gYWxs\nb3dlZCBtb2RpZmljYXRpb246IG5vIHJlYWQtb25seSBjaGVjawogICAgICAg\nICAgICBfaWdub3JlQ2hhbmdlcyA9IGZsYWc7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzUmVhZE9ubHkoKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIHJldHVybiBfcmVhZE9ubHk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0UmVhZE9ubHkoYm9vbGVhbiBmbGFnKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0gZmxhZzsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYWRkRmlsdGVyTGlzdGVuZXIoRmlsdGVy\nTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBh\nc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2ZpbHRMaXN0\nZW5lcnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9maWx0TGlzdGVuZXJz\nID0gbmV3IEhhc2hNYXAoNSk7CiAgICAgICAgICAgIF9maWx0TGlzdGVuZXJz\nLnB1dChsaXN0ZW5lci5nZXRUYWcoKSwgbGlzdGVuZXIpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVGaWx0ZXJMaXN0ZW5lcihGaWx0\nZXJMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAg\nIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIGlmIChfZmlsdExp\nc3RlbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2ZpbHRMaXN0ZW5l\ncnMucmVtb3ZlKGxpc3RlbmVyLmdldFRhZygpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIENvbGxlY3Rpb24gZ2V0RmlsdGVyTGlzdGVuZXJzKCkgewog\nICAgICAgIHJldHVybiAoX2ZpbHRMaXN0ZW5lcnMgPT0gbnVsbCkgPyBDb2xs\nZWN0aW9ucy5FTVBUWV9MSVNUCiAgICAgICAgICAgIDogX2ZpbHRMaXN0ZW5l\ncnMudmFsdWVzKCk7CiAgICB9CgogICAgcHVibGljIEZpbHRlckxpc3RlbmVy\nIGdldEZpbHRlckxpc3RlbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICAvLyBm\naXJzdCBjaGVjayBsaXN0ZW5lcnMgZm9yIHRoaXMgcXVlcnkKICAgICAgICBp\nZiAoX2ZpbHRMaXN0ZW5lcnMgIT0gbnVsbCkgewogICAgICAgICAgICBGaWx0\nZXJMaXN0ZW5lciBsaXN0ZW4gPSAoRmlsdGVyTGlzdGVuZXIpIF9maWx0TGlz\ndGVuZXJzLmdldCh0YWcpOwogICAgICAgICAgICBpZiAobGlzdGVuICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdGVuOwogICAgICAgIH0K\nCiAgICAgICAgLy8gY2hlY2sgdXNlci1kZWZpbmVkIGxpc3RlbmVycyBmcm9t\nIGNvbmZpZ3VyYXRpb24KICAgICAgICBGaWx0ZXJMaXN0ZW5lcltdIGNvbmZM\naXN0ZW5lcnMgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAg\nICAgICAgZ2V0RmlsdGVyTGlzdGVuZXJJbnN0YW5jZXMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbmZMaXN0ZW5lcnMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmIChjb25mTGlzdGVuZXJzW2ldLmdldFRhZygpLmVx\ndWFscyh0YWcpKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZMaXN0ZW5l\ncnNbaV07CgogICAgICAgIC8vIGNoZWNrIHN0b3JlIGxpc3RlbmVycwogICAg\nICAgIHJldHVybiBfc3RvcmVRdWVyeS5nZXRGaWx0ZXJMaXN0ZW5lcih0YWcp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZEFnZ3JlZ2F0ZUxpc3RlbmVy\nKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgaWYg\nKF9hZ2dMaXN0ZW5lcnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hZ2dM\naXN0ZW5lcnMgPSBuZXcgSGFzaE1hcCg1KTsKICAgICAgICAgICAgX2FnZ0xp\nc3RlbmVycy5wdXQobGlzdGVuZXIuZ2V0VGFnKCksIGxpc3RlbmVyKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlQWdncmVnYXRlTGlz\ndGVuZXIoQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3Blbigp\nOwogICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAg\nICBpZiAoX2FnZ0xpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2FnZ0xpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIuZ2V0VGFnKCkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRBZ2dyZWdhdGVM\naXN0ZW5lcnMoKSB7CiAgICAgICAgcmV0dXJuIChfYWdnTGlzdGVuZXJzID09\nIG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVAogICAgICAgICAgICA6\nIF9hZ2dMaXN0ZW5lcnMudmFsdWVzKCk7CiAgICB9CgogICAgcHVibGljIEFn\nZ3JlZ2F0ZUxpc3RlbmVyIGdldEFnZ3JlZ2F0ZUxpc3RlbmVyKFN0cmluZyB0\nYWcpIHsKICAgICAgICAvLyBmaXJzdCBjaGVjayBsaXN0ZW5lcnMgZm9yIHRo\naXMgcXVlcnkKICAgICAgICBpZiAoX2FnZ0xpc3RlbmVycyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbiA9IChBZ2dy\nZWdhdGVMaXN0ZW5lcikgX2FnZ0xpc3RlbmVycy4KICAgICAgICAgICAgICAg\nIGdldCh0YWcpOwogICAgICAgICAgICBpZiAobGlzdGVuICE9IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbGlzdGVuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gY2hlY2sgdXNlci1kZWZpbmVkIGxpc3RlbmVycyBmcm9tIGNvbmZp\nZ3VyYXRpb24KICAgICAgICBBZ2dyZWdhdGVMaXN0ZW5lcltdIGNvbmZMaXN0\nZW5lcnMgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAg\nICAgZ2V0QWdncmVnYXRlTGlzdGVuZXJJbnN0YW5jZXMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNvbmZMaXN0ZW5lcnMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGlmIChjb25mTGlzdGVuZXJzW2ldLmdldFRhZygpLmVx\ndWFscyh0YWcpKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZMaXN0ZW5l\ncnNbaV07CgogICAgICAgIC8vIGNoZWNrIHN0b3JlIGxpc3RlbmVycwogICAg\nICAgIHJldHVybiBfc3RvcmVRdWVyeS5nZXRBZ2dyZWdhdGVMaXN0ZW5lcih0\nYWcpOwogICAgfQoKICAgIHB1YmxpYyBFeHRlbnQgZ2V0Q2FuZGlkYXRlRXh0\nZW50KCkgewogICAgICAgIC8vIGlmIGp1c3QgdGhlIGNsYXNzIGlzIHNldCwg\nZmV0Y2ggdGhlIGNvcnJlc3BvbmRpbmcgZXh0ZW50OyBpZiB0aGUKICAgICAg\nICAvLyBleHRlbnQgaXMgYWxyZWFkeSBzZXQgYnV0IGl0cyBpZ25vcmUgY2Fj\naGUgc2V0dGluZyBpcyB3cm9uZywKICAgICAgICAvLyBnZXQgYSBuZXcgZXh0\nZW50IHdpdGggdGhlIGNvcnJlY3Qgc2V0dGluZyAoZG9uJ3QgbW9kaWZ5IG9y\naWcgZXh0ZW50CiAgICAgICAgLy8gaW4gY2FzZSB0aGUgdXNlciBoYXMgYSBy\nZWZlcmVuY2UgdG8gaXQgYW5kIG1pZ2h0IHVzZSBpdCkKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3MgY2xzID0gZ2V0\nQ2FuZGlkYXRlVHlwZSgpOwogICAgICAgICAgICBpZiAoX2V4dGVudCA9PSBu\ndWxsICYmIF9jb2xsZWN0aW9uID09IG51bGwgJiYgX2Jyb2tlciAhPSBudWxs\nCiAgICAgICAgICAgICAgICAmJiBjbHMgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgX2V4dGVudCA9IF9icm9rZXIubmV3RXh0ZW50KGNscywgX3N1YmNs\nYXNzZXMpOwogICAgICAgICAgICAgICAgX2V4dGVudC5zZXRJZ25vcmVDaGFu\nZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChf\nZXh0ZW50ICE9IG51bGwKICAgICAgICAgICAgICAgICYmIF9leHRlbnQuZ2V0\nSWdub3JlQ2hhbmdlcygpICE9IF9pZ25vcmVDaGFuZ2VzICYmIGNscyAhPSBu\ndWxsKXsKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBfYnJva2VyLm5ld0V4\ndGVudChjbHMsIF9leHRlbnQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAg\nICAgICAgIF9leHRlbnQuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hhbmdl\ncyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9leHRlbnQ7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbmRpZGF0ZUV4\ndGVudChFeHRlbnQgY2FuZGlkYXRlRXh0ZW50KSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKCiAgICAgICAgICAgIGlm\nIChjYW5kaWRhdGVFeHRlbnQgPT0gX2V4dGVudCkKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZUV4dGVudCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gbnVsbDsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaWYgZXh0ZW50IHRoZW4gbm90IGNvbGxlY3Rpb24KICAgICAgICAgICAg\nX2V4dGVudCA9IGNhbmRpZGF0ZUV4dGVudDsKICAgICAgICAgICAgX2NvbGxl\nY3Rpb24gPSBudWxsOwoKICAgICAgICAgICAgYm9vbGVhbiBpbnZhbGlkYXRl\nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChfZXh0ZW50LmdldEVsZW1lbnRU\neXBlKCkgIT0gX2NsYXNzKSB7CiAgICAgICAgICAgICAgICBfY2xhc3MgPSBf\nZXh0ZW50LmdldEVsZW1lbnRUeXBlKCk7CiAgICAgICAgICAgICAgICBfbG9h\nZGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIGludmFsaWRhdGUgPSB0cnVl\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfZXh0ZW50Lmhhc1N1\nYmNsYXNzZXMoKSAhPSBfc3ViY2xhc3NlcykgewogICAgICAgICAgICAgICAg\nX3N1YmNsYXNzZXMgPSBfZXh0ZW50Lmhhc1N1YmNsYXNzZXMoKTsKICAgICAg\nICAgICAgICAgIGludmFsaWRhdGUgPSB0cnVlOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChpbnZhbGlkYXRlKQogICAgICAgICAgICAgICAgaW52\nYWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uIGdldENhbmRpZGF0ZUNvbGxlY3Rpb24oKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBfY29sbGVjdGlvbjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDYW5kaWRhdGVDb2xsZWN0aW9u\nKENvbGxlY3Rpb24gY2FuZGlkYXRlQ29sbGVjdGlvbikgewogICAgICAgIGlm\nICghX3N0b3JlUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xv\nYy5nZXQoInF1ZXJ5LW5vc3VwcG9ydCIsCiAgICAgICAgICAgICAgICBfbGFu\nZ3VhZ2UpKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAgICAgIC8vIGlmIGNvbGxl\nY3Rpb24gdGhlbiBub3QgZXh0ZW50CiAgICAgICAgICAgIF9jb2xsZWN0aW9u\nID0gY2FuZGlkYXRlQ29sbGVjdGlvbjsKICAgICAgICAgICAgaWYgKF9jb2xs\nZWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gbnVs\nbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNzIGdldENhbmRpZGF0\nZVR5cGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgaWYgKF9jbGFzcyAh\nPSBudWxsIHx8IF9jb21waWxlZCAhPSBudWxsIHx8IF9xdWVyeSA9PSBudWxs\nCiAgICAgICAgICAgICAgICB8fCBfYnJva2VyID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gX2NsYXNzOwoKICAgICAgICAgICAgLy8gY2hlY2sg\nYWdhaW4gYWZ0ZXIgY29tcGlsYXRpb247IG1heWJlIGVuY29kZWQgaW4gc3Ry\naW5nCiAgICAgICAgICAgIGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAg\nICAgICAgICByZXR1cm4gX2NsYXNzOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRDYW5kaWRhdGVUeXBlKENsYXNzIGNhbmRpZGF0ZUNsYXNz\nLCBib29sZWFuIHN1YnMpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3Nl\ncnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBfY2xhc3MgPSBjYW5kaWRh\ndGVDbGFzczsKICAgICAgICAgICAgX3N1YmNsYXNzZXMgPSBzdWJzOwogICAg\nICAgICAgICBfbG9hZGVyID0gbnVsbDsKICAgICAgICAgICAgaW52YWxpZGF0\nZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGhhc1N1YmNsYXNzZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJjbGFz\nc2VzOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVzdWx0TWFwcGlu\nZ05hbWUoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVy\nbiBfcmVzdWx0TWFwcGluZ05hbWU7CiAgICB9CgogICAgcHVibGljIENsYXNz\nIGdldFJlc3VsdE1hcHBpbmdTY29wZSgpIHsKICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgcmV0dXJuIF9yZXN1bHRNYXBwaW5nU2NvcGU7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UmVzdWx0TWFwcGluZyhDbGFzcyBzY29w\nZSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBfcmVz\ndWx0TWFwcGluZ1Njb3BlID0gc2NvcGU7CiAgICAgICAgICAgIF9yZXN1bHRN\nYXBwaW5nTmFtZSA9IG5hbWU7CiAgICAgICAgICAgIF9wYWNrZXIgPSBudWxs\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1VuaXF1ZSgp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBpZiAoX3VuaXF1ZSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIF91bmlxdWUuYm9vbGVhblZhbHVl\nKCk7CiAgICAgICAgICAgIGlmIChfcXVlcnkgPT0gbnVsbCB8fCBfY29tcGls\naW5nIHx8IF9icm9rZXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGFnYWluIGFmdGVyIGNv\nbXBpbGF0aW9uOyBtYXliZSBlbmNvZGVkIGluIHN0cmluZwogICAgICAgICAg\nICBpZiAoX2NvbXBpbGVkID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNv\nbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKF91\nbmlxdWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3Vu\naXF1ZS5ib29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gbm8gZXhwbGljaXQgc2V0dGluZzsgZGVmYXVsdAogICAgICAgICAg\nICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gY29tcGlsZUZvckV4ZWN1dG9y\nKCk7CiAgICAgICAgICAgIGlmICghZXguaXNBZ2dyZWdhdGUoX3N0b3JlUXVl\ncnkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAg\nICByZXR1cm4gIWV4Lmhhc0dyb3VwaW5nKF9zdG9yZVF1ZXJ5KTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VW5pcXVlKGJvb2xlYW4gdW5p\ncXVlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9u\nbHkoKTsKICAgICAgICAgICAgX3VuaXF1ZSA9ICh1bmlxdWUpID8gQm9vbGVh\nbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENsYXNzIGdldFJlc3VsdFR5cGUoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgaWYgKF9yZXN1bHRDbGFzcyAhPSBudWxsIHx8IF9jb21waWxlZCAh\nPSBudWxsIHx8IF9xdWVyeSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBf\nYnJva2VyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX3Jlc3Vs\ndENsYXNzOwoKICAgICAgICAgICAgLy8gY2hlY2sgYWdhaW4gYWZ0ZXIgY29t\ncGlsYXRpb247IG1heWJlIGVuY29kZWQgaW4gc3RyaW5nCiAgICAgICAgICAg\nIGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICByZXR1cm4g\nX3Jlc3VsdENsYXNzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRSZXN1bHRUeXBlKENsYXNzIGNscykgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nICAgIC8vIGFsbG93ZWQgbW9kaWZpY2F0aW9uOiBubyByZWFkLW9ubHkgY2hl\nY2sKICAgICAgICAgICAgX3Jlc3VsdENsYXNzID0gY2xzOwogICAgICAgICAg\nICBfcGFja2VyID0gbnVsbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxv\nbmcgZ2V0U3RhcnRSYW5nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgcmV0dXJuIF9zdGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9u\nZyBnZXRFbmRSYW5nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgcmV0dXJuIF9lbmRJZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nUmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBpZiAoc3Rh\ncnQgPCAwIHx8IGVuZCA8IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLXJhbmdlIiwKICAgICAgICAg\nICAgICAgIFN0cmluZy52YWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZhbHVlT2Yo\nZW5kKSkpOwoKICAgICAgICBpZiAoZW5kIC0gc3RhcnQgPiBJbnRlZ2VyLk1B\nWF9WQUxVRSAmJiBlbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJyYW5nZS10b28t\nYmlnIiwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKHN0YXJ0KSwg\nU3RyaW5nLnZhbHVlT2YoZW5kKSkpOwoKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAg\nICAvLyBhbGxvd2VkIG1vZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5IGNoZWNr\nCiAgICAgICAgICAgIF9zdGFydElkeCA9IHN0YXJ0OwogICAgICAgICAgICBf\nZW5kSWR4ID0gZW5kOwogICAgICAgICAgICBfcmFuZ2VTZXQgPSB0cnVlOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFBhcmFtZXRlckRl\nY2xhcmF0aW9uKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfcGFy\nYW1zICE9IG51bGwgfHwgX2NvbXBpbGVkICE9IG51bGwgfHwgX2NvbXBpbGlu\nZwogICAgICAgICAgICAgICAgfHwgX2Jyb2tlciA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIF9wYXJhbXM7CgogICAgICAgICAgICAvLyBjaGVj\nayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBz\ndHJpbmcKICAgICAgICAgICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAg\nICAgICAgICAgIHJldHVybiBfcGFyYW1zOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBkZWNsYXJlUGFyYW1ldGVycyhTdHJpbmcgcGFyYW1zKSB7\nCiAgICAgICAgaWYgKCFfc3RvcmVRdWVyeS5zdXBwb3J0c1BhcmFtZXRlckRl\nY2xhcmF0aW9ucygpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQoInF1ZXJ5LW5vc3VwcG9ydCIsCiAgICAg\nICAgICAgICAgICBfbGFuZ3VhZ2UpKTsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAg\nICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgX3BhcmFtcyA9\nIFN0cmluZ1V0aWxzLnRyaW1Ub051bGwocGFyYW1zKTsKICAgICAgICAgICAg\naW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGNvbXBpbGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAg\nU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigp\nOwogICAgICAgICAgICBnZXRSZXN1bHRQYWNrZXIoZXgpOwogICAgICAgICAg\nICBleC52YWxpZGF0ZShfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZ2V0Q29tcGlsYXRpb24oKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjb21waWxl\nRm9yQ29tcGlsYXRpb24oKS5zdG9yZURhdGE7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQ29tcGlsZSBxdWVyeSBwcm9wZXJ0aWVzLgogICAgICov\nCiAgICBwcml2YXRlIENvbXBpbGF0aW9uIGNvbXBpbGVGb3JDb21waWxhdGlv\nbigpIHsKICAgICAgICBpZiAoX2NvbXBpbGVkICE9IG51bGwgfHwgX2NvbXBp\nbGluZykKICAgICAgICAgICAgcmV0dXJuIF9jb21waWxlZDsKCiAgICAgICAg\nYXNzZXJ0Tm90U2VyaWFsaXplZCgpOwogICAgICAgIGFzc2VydE9wZW4oKTsK\nCiAgICAgICAgYm9vbGVhbiByZWFkT25seSA9IF9yZWFkT25seTsKICAgICAg\nICBfcmVhZE9ubHkgPSBmYWxzZTsKICAgICAgICBfY29tcGlsaW5nID0gdHJ1\nZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfY29tcGlsZWQgPSBjb21w\naWxhdGlvbkZyb21DYWNoZSgpOwogICAgICAgICAgICByZXR1cm4gX2NvbXBp\nbGVkOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgX2NvbXBpbGluZyA9IGZhbHNlOwogICAgICAgICAgICBfcmVhZE9ubHkg\nPSByZWFkT25seTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBG\naW5kIHRoZSBjYWNoZWQgY29tcGlsYXRpb24gZm9yIHRoZSBjdXJyZW50IHF1\nZXJ5LCBjcmVhdGluZyBvbmUgaWYgaXQKICAgICAqIGRvZXMgbm90IGV4aXN0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29tcGlsYXRpb24gY29tcGlsYXRp\nb25Gcm9tQ2FjaGUoKSB7CiAgICAgICAgTWFwIGNvbXBDYWNoZSA9CiAgICAg\nICAgICAgIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldFF1ZXJ5Q29t\ncGlsYXRpb25DYWNoZUluc3RhbmNlKCk7CiAgICAgICAgaWYgKGNvbXBDYWNo\nZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBuZXdDb21waWxhdGlv\nbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENvbXBpbGF0aW9u\nS2V5IGtleSA9IG5ldyBDb21waWxhdGlvbktleSgpOwogICAgICAgICAgICBr\nZXkucXVlcnlUeXBlID0gX3N0b3JlUXVlcnkuZ2V0Q2xhc3MoKTsKICAgICAg\nICAgICAga2V5LmNhbmRpZGF0ZVR5cGUgPSBnZXRDYW5kaWRhdGVUeXBlKCk7\nCiAgICAgICAgICAgIGtleS5zdWJjbGFzc2VzID0gaGFzU3ViY2xhc3Nlcygp\nOwogICAgICAgICAgICBrZXkucXVlcnkgPSBnZXRRdWVyeVN0cmluZygpOwog\nICAgICAgICAgICBrZXkubGFuZ3VhZ2UgPSBnZXRMYW5ndWFnZSgpOwogICAg\nICAgICAgICBrZXkuc3RvcmVLZXkgPSBfc3RvcmVRdWVyeS5uZXdDb21waWxh\ndGlvbktleSgpOwogICAgICAgICAgICBDb21waWxhdGlvbiBjb21wID0gKENv\nbXBpbGF0aW9uKSBjb21wQ2FjaGUuZ2V0KGtleSk7CgogICAgICAgICAgICAv\nLyBwYXJzZSBkZWNsYXJhdGlvbnMgaWYgbmVlZGVkCiAgICAgICAgICAgIGJv\nb2xlYW4gY2FjaGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGNvbXAgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgY29tcCA9IG5ld0NvbXBpbGF0aW9u\nKCk7CiAgICAgICAgICAgICAgICAvLyBvbmx5IGNhY2hlIHRob3NlIHF1ZXJp\nZXMgdGhhdCBjYW4gYmUgY29tcGlsZWQKICAgICAgICAgICAgICAgIGNhY2hl\nID0gY29tcC5zdG9yZURhdGEgIT0gbnVsbDsKICAgICAgICAgICAgfSBlbHNl\nCiAgICAgICAgICAgICAgICBfc3RvcmVRdWVyeS5wb3B1bGF0ZUZyb21Db21w\naWxhdGlvbihjb21wLnN0b3JlRGF0YSk7CgogICAgICAgICAgICAvLyBjYWNo\nZSBwYXJzZWQgc3RhdGUgaWYgbmVlZGVkCiAgICAgICAgICAgIGlmIChjYWNo\nZSkKICAgICAgICAgICAgICAgIGNvbXBDYWNoZS5wdXQoa2V5LCBjb21wKTsK\nICAgICAgICAgICAgcmV0dXJuIGNvbXA7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUgYSBuZXcgY29t\ncGlsYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgQ29tcGlsYXRpb24gbmV3\nQ29tcGlsYXRpb24oKSB7CiAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9IG5l\ndyBDb21waWxhdGlvbigpOwogICAgICAgIGNvbXAuc3RvcmVEYXRhID0gX3N0\nb3JlUXVlcnkubmV3Q29tcGlsYXRpb24oKTsKICAgICAgICBfc3RvcmVRdWVy\neS5wb3B1bGF0ZUZyb21Db21waWxhdGlvbihjb21wLnN0b3JlRGF0YSk7CiAg\nICAgICAgcmV0dXJuIGNvbXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21w\naWxlIGZvciBleGVjdXRpb24sIGNob29zaW5nIGJldHdlZW4gZGF0YXN0b3Jl\nIGFuZCBpbi1tZW0KICAgICAqIGNvbXBpbGF0aW9uIGJhc2VkIG9uIHdoYXQg\nd2Ugc3VwcG9ydCBhbmQgb3VyIHNldHRpbmdzLgogICAgICovCiAgICBwcml2\nYXRlIFN0b3JlUXVlcnkuRXhlY3V0b3IgY29tcGlsZUZvckV4ZWN1dG9yKCkg\newogICAgICAgIENvbXBpbGF0aW9uIGNvbXAgPSBjb21waWxlRm9yQ29tcGls\nYXRpb24oKTsKICAgICAgICBpZiAoX2NvbGxlY3Rpb24gPT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAoY29tcC5kYXRhc3RvcmUgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBjb21wLmRhdGFzdG9yZTsKICAgICAgICAgICAg\naWYgKGNvbXAubWVtb3J5ICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm4gY29tcC5tZW1vcnk7CiAgICAgICAgICAgIGlmIChfc3RvcmVRdWVyeS5z\ndXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGNvbXBpbGVGb3JEYXRhU3RvcmUoY29tcCk7CiAgICAgICAgICAg\nIHJldHVybiBjb21waWxlRm9ySW5NZW1vcnkoY29tcCk7CiAgICAgICAgfQoK\nICAgICAgICBpZiAoY29tcC5tZW1vcnkgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGNvbXAubWVtb3J5OwogICAgICAgIGlmIChjb21wLmRhdGFzdG9y\nZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gY29tcC5kYXRhc3RvcmU7\nCiAgICAgICAgaWYgKF9zdG9yZVF1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVj\ndXRpb24oKSkKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JJbk1lbW9y\neShjb21wKTsKICAgICAgICByZXR1cm4gY29tcGlsZUZvckRhdGFTdG9yZShj\nb21wKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiBleHByZXNz\naW9uIHRyZWUgZm9yIGRhdGFzdG9yZSBleGVjdXRpb24uCiAgICAgKi8KICAg\nIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRvciBjb21waWxlRm9yRGF0YVN0\nb3JlKENvbXBpbGF0aW9uIGNvbXApIHsKICAgICAgICBpZiAoY29tcC5kYXRh\nc3RvcmUgPT0gbnVsbCkKICAgICAgICAgICAgY29tcC5kYXRhc3RvcmUgPSBj\ncmVhdGVFeGVjdXRvcihmYWxzZSk7CiAgICAgICAgcmV0dXJuIGNvbXAuZGF0\nYXN0b3JlOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGV4cHJl\nc3Npb24gdHJlZSBmb3IgaW4tbWVtb3J5IGV4ZWN1dGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGNvbXBpbGVGb3JJbk1l\nbW9yeShDb21waWxhdGlvbiBjb21wKSB7CiAgICAgICAgaWYgKGNvbXAubWVt\nb3J5ID09IG51bGwpCiAgICAgICAgICAgIGNvbXAubWVtb3J5ID0gY3JlYXRl\nRXhlY3V0b3IodHJ1ZSk7CiAgICAgICAgcmV0dXJuIGNvbXAubWVtb3J5Owog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcXVlcnkgZXhlY3V0b3Ig\nb2YgdGhlIHByb3BlciB0eXBlLgogICAgICovCiAgICBwcml2YXRlIFN0b3Jl\nUXVlcnkuRXhlY3V0b3IgY3JlYXRlRXhlY3V0b3IoYm9vbGVhbiBpbk1lbSkg\newogICAgICAgIGFzc2VydENhbmRpZGF0ZVR5cGUoKTsKCiAgICAgICAgTWV0\nYURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2Jyb2tlci5nZXRDb25maWd1cmF0\naW9uKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVwb3MuZ2V0\nTWV0YURhdGEoX2NsYXNzLAogICAgICAgICAgICBfYnJva2VyLmdldENsYXNz\nTG9hZGVyKCksIGZhbHNlKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1l\ndGFzOwogICAgICAgIGlmIChfY2xhc3MgPT0gbnVsbCB8fCBfc3RvcmVRdWVy\neS5zdXBwb3J0c0Fic3RyYWN0RXhlY3V0b3JzKCkpCiAgICAgICAgICAgIG1l\ndGFzID0gbmV3IENsYXNzTWV0YURhdGFbXXsgbWV0YSB9OwogICAgICAgIGVs\nc2UgaWYgKF9zdWJjbGFzc2VzICYmIChtZXRhID09IG51bGwgfHwgbWV0YS5p\nc01hbmFnZWRJbnRlcmZhY2UoKSkpCiAgICAgICAgICAgIG1ldGFzID0gcmVw\nb3MuZ2V0SW1wbGVtZW50b3JNZXRhRGF0YXMoX2NsYXNzLAogICAgICAgICAg\nICAgICAgX2Jyb2tlci5nZXRDbGFzc0xvYWRlcigpLCB0cnVlKTsKICAgICAg\nICBlbHNlIGlmIChtZXRhICE9IG51bGwgJiYgKF9zdWJjbGFzc2VzIHx8IG1l\ndGEuaXNNYXBwZWQoKSkpCiAgICAgICAgICAgIG1ldGFzID0gbmV3IENsYXNz\nTWV0YURhdGFbXXsgbWV0YSB9OwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nbWV0YXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX01FVEFTOwoKICAgICAgICBpZiAo\nbWV0YXMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1pbXBscyIsIF9jbGFzcykpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChtZXRhcy5sZW5ndGggPT0gMSkg\newogICAgICAgICAgICAgICAgaWYgKGluTWVtKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBfc3RvcmVRdWVyeS5uZXdJbk1lbW9yeUV4ZWN1dG9yKG1l\ndGFzWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBfc3ViY2xhc3Nlcyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkubmV3RGF0YVN0\nb3JlRXhlY3V0b3IobWV0YXNbMF0sIF9zdWJjbGFzc2VzKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gbXVsdGlwbGUgaW1wbGVtZW50b3JzCiAg\nICAgICAgICAgIFN0b3JlUXVlcnkuRXhlY3V0b3JbXSBlcyA9IG5ldyBTdG9y\nZVF1ZXJ5LkV4ZWN1dG9yW21ldGFzLmxlbmd0aF07CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChpbk1lbSkKICAgICAgICAgICAgICAgICAgICBlc1tpXSA9\nIF9zdG9yZVF1ZXJ5Lm5ld0luTWVtb3J5RXhlY3V0b3IobWV0YXNbaV0sIHRy\ndWUpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIGVzW2ldID0gX3N0b3JlUXVlcnkubmV3RGF0YVN0b3JlRXhlY3V0b3IobWV0\nYXNbaV0sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgTWVyZ2VkRXhlY3V0b3IoZXMpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYW55IGNvbXBpbGF0aW9u\nLCBmb3JjaW5nIHRoaXMgcXVlcnkgdG8gYmUgcmVjb21waWxlZAogICAgICog\nbmV4dCB0aW1lIGl0J3MgZXhlY3V0ZWQuIFRoaXMgc2hvdWxkIGJlIGludm9r\nZWQgd2hlbmV2ZXIgYW55CiAgICAgKiBzdGF0ZSBjaGFuZ2VzIHRoYXQgd291\nbGQgY2F1c2UgdGhlIHVuZGVybHlpbmcgcXVlcnkKICAgICAqIHJlcHJlc2Vu\ndGF0aW9uIHRvIGNoYW5nZS4KICAgICAqCiAgICAgKiBAc2luY2UgMC4zLjAK\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGludmFsaWRhdGVDb21waWxh\ndGlvbigpIHsKICAgICAgICBpZiAoX2NvbXBpbGluZykKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIF9zdG9yZVF1ZXJ5LmludmFsaWRhdGVD\nb21waWxhdGlvbigpOwogICAgICAgIF9jb21waWxlZCA9IG51bGw7CiAgICAg\nICAgX3BhY2tlciA9IG51bGw7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBleGVjdXRlKCkgewogICAgICAgIHJldHVy\nbiBleGVjdXRlKChPYmplY3RbXSkgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBleGVjdXRlKE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJl\ndHVybiBleGVjdXRlKE9QX1NFTEVDVCwgcGFyYW1zKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGV4ZWN1dGUoTWFwIHBhcmFtcykgewogICAgICAgIHJl\ndHVybiBleGVjdXRlKE9QX1NFTEVDVCwgcGFyYW1zKTsKICAgIH0KCiAgICBw\ncml2YXRlIE9iamVjdCBleGVjdXRlKGludCBvcGVyYXRpb24sIE9iamVjdFtd\nIHBhcmFtcykgewogICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkKICAgICAg\nICAgICAgcGFyYW1zID0gU3RvcmVRdWVyeS5FTVBUWV9PQkpFQ1RTOwoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0\nTm90U2VyaWFsaXplZCgpOwogICAgICAgICAgICBfYnJva2VyLmJlZ2luT3Bl\ncmF0aW9uKHRydWUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAgICAgX2Jyb2tlci5hc3Nl\ncnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgICAgIC8v\nIGdldCBleGVjdXRvcgogICAgICAgICAgICAgICAgQ29tcGlsYXRpb24gY29t\ncCA9IGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICAgICAg\nU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IChpc0luTWVtb3J5KG9wZXJhdGlv\nbikpCiAgICAgICAgICAgICAgICAgICAgPyBjb21waWxlRm9ySW5NZW1vcnko\nY29tcCkgOiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXApOwoKICAgICAgICAg\nICAgICAgIGFzc2VydFBhcmFtZXRlcnMoZXgsIHBhcmFtcyk7CiAgICAgICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIGxvZ0V4ZWN1dGlvbihvcGVyYXRpb24sIGV4LmdldFBhcmFt\nZXRlclR5cGVzKF9zdG9yZVF1ZXJ5KSwKICAgICAgICAgICAgICAgICAgICAg\nICAgcGFyYW1zKTsKCiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09\nIE9QX1NFTEVDVCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhlY3V0\nZShleCwgcGFyYW1zKTsKICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24g\nPT0gT1BfREVMRVRFKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxl\ndGUoZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9u\nID09IE9QX1VQREFURSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBk\nYXRlKGV4LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBfYnJva2VyLmVuZE9w\nZXJhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSBPYmplY3QgZXhlY3V0ZShpbnQgb3BlcmF0aW9uLCBN\nYXAgcGFyYW1zKSB7CiAgICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKQogICAg\nICAgICAgICBwYXJhbXMgPSBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfYnJva2Vy\nLmJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgYXNzZXJ0Tm90U2VyaWFsaXplZCgpOwogICAgICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICAgICAgX2Jyb2tlci5h\nc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgICAg\nIC8vIGdldCBleGVjdXRvcgogICAgICAgICAgICAgICAgQ29tcGlsYXRpb24g\nY29tcCA9IGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICAg\nICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IChpc0luTWVtb3J5KG9wZXJh\ndGlvbikpCiAgICAgICAgICAgICAgICAgICAgPyBjb21waWxlRm9ySW5NZW1v\ncnkoY29tcCkgOiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXApOwoKICAgICAg\nICAgICAgICAgIE9iamVjdFtdIGFyciA9IChwYXJhbXMuaXNFbXB0eSgpKSA/\nIFN0b3JlUXVlcnkuRU1QVFlfT0JKRUNUUyA6CiAgICAgICAgICAgICAgICAg\nICAgdG9QYXJhbWV0ZXJBcnJheShleC5nZXRQYXJhbWV0ZXJUeXBlcyhfc3Rv\ncmVRdWVyeSksIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBhc3NlcnRQYXJh\nbWV0ZXJzKGV4LCBhcnIpOwogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2dFeGVjdXRp\nb24ob3BlcmF0aW9uLCBwYXJhbXMpOwoKICAgICAgICAgICAgICAgIGlmIChv\ncGVyYXRpb24gPT0gT1BfU0VMRUNUKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBleGVjdXRlKGV4LCBhcnIpOwogICAgICAgICAgICAgICAgaWYgKG9w\nZXJhdGlvbiA9PSBPUF9ERUxFVEUpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGRlbGV0ZShleCwgYXJyKTsKICAgICAgICAgICAgICAgIGlmIChvcGVy\nYXRpb24gPT0gT1BfVVBEQVRFKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB1cGRhdGUoZXgsIGFycik7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9icm9rZXIuZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxldGVBbGwoKSB7CiAgICAgICAgcmV0\ndXJuIGRlbGV0ZUFsbCgoT2JqZWN0W10pIG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBsb25nIGRlbGV0ZUFsbChPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICByZXR1cm4gKChOdW1iZXIpIGV4ZWN1dGUoT1BfREVMRVRFLCBwYXJhbXMp\nKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxldGVB\nbGwoTWFwIHBhcmFtcykgewogICAgICAgIHJldHVybiAoKE51bWJlcikgZXhl\nY3V0ZShPUF9ERUxFVEUsIHBhcmFtcykpLmxvbmdWYWx1ZSgpOwogICAgfQoK\nICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbCgpIHsKICAgICAgICByZXR1cm4g\ndXBkYXRlQWxsKChPYmplY3RbXSkgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIGxvbmcgdXBkYXRlQWxsKE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJl\ndHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9VUERBVEUsIHBhcmFtcykpLmxv\nbmdWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbChN\nYXAgcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBleGVjdXRl\nKE9QX1VQREFURSwgcGFyYW1zKSkubG9uZ1ZhbHVlKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBPYmplY3RbXSB0b1BhcmFtZXRlckFycmF5KExpbmtlZE1hcCBw\nYXJhbVR5cGVzLCBNYXAgcGFyYW1zKSB7CiAgICAgICAgaWYgKHBhcmFtcyA9\nPSBudWxsIHx8IHBhcmFtcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiBTdG9yZVF1ZXJ5LkVNUFRZX09CSkVDVFM7CgogICAgICAgIE9iamVjdFtd\nIGFyciA9IG5ldyBPYmplY3RbcGFyYW1zLnNpemUoKV07CiAgICAgICAgTWFw\nLkVudHJ5IGVudHJ5OwogICAgICAgIE9iamVjdCBrZXk7CiAgICAgICAgaW50\nIGlkeDsKICAgICAgICBpbnQgYmFzZSA9IC0xOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gcGFyYW1zLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICBrZXkgPSBlbnRyeS5nZXRLZXko\nKTsKICAgICAgICAgICAgaWR4ID0gKHBhcmFtVHlwZXMgPT0gbnVsbCkgPyAt\nMSA6IHBhcmFtVHlwZXMuaW5kZXhPZihrZXkpOwoKICAgICAgICAgICAgLy8g\nYWxsb3cgcG9zaXRpb25hbCBwYXJhbWV0ZXJzIGFuZCBuYXR1cmFsIG9yZGVy\nIHBhcmFtZXRlcnMKICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkKICAgICAg\nICAgICAgICAgIGFycltpZHhdID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAg\nICAgICAgZWxzZSBpZiAoa2V5IGluc3RhbmNlb2YgTnVtYmVyKSB7CiAgICAg\nICAgICAgICAgICBpZiAoYmFzZSA9PSAtMSkKICAgICAgICAgICAgICAgICAg\nICBiYXNlID0gcG9zaXRpb25hbFBhcmFtZXRlckJhc2UocGFyYW1zLmtleVNl\ndCgpKTsKICAgICAgICAgICAgICAgIGFyclsoKE51bWJlcikga2V5KS5pbnRW\nYWx1ZSgpIC0gYmFzZV0gPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtcGFyYW0tbmFtZSIsIGtleSkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gYXJyOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBiYXNlIChnZW5lcmFsbHkgMCBvciAxKSB0byB1c2UgZm9y\nIHBvc2l0aW9uYWwgcGFyYW1ldGVycy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgaW50IHBvc2l0aW9uYWxQYXJhbWV0ZXJCYXNlKENvbGxlY3Rpb24g\ncGFyYW1zKSB7CiAgICAgICAgaW50IGxvdyA9IEludGVnZXIuTUFYX1ZBTFVF\nOwogICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgaW50IHZhbDsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBhcmFtcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBvYmogPSBpdHIubmV4dCgpOwog\nICAgICAgICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBOdW1iZXIpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIDA7IC8vIHVzZSAwIGJhc2Ugd2hlbiBwYXJh\nbXMgYXJlIG1peGVkIHR5cGVzCgogICAgICAgICAgICB2YWwgPSAoKE51bWJl\ncikgb2JqKS5pbnRWYWx1ZSgpOwogICAgICAgICAgICBpZiAodmFsID09IDAp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICBpZiAo\ndmFsIDwgbG93KQogICAgICAgICAgICAgICAgbG93ID0gdmFsOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gbG93OwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHdoZXRoZXIgd2Ugc2hvdWxkIGV4ZWN1dGUgdGhpcyBxdWVyeSBp\nbiBtZW1vcnkuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0luTWVt\nb3J5KGludCBvcGVyYXRpb24pIHsKICAgICAgICAvLyBpZiBubyBjYW5kaWRh\ndGVzLCBjcmVhdGUgY2FuZGlkYXRlIGV4dGVudAogICAgICAgIGlmIChfY29s\nbGVjdGlvbiA9PSBudWxsICYmIF9leHRlbnQgPT0gbnVsbCAmJiBfY2xhc3Mg\nIT0gbnVsbCkgewogICAgICAgICAgICBfZXh0ZW50ID0gX2Jyb2tlci5uZXdF\neHRlbnQoX2NsYXNzLCBfc3ViY2xhc3Nlcyk7CiAgICAgICAgICAgIF9leHRl\nbnQuc2V0SWdub3JlQ2hhbmdlcyhfaWdub3JlQ2hhbmdlcyk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiB0aGVyZSBhcmUgYW55IGRpcnR5IGluc3RhbmNl\ncyBpbiB0aGUgY3VycmVudCB0cmFucyB0aGF0IGFyZQogICAgICAgIC8vIGlu\ndm9sdmVkIGluIHRoaXMgcXVlcnksIHdlIGhhdmUgdG8gZXhlY3V0ZSBpbiBt\nZW1vcnkgb3IgZmx1c2gKICAgICAgICBib29sZWFuIGluTWVtID0gIV9zdG9y\nZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkKICAgICAgICAg\nICAgfHwgX2NvbGxlY3Rpb24gIT0gbnVsbDsKICAgICAgICBpZiAoIWluTWVt\nICYmICghX2lnbm9yZUNoYW5nZXMgfHwgb3BlcmF0aW9uICE9IE9QX1NFTEVD\nVCkKICAgICAgICAgICAgJiYgX2Jyb2tlci5pc0FjdGl2ZSgpICYmIGlzQWNj\nZXNzUGF0aERpcnR5KCkpIHsKICAgICAgICAgICAgaW50IGZsdXNoID0gX2Zj\nLmdldEZsdXNoQmVmb3JlUXVlcmllcygpOwogICAgICAgICAgICBpZiAoKGZs\ndXNoID09IEZMVVNIX1RSVUUKICAgICAgICAgICAgICAgIHx8IChmbHVzaCA9\nPSBGTFVTSF9XSVRIX0NPTk5FQ1RJT04gJiYgX2Jyb2tlci5oYXNDb25uZWN0\naW9uKCkpCiAgICAgICAgICAgICAgICB8fCBvcGVyYXRpb24gIT0gT1BfU0VM\nRUNUCiAgICAgICAgICAgICAgICB8fCAhX3N0b3JlUXVlcnkuc3VwcG9ydHNJ\nbk1lbW9yeUV4ZWN1dGlvbigpKQogICAgICAgICAgICAgICAgJiYgX2Jyb2tl\nci5nZXRDb25maWd1cmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9ucygpLgogICAg\nICAgICAgICAgICAgY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BU\nSU9OX0lOQ19GTFVTSCkpIHsKICAgICAgICAgICAgICAgIF9icm9rZXIuZmx1\nc2goKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlm\nIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBf\nbG9nLmluZm8oX2xvYy5nZXQoImZvcmNlLWluLW1lbSIsIF9jbGFzcykpOwog\nICAgICAgICAgICAgICAgaW5NZW0gPSB0cnVlOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBpZiAoaW5NZW0gJiYgIV9zdG9yZVF1ZXJ5LnN1\ncHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1leGVj\nLWlubWVtIiwKICAgICAgICAgICAgICAgIF9sYW5ndWFnZSkpOwogICAgICAg\nIHJldHVybiBpbk1lbTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUg\ndGhlIHF1ZXJ5IHVzaW5nIHRoZSBnaXZlbiBjb21waWxhdGlvbiwgZXhlY3V0\nb3IsIGFuZCBwYXJhbWV0ZXIKICAgICAqIHZhbHVlcy4gQWxsIG90aGVyIGV4\nZWN1dGUgbWV0aG9kcyBkZWxlZ2F0ZSB0byB0aGlzIG9uZSBvciB0bwogICAg\nICoge0BsaW5rICNleGVjdXRlKFN0b3JlUXVlcnkuRXhlY3V0b3IsTWFwKX0g\nYWZ0ZXIgdmFsaWRhdGlvbiBhbmQgbG9ja2luZy4KICAgICAqLwogICAgcHJp\ndmF0ZSBPYmplY3QgZXhlY3V0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4LCBP\nYmplY3RbXSBwYXJhbXMpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gaWYgdGhpcyBpcyBhbiBpbXBvc3NpYmxlIHJlc3VsdCByYW5n\nZSwgcmV0dXJuIG51bGwgLyBlbXB0eSBsaXN0CiAgICAgICAgU3RvcmVRdWVy\neS5SYW5nZSByYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdlKF9zdGFydElk\neCwgX2VuZElkeCk7CiAgICAgICAgaWYgKCFfcmFuZ2VTZXQpCiAgICAgICAg\nICAgIGV4LmdldFJhbmdlKF9zdG9yZVF1ZXJ5LCBwYXJhbXMsIHJhbmdlKTsK\nICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgPj0gcmFuZ2UuZW5kKQogICAgICAg\nICAgICByZXR1cm4gZW1wdHlSZXN1bHQoZXgpOwoKICAgICAgICAvLyBleGVj\ndXRlOyBpZiB3ZSBoYXZlIGEgcmVzdWx0IGNsYXNzIG9yIHdlIGhhdmUgb25s\neSBvbmUgcmVzdWx0CiAgICAgICAgLy8gYW5kIHNvIG5lZWQgdG8gcmVtb3Zl\nIGl0IGZyb20gaXRzIGFycmF5LCB3cmFwIGluIGEgcGFja2luZyByb3AKICAg\nICAgICByYW5nZS5scnMgPSBpc0xSUyhyYW5nZS5zdGFydCwgcmFuZ2UuZW5k\nKTsKICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciByb3AgPSBleC5leGVj\ndXRlUXVlcnkoX3N0b3JlUXVlcnksIHBhcmFtcywgcmFuZ2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiB0b1Jlc3VsdChleCwgcm9wLCBy\nYW5nZSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgaWYgKHJvcCAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsg\ncm9wLmNsb3NlKCk7IH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMikge30KICAgICAg\nICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZWxldGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBnaXZlbiBleGVjdXRvciwg\nYW5kIHBhcmFtZXRlcgogICAgICogdmFsdWVzLiBBbGwgb3RoZXIgZXhlY3V0\nZSBtZXRob2RzIGRlbGVnYXRlIHRvIHRoaXMgb25lIG9yIHRvCiAgICAgKiB7\nQGxpbmsgI2RlbGV0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVy\nIHZhbGlkYXRpb24gYW5kIGxvY2tpbmcuCiAgICAgKiBUaGUgcmV0dXJuIHZh\nbHVlIHdpbGwgYmUgYSBOdW1iZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9m\nCiAgICAgKiBpbnN0YW5jZXMgZGVsZXRlZC4KICAgICAqLwogICAgcHJpdmF0\nZSBOdW1iZXIgZGVsZXRlKFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE9iamVj\ndFtdIHBhcmFtcykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBhc3NlcnRCdWxrTW9kaWZ5KGV4LCBwYXJhbXMpOwogICAgICAgIHJldHVy\nbiBleC5leGVjdXRlRGVsZXRlKF9zdG9yZVF1ZXJ5LCBwYXJhbXMpOwogICAg\nfQoKICAgIHB1YmxpYyBOdW1iZXIgZGVsZXRlSW5NZW1vcnkoU3RvcmVRdWVy\neS5FeGVjdXRvciBleGVjdXRvciwKICAgICAgICBPYmplY3RbXSBwYXJhbXMp\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBPYmplY3QgbyA9IGV4ZWN1\ndGUoZXhlY3V0b3IsIHBhcmFtcyk7CiAgICAgICAgICAgIGlmICghKG8gaW5z\ndGFuY2VvZiBDb2xsZWN0aW9uKSkKICAgICAgICAgICAgICAgIG8gPSBDb2xs\nZWN0aW9ucy5zaW5nbGV0b24obyk7CgogICAgICAgICAgICBpbnQgc2l6ZSA9\nIDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaSA9ICgoQ29sbGVjdGlv\nbikgbykuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7IHNpemUrKykKICAgICAg\nICAgICAgICAgIF9icm9rZXIuZGVsZXRlKGkubmV4dCgpLCBudWxsKTsKICAg\nICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihzaXplKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGUpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgcXVlcnkgdXNp\nbmcgdGhlIGdpdmVuIGNvbXBpbGF0aW9uLCBleGVjdXRvciwgYW5kIHBhcmFt\nZXRlcgogICAgICogdmFsdWVzLiBBbGwgb3RoZXIgZXhlY3V0ZSBtZXRob2Rz\nIGRlbGVnYXRlIHRvIHRoaXMgb25lIG9yIHRvCiAgICAgKiB7QGxpbmsgI3Vw\nZGF0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZhbGlkYXRp\nb24gYW5kIGxvY2tpbmcuCiAgICAgKiBUaGUgcmV0dXJuIHZhbHVlIHdpbGwg\nYmUgYSBOdW1iZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mCiAgICAgKiBp\nbnN0YW5jZXMgdXBkYXRlZC4KICAgICAqLwogICAgcHJpdmF0ZSBOdW1iZXIg\ndXBkYXRlKFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE9iamVjdFtdIHBhcmFt\ncykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRC\ndWxrTW9kaWZ5KGV4LCBwYXJhbXMpOwogICAgICAgIHJldHVybiBleC5leGVj\ndXRlVXBkYXRlKF9zdG9yZVF1ZXJ5LCBwYXJhbXMpOwogICAgfQoKICAgIHB1\nYmxpYyBOdW1iZXIgdXBkYXRlSW5NZW1vcnkoU3RvcmVRdWVyeS5FeGVjdXRv\nciBleGVjdXRvciwKICAgICAgICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBPYmplY3QgbyA9IGV4ZWN1dGUoZXhlY3V0\nb3IsIHBhcmFtcyk7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBD\nb2xsZWN0aW9uKSkKICAgICAgICAgICAgICAgIG8gPSBDb2xsZWN0aW9ucy5z\naW5nbGV0b24obyk7CgogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaSA9ICgoQ29sbGVjdGlvbikgbykuaXRl\ncmF0b3IoKTsgaS5oYXNOZXh0KCk7IHNpemUrKykKICAgICAgICAgICAgICAg\nIHVwZGF0ZUluTWVtb3J5KGkubmV4dCgpLCBwYXJhbXMpOwogICAgICAgICAg\nICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKHNpemUpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZXMgZm9yIHRoZSB1cGRh\ndGVzIGluIG1lbW9yeS4KICAgICAqCiAgICAgKiBAcGFyYW0gb2IgdGhlIHBl\ncnNpc3RlbnQgaW5zdGFuY2UgdG8gY2hhbmdlCiAgICAgKiBAcGFyYW0gcGFy\nYW1zIHRoZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgcXVlcnkKICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUluTWVtb3J5KE9iamVjdCBvYiwg\nT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdCA9\nIGdldFVwZGF0ZXMoKS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAg\nICAgIGl0Lmhhc05leHQoKTspIHsKICAgICAgICAgICAgTWFwLkVudHJ5IGUg\nPSAoTWFwLkVudHJ5KSBpdC5uZXh0KCk7CiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gKEZpZWxkTWV0YURhdGEpIGUuZ2V0S2V5KCk7CiAgICAg\nICAgICAgIGlmICghKGUuZ2V0VmFsdWUoKSBpbnN0YW5jZW9mIENvbnN0YW50\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJvbmx5LXVwZGF0ZS1jb25zdGFudHMiKSk7CiAgICAgICAgICAg\nIENvbnN0YW50IHZhbHVlID0gKENvbnN0YW50KSBlLmdldFZhbHVlKCk7CiAg\nICAgICAgICAgIE9iamVjdCB2YWwgPSB2YWx1ZS5nZXRWYWx1ZShwYXJhbXMp\nOwoKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IF9icm9r\nZXIuZ2V0U3RhdGVNYW5hZ2VyKG9iKTsKICAgICAgICAgICAgaW50IGkgPSBm\nbWQuZ2V0SW5kZXgoKTsKICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxl\nIGludG8gPSAoUGVyc2lzdGVuY2VDYXBhYmxlKSBvYjsKCiAgICAgICAgICAg\nIC8vIHNldCB0aGUgYWN0dWFsIGZpZWxkIGluIHRoZSBpbnN0YW5jZQogICAg\nICAgICAgICBpbnQgc2V0ID0gT3BlbkpQQVN0YXRlTWFuYWdlci5TRVRfVVNF\nUjsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFO\nOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdCb29sZWFuRmllbGQo\naW50bywgaSwgc20uZmV0Y2hCb29sZWFuRmllbGQoaSksCiAgICAgICAgICAg\nICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gZmFsc2UgOiAoKEJvb2xlYW4p\nIHZhbCkuYm9vbGVhblZhbHVlKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgICAg\nIHNtLnNldHRpbmdCeXRlRmllbGQoaW50bywgaSwgc20uZmV0Y2hCeXRlRmll\nbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8g\nMCA6ICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nQ2hh\nckZpZWxkKGludG8sIGksIHNtLmZldGNoQ2hhckZpZWxkKGkpLAogICAgICAg\nICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiB2YWwudG9TdHJp\nbmcoKS5jaGFyQXQoMCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0RvdWJsZUZpZWxkKGludG8s\nIGksIHNtLmZldGNoRG91YmxlRmllbGQoaSksCiAgICAgICAgICAgICAgICAg\nICAgICAgIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmRvdWJs\nZVZhbHVlKCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgICAgICAgICBzbS5zZXR0aW5nRmxvYXRGaWVsZChpbnRvLCBpLCBzbS5m\nZXRjaEZsb2F0RmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZh\nbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUoKSwg\nc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgICAgICBz\nbS5zZXR0aW5nSW50RmllbGQoaW50bywgaSwgc20uZmV0Y2hJbnRGaWVsZChp\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDog\nKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0xvbmdGaWVs\nZChpbnRvLCBpLCBzbS5mZXRjaExvbmdGaWVsZChpKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCku\nbG9uZ1ZhbHVlKCksIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAg\nICAgICAgICAgICAgICBzbS5zZXR0aW5nU2hvcnRGaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaFNob3J0RmllbGQoaSksCiAgICAgICAgICAgICAgICAgICAgICAg\nIHZhbCA9PSBudWxsID8gMCA6ICgoTnVtYmVyKSB2YWwpLnNob3J0VmFsdWUo\nKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAg\nICAgICBzbS5zZXR0aW5nU3RyaW5nRmllbGQoaW50bywgaSwgc20uZmV0Y2hT\ndHJpbmdGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09\nIG51bGwgPyBudWxsIDogdmFsLnRvU3RyaW5nKCksIHNldCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5EQVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVN\nQkVSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9P\nQko6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9DQUxFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nT0JKRUNUOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgog\nICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRv\nLCBpLCBzbS5mZXRjaE9iamVjdEZpZWxkKGkpLCB2YWwsCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJvbmx5LXVwZGF0\nZS1wcmltaXRpdmVzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVHJhY2UgbG9nIHRoYXQgdGhlIHF1ZXJ5IGlz\nIGV4ZWN1dGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvZ0V4ZWN1\ndGlvbihpbnQgb3AsIExpbmtlZE1hcCB0eXBlcywgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgTWFwIHBtYXAgPSBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7\nCiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAg\nIHBtYXAgPSBuZXcgSGFzaE1hcCgoaW50KSAocGFyYW1zLmxlbmd0aCAqIDEu\nMzMgKyAxKSk7CiAgICAgICAgICAgIGlmICh0eXBlcyAhPSBudWxsICYmIHR5\ncGVzLnNpemUoKSA9PSBwYXJhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAg\nICBpbnQgaSA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHR5cGVzLmtleVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgICAgIHBtYXAucHV0KGl0ci5uZXh0KCksIHBh\ncmFtc1tpKytdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgICAgIHBtYXAucHV0KFN0cmluZy52YWx1ZU9mKGkp\nLCBwYXJhbXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGxvZ0V4ZWN1dGlvbihvcCwgcG1hcCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUcmFjZSBsb2cgdGhhdCB0aGUgcXVlcnkgaXMgZXhlY3V0aW5nLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgbG9nRXhlY3V0aW9uKGludCBvcCwgTWFw\nIHBhcmFtcykgewogICAgICAgIFN0cmluZyBzID0gX3F1ZXJ5OwogICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KHMpKQogICAgICAgICAgICBzID0g\ndG9TdHJpbmcoKTsKCiAgICAgICAgU3RyaW5nIG1zZyA9ICJleGVjdXRpbmct\ncXVlcnkiOwogICAgICAgIGlmICghcGFyYW1zLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgbXNnICs9ICItd2l0aC1wYXJhbXMiOwoKICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KG1zZywgcywgcGFyYW1zKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGlzIHNob3VsZCBiZSB0cmVhdGVk\nIGFzIGEgcG90ZW50aWFsIGxhcmdlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBpc0xSUyhsb25nIHN0YXJ0LCBsb25nIGVuZCkg\newogICAgICAgIGxvbmcgcmFuZ2UgPSBlbmQgLSBzdGFydDsKICAgICAgICBy\nZXR1cm4gX2ZjLmdldEZldGNoQmF0Y2hTaXplKCkgPj0gMAogICAgICAgICAg\nICAmJiAhKHJhbmdlIDw9IF9mYy5nZXRGZXRjaEJhdGNoU2l6ZSgpCiAgICAg\nICAgICAgIHx8IChfZmMuZ2V0RmV0Y2hCYXRjaFNpemUoKSA9PSAwICYmIHJh\nbmdlIDw9IDUwKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHF1ZXJ5IHJlc3VsdCBmb3IgdGhlIGdpdmVuIHJlc3VsdCBvYmplY3QgcHJv\ndmlkZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9SZXN1bHQo\nU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgUmVzdWx0T2JqZWN0UHJvdmlkZXIg\ncm9wLAogICAgICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UpCiAgICAgICAg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcGFjayBwcm9qZWN0aW9u\ncyBpZiBuZWNlc3NhcnkKICAgICAgICBTdHJpbmdbXSBhbGlhc2VzID0gZXgu\nZ2V0UHJvamVjdGlvbkFsaWFzZXMoX3N0b3JlUXVlcnkpOwogICAgICAgIGlm\nICghZXguaXNQYWNraW5nKF9zdG9yZVF1ZXJ5KSkgewogICAgICAgICAgICBS\nZXN1bHRQYWNrZXIgcGFja2VyID0gZ2V0UmVzdWx0UGFja2VyKGV4KTsKICAg\nICAgICAgICAgaWYgKHBhY2tlciAhPSBudWxsIHx8IGFsaWFzZXMubGVuZ3Ro\nID09IDEpCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgUGFja2luZ1Jlc3Vs\ndE9iamVjdFByb3ZpZGVyKHJvcCwgcGFja2VyLAogICAgICAgICAgICAgICAg\nICAgIGFsaWFzZXMubGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIHNpbmdsZSByZXN1bHQsIGV4dHJhY3QgaXQKICAgICAgICBpZiAoX3VuaXF1\nZSA9PSBCb29sZWFuLlRSVUUgfHwgKGFsaWFzZXMubGVuZ3RoID4gMAogICAg\nICAgICAgICAmJiAhZXguaGFzR3JvdXBpbmcoX3N0b3JlUXVlcnkpICYmIGV4\nLmlzQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KSkpCiAgICAgICAgICAgIHJldHVy\nbiBzaW5nbGVSZXN1bHQocm9wLCByYW5nZSk7CgogICAgICAgIC8vIG5vdyB0\naGF0IHdlJ3ZlIGV4ZWN1dGVkIHRoZSBxdWVyeSwgd2UgY2FuIGNhbGwgaXNB\nZ2dyZWdhdGUgYW5kCiAgICAgICAgLy8gaGFzR3JvdXBpbmcgZWZmaWNpZW50\nbHkKICAgICAgICBib29sZWFuIGRldGFjaCA9IChfYnJva2VyLmdldEF1dG9E\nZXRhY2goKSAmCiAgICAgICAgICAgIEF1dG9EZXRhY2guREVUQUNIX05PTlRY\nUkVBRCkgPiAwICYmICFfYnJva2VyLmlzQWN0aXZlKCk7CiAgICAgICAgYm9v\nbGVhbiBscnMgPSByYW5nZS5scnMgJiYgIWV4LmlzQWdncmVnYXRlKF9zdG9y\nZVF1ZXJ5KQogICAgICAgICAgICAmJiAhZXguaGFzR3JvdXBpbmcoX3N0b3Jl\nUXVlcnkpOwogICAgICAgIFJlc3VsdExpc3QgcmVzID0gKCFkZXRhY2ggJiYg\nbHJzKSA/IF9mYy5uZXdSZXN1bHRMaXN0KHJvcCkKICAgICAgICAgICAgOiBu\nZXcgRWFnZXJSZXN1bHRMaXN0KHJvcCk7CgogICAgICAgIF9yZXN1bHRMaXN0\ncy5hZGQoZGVjb3JhdGVSZXN1bHRMaXN0KHJlcykpOwogICAgICAgIHJldHVy\nbiByZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcHRpb25hbGx5IGRlY29y\nYXRlIHRoZSBuYXRpdmUgcmVzdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nUmVzdWx0TGlzdCBkZWNvcmF0ZVJlc3VsdExpc3QoUmVzdWx0TGlzdCByZXMp\nIHsKICAgICAgICByZXR1cm4gbmV3IFJlbW92ZU9uQ2xvc2VSZXN1bHRMaXN0\nKHJlcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSByZXN1bHQg\ncGFja2VyIGZvciB0aGlzIHByb2plY3Rpb24sIG9yIG51bGwuCiAgICAgKi8K\nICAgIHByaXZhdGUgUmVzdWx0UGFja2VyIGdldFJlc3VsdFBhY2tlcihTdG9y\nZVF1ZXJ5LkV4ZWN1dG9yIGV4KSB7CiAgICAgICAgaWYgKF9wYWNrZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9wYWNrZXI7CgogICAgICAgIENs\nYXNzIHJlc3VsdENsYXNzID0gKF9yZXN1bHRDbGFzcyAhPSBudWxsKSA/IF9y\nZXN1bHRDbGFzcwogICAgICAgICAgICA6IGV4LmdldFJlc3VsdENsYXNzKF9z\ndG9yZVF1ZXJ5KTsKICAgICAgICBpZiAocmVzdWx0Q2xhc3MgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFN0cmluZ1tdIGFs\naWFzZXMgPSBleC5nZXRQcm9qZWN0aW9uQWxpYXNlcyhfc3RvcmVRdWVyeSk7\nCiAgICAgICAgaWYgKGFsaWFzZXMubGVuZ3RoID09IDApIHsKICAgICAgICAg\nICAgLy8gcmVzdWx0IGNsYXNzIGJ1dCBubyByZXN1bHQ7IG1lYW5zIGNhbmRp\nZGF0ZSBpcyBiZWluZyBzZXQKICAgICAgICAgICAgLy8gaW50byBzb21lIHJl\nc3VsdCBjbGFzcwogICAgICAgICAgICBfcGFja2VyID0gbmV3IFJlc3VsdFBh\nY2tlcihfY2xhc3MsIGdldEFsaWFzKCksIHJlc3VsdENsYXNzKTsKICAgICAg\nICB9IGVsc2UgaWYgKHJlc3VsdENsYXNzICE9IG51bGwpIHsKICAgICAgICAg\nICAgLy8gcHJvamVjdGlvbgogICAgICAgICAgICBDbGFzc1tdIHR5cGVzID0g\nZXguZ2V0UHJvamVjdGlvblR5cGVzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICAg\nICAgX3BhY2tlciA9IG5ldyBSZXN1bHRQYWNrZXIodHlwZXMsIGFsaWFzZXMs\nIHJlc3VsdENsYXNzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9wYWNr\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gZW1wdHkgcmVz\ndWx0IGZvciB0aGlzIHF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIE9iamVj\ndCBlbXB0eVJlc3VsdChTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4KSB7CiAgICAg\nICAgaWYgKF91bmlxdWUgPT0gQm9vbGVhbi5UUlVFIHx8IChfdW5pcXVlID09\nIG51bGwKICAgICAgICAgICAgJiYgIWV4Lmhhc0dyb3VwaW5nKF9zdG9yZVF1\nZXJ5KSAmJiBleC5pc0FnZ3JlZ2F0ZShfc3RvcmVRdWVyeSkpKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMu\nRU1QVFlfTElTVDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgYW4g\nZXhwZWN0ZWQgc2luZ2xlIHJlc3VsdCBmcm9tIHRoZSBnaXZlbiBwcm92aWRl\nci4gVXNlZCB3aGVuCiAgICAgKiB0aGUgcmVzdWx0IGlzIGFuIHVuZ3JvdXBl\nZCBhZ2dyZWdhdGUgb3IgdGhlIHVuaXF1ZSBmbGFnIGlzIHNldCB0byB0cnVl\nLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBzaW5nbGVSZXN1bHQoUmVz\ndWx0T2JqZWN0UHJvdmlkZXIgcm9wLCAKICAgICAgICBTdG9yZVF1ZXJ5LlJh\nbmdlIHJhbmdlKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIHJvcC5vcGVuKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbW92\nZSB0byBleHBlY3RlZCByZXN1bHQKICAgICAgICAgICAgYm9vbGVhbiBuZXh0\nID0gcm9wLm5leHQoKTsKCiAgICAgICAgICAgIC8vIGV4dHJhY3Qgc2luZ2xl\nIHJlc3VsdDsgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIG11bHRpcGxlIHJlc3Vs\ndHMKICAgICAgICAgICAgLy8gbWF0Y2ggYW5kIG5vdCBjb25zdHJhaW50ZWQg\nYnkgcmFuZ2UsIGFzIHBlciBzcGVjCiAgICAgICAgICAgIE9iamVjdCBzaW5n\nbGUgPSBudWxsOwogICAgICAgICAgICBpZiAobmV4dCkgewogICAgICAgICAg\nICAgICAgc2luZ2xlID0gcm9wLmdldFJlc3VsdE9iamVjdCgpOwogICAgICAg\nICAgICAgICAgaWYgKHJhbmdlLmVuZCAhPSByYW5nZS5zdGFydCArIDEgJiYg\ncm9wLm5leHQoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtdW5pcXVlIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgX2NsYXNzLCBfcXVlcnkpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdW5pcXVlIHNldCB0byBmYWxz\nZSwgdXNlIGNvbGxlY3Rpb24KICAgICAgICAgICAgaWYgKF91bmlxdWUgPT0g\nQm9vbGVhbi5GQUxTRSkgewogICAgICAgICAgICAgICAgaWYgKCFuZXh0KQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9M\nSVNUOwogICAgICAgICAgICAgICAgLy8gQ29sbGVjdGlvbnMuc2luZ2xldG9u\nTGlzdCBpcyBKREsgMS4zLCBzby4uLgogICAgICAgICAgICAgICAgcmV0dXJu\nIEFycmF5cy5hc0xpc3QobmV3IE9iamVjdFtdeyBzaW5nbGUgfSk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJldHVybiBzaW5nbGUgcmVzdWx0\nCiAgICAgICAgICAgIHJldHVybiBzaW5nbGU7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgcm9wLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ2FsY3VsYXRlcyB3aGV0aGVyIHRoZSBhY2Nlc3Mg\ncGF0aCBvZiB0aGlzIHF1ZXJ5IGludGVyc2VjdHMgd2l0aAogICAgICogYW55\nIGRpcnR5IG9iamVjdHMgaW4gdGhlIHRyYW5zYWN0aW9uLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNBY2Nlc3NQYXRoRGlydHkoKSB7CiAgICAg\nICAgcmV0dXJuIGlzQWNjZXNzUGF0aERpcnR5KF9icm9rZXIsIGdldEFjY2Vz\nc1BhdGhNZXRhRGF0YXMoKSk7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBi\nb29sZWFuIGlzQWNjZXNzUGF0aERpcnR5KEJyb2tlciBicm9rZXIsCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YVtdIGFjY2Vzc01ldGFzKSB7CiAgICAgICAgQ29s\nbGVjdGlvbiBwZXJzaXN0ZWQgPSBicm9rZXIuZ2V0UGVyc2lzdGVkVHlwZXMo\nKTsKICAgICAgICBDb2xsZWN0aW9uIHVwZGF0ZWQgPSBicm9rZXIuZ2V0VXBk\nYXRlZFR5cGVzKCk7CiAgICAgICAgQ29sbGVjdGlvbiBkZWxldGVkID0gYnJv\na2VyLmdldERlbGV0ZWRUeXBlcygpOwogICAgICAgIGlmIChwZXJzaXN0ZWQu\naXNFbXB0eSgpICYmIHVwZGF0ZWQuaXNFbXB0eSgpICYmIGRlbGV0ZWQuaXNF\nbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8v\nIGlmIG5vIGFjY2VzcyBtZXRhcywgYXNzdW1lIGV2ZXJ5IGRpcnR5IG9iamVj\ndCBhZmZlY3RzIHBhdGgganVzdAogICAgICAgIC8vIHRvIGJlIHNhZmUKICAg\nICAgICBpZiAoYWNjZXNzTWV0YXMubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBjb21wYXJlIGRpcnR5IGNsYXNz\nZXMgdG8gdGhlIGFjY2VzcyBwYXRoIGNsYXNzZXMKICAgICAgICBDbGFzcyBh\nY2NDbGFzczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFjY2Vzc01l\ndGFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIHNob3J0Y3V0IGlm\nIGFjdHVhbCBjbGFzcyBpcyBkaXJ0eQogICAgICAgICAgICBhY2NDbGFzcyA9\nIGFjY2Vzc01ldGFzW2ldLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAg\nICAgaWYgKHBlcnNpc3RlZC5jb250YWlucyhhY2NDbGFzcykgfHwgdXBkYXRl\nZC5jb250YWlucyhhY2NDbGFzcykKICAgICAgICAgICAgICAgIHx8IGRlbGV0\nZWQuY29udGFpbnMoYWNjQ2xhc3MpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CgogICAgICAgICAgICAvLyBjaGVjayBmb3IgZGlydHkgc3ViY2xh\nc3MKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBkaXJ0eSA9IHBlcnNpc3Rl\nZC5pdGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAg\nICAgaWYgKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBkaXJ0\neS5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gdXBkYXRlZC5pdGVy\nYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaWYg\nKGFjY0NsYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBkaXJ0eS5uZXh0\nKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gZGVsZXRlZC5pdGVyYXRvcigp\nOyBkaXJ0eS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaWYgKGFjY0Ns\nYXNzLmlzQXNzaWduYWJsZUZyb20oKENsYXNzKSBkaXJ0eS5uZXh0KCkpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gbm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlQWxsKCkgewogICAgICAg\nIGNsb3NlUmVzdWx0cyh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBj\nbG9zZVJlc291cmNlcygpIHsKICAgICAgICBjbG9zZVJlc3VsdHMoZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2Ugb3BlbiByZXN1bHRzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgY2xvc2VSZXN1bHRzKGJvb2xlYW4g\nZm9yY2UpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgUmVtb3ZlT25DbG9z\nZVJlc3VsdExpc3QgcmVzOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IF9yZXN1bHRMaXN0cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgcmVzID0gKFJlbW92ZU9uQ2xvc2VSZXN1bHRM\naXN0KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZvcmNlIHx8\nIHJlcy5pc1Byb3ZpZGVyT3BlbigpKQogICAgICAgICAgICAgICAgICAgIHJl\ncy5jbG9zZShmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Jl\nc3VsdExpc3RzLmNsZWFyKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXREYXRhU3RvcmVBY3Rpb25zKE1hcCBwYXJhbXMpIHsKICAg\nICAgICBpZiAocGFyYW1zID09IG51bGwpCiAgICAgICAgICAgIHBhcmFtcyA9\nIENvbGxlY3Rpb25zLkVNUFRZX01BUDsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5vdFNlcmlhbGl6ZWQoKTsK\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgU3RvcmVR\ndWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigpOwogICAg\nICAgICAgICBPYmplY3RbXSBhcnIgPSB0b1BhcmFtZXRlckFycmF5KGV4Lmdl\ndFBhcmFtZXRlclR5cGVzKF9zdG9yZVF1ZXJ5KSwKICAgICAgICAgICAgICAg\nIHBhcmFtcyk7CiAgICAgICAgICAgIGFzc2VydFBhcmFtZXRlcnMoZXgsIGFy\ncik7CiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UgPSBuZXcg\nU3RvcmVRdWVyeS5SYW5nZShfc3RhcnRJZHgsIF9lbmRJZHgpOwogICAgICAg\nICAgICBpZiAoIV9yYW5nZVNldCkKICAgICAgICAgICAgICAgIGV4LmdldFJh\nbmdlKF9zdG9yZVF1ZXJ5LCBhcnIsIHJhbmdlKTsKICAgICAgICAgICAgcmV0\ndXJuIGV4LmdldERhdGFTdG9yZUFjdGlvbnMoX3N0b3JlUXVlcnksIGFyciwg\ncmFuZ2UpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNldFF1\nZXJ5KE9iamVjdCBxdWVyeSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGFz\nc2VydE5vdFJlYWRPbmx5KCk7CgogICAgICAgICAgICBpZiAocXVlcnkgPT0g\nbnVsbCB8fCBxdWVyeSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAg\nICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAgICAg\nICBfcXVlcnkgPSAoU3RyaW5nKSBxdWVyeTsKICAgICAgICAgICAgICAgIGlm\nIChfcXVlcnkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcXVlcnkg\nPSBfcXVlcnkudHJpbSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEocXVlcnkgaW5zdGFu\nY2VvZiBRdWVyeUltcGwpKQogICAgICAgICAgICAgICAgcmV0dXJuIF9zdG9y\nZVF1ZXJ5LnNldFF1ZXJ5KHF1ZXJ5KTsKCiAgICAgICAgICAgIC8vIGNvcHkg\nYWxsIG5vbi10cmFuc2llbnQgc3RhdGUgZnJvbSB0aGUgZ2l2ZW4gcXVlcnkK\nICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAg\nICAgIFF1ZXJ5SW1wbCBxID0gKFF1ZXJ5SW1wbCkgcXVlcnk7CiAgICAgICAg\nICAgIF9jbGFzcyA9IHEuX2NsYXNzOwogICAgICAgICAgICBfc3ViY2xhc3Nl\ncyA9IHEuX3N1YmNsYXNzZXM7CiAgICAgICAgICAgIF9xdWVyeSA9IHEuX3F1\nZXJ5OwogICAgICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IHEuX2lnbm9yZUNo\nYW5nZXM7CiAgICAgICAgICAgIF91bmlxdWUgPSBxLl91bmlxdWU7CiAgICAg\nICAgICAgIF9yZXN1bHRDbGFzcyA9IHEuX3Jlc3VsdENsYXNzOwogICAgICAg\nICAgICBfcGFyYW1zID0gcS5fcGFyYW1zOwogICAgICAgICAgICBfcmVzdWx0\nTWFwcGluZ1Njb3BlID0gcS5fcmVzdWx0TWFwcGluZ1Njb3BlOwogICAgICAg\nICAgICBfcmVzdWx0TWFwcGluZ05hbWUgPSBxLl9yZXN1bHRNYXBwaW5nTmFt\nZTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0gcS5fcmVhZE9ubHk7CgogICAg\nICAgICAgICAvLyBkb24ndCBzaGFyZSBtdXRhYmxlIG9iamVjdHMKICAgICAg\nICAgICAgX2ZjLmNvcHkocS5fZmMpOwogICAgICAgICAgICBpZiAocS5fZmls\ndExpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2ZpbHRMaXN0\nZW5lcnMgPSBuZXcgSGFzaE1hcChxLl9maWx0TGlzdGVuZXJzKTsKICAgICAg\nICAgICAgaWYgKHEuX2FnZ0xpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgX2FnZ0xpc3RlbmVycyA9IG5ldyBIYXNoTWFwKHEuX2FnZ0xpc3Rl\nbmVycyk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGdldEFsaWFzKCkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSBj\nb21waWxlRm9yRXhlY3V0b3IoKS5nZXRBbGlhcyhfc3RvcmVRdWVyeSk7CiAg\nICAgICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nYWxpYXMgPSBTdHJpbmdzLmdldENsYXNzTmFtZShfY2xhc3MpOwogICAgICAg\nICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXRQcm9qZWN0aW9uQWxpYXNlcygpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVG\nb3JFeGVjdXRvcigpLmdldFByb2plY3Rpb25BbGlhc2VzKF9zdG9yZVF1ZXJ5\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENsYXNzW10gZ2V0UHJvamVj\ndGlvblR5cGVzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0UHJv\namVjdGlvblR5cGVzKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRPcGVyYXRpb24oKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9yRXhl\nY3V0b3IoKS5nZXRPcGVyYXRpb24oX3N0b3JlUXVlcnkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNv\nbXBpbGVGb3JFeGVjdXRvcigpLmlzQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzR3JvdXBpbmco\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5oYXNHcm91cGluZyhfc3Rv\ncmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhW10gZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcygpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YVtd\nIG1ldGFzID0gY29tcGlsZUZvckV4ZWN1dG9yKCkuCiAgICAgICAgICAgICAg\nICBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKF9zdG9yZVF1ZXJ5KTsKICAgICAg\nICAgICAgcmV0dXJuIChtZXRhcyA9PSBudWxsKSA/IFN0b3JlUXVlcnkuRU1Q\nVFlfTUVUQVMgOiBtZXRhczsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIExp\nbmtlZE1hcCBnZXRQYXJhbWV0ZXJUeXBlcygpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JF\neGVjdXRvcigpLmdldFBhcmFtZXRlclR5cGVzKF9zdG9yZVF1ZXJ5KTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIE1hcCBnZXRVcGRhdGVzKCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0VXBkYXRlcyhfc3RvcmVRdWVyeSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAg\nICAgaWYgKF9icm9rZXIgPT0gbnVsbCB8fCBfYnJva2VyLmdldE11bHRpdGhy\nZWFkZWQoKSkKICAgICAgICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2suaXNM\nb2NrZWQoKSkKICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9Cgog\nICAgLy8vLy8vLy8vCiAgICAvLyBVdGlscwogICAgLy8vLy8vLy8vCgogICAg\ncHVibGljIENsYXNzIGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwgU3RyaW5n\nW10gaW1wb3J0cykgewogICAgICAgIC8vIGZ1bGwgY2xhc3MgbmFtZSBvciBw\ncmltaXRpdmUgdHlwZT8KICAgICAgICBDbGFzcyB0eXBlID0gdG9DbGFzcyhu\nYW1lKTsKICAgICAgICBpZiAodHlwZSAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gdHlwZTsKCiAgICAgICAgLy8gZmlyc3QgY2hlY2sgdGhlIGFsaWFz\nZXMgbWFwIGluIHRoZSBNZXRhRGF0YVJlcG9zaXRvcnkKICAgICAgICBDbGFz\nc0xvYWRlciBsb2FkZXIgPSAoX2NsYXNzID09IG51bGwpID8gX2xvYWRlcgog\nICAgICAgICAgICA6IF9jbGFzcy5nZXRDbGFzc0xvYWRlcigpOwogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlv\nbigpLgogICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5j\nZSgpLmdldE1ldGFEYXRhKG5hbWUsIGxvYWRlciwgZmFsc2UpOwogICAgICAg\nIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAgLy8gdHJ5IHRoZSBuYW1lIGlu\nIHRoZSBwYWNrYWdlIG9mIHRoZSBjYW5kaWRhdGUgY2xhc3MKICAgICAgICBp\nZiAoX2NsYXNzICE9IG51bGwpIHsKICAgICAgICAgICAgU3RyaW5nIGZ1bGxO\nYW1lID0gX2NsYXNzLmdldE5hbWUoKS5zdWJzdHJpbmcKICAgICAgICAgICAg\nICAgICgwLCBfY2xhc3MuZ2V0TmFtZSgpLmxhc3RJbmRleE9mKCcuJykgKyAx\nKSArIG5hbWU7CiAgICAgICAgICAgIHR5cGUgPSB0b0NsYXNzKGZ1bGxOYW1l\nKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiB0eXBlOwogICAgICAgIH0KCiAgICAgICAgLy8gdHJ5IGph\ndmEubGFuZwogICAgICAgIHR5cGUgPSB0b0NsYXNzKCJqYXZhLmxhbmcuIiAr\nIG5hbWUpOwogICAgICAgIGlmICh0eXBlICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiB0eXBlOwoKICAgICAgICAvLyB0cnkgZWFjaCBpbXBvcnQKICAg\nICAgICBpZiAoaW1wb3J0cyAhPSBudWxsICYmIGltcG9ydHMubGVuZ3RoID4g\nMCkgewogICAgICAgICAgICBTdHJpbmcgZG90TmFtZSA9ICIuIiArIG5hbWU7\nCiAgICAgICAgICAgIFN0cmluZyBpbXBvcnROYW1lOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGltcG9ydHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGltcG9ydE5hbWUgPSBpbXBvcnRzW2ldOwoKICAgICAg\nICAgICAgICAgIC8vIGZ1bGwgY2xhc3MgbmFtZSBpbXBvcnQKICAgICAgICAg\nICAgICAgIGlmIChpbXBvcnROYW1lLmVuZHNXaXRoKGRvdE5hbWUpKQogICAg\nICAgICAgICAgICAgICAgIHR5cGUgPSB0b0NsYXNzKGltcG9ydE5hbWUpOwog\nICAgICAgICAgICAgICAgICAgIC8vIHdpbGRjYXJkOyBzdHJpcCB0byBwYWNr\nYWdlCiAgICAgICAgICAgICAgICBlbHNlIGlmIChpbXBvcnROYW1lLmVuZHNX\naXRoKCIuKiIpKSB7CiAgICAgICAgICAgICAgICAgICAgaW1wb3J0TmFtZSA9\nIGltcG9ydE5hbWUuc3Vic3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAg\nICgwLCBpbXBvcnROYW1lLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgICAgICAg\nICAgICAgdHlwZSA9IHRvQ2xhc3MoaW1wb3J0TmFtZSArIG5hbWUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHR5cGUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHlwZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUge0BsaW5rIENsYXNzfSBmb3IgdGhl\nIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbmFtZSBub3QgdmFsaWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ2xhc3MgdG9DbGFzcyhTdHJpbmcgbmFtZSkgewog\nICAgICAgIGlmIChfbG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIF9sb2Fk\nZXIgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDbGFzc1Jlc29s\ndmVySW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldENsYXNzTG9hZGVy\nKF9jbGFzcywgX2Jyb2tlci5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gU3RyaW5ncy50b0NsYXNzKG5hbWUs\nIF9sb2FkZXIpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICB9IGNhdGNoIChOb0NsYXNzRGVmRm91bmRFcnJvciBu\nY2RmZSkgewogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVuKCkgewogICAgICAgIGlmIChf\nYnJva2VyICE9IG51bGwpCiAgICAgICAgICAgIF9icm9rZXIuYXNzZXJ0T3Bl\nbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE5vdFJlYWRPbmx5\nKCkgewogICAgICAgIGlmIChfcmVhZE9ubHkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlYWQtb25s\neSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb3RTZXJpYWxp\nemVkKCkgewogICAgICAgIGlmIChfYnJva2VyID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInNlcmlhbGl6ZWQiKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0\naGF0IGEgY2FuZGlkYXRlIGNsYXNzIGhhcyBiZWVuIHNldCBmb3IgdGhlIHF1\nZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0Q2FuZGlkYXRl\nVHlwZSgpIHsKICAgICAgICBpZiAoX2NsYXNzID09IG51bGwgJiYgX3N0b3Jl\nUXVlcnkucmVxdWlyZXNDYW5kaWRhdGVUeXBlKCkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWNs\nYXNzIikpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhhdCB3ZSBh\ncmUgaW4gYSBzdGF0ZSB0byBiZSBhYmxlIHRvIHBlcmZvcm0gYSBidWxrIG9w\nZXJhdGlvbjsKICAgICAqIGFsc28gZmx1c2ggdGhlIGN1cnJlbnQgbW9kZmlj\nYXRpb25zIGlmIGFueSBlbGVtZW50cyBhcmUgY3VycmVudGx5IGRpcnR5Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0QnVsa01vZGlmeShTdG9y\nZVF1ZXJ5LkV4ZWN1dG9yIGV4LCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAg\nICBfYnJva2VyLmFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAg\naWYgKF9zdGFydElkeCAhPSAwIHx8IF9lbmRJZHggIT0gTG9uZy5NQVhfVkFM\nVUUpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1tb2RpZnktcmFuZ2UiKSk7CiAgICAgICAgaWYgKF9yZXN1bHRD\nbGFzcyAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tbW9kaWZ5LXJlc3VsdGNsYXNzIikpOwogICAg\nICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5S\nYW5nZSgpOwogICAgICAgIGV4LmdldFJhbmdlKF9zdG9yZVF1ZXJ5LCBwYXJh\nbXMsIHJhbmdlKTsKICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gMCB8fCBy\nYW5nZS5lbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tb2RpZnktcmFuZ2Ui\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgdGhhdCB0aGUgcGFz\nc2VkIHBhcmFtZXRlcnMgbWF0Y2ggdGhlIGRlY2xhcmF0aW9ucy4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgYXNzZXJ0UGFyYW1ldGVycyhTdG9yZVF1\nZXJ5LkV4ZWN1dG9yIGV4LCBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICBp\nZiAoIV9zdG9yZVF1ZXJ5LnJlcXVpcmVzUGFyYW1ldGVyRGVjbGFyYXRpb25z\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlua2VkTWFwIHBh\ncmFtVHlwZXMgPSBleC5nZXRQYXJhbWV0ZXJUeXBlcyhfc3RvcmVRdWVyeSk7\nCiAgICAgICAgaW50IHR5cGVDb3VudCA9IHBhcmFtVHlwZXMuc2l6ZSgpOwog\nICAgICAgIGlmICh0eXBlQ291bnQgPiBwYXJhbXMubGVuZ3RoKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidW5ib3Vu\nZC1wYXJhbXMiLAogICAgICAgICAgICAgICAgcGFyYW1UeXBlcy5rZXlTZXQo\nKSkpOwogICAgICAgIGlmICh0eXBlQ291bnQgPCBwYXJhbXMubGVuZ3RoKQog\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nZXh0cmEtcGFyYW1zIiwgbmV3IE9iamVjdFtdCiAgICAgICAgICAgICAgICB7\nIFN0cmluZy52YWx1ZU9mKHR5cGVDb3VudCksIFN0cmluZy52YWx1ZU9mKHBh\ncmFtcy5sZW5ndGgpIH0pKTsKCiAgICAgICAgSXRlcmF0b3IgaXRyID0gcGFy\nYW1UeXBlcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgTWFwLkVu\ndHJ5IGVudHJ5OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpdHIuaGFzTmV4\ndCgpOyBpKyspIHsKICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBp\ndHIubmV4dCgpOwogICAgICAgICAgICBpZiAoKChDbGFzcykgZW50cnkuZ2V0\nVmFsdWUoKSkuaXNQcmltaXRpdmUoKSAmJiBwYXJhbXNbaV0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJudWxsLXByaW1pdGl2ZS1wYXJhbSIsCiAgICAgICAgICAgICAgICAg\nICAgZW50cnkuZ2V0S2V5KCkpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWZmZXIg\nYnVmID0gbmV3IFN0cmluZ0J1ZmZlcig2NCk7CiAgICAgICAgYnVmLmFwcGVu\nZCgiUXVlcnk6ICIpLmFwcGVuZChzdXBlci50b1N0cmluZygpKTsKICAgICAg\nICBidWYuYXBwZW5kKCI7IGNhbmRpZGF0ZSBjbGFzczogIikuYXBwZW5kKF9j\nbGFzcyk7CiAgICAgICAgYnVmLmFwcGVuZCgiOyBxdWVyeTogIikuYXBwZW5k\nKF9xdWVyeSk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIC8qKgogICAgICogU3RydWN0IG9mIGNvbXBpbGVkIHF1ZXJ5IHBy\nb3BlcnRpZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3Mg\nQ29tcGlsYXRpb24gewoKICAgICAgICBwdWJsaWMgU3RvcmVRdWVyeS5FeGVj\ndXRvciBtZW1vcnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBTdG9yZVF1ZXJ5\nLkV4ZWN1dG9yIGRhdGFzdG9yZSA9IG51bGw7CiAgICAgICAgcHVibGljIE9i\namVjdCBzdG9yZURhdGEgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nU3RydWN0IHRvIGhvbGQgdGhlIHVucGFyc2VkIHByb3BlcnRpZXMgYXNzb2Np\nYXRlZCB3aXRoIGEgcXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIENvbXBpbGF0aW9uS2V5CiAgICAgICAgaW1wbGVtZW50cyBTZXJp\nYWxpemFibGUgewoKICAgICAgICBwdWJsaWMgQ2xhc3MgcXVlcnlUeXBlID0g\nbnVsbDsKICAgICAgICBwdWJsaWMgQ2xhc3MgY2FuZGlkYXRlVHlwZSA9IG51\nbGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4gc3ViY2xhc3NlcyA9IHRydWU7\nCiAgICAgICAgcHVibGljIFN0cmluZyBxdWVyeSA9IG51bGw7CiAgICAgICAg\ncHVibGljIFN0cmluZyBsYW5ndWFnZSA9IG51bGw7CiAgICAgICAgcHVibGlj\nIE9iamVjdCBzdG9yZUtleSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBpbnQg\naGFzaENvZGUoKSB7CiAgICAgICAgICAgIGludCBycyA9IDE3OwogICAgICAg\nICAgICBycyA9IDM3ICogcnMgKyAoKHF1ZXJ5VHlwZSA9PSBudWxsKSA/IDAg\nOiBxdWVyeVR5cGUuaGFzaENvZGUoKSk7CiAgICAgICAgICAgIHJzID0gMzcg\nKiBycyArICgocXVlcnkgPT0gbnVsbCkgPyAwIDogcXVlcnkuaGFzaENvZGUo\nKSk7CiAgICAgICAgICAgIHJzID0gMzcgKiBycyArICgobGFuZ3VhZ2UgPT0g\nbnVsbCkgPyAwIDogbGFuZ3VhZ2UuaGFzaENvZGUoKSk7CiAgICAgICAgICAg\nIHJzID0gMzcgKiBycyArICgoc3RvcmVLZXkgPT0gbnVsbCkgPyAwIDogc3Rv\ncmVLZXkuaGFzaENvZGUoKSk7CiAgICAgICAgICAgIHJldHVybiByczsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG90aGVy\nID09IG51bGwgfHwgb3RoZXIuZ2V0Q2xhc3MoKSAhPSBnZXRDbGFzcygpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgQ29t\ncGlsYXRpb25LZXkga2V5ID0gKENvbXBpbGF0aW9uS2V5KSBvdGhlcjsKICAg\nICAgICAgICAgaWYgKGtleS5xdWVyeVR5cGUgIT0gcXVlcnlUeXBlCiAgICAg\nICAgICAgICAgICB8fCAhU3RyaW5nVXRpbHMuZXF1YWxzKGtleS5xdWVyeSwg\ncXVlcnkpCiAgICAgICAgICAgICAgICB8fCAhU3RyaW5nVXRpbHMuZXF1YWxz\nKGtleS5sYW5ndWFnZSwgbGFuZ3VhZ2UpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICAgICAgaWYgKCFPYmplY3RVdGlscy5lcXVh\nbHMoa2V5LnN0b3JlS2V5LCBzdG9yZUtleSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAvLyBhbGxvdyBlaXRoZXIgY2Fu\nZGlkYXRlIHR5cGUgdG8gYmUgbnVsbCBiZWNhdXNlIGl0IG1pZ2h0IGJlCiAg\nICAgICAgICAgIC8vIGVuY29kZWQgaW4gdGhlIHF1ZXJ5IHN0cmluZywgYnV0\nIGlmIGJvdGggYXJlIHNldCB0aGVuIHRoZXkKICAgICAgICAgICAgLy8gbXVz\ndCBiZSBlcXVhbAogICAgICAgICAgICBpZiAoY2FuZGlkYXRlVHlwZSAhPSBu\ndWxsICYmIGtleS5jYW5kaWRhdGVUeXBlICE9IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gY2FuZGlkYXRlVHlwZSA9PSBrZXkuY2FuZGlkYXRlVHlw\nZQogICAgICAgICAgICAgICAgICAgICYmIHN1YmNsYXNzZXMgPT0ga2V5LnN1\nYmNsYXNzZXM7CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBIG1lcmdlZCBleGVjdXRvciBleGVj\ndXRlcyBtdWx0aXBsZSBRdWVyaWVzIGFuZCByZXR1cm5zCiAgICAgKiBhIG1l\ncmdlZCByZXN1bHQgbGlzdCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBvcmRlcmlu\nZyAoaWYgbW9yZSB0aGFuCiAgICAgKiBvbmUgcXVlcnkgbmVlZHMgdG8gYmUg\nZXhlY3V0ZWQpLiBUaGlzIGV4ZWN1dG9yIGhhcyB0aGUgZm9sbG93aW5nCiAg\nICAgKiBsaW1pdGF0aW9uczoKICAgICAqIDx1bD4KICAgICAqIDxsaT5JdCBj\nYW5ub3QgY29tYmluZSBhZ2dyZWdhdGVzLgogICAgICogPGxpPkl0IGNhbm5v\ndCBjb2xsYXRlIHRoZSByZXN1bHQgbGlzdHMgaWYgb3JkZXJpbmcgaXMgc3Bl\nY2lmaWVkIGFuZAogICAgICogYSByZXN1bHQgc3RyaW5nIGlzIGdpdmVuLCBi\ndXQgZG9lcyBub3QgaW5jbHVkZSB0aGUgb3JkZXJpbmcKICAgICAqIGNyaXRl\ncmlhLjwvbGk+CiAgICAgKiA8bGk+SXQgY2Fubm90IGZpbHRlciBkdXBsaWNh\ndGUgcmVzdWx0cyBmcm9tIGRpZmZlcmVudCByZXN1bHQgbGlzdHMgaWYKICAg\nICAqIHRoZSByZXN1bHQgaXMgbWFya2VkIGRpc3RpbmN0LiBUaGlzIHdvdWxk\nIHJlcXVpcmUgdHJhY2tpbmcgYWxsCiAgICAgKiBwcmV2aW91cyByZXN1bHRz\nLCB3aGljaCB3b3VsZCBpbnRlcmZlcmUgd2l0aCBsYXJnZSByZXN1bHQgc2V0\nCiAgICAgKiBoYW5kbGluZy48L2xpPgogICAgICogPC91bD4KICAgICAqCiAg\nICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eAogICAgICogQG5vamF2\nYWRvYwogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBNZXJnZWRF\neGVjdXRvcgogICAgICAgIGltcGxlbWVudHMgU3RvcmVRdWVyeS5FeGVjdXRv\nciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgU3RvcmVRdWVyeS5FeGVjdXRv\ncltdIF9leGVjdXRvcnM7CgogICAgICAgIHB1YmxpYyBNZXJnZWRFeGVjdXRv\ncihTdG9yZVF1ZXJ5LkV4ZWN1dG9yW10gZXhlY3V0b3JzKSB7CiAgICAgICAg\nICAgIF9leGVjdXRvcnMgPSBleGVjdXRvcnM7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZVF1ZXJ5KFN0\nb3JlUXVlcnkgcSwKICAgICAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBTdG9y\nZVF1ZXJ5LlJhbmdlIHJhbmdlKSB7CiAgICAgICAgICAgIGlmIChfZXhlY3V0\nb3JzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJuIF9leGVj\ndXRvcnNbMF0uZXhlY3V0ZVF1ZXJ5KHEsIHBhcmFtcywgcmFuZ2UpOwoKICAg\nICAgICAgICAgLy8gdXNlIGxycyBzZXR0aW5ncyBpZiB3ZSBjb3VsZG4ndCB0\nYWtlIGFkdmFudGFnZSBvZiB0aGUgc3RhcnQgaW5kZXgKICAgICAgICAgICAg\nLy8gc28gdGhhdCBob3BlZnVsbHkgdGhlIHNraXAgdG8gdGhlIHN0YXJ0IHdp\nbGwgYmUgZWZmaWNpZW50CiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2Ug\ncm9wUmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZSgwLCByYW5nZS5lbmQp\nOwogICAgICAgICAgICByb3BSYW5nZS5scnMgPSByYW5nZS5scnMgfHwgKHJh\nbmdlLnN0YXJ0ID4gMCAmJiBxLmdldENvbnRleHQoKS4KICAgICAgICAgICAg\nICAgIGdldEZldGNoQ29uZmlndXJhdGlvbigpLmdldEZldGNoQmF0Y2hTaXpl\nKCkgPj0gMCk7CgogICAgICAgICAgICAvLyBleGVjdXRlIHRoZSBxdWVyeTsg\nd2UgY2Fubm90IHVzZSB0aGUgbG93ZXIgYm91bmQgb2YgdGhlIHJlc3VsdAog\nICAgICAgICAgICAvLyByYW5nZSwgYnV0IHdlIGNhbiB0YWtlIGFkdmFudGFn\nZSBvZiB0aGUgdXBwZXIgYm91bmQKICAgICAgICAgICAgUmVzdWx0T2JqZWN0\nUHJvdmlkZXJbXSByb3BzID0KICAgICAgICAgICAgICAgIG5ldyBSZXN1bHRP\nYmplY3RQcm92aWRlcltfZXhlY3V0b3JzLmxlbmd0aF07CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9ycy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgIHJvcHNbaV0gPSBfZXhlY3V0b3JzW2ldLmV4ZWN1\ndGVRdWVyeShxLCBwYXJhbXMsIHJvcFJhbmdlKTsKCiAgICAgICAgICAgIGJv\nb2xlYW5bXSBhc2MgPSBfZXhlY3V0b3JzWzBdLmdldEFzY2VuZGluZyhxKTsK\nICAgICAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wOwogICAgICAg\nICAgICBpZiAoYXNjLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcm9w\nID0gbmV3IE1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgT3JkZXJp\nbmdNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3BzLCBhc2MsCiAgICAg\nICAgICAgICAgICAgICAgX2V4ZWN1dG9ycywgcSwgcGFyYW1zKTsKCiAgICAg\nICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgbG93ZXIgYm91bmQsIHdyYXAgaW4g\ncmFuZ2Ugcm9wCiAgICAgICAgICAgIGlmIChyYW5nZS5zdGFydCAhPSAwKQog\nICAgICAgICAgICAgICAgcm9wID0gbmV3IFJhbmdlUmVzdWx0T2JqZWN0UHJv\ndmlkZXIocm9wLCByYW5nZS5zdGFydCwgCiAgICAgICAgICAgICAgICAgICAg\ncmFuZ2UuZW5kKTsKICAgICAgICAgICAgcmV0dXJuIHJvcDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBOdW1iZXIgZXhlY3V0ZURlbGV0ZShTdG9yZVF1\nZXJ5IHEsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgICAgICBsb25nIG51\nbSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1\ndG9ycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIG51bSArPSBfZXhl\nY3V0b3JzW2ldLmV4ZWN1dGVEZWxldGUocSwgcGFyYW1zKS5sb25nVmFsdWUo\nKTsKICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihudW0pOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIE51bWJlciBleGVjdXRlVXBkYXRl\nKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgICAg\nIGxvbmcgbnVtID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgbnVt\nICs9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZVVwZGF0ZShxLCBwYXJhbXMpLmxv\nbmdWYWx1ZSgpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKG51bSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0\nRGF0YVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFt\ncywKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSkgewogICAg\nICAgICAgICBpZiAoX2V4ZWN1dG9ycy5sZW5ndGggPT0gMSkKICAgICAgICAg\nICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldERhdGFTdG9yZUFjdGlv\nbnMocSwgcGFyYW1zLCByYW5nZSk7CgogICAgICAgICAgICBMaXN0IHJlc3Vs\ndHMgPSBuZXcgQXJyYXlMaXN0KF9leGVjdXRvcnMubGVuZ3RoKTsKICAgICAg\nICAgICAgU3RvcmVRdWVyeS5SYW5nZSByb3BSYW5nZSA9IG5ldyBTdG9yZVF1\nZXJ5LlJhbmdlKDBMLCByYW5nZS5lbmQpOwogICAgICAgICAgICBTdHJpbmdb\nXSBhY3Rpb25zOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9l\neGVjdXRvcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGFjdGlv\nbnMgPSBfZXhlY3V0b3JzW2ldLmdldERhdGFTdG9yZUFjdGlvbnMocSwgcGFy\nYW1zLHJvcFJhbmdlKTsKICAgICAgICAgICAgICAgIGlmIChhY3Rpb25zICE9\nIG51bGwgJiYgYWN0aW9ucy5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAg\nICAgIHJlc3VsdHMuYWRkQWxsKEFycmF5cy5hc0xpc3QoYWN0aW9ucykpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nW10pIHJl\nc3VsdHMudG9BcnJheShuZXcgU3RyaW5nW3Jlc3VsdHMuc2l6ZSgpXSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCB2YWxpZGF0ZShTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgX2V4ZWN1dG9yc1swXS52YWxpZGF0ZShx\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0\nb3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAgICAgICAgU3Rv\ncmVRdWVyeS5SYW5nZSByYW5nZSkgewogICAgICAgICAgICBfZXhlY3V0b3Jz\nWzBdLmdldFJhbmdlKHEsIHBhcmFtcywgcmFuZ2UpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVlKFN0b3JlUXVl\ncnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBPYmplY3QgcmVz\ndWx0T2JqZWN0LCBpbnQgaWR4KSB7CiAgICAgICAgICAgIC8vIHVuZm9ydHVu\nYXRlbHksIGF0IHRoaXMgcG9pbnQgKG11c3QgYmUgYSBtZXJnZWQgcm9wIGNv\nbnRhaW5pbmcKICAgICAgICAgICAgLy8gb3RoZXIgbWVyZ2VkIHJvcHMpIHdl\nIGhhdmUgbm8gaWRlYSB3aGljaCBleGVjdXRvciB0byBleHRyYWN0CiAgICAg\nICAgICAgIC8vIHRoZSB2YWx1ZSBmcm9tCiAgICAgICAgICAgIHJldHVybiBf\nZXhlY3V0b3JzWzBdLmdldE9yZGVyaW5nVmFsdWUocSwgcGFyYW1zLCByZXN1\nbHRPYmplY3QsIGlkeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbltdIGdldEFzY2VuZGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0QXNjZW5kaW5nKHEpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRBbGlhcyhTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0\nQWxpYXMocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10g\nZ2V0UHJvamVjdGlvbkFsaWFzZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFByb2plY3Rpb25BbGlhc2Vz\nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIENsYXNzIGdldFJlc3Vs\ndENsYXNzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4\nZWN1dG9yc1swXS5nZXRSZXN1bHRDbGFzcyhxKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBDbGFzc1tdIGdldFByb2plY3Rpb25UeXBlcyhTdG9yZVF1\nZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0\nUHJvamVjdGlvblR5cGVzKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaXNQYWNraW5nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gX2V4ZWN1dG9yc1swXS5pc1BhY2tpbmcocSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtdIGdldEFjY2Vzc1Bh\ndGhNZXRhRGF0YXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIGlmIChf\nZXhlY3V0b3JzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJu\nIF9leGVjdXRvcnNbMF0uZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhxKTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBzZXQgb2YgYmFzZSBjbGFzcyBtZXRhZGF0\nYXMgaW4gYWNjZXNzIHBhdGgKICAgICAgICAgICAgTGlzdCBtZXRhcyA9IG51\nbGw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2V4ZWN1dG9y\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIG1ldGFzID0gRmlsdGVy\ncy5hZGRBY2Nlc3NQYXRoTWV0YURhdGFzKG1ldGFzLCBfZXhlY3V0b3JzW2ld\nLgogICAgICAgICAgICAgICAgICAgIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMo\ncSkpOwogICAgICAgICAgICBpZiAobWV0YXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBTdG9yZVF1ZXJ5LkVNUFRZX01FVEFTOwogICAgICAg\nICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgbWV0YXMudG9BcnJheQog\nICAgICAgICAgICAgICAgKG5ldyBDbGFzc01ldGFEYXRhW21ldGFzLnNpemUo\nKV0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNBZ2dy\nZWdhdGUoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIGlmICghX2V4ZWN1\ndG9yc1swXS5pc0FnZ3JlZ2F0ZShxKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHdlIGNhbid0IG1lcmdlIGFnZ3Jl\nZ2F0ZXMKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKF9sb2MuZ2V0KCJtZXJnZWQtYWdncmVnYXRlIiwKICAgICAgICAgICAg\nICAgIHEuZ2V0Q29udGV4dCgpLmdldENhbmRpZGF0ZVR5cGUoKSwKICAgICAg\nICAgICAgICAgIHEuZ2V0Q29udGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCkpKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0T3BlcmF0aW9uKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1sw\nXS5nZXRPcGVyYXRpb24ocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNHcm91cGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uaGFzR3JvdXBpbmcocSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgTGlua2VkTWFwIGdldFBhcmFtZXRlclR5\ncGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4ZWN1\ndG9yc1swXS5nZXRQYXJhbWV0ZXJUeXBlcyhxKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBNYXAgZ2V0VXBkYXRlcyhTdG9yZVF1ZXJ5IHEpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0VXBkYXRlcyhxKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXN1bHQgb2JqZWN0\nIHByb3ZpZGVyIHRoYXQgcGFja3MgcmVzdWx0cyBiZWZvcmUgcmV0dXJuaW5n\nIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFBhY2tp\nbmdSZXN1bHRPYmplY3RQcm92aWRlcgogICAgICAgIGltcGxlbWVudHMgUmVz\ndWx0T2JqZWN0UHJvdmlkZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFJl\nc3VsdE9iamVjdFByb3ZpZGVyIF9kZWxlZ2F0ZTsKICAgICAgICBwcml2YXRl\nIGZpbmFsIFJlc3VsdFBhY2tlciBfcGFja2VyOwogICAgICAgIHByaXZhdGUg\nZmluYWwgaW50IF9sZW47CgogICAgICAgIHB1YmxpYyBQYWNraW5nUmVzdWx0\nT2JqZWN0UHJvdmlkZXIoUmVzdWx0T2JqZWN0UHJvdmlkZXIgZGVsZWdhdGUs\nCiAgICAgICAgICAgIFJlc3VsdFBhY2tlciBwYWNrZXIsIGludCByZXN1bHRM\nZW5ndGgpIHsKICAgICAgICAgICAgX2RlbGVnYXRlID0gZGVsZWdhdGU7CiAg\nICAgICAgICAgIF9wYWNrZXIgPSBwYWNrZXI7CiAgICAgICAgICAgIF9sZW4g\nPSByZXN1bHRMZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2VzcygpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9kZWxlZ2F0ZS5zdXBwb3J0c1JhbmRvbUFjY2VzcygpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3BlbigpCiAgICAgICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBfZGVsZWdhdGUub3Blbigp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRSZXN1bHRP\nYmplY3QoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgT2JqZWN0IG9iID0gX2RlbGVnYXRlLmdldFJlc3VsdE9iamVjdCgp\nOwogICAgICAgICAgICBpZiAoX3BhY2tlciA9PSBudWxsICYmIF9sZW4gPT0g\nMSkKICAgICAgICAgICAgICAgIHJldHVybiAoKE9iamVjdFtdKSBvYilbMF07\nCiAgICAgICAgICAgIGlmIChfcGFja2VyID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gb2I7CiAgICAgICAgICAgIGlmIChfbGVuID09IDApCiAg\nICAgICAgICAgICAgICByZXR1cm4gX3BhY2tlci5wYWNrKG9iKTsKICAgICAg\nICAgICAgcmV0dXJuIF9wYWNrZXIucGFjaygoT2JqZWN0W10pIG9iKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIG5leHQoKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIF9k\nZWxlZ2F0ZS5uZXh0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBhYnNvbHV0ZShpbnQgcG9zKQogICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5hYnNvbHV0\nZShwb3MpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkK\nICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJl\ndHVybiBfZGVsZWdhdGUuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgcmVzZXQoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgX2RlbGVnYXRlLnJlc2V0KCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpCiAgICAgICAgICAgIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgICAgICBfZGVsZWdhdGUuY2xvc2UoKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGhhbmRsZUNoZWNrZWRF\neGNlcHRpb24oRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgX2RlbGVnYXRl\nLmhhbmRsZUNoZWNrZWRFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmVzdWx0IGxpc3QgdGhhdCByZW1vdmVzIGl0c2Vs\nZiBmcm9tIHRoZSBxdWVyeSdzIG9wZW4gcmVzdWx0IGxpc3QKICAgICAqIHdo\nZW4gaXQgaXMgY2xvc2VkLiBQdWJsaWMgZm9yIHRlc3RpbmcuCiAgICAgKi8K\nICAgIHB1YmxpYyBjbGFzcyBSZW1vdmVPbkNsb3NlUmVzdWx0TGlzdAogICAg\nICAgIGltcGxlbWVudHMgUmVzdWx0TGlzdCB7CgogICAgICAgIHByaXZhdGUg\nZmluYWwgUmVzdWx0TGlzdCBfcmVzOwoKICAgICAgICBwdWJsaWMgUmVtb3Zl\nT25DbG9zZVJlc3VsdExpc3QoUmVzdWx0TGlzdCByZXMpIHsKICAgICAgICAg\nICAgX3JlcyA9IHJlczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZXN1\nbHRMaXN0IGdldERlbGVnYXRlKCkgewogICAgICAgICAgICByZXR1cm4gX3Jl\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzUHJvdmlk\nZXJPcGVuKCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5pc1Byb3ZpZGVy\nT3BlbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXND\nbG9zZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmlzQ2xvc2VkKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAg\nICAgICAgICAgY2xvc2UodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBjbG9zZShib29sZWFuIHJlbW92ZSkgewogICAgICAgICAgICBp\nZiAoaXNDbG9zZWQoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgICAgIF9yZXMuY2xvc2UoKTsKICAgICAgICAgICAgaWYgKCFyZW1vdmUp\nCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBsb2NrKCk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBkb24ndCB1\nc2Ugc3RhbmRhcmQgX3Jlc3VsdExpc3RzLnJlbW92ZSBtZXRob2QgYi9jIHJl\nbGllcyBvbgogICAgICAgICAgICAgICAgLy8gY29sbGVjdGlvbiBlcXVhbGl0\neSwgd2hpY2ggcmVsaWVzIG9uIGVsZW1lbnQgZXF1YWxpdHksIHdoaWNoCiAg\nICAgICAgICAgICAgICAvLyBtZWFucyB3ZSBlbmQgdXAgdHJhdmVyc2luZyBl\nbnRpcmUgcmVzdWx0IGxpc3RzIQogICAgICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBfcmVzdWx0TGlzdHMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRyLm5leHQoKSA9\nPSB0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9yZXMuaXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0IG8pIHsKICAgICAgICAgICAgcmV0\ndXJuIF9yZXMuY29udGFpbnMobyk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBf\ncmVzLml0ZXJhdG9yKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2Jq\nZWN0W10gdG9BcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMudG9B\ncnJheSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdFtdIHRv\nQXJyYXkoT2JqZWN0W10gYSkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy50\nb0FycmF5KGEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nYWRkKE9iamVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmFkZChv\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShP\nYmplY3QgbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5yZW1vdmUobyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWluc0Fs\nbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuY29u\ndGFpbnNBbGwoYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBhZGRBbGwoQ29sbGVjdGlvbiBjKSB7CiAgICAgICAgICAgIHJldHVybiBf\ncmVzLmFkZEFsbChjKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGFkZEFsbChpbnQgaWR4LCBDb2xsZWN0aW9uIGMpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMuYWRkQWxsKGlkeCwgYyk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVBbGwoQ29sbGVjdGlvbiBjKSB7\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLnJlbW92ZUFsbChjKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHJldGFpbkFsbChDb2xsZWN0\naW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMucmV0YWluQWxsKGMp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAg\nICAgICAgICAgIF9yZXMuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBPYmplY3QgZ2V0KGludCBpZHgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9yZXMuZ2V0KGlkeCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2Jq\nZWN0IHNldChpbnQgaWR4LCBPYmplY3QgbykgewogICAgICAgICAgICByZXR1\ncm4gX3Jlcy5zZXQoaWR4LCBvKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIGFkZChpbnQgaWR4LCBPYmplY3QgbykgewogICAgICAgICAgICBf\ncmVzLmFkZChpZHgsIG8pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9i\namVjdCByZW1vdmUoaW50IGlkeCkgewogICAgICAgICAgICByZXR1cm4gX3Jl\ncy5yZW1vdmUoaWR4KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQg\naW5kZXhPZihPYmplY3QgbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5p\nbmRleE9mKG8pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBsYXN0\nSW5kZXhPZihPYmplY3QgbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5s\nYXN0SW5kZXhPZihvKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBMaXN0\nSXRlcmF0b3IgbGlzdEl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4g\nX3Jlcy5saXN0SXRlcmF0b3IoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBMaXN0SXRlcmF0b3IgbGlzdEl0ZXJhdG9yKGludCBpZHgpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9yZXMubGlzdEl0ZXJhdG9yKGlkeCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgTGlzdCBzdWJMaXN0KGludCBzdGFydCwgaW50\nIGVuZCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5zdWJMaXN0KHN0YXJ0\nLCBlbmQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1\nYWxzKE9iamVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmVxdWFs\ncyhvKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmhhc2hDb2RlKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nICgpCgkJewoJ\nCQlyZXR1cm4gX3Jlcy50b1N0cmluZyAoKTsKCQl9CgoJCXB1YmxpYyBPYmpl\nY3Qgd3JpdGVSZXBsYWNlICgpCgkJewoJCQlyZXR1cm4gX3JlczsKCQl9Cgl9\nCn0K\n","encoding":"base64"}

