{"sha":"ed9bcd22bda9c710439ef84f8f4e9bf81e26a0d0","node_id":"MDQ6QmxvYjIwNjM2NDplZDliY2QyMmJkYTljNzEwNDM5ZWY4NGY4ZjRlOWJmODFlMjZhMGQw","size":12856,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ed9bcd22bda9c710439ef84f8f4e9bf81e26a0d0","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuQ29u\nc3RydWN0b3I7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1lbWJlcjsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFs\nOwppbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBvcnQg\namF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuR3JlZ29yaWFuQ2Fs\nZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVzZXJFeGNlcHRpb247CgovKioKICogSGVscGVyIGNsYXNzIHRvIHBh\nY2sgcmVzdWx0cyBpbnRvIHRoZSByZXN1bHQgY2xhc3Mgc2V0IG9uIHRoZSBx\ndWVyeS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQGF1dGhvciBQYXRy\naWNrIExpbnNrZXkKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIFJl\nc3VsdFBhY2tlciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChSZXN1\nbHRQYWNrZXIuY2xhc3MpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU2V0\nIF9zdGRUeXBlcyA9IG5ldyBIYXNoU2V0KCk7CgogICAgc3RhdGljIHsKICAg\nICAgICBfc3RkVHlwZXMuYWRkKE9iamVjdFtdLmNsYXNzKTsKICAgICAgICBf\nc3RkVHlwZXMuYWRkKE9iamVjdC5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVz\nLmFkZChNYXAuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoSGFzaE1h\ncC5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChDaGFyYWN0ZXIuY2xh\nc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoQm9vbGVhbi5jbGFzcyk7CiAg\nICAgICAgX3N0ZFR5cGVzLmFkZChCeXRlLmNsYXNzKTsKICAgICAgICBfc3Rk\nVHlwZXMuYWRkKFNob3J0LmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMuYWRk\nKEludGVnZXIuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoTG9uZy5j\nbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChGbG9hdC5jbGFzcyk7CiAg\nICAgICAgX3N0ZFR5cGVzLmFkZChEb3VibGUuY2xhc3MpOwogICAgICAgIF9z\ndGRUeXBlcy5hZGQoU3RyaW5nLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMu\nYWRkKEJpZ0ludGVnZXIuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQo\nQmlnRGVjaW1hbC5jbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChEYXRl\nLmNsYXNzKTsKICAgICAgICBfc3RkVHlwZXMuYWRkKGphdmEuc3FsLkRhdGUu\nY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoamF2YS5zcWwuVGltZS5j\nbGFzcyk7CiAgICAgICAgX3N0ZFR5cGVzLmFkZChqYXZhLnNxbC5UaW1lc3Rh\nbXAuY2xhc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoQ2FsZW5kYXIuY2xh\nc3MpOwogICAgICAgIF9zdGRUeXBlcy5hZGQoR3JlZ29yaWFuQ2FsZW5kYXIu\nY2xhc3MpOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgQ2xhc3MgX3Jlc3Vs\ndENsYXNzOwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmdbXSBfYWxpYXNlczsK\nICAgIHByaXZhdGUgZmluYWwgTWVtYmVyW10gX3NldHM7CiAgICBwcml2YXRl\nIGZpbmFsIE1ldGhvZCBfcHV0OwogICAgcHJpdmF0ZSBmaW5hbCBDb25zdHJ1\nY3RvciBfY29uc3RydWN0b3I7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rv\nciBmb3IgcmVzdWx0IGNsYXNzIHdpdGhvdXQgYSBwcm9qZWN0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgUmVzdWx0UGFja2VyKENsYXNzIGNhbmRpZGF0ZSwg\nU3RyaW5nIGFsaWFzLCBDbGFzcyByZXN1bHRDbGFzcykgewogICAgICAgIHRo\naXMoY2FuZGlkYXRlLCBudWxsLCBuZXcgU3RyaW5nW117IGFsaWFzIH0sIHJl\nc3VsdENsYXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9y\nIGZvciBzdGFuZGFyZCBwcm9qZWN0aW9uLgogICAgICoKICAgICAqIEBwYXJh\nbSB0eXBlcyB0aGUgcHJvamVjdGlvbiB2YWx1ZSB0eXBlcwogICAgICogQHBh\ncmFtIGFsaWFzZXMgdGhlIGFsaWFzIGZvciBlYWNoIHByb2plY3Rpb24gdmFs\ndWUKICAgICAqIEBwYXJhbSByZXN1bHRDbGFzcyB0aGUgY2xhc3MgdG8gcGFj\nayBpbnRvCiAgICAgKi8KICAgIHB1YmxpYyBSZXN1bHRQYWNrZXIoQ2xhc3Nb\nXSB0eXBlcywgU3RyaW5nW10gYWxpYXNlcywgQ2xhc3MgcmVzdWx0Q2xhc3Mp\nIHsKICAgICAgICB0aGlzKG51bGwsIHR5cGVzLCBhbGlhc2VzLCByZXN1bHRD\nbGFzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBjb25zdHJ1\nY3Rvci4KICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHRQYWNrZXIoQ2xhc3Mg\nY2FuZGlkYXRlLCBDbGFzc1tdIHR5cGVzLCBTdHJpbmdbXSBhbGlhc2VzLAog\nICAgICAgIENsYXNzIHJlc3VsdENsYXNzKSB7CiAgICAgICAgX2FsaWFzZXMg\nPSBhbGlhc2VzOwogICAgICAgIGlmIChyZXN1bHRDbGFzcy5pc1ByaW1pdGl2\nZSgpKSB7CiAgICAgICAgICAgIGFzc2VydENvbnZlcnRhYmxlKGNhbmRpZGF0\nZSwgdHlwZXMsIHJlc3VsdENsYXNzKTsKICAgICAgICAgICAgX3Jlc3VsdENs\nYXNzID0gRmlsdGVycy53cmFwKHJlc3VsdENsYXNzKTsKICAgICAgICAgICAg\nX3NldHMgPSBudWxsOwogICAgICAgICAgICBfcHV0ID0gbnVsbDsKICAgICAg\nICAgICAgX2NvbnN0cnVjdG9yID0gbnVsbDsKICAgICAgICB9IGVsc2UgaWYg\nKCFfc3RkVHlwZXMuY29udGFpbnMoX3Jlc3VsdENsYXNzID0gcmVzdWx0Q2xh\nc3MpKSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBhIGNvbnN0cnVjdG9y\nIHRoYXQgbWF0Y2hlcyB0aGUgcHJvamVjdGlvbiB0eXBlcwogICAgICAgICAg\nICBDb25zdHJ1Y3RvciBjb25zID0gbnVsbDsKICAgICAgICAgICAgaWYgKHR5\ncGVzICE9IG51bGwgJiYgdHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25zID0gX3Jlc3Vs\ndENsYXNzLmdldENvbnN0cnVjdG9yKHR5cGVzKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2NvbnN0\ncnVjdG9yID0gY29uczsKCiAgICAgICAgICAgIGlmIChjb25zID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIE1ldGhvZFtdIG1ldGhvZHMgPSBfcmVzdWx0\nQ2xhc3MuZ2V0TWV0aG9kcygpOwogICAgICAgICAgICAgICAgRmllbGRbXSBm\naWVsZHMgPSBfcmVzdWx0Q2xhc3MuZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nICAgICBfcHV0ID0gZmluZFB1dChtZXRob2RzKTsKICAgICAgICAgICAgICAg\nIF9zZXRzID0gbmV3IE1lbWJlclthbGlhc2VzLmxlbmd0aF07CgogICAgICAg\nICAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgX3NldHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICB0eXBlID0gKHR5cGVzID09IG51bGwpID8gY2FuZGlkYXRlIDog\ndHlwZXNbaV07CiAgICAgICAgICAgICAgICAgICAgX3NldHNbaV0gPSBmaW5k\nU2V0KGFsaWFzZXNbaV0sIHR5cGUsIGZpZWxkcywgbWV0aG9kcyk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKF9zZXRzW2ldID09IG51bGwgJiYgX3B1dCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1zZXQiLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmVzdWx0Q2xhc3MsIGFsaWFzZXNbaV0sCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB0eXBlcyA9PSBudWxsID8gbnVsbCA6\nIEFycmF5cy5hc0xpc3QodHlwZXMpKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfc2V0cyA9IG51\nbGw7CiAgICAgICAgICAgICAgICBfcHV0ID0gbnVsbDsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChyZXN1bHRDbGFz\ncyAhPSBNYXAuY2xhc3MgJiYgcmVzdWx0Q2xhc3MgIT0gSGFzaE1hcC5jbGFz\ncwogICAgICAgICAgICAgICAgJiYgcmVzdWx0Q2xhc3MgIT0gT2JqZWN0W10u\nY2xhc3MpCiAgICAgICAgICAgICAgICBhc3NlcnRDb252ZXJ0YWJsZShjYW5k\naWRhdGUsIHR5cGVzLCByZXN1bHRDbGFzcyk7CiAgICAgICAgICAgIF9zZXRz\nID0gbnVsbDsKICAgICAgICAgICAgX3B1dCA9IG51bGw7CiAgICAgICAgICAg\nIF9jb25zdHJ1Y3RvciA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogRW5zdXJlIHRoYXQgY29udmVyc2lvbiBpcyBwb3NzaWJsZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydENvbnZlcnRhYmxlKENs\nYXNzIGNhbmRpZGF0ZSwgQ2xhc3NbXSB0eXBlcywKICAgICAgICBDbGFzcyBy\nZXN1bHRDbGFzcykgewogICAgICAgIENsYXNzIGMgPSAodHlwZXMgPT0gbnVs\nbCkgPyBjYW5kaWRhdGUgOiB0eXBlc1swXTsKICAgICAgICBpZiAoKHR5cGVz\nICE9IG51bGwgJiYgdHlwZXMubGVuZ3RoICE9IDEpIHx8IChjICE9IG51bGwK\nICAgICAgICAgICAgJiYgYyAhPSBPYmplY3QuY2xhc3MgJiYgIUZpbHRlcnMu\nY2FuQ29udmVydChjLCByZXN1bHRDbGFzcywgdHJ1ZSkpKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1jb252\nZXJ0LXJlc3VsdCIsCiAgICAgICAgICAgICAgICBjLCByZXN1bHRDbGFzcykp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFjayB0aGUgZ2l2ZW4gb2JqZWN0\nIGludG8gYW4gaW5zdGFuY2Ugb2YgdGhlIHF1ZXJ5J3MgcmVzdWx0IGNsYXNz\nLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IHBhY2soT2JqZWN0IHJlc3Vs\ndCkgewogICAgICAgIC8vIHNwZWNpYWwgY2FzZXMgZm9yIGVmZmljaWVudCBi\nYXNpYyB0eXBlcyB3aGVyZSB3ZSB3YW50IHRvIGF2b2lkCiAgICAgICAgLy8g\nY3JlYXRpbmcgYW4gYXJyYXkgZm9yIGNhbGwgdG8gZ2VuZXJhbCBwYWNrIG1l\ndGhvZCBiZWxvdwogICAgICAgIGlmIChfcmVzdWx0Q2xhc3MgPT0gT2JqZWN0\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIGlm\nIChfcmVzdWx0Q2xhc3MgPT0gT2JqZWN0W10uY2xhc3MpCiAgICAgICAgICAg\nIHJldHVybiBuZXcgT2JqZWN0W117IHJlc3VsdCB9OwogICAgICAgIGlmIChf\ncmVzdWx0Q2xhc3MgPT0gSGFzaE1hcC5jbGFzcyB8fCBfcmVzdWx0Q2xhc3Mg\nPT0gTWFwLmNsYXNzKSB7CiAgICAgICAgICAgIEhhc2hNYXAgbWFwID0gbmV3\nIEhhc2hNYXAoMSwgMUYpOwogICAgICAgICAgICBtYXAucHV0KF9hbGlhc2Vz\nWzBdLCByZXN1bHQpOwogICAgICAgICAgICByZXR1cm4gbWFwOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcHJpbWl0aXZlIG9yIHNpbXBsZSB0eXBlPwogICAg\nICAgIGlmIChfY29uc3RydWN0b3IgPT0gbnVsbCAmJiBfc2V0cyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gRmlsdGVycy5jb252ZXJ0KHJlc3VsdCwg\nX3Jlc3VsdENsYXNzKTsKCiAgICAgICAgLy8gdGhpcyBpcyBzb21lIGNvbXBs\nZXggY2FzZSwgc28gd29ydGggaXQgdG8gY3JlYXRlIHRoZSBhcnJheSBhbmQK\nICAgICAgICAvLyB1c2UgdGhlIGdlbmVyYWwgcGFjayBtZXRob2QKICAgICAg\nICByZXR1cm4gcGFja1VzZXJUeXBlKG5ldyBPYmplY3RbXXsgcmVzdWx0IH0p\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFjayB0aGUgZ2l2ZW4gYXJyYXkg\naW50byBhbiBpbnN0YW5jZSBvZiB0aGUgcXVlcnkncyByZXN1bHQgY2xhc3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgcGFjayhPYmplY3RbXSByZXN1\nbHQpIHsKICAgICAgICBpZiAocmVzdWx0ID09IG51bGwgfHwgcmVzdWx0Lmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nLy8gc3BlY2lhbCBjYXNlcyBmb3Igb2JqZWN0IGFycmF5cyBhbmQgbWFwcwog\nICAgICAgIGlmIChfcmVzdWx0Q2xhc3MgPT0gT2JqZWN0W10uY2xhc3MpIHsK\nICAgICAgICAgICAgLy8gdGhlIHJlc3VsdCBtaWdodCBjb250YWluIGV4dHJh\nIGRhdGEgYXQgdGhlIGVuZAogICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0\naCA+IF9hbGlhc2VzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgT2JqZWN0\nW10gdHJpbSA9IG5ldyBPYmplY3RbX2FsaWFzZXMubGVuZ3RoXTsKICAgICAg\nICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkocmVzdWx0LCAwLCB0cmltLCAw\nLCB0cmltLmxlbmd0aCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJpbTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nICAgIH0KICAgICAgICBpZiAoX3Jlc3VsdENsYXNzID09IE9iamVjdC5jbGFz\ncykKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFswXTsKICAgICAgICBpZiAo\nX3Jlc3VsdENsYXNzID09IEhhc2hNYXAuY2xhc3MgfHwgX3Jlc3VsdENsYXNz\nID09IE1hcC5jbGFzcykgewogICAgICAgICAgICBNYXAgbWFwID0gbmV3IEhh\nc2hNYXAocmVzdWx0Lmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgX2FsaWFzZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBtYXAucHV0KF9hbGlhc2VzW2ldLCByZXN1bHRbaV0pOwogICAgICAgICAg\nICByZXR1cm4gbWFwOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJpbWl0aXZl\nIG9yIHNpbXBsZSB0eXBlPwogICAgICAgIGlmIChfc2V0cyA9PSBudWxsICYm\nIF9jb25zdHJ1Y3RvciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gRmls\ndGVycy5jb252ZXJ0KHJlc3VsdFswXSwgX3Jlc3VsdENsYXNzKTsKCiAgICAg\nICAgLy8gbXVzdCBiZSBhIHVzZXItZGVmaW5lZCB0eXBlCiAgICAgICAgcmV0\ndXJuIHBhY2tVc2VyVHlwZShyZXN1bHQpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFjayB0aGUgZ2l2ZW4gcmVzdWx0IGludG8gdGhlIHVzZXItZGVmaW5l\nZCByZXN1bHQgY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IHBh\nY2tVc2VyVHlwZShPYmplY3RbXSByZXN1bHQpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyB1c2UgdGhlIGNvbnN0cnVjdG9yIGZpcnN0LCBpZiB3\nZSBoYXZlIG9uZQogICAgICAgICAgICBpZiAoX2NvbnN0cnVjdG9yICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnN0cnVjdG9yLm5ld0lu\nc3RhbmNlKHJlc3VsdCk7CgogICAgICAgICAgICBPYmplY3QgdXNlciA9IF9y\nZXN1bHRDbGFzcy5uZXdJbnN0YW5jZSgpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9hbGlhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBpZiAoX3NldHNbaV0gaW5zdGFuY2VvZiBNZXRob2QpIHsKICAg\nICAgICAgICAgICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIF9zZXRz\nW2ldOwogICAgICAgICAgICAgICAgICAgIG1ldGguaW52b2tlKHVzZXIsIG5l\ndyBPYmplY3RbXXsgRmlsdGVycy5jb252ZXJ0CiAgICAgICAgICAgICAgICAg\nICAgICAgIChyZXN1bHRbaV0sIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKVsw\nXSkgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9zZXRzW2ldIGlu\nc3RhbmNlb2YgRmllbGQpIHsKICAgICAgICAgICAgICAgICAgICBGaWVsZCBm\naWVsZCA9IChGaWVsZCkgX3NldHNbaV07CiAgICAgICAgICAgICAgICAgICAg\nZmllbGQuc2V0KHVzZXIsIEZpbHRlcnMuY29udmVydChyZXN1bHRbaV0sCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldFR5cGUoKSkpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChfcHV0ICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICBfcHV0Lmludm9rZSh1c2VyLCBuZXcgT2JqZWN0W117\nIF9hbGlhc2VzW2ldLCByZXN1bHRbaV0gfSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVzZXI7CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChJbnN0YW50aWF0aW9uRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJwYWNrLWluc3RhbnRpYXRpb24tZXJyIiwKICAgICAg\nICAgICAgICAgIF9yZXN1bHRDbGFzcyksIGllKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgicGFjay1lcnIiLCBfcmVzdWx0Q2xhc3MpLCBl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHNldCBtZXRob2QgZm9yIHRoZSBnaXZlbiBwcm9wZXJ0eS4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgTWVtYmVyIGZpbmRTZXQoU3RyaW5nIGFsaWFz\nLCBDbGFzcyB0eXBlLCBGaWVsZFtdIGZpZWxkcywKICAgICAgICBNZXRob2Rb\nXSBtZXRob2RzKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nYWxpYXMpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\ndHlwZSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHR5cGUgPSBudWxs\nOwoKICAgICAgICAvLyBjaGVjayBwdWJsaWMgZmllbGRzIGZpcnN0CiAgICAg\nICAgRmllbGQgZmllbGQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGlm\nIHdlIGZpbmQgYSBmaWVsZCB3aXRoIHRoZSBleGFjdCBuYW1lLCBlaXRoZXIg\ncmV0dXJuIGl0CiAgICAgICAgICAgIC8vIGlmIGl0J3MgdGhlIHJpZ2h0IHR5\ncGUgb3IgZ2l2ZSB1cCBpZiBpdCdzIG5vdAogICAgICAgICAgICBpZiAoZmll\nbGRzW2ldLmdldE5hbWUoKS5lcXVhbHMoYWxpYXMpKSB7CiAgICAgICAgICAg\nICAgICBpZiAodHlwZSA9PSBudWxsCiAgICAgICAgICAgICAgICAgICAgfHwg\nRmlsdGVycy5jYW5Db252ZXJ0KHR5cGUsIGZpZWxkc1tpXS5nZXRUeXBlKCks\nIHRydWUpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZHNbaV07\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gb3RoZXJ3aXNlIGlmIHdlIGZpbmQgYSBmaWVsZCB3aXRoIHRo\nZSByaWdodCBuYW1lIGJ1dCB0aGUKICAgICAgICAgICAgLy8gd3JvbmcgY2Fz\nZSwgcmVjb3JkIGl0IGFuZCBpZiB3ZSBkb24ndCBmaW5kIGFuIGV4YWN0IG1h\ndGNoCiAgICAgICAgICAgIC8vIGZvciBhIGZpZWxkIG9yIHNldHRlciB3ZSds\nbCB1c2UgaXQKICAgICAgICAgICAgaWYgKGZpZWxkID09IG51bGwgJiYgZmll\nbGRzW2ldLmdldE5hbWUoKS5lcXVhbHNJZ25vcmVDYXNlKGFsaWFzKQogICAg\nICAgICAgICAgICAgJiYgKHR5cGUgPT0gbnVsbAogICAgICAgICAgICAgICAg\nfHwgRmlsdGVycy5jYW5Db252ZXJ0KHR5cGUsIGZpZWxkc1tpXS5nZXRUeXBl\nKCksIHRydWUpKSkKICAgICAgICAgICAgICAgIGZpZWxkID0gZmllbGRzW2ld\nOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgc2V0dGVyIG1ldGhvZHMK\nICAgICAgICBTdHJpbmcgc2V0TmFtZSA9ICJzZXQiICsgQ2hhcmFjdGVyLnRv\nVXBwZXJDYXNlKGFsaWFzLmNoYXJBdCgwKSk7CiAgICAgICAgaWYgKGFsaWFz\nLmxlbmd0aCgpID4gMSkKICAgICAgICAgICAgc2V0TmFtZSA9IHNldE5hbWUg\nKyBhbGlhcy5zdWJzdHJpbmcoMSk7CgogICAgICAgIE1ldGhvZCBtZXRob2Qg\nPSBudWxsOwogICAgICAgIGJvb2xlYW4gZXFOYW1lID0gZmFsc2U7CiAgICAg\nICAgQ2xhc3NbXSBwYXJhbXM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBtZXRob2RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghbWV0\naG9kc1tpXS5nZXROYW1lKCkuZXF1YWxzSWdub3JlQ2FzZShzZXROYW1lKSkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBwYXJhbXMg\nPSBtZXRob2RzW2ldLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgICAg\nIGlmIChwYXJhbXMubGVuZ3RoICE9IDEpCiAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgIGlmICh0eXBlICE9IG51bGwgJiYgcGFyYW1z\nWzBdID09IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICAgICAgLy8gd2Ug\nZm91bmQgYSBnZW5lcmljIG9iamVjdCBzZXR0ZXI7IG5vdyBzZWUgaWYgdGhl\nIG5hbWUKICAgICAgICAgICAgICAgIC8vIGlzIGFuIGV4YWN0IG1hdGNoLCBh\nbmQgaWYgc28gcmVjb3JkIHRoaXMgc2V0dGVyLiAgaWYgd2UKICAgICAgICAg\nICAgICAgIC8vIGRvbid0IGZpbmQgYW4gZXhhY3QgdHlwZSBtYXRjaCBsYXRl\nciwgd2UnbGwgdXNlIGl0LiAgaWYKICAgICAgICAgICAgICAgIC8vIHRoZSBu\nYW1lcyBhcmUgbm90IGFuIGV4YWN0IG1hdGNoLCBvbmx5IHJlY29yZCB0aGlz\nIHNldHRlcgogICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZW4ndCBmb3Vu\nZCBhbnkgb3RoZXJzIHRoYXQgbWF0Y2ggYXQgYWxsCiAgICAgICAgICAgICAg\nICBpZiAobWV0aG9kc1tpXS5nZXROYW1lKCkuZXF1YWxzKHNldE5hbWUpKSB7\nCiAgICAgICAgICAgICAgICAgICAgZXFOYW1lID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgICAgICBtZXRob2QgPSBtZXRob2RzW2ldOwogICAgICAgICAgICAg\nICAgfSBlbHNlIGlmIChtZXRob2QgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBtZXRob2QgPSBtZXRob2RzW2ldOwogICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCB8fCBGaWx0ZXJzLmNhbkNv\nbnZlcnQodHlwZSwgcGFyYW1zWzBdLCB0cnVlKSkgewogICAgICAgICAgICAg\nICAgLy8gd2UgZm91bmQgYSBzZXR0ZXIgd2l0aCB0aGUgcmlnaHQgdHlwZTsg\nbm93IHNlZSBpZiB0aGUgbmFtZQogICAgICAgICAgICAgICAgLy8gaXMgYW4g\nZXhhY3QgbWF0Y2guICBpZiBzbywgcmV0dXJuIHRoZSBzZXR0ZXIuICBpZiBu\nb3QsCiAgICAgICAgICAgICAgICAvLyByZWNvcmQgdGhlIHNldHRlciBvbmx5\nIGlmIHdlIGhhdmVuJ3QgZm91bmQgYSBnZW5lcmljIG9uZQogICAgICAgICAg\nICAgICAgLy8gd2l0aCBhbiBleGFjdCBuYW1lIG1hdGNoCiAgICAgICAgICAg\nICAgICBpZiAobWV0aG9kc1tpXS5nZXROYW1lKCkuZXF1YWxzKHNldE5hbWUp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzW2ldOwogICAg\nICAgICAgICAgICAgaWYgKG1ldGhvZCA9PSBudWxsIHx8ICFlcU5hbWUpCiAg\nICAgICAgICAgICAgICAgICAgbWV0aG9kID0gbWV0aG9kc1tpXTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhbiBl\neGFjdCBtZXRob2QgbmFtZSBtYXRjaCwgcmV0dXJuIGl0OyBvdGhlcndpc2Ug\nZmF2b3IKICAgICAgICAvLyBhbiBpbmV4YWN0IGZpZWxkIHRvIGFuIGluZXhh\nY3QgbWV0aG9kCiAgICAgICAgaWYgKGVxTmFtZSB8fCBmaWVsZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbWV0aG9kOwogICAgICAgIHJldHVybiBm\naWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHV0IG1l\ndGhvZCBpZiBvbmUgZXhpc3RzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBNZXRob2QgZmluZFB1dChNZXRob2RbXSBtZXRob2RzKSB7CiAgICAgICAg\nQ2xhc3NbXSBwYXJhbXM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBt\nZXRob2RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghbWV0aG9k\nc1tpXS5nZXROYW1lKCkuZXF1YWxzKCJwdXQiKSkKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgcGFyYW1zID0gbWV0aG9kc1tpXS5n\nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAgICBpZiAocGFyYW1zLmxl\nbmd0aCA9PSAyCiAgICAgICAgICAgICAgICAmJiBwYXJhbXNbMF0gPT0gT2Jq\nZWN0LmNsYXNzCiAgICAgICAgICAgICAgICAmJiBwYXJhbXNbMV0gPT0gT2Jq\nZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHNbaV07\nCiAgICAgICAgfQoJCXJldHVybiBudWxsOwoJfQp9Cg==\n","encoding":"base64"}

