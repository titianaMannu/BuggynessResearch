{"sha":"2dad550db3e17471c305b6aecf81d54a9da6d440","node_id":"MDQ6QmxvYjIwNjM2NDoyZGFkNTUwZGIzZTE3NDcxYzMwNWI2YWVjZjgxZDU0YTlkYTZkNDQw","size":7057,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2dad550db3e17471c305b6aecf81d54a9da6d440","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkRh\ndGU7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eU1hbmFnZXI7CgovKioKICogRmll\nbGRNYW5hZ2VyIHR5cGUgdXNlZCB0byBzdG9yZSBpbmZvcm1hdGlvbiBmb3Ig\ncm9sbGJhY2suCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpjbGFzcyBT\nYXZlRmllbGRNYW5hZ2VyCiAgICBleHRlbmRzIENsZWFyRmllbGRNYW5hZ2Vy\nIHsKCiAgICBwcml2YXRlIGZpbmFsIFN0YXRlTWFuYWdlckltcGwgX3NtOwog\nICAgcHJpdmF0ZSBmaW5hbCBCaXRTZXQgX3VubG9hZGVkOwogICAgcHJpdmF0\nZSBCaXRTZXQgX3NhdmVkID0gbnVsbDsKICAgIHByaXZhdGUgaW50W10gX2Nv\ncHlGaWVsZCA9IG51bGw7CiAgICBwcml2YXRlIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBfc3RhdGUgPSBudWxsOwoKICAgIC8vIHVzZWQgdG8gdHJhY2sgZmllbGQg\ndmFsdWUgZHVyaW5nIHN0b3JlL2ZldGNoIGN5Y2xlCiAgICBwcml2YXRlIE9i\namVjdCBfZmllbGQgPSBudWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0\nb3IuIFByb3ZpZGUge0BsaW5rIFN0YXRlTWFuYWdlckltcGx9IG9mIGluc3Rh\nbmNlIHRvIHNhdmUuCiAgICAgKi8KICAgIFNhdmVGaWVsZE1hbmFnZXIoU3Rh\ndGVNYW5hZ2VySW1wbCBzbSwgUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBCaXRT\nZXQgZGlydHkpIHsKICAgICAgICBfc20gPSBzbTsKICAgICAgICBfc3RhdGUg\nPSBwYzsKCiAgICAgICAgLy8gaWYgaW5zdGFuY2UgaXMgbmV3IG9yIHRyYW5z\naWVudCBhbGwgZmllbGRzIHdpbGwgYmUgbWFya2VkIGRpcnR5IGV2ZW4KICAg\nICAgICAvLyB0aG91Z2ggdGhleSBoYXZlIHRoZWlyIG9yaWdpbmFsIHZhbHVl\ncywgc28gd2UgY2FuIHJlc3RvcmUgdGhlbTsKICAgICAgICAvLyBvdGhlcndp\nc2UsIHdlIG5lZWQgdG8gcmVjb3JkIGFscmVhZHktZGlydHkgcGVyc2lzdGVu\ndCBmaWVsZHMgYXMKICAgICAgICAvLyBvbmVzIHdlIHdvbid0IGJlIGFibGUg\ndG8gcmVzdG9yZQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBf\nc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICBpZiAoX3Nt\nLmlzTmV3KCkgfHwgIV9zbS5pc1BlcnNpc3RlbnQoKSB8fCBkaXJ0eSA9PSBu\ndWxsKQogICAgICAgICAgICBfdW5sb2FkZWQgPSBuZXcgQml0U2V0KGZpZWxk\ncy5sZW5ndGgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBfdW5sb2Fk\nZWQgPSAoQml0U2V0KSBkaXJ0eS5jbG9uZSgpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IGZpZWxk\nc1tpXS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICBf\ndW5sb2FkZWQuY2xlYXIoaSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIGNvcHkgaG9s\nZGluZyB0aGUgcm9sbGJhY2sgZmllbGQgdmFsdWVzLgogICAgICovCiAgICBw\ndWJsaWMgUGVyc2lzdGVuY2VDYXBhYmxlIGdldFN0YXRlKCkgewogICAgICAg\nIHJldHVybiBfc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGN1cnJlbnRseS1sb2FkZWQgZmllbGRzIHRoYXQgd2lsbCBiZSB1bmxv\nYWRlZCBhZnRlciByb2xsYmFjay4KICAgICAqLwogICAgcHVibGljIEJpdFNl\ndCBnZXRVbmxvYWRlZCgpIHsKICAgICAgICByZXR1cm4gX3VubG9hZGVkOwog\nICAgfQoKICAgIC8qKgogICAgICogU2F2ZSB0aGUgZ2l2ZW4gZmllbGQuIElm\nIHRoaXMgbWV0aG9kIHJldHVybnMgdHJ1ZSwgdGhlbiB5b3UgbmVlZAogICAg\nICogdG8gdXNlIHRoaXMgZmllbGQgbWFuYWdlciB0byByZXBsYWNlIHRoZSBn\naXZlbiBmaWVsZCBpbiB0aGUgaW5zdGFuY2UKICAgICAqIHJldHVybmVkIGJ5\nIHtAbGluayAjZ2V0U3RhdGV9LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBzYXZlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgLy8gaWYgbm90IGxv\nYWRlZCB3ZSBjYW4ndCBzYXZlIG9yaWcgdmFsdWU7IG1hcmsgYXMgdW5sb2Fk\nZWQgb24gcm9sbGJhY2sKICAgICAgICBpZiAoIV9zbS5nZXRMb2FkZWQoKS5n\nZXQoZmllbGQpKSB7CiAgICAgICAgICAgIF91bmxvYWRlZC5zZXQoZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICAvLyBhbHJlYWR5IHNhdmVkPwogICAgICAgIGlmIChfc2F2ZWQgIT0gbnVs\nbCAmJiBfc2F2ZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9zbS5nZXRNZXRh\nRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBib29sZWFuIG11dGFi\nbGUgPSBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JK\nRUNUOgogICAgICAgICAgICAgICAgbXV0YWJsZSA9IHRydWU7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiB0aGlzIGlzIG5vdCBhbiBpbnZlcnNlIGZpZWxk\nIGFuZCB0aGUgcHJvcGVyIHJlc3RvcmUgZmxhZyBpcwogICAgICAgIC8vIG5v\ndCBzZXQsIHNraXAgaXQKCiAgICAgICAgaWYgKF9zbS5nZXRCcm9rZXIoKS5n\nZXRJbnZlcnNlTWFuYWdlcigpID09IG51bGwKICAgICAgICAgICAgfHwgZm1k\nLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkgewogICAgICAg\nICAgICAvLyB1c2Ugc20ncyByZXN0b3JlIGRpcmVjdGl2ZSwgbm90IGJyb2tl\ncidzCiAgICAgICAgICAgIGludCByZXN0b3JlID0gX3NtLmdldEJyb2tlcigp\nLmdldFJlc3RvcmVTdGF0ZSgpOwogICAgICAgICAgICBpZiAocmVzdG9yZSA9\nPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05FCiAgICAgICAgICAgICAgICB8\nfCAobXV0YWJsZSAmJiByZXN0b3JlID09IFJlc3RvcmVTdGF0ZS5SRVNUT1JF\nX0lNTVVUQUJMRSkpIHsKICAgICAgICAgICAgICAgIF91bmxvYWRlZC5zZXQo\nZmllbGQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBwcmVwYXJlIHRvIHNhdmUg\ndGhlIGZpZWxkCiAgICAgICAgaWYgKF9zdGF0ZSA9PSBudWxsKQogICAgICAg\nICAgICBfc3RhdGUgPSBfc20uZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkucGNO\nZXdJbnN0YW5jZShfc20sIHRydWUpOwogICAgICAgIGlmIChfc2F2ZWQgPT0g\nbnVsbCkKICAgICAgICAgICAgX3NhdmVkID0gbmV3IEJpdFNldChfc20uZ2V0\nTWV0YURhdGEoKS5nZXRGaWVsZHMoKS5sZW5ndGgpOwoKICAgICAgICBfc2F2\nZWQuc2V0KGZpZWxkKTsKCiAgICAgICAgLy8gaWYgbXV0YWJsZSwgcmV0dXJu\nIHRydWUgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZmllbGQgbmVlZHMgdG8gYmUK\nICAgICAgICAvLyBjb3BpZWQgYnkgcHJvdmlkaW5nIGFuZCByZXBsYWNpbmcg\naXQgdXNpbmcgdGhpcyBmaWVsZCBtYW5hZ2VyCiAgICAgICAgaWYgKG11dGFi\nbGUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBpbW11\ndGFibGUgZmllbGRzIGNhbiBqdXN0IGJlIGNvcGllZCBvdmVyCiAgICAgICAg\naWYgKF9jb3B5RmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgX2NvcHlGaWVs\nZCA9IG5ldyBpbnRbMV07CiAgICAgICAgX2NvcHlGaWVsZFswXSA9IGZpZWxk\nOwogICAgICAgIF9zdGF0ZS5wY0NvcHlGaWVsZHMoX3NtLmdldFBlcnNpc3Rl\nbmNlQ2FwYWJsZSgpLCBfY29weUZpZWxkKTsKICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXN0b3JlIHRoZSBnaXZlbiBm\naWVsZC4gSWYgdGhpcyBtZXRob2QgcmV0dXJucyB0cnVlLCB0aGVuIHlvdSBu\nZWVkCiAgICAgKiB0byB1c2UgdGhpcyBmaWVsZCBtYW5hZ2VyIHRvIHJlcGxh\nY2UgdGhlIGdpdmVuIGZpZWxkIGluIHRoZSBzdGF0ZQogICAgICogbWFuYWdl\ncidzIGluc3RhbmNlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZXN0\nb3JlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgLy8gaWYgdGhlIGdpdmVu\nIGZpZWxkIG5lZWRzIHRvIGJlIHVubG9hZGVkLCByZXR1cm4gdHJ1ZSBzbyB0\naGF0IGl0IGdldHMKICAgICAgICAvLyByZXBsYWNlZCB3aXRoIGEgZGVmYXVs\ndCB2YWx1ZQogICAgICAgIGlmIChfdW5sb2FkZWQuZ2V0KGZpZWxkKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIGlmIHRoZSBmaWVs\nZCB3YXMgbm90IHNhdmVkLCBpdCBtdXN0IG5vdCBoYXZlIGdvdHRlbiBkaXJ0\neTsganVzdAogICAgICAgIC8vIHJldHVybiBmYWxzZSBzbyB0aGF0IHRoZSBj\ndXJyZW50IHZhbHVlIGlzIGtlcHQKICAgICAgICBpZiAoX3NhdmVkID09IG51\nbGwgfHwgIV9zYXZlZC5nZXQoZmllbGQpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIGNvcHkgdGhlIHNhdmVkIGZpZWxkIG92ZXIK\nICAgICAgICBpZiAoX2NvcHlGaWVsZCA9PSBudWxsKQogICAgICAgICAgICBf\nY29weUZpZWxkID0gbmV3IGludFsxXTsKICAgICAgICBfY29weUZpZWxkWzBd\nID0gZmllbGQ7CiAgICAgICAgX3NtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nLnBjQ29weUZpZWxkcyhfc3RhdGUsIF9jb3B5RmllbGQpOwogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2Jq\nZWN0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgLy8gcmV0dXJuIHRoZSBj\nb3BpZWQgZmllbGQgZHVyaW5nIHNhdmUsIG9yIGEgbnVsbCB2YWx1ZSBkdXJp\nbmcgcmVzdG9yZQogICAgICAgIE9iamVjdCB2YWwgPSBfZmllbGQ7CiAgICAg\nICAgX2ZpZWxkID0gbnVsbDsKICAgICAgICByZXR1cm4gdmFsOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBP\nYmplY3QgY3VyVmFsKSB7CiAgICAgICAgLy8gY29weSBtdXRhYmxlIGZpZWxk\ncwogICAgICAgIFByb3h5TWFuYWdlciBwcm94eSA9IF9zbS5nZXRCcm9rZXIo\nKS5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldFByb3h5TWFu\nYWdlckluc3RhbmNlKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgc3dp\ndGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgX2ZpZWxk\nID0gcHJveHkuY29weUFycmF5KGN1clZhbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgIF9maWVsZCA9IHByb3h5LmNvcHlDb2xsZWN0aW9u\nKChDb2xsZWN0aW9uKSBjdXJWYWwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIF9maWVsZCA9IHByb3h5LmNvcHlNYXAoKE1hcCkgY3VyVmFsKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5EQVRFOgogICAgICAgICAgICAgICAgX2ZpZWxkID0gcHJveHkuY29weURh\ndGUoKERhdGUpIGN1clZhbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAg\nICAgX2ZpZWxkID0gcHJveHkuY29weUN1c3RvbShjdXJWYWwpOwogICAgICAg\nICAgICAgICAgaWYgKF9maWVsZCA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIF9maWVsZCA9IGN1clZhbDsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgX2ZpZWxkID0g\nY3VyVmFsOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgd2UgY291bGRuJ3Qg\nZ2V0IGEgY29weSBvZiB0aGUgc2NvLCBhY3QgbGlrZSBpdCB3YXNuJ3Qgc2F2\nZWQKICAgICAgICBpZiAoY3VyVmFsICE9IG51bGwgJiYgX2ZpZWxkID09IG51\nbGwpIHsKICAgICAgICAgICAgX3VubG9hZGVkLnNldChmaWVsZCk7CiAgICAg\nICAgICAgIF9zYXZlZC5jbGVhcihmaWVsZCk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

