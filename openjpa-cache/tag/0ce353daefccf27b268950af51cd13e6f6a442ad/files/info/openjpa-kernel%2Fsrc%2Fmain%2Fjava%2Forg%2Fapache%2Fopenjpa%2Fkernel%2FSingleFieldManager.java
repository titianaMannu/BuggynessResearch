{"sha":"cb2fb1e6f935be1dd3fc7d0f54ea317e4f4e211c","node_id":"MDQ6QmxvYjIwNjM2NDpjYjJmYjFlNmY5MzViZTFkZDNmYzdkMGY1NGVhMzE3ZTRmNGUyMTFj","size":31611,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/cb2fb1e6f935be1dd3fc7d0f54ea317e4f4e211c","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0OwppbXBvcnQgamF2YS5zcWwu\nVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGph\ndmEudXRpbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWFwQ2hhbmdlVHJhY2tlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveGllczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLlByb3h5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuUHJveHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBGaWVsZE1hbmFn\nZXIgdHlwZSB1c2VkIHRvIGhvbGQgb250byBhIHNpbmdsZSBmaWVsZCB2YWx1\nZSBhbmQgdGhlbgogKiBkaXNwZW5zZSBpdCB2aWEgdGhlIGZldGNoIG1ldGhv\nZHMuIFRoZSBtYW5hZ2VyIGNhbiBhbHNvIHBlcmZvcm0gYWN0aW9ucwogKiBv\nbiB0aGUgaGVsZCBmaWVsZC4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICov\nCmNsYXNzIFNpbmdsZUZpZWxkTWFuYWdlcgogICAgZXh0ZW5kcyBUcmFuc2Zl\nckZpZWxkTWFuYWdlciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9j\nYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChT\naW5nbGVGaWVsZE1hbmFnZXIuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwg\nU3RhdGVNYW5hZ2VySW1wbCBfc207CiAgICBwcml2YXRlIGZpbmFsIEJyb2tl\nckltcGwgX2Jyb2tlcjsKCiAgICBwdWJsaWMgU2luZ2xlRmllbGRNYW5hZ2Vy\nKFN0YXRlTWFuYWdlckltcGwgc20sIEJyb2tlckltcGwgYnJva2VyKSB7CiAg\nICAgICAgX3NtID0gc207CiAgICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFByb3h5IHRoZSBoZWxkIGZpZWxkIGlmIG5l\nZWRlZC4gUmV0dXJuIHRydWUgaWYgdGhlIGZpZWxkIG5lZWRzIHRvCiAgICAg\nKiBiZSByZXBsYWNlZCB3aXRoIHRoZSBub3ctcHJveGllZCBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcHJveHkoYm9vbGVhbiByZXNl\ndCwgYm9vbGVhbiByZXBsYWNlTnVsbCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gX3NtLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIFByb3h5IHByb3h5ID0gbnVsbDsKICAgICAgICBib29sZWFuIHJl\ndCA9IGZhbHNlOwogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgog\nICAgICAgICAgICAgICAgaWYgKG9ianZhbCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIHByb3h5\nID0gY2hlY2tQcm94eSgpOwogICAgICAgICAgICAgICAgaWYgKHByb3h5ID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBwcm94eSA9IChQcm94eSkg\nX3NtLm5ld0ZpZWxkUHJveHkoZmllbGQpOwogICAgICAgICAgICAgICAgICAg\nICgoRGF0ZSkgcHJveHkpLnNldFRpbWUoKChEYXRlKSBvYmp2YWwpLmdldFRp\nbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3h5IGluc3RhbmNl\nb2YgVGltZXN0YW1wIAogICAgICAgICAgICAgICAgICAgICAgICAmJiBvYmp2\nYWwgaW5zdGFuY2VvZiBUaW1lc3RhbXApCiAgICAgICAgICAgICAgICAgICAg\nICAgICgoVGltZXN0YW1wKSBwcm94eSkuc2V0TmFub3MoKChUaW1lc3RhbXAp\nIG9ianZhbCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXROYW5v\ncygpKTsKICAgICAgICAgICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAgICAgaWYg\nKG9ianZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgICAgIHByb3h5ID0gY2hlY2tQcm94eSgpOwog\nICAgICAgICAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICBwcm94eSA9IChQcm94eSkgX3NtLm5ld0ZpZWxkUHJveHko\nZmllbGQpOwogICAgICAgICAgICAgICAgICAgICgoQ2FsZW5kYXIpIHByb3h5\nKS5zZXRUaW1lKCgoQ2FsZW5kYXIpIG9ianZhbCkuZ2V0VGltZSgpKTsKICAg\nICAgICAgICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBpZiAob2JqdmFs\nID09IG51bGwgJiYgIXJlcGxhY2VOdWxsKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIHByb3h5ID0gY2hlY2tQ\ncm94eSgpOwogICAgICAgICAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBwcm94eSA9IChQcm94eSkgX3NtLm5ld0Zp\nZWxkUHJveHkoZmllbGQpOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmp2\nYWwgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgKChDb2xsZWN0\naW9uKSBwcm94eSkuYWRkQWxsKChDb2xsZWN0aW9uKSBvYmp2YWwpOwogICAg\nICAgICAgICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgaWYgKG9ianZhbCA9PSBudWxs\nICYmICFyZXBsYWNlTnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBwcm94eSA9IGNoZWNrUHJveHkoKTsK\nICAgICAgICAgICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgcHJveHkgPSAoUHJveHkpIF9zbS5uZXdGaWVsZFByb3h5\nKGZpZWxkKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2JqdmFsICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgICgoTWFwKSBwcm94eSkucHV0\nQWxsKChNYXApIG9ianZhbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAg\nICAgICAgICBpZiAob2JqdmFsID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgcHJveHkgPSBjaGVj\na1Byb3h5KCk7CiAgICAgICAgICAgICAgICBpZiAocHJveHkgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgIHByb3h5ID0gZ2V0UHJveHlNYW5hZ2Vy\nKCkubmV3Q3VzdG9tUHJveHkob2JqdmFsKTsKICAgICAgICAgICAgICAgICAg\nICByZXQgPSBwcm94eSAhPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgaWYgKHByb3h5ICE9IG51bGwpIHsKICAgICAgICAg\nICAgcHJveHkuc2V0T3duZXIoX3NtLCBmaWVsZCk7CiAgICAgICAgICAgIENo\nYW5nZVRyYWNrZXIgdHJhY2tlciA9IHByb3h5LmdldENoYW5nZVRyYWNrZXIo\nKTsKICAgICAgICAgICAgaWYgKHJlc2V0ICYmIHRyYWNrZXIgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLk1BUCkgewogICAgICAgICAgICAgICAgICAgIC8v\nIHRyYWNrIHZhbHVlcyBpZiBrZXkgaXMgZGVyaXZlZCBmcm9tIHZhbHVlLCBl\nbHNlIGtleXMKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGtleXMgPSBm\nbWQuZ2V0S2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpID09IG51bGw7CiAgICAg\nICAgICAgICAgICAgICAgKChNYXBDaGFuZ2VUcmFja2VyKSB0cmFja2VyKS5z\nZXRUcmFja0tleXMoa2V5cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB0cmFja2VyLnN0YXJ0VHJhY2tpbmcoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBvYmp2YWwgPSBwcm94eTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBj\ndXJyZW50IGZpZWxkIGlzIGEgdXNhYmxlIHByb3h5LCByZXR1cm4gaXQ7IGVs\nc2UgcmV0dXJuIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgUHJveHkgY2hl\nY2tQcm94eSgpIHsKICAgICAgICBpZiAoIShvYmp2YWwgaW5zdGFuY2VvZiBQ\ncm94eSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBQcm94\neSBwcm94eSA9IChQcm94eSkgb2JqdmFsOwogICAgICAgIGlmIChwcm94eS5n\nZXRPd25lcigpID09IG51bGwgfHwgUHJveGllcy5pc093bmVyKHByb3h5LCBf\nc20sIGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIHByb3h5OwogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogVW5wcm94aWVz\nIHRoZSBjdXJyZW50IGZpZWxkIGlmIG5lZWRlZC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgdW5wcm94eSgpIHsKICAgICAgICBpZiAob2JqdmFsID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuREFURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgaWYgKG9ianZhbCBpbnN0YW5jZW9mIFByb3h5\nKSB7CiAgICAgICAgICAgICAgICAgICAgUHJveHkgcHJveHkgPSAoUHJveHkp\nIG9ianZhbDsKICAgICAgICAgICAgICAgICAgICBwcm94eS5zZXRPd25lcihu\ndWxsLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3h5LmdldENo\nYW5nZVRyYWNrZXIoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCkuc3RvcFRyYWNraW5nKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVsZWFzZSB0aGUgY3VycmVudGx5IGVtYmVkZGVkIGZpZWxkIChtYWtl\nIGl0IHRyYW5zaWVudCkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlbGVh\nc2VFbWJlZGRlZCgpIHsKICAgICAgICBpZiAob2JqdmFsID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\nc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYgKGZt\nZC5pc0VtYmVkZGVkUEMoKSkKICAgICAgICAgICAgICAgICAgICByZWxlYXNl\nRW1iZWRkZWQoZm1kLCBvYmp2YWwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRlZFBDKCkpCiAg\nICAgICAgICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVkKGZtZC5nZXRFbGVt\nZW50KCksIChPYmplY3RbXSkgb2JqdmFsKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgog\nICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRl\nZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVkKGZt\nZC5nZXRFbGVtZW50KCksIChDb2xsZWN0aW9uKSBvYmp2YWwpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1B\nUDoKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0S2V5KCkuaXNFbWJlZGRl\nZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVkKGZt\nZC5nZXRLZXkoKSwgKChNYXApIG9ianZhbCkua2V5U2V0KCkpOwogICAgICAg\nICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRlZFBDKCkp\nCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVkKGZtZC5nZXRF\nbGVtZW50KCksICgoTWFwKSBvYmp2YWwpLnZhbHVlcygpKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbGVhc2UgdGhlIGdpdmVuIGVtYmVkZGVkIG9iamVjdHMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZWxlYXNlRW1iZWRkZWQoVmFsdWVNZXRhRGF0\nYSB2bWQsIE9iamVjdFtdIG9ianMpIHsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG9ianMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHJlbGVhc2VF\nbWJlZGRlZCh2bWQsIG9ianNbaV0pOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVsZWFzZSB0aGUgZ2l2ZW4gZW1iZWRkZWQgb2JqZWN0cy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VFbWJlZGRlZChWYWx1ZU1ldGFEYXRh\nIHZtZCwgQ29sbGVjdGlvbiBvYmpzKSB7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICByZWxlYXNlRW1iZWRkZWQodm1kLCBpdHIubmV4dCgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgdGhlIGdpdmVuIGVtYmVkZCBv\nYmplY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWxlYXNlRW1iZWRk\nZWQoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBvYmopIHsKICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSA9IF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbChvYmosIGZhbHNlKTsKICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBz\nbS5nZXRPd25lcigpID09IF9zbQogICAgICAgICAgICAmJiBzbS5nZXRPd25l\nck1ldGFEYXRhKCkgPT0gdm1kKQogICAgICAgICAgICBzbS5yZWxlYXNlKHRy\ndWUpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgc3RvcmVk\nIGZpZWxkIHNhZmVseSwgcHJldmVudGluZyBpbmZpbml0ZSByZWN1cnNpb24g\ndXNpbmcKICAgICAqIHRoZSBnaXZlbiBzZXQgb2YgYWxyZWFkeS1wZXJzaXN0\nZWQgb2JqZWN0cy4gVGhpcyBtZXRob2QgaXMgb25seSBjYWxsZWQKICAgICAq\nIGZvciBmaWVsZHMgdGhhdCB3ZSBrbm93IGhhdmUgY2FzY2FkZS1pbW1lZGlh\ndGUgc2V0dGluZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3Qo\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmp2YWwgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9zbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBpZiAoIV9i\ncm9rZXIuaXNEZXRhY2hlZE5ldygpICYmIF9icm9rZXIuaXNEZXRhY2hlZChv\nYmp2YWwpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gYWxsb3cg\nYnV0IGlnbm9yZQogICAgICAgICAgICAgICAgX2Jyb2tlci5wZXJzaXN0KG9i\nanZhbCwgdHJ1ZSwgY2FsbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAg\nICBfYnJva2VyLnBlcnNpc3RBbGwoQXJyYXlzLmFzTGlzdCgoT2JqZWN0W10p\nIG9ianZhbCksIHRydWUsIAogICAgICAgICAgICAgICAgICAgIGNhbGwpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICBfYnJva2VyLnBlcnNp\nc3RBbGwoKENvbGxlY3Rpb24pIG9ianZhbCwgdHJ1ZSwgY2FsbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRLZXkoKS5nZXRDYXNj\nYWRlUGVyc2lzdCgpCiAgICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0lNTUVESUFURSkKICAgICAgICAgICAgICAgICAgICBf\nYnJva2VyLnBlcnNpc3RBbGwoKChNYXApIG9ianZhbCkua2V5U2V0KCksIHRy\ndWUsIGNhbGwpOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50\nKCkuZ2V0Q2FzY2FkZVBlcnNpc3QoKQogICAgICAgICAgICAgICAgICAgID09\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpCiAgICAgICAgICAg\nICAgICAgICAgX2Jyb2tlci5wZXJzaXN0QWxsKCgoTWFwKSBvYmp2YWwpLnZh\nbHVlcygpLCB0cnVlLCBjYWxsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhbmQvb3Ig\nZGVyZWZlcmVuY2UgZmllbGQgdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBkZWxldGUoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGRlbGV0\nZSh0cnVlLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlcmVmZXJl\nbmNlIGZpZWxkIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgZGVy\nZWZlcmVuY2VEZXBlbmRlbnQoKSB7CiAgICAgICAgZGVsZXRlKGZhbHNlLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBvciBkZXJlZmVy\nZW5jZSB0aGUgc3RvcmVkIGZpZWxkIGFzIG5lY2Vzc2FyeS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGRlbGV0ZShib29sZWFuIGltbWVkaWF0ZSwgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9zbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICBpZiAoZm1kLmdldENhc2NhZGVEZWxldGUoKSAhPSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfTk9ORSkgewogICAgICAgICAgICAvLyBpbW1lZGlhdGUgY2Fz\nY2FkZSB3b3JrcyBvbiBmaWVsZCB2YWx1ZTsgZGVwZW5kZW50IGRlcmVmCiAg\nICAgICAgICAgIC8vIHdvcmtzIG9uIGV4dGVybmFsIHZhbHVlCiAgICAgICAg\nICAgIGlmICgoaW1tZWRpYXRlIHx8IGZtZC5pc0VtYmVkZGVkUEMoKSkKICAg\nICAgICAgICAgICAgICYmIGZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkKICAgICAgICAgICAgICAg\nIGRlbGV0ZShmbWQsIG9ianZhbCwgY2FsbCk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKGZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX0FVVE8pCiAgICAgICAgICAgICAgICBkZXJlZmVyZW5jZURlcGVu\nZGVudChmbWQuZ2V0RXh0ZXJuYWxWYWx1ZShvYmp2YWwsIF9icm9rZXIpKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0\nIGV4dGVybmFsID0gbnVsbDsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCA9\nIGZtZC5nZXRLZXkoKTsKICAgICAgICBpZiAoKGltbWVkaWF0ZSB8fCB2bWQu\naXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICYmIHZtZC5nZXRDYXNjYWRl\nRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkK\nICAgICAgICAgICAgZGVsZXRlKHZtZCwgKChNYXApIG9ianZhbCkua2V5U2V0\nKCksIGNhbGwpOwogICAgICAgIGVsc2UgaWYgKHZtZC5nZXRDYXNjYWRlRGVs\nZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pIHsKICAgICAg\nICAgICAgZXh0ZXJuYWwgPSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZShvYmp2YWws\nIF9icm9rZXIpOwogICAgICAgICAgICBpZiAoZXh0ZXJuYWwgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgZGVyZWZlcmVu\nY2VEZXBlbmRlbnQoKChNYXApIGV4dGVybmFsKS5rZXlTZXQoKSk7CiAgICAg\nICAgfQoKICAgICAgICB2bWQgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAg\nIGlmICgoaW1tZWRpYXRlIHx8IHZtZC5pc0VtYmVkZGVkUEMoKSkKICAgICAg\nICAgICAgJiYgdm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFE\nYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAg\nICBkZWxldGUodm1kLCAoQ29sbGVjdGlvbikgb2JqdmFsLCBjYWxsKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSh2\nbWQsIChPYmplY3RbXSkgb2JqdmFsLCBjYWxsKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1B\nUDoKICAgICAgICAgICAgICAgICAgICBkZWxldGUodm1kLCAoKE1hcCkgb2Jq\ndmFsKS52YWx1ZXMoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHZtZC5nZXRD\nYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8p\nIHsKICAgICAgICAgICAgaWYgKGV4dGVybmFsID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGV4dGVybmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUob2Jq\ndmFsLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgIGlmIChleHRlcm5hbCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkg\newogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgICAgICBkZXJlZmVyZW5jZURlcGVuZGVudCgoQ29s\nbGVjdGlvbikgZXh0ZXJuYWwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAg\nICAgICAgICAgICAgICAgZGVyZWZlcmVuY2VEZXBlbmRlbnQoKE9iamVjdFtd\nKSBleHRlcm5hbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAg\nICAgICAgZGVyZWZlcmVuY2VEZXBlbmRlbnQoKChNYXApIGV4dGVybmFsKS52\nYWx1ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUg\ndGhlIG9iamVjdHMgaW4gdGhlIGdpdmVuIHZhbHVlLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgZGVsZXRlKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3Rb\nXSBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBkZWxl\ndGUodm1kLCBvYmpzW2ldLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERlbGV0ZSB0aGUgb2JqZWN0cyBlbWJlZGRlZCBpbiB0aGUgZ2l2ZW4gdmFs\ndWUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkZWxldGUoVmFsdWVNZXRh\nRGF0YSB2bWQsIENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgZGVsZXRlKHZtZCwgaXRy\nLm5leHQoKSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUg\nYW4gb2JqZWN0IGVtYmVkZGVkIGluIHRoZSBnaXZlbiB2YWx1ZS4KICAgICAq\nLwogICAgdm9pZCBkZWxldGUoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBv\nYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZGVsZXRlIGlm\nIHVua25vd25lZCBvciB0aGlzIGlzbid0IGFuIGVtYmVkZGVkIGZpZWxkIG9y\nIGlmIG93bmVkIGJ5IHVzCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9\nIF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAg\nICAgICBpZiAoc20gIT0gbnVsbCAmJiAoc20uZ2V0T3duZXIoKSA9PSBudWxs\nIHx8ICF2bWQuaXNFbWJlZGRlZFBDKCkKICAgICAgICAgICAgfHwgKHNtLmdl\ndE93bmVyKCkgPT0gX3NtICYmIHNtLmdldE93bmVyTWV0YURhdGEoKSA9PSB2\nbWQpKSkKICAgICAgICAgICAgX2Jyb2tlci5kZWxldGUoc20uZ2V0TWFuYWdl\nZEluc3RhbmNlKCksIHNtLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERlcmVmZXJlbmNlIGFsbCB2YWxpZCBwZXJzaXN0ZW50IG9iamVjdHMgaW4g\ndGhlIGdpdmVuIGNvbGxlY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBkZXJlZmVyZW5jZURlcGVuZGVudChPYmplY3RbXSBvYmpzKSB7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBkZXJlZmVyZW5jZURlcGVuZGVudChvYmpzW2ldKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIERlcmVmZXJlbmNlIGFsbCB2YWxpZCBwZXJzaXN0\nZW50IG9iamVjdHMgaW4gdGhlIGdpdmVuIGNvbGxlY3Rpb24uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBkZXJlZmVyZW5jZURlcGVuZGVudChDb2xsZWN0\naW9uIG9ianMpIHsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGRlcmVm\nZXJlbmNlRGVwZW5kZW50KGl0ci5uZXh0KCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogRGVyZWZlcmVuY2UgdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwog\nICAgdm9pZCBkZXJlZmVyZW5jZURlcGVuZGVudChPYmplY3Qgb2JqKSB7CiAg\nICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IF9icm9rZXIuZ2V0U3RhdGVN\nYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAgICAgICBpZiAoc20gIT0gbnVs\nbCkKICAgICAgICAgICAgc20uc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KHRy\ndWUsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmVjdXJzaXZlbHkg\naW52b2tlIHRoZSBicm9rZXIgdG8gZ2F0aGVyIGNhc2NhZGUtcmVmcmVzaCBv\nYmplY3RzIGluCiAgICAgKiB0aGUgY3VycmVudCBmaWVsZCBpbnRvIHRoZSBn\naXZlbiBzZXQuIFRoaXMgbWV0aG9kIGlzIG9ubHkgY2FsbGVkCiAgICAgKiBm\nb3IgZmllbGRzIHRoYXQgd2Uga25vdyBoYXZlIGNhc2NhZGUtcmVmcmVzaCBz\nZXR0aW5ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgZ2F0aGVyQ2FzY2Fk\nZVJlZnJlc2goT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmp2\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9zbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAg\nICBfYnJva2VyLmdhdGhlckNhc2NhZGVSZWZyZXNoKG9ianZhbCwgY2FsbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBnYXRoZXJDYXNjYWRlUmVm\ncmVzaCgoT2JqZWN0W10pIG9ianZhbCwgY2FsbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKChDb2xs\nZWN0aW9uKSBvYmp2YWwsIGNhbGwpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIGlmIChmbWQuZ2V0S2V5KCkuZ2V0Q2FzY2FkZVJlZnJlc2goKQogICAg\nICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1F\nRElBVEUpCiAgICAgICAgICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJl\nc2goKChNYXApIG9ianZhbCkua2V5U2V0KCksIGNhbGwpOwogICAgICAgICAg\nICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZVJlZnJlc2go\nKQogICAgICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9JTU1FRElBVEUpCiAgICAgICAgICAgICAgICAgICAgZ2F0aGVyQ2FzY2Fk\nZVJlZnJlc2goKChNYXApIG9ianZhbCkudmFsdWVzKCksIGNhbGwpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogR2F0aGVyIGVhY2ggZWxlbWVudC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGdhdGhlckNhc2NhZGVSZWZyZXNoKE9iamVjdFtdIGFyciwgT3BD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nYXJyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBfYnJva2VyLmdhdGhlckNh\nc2NhZGVSZWZyZXNoKGFycltpXSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHYXRoZXIgZWFjaCBlbGVtZW50LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goQ29sbGVjdGlvbiBjb2xsLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBjb2xsLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICBfYnJva2VyLmdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCksIGNh\nbGwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBwcmUtZmx1c2gg\ndGFza3Mgb24gdGhlIGN1cnJlbnQgZmllbGQuIFRoaXMgaW5jbHVkZXMgY2hl\nY2tpbmcKICAgICAqIGZvciBudWxscywgcGVyc2lzdGluZyBwY3MsIGVtYmVk\nZGluZyBlbWJlZGRlZCBmaWVsZHMsIGFuZCByZWYnaW5nCiAgICAgKiBwYyBm\naWVsZHMuIFJldHVybiB0cnVlIGlmIHRoZSBmaWVsZCBuZWVkcyB0byBiZSBy\nZXBsYWNlZCB3aXRoIHRoZQogICAgICogbmV3IHZhbHVlLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBwcmVGbHVzaChib29sZWFuIGxvZ2ljYWwsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICAvLyBvbmx5IGNhcmUgYWJvdXQg\nb2JqZWN0IGZpZWxkcwogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3Nt\nLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpIDwgSmF2YVR5cGVzLk9CSkVDVCkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBwZXJmb3Jt\nIHBlcnMtYnktcmVhY2ggYW5kIGRlcGVuZGVudCByZWZzCiAgICAgICAgYm9v\nbGVhbiByZXQgPSBwcmVGbHVzaChmbWQsIGxvZ2ljYWwsIGNhbGwpOwoKICAg\nICAgICAvLyBtYW5hZ2UgaW52ZXJzZXMKICAgICAgICBJbnZlcnNlTWFuYWdl\nciBtYW5hZ2VyID0gX2Jyb2tlci5nZXRJbnZlcnNlTWFuYWdlcigpOwogICAg\nICAgIGlmIChtYW5hZ2VyICE9IG51bGwpCiAgICAgICAgICAgIG1hbmFnZXIu\nY29ycmVjdFJlbGF0aW9ucyhfc20sIGZtZCwgb2JqdmFsKTsKICAgICAgICBy\nZXR1cm4gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUg\naWYgdGhlIGxhc3QtcHJvdmlkZWQgZmllbGQgaGFzIGEgZGVmYXVsdCB2YWx1\nZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZWZhdWx0VmFsdWUo\nKSB7CiAgICAgICAgcmV0dXJuIGRibHZhbCA9PSAwICYmIGxvbmd2YWwgPT0g\nMAogICAgICAgICAgICAmJiAob2JqdmFsID09IG51bGwgfHwgIiIuZXF1YWxz\nKG9ianZhbCkpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIHN0\nb3JlZCBmaWVsZCBvciBpdHMgZGVmYXVsdCB2YWx1ZSB0byB0aGUgZ2l2ZW4g\nc3RyZWFtLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXJpYWxpemUoT2Jq\nZWN0T3V0cHV0IG91dCwgYm9vbGVhbiBkZWYpCiAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9zbS5n\nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIG91dC53cml0\nZUJvb2xlYW4oIWRlZiAmJiBsb25ndmFsID09IDEpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAg\nICAgICAgICAgICAgICBvdXQud3JpdGVCeXRlKChkZWYpID8gKGJ5dGUpIDAg\nOiAoYnl0ZSkgbG9uZ3ZhbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAg\nIG91dC53cml0ZUNoYXIoKGRlZikgPyAoY2hhcikgMCA6IChjaGFyKSBsb25n\ndmFsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBvdXQud3JpdGVE\nb3VibGUoKGRlZikgPyAwRCA6IGRibHZhbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgICAgICBvdXQud3JpdGVGbG9hdCgoZGVmKSA/IDBGIDogKGZsb2F0\nKSBkYmx2YWwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIG91dC53cml0\nZUludCgoZGVmKSA/IDAgOiAoaW50KSBsb25ndmFsKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgog\nICAgICAgICAgICAgICAgb3V0LndyaXRlTG9uZygoZGVmKSA/IDBMIDogbG9u\nZ3ZhbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBvdXQud3JpdGVT\naG9ydCgoZGVmKSA/IChzaG9ydCkgMCA6IChzaG9ydCkgbG9uZ3ZhbCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIG91dC53cml0ZU9iamVjdCgoZGVmKSA/IG51bGwgOiBv\nYmp2YWwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gcGVyZm9ybSBwcmUgZmx1c2ggYWN0aW9ucyBvbiB0aGUg\nY3VycmVudCBvYmplY3QuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBw\ncmVGbHVzaChGaWVsZE1ldGFEYXRhIGZtZCwgYm9vbGVhbiBsb2dpY2FsLCAK\nICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgLy8gY2hlY2sg\nZm9yIGlsbGVnYWwgbnVsbHMKICAgICAgICBpZiAob2JqdmFsID09IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKGZtZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVs\nZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9OCiAgICAgICAgICAgICAgICB8fCBm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJudWxsLXZhbHVlIiwKICAgICAgICAgICAgICAgICAgICBm\nbWQuZ2V0TmFtZSgpLCBfc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKS4KICAg\nICAgICAgICAgICAgICAgICBzZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gbm90aGluZyBl\nbHNlIHRvIGRvIGZvciBub24tcGVyc2lzdGVudAogICAgICAgIGlmIChmbWQu\nZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJ\nU1RFTlQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8g\nZG9uJ3QgYWxsb3cgbWFuYWdlZCBvYmplY3RpZCBmaWVsZCB2YWx1ZQogICAg\nICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBl\ncy5PSUQpIHsKICAgICAgICAgICAgX3NtLmFzc2VydE5vdE1hbmFnZWRPYmpl\nY3RJZChvYmp2YWwpOwogICAgICAgICAgICBpZiAoX3NtLmdldE9iamVjdElk\nKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgIW9ianZhbC5lcXVhbHMo\nKChPYmplY3RJZCkgX3NtLmdldE9iamVjdElkKCkpLmdldElkKCkpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgiY2hhbmdlZC1vaWQiLAogICAgICAgICAgICAgICAgICAgIF9z\nbS5nZXRPYmplY3RJZCgpLCBvYmp2YWwsCiAgICAgICAgICAgICAgICAgICAg\nRXhjZXB0aW9ucy50b1N0cmluZyhfc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkp\nKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBjaGVjayBmb3IgcGNzIGluIGZpZWxkIHZhbHVl\nCiAgICAgICAgaWYgKHByZUZsdXNoKGZtZCwgZm1kLmdldERlY2xhcmVkVHlw\nZUNvZGUoKSwKICAgICAgICAgICAgZm1kLmdldEtleSgpLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSwKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCksIGZhbHNlLCBsb2dpY2FsLCBjYWxsKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIGFsc28gY2hlY2sg\nZm9yIHBjcyBpbiBleHRlcm5hbGl6ZWQgdmFsdWVzCiAgICAgICAgaWYgKGZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBwcmVGbHVzaChmbWQs\nIGZtZC5nZXRUeXBlQ29kZSgpLCBmbWQuZ2V0S2V5KCkuZ2V0VHlwZUNvZGUo\nKSwKICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNv\nZGUoKSwgdHJ1ZSwgbG9naWNhbCwgY2FsbCk7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBuZXcgb2JqZWN0cyBw\nZXJzaXN0ZW50IGFuZCByZWYgb3RoZXIgb2JqZWN0cyBzbyByZWZlcmVuY2Vk\nCiAgICAgKiBkZXBlbmRlbnQgb2JqZWN0cyB3b24ndCBiZSBkZWxldGVkLgog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gcHJlRmx1c2goRmllbGRNZXRh\nRGF0YSBmbWQsIGludCB0eXBlLCBpbnQga2V5VHlwZSwKICAgICAgICBpbnQg\nZWxlbVR5cGUsIGJvb2xlYW4gZXh0ZXJuYWwsIGJvb2xlYW4gbG9naWNhbCwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIE9iamVjdCB2YWwgPSBvYmp2\nYWw7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgIGJvb2xlYW4gY29weSA9IGZhbHNlOwogICAg\nICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5QQzoKICAgICAgICAgICAgICAgIGlmIChmbWQuaXNFbWJlZGRlZFBDKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBvYmp2YWwgPSBlbWJlZChmbWQsIHZh\nbCk7CiAgICAgICAgICAgICAgICAgICAgY29weSA9IHRydWU7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChleHRl\ncm5hbCkKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4\ndGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHBy\nZUZsdXNoUEMoZm1kLCB2YWwsIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBpZiAo\nZXh0ZXJuYWwpCiAgICAgICAgICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4\ndGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgIGlm\nICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBD\nKGZtZCwgdmFsLCBsb2dpY2FsLCBjYWxsKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQQygp\nKQogICAgICAgICAgICAgICAgICAgIGVtYmVkKGZtZC5nZXRFbGVtZW50KCks\nIChPYmplY3RbXSkgdmFsKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVs\nZW1UeXBlID09IEphdmFUeXBlcy5QQwogICAgICAgICAgICAgICAgICAgIHx8\nIGVsZW1UeXBlID09IEphdmFUeXBlcy5QQ19VTlRZUEVEKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGV4dGVybmFsKQogICAgICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIp\nOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgcHJlRmx1c2hQQ3MoZm1kLmdldEVsZW1lbnQo\nKSwgKE9iamVjdFtdKSB2YWwsIGxvZ2ljYWwsIAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY2FsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09M\nTEVDVElPTjoKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgp\nLmlzRW1iZWRkZWRQQygpKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqdmFs\nID0gZW1iZWQoZm1kLmdldEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIHZhbCk7\nCiAgICAgICAgICAgICAgICAgICAgY29weSA9IHRydWU7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGVsZW1UeXBlID09IEphdmFUeXBlcy5QQwogICAg\nICAgICAgICAgICAgICAgIHx8IGVsZW1UeXBlID09IEphdmFUeXBlcy5QQ19V\nTlRZUEVEKSB7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBmbHVzaGVk\nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV4dGVybmFsKQog\nICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBmbWQuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHNob3J0Y3V0IGNoYW5nZSB0cmFja2VyczsgYWxzbyBlbnN1\ncmVzIHdlIGRvbid0IAogICAgICAgICAgICAgICAgICAgICAgICAvLyBpdGVy\nYXRlIGxycyBmaWVsZHMKICAgICAgICAgICAgICAgICAgICAgICAgQ2hhbmdl\nVHJhY2tlciBjdCA9ICgoUHJveHkpIHZhbCkuZ2V0Q2hhbmdlVHJhY2tlcigp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0gbnVsbCAmJiBj\ndC5pc1RyYWNraW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHByZUZsdXNoUENzKGZtZC5nZXRFbGVtZW50KCksIGN0LmdldEFkZGVkKCks\nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2ljYWwsIGNh\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlRmx1c2hQQ3Mo\nZm1kLmdldEVsZW1lbnQoKSwgY3QuZ2V0Q2hhbmdlZCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGxvZ2ljYWwsIGNhbGwpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZmx1c2hlZCA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgaWYgKCFmbHVzaGVkICYmIHZhbCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxl\nbWVudCgpLCAoQ29sbGVjdGlvbikgdmFsLCBsb2dpY2FsLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2FsbCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgYm9vbGVhbiBrZXlFbWJlZCA9IGZt\nZC5nZXRLZXkoKS5pc0VtYmVkZGVkUEMoKTsKICAgICAgICAgICAgICAgIGJv\nb2xlYW4gdmFsRW1iZWQgPSBmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQ\nQygpOwogICAgICAgICAgICAgICAgaWYgKGtleUVtYmVkIHx8IHZhbEVtYmVk\nKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqdmFsID0gZW1iZWQoZm1kLCAo\nTWFwKSB2YWwsIGtleUVtYmVkLCB2YWxFbWJlZCk7CiAgICAgICAgICAgICAg\nICAgICAgY29weSA9IGtleUVtYmVkOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIGlmICgha2V5RW1iZWQgJiYgKGtleVR5cGUgPT0gSmF2\nYVR5cGVzLlBDCiAgICAgICAgICAgICAgICAgICAgfHwga2V5VHlwZSA9PSBK\nYXZhVHlwZXMuUENfVU5UWVBFRCkpIHsKICAgICAgICAgICAgICAgICAgICBi\nb29sZWFuIGZsdXNoZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoZXh0ZXJuYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0g\nZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZXh0ZXJuYWwgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFByb3h5KSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3J0Y3V0IGNoYW5nZSB0cmFj\na2VyczsgYWxzbyBlbnN1cmVzIHdlIGRvbid0IAogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBpdGVyYXRlIGxycyBmaWVsZHMKICAgICAgICAgICAgICAg\nICAgICAgICAgTWFwQ2hhbmdlVHJhY2tlciBjdCA9IChNYXBDaGFuZ2VUcmFj\na2VyKSAoKFByb3h5KSB2YWwpLgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoY3QgIT0gbnVsbCAmJiBjdC5pc1RyYWNraW5nKCkgJiYgY3QuZ2V0\nVHJhY2tLZXlzKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNoUENzKGZtZC5nZXRLZXko\nKSwgY3QuZ2V0QWRkZWQoKSwgbG9naWNhbCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjYWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHByZUZsdXNoUENzKGZtZC5nZXRLZXkoKSwgY3QuZ2V0Q2hhbmdlZCgp\nLCBsb2dpY2FsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNh\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hlZCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbHVzaGVkICYmIHZh\nbCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBD\ncyhmbWQuZ2V0S2V5KCksICgoTWFwKSB2YWwpLmtleVNldCgpLCBsb2dpY2Fs\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbCk7CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCF2YWxFbWJlZCAmJiAo\nZWxlbVR5cGUgPT0gSmF2YVR5cGVzLlBDCiAgICAgICAgICAgICAgICAgICAg\nfHwgZWxlbVR5cGUgPT0gSmF2YVR5cGVzLlBDX1VOVFlQRUQpKSB7CiAgICAg\nICAgICAgICAgICAgICAgYm9vbGVhbiBmbHVzaGVkID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGV4dGVybmFsKQogICAgICAgICAgICAgICAg\nICAgICAgICB2YWwgPSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9r\nZXIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3J0\nY3V0IGNoYW5nZSB0cmFja2VyczsgYWxzbyBlbnN1cmVzIHdlIGRvbid0IAog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIGxycyBmaWVsZHMK\nICAgICAgICAgICAgICAgICAgICAgICAgTWFwQ2hhbmdlVHJhY2tlciBjdCA9\nIChNYXBDaGFuZ2VUcmFja2VyKSAoKFByb3h5KSB2YWwpLgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoY3QgIT0gbnVsbCAmJiBjdC5pc1RyYWNr\naW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdC5n\nZXRUcmFja0tleXMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHByZUZsdXNoUENzKGZtZC5nZXRFbGVtZW50KCksIGN0LmdldEFkZGVk\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChNYXAp\nIHZhbCwgbG9naWNhbCwgY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgcHJlRmx1c2hQQ3MoZm1kLmdldEVsZW1lbnQoKSwgY3QuZ2V0\nQ2hhbmdlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAoTWFwKSB2YWwsIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxlbWVudCgpLCBjdC5nZXRB\nZGRlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nb2dpY2FsLCBjYWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxlbWVudCgpLCBjdC5nZXRDaGFuZ2Vk\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2lj\nYWwsIGNhbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hlZCA9IHRydWU7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFmbHVzaGVkICYmIHZhbCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0\nRWxlbWVudCgpLCAoKE1hcCkgdmFsKS52YWx1ZXMoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBuZXcg\nb2JqZWN0cyBwZXJzaXN0ZW50IGFuZCByZWYgYWxsIHZhbGlkIHBlcnNpc3Rl\nbnQgb2JqZWN0cyBmb3IKICAgICAqIHRoZSBnaXZlbiBrZXlzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcHJlRmx1c2hQQ3MoVmFsdWVNZXRhRGF0YSB2\nbWQsIENvbGxlY3Rpb24ga2V5cywgTWFwIG1hcCwKICAgICAgICBib29sZWFu\nIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGtleXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nCiAgICAgICAgICAgIHByZUZsdXNoUEModm1kLCBtYXAuZ2V0KGl0ci5uZXh0\nKCkpLCBsb2dpY2FsLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgbmV3IG9iamVjdHMgcGVyc2lzdGVudCBhbmQgcmVmIGFsbCB2YWxpZCBw\nZXJzaXN0ZW50IG9iamVjdHMgaW4KICAgICAqIHRoZSBnaXZlbiBhcnJheS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByZUZsdXNoUENzKFZhbHVlTWV0\nYURhdGEgdm1kLCBPYmplY3RbXSBvYmpzLAogICAgICAgIGJvb2xlYW4gbG9n\naWNhbCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgb2Jqcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgcHJlRmx1\nc2hQQyh2bWQsIG9ianNbaV0sIGxvZ2ljYWwsIGNhbGwpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBuZXcgb2JqZWN0cyBwZXJzaXN0ZW50IGFuZCBy\nZWYgYWxsIHZhbGlkIHBlcnNpc3RlbnQgb2JqZWN0cyBpbgogICAgICogdGhl\nIGdpdmVuIGNvbGxlY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\ncmVGbHVzaFBDcyhWYWx1ZU1ldGFEYXRhIHZtZCwgQ29sbGVjdGlvbiBvYmpz\nLAogICAgICAgIGJvb2xlYW4gbG9naWNhbCwgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgcHJlRmx1c2hQQyh2bWQs\nIGl0ci5uZXh0KCksIGxvZ2ljYWwsIGNhbGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGVyZm9ybSBwcmUgZmx1c2ggb3BlcmF0aW9ucyBvbiB0aGUgZ2l2\nZW4gb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJlRmx1c2hQ\nQyhWYWx1ZU1ldGFEYXRhIHZtZCwgT2JqZWN0IG9iaiwgYm9vbGVhbiBsb2dp\nY2FsLAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbTsKICAgICAgICBpZiAodm1kLmdldENhc2Nh\nZGVQZXJzaXN0KCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpIHsK\nICAgICAgICAgICAgaWYgKCFfYnJva2VyLmlzRGV0YWNoZWROZXcoKSAmJiBf\nYnJva2VyLmlzRGV0YWNoZWQob2JqKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsgLy8gYWxsb3cgYnV0IGlnbm9yZQoKICAgICAgICAgICAgc20gPSBfYnJv\na2VyLmdldFN0YXRlTWFuYWdlcihvYmopOwogICAgICAgICAgICBpZiAoc20g\nPT0gbnVsbCB8fCAhc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJj\nYW50LWNhc2NhZGUtcGVyc2lzdCIsCiAgICAgICAgICAgICAgICAgICAgRXhj\nZXB0aW9ucy50b1N0cmluZyhvYmopLCB2bWQsCiAgICAgICAgICAgICAgICAg\nICAgRXhjZXB0aW9ucy50b1N0cmluZyhfc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9i\naik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc20gPSBfYnJva2Vy\nLmdldFN0YXRlTWFuYWdlcihvYmopOwogICAgICAgICAgICBpZiAoc20gPT0g\nbnVsbCB8fCAhc20uaXNQcm92aXNpb25hbCgpKQogICAgICAgICAgICAgICAg\nc20gPSBfYnJva2VyLnBlcnNpc3Qob2JqLCBudWxsLCB0cnVlLCBjYWxsKTsK\nICAgICAgICB9CgogICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIGlmIGRlbGV0ZWQgYW5kIG5vdCBtYW5hZ2VkIGludmVyc2UsIGRp\nZQogICAgICAgICAgICBpZiAoc20uaXNEZWxldGVkKCkgJiYgKF9icm9rZXIu\nZ2V0SW52ZXJzZU1hbmFnZXIoKSA9PSBudWxsCiAgICAgICAgICAgICAgICB8\nfCB2bWQuZ2V0RmllbGRNZXRhRGF0YSgpLmdldEludmVyc2VNZXRhRGF0YXMo\nKS5sZW5ndGggPT0gMCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgicmVmLXRvLWRlbGV0ZWQiLAogICAgICAg\nICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSwgdm1kLAog\nICAgICAgICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcoX3NtLmdl\ndE1hbmFnZWRJbnN0YW5jZSgpKSkpLgogICAgICAgICAgICAgICAgICAgIHNl\ndEZhaWxlZE9iamVjdChvYmopOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbWltcGwgPSAoU3RhdGVNYW5hZ2VySW1wbCkgc207CiAgICAgICAg\nICAgIHNtaW1wbC5ub25wcm92aXNpb25hbChsb2dpY2FsLCBjYWxsKTsKICAg\nICAgICAgICAgc21pbXBsLnNldERlcmVmZXJlbmNlZERlcGVuZGVudChmYWxz\nZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSBhbGwgZWxlbWVudHMgb2YgdGhlIGdpdmVuIGFycmF5IGVtYmVkZGVkLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgZW1iZWQoVmFsdWVNZXRhRGF0YSB2\nbWQsIE9iamVjdFtdIGFycikgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYXJyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBhcnJbaV0gPSBlbWJl\nZCh2bWQsIGFycltpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBjb3B5IG9mIHRoZSBnaXZlbiBjb2xsZWN0aW9uIGNvbnRhaW5pbmcgZW1i\nZWRkZWQgZWxlbWVudHMuCiAgICAgKi8KICAgIHByaXZhdGUgQ29sbGVjdGlv\nbiBlbWJlZChWYWx1ZU1ldGFEYXRhIHZtZCwgQ29sbGVjdGlvbiBvcmlnKSB7\nCiAgICAgICAgLy8gd2UgaGF2ZSB0byBjb3B5IHRvIGdldCBhIGNvbGxlY3Rp\nb24gb2YgdGhlIHJpZ2h0IHR5cGUgYW5kIHNpemUsCiAgICAgICAgLy8gdGhv\ndWdoIHdlIGltbWVkaWF0ZWx5IGNsZWFyIGl0CiAgICAgICAgQ29sbGVjdGlv\nbiBjb2xsID0gZ2V0UHJveHlNYW5hZ2VyKCkuY29weUNvbGxlY3Rpb24ob3Jp\nZyk7CiAgICAgICAgaWYgKGNvbGwgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1jb3B5YWJsZSIs\nCiAgICAgICAgICAgICAgICB2bWQuZ2V0RmllbGRNZXRhRGF0YSgpKSk7Cgog\nICAgICAgIGNvbGwuY2xlYXIoKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IG9yaWcuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAg\nICAgIGNvbGwuYWRkKGVtYmVkKHZtZCwgaXRyLm5leHQoKSkpOwogICAgICAg\nIHJldHVybiBjb2xsOwogICAgfQoKICAgIC8qKgogICAgICogRW1iZWQgdGhl\nIGVsZW1lbnRzIG9mIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAgIHByaXZh\ndGUgTWFwIGVtYmVkKEZpZWxkTWV0YURhdGEgZm1kLCBNYXAgb3JpZywgYm9v\nbGVhbiBrZXlFbWJlZCwKICAgICAgICBib29sZWFuIHZhbEVtYmVkKSB7CiAg\nICAgICAgTWFwIG1hcDsKICAgICAgICBNYXAuRW50cnkgZW50cnk7CgogICAg\nICAgIC8vIGlmIHdlIGhhdmUgdG8gcmVwbGFjZSBrZXlzLCB3ZSBuZWVkIHRv\nIGNvcHkgdGhlIG1hcDsgb3RoZXJ3aXNlCiAgICAgICAgLy8gd2UgY2FuIG11\ndGF0ZSB0aGUgdmFsdWVzIGRpcmVjdGx5CiAgICAgICAgaWYgKGtleUVtYmVk\nKSB7CiAgICAgICAgICAgIC8vIHdlIGhhdmUgdG8gY29weSB0byBnZXQgYSBj\nb2xsZWN0aW9uIG9mIHRoZSByaWdodCB0eXBlIGFuZCBzaXplLAogICAgICAg\nICAgICAvLyB0aG91Z2ggd2UgaW1tZWRpYXRlbHkgY2xlYXIgaXQKICAgICAg\nICAgICAgbWFwID0gZ2V0UHJveHlNYW5hZ2VyKCkuY29weU1hcChvcmlnKTsK\nICAgICAgICAgICAgaWYgKG1hcCA9PSBudWxsKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1jb3B5YWJs\nZSIsIGZtZCkpOwoKICAgICAgICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAg\nICAgIE9iamVjdCBrZXksIHZhbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBvcmlnLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGtleSA9IGVtYmVkKGZtZC5n\nZXRLZXkoKSwgZW50cnkuZ2V0S2V5KCkpOwogICAgICAgICAgICAgICAgdmFs\nID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmICh2YWxF\nbWJlZCkKICAgICAgICAgICAgICAgICAgICB2YWwgPSBlbWJlZChmbWQuZ2V0\nRWxlbWVudCgpLCB2YWwpOwogICAgICAgICAgICAgICAgbWFwLnB1dChrZXks\nIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBtYXAgPSBvcmlnOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICBlbnRyeS5zZXRWYWx1ZShlbWJlZChm\nbWQuZ2V0RWxlbWVudCgpLAogICAgICAgICAgICAgICAgICAgIGVudHJ5Lmdl\ndFZhbHVlKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbWFwOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSB0aGUgZ2l2\nZW4gb2JqZWN0IGVtYmVkZGVkLgogICAgICovCiAgICBwcml2YXRlIE9iamVj\ndCBlbWJlZChWYWx1ZU1ldGFEYXRhIHZtZCwgT2JqZWN0IG9iaikgewogICAg\nICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgcmV0dXJuIF9icm9rZXIuZW1iZWQob2JqLCBudWxsLCBfc20s\nIHZtZCkuZ2V0TWFuYWdlZEluc3RhbmNlKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHByb3h5IG1hbmFnZXIuCiAgICAgKi8KICAgIHBy\naXZhdGUgUHJveHlNYW5hZ2VyIGdldFByb3h5TWFuYWdlciAoKQoJewoJCXJl\ndHVybiBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24gKCkuZ2V0UHJveHlNYW5h\nZ2VySW5zdGFuY2UgKCk7Cgl9Cn0K\n","encoding":"base64"}

