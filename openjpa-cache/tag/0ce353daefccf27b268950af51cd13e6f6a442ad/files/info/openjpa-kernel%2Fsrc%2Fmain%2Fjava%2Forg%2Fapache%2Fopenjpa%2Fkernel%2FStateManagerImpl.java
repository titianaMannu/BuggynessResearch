{"sha":"c7cdb89cb75af7884f58eee754e40f93e487a567","node_id":"MDQ6QmxvYjIwNjM2NDpjN2NkYjg5Y2I3NWFmNzg4NGY1OGVlZTc1NGU0MGY5M2U0ODdhNTY3","size":101163,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c7cdb89cb75af7884f58eee754e40f93e487a567","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0OwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZhLnV0aWwuKjsKCmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuRmllbGRNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdp\nc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLlN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\ndmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXA7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuVXBkYXRlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNhdGlvbklkczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nUHJveHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3I7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGls\nLk51bWJlcnM7CgovKioKICogSW1wbGVtZW50YXRpb24gb2YgdGhlIHtAbGlu\nayBPcGVuSlBBU3RhdGVNYW5hZ2VyfSBpbnRlcmZhY2UgZm9yIHVzZQogKiB3\naXRoIHRoaXMgcnVudGltZS4gRWFjaCBzdGF0ZSBtYW5hZ2VyIG1hbmFnZXMg\ndGhlIHN0YXRlIG9mIGEgc2luZ2xlCiAqIHBlcnNpc3RlbmNlIGNhcGFibGUg\naW5zdGFuY2UuIFRoZSBzdGF0ZSBtYW5hZ2VyIGlzIGFsc28gcmVzcG9uc2li\nbGUgZm9yCiAqIGFsbCBjb21tdW5pY2F0aW9ucyBhYm91dCB0aGUgaW5zdGFu\nY2UgdG8gdGhlIHtAbGluayBTdG9yZU1hbmFnZXJ9LgogKiAgVGhlIHN0YXRl\nIG1hbmFnZXIgdXNlcyB0aGUgU3RhdGUgcGF0dGVybiBpbiBib3RoIGl0cyBp\nbnRlcmFjdGlvbiB3aXRoCiAqIHRoZSBnb3Zlcm5lZCBpbnN0YW5jZSBhbmQg\naXRzIGludGVyYWN0aW9uIHdpdGggdGhlIGJyb2tlci4KICogSW4gaXRzIGlu\ndGVyYWN0aW9ucyB3aXRoIHRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIGluc3Rh\nbmNlLCBpdCB1c2VzIHRoZQogKiB7QGxpbmsgRmllbGRNYW5hZ2VyfSBpbnRl\ncmZhY2UuIFNpbWlsYXJseSwgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZQog\nKiBicm9rZXIsIGl0IHVzZXMgdGhlIHtAbGluayBQQ1N0YXRlfSBzaW5nbGV0\nb24gdGhhdCByZXByZXNlbnRzCiAqIHRoZSBjdXJyZW50IGxpZmVjeWNsZSBz\ndGF0ZSBvZiB0aGUgaW5zdGFuY2UuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqLwpwdWJsaWMgY2xhc3MgU3RhdGVNYW5hZ2VySW1wbAogICAgaW1wbGVt\nZW50cyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBMT0FEX0ZHUyA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBMT0FEX0FMTCA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBMT0FEX1NFUklBTElaRSA9IDI7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfU0FWRSA9IDIgPDwgMDsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBGTEFHX0RFUkVGID0gMiA8PCAxOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfTE9BREVEID0gMiA8PCAyOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVBRF9MT0NLRUQgPSAy\nIDw8IDM7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19XUklU\nRV9MT0NLRUQgPSAyIDw8IDQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19PSURfQVNTSUdORUQgPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRkxBR19MT0FESU5HID0gMiA8PCA2OwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUFJFX0RFTEVUSU5HID0gMiA8\nPCA3OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hF\nRCA9IDIgPDwgODsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFH\nX1BSRV9GTFVTSEVEID0gMiA8PCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IEZMQUdfRkxVU0hFRF9ESVJUWSA9IDIgPDwgMTA7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19JTVBMX0NBQ0hFID0gMiA8PCAx\nMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0lOVkVSU0VT\nID0gMiA8PCAxMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFH\nX05PX1VOUFJPWFkgPSAyIDw8IDEzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IEZMQUdfVkVSU0lPTl9DSEVDSyA9IDIgPDwgMTQ7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19WRVJTSU9OX1VQREFURSA9IDIg\nPDwgMTU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19ERVRB\nQ0hJTkcgPSAyIDw8IDE2OwoKICAgIHByaXZhdGUgc3RhdGljIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoU3RhdGVN\nYW5hZ2VySW1wbC5jbGFzcyk7CgogICAgLy8gaW5mb3JtYXRpb24gYWJvdXQg\ndGhlIGluc3RhbmNlCiAgICBwcml2YXRlIFBlcnNpc3RlbmNlQ2FwYWJsZSBf\ncGMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9tZXRhID0g\nbnVsbDsKICAgIHByaXZhdGUgQml0U2V0IF9sb2FkZWQgPSBudWxsOwogICAg\ncHJpdmF0ZSBCaXRTZXQgX2RpcnR5ID0gbnVsbDsKICAgIHByaXZhdGUgQml0\nU2V0IF9mbHVzaCA9IG51bGw7CiAgICBwcml2YXRlIGludCBfZmxhZ3MgPSAw\nOwoKICAgIC8vIGlkIGlzIHRoZSBzdGF0ZSBtYW5hZ2VyIGlkZW50aXR5OyBv\naWQgaXMgdGhlIHBlcnNpc3RlbnQgaWRlbnRpdHkuICBvaWQKICAgIC8vIG1h\neSBiZSBudWxsIGZvciBlbWJlZGRlZCBhbmQgdHJhbnNpZW50LXRyYW5zYWN0\naW9uYWwgb2JqZWN0cyBvciBuZXcKICAgIC8vIGluc3RhbmNlcyB0aGF0IGhh\ndmVuJ3QgYmVlbiBhc3NpZ25lZCBhbiBvaWQuICBpZCBpcyByZWFzc2lnbmVk\nIHRvIG9pZAogICAgLy8gb24gc3VjY2Vzc2Z1bCBvaWQgYXNzaWdubWVudCAo\nb3IgZmx1c2ggY29tcGxldGlvbiBpZiBhc3NpZ25tZW50IGlzCiAgICAvLyBk\ndXJpbmcgZmx1c2gpCiAgICBwcml2YXRlIE9iamVjdCBfaWQgPSBudWxsOwog\nICAgcHJpdmF0ZSBPYmplY3QgX29pZCA9IG51bGw7CgogICAgLy8gdGhlIG1h\nbmFnaW5nIHBlcnNpc3RlbmNlIG1hbmFnZXIgYW5kIGxpZmVjeWNsZSBzdGF0\nZQogICAgcHJpdmF0ZSBmaW5hbCBCcm9rZXJJbXBsIF9icm9rZXI7CiAgICBw\ncml2YXRlIFBDU3RhdGUgX3N0YXRlID0gUENTdGF0ZS5UUkFOU0lFTlQ7Cgog\nICAgLy8gdGhlIGN1cnJlbnQgYW5kIGxhc3QgbG9hZGVkIHZlcnNpb24gaW5k\naWNhdG9ycywgYW5kIHRoZSBsb2NrIG9iamVjdAogICAgcHJpdmF0ZSBPYmpl\nY3QgX3ZlcnNpb24gPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xvYWRW\nZXJzaW9uID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0IF9sb2NrID0gbnVs\nbDsKICAgIHByaXZhdGUgaW50IF9yZWFkTG9ja0xldmVsID0gLTE7CiAgICBw\ncml2YXRlIGludCBfd3JpdGVMb2NrTGV2ZWwgPSAtMTsKCiAgICAvLyBkZWxl\nZ2F0ZXMgd2hlbiBwcm92aWRpbmcvcmVwbGFjaW5nIGluc3RhbmNlIGRhdGEK\nICAgIHByaXZhdGUgU2luZ2xlRmllbGRNYW5hZ2VyIF9zaW5nbGUgPSBudWxs\nOwogICAgcHJpdmF0ZSBTYXZlRmllbGRNYW5hZ2VyIF9zYXZlZCA9IG51bGw7\nCiAgICBwcml2YXRlIEZpZWxkTWFuYWdlciBfZm0gPSBudWxsOwoKICAgIC8v\nIGltcGxkYXRhOyBmaWVsZCBpbXBsZGF0YSBhbmQgaW50ZXJtZWRpYXRlIGRh\ndGEgc2hhcmUgdGhlIHNhbWUgYXJyYXkKICAgIHByaXZhdGUgT2JqZWN0IF9p\nbXBsID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0W10gX2ZpZWxkSW1wbCA9\nIG51bGw7CgogICAgLy8gaW5mb3JtYXRpb24gYWJvdXQgdGhlIG93bmVyIG9m\nIHRoaXMgaW5zdGFuY2UsIGlmIGl0IGlzIGVtYmVkZGVkCiAgICBwcml2YXRl\nIFN0YXRlTWFuYWdlckltcGwgX293bmVyID0gbnVsbDsKICAgIHByaXZhdGUg\nVmFsdWVNZXRhRGF0YSBfb3duZXJNZXRhID0gbnVsbDsKCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgaWQsIHR5cGUgbWV0YWRhdGEsIGFu\nZCBvd25pbmcgcGVyc2lzdGVuY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFN0YXRlTWFuYWdlckltcGwoT2JqZWN0IGlkLCBDbGFzc01ldGFE\nYXRhIG1ldGEsIAogICAgICAgIEJyb2tlckltcGwgYnJva2VyKSB7CiAgICAg\nICAgX2lkID0gaWQ7CiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgICAgIF9i\ncm9rZXIgPSBicm9rZXI7CiAgICAgICAgX3NpbmdsZSA9IG5ldyBTaW5nbGVG\naWVsZE1hbmFnZXIodGhpcywgYnJva2VyKTsKCiAgICAgICAgaWYgKF9tZXRh\nLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9X\nTikKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm1ldGEtdW5rbm93bmlkIiwgX21ldGEpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgb3duaW5nIHN0YXRlIGFuZCBmaWVsZCBpZiB0aGlz\nIGlzIGFuIGVtYmVkZGVkIGluc3RhbmNlLgogICAgICovCiAgICB2b2lkIHNl\ndE93bmVyKFN0YXRlTWFuYWdlckltcGwgb3duZXIsIFZhbHVlTWV0YURhdGEg\nb3duZXJNZXRhKSB7CiAgICAgICAgX293bmVyID0gb3duZXI7CiAgICAgICAg\nX293bmVyTWV0YSA9IG93bmVyTWV0YTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdGhpcyBzdGF0ZSBtYW5hZ2VyIGlzIGluIHRoZSBtaWRkbGUg\nb2YgYSBsb2FkLgogICAgICovCiAgICBib29sZWFuIGlzTG9hZGluZygpIHsK\nICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfTE9BRElORykgPiAwOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIHN0YXRlIG1hbmFn\nZXIgaXMgaW4gdGhlIG1pZGRsZSBvZiBhIGxvYWQgaW5pdGlhdGVkCiAgICAg\nKiBieSBvdXRzaWRlIGNvZGU7IGZvciBhbnkgaW50ZXJuYWwgbWV0aG9kcyB0\naGF0IGNhdXNlIGxvYWRpbmcsIHRoZQogICAgICogbG9hZGluZyBmbGFnIGlz\nIHNldCBhdXRvbWF0aWNhbGx5LgogICAgICovCiAgICB2b2lkIHNldExvYWRp\nbmcoYm9vbGVhbiBsb2FkaW5nKSB7CiAgICAgICAgaWYgKGxvYWRpbmcpCiAg\nICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0xPQURJTkc7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfTE9BRElORzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCBvciByZXNldCB0aGUgbGlmZWN5Y2xlIHN0\nYXRlIG9mIHRoZSBtYW5hZ2VkIGluc3RhbmNlLiBJZiB0aGUKICAgICAqIHRy\nYW5zYWN0aW9uYWwgc3RhdGUgb2YgdGhlIGluc3RhbmNlIGNoYW5nZXMsIGl0\nIHdpbGwgYmUgZW5saXN0ZWQvCiAgICAgKiBkZWxpc3RlZCBmcm9tIHRoZSBj\ndXJyZW50IHRyYW5zYWN0aW9uIGFzIG5lY2Vzc2FyeS4gVGhlIGdpdmVuCiAg\nICAgKiBzdGF0ZSB3aWxsIGJlIGluaXRpYWxpemVkIGFmdGVyIGJlaW5nIHNl\ndC4gSWYgdGhlIGdpdmVuIHN0YXRlCiAgICAgKiBpcyB0aGUgc2FtZSBhcyB0\naGUgY3VycmVudCBzdGF0ZSwgdGhpcyBtZXRob2Qgd2lsbCBoYXZlIG5vIGVm\nZmVjdC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNldFBDU3RhdGUoUENT\ndGF0ZSBzdGF0ZSkgewogICAgICAgIGlmIChfc3RhdGUgPT0gc3RhdGUpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIG5vdGlmeSB0aGUgc3RvcmUgbWFuYWdlciB0\naGF0IHdlJ3JlIGNoYW5naW5nIHN0YXRlczsgY2FuIHZldG8KICAgICAgICAg\nICAgX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5iZWZvcmVTdGF0ZUNoYW5n\nZSh0aGlzLCBfc3RhdGUsIHN0YXRlKTsKCiAgICAgICAgICAgIC8vIHJlcGxh\nY2Ugc3RhdGUKICAgICAgICAgICAgYm9vbGVhbiB3YXNEZWxldGVkID0gX3N0\nYXRlLmlzRGVsZXRlZCgpOwogICAgICAgICAgICBib29sZWFuIHdhc0RpcnR5\nID0gX3N0YXRlLmlzRGlydHkoKTsKICAgICAgICAgICAgYm9vbGVhbiB3YXNQ\nZW5kaW5nID0gX3N0YXRlLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKTsKICAg\nICAgICAgICAgX3N0YXRlID0gc3RhdGU7CgogICAgICAgICAgICAvLyBlbmxp\nc3QvZGVsaXN0IGZyb20gdHJhbnNhY3Rpb24KICAgICAgICAgICAgaWYgKF9z\ndGF0ZS5pc1RyYW5zYWN0aW9uYWwoKSkgewogICAgICAgICAgICAgICAgX2Jy\nb2tlci5hZGRUb1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAgICAgICAgICAg\naWYgKF9zdGF0ZS5pc0RlbGV0ZWQoKSAhPSB3YXNEZWxldGVkKQogICAgICAg\nICAgICAgICAgICAgIF9icm9rZXIuc2V0RGlydHkodGhpcywgIXdhc0RpcnR5\nIHx8IGlzRmx1c2hlZCgpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9z\ndGF0ZS5pc0RpcnR5KCkgJiYgIXdhc0RpcnR5KQogICAgICAgICAgICAgICAg\nICAgIF9icm9rZXIuc2V0RGlydHkodGhpcywgdHJ1ZSk7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoIXdhc1BlbmRpbmcgJiYgX3N0YXRlLmlzUGVuZGluZ1Ry\nYW5zYWN0aW9uYWwoKSkKICAgICAgICAgICAgICAgIF9icm9rZXIuYWRkVG9Q\nZW5kaW5nVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKHdhc1BlbmRpbmcgJiYgIV9zdGF0ZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFs\nKCkpCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZUZyb21QZW5kaW5n\nVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIF9icm9rZXIucmVtb3ZlRnJvbVRyYW5zYWN0aW9uKHRoaXMpOwoK\nICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZQogICAgICAgICAgICBfc3RhdGUu\naW5pdGlhbGl6ZSh0aGlzKTsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5pc0Rl\nbGV0ZWQoKSAmJiAhd2FzRGVsZXRlZCkKICAgICAgICAgICAgICAgIGZpcmVM\naWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9ERUxFVEUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gT3BlbkpQQVN0YXRlTWFuYWdlciBpbXBsZW1l\nbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXplKENsYXNzIGNscywg\nUENTdGF0ZSBzdGF0ZSkgewogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiBv\ndXIgY3VycmVudCBvYmplY3QgaWQgaW5zdGFuY2UgaXMgdGhlCiAgICAgICAg\nLy8gY29ycmVjdCBpZCB0eXBlIGZvciB0aGUgc3BlY2lmaWVkIGNsYXNzOyB0\naGlzIGlzIGZvciBjYXNlcwogICAgICAgIC8vIHdoZW4gd2UgaGF2ZSBhbiBh\ncHBsaWNhdGlvbiBpZCBoaWVyYXJjaHkgYW5kIHdlIGhhZCBzZXQgdGhlCiAg\nICAgICAgLy8gbWV0YWRhdGEgdG8gYSBzdXBlcmNsYXNzIGlkIC0tIHRoZSBz\ndWJjbGFzcycgaWQgbWF5IGJlIGEKICAgICAgICAvLyBkaWZmZXJlbnQgY2xh\nc3MsIHNvIHdlIG5lZWQgdG8gcmVzZXQgaXQKICAgICAgICBpZiAoX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpICE9IGNscykgewogICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIHN1YiA9IF9tZXRhLmdldFJlcG9zaXRvcnkoKS5nZXRNZXRh\nRGF0YQogICAgICAgICAgICAgICAgKGNscywgX2Jyb2tlci5nZXRDbGFzc0xv\nYWRlcigpLCB0cnVlKTsKICAgICAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKQogICAgICAgICAgICAg\nICAgICAgIF9vaWQgPSBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmNvcHlE\nYXRhU3RvcmVJZChfb2lkLAogICAgICAgICAgICAgICAgICAgICAgICBzdWIp\nOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoX21ldGEuaXNPcGVuSlBBSWRl\nbnRpdHkoKSkKICAgICAgICAgICAgICAgICAgICBfb2lkID0gQXBwbGljYXRp\nb25JZHMuY29weShfb2lkLCBzdWIpOwogICAgICAgICAgICAgICAgZWxzZSBp\nZiAoc3ViLmdldE9iamVjdElkVHlwZSgpICE9IF9tZXRhLmdldE9iamVjdElk\nVHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0W10gcGtGaWVs\nZHMgPSBBcHBsaWNhdGlvbklkcy50b1BLVmFsdWVzKF9vaWQsIF9tZXRhKTsK\nICAgICAgICAgICAgICAgICAgICBfb2lkID0gQXBwbGljYXRpb25JZHMuZnJv\nbVBLVmFsdWVzKHBrRmllbGRzLCBzdWIpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIF9tZXRhID0gc3ViOwogICAgICAg\nIH0KICAgICAgICBpZiAoY2xzLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAg\nIGNscyA9IF9tZXRhLmdldEludGVyZmFjZUltcGwoKTsKCiAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIGluc3QgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNl\nKGNscywgdGhpcywgX29pZCwgdHJ1ZSk7CiAgICAgICAgaWYgKGluc3QgPT0g\nbnVsbCkgewogICAgICAgICAgICAvLyB0aGUgaW5zdGFuY2Ugd2FzIG51bGw6\nIGNoZWNrIHRvIHNlZSBpZiB0aGUgaW5zdGFuY2UgaXMKICAgICAgICAgICAg\nLy8gYWJzdHJhY3QgKGFzIGNhbiBzb21ldGltZXMgYmUgdGhlIGNhc2Ugd2hl\nbiB0aGUKICAgICAgICAgICAgLy8gY2xhc3MgZGlzY3JpbWluYXRvciBzdHJh\ndGVneSBpcyBub3QgY29uZmlndXJlZCBjb3JyZWN0bHkpCiAgICAgICAgICAg\nIGlmIChNb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9j\nLmdldCgiaW5zdGFudGlhdGUtYWJzdHJhY3QiLAogICAgICAgICAgICAgICAg\nICAgIGNscy5nZXROYW1lKCksIF9vaWQpKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBp\nbml0aWFsaXplKGluc3QsIHN0YXRlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEluaXRpYWxpemUgd2l0aCB0aGUgZ2l2ZW4gaW5zdGFuY2UgYW5kIHN0YXRl\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgUENTdGF0ZSBzdGF0ZSkgewogICAgICAgIGlm\nIChwYyA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgiaW5pdC1udWxsLXBjIiwgX21ldGEpKTsKICAgICAg\nICBpZiAocGMucGNHZXRTdGF0ZU1hbmFnZXIoKSAhPSBudWxsICYmIHBjLnBj\nR2V0U3RhdGVNYW5hZ2VyKCkgIT0gdGhpcykKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImluaXQtc20tcGMiLAogICAg\nICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhwYykpKS5zZXRGYWls\nZWRPYmplY3QocGMpOwogICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdl\ncih0aGlzKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBfbG9hZGVkID0gbmV3IEJpdFNldChm\nbWRzLmxlbmd0aCk7CiAgICAgICAgX2ZsdXNoID0gbmV3IEJpdFNldChmbWRz\nLmxlbmd0aCk7CiAgICAgICAgX2RpcnR5ID0gbmV3IEJpdFNldChmbWRzLmxl\nbmd0aCk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAvLyBtYXJrIHByaW1hcnkga2V5IGFu\nZCBub24tcGVyc2lzdGVudCBmaWVsZHMgYXMgbG9hZGVkCiAgICAgICAgICAg\nIGlmIChmbWRzW2ldLmlzUHJpbWFyeUtleSgpCiAgICAgICAgICAgICAgICB8\nfCBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSAhPSBmbWRzW2ldLk1BTkFHRV9Q\nRVJTSVNURU5UKQogICAgICAgICAgICAgICAgX2xvYWRlZC5zZXQoaSk7Cgog\nICAgICAgICAgICAvLyByZWNvcmQgd2hldGhlciB0aGVyZSBhcmUgYW55IG1h\nbmFnZWQgaW52ZXJzZSBmaWVsZHMKICAgICAgICAgICAgaWYgKF9icm9rZXIu\nZ2V0SW52ZXJzZU1hbmFnZXIoKSAhPSBudWxsCiAgICAgICAgICAgICAgICAm\nJiBmbWRzW2ldLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPiAwKQog\nICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfSU5WRVJTRVM7CiAgICAg\nICAgfQoKICAgICAgICBwYy5wY1NldERldGFjaGVkU3RhdGUobnVsbCk7CiAg\nICAgICAgcGMucGNSZXBsYWNlRmxhZ3MoKTsKICAgICAgICBfcGMgPSBwYzsK\nCiAgICAgICAgaWYgKF9vaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAg\nICAgICAgICgoT3BlbkpQQUlkKSBfb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VU\neXBlKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CgogICAgICAgIC8vIGlu\naXRpYWxpemUgb3VyIHN0YXRlIGFuZCBhZGQgb3Vyc2VsdmVzIHRvIHRoZSBi\ncm9rZXIncyBjYWNoZQogICAgICAgIHNldFBDU3RhdGUoc3RhdGUpOwogICAg\nICAgIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKF9pZCwgdGhpcywgQnJva2Vy\nSW1wbC5TVEFUVVNfSU5JVCk7CiAgICAgICAgaWYgKHN0YXRlID09IFBDU3Rh\ndGUuUE5FVykKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVj\neWNsZUV2ZW50LkFGVEVSX1BFUlNJU1QpOwogICAgfQoKICAgIC8qKgogICAg\nICogRmlyZSB0aGUgZ2l2ZW4gbGlmZWN5Y2xlIGV2ZW50IHRvIGFsbCBsaXN0\nZW5lcnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBmaXJlTGlmZWN5\nY2xlRXZlbnQoaW50IHR5cGUpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlci5m\naXJlTGlmZWN5Y2xlRXZlbnQoZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGws\nCiAgICAgICAgICAgIF9tZXRhLCB0eXBlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBsb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIGxvYWQoZmV0Y2gsIExPQURfRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBzdGF0ZSBvZiB0aGlzIGlu\nc3RhbmNlIGJhc2VkIG9uIHRoZSBnaXZlbiBmZXRjaCBjb25maWd1cmF0aW9u\nCiAgICAgKiBhbmQgbG9hZCBtb2RlLiBSZXR1cm4gdHJ1ZSBpZiBhbnkgZGF0\nYSB3YXMgbG9hZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBib29sZWFuIGxvYWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBpbnQgbG9hZE1vZGUsCiAgICAgICAgQml0U2V0IGV4Y2x1ZGUsIE9iamVj\ndCBzZGF0YSwgYm9vbGVhbiBmb3JXcml0ZSkgewogICAgICAgIGlmICghZm9y\nV3JpdGUgJiYgKCFpc1BlcnNpc3RlbnQoKSB8fCBpc05ldygpIHx8IGlzRGVs\nZXRlZCgpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAv\nLyBpZiBhbnkgZmllbGRzIGJlaW5nIGxvYWRlZCwgZG8gc3RhdGUgdHJhbnNp\ndGlvbnMgZm9yIHJlYWQKICAgICAgICBCaXRTZXQgZmllbGRzID0gZ2V0VW5s\nb2FkZWRJbnRlcm5hbChmZXRjaCwgbG9hZE1vZGUsIGV4Y2x1ZGUpOwogICAg\nICAgIGJvb2xlYW4gYWN0aXZlID0gX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAg\nICAgIGlmICghZm9yV3JpdGUgJiYgZmllbGRzICE9IG51bGwpCiAgICAgICAg\nICAgIGJlZm9yZVJlYWQoLTEpOwoKICAgICAgICAvLyBjYWxsIGxvYWQgZXZl\nbiBpZiBubyBmaWVsZHMgYXJlIGJlaW5nIGxvYWRlZCwgYmVjYXVzZSBpdCB0\nYWtlcwogICAgICAgIC8vIGNhcmUgb2YgY2hlY2tpbmcgaWYgdGhlIERGRyBp\ncyBsb2FkZWQsIG1ha2luZyBzdXJlIHZlcnNpb24gaW5mbwogICAgICAgIC8v\nIGlzIGxvYWRlZCwgZXRjCiAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNhbGN1\nbGF0ZUxvY2tMZXZlbChhY3RpdmUsIGZvcldyaXRlLCBmZXRjaCk7CiAgICAg\nICAgYm9vbGVhbiByZXQgPSBsb2FkRmllbGRzKGZpZWxkcywgZmV0Y2gsIGxv\nY2tMZXZlbCwgc2RhdGEsIGZvcldyaXRlKTsKICAgICAgICBvYnRhaW5Mb2Nr\ncyhhY3RpdmUsIGZvcldyaXRlLCBsb2NrTGV2ZWwsIGZldGNoLCBzZGF0YSk7\nCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldE1hbmFnZWRJbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gX3BjOwog\nICAgfQoKICAgIHB1YmxpYyBQZXJzaXN0ZW5jZUNhcGFibGUgZ2V0UGVyc2lz\ndGVuY2VDYXBhYmxlKCkgewogICAgICAgIHJldHVybiBfcGM7CiAgICB9Cgog\nICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAgICAg\nICAgcmV0dXJuIF9tZXRhOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIGdldE93bmVyKCkgewogICAgICAgIHJldHVybiBfb3duZXI7\nCiAgICB9CgogICAgcHVibGljIFZhbHVlTWV0YURhdGEgZ2V0T3duZXJNZXRh\nRGF0YSgpIHsKICAgICAgICByZXR1cm4gX293bmVyTWV0YTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0VtYmVkZGVkKCkgewogICAgICAgIHJldHVy\nbiBfb3duZXIgIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0ZsdXNoZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIRUQpID4gMDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ZsdXNo\nZWREaXJ0eSgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxV\nU0hFRF9ESVJUWSkgPiAwOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0\nTG9hZGVkKCkgewogICAgICAgIHJldHVybiBfbG9hZGVkOwogICAgfQoKICAg\nIHB1YmxpYyBCaXRTZXQgZ2V0Rmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4g\nX2ZsdXNoOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0RGlydHkoKSB7\nCiAgICAgICAgcmV0dXJuIF9kaXJ0eTsKICAgIH0KCiAgICBwdWJsaWMgQml0\nU2V0IGdldFVubG9hZGVkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewog\nICAgICAgIC8vIGNvbGxlY3QgZmllbGRzIHRvIGxvYWQgZnJvbSBkYXRhIHN0\nb3JlIGJhc2VkIG9uIGZldGNoIGNvbmZpZ3VyYXRpb24KICAgICAgICBCaXRT\nZXQgZmllbGRzID0gZ2V0VW5sb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9G\nR1MsIG51bGwpOwogICAgICAgIHJldHVybiAoZmllbGRzID09IG51bGwpID8g\nbmV3IEJpdFNldCgwKSA6IGZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAq\nIEludGVybmFsIHZlcnNpb24gb2Yge0BsaW5rIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIjZ2V0VW5sb2FkZWR9IHRoYXQgYXZvaWRzCiAgICAgKiBjcmVhdGluZyBh\nbiBlbXB0eSBiaXQgc2V0IGJ5IHJldHVybmluZyBudWxsIHdoZW4gdGhlcmUg\nYXJlIG5vIHVubG9hZGVkCiAgICAgKiBmaWVsZHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgQml0U2V0IGdldFVubG9hZGVkSW50ZXJuYWwoRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBpbnQgbW9kZSwKICAgICAgICBCaXRTZXQgZXhjbHVk\nZSkgewogICAgICAgIGlmIChleGNsdWRlID09IFN0b3JlQ29udGV4dC5FWENM\nVURFX0FMTCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEJp\ndFNldCBmaWVsZHMgPSBudWxsOwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgYm9vbGVhbiBsb2Fk\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoaSkgfHwgKGV4Y2x1\nZGUgIT0gbnVsbCAmJiBleGNsdWRlLmdldChpKSkpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIHN3aXRjaCAobW9kZSkgewogICAg\nICAgICAgICAgICAgY2FzZSBMT0FEX1NFUklBTElaRToKICAgICAgICAgICAg\nICAgICAgICBsb2FkID0gIWZtZHNbaV0uaXNUcmFuc2llbnQoKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTE9B\nRF9GR1M6CiAgICAgICAgICAgICAgICAgICAgbG9hZCA9IGZldGNoID09IG51\nbGwgfHwgZmV0Y2gucmVxdWlyZXNGZXRjaChmbWRzW2ldKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6IC8v\nIExPQURfQUxMCiAgICAgICAgICAgICAgICAgICAgbG9hZCA9IHRydWU7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2FkKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAgICAg\nICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9CgogICAgcHVibGljIFN0\nb3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBfYnJv\na2VyOwogICAgfQoKICAgIC8qKgogICAgICogTWFuYWdpbmcgYnJva2VyLgog\nICAgICovCiAgICBCcm9rZXJJbXBsIGdldEJyb2tlcigpIHsKICAgICAgICBy\nZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldElk\nKCkgewogICAgICAgIHJldHVybiBfaWQ7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBnZXRPYmplY3RJZCgpIHsKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20uZ2V0T3duZXIoKSAhPSBu\ndWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBzbS5n\nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbS5fb2lkOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldE9iamVjdElkKE9iamVjdCBvaWQpIHsKICAgICAg\nICBfb2lkID0gb2lkOwogICAgICAgIGlmIChfcGMgIT0gbnVsbCAmJiBvaWQg\naW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQQUlk\nKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25P\nYmplY3RJZChib29sZWFuIGZsdXNoKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJZChm\nbHVzaCwgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFz\nayBzdG9yZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIgb2lkLCBvcHRpb25hbGx5\nIGZsdXNoaW5nIGFuZAogICAgICogb3B0aW9uYWxseSByZWNhY2hpbmcgb24g\ndGhlIG5ldyBvaWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBhc3Np\nZ25PYmplY3RJZChib29sZWFuIGZsdXNoLCBib29sZWFuIHByZUZsdXNoaW5n\nKSB7CiAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCB8fCBpc0VtYmVkZGVkKCkg\nfHwgIWlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYXNzaWdu\nT2JqZWN0SWQodGhpcywgcHJlRmx1c2hpbmcpKSB7CiAgICAgICAgICAgIGlm\nICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgICAgICBhc3NlcnRPYmplY3RJ\nZEFzc2lnbmVkKHRydWUpOwogICAgICAgIH0gZWxzZSBpZiAoZmx1c2gpCiAg\nICAgICAgICAgIF9icm9rZXIuZmx1c2goKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSB3ZXJlIGFzc2lnbmVk\nIGFuIG9pZCwgYW5kIHBlcmZvcm0gYWN0aW9ucyB0byBtYWtlIGl0CiAgICAg\nKiBwZXJtYW5lbnQuCiAgICAgKgogICAgICogQHBhcmFtIHJlY2FjaGUgd2hl\ndGhlciB0byByZWNhY2hlIG91cnNlbGYgb24gdGhlIG5ldyBvaWQKICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE9iamVjdElkQXNzaWduZWQoYm9v\nbGVhbiByZWNhY2hlKSB7CiAgICAgICAgaWYgKCFpc05ldygpIHx8IGlzRGVs\nZXRlZCgpIHx8IGlzUHJvdmlzaW9uYWwoKSAKICAgICAgICAgICAgfHwgKF9m\nbGFncyAmIEZMQUdfT0lEX0FTU0lHTkVEKSAhPSAwKQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5JRF9EQVRBU1RPUkUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50\nZXJuYWxFeGNlcHRpb24oRXhjZXB0aW9ucy50b1N0cmluZwogICAgICAgICAg\nICAgICAgICAgIChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgICAgICAg\nICBfb2lkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKF9wYywgX21ldGEpOwog\nICAgICAgIH0KCiAgICAgICAgT2JqZWN0IG9yaWcgPSBfaWQ7CiAgICAgICAg\nX2lkID0gX29pZDsKICAgICAgICBpZiAocmVjYWNoZSkgewogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgX2Jyb2tlci5zZXRTdGF0ZU1hbmFn\nZXIob3JpZywgdGhpcywKICAgICAgICAgICAgICAgICAgICBCcm9rZXJJbXBs\nLlNUQVRVU19PSURfQVNTSUdOKTsKICAgICAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAgX2lkID0gb3Jp\nZzsKICAgICAgICAgICAgICAgIF9vaWQgPSBudWxsOwogICAgICAgICAgICAg\nICAgdGhyb3cgcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfT0lEX0FTU0lHTkVEOwogICAgfQoKICAgIC8qKgog\nICAgICogQXNzaWduIHRoZSBwcm9wZXIgZ2VuZXJhdGVkIHZhbHVlIHRvIHRo\nZSBnaXZlbiBmaWVsZCBiYXNlZCBvbiBpdHMKICAgICAqIHZhbHVlLXN0cmF0\nZWd5LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gYXNzaWduRmllbGQo\naW50IGZpZWxkLCBib29sZWFuIHByZUZsdXNoaW5nKSB7CiAgICAgICAgT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSA9IHRoaXM7CiAgICAgICAgd2hpbGUgKHNt\nLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgc20gPSBzbS5nZXRPd25lcigp\nOwogICAgICAgIGlmICghc20uaXNOZXcoKSB8fCBzbS5pc0ZsdXNoZWQoKSB8\nfCBzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICAvLyBzcGVjaWFsLWNhc2Ugb2lkIGZpZWxkcywgd2hpY2ggcmVx\ndWlyZSB1cyB0byBsb29rIGluc2lkZSB0aGUgb2lkCiAgICAgICAgLy8gb2Jq\nZWN0CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAgICAgICAgICAvLyB0cnkgdG8g\nc2hvcnRjdXQgaWYgcG9zc2libGUKICAgICAgICAgICAgaWYgKF9vaWQgIT0g\nbnVsbCB8fCBpc0VtYmVkZGVkKCkgfHwgIWlzUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgICAgICAvLyBjaGVj\nayBlbWJlZGRlZCBmaWVsZHMgb2Ygb2lkIGZvciB2YWx1ZSBzdHJhdGVneSAr\nIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBr\ncyA9IGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAg\nICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBudWxsOwog\nICAgICAgICAgICBib29sZWFuIGFzc2lnbiA9IGZhbHNlOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgIWFzc2lnbiAmJiBpIDwgcGtzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdldFZhbHVlU3Ry\nYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChvaWRzbSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG9pZHNtID0gbmV3IE9iamVj\ndElkU3RhdGVNYW5hZ2VyKGZldGNoT2JqZWN0RmllbGQoZmllbGQpLAogICAg\nICAgICAgICAgICAgICAgICAgICB0aGlzLCBmbWQpOwogICAgICAgICAgICAg\nICAgYXNzaWduID0gb2lkc20uaXNEZWZhdWx0VmFsdWUoaSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFzc2lnbiAmJiBhc3NpZ25PYmpl\nY3RJZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGRvbid0IGFzc2lnbiB2YWx1ZXMgdG8gZmllbGRzIHdpdGgg\nbm9uLWRlZmF1bHQgdmFsdWVzIGFscmVhZHkKICAgICAgICBpZiAoZm1kLmdl\ndFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORQogICAg\nICAgICAgICB8fCAhaXNEZWZhdWx0VmFsdWUoZmllbGQpKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGZvciBwcmltYXJ5IGtleSBm\naWVsZHMsIGFzc2lnbiB0aGUgb2JqZWN0IGlkIGFuZCByZWNhY2hlIHNvIHRo\nYXQKICAgICAgICAvLyB0byB0aGUgdXNlciwgc28gaXQgbG9va3MgbGlrZSB0\naGUgb2lkIGFsd2F5cyBtYXRjaGVzIHRoZSBwayBmaWVsZHMKICAgICAgICBp\nZiAoZm1kLmlzUHJpbWFyeUtleSgpICYmICFpc0VtYmVkZGVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJZCghcHJlRmx1c2hpbmcsIHBy\nZUZsdXNoaW5nKTsKCiAgICAgICAgLy8gZm9yIG90aGVyIGZpZWxkcyBqdXN0\nIGFzc2lnbiB0aGUgZmllbGQgb3IgZmx1c2ggaWYgbmVlZGVkCiAgICAgICAg\naWYgKF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYXNzaWduRmllbGQodGhp\ncywgZmllbGQsIHByZUZsdXNoaW5nKSkKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgaWYgKCFwcmVGbHVzaGluZykKICAgICAgICAgICAgX2Jy\nb2tlci5mbHVzaCgpOwogICAgICAgIHJldHVybiAhcHJlRmx1c2hpbmc7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRMb2NrKCkgewogICAgICAgIHJl\ndHVybiBfbG9jazsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NrKE9i\namVjdCBsb2NrKSB7CiAgICAgICAgX2xvY2sgPSBsb2NrOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgZ2V0VmVyc2lvbigpIHsKICAgICAgICByZXR1cm4g\nX3ZlcnNpb247CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VmVyc2lvbihP\nYmplY3QgdmVyc2lvbikgewogICAgICAgIF92ZXJzaW9uID0gdmVyc2lvbjsK\nICAgICAgICBfbG9hZFZlcnNpb24gPSB2ZXJzaW9uOwoKICAgICAgICBGaWVs\nZE1ldGFEYXRhIHZmaWVsZCA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwog\nICAgICAgIGlmICh2ZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgc3RvcmUo\ndmZpZWxkLmdldEluZGV4KCksIEphdmFUeXBlcy5jb252ZXJ0KHZlcnNpb24s\nCiAgICAgICAgICAgICAgICB2ZmllbGQuZ2V0VHlwZUNvZGUoKSkpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldE5leHRWZXJzaW9uKE9iamVjdCB2ZXJz\naW9uKSB7CiAgICAgICAgX3ZlcnNpb24gPSB2ZXJzaW9uOwogICAgfQoKICAg\nIHB1YmxpYyBQQ1N0YXRlIGdldFBDU3RhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIE9iamVj\ndCBnZXRJbXBsRGF0YSgpIHsKICAgICAgICByZXR1cm4gX2ltcGw7CiAgICB9\nCgogICAgcHVibGljIHN5bmNocm9uaXplZCBPYmplY3Qgc2V0SW1wbERhdGEo\nT2JqZWN0IGRhdGEsIGJvb2xlYW4gY2FjaGVhYmxlKSB7CiAgICAgICAgT2Jq\nZWN0IG9sZCA9IF9pbXBsOwogICAgICAgIF9pbXBsID0gZGF0YTsKICAgICAg\nICBpZiAoY2FjaGVhYmxlICYmIGRhdGEgIT0gbnVsbCkKICAgICAgICAgICAg\nX2ZsYWdzIHw9IEZMQUdfSU1QTF9DQUNIRTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19JTVBMX0NBQ0hFOwogICAgICAgIHJl\ndHVybiBvbGQ7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNJbXBsRGF0\nYUNhY2hlYWJsZSgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdf\nSU1QTF9DQUNIRSkgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndEltcGxEYXRhKGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBnZXRFeHRy\nYUZpZWxkRGF0YShmaWVsZCwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBzZXRJbXBsRGF0YShpbnQgZmllbGQsIE9iamVjdCBkYXRhKSB7CiAg\nICAgICAgcmV0dXJuIHNldEV4dHJhRmllbGREYXRhKGZpZWxkLCBkYXRhLCB0\ncnVlKTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4g\naXNJbXBsRGF0YUNhY2hlYWJsZShpbnQgZmllbGQpIHsKICAgICAgICBpZiAo\nX2ZpZWxkSW1wbCA9PSBudWxsIHx8ICFfbG9hZGVkLmdldChmaWVsZCkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX21ldGEuZ2V0\nRmllbGQoZmllbGQpLnVzZXNJbXBsRGF0YSgpICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0\nRXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7CiAgICAgICAgcmV0dXJuIGlk\neCAhPSAtMSAmJiBfZmllbGRJbXBsW2lkeF0gIT0gbnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGdldEludGVybWVkaWF0ZShpbnQgZmllbGQpIHsK\nICAgICAgICByZXR1cm4gZ2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGZhbHNl\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcm1lZGlhdGUoaW50\nIGZpZWxkLCBPYmplY3QgZGF0YSkgewogICAgICAgIHNldEV4dHJhRmllbGRE\nYXRhKGZpZWxkLCBkYXRhLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGRhdGEgZnJvbSB0aGUgcHJvcGVyIGluZGV4IG9mIHRo\nZSBleHRyYSBmaWVsZCBkYXRhIGFycmF5LgogICAgICovCiAgICBwcml2YXRl\nIHN5bmNocm9uaXplZCBPYmplY3QgZ2V0RXh0cmFGaWVsZERhdGEoaW50IGZp\nZWxkLCBib29sZWFuIGlzTG9hZGVkKSB7CiAgICAgICAgLy8gb25seSByZXR1\ncm4gdGhlIGZpZWxkIGRhdGEgaWYgdGhlIGZpZWxkIGlzIGluIHRoZSByaWdo\ndCBsb2FkZWQKICAgICAgICAvLyBzdGF0ZTsgb3RoZXJ3aXNlIHdlIG1pZ2h0\nIHJldHVybiBpbnRlcm1lZGlhdGUgZm9yIGltcGwgZGF0YSBvcgogICAgICAg\nIC8vIHZpY2UgdmVyc2EKICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9PSBudWxs\nIHx8IF9sb2FkZWQuZ2V0KGZpZWxkKSAhPSBpc0xvYWRlZCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4\ndHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwogICAgICAgIHJldHVybiAoaWR4\nID09IC0xKSA/IG51bGwgOiBfZmllbGRJbXBsW2lkeF07CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGRhdGEgZnJvbSB0byBwcm9wZXIgaW5kZXgg\nb2YgdGhlIGV4dHJhIGZpZWxkIGRhdGEgYXJyYXkuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3luY2hyb25pemVkIE9iamVjdCBzZXRFeHRyYUZpZWxkRGF0YShp\nbnQgZmllbGQsIE9iamVjdCBkYXRhLAogICAgICAgIGJvb2xlYW4gbG9hZGVk\nKSB7CiAgICAgICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRh\nSW5kZXgoZmllbGQpOwogICAgICAgIGlmIChpZHggPT0gLTEpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVP\nZihfbWV0YS5nZXRGaWVsZAogICAgICAgICAgICAgICAgKGZpZWxkKSkpOwoK\nICAgICAgICBPYmplY3Qgb2xkID0gKF9maWVsZEltcGwgPT0gbnVsbCkgPyBu\ndWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgICAgIGlmIChkYXRhICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gY2Fubm90IHNldCBpZiBmaWVsZCBpbiB3\ncm9uZyBsb2FkZWQgc3RhdGUKICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0\nKGZpZWxkKSAhPSBsb2FkZWQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVlT2YoX21ldGEuZ2V0Rmll\nbGQKICAgICAgICAgICAgICAgICAgICAoZmllbGQpKSk7CgogICAgICAgICAg\nICAvLyBzZXQgZGF0YQogICAgICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1wbCA9IG5ldyBPYmplY3Rb\nX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgoKV07CiAgICAgICAgICAg\nIF9maWVsZEltcGxbaWR4XSA9IGRhdGE7CiAgICAgICAgfSBlbHNlIGlmIChf\nZmllbGRJbXBsICE9IG51bGwgJiYgX2xvYWRlZC5nZXQoZmllbGQpID09IGxv\nYWRlZCkKICAgICAgICAgICAgX2ZpZWxkSW1wbFtpZHhdID0gbnVsbDsKICAg\nICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0\nY2goaW50IGZpZWxkKSB7CiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoRmllbGQoaW50IGZpZWxkLCBi\nb29sZWFuIHRyYW5zaXRpb25zKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZCA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tZmllbGQiLAogICAgICAgICAgICAgICAgU3RyaW5nLnZh\nbHVlT2YoZmllbGQpLCBnZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRDbGFzcygp\nKSkuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdl\nZEluc3RhbmNlKCkpOwoKICAgICAgICAvLyBkbyBub3JtYWwgc3RhdGUgdHJh\nbnNpdGlvbnMKICAgICAgICBpZiAoIWZtZC5pc1ByaW1hcnlLZXkoKSAmJiB0\ncmFuc2l0aW9ucykKICAgICAgICAgICAgYWNjZXNzaW5nRmllbGQoZmllbGQp\nOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmllbGQoZmllbGQpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICByZXR1\ncm4gKGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkgPyBCb29sZWFuLlRSVUUK\nICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEJ5dGUoZmV0Y2hCeXRlRmllbGQoZmllbGQpKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgQ2hhcmFjdGVyKGZldGNoQ2hhckZpZWxkKGZpZWxkKSk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgRG91YmxlKGZldGNoRG91YmxlRmllbGQoZmllbGQpKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IEZsb2F0KGZldGNoRmxvYXRGaWVsZChmaWVsZCkp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZldGNoSW50RmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZmV0Y2hMb25nRmll\nbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KGZldGNoU2hvcnRG\naWVsZChmaWVsZCkpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZShpbnQgZmllbGQsIE9i\namVjdCB2YWwpIHsKICAgICAgICB2YWwgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCkuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgICAgIHN0b3Jl\nRmllbGQoZmllbGQsIHZhbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCB2YWwsIHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZmV0Y2hJbml0aWFsRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0gUmVzdG9y\nZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAoKF9mbGFncyAm\nIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgfHwgZm1kLmdldElu\ndmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlc3Rv\ncmUtdW5zZXQiKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRF\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgog\nICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgbm90IHNhdmluZyBtdXRhYmxl\nIHR5cGVzLCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICAgICAgICAgIGlm\nIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0ZS5S\nRVNUT1JFX0FMTAogICAgICAgICAgICAgICAgICAgICYmICgoX2ZsYWdzICYg\nRkxBR19JTlZFUlNFUykgPT0gMAogICAgICAgICAgICAgICAgICAgIHx8IGZt\nZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJtdXRhYmxlLXJl\nc3RvcmUtdW5zZXQiKSk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxsIHx8\nICFfbG9hZGVkLmdldChmaWVsZCkgfHwgIV9kaXJ0eS5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoRmllbGQoZmllbGQsIGZhbHNl\nKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBmaWVsZCBpcyBkaXJ0eSBidXQg\nd2UgbmV2ZXIgbG9hZGVkIGl0LCB3ZSBjYW4ndCByZXN0b3JlIGl0CiAgICAg\nICAgICAgIGlmIChfc2F2ZWQuZ2V0VW5sb2FkZWQoKS5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgiaW5pdGlhbC11bmxvYWRlZCIsCiAgICAgICAgICAgICAg\nICAgICAgZm1kKSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3NhdmVk\nLmdldFN0YXRlKCksIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0\ndXJuIGZldGNoRmllbGQoX3NpbmdsZSwgZm1kKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBGZXRjaCB0aGUgc3BlY2lmaWVkIGZpZWxkIGZyb20g\ndGhlIHNwZWNpZmllZCBmaWVsZCBtYW5hZ2VyLCB3cmFwcGluZyBpdAogICAg\nICogaW4gYW4gb2JqZWN0IGlmIGl0J3MgYSBwcmltaXRpdmUuIEEgZmllbGQg\nc2hvdWxkIGJlIHByb3ZpZGVkIHRvIHRoZQogICAgICogZmllbGQgbWFuYWdl\nciBiZWZvcmUgdGhpcyBjYWxsIGlzIG1hZGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIE9iamVjdCBmZXRjaEZpZWxkKEZpZWxkTWFuYWdlciBmbSwg\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpbnQgZmllbGQgPSBmbWQu\nZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVB\nTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZm0uZmV0Y2hCb29sZWFuRmll\nbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAg\nIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQllURToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZShmbS5mZXRj\naEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0ZXIo\nZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBE\nb3VibGUoZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCkpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgRmxvYXQoZm0uZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKSk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hJbnRGaWVsZChmaWVsZCkp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAg\nICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmbS5mZXRjaExvbmdGaWVs\nZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQoZm0uZmV0Y2hTaG9y\ndEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNU\nUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaFN0cmluZ0Zp\nZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVtb3RlKGludCBmaWVs\nZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBC\nb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAgICAgICAgIHN0b3JlRmllbGQo\nZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGly\ndHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9wZXJhdGlvbnMKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogTm90aWZpY2F0\naW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91dCB0byBiZSBhY2Nlc3NlZC4K\nICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZpZWxkIG51bWJlciBi\nZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBzaW5nbGUKICAgICAqIGZpZWxk\nIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZvcmVSZWFkKGludCBmaWVsZCkg\newogICAgICAgIC8vIGFsbG93IHVubWVkaWF0ZWQgcmVhZHMgb2YgcHJpbWFy\neSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZpZWxkICE9IC0xICYmIF9tZXRh\nLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tlci5pc0FjdGl2ZSgpICYmICFf\nYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmcoKSkgewogICAgICAgICAgICBp\nZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGljUmVhZCh0aGlzLCBm\naWVsZCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZXRQ\nQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAg\nICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5vbnRyYW5zYWN0aW9uYWxSZWFk\nKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmJlZm9yZU5vbnRy\nYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxkKSk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4KICAgICAgICAgICAgICAgIHNl\ndEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUu\nCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2JlZm9yZUZsdXNoCiAgICAg\nKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50IHJlYXNvbiwgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5iZWZvcmVGbHVzaCh0aGlzLCBy\nZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMLCBjYWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBz\ndGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZmx1c2gKICAgICAq\nLwogICAgdm9pZCBhZnRlckZsdXNoKGludCByZWFzb24pIHsKICAgICAgICAv\nLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBmbHVzaCBub24tcGVyc2lzdGVu\ndCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGlmIChyZWFzb24gIT0gQnJva2VySW1w\nbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAgICAmJiByZWFzb24gIT0gQnJv\na2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAgICAgIC8vIGFsbCBk\naXJ0eSBmaWVsZHMgd2VyZSBmbHVzaGVkCiAgICAgICAgICAgIF9mbHVzaC5v\ncihfZGlydHkpOwoKICAgICAgICAgICAgLy8gaW1wb3J0YW50IHRvIHNldCBm\nbHVzaGVkIGJpdCBhZnRlciBjYWxsaW5nIF9zdGF0ZS5mbHVzaCBzbwogICAg\nICAgICAgICAvLyB0aGF0IHRoZSBzdGF0ZSBjYW4gdGVsbCB3aGV0aGVyIHRo\naXMgaXMgdGhlIGZpcnN0IGZsdXNoCiAgICAgICAgICAgIHNldFBDU3RhdGUo\nX3N0YXRlLmZsdXNoKHRoaXMpKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfRkxVU0hFRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNI\nRURfRElSVFk7CgogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lP\nTl9DSEVDSzsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05f\nVVBEQVRFOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyB3YXMgYW4gaW5jIGZs\ndXNoIGR1cmluZyB3aGljaCB3ZSBoYWQgb3VyIGlkZW50aXR5CiAgICAgICAg\nICAgIC8vIGFzc2lnbmVkLCB0ZWxsIHRoZSBicm9rZXIgdG8gY2FjaGUgdXMg\ndW5kZXIgb3VyIGZpbmFsIG9pZAogICAgICAgICAgICBpZiAocmVhc29uID09\nIEJyb2tlckltcGwuRkxVU0hfSU5DKQogICAgICAgICAgICAgICAgYXNzZXJ0\nT2JqZWN0SWRBc3NpZ25lZCh0cnVlKTsKCiAgICAgICAgICAgIC8vIGlmIHRo\naXMgb2JqZWN0IHdhcyBzdG9yZWQgd2l0aCBwcmVGbHVzaCwgZG8gcG9zdC1z\ndG9yZSBjYWxsYmFjawogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nUFJFX0ZMVVNIRUQpID4gMCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3lj\nbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9TVE9SRSk7CiAgICAgICAg\nfSBlbHNlIGlmIChyZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9ST0xMQkFD\nSykgewogICAgICAgICAgICAvLyByZXZlcnQgdG8gbGFzdCBsb2FkZWQgdmVy\nc2lvbiBhbmQgb3JpZ2luYWwgb2lkCiAgICAgICAgICAgIF92ZXJzaW9uID0g\nX2xvYWRWZXJzaW9uOwogICAgICAgICAgICBpZiAoaXNOZXcoKSAmJiAoX2Zs\nYWdzICYgRkxBR19PSURfQVNTSUdORUQpID09IDApCiAgICAgICAgICAgICAg\nICBfb2lkID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX1BSRV9GTFVTSEVEOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdh\ndGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVyIGNoZWNraW5nIHRoZSB2\nYWx1ZQogICAgICogb2YgdGhlIFJldGFpblN0YXRlIGZsYWcuCiAgICAgKgog\nICAgICogQHNlZSBQQ1N0YXRlI2NvbW1pdAogICAgICogQHNlZSBQQ1N0YXRl\nI2NvbW1pdFJldGFpbgogICAgICovCiAgICB2b2lkIGNvbW1pdCgpIHsKICAg\nICAgICAvLyByZWxlYXNlIGxvY2tzIGJlZm9yZSBvaWQgdXBkYXRlZAogICAg\nICAgIHJlbGVhc2VMb2NrcygpOwoKICAgICAgICAvLyB1cGRhdGUgdmVyc2lv\nbiBhbmQgb2lkIGluZm9ybWF0aW9uCiAgICAgICAgc2V0VmVyc2lvbihfdmVy\nc2lvbik7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7CiAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CgogICAgICAgIE9i\namVjdCBvcmlnID0gX2lkOwogICAgICAgIGFzc2VydE9iamVjdElkQXNzaWdu\nZWQoZmFsc2UpOwoKICAgICAgICBib29sZWFuIHdhc05ldyA9IGlzTmV3KCkg\nJiYgIWlzRGVsZXRlZCgpICYmICFpc1Byb3Zpc2lvbmFsKCk7CiAgICAgICAg\naWYgKF9icm9rZXIuZ2V0UmV0YWluU3RhdGUoKSkKICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuY29tbWl0UmV0YWluKHRoaXMpKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmNvbW1pdCh0aGlz\nKSk7CgogICAgICAgIC8vIGFzayB0aGUgYnJva2VyIHRvIHJlLWNhY2hlIHVz\nIGlmIHdlIHdlcmUgbmV3IHByZXZpb3VzbHkKICAgICAgICBpZiAod2FzTmV3\nKQogICAgICAgICAgICBfYnJva2VyLnNldFN0YXRlTWFuYWdlcihvcmlnLCB0\naGlzLCBCcm9rZXJJbXBsLlNUQVRVU19DT01NSVRfTkVXKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZSBh\nZnRlciBjaGVja2luZyB0aGUgdmFsdWUKICAgICAqIG9mIHRoZSBSZXRhaW5T\ndGF0ZSBmbGFnLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNyb2xsYmFj\nawogICAgICogQHNlZSBQQ1N0YXRlI3JvbGxiYWNrUmVzdG9yZQogICAgICov\nCiAgICB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIC8vIHJlbGVhc2UgbG9j\na3MKICAgICAgICByZWxlYXNlTG9ja3MoKTsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hF\nRF9ESVJUWTsKICAgICAgICBhZnRlckZsdXNoKEJyb2tlckltcGwuRkxVU0hf\nUk9MTEJBQ0spOwoKICAgICAgICBpZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3Rh\ndGUoKSAhPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05FKQogICAgICAgICAg\nICBzZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFja1Jlc3RvcmUodGhpcykpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUucm9s\nbGJhY2sodGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICogUm9sbGJhY2sg\nc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5zdGFuY2UgdG8gdGhlIGdpdmVuIHNh\ndmVwb2ludC4KICAgICAqLwogICAgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50\nKFNhdmVwb2ludEZpZWxkTWFuYWdlciBzYXZlcG9pbnQpIHsKICAgICAgICBf\nc3RhdGUgPSBzYXZlcG9pbnQuZ2V0UENTdGF0ZSgpOwogICAgICAgIEJpdFNl\ndCBsb2FkZWQgPSBzYXZlcG9pbnQuZ2V0TG9hZGVkKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDAsIGxlbiA9IGxvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChsb2FkZWQuZ2V0KGkpICYmIHNhdmVw\nb2ludC5yZXN0b3JlRmllbGQoaSkpIHsKICAgICAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChzYXZlcG9pbnQuZ2V0Q29weSgpLCBzYXZlcG9pbnQsIGkpOwog\nICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgc2F2ZXBvaW50LCBp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfbG9hZGVkID0g\nbG9hZGVkOwogICAgICAgIF9kaXJ0eSA9IHNhdmVwb2ludC5nZXREaXJ0eSgp\nOwogICAgICAgIF9mbHVzaCA9IHNhdmVwb2ludC5nZXRGbHVzaGVkKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQg\nc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3BlcnNpc3QKICAg\nICAqIEBzZWUgQnJva2VyI3BlcnNpc3QKICAgICAqLwogICAgdm9pZCBwZXJz\naXN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnBlcnNpc3QodGhp\ncykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBj\ndXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNkZWxl\ndGUKICAgICAqIEBzZWUgQnJva2VyI2RlbGV0ZQogICAgICovCiAgICB2b2lk\nIGRlbGV0ZSgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5kZWxldGUo\ndGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRo\nZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNu\nb250cmFuc2FjdGlvbmFsCiAgICAgKiBAc2VlIEJyb2tlciNub250cmFuc2Fj\ndGlvbmFsCiAgICAgKi8KICAgIHZvaWQgbm9udHJhbnNhY3Rpb25hbCgpIHsK\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub250cmFuc2FjdGlvbmFsKHRo\naXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUg\nY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjdHJh\nbnNhY3Rpb25hbAogICAgICogQHNlZSBCcm9rZXIjdHJhbnNhY3Rpb25hbAog\nICAgICovCiAgICB2b2lkIHRyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUudHJhbnNhY3Rpb25hbCh0aGlzKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUu\nCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI25vbnByb3Zpc2lvbmFsCiAg\nICAgKi8KICAgIHZvaWQgbm9ucHJvdmlzaW9uYWwoYm9vbGVhbiBsb2dpY2Fs\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3Rh\ndGUubm9ucHJvdmlzaW9uYWwodGhpcywgbG9naWNhbCwgY2FsbCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0\nYXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNyZWxlYXNlCiAgICAg\nKiBAc2VlIEJyb2tlciNyZWxlYXNlCiAgICAgKi8KICAgIHZvaWQgcmVsZWFz\nZShib29sZWFuIHVucHJveHkpIHsKICAgICAgICByZWxlYXNlKHVucHJveHks\nIGZhbHNlKTsKICAgIH0KCiAgICB2b2lkIHJlbGVhc2UoYm9vbGVhbiB1bnBy\nb3h5LCBib29sZWFuIGZvcmNlKSB7CiAgICAgICAgLy8gb3B0aW1pemF0aW9u\nIGZvciBkZXRhY2gtaW4tcGxhY2Ugc3BlY2lhbCBjYXNlIHdoZW4gZmllbGRz\nIGFyZQogICAgICAgIC8vIGFscmVhZHkgKHVuKXByb3hpZWQgY29ycmVjdGx5\nCiAgICAgICAgaWYgKCF1bnByb3h5KQogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19OT19VTlBST1hZOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChmb3JjZSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoUENTdGF0ZS5U\nUkFOU0lFTlQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5yZWxlYXNlKHRoaXMpKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfTk9fVU5QUk9Y\nWTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMg\ndG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0\nYXRlI2V2aWN0CiAgICAgKiBAc2VlIEJyb2tlciNldmljdAogICAgICovCiAg\nICB2b2lkIGV2aWN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmV2\naWN0KHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlciByZWxh\ndGlvbnMgcmVhY2hhYmxlIGZyb20gdmFsdWVzIHVzaW5nCiAgICAgKiB7QGxp\nbmsgVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lNTUVESUFURX0uCiAgICAgKi8K\nICAgIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChm\nbWRzW2ldLmdldENhc2NhZGVSZWZyZXNoKCkgPT0gVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5n\nZXRLZXkoKS5nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAgICAgICAgICAgICA9\nPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAg\nICAgICB8fCBmbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlUmVmcmVz\naCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2Jq\nZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAg\nICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBiZWZvcmVSZWZy\nZXNoKGJvb2xlYW4gcmVmcmVzaEFsbCkgewogICAgICAgIC8vIG5vdGU6IGFs\nbCBsb2dpYyBwbGFjZWQgaGVyZSByYXRoZXIgdGhhbiBpbiB0aGUgc3RhdGVz\nIGZvcgogICAgICAgIC8vIG9wdGltaXphdGlvbjsgdGhpcyBtZXRob2QgcHVi\nbGljIGIvYyB1c2VkIGJ5IHJlbW90ZSBwYWNrYWdlCgogICAgICAgIC8vIG5v\ndGhpbmcgdG8gZG8gZm9yIG5vbiBwZXJzaXN0ZW50IG9yIG5ldyBpbnN0YW5j\nZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgpIHx8IGlzTmV3KCkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIGRpcnR5IG5lZWQgdG8gY2xl\nYXIgZmllbGRzCiAgICAgICAgICAgIGlmIChpc0RpcnR5KCkpIHsKICAgICAg\nICAgICAgICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgc29t\nZSBmaWVsZHMgaGF2ZSBiZWVuIGxvYWRlZCBidXQgdGhlIGluc3RhbmNlIGlz\nIG91dCBvZgogICAgICAgICAgICAvLyBkYXRlIG9yIHRoaXMgaXMgcGFydCBv\nZiBhIHJlZnJlc2hBbGwoKSBhbmQgd2UgZG9uJ3Qgd2FudCB0bwogICAgICAg\nICAgICAvLyB0YWtlIHRoZSBleHRyYSBoaXQgdG8gc2VlIGlmIHRoZSBpbnN0\nYW5jZSBpcyBvdXQgb2YgZGF0ZSwgY2xlYXIKICAgICAgICAgICAgaWYgKF9s\nb2FkZWQubGVuZ3RoKCkgPiAwICYmIChyZWZyZXNoQWxsIHx8IGlzRW1iZWRk\nZWQoKQogICAgICAgICAgICAgICAgfHwgIXN5bmNWZXJzaW9uKG51bGwpKSkg\newogICAgICAgICAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBfdmVyc2lvbjsK\nICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CgogICAgICAgICAgICAg\nICAgLy8gaWYgc3luY1ZlcnNpb24ganVzdCByZXBsYWNlZCB0aGUgdmVyc2lv\nbiwgcmVzZXQgaXQKICAgICAgICAgICAgICAgIGlmICghcmVmcmVzaEFsbCAm\nJiAhaXNFbWJlZGRlZCgpKQogICAgICAgICAgICAgICAgICAgIHNldFZlcnNp\nb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBzdGF0ZSB0cmFuc2l0aW9u\ncyBhZnRlciByZWZyZXNoLiBUaGlzIG1ldGhvZCBpcyBvbmx5CiAgICAgKiBj\nYWxsZWQgaWYge0BsaW5rICNiZWZvcmVSZWZyZXNofSByZXR1cm5zIHRydWUu\nCiAgICAgKi8KICAgIHZvaWQgYWZ0ZXJSZWZyZXNoKCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyB0cmFuc2l0aW9u\nIHRvIGNsZWFuIG9yIG5vbnRyYW5zYWN0aW9uYWwgZGVwZW5kaW5nIG9uIHRy\nYW5zIHN0YXR1cwogICAgICAgICAgICBpZiAoIV9icm9rZXIuaXNBY3RpdmUo\nKSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVyTm9u\ndHJhbnNhY3Rpb25hbFJlZnJlc2goKSk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuYWZ0ZXJPcHRpbWlzdGljUmVmcmVzaCgpKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3Rh\ndGUuYWZ0ZXJSZWZyZXNoKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIE1hcmsgdGhpcyBvYmplY3QgYXMgYSBkZXJlZmVyZW5jZWQgZGVwZW5k\nZW50IG9iamVjdC4KICAgICAqLwogICAgdm9pZCBzZXREZXJlZmVyZW5jZWRE\nZXBlbmRlbnQoYm9vbGVhbiBkZXJlZiwgYm9vbGVhbiBub3RpZnkpIHsKICAg\nICAgICBpZiAoIWRlcmVmICYmIChfZmxhZ3MgJiBGTEFHX0RFUkVGKSA+IDAp\nIHsKICAgICAgICAgICAgaWYgKG5vdGlmeSkKICAgICAgICAgICAgICAgIF9i\ncm9rZXIucmVtb3ZlRGVyZWZlcmVuY2VkRGVwZW5kZW50KHRoaXMpOwogICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVSRUY7CiAgICAgICAgfSBlbHNl\nIGlmIChkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19ERVJFRikgPT0gMCkgewog\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19ERVJFRjsKICAgICAgICAgICAg\naWYgKG5vdGlmeSkKICAgICAgICAgICAgICAgIF9icm9rZXIuYWRkRGVyZWZl\ncmVuY2VkRGVwZW5kZW50KHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nLy8vLy8vLy8vLwogICAgLy8gTG9ja2luZwogICAgLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHdlJ3ZlIGJlZW4gcmVh\nZC1sb2NrZWQuIFBhc3MgaW4gdGhlIGxldmVsIGF0IHdoaWNoCiAgICAgKiB3\nZSB3ZXJlIGxvY2tlZCBhbmQgdGhlIGxldmVsIGF0IHdoaWNoIHdlIHNob3Vs\nZCB3cml0ZSBsb2NrIG91cnNlbHZlcwogICAgICogb24gZGlydHkuCiAgICAg\nKi8KICAgIHZvaWQgcmVhZExvY2tlZChpbnQgcmVhZExvY2tMZXZlbCwgaW50\nIHdyaXRlTG9ja0xldmVsKSB7CiAgICAgICAgLy8gbWFrZSBzdXJlIG9iamVj\ndCBpcyBhZGRlZCB0byB0cmFuc2FjdGlvbiBzbyBsb2NrIHdpbGwgZ2V0CiAg\nICAgICAgLy8gY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sKICAgICAgICBp\nZiAocmVhZExvY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAg\nICAgICAgICAgdHJhbnNhY3Rpb25hbCgpOwoKICAgICAgICBfcmVhZExvY2tM\nZXZlbCA9IHJlYWRMb2NrTGV2ZWw7CiAgICAgICAgX3dyaXRlTG9ja0xldmVs\nID0gd3JpdGVMb2NrTGV2ZWw7CiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVB\nRF9MT0NLRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1dSSVRFX0xPQ0tF\nRDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbG9jayBsZXZl\nbCB0byB1c2Ugd2hlbiBsb2FkaW5nIHN0YXRlLgogICAgICovCiAgICBwcml2\nYXRlIGludCBjYWxjdWxhdGVMb2NrTGV2ZWwoYm9vbGVhbiBhY3RpdmUsIGJv\nb2xlYW4gZm9yV3JpdGUsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKSB7CiAgICAgICAgaWYgKCFhY3RpdmUpCiAgICAgICAgICAgIHJldHVy\nbiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKICAgICAgICBpZiAoZmV0Y2ggPT0g\nbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29u\nZmlndXJhdGlvbigpOwoKICAgICAgICBpZiAoX3JlYWRMb2NrTGV2ZWwgPT0g\nLTEpCiAgICAgICAgICAgIF9yZWFkTG9ja0xldmVsID0gZmV0Y2guZ2V0UmVh\nZExvY2tMZXZlbCgpOwogICAgICAgIGlmIChfd3JpdGVMb2NrTGV2ZWwgPT0g\nLTEpCiAgICAgICAgICAgIF93cml0ZUxvY2tMZXZlbCA9IGZldGNoLmdldFdy\naXRlTG9ja0xldmVsKCk7CiAgICAgICAgcmV0dXJuIChmb3JXcml0ZSkgPyBf\nd3JpdGVMb2NrTGV2ZWwgOiBfcmVhZExvY2tMZXZlbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIE1ha2Ugc3VyZSB3ZSdyZSBsb2NrZWQgYXQgdGhlIGdpdmVu\nIGxldmVsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgb2J0YWluTG9ja3Mo\nYm9vbGVhbiBhY3RpdmUsIGJvb2xlYW4gZm9yV3JpdGUsIGludCBsb2NrTGV2\nZWwsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3Qg\nc2RhdGEpIHsKICAgICAgICBpZiAoIWFjdGl2ZSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAvLyBpZiB3ZSBoYXZlbid0IGJlZW4gbG9ja2VkIHll\ndCwgbG9jayBub3cgYXQgdGhlIGdpdmVuIGxldmVsCiAgICAgICAgaW50IGZs\nYWcgPSAoZm9yV3JpdGUpID8gRkxBR19XUklURV9MT0NLRUQgOiBGTEFHX1JF\nQURfTE9DS0VEOwogICAgICAgIGlmICgoX2ZsYWdzICYgZmxhZykgPT0gMCkg\newogICAgICAgICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0IGlzIGFkZGVkIHRv\nIHRyYW5zYWN0aW9uIHNvIGxvY2sgd2lsbCBnZXQKICAgICAgICAgICAgLy8g\nY2xlYXJlZCBvbiBjb21taXQvcm9sbGJhY2sKICAgICAgICAgICAgaWYgKGxv\nY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAgICAgICAg\nICAgIHRyYW5zYWN0aW9uYWwoKTsKCiAgICAgICAgICAgIGlmIChmZXRjaCA9\nPSBudWxsKQogICAgICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBfYnJva2VyLmdldExv\nY2tNYW5hZ2VyKCkubG9jayh0aGlzLCBsb2NrTGV2ZWwsCiAgICAgICAgICAg\nICAgICBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBzZGF0YSk7CiAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX1JFQURfTE9DS0VEOwogICAgICAgICAgICBf\nZmxhZ3MgfD0gZmxhZzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWxlYXNlIGxvY2tzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVs\nZWFzZUxvY2tzKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxsKQogICAg\nICAgICAgICBfYnJva2VyLmdldExvY2tNYW5hZ2VyKCkucmVsZWFzZSh0aGlz\nKTsKICAgICAgICBfcmVhZExvY2tMZXZlbCA9IC0xOwogICAgICAgIF93cml0\nZUxvY2tMZXZlbCA9IC0xOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19SRUFE\nX0xPQ0tFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfV1JJVEVfTE9DS0VE\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBvZiBTdGF0ZU1h\nbmFnZXIgaW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFuIHNlcmlh\nbGl6aW5nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfbWV0\nYS5pc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgIHJldHVybiBEZXRh\nY2hNYW5hZ2VyLnByZVNlcmlhbGl6ZSh0aGlzKTsKCiAgICAgICAgICAgIGxv\nYWQoX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwgTE9BRF9TRVJJ\nQUxJWkUsIG51bGwsIG51bGwsIAogICAgICAgICAgICAgICAgZmFsc2UpOwog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xh\ndGUocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiB3\ncml0ZURldGFjaGVkKE9iamVjdE91dHB1dCBvdXQpCiAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBCaXRTZXQgaWR4cyA9IG5ldyBCaXRT\nZXQoX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoKTsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiBkZXRzbSA9IERl\ndGFjaE1hbmFnZXIud3JpdGVEZXRhY2hlZFN0YXRlKHRoaXMsIG91dCwgaWR4\ncyk7CiAgICAgICAgICAgIGlmIChkZXRzbSkKICAgICAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0RFVEFDSElORzsKCiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKGZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgX3Np\nbmdsZS5zZXJpYWxpemUob3V0LCAhaWR4cy5nZXQoaSkpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfREVUQUNISU5HOwogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcHJveHlEZXRhY2hlZERlc2VyaWFs\naXplZChpbnQgaWR4KSB7CiAgICAgICAgLy8gd2UgZG9uJ3Qgc2VyaWFsaXpl\nIHN0YXRlIG1hbmFnZXIgaW1wbHMKICAgICAgICB0aHJvdyBuZXcgSW50ZXJu\nYWxFeGNlcHRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1Ry\nYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciBU\nQ0xFQU4sIHdoaWNoIHdlIHdhbnQgdG8gYXBwZWFyIG5vbi10cmFucyB0bwog\nICAgICAgIC8vIGludGVybmFsIGNvZGUsIGJ1dCB3aGljaCBwdWJsaWNseSBz\naG91bGQgYmUgdHJhbnNhY3Rpb25hbAogICAgICAgIHJldHVybiBfc3RhdGUg\nPT0gUENTdGF0ZS5UQ0xFQU4gfHwgX3N0YXRlLmlzVHJhbnNhY3Rpb25hbCgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUGVuZGluZ1RyYW5zYWN0\naW9uYWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1BlbmRpbmdUcmFu\nc2FjdGlvbmFsKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQcm92\naXNpb25hbCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzUHJvdmlzaW9u\nYWwoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlcnNpc3RlbnQo\nKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1BlcnNpc3RlbnQoKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc05ldygpIHsKICAgICAgICByZXR1\ncm4gX3N0YXRlLmlzTmV3KCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNEZWxldGVkKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNEZWxldGVk\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAg\nICAgICByZXR1cm4gX3N0YXRlLmlzRGlydHkoKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0RldGFjaGVkKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgRkxBR19ERVRBQ0hJTkcpICE9IDA7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRHZW5lcmljQ29udGV4dCgpIHsKICAgICAgICByZXR1cm4g\nX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoT2JqZWN0\nSWQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzaWduT2JqZWN0\nSWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChfb2lkID09IG51bGwgfHwgIV9i\ncm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAgZ2V0\nQ29tcGF0aWJpbGl0eUluc3RhbmNlKCkuZ2V0Q29weU9iamVjdElkcygpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIF9vaWQ7CgogICAgICAgICAgICBpZiAo\nX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9E\nQVRBU1RPUkUpCiAgICAgICAgICAgICAgICByZXR1cm4gX2Jyb2tlci5nZXRT\ndG9yZU1hbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQoX29pZCwgX21ldGEpOwog\nICAgICAgICAgICByZXR1cm4gQXBwbGljYXRpb25JZHMuY29weShfb2lkLCBf\nbWV0YSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFBDUHJpbWFyeUtleShPYmpl\nY3Qgb2lkLCBpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBPYmplY3QgcGsg\nPSBBcHBsaWNhdGlvbklkcy5nZXQob2lkLCBmbWQpOwogICAgICAgIGlmIChw\nayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSByZWxtZXRhID0gZm1kLmdldERlY2xhcmVkVHlwZU1l\ndGFEYXRhKCk7CiAgICAgICAgaWYgKHJlbG1ldGEuZ2V0SWRlbnRpdHlUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUKICAgICAgICAgICAg\nJiYgZm1kLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpID09IEphdmFUeXBl\ncy5MT05HKQogICAgICAgICAgICBwayA9IF9icm9rZXIuZ2V0U3RvcmVNYW5h\nZ2VyKCkubmV3RGF0YVN0b3JlSWQocGssIHJlbG1ldGEpOwogICAgICAgIGVs\nc2UgaWYgKHJlbG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9BUFBMSUNBVElPTiAKICAgICAgICAgICAgJiYgZm1kLmdldE9i\namVjdElkRmllbGRUeXBlKCkgIT0gcmVsbWV0YS5nZXRPYmplY3RJZFR5cGUo\nKSkKICAgICAgICAgICAgcGsgPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1\nZXMobmV3IE9iamVjdFtdIHsgcGsgfSwgcmVsbWV0YSk7CiAgICAgICAgcmV0\ndXJuIF9icm9rZXIuZmluZChwaywgZmFsc2UsIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyBieXRlIHJlcGxhY2VGbGFncygpIHsKICAgICAgICAvLyB3ZSBh\nbHdheXMgdXNlIGxvYWQgcmVxdWlyZWQgc28gdGhhdCB3ZSBjYW4gZGV0ZWN0\nIHdoZW4gb2JqZWN0cwogICAgICAgIC8vIGFyZSB0b3VjaGVkIGZvciBsb2Nr\naW5nIG9yIG1ha2luZyB0cmFuc2FjdGlvbmFsCiAgICAgICAgcmV0dXJuIFBl\ncnNpc3RlbmNlQ2FwYWJsZS5MT0FEX1JFUVVJUkVEOwogICAgfQoKICAgIHB1\nYmxpYyBTdGF0ZU1hbmFnZXIgcmVwbGFjZVN0YXRlTWFuYWdlcihTdGF0ZU1h\nbmFnZXIgc20pIHsKICAgICAgICByZXR1cm4gc207CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYWNjZXNzaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nLy8gcG9zc2libHkgY2hhbmdlIHN0YXRlCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYmVmb3JlUmVhZChmaWVsZCk7CiAgICAgICAgICAgIGJlZm9yZUFj\nY2Vzc0ZpZWxkKGZpZWxkKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2\nZW4gZmllbGQgYmVmb3JlIGFjY2Vzcy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgYmVmb3JlQWNjZXNzRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gYWN0\naXZlID0gX2Jyb2tlci5pc0FjdGl2ZSgpOwogICAgICAgICAgICBpbnQgbG9j\na0xldmVsID0gY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgZmFsc2UsIG51\nbGwpOwogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAg\nICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgbG9ja0xldmVsLCBmYWxz\nZSwgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFz\nc2lnbkZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgICAgIG9idGFpbkxv\nY2tzKGFjdGl2ZSwgZmFsc2UsIGxvY2tMZXZlbCwgbnVsbCwgbnVsbCk7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBkaXJ0eShTdHJpbmcgZmllbGQpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZShuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tZmllbGQiLCBmaWVs\nZCwKICAgICAgICAgICAgICAgIF9wYy5nZXRDbGFzcygpKSkuc2V0RmFpbGVk\nT2JqZWN0KGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7CgogICAgICAgIGRpcnR5\nKGZtZC5nZXRJbmRleCgpLCBudWxsLCB0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBkaXJ0eShpbnQgZmllbGQpIHsKICAgICAgICBkaXJ0eShmaWVs\nZCwgbnVsbCwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHRo\nZSBnaXZlbiBmaWVsZCBkaXJ0eS4KICAgICAqCiAgICAgKiBAcGFyYW0gbXV0\nYXRlIGlmIG51bGwsIG1heSBiZSBhbiBTQ08gbXV0YXRpb247IGlmIHRydWUs\nIGlzIGNlcnRhaW5seQogICAgICogYSBtdXRhdGlvbiAob3IgYXQgbGVhc3Qg\ndHJlYXQgYXMgb25lKQogICAgICogQHJldHVybiB7QGxpbmsgQm9vbGVhbiNG\nQUxTRX0gaWYgdGhpcyBpbnN0YW5jZSB3YXMgYWxyZWFkeSBkaXJ0eSwKICAg\nICAqIDxjb2RlPm51bGw8L2NvZGU+IGlmIGl0IHdhcyBkaXJ0eSBidXQgbm90\nIHNpbmNlIGZsdXNoLCBhbmQKICAgICAqIHtAbGluayBCb29sZWFuI1RSVUV9\nIGlmIGl0IHdhcyBub3QgZGlydHkKICAgICAqLwogICAgcHJpdmF0ZSBCb29s\nZWFuIGRpcnR5KGludCBmaWVsZCwgQm9vbGVhbiBtdXRhdGUsIGJvb2xlYW4g\nbG9hZEZldGNoR3JvdXApIHsKICAgICAgICBib29sZWFuIGxvY2tlZCA9IGZh\nbHNlOwogICAgICAgIGJvb2xlYW4gbmV3Rmx1c2ggPSBmYWxzZTsKICAgICAg\nICBib29sZWFuIGNsZWFuID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgIGlmICghaXNOZXcoKSB8fCBpc0ZsdXNoZWQoKSkg\newogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRVcGRhdGVTdHJhdGVneSgp\nID09IFVwZGF0ZVN0cmF0ZWdpZXMuUkVTVFJJQ1QpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgICAgICAgICAoInVwZGF0ZS1yZXN0cmljdCIs\nIGZtZCkpOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRVcGRhdGVTdHJh\ndGVneSgpID09IFVwZGF0ZVN0cmF0ZWdpZXMuSUdOT1JFKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAoaXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAg\nICAgICAvLyBub3RpZnkgb3duZXIgb2YgY2hhbmdlCiAgICAgICAgICAgICAg\nICBfb3duZXIuZGlydHkoX293bmVyTWV0YS5nZXRGaWVsZE1ldGFEYXRhKCku\nZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICBCb29sZWFuLlRSVUUs\nIGxvYWRGZXRjaEdyb3VwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaXMgdGhpcyBhIGRpcmVjdCBtdXRhdGlvbiBvZiBhbiBzY28gZmllbGQ/\nCiAgICAgICAgICAgIGlmIChtdXRhdGUgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoK\nICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAg\nICAgICAgICAgIG11dGF0ZSA9IEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZSA9\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZm1kLmlzRW1iZWRkZWQo\nKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFu\nLkZBTFNFOyAvLyBub3Qgc2NvCiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIHBvc3NpYmx5IGNoYW5nZSBzdGF0ZQog\nICAgICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9rZXIuaXNBY3RpdmUo\nKTsKICAgICAgICAgICAgY2xlYW4gPSAhX3N0YXRlLmlzRGlydHkoKTsgLy8g\naW50ZW50aW9uYWwgZGlyZWN0IGFjY2VzcwoKICAgICAgICAgICAgLy8gZmly\nZSBldmVudCBmYXN0IGJlZm9yZSBzdGF0ZSBjaGFuZ2UuCiAgICAgICAgICAg\nIGlmIChjbGVhbikKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVu\ndChMaWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFkpOwogICAgICAgICAgICBp\nZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgICBpZiAoX2Jyb2tlci5nZXRP\ncHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICAgICAgc2V0UENTdGF0ZShf\nc3RhdGUuYmVmb3JlT3B0aW1pc3RpY1dyaXRlKHRoaXMsIGZpZWxkLAogICAg\nICAgICAgICAgICAgICAgICAgICBtdXRhdGUuYm9vbGVhblZhbHVlKCkpKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRQ\nQ1N0YXRlKF9zdGF0ZS5iZWZvcmVXcml0ZSh0aGlzLCBmaWVsZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgpKSk7CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBG\naWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKSB7CiAgICAgICAgICAg\nICAgICBpZiAoaXNQZXJzaXN0ZW50KCkgJiYgIV9icm9rZXIuZ2V0Tm9udHJh\nbnNhY3Rpb25hbFdyaXRlKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAg\nICAgICAgICAgICAgICAoIm5vbi10cmFucy13cml0ZSIpKS5zZXRGYWlsZWRP\nYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgKGdldE1hbmFnZWRJbnN0\nYW5jZSgpKTsKCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5i\nZWZvcmVOb250cmFuc2FjdGlvbmFsV3JpdGUodGhpcywgZmllbGQsCiAgICAg\nICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgpKSk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19GTFVT\nSEVEKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBuZXdGbHVzaCA9IChfZmxh\nZ3MgJiBGTEFHX0ZMVVNIRURfRElSVFkpID09IDA7CiAgICAgICAgICAgICAg\nICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEX0RJUlRZOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBsb2NrKCk7CiAgICAgICAgICAgIGxvY2tlZCA9IHRy\ndWU7CgogICAgICAgICAgICAvLyBub3RlIHRoYXQgdGhlIGZpZWxkIGlzIGlu\nIG5lZWQgb2YgZmx1c2hpbmcgYWdhaW4sIGFuZCB0ZWxsIHRoZQogICAgICAg\nICAgICAvLyBicm9rZXIgdG9vCiAgICAgICAgICAgIF9mbHVzaC5jbGVhcihm\naWVsZCk7CiAgICAgICAgICAgIF9icm9rZXIuc2V0RGlydHkodGhpcywgbmV3\nRmx1c2ggJiYgIWNsZWFuKTsKCiAgICAgICAgICAgIC8vIHNhdmUgdGhlIGZp\nZWxkIGZvciByb2xsYmFjayBpZiBuZWVkZWQKICAgICAgICAgICAgc2F2ZUZp\nZWxkKGZpZWxkKTsKCiAgICAgICAgICAgIC8vIGRpcnR5IHRoZSBmaWVsZCBh\nbmQgbWFyayBsb2FkZWQ7IGxvYWQgZmV0Y2ggZ3JvdXAgaWYgbmVlZGVkCiAg\nICAgICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2ZWwo\nYWN0aXZlLCB0cnVlLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFfZGlydHku\nZ2V0KGZpZWxkKSkgewogICAgICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxk\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kaXJ0eS5zZXQoZmllbGQpOwoK\nICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgZmllbGQncyBmZXRj\naCBncm91cCBpcyBsb2FkZWQKICAgICAgICAgICAgICAgIGlmIChsb2FkRmV0\nY2hHcm91cCAmJiBpc1BlcnNpc3RlbnQoKQogICAgICAgICAgICAgICAgICAg\nICYmIGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kLk1BTkFHRV9QRVJTSVNU\nRU5UKQogICAgICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgbG9j\na0xldmVsLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBvYnRhaW5Mb2NrcyhhY3RpdmUsIHRydWUsIGxvY2tMZXZlbCwgbnVsbCwg\nbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsb2NrZWQpCiAgICAgICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CgogICAgICAgIGlmIChjbGVhbikK\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICBpZiAo\nbmV3Rmx1c2gpIHsKICAgICAgICAgICAgLy8gdGhpcyBldmVudCBjYW4gYmUg\nZmlyZWQgbGF0ZXIgY2F1c2Ugd2UncmUgYWxyZWFkeSBkaXJ0eS4KICAgICAg\nICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9S\nRV9ESVJUWV9GTFVTSEVEKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgfQoK\nICAgIC8qKgogICAgICogRmlyZSBwb3N0LWRpcnR5IGV2ZW50cyBhZnRlciBm\naWVsZCB2YWx1ZSBjaGFuZ2VzLgogICAgICoKICAgICAqIEBwYXJhbSBzdGF0\ndXMgcmV0dXJuIHZhbHVlIGZyb20ge0BsaW5rICNkaXJ0eShpbnQsYm9vbGVh\nbixib29sZWFuKX0KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBvc3REaXJ0\neShCb29sZWFuIHN0YXR1cykgewogICAgICAgIGlmIChCb29sZWFuLlRSVUUu\nZXF1YWxzKHN0YXR1cykpCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVu\ndChMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJUWSk7CiAgICAgICAgZWxzZSBp\nZiAoc3RhdHVzID09IG51bGwpCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVF\ndmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJUWV9GTFVTSEVEKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVkKGludCBmaWVsZCwgT2JqZWN0\nIHJlbW92ZWQsIGJvb2xlYW4ga2V5KSB7CiAgICAgICAgaWYgKHJlbW92ZWQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyBkZXJlZmVyZW5jZSBkZXBlbmRlbnQgZmllbGRzLCBk\nZWxldGUgZW1iZWRkZWQKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIFZhbHVlTWV0\nYURhdGEgdm1kID0gKGtleSkgPyBmbWQuZ2V0S2V5KCkgOiBmbWQuZ2V0RWxl\nbWVudCgpOwogICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWRQQygpKQog\nICAgICAgICAgICAgICAgX3NpbmdsZS5kZWxldGUodm1kLCByZW1vdmVkLCBu\ndWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAodm1kLmdldENhc2NhZGVEZWxl\ndGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTykKICAgICAgICAg\nICAgICAgIF9zaW5nbGUuZGVyZWZlcmVuY2VEZXBlbmRlbnQocmVtb3ZlZCk7\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAg\nICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IG5ld1Byb3h5KGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBuZXdGaWVsZFByb3h5KGZpZWxkKTsKCiAgICAgICAgc3dp\ndGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSA9PSBqYXZhLnNxbC5EYXRlLmNsYXNzKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgamF2YS5zcWwuRGF0ZShTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdl\ndERlY2xhcmVkVHlwZSgpID09IGphdmEuc3FsLlRpbWVzdGFtcC5jbGFzcykK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGphdmEuc3FsLlRpbWVz\ndGFtcChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAgICAg\nICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3FsLlRp\nbWUuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqYXZh\nLnNxbC5UaW1lKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVybiBD\nYWxlbmRhci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgbmV3RmllbGRQcm94eShpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBQ\ncm94eU1hbmFnZXIgbWdyID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCku\nCiAgICAgICAgICAgIGdldFByb3h5TWFuYWdlckluc3RhbmNlKCk7CiAgICAg\nICAgT2JqZWN0IGluaXQgPSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKTsKCiAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbWdyLm5ld0RhdGVQcm94eShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiBtZ3IubmV3Q2FsZW5kYXJQcm94eShmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgaW5pdCBpbnN0\nYW5jZW9mIFRpbWVab25lID8gKFRpbWVab25lKSBpbml0IDogbnVsbCk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgICAgICByZXR1cm4gbWdyLm5ld0NvbGxlY3Rpb25Qcm94eShmbWQuZ2V0\nUHJveHlUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgZm1kLmdldEVsZW1l\nbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBp\nbml0IGluc3RhbmNlb2YgQ29tcGFyYXRvciA/IChDb21wYXJhdG9yKSBpbml0\nIDogbnVsbCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3TWFwUHJveHkoZm1kLmdldFBy\nb3h5VHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5n\nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0\nRWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAg\nICAgIGluaXQgaW5zdGFuY2VvZiBDb21wYXJhdG9yID8gKENvbXBhcmF0b3Ip\nIGluaXQgOiBudWxsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEZWZhdWx0VmFsdWUoaW50\nIGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgcHJvdmlkZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBib29sZWFu\nIHJldCA9IF9zaW5nbGUuaXNEZWZhdWx0VmFsdWUoKTsKICAgICAgICAgICAg\nX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICByZXR1cm4gcmV0OwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlY29yZCB0aGF0\nIHRoZSBmaWVsZCBpcyBkaXJ0eSAod2hpY2ggbWlnaHQgbG9hZCBERkcpCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nQm9vbGVh\nbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAg\nICAgIGJvb2xlYW4gY3VyVmFsLCBib29sZWFuIG5ld1ZhbCwgaW50IHNldCkg\newogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAg\nICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkp\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5v\nUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0\nID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNF\nUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVCb29sZWFuRmllbGQoZmll\nbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdCeXRlRmllbGQo\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgYnl0\nZSBjdXJWYWwsIGJ5dGUgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYg\nKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwg\nPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hh\nbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVs\nZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAg\nICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAg\nICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAg\nICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0dGluZ0NoYXJGaWVsZChQZXJzaXN0ZW5jZUNhcGFi\nbGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFyIGN1clZhbCwgY2hhciBu\nZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1P\nVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAg\nICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNF\nLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3Jl\nQ2hhckZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNl\nRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERp\ncnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0\naW5nRG91YmxlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQsCiAgICAgICAgZG91YmxlIGN1clZhbCwgZG91YmxlIG5ld1ZhbCwgaW50\nIHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAg\nICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVh\nbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBT\nRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVEb3VibGVGaWVs\nZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0Zsb2F0\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAg\nICAgZmxvYXQgY3VyVmFsLCBmbG9hdCBuZXdWYWwsIGludCBzZXQpIHsKICAg\nICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYg\nKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1h\ncnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRp\ncnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgbmV3\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0ludEZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGludCBjdXJWYWws\nIGludCBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNF\nVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwg\nJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQp\nOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFu\nLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlSW50RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBw\nb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldHRpbmdMb25nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgbG9uZyBjdXJWYWwsIGxvbmcgbmV3VmFsLCBpbnQg\nc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAg\nICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZp\nZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNz\nZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFu\nIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNF\nVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUxvbmdGaWVsZChm\naWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ09iamVjdEZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIE9iamVjdCBjdXJWYWwsIE9iamVjdCBuZXdWYWwsIGludCBzZXQpIHsKICAg\nICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyBvbmx5IGNvbXBhcmUgbmV3\nIHRvIG9sZCB2YWx1ZXMgaWYgdGhlIGNvbXBhcmlzb24gaXMgZ29pbmcgdG8K\nICAgICAgICAgICAgICAgIC8vIGJlIGNoZWFwIC0tIGRvbid0IGNvbXBhcmUg\nY29sbGVjdGlvbnMsIG1hcHMsIFVEVHMKICAgICAgICAgICAgICAgIHN3aXRj\naCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgIT0gbnVsbCAmJiBuZXdWYWwu\nZXF1YWxzKGN1clZhbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgZGVwZW5kZW50IHVu\nbG9hZGVkIGZpZWxkLCBtYWtlIHN1cmUgdG8gbG9hZAogICAgICAgICAgICAg\nICAgLy8gaXQgbm93CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldENhc2Nh\nZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTwogICAg\nICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRLZXkoKS5nZXRDYXNjYWRlRGVs\nZXRlKCkKICAgICAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNB\nU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRFbGVt\nZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAgICAgICAgICAg\nPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pCiAgICAgICAgICAgICAg\nICAgICAgY3VyVmFsID0gZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5n\nZShmaWVsZCk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAgICAgICAgICAgICBhc3Nl\ncnROb3RNYW5hZ2VkT2JqZWN0SWQobmV3VmFsKTsKICAgICAgICB9CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFu\nIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNF\nVF9VU0VSKTsKICAgICAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7\nCiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnVucHJveHko\nKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVyZWZlcmVuY2VEZXBlbmRl\nbnQoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQo\nZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdTaG9ydEZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIHNob3J0IGN1clZhbCwgc2hvcnQgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAg\nICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChu\nZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5\nS2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0\neShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAg\nICAgICAgICAgX3NpbmdsZS5zdG9yZVNob3J0RmllbGQoZmllbGQsIG5ld1Zh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdTdHJpbmdGaWVsZChQZXJzaXN0\nZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBTdHJpbmcgY3Vy\nVmFsLCBTdHJpbmcgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNl\ndCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5lcXVhbHMobmV3VmFsLCBjdXJWYWwpICYmIF9sb2FkZWQuZ2V0KGZpZWxk\nKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0\nTm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0\nYXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9V\nU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVN0cmluZ0ZpZWxkKGZp\nZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9z\naW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERpc2FsbG93cyBjaGFuZ2lu\nZyBwcmltYXJ5IGtleSBmaWVsZHMgZm9yIGluc3RhbmNlcy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShpbnQg\nZmllbGQpIHsKICAgICAgICBpZiAoX29pZCAhPSBudWxsICYmIF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgdGhy\nb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICgiY2hhbmdlLWlkZW50aXR5IikpLnNldEZh\naWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogRGlzYWxsb3dzIHNldHRpbmcgYW4gb2JqZWN0IGlkIGZp\nZWxkIHRvIGEgbWFuYWdlZCBpbnN0YW5jZS4KICAgICAqLwogICAgdm9pZCBh\nc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQoT2JqZWN0IHZhbCkgewogICAgICAg\nIGlmICh2YWwgIT0gbnVsbAogICAgICAgICAgICAmJiAoKFBlcnNpc3RlbmNl\nQ2FwYWJsZSkgdmFsKS5wY0dldEdlbmVyaWNDb250ZXh0KCkgIT0gbnVsbCkK\nICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgibWFuYWdlZC1v\naWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKHZhbCksCiAgICAgICAgICAgICAg\nICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhnZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSkpKS4KICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSkpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIERlbGVnYXRlIHRvIEZpZWxkTWFuYWdlcgog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2\nb2lkIHByb3ZpZGVkQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gY3VyVmFsKSB7CiAgICAg\nICAgX2ZtLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkQnl0ZUZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGJ5dGUgY3VyVmFs\nKSB7CiAgICAgICAgX2ZtLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkQ2hhckZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGNoYXIg\nY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBj\ndXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkRG91Ymxl\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAg\nICAgZG91YmxlIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZURvdWJsZUZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBy\nb3ZpZGVkRmxvYXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBmbG9hdCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3Rv\ncmVGbG9hdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHByb3ZpZGVkSW50RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nLCBpbnQgZmllbGQsCiAgICAgICAgaW50IGN1clZhbCkgewogICAgICAgIF9m\nbS5zdG9yZUludEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHByb3ZpZGVkTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIGxvbmcgY3VyVmFsKSB7CiAgICAg\nICAgX2ZtLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkT2JqZWN0RmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgT2JqZWN0IGN1clZh\nbCkgewogICAgICAgIF9mbS5zdG9yZU9iamVjdEZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkU2hvcnRGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBz\naG9ydCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVTaG9ydEZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVk\nU3RyaW5nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQs\nCiAgICAgICAgU3RyaW5nIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZVN0\ncmluZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIHJlcGxhY2VCb29sZWFuRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoQm9v\nbGVhbkZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0ZSByZXBs\nYWNlQnl0ZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEJ5dGVGaWVsZChmaWVsZCk7\nCiAgICB9CgogICAgcHVibGljIGNoYXIgcmVwbGFjZUNoYXJGaWVsZChQZXJz\naXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVy\nbiBfZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1Ymxp\nYyBkb3VibGUgcmVwbGFjZURvdWJsZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaERv\ndWJsZUZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgZmxvYXQgcmVw\nbGFjZUZsb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoRmxvYXRGaWVsZChmaWVs\nZCk7CiAgICB9CgogICAgcHVibGljIGludCByZXBsYWNlSW50RmllbGQoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1\ncm4gX2ZtLmZldGNoSW50RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1Ymxp\nYyBsb25nIHJlcGxhY2VMb25nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoTG9uZ0Zp\nZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHJlcGxhY2VP\nYmplY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkg\newogICAgICAgIHJldHVybiBfZm0uZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7\nCiAgICB9CgogICAgcHVibGljIHNob3J0IHJlcGxhY2VTaG9ydEZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0\ndXJuIF9mbS5mZXRjaFNob3J0RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1\nYmxpYyBTdHJpbmcgcmVwbGFjZVN0cmluZ0ZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRj\naFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRhdGlvbiBv\nZiBGaWVsZE1hbmFnZXIKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW4oaW50\nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQm9vbGVhbkZpZWxkKGZp\nZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQs\nIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChCb29sZWFuKSBmbWQuZ2V0RXh0\nZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5ib29sZWFuVmFsdWUoKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW5GaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAg\nICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxz\nZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRj\naEJvb2xlYW5GaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBieXRlIGZldGNoQnl0ZShpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4g\nZmV0Y2hCeXRlRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0g\nZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51\nbWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkuYnl0\nZVZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgZmV0Y2hCeXRlRmll\nbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9O\nRSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChf\ncGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5n\nbGUuZmV0Y2hCeXRlRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgY2hhciBmZXRjaENoYXIoaW50IGZpZWxkKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZldGNoQ2hhckZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZh\nbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4g\nKChDaGFyYWN0ZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tl\ncikpLmNoYXJWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBjaGFyIGZldGNo\nQ2hhckZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkK\nICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5M\nT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRl\nRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVy\nbiBfc2luZ2xlLmZldGNoQ2hhckZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGRvdWJsZSBmZXRjaERvdWJsZShpbnQgZmllbGQpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICByZXR1cm4gZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CgogICAg\nICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAg\nICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2\nYWwsIF9icm9rZXIpKS5kb3VibGVWYWx1ZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBkb3VibGUgZmV0Y2hEb3VibGVGaWVsZChpbnQgZmllbGQpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmll\nbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaERvdWJsZUZpZWxkKGZp\nZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZsb2F0IGZldGNoRmxv\nYXQoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoRmxvYXRGaWVs\nZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZp\nZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0\nRXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5mbG9hdFZhbHVlKCk7CiAg\nICB9CgogICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXRGaWVsZChpbnQgZmll\nbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBs\nb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwg\nZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3Npbmds\nZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEZs\nb2F0RmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50\nIGZldGNoSW50KGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1k\nLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaElu\ndEZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmludFZhbHVlKCk7\nCiAgICB9CgogICAgcHVibGljIGludCBmZXRjaEludEZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxv\nYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBm\nYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xl\nLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoSW50\nRmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgbG9uZyBm\nZXRjaExvbmcoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQu\naXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoTG9u\nZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmxvbmdWYWx1ZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGZldGNoTG9uZ0ZpZWxkKGludCBm\naWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAg\nIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNl\nLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2lu\nZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNo\nTG9uZ0ZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBmZXRjaE9iamVjdChpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4g\nZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwg\nPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBmZXRjaE9iamVjdEZpZWxkKGludCBmaWVsZCkgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVs\nZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7\nCgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoT2JqZWN0Rmll\nbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc2hvcnQgZmV0\nY2hTaG9ydChpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5p\nc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hTaG9y\ndEZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmll\nbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZt\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLnNob3J0VmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgc2hvcnQgZmV0Y2hTaG9ydEZpZWxkKGlu\ndCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAg\nICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZh\nbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZl\ndGNoU2hvcnRGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZmV0Y2hTdHJpbmcoaW50IGZpZWxkKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZldGNoU3RyaW5nRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3Qg\ndmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiAoU3RyaW5nKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIp\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZmV0Y2hTdHJpbmdGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAg\nICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBm\nYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5m\nZXRjaFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RvcmVCb29sZWFuKGludCBmaWVsZCwgYm9vbGVhbiBleHRl\ncm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxp\nemVkKCkpCiAgICAgICAgICAgIHN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBl\neHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIE9iamVj\ndCB2YWwgPSAoZXh0ZXJuYWxWYWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRTsKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdl\ndEZpZWxkVmFsdWUodmFsLCBfYnJva2VyKSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlQm9vbGVhbkZpZWxkKGludCBmaWVsZCwg\nYm9vbGVhbiBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJvb2xlYW5GaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRy\ndWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQnl0ZShpbnQgZmllbGQs\nIGJ5dGUgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5p\nc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUJ5dGVGaWVsZChm\naWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IEJ5dGUo\nZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQnl0ZUZpZWxkKGludCBmaWVsZCwg\nYnl0ZSBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhcihpbnQgZmllbGQsIGNoYXIg\nZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9t\nZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVy\nbmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUNoYXJGaWVsZChmaWVsZCwg\nZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVG\naWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IENoYXJhY3Rlcihl\neHRlcm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVDaGFyRmllbGQoaW50IGZpZWxkLCBj\naGFyIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBjdXJW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVEb3VibGUoaW50IGZpZWxkLCBkb3Vi\nbGUgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4\ndGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZURvdWJsZUZpZWxkKGZp\nZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgRG91Ymxl\nKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxkKGludCBmaWVs\nZCwgZG91YmxlIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlRG91YmxlRmllbGQoZmll\nbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9z\naW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0\ncnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUZsb2F0KGludCBmaWVs\nZCwgZmxvYXQgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUZsb2F0Rmll\nbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBG\nbG9hdChleHRlcm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVGbG9hdEZpZWxkKGludCBm\naWVsZCwgZmxvYXQgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVGbG9hdEZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwg\ndHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVJbnQoaW50IGZpZWxk\nLCBpbnQgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5p\nc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUludEZpZWxkKGZp\nZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\ndG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShOdW1iZXJzLnZh\nbHVlT2YoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50RmllbGQoaW50IGZp\nZWxkLCBpbnQgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVJbnRGaWVsZChmaWVsZCwg\nY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3Npbmds\nZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUp\nOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZyhpbnQgZmllbGQsIGxv\nbmcgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4\ndGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUxvbmdGaWVsZChmaWVs\nZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Rv\ncmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoTnVtYmVycy52YWx1\nZU9mKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUxvbmdGaWVsZChpbnQgZmll\nbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVMb25nRmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5n\nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVl\nKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdChpbnQgZmllbGQs\nIE9iamVjdCBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGV4dGVybmFs\nVmFsID0gZm1kLm9yZGVyKGV4dGVybmFsVmFsKTsKICAgICAgICBpZiAoIWZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZU9iamVjdEZp\nZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShleHRl\ncm5hbFZhbCwgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3VyVmFsKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5n\nbGUuc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAg\nICAgX3NpbmdsZS5wcm94eSh0cnVlLCBmYWxzZSk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\nc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQo\nZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZVNob3J0KGludCBmaWVsZCwgc2hvcnQgZXh0ZXJuYWxWYWwpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICBzdG9yZVNob3J0RmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5n\nZXRGaWVsZFZhbHVlKG5ldyBTaG9ydChleHRlcm5hbFZhbCksCiAgICAgICAg\nICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVTaG9ydEZpZWxkKGludCBmaWVsZCwgc2hvcnQgY3VyVmFsKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVTdHJpbmcoaW50IGZpZWxkLCBTdHJpbmcgZXh0ZXJuYWxWYWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICBzdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBm\nbWQuZ2V0RmllbGRWYWx1ZShleHRlcm5hbFZhbCwgX2Jyb2tlcikpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nRmllbGQoaW50IGZpZWxk\nLCBTdHJpbmcgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTdHJpbmdGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRy\ndWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIGdpdmVuIGZpZWxk\nIHZhbHVlIGludG8gdGhlIGdpdmVuIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBzdG9yZUZpZWxkKGludCBmaWVsZCwgT2JqZWN0\nIHZhbCwgRmllbGRNYW5hZ2VyIGZtKSB7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tZmllbGQtaW5kZXgiLAogICAgICAgICAgICAgICAg\nU3RyaW5nLnZhbHVlT2YoZmllbGQpLCBfbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpKS4KICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICAgICAgYm9vbGVhbiBib29sID0gdmFsICE9\nIG51bGwgJiYgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpOwogICAg\nICAgICAgICAgICAgZm0uc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGJvb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBieXRlIGIgPSAodmFsID09\nIG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgZm0uc3RvcmVCeXRlRmllbGQoZmllbGQsIGIpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVI6CiAgICAgICAgICAgICAgICBjaGFyIGMgPSAodmFsID09IG51bGwp\nID8gMCA6ICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgZm0uc3RvcmVDaGFyRmllbGQoZmllbGQsIGMpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRP\nVUJMRToKICAgICAgICAgICAgICAgIGRvdWJsZSBkID0gKHZhbCA9PSBudWxs\nKSA/IDAgOiAoKE51bWJlcikgdmFsKS5kb3VibGVWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRkxPQVQ6CiAgICAgICAgICAgICAgICBmbG9hdCBmID0gKHZhbCA9PSBudWxs\nKSA/IDAgOiAoKE51bWJlcikgdmFsKS5mbG9hdFZhbHVlKCk7CiAgICAgICAg\nICAgICAgICBmbS5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGYpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgICAgIGludCBpID0gKHZhbCA9PSBudWxsKSA/IDAg\nOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpOwogICAgICAgICAgICAgICAg\nZm0uc3RvcmVJbnRGaWVsZChmaWVsZCwgaSk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIGxvbmcgbCA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1i\nZXIpIHZhbCkubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9y\nZUxvbmdGaWVsZChmaWVsZCwgbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nICAgICBzaG9ydCBzID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikg\ndmFsKS5zaG9ydFZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZVNo\nb3J0RmllbGQoZmllbGQsIHMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAg\nICAgIGZtLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIChTdHJpbmcpIHZhbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIGZtLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIHZh\nbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8KICAgIC8v\nIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nRXJhc2UgdGhlIGZhY3QgdGhhdCB0aGlzIGluc3RhbmNlIGhhcyBiZWVuIGZs\ndXNoZWQuCiAgICAgKi8KICAgIHZvaWQgZXJhc2VGbHVzaCgpIHsKICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgaW50IGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKS5sZW5ndGg7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzOyBpKyspCiAgICAgICAgICAgIF9mbHVzaC5jbGVhcihpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZHMgdGhhdCBhbGwgaW5zdGFu\nY2UgZmllbGRzIGFyZS9hcmUgbm90IGxvYWRlZC4KICAgICAqIFByaW1hcnkg\na2V5IGFuZCBub24tcGVyc2lzdGVudCBmaWVsZHMgYXJlIG5vdCBhZmZlY3Rl\nZC4KICAgICAqLwogICAgdm9pZCBzZXRMb2FkZWQoYm9vbGVhbiB2YWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxk\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5\nKCkKICAgICAgICAgICAgICAgICYmIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgp\nID09IGZtZHNbaV0uTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAg\nICBzZXRMb2FkZWQoaSwgdmFsKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF2\nYWwpIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0xPQURFRDsKICAg\nICAgICAgICAgc2V0RGlydHkoZmFsc2UpOwogICAgICAgIH0gZWxzZQogICAg\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWNvcmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxkcyBhcmUv\nYXJlIG5vdCBkaXJ0eSwKICAgICAqIGFuZCBjaGFuZ2VzIHRoZSBmbGFncyBv\nZiB0aGUgaW5zdGFuY2UgYWNjb3JkaW5nbHkuCiAgICAgKi8KICAgIHZvaWQg\nc2V0RGlydHkoYm9vbGVhbiB2YWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGJvb2xlYW4g\ndXBkYXRlID0gIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmICh2YWwgJiYgKCF1cGRhdGUKICAgICAgICAgICAgICAgIHx8IGZt\nZHNbaV0uZ2V0VXBkYXRlU3RyYXRlZ3koKSAhPSBVcGRhdGVTdHJhdGVnaWVz\nLklHTk9SRSkpCiAgICAgICAgICAgICAgICBfZGlydHkuc2V0KGkpOwogICAg\nICAgICAgICBlbHNlIGlmICghdmFsKSB7CiAgICAgICAgICAgICAgICAvLyB3\nZSBuZXZlciBjb25zaWRlciBjbGVhbiBmaWVsZHMgZmx1c2hlZDsgdGhpcyBh\nbHNvIHRha2VzCiAgICAgICAgICAgICAgICAvLyBjYXJlIG9mIGNsZWFyaW5n\nIHRoZSBmbHVzaGVkIGZpZWxkcyBvbiBjb21taXQvcm9sbGJhY2sKICAgICAg\nICAgICAgICAgIF9mbHVzaC5jbGVhcihpKTsKICAgICAgICAgICAgICAgIF9k\naXJ0eS5jbGVhcihpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BREVE\nOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZXMgcHJlLWNsZWFyIGNh\nbGxiYWNrcywgY2xlYXJzIGFsbCBtYW5hZ2VkIGZpZWxkcywgYW5kIGNhbGxz\nIHRoZQogICAgICoge0BsaW5rICNzZXRMb2FkZWR9IG1ldGhvZCB3aXRoIGEg\ndmFsdWUgb2YgZmFsc2UuIFByaW1hcnkga2V5IGZpZWxkcwogICAgICogYXJl\nIG5vdCBjbGVhcmVkLgogICAgICovCiAgICB2b2lkIGNsZWFyRmllbGRzKCkg\newogICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5C\nRUZPUkVfQ0xFQVIpOwoKICAgICAgICAvLyB1bnByb3h5IGFsbCBmaWVsZHMK\nICAgICAgICB1bnByb3h5RmllbGRzKCk7CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBjbGVhciBub24tcGsgZmllbGRz\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKCFmbWRzW2ld\nLmlzUHJpbWFyeUtleSgpICYmIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpCiAg\nICAgICAgICAgICAgICAgICAgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVS\nU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3Bj\nLCBDbGVhckZpZWxkTWFuYWdlci5nZXRJbnN0YW5jZSgpLCBpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gZm9yZ2V0IHZlcnNpb24gaW5mbyBh\nbmQgaW1wbCBkYXRhIHNvIHdlIHJlLXJlYWQgbmV4dCB0aW1lCiAgICAgICAg\nICAgIHNldExvYWRlZChmYWxzZSk7CiAgICAgICAgICAgIF92ZXJzaW9uID0g\nbnVsbDsKICAgICAgICAgICAgX2xvYWRWZXJzaW9uID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKF9maWVsZEltcGwgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIEFycmF5cy5maWxsKF9maWVsZEltcGwsIG51bGwpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KCiAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0NM\nRUFSKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCB0aGF0IHdlIHNo\nb3VsZCBzYXZlIGFueSBmaWVsZHMgdGhhdCBjaGFuZ2UgZnJvbSB0aGlzIHBv\naW50CiAgICAgKiBmb3J3YXJkLgogICAgICovCiAgICB2b2lkIHNhdmVGaWVs\nZHMoYm9vbGVhbiBpbW1lZGlhdGUpIHsKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRSZXN0b3JlU3RhdGUoKSA9PSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9OT05F\nCiAgICAgICAgICAgICYmIChfZmxhZ3MgJiBGTEFHX0lOVkVSU0VTKSA9PSAw\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIF9mbGFncyB8PSBGTEFH\nX1NBVkU7CiAgICAgICAgaWYgKGltbWVkaWF0ZSkgewogICAgICAgICAgICBm\nb3IgKGludCBpID0gMCwgbGVuID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxl\nbjsgaSsrKQogICAgICAgICAgICAgICAgc2F2ZUZpZWxkKGkpOwogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfU0FWRTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJZiB0aGUgZmllbGQgaXNuJ3QgYWxyZWFkeSBzYXZl\nZCwgc2F2ZXMgdGhlIGN1cnJlbnRseSBsb2FkZWQgZmllbGQKICAgICAqIHN0\nYXRlIG9mIHRoZSBpbnN0YW5jZS4gVGhlIHNhdmVkIHZhbHVlcyBjYW4gYWxs\nIGJlIHJlc3RvcmVkIHZpYQogICAgICoge0BsaW5rICNyZXN0b3JlRmllbGRz\nfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNhdmVGaWVsZChpbnQgZmll\nbGQpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU0FWRSkgPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEg\nbWFuYWdlZCBpbnZlcnNlIGZpZWxkLCBsb2FkIGl0IHNvIHdlJ3JlIHN1cmUg\ndG8gaGF2ZQogICAgICAgIC8vIHRoZSBvcmlnaW5hbCB2YWx1ZQogICAgICAg\nIGlmICghX2xvYWRlZC5nZXQoZmllbGQpICYmICgoX2ZsYWdzICYgRkxBR19J\nTlZFUlNFUykgIT0gMAogICAgICAgICAgICAmJiBfbWV0YS5nZXRGaWVsZChm\naWVsZCkuZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0aCA+IDApKQogICAg\nICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05F\nLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAvLyBkb24ndCBib3RoZXIgY3Jl\nYXRpbmcgdGhlIHNhdmUgZmllbGQgbWFuYWdlciBpZiB3ZSdyZSBub3QgZ29p\nbmcgdG8KICAgICAgICAvLyBzYXZlIHRoZSBvbGQgZmllbGQgdmFsdWUgYW55\nd2F5CiAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBfc2F2\nZWQgPSBuZXcgU2F2ZUZpZWxkTWFuYWdlcih0aGlzLCBudWxsLCBfZGlydHkp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICAvLyBjb3B5IHRoZSBmaWVsZCB0byBzYXZlIGZp\nZWxkIG1hbmFnZXI7IGlmIHRoZSBmaWVsZCBpcyBub3QgZGlyZWN0bHkKICAg\nICAgICAvLyBjb3B5YWJsZSwgaW1tZWRpYXRlbHkgcHJvdmlkZSBhbmQgcmVw\nbGFjZSBpdCB2aWEgdGhlIHNhdmUgZmllbGQKICAgICAgICAvLyBtYW5hZ2Vy\nLCB3aGljaCB3aWxsIGNvcHkgdGhlIG11dGFibGUgdmFsdWUgdG8gcHJldmVu\ndCBieS1yZWYgbW9kcwogICAgICAgIGlmIChfc2F2ZWQuc2F2ZUZpZWxkKGZp\nZWxkKSkgewogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2F2ZWQs\nIGZpZWxkKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9zYXZlZC5nZXRT\ndGF0ZSgpLCBfc2F2ZWQsIGZpZWxkKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgc3RhdGUgd2lsbCBu\nb3QgbmVlZCB0byBiZSByb2xsZWQgYmFjawogICAgICogdG8gdGhhdCBvZiB0\naGUgbGFzdCBjYWxsIHRvIHtAbGluayAjc2F2ZUZpZWxkc30uCiAgICAgKi8K\nICAgIHZvaWQgY2xlYXJTYXZlZEZpZWxkcygpIHsKICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfU0FWRTsKICAgICAgICBfc2F2ZWQgPSBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUm9sbGJhY2sgdGhlIHN0YXRlIG9mIHRoZSBpbnN0\nYW5jZSB0byB0aGUgc2F2ZWQgc3RhdGUgZnJvbSB0aGUKICAgICAqIGxhc3Qg\nY2FsbCB0byB7QGxpbmsgI3NhdmVGaWVsZHN9LCBvciB0byBkZWZhdWx0IHZh\nbHVlcyBpZiBuZXZlciBzYXZlZC4KICAgICAqLwogICAgdm9pZCByZXN0b3Jl\nRmllbGRzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoX3NhdmVkID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmICgoX2ZsYWdzICYgRkxBR19TQVZFKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAgICAgICAgICBlbHNlIC8v\nIG9ubHkgdW5sb2FkZWQgZmllbGRzIHdlcmUgZGlydGllZAogICAgICAgICAg\nICAgICAgICAgIF9sb2FkZWQuYW5kTm90KF9sb2FkZWQpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIC8vIHdlIGRpcmVjdCBzdGF0ZSB0cmFuc2l0aW9u\ncyBiYXNlZCBvbiBvdXIgb3duIGdldFJlc3RvcmVTdGF0ZQogICAgICAgICAg\nICAvLyBtZXRob2QsIGJ1dCB0byBkZWNpZGUgd2hldGhlciB0byBhY3R1YWxs\neSByb2xsYmFjayBmaWVsZAogICAgICAgICAgICAvLyB2YWx1ZXMsIHdlIGNv\nbnN1bHQgdGhlIGJyb2tlciBmb3IgdGhlIHVzZXIncyBzZXR0aW5nCiAgICAg\nICAgICAgIGVsc2UgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgIT0g\nUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORSkgewogICAgICAgICAgICAgICAg\nLy8gcm9sbGJhY2sgYWxsIGN1cnJlbnRseS1sb2FkZWQgZmllbGRzCiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gX2xvYWRlZC5sZW5n\ndGgoKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChf\nbG9hZGVkLmdldChpKSAmJiBfc2F2ZWQucmVzdG9yZUZpZWxkKGkpKQogICAg\nICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2F2ZWQs\nIGkpOwoKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIGxvYWRlZCBzZXQK\nICAgICAgICAgICAgICAgIF9sb2FkZWQuYW5kTm90KF9zYXZlZC5nZXRVbmxv\nYWRlZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmVwbGFjZXMgYWxsIHNlY29uZCBjbGFzcyBvYmpl\nY3QgZmllbGRzIHdpdGggZnJlc2ggcHJveGllZCBpbnN0YW5jZXMKICAgICAq\nIGNvbnRhaW5pbmcgdGhlIHNhbWUgaW5mb3JtYXRpb24gYXMgdGhlIG9yaWdp\nbmFscy4KICAgICAqLwogICAgdm9pZCBwcm94eUZpZWxkcyhib29sZWFuIHJl\nc2V0LCBib29sZWFuIHJlcGxhY2VOdWxsKSB7CiAgICAgICAgLy8gd2Ugb25s\neSByZXBsYWNlIG51bGxzIGlmIHRoZSBydW50aW1lIGNhbid0IGRpZmZlcmVu\ndGlhdGUgYmV0d2VlbgogICAgICAgIC8vIG51bGwgYW5kIGVtcHR5IGNvbnRh\naW5lcnMuICB3ZSByZXBsYWNlIG51bGxzIGluIHRoaXMgY2FzZSB0bwogICAg\nICAgIC8vIG1haW50YWluIGNvbnNpc3RlbmN5IHdoZXRoZXIgdmFsdWVzIGFy\nZSBiZWluZyByZXRhaW5lZCBvciBub3QKICAgICAgICBpZiAocmVwbGFjZU51\nbGwpCiAgICAgICAgICAgIHJlcGxhY2VOdWxsID0gIV9icm9rZXIuZ2V0Q29u\nZmlndXJhdGlvbigpLnN1cHBvcnRlZE9wdGlvbnMoKS4KICAgICAgICAgICAg\nICAgIGNvbnRhaW5zKE9wZW5KUEFDb25maWd1cmF0aW9uLk9QVElPTl9OVUxM\nX0NPTlRBSU5FUik7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gX2xvYWRlZC5sZW5n\ndGgoKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoX2xv\nYWRlZC5nZXQoaSkpIHsKICAgICAgICAgICAgICAgICAgICBwcm92aWRlRmll\nbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nX3NpbmdsZS5wcm94eShyZXNldCwgcmVwbGFjZU51bGwpKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVucHJveHkg\nYWxsIGZpZWxkcy4KICAgICAqLwogICAgdm9pZCB1bnByb3h5RmllbGRzKCkg\newogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19OT19VTlBST1hZKSAhPSAw\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gX2xv\nYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUudW5wcm94eSgpOwogICAgICAgICAgICAgICAgX3Npbmds\nZS5yZWxlYXNlRW1iZWRkZWQoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\nY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2V0IHJlYWR5IGZvciBhIGZsdXNoLiBQZXJzaXN0\ncyBhbGwgcGVyc2lzdGVuY2UtY2FwYWJsZSBvYmplY3QgZmllbGRzLAogICAg\nICogYW5kIGNoZWNrcyBmb3IgaWxsZWdhbCBudWxsIHZhbHVlcy4gQWxzbyBh\nc3NpZ25zIG9pZHMgYW5kIGZpZWxkIHZhbHVlcwogICAgICogZm9yIGFsbCBz\ndHJhdGVnaWVzIHRoYXQgZG9uJ3QgcmVxdWlyZSBmbHVzaGluZy4KICAgICAq\nLwogICAgdm9pZCBwcmVGbHVzaChib29sZWFuIGxvZ2ljYWwsIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFX0ZM\nVVNIRUQpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYg\nKGlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVF\ndmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfU1RPUkUpOwogICAgICAgICAg\nICBfZmxhZ3MgfD0gRkxBR19QUkVfRkxVU0hFRDsKICAgICAgICB9CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIWxv\nZ2ljYWwpCiAgICAgICAgICAgICAgICBhc3NpZ25PYmplY3RJZChmYWxzZSwg\ndHJ1ZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbWV0\nYS5nZXRGaWVsZHMoKS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAg\nICAgICAgICAgaWYgKChsb2dpY2FsIHx8ICFhc3NpZ25GaWVsZChpLCB0cnVl\nKSkgJiYgIV9mbHVzaC5nZXQoaSkKICAgICAgICAgICAgICAgICAgICAmJiBf\nZGlydHkuZ2V0KGkpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZUZp\nZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9zaW5nbGUucHJlRmx1c2gobG9naWNhbCwgY2FsbCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAg\nICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBjYWxs\nYmFja3MgZm9yIGRlbGV0aW9uLgogICAgICovCiAgICB2b2lkIHByZURlbGV0\nZSgpIHsKICAgICAgICAvLyBzZXQgYSBmbGFnIHdoaWxlIGNhbGwgcHJlIGRl\nbGV0ZSBjYWxsYmFjayBzbyB0aGF0IHVzZXIgY2FuJ3QKICAgICAgICAvLyBn\nZXQgaW50byBpbmZpbml0ZSByZWN1cnNpb24gYnkgY2FsbGluZyBkZWxldGUo\ndGhpcykKICAgICAgICAvLyB3aXRoaW4gaGlzIGNhbGxiYWNrIG1ldGhvZAog\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVfREVMRVRJTkcpID09IDAp\nIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0RFTEVUSU5HOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNs\nZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwogICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5G\nTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENhc2NhZGUgZGVsZXRlcyBhbmQgZGVyZWZl\ncmVuY2UgZGVwZW5kZW50IGZpZWxkcy4KICAgICAqLwogICAgdm9pZCBjYXNj\nYWRlRGVsZXRlKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRlRGVsZXRlKCkgIT0gVmFsdWVN\nZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAgICAgICAgICAgIHx8IGZtZHNb\naV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAgICAg\nICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORQogICAgICAgICAgICAg\nICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgp\nCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9O\nRSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVjdEZpZWxk\nKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIF9z\naW5nbGUuZGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5j\nbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQ2FsbGVkIGFmdGVyIGFuIGluc3RhbmNlIGlzIHBlcnNpc3Rl\nZCBieSBhIHVzZXIgdGhyb3VnaCB0aGUgYnJva2VyLgogICAgICogQ2FzY2Fk\nZXMgdGhlIHBlcnNpc3Qgb3BlcmF0aW9uIHRvIGZpZWxkcyBtYXJrZWQKICAg\nICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NBU0NBREVfSU1NRURJQVRFfS4K\nICAgICAqLwogICAgdm9pZCBjYXNjYWRlUGVyc2lzdChPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5n\nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChp\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgaWYg\nKGZtZHNbaV0uZ2V0Q2FzY2FkZVBlcnNpc3QoKSA9PSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ld\nLmdldEtleSgpLmdldENhc2NhZGVQZXJzaXN0KCkKICAgICAgICAgICAgICAg\nID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUKICAgICAgICAg\nICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVQZXJz\naXN0KCkKICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FE\nRV9JTU1FRElBVEUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVP\nYmplY3RGaWVsZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7CiAgICAgICAg\nICAgICAgICBfc2luZ2xlLnBlcnNpc3QoY2FsbCk7CiAgICAgICAgICAgICAg\nICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBmaWVsZCBzZXQg\nZnJvbSB0aGUgZGF0YSBzdG9yZSBpbnRvIHRoZSBpbnN0YW5jZS4KICAgICAq\nIFJldHVybiB0cnVlIGlmIGFueSBkYXRhIGlzIGxvYWRlZCwgZmFsc2Ugb3Ro\nZXJ3aXNlLgogICAgICovCiAgICBib29sZWFuIGxvYWRGaWVsZHMoQml0U2V0\nIGZpZWxkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9ja0xl\ndmVsLAogICAgICAgIE9iamVjdCBzZGF0YSwgYm9vbGVhbiBmb3JXcml0ZSkg\newogICAgICAgIC8vIGNhbid0IGxvYWQgdmVyc2lvbiBmaWVsZCBmcm9tIHN0\nb3JlCiAgICAgICAgaWYgKGZpZWxkcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGEgdmZpZWxkID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxk\nKCk7CiAgICAgICAgICAgIGlmICh2ZmllbGQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGZpZWxkcy5jbGVhcih2ZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAg\nICAgfQoKICAgICAgICBib29sZWFuIHJldCA9IGZhbHNlOwogICAgICAgIHNl\ndExvYWRpbmcodHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g\naWYgYW55IGZpZWxkcyBnaXZlbiwgbG9hZCB0aGVtCiAgICAgICAgICAgIGlu\ndCBsZW4gPSAoZmllbGRzID09IG51bGwpID8gMCA6IGZpZWxkcy5sZW5ndGgo\nKTsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgICAg\nIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZldGNo\nID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAg\nICAgICAgIGlmICghX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5sb2FkKHRo\naXMsIGZpZWxkcywgZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAgbG9ja0xl\ndmVsLCBzZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQoImRlbC1pbnN0YW5j\nZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwgX29pZCkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHZlcnNpb24gaW5mb3Jt\nYXRpb24gaGFzIGJlZW4gc2V0OyB2ZXJzaW9uIGluZm8gbXVzdAogICAgICAg\nICAgICAvLyBhbHdheXMgYmUgc2V0IGFmdGVyIHRoZSBmaXJzdCBzdGF0ZSBs\nb2FkIG9yIHNldCAod2hpY2ggaXMgd2h5CiAgICAgICAgICAgIC8vIHdlIGRv\nIHRoaXMgZXZlbiBpZiBubyBmaWVsZHMgd2VyZSBsb2FkZWQgLS0gY291bGQg\nYmUgdGhhdCB0aGlzCiAgICAgICAgICAgIC8vIG1ldGhvZCBpcyBiZWluZyBj\nYWxsZWQgYWZ0ZXIgYSBmaWVsZCBpcyBzZXQpLi4uIHNvbWUgaW5zdGFuY2Vz\nCiAgICAgICAgICAgIC8vIG1pZ2h0IG5vdCBoYXZlIHZlcnNpb24gaW5mbywg\naW4gd2hpY2ggY2FzZSB0aGlzIGdldHMgY2FsbGVkCiAgICAgICAgICAgIC8v\nIG11dGlwbGUgdGltZXM7IHRoYXQgc2hvdWxkIGJlIG9rIHRvbwogICAgICAg\nICAgICBpZiAoX2xvYWRWZXJzaW9uID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIHN5bmNWZXJzaW9uKHNkYXRhKTsKICAgICAgICAgICAgICAgIHJldCA9\nIHJldCB8fCBfbG9hZFZlcnNpb24gIT0gbnVsbDsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgc2V0TG9h\nZGluZyhmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZWUgaWYgdGhl\nIGRmZyBpcyBub3cgbG9hZGVkOyBkbyB0aGlzIHJlZ2FyZGxlc3Mgb2Ygd2hl\ndGhlciB3ZQogICAgICAgIC8vIGxvYWRlZCBhbnkgZmllbGRzLCBjYXVzZSBt\nYXkgYWxyZWFkeSBoYXZlIGJlZW4gbG9hZGVkIGJ5CiAgICAgICAgLy8gU3Rv\ncmVNYW5hZ2VyIGR1cmluZyBpbml0aWFsaXphdGlvbgogICAgICAgIHBvc3RM\nb2FkKC0xLCBmZXRjaCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAg\nICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkJ3MgZmV0Y2ggZ3Jv\ndXA7IHRoZSBmaWVsZCBpdHNlbGYgbWF5IGFscmVhZHkgYmUKICAgICAqIGxv\nYWRlZCBpZiBpdCBpcyBiZWluZyBzZXQgYnkgdGhlIHVzZXIuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGxvYWRGaWVsZChpbnQgZmllbGQsIGludCBs\nb2NrTGV2ZWwsIGJvb2xlYW4gZm9yV3JpdGUsCiAgICAgICAgYm9vbGVhbiBm\nZ3MpIHsKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBfYnJv\na2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIEJp\ndFNldCBmaWVsZHMgPSBudWxsOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEg\nZGZnIGZpZWxkIG9yIHdlIG5lZWQgdG8gbG9hZCBvdXIgZGZnLCBkbyBzbwog\nICAgICAgIGlmIChmZ3MgJiYgKF9mbGFncyAmIEZMQUdfTE9BREVEKSA9PSAw\nKQogICAgICAgICAgICBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZl\ndGNoLCBMT0FEX0ZHUywgbnVsbCk7CiAgICAgICAgCiAgICAgICAgLy8gY2hl\nY2sgZm9yIGxvYWQgZmV0Y2ggZ3JvdXAKICAgICAgICBTdHJpbmcgbGZnID0g\nZm1kLmdldExvYWRGZXRjaEdyb3VwKCk7CiAgICAgICAgYm9vbGVhbiBsZmdB\nZGRlZCA9IGZhbHNlOwogICAgICAgIGlmIChsZmcgIT0gbnVsbCkgeyAgCiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdl\ndChpKSAmJiAoaSA9PSBmaWVsZAogICAgICAgICAgICAgICAgICAgIHx8IGZt\nZHNbaV0uaXNJbkZldGNoR3JvdXAobGZnKSkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZpZWxkcyA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgICAgIGZpZWxkcy5zZXQoaSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlbGF0aW9uIGZpZWxk\nIGlzIGxvYWRlZCB3aXRoIHRoZSBsb2FkLWZldGNoLWdyb3VwCiAgICAgICAg\nICAgIC8vIGJ1dCB0aGlzIGFkZGl0aW9uIG11c3QgYmUgcmV2ZXJ0ZWQgb25j\nZSB0aGUgbG9hZCBpcyBvdmVyCiAgICAgICAgICAgIGlmICghZmV0Y2guaGFz\nRmV0Y2hHcm91cChsZmcpKSB7CiAgICAgICAgICAgICAgICBmZXRjaC5hZGRG\nZXRjaEdyb3VwKGxmZyk7CiAgICAgICAgICAgICAgICBsZmdBZGRlZCA9IHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGZtZC5pc0lu\nRGVmYXVsdEZldGNoR3JvdXAoKSAmJiBmaWVsZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBubyBsb2FkIGdyb3VwIGJ1dCBkZmc6IGFkZCBkZmcgZmll\nbGRzIGlmIHdlIGhhdmVuJ3QgYWxyZWFkeQogICAgICAgICAgICBmaWVsZHMg\nPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7\nCiAgICAgICAgfSBlbHNlIGlmICghX2xvYWRlZC5nZXQoZm1kLmdldEluZGV4\nKCkpKSB7CiAgICAgICAgICAgIC8vIG5vIGxvYWQgZ3JvdXAgb3IgZGZnOiBs\nb2FkIGluZGl2aWR1YWwgZmllbGQKICAgICAgICAgICAgaWYgKGZpZWxkcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJpdFNldCgp\nOwogICAgICAgICAgICBmaWVsZHMuc2V0KGZtZC5nZXRJbmRleCgpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGNhbGwgdGhpcyBtZXRob2QgZXZlbiBpZiB0\naGVyZSBhcmUgbm8gdW5sb2FkZWQgZmllbGRzOyBsb2FkRmllbGRzCiAgICAg\nICAgLy8gdGFrZXMgY2FyZSBvZiB0aGluZ3MgbGlrZSBsb2FkaW5nIHZlcnNp\nb24gaW5mbyBhbmQgc2V0dGluZyBQQyBmbGFncwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGxvYWRGaWVsZHMoZmllbGRzLCBmZXRjaCwgbG9ja0xldmVs\nLCBudWxsLCBmb3JXcml0ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgaWYgKGxmZ0FkZGVkKQogICAgICAgICAgICAgICAgZmV0Y2gucmVt\nb3ZlRmV0Y2hHcm91cChsZmcpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcHJvdmlkZSB0aGUgZ2l2ZW4gZmll\nbGQgbnVtYmVyIHRvIHRoZSBnaXZlbgogICAgICogZmllbGQgbWFuYWdlci4K\nICAgICAqLwogICAgdm9pZCBwcm92aWRlRmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBGaWVsZE1hbmFnZXIgc3RvcmUsIGludCBmaWVsZCkgewogICAg\nICAgIF9mbSA9IHN0b3JlOwogICAgICAgIHBjLnBjUHJvdmlkZUZpZWxkKGZp\nZWxkKTsKICAgICAgICBfZm0gPSBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogSGVscGVyIG1ldGhvZCB0byByZXBsYWNlIHRoZSBnaXZlbiBmaWVsZCBu\ndW1iZXIgdG8gdGhlIGdpdmVuCiAgICAgKiBmaWVsZCBtYW5hZ2VyLgogICAg\nICovCiAgICB2b2lkIHJlcGxhY2VGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIEZpZWxkTWFuYWdlciBsb2FkLCBpbnQgZmllbGQpIHsKICAgICAgICBf\nZm0gPSBsb2FkOwogICAgICAgIHBjLnBjUmVwbGFjZUZpZWxkKGZpZWxkKTsK\nICAgICAgICBfZm0gPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogTWFy\nayB0aGUgZmllbGQgYXMgbG9hZGVkIG9yIHVubG9hZGVkLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgc2V0TG9hZGVkKGludCBmaWVsZCwgYm9vbGVhbiBp\nc0xvYWRlZCkgewogICAgICAgIC8vIGRvbid0IGNvbnRpbnVlIGlmIGxvYWRl\nZCBzdGF0ZSBpcyBhbHJlYWR5IGNvcnJlY3Q7IG90aGVyd2lzZSB3ZQogICAg\nICAgIC8vIGNhbiBlbmQgdXAgY2xlYXJpbmcgX2ZpZWxkSW1wbCB3aGVuIHdl\nIHNob3VsZG4ndAogICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkgPT0g\naXNMb2FkZWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYg\nbG9hZGluZywgY2xlYXIgaW50ZXJtZWRpYXRlIGRhdGE7IGlmIHVubG9hZGlu\nZywgY2xlYXIgaW1wbCBkYXRhCiAgICAgICAgaWYgKF9maWVsZEltcGwgIT0g\nbnVsbCkgewogICAgICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFG\naWVsZERhdGFJbmRleChmaWVsZCk7CiAgICAgICAgICAgIGlmIChpZHggIT0g\nLTEpCiAgICAgICAgICAgICAgICBfZmllbGRJbXBsW2lkeF0gPSBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgaWYgKGlzTG9hZGVkKQogICAgICAgICAgICBf\nbG9hZGVkLnNldChmaWVsZCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nbG9hZGVkLmNsZWFyKGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBl\ncmZvcm0gcG9zdC1sb2FkIHN0ZXBzLCBpbmNsdWRpbmcgdGhlIHBvc3QgbG9h\nZCBjYWxsYmFjay4KICAgICAqIFdlIGhhdmUgdG8gY2hlY2sgdGhlIGRmZyBh\nZnRlciBhbGwgZmllbGQgbG9hZHMgYmVjYXVzZSBpdCBtaWdodCBiZQogICAg\nICogbG9hZGVkIGluIG11bHRpcGxlIHN0ZXBzIHdoZW4gcGFnaW5nIGlzIGlu\ndm9sdmVkOyB0aGUgaW5pdGlhbCBsb2FkCiAgICAgKiBtaWdodCBleGNsdWRl\nIHNvbWUgZmllbGRzIHdoaWNoIGFyZSB0aGVuIGltbWVkaWF0ZWx5IGxvYWRl\nZCBpbiBhCiAgICAgKiBzZXBhcmF0ZSBzdGVwIGJlZm9yZSBiZWluZyByZXR1\ncm5lZCB0byB0aGUgdXNlci4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQg\ndGhlIGZpZWxkIGluZGV4IHRoYXQgd2FzIGxvYWRlZCwgb3IgLTEgdG8gaW5k\naWNhdGUKICAgICAqIHRoYXQgYSBncm91cCBvZiBwb3NzaWJseSB1bmtub3du\nIGZpZWxkcyB3YXMgbG9hZGVkCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nb3N0TG9hZChpbnQgZmllbGQsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIC8vIG5vIG5lZWQgZm9yIHBvc3RMb2FkIGNhbGxiYWNrPwog\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19MT0FERUQpICE9IDApCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaW4gdGhlIG1pZGRsZSBvZiBh\nIGdyb3VwIGxvYWQsIGFmdGVyIHdoaWNoIHRoaXMgbWV0aG9kIHdpbGwgYmUK\nICAgICAgICAvLyBjYWxsZWQgYWdhaW4/CiAgICAgICAgaWYgKGZpZWxkICE9\nIC0xICYmIGlzTG9hZGluZygpKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIC8vIG5vIGxpc3RlbmVycz8KICAgICAgICBMaWZlY3ljbGVFdmVudE1h\nbmFnZXIgbWdyID0gX2Jyb2tlci5nZXRMaWZlY3ljbGVFdmVudE1hbmFnZXIo\nKTsKICAgICAgICBpZiAobWdyID09IG51bGwgfHwgIW1nci5oYXNMb2FkTGlz\ndGVuZXJzKGdldE1hbmFnZWRJbnN0YW5jZSgpLCBfbWV0YSkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIGZldGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICAvLyBpcyB0aGlzIGZpZWxkIGEgcG9zdC1sb2FkIGZpZWxk\nPwogICAgICAgIGlmIChmaWVsZCAhPSAtMSkgewogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICAgICAgaWYgKGZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSAKICAgICAg\nICAgICAgICAgICYmIGZldGNoLmhhc0ZldGNoR3JvdXAoRmV0Y2hHcm91cC5O\nQU1FX0RFRkFVTFQpCiAgICAgICAgICAgICAgICAmJiBwb3N0TG9hZChGZXRj\naEdyb3VwLk5BTUVfREVGQVVMVCwgZmV0Y2gpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICBTdHJpbmdbXSBmZ3MgPSBmbWQuZ2V0Q3Vz\ndG9tRmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmV0\nY2guaGFzRmV0Y2hHcm91cChmZ3NbaV0pICYmIHBvc3RMb2FkKGZnc1tpXSwg\nZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZldGNo\nLmdldEZldGNoR3JvdXBzKCkuaXRlcmF0b3IoKTsgCiAgICAgICAgICAgICAg\nICBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYgKHBvc3RM\nb2FkKChTdHJpbmcpIGl0ci5uZXh0KCksIGZldGNoKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHBvc3QtbG9hZCBhY3Rpb25zIGlm\nIHRoZSBnaXZlbiBmZXRjaCBncm91cCBpcyBhIHBvc3QtbG9hZCBncm91cAog\nICAgICogYW5kIGlzIGZ1bGx5IGxvYWRlZC4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIHBvc3RMb2FkKFN0cmluZyBmZ05hbWUsIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCkgewogICAgICAgIEZldGNoR3JvdXAgZmcgPSBfbWV0\nYS5nZXRGZXRjaEdyb3VwKGZnTmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51\nbGwgfHwgIWZnLmlzUG9zdExvYWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChpKSAm\nJiBmbWRzW2ldLmlzSW5GZXRjaEdyb3VwKGZnTmFtZSkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIF9mbGFncyB8PSBGTEFHX0xP\nQURFRDsKICAgICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudChnZXRN\nYW5hZ2VkSW5zdGFuY2UoKSwgZmV0Y2gsIF9tZXRhLCAKICAgICAgICAJTGlm\nZWN5Y2xlRXZlbnQuQUZURVJfTE9BRCk7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jaHJvbml6ZSBvdXIgdmVyc2lv\nbiBvYmplY3Qgd2l0aCB0aGUgZGF0YXN0b3JlLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gc3luY1ZlcnNpb24oT2JqZWN0IHNkYXRhKSB7CiAgICAg\nICAgcmV0dXJuIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuc3luY1ZlcnNp\nb24odGhpcywgc2RhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgbmVlZHMgYSB2ZXJzaW9uIGNoZWNr\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ZlcnNpb25DaGVja1Jl\ncXVpcmVkKCkgewogICAgICAgIC8vIGV4cGxpY2l0IGZsYWcgZm9yIHZlcnNp\nb24gY2hlY2sKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfVkVSU0lPTl9D\nSEVDSykgIT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAg\nIGlmICghX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkgJiYgIV9icm9rZXIuZ2V0\nQ29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5\nSW5zdGFuY2UoKS5nZXROb25PcHRpbWlzdGljVmVyc2lvbkNoZWNrKCkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX3N0YXRl\nLmlzVmVyc2lvbkNoZWNrUmVxdWlyZWQodGhpcyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgd2hldGhlciB0aGlzIGluc3RhbmNlIHJlcXVpcmVzIGEg\ndmVyc2lvbiBjaGVjayBvbiB0aGUgbmV4dCBmbHVzaC4KICAgICAqLwogICAg\ndm9pZCBzZXRDaGVja1ZlcnNpb24oYm9vbGVhbiB2ZXJzaW9uQ2hlY2spIHsK\nICAgICAgICBpZiAodmVyc2lvbkNoZWNrKQogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19WRVJTSU9OX0NIRUNLOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05fQ0hFQ0s7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSBuZWVk\ncyBhIHZlcnNpb24gdXBkYXRlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc1ZlcnNpb25VcGRhdGVSZXF1aXJlZCgpIHsKICAgICAgICByZXR1cm4g\nKF9mbGFncyAmIEZMQUdfVkVSU0lPTl9VUERBVEUpID4gMDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgcmVxdWly\nZXMgYSB2ZXJzaW9uIHVwZGF0ZSBvbiB0aGUgbmV4dCBmbHVzaC4KICAgICAq\nLwogICAgdm9pZCBzZXRVcGRhdGVWZXJzaW9uKGJvb2xlYW4gdmVyc2lvblVw\nZGF0ZSkgewogICAgICAgIGlmICh2ZXJzaW9uVXBkYXRlKQogICAgICAgICAg\nICBfZmxhZ3MgfD0gRkxBR19WRVJTSU9OX1VQREFURTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19WRVJTSU9OX1VQREFURTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zbGF0ZSB0aGUgZ2l2ZW4gZXhj\nZXB0aW9uIGJhc2VkIG9uIHRoZSBicm9rZXIncyBpbXBsaWNpdCBiZWhhdmlv\nci4KICAgICAqIFRyYW5zbGF0aW9uIG9ubHkgb2NjdXJzIGlmIHRoZSBleGNl\ncHRpb24gaXMgaW5pdGlhdGVkIGJ5IGEgdXNlciBhY3Rpb24KICAgICAqIG9u\nIGFuIGluc3RhbmNlLCBhbmQgdGhlcmVmb3JlIHdpbGwgbm90IGJlIGNhdWdo\ndCBhbmQgdHJhbnNsYXRlZCBieSB0aGUKICAgICAqIGJyb2tlci4KICAgICAq\nLwogICAgcHJvdGVjdGVkIFJ1bnRpbWVFeGNlcHRpb24gdHJhbnNsYXRlKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICBSdW50aW1lRXhjZXB0aW9u\nVHJhbnNsYXRvciB0cmFucyA9IF9icm9rZXIuCiAgICAgICAgICAgIGdldElu\nc3RhbmNlRXhjZXB0aW9uVHJhbnNsYXRvcigpOwogICAgICAgIHJldHVybiAo\ndHJhbnMgPT0gbnVsbCkgPyByZSA6IHRyYW5zLnRyYW5zbGF0ZShyZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMb2NrIHRoZSBzdGF0ZSBtYW5hZ2VyIGlm\nIHRoZSBtdWx0aXRocmVhZGVkIG9wdGlvbiBpcyBzZXQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIGxvY2soKSB7CiAgICAgICAgLy8gdXNlIGJyb2tl\nci1sZXZlbCBsb2NrIHRvIGF2b2lkIGRlYWRsb2NrIHNpdHVhdGlvbnMgd2l0\naCB0aGUgc3RhdGUKICAgICAgICAvLyBtYW5hZ2VyIGxvY2sgYW5kIGJyb2tl\nciBsb2NrIGJlaW5nIG9idGFpbmVkIGluIGRpZmZlcmVudCBvcmRlcnMKICAg\nICAgICBfYnJva2VyLmxvY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVu\nbG9jayB0aGUgc3RhdGUgbWFuYWdlci4KICAgICAqLwoJcHJvdGVjdGVkIHZv\naWQgdW5sb2NrICgpCgl7CgkJLy8gdXNlIGJyb2tlci1sZXZlbCBsb2NrIHRv\nIGF2b2lkIGRlYWRsb2NrIHNpdHVhdGlvbnMgd2l0aCB0aGUgc3RhdGUgCgkJ\nLy8gbWFuYWdlciBsb2NrIGFuZCBicm9rZXIgbG9jayBiZWluZyBvYnRhaW5l\nZCBpbiBkaWZmZXJlbnQgb3JkZXJzCgkJX2Jyb2tlci51bmxvY2sgKCk7Cgl9\nCn0K\n","encoding":"base64"}

