{"sha":"17de89ba7aeb803b9085ccafc59774f47725f936","node_id":"MDQ6QmxvYjIwNjM2NDoxN2RlODliYTdhZWI4MDNiOTA4NWNjYWZjNTk3NzRmNDc3MjVmOTM2","size":12738,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/17de89ba7aeb803b9085ccafc59774f47725f936","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWw7CgppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLlN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlZhbHVlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5BcHBsaWNhdGlvbklkczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4Y2VwdGlvbjsKCi8qKgog\nKiBIYW5kbGVzIGF0dGFjaGluZyBpbnN0YW5jZXMgdXNpbmcgdmVyc2lvbiBh\nbmQgcHJpbWFyeSBrZXkgZmllbGRzLgogKgogKiBAbm9qYXZhZG9jCiAqIEBh\ndXRob3IgU3RldmUgS2ltCiAqLwpjbGFzcyBWZXJzaW9uQXR0YWNoU3RyYXRl\nZ3kKICAgIGV4dGVuZHMgQXR0YWNoU3RyYXRlZ3kKICAgIGltcGxlbWVudHMg\nRGV0YWNoU3RhdGUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoVmVy\nc2lvbkF0dGFjaFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcm90ZWN0ZWQgT2Jq\nZWN0IGdldERldGFjaGVkT2JqZWN0SWQoQXR0YWNoTWFuYWdlciBtYW5hZ2Vy\nLAogICAgICAgIE9iamVjdCB0b0F0dGFjaCkgewogICAgICAgIEJyb2tlciBi\ncm9rZXIgPSBtYW5hZ2VyLmdldEJyb2tlcigpOwogICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YSA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAg\nICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0TWV0\nYURhdGEodG9BdHRhY2guZ2V0Q2xhc3MoKSwKICAgICAgICAgICAgYnJva2Vy\nLmdldENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgIHJldHVybiBBcHBs\naWNhdGlvbklkcy5jcmVhdGUoKFBlcnNpc3RlbmNlQ2FwYWJsZSkgdG9BdHRh\nY2gsIG1ldGEpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHByb3ZpZGVG\naWVsZChPYmplY3QgdG9BdHRhY2gsIFN0YXRlTWFuYWdlckltcGwgc20sCiAg\nICAgICAgaW50IGZpZWxkKSB7CiAgICAgICAgc20ucHJvdmlkZUZpZWxkKChQ\nZXJzaXN0ZW5jZUNhcGFibGUpIHRvQXR0YWNoLCB0aGlzLCBmaWVsZCk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBhdHRhY2goQXR0YWNoTWFuYWdlciBt\nYW5hZ2VyLCBPYmplY3QgdG9BdHRhY2gsCiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhLCBQZXJzaXN0ZW5jZUNhcGFibGUgaW50bywgT3BlbkpQQVN0YXRl\nTWFuYWdlciBvd25lciwKICAgICAgICBWYWx1ZU1ldGFEYXRhIG93bmVyTWV0\nYSwgYm9vbGVhbiBleHBsaWNpdCkgewogICAgICAgIEJyb2tlckltcGwgYnJv\na2VyID0gbWFuYWdlci5nZXRCcm9rZXIoKTsKICAgICAgICBQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMgPSAoUGVyc2lzdGVuY2VDYXBhYmxlKSB0b0F0dGFjaDsK\nCiAgICAgICAgYm9vbGVhbiBlbWJlZGRlZCA9IG93bmVyTWV0YSAhPSBudWxs\nICYmIG93bmVyTWV0YS5pc0VtYmVkZGVkUEMoKTsKICAgICAgICBib29sZWFu\nIGlzTmV3ID0gIWJyb2tlci5pc0RldGFjaGVkKHBjKTsKICAgICAgICBPYmpl\nY3QgdmVyc2lvbiA9IG51bGw7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IG51bGw7CgogICAgICAgIC8vIGlmIHRoZSBzdGF0ZSBtYW5hZ2VyIGZv\nciB0aGUgZW1iZWRkZWQgaW5zdGFuY2UgaXMgbnVsbCwgdGhlbgogICAgICAg\nIC8vIGl0IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbmV3IGluc3RhbmNlIChz\naW5jZSB0aGUKICAgICAgICAvLyBuZXdseSBwZXJzaXN0ZWQgb3duZXIgbWF5\nIGNyZWF0ZSBhIG5ldyBlbWJlZGRlZCBpbnN0YW5jZQogICAgICAgIC8vIGlu\nIHRoZSBjb25zdHJ1Y3Rvcik7IGZpeGVkIGJ1ZyAjMTA3NS4KICAgICAgICAv\nLyBhbHNvLCBpZiB0aGUgdXNlciBoYXMgYXR0YWNoZWQgYSBkZXRhY2hlZCBv\nYmogZnJvbSBzb21ld2hlcmUKICAgICAgICAvLyBlbHNlIGluIHRoZSBncmFw\naCB0byBhbiBlbWJlZGRlZCBmaWVsZCB0aGF0IHdhcyBwcmV2aW91c2x5IG51\nbGwsCiAgICAgICAgLy8gY29weSBpbnRvIGEgbmV3IGVtYmVkZGVkIGluc3Rh\nbmNlCiAgICAgICAgaWYgKGVtYmVkZGVkICYmIChpc05ldyB8fCBpbnRvID09\nIG51bGwKICAgICAgICAgICAgfHwgYnJva2VyLmdldFN0YXRlTWFuYWdlcihp\nbnRvKSA9PSBudWxsKSkgewogICAgICAgICAgICBpZiAoaW50byA9PSBudWxs\nKQogICAgICAgICAgICAgICAgaW50byA9IHBjLnBjTmV3SW5zdGFuY2UobnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBs\nKSBicm9rZXIuZW1iZWQoaW50bywgbnVsbCwgb3duZXIsIG93bmVyTWV0YSk7\nCiAgICAgICAgICAgIGludG8gPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUo\nKTsKICAgICAgICB9IGVsc2UgaWYgKGlzTmV3KSB7CiAgICAgICAgICAgIHNt\nID0gcGVyc2lzdChtYW5hZ2VyLCBwYywgbWV0YSwgQXBwbGljYXRpb25JZHMu\nY3JlYXRlKHBjLCBtZXRhKSwKICAgICAgICAgICAgICAgIGV4cGxpY2l0KTsK\nICAgICAgICAgICAgaW50byA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nOwogICAgICAgIH0gZWxzZSBpZiAoIWVtYmVkZGVkICYmIGludG8gPT0gbnVs\nbCkgewogICAgICAgICAgICBPYmplY3QgaWQgPSBnZXREZXRhY2hlZE9iamVj\ndElkKG1hbmFnZXIsIHRvQXR0YWNoKTsKICAgICAgICAgICAgaWYgKGlkICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBpbnRvID0gKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSkgYnJva2VyLmZpbmQoaWQsIHRydWUsIG51bGwpOwogICAgICAgICAg\nICBpZiAoaW50byA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE9wdGltaXN0aWNFeGNlcHRpb24oX2xvYy5nZXQoImF0dGFjaC12ZXJzaW9u\nLWRlbCIsCiAgICAgICAgICAgICAgICAgICAgcGMuZ2V0Q2xhc3MoKSwgaWQs\nIHZlcnNpb24pKS5zZXRGYWlsZWRPYmplY3QodG9BdHRhY2gpOwoKICAgICAg\nICAgICAgc20gPSBtYW5hZ2VyLmFzc2VydE1hbmFnZWQoaW50byk7CiAgICAg\nICAgICAgIGlmIChtZXRhLmdldERlc2NyaWJlZFR5cGUoKQogICAgICAgICAg\nICAgICAgIT0gc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgiYXR0YWNo\nLXdyb25nY2xhc3MiLCBpZCwgdG9BdHRhY2guZ2V0Q2xhc3MoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmli\nZWRUeXBlKCkpKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmpl\nY3QodG9BdHRhY2gpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgIHNtID0gbWFuYWdlci5hc3NlcnRNYW5hZ2VkKGludG8pOwoK\nICAgICAgICAvLyBtYXJrIHRoYXQgd2UgYXR0YWNoZWQgdGhlIGluc3RhbmNl\nICpiZWZvcmUqIHdlCiAgICAgICAgLy8gZmlsbCBpbiB2YWx1ZXMgdG8gYXZv\naWQgZW5kbGVzcyByZWN1cnNpb24KICAgICAgICBtYW5hZ2VyLnNldEF0dGFj\naGVkQ29weSh0b0F0dGFjaCwgaW50byk7CgogICAgICAgIC8vIGlmIHBlcnNp\nc3RpbmcgaW4gcGxhY2UsIGp1c3QgYXR0YWNoIGZpZWxkIHZhbHVlcwogICAg\nICAgIGlmIChwYyA9PSBpbnRvKSB7CiAgICAgICAgICAgIGF0dGFjaEZpZWxk\nc0luUGxhY2UobWFuYWdlciwgc20pOwogICAgICAgICAgICByZXR1cm4gaW50\nbzsKICAgICAgICB9CgogICAgICAgIC8vIGludm9rZSBhbnkgcHJlQXR0YWNo\nIG9uIHRoZSBkZXRhY2hlZCBpbnN0YW5jZQogICAgICAgIG1hbmFnZXIuZmly\nZUJlZm9yZUF0dGFjaCh0b0F0dGFjaCwgbWV0YSk7CgogICAgICAgIC8vIGFz\nc2lnbiB0aGUgZGV0YWNoZWQgcGMgdGhlIHNhbWUgc3RhdGUgbWFuYWdlciBh\ncyB0aGUgb2JqZWN0IHdlJ3JlCiAgICAgICAgLy8gY29weWluZyBpbnRvIGR1\ncmluZyB0aGUgYXR0YWNoIHByb2Nlc3MKICAgICAgICBwYy5wY1JlcGxhY2VT\ndGF0ZU1hbmFnZXIoc20pOwogICAgICAgIGludCBkZXRhY2ggPSAoaXNOZXcp\nID8gREVUQUNIX0FMTCA6IGJyb2tlci5nZXREZXRhY2hTdGF0ZSgpOwogICAg\nICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IGJyb2tlci5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RmllbGRzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgc3dpdGNoIChkZXRhY2gpIHsKICAgICAgICAg\nICAgICAgICAgICBjYXNlIERFVEFDSF9BTEw6CiAgICAgICAgICAgICAgICAg\nICAgICAgIGF0dGFjaEZpZWxkKG1hbmFnZXIsIHRvQXR0YWNoLCBzbSwgZm1k\nc1tpXSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIGNhc2UgREVUQUNIX0ZHUzoKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGZldGNoLnJlcXVpcmVzRmV0Y2goZm1kc1tp\nXSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2hGaWVsZCht\nYW5hZ2VyLCB0b0F0dGFjaCwgc20sIGZtZHNbaV0sIHRydWUpOwogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBj\nYXNlIERFVEFDSF9MT0FERUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGF0\ndGFjaEZpZWxkKG1hbmFnZXIsIHRvQXR0YWNoLCBzbSwgZm1kc1tpXSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKCFlbWJlZGRlZCAmJiAhaXNOZXcpCiAgICAg\nICAgICAgIGNvbXBhcmVWZXJzaW9uKHNtLCBwYyk7CiAgICAgICAgcmV0dXJu\nIGludG87CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgdGhlIHZl\ncnNpb24gaW5mb3JtYXRpb24gaXMgY29ycmVjdCBpbiB0aGUgZGV0YWNoZWQg\nb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY29tcGFyZVZlcnNp\nb24oU3RhdGVNYW5hZ2VySW1wbCBzbSwgUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nKSB7CiAgICAgICAgT2JqZWN0IHZlcnNpb24gPSBwYy5wY0dldFZlcnNpb24o\nKTsKICAgICAgICBpZiAodmVyc2lvbiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIC8vIGRvbid0IG5lZWQgdG8gbG9hZCB1bmxvYWRl\nZCBmaWVsZHMgc2luY2UgaXRzIGltcGxpY2l0bHkKICAgICAgICAvLyBhIHNp\nbmdsZSBmaWVsZCB2YWx1ZQogICAgICAgIFN0b3JlTWFuYWdlciBzdG9yZSA9\nIHNtLmdldEJyb2tlcigpLmdldFN0b3JlTWFuYWdlcigpOwogICAgICAgIHN3\naXRjaCAoc3RvcmUuY29tcGFyZVZlcnNpb24oc20sIHZlcnNpb24sIHNtLmdl\ndFZlcnNpb24oKSkpIHsKICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIu\nVkVSU0lPTl9MQVRFUjoKICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgYSBs\nYXRlciB2ZXJzaW9uOiBzZXQgaXQgaW50byB0aGUgb2JqZWN0LgogICAgICAg\nICAgICAgICAgLy8gbG9jayB2YWxpZGF0aW9uIHdpbGwgb2NjdXIgYXQgY29t\nbWl0IHRpbWUKICAgICAgICAgICAgICAgIHNtLnNldFZlcnNpb24odmVyc2lv\nbik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBT\ndG9yZU1hbmFnZXIuVkVSU0lPTl9FQVJMSUVSOgogICAgICAgICAgICBjYXNl\nIFN0b3JlTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVOVDoKICAgICAgICAgICAg\nICAgIHNtLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihzbS5nZXRNYW5hZ2VkSW5z\ndGFuY2UoKSk7CiAgICAgICAgICAgIGNhc2UgU3RvcmVNYW5hZ2VyLlZFUlNJ\nT05fU0FNRToKICAgICAgICAgICAgICAgIC8vIG5vIGFjdGlvbiByZXF1aXJl\nZAogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQXR0YWNoIHRoZSBmaWVsZHMgb2YgYW4gaW4tcGxhY2Ug\ncGVyc2lzdGVkIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYXR0YWNoRmllbGRzSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9\nIEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIE9iamVjdCBjdXIsIGF0dGFj\naGVkOwogICAgICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5Q\nQzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6\nCiAgICAgICAgICAgICAgICAgICAgY3VyID0gc20uZmV0Y2hPYmplY3RGaWVs\nZChpKTsKICAgICAgICAgICAgICAgICAgICBhdHRhY2hlZCA9IGF0dGFjaElu\nUGxhY2UobWFuYWdlciwgc20sIGZtZHNbaV0sIGN1cik7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0\nRWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY3VyID0g\nc20uZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICAgICAgICAgICAgICBh\ndHRhY2hlZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaEluUGxh\nY2UobWFuYWdlciwgc20sIGZtZHNbaV0sIChPYmplY3RbXSkgY3VyKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFmbWRzW2ldLmdldEVsZW1lbnQoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgIGN1ciA9IHNtLmZldGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAg\nICAgICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIs\nIHNtLCBmbWRzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAoQ29sbGVj\ndGlvbikgY3VyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nICAgICBpZiAoIWZtZHNbaV0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBl\nUEMoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhZm1kc1tpXS5nZXRL\nZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGN1ciA9IHNtLmZl\ndGNoT2JqZWN0RmllbGQoaSk7CiAgICAgICAgICAgICAgICAgICAgYXR0YWNo\nZWQgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWRzW2ldLCAoTWFw\nKSBjdXIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1ciAhPSBhdHRhY2hl\nZCkKICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChzbS5n\nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSwgaSwKICAgICAgICAgICAgICAgICAg\nICBjdXIsIGF0dGFjaGVkLCBTdGF0ZU1hbmFnZXIuU0VUX1JFTU9URSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZl\nbiBwYy4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3QgYXR0YWNoSW5QbGFj\nZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsIFN0YXRlTWFuYWdlckltcGwgc20s\nCiAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBwYykgewogICAg\nICAgIGlmIChwYyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBPYmplY3QgYXR0YWNoZWQgPSBtYW5hZ2VyLmdldEF0dGFjaGVk\nQ29weShwYyk7CiAgICAgICAgaWYgKGF0dGFjaGVkICE9IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBhdHRhY2hlZDsKCiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBpbnRvID0gbWFuYWdlci5nZXRCcm9rZXIoKS5nZXRTdGF0ZU1h\nbmFnZXIocGMpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRvUEMg\nPSAoaW50byA9PSBudWxsKSA/IG51bGwKICAgICAgICAgICAgOiBpbnRvLmdl\ndFBlcnNpc3RlbmNlQ2FwYWJsZSgpOwogICAgICAgIGlmICh2bWQuaXNFbWJl\nZGRlZCgpKQogICAgICAgICAgICByZXR1cm4gbWFuYWdlci5hdHRhY2gocGMs\nIGludG9QQywgc20sIHZtZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBtYW5h\nZ2VyLmF0dGFjaChwYywgaW50b1BDLCBudWxsLCBudWxsLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggdGhlIGdpdmVuIGFycmF5Lgog\nICAgICovCiAgICBwcml2YXRlIE9iamVjdFtdIGF0dGFjaEluUGxhY2UoQXR0\nYWNoTWFuYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kLCBPYmplY3RbXSBhcnIpIHsKICAgICAg\nICBpZiAoYXJyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgYXJyW2ldID0gYXR0YWNoSW5QbGFjZShtYW5hZ2VyLCBz\nbSwgZm1kLmdldEVsZW1lbnQoKSwgYXJyW2ldKTsKICAgICAgICByZXR1cm4g\nYXJyOwogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBj\nb2xsZWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIENvbGxlY3Rpb24gYXR0\nYWNoSW5QbGFjZShBdHRhY2hNYW5hZ2VyIG1hbmFnZXIsCiAgICAgICAgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSwgRmllbGRNZXRhRGF0YSBmbWQsIENvbGxlY3Rp\nb24gY29sbCkgewogICAgICAgIGlmIChjb2xsID09IG51bGwgfHwgY29sbC5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBjb2xsOwoKICAgICAgICAv\nLyBjb3B5IGlmIGVsZW1lbnRzIGVtYmVkZGVkIG9yIGNvbnRhaW5zIGRldGFj\naGVkLCB3aGljaCB3aWxsIG1lYW4KICAgICAgICAvLyB3ZSdsbCBoYXZlIHRv\nIGNvcHkgdGhlIGV4aXN0aW5nIGVsZW1lbnRzCiAgICAgICAgQ29sbGVjdGlv\nbiBjb3B5ID0gbnVsbDsKICAgICAgICBpZiAoZm1kLmdldEVsZW1lbnQoKS5p\nc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlvbikg\nc20ubmV3RmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY29sbC5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgaWYg\nKG1hbmFnZXIuZ2V0QnJva2VyKCkuaXNEZXRhY2hlZChpdHIubmV4dCgpKSkg\newogICAgICAgICAgICAgICAgICAgIGNvcHkgPSAoQ29sbGVjdGlvbikgc20u\nbmV3RmllbGRQcm94eShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIE9iamVjdCBhdHRhY2hlZDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgYXR0YWNoZWQgPSBhdHRhY2hJblBsYWNl\nKG1hbmFnZXIsIHNtLCBmbWQuZ2V0RWxlbWVudCgpLAogICAgICAgICAgICAg\nICAgaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBjb3B5LmFkZChhdHRhY2hlZCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IGNvbGwgOiBjb3B5\nOwogICAgfQoKICAgIC8qKgogICAgICogQXR0YWNoIHRoZSBnaXZlbiBtYXAu\nCiAgICAgKi8KICAgIHByaXZhdGUgTWFwIGF0dGFjaEluUGxhY2UoQXR0YWNo\nTWFuYWdlciBtYW5hZ2VyLCBTdGF0ZU1hbmFnZXJJbXBsIHNtLAogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kLCBNYXAgbWFwKSB7CiAgICAgICAgaWYgKG1h\ncCA9PSBudWxsIHx8IG1hcC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiBtYXA7CgogICAgICAgIE1hcCBjb3B5ID0gbnVsbDsKICAgICAgICBNYXAu\nRW50cnkgZW50cnk7CiAgICAgICAgYm9vbGVhbiBrZXlQQyA9IGZtZC5nZXRL\nZXkoKS5pc0RlY2xhcmVkVHlwZVBDKCk7CiAgICAgICAgYm9vbGVhbiB2YWxQ\nQyA9IGZtZC5nZXRFbGVtZW50KCkuaXNEZWNsYXJlZFR5cGVQQygpOwoKICAg\nICAgICAvLyBjb3B5IGlmIGVtYmVkZGVkIHBjcyBvciBkZXRhY2hlZCBwY3Ms\nIHdoaWNoIHdpbGwgcmVxdWlyZSB1cyB0bwogICAgICAgIC8vIGNvcHkgZWxl\nbWVudHMKICAgICAgICBpZiAoZm1kLmdldEtleSgpLmlzRW1iZWRkZWRQQygp\nIHx8IGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAg\nICAgIGNvcHkgPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJbmRl\neCgpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBp\ndHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKChrZXlQQyAmJiBtYW5h\nZ2VyLmdldEJyb2tlcigpLmlzRGV0YWNoZWQoZW50cnkuZ2V0S2V5KCkpKQog\nICAgICAgICAgICAgICAgICAgIHx8ICh2YWxQQyAmJiBtYW5hZ2VyLmdldEJy\nb2tlcigpLmlzRGV0YWNoZWQKICAgICAgICAgICAgICAgICAgICAoZW50cnku\nZ2V0VmFsdWUoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29weSA9IChN\nYXApIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdldEluZGV4KCkpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBPYmplY3Qga2V5LCB2YWw7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9\nIChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGtleSA9IGVu\ndHJ5LmdldEtleSgpOwogICAgICAgICAgICBpZiAoa2V5UEMpCiAgICAgICAg\nICAgICAgICBrZXkgPSBhdHRhY2hJblBsYWNlKG1hbmFnZXIsIHNtLCBmbWQu\nZ2V0S2V5KCksIGtleSk7CiAgICAgICAgICAgIHZhbCA9IGVudHJ5LmdldFZh\nbHVlKCk7CiAgICAgICAgICAgIGlmICh2YWxQQykKICAgICAgICAgICAgICAg\nIHZhbCA9IGF0dGFjaEluUGxhY2UobWFuYWdlciwgc20sIGZtZC5nZXRFbGVt\nZW50KCksIHZhbCk7CiAgICAgICAgICAgIGlmIChjb3B5ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBjb3B5LnB1dChrZXksIHZhbCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiAoY29weSA9PSBudWxsKSA/IG1hcCA6IGNvcHk7Cgl9\nCn0K\n","encoding":"base64"}

