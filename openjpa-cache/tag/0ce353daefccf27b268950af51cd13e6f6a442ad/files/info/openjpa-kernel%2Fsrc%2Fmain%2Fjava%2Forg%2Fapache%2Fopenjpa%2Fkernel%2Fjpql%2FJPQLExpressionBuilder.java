{"sha":"eeedcb12bd851644f4de6b006c274b8a38f55bf2","node_id":"MDQ6QmxvYjIwNjM2NDplZWVkY2IxMmJkODUxNjQ0ZjRkZTZiMDA2YzI3NGI4YTM4ZjU1YmYy","size":58052,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/eeedcb12bd851644f4de6b006c274b8a38f55bf2","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuanBxbDsKCmltcG9ydCBqYXZhLmlvLlByaW50U3Ry\nZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZh\nLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNp\nbWFsOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRp\nbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuU2V0Owpp\nbXBvcnQgamF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGlsLlRyZWVT\nZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1h\ncC5MaW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLkV4cHJlc3Npb25TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5RdWVyeUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLlF1ZXJ5T3BlcmF0aW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BYnN0cmFjdEV4cHJlc3Npb25CdWls\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4\ncHJlc3Npb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4\ncHMuRXhwcmVzc2lvbkZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuTGl0ZXJhbDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5QYXJhbWV0ZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuUGF0aDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuZXhwcy5RdWVyeUV4cHJlc3Npb25zOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlN1YnF1ZXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlZhbHVlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0\nb3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFs\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNl\nckV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAq\nIEJ1aWxkZXIgZm9yIEpQUUwgZXhwcmVzc2lvbnMuIFRoaXMgY2xhc3MgdGFr\nZXMgdGhlIHF1ZXJ5IHBhcnNlZAogKiBpbiB7QGxpbmsgSlBRTH0gYW5kIGNv\nbnZlcnRzIGl0IHRvIGFuIGV4cHJlc3Npb24gdHJlZSB1c2luZwogKiBhbiB7\nQGxpbmsgRXhwcmVzc2lvbkZhY3Rvcnl9LgogKgogKiBAYXV0aG9yIE1hcmMg\nUHJ1ZCdob21tZWF1eAogKiBAYXV0aG9yIFBhdHJpY2sgTGluc2tleQogKiBA\nbm9qYXZhZG9jCiAqLwpjbGFzcyBKUFFMRXhwcmVzc2lvbkJ1aWxkZXIKICAg\nIGV4dGVuZHMgQWJzdHJhY3RFeHByZXNzaW9uQnVpbGRlcgogICAgaW1wbGVt\nZW50cyBKUFFMVHJlZUNvbnN0YW50cyB7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IFZBUl9QQVRIID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBWQVJfRVJST1IgPSAyOwoKICAgIHByaXZhdGUgc3RhdGljIExv\nY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAo\nSlBRTEV4cHJlc3Npb25CdWlsZGVyLmNsYXNzKTsKCiAgICBwcml2YXRlIGZp\nbmFsIFN0YWNrIGNvbnRleHRzID0gbmV3IFN0YWNrKCk7CiAgICBwcml2YXRl\nIExpbmtlZE1hcCBwYXJhbWV0ZXJUeXBlczsKICAgIHByaXZhdGUgaW50IGFs\naWFzQ291bnQgPSAwOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAg\nICAgKgogICAgICogQHBhcmFtIGZhY3RvcnkgdGhlIGV4cHJlc3Npb24gZmFj\ndG9yeSB0byB1c2UKICAgICAqIEBwYXJhbSBxdWVyeSB1c2VkIHRvIHJlc29s\ndmUgdmFyaWFibGVzLCBwYXJhbWV0ZXJzLAogICAgICogYW5kIGNsYXNzIG5h\nbWVzIHVzZWQgaW4gdGhlIHF1ZXJ5CiAgICAgKiBAcGFyYW0gcGFyc2VkUXVl\ncnkgdGhlIHBhcnNlZCBxdWVyeQogICAgICovCiAgICBwdWJsaWMgSlBRTEV4\ncHJlc3Npb25CdWlsZGVyKEV4cHJlc3Npb25GYWN0b3J5IGZhY3RvcnksCiAg\nICAgICAgRXhwcmVzc2lvblN0b3JlUXVlcnkgcXVlcnksIE9iamVjdCBwYXJz\nZWRRdWVyeSkgewogICAgICAgIHN1cGVyKGZhY3RvcnksIHF1ZXJ5LmdldFJl\nc29sdmVyKCkpOwoKICAgICAgICBjb250ZXh0cy5wdXNoKG5ldyBDb250ZXh0\nKHBhcnNlZFF1ZXJ5IGluc3RhbmNlb2YgUGFyc2VkSlBRTAogICAgICAgICAg\nICA/IChQYXJzZWRKUFFMKSBwYXJzZWRRdWVyeQogICAgICAgICAgICA6IHBh\ncnNlZFF1ZXJ5IGluc3RhbmNlb2YgU3RyaW5nCiAgICAgICAgICAgID8gZ2V0\nUGFyc2VkUXVlcnkoKFN0cmluZykgcGFyc2VkUXVlcnkpCiAgICAgICAgICAg\nIDogbnVsbCwgbnVsbCkpOwoKICAgICAgICBpZiAoY3R4KCkucGFyc2VkID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbihwYXJzZWRRdWVyeSArICIiKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgTG9j\nYWxpemVyIGdldExvY2FsaXplcigpIHsKICAgICAgICByZXR1cm4gX2xvYzsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NMb2Fk\nZXIoKSB7CiAgICAgICAgLy8gd2UgZG9uJ3QgcmVzb2x2ZSBpbiB0aGUgY29u\ndGV4dCBvZiBhbnl0aGluZyBidXQgb3Vyc2VsdmVzCiAgICAgICAgcmV0dXJu\nIGdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKTsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgUGFyc2VkSlBRTCBnZXRQYXJzZWRRdWVyeSgpIHsKICAgICAgICBy\nZXR1cm4gY3R4KCkucGFyc2VkOwogICAgfQoKICAgIHByb3RlY3RlZCBQYXJz\nZWRKUFFMIGdldFBhcnNlZFF1ZXJ5KFN0cmluZyBqcHFsKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBQYXJzZWRKUFFMKGpwcWwpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBzZXRDYW5kaWRhdGUoQ2xhc3NNZXRhRGF0YSBjbWQsIFN0cmlu\nZyBzY2hlbWFBbGlhcykgewogICAgICAgIGFkZEFjY2Vzc1BhdGgoY21kKTsK\nCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICBjdHgoKS5t\nZXRhID0gY21kOwoKICAgICAgICBpZiAoc2NoZW1hQWxpYXMgIT0gbnVsbCkK\nICAgICAgICAgICAgY3R4KCkuc2NoZW1hQWxpYXMgPSBzY2hlbWFBbGlhczsK\nICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBuZXh0QWxpYXMoKSB7CiAgICAg\nICAgcmV0dXJuICJqcHFsYWxpYXMiICsgKCsrYWxpYXNDb3VudCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgcmVzb2x2ZUNsYXNzTWV0\nYURhdGEoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIC8vIGhhbmRsZSBsb29r\naW5nIHVwIGFsaWFzIG5hbWVzCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUg\nPSBhc3NlcnRTY2hlbWFOYW1lKG5vZGUpOwogICAgICAgIENsYXNzTWV0YURh\ndGEgY21kID0gZ2V0Q2xhc3NNZXRhRGF0YShzY2hlbWFOYW1lLCBmYWxzZSk7\nCiAgICAgICAgaWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nY21kOwoKICAgICAgICAvLyB3ZSBtaWdodCBiZSByZWZlcmVuY2luZyBhIGNv\nbGxlY3Rpb24gZmllbGQgb2YgYSBzdWJxdWVyeSdzIHBhcmVudAogICAgICAg\nIGlmIChpc1BhdGgobm9kZSkpIHsKICAgICAgICAgICAgUGF0aCBwYXRoID0g\nZ2V0UGF0aChub2RlKTsKICAgICAgICAgICAgcmV0dXJuIGdldEZpZWxkVHlw\nZShwYXRoLmxhc3QoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBub3cgcnVu\nIGFnYWluIHRvIHRocm93IHRoZSBjb3JyZWN0IGV4Y2VwdGlvbgogICAgICAg\nIHJldHVybiBnZXRDbGFzc01ldGFEYXRhKHNjaGVtYU5hbWUsIHRydWUpOwog\nICAgfQoKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRDbGFzc01ldGFE\nYXRhKFN0cmluZyBhbGlhcywgYm9vbGVhbiBhc3NlcnRWYWxpZCkgewogICAg\nICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGdldENsYXNzTG9hZGVyKCk7CiAg\nICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zID0gcmVzb2x2ZXIuZ2V0\nQ29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9z\naXRvcnlJbnN0YW5jZSgpOwoKICAgICAgICAvLyBmaXJzdCBjaGVjayBmb3Ig\ndGhlIGFsaWFzCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSByZXBvcy5n\nZXRNZXRhRGF0YShhbGlhcywgbG9hZGVyLCBmYWxzZSk7CgogICAgICAgIGlm\nIChjbWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNtZDsKCiAgICAg\nICAgLy8gbm93IGNoZWNrIGZvciB0aGUgY2xhc3MgbmFtZTsgdGhpcyBpcyBu\nb3QgdGVjaG5pY2FsbHkgcGVybWl0dGVkCiAgICAgICAgLy8gYnkgdGhlIEpQ\nQSBzcGVjLCBidXQgaXMgcmVxdWlyZWQgaW4gb3JkZXIgdG8gYmUgYWJsZSB0\nbyBleGVjdXRlCiAgICAgICAgLy8gSlBRTCBxdWVyaWVzIGZyb20gb3RoZXIg\nZmFjYWRlcyAobGlrZSBKRE8pIHRoYXQgZG8gbm90IGhhdmUKICAgICAgICAv\nLyB0aGUgY29uY2VwdCBvZiBlbnRpdHkgbmFtZXMgb3IgYWxpYXNlcwogICAg\nICAgIENsYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zvck5hbWUoYWxpYXMsIG51\nbGwpOwogICAgICAgIGlmIChjICE9IG51bGwpCiAgICAgICAgICAgIGNtZCA9\nIHJlcG9zLmdldE1ldGFEYXRhKGMsIGxvYWRlciwgYXNzZXJ0VmFsaWQpOwog\nICAgICAgIGVsc2UgaWYgKGFzc2VydFZhbGlkKQogICAgICAgICAgICBjbWQg\nPSByZXBvcy5nZXRNZXRhRGF0YShhbGlhcywgbG9hZGVyLCB0cnVlKTsKCiAg\nICAgICAgaWYgKGNtZCA9PSBudWxsICYmIGFzc2VydFZhbGlkKQogICAgICAg\nICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVt\nYS1uYW1lIiwKICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgYWxpYXMg\nfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBjbWQ7CiAgICB9CgogICAgcHJp\ndmF0ZSBDbGFzcyBnZXRDYW5kaWRhdGVUeXBlKCkgewogICAgICAgIHJldHVy\nbiBnZXRDYW5kaWRhdGVNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKTsK\nICAgIH0KCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0Q2FuZGlkYXRl\nTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKGN0eCgpLm1ldGEgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGN0eCgpLm1ldGE7CgogICAgICAgIENsYXNz\nTWV0YURhdGEgY2xzID0gZ2V0Q2FuZGlkYXRlTWV0YURhdGEocm9vdCgpKTsK\nICAgICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX1VTRVIsICJub3Qtc2NoZW1hLW5hbWUiLAogICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdeyByb290KCkgfSwgbnVsbCk7Cgog\nICAgICAgIHNldENhbmRpZGF0ZShjbHMsIG51bGwpOwogICAgICAgIHJldHVy\nbiBjbHM7CiAgICB9CgogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEgZ2V0\nQ2FuZGlkYXRlTWV0YURhdGEoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIC8v\nIGV4YW1pbmcgdGhlIG5vZGUgdG8gZmluZCB0aGUgY2FuZGlkYXRlIHF1ZXJ5\nCiAgICAgICAgLy8gIyMjIHRoaXMgc2hvdWxkIGFjdHVhbGx5IGJlIHRoZSBw\ncmltYXJ5IFNFTEVDVCBpbnN0YW5jZQogICAgICAgIC8vIHJlc29sdmVkIGFn\nYWluc3QgdGhlIGZyb20gdmFyaWFibGUgZGVjbGFyYXRpb25zCiAgICAgICAg\nSlBRTE5vZGUgZnJvbSA9IG5vZGUuZmluZENoaWxkQnlJRChKSlRGUk9NSVRF\nTSwgdHJ1ZSk7CiAgICAgICAgaWYgKGZyb20gPT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBPUEVOSlBBLTE1IGFsbG93IHN1YnF1ZXJ5IHdpdGhvdXQgYSBG\nUk9NSVRFTQogICAgICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRTVUJTRUxF\nQ1QpIHsgCiAgICAgICAgICAgICAgICBmcm9tID0gbm9kZS5maW5kQ2hpbGRC\neUlEKEpKVEZST00sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24o\nRVhfVVNFUiwgIm5vLWZyb20tY2xhdXNlIiwgbnVsbCwgbnVsbCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZnJvbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBK\nUFFMTm9kZSBuID0gZnJvbS5jaGlsZHJlbltpXTsKCiAgICAgICAgICAgIGlm\nIChuLmlkID09IEpKVEFCU1RSQUNUU0NIRU1BTkFNRSkgewogICAgICAgICAg\nICAgICAgLy8gd2Ugc2ltcGx5IHJldHVybiB0aGUgZmlyc3QgYWJzdHJhY3Qg\nc2NoZW1hIGNoaWxkCiAgICAgICAgICAgICAgICAvLyBhcyByZXNvbHZlZCBp\nbnRvIGEgY2xhc3MKICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgY21k\nID0gcmVzb2x2ZUNsYXNzTWV0YURhdGEobik7CgogICAgICAgICAgICAgICAg\naWYgKGNtZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBj\nbWQ7CgogICAgICAgICAgICAgICAgLy8gbm90IGEgc2NoZW1hOiB0cmVhdCBp\ndCBhcyBhIGNsYXNzCiAgICAgICAgICAgICAgICBTdHJpbmcgY2xzID0gYXNz\nZXJ0U2NoZW1hTmFtZShuKTsKICAgICAgICAgICAgICAgIGlmIChjbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlv\nbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1lIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3IE9iamVjdFtdeyByb290KCkgfSwgbnVsbCk7CgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldENsYXNzTWV0YURhdGEoY2xzLCB0cnVl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBPUEVOSlBBLTE1IHN1\ncHBvcnQgc3VicXVlcnkncyBmcm9tIGNsYXVzZSBkbyBub3Qgc3RhcnQgd2l0\naCAKICAgICAgICAgICAgLy8gaWRlbnRpZmljYXRpb25fdmFyaWFibGVfZGVj\nbGFyYXRpb24oKQogICAgICAgICAgICBpZiAobm9kZS5pZCA9PSBKSlRTVUJT\nRUxFQ1QpIHsKICAgICAgICAgICAgICAgIGlmIChuLmlkID09IEpKVElOTkVS\nSk9JTikgewogICAgICAgICAgICAgICAgICAgIG4gPSBuLmdldENoaWxkKDAp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG4uaWQg\nPT0gSkpUUEFUSCkgewogICAgICAgICAgICAgICAgICAgIFBhdGggcGF0aCA9\nIGdldFBhdGgobik7CiAgICAgICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBjbWQgPSBnZXRGaWVsZFR5cGUocGF0aC5sYXN0KCkpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChjbWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gY21kOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWFsaWFzIiwg\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBuIH0sIG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSAgICAgICAgICAgCiAgICAgICAgfQoK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGN1cnJlbnRRdWVyeSgpIHsKICAgICAgICByZXR1cm4gY3R4KCkucGFy\nc2VkID09IG51bGwgfHwgcm9vdCgpLnBhcnNlciA9PSBudWxsID8gbnVsbAog\nICAgICAgICAgICA6IHJvb3QoKS5wYXJzZXIuanBxbDsKICAgIH0KCiAgICBR\ndWVyeUV4cHJlc3Npb25zIGdldFF1ZXJ5RXhwcmVzc2lvbnMoKSB7CiAgICAg\nICAgUXVlcnlFeHByZXNzaW9ucyBleHBzID0gbmV3IFF1ZXJ5RXhwcmVzc2lv\nbnMoKTsKCiAgICAgICAgZXZhbFF1ZXJ5T3BlcmF0aW9uKGV4cHMpOwoKICAg\nICAgICBFeHByZXNzaW9uIGZpbHRlciA9IG51bGw7CiAgICAgICAgZmlsdGVy\nID0gYW5kKGV2YWxGcm9tQ2xhdXNlKHJvb3QoKS5pZCA9PSBKSlRTRUxFQ1Qp\nLCBmaWx0ZXIpOwogICAgICAgIGZpbHRlciA9IGFuZChldmFsV2hlcmVDbGF1\nc2UoZXhwcyksIGZpbHRlcik7CiAgICAgICAgZmlsdGVyID0gYW5kKGV2YWxT\nZWxlY3RDbGF1c2UoZXhwcyksIGZpbHRlcik7CgogICAgICAgIGV4cHMuZmls\ndGVyID0gZmlsdGVyID09IG51bGwgPyBmYWN0b3J5LmVtcHR5RXhwcmVzc2lv\nbigpIDogZmlsdGVyOwoKICAgICAgICBldmFsR3JvdXBpbmdDbGF1c2UoZXhw\ncyk7CiAgICAgICAgZXZhbEhhdmluZ0NsYXVzZShleHBzKTsKICAgICAgICBl\ndmFsRmV0Y2hKb2lucyhleHBzKTsKICAgICAgICBldmFsU2V0Q2xhdXNlKGV4\ncHMpOwogICAgICAgIGV2YWxPcmRlcmluZ0NsYXVzZXMoZXhwcyk7CgogICAg\nICAgIGlmIChwYXJhbWV0ZXJUeXBlcyAhPSBudWxsKQogICAgICAgICAgICBl\neHBzLnBhcmFtZXRlclR5cGVzID0gcGFyYW1ldGVyVHlwZXM7CgogICAgICAg\nIGV4cHMuYWNjZXNzUGF0aCA9IGdldEFjY2Vzc1BhdGgoKTsKCiAgICAgICAg\ncmV0dXJuIGV4cHM7CiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGFu\nZChFeHByZXNzaW9uIGUxLCBFeHByZXNzaW9uIGUyKSB7CiAgICAgICAgcmV0\ndXJuIGUxID09IG51bGwgPyBlMiA6IGUyID09IG51bGwgPyBlMSA6IGZhY3Rv\ncnkuYW5kKGUxLCBlMik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgU3Ry\naW5nIGFzc2VtYmxlKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4g\nYXNzZW1ibGUobm9kZSwgIi4iLCAwKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2VtYmxlIHRoZSBjaGlsZHJlbiBvZiB0aGUgc3BlY2lmaWMgbm9kZSBi\neSBhcHBlbmRpbmcgZWFjaAogICAgICogY2hpbGQsIHNlcGFyYXRlZCBieSB0\naGUgZGVsaW1pdGVyLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJp\nbmcgYXNzZW1ibGUoSlBRTE5vZGUgbm9kZSwgU3RyaW5nIGRlbGltaXRlciwg\naW50IGxhc3QpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgcmVzdWx0ID0gbmV3\nIFN0cmluZ0J1ZmZlcigpOwogICAgICAgIEpQUUxOb2RlW10gcGFydHMgPSBu\nb2RlLmNoaWxkcmVuOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBwYXJ0cyAh\nPSBudWxsICYmIGkgPCBwYXJ0cy5sZW5ndGggLSBsYXN0OyBpKyspCiAgICAg\nICAgICAgIHJlc3VsdC5hcHBlbmQocmVzdWx0Lmxlbmd0aCgpID4gMCA/IGRl\nbGltaXRlciA6ICIiKS4KICAgICAgICAgICAgICAgIGFwcGVuZChwYXJ0c1tp\nXS50ZXh0KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwog\nICAgfQoKICAgIHByaXZhdGUgRXhwcmVzc2lvbiBhc3NpZ25Qcm9qZWN0aW9u\ncyhKUFFMTm9kZSBwYXJhbWV0ZXJzTm9kZSwKICAgICAgICBRdWVyeUV4cHJl\nc3Npb25zIGV4cHMpIHsKICAgICAgICBpbnQgY291bnQgPSBwYXJhbWV0ZXJz\nTm9kZS5nZXRDaGlsZENvdW50KCk7CiAgICAgICAgZXhwcy5wcm9qZWN0aW9u\ncyA9IG5ldyBWYWx1ZVtjb3VudF07CiAgICAgICAgZXhwcy5wcm9qZWN0aW9u\nQ2xhdXNlcyA9IG5ldyBTdHJpbmdbY291bnRdOwogICAgICAgIGV4cHMucHJv\namVjdGlvbkFsaWFzZXMgPSBuZXcgU3RyaW5nW2NvdW50XTsKCiAgICAgICAg\nRXhwcmVzc2lvbiBleHAgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICBKUFFMTm9kZSBwYXJl\nbnQgPSBwYXJhbWV0ZXJzTm9kZS5nZXRDaGlsZChpKTsKICAgICAgICAgICAg\nSlBRTE5vZGUgbm9kZSA9IG9ubHlDaGlsZChwYXJlbnQpOwogICAgICAgICAg\nICBWYWx1ZSBwcm9qID0gZ2V0VmFsdWUobm9kZSk7CiAgICAgICAgICAgIGV4\ncHMucHJvamVjdGlvbnNbaV0gPSBwcm9qOwogICAgICAgICAgICBleHBzLnBy\nb2plY3Rpb25BbGlhc2VzW2ldID0gbmV4dEFsaWFzKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBleHA7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGV2\nYWxRdWVyeU9wZXJhdGlvbihRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAg\nICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSB3YW50IHRvIHNlbGVjdCwg\nZGVsZXRlLCBvciB1cGRhdGUKICAgICAgICBpZiAocm9vdCgpLmlkID09IEpK\nVFNFTEVDVCB8fCByb290KCkuaWQgPT0gSkpUU1VCU0VMRUNUKQogICAgICAg\nICAgICBleHBzLm9wZXJhdGlvbiA9IFF1ZXJ5T3BlcmF0aW9ucy5PUF9TRUxF\nQ1Q7CiAgICAgICAgZWxzZSBpZiAocm9vdCgpLmlkID09IEpKVERFTEVURSkK\nICAgICAgICAgICAgZXhwcy5vcGVyYXRpb24gPSBRdWVyeU9wZXJhdGlvbnMu\nT1BfREVMRVRFOwogICAgICAgIGVsc2UgaWYgKHJvb3QoKS5pZCA9PSBKSlRV\nUERBVEUpCiAgICAgICAgICAgIGV4cHMub3BlcmF0aW9uID0gUXVlcnlPcGVy\nYXRpb25zLk9QX1VQREFURTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRo\ncm93IHBhcnNlRXhjZXB0aW9uKEVYX1VOU1VQUE9SVEVELCAidW5yZWNvZ25p\nemVkLW9wZXJhdGlvbiIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIHJvb3QoKSB9LCBudWxsKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZh\nbEdyb3VwaW5nQ2xhdXNlKFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcykgewogICAg\nICAgIC8vIGhhbmRsZSBHUk9VUCBCWSBjbGF1c2VzCiAgICAgICAgSlBRTE5v\nZGUgZ3JvdXBCeU5vZGUgPSByb290KCkuZmluZENoaWxkQnlJRChKSlRHUk9V\nUEJZLCB0cnVlKTsKCiAgICAgICAgaWYgKGdyb3VwQnlOb2RlID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaW50IGdyb3VwQnlDb3Vu\ndCA9IGdyb3VwQnlOb2RlLmdldENoaWxkQ291bnQoKTsKCiAgICAgICAgZXhw\ncy5ncm91cGluZyA9IG5ldyBWYWx1ZVtncm91cEJ5Q291bnRdOwoKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGdyb3VwQnlDb3VudDsgaSsrKSB7CiAg\nICAgICAgICAgIEpQUUxOb2RlIG5vZGUgPSBncm91cEJ5Tm9kZS5nZXRDaGls\nZChpKTsKICAgICAgICAgICAgZXhwcy5ncm91cGluZ1tpXSA9IGdldFZhbHVl\nKG5vZGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZh\nbEhhdmluZ0NsYXVzZShRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAg\nICAvLyBoYW5kbGUgSEFWSU5HIGNsYXVzZXMKICAgICAgICBKUFFMTm9kZSBo\nYXZpbmdOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpUSEFWSU5HLCB0\ncnVlKTsKCiAgICAgICAgaWYgKGhhdmluZ05vZGUgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBleHBzLmhhdmluZyA9IGdldEV4cHJl\nc3Npb24ob25seUNoaWxkKGhhdmluZ05vZGUpKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgZXZhbE9yZGVyaW5nQ2xhdXNlcyhRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICAvLyBoYW5kbGUgT1JERVIgQlkgY2xhdXNlcwog\nICAgICAgIEpQUUxOb2RlIG9yZGVyYnkgPSByb290KCkuZmluZENoaWxkQnlJ\nRChKSlRPUkRFUkJZLCBmYWxzZSk7CiAgICAgICAgaWYgKG9yZGVyYnkgIT0g\nbnVsbCkgewogICAgICAgICAgICBpbnQgb3JkZXJjb3VudCA9IG9yZGVyYnku\nZ2V0Q2hpbGRDb3VudCgpOwogICAgICAgICAgICBleHBzLm9yZGVyaW5nID0g\nbmV3IFZhbHVlW29yZGVyY291bnRdOwogICAgICAgICAgICBleHBzLmFzY2Vu\nZGluZyA9IG5ldyBib29sZWFuW29yZGVyY291bnRdOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IG9yZGVyY291bnQ7IGkrKykgewogICAgICAg\nICAgICAgICAgSlBRTE5vZGUgbm9kZSA9IG9yZGVyYnkuZ2V0Q2hpbGQoaSk7\nCiAgICAgICAgICAgICAgICBleHBzLm9yZGVyaW5nW2ldID0gZ2V0VmFsdWUo\nZmlyc3RDaGlsZChub2RlKSk7CiAgICAgICAgICAgICAgICAvLyBvbW1pc3Np\nb24gb2YgQVNDL0RFU0MgdG9rZW4gaW1wbGllcyBhc2NlbmRpbmcKICAgICAg\nICAgICAgICAgIGV4cHMuYXNjZW5kaW5nW2ldID0gbm9kZS5nZXRDaGlsZENv\ndW50KCkgPD0gMSB8fAogICAgICAgICAgICAgICAgICAgIGxhc3RDaGlsZChu\nb2RlKS5pZCA9PSBKSlRBU0NFTkRJTkcgPyB0cnVlIDogZmFsc2U7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNz\naW9uIGV2YWxTZWxlY3RDbGF1c2UoUXVlcnlFeHByZXNzaW9ucyBleHBzKSB7\nCiAgICAgICAgaWYgKGV4cHMub3BlcmF0aW9uICE9IFF1ZXJ5T3BlcmF0aW9u\ncy5PUF9TRUxFQ1QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICBKUFFMTm9kZSBzZWxlY3ROb2RlID0gcm9vdCgpOwoKICAgICAgICBKUFFM\nTm9kZSBjb25zdHJ1Y3RvciA9IHNlbGVjdE5vZGUuZmluZENoaWxkQnlJRChK\nSlRDT05TVFJVQ1RPUiwgdHJ1ZSk7CiAgICAgICAgaWYgKGNvbnN0cnVjdG9y\nICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gYnVpbGQgdXAgdGhlIGZ1bGx5\nLXF1YWxpZmllZCByZXN1bHQgY2xhc3MgbmFtZSBieQogICAgICAgICAgICAv\nLyBhcHBlbmRpbmcgdG9nZXRoZXIgdGhlIGNvbXBvbmVudHMgb2YgdGhlIGNo\naWxkcmVuCiAgICAgICAgICAgIFN0cmluZyByZXN1bHRDbGFzc05hbWUgPSBh\nc3NlbWJsZShsZWZ0KGNvbnN0cnVjdG9yKSk7CiAgICAgICAgICAgIGV4cHMu\ncmVzdWx0Q2xhc3MgPSByZXNvbHZlci5jbGFzc0Zvck5hbWUocmVzdWx0Q2xh\nc3NOYW1lLCBudWxsKTsKCiAgICAgICAgICAgIC8vIG5vdyBhc3NpZ24gdGhl\nIGFyZ3VtZW50cyB0byB0aGUgc2VsZWN0IGNsYXVzZSBhcyB0aGUgcHJvamVj\ndGlvbnMKICAgICAgICAgICAgZXhwcy5kaXN0aW5jdCA9IGV4cHMuRElTVElO\nQ1RfRkFMU0U7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25Qcm9qZWN0aW9u\ncyhyaWdodChjb25zdHJ1Y3RvciksIGV4cHMpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIEpQUUxOb2RlIHNlbGVjdENsYXVzZSA9IHNlbGVjdE5v\nZGUuCiAgICAgICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVFNFTEVDVENM\nQVVTRSwgZmFsc2UpOwogICAgICAgICAgICBpZiAoc2VsZWN0Q2xhdXNlICE9\nIG51bGwgJiYgc2VsZWN0Q2xhdXNlLmhhc0NoaWxkSUQoSkpURElTVElOQ1Qp\nKQogICAgICAgICAgICAgICAgZXhwcy5kaXN0aW5jdCA9IGV4cHMuRElTVElO\nQ1RfVFJVRSB8IGV4cHMuRElTVElOQ1RfQVVUTzsKICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgZXhwcy5kaXN0aW5jdCA9IGV4cHMuRElTVElO\nQ1RfRkFMU0U7CgogICAgICAgICAgICAvLyBoYW5kbGUgU0VMRUNUIGNsYXVz\nZXMKICAgICAgICAgICAgSlBRTE5vZGUgZXhwTm9kZSA9IHNlbGVjdE5vZGUu\nCiAgICAgICAgICAgICAgICBmaW5kQ2hpbGRCeUlEKEpKVFNFTEVDVEVYUFJF\nU1NJT05TLCB0cnVlKTsKICAgICAgICAgICAgaWYgKGV4cE5vZGUgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAg\naW50IHNlbGVjdENvdW50ID0gZXhwTm9kZS5nZXRDaGlsZENvdW50KCk7CiAg\nICAgICAgICAgIEpQUUxOb2RlIHNlbGVjdENoaWxkID0gZmlyc3RDaGlsZChl\neHBOb2RlKTsKCiAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBzZWxlY3Rpbmcg\nanVzdCBvbmUgdGhpbmcgYW5kIHRoYXQgdGhpbmcgaXMgdGhlCiAgICAgICAg\nICAgIC8vIHNjaGVtYSdzIGFsaWFzLCB0aGVuIGRvIG5vdCB0cmVhdCBpdCBh\ncyBhIHByb2plY3Rpb24KICAgICAgICAgICAgaWYgKHNlbGVjdENvdW50ID09\nIDEgJiYgc2VsZWN0Q2hpbGQgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAg\nc2VsZWN0Q2hpbGQuZ2V0Q2hpbGRDb3VudCgpID09IDEgJiYKICAgICAgICAg\nICAgICAgIG9ubHlDaGlsZChzZWxlY3RDaGlsZCkgIT0gbnVsbCAmJgogICAg\nICAgICAgICAgICAgYXNzZXJ0U2NoZW1hQWxpYXMoKS4KICAgICAgICAgICAg\nICAgICAgICBlcXVhbHNJZ25vcmVDYXNlKG9ubHlDaGlsZChzZWxlY3RDaGls\nZCkudGV4dCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSlBRTCBkb2Vz\nIG5vdCBmaWx0ZXIgcmVsYXRpb25hbCBqb2lucyBmb3IgcHJvamVjdGlvbnMK\nICAgICAgICAgICAgICAgIGV4cHMuZGlzdGluY3QgJj0gfmV4cHMuRElTVElO\nQ1RfQVVUTzsKICAgICAgICAgICAgICAgIHJldHVybiBhc3NpZ25Qcm9qZWN0\naW9ucyhleHBOb2RlLCBleHBzKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBhc3NlcnRTY2hlbWFBbGlhcygp\nIHsKICAgICAgICBTdHJpbmcgYWxpYXMgPSBjdHgoKS5zY2hlbWFBbGlhczsK\nCiAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJhbGlhcy1yZXF1aXJlZCIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGN0eCgpLm1ldGEgfSwgbnVs\nbCk7CgogICAgICAgIHJldHVybiBhbGlhczsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgRXhwcmVzc2lvbiBldmFsRmV0Y2hKb2lucyhRdWVyeUV4cHJlc3Npb25z\nIGV4cHMpIHsKICAgICAgICBFeHByZXNzaW9uIGZpbHRlciA9IG51bGw7Cgog\nICAgICAgIC8vIGhhbmRsZSBKT0lOIEZFVENICiAgICAgICAgU2V0IGpvaW5z\nID0gbnVsbDsKCiAgICAgICAgSlBRTE5vZGVbXSBvdXRlcnMgPSByb290KCku\nZmluZENoaWxkcmVuQnlJRChKSlRPVVRFUkZFVENISk9JTik7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IG91dGVycyAhPSBudWxsICYmIGkgPCBvdXRlcnMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIChqb2lucyA9PSBudWxsID8gam9p\nbnMgPSBuZXcgVHJlZVNldCgpIDogam9pbnMpLgogICAgICAgICAgICAgICAg\nYWRkKGdldFBhdGgob25seUNoaWxkKG91dGVyc1tpXSkpLmxhc3QoKS5nZXRG\ndWxsTmFtZShmYWxzZSkpOwoKICAgICAgICBKUFFMTm9kZVtdIGlubmVycyA9\nIHJvb3QoKS5maW5kQ2hpbGRyZW5CeUlEKEpKVElOTkVSRkVUQ0hKT0lOKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaW5uZXJzICE9IG51bGwgJiYgaSA8\nIGlubmVycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgKGpvaW5zID09IG51\nbGwgPyBqb2lucyA9IG5ldyBUcmVlU2V0KCkgOiBqb2lucykuCiAgICAgICAg\nICAgICAgICBhZGQoZ2V0UGF0aChvbmx5Q2hpbGQoaW5uZXJzW2ldKSkubGFz\ndCgpLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAgICAgIGlmIChqb2lucyAh\nPSBudWxsKQogICAgICAgICAgICBleHBzLmZldGNoUGF0aHMgPSAoU3RyaW5n\nW10pIGpvaW5zLgogICAgICAgICAgICAgICAgdG9BcnJheShuZXcgU3RyaW5n\nW2pvaW5zLnNpemUoKV0pOwoKICAgICAgICByZXR1cm4gZmlsdGVyOwogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIGV2YWxTZXRDbGF1c2UoUXVlcnlFeHBy\nZXNzaW9ucyBleHBzKSB7CiAgICAgICAgLy8gaGFuZGxlIFNFVCBmaWVsZCA9\nIHZhbHVlCiAgICAgICAgSlBRTE5vZGVbXSBub2RlcyA9IHJvb3QoKS5maW5k\nQ2hpbGRyZW5CeUlEKEpKVFVQREFURUlURU0pOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBub2RlcyAhPSBudWxsICYmIGkgPCBub2Rlcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gZ2V0UGF0\naChmaXJzdENoaWxkKG5vZGVzW2ldKSkubGFzdCgpOwogICAgICAgICAgICBW\nYWx1ZSB2YWwgPSBnZXRWYWx1ZShvbmx5Q2hpbGQobGFzdENoaWxkKG5vZGVz\nW2ldKSkpOwogICAgICAgICAgICBleHBzLnB1dFVwZGF0ZShmaWVsZCwgdmFs\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGV2\nYWxXaGVyZUNsYXVzZShRdWVyeUV4cHJlc3Npb25zIGV4cHMpIHsKICAgICAg\nICAvLyBldmFsdWF0ZSB0aGUgV0hFUkUgY2xhdXNlCiAgICAgICAgSlBRTE5v\nZGUgd2hlcmVOb2RlID0gcm9vdCgpLmZpbmRDaGlsZEJ5SUQoSkpUV0hFUkUs\nIGZhbHNlKTsKICAgICAgICBpZiAod2hlcmVOb2RlID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRXhwcmVzc2lv\nbikgZXZhbCh3aGVyZU5vZGUpOwogICAgfQoKICAgIHByaXZhdGUgRXhwcmVz\nc2lvbiBldmFsRnJvbUNsYXVzZShib29sZWFuIG5lZWRzQWxpYXMpIHsKICAg\nICAgICBFeHByZXNzaW9uIGV4cCA9IG51bGw7CgogICAgICAgIC8vIGJ1aWxk\nIHVwIHRoZSBhbGlhcyBtYXAgaW4gdGhlIEZST00gY2xhdXNlCiAgICAgICAg\nSlBRTE5vZGUgZnJvbSA9IHJvb3QoKS5maW5kQ2hpbGRCeUlEKEpKVEZST00s\nIGZhbHNlKTsKICAgICAgICBpZiAoZnJvbSA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tZnJvbS1jbGF1\nc2UiLCBudWxsLCBudWxsKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmcm9tLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIEpQ\nUUxOb2RlIG5vZGUgPSBmcm9tLmNoaWxkcmVuW2ldOwoKICAgICAgICAgICAg\naWYgKG5vZGUuaWQgPT0gSkpURlJPTUlURU0pCiAgICAgICAgICAgICAgICBl\neHAgPSBldmFsRnJvbUl0ZW0oZXhwLCBub2RlLCBuZWVkc0FsaWFzKTsKICAg\nICAgICAgICAgZWxzZSBpZiAobm9kZS5pZCA9PSBKSlRPVVRFUkpPSU4pCiAg\nICAgICAgICAgICAgICBleHAgPSBhZGRKb2luKG5vZGUsIGZhbHNlLCBleHAp\nOwogICAgICAgICAgICBlbHNlIGlmIChub2RlLmlkID09IEpKVElOTkVSSk9J\nTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpvaW4obm9kZSwgdHJ1ZSwg\nZXhwKTsKICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5pZCA9PSBKSlRJTk5F\nUkZFVENISk9JTikKICAgICAgICAgICAgICAgIGV4cCA9IGFkZEpvaW4obm9k\nZSwgdHJ1ZSwgZXhwKTsKICAgICAgICAgICAgZWxzZSBpZiAobm9kZS5pZCA9\nPSBKSlRPVVRFUkZFVENISk9JTikKICAgICAgICAgICAgICAgIDsgLy8gd2Ug\naGFuZGxlIG91dGVyIGZldGNoIGpvaW5zIGluIHRoZSBldmFsRmV0Y2hKb2lu\ncygpIG1ldGhvZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0\naHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LXNjaGVtYS1uYW1l\nIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUgfSwg\nbnVsbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZXhwOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkcyBhIGpvaW4gY29uZGl0aW9uIHRvIHRoZSBn\naXZlbiBleHByZXNzaW9uLgogICAgICoKICAgICAqIEBwYXJhbSBub2RlIHRo\nZSBub2RlIHRvIGNoZWNrCiAgICAgKiBAcGFyYW0gaW5uZXIgd2hldGhlciBv\nciBub3QgdGhlIGpvaW4gc2hvdWxkIGJlIGFuIGlubmVyIGpvaW4KICAgICAq\nIEBwYXJhbSBleHAgYW4gZXhpc3RpbmcgZXhwcmVzc2lvbiB0byBBTkQsIG9y\nIG51bGwgaWYgbm9uZQogICAgICogQHJldHVybiB0aGUgRXhwcmVzc2lvbiB3\naXRoIHRoZSBqb2luIGNvbmRpdGlvbiBhZGRlZAogICAgICovCiAgICBwcml2\nYXRlIEV4cHJlc3Npb24gYWRkSm9pbihKUFFMTm9kZSBub2RlLCBib29sZWFu\nIGlubmVyLCBFeHByZXNzaW9uIGV4cCkgewogICAgICAgIC8vIHRoZSB0eXBl\nIHdpbGwgYmUgdGhlIGRlY2xhcmVkIHR5cGUgZm9yIHRoZSBmaWVsZAogICAg\nICAgIFBhdGggcGF0aCA9IGdldFBhdGgoZmlyc3RDaGlsZChub2RlKSwgZmFs\nc2UsIGlubmVyKTsKCiAgICAgICAgSlBRTE5vZGUgYWxpYXMgPSBub2RlLmdl\ndENoaWxkQ291bnQoKSA+PSAyID8gcmlnaHQobm9kZSkgOiBudWxsOwogICAg\nICAgIC8vIE9QRU5KUEEtMTUgc3VwcG9ydCBzdWJxdWVyeSdzIGZyb20gY2xh\ndXNlIGRvIG5vdCBzdGFydCB3aXRoIAogICAgICAgIC8vIGlkZW50aWZpY2F0\naW9uX3ZhcmlhYmxlX2RlY2xhcmF0aW9uKCkKICAgICAgICBpZiAoaW5uZXIg\nJiYgY3R4KCkuc3VicXVlcnkgIT0gbnVsbCAmJiBjdHgoKS5zY2hlbWFBbGlh\ncyA9PSBudWxsKSB7CiAgICAgICAgICAgIHNldENhbmRpZGF0ZShnZXRGaWVs\nZFR5cGUocGF0aC5sYXN0KCkpLCBhbGlhcy50ZXh0KTsKCiAgICAgICAgICAg\nIFBhdGggc3VicGF0aCA9IGZhY3RvcnkubmV3UGF0aChjdHgoKS5zdWJxdWVy\neSk7CiAgICAgICAgICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY3R4KCkuc3Vi\ncXVlcnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgIGV4cCA9ICBhbmQo\nZXhwLCBmYWN0b3J5LmVxdWFsKHBhdGgsIHN1YnBhdGgpKTsKICAgICAgICB9\nCgogICAgICAgIHJldHVybiBhZGRKb2luKHBhdGgsIGFsaWFzLCBpbm5lciwg\nZXhwKTsKICAgIH0KCiAgICBwcml2YXRlIEV4cHJlc3Npb24gYWRkSm9pbihQ\nYXRoIHBhdGgsIEpQUUxOb2RlIGFsaWFzTm9kZSwgYm9vbGVhbiBpbm5lciwK\nICAgICAgICBFeHByZXNzaW9uIGV4cCkgewogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gcGF0aC5sYXN0KCk7CgogICAgICAgIGlmIChmbWQgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwg\nInBhdGgtbm8tbWV0YSIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117\nIHBhdGgsIG51bGwgfSwgbnVsbCk7CgogICAgICAgIFN0cmluZyBhbGlhcyA9\nIGFsaWFzTm9kZSAhPSBudWxsID8gYWxpYXNOb2RlLnRleHQgOiBuZXh0QWxp\nYXMoKTsKCiAgICAgICAgVmFsdWUgdmFyID0gZ2V0VmFyaWFibGUoYWxpYXMs\nIHRydWUpOwogICAgICAgIHZhci5zZXRNZXRhRGF0YShnZXRGaWVsZFR5cGUo\nZm1kKSk7CgogICAgICAgIEV4cHJlc3Npb24gam9pbiA9IG51bGw7CgogICAg\nICAgIC8vIGlmIHRoZSB2YXJpYWJsZSBpcyBhbHJlYWR5IGJvdW5kLCBnZXQg\ndGhlIHZhcidzIHZhbHVlIGFuZAogICAgICAgIC8vIGRvIGEgcmVndWxhciBj\nb250YWlucyB3aXRoIHRoYXQKICAgICAgICBib29sZWFuIGJvdW5kID0gaXNC\nb3VuZCh2YXIpOwogICAgICAgIGlmIChib3VuZCkgewogICAgICAgICAgICB2\nYXIgPSBnZXRWYWx1ZShhbGlhc05vZGUsIFZBUl9QQVRIKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBiaW5kKHZhcik7CiAgICAgICAgICAgIGpv\naW4gPSBhbmQoam9pbiwgZmFjdG9yeS5iaW5kVmFyaWFibGUodmFyLCBwYXRo\nKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWZtZC5pc1R5cGVQQygpKSAv\nLyBtdWx0aS12YWx1ZWQgcmVsYXRpb24KICAgICAgICB7CiAgICAgICAgICAg\nIGlmIChib3VuZCkKICAgICAgICAgICAgICAgIGpvaW4gPSBhbmQoam9pbiwg\nZmFjdG9yeS5jb250YWlucyhwYXRoLCB2YXIpKTsKCiAgICAgICAgICAgIHNl\ndEltcGxpY2l0Q29udGFpbnNUeXBlcyhwYXRoLCB2YXIsIENPTlRBSU5TX1RZ\nUEVfRUxFTUVOVCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYW5kKGV4\ncCwgam9pbik7CiAgICB9CgogICAgcHJpdmF0ZSBFeHByZXNzaW9uIGV2YWxG\ncm9tSXRlbShFeHByZXNzaW9uIGV4cCwgSlBRTE5vZGUgbm9kZSwKICAgICAg\nICBib29sZWFuIG5lZWRzQWxpYXMpIHsKICAgICAgICBDbGFzc01ldGFEYXRh\nIGNtZCA9IHJlc29sdmVDbGFzc01ldGFEYXRhKGZpcnN0Q2hpbGQobm9kZSkp\nOwoKICAgICAgICBTdHJpbmcgYWxpYXMgPSBudWxsOwoKICAgICAgICBpZiAo\nbm9kZS5nZXRDaGlsZENvdW50KCkgPCAyKSB7CiAgICAgICAgICAgIGlmIChu\nZWVkc0FsaWFzKQogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRp\nb24oRVhfVVNFUiwgImFsaWFzLXJlcXVpcmVkIiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IGNtZCB9LCBudWxsKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBhbGlhcyA9IHJpZ2h0KG5vZGUpLnRleHQ7CiAg\nICAgICAgICAgIEpQUUxOb2RlIGxlZnQgPSBsZWZ0KG5vZGUpOwoKICAgICAg\nICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3ZSBhcmUgcmVmZXJyaW5n\nIHRvIGEgcGF0aCBpbiB0aGUgZnJvbQogICAgICAgICAgICAvLyBjbGF1c2Us\nIHNpbmNlIHdlIG1pZ2h0IGJlIGluIGEgc3VicXVlcnkgYWdhaW5zdCBhIGNv\nbGxlY3Rpb24KICAgICAgICAgICAgaWYgKGlzUGF0aChsZWZ0KSkgewogICAg\nICAgICAgICAgICAgUGF0aCBwYXRoID0gZ2V0UGF0aChsZWZ0KTsKICAgICAg\nICAgICAgICAgIHNldENhbmRpZGF0ZShnZXRGaWVsZFR5cGUocGF0aC5sYXN0\nKCkpLCBhbGlhcyk7CgogICAgICAgICAgICAgICAgUGF0aCBzdWJwYXRoID0g\nZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5KTsKICAgICAgICAgICAg\nICAgIHN1YnBhdGguc2V0TWV0YURhdGEoY3R4KCkuc3VicXVlcnkuZ2V0TWV0\nYURhdGEoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYW5kKGV4cCwgZmFj\ndG9yeS5lcXVhbChwYXRoLCBzdWJwYXRoKSk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIGFuIGFsaWFzOiBiaW5k\nIGl0IGFzIGEgdmFyaWFibGUKICAgICAgICAgICAgICAgIFZhbHVlIHZhciA9\nIGdldFZhcmlhYmxlKGFsaWFzLCB0cnVlKTsKICAgICAgICAgICAgICAgIHZh\nci5zZXRNZXRhRGF0YShjbWQpOwogICAgICAgICAgICAgICAgYmluZCh2YXIp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAjIyMgd2Ug\nYXNzaWduIHRoZSBmaXJzdCBGUk9NSVRFTSBpbnN0YW5jZSB3ZSBzZWUgYXMK\nICAgICAgICAvLyB0aGUgZ2xvYmFsIGNhbmRpZGF0ZSwgd2hpY2ggaXMgaW5j\nb3JyZWN0OiB3ZSBzaG91bGQKICAgICAgICAvLyBpbnN0ZWFkIGJlIG1hcHBp\nbmcgdGhpcyB0byB0aGUgU0VMRUNUSVRFTSB0byBzZWUKICAgICAgICAvLyB3\naGljaCBpcyB0aGUgZGVzaXJlZCBjYW5kaWRhdGUKICAgICAgICBpZiAoY3R4\nKCkuc2NoZW1hQWxpYXMgPT0gbnVsbCkKICAgICAgICAgICAgc2V0Q2FuZGlk\nYXRlKGNtZCwgYWxpYXMpOwoKICAgICAgICByZXR1cm4gZXhwOwogICAgfQoK\nICAgIHByb3RlY3RlZCBib29sZWFuIGlzRGVjbGFyZWRWYXJpYWJsZShTdHJp\nbmcgbmFtZSkgewogICAgICAgIC8vIEpQUUwgZG9lc24ndCBzdXBwb3J0IGRl\nY2xhcmluZyB2YXJpYWJsZXMKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDaGVjayB0byBzZWUgaWYgdGhlIHNwZWNpZmlj\nIG5vZGUgaXMgYSBwYXRoICh2cy4gYSBzY2hlbWEgbmFtZSkKICAgICAqLwog\nICAgYm9vbGVhbiBpc1BhdGgoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGlm\nIChub2RlLmdldENoaWxkQ291bnQoKSA8IDIpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgZmluYWwgU3RyaW5nIG5hbWUgPSBmaXJzdENo\naWxkKG5vZGUpLnRleHQ7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBoYW5kbGUgdGhl\nIGNhc2Ugd2hlcmUgdGhlIGNsYXNzIG5hbWUgaXMgdGhlIGFsaWFzCiAgICAg\nICAgLy8gZm9yIHRoZSBjYW5kaWRhdGUgKHdlIGRvbid0IHVzZSB2YXJpYWJs\nZXMgZm9yIHRoaXMpCiAgICAgICAgaWYgKGdldE1ldGFEYXRhRm9yQWxpYXMo\nbmFtZSkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAg\nICAgIGlmICghaXNTZWVuVmFyaWFibGUobmFtZSkpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgZmluYWwgVmFsdWUgdmFyID0gZ2V0VmFy\naWFibGUobmFtZSwgZmFsc2UpOwoKICAgICAgICBpZiAodmFyICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBpc0JvdW5kKHZhcik7CgogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzc01l\ndGFEYXRhIGdldEZpZWxkVHlwZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgY21kID0gbnVsbDsKICAgICAgICBW\nYWx1ZU1ldGFEYXRhIHZtZDsKCiAgICAgICAgaWYgKCh2bWQgPSBmbWQuZ2V0\nRWxlbWVudCgpKSAhPSBudWxsKQogICAgICAgICAgICBjbWQgPSB2bWQuZ2V0\nRGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBlbHNlIGlmICgodm1k\nID0gZm1kLmdldEtleSgpKSAhPSBudWxsKQogICAgICAgICAgICBjbWQgPSB2\nbWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBlbHNlIGlm\nICgodm1kID0gZm1kLmdldFZhbHVlKCkpICE9IG51bGwpCiAgICAgICAgICAg\nIGNtZCA9IHZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwoKICAgICAg\nICBpZiAoY21kID09IG51bGwgfHwgY21kLmdldERlc2NyaWJlZFR5cGUoKSA9\nPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNtZCA9IGZtZC5nZXREZWNs\nYXJlZFR5cGVNZXRhRGF0YSgpOwoKICAgICAgICByZXR1cm4gY21kOwogICAg\nfQoKICAgIC8qKgogICAgICogSWRlbnRpZmljYXRpb24gdmFyaWFibGVzIGlu\nIEpQUUwgYXJlIGNhc2UgaW5zZW5zaXRpdmUsIHNvIGxvd2VyLWNhc2UKICAg\nICAqIGFsbCB2YXJpYWJsZXMgd2UgYXJlIGdvaW5nIHRvIGJpbmQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBWYWx1ZSBnZXRWYXJpYWJsZShTdHJpbmcgaWQs\nIGJvb2xlYW4gYmluZCkgewogICAgICAgIGlmIChpZCA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgcmV0dXJuIHN1cGVyLmdl\ndFZhcmlhYmxlKGlkLnRvTG93ZXJDYXNlKCksIGJpbmQpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBib29sZWFuIGlzU2VlbmRWYXJpYWJsZShTdHJpbmcgaWQp\nIHsKICAgICAgICByZXR1cm4gaWQgIT0gbnVsbCAmJiBzdXBlci5pc1NlZW5W\nYXJpYWJsZShpZC50b0xvd2VyQ2FzZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIGNsYXNzIG5hbWUgdXNpbmcgdGhlIGNoaWxkcmVu\nIG9mIHRoZSBKUFFMTm9kZS4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcg\nYXNzZXJ0U2NoZW1hTmFtZShKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgaWYg\nKG5vZGUuaWQgIT0gSkpUQUJTVFJBQ1RTQ0hFTUFOQU1FKQogICAgICAgICAg\nICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm90LWlkZW50aWZl\nciIsCiAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUgfSwgbnVs\nbCk7CgogICAgICAgIHJldHVybiBhc3NlbWJsZShub2RlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgbWV0aG9kIHRvIGV2YWx1\nYXRlIHRoZSBnaXZlbiBub2RlLgogICAgICovCiAgICBwcml2YXRlIE9iamVj\ndCBldmFsKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBWYWx1ZSB2YWwxID0g\nbnVsbDsKICAgICAgICBWYWx1ZSB2YWwyID0gbnVsbDsKICAgICAgICBWYWx1\nZSB2YWwzID0gbnVsbDsKCiAgICAgICAgYm9vbGVhbiBub3QgPSBub2RlLm5v\ndDsKCiAgICAgICAgc3dpdGNoIChub2RlLmlkKSB7CiAgICAgICAgICAgIGNh\nc2UgSkpUV0hFUkU6IC8vIHRvcC1sZXZlbCBXSEVSRSBjbGF1c2UKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRFeHByZXNzaW9uKG9ubHlDaGlsZChub2Rl\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVEJPT0xFQU5MSVRFUkFMOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubmV3TGl0ZXJhbCgidHJ1ZSIu\nZXF1YWxzSWdub3JlQ2FzZQogICAgICAgICAgICAgICAgICAgIChub2RlLnRl\neHQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSwKICAgICAgICAg\nICAgICAgICAgICBMaXRlcmFsLlRZUEVfQk9PTEVBTik7CgogICAgICAgICAg\nICBjYXNlIEpKVElOVEVHRVJMSVRFUkFMOgogICAgICAgICAgICAgICAgLy8g\ndXNlIEJpZ0RlY2ltYWwgYmVjYXVzZSBpdCBjYW4gaGFuZGxlIHBhcnNpbmcg\nZXhwb25lbnRzCiAgICAgICAgICAgICAgICBCaWdEZWNpbWFsIGludGxpdCA9\nIG5ldyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAgICAgICAgKG5vZGUudGV4\ndC5lbmRzV2l0aCgibCIpIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiTCIpCiAg\nICAgICAgICAgICAgICAgICAgICAgID8gbm9kZS50ZXh0LnN1YnN0cmluZygw\nLCBub2RlLnRleHQubGVuZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAg\nICAgICA6IG5vZGUudGV4dCkuCiAgICAgICAgICAgICAgICAgICAgbXVsdGlw\nbHkobmV3IEJpZ0RlY2ltYWwobmVnYXRpdmUobm9kZSkpKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWN0b3J5Lm5ld0xpdGVyYWwobmV3IExvbmcoaW50\nbGl0LmxvbmdWYWx1ZSgpKSwKICAgICAgICAgICAgICAgICAgICBMaXRlcmFs\nLlRZUEVfTlVNQkVSKTsKCiAgICAgICAgICAgIGNhc2UgSkpUREVDSU1BTExJ\nVEVSQUw6CiAgICAgICAgICAgICAgICBCaWdEZWNpbWFsIGRlY2xpdCA9IG5l\ndyBCaWdEZWNpbWFsCiAgICAgICAgICAgICAgICAgICAgKG5vZGUudGV4dC5l\nbmRzV2l0aCgiZCIpIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiRCIpIHx8CiAg\nICAgICAgICAgICAgICAgICAgICAgIG5vZGUudGV4dC5lbmRzV2l0aCgiZiIp\nIHx8IG5vZGUudGV4dC5lbmRzV2l0aCgiRiIpCiAgICAgICAgICAgICAgICAg\nICAgICAgID8gbm9kZS50ZXh0LnN1YnN0cmluZygwLCBub2RlLnRleHQubGVu\nZ3RoKCkgLSAxKQogICAgICAgICAgICAgICAgICAgICAgICA6IG5vZGUudGV4\ndCkuCiAgICAgICAgICAgICAgICAgICAgbXVsdGlwbHkobmV3IEJpZ0RlY2lt\nYWwobmVnYXRpdmUobm9kZSkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5Lm5ld0xpdGVyYWwoZGVjbGl0LCBMaXRlcmFsLlRZUEVfTlVNQkVS\nKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1RSSU5HTElURVJBTDoKICAgICAg\nICAgICAgY2FzZSBKSlRUUklNQ0hBUkFDVEVSOgogICAgICAgICAgICBjYXNl\nIEpKVEVTQ0FQRUNIQVJBQ1RFUjoKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWN0b3J5Lm5ld0xpdGVyYWwodHJpbVF1b3Rlcyhub2RlLnRleHQpLAogICAg\nICAgICAgICAgICAgICAgIExpdGVyYWwuVFlQRV9TUV9TVFJJTkcpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRQQVRURVJOVkFMVUU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZXZhbChmaXJzdENoaWxkKG5vZGUpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUTkFNRURJTlBVVFBBUkFNRVRFUjoKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQYXJhbWV0ZXIobm9kZS50ZXh0LCBmYWxzZSk7CgogICAg\nICAgICAgICBjYXNlIEpKVFBPU0lUSU9OQUxJTlBVVFBBUkFNRVRFUjoKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRQYXJhbWV0ZXIobm9kZS50ZXh0LCB0\ncnVlKTsKCiAgICAgICAgICAgIGNhc2UgSkpUT1I6IC8vIHggT1IgeQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnkub3IoZ2V0RXhwcmVzc2lvbihs\nZWZ0KG5vZGUpKSwKICAgICAgICAgICAgICAgICAgICBnZXRFeHByZXNzaW9u\nKHJpZ2h0KG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFORDogLy8g\neCBBTkQgeQogICAgICAgICAgICAgICAgcmV0dXJuIGFuZChnZXRFeHByZXNz\naW9uKGxlZnQobm9kZSkpLAogICAgICAgICAgICAgICAgICAgIGdldEV4cHJl\nc3Npb24ocmlnaHQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpURVFV\nQUxTOiAvLyB4ID0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVl\nKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVl\nKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZXModmFsMSwgdmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFjdG9yeS5lcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUTk9URVFVQUxTOiAvLyB4IDw+IHkKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3Rvcnkubm90RXF1YWwodmFsMSwgdmFsMik7CgogICAg\nICAgICAgICBjYXNlIEpKVExFU1NUSEFOOiAvLyB4IDwgeQogICAgICAgICAg\nICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAg\nICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAg\nICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgbnVsbCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5sZXNzVGhhbih2YWwxLCB2\nYWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTEVTU09SRVFVQUw6IC8vIHgg\nPD0geQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwg\ndmFsMiwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5s\nZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBK\nSlRHUkVBVEVSVEhBTjogLy8geCA+IHkKICAgICAgICAgICAgICAgIHZhbDEg\nPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZhbDIg\nPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBzZXRJ\nbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIG51bGwpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRlclRoYW4odmFsMSwgdmFsMik7Cgog\nICAgICAgICAgICBjYXNlIEpKVEdSRUFURVJPUkVRVUFMOiAvLyB4ID49IHkK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIs\nIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuZ3JlYXRl\nclRoYW5FcXVhbCh2YWwxLCB2YWwyKTsKCiAgICAgICAgICAgIGNhc2UgSkpU\nQUREOiAvLyB4ICsgeQogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVl\nKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVl\nKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0VHlw\nZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhY3RvcnkuYWRkKHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAg\nY2FzZSBKSlRTVUJUUkFDVDogLy8geCAtIHkKICAgICAgICAgICAgICAgIHZh\nbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHZh\nbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7CiAgICAgICAgICAgICAgICBz\nZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIsIFRZUEVfTlVNQkVSKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN1YnRyYWN0KHZhbDEsIHZh\nbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRNVUxUSVBMWTogLy8geCAqIHkK\nICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpKTsK\nICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZShyaWdodChub2RlKSk7\nCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGVzKHZhbDEsIHZhbDIs\nIFRZUEVfTlVNQkVSKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5\nLm11bHRpcGx5KHZhbDEsIHZhbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRE\nSVZJREU6IC8vIHggLyB5CiAgICAgICAgICAgICAgICB2YWwxID0gZ2V0VmFs\ndWUobGVmdChub2RlKSk7CiAgICAgICAgICAgICAgICB2YWwyID0gZ2V0VmFs\ndWUocmlnaHQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRU\neXBlcyh2YWwxLCB2YWwyLCBUWVBFX05VTUJFUik7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFjdG9yeS5kaXZpZGUodmFsMSwgdmFsMik7CgogICAgICAg\nICAgICBjYXNlIEpKVEJFVFdFRU46IC8vIHguZmllbGQgW05PVF0gQkVUV0VF\nTiA1IEFORCAxMAogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGNo\naWxkKG5vZGUsIDAsIDMpKTsKICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRW\nYWx1ZShjaGlsZChub2RlLCAxLCAzKSk7CiAgICAgICAgICAgICAgICB2YWwz\nID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMiwgMykpOwogICAgICAgICAgICAg\nICAgc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAg\nICAgICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFsMywgbnVsbCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbE5vdChub3QsIGFuZChmYWN0\nb3J5LmdyZWF0ZXJUaGFuRXF1YWwodmFsMSwgdmFsMiksCiAgICAgICAgICAg\nICAgICAgICAgZmFjdG9yeS5sZXNzVGhhbkVxdWFsKHZhbDEsIHZhbDMpKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVElOOiAvLyB4LmZpZWxkIFtOT1RdIElO\nICgnYScsICdiJywgJ2MnKQoKICAgICAgICAgICAgICAgIEV4cHJlc3Npb24g\naW5FeHAgPSBudWxsOwogICAgICAgICAgICAgICAgSXRlcmF0b3IgaW5JdGVy\nYXRvciA9IG5vZGUuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIC8vIHRo\nZSBmaXJzdCBjaGlsZCBpcyB0aGUgcGF0aAogICAgICAgICAgICAgICAgdmFs\nMSA9IGdldFZhbHVlKChKUFFMTm9kZSkgaW5JdGVyYXRvci5uZXh0KCkpOwoK\nICAgICAgICAgICAgICAgIHdoaWxlIChpbkl0ZXJhdG9yLmhhc05leHQoKSkg\newogICAgICAgICAgICAgICAgICAgIHZhbDIgPSBnZXRWYWx1ZSgoSlBRTE5v\nZGUpIGluSXRlcmF0b3IubmV4dCgpKTsKCiAgICAgICAgICAgICAgICAgICAg\nLy8gc3BlY2lhbCBjYXNlIGZvciA8dmFsdWU+IElOICg8c3VicXVlcnk+KQog\nICAgICAgICAgICAgICAgICAgIGlmICh2YWwyIGluc3RhbmNlb2YgU3VicXVl\ncnkgJiYgbm9kZS5nZXRDaGlsZENvdW50KCkgPT0gMikKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY29udGFpbnModmFsMiwgdmFs\nMSk7IAoKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGN1cnJlbnRs\neSBhIHNlcXVlbmNlIG9mIE9SIGV4cHJlc3Npb25zLCBzaW5jZSB3ZQogICAg\nICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBoYXZlIHN1cHBvcnQgZm9yIElO\nIGV4cHJlc3Npb25zCiAgICAgICAgICAgICAgICAgICAgc2V0SW1wbGljaXRU\neXBlcyh2YWwxLCB2YWwyLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoaW5FeHAgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgaW5F\neHAgPSBmYWN0b3J5LmVxdWFsKHZhbDEsIHZhbDIpOwogICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaW5FeHAgPSBm\nYWN0b3J5Lm9yKGluRXhwLCBmYWN0b3J5LmVxdWFsKHZhbDEsIHZhbDIpKTsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyB3ZSBhZGRp\ndGlvbmFsbHkgbmVlZCB0byBhZGQgaW4gYSAiTk9UIE5VTEwiIGNsYXVzZSwg\nc2luY2UKICAgICAgICAgICAgICAgIC8vIHRoZSBJTiBiZWhhdmlvciB0aGF0\nIGlzIGV4cGVjdGVkIGJ5IHRoZSBDVFMgYWxzbyBleHBlY3RzCiAgICAgICAg\nICAgICAgICAvLyB0byBmaWx0ZXIgb3VyIE5VTExzCiAgICAgICAgICAgICAg\nICByZXR1cm4gYW5kKGV2YWxOb3Qobm90LCBpbkV4cCksCiAgICAgICAgICAg\nICAgICAgICAgZmFjdG9yeS5ub3RFcXVhbCh2YWwxLCBmYWN0b3J5LmdldE51\nbGwoKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRJU05VTEw6IC8vIHguZmll\nbGQgSVMgW05PVF0gTlVMTAogICAgICAgICAgICAgICAgaWYgKG5vdCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5ub3RFcXVhbAogICAg\nICAgICAgICAgICAgICAgICAgICAoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUp\nKSwgZmFjdG9yeS5nZXROdWxsKCkpOwogICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmVxdWFsCiAgICAg\nICAgICAgICAgICAgICAgICAgIChnZXRWYWx1ZShvbmx5Q2hpbGQobm9kZSkp\nLCBmYWN0b3J5LmdldE51bGwoKSk7CgogICAgICAgICAgICBjYXNlIEpKVFBB\nVEg6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UGF0aE9yQ29uc3RhbnQo\nbm9kZSk7CgogICAgICAgICAgICBjYXNlIEpKVElERU5USUZJRVI6CiAgICAg\nICAgICAgIGNhc2UgSkpUSURFTlRJRklDQVRJT05WQVJJQUJMRToKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRJZGVudGlmaWVyKG5vZGUpOwoKICAgICAg\nICAgICAgY2FzZSBKSlROT1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFj\ndG9yeS5ub3QoZ2V0RXhwcmVzc2lvbihvbmx5Q2hpbGQobm9kZSkpKTsKCiAg\nICAgICAgICAgIGNhc2UgSkpUTElLRTogLy8gZmllbGQgTElLRSAnJXNvbWV2\nYWwlJwogICAgICAgICAgICAgICAgdmFsMSA9IGdldFZhbHVlKGxlZnQobm9k\nZSkpOwogICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5v\nZGUpKTsKCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMSwg\nVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRUeXBl\nKHZhbDIsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAgICAvLyBsb29r\nIGZvciBhbiBlc2NhcGUgY2hhcmFjdGVyIGJlbmVhdGggdGhlIG5vZGUKICAg\nICAgICAgICAgICAgIFN0cmluZyBlc2NhcGUgPSBudWxsOwogICAgICAgICAg\nICAgICAgSlBRTE5vZGUgZXNjYXBlTm9kZSA9IHJpZ2h0KG5vZGUpLgogICAg\nICAgICAgICAgICAgICAgIGZpbmRDaGlsZEJ5SUQoSkpURVNDQVBFQ0hBUkFD\nVEVSLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChlc2NhcGVOb2RlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgZXNjYXBlID0gdHJpbVF1b3Rl\ncyhvbmx5Q2hpbGQoZXNjYXBlTm9kZSkudGV4dCk7CgogICAgICAgICAgICAg\nICAgaWYgKG5vdCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9y\neS5ub3RNYXRjaGVzKHZhbDEsIHZhbDIsICJfIiwgIiUiLCBlc2NhcGUpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5Lm1hdGNoZXModmFsMSwgdmFsMiwgIl8iLCAiJSIsIGVzY2Fw\nZSk7CgogICAgICAgICAgICBjYXNlIEpKVElTRU1QVFk6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZXZhbE5vdChub3QsCiAgICAgICAgICAgICAgICAgICAg\nZmFjdG9yeS5pc0VtcHR5KGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUU0laRToKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWN0b3J5LnNpemUoZ2V0VmFsdWUob25seUNoaWxkKG5vZGUpKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVFVQUEVSOgogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSk7CiAgICAgICAgICAg\nICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMSwgVFlQRV9TVFJJTkcpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkudG9VcHBlckNhc2UodmFsMSk7\nCgogICAgICAgICAgICBjYXNlIEpKVExPV0VSOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhY3RvcnkudG9Mb3dlckNhc2UoZ2V0U3RyaW5nVmFsdWUob25s\neUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVExFTkdUSDoK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LnN0cmluZ0xlbmd0aChn\nZXRTdHJpbmdWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUQUJTOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnku\nYWJzKGdldE51bWJlclZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAgICAg\nICAgICAgY2FzZSBKSlRTUVJUOgogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nY3Rvcnkuc3FydChnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQobm9kZSkpKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUTU9EOgogICAgICAgICAgICAgICAgdmFs\nMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAgdmFs\nMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAgIHNl\ndEltcGxpY2l0VHlwZXModmFsMSwgdmFsMiwgVFlQRV9OVU1CRVIpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkubW9kKHZhbDEsIHZhbDIpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRUUklNOiAvLyBUUklNKFtbd2hlcmVdIFtj\naGFyXSBGUk9NXSBmaWVsZCkKICAgICAgICAgICAgICAgIHZhbDEgPSBnZXRW\nYWx1ZShsYXN0Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAgc2V0SW1w\nbGljaXRUeXBlKHZhbDEsIFRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAg\nICBCb29sZWFuIHRyaW1XaGVyZSA9IG51bGw7CgogICAgICAgICAgICAgICAg\nSlBRTE5vZGUgZmlyc3RUcmltQ2hpbGQgPSBmaXJzdENoaWxkKG5vZGUpOwoK\nICAgICAgICAgICAgICAgIGlmIChub2RlLmdldENoaWxkQ291bnQoKSA+IDEp\nIHsKICAgICAgICAgICAgICAgICAgICB0cmltV2hlcmUgPQogICAgICAgICAg\nICAgICAgICAgICAgICBmaXJzdFRyaW1DaGlsZC5pZCA9PSBKSlRUUklNTEVB\nRElORyA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RUcmltQ2hp\nbGQuaWQgPT0gSkpUVFJJTVRSQUlMSU5HID8gQm9vbGVhbi5GQUxTRQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBWYWx1ZSB0cmltQ2hhcjsKCiAg\nICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgMyBjaGlsZHJlbiwgdGhl\nbiB3ZSBrbm93IHRoZSB0cmltCiAgICAgICAgICAgICAgICAvLyBjaGFyIGlz\nIHRoZSBzZWNvbmQgbm9kZQogICAgICAgICAgICAgICAgaWYgKG5vZGUuZ2V0\nQ2hpbGRDb3VudCgpID09IDMpCiAgICAgICAgICAgICAgICAgICAgdHJpbUNo\nYXIgPSBnZXRWYWx1ZShzZWNvbmRDaGlsZChub2RlKSk7CiAgICAgICAgICAg\nICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHR3byBjaGlsZHJlbiwgdGhlbiB3\nZSBuZWVkIHRvIGNoZWNrIHRvIHNlZQogICAgICAgICAgICAgICAgICAgIC8v\nIGlmIHRoZSBmaXJzdCBjaGlsZCBpcyBhIGxlYWRpbmcvdHJhaWxpbmcvYm90\naCBub2RlLAogICAgICAgICAgICAgICAgICAgIC8vIG9yIHRoZSB0cmltIGNo\nYXJhY3RlciBub2RlCiAgICAgICAgICAgICAgICBlbHNlIGlmIChub2RlLmdl\ndENoaWxkQ291bnQoKSA9PSAyCiAgICAgICAgICAgICAgICAgICAgJiYgZmly\nc3RUcmltQ2hpbGQuaWQgIT0gSkpUVFJJTUxFQURJTkcKICAgICAgICAgICAg\nICAgICAgICAmJiBmaXJzdFRyaW1DaGlsZC5pZCAhPSBKSlRUUklNVFJBSUxJ\nTkcKICAgICAgICAgICAgICAgICAgICAmJiBmaXJzdFRyaW1DaGlsZC5pZCAh\nPSBKSlRUUklNQk9USCkKICAgICAgICAgICAgICAgICAgICB0cmltQ2hhciA9\nIGdldFZhbHVlKGZpcnN0Q2hpbGQobm9kZSkpOwogICAgICAgICAgICAgICAg\nICAgIC8vIG90aHdlcndpc2UsIHdlIGRlZmF1bHQgdG8gdHJpbW1pbmcgdGhl\nIHNwYWNlIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHRyaW1DaGFyID0gZmFjdG9yeS5uZXdMaXRlcmFsKCIg\nIiwgTGl0ZXJhbC5UWVBFX1NUUklORyk7CgogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhY3RvcnkudHJpbSh2YWwxLCB0cmltQ2hhciwgdHJpbVdoZXJlKTsK\nCiAgICAgICAgICAgIGNhc2UgSkpUQ09OQ0FUOgogICAgICAgICAgICAgICAg\ndmFsMSA9IGdldFZhbHVlKGxlZnQobm9kZSkpOwogICAgICAgICAgICAgICAg\ndmFsMiA9IGdldFZhbHVlKHJpZ2h0KG5vZGUpKTsKICAgICAgICAgICAgICAg\nIHNldEltcGxpY2l0VHlwZSh2YWwxLCBUWVBFX1NUUklORyk7CiAgICAgICAg\nICAgICAgICBzZXRJbXBsaWNpdFR5cGUodmFsMiwgVFlQRV9TVFJJTkcpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY29uY2F0KHZhbDEsIHZh\nbDIpOwoKICAgICAgICAgICAgY2FzZSBKSlRTVUJTVFJJTkc6CiAgICAgICAg\nICAgICAgICB2YWwxID0gZ2V0VmFsdWUoY2hpbGQobm9kZSwgMCwgMykpOwog\nICAgICAgICAgICAgICAgdmFsMiA9IGdldFZhbHVlKGNoaWxkKG5vZGUsIDEs\nIDMpKTsKICAgICAgICAgICAgICAgIHZhbDMgPSBnZXRWYWx1ZShjaGlsZChu\nb2RlLCAyLCAzKSk7CiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUo\ndmFsMSwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgc2V0SW1wbGlj\naXRUeXBlKHZhbDIsIEludGVnZXIuVFlQRSk7CiAgICAgICAgICAgICAgICBz\nZXRJbXBsaWNpdFR5cGUodmFsMywgSW50ZWdlci5UWVBFKTsKCiAgICAgICAg\nICAgICAgICAvLyB0aGUgc2VtYW50aWNzIG9mIHRoZSBKUFFMIHN1YnN0cmlu\nZygpIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAvLyBhcmUgdGhhdCBhcmcy\nIGlzIHRoZSAxLWJhc2VkIHN0YXJ0IGluZGV4LCBhbmQgYXJnMyBpcwogICAg\nICAgICAgICAgICAgLy8gdGhlIGxlbmd0aCBvZiB0aGUgc3RyaW5nIHRvIGJl\nIHJldHVybjsgdGhpcyBpcyBkaWZmZXJlbnQKICAgICAgICAgICAgICAgIC8v\nIHRoYW4gdGhlIHNlbWFudGljcyBvZiB0aGUgRXhwcmVzc2lvbkZhY3Rvcnkn\ncyBzdWJzdHJpbmcsCiAgICAgICAgICAgICAgICAvLyB3aGljaCBtYXRjaGVz\nIHRoZSBKYXZhIGxhbmd1YWdlICgwLWJhc2VkIHN0YXJ0IGluZGV4LAogICAg\nICAgICAgICAgICAgLy8gYXJnMiBpcyB0aGUgZW5kIGluZGV4KTogd2UgcGVy\nZm9ybSB0aGUgdHJhbnNsYXRpb24gYnkKICAgICAgICAgICAgICAgIC8vIGFk\nZGluZyBvbmUgdG8gdGhlIGZpcnN0IGFyZ3VtZW50LCBhbmQgdGhlbiBhZGRp\nbmcgdGhlCiAgICAgICAgICAgICAgICAvLyBmaXJzdCBhcmd1bWVudCB0byB0\naGUgc2Vjb25kIGFyZ3VtZW50IHRvIGdldCB0aGUgZW5kSW5kZXgKICAgICAg\nICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyAjIyMgd2UgY291bGQg\nZ2V0IHJpZCBvZiBzb21lIG1lc3N5IGV4cHJlc3Npb25zIGJ5IGNoZWNraW5n\nIGZvcgogICAgICAgICAgICAgICAgLy8gdGhlIGNvbW1vbiBjYXNlIHdoZXJl\nIHRoZSBhcmd1bWVudHMgYXJlIHNwZWNpZmllZCBhcwogICAgICAgICAgICAg\nICAgLy8gYSBsaXRlcmFsLCBpbiB3aGljaCBjYXNlIHdlIGNvdWxkIGp1c3Qg\nZG8gdGhlIGNhbGN1bGF0aW9ucwogICAgICAgICAgICAgICAgLy8gaW4gbWVt\nb3J5OyBvdGhlcndpc2Ugd2Ugd2luZCB1cCB3aXRoIHVnbHkgbG9va2luZyBT\nUUwgbGlrZToKICAgICAgICAgICAgICAgIC8vIFNFTEVDVCAuLi4gRlJPTSAu\nLi4gdDEKICAgICAgICAgICAgICAgIC8vIChTVUJTVFJJTkcodDEuQVNUUiwg\nKD8gLSA/KSArIDEsICg/ICsgKD8gLSA/KSkgLSAoKD8gLSA/KSkpID0gPykK\nICAgICAgICAgICAgICAgIC8vIFtwYXJhbXM9KGxvbmcpIDIsIChpbnQpIDEs\nIChsb25nKSAyLCAobG9uZykgMiwgKGludCkgMSwKICAgICAgICAgICAgICAg\nIC8vIChsb25nKSAyLCAoaW50KSAxLCAoU3RyaW5nKSBvbwogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3Rvcnkuc3Vic3RyaW5nKHZhbDEsIGZhY3Rvcnku\nbmV3QXJndW1lbnRMaXN0CiAgICAgICAgICAgICAgICAgICAgKGZhY3Rvcnku\nc3VidHJhY3QodmFsMiwgZmFjdG9yeS5uZXdMaXRlcmFsCiAgICAgICAgICAg\nICAgICAgICAgICAgIChOdW1iZXJzLnZhbHVlT2YoMSksIExpdGVyYWwuVFlQ\nRV9OVU1CRVIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgKGZhY3Rvcnku\nYWRkKHZhbDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZmFjdG9y\neS5zdWJ0cmFjdCh2YWwyLCBmYWN0b3J5Lm5ld0xpdGVyYWwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoTnVtYmVycy52YWx1ZU9mKDEpLCBM\naXRlcmFsLlRZUEVfTlVNQkVSKSkpKSkpKTsKCiAgICAgICAgICAgIGNhc2Ug\nSkpUTE9DQVRFOgogICAgICAgICAgICAgICAgLy8gYXMgd2l0aCBTVUJTVFJJ\nTkcgKGFib3ZlKSwgdGhlIHNlbWFudGljcyBmb3IgTE9DQVRFIGRpZmZlcgog\nICAgICAgICAgICAgICAgLy8gZnJvbSBFeHByZXNzaW9uRmFjdG9yeS5pbmRl\neE9mIGluIHRoYXQgTE9DQVRFIHVzZXMgYQogICAgICAgICAgICAgICAgLy8g\nMC1iYXNlZCBpbmRleCwgYW5kIGluZGV4T2YgdXNlcyBhIDEtYmFzZWQgaW5k\nZXgKICAgICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZVBhdGggPSBnZXRWYWx1\nZShmaXJzdENoaWxkKG5vZGUpKTsKICAgICAgICAgICAgICAgIFZhbHVlIGxv\nY2F0ZVNlYXJjaCA9IGdldFZhbHVlKHNlY29uZENoaWxkKG5vZGUpKTsKICAg\nICAgICAgICAgICAgIFZhbHVlIGxvY2F0ZUZyb21JbmRleCA9IG51bGw7CiAg\nICAgICAgICAgICAgICBpZiAobm9kZS5nZXRDaGlsZENvdW50KCkgPiAyKSAv\nLyBvcHRpb25hbCBzdGFydCBpbmRleCBhcmcKICAgICAgICAgICAgICAgICAg\nICBsb2NhdGVGcm9tSW5kZXggPSBnZXRWYWx1ZSh0aGlyZENoaWxkKG5vZGUp\nKTsKCiAgICAgICAgICAgICAgICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlUGF0\naCwgVFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgc2V0SW1wbGljaXRU\neXBlKGxvY2F0ZVNlYXJjaCwgVFlQRV9TVFJJTkcpOwoKICAgICAgICAgICAg\nICAgIGlmIChsb2NhdGVGcm9tSW5kZXggIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBzZXRJbXBsaWNpdFR5cGUobG9jYXRlRnJvbUluZGV4LCBUWVBF\nX1NUUklORyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWRk\nKGZhY3RvcnkuaW5kZXhPZihsb2NhdGVTZWFyY2gsCiAgICAgICAgICAgICAg\nICAgICAgbG9jYXRlRnJvbUluZGV4ID09IG51bGwgPyBsb2NhdGVQYXRoCiAg\nICAgICAgICAgICAgICAgICAgICAgIDogZmFjdG9yeS5uZXdBcmd1bWVudExp\nc3QobG9jYXRlUGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgZmFjdG9y\neS5zdWJ0cmFjdChsb2NhdGVGcm9tSW5kZXgsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmYWN0b3J5Lm5ld0xpdGVyYWwoTnVtYmVycy52YWx1ZU9m\nKDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpdGVyYWwu\nVFlQRV9OVU1CRVIpKSkpLAogICAgICAgICAgICAgICAgICAgIGZhY3Rvcnku\nbmV3TGl0ZXJhbChOdW1iZXJzLnZhbHVlT2YoMSksCiAgICAgICAgICAgICAg\nICAgICAgICAgIExpdGVyYWwuVFlQRV9OVU1CRVIpKTsKCiAgICAgICAgICAg\nIGNhc2UgSkpUQUdHUkVHQVRFOgogICAgICAgICAgICAgICAgLy8gc2ltcGx5\nIHBhc3MtdGhyb3VnaCB3aGlsZSBhc3NlcnRpbmcgYSBzaW5nbGUgY2hpbGQK\nICAgICAgICAgICAgICAgIHJldHVybiBldmFsKG9ubHlDaGlsZChub2RlKSk7\nCgogICAgICAgICAgICBjYXNlIEpKVENPVU5UOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhY3RvcnkuY291bnQoZ2V0VmFsdWUobGFzdENoaWxkKG5vZGUp\nKSk7CgogICAgICAgICAgICBjYXNlIEpKVE1BWDoKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWN0b3J5Lm1heChnZXROdW1iZXJWYWx1ZShvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUTUlOOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkubWluKGdldE51bWJlclZhbHVlKG9ubHlD\naGlsZChub2RlKSkpOwoKICAgICAgICAgICAgY2FzZSBKSlRTVU06CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5zdW0oZ2V0TnVtYmVyVmFsdWUo\nb25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNlIEpKVEFWRVJB\nR0U6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5hdmcoZ2V0TnVt\nYmVyVmFsdWUob25seUNoaWxkKG5vZGUpKSk7CgogICAgICAgICAgICBjYXNl\nIEpKVERJU1RJTkNUUEFUSDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWN0\nb3J5LmRpc3RpbmN0KGdldFZhbHVlKG9ubHlDaGlsZChub2RlKSkpOwoKICAg\nICAgICAgICAgY2FzZSBKSlRFWElTVFM6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFjdG9yeS5pc05vdEVtcHR5KChWYWx1ZSkgZXZhbChvbmx5Q2hpbGQo\nbm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQU5ZOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhY3RvcnkuYW55KChWYWx1ZSkgZXZhbChvbmx5Q2hp\nbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQUxMOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhY3RvcnkuYWxsKChWYWx1ZSkgZXZhbChvbmx5\nQ2hpbGQobm9kZSkpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUU1VCU0VMRUNU\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFN1YnF1ZXJ5KG5vZGUpOwoK\nICAgICAgICAgICAgY2FzZSBKSlRNRU1CRVJPRjoKICAgICAgICAgICAgICAg\nIHZhbDEgPSBnZXRWYWx1ZShsZWZ0KG5vZGUpLCBWQVJfUEFUSCk7CiAgICAg\nICAgICAgICAgICB2YWwyID0gZ2V0VmFsdWUocmlnaHQobm9kZSksIFZBUl9Q\nQVRIKTsKICAgICAgICAgICAgICAgIHNldEltcGxpY2l0Q29udGFpbnNUeXBl\ncyh2YWwyLCB2YWwxLCBDT05UQUlOU19UWVBFX0VMRU1FTlQpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGV2YWxOb3Qobm90LCBmYWN0b3J5LmNvbnRhaW5z\nKHZhbDIsIHZhbDEpKTsKCiAgICAgICAgICAgIGNhc2UgSkpUQ1VSUkVOVERB\nVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5nZXRDdXJyZW50\nRGF0ZSgpOwoKICAgICAgICAgICAgY2FzZSBKSlRDVVJSRU5UVElNRToKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEN1cnJlbnRUaW1lKCk7\nCgogICAgICAgICAgICBjYXNlIEpKVENVUlJFTlRUSU1FU1RBTVA6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5nZXRDdXJyZW50VGltZXN0YW1w\nKCk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfRkFUQUwsICJiYWQtdHJlZSIsCiAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlIH0sIG51bGwpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRJbXBsaWNp\ndFR5cGVzKFZhbHVlIHZhbDEsIFZhbHVlIHZhbDIsIENsYXNzIGV4cGVjdGVk\nKSB7CiAgICAgICAgc3VwZXIuc2V0SW1wbGljaXRUeXBlcyh2YWwxLCB2YWwy\nLCBleHBlY3RlZCk7CgogICAgICAgIC8vIGFzIHdlbGwgYXMgc2V0dGluZyB0\naGUgdHlwZXMgZm9yIGNvbnZlcnNpb25zLCB3ZSBhbHNvIG5lZWQgdG8KICAg\nICAgICAvLyBlbnN1cmUgdGhhdCBhbnkgcGFyYW1ldGVycyBhcmUgZGVjbGFy\nZWQgd2l0aCB0aGUgY29ycmVjdCB0eXBlLAogICAgICAgIC8vIHNpbmNlIHRo\nZSBKUEEgc3BlYyBleHBlY3RzIHRoYXQgdGhlc2Ugd2lsbCBiZSB2YWxpZGF0\nZWQKICAgICAgICBQYXJhbWV0ZXIgcGFyYW0gPSB2YWwxIGluc3RhbmNlb2Yg\nUGFyYW1ldGVyID8gKFBhcmFtZXRlcikgdmFsMQogICAgICAgICAgICA6IHZh\nbDIgaW5zdGFuY2VvZiBQYXJhbWV0ZXIgPyAoUGFyYW1ldGVyKSB2YWwyIDog\nbnVsbDsKICAgICAgICBQYXRoIHBhdGggPSB2YWwxIGluc3RhbmNlb2YgUGF0\naCA/IChQYXRoKSB2YWwxCiAgICAgICAgICAgIDogdmFsMiBpbnN0YW5jZW9m\nIFBhdGggPyAoUGF0aCkgdmFsMiA6IG51bGw7CgogICAgICAgIC8vIHdlIG9u\nbHkgY2hlY2sgZm9yIHBhcmFtZXRlci10by1wYXRoIGNvbXBhcmlzb25zCiAg\nICAgICAgaWYgKHBhcmFtID09IG51bGwgfHwgcGF0aCA9PSBudWxsIHx8IHBh\ncmFtZXRlclR5cGVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXRoLmxhc3QoKTsKICAgICAg\nICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXRUeXBlKCk7CiAgICAgICAgaWYgKHR5\ncGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBTdHJp\nbmcgcGFyYW1OYW1lID0gcGFyYW0uZ2V0UGFyYW1ldGVyTmFtZSgpOwogICAg\nICAgIGlmIChwYXJhbU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSBhbHJlYWR5IGRlY2xh\ncmVkIHRoZSBwYXJhbWV0ZXIKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMu\nY29udGFpbnNLZXkocGFyYW1OYW1lKSkKICAgICAgICAgICAgcGFyYW1ldGVy\nVHlwZXMucHV0KHBhcmFtTmFtZSwgdHlwZSk7CiAgICB9CgogICAgcHJpdmF0\nZSBWYWx1ZSBnZXRTdHJpbmdWYWx1ZShKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgcmV0dXJuIGdldFR5cGVWYWx1ZShub2RlLCBUWVBFX1NUUklORyk7CiAg\nICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXROdW1iZXJWYWx1ZShKUFFMTm9k\nZSBub2RlKSB7CiAgICAgICAgcmV0dXJuIGdldFR5cGVWYWx1ZShub2RlLCBU\nWVBFX05VTUJFUik7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRUeXBl\nVmFsdWUoSlBRTE5vZGUgbm9kZSwgQ2xhc3MgaW1wbGljaXRUeXBlKSB7CiAg\nICAgICAgVmFsdWUgdmFsID0gZ2V0VmFsdWUobm9kZSk7CiAgICAgICAgc2V0\nSW1wbGljaXRUeXBlKHZhbCwgaW1wbGljaXRUeXBlKTsKICAgICAgICByZXR1\ncm4gdmFsOwogICAgfQoKICAgIHByaXZhdGUgVmFsdWUgZ2V0U3VicXVlcnko\nSlBRTE5vZGUgbm9kZSkgewogICAgICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xh\nc3NlcyA9IHRydWU7CiAgICAgICAgU3RyaW5nIGFsaWFzID0gbmV4dEFsaWFz\nKCk7CgogICAgICAgIC8vIHBhcnNlIHRoZSBzdWJxdWVyeQogICAgICAgIFBh\ncnNlZEpQUUwgcGFyc2VkID0gbmV3IFBhcnNlZEpQUUwobm9kZS5wYXJzZXIu\nanBxbCwgbm9kZSk7CgogICAgICAgIENsYXNzTWV0YURhdGEgY2FuZGlkYXRl\nID0gZ2V0Q2FuZGlkYXRlTWV0YURhdGEobm9kZSk7CiAgICAgICAgU3VicXVl\ncnkgc3VicSA9IGZhY3RvcnkubmV3U3VicXVlcnkoY2FuZGlkYXRlLCBzdWJj\nbGFzc2VzLCBhbGlhcyk7CiAgICAgICAgc3VicS5zZXRNZXRhRGF0YShjYW5k\naWRhdGUpOwoKICAgICAgICBjb250ZXh0cy5wdXNoKG5ldyBDb250ZXh0KHBh\ncnNlZCwgc3VicSkpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBRdWVy\neUV4cHJlc3Npb25zIHN1YmV4cCA9IGdldFF1ZXJ5RXhwcmVzc2lvbnMoKTsK\nICAgICAgICAgICAgc3VicS5zZXRRdWVyeUV4cHJlc3Npb25zKHN1YmV4cCk7\nCiAgICAgICAgICAgIHJldHVybiBzdWJxOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIC8vIHJlbW92ZSB0aGUgc3VicXVlcnkgcGFyc2UgY29u\ndGV4dAogICAgICAgICAgICBjb250ZXh0cy5wb3AoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIG5hbWVzIGFuZCBvcmRl\nciBvZiBpbXBsaWNpdCBwYXJhbWV0ZXJzLgogICAgICovCiAgICBwcml2YXRl\nIFBhcmFtZXRlciBnZXRQYXJhbWV0ZXIoU3RyaW5nIGlkLCBib29sZWFuIHBv\nc2l0aW9uYWwpIHsKICAgICAgICBpZiAocGFyYW1ldGVyVHlwZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXMgPSBuZXcgTGlua2VkTWFw\nKDYpOwogICAgICAgIGlmICghcGFyYW1ldGVyVHlwZXMuY29udGFpbnNLZXko\naWQpKQogICAgICAgICAgICBwYXJhbWV0ZXJUeXBlcy5wdXQoaWQsIFRZUEVf\nT0JKRUNUKTsKCiAgICAgICAgQ2xhc3MgdHlwZSA9IE9iamVjdC5jbGFzczsK\nICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBudWxsOwogICAgICAgIGlu\ndCBpbmRleDsKCiAgICAgICAgaWYgKHBvc2l0aW9uYWwpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGluZGV4ZXMgaW4gSlBRTCBh\ncmUgMS1iYXNlZCwgYXMgb3Bwb3NlZCB0byAwLWJhc2VkIGluCiAgICAgICAg\nICAgICAgICAvLyB0aGUgY29yZSBFeHByZXNzaW9uRmFjdG9yeQogICAgICAg\nICAgICAgICAgaW5kZXggPSBJbnRlZ2VyLnBhcnNlSW50KGlkKSAtIDE7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VS\nLCAiYmFkLXBvc2l0aW9uYWwtcGFyYW1ldGVyIiwKICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W117IGlkIH0sIGUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoaW5kZXggPCAwKQogICAgICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgImJhZC1wb3NpdGlvbmFsLXBh\ncmFtZXRlciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBp\nZCB9LCBudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBv\ndGhlcndpc2UgdGhlIGluZGV4IGlzIGp1c3QgdGhlIGN1cnJlbnQgc2l6ZSBv\nZiB0aGUgcGFyYW1zCiAgICAgICAgICAgIGluZGV4ID0gcGFyYW1ldGVyVHlw\nZXMuaW5kZXhPZihpZCk7CiAgICAgICAgfQoKICAgICAgICBQYXJhbWV0ZXIg\ncGFyYW0gPSBmYWN0b3J5Lm5ld1BhcmFtZXRlcihpZCwgdHlwZSk7CiAgICAg\nICAgcGFyYW0uc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgcGFyYW0uc2V0\nSW5kZXgoaW5kZXgpOwoKICAgICAgICByZXR1cm4gcGFyYW07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDaGVja3MgdG8gc2VlIGlmIHdlIHNob3VsZCBldmFs\ndWF0ZSBmb3IgYSBOT1QgZXhwcmVzc2lvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBFeHByZXNzaW9uIGV2YWxOb3QoYm9vbGVhbiBub3QsIEV4cHJlc3Npb24g\nZXhwKSB7CiAgICAgICAgcmV0dXJuIG5vdCA/IGZhY3Rvcnkubm90KGV4cCkg\nOiBleHA7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmltIG9mZiBsZWFkaW5n\nIGFuZCB0cmFpbGluZyBzaW5nbGUtcXVvdGVzLCBhbmQgdGhlbgogICAgICog\ncmVwbGFjZSBhbnkgaW50ZXJuYWwgJycgaW5zdGFuY2VzIHdpdGggJyAoc2lu\nY2UgcmVwZWF0aW5nIHRoZQogICAgICogcXVvdGUgaXMgdGhlIEpQUUwgbWVj\naGFuaXNtIG9mIGVzY2FwaW5nIGEgc2luZ2xlIHF1b3RlKS4KICAgICAqLwog\nICAgcHJpdmF0ZSBTdHJpbmcgdHJpbVF1b3RlcyhTdHJpbmcgc3RyKSB7CiAg\nICAgICAgaWYgKHN0ciA9PSBudWxsIHx8IHN0ci5sZW5ndGgoKSA8PSAxKQog\nICAgICAgICAgICByZXR1cm4gc3RyOwoKICAgICAgICBpZiAoc3RyLnN0YXJ0\nc1dpdGgoIiciKSAmJiBzdHIuZW5kc1dpdGgoIiciKSkKICAgICAgICAgICAg\nc3RyID0gc3RyLnN1YnN0cmluZygxLCBzdHIubGVuZ3RoKCkgLSAxKTsKCiAg\nICAgICAgaW50IGluZGV4ID0gLTE7CgogICAgICAgIHdoaWxlICgoaW5kZXgg\nPSBzdHIuaW5kZXhPZigiJyciLCBpbmRleCArIDEpKSAhPSAtMSkKICAgICAg\nICAgICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCBpbmRleCArIDEpICsgc3Ry\nLnN1YnN0cmluZyhpbmRleCArIDIpOwoKICAgICAgICByZXR1cm4gc3RyOwog\nICAgfQoKICAgIC8qKgogICAgICogQW4gSW50ZWdlckxpdGVyYWwgYW5kIERl\nY2ltYWxMaXRlcmFsIG5vZGUgd2lsbAogICAgICogaGF2ZSBhIGNoaWxkIG5v\nZGUgb2YgTmVnYXRpdmUgaWYgaXQgaXMgbmVnYXRpdmU6CiAgICAgKiBpZiBz\nbywgdGhpcyBtZXRob2QgcmV0dXJucyAtMSwgZWxzZSBpdCByZXR1cm5zIDEu\nCiAgICAgKi8KICAgIHByaXZhdGUgc2hvcnQgbmVnYXRpdmUoSlBRTE5vZGUg\nbm9kZSkgewogICAgICAgIGlmIChub2RlLmNoaWxkcmVuICE9IG51bGwgJiYg\nbm9kZS5jaGlsZHJlbi5sZW5ndGggPT0gMQogICAgICAgICAgICAmJiBmaXJz\ndENoaWxkKG5vZGUpLmlkID09IEpKVE5FR0FUSVZFKQogICAgICAgICAgICBy\nZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMTsK\nICAgIH0KCiAgICBwcml2YXRlIFZhbHVlIGdldElkZW50aWZpZXIoSlBRTE5v\nZGUgbm9kZSkgewogICAgICAgIGZpbmFsIFN0cmluZyBuYW1lID0gbm9kZS50\nZXh0OwogICAgICAgIGZpbmFsIFZhbHVlIHZhbCA9IGdldFZhcmlhYmxlKG5h\nbWUsIGZhbHNlKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRN\nZXRhRGF0YUZvckFsaWFzKG5hbWUpOwoKICAgICAgICBpZiAoY21kICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRo\nZSBjbGFzcyBuYW1lIGlzIHRoZSBhbGlhcwogICAgICAgICAgICAvLyBmb3Ig\ndGhlIGNhbmRpZGF0ZSAod2UgZG9uJ3QgdXNlIHZhcmlhYmxlcyBmb3IgdGhp\ncykKICAgICAgICAgICAgVmFsdWUgdGhpeiA9IGZhY3RvcnkuZ2V0VGhpcygp\nOwogICAgICAgICAgICB0aGl6LnNldE1ldGFEYXRhKGNtZCk7CiAgICAgICAg\nICAgIHJldHVybiB0aGl6OwogICAgICAgIH0gZWxzZSBpZiAodmFsIGluc3Rh\nbmNlb2YgUGF0aCkgewogICAgICAgICAgICByZXR1cm4gKFBhdGgpIHZhbDsK\nICAgICAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFZhbHVlKSB7CiAg\nICAgICAgICAgIHJldHVybiAoVmFsdWUpIHZhbDsKICAgICAgICB9CgogICAg\nICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ1bmtub3duLWlk\nZW50aWZpZXIiLAogICAgICAgICAgICBuZXcgT2JqZWN0W117IG5hbWUgfSwg\nbnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRQYXRoT3JDb25z\ndGFudChKUFFMTm9kZSBub2RlKSB7CiAgICAgICAgLy8gZmlyc3QgY2hlY2sg\ndG8gc2VlIGlmIHRoZSBwYXRoIGlzIGFuIGVudW0gb3Igc3RhdGljIGZpZWxk\nLCBhbmQKICAgICAgICAvLyBpZiBzbywgbG9hZCBpdAogICAgICAgIFN0cmlu\nZyBjbGFzc05hbWUgPSBhc3NlbWJsZShub2RlLCAiLiIsIDEpOwogICAgICAg\nIENsYXNzIGMgPSByZXNvbHZlci5jbGFzc0Zvck5hbWUoY2xhc3NOYW1lLCBu\ndWxsKTsKICAgICAgICBpZiAoYyAhPSBudWxsKSB7CiAgICAgICAgICAgIFN0\ncmluZyBmaWVsZE5hbWUgPSBsYXN0Q2hpbGQobm9kZSkudGV4dDsKCiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBGaWVsZCBmaWVsZCA9IGMu\nZ2V0RmllbGQoZmllbGROYW1lKTsKICAgICAgICAgICAgICAgIE9iamVjdCB2\nYWx1ZSA9IGZpZWxkLmdldChudWxsKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWN0b3J5Lm5ld0xpdGVyYWwodmFsdWUsIExpdGVyYWwuVFlQRV9VTktO\nT1dOKTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoRmllbGRFeGNlcHRp\nb24gbnNmZSkgewogICAgICAgICAgICAgICAgdGhyb3cgcGFyc2VFeGNlcHRp\nb24oRVhfVVNFUiwgIm5vLWZpZWxkIiwKICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IGNsYXNzTmFtZSwgZmllbGROYW1lIH0sIG5zZmUpOwog\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInVuYWNjZXNz\naWJsZS1maWVsZCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\neyBjbGFzc05hbWUsIGZpZWxkTmFtZSB9LCBlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRQYXRoKG5v\nZGUsIGZhbHNlLCB0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBQYXRoIGdldFBhdGgoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVy\nbiBnZXRQYXRoKG5vZGUsIGZhbHNlLCB0cnVlKTsKICAgIH0KCiAgICBwcml2\nYXRlIFBhdGggZ2V0UGF0aChKUFFMTm9kZSBub2RlLCBib29sZWFuIHBjT25s\neSwgYm9vbGVhbiBpbm5lcikgewogICAgICAgIC8vIHJlc29sdmUgdGhlIGZp\ncnN0IGVsZW1lbnQgYWdhaW5zdCB0aGUgYWxpYXNlcyBtYXAgLi4uCiAgICAg\nICAgLy8gaS5lLiwgdGhlIHBhdGggIlNFTEVDVCB4LmlkIEZST00gU29tZUNs\nYXNzIHggd2hlcmUgeC5pZCA+IDEwIgogICAgICAgIC8vIHdpbGwgbmVlZCB0\nbyBoYXZlICJ4IiBpbiB0aGUgYWxpYXMgbWFwIGluIG9yZGVyIHRvIHJlc29s\ndmUKICAgICAgICBQYXRoIHBhdGg7CgogICAgICAgIGZpbmFsIFN0cmluZyBu\nYW1lID0gZmlyc3RDaGlsZChub2RlKS50ZXh0OwogICAgICAgIGZpbmFsIFZh\nbHVlIHZhbCA9IGdldFZhcmlhYmxlKG5hbWUsIGZhbHNlKTsKCiAgICAgICAg\nLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBjbGFzcyBuYW1lIGlzIHRo\nZSBhbGlhcwogICAgICAgIC8vIGZvciB0aGUgY2FuZGlkYXRlICh3ZSBkb24n\ndCB1c2UgdmFyaWFibGVzIGZvciB0aGlzKQogICAgICAgIGlmIChuYW1lLmVx\ndWFsc0lnbm9yZUNhc2UoY3R4KCkuc2NoZW1hQWxpYXMpKSB7CiAgICAgICAg\nICAgIGlmIChjdHgoKS5zdWJxdWVyeSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBwYXRoID0gZmFjdG9yeS5uZXdQYXRoKGN0eCgpLnN1YnF1ZXJ5KTsK\nICAgICAgICAgICAgICAgIHBhdGguc2V0TWV0YURhdGEoY3R4KCkuc3VicXVl\ncnkuZ2V0TWV0YURhdGEoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBwYXRoID0gZmFjdG9yeS5uZXdQYXRoKCk7CiAgICAgICAg\nICAgICAgICBwYXRoLnNldE1ldGFEYXRhKGN0eCgpLm1ldGEpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChnZXRNZXRhRGF0YUZvckFsaWFz\nKG5hbWUpICE9IG51bGwpCiAgICAgICAgICAgIHBhdGggPSBuZXdQYXRoKG51\nbGwsIGdldE1ldGFEYXRhRm9yQWxpYXMobmFtZSkpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIFBhdGgpCiAgICAgICAgICAgIHBhdGggPSAo\nUGF0aCkgdmFsOwogICAgICAgIGVsc2UgaWYgKHZhbC5nZXRNZXRhRGF0YSgp\nICE9IG51bGwpCiAgICAgICAgICAgIHBhdGggPSBuZXdQYXRoKHZhbCwgdmFs\nLmdldE1ldGFEYXRhKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhy\nb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgInBhdGgtbm8tbWV0YSIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IGFzc2VtYmxlKG5vZGUpLCBu\ndWxsIH0sIG51bGwpOwoKICAgICAgICAvLyB3YWxrIHRocm91Z2ggdGhlIGNo\naWxkcmVuIGFuZCBhc3NlbWJsZSB0aGUgcGF0aAogICAgICAgIGJvb2xlYW4g\nYWxsb3dOdWxsID0gIWlubmVyOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBp\nIDwgbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBw\nYXRoID0gKFBhdGgpIHRyYXZlcnNlUGF0aChwYXRoLCBub2RlLmNoaWxkcmVu\nW2ldLnRleHQsIHBjT25seSwKICAgICAgICAgICAgICAgIGFsbG93TnVsbCk7\nCgogICAgICAgICAgICAvLyBhbGwgdHJhdmVyc2FscyBidXQgdGhlIGZpcnN0\nIG9uZSB3aWxsIGFsd2F5cyBiZSBpbm5lciBqb2lucwogICAgICAgICAgICBh\nbGxvd051bGwgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBw\nYXRoOwogICAgfQoKICAgIHByb3RlY3RlZCBDbGFzcyBnZXREZWNsYXJlZFZh\ncmlhYmxlVHlwZShTdHJpbmcgbmFtZSkgewogICAgICAgIENsYXNzTWV0YURh\ndGEgY21kID0gZ2V0TWV0YURhdGFGb3JBbGlhcyhuYW1lKTsKICAgICAgICBp\nZiAoY21kICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjbWQuZ2V0RGVz\nY3JpYmVkVHlwZSgpOwoKICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIG5h\nbWUuZXF1YWxzKGN0eCgpLnNjaGVtYUFsaWFzKSkKICAgICAgICAgICAgcmV0\ndXJuIGdldENhbmRpZGF0ZVR5cGUoKTsKCiAgICAgICAgLy8gSlBRTCBoYXMg\nbm8gZGVjbGFyZWQgdmFyaWFibGVzCiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIEV4cHJlc3Npb24gZm9y\nIHRoZSBnaXZlbiBub2RlIGJ5IGV2YWwnaW5nIGl0LgogICAgICovCiAgICBw\ncml2YXRlIEV4cHJlc3Npb24gZ2V0RXhwcmVzc2lvbihKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgT2JqZWN0IGV4cCA9IGV2YWwobm9kZSk7CgogICAgICAg\nIC8vIGNoZWNrIGZvciBib29sZWFuIHZhbHVlcyB1c2VkIGFzIGV4cHJlc3Np\nb25zCiAgICAgICAgaWYgKCEoZXhwIGluc3RhbmNlb2YgRXhwcmVzc2lvbikp\nCiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmFzRXhwcmVzc2lvbigoVmFs\ndWUpIGV4cCk7CiAgICAgICAgcmV0dXJuIChFeHByZXNzaW9uKSBleHA7CiAg\nICB9CgogICAgcHJpdmF0ZSBWYWx1ZSBnZXRWYWx1ZShKUFFMTm9kZSBub2Rl\nKSB7CiAgICAgICAgcmV0dXJuIGdldFZhbHVlKG5vZGUsIFZBUl9QQVRIKTsK\nICAgIH0KCiAgICBwcml2YXRlIFBhdGggbmV3UGF0aChWYWx1ZSB2YWwsIENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIFBhdGggcGF0aCA9IHZhbCA9\nPSBudWxsID8gZmFjdG9yeS5uZXdQYXRoKCkgOiBmYWN0b3J5Lm5ld1BhdGgo\ndmFsKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICBw\nYXRoLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgIHJldHVybiBwYXRoOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIFZhbHVlIGZvciB0aGUg\nZ2l2ZW4gbm9kZSBieSBldmFsJ2luZyBpdC4KICAgICAqLwogICAgcHJpdmF0\nZSBWYWx1ZSBnZXRWYWx1ZShKUFFMTm9kZSBub2RlLCBpbnQgaGFuZGxlVmFy\nKSB7CiAgICAgICAgVmFsdWUgdmFsID0gKFZhbHVlKSBldmFsKG5vZGUpOwoK\nICAgICAgICAvLyBkZXRlcm1pbmQgaG93IHRvIGV2YXVhdGUgYSB2YXJpYWJl\nCiAgICAgICAgaWYgKCF2YWwuaXNWYXJpYWJsZSgpKQogICAgICAgICAgICBy\nZXR1cm4gdmFsOwogICAgICAgIGVsc2UgaWYgKGhhbmRsZVZhciA9PSBWQVJf\nUEFUSCAmJiAhKHZhbCBpbnN0YW5jZW9mIFBhdGgpKQogICAgICAgICAgICBy\nZXR1cm4gbmV3UGF0aCh2YWwsIHZhbC5nZXRNZXRhRGF0YSgpKTsKICAgICAg\nICBlbHNlIGlmIChoYW5kbGVWYXIgPT0gVkFSX0VSUk9SKQogICAgICAgICAg\nICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAidW5leHBlY3RlZC12\nYXIiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBub2RlLnRleHQg\nfSwgbnVsbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdmFs\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIFBhcnNlIENvbnRleHQgTWFuYWdlbWVudAogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIHByaXZhdGUgQ29udGV4dCBjdHgoKSB7\nCiAgICAgICAgcmV0dXJuIChDb250ZXh0KSBjb250ZXh0cy5wZWVrKCk7CiAg\nICB9CgogICAgcHJpdmF0ZSBKUFFMTm9kZSByb290KCkgewogICAgICAgIHJl\ndHVybiBjdHgoKS5wYXJzZWQucm9vdDsKICAgIH0KCiAgICBwcml2YXRlIENs\nYXNzTWV0YURhdGEgZ2V0TWV0YURhdGFGb3JBbGlhcyhTdHJpbmcgYWxpYXMp\nIHsKICAgICAgICBmb3IgKGludCBpID0gY29udGV4dHMuc2l6ZSgpIC0gMTsg\naSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgQ29udGV4dCBjb250ZXh0ID0g\nKENvbnRleHQpIGNvbnRleHRzLmdldChpKTsKICAgICAgICAgICAgaWYgKGFs\naWFzLmVxdWFsc0lnbm9yZUNhc2UoY29udGV4dC5zY2hlbWFBbGlhcykpCiAg\nICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5tZXRhOwogICAgICAgIH0K\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHJpdmF0ZSBjbGFz\ncyBDb250ZXh0IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBQYXJzZWRKUFFM\nIHBhcnNlZDsKICAgICAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgbWV0YTsK\nICAgICAgICBwcml2YXRlIFN0cmluZyBzY2hlbWFBbGlhczsKICAgICAgICBw\ncml2YXRlIFN1YnF1ZXJ5IHN1YnF1ZXJ5OwoKICAgICAgICBDb250ZXh0KFBh\ncnNlZEpQUUwgcGFyc2VkLCBTdWJxdWVyeSBzdWJxdWVyeSkgewogICAgICAg\nICAgICB0aGlzLnBhcnNlZCA9IHBhcnNlZDsKICAgICAgICAgICAgdGhpcy5z\ndWJxdWVyeSA9IHN1YnF1ZXJ5OwogICAgICAgIH0KICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBOb2RlIHRyYXZlcnNh\nbCB1dGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwcml2YXRlIEpQUUxOb2RlIG9ubHlDaGlsZChKUFFMTm9kZSBub2Rl\nKQogICAgICAgIHRocm93cyBVc2VyRXhjZXB0aW9uIHsKICAgICAgICBKUFFM\nTm9kZSBjaGlsZCA9IGZpcnN0Q2hpbGQobm9kZSk7CgogICAgICAgIGlmIChu\nb2RlLmNoaWxkcmVuLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX1VTRVIsICJtdWx0aS1jaGlsZHJlbiIsCiAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IG5vZGUsIEFycmF5cy5hc0xpc3Qo\nbm9kZS5jaGlsZHJlbikgfSwgbnVsbCk7CgogICAgICAgIHJldHVybiBjaGls\nZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGxlZnQgbm9k\nZSAodGhlIGZpcnN0IG9mIHRoZSBjaGlsZHJlbiksIGFuZCBhc3NlcnRzCiAg\nICAgKiB0aGF0IHRoZXJlIGFyZSBleGFjdGx5IHR3byBjaGlsZHJlbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBKUFFMTm9kZSBsZWZ0KEpQUUxOb2RlIG5vZGUp\nIHsKICAgICAgICByZXR1cm4gY2hpbGQobm9kZSwgMCwgMik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSByaWdodCBub2RlICh0aGUgc2Vj\nb25kIG9mIHRoZSBjaGlsZHJlbiksIGFuZCBhc3NlcnRzCiAgICAgKiB0aGF0\nIHRoZXJlIGFyZSBleGFjdGx5IHR3byBjaGlsZHJlbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBKUFFMTm9kZSByaWdodChKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgcmV0dXJuIGNoaWxkKG5vZGUsIDEsIDIpOwogICAgfQoKICAgIHByaXZh\ndGUgSlBRTE5vZGUgY2hpbGQoSlBRTE5vZGUgbm9kZSwgaW50IGNoaWxkTnVt\nLCBpbnQgYXNzZXJ0Q291bnQpIHsKICAgICAgICBpZiAobm9kZS5jaGlsZHJl\nbi5sZW5ndGggIT0gYXNzZXJ0Q291bnQpCiAgICAgICAgICAgIHRocm93IHBh\ncnNlRXhjZXB0aW9uKEVYX1VTRVIsICJ3cm9uZy1jaGlsZC1jb3VudCIsCiAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IG5ldyBJbnRlZ2VyKGFzc2Vy\ndENvdW50KSwgbm9kZSwKICAgICAgICAgICAgICAgICAgICBBcnJheXMuYXNM\naXN0KG5vZGUuY2hpbGRyZW4pIH0sIG51bGwpOwoKICAgICAgICByZXR1cm4g\nbm9kZS5jaGlsZHJlbltjaGlsZE51bV07CiAgICB9CgogICAgcHJpdmF0ZSBK\nUFFMTm9kZSBmaXJzdENoaWxkKEpQUUxOb2RlIG5vZGUpIHsKICAgICAgICBp\nZiAobm9kZS5jaGlsZHJlbiA9PSBudWxsIHx8IG5vZGUuY2hpbGRyZW4ubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVY\nX1VTRVIsICJuby1jaGlsZHJlbiIsCiAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IG5vZGUgfSwgbnVsbCk7CiAgICAgICAgcmV0dXJuIG5vZGUuY2hp\nbGRyZW5bMF07CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgSlBRTE5vZGUg\nc2Vjb25kQ2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJldHVybiBu\nb2RlLmNoaWxkcmVuWzFdOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIEpQ\nUUxOb2RlIHRoaXJkQ2hpbGQoSlBRTE5vZGUgbm9kZSkgewogICAgICAgIHJl\ndHVybiBub2RlLmNoaWxkcmVuWzJdOwogICAgfQoKICAgIHByaXZhdGUgc3Rh\ndGljIEpQUUxOb2RlIGxhc3RDaGlsZChKUFFMTm9kZSBub2RlKSB7CiAgICAg\nICAgcmV0dXJuIGxhc3RDaGlsZChub2RlLCAwKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBOdGggZnJvbSB0aGUgbGFzdCBjaGlsZC4gRS5nLiwKICAg\nICAqIGxhc3RDaGlsZCgxKSB3aWxsIHJldHVybiB0aGUgc2Vjb25kLXRvLXRo\nZS1sYXN0IGNoaWxkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBKUFFM\nTm9kZSBsYXN0Q2hpbGQoSlBRTE5vZGUgbm9kZSwgaW50IGZyb21MYXN0KSB7\nCiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bbm9kZS5jaGlsZHJlbi5s\nZW5ndGggLSAoMSArIGZyb21MYXN0KV07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBCYXNlIG5vZGUgdGhhdCB3aWxsIGJlIGdlbmVyYXRlZCBieSB0aGUgSlBR\nTEV4cHJlc3Npb25CdWlsZGVyOyBiYXNlCiAgICAgKiBjbGFzcyBvZiB0aGUg\ne0BsaW5rIFNpbXBsZU5vZGV9IHRoYXQgaXMgdXNlZCBieSB7QGxpbmsgSlBR\nTH0uCiAgICAgKgogICAgICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgK\nICAgICAqIEBzZWUgTm9kZQogICAgICogQHNlZSBTaW1wbGVOb2RlCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBzdGF0aWMgY2xhc3MgSlBRTE5v\nZGUKICAgICAgICBpbXBsZW1lbnRzIE5vZGUsIFNlcmlhbGl6YWJsZSB7Cgog\nICAgICAgIGZpbmFsIGludCBpZDsKICAgICAgICBmaW5hbCBKUFFMIHBhcnNl\ncjsKICAgICAgICBKUFFMTm9kZSBwYXJlbnQ7CiAgICAgICAgSlBRTE5vZGVb\nXSBjaGlsZHJlbjsKICAgICAgICBTdHJpbmcgdGV4dDsKICAgICAgICBib29s\nZWFuIG5vdCA9IGZhbHNlOwoKICAgICAgICBwdWJsaWMgSlBRTE5vZGUoSlBR\nTCBwYXJzZXIsIGludCBpZCkgewogICAgICAgICAgICB0aGlzLmlkID0gaWQ7\nCiAgICAgICAgICAgIHRoaXMucGFyc2VyID0gcGFyc2VyOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgamp0T3BlbigpIHsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIGpqdENsb3NlKCkgewogICAgICAgIH0KCiAg\nICAgICAgSlBRTE5vZGVbXSBmaW5kQ2hpbGRyZW5CeUlEKGludCBpZCkgewog\nICAgICAgICAgICBDb2xsZWN0aW9uIHNldCA9IG5ldyBIYXNoU2V0KCk7CiAg\nICAgICAgICAgIGZpbmRDaGlsZHJlbkJ5SUQoaWQsIHNldCk7CiAgICAgICAg\nICAgIHJldHVybiAoSlBRTE5vZGVbXSkgc2V0LnRvQXJyYXkobmV3IEpQUUxO\nb2RlW3NldC5zaXplKCldKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\ndm9pZCBmaW5kQ2hpbGRyZW5CeUlEKGludCBpZCwgQ29sbGVjdGlvbiBzZXQp\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNoaWxkcmVuICE9IG51\nbGwgJiYgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBpZiAoY2hpbGRyZW5baV0uaWQgPT0gaWQpCiAgICAgICAgICAgICAg\nICAgICAgc2V0LmFkZChjaGlsZHJlbltpXSk7CgogICAgICAgICAgICAgICAg\nY2hpbGRyZW5baV0uZmluZENoaWxkcmVuQnlJRChpZCwgc2V0KTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBoYXNDaGlsZElE\nKGludCBpZCkgewogICAgICAgICAgICByZXR1cm4gZmluZENoaWxkQnlJRChp\nZCwgZmFsc2UpICE9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBKUFFMTm9k\nZSBmaW5kQ2hpbGRCeUlEKGludCBpZCwgYm9vbGVhbiByZWN1cnNlKSB7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBjaGlsZHJlbiAhPSBudWxsICYm\nIGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nSlBRTE5vZGUgY2hpbGQgPSBjaGlsZHJlbltpXTsKCiAgICAgICAgICAgICAg\nICBpZiAoY2hpbGQuaWQgPT0gaWQpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGNoaWxkcmVuW2ldOwoKICAgICAgICAgICAgICAgIGlmIChyZWN1cnNl\nKSB7CiAgICAgICAgICAgICAgICAgICAgSlBRTE5vZGUgZm91bmQgPSBjaGls\nZC5maW5kQ2hpbGRCeUlEKGlkLCByZWN1cnNlKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoZm91bmQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZvdW5kOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBub3QgZm91bmQKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBqanRT\nZXRQYXJlbnQoTm9kZSBwYXJlbnQpIHsKICAgICAgICAgICAgdGhpcy5wYXJl\nbnQgPSAoSlBRTE5vZGUpIHBhcmVudDsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBOb2RlIGpqdEdldFBhcmVudCgpIHsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXMucGFyZW50OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\namp0QWRkQ2hpbGQoTm9kZSBuLCBpbnQgaSkgewogICAgICAgICAgICBpZiAo\nY2hpbGRyZW4gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2hpbGRyZW4g\nPSBuZXcgSlBRTE5vZGVbaSArIDFdOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKGkgPj0gY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBKUFFM\nTm9kZSBjW10gPSBuZXcgSlBRTE5vZGVbaSArIDFdOwogICAgICAgICAgICAg\nICAgU3lzdGVtLmFycmF5Y29weShjaGlsZHJlbiwgMCwgYywgMCwgY2hpbGRy\nZW4ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGNoaWxkcmVuID0gYzsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgY2hpbGRyZW5baV0gPSAoSlBRTE5v\nZGUpIG47CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTm9kZSBqanRHZXRD\naGlsZChpbnQgaSkgewogICAgICAgICAgICByZXR1cm4gY2hpbGRyZW5baV07\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldENoaWxkQ291bnQo\nKSB7CiAgICAgICAgICAgIHJldHVybiBqanRHZXROdW1DaGlsZHJlbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpQUUxOb2RlIGdldENoaWxkKGlu\ndCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gKEpQUUxOb2RlKSBqanRH\nZXRDaGlsZChpbmRleCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSXRl\ncmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBBcnJheXMu\nYXNMaXN0KGNoaWxkcmVuKS5pdGVyYXRvcigpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBqanRHZXROdW1DaGlsZHJlbigpIHsKICAgICAgICAg\nICAgcmV0dXJuIChjaGlsZHJlbiA9PSBudWxsKSA/IDAgOiBjaGlsZHJlbi5s\nZW5ndGg7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHNldFRleHQoU3RyaW5n\nIHRleHQpIHsKICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgICAg\nICB9CgogICAgICAgIHZvaWQgc2V0VG9rZW4oVG9rZW4gdCkgewogICAgICAg\nICAgICBzZXRUZXh0KHQuaW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIEpQ\nUUxUcmVlQ29uc3RhbnRzLmpqdE5vZGVOYW1lW3RoaXMuaWRdOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZyhTdHJpbmcgcHJl\nZml4KSB7CiAgICAgICAgICAgIHJldHVybiBwcmVmaXggKyB0b1N0cmluZygp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVidWdnaW5n\nIG1ldGhvZC4KICAgICAgICAgKgogICAgICAgICAqIEBzZWUgI2R1bXAoamF2\nYS5pby5QcmludFN0cmVhbSxTdHJpbmcpCiAgICAgICAgICovCiAgICAgICAg\ncHVibGljIHZvaWQgZHVtcChTdHJpbmcgcHJlZml4KSB7CiAgICAgICAgICAg\nIGR1bXAoU3lzdGVtLm91dCwgcHJlZml4KTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGR1bXAoKSB7CiAgICAgICAgICAgIGR1bXAoIiAiKTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIERlYnVnZ2luZyBt\nZXRob2QgdG8gb3V0cHV0IGEgcGFyc2UgdHJlZS4KICAgICAgICAgKgogICAg\nICAgICAqIEBwYXJhbSBvdXQgdGhlIHN0cmVhbSB0byB3aGljaCB0byB3cml0\nZSB0aGUgZGVidWdnaW5nIGluZm8KICAgICAgICAgKiBAcGFyYW0gcHJlZml4\nIHRoZSBwcmVmaXggdG8gd3JpdGUgb3V0IGJlZm9yZSBsaW5lcwogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGR1bXAoUHJpbnRTdHJlYW0gb3V0\nLCBTdHJpbmcgcHJlZml4KSB7CiAgICAgICAgICAgIGR1bXAob3V0LCBwcmVm\naXgsIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGR1\nbXAoUHJpbnRTdHJlYW0gb3V0LCBTdHJpbmcgcHJlZml4LCBib29sZWFuIHRl\neHQpIHsKICAgICAgICAgICAgb3V0LnByaW50bG4odG9TdHJpbmcocHJlZml4\nKQogICAgICAgICAgICAgICAgKyAodGV4dCAmJiB0aGlzLnRleHQgIT0gbnVs\nbCA/ICIgWyIgKyB0aGlzLnRleHQgKyAiXSIgOiAiIikpOwogICAgICAgICAg\nICBpZiAoY2hpbGRyZW4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSkgewogICAg\nICAgICAgICAgICAgICAgIEpQUUxOb2RlIG4gPSAoSlBRTE5vZGUpIGNoaWxk\ncmVuW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChuICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbi5kdW1wKG91dCwgcHJlZml4ICsg\nIiAiLCB0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3Rh\ndGljIGNsYXNzIFBhcnNlZEpQUUwKICAgICAgICBpbXBsZW1lbnRzIFNlcmlh\nbGl6YWJsZSB7CgogICAgICAgIHByb3RlY3RlZCBmaW5hbCBKUFFMTm9kZSBy\nb290OwogICAgICAgIHByb3RlY3RlZCBmaW5hbCBTdHJpbmcgcXVlcnk7Cgog\nICAgICAgIFBhcnNlZEpQUUwoU3RyaW5nIGpwcWwpIHsKICAgICAgICAgICAg\ndGhpcyhqcHFsLCBwYXJzZShqcHFsKSk7CiAgICAgICAgfQoKICAgICAgICBQ\nYXJzZWRKUFFMKFN0cmluZyBxdWVyeSwgSlBRTE5vZGUgcm9vdCkgewogICAg\nICAgICAgICB0aGlzLnJvb3QgPSByb290OwogICAgICAgICAgICB0aGlzLnF1\nZXJ5ID0gcXVlcnk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBKUFFMTm9kZSBwYXJzZShTdHJpbmcganBxbCkgewogICAgICAg\nICAgICBpZiAoanBxbCA9PSBudWxsKQogICAgICAgICAgICAgICAganBxbCA9\nICIiOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVy\nbiAoSlBRTE5vZGUpIG5ldyBKUFFMKGpwcWwpLnBhcnNlUXVlcnkoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXJyb3IgZSkgewogICAgICAgICAgICAgICAg\nLy8gc3BlY2lhbCBoYW5kbGluZyBmb3IgRXJyb3Igc3ViY2xhc3Nlcywgd2hp\nY2ggdGhlCiAgICAgICAgICAgICAgICAvLyBwYXJzZXIgbWF5IHNvbWV0aW1l\ncyAodW5mb3J0dW5hdGVseSkgdGhyb3cKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYXJzZS1lcnJvciIsCiAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBlLnRvU3RyaW5nKCks\nIGpwcWwgfSkpOwogICAgICAgICAgICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgicGFyc2UtZXJyb3IiLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgZS50b1N0cmluZygpLCBqcHFsIH0pLCBlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdm9pZCBwb3B1bGF0ZShF\neHByZXNzaW9uU3RvcmVRdWVyeSBxdWVyeSkgewogICAgICAgICAgICBRdWVy\neUNvbnRleHQgY3R4ID0gcXVlcnkuZ2V0Q29udGV4dCgpOwoKICAgICAgICAg\nICAgLy8gaWYgdGhlIG93bmluZyBxdWVyeSdzIGNvbnRleHQgZG9lcyBub3Qg\naGF2ZQogICAgICAgICAgICAvLyBhbnkgY2FuZGlkYXRlIGNsYXNzLCB0aGVu\nIHNldCBpdCBoZXJlCiAgICAgICAgICAgIGlmIChjdHguZ2V0Q2FuZGlkYXRl\nVHlwZSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBjdHguc2V0Q2FuZGlk\nYXRlVHlwZShuZXcgSlBRTEV4cHJlc3Npb25CdWlsZGVyCiAgICAgICAgICAg\nICAgICAgICAgKG51bGwsIHF1ZXJ5LCB0aGlzKS5nZXRDYW5kaWRhdGVUeXBl\nKCksIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0\nb1N0cmluZyAoKQoJCXsKCQkJcmV0dXJuIHRoaXMucXVlcnk7CgkJfQoJfQp9\nCgo=\n","encoding":"base64"}

