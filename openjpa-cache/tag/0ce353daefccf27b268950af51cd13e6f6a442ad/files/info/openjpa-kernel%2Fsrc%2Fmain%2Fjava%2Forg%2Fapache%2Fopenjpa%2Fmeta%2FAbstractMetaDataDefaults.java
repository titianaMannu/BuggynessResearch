{"sha":"c562c7ae25466ebac3b0f6cab0dc54313b6495a4","node_id":"MDQ6QmxvYjIwNjM2NDpjNTYyYzdhZTI1NDY2ZWJhYzNiMGY2Y2FiMGRjNTQzMTNiNjQ5NWE0","size":12574,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c562c7ae25466ebac3b0f6cab0dc54313b6495a4","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhOwoKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZpZWxk\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2\nYS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJlZmxl\nY3QuTW9kaWZpZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QQ1JlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5s\nb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVy\nbmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVzZXJFeGNlcHRpb247CgovKioKICogQWJzdHJhY3QgbWV0YWRhdGEg\nZGVmYXVsdHMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMg\nYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RNZXRhRGF0YURlZmF1bHRzCiAgICBp\nbXBsZW1lbnRzIE1ldGFEYXRhRGVmYXVsdHMgewoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoQWJzdHJhY3RNZXRhRGF0YURlZmF1bHRzLmNsYXNzKTsK\nCiAgICBwcml2YXRlIGludCBfYWNjZXNzID0gQ2xhc3NNZXRhRGF0YS5BQ0NF\nU1NfRklFTEQ7CiAgICBwcml2YXRlIGludCBfaWRlbnRpdHkgPSBDbGFzc01l\ndGFEYXRhLklEX1VOS05PV047CiAgICBwcml2YXRlIGJvb2xlYW4gX2lnbm9y\nZSA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ludGVyZmFjZSA9IHRy\ndWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3BjUmVnaXN0cnkgPSB0cnVlOwog\nICAgcHJpdmF0ZSBpbnQgX2NhbGxiYWNrID0gQ0FMTEJBQ0tfUkVUSFJPVzsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfdW53cmFwcGVkID0gZmFsc2U7CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRvIGF0dGVtcHQgdG8gdXNlIHRoZSBpbmZv\ncm1hdGlvbiBmcm9tIHJlZ2lzdGVyZWQgY2xhc3NlcwogICAgICogdG8gcG9w\ndWxhdGUgbWV0YWRhdGEgZGVmYXVsdHMuIERlZmF1bHRzIHRvIHRydWUuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFVzZVBDUmVnaXN0cnkoKSB7\nCiAgICAgICAgcmV0dXJuIF9wY1JlZ2lzdHJ5OwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0byBhdHRlbXB0IHRvIHVzZSB0aGUgaW5mb3JtYXRp\nb24gZnJvbSByZWdpc3RlcmVkIGNsYXNzZXMKICAgICAqIHRvIHBvcHVsYXRl\nIG1ldGFkYXRhIGRlZmF1bHRzLiBEZWZhdWx0cyB0byB0cnVlLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRVc2VQQ1JlZ2lzdHJ5KGJvb2xlYW4gcGNS\nZWdpc3RyeSkgewogICAgICAgIF9wY1JlZ2lzdHJ5ID0gcGNSZWdpc3RyeTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IGFjY2VzcyB0eXBl\nIGZvciBiYXNlIGNsYXNzZXMgd2l0aCBBQ0NFU1NfVU5LTk9XTi4KICAgICAq\nIEFDQ0VTU19GSUVMRCBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldERlZmF1bHRBY2Nlc3NUeXBlKCkgewogICAgICAgIHJldHVybiBf\nYWNjZXNzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgYWNj\nZXNzIHR5cGUgZm9yIGJhc2UgY2xhc3NlcyB3aXRoIEFDQ0VTU19VTktOT1dO\nLgogICAgICogQUNDRVNTX0ZJRUxEIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldERlZmF1bHRBY2Nlc3NUeXBlKGludCBhY2Nlc3Mp\nIHsKICAgICAgICBfYWNjZXNzID0gYWNjZXNzOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIGRlZmF1bHQgaWRlbnRpdHkgdHlwZSBmb3IgdW5tYXBwZWQg\nY2xhc3NlcyB3aXRob3V0IHByaW1hcnkgCiAgICAgKiBrZXkgZmllbGRzLiBJ\nRF9VTktOT1dOIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0RGVmYXVsdElkZW50aXR5VHlwZSgpIHsKICAgICAgICByZXR1cm4gX2lk\nZW50aXR5OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgaWRl\nbnRpdHkgdHlwZSBmb3IgdW5tYXBwZWQgY2xhc3NlcyB3aXRob3V0IHByaW1h\ncnkgCiAgICAgKiBrZXkgZmllbGRzLiBJRF9VTktOT1dOIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERlZmF1bHRJZGVudGl0eVR5\ncGUoaW50IGlkZW50aXR5KSB7CiAgICAgICAgX2lkZW50aXR5ID0gaWRlbnRp\ndHk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDYWxsYmFja01vZGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9jYWxsYmFjazsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRDYWxsYmFja01vZGUoaW50IG1vZGUpIHsKICAgICAgICBfY2Fs\nbGJhY2sgPSBtb2RlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbGxi\nYWNrTW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChv\nbikKICAgICAgICAgICAgX2NhbGxiYWNrIHw9IG1vZGU7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBfY2FsbGJhY2sgJj0gfm1vZGU7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0Q2FsbGJhY2tzQmVmb3JlTGlzdGVuZXJzKGlu\ndCB0eXBlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzRGVjbGFyZWRJbnRlcmZhY2VQZXJzaXN0ZW50KCkg\newogICAgICAgIHJldHVybiBfaW50ZXJmYWNlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldERlY2xhcmVkSW50ZXJmYWNlUGVyc2lzdGVudChib29sZWFu\nIHBlcnMpIHsKICAgICAgICBfaW50ZXJmYWNlID0gcGVyczsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0RhdGFTdG9yZU9iamVjdElkRmllbGRVbndy\nYXBwZWQoKSB7CiAgICAgICAgcmV0dXJuIF91bndyYXBwZWQ7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0RGF0YVN0b3JlT2JqZWN0SWRGaWVsZFVud3Jh\ncHBlZChib29sZWFuIHVud3JhcHBlZCkgewogICAgICAgIF91bndyYXBwZWQg\nPSB1bndyYXBwZWQ7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdu\nb3JlTm9uUGVyc2lzdGVudCgpIHsKICAgICAgICByZXR1cm4gX2lnbm9yZTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25vcmVOb25QZXJzaXN0ZW50\nKGJvb2xlYW4gaWdub3JlKSB7CiAgICAgICAgX2lnbm9yZSA9IGlnbm9yZTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwb3B1bGF0ZShDbGFzc01ldGFEYXRh\nIG1ldGEsIGludCBhY2Nlc3MpIHsKICAgICAgICBpZiAobWV0YS5nZXREZXNj\ncmliZWRUeXBlKCkgPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIGlmIChhY2Nlc3MgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NF\nU1NfVU5LTk9XTikgewogICAgICAgICAgICAvLyB3ZSBkbyBub3QgYWxsb3cg\ndXNpbmcgYm90aCBmaWVsZCBhbmQgbWV0aG9kIGFjY2VzcyBhdAogICAgICAg\nICAgICAvLyB0aGUgc2FtZSB0aW1lCiAgICAgICAgICAgIGFjY2VzcyA9IGdl\ndEFjY2Vzc1R5cGUobWV0YSk7CiAgICAgICAgICAgIGlmICgoYWNjZXNzICYg\nQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpICE9IDAKICAgICAgICAgICAg\nICAgICYmIChhY2Nlc3MgJiBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJU\nWSkgIT0gMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJhY2Nlc3MtZmllbGQtYW5kLXByb3AiLAogICAgICAg\nICAgICAgICAgICAgIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSkpOwogICAgICAgIH0KICAgICAgICBtZXRhLnNldEFjY2Vzc1R5cGUoYWNj\nZXNzKTsKCiAgICAgICAgTG9nIGxvZyA9IG1ldGEuZ2V0UmVwb3NpdG9yeSgp\nLmdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJnZW4tbWV0YSIsIG1l\ndGEpKTsKICAgICAgICBpZiAoIV9wY1JlZ2lzdHJ5IHx8ICFwb3B1bGF0ZUZy\nb21QQ1JlZ2lzdHJ5KG1ldGEpKSB7CiAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9j\nLmdldCgibWV0YS1yZWZsZWN0IikpOwogICAgICAgICAgICBwb3B1bGF0ZUZy\nb21SZWZsZWN0aW9uKG1ldGEpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFBvcHVsYXRlIGluaXRpYWwgZmllbGQgZGF0YS4gRG9lcyBub3Ro\naW5nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBv\ncHVsYXRlKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQb3B1bGF0ZSB0aGUgZ2l2ZW4gbWV0YWRhdGEgdXNpbmcgdGhlIHtA\nbGluayBQQ1JlZ2lzdHJ5fS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHBvcHVsYXRlRnJvbVBDUmVnaXN0cnkoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgQ2xhc3MgY2xzID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5nW10gZmllbGROYW1l\ncyA9IFBDUmVnaXN0cnkuZ2V0RmllbGROYW1lcyhjbHMpOwogICAgICAgICAg\nICBDbGFzc1tdIGZpZWxkVHlwZXMgPSBQQ1JlZ2lzdHJ5LmdldEZpZWxkVHlw\nZXMoY2xzKTsKICAgICAgICAgICAgTWVtYmVyIG1lbWJlcjsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmllbGROYW1lcy5sZW5ndGg7IGkgKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFE\nYXRhLkFDQ0VTU19GSUVMRCkKICAgICAgICAgICAgICAgICAgICBtZW1iZXIg\nPSBjbHMuZ2V0RGVjbGFyZWRGaWVsZChmaWVsZE5hbWVzW2ldKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBtZW1iZXIgPSBn\nZXRCYWNraW5nTWV0aG9kKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAg\nICAgICAgICAgICAgICAgICAgICBmaWVsZE5hbWVzW2ldLCBmaWVsZFR5cGVz\nW2ldKTsKICAgICAgICAgICAgICAgIGZtZCA9IG1ldGEuYWRkRGVjbGFyZWRG\naWVsZChmaWVsZE5hbWVzW2ldLCBmaWVsZFR5cGVzW2ldKTsKICAgICAgICAg\nICAgICAgIGZtZC5iYWNraW5nTWVtYmVyKG1lbWJlcik7CiAgICAgICAgICAg\nICAgICBwb3B1bGF0ZShmbWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxTdGF0ZUV4\nY2VwdGlvbiBpYWUpIHsKICAgICAgICAgICAgLy8gdGhyb3duIGJ5IHJlZ2lz\ndHJ5IHdoZW4gbm8gbWV0YWRhdGEgYXZhaWxhYmxlCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9u\nIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdl\nbmVyYXRlIHRoZSBnaXZlbiBtZXRhZGF0YSB1c2luZyByZWZsZWN0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcG9wdWxhdGVGcm9tUmVmbGVjdGlv\nbihDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBNZW1iZXJbXSBtZW1i\nZXJzOwogICAgICAgIGJvb2xlYW4gaWZhY2UgPSBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS5pc0ludGVyZmFjZSgpOwogICAgICAgIGlmIChtZXRhLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCAmJiAh\naWZhY2UpCiAgICAgICAgICAgIG1lbWJlcnMgPSBtZXRhLmdldERlc2NyaWJl\nZFR5cGUoKS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgbWVtYmVycyA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdl\ndERlY2xhcmVkTWV0aG9kcygpOwoKICAgICAgICBpbnQgbW9kczsKICAgICAg\nICBTdHJpbmcgbmFtZTsKICAgICAgICBib29sZWFuIGRlZjsKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG1lbWJlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbW9kcyA9IG1l\nbWJlcnNbaV0uZ2V0TW9kaWZpZXJzKCk7CiAgICAgICAgICAgIGlmIChNb2Rp\nZmllci5pc1N0YXRpYyhtb2RzKSB8fCBNb2RpZmllci5pc0ZpbmFsKG1vZHMp\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBuYW1l\nID0gZ2V0RmllbGROYW1lKG1lbWJlcnNbaV0pOwogICAgICAgICAgICBpZiAo\nbmFtZSA9PSBudWxsIHx8IGlzUmVzZXJ2ZWRGaWVsZE5hbWUobmFtZSkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGRlZiA9IGlz\nRGVmYXVsdFBlcnNpc3RlbnQobWV0YSwgbWVtYmVyc1tpXSwgbmFtZSk7CiAg\nICAgICAgICAgIGlmICghZGVmICYmIF9pZ25vcmUpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIHBhc3NlZCB0aGUgdGVzdHM7\nIHBlcnNpc3RlbnQgdHlwZSAtLSB3ZSBjb25zdHJ1Y3Qgd2l0aAogICAgICAg\nICAgICAvLyBPYmplY3QuY2xhc3MgYmVjYXVzZSBzZXR0aW5nIGJhY2tpbmcg\nbWVtYmVyIHdpbGwgc2V0IHByb3BlcgogICAgICAgICAgICAvLyB0eXBlIGFu\neXdheQogICAgICAgICAgICBmbWQgPSBtZXRhLmFkZERlY2xhcmVkRmllbGQo\nbmFtZSwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgZm1kLmJhY2tpbmdN\nZW1iZXIobWVtYmVyc1tpXSk7CiAgICAgICAgICAgIGlmICghZGVmKSB7CiAg\nICAgICAgICAgICAgICBmbWQuc2V0RXhwbGljaXQodHJ1ZSk7CiAgICAgICAg\nICAgICAgICBmbWQuc2V0TWFuYWdlbWVudChGaWVsZE1ldGFEYXRhLk1BTkFH\nRV9OT05FKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwb3B1bGF0ZShm\nbWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgYWNjZXNzIHR5cGUgb2YgdGhlIGdpdmVuIG1ldGFkYXRhLiBNYXkgYmUg\nYSBiaXR3aXNlCiAgICAgKiBjb21iaW5hdGlvbiBvZiBmaWVsZCBhbmQgcHJv\ncGVydHkgYWNjZXNzIGNvbnN0YW50cywgb3IgQUNDRVNTX1VOS05PV04uCiAg\nICAgKiBSZXR1cm5zIEFDQ0VTU19GSUVMRCBieSBkZWZhdWx0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgaW50IGdldEFjY2Vzc1R5cGUoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEuQUNDRVNT\nX0ZJRUxEOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVs\nZCBuYW1lIGZvciB0aGUgZ2l2ZW4gbWVtYmVyLiBUaGlzIHdpbGwgb25seSBi\nZSBpbnZva2VkCiAgICAgKiBvbiBtZW1iZXJzIG9mIHRoZSByaWdodCB0eXBl\nIChmaWVsZCB2cy4gbWV0aG9kKS4gUmV0dXJuIG51bGwgaWYgdGhlCiAgICAg\nKiBtZW1iZXIgY2Fubm90IGJlIG1hbmFnZWQuIERlZmF1bHQgYmVoYXZpb3I6\nIEZvciBmaWVsZHMsIHJldHVybnMgdGhlCiAgICAgKiBmaWVsZCBuYW1lLiBG\nb3IgZ2V0dGVyIG1ldGhvZHMsIHJldHVybnMgdGhlIG1pbnVzICJnZXQiIG9y\nICJpcyIgd2l0aAogICAgICogdGhlIG5leHQgbGV0dGVyIGxvd2VyLWNhc2Vk\nLiBGb3Igb3RoZXIgbWV0aG9kcywgcmV0dXJucyBudWxsLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU3RyaW5nIGdldEZpZWxkTmFtZShNZW1iZXIgbWVtYmVy\nKSB7CiAgICAgICAgaWYgKG1lbWJlciBpbnN0YW5jZW9mIEZpZWxkKQogICAg\nICAgICAgICByZXR1cm4gbWVtYmVyLmdldE5hbWUoKTsKCiAgICAgICAgTWV0\naG9kIG1ldGggPSAoTWV0aG9kKSBtZW1iZXI7CiAgICAgICAgaWYgKG1ldGgu\nZ2V0UmV0dXJuVHlwZSgpID09IHZvaWQuY2xhc3MKICAgICAgICAgICAgfHwg\nbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpLmxlbmd0aCAhPSAwKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIG5hbWUgPSBtZXRo\nLmdldE5hbWUoKTsKICAgICAgICBpZiAobmFtZS5zdGFydHNXaXRoKCJnZXQi\nKSAmJiBuYW1lLmxlbmd0aCgpID4gMykKICAgICAgICAgICAgbmFtZSA9IG5h\nbWUuc3Vic3RyaW5nKDMpOwogICAgICAgIGVsc2UgaWYgKChtZXRoLmdldFJl\ndHVyblR5cGUoKSA9PSBib29sZWFuLmNsYXNzCiAgICAgICAgICAgIHx8IG1l\ndGguZ2V0UmV0dXJuVHlwZSgpID09IEJvb2xlYW4uY2xhc3MpCiAgICAgICAg\nICAgICYmIG5hbWUuc3RhcnRzV2l0aCgiaXMiKSAmJiBuYW1lLmxlbmd0aCgp\nID4gMikKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDIpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIGlmIChuYW1lLmxlbmd0aCgpID09IDEpCiAgICAgICAgICAgIHJldHVybiBu\nYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIENoYXJhY3Rlci50\nb0xvd2VyQ2FzZShuYW1lLmNoYXJBdCgwKSkgKyBuYW1lLnN1YnN0cmluZygx\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUg\nZ2l2ZW4gZmllbGQgbmFtZSBpcyByZXNlcnZlZCBmb3IgdW5tYW5hZ2VkIGZp\nZWxkcy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNSZXNlcnZl\nZEZpZWxkTmFtZShTdHJpbmcgbmFtZSkgewogICAgICAgIC8vIG5hbWVzIHVz\nZWQgYnkgZW5oYW5jZXJzCiAgICAgICAgcmV0dXJuIG5hbWUuc3RhcnRzV2l0\naCgib3BlbmpwYSIpIHx8IG5hbWUuc3RhcnRzV2l0aCgiamRvIik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gbWVt\nYmVyIGlzIHBlcnNpc3RlbnQgYnkgZGVmYXVsdC4gVGhpcyB3aWxsCiAgICAg\nKiBvbmx5IGJlIGludm9rZWQgb24gbWVtYmVycyBvZiB0aGUgcmlnaHQgdHlw\nZSAoZmllbGQgdnMuIG1ldGhvZCkuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlm\nIG1lbWJlciBpcyBzdGF0aWMgb3IgZmluYWwgYnkgZGVmYXVsdC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgZmllbGQgbmFtZSBmcm9tIHtAbGlu\nayAjZ2V0RmllbGROYW1lfQogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJh\nY3QgYm9vbGVhbiBpc0RlZmF1bHRQZXJzaXN0ZW50KENsYXNzTWV0YURhdGEg\nbWV0YSwKICAgICAgICBNZW1iZXIgbWVtYmVyLCBTdHJpbmcgbmFtZSk7Cgog\nICAgcHVibGljIE1lbWJlciBnZXRCYWNraW5nTWVtYmVyKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyMj\nIyBub3RlIHRoYXQgd2UgbWlnaHQgbm90IGhhdmUgYWNjZXNzIHRvIGRlY2xh\ncmluZyBtZXRhZGF0YSB5ZXQKICAgICAgICAgICAgLy8jIyMgKHRoaXMgY291\nbGQgYmUgdXNlZCBkdXJpbmcgcGFyc2UpLCBzbyB3ZSBoYXZlIHRvIHNldHRs\nZSBmb3IKICAgICAgICAgICAgLy8jIyMgZGVmaW5pbmcuICBjb3VsZCBjYXVz\nZSBwcm9ibGVtcyBpZiBtYXBzIGEgc3VwZXJjbGFzcyBmaWVsZAogICAgICAg\nICAgICAvLyMjIyB3aGVyZSB0aGUgc3VwZXJjbGFzcyB1c2VzIGEgZGlmZmVy\nZW50IGFjY2VzcyB0eXBlCiAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVmaW5p\nbmdNZXRhRGF0YSgpLmdldEFjY2Vzc1R5cGUoKSA9PQogICAgICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZm1kLmdldERlY2xhcmluZ1R5cGUoKS5nZXREZWNsYXJlZEZp\nZWxkKGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICByZXR1cm4gZ2V0QmFj\na2luZ01ldGhvZChmbWQuZ2V0RGVjbGFyaW5nVHlwZSgpLCBmbWQuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgZm1kLmdldERlY2xhcmVkVHlwZSgpKTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIG1ldGhvZCBiYWNraW5nIHRoZSBnaXZlbiBmaWVsZCBtZXRhZGF0YS4gTG9v\na3MgZm9yCiAgICAgKiAiZ2V0IiBhbmQgImlzIiBtZXRob2RzIHdpdGggbm8g\ncGFyYW1ldGVycyBieSBkZWZhdWx0LiBUaGlzIGxvb2tzCiAgICAgKiBmb3Ig\nZWxlbWVudHMgZGVmaW5lZCBpbiA8Y29kZT5jbHM8L2NvZGU+IGFuZCBpdHMg\nc3VwZXJjbGFzc2VzLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRC\nYWNraW5nTWV0aG9kKENsYXNzIGNscywgU3RyaW5nIG5hbWUsCiAgICAgICAg\nQ2xhc3MgbWV0aFJldHVyblR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIGNsc05hbWUgPSBjbHMu\nZ2V0TmFtZSgpOwogICAgICAgIFN0cmluZyBjYXBOYW1lID0gU3RyaW5nVXRp\nbHMuY2FwaXRhbGl6ZShuYW1lKTsKICAgICAgICBib29sZWFuIGlzQm9vbGVh\nbiA9IG1ldGhSZXR1cm5UeXBlID09IGJvb2xlYW4uY2xhc3MKICAgICAgICAg\nICAgfHwgbWV0aFJldHVyblR5cGUgPT0gQm9vbGVhbi5jbGFzczsKICAgICAg\nICBkbyB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gY2xzLmdldERlY2xhcmVkTWV0aG9kKCJnZXQiICsgY2FwTmFtZSwgKENs\nYXNzW10pIG51bGwpOwogICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAoaXNCb29sZWFuKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBjbHMuZ2V0RGVjbGFyZWRNZXRob2QoImlz\nIiArIGNhcE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIChDbGFzc1td\nKSBudWxsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgLy8gIyMjIEVKQjM6IHJlY3Vyc2lvbiBzaG91bGQg\nYmUgbGltaXRlZCB0byBtYW5hZ2VhYmxlIHR5cGVzLAogICAgICAgICAgICAv\nLyAjIyMgaW5jbHVkaW5nIGVtYmVkZGFibGUgYW5kIGVtYmVkZGFibGUgc3Vw\nZXJjbGFzcwogICAgICAgICAgICBjbHMgPSBjbHMuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoY2xzICE9IG51bGwpOwoKICAg\nICAgICBpZiAoIWlzQm9vbGVhbikKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoInBjLXJlZ2lzdHJ5LW5vLW1ldGhvZCIs\nCiAgICAgICAgICAgICAgICBuYW1lLCBjbHNOYW1lLCAiZ2V0IiArIGNhcE5h\nbWUpKTsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgicGMtcmVnaXN0cnktbm8tYm9vbGVhbi1tZXRob2QiLAogICAgICAgICAg\nICBuZXcgU3RyaW5nW117IG5hbWUsIGNsc05hbWUsICJnZXQiICsgY2FwTmFt\nZSwgImlzIiArIGNhcE5hbWUgfSkpOwogICAgfQoKICAgIHB1YmxpYyBDbGFz\ncyBnZXRVbmltcGxlbWVudGVkRXhjZXB0aW9uVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24uY2xhc3M7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kOyByZXR1cm5zIHRy\ndWUgaWYgdGhlIGdpdmVuIGNsYXNzIGFwcGVhcnMgdG8gYmUKICAgICAqIHVz\nZXItZGVmaW5lZC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBib29s\nZWFuIGlzVXNlckRlZmluZWQoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJu\nIGNscyAhPSBudWxsICYmICFjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImph\ndmEuIikKICAgICAgICAgICAgJiYgIWNscy5nZXROYW1lKCkuc3RhcnRzV2l0\naCAoImphdmF4LiIpOwoJfQp9Cg==\n","encoding":"base64"}

