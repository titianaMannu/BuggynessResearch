{"sha":"6d63551b34b248903d9d8b5c47c8a085f11ea4c2","node_id":"MDQ6QmxvYjIwNjM2NDo2ZDYzNTUxYjM0YjI0ODkwM2Q5ZDhiNWM0N2M4YTA4NWYxMWVhNGMy","size":79123,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/6d63551b34b248903d9d8b5c47c8a085f11ea4c2","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhOwoKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxl\nY3QuTWV0aG9kOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEu\ndXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5n\nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYu\nT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZGF0YWNhY2hlLkRhdGFDYWNoZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnhtbC5Db21tZW50YWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbnRJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuTG9uZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PcGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5TaG9ydElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU3Ry\naW5nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1cHBv\ncnRlZEV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoq\nCiAqIENvbnRhaW5zIG1ldGFkYXRhIGFib3V0IGEgcGVyc2lzdGVudCB0eXBl\nLgogKiBUaGlzIG1ldGFkYXRhIGlzIGF2YWlsYWJsZSBib3RoIGF0IGVuaGFu\nY2VtZW50IHRpbWUgYW5kIHJ1bnRpbWUuCiAqICBOb3RlIHRoYXQgdGhpcyBj\nbGFzcyBlbXBsb3lzIGFnZ3Jlc3NpdmUgY2FjaGluZywgYW5kIHRoZXJlZm9y\nZSBpdCBpcwogKiBpbXBvcnRhbnQgdG8gZmluYWxpemUgdGhlIGNvbmZpZ3Vy\nYXRpb24gb2YgZmllbGQgbWV0YWRhdGFzIGJlZm9yZSBpbnZva2luZwogKiBt\nZXRob2RzIHRoYXQgZGVwZW5kIG9uIHRoYXQgY29uZmlndXJhdGlvbiwgc3Vj\naCBhcwogKiB7QGxpbmsgI2dldFByaW1hcnlLZXlGaWVsZHN9LgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIENsYXNzTWV0YURh\ndGEKICAgIGV4dGVuZHMgRXh0ZW5zaW9ucwogICAgaW1wbGVtZW50cyBDb21w\nYXJhYmxlLCBTb3VyY2VUcmFja2VyLCBNZXRhRGF0YUNvbnRleHQsIE1ldGFE\nYXRhTW9kZXMsCiAgICBDb21tZW50YWJsZSB7CgogICAgLyoqCiAgICAgKiBV\nbmtvbnduIGlkZW50aXR5IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IElEX1VOS05PV04gPSAwOwoKICAgIC8qKgogICAgICog\nRGF0YXN0b3JlIGlkZW50aXR5IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IElEX0RBVEFTVE9SRSA9IDE7CgogICAgLyoqCiAg\nICAgKiBBcHBsaWNhdGlvbiBpZGVudGl0eSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9BUFBMSUNBVElPTiA9IDI7Cgog\nICAgLyoqCiAgICAgKiBVbmtub3duIGFjY2VzcyB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfVU5LTk9XTiA9IDA7\nCgogICAgLyoqCiAgICAgKiBQZXJzaXN0ZW50IGF0dHJpYnV0ZXMgYXJlIGFj\nY2Vzc2VkIHZpYSBkaXJlY3QgZmllbGQgYWNjZXNzLiBCaXQgZmxhZy4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQUNDRVNTX0ZJRUxE\nID0gMiA8PCAwOwoKICAgIC8qKgogICAgICogUGVyc2lzdGVudCBhdHRyaWJ1\ndGVzIGFyZSBhY2Nlc3NlZCB2aWEgc2V0dGVycyBhbmQgZ2V0dGVycy4gQml0\nIGZsYWcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFD\nQ0VTU19QUk9QRVJUWSA9IDIgPDwgMTsKCiAgICAvKioKICAgICAqIFZhbHVl\nIGZvciB1c2luZyBhIHN5bnRoZXRpYyBkZXRhY2hlZCBzdGF0ZSBmaWVsZCwg\nd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIFNZTlRIRVRJQyA9ICJgc3luIjsKCiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIFN0cmluZyBERUZBVUxUX1NUUklORyA9ICJg\nIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nIExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKENsYXNzTWV0YURhdGEu\nY2xhc3MpOwoKICAgIC8vIHRoZSByZXBvc2l0b3J5IHRoaXMgY2xhc3MgYmVs\nb25ncyB0bywgaWYgYW55LCBhbmQgc291cmNlIGZpbGUKICAgIHByaXZhdGUg\nZmluYWwgTWV0YURhdGFSZXBvc2l0b3J5IF9yZXBvczsKICAgIHByaXZhdGUg\nZmluYWwgVmFsdWVNZXRhRGF0YSBfb3duZXI7CiAgICBwcml2YXRlIGZpbmFs\nIExpZmVjeWNsZU1ldGFEYXRhIF9saWZlTWV0YSA9IG5ldyBMaWZlY3ljbGVN\nZXRhRGF0YSh0aGlzKTsKICAgIHByaXZhdGUgQ2xhc3NMb2FkZXIgX2xvYWRl\nciA9IG51bGw7CiAgICBwcml2YXRlIEZpbGUgX3NyY0ZpbGUgPSBudWxsOwog\nICAgcHJpdmF0ZSBpbnQgX3NyY1R5cGUgPSBTUkNfT1RIRVI7CiAgICBwcml2\nYXRlIFN0cmluZ1tdIF9jb21tZW50cyA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfbGlzdEluZGV4ID0gLTE7CiAgICBwcml2YXRlIGludCBfc3JjTW9kZSA9\nIE1PREVfTUVUQSB8IE1PREVfTUFQUElORzsKICAgIHByaXZhdGUgaW50IF9y\nZXNNb2RlID0gTU9ERV9OT05FOwoKICAgIHByaXZhdGUgQ2xhc3MgX3R5cGUg\nPSBPYmplY3QuY2xhc3M7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfZmllbGRN\nYXAgPSBuZXcgVHJlZU1hcCgpOwogICAgcHJpdmF0ZSBNYXAgX3N1cEZpZWxk\nTWFwID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZGVmU3VwRmllbGRz\nID0gZmFsc2U7CiAgICBwcml2YXRlIENvbGxlY3Rpb24gX3N0YXRpY0ZpZWxk\ncyA9IG51bGw7CiAgICBwcml2YXRlIGludFtdIF9maWVsZERhdGFUYWJsZSA9\nIG51bGw7CiAgICBwcml2YXRlIE1hcCBfZmdNYXAgPSBudWxsOwoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBOb3RlOiBpZiB5b3UgYWRk\nIGFkZGl0aW9uYWwgc3RhdGUsIG1ha2Ugc3VyZSB0byBhZGQgaXQgdG8gY29w\neSgpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHByaXZhdGUg\nQ2xhc3MgX29iamVjdElkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVhbiBf\nb2JqZWN0SWRTaGFyZWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9v\ncGVuanBhSWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9leHRlbnQg\nPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9lbWJlZGRlZCA9IG51bGw7\nCiAgICBwcml2YXRlIEJvb2xlYW4gX2ludGVyZmFjZSA9IG51bGw7CiAgICBw\ncml2YXRlIENsYXNzIF9pbXBsID0gbnVsbDsKICAgIHByaXZhdGUgTGlzdCBf\naW50ZXJmYWNlcyA9IG51bGw7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfaWZh\nY2VNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBpbnQgX2lkZW50\naXR5ID0gSURfVU5LTk9XTjsKICAgIHByaXZhdGUgaW50IF9pZFN0cmF0ZWd5\nID0gVmFsdWVTdHJhdGVnaWVzLk5PTkU7CiAgICBwcml2YXRlIGludCBfYWNj\nZXNzVHlwZSA9IEFDQ0VTU19VTktOT1dOOwoKICAgIHByaXZhdGUgU3RyaW5n\nIF9zZXFOYW1lID0gREVGQVVMVF9TVFJJTkc7CiAgICBwcml2YXRlIFNlcXVl\nbmNlTWV0YURhdGEgX3NlcU1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBTdHJp\nbmcgX2NhY2hlTmFtZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0ZSBp\nbnQgX2NhY2hlVGltZW91dCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAgcHJp\ndmF0ZSBCb29sZWFuIF9kZXRhY2hhYmxlID0gbnVsbDsKICAgIHByaXZhdGUg\nU3RyaW5nIF9kZXRhY2hTdGF0ZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJp\ndmF0ZSBTdHJpbmcgX2FsaWFzID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF92\nZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5fVkFMVUU7CgogICAgcHJpdmF0ZSBD\nbGFzcyBfc3VwZXIgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRh\nIF9zdXBlck1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc1tdIF9zdWJz\nID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtdIF9zdWJNZXRh\ncyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGFbXSBfbWFwU3Vi\nTWV0YXMgPSBudWxsOwoKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9m\naWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX3Vu\nbWdkRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtd\nIF9hbGxGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRh\nW10gX2FsbFBLRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRh\nRGF0YVtdIF9hbGxERkdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVs\nZE1ldGFEYXRhW10gX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0\nZSBGaWVsZE1ldGFEYXRhW10gX2xpc3RpbmdGaWVsZHMgPSBudWxsOwogICAg\ncHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbExpc3RpbmdGaWVsZHMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3VwW10gX2ZncyA9IG51bGw7CiAg\nICBwcml2YXRlIEZldGNoR3JvdXBbXSBfY3VzdG9tRkdzID0gbnVsbDsKCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgZGVzY3JpYmVkIHR5\ncGUgYW5kIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhKENsYXNzIHR5cGUsIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncykgewogICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIF9vd25lciA9\nIG51bGw7CiAgICAgICAgc2V0RGVzY3JpYmVkVHlwZSh0eXBlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEVtYmVkZGVkIGNvbnN0cnVjdG9yLiBTdXBwbHkg\nZW1iZWRkaW5nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NN\nZXRhRGF0YShWYWx1ZU1ldGFEYXRhIG93bmVyKSB7CiAgICAgICAgX293bmVy\nID0gb3duZXI7CiAgICAgICAgX3JlcG9zID0gb3duZXIuZ2V0UmVwb3NpdG9y\neSgpOwogICAgICAgIHNldEVudkNsYXNzTG9hZGVyKG93bmVyLmdldEZpZWxk\nTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAgICAgICAgICAg\nIGdldEVudkNsYXNzTG9hZGVyKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBvd25pbmcgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVi\nbGljIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAg\nICAgIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0\naGlzIG1ldGFkYXRhIGlzIGZvciBhbiBlbWJlZGRlZCBvYmplY3QsIHJldHVy\nbmluZyB0aGUgb3duaW5nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgVmFs\ndWVNZXRhRGF0YSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpIHsKICAgICAgICBy\nZXR1cm4gX293bmVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNp\nc3RlbmNlIGNhcGFibGUgY2xhc3MgZGVzY3JpYmVkIGJ5IHRoaXMgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXREZXNjcmliZWRUeXBl\nKCkgewogICAgICAgIHJldHVybiBfdHlwZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgY2xhc3MgZGVzY2liZWQgYnkgdGhpcyBtZXRhZGF0YS4g\nVGhlIHR5cGUgbWF5IGJlIHJlc2V0IHdoZW4KICAgICAqIGFuIGVtYmVkZGVk\nIHZhbHVlIGNoYW5nZXMgaXRzIGRlY2xhcmVkIHR5cGUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHNldERlc2NyaWJlZFR5cGUoQ2xhc3MgdHlwZSkg\newogICAgICAgIGlmICh0eXBlLmdldFN1cGVyY2xhc3MoKSAhPSBudWxsICYm\nICJqYXZhLmxhbmcuRW51bSIuZXF1YWxzCiAgICAgICAgICAgICh0eXBlLmdl\ndFN1cGVyY2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVudW0iLCB0eXBlKSk7\nCiAgICAgICAgX3R5cGUgPSB0eXBlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGVudmlyb25tZW50YWwgbG9hZGVyIHVzZWQgd2hlbiBsb2FkaW5nIHRo\naXMgbWV0YWRhdGEuCiAgICAgKiBUaGUgY2xhc3MgbWV0YWRhdGEgc2hvdWxk\nIHVzZSB0aGlzIGxvYWRlciB3aGVuIGxvYWRpbmcgbWV0YWRhdGEgZm9yCiAg\nICAgKiBpdHMgc3VwZXJjbGFzcyBhbmQgZmllbGQgdHlwZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsK\nICAgICAgICByZXR1cm4gX2xvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBjbGFzcyBlbnZpcm9ubWVudGFsIGxvYWRlciB1c2VkIHdoZW4gbG9h\nZGluZyB0aGlzIG1ldGFkYXRhLgogICAgICogVGhlIGNsYXNzIG1ldGFkYXRh\nIHNob3VsZCB1c2UgdGhpcyBsb2FkZXIgd2hlbiBsb2FkaW5nIG1ldGFkYXRh\nIGZvcgogICAgICogaXRzIHN1cGVyY2xhc3MgYW5kIGZpZWxkIHR5cGVzLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZDbGFzc0xvYWRlcihDbGFz\nc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfbG9hZGVyID0gbG9hZGVyOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUg\nc3VwZXJjbGFzcyBvZiB0aGUgZGVzY3JpYmVkIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBDbGFzcyBnZXRQQ1N1cGVyY2xhc3MoKSB7CiAgICAgICAgcmV0\ndXJuIF9zdXBlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwZXJzaXN0\nZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2YgdGhlIGRlc2NyaWJlZCB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQQ1N1cGVyY2xhc3MoQ2xh\nc3MgcGMpIHsKICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAg\nICBfc3VwZXIgPSBwYzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRh\nZGF0YSBmb3IgdGhpcyBjbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwogICAg\ncHVibGljIENsYXNzTWV0YURhdGEgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKSB7CiAgICAgICAgaWYgKF9zdXBlck1ldGEgPT0gbnVsbCAmJiBfc3VwZXIg\nIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX293bmVyICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIF9zdXBlck1ldGEgPSBfcmVwb3MubmV3RW1iZWRk\nZWRDbGFzc01ldGFEYXRhKF9vd25lcik7CiAgICAgICAgICAgICAgICBfc3Vw\nZXJNZXRhLnNldERlc2NyaWJlZFR5cGUoX3N1cGVyKTsKICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICBfc3VwZXJNZXRhID0gX3JlcG9zLmdl\ndE1ldGFEYXRhKF9zdXBlciwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfc3VwZXJNZXRhOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIG1ldGFkYXRhIGZvciB0aGlzIGNsYXNzJyBzdXBlcmNsYXNzLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBjbGVhckFsbEZpZWxk\nQ2FjaGUoKTsKICAgICAgICBfc3VwZXJNZXRhID0gbWV0YTsKICAgICAgICBp\nZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICBzZXRQQ1N1cGVyY2xhc3Mo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGlzIGNsYXNzIGlzIG1hcHBlZCB0byB0aGUgZGF0YXN0\nb3JlLiBCeSBkZWZhdWx0LCBvbmx5CiAgICAgKiByZXR1cm5zIGZhbHNlIGlm\nIGNsYXNzIGlzIGVtYmVkZGVkLW9ubHksIGJ1dCBzdWJjbGFzc2VzIG1pZ2h0\nIG92ZXJyaWRlCiAgICAgKiB0byBhbGxvdyB1bm1hcHBlZCBvdGhlciB0eXBl\ncy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNNYXBwZWQoKSB7CiAg\nICAgICAgcmV0dXJuIF9lbWJlZGRlZCAhPSBCb29sZWFuLlRSVUU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsb3Nlc3QgbWFwcGVkIHN1\ncGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdl\ndE1hcHBlZFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIENsYXNz\nTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAg\nICAgICBpZiAoc3VwID09IG51bGwgfHwgc3VwLmlzTWFwcGVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBzdXA7CiAgICAgICAgcmV0dXJuIHN1cC5nZXRNYXBw\nZWRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBrbm93biBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1YmNs\nYXNzZXMgb2YgdGhlIGRlc2NyaWJlZCB0eXBlLAogICAgICogb3IgZW1wdHkg\nYXJyYXkgaWYgbm9uZSBvciBpZiB0aGlzIGlzIGVtYmVkZGVkIG1ldGFkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NbXSBnZXRQQ1N1YmNsYXNzZXMo\nKSB7CiAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gX3JlcG9zLkVNUFRZX0NMQVNTRVM7CgogICAgICAgIF9yZXBvcy5w\ncm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoKTsKICAgICAgICBpZiAoX3N1YnMg\nPT0gbnVsbCkgewogICAgICAgICAgICBDb2xsZWN0aW9uIHN1YnMgPSBfcmVw\nb3MuZ2V0UENTdWJjbGFzc2VzKF90eXBlKTsKICAgICAgICAgICAgX3N1YnMg\nPSAoQ2xhc3NbXSkgc3Vicy50b0FycmF5KG5ldyBDbGFzc1tzdWJzLnNpemUo\nKV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3N1YnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUga25v\nd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mCiAgICAgKiB0\naGUgZGVzY3JpYmVkIHR5cGUsIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUgb3Ig\naWYgdGhpcyBpcyBlbWJlZGRlZAogICAgICogbWV0YWRhdGEuCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0UENTdWJjbGFzc01ldGFE\nYXRhcygpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBfcmVwb3MuRU1QVFlfTUVUQVM7CgogICAgICAgIENsYXNz\nW10gc3VicyA9IGdldFBDU3ViY2xhc3NlcygpOyAvLyBjaGVja3MgZm9yIG5l\ndwogICAgICAgIGlmIChfc3ViTWV0YXMgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoc3Vicy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIF9zdWJN\nZXRhcyA9IF9yZXBvcy5FTVBUWV9NRVRBUzsKICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMgPSBfcmVw\nb3MubmV3Q2xhc3NNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAgICAg\nKHN1YnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgc3Vicy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBt\nZXRhc1tpXSA9IF9yZXBvcy5nZXRNZXRhRGF0YShzdWJzW2ldLCBfbG9hZGVy\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9zdWJNZXRhcyA9IG1ldGFzOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfc3ViTWV0\nYXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIG1hcHBlZCBz\ndWJjbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YVtd\nIGdldE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0YXMoKSB7CiAgICAgICAgaWYg\nKF9vd25lciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3JlcG9zLkVN\nUFRZX01FVEFTOwoKICAgICAgICBDbGFzc01ldGFEYXRhW10gc3VicyA9IGdl\ndFBDU3ViY2xhc3NNZXRhRGF0YXMoKTsgLy8gY2hlY2tzIGZvciBuZXcKICAg\nICAgICBpZiAoX21hcFN1Yk1ldGFzID09IG51bGwpIHsKICAgICAgICAgICAg\naWYgKHN1YnMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBfbWFwU3Vi\nTWV0YXMgPSBzdWJzOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgIExpc3QgbWFwcGVkID0gbmV3IEFycmF5TGlzdChzdWJzLmxlbmd0aCk7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNbaV0uaXNN\nYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGVkLmFkZChz\ndWJzW2ldKTsKICAgICAgICAgICAgICAgIF9tYXBTdWJNZXRhcyA9IChDbGFz\nc01ldGFEYXRhW10pIG1hcHBlZC50b0FycmF5CiAgICAgICAgICAgICAgICAg\nICAgKF9yZXBvcy5uZXdDbGFzc01ldGFEYXRhQXJyYXkobWFwcGVkLnNpemUo\nKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nbWFwU3ViTWV0YXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBv\nZiBpZGVudGl0eSBiZWluZyB1c2VkLiBUaGlzIHdpbGwgYmUgb25lIG9mOgog\nICAgICogPHVsPgogICAgICogPGxpPntAbGluayAjSURfVU5LTk9XTn06IHVu\na25vd24gaWRlbnRpdHkgdHlwZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJ\nRF9EQVRBU1RPUkV9OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBkYXRhIHN0\nb3JlIGFuZAogICAgICogaW5kZXBlbmRlbnQJb2YgdGhlIGZpZWxkcyBvZiB0\naGUgaW5zdGFuY2U8L2xpPgogICAgICogPGxpPntAbGluayAjSURfQVBQTElD\nQVRJT059OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiBh\nbmQKICAgICAqIGRlZmluZWQgYnkgb25lIG9yIG1vcmUgZmllbGRzIG9mIHRo\nZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8L3VsPiBJZiB1bnNwZWNpZmllZCwg\nZGVmYXVsdHMgdG8ge0BsaW5rICNJRF9EQVRBU1RPUkV9IGlmIHRoZXJlIGFy\nZSBubwogICAgICogcHJpbWFyeSBrZXkgZmllbGRzLCBhbmQge0BsaW5rICNJ\nRF9BUFBMSUNBVElPTn0gb3RoZXJ3aXNlLgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldElkZW50aXR5VHlwZSgpIHsKICAgICAgICBpZiAoX2lkZW50aXR5\nID09IElEX1VOS05PV04pIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBp\nZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlwZSgpICE9IElE\nX1VOS05PV04pCiAgICAgICAgICAgICAgICBfaWRlbnRpdHkgPSBzdXAuZ2V0\nSWRlbnRpdHlUeXBlKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGdldFByaW1h\ncnlLZXlGaWVsZHMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgX2lk\nZW50aXR5ID0gSURfQVBQTElDQVRJT047CiAgICAgICAgICAgIGVsc2UgaWYg\nKGlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICBfaWRlbnRpdHkgPSBJRF9E\nQVRBU1RPUkU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9p\nZGVudGl0eSA9IF9yZXBvcy5nZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZh\ndWx0cygpLgogICAgICAgICAgICAgICAgICAgIGdldERlZmF1bHRJZGVudGl0\neVR5cGUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9pZGVudGl0eTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0eXBlIG9mIGlkZW50aXR5IGJl\naW5nIHVzZWQuIFRoaXMgd2lsbCBiZSBvbmUgb2Y6CiAgICAgKiA8dWw+CiAg\nICAgKiA8bGk+e0BsaW5rICNJRF9VTktOT1dOfTogdW5rbm93biBpZGVudGl0\neSB0eXBlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI0lEX0RBVEFTVE9SRX06\nIGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGRhdGEgc3RvcmUgYW5kCiAgICAg\nKiBpbmRlcGVuZGVudAlvZiB0aGUgZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwv\nbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9BUFBMSUNBVElPTn06IGlkZW50\naXR5IG1hbmFnZWQgYnkgdGhlIGFwcGxpY2F0aW9uIGFuZAogICAgICogZGVm\naW5lZCBieSBvbmUgb3IgbW9yZSBmaWVsZHMgb2YgdGhlIGluc3RhbmNlPC9s\naT4KICAgICAqIDwvdWw+IElmIHVuc3BlY2lmaWVkLCBkZWZhdWx0cyB0byB7\nQGxpbmsgI0lEX0RBVEFTVE9SRX0gaWYgdGhlcmUgYXJlIG5vCiAgICAgKiBw\ncmltYXJ5IGtleSBmaWVsZHMsIGFuZCB7QGxpbmsgI0lEX0FQUExJQ0FUSU9O\nfSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50\naXR5VHlwZShpbnQgdHlwZSkgewogICAgICAgIF9pZGVudGl0eSA9IHR5cGU7\nCiAgICAgICAgaWYgKHR5cGUgIT0gSURfQVBQTElDQVRJT04pIHsKICAgICAg\nICAgICAgX29iamVjdElkID0gbnVsbDsKICAgICAgICAgICAgX29wZW5qcGFJ\nZCA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIG1ldGFkYXRhLXNwZWNpZmllZCBjbGFzcyB0byB1c2UgZm9yIHRoZSBvYmpl\nY3QgSUQuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5\ncGUoKSB7CiAgICAgICAgaWYgKF9vYmplY3RJZCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gX29iamVjdElkOwogICAgICAgIGlmIChnZXRJZGVudGl0\neVR5cGUoKSAhPSBJRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBz\ndXAuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9XTikgewogICAgICAg\nICAgICBfb2JqZWN0SWQgPSBzdXAuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAg\nICAgICAgIHJldHVybiBfb2JqZWN0SWQ7CiAgICAgICAgfQoKICAgICAgICAv\nLyBmaWd1cmUgb3V0IG9wZW5qcGEgaWRlbnRpdHkgdHlwZSBiYXNlZCBvbiBw\ncmltYXJ5IGtleSBmaWVsZAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3Mg\nPSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAgaWYgKHBrcy5sZW5n\ndGggIT0gMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc3dp\ndGNoIChwa3NbMF0uZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0\nSWQgPSBCeXRlSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0\nSWQgPSBDaGFySWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElk\nID0gSW50SWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQg\nPSBMb25nSWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJ\nZCA9IFNob3J0SWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gU3RyaW5nSWQuY2xhc3M7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgIF9vYmplY3RJZCA9IERhdGVJZC5jbGFzczsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nSUQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAg\nICAgICAgICAgIF9vYmplY3RJZCA9IE9iamVjdElkLmNsYXNzOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb2Jq\nZWN0SWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEtc3Bl\nY2lmaWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVjdCBJRC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0T2JqZWN0SWRUeXBlKENsYXNzIGNscywg\nYm9vbGVhbiBzaGFyZWQpIHsKICAgICAgICBfb2JqZWN0SWQgPSBudWxsOwog\nICAgICAgIF9vcGVuanBhSWQgPSBudWxsOwogICAgICAgIF9vYmplY3RJZFNo\nYXJlZCA9IG51bGw7CiAgICAgICAgaWYgKGNscyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIGRvbid0IGxldCBwZW9wbGUgYXNzaWduIE9wZW5KUEFJZCB0\neXBlczsgc2FmZXIgdG8gY2FsY3VsYXRlIGl0CiAgICAgICAgICAgIC8vIG91\ncnNlbHZlcwogICAgICAgICAgICBzZXRJZGVudGl0eVR5cGUoSURfQVBQTElD\nQVRJT04pOwogICAgICAgICAgICBpZiAoIU9wZW5KUEFJZC5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKGNscykpIHsKICAgICAgICAgICAgICAgIF9vYmplY3RJ\nZCA9IGNsczsKICAgICAgICAgICAgICAgIF9vYmplY3RJZFNoYXJlZCA9IChz\naGFyZWQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhpcyB0eXBlIHVzZXMgYW4gYXBwbGljYXRpb24gaWRlbnRpdHkgY2xh\nc3MgdGhhdCBpcyBzaGFyZWQKICAgICAqIHdpdGggb3RoZXIgY2xhc3Nlcywg\nYW5kIGlzIHRoZXJlZm9yZSB3cmFwcGVkIGluIGFuIHtAbGluayBPYmplY3RJ\nZH0uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzT2JqZWN0SWRUeXBl\nU2hhcmVkKCkgewogICAgICAgIGlmIChfb2JqZWN0SWRTaGFyZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RJZFNoYXJlZC5ib29sZWFu\nVmFsdWUoKTsKICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmlzT2JqZWN0\nSWRUeXBlU2hhcmVkKCk7CiAgICAgICAgcmV0dXJuIGlzT3BlbkpQQUlkZW50\naXR5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgdHlw\nZSB1c2VzIE9wZW5KUEEgaWRlbnRpdHkuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGlzT3BlbkpQQUlkZW50aXR5KCkgewogICAgICAgIGlmIChfb3Bl\nbmpwYUlkID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3MgY2xzID0gZ2V0\nT2JqZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgX29w\nZW5qcGFJZCA9IChPcGVuSlBBSWQuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShj\nbHMpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgOiBCb29sZWFu\nLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX29wZW5qcGFJZC5i\nb29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJh\ndGVneSB0byB1c2UgZm9yIGRhdGFzdG9yZSBpZGVudGl0eSBnZW5lcmF0aW9u\nLgogICAgICogT25lIG9mIHRoZSBjb25zdGFudHMgZnJvbSB7QGxpbmsgVmFs\ndWVTdHJhdGVnaWVzfS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRJZGVu\ndGl0eVN0cmF0ZWd5KCkgewogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUo\nKSA9PSBJRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYgX2lkU3RyYXRlZ3kg\nPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpIHsKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlw\nZSgpICE9IElEX1VOS05PV04pCiAgICAgICAgICAgICAgICBfaWRTdHJhdGVn\neSA9IHN1cC5nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIF9pZFN0cmF0ZWd5ID0gVmFsdWVTdHJhdGVn\naWVzLk5BVElWRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9pZFN0cmF0\nZWd5OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHRvIHVz\nZSBmb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdlbmVyYXRpb24uCiAgICAgKiBP\nbmUgb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtAbGluayBWYWx1ZVN0cmF0ZWdp\nZXN9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJZGVudGl0eVN0cmF0\nZWd5KGludCBzdHJhdGVneSkgewogICAgICAgIF9pZFN0cmF0ZWd5ID0gc3Ry\nYXRlZ3k7CiAgICAgICAgaWYgKHN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRlZ2ll\ncy5TRVFVRU5DRSkKICAgICAgICAgICAgc2V0SWRlbnRpdHlTZXF1ZW5jZU5h\nbWUobnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGF0YXN0b3Jl\nIGlkZW50aXR5IHNlcXVlbmNlIG5hbWUsIG9yIG51bGwgZm9yIG5vbmUuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5h\nbWUoKSB7CiAgICAgICAgaWYgKF9zZXFOYW1lID09IERFRkFVTFRfU1RSSU5H\nKSB7CiAgICAgICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9zZXFOYW1lID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5n\nZXRJZGVudGl0eVNlcXVlbmNlTmFtZSgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBfc2VxTmFtZSA9IG51bGw7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfc2VxTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBkYXRhc3RvcmUgaWRlbnRpdHkgc2VxdWVuY2UgbmFtZSwgb3IgbnVsbCBm\nb3Igbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SWRlbnRpdHlT\nZXF1ZW5jZU5hbWUoU3RyaW5nIHNlcU5hbWUpIHsKICAgICAgICBfc2VxTmFt\nZSA9IHNlcU5hbWU7CiAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAgICAg\nIGlmIChzZXFOYW1lICE9IG51bGwpCiAgICAgICAgICAgIHNldElkZW50aXR5\nU3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIE1ldGFkYXRhIGZvciB0aGUgZGF0YXN0b3JlIGlkZW50\naXR5IHNlcXVlbmNlLgogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2VNZXRh\nRGF0YSBnZXRJZGVudGl0eVNlcXVlbmNlTWV0YURhdGEoKSB7CiAgICAgICAg\naWYgKF9zZXFNZXRhID09IG51bGwgJiYgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5h\nbWUoKSAhPSBudWxsKQogICAgICAgICAgICBfc2VxTWV0YSA9IF9yZXBvcy5n\nZXRTZXF1ZW5jZU1ldGFEYXRhKHRoaXMsCiAgICAgICAgICAgICAgICBnZXRJ\nZGVudGl0eVNlcXVlbmNlTmFtZSgpLCB0cnVlKTsKICAgICAgICByZXR1cm4g\nX3NlcU1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbmZvcm1hdGlvbiBh\nYm91dCBsaWZlY3ljbGUgY2FsbGJhY2tzIGZvciB0aGlzIGNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgTGlmZWN5Y2xlTWV0YURhdGEgZ2V0TGlmZWN5Y2xl\nTWV0YURhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9saWZlTWV0YTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGFsaWFzIGZvciB0aGUgZGVz\nY3JpYmVkIHR5cGUsIG9yIDxjb2RlPm51bGw8L2NvZGU+IGlmIG5vbmUKICAg\nICAqIGhhcyBiZWVuIHNldC4KICAgICAqICAjc2VlCXNldFR5cGVBbGlhcwog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5cGVBbGlhcygpIHsKICAg\nICAgICBpZiAoX2FsaWFzID09IG51bGwpCiAgICAgICAgICAgIF9hbGlhcyA9\nIFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF90eXBlKTsKICAgICAgICByZXR1cm4g\nX2FsaWFzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB0aGUgYWxpYXMg\nZm9yIHRoZSBkZXNjcmliZWQgdHlwZS4gVGhlIGFsaWFzIGNhbiBiZQogICAg\nICogYW55IGFyYml0cmFyeSBzdHJpbmcgdGhhdCB0aGUgaW1wbGVtZW50YXRp\nb24gY2FuIGxhdGVyIHVzZSB0bwogICAgICogcmVmZXIgdG8gdGhlIGNsYXNz\nLgogICAgICoKICAgICAqIEBwYXJhbSBhbGlhcyB0aGUgYWxpYXMgbmFtZSB0\nbyBhcHBseSB0byB0aGUgZGVzY3JpYmVkIHR5cGUKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0VHlwZUFsaWFzKFN0cmluZyBhbGlhcykgewogICAgICAg\nIF9hbGlhcyA9IGFsaWFzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFj\nY2VzcyB0eXBlIHVzZWQgYnkgdGhpcyBjbGFzcy4gRWl0aGVyIHtAbGluayAj\nQUNDRVNTX0ZJRUxEfQogICAgICogb3Ige0BsaW5rICNBQ0NFU1NfUFJPUEVS\nVFl9LgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEFjY2Vzc1R5cGUoKSB7\nCiAgICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFDQ0VTU19VTktOT1dOKSB7\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1cC5nZXRBY2Nlc3NUeXBlKCk7CiAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldFJl\ncG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAgICAgICAg\nICAgICAgICBnZXREZWZhdWx0cygpLmdldERlZmF1bHRBY2Nlc3NUeXBlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hY2Nl\nc3NUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFjY2VzcyB0eXBl\nIHVzZWQgYnkgdGhpcyBjbGFzcy4gTXVzdCBiZSBlaXRoZXIKICAgICAqIHtA\nbGluayAjQUNDRVNTX0ZJRUxEfSBvciB7QGxpbmsgI0FDQ0VTU19QUk9QRVJU\nWX0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEFjY2Vzc1R5cGUoaW50\nIHR5cGUpIHsKICAgICAgICBfYWNjZXNzVHlwZSA9IHR5cGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHJlcXVpcmVzIGV4dGVu\ndCBtYW5hZ2VtZW50LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRS\nZXF1aXJlc0V4dGVudCgpIHsKICAgICAgICBpZiAoX293bmVyICE9IG51bGwg\nfHwgaXNFbWJlZGRlZE9ubHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwoKICAgICAgICBpZiAoX2V4dGVudCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2V4dGVudCA9IChzdXAuZ2V0UmVxdWlyZXNFeHRlbnQoKSkgPyBCb29s\nZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBC\nb29sZWFuLlRSVUU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZXh0ZW50\nLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgdHlwZSByZXF1aXJlcyBleHRlbnQgbWFuYWdlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0UmVxdWlyZXNFeHRlbnQoYm9vbGVhbiBy\nZXEpIHsKICAgICAgICBfZXh0ZW50ID0gKHJlcSkgPyBCb29sZWFuLlRSVUUg\nOiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgdHlwZSBjYW4gb25seSBiZSB1c2VkIGFzIGFuIGVtYmVkZGVkIG9i\namVjdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNFbWJlZGRlZE9u\nbHkoKSB7CiAgICAgICAgaWYgKF9lbWJlZGRlZCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2VtYmVkZGVkID0gKHN1cC5pc0VtYmVkZGVkT25seSgpKSA/\nIEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbi5G\nQUxTRTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2VtYmVk\nZGVkID0gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIF9lbWJlZGRlZC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBl\nbWJlZGRlZCBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVt\nYmVkZGVkT25seShib29sZWFuIGVtYmVkKSB7CiAgICAgICAgX2VtYmVkZGVk\nID0gKGVtYmVkKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFu\nYWdlZCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlz\nTWFuYWdlZEludGVyZmFjZSgpIHsKICAgICAgICBpZiAoIV90eXBlLmlzSW50\nZXJmYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBy\nZXR1cm4gX2ludGVyZmFjZSA9PSBudWxsID8gZmFsc2UgOiBfaW50ZXJmYWNl\nLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgdHlwZSBpcyBhIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldE1hbmFnZWRJbnRlcmZhY2UoYm9vbGVhbiBtYW5h\nZ2VkSW50ZXJmYWNlKSB7CiAgICAgICAgaWYgKCFfdHlwZS5pc0ludGVyZmFj\nZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vdC1pbnRlcmZhY2UiLCBfdHlwZSkpOwogICAgICAgIF9p\nbnRlcmZhY2UgPSBtYW5hZ2VkSW50ZXJmYWNlID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbWFuYWdlZCBpbnRlcmZhY2UgaW1wbGVtZW50b3IgaWYgYW55LgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3MgZ2V0SW50ZXJmYWNlSW1wbCgpIHsKICAg\nICAgICByZXR1cm4gX2ltcGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIG1hbmFnZWQgaW50ZXJmYWNlIGltcGxlbWVudG9yIGNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbnRlcmZhY2VJbXBsKENsYXNzIGlt\ncGwpIHsKICAgICAgICBfaW1wbCA9IGltcGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYWxsIGV4cGxpY2l0bHkgZGVjbGFyZWQgaW50ZXJmYWNl\ncyB0aGlzIGNsYXNzIGltcGxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzc1tdIGdldERlY2xhcmVkSW50ZXJmYWNlcygpIHsKICAgICAgICBpZiAo\nX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ldGFE\nYXRhUmVwb3NpdG9yeS5FTVBUWV9DTEFTU0VTOwogICAgICAgIHJldHVybiAo\nQ2xhc3NbXSkgX2ludGVyZmFjZXMudG9BcnJheShuZXcgQ2xhc3NbX2ludGVy\nZmFjZXMuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHBsaWNp\ndGx5IGRlY2xhcmUgdGhlIGdpdmVuIGludGVyZmFjZSBhbW9uZyB0aGUgb25l\ncyB0aGlzCiAgICAgKiBjbGFzcyBpbXBsZW1lbnRzLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBhZGREZWNsYXJlZEludGVyZmFjZShDbGFzcyBpZmFjZSkg\newogICAgICAgIGlmIChpZmFjZSA9PSBudWxsIHx8ICFpZmFjZS5pc0ludGVy\nZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImRlY2xhcmUtbm9uLWludGVyZmFjZSIsCiAgICAgICAg\nICAgICAgICB0aGlzLCBpZmFjZSkpOwogICAgICAgIGlmIChfaW50ZXJmYWNl\ncyA9PSBudWxsKQogICAgICAgICAgICBfaW50ZXJmYWNlcyA9IG5ldyBBcnJh\neUxpc3QoKTsKICAgICAgICBfaW50ZXJmYWNlcy5hZGQoaWZhY2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBpbnRlcmZhY2Ug\nZnJvbSB0aGUgZGVjbGFyZWQgbGlzdC4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gcmVtb3ZlRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsK\nICAgICAgICBpZiAoX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfaW50ZXJmYWNlcy5yZW1v\ndmUoaWZhY2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxpYXMgcHJvcGVy\ndGllcyBmcm9tIHRoZSBnaXZlbiBpbnRlcmZhY2UgZHVyaW5nICBxdWVyaWVz\nIHRvCiAgICAgKiB0aGUgbG9jYWwgZmllbGQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEludGVyZmFjZVByb3BlcnR5QWxpYXMoQ2xhc3MgaWZhY2Us\nIFN0cmluZyBvcmlnLCAKICAgICAgICBTdHJpbmcgbG9jYWwpIHsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKF9pZmFjZU1hcCkgewogICAgICAgICAgICBNYXAg\nZmllbGRzID0gKE1hcCkgX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAg\nICAgIGlmIChmaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmll\nbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9pZmFjZU1h\ncC5wdXQoaWZhY2UsIGZpZWxkcyk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKGZpZWxkcy5jb250YWluc0tleShvcmlnKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZHVw\nbGljYXRlLWlmYWNlLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgdGhp\ncywgb3JpZywgbG9jYWwpKTsKICAgICAgICAgICAgZmllbGRzLnB1dChvcmln\nLCBsb2NhbCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAq\nIEdldCBsb2NhbCBmaWVsZCBhbGlhcyBmb3IgdGhlIGdpdmVuIGludGVyZmFj\nZSBwcm9wZXJ0eS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJbnRl\ncmZhY2VQcm9wZXJ0eUFsaWFzKENsYXNzIGlmYWNlLCBTdHJpbmcgb3JpZykg\newogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAgICAg\nICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0KGlmYWNlKTsK\nICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKSBm\naWVsZHMuZ2V0KG9yaWcpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYWxsIGFsaWFzZXMgcHJvcGVydHkgbmFtZWQgZm9y\nIHRoZSBnaXZlbiBpbnRlcmZhY2UuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmdbXSBnZXRJbnRlcmZhY2VBbGlhc2VkUHJvcGVydGllcyhDbGFzcyBpZmFj\nZSkgewogICAgICAgIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAg\nICAgICAgIE1hcCBmaWVsZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0KGlmYWNl\nKTsKICAgICAgICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgICAgIHJldHVy\nbiAoU3RyaW5nW10pIGZpZWxkcy5rZXlTZXQoKS50b0FycmF5KG5ldyBTdHJp\nbmdbMF0pOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIG51bWJlciBvZiBmaWVsZHMgdGhhdCB1c2UgaW1wbCBvciBp\nbnRlcm1lZGlhdGUgZGF0YSwgaW4KICAgICAqIG9yZGVyIHRvIGNyZWF0ZSBh\nIGNvbXBhY3RlZCBhcnJheSBmb3Igc3RvcmFnZSBvZiBzYWlkIGRhdGEuCiAg\nICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgo\nKSB7CiAgICAgICAgaW50W10gdGFibGUgPSBnZXRFeHRyYUZpZWxkRGF0YVRh\nYmxlKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IHRhYmxlLmxlbmd0aCAtIDE7\nIGkgPj0gMDsgaS0tKQogICAgICAgICAgICBpZiAodGFibGVbaV0gIT0gLTEp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdGFibGVbaV0gKyAxOwogICAgICAg\nIHJldHVybiAwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBp\nbXBsIC8gaW50ZXJtZWRpYXRlIGZpZWxkIGRhdGEgaW5kZXggb2YgdGhlIGdp\ndmVuIGZpZWxkCiAgICAgKiBpbiB0aGUgY29tcGFjdGVkIGFycmF5LCBvciAt\nMSBpZiB0aGUgZmllbGQgZG9lcyBub3QgdXNlIGV4dHJhIGRhdGEuCiAgICAg\nKgogICAgICogQHNlZSAjZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgKICAgICAq\nLwogICAgcHVibGljIGludCBnZXRFeHRyYUZpZWxkRGF0YUluZGV4KGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBnZXRFeHRyYUZpZWxkRGF0YVRhYmxl\nKClbZmllbGRdOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhIHRh\nYmxlIG1hcHBpbmcgZWFjaCBmaWVsZCBpbmRleCB0byBpdHMgZXh0cmEgZGF0\nYSBpbmRleC4KICAgICAqLwogICAgcHJpdmF0ZSBpbnRbXSBnZXRFeHRyYUZp\nZWxkRGF0YVRhYmxlKCkgewogICAgICAgIGlmIChfZmllbGREYXRhVGFibGUg\nPT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnRbXSB0YWJsZSA9IG5ldyBp\nbnRbZm1kcy5sZW5ndGhdOwogICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS51c2VzSW50ZXJtZWRp\nYXRlKCkKICAgICAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLnVzZXNJbXBs\nRGF0YSgpICE9IEJvb2xlYW4uRkFMU0UpCiAgICAgICAgICAgICAgICAgICAg\ndGFibGVbaV0gPSBpZHgrKzsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICB0YWJsZVtpXSA9IC0xOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9maWVsZERhdGFUYWJsZSA9IHRhYmxlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2ZpZWxkRGF0YVRhYmxlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIG5hbWUgcmVwcmVz\nZW50cyBhIG1hbmFnZWQgb3Igc3RhdGljIGZpZWxkIG9mCiAgICAgKiB0aGlz\nIGNsYXNzLCBpbmNsdWRpbmcgc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzQWNjZXNzaWJsZUZpZWxkKFN0cmluZyBm\naWVsZCkgewogICAgICAgIGlmIChnZXREZWNsYXJlZEZpZWxkKGZpZWxkKSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nX3N0YXRpY0ZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkW10g\nZmllbGRzID0gX3R5cGUuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAg\nICAgU2V0IG5hbWVzID0gbmV3IEhhc2hTZXQoKGludCkgKGZpZWxkcy5sZW5n\ndGggKiAxLjMzICsgMSkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChN\nb2RpZmllci5pc1N0YXRpYyhmaWVsZHNbaV0uZ2V0TW9kaWZpZXJzKCkpKQog\nICAgICAgICAgICAgICAgICAgIG5hbWVzLmFkZChmaWVsZHNbaV0uZ2V0TmFt\nZSgpKTsKICAgICAgICAgICAgX3N0YXRpY0ZpZWxkcyA9IG5hbWVzOwogICAg\nICAgIH0KICAgICAgICBpZiAoX3N0YXRpY0ZpZWxkcy5jb250YWlucyhmaWVs\nZCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChfc3Vw\nZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCkuaXNBY2Nlc3NpYmxlRmllbGQoZmllbGQpOwogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nbGwgZmllbGQgbWV0YWRhdGFzLCBpbmNsdWRpbmcgc3VwZXJjbGFzcyBmaWVs\nZHMuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0Rmll\nbGRzKCkgewogICAgICAgIGlmIChfYWxsRmllbGRzID09IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF9zdXBlciA9PSBudWxsKQogICAgICAgICAgICAgICAg\nX2FsbEZpZWxkcyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxk\ncyA9IGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gc3VwRmllbGRzID0gZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKS4KICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZHMoKTsKCiAgICAg\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gYWxsRmllbGRzID0gX3JlcG9z\nLm5ld0ZpZWxkTWV0YURhdGFBcnJheQogICAgICAgICAgICAgICAgICAgIChm\naWVsZHMubGVuZ3RoICsgc3VwRmllbGRzLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBTeXN0ZW0uYXJyYXljb3B5KHN1cEZpZWxkcywgMCwgYWxsRmllbGRz\nLCAwLCBzdXBGaWVsZHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJlcGxh\nY2VEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcyhhbGxGaWVsZHMsIHN1cEZpZWxk\ncy5sZW5ndGgpOwoKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAg\nZmllbGRzW2ldLnNldEluZGV4KHN1cEZpZWxkcy5sZW5ndGggKyBpKTsKICAg\nICAgICAgICAgICAgICAgICBhbGxGaWVsZHNbc3VwRmllbGRzLmxlbmd0aCAr\nIGldID0gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgX2FsbEZpZWxkcyA9IGFsbEZpZWxkczsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbEZpZWxkczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlcGxhY2Ugc3VwZXJjbGFzcyBmaWVsZHMgdGhhdCB3\nZSBkZWZpbmUgd2l0aCBvdXIgdmVyc2lvbi4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHJlcGxhY2VEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcyhGaWVsZE1l\ndGFEYXRhW10gZmllbGRzLAogICAgICAgIGludCBsZW4pIHsKICAgICAgICBp\nZiAoX3N1cEZpZWxkTWFwID09IG51bGwgfHwgIV9kZWZTdXBGaWVsZHMpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZG9uJ3QgYXNzdW1lIGZp\nZWxkcyBhcmUgaW4gb3JkZXI7IHRoaXMgbWV0aG9kIGlzIHVzZWQgZm9yCiAg\nICAgICAgLy8gbGlzdGluZyBvcmRlciBhcyB3ZWxsCiAgICAgICAgRmllbGRN\nZXRhRGF0YSBzdXBGaWVsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHN1cEZpZWxkID0gKEZpZWxkTWV0\nYURhdGEpIF9zdXBGaWVsZE1hcC5nZXQoZmllbGRzW2ldLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgIGlmIChzdXBGaWVsZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBmaWVsZHNbaV0gPSBzdXBGaWVsZDsKICAgICAgICAgICAgICAg\nIHN1cEZpZWxkLnNldEluZGV4KGkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdXBlcmNsYXNz\nIGNvcHkgb2YgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0\nZWQgRmllbGRNZXRhRGF0YSBnZXRTdXBlcmNsYXNzRmllbGQoRmllbGRNZXRh\nRGF0YSBzdXBGaWVsZCkgewogICAgICAgIENsYXNzTWV0YURhdGEgc20gPSBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gc20gPT0gbnVsbCA/IG51bGwgOiBzbS5nZXRGaWVsZChzdXBG\naWVsZC5nZXROYW1lKCkpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCB8fCBm\nbWQuZ2V0TWFuYWdlbWVudCgpICE9IGZtZC5NQU5BR0VfUEVSU0lTVEVOVCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ1bm1hbmFnZWQtc3VwLWZpZWxkIiwKICAgICAgICAgICAgICAgIHN1\ncEZpZWxkLCB0aGlzKSk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBvbmx5IHRoZSBmaWVsZHMgZm9yIHRoaXMg\nY2xhc3MsIHdpdGhvdXQgc3VwZXJjbGFzcyBmaWVsZHMuCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVjbGFyZWRGaWVsZHMoKSB7\nCiAgICAgICAgaWYgKF9maWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBM\naXN0IGZpZWxkcyA9IG5ldyBBcnJheUxpc3QoX2ZpZWxkTWFwLnNpemUoKSk7\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9maWVsZE1hcC52YWx1ZXMoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgZm1kID0g\nKEZpZWxkTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAoZm1kLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFH\nRV9OT05FKSB7CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldERlY2xhcmVk\nSW5kZXgoZmllbGRzLnNpemUoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGZtZC5nZXRJbmRleCgpID09IC0xKQogICAgICAgICAgICAgICAgICAgICAg\nICBmbWQuc2V0SW5kZXgoZm1kLmdldERlY2xhcmVkSW5kZXgoKSk7CiAgICAg\nICAgICAgICAgICAgICAgZmllbGRzLmFkZChmbWQpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZHMgPSAoRmll\nbGRNZXRhRGF0YVtdKSBmaWVsZHMudG9BcnJheQogICAgICAgICAgICAgICAg\nKF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkoZmllbGRzLnNpemUoKSkp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpZWxkczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBwcmltYXJ5IGtleSBmaWVsZHMsIG9yIGVt\ncHR5IGFycmF5IGlmIG5vbmUuIFRoZSBvcmRlcgogICAgICogaW4gd2hpY2gg\ndGhlIGtleXMgYXJlIHJldHVybmVkIHdpbGwgYmUgdGhlIG9yZGVyIGluIHdo\naWNoCiAgICAgKiB0aGUgZmllbGRzIGFyZSBkZWNsYXJlZCwgc3RhcnRpbmcg\nYXQgdGhlIGxlYXN0LWRlcml2ZWQgc3VwZXJjbGFzcwogICAgICogYW5kIGVu\nZGluZyB3aXRoIHRoZSBwcmltYXJ5IGtleSBmaWVsZHMgb2YgdGhlIG1vc3Qt\nZGVyaXZlZCBzdWJjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGFbXSBnZXRQcmltYXJ5S2V5RmllbGRzKCkgewogICAgICAgIC8vIGNo\nZWNrIGZvciBwayBmaWVsZHMgZXZlbiBpZiBub3Qgc2V0IHRvIElEX0FQUExJ\nQ0FUSU9OIHNvIHRoYXQKICAgICAgICAvLyBhcHAgaWQgdG9vbCBzZWVzIHRo\nZW0gZXZlbiB3aGVuIHVzZXIgZG9lc24ndCBkZWNsYXJlIGFwcCBpZAogICAg\nICAgIGlmIChfYWxsUEtGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAgICAgICAg\nICAgIGludCBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChm\naWVsZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICAgICAg\nbnVtKys7CgogICAgICAgICAgICBpZiAobnVtID09IDApCiAgICAgICAgICAg\nICAgICBfYWxsUEtGaWVsZHMgPSBfcmVwb3MuRU1QVFlfRklFTERTOwogICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBwa3MgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAg\nICAgICAgICAgICAgICBudW0gPSAwOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5zZXRQcmltYXJ5S2V5\nSW5kZXgobnVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGtzW251bV0g\nPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIG51bSsrOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIF9hbGxQS0ZpZWxkcyA9IHBrczsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbFBLRmllbGRzOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsaXN0IG9mIGZpZWxkcyBpbiB0\naGUgZGVmYXVsdCBmZXRjaCBncm91cCwKICAgICAqIGluY2x1ZGluZyBzdXBl\ncmNsYXNzIGZpZWxkcywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgbm9uZS4KICAg\nICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZhdWx0RmV0\nY2hHcm91cEZpZWxkcygpIHsKICAgICAgICBpZiAoX2FsbERGR0ZpZWxkcyA9\nPSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMg\nPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc0luRGVmYXVsdEZl\ndGNoR3JvdXAoKSkKICAgICAgICAgICAgICAgICAgICBudW0rKzsKCiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBkZmdzID0gX3JlcG9zLm5ld0ZpZWxk\nTWV0YURhdGFBcnJheShudW0pOwogICAgICAgICAgICBudW0gPSAwOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNJbkRlZmF1bHRG\nZXRjaEdyb3VwKCkpCiAgICAgICAgICAgICAgICAgICAgZGZnc1tudW0rK10g\nPSBmaWVsZHNbaV07CiAgICAgICAgICAgIF9hbGxERkdGaWVsZHMgPSBkZmdz\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbERGR0ZpZWxkczsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmVyc2lvbiBmaWVsZCBm\nb3IgdGhpcyBjbGFzcywgaWYgYW55LgogICAgICovCiAgICBwdWJsaWMgRmll\nbGRNZXRhRGF0YSBnZXRWZXJzaW9uRmllbGQoKSB7CiAgICAgICAgaWYgKF92\nZXJzaW9uSWR4ID09IEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAg\nICAgICAgaW50IGlkeCA9IC0xOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKGZpZWxkc1tpXS5pc1ZlcnNpb24oKSkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChpZHggIT0gLTEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKCJtdWx0LXZlcnMtZmllbGRzIiwgdGhpcywg\nZmllbGRzW2lkeF0sIGZpZWxkc1tpXSkpOwogICAgICAgICAgICAgICAgICAg\nIGlkeCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX3ZlcnNpb25JZHggPSBpZHg7CiAgICAgICAgfQogICAgICAg\nIGlmIChfdmVyc2lvbklkeCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIGdldEZpZWxkcygpW192ZXJzaW9uSWR4XTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9y\nIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0aAog\nICAgICogdGhlIGdpdmVuIGFic29sdXRlIGluZGV4LgogICAgICoKICAgICAq\nIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90\nIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZp\nZWxkKGludCBpbmRleCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVs\nZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGlu\nZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3Rl\nbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2\nZW4gcmVsYXRpdmUgaW5kZXguCiAgICAgKgogICAgICogQHJldHVybiB0aGUg\nZmllbGQncyBtZXRhZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQKICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVjbGFyZWRGaWVsZChp\nbnQgaW5kZXgpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0g\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAwIHx8\nIGluZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBlcnNp\nc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0aGUg\nZ2l2ZW4gbmFtZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdz\nIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBw\ndWJsaWMgRmllbGRNZXRhRGF0YSBnZXRGaWVsZChTdHJpbmcgbmFtZSkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gZ2V0RGVjbGFyZWRGaWVsZChu\nYW1lKTsKICAgICAgICBpZiAoZm1kICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBmbWQ7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCAhPSBudWxsICYm\nIF9kZWZTdXBGaWVsZHMpIHsKICAgICAgICAgICAgZm1kID0gKEZpZWxkTWV0\nYURhdGEpIF9zdXBGaWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAgICAgIGlm\nIChmbWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBmbWQ7CiAg\nICAgICAgfQogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGQo\nbmFtZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lzdGVudCBv\nciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBnaXZlbiBu\nYW1lLCB3aXRob3V0IGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxkcy4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBu\ndWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRh\nRGF0YSBnZXREZWNsYXJlZEZpZWxkKFN0cmluZyBuYW1lKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBfZmllbGRN\nYXAuZ2V0KG5hbWUpOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsIHx8IGZp\nZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBmaWVsZC5NQU5BR0VfTk9ORSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFueSBmaWVsZHMgdGhhdCB3\nZXJlIGFkZGVkIGFzIG5vbi1tYW5hZ2VkLgogICAgICogQWxsIG90aGVyIG1l\ndGhvZHMgdG8gZ2V0IGZpZWxkcyByZXR1cm4gb25seSB0aG9zZSB0aGF0IGFy\nZSBtYW5hZ2VkLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtd\nIGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCkgewogICAgICAgIGlmIChf\ndW5tZ2RGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBDb2xsZWN0aW9u\nIHVubWFuYWdlZCA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGEgZmllbGQ7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IChGaWVsZE1ldGFE\nYXRhKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkLmdl\ndE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQog\nICAgICAgICAgICAgICAgICAgIHVubWFuYWdlZC5hZGQoZmllbGQpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIF91bm1nZEZpZWxkcyA9IChGaWVsZE1l\ndGFEYXRhW10pIHVubWFuYWdlZC50b0FycmF5CiAgICAgICAgICAgICAgICAo\nX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheSh1bm1hbmFnZWQuc2l6ZSgp\nKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfdW5tZ2RGaWVsZHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgZmllbGQgbWV0YWRhdGEg\ndG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURh\ndGEgYWRkRGVjbGFyZWRGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSkg\newogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5ld0ZpZWxk\nTWV0YURhdGEobmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgY2xlYXJGaWVs\nZENhY2hlKCk7CiAgICAgICAgX2ZpZWxkTWFwLnB1dChuYW1lLCBmbWQpOwog\nICAgICAgIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1v\ndmUgdGhlIGdpdmVuIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAgICAqCiAg\nICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1vdmVkLCBm\nYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVt\nb3ZlRGVjbGFyZWRGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7CiAgICAg\nICAgaWYgKGZpZWxkICE9IG51bGwgJiYgX2ZpZWxkTWFwLnJlbW92ZShmaWVs\nZC5nZXROYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJGaWVs\nZENhY2hlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGRlZmluZWQgc3VwZXJjbGFzcyBmaWVsZCB3aXRoIHRoZSBn\naXZlbiBuYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBGaWVsZE1ldGFEYXRhIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoU3Ry\naW5nIG5hbWUpIHsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoRmll\nbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBhIG5ldyBkZWZpbmVkIHN1cGVyY2xhc3MgZmll\nbGQgbWV0YWRhdGEgdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGlj\nIEZpZWxkTWV0YURhdGEgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChTdHJp\nbmcgbmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzcyBzdXApIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVsZE1ldGFE\nYXRhKG5hbWUsIHR5cGUsIHRoaXMpOwogICAgICAgIGZtZC5zZXREZWNsYXJp\nbmdUeXBlKHN1cCk7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAg\nICAgICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgICAgIGlmIChfc3Vw\nRmllbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX3N1cEZpZWxkTWFwID0g\nbmV3IEhhc2hNYXAoKTsKICAgICAgICBfc3VwRmllbGRNYXAucHV0KG5hbWUs\nIGZtZCk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50Lgog\nICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2FzIHJl\nbW92ZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiByZW1vdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKEZpZWxkTWV0YURh\ndGEgZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfc3Vw\nRmllbGRNYXAgIT0gbnVsbAogICAgICAgICAgICAmJiBfc3VwRmllbGRNYXAu\ncmVtb3ZlKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAg\nICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgX2RlZlN1cEZp\nZWxkcyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogSW5jb3Jwb3JhdGUgc3VwZXJjbGFzcyBmaWVsZHMgcmVkZWZpbmVkIGlu\nIHRoaXMgc3ViY2xhc3MgaW50byB0aGlzCiAgICAgKiBtZXRhZGF0YS4gVGhp\ncyBtZXRob2QgaXMgZ2VuZXJhbGx5IGNhbGxlZCBhZnRlciBtZXRhZGF0YSBp\ncyByZXNvbHZlZAogICAgICogYW5kIG1hcHBpbmcgaW5mb3JtYXRpb24gaXMg\nbG9hZGVkLCBidXQgYmVmb3JlIG1hcHBpbmcgcmVzb2x2ZS4KICAgICAqCiAg\nICAgKiBAcGFyYW0gZm9yY2Ugd2hldGhlciB0byBmb3JjZSByZS1tYXBwaW5n\nIG9mIGV2ZW4gbWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGRlZmluZVN1cGVyY2xhc3NGaWVsZHMoYm9vbGVhbiBm\nb3JjZSkgewogICAgICAgIGlmIChfZGVmU3VwRmllbGRzKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoaXNNYXBwZWQoKSAm\nJiBzdXAgIT0gbnVsbCkgewogICAgICAgICAgICAvLyByZWRlZmluZSBhbGwg\ndW5tYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIHN1cHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgaWYgKChmb3JjZSB8fCAhc3Vwc1tpXS5nZXREZWZpbmlu\nZ01ldGFEYXRhKCkuaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAgICAgICAm\nJiBnZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgp\nKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkRGVmaW5lZFN1\ncGVyY2xhc3NGaWVsZChzdXBzW2ldLmdldE5hbWUoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgc3Vwc1tp\nXS5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc29sdmVEZWZpbmVkU3Vw\nZXJjbGFzc0ZpZWxkcygpOwoKICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhh\ndCBhbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRzIGFyZSBj\nYWNoZWQuCiAgICAgICAgLy8gSSBkb24ndCBsaWtlIGRvaW5nIHRoaXMgdHdp\nY2UgKGl0J3MgYWxzbyBkb25lIGluIHJlc29sdmVNZXRhKSwgYnV0CiAgICAg\nICAgLy8gd2UgaGF2ZSB0byByZS1jYWNoZSBpbiBjYXNlIHRoaXMgY2xhc3Mg\nb3IgYW55IHN1cGVyY2xhc3MgcmVwbGFjZWQKICAgICAgICAvLyBzb21lIGZp\nZWxkcyB3aXRoIHJlZGVmaW5lZCB2ZXJzaW9ucywgYW5kIEkgZG9uJ3Qgd2Fu\ndCBvdXRzaWRlIGNvZGUKICAgICAgICAvLyB0byBoYXZlIHRvIGNhbGwgdGhp\ncyBtZXRob2QgYWZ0ZXIgcmVzb2x2ZSBqdXN0IHRvIGdldCBmaWVsZCBpbmRl\neGVzLAogICAgICAgIC8vIGV0YyBzZXQgY29ycmVjdGx5CiAgICAgICAgY2xl\nYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgY2FjaGVGaWVsZHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgc3VwZXJjbGFzcyBmaWVsZHMg\nd2UndmUgcmVkZWZpbmVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVz\nb2x2ZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCkgewogICAgICAgIF9kZWZT\ndXBGaWVsZHMgPSB0cnVlOwogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZDsKICAgICAgICBGaWVsZE1ldGFEYXRhIHN1cDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IF9zdXBGaWVsZE1hcC52YWx1ZXMoKS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBmbWQgPSAo\nRmllbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgc3VwID0g\nZ2V0U3VwZXJjbGFzc0ZpZWxkKGZtZCk7CgogICAgICAgICAgICAvLyBqcGEg\nbWV0YWRhdGEgZG9lc24ndCBxdWFsaWZ5IHN1cGVyY2xhc3MgZmllbGQgbmFt\nZXMsIHNvIHdlCiAgICAgICAgICAgIC8vIG1pZ2h0IG5vdCBrbm93IHRoZSBk\nZWNsYXJpbmcgdHlwZSB1bnRpbCBub3cKICAgICAgICAgICAgaWYgKGZtZC5n\nZXREZWNsYXJpbmdUeXBlKCkgPT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAg\nICAgICAgICBmbWQuc2V0RGVjbGFyaW5nVHlwZShzdXAuZ2V0RGVjbGFyaW5n\nVHlwZSgpKTsKICAgICAgICAgICAgICAgIGZtZC5iYWNraW5nTWVtYmVyKGdl\ndFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAgICAgICAg\nICAgICAgICAgICBnZXREZWZhdWx0cygpLmdldEJhY2tpbmdNZW1iZXIoZm1k\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm1kLmNvcHkoc3VwKTsK\nICAgICAgICAgICAgZm1kLnJlc29sdmUoTU9ERV9NRVRBKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGFs\nbCB0aGUgZmllbGRzIGRlZmluZWQgYnkgdGhpcyBjbGFzcy4KICAgICAqIFRo\naXMgaW5jbHVkZXMgbWFwcGVkIGRlY2xhcmVkIGZpZWxkcyBhbmQgYW55IGNv\nbmNyZXRlIG1hcHBpbmcgb2YKICAgICAqIHVubWFwcGVkIHN1cGVyY2xhc3Mg\nZmllbGRzIHBlcmZvcm1lZCBieSB0aGlzIGNsYXNzLgogICAgICovCiAgICBw\ndWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlZmluZWRGaWVsZHMoKSB7CiAg\nICAgICAgaWYgKF9kZWZpbmVkRmllbGRzID09IG51bGwpIHsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAg\nICAgICAgICBMaXN0IGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5s\nZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tp\nXS5pc01hcHBlZCgpCiAgICAgICAgICAgICAgICAgICAgJiYgZmllbGRzW2ld\nLmdldERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKQogICAgICAgICAgICAg\nICAgICAgIGRlZmluZWQuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgX2RlZmluZWRGaWVsZHMgPSAoRmllbGRNZXRhRGF0YVtd\nKSBkZWZpbmVkLnRvQXJyYXkKICAgICAgICAgICAgICAgIChfcmVwb3MubmV3\nRmllbGRNZXRhRGF0YUFycmF5KGRlZmluZWQuc2l6ZSgpKSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfZGVmaW5lZEZpZWxkczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgYWxsIGZpZWxkcyBpbiB0aGUgb3JkZXIgdGhl\neSBhcmUgbGlzdGVkIGluIHRoZSBtZXRhZGF0YQogICAgICogZmlsZS4gVW5s\naXN0ZWQgZmllbGRzIGFyZSBwbGFjZWQgYWZ0ZXIgbGlzdGVkIG9uZXMuCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RmllbGRzSW5M\naXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9hbGxMaXN0aW5nRmllbGRz\nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gY29tYmluZSBkZWNsYXJlZCBh\nbmQgdW5tYW5hZ2VkIGZpZWxkcyBpbnRvIGxpc3Rpbmcgb3JkZXIgYXJyYXkK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRlYyA9IGdldERlY2xhcmVk\nRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1bm1nZCA9\nIGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBkZWNMaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0\nYURhdGFBcnJheQogICAgICAgICAgICAgICAgKGRlYy5sZW5ndGggKyB1bm1n\nZC5sZW5ndGgpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGRlYywg\nMCwgZGVjTGlzdGluZywgMCwgZGVjLmxlbmd0aCk7CiAgICAgICAgICAgIFN5\nc3RlbS5hcnJheWNvcHkodW5tZ2QsIDAsIGRlY0xpc3RpbmcsIGRlYy5sZW5n\ndGgsIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KGRl\nY0xpc3RpbmcsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5zdGFuY2Uo\nKSk7CgogICAgICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfYWxsTGlzdGluZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gcGxhY2Ugc3VwZXJj\nbGFzcyBmaWVsZHMgaW4gbGlzdGluZyBvcmRlciBiZWZvcmUgb3VyCiAgICAg\nICAgICAgICAgICAvLyBsaXN0aW5nLW9yZGVyIGRlY2xhcmVkIGZpZWxkcwog\nICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1cCA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0Rmll\nbGRzSW5MaXN0aW5nT3JkZXIoKTsKICAgICAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBsaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJh\neQogICAgICAgICAgICAgICAgICAgIChzdXAubGVuZ3RoICsgZGVjTGlzdGlu\nZy5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShz\ndXAsIDAsIGxpc3RpbmcsIDAsIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAg\nICAgcmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKGxpc3RpbmcsIHN1\ncC5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShk\nZWNMaXN0aW5nLCAwLCBsaXN0aW5nLCBzdXAubGVuZ3RoLAogICAgICAgICAg\nICAgICAgICAgIGRlY0xpc3RpbmcubGVuZ3RoKTsKICAgICAgICAgICAgICAg\nIF9hbGxMaXN0aW5nRmllbGRzID0gbGlzdGluZzsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbExpc3RpbmdGaWVsZHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBmaWVsZHMgZGVmaW5l\nZCBieSB0aGlzIGNsYXNzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQK\nICAgICAqIGluIHRoZSBtZXRhZGF0YSBmaWxlLiBVbmxpc3RlZCBmaWVsZHMg\nYXJlIHBsYWNlZCBhZnRlciBsaXN0ZWQgb25lcy4KICAgICAqIFRoaXMgYXJy\nYXkgaW5jbHVkZXMgZGVjbGFyZWQgdHJhbnNhY3Rpb25hbCBhbmQgdW5tYW5h\nZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFb\nXSBnZXREZWZpbmVkRmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAg\naWYgKF9saXN0aW5nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAg\nICBMaXN0IGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0RGVm\naW5pbmdNZXRhRGF0YSgpID09IHRoaXMpCiAgICAgICAgICAgICAgICAgICAg\nZGVmaW5lZC5hZGQoZmllbGRzW2ldKTsKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIHVubWdkID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3Mu\nbmV3RmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVmaW5l\nZC5zaXplKCkgKyB1bm1nZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGRlZmluZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAg\nICAgICBsaXN0aW5nW2ldID0gKEZpZWxkTWV0YURhdGEpIGRlZmluZWQuZ2V0\nKGkpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KHVubWdkLCAwLCBs\naXN0aW5nLCBkZWZpbmVkLnNpemUoKSwgdW5tZ2QubGVuZ3RoKTsKICAgICAg\nICAgICAgQXJyYXlzLnNvcnQobGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFy\nYXRvci5nZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgX2xpc3RpbmdGaWVs\nZHMgPSBsaXN0aW5nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2xpc3Rp\nbmdGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0\naGUgZGF0YWNhY2hlIHRvIHVzZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERhdGFDYWNo\nZU5hbWUoKSB7CiAgICAgICAgaWYgKF9jYWNoZU5hbWUgPT0gREVGQVVMVF9T\nVFJJTkcpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX2NhY2hlTmFtZSA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkuZ2V0RGF0YUNhY2hlTmFtZSgpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBfY2FjaGVOYW1lID0gRGF0YUNhY2hlLk5BTUVfREVG\nQVVMVDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jYWNoZU5hbWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hlIG5hbWUgZm9yIHRo\naXMgY2xhc3MuIFNldCB0byBudWxsIHRvIGRpc2FibGUgY2FjaGluZy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0YUNhY2hlTmFtZShTdHJpbmcg\nbmFtZSkgewogICAgICAgIF9jYWNoZU5hbWUgPSBuYW1lOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIGNhY2hlIHRpbWVvdXQgZm9yIHRoaXMgY2xhc3Mu\nIC0xIGluZGljYXRlcyBubyB0aW1lb3V0LgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldERhdGFDYWNoZVRpbWVvdXQoKSB7CiAgICAgICAgaWYgKF9jYWNo\nZVRpbWVvdXQgPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAgICAg\naWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NhY2hlVGlt\nZW91dCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAg\nICAgICAgICAgZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfY2FjaGVUaW1lb3V0ID0gX3JlcG9zLmdl\ndENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgICAgICBnZXREYXRh\nQ2FjaGVUaW1lb3V0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2Fj\naGVUaW1lb3V0OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGNhY2hlIHRp\nbWVvdXQgZm9yIHRoaXMgY2xhc3MuIC0xIGluZGljYXRlcyBubyB0aW1lb3V0\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVUaW1lb3V0\nKGludCB0aW1lb3V0KSB7CiAgICAgICAgX2NhY2hlVGltZW91dCA9IHRpbWVv\ndXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGEgY2Fj\naGUgZm9yIHRoaXMgY2xhc3MsIG9yIG51bGwgaWYgaXQgaXMgbm90IGNhY2hh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgRGF0YUNhY2hlIGdldERhdGFDYWNo\nZSgpIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGdldERhdGFDYWNoZU5hbWUo\nKTsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gX3JlcG9zLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS4KICAgICAgICAg\nICAgZ2V0RGF0YUNhY2hlKG5hbWUsIHRydWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciBpbnN0YW5jZXMgYXJlIGRldGFjaGFibGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRGV0YWNoYWJsZSgpIHsKICAgICAg\nICBpZiAoX2RldGFjaGFibGUgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGV0YWNoYWJsZSA9\nIChnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmlzRGV0YWNoYWJsZSgpKQog\nICAgICAgICAgICAgICAgICAgID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5G\nQUxTRTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2RldGFj\naGFibGUgPSBCb29sZWFuLkZBTFNFOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2RldGFjaGFibGUuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJsZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoYWJsZShib29sZWFuIGRl\ndGFjaGFibGUpIHsKICAgICAgICBfZGV0YWNoYWJsZSA9IChkZXRhY2hhYmxl\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGV0YWNoIHN0YXRlIGZpZWxk\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0RGV0YWNoZWRTdGF0ZSgpIHsKICAgICAgICBpZiAoX2RldGFjaFN0YXRl\nID09IERFRkFVTFRfU1RSSU5HKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAg\nICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5pc0RldGFjaGFibGUoKSA9PSBp\nc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgIF9kZXRhY2hTdGF0ZSA9\nIHN1cC5nZXREZXRhY2hlZFN0YXRlKCk7CiAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgQm9vbGVhbiB1c2UgPSB1c2VzRGV0YWNoZWRTdGF0\nZShTWU5USEVUSUMsIHRydWUpOwogICAgICAgICAgICAgICAgX2RldGFjaFN0\nYXRlID0gKEJvb2xlYW4uRkFMU0UuZXF1YWxzKHVzZSkpID8gbnVsbCA6IFNZ\nTlRIRVRJQzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2RldGFjaFN0YXRlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG5h\nbWUgb2YgdGhlIGRldGFjaCBzdGF0ZSBmaWVsZCwgb3IgbnVsbCBpZiBub25l\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hlZFN0YXRlKFN0\ncmluZyBmaWVsZCkgewogICAgICAgIF9kZXRhY2hTdGF0ZSA9IGZpZWxkOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZXRhY2ggc3RhdGUg\nZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkIGdldERldGFjaGVkU3RhdGVGaWVsZCgpIHsKICAgICAgICAvLyBubyBj\nYWNoaW5nOyBvbmx5IHVzZWQgYXQgZW5oYW5jZW1lbnQKICAgICAgICBTdHJp\nbmcgZmllbGROYW1lID0gZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIGlm\nIChmaWVsZE5hbWUgPT0gbnVsbCB8fCBTWU5USEVUSUMuZXF1YWxzKGZpZWxk\nTmFtZSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBmb3Ig\nKENsYXNzIHR5cGUgPSBfdHlwZTsgdHlwZSAhPSBudWxsICYmIHR5cGUgIT0g\nT2JqZWN0LmNsYXNzOwogICAgICAgICAgICB0eXBlID0gdHlwZS5nZXRTdXBl\ncmNsYXNzKCkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHJldHVybiB0eXBlLmdldERlY2xhcmVkRmllbGQoZmllbGROYW1lKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vLWRldGFjaC1zdGF0ZSIsIGZpZWxkTmFtZSwKICAg\nICAgICAgICAgX3R5cGUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0eXBlIGhhcyBkZXRhY2hlZCBzdGF0\nZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYSBkZXRhY2hlZCBp\nbnN0YW5jZSBtdXN0IGhhdmUgZGV0YWNoZWQgc3RhdGUsIGZhbHNlCiAgICAg\nKiBpZiBpdCBkb2VzIG5vdCwgYW5kIG51bGwgaWYgaXQgbWF5IHVzZSBhCiAg\nICAgKiBtYW51YWxseS1jb25zdHJ1Y3RlZCBpbnN0YW5jZSB3aXRob3V0IGRl\ndGFjaGVkIHN0YXRlCiAgICAgKi8KICAgIHB1YmxpYyBCb29sZWFuIHVzZXNE\nZXRhY2hlZFN0YXRlKCkgewogICAgICAgIC8vIG5vIG5lZWQgdG8gbGV0IGNv\nbmYgZGlzYWxsb3cgYmVjYXVzZSBpdCdzIHRha2VuIGludG8gYWNjb3VudCBp\nbgogICAgICAgIC8vIGdldERldGFjaGVkU3RhdGUoKSBjYWxsCiAgICAgICAg\ncmV0dXJuIHVzZXNEZXRhY2hlZFN0YXRlKGdldERldGFjaGVkU3RhdGUoKSwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBhbiBpbnN0\nYW5jZSBvZiB0aGlzIHR5cGUgaGFzIGRldGFjaGVkIHN0YXRlLCBhc3N1bWlu\nZyB0aGUgZ2l2ZW4KICAgICAqIGRldGFjaGVkIHN0YXRlIGZpZWxkLgogICAg\nICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhIGRldGFjaGVkIGluc3RhbmNl\nIG11c3QgaGF2ZSBkZXRhY2hlZCBzdGF0ZSwgZmFsc2UKICAgICAqIGlmIGl0\nIGRvZXMgbm90LCBhbmQgbnVsbCBpZiBpdCBtYXkgdXNlIGEKICAgICAqIG1h\nbnVhbGx5LWNvbnN0cnVjdGVkIGluc3RhbmNlIHdpdGhvdXQgZGV0YWNoZWQg\nc3RhdGUKICAgICAqLwogICAgcHJpdmF0ZSBCb29sZWFuIHVzZXNEZXRhY2hl\nZFN0YXRlKFN0cmluZyBkZXRhY2hlZEZpZWxkLAogICAgICAgIGJvb2xlYW4g\nY29uZkRpc2FsbG93cykgewogICAgICAgIGlmICghaXNEZXRhY2hhYmxlKCkp\nCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAv\nLyBpZiB3ZSBkZWNsYXJlIGEgZGV0YWNoZWQgc3RhdGUgZmllbGQsIGhhdmUg\ndG8gdXNlIGl0CiAgICAgICAgaWYgKGRldGFjaGVkRmllbGQgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgaWYg\nKCFTWU5USEVUSUMuZXF1YWxzKGRldGFjaGVkRmllbGQpKQogICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBjb25m\nIHRvIGRpc2FsbG93CiAgICAgICAgaWYgKGNvbmZEaXNhbGxvd3MgJiYgIV9y\nZXBvcy5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERldGFj\naFN0YXRlSW5zdGFuY2UoKS5nZXREZXRhY2hlZFN0YXRlRmllbGQoKSkKICAg\nICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7CgogICAgICAgIC8vIGhh\ndmUgdG8gdXNlIGRldGFjaGVkIHN0YXRlIHRvIHN0b3JlIGRhdGFzdG9yZSBp\nZAogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9PSBJRF9EQVRBU1RP\nUkUpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CgogICAgICAg\nIC8vIGFsbG93IGRldGFjaGVkIHN0YXRlIHVzZSwgYnV0IGRvbid0IHJlcXVp\ncmUKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIENsZWFyIGNhY2hlZCBmaWVsZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBjbGVhckFsbEZpZWxkQ2FjaGUoKSB7CiAgICAgICAgX2FsbEZp\nZWxkcyA9IG51bGw7CiAgICAgICAgX2FsbERGR0ZpZWxkcyA9IG51bGw7CiAg\nICAgICAgX2FsbFBLRmllbGRzID0gbnVsbDsKICAgICAgICBfZGVmaW5lZEZp\nZWxkcyA9IG51bGw7CiAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBudWxsOwog\nICAgICAgIF9hbGxMaXN0aW5nRmllbGRzID0gbnVsbDsKICAgICAgICBfZmll\nbGREYXRhVGFibGUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xl\nYXIgZGVmaW5lZCBmaWVsZCBkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBjbGVhckRlZmluZWRGaWVsZENhY2hlKCkgewogICAgICAgIF9kZWZp\nbmVkRmllbGRzID0gbnVsbDsKICAgICAgICBfbGlzdGluZ0ZpZWxkcyA9IG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQgZmllbGQg\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJGaWVsZENh\nY2hlKCkgewogICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAg\nIF9maWVsZHMgPSBudWxsOwogICAgICAgIF91bm1nZEZpZWxkcyA9IG51bGw7\nCiAgICAgICAgX3ZlcnNpb25JZHggPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENsZWFyIGNhY2hlZCBzdWJjbGFzcyBkYXRh\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjbGVhclN1YmNsYXNzQ2Fj\naGUoKSB7CiAgICAgICAgX3N1YnMgPSBudWxsOwogICAgICAgIF9zdWJNZXRh\ncyA9IG51bGw7CiAgICAgICAgX21hcFN1Yk1ldGFzID0gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIENsZWFyIGltcGwgZGF0YSBhbmQgaW50ZXJtZWRp\nYXRlIGRhdGEgdGFibGUuCiAgICAgKi8KICAgIHZvaWQgY2xlYXJFeHRyYUZp\nZWxkRGF0YVRhYmxlKCkgewogICAgICAgIF9maWVsZERhdGFUYWJsZSA9IG51\nbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBmaWVsZCBhcnJheXMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjYWNoZUZpZWxkcygpIHsKICAg\nICAgICBnZXRGaWVsZHMoKTsKICAgICAgICBnZXRQcmltYXJ5S2V5RmllbGRz\nKCk7CiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAg\nICByZXR1cm4gX3R5cGUuZ2V0TmFtZSgpLmhhc2hDb2RlKCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAg\nICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIENsYXNzTWV0YURh\ndGEpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJu\nIF90eXBlID09ICgoQ2xhc3NNZXRhRGF0YSkgb3RoZXIpLmdldERlc2NyaWJl\nZFR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGNvbXBhcmVUbyhPYmpl\nY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5hbWUo\nKS5jb21wYXJlVG8oKChDbGFzc01ldGFEYXRhKSBvdGhlcikuCiAgICAgICAg\nICAgIGdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpOwogICAgfQoKICAg\nIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIGdl\ndERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCk7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZXNvbHZlIGFuZCB2YWxpZGF0\nZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAg\nKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFkYXRhLgogICAgICov\nCiAgICBwdWJsaWMgaW50IGdldFJlc29sdmUoKSB7CiAgICAgICAgcmV0dXJu\nIF9yZXNNb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUg\nbW9kZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UmVzb2x2ZShpbnQgbW9kZSkgewogICAgICAgIF9yZXNNb2RlID0g\nbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUg\nZm9yIHRoaXMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFJlc29sdmUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAo\nbW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIF9yZXNNb2RlID0gbW9k\nZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3Jlc01vZGUg\nfD0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9yZXNNb2RlICY9\nIH5tb2RlOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBhbmQgdmFs\naWRhdGUgbWV0YWRhdGEuIFJldHVybiB0cnVlIGlmIGFscmVhZHkgcmVzb2x2\nZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlc29sdmUoaW50IG1v\nZGUpIHsKICAgICAgICBpZiAoKF9yZXNNb2RlICYgbW9kZSkgPT0gbW9kZSkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaW50IGN1ciA9IF9y\nZXNNb2RlOwogICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CgogICAgICAgIGlu\ndCB2YWwgPSBfcmVwb3MuZ2V0VmFsaWRhdGUoKTsKICAgICAgICBib29sZWFu\nIHJ1bnRpbWUgPSAodmFsICYgX3JlcG9zLlZBTElEQVRFX1JVTlRJTUUpICE9\nIDA7CiAgICAgICAgYm9vbGVhbiB2YWxpZGF0ZSA9ICFQZXJzaXN0ZW5jZUNh\ncGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfdHlwZSkKICAgICAgICAg\nICAgfHwgKHZhbCAmIE1ldGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9VTkVO\nSEFOQ0VEKSA9PSAwOwoKICAgICAgICAvLyB3ZSBvbmx5IGRvIGFueSBhY3Rp\nb25zIGZvciBtZXRhZGF0YSBtb2RlCiAgICAgICAgaWYgKChtb2RlICYgTU9E\nRV9NRVRBKSAhPSAwICYmIChjdXIgJiBNT0RFX01FVEEpID09IDApIHsKICAg\nICAgICAgICAgcmVzb2x2ZU1ldGEocnVudGltZSk7CiAgICAgICAgICAgIGlm\nICh2YWxpZGF0ZSAmJiAodmFsICYgX3JlcG9zLlZBTElEQVRFX01FVEEpICE9\nIDApCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU1ldGEocnVudGltZSk7CiAg\nICAgICAgfQogICAgICAgIGlmICgobW9kZSAmIE1PREVfTUFQUElORykgIT0g\nMCAmJiAoY3VyICYgTU9ERV9NQVBQSU5HKSA9PSAwKSB7CiAgICAgICAgICAg\nIHJlc29sdmVNYXBwaW5nKHJ1bnRpbWUpOwogICAgICAgICAgICBpZiAodmFs\naWRhdGUgJiYgKHZhbCAmIF9yZXBvcy5WQUxJREFURV9NQVBQSU5HKSAhPSAw\nKQogICAgICAgICAgICAgICAgdmFsaWRhdGVNYXBwaW5nKHJ1bnRpbWUpOwog\nICAgICAgIH0KICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01BUFBJTkdfSU5J\nVCkgIT0gMCAmJiAoY3VyICYgTU9ERV9NQVBQSU5HX0lOSVQpID09IDApCiAg\nICAgICAgICAgIGluaXRpYWxpemVNYXBwaW5nKCk7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVzb2x2ZU1ldGEoYm9v\nbGVhbiBydW50aW1lKSB7CiAgICAgICAgYm9vbGVhbiBlbWJlZCA9IF9vd25l\nciAhPSBudWxsICYmIF9vd25lci5nZXREZWNsYXJlZFR5cGUoKSA9PSBfdHlw\nZTsKICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KChlbWJlZCkgPyAicmVzb2x2ZS1lbWJlZC1tZXRhIiA6\nICJyZXNvbHZlLW1ldGEiLAogICAgICAgICAgICAgICAgdGhpcyArICJAIiAr\nIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CgogICAgICAgIGlm\nIChydW50aW1lICYmICFfdHlwZS5pc0ludGVyZmFjZSgpICYmIAogICAgICAg\nICAgICAhUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZy\nb20oX3R5cGUpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1lbmhhbmNlZCIsIF90eXBlKSk7CgogICAg\nICAgIC8vIGFyZSB3ZSB0aGUgdGFyZ2V0IG9mIGFuIGVtYmVkZGVkIHZhbHVl\nPwogICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgICBpZiAoX293bmVy\nLmdldEZpZWxkTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAg\nICAgICAgICAgICAgICBnZXREZXNjcmliZWRUeXBlKCkuaXNBc3NpZ25hYmxl\nRnJvbShfdHlwZSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoInJlY3Vyc2UtZW1iZWQiLCBfb3duZXIp\nKTsKCiAgICAgICAgICAgIC8vIGNvcHkgaW5mbyBmcm9tIHRoZSAicmVhbCIg\nbWV0YWRhdGEgZm9yIHRoaXMgdHlwZQogICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEoX3R5cGUsIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgICAgICBtZXRhLnJlc29sdmUoTU9ERV9NRVRBKTsK\nICAgICAgICAgICAgY29weSh0aGlzLCBtZXRhKTsKICAgICAgICAgICAgX2Vt\nYmVkZGVkID0gQm9vbGVhbi5GQUxTRTsgLy8gZW1iZWRkZWQgaW5zdGFuY2Ug\naXNuJ3QgZW1iZWRkZWQtb25seQogICAgICAgIH0KCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHN1cGVyY2xhc3MgaXMgcmVzb2x2ZWQKICAgICAgICBDbGFzc01l\ndGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAg\nICAgaWYgKHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN1cC5yZXNvbHZl\nKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGlmIChlbWJlZCkgewogICAgICAg\nICAgICAgICAgLy8gZW1iZWRkZWQgaW5zdGFuY2UgYWx3YXlzIHJlZGVmaW5l\nIGFsbCBzdXBlcmNsYXNzIGZpZWxkcwogICAgICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIHN1cHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1cHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09IG51bGwK\nICAgICAgICAgICAgICAgICAgICAgICAgfHwgIV9zdXBGaWVsZE1hcC5jb250\nYWluc0tleShzdXBzW2ldLmdldE5hbWUoKSkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVsZChzdXBzW2ldLmdl\ndE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzdXBzW2ldLmdldERlY2xhcmluZ1R5cGUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyByZXNvbHZlIGZpZWxkcyBhbmQgcmVtb3ZlIGlu\ndmFsaWRzCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBfZmllbGRNYXAudmFsdWVzKCkuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgLy8gb25seSBwYXNz\nIG9uIG1ldGFkYXRhIHJlc29sdmUgbW9kZSBzbyB0aGF0IG1ldGFkYXRhIGlz\nIGFsd2F5cwogICAgICAgICAgICAvLyByZXNvbHZlZCBiZWZvcmUgYW55IG90\naGVyIHJlc29sdmUgbW9kZXMgb3VyIHN1YmNsYXNzZXMgcGFzcyBhbG9uZwog\nICAgICAgICAgICBmbWQgPSAoRmllbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgZm1kLnJlc29sdmUoTU9ERV9NRVRBKTsKCiAgICAgICAg\nICAgIGlmICghZm1kLmlzRXhwbGljaXQoKQogICAgICAgICAgICAgICAgJiYg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9CSkVD\nVAogICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuUENfVU5UWVBFRAogICAgICAgICAgICAgICAgfHwg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLkFSUkFZ\nCiAgICAgICAgICAgICAgICAmJiBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xh\ncmVkVHlwZUNvZGUoKQogICAgICAgICAgICAgICAgPT0gSmF2YVR5cGVzLk9C\nSkVDVCkpKSB7CiAgICAgICAgICAgICAgICBfcmVwb3MuZ2V0TG9nKCkud2Fy\nbihfbG9jLmdldCgicm0tZmllbGQiLCBmbWQpKTsKICAgICAgICAgICAgICAg\nIGlmIChmbWQuZ2V0TGlzdGluZ0luZGV4KCkgIT0gLTEpCiAgICAgICAgICAg\nICAgICAgICAgZm1kLnNldE1hbmFnZW1lbnQoZm1kLk1BTkFHRV9OT05FKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpdHIu\ncmVtb3ZlKCk7CiAgICAgICAgICAgICAgICBjbGVhckZpZWxkQ2FjaGUoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZW1iZWRkZWQg\naW5zdGFuY2VzIG11c3QgZW1iZWQgYWxsIHN1cGVyY2xhc3MgZmllbGRzIHRv\nbwogICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgICBjbGVhckFsbEZp\nZWxkQ2FjaGUoKTsKICAgICAgICAgICAgcmVzb2x2ZURlZmluZWRTdXBlcmNs\nYXNzRmllbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyB0aGlzIGVuc3Vy\nZXMgdGhhdCBhbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRz\nIGFyZSBjYWNoZWQKICAgICAgICBjYWNoZUZpZWxkcygpOwoKICAgICAgICAv\nLyByZXNvbHZlIGxpZmVjeWNsZSBtZXRhZGF0YSBub3cgdG8gcHJldmVudCBs\nYXp5IHRocmVhZGluZyBwcm9ibGVtcwogICAgICAgIF9saWZlTWV0YS5yZXNv\nbHZlKCk7CgogICAgICAgIC8vIHJlY29yZCBpbXBsZW1lbnRzIGluIHRoZSBy\nZXBvc2l0b3J5CiAgICAgICAgaWYgKF9pbnRlcmZhY2VzICE9IG51bGwpIHsK\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdCA9IF9pbnRlcmZhY2VzLml0\nZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspCiAgICAgICAgICAgICAgICBfcmVw\nb3MuYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsKHRoaXMsIChDbGFzcykgaXQu\nbmV4dCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc29sdmUgZmV0Y2gg\nZ3JvdXBzCiAgICAgICAgaWYgKF9mZ01hcCAhPSBudWxsKQogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9mZ01hcC52YWx1ZXMoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICgoRmV0Y2hH\ncm91cCkgaXRyLm5leHQoKSkucmVzb2x2ZSgpOwoKICAgICAgICBpZiAoIWVt\nYmVkICYmIF90eXBlLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgaWYg\nKF9pbnRlcmZhY2UgIT0gQm9vbGVhbi5UUlVFKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnRlcmZh\nY2UiLCBfdHlwZSkpOwoKICAgICAgICAgICAgaWYgKHJ1bnRpbWUpIHsKICAg\nICAgICAgICAgICAgIF9pbXBsID0gX3JlcG9zLmdldEltcGxHZW5lcmF0b3Io\nKS5jcmVhdGVJbXBsKHRoaXMpOwogICAgICAgICAgICAgICAgX3JlcG9zLnNl\ndEludGVyZmFjZUltcGwodGhpcywgX2ltcGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBpZiB0aGlzIGlzIHJ1bnRpbWUsIGNyZWF0\nZSBhIHBjIGluc3RhbmNlIGFuZCBzY2FuIGl0IGZvciBjb21wYXJhdG9ycwog\nICAgICAgIGlmIChydW50aW1lICYmICFNb2RpZmllci5pc0Fic3RyYWN0KF90\neXBlLmdldE1vZGlmaWVycygpKSkgewogICAgICAgICAgICBQcm94eVNldHVw\nU3RhdGVNYW5hZ2VyIHNtID0gbmV3IFByb3h5U2V0dXBTdGF0ZU1hbmFnZXIo\nKTsKICAgICAgICAgICAgc20uc2V0UHJveHlEYXRhKFBDUmVnaXN0cnkubmV3\nSW5zdGFuY2UoX3R5cGUsIHNtLCBmYWxzZSksIHRoaXMpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHJlc29sdmVkIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCB2YWxpZGF0ZU1ldGEo\nYm9vbGVhbiBydW50aW1lKSB7CiAgICAgICAgdmFsaWRhdGVEYXRhQ2FjaGUo\nKTsKICAgICAgICB2YWxpZGF0ZURldGFjaGFibGUoKTsKICAgICAgICB2YWxp\nZGF0ZUV4dGVuc2lvbktleXMoKTsKICAgICAgICB2YWxpZGF0ZUlkZW50aXR5\nKHJ1bnRpbWUpOwogICAgICAgIHZhbGlkYXRlQWNjZXNzVHlwZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBtYXBwaW5nIGRhdGEuIExvZ3Mg\ncmVzb2x2ZSBtZXNzYWdlIGFuZCByZXNvbHZlcyBzdXBlciBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZXNvbHZlTWFwcGluZyhi\nb29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdl\ndExvZygpOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJyZXNvbHZlLW1hcHBpbmci\nLCB0aGlzICsgIkAiCiAgICAgICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0\neUhhc2hDb2RlKHRoaXMpKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBl\ncmNsYXNzIGlzIHJlc29sdmVkIGZpcnN0CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlm\nIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAgc3VwLnJlc29sdmUoTU9ERV9N\nQVBQSU5HKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIG1hcHBp\nbmcgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVN\nYXBwaW5nKGJvb2xlYW4gcnVudGltZSkgewogICAgfQoKICAgIC8qKgogICAg\nICogSW5pdGlhbGl6ZSBtYXBwaW5nLiBMb2dzIGluaXQgbWVzc2FnZSBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXpl\nTWFwcGluZygpIHsKICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygp\nOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbml0LW1hcHBpbmciLCB0aGlzICsg\nIkAiCiAgICAgICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2Rl\nKHRoaXMpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBkYXRh\nIGNhY2hlIHNldHRpbmdzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFs\naWRhdGVEYXRhQ2FjaGUoKSB7CiAgICAgICAgaW50IHRpbWVvdXQgPSBnZXRE\nYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAgICAgaWYgKHRpbWVvdXQgPCAtMSB8\nfCB0aW1lb3V0ID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtdGltZW91dC1pbnZhbGlkIiwK\nICAgICAgICAgICAgICAgIF90eXBlLCBTdHJpbmcudmFsdWVPZih0aW1lb3V0\nKSkpOwoKICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBTdHJpbmcgY2FjaGUgPSBnZXREYXRhQ2FjaGVO\nYW1lKCk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHN1cGVyQ2FjaGUgPSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAg\nICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhjYWNoZSwgc3VwZXJDYWNoZSkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiY2FjaGUtbmFtZXMiLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAg\nICAgIHsgX3R5cGUsIGNhY2hlLCBfc3VwZXIsIHN1cGVyQ2FjaGUgfSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhlIGlkZW50aXR5\nIGhhbmRsaW5nIGZvciB0aGlzIGNsYXNzIGlzIHZhbGlkLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgdmFsaWRhdGVJZGVudGl0eShib29sZWFuIHJ1bnRp\nbWUpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgaWRlbnRpdHkgdHlwZXMgYXJl\nIGNvbnNpc3RlbnQKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaW50IGlkID0gZ2V0SWRl\nbnRpdHlUeXBlKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5n\nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOCiAgICAgICAgICAgICYm\nIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC10eXBlcyIs\nIF90eXBlKSk7CgogICAgICAgIC8vIGNoZWNrIGZvciB0aGluZ3MgdGhlIGRh\ndGEgc3RvcmUgZG9lc24ndCBzdXBwb3J0CiAgICAgICAgQ29sbGVjdGlvbiBv\ncHRzID0gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5zdXBwb3J0ZWRPcHRp\nb25zKCk7CiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9OCiAgICAg\nICAgICAgICYmICFvcHRzLmNvbnRhaW5zKE9wZW5KUEFDb25maWd1cmF0aW9u\nLk9QVElPTl9JRF9BUFBMSUNBVElPTikpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJhcHBpZC1ub3Qt\nc3VwcG9ydGVkIiwKICAgICAgICAgICAgICAgIF90eXBlKSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChpZCA9PSBJRF9EQVRBU1RPUkUKICAgICAgICAgICAg\nJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BUSU9O\nX0lEX0RBVEFTVE9SRSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAoImRh\ndGFzdG9yZWlkLW5vdC1zdXBwb3J0ZWQiLCBfdHlwZSkpOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9OKSB7CiAgICAgICAg\nICAgIGlmIChfaWRTdHJhdGVneSAhPSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYXBwaWQtc3RyYXRlZ3kiLCBfdHlwZSkpOwogICAgICAgICAg\nICB2YWxpZGF0ZUFwcElkQ2xhc3MocnVudGltZSk7CiAgICAgICAgfSBlbHNl\nIGlmIChpZCAhPSBJRF9VTktOT1dOKQogICAgICAgICAgICB2YWxpZGF0ZU5v\nUEtGaWVsZHMoKTsKCiAgICAgICAgaW50IHN0cmF0ZWd5ID0gZ2V0SWRlbnRp\ndHlTdHJhdGVneSgpOwogICAgICAgIGlmIChzdHJhdGVneSA9PSBWYWx1ZVN0\ncmF0ZWdpZXMuU0VRVUVOQ0UKICAgICAgICAgICAgJiYgZ2V0SWRlbnRpdHlT\nZXF1ZW5jZU5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNlcS1uYW1lIiwgX3R5\ncGUpKTsKCiAgICAgICAgVmFsdWVTdHJhdGVnaWVzLmFzc2VydFN1cHBvcnRl\nZChzdHJhdGVneSwgdGhpcywKICAgICAgICAgICAgImRhdGFzdG9yZSBpZGVu\ndGl0eSBzdHJhdGVneSIpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBz\ndXJlIHRoZSBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzcyBpcyB2YWxpZC4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlQXBwSWRDbGFzcyhi\nb29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICAvLyBiYXNlIHR5cGVzIG11c3Qg\nZGVjbGFyZSBhbiBvaWQgY2xhc3MgaWYgbm90IHNpbmdsZS1maWVsZCBpZGVu\ndGl0eQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBnZXRQcmltYXJ5\nS2V5RmllbGRzKCk7CiAgICAgICAgaWYgKGdldE9iamVjdElkVHlwZSgpID09\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKHBrcy5sZW5ndGggPT0gMSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgidW5zdXBwb3J0ZWQtaWQtdHlwZSIsCiAgICAgICAgICAgICAgICAg\nICAgX3R5cGUsIHBrc1swXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgcGtzWzBdLmdldERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSkpOwogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLWlkLWNsYXNzIiwgX3R5cGUpKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKF9vYmplY3RJZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGlmIChpc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIGlm\nIChwa3NbMF0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5P\nSUQpIHsKICAgICAgICAgICAgICAgIENsYXNzTWV0YURhdGEgZW1iZWQgPSBw\na3NbMF0uZ2V0RW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAg\ndmFsaWRhdGVBcHBJZENsYXNzTWV0aG9kcyhlbWJlZC5nZXREZXNjcmliZWRU\neXBlKCkpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNzUEtz\nKGVtYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSwKICAgICAgICAgICAgICAgICAg\nICBlbWJlZC5nZXREZXNjcmliZWRUeXBlKCksIHJ1bnRpbWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIGlmIChfc3VwZXIgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBjb25jcmV0\nZSBzdXBlcmNsYXNzIG9pZHMgbXVzdCBtYXRjaCBvciBiZSBwYXJlbnQgb2Yg\nb3VycwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmICghc3VwLmdldE9i\namVjdElkVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX29iamVjdElkKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiaWQtY2xhc3NlcyIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdeyBfdHlwZSwgX29iamVjdElkLCBfc3VwZXIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIHN1cC5nZXRPYmplY3RJZFR5cGUoKSB9KSk7CgogICAg\nICAgICAgICAvLyB2YWxpZGF0ZSB0aGF0IG5vIG90aGVyIHBrcyBhcmUgZGVj\nbGFyZWQgaWYgd2UgaGF2ZSBhCiAgICAgICAgICAgIC8vIGNvbmNyZXRlIFBD\nIHN1cGVyY2xhc3MKICAgICAgICAgICAgaWYgKGhhc0NvbmNyZXRlUENTdXBl\ncmNsYXNzKCkpCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU5vUEtGaWVsZHMo\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgY2xhc3MgaGFzIGl0\ncyBvd24gb2lkIGNsYXNzLCBkbyBzb21lIG1vcmUgdmFsaWRhdGlvbgogICAg\nICAgIGlmIChfc3VwZXIgPT0gbnVsbAogICAgICAgICAgICB8fCBfb2JqZWN0\nSWQgIT0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRPYmplY3RJZFR5\ncGUoKSkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgbm9uLWFic3RyYWN0\nIG9pZCBjbGFzc2VzIG92ZXJyaWRlIHRoZSBwcm9wZXIgbWV0aG9kcwogICAg\nICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3QoX29iamVjdElkLmdl\ndE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAgIHZhbGlkYXRlQXBwSWRD\nbGFzc01ldGhvZHMoX29iamVjdElkKTsKCiAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSB0aGUgYXBwIGlkIGNsYXNzIGhhcyBhbGwgcGsgZmllbGRzCiAgICAg\nICAgICAgIHZhbGlkYXRlQXBwSWRDbGFzc1BLcyh0aGlzLCBwa3MsIF9vYmpl\nY3RJZCwgcnVudGltZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhpcyBjbGFzcyBoYXMgYSBjb25jcmV0ZSBw\nZXJzaXN0ZW50IHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBoYXNDb25jcmV0ZVBDU3VwZXJjbGFzcygpIHsKICAgICAgICBpZiAo\nX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3QoX3N1cGVyLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0\ndXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaGFzQ29uY3JldGVQQ1N1\ncGVyY2xhc3MoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0\nIHRoZSB1c2VyIGhhcyBvdmVycmlkZGVuIHRoZSBlcXVhbHMgYW5kIGhhc2hD\nb2RlIG1ldGhvZHMsCiAgICAgKiBhbmQgaGFzIHRoZSBwcm9wZXIgY29uc3Ry\ndWN0b3JzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJ\nZENsYXNzTWV0aG9kcyhDbGFzcyBvaWQpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBvaWQuZ2V0Q29uc3RydWN0b3IoKENsYXNzW10pIG51bGwpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1jb25z\nIiwgX3R5cGUpKS4KICAgICAgICAgICAgICAgIHNldENhdXNlKGUpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY2hlY2sgZm9yIGVxdWFscyBhbmQgaGFzaGNv\nZGUgb3ZlcnJpZGVzOyBkb24ndCBlbmZvcmNlIGl0CiAgICAgICAgLy8gZm9y\nIGFic3RyYWN0IGFwcCBpZCBjbGFzc2VzLCBzaW5jZSB0aGV5IG1heSBub3Qg\nbmVjZXNzYXJpbHkKICAgICAgICAvLyBkZWNsYXJlIHByaW1hcnkga2V5IGZp\nZWxkcwogICAgICAgIE1ldGhvZCBtZXRob2Q7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgbWV0aG9kID0gb2lkLmdldE1ldGhvZCgiZXF1YWxzIiwgbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihlKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICB9CgogICAgICAg\nIGJvb2xlYW4gYWJzID0gTW9kaWZpZXIuaXNBYnN0cmFjdChfdHlwZS5nZXRN\nb2RpZmllcnMoKSk7CiAgICAgICAgaWYgKCFhYnMgJiYgbWV0aG9kLmdldERl\nY2xhcmluZ0NsYXNzKCkgPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVxLW1ldGhv\nZCIsIF90eXBlKSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1ldGhv\nZCA9IG9pZC5nZXRNZXRob2QoImhhc2hDb2RlIiwgKENsYXNzW10pIG51bGwp\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUp\nOwogICAgICAgIH0KICAgICAgICBpZiAoIWFicyAmJiBtZXRob2QuZ2V0RGVj\nbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaGMtbWV0aG9k\nIiwgX3R5cGUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRo\nYXQgdGhlIHByaW1hcnkga2V5IGNsYXNzIGhhcyBhbGwgcGsgZmllbGRzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzUEtz\nKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcywgQ2xhc3Mgb2lkLCBib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBp\nZiAoZm1kcy5sZW5ndGggPT0gMCAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdCht\nZXRhLmdldERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9kaWZp\nZXJzKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vLXBrIiwgX3R5cGUpKTsKCiAgICAgICAgLy8gY2hl\nY2sgdGhhdCB0aGUgb2lkIHR5cGUgY29udGFpbnMgYWxsIHBrIGZpZWxkcwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpZWxkIGY7CiAgICAgICAgICAg\nIE1ldGhvZCBtOwogICAgICAgICAgICBTdHJpbmcgY2FwOwogICAgICAgICAg\nICBpbnQgdHlwZTsKICAgICAgICAgICAgQ2xhc3MgYzsKICAgICAgICAgICAg\naW50IGFjY2VzcyA9IG1ldGEuZ2V0QWNjZXNzVHlwZSgpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5B\nUlJBWToKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkuZ2V0Q29tcG9uZW50VHlwZSgpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzIHx8IGMgPT0gQnl0\nZS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgYyA9PSBj\naGFyLmNsYXNzIHx8IGMgPT0gQ2hhcmFjdGVyLmNsYXNzKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjID0gZm1kc1tpXS5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9JRDogLy8gd2UncmUgdmFsaWRhdGluZyBlbWJlZGRlZCBmaWVs\nZHMKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGstdHlwZSIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmbWRzW2ldKSk7CiAgICAgICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNb\naV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzID09IEFDQ0VTU19GSUVMRCkg\newogICAgICAgICAgICAgICAgICAgIGYgPSBmaW5kRmllbGQob2lkLCBmbWRz\nW2ldLmdldE5hbWUoKSwgcnVudGltZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGYgPT0gbnVsbCB8fCAhZi5nZXRUeXBlKCkuaXNBc3NpZ25hYmxlRnJv\nbShjKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIF90eXBlKSkuc2V0RmFpbGVkT2JqZWN0KGZt\nZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo\nYWNjZXNzID09IEFDQ0VTU19QUk9QRVJUWSkgewogICAgICAgICAgICAgICAg\nICAgIGNhcCA9IFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kc1tpXS5nZXRO\nYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKTsKCiAgICAgICAgICAgICAgICAgICAgbSA9\nIGZpbmRNZXRob2Qob2lkLCAiZ2V0IiArIGNhcCwgbnVsbCwgcnVudGltZSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCAmJiAodHlwZSA9\nPSBKYXZhVHlwZXMuQk9PTEVBTgogICAgICAgICAgICAgICAgICAgICAgICB8\nfCB0eXBlID09IEphdmFUeXBlcy5CT09MRUFOX09CSikpCiAgICAgICAgICAg\nICAgICAgICAgICAgIG0gPSBmaW5kTWV0aG9kKG9pZCwgImlzIiArIGNhcCwg\nbnVsbCwgcnVudGltZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0gPT0g\nbnVsbCB8fCAhbS5nZXRSZXR1cm5UeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShj\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLWlkIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIF90eXBlKSkuc2V0RmFpbGVkT2JqZWN0KCJnZXQi\nICsgY2FwKTsKCiAgICAgICAgICAgICAgICAgICAgbSA9IGZpbmRNZXRob2Qo\nb2lkLCAic2V0IiArIGNhcCwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkgfSwgcnVudGlt\nZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCB8fCBtLmdl\ndFJldHVyblR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImludmFsaWQtaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3R5\ncGUpKS5zZXRGYWlsZWRPYmplY3QoInNldCIgKyBjYXApOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQtaWQiLCBf\ndHlwZSkpLgogICAgICAgICAgICAgICAgc2V0Q2F1c2UodCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0aGUgbmFtZWQgZmllbGQs\nIHJlY3Vyc2luZyB0byBzdXBlcmNsYXNzZXMgaWYgbmVjZXNzYXJ5LgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBGaWVsZCBmaW5kRmllbGQoQ2xhc3Mg\nYywgU3RyaW5nIG5hbWUsIGJvb2xlYW4gcHViKQogICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIGlmIChjID09IG51bGwgfHwgYyA9PSBPYmpl\nY3QuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gKHB1YikgPyBjLmdldEZpZWxkKG5h\nbWUpIDogYy5nZXREZWNsYXJlZEZpZWxkKG5hbWUpOwogICAgICAgIH0gY2F0\nY2ggKE5vU3VjaEZpZWxkRXhjZXB0aW9uIG5zZmUpIHsKICAgICAgICAgICAg\ncmV0dXJuIChwdWIpID8gbnVsbCA6IGZpbmRGaWVsZChjLmdldFN1cGVyY2xh\nc3MoKSwgbmFtZSwgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEZpbmQgdGhlIG5hbWVkIG1ldGhvZCwgcmVjdXJzaW5nIHRvIHN1\ncGVyY2xhc3NlcyBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIE1ldGhvZCBmaW5kTWV0aG9kKENsYXNzIGMsIFN0cmluZyBuYW1l\nLCBDbGFzc1tdIHBhcmFtcywKICAgICAgICBib29sZWFuIHB1YikKICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAoYyA9PSBudWxsIHx8\nIGMgPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChwdWIpID8gYy5n\nZXRNZXRob2QobmFtZSwgcGFyYW1zKQogICAgICAgICAgICAgICAgOiBjLmdl\ndERlY2xhcmVkTWV0aG9kKG5hbWUsIHBhcmFtcyk7CiAgICAgICAgfSBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zZmUpIHsKICAgICAgICAgICAg\ncmV0dXJuIChwdWIpID8gbnVsbCA6IGZpbmRNZXRob2QoYy5nZXRTdXBlcmNs\nYXNzKCksIG5hbWUsIHBhcmFtcywKICAgICAgICAgICAgICAgIGZhbHNlKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0\nIHRoaXMgY2xhc3MgZG9lc24ndCBkZWNsYXJlIGFueSBwcmltYXJ5IGtleSBm\naWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZU5vUEtG\naWVsZHMoKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdl\ndERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmaWVsZHNb\naV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1wayIsIGZpZWxkc1tp\nXSkpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhpcyBj\nbGFzcycgYWNjZXNzIHR5cGUgaXMgYWxsb3dlZC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHZhbGlkYXRlQWNjZXNzVHlwZSgpIHsKICAgICAgICBpZiAo\nX2FjY2Vzc1R5cGUgPT0gQUNDRVNTX1VOS05PV04pCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1\ncC5nZXRBY2Nlc3NUeXBlKCkgIT0gQUNDRVNTX1VOS05PV04KICAgICAgICAg\nICAgJiYgc3VwLmdldEFjY2Vzc1R5cGUoKSAhPSBfYWNjZXNzVHlwZSAmJgog\nICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldEZpZWxk\ncygpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbmNvbnNpc3RlbnQtYWNjZXNzIiwK\nICAgICAgICAgICAgICAgIHRoaXMsIHN1cCkpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IGRldGFjaG1lbnQgY29uZmln\ndXJhdGlvbiBpcyB2YWxpZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZh\nbGlkYXRlRGV0YWNoYWJsZSgpIHsKICAgICAgICBib29sZWFuIGZpcnN0ID0g\ndHJ1ZTsKICAgICAgICBmb3IgKENsYXNzTWV0YURhdGEgcGFyZW50ID0gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgZmlyc3QgJiYg\ncGFyZW50ICE9IG51bGw7IHBhcmVudCA9IHBhcmVudC5nZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHBhcmVu\ndC5pc0RldGFjaGFibGUoKSkKICAgICAgICAgICAgICAgIGZpcnN0ID0gZmFs\nc2U7CiAgICAgICAgfQoKICAgICAgICBGaWVsZCBmaWVsZCA9IGdldERldGFj\naGVkU3RhdGVGaWVsZCgpOwogICAgICAgIGlmIChmaWVsZCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGlmICghZmlyc3QpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInBhcmVudC1kZXRh\nY2gtc3RhdGUiLAogICAgICAgICAgICAgICAgICAgIF90eXBlKSk7CiAgICAg\nICAgICAgIGlmIChnZXRGaWVsZChmaWVsZC5nZXROYW1lKCkpICE9IG51bGwp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm1hbmFnZWQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAg\nICAgICAgICBmaWVsZC5nZXROYW1lKCksIF90eXBlKSk7CiAgICAgICAgICAg\nIGlmIChmaWVsZC5nZXRUeXBlKCkgIT0gT2JqZWN0LmNsYXNzKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtZGV0YWNoLXN0YXRlIiwKICAgICAgICAgICAgICAgICAgICBmaWVs\nZC5nZXROYW1lKCksIF90eXBlKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLwogICAgLy8gRmV0Y2ggR3JvdXAKICAgIC8vLy8vLy8v\nLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmZXRjaCBncm91\ncHMgZGVjbGFyZWQgZXhwbGljaXRseSBpbiB0aGlzIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBGZXRjaEdyb3VwW10gZ2V0RGVjbGFyZWRGZXRjaEdyb3Vw\ncygpIHsKICAgICAgICBpZiAoX2ZncyA9PSBudWxsKQogICAgICAgICAgICBf\nZmdzID0gKF9mZ01hcCA9PSBudWxsKSA/IG5ldyBGZXRjaEdyb3VwWzBdIDog\nKEZldGNoR3JvdXBbXSkKICAgICAgICAgICAgICAgIF9mZ01hcC52YWx1ZXMo\nKS50b0FycmF5KG5ldyBGZXRjaEdyb3VwW19mZ01hcC5zaXplKCldKTsgCiAg\nICAgICAgcmV0dXJuIF9mZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYWxsIGZldGNoIGdyb3VwcyBmb3IgdGhpcyB0eXBlLCBpbmNsdWRpbmcg\nc3VwZXJjbGFzcyBncm91cHMuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdy\nb3VwW10gZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYgKF9j\ndXN0b21GR3MgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBtYXAgZmdzIHRv\nIG5hbWVzLCBhbGxvd2luZyBvdXIgZmdzIHRvIG92ZXJyaWRlIHN1cGVycwog\nICAgICAgICAgICBNYXAgZmdzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgICAgICAgICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAg\nIHsKICAgICAgICAgICAgICAgIEZldGNoR3JvdXBbXSBzdXBGR3MgPSBzdXAu\nZ2V0Q3VzdG9tRmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc3VwRkdzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgICAgIGZncy5wdXQoc3VwRkdzW2ldLmdldE5hbWUoKSwgc3VwRkdz\nW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBGZXRjaEdyb3VwW10g\nZGVjcyA9IGdldERlY2xhcmVkRmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBkZWNzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICAgZmdzLnB1dChkZWNzW2ldLmdldE5hbWUoKSwgZGVjc1tpXSk7\nCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyByZW1vdmUgc3RkIGdyb3Vw\ncwogICAgICAgICAgICBmZ3MucmVtb3ZlKEZldGNoR3JvdXAuTkFNRV9ERUZB\nVUxUKTsKICAgICAgICAgICAgZmdzLnJlbW92ZShGZXRjaEdyb3VwLk5BTUVf\nQUxMKTsKCiAgICAgICAgICAgIF9jdXN0b21GR3MgPSAoRmV0Y2hHcm91cFtd\nKSBmZ3MudmFsdWVzKCkudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBG\nZXRjaEdyb3VwW2Zncy5zaXplKCldKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9jdXN0b21GR3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXRzIGEg\nbmFtZWQgZmVjdGggZ3JvdXAuIElmIG5vdCBhdmFpbGFibGUgaW4gdGhpcyBy\nZWNlaXZlciB0aGVuIGxvb2tzCiAgICAgKiB1cCB0aGUgaW5oZXJpdGVuY2Ug\naGllcmFyY2h5LiAKICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSBuYW1lIG9m\nIGEgZmV0Y2ggZ3JvdXAuCiAgICAgKiBAcmV0dXJuIGFuIGV4aXN0aW5nIGZl\nY3RoIGdyb3VwIG9mIHRoZSBnaXZlbiBuYW1lIGlmIGtub3duIHRvIHRoaXMg\nCiAgICAgKiByZWNlaXZlciBvciBhbnkgb2YgaXRzIHN1cGVyY2xhc3Nlcy4g\nT3RoZXJ3aXNlIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3Vw\nIGdldEZldGNoR3JvdXAoU3RyaW5nIG5hbWUpIHsKICAgICAgICBGZXRjaEdy\nb3VwIGZnID0gKF9mZ01hcCA9PSBudWxsKSA/IG51bGwgOiAoRmV0Y2hHcm91\ncCkgX2ZnTWFwLmdldChuYW1lKTsKICAgICAgICBpZiAoZmcgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGZnOwogICAgICAgIENsYXNzTWV0YURhdGEg\nc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAo\nc3VwICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBzdXAuZ2V0RmV0Y2hH\ncm91cChuYW1lKTsKICAgICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFV\nTFQuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gRmV0Y2hHcm91\ncC5ERUZBVUxUOwogICAgICAgIGlmIChGZXRjaEdyb3VwLk5BTUVfQUxMLmVx\ndWFscyhuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuQUxM\nOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyBmZXRjaCBncm91cCBvZiB0aGUgZ2l2ZW4gbmFtZSwgb3IgcmV0dXJu\ncyBleGlzdGluZyBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFt\nZSBhIG5vbi1udWxsLCBub24tZW1wdHkgbmFtZS4gTXVzdCBiZSB1bmlxdWUg\nd2l0aGluIHRoaXMKICAgICAqIHJlY2VpdmVyJ3Mgc2NvcGUuIFRoZSBzdXBl\nciBjbGFzcyA8ZW0+bWF5PC9lbT4gaGF2ZSBhIGdyb3VwIHdpdGgKICAgICAq\nIHRoZSBzYW1lIG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBGZXRjaEdyb3Vw\nIGFkZERlY2xhcmVkRmV0Y2hHcm91cChTdHJpbmcgbmFtZSkgewogICAgCWlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgCQl0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImVtcHR5LWZnLW5hbWUiLCB0\naGlzKSk7CiAgICAgICAgaWYgKF9mZ01hcCA9PSBudWxsKQogICAgICAgICAg\nICBfZmdNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIEZldGNoR3JvdXAg\nZmcgPSAoRmV0Y2hHcm91cCkgX2ZnTWFwLmdldChuYW1lKTsKICAgICAgICBp\nZiAoZmcgPT0gbnVsbCkgewogICAgICAgIAlmZyA9IG5ldyBGZXRjaEdyb3Vw\nKHRoaXMsIG5hbWUpOwogICAgICAgIAlfZmdNYXAucHV0KG5hbWUsIGZnKTsK\nICAgICAgICAgICAgX2ZncyA9IG51bGw7CiAgICAgICAgICAgIF9jdXN0b21G\nR3MgPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmc7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBkZWNsYXJlZCBmZXRjaCBncm91\ncC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlRGVjbGFyZWRG\nZXRjaEdyb3VwKEZldGNoR3JvdXAgZmcpIHsKICAgICAgICBpZiAoZmcgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChf\nZmdNYXAucmVtb3ZlKGZnLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAg\nICAgICBfZmdzID0gbnVsbDsKICAgICAgICAgICAgX2N1c3RvbUZHcyA9IG51\nbGw7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIFNvdXJjZVRyYWNrZXIKICAgIC8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgcHVibGljIEZpbGUgZ2V0U291cmNlRmlsZSgpIHsKICAgICAgICByZXR1\ncm4gX3NyY0ZpbGU7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRTb3Vy\nY2VTY29wZSgpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IGdldFNvdXJjZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9z\ncmNUeXBlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZShGaWxl\nIGZpbGUsIGludCBzcmNUeXBlKSB7CiAgICAgICAgX3NyY0ZpbGUgPSBmaWxl\nOwogICAgICAgIF9zcmNUeXBlID0gc3JjVHlwZTsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIGdldFJlc291cmNlTmFtZSgpIHsKICAgICAgICByZXR1cm4g\nX3R5cGUuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNv\ndXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVkIHVuZGVy\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9zcmNNb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNvdXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEgaGFzIGJlZW4gbG9hZGVk\nIHVuZGVyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2Rl\nKGludCBtb2RlKSB7CiAgICAgICAgX3NyY01vZGUgPSBtb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIHRoaXMgbWV0YWRhdGEg\naGFzIGJlZW4gbG9hZGVkIHVuZGVyLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAg\nICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAgICBfc3JjTW9k\nZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9z\ncmNNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfc3Jj\nTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBpbmRl\neCBpbiB3aGljaCB0aGlzIGNsYXNzIHdhcyBsaXN0ZWQgaW4gdGhlIG1ldGFk\nYXRhLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+LTE8L2NvZGU+IGlmIHRo\naXMgY2xhc3Mgd2FzIG5vdCBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgaW50IGdldExpc3RpbmdJbmRleCgpIHsKICAgICAg\nICByZXR1cm4gX2xpc3RJbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBpbmRleCBpbiB3aGljaCB0aGlzIGZpZWxkIHdhcyBsaXN0ZWQgaW4gdGhl\nIG1ldGFkYXRhLiBEZWZhdWx0cyB0bwogICAgICogPGNvZGU+LTE8L2NvZGU+\nIGlmIHRoaXMgY2xhc3Mgd2FzIG5vdCBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRh\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMaXN0aW5nSW5kZXgoaW50\nIGluZGV4KSB7CiAgICAgICAgX2xpc3RJbmRleCA9IGluZGV4OwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29tbWVudGFibGUKICAgIC8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDb21tZW50\ncygpIHsKICAgICAgICByZXR1cm4gKF9jb21tZW50cyA9PSBudWxsKSA/IEVN\nUFRZX0NPTU1FTlRTIDogX2NvbW1lbnRzOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldENvbW1lbnRzKFN0cmluZ1tdIGNvbW1lbnRzKSB7CiAgICAgICAg\nX2NvbW1lbnRzID0gY29tbWVudHM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIFN0YXRlIGNvcHkKICAgIC8vLy8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBDb3B5IHRoZSBtZXRhZGF0YSBmcm9tIHRoZSBnaXZlbiBp\nbnN0YW5jZSB0byB0aGlzIG9uZS4gRG8gbm90CiAgICAgKiBjb3B5IG1hcHBp\nbmcgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvcHko\nQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpICE9IF90eXBlKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICBzdXBlci5jb3B5KG1ldGEp\nOwoKICAgICAgICAvLyBjb3B5IGNsYXNzLWxldmVsIGluZm87IHVzZSBnZXQg\nbWV0aG9kcyB0byBmb3JjZSByZXNvbHV0aW9uIG9mCiAgICAgICAgLy8gbGF6\neSBkYXRhCiAgICAgICAgX3N1cGVyID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3Mo\nKTsKICAgICAgICBfb2JqZWN0SWQgPSBtZXRhLmdldE9iamVjdElkVHlwZSgp\nOwogICAgICAgIF9leHRlbnQgPSAobWV0YS5nZXRSZXF1aXJlc0V4dGVudCgp\nKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgX2Vt\nYmVkZGVkID0gKG1ldGEuaXNFbWJlZGRlZE9ubHkoKSkgPyBCb29sZWFuLlRS\nVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgIF9pbnRlcmZhY2UgPSAobWV0\nYS5pc01hbmFnZWRJbnRlcmZhY2UoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29s\nZWFuLkZBTFNFOwogICAgICAgIF9pbXBsID0gbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CiAgICAgICAgX2lkZW50aXR5ID0gbWV0YS5nZXRJZGVudGl0eVR5\ncGUoKTsKICAgICAgICBfaWRTdHJhdGVneSA9IG1ldGEuZ2V0SWRlbnRpdHlT\ndHJhdGVneSgpOwogICAgICAgIF9zZXFOYW1lID0gbWV0YS5nZXRJZGVudGl0\neVNlcXVlbmNlTmFtZSgpOwogICAgICAgIF9zZXFNZXRhID0gbnVsbDsKICAg\nICAgICBfYWxpYXMgPSBtZXRhLmdldFR5cGVBbGlhcygpOwogICAgICAgIF9h\nY2Nlc3NUeXBlID0gbWV0YS5nZXRBY2Nlc3NUeXBlKCk7CgogICAgICAgIC8v\nIG9ubHkgY29weSB0aGlzIGluZm9ybWF0aW9uIGlmIGl0IHdhc24ndCBzZXQg\nZXhwbGljaXRseSBmb3IgdGhpcwogICAgICAgIC8vIGluc3RhbmNlCiAgICAg\nICAgaWYgKF9jYWNoZU5hbWUgPT0gREVGQVVMVF9TVFJJTkcpCiAgICAgICAg\nICAgIF9jYWNoZU5hbWUgPSBtZXRhLmdldERhdGFDYWNoZU5hbWUoKTsKICAg\nICAgICBpZiAoX2NhY2hlVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkK\nICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IG1ldGEuZ2V0RGF0YUNhY2hl\nVGltZW91dCgpOwogICAgICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxsKQog\nICAgICAgICAgICBfZGV0YWNoYWJsZSA9IG1ldGEuX2RldGFjaGFibGU7CiAg\nICAgICAgaWYgKF9kZXRhY2hTdGF0ZSA9PSBERUZBVUxUX1NUUklORykKICAg\nICAgICAgICAgX2RldGFjaFN0YXRlID0gbWV0YS5nZXREZXRhY2hlZFN0YXRl\nKCk7CgogICAgICAgIC8vIHN5bmNoIGZpZWxkIGluZm9ybWF0aW9uOyBmaXJz\ndCByZW1vdmUgZXh0cmEgZmllbGRzCiAgICAgICAgY2xlYXJGaWVsZENhY2hl\nKCk7CiAgICAgICAgX2ZpZWxkTWFwLmtleVNldCgpLnJldGFpbkFsbChtZXRh\nLl9maWVsZE1hcC5rZXlTZXQoKSk7CgogICAgICAgIC8vIGFkZCBjb3BpZXMg\nb2YgZGVjbGFyZWQgZmllbGRzOyBvdGhlciBkZWZpbmVkIGZpZWxkcyBhbHJl\nYWR5IGNvcGllZAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBt\nZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmaWVsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBmaWVsZCA9IGdldERlY2xhcmVk\nRmllbGQoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmIChm\naWVsZCA9PSBudWxsKQogICAgICAgICAgICAgICAgZmllbGQgPSBhZGREZWNs\nYXJlZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICAgICAgZmllbGRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAg\nICAgZmllbGQuc2V0RGVjbGFyZWRJbmRleCgtMSk7CiAgICAgICAgICAgIGZp\nZWxkLnNldEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQuY29weShmaWVs\nZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgLy8gY29weSBmZXRjaCBncm91\ncHMKICAgICAgICBGZXRjaEdyb3VwW10gZmdzID0gbWV0YS5nZXREZWNsYXJl\nZEZldGNoR3JvdXBzKCk7CiAgICAgICAgRmV0Y2hHcm91cCBmZzsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZncy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBmZyA9IGFkZERlY2xhcmVkRmV0Y2hHcm91cChmZ3NbaV0uZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgZmcuY29weShmZ3NbaV0pOyAKICAgICAg\nICB9CgogICAgICAgIC8vIGNvcHkgaWZhY2UgcmUtbWFwcGluZwogICAgICAg\nIF9pZmFjZU1hcC5jbGVhcigpOwogICAgICAgIF9pZmFjZU1hcC5wdXRBbGwo\nbWV0YS5faWZhY2VNYXApOwogICAgfQoKICAgIC8qKgogICAgICogUmVjdXJz\naXZlIGhlbHBlciB0byBjb3B5IGVtYmVkZGVkIG1ldGFkYXRhLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGNvcHkoQ2xhc3NNZXRhRGF0YSBl\nbWJlZCwgQ2xhc3NNZXRhRGF0YSBkZWMpIHsKICAgICAgICBDbGFzc01ldGFE\nYXRhIHN1cCA9IGRlYy5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICBlbWJlZC5zZXRQ\nQ1N1cGVyY2xhc3Moc3VwLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAg\nICAgIGNvcHkoZW1iZWQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSwgc3Vw\nKTsKICAgICAgICB9CiAgICAgICAgZW1iZWQuY29weShkZWMpOwogICAgfQoK\nICAgIHByb3RlY3RlZCB2b2lkIGFkZEV4dGVuc2lvbktleXMoQ29sbGVjdGlv\nbiBleHRzKSB7CiAgICAgICAgX3JlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgp\nLmFkZENsYXNzRXh0ZW5zaW9uS2V5cyhleHRzKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbXBhcmF0b3IgdXNlZCB0byBwdXQgZmllbGQgbWV0YWRhdGFz\nIGludG8gbGlzdGluZyBvcmRlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTGlzdGluZ09yZGVyQ29tcGFyYXRvcgogICAgICAgIGltcGxl\nbWVudHMgQ29tcGFyYXRvciB7CgogICAgICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IgX2luc3RhbmNlCiAgICAgICAg\nICAgID0gbmV3IExpc3RpbmdPcmRlckNvbXBhcmF0b3IoKTsKCiAgICAgICAg\nLyoqCiAgICAgICAgICogQWNjZXNzIHNpbmdsZXRvbiBpbnN0YW5jZS4KICAg\nICAgICAgKi8KICAgICAgICBwdWJsaWMgc3RhdGljIExpc3RpbmdPcmRlckNv\nbXBhcmF0b3IgZ2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBf\naW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGNvbXBh\ncmUoT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsKICAgICAgICAgICAgaWYgKG8x\nID09IG8yKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAg\nIGlmIChvMSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAg\nICAgICAgICAgIGlmIChvMiA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIC0xOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmMSA9IChGaWVs\nZE1ldGFEYXRhKSBvMTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmMiA9\nIChGaWVsZE1ldGFEYXRhKSBvMjsKICAgICAgICAgICAgaWYgKGYxLmdldExp\nc3RpbmdJbmRleCgpID09IGYyLmdldExpc3RpbmdJbmRleCgpKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZjEuZ2V0SW5kZXgoKSA9PSBmMi5nZXRJbmRleCgp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmMS5nZXRGdWxsTmFtZShm\nYWxzZSkuY29tcGFyZVRvCiAgICAgICAgICAgICAgICAgICAgICAgIChmMi5n\nZXRGdWxsTmFtZShmYWxzZSkpOwoJCQkJaWYgKGYxLmdldEluZGV4ICgpID09\nIC0xKQoJCQkJCXJldHVybiAxOwoJCQkJaWYgKGYyLmdldEluZGV4ICgpID09\nIC0xKQoJCQkJCXJldHVybiAtMTsKCQkJCXJldHVybiBmMS5nZXRJbmRleCAo\nKSAtIGYyLmdldEluZGV4ICgpOwoJCQl9CQoJCQlpZiAoZjEuZ2V0TGlzdGlu\nZ0luZGV4ICgpID09IC0xKQoJCQkJcmV0dXJuIDE7CgkJCWlmIChmMi5nZXRM\naXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJCQlyZXR1cm4gLTE7CgkJCXJldHVy\nbiBmMS5nZXRMaXN0aW5nSW5kZXggKCkgLSBmMi5nZXRMaXN0aW5nSW5kZXgg\nKCk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

