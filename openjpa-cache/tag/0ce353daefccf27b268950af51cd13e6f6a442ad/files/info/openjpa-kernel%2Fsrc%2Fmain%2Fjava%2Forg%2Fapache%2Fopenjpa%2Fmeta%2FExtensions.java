{"sha":"476278f88c8bb9654dd36e27f40bb06745f8ba0c","node_id":"MDQ6QmxvYjIwNjM2NDo0NzYyNzhmODhjOGJiOTY1NGRkMzZlMjdmNDBiYjA2NzQ1ZjhiYTBj","size":13529,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/476278f88c8bb9654dd36e27f40bb06745f8ba0c","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhOwoKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLlNldDsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlN0cmluZ0Rpc3RhbmNlOwppbXBv\ncnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogVmVuZG9yIGV4dGVuc2lv\nbnMuIFRoaXMgY2xhc3MgaXMgdGhyZWFkIHNhZmUgZm9yIHJlYWRzLCBidXQg\nbm90IGZvcgogKiBtdXRhdGlvbnMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgRXh0ZW5zaW9ucyB7CgogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgT1BFTkpQQSA9ICJvcGVuanBh\nIjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nIExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEV4dGVuc2lvbnMuY2xh\nc3MpOwoKICAgIHByaXZhdGUgTWFwIF9leHRzID0gbnVsbDsKICAgIHByaXZh\ndGUgTWFwIF9lbWJlZCA9IG51bGw7CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndHJ1ZSBpZiB0aGVyZSBhcmUgbm8ga2V5cyBmb3IgYW55IHZlbmRvci4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICBy\nZXR1cm4gKF9leHRzID09IG51bGwgfHwgX2V4dHMuaXNFbXB0eSgpKQogICAg\nICAgICAgICAmJiAoX2VtYmVkID09IG51bGwgfHwgX2VtYmVkLmlzRW1wdHko\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIHZlbmRvcnMg\nd2hvIGhhdmUgZXh0ZW5zaW9uIGtleXMgYXQgdGhpcyBsZXZlbC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZ1tdIGdldEV4dGVuc2lvblZlbmRvcnMoKSB7\nCiAgICAgICAgaWYgKF9leHRzID09IG51bGwgfHwgX2V4dHMuaXNFbXB0eSgp\nKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKCiAgICAgICAg\nU2V0IHZlbmRvcnMgPSBuZXcgVHJlZVNldCgpOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX2V4dHMua2V5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgIHZlbmRvcnMuYWRkKGdldFZlbmRvcihp\ndHIubmV4dCgpKSk7CiAgICAgICAgcmV0dXJuIChTdHJpbmdbXSkgdmVuZG9y\ncy50b0FycmF5KG5ldyBTdHJpbmdbdmVuZG9ycy5zaXplKCldKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgZXh0ZW5zaW9uIGtleXMuCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRFeHRlbnNpb25LZXlzKCkg\newogICAgICAgIHJldHVybiBnZXRFeHRlbnNpb25LZXlzKE9QRU5KUEEpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBleHRlbnNpb24ga2V5\ncyBmb3IgdGhlIGdpdmVuIHZlbmRvci4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZ1tdIGdldEV4dGVuc2lvbktleXMoU3RyaW5nIHZlbmRvcikgewogICAg\nICAgIGlmIChfZXh0cyA9PSBudWxsIHx8IF9leHRzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CgogICAgICAgIENvbGxl\nY3Rpb24ga2V5cyA9IG5ldyBUcmVlU2V0KCk7CiAgICAgICAgT2JqZWN0IGtl\neTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9leHRzLmtleVNldCgp\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGtl\neSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICh2ZW5kb3IuZXF1YWxz\nKGdldFZlbmRvcihrZXkpKSkKICAgICAgICAgICAgICAgIGtleXMuYWRkKGdl\ndEtleShrZXkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChTdHJpbmdb\nXSkga2V5cy50b0FycmF5KG5ldyBTdHJpbmdba2V5cy5zaXplKCldKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBleHRlbnNp\nb24gd2l0aCB0aGUgZ2l2ZW4ga2V5IGV4aXN0cy4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzRXh0ZW5zaW9uKFN0cmluZyBrZXkpIHsKICAgICAg\nICByZXR1cm4gaGFzRXh0ZW5zaW9uKE9QRU5KUEEsIGtleSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZXh0ZW5zaW9uIHdp\ndGggdGhlIGdpdmVuIGtleSBleGlzdHMuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGhhc0V4dGVuc2lvbihTdHJpbmcgdmVuZG9yLCBTdHJpbmcga2V5\nKSB7CiAgICAgICAgcmV0dXJuIF9leHRzICE9IG51bGwgJiYgX2V4dHMuY29u\ndGFpbnNLZXkoZ2V0SGFzaEtleSh2ZW5kb3IsIGtleSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIGEgdmVuZG9yIGV4dGVuc2lvbiB0byB0aGlzIGVu\ndGl0eS4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkRXh0ZW5zaW9uKFN0\ncmluZyBrZXksIE9iamVjdCB2YWx1ZSkgewogICAgICAgIGFkZEV4dGVuc2lv\nbihPUEVOSlBBLCBrZXksIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCBhIHZlbmRvciBleHRlbnNpb24gdG8gdGhpcyBlbnRpdHkuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGFkZEV4dGVuc2lvbihTdHJpbmcgdmVuZG9y\nLCBTdHJpbmcga2V5LCBPYmplY3QgdmFsdWUpIHsKICAgICAgICBpZiAoX2V4\ndHMgPT0gbnVsbCkKICAgICAgICAgICAgX2V4dHMgPSBuZXcgSGFzaE1hcCgp\nOwogICAgICAgIF9leHRzLnB1dChnZXRIYXNoS2V5KHZlbmRvciwga2V5KSwg\ndmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgdmVuZG9y\nIGV4dGVuc2lvbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3Zl\nRXh0ZW5zaW9uKFN0cmluZyBrZXkpIHsKICAgICAgICByZXR1cm4gcmVtb3Zl\nRXh0ZW5zaW9uKE9QRU5KUEEsIGtleSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgYSB2ZW5kb3IgZXh0ZW5zaW9uLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVFeHRlbnNpb24oU3RyaW5nIHZlbmRvciwgU3Ry\naW5nIGtleSkgewogICAgICAgIGlmIChfZXh0cyAhPSBudWxsICYmIF9leHRz\nLnJlbW92ZShnZXRIYXNoS2V5KHZlbmRvciwga2V5KSkgIT0gbnVsbCkgewog\nICAgICAgICAgICByZW1vdmVFbWJlZGRlZEV4dGVuc2lvbnMoa2V5KTsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgdmFsdWUg\nb2YgYW4gZXh0ZW5zaW9uLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndE9iamVjdEV4dGVuc2lvbihTdHJpbmcga2V5KSB7CiAgICAgICAgcmV0dXJu\nIGdldE9iamVjdEV4dGVuc2lvbihPUEVOSlBBLCBrZXkpOwogICAgfQoKICAg\nIC8qKgogICAgICogR2V0IHRoZSB2YWx1ZSBvZiBhbiBleHRlbnNpb24uCiAg\nICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0RXh0ZW5zaW9uKFN0\ncmluZyB2ZW5kb3IsIFN0cmluZyBrZXkpIHsKICAgICAgICBpZiAoX2V4dHMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0\ndXJuIF9leHRzLmdldChnZXRIYXNoS2V5KHZlbmRvciwga2V5KSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZhbHVlIGFzIGEgc3RyaW5nLgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFN0cmluZ0V4dGVuc2lvbihT\ndHJpbmcga2V5KSB7CiAgICAgICAgcmV0dXJuIGdldFN0cmluZ0V4dGVuc2lv\nbihPUEVOSlBBLCBrZXkpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRo\nZSB2YWx1ZSBhcyBhIHN0cmluZy4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXRTdHJpbmdFeHRlbnNpb24oU3RyaW5nIHZlbmRvciwgU3RyaW5nIGtl\neSkgewogICAgICAgIE9iamVjdCB2YWwgPSBnZXRPYmplY3RFeHRlbnNpb24o\ndmVuZG9yLCBrZXkpOwogICAgICAgIHJldHVybiAodmFsID09IG51bGwpID8g\nbnVsbCA6IHZhbC50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICog\nR2V0IHRoZSB2YWx1ZSBhcyBhbiBpbnQuCiAgICAgKi8KICAgIHB1YmxpYyBp\nbnQgZ2V0SW50RXh0ZW5zaW9uKFN0cmluZyBrZXkpIHsKICAgICAgICByZXR1\ncm4gZ2V0SW50RXh0ZW5zaW9uKE9QRU5KUEEsIGtleSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZXQgdGhlIHZhbHVlIGFzIGFuIGludC4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRJbnRFeHRlbnNpb24oU3RyaW5nIHZlbmRvciwg\nU3RyaW5nIGtleSkgewogICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmdF\neHRlbnNpb24odmVuZG9yLCBrZXkpOwogICAgICAgIHJldHVybiAoc3RyID09\nIG51bGwpID8gMCA6IEludGVnZXIucGFyc2VJbnQoc3RyKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEdldCB0aGUgdmFsdWUgYXMgYSBkb3VibGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBkb3VibGUgZ2V0RG91YmxlRXh0ZW5zaW9uKFN0cmlu\nZyBrZXkpIHsKICAgICAgICByZXR1cm4gZ2V0RG91YmxlRXh0ZW5zaW9uKE9Q\nRU5KUEEsIGtleSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZh\nbHVlIGFzIGEgZG91YmxlLgogICAgICovCiAgICBwdWJsaWMgZG91YmxlIGdl\ndERvdWJsZUV4dGVuc2lvbihTdHJpbmcgdmVuZG9yLCBTdHJpbmcga2V5KSB7\nCiAgICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZ0V4dGVuc2lvbih2ZW5k\nb3IsIGtleSk7CiAgICAgICAgcmV0dXJuIChzdHIgPT0gbnVsbCkgPyAwRCA6\nIERvdWJsZS5wYXJzZURvdWJsZShzdHIpOwogICAgfQoKICAgIC8qKgogICAg\nICogR2V0IHRoZSB2YWx1ZSBhcyBhIGJvb2xlYW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGdldEJvb2xlYW5FeHRlbnNpb24oU3RyaW5nIGtleSkg\newogICAgICAgIHJldHVybiBnZXRCb29sZWFuRXh0ZW5zaW9uKE9QRU5KUEEs\nIGtleSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZhbHVlIGFz\nIGEgYm9vbGVhbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Qm9v\nbGVhbkV4dGVuc2lvbihTdHJpbmcgdmVuZG9yLCBTdHJpbmcga2V5KSB7CiAg\nICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZ0V4dGVuc2lvbih2ZW5kb3Is\nIGtleSk7CiAgICAgICAgcmV0dXJuIChzdHIgPT0gbnVsbCkgPyBmYWxzZSA6\nIEJvb2xlYW4udmFsdWVPZihzdHIpLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBlbWJlZGRlZCBleHRlbnNpb25z\nIHVuZGVyIHRoZSBnaXZlbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBFeHRl\nbnNpb25zIGdldEVtYmVkZGVkRXh0ZW5zaW9ucyhTdHJpbmcga2V5LCBib29s\nZWFuIGNyZWF0ZSkgewogICAgICAgIHJldHVybiBnZXRFbWJlZGRlZEV4dGVu\nc2lvbnMoT1BFTkpQQSwga2V5LCBjcmVhdGUpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBlbWJlZGRlZCBleHRlbnNpb25zIHVuZGVyIHRo\nZSBnaXZlbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyBFeHRlbnNpb25zIGdl\ndEVtYmVkZGVkRXh0ZW5zaW9ucyhTdHJpbmcgdmVuZG9yLCBTdHJpbmcga2V5\nLAogICAgICAgIGJvb2xlYW4gY3JlYXRlKSB7CiAgICAgICAgaWYgKF9lbWJl\nZCA9PSBudWxsICYmICFjcmVhdGUpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIGlmIChfZW1iZWQgPT0gbnVsbCkKICAgICAgICAgICAgX2Vt\nYmVkID0gbmV3IEhhc2hNYXAoKTsKCiAgICAgICAgT2JqZWN0IGhrID0gZ2V0\nSGFzaEtleSh2ZW5kb3IsIGtleSk7CiAgICAgICAgRXh0ZW5zaW9ucyBleHRz\nID0gKEV4dGVuc2lvbnMpIF9lbWJlZC5nZXQoaGspOwogICAgICAgIGlmIChl\neHRzID09IG51bGwgJiYgIWNyZWF0ZSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgaWYgKGV4dHMgPT0gbnVsbCkgewogICAgICAgICAgICBl\neHRzID0gbmV3IEVtYmVkZGVkRXh0ZW5zaW9ucyh0aGlzKTsKICAgICAgICAg\nICAgX2VtYmVkLnB1dChoaywgZXh0cyk7CgogICAgICAgICAgICAvLyByZXF1\naXJlZCB0byByZWNvZ25pemUgZW1iZWRkZWQgZXh0ZW5zaW9ucyB3aXRob3V0\nIHZhbHVlcwogICAgICAgICAgICBpZiAoX2V4dHMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9leHRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAg\naWYgKCFfZXh0cy5jb250YWluc0tleShoaykpCiAgICAgICAgICAgICAgICBf\nZXh0cy5wdXQoaGssIG51bGwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZXh0czsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVFbWJlZGRl\nZEV4dGVuc2lvbnMoU3RyaW5nIGtleSkgewogICAgICAgIHJldHVybiByZW1v\ndmVFbWJlZGRlZEV4dGVuc2lvbnMoT1BFTkpQQSwga2V5KTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiByZW1vdmVFbWJlZGRlZEV4dGVuc2lvbnMoU3Ry\naW5nIHZlbmRvciwgU3RyaW5nIGtleSkgewogICAgICAgIHJldHVybiBfZW1i\nZWQgIT0gbnVsbAogICAgICAgICAgICAmJiBfZW1iZWQucmVtb3ZlKGdldEhh\nc2hLZXkodmVuZG9yLCBrZXkpKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29weSB0aGUgZXh0ZW5zaW9ucyBub3QgcHJlc2VudCBpbiB0aGlz\nIGluc3RhbmNlIGJ1dCBwcmVzZW50IGluIHRoZQogICAgICogZ2l2ZW4gaW5z\ndGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNvcHkoRXh0ZW5z\naW9ucyBleHRzKSB7CiAgICAgICAgaWYgKGV4dHMuaXNFbXB0eSgpKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChleHRzLl9leHRzICE9IG51\nbGwgJiYgIWV4dHMuX2V4dHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlm\nIChfZXh0cyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2V4dHMgPSBuZXcg\nSGFzaE1hcCgpOwoKICAgICAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGV4dHMuX2V4dHMuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICghX2V4dHMuY29udGFpbnNL\nZXkoZW50cnkuZ2V0S2V5KCkpKQogICAgICAgICAgICAgICAgICAgIF9leHRz\nLnB1dChlbnRyeS5nZXRLZXkoKSwgZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChleHRzLl9lbWJlZCAh\nPSBudWxsICYmICFleHRzLl9lbWJlZC5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgaWYgKF9lbWJlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2VtYmVk\nID0gbmV3IEhhc2hNYXAoKTsKCiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRy\neTsKICAgICAgICAgICAgRXh0ZW5zaW9ucyBlbWJlZGRlZDsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBleHRzLl9lbWJlZC5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgZW1iZWRkZWQgPSAoRXh0ZW5zaW9ucykg\nX2VtYmVkLmdldChlbnRyeS5nZXRLZXkoKSk7CiAgICAgICAgICAgICAgICBp\nZiAoZW1iZWRkZWQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGVt\nYmVkZGVkID0gbmV3IEVtYmVkZGVkRXh0ZW5zaW9ucyh0aGlzKTsKICAgICAg\nICAgICAgICAgICAgICBfZW1iZWQucHV0KGVudHJ5LmdldEtleSgpLCBlbWJl\nZGRlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbWJl\nZGRlZC5jb3B5KChFeHRlbnNpb25zKSBlbnRyeS5nZXRWYWx1ZSgpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBtZXRob2QgdG8gaXNzdWUgd2FybmluZ3MgZm9yIGFueSBleHRlbnNp\nb25zIHRoYXQgd2UKICAgICAqIHJlY29nbml6ZSBidXQgZG8gbm90IHVzZS4K\nICAgICAqCiAgICAgKiBAc2luY2UgMC4zLjEuMwogICAgICovCiAgICBwdWJs\naWMgdm9pZCB2YWxpZGF0ZUV4dGVuc2lvbktleXMoKSB7CiAgICAgICAgaWYg\nKF9leHRzID09IG51bGwgfHwgX2V4dHMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYg\nPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAg\nIExvZyBsb2cgPSBjb25mLmdldExvZyhjb25mLkxPR19NRVRBREFUQSk7CiAg\nICAgICAgaWYgKCFsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIENvbGxlY3Rpb24gdmFsaWROYW1lcyA9IG5ldyBU\ncmVlU2V0KCk7CiAgICAgICAgYWRkRXh0ZW5zaW9uS2V5cyh2YWxpZE5hbWVz\nKTsKCiAgICAgICAgLy8gdGhpcyBpcyB3aGVyZSB3ZSBzdG9yZSB0aGluZ3Mg\nbGlrZSAiamRiYy0iIGZvciBhCiAgICAgICAgLy8gcHJlZml4IGZvciBhbiBl\neHRlbnNpb24gbmFtZSB0aGF0IHdlIHdvbid0IHZhbGlkYXRlOyB0aGF0CiAg\nICAgICAgLy8gd2F5IGEgbmV3IHZlbmRvciBjb3VsZCB0aGVvcmV0aWNhbGx5\nIGFkZCBpbiB0aGVpcgogICAgICAgIC8vIG93biBwcmVmaXggaW50byB0aGUg\nbG9jYWxpemVyLnByb3BlcnRpZXMgZmlsZSBhbmQKICAgICAgICAvLyBub3Qg\naGF2ZSB0byBpc3N1ZSB3YXJuaW5ncyBmb3IgdGhlaXIgZXh0ZW5zaW9ucwog\nICAgICAgIFN0cmluZyBwcmVmaXhlcyA9IF9sb2MuZ2V0KCJleHRlbnNpb24t\nZGF0YXN0b3JlLXByZWZpeCIpLmdldE1lc3NhZ2UoKTsKICAgICAgICBTdHJp\nbmdbXSBhbGxvd2VkUHJlZml4ZXMgPSBudWxsOwogICAgICAgIGlmIChwcmVm\naXhlcyAhPSBudWxsKQogICAgICAgICAgICBhbGxvd2VkUHJlZml4ZXMgPSBT\ndHJpbmdzLnNwbGl0KHByZWZpeGVzLCAiLCIsIDApOwoKICAgICAgICBPYmpl\nY3QgbmV4dDsKICAgICAgICBTdHJpbmcga2V5OwogICAgICAgIG91dGVyOgog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2V4dHMua2V5U2V0KCkuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgbmV4dCA9\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICghT1BFTkpQQS5lcXVhbHMo\nZ2V0VmVuZG9yKG5leHQpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICBrZXkgPSBnZXRLZXkobmV4dCk7CiAgICAgICAgICAgIGlm\nICh2YWxpZE5hbWVzLmNvbnRhaW5zKGtleSkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIGlmIChhbGxvd2VkUHJlZml4ZXMgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBh\nbGxvd2VkUHJlZml4ZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgoYWxsb3dlZFByZWZpeGVzW2pdKQog\nICAgICAgICAgICAgICAgICAgICAgICAmJiAhdmFsaWRhdGVEYXRhU3RvcmVF\neHRlbnNpb25QcmVmaXgKICAgICAgICAgICAgICAgICAgICAgICAgKGFsbG93\nZWRQcmVmaXhlc1tqXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlIG91dGVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyB0cnkgdG8gZGV0ZXJtaW5lIGlmIHRoZXJlIGFyZSBh\nbnkgb3RoZXIgbmFtZXMgdGhhdCBhcmUKICAgICAgICAgICAgLy8gc2ltaWxp\nYXIgdG8gdGhpcyBvbmUsIHNvIHdlIGNhbiBhZGQgaW4gYSBoaW50CiAgICAg\nICAgICAgIFN0cmluZyBjbG9zZXN0TmFtZSA9IFN0cmluZ0Rpc3RhbmNlLmdl\ndENsb3Nlc3RMZXZlbnNodGVpbkRpc3RhbmNlCiAgICAgICAgICAgICAgICAo\na2V5LCB2YWxpZE5hbWVzLCAwLjVmKTsKCiAgICAgICAgICAgIGlmIChjbG9z\nZXN0TmFtZSA9PSBudWxsKQogICAgICAgICAgICAgICAgbG9nLndhcm4oX2xv\nYy5nZXQoInVucmVjb2duaXplZC1leHRlbnNpb24iLCB0aGlzLAogICAgICAg\nICAgICAgICAgICAgIGtleSwgdmFsaWROYW1lcykpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgidW5yZWNv\nZ25pemVkLWV4dGVuc2lvbi1oaW50IiwKICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IHRoaXMsIGtleSwgdmFsaWROYW1lcywgY2xvc2VzdE5h\nbWUgfSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBh\nbGwgdGhlIGtub3duIGV4dGVuc2lvbiBrZXlzIHRvIHRoZSBzcGVjaWZpZWQg\nY29sbGVjdGlvbjsgYW55CiAgICAgKiBpbXBsZW1lbnRhdGlvbiB0aGF0IHV0\naWxpemVkIG5ldyBleHRlbnNpb25zIHNob3VsZCBvdmVycmlkZSB0aGlzCiAg\nICAgKiBtZXRob2QgdG8gaW5jbHVkZSBib3RoIHRoZSBrbm93biBleHRlbnNp\nb25zIG9mIGl0cyBzdXBlcmNsYXNzIGFzIHdlbGwKICAgICAqIGFzIGl0cyBv\nd24gZXh0ZW5zaW9uIGtleXMuCiAgICAgKgogICAgICogQHNpbmNlIDAuMy4x\nLjMKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYWRkRXh0ZW5zaW9uS2V5\ncyhDb2xsZWN0aW9uIGV4dHMpIHsKICAgICAgICAvLyBubyBleHRlbnNpb25z\nIGJ5IGRlZmF1bHQKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVl\nIGlmIGV4dGVuc2lvbnMgc3RhcnRpbmcgd2l0aCB0aGUgZ2l2ZW4gb2ZmaWNp\nYWwgZGF0YXN0b3JlCiAgICAgKiBwcmVmaXggc2hvdWxkIGJlIHZhbGlkYXRl\nZCBmb3IgdGhpcyBydW50aW1lLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiB2YWxpZGF0ZURhdGFTdG9yZUV4dGVuc2lvblByZWZpeChTdHJpbmcg\ncHJlZml4KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSByZXBvc2l0b3J5LgogICAg\nICovCiAgICBwdWJsaWMgYWJzdHJhY3QgTWV0YURhdGFSZXBvc2l0b3J5IGdl\ndFJlcG9zaXRvcnkoKTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGhhc2gg\na2V5IGZvciB0aGUgZ2l2ZW4gdmVuZG9yL2tleSBjb21iby4KICAgICAqLwog\nICAgcHJpdmF0ZSBPYmplY3QgZ2V0SGFzaEtleShTdHJpbmcgdmVuZG9yLCBT\ndHJpbmcga2V5KSB7CiAgICAgICAgaWYgKE9QRU5KUEEuZXF1YWxzKHZlbmRv\ncikpCiAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgcmV0dXJuIG5l\ndyBIYXNoS2V5KHZlbmRvciwga2V5KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEV4dHJhY3QgdGhlIHZlbmRvciBmcm9tIHRoZSBnaXZlbiBoYXNoIGtleS4K\nICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0VmVuZG9yKE9iamVjdCBo\nYXNoS2V5KSB7CiAgICAgICAgcmV0dXJuIChoYXNoS2V5IGluc3RhbmNlb2Yg\nU3RyaW5nKSA/IE9QRU5KUEEgOgogICAgICAgICAgICAoKEhhc2hLZXkpIGhh\nc2hLZXkpLnZlbmRvcjsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3Qg\ndGhlIGtleSBmcm9tIHRoZSBnaXZlbiBoYXNoIGtleS4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgZ2V0S2V5KE9iamVjdCBoYXNoS2V5KSB7CiAgICAg\nICAgcmV0dXJuIChoYXNoS2V5IGluc3RhbmNlb2YgU3RyaW5nKSA/IChTdHJp\nbmcpIGhhc2hLZXkKICAgICAgICAgICAgOiAoKEhhc2hLZXkpIGhhc2hLZXkp\nLmtleTsKICAgIH0KCiAgICAvKioKICAgICAqIEtleSBjbGFzcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgSGFzaEtleSB7CgogICAgICAg\nIHB1YmxpYyBmaW5hbCBTdHJpbmcgdmVuZG9yOwogICAgICAgIHB1YmxpYyBm\naW5hbCBTdHJpbmcga2V5OwoKICAgICAgICBwdWJsaWMgSGFzaEtleShTdHJp\nbmcgdmVuZG9yLCBTdHJpbmcga2V5KSB7CiAgICAgICAgICAgIHRoaXMudmVu\nZG9yID0gdmVuZG9yOwogICAgICAgICAgICB0aGlzLmtleSA9IGtleTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAg\nICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgaWYgKHZlbmRvciAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgaSA9IHZlbmRvci5oYXNoQ29kZSgpOwog\nICAgICAgICAgICBpZiAoa2V5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBp\nICs9IDE3ICoga2V5Lmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9i\namVjdCBvdGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBIYXNo\nS2V5IGhrID0gKEhhc2hLZXkpIG90aGVyOwogICAgICAgICAgICByZXR1cm4g\nU3RyaW5nVXRpbHMuZXF1YWxzKHZlbmRvciwgaGsudmVuZG9yKQogICAgICAg\nICAgICAgICAgJiYgU3RyaW5nVXRpbHMuZXF1YWxzKGtleSwgaGsua2V5KTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWJlZGRlZCBleHRl\nbnNpb25zIGltcGxlbWVudGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBjbGFzcyBFbWJlZGRlZEV4dGVuc2lvbnMKICAgICAgICBleHRlbmRz\nIEV4dGVuc2lvbnMgewoKICAgICAgICBwcml2YXRlIGZpbmFsIEV4dGVuc2lv\nbnMgX3BhcmVudDsKCiAgICAgICAgcHVibGljIEVtYmVkZGVkRXh0ZW5zaW9u\ncyhFeHRlbnNpb25zIHBhcmVudCkgewogICAgICAgICAgICBfcGFyZW50ID0g\ncGFyZW50OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE1ldGFEYXRhUmVw\nb3NpdG9yeSBnZXRSZXBvc2l0b3J5ICgpCgkJewoJCQlyZXR1cm4gX3BhcmVu\ndC5nZXRSZXBvc2l0b3J5ICgpOwoJCX0KCX0KfQo=\n","encoding":"base64"}

