{"sha":"4748d0f06aefbfed789b8b255069f933828fbeeb","node_id":"MDQ6QmxvYjIwNjM2NDo0NzQ4ZDBmMDZhZWZiZmVkNzg5YjhiMjU1MDY5ZjkzMzgyOGZiZWVi","size":15493,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4748d0f06aefbfed789b8b255069f933828fbeeb","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhOwoKaW1wb3J0IGphdmEuaW8uU2VyaWFsaXphYmxlOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuQXJyYXk7CmltcG9ydCBqYXZhLm1h\ndGguQmlnRGVjaW1hbDsKaW1wb3J0IGphdmEubWF0aC5CaWdJbnRlZ2VyOwpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBv\ncnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5M\nb2NhbGU7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLlByb3BlcnRpZXM7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFu\nY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5tZXRhLkNGTWV0YURhdGFQYXJzZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBz\nZXJwLnV0aWwuTnVtYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoK\nLyoqCiAqIFR5cGUgY29uc3RhbnRzIGZvciBtYW5hZ2VkIGZpZWxkcy4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBKYXZhVHlw\nZXMgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEJPT0xFQU4gPSAw\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQllURSA9IDE7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBDSEFSID0gMjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IERPVUJMRSA9IDM7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBGTE9BVCA9IDQ7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBJTlQgPSA1OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTE9O\nRyA9IDY7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTSE9SVCA9IDc7\nCiAgICAvLyBrZWVwIE9CSkVDVCBhcyBmaXJzdCBub24tcHJpbWl0aXZlIHR5\ncGUgY29kZTsgb3RoZXIgY29kZSByZWxpZXMgb24gaXQKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IE9CSkVDVCA9IDg7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBTVFJJTkcgPSA5OwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgTlVNQkVSID0gMTA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu\ndCBBUlJBWSA9IDExOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ09M\nTEVDVElPTiA9IDEyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUFQ\nID0gMTM7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBEQVRFID0gMTQ7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBQQyA9IDE1OwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgQk9PTEVBTl9PQkogPSAxNjsKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IEJZVEVfT0JKID0gMTc7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBDSEFSX09CSiA9IDE4OwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgRE9VQkxFX09CSiA9IDE5OwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgRkxPQVRfT0JKID0gMjA7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBJTlRfT0JKID0gMjE7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBMT05HX09CSiA9IDIyOwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgU0hPUlRfT0JKID0gMjM7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBCSUdERUNJTUFMID0gMjQ7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBCSUdJTlRFR0VSID0gMjU7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBMT0NBTEUgPSAyNjsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IFBDX1VOVFlQRUQgPSAyNzsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IENBTEVOREFSID0gMjg7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBPSUQgPSAyOTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKEphdmFUeXBlcy5j\nbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF90eXBlQ29k\nZXMgPSBuZXcgSGFzaE1hcCgpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX3R5\ncGVDb2Rlcy5wdXQoU3RyaW5nLmNsYXNzLCBOdW1iZXJzLnZhbHVlT2YoU1RS\nSU5HKSk7CiAgICAgICAgX3R5cGVDb2Rlcy5wdXQoQm9vbGVhbi5jbGFzcywg\nTnVtYmVycy52YWx1ZU9mKEJPT0xFQU5fT0JKKSk7CiAgICAgICAgX3R5cGVD\nb2Rlcy5wdXQoQnl0ZS5jbGFzcywgTnVtYmVycy52YWx1ZU9mKEJZVEVfT0JK\nKSk7CiAgICAgICAgX3R5cGVDb2Rlcy5wdXQoQ2hhcmFjdGVyLmNsYXNzLCBO\ndW1iZXJzLnZhbHVlT2YoQ0hBUl9PQkopKTsKICAgICAgICBfdHlwZUNvZGVz\nLnB1dChEb3VibGUuY2xhc3MsIE51bWJlcnMudmFsdWVPZihET1VCTEVfT0JK\nKSk7CiAgICAgICAgX3R5cGVDb2Rlcy5wdXQoRmxvYXQuY2xhc3MsIE51bWJl\ncnMudmFsdWVPZihGTE9BVF9PQkopKTsKICAgICAgICBfdHlwZUNvZGVzLnB1\ndChJbnRlZ2VyLmNsYXNzLCBOdW1iZXJzLnZhbHVlT2YoSU5UX09CSikpOwog\nICAgICAgIF90eXBlQ29kZXMucHV0KExvbmcuY2xhc3MsIE51bWJlcnMudmFs\ndWVPZihMT05HX09CSikpOwogICAgICAgIF90eXBlQ29kZXMucHV0KFNob3J0\nLmNsYXNzLCBOdW1iZXJzLnZhbHVlT2YoU0hPUlRfT0JKKSk7CiAgICAgICAg\nX3R5cGVDb2Rlcy5wdXQoRGF0ZS5jbGFzcywgTnVtYmVycy52YWx1ZU9mKERB\nVEUpKTsKICAgICAgICBfdHlwZUNvZGVzLnB1dChqYXZhLnNxbC5EYXRlLmNs\nYXNzLCBOdW1iZXJzLnZhbHVlT2YoREFURSkpOwogICAgICAgIF90eXBlQ29k\nZXMucHV0KGphdmEuc3FsLlRpbWVzdGFtcC5jbGFzcywgTnVtYmVycy52YWx1\nZU9mKERBVEUpKTsKICAgICAgICBfdHlwZUNvZGVzLnB1dChqYXZhLnNxbC5U\naW1lLmNsYXNzLCBOdW1iZXJzLnZhbHVlT2YoREFURSkpOwogICAgICAgIF90\neXBlQ29kZXMucHV0KEJpZ0ludGVnZXIuY2xhc3MsIE51bWJlcnMudmFsdWVP\nZihCSUdJTlRFR0VSKSk7CiAgICAgICAgX3R5cGVDb2Rlcy5wdXQoQmlnRGVj\naW1hbC5jbGFzcywgTnVtYmVycy52YWx1ZU9mKEJJR0RFQ0lNQUwpKTsKICAg\nICAgICBfdHlwZUNvZGVzLnB1dChOdW1iZXIuY2xhc3MsIE51bWJlcnMudmFs\ndWVPZihOVU1CRVIpKTsKICAgICAgICBfdHlwZUNvZGVzLnB1dChMb2NhbGUu\nY2xhc3MsIE51bWJlcnMudmFsdWVPZihMT0NBTEUpKTsKICAgICAgICBfdHlw\nZUNvZGVzLnB1dChPYmplY3QuY2xhc3MsIE51bWJlcnMudmFsdWVPZihPQkpF\nQ1QpKTsKICAgICAgICBfdHlwZUNvZGVzLnB1dChQZXJzaXN0ZW5jZUNhcGFi\nbGUuY2xhc3MsIE51bWJlcnMudmFsdWVPZihQQ19VTlRZUEVEKSk7CiAgICAg\nICAgX3R5cGVDb2Rlcy5wdXQoUHJvcGVydGllcy5jbGFzcywgTnVtYmVycy52\nYWx1ZU9mKE1BUCkpOwogICAgICAgIF90eXBlQ29kZXMucHV0KENhbGVuZGFy\nLmNsYXNzLCBOdW1iZXJzLnZhbHVlT2YoQ0FMRU5EQVIpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgbWV0YWRhdGEgdHlwZSBj\nb2RlIGZvciB0aGUgZ2l2ZW4gY2xhc3MuIEZpcnN0IGNsYXNzCiAgICAgKiBv\nYmplY3RzIGFyZSBub3QgcmVjb2duaXplZCBpbiB0aGlzIG1ldGhvZC4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBpbnQgZ2V0VHlwZUNvZGUoQ2xhc3Mg\ndHlwZSkgewogICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBPQkpFQ1Q7CgogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZl\nKCkpIHsKICAgICAgICAgICAgc3dpdGNoICh0eXBlLmdldE5hbWUoKS5jaGFy\nQXQoMCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ2InOgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiAodHlwZSA9PSBib29sZWFuLmNsYXNzKSA/IEJP\nT0xFQU4gOiBCWVRFOwogICAgICAgICAgICAgICAgY2FzZSAnYyc6CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIENIQVI7CiAgICAgICAgICAgICAgICBj\nYXNlICdkJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRE9VQkxFOwog\nICAgICAgICAgICAgICAgY2FzZSAnZic6CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIEZMT0FUOwogICAgICAgICAgICAgICAgY2FzZSAnaSc6CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIElOVDsKICAgICAgICAgICAgICAgIGNh\nc2UgJ2wnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBMT05HOwogICAg\nICAgICAgICAgICAgY2FzZSAncyc6CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIFNIT1JUOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBJ\nbnRlZ2VyIGNvZGUgPSAoSW50ZWdlcikgX3R5cGVDb2Rlcy5nZXQodHlwZSk7\nCiAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGNvZGUuaW50VmFsdWUoKTsKCiAgICAgICAgLy8gaGF2ZSB0byBkbyB0aGlz\nIGZpcnN0IHRvIGNhdGNoIGN1c3RvbSBjb2xsZWN0aW9uIGFuZCBtYXAgdHlw\nZXM7CiAgICAgICAgLy8gb24gcmVzb2x2ZSB3ZSBmaWd1cmUgb3V0IGlmIHRo\nZXNlIGN1c3RvbSB0eXBlcyBhcmUKICAgICAgICAvLyBwZXJzaXN0ZW5jZS1j\nYXBhYmxlCiAgICAgICAgaWYgKENvbGxlY3Rpb24uY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgcmV0dXJuIENPTExFQ1RJT047\nCiAgICAgICAgaWYgKE1hcC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUp\nKQogICAgICAgICAgICByZXR1cm4gTUFQOwogICAgICAgIGlmICh0eXBlLmlz\nQXJyYXkoKSkKICAgICAgICAgICAgcmV0dXJuIEFSUkFZOwogICAgICAgIGlm\nIChDYWxlbmRhci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAg\nICAgICAgICByZXR1cm4gQ0FMRU5EQVI7CgogICAgICAgIGlmICh0eXBlLmlz\nSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgaWYgKHR5cGUgPT0gU2VyaWFs\naXphYmxlLmNsYXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIE9CSkVDVDsK\nICAgICAgICAgICAgcmV0dXJuIFBDX1VOVFlQRUQ7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBPQkpFQ1Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVj\nayB0aGUgZ2l2ZW4gbmFtZSBhZ2FpbnN0IHRoZSBzYW1lIHNldCBvZiBzdGFu\nZGFyZCBwYWNrYWdlcyB1c2VkCiAgICAgKiB3aGVuIHBhcnNpbmcgbWV0YWRh\ndGEuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ2xhc3MgY2xhc3NGb3JO\nYW1lKFN0cmluZyBuYW1lLCBDbGFzc01ldGFEYXRhIGNvbnRleHQpIHsKICAg\nICAgICByZXR1cm4gY2xhc3NGb3JOYW1lKG5hbWUsIGNvbnRleHQsIG51bGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhlIGdpdmVuIG5hbWUg\nYWdhaW5zdCB0aGUgc2FtZSBzZXQgb2Ygc3RhbmRhcmQgcGFja2FnZXMgdXNl\nZAogICAgICogd2hlbiBwYXJzaW5nIG1ldGFkYXRhLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIENsYXNzIGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwg\nQ2xhc3NNZXRhRGF0YSBjb250ZXh0LAogICAgICAgIENsYXNzTG9hZGVyIGxv\nYWRlcikgewogICAgICAgIHJldHVybiBjbGFzc0Zvck5hbWUobmFtZSwgY29u\ndGV4dCwgY29udGV4dC5nZXREZXNjcmliZWRUeXBlKCksIG51bGwsCiAgICAg\nICAgICAgIGxvYWRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0\naGUgZ2l2ZW4gbmFtZSBhZ2FpbnN0IHRoZSBzYW1lIHNldCBvZiBzdGFuZGFy\nZCBwYWNrYWdlcyB1c2VkCiAgICAgKiB3aGVuIHBhcnNpbmcgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ2xhc3MgY2xhc3NGb3JOYW1l\nKFN0cmluZyBuYW1lLCBWYWx1ZU1ldGFEYXRhIGNvbnRleHQpIHsKICAgICAg\nICByZXR1cm4gY2xhc3NGb3JOYW1lKG5hbWUsIGNvbnRleHQsIG51bGwpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhlIGdpdmVuIG5hbWUgYWdh\naW5zdCB0aGUgc2FtZSBzZXQgb2Ygc3RhbmRhcmQgcGFja2FnZXMgdXNlZAog\nICAgICogd2hlbiBwYXJzaW5nIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIENsYXNzIGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwgVmFs\ndWVNZXRhRGF0YSBjb250ZXh0LAogICAgICAgIENsYXNzTG9hZGVyIGxvYWRl\ncikgewogICAgICAgIHJldHVybiBjbGFzc0Zvck5hbWUobmFtZSwKICAgICAg\nICAgICAgY29udGV4dC5nZXRGaWVsZE1ldGFEYXRhKCkuZ2V0RGVmaW5pbmdN\nZXRhRGF0YSgpLAogICAgICAgICAgICBjb250ZXh0LmdldEZpZWxkTWV0YURh\ndGEoKS5nZXREZWNsYXJpbmdUeXBlKCksIGNvbnRleHQsIGxvYWRlcik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0aGUgZ2l2ZW4gbmFtZSBhZ2Fp\nbnN0IHRoZSBzYW1lIHNldCBvZiBzdGFuZGFyZCBwYWNrYWdlcyB1c2VkCiAg\nICAgKiB3aGVuIHBhcnNpbmcgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIENsYXNzIGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwgQ2xh\nc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIENsYXNzIGRlYywgVmFsdWVNZXRh\nRGF0YSB2bWQsIENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIC8vIHNw\nZWNpYWwgY2FzZSBmb3IgUGVyc2lzdGVuY2VDYXBhYmxlIGFuZCBPYmplY3QK\nICAgICAgICBpZiAoIlBlcnNpc3RlbmNlQ2FwYWJsZSIuZXF1YWxzKG5hbWUp\nCiAgICAgICAgICAgIHx8ICJqYXZheC5qZG8uUGVyc2lzdGVuY2VDYXBhYmxl\nIi5lcXVhbHMobmFtZSkpIC8vIGJhY2t3YXJkcyBjb21wYXQKICAgICAgICAg\nICAgcmV0dXJuIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzczsKICAgICAgICBp\nZiAoIk9iamVjdCIuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4g\nT2JqZWN0LmNsYXNzOwoKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nID0gbWV0YS5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgYm9vbGVhbiBydW50\naW1lID0gKHJlcC5nZXRWYWxpZGF0ZSgpICYgcmVwLlZBTElEQVRFX1JVTlRJ\nTUUpICE9IDA7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAg\nICAgICBsb2FkZXIgPSByZXAuZ2V0Q29uZmlndXJhdGlvbigpLmdldENsYXNz\nUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0Q2xhc3NM\nb2FkZXIoZGVjLCBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCkpOwoKICAgICAg\nICAvLyB0cnkgdGhlIG93bmVyJ3MgcGFja2FnZQogICAgICAgIFN0cmluZyBw\na2cgPSBTdHJpbmdzLmdldFBhY2thZ2VOYW1lKGRlYyk7CiAgICAgICAgQ2xh\nc3MgY2xzID0gQ0ZNZXRhRGF0YVBhcnNlci5jbGFzc0Zvck5hbWUobmFtZSwg\ncGtnLCBydW50aW1lLCBsb2FkZXIpOwogICAgICAgIGlmIChjbHMgPT0gbnVs\nbCAmJiB2bWQgIT0gbnVsbCkgewogICAgICAgICAgICAvLyB0cnkgYWdhaW5z\ndCB0aGlzIHZhbHVlIHR5cGUncyBwYWNrYWdlIHRvbwogICAgICAgICAgICBw\na2cgPSBTdHJpbmdzLmdldFBhY2thZ2VOYW1lKHZtZC5nZXREZWNsYXJlZFR5\ncGUoKSk7CiAgICAgICAgICAgIGNscyA9IENGTWV0YURhdGFQYXJzZXIuY2xh\nc3NGb3JOYW1lKG5hbWUsIHBrZywgcnVudGltZSwgbG9hZGVyKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1jbGFzcyIs\nIG5hbWUsCiAgICAgICAgICAgICAgICAodm1kID09IG51bGwpID8gKE9iamVj\ndCkgbWV0YSA6IChPYmplY3QpIHZtZCkpOwogICAgICAgIHJldHVybiBjbHM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBnaXZlbiBvYmpl\nY3QgdG8gdGhlIGdpdmVuIHR5cGUgaWYgcG9zc2libGUuIElmIHRoZSB0eXBl\nIGlzCiAgICAgKiBhIG51bWVyaWMgcHJpbWl0aXZlLCB0aGlzIG1ldGhvZCBv\nbmx5IGd1YXJhbnRlZXMgdGhhdCB0aGUgcmV0dXJuIHZhbHVlCiAgICAgKiBp\ncyBhIHtAbGluayBOdW1iZXJ9LiBJZiBubyBrbm93biBjb252ZXJzaW9uIG9y\nIHRoZSB2YWx1ZSBpcyBudWxsLAogICAgICogcmV0dXJucyB0aGUgb3JpZ2lu\nYWwgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGNv\nbnZlcnQoT2JqZWN0IHZhbCwgaW50IHR5cGVDb2RlKSB7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgc3dpdGNoICh0eXBlQ29kZSkgewogICAgICAgICAgICBjYXNlIEJJR0RF\nQ0lNQUw6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQmln\nRGVjaW1hbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAg\nICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIE51bWJlcikKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IEJpZ0RlY2ltYWwoKChOdW1iZXIp\nIHZhbCkuZG91YmxlVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBpZiAodmFs\nIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgQmlnRGVjaW1hbCh2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICBjYXNlIEJJR0lOVEVHRVI6\nCiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQmlnSW50ZWdl\ncikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAg\nICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIE51bWJlciB8fCB2YWwgaW5zdGFu\nY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBC\naWdJbnRlZ2VyKHZhbC50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiB2YWw7CiAgICAgICAgICAgIGNhc2UgQk9PTEVBTjoKICAgICAgICAg\nICAgY2FzZSBCT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIGlmICh2YWwg\naW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4udmFsdWVPZih2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICBjYXNlIEJZVEVfT0JKOgog\nICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIEJ5dGUpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgICAgIGlm\nICh2YWwgaW5zdGFuY2VvZiBOdW1iZXIpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBCeXRlKCgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpKTsK\nICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGNhc2Ug\nQllURToKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJp\nbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCeXRlKHZhbC50\nb1N0cmluZygpKTsKICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAg\nICAgICAgIGNhc2UgQ0hBUjoKICAgICAgICAgICAgY2FzZSBDSEFSX09CSjoK\nICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDaGFyYWN0ZXIp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAg\nICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0ZXIodmFsLnRvU3RyaW5nKCkuY2hh\nckF0KDApKTsKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBO\ndW1iZXIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0\nZXIoKGNoYXIpICgoTnVtYmVyKSB2YWwpLmludFZhbHVlKCkpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgY2FzZSBEQVRFOgog\nICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZykKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUodmFsLnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAg\nY2FzZSBET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0\nYW5jZW9mIERvdWJsZSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFs\nOwogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIE51bWJlcikK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZSgoKE51bWJl\ncikgdmFsKS5kb3VibGVWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIC8vIG5v\nIGJyZWFrCiAgICAgICAgICAgIGNhc2UgRE9VQkxFOgogICAgICAgICAgICAg\nICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IERvdWJsZSh2YWwudG9TdHJpbmcoKSk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICBjYXNlIEZMT0FU\nX09CSjoKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBGbG9h\ndCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAg\nICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIE51bWJlcikKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IEZsb2F0KCgoTnVtYmVyKSB2YWwpLmZsb2F0\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAg\nICAgICBjYXNlIEZMT0FUOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0\nYW5jZW9mIFN0cmluZykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIEZsb2F0KHZhbC50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiB2YWw7CiAgICAgICAgICAgIGNhc2UgSU5UX09CSjoKICAgICAgICAgICAg\nICAgIGlmICh2YWwgaW5zdGFuY2VvZiBJbnRlZ2VyKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgICAgICAgICBpZiAodmFsIGlu\nc3RhbmNlb2YgTnVtYmVyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBO\ndW1iZXJzLnZhbHVlT2YoKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSk7CiAg\nICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNlIElO\nVDoKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnRlZ2VyKHZhbC50\nb1N0cmluZygpKTsKICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAg\nICAgICAgIGNhc2UgTE9OR19PQko6CiAgICAgICAgICAgICAgICBpZiAodmFs\nIGluc3RhbmNlb2YgTG9uZykKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ndmFsOwogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIE51bWJl\ncikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKCgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpKTsKICAgICAgICAgICAgICAg\nIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGNhc2UgTE9ORzoKICAgICAgICAg\nICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBMb25nKHZhbC50b1N0cmluZygpKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgICAgIGNhc2UgTlVN\nQkVSOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIE51bWJl\ncikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAg\nICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZykKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IEJpZ0RlY2ltYWwodmFsLnRvU3RyaW5nKCkp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgY2Fz\nZSBTSE9SVF9PQko6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNl\nb2YgU2hvcnQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAg\nICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBOdW1iZXIpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydCgoKE51bWJlcikgdmFs\nKS5zaG9ydFZhbHVlKCkpOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsK\nICAgICAgICAgICAgY2FzZSBTSE9SVDoKICAgICAgICAgICAgICAgIGlmICh2\nYWwgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTaG9ydCh2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdmFsOwogICAgICAgICAgICBjYXNlIFNUUklORzoKICAgICAg\nICAgICAgICAgIHJldHVybiB2YWwudG9TdHJpbmcoKTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIChw\nb3NzaWJseSB1bnJlc29sdmVkKSBmaWVsZCBvciBpdHMgZWxlbWVudHMgbWln\naHQgYmUKICAgICAqIHBlcnNpc3RlbmNlIGNhcGFibGUgb2JqZWN0cy4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIG1heWJlUEMoRmllbGRN\nZXRhRGF0YSBmaWVsZCkgewogICAgICAgIHN3aXRjaCAoZmllbGQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9O\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG1heWJlUEMoZmllbGQuZ2V0RWxl\nbWVudCgpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG1heWJlUEMoZmllbGQuZ2V0S2V5KCkpIHx8\nIG1heWJlUEMoZmllbGQuZ2V0RWxlbWVudCgpKTsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBtYXliZVBDKChWYWx1ZU1l\ndGFEYXRhKSBmaWVsZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIChwb3NzaWJseSB1bnJlc29sdmVkKSB2\nYWx1ZSBtaWdodCBiZSBhIGZpcnN0IGNsYXNzCiAgICAgKiBvYmplY3QuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBtYXliZVBDKFZhbHVl\nTWV0YURhdGEgdmFsKSB7CiAgICAgICAgcmV0dXJuIG1heWJlUEModmFsLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSwgdmFsLmdldERlY2xhcmVkVHlwZSgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZl\nbiB1bnJlc29sdmVkIHR5cGVjb2RlL3R5cGUgcGFpciBtYXkgcmVwcmVzZW50\nIGEKICAgICAqIHBlcnNpc3RlbnQgb2JqZWN0LgogICAgICovCiAgICBzdGF0\naWMgYm9vbGVhbiBtYXliZVBDKGludCB0eXBlQ29kZSwgQ2xhc3MgdHlwZSkg\newogICAgICAgIGlmICh0eXBlID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKHR5cGVDb2RlKSB7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuUEM6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VO\nVFlQRUQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgcmV0dXJuICF0eXBl\nLmdldE5hbWUoKS5zdGFydHNXaXRoKCJqYXZhLnV0aWwuIik7CiAgICAgICAg\nICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0\nbyByZXR1cm4gdGhlIGdpdmVuIGFycmF5IHZhbHVlIGFzIGEgY29sbGVjdGlv\nbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBMaXN0IHRvTGlzdChPYmpl\nY3QgdmFsLCBDbGFzcyBlbGVtLCBib29sZWFuIG11dGFibGUpIHsKICAgICAg\nICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBMaXN0IGw7CiAgICAgICAgaWYgKCFlbGVtLmlzUHJpbWl0aXZl\nKCkpIHsKICAgICAgICAgICAgLy8gaWYgYW4gb2JqZWN0IGFycmF5LCB1c2Ug\nYnVpbHQtaW4gbGlzdCBmdW5jdGlvbgogICAgICAgICAgICBsID0gQXJyYXlz\nLmFzTGlzdCgoT2JqZWN0W10pIHZhbCk7CiAgICAgICAgICAgIGlmIChtdXRh\nYmxlKQogICAgICAgICAgICAgICAgbCA9IG5ldyBBcnJheUxpc3QobCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29udmVydCB0byBsaXN0\nIG9mIHdyYXBwZXIgb2JqZWN0cwogICAgICAgICAgICBpbnQgbGVuZ3RoID0g\nQXJyYXkuZ2V0TGVuZ3RoKHZhbCk7CiAgICAgICAgICAgIGwgPSBuZXcgQXJy\nYXlMaXN0KGxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBsLmFkZChBcnJheS5n\nZXQodmFsLCBpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsOwogICAg\nfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhl\nIGdpdmVuIGNvbGxlY3Rpb24gYXMgYW4gYXJyYXkuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgT2JqZWN0IHRvQXJyYXkoQ29sbGVjdGlvbiBjb2xsLCBD\nbGFzcyBlbGVtKSB7CiAgICAgICAgaWYgKGNvbGwgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIE9iamVjdCBhcnJheSA9IEFy\ncmF5Lm5ld0luc3RhbmNlKGVsZW0sIGNvbGwuc2l6ZSgpKTsKICAgICAgICBp\nbnQgaWR4ID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNvbGwu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspCiAgICAgICAgICAg\nIEFycmF5LnNldChhcnJheSwgaWR4LCBpdHIubmV4dCAoKSk7CgkJcmV0dXJu\nIGFycmF5OwoJfQp9Cg==\n","encoding":"base64"}

