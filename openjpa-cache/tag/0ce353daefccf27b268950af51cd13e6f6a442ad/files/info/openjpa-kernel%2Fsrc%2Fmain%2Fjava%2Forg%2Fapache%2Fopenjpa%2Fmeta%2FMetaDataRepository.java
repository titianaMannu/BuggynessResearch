{"sha":"5d63e9fb0c4cd1eb61e1b18eb79e6d3d384af387","node_id":"MDQ6QmxvYjIwNjM2NDo1ZDYzZTlmYjBjNGNkMWViNjFlMWIxOGViNzllNmQzZDM4NGFmMzg3","size":63013,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5d63e9fb0c4cd1eb61e1b18eb79e6d3d384af387","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhOwoKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGls\nLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLlNldDsKaW1wb3J0IGphdmEudXRpbC5Tb3J0ZWRTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuVHJlZVNldDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnkuUmVnaXN0ZXJDbGFzc0xpc3RlbmVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVu\nY2VDYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lkxp\nZmVjeWNsZUV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5DbG9zZWFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IHNlcnAu\ndXRpbC5TdHJpbmdzOwoKLyoqCiAqIFJlcG9zaXRvcnkgb2YgYW5kIGZhY3Rv\ncnkgZm9yIHBlcnNpc3RlbnQgbWV0YWRhdGEuCiAqCiAqIEBzaW5jZSAwLjMu\nMAogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbSAo\ncXVlcnkgbWV0YWRhdGEpCiAqLwpwdWJsaWMgY2xhc3MgTWV0YURhdGFSZXBv\nc2l0b3J5CiAgICBpbXBsZW1lbnRzIFBDUmVnaXN0cnkuUmVnaXN0ZXJDbGFz\nc0xpc3RlbmVyLCBDb25maWd1cmFibGUsIENsb3NlYWJsZSwgCiAgICBNZXRh\nRGF0YU1vZGVzIHsKCiAgICAvKioKICAgICAqIENvbnN0YW50IHRvIG5vdCB2\nYWxpZGF0ZSBhbnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IFZBTElEQVRFX05PTkUgPSAwOwoKICAgIC8qKgogICAg\nICogQml0IGZsYWcgdG8gdmFsaWRhdGUgbWV0YWRhdGEuCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElEQVRFX01FVEEgPSAxOwoK\nICAgIC8qKgogICAgICogQml0IGZsYWcgdG8gdmFsaWRhdGUgbWFwcGluZ3Mu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZBTElEQVRF\nX01BUFBJTkcgPSAyOwoKICAgIC8qKgogICAgICogQml0IGZsYWcgdG8gdmFs\naWRhdGUgdW5lbmhhbmNlZCBtZXRhZGF0YSBvbmx5LgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9VTkVOSEFOQ0VEID0g\nNDsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIGZvciBydW50aW1lIHZhbGlk\nYXRpb24uIFJlcXVpcmVzIHRoYXQgYWxsIGNsYXNzZXMgYXJlCiAgICAgKiBl\nbmhhbmNlZCwgYW5kIHBlcmZvcm1zIGV4dHJhIGZpZWxkIHJlc29sdXRpb24g\nc3RlcHMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFZB\nTElEQVRFX1JVTlRJTUUgPSA4OwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgQ2xhc3NbXSBFTVBUWV9DTEFTU0VTID0gbmV3IENsYXNzWzBdOwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBOb25QZXJzaXN0ZW50TWV0YURhdGFb\nXSBFTVBUWV9OT05fUEVSU0lTVEVOVCA9IAogICAgCW5ldyBOb25QZXJzaXN0\nZW50TWV0YURhdGFbMF07CiAgICBwcm90ZWN0ZWQgZmluYWwgQ2xhc3NNZXRh\nRGF0YVtdIEVNUFRZX01FVEFTOwogICAgcHJvdGVjdGVkIGZpbmFsIEZpZWxk\nTWV0YURhdGFbXSBFTVBUWV9GSUVMRFM7CiAgICBwcm90ZWN0ZWQgZmluYWwg\nT3JkZXJbXSBFTVBUWV9PUkRFUlM7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAg\nICAgIChNZXRhRGF0YVJlcG9zaXRvcnkuY2xhc3MpOwoKICAgIC8vIHN5c3Rl\nbSBzZXF1ZW5jZQogICAgcHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIF9zeXNT\nZXEgPSBudWxsOwoKICAgIC8vIGNhY2hlIG9mIHBhcnNlZCBtZXRhZGF0YSwg\nb2lkIGNsYXNzIHRvIGNsYXNzLCBhbmQgaW50ZXJmYWNlIGNsYXNzCiAgICAv\nLyB0byBtZXRhZGF0YXMKICAgIHByaXZhdGUgZmluYWwgTWFwIF9tZXRhcyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfb2lkcyA9\nIENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsK\nICAgIHByaXZhdGUgZmluYWwgTWFwIF9pbXBscyA9IENvbGxlY3Rpb25zLnN5\nbmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKICAgIHByaXZhdGUgZmlu\nYWwgTWFwIF9pZmFjZXMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAo\nbmV3IEhhc2hNYXAoKSk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfcXVlcmll\ncyA9IG5ldyBIYXNoTWFwKCk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfc2Vx\ncyA9IG5ldyBIYXNoTWFwKCk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfYWxp\nYXNlcyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1h\ncCgpKTsKICAgIHByaXZhdGUgZmluYWwgTWFwIF9wYXdhcmVzID0gQ29sbGVj\ndGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBIYXNoTWFwKCkpOwogICAgcHJp\ndmF0ZSBmaW5hbCBNYXAgX25vbk1hcHBlZCA9IENvbGxlY3Rpb25zLnN5bmNo\ncm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKICAgIAogICAgLy8gbWFwIG9m\nIGNsYXNzZXMgdG8gbGlzdHMgb2YgdGhlaXIgc3ViY2xhc3NlcwogICAgcHJp\ndmF0ZSBmaW5hbCBNYXAgX3N1YnMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6\nZWRNYXAobmV3IEhhc2hNYXAoKSk7CgogICAgcHJpdmF0ZSBPcGVuSlBBQ29u\nZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CiAgICBwcml2YXRlIExvZyBfbG9n\nID0gbnVsbDsKICAgIHByaXZhdGUgTWV0YURhdGFGYWN0b3J5IF9mYWN0b3J5\nID0gbnVsbDsKICAgIHByaXZhdGUgSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBf\naW1wbEdlbiA9IG51bGw7CiAgICBwcml2YXRlIGludCBfcmVzTW9kZSA9IE1P\nREVfTUVUQSB8IE1PREVfTUFQUElORzsKICAgIHByaXZhdGUgaW50IF9zb3Vy\nY2VNb2RlID0gTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9ERV9RVUVS\nWTsKICAgIHByaXZhdGUgaW50IF92YWxpZGF0ZSA9IFZBTElEQVRFX01FVEEg\nfCBWQUxJREFURV9VTkVOSEFOQ0VEOwoKICAgIC8vIHdlIGJ1ZmZlciB1cCBh\nbnkgY2xhc3NlcyB0aGF0IHJlZ2lzdGVyIHRoZW1zZWx2ZXMgdG8gcHJldmVu\ndAogICAgLy8gcmVlbnRyYW5jeSBlcnJvcnMgaWYgY2xhc3NlcyByZWdpc3Rl\nciBkdXJpbmcgYSBjdXJyZW50IHBhcnNlIChjb21tb24pCiAgICBwcml2YXRl\nIGZpbmFsIENvbGxlY3Rpb24gX3JlZ2lzdGVyZWQgPSBuZXcgQXJyYXlMaXN0\nKCk7CgogICAgLy8gc2V0IG9mIG1ldGFkYXRhcyB3ZSdyZSBpbiB0aGUgcHJv\nY2VzcyBvZiByZXNvbHZpbmcKICAgIHByaXZhdGUgZmluYWwgU29ydGVkU2V0\nIF9yZXNvbHZpbmcgPSBuZXcgVHJlZVNldAogICAgICAgIChuZXcgTWV0YURh\ndGFJbmhlcml0YW5jZUNvbXBhcmF0b3IoKSk7CiAgICBwcml2YXRlIGZpbmFs\nIFNvcnRlZFNldCBfbWFwcGluZyA9IG5ldyBUcmVlU2V0CiAgICAgICAgKG5l\ndyBNZXRhRGF0YUluaGVyaXRhbmNlQ29tcGFyYXRvcigpKTsKICAgIHByaXZh\ndGUgZmluYWwgTGlzdCBfZXJycyA9IG5ldyBMaW5rZWRMaXN0KCk7CgogICAg\nLy8gc3lzdGVtIGxpc3RlbmVycwogICAgcHJpdmF0ZSBMaWZlY3ljbGVFdmVu\ndE1hbmFnZXIuTGlzdGVuZXJMaXN0IF9saXN0ZW5lcnMgPQogICAgICAgIG5l\ndyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KDMpOwoKICAg\nIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gIENvbmZpZ3VyZSB2\naWEge0BsaW5rIENvbmZpZ3VyYWJsZX0uCiAgICAgKi8KICAgIHB1YmxpYyBN\nZXRhRGF0YVJlcG9zaXRvcnkoKSB7CiAgICAgICAgRU1QVFlfTUVUQVMgPSBu\nZXdDbGFzc01ldGFEYXRhQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfRklFTERT\nID0gbmV3RmllbGRNZXRhRGF0YUFycmF5KDApOwogICAgICAgIEVNUFRZX09S\nREVSUyA9IG5ld09yZGVyQXJyYXkoMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSByZXBvc2l0b3J5\nLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGxvZy4KICAg\nICAqLwogICAgcHVibGljIExvZyBnZXRMb2coKSB7CiAgICAgICAgcmV0dXJu\nIF9sb2c7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgSS9PIHVzZWQgdG8g\nbG9hZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhRmFj\ndG9yeSBnZXRNZXRhRGF0YUZhY3RvcnkoKSB7CiAgICAgICAgcmV0dXJuIF9m\nYWN0b3J5OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIEkvTyB1c2VkIHRv\nIGxvYWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1l\ndGFEYXRhRmFjdG9yeShNZXRhRGF0YUZhY3RvcnkgZmFjdG9yeSkgewogICAg\nICAgIGZhY3Rvcnkuc2V0UmVwb3NpdG9yeSh0aGlzKTsKICAgICAgICBfZmFj\ndG9yeSA9IGZhY3Rvcnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0\nYWRhdGEgdmFsaWRhdGlvbiBsZXZlbC4gRGVmYXVsdHMgdG8KICAgICAqIDxj\nb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFOQ0VEPC9jb2Rl\nPi4KICAgICAqLwogICAgcHVibGljIGludCBnZXRWYWxpZGF0ZSgpIHsKICAg\nICAgICByZXR1cm4gX3ZhbGlkYXRlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1bHRzIHRvCiAg\nICAgKiA8Y29kZT5WQUxJREFURV9NRVRBIHwgVkFMSURBVEVfVU5FTkhBTkNF\nRDwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFZhbGlkYXRl\nKGludCB2YWxpZGF0ZSkgewogICAgICAgIF92YWxpZGF0ZSA9IHZhbGlkYXRl\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRp\nb24gbGV2ZWwuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5WQUxJREFURV9N\nRVRBIHwgVkFMSURBVEVfTUFQUElORyB8IFZBTElEQVRFX1VORU5IQU5DRUQ8\nL2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRWYWxpZGF0ZShp\nbnQgdmFsaWRhdGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAodmFsaWRh\ndGUgPT0gVkFMSURBVEVfTk9ORSkKICAgICAgICAgICAgX3ZhbGlkYXRlID0g\ndmFsaWRhdGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIF92\nYWxpZGF0ZSB8PSB2YWxpZGF0ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF92YWxpZGF0ZSAmPSB+dmFsaWRhdGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgbWV0YWRhdGEgcmVzb2x1dGlvbiBtb2RlLiBEZWZhdWx0cyB0bwog\nICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HPC9jb2RlPi4K\nICAgICAqLwogICAgcHVibGljIGludCBnZXRSZXNvbHZlKCkgewogICAgICAg\nIHJldHVybiBfcmVzTW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBt\nZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERlZmF1bHRzIHRvCiAgICAgKiA8\nY29kZT5NT0RFX01FVEEgfCBNT0RFX01BUFBJTkc8L2NvZGU+LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2RlKSB7CiAgICAg\nICAgX3Jlc01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIG1ldGFkYXRhIHJlc29sdXRpb24gbW9kZS4gRGVmYXVsdHMgdG8KICAgICAq\nIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1vZGUsIGJvb2xl\nYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05PTkUpCiAgICAg\nICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgICAgICBlbHNlIGlmIChvbikK\nICAgICAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF9yZXNNb2RlICY9IH5tb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRh\ndGEgdG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVU\nQSB8IE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICov\nCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAgICAgICAgcmV0\ndXJuIF9zb3VyY2VNb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNv\ndXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEgdG8gbG9hZC4g\nRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQ\nUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAgICAgX3NvdXJj\nZU1vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJj\nZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEgdG8gbG9hZC4gRGVm\nYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElO\nRyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAg\nICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAgICBfc291cmNl\nTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAg\nIF9zb3VyY2VNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfc291cmNlTW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcy4KICAg\nICAqCiAgICAgKiBAcGFyYW0gY2xzIHRoZSBjbGFzcyB0byByZXRyaWV2ZSBt\nZXRhZGF0YSBmb3IKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIgdGhlIGVudmly\nb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkKICAgICAqIEBwYXJhbSBt\ndXN0RXhpc3QgaWYgdHJ1ZSwgdGhyb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhj\nZXB0aW9ufQogICAgICogaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQKICAgICAq\nLwogICAgcHVibGljIHN5bmNocm9uaXplZCBDbGFzc01ldGFEYXRhIGdldE1l\ndGFEYXRhKENsYXNzIGNscywKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2Fk\nZXIsIGJvb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVudkxvYWRlcik7\nCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpIHsKICAg\nICAgICAgICAgaWYgKGNscyAhPSBudWxsICYmICFQZXJzaXN0ZW5jZUNhcGFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1t\nZXRhLW5vdHBjIiwgY2xzKSkuCiAgICAgICAgICAgICAgICAgICAgc2V0RmF0\nYWwoZmFsc2UpOwoKICAgICAgICAgICAgU2V0IHBjTmFtZXMgPSBnZXRQZXJz\naXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBlbnZMb2FkZXIpOwogICAgICAgICAg\nICBpZiAocGNOYW1lcyAhPSBudWxsICYmIHBjTmFtZXMuc2l6ZSgpID4gMCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tbWV0YS10eXBlcyIsCiAgICAgICAgICAgICAgICAgICAg\nY2xzLCBwY05hbWVzKSk7CgogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEiLCBjbHMpKTsKICAgICAg\nICB9CiAgICAgICAgcmVzb2x2ZShtZXRhKTsKICAgICAgICByZXR1cm4gbWV0\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEg\nZm9yIHRoZSBnaXZlbiBhbGlhcyBuYW1lLgogICAgICoKICAgICAqIEBwYXJh\nbSBhbGlhcyB0aGUgYWxpYXMgdG8gY2xhc3MgdG8gcmV0cmlldmUgbWV0YWRh\ndGEgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRoZSBlbnZpcm9ubWVu\ndGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVzdEV4\naXN0IGlmIHRydWUsIHRocm93cyBhIHtAbGluayBNZXRhRGF0YUV4Y2VwdGlv\nbn0KICAgICAqIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKiBAc2Vl\nIENsYXNzTWV0YURhdGEjZ2V0VHlwZUFsaWFzCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKFN0cmluZyBhbGlhcywgQ2xh\nc3NMb2FkZXIgZW52TG9hZGVyLAogICAgICAgIGJvb2xlYW4gbXVzdEV4aXN0\nKSB7CiAgICAgICAgaWYgKGFsaWFzID09IG51bGwgJiYgbXVzdEV4aXN0KQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLWFsaWFzLW1ldGEiLCBhbGlhcywKICAgICAgICAgICAgICAgIF9h\nbGlhc2VzKSk7CiAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAg\nICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3NlcygpOwogICAgICAgIExpc3Qg\nY2xhc3NMaXN0ID0gKExpc3QpIF9hbGlhc2VzLmdldChhbGlhcyk7CgogICAg\nICAgIC8vIG11bHRpcGxlIGNsYXNzZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVk\nIHdpdGggdGhlIHNhbWUgYWxpYXM6IHdlCiAgICAgICAgLy8gd2lsbCBmaWx0\nZXIgYnkgY2hlY2tpbmcgYWdhaW5zdCB0aGUgY3VycmVudCBsaXN0IG9mIHRo\nZQogICAgICAgIC8vIHBlcnNpc3RlbnQgdHlwZXMgYW5kIGZpbHRlZCBiYXNl\nZCBvbiB3aGljaCBjbGFzc2VzIGFyZSBsb2FkYWJsZQogICAgICAgIC8vIHZp\nYSB0aGUgY3VycmVudCBlbnZpcm9ubWVudCdzIENsYXNzTG9hZGVyCiAgICAg\nICAgU2V0IHBjTmFtZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNl\nLCBlbnZMb2FkZXIpOwogICAgICAgIENsYXNzIGNscyA9IG51bGw7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGNsYXNzTGlzdCAhPSBudWxsICYmIGkgPCBj\nbGFzc0xpc3Quc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgQ2xhc3MgYyA9\nIChDbGFzcykgY2xhc3NMaXN0LmdldChpKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIC8vIHJlLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBj\ndXJyZW50IGVudmlyb25tZW50IGxvYWRlciBzbwogICAgICAgICAgICAgICAg\nLy8gdGhhdCB3ZSBjYW4gaGFuZGxlIHJlZGVwbG95bWVudCBvZiB0aGUgc2Ft\nZSBjbGFzcyBuYW1lCiAgICAgICAgICAgICAgICBDbGFzcyBuYyA9IENsYXNz\nLmZvck5hbWUoYy5nZXROYW1lKCksIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAg\nICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBv\nZiBwZXJzaXN0ZW50IGNsYXNlcywKICAgICAgICAgICAgICAgIC8vIGFsc28g\nY2hlY2sgdG8gZW5zdXJlIHRoYXQgdGhlIGNsYXNzIGlzIGluIHRoYXQgbGlz\ndAogICAgICAgICAgICAgICAgaWYgKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05h\nbWVzLnNpemUoKSA9PSAwIHx8CiAgICAgICAgICAgICAgICAgICAgcGNOYW1l\ncy5jb250YWlucyhuYy5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAg\nICAgY2xzID0gbmM7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjbGFzc0xp\nc3QuY29udGFpbnMoY2xzKSkKICAgICAgICAgICAgICAgICAgICAgICAgY2xh\nc3NMaXN0LmFkZChjbHMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2Fi\nbGUgdCkgewogICAgICAgICAgICAgICAgLy8gdGhpcyBoYXBwZW5zIHdoZW4g\ndGhlIGNsYXNzIGlzIG5vdCBsb2FkYWJsZSBieQogICAgICAgICAgICAgICAg\nLy8gdGhlIGVudmlyb25tZW50IGNsYXNzIGxvYWRlciwgc28gaXQgd2FzIHBy\nb2JhYmx5CiAgICAgICAgICAgICAgICAvLyBsaXN0ZWQgZWxzZXdoZXJlOyBh\nbHNvIGlnbm9yZSBsaW5rYWdlIGZhaWx1cmVzIGFuZAogICAgICAgICAgICAg\nICAgLy8gb3RoZXIgY2xhc3MgbG9hZGluZyBwcm9ibGVtcwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGlmIChjbHMgIT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0\nRXhpc3QpOwoKICAgICAgICAvLyBtYXliZSB0aGlzIGlzIHNvbWUgdHlwZSB3\nZSd2ZSBzZWVuIGJ1dCBqdXN0IGlzbid0IHZhbGlkCiAgICAgICAgaWYgKF9h\nbGlhc2VzLmNvbnRhaW5zS2V5KGFsaWFzKSkgewogICAgICAgICAgICBpZiAo\nbXVzdEV4aXN0KQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hbGlhcy1tZXRhIiwgYWxpYXMsCiAg\nICAgICAgICAgICAgICAgICAgX2FsaWFzZXMpKTsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyByZWNvcmQgdGhhdCB0\naGlzIGlzIGFuIGludmFsaWQgdHlwZQogICAgICAgIF9hbGlhc2VzLnB1dChh\nbGlhcywgbnVsbCk7CgogICAgICAgIGlmICghbXVzdEV4aXN0KQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWFsaWFzLW1ldGEiLCBhbGlhcywgX2Fs\naWFzZXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIG1ldGhv\nZCB0byBnZXQgdGhlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIHdp\ndGhvdXQKICAgICAqIHJlc29sdmluZyBpdC4KICAgICAqLwogICAgcHJpdmF0\nZSBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhSW50ZXJuYWwoQ2xhc3MgY2xz\nLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlm\nIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIC8vIGNoZWNrIGNhY2hlIGZvciBleGlzdGluZyBtZXRhZGF0YSwgb3Ig\nZ2l2ZSB1cCBpZiBubyBtZXRhZGF0YSBhbmQKICAgICAgICAvLyBvdXIgbGlz\ndCBvZiBjb25maWd1cmVkIHBlcnNpc3RlbnQgdHlwZXMgZG9lc24ndCBpbmNs\ndWRlIHRoZSBjbGFzcwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IChD\nbGFzc01ldGFEYXRhKSBfbWV0YXMuZ2V0KGNscyk7CiAgICAgICAgaWYgKG1l\ndGEgIT0gbnVsbCAmJiAoKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9N\nRVRBKSAhPSAwCiAgICAgICAgICAgIHx8IChfc291cmNlTW9kZSAmIE1PREVf\nTUVUQSkgPT0gMCkpCiAgICAgICAgICAgIHJldHVybiBtZXRhOwoKICAgICAg\nICAvLyBpZiBydW50aW1lLCBjdXQgb2ZmIHNlYXJjaCBpZiBub3QgaW4gcGMg\nbGlzdC4gIHdlIGRvbid0IGRvIHRoaXMgYXQKICAgICAgICAvLyBkZXYgdGlt\nZSBzbyB0aGF0IHVzZXIgY2FuIG1hbmlwdWxhdGUgcGVyc2lzdGVudCBjbGFz\nc2VzIGhlJ3Mgd3JpdGluZwogICAgICAgIC8vIGJlZm9yZSBhZGRpbmcgdGhl\nbSB0byB0aGUgbGlzdAogICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFMSURB\nVEVfUlVOVElNRSkgIT0gMCkgewogICAgICAgICAgICBTZXQgcGNOYW1lcyA9\nIF9mYWN0b3J5LmdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxv\nYWRlcik7CiAgICAgICAgICAgIGlmIChwY05hbWVzICE9IG51bGwgJiYgIXBj\nTmFtZXMuY29udGFpbnMoY2xzLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbWV0YTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhID09\nIG51bGwpIHsKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIG1heWJl\nIHdlIGtub3cgdGhpcyBjbGFzcyBoYXMgbm8gbWV0YWRhdGEKICAgICAgICAg\nICAgaWYgKF9tZXRhcy5jb250YWluc0tleShjbHMpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhp\ncyBpc24ndCBhbiBvYnZpb3VzbHkgYmFkIGNsYXNzCiAgICAgICAgICAgIGlm\nIChjbHMuaXNQcmltaXRpdmUoKSB8fCBjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dp\ndGgoImphdmEuIikKICAgICAgICAgICAgICAgIHx8IGNscyA9PSBQZXJzaXN0\nZW5jZUNhcGFibGUuY2xhc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgICAgIC8vIGRlc2lnbmVkIHRvIGdldCBhcm91bmQgamlr\nZXMgMS4xNyAvIEpESzEuNSBpc3N1ZSB3aGVyZSBzdGF0aWMKICAgICAgICAg\nICAgLy8gaW5pdGlhbGl6ZXJzIGFyZSBub3QgaW52b2tlZCB3aGVuIGEgY2xh\nc3MgaXMgcmVmZXJlbmNlZCwgc28gdGhlCiAgICAgICAgICAgIC8vIGNsYXNz\nIG5ldmVyIHJlZ2lzdGVycyBpdHNlbGYgd2l0aCB0aGUgc3lzdGVtCiAgICAg\nICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0g\nMCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBDbGFzcy5mb3JOYW1lKGNscy5nZXROYW1lKCksIHRydWUsIGNscy5nZXRD\nbGFzc0xvYWRlcigpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIG5vdCBpbiBjYWNoZTogbG9hZCBtZXRhZGF0\nYSBvciBtYXBwaW5ncyBkZXBlbmRpbmcgb24gc291cmNlIG1vZGUuCiAgICAg\nICAgLy8gbG9hZGluZyBtZXRhZGF0YSBtaWdodCBhbHNvIGxvYWQgbWFwcGlu\nZ3MsIGJ1dCBkb2Vzbid0IGhhdmUgdG8KICAgICAgICBpbnQgbW9kZSA9IDA7\nCiAgICAgICAgaWYgKChfc291cmNlTW9kZSAmIE1PREVfTUVUQSkgIT0gMCkK\nICAgICAgICAgICAgbW9kZSA9IF9zb3VyY2VNb2RlICYgfk1PREVfTUFQUElO\nRzsKICAgICAgICBlbHNlIGlmICgoX3NvdXJjZU1vZGUgJiBNT0RFX01BUFBJ\nTkcpID09IDApCiAgICAgICAgICAgIG1vZGUgPSBfc291cmNlTW9kZTsKICAg\nICAgICBpZiAobW9kZSAhPSBNT0RFX05PTkUpIHsKICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoImxvYWQtY2xzIiwgY2xzLCB0b01vZGVTdHJpbmco\nbW9kZSkpKTsKICAgICAgICAgICAgX2ZhY3RvcnkubG9hZChjbHMsIG1vZGUs\nIGVudkxvYWRlcik7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBjYWNo\nZSBhZ2FpbgogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAg\nIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdldChjbHMpOwogICAg\nICAgIGlmIChtZXRhICE9IG51bGwgJiYgKChtZXRhLmdldFNvdXJjZU1vZGUo\nKSAmIE1PREVfTUVUQSkgIT0gMAogICAgICAgICAgICB8fCAoX3NvdXJjZU1v\nZGUgJiBNT0RFX01FVEEpID09IDApKQogICAgICAgICAgICByZXR1cm4gbWV0\nYTsKCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBjbGFzcyBoYXMgbm8g\nbWV0YWRhdGE7IGNoZWNraW5nIGZvciB0aGlzIGxhdGVyCiAgICAgICAgLy8g\nc3BlZWRzIHRoaW5ncyB1cCBpbiBlbnZpcm9ubWVudHMgd2l0aCBzbG93IGNs\nYXNzIGxvYWRpbmcKICAgICAgICAvLyBsaWtlIGFwcHNlcnZlcnMKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICByZW1vdmVNZXRhRGF0\nYShtZXRhKTsKICAgICAgICBfbWV0YXMucHV0KGNscywgbnVsbCk7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIG1vZGUgZmxh\nZ3MuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIFN0cmluZyB0b01vZGVT\ndHJpbmcoaW50IG1vZGUpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcigzMSk7CiAgICAgICAgaWYgKChtb2RlICYgTU9E\nRV9NRVRBKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCJbTUVUQV0i\nKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX1FVRVJZKSAhPSAwKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCJbUVVFUlldIik7CiAgICAgICAgaWYgKCht\nb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAgICBidWYuYXBw\nZW5kKCJbTUFQUElOR10iKTsKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01B\nUFBJTkdfSU5JVCkgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiW01B\nUFBJTkdfSU5JVF0iKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlIG1ldGFkYXRhIGZvciBt\nYXBwaW5nIHJlc29sdXRpb24uIFRoaXMgbWV0aG9kIG1pZ2h0IG1hcCBwYXJ0\ncwogICAgICogb2YgdGhlIG1ldGFkYXRhIHRoYXQgZG9uJ3QgcmVseSBvbiBv\ndGhlciBjbGFzc2VzIGJlaW5nIG1hcHBlZCwgYnV0IHRoYXQKICAgICAqIG90\naGVyIGNsYXNzZXMgbWlnaHQgcmVseSBvbiBkdXJpbmcgdGhlaXIgb3duIG1h\ncHBpbmcgKGZvciBleGFtcGxlLAogICAgICogcHJpbWFyeSBrZXkgZmllbGRz\nKS4gQnkgZGVmYXVsdCwgdGhpcyBtZXRob2Qgb25seSBjYWxscwogICAgICog\ne0BsaW5rIENsYXNzTWV0YURhdGEjZGVmaW5lU3VwZXJjbGFzc0ZpZWxkc30u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHByZXBhcmVNYXBwaW5nKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIG1ldGEuZGVmaW5lU3VwZXJj\nbGFzc0ZpZWxkcyhmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNv\nbHZlIHRoZSBnaXZlbiBtZXRhZGF0YSBpZiBuZWVkZWQuIFRoZXJlIGFyZSB0\naHJlZSBnb2FsczoKICAgICAqIDxvbD4KICAgICAqIDxsaT5NYWtlIHN1cmUg\nbm8gdW5yZXNvbHZlZCBtZXRhZGF0YSBnZXRzIGJhY2sgdG8gdGhlIGNsaWVu\ndC48L2xpPgogICAgICogPGxpPkF2b2lkIGluZmluaXRlIHJlZW50cmFudCBj\nYWxscyBmb3IgbXV0dWFsbHktZGVwZW5kZW50IG1ldGFkYXRhcyBieQogICAg\nICogYWxsb3dpbmcgdW5yZXNvbHZlZCBtZXRhZGF0YSB0byBiZSByZXR1cm5l\nZCB0byBvdGhlciBtZXRhZGF0YXMuPC9saT4KICAgICAqIDxsaT5BbHdheXMg\nbWFrZSBzdXJlIHRoZSBzdXBlcmNsYXNzIG1ldGFkYXRhIGlzIHJlc29sdmVk\nIGJlZm9yZSB0aGUKICAgICAqIHN1YmNsYXNzIG1ldGFkYXRhIHNvIHRoYXQg\ndGhlIHN1YmNsYXNzIGNhbiBhY2Nlc3MgdGhlIHN1cGVyJ3MgbGlzdAogICAg\nICogb2YgZmllbGRzLjwvbGk+CiAgICAgKiA8L29sPiBOb3RlIHRoYXQgdGhl\nIGNvZGUgY2FsbGluZyB0aGlzIG1ldGhvZCBpcyBzeW5jaHJvbml6ZWQsIHNv\nIHRoaXMKICAgICAqIG1ldGhvZCBkb2Vzbid0IGhhdmUgdG8gYmUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCByZXNvbHZlKENsYXNzTWV0YURhdGEgbWV0\nYSkgewogICAgICAgIC8vIHJldHVybiBhbnl0aGluZyB0aGF0IGhhcyBpdHMg\nbWV0YWRhdGEgcmVzb2x2ZWQsIGJlY2F1c2UgdGhhdCBtZWFucwogICAgICAg\nIC8vIGl0IGlzIGVpdGhlciBmdWxseSByZXNvbHZlZCBvciBtdXN0IGF0IGxl\nYXN0IGJlIGluIHRoZSBwcm9jZXNzIG9mCiAgICAgICAgLy8gcmVzb2x2aW5n\nIG1hcHBpbmcsIGV0YyBzaW5jZSB3ZSBkbyB0aGF0IHJpZ2h0IGFmdGVyIG1l\ndGEgcmVzb2x2ZQogICAgICAgIGlmIChtZXRhID09IG51bGwgfHwgX3Jlc01v\nZGUgPT0gTU9ERV9OT05FCiAgICAgICAgICAgIHx8IChtZXRhLmdldFJlc29s\ndmUoKSAmIE1PREVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAvLyByZXNvbHZlIG1ldGFkYXRhCiAgICAgICAgTGlzdCByZXNv\nbHZlZCA9IHJlc29sdmVNZXRhKG1ldGEpOwogICAgICAgIGlmIChyZXNvbHZl\nZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGxv\nYWQgbWFwcGluZyBkYXRhCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBy\nZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAgICAgbG9hZE1hcHBpbmco\nKENsYXNzTWV0YURhdGEpIHJlc29sdmVkLmdldChpKSk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAg\nICAgICAgcHJlTWFwcGluZygoQ2xhc3NNZXRhRGF0YSkgcmVzb2x2ZWQuZ2V0\nKGkpKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBtYXBwaW5ncwogICAgICAgIGJv\nb2xlYW4gZXJyID0gdHJ1ZTsKICAgICAgICBpZiAoKF9yZXNNb2RlICYgTU9E\nRV9NQVBQSU5HKSAhPSAwKQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHJlc29sdmVkLnNpemUoKTsgaSsrKQogICAgICAgICAgICAgICAgZXJy\nICY9IHJlc29sdmVNYXBwaW5nKChDbGFzc01ldGFEYXRhKSByZXNvbHZlZC5n\nZXQoaSkpOwoKICAgICAgICAvLyB0aHJvdyBlcnJvcnMgZW5jb3VudGVyZWQK\nICAgICAgICBpZiAoZXJyICYmICFfZXJycy5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgUnVudGltZUV4Y2VwdGlvbiByZTsKICAgICAgICAgICAgaWYgKF9l\ncnJzLnNpemUoKSA9PSAxKQogICAgICAgICAgICAgICAgcmUgPSAoUnVudGlt\nZUV4Y2VwdGlvbikgX2VycnMuZ2V0KDApOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICByZSA9IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgicmVzb2x2ZS1lcnJzIikpLgogICAgICAgICAgICAgICAgICAgIHNl\ndE5lc3RlZFRocm93YWJsZXMoKFRocm93YWJsZVtdKSBfZXJycy50b0FycmF5\nCiAgICAgICAgICAgICAgICAgICAgICAgIChuZXcgRXhjZXB0aW9uW19lcnJz\nLnNpemUoKV0pKTsKICAgICAgICAgICAgX2VycnMuY2xlYXIoKTsKICAgICAg\nICAgICAgdGhyb3cgcmU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVzb2x2ZSBtZXRhZGF0YSBtb2RlLCByZXR1cm5pbmcgbGlzdCBvZiBw\ncm9jZXNzZWQgbWV0YWRhZGF0YXMsIG9yIG51bGwKICAgICAqIGlmIHdlJ3Jl\nIHN0aWxsIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmluZyBvdGhlciBtZXRh\nZGF0YXMuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdCByZXNvbHZlTWV0YShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXRQQ1N1\ncGVyY2xhc3MoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHNldCBzdXBl\ncmNsYXNzCiAgICAgICAgICAgIENsYXNzIHN1cCA9IG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBzdXBNZXRhOwogICAgICAgICAgICB3aGlsZSAoc3VwICE9IG51\nbGwgJiYgc3VwICE9IE9iamVjdC5jbGFzcykgewogICAgICAgICAgICAgICAg\nc3VwTWV0YSA9IGdldE1ldGFEYXRhKHN1cCwgbWV0YS5nZXRFbnZDbGFzc0xv\nYWRlcigpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoc3VwTWV0YSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRQQ1N1cGVy\nY2xhc3Moc3VwKTsKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKHN1cE1ldGEpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJ\nbnRlcmZhY2UoKSkgewogICAgICAgICAgICAgICAgQ2xhc3NbXSBzdXBzID0g\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0SW50ZXJmYWNlcygpOwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICAgICAgc3VwTWV0YSA9IGdldE1ldGFE\nYXRhKHN1cHNbaV0sIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoc3VwTWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIG1ldGEuc2V0UENTdXBlcmNsYXNzKHN1cCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGEuc2V0UENTdXBlcmNsYXNzTWV0YURhdGEoc3VwTWV0\nYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiYXNzaWduZWQtc3VwIiwg\nbWV0YSwKICAgICAgICAgICAgICAgICAgICBtZXRhLmdldFBDU3VwZXJjbGFz\ncygpKSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXNvbHZlIHJlbGF0aW9u\nIHByaW1hcnkga2V5IGZpZWxkcyBmb3IgbWFwcGluZyBkZXBlbmRlbmNpZXMK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IG1ldGEuZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmbWRzW2ldLmlzUHJpbWFy\neUtleSgpKQogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSwgCiAgICAgICAgICAgICAgICAgICAgbWV0YS5n\nZXRFbnZDbGFzc0xvYWRlcigpLCBmYWxzZSk7CgogICAgICAgIC8vIHJlc29s\ndmUgbWV0YWRhdGE7IGlmIHdlJ3JlIG5vdCBpbiB0aGUgcHJvY2VzcyBvZiBy\nZXNvbHZpbmcKICAgICAgICAvLyBvdGhlcnMsIHRoaXMgd2lsbCByZXR1cm4g\ndGhlIHNldCBvZiBpbnRlcnJlbGF0ZWQgbWV0YXMgdGhhdAogICAgICAgIC8v\nIHJlc29sdmVkCiAgICAgICAgcmV0dXJuIHByb2Nlc3NCdWZmZXIobWV0YSwg\nX3Jlc29sdmluZywgTU9ERV9NRVRBKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIExvYWQgbWFwcGluZyBpbmZvcm1hdGlvbiBmb3IgdGhlIGdpdmVuIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbG9hZE1hcHBpbmcoQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKChtZXRhLmdldFJlc29s\ndmUoKSAmIE1PREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAvLyBsb2FkIG1hcHBpbmcgaW5mb3JtYXRpb24KICAgICAg\nICBpZiAoKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NQVBQSU5HKSA9\nPSAwCiAgICAgICAgICAgICYmIChfc291cmNlTW9kZSAmIE1PREVfTUFQUElO\nRykgIT0gMCkgewogICAgICAgICAgICAvLyBlbWJlZGRlZC1vbmx5IG1ldGFk\nYXRhIGRvZXNuJ3QgaGF2ZSBtYXBwaW5nLCBzbyBhbHdheXMgbG9hZGVkCiAg\nICAgICAgICAgIGlmIChtZXRhLmlzRW1iZWRkZWRPbmx5KCkpCiAgICAgICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5HLCB0cnVl\nKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBsb2Fk\nIG1hcHBpbmcgZGF0YQogICAgICAgICAgICAgICAgaW50IG1vZGUgPSBfc291\ncmNlTW9kZSAmIH5NT0RFX01FVEE7CiAgICAgICAgICAgICAgICBpZiAoX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cu\ndHJhY2UoX2xvYy5nZXQoImxvYWQtbWFwcGluZyIsIG1ldGEsCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRvTW9kZVN0cmluZyhtb2RlKSkpOwogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBfZmFjdG9yeS5s\nb2FkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBtb2RlLAogICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCkpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAg\nICAgICAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcmUtbWFwcGluZyBwcmVwYXJhdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHByZU1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKChtZXRhLmdldFJlc29sdmUoKSAmIE1PREVfTUFQUElORykg\nIT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBwcmVwYXJl\nIG1hcHBpbmdzIGZvciByZXNvbHZlOyBpZiBub3QgcmVzb2x2aW5nIG1hcHBp\nbmdzLCB0aGVuCiAgICAgICAgLy8gbWFrZSBzdXJlIGFueSBzdXBlcmNsYXNz\nIGZpZWxkcyBkZWZpbmVkIGluIG1ldGFkYXRhIGFyZSByZXNvbHZlZAogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoX3Jlc01vZGUgJiBNT0RFX01B\nUFBJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJh\nY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy50cmFjZShf\nbG9jLmdldCgicHJlcC1tYXBwaW5nIiwgbWV0YSkpOwogICAgICAgICAgICAg\nICAgcHJlcGFyZU1hcHBpbmcobWV0YSk7CiAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgbWV0YS5kZWZpbmVTdXBlcmNsYXNzRmllbGRzKGZh\nbHNlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRhKG1ldGEpOwogICAgICAgICAg\nICBfZXJycy5hZGQocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJlc29sdmUgYW5kIGluaXRpYWxpemUgbWFwcGluZy4KICAgICAqCiAg\nICAgKiBAcmV0dXJuIGZhbHNlIGlmIHdlJ3JlIHN0aWxsIGluIHRoZSBwcm9j\nZXNzIG9mIHJlc29sdmluZyBtYXBwaW5ncwogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gcmVzb2x2ZU1hcHBpbmcoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgTGlzdCBtYXBwZWQgPSBwcm9jZXNzQnVmZmVyKG1ldGEsIF9t\nYXBwaW5nLCBNT0RFX01BUFBJTkcpOwogICAgICAgIGlmIChtYXBwZWQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBp\nbml0aWFsaXplIG1hcHBpbmcgZm9yIHJ1bnRpbWUgdXNlCiAgICAgICAgaWYg\nKChfcmVzTW9kZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwKSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGVkLnNpemUoKTsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBtZXRhID0gKENsYXNzTWV0YURhdGEpIG1h\ncHBlZC5nZXQoaSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIG1ldGEucmVzb2x2ZShNT0RFX01BUFBJTkdfSU5JVCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlTWV0YURhdGEobWV0YSk7CiAg\nICAgICAgICAgICAgICAgICAgX2VycnMuYWRkKHJlKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3MgdGhlIGdpdmVu\nIG1ldGFkYXRhIGFuZCB0aGUgYXNzb2NpYXRlZCBidWZmZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgTGlzdCBwcm9jZXNzQnVmZmVyKENsYXNzTWV0YURhdGEg\nbWV0YSwgU29ydGVkU2V0IGJ1ZmZlciwgaW50IG1vZGUpIHsKICAgICAgICAv\nLyBpZiB3ZSdyZSBhbHJlYWR5IHByb2Nlc3NpbmcgYSBtZXRhZGF0YSwganVz\ndCBidWZmZXIgdGhpcyBvbmU7IHdoZW4KICAgICAgICAvLyB0aGUgaW5pdGlh\nbCBtZXRhZGF0YSBmaW5pc2hlcyBwcm9jZXNzaW5nLCB3ZSB0cmF2ZXJzZSB0\naGUgYnVmZmVyCiAgICAgICAgLy8gYW5kIHByb2Nlc3MgYWxsIHRoZSBvdGhl\ncnMgdGhhdCB3ZXJlIGludHJvZHVjZWQgZHVyaW5nIHJlZW50cmFudAogICAg\nICAgIC8vIGNhbGxzCiAgICAgICAgaWYgKCFidWZmZXIuYWRkKG1ldGEpIHx8\nIGJ1ZmZlci5zaXplKCkgIT0gMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIC8vIGNvbnRpbnVhbGx5IHBvcCBhIG1ldGFkYXRhIGFuZCBw\ncm9jZXNzIGl0IHVudGlsIHdlIHJ1biBvdXQ7IG5vdGUKICAgICAgICAvLyB0\naGF0IGVhY2ggcHJvY2Vzc2luZyBjYWxsIG1pZ2h0IHBsYWNlIG1vcmUgbWV0\nYXMgaW4gdGhlIGJ1ZmZlciBhcwogICAgICAgIC8vIG9uZSBjbGFzcyB0cmll\ncyB0byBhY2Nlc3MgbWV0YWRhdGEgZm9yIGFub3RoZXI7IGFsc28gbm90ZSB0\naGF0IHRoZQogICAgICAgIC8vIGJ1ZmZlciBvcmRlcnMgaXRzZWxmIGZyb20g\nbGVhc3QgdG8gbW9zdCBkZXJpdmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBi\ndWZmZXJlZDsKICAgICAgICBMaXN0IHByb2Nlc3NlZCA9IG5ldyBBcnJheUxp\nc3QoNSk7CiAgICAgICAgd2hpbGUgKCFidWZmZXIuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgIGJ1ZmZlcmVkID0gKENsYXNzTWV0YURhdGEpIGJ1ZmZlci5m\naXJzdCgpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYnVm\nZmVyZWQucmVzb2x2ZShtb2RlKTsKICAgICAgICAgICAgICAgIHByb2Nlc3Nl\nZC5hZGQoYnVmZmVyZWQpOwogICAgICAgICAgICAgICAgYnVmZmVyLnJlbW92\nZShidWZmZXJlZCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7Cgog\nICAgICAgICAgICAgICAgLy8gYW55IGV4Y2VwdGlvbiBkdXJpbmcgcmVzb2x1\ndGlvbiBvZiBvbmUgdHlwZSBtZWFucyB3ZSBjYW4ndAogICAgICAgICAgICAg\nICAgLy8gcmVzb2x2ZSBhbnkgb2YgdGhlIHJlbGF0ZWQgdHlwZXMsIHNvIGNs\nZWFyIGJ1ZmZlci4gIHRoaXMgYWxzbwogICAgICAgICAgICAgICAgLy8gZW5z\ndXJlcyB0aGF0IGlmIHR3byB0eXBlcyByZWxhdGUgdG8gZWFjaCBvdGhlciBh\nbmQgb25lCiAgICAgICAgICAgICAgICAvLyBkaWVzLCB3ZSBkb24ndCBnZXQg\naW50byBpbmZpbml0ZSBjeWNsZXMKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gYnVmZmVyLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YSA9IChDbGFzc01ldGFEYXRh\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZU1ldGFE\nYXRhKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXRhICE9IGJ1\nZmZlcmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9lcnJzLmFkZChu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICgicHJldi1lcnJzIiwgbWV0YSwgYnVmZmVyZWQpKSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgYnVmZmVyLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhbGwgdGhlIG1ldGFkYXRhIGluc3RhbmNlcyBj\ndXJyZW50bHkgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgQ2xhc3NNZXRhRGF0YVtdIGdldE1ldGFEYXRhcygp\nIHsKICAgICAgICAvLyBwcmV2ZW50IGNvbmN1cnJlbnQgbW9kIGVycm9ycyB3\naGVuIHJlc29sdmluZyBvbmUgbWV0YWRhdGEKICAgICAgICAvLyBpbnRyb2R1\nY2VzIG90aGVycwogICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcyA9IChD\nbGFzc01ldGFEYXRhW10pIF9tZXRhcy52YWx1ZXMoKS4KICAgICAgICAgICAg\ndG9BcnJheShuZXcgQ2xhc3NNZXRhRGF0YVtfbWV0YXMuc2l6ZSgpXSk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXRhcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgaWYgKG1ldGFzW2ldICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBnZXRNZXRhRGF0YShtZXRhc1tpXS5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgbWV0YXNbaV0uZ2V0RW52Q2xhc3NMb2Fk\nZXIoKSwgdHJ1ZSk7CgogICAgICAgIExpc3QgcmVzb2x2ZWQgPSBuZXcgQXJy\nYXlMaXN0KF9tZXRhcy5zaXplKCkpOwogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9tZXRhcy52YWx1\nZXMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBtZXRhID0gKENsYXNzTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXNvbHZl\nZC5hZGQobWV0YSk7CiAgICAgICAgfQogICAgICAgIG1ldGFzID0gKENsYXNz\nTWV0YURhdGFbXSkgcmVzb2x2ZWQudG9BcnJheQogICAgICAgICAgICAobmV3\nQ2xhc3NNZXRhRGF0YUFycmF5KHJlc29sdmVkLnNpemUoKSkpOwogICAgICAg\nIEFycmF5cy5zb3J0KG1ldGFzKTsKICAgICAgICByZXR1cm4gbWV0YXM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBtZXRhZGF0\nYSBmb3IgdGhlIGdpdmVuIGNsYXNzLCB3aXRob3V0IGFueSByZXNvbHV0aW9u\nLgogICAgICogUmV0dXJuIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIENsYXNzTWV0YURhdGEgZ2V0Q2FjaGVkTWV0YURhdGEoQ2xhc3MgY2xz\nKSB7CiAgICAgICAgcmV0dXJuIChDbGFzc01ldGFEYXRhKSBfbWV0YXMuZ2V0\nKGNscyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIG1ldGFkYXRhLCBwb3B1bGF0ZSBpdCB3aXRoIGRlZmF1bHQgaW5mb3JtYXRp\nb24sIGFkZCBpdCB0bwogICAgICogdGhlIHJlcG9zaXRvcnksIGFuZCByZXR1\ncm4gaXQuIFVzZSB0aGUgZGVmYXVsdCBhY2Nlc3MgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTWV0YURhdGEgYWRkTWV0YURhdGEoQ2xhc3MgY2xz\nKSB7CiAgICAgICAgcmV0dXJuIGFkZE1ldGFEYXRhKGNscywgQ2xhc3NNZXRh\nRGF0YS5BQ0NFU1NfVU5LTk9XTik7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdpdGggZGVmYXVs\ndCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvCiAgICAgKiB0aGUgcmVwb3NpdG9y\neSwgYW5kIHJldHVybiBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0gYWNjZXNz\nIHRoZSBhY2Nlc3MgdHlwZSB0byB1c2UgaW4gcG9wdWxhdGluZyBtZXRhZGF0\nYQogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBhZGRNZXRhRGF0\nYShDbGFzcyBjbHMsIGludCBhY2Nlc3MpIHsKICAgICAgICBpZiAoY2xzID09\nIG51bGwgfHwgY2xzLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBuZXdDbGFz\nc01ldGFEYXRhKGNscyk7CiAgICAgICAgX2ZhY3RvcnkuZ2V0RGVmYXVsdHMo\nKS5wb3B1bGF0ZShtZXRhLCBhY2Nlc3MpOwoKICAgICAgICAvLyBzeW5jaHJv\nbml6ZSBvbiB0aGlzIHJhdGhlciB0aGFuIHRoZSBtYXAsIGJlY2F1c2UgYWxs\nIG90aGVyIG1ldGhvZHMKICAgICAgICAvLyB0aGF0IGFjY2VzcyBfbWV0YXMg\nYXJlIHN5bmNocm9uaXplZCBvbiB0aGlzCiAgICAgICAgc3luY2hyb25pemVk\nICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChfcGF3YXJlcy5jb250YWluc0tl\neShjbHMpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYy1hbmQtYXdhcmUiLCBjbHMpKTsKICAgICAg\nICAgICAgX21ldGFzLnB1dChjbHMsIG1ldGEpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbWV0YTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBuZXcgY2xhc3MgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIG5ld0NsYXNzTWV0YURhdGEoQ2xh\nc3MgdHlwZSkgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YSh0\neXBlLCB0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5l\ndyBhcnJheSBvZiB0aGUgcHJvcGVyIGNsYXNzIG1ldGFkYXRhIHN1YmNsYXNz\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YVtdIG5ld0Ns\nYXNzTWV0YURhdGFBcnJheShpbnQgbGVuZ3RoKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBDbGFzc01ldGFEYXRhW2xlbmd0aF07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgYSBuZXcgZmllbGQgbWV0YWRhdGEgaW5zdGFuY2UuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhIG5ld0ZpZWxkTWV0\nYURhdGEoU3RyaW5nIG5hbWUsIENsYXNzIHR5cGUsCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgRmllbGRNZXRh\nRGF0YShuYW1lLCB0eXBlLCBvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHByb3BlciBmaWVsZCBtZXRh\nZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIEZpZWxkTWV0\nYURhdGFbXSBuZXdGaWVsZE1ldGFEYXRhQXJyYXkoaW50IGxlbmd0aCkgewog\nICAgICAgIHJldHVybiBuZXcgRmllbGRNZXRhRGF0YVtsZW5ndGhdOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGVtYmVkZGVkIGNsYXNz\nIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xh\nc3NNZXRhRGF0YSBuZXdFbWJlZGRlZENsYXNzTWV0YURhdGEoVmFsdWVNZXRh\nRGF0YSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0\nYShvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\ndmFsdWUgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBWYWx1ZU1ldGFEYXRhIG5ld1ZhbHVlTWV0YURhdGEoRmllbGRNZXRhRGF0\nYSBvd25lcikgewogICAgICAgIHJldHVybiBuZXcgVmFsdWVNZXRhRGF0YUlt\ncGwob3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIHtA\nbGluayBPcmRlcn0gZm9yIHRoZSBnaXZlbiBmaWVsZCBhbmQgZGVjbGFyYXRp\nb24uIFRoaXMKICAgICAqIG1ldGhvZCBkZWxlZ2F0ZXMgdG8ge0BsaW5rICNu\nZXdSZWxhdGVkRmllbGRPcmRlcn0gYW5kCiAgICAgKiB7QGxpbmsgI25ld1Zh\nbHVlRmllbGRPcmRlcn0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVj\ndGVkIE9yZGVyIG5ld09yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIFN0cmlu\nZyBuYW1lLCBib29sZWFuIGFzYykgewogICAgICAgIC8vIHBhdGhzIGNhbiBz\ndGFydCB3aXRoIChvciBlcXVhbCkgJyNlbGVtZW50JwogICAgICAgIGlmIChu\nYW1lLnN0YXJ0c1dpdGgoT3JkZXIuRUxFTUVOVCkpCiAgICAgICAgICAgIG5h\nbWUgPSBuYW1lLnN1YnN0cmluZyhPcmRlci5FTEVNRU5ULmxlbmd0aCgpKTsK\nICAgICAgICBpZiAobmFtZS5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICBy\nZXR1cm4gbmV3VmFsdWVPcmRlcihvd25lciwgYXNjKTsKCiAgICAgICAgLy8g\nbmV4dCB0b2tlbiBzaG91bGQgYmUgJy4nCiAgICAgICAgaWYgKG5hbWUuY2hh\nckF0KDApID09ICcuJykKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3Ry\naW5nKDEpOwoKICAgICAgICAvLyByZWxhdGVkIGZpZWxkCiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gb3duZXIuZ2V0RWxlbWVudCgpLmdldFR5cGVN\nZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm9u\ncGMtZmllbGQtb3JkZXJhYmxlIiwKICAgICAgICAgICAgICAgIG93bmVyLCBu\nYW1lKSk7CiAgICAgICAgRmllbGRNZXRhRGF0YSByZWwgPSBtZXRhLmdldEZp\nZWxkKG5hbWUpOwogICAgICAgIGlmIChyZWwgPT0gbnVsbCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQt\nZmllbGQtb3JkZXJhYmxlIiwKICAgICAgICAgICAgICAgIG93bmVyLCBuYW1l\nKSk7CiAgICAgICAgcmV0dXJuIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKG93bmVy\nLCByZWwsIGFzYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBieSB0\naGUgZmllbGQgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPcmRlciBu\nZXdWYWx1ZU9yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsIGJvb2xlYW4gYXNj\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbk1lbW9yeVZhbHVlT3JkZXIoYXNj\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9yZGVyIGJ5IGEgZmllbGQgb2Yg\ndGhlIHJlbGF0ZWQgdHlwZS4KICAgICAqLwogICAgcHJvdGVjdGVkIE9yZGVy\nIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKEZpZWxkTWV0YURhdGEgb3duZXIsCiAg\nICAgICAgRmllbGRNZXRhRGF0YSByZWwsIGJvb2xlYW4gYXNjKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBJbk1lbW9yeVJlbGF0ZWRGaWVsZE9yZGVyKHJlbCwg\nYXNjKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiBhcnJheSBv\nZiBvcmRlcnMgb2YgdGhlIGdpdmVuIHNpemUuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBPcmRlcltdIG5ld09yZGVyQXJyYXkoaW50IHNpemUpIHsKICAgICAg\nICByZXR1cm4gbmV3IE9yZGVyW3NpemVdOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIGEgbWV0YWRhdGEgaW5zdGFuY2UgZnJvbSB0aGUgcmVwb3Np\ndG9yeS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwg\nZmFsc2UgaWYgbm90IGluIHRoaXMgcmVwb3NpdG9yeQogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiByZW1vdmVNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1l\ndGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHJlbW92ZU1ldGFEYXRhKG1l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSBhIG1ldGFkYXRhIGluc3RhbmNlIGZyb20gdGhlIHJlcG9zaXRv\ncnkuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQsIGZh\nbHNlIGlmIG5vdCBpbiB0aGlzIHJlcG9zaXRvcnkKICAgICAqLwogICAgcHVi\nbGljIHN5bmNocm9uaXplZCBib29sZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNz\nIGNscykgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChfbWV0YXMucmVtb3ZlKGNscykg\nIT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBpbXBsID0gKENsYXNzKSBf\naWZhY2VzLnJlbW92ZShjbHMpOwogICAgICAgICAgICBpZiAoaW1wbCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgX21ldGFzLnJlbW92ZShpbXBsKTsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4g\nbWV0YWRhdGEgYXMgZGVjbGFyZWQgaW50ZXJmYWNlIGltcGxlbWVudGF0aW9u\nLgogICAgICovCiAgICB2b2lkIGFkZERlY2xhcmVkSW50ZXJmYWNlSW1wbChD\nbGFzc01ldGFEYXRhIG1ldGEsIENsYXNzIGlmYWNlKSB7CiAgICAgICAgc3lu\nY2hyb25pemVkIChfaW1wbHMpIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiB2\nYWxzID0gKENvbGxlY3Rpb24pIF9pbXBscy5nZXQoaWZhY2UpOwogICAgICAg\nICAgICAKICAgICAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBzdXBl\ncmNsYXNzIGFscmVhZHkgZGVjbGFyZXMgdG8gYXZvaWQgZHVwcwogICAgICAg\nICAgICBpZiAodmFscyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDbGFz\nc01ldGFEYXRhIHN1cCA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICAgICAgICAgIGZvciAoOyBzdXAgIT0gbnVsbDsgc3VwID0g\nc3VwLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpCiAgICAgICAgICAgICAg\nICAgICAgaWYgKHZhbHMuY29udGFpbnMoc3VwLmdldERlc2NyaWJlZFR5cGUo\nKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2ltcGxzLCBpZmFj\nZSwgbWV0YS5nZXREZXNjcmliZWRUeXBlKCksIGZhbHNlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGltcGxlbWVudGF0aW9u\nIGZvciB0aGUgZ2l2ZW4gbWFuYWdlZCBpbnRlcmZhY2UuCiAgICAgKi8KICAg\nIHN5bmNocm9uaXplZCB2b2lkIHNldEludGVyZmFjZUltcGwoQ2xhc3NNZXRh\nRGF0YSBtZXRhLCBDbGFzcyBpbXBsKSB7CiAgICAgICAgaWYgKCFtZXRhLmlz\nTWFuYWdlZEludGVyZmFjZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2VkLWludGVyZmFj\nZSIsIAogICAgICAgICAgICAgICAgbWV0YSwgaW1wbCkpOwogICAgICAgIF9p\nZmFjZXMucHV0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBpbXBsKTsKICAg\nICAgICBfbWV0YXMucHV0KGltcGwsIG1ldGEpOwogICAgICAgIGFkZERlY2xh\ncmVkSW50ZXJmYWNlSW1wbChtZXRhLCBtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBtZXRhLmdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgd2hpbGUgKHN1cCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIHJlY29yZCBzdXBlcmNsYXNzIGludGVyZmFj\nZSBpbmZvIHdoaWxlIHdlIGNhbiBhcyB3ZWxsIGFzIHdlCiAgICAgICAgICAg\nIC8vIHdpbGwgb25seSByZWdpc3RlciBjb25jcmV0ZSBzdXBlcmNsYXNzIGlu\nIFBDUmVnaXN0cnkKICAgICAgICAgICAgc3VwLmNsZWFyU3ViY2xhc3NDYWNo\nZSgpOwogICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIHN1cC5n\nZXREZXNjcmliZWRUeXBlKCksIGltcGwsIHRydWUpOwogICAgICAgICAgICBz\ndXAgPSAoQ2xhc3NNZXRhRGF0YSkgc3VwLmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBzeW5jaHJvbml6ZWQg\nSW50ZXJmYWNlSW1wbEdlbmVyYXRvciBnZXRJbXBsR2VuZXJhdG9yKCkgewog\nICAgICAgIGlmIChfaW1wbEdlbiA9PSBudWxsKQogICAgICAgICAgICBfaW1w\nbEdlbiA9IG5ldyBJbnRlcmZhY2VJbXBsR2VuZXJhdG9yKHRoaXMpOwogICAg\nICAgIHJldHVybiBfaW1wbEdlbjsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgbGVhc3QtZGVyaXZlZCBjbGFzcyBtZXRhZGF0YSBmb3IgdGhl\nIGdpdmVuIGFwcGxpY2F0aW9uCiAgICAgKiBpZGVudGl0eSBvYmplY3QuCiAg\nICAgKgogICAgICogQHBhcmFtIG9pZCB0aGUgb2lkIHRvIGdldCB0aGUgbWV0\nYWRhdGEgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVyIHRoZSBlbnZpcm9u\nbWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAgKiBAcGFyYW0gbXVz\ndEV4aXN0IGlmIHRydWUsIHRocm93cyBhIHtAbGluayBNZXRhRGF0YUV4Y2Vw\ndGlvbn0KICAgICAqIGlmIG5vIG1ldGFkYXRhIGlzIGZvdW5kCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKE9iamVjdCBv\naWQsIENsYXNzTG9hZGVyIGVudkxvYWRlciwKICAgICAgICBib29sZWFuIG11\nc3RFeGlzdCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCAmJiBtdXN0RXhp\nc3QpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tb2lkLW1ldGEiLCBvaWQsICI/IiwKICAgICAgICAgICAg\nICAgIF9vaWRzKSk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKG9pZCBpbnN0YW5jZW9m\nIE9wZW5KUEFJZCkgewogICAgICAgICAgICBDbGFzcyBjbHMgPSAoKE9wZW5K\nUEFJZCkgb2lkKS5nZXRUeXBlKCk7CiAgICAgICAgICAgIHJldHVybiBnZXRN\nZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKICAgICAgICB9\nCgogICAgICAgIC8vIGNoZWNrIGNhY2hlCiAgICAgICAgcHJvY2Vzc1JlZ2lz\ndGVyZWRDbGFzc2VzKCk7CiAgICAgICAgQ2xhc3MgY2xzID0gKENsYXNzKSBf\nb2lkcy5nZXQob2lkLmdldENsYXNzKCkpOwogICAgICAgIGlmIChjbHMgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdldE1ldGFEYXRhKGNscywgZW52\nTG9hZGVyLCBtdXN0RXhpc3QpOwoKICAgICAgICAvLyBtYXliZSB0aGlzIGlz\nIHNvbWUgdHlwZSB3ZSd2ZSBzZWVuIGJ1dCBqdXN0IGlzbid0IHZhbGlkCiAg\nICAgICAgaWYgKF9vaWRzLmNvbnRhaW5zS2V5KG9pZC5nZXRDbGFzcygpKSkg\newogICAgICAgICAgICBpZiAobXVzdEV4aXN0KQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vaWQt\nbWV0YSIsIG9pZCwKICAgICAgICAgICAgICAgICAgICBvaWQuZ2V0Q2xhc3Mo\nKSwgX29pZHMpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiBzdGlsbCBub3QgbWF0Y2gsIHJlZ2lzdGVyIGFu\neSBjbGFzc2VzIHRoYXQgbG9vayBzaW1pbGFyIHRvIHRoZQogICAgICAgIC8v\nIG9pZCBjbGFzcyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICByZXNvbHZlSWRl\nbnRpdHlDbGFzcyhvaWQpOwogICAgICAgIGlmIChwcm9jZXNzUmVnaXN0ZXJl\nZENsYXNzZXMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNscyA9IChD\nbGFzcykgX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAgICAgICAgICAg\naWYgKGNscyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGdldE1l\ndGFEYXRhKGNscywgZW52TG9hZGVyLCBtdXN0RXhpc3QpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBhbiBpbnZhbGlkIHR5\ncGUKICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCksIG51bGwpOwoK\nICAgICAgICBpZiAoIW11c3RFeGlzdCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwKICAgICAgICAgICAgb2lkLmdldENs\nYXNzKCksIF9vaWRzKSwgb2lkKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2Ugc29tZSBndWVzc2VzIGFib3V0IHRoZSBuYW1lIG9mIGEgdGFyZ2V0IGNs\nYXNzIGZvciBhbgogICAgICogdW5rbm93biBhcHBsaWNhdGlvbiBpZGVudGl0\neSBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVJZGVu\ndGl0eUNsYXNzKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAob2lkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3Mgb2lkQ2xh\nc3MgPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJy\nZXNvbHZlLWlkZW50aXR5Iiwgb2lkQ2xhc3MpKTsKCiAgICAgICAgQ2xhc3NM\nb2FkZXIgY2wgPSBvaWRDbGFzcy5nZXRDbGFzc0xvYWRlcigpOwogICAgICAg\nIFN0cmluZyBjbGFzc05hbWU7CiAgICAgICAgd2hpbGUgKG9pZENsYXNzICE9\nIG51bGwgJiYgb2lkQ2xhc3MgIT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAg\nICAgIGNsYXNzTmFtZSA9IG9pZENsYXNzLmdldE5hbWUoKTsKCiAgICAgICAg\nICAgIC8vIHdlIHRha2UgYSBicnV0ZS1mb3JjZSBhcHByb2FjaDogdHJ5IHRv\nIGxvYWQgYWxsIHRoZSBjbGFzcycKICAgICAgICAgICAgLy8gc3Vic3RyaW5n\ncy4gdGhpcyB3aWxsIGhhbmRsZSB0aGUgZm9sbG93aW5nIGNvbW1vbiBuYW1p\nbmcgY2FzZXM6CiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vICAgY29t\nLmNvbXBhbnkuTXlDbGFzcyRJRAktPiBjb20uY29tcGFueS5NeUNsYXNzCiAg\nICAgICAgICAgIC8vICAgY29tLmNvbXBhbnkuTXlDbGFzc0lkCS0+IGNvbS5j\nb21wYW55Lk15Q2xhc3MKICAgICAgICAgICAgLy8gICBjb20uY29tcGFueS5N\neUNsYXNzT2lkCS0+IGNvbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAgICAg\nLy8gICBjb20uY29tcGFueS5NeUNsYXNzUEsJLT4gY29tLmNvbXBhbnkuTXlD\nbGFzcwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyB0aGlzIGlzbid0\nIHRoZSBmYXN0ZXN0IHRoaW5nIHBvc3NpYmxlLCBidXQgdGhpcyBtZXRob2Qg\nd2lsbAogICAgICAgICAgICAvLyBvbmx5IGJlIGNhbGxlZCBvbmNlIHBlciBK\nVk0gcGVyIHVua25vd24gYXBwIGlkIGNsYXNzCiAgICAgICAgICAgIGZvciAo\naW50IGkgPSBjbGFzc05hbWUubGVuZ3RoKCk7IGkgPiAxOyBpLS0pIHsKICAg\nICAgICAgICAgICAgIGlmIChjbGFzc05hbWUuY2hhckF0KGkgLSAxKSA9PSAn\nLicpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNs\nYXNzTmFtZS5zdWJzdHJpbmcoMCwgaSksIHRydWUsIGNsKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICB9IC8vIGNvbnN1bWUgYWxsIGV4Y2VwdGlvbnMKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gbW92ZSB1cCB0aGUgT0lEIGhpZXJhcmNoeQogICAg\nICAgICAgICBvaWRDbGFzcyA9IG9pZENsYXNzLmdldFN1cGVyY2xhc3MoKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGxl\nYXN0LWRlcml2ZWQgbWV0YWRhdGFzIHdpdGggc29tZSBtYXBwZWQgYXNzaWdu\nYWJsZSB0eXBlIHRoYXQKICAgICAqIGltcGxlbWVudCB0aGUgZ2l2ZW4gY2xh\nc3MuCiAgICAgKgogICAgICogQHBhcmFtIGNscyB0aGUgY2xhc3Mgb3IgaW50\nZXJmYWNlIHRvIHJldHJpZXZlIGltcGxlbWVudG9ycyBmb3IKICAgICAqIEBw\nYXJhbSBlbnZMb2FkZXIgdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVy\nLCBpZiBhbnkKICAgICAqIEBwYXJhbSBtdXN0RXhpc3QgaWYgdHJ1ZSwgdGhy\nb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9ufQogICAgICogaWYgbm8g\nbWV0YWRhdGEgaXMgZm91bmQKICAgICAqLwogICAgcHVibGljIENsYXNzTWV0\nYURhdGFbXSBnZXRJbXBsZW1lbnRvck1ldGFEYXRhcyhDbGFzcyBjbHMsCiAg\nICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlz\ndCkgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tbWV0YSIsIGNscykpOwogICAgICAgIGlmIChjbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX01FVEFTOwoKICAgICAgICAvLyBn\nZXQgaW1wbHMgb2YgZ2l2ZW4gaW50ZXJmYWNlIC8gYWJzdHJhY3QgY2xhc3MK\nICAgICAgICBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoZW52TG9hZGVy\nKTsKICAgICAgICBDb2xsZWN0aW9uIHZhbHMgPSAoQ29sbGVjdGlvbikgX2lt\ncGxzLmdldChjbHMpOwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAg\nICAgICBDb2xsZWN0aW9uIG1hcHBlZCA9IG51bGw7CiAgICAgICAgaWYgKHZh\nbHMgIT0gbnVsbCkgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHZhbHMp\nIHsKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdmFscy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIG1ldGEgPSBnZXRNZXRhRGF0YSgoQ2xhc3MpIGl0ci5uZXh0KCksIGVu\ndkxvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGEu\naXNNYXBwZWQoKQogICAgICAgICAgICAgICAgICAgICAgICB8fCBtZXRhLmdl\ndE1hcHBlZFBDU3ViY2xhc3NNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBwZWQgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBlZCA9IG5ldyBBcnJheUxp\nc3QodmFscy5zaXplKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBtYXBw\nZWQuYWRkKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKG1hcHBlZCA9PSBudWxsICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhIiwg\nY2xzKSk7CiAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gRU1QVFlfTUVUQVM7CiAgICAgICAgcmV0dXJuIChDbGFzc01l\ndGFEYXRhW10pIG1hcHBlZC50b0FycmF5KG5ld0NsYXNzTWV0YURhdGFBcnJh\neQogICAgICAgICAgICAobWFwcGVkLnNpemUoKSkpOwogICAgfQogICAgIAog\nICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtZXRhZGF0YSBjb3JyZXNwb25kaW5n\nIHRvIHRoZSBnaXZlbiBwZXJzaXN0ZW5jZS1hd2FyZSBjbGFzcy4gCiAgICAg\nKiBSZXR1cm5zIG51bGwsIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyBub3QgcmVn\naXN0ZXJlZCBhcyAKICAgICAqIHBlcnNpc3RlbmNlLWF3YXJlLgogICAgICov\nCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGdldFBlcnNpc3Rl\nbmNlQXdhcmUoQ2xhc3MgY2xzKSB7CiAgICAJcmV0dXJuIChOb25QZXJzaXN0\nZW50TWV0YURhdGEpX3Bhd2FyZXMuZ2V0KGNscyk7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogR2V0cyBhbGwgdGhlIG1ldGFkYXRhcyBmb3IgcGVyc2lz\ndGVuY2UtYXdhcmUgY2xhc3NlcwogICAgICogCiAgICAgKiBAcmV0dXJuIGVt\ncHR5IGFycmF5IGlmIG5vIGNsYXNzIGhhcyBiZWVuIHJlZ2lzdGVyZWQgYXMg\ncGVycy1hd2FyZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1l\ndGFEYXRhW10gZ2V0UGVyc2lzdGVuY2VBd2FyZXMoKSB7CiAgICAgICAgc3lu\nY2hyb25pemVkIChfcGF3YXJlcykgewogICAgICAgICAgICBpZiAoX3Bhd2Fy\nZXMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZX05P\nTl9QRVJTSVNURU5UOwogICAgICAgICAgICByZXR1cm4gKE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YVtdKV9wYXdhcmVzLnZhbHVlcygpLnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhW19wYXdhcmVz\nLnNpemUoKV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gY2xhc3MgYXMgcGVyc2lzdGVuY2UtYXdhcmUuCiAgICAg\nKiAKICAgICAqIEBwYXJhbSBjbHMgbm9uLW51bGwgYW5kIG11c3Qgbm90IGFs\ncmVhZGR5IGJlIGFkZGVkIGFzIHBlcnNpdGVuY2UtY2FwYWJsZQogICAgICov\nCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFkZFBlcnNpc3Rl\nbmNlQXdhcmUoQ2xhc3MgY2xzKSB7CiAgICAJaWYgKGNscyA9PSBudWxsKQog\nICAgCQlyZXR1cm4gbnVsbDsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykg\newogICAgICAgICAgICBpZiAoX3Bhd2FyZXMuY29udGFpbnNLZXkoY2xzKSkK\nICAgICAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRh\nKV9wYXdhcmVzLmdldChjbHMpOwogICAgICAgICAgICBpZiAoZ2V0Q2FjaGVk\nTWV0YURhdGEoY2xzKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1hbmQtYXdhcmUi\nLCBjbHMpKTsKICAgICAgICAgICAgTm9uUGVyc2lzdGVudE1ldGFEYXRhIG1l\ndGEgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhKGNscywgdGhpcywKICAg\nICAgICAgICAgICAgIE5vblBlcnNpc3RlbnRNZXRhRGF0YS5UWVBFX1BFUlNJ\nU1RFTkNFX0FXQVJFKTsKICAgICAgICAgICAgX3Bhd2FyZXMucHV0KGNscywg\nbWV0YSk7CiAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAgCX0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSBhIHBlcnNpdGVuY2UtYXdhcmUgY2xh\nc3MgZnJvbSB0aGUgcmVwb3NpdG9yeQogICAgICogCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgcmVtb3ZlZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZW1vdmVQZXJzaXN0ZW5jZUF3YXJlKENsYXNzIGNscykgewogICAgCXJldHVy\nbiBfcGF3YXJlcy5yZW1vdmUoY2xzKSAhPSBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogR2V0cyB0aGUgbWV0YWRhdGEgY29ycmVzcG9uZGluZyB0byB0\naGUgZ2l2ZW4gbm9uLW1hcHBlZCBpbnRlcmZhY2UuCiAgICAgKiBSZXR1cm5z\nIG51bGwsIGlmIHRoZSBnaXZlbiBpbnRlcmZhY2UgaXMgbm90IHJlZ2lzdGVy\nZWQgYXMgCiAgICAgKiBwZXJzaXN0ZW5jZS1hd2FyZS4KICAgICAqLwogICAg\ncHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YSBnZXROb25NYXBwZWRJbnRl\ncmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgIAlyZXR1cm4gKE5vblBlcnNpc3Rl\nbnRNZXRhRGF0YSlfbm9uTWFwcGVkLmdldChpZmFjZSk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogR2V0cyB0aGUgY29ycmVzcG9uZGluZyBtZXRhZGF0\nYXMgZm9yIGFsbCByZWdpc3RlcmVkLCBub24tbWFwcGVkCiAgICAgKiBpbnRl\ncmZhY2VzCiAgICAgKiAKICAgICAqIEByZXR1cm4gZW1wdHkgYXJyYXkgaWYg\nbm8gbm9uLW1hcHBlZCBpbnRlcmZhY2UgaGFzIGJlZW4gcmVnaXN0ZXJlZC4K\nICAgICAqLwogICAgcHVibGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdIGdl\ndE5vbk1hcHBlZEludGVyZmFjZXMoKSB7CiAgICAgICAgc3luY2hyb25pemVk\nIChfbm9uTWFwcGVkKSB7CiAgICAgICAgICAgIGlmIChfbm9uTWFwcGVkLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTVBUWV9OT05fUEVS\nU0lTVEVOVDsKICAgICAgICAgICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0\nYURhdGFbXSlfbm9uTWFwcGVkLnZhbHVlcygpLnRvQXJyYXkKICAgICAgICAg\nICAgICAgIChuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhW19ub25NYXBwZWQu\nc2l6ZSgpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIHRoZSBnaXZlbiBub24tbWFwcGVkIGludGVyZmFjZSB0byB0aGUgcmVwb3Np\ndG9yeS4KICAgICAqIAogICAgICogQHBhcmFtIGlmYWNlIHRoZSBub24tbWFw\ncGVkIGludGVyZmFjZQogICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVu\ndE1ldGFEYXRhIGFkZE5vbk1hcHBlZEludGVyZmFjZShDbGFzcyBpZmFjZSkg\newogICAgCWlmIChpZmFjZSA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoIWlmYWNlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW5v\nbi1tYXBwZWQiLCBpZmFjZSkpOwogICAgICAgIHN5bmNocm9uaXplZCh0aGlz\nKSB7CiAgICAgICAgICAgIGlmIChfbm9uTWFwcGVkLmNvbnRhaW5zS2V5KGlm\nYWNlKSkKICAgICAgICAgICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1l\ndGFEYXRhKV9ub25NYXBwZWQuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYg\nKGdldENhY2hlZE1ldGFEYXRhKGlmYWNlKSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb24tbWFwcGVkLXBjIiwgaWZhY2UpKTsKICAgICAgICAgICAgTm9uUGVyc2lz\ndGVudE1ldGFEYXRhIG1ldGEgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRh\nKGlmYWNlLCB0aGlzLAogICAgICAgICAgICAgICAgTm9uUGVyc2lzdGVudE1l\ndGFEYXRhLlRZUEVfTk9OX01BUFBFRF9JTlRFUkZBQ0UpOwogICAgICAgICAg\nICBfbm9uTWFwcGVkLnB1dChpZmFjZSwgbWV0YSk7CiAgICAgICAgICAgIHJl\ndHVybiBtZXRhOwogICAgCX0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSBhIG5vbi1tYXBwZWQgaW50ZXJmYWNlIGZyb20gdGhlIHJlcG9zaXRvcnkK\nICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIHJlbW92ZWQKICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlTm9uTWFwcGVkSW50ZXJmYWNl\nKENsYXNzIGlmYWNlKSB7CiAgICAJcmV0dXJuIF9ub25NYXBwZWQucmVtb3Zl\nKGlmYWNlKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIg\ndGhlIGNhY2hlIG9mIHBhcnNlZCBtZXRhZGF0YS4gVGhpcyBtZXRob2QgYWxz\nbyBjbGVhcnMgdGhlCiAgICAgKiBpbnRlcm5hbCB7QGxpbmsgTWV0YURhdGFG\nYWN0b3J5IE1ldGFEYXRhRmFjdG9yeX0ncyBjYWNoZS4KICAgICAqLwogICAg\ncHVibGljIHN5bmNocm9uaXplZCB2b2lkIGNsZWFyKCkgewogICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImNsZWFyLXJlcG9zIiwgdGhpcykpOwoKICAgICAgICBf\nbWV0YXMuY2xlYXIoKTsKICAgICAgICBfb2lkcy5jbGVhcigpOwogICAgICAg\nIF9zdWJzLmNsZWFyKCk7CiAgICAgICAgX2ltcGxzLmNsZWFyKCk7CiAgICAg\nICAgX3F1ZXJpZXMuY2xlYXIoKTsKICAgICAgICBfc2Vxcy5jbGVhcigpOwog\nICAgICAgIF9yZWdpc3RlcmVkLmNsZWFyKCk7CiAgICAgICAgX2ZhY3Rvcnku\nY2xlYXIoKTsKICAgICAgICBfYWxpYXNlcy5jbGVhcigpOwogICAgICAgIF9w\nYXdhcmVzLmNsZWFyKCk7CiAgICAgICAgX25vbk1hcHBlZC5jbGVhcigpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQgb2YgY29uZmln\ndXJlZCBwZXJzaXN0ZW50IGNsYXNzZXMsIG9yIG51bGwgaWYgdGhlIHVzZXIK\nICAgICAqIGRpZCBub3QgY29uZmlndXJlIGFueS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZGV2cGF0aCBpZiB0cnVlLCBzZWFyY2ggZm9yIG1ldGFkYXRhIGZp\nbGVzIGluIGRpcmVjdG9yaWVzCiAgICAgKiBpbiB0aGUgY2xhc3NwYXRoIGlm\nIG5vIGNsYXNzZXMgYXJlIGNvbmZpZ3VyZWQgZXhwbGljaXRseQogICAgICog\nQHBhcmFtIGVudkxvYWRlciB0aGUgY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3Ig\nbnVsbCBmb3IgZGVmYXVsdAogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIFNldCBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGJvb2xlYW4gZGV2cGF0\naCwKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBy\nZXR1cm4gX2ZhY3RvcnkuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhkZXZwYXRo\nLCBlbnZMb2FkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUg\ncGVyc2lzdGVudCBjbGFzc2VzIG5hbWVkIGluIGNvbmZpZ3VyYXRpb24uCiAg\nICAgKiBUaGlzIGVuc3VyZXMgdGhhdCBhbGwgc3ViY2xhc3NlcyBhbmQgYXBw\nbGljYXRpb24gaWRlbnRpdHkgY2xhc3NlcyBvZgogICAgICogZWFjaCB0eXBl\nIGFyZSBrbm93biBpbiBhZHZhbmNlLCB3aXRob3V0IGhhdmluZyB0byByZWx5\nIG9uIHRoZQogICAgICogYXBwbGljYXRpb24gbG9hZGluZyB0aGUgY2xhc3Nl\ncyBiZWZvcmUgcGVyZm9ybWluZyBvcGVyYXRpb25zIHRoYXQKICAgICAqIG1p\nZ2h0IGludm9sdmUgdGhlbS4KICAgICAqCiAgICAgKiBAcGFyYW0gZGV2cGF0\naCBpZiB0cnVlLCBzZWFyY2ggZm9yIG1ldGFkYXRhIGZpbGVzIGluIGRpcmVj\ndG9yaWVzCiAgICAgKiBpbiB0aGUgY2xhc3NwYXRoIGlmIHRoZSBubyBjbGFz\nc2VzIGFyZSBjb25maWd1cmVkIGV4cGxpY2l0bHkKICAgICAqIEBwYXJhbSBl\nbnZMb2FkZXIgdGhlIGNsYXNzIGxvYWRlciB0byB1c2UsIG9yIG51bGwgZm9y\nIGRlZmF1bHQKICAgICAqIEByZXR1cm4gdGhlIGxvYWRlZCBjbGFzc2VzLCBv\nciBlbXB0eSBjb2xsZWN0aW9uIGlmIG5vbmUKICAgICAqLwogICAgcHVibGlj\nIHN5bmNocm9uaXplZCBDb2xsZWN0aW9uIGxvYWRQZXJzaXN0ZW50VHlwZXMo\nYm9vbGVhbiBkZXZwYXRoLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRl\ncikgewogICAgICAgIFNldCBuYW1lcyA9IF9mYWN0b3J5LmdldFBlcnNpc3Rl\nbnRUeXBlTmFtZXMoZGV2cGF0aCwgZW52TG9hZGVyKTsKICAgICAgICBpZiAo\nbmFtZXMgPT0gbnVsbCB8fCBuYW1lcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAvLyBh\ndHRlbXB0IHRvIGxvYWQgY2xhc3NlcyBzbyB0aGF0IHRoZXkgZ2V0IHByb2Nl\nc3NlZAogICAgICAgIENsYXNzTG9hZGVyIGNsc0xvYWRlciA9IF9jb25mLmdl\ndENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgpLgogICAgICAgICAgICBnZXRDbGFz\nc0xvYWRlcihnZXRDbGFzcygpLCBlbnZMb2FkZXIpOwogICAgICAgIExpc3Qg\nY2xhc3NlcyA9IG5ldyBBcnJheUxpc3QobmFtZXMuc2l6ZSgpKTsKICAgICAg\nICBDbGFzcyBjbHM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBuYW1l\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBj\nbHMgPSBjbGFzc0Zvck5hbWUoKFN0cmluZykgaXRyLm5leHQoKSwgY2xzTG9h\nZGVyKTsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgY2xhc3Nlcy5hZGQoY2xzKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGNsYXNzZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGNsYXNzIGZvciB0aGUgZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBub3QgbG9h\nZGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgY2xhc3NGb3JOYW1l\nKFN0cmluZyBuYW1lLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gQ2xhc3MuZm9yTmFtZShuYW1lLCB0\ncnVlLCBsb2FkZXIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElN\nRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSkpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKF9sb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBu\nYW1lKSk7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKGUpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhbGwga25vd24gc3ViY2xhc3NlcyBmb3IgdGhlIGdpdmVuIGNsYXNzIG1h\ncHBpbmcuIE5vdGUKICAgICAqIHRoYXQgdGhpcyBtZXRob2Qgb25seSB3b3Jr\ncyBkdXJpbmcgcnVudGltZSB3aGVuIHRoZSByZXBvc2l0b3J5IGlzCiAgICAg\nKiByZWdpc3RlcmVkIGFzIGEge0BsaW5rIFJlZ2lzdGVyQ2xhc3NMaXN0ZW5l\ncn0uCiAgICAgKi8KICAgIENvbGxlY3Rpb24gZ2V0UENTdWJjbGFzc2VzKENs\nYXNzIGNscykgewogICAgICAgIENvbGxlY3Rpb24gc3VicyA9IChDb2xsZWN0\naW9uKSBfc3Vicy5nZXQoY2xzKTsKICAgICAgICBpZiAoc3VicyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsK\nICAgICAgICByZXR1cm4gc3ViczsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZWdpc3RlckNs\nYXNzTGlzdGVuZXIgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBy\nZWdpc3RlcihDbGFzcyBjbHMpIHsKICAgICAgICAvLyBidWZmZXIgcmVnaXN0\nZXJlZCBjbGFzc2VzIHVudGlsIGFuIG9pZCBtZXRhZGF0YSByZXF1ZXN0IGlz\nIG1hZGUsCiAgICAgICAgLy8gYXQgd2hpY2ggcG9pbnQgd2UnbGwgcGFyc2Ug\nZXZlcnl0aGluZyBpbiB0aGUgYnVmZmVyCiAgICAgICAgc3luY2hyb25pemVk\nIChfcmVnaXN0ZXJlZCkgewogICAgICAgICAgICBfcmVnaXN0ZXJlZC5hZGQo\nY2xzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZXMg\ndGhlIG1ldGFkYXRhIGZvciBhbGwgcmVnaXN0ZXJlZCBjbGFzc2VzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgbG9hZFJlZ2lzdGVyZWRDbGFzc01ldGFE\nYXRhKENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIENsYXNzW10g\ncmVnID0gcHJvY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCByZWcubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKHJlZ1tpXSwg\nZW52TG9hZGVyLCBmYWxzZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE1ldGFE\nYXRhRXhjZXB0aW9uIG1lKSB7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5p\nc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJu\nKG1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFVwZGF0ZXMgb3VyIGRhdGFzdHJ1Y3R1cmVzIHdpdGggdGhlIGxh\ndGVzdCByZWdpc3RlcmVkIGNsYXNzZXMuCiAgICAgKi8KICAgIENsYXNzW10g\ncHJvY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKCkgewogICAgICAgIGlmIChfcmVn\naXN0ZXJlZC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9D\nTEFTU0VTOwoKICAgICAgICAvLyBjb3B5IGludG8gbmV3IGNvbGxlY3Rpb24g\ndG8gYXZvaWQgY29uY3VycmVudCBtb2QgZXJyb3JzIG9uIHJlZW50cmFudAog\nICAgICAgIC8vIHJlZ2lzdHJhdGlvbnMKICAgICAgICBDbGFzc1tdIHJlZzsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKF9yZWdpc3RlcmVkKSB7CiAgICAgICAg\nICAgIHJlZyA9IChDbGFzc1tdKSBfcmVnaXN0ZXJlZC50b0FycmF5KG5ldyBD\nbGFzc1tfcmVnaXN0ZXJlZC5zaXplKCldKTsKICAgICAgICAgICAgX3JlZ2lz\ndGVyZWQuY2xlYXIoKTsKICAgICAgICB9CgogICAgICAgIENvbGxlY3Rpb24g\nZmFpbGVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJl\nZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcHJvY2Vzc1JlZ2lzdGVyZWRDbGFzcyhyZWdbaV0pOwogICAgICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAg\naWYgKCFfY29uZi5nZXRSZXRyeUNsYXNzUmVnaXN0cmF0aW9uKCkpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJlcnJvci1yZWdpc3RlcmVkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgcmVnW2ldKSwgdCk7CgogICAgICAgICAgICAgICAgaWYgKF9sb2cu\naXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2Fy\nbihfbG9jLmdldCgiZmFpbGVkLXJlZ2lzdGVyZWQiLCByZWdbaV0pLCB0KTsK\nICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAg\nICAgICAgICBmYWlsZWQuYWRkKHJlZ1tpXSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoX3JlZ2lzdGVyZWQpIHsKICAgICAgICAgICAg\nICAgIF9yZWdpc3RlcmVkLmFkZEFsbChmYWlsZWQpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiByZWc7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBVcGRhdGVzIG91ciBkYXRhc3RydWN0dXJlcyB3aXRoIHRoZSBn\naXZlbiByZWdpc3RlcmVkIGNsYXNzLgogICAgICogUmVsaWVzIG9uIHRoZSBm\nYWN0IHRoYXQgYSBjaGlsZCBjbGFzcyBjYW5ub3QgcmVnaXN0ZXIgaXRzZWxm\nIHdpdGhvdXQKICAgICAqIGFsc28gcmVnaXN0ZXJpbmcgaXRzIHBhcmVudCBj\nbGFzcyBieSBzcGVjaWZ5aW5nIGl0cyBwZXJzaXN0ZW5jZQogICAgICogY2Fw\nYWJsZSBzdXBlcmNsYXNzIGluIHRoZSByZWdpc3RyYXRpb24gZXZlbnQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcm9jZXNzUmVnaXN0ZXJlZENsYXNz\nKENsYXNzIGNscykgewogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInByb2Nlc3Mt\ncmVnaXN0ZXJlZCIsIGNscykpOwoKICAgICAgICAvLyB1cGRhdGUgc3ViY2xh\nc3MgbGlzdHM7IHN5bmNocm9uaXplIG9uIHRoaXMgYmVjYXVzZSBhY2Nlc3Np\nbmcgX21ldGFzCiAgICAgICAgLy8gcmVxdWlyZXMgaXQKICAgICAgICBDbGFz\ncyBsZWFzdERlcml2ZWQgPSBjbHM7CiAgICAgICAgc3luY2hyb25pemVkICh0\naGlzKSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAg\nICAgICAgZm9yIChDbGFzcyBhbmMgPSBjbHM7CiAgICAgICAgICAgICAgICAo\nYW5jID0gUENSZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhhbmMp\nKSAhPSBudWxsOykgewogICAgICAgICAgICAgICAgYWRkVG9Db2xsZWN0aW9u\nKF9zdWJzLCBhbmMsIGNscywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBtZXRh\nID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQoYW5jKTsKICAgICAgICAg\nICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nbWV0YS5jbGVhclN1YmNsYXNzQ2FjaGUoKTsKICAgICAgICAgICAgICAgIGxl\nYXN0RGVyaXZlZCA9IGFuYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gdXBkYXRlIG9pZCBtYXBwaW5ncyBpZiB0aGlzIGlzIGEgYmFz\nZSBjb25jcmV0ZSBjbGFzcwogICAgICAgIE9iamVjdCBvaWQgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9pZCA9IFBDUmVnaXN0cnkubmV3\nT2JqZWN0SWQoY2xzKTsKICAgICAgICB9IGNhdGNoIChJbnRlcm5hbEV4Y2Vw\ndGlvbiBpZSkgewogICAgICAgICAgICAvLyB0aHJvd24gZm9yIHNpbmdsZSBm\naWVsZCBpZGVudGl0eSB3aXRoIG51bGwgcGsgZmllbGQgdmFsdWUKICAgICAg\nICB9CiAgICAgICAgaWYgKG9pZCAhPSBudWxsKSB7CiAgICAgICAgICAgIENs\nYXNzIGV4aXN0aW5nID0gKENsYXNzKSBfb2lkcy5nZXQob2lkLmdldENsYXNz\nKCkpOwogICAgICAgICAgICBpZiAoZXhpc3RpbmcgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNsYXNzIGZv\nciB0aGlzIE9JRCwgdGhlbiB3ZSBrbm93CiAgICAgICAgICAgICAgICAvLyB0\naGF0IG11bHRpcGxlIGNsYXNzZXMgYXJlIHVzaW5nIHRoZSBzYW1lIE9JRDog\ndGhlcmVmb3JlLAogICAgICAgICAgICAgICAgLy8gcHV0IHRoZSBsZWFzdCBk\nZXJpdmVkIFBDIHN1cGVyY2xhc3MgaW50byB0aGUgbWFwLiBUaGlzCiAgICAg\nICAgICAgICAgICAvLyBnZXRzIGFyb3VuZCB0aGUgcHJvYmxlbSBvZiBhbiBh\nYnN0cmFjdCBQQyBzdXBlcmNsYXNzCiAgICAgICAgICAgICAgICAvLyB1c2lu\nZyBhcHBsaWNhdGlvbiBpZGVudGl0eSAoc2luY2UgbmV3T2JqZWN0SWQKICAg\nICAgICAgICAgICAgIC8vIHdpbGwgcmV0dXJuIG51bGwgZm9yIGFic3RyYWN0\nIGNsYXNzZXMpLgogICAgICAgICAgICAgICAgQ2xhc3Mgc3VwID0gY2xzOwog\nICAgICAgICAgICAgICAgd2hpbGUgKFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVu\ndFN1cGVyY2xhc3Moc3VwKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHN1cCA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xhc3Moc3Vw\nKTsKCiAgICAgICAgICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCks\nIHN1cCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXhpc3RpbmcgPT0gbnVs\nbCB8fCBjbHMuaXNBc3NpZ25hYmxlRnJvbShleGlzdGluZykpCiAgICAgICAg\nICAgICAgICBfb2lkcy5wdXQob2lkLmdldENsYXNzKCksIGNscyk7CiAgICAg\nICAgfQoKICAgICAgICAvLyB1cGRhdGUgbWFwcGluZ3MgZnJvbSBpbnRlcmZh\nY2VzIGFuZCBub24tcGMgc3VwZXJjbGFzc2VzIHRvCiAgICAgICAgLy8gcGMg\naW1wbGVtZW50aW5nIHR5cGVzCiAgICAgICAgc3luY2hyb25pemVkIChfaW1w\nbHMpIHsKICAgICAgICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2\nZWQsIGNscyk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZXQgYWxpYXMgZm9y\nIGNsYXNzCiAgICAgICAgU3RyaW5nIGFsaWFzID0gUENSZWdpc3RyeS5nZXRU\neXBlQWxpYXMoY2xzKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKF9hbGlhc2Vz\nKSB7CiAgICAgICAgICAgIExpc3QgY2xhc3NMaXN0ID0gKExpc3QpIF9hbGlh\nc2VzLmdldChhbGlhcyk7CiAgICAgICAgICAgIGlmIChjbGFzc0xpc3QgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgY2xhc3NMaXN0ID0gbmV3IEFycmF5\nTGlzdCgzKTsKICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1dChhbGlhcywg\nY2xhc3NMaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWNs\nYXNzTGlzdC5jb250YWlucyhjbHMpKQogICAgICAgICAgICAgICAgY2xhc3NM\naXN0LmFkZChjbHMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFVwZGF0ZSB0aGUgbGlzdCBvZiBpbXBsZW1lbnRhdGlvbnMgb2YgYmFzZSBj\nbGFzc2VzIGFuZCBpbnRlcmZhY2VzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgdXBkYXRlSW1wbHMoQ2xhc3MgY2xzLCBDbGFzcyBsZWFzdERlcml2ZWQs\nIENsYXNzIGNoZWNrKSB7CiAgICAgICAgLy8gYWxsb3cgdXNlcnMgdG8gcXVl\ncnkgb24gY29tbW9uIG5vbi1wYyBzdXBlcmNsYXNzZXMKICAgICAgICBDbGFz\ncyBzdXAgPSBjaGVjay5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKGxl\nYXN0RGVyaXZlZCA9PSBjbHMgJiYgc3VwICE9IG51bGwgJiYgc3VwICE9IE9i\namVjdC5jbGFzcykgewogICAgICAgICAgICBhZGRUb0NvbGxlY3Rpb24oX2lt\ncGxzLCBzdXAsIGNscywgZmFsc2UpOwogICAgICAgICAgICB1cGRhdGVJbXBs\ncyhjbHMsIGxlYXN0RGVyaXZlZCwgc3VwKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGFsbG93IHVzZXJzIHRvIHF1ZXJ5IG9uIGFueSBpbXBsZW1lbnRlZCBp\nbnRlcmZhY2VzIHVubGVzcyBkZWZhdWx0cyAKICAgICAgICAvLyBzYXkgdGhl\nIHVzZXIgbXVzdCBpbXBsZW1lbnQgcGVyc2lzdGVudCBpbnRlcmZhY2VzIGV4\ncGxpY2l0bHkgaW4gbWV0YQogICAgICAgIGlmICghX2ZhY3RvcnkuZ2V0RGVm\nYXVsdHMoKS5pc0RlY2xhcmVkSW50ZXJmYWNlUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgQ2xhc3NbXSBpbnRzID0gY2hlY2su\nZ2V0SW50ZXJmYWNlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\naW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAvLyBkb24ndCBtYXAg\namF2YS1zdGFuZGFyZCBpbnRlcmZhY2VzCiAgICAgICAgICAgIGlmIChpbnRz\nW2ldLmdldE5hbWUoKS5zdGFydHNXaXRoKCJqYXZhLiIpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBvbmx5IG1hcCBsZWFz\ndC1kZXJpdmVkIGludGVyZmFjZSBpbXBsZW1lbnRvcnMKICAgICAgICAgICAg\naWYgKGxlYXN0RGVyaXZlZCA9PSBjbHMgfHwgaXNMZWFzdERlcml2ZWRJbXBs\nKGludHNbaV0sIGNscykpIHsKICAgICAgICAgICAgICAgIGFkZFRvQ29sbGVj\ndGlvbihfaW1wbHMsIGludHNbaV0sIGNscywgZmFsc2UpOwogICAgICAgICAg\nICAgICAgdXBkYXRlSW1wbHMoY2xzLCBsZWFzdERlcml2ZWQsIGludHNbaV0p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIHRoZSBsZWFz\ndC1kZXJpdmVkIHBlcnNpc3RlbnQKICAgICAqIGltcGxlbWVudG9yIG9mIHRo\nZSBnaXZlbiBpbnRlcmZhY2UsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIGlzTGVhc3REZXJpdmVkSW1wbChDbGFzcyBp\nbnRlciwgQ2xhc3MgY2xzKSB7CiAgICAgICAgQ2xhc3MgcGFyZW50ID0gUENS\nZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhjbHMpOwogICAgICAg\nIHdoaWxlIChwYXJlbnQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoQXJy\nYXlzLmFzTGlzdChwYXJlbnQuZ2V0SW50ZXJmYWNlcygpKS5jb250YWlucyhp\nbnRlcikpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIHBhcmVudCA9IFBDUmVnaXN0cnkuZ2V0UGVyc2lzdGVudFN1cGVyY2xh\nc3MocGFyZW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIHZhbHVlIHRvIHRo\nZSBjb2xsZWN0aW9uIGNhY2hlZCBpbiB0aGUgZ2l2ZW4gbWFwIHVuZGVyCiAg\nICAgKiB0aGUgZ2l2ZW4ga2V5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkVG9Db2xsZWN0aW9uKE1hcCBtYXAsIENsYXNzIGtleSwgQ2xhc3MgdmFs\ndWUsCiAgICAgICAgYm9vbGVhbiBpbmhlcml0YW5jZSkgewogICAgICAgIHN5\nbmNocm9uaXplZCAobWFwKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gY29s\nbCA9IChDb2xsZWN0aW9uKSBtYXAuZ2V0KGtleSk7CiAgICAgICAgICAgIGlm\nIChjb2xsID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChpbmhlcml0\nYW5jZSkgewogICAgICAgICAgICAgICAgICAgIEluaGVyaXRhbmNlQ29tcGFy\nYXRvciBjb21wID0gbmV3IEluaGVyaXRhbmNlQ29tcGFyYXRvcigpOwogICAg\nICAgICAgICAgICAgICAgIGNvbXAuc2V0QmFzZShrZXkpOwogICAgICAgICAg\nICAgICAgICAgIGNvbGwgPSBuZXcgVHJlZVNldChjb21wKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbGwgPSBuZXcg\nTGlua2VkTGlzdCgpOwogICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIGNv\nbGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbGwuYWRkKHZhbHVl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gQ29uZmlndXJhYmxlIGltcGxlbWVudGF0aW9u\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVi\nbGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBfY29uZiA9IChPcGVuSlBBQ29uZmlndXJhdGlvbikgY29u\nZjsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1\ncmF0aW9uLkxPR19NRVRBREFUQSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RhcnRDb25maWd1cmF0aW9uKCkgewogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgaWYgKF9mYWN0b3J5ID09\nIG51bGwpIHsKICAgICAgICAgICAgTWV0YURhdGFGYWN0b3J5IG1kZiA9IF9j\nb25mLm5ld01ldGFEYXRhRmFjdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAg\nIGlmIChtZGYgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YWRhdGFmYWN0b3J5\nIikpOwogICAgICAgICAgICBzZXRNZXRhRGF0YUZhY3RvcnkobWRmKTsKICAg\nICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBR\ndWVyeSBtZXRhZGF0YQogICAgLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gcXVlcnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBj\nbGFzcywgbmFtZSwgYW5kIGNsYXNzbG9hZGVyLgogICAgICovCiAgICBwdWJs\naWMgc3luY2hyb25pemVkIFF1ZXJ5TWV0YURhdGEgZ2V0UXVlcnlNZXRhRGF0\nYShDbGFzcyBjbHMsIFN0cmluZyBuYW1lLAogICAgICAgIENsYXNzTG9hZGVy\nIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBRdWVy\neU1ldGFEYXRhIG1ldGEgPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwoY2xz\nLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIGlmIChtZXRhID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gbG9hZCBhbGwgdGhlIG1ldGFkYXRhcyBmb3Ig\nYWxsIHRoZSBrbm93biBjbGFzc2VzIHNvIHRoYXQKICAgICAgICAgICAgLy8g\ncXVlcnkgbmFtZXMgYXJlIHNlZW4gYW5kIHJlZ2lzdGVyZWQKICAgICAgICAg\nICAgcmVzb2x2ZUFsbChlbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRhID0g\nZ2V0UXVlcnlNZXRhRGF0YUludGVybmFsKGNscywgbmFtZSwgZW52TG9hZGVy\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVz\ndEV4aXN0KSB7CiAgICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJuby1uYW1lZC1xdWVyeS1udWxs\nLWNsYXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UGVyc2lzdGVu\ndFR5cGVOYW1lcyhmYWxzZSwgZW52TG9hZGVyKSwgbmFtZSkpOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYW1lZC1xdWVyeSIsCiAgICAg\nICAgICAgICAgICAgICAgY2xzLCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKiAK\nICAgICAqIFJlc29sdmUgYWxsIGtub3duIG1ldGFkYXRhIGNsYXNzZXMuIAog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZUFsbChDbGFzc0xvYWRl\nciBlbnZMb2FkZXIpIHsKICAgICAgICBDb2xsZWN0aW9uIHR5cGVzID0gbG9h\nZFBlcnNpc3RlbnRUeXBlcyhmYWxzZSwgZW52TG9hZGVyKTsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGkgPSB0eXBlcy5pdGVyYXRvcigpOyBpLmhhc05leHQo\nKTsgKSB7CiAgICAgICAgICAgIENsYXNzIGMgPSAoQ2xhc3MpIGkubmV4dCgp\nOwogICAgICAgICAgICBnZXRNZXRhRGF0YShjLCBlbnZMb2FkZXIsIGZhbHNl\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gcXVl\ncnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcywgbmFtZSwgYW5kIGNs\nYXNzbG9hZGVyLgogICAgICovCiAgICBwcml2YXRlIFF1ZXJ5TWV0YURhdGEg\nZ2V0UXVlcnlNZXRhRGF0YUludGVybmFsKENsYXNzIGNscywgU3RyaW5nIG5h\nbWUsCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAg\naWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIC8vIGNoZWNrIGNhY2hlCiAgICAgICAgT2JqZWN0IGtleSA9IGdl\ndFF1ZXJ5S2V5KGNscywgbmFtZSk7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBx\nbSA9IChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoa2V5KTsKICAgICAg\nICBpZiAocW0gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHFtOwoKICAg\nICAgICAvLyBnZXQgbWV0YWRhdGEgZm9yIGNsYXNzLCB3aGljaCB3aWxsIGZp\nbmQgcXVlcmllcyBpbiBtZXRhZGF0YSBmaWxlCiAgICAgICAgaWYgKGNscyAh\nPSBudWxsICYmIGdldE1ldGFEYXRhKGNscywgZW52TG9hZGVyLCBmYWxzZSkg\nIT0gbnVsbCkgewogICAgICAgICAgICBxbSA9IChRdWVyeU1ldGFEYXRhKSBf\ncXVlcmllcy5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKHFtICE9IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gcW07CiAgICAgICAgfQogICAgICAg\nIGlmICgoX3NvdXJjZU1vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gc2VlIGlmIGZhY3Rvcnkg\nY2FuIGZpZ3VyZSBvdXQgYSBzY29wZSBmb3IgdGhpcyBxdWVyeQogICAgICAg\nIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gX2ZhY3Rvcnku\nZ2V0UXVlcnlTY29wZShuYW1lLCBlbnZMb2FkZXIpOwoKICAgICAgICAvLyBu\nb3QgaW4gY2FjaGU7IGxvYWQKICAgICAgICBfZmFjdG9yeS5sb2FkKGNscywg\nTU9ERV9RVUVSWSwgZW52TG9hZGVyKTsKICAgICAgICByZXR1cm4gKFF1ZXJ5\nTWV0YURhdGEpIF9xdWVyaWVzLmdldChrZXkpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjYWNoZWQgcXVlcnkgbWV0YWRhdGEuCiAgICAg\nKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVlcnlNZXRhRGF0YVtdIGdl\ndFF1ZXJ5TWV0YURhdGFzKCkgewogICAgICAgIHJldHVybiAoUXVlcnlNZXRh\nRGF0YVtdKSBfcXVlcmllcy52YWx1ZXMoKS50b0FycmF5CiAgICAgICAgICAg\nIChuZXcgUXVlcnlNZXRhRGF0YVtfcXVlcmllcy5zaXplKCldKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1ZXJ5IG1ldGFk\nYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwogICAgcHVibGljIHN5\nbmNocm9uaXplZCBRdWVyeU1ldGFEYXRhIGdldENhY2hlZFF1ZXJ5TWV0YURh\ndGEoQ2xhc3MgY2xzLAogICAgICAgIFN0cmluZyBuYW1lKSB7CiAgICAgICAg\ncmV0dXJuIChRdWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoZ2V0UXVlcnlL\nZXkoY2xzLCBuYW1lKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBu\nZXcgcXVlcnkgbWV0YWRhdGEgdG8gdGhlIHJlcG9zaXRvcnkgYW5kIHJldHVy\nbiBpdC4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBRdWVyeU1l\ndGFEYXRhIGFkZFF1ZXJ5TWV0YURhdGEoQ2xhc3MgY2xzLCBTdHJpbmcgbmFt\nZSkgewogICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IG5ld1F1ZXJ5TWV0\nYURhdGEoY2xzLCBuYW1lKTsKICAgICAgICBfcXVlcmllcy5wdXQoZ2V0UXVl\ncnlLZXkobWV0YSksIG1ldGEpOwogICAgICAgIHJldHVybiBtZXRhOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHF1ZXJ5IG1ldGFkYXRh\nIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgUXVlcnlNZXRhRGF0\nYSBuZXdRdWVyeU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5nIG5hbWUpIHsK\nICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEgPSBuZXcgUXVlcnlNZXRhRGF0\nYShuYW1lKTsKICAgICAgICBtZXRhLnNldERlZmluaW5nVHlwZShjbHMpOwog\nICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBnaXZlbiBxdWVyeSBtZXRhZGF0YSBmcm9tIHRoZSByZXBvc2l0\nb3J5LgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGJvb2xlYW4g\ncmVtb3ZlUXVlcnlNZXRhRGF0YShRdWVyeU1ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgcmV0dXJuIF9xdWVyaWVzLnJlbW92ZShnZXRRdWVyeUtl\neShtZXRhKSkgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSBxdWVyeSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIGNsYXNzIG5hbWUgaWYg\naW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJv\nbml6ZWQgYm9vbGVhbiByZW1vdmVRdWVyeU1ldGFEYXRhKENsYXNzIGNscywg\nU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9xdWVyaWVz\nLnJlbW92ZShnZXRRdWVyeUtleShjbHMsIG5hbWUpKSAhPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgdW5pcXVlIGtleSBmb3IgYSBn\naXZlbiBRdWVyeU1ldGFEYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBPYmplY3QgZ2V0UXVlcnlLZXkoUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIGdldFF1ZXJ5S2V5KG1ldGEuZ2V0RGVmaW5p\nbmdUeXBlKCksIG1ldGEuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhIHVuaXF1ZSBrZXkgZm9yIGEgZ2l2ZW4gY2xhc3MgLyBu\nYW1lLiBUaGUgY2xhc3MKICAgICAqIGFyZ3VtZW50IGNhbiBiZSBudWxsLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIE9iamVjdCBnZXRRdWVyeUtl\neShDbGFzcyBjbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKGNscyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICBRdWVy\neUtleSBrZXkgPSBuZXcgUXVlcnlLZXkoKTsKICAgICAgICBrZXkuY2xzTmFt\nZSA9IGNscy5nZXROYW1lKCk7CiAgICAgICAga2V5Lm5hbWUgPSBuYW1lOwog\nICAgICAgIHJldHVybiBrZXk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBTZXF1ZW5jZSBtZXRhZGF0YQogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gc2VxdWVuY2Ug\nbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lIGFuZCBjbGFzc2xvYWRlci4K\nICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBTZXF1ZW5jZU1ldGFE\nYXRhIGdldFNlcXVlbmNlTWV0YURhdGEoU3RyaW5nIG5hbWUsCiAgICAgICAg\nQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewog\nICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IGdldFNlcXVlbmNlTWV0\nYURhdGFJbnRlcm5hbChuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIGlmICht\nZXRhID09IG51bGwgJiYgU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTS5l\ncXVhbHMobmFtZSkpIHsKICAgICAgICAgICAgaWYgKF9zeXNTZXEgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9zeXNTZXEgPSBuZXdTZXF1ZW5jZU1ldGFE\nYXRhKG5hbWUpOwogICAgICAgICAgICByZXR1cm4gX3N5c1NlcTsKICAgICAg\nICB9CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm8tbmFtZWQtc2VxdWVuY2UiLCBuYW1lKSk7CiAgICAgICAgcmV0dXJu\nIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2VkIGludGVybmFsbHkg\nYnkgbWV0YWRhdGEgdG8gcmV0cmlldmUgc2VxdWVuY2UgbWV0YWRhdGFzIGJh\nc2VkIG9uCiAgICAgKiBwb3NzaWJseS11bnF1YWxpZmllZCBzZXF1ZW5jZSBu\nYW1lLgogICAgICovCiAgICBTZXF1ZW5jZU1ldGFEYXRhIGdldFNlcXVlbmNl\nTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBjb250ZXh0LCBTdHJpbmcgbmFtZSwK\nICAgICAgICBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIC8vIHRyeSB3\naXRoIGdpdmVuIG5hbWUKICAgICAgICBNZXRhRGF0YUV4Y2VwdGlvbiBlID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBTZXF1ZW5jZU1ldGFE\nYXRhIHNlcSA9IGdldFNlcXVlbmNlTWV0YURhdGEobmFtZSwKICAgICAgICAg\nICAgICAgIGNvbnRleHQuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgbXVzdEV4aXN0\nKTsKICAgICAgICAgICAgaWYgKHNlcSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHNlcTsKICAgICAgICB9IGNhdGNoIChNZXRhRGF0YUV4Y2Vw\ndGlvbiBtZGUpIHsKICAgICAgICAgICAgZSA9IG1kZTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGlmIGdpdmVuIG5hbWUgYWxyZWFkeSBmdWxseSBxdWFsaWZp\nZWQsIGdpdmUgdXAKICAgICAgICBpZiAobmFtZS5pbmRleE9mKCcuJykgIT0g\nLTEpIHsKICAgICAgICAgICAgaWYgKGUgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IGU7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgLy8gdHJ5IHdpdGggcXVhbGlmaWVkIG5hbWUKICAgICAg\nICBuYW1lID0gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZShjb250ZXh0LmdldERl\nc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgKyAiLiIgKyBuYW1lOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZU1ldGFE\nYXRhKG5hbWUsIGNvbnRleHQuZ2V0RW52Q2xhc3NMb2FkZXIoKSwKICAgICAg\nICAgICAgICAgIG11c3RFeGlzdCk7CiAgICAgICAgfSBjYXRjaCAoTWV0YURh\ndGFFeGNlcHRpb24gbWRlKSB7CiAgICAgICAgICAgIC8vIHRocm93IG9yaWdp\nbmFsIGV4Y2VwdGlvbgogICAgICAgICAgICBpZiAoZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgdGhyb3cgbWRlOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBzZXF1ZW5j\nZSBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUgYW5kIGNsYXNzbG9hZGVy\nLgogICAgICovCiAgICBwcml2YXRlIFNlcXVlbmNlTWV0YURhdGEgZ2V0U2Vx\ndWVuY2VNZXRhRGF0YUludGVybmFsKFN0cmluZyBuYW1lLAogICAgICAgIENs\nYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChuYW1lID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBjaGVj\nayBjYWNoZQogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IChTZXF1\nZW5jZU1ldGFEYXRhKSBfc2Vxcy5nZXQobmFtZSk7CiAgICAgICAgaWYgKG1l\ndGEgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBsb2FkIG1ldGFkYXRhIGZv\nciByZWdpc3RlcmVkIGNsYXNzZXMgdG8gaG9wZWZ1bGx5IGZpbmQgc2VxdWVu\nY2UKICAgICAgICAgICAgLy8gZGVmaW5pdGlvbgogICAgICAgICAgICBsb2Fk\nUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEoZW52TG9hZGVyKTsKICAgICAgICAg\nICAgbWV0YSA9IChTZXF1ZW5jZU1ldGFEYXRhKSBfc2Vxcy5nZXQobmFtZSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBjYWNoZWQgc2VxdWVuY2UgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgU2VxdWVuY2VNZXRh\nRGF0YVtdIGdldFNlcXVlbmNlTWV0YURhdGFzKCkgewogICAgICAgIHJldHVy\nbiAoU2VxdWVuY2VNZXRhRGF0YVtdKSBfc2Vxcy52YWx1ZXMoKS50b0FycmF5\nCiAgICAgICAgICAgIChuZXcgU2VxdWVuY2VNZXRhRGF0YVtfc2Vxcy5zaXpl\nKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVk\nIGEgc2VxdWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAg\nICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFNlcXVlbmNlTWV0YURhdGEg\nZ2V0Q2FjaGVkU2VxdWVuY2VNZXRhRGF0YSgKICAgICAgICBTdHJpbmcgbmFt\nZSkgewogICAgICAgIHJldHVybiAoU2VxdWVuY2VNZXRhRGF0YSkgX3NlcXMu\nZ2V0KG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IHNl\ncXVlbmNlIG1ldGFkYXRhIHRvIHRoZSByZXBvc2l0b3J5IGFuZCByZXR1cm4g\naXQuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgU2VxdWVuY2VN\nZXRhRGF0YSBhZGRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gbmV3U2VxdWVuY2VNZXRh\nRGF0YShuYW1lKTsKICAgICAgICBfc2Vxcy5wdXQobmFtZSwgbWV0YSk7CiAg\nICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBuZXcgc2VxdWVuY2UgbWV0YWRhdGEgaW5zdGFuY2UuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTZXF1ZW5jZU1ldGFEYXRhIG5ld1NlcXVlbmNlTWV0\nYURhdGEoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFNlcXVl\nbmNlTWV0YURhdGEobmFtZSwgdGhpcyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgdGhlIGdpdmVuIHNlcXVlbmNlIG1ldGFkYXRhIGZyb20gdGhl\nIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQg\nYm9vbGVhbiByZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURh\ndGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX3NlcXMucmVtb3Zl\nKG1ldGEuZ2V0TmFtZSgpKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVtb3ZlIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUgbmFtZSBpZiBp\nbiB0aGUgcmVwb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCBib29sZWFuIHJlbW92ZVNlcXVlbmNlTWV0YURhdGEoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBpZiAobmFtZSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9zZXFzLnJlbW92ZShuYW1l\nKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZl\nbiBzeXN0ZW0gbGlmZWN5Y2xlIGxpc3RlbmVyLgogICAgICovCiAgICBwdWJs\naWMgc3luY2hyb25pemVkIHZvaWQgYWRkU3lzdGVtTGlzdGVuZXIoT2JqZWN0\nIGxpc3RlbmVyKSB7CiAgICAgICAgLy8gY29weSB0byBhdm9pZCBpc3N1ZXMg\nd2l0aCBMaXN0ZW5lckxpc3QgYW5kIGF2b2lkIHVubmNlc3NhcnkKICAgICAg\nICAvLyBsb2NraW5nIG9uIHRoZSBsaXN0IGR1cmluZyBydW50aW1lCiAgICAg\nICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBsaXN0ZW5l\ncnMgPSBuZXcKICAgICAgICAgICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxp\nc3RlbmVyTGlzdChfbGlzdGVuZXJzKTsKICAgICAgICBsaXN0ZW5lcnMuYWRk\nKGxpc3RlbmVyKTsKICAgICAgICBfbGlzdGVuZXJzID0gbGlzdGVuZXJzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzeXN0ZW0g\nbGlmZWN5Y2xlIGxpc3RlbmVyLgogICAgICovCiAgICBwdWJsaWMgc3luY2hy\nb25pemVkIGJvb2xlYW4gcmVtb3ZlU3lzdGVtTGlzdGVuZXIoT2JqZWN0IGxp\nc3RlbmVyKSB7CiAgICAgICAgaWYgKCFfbGlzdGVuZXJzLmNvbnRhaW5zKGxp\nc3RlbmVyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAv\nLyBjb3B5IHRvIGF2b2lkIGlzc3VlcyB3aXRoIExpc3RlbmVyTGlzdCBhbmQg\nYXZvaWQgdW5uY2Vzc2FyeQogICAgICAgIC8vIGxvY2tpbmcgb24gdGhlIGxp\nc3QgZHVyaW5nIHJ1bnRpbWUKICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFn\nZXIuTGlzdGVuZXJMaXN0IGxpc3RlbmVycyA9IG5ldwogICAgICAgICAgICBM\naWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KF9saXN0ZW5lcnMp\nOwogICAgICAgIGxpc3RlbmVycy5yZW1vdmUobGlzdGVuZXIpOwogICAgICAg\nIF9saXN0ZW5lcnMgPSBsaXN0ZW5lcnM7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHN5c3RlbSBsaWZl\nY3ljbGUgbGlzdGVuZXJzCiAgICAgKi8KICAgIHB1YmxpYyBMaWZlY3ljbGVF\ndmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0IGdldFN5c3RlbUxpc3RlbmVycygp\nIHsKICAgICAgICByZXR1cm4gX2xpc3RlbmVyczsKICAgIH0KCiAgICAvKioK\nICAgICAqIEZyZWUgdGhlIHJlc291cmNlcyB1c2VkIGJ5IHRoaXMgcmVwb3Np\ndG9yeS4gQ2xvc2VzIGFsbCB1c2VyIHNlcXVlbmNlcy4KICAgICAqLwogICAg\ncHVibGljIHN5bmNocm9uaXplZCB2b2lkIGNsb3NlKCkgewogICAgICAgIFNl\ncXVlbmNlTWV0YURhdGFbXSBzbWRzID0gZ2V0U2VxdWVuY2VNZXRhRGF0YXMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNtZHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIHNtZHNbaV0uY2xvc2UoKTsKICAgICAgICBjbGVh\ncigpOwogICAgfQoKICAgIC8qKgogICAgICogUXVlcnkga2V5IHN0cnVjdC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUXVlcnlLZXkgewoK\nICAgICAgICBwdWJsaWMgU3RyaW5nIGNsc05hbWU7CiAgICAgICAgcHVibGlj\nIFN0cmluZyBuYW1lOwoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkg\newogICAgICAgICAgICBpbnQgY2xzSGFzaCA9IChjbHNOYW1lID09IG51bGwp\nID8gMCA6IGNsc05hbWUuaGFzaENvZGUoKTsKICAgICAgICAgICAgaW50IG5h\nbWVIYXNoID0gKG5hbWUgPT0gbnVsbCkgPyAwIDogbmFtZS5oYXNoQ29kZSgp\nOwogICAgICAgICAgICByZXR1cm4gY2xzSGFzaCArIG5hbWVIYXNoOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\nYmopCgkJewoJCQlpZiAob2JqID09IHRoaXMpCgkJCQlyZXR1cm4gdHJ1ZTsK\nCQkJaWYgKCEob2JqIGluc3RhbmNlb2YgUXVlcnlLZXkpKQoJCQkJcmV0dXJu\nIGZhbHNlOwoJCQoJCQlRdWVyeUtleSBxayA9IChRdWVyeUtleSkgb2JqOwoJ\nCQlyZXR1cm4gU3RyaW5nVXRpbHMuZXF1YWxzIChjbHNOYW1lLCBxay5jbHNO\nYW1lKQoJCQkJJiYgU3RyaW5nVXRpbHMuZXF1YWxzIChuYW1lLCBxay5uYW1l\nKTsJCgkJfQoJfQp9Cg==\n","encoding":"base64"}

