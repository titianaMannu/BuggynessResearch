{"sha":"12a25ebe94f70fbd38b88f463eaa217b3cccb43c","node_id":"MDQ6QmxvYjIwNjM2NDoxMmEyNWViZTk0ZjcwZmJkMzhiODhmNDYzZWFhMjE3YjNjY2NiNDNj","size":14546,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/12a25ebe94f70fbd38b88f463eaa217b3cccb43c","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhOwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogRGVmYXVsdCB7QGxpbmsg\nVmFsdWVNZXRhRGF0YX0gaW1wbGVtZW50YXRpb24uCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBWYWx1\nZU1ldGFEYXRhSW1wbAogICAgaW1wbGVtZW50cyBWYWx1ZU1ldGFEYXRhIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFZhbHVlTWV0YURhdGFJbXBs\nLmNsYXNzKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE5vdGU6\nIGlmIHlvdSBhZGQgYWRkaXRpb25hbCBzdGF0ZSB0aGF0IHNob3VsZCBiZSBj\nb3BpZWQgdG8KICAgIC8vIGVtYmVkZGVkIG1ldGFkYXRhLCBtYWtlIHN1cmUg\ndG8gYWRkIGl0IHRvIHRoZSBjb3B5KCkgbWV0aG9kCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICBwcml2YXRlIGZpbmFsIEZpZWxkTWV0YURhdGEgX293\nbmVyOwogICAgcHJpdmF0ZSBDbGFzcyBfZGVjVHlwZSA9IE9iamVjdC5jbGFz\nczsKICAgIHByaXZhdGUgaW50IF9kZWNDb2RlID0gSmF2YVR5cGVzLk9CSkVD\nVDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBfZGVjVHlwZU1ldGEgPSBu\ndWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfdHlwZSA9IG51bGw7CiAgICBwcml2\nYXRlIGludCBfY29kZSA9IEphdmFUeXBlcy5PQkpFQ1Q7CiAgICBwcml2YXRl\nIENsYXNzTWV0YURhdGEgX3R5cGVNZXRhID0gbnVsbDsKICAgIHByaXZhdGUg\nQ2xhc3MgX3R5cGVPdmVycmlkZSA9IG51bGw7CiAgICBwcml2YXRlIGludCBf\nZGVsZXRlID0gQ0FTQ0FERV9OT05FOwogICAgcHJpdmF0ZSBpbnQgX3BlcnNp\nc3QgPSBDQVNDQURFX0FVVE87CiAgICBwcml2YXRlIGludCBfYXR0YWNoID0g\nQ0FTQ0FERV9JTU1FRElBVEU7CiAgICBwcml2YXRlIGludCBfcmVmcmVzaCA9\nIENBU0NBREVfQVVUTzsKICAgIHByaXZhdGUgYm9vbGVhbiBfc2VyaWFsaXpl\nZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBCb29sZWFuIF9lbWJlZGRlZCA9IG51\nbGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgX2VtYmVkZGVkTWV0YSA9\nIG51bGw7CiAgICBwcml2YXRlIGludCBfcmVzTW9kZSA9IE1PREVfTk9ORTsK\nICAgIHByaXZhdGUgU3RyaW5nIF9tYXBwZWRCeSA9IG51bGw7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGEgX21hcHBlZEJ5TWV0YSA9IG51bGw7CgogICAg\ncHJvdGVjdGVkIFZhbHVlTWV0YURhdGFJbXBsKEZpZWxkTWV0YURhdGEgb3du\nZXIpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsKICAgIH0KCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YSBnZXRGaWVsZE1ldGFEYXRhKCkgewogICAgICAg\nIHJldHVybiBfb3duZXI7CiAgICB9CgogICAgcHVibGljIE1ldGFEYXRhUmVw\nb3NpdG9yeSBnZXRSZXBvc2l0b3J5KCkgewogICAgICAgIHJldHVybiBfb3du\nZXIuZ2V0UmVwb3NpdG9yeSgpOwogICAgfQoKICAgIHB1YmxpYyBDbGFzcyBn\nZXRUeXBlKCkgewogICAgICAgIHJldHVybiAoX3R5cGUgPT0gbnVsbCkgPyBf\nZGVjVHlwZSA6IF90eXBlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFR5\ncGUoQ2xhc3MgdHlwZSkgewogICAgICAgIF90eXBlID0gdHlwZTsKICAgICAg\nICBfdHlwZU1ldGEgPSBudWxsOwogICAgICAgIGlmICh0eXBlICE9IG51bGwp\nCiAgICAgICAgICAgIHNldFR5cGVDb2RlKEphdmFUeXBlcy5nZXRUeXBlQ29k\nZSh0eXBlKSk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRUeXBlQ29kZSgp\nIHsKICAgICAgICByZXR1cm4gKF90eXBlID09IG51bGwpID8gX2RlY0NvZGUg\nOiBfY29kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlQ29kZShp\nbnQgY29kZSkgewogICAgICAgIF9jb2RlID0gY29kZTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1R5cGVQQygpIHsKICAgICAgICByZXR1cm4gZ2V0\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMKICAgICAgICAgICAgfHwgZ2V0\nVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUENfVU5UWVBFRDsKICAgIH0KCiAg\nICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRUeXBlTWV0YURhdGEoKSB7CiAg\nICAgICAgaWYgKF90eXBlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBn\nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAgIGlmIChfdHlwZU1l\ndGEgPT0gbnVsbCAmJiBfY29kZSA9PSBKYXZhVHlwZXMuUEMpIHsKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX293bmVyLmdldERlZmluaW5n\nTWV0YURhdGEoKTsKICAgICAgICAgICAgX3R5cGVNZXRhID0gbWV0YS5nZXRS\nZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGEoX3R5cGUsCiAgICAgICAgICAgICAg\nICBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX3R5cGVNZXRhOwogICAgfQoKICAgIHB1YmxpYyBD\nbGFzcyBnZXREZWNsYXJlZFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9kZWNU\neXBlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldERlY2xhcmVkVHlwZShD\nbGFzcyB0eXBlKSB7CiAgICAgICAgX2RlY1R5cGUgPSB0eXBlOwogICAgICAg\nIF9kZWNUeXBlTWV0YSA9IG51bGw7CiAgICAgICAgX2RlY0NvZGUgPSBKYXZh\nVHlwZXMuZ2V0VHlwZUNvZGUodHlwZSk7CiAgICAgICAgaWYgKF9lbWJlZGRl\nZE1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgX2VtYmVkZGVkTWV0YS5zZXRE\nZXNjcmliZWRUeXBlKHR5cGUpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpIHsKICAgICAgICByZXR1cm4gX2RlY0NvZGU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGVjbGFyZWRUeXBlQ29kZShp\nbnQgY29kZSkgewogICAgICAgIF9kZWNDb2RlID0gY29kZTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0RlY2xhcmVkVHlwZVBDKCkgewogICAgICAg\nIHJldHVybiBfZGVjQ29kZSA9PSBKYXZhVHlwZXMuUEMgfHwgX2RlY0NvZGUg\nPT0gSmF2YVR5cGVzLlBDX1VOVFlQRUQ7CiAgICB9CgogICAgcHVibGljIENs\nYXNzTWV0YURhdGEgZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKSB7CiAgICAg\nICAgaWYgKF9kZWNUeXBlTWV0YSA9PSBudWxsICYmIF9kZWNDb2RlID09IEph\ndmFUeXBlcy5QQykgewogICAgICAgICAgICBpZiAoaXNFbWJlZGRlZCgpKQog\nICAgICAgICAgICAgICAgX2RlY1R5cGVNZXRhID0gZ2V0RW1iZWRkZWRNZXRh\nRGF0YSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IF9vd25lci5nZXREZWZpbmluZ01ldGFEYXRh\nKCk7CiAgICAgICAgICAgICAgICBfZGVjVHlwZU1ldGEgPSBtZXRhLmdldFJl\ncG9zaXRvcnkoKS5nZXRNZXRhRGF0YShfZGVjVHlwZSwKICAgICAgICAgICAg\nICAgICAgICBtZXRhLmdldEVudkNsYXNzTG9hZGVyKCksIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZGVjVHlwZU1l\ndGE7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNFbWJlZGRlZCgpIHsK\nICAgICAgICBpZiAoX293bmVyLmdldE1hbmFnZW1lbnQoKSAhPSBfb3duZXIu\nTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICBpZiAoX2VtYmVkZGVkID09IG51bGwpIHsKICAgICAgICAgICAg\nLy8gZmllbGQgbGVmdCBhcyBkZWZhdWx0OyBlbWJlZGRlZCBzZXR0aW5nIGRl\ncGVuZHMgb24gdHlwZQogICAgICAgICAgICBzd2l0Y2ggKF9kZWNDb2RlKSB7\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgICAgIF9l\nbWJlZGRlZCA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2VtYmVkZGVkLmJvb2xlYW5W\nYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEVtYmVkZGVkKGJv\nb2xlYW4gZW1iZWRkZWQpIHsKICAgICAgICBpZiAoZW1iZWRkZWQgJiYgX2Vt\nYmVkZGVkICE9IEJvb2xlYW4uVFJVRSkgewogICAgICAgICAgICBfZGVjVHlw\nZU1ldGEgPSBudWxsOwogICAgICAgICAgICBfdHlwZU1ldGEgPSBudWxsOwog\nICAgICAgIH0KICAgICAgICBfZW1iZWRkZWQgPSAoZW1iZWRkZWQpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0VtYmVkZGVkUEMoKSB7CiAgICAgICAgcmV0dXJuIF9kZWND\nb2RlID09IEphdmFUeXBlcy5QQyAmJiBpc0VtYmVkZGVkKCk7CiAgICB9Cgog\nICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0RW1iZWRkZWRNZXRhRGF0YSgp\nIHsKICAgICAgICBpZiAoX2VtYmVkZGVkTWV0YSA9PSBudWxsICYmIGlzRW1i\nZWRkZWRQQygpKQogICAgICAgICAgICBhZGRFbWJlZGRlZE1ldGFEYXRhKCk7\nCiAgICAgICAgcmV0dXJuIF9lbWJlZGRlZE1ldGE7CiAgICB9CgogICAgcHVi\nbGljIENsYXNzTWV0YURhdGEgYWRkRW1iZWRkZWRNZXRhRGF0YSgpIHsKICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfb3duZXIuZ2V0UmVw\nb3NpdG9yeSgpOwogICAgICAgIF9lbWJlZGRlZE1ldGEgPSByZXBvcy5uZXdF\nbWJlZGRlZENsYXNzTWV0YURhdGEodGhpcyk7CiAgICAgICAgX2VtYmVkZGVk\nTWV0YS5zZXREZXNjcmliZWRUeXBlKF9kZWNUeXBlKTsKICAgICAgICByZXBv\ncy5nZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLnBvcHVsYXRl\nKF9lbWJlZGRlZE1ldGEsCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEuQUND\nRVNTX1VOS05PV04pOwoKICAgICAgICBzZXRFbWJlZGRlZCh0cnVlKTsKICAg\nICAgICByZXR1cm4gX2VtYmVkZGVkTWV0YTsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldENhc2NhZGVEZWxldGUoKSB7CiAgICAgICAgaWYgKF9vd25lci5n\nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgcmV0dXJuIENBU0NBREVfTk9ORTsKICAgICAg\nICBpZiAoaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgIHJldHVybiBDQVND\nQURFX0lNTUVESUFURTsKCiAgICAgICAgc3dpdGNoIChfZGVsZXRlKSB7CiAg\nICAgICAgICAgIGNhc2UgQ0FTQ0FERV9OT05FOgogICAgICAgICAgICAgICAg\nLy8gaWYgdGhlIHVzZXIgbWFya3MgdGhlIG93bmluZyBmaWVsZCBkZXBlbmRl\nbnQgYW5kIHdlIGV4dGVybmFsaXplCiAgICAgICAgICAgICAgICAvLyB0byBh\nIHBjIHR5cGUsIHRoZW4gYmVjb21lIGRlcGVuZGVudAogICAgICAgICAgICAg\nICAgaWYgKHRoaXMgIT0gX293bmVyLmdldFZhbHVlKCkgJiYgaXNUeXBlUEMo\nKQogICAgICAgICAgICAgICAgICAgICYmICgoVmFsdWVNZXRhRGF0YUltcGwp\nIF9vd25lci5nZXRWYWx1ZSgpKS5fZGVsZXRlCiAgICAgICAgICAgICAgICAg\nICAgPT0gQ0FTQ0FERV9BVVRPKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBDQVNDQURFX0FVVE87CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBDQVNDQURFX0FVVE86CiAgICAgICAgICAgICAgICBpZiAo\naXNUeXBlUEMoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ0FTQ0FE\nRV9BVVRPOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgQ0FTQ0FERV9JTU1FRElBVEU6CiAgICAgICAgICAgICAgICBpZiAoaXNE\nZWNsYXJlZFR5cGVQQygpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBD\nQVNDQURFX0lNTUVESUFURTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gQ0FTQ0FERV9OT05FOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldENhc2NhZGVEZWxldGUoaW50IGRlbGV0ZSkgewog\nICAgICAgIF9kZWxldGUgPSBkZWxldGU7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRDYXNjYWRlUGVyc2lzdCgpIHsKICAgICAgICBpZiAoX293bmVyLmdl\ndE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNU\nRU5UKQogICAgICAgICAgICByZXR1cm4gQ0FTQ0FERV9OT05FOwogICAgICAg\nIGlmIChpc0RlY2xhcmVkVHlwZVBDKCkpCiAgICAgICAgICAgIHJldHVybiBf\ncGVyc2lzdDsKICAgICAgICBpZiAoIWlzVHlwZVBDKCkpCiAgICAgICAgICAg\nIHJldHVybiBDQVNDQURFX05PTkU7CiAgICAgICAgLy8gaWYgb25seSBleHRl\ncm5hbGl6ZWQgdHlwZSBpcyBwYywgY2FuJ3QgY2FzY2FkZSBpbW1lZGlhdGUK\nICAgICAgICByZXR1cm4gKF9wZXJzaXN0ID09IENBU0NBREVfSU1NRURJQVRF\nKSA/IENBU0NBREVfQVVUTyA6IF9wZXJzaXN0OwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldENhc2NhZGVQZXJzaXN0KGludCBwZXJzaXN0KSB7CiAgICAg\nICAgX3BlcnNpc3QgPSBwZXJzaXN0OwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0Q2FzY2FkZUF0dGFjaCgpIHsKICAgICAgICBpZiAoX293bmVyLmdldE1h\nbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5U\nCiAgICAgICAgICAgIHx8ICFpc0RlY2xhcmVkVHlwZVBDKCkpIC8vIGF0dGFj\naCBhY3RzIG9uIGRlY2xhcmVkIHR5cGUKICAgICAgICAgICAgcmV0dXJuIENB\nU0NBREVfTk9ORTsKICAgICAgICByZXR1cm4gX2F0dGFjaDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRDYXNjYWRlQXR0YWNoKGludCBhdHRhY2gpIHsK\nICAgICAgICBpZiAoYXR0YWNoID09IENBU0NBREVfQVVUTykKICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiQ0FTQ0FE\nRV9BVVRPIik7CiAgICAgICAgX2F0dGFjaCA9IGF0dGFjaDsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldENhc2NhZGVSZWZyZXNoKCkgewogICAgICAgIGlm\nIChfb3duZXIuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFO\nQUdFX1BFUlNJU1RFTlQKICAgICAgICAgICAgfHwgIWlzRGVjbGFyZWRUeXBl\nUEMoKSkgLy8gcmVmcmVzaCBhY3RzIG9uIGRlY2xhcmVkIHR5cGUKICAgICAg\nICAgICAgcmV0dXJuIENBU0NBREVfTk9ORTsKICAgICAgICByZXR1cm4gX3Jl\nZnJlc2g7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FzY2FkZVJlZnJl\nc2goaW50IHJlZnJlc2gpIHsKICAgICAgICBfcmVmcmVzaCA9IHJlZnJlc2g7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNTZXJpYWxpemVkKCkgewog\nICAgICAgIHJldHVybiBfc2VyaWFsaXplZDsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRTZXJpYWxpemVkKGJvb2xlYW4gc2VyaWFsaXplZCkgewogICAg\nICAgIF9zZXJpYWxpemVkID0gc2VyaWFsaXplZDsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIGdldFZhbHVlTWFwcGVkQnkoKSB7CiAgICAgICAgaWYgKF9t\nYXBwZWRCeSA9PSBNQVBQRURfQllfUEspIHsKICAgICAgICAgICAgLy8gdXNl\nIHRoaXMgaW5zdGVhZCBvZiBnZXR0aW5nIG1ldGEgZnJvbSBlbGVtZW50IGIv\nYyB0aGF0CiAgICAgICAgICAgIC8vIHJlcXVpcmVzIGVsZW1lbnQgdG8gYmUg\ncmVzb2x2ZWQKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0\nUmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhCiAgICAgICAgICAgICAgICAoX293\nbmVyLmdldEVsZW1lbnQoKS5nZXRUeXBlKCksIG51bGwsIGZhbHNlKTsKICAg\nICAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidmFsLW5vdC1w\nYyIsIF9vd25lcikpOwogICAgICAgICAgICBpZiAobWV0YS5nZXRQcmltYXJ5\nS2V5RmllbGRzKCkubGVuZ3RoICE9IDEpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInZhbC1ub3Qtb25l\nLXBrIiwKICAgICAgICAgICAgICAgICAgICBfb3duZXIpKTsKICAgICAgICAg\nICAgX21hcHBlZEJ5TWV0YSA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygp\nWzBdOwogICAgICAgICAgICBfbWFwcGVkQnkgPSBfbWFwcGVkQnlNZXRhLmdl\ndE5hbWUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9tYXBwZWRCeTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWYWx1ZU1hcHBlZEJ5KFN0cmlu\nZyBtYXBwZWQpIHsKICAgICAgICBpZiAoX293bmVyLmdldEtleSgpICE9IHRo\naXMgJiYgbWFwcGVkICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYXBwZWQtYnktbm90LWtleSIsIHRo\naXMpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgX21hcHBlZEJ5ID0g\nbWFwcGVkOwogICAgICAgICAgICBfbWFwcGVkQnlNZXRhID0gbnVsbDsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0VmFs\ndWVNYXBwZWRCeU1ldGFEYXRhKCkgewogICAgICAgIGlmIChnZXRWYWx1ZU1h\ncHBlZEJ5KCkgIT0gbnVsbCAmJiBfbWFwcGVkQnlNZXRhID09IG51bGwpIHsK\nICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gX293bmVyLmdldEVs\nZW1lbnQoKS5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YSBmaWVsZCA9IChtZXRhID09IG51bGwpID8gbnVsbAogICAgICAg\nICAgICAgICAgOiBtZXRhLmdldEZpZWxkKGdldFZhbHVlTWFwcGVkQnkoKSk7\nCiAgICAgICAgICAgIGlmIChmaWVsZCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1t\nYXBwZWQtYnkiLCB0aGlzLAogICAgICAgICAgICAgICAgICAgIGdldFZhbHVl\nTWFwcGVkQnkoKSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFE\nYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJjaXJjLW1hcHBlZC1ieSIsIHRoaXMs\nCiAgICAgICAgICAgICAgICAgICAgZ2V0VmFsdWVNYXBwZWRCeSgpKSk7CiAg\nICAgICAgICAgIF9tYXBwZWRCeU1ldGEgPSBmaWVsZDsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9tYXBwZWRCeU1ldGE7CiAgICB9CgogICAgcHVibGlj\nIENsYXNzIGdldFR5cGVPdmVycmlkZSgpIHsKICAgICAgICByZXR1cm4gX3R5\ncGVPdmVycmlkZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlT3Zl\ncnJpZGUoQ2xhc3MgdmFsKSB7CiAgICAgICAgX3R5cGVPdmVycmlkZSA9IHZh\nbDsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAg\nICAgIFN0cmluZyByZXQgPSBfb3duZXIuZ2V0RnVsbE5hbWUodHJ1ZSk7CiAg\nICAgICAgaWYgKHRoaXMgPT0gX293bmVyLmdldEtleSgpKQogICAgICAgICAg\nICByZXR1cm4gcmV0ICsgIjxrZXk6IiArIF9kZWNUeXBlICsgIj4iOwogICAg\nICAgIGlmICh0aGlzID09IF9vd25lci5nZXRFbGVtZW50KCkpIHsKICAgICAg\nICAgICAgaWYgKF9vd25lci5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5N\nQVApCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0ICsgIjx2YWx1ZToiICsg\nX2RlY1R5cGUgKyAiPiI7CiAgICAgICAgICAgIHJldHVybiByZXQgKyAiPGVs\nZW1lbnQ6IiArIF9kZWNUeXBlICsgIj4iOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmV0ICsgIjwiICsgX2RlY1R5cGUgKyAiPiI7CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZXNvbHZlIGFuZCB2\nYWxpZGF0ZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVi\nbGljIGludCBnZXRSZXNvbHZlKCkgewogICAgICAgIHJldHVybiBfcmVzTW9k\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2Rl\nKSB7CiAgICAgICAgX3Jlc01vZGUgPSBtb2RlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldFJlc29sdmUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAg\nICAgICBpZiAobW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIF9yZXNN\nb2RlID0gbW9kZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAg\nX3Jlc01vZGUgfD0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9y\nZXNNb2RlICY9IH5tb2RlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJl\nc29sdmUoaW50IG1vZGUpIHsKICAgICAgICBpZiAoKF9yZXNNb2RlICYgbW9k\nZSkgPT0gbW9kZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\naW50IGN1ciA9IF9yZXNNb2RlOwogICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7\nCgogICAgICAgIC8vIHdlIG9ubHkgcGVyZm9ybSBhY3Rpb25zIGZvciBtZXRh\nIG1vZGUKICAgICAgICBpZiAoKG1vZGUgJiBNT0RFX01FVEEpID09IDAgfHwg\nKGN1ciAmIE1PREVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICAvLyBjaGVjayBmb3IgdHlwZSBleHRlbnNpb24KICAg\nICAgICBpbnQgY29kZU92ZXJyaWRlID0gSmF2YVR5cGVzLk9CSkVDVDsKICAg\nICAgICBpZiAoX3R5cGVPdmVycmlkZSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGNvZGVPdmVycmlkZSA9IEphdmFUeXBlcy5nZXRUeXBlQ29kZShfdHlwZU92\nZXJyaWRlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGV4dGVy\nbmFsaXplciBtZXRob2Qgb3IgdGhpcyB2YWx1ZSBpcyBhIGtleSBvcgogICAg\nICAgICAgICAvLyBlbGVtZW50LCBzZXQgb3VyIHR5cGUgdG8gdGhlIHR5cGUg\nZXh0ZW5zaW9uOyBvdGhlcndpc2UsIHVzZSB0aGUKICAgICAgICAgICAgLy8g\ndHlwZSBleHRlbnNpb24gYXMgYSBoaW50IHRvIHRoZSBhY3R1YWwgdHlwZSBv\nZiB0aGUgZGVjbGFyZWQKICAgICAgICAgICAgLy8gdmFsdWUgKGUuZy4gbWFy\na2luZyBhbiBpbnRlcmZhY2UgYXMgbm9uLXBjKQogICAgICAgICAgICBpZiAo\nX293bmVyLmdldEV4dGVybmFsaXplck1ldGhvZCgpID09IG51bGwKICAgICAg\nICAgICAgICAgIHx8IF9vd25lci5nZXRWYWx1ZSgpICE9IHRoaXMpIHsKICAg\nICAgICAgICAgICAgIF90eXBlID0gX3R5cGVPdmVycmlkZTsKICAgICAgICAg\nICAgICAgIF9jb2RlID0gY29kZU92ZXJyaWRlOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgX2RlY0NvZGUgPSBjb2RlT3ZlcnJpZGU7\nCiAgICAgICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJlUEMoY29kZU92\nZXJyaWRlLCBfdHlwZU92ZXJyaWRlKSkKICAgICAgICAgICAgICAgICAgICBy\nZXNvbHZlRGVjbGFyZWRUeXBlKF90eXBlT3ZlcnJpZGUpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyBzZWUgaWYgYWN0dWFsIHR5cGUg\naXMgcGMKICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJlUEMoX2NvZGUsIF90\neXBlKSkgewogICAgICAgICAgICBfdHlwZU1ldGEgPSBfb3duZXIuZ2V0UmVw\nb3NpdG9yeSgpLmdldE1ldGFEYXRhKF90eXBlLAogICAgICAgICAgICAgICAg\nX293bmVyLmdldERlZmluaW5nTWV0YURhdGEoKS5nZXRFbnZDbGFzc0xvYWRl\ncigpLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChfdHlwZU1ldGEgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9jb2RlID0gSmF2YVR5cGVzLlBDOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gZXh0ZXJuYWxpemVy\nLCBzZXQgb3VyIGRlY2xhcmVkIHR5cGUgY29kZSB0byB0aGUKICAgICAgICAv\nLyBhY3R1YWwgdHlwZSBzbyB0aGF0IHdlIHRyZWF0IHRoZSB2YWx1ZSBjb3Jy\nZWN0bHkgYXQgcnVudGltZQogICAgICAgIC8vIChwZXJzIGJ5IHJlYWNoLCBl\ndGMpCiAgICAgICAgaWYgKF90eXBlT3ZlcnJpZGUgIT0gbnVsbCAmJiBfb3du\nZXIuZ2V0RXh0ZXJuYWxpemVyTWV0aG9kKCkgPT0gbnVsbAogICAgICAgICAg\nICAmJiBfb3duZXIuZ2V0RXh0ZXJuYWxWYWx1ZXMoKSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIC8vIGNhY2hlIHRoZSBtZXRhZGF0YSBpbW1lZGlhdGVseSBz\naW5jZSB3ZSB3b24ndCBiZSBhYmxlIHRvIGdldAogICAgICAgICAgICAvLyBp\ndCBsYXppbHksIHNpbmNlIHdlJ3JlIG5vdCByZXNldHRpbmcgX2RlY1R5cGUg\ndG8gX3R5cGUKICAgICAgICAgICAgX2RlY0NvZGUgPSBfY29kZTsKICAgICAg\nICAgICAgX2RlY1R5cGVNZXRhID0gX3R5cGVNZXRhOwogICAgICAgIH0gZWxz\nZSBpZiAoSmF2YVR5cGVzLm1heWJlUEMoX2RlY0NvZGUsIF9kZWNUeXBlKSkK\nICAgICAgICAgICAgcmVzb2x2ZURlY2xhcmVkVHlwZShfZGVjVHlwZSk7Cgog\nICAgICAgIC8vIHJlc29sdmVzIG1hcHBlZCBieQogICAgICAgIGdldFZhbHVl\nTWFwcGVkQnkoKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IGdl\ndEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICBpZiAoZW1iZWQgIT0gbnVs\nbCkKICAgICAgICAgICAgZW1iZWQucmVzb2x2ZShNT0RFX01FVEEpOwoKICAg\nICAgICAvLyBvaWQgYXMgcHJpbWFyeSBrZXkgZmllbGQ/CiAgICAgICAgaWYg\nKF9kZWNDb2RlID09IEphdmFUeXBlcy5QQyAmJiBpc0VtYmVkZGVkKCkKICAg\nICAgICAgICAgJiYgX293bmVyLmlzUHJpbWFyeUtleSgpICYmIF9vd25lci5n\nZXRWYWx1ZSgpID09IHRoaXMpCiAgICAgICAgICAgIF9jb2RlID0gX2RlY0Nv\nZGUgPSBKYXZhVHlwZXMuT0lEOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlIHRoZSBkZWNsYXJlZCB0eXBl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZURlY2xhcmVkVHlw\nZShDbGFzcyB0eXBlKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nX293bmVyLmdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YSh0eXBlLAogICAg\nICAgICAgICBfb3duZXIuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmdldEVudkNs\nYXNzTG9hZGVyKCksIGZhbHNlKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxs\nKQogICAgICAgICAgICBfZGVjQ29kZSA9IEphdmFUeXBlcy5QQzsKICAgICAg\nICBpZiAoIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgX2RlY1R5cGVNZXRh\nID0gbWV0YTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb3B5KFZhbHVlTWV0\nYURhdGEgdm1kKSB7CiAgICAgICAgX2RlY1R5cGUgPSB2bWQuZ2V0RGVjbGFy\nZWRUeXBlKCk7CiAgICAgICAgX2RlY0NvZGUgPSB2bWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpOwogICAgICAgIF9kZWxldGUgPSB2bWQuZ2V0Q2FzY2FkZURl\nbGV0ZSgpOwogICAgICAgIF9wZXJzaXN0ID0gdm1kLmdldENhc2NhZGVQZXJz\naXN0KCk7CiAgICAgICAgX2F0dGFjaCA9IHZtZC5nZXRDYXNjYWRlQXR0YWNo\nKCk7CiAgICAgICAgX3JlZnJlc2ggPSB2bWQuZ2V0Q2FzY2FkZVJlZnJlc2go\nKTsKICAgICAgICBfdHlwZU92ZXJyaWRlID0gdm1kLmdldFR5cGVPdmVycmlk\nZSgpOwogICAgICAgIF9zZXJpYWxpemVkID0gdm1kLmlzU2VyaWFsaXplZCgp\nOwogICAgICAgIGlmIChfZW1iZWRkZWRNZXRhICE9IG51bGwpCiAgICAgICAg\nICAgIF9lbWJlZGRlZE1ldGEuc2V0RGVzY3JpYmVkVHlwZSh2bWQuZ2V0RGVj\nbGFyZWRUeXBlKCkpOwoKICAgICAgICAvLyBkb24ndCBhbGxvdyBjb3B5IHRv\nIG92ZXJyaWRlIGVtYmVkZGVkCiAgICAgICAgaWYgKF9lbWJlZGRlZCA9PSBu\ndWxsKQogICAgICAgICAgICBzZXRFbWJlZGRlZCh2bWQuaXNFbWJlZGRlZCgp\nKTsKICAgIH0KfQo=\n","encoding":"base64"}

