{"sha":"e0797ca109113c6347a422e80fbf1625fe0219f6","node_id":"MDQ6QmxvYjIwNjM2NDplMDc5N2NhMTA5MTEzYzYzNDdhNDIyZTgwZmJmMTYyNWZlMDIxOWY2","size":15475,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e0797ca109113c6347a422e80fbf1625fe0219f6","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsOwoKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFtRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5BYnN0cmFjdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk5vU3VjaEVsZW1lbnRFeGNlcHRpb247\nCmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5jb2xsZWN0aW9ucy5QcmVkaWNhdGU7CmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMuY29sbGVjdGlvbnMuaXRlcmF0b3JzLkZpbHRlckl0ZXJhdG9y\nOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLml0ZXJh\ndG9ycy5JdGVyYXRvckNoYWluOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xvc2VhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKCi8qKgog\nKiBBIG1hcCBwcm94eSBkZXNpZ25lZCBmb3IgbWFwcyBiYWNrZWQgYnkgZXh0\ncmVtZWx5IGxhcmdlIHJlc3VsdCBzZXRzIGluCiAqIHdoaWNoIGVhY2ggY2Fs\nbCB0byB7QGxpbmsgI2dldH0gb3Ige0BsaW5rICNjb250YWluc0tleX0gbWF5\nIHBlcmZvcm0gYQogKiBkYXRhYmFzZSBxdWVyeS4gQ2hhbmdlcyB0byB0aGUg\nbWFwIGFyZSB0cmFja2VkIHRocm91Z2ggYQogKiB7QGxpbmsgQ2hhbmdlVHJh\nY2tlcn0uIFRoaXMgbWFwIGhhcyB0aGUgZm9sbG93aW5nIGxpbWl0YXRpb25z\nOgogKiA8dWw+CiAqIDxsaT5UaGUgPGNvZGU+c2l6ZTwvY29kZT4gbWV0aG9k\nIG1heSByZXR1cm4ge0BsaW5rIEludGVnZXIjTUFYX1ZBTFVFfS48L2xpPgog\nKiA8bGk+TnVsbCBrZXlzIGFuZCB2YWx1ZXMgYXJlIG5vdCBzdXBwb3J0ZWQu\nPC9saT4KICogPC91bD4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1\nYmxpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdExSU1Byb3h5TWFwCiAgICBp\nbXBsZW1lbnRzIE1hcCwgTFJTUHJveHksIE1hcENoYW5nZVRyYWNrZXIsIFBy\nZWRpY2F0ZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE1PREVf\nS0VZID0gMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNT0RFX1ZB\nTFVFID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBNT0RFX0VO\nVFJZID0gMjsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEFic3RyYWN0\nTFJTUHJveHlNYXAuY2xhc3MpOwoKICAgIHByaXZhdGUgQ2xhc3MgX2tleVR5\ncGUgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfdmFsdWVUeXBlID0gbnVs\nbDsKICAgIHByaXZhdGUgTWFwQ2hhbmdlVHJhY2tlckltcGwgX2N0ID0gbnVs\nbDsKICAgIHByaXZhdGUgT3BlbkpQQVN0YXRlTWFuYWdlciBfc20gPSBudWxs\nOwogICAgcHJpdmF0ZSBpbnQgX2ZpZWxkID0gLTE7CiAgICBwcml2YXRlIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgX29yaWdPd25lciA9IG51bGw7CiAgICBwcml2\nYXRlIGludCBfb3JpZ0ZpZWxkID0gLTE7CiAgICBwcml2YXRlIE1hcCBfbWFw\nID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9jb3VudCA9IC0xOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9pdGVyYXRlZCA9IGZhbHNlOwoKICAgIHB1YmxpYyBB\nYnN0cmFjdExSU1Byb3h5TWFwKENsYXNzIGtleVR5cGUsIENsYXNzIHZhbHVl\nVHlwZSwKICAgICAgICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mKSB7CiAg\nICAgICAgX2tleVR5cGUgPSBrZXlUeXBlOwogICAgICAgIF92YWx1ZVR5cGUg\nPSB2YWx1ZVR5cGU7CiAgICAgICAgX2N0ID0gbmV3IE1hcENoYW5nZVRyYWNr\nZXJJbXBsKHRoaXMsIGNvbmYpOwogICAgICAgIF9jdC5zZXRBdXRvT2ZmKGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRPd25lcihPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBpbnQgZmllbGQpIHsKICAgICAgICAvLyBjYW4n\ndCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgYW4gbHJzIHByb3h5CiAgICAgICAg\naWYgKHNtICE9IG51bGwgJiYgX29yaWdPd25lciAhPSBudWxsCiAgICAgICAg\nICAgICYmIChfb3JpZ093bmVyICE9IHNtIHx8IF9vcmlnRmllbGQgIT0gZmll\nbGQpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoInRyYW5zZmVyLWxycyIsCiAgICAgICAgICAgICAg\nICBfb3JpZ093bmVyLmdldE1ldGFEYXRhKCkuZ2V0RmllbGQoX29yaWdGaWVs\nZCkpKTsKICAgICAgICB9CgogICAgICAgIF9zbSA9IHNtOwogICAgICAgIF9m\naWVsZCA9IGZpZWxkOwoKICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIG9yaWdp\nbmFsIG93bmVyIHNvIHdlIGNhbiBkZXRlY3QgdHJhbnNmZXIgYXR0ZW1wdHMK\nICAgICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICBfb3JpZ093\nbmVyID0gc207CiAgICAgICAgICAgIF9vcmlnRmllbGQgPSBmaWVsZDsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZ2V0T3duZXIoKSB7CiAgICAgICAgcmV0dXJuIF9zbTsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IGdldE93bmVyRmllbGQoKSB7CiAgICAgICAgcmV0dXJuIF9m\naWVsZDsKICAgIH0KCiAgICBwdWJsaWMgQ2hhbmdlVHJhY2tlciBnZXRDaGFu\nZ2VUcmFja2VyKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIHB1YmxpYyBPYmplY3QgY29weShPYmplY3Qgb3JpZykgewogICAgICAgIC8v\nIHVzZWQgdG8gc3RvcmUgZmllbGRzIGZvciByb2xsYmFjOyB3ZSBkb24ndCBz\ndG9yZSBscnMgZmllbGRzCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiB1c2VkIGluIHRlc3Rpbmc7IHdlIG5lZWQgdG8gYmUg\nYWJsZSB0byBtYWtlIHN1cmUgdGhhdCBPcGVuSlBBIGRvZXMgbm90CiAgICAg\nKiBpdGVyYXRlIGxycyBmaWVsZHMgZHVyaW5nIHN0YW5kYXJkIGNydWQgb3Bl\ncmF0aW9ucwogICAgICovCiAgICBib29sZWFuIGlzSXRlcmF0ZWQoKSB7CiAg\nICAgICAgcmV0dXJuIF9pdGVyYXRlZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIHVzZWQgaW4gdGVzdGluZzsgd2UgbmVlZCB0byBiZSBhYmxlIHRvIG1ha2Ug\nc3VyZSB0aGF0IE9wZW5KUEEgZG9lcyBub3QKICAgICAqIGl0ZXJhdGUgbHJz\nIGZpZWxkcyBkdXJpbmcgc3RhbmRhcmQgY3J1ZCBvcGVyYXRpb25zCiAgICAg\nKi8KICAgIHZvaWQgc2V0SXRlcmF0ZWQoYm9vbGVhbiBpdCkgewogICAgICAg\nIF9pdGVyYXRlZCA9IGl0OwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2l6ZSgp\nIHsKICAgICAgICBpZiAoX2NvdW50ID09IC0xKQogICAgICAgICAgICBfY291\nbnQgPSBjb3VudCgpOwogICAgICAgIGlmIChfY291bnQgPT0gSW50ZWdlci5N\nQVhfVkFMVUUpCiAgICAgICAgICAgIHJldHVybiBfY291bnQ7CiAgICAgICAg\ncmV0dXJuIF9jb3VudCArIF9jdC5nZXRBZGRlZCgpLnNpemUoKSAtIF9jdC5n\nZXRSZW1vdmVkKCkuc2l6ZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIHNpemUoKSA9PSAwOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zS2V5KE9iamVjdCBrZXkp\nIHsKICAgICAgICBpZiAoX2tleVR5cGUgIT0gbnVsbCAmJiAhX2tleVR5cGUu\naXNJbnN0YW5jZShrZXkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgaWYgKF9tYXAgIT0gbnVsbCAmJiBfbWFwLmNvbnRhaW5zS2V5KGtl\neSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChfY3Qu\nZ2V0VHJhY2tLZXlzKCkpIHsKICAgICAgICAgICAgaWYgKF9jdC5nZXRSZW1v\ndmVkKCkuY29udGFpbnMoa2V5KSkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgcmV0dXJuIGhhc0tleShrZXkpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gdmFsdWUgdHJhY2tpbmc6CiAgICAgICAgLy8gaWYg\nd2UndmUgcmVtb3ZlZCB2YWx1ZXMsIHdlIG5lZWQgdG8gc2VlIGlmIHRoaXMg\na2V5IHJlcHJlc2VudHMKICAgICAgICAvLyBhIHJlbW92ZWQgaW5zdGFuY2Uu\nIG90aGVyd2lzZSB3ZSBjYW4gcmVseSBvbiB0aGUgMS0xIGJldHdlZW4KICAg\nICAgICAvLyBrZXlzIGFuZCB2YWx1ZXMgd2hlbiB1c2luZyB2YWx1ZSB0cmFj\na2luZwogICAgICAgIGlmIChfY3QuZ2V0UmVtb3ZlZCgpLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIGhhc0tleShrZXkpOwogICAgICAgIHJldHVy\nbiBnZXQoa2V5KSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGNvbnRhaW5zVmFsdWUoT2JqZWN0IHZhbCkgewogICAgICAgIGlmIChfdmFs\ndWVUeXBlICE9IG51bGwgJiYgIV92YWx1ZVR5cGUuaXNJbnN0YW5jZSh2YWwp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9tYXAg\nIT0gbnVsbCAmJiBfbWFwLmNvbnRhaW5zVmFsdWUodmFsKSkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCFfY3QuZ2V0VHJhY2tLZXlz\nKCkpIHsKICAgICAgICAgICAgaWYgKF9jdC5nZXRSZW1vdmVkKCkuY29udGFp\nbnModmFsKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgcmV0dXJuIGhhc1ZhbHVlKHZhbCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBrZXkgdHJhY2tpbmcKICAgICAgICBDb2xsZWN0aW9uIGtleXMgPSBr\nZXlzKHZhbCk7CiAgICAgICAgaWYgKGtleXMgPT0gbnVsbCB8fCBrZXlzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGtl\neXMucmVtb3ZlQWxsKF9jdC5nZXRSZW1vdmVkKCkpOwogICAgICAgIGtleXMu\ncmVtb3ZlQWxsKF9jdC5nZXRDaGFuZ2VkKCkpOwogICAgICAgIHJldHVybiBr\nZXlzLnNpemUoKSA+IDA7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXQo\nT2JqZWN0IGtleSkgewogICAgICAgIGlmIChfa2V5VHlwZSAhPSBudWxsICYm\nICFfa2V5VHlwZS5pc0luc3RhbmNlKGtleSkpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIE9iamVjdCByZXQgPSAoX21hcCA9PSBudWxsKSA/\nIG51bGwgOiBfbWFwLmdldChrZXkpOwogICAgICAgIGlmIChyZXQgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICBpZiAoX2N0Lmdl\ndFRyYWNrS2V5cygpICYmIF9jdC5nZXRSZW1vdmVkKCkuY29udGFpbnMoa2V5\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgT2JqZWN0IHZh\nbCA9IHZhbHVlKGtleSk7CiAgICAgICAgaWYgKCFfY3QuZ2V0VHJhY2tLZXlz\nKCkgJiYgX2N0LmdldFJlbW92ZWQoKS5jb250YWlucyh2YWwpKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gdmFsOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgcHV0KE9iamVjdCBrZXksIE9iamVjdCB2YWx1\nZSkgewogICAgICAgIFByb3hpZXMuYXNzZXJ0QWxsb3dlZFR5cGUoa2V5LCBf\na2V5VHlwZSk7CiAgICAgICAgUHJveGllcy5hc3NlcnRBbGxvd2VkVHlwZSh2\nYWx1ZSwgX3ZhbHVlVHlwZSk7CiAgICAgICAgUHJveGllcy5kaXJ0eSh0aGlz\nKTsKICAgICAgICBpZiAoX21hcCA9PSBudWxsKQogICAgICAgICAgICBfbWFw\nID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBPYmplY3Qgb2xkID0gX21hcC5w\ndXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgaWYgKG9sZCA9PSBudWxsICYmICgh\nX2N0LmdldFRyYWNrS2V5cygpCiAgICAgICAgICAgIHx8ICFfY3QuZ2V0UmVt\nb3ZlZCgpLmNvbnRhaW5zKGtleSkpKQogICAgICAgICAgICBvbGQgPSB2YWx1\nZShrZXkpOwogICAgICAgIGlmIChvbGQgIT0gbnVsbCkgewogICAgICAgICAg\nICBfY3QuY2hhbmdlZChrZXksIG9sZCwgdmFsdWUpOwogICAgICAgICAgICBQ\ncm94aWVzLnJlbW92ZWQodGhpcywgb2xkLCBmYWxzZSk7CiAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgIF9jdC5hZGRlZChrZXksIHZhbHVlKTsKICAgICAg\nICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHB1dEFsbChN\nYXAgbSkgewogICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IG0uZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkp\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHB1dChlbnRyeS5nZXRLZXkoKSwg\nZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgcmVtb3ZlKE9iamVjdCBrZXkpIHsKICAgICAgICBQcm94aWVz\nLmRpcnR5KHRoaXMpOwogICAgICAgIE9iamVjdCBvbGQgPSAoX21hcCA9PSBu\ndWxsKSA/IG51bGwgOiBfbWFwLnJlbW92ZShrZXkpOwogICAgICAgIGlmIChv\nbGQgPT0gbnVsbCAmJiAoIV9jdC5nZXRUcmFja0tleXMoKQogICAgICAgICAg\nICB8fCAhX2N0LmdldFJlbW92ZWQoKS5jb250YWlucyhrZXkpKSkKICAgICAg\nICAgICAgb2xkID0gdmFsdWUoa2V5KTsKICAgICAgICBpZiAob2xkICE9IG51\nbGwpIHsKICAgICAgICAgICAgX2N0LnJlbW92ZWQoa2V5LCBvbGQpOwogICAg\nICAgICAgICBQcm94aWVzLnJlbW92ZWQodGhpcywga2V5LCB0cnVlKTsKICAg\nICAgICAgICAgUHJveGllcy5yZW1vdmVkKHRoaXMsIG9sZCwgZmFsc2UpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsZWFyKCkgewogICAgICAgIFByb3hpZXMuZGlydHkodGhpcyk7\nCiAgICAgICAgSXRyIGl0ciA9IGl0ZXJhdG9yKE1PREVfRU5UUlkpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAg\nICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAg\nIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgIFByb3hpZXMucmVtb3ZlZCh0aGlzLCBlbnRyeS5nZXRLZXkoKSwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICBQcm94aWVzLnJlbW92ZWQodGhpcywgZW50\ncnkuZ2V0VmFsdWUoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgX2N0LnJl\nbW92ZWQoZW50cnkuZ2V0S2V5KCksIGVudHJ5LmdldFZhbHVlKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAg\nICAgICBpdHIuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIFNldCBrZXlTZXQoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBYnN0cmFjdFNl\ndCgpIHsKICAgICAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIEFic3RyYWN0TFJTUHJveHlNYXAudGhpcy5zaXpl\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFu\nIHJlbW92ZShPYmplY3QgbykgewogICAgICAgICAgICAgICAgcmV0dXJuIEFi\nc3RyYWN0TFJTUHJveHlNYXAudGhpcy5yZW1vdmUobykgIT0gbnVsbDsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEl0ZXJhdG9yIGl0ZXJh\ndG9yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEFic3RyYWN0TFJTUHJv\neHlNYXAudGhpcy5pdGVyYXRvcihNT0RFX0tFWSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9OwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIHZhbHVl\ncygpIHsKICAgICAgICByZXR1cm4gbmV3IEFic3RyYWN0Q29sbGVjdGlvbigp\nIHsKICAgICAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIEFic3RyYWN0TFJTUHJveHlNYXAudGhpcy5zaXplKCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBJdGVyYXRvciBp\ndGVyYXRvcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBBYnN0cmFjdExS\nU1Byb3h5TWFwLnRoaXMuaXRlcmF0b3IoTU9ERV9WQUxVRSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIHB1YmxpYyBTZXQgZW50cnlT\nZXQoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBYnN0cmFjdFNldCgpIHsKICAg\nICAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIEFic3RyYWN0TFJTUHJveHlNYXAudGhpcy5zaXplKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRv\ncigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBBYnN0cmFjdExSU1Byb3h5\nTWFwLnRoaXMuaXRlcmF0b3IoTU9ERV9FTlRSWSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9OwogICAgfQoKICAgIHByb3RlY3RlZCBPYmplY3Qgd3JpdGVS\nZXBsYWNlKCkKICAgICAgICB0aHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0aW9u\nIHsKICAgICAgICBJdHIgaXRyID0gaXRlcmF0b3IoTU9ERV9FTlRSWSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgTWFwIG1hcCA9IG5ldyBIYXNoTWFw\nKCk7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeTsKICAgICAgICAgICAg\nd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgIGVudHJ5\nID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIG1h\ncC5wdXQoZW50cnkuZ2V0S2V5KCksIGVudHJ5LmdldFZhbHVlKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtYXA7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaXRyLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVu\nIGtleSBleGlzdHMgaW4gdGhlIG1hcC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGFic3RyYWN0IGJvb2xlYW4gaGFzS2V5KE9iamVjdCBrZXkpOwoKICAgIC8q\nKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIHZhbHVlIGV4aXN0\ncyBpbiB0aGUgbWFwLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qg\nYm9vbGVhbiBoYXNWYWx1ZShPYmplY3QgdmFsdWUpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIGFsbCBrZXlzIGZvciB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBDb2xsZWN0aW9uIGtleXMoT2Jq\nZWN0IHZhbHVlKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmFsdWUg\nb2YgdGhlIGdpdmVuIGtleS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IE9iamVjdCB2YWx1ZShPYmplY3Qga2V5KTsKCiAgICAvKioKICAgICAq\nIEltcGxlbWVudCB0aGlzIG1ldGhvZCB0byByZXR1cm4gYW4gaXRlcmF0b3Ig\nb3ZlciB0aGUgZW50cmllcwogICAgICogaW4gdGhlIG1hcC4gRWFjaCByZXR1\ncm5lZCBvYmplY3QgbXVzdCBpbXBsZW1lbnQgdGhlCiAgICAgKiA8Y29kZT5N\nYXAuRW50cnk8L2NvZGU+IGludGVyZmFjZS4gVGhpcyBtZXRob2QgbWF5IGJl\nIGludm9rZWQgbXVsdGlwbGUKICAgICAqIHRpbWVzLiBUaGUgaXRlcmF0b3Ig\nZG9lcyBub3QgaGF2ZSB0byBzdXBwb3J0IHRoZQogICAgICoge0BsaW5rIEl0\nZXJhdG9yI3JlbW92ZX0gbWV0aG9kLCBhbmQgbWF5IGltcGxlbWVudAogICAg\nICoge0BsaW5rIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5DbG9zZWFi\nbGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgSXRlcmF0b3Ig\naXRyKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiBl\nbnRyaWVzIGluIHRoZSBtYXAsIG9yIHtAbGluayBJbnRlZ2VyI01BWF9WQUxV\nRX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBpbnQgY291bnQo\nKTsKCiAgICBwcml2YXRlIEl0ciBpdGVyYXRvcihpbnQgbW9kZSkgewogICAg\nICAgIF9pdGVyYXRlZCA9IHRydWU7CgogICAgICAgIC8vIGhhdmUgdG8gY29w\neSB0aGUgZW50cnkgc2V0IG9mIF9tYXAgdG8gcHJldmVudCBjb25jdXJyZW50\nIG1vZCBlcnJvcnMKICAgICAgICBJdGVyYXRvckNoYWluIGNoYWluID0gbmV3\nIEl0ZXJhdG9yQ2hhaW4oKTsKICAgICAgICBpZiAoX21hcCAhPSBudWxsKQog\nICAgICAgICAgICBjaGFpbi5hZGRJdGVyYXRvcihuZXcgQXJyYXlMaXN0KF9t\nYXAuZW50cnlTZXQoKSkuaXRlcmF0b3IoKSk7CiAgICAgICAgY2hhaW4uYWRk\nSXRlcmF0b3IobmV3IEZpbHRlckl0ZXJhdG9yKGl0cigpLCB0aGlzKSk7CiAg\nICAgICAgcmV0dXJuIG5ldyBJdHIobW9kZSwgY2hhaW4pOwogICAgfQoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByZWRpY2F0\nZSBJbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBib29sZWFuIGV2YWx1YXRlKE9iamVjdCBvYmop\nIHsKICAgICAgICBNYXAuRW50cnkgZW50cnkgPSAoTWFwLkVudHJ5KSBvYmo7\nCiAgICAgICAgcmV0dXJuIChfY3QuZ2V0VHJhY2tLZXlzKCkKICAgICAgICAg\nICAgJiYgIV9jdC5nZXRSZW1vdmVkKCkuY29udGFpbnMoZW50cnkuZ2V0S2V5\nKCkpCiAgICAgICAgICAgIHx8ICghX2N0LmdldFRyYWNrS2V5cygpCiAgICAg\nICAgICAgICYmICFfY3QuZ2V0UmVtb3ZlZCgpLmNvbnRhaW5zKGVudHJ5Lmdl\ndFZhbHVlKCkpKSkKICAgICAgICAgICAgJiYgKF9tYXAgPT0gbnVsbCB8fCAh\nX21hcC5jb250YWluc0tleShlbnRyeS5nZXRLZXkoKSkpOwogICAgfQoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBN\nYXBDaGFuZ2VUcmFja2VyIEltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBib29sZWFu\nIGlzVHJhY2tpbmcoKSB7CiAgICAgICAgcmV0dXJuIF9jdC5pc1RyYWNraW5n\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RhcnRUcmFja2luZygpIHsK\nICAgICAgICBfY3Quc3RhcnRUcmFja2luZygpOwogICAgICAgIHJlc2V0KCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcFRyYWNraW5nKCkgewogICAg\nICAgIF9jdC5zdG9wVHJhY2tpbmcoKTsKICAgICAgICByZXNldCgpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCByZXNldCgpIHsKICAgICAgICBpZiAoX21h\ncCAhPSBudWxsKQogICAgICAgICAgICBfbWFwLmNsZWFyKCk7CiAgICAgICAg\naWYgKF9jb3VudCAhPSBJbnRlZ2VyLk1BWF9WQUxVRSkKICAgICAgICAgICAg\nX2NvdW50ID0gLTE7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0VHJh\nY2tLZXlzKCkgewogICAgICAgIHJldHVybiBfY3QuZ2V0VHJhY2tLZXlzKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJhY2tLZXlzKGJvb2xlYW4g\na2V5cykgewogICAgICAgIF9jdC5zZXRUcmFja0tleXMoa2V5cyk7CiAgICB9\nCgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0QWRkZWQoKSB7CiAgICAgICAg\ncmV0dXJuIF9jdC5nZXRBZGRlZCgpOwogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGdldFJlbW92ZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jdC5nZXRS\nZW1vdmVkKCk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0Q2hh\nbmdlZCgpIHsKICAgICAgICByZXR1cm4gX2N0LmdldENoYW5nZWQoKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRlZChPYmplY3Qga2V5LCBPYmplY3Qg\ndmFsKSB7CiAgICAgICAgX2N0LmFkZGVkKGtleSwgdmFsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCByZW1vdmVkKE9iamVjdCBrZXksIE9iamVjdCB2YWwp\nIHsKICAgICAgICBfY3QucmVtb3ZlZChrZXksIHZhbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgY2hhbmdlZChPYmplY3Qga2V5LCBPYmplY3Qgb3JpZywg\nT2JqZWN0IHZhbCkgewogICAgICAgIF9jdC5jaGFuZ2VkKGtleSwgb3JpZywg\ndmFsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldE5leHRTZXF1ZW5jZSgp\nIHsKICAgICAgICByZXR1cm4gX2N0LmdldE5leHRTZXF1ZW5jZSgpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldE5leHRTZXF1ZW5jZShpbnQgc2VxKSB7\nCiAgICAgICAgX2N0LnNldE5leHRTZXF1ZW5jZShzZXEpOwogICAgfQoKICAg\nIC8qKgogICAgICogV3JhcHBlciBhcm91bmQgb3VyIGZpbHRlcmluZyBpdGVy\nYXRvciBjaGFpbi4KICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBJdHIKICAg\nICAgICBpbXBsZW1lbnRzIEl0ZXJhdG9yLCBDbG9zZWFibGUgewoKICAgICAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1BFTiA9IDA7CiAgICAgICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IExBU1RfRUxFTSA9IDE7CiAgICAg\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IENMT1NFRCA9IDI7CgogICAg\nICAgIHByaXZhdGUgZmluYWwgaW50IF9tb2RlOwogICAgICAgIHByaXZhdGUg\nZmluYWwgSXRlcmF0b3JDaGFpbiBfaXRyOwogICAgICAgIHByaXZhdGUgTWFw\nLkVudHJ5IF9sYXN0ID0gbnVsbDsKICAgICAgICBwcml2YXRlIGludCBfc3Rh\ndGUgPSBPUEVOOwoKICAgICAgICBwdWJsaWMgSXRyKGludCBtb2RlLCBJdGVy\nYXRvckNoYWluIGl0cikgewogICAgICAgICAgICBfbW9kZSA9IG1vZGU7CiAg\nICAgICAgICAgIF9pdHIgPSBpdHI7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBoYXNOZXh0KCkgewogICAgICAgICAgICBpZiAoX3N0YXRl\nICE9IE9QRU4pCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgICAgICAvLyBjbG9zZSBhdXRvbWF0aWNhbGx5IGlmIG5vIG1vcmUgZWxl\nbWVudHMKICAgICAgICAgICAgaWYgKCFfaXRyLmhhc05leHQoKSkgewogICAg\nICAgICAgICAgICAgZnJlZSgpOwogICAgICAgICAgICAgICAgX3N0YXRlID0g\nTEFTVF9FTEVNOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCBuZXh0KCkgewogICAgICAgICAgICBp\nZiAoX3N0YXRlICE9IE9QRU4pCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTm9TdWNoRWxlbWVudEV4Y2VwdGlvbigpOwoKICAgICAgICAgICAgX2xhc3Qg\nPSAoTWFwLkVudHJ5KSBfaXRyLm5leHQoKTsKICAgICAgICAgICAgc3dpdGNo\nIChfbW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSBNT0RFX0tFWToKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gX2xhc3QuZ2V0S2V5KCk7CiAgICAg\nICAgICAgICAgICBjYXNlIE1PREVfVkFMVUU6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIF9sYXN0LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfbGFzdDsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVt\nb3ZlKCkgewogICAgICAgICAgICBpZiAoX3N0YXRlID09IENMT1NFRCB8fCBf\nbGFzdCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vU3Vj\naEVsZW1lbnRFeGNlcHRpb24oKTsKCiAgICAgICAgICAgIFByb3hpZXMuZGly\ndHkoQWJzdHJhY3RMUlNQcm94eU1hcC50aGlzKTsKICAgICAgICAgICAgUHJv\neGllcy5yZW1vdmVkKEFic3RyYWN0TFJTUHJveHlNYXAudGhpcywgX2xhc3Qu\nZ2V0S2V5KCksIHRydWUpOwogICAgICAgICAgICBQcm94aWVzLnJlbW92ZWQo\nQWJzdHJhY3RMUlNQcm94eU1hcC50aGlzLCBfbGFzdC5nZXRWYWx1ZSgpLCBm\nYWxzZSk7CgogICAgICAgICAgICAvLyBuZWVkIHRvIGdldCBhIHJlZmVyZW5j\nZSB0byB0aGUga2V5IGJlZm9yZSB3ZSByZW1vdmUgaXQKICAgICAgICAgICAg\nLy8gZnJvbSB0aGUgbWFwLCBzaW5jZSBpbiBKREsgMS4zLSwgdGhlIGFjdCBv\nZiByZW1vdmluZyBhbiBlbnRyeQogICAgICAgICAgICAvLyBmcm9tIHRoZSBt\nYXAgd2lsbCBhbHNvIG51bGwgdGhlIGVudHJ5J3MgdmFsdWUsIHdoaWNoIHdv\ndWxkCiAgICAgICAgICAgIC8vIHJlc3VsdCBpbiBpbmNvcnJlY3RseSBwYXNz\naW5nIGEgbnVsbCB0byB0aGUgY2hhbmdlIHRyYWNrZXIKICAgICAgICAgICAg\nT2JqZWN0IGtleSA9IF9sYXN0LmdldEtleSgpOwogICAgICAgICAgICBPYmpl\nY3QgdmFsdWUgPSBfbGFzdC5nZXRWYWx1ZSgpOwoKICAgICAgICAgICAgaWYg\nKF9tYXAgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9tYXAucmVtb3ZlKGtl\neSk7CiAgICAgICAgICAgIF9jdC5yZW1vdmVkKGtleSwgdmFsdWUpOwogICAg\nICAgICAgICBfbGFzdCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICAgICAgZnJlZSgpOwogICAgICAg\nICAgICBfc3RhdGUgPSBDTE9TRUQ7CiAgICAgICAgfQoKICAgICAgICBwcml2\nYXRlIHZvaWQgZnJlZSgpIHsKICAgICAgICAgICAgaWYgKF9zdGF0ZSAhPSBP\nUEVOKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgTGlz\ndCBpdHJzID0gX2l0ci5nZXRJdGVyYXRvcnMoKTsKICAgICAgICAgICAgSXRl\ncmF0b3IgaXRyOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGl0\ncnMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIGl0ciA9IChJdGVy\nYXRvcikgaXRycy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoaXRyIGlu\nc3RhbmNlb2YgRmlsdGVySXRlcmF0b3IpCiAgICAgICAgICAgICAgICAgICAg\naXRyID0gKChGaWx0ZXJJdGVyYXRvcikgaXRyKS5nZXRJdGVyYXRvcigpOwog\nICAgICAgICAgICAgICAgSW1wbEhlbHBlci5jbG9zZShpdHIpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBmaW5h\nbGl6ZSgpIHsKICAgICAgICAgICAgY2xvc2UgKCk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

