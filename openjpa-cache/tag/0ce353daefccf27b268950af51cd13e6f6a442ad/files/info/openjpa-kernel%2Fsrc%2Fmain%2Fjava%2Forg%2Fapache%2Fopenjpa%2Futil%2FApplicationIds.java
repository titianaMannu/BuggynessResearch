{"sha":"becc59ea34579b1cfd657bd9fb48ee94bd51204c","node_id":"MDQ6QmxvYjIwNjM2NDpiZWNjNTllYTM0NTc5YjFjZmQ2NTdiZDlmYjQ4ZWU5NGJkNTEyMDRj","size":20953,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/becc59ea34579b1cfd657bd9fb48ee94bd51204c","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsOwoKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZpZWxk\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2\nYS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZhLnV0aWwuRGF0\nZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGls\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFu\nYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBDUmVn\naXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJz\naXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLk9iamVjdElkU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0\nIHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIFV0aWxpdHkgY2xhc3MgZm9y\nIG1hbmlwdWxhdGluZyBhcHBsaWNhdGlvbiBvYmplY3QgaWRzLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xh\nc3MgQXBwbGljYXRpb25JZHMgewoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBwcmltYXJ5IGtleSB2YWx1ZXMgZm9yIHRoZSBnaXZlbiBvYmplY3QgaWQu\nIFRoZSB2YWx1ZXMKICAgICAqIHdpbGwgYmUgcmV0dXJuZWQgaW4gdGhlIHNh\nbWUgb3JkZXIgYXMgdGhlIG1ldGFkYXRhIHByaW1hcnkga2V5IGZpZWxkcy4K\nICAgICAqIFZhbHVlcyBmb3IgUEMgcHJpbWFyeSBrZXkgZmllbGRzIHdpbGwg\nYmUgdGhlIHByaW1hcmt5IGtleSB2YWx1ZSBvcgogICAgICogb2lkIHZhbHVl\nIG9mIHRoZSByZWxhdGVkIGluc3RhbmNlIChkZXBlbmRpbmcgb24gCiAgICAg\nKiB7QGxpbmsgRmllbGRNZXRhRGF0YSNpc09iamVjdElkRmllbGRJZE9mUEN9\nKS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3RbXSB0b1BLVmFs\ndWVzKE9iamVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBPYmplY3RbXSBwa3M7CiAgICAgICAgaWYgKG1ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICBwa3MgPSBuZXcgT2JqZWN0\nWzFdOwogICAgICAgICAgICBpZiAob2lkICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBwa3NbMF0gPSAoKE9wZW5KUEFJZCkgb2lkKS5nZXRJZE9iamVjdCgp\nOwogICAgICAgICAgICByZXR1cm4gcGtzOwogICAgICAgIH0KCiAgICAgICAg\nLy8gcmVzZXQgb3duaW5nICdtZXRhJyB0byB0aGUgb3duZXIgb2YgdGhlIHBy\naW1hcnkga2V5IGZpZWxkcywgYmVjYXVzZQogICAgICAgIC8vIHRoZSBvbmUg\ncGFzc2VkIGluIG1pZ2h0IGJlIGEgcHJveHksIGxpa2UgZm9yIGVtYmVkZGVk\nIG1hcHBpbmdzOwogICAgICAgIC8vIHNpbmNlIGdldFByaW1hcnlLZXlGaWVs\nZHMgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gdGhlIHByaW1hcnkKICAgICAg\nICAvLyBrZXlzIGluIHRoZSBvcmRlciBvZiBpbmhlcml0YW5jZSwgd2UgYXJl\nIGd1YXJhbnRlZWQgdGhhdAogICAgICAgIC8vIHRoZSBsYXN0IGVsZW1lbnQg\nd2lsbCBiZSB0aGUgbW9zdC1kZXJpdmVkIGNsYXNzLgogICAgICAgIEZpZWxk\nTWV0YURhdGFbXSBmbWRzID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7\nCiAgICAgICAgbWV0YSA9IGZtZHNbZm1kcy5sZW5ndGggLSAxXS5nZXREZWNs\nYXJpbmdNZXRhRGF0YSgpOwogICAgICAgIHBrcyA9IG5ldyBPYmplY3RbZm1k\ncy5sZW5ndGhdOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHBrczsKCiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3Ry\nYWN0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlmaWVycygpKSkg\newogICAgICAgICAgICAvLyBjb3B5IGZpZWxkcyBmcm9tIHRoZSBvaWQKICAg\nICAgICAgICAgUHJpbWFyeUtleUZpZWxkTWFuYWdlciBjb25zdW1lciA9IG5l\ndyBQcmltYXJ5S2V5RmllbGRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN1\nbWVyLnNldFN0b3JlKHBrcyk7CiAgICAgICAgICAgIFBDUmVnaXN0cnkuY29w\neUtleUZpZWxkc0Zyb21PYmplY3RJZChtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSwKICAgICAgICAgICAgICAgIGNvbnN1bWVyLCBvaWQpOwogICAgICAgICAg\nICByZXR1cm4gY29uc3VtZXIuZ2V0U3RvcmUoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGRlZmF1bHQgdG8gcmVmbGVjdGlvbgogICAgICAgIGlmIChtZXRh\nLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAgIG9pZCA9ICgo\nT2JqZWN0SWQpIG9pZCkuZ2V0SWQoKTsKICAgICAgICBDbGFzcyBvaWRUeXBl\nID0gb2lkLmdldENsYXNzKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nRmllbGQgZmllbGQ7CiAgICAgICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBD\nbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAgICAg\nICAgIGZpZWxkID0gb2lkVHlwZS5nZXRGaWVsZChmbWRzW2ldLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgICAgICAgICAgcGtzW2ldID0gZmllbGQuZ2V0KG9p\nZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBwcm9wZXJ0eQogICAg\nICAgICAgICAgICAgICAgIG1ldGggPSBJbXBsSGVscGVyLmdldEdldHRlcihv\naWRUeXBlLCBmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgcGtzW2ldID0gbWV0aC5pbnZva2Uob2lkLCAoT2JqZWN0W10pIG51bGwp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBwa3M7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbih0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBuZXcgb2JqZWN0IGlkIGNvbnN0cnVjdGVkIGZyb20gdGhl\nIGdpdmVuIHByaW1hcnkga2V5IHZhbHVlcy4KICAgICAqIFZhbHVlcyBmb3Ig\nUEMgcHJpbWFyeSBrZXkgZmllbGRzIHNob3VsZCBiZSB0aGUgcHJpbWFya3kg\na2V5IHZhbHVlIG9yCiAgICAgKiBvaWQgdmFsdWUgb2YgdGhlIHJlbGF0ZWQg\naW5zdGFuY2UgKGRlcGVuZGluZyBvbiAKICAgICAqIHtAbGluayBGaWVsZE1l\ndGFEYXRhI2lzT2JqZWN0SWRGaWVsZElkT2ZQQ30pLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIE9iamVjdCBmcm9tUEtWYWx1ZXMoT2JqZWN0W10gcGtz\nLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBu\ndWxsIHx8IHBrcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgYm9vbGVhbiBjb252ZXJ0ID0gIW1ldGEuZ2V0UmVwb3NpdG9y\neSgpLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0Q29tcGF0\naWJpbGl0eUluc3RhbmNlKCkuZ2V0U3RyaWN0SWRlbnRpdHlWYWx1ZXMoKTsK\nICAgICAgICBpZiAobWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAg\nICAgICAgIGludCB0eXBlID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKClb\nMF0uZ2V0T2JqZWN0SWRGaWVsZFR5cGVDb2RlKCk7CiAgICAgICAgICAgIE9i\namVjdCB2YWwgPSAoY29udmVydCkgPyBKYXZhVHlwZXMuY29udmVydChwa3Nb\nMF0sIHR5cGUpIDogcGtzWzBdOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUp\nIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAg\nICAgICAgICAgICBpZiAoIWNvbnZlcnQgJiYgISh2YWwgaW5zdGFuY2VvZiBC\neXRlKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENsYXNz\nQ2FzdEV4Y2VwdGlvbigiISh4IGluc3RhbmNlb2YgQnl0ZSkiKTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGVJZChtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgKChOdW1iZXIp\nIHZhbCkuYnl0ZVZhbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcklk\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAg\nICAgICAoKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgICAgIGlm\nICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5jZW9mIEludGVnZXIpKQogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0\naW9uKCIhKHggaW5zdGFuY2VvZiBCeXRlKSIpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgSW50SWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICgoTnVtYmVyKSB2YWwpLmludFZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAg\nICAgICAgICAgICAgICAgIGlmICghY29udmVydCAmJiAhKHZhbCBpbnN0YW5j\nZW9mIExvbmcpKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nQ2xhc3NDYXN0RXhjZXB0aW9uKCIhKHggaW5zdGFuY2VvZiBCeXRlKSIpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9uZ0lkKG1ldGEuZ2V0\nRGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAoKE51\nbWJlcikgdmFsKS5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlNIT1JUX09CSjoKICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnZl\ncnQgJiYgISh2YWwgaW5zdGFuY2VvZiBTaG9ydCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBDbGFzc0Nhc3RFeGNlcHRpb24oIiEoeCBp\nbnN0YW5jZW9mIEJ5dGUpIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTaG9ydElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAoKE51bWJlcikgdmFsKS5zaG9ydFZhbHVlKCkp\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nSWQobWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCksIChTdHJpbmcpIHZhbCk7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgRGF0ZUlkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCAoRGF0\nZSkgdmFsKTsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdElkKG1ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLCB2YWwpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY29w\neSBwa3MgdG8gb2lkCiAgICAgICAgaWYgKCFNb2RpZmllci5pc0Fic3RyYWN0\nKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE1vZGlmaWVycygpKSkgewog\nICAgICAgICAgICBPYmplY3Qgb2lkID0gUENSZWdpc3RyeS5uZXdPYmplY3RJ\nZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIFByaW1h\ncnlLZXlGaWVsZE1hbmFnZXIgcHJvZHVjZXIgPSBuZXcgUHJpbWFyeUtleUZp\nZWxkTWFuYWdlcigpOwogICAgICAgICAgICBwcm9kdWNlci5zZXRTdG9yZShw\na3MpOwogICAgICAgICAgICBpZiAoY29udmVydCkKICAgICAgICAgICAgICAg\nIHByb2R1Y2VyLnNldE1ldGFEYXRhKG1ldGEpOwogICAgICAgICAgICBQQ1Jl\nZ2lzdHJ5LmNvcHlLZXlGaWVsZHNUb09iamVjdElkKG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgcHJvZHVjZXIsIG9pZCk7CiAg\nICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBk\nZWZhdWx0IHRvIHJlZmxlY3Rpb24KICAgICAgICBDbGFzcyBvaWRUeXBlID0g\nbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBjcmVhdGUgYSBuZXcgaWQKICAgICAgICAgICAgT2JqZWN0IGNv\ncHkgPSBvaWRUeXBlLm5ld0luc3RhbmNlKCk7CgogICAgICAgICAgICAvLyBz\nZXQgZWFjaCBmaWVsZAogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgICAgICBG\naWVsZCBmaWVsZDsKICAgICAgICAgICAgTWV0aG9kIG1ldGg7CiAgICAgICAg\nICAgIENsYXNzW10gcGFyYW1UeXBlcyA9IG51bGw7CiAgICAgICAgICAgIE9i\namVjdFtdIHBhcmFtcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBvaWRU\neXBlLmdldEZpZWxkKGZtZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBmaWVsZC5zZXQoY29weSwgKGNvbnZlcnQpID8gSmF2YVR5cGVz\nLmNvbnZlcnQocGtzW2ldLAogICAgICAgICAgICAgICAgICAgICAgICBmbWRz\nW2ldLmdldE9iamVjdElkRmllbGRUeXBlQ29kZSgpKSA6IHBrc1tpXSk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBwcm9wZXJ0eQogICAgICAgICAg\nICAgICAgICAgIGlmIChwYXJhbVR5cGVzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHBhcmFtVHlwZXMgPSBuZXcgQ2xhc3NbMV07CiAgICAg\nICAgICAgICAgICAgICAgcGFyYW1UeXBlc1swXSA9IGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgbWV0aCA9IG9pZFR5\ncGUuZ2V0TWV0aG9kKCJzZXQiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZQog\nICAgICAgICAgICAgICAgICAgICAgICAoZm1kc1tpXS5nZXROYW1lKCkpLCBw\nYXJhbVR5cGVzKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBP\nYmplY3RbMV07CiAgICAgICAgICAgICAgICAgICAgcGFyYW1zWzBdID0gKGNv\nbnZlcnQpID8gSmF2YVR5cGVzLmNvbnZlcnQocGtzW2ldLAogICAgICAgICAg\nICAgICAgICAgICAgICBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlQ29k\nZSgpKSA6IHBrc1tpXTsKICAgICAgICAgICAgICAgICAgICBtZXRoLmludm9r\nZShjb3B5LCBwYXJhbXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBpZiAobWV0YS5pc09iamVjdElkVHlwZVNoYXJl\nZCgpKQogICAgICAgICAgICAgICAgY29weSA9IG5ldyBPYmplY3RJZChtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSwgY29weSk7CiAgICAgICAgICAgIHJldHVy\nbiBjb3B5OwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgdGhlIGdpdmVuIG9pZCB2\nYWx1ZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgY29weShP\nYmplY3Qgb2lkLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAo\nbWV0YSA9PSBudWxsIHx8IG9pZCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgaWYgKG1ldGEuaXNPcGVuSlBBSWRlbnRpdHko\nKSkgewogICAgICAgICAgICAvLyB1c2UgbWV0YSB0eXBlIGluc3RlYWQgb2Yg\nb2lkIHR5cGUgaW4gY2FzZSBpdCdzIGEgc3ViY2xhc3MKICAgICAgICAgICAg\nQ2xhc3MgY2xzID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAg\nICAgIE9wZW5KUEFJZCBrb2lkID0gKE9wZW5KUEFJZCkgb2lkOwogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhIHBrID0gbWV0YS5nZXRQcmltYXJ5S2V5Rmll\nbGRzKClbMF07CiAgICAgICAgICAgIHN3aXRjaCAocGsuZ2V0T2JqZWN0SWRG\naWVsZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRF\nX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGVJZChj\nbHMsICgoQnl0ZUlkKSBvaWQpLmdldElkKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IENoYXJJZChjbHMsICgoQ2hhcklkKSBvaWQpLmdldElkKCksCiAgICAg\nICAgICAgICAgICAgICAgICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBJbnRJZChjbHMsICgoSW50SWQpIG9pZCkuZ2V0SWQo\nKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5oYXNTdWJjbGFzc2Vz\nKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgTG9uZ0lkKGNscywgKChMb25nSWQp\nIG9pZCkuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAga29pZC5o\nYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9S\nVF9PQko6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydElk\nKGNscywgKChTaG9ydElkKSBvaWQpLmdldElkKCksCiAgICAgICAgICAgICAg\nICAgICAgICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ0lkKGNscywgb2lkLnRvU3RyaW5nKCksCiAg\nICAgICAgICAgICAgICAgICAgICAgIGtvaWQuaGFzU3ViY2xhc3NlcygpKTsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoKICAgICAgICAg\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIGVtYmVkID0gcGsuZ2V0RW1iZWRk\nZWRNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCBpbm5l\nciA9IGtvaWQuZ2V0SWRPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoZW1iZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgaW5u\nZXIgPSBjb3B5KGlubmVyLCBlbWJlZCwgZW1iZWQuZ2V0RmllbGRzKCkpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0SWQoY2xzLCBp\nbm5lciwga29pZC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgT2JqZWN0SWQoY2xzLCBrb2lkLmdldElkT2JqZWN0KCksIAog\nICAgICAgICAgICAgICAgICAgICAgICBrb2lkLmhhc1N1YmNsYXNzZXMoKSk7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgYSBuZXcgcGMgaW5zdGFu\nY2Ugb2YgdGhlIHJpZ2h0IHR5cGUsIHNldCBpdHMga2V5IGZpZWxkcwogICAg\nICAgIC8vIHRvIHRoZSBvcmlnaW5hbCBvaWQgdmFsdWVzLCB0aGVuIGNvcHkg\naXRzIGtleSBmaWVsZHMgdG8gYSBuZXcKICAgICAgICAvLyBvaWQgaW5zdGFu\nY2UKICAgICAgICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3QobWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCkuZ2V0TW9kaWZpZXJzKCkpCiAgICAgICAgICAgICYm\nICFoYXNQQ1ByaW1hcnlLZXlGaWVsZHMobWV0YSkpIHsKICAgICAgICAgICAg\nQ2xhc3MgdHlwZSA9IG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAg\nICAgICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICAgICAgdHlwZSA9\nIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBQZXJzaXN0\nZW5jZUNhcGFibGUgcGMgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUs\nIG51bGwsIG9pZCwgCiAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAg\nICAgICBPYmplY3QgY29weSA9IHBjLnBjTmV3T2JqZWN0SWRJbnN0YW5jZSgp\nOwogICAgICAgICAgICBwYy5wY0NvcHlLZXlGaWVsZHNUb09iamVjdElkKGNv\ncHkpOwogICAgICAgICAgICByZXR1cm4gY29weTsKICAgICAgICB9CgogICAg\nICAgIE9iamVjdCBjb3B5ID0gKCFtZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVk\nKCkpID8gb2lkCiAgICAgICAgICAgIDogKChPYmplY3RJZCkgb2lkKS5nZXRJ\nZCgpOwogICAgICAgIGNvcHkgPSBjb3B5KGNvcHksIG1ldGEsIG1ldGEuZ2V0\nUHJpbWFyeUtleUZpZWxkcygpKTsKICAgICAgICBpZiAobWV0YS5pc09iamVj\ndElkVHlwZVNoYXJlZCgpKQogICAgICAgICAgICBjb3B5ID0gbmV3IE9iamVj\ndElkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBjb3B5LAogICAgICAgICAg\nICAgICAgKChPcGVuSlBBSWQpIG9pZCkuaGFzU3ViY2xhc3NlcygpKTsKICAg\nICAgICByZXR1cm4gY29weTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0cnVlIGlmIGFueSBvZiB0aGUgZ2l2ZW4gdHlwZSdzIHByaW1hcnkga2V5\nIGZpZWxkcyBhcmUgCiAgICAgKiBwZXJzaXN0ZW50IG9iamVjdHMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaGFzUENQcmltYXJ5S2V5\nRmllbGRzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBmbWRzID0gbWV0YS5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkg\nPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29weSB0aGUgZ2l2ZW4gaWRlbnRpdHkgb2JqZWN0IHVzaW5nIHJlZmxlY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb3B5KE9i\namVjdCBvaWQsIENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcykgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzIG9pZFR5cGUg\nPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBP\nYmplY3QgY29weSA9IG9pZFR5cGUubmV3SW5zdGFuY2UoKTsKICAgICAgICAg\nICAgRmllbGQgZmllbGQ7CiAgICAgICAgICAgIE1ldGhvZCBtZXRoOwogICAg\nICAgICAgICBTdHJpbmcgY2FwOwogICAgICAgICAgICBDbGFzc1tdIHBhcmFt\nVHlwZXMgPSBudWxsOwogICAgICAgICAgICBPYmplY3RbXSBwYXJhbXMgPSBu\ndWxsOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldE1h\nbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5U\nKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRh\nLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAgICAgICAgIGZpZWxkID0g\nb2lkVHlwZS5nZXRGaWVsZChmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgZmllbGQuc2V0KGNvcHksIGZpZWxkLmdldChvaWQpKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIHByb3BlcnR5CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHBhcmFtVHlwZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgcGFyYW1UeXBlcyA9IG5ldyBDbGFzc1sxXTsKICAg\nICAgICAgICAgICAgICAgICBwYXJhbVR5cGVzWzBdID0gZm1kc1tpXS5nZXRP\nYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICAgICAgICAgIGNhcCA9\nIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kc1tpXS5nZXROYW1lKCkpOwog\nICAgICAgICAgICAgICAgICAgIG1ldGggPSBvaWRUeXBlLmdldE1ldGhvZCgi\nc2V0IiArIGNhcCwgcGFyYW1UeXBlcyk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBhcmFtcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBw\nYXJhbXMgPSBuZXcgT2JqZWN0WzFdOwogICAgICAgICAgICAgICAgICAgIHBh\ncmFtc1swXSA9IEltcGxIZWxwZXIuZ2V0R2V0dGVyKG9pZFR5cGUsIGNhcCku\nCiAgICAgICAgICAgICAgICAgICAgICAgIGludm9rZShvaWQsIChPYmplY3Rb\nXSkgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgbWV0aC5pbnZva2UoY29w\neSwgcGFyYW1zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gY29weTsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKHQpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgZmll\nbGQgdmFsdWUgZnJvbSB0aGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIE9iamVjdCBnZXQoT2JqZWN0IG9pZCwgRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVu\nSlBBSWQpCiAgICAgICAgICAgIHJldHVybiAoKE9wZW5KUEFJZCkgb2lkKS5n\nZXRJZE9iamVjdCgpOwoKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBm\nbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpOwogICAgICAgIENsYXNzIG9pZFR5\ncGUgPSBvaWQuZ2V0Q2xhc3MoKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5B\nQ0NFU1NfRklFTEQpCiAgICAgICAgICAgICAgICByZXR1cm4gb2lkVHlwZS5n\nZXRGaWVsZChmbWQuZ2V0TmFtZSgpKS5nZXQob2lkKTsKCiAgICAgICAgICAg\nIC8vIHByb3BlcnR5CiAgICAgICAgICAgIFN0cmluZyBjYXAgPSBTdHJpbmdV\ndGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICBy\nZXR1cm4gSW1wbEhlbHBlci5nZXRHZXR0ZXIob2lkVHlwZSwgY2FwKS4KICAg\nICAgICAgICAgICAgIGludm9rZShvaWQsIChPYmplY3RbXSkgbnVsbCk7CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbih0KTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbiBh\ncHBsaWNhdGlvbiBpZCBiYXNlZCBvbiB0aGUgY3VycmVudCBwcmltYXJ5IGtl\neSBmaWVsZCBzdGF0ZQogICAgICogb2YgdGhlIGdpdmVuIGluc3RhbmNlLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjcmVhdGUoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIE9iamVjdCBvaWQgPSBwYy5wY05ld09iamVjdElkSW5zdGFuY2Uo\nKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBpZiAoIW1ldGEuaXNPcGVuSlBBSWRlbnRpdHko\nKSkgewogICAgICAgICAgICBwYy5wY0NvcHlLZXlGaWVsZHNUb09iamVjdElk\nKG9pZCk7CiAgICAgICAgICAgIHJldHVybiBvaWQ7CiAgICAgICAgfQoKICAg\nICAgICBGaWVsZE1ldGFEYXRhIHBrID0gbWV0YS5nZXRQcmltYXJ5S2V5Rmll\nbGRzKClbMF07CiAgICAgICAgaWYgKHBrLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSAhPSBKYXZhVHlwZXMuT0lEKQogICAgICAgICAgICByZXR1cm4gb2lkOwoK\nICAgICAgICAvLyBhbHdheXMgY29weSBvaWQgb2JqZWN0IGluIGNhc2UgZmll\nbGQgdmFsdWUgbXV0YXRlcyBvciBiZWNvbWVzCiAgICAgICAgLy8gbWFuYWdl\nZAogICAgICAgIE9iamVjdElkIG9iamlkID0gKE9iamVjdElkKSBvaWQ7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrLmdldEVtYmVkZGVkTWV0\nYURhdGEoKTsKICAgICAgICBvYmppZC5zZXRJZChjb3B5KG9iamlkLmdldElk\nKCksIGVtYmVkLCBlbWJlZC5nZXRGaWVsZHMoKSkpOwogICAgICAgIHJldHVy\nbiBvYmppZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2lnbiBhbiBhcHBs\naWNhdGlvbiBpZGVudGl0eSBvYmplY3QgdG8gdGhlIGdpdmVuIHN0YXRlLCBv\nciByZXR1cm4KICAgICAqIGZhbHNlIGlmIGRldGVybWluaW5nIHRoZSBhcHBs\naWNhdGlvbiBpZGVudGl0eSByZXF1aXJlcyBhIGZsdXNoLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gYXNzaWduKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIFN0b3JlTWFuYWdlciBzdG9yZSwKICAgICAgICBib29sZWFu\nIHByZUZsdXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20u\nZ2V0TWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5\ncGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAgICAg\nYm9vbGVhbiByZXQ7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IG1l\ndGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgIGlmIChtZXRhLmlz\nT3BlbkpQQUlkZW50aXR5KCkKICAgICAgICAgICAgJiYgcGtzWzBdLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0lEKSB7CiAgICAgICAg\nICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgb2lkc20gPSBuZXcgT2JqZWN0SWRT\ndGF0ZU1hbmFnZXIKICAgICAgICAgICAgICAgIChzbS5mZXRjaE9iamVjdEZp\nZWxkKHBrc1swXS5nZXRJbmRleCgpKSwgc20sIHBrc1swXSk7CiAgICAgICAg\nICAgIHJldCA9IGFzc2lnbihvaWRzbSwgc3RvcmUsIHBrc1swXS5nZXRFbWJl\nZGRlZE1ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICBnZXRGaWVsZHMoKSwg\ncHJlRmx1c2gpOwogICAgICAgICAgICBzbS5zdG9yZU9iamVjdEZpZWxkKHBr\nc1swXS5nZXRJbmRleCgpLAogICAgICAgICAgICAgICAgb2lkc20uZ2V0TWFu\nYWdlZEluc3RhbmNlKCkpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBy\nZXQgPSBhc3NpZ24oc20sIHN0b3JlLCBtZXRhLmdldFByaW1hcnlLZXlGaWVs\nZHMoKSwgcHJlRmx1c2gpOwogICAgICAgIGlmICghcmV0KQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGJhc2Ugb2lkIG9uIGZpZWxk\nIHZhbHVlcwogICAgICAgIHNtLnNldE9iamVjdElkKGNyZWF0ZShzbS5nZXRQ\nZXJzaXN0ZW5jZUNhcGFibGUoKSwgbWV0YSkpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogQXNzaWduIGdlbmVyYXRlZCB2\nYWx1ZXMgdG8gZ2l2ZW4gZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBib29sZWFuIGFzc2lnbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBT\ndG9yZU1hbmFnZXIgc3RvcmUsCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBr\ncywgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgcGtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAocGtzW2ld\nLmdldFZhbHVlU3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORQog\nICAgICAgICAgICAgICAgJiYgc20uaXNEZWZhdWx0VmFsdWUocGtzW2ldLmdl\ndEluZGV4KCkpCiAgICAgICAgICAgICAgICAmJiAhc3RvcmUuYXNzaWduRmll\nbGQoc20sIHBrc1tpXS5nZXRJbmRleCgpLCBwcmVGbHVzaCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgY2xhc3MgdXNlZCB0byB0cmFu\nc2ZlciBwayB2YWx1ZXMgdG8vZnJvbSBhcHBsaWNhdGlvbiBvaWRzLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQcmltYXJ5S2V5RmllbGRN\nYW5hZ2VyCiAgICAgICAgaW1wbGVtZW50cyBGaWVsZE1hbmFnZXIgewoKICAg\nICAgICBwcml2YXRlIE9iamVjdFtdIF9zdG9yZSA9IG51bGw7CiAgICAgICAg\ncHJpdmF0ZSBpbnQgX2luZGV4ID0gMDsKICAgICAgICBwcml2YXRlIENsYXNz\nTWV0YURhdGEgX21ldGEgPSBudWxsOwoKICAgICAgICBwdWJsaWMgdm9pZCBz\nZXRNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICAgICAg\nX21ldGEgPSBtZXRhOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVj\ndFtdIGdldFN0b3JlKCkgewogICAgICAgICAgICByZXR1cm4gX3N0b3JlOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc2V0U3RvcmUoT2JqZWN0\nW10gc3RvcmUpIHsKICAgICAgICAgICAgX3N0b3JlID0gc3RvcmU7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUJvb2xlYW5GaWVsZChp\nbnQgZmllbGQsIGJvb2xlYW4gdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKCh2\nYWwpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmll\nbGQsIGJ5dGUgdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKG5ldyBCeXRlKHZh\nbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcmVDaGFy\nRmllbGQoaW50IGZpZWxkLCBjaGFyIHZhbCkgewogICAgICAgICAgICBzdG9y\nZShuZXcgQ2hhcmFjdGVyKHZhbCkpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgc3RvcmVTaG9ydEZpZWxkKGludCBmaWVsZCwgc2hvcnQgdmFs\nKSB7CiAgICAgICAgICAgIHN0b3JlKG5ldyBTaG9ydCh2YWwpKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50RmllbGQoaW50IGZp\nZWxkLCBpbnQgdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKE51bWJlcnMudmFs\ndWVPZih2YWwpKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0\nb3JlTG9uZ0ZpZWxkKGludCBmaWVsZCwgbG9uZyB2YWwpIHsKICAgICAgICAg\nICAgc3RvcmUoTnVtYmVycy52YWx1ZU9mKHZhbCkpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgc3RvcmVGbG9hdEZpZWxkKGludCBmaWVsZCwg\nZmxvYXQgdmFsKSB7CiAgICAgICAgICAgIHN0b3JlKG5ldyBGbG9hdCh2YWwp\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3JlRG91Ymxl\nRmllbGQoaW50IGZpZWxkLCBkb3VibGUgdmFsKSB7CiAgICAgICAgICAgIHN0\nb3JlKG5ldyBEb3VibGUodmFsKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzdG9yZVN0cmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5nIHZh\nbCkgewogICAgICAgICAgICBzdG9yZSh2YWwpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgc3RvcmVPYmplY3RGaWVsZChpbnQgZmllbGQsIE9i\namVjdCB2YWwpIHsKICAgICAgICAgICAgc3RvcmUodmFsKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGZldGNoQm9vbGVhbkZpZWxkKGlu\ndCBmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gKHJldHJpZXZlKGZpZWxk\nKSA9PSBCb29sZWFuLlRSVUUpID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGNoYXIgZmV0Y2hDaGFyRmllbGQoaW50IGZpZWxk\nKSB7CiAgICAgICAgICAgIHJldHVybiAoKENoYXJhY3RlcikgcmV0cmlldmUo\nZmllbGQpKS5jaGFyVmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAg\nICByZXR1cm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxkKSkuYnl0ZVZhbHVl\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc2hvcnQgZmV0Y2hTaG9y\ndEZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gKChOdW1i\nZXIpIHJldHJpZXZlKGZpZWxkKSkuc2hvcnRWYWx1ZSgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBmZXRjaEludEZpZWxkKGludCBmaWVsZCkg\newogICAgICAgICAgICByZXR1cm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxk\nKSkuaW50VmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBsb25n\nIGZldGNoTG9uZ0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1\ncm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxkKSkubG9uZ1ZhbHVlKCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgZmxvYXQgZmV0Y2hGbG9hdEZpZWxk\nKGludCBmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gKChOdW1iZXIpIHJl\ndHJpZXZlKGZpZWxkKSkuZmxvYXRWYWx1ZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGRvdWJsZSBmZXRjaERvdWJsZUZpZWxkKGludCBmaWVsZCkg\newogICAgICAgICAgICByZXR1cm4gKChOdW1iZXIpIHJldHJpZXZlKGZpZWxk\nKSkuZG91YmxlVmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgZmV0Y2hTdHJpbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICAg\nICAgcmV0dXJuIChTdHJpbmcpIHJldHJpZXZlKGZpZWxkKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3RGaWVsZChpbnQg\nZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIHJldHJpZXZlKGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBzdG9yZShPYmplY3Qg\ndmFsKSB7CiAgICAgICAgICAgIF9zdG9yZVtfaW5kZXgrK10gPSB2YWw7CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIE9iamVjdCByZXRyaWV2ZShpbnQg\nZmllbGQpIHsKICAgICAgICAgICAgT2JqZWN0IHZhbCA9IF9zdG9yZVtfaW5k\nZXgrK107CiAgICAgICAgICAgIGlmIChfbWV0YSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpICE9IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAgICAg\nICB2YWwgPSBKYXZhVHlwZXMuY29udmVydCh2YWwsIGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHZhbCA9IEphdmFUeXBlcy5jb252ZXJ0KHZhbCwgSmF2YVR5\ncGVzLmdldFR5cGVDb2RlKGZtZC4KICAgICAgICAgICAgICAgICAgICAgICAg\nZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB2YWw7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

