{"sha":"0dc7e535cc70ca5897e2d19784a590537f9cfc12","node_id":"MDQ6QmxvYjIwNjM2NDowZGM3ZTUzNWNjNzBjYTU4OTdlMmQxOTc4NGE1OTA1MzdmOWNmYzEy","size":7495,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0dc7e535cc70ca5897e2d19784a590537f9cfc12","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEuaW8uQnl0ZUFycmF5SW5w\ndXRTdHJlYW07CmltcG9ydCBqYXZhLmxhbmcuaW5zdHJ1bWVudC5DbGFzc0Zp\nbGVUcmFuc2Zvcm1lcjsKaW1wb3J0IGphdmEubGFuZy5pbnN0cnVtZW50Lkls\nbGVnYWxDbGFzc0Zvcm1hdEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuc2VjdXJp\ndHkuUHJvdGVjdGlvbkRvbWFpbjsKaW1wb3J0IGphdmEudXRpbC5TZXQ7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9wdGlvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9z\naXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFs\nRXhjZXB0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Qcm9qZWN0OwppbXBv\ncnQgc2VycC5ieXRlY29kZS5sb3dsZXZlbC5Db25zdGFudFBvb2xUYWJsZTsK\nCi8qKgogKiBUcmFuc2Zvcm1lciB0aGF0IG1ha2VzIHBlcnNpc3RlbnQgY2xh\nc3NlcyBpbXBsZW1lbnQgdGhlCiAqIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFi\nbGV9IGludGVyZmFjZSBhdCBydW50aW1lLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgUENDbGFzc0Zp\nbGVUcmFuc2Zvcm1lcgogICAgaW1wbGVtZW50cyBDbGFzc0ZpbGVUcmFuc2Zv\ncm1lciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9s\nb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChQQ0NsYXNzRmls\nZVRyYW5zZm9ybWVyLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIE1ldGFE\nYXRhUmVwb3NpdG9yeSBfcmVwb3M7CiAgICBwcml2YXRlIGZpbmFsIFBDRW5o\nYW5jZXIuRmxhZ3MgX2ZsYWdzOwogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc0xv\nYWRlciBfdG1wTG9hZGVyOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgX2xvZzsK\nICAgIHByaXZhdGUgZmluYWwgU2V0IF9uYW1lczsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfdHJhbnNmb3JtaW5nID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBD\nb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFyYW0gcmVwb3MgbWV0YWRh\ndGEgcmVwb3NpdG9yeSB0byB1c2UgaW50ZXJuYWxseQogICAgICogQHBhcmFt\nIG9wdHMgZW5oYW5jZXIgY29uZmlndXJhdGlvbiBvcHRpb25zCiAgICAgKiBA\ncGFyYW0gbG9hZGVyIHRlbXBvcmFyeSBjbGFzcyBsb2FkZXIgZm9yIGxvYWRp\nbmcgaW50ZXJtZWRpYXRlIGNsYXNzZXMKICAgICAqLwogICAgcHVibGljIFBD\nQ2xhc3NGaWxlVHJhbnNmb3JtZXIoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9z\nLCBPcHRpb25zIG9wdHMsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7\nCiAgICAgICAgdGhpcyhyZXBvcywgdG9GbGFncyhvcHRzKSwgbG9hZGVyLCBv\ncHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoInNjYW5E\nZXZQYXRoIiwgIlNjYW5EZXZQYXRoIiwgZmFsc2UpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBlbmhhbmNlciBmbGFncyBmcm9tIHRoZSBnaXZl\nbiBvcHRpb25zLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBQQ0VuaGFu\nY2VyLkZsYWdzIHRvRmxhZ3MoT3B0aW9ucyBvcHRzKSB7CiAgICAgICAgUENF\nbmhhbmNlci5GbGFncyBmbGFncyA9IG5ldyBQQ0VuaGFuY2VyLkZsYWdzKCk7\nCiAgICAgICAgZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yID0gb3B0cy5y\nZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJhZGREZWZhdWx0\nQ29uc3RydWN0b3IiLCAiQWRkRGVmYXVsdENvbnN0cnVjdG9yIiwKICAgICAg\nICAgICAgICAgIGZsYWdzLmFkZERlZmF1bHRDb25zdHJ1Y3Rvcik7CiAgICAg\nICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zID0gb3B0cy5y\nZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJlbmZvcmNlUHJv\ncGVydHlSZXN0cmljdGlvbnMiLCAiRW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rp\nb25zIiwKICAgICAgICAgICAgICAgIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJl\nc3RyaWN0aW9ucyk7CiAgICAgICAgcmV0dXJuIGZsYWdzOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFt\nIHJlcG9zIG1ldGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGludGVybmFsbHkK\nICAgICAqIEBwYXJhbSBmbGFncyBlbmhhbmNlciBjb25maWd1cmF0aW9uCiAg\nICAgKiBAcGFyYW0gbG9hZGVyIHRlbXBvcmFyeSBjbGFzcyBsb2FkZXIgZm9y\nIGxvYWRpbmcgaW50ZXJtZWRpYXRlIGNsYXNzZXMKICAgICAqIEBwYXJhbSBk\nZXZzY2FuIHdoZXRoZXIgdG8gc2NhbiB0aGUgZGV2IGNsYXNzcGF0aCBmb3Ig\ncGVyc2lzdGVudCB0eXBlcwogICAgICogaWYgbm9uZSBhcmUgY29uZmlndXJl\nZAogICAgICovCiAgICBwdWJsaWMgUENDbGFzc0ZpbGVUcmFuc2Zvcm1lcihN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsCiAgICAgICAgUENFbmhhbmNlci5G\nbGFncyBmbGFncywgQ2xhc3NMb2FkZXIgdG1wTG9hZGVyLCBib29sZWFuIGRl\ndnNjYW4pIHsKICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfdG1w\nTG9hZGVyID0gdG1wTG9hZGVyOwoKICAgICAgICBfbG9nID0gcmVwb3MuZ2V0\nQ29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwogICAgICAgIF9mbGFncyA9IGZs\nYWdzOwoKICAgICAgICBfbmFtZXMgPSByZXBvcy5nZXRQZXJzaXN0ZW50VHlw\nZU5hbWVzKGRldnNjYW4sIHRtcExvYWRlcik7CiAgICAgICAgaWYgKF9uYW1l\ncyA9PSBudWxsICYmIF9sb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAg\nICBfbG9nLmluZm8oX2xvYy5nZXQoInJ1bnRpbWUtZW5oYW5jZS1wY2NsYXNz\nZXMiKSk7CiAgICB9CgogICAgcHVibGljIGJ5dGVbXSB0cmFuc2Zvcm0oQ2xh\nc3NMb2FkZXIgbG9hZGVyLCBTdHJpbmcgY2xhc3NOYW1lLAogICAgICAgIENs\nYXNzIHJlZGVmLCBQcm90ZWN0aW9uRG9tYWluIGRvbWFpbiwgYnl0ZVtdIGJ5\ndGVzKQogICAgICAgIHRocm93cyBJbGxlZ2FsQ2xhc3NGb3JtYXRFeGNlcHRp\nb24gewogICAgICAgIGlmIChsb2FkZXIgPT0gX3RtcExvYWRlcikKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHByZXZlbnQgcmUtZW50\ncmFudCBjYWxscywgd2hpY2ggY2FuIG9jY3VyIGlmIHRoZSBlbmhhbmNlaW5n\nCiAgICAgICAgLy8gbG9hZGVyIGlzIHVzZWQgdG8gYWxzbyBsb2FkIE9wZW5K\nUEEgbGlicmFyaWVzOyB0aGlzIGlzIHRvIHByZXZlbnQgCiAgICAgICAgLy8g\ncmVjdXJzaXZlIGVuaGFuY2VtZW50IGF0dGVtcHRzIGZvciBpbnRlcm5hbCBv\ncGVuanBhIGxpYnJhcmllcwogICAgICAgIGlmIChfdHJhbnNmb3JtaW5nKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgX3RyYW5zZm9ybWlu\nZyA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBl\nbmhhbmNlID0gbmVlZHNFbmhhbmNlKGNsYXNzTmFtZSwgcmVkZWYsIGJ5dGVz\nKTsKICAgICAgICAgICAgaWYgKGVuaGFuY2UgIT0gbnVsbCAmJiBfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJuZWVkcy1ydW50aW1lLWVuaGFuY2UiLCBjbGFzc05hbWUsCiAg\nICAgICAgICAgICAgICAgICAgZW5oYW5jZSkpOwogICAgICAgICAgICBpZiAo\nZW5oYW5jZSAhPSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgICAgIFBDRW5oYW5jZXIgZW5oYW5jZXIgPSBu\nZXcgUENFbmhhbmNlcihfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLAogICAg\nICAgICAgICAgICAgbmV3IFByb2plY3QoKS5sb2FkQ2xhc3MobmV3IEJ5dGVB\ncnJheUlucHV0U3RyZWFtKGJ5dGVzKSwKICAgICAgICAgICAgICAgICAgICBf\ndG1wTG9hZGVyKSwgX3JlcG9zKTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0\nQWRkRGVmYXVsdENvbnN0cnVjdG9yKF9mbGFncy5hZGREZWZhdWx0Q29uc3Ry\ndWN0b3IpOwogICAgICAgICAgICBlbmhhbmNlci5zZXRFbmZvcmNlUHJvcGVy\ndHlSZXN0cmljdGlvbnMKICAgICAgICAgICAgICAgIChfZmxhZ3MuZW5mb3Jj\nZVByb3BlcnR5UmVzdHJpY3Rpb25zKTsKCiAgICAgICAgICAgIGlmIChlbmhh\nbmNlci5ydW4oKSA9PSBQQ0VuaGFuY2VyLkVOSEFOQ0VfTk9ORSkKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gZW5o\nYW5jZXIuZ2V0Qnl0ZWNvZGUoKS50b0J5dGVBcnJheSgpOwogICAgICAgIH0g\nY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiY2Z0LWV4Y2VwdGlvbi10aHJvd24iLCBjbGFzc05hbWUpLCB0\nKTsKICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBSdW50aW1lRXhjZXB0\naW9uKQogICAgICAgICAgICAgICAgdGhyb3cgKFJ1bnRpbWVFeGNlcHRpb24p\nIHQ7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgSWxsZWdhbENsYXNz\nRm9ybWF0RXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdGhyb3cgKElsbGVn\nYWxDbGFzc0Zvcm1hdEV4Y2VwdGlvbikgdDsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24odCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgX3RyYW5zZm9ybWluZyA9IGZhbHNlOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZl\nbiBjbGFzcyBuZWVkcyBlbmhhbmNlbWVudC4KICAgICAqLwogICAgcHJpdmF0\nZSBCb29sZWFuIG5lZWRzRW5oYW5jZShTdHJpbmcgY2xzTmFtZSwgQ2xhc3Mg\ncmVkZWYsIGJ5dGVbXSBieXRlcykgewogICAgICAgIGlmIChyZWRlZiAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIENsYXNzW10gaW50ZnMgPSByZWRlZi5nZXRJ\nbnRlcmZhY2VzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\naW50ZnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoUGVyc2lz\ndGVuY2VDYXBhYmxlLmNsYXNzLmdldE5hbWUoKS4KICAgICAgICAgICAgICAg\nICAgICBlcXVhbHMoaW50ZnNbaV0uZ2V0TmFtZSgpKSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gQm9vbGVhbi52YWx1ZU9mKCFpc0VuaGFuY2VkKGJ5\ndGVzKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKF9uYW1lcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChf\nbmFtZXMuY29udGFpbnMoY2xzTmFtZS5yZXBsYWNlKCcvJywgJy4nKSkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi52YWx1ZU9mKCFpc0VuaGFu\nY2VkKGJ5dGVzKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKGNsc05hbWUuc3RhcnRzV2l0aCgiamF2YS8iKSB8\nfCBjbHNOYW1lLnN0YXJ0c1dpdGgoImphdmF4LyIpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaXNFbmhhbmNlZChieXRlcykpCiAg\nICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICBDbGFzcyBjID0gQ2xhc3MuZm9yTmFtZShjbHNOYW1l\nLnJlcGxhY2UoJy8nLCAnLicpLCBmYWxzZSwKICAgICAgICAgICAgICAgIF90\nbXBMb2FkZXIpOwogICAgICAgICAgICBpZiAoX3JlcG9zLmdldE1ldGFEYXRh\nKGMsIG51bGwsIGZhbHNlKSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAg\nICAgICB0aHJvdyByZTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbih0KTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBbmFseXplIHRoZSBi\neXRlY29kZSB0byBzZWUgaWYgdGhlIGdpdmVuIGNsYXNzIGRlZmluaXRpb24g\naW1wbGVtZW50cwogICAgICoge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZX0u\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNFbmhhbmNl\nZChieXRlW10gYikgewogICAgICAgIENvbnN0YW50UG9vbFRhYmxlIHRhYmxl\nID0gbmV3IENvbnN0YW50UG9vbFRhYmxlKGIpOwogICAgICAgIGludCBpZHgg\nPSB0YWJsZS5nZXRFbmRJbmRleCgpOwoKICAgICAgICBpZHggKz0gNjsgLy8g\nc2tpcCBhY2Nlc3MsIGNscywgc3VwZXIKICAgICAgICBpbnQgaWZhY2VzID0g\ndGFibGUucmVhZFVuc2lnbmVkU2hvcnQoaWR4KTsKICAgICAgICBpbnQgY2xz\nRW50cnksIHV0ZkVudHJ5OwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgaWZhY2VzOyBpKyspIHsKICAgICAgICAg\nICAgaWR4ICs9IDI7CiAgICAgICAgICAgIGNsc0VudHJ5ID0gdGFibGUucmVh\nZFVuc2lnbmVkU2hvcnQoaWR4KTsKICAgICAgICAgICAgdXRmRW50cnkgPSB0\nYWJsZS5yZWFkVW5zaWduZWRTaG9ydCh0YWJsZS5nZXQoY2xzRW50cnkpKTsK\nICAgICAgICAgICAgbmFtZSA9IHRhYmxlLnJlYWRTdHJpbmcodGFibGUuZ2V0\nKHV0ZkVudHJ5KSk7CiAgICAgICAgICAgIGlmICgib3JnL2FwYWNoZS9vcGVu\nanBhL2VuaGFuY2UvUGVyc2lzdGVuY2VDYXBhYmxlIi5lcXVhbHMobmFtZSkp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgfQp9Cg==\n","encoding":"base64"}

