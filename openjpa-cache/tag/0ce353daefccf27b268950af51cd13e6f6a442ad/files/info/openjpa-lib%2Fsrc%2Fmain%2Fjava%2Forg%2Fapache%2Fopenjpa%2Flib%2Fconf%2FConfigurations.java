{"sha":"cd1c1c2bb0453ef0891a6c3390854a2f8df82be9","node_id":"MDQ6QmxvYjIwNjM2NDpjZDFjMWMyYmIwNDUzZWYwODkxYTZjMzM5MDg1NGEyZjhkZjgyYmU5","size":18709,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/cd1c1c2bb0453ef0891a6c3390854a2f8df82be9","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIuY29uZjsKCmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9y\ndCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1pc3NpbmdSZXNvdXJjZUV4Y2Vw\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwppbXBvcnQgamF2\nYS51dGlsLlRyZWVTZXQ7CmltcG9ydCBqYXZheC5uYW1pbmcuQ29udGV4dDsK\naW1wb3J0IGphdmF4Lm5hbWluZy5Jbml0aWFsQ29udGV4dDsKaW1wb3J0IGph\ndmF4Lm5hbWluZy5OYW1pbmdFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5leGNlcHRpb24uTmVzdGFibGVSdW50aW1lRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlBhcnNlRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlN0cmlu\nZ0Rpc3RhbmNlOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICog\nVXRpbGl0eSBtZXRob2RzIGRlYWxpbmcgd2l0aCBjb25maWd1cmF0aW9uLgog\nKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgQ29uZmlndXJhdGlvbnMgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoQ29uZmlndXJhdGlvbnMuY2xhc3MpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBjbGFzcyBuYW1lIGZyb20gdGhlIGdpdmVuIHBsdWdp\nbiBzdHJpbmcsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBTdHJpbmcgZ2V0Q2xhc3NOYW1lKFN0cmluZyBwbHVnaW4pIHsK\nICAgICAgICByZXR1cm4gZ2V0UGx1Z2luQ29tcG9uZW50KHBsdWdpbiwgdHJ1\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlcnRp\nZXMgcGFydCBvZiB0aGUgZ2l2ZW4gcGx1Z2luIHN0cmluZywgb3IgbnVsbCBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRQ\ncm9wZXJ0aWVzKFN0cmluZyBwbHVnaW4pIHsKICAgICAgICByZXR1cm4gZ2V0\nUGx1Z2luQ29tcG9uZW50KHBsdWdpbiwgZmFsc2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGVpdGhlciB0aGUgY2xhc3MgbmFtZSBvciBwcm9w\nZXJ0aWVzIHN0cmluZyBmcm9tIGEgcGx1Z2luIHN0cmluZy4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdldFBsdWdpbkNvbXBvbmVudChT\ndHJpbmcgcGx1Z2luLCBib29sZWFuIGNsc05hbWUpIHsKICAgICAgICBpZiAo\ncGx1Z2luICE9IG51bGwpCiAgICAgICAgICAgIHBsdWdpbiA9IHBsdWdpbi50\ncmltKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocGx1Z2lu\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGludCBvcGVu\nUGFyZW4gPSAtMTsKICAgICAgICBpZiAocGx1Z2luLmNoYXJBdChwbHVnaW4u\nbGVuZ3RoKCkgLSAxKSA9PSAnKScpCiAgICAgICAgICAgIG9wZW5QYXJlbiA9\nIHBsdWdpbi5pbmRleE9mKCcoJyk7CiAgICAgICAgaWYgKG9wZW5QYXJlbiA9\nPSAtMSkgewogICAgICAgICAgICBpbnQgZXEgPSBwbHVnaW4uaW5kZXhPZign\nPScpOwogICAgICAgICAgICBpZiAoZXEgPT0gLTEpCiAgICAgICAgICAgICAg\nICByZXR1cm4gKGNsc05hbWUpID8gcGx1Z2luIDogbnVsbDsKICAgICAgICAg\nICAgcmV0dXJuIChjbHNOYW1lKSA/IG51bGwgOiBwbHVnaW47CiAgICAgICAg\nfQoKICAgICAgICAvLyBjbHNOYW1lKHByb3BzKSBmb3JtCiAgICAgICAgaWYg\nKGNsc05hbWUpCiAgICAgICAgICAgIHJldHVybiBwbHVnaW4uc3Vic3RyaW5n\nKDAsIG9wZW5QYXJlbikudHJpbSgpOwogICAgICAgIFN0cmluZyBwcm9wID0g\ncGx1Z2luLnN1YnN0cmluZyhvcGVuUGFyZW4gKyAxLAogICAgICAgICAgICBw\nbHVnaW4ubGVuZ3RoKCkgLSAxKS50cmltKCk7CiAgICAgICAgcmV0dXJuIChw\ncm9wLmxlbmd0aCgpID09IDApID8gbnVsbCA6IHByb3A7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjbGFzcyBuYW1lIGFuZCBw\ncm9wZXJ0aWVzIGludG8gYSBwbHVnaW4gc3RyaW5nLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIFN0cmluZyBnZXRQbHVnaW4oU3RyaW5nIGNsc05hbWUs\nIFN0cmluZyBwcm9wcykgewogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KGNsc05hbWUpKQogICAgICAgICAgICByZXR1cm4gcHJvcHM7CiAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocHJvcHMpKQogICAgICAgICAg\nICByZXR1cm4gY2xzTmFtZTsKICAgICAgICByZXR1cm4gY2xzTmFtZSArICIo\nIiArIHByb3BzICsgIikiOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRl\nIHRoZSBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiBjbGFzcyBuYW1lLCB1c2lu\nZyB0aGUgZ2l2ZW4KICAgICAqIGNsYXNzIGxvYWRlci4gTm8gY29uZmlndXJh\ndGlvbiBvZiB0aGUgaW5zdGFuY2UgaXMgcGVyZm9ybWVkIGJ5CiAgICAgKiB0\naGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3Qg\nbmV3SW5zdGFuY2UoU3RyaW5nIGNsc05hbWUsIENsYXNzTG9hZGVyIGxvYWRl\ncikgewogICAgICAgIHJldHVybiBuZXdJbnN0YW5jZShjbHNOYW1lLCBudWxs\nLCBudWxsLCBsb2FkZXIsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGFuZCBjb25maWd1cmUgYW4gaW5zdGFuY2Ugd2l0aCB0aGUgZ2l2\nZW4gY2xhc3MgbmFtZSBhbmQKICAgICAqIHByb3BlcnRpZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBj\nbHNOYW1lLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHBy\nb3BzLCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBPYmplY3Qgb2Jq\nID0gbmV3SW5zdGFuY2UoY2xzTmFtZSwgbnVsbCwgY29uZiwgbG9hZGVyLCB0\ncnVlKTsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHBy\nb3BzKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgogICAg\nICogSGVscGVyIG1ldGhvZCB1c2VkIGJ5IG1lbWJlcnMgb2YgdGhpcyBwYWNr\nYWdlIHRvIGluc3RhbnRpYXRlIHBsdWdpbgogICAgICogdmFsdWVzLgogICAg\nICovCiAgICBzdGF0aWMgT2JqZWN0IG5ld0luc3RhbmNlKFN0cmluZyBjbHNO\nYW1lLCBWYWx1ZSB2YWwsIENvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBD\nbGFzc0xvYWRlciBsb2FkZXIsIGJvb2xlYW4gZmF0YWwpIHsKICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjbHNOYW1lKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsICYmIGNv\nbmYgIT0gbnVsbCkKICAgICAgICAgICAgbG9hZGVyID0gY29uZi5nZXRDbGFz\ncygpLmdldENsYXNzTG9hZGVyKCk7CgogICAgICAgIENsYXNzIGNscyA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY2xzID0gU3RyaW5ncy50\nb0NsYXNzKGNsc05hbWUsIGxvYWRlcik7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBpZiAodmFsICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZSA9IGdldENyZWF0ZUV4Y2VwdGlvbihj\nbHNOYW1lLCB2YWwsIHJlKTsKICAgICAgICAgICAgaWYgKGZhdGFsKQogICAg\nICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgICAgIExvZyBsb2cgPSAo\nY29uZiA9PSBudWxsKSA/IG51bGwgOiBjb25mLmdldENvbmZpZ3VyYXRpb25M\nb2coKTsKICAgICAgICAgICAgaWYgKGxvZyAhPSBudWxsICYmIGxvZy5pc0Vy\ncm9yRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLmVycm9yKF9sb2Mu\nZ2V0KCJwbHVnaW4tY3JlYXRpb24tZXhjZXB0aW9uIiwgdmFsKSwgcmUpOwog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBjbHMubmV3SW5zdGFuY2UoKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBSdW50\naW1lRXhjZXB0aW9uIHJlID0gbmV3IE5lc3RhYmxlUnVudGltZUV4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJvYmotY3JlYXRlIiwgY2xz\nKS5nZXRNZXNzYWdlKCksIGUpOwogICAgICAgICAgICBpZiAoZmF0YWwpCiAg\nICAgICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICAgICAgTG9nIGxvZyA9\nIChjb25mID09IG51bGwpID8gbnVsbCA6IGNvbmYuZ2V0Q29uZmlndXJhdGlv\nbkxvZygpOwogICAgICAgICAgICBpZiAobG9nICE9IG51bGwgJiYgbG9nLmlz\nRXJyb3JFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoX2xv\nYy5nZXQoInBsdWdpbi1jcmVhdGlvbi1leGNlcHRpb24iLCB2YWwpLCByZSk7\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4ge0BsaW5rIENvbmZpZ3VyYXRp\nb259IGluc3RhbmNlIGZyb20gdGhlIGNvbW1hbmQgbGluZQogICAgICogb3B0\naW9ucyBwcm92aWRlZC4gQWxsIHByb3BlcnR5IG5hbWVzIG9mIHRoZSBnaXZl\nbiBjb25maWd1cmF0aW9uIGFyZQogICAgICogcmVjb2duaXplZDsgYWRkaXRp\nb25hbGx5LCBpZiBhIDxjb2RlPnByb3BlcnRpZXM8L2NvZGU+IG9yCiAgICAg\nKiA8Y29kZT5wPC9jb2RlPiBhcmd1bWVudCBleGlzdHMsIHRoZSByZXNvdXJj\nZSBpdAogICAgICogcG9pbnRzIHRvIHdpbGwgYmUgbG9hZGVkIGFuZCBzZXQg\naW50byB0aGUgZ2l2ZW4gY29uZmlndXJhdGlvbiBpbnN0YW5jZS4KICAgICAq\nIEl0IGNhbiBwb2ludCB0byBlaXRoZXIgYSBmaWxlIG9yIGEgcmVzb3VyY2Ug\nbmFtZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIHBvcHVsYXRl\nQ29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYsIE9wdGlvbnMgb3B0\ncykgewogICAgICAgIFN0cmluZyBwcm9wcyA9IG9wdHMucmVtb3ZlUHJvcGVy\ndHkoInByb3BlcnRpZXMiLCAicCIsIG51bGwpOwogICAgICAgIENvbmZpZ3Vy\nYXRpb25Qcm92aWRlciBwcm92aWRlcjsKICAgICAgICBpZiAoIVN0cmluZ1V0\naWxzLmlzRW1wdHkocHJvcHMpKSB7CiAgICAgICAgICAgIFN0cmluZyBwYXRo\nID0gcHJvcHM7CiAgICAgICAgICAgIFN0cmluZyBhbmNob3IgPSBudWxsOwog\nICAgICAgICAgICBpbnQgaWR4ID0gcGF0aC5sYXN0SW5kZXhPZignIycpOwog\nICAgICAgICAgICBpZiAoaWR4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICBp\nZiAoaWR4IDwgcGF0aC5sZW5ndGgoKSAtIDEpCiAgICAgICAgICAgICAgICAg\nICAgYW5jaG9yID0gcGF0aC5zdWJzdHJpbmcoaWR4ICsgMSk7CiAgICAgICAg\nICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAg\nICAgICAgICAgIGlmIChwYXRoLmxlbmd0aCgpID09IDApCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdSZXNvdXJjZUV4Y2VwdGlvbihf\nbG9jLmdldCgiYW5jaG9yLW9ubHkiLAogICAgICAgICAgICAgICAgICAgICAg\nICBwcm9wcykuZ2V0TWVzc2FnZSgpLCBDb25maWd1cmF0aW9ucy5jbGFzcy5n\nZXROYW1lKCksIAogICAgICAgICAgICAgICAgICAgICAgICBwcm9wcyk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIEZpbGUgZmlsZSA9IG5ldyBGaWxl\nKHBhdGgpOwogICAgICAgICAgICBpZiAoZmlsZS5pc0ZpbGUoKSkKICAgICAg\nICAgICAgICAgIHByb3ZpZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWQo\nZmlsZSwgYW5jaG9yLCBudWxsKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBmaWxlID0gbmV3IEZpbGUoIk1FVEEtSU5GIiArIEZpbGUu\nc2VwYXJhdG9yQ2hhciArIHBhdGgpOwogICAgICAgICAgICAgICAgaWYgKGZp\nbGUuaXNGaWxlKCkpCiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXIgPSBQ\ncm9kdWN0RGVyaXZhdGlvbnMubG9hZChmaWxlLCBhbmNob3IsIG51bGwpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHByb3Zp\nZGVyID0gUHJvZHVjdERlcml2YXRpb25zLmxvYWQocGF0aCwgYW5jaG9yLCBu\ndWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHJvdmlkZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHByb3ZpZGVyLnNldEludG8oY29u\nZik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNaXNzaW5nUmVzb3VyY2VFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXByb3Zp\nZGVyIiwKICAgICAgICAgICAgICAgICAgICBwcm9wcykuZ2V0TWVzc2FnZSgp\nLCBDb25maWd1cmF0aW9ucy5jbGFzcy5nZXROYW1lKCksIAogICAgICAgICAg\nICAgICAgICAgIHByb3BzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBwcm92aWRlciA9IFByb2R1Y3REZXJpdmF0aW9ucy5sb2FkRGVmYXVsdHMo\nbnVsbCk7CiAgICAgICAgICAgIGlmIChwcm92aWRlciAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcHJvdmlkZXIuc2V0SW50byhjb25mKTsKICAgICAgICB9\nCiAgICAgICAgb3B0cy5zZXRJbnRvKGNvbmYpOwogICAgfQoKICAgIC8qKgog\nICAgICogSGVscGVyIG1ldGhvZCB0byB0aHJvdyBhbiBpbmZvcm1hdGl2ZSBk\nZXNjcmlwdGlvbiBvbiBpbnN0YW50aWF0aW9uIGVycm9yLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBSdW50aW1lRXhjZXB0aW9uIGdldENyZWF0ZUV4\nY2VwdGlvbihTdHJpbmcgY2xzTmFtZSwKICAgICAgICBWYWx1ZSB2YWwsIEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgLy8gcmUtdGhyb3cgdGhlIGV4Y2VwdGlv\nbiB3aXRoIHNvbWUgYmV0dGVyIGluZm9ybWF0aW9uCiAgICAgICAgZmluYWwg\nU3RyaW5nIG1zZzsKICAgICAgICBmaW5hbCBPYmplY3RbXSBwYXJhbXM7Cgog\nICAgICAgIFN0cmluZyBhbGlhcyA9IHZhbC5hbGlhcyhjbHNOYW1lKTsKICAg\nICAgICBTdHJpbmdbXSBhbGlhc2VzID0gdmFsLmdldEFsaWFzZXMoKTsKICAg\nICAgICBTdHJpbmdbXSBrZXlzOwogICAgICAgIGlmIChhbGlhc2VzLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICBrZXlzID0gYWxpYXNlczsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAga2V5cyA9IG5ldyBTdHJpbmdbYWxpYXNlcy5s\nZW5ndGggLyAyXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBh\nbGlhc2VzLmxlbmd0aDsgaSArPSAyKQogICAgICAgICAgICAgICAga2V5c1tp\nIC8gMl0gPSBhbGlhc2VzW2ldOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5n\nIGNsb3Nlc3Q7CiAgICAgICAgaWYgKGtleXMubGVuZ3RoID09IDApIHsKICAg\nICAgICAgICAgbXNnID0gImludmFsaWQtcGx1Z2luIjsKICAgICAgICAgICAg\ncGFyYW1zID0gbmV3IE9iamVjdFtdeyB2YWwuZ2V0UHJvcGVydHkoKSwgYWxp\nYXMsIGUudG9TdHJpbmcoKSwgfTsKICAgICAgICB9IGVsc2UgaWYgKChjbG9z\nZXN0ID0gU3RyaW5nRGlzdGFuY2UuZ2V0Q2xvc2VzdExldmVuc2h0ZWluRGlz\ndGFuY2UKICAgICAgICAgICAgKGFsaWFzLCBrZXlzLCAwLjVmKSkgPT0gbnVs\nbCkgewogICAgICAgICAgICBtc2cgPSAiaW52YWxpZC1wbHVnaW4tYWxpYXNl\ncyI7CiAgICAgICAgICAgIHBhcmFtcyA9IG5ldyBPYmplY3RbXXsKICAgICAg\nICAgICAgICAgIHZhbC5nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmlu\nZygpLAogICAgICAgICAgICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFzTGlz\ndChrZXlzKSksIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbXNn\nID0gImludmFsaWQtcGx1Z2luLWFsaWFzZXMtaGludCI7CiAgICAgICAgICAg\nIHBhcmFtcyA9IG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAgIHZhbC5n\nZXRQcm9wZXJ0eSgpLCBhbGlhcywgZS50b1N0cmluZygpLAogICAgICAgICAg\nICAgICAgbmV3IFRyZWVTZXQoQXJyYXlzLmFzTGlzdChrZXlzKSksIGNsb3Nl\nc3QsIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgUGFyc2VFeGNl\ncHRpb24oX2xvYy5nZXQobXNnLCBwYXJhbXMpLCBlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9iamVjdCB3aXRoIHRo\nZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAgKiBtYXRjaGluZyB0aGUgcHJv\ncGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVjdCdzIHNldHRlcgogICAgICog\nbWV0aG9kcy4gVGhlIHByb3BlcnRpZXMgc3RyaW5nIHNob3VsZCBiZSBpbiB0\naGUgZm9ybQogICAgICogInByb3AxPXZhbDEsIHByb3AyPXZhbDIgLi4uIi4g\nRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBzZXR0ZXIKICAgICAqIG1ldGhvZHMg\nZXhpc3QgZm9yIHRoZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEB0aHJv\nd3MgUnVudGltZUV4Y2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVycm9yCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJbnN0YW5j\nZShPYmplY3Qgb2JqLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3Ry\naW5nIHByb3BlcnRpZXMpIHsKICAgICAgICBjb25maWd1cmVJbnN0YW5jZShv\nYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwpOwogICAgfQoKICAgIC8qKgog\nICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4gb2JqZWN0IHdpdGggdGhlIGdp\ndmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1hdGNoaW5nIHRoZSBwcm9wZXJ0\naWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mgc2V0dGVyCiAgICAgKiBtZXRo\nb2RzLiBUaGUgcHJvcGVydGllcyBzdHJpbmcgc2hvdWxkIGJlIGluIHRoZSBm\nb3JtCiAgICAgKiAicHJvcDE9dmFsMSwgcHJvcDI9dmFsMiAuLi4iLiBWYWxp\nZGF0ZXMgdGhhdCBzZXR0ZXIgbWV0aG9kcwogICAgICogZXhpc3QgZm9yIHRo\nZSBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgUnVudGltZUV4\nY2VwdGlvbiBvbiBjb25maWd1cmF0aW9uIGVycm9yCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgdm9pZCBjb25maWd1cmVJbnN0YW5jZShPYmplY3Qgb2Jq\nLCBDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgU3RyaW5nIHByb3BlcnRp\nZXMsIFN0cmluZyBjb25maWd1cmF0aW9uTmFtZSkgewogICAgICAgIGlmIChv\nYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBQcm9w\nZXJ0aWVzIHByb3BzID0gbnVsbDsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkocHJvcGVydGllcykpCiAgICAgICAgICAgIHByb3BzID0gcGFy\nc2VQcm9wZXJ0aWVzKHByb3BlcnRpZXMpOwogICAgICAgIGNvbmZpZ3VyZUlu\nc3RhbmNlKG9iaiwgY29uZiwgcHJvcHMsIGNvbmZpZ3VyYXRpb25OYW1lKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIGdpdmVuIG9i\namVjdCB3aXRoIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIGJ5CiAgICAgKiBtYXRj\naGluZyB0aGUgcHJvcGVydGllcyBzdHJpbmcgdG8gdGhlIG9iamVjdCdzIHNl\ndHRlcgogICAgICogbWV0aG9kcy4gRG9lcyBub3QgdmFsaWRhdGUgdGhhdCBz\nZXR0ZXIgbWV0aG9kcyBleGlzdCBmb3IgdGhlIHByb3BlcnRpZXMuCiAgICAg\nKgogICAgICogQHRocm93cyBSdW50aW1lRXhjZXB0aW9uIG9uIGNvbmZpZ3Vy\nYXRpb24gZXJyb3IKICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIGNv\nbmZpZ3VyZUluc3RhbmNlKE9iamVjdCBvYmosIENvbmZpZ3VyYXRpb24gY29u\nZiwKICAgICAgICBQcm9wZXJ0aWVzIHByb3BlcnRpZXMpIHsKICAgICAgICBj\nb25maWd1cmVJbnN0YW5jZShvYmosIGNvbmYsIHByb3BlcnRpZXMsIG51bGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uZmlndXJlcyB0aGUgZ2l2ZW4g\nb2JqZWN0IHdpdGggdGhlIGdpdmVuIHByb3BlcnRpZXMgYnkKICAgICAqIG1h\ndGNoaW5nIHRoZSBwcm9wZXJ0aWVzIHN0cmluZyB0byB0aGUgb2JqZWN0J3Mg\nc2V0dGVyCiAgICAgKiBtZXRob2RzLiBJZiA8Y29kZT5jb25maWd1cmF0aW9u\nTmFtZTwvY29kZT4gaXMKICAgICAqIG5vbi08Y29kZT5udWxsPC9jb2RlPiwg\ndmFsaWRhdGVzIHRoYXQgc2V0dGVyIG1ldGhvZHMgZXhpc3QgZm9yCiAgICAg\nKiB0aGUgcHJvcGVydGllcy4KICAgICAqCiAgICAgKiBAdGhyb3dzIFJ1bnRp\nbWVFeGNlcHRpb24gb24gY29uZmlndXJhdGlvbiBlcnJvcgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgY29uZmlndXJlSW5zdGFuY2UoT2JqZWN0\nIG9iaiwgQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIFByb3BlcnRpZXMg\ncHJvcGVydGllcywgU3RyaW5nIGNvbmZpZ3VyYXRpb25OYW1lKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIE9wdGlvbnMgb3B0czsKICAgICAgICBpZiAocHJvcGVydGllcyBpbnN0\nYW5jZW9mIE9wdGlvbnMpCiAgICAgICAgICAgIG9wdHMgPSAoT3B0aW9ucykg\ncHJvcGVydGllczsKICAgICAgICBlbHNlIHsgCiAgICAgICAgICAgIG9wdHMg\nPSBuZXcgT3B0aW9ucygpOwogICAgICAgICAgICBpZiAocHJvcGVydGllcyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgb3B0cy5wdXRBbGwocHJvcGVydGll\ncyk7CiAgICAgICAgfQoKICAgICAgICBDb25maWd1cmFibGUgY29uZmlndXJh\nYmxlID0gbnVsbDsKICAgICAgICBpZiAoY29uZiAhPSBudWxsICYmIG9iaiBp\nbnN0YW5jZW9mIENvbmZpZ3VyYWJsZSkKICAgICAgICAgICAgY29uZmlndXJh\nYmxlID0gKENvbmZpZ3VyYWJsZSkgb2JqOwoKICAgICAgICBpZiAoY29uZmln\ndXJhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgY29uZmlndXJhYmxlLnNl\ndENvbmZpZ3VyYXRpb24oY29uZik7CiAgICAgICAgICAgIGNvbmZpZ3VyYWJs\nZS5zdGFydENvbmZpZ3VyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgT3B0\naW9ucyBpbnZhbGlkRW50cmllcyA9IG9wdHMuc2V0SW50byhvYmopOwogICAg\nICAgIGlmIChvYmogaW5zdGFuY2VvZiBHZW5lcmljQ29uZmlndXJhYmxlKQog\nICAgICAgICAgICAoKEdlbmVyaWNDb25maWd1cmFibGUpIG9iaikuc2V0SW50\nbyhpbnZhbGlkRW50cmllcyk7CgoJCWlmICghaW52YWxpZEVudHJpZXMuaXNF\nbXB0eSgpICYmIGNvbmZpZ3VyYXRpb25OYW1lICE9IG51bGwpIHsKCQkJTG9j\nYWxpemVyLk1lc3NhZ2UgbXNnID0gbnVsbDsKCQkJU3RyaW5nIGZpcnN0ID0g\nKFN0cmluZykgaW52YWxpZEVudHJpZXMua2V5U2V0KCkuaXRlcmF0b3IoKS5u\nZXh0KCk7CgkJCWlmIChpbnZhbGlkRW50cmllcy5rZXlTZXQoKS5zaXplKCkg\nPT0gMSAmJgoJCQkJZmlyc3QuaW5kZXhPZignLicpID09IC0xKSB7CgkJCQkv\nLyBpZiB0aGVyZSdzIGp1c3Qgb25lIG1pc3NwZWxsaW5nIGFuZCB0aGlzIGlz\nIG5vdCBhCgkJCQkvLyBwYXRoIHRyYXZlcnNhbCwgY2hlY2sgZm9yIG5lYXIg\nbWlzc2VzLgoJCQkJQ29sbGVjdGlvbiBvcHRpb25zID0gT3B0aW9ucy5maW5k\nT3B0aW9uc0ZvcihvYmouZ2V0Q2xhc3MoKSk7CgkJCQlTdHJpbmcgY2xvc2Ug\nPSBTdHJpbmdEaXN0YW5jZS5nZXRDbG9zZXN0TGV2ZW5zaHRlaW5EaXN0YW5j\nZQoJCQkJCShmaXJzdCwgb3B0aW9ucywgMC43NWYpOwoJCQkJaWYgKGNsb3Nl\nICE9IG51bGwpCgkJCQkJbXNnID0gX2xvYy5nZXQoImludmFsaWQtY29uZmln\nLXBhcmFtLWhpbnQiLCBuZXcgT2JqZWN0W117CgkJCQkJCWNvbmZpZ3VyYXRp\nb25OYW1lLCBvYmouZ2V0Q2xhc3MoKSwgZmlyc3QsIGNsb3NlLAoJCQkJCQlv\ncHRpb25zLCB9KTsKCQkJfQoKICAgICAgICAgICAgaWYgKG1zZyA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBtc2cgPSBfbG9jLmdldCgiaW52YWxpZC1j\nb25maWctcGFyYW1zIiwgbmV3IFN0cmluZ1tdewogICAgICAgICAgICAgICAg\nICAgIGNvbmZpZ3VyYXRpb25OYW1lLCBvYmouZ2V0Q2xhc3MoKS5nZXROYW1l\nKCksCiAgICAgICAgICAgICAgICAgICAgaW52YWxpZEVudHJpZXMua2V5U2V0\nKCkudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICBPcHRpb25zLmZp\nbmRPcHRpb25zRm9yKG9iai5nZXRDbGFzcygpKS50b1N0cmluZygpLCB9KTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgUGFyc2VFeGNl\ncHRpb24obXNnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbmZpZ3VyYWJs\nZSAhPSBudWxsKQogICAgICAgICAgICBjb25maWd1cmFibGUuZW5kQ29uZmln\ndXJhdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogVHVybiBhIHNldCBv\nZiBwcm9wZXJ0aWVzIGludG8gYSBjb21tYS1zZXBhcmF0ZWQgc3RyaW5nLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBzZXJpYWxpemVQcm9w\nZXJ0aWVzKE1hcCBtYXApIHsKICAgICAgICBpZiAobWFwID09IG51bGwgfHwg\nbWFwLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAg\nICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIFN0cmluZyB2YWw7CiAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlTZXQoKS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9\nIChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChidWYu\nbGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAi\nKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChlbnRyeS5nZXRLZXkoKSkuYXBw\nZW5kKCc9Jyk7CiAgICAgICAgICAgIHZhbCA9IFN0cmluZy52YWx1ZU9mKGVu\ndHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICBpZiAodmFsLmluZGV4T2Yo\nJywnKSAhPSAtMSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoJyInKS5h\ncHBlbmQodmFsKS5hcHBlbmQoJyInKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCh2YWwpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBhIHNldCBvZiBwcm9wZXJ0aWVzIGZyb20gYSBjb21tYS1zZXBh\ncmF0ZWQgc3RyaW5nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9wdGlv\nbnMgcGFyc2VQcm9wZXJ0aWVzKFN0cmluZyBwcm9wZXJ0aWVzKSB7CiAgICAg\nICAgT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBwcm9w\nZXJ0aWVzID0gU3RyaW5nVXRpbHMudHJpbVRvTnVsbChwcm9wZXJ0aWVzKTsK\nICAgICAgICBpZiAocHJvcGVydGllcyA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gb3B0czsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5n\nW10gcHJvcHMgPSBTdHJpbmdzLnNwbGl0KHByb3BlcnRpZXMsICIsIiwgMCk7\nCiAgICAgICAgICAgIGludCBpZHg7CiAgICAgICAgICAgIGNoYXIgcXVvdGU7\nCiAgICAgICAgICAgIFN0cmluZyBwcm9wOwogICAgICAgICAgICBTdHJpbmcg\ndmFsOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByb3BzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZHggPSBwcm9wc1tpXS5p\nbmRleE9mKCc9Jyk7CiAgICAgICAgICAgICAgICBpZiAoaWR4ID09IC0xKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGtleSBpcyBub3QgYXNz\naWduZWQgdG8gYW55IHZhbHVlLCBzZXQgdGhlCiAgICAgICAgICAgICAgICAg\nICAgLy8gdmFsdWUgdG8gdGhlIHNhbWUgdGhpbmcgYXMgdGhlIGtleSwgYW5k\nIGNvbnRpbnVlLgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgcGVybWl0\ncyBHZW5lcmljQ29uZmlndXJhYmxlIGluc3RhbmNlcyB0bwogICAgICAgICAg\nICAgICAgICAgIC8vIGJlaGF2ZSBtZWFuaW5nZnVsbHkuIFdlIG1pZ2h0IGNv\nbnNpZGVyIHNldHRpbmcgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gdmFs\ndWUgdG8gc29tZSB3ZWxsLWtub3duICJ2YWx1ZSB3YXMgbm90IHNldCwgYnV0\nCiAgICAgICAgICAgICAgICAgICAgLy8ga2V5IGlzIHByZXNlbnQiIHN0cmlu\nZyBzbyB0aGF0IGluc3RhbmNlcyBnZXR0aW5nCiAgICAgICAgICAgICAgICAg\nICAgLy8gdmFsdWVzIGluamVjdGVkIGNhbiBkaWZmZXJlbnRpYXRlIGJldHdl\nZW4gYSBtZW50aW9uZWQKICAgICAgICAgICAgICAgICAgICAvLyBwcm9wZXJ0\neSBhbmQgb25lIHNldCB0byBhIHBhcnRpY3VsYXIgdmFsdWUuCiAgICAgICAg\nICAgICAgICAgICAgcHJvcCA9IHByb3BzW2ldOwogICAgICAgICAgICAgICAg\nICAgIHZhbCA9IHByb3A7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIHByb3AgPSBwcm9wc1tpXS5zdWJzdHJpbmcoMCwg\naWR4KS50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gcHJvcHNb\naV0uc3Vic3RyaW5nKGlkeCArIDEpLnRyaW0oKTsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgdmFsdWUgaXMgcXVvdGVk\nLCByZWFkIHVudGlsIHRoZSBlbmQgcXVvdGUKICAgICAgICAgICAgICAgIGlm\nICgoKHZhbC5zdGFydHNXaXRoKCJcIiIpICYmIHZhbC5lbmRzV2l0aCgiXCIi\nKSkKICAgICAgICAgICAgICAgICAgICB8fCAodmFsLnN0YXJ0c1dpdGgoIici\nKSAmJiB2YWwuZW5kc1dpdGgoIiciKSkpCiAgICAgICAgICAgICAgICAgICAg\nJiYgdmFsLmxlbmd0aCgpID4gMSkKICAgICAgICAgICAgICAgICAgICB2YWwg\nPSB2YWwuc3Vic3RyaW5nKDEsIHZhbC5sZW5ndGgoKSAtIDEpOwogICAgICAg\nICAgICAgICAgZWxzZSBpZiAodmFsLnN0YXJ0c1dpdGgoIlwiIikgfHwgdmFs\nLnN0YXJ0c1dpdGgoIiciKSkgewogICAgICAgICAgICAgICAgICAgIHF1b3Rl\nID0gdmFsLmNoYXJBdCgwKTsKICAgICAgICAgICAgICAgICAgICBTdHJpbmdC\ndWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcih2YWwuc3Vic3RyaW5nKDEp\nKTsKICAgICAgICAgICAgICAgICAgICBpbnQgcXVvdElkeDsKICAgICAgICAg\nICAgICAgICAgICB3aGlsZSAoKytpIDwgcHJvcHMubGVuZ3RoKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwiKTsKCiAgICAgICAg\nICAgICAgICAgICAgICAgIHF1b3RJZHggPSBwcm9wc1tpXS5pbmRleE9mKHF1\nb3RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHF1b3RJZHggIT0g\nLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\ncHJvcHNbaV0uc3Vic3RyaW5nKDAsIHF1b3RJZHgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChxdW90SWR4ICsgMSA8IHByb3BzW2ldLmxl\nbmd0aCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQocHJvcHNbaV0uc3Vic3RyaW5nKHF1b3RJZHggKyAxKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKHByb3BzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgdmFsID0gYnVmLnRvU3RyaW5nKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvcHRzLnB1dChwcm9wLCB2\nYWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvcHRzOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFBhcnNlRXhjZXB0aW9uKF9sb2MuZ2V0KCJwcm9w\nLXBhcnNlIiwgcHJvcGVydGllcyksIHJlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBMb29rcyB1cCB0aGUgZ2l2ZW4gbmFtZSBpbiBKTkRJ\nLiBJZiB0aGUgbmFtZSBpcyBudWxsLCBudWxsIGlzIHJldHVybmVkLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBsb29rdXAoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbnRleHQgY3R4\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjdHggPSBuZXcg\nSW5pdGlhbENvbnRleHQoKTsKICAgICAgICAgICAgcmV0dXJuIGN0eC5sb29r\ndXAobmFtZSk7CiAgICAgICAgfSBjYXRjaCAoTmFtaW5nRXhjZXB0aW9uIG5l\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOZXN0YWJsZVJ1bnRpbWVFeGNl\ncHRpb24oCiAgICAgICAgICAgICAgICBfbG9jLmdldCgibmFtaW5nLWVyciIs\nIG5hbWUpLmdldE1lc3NhZ2UoKSwgbmUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChjdHggIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7IGN0eC5jbG9zZSgpOyB9IGNhdGNoIChFeGNlcHRpb24gZSkge30K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHdoZXRoZXIg\ndGhlIG1hcCBjb250YWlucyB0aGUgZ2l2ZW4ga2V5LCBwcmVmaXhlZCB3aXRo\nIGFueSBwb3NzaWJsZQogICAgICogY29uZmlndXJhdGlvbiBwcmVmaXguCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBjb250YWluc1Byb3Bl\ncnR5KFN0cmluZyBrZXksIE1hcCBwcm9wcykgewogICAgICAgIGlmIChrZXkg\nPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgU3RyaW5nW10gcHJlZml4ZXMgPSBQcm9kdWN0RGVy\naXZhdGlvbnMuZ2V0Q29uZmlndXJhdGlvblByZWZpeGVzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgaWYgKHByb3BzLmNvbnRhaW5zS2V5KHByZWZpeGVzW2ldICsg\nIi4iICsga2V5KSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0\naGUgcHJvcGVydHkgdW5kZXIgdGhlIGdpdmVuIGtleSwgcHJlZml4ZWQgd2l0\naCBhbnkgcG9zc2libGUKICAgICAqIGNvbmZpZ3VyYXRpb24gcHJlZml4Lgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBnZXRQcm9wZXJ0eShT\ndHJpbmcga2V5LCBNYXAgcHJvcHMpIHsKICAgICAgICBpZiAoa2V5ID09IG51\nbGwgfHwgcHJvcHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgU3RyaW5nW10gcHJlZml4ZXMgPSBQcm9kdWN0RGVyaXZhdGlv\nbnMuZ2V0Q29uZmlndXJhdGlvblByZWZpeGVzKCk7CiAgICAgICAgT2JqZWN0\nIHZhbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByZWZpeGVzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhbCA9IHByb3BzLmdldChwcmVm\naXhlc1tpXSArICIuIiArIGtleSk7CiAgICAgICAgICAgIGlmICh2YWwgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIHRoZSBwcm9wZXJ0eSB1bmRlciB0aGUgZ2l2ZW4ga2V5LCBwcmVmaXhl\nZCB3aXRoIGFueSBwb3NzaWJsZQogICAgICogY29uZmlndXJhdGlvbiBwcmVm\naXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IHJlbW92ZVBy\nb3BlcnR5KFN0cmluZyBrZXksIE1hcCBwcm9wcykgewogICAgICAgIGlmIChr\nZXkgPT0gbnVsbCB8fCBwcm9wcyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9IFByb2R1Y3RE\nZXJpdmF0aW9ucy5nZXRDb25maWd1cmF0aW9uUHJlZml4ZXMoKTsKICAgICAg\nICBPYmplY3QgdmFsID0gbnVsbDsKICAgICAgICBPYmplY3QgY3VyOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcHJlZml4ZXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgY3VyID0gcHJvcHMucmVtb3ZlKHByZWZpeGVzW2ld\nICsgIi4iICsga2V5KTsKICAgICAgICAgICAgaWYgKGN1ciAhPSBudWxsICYm\nIHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgdmFsID0gY3VyOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdmFsOwogICAgfQp9Cg==\n","encoding":"base64"}

