{"sha":"8a58af1708fd253a7e3c1ac1229f81027f419444","node_id":"MDQ6QmxvYjIwNjM2NDo4YTU4YWYxNzA4ZmQyNTNhN2UzYzFhYzEyMjlmODEwMjdmNDE5NDQ0","size":20253,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8a58af1708fd253a7e3c1ac1229f81027f419444","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIuamRiYzsKCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5N\nZXRob2Q7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJsZVN0YXRlbWVudDsKaW1w\nb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZhLnNxbC5EYXRh\nYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0ZW1l\nbnQ7CmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZh\nLnNxbC5TUUxXYXJuaW5nOwppbXBvcnQgamF2YS5zcWwuU2F2ZXBvaW50Owpp\nbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJsZVJ1bnRpbWVFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ2xv\nc2VhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIFdy\nYXBwZXIgYXJvdW5kIGFuIGV4aXN0aW5nIGNvbm5lY3Rpb24uIFN1YmNsYXNz\nZXMgY2FuIG92ZXJyaWRlIHRoZQogKiBtZXRob2RzIHdob3NlIGJlaGF2aW9y\nIHRoZXkgbWVhbiB0byBjaGFuZ2UuIFRoZSA8Y29kZT5lcXVhbHM8L2NvZGU+\nIGFuZAogKiA8Y29kZT5oYXNoQ29kZTwvY29kZT4gbWV0aG9kcyBwYXNzIHRo\ncm91Z2ggdG8gdGhlIGJhc2UgdW5kZXJseWluZyBkYXRhCiAqIHN0b3JlIGNv\nbm5lY3Rpb24uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMg\nY2xhc3MgRGVsZWdhdGluZ0Nvbm5lY3Rpb24gaW1wbGVtZW50cyBDb25uZWN0\naW9uLCBDbG9zZWFibGUgewoKICAgIC8vIGpkYmMgMyBtZXRob2Qga2V5cwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IFNFVF9IT0xEQUJJTElU\nWSA9IG5ldyBPYmplY3QoKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9i\namVjdCBHRVRfSE9MREFCSUxJVFkgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgU0VUX1NBVkVQT0lOVF9OT05BTUUg\nPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmpl\nY3QgU0VUX1NBVkVQT0lOVCA9IG5ldyBPYmplY3QoKTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE9iamVjdCBST0xMQkFDS19TQVZFUE9JTlQgPSBuZXcg\nT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgUkVM\nRUFTRV9TQVZFUE9JTlQgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBPYmplY3QgQ1JFQVRFX1NUQVRFTUVOVCA9IG5ldyBPYmpl\nY3QoKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9iamVjdCBQUkVQQVJF\nX1NUQVRFTUVOVCA9IG5ldyBPYmplY3QoKTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIE9iamVjdCBQUkVQQVJFX0NBTEwgPSBuZXcgT2JqZWN0KCk7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgUFJFUEFSRV9XSVRIX0tF\nWVMgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBP\nYmplY3QgUFJFUEFSRV9XSVRIX0lOREVYID0gbmV3IE9iamVjdCgpOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IFBSRVBBUkVfV0lUSF9OQU1F\nUyA9IG5ldyBPYmplY3QoKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAg\nKERlbGVnYXRpbmdDb25uZWN0aW9uLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBNYXAgX2pkYmMzOwoKICAgIHN0YXRpYyB7CiAgICAgICAg\nYm9vbGVhbiBqZGJjMyA9IGZhbHNlOwogICAgICAgIE1ldGhvZCBtID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBtID0gQ29ubmVjdGlvbi5j\nbGFzcy5nZXRNZXRob2QoInNldFNhdmVwb2ludCIsCiAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAgICBq\nZGJjMyA9IHRydWU7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICB9CgogICAgICAgIGlmIChqZGJjMykgewogICAgICAgICAgICBf\namRiYzMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICBfamRiYzMucHV0\nKFNFVF9TQVZFUE9JTlQsIG0pOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBfamRiYzMgPSBudWxsOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgQ29u\nbmVjdGlvbiBfY29ubjsKICAgIHByaXZhdGUgZmluYWwgRGVsZWdhdGluZ0Nv\nbm5lY3Rpb24gX2RlbDsKCiAgICBwdWJsaWMgRGVsZWdhdGluZ0Nvbm5lY3Rp\nb24oQ29ubmVjdGlvbiBjb25uKSB7CiAgICAgICAgX2Nvbm4gPSBjb25uOwog\nICAgICAgIGlmIChjb25uIGluc3RhbmNlb2YgRGVsZWdhdGluZ0Nvbm5lY3Rp\nb24pCiAgICAgICAgICAgIF9kZWwgPSAoRGVsZWdhdGluZ0Nvbm5lY3Rpb24p\nIF9jb25uOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2RlbCA9IG51bGw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHdyYXBwZWQgY29u\nbmVjdGlvbi4KICAgICAqLwogICAgcHVibGljIENvbm5lY3Rpb24gZ2V0RGVs\nZWdhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9jb25uOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBiYXNlIHVuZGVybHlpbmcgZGF0YSBzdG9y\nZSBjb25uZWN0aW9uLgogICAgICovCiAgICBwdWJsaWMgQ29ubmVjdGlvbiBn\nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpIHsKICAgICAgICByZXR1cm4gKF9kZWwg\nPT0gbnVsbCkgPyBfY29ubiA6IF9kZWwuZ2V0SW5uZXJtb3N0RGVsZWdhdGUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAg\nIHJldHVybiBnZXRJbm5lcm1vc3REZWxlZ2F0ZSgpLmhhc2hDb2RlKCk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBEZWxlZ2F0\naW5nQ29ubmVjdGlvbikKICAgICAgICAgICAgb3RoZXIgPSAoKERlbGVnYXRp\nbmdDb25uZWN0aW9uKSBvdGhlcikuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsK\nICAgICAgICByZXR1cm4gZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKS5lcXVhbHMo\nb3RoZXIpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7\nCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo\nImNvbm4gIikuYXBwZW5kKGhhc2hDb2RlKCkpOwogICAgICAgIGFwcGVuZElu\nZm8oYnVmKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kSW5mbyhTdHJpbmdCdWZmZXIg\nYnVmKSB7CiAgICAgICAgaWYgKF9kZWwgIT0gbnVsbCkKICAgICAgICAgICAg\nX2RlbC5hcHBlbmRJbmZvKGJ1Zik7CiAgICB9CgogICAgcHVibGljIFN0YXRl\nbWVudCBjcmVhdGVTdGF0ZW1lbnQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gY3JlYXRlU3RhdGVtZW50KHRydWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgc3RhdGVtZW50LCB3aXRoIHRoZSBv\ncHRpb24gb2Ygbm90IHdyYXBwaW5nIGl0IGluIGEKICAgICAqIHtAbGluayBE\nZWxlZ2F0aW5nU3RhdGVtZW50fSwgd2hpY2ggaXMgdGhlIGRlZmF1bHQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50\nKGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9IG51bGwpCiAg\nICAgICAgICAgIHN0bW50ID0gX2RlbC5jcmVhdGVTdGF0ZW1lbnQoZmFsc2Up\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQgPSBfY29ubi5jcmVh\ndGVTdGF0ZW1lbnQoKTsKICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAg\nc3RtbnQgPSBuZXcgRGVsZWdhdGluZ1N0YXRlbWVudChzdG1udCwgdGhpcyk7\nCiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoKICAgIHB1YmxpYyBQcmVw\nYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzdHIpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBwcmVwYXJlU3Rh\ndGVtZW50KHN0ciwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVw\nYXJlIGEgc3RhdGVtZW50LCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdyYXBw\naW5nIGl0IGluIGEKICAgICAqIHtAbGluayBEZWxlZ2F0aW5nUHJlcGFyZWRT\ndGF0ZW1lbnR9LCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQo\nU3RyaW5nIHN0ciwgYm9vbGVhbiB3cmFwKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50Owog\nICAgICAgIGlmIChfZGVsICE9IG51bGwpCiAgICAgICAgICAgIHN0bW50ID0g\nX2RlbC5wcmVwYXJlU3RhdGVtZW50KHN0ciwgZmFsc2UpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgc3RtbnQgPSBfY29ubi5wcmVwYXJlU3RhdGVtZW50\nKHN0cik7CiAgICAgICAgaWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0g\nbmV3IERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudChzdG1udCwgdGhpcyk7\nCiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoKICAgIHB1YmxpYyBDYWxs\nYWJsZVN0YXRlbWVudCBwcmVwYXJlQ2FsbChTdHJpbmcgc3RyKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcHJlcGFyZUNhbGwoc3Ry\nLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmUgYSBjYWxs\nLCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdyYXBwaW5nIGl0IGluIGEKICAg\nICAqIHtAbGluayBEZWxlZ2F0aW5nQ2FsbGFibGVTdGF0ZW1lbnR9LCB3aGlj\naCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIENhbGxh\nYmxlU3RhdGVtZW50IHByZXBhcmVDYWxsKFN0cmluZyBzdHIsIGJvb2xlYW4g\nd3JhcCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBD\nYWxsYWJsZVN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2RlbCAhPSBu\ndWxsKQogICAgICAgICAgICBzdG1udCA9IF9kZWwucHJlcGFyZUNhbGwoc3Ry\nLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udCA9IF9j\nb25uLnByZXBhcmVDYWxsKHN0cik7CiAgICAgICAgaWYgKHdyYXApCiAgICAg\nICAgICAgIHN0bW50ID0gbmV3IERlbGVnYXRpbmdDYWxsYWJsZVN0YXRlbWVu\ndChzdG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgbmF0aXZlU1FMKFN0cmluZyBzdHIpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBfY29ubi5uYXRpdmVT\nUUwoc3RyKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRvQ29tbWl0\nKGJvb2xlYW4gYm9vbCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nX2Nvbm4uc2V0QXV0b0NvbW1pdChib29sKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRBdXRvQ29tbWl0KCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIF9jb25uLmdldEF1dG9Db21taXQoKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBfY29ubi5jb21taXQoKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByb2xsYmFjaygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIF9jb25uLnJvbGxiYWNrKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY2xv\nc2UoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBfY29ubi5jbG9z\nZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2VkKCkgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIF9jb25uLmlzQ2xv\nc2VkKCk7CiAgICB9CgogICAgcHVibGljIERhdGFiYXNlTWV0YURhdGEgZ2V0\nTWV0YURhdGEoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIG1ldGFkYXRhLCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdy\nYXBwaW5nIGl0IGluIGEKICAgICAqIHtAbGluayBEZWxlZ2F0aW5nRGF0YWJh\nc2VNZXRhRGF0YX0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgRGF0YWJhc2VNZXRhRGF0YSBnZXRNZXRhRGF0YShib29s\nZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIERhdGFi\nYXNlTWV0YURhdGEgbWV0YTsKICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQog\nICAgICAgICAgICBtZXRhID0gX2RlbC5nZXRNZXRhRGF0YShmYWxzZSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBtZXRhID0gX2Nvbm4uZ2V0TWV0YURh\ndGEoKTsKICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgbWV0YSA9IG5l\ndyBEZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YShtZXRhLCB0aGlzKTsKICAg\nICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRS\nZWFkT25seShib29sZWFuIGJvb2wpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIF9jb25uLnNldFJlYWRPbmx5KGJvb2wpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzUmVhZE9ubHkoKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gX2Nvbm4uaXNSZWFkT25seSgpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldENhdGFsb2coU3RyaW5nIHN0cikgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgX2Nvbm4uc2V0Q2F0YWxvZyhzdHIp\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2F0YWxvZygpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBfY29ubi5nZXRDYXRh\nbG9nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJhbnNhY3Rpb25J\nc29sYXRpb24oaW50IGkpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIF9jb25uLnNldFRyYW5zYWN0aW9uSXNvbGF0aW9uKGkpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0VHJhbnNhY3Rpb25Jc29sYXRpb24oKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gX2Nvbm4uZ2V0VHJhbnNh\nY3Rpb25Jc29sYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgU1FMV2Fybmlu\nZyBnZXRXYXJuaW5ncygpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBfY29ubi5nZXRXYXJuaW5ncygpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsZWFyV2FybmluZ3MoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBfY29ubi5jbGVhcldhcm5pbmdzKCk7CiAgICB9CgogICAgcHVi\nbGljIFN0YXRlbWVudCBjcmVhdGVTdGF0ZW1lbnQoaW50IHR5cGUsIGludCBj\nb25jdXIpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBj\ncmVhdGVTdGF0ZW1lbnQodHlwZSwgY29uY3VyLCB0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENyZWF0ZSBhIHN0YXRlbWVudCwgd2l0aCB0aGUgb3B0\naW9uIG9mIG5vdCB3cmFwcGluZyBpdCBpbiBhCiAgICAgKiB7QGxpbmsgRGVs\nZWdhdGluZ1N0YXRlbWVudH0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU3RhdGVtZW50IGNyZWF0ZVN0YXRlbWVudChp\nbnQgdHlwZSwgaW50IGNvbmN1ciwgYm9vbGVhbiB3cmFwKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0YXRlbWVudCBzdG1udDsK\nICAgICAgICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAgICAgICBzdG1udCA9\nIF9kZWwuY3JlYXRlU3RhdGVtZW50KHR5cGUsIGNvbmN1ciwgZmFsc2UpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQgPSBfY29ubi5jcmVhdGVT\ndGF0ZW1lbnQodHlwZSwgY29uY3VyKTsKICAgICAgICBpZiAod3JhcCkKICAg\nICAgICAgICAgc3RtbnQgPSBuZXcgRGVsZWdhdGluZ1N0YXRlbWVudChzdG1u\ndCwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHN0bW50OwogICAgfQoKICAgIHB1\nYmxpYyBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmlu\nZyBzdHIsIGludCB0eXBlLCBpbnQgY29uY3VyKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBwcmVwYXJlU3RhdGVtZW50\nKHN0ciwgdHlwZSwgY29uY3VyLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFByZXBhcmUgYSBzdGF0ZW1lbnQsIHdpdGggdGhlIG9wdGlvbiBvZiBu\nb3Qgd3JhcHBpbmcgaXQgaW4gYQogICAgICoge0BsaW5rIERlbGVnYXRpbmdQ\ncmVwYXJlZFN0YXRlbWVudH0sIHdoaWNoIGlzIHRoZSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0\nYXRlbWVudChTdHJpbmcgc3RyLCBpbnQgdHlwZSwKICAgICAgICBpbnQgY29u\nY3VyLCBib29sZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVs\nICE9IG51bGwpCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5wcmVwYXJlU3Rh\ndGVtZW50KHN0ciwgdHlwZSwgY29uY3VyLCBmYWxzZSk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdG1udCA9IF9jb25uLnByZXBhcmVTdGF0ZW1lbnQo\nc3RyLCB0eXBlLCBjb25jdXIpOwogICAgICAgIGlmICh3cmFwKQogICAgICAg\nICAgICBzdG1udCA9IG5ldyBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQo\nc3RtbnQsIHRoaXMpOwogICAgICAgIHJldHVybiBzdG1udDsKICAgIH0KCiAg\nICBwdWJsaWMgQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoU3RyaW5n\nIHN0ciwgaW50IHR5cGUsIGludCBjb25jdXIpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVDYWxsKHN0ciwg\ndHlwZSwgY29uY3VyLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBy\nZXBhcmUgYSBjYWxsLCB3aXRoIHRoZSBvcHRpb24gb2Ygbm90IHdyYXBwaW5n\nIGl0IGluIGEKICAgICAqIHtAbGluayBEZWxlZ2F0aW5nQ2FsbGFibGVTdGF0\nZW1lbnR9LCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVDYWxsKFN0cmluZyBz\ndHIsIGludCB0eXBlLCBpbnQgY29uY3VyLAogICAgICAgIGJvb2xlYW4gd3Jh\ncCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2FsbGFibGVTdGF0\nZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwgIT0gbnVsbCkKICAgICAg\nICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVDYWxsKHN0ciwgdHlwZSwgY29u\nY3VyLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udCA9\nIF9jb25uLnByZXBhcmVDYWxsKHN0ciwgdHlwZSwgY29uY3VyKTsKICAgICAg\nICBpZiAod3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBuZXcgRGVsZWdhdGlu\nZ0NhbGxhYmxlU3RhdGVtZW50KHN0bW50LCB0aGlzKTsKICAgICAgICByZXR1\ncm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGljIE1hcCBnZXRUeXBlTWFwKCkg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIF9jb25uLmdl\ndFR5cGVNYXAoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlTWFw\nKE1hcCBtYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIF9jb25u\nLnNldFR5cGVNYXAobWFwKTsKICAgIH0KCiAgICAvLyBKREJDIDMuMCBtZXRo\nb2RzIGZvbGxvdzsgdGhlc2UgYXJlIHJlcXVpcmVkIHRvIGJlIGFibGUgdG8K\nICAgIC8vIGNvbXBpbGUgYWdhaW5zdCBKREsgMS40OyB0aGVzZSBtZXRob2Rz\nIHdpbGwgbm90IHdvcmsgb24KICAgIC8vIHByZXZpb3VzIEpWTXMKCiAgICBw\ndWJsaWMgdm9pZCBzZXRIb2xkYWJpbGl0eShpbnQgaG9sZGFiaWxpdHkpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAg\nICAgICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBfamRiYzMuZ2V0KFNFVF9IT0xE\nQUJJTElUWSk7CiAgICAgICAgaWYgKG0gPT0gbnVsbCkKICAgICAgICAgICAg\nbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFNFVF9IT0xEQUJJTElUWSwgInNldEhv\nbGRhYmlsaXR5IiwKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQu\nY2xhc3MgfSk7CiAgICAgICAgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtd\neyBOdW1iZXJzLnZhbHVlT2YoaG9sZGFiaWxpdHkpIH0pOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0SG9sZGFiaWxpdHkoKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBhc3NlcnRKREJDMygpOwogICAgICAgIE1ldGhvZCBt\nID0gKE1ldGhvZCkgX2pkYmMzLmdldChHRVRfSE9MREFCSUxJVFkpOwogICAg\nICAgIGlmIChtID09IG51bGwpCiAgICAgICAgICAgIG0gPSBjcmVhdGVKREJD\nM01ldGhvZChHRVRfSE9MREFCSUxJVFksICJnZXRIb2xkYWJpbGl0eSIsIG51\nbGwpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgaW52b2tlSkRCQzMobSwg\nbnVsbCkpLmludFZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIFNhdmVwb2lu\ndCBzZXRTYXZlcG9pbnQoKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBhc3NlcnRKREJDMygpOwogICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkg\nX2pkYmMzLmdldChTRVRfU0FWRVBPSU5UX05PTkFNRSk7CiAgICAgICAgaWYg\nKG0gPT0gbnVsbCkKICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9k\nKFNFVF9TQVZFUE9JTlRfTk9OQU1FLCAic2V0U2F2ZXBvaW50IiwgbnVsbCk7\nCiAgICAgICAgcmV0dXJuIChTYXZlcG9pbnQpIGludm9rZUpEQkMzKG0sIG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyBTYXZlcG9pbnQgc2V0U2F2ZXBvaW50\nKFN0cmluZyBzYXZlcG9pbnQpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9k\nKSBfamRiYzMuZ2V0KFNFVF9TQVZFUE9JTlQpOwogICAgICAgIGlmIChtID09\nIG51bGwpCiAgICAgICAgICAgIG0gPSBjcmVhdGVKREJDM01ldGhvZChTRVRf\nU0FWRVBPSU5ULCAic2V0U2F2ZXBvaW50IiwKICAgICAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgcmV0dXJuIChT\nYXZlcG9pbnQpIGludm9rZUpEQkMzKG0sIG5ldyBPYmplY3RbXXsgc2F2ZXBv\naW50IH0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKFNhdmVw\nb2ludCBzYXZlcG9pbnQpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGFzc2VydEpEQkMzKCk7CiAgICAgICAgTWV0aG9kIG0gPSAoTWV0aG9kKSBf\namRiYzMuZ2V0KFJPTExCQUNLX1NBVkVQT0lOVCk7CiAgICAgICAgaWYgKG0g\nPT0gbnVsbCkKICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFJP\nTExCQUNLX1NBVkVQT0lOVCwgInJvbGxiYWNrIiwKICAgICAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBTYXZlcG9pbnQuY2xhc3MgfSk7CiAgICAgICAgaW52\nb2tlSkRCQzMobSwgbmV3IE9iamVjdFtdeyBzYXZlcG9pbnQgfSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcmVsZWFzZVNhdmVwb2ludChTYXZlcG9pbnQg\nc2F2ZXBvaW50KSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3Nl\ncnRKREJDMygpOwogICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMz\nLmdldChSRUxFQVNFX1NBVkVQT0lOVCk7CiAgICAgICAgaWYgKG0gPT0gbnVs\nbCkKICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFJFTEVBU0Vf\nU0FWRVBPSU5ULCAicmVsZWFzZVNhdmVwb2ludCIsCiAgICAgICAgICAgICAg\nICBuZXcgQ2xhc3NbXXsgU2F2ZXBvaW50LmNsYXNzIH0pOwogICAgICAgIGlu\ndm9rZUpEQkMzKG0sIG5ldyBPYmplY3RbXXsgc2F2ZXBvaW50IH0pOwogICAg\nfQoKICAgIHB1YmxpYyBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCBy\nZXN1bHRTZXRUeXBlLAogICAgICAgIGludCByZXN1bHRTZXRDb25jdXJyZW5j\neSwgaW50IHJlc3VsdFNldEhvbGRhYmlsaXR5KQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAg\ncmV0dXJuIGNyZWF0ZVN0YXRlbWVudChyZXN1bHRTZXRUeXBlLCByZXN1bHRT\nZXRDb25jdXJyZW5jeSwKICAgICAgICAgICAgcmVzdWx0U2V0SG9sZGFiaWxp\ndHksIHRydWUpOwogICAgfQoKICAgIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3Jl\nYXRlU3RhdGVtZW50KGludCByZXN1bHRTZXRUeXBlLAogICAgICAgIGludCBy\nZXN1bHRTZXRDb25jdXJyZW5jeSwgaW50IHJlc3VsdFNldEhvbGRhYmlsaXR5\nLCBib29sZWFuIHdyYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9\nIG51bGwpCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5jcmVhdGVTdGF0ZW1l\nbnQocmVzdWx0U2V0VHlwZSwgcmVzdWx0U2V0Q29uY3VycmVuY3ksCiAgICAg\nICAgICAgICAgICByZXN1bHRTZXRIb2xkYWJpbGl0eSwgZmFsc2UpOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICBNZXRob2QgbSA9IChNZXRob2QpIF9q\nZGJjMy5nZXQoQ1JFQVRFX1NUQVRFTUVOVCk7CiAgICAgICAgICAgIGlmICht\nID09IG51bGwpCiAgICAgICAgICAgICAgICBtID0gY3JlYXRlSkRCQzNNZXRo\nb2QoQ1JFQVRFX1NUQVRFTUVOVCwgImNyZWF0ZVN0YXRlbWVudCIsCiAgICAg\nICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcywgaW50LmNs\nYXNzLCBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgIHN0bW50ID0gKFN0YXRl\nbWVudCkgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtdewogICAgICAgICAg\nICAgICAgTnVtYmVycy52YWx1ZU9mKHJlc3VsdFNldFR5cGUpLAogICAgICAg\nICAgICAgICAgTnVtYmVycy52YWx1ZU9mKHJlc3VsdFNldENvbmN1cnJlbmN5\nKSwKICAgICAgICAgICAgICAgIE51bWJlcnMudmFsdWVPZihyZXN1bHRTZXRI\nb2xkYWJpbGl0eSkgfSk7CiAgICAgICAgfQogICAgICAgIGlmICh3cmFwKQog\nICAgICAgICAgICBzdG1udCA9IG5ldyBEZWxlZ2F0aW5nU3RhdGVtZW50KHN0\nbW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAg\ncHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3Ry\naW5nIHNxbCwKICAgICAgICBpbnQgcmVzdWx0U2V0VHlwZSwgaW50IHJlc3Vs\ndFNldENvbmN1cnJlbmN5LCBpbnQgcmVzdWx0U2V0SG9sZGFiaWxpdHkpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRC\nQzMoKTsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWwsIHJl\nc3VsdFNldFR5cGUsIHJlc3VsdFNldENvbmN1cnJlbmN5LAogICAgICAgICAg\nICByZXN1bHRTZXRIb2xkYWJpbGl0eSwgdHJ1ZSk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3Ry\naW5nIHNxbCwKICAgICAgICBpbnQgcmVzdWx0U2V0VHlwZSwgaW50IHJlc3Vs\ndFNldENvbmN1cnJlbmN5LCBpbnQgcmVzdWx0U2V0SG9sZGFiaWxpdHksCiAg\nICAgICAgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAoX2Rl\nbCAhPSBudWxsKQogICAgICAgICAgICBzdG1udCA9IF9kZWwucHJlcGFyZVN0\nYXRlbWVudChzcWwsIHJlc3VsdFNldFR5cGUsCiAgICAgICAgICAgICAgICBy\nZXN1bHRTZXRDb25jdXJyZW5jeSwgcmVzdWx0U2V0SG9sZGFiaWxpdHksIGZh\nbHNlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgTWV0aG9kIG0gPSAo\nTWV0aG9kKSBfamRiYzMuZ2V0KFBSRVBBUkVfU1RBVEVNRU5UKTsKICAgICAg\nICAgICAgaWYgKG0gPT0gbnVsbCkKICAgICAgICAgICAgICAgIG0gPSBjcmVh\ndGVKREJDM01ldGhvZChQUkVQQVJFX1NUQVRFTUVOVCwgInByZXBhcmVTdGF0\nZW1lbnQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBTdHJp\nbmcuY2xhc3MsIGludC5jbGFzcywgaW50LmNsYXNzLAogICAgICAgICAgICAg\nICAgICAgICAgICBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgIHN0bW50ID0g\nKFByZXBhcmVkU3RhdGVtZW50KSBpbnZva2VKREJDMyhtLCBuZXcgT2JqZWN0\nW117IHNxbCwKICAgICAgICAgICAgICAgIE51bWJlcnMudmFsdWVPZihyZXN1\nbHRTZXRUeXBlKSwKICAgICAgICAgICAgICAgIE51bWJlcnMudmFsdWVPZihy\nZXN1bHRTZXRDb25jdXJyZW5jeSksCiAgICAgICAgICAgICAgICBOdW1iZXJz\nLnZhbHVlT2YocmVzdWx0U2V0SG9sZGFiaWxpdHkpIH0pOwogICAgICAgIH0K\nICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBuZXcgRGVs\nZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCB0aGlzKTsKICAgICAg\nICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGljIENhbGxhYmxlU3Rh\ndGVtZW50IHByZXBhcmVDYWxsKFN0cmluZyBzcWwsCiAgICAgICAgaW50IHJl\nc3VsdFNldFR5cGUsIGludCByZXN1bHRTZXRDb25jdXJyZW5jeSwgaW50IHJl\nc3VsdFNldEhvbGRhYmlsaXR5KQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAgICAgcmV0dXJuIHBy\nZXBhcmVDYWxsKHNxbCwgcmVzdWx0U2V0VHlwZSwgcmVzdWx0U2V0Q29uY3Vy\ncmVuY3ksCiAgICAgICAgICAgIHJlc3VsdFNldEhvbGRhYmlsaXR5LCB0cnVl\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2FsbGFibGVTdGF0ZW1lbnQgcHJl\ncGFyZUNhbGwoU3RyaW5nIHNxbCwgaW50IHJlc3VsdFNldFR5cGUsCiAgICAg\nICAgaW50IHJlc3VsdFNldENvbmN1cnJlbmN5LCBpbnQgcmVzdWx0U2V0SG9s\nZGFiaWxpdHksIGJvb2xlYW4gd3JhcCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBDYWxsYWJsZVN0YXRlbWVudCBzdG1udDsKICAg\nICAgICBpZiAoX2RlbCAhPSBudWxsKQogICAgICAgICAgICBzdG1udCA9IF9k\nZWwucHJlcGFyZUNhbGwoc3FsLCByZXN1bHRTZXRUeXBlLAogICAgICAgICAg\nICAgICAgcmVzdWx0U2V0Q29uY3VycmVuY3ksIHJlc3VsdFNldEhvbGRhYmls\naXR5LCBmYWxzZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIE1ldGhv\nZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChQUkVQQVJFX0NBTEwpOwogICAg\nICAgICAgICBpZiAobSA9PSBudWxsKQogICAgICAgICAgICAgICAgbSA9IGNy\nZWF0ZUpEQkMzTWV0aG9kKFBSRVBBUkVfQ0FMTCwgInByZXBhcmVDYWxsIiwK\nICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNz\nLCBpbnQuY2xhc3MsIGludC5jbGFzcywKICAgICAgICAgICAgICAgICAgICAg\nICAgaW50LmNsYXNzIH0pOwogICAgICAgICAgICBzdG1udCA9IChDYWxsYWJs\nZVN0YXRlbWVudCkgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtdeyBzcWws\nCiAgICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YocmVzdWx0U2V0VHlw\nZSksCiAgICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YocmVzdWx0U2V0\nQ29uY3VycmVuY3kpLAogICAgICAgICAgICAgICAgTnVtYmVycy52YWx1ZU9m\nKHJlc3VsdFNldEhvbGRhYmlsaXR5KSB9KTsKICAgICAgICB9CiAgICAgICAg\naWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0gbmV3IERlbGVnYXRpbmdD\nYWxsYWJsZVN0YXRlbWVudChzdG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJu\nIHN0bW50OwogICAgfQoKICAgIHB1YmxpYyBQcmVwYXJlZFN0YXRlbWVudCBw\ncmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsIGludCBhdXRvR2VuZXJhdGVk\nS2V5cykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBh\nc3NlcnRKREJDMygpOwogICAgICAgIHJldHVybiBwcmVwYXJlU3RhdGVtZW50\nKHNxbCwgYXV0b0dlbmVyYXRlZEtleXMsIHRydWUpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0\ncmluZyBzcWwsCiAgICAgICAgaW50IGF1dG9HZW5lcmF0ZWRLZXlzLCBib29s\nZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9IG51bGwp\nCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5wcmVwYXJlU3RhdGVtZW50KHNx\nbCwgYXV0b0dlbmVyYXRlZEtleXMpOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICBNZXRob2QgbSA9IChNZXRob2QpIF9qZGJjMy5nZXQoUFJFUEFSRV9X\nSVRIX0tFWVMpOwogICAgICAgICAgICBpZiAobSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFBSRVBBUkVfV0lUSF9L\nRVlTLCAicHJlcGFyZVN0YXRlbWVudCIsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IENsYXNzW117IFN0cmluZy5jbGFzcywgaW50LmNsYXNzIH0pOwogICAg\nICAgICAgICBzdG1udCA9IChQcmVwYXJlZFN0YXRlbWVudCkgaW52b2tlSkRC\nQzMobSwgbmV3IE9iamVjdFtdeyBzcWwsCiAgICAgICAgICAgICAgICBOdW1i\nZXJzLnZhbHVlT2YoYXV0b0dlbmVyYXRlZEtleXMpIH0pOwogICAgICAgIH0K\nICAgICAgICBpZiAod3JhcCkKICAgICAgICAgICAgc3RtbnQgPSBuZXcgRGVs\nZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KHN0bW50LCB0aGlzKTsKICAgICAg\nICByZXR1cm4gc3RtbnQ7CiAgICB9CgogICAgcHVibGljIFByZXBhcmVkU3Rh\ndGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoU3RyaW5nIHNxbCwgaW50W10gY29s\ndW1uSW5kZXhlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBhc3NlcnRKREJDMygpOwogICAgICAgIHJldHVybiBwcmVwYXJlU3Rh\ndGVtZW50KHNxbCwgY29sdW1uSW5kZXhlcywgdHJ1ZSk7CiAgICB9CgogICAg\ncHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQo\nU3RyaW5nIHNxbCwKICAgICAgICBpbnRbXSBjb2x1bW5JbmRleGVzLCBib29s\nZWFuIHdyYXApIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50OwogICAgICAgIGlmIChfZGVsICE9IG51bGwp\nCiAgICAgICAgICAgIHN0bW50ID0gX2RlbC5wcmVwYXJlU3RhdGVtZW50KHNx\nbCwgY29sdW1uSW5kZXhlcywgd3JhcCk7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChQUkVQQVJF\nX1dJVEhfSU5ERVgpOwogICAgICAgICAgICBpZiAobSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFBSRVBBUkVfV0lU\nSF9JTkRFWCwgInByZXBhcmVTdGF0ZW1lbnQiLAogICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MsIGludFtdLmNsYXNzIH0p\nOwogICAgICAgICAgICBzdG1udCA9IChQcmVwYXJlZFN0YXRlbWVudCkgaW52\nb2tlSkRCQzMobSwgbmV3IE9iamVjdFtdeyBzcWwsCiAgICAgICAgICAgICAg\nICBjb2x1bW5JbmRleGVzIH0pOwogICAgICAgIH0KICAgICAgICBpZiAod3Jh\ncCkKICAgICAgICAgICAgc3RtbnQgPSBuZXcgRGVsZWdhdGluZ1ByZXBhcmVk\nU3RhdGVtZW50KHN0bW50LCB0aGlzKTsKICAgICAgICByZXR1cm4gc3RtbnQ7\nCiAgICB9CgogICAgcHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVT\ndGF0ZW1lbnQoU3RyaW5nIHNxbCwgU3RyaW5nW10gY29sdW1uTmFtZXMpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0SkRC\nQzMoKTsKICAgICAgICByZXR1cm4gcHJlcGFyZVN0YXRlbWVudChzcWwsIGNv\nbHVtbk5hbWVzLCB0cnVlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgUHJlcGFy\nZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLAogICAg\nICAgIFN0cmluZ1tdIGNvbHVtbk5hbWVzLCBib29sZWFuIHdyYXApIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydEpEQkMzKCk7CiAgICAg\nICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgaWYgKF9kZWwg\nIT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQgPSBfZGVsLnByZXBhcmVTdGF0\nZW1lbnQoc3FsLCBjb2x1bW5OYW1lcywgd3JhcCk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIE1ldGhvZCBtID0gKE1ldGhvZCkgX2pkYmMzLmdldChQ\nUkVQQVJFX1dJVEhfTkFNRVMpOwogICAgICAgICAgICBpZiAobSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgbSA9IGNyZWF0ZUpEQkMzTWV0aG9kKFBSRVBB\nUkVfV0lUSF9OQU1FUywgInByZXBhcmVTdGF0ZW1lbnQiLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MsIFN0cmluZ1td\nLmNsYXNzIH0pOwogICAgICAgICAgICBzdG1udCA9IChQcmVwYXJlZFN0YXRl\nbWVudCkgaW52b2tlSkRCQzMobSwgbmV3IE9iamVjdFtdeyBzcWwsCiAgICAg\nICAgICAgICAgICBjb2x1bW5OYW1lcyB9KTsKICAgICAgICB9CiAgICAgICAg\naWYgKHdyYXApCiAgICAgICAgICAgIHN0bW50ID0gbmV3IERlbGVnYXRpbmdQ\ncmVwYXJlZFN0YXRlbWVudChzdG1udCwgdGhpcyk7CiAgICAgICAgcmV0dXJu\nIHN0bW50OwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYXNzZXJ0\nSkRCQzMoKSB7CiAgICAgICAgaWYgKF9qZGJjMyA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24o\nX2xvYy5nZXQoIm5vdC1qZGJjMyIpCiAgICAgICAgICAgICAgICAuZ2V0TWVz\nc2FnZSgpKTsKICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBpbnZva2VKREJD\nMyhNZXRob2QgbSwgT2JqZWN0W10gYXJncykgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG0uaW52b2tl\nKF9jb25uLCBhcmdzKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikK\nICAgICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikgdDsKICAgICAg\nICAgICAgdGhyb3cgbmV3IE5lc3RhYmxlUnVudGltZUV4Y2VwdGlvbihfbG9j\nLmdldCgiaW52b2tlLWpkYmMzIikKICAgICAgICAgICAgICAgIC5nZXRNZXNz\nYWdlKCksIHQpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBNZXRob2QgY3JlYXRlSkRCQzNNZXRob2QoT2JqZWN0IGtleSwgU3RyaW5n\nIG5hbWUsCiAgICAgICAgQ2xhc3NbXSBhcmdzKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgTWV0aG9kIG0gPSBDb25uZWN0aW9uLmNsYXNzLmdldE1l\ndGhvZChuYW1lLCBhcmdzKTsKICAgICAgICAgICAgX2pkYmMzLnB1dChrZXks\nIG0pOwogICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICB9IGNhdGNoIChU\naHJvd2FibGUgdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgTmVzdGFibGVS\ndW50aW1lRXhjZXB0aW9uKF9sb2MuZ2V0KCJlcnJvci1qZGJjMyIpCiAgICAg\nICAgICAgICAgICAuZ2V0TWVzc2FnZSgpLCB0KTsKICAgICAgICB9CiAgICB9\nCn0K\n","encoding":"base64"}

