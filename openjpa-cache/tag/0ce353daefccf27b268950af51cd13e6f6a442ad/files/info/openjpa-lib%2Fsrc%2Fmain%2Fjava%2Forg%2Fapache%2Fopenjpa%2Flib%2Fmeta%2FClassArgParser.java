{"sha":"fb93764d2e423b1735a2a1b3f346a028941a63a1","node_id":"MDQ6QmxvYjIwNjM2NDpmYjkzNzY0ZDJlNDIzYjE3MzVhMmExYjNmMzQ2YTAyODk0MWE2M2Ex","size":20879,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fb93764d2e423b1735a2a1b3f346a028941a63a1","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubWV0YTsKCmltcG9ydCBqYXZhLmlvLkJ1ZmZlcmVkUmVh\nZGVyOwppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5GaWxl\nSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkZpbGVSZWFkZXI7CmltcG9y\ndCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5JbnB1dFN0\ncmVhbTsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFkZXI7CmltcG9y\ndCBqYXZhLmlvLlJlYWRlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRp\nbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29t\nbW9ucy5sYW5nLmV4Y2VwdGlvbi5OZXN0YWJsZVJ1bnRpbWVFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgc2VycC5ieXRlY29kZS5sb3dsZXZlbC5Db25zdGFudFBvb2xUYWJs\nZTsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIFBhcnNlciB1\nc2VkIHRvIHJlc29sdmUgYXJndW1lbnRzIGludG8gamF2YSBjbGFzc2VzLgog\nKiBJbnRlcnByZXRzIGNvbW1hbmQtbGluZSBhcmdzIGFzIGVpdGhlciBjbGFz\ncyBuYW1lcywgLmNsYXNzIGZpbGVzIG9yCiAqIHJlc291cmNlcywgLmphdmEg\nZmlsZXMgb3IgcmVzb3VyY2VzLCBvciBtZXRhZGF0YSBmaWxlcyBvciByZXNv\ndXJjZXMKICogY29uZm9ybWluZyB0byB0aGUgY29tbW9uIGZvcm1hdCBkZWZp\nbmVkIGJ5IHtAbGluayBDRk1ldGFEYXRhUGFyc2VyfS4KICogVHJhbnNmb3Jt\ncyB0aGUgaW5mb3JtYXRpb24gaW4gdGhlc2UgYXJncyBpbnRvIHtAbGluayBD\nbGFzc30gaW5zdGFuY2VzLgogKiBOb3RlIHRoYXQgd2hlbiBwYXJzaW5nIC5q\nYXZhIGZpbGVzLCBvbmx5IHRoZSBtYWluIGNsYXNzIGluIHRoZSBmaWxlCiAq\nIGlzIGRldGVjdGVkLiBPdGhlciBjbGFzc2VzIGRlZmluZWQgaW4gdGhlIGZp\nbGUsIHN1Y2ggYXMgaW5uZXIgY2xhc3NlcywKICogYXJlIG5vdCBhZGRlZCB0\nbyB0aGUgcmV0dXJuZWQgY2xhc3NlcyBsaXN0LgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgQ2xhc3NB\ncmdQYXJzZXIgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT0tF\nTl9FT0YgPSAtMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT0tF\nTl9OT05FID0gMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT0tF\nTl9QQUNLQUdFID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBU\nT0tFTl9DTEFTUyA9IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nVE9LRU5fUEFDS0FHRV9OT0FUVFIgPSAzOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IFRPS0VOX0NMQVNTX05PQVRUUiA9IDQ7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChDbGFzc0FyZ1BhcnNlci5jbGFzcyk7CgogICAg\ncHJpdmF0ZSBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsKICAgIHByaXZh\ndGUgY2hhcltdIF9wYWNrYWdlQXR0ciA9ICJuYW1lIi50b0NoYXJBcnJheSgp\nOwogICAgcHJpdmF0ZSBjaGFyW10gX2NsYXNzQXR0ciA9ICJuYW1lIi50b0No\nYXJBcnJheSgpOwogICAgcHJpdmF0ZSBjaGFyW11bXSBfYmVnaW5FbGVtZW50\ncyA9IHsgeyAncCcgfSwgeyAnYycgfSB9OwogICAgcHJpdmF0ZSBjaGFyW11b\nXSBfZW5kRWxlbWVudHMgPSB7ICJhY2thZ2UiLnRvQ2hhckFycmF5KCksCiAg\nICAgICAgImxhc3MiLnRvQ2hhckFycmF5KCkgfTsKCiAgICAvKioKICAgICAq\nIFRoZSBjbGFzcyBsb2FkZXIgd2l0aCB3aGljaCB0byBsb2FkIHBhcnNlZCBj\nbGFzc2VzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0Q2xh\nc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgbG9hZGVyIHdpdGggd2hpY2ggdG8g\nbG9hZCBwYXJzZWQgY2xhc3Nlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAg\nX2xvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgdGhlIHJlbGV2YW50IG1ldGFkYXRhIGZpbGUgc3RydWN0dXJlIHNvIHRo\nYXQgbWV0YWRhdGEgZmlsZXMKICAgICAqIGNvbnRhaW5pbmcgY2xhc3MgbmFt\nZXMgY2FuIGJlIHBhcnNlZC4gTnVsbCBhdHRyaWJ1dGUgbmFtZXMgaW5kaWNh\ndGUKICAgICAqIHRoYXQgdGhlIHRleHQgY29udGVudCBvZiB0aGUgZWxlbWVu\ndCBjb250YWlucyB0aGUgZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0TWV0YURhdGFTdHJ1Y3R1cmUoU3RyaW5nIHBhY2thZ2VFbGVtZW50TmFt\nZSwKICAgICAgICBTdHJpbmcgcGFja2FnZUF0dHJpYnV0ZU5hbWUsIFN0cmlu\nZ1tdIGNsYXNzRWxlbWVudE5hbWVzLAogICAgICAgIFN0cmluZyBjbGFzc0F0\ndHJpYnV0ZU5hbWUpIHsKICAgICAgICAvLyBjYWxjdWxhdGUgaG93IG1hbnkg\nY2hhcnMgZGVlcCB3ZSBoYXZlIHRvIGdvIHRvIGlkZW50aWZ5IGVhY2ggZWxl\nbWVudAogICAgICAgIC8vIG5hbWUgYXMgdW5pcXVlLiAgdGhpcyBpcyBleHRy\nZW1lbHkgaW5lZmZpY2llbnQgZm9yIGxhcmdlIE4sIGJ1dAogICAgICAgIC8v\nIHNob3VsZCBuZXZlciBiZSBjYWxsZWQgZm9yIG1vcmUgdGhhbiBhIGZldyBl\nbGVtZW50cwogICAgICAgIGNoYXJbXSBidWYgPSBuZXcgY2hhcltjbGFzc0Vs\nZW1lbnROYW1lcy5sZW5ndGggKyAxXTsKICAgICAgICBpbnQgY2hhcklkeCA9\nIDA7CiAgICAgICAgZm9yICg7IHRydWU7IGNoYXJJZHgrKykgewogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJ1Zi5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChjaGFySWR4ID09IHBhY2thZ2VFbGVtZW50TmFtZS5sZW5ndGgo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAoImNhbnQtZGlmZi1lbGVtcyIpLmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnVmW2ldID0gcGFja2FnZUVsZW1l\nbnROYW1lLmNoYXJBdChjaGFySWR4KTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXJJZHggPT0gY2xhc3NF\nbGVtZW50TmFtZXNbaSAtIDFdLmxlbmd0aCgpKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRp\nb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICgiY2Fu\ndC1kaWZmLWVsZW1zIikuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBidWZbaV0gPSBjbGFzc0VsZW1lbnROYW1lc1tpIC0gMV0uY2hhckF0\nKGNoYXJJZHgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChjaGFyc1VuaXF1ZShidWYpKQogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBfcGFja2FnZUF0dHIgPSAo\ncGFja2FnZUF0dHJpYnV0ZU5hbWUgPT0gbnVsbCkgPyBudWxsCiAgICAgICAg\nICAgIDogcGFja2FnZUF0dHJpYnV0ZU5hbWUudG9DaGFyQXJyYXkoKTsKICAg\nICAgICBfY2xhc3NBdHRyID0gKGNsYXNzQXR0cmlidXRlTmFtZSA9PSBudWxs\nKSA/IG51bGwKICAgICAgICAgICAgOiBjbGFzc0F0dHJpYnV0ZU5hbWUudG9D\naGFyQXJyYXkoKTsKICAgICAgICBfYmVnaW5FbGVtZW50cyA9IG5ldyBjaGFy\nW2NsYXNzRWxlbWVudE5hbWVzLmxlbmd0aCArIDFdW107CiAgICAgICAgX2Vu\nZEVsZW1lbnRzID0gbmV3IGNoYXJbY2xhc3NFbGVtZW50TmFtZXMubGVuZ3Ro\nICsgMV1bXTsKICAgICAgICBfYmVnaW5FbGVtZW50c1swXSA9IHBhY2thZ2VF\nbGVtZW50TmFtZS5zdWJzdHJpbmcoMCwgY2hhcklkeCArIDEpLgogICAgICAg\nICAgICB0b0NoYXJBcnJheSgpOwogICAgICAgIF9lbmRFbGVtZW50c1swXSA9\nIHBhY2thZ2VFbGVtZW50TmFtZS5zdWJzdHJpbmcoY2hhcklkeCArIDEpLgog\nICAgICAgICAgICB0b0NoYXJBcnJheSgpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY2xhc3NFbGVtZW50TmFtZXMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgX2JlZ2luRWxlbWVudHNbaSArIDFdID0gY2xhc3NFbGVtZW50\nTmFtZXNbaV0uCiAgICAgICAgICAgICAgICBzdWJzdHJpbmcoMCwgY2hhcklk\neCArIDEpLnRvQ2hhckFycmF5KCk7CiAgICAgICAgICAgIF9lbmRFbGVtZW50\nc1tpICsgMV0gPSBjbGFzc0VsZW1lbnROYW1lc1tpXS4KICAgICAgICAgICAg\nICAgIHN1YnN0cmluZyhjaGFySWR4ICsgMSkudG9DaGFyQXJyYXkoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBh\nbGwgY2hhcmFjdGVycyBpbiBnaXZlbiBidWZmZXIgYXJlIHVuaXF1ZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBjaGFyc1VuaXF1ZShj\naGFyW10gYnVmKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IGJ1Zi5sZW5ndGgg\nLSAxOyBpID49IDA7IGktLSkKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCBpOyBqKyspCiAgICAgICAgICAgICAgICBpZiAoYnVmW2pdID09IGJ1\nZltpXSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHtAbGluayBDbGFzc30gcmVwcmVzZW50YXRpb24gb2YgdGhlIGNsYXNz\nKGVzKSBuYW1lZCBpbiB0aGUKICAgICAqIGdpdmVuIGFyZy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gYXJnIGEgY2xhc3MgbmFtZSwgLmphdmEgZmlsZSwgLmNs\nYXNzIGZpbGUsIG9yIG1ldGFkYXRhCiAgICAgKiBmaWxlIG5hbWluZyB0aGUg\ndHlwZShzKSB0byBhY3Qgb24KICAgICAqLwogICAgcHVibGljIENsYXNzW10g\ncGFyc2VUeXBlcyhTdHJpbmcgYXJnKSB7CiAgICAgICAgU3RyaW5nW10gbmFt\nZXMgPSBwYXJzZVR5cGVOYW1lcyhhcmcpOwogICAgICAgIENsYXNzW10gb2Jq\ncyA9IG5ldyBDbGFzc1tuYW1lcy5sZW5ndGhdOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIG9i\nanNbaV0gPSBTdHJpbmdzLnRvQ2xhc3MobmFtZXNbaV0sIF9sb2FkZXIpOwog\nICAgICAgIHJldHVybiBvYmpzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB7QGxpbmsgQ2xhc3N9IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBj\nbGFzcyhlcykgbmFtZWQgaW4gdGhlCiAgICAgKiBnaXZlbiBtZXRhZGF0YXMu\nCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1tdIHBhcnNlVHlwZXMoTWV0YURh\ndGFJdGVyYXRvciBpdHIpIHsKICAgICAgICBTdHJpbmdbXSBuYW1lcyA9IHBh\ncnNlVHlwZU5hbWVzKGl0cik7CiAgICAgICAgQ2xhc3NbXSBvYmpzID0gbmV3\nIENsYXNzW25hbWVzLmxlbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBuYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb2Jqc1tpXSA9\nIFN0cmluZ3MudG9DbGFzcyhuYW1lc1tpXSwgX2xvYWRlcik7CiAgICAgICAg\ncmV0dXJuIG9ianM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBt\nYXBwaW5nIG9mIGVhY2ggbWV0YWRhdGEgcmVzb3VyY2UgdG8gYW4gYXJyYXkg\nb2YgaXRzCiAgICAgKiBjb250YWluZWQgY2xhc3Nlcy4KICAgICAqLwogICAg\ncHVibGljIE1hcCBtYXBUeXBlcyhNZXRhRGF0YUl0ZXJhdG9yIGl0cikgewog\nICAgICAgIE1hcCBtYXAgPSBtYXBUeXBlTmFtZXMoaXRyKTsKICAgICAgICBN\nYXAuRW50cnkgZW50cnk7CiAgICAgICAgU3RyaW5nW10gbmFtZXM7CiAgICAg\nICAgQ2xhc3NbXSBvYmpzOwogICAgICAgIGZvciAoSXRlcmF0b3IgaSA9IG1h\ncC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGkubmV4dCgpOwogICAgICAg\nICAgICBuYW1lcyA9IChTdHJpbmdbXSkgZW50cnkuZ2V0VmFsdWUoKTsKICAg\nICAgICAgICAgb2JqcyA9IG5ldyBDbGFzc1tuYW1lcy5sZW5ndGhdOwogICAg\nICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IG5hbWVzLmxlbmd0aDsgaisr\nKQogICAgICAgICAgICAgICAgb2Jqc1tqXSA9IFN0cmluZ3MudG9DbGFzcyhu\nYW1lc1tqXSwgX2xvYWRlcik7CiAgICAgICAgICAgIGVudHJ5LnNldFZhbHVl\nKG9ianMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWFwOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuYW1lcyBvZiB0aGUgY2xhc3Mo\nZXMpIGZyb20gdGhlIGdpdmVuIGFyZy4KICAgICAqCiAgICAgKiBAcGFyYW0g\nYXJnIGEgY2xhc3MgbmFtZSwgLmphdmEgZmlsZSwgLmNsYXNzIGZpbGUsIG9y\nIG1ldGFkYXRhCiAgICAgKiBmaWxlIG5hbWluZyB0aGUgdHlwZShzKSB0byBh\nY3Qgb24KICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nIHdpdGggYXBwcm9wcmlhdGUgbWVzc2FnZSBvbiBlcnJvcgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nW10gcGFyc2VUeXBlTmFtZXMoU3RyaW5nIGFyZykg\newogICAgICAgIGlmIChhcmcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdbMF07CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZp\nbGUgZmlsZSA9IEZpbGVzLmdldEZpbGUoYXJnLCBfbG9hZGVyKTsKICAgICAg\nICAgICAgaWYgKGFyZy5lbmRzV2l0aCgiLmNsYXNzIikpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBnZXRGcm9tQ2xhc3NGaWxlKGZp\nbGUpIH07CiAgICAgICAgICAgIGlmIChhcmcuZW5kc1dpdGgoIi5qYXZhIikp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBnZXRGcm9t\nSmF2YUZpbGUoZmlsZSkgfTsKICAgICAgICAgICAgaWYgKGZpbGUuZXhpc3Rz\nKCkpIHsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gY29sID0gZ2V0RnJv\nbU1ldGFEYXRhRmlsZShmaWxlKTsKICAgICAgICAgICAgICAgIHJldHVybiAo\nU3RyaW5nW10pIGNvbC50b0FycmF5KG5ldyBTdHJpbmdbY29sLnNpemUoKV0p\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5lc3RhYmxlUnVudGltZUV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJjbGFzcy1hcmciLCBh\ncmcpLmdldE1lc3NhZ2UoKSwgZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBt\ndXN0IGJlIGEgY2xhc3MgbmFtZQogICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nW117IGFyZyB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBu\nYW1lcyBvZiB0aGUgY2xhc3MoZXMpIGZyb20gdGhlIGdpdmVuIG1ldGFkYXRh\ncy4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIHBhcnNlVHlwZU5hbWVz\nKE1ldGFEYXRhSXRlcmF0b3IgaXRyKSB7CiAgICAgICAgaWYgKGl0ciA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKCiAgICAg\nICAgTGlzdCBuYW1lcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBPYmpl\nY3Qgc291cmNlID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICB3\naGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgc291cmNl\nID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGFwcGVuZFR5cGVOYW1l\ncyhzb3VyY2UsIGl0ci5nZXRJbnB1dFN0cmVhbSgpLCBuYW1lcyk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgTmVzdGFibGVSdW50aW1lRXhjZXB0aW9uKAog\nICAgICAgICAgICAgICAgX2xvYy5nZXQoImNsYXNzLWFyZyIsIHNvdXJjZSku\nZ2V0TWVzc2FnZSgpLCBlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChT\ndHJpbmdbXSkgbmFtZXMudG9BcnJheShuZXcgU3RyaW5nW25hbWVzLnNpemUo\nKV0pOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgdGhlIG5hbWVzIGlu\nIHRoZSBnaXZlbiBtZXRhZGF0YSBpdGVyYXRvciBzdHJlYW0sIGNsb3Npbmcg\ndGhlCiAgICAgKiBzdHJlYW0gb24gY29tcGxldGlvbi4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFwcGVuZFR5cGVOYW1lcyhPYmplY3Qgc291cmNlLCBJ\nbnB1dFN0cmVhbSBpbiwgTGlzdCBuYW1lcykKICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzb3Vy\nY2UudG9TdHJpbmcoKS5lbmRzV2l0aCgiLmNsYXNzIikpCiAgICAgICAgICAg\nICAgICBuYW1lcy5hZGQoZ2V0RnJvbUNsYXNzKGluKSk7CiAgICAgICAgICAg\nIG5hbWVzLmFkZEFsbChnZXRGcm9tTWV0YURhdGEobmV3IElucHV0U3RyZWFt\nUmVhZGVyKGluKSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBpbi5jbG9zZSgpOwogICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIG1hcHBp\nbmcgb2YgZWFjaCBtZXRhZGF0YSByZXNvdXJjZSB0byBhbiBhcnJheSBvZiBp\ndHMgY29udGFpbmVkCiAgICAgKiBjbGFzcyBuYW1lcy4KICAgICAqLwogICAg\ncHVibGljIE1hcCBtYXBUeXBlTmFtZXMoTWV0YURhdGFJdGVyYXRvciBpdHIp\nIHsKICAgICAgICBpZiAoaXRyID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7CgogICAgICAgIE1hcCBtYXAgPSBu\nZXcgSGFzaE1hcCgpOwogICAgICAgIE9iamVjdCBzb3VyY2UgPSBudWxsOwog\nICAgICAgIExpc3QgbmFtZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAg\nICAgICAgICAgICAgIHNvdXJjZSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBhcHBlbmRUeXBlTmFtZXMoc291cmNlLCBpdHIuZ2V0SW5wdXRTdHJl\nYW0oKSwgbmFtZXMpOwogICAgICAgICAgICAgICAgaWYgKCFuYW1lcy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICAgICAgbWFwLnB1dChzb3VyY2UsIChT\ndHJpbmdbXSkgbmFtZXMudG9BcnJheQogICAgICAgICAgICAgICAgICAgICAg\nICAobmV3IFN0cmluZ1tuYW1lcy5zaXplKCldKSk7CiAgICAgICAgICAgICAg\nICBuYW1lcy5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE5lc3Rh\nYmxlUnVudGltZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgIF9sb2MuZ2V0\nKCJjbGFzcy1hcmciLCBzb3VyY2UpLmdldE1lc3NhZ2UoKSwgZSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBtYXA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSBjbGFzcyBuYW1lZCBpbiB0aGUgZ2l2ZW4gLmNsYXNz\nIGZpbGUuCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEZyb21DbGFz\nc0ZpbGUoRmlsZSBmaWxlKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIEZpbGVJbnB1dFN0cmVhbSBmaW4gPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGZpbiA9IG5ldyBGaWxlSW5wdXRTdHJlYW0oZmlsZSk7CiAg\nICAgICAgICAgIHJldHVybiBnZXRGcm9tQ2xhc3MoZmluKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZmluICE9IG51bGwpCiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGZpbi5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9l\nKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0aGUgY2xhc3MgbmFtZSBpbiB0aGUgZ2l2ZW4g\nLmNsYXNzIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBn\nZXRGcm9tQ2xhc3MoSW5wdXRTdHJlYW0gaW4pIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgQ29uc3RhbnRQb29sVGFibGUgdGFibGUgPSBuZXcgQ29u\nc3RhbnRQb29sVGFibGUoaW4pOwogICAgICAgIGludCBpZHggPSB0YWJsZS5n\nZXRFbmRJbmRleCgpOwogICAgICAgIGlkeCArPSAyOyAvLyBhY2Nlc3MgZmxh\nZ3MKICAgICAgICBpbnQgY2xzRW50cnkgPSB0YWJsZS5yZWFkVW5zaWduZWRT\naG9ydChpZHgpOwogICAgICAgIGludCB1dGZFbnRyeSA9IHRhYmxlLnJlYWRV\nbnNpZ25lZFNob3J0KHRhYmxlLmdldChjbHNFbnRyeSkpOwogICAgICAgIHJl\ndHVybiB0YWJsZS5yZWFkU3RyaW5nKHRhYmxlLmdldCh1dGZFbnRyeSkpLnJl\ncGxhY2UoJy8nLCAnLicpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyB0aGUgY2xhc3MgbmFtZWQgaW4gdGhlIGdpdmVuIC5qYXZhIGZpbGUuCiAg\nICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEZyb21KYXZhRmlsZShGaWxl\nIGZpbGUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQnVmZmVyZWRS\nZWFkZXIgaW4gPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8v\nIGZpbmQgdGhlIGxpbmUgd2l0aCB0aGUgcGFja2FnZSBkZWNsYXJhdGlvbgog\nICAgICAgICAgICBpbiA9IG5ldyBCdWZmZXJlZFJlYWRlcihuZXcgRmlsZVJl\nYWRlcihmaWxlKSk7CiAgICAgICAgICAgIFN0cmluZyBsaW5lOwogICAgICAg\nICAgICBTdHJpbmdCdWZmZXIgcGFjayA9IG51bGw7CiAgICAgICAgICAgIHdo\naWxlICgobGluZSA9IGluLnJlYWRMaW5lKCkpICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGxpbmUgPSBsaW5lLnRyaW0oKTsKICAgICAgICAgICAgICAg\nIGlmIChsaW5lLnN0YXJ0c1dpdGgoInBhY2thZ2UgIikpIHsKICAgICAgICAg\nICAgICAgICAgICBsaW5lID0gbGluZS5zdWJzdHJpbmcoOCkudHJpbSgpOwoK\nICAgICAgICAgICAgICAgICAgICAvLyBzdHJpcCBvZmYgYW55dGhpbmcgYmV5\nb25kIHRoZSBwYWNrYWdlIGRlY2xhcmF0aW9uCiAgICAgICAgICAgICAgICAg\nICAgcGFjayA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxpbmUubGVuZ3RoKCk7IGkrKykg\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQ2hhcmFjdGVyLmlzSmF2\nYUlkZW50aWZpZXJQYXJ0KGxpbmUuY2hhckF0KGkpKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfHwgbGluZS5jaGFyQXQoaSkgPT0gJy4nKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcGFjay5hcHBlbmQobGluZS5jaGFy\nQXQoaSkpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHN0cmlwICcuamF2\nYScKICAgICAgICAgICAgU3RyaW5nIGNsc05hbWUgPSBmaWxlLmdldE5hbWUo\nKTsKICAgICAgICAgICAgY2xzTmFtZSA9IGNsc05hbWUuc3Vic3RyaW5nKDAs\nIGNsc05hbWUubGVuZ3RoKCkgLSA1KTsKCiAgICAgICAgICAgIC8vIHByZWZp\neCB3aXRoIHBhY2thZ2UKICAgICAgICAgICAgaWYgKHBhY2sgIT0gbnVsbCAm\nJiBwYWNrLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgIGNsc05hbWUg\nPSBwYWNrICsgIi4iICsgY2xzTmFtZTsKCiAgICAgICAgICAgIHJldHVybiBj\nbHNOYW1lOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChp\nbiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgaW4uY2xvc2UoKTsg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7fQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNsYXNzZXMgbmFtZWQgaW4g\ndGhlIGdpdmVuIGNvbW1vbiBmb3JtYXQgbWV0YWRhdGEgZmlsZS4KICAgICAq\nLwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIGdldEZyb21NZXRhRGF0YUZpbGUo\nRmlsZSBmaWxlKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGVS\nZWFkZXIgaW4gPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlu\nID0gbmV3IEZpbGVSZWFkZXIoZmlsZSk7CiAgICAgICAgICAgIHJldHVybiBn\nZXRGcm9tTWV0YURhdGEoaW4pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChpbiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBpbi5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0\naGUgY2xhc3NlcyBuYW1lZCBpbiB0aGUgZ2l2ZW4gY29tbW9uIGZvcm1hdCBt\nZXRhZGF0YSBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgQ29sbGVjdGlv\nbiBnZXRGcm9tTWV0YURhdGEoUmVhZGVyIHhtbCkgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICBDb2xsZWN0aW9uIG5hbWVzID0gbmV3IEFycmF5TGlz\ndCgpOwogICAgICAgIEJ1ZmZlcmVkUmVhZGVyIGluID0gbmV3IEJ1ZmZlcmVk\nUmVhZGVyKHhtbCk7CgogICAgICAgIGJvb2xlYW4gY29tbWVudCA9IGZhbHNl\nOwogICAgICAgIGludCB0b2tlbiA9IFRPS0VOX05PTkU7CiAgICAgICAgU3Ry\naW5nIHBrZyA9ICIiOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAgIHJl\nYWQ6CiAgICAgICAgZm9yIChpbnQgY2ggPSAwLCBsYXN0ID0gMCwgbGFzdDIg\nPSAwOwogICAgICAgICAgICBjaCA9PSAnPCcgfHwgKGNoID0gaW4ucmVhZCgp\nKSAhPSAtMTsgbGFzdDIgPSBsYXN0LCBsYXN0ID0gY2gpIHsKICAgICAgICAg\nICAgLy8gaGFuZGxlIGNvbW1lbnRzCiAgICAgICAgICAgIGlmIChjb21tZW50\nICYmIGxhc3QyID09ICctJyAmJiBsYXN0ID09ICctJyAmJiBjaCA9PSAnPicp\nIHsKICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChjb21tZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoY2ggPT0gJzwnKSB7\nCiAgICAgICAgICAgICAgICAgICAgY2ggPSBpbi5yZWFkKCk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGNoID09IC0xKQogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhayByZWFkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGxhc3QyID09ICc8JyAmJiBsYXN0ID09ICchJyAmJiBjaCA9PSAnLScpIHsK\nICAgICAgICAgICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlm\nIG5vdCBhbiBlbGVtZW50IHN0YXJ0LCBza2lwIGl0CiAgICAgICAgICAgIGlm\nIChjaCAhPSAnPCcpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgdG9rZW4gPSBUT0tFTl9OT05FOyAvLyByZXNldCB0b2tlbgogICAg\nICAgICAgICBsYXN0ID0gY2g7IC8vIHVwZGF0ZSBuZWVkZWQgZm9yIGNvbW1l\nbnQgZGV0ZWN0aW9uCiAgICAgICAgICAgIGNoID0gcmVhZFRocm91Z2hXaGl0\nZXNwYWNlKGluKTsKICAgICAgICAgICAgaWYgKGNoID09ICcvJyB8fCBjaCA9\nPSAnIScgfHwgY2ggPT0gJz8nKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAvLyByZWFkIGVsZW1lbnQgbmFtZTsgbG9vayBmb3Ig\ncGFja2FnZXMgYW5kIGNsYXNzZXMKICAgICAgICAgICAgdG9rZW4gPSByZWFk\nRWxlbWVudFRva2VuKGNoLCBpbik7CiAgICAgICAgICAgIHN3aXRjaCAodG9r\nZW4pIHsKICAgICAgICAgICAgICAgIGNhc2UgVE9LRU5fRU9GOgogICAgICAg\nICAgICAgICAgICAgIGJyZWFrIHJlYWQ7CiAgICAgICAgICAgICAgICBjYXNl\nIFRPS0VOX1BBQ0tBR0U6CiAgICAgICAgICAgICAgICAgICAgcGtnID0gcmVh\nZEF0dHJpYnV0ZShpbiwgX3BhY2thZ2VBdHRyKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAocGtnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrIHJlYWQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFRPS0VOX1BBQ0tBR0VfTk9BVFRSOgogICAgICAg\nICAgICAgICAgICAgIHBrZyA9IHJlYWRFbGVtZW50VGV4dChpbik7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHBrZyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBicmVhayByZWFkOwogICAgICAgICAgICAgICAgICAgIGNo\nID0gJzwnOyAvLyByZWFkaW5nIGVsZW1lbnQgdGV4dCByZWFkcyB0byBuZXh0\nICc8JwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBUT0tFTl9DTEFTUzoKICAgICAgICAgICAgICAgICAgICBuYW1l\nID0gcmVhZEF0dHJpYnV0ZShpbiwgX2NsYXNzQXR0cik7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWsgcmVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAocGtn\nLmxlbmd0aCgpID4gMCAmJiBuYW1lLmluZGV4T2YoJy4nKSA9PSAtMSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbmFtZXMuYWRkKHBrZyArICIuIiArIG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgbmFtZXMuYWRkKG5hbWUpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUT0tFTl9DTEFTU19OT0FU\nVFI6CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHJlYWRFbGVtZW50VGV4\ndChpbik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgcmVhZDsKICAgICAgICAg\nICAgICAgICAgICBjaCA9ICc8JzsgLy8gcmVhZGluZyBlbGVtZW50IHRleHQg\ncmVhZHMgdG8gbmV4dCAnPCcKICAgICAgICAgICAgICAgICAgICBpZiAocGtn\nLmxlbmd0aCgpID4gMCAmJiBuYW1lLmluZGV4T2YoJy4nKSA9PSAtMSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbmFtZXMuYWRkKHBrZyArICIuIiArIG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgbmFtZXMuYWRkKG5hbWUpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBuYW1lczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgdGhlIG5hbWUg\nb2YgdGhlIGN1cnJlbnQgWE1MIGVsZW1lbnQgYW5kIHJldHVybiB0aGUgbWF0\nY2hpbmcgdG9rZW4uCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHJlYWRFbGVt\nZW50VG9rZW4oaW50IGNoLCBSZWFkZXIgaW4pIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gbG9vayB0aHJvdWdoIHRoZSBiZWdpbm5pbmcgZWxl\nbWVudCBuYW1lcyB0byBmaW5kIHdoYXQgZWxlbWVudCB0aGlzCiAgICAgICAg\nLy8gbWlnaHQgYmUoaWYgYW55KQogICAgICAgIGludCBtYXRjaElkeCA9IC0x\nOwogICAgICAgIGludCBtYXRjaGVkID0gMDsKICAgICAgICBpbnQgZHEgPSAw\nOwogICAgICAgIGZvciAoaW50IGJlZ2luSWR4ID0gMDsgYmVnaW5JZHggPCBf\nYmVnaW5FbGVtZW50c1swXS5sZW5ndGg7IGJlZ2luSWR4KyspCiAgICAgICAg\newogICAgICAgICAgICBpZiAoYmVnaW5JZHggIT0gMCkKICAgICAgICAgICAg\nICAgIGNoID0gaW4ucmVhZCgpOwogICAgICAgICAgICBpZiAoY2ggPT0gLTEp\nCiAgICAgICAgICAgICAgICByZXR1cm4gVE9LRU5fRU9GOwoKICAgICAgICAg\nICAgbWF0Y2hlZCA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgX2JlZ2luRWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGlmICgoZHEgJiAoMiA8PCBpKSkgIT0gMCkKICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICBpZiAoY2ggPT0gX2Jl\nZ2luRWxlbWVudHNbaV1bYmVnaW5JZHhdKSB7CiAgICAgICAgICAgICAgICAg\nICAgbWF0Y2hJZHggPSBpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoZWQr\nKzsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAg\nIGRxIHw9IDIgPDwgaTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYg\nKG1hdGNoZWQgPT0gMCkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nIH0KICAgICAgICBpZiAobWF0Y2hlZCAhPSAxKQogICAgICAgICAgICByZXR1\ncm4gVE9LRU5fTk9ORTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSByZXN0\nIG9mIHRoZSBlbGVtZW50IG5hbWUgbWF0Y2hlcwogICAgICAgIGNoYXJbXSBt\nYXRjaCA9IF9lbmRFbGVtZW50c1ttYXRjaElkeF07CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBtYXRjaC5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjaCA9IGluLnJlYWQoKTsKICAgICAgICAgICAgaWYgKGNoID09IC0xKQog\nICAgICAgICAgICAgICAgcmV0dXJuIFRPS0VOX0VPRjsKICAgICAgICAgICAg\naWYgKGNoICE9IG1hdGNoW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIFRP\nS0VOX05PTkU7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFkIHRoZSBuZXh0\nIGNoYXIgdG8gbWFrZSBzdXJlIHdlIGZpbmlzaGVkIHRoZSBlbGVtZW50IG5h\nbWUKICAgICAgICBjaCA9IGluLnJlYWQoKTsKICAgICAgICBpZiAoY2ggPT0g\nLTEpCiAgICAgICAgICAgIHJldHVybiBUT0tFTl9FT0Y7CiAgICAgICAgaWYg\nKGNoID09ICc+JykgewogICAgICAgICAgICBpZiAobWF0Y2hJZHggPT0gMCAm\nJiBfcGFja2FnZUF0dHIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBUT0tFTl9QQUNLQUdFX05PQVRUUjsKICAgICAgICAgICAgaWYgKG1hdGNo\nSWR4ICE9IDAgJiYgX2NsYXNzQXR0ciA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIFRPS0VOX0NMQVNTX05PQVRUUjsKICAgICAgICB9IGVsc2Ug\naWYgKENoYXJhY3Rlci5pc1doaXRlc3BhY2UoKGNoYXIpIGNoKSkgewogICAg\nICAgICAgICBpZiAobWF0Y2hJZHggPT0gMCAmJiBfcGFja2FnZUF0dHIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBUT0tFTl9QQUNLQUdFOwog\nICAgICAgICAgICBpZiAobWF0Y2hJZHggIT0gMCAmJiBfY2xhc3NBdHRyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gVE9LRU5fQ0xBU1M7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBUT0tFTl9OT05FOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVhZCB0aGUgYXR0cmlidXRlIHdpdGggdGhlIGdpdmVu\nIG5hbWUgaW4gY2hhcnMgb2YgdGhlIGN1cnJlbnQgWE1MCiAgICAgKiBlbGVt\nZW50LgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyByZWFkQXR0cmlidXRl\nKFJlYWRlciBpbiwgY2hhcltdIG5hbWUpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgaW50IGV4cGVjdGVkID0gMDsKICAgICAgICBmb3IgKGludCBj\naCwgbGFzdCA9IDA7IHRydWU7IGxhc3QgPSBjaCkgewogICAgICAgICAgICBj\naCA9IGluLnJlYWQoKTsKICAgICAgICAgICAgaWYgKGNoID09IC0xKQogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmIChjaCA9\nPSAnPicpCiAgICAgICAgICAgICAgICByZXR1cm4gIiI7CgogICAgICAgICAg\nICAvLyBpZiBub3QgZXhwZWN0ZWQgY2hhciBvciBzdGlsbCBsb29raW5nIGZv\nciAnbicgYW5kIHByZXZpb3VzCiAgICAgICAgICAgIC8vIGNoYXIgaXMgbm90\nIHdoaXRlc3BhY2UsIGtlZXAgbG9va2luZwogICAgICAgICAgICBpZiAoY2gg\nIT0gbmFtZVtleHBlY3RlZF0gfHwgKGV4cGVjdGVkID09IDAgJiYgbGFzdCAh\nPSAwCiAgICAgICAgICAgICAgICAmJiAhQ2hhcmFjdGVyLmlzV2hpdGVzcGFj\nZSgoY2hhcikgbGFzdCkpKSB7CiAgICAgICAgICAgICAgICBleHBlY3RlZCA9\nIDA7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gZm91bmQgZXhwZWN0ZWQgY2hhcjsgaGF2ZSB3ZSBm\nb3VuZCB0aGUgd2hvbGUgIm5hbWUiPwogICAgICAgICAgICBleHBlY3RlZCsr\nOwogICAgICAgICAgICBpZiAoZXhwZWN0ZWQgPT0gbmFtZS5sZW5ndGgpIHsK\nICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbmV4dCBjaGFyIGlz\nICc9JwogICAgICAgICAgICAgICAgY2ggPSByZWFkVGhyb3VnaFdoaXRlc3Bh\nY2UoaW4pOwogICAgICAgICAgICAgICAgaWYgKGNoID09IC0xKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgaWYg\nKGNoICE9ICc9JykgewogICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkID0g\nMDsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAvLyB0b3NzIG91dCBhbnkgc3Vic2Vx\ndWVudCB3aGl0ZXNwYWNlIGFuZCB0aGUgbmV4dCBjaGFyLCB3aGljaAogICAg\nICAgICAgICAgICAgLy8gaXMgdGhlIG9wZW5pbmcgcXVvdGUgZm9yIHRoZSBh\ndHRyIHZhbHVlLCB0aGVuIHJlYWQgdW50aWwgdGhlCiAgICAgICAgICAgICAg\nICAvLyBjbG9zaW5nIHF1b3RlCiAgICAgICAgICAgICAgICByZWFkVGhyb3Vn\naFdoaXRlc3BhY2UoaW4pOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRB\ndHRyaWJ1dGVWYWx1ZShpbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWFkIHRoZSBjdXJyZW50IHRleHQgdmFs\ndWUgdW50aWwgdGhlIG5leHQgZWxlbWVudC4KICAgICAqLwogICAgcHJpdmF0\nZSBTdHJpbmcgcmVhZEVsZW1lbnRUZXh0KFJlYWRlciBpbikgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbnVsbDsK\nICAgICAgICBpbnQgY2g7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAg\nICAgICAgY2ggPSBpbi5yZWFkKCk7CiAgICAgICAgICAgIGlmIChjaCA9PSAt\nMSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBp\nZiAoY2ggPT0gJzwnKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGlmIChDaGFyYWN0ZXIuaXNXaGl0ZXNwYWNlKChjaGFyKSBjaCkpCiAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGJ1ZiA9\nPSBudWxsKQogICAgICAgICAgICAgICAgYnVmID0gbmV3IFN0cmluZ0J1ZmZl\ncigpOwogICAgICAgICAgICBidWYuYXBwZW5kKChjaGFyKSBjaCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiAoYnVmID09IG51bGwpID8gIiIgOiBidWYu\ndG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgdW50aWwg\ndGhlIG5leHQgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVyLgogICAgICovCiAg\nICBwcml2YXRlIGludCByZWFkVGhyb3VnaFdoaXRlc3BhY2UoUmVhZGVyIGlu\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGludCBjaDsKICAgICAg\nICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBjaCA9IGluLnJlYWQoKTsK\nICAgICAgICAgICAgaWYgKGNoID09IC0xIHx8ICFDaGFyYWN0ZXIuaXNXaGl0\nZXNwYWNlKChjaGFyKSBjaCkpCiAgICAgICAgICAgICAgICByZXR1cm4gY2g7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBj\ndXJyZW50IGF0dHJpYnV0ZSB2YWx1ZS4KICAgICAqLwogICAgcHJpdmF0ZSBT\ndHJpbmcgcmVhZEF0dHJpYnV0ZVZhbHVlKFJlYWRlciBpbikgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0\ncmluZ0J1ZmZlcigpOwogICAgICAgIGludCBjaDsKICAgICAgICB3aGlsZSAo\ndHJ1ZSkgewogICAgICAgICAgICBjaCA9IGluLnJlYWQoKTsKICAgICAgICAg\nICAgaWYgKGNoID09IC0xKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgICAgIGlmIChjaCA9PSAnXCcnIHx8IGNoID09ICciJykKICAg\nICAgICAgICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgoY2hhcikgY2gpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

