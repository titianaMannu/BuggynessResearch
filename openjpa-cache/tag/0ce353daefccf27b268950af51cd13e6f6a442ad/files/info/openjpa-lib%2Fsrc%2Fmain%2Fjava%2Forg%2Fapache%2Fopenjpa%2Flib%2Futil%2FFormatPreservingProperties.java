{"sha":"f52372294e2cc3a6d8fa1ae892ecf5fa24e9a964","node_id":"MDQ6QmxvYjIwNjM2NDpmNTIzNzIyOTRlMmNjM2E2ZDhmYTFhZTg5MmVjZjVmYTI0ZTlhOTY0","size":23406,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f52372294e2cc3a6d8fa1ae892ecf5fa24e9a964","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbDsKCmltcG9ydCBqYXZhLmlvLkJ1ZmZlcmVkUmVh\nZGVyOwppbXBvcnQgamF2YS5pby5GaWx0ZXJJbnB1dFN0cmVhbTsKaW1wb3J0\nIGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLklucHV0U3Ry\nZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFt\nOwppbXBvcnQgamF2YS5pby5PdXRwdXRTdHJlYW1Xcml0ZXI7CmltcG9ydCBq\nYXZhLmlvLlByaW50V3JpdGVyOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFi\nbGU7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtl\nZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuUHJvcGVydGllczsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxl\nY3Rpb25zLnNldC5MaXN0T3JkZXJlZFNldDsKCi8qCiAqICMjIyB0aGluZ3Mg\ndG8gYWRkOiAtIHNob3VsZCBwcm9iYWJseSBiZSBhIFNvdXJjZVRyYWNrZXIK\nICogLSBpZiBhbiBlbnRyeSBpcyByZW1vdmVkLCBzaG91bGQgdGhlcmUgYmUg\nYW4gb3B0aW9uIHRvIHJlbW92ZSBjb21tZW50cwogKiBqdXN0IGJlZm9yZSB0\naGUgZW50cnkoYSBsYSBqYXZhZG9jKT8KICogLSBzaG91bGQgd2UgaGF2ZSBh\nbiBvcHRpb24gdG8gY2xlYW4gdXAgd2hpdGVzcGFjZT8KICogLSBwb3RlbnRp\nYWxseSB3b3VsZCBiZSBpbnRlcmVzdGluZyB0byBhZGQgY29tbWVudHMgYWJv\ndXQgZWFjaAogKiBwcm9wZXJ0eSB0aGF0IE9wZW5KUEEgYWRkcyB0byB0aGlz\nIG9iamVjdC4gV2UnZCB3YW50IHRvIG1ha2UgdGhlCiAqIGF1dG9tYXRpYyBj\nb21tZW50LXJlbW92aW5nIGNvZGUgd29yayBmaXJzdCwgdGhvdWdoLCBzbyB0\naGF0IGlmCiAqIHNvbWVvbmUgdGhlbiByZW1vdmVkIHRoZSBwcm9wZXJ0eSwg\ndGhlIGNvbW1lbnRzIHdvdWxkIGdvIGF3YXkuCiAqIC0gd291bGQgYmUgbmVh\ndCBpZiBEdXBsaWNhdGVLZXlFeGNlcHRpb24gY291bGQgcmVwb3J0IGxpbmUg\nbnVtYmVycyBvZgogKiBvZmZlbmRpbmcgZW50cmllcy4KICogLSBwdXRBbGwo\nKSB3aXRoIGFub3RoZXIgRm9ybWF0UHJlc2VydmluZ1Byb3BlcnRpZXMgc2hv\ndWxkIGJlIHNtYXJ0ZXIKICovCgovKioKICogQSBzcGVjaWFsaXphdGlvbiBv\nZiB7QGxpbmsgUHJvcGVydGllc30gdGhhdCBzdG9yZXMgaXRzIGNvbnRlbnRz\nCiAqIGluIHRoZSBzYW1lIG9yZGVyIGFuZCB3aXRoIHRoZSBzYW1lIGZvcm1h\ndHRpbmcgYXMgd2FzIHVzZWQgdG8gcmVhZAogKiB0aGUgY29udGVudHMgZnJv\nbSBhbiBpbnB1dCBzdHJlYW0uIFRoaXMgaXMgdXNlZnVsIGJlY2F1c2UgaXQg\nbWVhbnMKICogdGhhdCBhIHByb3BlcnRpZXMgZmlsZSBsb2FkZWQgdmlhIHRo\naXMgb2JqZWN0IGFuZCB0aGVuIHdyaXR0ZW4KICogYmFjayBvdXQgbGF0ZXIg\nb24gd2lsbCBvbmx5IGJlIGRpZmZlcmVudCB3aGVyZSBjaGFuZ2VzIG9yCiAq\nIGFkZGl0aW9ucyB3ZXJlIG1hZGUuCiAqIEJ5IGRlZmF1bHQsIHRoZSB7QGxp\nbmsgI3N0b3JlfSBtZXRob2QgaW4gdGhpcyBjbGFzcyBkb2VzIG5vdAogKiBi\nZWhhdmUgdGhlIHNhbWUgYXMge0BsaW5rIFByb3BlcnRpZXMjc3RvcmV9LiBZ\nb3UgY2FuIGNhdXNlIGFuCiAqIGluc3RhbmNlIHRvIGFwcHJveGltYXRlIHRo\nZSBiZWhhdmlvciBvZiB7QGxpbmsgUHJvcGVydGllcyNzdG9yZX0KICogYnkg\naW52b2tpbmcge0BsaW5rICNzZXREZWZhdWx0RW50cnlEZWxpbWl0ZXJ9IHdp\ndGggPGNvZGU+PTwvY29kZT4sCiAqIHtAbGluayAjc2V0QWRkV2hpdGVzcGFj\nZUFmdGVyRGVsaW1pdGVyfSB3aXRoIDxjb2RlPmZhbHNlPC9jb2RlPiwgYW5k\nCiAqIHtAbGluayAjc2V0QWxsb3dEdXBsaWNhdGVzfSB3aXRoIDxjb2RlPnRy\ndWU8L2NvZGU+LiBIb3dldmVyLCB0aGlzCiAqIHdpbGwgb25seSBpbmZsdWVu\nY2UgaG93IHRoZSBpbnN0YW5jZSB3aWxsIHdyaXRlIG5ldyB2YWx1ZXMsIG5v\ndCBob3cKICogaXQgd2lsbCB3cml0ZSBleGlzdGluZyBrZXktdmFsdWUgcGFp\ncnMgdGhhdCBhcmUgbW9kaWZpZWQuCiAqIEluIGNvbmp1bmN0aW9uIHdpdGgg\nYSBjb25zZXJ2YXRpdmUgb3V0cHV0IHdyaXRlciwgaXQgaXMKICogcG9zc2li\nbGUgdG8gb25seSB3cml0ZSB0byBkaXNrIGNoYW5nZXMgLyBhZGRpdGlvbnMu\nCiAqIFRoaXMgaW1wbGVtZW50YXRpb24gZG9lcyBub3QgcGVybWl0IGVzY2Fw\nZWQgJyAnLCAnPScsICc6JwogKiBjaGFyYWN0ZXJzIGluIGtleSBuYW1lcy4K\nICoKICogQHNpbmNlIDAuMy4zCiAqLwpwdWJsaWMgY2xhc3MgRm9ybWF0UHJl\nc2VydmluZ1Byb3BlcnRpZXMgZXh0ZW5kcyBQcm9wZXJ0aWVzIHsKCiAgICBw\ncml2YXRlIHN0YXRpYyBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQ\nYWNrYWdlCiAgICAgICAgKEZvcm1hdFByZXNlcnZpbmdQcm9wZXJ0aWVzLmNs\nYXNzKTsKCiAgICBwcml2YXRlIGNoYXIgZGVmYXVsdEVudHJ5RGVsaW1pdGVy\nID0gJzonOwogICAgcHJpdmF0ZSBib29sZWFuIGFkZFdoaXRlc3BhY2VBZnRl\nckRlbGltaXRlciA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gYWxsb3dE\ndXBsaWNhdGVzID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gaW5zZXJ0\nVGltZXN0YW1wID0gZmFsc2U7CgogICAgcHJpdmF0ZSBQcm9wZXJ0eVNvdXJj\nZSBzb3VyY2U7CiAgICBwcml2YXRlIExpc3RPcmRlcmVkU2V0IG5ld0tleXMg\nPSBuZXcgTGlzdE9yZGVyZWRTZXQoKTsKICAgIHByaXZhdGUgSGFzaFNldCBt\nb2RpZmllZEtleXMgPSBuZXcgSGFzaFNldCgpOwoKICAgIC8vIG1hcmtlciB0\naGF0IGluZGljYXRlcyB0aGF0IHdlJ3JlIG5vdCBkZXNlcmlhbGl6aW5nCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIGlzTm90RGVzZXJpYWxpemlu\nZyA9IHRydWU7CiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIGlzTG9h\nZGluZyA9IGZhbHNlOwoKICAgIHB1YmxpYyBGb3JtYXRQcmVzZXJ2aW5nUHJv\ncGVydGllcygpIHsKICAgICAgICB0aGlzKG51bGwpOwogICAgfQoKICAgIHB1\nYmxpYyBGb3JtYXRQcmVzZXJ2aW5nUHJvcGVydGllcyhQcm9wZXJ0aWVzIGRl\nZmF1bHRzKSB7CiAgICAgICAgc3VwZXIoZGVmYXVsdHMpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIGNoYXJhY3RlciB0byB1c2UgYXMgYSBkZWxpbWl0\nZXIgYmV0d2VlbiBwcm9wZXJ0eSBrZXlzIGFuZCB2YWx1ZXMuCiAgICAgKgog\nICAgICogQHBhcmFtIGRlZmF1bHRFbnRyeURlbGltaXRlciBlaXRoZXIgJzon\nIG9yICc9JwogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZWZhdWx0RW50\ncnlEZWxpbWl0ZXIoY2hhciBkZWZhdWx0RW50cnlEZWxpbWl0ZXIpIHsKICAg\nICAgICB0aGlzLmRlZmF1bHRFbnRyeURlbGltaXRlciA9IGRlZmF1bHRFbnRy\neURlbGltaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNlZSB7QGxpbmsg\nI3NldERlZmF1bHRFbnRyeURlbGltaXRlcn0KICAgICAqLwogICAgcHVibGlj\nIGNoYXIgZ2V0RGVmYXVsdEVudHJ5RGVsaW1pdGVyKCkgewogICAgICAgIHJl\ndHVybiB0aGlzLmRlZmF1bHRFbnRyeURlbGltaXRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIElmIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPiwgdGhpcyBw\ncm9wZXJ0aWVzIG9iamVjdCB3aWxsIGFkZCBhCiAgICAgKiBzcGFjZSBhZnRl\nciB0aGUgZGVsaW1pdGVyIGNoYXJhY3RlcihpZiB0aGUgZGVsaW1pdGVyIGlz\nIG5vdAogICAgICogdGhlIHNwYWNlIGNoYXJhY3RlcikuIEVsc2UsIHRoaXMg\nd2lsbCBub3QgYWRkIGEgc3BhY2UuCiAgICAgKiBEZWZhdWx0IHZhbHVlOiA8\nY29kZT50cnVlPC9jb2RlPi4gTm90ZSB0aGF0IHtAbGluawogICAgICogUHJv\ncGVydGllcyNzdG9yZX0gbmV2ZXIgd3JpdGVzIHdoaXRlc3BhY2UuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEFkZFdoaXRlc3BhY2VBZnRlckRlbGlt\naXRlcihib29sZWFuIGFkZCkgewogICAgICAgIHRoaXMuYWRkV2hpdGVzcGFj\nZUFmdGVyRGVsaW1pdGVyID0gYWRkOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgc2V0IHRvIDxjb2RlPnRydWU8L2NvZGU+LCB0aGlzIHByb3BlcnRpZXMg\nb2JqZWN0IHdpbGwgYWRkIGEKICAgICAqIHNwYWNlIGFmdGVyIHRoZSBkZWxp\nbWl0ZXIgY2hhcmFjdGVyKGlmIHRoZSBkZWxpbWl0ZXIgaXMgbm90CiAgICAg\nKiB0aGUgc3BhY2UgY2hhcmFjdGVyKS4gRWxzZSwgdGhpcyB3aWxsIG5vdCBh\nZGQgYSBzcGFjZS4KICAgICAqIERlZmF1bHQgdmFsdWU6IDxjb2RlPnRydWU8\nL2NvZGU+LiBOb3RlIHRoYXQge0BsaW5rCiAgICAgKiBQcm9wZXJ0aWVzI3N0\nb3JlfSBuZXZlciB3cml0ZXMgd2hpdGVzcGFjZS4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0QWRkV2hpdGVzcGFjZUFmdGVyRGVsaW1pdGVyKCkg\newogICAgICAgIHJldHVybiB0aGlzLmFkZFdoaXRlc3BhY2VBZnRlckRlbGlt\naXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHNldCB0byA8Y29kZT50\ncnVlPC9jb2RlPiwgdGhpcyBwcm9wZXJ0aWVzIG9iamVjdCB3aWxsIGFkZCBh\nCiAgICAgKiB0aW1lc3RhbXAgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgZmls\nZSwganVzdCBhZnRlciB0aGUgaGVhZGVyCiAgICAgKiAoaWYgYW55KSBpcyBw\ncmludGVkLiBFbHNlLCB0aGlzIHdpbGwgbm90IGFkZCBhIHRpbWVzdGFtcC4K\nICAgICAqIERlZmF1bHQgdmFsdWU6IDxjb2RlPmZhbHNlPC9jb2RlPi4gTm90\nZSB0aGF0IHtAbGluawogICAgICogUHJvcGVydGllcyNzdG9yZX0gYWx3YXlz\nIHdyaXRlcyBhIHRpbWVzdGFtcC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0SW5zZXJ0VGltZXN0YW1wKGJvb2xlYW4gaW5zZXJ0VGltZXN0YW1wKSB7\nCiAgICAgICAgdGhpcy5pbnNlcnRUaW1lc3RhbXAgPSBpbnNlcnRUaW1lc3Rh\nbXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gPGNvZGU+dHJ1\nZTwvY29kZT4sIHRoaXMgcHJvcGVydGllcyBvYmplY3Qgd2lsbCBhZGQgYQog\nICAgICogdGltZXN0YW1wIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZpbGUs\nIGp1c3QgYWZ0ZXIgdGhlIGhlYWRlcgogICAgICogKGlmIGFueSkgaXMgcHJp\nbnRlZC4gRWxzZSwgdGhpcyB3aWxsIG5vdCBhZGQgYSB0aW1lc3RhbXAuCiAg\nICAgKiBEZWZhdWx0IHZhbHVlOiA8Y29kZT5mYWxzZTwvY29kZT4uIE5vdGUg\ndGhhdCB7QGxpbmsKICAgICAqIFByb3BlcnRpZXMjc3RvcmV9IGFsd2F5cyB3\ncml0ZXMgYSB0aW1lc3RhbXAuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGdldEluc2VydFRpbWVzdGFtcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5p\nbnNlcnRUaW1lc3RhbXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBzZXQg\ndG8gPGNvZGU+dHJ1ZTwvY29kZT4sIGR1cGxpY2F0ZSBwcm9wZXJ0aWVzIGFy\nZSBhbGxvd2VkLCBhbmQKICAgICAqIHRoZSBsYXN0IHByb3BlcnR5IHNldHRp\nbmcgaW4gdGhlIGlucHV0IHdpbGwgb3ZlcndyaXRlIGFueSBwcmV2aW91cwog\nICAgICogc2V0dGluZ3MuIElmIHNldCB0byA8Y29kZT5mYWxzZTwvY29kZT4s\nIGR1cGxpY2F0ZSBwcm9wZXJ0eSBkZWZpbml0aW9ucwogICAgICogaW4gdGhl\nIGlucHV0IHdpbGwgY2F1c2UgYW4gZXhjZXB0aW9uIHRvIGJlIHRocm93biBk\ndXJpbmcge0BsaW5rICNsb2FkfS4KICAgICAqIERlZmF1bHQgdmFsdWU6IDxj\nb2RlPmZhbHNlPC9jb2RlPi4gTm90ZSB0aGF0IHtAbGluawogICAgICogUHJv\ncGVydGllcyNzdG9yZX0gYWx3YXlzIGFsbG93cyBkdXBsaWNhdGVzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRBbGxvd0R1cGxpY2F0ZXMoYm9vbGVh\nbiBhbGxvd0R1cGxpY2F0ZXMpIHsKICAgICAgICB0aGlzLmFsbG93RHVwbGlj\nYXRlcyA9IGFsbG93RHVwbGljYXRlczsKICAgIH0KCiAgICAvKioKICAgICAq\nIElmIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPiwgZHVwbGljYXRlIHByb3Bl\ncnRpZXMgYXJlIGFsbG93ZWQsIGFuZAogICAgICogdGhlIGxhc3QgcHJvcGVy\ndHkgc2V0dGluZyBpbiB0aGUgaW5wdXQgd2lsbCBvdmVyd3JpdGUgYW55IHBy\nZXZpb3VzCiAgICAgKiBzZXR0aW5ncy4gSWYgc2V0IHRvIDxjb2RlPmZhbHNl\nPC9jb2RlPiwgZHVwbGljYXRlIHByb3BlcnR5IGRlZmluaXRpb25zCiAgICAg\nKiBpbiB0aGUgaW5wdXQgd2lsbCBjYXVzZSBhbiBleGNlcHRpb24gdG8gYmUg\ndGhyb3duIGR1cmluZyB7QGxpbmsgI2xvYWR9LgogICAgICogRGVmYXVsdCB2\nYWx1ZTogPGNvZGU+ZmFsc2U8L2NvZGU+LiBOb3RlIHRoYXQge0BsaW5rCiAg\nICAgKiBQcm9wZXJ0aWVzI3N0b3JlfSBhbHdheXMgYWxsb3dzIGR1cGxpY2F0\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEFsbG93RHVwbGlj\nYXRlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5hbGxvd0R1cGxpY2F0ZXM7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRQcm9wZXJ0eShTdHJpbmcg\na2V5KSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmdldFByb3BlcnR5KGtleSk7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRQcm9wZXJ0eShTdHJpbmcg\na2V5LCBTdHJpbmcgZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHN1\ncGVyLmdldFByb3BlcnR5KGtleSwgZGVmYXVsdFZhbHVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IHNldFByb3BlcnR5KFN0cmluZyBrZXksIFN0cmlu\nZyB2YWx1ZSkgewogICAgICAgIHJldHVybiBwdXQoa2V5LCB2YWx1ZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDaXJjdW12ZW50cyB0aGUgc3VwZXJjbGFz\ncyB7QGxpbmsgI3B1dEFsbH0gaW1wbGVtZW50YXRpb24sCiAgICAgKiBwdXR0\naW5nIGFsbCB0aGUga2V5LXZhbHVlIHBhaXJzIHZpYSB7QGxpbmsgI3B1dH0u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEFsbChNYXAgbSkgewogICAg\nICAgIE1hcC5FbnRyeSBlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9\nIG0uZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgZSA9IChNYXAuRW50cnkpIGl0ZXIubmV4dCgpOwogICAg\nICAgICAgICBwdXQoZS5nZXRLZXkoKSwgZS5nZXRWYWx1ZSgpKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmVzIHRoZSBrZXkgZnJv\nbSB0aGUgYm9va2tlZXBpbmcgY29sbGVjdGlvdG5zIGFzIHdlbGwuCiAgICAg\nKi8KICAgIHB1YmxpYyBPYmplY3QgcmVtb3ZlKE9iamVjdCBrZXkpIHsKICAg\nICAgICBuZXdLZXlzLnJlbW92ZShrZXkpOwogICAgICAgIHJldHVybiBzdXBl\nci5yZW1vdmUoa2V5KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhcigp\nIHsKICAgICAgICBzdXBlci5jbGVhcigpOwoKICAgICAgICBpZiAoc291cmNl\nICE9IG51bGwpCiAgICAgICAgICAgIHNvdXJjZS5jbGVhcigpOwoKICAgICAg\nICBuZXdLZXlzLmNsZWFyKCk7CiAgICAgICAgbW9kaWZpZWRLZXlzLmNsZWFy\nKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBjbG9uZSgpIHsKICAgICAg\nICBGb3JtYXRQcmVzZXJ2aW5nUHJvcGVydGllcyBjID0gKEZvcm1hdFByZXNl\ncnZpbmdQcm9wZXJ0aWVzKQogICAgICAgICAgICBzdXBlci5jbG9uZSgpOwoK\nICAgICAgICBpZiAoc291cmNlICE9IG51bGwpCiAgICAgICAgICAgIGMuc291\ncmNlID0gKFByb3BlcnR5U291cmNlKSBzb3VyY2UuY2xvbmUoKTsKCiAgICAg\nICAgaWYgKG1vZGlmaWVkS2V5cyAhPSBudWxsKQogICAgICAgICAgICBjLm1v\nZGlmaWVkS2V5cyA9IChIYXNoU2V0KSBtb2RpZmllZEtleXMuY2xvbmUoKTsK\nCiAgICAgICAgaWYgKG5ld0tleXMgIT0gbnVsbCkgewogICAgICAgICAgICBj\nLm5ld0tleXMgPSBuZXcgTGlzdE9yZGVyZWRTZXQoKTsKICAgICAgICAgICAg\nYy5uZXdLZXlzLmFkZEFsbChuZXdLZXlzKTsKICAgICAgICB9CgogICAgICAg\nIHJldHVybiBjOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZU9iamVj\ndChPYmplY3RPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIG91dC5kZWZhdWx0V3JpdGVPYmplY3QoKTsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgcmVhZE9iamVjdChPYmplY3RJbnB1dFN0cmVhbSBp\nbikKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRF\neGNlcHRpb24gewogICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7Cgog\nICAgICAgIGlzTm90RGVzZXJpYWxpemluZyA9IHRydWU7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBwdXQoT2JqZWN0IGtleSwgT2JqZWN0IHZhbCkgewog\nICAgICAgIE9iamVjdCBvID0gc3VwZXIucHV0KGtleSwgdmFsKTsKCiAgICAg\nICAgLy8gaWYgd2UncmUgbm8gbG9uZ2VyIGxvYWRpbmcgZnJvbSBwcm9wZXJ0\naWVzIGFuZCB0aGlzIHB1dAogICAgICAgIC8vIHJlcHJlc2VudHMgYW4gYWN0\ndWFsIGNoYW5nZSBpbiB2YWx1ZSwgbWFyayB0aGUgbW9kaWZpY2F0aW9uCiAg\nICAgICAgLy8gb3IgYWRkaXRpb24gaW4gdGhlIGJvb2trZWVwaW5nIGNvbGxl\nY3Rpb25zLgogICAgICAgIGlmICghaXNMb2FkaW5nICYmIGlzTm90RGVzZXJp\nYWxpemluZyAmJiAhdmFsLmVxdWFscyhvKSkgewogICAgICAgICAgICBpZiAo\nbyAhPSBudWxsKQogICAgICAgICAgICAgICAgbW9kaWZpZWRLZXlzLmFkZChr\nZXkpOwogICAgICAgICAgICBlbHNlIGlmICghbmV3S2V5cy5jb250YWlucyhr\nZXkpKQogICAgICAgICAgICAgICAgbmV3S2V5cy5hZGQoa2V5KTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG87CiAgICB9CgogICAgLyoqCiAgICAgKiBM\nb2FkcyB0aGUgcHJvcGVydGllcyBpbiA8Y29kZT5pbjwvY29kZT4sIGFjY29y\nZGluZyB0byB0aGUgcnVsZXMKICAgICAqIGRlc2NyaWJlZCBpbiB7QGxpbmsg\nUHJvcGVydGllcyNsb2FkfS4gSWYge0BsaW5rICNnZXRBbGxvd0R1cGxpY2F0\nZXN9CiAgICAgKiByZXR1cm5zIDxjb2RlPnRydWU8L2NvZGU+LCB0aGlzIHdp\nbGwgdGhyb3cgYSB7QGxpbmsKICAgICAqIER1cGxpY2F0ZUtleUV4Y2VwdGlv\nbn0gaWYgZHVwbGljYXRlIHByb3BlcnR5IGRlY2xhcmF0aW9ucyBhcmUKICAg\nICAqIGVuY291bnRlcmVkLgogICAgICoKICAgICAqIEBzZWUgUHJvcGVydGll\ncyNsb2FkCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGxvYWQoSW5wdXRTdHJl\nYW0gaW4pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaXNMb2FkaW5n\nID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2FkUHJvcGVy\ndGllcyhpbik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaXNM\nb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBsb2FkUHJvcGVydGllcyhJbnB1dFN0cmVhbSBpbikgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBzb3VyY2UgPSBuZXcgUHJvcGVydHlTb3Vy\nY2UoKTsKCiAgICAgICAgUHJvcGVydHlMaW5lUmVhZGVyIHJlYWRlciA9IG5l\ndyBQcm9wZXJ0eUxpbmVSZWFkZXIoaW4sIHNvdXJjZSk7CgogICAgICAgIFNl\ndCBsb2FkZWRLZXlzID0gbmV3IEhhc2hTZXQoKTsKCiAgICAgICAgZm9yIChQ\ncm9wZXJ0eUxpbmUgbDsKICAgICAgICAgICAgKGwgPSByZWFkZXIucmVhZFBy\nb3BlcnR5TGluZSgpKSAhPSBudWxsICYmIHNvdXJjZS5hZGQobCk7KSB7CiAg\nICAgICAgICAgIFN0cmluZyBsaW5lID0gbC5saW5lLnRvU3RyaW5nKCk7Cgog\nICAgICAgICAgICBjaGFyIGMgPSAwOwogICAgICAgICAgICBpbnQgcG9zID0g\nMDsKCiAgICAgICAgICAgIHdoaWxlIChwb3MgPCBsaW5lLmxlbmd0aCgpICYm\nIGlzU3BhY2UoYyA9IGxpbmUuY2hhckF0KHBvcykpKQogICAgICAgICAgICAg\nICAgcG9zKys7CgogICAgICAgICAgICBpZiAoKGxpbmUubGVuZ3RoKCkgLSBw\nb3MpID09IDAKICAgICAgICAgICAgICAgIHx8IGxpbmUuY2hhckF0KHBvcykg\nPT0gJyMnIHx8IGxpbmUuY2hhckF0KHBvcykgPT0gJyEnKQogICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICBTdHJpbmdCdWZmZXIga2V5\nID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgICAgICB3aGlsZSAocG9z\nIDwgbGluZS5sZW5ndGgoKSAmJiAhaXNTcGFjZShjID0gbGluZS5jaGFyQXQo\ncG9zKyspKQogICAgICAgICAgICAgICAgJiYgYyAhPSAnPScgJiYgYyAhPSAn\nOicpIHsKICAgICAgICAgICAgICAgIGlmIChjID09ICdcXCcpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAocG9zID09IGxpbmUubGVuZ3RoKCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbC5hcHBlbmQobGluZSA9IHJlYWRlci5y\nZWFkTGluZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gMDsK\nICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHBvcyA8IGxpbmUubGVu\nZ3RoKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIGlzU3BhY2Uo\nYyA9IGxpbmUuY2hhckF0KHBvcykpKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgcG9zKys7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgcG9zID0gcmVhZEVzY2FwZShsaW5lLCBw\nb3MsIGtleSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBrZXkuYXBwZW5kKGMp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBib29sZWFuIGlzRGVsaW0gPSAoYyA9PSAnOicgfHwgYyA9PSAnPScpOwoK\nICAgICAgICAgICAgZm9yICg7IHBvcyA8IGxpbmUubGVuZ3RoKCkKICAgICAg\nICAgICAgICAgICYmIGlzU3BhY2UoYyA9IGxpbmUuY2hhckF0KHBvcykpOyBw\nb3MrKykKICAgICAgICAgICAgICAgIDsKCiAgICAgICAgICAgIGlmICghaXNE\nZWxpbSAmJiAoYyA9PSAnOicgfHwgYyA9PSAnPScpKSB7CiAgICAgICAgICAg\nICAgICBwb3MrKzsKICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgPCBsaW5l\nLmxlbmd0aCgpICYmIGlzU3BhY2UoYyA9IGxpbmUuY2hhckF0KHBvcykpKQog\nICAgICAgICAgICAgICAgICAgIHBvcysrOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBTdHJpbmdCdWZmZXIgZWxlbWVudCA9IG5ldyBTdHJpbmdCdWZm\nZXIobGluZS5sZW5ndGgoKSAtIHBvcyk7CgogICAgICAgICAgICB3aGlsZSAo\ncG9zIDwgbGluZS5sZW5ndGgoKSkgewogICAgICAgICAgICAgICAgYyA9IGxp\nbmUuY2hhckF0KHBvcysrKTsKICAgICAgICAgICAgICAgIGlmIChjID09ICdc\nXCcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocG9zID09IGxpbmUubGVu\nZ3RoKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbC5hcHBlbmQobGlu\nZSA9IHJlYWRlci5yZWFkTGluZSgpKTsKCiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChsaW5lID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IDA7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgPCBsaW5lLmxl\nbmd0aCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBpc1NwYWNl\nKGMgPSBsaW5lLmNoYXJBdChwb3MpKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHBvcysrOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50\nLmVuc3VyZUNhcGFjaXR5KGxpbmUubGVuZ3RoKCkgLSBwb3MgKwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5sZW5ndGgoKSk7CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgcG9zID0gcmVhZEVzY2FwZShsaW5lLCBwb3MsIGVsZW1lbnQpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKGMpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBpZiAoIWxvYWRlZEtleXMuYWRkKGtleS50b1N0\ncmluZygpKSAmJiAhYWxsb3dEdXBsaWNhdGVzKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IER1cGxpY2F0ZUtleUV4Y2VwdGlvbihrZXkudG9TdHJpbmco\nKSwKICAgICAgICAgICAgICAgICAgICBnZXRQcm9wZXJ0eShrZXkudG9TdHJp\nbmcoKSksIGVsZW1lbnQudG9TdHJpbmcoKSk7CgogICAgICAgICAgICBsLnNl\ndFByb3BlcnR5S2V5KGtleS50b1N0cmluZygpKTsKICAgICAgICAgICAgbC5z\nZXRQcm9wZXJ0eVZhbHVlKGVsZW1lbnQudG9TdHJpbmcoKSk7CiAgICAgICAg\nICAgIHB1dChrZXkudG9TdHJpbmcoKSwgZWxlbWVudC50b1N0cmluZygpKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIHRoZSBuZXh0\nIGVzY2FwZWQgY2hhcmFjdGVyOiBoYW5kbGUgbmV3bGluZXMsIHRhYnMsIHJl\ndHVybnMsIGFuZAogICAgICogZm9ybSBmZWVkcyB3aXRoIHRoZSBhcHByb3By\naWF0ZSBlc2NhcGVkIGNoYXJhY3RlciwgdGhlbiB0cnkgdG8KICAgICAqIGRl\nY29kZSB1bmljb2RlIGNoYXJhY3RlcnMuIEZpbmFsbHksIGp1c3QgYWRkIHRo\nZSBjaGFyYWN0ZXIgZXhwbGljaXRseS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nc291cmNlIHRoZSBzb3VyY2Ugb2YgdGhlIGNoYXJhY3RlcnMKICAgICAqIEBw\nYXJhbSBwb3MgdGhlIHBvc2l0aW9uIGF0IHdoaWNoIHRvIHN0YXJ0IHJlYWRp\nbmcKICAgICAqIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUgd2UgYXJlIGFwcGVu\nZGluZyB0bwogICAgICogQHJldHVybiB0aGUgcG9zaXRpb24gYWZ0ZXIgdGhl\nIHJlYWRpbmcgaXMgZG9uZQogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBp\nbnQgcmVhZEVzY2FwZShTdHJpbmcgc291cmNlLCBpbnQgcG9zLCBTdHJpbmdC\ndWZmZXIgdmFsdWUpIHsKICAgICAgICBjaGFyIGMgPSBzb3VyY2UuY2hhckF0\nKHBvcysrKTsKICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgY2Fz\nZSAnbic6CiAgICAgICAgICAgICAgICB2YWx1ZS5hcHBlbmQoJ1xuJyk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAndCc6CiAg\nICAgICAgICAgICAgICB2YWx1ZS5hcHBlbmQoJ1x0Jyk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZic6CiAgICAgICAgICAg\nICAgICB2YWx1ZS5hcHBlbmQoJ1xmJyk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSAncic6CiAgICAgICAgICAgICAgICB2YWx1\nZS5hcHBlbmQoJ1xyJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSAndSc6CiAgICAgICAgICAgICAgICBpZiAocG9zICsgNCA8\nPSBzb3VyY2UubGVuZ3RoKCkpIHsKICAgICAgICAgICAgICAgICAgICBjaGFy\nIHVuaSA9IChjaGFyKSBJbnRlZ2VyLnBhcnNlSW50CiAgICAgICAgICAgICAg\nICAgICAgICAgIChzb3VyY2Uuc3Vic3RyaW5nKHBvcywgcG9zICsgNCksIDE2\nKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZS5hcHBlbmQodW5pKTsKICAg\nICAgICAgICAgICAgICAgICBwb3MgKz0gNDsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgdmFsdWUuYXBwZW5kKGMpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcG9zOwogICAg\nfQoKICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNTcGFjZShjaGFyIGNo\nKSB7CiAgICAgICAgcmV0dXJuIENoYXJhY3Rlci5pc1doaXRlc3BhY2UoY2gp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNhdmUoT3V0cHV0U3RyZWFtIG91\ndCwgU3RyaW5nIGhlYWRlcikgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHN0b3JlKG91dCwgaGVhZGVyKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw\ndGlvbiBleCkgewogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZShPdXRwdXRTdHJlYW0gb3V0LCBTdHJpbmcgaGVhZGVyKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIGJvb2xlYW4gZW5kV2l0aE5ld2xpbmUg\nPSBzb3VyY2UgIT0gbnVsbCAmJiBzb3VyY2UuZW5kc0luTmV3bGluZTsKCiAg\nICAgICAgLy8gTXVzdCBiZSBJU08tODg1OS0xIGVjb2RpbmcgYWNjb3JkaW5n\nIHRvIFByb3BlcnRpZXMubG9hZCBqYXZhZG9jCiAgICAgICAgUHJpbnRXcml0\nZXIgd3JpdGVyID0gbmV3IFByaW50V3JpdGVyCiAgICAgICAgICAgIChuZXcg\nT3V0cHV0U3RyZWFtV3JpdGVyKG91dCwgIklTTy04ODU5LTEiKSwgZmFsc2Up\nOwoKICAgICAgICBpZiAoaGVhZGVyICE9IG51bGwpCiAgICAgICAgICAgIHdy\naXRlci5wcmludGxuKCIjIiArIGhlYWRlcik7CgogICAgICAgIGlmIChpbnNl\ncnRUaW1lc3RhbXApCiAgICAgICAgICAgIHdyaXRlci5wcmludGxuKCIjIiAr\nIENhbGVuZGFyLmdldEluc3RhbmNlKCkuZ2V0VGltZSgpKTsKCiAgICAgICAg\nTGlzdCBsaW5lcyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgLy8gZmly\nc3Qgd3JpdGUgYWxsIHRoZSBleGlzdGluZyBwcm9wcyBhcyB0aGV5IHdlcmUg\naW5pdGlhbGx5IHJlYWQKICAgICAgICBpZiAoc291cmNlICE9IG51bGwpCiAg\nICAgICAgICAgIGxpbmVzLmFkZEFsbChzb3VyY2UpOwoKICAgICAgICAvLyBu\nZXh0IHdyaXRlIG91dCBuZXcga2V5cywgdGhlbiB0aGUgcmVzdCBvZiB0aGUg\na2V5cwogICAgICAgIExpc3RPcmRlcmVkU2V0IGtleXMgPSBuZXcgTGlzdE9y\nZGVyZWRTZXQoKTsKICAgICAgICBrZXlzLmFkZEFsbChuZXdLZXlzKTsKICAg\nICAgICBrZXlzLmFkZEFsbChrZXlTZXQoKSk7CgogICAgICAgIGxpbmVzLmFk\nZEFsbChrZXlzKTsKCiAgICAgICAga2V5cy5yZW1vdmUobnVsbCk7CgogICAg\nICAgIGJvb2xlYW4gbmVlZHNOZXdsaW5lID0gZmFsc2U7CgogICAgICAgIGZv\nciAoSXRlcmF0b3IgaSA9IGxpbmVzLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBPYmplY3QgbmV4dCA9IGkubmV4dCgpOwoKICAg\nICAgICAgICAgaWYgKG5leHQgaW5zdGFuY2VvZiBQcm9wZXJ0eUxpbmUpIHsK\nICAgICAgICAgICAgICAgIGlmICgoKFByb3BlcnR5TGluZSkgbmV4dCkud3Jp\ndGUod3JpdGVyLCBrZXlzLCBuZWVkc05ld2xpbmUpKQogICAgICAgICAgICAg\nICAgICAgIG5lZWRzTmV3bGluZSA9IGkuaGFzTmV4dCgpOwogICAgICAgICAg\nICB9IGVsc2UgaWYgKG5leHQgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAg\nICAgICAgICAgIFN0cmluZyBrZXkgPSAoU3RyaW5nKSBuZXh0OwogICAgICAg\nICAgICAgICAgaWYgKGtleXMucmVtb3ZlKGtleSkpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAod3JpdGVQcm9wZXJ0eShrZXksIHdyaXRlciwgbmVlZHNO\nZXdsaW5lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBuZWVkc05ld2xp\nbmUgPSBpLmhhc05leHQoKSAmJiBrZXlzLnNpemUoKSA+IDA7CgogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBhbnkgbmV3IG9yIG1vZGlmaWVkIHByb3Bl\ncnRpZXMgd2lsbCBjYXVzZQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0\naGUgZmlsZSB0byBlbmQgd2l0aCBhIG5ld2xpbmUKICAgICAgICAgICAgICAg\nICAgICAgICAgZW5kV2l0aE5ld2xpbmUgPSB0cnVlOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGVuZCBpbiBhIG5ld2xp\nbmUgaWYgdGhlIHNvdXJjZSBlbmRlZCBpbiBpdAogICAgICAgIGlmIChlbmRX\naXRoTmV3bGluZSkKICAgICAgICAgICAgd3JpdGVyLnByaW50bG4oKTsKCiAg\nICAgICAgd3JpdGVyLmZsdXNoKCk7CiAgICB9CgogICAgcHJpdmF0ZSBib29s\nZWFuIHdyaXRlUHJvcGVydHkoU3RyaW5nIGtleSwgUHJpbnRXcml0ZXIgd3Jp\ndGVyLAogICAgICAgIGJvb2xlYW4gbmVlZHNOZXdsaW5lKSB7CiAgICAgICAg\nU3RyaW5nQnVmZmVyIHMgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CgogICAgICAg\nIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICBTdHJpbmcgdmFsID0gZ2V0UHJvcGVydHkoa2V5KTsKICAgICAg\nICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgZm9ybWF0VmFsdWUoa2V5LCBzLCB0cnVlKTsKICAgICAgICBz\nLmFwcGVuZChkZWZhdWx0RW50cnlEZWxpbWl0ZXIpOwogICAgICAgIGlmIChh\nZGRXaGl0ZXNwYWNlQWZ0ZXJEZWxpbWl0ZXIpCiAgICAgICAgICAgIHMuYXBw\nZW5kKCcgJyk7CiAgICAgICAgZm9ybWF0VmFsdWUodmFsLCBzLCBmYWxzZSk7\nCgogICAgICAgIGlmIChuZWVkc05ld2xpbmUpCiAgICAgICAgICAgIHdyaXRl\nci5wcmludGxuKCk7CgogICAgICAgIHdyaXRlci5wcmludChzKTsKCiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JtYXQg\ndGhlIGdpdmVuIHN0cmluZyBhcyBhbiBlbmNvZGVkIHZhbHVlIGZvciBzdG9y\nYWdlLiBUaGlzIHdpbGwKICAgICAqIHBlcmZvcm0gYW55IG5lY2Vzc2FyeSBl\nc2NhcGluZyBvZiBzcGVjaWFsIGNoYXJhY3RlcnMuCiAgICAgKgogICAgICog\nQHBhcmFtIHN0ciB0aGUgdmFsdWUgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0g\nYnVmIHRoZSBidWZmZXIgdG8gd2hpY2ggdG8gYXBwZW5kIHRoZSBlbmNvZGVk\nIHZhbHVlCiAgICAgKiBAcGFyYW0gaXNLZXkgaWYgdHJ1ZSwgdGhlbiB0aGUg\nc3RyaW5nIGlzIGEgUHJvcGVydHkga2V5LCBvdGhlcndpc2UKICAgICAqIGl0\nIGlzIGEgdmFsdWUKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBm\nb3JtYXRWYWx1ZShTdHJpbmcgc3RyLCBTdHJpbmdCdWZmZXIgYnVmLAogICAg\nICAgIGJvb2xlYW4gaXNLZXkpIHsKICAgICAgICBpZiAoaXNLZXkpIHsKICAg\nICAgICAgICAgYnVmLnNldExlbmd0aCgwKTsKICAgICAgICAgICAgYnVmLmVu\nc3VyZUNhcGFjaXR5KHN0ci5sZW5ndGgoKSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgYnVmLmVuc3VyZUNhcGFjaXR5KGJ1Zi5sZW5ndGgoKSAr\nIHN0ci5sZW5ndGgoKSk7CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGVz\nY2FwZVNwYWNlID0gdHJ1ZTsKICAgICAgICBpbnQgc2l6ZSA9IHN0ci5sZW5n\ndGgoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzaXplOyBpKysp\nIHsKICAgICAgICAgICAgY2hhciBjID0gc3RyLmNoYXJBdChpKTsKCiAgICAg\nICAgICAgIGlmIChjID09ICdcbicpCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCJcXG4iKTsKICAgICAgICAgICAgZWxzZSBpZiAoYyA9PSAnXHInKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiXFxyIik7CiAgICAgICAgICAg\nIGVsc2UgaWYgKGMgPT0gJ1x0JykKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIlxcdCIpOwogICAgICAgICAgICBlbHNlIGlmIChjID09ICdcZicpCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCJcXGYiKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoYyA9PSAnICcpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKGVzY2FwZVNwYWNlID8gIlxcICIgOiAiICIpOwogICAgICAgICAgICBlbHNl\nIGlmIChjID09ICdcXCcgfHwgYyA9PSAnIScgfHwgYyA9PSAnIycgfHwgYyA9\nPSAnPScgfHwgYyA9PSAnOicpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCdcXCcpLmFwcGVuZChjKTsKICAgICAgICAgICAgZWxzZSBpZiAoYyA8ICcg\nJyB8fCBjID4gJ34nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiXFx1\nMDAwMCIuc3Vic3RyaW5nKDAsIDYgLSBJbnRlZ2VyLnRvSGV4U3RyaW5nKGMp\nLgogICAgICAgICAgICAgICAgICAgIGxlbmd0aCgpKSkuYXBwZW5kKEludGVn\nZXIudG9IZXhTdHJpbmcoYykpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKGMpOwoKICAgICAgICAgICAgaWYgKGMgIT0g\nJyAnKQogICAgICAgICAgICAgICAgZXNjYXBlU3BhY2UgPSBpc0tleTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBjbGFzcyBEdXBsaWNh\ndGVLZXlFeGNlcHRpb24gZXh0ZW5kcyBSdW50aW1lRXhjZXB0aW9uIHsKCiAg\nICAgICAgcHVibGljIER1cGxpY2F0ZUtleUV4Y2VwdGlvbihTdHJpbmcga2V5\nLCBPYmplY3QgZmlyc3RWYWwsCiAgICAgICAgICAgIFN0cmluZyBzZWNvbmRW\nYWwpIHsKICAgICAgICAgICAgc3VwZXIoX2xvYy5nZXQoImR1cC1rZXkiLCBr\nZXksIGZpcnN0VmFsLCBzZWNvbmRWYWwpLmdldE1lc3NhZ2UoKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29udGFpbnMgdGhlIG9yaWdp\nbmFsIGxpbmUgb2YgdGhlIHByb3BlcnRpZXMgZmlsZTogY2FuIGJlIGEKICAg\nICAqIHByb3BlciBrZXkvdmFsdWUgcGFpciwgb3IgYSBjb21tZW50LCBvciBq\ndXN0IHdoaXRlc3BhY2UuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgUHJv\ncGVydHlMaW5lIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBTdHJpbmdCdWZmZXIgbGluZSA9IG5ldyBTdHJpbmdC\ndWZmZXIoKTsKICAgICAgICBwcml2YXRlIFN0cmluZyBwcm9wZXJ0eUtleTsK\nICAgICAgICBwcml2YXRlIFN0cmluZyBwcm9wZXJ0eVZhbHVlOwoKICAgICAg\nICBwdWJsaWMgUHJvcGVydHlMaW5lKFN0cmluZyBsaW5lKSB7CiAgICAgICAg\nICAgIHRoaXMubGluZS5hcHBlbmQobGluZSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBhcHBlbmQoU3RyaW5nIG5ld2xpbmUpIHsKICAgICAg\nICAgICAgbGluZS5hcHBlbmQoU3lzdGVtLmdldFByb3BlcnR5KCJsaW5lLnNl\ncGFyYXRvciIpKTsKICAgICAgICAgICAgbGluZS5hcHBlbmQobmV3bGluZSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXRQcm9wZXJ0eUtl\neShTdHJpbmcgcHJvcGVydHlLZXkpIHsKICAgICAgICAgICAgdGhpcy5wcm9w\nZXJ0eUtleSA9IHByb3BlcnR5S2V5OwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFN0cmluZyBnZXRQcm9wZXJ0eUtleSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIHRoaXMucHJvcGVydHlLZXk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBzZXRQcm9wZXJ0eVZhbHVlKFN0cmluZyBwcm9wZXJ0eVZhbHVl\nKSB7CiAgICAgICAgICAgIHRoaXMucHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5\nVmFsdWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFBy\nb3BlcnR5VmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3Bl\ncnR5VmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBX\ncml0ZSB0aGUgZ2l2ZW4gbGluZS4gSXQgd2lsbCBvbmx5IGJlIHdyaXR0ZW4g\naWYgdGhlIGxpbmUgaXMgYQogICAgICAgICAqIGNvbW1lbnQsIG9yIGlmIGl0\nIGlzIGEgcHJvcGVydHkgYW5kIGl0cyB2YWx1ZSBpcyB1bmNoYW5nZWQKICAg\nICAgICAgKiBmcm9tIHRoZSBvcmlnaW5hbC4KICAgICAgICAgKgogICAgICAg\nICAqIEBwYXJhbSBwdyB0aGUgUHJpbnRXcml0ZXIgdG8gd2hpY2ggdGhlIHdy\naXRlCiAgICAgICAgICogQHJldHVybiB3aGV0aGVyIG9yIG5vdCB0aGlzIHdh\ncyBhIGtub3duIGtleQogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBib29s\nZWFuIHdyaXRlKFByaW50V3JpdGVyIHB3LCBDb2xsZWN0aW9uIGtleXMsCiAg\nICAgICAgICAgIGJvb2xlYW4gbmVlZHNOZXdsaW5lKSB7CiAgICAgICAgICAg\nIC8vIG5vIHByb3BlcnR5PyBJdCBtYXkgYmUgYSBjb21tZW50IG9yIGp1c3Qg\nd2hpdGVzcGFjZQogICAgICAgICAgICBpZiAocHJvcGVydHlLZXkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgaWYgKG5lZWRzTmV3bGluZSkKICAgICAg\nICAgICAgICAgICAgICBwdy5wcmludGxuKCk7CiAgICAgICAgICAgICAgICBw\ndy5wcmludChsaW5lLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNoZWNr\nIHRvIHNlZSBpZiB3ZSBhcmUgdGhlIHNhbWUgdmFsdWUgd2UgaW5pdGlhbGx5\nIHJlYWQ6CiAgICAgICAgICAgIC8vIGlmIHNvLCB0aGVuIGp1c3Qgd3JpdGUg\naXQgYmFjayBleGFjdGx5IGFzIGl0IHdhcyByZWFkCiAgICAgICAgICAgIGlm\nIChwcm9wZXJ0eVZhbHVlICE9IG51bGwgJiYgY29udGFpbnNLZXkocHJvcGVy\ndHlLZXkpICYmCiAgICAgICAgICAgICAgICAocHJvcGVydHlWYWx1ZS5lcXVh\nbHMoZ2V0UHJvcGVydHkocHJvcGVydHlLZXkpKSB8fAogICAgICAgICAgICAg\nICAgICAgICghbmV3S2V5cy5jb250YWlucyhwcm9wZXJ0eUtleSkgJiYKICAg\nICAgICAgICAgICAgICAgICAgICAgIW1vZGlmaWVkS2V5cy5jb250YWlucyhw\ncm9wZXJ0eUtleSkpKSkgewogICAgICAgICAgICAgICAgaWYgKG5lZWRzTmV3\nbGluZSkKICAgICAgICAgICAgICAgICAgICBwdy5wcmludGxuKCk7CiAgICAg\nICAgICAgICAgICBwdy5wcmludChsaW5lLnRvU3RyaW5nKCkpOwoKICAgICAg\nICAgICAgICAgIGtleXMucmVtb3ZlKHByb3BlcnR5S2V5KTsKCiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gaWYgd2UgaGF2ZSBtb2RpZmllZCBvciBhZGRlZCB0aGUgc3BlY2lm\naWVkIGtleSwgdGhlbiB3cml0ZQogICAgICAgICAgICAvLyBpdCBiYWNrIHRv\nIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBmaWxlIGZyb20gd2hpY2ggaXQK\nICAgICAgICAgICAgLy8gd2FzIG9yaWdpbmFsbHkgcmVhZCwgc28gdGhhdCBp\ndCB3aWxsIGJlIGluIHRoZSBwcm94aW1pdHkKICAgICAgICAgICAgLy8gdG8g\ndGhlIGNvbW1lbnQKICAgICAgICAgICAgaWYgKGNvbnRhaW5zS2V5KHByb3Bl\ncnR5S2V5KSAmJgogICAgICAgICAgICAgICAgKG1vZGlmaWVkS2V5cy5jb250\nYWlucyhwcm9wZXJ0eUtleSkgfHwKICAgICAgICAgICAgICAgICAgICBuZXdL\nZXlzLmNvbnRhaW5zKHByb3BlcnR5S2V5KSkpIHsKICAgICAgICAgICAgICAg\nIHdoaWxlIChrZXlzLnJlbW92ZShwcm9wZXJ0eUtleSkpIDsKICAgICAgICAg\nICAgICAgIHJldHVybiB3cml0ZVByb3BlcnR5KHByb3BlcnR5S2V5LCBwdywg\nbmVlZHNOZXdsaW5lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\ndGhpcyBpcyBhIG5ldyBvciBjaGFuZ2VkIHByb3BlcnR5OiBkb24ndCBkbyBh\nbnl0aGluZwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgY2xhc3MgUHJvcGVydHlMaW5lUmVhZGVyIGV4\ndGVuZHMgQnVmZmVyZWRSZWFkZXIgewoKICAgICAgICBwdWJsaWMgUHJvcGVy\ndHlMaW5lUmVhZGVyKElucHV0U3RyZWFtIGluLCBQcm9wZXJ0eVNvdXJjZSBz\nb3VyY2UpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIC8vIE11c3QgYmUgSVNPLTg4NTktMSBlY29kaW5nIGFjY29yZGlu\nZyB0byBQcm9wZXJ0aWVzLmxvYWQgamF2YWRvYwogICAgICAgICAgICBzdXBl\ncihuZXcgSW5wdXRTdHJlYW1SZWFkZXIobmV3IExpbmVFbmRpbmdTdHJlYW0o\naW4sIHNvdXJjZSksCiAgICAgICAgICAgICAgICAiSVNPLTg4NTktMSIpKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBQcm9wZXJ0eUxpbmUgcmVhZFBy\nb3BlcnR5TGluZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIFN0cmluZyBsID0gcmVhZExpbmUoKTsKICAgICAgICAgICAgaWYgKGwgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAg\nICAgUHJvcGVydHlMaW5lIHBsID0gbmV3IFByb3BlcnR5TGluZShsKTsKICAg\nICAgICAgICAgcmV0dXJuIHBsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFNpbXBsZSBGaWx0ZXJJbnB1dFN0cmVhbSB0aGF0IG1lcmVseSBy\nZW1lbWJlcnMgaWYgdGhlIGxhc3QKICAgICAqIGNoYXJhY3RlciB0aGF0IGl0\nIHJlYWQgd2FzIGEgbmV3bGluZSBvciBub3QuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIExpbmVFbmRpbmdTdHJlYW0gZXh0ZW5kcyBGaWx0\nZXJJbnB1dFN0cmVhbSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgUHJvcGVy\ndHlTb3VyY2Ugc291cmNlOwoKICAgICAgICBMaW5lRW5kaW5nU3RyZWFtKElu\ncHV0U3RyZWFtIGluLCBQcm9wZXJ0eVNvdXJjZSBzb3VyY2UpIHsKICAgICAg\nICAgICAgc3VwZXIoaW4pOwoKICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBz\nb3VyY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHJlYWQoKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICBpbnQgYyA9IHN1cGVy\nLnJlYWQoKTsKICAgICAgICAgICAgc291cmNlLmVuZHNJbk5ld2xpbmUgPSAo\nYyA9PSAnXG4nIHx8IGMgPT0gJ1xyJyk7CiAgICAgICAgICAgIHJldHVybiBj\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCByZWFkKGJ5dGVbXSBi\nLCBpbnQgb2ZmLCBpbnQgbGVuKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgICAgICBpbnQgbiA9IHN1cGVyLnJlYWQoYiwgb2ZmLCBsZW4pOwogICAg\nICAgICAgICBpZiAobiA+IDApCiAgICAgICAgICAgICAgICBzb3VyY2UuZW5k\nc0luTmV3bGluZSA9CiAgICAgICAgICAgICAgICAgICAgKGJbbiArIG9mZiAt\nIDFdID09ICdcbicgfHwgYltuICsgb2ZmIC0gMV0gPT0gJ1xyJyk7CiAgICAg\nICAgICAgIHJldHVybiBuOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMg\nY2xhc3MgUHJvcGVydHlTb3VyY2UgZXh0ZW5kcyBMaW5rZWRMaXN0CiAgICAg\nICAgaW1wbGVtZW50cyBDbG9uZWFibGUsIFNlcmlhbGl6YWJsZSB7CgogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBlbmRzSW5OZXdsaW5lID0gZmFsc2U7CiAg\nICB9Cn0K\n","encoding":"base64"}

