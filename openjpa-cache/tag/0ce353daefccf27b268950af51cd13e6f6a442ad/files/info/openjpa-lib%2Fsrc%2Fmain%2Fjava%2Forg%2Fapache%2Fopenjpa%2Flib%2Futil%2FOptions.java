{"sha":"000101c55f822c3dbe5d5cf70836d2391142a095","node_id":"MDQ6QmxvYjIwNjM2NDowMDAxMDFjNTVmODIyYzNkYmU1ZDVjZjcwODM2ZDIzOTExNDJhMDk1","size":23668,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/000101c55f822c3dbe5d5cf70836d2391142a095","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbDsKCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5D\nb25zdHJ1Y3RvcjsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5s\nYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQg\namF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwpp\nbXBvcnQgamF2YS51dGlsLlRyZWVTZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBzZXJwLnV0aWwuU3Ry\naW5nczsKCi8qKgogKiBBIHNwZWNpYWxpemF0aW9uIG9mIHRoZSB7QGxpbmsg\nUHJvcGVydGllc30gbWFwIHR5cGUgd2l0aCB0aGUgYWRkZWQKICogYWJpbGl0\naWVzIHRvIHJlYWQgYXBwbGljYXRpb24gb3B0aW9ucyBmcm9tIHRoZSBjb21t\nYW5kIGxpbmUgYW5kIHRvCiAqIHVzZSBiZWFuIHBhdHRlcm5zIHRvIHNldCBh\nbiBvYmplY3QncyBwcm9wZXJ0aWVzIHZpYSBjb21tYW5kLWxpbmUgdGhlCiAq\nIHN0b3JlZCBtYXBwaW5ncy4KICogQSB0eXBpY2FsIHVzZSBwYXR0ZXJuIGZv\nciB0aGlzIGNsYXNzIGlzIHRvIGNvbnN0cnVjdCBhIG5ldyBpbnN0YW5jZQog\nKiBpbiB0aGUgPGNvZGU+bWFpbjwvY29kZT4gbWV0aG9kLCB0aGVuIGNhbGwg\ne0BsaW5rICNzZXRGcm9tQ21kTGluZX0gd2l0aCB0aGUKICogZ2l2ZW4gYXJn\ncy4gTmV4dCwgYW4gaW5zdGFuY2VvZiB0aGUgY2xhc3MgYmVpbmcgaW52b2tl\nZCBpcyBjcmVhdGVkLCBhbmQKICoge0BsaW5rICNzZXRJbnRvfSBpcyBjYWxs\nZWQgd2l0aCB0aGF0IGluc3RhbmNlIGFzIGEgcGFyYW1ldGVyLiBXaXRoIHRo\naXMKICogcGF0dGVybiwgdGhlIHVzZXIgY2FuIGNvbmZpZ3VyZSBhbnkgYmVh\nbiBwcm9wZXJ0aWVzIG9mIHRoZSBjbGFzcywgb3IgZXZlbgogKiBwcm9wZXJ0\naWVzIG9mIGNsYXNzZXMgcmVhY2hhYmxlIGZyb20gdGhlIGNsYXNzLCB0aHJv\ndWdoIHRoZSBjb21tYW5kIGxpbmUuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBPcHRpb25zIGV4dGVu\nZHMgVHlwZWRQcm9wZXJ0aWVzIHsKCiAgICAvKioKICAgICAqIEltbXV0YWJs\nZSBlbXB0eSBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBP\ncHRpb25zIEVNUFRZID0gbmV3IEVtcHR5T3B0aW9ucygpOwoKICAgIC8vIG1h\ncHMgcHJpbWl0aXZlIHR5cGVzIHRvIHRoZSBhcHByb3ByaWF0ZSB3cmFwcGVy\nIGNsYXNzIGFuZCBkZWZhdWx0IHZhbHVlCiAgICBwcml2YXRlIHN0YXRpYyBP\nYmplY3RbXVtdIF9wcmltV3JhcHBlcnMgPSBuZXcgT2JqZWN0W11bXXsKICAg\nICAgICB7IGJvb2xlYW4uY2xhc3MsIEJvb2xlYW4uY2xhc3MsIEJvb2xlYW4u\nRkFMU0UgfSwKICAgICAgICB7IGJ5dGUuY2xhc3MsIEJ5dGUuY2xhc3MsIG5l\ndyBCeXRlKChieXRlKSAwKSB9LAogICAgICAgIHsgY2hhci5jbGFzcywgQ2hh\ncmFjdGVyLmNsYXNzLCBuZXcgQ2hhcmFjdGVyKChjaGFyKSAwKSB9LAogICAg\nICAgIHsgZG91YmxlLmNsYXNzLCBEb3VibGUuY2xhc3MsIG5ldyBEb3VibGUo\nMEQpIH0sCiAgICAgICAgeyBmbG9hdC5jbGFzcywgRmxvYXQuY2xhc3MsIG5l\ndyBGbG9hdCgwRikgfSwKICAgICAgICB7IGludC5jbGFzcywgSW50ZWdlci5j\nbGFzcywgbmV3IEludGVnZXIoMCkgfSwKICAgICAgICB7IGxvbmcuY2xhc3Ms\nIExvbmcuY2xhc3MsIG5ldyBMb25nKDBMKSB9LAogICAgICAgIHsgc2hvcnQu\nY2xhc3MsIFNob3J0LmNsYXNzLCBuZXcgU2hvcnQoKHNob3J0KSAwKSB9LCB9\nOwoKICAgIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4KICAgICAq\nLwogICAgcHVibGljIE9wdGlvbnMoKSB7CiAgICAgICAgc3VwZXIoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCB0aGUgb3B0aW9ucyBpbnN0\nYW5jZSB3aXRoIHRoZSBnaXZlbiBzZXQgb2YgZGVmYXVsdHMuCiAgICAgKgog\nICAgICogQHNlZSBQcm9wZXJ0aWVzI1Byb3BlcnRpZXMoUHJvcGVydGllcykK\nICAgICAqLwogICAgcHVibGljIE9wdGlvbnMoUHJvcGVydGllcyBkZWZhdWx0\ncykgewogICAgICAgIHN1cGVyKGRlZmF1bHRzKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlcyB0aGUgZ2l2ZW4gYXJndW1lbnQgbGlzdCBpbnRvIGZs\nYWcvdmFsdWUgcGFpcnMsIHdoaWNoIGFyZSBzdG9yZWQKICAgICAqIGFzIHBy\nb3BlcnRpZXMuIEZsYWdzIHRoYXQgYXJlIHByZXNlbnQgd2l0aG91dCB2YWx1\nZXMgYXJlIGdpdmVuCiAgICAgKiB0aGUgdmFsdWUgInRydWUiLiBJZiBhbnkg\nZmxhZyBpcyBmb3VuZCBmb3Igd2hpY2ggdGhlcmUgaXMgYWxyZWFkeQogICAg\nICogYSBtYXBwaW5nIHByZXNlbnQsIHRoZSBleGlzdGluZyBtYXBwaW5nIHdp\nbGwgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKiBGbGFncyBzaG91bGQgYmUgb2Yg\ndGhlIGZvcm06PGJyIC8+CiAgICAgKiA8Y29kZT5qYXZhIEZvbyAtZmxhZzEg\ndmFsdWUxIC1mbGFnMiB2YWx1ZTIgLi4uIGFyZzEgYXJnMiAuLi48L2NvZGU+\nCiAgICAgKgogICAgICogQHBhcmFtIGFyZ3MgdGhlIGNvbW1hbmQtbGluZSBh\ncmd1bWVudHMKICAgICAqIEByZXR1cm4gYWxsIGFyZ3VtZW50cyBpbiB0aGUg\nb3JpZ2luYWwgYXJyYXkgYmV5b25kIHRoZQogICAgICogZmxhZy92YWx1ZSBw\nYWlyIGxpc3QKICAgICAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBzZXRGcm9tQ21kTGluZShTdHJpbmdb\nXSBhcmdzKSB7CiAgICAgICAgaWYgKGFyZ3MgPT0gbnVsbCB8fCBhcmdzLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gYXJnczsKCiAgICAgICAg\nU3RyaW5nIGtleSA9IG51bGw7CiAgICAgICAgU3RyaW5nIHZhbHVlID0gbnVs\nbDsKICAgICAgICBMaXN0IHJlbWFpbmRlciA9IG5ldyBMaW5rZWRMaXN0KCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aCArIDE7\nIGkrKykgewogICAgICAgICAgICBpZiAoaSA9PSBhcmdzLmxlbmd0aCB8fCBh\ncmdzW2ldLnN0YXJ0c1dpdGgoIi0iKSkgewogICAgICAgICAgICAgICAga2V5\nID0gdHJpbVF1b3RlKGtleSk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkodmFsdWUpKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRQ\ncm9wZXJ0eShrZXksIHRyaW1RdW90ZSh2YWx1ZSkpOwogICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc2V0UHJvcGVy\ndHkoa2V5LCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIGlmIChpID09IGFyZ3MubGVuZ3RoKQogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAga2V5ID0gYXJnc1tpXS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\nICAgICAgICAgICAgdmFsdWUgPSBudWxsOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9IGVsc2UgaWYgKGtleSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBzZXRQcm9wZXJ0eShrZXksIHRyaW1RdW90ZShhcmdzW2ldKSk7\nCiAgICAgICAgICAgICAgICBrZXkgPSBudWxsOwogICAgICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgICAgIHJlbWFpbmRlci5hZGQoYXJnc1tpXSk7CiAg\nICAgICAgfQoKICAgICAgICByZXR1cm4gKFN0cmluZ1tdKSByZW1haW5kZXIu\ndG9BcnJheShuZXcgU3RyaW5nW3JlbWFpbmRlci5zaXplKCldKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIHVzZXMgcmVmbGVjdGlvbiB0\nbyBzZXQgYWxsIHRoZSBwcm9wZXJ0aWVzIGluIHRoZSBnaXZlbgogICAgICog\nb2JqZWN0IHRoYXQgYXJlIG5hbWVkIGJ5IHRoZSBrZXlzIGluIHRoaXMgbWFw\nLiBGb3IgYSBnaXZlbiBrZXkgJ2ZvbycsCiAgICAgKiB0aGUgYWxnb3JpdGht\nIHdpbGwgbG9vayBmb3IgYSAnc2V0Rm9vJyBtZXRob2QgaW4gdGhlIGdpdmVu\nIGluc3RhbmNlLgogICAgICogRm9yIGEgZ2l2ZW4ga2V5ICdmb28uYmFyJywg\ndGhlIGFsZ29yaXRobSB3aWxsIGZpcnN0IGxvb2sgZm9yIGEKICAgICAqICdn\nZXRGb28nIG1ldGhvZCBpbiB0aGUgZ2l2ZW4gaW5zdGFuY2UsIHRoZW4gd2ls\nbCByZWN1cnNlIG9uIHRoZSByZXR1cm4KICAgICAqIHZhbHVlIG9mIHRoYXQg\nbWV0aG9kLCBub3cgbG9va2luZyBmb3IgdGhlICdiYXInIHByb3BlcnR5LiBU\naGlzIGFsbG93cwogICAgICogdGhlIHNldHRpbmcgb2YgbmVzdGVkIG9iamVj\ndCBwcm9wZXJ0aWVzLiBJZiBpbiB0aGUgYWJvdmUgZXhhbXBsZSB0aGUKICAg\nICAqICdnZXRGb28nIG1ldGhvZCBpcyBub3QgcHJlc2VudCBvciByZXR1cm5z\nIG51bGwsIHRoZSBhbGdvcml0aG0gd2lsbAogICAgICogbG9vayBmb3IgYSAn\nc2V0Rm9vJyBtZXRob2Q7IGlmIGZvdW5kIGl0IHdpbGwgY29uc3RyY3QgYSBu\nZXcgaW5zdGFuY2UKICAgICAqIG9mIHRoZSBjb3JyZWN0IHR5cGUsIHNldCBp\ndCB1c2luZyB0aGUgJ3NldEZvbycgbWV0aG9kLCB0aGVuIHJlY3Vyc2Ugb24K\nICAgICAqIGl0IGFzIGFib3ZlLiBQcm9wZXJ0eSBuYW1lcyBjYW4gYmUgbmVz\ndGVkIGluIHRoaXMgd2F5IHRvIGFuIGFyYml0cmFyeQogICAgICogZGVwdGgu\nIEZvciBzZXR0ZXIgbWV0aG9kcyB0aGF0IHRha2UgbXVsdGlwbGUgcGFyYW1l\ndGVycywgdGhlIHZhbHVlCiAgICAgKiBtYXBwZWQgdG8gdGhlIGtleSBjYW4g\ndXNlIHRoZSAnLCcgYXMgYW4gYXJndW1lbnQgc2VwYXJhdG9yIGNoYXJhY3Rl\nci4KICAgICAqIElmIG5vdCBlbm91Z2ggdmFsdWVzIGFyZSBwcmVzZW50IGZv\nciBhIGdpdmVuIG1ldGhvZCBhZnRlciBzcGxpdHRpbmcKICAgICAqIHRoZSBz\ndHJpbmcgb24gJywnLCB0aGUgcmVtYWluaW5nIGFyZ3VtZW50cyB3aWxsIHJl\nY2VpdmUgZGVmYXVsdAogICAgICogdmFsdWVzLiBBbGwgYXJndW1lbnRzIGFy\nZSBjb252ZXJ0ZWQgZnJvbSBzdHJpbmcgZm9ybSB0byB0aGUKICAgICAqIGNv\ncnJlY3QgdHlwZSBpZiBwb3NzaWJsZShpLmUuIGlmIHRoZSB0eXBlIGlzIHBy\naW1pdGl2ZSwKICAgICAqIGphdmEubGFuZy5DbGFzLCBvciBoYXMgYSBjb25z\ndHJ1Y3RvciB0aGF0IHRha2VzIGEgc2luZ2xlIHN0cmluZwogICAgICogYXJn\ndW1lbnQpLiBFeGFtcGxlczoKICAgICAqIDx1bD4KICAgICAqIDxsaT5NYXAg\nRW50cnk6IDxjb2RlPiJhZ2UiLSZndDsiMTIiPC9jb2RlPjxiciAvPgogICAg\nICogUmVzdWx0YW50IG1ldGhvZCBjYWxsOiA8Y29kZT5vYmouc2V0QWdlKDEy\nKTwvY29kZT48L2xpPgogICAgICogPGxpPk1hcCBFbnRyeTogPGNvZGU+InJh\nbmdlIi0mZ3Q7IjEsMjAiPC9jb2RlPjxiciAvPgogICAgICogUmVzdWx0YW50\nIG1ldGhvZCBjYWxsOiA8Y29kZT5vYmouc2V0UmFuZ2UoMSwgMjApPC9jb2Rl\nPjwvbGk+CiAgICAgKiA8bGk+TWFwIEVudHJ5OiA8Y29kZT4icmFuZ2UiLSZn\ndDsiMTAiPC9jb2RlPjxiciAvPgogICAgICogUmVzdWx0YW50IG1ldGhvZCBj\nYWxsOiA8Y29kZT5vYmouc2V0UmFuZ2UoMTAsIDEwKTwvY29kZT48L2xpPgog\nICAgICogPGxpPk1hcCBFbnRyeTogPGNvZGU+ImJyb3RoZXIubmFtZSItJmd0\nOyJCb2IiPC9jb2RlPjxiciAvPgogICAgICogUmVzdWx0YW50IG1ldGhvZCBj\nYWxsOiA8Y29kZT5vYmouZ2V0QnJvdGhlcigpLnNldE5hbWUoIkJvYiIpCiAg\nICAgKiA8Y29kZT48L2xpPgogICAgICogPC91bD4gCiAgICAgKiBBbnkga2V5\ncyBwcmVzZW50IGluIHRoZSBtYXAgZm9yIHdoaWNoIHRoZXJlIGlzIG5vCiAg\nICAgKiBjb3JyZXNwb25kaW5nIHByb3BlcnR5IGluIHRoZSBnaXZlbiBvYmpl\nY3Qgd2lsbCBiZSBpZ25vcmVkLAogICAgICogYW5kIHdpbGwgYmUgcmV0dXJu\nZWQgaW4gdGhlIHtAbGluayBNYXB9IHJldHVybmVkIGJ5IHRoaXMgbWV0aG9k\nLgogICAgICoKICAgICAqIEByZXR1cm4gYW4ge0BsaW5rIE9wdGlvbnN9IG9m\nIGtleS12YWx1ZSBwYWlycyBpbiB0aGlzIG9iamVjdAogICAgICogZm9yIHdo\naWNoIG5vIHNldHRlcnMgY291bGQgYmUgZm91bmQuCiAgICAgKiBAdGhyb3dz\nIFJ1bnRpbWVFeGNlcHRpb24gb24gcGFyc2UgZXJyb3IKICAgICAqLwogICAg\ncHVibGljIE9wdGlvbnMgc2V0SW50byhPYmplY3Qgb2JqKSB7CiAgICAgICAg\nLy8gc2V0IGFsbCBkZWZhdWx0cyB0aGF0IGhhdmUgbm8gZXhwbGljaXQgdmFs\ndWUKICAgICAgICBNYXAuRW50cnkgZW50cnkgPSBudWxsOwogICAgICAgIGlm\nIChkZWZhdWx0cyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gZGVmYXVsdHMuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZW50\ncnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\naWYgKCFjb250YWluc0tleShlbnRyeS5nZXRLZXkoKSkpCiAgICAgICAgICAg\nICAgICAgICAgc2V0SW50byhvYmosIGVudHJ5KTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gc2V0IGZyb20gbWFpbiBtYXAKICAgICAg\nICBPcHRpb25zIGludmFsaWRFbnRyaWVzID0gbnVsbDsKICAgICAgICBNYXAu\nRW50cnkgZTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGVudHJ5U2V0\nKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nZSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICgh\nc2V0SW50byhvYmosIGUpKSB7CiAgICAgICAgICAgICAgICBpZiAoaW52YWxp\nZEVudHJpZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpbnZhbGlk\nRW50cmllcyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgICAgICAgICBpbnZh\nbGlkRW50cmllcy5wdXQoZS5nZXRLZXkoKSwgZS5nZXRWYWx1ZSgpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gKGludmFsaWRF\nbnRyaWVzID09IG51bGwpID8gRU1QVFkgOiBpbnZhbGlkRW50cmllczsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldHMgdGhlIHByb3BlcnR5IG5hbWVkIGJ5\nIHRoZSBrZXkgb2YgdGhlIGdpdmVuIGVudHJ5IGluIHRoZQogICAgICogZ2l2\nZW4gb2JqZWN0LgogICAgICoKICAgICAqIEByZXR1cm4gPGNvZGU+dHJ1ZTwv\nY29kZT4gaWYgdGhlIHNldCBzdWNjZWVkZWQsIG9yCiAgICAgKiA8Y29kZT5m\nYWxzZTwvY29kZT4gaWYgbm8gbWV0aG9kIGNvdWxkIGJlIGZvdW5kIGZvciB0\naGlzIHByb3BlcnR5LgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc2V0\nSW50byhPYmplY3Qgb2JqLCBNYXAuRW50cnkgZW50cnkpIHsKICAgICAgICBp\nZiAoZW50cnkuZ2V0S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBsb29rIGZv\nciBtYXRjaGluZyBwYXJhbWV0ZXIgb2Ygb2JqZWN0CiAgICAgICAgICAgIE9i\namVjdFtdIG1hdGNoID0gbmV3IE9iamVjdFtdeyBvYmosIG51bGwgfTsKICAg\nICAgICAgICAgaWYgKCFtYXRjaE9wdGlvblRvTWVtYmVyKGVudHJ5LmdldEtl\neSgpLnRvU3RyaW5nKCksIG1hdGNoKSkKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgICAgIENsYXNzW10gdHlwZSA9IGdldFR5cGUo\nbWF0Y2hbMV0pOwogICAgICAgICAgICBPYmplY3RbXSB2YWx1ZXMgPSBuZXcg\nT2JqZWN0W3R5cGUubGVuZ3RoXTsKICAgICAgICAgICAgU3RyaW5nW10gc3Ry\nVmFsdWVzOwogICAgICAgICAgICBpZiAoZW50cnkuZ2V0VmFsdWUoKSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgc3RyVmFsdWVzID0gbmV3IFN0cmluZ1sx\nXTsKICAgICAgICAgICAgZWxzZSBpZiAodmFsdWVzLmxlbmd0aCA9PSAxKQog\nICAgICAgICAgICAgICAgc3RyVmFsdWVzID0gbmV3IFN0cmluZ1tdeyBlbnRy\neS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCkgfTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgc3RyVmFsdWVzID0gU3RyaW5ncy5zcGxpdChlbnRy\neS5nZXRWYWx1ZSgpLnRvU3RyaW5nKCksICIsIiwgMCk7CgogICAgICAgICAg\nICAvLyBjb252ZXJ0IHRoZSBzdHJpbmcgdmFsdWVzIGludG8gcGFyYW1ldGVy\nIHZhbHVlcywgaWYgbm90CiAgICAgICAgICAgIC8vIGVub3VnaCBzdHJpbmcg\ndmFsdWVzIHJlcGVhdCBsYXN0IG9uZSBmb3IgcmVzdAogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHN0clZhbHVlcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgICAgIHZhbHVlc1tpXSA9IHN0cmluZ1RvT2JqZWN0KHN0clZh\nbHVlc1tpXS50cmltKCksIHR5cGVbaV0pOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gc3RyVmFsdWVzLmxlbmd0aDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgIHZhbHVlc1tpXSA9IGdldERlZmF1bHRWYWx1\nZSh0eXBlW2ldKTsKCiAgICAgICAgICAgIC8vIGludm9rZSB0aGUgc2V0dGVy\nIC8gc2V0IHRoZSBmaWVsZAogICAgICAgICAgICBpbnZva2UobWF0Y2hbMF0s\nIG1hdGNoWzFdLCB2YWx1ZXMpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICB0\naHJvdyBuZXcgUGFyc2VFeGNlcHRpb24ob2JqICsgIi4iICsgZW50cnkuZ2V0\nS2V5KCkKICAgICAgICAgICAgICAgICsgIiA9ICIgKyBlbnRyeS5nZXRWYWx1\nZSgpLCB0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1v\ndmVzIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNpbmdsZSBxdW90ZXMgZnJvbSB0\naGUgZ2l2ZW4gU3RyaW5nLCBpZiBhbnkuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIFN0cmluZyB0cmltUXVvdGUoU3RyaW5nIHZhbCkgewogICAgICAg\nIGlmICh2YWwgIT0gbnVsbCAmJiB2YWwuc3RhcnRzV2l0aCgiJyIpICYmIHZh\nbC5lbmRzV2l0aCgiJyIpKQogICAgICAgICAgICByZXR1cm4gdmFsLnN1YnN0\ncmluZygxLCB2YWwubGVuZ3RoKCkgLSAxKTsKICAgICAgICByZXR1cm4gdmFs\nOwogICAgfQoKICAgIC8qKgogICAgICogRmluZHMgYWxsIHRoZSBvcHRpb25z\nIHRoYXQgY2FuIGJlIHNldCBvbiB0aGUgcHJvdmlkZWQgY2xhc3MuIFRoaXMg\nZG9lcwogICAgICogbm90IGxvb2sgZm9yIHBhdGgtdHJhdmVyc2FsIGV4cHJl\nc3Npb25zLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIFRoZSBjbGFzcyBm\nb3Igd2hpY2ggYXZhaWxhYmxlIG9wdGlvbnMgc2hvdWxkIGJlIGxpc3RlZC4K\nICAgICAqIEByZXR1cm4gVGhlIGF2YWlsYWJsZSBvcHRpb24gbmFtZXMgaW4g\nPGNvZGU+dHlwZTwvY29kZT4uIFRoZQogICAgICogbmFtZXMgd2lsbCBoYXZl\nIGluaXRpYWwgY2Fwcy4gVGhleSB3aWxsIGJlIG9yZGVyZWQgYWxwaGFiZXRp\nY2FsbHkuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ29sbGVjdGlvbiBm\naW5kT3B0aW9uc0ZvcihDbGFzcyB0eXBlKSB7CiAgICAgICAgQ29sbGVjdGlv\nbiBuYW1lcyA9IG5ldyBUcmVlU2V0KCk7CiAgICAgICAgLy8gbG9vayBmb3Ig\nYSBzZXR0ZXIgbWV0aG9kIG1hdGNoaW5nIHRoZSBrZXkKICAgICAgICBNZXRo\nb2RbXSBtZXRocyA9IHR5cGUuZ2V0TWV0aG9kcygpOwogICAgICAgIENsYXNz\nW10gcGFyYW1zOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1ldGhzW2ldLmdldE5h\nbWUoKS5zdGFydHNXaXRoKCJzZXQiKSkgewogICAgICAgICAgICAgICAgcGFy\nYW1zID0gbWV0aHNbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICAg\nICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAocGFyYW1zWzBd\nLmlzQXJyYXkoKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICBuYW1lcy5hZGQoU3RyaW5nVXRpbHMuY2FwaXRhbGl6\nZSgKICAgICAgICAgICAgICAgICAgICBtZXRoc1tpXS5nZXROYW1lKCkuc3Vi\nc3RyaW5nKDMpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIGNoZWNrIGZvciBwdWJsaWMgZmllbGRzCiAgICAgICAgRmllbGRbXSBm\naWVsZHMgPSB0eXBlLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBuYW1l\ncy5hZGQoU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmaWVsZHNbaV0uZ2V0TmFt\nZSgpKSk7CgogICAgICAgIHJldHVybiBuYW1lczsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1hdGNoZXMgYSBrZXkgdG8gYW4gb2JqZWN0L3NldHRlciBwYWly\nLgogICAgICoKICAgICAqIEBwYXJhbSBrZXkgdGhlIGtleSBnaXZlbiBhdCB0\naGUgY29tbWFuZCBsaW5lOyBtYXkgYmUgb2YgdGhlIGZvcm0KICAgICAqICdm\nb28uYmFyJyB0byBzaWduaWZ5IHRoZSAnYmFyJyBwcm9wZXJ0eSBvZiB0aGUg\nJ2Zvbycgb3duZWQgb2JqZWN0CiAgICAgKiBAcGFyYW0gbWF0Y2ggYW4gYXJy\nYXkgb2YgbGVuZ3RoIDIsIHdoZXJlIHRoZSBmaXJzdCBpbmRleCBpcyBzZXQK\nICAgICAqIHRvIHRoZSBvYmplY3QgdG8gcmV0cmlldmUgdGhlIHNldHRlciBm\nb3IKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhIG1hdGNoIHdhcyBtYWRlLCBm\nYWxzZSBvdGhlcndpc2U7IGFkZGl0aW9uYWxseSwKICAgICAqIHRoZSBmaXJz\ndCBpbmRleCBvZiB0aGUgbWF0Y2ggYXJyYXkgd2lsbCBiZSBzZXQgdG8KICAg\nICAqIHRoZSBtYXRjaGluZyBvYmplY3QgYW5kIHRoZSBzZWNvbmQgaW5kZXgg\nd2lsbCBiZQogICAgICogc2V0IHRvIHRoZSBzZXR0ZXIgbWV0aG9kIG9yIHB1\nYmxpYyBmaWVsZCBmb3IgdGhlCiAgICAgKiBwcm9wZXJ0eSBuYW1lZCBieSB0\naGUga2V5CiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gbWF0\nY2hPcHRpb25Ub01lbWJlcihTdHJpbmcga2V5LCBPYmplY3RbXSBtYXRjaCkK\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShrZXkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIC8vIHVuZm9ydHVuYXRlbHkgd2UgY2FuJ3QgdXNlIGJlYW4g\ncHJvcGVydGllcyBmb3Igc2V0dGVyczsgYW55CiAgICAgICAgLy8gc2V0dGVy\nIHdpdGggbW9yZSB0aGFuIDEgYXJnIGlzIGlnbm9yZWQ7IGNhbGMgc2V0dGVy\nIGFuZCBnZXR0ZXIKICAgICAgICAvLyBuYW1lIHRvIGxvb2sgZm9yCiAgICAg\nICAgU3RyaW5nW10gZmluZCA9IFN0cmluZ3Muc3BsaXQoa2V5LCAiLiIsIDIp\nOwogICAgICAgIFN0cmluZyBiYXNlID0gU3RyaW5nVXRpbHMuY2FwaXRhbGl6\nZShmaW5kWzBdKTsKICAgICAgICBTdHJpbmcgc2V0ID0gInNldCIgKyBiYXNl\nOwogICAgICAgIFN0cmluZyBnZXQgPSAiZ2V0IiArIGJhc2U7CgogICAgICAg\nIC8vIGxvb2sgZm9yIGEgc2V0dGVyL2dldHRlciBtYXRjaGluZyB0aGUga2V5\nOyBsb29rIGZvciBtZXRob2RzIGZpcnN0CiAgICAgICAgQ2xhc3MgdHlwZSA9\nIG1hdGNoWzBdLmdldENsYXNzKCk7CiAgICAgICAgTWV0aG9kW10gbWV0aHMg\nPSB0eXBlLmdldE1ldGhvZHMoKTsKICAgICAgICBNZXRob2Qgc2V0TWV0aCA9\nIG51bGw7CiAgICAgICAgTWV0aG9kIGdldE1ldGggPSBudWxsOwogICAgICAg\nIENsYXNzW10gcGFyYW1zOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbWV0aHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG1ldGhzW2ld\nLmdldE5hbWUoKS5lcXVhbHMoc2V0KSkgewogICAgICAgICAgICAgICAgcGFy\nYW1zID0gbWV0aHNbaV0uZ2V0UGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICAg\nICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAocGFyYW1zWzBd\nLmlzQXJyYXkoKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICAvLyB1c2UgdGhpcyBtZXRob2QgaWYgd2UgaGF2ZW4n\ndCBmb3VuZCBhbnkgb3RoZXIgc2V0dGVyLCBpZgogICAgICAgICAgICAgICAg\nLy8gaXQgaGFzIGxlc3MgcGFyYW1ldGVycyB0aGFuIGFueSBvdGhlciBzZXR0\nZXIsIG9yIGlmIGl0IHVzZXMKICAgICAgICAgICAgICAgIC8vIHN0cmluZyBw\nYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICBpZiAoc2V0TWV0aCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHNldE1ldGggPSBtZXRoc1tpXTsKICAg\nICAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtcy5sZW5ndGggPCBzZXRNZXRo\nLmdldFBhcmFtZXRlclR5cGVzKCkubGVuZ3RoKQogICAgICAgICAgICAgICAg\nICAgIHNldE1ldGggPSBtZXRoc1tpXTsKICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKHBhcmFtcy5sZW5ndGggPT0gc2V0TWV0aC5nZXRQYXJhbWV0ZXJUeXBl\ncygpLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICYmIHBhcmFtc1swXSA9\nPSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgc2V0TWV0aCA9\nIG1ldGhzW2ldOwogICAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhzW2ldLmdl\ndE5hbWUoKS5lcXVhbHMoZ2V0KSkKICAgICAgICAgICAgICAgIGdldE1ldGgg\nPSBtZXRoc1tpXTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG5vIG1ldGhv\nZHMgZm91bmQsIGNoZWNrIGZvciBwdWJsaWMgZmllbGQKICAgICAgICBNZW1i\nZXIgc2V0dGVyID0gc2V0TWV0aDsKICAgICAgICBNZW1iZXIgZ2V0dGVyID0g\nZ2V0TWV0aDsKICAgICAgICBpZiAoc2V0dGVyID09IG51bGwpIHsKICAgICAg\nICAgICAgRmllbGRbXSBmaWVsZHMgPSB0eXBlLmdldEZpZWxkcygpOwogICAg\nICAgICAgICBTdHJpbmcgdW5jYXBCYXNlID0gU3RyaW5nVXRpbHMudW5jYXBp\ndGFsaXplKGZpbmRbMF0pOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5nZXROYW1lKCkuZXF1YWxzKGJhc2UpCiAgICAgICAgICAg\nICAgICAgICAgfHwgZmllbGRzW2ldLmdldE5hbWUoKS5lcXVhbHModW5jYXBC\nYXNlKSkgewogICAgICAgICAgICAgICAgICAgIHNldHRlciA9IGZpZWxkc1tp\nXTsKICAgICAgICAgICAgICAgICAgICBnZXR0ZXIgPSBmaWVsZHNbaV07CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIG5vIHdheSB0\nbyBhY2Nlc3MgcHJvcGVydHksIGdpdmUgdXAKICAgICAgICBpZiAoc2V0dGVy\nID09IG51bGwgJiYgZ2V0dGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgLy8gcmVjdXJzZSBvbiBpbm5lciBvYmplY3Qg\nd2l0aCByZW1haW5kZXIgb2Yga2V5PwogICAgICAgIGlmIChmaW5kLmxlbmd0\naCA+IDEpIHsKICAgICAgICAgICAgT2JqZWN0IGlubmVyID0gbnVsbDsKICAg\nICAgICAgICAgaWYgKGdldHRlciAhPSBudWxsKQogICAgICAgICAgICAgICAg\naW5uZXIgPSBpbnZva2UobWF0Y2hbMF0sIGdldHRlciwgbnVsbCk7CgogICAg\nICAgICAgICAvLyBpZiBubyBnZXR0ZXIgb3IgY3VycmVudCBpbm5lciBpcyBu\ndWxsLCB0cnkgdG8gY3JlYXRlIGEgbmV3CiAgICAgICAgICAgIC8vIGlubmVy\nIGluc3RhbmNlIGFuZCBzZXQgaXQgaW4gb2JqZWN0CiAgICAgICAgICAgIGlm\nIChpbm5lciA9PSBudWxsICYmIHNldHRlciAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBDbGFzcyBpbm5lclR5cGUgPSBnZXRUeXBlKHNldHRlcilbMF07\nCiAgICAgICAgICAgICAgICBpbm5lciA9IGlubmVyVHlwZS5uZXdJbnN0YW5j\nZSgpOwogICAgICAgICAgICAgICAgaW52b2tlKG1hdGNoWzBdLCBzZXR0ZXIs\nIG5ldyBPYmplY3RbXXsgaW5uZXIgfSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgbWF0Y2hbMF0gPSBpbm5lcjsKICAgICAgICAgICAgcmV0dXJuIG1h\ndGNoT3B0aW9uVG9NZW1iZXIoZmluZFsxXSwgbWF0Y2gpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gZ290IG1hdGNoOyBmaW5kIHNldHRlciBmb3IgcHJvcGVy\ndHkKICAgICAgICBtYXRjaFsxXSA9IHNldHRlcjsKICAgICAgICByZXR1cm4g\nbWF0Y2hbMV0gIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgdHlwZXMgb2YgdGhlIHBhcmFtZXRlcnMgbmVlZGVkIHRvIHNldCB0\naGUgZ2l2ZW4gbWVtYmVyLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBD\nbGFzc1tdIGdldFR5cGUoT2JqZWN0IG1lbWJlcikgewogICAgICAgIGlmICht\nZW1iZXIgaW5zdGFuY2VvZiBNZXRob2QpCiAgICAgICAgICAgIHJldHVybiAo\nKE1ldGhvZCkgbWVtYmVyKS5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAgICAg\nIHJldHVybiBuZXcgQ2xhc3NbXXsgKChGaWVsZCkgbWVtYmVyKS5nZXRUeXBl\nKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gbWVt\nYmVyIHRvIHRoZSBnaXZlbiB2YWx1ZShzKS4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgT2JqZWN0IGludm9rZShPYmplY3QgdGFyZ2V0LCBPYmplY3Qg\nbWVtYmVyLCBPYmplY3RbXSB2YWx1ZXMpCiAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKG1lbWJlciBpbnN0YW5jZW9mIE1ldGhvZCkK\nICAgICAgICAgICAgcmV0dXJuICgoTWV0aG9kKSBtZW1iZXIpLmludm9rZSh0\nYXJnZXQsIHZhbHVlcyk7CiAgICAgICAgaWYgKHZhbHVlcyA9PSBudWxsIHx8\nIHZhbHVlcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuICgoRmll\nbGQpIG1lbWJlcikuZ2V0KHRhcmdldCk7CiAgICAgICAgKChGaWVsZCkgbWVt\nYmVyKS5zZXQodGFyZ2V0LCB2YWx1ZXNbMF0pOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydHMgdGhlIGdpdmVu\nIHN0cmluZyBpbnRvIGFuIG9iamVjdCBvZiB0aGUgZ2l2ZW4gdHlwZSwgb3Ig\naXRzCiAgICAgKiB3cmFwcGVyIHR5cGUgaWYgaXQgaXMgcHJpbWl0aXZlLgog\nICAgICovCiAgICBwcml2YXRlIE9iamVjdCBzdHJpbmdUb09iamVjdChTdHJp\nbmcgc3RyLCBDbGFzcyB0eXBlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBzcGVjaWFsIGNhc2UgZm9yIG51bGwgYW5kIGZvciBzdHJpbmdzCiAg\nICAgICAgaWYgKHN0ciA9PSBudWxsIHx8IHR5cGUgPT0gU3RyaW5nLmNsYXNz\nKQogICAgICAgICAgICByZXR1cm4gc3RyOwoKICAgICAgICAvLyBzcGVjaWFs\nIGNhc2UgZm9yIGNyZWF0aW5nIENsYXNzIGluc3RhbmNlcwogICAgICAgIGlm\nICh0eXBlID09IENsYXNzLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gQ2xh\nc3MuZm9yTmFtZShzdHIsIGZhbHNlLCBnZXRDbGFzcygpLmdldENsYXNzTG9h\nZGVyKCkpOwoKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIG51bWVyaWMg\ndHlwZXMgdGhhdCBlbmQgaW4gLjA7IHN0cmlwIHRoZSBkZWNpbWFsCiAgICAg\nICAgLy8gcGxhY2VzIGJlY2F1c2UgaXQgY2FuIGtpbGwgaW50LCBzaG9ydCwg\nbG9uZyBwYXJzaW5nCiAgICAgICAgaWYgKHR5cGUuaXNQcmltaXRpdmUoKSB8\nfCBOdW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAg\nICAgICAgaWYgKHN0ci5sZW5ndGgoKSA+IDIgJiYgc3RyLmVuZHNXaXRoKCIu\nMCIpKQogICAgICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCBz\ndHIubGVuZ3RoKCkgLSAyKTsKCiAgICAgICAgLy8gZm9yIHByaW1pdGl2ZXMs\nIHJlY3Vyc2Ugb24gd3JhcHBlciB0eXBlCiAgICAgICAgaWYgKHR5cGUuaXNQ\ncmltaXRpdmUoKSkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\ncHJpbVdyYXBwZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYg\nKHR5cGUgPT0gX3ByaW1XcmFwcGVyc1tpXVswXSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gc3RyaW5nVG9PYmplY3Qoc3RyLCAoQ2xhc3MpIF9wcmlt\nV3JhcHBlcnNbaV1bMV0pOwoKICAgICAgICAvLyBsb29rIGZvciBhIHN0cmlu\nZyBjb25zdHJ1Y3RvcgogICAgICAgIEV4Y2VwdGlvbiBlcnIgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIENvbnN0cnVjdG9yIGNvbnMgPSB0\neXBlLmdldENvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICAobmV3IENsYXNz\nW117IFN0cmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgaWYgKHR5cGUgPT0g\nQm9vbGVhbi5jbGFzcyAmJiAidCIuZXF1YWxzSWdub3JlQ2FzZShzdHIpKQog\nICAgICAgICAgICAgICAgc3RyID0gInRydWUiOwogICAgICAgICAgICByZXR1\ncm4gY29ucy5uZXdJbnN0YW5jZShuZXcgT2JqZWN0W117IHN0ciB9KTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBlcnIg\nPSBlOwogICAgICAgIH0KCiAgICAgICAgLy8gc3BlY2lhbCBjYXNlOiB0aGUg\nYXJnIHZhbHVlIGlzIGEgc3VidHlwZSBuYW1lIGFuZCBhIG5ldyBpbnN0YW5j\nZQogICAgICAgIC8vIG9mIHRoYXQgdHlwZSBzaG91bGQgYmUgc2V0IGFzIHRo\nZSBvYmplY3QKICAgICAgICBDbGFzcyBzdWJUeXBlID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBzdWJUeXBlID0gQ2xhc3MuZm9yTmFtZShz\ndHIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIHRocm93IGVycjsKICAgICAgICB9CiAgICAgICAgaWYgKCF0eXBlLmlz\nQXNzaWduYWJsZUZyb20oc3ViVHlwZSkpCiAgICAgICAgICAgIHRocm93IGVy\ncjsKICAgICAgICByZXR1cm4gc3ViVHlwZS5uZXdJbnN0YW5jZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZGVmYXVsdCB2YWx1ZSBm\nb3IgdGhlIGdpdmVuIHBhcmFtZXRlciB0eXBlLgogICAgICovCiAgICBwcml2\nYXRlIE9iamVjdCBnZXREZWZhdWx0VmFsdWUoQ2xhc3MgdHlwZSkgewogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3ByaW1XcmFwcGVycy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgaWYgKF9wcmltV3JhcHBlcnNbaV1bMF0gPT0g\ndHlwZSkKICAgICAgICAgICAgICAgIHJldHVybiBfcHJpbVdyYXBwZXJzW2ld\nWzJdOwoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNwZWNpYWxpemF0aW9uIG9mIHtAbGluayAjZ2V0Qm9vbGVhblByb3Bl\ncnR5fSB0byBhbGxvdwogICAgICogYSB2YWx1ZSB0byBhcHBlYXIgdW5kZXIg\nZWl0aGVyIG9mIHR3byBrZXlzOyB1c2VmdWwgZm9yIHNob3J0IGFuZAogICAg\nICogbG9uZyB2ZXJzaW9ucyBvZiBjb21tYW5kLWxpbmUgZmxhZ3MuCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEJvb2xlYW5Qcm9wZXJ0eShTdHJp\nbmcga2V5LCBTdHJpbmcga2V5MiwgYm9vbGVhbiBkZWYpIHsKICAgICAgICBT\ndHJpbmcgdmFsID0gZ2V0UHJvcGVydHkoa2V5KTsKICAgICAgICBpZiAodmFs\nID09IG51bGwpCiAgICAgICAgICAgIHZhbCA9IGdldFByb3BlcnR5KGtleTIp\nOwogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGRlZjsKICAgICAgICByZXR1cm4gInQiLmVxdWFsc0lnbm9yZUNhc2UodmFs\nKSB8fCAidHJ1ZSIuZXF1YWxzSWdub3JlQ2FzZSh2YWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogU3BlY2lhbGl6YXRpb24gb2Yge0BsaW5rIFR5cGVkUHJv\ncGVydGllcyNnZXRGbG9hdFByb3BlcnR5fSB0byBhbGxvdwogICAgICogYSB2\nYWx1ZSB0byBhcHBlYXIgdW5kZXIgZWl0aGVyIG9mIHR3byBrZXlzOyB1c2Vm\ndWwgZm9yIHNob3J0IGFuZAogICAgICogbG9uZyB2ZXJzaW9ucyBvZiBjb21t\nYW5kLWxpbmUgZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCBnZXRG\nbG9hdFByb3BlcnR5KFN0cmluZyBrZXksIFN0cmluZyBrZXkyLCBmbG9hdCBk\nZWYpIHsKICAgICAgICBTdHJpbmcgdmFsID0gZ2V0UHJvcGVydHkoa2V5KTsK\nICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHZhbCA9IGdl\ndFByb3BlcnR5KGtleTIpOwogICAgICAgIHJldHVybiAodmFsID09IG51bGwp\nID8gZGVmIDogRmxvYXQucGFyc2VGbG9hdCh2YWwpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3BlY2lhbGl6YXRpb24gb2Yge0BsaW5rIFR5cGVkUHJvcGVy\ndGllcyNnZXREb3VibGVQcm9wZXJ0eX0gdG8gYWxsb3cKICAgICAqIGEgdmFs\ndWUgdG8gYXBwZWFyIHVuZGVyIGVpdGhlciBvZiB0d28ga2V5czsgdXNlZnVs\nIGZvciBzaG9ydCBhbmQKICAgICAqIGxvbmcgdmVyc2lvbnMgb2YgY29tbWFu\nZC1saW5lIGZsYWdzLgogICAgICovCiAgICBwdWJsaWMgZG91YmxlIGdldERv\ndWJsZVByb3BlcnR5KFN0cmluZyBrZXksIFN0cmluZyBrZXkyLCBkb3VibGUg\nZGVmKSB7CiAgICAgICAgU3RyaW5nIHZhbCA9IGdldFByb3BlcnR5KGtleSk7\nCiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICB2YWwgPSBn\nZXRQcm9wZXJ0eShrZXkyKTsKICAgICAgICByZXR1cm4gKHZhbCA9PSBudWxs\nKSA/IGRlZiA6IERvdWJsZS5wYXJzZURvdWJsZSh2YWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogU3BlY2lhbGl6YXRpb24gb2Yge0BsaW5rIFR5cGVkUHJv\ncGVydGllcyNnZXRMb25nUHJvcGVydHl9IHRvIGFsbG93CiAgICAgKiBhIHZh\nbHVlIHRvIGFwcGVhciB1bmRlciBlaXRoZXIgb2YgdHdvIGtleXM7IHVzZWZ1\nbCBmb3Igc2hvcnQgYW5kCiAgICAgKiBsb25nIHZlcnNpb25zIG9mIGNvbW1h\nbmQtbGluZSBmbGFncy4KICAgICAqLwogICAgcHVibGljIGxvbmcgZ2V0TG9u\nZ1Byb3BlcnR5KFN0cmluZyBrZXksIFN0cmluZyBrZXkyLCBsb25nIGRlZikg\newogICAgICAgIFN0cmluZyB2YWwgPSBnZXRQcm9wZXJ0eShrZXkpOwogICAg\nICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgdmFsID0gZ2V0UHJv\ncGVydHkoa2V5Mik7CiAgICAgICAgcmV0dXJuICh2YWwgPT0gbnVsbCkgPyBk\nZWYgOiBMb25nLnBhcnNlTG9uZyh2YWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogU3BlY2lhbGl6YXRpb24gb2Yge0BsaW5rIFR5cGVkUHJvcGVydGllcyNn\nZXRJbnRQcm9wZXJ0eX0gdG8gYWxsb3cKICAgICAqIGEgdmFsdWUgdG8gYXBw\nZWFyIHVuZGVyIGVpdGhlciBvZiB0d28ga2V5czsgdXNlZnVsIGZvciBzaG9y\ndCBhbmQKICAgICAqIGxvbmcgdmVyc2lvbnMgb2YgY29tbWFuZC1saW5lIGZs\nYWdzLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEludFByb3BlcnR5KFN0\ncmluZyBrZXksIFN0cmluZyBrZXkyLCBpbnQgZGVmKSB7CiAgICAgICAgU3Ry\naW5nIHZhbCA9IGdldFByb3BlcnR5KGtleSk7CiAgICAgICAgaWYgKHZhbCA9\nPSBudWxsKQogICAgICAgICAgICB2YWwgPSBnZXRQcm9wZXJ0eShrZXkyKTsK\nICAgICAgICByZXR1cm4gKHZhbCA9PSBudWxsKSA/IGRlZiA6IEludGVnZXIu\ncGFyc2VJbnQodmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNwZWNpYWxp\nemF0aW9uIG9mIHtAbGluayBQcm9wZXJ0aWVzI2dldFByb3BlcnR5fSB0byBh\nbGxvdwogICAgICogYSB2YWx1ZSB0byBhcHBlYXIgdW5kZXIgZWl0aGVyIG9m\nIHR3byBrZXlzOyB1c2VmdWwgZm9yIHNob3J0IGFuZAogICAgICogbG9uZyB2\nZXJzaW9ucyBvZiBjb21tYW5kLWxpbmUgZmxhZ3MuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0UHJvcGVydHkoU3RyaW5nIGtleSwgU3RyaW5nIGtl\neTIsIFN0cmluZyBkZWYpIHsKICAgICAgICBTdHJpbmcgdmFsID0gZ2V0UHJv\ncGVydHkoa2V5KTsKICAgICAgICByZXR1cm4gKHZhbCA9PSBudWxsKSA/IGdl\ndFByb3BlcnR5KGtleTIsIGRlZikgOiB2YWw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTcGVjaWFsaXphdGlvbiBvZiB7QGxpbmsgVHlwZWRQcm9wZXJ0aWVz\nI3JlbW92ZUJvb2xlYW5Qcm9wZXJ0eX0gdG8gYWxsb3cKICAgICAqIGEgdmFs\ndWUgdG8gYXBwZWFyIHVuZGVyIGVpdGhlciBvZiB0d28ga2V5czsgdXNlZnVs\nIGZvciBzaG9ydCBhbmQKICAgICAqIGxvbmcgdmVyc2lvbnMgb2YgY29tbWFu\nZC1saW5lIGZsYWdzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1v\ndmVCb29sZWFuUHJvcGVydHkoU3RyaW5nIGtleSwgU3RyaW5nIGtleTIsIGJv\nb2xlYW4gZGVmKSB7CiAgICAgICAgU3RyaW5nIHZhbCA9IHJlbW92ZVByb3Bl\ncnR5KGtleSk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICB2YWwgPSByZW1vdmVQcm9wZXJ0eShrZXkyKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJlbW92ZVByb3BlcnR5KGtleTIpOwogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRlZjsKICAgICAgICBy\nZXR1cm4gInQiLmVxdWFsc0lnbm9yZUNhc2UodmFsKSB8fCAidHJ1ZSIuZXF1\nYWxzSWdub3JlQ2FzZSh2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU3Bl\nY2lhbGl6YXRpb24gb2Yge0BsaW5rIFR5cGVkUHJvcGVydGllcyNyZW1vdmVG\nbG9hdFByb3BlcnR5fSB0byBhbGxvdwogICAgICogYSB2YWx1ZSB0byBhcHBl\nYXIgdW5kZXIgZWl0aGVyIG9mIHR3byBrZXlzOyB1c2VmdWwgZm9yIHNob3J0\nIGFuZAogICAgICogbG9uZyB2ZXJzaW9ucyBvZiBjb21tYW5kLWxpbmUgZmxh\nZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCByZW1vdmVGbG9hdFByb3Bl\ncnR5KFN0cmluZyBrZXksIFN0cmluZyBrZXkyLCBmbG9hdCBkZWYpIHsKICAg\nICAgICBTdHJpbmcgdmFsID0gcmVtb3ZlUHJvcGVydHkoa2V5KTsKICAgICAg\nICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHZhbCA9IHJlbW92ZVBy\nb3BlcnR5KGtleTIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVtb3Zl\nUHJvcGVydHkoa2V5Mik7CiAgICAgICAgcmV0dXJuICh2YWwgPT0gbnVsbCkg\nPyBkZWYgOiBGbG9hdC5wYXJzZUZsb2F0KHZhbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTcGVjaWFsaXphdGlvbiBvZiB7QGxpbmsgVHlwZWRQcm9wZXJ0\naWVzI3JlbW92ZURvdWJsZVByb3BlcnR5fSB0byBhbGxvdwogICAgICogYSB2\nYWx1ZSB0byBhcHBlYXIgdW5kZXIgZWl0aGVyIG9mIHR3byBrZXlzOyB1c2Vm\ndWwgZm9yIHNob3J0IGFuZAogICAgICogbG9uZyB2ZXJzaW9ucyBvZiBjb21t\nYW5kLWxpbmUgZmxhZ3MuCiAgICAgKi8KICAgIHB1YmxpYyBkb3VibGUgcmVt\nb3ZlRG91YmxlUHJvcGVydHkoU3RyaW5nIGtleSwgU3RyaW5nIGtleTIsIGRv\ndWJsZSBkZWYpIHsKICAgICAgICBTdHJpbmcgdmFsID0gcmVtb3ZlUHJvcGVy\ndHkoa2V5KTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAg\nIHZhbCA9IHJlbW92ZVByb3BlcnR5KGtleTIpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgcmVtb3ZlUHJvcGVydHkoa2V5Mik7CiAgICAgICAgcmV0dXJu\nICh2YWwgPT0gbnVsbCkgPyBkZWYgOiBEb3VibGUucGFyc2VEb3VibGUodmFs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNwZWNpYWxpemF0aW9uIG9mIHtA\nbGluayBUeXBlZFByb3BlcnRpZXMjcmVtb3ZlTG9uZ1Byb3BlcnR5fSB0byBh\nbGxvdwogICAgICogYSB2YWx1ZSB0byBhcHBlYXIgdW5kZXIgZWl0aGVyIG9m\nIHR3byBrZXlzOyB1c2VmdWwgZm9yIHNob3J0IGFuZAogICAgICogbG9uZyB2\nZXJzaW9ucyBvZiBjb21tYW5kLWxpbmUgZmxhZ3MuCiAgICAgKi8KICAgIHB1\nYmxpYyBsb25nIHJlbW92ZUxvbmdQcm9wZXJ0eShTdHJpbmcga2V5LCBTdHJp\nbmcga2V5MiwgbG9uZyBkZWYpIHsKICAgICAgICBTdHJpbmcgdmFsID0gcmVt\nb3ZlUHJvcGVydHkoa2V5KTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAg\nICAgICAgICAgIHZhbCA9IHJlbW92ZVByb3BlcnR5KGtleTIpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgcmVtb3ZlUHJvcGVydHkoa2V5Mik7CiAgICAg\nICAgcmV0dXJuICh2YWwgPT0gbnVsbCkgPyBkZWYgOiBMb25nLnBhcnNlTG9u\nZyh2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU3BlY2lhbGl6YXRpb24g\nb2Yge0BsaW5rIFR5cGVkUHJvcGVydGllcyNyZW1vdmVJbnRQcm9wZXJ0eX0g\ndG8gYWxsb3cKICAgICAqIGEgdmFsdWUgdG8gYXBwZWFyIHVuZGVyIGVpdGhl\nciBvZiB0d28ga2V5czsgdXNlZnVsIGZvciBzaG9ydCBhbmQKICAgICAqIGxv\nbmcgdmVyc2lvbnMgb2YgY29tbWFuZC1saW5lIGZsYWdzLgogICAgICovCiAg\nICBwdWJsaWMgaW50IHJlbW92ZUludFByb3BlcnR5KFN0cmluZyBrZXksIFN0\ncmluZyBrZXkyLCBpbnQgZGVmKSB7CiAgICAgICAgU3RyaW5nIHZhbCA9IHJl\nbW92ZVByb3BlcnR5KGtleSk7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQog\nICAgICAgICAgICB2YWwgPSByZW1vdmVQcm9wZXJ0eShrZXkyKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHJlbW92ZVByb3BlcnR5KGtleTIpOwogICAg\nICAgIHJldHVybiAodmFsID09IG51bGwpID8gZGVmIDogSW50ZWdlci5wYXJz\nZUludCh2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU3BlY2lhbGl6YXRp\nb24gb2Yge0BsaW5rIFByb3BlcnRpZXMjcmVtb3ZlUHJvcGVydHl9IHRvIGFs\nbG93CiAgICAgKiBhIHZhbHVlIHRvIGFwcGVhciB1bmRlciBlaXRoZXIgb2Yg\ndHdvIGtleXM7IHVzZWZ1bCBmb3Igc2hvcnQgYW5kCiAgICAgKiBsb25nIHZl\ncnNpb25zIG9mIGNvbW1hbmQtbGluZSBmbGFncy4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyByZW1vdmVQcm9wZXJ0eShTdHJpbmcga2V5LCBTdHJpbmcg\na2V5MiwgU3RyaW5nIGRlZikgewogICAgICAgIFN0cmluZyB2YWwgPSByZW1v\ndmVQcm9wZXJ0eShrZXkpOwogICAgICAgIHJldHVybiAodmFsID09IG51bGwp\nID8gcmVtb3ZlUHJvcGVydHkoa2V5MiwgZGVmKSA6IHZhbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEltbXV0YWJsZSBlbXB0eSBvcHRpb25zLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBFbXB0eU9wdGlvbnMgZXh0ZW5k\ncyBPcHRpb25zIHsKCiAgICAgICAgcHVibGljIE9iamVjdCBzZXRQcm9wZXJ0\neShTdHJpbmcga2V5LCBTdHJpbmcgdmFsdWUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHB1dChPYmplY3Qga2V5LCBP\nYmplY3QgdmFsdWUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

