{"sha":"22eca0859feb63d9fd27e6e063277a66732ad137","node_id":"MDQ6QmxvYjIwNjM2NDoyMmVjYTA4NTlmZWI2M2Q5ZmQyN2U2ZTA2MzI3N2E2NjczMmFkMTM3","size":6119,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/22eca0859feb63d9fd27e6e063277a66732ad137","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbDsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5pby5PYmplY3RJbnB1dFN0cmVhbTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5sYW5nLnJl\nZi5SZWZlcmVuY2U7CgovKioKICogTWFwIGluIHdoaWNoIHRoZSBrZXksIHZh\nbHVlLCBvciBib3RoIG1heSBiZSB3ZWFrL3NvZnQgcmVmZXJlbmNlcy4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKiBAc2luY2Ug\nMC40LjAKICovCnB1YmxpYyBjbGFzcyBSZWZlcmVuY2VIYXNoTWFwCiAgICBl\neHRlbmRzIG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuUmVm\nZXJlbmNlTWFwCiAgICBpbXBsZW1lbnRzIFJlZmVyZW5jZU1hcCwgU2l6ZWRN\nYXAgewoKICAgIHByaXZhdGUgaW50IF9tYXhTaXplID0gSW50ZWdlci5NQVhf\nVkFMVUU7CgogICAgcHVibGljIFJlZmVyZW5jZUhhc2hNYXAoaW50IGtleVR5\ncGUsIGludCB2YWx1ZVR5cGUpIHsKICAgICAgICBzdXBlcih0b1JlZmVyZW5j\nZUNvbnN0YW50KGtleVR5cGUpLCB0b1JlZmVyZW5jZUNvbnN0YW50KHZhbHVl\nVHlwZSkpOwogICAgfQoKICAgIHB1YmxpYyBSZWZlcmVuY2VIYXNoTWFwKGlu\ndCBrZXlUeXBlLCBpbnQgdmFsdWVUeXBlLCBpbnQgY2FwYWNpdHksCiAgICAg\nICAgZmxvYXQgbG9hZEZhY3RvcikgewogICAgICAgIHN1cGVyKHRvUmVmZXJl\nbmNlQ29uc3RhbnQoa2V5VHlwZSksIHRvUmVmZXJlbmNlQ29uc3RhbnQodmFs\ndWVUeXBlKSwKICAgICAgICAgICAgY2FwYWNpdHksIGxvYWRGYWN0b3IpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29uY3ZlciBvdXIgcmVmZXJlbmNlIGNv\nbnN0YW50cyB0byBBcGFjaGUncy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgaW50IHRvUmVmZXJlbmNlQ29uc3RhbnQoaW50IHR5cGUpIHsKICAgICAg\nICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBSZWZlcmVuY2VN\nYXAuSEFSRDoKICAgICAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmNv\nbW1vbnMuY29sbGVjdGlvbnMubWFwLlJlZmVyZW5jZU1hcC4gSEFSRDsKICAg\nICAgICAgICAgY2FzZSBSZWZlcmVuY2VNYXAuU09GVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFw\nLlJlZmVyZW5jZU1hcC4gU09GVDsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVj\ndGlvbnMubWFwLlJlZmVyZW5jZU1hcC4gV0VBSzsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGludCBnZXRNYXhTaXplKCkgewogICAgICAgIHJldHVy\nbiBfbWF4U2l6ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRNYXhTaXpl\nKGludCBtYXhTaXplKSB7CiAgICAgICAgX21heFNpemUgPSAobWF4U2l6ZSA8\nIDApID8gSW50ZWdlci5NQVhfVkFMVUUgOiBtYXhTaXplOwogICAgICAgIGlm\nIChfbWF4U2l6ZSAhPSBJbnRlZ2VyLk1BWF9WQUxVRSkKICAgICAgICAgICAg\ncmVtb3ZlT3ZlcmZsb3coX21heFNpemUpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRnVsbCgpIHsKICAgICAgICByZXR1cm4gc2l6ZSgpID49IF9t\nYXhTaXplOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG92ZXJmbG93UmVtb3Zl\nZChPYmplY3Qga2V5LCBPYmplY3QgdmFsdWUpIHsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB2YWx1ZUV4cGlyZWQoT2JqZWN0IGtleSkgewogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGtleUV4cGlyZWQoT2JqZWN0IHZhbHVlKSB7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcmVtb3ZlRXhwaXJlZCgpIHsKICAgICAgICBw\ndXJnZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGFueSBlbnRy\naWVzIG92ZXIgbWF4IHNpemUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBy\nZW1vdmVPdmVyZmxvdyhpbnQgbWF4U2l6ZSkgewogICAgICAgIE9iamVjdCBr\nZXk7CiAgICAgICAgd2hpbGUgKHNpemUoKSA+IG1heFNpemUpIHsKICAgICAg\nICAgICAga2V5ID0ga2V5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCk7CiAgICAg\nICAgICAgIG92ZXJmbG93UmVtb3ZlZChrZXksIHJlbW92ZShrZXkpKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkTWFwcGluZyhp\nbnQgaGFzaEluZGV4LCBpbnQgaGFzaENvZGUsIE9iamVjdCBrZXksCiAgICAg\nICAgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgaWYgKF9tYXhTaXplICE9IElu\ndGVnZXIuTUFYX1ZBTFVFKQogICAgICAgICAgICByZW1vdmVPdmVyZmxvdyhf\nbWF4U2l6ZSAtIDEpOwogICAgICAgIHN1cGVyLmFkZE1hcHBpbmcoaGFzaElu\nZGV4LCBoYXNoQ29kZSwga2V5LCB2YWx1ZSk7CiAgICB9CgogICAgcHJvdGVj\ndGVkIEhhc2hFbnRyeSBjcmVhdGVFbnRyeShIYXNoRW50cnkgbmV4dCwgaW50\nIGhhc2hDb2RlLCBPYmplY3Qga2V5LAogICAgICAgIE9iamVjdCB2YWx1ZSkg\newogICAgICAgIHJldHVybiBuZXcgQWNjZXNzaWJsZUVudHJ5KHRoaXMsIG5l\neHQsIGhhc2hDb2RlLCBrZXksIHZhbHVlKTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgdm9pZCBwdXJnZShSZWZlcmVuY2UgcmVmKSB7CiAgICAgICAgLy8gdGhl\nIGxvZ2ljIGZvciB0aGlzIG1ldGhvZCBpcyB0YWtlbiBmcm9tIHRoZSBvcmln\naW5hbCBwdXJnZSBtZXRob2QKICAgICAgICAvLyB3ZSdyZSBvdmVycmlkaW5n\nLCB3aXRoIGFkZGVkIGxvZ2ljIHRvIHRyYWNrIHRoZSBleHBpcmVkIGtleS92\nYWx1ZQogICAgICAgIGludCBpbmRleCA9IGhhc2hJbmRleChyZWYuaGFzaENv\nZGUoKSwgZGF0YS5sZW5ndGgpOwogICAgICAgIEFjY2Vzc2libGVFbnRyeSBl\nbnRyeSA9IChBY2Nlc3NpYmxlRW50cnkpIGRhdGFbaW5kZXhdOwogICAgICAg\nIEFjY2Vzc2libGVFbnRyeSBwcmV2ID0gbnVsbDsKICAgICAgICBPYmplY3Qg\na2V5ID0gbnVsbCwgdmFsdWUgPSBudWxsOwogICAgICAgIHdoaWxlIChlbnRy\neSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChwdXJnZShlbnRyeSwgcmVm\nKSkgewogICAgICAgICAgICAgICAgaWYgKGlzSGFyZChrZXlUeXBlKSkKICAg\nICAgICAgICAgICAgICAgICBrZXkgPSBlbnRyeS5rZXkoKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKGlzSGFyZCh2YWx1ZVR5cGUpKQogICAgICAgICAg\nICAgICAgICAgIHZhbHVlID0gZW50cnkudmFsdWUoKTsKCiAgICAgICAgICAg\nICAgICBpZiAocHJldiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGRh\ndGFbaW5kZXhdID0gZW50cnkubmV4dEVudHJ5KCk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJldi5zZXROZXh0RW50cnko\nZW50cnkubmV4dEVudHJ5KCkpOwogICAgICAgICAgICAgICAgc2l6ZS0tOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHJldiA9IGVudHJ5OwogICAgICAgICAgICBlbnRyeSA9IGVudHJ5Lm5l\neHRFbnRyeSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGtleSAhPSBudWxs\nKQogICAgICAgICAgICB2YWx1ZUV4cGlyZWQoa2V5KTsKICAgICAgICBlbHNl\nIGlmICh2YWx1ZSAhPSBudWxsKQogICAgICAgICAgICBrZXlFeHBpcmVkKHZh\nbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlZSB0aGUgY29kZSBmb3Ig\nPGNvZGU+UmVmZXJlbmNlTWFwLlJlZmVyZW5jZUVudHJ5LnB1cmdlPC9jb2Rl\nPi4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHB1cmdlKEFjY2Vzc2li\nbGVFbnRyeSBlbnRyeSwgUmVmZXJlbmNlIHJlZikgewogICAgICAgIGJvb2xl\nYW4gbWF0Y2ggPSAoIWlzSGFyZChrZXlUeXBlKSAmJiBlbnRyeS5rZXkoKSA9\nPSByZWYpCiAgICAgICAgICAgIHx8ICghaXNIYXJkKHZhbHVlVHlwZSkgJiYg\nZW50cnkudmFsdWUoKSA9PSByZWYpOwogICAgICAgIGlmIChtYXRjaCkgewog\nICAgICAgICAgICBpZiAoIWlzSGFyZChrZXlUeXBlKSkKICAgICAgICAgICAg\nICAgICgoUmVmZXJlbmNlKSBlbnRyeS5rZXkoKSkuY2xlYXIoKTsKICAgICAg\nICAgICAgaWYgKCFpc0hhcmQodmFsdWVUeXBlKSkKICAgICAgICAgICAgICAg\nICgoUmVmZXJlbmNlKSBlbnRyeS52YWx1ZSgpKS5jbGVhcigpOwogICAgICAg\nICAgICBlbHNlIGlmIChwdXJnZVZhbHVlcykKICAgICAgICAgICAgICAgIGVu\ndHJ5Lm51bGxWYWx1ZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWF0\nY2g7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0hhcmQo\naW50IHR5cGUpIHsKICAgICAgICByZXR1cm4gdHlwZSA9PSBvcmcuYXBhY2hl\nLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLiBSZWZlcmVuY2VNYXAuSEFSRDsK\nICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBkb1dyaXRlT2JqZWN0KE9iamVj\ndE91dHB1dFN0cmVhbSBvdXQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgb3V0LndyaXRlSW50KF9tYXhTaXplKTsKICAgICAgICBzdXBlci5kb1dy\naXRlT2JqZWN0KG91dCk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgZG9S\nZWFkT2JqZWN0KE9iamVjdElucHV0U3RyZWFtIGluKQogICAgICAgIHRocm93\ncyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgX21heFNpemUgPSBpbi5yZWFkSW50KCk7CiAgICAgICAgc3VwZXIuZG9S\nZWFkT2JqZWN0KGluKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dGVuc2lv\nbiBvZiB0aGUgYmFzZSBlbnRyeSB0eXBlIHRoYXQgYWxsb3dzIG91ciBvdXRl\nciBjbGFzcyB0byBhY2Nlc3MKICAgICAqIHByb3RlY3RlZCBzdGF0ZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQWNjZXNzaWJsZUVudHJ5\nIGV4dGVuZHMgUmVmZXJlbmNlRW50cnkgewoKICAgICAgICBwdWJsaWMgQWNj\nZXNzaWJsZUVudHJ5KG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5t\nYXAuCiAgICAgICAgICAgIEFic3RyYWN0UmVmZXJlbmNlTWFwIG1hcCwgSGFz\naEVudHJ5IG5leHQsCiAgICAgICAgICAgIGludCBoYXNoQ29kZSwgT2JqZWN0\nIGtleSwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgICAgIHN1cGVyKG1hcCwg\nbmV4dCwgaGFzaENvZGUsIGtleSwgdmFsdWUpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIE9iamVjdCBrZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBr\nZXk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHZhbHVlKCkg\newogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBudWxsVmFsdWUoKSB7CiAgICAgICAgICAgIHZhbHVl\nID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBBY2Nlc3NpYmxl\nRW50cnkgbmV4dEVudHJ5KCkgewogICAgICAgICAgICByZXR1cm4gKEFjY2Vz\nc2libGVFbnRyeSkgbmV4dDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHNldE5leHRFbnRyeShBY2Nlc3NpYmxlRW50cnkgbmV4dCkgewogICAg\nICAgICAgICB0aGlzLm5leHQgPSBuZXh0OwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

