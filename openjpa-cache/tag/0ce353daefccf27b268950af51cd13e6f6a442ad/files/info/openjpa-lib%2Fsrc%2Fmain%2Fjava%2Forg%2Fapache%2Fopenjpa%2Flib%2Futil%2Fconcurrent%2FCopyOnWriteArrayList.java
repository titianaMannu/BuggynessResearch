{"sha":"178a07cf2d01f4dc557bd243b79d6d99c221b756","node_id":"MDQ6QmxvYjIwNjM2NDoxNzhhMDdjZjJkMDFmNGRjNTU3YmQyNDNiNzlkNmQ5OWMyMjFiNzU2","size":32133,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/178a07cf2d01f4dc557bd243b79d6d99c221b756","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwovKgogKiBXcml0dGVuIGJ5IERh\nd2lkIEt1cnp5bmllYywgb24gdGhlIGJhc2lzIG9mIHB1YmxpYyBzcGVjaWZp\nY2F0aW9ucyBhbmQKICogcHVibGljIGRvbWFpbiBzb3VyY2VzIGZyb20gSlNS\nIDE2NiwgYW5kIHJlbGVhc2VkIHRvIHRoZSBwdWJsaWMgZG9tYWluLAogKiBh\ncyBleHBsYWluZWQgYXQgaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGlj\nZW5zZXMvcHVibGljZG9tYWluLgogKi8KcGFja2FnZSBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuY29uY3VycmVudDsKCmltcG9ydCBqYXZhLmlvLklP\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5PYmplY3RJbnB1dFN0cmVhbTsK\naW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2\nYS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5B\ncnJheTsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNlcHRpb247CmltcG9y\ndCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsK\naW1wb3J0IGphdmEudXRpbC5MaXN0SXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTm9TdWNoRWxlbWVudEV4Y2VwdGlvbjsKCnB1YmxpYyBjbGFzcyBDb3B5\nT25Xcml0ZUFycmF5TGlzdCBpbXBsZW1lbnRzIExpc3QsIENsb25lYWJsZSwg\nU2VyaWFsaXphYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25n\nIHNlcmlhbFZlcnNpb25VSUQgPSA4NjczMjY0MTk1NzQ3OTQyNTk1TDsKCiAg\nICBwcml2YXRlIHZvbGF0aWxlIHRyYW5zaWVudCBPYmplY3RbXSBhcnJheTsK\nCiAgICBwdWJsaWMgQ29weU9uV3JpdGVBcnJheUxpc3QoKSB7CiAgICAgICAg\nc2V0QXJyYXkobmV3IE9iamVjdFswXSk7CiAgICB9CgogICAgcHVibGljIENv\ncHlPbldyaXRlQXJyYXlMaXN0KENvbGxlY3Rpb24gYykgewogICAgICAgIC8v\nIG11c3QgZGVhbCB3aXRoIGNvbmN1cnJlbnQgY29sbGVjdGlvbnMKICAgICAg\nICBPYmplY3RbXSBhcnJheSA9IGMudG9BcnJheSgpOwogICAgICAgIC8vIG1h\na2Ugc3VyZSB0aGUgYXJyYXkgaXMgT2JqZWN0W10gdHlwZQogICAgICAgIGlm\nIChhcnJheS5nZXRDbGFzcygpICE9IE9iamVjdFtdLmNsYXNzKSB7CiAgICAg\nICAgICAgIGFycmF5ID0gQXJyYXlzLmNvcHlPZihhcnJheSwgYXJyYXkubGVu\nZ3RoLCBPYmplY3RbXS5jbGFzcyk7CiAgICAgICAgfQogICAgICAgIC8vIGFz\nc3VtZSB0aGF0IGMudG9BcnJheSgpIGhhcyByZXR1cm5lZCBhIG5ldyBhcnJh\neSBpbnN0YW5jZSwgYXMKICAgICAgICAvLyByZXF1aXJlZCBieSB0aGUgc3Bl\nYwogICAgICAgIHNldEFycmF5KGFycmF5KTsKICAgIH0KCiAgICBwdWJsaWMg\nQ29weU9uV3JpdGVBcnJheUxpc3QoT2JqZWN0W10gYXJyYXkpIHsKICAgICAg\nICBzZXRBcnJheShBcnJheXMuY29weU9mKGFycmF5LCBhcnJheS5sZW5ndGgs\nIE9iamVjdFtdLmNsYXNzKSk7CiAgICB9CgogICAgZmluYWwgT2JqZWN0W10g\nZ2V0QXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIGFycmF5OwogICAgfQoKICAg\nIGZpbmFsIHZvaWQgc2V0QXJyYXkoT2JqZWN0W10gYXJyYXkpIHsKICAgICAg\nICB0aGlzLmFycmF5ID0gYXJyYXk7CiAgICB9CgogICAgcHVibGljIGludCBz\naXplKCkgewogICAgICAgIHJldHVybiBnZXRBcnJheSgpLmxlbmd0aDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgIHJl\ndHVybiBnZXRBcnJheSgpLmxlbmd0aCA9PSAwOwogICAgfQoKICAgIHByaXZh\ndGUgc3RhdGljIGludCBzZWFyY2goT2JqZWN0W10gYXJyYXksIE9iamVjdCBz\ndWJqZWN0LCBpbnQgcG9zLAogICAgICAgIGludCBlbmQpIHsKICAgICAgICBp\nZiAoc3ViamVjdCA9PSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoOyBwb3Mg\nPCBlbmQ7IHBvcysrKSB7CiAgICAgICAgICAgICAgICBpZiAoYXJyYXlbcG9z\nXSA9PSBudWxsKSByZXR1cm4gcG9zOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgZm9yICg7IHBvcyA8IGVuZDsgcG9zKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChzdWJqZWN0LmVxdWFscyhhcnJheVtw\nb3NdKSkgcmV0dXJuIHBvczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgaW50\nIHJldmVyc2VTZWFyY2goT2JqZWN0W10gYXJyYXksIE9iamVjdCBzdWJqZWN0\nLCBpbnQgc3RhcnQsCiAgICAgICAgaW50IHBvcykgewogICAgICAgIGlmIChz\ndWJqZWN0ID09IG51bGwpIHsKICAgICAgICAgICAgZm9yIChwb3MtLTsgcG9z\nID49IHN0YXJ0OyBwb3MtLSkgewogICAgICAgICAgICAgICAgaWYgKGFycmF5\nW3Bvc10gPT0gbnVsbCkgcmV0dXJuIHBvczsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAocG9zLS07IHBvcyA+PSBz\ndGFydDsgcG9zLS0pIHsKICAgICAgICAgICAgICAgIGlmIChzdWJqZWN0LmVx\ndWFscyhhcnJheVtwb3NdKSkgcmV0dXJuIHBvczsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0IG8pIHsKICAgICAgICBPYmplY3Rb\nXSBhcnJheSA9IGdldEFycmF5KCk7CiAgICAgICAgcmV0dXJuIHNlYXJjaChh\ncnJheSwgbywgMCwgYXJyYXkubGVuZ3RoKSA+PSAwOwogICAgfQoKICAgIHB1\nYmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICByZXR1cm4gbmV3\nIENPV0l0ZXJhdG9yKGdldEFycmF5KCksIDApOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3RbXSB0b0FycmF5KCkgewogICAgICAgIE9iamVjdFtdIGFycmF5\nID0gZ2V0QXJyYXkoKTsKICAgICAgICByZXR1cm4gQXJyYXlzLmNvcHlPZihh\ncnJheSwgYXJyYXkubGVuZ3RoLCBPYmplY3RbXS5jbGFzcyk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdFtdIHRvQXJyYXkoT2JqZWN0W10gYSkgewogICAg\nICAgIE9iamVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICBpbnQg\nbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgICAgIGlmIChhLmxlbmd0aCA8\nIGxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmNvcHlPZihh\ncnJheSwgbGVuZ3RoLCBhLmdldENsYXNzKCkpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoYXJyYXksIDAsIGEsIDAs\nIGxlbmd0aCk7CiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA+IGxlbmd0aCkg\nYVtsZW5ndGhdID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGFkZChPYmplY3Qgbykg\newogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBP\nYmplY3RbXSBvbGRhcnIgPSBnZXRBcnJheSgpOwogICAgICAgICAgICBpbnQg\nbGVuZ3RoID0gb2xkYXJyLmxlbmd0aDsKICAgICAgICAgICAgT2JqZWN0W10g\nbmV3YXJyID0gbmV3IE9iamVjdFtsZW5ndGggKyAxXTsKICAgICAgICAgICAg\nU3lzdGVtLmFycmF5Y29weShvbGRhcnIsIDAsIG5ld2FyciwgMCwgbGVuZ3Ro\nKTsKICAgICAgICAgICAgbmV3YXJyW2xlbmd0aF0gPSBvOwogICAgICAgICAg\nICBzZXRBcnJheShuZXdhcnIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYWRkSWZBYnNl\nbnQoT2JqZWN0IG8pIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgT2JqZWN0W10gb2xkYXJyID0gZ2V0QXJyYXkoKTsKICAg\nICAgICAgICAgaW50IGxlbmd0aCA9IG9sZGFyci5sZW5ndGg7CiAgICAgICAg\nICAgIGlmIChzZWFyY2goYXJyYXksIG8sIDAsIGxlbmd0aCkgPj0gMCkgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICBPYmplY3RbXSBuZXdhcnIgPSBuZXcg\nT2JqZWN0W2xlbmd0aCArIDFdOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXlj\nb3B5KG9sZGFyciwgMCwgbmV3YXJyLCAwLCBsZW5ndGgpOwogICAgICAgICAg\nICBuZXdhcnJbbGVuZ3RoXSA9IG87CiAgICAgICAgICAgIHNldEFycmF5KG5l\nd2Fycik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgaW50IGFkZEFsbEFic2VudChDb2xsZWN0aW9uIGMp\nIHsKICAgICAgICBPYmplY3RbXSBhcnIgPSBjLnRvQXJyYXkoKTsKICAgICAg\nICBpZiAoYXJyLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKICAgICAgICBzeW5j\naHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgT2JqZWN0W10gb2xkYXJy\nID0gZ2V0QXJyYXkoKTsKICAgICAgICAgICAgaW50IG9sZGxlbmd0aCA9IG9s\nZGFyci5sZW5ndGg7CiAgICAgICAgICAgIE9iamVjdFtdIHRtcCA9IG5ldyBP\nYmplY3RbYXJyLmxlbmd0aF07CiAgICAgICAgICAgIGludCBhZGRlZCA9IDA7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgbyA9IGFycltpXTsKICAg\nICAgICAgICAgICAgIGlmIChzZWFyY2gob2xkYXJyLCBvLCAwLCBvbGRsZW5n\ndGgpIDwgMAogICAgICAgICAgICAgICAgICAgICYmIHNlYXJjaCh0bXAsIG8s\nIDAsIGFkZGVkKSA8IDApIHsKICAgICAgICAgICAgICAgICAgICB0bXBbYWRk\nZWQrK10gPSBvOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChhZGRlZCA9PSAwKSByZXR1cm4gMDsKICAgICAgICAg\nICAgT2JqZWN0W10gbmV3YXJyID0gbmV3IE9iamVjdFtvbGRsZW5ndGggKyBh\nZGRlZF07CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkob2xkYXJyLCAw\nLCBuZXdhcnIsIDAsIG9sZGxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5h\ncnJheWNvcHkodG1wLCAwLCBuZXdhcnIsIG9sZGxlbmd0aCwgYWRkZWQpOwog\nICAgICAgICAgICBzZXRBcnJheShuZXdhcnIpOwogICAgICAgICAgICByZXR1\ncm4gYWRkZWQ7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHJlbW92ZShPYmplY3QgbykgewogICAgICAgIHN5bmNocm9uaXplZCAodGhp\ncykgewogICAgICAgICAgICBPYmplY3RbXSBhcnJheSA9IGdldEFycmF5KCk7\nCiAgICAgICAgICAgIGludCBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAg\nICAgICAgIGludCBwb3MgPSBzZWFyY2goYXJyYXksIG8sIDAsIGxlbmd0aCk7\nCiAgICAgICAgICAgIGlmIChwb3MgPCAwKSByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBPYmplY3RbbGVuZ3RoIC0g\nMV07CiAgICAgICAgICAgIGludCBtb3ZlZCA9IGxlbmd0aCAtIHBvcyAtIDE7\nCiAgICAgICAgICAgIGlmIChwb3MgPiAwKSBTeXN0ZW0uYXJyYXljb3B5KGFy\ncmF5LCAwLCBuZXdhcnIsIDAsIHBvcyk7CiAgICAgICAgICAgIGlmIChtb3Zl\nZCA+IDApIFN5c3RlbS5hcnJheWNvcHkoYXJyYXksIHBvcyArIDEsIG5ld2Fy\nciwgcG9zLCBtb3ZlZCk7CiAgICAgICAgICAgIHNldEFycmF5KG5ld2Fycik7\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBjb250YWluc0FsbChDb2xsZWN0aW9uIGMpIHsK\nICAgICAgICBPYmplY3RbXSBhcnJheSA9IGdldEFycmF5KCk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgIGlmIChzZWFyY2goYXJyYXksIGl0ci5uZXh0\nKCksIDAsIGFycmF5Lmxlbmd0aCkgPCAwKSByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGFkZEFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAvLyBtdXN0\nIGRlYWwgd2l0aCBjb25jdXJyZW50IGNvbGxlY3Rpb25zCiAgICAgICAgT2Jq\nZWN0W10gY2EgPSBjLnRvQXJyYXkoKTsKICAgICAgICBpZiAoY2EubGVuZ3Ro\nID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgT2JqZWN0W10gb2xkYXJyID0gZ2V0QXJyYXko\nKTsKICAgICAgICAgICAgaW50IGxlbmd0aCA9IG9sZGFyci5sZW5ndGg7CiAg\nICAgICAgICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBPYmplY3RbbGVuZ3Ro\nICsgY2EubGVuZ3RoXTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShv\nbGRhcnIsIDAsIG5ld2FyciwgMCwgbGVuZ3RoKTsKICAgICAgICAgICAgaW50\nIHBvcyA9IGxlbmd0aDsKICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShj\nYSwgMCwgbmV3YXJyLCBwb3MsIGNhLmxlbmd0aCk7CiAgICAgICAgICAgIHNl\ndEFycmF5KG5ld2Fycik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwoaW50IGlu\nZGV4LCBDb2xsZWN0aW9uIGMpIHsKICAgICAgICAvLyBtdXN0IGRlYWwgd2l0\naCBjb25jdXJyZW50IGNvbGxlY3Rpb25zCiAgICAgICAgT2JqZWN0W10gY2Eg\nPSBjLnRvQXJyYXkoKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgT2JqZWN0W10gb2xkYXJyID0gZ2V0QXJyYXkoKTsKICAg\nICAgICAgICAgaW50IGxlbmd0aCA9IG9sZGFyci5sZW5ndGg7CiAgICAgICAg\nICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPiBsZW5ndGgpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9u\nKCJJbmRleDogIiArIGluZGV4ICsKICAgICAgICAgICAgICAgICAgICAiLCBT\naXplOiAiICsgbGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoY2EubGVuZ3RoID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nT2JqZWN0W10gbmV3YXJyID0gbmV3IE9iamVjdFtsZW5ndGggKyBjYS5sZW5n\ndGhdOwogICAgICAgICAgICBpbnQgbW92ZWQgPSBsZW5ndGggLSBpbmRleDsK\nICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShvbGRhcnIsIDAsIG5ld2Fy\nciwgMCwgaW5kZXgpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNh\nLCAwLCBuZXdhcnIsIGluZGV4LCBjYS5sZW5ndGgpOwogICAgICAgICAgICBp\nZiAobW92ZWQgPiAwKSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0KICAgICAg\nICAgICAgICAgICAgICAuYXJyYXljb3B5KG9sZGFyciwgaW5kZXgsIG5ld2Fy\nciwgaW5kZXggKyBjYS5sZW5ndGgsIG1vdmVkKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzZXRBcnJheShuZXdhcnIpOwogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\ncmVtb3ZlQWxsKENvbGxlY3Rpb24gYykgewogICAgICAgIGlmIChjLmlzRW1w\ndHkoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHN5bmNocm9uaXplZCAodGhp\ncykgewogICAgICAgICAgICBPYmplY3RbXSBhcnJheSA9IGdldEFycmF5KCk7\nCiAgICAgICAgICAgIGludCBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAg\nICAgICAgIE9iamVjdFtdIHRtcCA9IG5ldyBPYmplY3RbbGVuZ3RoXTsKICAg\nICAgICAgICAgaW50IG5ld2xlbiA9IDA7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIE9i\namVjdCBvID0gYXJyYXlbaV07CiAgICAgICAgICAgICAgICBpZiAoIWMuY29u\ndGFpbnMobykpIHRtcFtuZXdsZW4rK10gPSBvOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChuZXdsZW4gPT0gbGVuZ3RoKSByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBPYmplY3RbbmV3\nbGVuXTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weSh0bXAsIDAsIG5l\nd2FyciwgMCwgbmV3bGVuKTsKICAgICAgICAgICAgc2V0QXJyYXkobmV3YXJy\nKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgT2Jq\nZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgICAgICBpbnQgbGVu\nZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgICAgICAgICBPYmplY3RbXSB0bXAg\nPSBuZXcgT2JqZWN0W2xlbmd0aF07CiAgICAgICAgICAgIGludCBuZXdsZW4g\nPSAwOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBPYmplY3QgbyA9IGFycmF5W2ldOwog\nICAgICAgICAgICAgICAgaWYgKGMuY29udGFpbnMobykpIHRtcFtuZXdsZW4r\nK10gPSBvOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdsZW4g\nPT0gbGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIE9iamVjdFtd\nIG5ld2FyciA9IG5ldyBPYmplY3RbbmV3bGVuXTsKICAgICAgICAgICAgU3lz\ndGVtLmFycmF5Y29weSh0bXAsIDAsIG5ld2FyciwgMCwgbmV3bGVuKTsKICAg\nICAgICAgICAgc2V0QXJyYXkobmV3YXJyKTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgIHNldEFycmF5KG5ldyBPYmplY3RbMF0pOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7CiAgICAgICAgfSBjYXRj\naCAoQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFcnJvcigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAg\nICBpZiAobyA9PSB0aGlzKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIShv\nIGluc3RhbmNlb2YgTGlzdCkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgTGlz\ndEl0ZXJhdG9yIGl0ciA9ICgoTGlzdCkgbykubGlzdEl0ZXJhdG9yKCk7CiAg\nICAgICAgT2JqZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgIGlu\ndCBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAgaW50IGlkeCA9IDA7\nCiAgICAgICAgd2hpbGUgKGlkeCA8IGxlbmd0aCAmJiBpdHIuaGFzTmV4dCgp\nKSB7CiAgICAgICAgICAgIE9iamVjdCBvMSA9IGFycmF5W2lkeCsrXTsKICAg\nICAgICAgICAgT2JqZWN0IG8yID0gaXRyLm5leHQoKTsKICAgICAgICAgICAg\naWYgKCFlcShvMSwgbzIpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAoaWR4ID09IGxlbmd0aCAmJiAhaXRyLmhhc05leHQoKSk7\nCiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICBp\nbnQgaGFzaENvZGUgPSAxOwogICAgICAgIE9iamVjdFtdIGFycmF5ID0gZ2V0\nQXJyYXkoKTsKICAgICAgICBpbnQgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgT2JqZWN0IG8gPSBhcnJheVtpXTsKICAgICAgICAgICAgaGFz\naENvZGUgPSAzMSAqIGhhc2hDb2RlICsgKG8gPT0gbnVsbCA/IDAgOiBvLmhh\nc2hDb2RlKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaGFzaENvZGU7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXQoaW50IGluZGV4KSB7CiAg\nICAgICAgcmV0dXJuIGdldEFycmF5KClbaW5kZXhdOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3Qgc2V0KGludCBpbmRleCwgT2JqZWN0IGVsZW1lbnQpIHsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgT2Jq\nZWN0W10gb2xkYXJyID0gZ2V0QXJyYXkoKTsKICAgICAgICAgICAgaW50IGxl\nbmd0aCA9IG9sZGFyci5sZW5ndGg7CiAgICAgICAgICAgIC8vIHBpZ2d5YmFj\nayB0aGUgYXJyYXkgYm91bmRzIGNoZWNrCiAgICAgICAgICAgIE9iamVjdCBv\nbGRWYWwgPSBvbGRhcnJbaW5kZXhdOwogICAgICAgICAgICBpZiAob2xkVmFs\nID09IGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHNldEFycmF5KG9sZGFy\ncik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBPYmpl\nY3RbXSBuZXdhcnIgPSBuZXcgT2JqZWN0W2xlbmd0aF07CiAgICAgICAgICAg\nICAgICBTeXN0ZW0uYXJyYXljb3B5KG9sZGFyciwgMCwgbmV3YXJyLCAwLCBs\nZW5ndGgpOwogICAgICAgICAgICAgICAgbmV3YXJyW2luZGV4XSA9IGVsZW1l\nbnQ7CiAgICAgICAgICAgICAgICBzZXRBcnJheShuZXdhcnIpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBvbGRWYWw7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZChpbnQgaW5kZXgsIE9iamVjdCBl\nbGVtZW50KSB7CiAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAg\nICAgICAgIE9iamVjdFtdIG9sZGFyciA9IGdldEFycmF5KCk7CiAgICAgICAg\nICAgIGludCBsZW5ndGggPSBvbGRhcnIubGVuZ3RoOwogICAgICAgICAgICBp\nZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gbGVuZ3RoKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbigiSW5k\nZXg6ICIgKyBpbmRleCArCiAgICAgICAgICAgICAgICAgICAgIiwgU2l6ZTog\nIiArIGxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgT2JqZWN0\nW10gbmV3YXJyID0gbmV3IE9iamVjdFtsZW5ndGggKyAxXTsKICAgICAgICAg\nICAgaW50IG1vdmVkID0gbGVuZ3RoIC0gaW5kZXg7CiAgICAgICAgICAgIFN5\nc3RlbS5hcnJheWNvcHkob2xkYXJyLCAwLCBuZXdhcnIsIDAsIGluZGV4KTsK\nICAgICAgICAgICAgbmV3YXJyW2luZGV4XSA9IGVsZW1lbnQ7CiAgICAgICAg\nICAgIGlmIChtb3ZlZCA+IDApIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5h\ncnJheWNvcHkob2xkYXJyLCBpbmRleCwgbmV3YXJyLCBpbmRleCArIDEsIG1v\ndmVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRBcnJheShuZXdh\ncnIpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHJlbW92\nZShpbnQgaW5kZXgpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgT2JqZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAg\nICAgICAgICBpbnQgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgICAgICAg\nICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGxlbmd0aCkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24o\nIkluZGV4OiAiICsgaW5kZXggKwogICAgICAgICAgICAgICAgICAgICIsIFNp\nemU6ICIgKyBsZW5ndGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIE9i\namVjdCByZXN1bHQgPSBhcnJheVtpbmRleF07CiAgICAgICAgICAgIE9iamVj\ndFtdIG5ld2FyciA9IG5ldyBPYmplY3RbbGVuZ3RoIC0gMV07CiAgICAgICAg\nICAgIGludCBtb3ZlZCA9IGxlbmd0aCAtIGluZGV4IC0gMTsKICAgICAgICAg\nICAgaWYgKGluZGV4ID4gMCkgU3lzdGVtLmFycmF5Y29weShhcnJheSwgMCwg\nbmV3YXJyLCAwLCBpbmRleCk7CiAgICAgICAgICAgIGlmIChtb3ZlZCA+IDAp\nCiAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGFycmF5LCBpbmRl\neCArIDEsIG5ld2FyciwgaW5kZXgsIG1vdmVkKTsKICAgICAgICAgICAgc2V0\nQXJyYXkobmV3YXJyKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBpbmRleE9mKE9iamVjdCBv\nKSB7CiAgICAgICAgT2JqZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAg\nICAgIHJldHVybiBzZWFyY2goYXJyYXksIG8sIDAsIGFycmF5Lmxlbmd0aCk7\nCiAgICB9CgogICAgcHVibGljIGludCBpbmRleE9mKE9iamVjdCBvLCBpbnQg\naW5kZXgpIHsKICAgICAgICBPYmplY3RbXSBhcnJheSA9IGdldEFycmF5KCk7\nCiAgICAgICAgcmV0dXJuIHNlYXJjaChhcnJheSwgbywgaW5kZXgsIGFycmF5\nLmxlbmd0aCk7CiAgICB9CgogICAgcHVibGljIGludCBsYXN0SW5kZXhPZihP\nYmplY3QgbykgewogICAgICAgIE9iamVjdFtdIGFycmF5ID0gZ2V0QXJyYXko\nKTsKICAgICAgICByZXR1cm4gcmV2ZXJzZVNlYXJjaChhcnJheSwgbywgMCwg\nYXJyYXkubGVuZ3RoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGxhc3RJbmRl\neE9mKE9iamVjdCBvLCBpbnQgaW5kZXgpIHsKICAgICAgICBPYmplY3RbXSBh\ncnJheSA9IGdldEFycmF5KCk7CiAgICAgICAgcmV0dXJuIHJldmVyc2VTZWFy\nY2goYXJyYXksIG8sIDAsIGluZGV4KTsKICAgIH0KCiAgICBwdWJsaWMgTGlz\ndEl0ZXJhdG9yIGxpc3RJdGVyYXRvcigpIHsKICAgICAgICByZXR1cm4gbmV3\nIENPV0l0ZXJhdG9yKGdldEFycmF5KCksIDApOwogICAgfQoKICAgIHB1Ymxp\nYyBMaXN0SXRlcmF0b3IgbGlzdEl0ZXJhdG9yKGludCBpbmRleCkgewogICAg\nICAgIE9iamVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICBpZiAo\naW5kZXggPCAwIHx8IGluZGV4ID4gYXJyYXkubGVuZ3RoKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKCJJbmRl\neDogIiArIGluZGV4ICsKICAgICAgICAgICAgICAgICIsIFNpemU6ICIgKyBh\ncnJheS5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IENP\nV0l0ZXJhdG9yKGFycmF5LCBpbmRleCk7CiAgICB9CgogICAgcHVibGljIExp\nc3Qgc3ViTGlzdChpbnQgZnJvbUluZGV4LCBpbnQgdG9JbmRleCkgewogICAg\nICAgIE9iamVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICBpZiAo\nZnJvbUluZGV4IDwgMCB8fCB0b0luZGV4ID4gYXJyYXkubGVuZ3RoIHx8IGZy\nb21JbmRleCA+IHRvSW5kZXgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElu\nZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG5ldyBDT1dTdWJMaXN0KGZyb21JbmRleCwgdG9JbmRleCAtIGZy\nb21JbmRleCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0\nKE9iamVjdE91dHB1dFN0cmVhbSBvdXQpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgb3V0LmRlZmF1bHRXcml0ZU9iamVjdCgpOwogICAgICAgIE9i\namVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICBpbnQgbGVuZ3Ro\nID0gYXJyYXkubGVuZ3RoOwogICAgICAgIG91dC53cml0ZUludChsZW5ndGgp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgIG91dC53cml0ZU9iamVjdChhcnJheVtpXSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3QoT2JqZWN0SW5wdXRTdHJlYW0g\naW4pCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uIHsKICAgICAgICBpbi5kZWZhdWx0UmVhZE9iamVjdCgpOwog\nICAgICAgIGludCBsZW5ndGggPSBpbi5yZWFkSW50KCk7CiAgICAgICAgT2Jq\nZWN0W10gYXJyYXkgPSBuZXcgT2JqZWN0W2xlbmd0aF07CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBh\ncnJheVtpXSA9IGluLnJlYWRPYmplY3QoKTsKICAgICAgICB9CiAgICAgICAg\nc2V0QXJyYXkoYXJyYXkpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9T\ndHJpbmcoKSB7CiAgICAgICAgT2JqZWN0W10gYXJyYXkgPSBnZXRBcnJheSgp\nOwogICAgICAgIGludCBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAg\nU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAg\nICBidWYuYXBwZW5kKCdbJyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+IDApIGJ1Zi5h\ncHBlbmQoIiwgIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoYXJyYXlbaV0p\nOwogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5kKCddJyk7CiAgICAgICAg\ncmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIHN0YXRpYyBjbGFz\ncyBDT1dJdGVyYXRvciBpbXBsZW1lbnRzIExpc3RJdGVyYXRvciB7CgogICAg\nICAgIGZpbmFsIE9iamVjdFtdIGFycmF5OwogICAgICAgIGludCBjdXJzb3I7\nCgogICAgICAgIENPV0l0ZXJhdG9yKE9iamVjdFtdIGFycmF5LCBpbnQgY3Vy\nc29yKSB7CiAgICAgICAgICAgIHRoaXMuYXJyYXkgPSBhcnJheTsKICAgICAg\nICAgICAgdGhpcy5jdXJzb3IgPSBjdXJzb3I7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0KCkgewogICAgICAgICAgICByZXR1\ncm4gY3Vyc29yIDwgYXJyYXkubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaGFzUHJldmlvdXMoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBjdXJzb3IgPiAwOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGlu\ndCBuZXh0SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiBjdXJzb3I7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IG5leHQoKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXlbY3Vy\nc29yKytdOwogICAgICAgICAgICB9IGNhdGNoIChJbmRleE91dE9mQm91bmRz\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb1N1\nY2hFbGVtZW50RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgLy8gdG9kbzogc2hvdWxkIGRlY3JlbWVudCBjdXJzb3Igb24gZmFpbHVy\nZT8uLi4KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgcHJldmlvdXNJ\nbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIGN1cnNvciAtIDE7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHByZXZpb3VzKCkgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5Wy0t\nY3Vyc29yXTsKICAgICAgICAgICAgfSBjYXRjaCAoSW5kZXhPdXRPZkJvdW5k\nc0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9T\ndWNoRWxlbWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIC8vIHRvZG86IHNob3VsZCBkZWNyZW1lbnQgY3Vyc29yIG9uIGZhaWx1\ncmU/Li4uCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBhZGQoT2Jq\nZWN0IHZhbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRP\ncGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHNldChPYmplY3QgdmFsKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgY2xhc3MgQ09XU3ViTGlzdCBpbXBsZW1lbnRz\nIFNlcmlhbGl6YWJsZSwgTGlzdCB7CgogICAgICAgIGZpbmFsIGludCBvZmZz\nZXQ7CiAgICAgICAgaW50IGxlbmd0aDsKICAgICAgICBPYmplY3RbXSBleHBl\nY3RlZEFycmF5OwoKICAgICAgICBDT1dTdWJMaXN0KGludCBvZmZzZXQsIGlu\ndCBsZW5ndGgpIHsKICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBvZmZzZXQ7\nCiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoOwogICAgICAgICAg\nICB0aGlzLmV4cGVjdGVkQXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICByZXR1\ncm4gbGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIGxlbmd0aCA9PSAwOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2Jq\nZWN0IG8pIHsKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaChnZXRBcnJheSgp\nLCBvLCBvZmZzZXQsIG9mZnNldCArIGxlbmd0aCkgPj0gMDsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAg\nICAgICAgcmV0dXJuIGxpc3RJdGVyYXRvcigpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIE9iamVjdFtdIHRvQXJyYXkoKSB7CiAgICAgICAgICAgIE9i\namVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICAgICAgT2JqZWN0\nW10gbmV3YXJyID0gbmV3IE9iamVjdFtsZW5ndGhdOwogICAgICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KGFycmF5LCBvZmZzZXQsIG5ld2FyciwgMCwgbGVu\nZ3RoKTsKICAgICAgICAgICAgcmV0dXJuIG5ld2FycjsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KE9iamVjdFtdIGEpIHsK\nICAgICAgICAgICAgT2JqZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAg\nICAgICAgICBpZiAoYS5sZW5ndGggPCBsZW5ndGgpIHsKICAgICAgICAgICAg\nICAgIGEgPSAoT2JqZWN0W10pIEFycmF5CiAgICAgICAgICAgICAgICAgICAg\nLm5ld0luc3RhbmNlKGEuZ2V0Q2xhc3MoKS5nZXRDb21wb25lbnRUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBTeXN0ZW0uYXJyYXljb3B5KGFycmF5LCBvZmZzZXQsIGEsIDAsIGxl\nbmd0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KGFycmF5LCBvZmZzZXQsIGEsIDAsIGxlbmd0aCk7\nCiAgICAgICAgICAgICAgICBpZiAoYS5sZW5ndGggPiBsZW5ndGgpIGFbbGVu\nZ3RoXSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIGE7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2Jq\nZWN0IG8pIHsKICAgICAgICAgICAgYWRkKGxlbmd0aCwgbyk7CiAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gcmVtb3ZlKE9iamVjdCBvKSB7CiAgICAgICAgICAgIHN5bmNocm9u\naXplZCAoQ29weU9uV3JpdGVBcnJheUxpc3QudGhpcykgewogICAgICAgICAg\nICAgICAgT2JqZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgICAg\nICAgICAgaWYgKGFycmF5ICE9IGV4cGVjdGVkQXJyYXkpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IENvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNl\ncHRpb24oKTsKICAgICAgICAgICAgICAgIGludCBmdWxsTGVuZ3RoID0gYXJy\nYXkubGVuZ3RoOwogICAgICAgICAgICAgICAgaW50IHBvcyA9IHNlYXJjaChh\ncnJheSwgbywgb2Zmc2V0LCBsZW5ndGgpOwogICAgICAgICAgICAgICAgaWYg\nKHBvcyA8IDApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIE9iamVj\ndFtdIG5ld2FyciA9IG5ldyBPYmplY3RbZnVsbExlbmd0aCAtIDFdOwogICAg\nICAgICAgICAgICAgaW50IG1vdmVkID0gbGVuZ3RoIC0gcG9zIC0gMTsKICAg\nICAgICAgICAgICAgIGlmIChwb3MgPiAwKQogICAgICAgICAgICAgICAgICAg\nIFN5c3RlbS5hcnJheWNvcHkoYXJyYXksIDAsIG5ld2FyciwgMCwgcG9zKTsK\nICAgICAgICAgICAgICAgIGlmIChtb3ZlZCA+IDApCiAgICAgICAgICAgICAg\nICAgICAgU3lzdGVtLmFycmF5Y29weShhcnJheSwgcG9zICsgMSwgbmV3YXJy\nLCBwb3MsIG1vdmVkKTsKICAgICAgICAgICAgICAgIHNldEFycmF5KG5ld2Fy\ncik7CiAgICAgICAgICAgICAgICBleHBlY3RlZEFycmF5ID0gbmV3YXJyOwog\nICAgICAgICAgICAgICAgbGVuZ3RoLS07CiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gY29udGFpbnNBbGwoQ29sbGVjdGlvbiBjKSB7CiAgICAg\nICAgICAgIE9iamVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBpZiAoc2VhcmNoKGFycmF5LCBp\ndHIubmV4dCgpLCBvZmZzZXQsIGxlbmd0aCkgPCAwKSByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGRBbGwoQ29sbGVjdGlv\nbiBjKSB7CiAgICAgICAgICAgIHJldHVybiBhZGRBbGwobGVuZ3RoLCBjKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChpbnQg\naW5kZXgsIENvbGxlY3Rpb24gYykgewogICAgICAgICAgICBpbnQgYWRkZWQg\nPSBjLnNpemUoKTsKICAgICAgICAgICAgc3luY2hyb25pemVkIChDb3B5T25X\ncml0ZUFycmF5TGlzdC50aGlzKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5k\nZXggPCAwIHx8IGluZGV4ID49IGxlbmd0aCkgewogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKCJJbmRl\neDogIiArIGluZGV4ICsKICAgICAgICAgICAgICAgICAgICAgICAgIiwgU2l6\nZTogIiArIGxlbmd0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBPYmplY3RbXSBvbGRhcnIgPSBnZXRBcnJheSgpOwogICAgICAgICAg\nICAgICAgaWYgKG9sZGFyciAhPSBleHBlY3RlZEFycmF5KQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBDb25jdXJyZW50TW9kaWZpY2F0aW9uRXhj\nZXB0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoYWRkZWQgPT0gMCkgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICAgICAgaW50IGZ1bGxMZW5ndGggPSBv\nbGRhcnIubGVuZ3RoOwogICAgICAgICAgICAgICAgT2JqZWN0W10gbmV3YXJy\nID0gbmV3IE9iamVjdFtmdWxsTGVuZ3RoICsgYWRkZWRdOwogICAgICAgICAg\nICAgICAgaW50IHBvcyA9IG9mZnNldCArIGluZGV4OwogICAgICAgICAgICAg\nICAgaW50IG5ld3BvcyA9IHBvczsKICAgICAgICAgICAgICAgIFN5c3RlbS5h\ncnJheWNvcHkob2xkYXJyLCAwLCBuZXdhcnIsIDAsIHBvcyk7CiAgICAgICAg\nICAgICAgICBpbnQgcmVtID0gZnVsbExlbmd0aCAtIHBvczsKICAgICAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIG5ld2FycltuZXdw\nb3MrK10gPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaWYgKHJlbSA+IDApIFN5c3RlbS5hcnJheWNvcHkob2xkYXJy\nLCBwb3MsIG5ld2FyciwgbmV3cG9zLCByZW0pOwogICAgICAgICAgICAgICAg\nc2V0QXJyYXkobmV3YXJyKTsKICAgICAgICAgICAgICAgIGV4cGVjdGVkQXJy\nYXkgPSBuZXdhcnI7CiAgICAgICAgICAgICAgICBsZW5ndGggKz0gYWRkZWQ7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENv\nbGxlY3Rpb24gYykgewogICAgICAgICAgICBpZiAoYy5pc0VtcHR5KCkpIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgc3luY2hyb25pemVkIChDb3B5T25X\ncml0ZUFycmF5TGlzdC50aGlzKSB7CiAgICAgICAgICAgICAgICBPYmplY3Rb\nXSBhcnJheSA9IGdldEFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAoYXJy\nYXkgIT0gZXhwZWN0ZWRBcnJheSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgQ29uY3VycmVudE1vZGlmaWNhdGlvbkV4Y2VwdGlvbigpOwogICAg\nICAgICAgICAgICAgaW50IGZ1bGxMZW5ndGggPSBhcnJheS5sZW5ndGg7CiAg\nICAgICAgICAgICAgICBPYmplY3RbXSB0bXAgPSBuZXcgT2JqZWN0W2xlbmd0\naF07CiAgICAgICAgICAgICAgICBpbnQgcmV0YWluZWQgPSAwOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IG9mZnNldDsgaSA8IG9mZnNldCArIGxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IG8gPSBh\ncnJheVtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWMuY29udGFpbnMo\nbykpIHRtcFtyZXRhaW5lZCsrXSA9IG87CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBpZiAocmV0YWluZWQgPT0gbGVuZ3RoKSByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBPYmplY3RbXSBuZXdhcnIgPSBuZXcg\nT2JqZWN0W2Z1bGxMZW5ndGggKyByZXRhaW5lZCAtIGxlbmd0aF07CiAgICAg\nICAgICAgICAgICBpbnQgbW92ZWQgPSBmdWxsTGVuZ3RoIC0gb2Zmc2V0IC0g\nbGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKG9mZnNldCA+IDApIFN5c3Rl\nbS5hcnJheWNvcHkoYXJyYXksIDAsIG5ld2FyciwgMCwgb2Zmc2V0KTsKICAg\nICAgICAgICAgICAgIGlmIChyZXRhaW5lZCA+IDApCiAgICAgICAgICAgICAg\nICAgICAgU3lzdGVtLmFycmF5Y29weSh0bXAsIDAsIG5ld2Fyciwgb2Zmc2V0\nLCByZXRhaW5lZCk7CiAgICAgICAgICAgICAgICBpZiAobW92ZWQgPiAwKQog\nICAgICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoYXJyYXksIG9m\nZnNldCArIGxlbmd0aCwgbmV3YXJyLAogICAgICAgICAgICAgICAgICAgICAg\nICBvZmZzZXQgKyByZXRhaW5lZCwgbW92ZWQpOwogICAgICAgICAgICAgICAg\nc2V0QXJyYXkobmV3YXJyKTsKICAgICAgICAgICAgICAgIGV4cGVjdGVkQXJy\nYXkgPSBuZXdhcnI7CiAgICAgICAgICAgICAgICBsZW5ndGggPSByZXRhaW5l\nZDsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZXRhaW5BbGwo\nQ29sbGVjdGlvbiBjKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoQ29w\neU9uV3JpdGVBcnJheUxpc3QudGhpcykgewogICAgICAgICAgICAgICAgT2Jq\nZWN0W10gYXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgICAgICAgICAgaWYg\nKGFycmF5ICE9IGV4cGVjdGVkQXJyYXkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IENvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNlcHRpb24oKTsK\nICAgICAgICAgICAgICAgIGludCBmdWxsTGVuZ3RoID0gYXJyYXkubGVuZ3Ro\nOwogICAgICAgICAgICAgICAgT2JqZWN0W10gdG1wID0gbmV3IE9iamVjdFts\nZW5ndGhdOwogICAgICAgICAgICAgICAgaW50IHJldGFpbmVkID0gMDsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSBvZmZzZXQ7IGkgPCBvZmZzZXQg\nKyBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIE9iamVjdCBv\nID0gYXJyYXlbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGMuY29udGFp\nbnMobykpIHRtcFtyZXRhaW5lZCsrXSA9IG87CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBpZiAocmV0YWluZWQgPT0gbGVuZ3RoKSByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgICAgICBPYmplY3RbXSBuZXdhcnIgPSBu\nZXcgT2JqZWN0W2Z1bGxMZW5ndGggKyByZXRhaW5lZCAtIGxlbmd0aF07CiAg\nICAgICAgICAgICAgICBpbnQgbW92ZWQgPSBmdWxsTGVuZ3RoIC0gb2Zmc2V0\nIC0gbGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKG9mZnNldCA+IDApCiAg\nICAgICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShhcnJheSwgMCwg\nbmV3YXJyLCAwLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgaWYgKHJldGFp\nbmVkID4gMCkKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKHRtcCwgMCwgbmV3YXJyLCBvZmZzZXQsIHJldGFpbmVkKTsKICAgICAgICAg\nICAgICAgIGlmIChtb3ZlZCA+IDApCiAgICAgICAgICAgICAgICAgICAgU3lz\ndGVtLmFycmF5Y29weShhcnJheSwgb2Zmc2V0ICsgbGVuZ3RoLCBuZXdhcnIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCArIHJldGFpbmVkLCBt\nb3ZlZCk7CiAgICAgICAgICAgICAgICBzZXRBcnJheShuZXdhcnIpOwogICAg\nICAgICAgICAgICAgZXhwZWN0ZWRBcnJheSA9IG5ld2FycjsKICAgICAgICAg\nICAgICAgIGxlbmd0aCA9IHJldGFpbmVkOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQg\nKENvcHlPbldyaXRlQXJyYXlMaXN0LnRoaXMpIHsKICAgICAgICAgICAgICAg\nIE9iamVjdFtdIGFycmF5ID0gZ2V0QXJyYXkoKTsKICAgICAgICAgICAgICAg\nIGlmIChhcnJheSAhPSBleHBlY3RlZEFycmF5KQogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBDb25jdXJyZW50TW9kaWZpY2F0aW9uRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgICAgICBpbnQgZnVsbExlbmd0aCA9IGFycmF5Lmxl\nbmd0aDsKICAgICAgICAgICAgICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBP\nYmplY3RbZnVsbExlbmd0aCAtIGxlbmd0aF07CiAgICAgICAgICAgICAgICBp\nbnQgbW92ZWQgPSBmdWxsTGVuZ3RoIC0gb2Zmc2V0IC0gbGVuZ3RoOwogICAg\nICAgICAgICAgICAgaWYgKG9mZnNldCA+IDApIFN5c3RlbS5hcnJheWNvcHko\nYXJyYXksIDAsIG5ld2FyciwgMCwgb2Zmc2V0KTsKICAgICAgICAgICAgICAg\nIGlmIChtb3ZlZCA+IDApCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShhcnJheSwgb2Zmc2V0ICsgbGVuZ3RoLCBuZXdhcnIsIG9mZnNl\ndCwKICAgICAgICAgICAgICAgICAgICAgICAgbW92ZWQpOwogICAgICAgICAg\nICAgICAgc2V0QXJyYXkobmV3YXJyKTsKICAgICAgICAgICAgICAgIGV4cGVj\ndGVkQXJyYXkgPSBuZXdhcnI7CiAgICAgICAgICAgICAgICBsZW5ndGggPSAw\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAgaWYgKG8gPT0g\ndGhpcykgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFu\nY2VvZiBMaXN0KSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBPYmplY3Rb\nXSBhcnJheTsKICAgICAgICAgICAgaW50IGxhc3Q7CiAgICAgICAgICAgIHN5\nbmNocm9uaXplZCAoQ29weU9uV3JpdGVBcnJheUxpc3QudGhpcykgewogICAg\nICAgICAgICAgICAgYXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgICAgICAg\nICAgaWYgKGFycmF5ICE9IGV4cGVjdGVkQXJyYXkpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IENvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNlcHRp\nb24oKTsKICAgICAgICAgICAgICAgIGxhc3QgPSBvZmZzZXQgKyBsZW5ndGg7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTGlzdEl0ZXJhdG9yIGl0ciA9\nICgoTGlzdCkgbykubGlzdEl0ZXJhdG9yKCk7CiAgICAgICAgICAgIGludCBp\nZHggPSBvZmZzZXQ7CiAgICAgICAgICAgIHdoaWxlIChpZHggPCBsYXN0ICYm\nIGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgIE9iamVjdCBvMSA9\nIGFycmF5W2lkeF07CiAgICAgICAgICAgICAgICBPYmplY3QgbzIgPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKCFlcShvMSwgbzIpKSByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChp\nZHggPT0gbGFzdCAmJiAhaXRyLmhhc05leHQoKSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQg\naGFzaENvZGUgPSAxOwogICAgICAgICAgICBPYmplY3RbXSBhcnJheTsKICAg\nICAgICAgICAgaW50IGxhc3Q7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\nQ29weU9uV3JpdGVBcnJheUxpc3QudGhpcykgewogICAgICAgICAgICAgICAg\nYXJyYXkgPSBnZXRBcnJheSgpOwogICAgICAgICAgICAgICAgaWYgKGFycmF5\nICE9IGV4cGVjdGVkQXJyYXkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IENvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNlcHRpb24oKTsKICAgICAg\nICAgICAgICAgIGxhc3QgPSBvZmZzZXQgKyBsZW5ndGg7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IG9mZnNldDsgaSA8IGxhc3Q7\nIGkrKykgewogICAgICAgICAgICAgICAgT2JqZWN0IG8gPSBhcnJheVtpXTsK\nICAgICAgICAgICAgICAgIGhhc2hDb2RlID0gMzEgKiBoYXNoQ29kZSArIChv\nID09IG51bGwgPyAwIDogby5oYXNoQ29kZSgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gaGFzaENvZGU7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaW5kZXgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGdldEFycmF5KClbb2Zmc2V0ICsgaW5kZXhdOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIE9iamVjdCBzZXQoaW50IGluZGV4LCBPYmplY3Qg\nZWxlbWVudCkgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKENvcHlPbldy\naXRlQXJyYXlMaXN0LnRoaXMpIHsKICAgICAgICAgICAgICAgIGlmIChpbmRl\neCA8IDAgfHwgaW5kZXggPj0gbGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oIkluZGV4\nOiAiICsgaW5kZXggKwogICAgICAgICAgICAgICAgICAgICAgICAiLCBTaXpl\nOiAiICsgbGVuZ3RoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIE9iamVjdFtdIG9sZGFyciA9IGdldEFycmF5KCk7CiAgICAgICAgICAg\nICAgICBpZiAob2xkYXJyICE9IGV4cGVjdGVkQXJyYXkpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IENvbmN1cnJlbnRNb2RpZmljYXRpb25FeGNl\ncHRpb24oKTsKICAgICAgICAgICAgICAgIGludCBmdWxsTGVuZ3RoID0gb2xk\nYXJyLmxlbmd0aDsKICAgICAgICAgICAgICAgIC8vIHBpZ2d5YmFjayB0aGUg\nYXJyYXkgYm91bmRzIGNoZWNrCiAgICAgICAgICAgICAgICBPYmplY3Qgb2xk\nVmFsID0gb2xkYXJyW29mZnNldCArIGluZGV4XTsKICAgICAgICAgICAgICAg\nIGlmIChvbGRWYWwgPT0gZWxlbWVudCkgewogICAgICAgICAgICAgICAgICAg\nIHNldEFycmF5KG9sZGFycik7CiAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBPYmpl\nY3RbZnVsbExlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShvbGRhcnIsIDAsIG5ld2FyciwgMCwgZnVsbExlbmd0aCk7CiAg\nICAgICAgICAgICAgICAgICAgbmV3YXJyW29mZnNldCArIGluZGV4XSA9IGVs\nZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgc2V0QXJyYXkobmV3YXJyKTsK\nICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEFycmF5ID0gbmV3YXJyOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG9sZFZh\nbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgYWRkKGludCBpbmRleCwgT2JqZWN0IGVsZW1lbnQpIHsKICAgICAgICAg\nICAgc3luY2hyb25pemVkIChDb3B5T25Xcml0ZUFycmF5TGlzdC50aGlzKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gbGVu\nZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEluZGV4T3V0\nT2ZCb3VuZHNFeGNlcHRpb24oIkluZGV4OiAiICsgaW5kZXggKwogICAgICAg\nICAgICAgICAgICAgICAgICAiLCBTaXplOiAiICsgbGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIE9iamVjdFtdIG9sZGFyciA9\nIGdldEFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAob2xkYXJyICE9IGV4\ncGVjdGVkQXJyYXkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENv\nbmN1cnJlbnRNb2RpZmljYXRpb25FeGNlcHRpb24oKTsKICAgICAgICAgICAg\nICAgIGludCBmdWxsTGVuZ3RoID0gb2xkYXJyLmxlbmd0aDsKICAgICAgICAg\nICAgICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBPYmplY3RbZnVsbExlbmd0\naCArIDFdOwogICAgICAgICAgICAgICAgaW50IHBvcyA9IG9mZnNldCArIGlu\nZGV4OwogICAgICAgICAgICAgICAgaW50IG1vdmVkID0gZnVsbExlbmd0aCAt\nIHBvczsKICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkob2xkYXJy\nLCAwLCBuZXdhcnIsIDAsIHBvcyk7CiAgICAgICAgICAgICAgICBuZXdhcnJb\ncG9zXSA9IGVsZW1lbnQ7CiAgICAgICAgICAgICAgICBpZiAobW92ZWQgPiAw\nKSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShvbGRh\ncnIsIHBvcywgbmV3YXJyLCBwb3MgKyAxLCBtb3ZlZCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBzZXRBcnJheShuZXdhcnIpOwogICAg\nICAgICAgICAgICAgZXhwZWN0ZWRBcnJheSA9IG5ld2FycjsKICAgICAgICAg\nICAgICAgIGxlbmd0aCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgT2JqZWN0IHJlbW92ZShpbnQgaW5kZXgpIHsKICAgICAg\nICAgICAgc3luY2hyb25pemVkIChDb3B5T25Xcml0ZUFycmF5TGlzdC50aGlz\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49\nIGxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbmRl\neE91dE9mQm91bmRzRXhjZXB0aW9uKCJJbmRleDogIiArIGluZGV4ICsKICAg\nICAgICAgICAgICAgICAgICAgICAgIiwgU2l6ZTogIiArIGxlbmd0aCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBPYmplY3RbXSBhcnJh\neSA9IGdldEFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAoYXJyYXkgIT0g\nZXhwZWN0ZWRBcnJheSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nQ29uY3VycmVudE1vZGlmaWNhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgICAg\nICAgICAgaW50IGZ1bGxMZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAg\nICAgICAgICBpbnQgcG9zID0gb2Zmc2V0ICsgaW5kZXg7CiAgICAgICAgICAg\nICAgICBPYmplY3QgcmVzdWx0ID0gYXJyYXlbcG9zXTsKICAgICAgICAgICAg\nICAgIE9iamVjdFtdIG5ld2FyciA9IG5ldyBPYmplY3RbZnVsbExlbmd0aCAt\nIDFdOwogICAgICAgICAgICAgICAgaW50IG1vdmVkID0gZnVsbExlbmd0aCAt\nIHBvcyAtIDE7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKQogICAg\nICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoYXJyYXksIDAsIG5l\nd2FyciwgMCwgcG9zKTsKICAgICAgICAgICAgICAgIGlmIChtb3ZlZCA+IDAp\nCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShhcnJheSwg\ncG9zICsgMSwgbmV3YXJyLCBwb3MsIG1vdmVkKTsKICAgICAgICAgICAgICAg\nIHNldEFycmF5KG5ld2Fycik7CiAgICAgICAgICAgICAgICBleHBlY3RlZEFy\ncmF5ID0gbmV3YXJyOwogICAgICAgICAgICAgICAgbGVuZ3RoLS07CiAgICAg\nICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGluZGV4T2YoT2JqZWN0IG8pIHsK\nICAgICAgICAgICAgaW50IHBvcyA9IHNlYXJjaChnZXRBcnJheSgpLCBvLCBv\nZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7CiAgICAgICAgICAgIHJldHVybiBw\nb3MgPj0gMCA/IHBvcyAtIG9mZnNldCA6IC0xOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBpbmRleE9mKE9iamVjdCBvLCBpbnQgaW5kZXgpIHsK\nICAgICAgICAgICAgaW50IHBvcyA9CiAgICAgICAgICAgICAgICBzZWFyY2go\nZ2V0QXJyYXkoKSwgbywgb2Zmc2V0ICsgaW5kZXgsIG9mZnNldCArIGxlbmd0\naCkgLSBvZmZzZXQ7CiAgICAgICAgICAgIHJldHVybiBwb3MgPj0gMCA/IHBv\ncyAtIG9mZnNldCA6IC0xOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGlu\ndCBsYXN0SW5kZXhPZihPYmplY3QgbykgewogICAgICAgICAgICBpbnQgcG9z\nID0gcmV2ZXJzZVNlYXJjaChnZXRBcnJheSgpLCBvLCBvZmZzZXQsIG9mZnNl\ndCArIGxlbmd0aCkKICAgICAgICAgICAgICAgIC0gb2Zmc2V0OwogICAgICAg\nICAgICByZXR1cm4gcG9zID49IDAgPyBwb3MgLSBvZmZzZXQgOiAtMTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgbGFzdEluZGV4T2YoT2JqZWN0\nIG8sIGludCBpbmRleCkgewogICAgICAgICAgICBpbnQgcG9zID0KICAgICAg\nICAgICAgICAgIHJldmVyc2VTZWFyY2goZ2V0QXJyYXkoKSwgbywgb2Zmc2V0\nLCBvZmZzZXQgKyBpbmRleCkgLSBvZmZzZXQ7CiAgICAgICAgICAgIHJldHVy\nbiBwb3MgPj0gMCA/IHBvcyAtIG9mZnNldCA6IC0xOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIExpc3RJdGVyYXRvciBsaXN0SXRlcmF0b3IoKSB7CiAg\nICAgICAgICAgIC8vIG11c3Qgc3luY2hyb25pemUgdG8gYXRvbWljYWxseSBv\nYnRhaW4gdGhlIGFycmF5IGFuZCBsZW5ndGgKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChDb3B5T25Xcml0ZUFycmF5TGlzdC50aGlzKSB7CiAgICAgICAg\nICAgICAgICBPYmplY3RbXSBhcnJheSA9IGdldEFycmF5KCk7CiAgICAgICAg\nICAgICAgICBpZiAoYXJyYXkgIT0gZXhwZWN0ZWRBcnJheSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgQ29uY3VycmVudE1vZGlmaWNhdGlvbkV4\nY2VwdGlvbigpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDT1dTdWJJ\ndGVyYXRvcihhcnJheSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgsCiAgICAg\nICAgICAgICAgICAgICAgb2Zmc2V0KTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIExpc3RJdGVyYXRvciBsaXN0SXRlcmF0b3Io\naW50IGluZGV4KSB7CiAgICAgICAgICAgIC8vIG11c3Qgc3luY2hyb25pemUg\ndG8gYXRvbWljYWxseSBvYnRhaW4gdGhlIGFycmF5IGFuZCBsZW5ndGgKICAg\nICAgICAgICAgc3luY2hyb25pemVkIChDb3B5T25Xcml0ZUFycmF5TGlzdC50\naGlzKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4\nID49IGxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKCJJbmRleDogIiArIGluZGV4ICsK\nICAgICAgICAgICAgICAgICAgICAgICAgIiwgU2l6ZTogIiArIGxlbmd0aCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBPYmplY3RbXSBh\ncnJheSA9IGdldEFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAoYXJyYXkg\nIT0gZXhwZWN0ZWRBcnJheSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQ29uY3VycmVudE1vZGlmaWNhdGlvbkV4Y2VwdGlvbigpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBDT1dTdWJJdGVyYXRvcihhcnJheSwgb2Zm\nc2V0LCBvZmZzZXQgKyBsZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgb2Zm\nc2V0ICsgaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgTGlzdCBzdWJMaXN0KGludCBmcm9tSW5kZXgsIGludCB0b0lu\nZGV4KSB7CiAgICAgICAgICAgIGlmIChmcm9tSW5kZXggPCAwIHx8IHRvSW5k\nZXggPiBsZW5ndGggfHwgZnJvbUluZGV4ID4gdG9JbmRleCkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24o\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IENPV1N1\nYkxpc3Qob2Zmc2V0ICsgZnJvbUluZGV4LCB0b0luZGV4IC0gZnJvbUluZGV4\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmco\nKSB7CiAgICAgICAgICAgIE9iamVjdFtdIGFycmF5OwogICAgICAgICAgICBp\nbnQgbGFzdDsKICAgICAgICAgICAgc3luY2hyb25pemVkIChDb3B5T25Xcml0\nZUFycmF5TGlzdC50aGlzKSB7CiAgICAgICAgICAgICAgICBhcnJheSA9IGdl\ndEFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAoYXJyYXkgIT0gZXhwZWN0\nZWRBcnJheSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ29uY3Vy\ncmVudE1vZGlmaWNhdGlvbkV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAg\nbGFzdCA9IG9mZnNldCArIGxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwog\nICAgICAgICAgICBidWYuYXBwZW5kKCdbJyk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSBvZmZzZXQ7IGkgPCBsYXN0OyBpKyspIHsKICAgICAgICAgICAg\nICAgIGlmIChpID4gb2Zmc2V0KSBidWYuYXBwZW5kKCIsICIpOwogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZChhcnJheVtpXSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgYnVmLmFwcGVuZCgnXScpOwogICAgICAgICAgICByZXR1\ncm4gYnVmLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRp\nYyBjbGFzcyBDT1dTdWJJdGVyYXRvciBpbXBsZW1lbnRzIExpc3RJdGVyYXRv\nciB7CgogICAgICAgIGZpbmFsIE9iamVjdFtdIGFycmF5OwogICAgICAgIGlu\ndCBjdXJzb3I7CiAgICAgICAgaW50IGZpcnN0LCBsYXN0OwoKICAgICAgICBD\nT1dTdWJJdGVyYXRvcihPYmplY3RbXSBhcnJheSwgaW50IGZpcnN0LCBpbnQg\nbGFzdCwgaW50IGN1cnNvcikgewogICAgICAgICAgICB0aGlzLmFycmF5ID0g\nYXJyYXk7CiAgICAgICAgICAgIHRoaXMuZmlyc3QgPSBmaXJzdDsKICAgICAg\nICAgICAgdGhpcy5sYXN0ID0gbGFzdDsKICAgICAgICAgICAgdGhpcy5jdXJz\nb3IgPSBjdXJzb3I7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNOZXh0KCkgewogICAgICAgICAgICByZXR1cm4gY3Vyc29yIDwgbGFz\ndDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1ByZXZp\nb3VzKCkgewogICAgICAgICAgICByZXR1cm4gY3Vyc29yID4gZmlyc3Q7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IG5leHRJbmRleCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGN1cnNvciAtIGZpcnN0OwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE9iamVjdCBuZXh0KCkgewogICAgICAgICAgICBpZiAo\nY3Vyc29yID09IGxhc3QpIHRocm93IG5ldyBOb1N1Y2hFbGVtZW50RXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIHJldHVybiBhcnJheVtjdXJzb3IrK107CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IHByZXZpb3VzSW5kZXgoKSB7\nCiAgICAgICAgICAgIHJldHVybiBjdXJzb3IgLSBmaXJzdCAtIDE7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHByZXZpb3VzKCkgewogICAg\nICAgICAgICBpZiAoY3Vyc29yID09IGZpcnN0KSB0aHJvdyBuZXcgTm9TdWNo\nRWxlbWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICByZXR1cm4gYXJyYXlb\nLS1jdXJzb3JdOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgYWRk\nKE9iamVjdCB2YWwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzZXQoT2JqZWN0IHZhbCkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4g\nZXEoT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsKICAgICAgICByZXR1cm4gKG8x\nID09IG51bGwgPyBvMiA9PSBudWxsIDogbzEuZXF1YWxzKG8yKSk7CiAgICB9\nCn0K\n","encoding":"base64"}

