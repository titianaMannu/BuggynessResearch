{"sha":"4e6bd99c86d4c17e72c037732e04db80dff1023f","node_id":"MDQ6QmxvYjIwNjM2NDo0ZTZiZDk5Yzg2ZDRjMTdlNzJjMDM3NzMyZTA0ZGI4MGRmZjEwMjNm","size":53245,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4e6bd99c86d4c17e72c037732e04db80dff1023f","content":"LyoNCiAqIENvcHlyaWdodCAyMDA2IFRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbi4NCiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkg\nbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0\naGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUg\nTGljZW5zZSBhdA0KICogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNl\ncy9MSUNFTlNFLTIuMA0KICogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAq\nIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVk\nIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMg\nT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3Ig\naW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmlj\nIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0\nYXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudGVzdDsNCg0KaW1wb3J0IGphdmEuYmVhbnMu\nQmVhbkluZm87DQppbXBvcnQgamF2YS5iZWFucy5JbnRyb3NwZWN0aW9uRXhj\nZXB0aW9uOw0KaW1wb3J0IGphdmEuYmVhbnMuSW50cm9zcGVjdG9yOw0KaW1w\nb3J0IGphdmEuYmVhbnMuUHJvcGVydHlEZXNjcmlwdG9yOw0KaW1wb3J0IGph\ndmEuaW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07DQppbXBvcnQgamF2YS5pby5C\neXRlQXJyYXlPdXRwdXRTdHJlYW07DQppbXBvcnQgamF2YS5pby5GaWxlOw0K\naW1wb3J0IGphdmEuaW8uRmlsZUlucHV0U3RyZWFtOw0KaW1wb3J0IGphdmEu\naW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEuaW8uRmls\nZU91dHB1dFN0cmVhbTsNCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOw0K\naW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07DQppbXBvcnQgamF2YS5pby5P\nYmplY3RJbnB1dFN0cmVhbTsNCmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndFN0cmVhbTsNCmltcG9ydCBqYXZhLmlvLlByaW50U3RyZWFtOw0KaW1wb3J0\nIGphdmEuaW8uUHJpbnRXcml0ZXI7DQppbXBvcnQgamF2YS5pby5TdHJpbmdX\ncml0ZXI7DQppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRh\ncmdldEV4Y2VwdGlvbjsNCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7DQppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7DQppbXBvcnQgamF2\nYS5tYXRoLkJpZ0ludGVnZXI7DQppbXBvcnQgamF2YS5uZXQuVVJMOw0KaW1w\nb3J0IGphdmEudGV4dC5OdW1iZXJGb3JtYXQ7DQppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOw0KaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uOw0KaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uczsNCmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsNCmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsNCmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsN\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7DQppbXBvcnQgamF2YS51dGls\nLkxpbmtlZExpc3Q7DQppbXBvcnQgamF2YS51dGlsLkxpc3Q7DQppbXBvcnQg\namF2YS51dGlsLkxpc3RJdGVyYXRvcjsNCmltcG9ydCBqYXZhLnV0aWwuTWFw\nOw0KaW1wb3J0IGphdmEudXRpbC5Ob1N1Y2hFbGVtZW50RXhjZXB0aW9uOw0K\naW1wb3J0IGphdmEudXRpbC5TdHJpbmdUb2tlbml6ZXI7DQoNCmltcG9ydCBq\ndW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7DQppbXBvcnQganVuaXQuZnJhbWV3\nb3JrLlRlc3RSZXN1bHQ7DQppbXBvcnQganVuaXQudGV4dHVpLlRlc3RSdW5u\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5yZWdleHAuUkU7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5yZWdleHAuUkVTeW50YXhFeGNlcHRpb247DQppbXBvcnQgb3Jn\nLmFwYWNoZS5yZWdleHAuUkVVdGlsOw0KaW1wb3J0IG9yZy5hcGFjaGUudG9v\nbHMuYW50LkFudENsYXNzTG9hZGVyOw0KaW1wb3J0IG9yZy5hcGFjaGUudG9v\nbHMuYW50LlByb2plY3Q7DQppbXBvcnQgb3JnLmFwYWNoZS50b29scy5hbnQu\nUHJvamVjdEhlbHBlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cu\nTG9nRmFjdG9yeUltcGw7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsNCg0KLyoqDQogKiBUZXN0Q2FzZSBmcmFtZXdv\ncmsgdG8gcnVuIHZhcmlvdXMgdGVzdHMgYWdhaW5zdCBzb2xhcm1ldHJpYyBj\nb2RlLg0KICogVGhpcyBjbGFzcyBjb250YWlucyB2YXJpb3VzIHV0aWxpdHkg\nbWV0aG9kcyBmb3IgdGhlIGZvbGxvd2luZyBmdW5jdGlvbnM6DQogKiA8dWw+\nDQogKiA8bGk+VXNpbmcgbXVsdGlwbGUsIGlzb2xhdGVkIENsYXNzTG9hZGVy\nczwvbGk+DQogKiA8bGk+UnVubmluZyBhIHRlc3QgaW4gbXVsdGlwbGUgY29u\nY3VycmVudCB0aHJlYWRzPC9saT4NCiAqIDxsaT5Bc3NlcnRpb24gaGVscGVy\nczwvbGk+DQogKiA8bGk+Q3JlYXRpbmcgcmFuZG9tIFN0cmluZ3MsIG51bWJl\ncnMsIGV0Yy48L2xpPg0KICogPC91bD4NCiAqDQogKiBAYXV0aG9yIE1hcmMg\nUHJ1ZCdob21tZWF1eA0KICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkNCiAq\nLw0KcHVibGljIGFic3RyYWN0IGNsYXNzIEFic3RyYWN0VGVzdENhc2UgZXh0\nZW5kcyBUZXN0Q2FzZSB7DQoNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBURVNUX01FVEhPRFMgPQ0KICAgICAgICBTeXN0ZW0uZ2V0UHJvcGVy\ndHkoQWJzdHJhY3RUZXN0Q2FzZS5jbGFzcy5nZXROYW1lKCkgKyAiLnRlc3RN\nZXRob2RzIik7DQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBsb25nIFBMQVRG\nT1JNX0FMTCA9IDIgPDwgMTsNCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGxv\nbmcgUExBVEZPUk1fVU5LTk9XTiA9IDIgPDwgMjsNCg0KICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIFNLSVBfVE9LRU4gPSAiU09MQVJTS0lQIjsN\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTS0lQX0RFTElNSVRF\nUiA9ICJ8IjsNCg0KICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0NCiAgICAgICAgTG9jYWxpemVyLmZvclBhY2thZ2UoQWJzdHJh\nY3RUZXN0Q2FzZS5jbGFzcyk7DQoNCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG11\nbHRpVGhyZWFkRXhlY3V0aW5nID0gbnVsbDsNCiAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBpblRpbWVvdXRUaHJlYWQgPSBmYWxzZTsNCg0KICAgIHByaXZhdGUg\nTG9nIGxvZyA9IG51bGw7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBNYXAgX3Rp\nbWVzID0gbmV3IEhhc2hNYXAoKTsNCg0KICAgIHByaXZhdGUgc3RhdGljIEFi\nc3RyYWN0VGVzdENhc2UgX2xhc3RUZXN0ID0gbnVsbDsNCg0KICAgIHByaXZh\ndGUgc3RhdGljIFdhdGNoZG9nVGhyZWFkIF93YXRjaGRvZyA9IG5ldyBXYXRj\naGRvZ1RocmVhZCgpOw0KICAgIHByaXZhdGUgbG9uZyBfdGltZW91dDsNCg0K\nICAgIC8qKg0KICAgICAqIENvbnN0cnVjdG9yLiBDcmVhdGUgYSB0ZXN0IGNh\nc2Ugd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuDQogICAgICovDQogICAgcHVi\nbGljIEFic3RyYWN0VGVzdENhc2UoU3RyaW5nIHRlc3QpIHsNCiAgICAgICAg\nc3VwZXIodGVzdCk7DQogICAgfQ0KDQogICAgcHVibGljIEFic3RyYWN0VGVz\ndENhc2UoKSB7DQogICAgfQ0KDQogICAgcHJvdGVjdGVkIGZpbmFsIExvZyBn\nZXRMb2coKSB7DQogICAgICAgIGlmIChsb2cgPT0gbnVsbCkNCiAgICAgICAg\nICAgIGxvZyA9IG5ld0xvZygpOw0KICAgICAgICByZXR1cm4gbG9nOw0KICAg\nIH0NCg0KICAgIHByb3RlY3RlZCBMb2cgbmV3TG9nKCkgew0KICAgICAgICAv\nLyB0aGlzIGltcGxlbWVudGF0aW9uIGxlYXZlcyBtdWNoIHRvIGJlIGRlc2ly\nZWQsIGFzIGl0IGp1c3QNCiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBMb2dG\nYWN0b3J5SW1wbCBlYWNoIHRpbWUsIGFuZCBkb2VzIG5vdCBhcHBseQ0KICAg\nICAgICAvLyBhbnkgY29uZmlndXJhdGlvbnMuDQogICAgICAgIHJldHVybiBu\nZXcgTG9nRmFjdG9yeUltcGwoKS5nZXRMb2coZ2V0TG9nTmFtZSgpKTsNCiAg\nICB9DQoNCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldExvZ05hbWUoKSB7DQog\nICAgICAgIHJldHVybiAiY29tLnNvbGFybWV0cmljLlJ1bnRpbWUiOw0KICAg\nIH0NCg0KICAgIC8qKg0KICAgICAqIENhbGxlZCBiZWZvcmUgdGhlIHdhdGNo\nZG9nIHRocmVhZCBpcyBhYm91dCB0byBraWxsIHRoZSBlbnRpcmUNCiAgICAg\nKiBKVk0gZHVlIHRvIGEgdGVzdCBjYXNlJ3MgdGltZW91dC4gVGhpcyBtZXRo\nb2Qgb2ZmZXJzIHRoZQ0KICAgICAqIGFiaWxpdHkgdG8gdHJ5IHRvIHJlc29s\ndmUgd2hhdGV2ZXIgY29udGVudGlvbiBpcyB0YWtpbmcgcGxhY2UNCiAgICAg\nKiBpbiB0aGUgdGVzdC4gSXQgd2lsbCBiZSBnaXZlbiAxMCBzZWNvbmRzIHRv\nIHRyeSB0byBlbmQgdGhlDQogICAgICogdGVzdCBwZWFjZWZ1bGx5IGJlZm9y\nZSB0aGUgd2F0Y2hkb2cgZXhpdHMgdGhlIEpWTS4NCiAgICAgKi8NCiAgICBw\ncm90ZWN0ZWQgdm9pZCBwcmVUaW1lb3V0KCkgew0KICAgIH0NCg0KICAgIHB1\nYmxpYyB2b2lkIHJ1bihUZXN0UmVzdWx0IHJlc3VsdCkgew0KICAgICAgICBp\nZiAoc2tpcFRlc3QoKSkgew0KICAgICAgICAgICAgLy8ga2VlcCB0cmFjayBv\nZiB0aGUgdGVzdHMgd2Ugc2tpcCBzbyB0aGF0IHdlIGNhbiBnZXQgYW4NCiAg\nICAgICAgICAgIC8vIGlkZWEgaW4gdGhlIGF1dG9idWlsZCBzdGF0dXMNCiAg\nICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbihTS0lQX1RPS0VOICsgU0tJ\nUF9ERUxJTUlURVINCiAgICAgICAgICAgICAgICArICgiIiArIGdldENsYXNz\nKCkuZ2V0TmFtZSgpKQ0KICAgICAgICAgICAgICAgICsgIi4iICsgZ2V0TmFt\nZSgpICsgU0tJUF9ERUxJTUlURVIpOw0KICAgICAgICAgICAgcmV0dXJuOw0K\nICAgICAgICB9DQoNCiAgICAgICAgaWYgKF9sYXN0VGVzdCAhPSBudWxsICYm\nIF9sYXN0VGVzdC5nZXRDbGFzcygpICE9IGdldENsYXNzKCkpIHsNCiAgICAg\nICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgX2xhc3RUZXN0LnRlYXJE\nb3duVGVzdENsYXNzKCk7DQogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2Fi\nbGUgdCkgew0KICAgICAgICAgICAgICAgIGdldExvZygpLmVycm9yKG51bGws\nIHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYg\nKF9sYXN0VGVzdCA9PSBudWxsIHx8IF9sYXN0VGVzdC5nZXRDbGFzcygpICE9\nIGdldENsYXNzKCkpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAg\nICAgICAgc2V0VXBUZXN0Q2xhc3MoKTsNCiAgICAgICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7DQogICAgICAgICAgICAgICAgZ2V0TG9nKCkuZXJy\nb3IobnVsbCwgdCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAg\nICAgICBfbGFzdFRlc3QgPSB0aGlzOw0KDQogICAgICAgIC8vIGluZm9ybSB0\naGUgd2F0Y2hkb2cgdGhyZWFkIHRoYXQgd2UgYXJlIGVudGVyaW5nIHRoZSB0\nZXN0DQogICAgICAgIF93YXRjaGRvZy5lbnRlcmluZ1Rlc3QodGhpcyk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBzdXBlci5ydW4ocmVzdWx0KTsN\nCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIF93YXRjaGRvZy5s\nZWF2aW5nVGVzdCh0aGlzKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIElmIHRoaXMgdGVzdCBzaG91bGQgYmUgc2tpcHBlZCBnaXZl\nbiB0aGUgY3VycmVudA0KICAgICAqIGVudmlyb25tZW50LCByZXR1cm4gPGNv\nZGU+dHJ1ZTwvY29kZT4uIFRoaXMgYWxsb3dzIGEgdW5pdCB0ZXN0DQogICAg\nICogY2xhc3MgdG8gZGlzYWJsZSB0ZXN0IGNhc2VzIG9uIGEgcGVyLW1ldGhv\nZCBncmFudWxhcml0eSwgYW5kDQogICAgICogcHJldmVudHMgdGhlIHRlc3Qg\nZnJvbSBzaG93aW5nIHVwIGFzIGEgcGFzc2VkIHRlc3QganVzdA0KICAgICAq\nIGJlY2F1c2UgaXQgd2FzIHNraXBwZWQuDQogICAgICogRm9yIGV4YW1wbGUs\nIGlmIGEgcGFydGljdWxhciB0ZXN0IGNhc2UgbWV0aG9kIHNob3VsZCBub3Qg\nYmUNCiAgICAgKiBydW4gYWdhaW5zdCBhIGNlcnRhaW4gZGF0YWJhc2UsIHRo\naXMgbWV0aG9kIGNvdWxkIGNoZWNrIHRoZQ0KICAgICAqIG5hbWUgb2YgdGhl\nIHRlc3QgcmVzdWx0IGFuZCB0aGUgY3VycmVudCBkYXRhYmFzZSBjb25maWd1\ncmF0aW9uDQogICAgICogaW4gb3JkZXIgdG8gbWFrZSB0aGUgZGVjaXNpb246\nDQogICAgICogPHAvPg0KICAgICAqIDxjb2RlPiBwcm90ZWN0ZWQgYm9vbGVh\nbiBza2lwVGVzdCgpIHsNCiAgICAgKiAvLyBkb24ndCBydW4gd2l0aCBwb2lu\ndGJhc2U6IGl0IHVzZXMgYSBEYXRhU291cmNlLCB3aGljaA0KICAgICAqIC8v\nIGNhbid0IGJlIHRyYW5zbGF0ZWQgaW50byBhIEpCb3NzIERhdGFTb3VyY2Ug\nY29uZmlndXJhdGlvbi4NCiAgICAgKiBpZiAoInRlc3RKQm9zcyIuZXF1YWxz\nKGdldE5hbWUoKSkgJiYNCiAgICAgKiBnZXRDdXJyZW50UGxhdGZvcm0oKSA9\nPSBQTEFURk9STV9QT0lOVEJBU0UpDQogICAgICogcmV0dXJuIHRydWU7DQog\nICAgICogfQ0KICAgICAqIDwvY29kZT4NCiAgICAgKiBJZiB5b3Ugd2FudCB0\nbyBkaXNhYmxlIGV4ZWN1dGlvbiBvZiBhbiBlbnRpcmUgdGVzdCBjYXNlDQog\nICAgICogY2xhc3MgZm9yIGEgZ2l2ZW4gZGF0YWJhc2UsIHlvdSBtaWdodCB3\nYW50IHRvIGFkZCB0aGUgY2xhc3MgdG8NCiAgICAgKiB0aGUgZXhjbHVkZWQg\ndGVzdCBsaXN0IGluIHRoYXQgZGF0YWJhc2UncyBwcm9wZXJ0aWVzIGZpbGUu\nDQogICAgICovDQogICAgcHJvdGVjdGVkIGJvb2xlYW4gc2tpcFRlc3QoKSB7\nDQogICAgICAgIGlmIChURVNUX01FVEhPRFMgIT0gbnVsbCAmJiBURVNUX01F\nVEhPRFMubGVuZ3RoKCkgPiAwKQ0KICAgICAgICAgICAgcmV0dXJuIFRFU1Rf\nTUVUSE9EUy5pbmRleE9mKGdldE5hbWUoKSkgPT0gLTE7DQoNCiAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoaXMg\nbWV0aG9kIGlzIGNhbGxlZCBiZWZvcmUgdGhlIGZpcnN0IHRlc3QgaW4gdGhp\ncyB0ZXN0IGNsYXNzDQogICAgICogaXMgZXhlY3V0ZWQuDQogICAgICovDQog\nICAgcHVibGljIHZvaWQgc2V0VXBUZXN0Q2xhc3MoKSB0aHJvd3MgRXhjZXB0\naW9uIHsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBp\ncyBjYWxsZWQgYWZ0ZXIgdGhlIGxhc3QgdGVzdCBpbiB0aGlzIHRlc3QgY2xh\nc3MNCiAgICAgKiBpcyBleGVjdXRlZC4gSXQgY2FuIGJlIHVzZWQgdG8gZG8g\ndGhpbmdzIGxpa2UgY2xlYW4gdXANCiAgICAgKiBsYXJnZSwgc2xvdyBwcm9j\nZXNzZXMgdGhhdCBtYXkgaGF2ZSBiZWVuIHN0YXJ0ZWQuDQogICAgICovDQog\nICAgcHVibGljIHZvaWQgdGVhckRvd25UZXN0Q2xhc3MoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigp\nIHRocm93cyBFeGNlcHRpb24gew0KICAgICAgICBpZiAoInRydWUiLmVxdWFs\ncyhTeXN0ZW0uZ2V0UHJvcGVydHkoIm1lbWluZm8iKSkpDQogICAgICAgICAg\nICBwcmludE1lbW9yeUluZm8oKTsNCg0KICAgICAgICBzdXBlci50ZWFyRG93\nbigpOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nDQogICAgLy8gR2VuZXJhdGluZyByYW5kb20gZGF0YQ0KICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvKioNCiAgICAgKiBTdXBwb3J0\nIG1ldGhvZCB0byBnZXQgYSByYW5kb20gSW50ZWdlciBmb3IgdGVzdGluZy4N\nCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIEludGVnZXIgcmFuZG9tSW50\nKCkgew0KICAgICAgICByZXR1cm4gbmV3IEludGVnZXIoKGludCkgKE1hdGgu\ncmFuZG9tKCkgKiBJbnRlZ2VyLk1BWF9WQUxVRSkpOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBD\naGFyYWN0ZXIgZm9yIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGljIHN0\nYXRpYyBDaGFyYWN0ZXIgcmFuZG9tQ2hhcigpIHsNCiAgICAgICAgY2hhciBb\nXSBURVNUX0NIQVJfQVJSQVkgPSBuZXcgY2hhciBbXXsNCiAgICAgICAgICAg\nICdhJywgJ2InLCAnYycsICdkJywgJ2UnLCAnZicsICdnJywgJ2gnLCAnaScs\nDQogICAgICAgICAgICAnaicsICdrJywgJ2wnLCAnbScsICduJywgJ28nLCAn\ncCcsICdxJywgJ3InLA0KICAgICAgICAgICAgJ3MnLCAndCcsICd1JywgJ3Yn\nLCAndycsICd4JywgJ3knLCAneicsICcxJywNCiAgICAgICAgICAgICcyJywg\nJzMnLCAnNCcsICc1JywgJzYnLCAnNycsICc4JywgJzknIH07DQoNCiAgICAg\nICAgcmV0dXJuIG5ldyBDaGFyYWN0ZXIoVEVTVF9DSEFSX0FSUkFZWw0KICAg\nICAgICAgICAgKGludCkgKE1hdGgucmFuZG9tKCkgKiBURVNUX0NIQVJfQVJS\nQVkubGVuZ3RoKV0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFN1cHBv\ncnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBMb25nIGZvciB0ZXN0aW5nLg0K\nICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgTG9uZyByYW5kb21Mb25nKCkg\new0KICAgICAgICByZXR1cm4gbmV3IExvbmcoKGxvbmcpIChNYXRoLnJhbmRv\nbSgpICogTG9uZy5NQVhfVkFMVUUpKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQgYSByYW5kb20gU2hvcnQgZm9y\nIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBTaG9ydCBy\nYW5kb21TaG9ydCgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBTaG9ydCgoc2hv\ncnQpIChNYXRoLnJhbmRvbSgpICogU2hvcnQuTUFYX1ZBTFVFKSk7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEg\ncmFuZG9tIERvdWJsZSBmb3IgdGVzdGluZy4NCiAgICAgKi8NCiAgICBwdWJs\naWMgc3RhdGljIERvdWJsZSByYW5kb21Eb3VibGUoKSB7DQogICAgICAgIHJl\ndHVybiBuZXcgRG91YmxlKChkb3VibGUpIChNYXRoLnJvdW5kKE1hdGgucmFu\nZG9tKCkgKiA1MDAwZCkpIC8gMTAwMGQpOw0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBGbG9hdCBm\nb3IgdGVzdGluZy4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIEZsb2F0\nIHJhbmRvbUZsb2F0KCkgew0KICAgICAgICByZXR1cm4gbmV3IEZsb2F0KChm\nbG9hdCkgKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDUwMDBmKSkgLyAx\nMDAwZik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRo\nb2QgdG8gZ2V0IGEgcmFuZG9tIEJ5dGUgZm9yIHRlc3RpbmcuDQogICAgICov\nDQogICAgcHVibGljIHN0YXRpYyBCeXRlIHJhbmRvbUJ5dGUoKSB7DQogICAg\nICAgIHJldHVybiBuZXcgQnl0ZSgoYnl0ZSkgKE1hdGgucmFuZG9tKCkgKiBC\neXRlLk1BWF9WQUxVRSkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFN1\ncHBvcnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBCb29sZWFuIGZvciB0ZXN0\naW5nLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgQm9vbGVhbiByYW5k\nb21Cb29sZWFuKCkgew0KICAgICAgICByZXR1cm4gbmV3IEJvb2xlYW4oTWF0\naC5yYW5kb20oKSA+IDAuNSA/IHRydWUgOiBmYWxzZSk7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9t\nIERhdGUgZm9yIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGljIHN0YXRp\nYyBEYXRlIHJhbmRvbURhdGUoKSB7DQogICAgICAgIGxvbmcgbWlsbGlzID0g\nKGxvbmcpIChNYXRoLnJhbmRvbSgpICogU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkpOw0KDQogICAgICAgIC8vIHJvdW5kIG1pbGxpcyB0byB0aGUgbmVh\ncmVzdCAxMDAwOiB0aGlzIGlzIGJlY2F1c2Ugc29tZQ0KICAgICAgICAvLyBk\nYXRhYmFzZXMgZG8gbm90IHN0b3JlIHRoZSBtaWxsaXNlY29uZHMgY29ycmVj\ndGx5KGUuZy4sIE15U1FMKS4NCiAgICAgICAgLy8gVGhpcyBpcyBhIHJlYWxs\neSBhIGJ1ZyB3ZSBzaG91bGQgZml4LiBGQyAjMjcuDQogICAgICAgIG1pbGxp\ncyAtPSAobWlsbGlzICUgMTAwMCk7DQoNCiAgICAgICAgcmV0dXJuIG5ldyBE\nYXRlKG1pbGxpcyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU3VwcG9y\ndCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9tIFN0cmluZyBmb3IgdGVzdGluZy4N\nCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyByYW5kb21TdHJp\nbmcoKSB7DQogICAgICAgIC8vIGRlZmF1bHQgdG8gYSBzbWFsbCBzdHJpbmcs\nIGluIGNhc2UgY29sdW1uIHNpemVzIGFyZQ0KICAgICAgICAvLyBsaW1pdGVk\nKHN1Y2ggYXMgd2l0aCBhIHN0cmluZyBwcmltYXJ5IGtleSkNCiAgICAgICAg\ncmV0dXJuIHJhbmRvbVN0cmluZyg1MCk7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9tIFN0cmluZyBm\nb3IgdGVzdGluZy4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIFN0cmlu\nZyByYW5kb21TdHJpbmcoaW50IGxlbikgew0KICAgICAgICBTdHJpbmdCdWZm\nZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOw0KICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IChpbnQpIChNYXRoLnJhbmRvbSgpICogbGVuKSArIDE7\nIGkrKykNCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQocmFuZG9tQ2hhcigpKTsN\nCiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOw0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBj\nbG9iIGZvciB0ZXN0aW5nLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMg\nU3RyaW5nIHJhbmRvbUNsb2IoKSB7DQogICAgICAgIFN0cmluZ0J1ZmZlciBz\nYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOw0KICAgICAgICB3aGlsZSAoc2J1\nZi5sZW5ndGgoKSA8ICg1ICogMTAyNCkpIHsgLy8gYXQgbGVhc3QgNUsNCiAg\nICAgICAgICAgIHNidWYuYXBwZW5kKHJhbmRvbVN0cmluZygxMDI0KSk7DQog\nICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc2J1Zi50b1N0cmluZygpOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdl\ndCBhIHJhbmRvbSBCaWdJbnRlZ2VyIGZvciB0ZXN0aW5nLg0KICAgICAqLw0K\nICAgIHB1YmxpYyBzdGF0aWMgQmlnSW50ZWdlciByYW5kb21CaWdJbnRlZ2Vy\nKCkgew0KICAgICAgICAvLyB0b28gbWFueSBvZiBvdXIgdGVzdCBkYXRhYmFz\nZXMgZG9uJ3Qgc3VwcG9ydCBiaWdpbnRzID4gTUFYX0xPTkc6DQogICAgICAg\nIC8vIEkgZG9uJ3QgbGlrZSBpdCwgYnV0IGZvciBub3csIGxldCdzIG9ubHkg\ndGVzdCBiZWxvdyBNQVhfTE9ORw0KICAgICAgICBCaWdJbnRlZ2VyIGxuZyA9\nIG5ldyBCaWdJbnRlZ2VyKA0KICAgICAgICAgICAgKChsb25nKSAoTWF0aC5y\nYW5kb20oKSAqIExvbmcuTUFYX1ZBTFVFKSkgKyAiIik7DQoNCiAgICAgICAg\nQmlnSW50ZWdlciBtdWx0aXBsaWVyID0gbmV3IEJpZ0ludGVnZXIoIjEiKTsN\nCiAgICAgICAgLy8gKDEgKyAoaW50KShNYXRoLnJhbmRvbSgpICogMTAwMDAp\nKSArICIiKTsNCiAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUpDQog\nICAgICAgICAgICBtdWx0aXBsaWVyID0gbXVsdGlwbGllci5tdWx0aXBseShu\nZXcgQmlnSW50ZWdlcigiLTEiKSk7DQoNCiAgICAgICAgcmV0dXJuIGxuZy5t\ndWx0aXBseShtdWx0aXBsaWVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQgYSByYW5kb20gQmlnRGVjaW1hbCBm\nb3IgdGVzdGluZy4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIEJpZ0Rl\nY2ltYWwgcmFuZG9tQmlnRGVjaW1hbCgpIHsNCiAgICAgICAgQmlnSW50ZWdl\nciBzdGFydCA9IHJhbmRvbUJpZ0ludGVnZXIoKTsNCiAgICAgICAgU3RyaW5n\nIHN0ciA9IHN0YXJ0LnRvU3RyaW5nKCk7DQogICAgICAgIC8vIHRydW5jYXRl\nIG9mZiB0aGUgbGFzdCA4IGRpZ2l0czogd2Ugc3RpbGwgZ2V0IHNvbWUNCiAg\nICAgICAgLy8gb3ZlcmZsb3dzIHdpdGggbGFtZSBkYXRhYmFzZXMuDQogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgODsgaSsrKQ0KICAgICAgICAgICAg\naWYgKHN0ci5sZW5ndGgoKSA+IDIpDQogICAgICAgICAgICAgICAgc3RyID0g\nc3RyLnN1YnN0cmluZygwLCBzdHIubGVuZ3RoKCkgLSAxKTsNCiAgICAgICAg\nc3RhcnQgPSBuZXcgQmlnSW50ZWdlcihzdHIpOw0KDQogICAgICAgIFN0cmlu\nZyB2YWwgPSBzdGFydCArICIuIiArICgoaW50KSAoTWF0aC5yYW5kb20oKSAq\nIDEwKSkNCiAgICAgICAgICAgICsgKChpbnQpIChNYXRoLnJhbmRvbSgpICog\nMTApKQ0KICAgICAgICAgICAgKyAoKGludCkgKE1hdGgucmFuZG9tKCkgKiAx\nMCkpDQogICAgICAgICAgICArICgoaW50KSAoTWF0aC5yYW5kb20oKSAqIDEw\nKSkNCiAgICAgICAgICAgICsgKChpbnQpIChNYXRoLnJhbmRvbSgpICogMTAp\nKQ0KICAgICAgICAgICAgKyAoKGludCkgKE1hdGgucmFuZG9tKCkgKiAxMCkp\nDQogICAgICAgICAgICArICgoaW50KSAoTWF0aC5yYW5kb20oKSAqIDEwKSkN\nCiAgICAgICAgICAgICsgKChpbnQpIChNYXRoLnJhbmRvbSgpICogMTApKQ0K\nICAgICAgICAgICAgKyAoKGludCkgKE1hdGgucmFuZG9tKCkgKiAxMCkpDQog\nICAgICAgICAgICArICgoaW50KSAoTWF0aC5yYW5kb20oKSAqIDEwKSk7DQoN\nCiAgICAgICAgcmV0dXJuIG5ldyBCaWdEZWNpbWFsKHZhbCk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFu\nZG9tIGJsb2IgZm9yIHRlc3RpbmcuDQogICAgICovDQogICAgcHVibGljIHN0\nYXRpYyBieXRlW10gcmFuZG9tQmxvYigpIHsNCiAgICAgICAgLy8gdXAgdG8g\nMTAwSyBibG9iDQogICAgICAgIGJ5dGUgW10gYmxvYiA9IG5ldyBieXRlIFso\naW50KSAoTWF0aC5yYW5kb20oKSAqIDEwMjQgKiAxMDApXTsNCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBibG9iLmxlbmd0aDsgaSsrKQ0KICAgICAg\nICAgICAgYmxvYltpXSA9IHJhbmRvbUJ5dGUoKS5ieXRlVmFsdWUoKTsNCg0K\nICAgICAgICByZXR1cm4gYmxvYjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAg\nKiBJbnZva2Ugc2V0dGVycyBmb3IgcGltaXRpdmVzIGFuZCBwcmltaXRpdmUg\nd3JhcHBlcnMgb24gdGhlDQogICAgICogc3BlY2lmaWVkIG9iamVjdC4NCiAg\nICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCByYW5kb21pemVCZWFu\nKE9iamVjdCBiZWFuKQ0KICAgICAgICB0aHJvd3MgSW50cm9zcGVjdGlvbkV4\nY2VwdGlvbiwgSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbiwNCiAgICAgICAgSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbiB7DQogICAgICAgIEJlYW5JbmZvIGlu\nZm8gPSBJbnRyb3NwZWN0b3IuZ2V0QmVhbkluZm8oYmVhbi5nZXRDbGFzcygp\nKTsNCiAgICAgICAgUHJvcGVydHlEZXNjcmlwdG9yIFtdIHByb3BzID0gaW5m\nby5nZXRQcm9wZXJ0eURlc2NyaXB0b3JzKCk7DQogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAg\nIE1ldGhvZCB3cml0ZSA9IHByb3BzW2ldLmdldFdyaXRlTWV0aG9kKCk7DQog\nICAgICAgICAgICBpZiAod3JpdGUgPT0gbnVsbCkNCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsNCg0KICAgICAgICAgICAgQ2xhc3MgW10gcGFyYW1zID0g\nd3JpdGUuZ2V0UGFyYW1ldGVyVHlwZXMoKTsNCiAgICAgICAgICAgIGlmIChw\nYXJhbXMgPT0gbnVsbCB8fCBwYXJhbXMubGVuZ3RoICE9IDEpDQogICAgICAg\nICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAgICAgIENsYXNzIHBhcmFt\nVHlwZSA9IHBhcmFtc1swXTsNCiAgICAgICAgICAgIE9iamVjdCBhcmcgPSBu\ndWxsOw0KDQogICAgICAgICAgICBpZiAocGFyYW1UeXBlID09IGJvb2xlYW4u\nY2xhc3MgfHwgcGFyYW1UeXBlID09IEJvb2xlYW4uY2xhc3MpDQogICAgICAg\nICAgICAgICAgYXJnID0gcmFuZG9tQm9vbGVhbigpOw0KICAgICAgICAgICAg\nZWxzZSBpZiAocGFyYW1UeXBlID09IGJ5dGUuY2xhc3MgfHwgcGFyYW1UeXBl\nID09IEJ5dGUuY2xhc3MpDQogICAgICAgICAgICAgICAgYXJnID0gcmFuZG9t\nQnl0ZSgpOw0KICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1UeXBlID09IGNo\nYXIuY2xhc3MgfHwgcGFyYW1UeXBlID09IENoYXJhY3Rlci5jbGFzcykNCiAg\nICAgICAgICAgICAgICBhcmcgPSByYW5kb21DaGFyKCk7DQogICAgICAgICAg\nICBlbHNlIGlmIChwYXJhbVR5cGUgPT0gc2hvcnQuY2xhc3MgfHwgcGFyYW1U\neXBlID09IFNob3J0LmNsYXNzKQ0KICAgICAgICAgICAgICAgIGFyZyA9IHJh\nbmRvbVNob3J0KCk7DQogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUg\nPT0gaW50LmNsYXNzIHx8IHBhcmFtVHlwZSA9PSBJbnRlZ2VyLmNsYXNzKQ0K\nICAgICAgICAgICAgICAgIGFyZyA9IHJhbmRvbUludCgpOw0KICAgICAgICAg\nICAgZWxzZSBpZiAocGFyYW1UeXBlID09IGxvbmcuY2xhc3MgfHwgcGFyYW1U\neXBlID09IExvbmcuY2xhc3MpDQogICAgICAgICAgICAgICAgYXJnID0gcmFu\nZG9tTG9uZygpOw0KICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1UeXBlID09\nIGRvdWJsZS5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gRG91YmxlLmNsYXNzKQ0K\nICAgICAgICAgICAgICAgIGFyZyA9IHJhbmRvbURvdWJsZSgpOw0KICAgICAg\nICAgICAgZWxzZSBpZiAocGFyYW1UeXBlID09IGZsb2F0LmNsYXNzIHx8IHBh\ncmFtVHlwZSA9PSBGbG9hdC5jbGFzcykNCiAgICAgICAgICAgICAgICBhcmcg\nPSByYW5kb21GbG9hdCgpOw0KICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1U\neXBlID09IFN0cmluZy5jbGFzcykNCiAgICAgICAgICAgICAgICBhcmcgPSBy\nYW5kb21TdHJpbmcoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtVHlw\nZSA9PSBCaWdJbnRlZ2VyLmNsYXNzKQ0KICAgICAgICAgICAgICAgIGFyZyA9\nIHJhbmRvbUJpZ0ludGVnZXIoKTsNCiAgICAgICAgICAgIGVsc2UgaWYgKHBh\ncmFtVHlwZSA9PSBCaWdEZWNpbWFsLmNsYXNzKQ0KICAgICAgICAgICAgICAg\nIGFyZyA9IHJhbmRvbUJpZ0RlY2ltYWwoKTsNCiAgICAgICAgICAgIGVsc2Ug\naWYgKHBhcmFtVHlwZSA9PSBEYXRlLmNsYXNzKQ0KICAgICAgICAgICAgICAg\nIGFyZyA9IHJhbmRvbURhdGUoKTsNCg0KICAgICAgICAgICAgaWYgKGFyZyAh\nPSBudWxsKQ0KICAgICAgICAgICAgICAgIHdyaXRlLmludm9rZShiZWFuLCBu\nZXcgT2JqZWN0IFtdeyBhcmcgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBy\nZXR1cm4gYmVhbjsNCiAgICB9DQoNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nDQogICAgLy8gTXVsdGkgdGhyZWFkaW5nDQogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLw0KDQogICAgLyoqDQogICAgICogUmUtZXhlY3V0ZSB0aGUgaW52b2tp\nbmcgbWV0aG9kIGEgcmFuZG9tIG51bWJlciBvZiB0aW1lcw0KICAgICAqIGlu\nIGEgcmFuZG9tIG51bWJlciBvZiBUaHJlYWRzLg0KICAgICAqLw0KICAgIHB1\nYmxpYyB2b2lkIG10dGVzdCgpIHRocm93cyBUaHJlYWRpbmdFeGNlcHRpb24g\new0KICAgICAgICAvLyA2IGl0ZXJhdGlvbnMgaW4gOCB0aHJlYWRzIGlzIGEg\nZ29vZCB0cmFkZS1vZmYgYmV0d2Vlbg0KICAgICAgICAvLyB0ZXN0cyB0YWtp\nbmcgd2F5IHRvbyBsb25nIGFuZCBoYXZpbmcgYSBkZWNlbnQgY2hhbmNlIG9m\nDQogICAgICAgIC8vIGlkZW50aWZ5aW5nIE1UIHByb2JsZW1zLg0KICAgICAg\nICBpbnQgaXRlcmF0aW9ucyA9IDY7DQogICAgICAgIGludCB0aHJlYWRzID0g\nODsNCg0KICAgICAgICBtdHRlc3QodGhyZWFkcywgaXRlcmF0aW9ucyk7DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogRXhlY3V0ZSB0aGUgY2FsbGluZyBt\nZXRob2QgPGNvZGU+aXRlcmF0aW9uczwvY29kZT4NCiAgICAgKiB0aW1lcyBp\nbiA8Y29kZT50aHJlYWRzPC9jb2RlPiBUaHJlYWRzLg0KICAgICAqLw0KICAg\nIHB1YmxpYyB2b2lkIG10dGVzdChpbnQgdGhyZWFkcywgaW50IGl0ZXJhdGlv\nbnMpIHsNCiAgICAgICAgbXR0ZXN0KDAsIHRocmVhZHMsIGl0ZXJhdGlvbnMp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIG10dGVzdChpbnQgc2VyaWFs\nQ291bnQsIGludCB0aHJlYWRzLCBpbnQgaXRlcmF0aW9ucykNCiAgICAgICAg\ndGhyb3dzIFRocmVhZGluZ0V4Y2VwdGlvbiB7DQogICAgICAgIFN0cmluZyBt\nZXRob2ROYW1lID0gY2FsbGluZ01ldGhvZCgibXR0ZXN0Iik7DQogICAgICAg\nIG10dGVzdChzZXJpYWxDb3VudCwgdGhyZWFkcywgaXRlcmF0aW9ucywgbWV0\naG9kTmFtZSwgbmV3IE9iamVjdCBbMF0pOw0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIEV4ZWN1dGUgYSB0ZXN0IG1ldGhvZCBpbiBtdWx0aXBsZSB0aHJl\nYWRzLg0KICAgICAqDQogICAgICogQHBhcmFtIHRocmVhZHMgdGhlIG51bWJl\nciBvZiBUaHJlYWRzIHRvIHJ1biBpbg0KICAgICAqIEBwYXJhbSBpdGVyYXRp\nb25zIHRoZSBudW1iZXIgb2YgdGltZXMgdGhlIG1ldGhvZCBzaG91bGQNCiAg\nICAgKiBiZSBleGVjdXRlIGluIGEgc2luZ2xlIFRocmVhZA0KICAgICAqIEBw\nYXJhbSBtZXRob2QgdGhlIG5hbWUgb2YgdGhlIG1ldGhvZCB0byBleGVjdXRl\nDQogICAgICogQHBhcmFtIGFyZ3MgdGhlIGFyZ3VtZW50cyB0byBwYXNzIHRv\nIHRoZSBtZXRob2QNCiAgICAgKiBAdGhyb3dzIFRocmVhZGluZ0V4Y2VwdGlv\nbiBpZiBhbiBlcnJvcnMgb2NjdXIgaW4NCiAgICAgKiBhbnkgb2YgdGhlIFRo\ncmVhZHMuIFRoZSBhY3R1YWwgZXhjZXB0aW9ucw0KICAgICAqIHdpbGwgYmUg\nZW1iZWRkZWQgaW4gdGhlIGV4Y2VwdGlvbi4gTm90ZSB0aGF0DQogICAgICog\ndGhpcyBtZWFucyB0aGF0IGFzc2VydCgpIGZhaWx1cmVzIHdpbGwgYmUNCiAg\nICAgKiB0cmVhdGVkIGFzIGVycm9ycyByYXRoZXIgdGhhbiB3YXJuaW5ncy4N\nCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eA0KICAgICAqLw0K\nICAgIHB1YmxpYyB2b2lkIG10dGVzdChpbnQgdGhyZWFkcywgaW50IGl0ZXJh\ndGlvbnMsIGZpbmFsIFN0cmluZyBtZXRob2QsDQogICAgICAgIGZpbmFsIE9i\namVjdCBbXSBhcmdzKSB0aHJvd3MgVGhyZWFkaW5nRXhjZXB0aW9uIHsNCiAg\nICAgICAgbXR0ZXN0KDAsIHRocmVhZHMsIGl0ZXJhdGlvbnMsIG1ldGhvZCwg\nYXJncyk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgbXR0ZXN0KGludCBz\nZXJpYWxDb3VudCwNCiAgICAgICAgaW50IHRocmVhZHMsIGludCBpdGVyYXRp\nb25zLCBmaW5hbCBTdHJpbmcgbWV0aG9kLCBmaW5hbCBPYmplY3QgW10gYXJn\ncykNCiAgICAgICAgdGhyb3dzIFRocmVhZGluZ0V4Y2VwdGlvbiB7DQogICAg\nICAgIGlmIChtdWx0aVRocmVhZEV4ZWN1dGluZyAhPSBudWxsICYmIG11bHRp\nVGhyZWFkRXhlY3V0aW5nLmVxdWFscyhtZXRob2QpKQ0KICAgICAgICB7DQog\nICAgICAgICAgICAvLyB3ZSBhcmUgY3VycmVudGx5IGV4ZWN1dGluZyBpbiBt\ndWx0aS10aHJlYWRlZCBtb2RlOg0KICAgICAgICAgICAgLy8gZG9uJ3QgZGVh\nZGxvY2shDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAg\nICAgICBtdWx0aVRocmVhZEV4ZWN1dGluZyA9IG1ldGhvZDsNCg0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgQ2xhc3MgW10gcGFyYW1DbGFzc2VzID0g\nbmV3IENsYXNzIFthcmdzLmxlbmd0aF07DQogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHBhcmFtQ2xhc3Nlcy5sZW5ndGg7IGkrKykNCiAgICAg\nICAgICAgICAgICBwYXJhbUNsYXNzZXNbaV0gPSBhcmdzW2ldLmdldENsYXNz\nKCk7DQoNCiAgICAgICAgICAgIGZpbmFsIE1ldGhvZCBtZXRoOw0KDQogICAg\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIG1ldGggPSBnZXRDbGFz\ncygpLmdldE1ldGhvZChtZXRob2QsIHBhcmFtQ2xhc3Nlcyk7DQogICAgICAg\nICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgew0K\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBUaHJlYWRpbmdFeGNlcHRpb24o\nbnNtZS50b1N0cmluZygpLCBuc21lKTsNCiAgICAgICAgICAgIH0NCg0KICAg\nICAgICAgICAgZmluYWwgT2JqZWN0IHRoaXogPSB0aGlzOw0KDQogICAgICAg\nICAgICBtdHRlc3QoInJlZmxlY3Rpb24gaW52b2NhdGlvbjogKCIgKyBtZXRo\nb2QgKyAiKSIsDQogICAgICAgICAgICAgICAgc2VyaWFsQ291bnQsIHRocmVh\nZHMsIGl0ZXJhdGlvbnMsIG5ldyBWb2xhdGlsZVJ1bm5hYmxlKCkgew0KICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHRocm93cyBFeGNlcHRp\nb24gew0KICAgICAgICAgICAgICAgICAgICBtZXRoLmludm9rZSh0aGl6LCBh\ncmdzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAg\nICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIG11bHRpVGhyZWFkRXhl\nY3V0aW5nID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIG10dGVzdChTdHJpbmcgdGl0bGUsIGZpbmFsIGludCB0aHJlYWRz\nLCBmaW5hbCBpbnQgaXRlcmF0aW9ucywNCiAgICAgICAgZmluYWwgVm9sYXRp\nbGVSdW5uYWJsZSBydW5uZXIpIHRocm93cyBUaHJlYWRpbmdFeGNlcHRpb24g\new0KICAgICAgICBtdHRlc3QodGl0bGUsIDAsIHRocmVhZHMsIGl0ZXJhdGlv\nbnMsIHJ1bm5lcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRXhlY3V0\nZSBhIHRlc3QgbWV0aG9kIGluIG11bHRpcGxlIHRocmVhZHMuDQogICAgICoN\nCiAgICAgKiBAcGFyYW0gdGl0bGUgYSBkZXNjcmlwdGlvbiBvZiB0aGUgdGVz\ndCwgZm9yIGluY2x1c2lvbiBpbiB0aGUNCiAgICAgKiBlcnJvciBtZXNzYWdl\nDQogICAgICogQHBhcmFtIHNlcmlhbENvdW50IHRoZSBudW1iZXIgb2YgdGlt\nZXMgdG8gcnVuIHRoZSBtZXRob2QNCiAgICAgKiBzZXJpYWxseSBiZWZvcmUg\nc3Bhd25pbmcgdGhyZWFkcy4NCiAgICAgKiBAcGFyYW0gdGhyZWFkcyB0aGUg\nbnVtYmVyIG9mIFRocmVhZHMgdG8gcnVuIGluDQogICAgICogQHBhcmFtIGl0\nZXJhdGlvbnMgdGhlIG51bWJlciBvZiB0aW1lcyB0aGUgbWV0aG9kIHNob3Vs\nZA0KICAgICAqIEBwYXJhbSBydW5uZXIgdGhlIFZvbGF0aWxlUnVubmFibGUg\ndGhhdCB3aWxsIGV4ZWN1dGUNCiAgICAgKiB0aGUgYWN0dWFsIHRlc3QgZnJv\nbSB3aXRoaW4gdGhlIFRocmVhZC4NCiAgICAgKiBAdGhyb3dzIFRocmVhZGlu\nZ0V4Y2VwdGlvbiBpZiBhbiBlcnJvcnMgb2NjdXIgaW4NCiAgICAgKiBhbnkg\nb2YgdGhlIFRocmVhZHMuIFRoZSBhY3R1YWwgZXhjZXB0aW9ucw0KICAgICAq\nIHdpbGwgYmUgZW1iZWRkZWQgaW4gdGhlIGV4Y2VwdGlvbi4gTm90ZSB0aGF0\nDQogICAgICogdGhpcyBtZWFucyB0aGF0IGFzc2VydCgpIGZhaWx1cmVzIHdp\nbGwgYmUNCiAgICAgKiB0cmVhdGVkIGFzIGVycm9ycyByYXRoZXIgdGhhbiB3\nYXJuaW5ncy4NCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21tZWF1eCBi\nZSBleGVjdXRlIGluIGEgc2luZ2xlIFRocmVhZA0KICAgICAqIEBhdXRob3Ig\nTWFyYyBQcnVkJ2hvbW1lYXV4DQogICAgICovDQogICAgcHVibGljIHZvaWQg\nbXR0ZXN0KFN0cmluZyB0aXRsZSwgZmluYWwgaW50IHNlcmlhbENvdW50LA0K\nICAgICAgICBmaW5hbCBpbnQgdGhyZWFkcywgZmluYWwgaW50IGl0ZXJhdGlv\nbnMsIGZpbmFsIFZvbGF0aWxlUnVubmFibGUgcnVubmVyKQ0KICAgICAgICB0\naHJvd3MgVGhyZWFkaW5nRXhjZXB0aW9uIHsNCiAgICAgICAgZmluYWwgTGlz\ndCBleGNlcHRpb25zID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTGlzdChu\nZXcgTGlua2VkTGlzdCgpKTsNCg0KICAgICAgICBUaHJlYWQgW10gcnVubmVy\ncyA9IG5ldyBUaHJlYWQgW3RocmVhZHNdOw0KDQogICAgICAgIGZpbmFsIGxv\nbmcgc3RhcnRNaWxsaXMgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAr\nIDEwMDA7DQoNCiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPD0gdGhyZWFk\nczsgaSsrKSB7DQogICAgICAgICAgICBmaW5hbCBpbnQgdGhpc1RocmVhZCA9\nIGk7DQoNCiAgICAgICAgICAgIHJ1bm5lcnNbaSAtIDFdID0NCiAgICAgICAg\nICAgICAgICBuZXcgVGhyZWFkKHRpdGxlICsgIiBbIiArIGkgKyAiIG9mICIg\nKyB0aHJlYWRzICsgIl0iKSB7DQogICAgICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHJ1bigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRv\nIG91ciBiZXN0IHRvIGhhdmUgYWxsIHRocmVhZHMgc3RhcnQgYXQgdGhlIGV4\nYWN0DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBzYW1lIHRpbWUuIFRo\naXMgaXMgaW1wZXJmZWN0LCBidXQgdGhlIGNsb3NlciB3ZQ0KICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gZ2V0IHRvIGV2ZXJ5b25lIHN0YXJ0aW5nIGF0\nIHRoZSBzYW1lIHRpbWUsIHRoZQ0KICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gYmV0dGVyIGNoYW5jZSB3ZSBoYXZlIGZvciBpZGVudGlmeWluZyBNVCBw\ncm9ibGVtcy4NCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKSA8IHN0YXJ0TWlsbGlzKQ0KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHlpZWxkKCk7DQoNCiAgICAgICAgICAg\nICAgICAgICAgICAgIGludCB0aGlzSXRlcmF0aW9uID0gMTsNCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZm9yICg7IHRoaXNJdGVyYXRpb24gPD0gaXRlcmF0aW9uczsgdGhp\nc0l0ZXJhdGlvbisrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsN\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ28gZ28gZ28h\nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bm5lci5ydW4o\nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZXJyb3IpIHsNCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGV4Y2Vw\ndGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nZW1iZWQgdGhlIGV4Y2VwdGlvbiBpbnRvIHNvbWV0aGluZyB0aGF0IGdpdmVz\nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzIHNvbWUg\nbW9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGhyZWFkaW5nDQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVudmlyb25tZW50DQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbnMuYWRkKG5l\ndyBUaHJlYWRpbmdFeGNlcHRpb24oInRocmVhZD0iDQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIHRoaXMudG9TdHJpbmcoKQ0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiO3RocmVhZE51\nbT0iICsgdGhpc1RocmVhZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiO21heFRocmVhZHM9IiArIHRocmVhZHMNCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIjtpdGVyYXRpb249IiAr\nIHRoaXNJdGVyYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIjttYXhJdGVyYXRpb25zPSIgKyBpdGVyYXRpb25zLCBlcnJv\ncikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAg\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAg\nICAgICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICAvLyBzdGFy\ndCB0aGUgc2VyaWFsIHRlc3RzKGRvZXMgbm90IHNwYXduIHRoZSB0aHJlYWRz\nKQ0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcmlhbENvdW50OyBp\nKyspIHsNCiAgICAgICAgICAgIHJ1bm5lcnNbMF0ucnVuKCk7DQogICAgICAg\nIH0NCg0KICAgICAgICAvLyBzdGFydCB0aGUgbXVsdGl0aHJlYWRlZA0KICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRocmVhZHM7IGkrKykgew0KICAg\nICAgICAgICAgcnVubmVyc1tpXS5zdGFydCgpOw0KICAgICAgICB9DQoNCiAg\nICAgICAgLy8gd2FpdCBmb3IgdGhlbSBhbGwgdG8gY29tcGxldGUNCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0aHJlYWRzOyBpKyspIHsNCiAgICAg\nICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcnVubmVyc1tpXS5qb2lu\nKCk7DQogICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiBlKSB7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBp\nZiAoZXhjZXB0aW9ucy5zaXplKCkgPT0gMCkNCiAgICAgICAgICAgIHJldHVy\nbjsgLy8gc3dlZWVlZWVlZXQ6IG5vIGVycm9ycw0KDQogICAgICAgIC8vIGVt\nYmVkIGFsbCB0aGUgZXhjZXB0aW9ucyB0aGF0IHdlcmUgdGhyb3dzIGludG8g\nYQ0KICAgICAgICAvLyBUaHJlYWRpbmdFeGNlcHRpb24NCiAgICAgICAgVGhy\nb3dhYmxlIFtdIGVycm9ycyA9IChUaHJvd2FibGUgW10pIGV4Y2VwdGlvbnMu\ndG9BcnJheSgNCiAgICAgICAgICAgIG5ldyBUaHJvd2FibGUgWzBdKTsNCiAg\nICAgICAgdGhyb3cgbmV3IFRocmVhZGluZ0V4Y2VwdGlvbigiVGhlICINCiAg\nICAgICAgICAgICsgZXJyb3JzLmxlbmd0aCArICIgZW1iZWRkZWQgZXJyb3Jz\nICINCiAgICAgICAgICAgICsgIm9jY3VyZWQgaW4gdGhlIGV4ZWN1dGlvbiBv\nZiAiICsgaXRlcmF0aW9ucyArICIgaXRlcmF0aW9ucyAiDQogICAgICAgICAg\nICArICJvZiAiICsgdGhyZWFkcyArICIgdGhyZWFkczogWyIgKyB0aXRsZSAr\nICJdIiwgZXJyb3JzKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVj\nayB0byBzZWUgaWYgd2UgYXJlIGluIHRoZSB0b3AtbGV2ZWwgZXhlY3V0aW9u\nIHN0YWNrLg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIGlzUm9vdFRo\ncmVhZCgpIHsNCiAgICAgICAgcmV0dXJuIG11bHRpVGhyZWFkRXhlY3V0aW5n\nID09IG51bGw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIHRo\nZSBsYXN0IG1ldGhvZCBuYW1lIHRoYXQgY2FsbGVkIHRoaXMgb25lIGJ5DQog\nICAgICogcGFyc2luZyB0aGUgY3VycmVudCBzdGFjayB0cmFjZS4NCiAgICAg\nKg0KICAgICAqIEBwYXJhbSBleGNsdWRlIGEgbWV0aG9kIG5hbWUgdG8gc2tp\ncA0KICAgICAqIEB0aHJvd3MgSWxsZWdhbFN0YXRlRXhjZXB0aW9uIElmIHRo\nZSBjYWxsaW5nIG1ldGhvZCBjb3VsZCBub3QgYmUNCiAgICAgKiBpZGVudGlm\naWVkLg0KICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4DQogICAg\nICovDQogICAgcHVibGljIFN0cmluZyBjYWxsaW5nTWV0aG9kKFN0cmluZyBl\neGNsdWRlKSB7DQogICAgICAgIC8vIGRldGVybWluZSB0aGUgY3VycmVudGx5\nIGV4ZWN1dGluZyBtZXRob2QgYnkNCiAgICAgICAgLy8gbG9va2luZyBhdCB0\naGUgc3RhY2sgdHJhY2suIEhhY2tpc2gsIGJ1dCBjb252ZW5pZW50Lg0KICAg\nICAgICBTdHJpbmdXcml0ZXIgc3cgPSBuZXcgU3RyaW5nV3JpdGVyKCk7DQog\nICAgICAgIG5ldyBFeGNlcHRpb24oKS5wcmludFN0YWNrVHJhY2UobmV3IFBy\naW50V3JpdGVyKHN3KSk7DQogICAgICAgIGZvciAoU3RyaW5nVG9rZW5pemVy\nIHN0YWNrVHJhY2UgPSBuZXcgU3RyaW5nVG9rZW5pemVyKHN3LnRvU3RyaW5n\nKCksDQogICAgICAgICAgICBTeXN0ZW0uZ2V0UHJvcGVydHkoImxpbmUuc2Vw\nYXJhdG9yIikpOw0KICAgICAgICAgICAgc3RhY2tUcmFjZS5oYXNNb3JlVG9r\nZW5zKCk7KSB7DQogICAgICAgICAgICBTdHJpbmcgbGluZSA9IHN0YWNrVHJh\nY2UubmV4dFRva2VuKCkudHJpbSgpOw0KDQogICAgICAgICAgICAvLyBub3Qg\nYSBzdGFjayB0cmFjZSBlbGVtZW50DQogICAgICAgICAgICBpZiAoIShsaW5l\nLnN0YXJ0c1dpdGgoImF0ICIpKSkNCiAgICAgICAgICAgICAgICBjb250aW51\nZTsNCg0KICAgICAgICAgICAgU3RyaW5nIGZ1bGxNZXRob2ROYW1lID0gbGlu\nZS5zdWJzdHJpbmcoMCwgbGluZS5pbmRleE9mKCIoIikpOw0KDQogICAgICAg\nICAgICBTdHJpbmcgc2hvcnRNZXRob2ROYW1lID0gZnVsbE1ldGhvZE5hbWUu\nc3Vic3RyaW5nKA0KICAgICAgICAgICAgICAgIGZ1bGxNZXRob2ROYW1lLmxh\nc3RJbmRleE9mKCIuIikgKyAxKTsNCg0KICAgICAgICAgICAgLy8gc2tpcCBv\ndXIgb3duIG1ldGhvZHMhDQogICAgICAgICAgICBpZiAoc2hvcnRNZXRob2RO\nYW1lLmVxdWFscygiY2FsbGluZ01ldGhvZCIpKQ0KICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOw0KICAgICAgICAgICAgaWYgKGV4Y2x1ZGUgIT0gbnVsbCAm\nJiBzaG9ydE1ldGhvZE5hbWUuZXF1YWxzKGV4Y2x1ZGUpKQ0KICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOw0KDQogICAgICAgICAgICByZXR1cm4gc2hvcnRN\nZXRob2ROYW1lOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhyb3cgbmV3IEls\nbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQ291bGQgbm90IGlkZW50aWZ5IGNhbGxp\nbmcgIg0KICAgICAgICAgICAgKyAibWV0aG9kIGluIHN0YWNrIHRyYWNlIik7\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQSBSdW5uYWJsZSB0aGF0IGNh\nbiB0aHJvdyBhbiBFeGNlcHRpb246IHVzZWQgdG8gdGVzdCBjYXNlcy4NCiAg\nICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFjZSBWb2xhdGlsZVJ1\nbm5hYmxlIHsNCg0KICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB0aHJvd3Mg\nRXhjZXB0aW9uOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEV4Y2VwdGlv\nbiBmb3IgZXJyb3JzIGNhdWdodCBkdXJpbmcgdGhyZWFkaW5nIHRlc3RzLg0K\nICAgICAqLw0KICAgIHB1YmxpYyBjbGFzcyBUaHJlYWRpbmdFeGNlcHRpb24g\nZXh0ZW5kcyBSdW50aW1lRXhjZXB0aW9uIHsNCg0KICAgICAgICBwcml2YXRl\nIGZpbmFsIFRocm93YWJsZVtdIF9uZXN0ZWQ7DQoNCiAgICAgICAgcHVibGlj\nIFRocmVhZGluZ0V4Y2VwdGlvbihTdHJpbmcgbXNnLCBUaHJvd2FibGUgbmVz\ndGVkKSB7DQogICAgICAgICAgICBzdXBlcihtc2cpOw0KICAgICAgICAgICAg\naWYgKG5lc3RlZCA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIF9uZXN0ZWQg\nPSBuZXcgVGhyb3dhYmxlWzBdOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAg\nICAgICAgICAgIF9uZXN0ZWQgPSBuZXcgVGhyb3dhYmxlW117IG5lc3RlZCB9\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIFRocmVhZGluZ0V4Y2Vw\ndGlvbihTdHJpbmcgbXNnLCBUaHJvd2FibGVbXSBuZXN0ZWQpIHsNCiAgICAg\nICAgICAgIHN1cGVyKG1zZyk7DQogICAgICAgICAgICBpZiAobmVzdGVkID09\nIG51bGwpDQogICAgICAgICAgICAgICAgX25lc3RlZCA9IG5ldyBUaHJvd2Fi\nbGVbMF07DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgX25l\nc3RlZCA9IG5lc3RlZDsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2\nb2lkIHByaW50U3RhY2tUcmFjZSgpIHsNCiAgICAgICAgICAgIHByaW50U3Rh\nY2tUcmFjZShTeXN0ZW0ub3V0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1\nYmxpYyB2b2lkIHByaW50U3RhY2tUcmFjZShQcmludFN0cmVhbSBvdXQpIHsN\nCiAgICAgICAgICAgIHByaW50U3RhY2tUcmFjZShuZXcgUHJpbnRXcml0ZXIo\nb3V0KSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgdm9pZCBwcmlu\ndFN0YWNrVHJhY2UoUHJpbnRXcml0ZXIgb3V0KSB7DQogICAgICAgICAgICBz\ndXBlci5wcmludFN0YWNrVHJhY2Uob3V0KTsNCiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgX25lc3RlZC5sZW5ndGg7IGkrKykgew0KICAgICAg\nICAgICAgICAgIG91dC5wcmludCgiTmVzdGVkIFRocm93YWJsZSAjIiArIChp\nICsgMSkgKyAiOiAiKTsNCiAgICAgICAgICAgICAgICBfbmVzdGVkW2ldLnBy\naW50U3RhY2tUcmFjZShvdXQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgLy8vLy8vLy8vLw0KICAgIC8vIFRpbWluZw0KICAg\nIC8vLy8vLy8vLy8NCg0KICAgIC8qKg0KICAgICAqIFNsZWVwIHRoZSBjdXJy\nZW50IFRocmVhZCBmb3IgYSByYW5kb20gYW1vdW50IG9mIHRpbWUgZnJvbSAw\nLTEwMDAgbXMuDQogICAgICovDQogICAgcHVibGljIHZvaWQgc2xlZXBSYW5k\nb20oKSB7DQogICAgICAgIHNsZWVwUmFuZG9tKDEwMDApOw0KICAgIH0NCg0K\nICAgIC8qKg0KICAgICAqIFNsZWVwIHRoZSBjdXJyZW50IFRocmVhZCBmb3Ig\nYSByYW5kb20gYW1vdW50IG9mIHRpbWUgZnJvbQ0KICAgICAqIDAtPGNvZGU+\nbWF4PC9jb2RlPiBtcy4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBzbGVl\ncFJhbmRvbShpbnQgbWF4KSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAg\nICBUaHJlYWQuY3VycmVudFRocmVhZCgpLnNsZWVwKChsb25nKSAoTWF0aC5y\nYW5kb20oKSAqIG1heCkpOw0KICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBleCkgew0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogUmUtcnVuIHRoaXMgbWV0aG9kIGluIHRoZSBjdXJyZW50IHRo\ncmVhZCwgdGltaW5nIG91dA0KICAgICAqIGFmdGVyIHRoZSBzcGVjaWZpZWQg\nbnVtYmVyIG9mIHNlY29uZHMuDQogICAgICogVXNhZ2U6DQogICAgICogPHBy\nZT4gcHVibGljIHZvaWQgdGltZU91dE9wZXJhdGlvbigpIHsgaWYgKHRpbWVv\ndXQoNSAqIDEwMDApKSByZXR1cm47DQogICAgICogIFRocmVhZC5jdXJyZW50\nVGhyZWFkKCkuc2xlZXAoMTAgKiAxMDAwKTsgfQ0KICAgICAqIDwvcHJlPg0K\nICAgICAqIDxwLz4NCiAgICAgKiA8cC8+DQogICAgICogPHN0cm9uZz5XYXJu\naW5nPC9zdHJvbmc+IHRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIHNwYXJp\nbmdseSwNCiAgICAgKiBhbmQgb25seSB3aGVuIHlvdSBleHBlY3QgdGhhdCBh\nIHRpbWVvdXQgd2lsbCA8c3Ryb25nPm5vdDwvc3Ryb25nPg0KICAgICAqIG9j\nY3VyLiBJdCB1dGlsaXplZCB0aGUgZGVwcmVjYXRlZCB7QGxpbmsgVGhyZWFk\nI3N0b3AoKX0gYW5kDQogICAgICoge0BsaW5rIFRocmVhZCNpbnRlcnJ1cHR9\nIG1ldGhvZHMsIHdoaWNoIGNhbiBsZWF2ZSBtb25pdG9ycyBpbiBhbg0KICAg\nICAqIGludmFsaWQgc3RhdGUuIEl0IGlzIG9ubHkgdXNlZCBiZWNhdXNlIGl0\nIHByb3ZpZGVzIG1vcmUNCiAgICAgKiBtZWFuaW5nZnVsIGluZm9ybWF0aW9u\nIHRoYW4ganVzdCBzZWVpbmcgdGhhdCB0aGUgZW50aXJlIGF1dG9idWlsZA0K\nICAgICAqIHRpbWVkIG91dC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBtaWxs\naXMgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgd2Ugc2hvdWxkIHdhaXQu\nDQogICAgICogQHJldHVybiB0cnVlIGlmIHdlIGFyZSBhcmUgaW4gdGhlIHRo\ncmVhZCB0aGF0IHJlcXVlc3RlZCB0aGUNCiAgICAgKiAgICAgICAgIHRpbWVv\ndXQsIGZhbHNlIGlmIHdlIGFyZSBpbiB0aGUgdGltZW91dCB0aHJlYWQgaXRz\nZWxmLg0KICAgICAqLw0KICAgIHB1YmxpYyBib29sZWFuIHRpbWVvdXQobG9u\nZyBtaWxsaXMpIHRocm93cyBUaHJvd2FibGUgew0KICAgICAgICBTdHJpbmcg\nbWV0aG9kTmFtZSA9IGNhbGxpbmdNZXRob2QoInRpbWVvdXQiKTsNCiAgICAg\nICAgcmV0dXJuIHRpbWVvdXQobWlsbGlzLCBtZXRob2ROYW1lKTsNCiAgICB9\nDQoNCiAgICAvKioNCiAgICAgKiBAc2VlICN0aW1lb3V0KGxvbmcpDQogICAg\nICovDQogICAgcHVibGljIGJvb2xlYW4gdGltZW91dChsb25nIG1pbGxpcywg\nU3RyaW5nIG1ldGhvZE5hbWUpIHRocm93cyBUaHJvd2FibGUgew0KICAgICAg\nICAvLyB3ZSBhcmUgaW4gdGhlIHRpbWluZyBvdXQtdGhyZWFkOiBkbyBub3Ro\naW5nIHNvIHRoZQ0KICAgICAgICAvLyBhY3R1YWwgdGVzdCBtZXRob2QgY2Fu\nIHJ1bg0KICAgICAgICBpZiAoaW5UaW1lb3V0VGhyZWFkKQ0KICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgIGluVGltZW91dFRocmVhZCA9\nIHRydWU7DQogICAgICAgIGxvbmcgZW5kVGltZSA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpICsgbWlsbGlzOw0KDQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBmaW5hbCBNZXRob2QgbWV0aG9kID0gZ2V0Q2xhc3MoKS4NCiAg\nICAgICAgICAgICAgICBnZXRNZXRob2QobWV0aG9kTmFtZSwgKENsYXNzW10p\nIG51bGwpOw0KICAgICAgICAgICAgZmluYWwgT2JqZWN0IHRoeiA9IHRoaXM7\nDQoNCiAgICAgICAgICAgIC8vIHNwYXduIHRocmVhZA0KICAgICAgICAgICAg\nVGltZU91dFRocmVhZCB0b3QgPSBuZXcgVGltZU91dFRocmVhZCgiVGltZU91\ndFRocmVhZCBbIg0KICAgICAgICAgICAgICAgICsgbWV0aG9kTmFtZSArICJd\nICgiICsgbWlsbGlzICsgIm1zKSIpIHsNCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7DQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQog\nICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QuaW52b2tlKHRoeiwgKE9i\namVjdFtdKSBudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nYWJsZSA9IHQ7DQogICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQgPSB0cnVlOw0KICAg\nICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAg\nICAgICAgfTsNCg0KICAgICAgICAgICAgdG90LnN0YXJ0KCk7DQoNCiAgICAg\nICAgICAgIC8vIHdhaXQgZm9yIHRoZSBjb21wbGV0aW9uIG9yIGEgdGltZW91\ndCB0byBvY2N1cg0KICAgICAgICAgICAgdG90LmpvaW4obWlsbGlzKTsNCg0K\nICAgICAgICAgICAgLy8gaGF2ZSB3ZSB0aW1lZCBvdXQ/IEtpbGwgdGhlIHRo\ncmVhZCBhbmQgdGhyb3cgYW4gZXhjZXB0aW9uDQogICAgICAgICAgICBpZiAo\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgPj0gZW5kVGltZSkgew0KICAg\nICAgICAgICAgICAgIC8vIGlmIHdlIGFyZSB3YWl0aW5nIG9uIGEgbW9uaXRv\nciwgdGhpcyB3aWxsIGdpdmUNCiAgICAgICAgICAgICAgICAvLyB1cyBhIHVz\nZWZ1bCBzdGFjayB0cmFjZS4NCiAgICAgICAgICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgICAgICAgICB0b3QuaW50ZXJydXB0KCk7DQogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIGUpIHsNCiAgICAgICAgICAgICAg\nICB9DQogICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5z\nbGVlcCg1MDApOw0KDQogICAgICAgICAgICAgICAgLy8gdHJ5IHRvIGtpbGwg\ndGhlIHRocmVhZA0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAg\nICAgICAgICAgIHRvdC5zdG9wKCk7DQogICAgICAgICAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIGUpIHsNCiAgICAgICAgICAgICAgICB9DQogICAgICAg\nICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5zbGVlcCg1MDApOw0K\nDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9wZXJhdGlvblRpbWVkT3V0\nRXhjZXB0aW9uKCJFeGVjdXRpb24gb2YgXCIiDQogICAgICAgICAgICAgICAg\nICAgICsgbWV0aG9kTmFtZSArICJcIiB0aW1lZCBvdXQgYWZ0ZXIgIg0KICAg\nICAgICAgICAgICAgICAgICArIG1pbGxpcyArICIgbWlsbGlzZWNvbmRzIiwg\ndG90LnRocm93YWJsZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAg\nIC8vIHRocm93IGFueSBleGNlcHRpb25zIHRoYXQgbWF5IGhhdmUgb2NjdXJl\nZA0KICAgICAgICAgICAgaWYgKHRvdC50aHJvd2FibGUgIT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICB0aHJvdyB0b3QudGhyb3dhYmxlOw0KDQogICAgICAg\nICAgICAvLyBJIGd1ZXNzIGV2ZXJ5dGhpbmcgd2FzIE9LDQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAg\nICAgIGluVGltZW91dFRocmVhZCA9IGZhbHNlOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogVXRpbGl0eSBtZXRob2QgdG8gc3RhcnQg\nYSBwcm9maWxlLg0KICAgICAqDQogICAgICogQHNlZSAjZW5kUHJvZmlsZShT\ndHJpbmcpDQogICAgICovDQogICAgcHVibGljIHZvaWQgc3RhcnRQcm9maWxl\nKFN0cmluZyBuYW1lKSB7DQogICAgICAgIF90aW1lcy5wdXQobmFtZSwgbmV3\nIExvbmcoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpKTsNCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBVdGlsaXR5IHRvIGVuZCB0aGUgcHJvZmlsZSBh\nbmQgcHJpbnQgb3V0IHRoZSB0aW1lLiBFeGFtcGxlIHVzYWdlOg0KICAgICAq\nIDxwLz4NCiAgICAgKiA8cHJlPjxjb2RlPiBzdGFydFByb2ZpbGUoIlNvbWUg\nbG9uZyB0YXNrIik7IGRvU29tZUxvbmdUYXNrKCk7DQogICAgICogZW5kUHJv\nZmlsZSgiU29tZSBsb25nIHRhc2siKTsNCiAgICAgKiA8L2NvZGU+PC9wcmU+\nDQogICAgICoNCiAgICAgKiBAcGFyYW0gbmFtZQ0KICAgICAqIEByZXR1cm4g\ndGhlIGFtb3VudCBvZiB0aW1lIHRoYXQgdGhpcyBwcm9maWxlIGludm9jYXRp\nb24gdG9vaywgb3INCiAgICAgKiAgICAgICAgIC0xIGlmIDxjb2RlPm5hbWU8\nL2NvZGU+IHdhcyBuZXZlciBzdGFydGVkLg0KICAgICAqLw0KICAgIHB1Ymxp\nYyBsb25nIGVuZFByb2ZpbGUoU3RyaW5nIG5hbWUpIHsNCiAgICAgICAgTG9u\nZyB0aW1lID0gKExvbmcpIF90aW1lcy5yZW1vdmUobmFtZSk7DQoNCiAgICAg\nICAgbG9uZyBlbGFwc2VkID0gLTE7DQogICAgICAgIGlmICh0aW1lICE9IG51\nbGwpDQogICAgICAgICAgICBlbGFwc2VkID0gU3lzdGVtLmN1cnJlbnRUaW1l\nTWlsbGlzKCkgLSB0aW1lLmxvbmdWYWx1ZSgpOw0KDQogICAgICAgIGdldExv\nZygpLmluZm8oX2xvYy5nZXQoInByb2ZpbGUtaW5mbyIsIG5hbWUsDQogICAg\nICAgICAgICAodGltZSA9PSBudWxsID8gIj8/PyIgOiAiIiArIGVsYXBzZWQp\nKSk7DQogICAgICAgIHJldHVybiBlbGFwc2VkOw0KICAgIH0NCg0KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIFRpbWVPdXRUaHJlYWQgZXh0ZW5kcyBUaHJl\nYWQgew0KDQogICAgICAgIHB1YmxpYyBUaHJvd2FibGUgdGhyb3dhYmxlID0g\nbnVsbDsNCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29tcGxldGVkID0gZmFs\nc2U7DQoNCiAgICAgICAgcHVibGljIFRpbWVPdXRUaHJlYWQoU3RyaW5nIG5h\nbWUpIHsNCiAgICAgICAgICAgIHN1cGVyKG5hbWUpOw0KICAgICAgICAgICAg\nc2V0RGFlbW9uKHRydWUpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogSW5kaWNhdGVzIHRoYXQgYSB0aW1lb3V0IG9jY3VyZWQuDQog\nICAgICovDQogICAgcHVibGljIHN0YXRpYyBjbGFzcyBPcGVyYXRpb25UaW1l\nZE91dEV4Y2VwdGlvbiBleHRlbmRzIFJ1bnRpbWVFeGNlcHRpb24gew0KDQog\nICAgICAgIHByaXZhdGUgZmluYWwgVGhyb3dhYmxlIF9lcnI7DQoNCiAgICAg\nICAgcHVibGljIE9wZXJhdGlvblRpbWVkT3V0RXhjZXB0aW9uKFN0cmluZyBt\nc2csIFRocm93YWJsZSB0aHJvd2FibGUpIHsNCiAgICAgICAgICAgIHN1cGVy\nKG1zZyk7DQogICAgICAgICAgICBfZXJyID0gdGhyb3dhYmxlOw0KICAgICAg\nICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgcHJpbnRTdGFja1RyYWNlKCkg\new0KICAgICAgICAgICAgcHJpbnRTdGFja1RyYWNlKFN5c3RlbS5vdXQpOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgcHJpbnRTdGFja1Ry\nYWNlKFByaW50U3RyZWFtIG91dCkgew0KICAgICAgICAgICAgcHJpbnRTdGFj\na1RyYWNlKG5ldyBQcmludFdyaXRlcihvdXQpKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIHB1YmxpYyB2b2lkIHByaW50U3RhY2tUcmFjZShQcmludFdyaXRl\nciBvdXQpIHsNCiAgICAgICAgICAgIHN1cGVyLnByaW50U3RhY2tUcmFjZShv\ndXQpOw0KICAgICAgICAgICAgaWYgKF9lcnIgIT0gbnVsbCkgew0KICAgICAg\nICAgICAgICAgIG91dC5wcmludCgiTmVzdGVkIFRocm93YWJsZTogIik7DQog\nICAgICAgICAgICAgICAgX2Vyci5wcmludFN0YWNrVHJhY2Uob3V0KTsNCiAg\nICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBDbGFzc0xvYWRlciBmdW5jdGlv\nbnMNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQoNCiAgICAvKioN\nCiAgICAgKiBDcmVhdGUgYSBDbGFzc0xvYWRlciB0aGF0IHdpbGwgbm90IHVz\nZSB0aGUgcGFyZW50DQogICAgICogQ2xhc3NMb2FkZXIgdG8gcmVzb2x2ZSBj\nbGFzc2VzLiBUaGlzIGlzIHVzZWZ1bCBmb3INCiAgICAgKiB0ZXN0aW5nIGlu\ndGVyYWN0aW9ucyBiZXR3ZWVuIEtvZG8gaW4gcnVubmluZw0KICAgICAqIGlu\nIENsYXNzTG9hZGVyQSBhbmQgaW5zdGFuY2VzIGluIENsYXNzTG9hZGVyQi4N\nCiAgICAgKi8NCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgY3JlYXRlSXNvbGF0\nZWRDbGFzc0xvYWRlcigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBJc29sYXRl\nZENsYXNzTG9hZGVyKCk7DQogICAgfQ0KDQogICAgcHVibGljIE5lc3RlZENs\nYXNzTG9hZGVyIGNyZWF0ZU5lc3RlZENsYXNzTG9hZGVyKCkgew0KICAgICAg\nICByZXR1cm4gbmV3IE5lc3RlZENsYXNzTG9hZGVyKGZhbHNlKTsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgTmVzdGVkQ2xhc3NMb2FkZXIgY3JlYXRlTmVzdGVk\nUGFyZW50Q2xhc3NMb2FkZXIoKSB7DQogICAgICAgIHJldHVybiBuZXcgTmVz\ndGVkQ2xhc3NMb2FkZXIodHJ1ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAg\nICogUmVsb2FkIHRoZSBzcGVjaWZpZWQgY2xhc3MgaW4gYW4gaXNvbGF0ZWQg\nQ2xhc3NMb2FkZXIuDQogICAgICoNCiAgICAgKiBAcGFyYW0gdGFyZ2V0IHRo\nZSB0YXJnZXQgY2xhc3MgdG8gbG9hZA0KICAgICAqIEByZXR1cm4gdGhlIENs\nYXNzIGFzIHJlbG9hZGVkIGluIGFuIG5ldyBDbGFzc0xvYWRlcg0KICAgICAq\nLw0KICAgIHB1YmxpYyBDbGFzcyBpc29sYXRlKENsYXNzIHRhcmdldCkgdGhy\nb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24gew0KICAgICAgICBDbGFzcyBy\nZXN1bHQgPSBpc29sYXRlKHRhcmdldC5nZXROYW1lKCkpOw0KICAgICAgICBh\nc3NlcnRUcnVlKHJlc3VsdCAhPSB0YXJnZXQpOw0KICAgICAgICBhc3NlcnRO\nb3RFcXVhbHMocmVzdWx0LCB0YXJnZXQpOw0KICAgICAgICBhc3NlcnRUcnVl\nKHJlc3VsdC5nZXRDbGFzc0xvYWRlcigpICE9IHRhcmdldC5nZXRDbGFzc0xv\nYWRlcigpKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAg\nICBwdWJsaWMgQ2xhc3MgaXNvbGF0ZShTdHJpbmcgdGFyZ2V0KSB0aHJvd3Mg\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7DQogICAgICAgIENsYXNzTG9hZGVy\nIGlsID0gY3JlYXRlSXNvbGF0ZWRDbGFzc0xvYWRlcigpOw0KICAgICAgICBD\nbGFzcyByZXN1bHQgPSBpbC5sb2FkQ2xhc3ModGFyZ2V0KTsNCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKHJlc3VsdC5nZXROYW1lKCksIHRhcmdldCk7DQoNCiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICBwdWJsaWMgQ2xh\nc3MgbmVzdChDbGFzcyB0YXJnZXQpIHRocm93cyBDbGFzc05vdEZvdW5kRXhj\nZXB0aW9uIHsNCiAgICAgICAgQ2xhc3NMb2FkZXIgaWwgPSBjcmVhdGVOZXN0\nZWRDbGFzc0xvYWRlcigpOw0KICAgICAgICBDbGFzcyByZXN1bHQgPSBpbC5s\nb2FkQ2xhc3ModGFyZ2V0LmdldE5hbWUoKSk7DQogICAgICAgIGFzc2VydFRy\ndWUocmVzdWx0ICE9IHRhcmdldCk7DQogICAgICAgIGFzc2VydE5vdEVxdWFs\ncyhyZXN1bHQsIHRhcmdldCk7DQogICAgICAgIGFzc2VydFRydWUocmVzdWx0\nLmdldENsYXNzTG9hZGVyKCkgIT0gdGFyZ2V0LmdldENsYXNzTG9hZGVyKCkp\nOw0KICAgICAgICBhc3NlcnRFcXVhbHMocmVzdWx0LmdldE5hbWUoKSwgdGFy\nZ2V0LmdldE5hbWUoKSk7DQoNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGlzb2xhdGVOZXcoQ2xhc3MgdGFy\nZ2V0KQ0KICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwg\nSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbiwNCiAgICAgICAgSW5zdGFudGlhdGlv\nbkV4Y2VwdGlvbiB7DQogICAgICAgIHJldHVybiBpc29sYXRlKHRhcmdldCku\nbmV3SW5zdGFuY2UoKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBOZXN0ZWRDbGFzc0xvYWRlciBleHRlbmRzIEFudENsYXNzTG9hZGVy\nIHsNCg0KICAgICAgICBwdWJsaWMgTmVzdGVkQ2xhc3NMb2FkZXIoYm9vbGVh\nbiB1c2VQYXJlbnQpIHsNCiAgICAgICAgICAgIHN1cGVyKENsYXNzTG9hZGVy\nLmdldFN5c3RlbUNsYXNzTG9hZGVyKCksIHVzZVBhcmVudCk7DQoNCiAgICAg\nICAgICAgIGZvciAoU3RyaW5nVG9rZW5pemVyIGNsdG9rID0gbmV3IFN0cmlu\nZ1Rva2VuaXplcigNCiAgICAgICAgICAgICAgICBTeXN0ZW0uZ2V0UHJvcGVy\ndHkoImphdmEuY2xhc3MucGF0aCIpLCBGaWxlLnBhdGhTZXBhcmF0b3IpOw0K\nICAgICAgICAgICAgICAgIGNsdG9rLmhhc01vcmVUb2tlbnMoKTspIHsNCiAg\nICAgICAgICAgICAgICBTdHJpbmcgcGF0aCA9IGNsdG9rLm5leHRUb2tlbigp\nOw0KDQogICAgICAgICAgICAgICAgLy8gb25seSBsb2FkIHRlc3QgcGF0aHMs\nIG5vdCBqYXIgZmlsZXMNCiAgICAgICAgICAgICAgICBpZiAocGF0aC5pbmRl\neE9mKCIuamFyIikgIT0gLTEpDQogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOw0KICAgICAgICAgICAgICAgIGlmIChwYXRoLmluZGV4T2YoIi56aXAi\nKSAhPSAtMSkNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAg\nICAgICAgICAgICAgICBhZGRQYXRoRWxlbWVudChwYXRoKTsNCiAgICAgICAg\nICAgIH0NCg0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBp\nZiAoIXVzZVBhcmVudCkgew0KICAgICAgICAgICAgICAgICAgICBhc3NlcnRU\ncnVlKGxvYWRDbGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgKEFic3Ry\nYWN0VGVzdENhc2UuY2xhc3MuZ2V0TmFtZSgpKS5nZXRDbGFzc0xvYWRlcigp\nDQogICAgICAgICAgICAgICAgICAgICAgICAhPSBBYnN0cmFjdFRlc3RDYXNl\nLmNsYXNzLmdldENsYXNzTG9hZGVyKCkpOw0KICAgICAgICAgICAgICAgIH0N\nCiAgICAgICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24g\nY25mZSkgew0KICAgICAgICAgICAgICAgIGZhaWwoY25mZS50b1N0cmluZygp\nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1Ymxp\nYyBDbGFzcyBmaW5kQ2xhc3MoU3RyaW5nIG5hbWUpIHRocm93cyBDbGFzc05v\ndEZvdW5kRXhjZXB0aW9uIHsNCiAgICAgICAgICAgIC8vIGRvbid0IGlzb2xh\ndGUgUEMgYW5kIHJlbGF0ZWQgY2xhc3NlcyBpbiBrb2RvLmVuaG5hY2UNCiAg\nICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoIi5lbmhhbmNlLiIpICE9IC0x\nKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBDbGFzc05vdEZvdW5kRXhj\nZXB0aW9uKG5hbWUpOw0KICAgICAgICAgICAgaWYgKG5hbWUuaW5kZXhPZigi\nL2VuaGFuY2UvIikgIT0gLTEpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIENsYXNzTm90Rm91bmRFeGNlcHRpb24obmFtZSk7DQogICAgICAgICAgICBy\nZXR1cm4gc3VwZXIuZmluZENsYXNzKG5hbWUpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogQSBDbGFzc0xvYWRlciB0aGF0IGlzIGNv\nbXBsZXRlbHkgaXNvbGF0ZWQgd2l0aCByZXNwZWN0IHRvDQogICAgICogYW55\nIGNsYXNzZXMgdGhhdCBhcmUgbG9hZGVkIGluIHRoZSBTeXN0ZW0gQ2xhc3NM\nb2FkZXIuDQogICAgICoNCiAgICAgKiBAYXV0aG9yIE1hcmMgUHJ1ZCdob21t\nZWF1eA0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIElzb2xh\ndGVkQ2xhc3NMb2FkZXIgZXh0ZW5kcyBOZXN0ZWRDbGFzc0xvYWRlciB7DQoN\nCiAgICAgICAgcHVibGljIElzb2xhdGVkQ2xhc3NMb2FkZXIoKSB7DQogICAg\nICAgICAgICBzdXBlcihmYWxzZSk7DQogICAgICAgICAgICBzZXRJc29sYXRl\nZChmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLy8vLy8vLy8v\nLy8vLy8NCiAgICAvLyBDb2xsZWN0aW9ucw0KICAgIC8vLy8vLy8vLy8vLy8v\nLw0KDQogICAgLyoqDQogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgc3BlY2lm\naWVkIHtAbGluayBDb2xsZWN0aW9ufSBmdWxmaWxscyB0aGUNCiAgICAgKiBD\nb2xsZWN0aW9uIGNvbnRyYWN0IGFzIHNwZWNpZmllZCBieSB0aGUgQ29sbGVj\ndGlvbnMgQVBJLg0KICAgICAqIDxwLz4NCiAgICAgKiA8c3Ryb25nPk5vdGU8\nL3N0cm9uZz46IGRvZXMgbm90IHZhbGlkYXRlIG11dGFibGUgb3BlcmF0aW9u\ncw0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCB2YWxpZGF0ZUNv\nbGxlY3Rpb24oQ29sbGVjdGlvbiBjb2xsZWN0aW9uKSB7DQogICAgICAgIGlu\ndCBzaXplID0gY29sbGVjdGlvbi5zaXplKCk7DQogICAgICAgIGludCBpdGVy\nYXRlZCA9IDA7DQogICAgICAgIC8vIGVuc3VyZSB3ZSBjYW4gd2FsayBhbG9u\nZyB0aGUgaXRlcmF0b3INCiAgICAgICAgZm9yIChJdGVyYXRvciBpID0gY29s\nbGVjdGlvbi5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsNCiAgICAgICAg\nICAgIGl0ZXJhdGVkKys7DQogICAgICAgICAgICBpLm5leHQoKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIC8vIGVuc3VyZSB0aGUgbnVtYmVyIG9mIHZhbHVl\ncyBpdGVyYXRlZCBpcyB0aGUgc2FtZSBhcyB0aGUgbGlzdCBzaXplDQogICAg\nICAgIGFzc2VydEVxdWFscyhzaXplLCBpdGVyYXRlZCk7DQoNCiAgICAgICAg\nLy8gYWxzbyB2YWxpZGF0ZSB0aGUgbGlzdA0KICAgICAgICBpZiAoY29sbGVj\ndGlvbiBpbnN0YW5jZW9mIExpc3QpIHsNCiAgICAgICAgICAgIExpc3QgbGwg\nPSBuZXcgQXJyYXlMaXN0KCk7DQogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IDEwMDsgaSsrKQ0KICAgICAgICAgICAgICAgIGxsLmFkZChuZXcg\nSW50ZWdlcihpKSk7DQogICAgICAgICAgICB2YWxpZGF0ZUxpc3QoKExpc3Qp\nIGxsKTsNCiAgICAgICAgICAgIHZhbGlkYXRlTGlzdCgoTGlzdCkgY29sbGVj\ndGlvbik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBW\nYWxpZGF0ZSB0aGF0IHRoZSBzcGVjaWZpZWQge0BsaW5rIExpc3R9IGZ1bGZp\nbGxzIHRoZQ0KICAgICAqIExpc3QgY29udHJhY3QgYXMgc3BlY2lmaWVkIGJ5\nIHRoZSBDb2xsZWN0aW9ucyBBUEkuDQogICAgICogPHAvPg0KICAgICAqIDxz\ndHJvbmc+Tm90ZTwvc3Ryb25nPjogZG9lcyBub3QgdmFsaWRhdGUgbXV0YWJs\nZSBvcGVyYXRpb25zDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyB2b2lk\nIHZhbGlkYXRlTGlzdChMaXN0IGxpc3QpIHsNCiAgICAgICAgT2JqZWN0IFtd\nIGNvcmVWYWx1ZXMgPSBsaXN0LnRvQXJyYXkoKTsNCiAgICAgICAgT2JqZWN0\nIFtdIHZhbHVlczEgPSBuZXcgT2JqZWN0IFtsaXN0LnNpemUoKV07DQogICAg\nICAgIE9iamVjdCBbXSB2YWx1ZXMyID0gbmV3IE9iamVjdCBbbGlzdC5zaXpl\nKCldOw0KICAgICAgICBPYmplY3QgW10gdmFsdWVzMyA9IG5ldyBPYmplY3Qg\nW2xpc3Quc2l6ZSgpXTsNCiAgICAgICAgT2JqZWN0IFtdIHZhbHVlczQgPSBu\nZXcgT2JqZWN0IFtsaXN0LnNpemUoKV07DQoNCiAgICAgICAgLy8gZmlsbCBz\nZXF1ZW50aWFsIGluZGV4IGFjY2VzcyBsaXN0DQogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykNCiAgICAgICAgICAgIHZh\nbHVlczFbaV0gPSBsaXN0LmdldChpKTsNCg0KICAgICAgICAvLyBmaWxsIHNl\ncXVlbnRpYWwgbGlzdA0KICAgICAgICBpbnQgaW5kZXggPSAwOw0KICAgICAg\nICBMaXN0SXRlcmF0b3IgaXRlcjsNCiAgICAgICAgZm9yIChpdGVyID0gbGlz\ndC5saXN0SXRlcmF0b3IoMCk7IGl0ZXIuaGFzTmV4dCgpOykgew0KICAgICAg\nICAgICAgYXNzZXJ0RXF1YWxzKGluZGV4LCBpdGVyLm5leHRJbmRleCgpKTsN\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscyhpbmRleCwgaXRlci5wcmV2aW91\nc0luZGV4KCkgKyAxKTsNCiAgICAgICAgICAgIHZhbHVlczJbaW5kZXhdID0g\naXRlci5uZXh0KCk7DQogICAgICAgICAgICBhc3NlcnRUcnVlKGxpc3QuY29u\ndGFpbnModmFsdWVzMltpbmRleF0pKTsNCiAgICAgICAgICAgIGluZGV4Kys7\nDQogICAgICAgIH0NCg0KICAgICAgICAvLyBlbnN1cmUgTm9TdWNoRWxlbWVu\ndEV4Y2VwdGlvbiBpcyB0aHJvd24gYXMgYXBwcm9wcmlhdGUNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIGl0ZXIubmV4dCgpOw0KICAgICAgICAgICAg\nZmFpbCgibmV4dCgpIHNob3VsZCBoYXZlIHJlc3VsdGVkIGluIGEgTm9TdWNo\nRWxlbWVudEV4Y2VwdGlvbiIpOw0KICAgICAgICB9IGNhdGNoIChOb1N1Y2hF\nbGVtZW50RXhjZXB0aW9uIGUpIHsNCiAgICAgICAgfSAvLyBhcyBleHBlY3Rl\nZA0KDQogICAgICAgIC8vIGZpbGwgcmV2ZXJzZSBzZXF1ZW50aWFsIGxpc3QN\nCiAgICAgICAgaW50IGJhY2sgPSAwOw0KICAgICAgICBmb3IgKGl0ZXIgPSBs\naXN0Lmxpc3RJdGVyYXRvcihsaXN0LnNpemUoKSk7IGl0ZXIuaGFzUHJldmlv\ndXMoKTspIHsNCiAgICAgICAgICAgIGFzc2VydEVxdWFscyhpbmRleCwgaXRl\nci5wcmV2aW91c0luZGV4KCkgKyAxKTsNCiAgICAgICAgICAgIGFzc2VydEVx\ndWFscyhpbmRleCwgaXRlci5uZXh0SW5kZXgoKSk7DQogICAgICAgICAgICB2\nYWx1ZXMzWy0taW5kZXhdID0gaXRlci5wcmV2aW91cygpOw0KICAgICAgICAg\nICAgYmFjaysrOw0KICAgICAgICB9DQogICAgICAgIGFzc2VydEVxdWFscyhs\naXN0LnNpemUoKSwgYmFjayk7DQoNCiAgICAgICAgLy8gZW5zdXJlIE5vU3Vj\naEVsZW1lbnRFeGNlcHRpb24gaXMgdGhyb3duIGFzIGFwcHJvcHJpYXRlDQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBpdGVyLnByZXZpb3VzKCk7DQog\nICAgICAgICAgICBmYWlsKCJwcmV2aW91cygpIHNob3VsZCBoYXZlIHJlc3Vs\ndGVkIGluIGEgIg0KICAgICAgICAgICAgICAgICsgIk5vU3VjaEVsZW1lbnRF\neGNlcHRpb24iKTsNCiAgICAgICAgfSBjYXRjaCAoTm9TdWNoRWxlbWVudEV4\nY2VwdGlvbiBlKSB7DQogICAgICAgIH0gLy8gYXMgZXhwZWN0ZWQNCg0KICAg\nICAgICAvLyBmaWxsIHJhbmRvbSBhY2Nlc3MgbGlzdA0KICAgICAgICBMaXN0\nIGluZGljZXMgPSBuZXcgTGlua2VkTGlzdCgpOw0KICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGxpc3Quc2l6ZSgpOyBpKyspDQogICAgICAgICAgICBp\nbmRpY2VzLmFkZChuZXcgSW50ZWdlcihpKSk7DQoNCiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBsaXN0LnNpemUoKTsgaSsrKSB7DQogICAgICAgICAg\nICBpbnQgcmFuZCA9IChpbnQpIChNYXRoLnJhbmRvbSgpICogaW5kaWNlcy5z\naXplKCkpOw0KICAgICAgICAgICAgSW50ZWdlciByYW5kSW5kZXggPSAoSW50\nZWdlcikgaW5kaWNlcy5yZW1vdmUocmFuZCk7DQogICAgICAgICAgICB2YWx1\nZXM0W3JhbmRJbmRleC5pbnRWYWx1ZSgpXSA9IGxpc3QuZ2V0KHJhbmRJbmRl\neC5pbnRWYWx1ZSgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGFzc2VydEVx\ndWFscyhBcnJheXMuYXNMaXN0KGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNMaXN0\nKHZhbHVlczEpKTsNCiAgICAgICAgYXNzZXJ0SWRlbnRpY2FsKEFycmF5cy5h\nc0xpc3QoY29yZVZhbHVlcyksIEFycmF5cy5hc0xpc3QodmFsdWVzMSkpOw0K\nICAgICAgICBhc3NlcnRFcXVhbHMoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVz\nKSwgQXJyYXlzLmFzTGlzdCh2YWx1ZXMyKSk7DQogICAgICAgIGFzc2VydElk\nZW50aWNhbChBcnJheXMuYXNMaXN0KGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNM\naXN0KHZhbHVlczIpKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKEFycmF5cy5h\nc0xpc3QoY29yZVZhbHVlcyksIEFycmF5cy5hc0xpc3QodmFsdWVzNCkpOw0K\nICAgICAgICBhc3NlcnRJZGVudGljYWwoQXJyYXlzLmFzTGlzdChjb3JlVmFs\ndWVzKSwgQXJyYXlzLmFzTGlzdCh2YWx1ZXM0KSk7DQogICAgICAgIGFzc2Vy\ndEVxdWFscyhBcnJheXMuYXNMaXN0KGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNM\naXN0KHZhbHVlczMpKTsNCiAgICAgICAgYXNzZXJ0SWRlbnRpY2FsKEFycmF5\ncy5hc0xpc3QoY29yZVZhbHVlcyksIEFycmF5cy5hc0xpc3QodmFsdWVzMykp\nOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFzc2VydCB0aGF0IHRoZSBn\naXZlbiBMaXN0IGNvbnRhaW4gdGhlIGV4YWN0IHNhbWUNCiAgICAgKiBlbGVt\nZW50cy4gVGhpcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgbm9ybWFsIExpc3Qg\nY29udHJhY3QsIHdoaWNoDQogICAgICogc3RhdGVzIHRoYXQgbGlzdDEuZXF1\nYWxzKGxpc3QyKSBpZiBlYWNoIGVsZW1lbnQgZTEuZXF1YWxzKGUyKS4NCiAg\nICAgKiBUaGlzIG1ldGhvZCBhc3NlcnRzIHRoYXQgZTEgPT0gbjIuDQogICAg\nICovDQogICAgcHVibGljIHN0YXRpYyB2b2lkIGFzc2VydElkZW50aWNhbChM\naXN0IGMxLCBMaXN0IGMyKSB7DQogICAgICAgIGFzc2VydEVxdWFscyhjMS5z\naXplKCksIGMyLnNpemUoKSk7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaTEg\nPSBjMS5pdGVyYXRvcigpLCBpMiA9IGMyLml0ZXJhdG9yKCk7DQogICAgICAg\nICAgICBpMS5oYXNOZXh0KCkgJiYgaTIuaGFzTmV4dCgpOykNCiAgICAgICAg\nICAgIGFzc2VydFRydWUoaTEubmV4dCgpID09IGkyLm5leHQoKSk7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogQXNzZXJ0IHRoYXQgdGhlIGNvbGxlY3Rp\nb24gcGFyYW1ldGVyIGlzIGFscmVhZHkgb3JkZXJlZA0KICAgICAqIGFjY29y\nZGluZyB0byB0aGUgc3BlY2lmaWVkIGNvbXBhcmF0b3IuDQogICAgICovDQog\nICAgcHVibGljIHZvaWQgYXNzZXJ0T3JkZXJlZChDb2xsZWN0aW9uIGMsIENv\nbXBhcmF0b3IgY29tcCkgew0KICAgICAgICBMaXN0IGwxID0gbmV3IExpbmtl\nZExpc3QoYyk7DQogICAgICAgIExpc3QgbDIgPSBuZXcgTGlua2VkTGlzdChj\nKTsNCiAgICAgICAgYXNzZXJ0RXF1YWxzKGwxLCBsMik7DQogICAgICAgIENv\nbGxlY3Rpb25zLnNvcnQobDIsIGNvbXApOw0KICAgICAgICBhc3NlcnRFcXVh\nbHMobDEsIGwyKTsNCiAgICAgICAgQ29sbGVjdGlvbnMuc29ydChsMSwgY29t\ncCk7DQogICAgICAgIGFzc2VydEVxdWFscyhsMSwgbDIpOw0KICAgIH0NCg0K\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vDQogICAgLy8gQXNzZXJ0aW9uIEhl\nbHBlcnMNCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgcHVibGlj\nIHZvaWQgYXNzZXJ0Tm90RXF1YWxzKE9iamVjdCBhLCBPYmplY3QgYikgew0K\nICAgICAgICBpZiAoYSA9PSBudWxsICYmIGIgIT0gbnVsbCkNCiAgICAgICAg\nICAgIHJldHVybjsNCiAgICAgICAgaWYgKGEgIT0gbnVsbCAmJiBiID09IG51\nbGwpDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIGlmICghKGEuZXF1\nYWxzKGIpKSkNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgaWYgKCEo\nYi5lcXVhbHMoYSkpKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAg\nIGZhaWwoImV4cGVjdGVkICE8IiArIGEgKyAiPi5lcXVhbHMoPCIgKyBiICsg\nIj4pIik7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgYXNzZXJ0U2l6ZShp\nbnQgc2l6ZSwgT2JqZWN0IG9iKSB7DQogICAgICAgIGlmIChvYiA9PSBudWxs\nKSB7DQogICAgICAgICAgICBhc3NlcnRFcXVhbHMoc2l6ZSwgMCk7DQogICAg\nICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAob2Ig\naW5zdGFuY2VvZiBDb2xsZWN0aW9uKQ0KICAgICAgICAgICAgb2IgPSAoKENv\nbGxlY3Rpb24pIG9iKS5pdGVyYXRvcigpOw0KICAgICAgICBpZiAob2IgaW5z\ndGFuY2VvZiBJdGVyYXRvcikgew0KICAgICAgICAgICAgSXRlcmF0b3IgaSA9\nIChJdGVyYXRvcikgb2I7DQogICAgICAgICAgICBpbnQgY291bnQgPSAwOw0K\nICAgICAgICAgICAgd2hpbGUgKGkuaGFzTmV4dCgpKSB7DQogICAgICAgICAg\nICAgICAgY291bnQrKzsNCiAgICAgICAgICAgICAgICBpLm5leHQoKTsNCiAg\nICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHNpemUs\nIGNvdW50KTsNCiAgICAgICAgfSBlbHNlDQogICAgICAgICAgICBmYWlsKCJh\nc3NlcnRTaXplOiBleHBlY3RlZCBDb2xsZWN0aW9uLCBJdGVyYXRvciwgIg0K\nICAgICAgICAgICAgICAgICsgIlF1ZXJ5LCBvciBFeHRlbnQsIGJ1dCBnb3Qg\nIiArIG9iLmdldENsYXNzKCkuZ2V0TmFtZSgpKTsNCiAgICB9DQoNCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8NCiAgICAvLyBHZW5lcmljIHV0aWxpdGll\ncw0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLw0KDQogICAgcHVibGljIHZv\naWQgY29weShGaWxlIGZyb20sIEZpbGUgdG8pIHRocm93cyBJT0V4Y2VwdGlv\nbiB7DQogICAgICAgIGNvcHkobmV3IEZpbGVJbnB1dFN0cmVhbShmcm9tKSwg\ndG8pOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGNvcHkoSW5wdXRTdHJl\nYW0gaW4sIEZpbGUgdG8pIHRocm93cyBJT0V4Y2VwdGlvbiB7DQogICAgICAg\nIEZpbGVPdXRwdXRTdHJlYW0gZm91dCA9IG5ldyBGaWxlT3V0cHV0U3RyZWFt\nKHRvKTsNCg0KICAgICAgICBieXRlW10gYiA9IG5ldyBieXRlWzEwMjRdOw0K\nDQogICAgICAgIGZvciAoaW50IG4gPSAwOyAobiA9IGluLnJlYWQoYikpICE9\nIC0xOykNCiAgICAgICAgICAgIGZvdXQud3JpdGUoYiwgMCwgbik7DQogICAg\nfQ0KDQogICAgLyoqDQogICAgICogUHJpbnQgb3V0IGluZm9ybWF0aW9uIG9u\nIG1lbW9yeSB1c2FnZS4NCiAgICAgKi8NCiAgICBwdWJsaWMgdm9pZCBwcmlu\ndE1lbW9yeUluZm8oKSB7DQogICAgICAgIFJ1bnRpbWUgcnQgPSBSdW50aW1l\nLmdldFJ1bnRpbWUoKTsNCiAgICAgICAgbG9uZyB0b3RhbCA9IHJ0LnRvdGFs\nTWVtb3J5KCk7DQogICAgICAgIGxvbmcgZnJlZSA9IHJ0LmZyZWVNZW1vcnko\nKTsNCiAgICAgICAgbG9uZyB1c2VkID0gdG90YWwgLSBmcmVlOw0KDQogICAg\nICAgIE51bWJlckZvcm1hdCBuZiA9IE51bWJlckZvcm1hdC5nZXRJbnN0YW5j\nZSgpOw0KICAgICAgICBnZXRMb2coKS53YXJuKF9sb2MuZ2V0KCJtZW0taW5m\nbyIsDQogICAgICAgICAgICBuZi5mb3JtYXQodXNlZCksDQogICAgICAgICAg\nICBuZi5mb3JtYXQodG90YWwpLA0KICAgICAgICAgICAgbmYuZm9ybWF0KGZy\nZWUpKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJuIGEgbGlz\ndCBvZiBhbGwgdmFsdWVzIGl0ZXJhdGVkIGJ5IHRoZSBnaXZlbiBpdGVyYXRv\nci4NCiAgICAgKi8NCiAgICBwdWJsaWMgc3RhdGljIExpc3QgaXRlcmF0b3JU\nb0xpc3QoSXRlcmF0b3IgaSkgew0KICAgICAgICBMaW5rZWRMaXN0IGxpc3Qg\nPSBuZXcgTGlua2VkTGlzdCgpOw0KICAgICAgICB3aGlsZSAoaS5oYXNOZXh0\nKCkpDQogICAgICAgICAgICBsaXN0LmFkZChpLm5leHQoKSk7DQogICAgICAg\nIHJldHVybiBsaXN0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVy\nbiBhbiBhcnJheSBvZiB0aGUgb2JqZWN0cyBpdGVyYXRlZCBieSB0aGUgZ2l2\nZW4gaXRlcmF0b3IuDQogICAgICovDQogICAgcHVibGljIHN0YXRpYyBPYmpl\nY3QgW10gaXRlcmF0b3JUb0FycmF5KEl0ZXJhdG9yIGksIENsYXNzIFtdIGNs\nYXp6KSB7DQogICAgICAgIHJldHVybiBpdGVyYXRvclRvTGlzdChpKS50b0Fy\ncmF5KGNsYXp6KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSdW4gYW50\nIG9uIHRoZSBzcGVjaWZpZWQgYnVpbGQgZmlsZS4NCiAgICAgKg0KICAgICAq\nIEBwYXJhbSBidWlsZEZpbGUgdGhlIGJ1aWxkIGZpbGUgdG8gdXNlDQogICAg\nICogQHBhcmFtIHRhcmdldCB0aGUgbmFtZSBvZiB0aGUgdGFyZ2V0IHRvIGlu\ndm9rZQ0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIGFudChGaWxlIGJ1aWxk\nRmlsZSwgU3RyaW5nIHRhcmdldCkgew0KICAgICAgICBhc3NlcnRUcnVlKGJ1\naWxkRmlsZS5pc0ZpbGUoKSk7DQoNCiAgICAgICAgUHJvamVjdCBwcm9qZWN0\nID0gbmV3IFByb2plY3QoKTsNCiAgICAgICAgcHJvamVjdC5pbml0KCk7DQog\nICAgICAgIHByb2plY3Quc2V0VXNlclByb3BlcnR5KCJhbnQuZmlsZSIsIGJ1\naWxkRmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSk7DQogICAgICAgIFByb2plY3RI\nZWxwZXIuY29uZmlndXJlUHJvamVjdChwcm9qZWN0LCBidWlsZEZpbGUpOw0K\nICAgICAgICBwcm9qZWN0LmV4ZWN1dGVUYXJnZXQodGFyZ2V0KTsNCiAgICB9\nDQoNCiAgICAvKioNCiAgICAgKiBTZXJpYWxpemUgYW5kIGRlc2VyaWFsaXpl\nIHRoZSBvYmplY3QuDQogICAgICoNCiAgICAgKiBAcGFyYW0gdmFsaWRhdGVF\ncXVhbGl0eSBtYWtlIHN1cmUgdGhlIGhhc2hDb2RlIGFuZCBlcXVhbHMNCiAg\nICAgKiBtZXRob2RzIGhvbGQgdHJ1ZQ0KICAgICAqLw0KICAgIHB1YmxpYyBz\ndGF0aWMgT2JqZWN0IHJvdW5kdHJpcChPYmplY3Qgb3JpZywgYm9vbGVhbiB2\nYWxpZGF0ZUVxdWFsaXR5KQ0KICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24s\nIENsYXNzTm90Rm91bmRFeGNlcHRpb24gew0KICAgICAgICBhc3NlcnROb3RO\ndWxsKG9yaWcpOw0KDQogICAgICAgIEJ5dGVBcnJheU91dHB1dFN0cmVhbSBi\nb3V0ID0gbmV3IEJ5dGVBcnJheU91dHB1dFN0cmVhbSgpOw0KICAgICAgICBP\nYmplY3RPdXRwdXRTdHJlYW0gb3V0ID0gbmV3IE9iamVjdE91dHB1dFN0cmVh\nbShib3V0KTsNCiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG9yaWcpOw0KICAg\nICAgICBCeXRlQXJyYXlJbnB1dFN0cmVhbSBiaW4gPSBuZXcgQnl0ZUFycmF5\nSW5wdXRTdHJlYW0oDQogICAgICAgICAgICBib3V0LnRvQnl0ZUFycmF5KCkp\nOw0KICAgICAgICBPYmplY3RJbnB1dFN0cmVhbSBpbiA9IG5ldyBPYmplY3RJ\nbnB1dFN0cmVhbShiaW4pOw0KICAgICAgICBPYmplY3QgcmVzdWx0ID0gaW4u\ncmVhZE9iamVjdCgpOw0KDQogICAgICAgIGlmICh2YWxpZGF0ZUVxdWFsaXR5\nKSB7DQogICAgICAgICAgICBhc3NlcnRFcXVhbHMob3JpZy5oYXNoQ29kZSgp\nLCByZXN1bHQuaGFzaENvZGUoKSk7DQogICAgICAgICAgICBhc3NlcnRFcXVh\nbHMob3JpZywgcmVzdWx0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVy\nbiByZXN1bHQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQHJldHVybiB0\ncnVlIGlmIHRoZSBzcGVjaWZpZWQgaW5wdXQgbWF0Y2hlcyB0aGUgcmVndWxh\nciBleHByZXNzaW9uIHJlZ2V4Lg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0\naWMgYm9vbGVhbiBtYXRjaGVzKFN0cmluZyByZWdleCwgU3RyaW5nIGlucHV0\nKQ0KICAgICAgICB0aHJvd3MgUkVTeW50YXhFeGNlcHRpb24gew0KICAgICAg\nICBSRSByZSA9IFJFVXRpbC5jcmVhdGVSRShyZWdleCk7DQogICAgICAgIHJl\ndHVybiByZS5tYXRjaChpbnB1dCk7DQogICAgfQ0KDQogICAgcHVibGljIHN0\nYXRpYyB2b2lkIGFzc2VydE1hdGNoZXMoU3RyaW5nIHJlZ2V4LCBTdHJpbmcg\naW5wdXQpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICghKG1h\ndGNoZXMocmVnZXgsIGlucHV0KSkpDQogICAgICAgICAgICAgICAgZmFpbCgi\nRXhwZWN0ZWQgcmVndWxhciBleHByZXNzaW9uOiA8IiArIHJlZ2V4ICsgIj4i\nDQogICAgICAgICAgICAgICAgICAgICsgIiBkaWQgbm90IG1hdGNoOiA8IiAr\nIGlucHV0ICsgIj4iKTsNCiAgICAgICAgfSBjYXRjaCAoUkVTeW50YXhFeGNl\ncHRpb24gZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbihlLnRvU3RyaW5nKCkpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIHN0YXRpYyB2b2lkIGFzc2VydE5vdE1hdGNoZXMo\nU3RyaW5nIHJlZ2V4LCBTdHJpbmcgaW5wdXQpIHsNCiAgICAgICAgdHJ5IHsN\nCiAgICAgICAgICAgIGlmIChtYXRjaGVzKHJlZ2V4LCBpbnB1dCkpDQogICAg\nICAgICAgICAgICAgZmFpbCgiUmVndWxhciBleHByZXNzaW9uOiA8IiArIHJl\nZ2V4ICsgIj4iDQogICAgICAgICAgICAgICAgICAgICsgIiBzaG91bGQgbm90\nIG1hdGNoOiA8IiArIGlucHV0ICsgIj4iKTsNCiAgICAgICAgfSBjYXRjaCAo\nUkVTeW50YXhFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihlLnRvU3RyaW5nKCkpOw0KICAg\nICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2sgdGhlIGxp\nc3QgaWYgc3RyaW5ncyBhbmQgcmV0dXJuIHRoZSBvbmVzIHRoYXQgbWF0Y2gN\nCiAgICAgKiB0aGUgc3BlY2lmaWVkIG1hdGNoLg0KICAgICAqLw0KICAgIHB1\nYmxpYyBzdGF0aWMgTGlzdCBtYXRjaGVzKFN0cmluZyByZWdleCwgQ29sbGVj\ndGlvbiBpbnB1dCkNCiAgICAgICAgdGhyb3dzIFJFU3ludGF4RXhjZXB0aW9u\nIHsNCiAgICAgICAgTGlzdCBtYXRjaGVzID0gbmV3IEFycmF5TGlzdCgpOw0K\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSBpbnB1dC5pdGVyYXRvcigpOyBp\nLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgIFN0cmluZyBjaGVjayA9IChT\ndHJpbmcpIGkubmV4dCgpOw0KICAgICAgICAgICAgaWYgKG1hdGNoZXMocmVn\nZXgsIGNoZWNrKSkNCiAgICAgICAgICAgICAgICBtYXRjaGVzLmFkZChjaGVj\nayk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbWF0Y2hlczsNCiAg\nICB9DQoNCiAgICAvKioNCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgc3BlY2lm\naWVkIGNvbGxlY3Rpb24gb2YgU3RyaW5ncyBjb250YWlucyBhdCBsZWFzdA0K\nICAgICAqIG9uZSBzdHJpbmcgdGhhdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQg\ncmVndWxhciBleHByZXNzaW9uLg0KICAgICAqLw0KICAgIHB1YmxpYyBzdGF0\naWMgdm9pZCBhc3NlcnRNYXRjaGVzKFN0cmluZyByZWdleCwgQ29sbGVjdGlv\nbiBpbnB1dCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKG1h\ndGNoZXMocmVnZXgsIGlucHV0KS5zaXplKCkgPT0gMCkNCiAgICAgICAgICAg\nICAgICBmYWlsKCJUaGUgc3BlY2lmaWVkIGxpc3Qgb2Ygc2l6ZSAiICsgaW5w\ndXQuc2l6ZSgpDQogICAgICAgICAgICAgICAgICAgICsgIiBkaWQgbm90IGNv\nbnRhaW4gYW55IHN0cmluZ3MgdGhhdCBtYXRjaCB0aGUiDQogICAgICAgICAg\nICAgICAgICAgICsgIiBzcGVjaWZpZWQgcmVndWxhciBleHByZXNzaW9uKFwi\nIiArIHJlZ2V4ICsgIlwiKSIpOw0KICAgICAgICB9IGNhdGNoIChSRVN5bnRh\neEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uKGUudG9TdHJpbmcoKSk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgc3Bl\nY2lmaWVkIGNvbGxlY3Rpb24gb2YgU3RyaW5ncyBkb2VzIG5vdCBtYXRjaA0K\nICAgICAqIHRoZSBzcGVjaWZpZWQgcmVndWxhciBleHByZXNzaW9uLg0KICAg\nICAqLw0KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBhc3NlcnROb3RNYXRjaGVz\nKFN0cmluZyByZWdleCwgQ29sbGVjdGlvbiBpbnB1dCkgew0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgTGlzdCBtYXRjaGVzOw0KDQogICAgICAgICAg\nICBpZiAoKChtYXRjaGVzID0gbWF0Y2hlcyhyZWdleCwgaW5wdXQpKSkuc2l6\nZSgpID4gMCkNCiAgICAgICAgICAgICAgICBmYWlsKCJUaGUgc3BlY2lmaWVk\nIGxpc3Qgb2Ygc2l6ZSAiICsgaW5wdXQuc2l6ZSgpDQogICAgICAgICAgICAg\nICAgICAgICsgIiBkaWQgY29udGFpbiBvbmUgb3IgbW9yZSBzdHJpbmdzIHRo\nYXQgbWF0Y2hzIHRoZSINCiAgICAgICAgICAgICAgICAgICAgKyAiIHNwZWNp\nZmllZCBpbGxlZ2FsIHJlZ3VsYXIgZXhwcmVzc2lvbiINCiAgICAgICAgICAg\nICAgICAgICAgKyAiIChcIiIgKyByZWdleCArICJcIikuIg0KICAgICAgICAg\nICAgICAgICAgICArICIgRmlyc3QgZXhhbXBsZSBvZiBhIG1hdGNoaW5nIG1l\nc3NhZ2UgaXM6ICINCiAgICAgICAgICAgICAgICAgICAgKyBtYXRjaGVzLml0\nZXJhdG9yKCkubmV4dCgpKTsNCiAgICAgICAgfSBjYXRjaCAoUkVTeW50YXhF\neGNlcHRpb24gZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbihlLnRvU3RyaW5nKCkpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogVG8gYmUgY2FsbGVkIGJ5IHRoZSBj\naGlsZC4gRS5nLjoNCiAgICAgKiA8Y29kZT4gcHVibGljIHN0YXRpYyB2b2lk\nIG1haW4oU3RyaW5nIFtdIGFyZ3MpIHsgbWFpbihUZXN0QnVnMzc1LmNsYXNz\nKTsNCiAgICAgKiB9DQogICAgICogPC9jb2RlPg0KICAgICAqLw0KICAgIHB1\nYmxpYyBzdGF0aWMgdm9pZCBtYWluKENsYXNzIGMpIHsNCiAgICAgICAgVGVz\ndFJ1bm5lci5ydW4oYyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVG8g\nYmUgY2FsbGVkIGJ5IGNoaWxkLiBGaWd1cmVzIG91dCB0aGUgY2xhc3MgZnJv\nbSB0aGUgY2FsbGluZyBjb250ZXh0Lg0KICAgICAqLw0KICAgIHB1YmxpYyBz\ndGF0aWMgdm9pZCBtYWluKCkgew0KICAgICAgICBTdHJpbmcgY2FsbGVyID0g\nbmV3IFNlY3VyaXR5TWFuYWdlcigpIHsNCiAgICAgICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndENsYXNzQ29udGV4dCgpWzJdLmdldE5hbWUoKTsNCiAgICAgICAgICAgIH0N\nCiAgICAgICAgfS50b1N0cmluZygpOw0KDQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICBtYWluKENsYXNzLmZvck5hbWUoY2FsbGVyKSk7DQogICAgICAg\nIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24gY25mZSkgew0KICAg\nICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oY25mZS50b1N0\ncmluZygpKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAq\nIFJldHVybnMgdGhlIGphciBmaWxlIGluIHdoaWNoIHRoZSBjbGFzcyBpcyBj\nb250YWluZWQuDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHRoZSBqYXIgZmls\nZSwgb3Igbm9uZSBpZiB0aGUgY2xhc3MgaXMgbm90IGluIGEgamFyDQogICAg\nICogQHRocm93cyBGaWxlTm90Rm91bmRFeGNlcHRpb24gaWYgdGhlIGphciBm\naWxlIGNhbm5vdCBsb2NhdGVkDQogICAgICovDQogICAgcHVibGljIHN0YXRp\nYyBGaWxlIGdldEphckZpbGUoQ2xhc3MgY2xhenopIHRocm93cyBGaWxlTm90\nRm91bmRFeGNlcHRpb24gew0KICAgICAgICBVUkwgdXJsID0gY2xhenouZ2V0\nUmVzb3VyY2UoY2xhenouZ2V0TmFtZSgpLnN1YnN0cmluZygNCiAgICAgICAg\nICAgIGNsYXp6LmdldE5hbWUoKS5sYXN0SW5kZXhPZigiLiIpICsgMSkgKyAi\nLmNsYXNzIik7DQogICAgICAgIGlmICh1cmwgPT0gbnVsbCkNCiAgICAgICAg\nICAgIHRocm93IG5ldyBGaWxlTm90Rm91bmRFeGNlcHRpb24oY2xhenoudG9T\ndHJpbmcoKSk7DQoNCiAgICAgICAgU3RyaW5nIGZpbGUgPSB1cmwuZ2V0Rmls\nZSgpOw0KICAgICAgICBpZiAoZmlsZSA9PSBudWxsKQ0KICAgICAgICAgICAg\ndGhyb3cgbmV3IEZpbGVOb3RGb3VuZEV4Y2VwdGlvbih1cmwudG9TdHJpbmco\nKSk7DQogICAgICAgIGludCBpbmRleCA9IGZpbGUuaW5kZXhPZigiISIpOw0K\nICAgICAgICBpZiAoaW5kZXggPT0gLTEpDQogICAgICAgICAgICB0aHJvdyBu\nZXcgRmlsZU5vdEZvdW5kRXhjZXB0aW9uKGZpbGUpOw0KDQogICAgICAgIGZp\nbGUgPSBmaWxlLnN1YnN0cmluZygwLCBpbmRleCk7DQogICAgICAgIGZpbGUg\nPSBmaWxlLnN1YnN0cmluZygiZmlsZToiLmxlbmd0aCgpKTsNCg0KICAgICAg\nICBGaWxlIGYgPSBuZXcgRmlsZShmaWxlKTsNCiAgICAgICAgaWYgKCEoZi5p\nc0ZpbGUoKSkpDQogICAgICAgICAgICB0aHJvdyBuZXcgRmlsZU5vdEZvdW5k\nRXhjZXB0aW9uKGZpbGUpOw0KDQogICAgICAgIHJldHVybiBmLmdldEFic29s\ndXRlRmlsZSgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBudW1i\nZXIgb2YgbWlsbGlzZWNvbmRzIGVhY2ggdGVzdCBjYXNlIHdpbGwgaGF2ZSBm\nb3IgYSB0aW1lb3V0Lg0KICAgICAqLw0KICAgIHB1YmxpYyB2b2lkIHNldFRp\nbWVvdXQobG9uZyB0aW1lb3V0KSB7DQogICAgICAgIF90aW1lb3V0ID0gdGlt\nZW91dDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBUaGUgbnVtYmVyIG9m\nIG1pbGxpc2Vjb25kcyBlYWNoIHRlc3QgY2FzZSB3aWxsIGhhdmUgZm9yIGEg\ndGltZW91dC4NCiAgICAgKi8NCiAgICBwdWJsaWMgbG9uZyBnZXRUaW1lb3V0\nKCkgew0KICAgICAgICByZXR1cm4gX3RpbWVvdXQ7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogQSB3YXRjaGRvZyB0aGF0IGp1c3QgZXhpdHMgdGhlIEpW\nTSBpZiBhIHRlc3QgaGFzIG5vdCBjb21wbGV0ZWQgaW4NCiAgICAgKiBhIGNl\ncnRhaW4gYW1vdW50IG9mIHRpbWUuIFRoaXMgc3BlZWRzIHVwIHRoZSBtZWNo\nYW5pc20gb2YgZGV0ZXJtaW5pbmcNCiAgICAgKiBpZiBhIHRpbWVvdXQgaGFz\nIG9jY3VycmVkLCBzaW5jZSB3ZSBjYW4gZXhpdCB0aGUgZW50aXJlIHRlc3Qg\ncnVuDQogICAgICogaWYgYSB0ZXN0IGhhc24ndCBjb21wbGV0ZWQgaW4gYSBz\naG9ydGVkIGFtb3VudCBvZiB0aW1lIHRoYW4NCiAgICAgKiB0aGUgZ2xvYmFs\nIHRlc3QgdGltZW91dC4NCiAgICAgKg0KICAgICAqIEBhdXRob3IgTWFyYyBQ\ncnVkJ2hvbW1lYXV4DQogICAgICovDQogICAgcHJpdmF0ZSBzdGF0aWMgY2xh\nc3MgV2F0Y2hkb2dUaHJlYWQgZXh0ZW5kcyBUaHJlYWQgew0KDQogICAgICAg\nIHByaXZhdGUgZmluYWwgbG9uZyBfdGltZW91dG1zOw0KICAgICAgICBwcml2\nYXRlIGxvbmcgX2VuZHRpbWUgPSAtMTsNCiAgICAgICAgcHJpdmF0ZSBBYnN0\ncmFjdFRlc3RDYXNlIF9jdXJ0ZXN0ID0gbnVsbDsNCg0KICAgICAgICBwdWJs\naWMgV2F0Y2hkb2dUaHJlYWQoKSB7DQogICAgICAgICAgICBzdXBlcigiS29k\nbyB0ZXN0IGNhc2Ugd2F0Y2hkb2cgdGhyZWFkIik7DQogICAgICAgICAgICBz\nZXREYWVtb24odHJ1ZSk7DQoNCiAgICAgICAgICAgIGludCB0aW1lb3V0TWlu\nID0gbmV3IEludGVnZXINCiAgICAgICAgICAgICAgICAoU3lzdGVtLmdldFBy\nb3BlcnR5KCJhdXRvYnVpbGQudGVzdGNhc2UudGltZW91dCIsICIyMCIpKQ0K\nICAgICAgICAgICAgICAgIC5pbnRWYWx1ZSgpOw0KDQogICAgICAgICAgICBf\ndGltZW91dG1zID0gdGltZW91dE1pbiAqIDYwICogMTAwMDsNCiAgICAgICAg\nfQ0KDQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsNCiAgICAgICAgICAg\nIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgICAgICAgICAgc2xlZXAoMjAwKTsNCiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgew0KICAgICAgICAg\nICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChfZW5kdGltZSA+IDAg\nJiYgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgPiBfZW5kdGltZSkgew0K\nICAgICAgICAgICAgICAgICAgICBUaHJlYWQgcHJlVGltZW91dCA9IG5ldyBU\naHJlYWQNCiAgICAgICAgICAgICAgICAgICAgICAgICgiQXR0ZW1wdGluZyBw\ncmUtdGltZW91dCBmb3IgIiArIF9jdXJ0ZXN0KSB7DQogICAgICAgICAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7DQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgX2N1cnRlc3QucHJlVGltZW91dCgpOw0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9Ow0K\nICAgICAgICAgICAgICAgICAgICBwcmVUaW1lb3V0LnN0YXJ0KCk7DQoNCiAg\nICAgICAgICAgICAgICAgICAgLy8gd2FpdCBhIGxpdHRsZSB3aGlsZSBmb3Ig\ndGhlIHByZS10aW1lb3V0DQogICAgICAgICAgICAgICAgICAgIC8vIHRocmVh\nZCB0byBjb21wbGV0ZQ0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgICAgICAgICAgICAgcHJlVGltZW91dC5qb2luKDEwICogMTAw\nMCk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAg\nICAgICAvLyBnaXZlIGl0IGEgZmV3IG1vcmUgc2Vjb25kcy4uLg0KICAgICAg\nICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAg\nc2xlZXAoNSAqIDEwMDApOw0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAg\nICAgICAgICAgICAgICAgICAgLy8gbmV3IGVuZHRpbWU/IHJlc3VtZS4uLg0K\nICAgICAgICAgICAgICAgICAgICBpZiAoU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkgPCBfZW5kdGltZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOw0KDQogICAgICAgICAgICAgICAgICAgIG5ldyBFeGNlcHRpb24o\nInRlc3QgY2FzZSAiDQogICAgICAgICAgICAgICAgICAgICAgICArIChfY3Vy\ndGVzdCAhPSBudWxsID8gX2N1cnRlc3QuZ2V0TmFtZSgpDQogICAgICAgICAg\nICAgICAgICAgICAgICA6ICJVTktOT1dOIikgKyAiIHRpbWVkIG91dCBhZnRl\nciAiDQogICAgICAgICAgICAgICAgICAgICAgICArIF90aW1lb3V0bXMgKyAi\nbXMiKS5wcmludFN0YWNrVHJhY2UoKTsNCg0KICAgICAgICAgICAgICAgICAg\nICAvLyBhbHNvIHJ1biAia2lsbGFsbCAtUVVJVCBqYXZhIiB0byB0cnkgdG8g\nZ3JhYg0KICAgICAgICAgICAgICAgICAgICAvLyBhIHN0YWNrIHRyYWNlDQog\nICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAg\nICAgICBSdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjDQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKG5ldyBTdHJpbmdbXXsgImtpbGxhbGwiLCAiLVFV\nSVQiLCAiamF2YSIgfSk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAg\nICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAg\nICAgc2xlZXAoMTAwMCk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7DQogICAgICAgICAgICAgICAg\nICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAvLyBub3cgYWN0dWFsbHkg\nZXhpdA0KICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXhpdCgxMTEpOw0K\nICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0K\nDQogICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBlbnRlcmluZ1Rl\nc3QoQWJzdHJhY3RUZXN0Q2FzZSB0ZXN0KSB7DQogICAgICAgICAgICBsb25n\nIHRpbWVvdXQgPSB0ZXN0LmdldFRpbWVvdXQoKTsNCiAgICAgICAgICAgIGlm\nICh0aW1lb3V0IDw9IDApDQogICAgICAgICAgICAgICAgdGltZW91dCA9IF90\naW1lb3V0bXM7DQoNCiAgICAgICAgICAgIF9lbmR0aW1lID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCkgKyB0aW1lb3V0Ow0KICAgICAgICAgICAgX2N1\ncnRlc3QgPSB0ZXN0Ow0KDQogICAgICAgICAgICBpZiAoIWlzQWxpdmUoKSkN\nCiAgICAgICAgICAgICAgICBzdGFydCgpOw0KICAgICAgICB9DQoNCiAgICAg\nICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGxlYXZpbmdUZXN0KEFic3Ry\nYWN0VGVzdENhc2UgdGVzdCkgew0KICAgICAgICAgICAgX2VuZHRpbWUgPSAt\nMTsNCiAgICAgICAgICAgIF9jdXJ0ZXN0ID0gbnVsbDsNCiAgICAgICAgfQ0K\nICAgIH0NCn0NCg==\n","encoding":"base64"}

