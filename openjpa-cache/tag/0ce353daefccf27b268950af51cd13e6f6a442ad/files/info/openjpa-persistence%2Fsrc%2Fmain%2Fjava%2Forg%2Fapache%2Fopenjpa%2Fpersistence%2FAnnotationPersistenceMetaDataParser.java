{"sha":"f8461f274ab3fa38858bd4a03a26dd225b081dd4","node_id":"MDQ6QmxvYjIwNjM2NDpmODQ2MWYyNzRhYjNmYTM4ODU4YmQ0YTAzYTI2ZGQyMjViMDgxZGQ0","size":59192,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f8461f274ab3fa38858bd4a03a26dd225b081dd4","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBqYXZhLmlvLkZpbGU7Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5h\nbm5vdGF0aW9uLkFubm90YXRpb247CmltcG9ydCBqYXZhLmxhbmcucmVmbGVj\ndC5Bbm5vdGF0ZWRFbGVtZW50OwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9y\ndCBqYXZhLmxhbmcucmVmbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLmxhbmcu\ncmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0IGphdmEubmV0LlVSSVN5bnRheEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LlVSTDsKaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29tcGFy\nYXRvcjsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQmFzaWM7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5DYXNjYWRlVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVt\nYmVkZGFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRlZDsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGVkSWQ7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5FbnRpdHk7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5FbnRpdHlMaXN0ZW5lcnM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5FeGNsdWRlRGVmYXVsdExpc3RlbmVyczsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkV4Y2x1ZGVTdXBlcmNsYXNzTGlzdGVuZXJzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRmV0Y2hUeXBlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRmx1c2hNb2RlVHlwZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLkdlbmVyYXRlZFZhbHVlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuR2Vu\nZXJhdGlvblR5cGU7CmltcG9ydCBzdGF0aWMgamF2YXgucGVyc2lzdGVuY2Uu\nR2VuZXJhdGlvblR5cGUuQVVUTzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLklkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuSWRDbGFzczsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkxvYjsKaW1wb3J0IGphdmF4LnBlcnNpc3Rl\nbmNlLk1hbnlUb01hbnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYW55\nVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBLZXk7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5NYXBwZWRTdXBlcmNsYXNzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTmFtZWROYXRpdmVRdWVyaWVzOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuTmFtZWROYXRpdmVRdWVyeTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLk5hbWVkUXVlcmllczsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLk5hbWVkUXVlcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5PbmVUb01hbnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PbmVUb09u\nZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk9yZGVyQnk7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5Qb3N0TG9hZDsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlBvc3RQZXJzaXN0OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nUG9zdFJlbW92ZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBvc3RVcGRh\ndGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QcmVQZXJzaXN0OwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuUHJlUmVtb3ZlOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuUHJlVXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuUXVlcnlIaW50OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU2VxdWVu\nY2VHZW5lcmF0b3I7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5WZXJzaW9u\nOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuQmVh\nbkxpZmVjeWNsZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5ldmVudC5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZXZlbnQuTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuanBxbC5KUFFM\nUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNv\nbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5s\nb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNz\nTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5EZWxl\nZ2F0aW5nTWV0YURhdGFGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkxpZmVjeWNsZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuTWV0YURhdGFGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuTWV0YURhdGFNb2RlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk9yZGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuUXVlcnlNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5VcGRhdGVTdHJhdGVnaWVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhRGVmYXVsdHM7\nCmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNl\nLk1ldGFEYXRhVGFnLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgc2VycC51\ndGlsLk51bWJlcnM7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgog\nKiBQZXJzaXN0ZW5jZSBhbm5vdGF0aW9uIG1ldGFkYXRhIHBhcnNlci4gQ3Vy\ncmVudGx5IGRvZXMgbm90IHBhcnNlCiAqIGRlcGxveW1lbnQgZGVzY3JpcHRv\ncnMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RldmUg\nS2ltCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBBbm5vdGF0aW9u\nUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlcgogICAgaW1wbGVtZW50cyBNZXRh\nRGF0YU1vZGVzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6\nZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEFubm90\nYXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2VyLmNsYXNzKTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBNYXA8Q2xhc3MsIE1ldGFEYXRhVGFnPiBf\ndGFncyA9CiAgICAgICAgbmV3IEhhc2hNYXA8Q2xhc3MsIE1ldGFEYXRhVGFn\nPigpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgX3RhZ3MucHV0KEVtYmVkZGVk\nSWQuY2xhc3MsIEVNQkVEREVEX0lEKTsKICAgICAgICBfdGFncy5wdXQoRW50\naXR5TGlzdGVuZXJzLmNsYXNzLCBFTlRJVFlfTElTVEVORVJTKTsKICAgICAg\nICBfdGFncy5wdXQoRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnMuY2xhc3MsIEVY\nQ0xVREVfREVGQVVMVF9MSVNURU5FUlMpOwogICAgICAgIF90YWdzLnB1dChF\neGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVycy5jbGFzcywKICAgICAgICAgICAg\nRVhDTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3Mu\ncHV0KEZsdXNoTW9kZVR5cGUuY2xhc3MsIEZMVVNIX01PREUpOwogICAgICAg\nIF90YWdzLnB1dChHZW5lcmF0ZWRWYWx1ZS5jbGFzcywgR0VORVJBVEVEX1ZB\nTFVFKTsKICAgICAgICBfdGFncy5wdXQoSWQuY2xhc3MsIElEKTsKICAgICAg\nICBfdGFncy5wdXQoSWRDbGFzcy5jbGFzcywgSURfQ0xBU1MpOwogICAgICAg\nIF90YWdzLnB1dChNYXBLZXkuY2xhc3MsIE1BUF9LRVkpOwogICAgICAgIF90\nYWdzLnB1dChOYW1lZE5hdGl2ZVF1ZXJpZXMuY2xhc3MsIE5BVElWRV9RVUVS\nSUVTKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVyeS5jbGFz\ncywgTkFUSVZFX1FVRVJZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWRRdWVy\naWVzLmNsYXNzLCBRVUVSSUVTKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWRR\ndWVyeS5jbGFzcywgUVVFUlkpOwogICAgICAgIF90YWdzLnB1dChPcmRlckJ5\nLmNsYXNzLCBPUkRFUl9CWSk7CiAgICAgICAgX3RhZ3MucHV0KFBvc3RMb2Fk\nLmNsYXNzLCBQT1NUX0xPQUQpOwogICAgICAgIF90YWdzLnB1dChQb3N0UGVy\nc2lzdC5jbGFzcywgUE9TVF9QRVJTSVNUKTsKICAgICAgICBfdGFncy5wdXQo\nUG9zdFJlbW92ZS5jbGFzcywgUE9TVF9SRU1PVkUpOwogICAgICAgIF90YWdz\nLnB1dChQb3N0VXBkYXRlLmNsYXNzLCBQT1NUX1VQREFURSk7CiAgICAgICAg\nX3RhZ3MucHV0KFByZVBlcnNpc3QuY2xhc3MsIFBSRV9QRVJTSVNUKTsKICAg\nICAgICBfdGFncy5wdXQoUHJlUmVtb3ZlLmNsYXNzLCBQUkVfUkVNT1ZFKTsK\nICAgICAgICBfdGFncy5wdXQoUHJlVXBkYXRlLmNsYXNzLCBQUkVfVVBEQVRF\nKTsKICAgICAgICBfdGFncy5wdXQoU2VxdWVuY2VHZW5lcmF0b3IuY2xhc3Ms\nIFNFUV9HRU5FUkFUT1IpOwogICAgICAgIF90YWdzLnB1dChWZXJzaW9uLmNs\nYXNzLCBWRVJTSU9OKTsKICAgICAgICBfdGFncy5wdXQoRGF0YUNhY2hlLmNs\nYXNzLCBEQVRBX0NBQ0hFKTsKICAgICAgICBfdGFncy5wdXQoRGF0YVN0b3Jl\nSWQuY2xhc3MsIERBVEFTVE9SRV9JRCk7CiAgICAgICAgX3RhZ3MucHV0KERl\ncGVuZGVudC5jbGFzcywgREVQRU5ERU5UKTsKICAgICAgICBfdGFncy5wdXQo\nRGV0YWNoZWRTdGF0ZS5jbGFzcywgREVUQUNIRURfU1RBVEUpOwogICAgICAg\nIF90YWdzLnB1dChFbGVtZW50RGVwZW5kZW50LmNsYXNzLCBFTEVNX0RFUEVO\nREVOVCk7CiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRUeXBlLmNsYXNzLCBF\nTEVNX1RZUEUpOwogICAgICAgIF90YWdzLnB1dChFeHRlcm5hbFZhbHVlcy5j\nbGFzcywgRVhURVJOQUxfVkFMUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4dGVy\nbmFsaXplci5jbGFzcywgRVhURVJOQUxJWkVSKTsKICAgICAgICBfdGFncy5w\ndXQoRmFjdG9yeS5jbGFzcywgRkFDVE9SWSk7CiAgICAgICAgX3RhZ3MucHV0\nKEZldGNoR3JvdXAuY2xhc3MsIEZFVENIX0dST1VQKTsKICAgICAgICBfdGFn\ncy5wdXQoRmV0Y2hHcm91cHMuY2xhc3MsIEZFVENIX0dST1VQUyk7CiAgICAg\nICAgX3RhZ3MucHV0KEludmVyc2VMb2dpY2FsLmNsYXNzLCBJTlZFUlNFX0xP\nR0lDQUwpOwogICAgICAgIF90YWdzLnB1dChLZXlEZXBlbmRlbnQuY2xhc3Ms\nIEtFWV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1dChLZXlUeXBlLmNs\nYXNzLCBLRVlfVFlQRSk7CiAgICAgICAgX3RhZ3MucHV0KExvYWRGZXRjaEdy\nb3VwLmNsYXNzLCBMT0FEX0ZFVENIX0dST1VQKTsKICAgICAgICBfdGFncy5w\ndXQoTFJTLmNsYXNzLCBMUlMpOwogICAgICAgIF90YWdzLnB1dChSZWFkT25s\neS5jbGFzcywgUkVBRF9PTkxZKTsKICAgICAgICBfdGFncy5wdXQoVHlwZS5j\nbGFzcywgVFlQRSk7CiAgICB9CgogICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBfY29uZjsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9s\nb2c7CiAgICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3MgPSBu\ndWxsOwogICAgcHJpdmF0ZSBDbGFzc0xvYWRlciBfZW52TG9hZGVyID0gbnVs\nbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3ZlcnJpZGUgPSBmYWxzZTsKICAg\nIHByaXZhdGUgaW50IF9tb2RlID0gTU9ERV9OT05FOwoKICAgIC8vIHBhY2th\nZ2VzIGFuZCB0aGVpciBwYXJzZSBtb2RlcwogICAgcHJpdmF0ZSBmaW5hbCBN\nYXA8UGFja2FnZSwgSW50ZWdlcj4gX3BrZ3MgPSBuZXcgSGFzaE1hcDxQYWNr\nYWdlLCBJbnRlZ2VyPigpOwoKICAgIC8vIHRoZSBjbGFzcyB3ZSB3ZXJlIGlu\ndm9rZWQgdG8gcGFyc2UKICAgIHByaXZhdGUgQ2xhc3MgX2NscyA9IG51bGw7\nCiAgICBwcml2YXRlIEZpbGUgX2ZpbGUgPSBudWxsOwoKICAgIC8qKgogICAg\nICogQ29uc3RydWN0b3I7IHN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJz\nZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25m\nID0gY29uZjsKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX01FVEFEQVRBKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbmZpZ3VyYXRpb24gc3VwcGxpZWQgb24gY29uc3RydWN0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29u\nZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNZXRhZGF0YSBsb2cuCiAgICAgKi8KICAgIHB1Ymxp\nYyBMb2cgZ2V0TG9nKCkgewogICAgICAgIHJldHVybiBfbG9nOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgcmVwb3NpdG9yeSBmb3IgdGhp\ncyBwYXJzZXIuIElmIG5vbmUgaGFzIGJlZW4gc2V0LAogICAgICogY3JlYXRl\nIGEgbmV3IHJlcG9zaXRvcnkgYW5kIHNldHMgaXQuCiAgICAgKi8KICAgIHB1\nYmxpYyBNZXRhRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgpIHsKICAg\nICAgICBpZiAoX3JlcG9zID09IG51bGwpIHsKICAgICAgICAgICAgTWV0YURh\ndGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYubmV3TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgTWV0YURhdGFGYWN0b3J5IG1k\nZiA9IHJlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAgICAgICBp\nZiAobWRmIGluc3RhbmNlb2YgRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeSkK\nICAgICAgICAgICAgICAgIG1kZiA9ICgoRGVsZWdhdGluZ01ldGFEYXRhRmFj\ndG9yeSkgbWRmKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgICAg\nICBpZiAobWRmIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VNZXRhRGF0YUZhY3Rv\ncnkpCiAgICAgICAgICAgICAgICAoKFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0\nb3J5KSBtZGYpLnNldEFubm90YXRpb25QYXJzZXIodGhpcyk7CiAgICAgICAg\nICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX3JlcG9zOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtZXRhZGF0\nYSByZXBvc2l0b3J5IGZvciB0aGlzIHBhcnNlci4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0UmVwb3NpdG9yeShNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nb3MpIHsKICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIg\ndG8gcGFzcyBvbiB0byBwYXJzZWQKICAgICAqIG1ldGFkYXRhIGluc3RhbmNl\ncy4KICAgICAqLwogICAgcHVibGljIENsYXNzTG9hZGVyIGdldEVudkNsYXNz\nTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfZW52TG9hZGVyOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxv\nYWRlciB0byBwYXNzIG9uIHRvIHBhcnNlZAogICAgICogbWV0YWRhdGEgaW5z\ndGFuY2VzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZDbGFzc0xv\nYWRlcihDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfZW52TG9hZGVy\nID0gbG9hZGVyOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBh\nbGxvdyBsYXRlciBwYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBv\ndmVycmlkZQogICAgICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNh\nbWUgY2xhc3MuIERlZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdo\nZW4gYSB0b29sIGlzIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0\naW9uIHBhcnRpYWwgbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJl\nIHVzZWQgZXZlbiB3aGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhl\ncgogICAgICogbG9jYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGdldE1hcHBpbmdPdmVycmlkZSgpIHsKICAgICAgICByZXR1cm4gX292ZXJy\naWRlOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBs\nYXRlciBwYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBvdmVycmlk\nZQogICAgICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNhbWUgY2xh\nc3MuIERlZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdoZW4gYSB0\nb29sIGlzIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0aW9uIHBh\ncnRpYWwgbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQg\nZXZlbiB3aGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhlcgogICAg\nICogbG9jYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1hcHBp\nbmdPdmVycmlkZShib29sZWFuIG92ZXJyaWRlKSB7CiAgICAgICAgX292ZXJy\naWRlID0gb3ZlcnJpZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFy\nc2UgbW9kZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNb2RlKCkgewog\nICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBwYXJzZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2Rl\nKGludCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0g\nTU9ERV9OT05FKQogICAgICAgICAgICBfbW9kZSA9IE1PREVfTk9ORTsKICAg\nICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX21vZGUgfD0gbW9kZTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9tb2RlICY9IH5tb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBfbW9k\nZSA9IG1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9kZSgpIHsK\nICAgICAgICByZXR1cm4gKF9tb2RlICYgTU9ERV9NRVRBKSAhPSAwOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRl\ncnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIGJvb2xlYW4gaXNRdWVyeU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChf\nbW9kZSAmIE1PREVfUVVFUlkpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsg\nI2dldE1vZGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01h\ncHBpbmdNb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX01B\nUFBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRy\ndWUgaWYgd2UncmUgaW4gbWFwcGluZyBtb2RlIG9yIGluIG1ldGFkYXRhIG1v\nZGUgd2l0aAogICAgICogbWFwcGluZyBvdmVyaWRlIGVuYWJsZWQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ092ZXJyaWRlTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gaXNNYXBwaW5nTW9kZSgpIHx8IChfb3Zl\ncnJpZGUgJiYgaXNNZXRhRGF0YU1vZGUoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDbGVhciBjYWNoZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNs\nZWFyKCkgewogICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgIF9maWxlID0g\nbnVsbDsKICAgICAgICBfcGtncy5jbGVhcigpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgcGVyc2lzdGVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZl\nbiBjbGFzcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcGFyc2UoQ2xhc3Mg\nY2xzKSB7CiAgICAgICAgaWYgKF9sb2cuaXNJbmZvRW5hYmxlZCgpKQogICAg\nICAgICAgICBfbG9nLmluZm8oX2xvYy5nZXQoInBhcnNlLWNsYXNzIiwgY2xz\nLmdldE5hbWUoKSkpOwoKICAgICAgICBfY2xzID0gY2xzOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHBhcnNlUGFja2FnZUFubm90YXRpb25zKCk7CiAg\nICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IHBhcnNlQ2xhc3NBbm5v\ndGF0aW9ucygpOwogICAgICAgICAgICB1cGRhdGVTb3VyY2VNb2RlKG1ldGEp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9jbHMgPSBudWxs\nOwogICAgICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBzb3VyY2UgbW9kZSB0byB0aGUg\nY2xhc3MgcGFja2FnZSBhbmQgY2xhc3MgdG8gaW5kaWNhdGUgdGhhdAogICAg\nICogd2UndmUgZnVsbHkgcGFyc2VkIHRoZW0uCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB1cGRhdGVTb3VyY2VNb2RlKENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChfY2xzLmdldFBhY2thZ2UoKSAhPSBudWxsKQogICAg\nICAgICAgICBhZGRTb3VyY2VNb2RlKF9jbHMuZ2V0UGFja2FnZSgpLCBfbW9k\nZSk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKF9tb2RlLCB0cnVlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIGluZm9ybWF0aW9uIGluIHBhY2thZ2UtbGV2ZWwgY2xh\nc3MgYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZVBhY2thZ2VBbm5vdGF0aW9ucygpIHsKICAgICAgICBQYWNrYWdlIHBrZyA9\nIF9jbHMuZ2V0UGFja2FnZSgpOwogICAgICAgIGlmIChwa2cgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpbnQgcGtnTW9kZSA9IGdl\ndFNvdXJjZU1vZGUocGtnKTsKICAgICAgICBpZiAocGtnTW9kZSA9PSAwICYm\nIF9sb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLmluZm8o\nX2xvYy5nZXQoInBhcnNlLXBhY2thZ2UiLCBfY2xzLmdldE5hbWUoKSkpOwog\nICAgICAgIGlmICgocGtnTW9kZSAmIF9tb2RlKSA9PSBfbW9kZSkgLy8gYWxy\nZWFkeSB2aXNpdGVkCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWV0\nYURhdGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDog\ncGtnLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0\nYWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAg\nICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5k\nbGVVbmtub3duUGFja2FnZUFubm90YXRpb24ocGtnLCBhbm5vKTsKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVf\nUVVFUklFUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUo\nKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAg\nICAgICAgICAgICAgIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKHBrZywKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICgoTmFtZWROYXRpdmVRdWVyaWVz\nKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FVRVJZOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9E\nRV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VO\nYW1lZE5hdGl2ZVF1ZXJpZXMocGtnLCAoTmFtZWROYXRpdmVRdWVyeSkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIFFVRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVl\ncnlNb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkUXVlcmllcyhwa2csICgo\nTmFtZWRRdWVyaWVzKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUlk6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKHBrZ01vZGUg\nJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBw\nYXJzZU5hbWVkUXVlcmllcyhwa2csIChOYW1lZFF1ZXJ5KSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nU0VRX0dFTkVSQVRPUjoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAg\nKHBrZ01vZGUgJiBNT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgICAg\nICAgICAgICAgIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IocGtnLCAoU2VxdWVu\nY2VHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVu\nc3VwcG9ydGVkIiwgcGtnLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5v\nLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gYWx3YXlzIHBhcnNlIG1hcHBpbmcgc3R1ZmYgYWZ0ZXIgbWV0YWRh\ndGEgc3R1ZmYsIGluIGNhc2UgdGhlcmUgYXJlCiAgICAgICAgLy8gZGVwZW5k\nZW5jaWVzIG9uIG1ldGFkYXRhCiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJy\naWRlTW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9NQVBQSU5HKSA9PSAwKQog\nICAgICAgICAgICBwYXJzZVBhY2thZ2VNYXBwaW5nQW5ub3RhdGlvbnMocGtn\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBhY2thZ2UgbWFwcGlu\nZyBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFy\nc2VQYWNrYWdlTWFwcGluZ0Fubm90YXRpb25zKFBhY2thZ2UgcGtnKSB7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRs\nZSB1bmtub3duIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBoYW5kbGVVbmtub3duUGFja2FnZUFubm90YXRpb24oUGFja2Fn\nZSBwa2csCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBt\nb2RlIGZvciB0aGUgZ2l2ZW4gcGFja2FnZS4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgZ2V0U291cmNlTW9kZShQYWNrYWdlIHBrZykgewogICAgICAgIE51\nbWJlciBudW0gPSBfcGtncy5nZXQocGtnKTsKICAgICAgICByZXR1cm4gKG51\nbSA9PSBudWxsKSA/IDAgOiBudW0uaW50VmFsdWUoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCB0byB0aGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZl\nbiBwYWNrYWdlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU291cmNl\nTW9kZShQYWNrYWdlIHBrZywgaW50IG1vZGUpIHsKICAgICAgICBJbnRlZ2Vy\nIG51bSA9IF9wa2dzLmdldChwa2cpOwogICAgICAgIGlmIChudW0gPT0gbnVs\nbCkKICAgICAgICAgICAgbnVtID0gTnVtYmVycy52YWx1ZU9mKG1vZGUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgbnVtID0gTnVtYmVycy52YWx1ZU9m\nKG51bS5pbnRWYWx1ZSgpIHwgbW9kZSk7CiAgICAgICAgX3BrZ3MucHV0KHBr\nZywgbnVtKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgYW5ub3RhdGlv\nbnMgZm9yIHRoZSBjdXJyZW50IHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUg\nQ2xhc3NNZXRhRGF0YSBwYXJzZUNsYXNzQW5ub3RhdGlvbnMoKSB7CiAgICAg\nICAgLy8gY2hlY2sgaW1tZWRpYXRlbHkgd2hldGhlciB0aGUgdXNlciBpcyB1\nc2luZyBhbnkgYW5ub3RhdGlvbnMsCiAgICAgICAgLy8gcmVnYXJkbGVzcyBv\nZiBtb2RlLiAgdGhpcyBwcmV2ZW50cyBhZGRpbmcgbm9uLWVudGl0eSBjbGFz\nc2VzIHRvCiAgICAgICAgLy8gcmVwb3NpdG9yeSBpZiB3ZSdyZSBpZ25vcmlu\nZyB0aGVzZSBhbm5vdGF0aW9ucyBpbiBtYXBwaW5nIG1vZGUKICAgICAgICBp\nZiAoIV9jbHMuaXNBbm5vdGF0aW9uUHJlc2VudChFbnRpdHkuY2xhc3MpCiAg\nICAgICAgICAgICYmICFfY2xzLmlzQW5ub3RhdGlvblByZXNlbnQoRW1iZWRk\nYWJsZS5jbGFzcykKICAgICAgICAgICAgJiYgIV9jbHMuaXNBbm5vdGF0aW9u\nUHJlc2VudChNYXBwZWRTdXBlcmNsYXNzLmNsYXNzKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIC8vIGZpbmQgLyBjcmVhdGUgbWV0YWRh\ndGEKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBnZXRNZXRhRGF0YSgp\nOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBFbnRpdHkgZW50aXR5ID0gKEVudGl0eSkgX2Ns\ncy5nZXRBbm5vdGF0aW9uKEVudGl0eS5jbGFzcyk7CiAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpIHsKICAgICAgICAgICAgLy8gd2hpbGUgdGhlIHNw\nZWMgb25seSBwcm92aWRlcyBmb3IgZW1iZWRkZWQgZXhjbHVzaXZlLCBpdCBk\nb2Vzbid0CiAgICAgICAgICAgIC8vIHNlZW0gaGFyZCB0byBzdXBwb3J0IG90\naGVyd2lzZQogICAgICAgICAgICBpZiAoZW50aXR5ID09IG51bGwpCiAgICAg\nICAgICAgICAgICBtZXRhLnNldEVtYmVkZGVkT25seSh0cnVlKTsKICAgICAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtZXRhLnNldEVtYmVkZGVk\nT25seShmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmlzRW1wdHkoZW50aXR5Lm5hbWUoKSkpCiAgICAgICAgICAgICAgICAgICAg\nbWV0YS5zZXRUeXBlQWxpYXMoZW50aXR5Lm5hbWUoKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIHRyYWNrIGZldGNoIGdyb3VwcyB0\nbyBwYXJzZSB0aGVtIGFmdGVyIGZpZWxkcywgc2luY2UgdGhleQogICAgICAg\nIC8vIHJlbHkgb24gZmllbGQgbWV0YWRhdGEKICAgICAgICBGZXRjaEdyb3Vw\nW10gZmdzID0gbnVsbDsKICAgICAgICBEZXRhY2hlZFN0YXRlIGRldGFjaGVk\nID0gbnVsbDsKCiAgICAgICAgLy8gdHJhY2sgbGlzdGVuZXJzIHNpbmNlIHdl\nIG5lZWQgdG8gbWVyZ2UgdGhlbSB3aXRoIGVudGl0eSBjYWxsYmFja3MKICAg\nICAgICBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBsaXN0ZW5l\ncnMgPSBudWxsOwogICAgICAgIE1ldGFEYXRhVGFnIHRhZzsKICAgICAgICBm\nb3IgKEFubm90YXRpb24gYW5ubyA6IF9jbHMuZ2V0RGVjbGFyZWRBbm5vdGF0\naW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFu\nbm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25DbGFzc0Fubm90YXRp\nb24obWV0YSwgYW5ubyk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAg\nICAgICAgICAgIGNhc2UgRU5USVRZX0xJU1RFTkVSUzoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbGlzdGVuZXJzID0gcGFyc2VFbnRpdHlMaXN0ZW5lcnMobWV0\nYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChFbnRpdHlMaXN0ZW5l\ncnMpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFWENMVURFX0RFRkFVTFRfTElTVEVORVJTOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBtZXRhLmdldExpZmVjeWNsZU1ldGFEYXRhKCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRJZ25vcmVTeXN0ZW1M\naXN0ZW5lcnModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNURU5F\nUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEuZ2V0TGlmZWN5Y2xlTWV0\nYURhdGEoKS5zZXRJZ25vcmVTdXBlcmNsYXNzQ2FsbGJhY2tzCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAoTGlmZWN5Y2xlTWV0YURhdGEuSUdOT1JF\nX0hJR0gpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBGTFVTSF9NT0RFOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICB3\nYXJuRmx1c2hNb2RlKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBJRF9DTEFTUzoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbWV0YS5zZXRPYmplY3RJZFR5cGUoKChJZENsYXNzKSBhbm5v\nKS52YWx1ZSgpLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FVRVJJRVM6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKF9jbHMsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoKE5hbWVkTmF0aXZlUXVlcmllcykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSWToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJpZXMoX2NscywgKE5hbWVkTmF0\naXZlUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBRVUVSSUVTOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc1F1ZXJ5TW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAg\nICBwYXJzZU5hbWVkUXVlcmllcyhfY2xzLCAoKE5hbWVkUXVlcmllcykgYW5u\nbykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFFVRVJZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc1F1ZXJ5TW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJz\nZU5hbWVkUXVlcmllcyhfY2xzLCAoTmFtZWRRdWVyeSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNF\nUV9HRU5FUkFUT1I6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGlu\nZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJz\nZVNlcXVlbmNlR2VuZXJhdG9yKF9jbHMsIChTZXF1ZW5jZUdlbmVyYXRvcikg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIERBVEFfQ0FDSEU6CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBh\ncnNlRGF0YUNhY2hlKG1ldGEsIChEYXRhQ2FjaGUpIGFubm8pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBEQVRB\nU1RPUkVfSUQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRGF0YVN0b3Jl\nSWQobWV0YSwgKERhdGFTdG9yZUlkKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREVUQUNIRURfU1RB\nVEU6CiAgICAgICAgICAgICAgICAgICAgZGV0YWNoZWQgPSAoRGV0YWNoZWRT\ndGF0ZSkgYW5ubzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgRkVUQ0hfR1JPVVA6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZncyA9IG5ldyBGZXRjaEdyb3VwW117IChGZXRjaEdyb3VwKSBhbm5v\nIH07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEZFVENIX0dST1VQUzoKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZmdz\nID0gKChGZXRjaEdyb3VwcykgYW5ubykudmFsdWUoKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsIF9jbHMsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAg\nICAgICAgICBwYXJzZURldGFjaGVkU3RhdGUobWV0YSwgZGV0YWNoZWQpOwoK\nICAgICAgICAgICAgLy8gbWVyZ2UgY2FsbGJhY2sgbWV0aG9kcyB3aXRoIGRl\nY2xhcmVkIGxpc3RlbmVycwogICAgICAgICAgICBpbnRbXSBoaWdocyA9IG51\nbGw7CiAgICAgICAgICAgIGlmIChsaXN0ZW5lcnMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgaGlnaHMgPSBuZXcgaW50W2xpc3RlbmVycy5sZW5ndGhd\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaXN0ZW5l\ncnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3Rl\nbmVyc1tpXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdo\nc1tpXSA9IGxpc3RlbmVyc1tpXS5zaXplKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcmVjb3JkQ2FsbGJhY2tzKG1ldGEsIHBhcnNlQ2FsbGJhY2tN\nZXRob2RzKF9jbHMsIGxpc3RlbmVycywgZmFsc2UsCiAgICAgICAgICAgICAg\nICBmYWxzZSwgZ2V0UmVwb3NpdG9yeSgpKSwgaGlnaHMsIGZhbHNlKTsKCiAg\nICAgICAgICAgIC8vIHNjYW4gcG9zc2libHkgbm9uLVBDIGhpZXJhcmNoeSBm\nb3IgY2FsbGJhY2tzLgogICAgICAgICAgICAvLyByZWR1bmRhbnQgZm9yIFBD\nIHN1cGVyY2xhc3MgYnV0IHdlIGRvbid0IGtub3cgdGhhdCB5ZXQKICAgICAg\nICAgICAgLy8gc28gbGV0IExpZmVjeWNsZU1ldGFEYXRhIGRldGVybWluZSB0\naGF0CiAgICAgICAgICAgIGlmICghT2JqZWN0LmNsYXNzLmVxdWFscyhfY2xz\nLmdldFN1cGVyY2xhc3MoKSkpIHsKICAgICAgICAgICAgICAgIHJlY29yZENh\nbGxiYWNrcyhtZXRhLCBwYXJzZUNhbGxiYWNrTWV0aG9kcyhfY2xzLmdldFN1\ncGVyY2xhc3MoKSwKICAgICAgICAgICAgICAgICAgICBudWxsLCB0cnVlLCBm\nYWxzZSwgZ2V0UmVwb3NpdG9yeSgpKSwgbnVsbCwgdHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBm\nbWQgOiBtZXRhLmdldERlY2xhcmVkRmllbGRzKCkpCiAgICAgICAgICAgIGlm\nIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdF\nX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBwYXJzZU1lbWJlckFubm90\nYXRpb25zKGZtZCk7CiAgICAgICAgLy8gcGFyc2UgZmV0Y2ggZ3JvdXBzIGFm\ndGVyIGZpZWxkcwogICAgICAgIGlmIChmZ3MgIT0gbnVsbCkKICAgICAgICAg\nICAgcGFyc2VGZXRjaEdyb3VwcyhtZXRhLCBmZ3MpOwoKICAgICAgICAvLyBh\nbHdheXMgcGFyc2UgbWFwcGluZyBhZnRlciBtZXRhZGF0YSBpbiBjYXNlIHRo\nZXJlIGFyZSBkZXBlbmRlbmNpZXMKICAgICAgICBpZiAoaXNNYXBwaW5nT3Zl\ncnJpZGVNb2RlKCkpIHsKICAgICAgICAgICAgcGFyc2VDbGFzc01hcHBpbmdB\nbm5vdGF0aW9ucyhtZXRhKTsKICAgICAgICAgICAgZm9yIChGaWVsZE1ldGFE\nYXRhIGZtZCA6IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKSkKICAgICAgICAg\nICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURh\ndGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICAgICAgcGFy\nc2VNZW1iZXJNYXBwaW5nQW5ub3RhdGlvbnMoZm1kKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJz\nZSBjbGFzcyBtYXBwaW5nIGFubm90YXRpb25zLgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCBwYXJzZUNsYXNzTWFwcGluZ0Fubm90YXRpb25zKENsYXNz\nTWV0YURhdGEgbWV0YSkgewogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cg\nc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBhbm5vdGF0aW9ucy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFuZGxlVW5rbm93bkNsYXNz\nQW5ub3RhdGlvbihDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgQW5ub3Rh\ndGlvbiBhbm5vKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIC8qKgogICAgICogRmluZCBvciBjcmVhdGUgbWV0YWRhdGEgZm9yIHRoZSBn\naXZlbiB0eXBlLiBNYXkgcmV0dXJuIG51bGwgaWYKICAgICAqIHRoaXMgY2xh\nc3MgaGFzIGFscmVhZHkgYmVlbiBwYXJzZWQgZnVsbHkuCiAgICAgKi8KICAg\nIHByaXZhdGUgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0Q2Fj\naGVkTWV0YURhdGEoX2Nscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCAm\nJgogICAgICAgICAgICAoKGlzTWV0YURhdGFNb2RlKCkgJiYgKG1ldGEuZ2V0\nU291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAhPSAwKSB8fAogICAgICAgICAg\nICAgICAgKGlzTWFwcGluZ01vZGUoKSAmJgogICAgICAgICAgICAgICAgICAg\nIChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUFQUElORykgIT0gMCkp\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZHVwLW1ldGFkYXRh\nIiwgX2Nscy5nZXROYW1lKCkpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICBpZiAobWV0YSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkTWV0YURhdGEoX2Ns\ncyk7CiAgICAgICAgICAgIG1ldGEuc2V0RW52Q2xhc3NMb2FkZXIoX2Vudkxv\nYWRlcik7CiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX05P\nTkUpOwogICAgICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxl\nKCksIG1ldGEuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG1ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIHNvdXJjZSBmaWxlIHdlJ3JlIHBhcnNpbmcuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBGaWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAgaWYgKF9m\naWxlICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfZmlsZTsKCiAgICAg\nICAgQ2xhc3MgY2xzID0gX2NsczsKICAgICAgICB3aGlsZSAoY2xzLmdldEVu\nY2xvc2luZ0NsYXNzKCkgIT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xz\nLmdldEVuY2xvc2luZ0NsYXNzKCk7CgogICAgICAgIFN0cmluZyByc3JjID0g\nU3RyaW5nVXRpbHMucmVwbGFjZShjbHMuZ2V0TmFtZSgpLCAiLiIsICIvIik7\nCiAgICAgICAgVVJMIHVybCA9IGNscy5nZXRDbGFzc0xvYWRlcigpLmdldFJl\nc291cmNlKHJzcmMgKyAiLmphdmEiKTsKICAgICAgICBpZiAodXJsID09IG51\nbGwpIHsKICAgICAgICAgICAgdXJsID0gY2xzLmdldENsYXNzTG9hZGVyKCku\nZ2V0UmVzb3VyY2UocnNyYyArICIuY2xhc3MiKTsKICAgICAgICAgICAgaWYg\nKHVybCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9maWxlID0gbmV3\nIEZpbGUodXJsLnRvVVJJKCkpOwogICAgICAgIH0gY2F0Y2ggKFVSSVN5bnRh\neEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgfSBjYXRjaCAoSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uIGlhZSkgewogICAgICAgICAgICAvLyB0aGlzIGlzIHRo\ncm93biB3aGVuIHRoZSBVUkkgaXMgbm9uLWhpZXJhcmNoaWNhbCAoYWthIEpC\nb3NzKQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpbGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YVN0b3JlSWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBwYXJzZURhdGFTdG9yZUlkKENsYXNzTWV0YURhdGEg\nbWV0YSwgRGF0YVN0b3JlSWQgaWQpIHsKICAgICAgICBtZXRhLnNldElkZW50\naXR5VHlwZShDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSk7CgogICAgICAg\nIGludCBzdHJhdCA9IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3kobWV0YSwg\naWQuc3RyYXRlZ3koKSwKICAgICAgICAgICAgaWQuZ2VuZXJhdG9yKCkpOwog\nICAgICAgIGlmIChzdHJhdCAhPSAtMSkKICAgICAgICAgICAgbWV0YS5zZXRJ\nZGVudGl0eVN0cmF0ZWd5KHN0cmF0KTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgc3dpdGNoIChpZC5zdHJhdGVneSgpKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIFRBQkxFOgogICAgICAgICAgICAgICAgY2FzZSBTRVFVRU5DRToK\nICAgICAgICAgICAgICAgICAgICAvLyB0ZWNobmljYWxseSB3ZSBzaG91bGQg\naGF2ZSBzZXBhcmF0ZSBzeXN0ZW0gdGFibGUgYW5kCiAgICAgICAgICAgICAg\nICAgICAgLy8gc2VxdWVuY2UgZ2VuZXJhdG9ycywgYnV0IGl0J3MgZWFzaWVy\nIHRvIGp1c3QgcmVseSBvbgogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBz\neXN0ZW0gb3JnLmFwYWNoZS5vcGVuanBhLlNlcXVlbmNlIHNldHRpbmcgZm9y\nIGJvdGgKICAgICAgICAgICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShpZC5nZW5lcmF0b3IoKSkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVNKTsK\nICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nICAgIG1ldGEuc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoaWQuZ2VuZXJhdG9y\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBBVVRPOgogICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRl\nbnRpdHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSURF\nTlRJVFk6CiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0\ncmF0ZWd5KFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0\naW9uKGlkLnN0cmF0ZWd5KCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgQEZs\ndXNoTW9kZSBpcyBub3Qgc3VwcG9ydGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgd2FybkZsdXNoTW9kZShPYmplY3QgY29udGV4dCkgewogICAgICAg\nIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53\nYXJuKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZCIsICJGbHVzaE1vZGUiLCBjb250\nZXh0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBARGF0YUNhY2hl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEYXRhQ2FjaGUoQ2xh\nc3NNZXRhRGF0YSBtZXRhLCBEYXRhQ2FjaGUgY2FjaGUpIHsKICAgICAgICBp\nZiAoY2FjaGUudGltZW91dCgpICE9IEludGVnZXIuTUlOX1ZBTFVFKQogICAg\nICAgICAgICBtZXRhLnNldERhdGFDYWNoZVRpbWVvdXQoY2FjaGUudGltZW91\ndCgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoY2FjaGUu\nbmFtZSgpKSkKICAgICAgICAgICAgbWV0YS5zZXREYXRhQ2FjaGVOYW1lKGNh\nY2hlLm5hbWUoKSk7CiAgICAgICAgZWxzZSBpZiAoY2FjaGUuZW5hYmxlZCgp\nKQogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUoCiAgICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlLkRhdGFDYWNo\nZS5OQU1FX0RFRkFVTFQpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0\nYS5zZXREYXRhQ2FjaGVOYW1lKG51bGwpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQERldGFjaGVkU3RhdGUuIFRoZSBhbm5vdGF0aW9uIG1heSBi\nZSBudWxsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEZXRhY2hl\nZFN0YXRlKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBEZXRhY2hlZFN0\nYXRlIGRldGFjaGVkKSB7CiAgICAgICAgaWYgKGRldGFjaGVkICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKCFkZXRhY2hlZC5lbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBtZXRhLnNldERldGFjaGVkU3RhdGUobnVsbCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGRldGFjaGVk\nLmZpZWxkTmFtZSgpKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNo\nZWRTdGF0ZShDbGFzc01ldGFEYXRhLlNZTlRIRVRJQyk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShk\nZXRhY2hlZC5maWVsZE5hbWUoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgRmllbGRbXSBmaWVsZHMgPSBtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nIGlmIChmaWVsZHNbaV0uaXNBbm5vdGF0aW9uUHJlc2VudChEZXRhY2hlZFN0\nYXRlLmNsYXNzKSkKICAgICAgICAgICAgICAgICAgICBtZXRhLnNldERldGFj\naGVkU3RhdGUoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgQEVudGl0eUxpc3RlbmVycwogICAg\nICovCiAgICBwcml2YXRlIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tz\nPltdIHBhcnNlRW50aXR5TGlzdGVuZXJzCiAgICAgICAgKENsYXNzTWV0YURh\ndGEgbWV0YSwgRW50aXR5TGlzdGVuZXJzIGxpc3RlbmVycykgewogICAgICAg\nIENsYXNzW10gY2xhc3NlcyA9IGxpc3RlbmVycy52YWx1ZSgpOwogICAgICAg\nIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIHBhcnNlZCA9IG51\nbGw7CiAgICAgICAgZm9yIChDbGFzcyBjbHMgOiBjbGFzc2VzKQogICAgICAg\nICAgICBwYXJzZWQgPSBwYXJzZUNhbGxiYWNrTWV0aG9kcyhjbHMsIHBhcnNl\nZCwgdHJ1ZSwgdHJ1ZSwgCiAgICAgICAgICAgICAgICBnZXRSZXBvc2l0b3J5\nKCkpOwogICAgICAgIHJldHVybiBwYXJzZWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZSBjYWxsYmFjayBtZXRob2RzIGludG8gdGhlIGdpdmVuIGFy\ncmF5LCBhbmQgcmV0dXJuIHRoYXQgYXJyYXksCiAgICAgKiBjcmVhdGluZyBv\nbmUgaWYgbnVsbC4gRWFjaCBpbmRleCBpbnRvIHRoZSBhcnJheSBpcyBhIGNv\nbGxlY3Rpb24gb2YKICAgICAqIGNhbGxiYWNrIGFkYXB0ZXJzIGZvciB0aGF0\nIG51bWVyaWMgZXZlbnQgdHlwZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3Vw\ncyB3aGV0aGVyIHRvIHNjYW4gc3VwZXJjbGFzc2VzCiAgICAgKiBAcGFyYW0g\nbGlzdGVuZXIgd2hldGhlciB0aGlzIGlzIGEgbGlzdGVuZXIgb3Igbm90CiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQ29sbGVjdGlvbjxMaWZlY3ljbGVD\nYWxsYmFja3M+W10gcGFyc2VDYWxsYmFja01ldGhvZHMKICAgICAgICAoQ2xh\nc3MgY2xzLCBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBjYWxs\nYmFja3MsIGJvb2xlYW4gc3VwcywKICAgICAgICBib29sZWFuIGxpc3RlbmVy\nLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICAvLyBmaXJz\ndCBzb3J0IC8gZmlsdGVyIGJhc2VkIG9uIGluaGVyaXRhbmNlCiAgICAgICAg\nU2V0PE1ldGhvZD4gbWV0aG9kcyA9IG5ldyBUcmVlU2V0PE1ldGhvZD4oTWV0\naG9kQ29tcGFyYXRvci4KICAgICAgICAgICAgZ2V0SW5zdGFuY2UoKSk7Cgog\nICAgICAgIGludCBtb2RzOwogICAgICAgIENsYXNzIHN1cCA9IGNsczsKICAg\nICAgICBNZXRob2RLZXkga2V5OwogICAgICAgIFNldDxNZXRob2RLZXk+IHNl\nZW4gPSBuZXcgSGFzaFNldDxNZXRob2RLZXk+KCk7CiAgICAgICAgZG8gewog\nICAgICAgICAgICBmb3IgKE1ldGhvZCBtIDogc3VwLmdldERlY2xhcmVkTWV0\naG9kcygpKSB7CiAgICAgICAgICAgICAgICBtb2RzID0gbS5nZXRNb2RpZmll\ncnMoKTsKICAgICAgICAgICAgICAgIGlmIChNb2RpZmllci5pc1N0YXRpYyht\nb2RzKSB8fCBNb2RpZmllci5pc0ZpbmFsKG1vZHMpIHx8CiAgICAgICAgICAg\nICAgICAgICAgT2JqZWN0LmNsYXNzLmVxdWFscyhtLmdldERlY2xhcmluZ0Ns\nYXNzKCkpKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAg\nICAgICAgICAgIGtleSA9IG5ldyBNZXRob2RLZXkobSk7CiAgICAgICAgICAg\nICAgICBpZiAoIXNlZW4uY29udGFpbnMoa2V5KSkgewogICAgICAgICAgICAg\nICAgICAgIG1ldGhvZHMuYWRkKG0pOwogICAgICAgICAgICAgICAgICAgIHNl\nZW4uYWRkKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc3VwID0gc3VwLmdldFN1cGVyY2xhc3MoKTsKICAgICAg\nICB9IHdoaWxlIChzdXBzICYmICFPYmplY3QuY2xhc3MuZXF1YWxzKHN1cCkp\nOwoKICAgICAgICBNZXRhRGF0YURlZmF1bHRzIGRlZiA9IHJlcG9zLmdldE1l\ndGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCk7CiAgICAgICAgZm9yIChN\nZXRob2QgbSA6IG1ldGhvZHMpIHsKICAgICAgICAgICAgZm9yIChBbm5vdGF0\naW9uIGFubm8gOiBtLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAg\nICAgICAgICAgICAgTWV0YURhdGFUYWcgdGFnID0gX3RhZ3MuZ2V0KGFubm8u\nYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAgICAgICAgICBpZiAodGFnID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgICAgICBpbnRbXSBldmVudHMgPSBNZXRhRGF0YVBhcnNlcnMuZ2V0RXZl\nbnRUeXBlcyh0YWcpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50cyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgIGlmIChjYWxsYmFja3MgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBjYWxsYmFja3MgPSAoQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFj\na3M+W10pCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDb2xsZWN0aW9u\nW0xpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMubGVuZ3RoXTsKCiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgICAgIGludCBlID0gZXZlbnRzW2ldOwog\nICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFja3NbZV0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdID0gbmV3IEFy\ncmF5TGlzdCgzKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgTWV0YURhdGFQYXJzZXJzLnZh\nbGlkYXRlTWV0aG9kc0ZvclNhbWVDYWxsYmFjayhjbHMsIAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLCBtLCB0YWcsIGRlZiwg\ncmVwb3MuZ2V0TG9nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjYWxs\nYmFja3NbZV0uYWRkKG5ldyBCZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzKGNscywg\nbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgY2FsbGJhY2tzW2VdLmFkZChuZXcgTWV0aG9kTGlmZWN5Y2xlQ2FsbGJh\nY2tzKG0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSkpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsbGJhY2tzOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFN0b3JlIGxpZmVjeWNsZSBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZENhbGxiYWNr\ncyhDbGFzc01ldGFEYXRhIGNscywKICAgICAgICBDb2xsZWN0aW9uPExpZmVj\neWNsZUNhbGxiYWNrcz5bXSBjYWxsYmFja3MsIGludFtdIGhpZ2hzLAogICAg\nICAgIGJvb2xlYW4gc3VwZXJDbGFzcykgewogICAgICAgIGlmIChjYWxsYmFj\na3MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIExpZmVj\neWNsZU1ldGFEYXRhIG1ldGEgPSBjbHMuZ2V0TGlmZWN5Y2xlTWV0YURhdGEo\nKTsKICAgICAgICBMaWZlY3ljbGVDYWxsYmFja3NbXSBhcnJheTsKICAgICAg\nICBmb3IgKGludCBldmVudCA6IExpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMp\nIHsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrc1tldmVudF0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBhcnJheSA9\nIGNhbGxiYWNrc1tldmVudF0udG9BcnJheQogICAgICAgICAgICAgICAgKG5l\ndyBMaWZlY3ljbGVDYWxsYmFja3NbY2FsbGJhY2tzW2V2ZW50XS5zaXplKCld\nKTsKCiAgICAgICAgICAgIGlmIChzdXBlckNsYXNzKSB7CiAgICAgICAgICAg\nICAgICBtZXRhLnNldE5vblBDU3VwZXJjbGFzc0NhbGxiYWNrcyhldmVudCwg\nYXJyYXksCiAgICAgICAgICAgICAgICAgICAgKGhpZ2hzID09IG51bGwpID8g\nMCA6IGhpZ2hzW2V2ZW50XSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBtZXRhLnNldERlY2xhcmVkQ2FsbGJhY2tzKGV2ZW50LCBh\ncnJheSwKICAgICAgICAgICAgICAgICAgICAoaGlnaHMgPT0gbnVsbCkgPyAw\nIDogaGlnaHNbZXZlbnRdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBmZXRjaCBncm91cHMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUZldGNoR3JvdXBzKENsYXNzTWV0\nYURhdGEgbWV0YSwgRmV0Y2hHcm91cC4uLiBncm91cHMpIHsKICAgICAgICBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwIGZnOwogICAgICAg\nIGZvciAoRmV0Y2hHcm91cCBncm91cCA6IGdyb3VwcykgewogICAgICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShncm91cC5uYW1lKCkpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ1bm5hbWVkLWZnIiwgbWV0YSkpOwoKICAgICAgICAgICAgZmcgPSBt\nZXRhLmFkZERlY2xhcmVkRmV0Y2hHcm91cChncm91cC5uYW1lKCkpOwogICAg\nICAgICAgICBpZiAoZ3JvdXAucG9zdExvYWQoKSkKICAgICAgICAgICAgICAg\nIGZnLnNldFBvc3RMb2FkKHRydWUpOyAKICAgICAgICAgICAgZm9yIChTdHJp\nbmcgcyA6IGdyb3VwLmZldGNoR3JvdXBzKCkpCiAgICAgICAgICAgICAgICBm\nZy5hZGREZWNsYXJlZEluY2x1ZGUocyk7CiAgICAgICAgICAgIGZvciAoRmV0\nY2hBdHRyaWJ1dGUgYXR0ciA6IGdyb3VwLmF0dHJpYnV0ZXMoKSkKICAgICAg\nICAgICAgICAgIHBhcnNlRmV0Y2hBdHRyaWJ1dGUobWV0YSwgZmcsIGF0dHIp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGZpZWxk\nJ3MgZmV0Y2ggZ3JvdXAuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZUZldGNoQXR0cmlidXRlKENsYXNzTWV0YURhdGEgbWV0YSwgCiAgICAgICAg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hHcm91cCBmZywgRmV0Y2hB\ndHRyaWJ1dGUgYXR0cikgewogICAgICAgIEZpZWxkTWV0YURhdGEgZmllbGQg\nPSBtZXRhLmdldERlY2xhcmVkRmllbGQoYXR0ci5uYW1lKCkpOwogICAgICAg\nIGlmIChmaWVsZCA9PSBudWxsCiAgICAgICAgICAgIHx8IGZpZWxkLmdldE1h\nbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5U\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1mZy1maWVsZCIsIGZnLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgIG1ldGEsIGF0dHIubmFtZSgpKSk7CgogICAgICAgIGZpZWxkLnNl\ndEluRmV0Y2hHcm91cChmZy5nZXROYW1lKCksIHRydWUpOwogICAgICAgIGlm\nIChhdHRyLnJlY3Vyc2lvbkRlcHRoKCkgIT0gSW50ZWdlci5NSU5fVkFMVUUp\nCiAgICAgICAgICAgIGZnLnNldFJlY3Vyc2lvbkRlcHRoKGZpZWxkLCBhdHRy\nLnJlY3Vyc2lvbkRlcHRoKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVh\nZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGdpdmVuIG1lbWJlci4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWVtYmVyQW5ub3RhdGlvbnMoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBsb29rIGZvciBwZXJzaXN0ZW5j\nZSBzdHJhdGVneSBpbiBhbm5vdGF0aW9uIHRhYmxlCiAgICAgICAgTWVtYmVy\nIG1lbWJlciA9IGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3Rvcnko\nKS5nZXREZWZhdWx0cygpLgogICAgICAgICAgICBnZXRCYWNraW5nTWVtYmVy\nKGZtZCk7CiAgICAgICAgUGVyc2lzdGVuY2VTdHJhdGVneSBwc3RyYXQgPSBQ\nZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuCiAgICAgICAgICAgIGdldFBl\ncnNpc3RlbmNlU3RyYXRlZ3koZm1kLCBtZW1iZXIpOwogICAgICAgIGlmIChw\nc3RyYXQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZt\nZC5zZXRFeHBsaWNpdCh0cnVlKTsKCiAgICAgICAgQW5ub3RhdGVkRWxlbWVu\ndCBlbCA9IChBbm5vdGF0ZWRFbGVtZW50KSBtZW1iZXI7CiAgICAgICAgYm9v\nbGVhbiBsb2IgPSBlbC5pc0Fubm90YXRpb25QcmVzZW50KExvYi5jbGFzcyk7\nCiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpIHsKICAgICAgICAgICAg\nc3dpdGNoIChwc3RyYXQpIHsKICAgICAgICAgICAgICAgIGNhc2UgQkFTSUM6\nCiAgICAgICAgICAgICAgICAgICAgcGFyc2VCYXNpYyhmbWQsIChCYXNpYykg\nZWwuZ2V0QW5ub3RhdGlvbihCYXNpYy5jbGFzcyksIGxvYik7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE1BTllf\nT05FOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFueVRvT25lKGZtZCwg\nKE1hbnlUb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAg\nICAgICAgICAoTWFueVRvT25lLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9ORV9PTkU6CiAgICAg\nICAgICAgICAgICAgICAgcGFyc2VPbmVUb09uZShmbWQsIChPbmVUb09uZSkg\nZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoT25l\nVG9PbmUuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRU1CRURERUQ6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VFbWJlZGRlZChmbWQsIChFbWJlZGRlZCkgZWwuZ2V0QW5ub3Rh\ndGlvbgogICAgICAgICAgICAgICAgICAgICAgICAoRW1iZWRkZWQuY2xhc3Mp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VPbmVU\nb01hbnkoZm1kLCAoT25lVG9NYW55KSBlbC5nZXRBbm5vdGF0aW9uCiAgICAg\nICAgICAgICAgICAgICAgICAgIChPbmVUb01hbnkuY2xhc3MpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFO\nWV9NQU5ZOgogICAgICAgICAgICAgICAgICAgIHBhcnNlTWFueVRvTWFueShm\nbWQsIChNYW55VG9NYW55KSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAg\nICAgICAgICAgICAgIChNYW55VG9NYW55LmNsYXNzKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBFUlM6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0ZW50KGZtZCwgKFBlcnNp\nc3RlbnQpIGVsLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAgICAgICAg\nICAgKFBlcnNpc3RlbnQuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVSU19DT0xMOgogICAgICAg\nICAgICAgICAgICAgIHBhcnNlUGVyc2lzdGVudENvbGxlY3Rpb24oZm1kLCAo\nUGVyc2lzdGVudENvbGxlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAg\nIGVsLmdldEFubm90YXRpb24oUGVyc2lzdGVudENvbGxlY3Rpb24uY2xhc3Mp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgUEVSU19NQVA6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJz\naXN0ZW50TWFwKGZtZCwgKFBlcnNpc3RlbnRNYXApCiAgICAgICAgICAgICAg\nICAgICAgICAgIGVsLmdldEFubm90YXRpb24oUGVyc2lzdGVudE1hcC5jbGFz\ncykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBUUkFOU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2Rl\nKCkgJiYgbG9iKQogICAgICAgICAgICBwYXJzZUxvYk1hcHBpbmcoZm1kKTsK\nCiAgICAgICAgLy8gZXh0ZW5zaW9ucwogICAgICAgIE1ldGFEYXRhVGFnIHRh\nZzsKICAgICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6IGVsLmdldERlY2xh\ncmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5n\nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRh\nZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duTWVt\nYmVyQW5ub3RhdGlvbihmbWQsIGFubm8pOwogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFn\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNIX01PREU6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUoZm1kKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgR0VORVJBVEVE\nX1ZBTFVFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVy\ncmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VHZW5l\ncmF0ZWRWYWx1ZShmbWQsIChHZW5lcmF0ZWRWYWx1ZSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElE\nOgogICAgICAgICAgICAgICAgY2FzZSBFTUJFRERFRF9JRDoKICAgICAgICAg\nICAgICAgICAgICBmbWQuc2V0UHJpbWFyeUtleSh0cnVlKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tF\nWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVN\nb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTWFwS2V5KGZt\nZCwgKE1hcEtleSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIE9SREVSX0JZOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlT3JkZXJCeShmbWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgIChPcmRlckJ5KSBlbC5nZXRBbm5vdGF0aW9uKE9yZGVyQnkuY2xhc3Mp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgU0VRX0dFTkVSQVRPUjoKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoZWwsIChTZXF1ZW5jZUdlbmVy\nYXRvcikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFZFUlNJT046CiAgICAgICAgICAgICAgICAgICAg\nZm1kLnNldFZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIERFUEVOREVOVDoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSAmJiAoKERlcGVuZGVu\ndCkgYW5ubykudmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1k\nLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBFTEVNX0RFUEVOREVOVDoKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKSAmJiAoKEVsZW1lbnREZXBlbmRlbnQpIGFubm8p\nLnZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVt\nZW50KCkuc2V0Q2FzY2FkZURlbGV0ZQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9U\nWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNl\ndFR5cGVPdmVycmlkZSh0b092ZXJyaWRlVHlwZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKCgoRWxlbWVudFR5cGUpIGFubm8pLnZhbHVlKCkpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgRVhURVJOQUxfVkFMUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNl\ndEV4dGVybmFsVmFsdWVzKFN0cmluZ3Muam9pbigoKEV4dGVybmFsVmFsdWVz\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ubykudmFsdWUoKSwg\nIiwiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEVYVEVSTkFMSVpFUjoKICAgICAgICAgICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nZm1kLnNldEV4dGVybmFsaXplcigoKEV4dGVybmFsaXplcikgYW5ubykudmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEZBQ1RPUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5z\nZXRGYWN0b3J5KCgoRmFjdG9yeSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOVkVS\nU0VfTE9HSUNBTDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldEludmVy\nc2UoKChJbnZlcnNlTG9naWNhbCkgYW5ubykudmFsdWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9E\nRVBFTkRFTlQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFN\nb2RlKCkgJiYgKChLZXlEZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXkoKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBLRVlfVFlQRToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZm1kLmdldEtleSgpLnNldFR5cGVPdmVycmlkZSh0b092ZXJyaWRl\nVHlwZSgoKEtleVR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\nbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIExPQURfRkVUQ0hfR1JPVVA6CiAgICAgICAg\nICAgICAgICAJaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAg\nICAJCWZtZC5zZXRMb2FkRmV0Y2hHcm91cCgoKExvYWRGZXRjaEdyb3VwKWFu\nbm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgCWJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBMUlM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5z\nZXRMUlMoKChMUlMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBSRUFEX09OTFk6CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlUmVhZE9ubHkoZm1kLCAoUmVhZE9u\nbHkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBUWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0VHlwZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBlKCgoVHlwZSkgYW5ubyku\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKSk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBmbWQsCiAgICAgICAg\nICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgbWVt\nYmVyIG1hcHBpbmcgY29tcG9uZW50cy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgcGFyc2VNZW1iZXJNYXBwaW5nQW5ub3RhdGlvbnMoRmllbGRNZXRh\nRGF0YSBmbWQpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHN1YmNs\nYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25NZW1iZXJBbm5v\ndGF0aW9uKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIEFubm90YXRpb24g\nYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIGdpdmVuIGNsYXNzIHRvIGl0cyBPcGVuSlBB\nIHR5cGUgb3ZlcnJpZGUgZXF1aXZhbGVudC4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgQ2xhc3MgdG9PdmVycmlkZVR5cGUoQ2xhc3MgY2xzKSB7CiAg\nICAgICAgcmV0dXJuIChjbHMgPT0gRW50aXR5LmNsYXNzKQogICAgICAgICAg\nICA/IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2Fw\nYWJsZS5jbGFzcyA6IGNsczsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBSZWFkT25seS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUmVh\nZE9ubHkoRmllbGRNZXRhRGF0YSBmbWQsIFJlYWRPbmx5IHJvKSB7CiAgICAg\nICAgaWYgKHJvLnZhbHVlKCkgPT0gVXBkYXRlQWN0aW9uLlJFU1RSSUNUKQog\nICAgICAgICAgICBmbWQuc2V0VXBkYXRlU3RyYXRlZ3koVXBkYXRlU3RyYXRl\nZ2llcy5SRVNUUklDVCk7CiAgICAgICAgZWxzZSBpZiAocm8udmFsdWUoKSA9\nPSBVcGRhdGVBY3Rpb24uSUdOT1JFKQogICAgICAgICAgICBmbWQuc2V0VXBk\nYXRlU3RyYXRlZ3koVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHZhbHVlIGdlbmVyYXRp\nb24gaW5mb3JtYXRpb24gZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlR2VuZXJhdGVkVmFsdWUoRmllbGRNZXRh\nRGF0YSBmbWQsIEdlbmVyYXRlZFZhbHVlIGdlbikgewogICAgICAgIGludCBz\ndHJhdCA9IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koZm1kLCBnZW4uc3Ry\nYXRlZ3koKSwKICAgICAgICAgICAgZ2VuLmdlbmVyYXRvcigpKTsKICAgICAg\nICBpZiAoc3RyYXQgIT0gLTEpCiAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVN0\ncmF0ZWd5KHN0cmF0KTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3dp\ndGNoIChnZW4uc3RyYXRlZ3koKSkgewogICAgICAgICAgICAgICAgY2FzZSBU\nQUJMRToKICAgICAgICAgICAgICAgIGNhc2UgU0VRVUVOQ0U6CiAgICAgICAg\nICAgICAgICAgICAgLy8gdGVjaG5pY2FsbHkgd2Ugc2hvdWxkIGhhdmUgc2Vw\nYXJhdGUgc3lzdGVtIHRhYmxlIGFuZAogICAgICAgICAgICAgICAgICAgIC8v\nIHNlcXVlbmNlIGdlbmVyYXRvcnMsIGJ1dCBpdCdzIGVhc2llciB0byBqdXN0\nIHJlbHkgb24KICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc3lzdGVtIG9y\nZy5hcGFjaGUub3BlbmpwYS5TZXF1ZW5jZSBzZXR0aW5nIGZvciBib3RoCiAg\nICAgICAgICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZ2Vu\nLmdlbmVyYXRvcigpKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNl\ndFZhbHVlU2VxdWVuY2VOYW1lKFNlcXVlbmNlTWV0YURhdGEuTkFNRV9TWVNU\nRU0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICAgICAgZm1kLnNldFZhbHVlU2VxdWVuY2VOYW1lKGdlbi5nZW5lcmF0\nb3IoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEFVVE86CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldFZh\nbHVlU2VxdWVuY2VOYW1lKFNlcXVlbmNlTWV0YURhdGEuTkFNRV9TWVNURU0p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBJREVOVElUWToKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmFs\ndWVTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuQVVUT0FTU0lHTik7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4\nY2VwdGlvbihnZW4uc3RyYXRlZ3koKS50b1N0cmluZygpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgdmFsdWUgc3RyYXRlZ3kgZm9yIHRoZSBnaXZlbiBnZW5lcmF0b3IsIG9y\nIC0xIGlmIHRoZQogICAgICogc3RyYXRlZ3kgZGVwZW5kcyBvbiB0aGUgPGNv\nZGU+R2VuZXJhdGlvblR5cGU8L2NvZGU+IHJhdGhlciB0aGFuIHRoZQogICAg\nICogZ2VuZXJhdG9yIG5hbWUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGludCBnZXRHZW5lcmF0ZWRWYWx1ZVN0cmF0ZWd5KE9iamVjdCBjb250ZXh0\nLAogICAgICAgIEdlbmVyYXRpb25UeXBlIHN0cmF0ZWd5LCBTdHJpbmcgZ2Vu\nZXJhdG9yKSB7CiAgICAgICAgaWYgKHN0cmF0ZWd5ICE9IEFVVE8gfHwgU3Ry\naW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1\ncm4gLTE7CgogICAgICAgIGlmIChHZW5lcmF0b3IuVVVJRF9IRVguZXF1YWxz\nKGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdp\nZXMuVVVJRF9IRVg7CiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX1NUUklO\nRy5lcXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVl\nU3RyYXRlZ2llcy5VVUlEX1NUUklORzsKICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImdlbmVyYXRvci1iYWQtc3RyYXRl\nZ3kiLAogICAgICAgICAgICBjb250ZXh0LCBnZW5lcmF0b3IpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIEBCYXNpYy4gR2l2ZW4gYW5ub3RhdGlv\nbiBtYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nQmFzaWMoRmllbGRNZXRhRGF0YSBmbWQsIEJhc2ljIGFubm8sIGJvb2xlYW4g\nbG9iKSB7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgICAgICBpZiAobG9iICYmIHR5cGUgIT0gU3RyaW5nLmNsYXNz\nCiAgICAgICAgICAgICYmIHR5cGUgIT0gY2hhcltdLmNsYXNzICYmIHR5cGUg\nIT0gQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgJiYgdHlwZSAhPSBi\neXRlW10uY2xhc3MgJiYgdHlwZSAhPSBCeXRlW10uY2xhc3MpCiAgICAgICAg\nICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAgIGVsc2UgaWYg\nKCFsb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgaWYgKEVudW0uY2xhc3MuaXNB\nc3NpZ25hYmxlRnJvbSh0eXBlKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBubyBicmVhawog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICBpZiAo\nU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUp\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtbWV0YS1hbm5vIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZt\nZCwgIkJhc2ljIikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHR5cGUgPT0gY2hhcltdLmNsYXNzIHx8IHR5cGUgPT0g\nQ2hhcmFjdGVyW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAgfHwg\ndHlwZSA9PSBieXRlW10uY2xhc3MgfHwgdHlwZSA9PSBCeXRlW10uY2xhc3Mp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgICAgIGlmIChTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJv\nbQogICAgICAgICAgICAgICAgICAgICAgICAodHlwZS5nZXRDb21wb25lbnRU\neXBlKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0U2VyaWFs\naXplZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmbWQsICJCYXNpYyIpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGFu\nbm8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGZtZC5z\nZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5\ncGUuRUFHRVIpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQogICAg\nICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9F\nWENFUFRJT04pOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE1hbnlU\nb09uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRvT25l\nKEZpZWxkTWV0YURhdGEgZm1kLCBNYW55VG9PbmUgYW5ubykgewogICAgICAg\nIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiTWFueVRv\nT25lIikpOwoKICAgICAgICAvLyBkb24ndCBzcGVjaWZpY2FsbHkgZXhjbHVk\nZSByZWxhdGlvbiBmcm9tIERGRyBiL2MgdGhhdCB3aWxsIHByZXZlbnQKICAg\nICAgICAvLyB1cyBmcm9tIGV2ZW4gcmVhZGluZyB0aGUgZmsgd2hlbiByZWFk\naW5nIGZyb20gdGhlIHByaW1hcnkgdGFibGUsCiAgICAgICAgLy8gd2hpY2gg\naXMgbm90IHdoYXQgbW9zdCB1c2VycyB3aWxsIHdhbnQKICAgICAgICBpZiAo\nYW5uby5mZXRjaCgpID09IEZldGNoVHlwZS5FQUdFUikKICAgICAgICAgICAg\nZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgaWYg\nKCFhbm5vLm9wdGlvbmFsKCkpCiAgICAgICAgICAgIGZtZC5zZXROdWxsVmFs\ndWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAgICAgICAgaWYg\nKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAg\nICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdldEVudGl0eSgpKTsK\nICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2FkZSgpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBPbmVUb09uZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlT25lVG9PbmUoRmllbGRNZXRhRGF0YSBm\nbWQsIE9uZVRvT25lIGFubm8pIHsKICAgICAgICBpZiAoIUphdmFUeXBlcy5t\nYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwg\nZm1kLAogICAgICAgICAgICAgICAgIk9uZVRvT25lIikpOwoKICAgICAgICAv\nLyBkb24ndCBzcGVjaWZpY2FsbHkgZXhjbHVkZSByZWxhdGlvbiBmcm9tIERG\nRyBiL2MgdGhhdCB3aWxsIHByZXZlbnQKICAgICAgICAvLyB1cyBmcm9tIGV2\nZW4gcmVhZGluZyB0aGUgZmsgd2hlbiByZWFkaW5nIGZyb20gdGhlIHByaW1h\ncnkgdGFibGUsCiAgICAgICAgLy8gd2hpY2ggaXMgbm90IHdoYXQgbW9zdCB1\nc2VycyB3aWxsIHdhbnQKICAgICAgICBpZiAoYW5uby5mZXRjaCgpID09IEZl\ndGNoVHlwZS5FQUdFUikKICAgICAgICAgICAgZm1kLnNldEluRGVmYXVsdEZl\ndGNoR3JvdXAodHJ1ZSk7CiAgICAgICAgaWYgKCFhbm5vLm9wdGlvbmFsKCkp\nCiAgICAgICAgICAgIGZtZC5zZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5O\nVUxMX0VYQ0VQVElPTik7CgogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlk\nZU1vZGUoKSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5\nKCkpKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRC\neSgpKTsKICAgICAgICBpZiAoYW5uby50YXJnZXRFbnRpdHkoKSAhPSB2b2lk\nLmNsYXNzKQogICAgICAgICAgICBmbWQuc2V0VHlwZU92ZXJyaWRlKGFubm8u\ndGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZCwgYW5u\nby5jYXNjYWRlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQEVt\nYmVkZGVkLiBHaXZlbiBhbm5vdGF0aW9uIG1heSBiZSBudWxsLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcGFyc2VFbWJlZGRlZChGaWVsZE1ldGFEYXRh\nIGZtZCwgRW1iZWRkZWQgYW5ubykgewogICAgICAgIGlmICghSmF2YVR5cGVz\nLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8i\nLCBmbWQsCiAgICAgICAgICAgICAgICAiRW1iZWRkZWQiKSk7CgogICAgICAg\nIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwogICAgICAgIGZt\nZC5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICBpZiAoZm1kLmdldEVtYmVk\nZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICBmbWQuYWRkRW1i\nZWRkZWRNZXRhRGF0YSgpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQE9uZVRvTWFueS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlT25l\nVG9NYW55KEZpZWxkTWV0YURhdGEgZm1kLCBPbmVUb01hbnkgYW5ubykgewog\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5t\nYXliZVBDKGZtZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAg\nICAgICAgICAgICAgICAgICAiT25lVG9NYW55IikpOwogICAgICAgIH0KCiAg\nICAgICAgZm1kLnNldEluRGVmYXVsdEZldGNoR3JvdXAoYW5uby5mZXRjaCgp\nID09IEZldGNoVHlwZS5FQUdFUik7CiAgICAgICAgaWYgKGlzTWFwcGluZ092\nZXJyaWRlTW9kZSgpICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFubm8ubWFw\ncGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1h\ncHBlZEJ5KCkpOwogICAgICAgIGlmIChhbm5vLnRhcmdldEVudGl0eSgpICE9\nIHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0\nRGVjbGFyZWRUeXBlKGFubm8udGFyZ2V0RW50aXR5KCkpOwogICAgICAgIHNl\ndENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCksIGFubm8uY2FzY2FkZSgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBNYW55VG9NYW55LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNYW55VG9NYW55KEZpZWxkTWV0\nYURhdGEgZm1kLCBNYW55VG9NYW55IGFubm8pIHsKICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgIGlmIChKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0\nRWxlbWVudCgpKSkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAg\nICAgIk9uZVRvTWFueSIpKTsKICAgICAgICB9CgogICAgICAgIGZtZC5zZXRJ\nbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUu\nRUFHRVIpOwogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAm\nJiAhU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAg\nICAgICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAg\nICAgICBpZiAoYW5uby50YXJnZXRFbnRpdHkoKSAhPSB2b2lkLmNsYXNzKQog\nICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldERlY2xhcmVkVHlwZShh\nbm5vLnRhcmdldEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQu\nZ2V0RWxlbWVudCgpLCBhbm5vLmNhc2NhZGUoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBATWFwS2V5LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcGFyc2VNYXBLZXkoRmllbGRNZXRhRGF0YSBmbWQsIE1hcEtleSBhbm5v\nKSB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSBhbm5vLm5hbWUoKTsKICAgICAg\nICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAg\nZm1kLmdldEtleSgpLnNldFZhbHVlTWFwcGVkQnkoVmFsdWVNZXRhRGF0YS5N\nQVBQRURfQllfUEspOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZm1kLmdl\ndEtleSgpLnNldFZhbHVlTWFwcGVkQnkobmFtZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXR1cCB0aGUgZmllbGQgYXMgYSBMT0IgbWFwcGluZy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VMb2JNYXBwaW5nKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBA\nT3JkZXJCeS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlT3JkZXJC\neShGaWVsZE1ldGFEYXRhIGZtZCwgT3JkZXJCeSBhbm5vKSB7CiAgICAgICAg\nU3RyaW5nIGRlYyA9IGFubm8udmFsdWUoKTsKICAgICAgICBpZiAoZGVjLmxl\nbmd0aCgpID09IDApCiAgICAgICAgICAgIGRlYyA9IE9yZGVyLkVMRU1FTlQg\nKyAiIGFzYyI7CiAgICAgICAgZm1kLnNldE9yZGVyRGVjbGFyYXRpb24oZGVj\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQZXJzaXN0ZW50KEZpZWxk\nTWV0YURhdGEgZm1kLCBQZXJzaXN0ZW50IGFubm8pIHsKICAgICAgICBzd2l0\nY2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpZiAoZm1k\nLmdldERlY2xhcmVkVHlwZSgpID09IGJ5dGVbXS5jbGFzcwogICAgICAgICAg\nICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBCeXRlW10u\nY2xhc3MKICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgfHwg\nZm1kLmdldERlY2xhcmVkVHlwZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8g\nbm8gYnJlYWsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJi\nYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJQZXJz\naXN0ZW50IikpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFTdHJpbmdVdGls\ncy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAgIGZtZC5z\nZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGZtZC5zZXRJ\nbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5cGUu\nRUFHRVIpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQogICAgICAg\nICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9FWENF\nUFRJT04pOwogICAgICAgIHNldENhc2NhZGVzKGZtZCwgYW5uby5jYXNjYWRl\nKCkpOwogICAgICAgIGlmIChhbm5vLmVtYmVkZGVkKCkpIHsKICAgICAgICAg\nICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0VmFsdWUoKSkpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAg\nICAgIlBlcnNpc3RlbnQoZW1iZWRkZWQ9dHJ1ZSkiKSk7CiAgICAgICAgICAg\nIGZtZC5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGZtZC5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgQFBlcnNpc3RlbnRDb2xsZWN0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQZXJzaXN0ZW50Q29sbGVj\ndGlvbihGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBQZXJzaXN0ZW50Q29s\nbGVjdGlvbiBhbm5vKSB7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkgIT0gSmF2YVR5cGVzLkFSUkFZCiAgICAgICAgICAgICYmIGZt\nZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLkNPTExFQ1RJ\nT04pCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAg\nICJQZXJzaXN0ZW50Q29sbGVjdGlvbiIpKTsKCiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGFubm8ubWFwcGVkQnkoKSkpCiAgICAgICAgICAg\nIGZtZC5zZXRNYXBwZWRCeShhbm5vLm1hcHBlZEJ5KCkpOwogICAgICAgIGZt\nZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBGZXRj\naFR5cGUuRUFHRVIpOwogICAgICAgIGlmIChhbm5vLmVsZW1lbnRUeXBlKCkg\nIT0gdm9pZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5z\nZXREZWNsYXJlZFR5cGUoYW5uby5lbGVtZW50VHlwZSgpKTsKICAgICAgICBz\nZXRDYXNjYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmVsZW1lbnRDYXNj\nYWRlKCkpOwogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJlZGRlZCgpKSB7\nCiAgICAgICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVs\nZW1lbnQoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAg\nICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRDb2xsZWN0aW9uKGVtYmVkZGVk\nRWxlbWVudD10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQo\nKS5zZXRFbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURh\ndGEoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBA\nUGVyc2lzdGVudE1hcC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNl\nUGVyc2lzdGVudE1hcChGaWVsZE1ldGFEYXRhIGZtZCwgUGVyc2lzdGVudE1h\ncCBhbm5vKSB7CiAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLk1BUCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1k\nLAogICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAiKSk7CgogICAgICAg\nIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBG\nZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmIChhbm5vLmtleVR5cGUoKSAh\nPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0RGVj\nbGFyZWRUeXBlKGFubm8ua2V5VHlwZSgpKTsKICAgICAgICBpZiAoYW5uby5l\nbGVtZW50VHlwZSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5n\nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRUeXBlKGFubm8uZWxlbWVudFR5cGUo\nKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEtleSgpLCBhbm5vLmtl\neUNhc2NhZGUoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVsZW1l\nbnQoKSwgYW5uby5lbGVtZW50Q2FzY2FkZSgpKTsKICAgICAgICBpZiAoYW5u\nby5rZXlFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgIGlmICghSmF2YVR5cGVz\nLm1heWJlUEMoZm1kLmdldEtleSgpKSkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5u\nbyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVudE1hcChl\nbWJlZGRlZEtleT10cnVlKSIpKTsKICAgICAgICAgICAgZm1kLmdldEtleSgp\nLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdldEtl\neSgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgZm1kLmdldEtleSgpLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKGFubm8uZWxlbWVudEVtYmVkZGVkKCkpIHsK\nICAgICAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQQyhmbWQuZ2V0RWxl\nbWVudCgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAgICAg\nICAgICAgICAgICAgICAiUGVyc2lzdGVudE1hcChlbWJlZGRlZFZhbHVlPXRy\ndWUpIikpOwogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldEVtYmVk\nZGVkKHRydWUpOwogICAgICAgICAgICBpZiAoZm1kLmdldEVsZW1lbnQoKS5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGZtZC5nZXRFbGVtZW50KCkuYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCBjYXNjYWRlcyBvbiBy\nZWxhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNldENhc2NhZGVz\nKFZhbHVlTWV0YURhdGEgdm1kLCBDYXNjYWRlVHlwZVtdIGNhc2NhZGVzKSB7\nCiAgICAgICAgZm9yIChDYXNjYWRlVHlwZSBjYXNjYWRlIDogY2FzY2FkZXMp\nIHsKICAgICAgICAgICAgaWYgKGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuQUxM\nIHx8IGNhc2NhZGUgPT0gQ2FzY2FkZVR5cGUuUkVNT1ZFKQogICAgICAgICAg\nICAgICAgdm1kLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0lNTUVESUFURSk7CiAgICAgICAgICAgIGlmIChjYXNjYWRlID09IENh\nc2NhZGVUeXBlLkFMTCB8fCBjYXNjYWRlID09IENhc2NhZGVUeXBlLlBFUlNJ\nU1QpCiAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZVBlcnNpc3QoVmFs\ndWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAgICAgICAgICAgIGlm\nIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBjYXNjYWRlID09IENh\nc2NhZGVUeXBlLk1FUkdFKQogICAgICAgICAgICAgICAgdm1kLnNldENhc2Nh\nZGVBdHRhY2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAg\nICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBj\nYXNjYWRlID09IENhc2NhZGVUeXBlLlJFRlJFU0gpCiAgICAgICAgICAgICAg\nICB2bWQuc2V0Q2FzY2FkZVJlZnJlc2goVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX0lNTUVESUFURSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgQFNlcXVlbmNlR2VuZXJhdG9yLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihBbm5vdGF0ZWRFbGVtZW50\nIGVsLAogICAgICAgIFNlcXVlbmNlR2VuZXJhdG9yIGdlbikgewogICAgICAg\nIFN0cmluZyBuYW1lID0gZ2VuLm5hbWUoKTsKICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zZXEtbmFtZSIsIGVsKSk7\nCgogICAgICAgIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAg\nICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJwYXJzZS1zZXF1ZW5jZSIsIG5hbWUp\nKTsKCiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3Np\ndG9yeSgpLmdldENhY2hlZFNlcXVlbmNlTWV0YURhdGEKICAgICAgICAgICAg\nKG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nX2xvZy53YXJuKF9sb2MuZ2V0KCJkdXAtc2VxdWVuY2UiLCBuYW1lLCBlbCkp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBj\ncmVhdGUgbmV3IHNlcXVlbmNlCiAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRv\ncnkoKS5hZGRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAgIFN0cmlu\nZyBzZXEgPSBnZW4uc2VxdWVuY2VOYW1lKCk7CiAgICAgICAgaW50IGluaXRp\nYWwgPSBnZW4uaW5pdGlhbFZhbHVlKCk7CiAgICAgICAgaW50IGFsbG9jYXRl\nID0gZ2VuLmFsbG9jYXRpb25TaXplKCk7CiAgICAgICAgLy8gZG9uJ3QgYWxs\nb3cgaW5pdGlhbCBvZiAwIGIvYyBsb29rcyBsaWtlIGRlZiB2YWx1ZQogICAg\nICAgIGlmIChpbml0aWFsID09IDApCiAgICAgICAgICAgIGluaXRpYWwgPSAx\nOwoKICAgICAgICAvLyBjcmVhdGUgcGx1Z2luIHN0cmluZyBmcm9tIGluZm8K\nICAgICAgICBTdHJpbmcgY2xzTmFtZSwgcHJvcHM7CiAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkoc2VxKSkgewogICAgICAgICAgICBjbHNOYW1l\nID0gU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAg\ncHJvcHMgPSBudWxsOwogICAgICAgIH0gZWxzZSBpZiAoc2VxLmluZGV4T2Yo\nJygnKSAhPSAtMSkgLy8gcGx1Z2luCiAgICAgICAgewogICAgICAgICAgICBj\nbHNOYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKHNlcSk7CiAg\nICAgICAgICAgIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGll\ncyhzZXEpOwogICAgICAgICAgICBzZXEgPSBudWxsOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGNsc05hbWUgPSBTZXF1ZW5jZU1ldGFEYXRhLklN\nUExfTkFUSVZFOwogICAgICAgICAgICBwcm9wcyA9IG51bGw7CiAgICAgICAg\nfQoKICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2luKENvbmZpZ3VyYXRp\nb25zLmdldFBsdWdpbihjbHNOYW1lLCBwcm9wcykpOwogICAgICAgIG1ldGEu\nc2V0U2VxdWVuY2Uoc2VxKTsKICAgICAgICBtZXRhLnNldEluaXRpYWxWYWx1\nZShpbml0aWFsKTsKICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGFsbG9jYXRl\nKTsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChl\nbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAg\nbWV0YS5TUkNfQU5OT1RBVElPTlMpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgQE5hbWVkUXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZU5hbWVkUXVlcmllcyhBbm5vdGF0ZWRFbGVtZW50IGVsLCBOYW1lZFF1\nZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7\nCiAgICAgICAgZm9yIChOYW1lZFF1ZXJ5IHF1ZXJ5IDogcXVlcmllcykgewog\nICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVyeS5uYW1l\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJuby1xdWVyeS1uYW1lIiwgZWwpKTsKICAgICAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucXVlcnkoKSkpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLXF1ZXJ5LXN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAg\ncXVlcnkubmFtZSgpLCBlbCkpOwoKICAgICAgICAgICAgaWYgKF9sb2cuaXNJ\nbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2Mu\nZ2V0KCJwYXJzZS1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSkpOwoKICAgICAgICAg\nICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRRdWVyeU1ldGFE\nYXRhKG51bGwsIHF1ZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChtZXRh\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoImR1cC1xdWVyeSIsIHF1ZXJ5Lm5hbWUoKSwgZWwpKTsKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWV0\nYSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRhKG51bGwsIHF1\nZXJ5Lm5hbWUoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0UXVlcnlTdHJpbmco\ncXVlcnkucXVlcnkoKSk7CiAgICAgICAgICAgIG1ldGEuc2V0TGFuZ3VhZ2Uo\nSlBRTFBhcnNlci5MQU5HX0pQUUwpOwogICAgICAgICAgICBmb3IgKFF1ZXJ5\nSGludCBoaW50IDogcXVlcnkuaGludHMoKSkKICAgICAgICAgICAgICAgIG1l\ndGEuYWRkSGludChoaW50Lm5hbWUoKSwgaGludC52YWx1ZSgpKTsKCiAgICAg\nICAgICAgIG1ldGEuc2V0U291cmNlKGdldFNvdXJjZUZpbGUoKSwgKGVsIGlu\nc3RhbmNlb2YgQ2xhc3MpID8gZWwgOiBudWxsLAogICAgICAgICAgICAgICAg\nbWV0YS5TUkNfQU5OT1RBVElPTlMpOwogICAgICAgICAgICBpZiAoaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9k\nZShNT0RFX01FVEEpOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdN\nb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9E\nRV9NQVBQSU5HKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfUVVFUlkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBOYW1lZE5hdGl2ZVF1ZXJ5Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VOYW1lZE5hdGl2ZVF1ZXJp\nZXMoQW5ub3RhdGVkRWxlbWVudCBlbCwKICAgICAgICBOYW1lZE5hdGl2ZVF1\nZXJ5Li4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7\nCiAgICAgICAgZm9yIChOYW1lZE5hdGl2ZVF1ZXJ5IHF1ZXJ5IDogcXVlcmll\ncykgewogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVy\neS5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1uYXRpdmUtcXVlcnktbmFtZSIsCiAg\nICAgICAgICAgICAgICAgICAgZWwpKTsKICAgICAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW5h\ndGl2ZS1xdWVyeS1zdHJpbmciLAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5\nLm5hbWUoKSwgZWwpKTsKCiAgICAgICAgICAgIGlmIChfbG9nLmlzSW5mb0Vu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgi\ncGFyc2UtbmF0aXZlLXF1ZXJ5IiwgcXVlcnkubmFtZSgpKSk7CgogICAgICAg\nICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFF1ZXJ5TWV0\nYURhdGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgaWYgKG1l\ndGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCkpOwogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBt\nZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZFF1ZXJ5TWV0YURhdGEobnVsbCwg\ncXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgbWV0YS5zZXRRdWVyeVN0cmlu\nZyhxdWVyeS5xdWVyeSgpKTsKICAgICAgICAgICAgbWV0YS5zZXRMYW5ndWFn\nZShRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTCk7CiAgICAgICAgICAgIENsYXNz\nIHJlcyA9IHF1ZXJ5LnJlc3VsdENsYXNzKCk7CiAgICAgICAgICAgIGlmIChJ\nbXBsSGVscGVyLmlzTWFuYWdlZFR5cGUocmVzKSkKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0Q2FuZGlkYXRlVHlwZShyZXMpOwogICAgICAgICAgICBlbHNl\nIGlmICghdm9pZC5jbGFzcy5lcXVhbHMocmVzKSkKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0UmVzdWx0VHlwZShyZXMpOwoKICAgICAgICAgICAgbWV0YS5z\nZXRTb3VyY2UoZ2V0U291cmNlRmlsZSgpLCAoZWwgaW5zdGFuY2VvZiBDbGFz\ncykgPyBlbCA6IG51bGwsCiAgICAgICAgICAgICAgICBtZXRhLlNSQ19BTk5P\nVEFUSU9OUyk7CiAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQog\nICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUVUQSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAg\nICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01BUFBJTkcpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJj\nZU1vZGUoTU9ERV9RVUVSWSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIE1ldGhvZEtleSB7CgogICAgICAgIHByaXZhdGUg\nZmluYWwgTWV0aG9kIF9tZXRob2Q7CgogICAgICAgIHB1YmxpYyBNZXRob2RL\nZXkoTWV0aG9kIG0pIHsKICAgICAgICAgICAgX21ldGhvZCA9IG07CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAg\nICAgICBpbnQgY29kZSA9IDQ2ICogMTIgKyBfbWV0aG9kLmdldE5hbWUoKS5o\nYXNoQ29kZSgpOwogICAgICAgICAgICBmb3IgKENsYXNzIHBhcmFtIDogX21l\ndGhvZC5nZXRQYXJhbWV0ZXJUeXBlcygpKQogICAgICAgICAgICAgICAgY29k\nZSA9IDQ2ICogY29kZSArIHBhcmFtLmhhc2hDb2RlKCk7CiAgICAgICAgICAg\nIHJldHVybiBjb2RlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gZXF1YWxzKE9iamVjdCBvKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5z\ndGFuY2VvZiBNZXRob2RLZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICBNZXRob2Qgb3RoZXIgPSAoKE1ldGhvZEtleSkg\nbykuX21ldGhvZDsKICAgICAgICAgICAgaWYgKCFfbWV0aG9kLmdldE5hbWUo\nKS5lcXVhbHMob3RoZXIuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5lcXVhbHMo\nX21ldGhvZC5nZXRQYXJhbWV0ZXJUeXBlcygpLAogICAgICAgICAgICAgICAg\nb3RoZXIuZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1ldGhvZENvbXBhcmF0b3IgaW1w\nbGVtZW50cyBDb21wYXJhdG9yIHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMg\nTWV0aG9kQ29tcGFyYXRvciBJTlNUQU5DRSA9IG51bGw7CgogICAgICAgIHB1\nYmxpYyBzdGF0aWMgTWV0aG9kQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsK\nICAgICAgICAgICAgaWYgKElOU1RBTkNFID09IG51bGwpCiAgICAgICAgICAg\nICAgICBJTlNUQU5DRSA9IG5ldyBNZXRob2RDb21wYXJhdG9yKCk7CiAgICAg\nICAgICAgIHJldHVybiBJTlNUQU5DRTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9iamVjdCBvMikgewogICAg\nICAgICAgICBNZXRob2QgbTEgPSAoTWV0aG9kKSBvMTsKICAgICAgICAgICAg\nTWV0aG9kIG0yID0gKE1ldGhvZCkgbzI7CgogICAgICAgICAgICBDbGFzcyBj\nMSA9IG0xLmdldERlY2xhcmluZ0NsYXNzKCk7CiAgICAgICAgICAgIENsYXNz\nIGMyID0gbTIuZ2V0RGVjbGFyaW5nQ2xhc3MoKTsKICAgICAgICAgICAgaWYg\nKCFjMS5lcXVhbHMoYzIpKSB7CiAgICAgICAgICAgICAgICBpZiAoYzEuaXNB\nc3NpZ25hYmxlRnJvbShjMikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIC0xOwogICAgICAgICAgICAgICAgZWxzZQoJCQkJCXJldHVybiAxOwoJCQl9\nCgkJCWludCBjb21wYXJlID0gbTEuZ2V0TmFtZSAoKS5jb21wYXJlVG8gKG0y\nLmdldE5hbWUgKCkpOwoJCQlpZiAoY29tcGFyZSA9PSAwKQoJCQkJcmV0dXJu\nIG0xLmhhc2hDb2RlICgpIC0gbTIuaGFzaENvZGUgKCk7CgkJCXJldHVybiBj\nb21wYXJlOwoJCX0KCX0KfQo=\n","encoding":"base64"}

