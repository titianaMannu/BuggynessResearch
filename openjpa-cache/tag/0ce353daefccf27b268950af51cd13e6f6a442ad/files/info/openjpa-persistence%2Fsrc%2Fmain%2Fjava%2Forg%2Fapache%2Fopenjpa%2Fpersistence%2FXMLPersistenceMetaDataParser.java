{"sha":"c76eaeb1884fc5b71b99f3e4f971492828a772ee","node_id":"MDQ6QmxvYjIwNjM2NDpjNzZlYWViMTg4NGZjNWI3MWI5OWYzZTRmOTcxNDkyODI4YTc3MmVl","size":53193,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c76eaeb1884fc5b71b99f3e4f971492828a772ee","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBqYXZhLmxhbmcucmVmbGVj\ndC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1lbWJlcjsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5FbnVtU2V0OwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNl\ndDsKaW1wb3J0IGphdmEudXRpbC5TdGFjazsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkNhc2NhZGVUeXBlOwppbXBvcnQgc3RhdGljIGphdmF4LnBlcnNp\nc3RlbmNlLkNhc2NhZGVUeXBlLio7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcueG1sLnNheC5BdHRy\naWJ1dGVzOwppbXBvcnQgb3JnLnhtbC5zYXguU0FYRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQu\nQmVhbkxpZmVjeWNsZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5ldmVudC5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1\nYWdlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuanBxbC5K\nUFFMUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25m\nLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRh\nLkNGTWV0YURhdGFQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YURlZmF1bHRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFGYWN0b3J5Owpp\nbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nTW9kZXMuKjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFE\nYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk9yZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuUXVlcnlN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVl\nbmNlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUub3Bl\nbmpwYS5wZXJzaXN0ZW5jZS5NZXRhRGF0YVRhZy4qOwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5QZXJzaXN0ZW5jZVN0\ncmF0ZWd5Lio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBs\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBw\nb3J0ZWRFeGNlcHRpb247CgovKioKICogQ3VzdG9tIFNBWCBwYXJzZXIgdXNl\nZCBieSB0aGUgc3lzdGVtIHRvIHF1aWNrbHkgcGFyc2UgcGVyc2lzdGVuY2Ug\naQogKiBtZXRhZGF0YSBmaWxlcy4KICoKICogQGF1dGhvciBTdGV2ZSBLaW0K\nICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIFhNTFBlcnNpc3RlbmNl\nTWV0YURhdGFQYXJzZXIKICAgIGV4dGVuZHMgQ0ZNZXRhRGF0YVBhcnNlcgog\nICAgaW1wbGVtZW50cyBQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeS5QYXJz\nZXIgewoKICAgIC8vIHBhcnNlIGNvbnN0YW50cwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgRUxFTV9QS0cgPSAicGFja2FnZSI7CiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGZpbmFsIFN0cmluZyBFTEVNX0FDQ0VTUyA9ICJh\nY2Nlc3MiOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBTdHJpbmcgRUxF\nTV9BVFRSUyA9ICJhdHRyaWJ1dGVzIjsKICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgU3RyaW5nIEVMRU1fTElTVEVORVIgPSAiZW50aXR5LWxpc3RlbmVy\nIjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIEVMRU1fQ0FT\nQ0FERSA9ICJjYXNjYWRlIjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\nU3RyaW5nIEVMRU1fQ0FTQ0FERV9BTEwgPSAiY2FzY2FkZS1hbGwiOwogICAg\ncHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBTdHJpbmcgRUxFTV9DQVNDQURFX1BF\nUiA9ICJjYXNjYWRlLXBlcnNpc3QiOwogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBTdHJpbmcgRUxFTV9DQVNDQURFX01FUiA9ICJjYXNjYWRlLW1lcmdl\nIjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIEVMRU1fQ0FT\nQ0FERV9SRU0gPSAiY2FzY2FkZS1yZW1vdmUiOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBTdHJpbmcgRUxFTV9DQVNDQURFX1JFRiA9ICJjYXNjYWRl\nLXJlZnJlc2giOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nRUxFTV9QVV9NRVRBID0gInBlcnNpc3RlbmNlLXVuaXQtbWV0YWRhdGEiOwog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBTdHJpbmcgRUxFTV9QVV9ERUYg\nPSAicGVyc2lzdGVuY2UtdW5pdC1kZWZhdWx0cyI7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTWFwPFN0cmluZywgT2JqZWN0PiBfZWxlbXMgPQogICAg\nICAgIG5ldyBIYXNoTWFwPFN0cmluZywgT2JqZWN0PigpOwoKICAgIHN0YXRp\nYyB7CiAgICAgICAgX2VsZW1zLnB1dChFTEVNX1BLRywgRUxFTV9QS0cpOwog\nICAgICAgIF9lbGVtcy5wdXQoRUxFTV9BQ0NFU1MsIEVMRU1fQUNDRVNTKTsK\nICAgICAgICBfZWxlbXMucHV0KEVMRU1fQVRUUlMsIEVMRU1fQVRUUlMpOwog\nICAgICAgIF9lbGVtcy5wdXQoRUxFTV9MSVNURU5FUiwgRUxFTV9MSVNURU5F\nUik7CiAgICAgICAgX2VsZW1zLnB1dChFTEVNX0NBU0NBREUsIEVMRU1fQ0FT\nQ0FERSk7CiAgICAgICAgX2VsZW1zLnB1dChFTEVNX0NBU0NBREVfQUxMLCBF\nTEVNX0NBU0NBREVfQUxMKTsKICAgICAgICBfZWxlbXMucHV0KEVMRU1fQ0FT\nQ0FERV9QRVIsIEVMRU1fQ0FTQ0FERV9QRVIpOwogICAgICAgIF9lbGVtcy5w\ndXQoRUxFTV9DQVNDQURFX1JFTSwgRUxFTV9DQVNDQURFX1JFTSk7CiAgICAg\nICAgX2VsZW1zLnB1dChFTEVNX0NBU0NBREVfTUVSLCBFTEVNX0NBU0NBREVf\nTUVSKTsKICAgICAgICBfZWxlbXMucHV0KEVMRU1fQ0FTQ0FERV9SRUYsIEVM\nRU1fQ0FTQ0FERV9SRUYpOwogICAgICAgIF9lbGVtcy5wdXQoRUxFTV9QVV9N\nRVRBLCBFTEVNX1BVX01FVEEpOwogICAgICAgIF9lbGVtcy5wdXQoRUxFTV9Q\nVV9ERUYsIEVMRU1fUFVfREVGKTsKCiAgICAgICAgX2VsZW1zLnB1dCgiZW50\naXR5LWxpc3RlbmVycyIsIEVOVElUWV9MSVNURU5FUlMpOwogICAgICAgIF9l\nbGVtcy5wdXQoInByZS1wZXJzaXN0IiwgUFJFX1BFUlNJU1QpOwogICAgICAg\nIF9lbGVtcy5wdXQoInBvc3QtcGVyc2lzdCIsIFBPU1RfUEVSU0lTVCk7CiAg\nICAgICAgX2VsZW1zLnB1dCgicHJlLXJlbW92ZSIsIFBSRV9SRU1PVkUpOwog\nICAgICAgIF9lbGVtcy5wdXQoInBvc3QtcmVtb3ZlIiwgUE9TVF9SRU1PVkUp\nOwogICAgICAgIF9lbGVtcy5wdXQoInByZS11cGRhdGUiLCBQUkVfVVBEQVRF\nKTsKICAgICAgICBfZWxlbXMucHV0KCJwb3N0LXVwZGF0ZSIsIFBPU1RfVVBE\nQVRFKTsKICAgICAgICBfZWxlbXMucHV0KCJwb3N0LWxvYWQiLCBQT1NUX0xP\nQUQpOwogICAgICAgIF9lbGVtcy5wdXQoImV4Y2x1ZGUtZGVmYXVsdC1saXN0\nZW5lcnMiLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJTKTsKICAgICAgICBf\nZWxlbXMucHV0KCJleGNsdWRlLXN1cGVyY2xhc3MtbGlzdGVuZXJzIiwKICAg\nICAgICAgICAgRVhDTFVERV9TVVBFUkNMQVNTX0xJU1RFTkVSUyk7CgogICAg\nICAgIF9lbGVtcy5wdXQoIm5hbWVkLXF1ZXJ5IiwgUVVFUlkpOwogICAgICAg\nIF9lbGVtcy5wdXQoIm5hbWVkLW5hdGl2ZS1xdWVyeSIsIE5BVElWRV9RVUVS\nWSk7CiAgICAgICAgX2VsZW1zLnB1dCgicXVlcnktaGludCIsIFFVRVJZX0hJ\nTlQpOwogICAgICAgIF9lbGVtcy5wdXQoInF1ZXJ5IiwgUVVFUllfU1RSSU5H\nKTsKCiAgICAgICAgX2VsZW1zLnB1dCgiZmx1c2gtbW9kZSIsIEZMVVNIX01P\nREUpOwogICAgICAgIF9lbGVtcy5wdXQoInNlcXVlbmNlLWdlbmVyYXRvciIs\nIFNFUV9HRU5FUkFUT1IpOwoKICAgICAgICBfZWxlbXMucHV0KCJpZCIsIElE\nKTsKICAgICAgICBfZWxlbXMucHV0KCJpZC1jbGFzcyIsIElEX0NMQVNTKTsK\nICAgICAgICBfZWxlbXMucHV0KCJlbWJlZGRlZC1pZCIsIEVNQkVEREVEX0lE\nKTsKICAgICAgICBfZWxlbXMucHV0KCJ2ZXJzaW9uIiwgVkVSU0lPTik7CiAg\nICAgICAgX2VsZW1zLnB1dCgiZ2VuZXJhdGVkLXZhbHVlIiwgR0VORVJBVEVE\nX1ZBTFVFKTsKICAgICAgICBfZWxlbXMucHV0KCJtYXAta2V5IiwgTUFQX0tF\nWSk7CiAgICAgICAgX2VsZW1zLnB1dCgib3JkZXItYnkiLCBPUkRFUl9CWSk7\nCiAgICAgICAgX2VsZW1zLnB1dCgibG9iIiwgTE9CKTsKCiAgICAgICAgX2Vs\nZW1zLnB1dCgiYmFzaWMiLCBCQVNJQyk7CiAgICAgICAgX2VsZW1zLnB1dCgi\nbWFueS10by1vbmUiLCBNQU5ZX09ORSk7CiAgICAgICAgX2VsZW1zLnB1dCgi\nb25lLXRvLW9uZSIsIE9ORV9PTkUpOwogICAgICAgIF9lbGVtcy5wdXQoImVt\nYmVkZGVkIiwgRU1CRURERUQpOwogICAgICAgIF9lbGVtcy5wdXQoIm9uZS10\nby1tYW55IiwgT05FX01BTlkpOwogICAgICAgIF9lbGVtcy5wdXQoIm1hbnkt\ndG8tbWFueSIsIE1BTllfTUFOWSk7CiAgICAgICAgX2VsZW1zLnB1dCgidHJh\nbnNpZW50IiwgVFJBTlNJRU5UKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nCiAgICAgICAgKFhNTFBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgZmluYWwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2Nv\nbmY7CiAgICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3MgPSBu\ndWxsOwogICAgcHJpdmF0ZSBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlciBfcGFyc2VyID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NMb2Fk\nZXIgX2VudkxvYWRlciA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbW9kZSA9\nIE1PREVfTk9ORTsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3ZlcnJpZGUgPSBm\nYWxzZTsKCiAgICBwcml2YXRlIGZpbmFsIFN0YWNrIF9lbGVtZW50cyA9IG5l\ndyBTdGFjaygpOwogICAgcHJpdmF0ZSBmaW5hbCBTdGFjayBfcGFyZW50cyA9\nIG5ldyBTdGFjaygpOwoKICAgIHByaXZhdGUgQ2xhc3MgX2NscyA9IG51bGw7\nCiAgICBwcml2YXRlIGludCBfZmllbGRQb3MgPSAwOwogICAgcHJpdmF0ZSBp\nbnQgX2Nsc1BvcyA9IDA7CiAgICBwcml2YXRlIGludCBfYWNjZXNzID0gQ2xh\nc3NNZXRhRGF0YS5BQ0NFU1NfVU5LTk9XTjsKICAgIHByaXZhdGUgUGVyc2lz\ndGVuY2VTdHJhdGVneSBfc3RyYXRlZ3kgPSBudWxsOwogICAgcHJpdmF0ZSBT\nZXQ8Q2FzY2FkZVR5cGU+IF9jYXNjYWRlcyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldDxDYXNjYWRlVHlwZT4gX3BrZ0Nhc2NhZGVzID0gbnVsbDsKCiAgICBw\ncml2YXRlIENsYXNzIF9saXN0ZW5lciA9IG51bGw7CiAgICBwcml2YXRlIENv\nbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIF9jYWxsYmFja3MgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnRbXSBfaGlnaHMgPSBudWxsOwoKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBjb25maWd1cmF0aW9uLgog\nICAgICovCiAgICBwdWJsaWMgWE1MUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNl\ncihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2NvbmYg\nPSBjb25mOwogICAgICAgIHNldFZhbGlkYXRpbmcodHJ1ZSk7CiAgICAgICAg\nc2V0TG9nKGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19N\nRVRBREFUQSkpOwogICAgICAgIHNldFBhcnNlQ29tbWVudHModHJ1ZSk7CiAg\nICAgICAgc2V0TW9kZShNT0RFX01FVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RF\nX1FVRVJZKTsKICAgICAgICBzZXRQYXJzZVRleHQodHJ1ZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uIHN1cHBsaWVkIG9uIGNvbnN0\ncnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFDb25maWd1cmF0\naW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25m\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGFubm90YXRpb24gcGFyc2Vy\nLiBXaGVuIGNsYXNzIGlzIGRpc2NvdmVyZWQgaW4gYW4gWE1MIGZpbGUsCiAg\nICAgKiB3ZSBmaXJzdCBwYXJzZSBhbnkgYW5ub3RhdGlvbnMgcHJlc2VudCwg\ndGhlbiBvdmVycmlkZSB3aXRoIHRoZSBYTUwuCiAgICAgKi8KICAgIHB1Ymxp\nYyBBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlciBnZXRBbm5v\ndGF0aW9uUGFyc2VyKCkgewogICAgICAgIHJldHVybiBfcGFyc2VyOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGFubm90YXRpb24gcGFyc2VyLiBXaGVu\nIGNsYXNzIGlzIGRpc2NvdmVyZWQgaW4gYW4gWE1MIGZpbGUsCiAgICAgKiB3\nZSBmaXJzdCBwYXJzZSBhbnkgYW5ub3RhdGlvbnMgcHJlc2VudCwgdGhlbiBv\ndmVycmlkZSB3aXRoIHRoZSBYTUwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEFubm90YXRpb25QYXJzZXIoQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0\nYURhdGFQYXJzZXIgcGFyc2VyKXsKICAgICAgICBfcGFyc2VyID0gcGFyc2Vy\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgcmVwb3NpdG9y\neSBmb3IgdGhpcyBwYXJzZXIuIElmIG5vbmUgaGFzIGJlZW4gc2V0LCBjcmVh\ndGVzCiAgICAgKiBhIG5ldyByZXBvc2l0b3J5IGFuZCBzZXRzIGl0LgogICAg\nICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5IGdldFJlcG9zaXRv\ncnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9jb25mLm5ld01ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIE1ldGFEYXRh\nRmFjdG9yeSBtZGYgPSByZXBvcy5nZXRNZXRhRGF0YUZhY3RvcnkoKTsKICAg\nICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIERlbGVnYXRpbmdNZXRhRGF0\nYUZhY3RvcnkpCiAgICAgICAgICAgICAgICBtZGYgPSAoKERlbGVnYXRpbmdN\nZXRhRGF0YUZhY3RvcnkpIG1kZikuZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsK\nICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIFBlcnNpc3RlbmNlTWV0\nYURhdGFGYWN0b3J5KQogICAgICAgICAgICAgICAgKChQZXJzaXN0ZW5jZU1l\ndGFEYXRhRmFjdG9yeSkgbWRmKS5zZXRYTUxQYXJzZXIodGhpcyk7CiAgICAg\nICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX3JlcG9zOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtZXRh\nZGF0YSByZXBvc2l0b3J5IGZvciB0aGlzIHBhcnNlci4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0UmVwb3NpdG9yeShNZXRhRGF0YVJlcG9zaXRvcnkg\ncmVwb3MpIHsKICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBpZiAo\ncmVwb3MgIT0gbnVsbAogICAgICAgICAgICAmJiAocmVwb3MuZ2V0VmFsaWRh\ndGUoKSAmIHJlcG9zLlZBTElEQVRFX1JVTlRJTUUpICE9IDApCiAgICAgICAg\nICAgIHNldFBhcnNlQ29tbWVudHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciB0\nbyBwYXNzIG9uIHRvIHBhcnNlZAogICAgICogbWV0YWRhdGEgaW5zdGFuY2Vz\nLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0RW52Q2xhc3NM\nb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIF9lbnZMb2FkZXI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgdGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9h\nZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2VkCiAgICAgKiBtZXRhZGF0YSBpbnN0\nYW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVudkNsYXNzTG9h\nZGVyKENsYXNzTG9hZGVyIGxvYWRlcikgewogICAgICAgIF9lbnZMb2FkZXIg\nPSBsb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGFs\nbG93IGxhdGVyIHBhcnNlcyBvZiBtYXBwaW5nIGluZm9ybWF0aW9uIHRvIG92\nZXJyaWRlCiAgICAgKiBlYXJsaWVyIGluZm9ybWF0aW9uIGZvciB0aGUgc2Ft\nZSBjbGFzcy4gRGVmYXVsdHMgdG8gZmFsc2UuIFVzZWZ1bAogICAgICogd2hl\nbiBhIHRvb2wgaXMgbWFwcGluZyBhIGNsYXNzLCBzbyB0aGF0IC5qZG8gZmls\nZSBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1\nc2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUgc3RvcmVkIGluIC5vcm0gZmls\nZXMKICAgICAqIG9yIG90aGVyIGxvY2F0aW9ucy4KICAgICAqLwogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0TWFwcGluZ092ZXJyaWRlKCkgewogICAgICAgIHJl\ndHVybiBfb3ZlcnJpZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRvIGFsbG93IGxhdGVyIHBhcnNlcyBvZiBtYXBwaW5nIGluZm9ybWF0aW9u\nIHRvIG92ZXJyaWRlCiAgICAgKiBlYXJsaWVyIGluZm9ybWF0aW9uIGZvciB0\naGUgc2FtZSBjbGFzcy4gRGVmYXVsdHMgdG8gZmFsc2UuIFVzZWZ1bAogICAg\nICogd2hlbiBhIHRvb2wgaXMgbWFwcGluZyBhIGNsYXNzLCBzbyB0aGF0IC5q\nZG8gZmlsZSBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGluZm9ybWF0aW9uIGNh\nbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUgc3RvcmVkIGluIC5v\ncm0gZmlsZXMKICAgICAqIG9yIG90aGVyIGxvY2F0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TWFwcGluZ092ZXJyaWRlKGJvb2xlYW4gb3Zl\ncnJpZGUpIHsKICAgICAgICBfb3ZlcnJpZGUgPSBvdmVycmlkZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBwYXJzZSBtb2RlIGFjY29yZGluZyB0byB0\naGUgZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4gVGhlCiAgICAgKiBtb2RlIGNv\nbnN0YW50cyBhY3QgYXMgYml0IGZsYWdzLCBhbmQgdGhlcmVmb3JlIGNhbiBi\nZSBjb21iaW5lZC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNb2RlKCkg\newogICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBwYXJzZSBtb2RlIGFjY29yZGluZyB0byB0aGUgZXhwZWN0ZWQgZG9j\ndW1lbnQgdHlwZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TW9kZShp\nbnQgbW9kZSwgYm9vbGVhbiBvbikgewogICAgICAgIGlmIChtb2RlID09IE1P\nREVfTk9ORSkKICAgICAgICAgICAgc2V0TW9kZShNT0RFX05PTkUpOwogICAg\nICAgIGVsc2UgaWYgKG9uKQogICAgICAgICAgICBzZXRNb2RlKF9tb2RlIHwg\nbW9kZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRNb2RlKF9tb2Rl\nICYgfm1vZGUpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHBhcnNlIG1v\nZGUgYWNjb3JkaW5nIHRvIHRoZSBleHBlY3RlZCBkb2N1bWVudCB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBtb2RlKSB7CiAg\nICAgICAgX21vZGUgPSBtb2RlOwogICAgICAgIGlmIChfcGFyc2VyICE9IG51\nbGwpCiAgICAgICAgICAgIF9wYXJzZXIuc2V0TW9kZShtb2RlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJw\ncmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzTWV0YURhdGFNb2RlKCkgewogICAgICAgIHJldHVybiAo\nX21vZGUgJiBNT0RFX01FVEEpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsg\nI2dldE1vZGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1\nZXJ5TW9kZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTU9ERV9RVUVS\nWSkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1l\ndGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ01vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIChfbW9kZSAmIE1PREVfTUFQUElORykgIT0gMDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB3ZSdyZSBpbiBt\nYXBwaW5nIG1vZGUgb3IgaW4gbWV0YWRhdGEgbW9kZSB3aXRoCiAgICAgKiBt\nYXBwaW5nIG92ZXJyaWRlIGVuYWJsZWQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpIHsKICAgICAgICBy\nZXR1cm4gaXNNYXBwaW5nTW9kZSgpIHx8IChfb3ZlcnJpZGUgJiYgaXNNZXRh\nRGF0YU1vZGUoKSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vCiAgICAv\nLyBYTUwgcGFyc2luZwogICAgLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAg\nICAgKiBQdXNoIGEgcGFyc2UgZWxlbWVudCBvbnRvIHRoZSBzdGFjay4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcHVzaEVsZW1lbnQoT2JqZWN0IGVs\nZW0pIHsKICAgICAgICBfZWxlbWVudHMucHVzaChlbGVtKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBvcCBhIHBhcnNlIGVsZW1lbnQgZnJvbSB0aGUgc3Rh\nY2suCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgcG9wRWxlbWVudCgp\nIHsKICAgICAgICByZXR1cm4gX2VsZW1lbnRzLnBvcCgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXJyZW50IGVsZW1lbnQgYmVpbmcg\ncGFyc2VkLiBNYXkgYmUgYSBjbGFzcyBtZXRhZGF0YSwKICAgICAqIGZpZWxk\nIG1ldGFkYXRhLCBxdWVyeSBtZXRhZGF0YSwgZXRjLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgT2JqZWN0IGN1cnJlbnRFbGVtZW50KCkgewogICAgICAgIGlm\nIChfZWxlbWVudHMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICByZXR1cm4gX2VsZW1lbnRzLnBlZWsoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY3VycmVudCB7QGxpbmsgUGVyc2lz\ndGVuY2VTdHJhdGVneX0gaWYgYW55LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nUGVyc2lzdGVuY2VTdHJhdGVneSBjdXJyZW50U3RyYXRlZ3koKSB7CiAgICAg\nICAgcmV0dXJuIF9zdHJhdGVneTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgdGFnIG9mIHRoZSBjdXJyZW50IHBhcmVudCBlbGVtZW50Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IGN1cnJlbnRQYXJlbnQoKSB7\nCiAgICAgICAgaWYgKF9wYXJlbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIF9wYXJlbnRzLnBlZWsoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHdlJ3JlIHJ1\nbm5pbmcgdGhlIHBhcnNlciBhdCBydW50aW1lLgogICAgICovCiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiBpc1J1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIChn\nZXRSZXBvc2l0b3J5KCkuZ2V0VmFsaWRhdGUoKQogICAgICAgICAgICAmIE1l\ndGFEYXRhUmVwb3NpdG9yeS5WQUxJREFURV9SVU5USU1FKSAhPSAwOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIE9iamVjdCBnZXRTY2hl\nbWFTb3VyY2UoKSB7CiAgICAgICAgcmV0dXJuIFhNTFBlcnNpc3RlbmNlTWV0\nYURhdGFQYXJzZXIuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbQogICAgICAg\nICAgICAoIm9ybS14c2QucnNyYyIpOwogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHJvdGVjdGVkIFN0cmluZyBnZXRQYWNrYWdlQXR0cmlidXRlTmFtZSgp\nIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q2xhc3NBdHRyaWJ1dGVOYW1lKCkg\newogICAgICAgIHJldHVybiAiY2xhc3MiOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHJvdGVjdGVkIGludCBnZXRDbGFzc0VsZW1lbnREZXB0aCgpIHsK\nICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCBib29sZWFuIGlzQ2xhc3NFbGVtZW50TmFtZShTdHJpbmcgbmFt\nZSkgewogICAgICAgIHJldHVybiAiZW50aXR5Ii5lcXVhbHMobmFtZSkKICAg\nICAgICAgICAgfHwgImVtYmVkZGFibGUiLmVxdWFscyhuYW1lKQogICAgICAg\nICAgICB8fCAibWFwcGVkLXN1cGVyY2xhc3MiLmVxdWFscyhuYW1lKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHJlc2V0KCkg\newogICAgICAgIHN1cGVyLnJlc2V0KCk7CiAgICAgICAgX2VsZW1lbnRzLmNs\nZWFyKCk7CiAgICAgICAgX3BhcmVudHMuY2xlYXIoKTsKICAgICAgICBfY2xz\nID0gbnVsbDsKICAgICAgICBfZmllbGRQb3MgPSAwOwogICAgICAgIF9jbHNQ\nb3MgPSAwOwoKICAgICAgICBfYWNjZXNzID0gQ2xhc3NNZXRhRGF0YS5BQ0NF\nU1NfVU5LTk9XTjsKICAgICAgICBfc3RyYXRlZ3kgPSBudWxsOwogICAgICAg\nIF9saXN0ZW5lciA9IG51bGw7CiAgICAgICAgX2NhbGxiYWNrcyA9IG51bGw7\nCiAgICAgICAgX2hpZ2hzID0gbnVsbDsKICAgICAgICBfY2FzY2FkZXMgPSBu\ndWxsOwogICAgICAgIF9wa2dDYXNjYWRlcyA9IG51bGw7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdGFydFN5c3RlbUVs\nZW1lbnQoU3RyaW5nIG5hbWUsIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAg\ndGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IHRhZyA9IChP\nYmplY3QpIF9lbGVtcy5nZXQobmFtZSk7CiAgICAgICAgYm9vbGVhbiByZXQg\nPSBmYWxzZTsKICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAg\nICAgdGFnID0gc3RhcnRTeXN0ZW1NYXBwaW5nRWxlbWVudChuYW1lLCBhdHRy\ncyk7CiAgICAgICAgICAgIHJldCA9IHRhZyAhPSBudWxsOwogICAgICAgIH0g\nZWxzZSBpZiAodGFnIGluc3RhbmNlb2YgTWV0YURhdGFUYWcpIHsKICAgICAg\nICAgICAgc3dpdGNoICgoTWV0YURhdGFUYWcpIHRhZykgewogICAgICAgICAg\nICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAgICByZXQgPSBz\ndGFydE5hbWVkUXVlcnkoYXR0cnMpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBRVUVSWV9ISU5UOgogICAgICAg\nICAgICAgICAgICAgIHJldCA9IHN0YXJ0UXVlcnlIaW50KGF0dHJzKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nTkFUSVZFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0\nTmFtZWROYXRpdmVRdWVyeShhdHRycyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJZX1NUUklORzoKICAg\nICAgICAgICAgICAgICAgICByZXQgPSBzdGFydFF1ZXJ5U3RyaW5nKGF0dHJz\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgU0VRX0dFTkVSQVRPUjoKICAgICAgICAgICAgICAgICAgICByZXQg\nPSBzdGFydFNlcXVlbmNlR2VuZXJhdG9yKGF0dHJzKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkxVU0hfTU9E\nRToKICAgICAgICAgICAgICAgICAgICByZXQgPSBzdGFydEZsdXNoTW9kZShh\ndHRycyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEVOVElUWV9MSVNURU5FUlM6CiAgICAgICAgICAgICAgICAg\nICAgcmV0ID0gc3RhcnRFbnRpdHlMaXN0ZW5lcnMoYXR0cnMpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgICAgICB3YXJuVW5zdXBwb3J0ZWRUYWcobmFtZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRhZyA9PSBFTEVN\nX1BVX01FVEEgfHwgdGFnID09IEVMRU1fUFVfREVGKQogICAgICAgICAgICBy\nZXQgPSBpc01ldGFEYXRhTW9kZSgpOwogICAgICAgIGVsc2UgaWYgKHRhZyA9\nPSBFTEVNX0FDQ0VTUykKICAgICAgICAgICAgcmV0ID0gX21vZGUgIT0gTU9E\nRV9RVUVSWTsKICAgICAgICBlbHNlIGlmICh0YWcgPT0gRUxFTV9MSVNURU5F\nUikKICAgICAgICAgICAgcmV0ID0gc3RhcnRFbnRpdHlMaXN0ZW5lcihhdHRy\ncyk7CiAgICAgICAgZWxzZSBpZiAodGFnID09IEVMRU1fQ0FTQ0FERSkKICAg\nICAgICAgICAgcmV0ID0gaXNNZXRhRGF0YU1vZGUoKTsKICAgICAgICBlbHNl\nIGlmICh0YWcgPT0gRUxFTV9DQVNDQURFX0FMTCB8fCB0YWcgPT0gRUxFTV9D\nQVNDQURFX1BFUgogICAgICAgICAgICB8fCB0YWcgPT0gRUxFTV9DQVNDQURF\nX01FUiB8fCB0YWcgPT0gRUxFTV9DQVNDQURFX1JFTQogICAgICAgICAgICB8\nfCB0YWcgPT0gRUxFTV9DQVNDQURFX1JFRikKICAgICAgICAgICAgcmV0ID0g\nc3RhcnRDYXNjYWRlKHRhZywgYXR0cnMpOwoKICAgICAgICBpZiAocmV0KQog\nICAgICAgICAgICBfcGFyZW50cy5wdXNoKHRhZyk7CiAgICAgICAgcmV0dXJu\nIHJldDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lk\nIGVuZFN5c3RlbUVsZW1lbnQoU3RyaW5nIG5hbWUpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IHRhZyA9IF9lbGVtcy5n\nZXQobmFtZSk7CiAgICAgICAgaWYgKHRhZyA9PSBudWxsICYmIGlzTWFwcGlu\nZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICBlbmRTeXN0ZW1NYXBwaW5n\nRWxlbWVudChuYW1lKTsKICAgICAgICBlbHNlIGlmICh0YWcgaW5zdGFuY2Vv\nZiBNZXRhRGF0YVRhZykgewogICAgICAgICAgICBzd2l0Y2ggKChNZXRhRGF0\nYVRhZykgdGFnKSB7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJZOgogICAg\nICAgICAgICAgICAgICAgIGVuZE5hbWVkUXVlcnkoKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUllfSElO\nVDoKICAgICAgICAgICAgICAgICAgICBlbmRRdWVyeUhpbnQoKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTkFU\nSVZFX1FVRVJZOgogICAgICAgICAgICAgICAgICAgIGVuZE5hbWVkTmF0aXZl\nUXVlcnkoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgUVVFUllfU1RSSU5HOgogICAgICAgICAgICAgICAgICAg\nIGVuZFF1ZXJ5U3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFNFUV9HRU5FUkFUT1I6CiAgICAgICAg\nICAgICAgICAgICAgZW5kU2VxdWVuY2VHZW5lcmF0b3IoKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxz\nZSBpZiAodGFnID09IEVMRU1fQUNDRVNTKQogICAgICAgICAgICBlbmRBY2Nl\nc3MoKTsKICAgICAgICBlbHNlIGlmICh0YWcgPT0gRUxFTV9MSVNURU5FUikK\nICAgICAgICAgICAgZW5kRW50aXR5TGlzdGVuZXIoKTsKCiAgICAgICAgX3Bh\ncmVudHMucG9wKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQg\ndG8gcGFyc2UgYSBtYXBwaW5nIGVsZW1lbnQgb3V0c2lkZSBvZiBhbnkgY2xh\nc3MuCiAgICAgKgogICAgICogQHJldHVybiB0aGUgdGFnIGZvciB0aGUgZ2l2\nZW4gZWxlbWVudCwgb3IgbnVsbCB0byBza2lwIHRoZSBlbGVtZW50CiAgICAg\nKi8KICAgIHByb3RlY3RlZCBPYmplY3Qgc3RhcnRTeXN0ZW1NYXBwaW5nRWxl\nbWVudChTdHJpbmcgbmFtZSwgQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0\naHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudCB0byBwYXJzZSBhIG1hcHBp\nbmcgZWxlbWVudCBvdXRzaWRlIG9mIGFueSBjbGFzcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgZW5kU3lzdGVtTWFwcGluZ0VsZW1lbnQoU3RyaW5n\nIG5hbWUpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdGFydENsYXNz\nRWxlbWVudChTdHJpbmcgbmFtZSwgQXR0cmlidXRlcyBhdHRycykKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3QgdGFnID0g\nKE9iamVjdCkgX2VsZW1zLmdldChuYW1lKTsKICAgICAgICBib29sZWFuIHJl\ndCA9IGZhbHNlOwogICAgICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAg\nICAgICB0YWcgPSBzdGFydENsYXNzTWFwcGluZ0VsZW1lbnQobmFtZSwgYXR0\ncnMpOwogICAgICAgICAgICByZXQgPSB0YWcgIT0gbnVsbDsKICAgICAgICB9\nIGVsc2UgaWYgKHRhZyBpbnN0YW5jZW9mIE1ldGFEYXRhVGFnKSB7CiAgICAg\nICAgICAgIHN3aXRjaCAoKE1ldGFEYXRhVGFnKSB0YWcpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgR0VORVJBVEVEX1ZBTFVFOgogICAgICAgICAgICAgICAg\nICAgIHJldCA9IHN0YXJ0R2VuZXJhdGVkVmFsdWUoYXR0cnMpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJRDoK\nICAgICAgICAgICAgICAgICAgICByZXQgPSBzdGFydElkKGF0dHJzKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nRU1CRURERURfSUQ6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRF\nbWJlZGRlZElkKGF0dHJzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSURfQ0xBU1M6CiAgICAgICAgICAgICAg\nICAgICAgcmV0ID0gc3RhcnRJZENsYXNzKGF0dHJzKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTE9COgogICAg\nICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0TG9iKGF0dHJzKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVF\nUlk6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc3RhcnROYW1lZFF1ZXJ5\nKGF0dHJzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgUVVFUllfSElOVDoKICAgICAgICAgICAgICAgICAgICBy\nZXQgPSBzdGFydFF1ZXJ5SGludChhdHRycyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSWToK\nICAgICAgICAgICAgICAgICAgICByZXQgPSBzdGFydE5hbWVkTmF0aXZlUXVl\ncnkoYXR0cnMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBRVUVSWV9TVFJJTkc6CiAgICAgICAgICAgICAgICAg\nICAgcmV0ID0gc3RhcnRRdWVyeVN0cmluZyhhdHRycyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNFUV9HRU5F\nUkFUT1I6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc3RhcnRTZXF1ZW5j\nZUdlbmVyYXRvcihhdHRycyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIFZFUlNJT046CiAgICAgICAgICAgICAg\nICAgICAgcmV0ID0gc3RhcnRWZXJzaW9uKGF0dHJzKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQX0tFWToK\nICAgICAgICAgICAgICAgICAgICByZXQgPSBzdGFydE1hcEtleShhdHRycyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEZMVVNIX01PREU6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc3Rh\ncnRGbHVzaE1vZGUoYXR0cnMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBPUkRFUl9CWToKICAgICAgICAgICAg\nICAgIGNhc2UgRU5USVRZX0xJU1RFTkVSUzoKICAgICAgICAgICAgICAgICAg\nICByZXQgPSBpc01ldGFEYXRhTW9kZSgpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWENMVURFX0RFRkFVTFRf\nTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIHJldCA9IHN0YXJ0RXhj\nbHVkZURlZmF1bHRMaXN0ZW5lcnMoYXR0cnMpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWENMVURFX1NVUEVS\nQ0xBU1NfTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIHJldCA9IHN0\nYXJ0RXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5lcnMoYXR0cnMpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQUkVf\nUEVSU0lTVDoKICAgICAgICAgICAgICAgIGNhc2UgUE9TVF9QRVJTSVNUOgog\nICAgICAgICAgICAgICAgY2FzZSBQUkVfUkVNT1ZFOgogICAgICAgICAgICAg\nICAgY2FzZSBQT1NUX1JFTU9WRToKICAgICAgICAgICAgICAgIGNhc2UgUFJF\nX1VQREFURToKICAgICAgICAgICAgICAgIGNhc2UgUE9TVF9VUERBVEU6CiAg\nICAgICAgICAgICAgICBjYXNlIFBPU1RfTE9BRDoKICAgICAgICAgICAgICAg\nICAgICByZXQgPSBzdGFydENhbGxiYWNrKChNZXRhRGF0YVRhZykgdGFnLCBh\ndHRycyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHdhcm5VbnN1cHBv\ncnRlZFRhZyhuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBp\nZiAodGFnIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VTdHJhdGVneSkgewogICAg\nICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHBzID0gKFBlcnNpc3RlbmNl\nU3RyYXRlZ3kpIHRhZzsKICAgICAgICAgICAgcmV0ID0gc3RhcnRTdHJhdGVn\neShwcywgYXR0cnMpOwogICAgICAgICAgICBpZiAocmV0KQogICAgICAgICAg\nICAgICAgX3N0cmF0ZWd5ID0gcHM7CiAgICAgICAgfSBlbHNlIGlmICh0YWcg\nPT0gRUxFTV9MSVNURU5FUikKICAgICAgICAgICAgcmV0ID0gc3RhcnRFbnRp\ndHlMaXN0ZW5lcihhdHRycyk7CiAgICAgICAgZWxzZSBpZiAodGFnID09IEVM\nRU1fQVRUUlMpCiAgICAgICAgICAgIHJldCA9IF9tb2RlICE9IE1PREVfUVVF\nUlk7CiAgICAgICAgZWxzZSBpZiAodGFnID09IEVMRU1fQ0FTQ0FERSkKICAg\nICAgICAgICAgcmV0ID0gaXNNZXRhRGF0YU1vZGUoKTsKICAgICAgICBlbHNl\nIGlmICh0YWcgPT0gRUxFTV9DQVNDQURFX0FMTCB8fCB0YWcgPT0gRUxFTV9D\nQVNDQURFX1BFUgogICAgICAgICAgICB8fCB0YWcgPT0gRUxFTV9DQVNDQURF\nX01FUiB8fCB0YWcgPT0gRUxFTV9DQVNDQURFX1JFTQogICAgICAgICAgICB8\nfCB0YWcgPT0gRUxFTV9DQVNDQURFX1JFRikKICAgICAgICAgICAgcmV0ID0g\nc3RhcnRDYXNjYWRlKHRhZywgYXR0cnMpOwoKICAgICAgICBpZiAocmV0KQog\nICAgICAgICAgICBfcGFyZW50cy5wdXNoKHRhZyk7CiAgICAgICAgcmV0dXJu\nIHJldDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lk\nIGVuZENsYXNzRWxlbWVudChTdHJpbmcgbmFtZSkKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3QgdGFnID0gX2VsZW1zLmdl\ndChuYW1lKTsKICAgICAgICBpZiAodGFnID09IG51bGwgJiYgaXNNYXBwaW5n\nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgIGVuZENsYXNzTWFwcGluZ0Vs\nZW1lbnQobmFtZSk7CiAgICAgICAgZWxzZSBpZiAodGFnIGluc3RhbmNlb2Yg\nTWV0YURhdGFUYWcpIHsKICAgICAgICAgICAgc3dpdGNoICgoTWV0YURhdGFU\nYWcpIHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBHRU5FUkFURURfVkFM\nVUU6CiAgICAgICAgICAgICAgICAgICAgZW5kR2VuZXJhdGVkVmFsdWUoKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSUQ6CiAgICAgICAgICAgICAgICAgICAgZW5kSWQoKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU1CRURE\nRURfSUQ6CiAgICAgICAgICAgICAgICAgICAgZW5kRW1iZWRkZWRJZCgpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBJRF9DTEFTUzoKICAgICAgICAgICAgICAgICAgICBlbmRJZENsYXNzKCk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIExPQjoKICAgICAgICAgICAgICAgICAgICBlbmRMb2IoKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVF\nUlk6CiAgICAgICAgICAgICAgICAgICAgZW5kTmFtZWRRdWVyeSgpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBR\nVUVSWV9ISU5UOgogICAgICAgICAgICAgICAgICAgIGVuZFF1ZXJ5SGludCgp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBOQVRJVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgZW5kTmFt\nZWROYXRpdmVRdWVyeSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBRVUVSWV9TVFJJTkc6CiAgICAgICAgICAg\nICAgICAgICAgZW5kUXVlcnlTdHJpbmcoKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVSQVRPUjoK\nICAgICAgICAgICAgICAgICAgICBlbmRTZXF1ZW5jZUdlbmVyYXRvcigpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBWRVJTSU9OOgogICAgICAgICAgICAgICAgICAgIGVuZFZlcnNpb24oKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgT1JERVJfQlk6CiAgICAgICAgICAgICAgICAgICAgZW5kT3JkZXJCeSgp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBlbHNlIGlmICh0YWcgaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZVN0\ncmF0ZWd5KQogICAgICAgICAgICBlbmRTdHJhdGVneSgoUGVyc2lzdGVuY2VT\ndHJhdGVneSkgdGFnKTsKICAgICAgICBlbHNlIGlmICh0YWcgPT0gRUxFTV9B\nQ0NFU1MpCiAgICAgICAgICAgIGVuZEFjY2VzcygpOwogICAgICAgIGVsc2Ug\naWYgKHRhZyA9PSBFTEVNX0xJU1RFTkVSKQogICAgICAgICAgICBlbmRFbnRp\ndHlMaXN0ZW5lcigpOwoKICAgICAgICBfcGFyZW50cy5wb3AoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIExvZyB3YXJuaW5nIGFib3V0IGFuIHVuc3VwcG9y\ndGVkIHRhZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdhcm5VbnN1cHBv\ncnRlZFRhZyhTdHJpbmcgbmFtZSkgewogICAgICAgIExvZyBsb2cgPSBnZXRM\nb2coKTsKICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAg\nICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJ1bnN1cHBvcnRlZC10YWciLCBu\nYW1lKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdG8gcGFy\nc2UgYSBtYXBwaW5nIGVsZW1lbnQgd2l0aGluIGEgY2xhc3MuCiAgICAgKgog\nICAgICogQHJldHVybiB0aGUgdGFnIGZvciB0aGUgZ2l2ZW4gZWxlbWVudCwg\nb3IgbnVsbCB0byBza2lwIGVsZW1lbnQKICAgICAqLwogICAgcHJvdGVjdGVk\nIE9iamVjdCBzdGFydENsYXNzTWFwcGluZ0VsZW1lbnQoU3RyaW5nIG5hbWUs\nIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbXBsZW1lbnQgdG8gcGFyc2UgYSBtYXBwaW5nIGVsZW1lbnQgd2l0aGlu\nIGEgY2xhc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGVuZENsYXNz\nTWFwcGluZ0VsZW1lbnQoU3RyaW5nIG5hbWUpCiAgICAgICAgdGhyb3dzIFNB\nWEV4Y2VwdGlvbiB7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0\nZWQgYm9vbGVhbiBzdGFydENsYXNzKFN0cmluZyBlbGVtLCBBdHRyaWJ1dGVz\nIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAg\nIHN1cGVyLnN0YXJ0Q2xhc3MoZWxlbSwgYXR0cnMpOwoKICAgICAgICAvLyBx\ndWVyeSBtb2RlIG9ubHk/CiAgICAgICAgX2NscyA9IGNsYXNzRm9yTmFtZShj\ndXJyZW50Q2xhc3NOYW1lKCkpOwogICAgICAgIGlmIChfbW9kZSA9PSBNT0RF\nX1FVRVJZKSB7CiAgICAgICAgICAgIGlmIChfcGFyc2VyICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfcGFyc2VyLnBhcnNlKF9jbHMpOwogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIExvZyBsb2cgPSBn\nZXRMb2coKTsKICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInBhcnNlLWNsYXNzIiwgX2Ns\ncy5nZXROYW1lKCkpKTsKCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IHJl\ncG9zID0gZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IHJlcG9zLmdldENhY2hlZE1ldGFEYXRhKF9jbHMpOwogICAgICAg\nIGlmIChtZXRhICE9IG51bGwKICAgICAgICAgICAgJiYgKChpc01ldGFEYXRh\nTW9kZSgpICYmIChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUVUQSkg\nIT0gMCkKICAgICAgICAgICAgfHwgKGlzTWFwcGluZ01vZGUoKSAmJiAobWV0\nYS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01BUFBJTkcpICE9IDApKSkKICAg\nICAgICB7CiAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImR1cC1tZXRhZGF0\nYSIsIF9jbHMsIGdldFNvdXJjZU5hbWUoKSkpOwogICAgICAgICAgICBfY2xz\nID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBh\nZGQgbWV0YWRhdGEgZm9yIHRoaXMgdHlwZQogICAgICAgICAgICBpbnQgYWNj\nZXNzID0gdG9BY2Nlc3NUeXBlKGF0dHJzLmdldFZhbHVlKCJhY2Nlc3MiKSwg\nX2FjY2Vzcyk7CiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5hZGRNZXRhRGF0\nYShfY2xzLCBhY2Nlc3MpOwogICAgICAgICAgICBtZXRhLnNldEVudkNsYXNz\nTG9hZGVyKF9lbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRhLnNldFNvdXJj\nZU1vZGUoTU9ERV9OT05FKTsKCiAgICAgICAgICAgIC8vIHBhcnNlIGFubm90\nYXRpb25zIGZpcnN0IHNvIFhNTCBvdmVycmlkZXMgdGhlbQogICAgICAgICAg\nICBpZiAoX3BhcnNlciAhPSBudWxsKQogICAgICAgICAgICAgICAgX3BhcnNl\nci5wYXJzZShfY2xzKTsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gbWFw\ncGVkU3VwZXIgPSAibWFwcGVkLXN1cGVyY2xhc3MiLmVxdWFscyhlbGVtKTsK\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkgewogICAgICAgICAgICBt\nZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIG1ldGEuU1JDX1hNTCk7\nCiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01FVEEsIHRy\ndWUpOwogICAgICAgICAgICBtZXRhLnNldExpc3RpbmdJbmRleChfY2xzUG9z\nKTsKICAgICAgICAgICAgbWV0YS5zZXRFbWJlZGRlZE9ubHkobWFwcGVkU3Vw\nZXIgfHwgImVtYmVkZGFibGUiLmVxdWFscyhlbGVtKSk7CiAgICAgICAgICAg\nIGlmIChtYXBwZWRTdXBlcikKICAgICAgICAgICAgICAgIG1ldGEuc2V0SWRl\nbnRpdHlUeXBlKG1ldGEuSURfVU5LTk9XTik7CiAgICAgICAgfQogICAgICAg\nIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgIG1ldGEuc2V0U291\ncmNlTW9kZShNT0RFX01BUFBJTkcsIHRydWUpOwogICAgICAgIGlmIChpc01h\ncHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgc3RhcnRDbGFzc01h\ncHBpbmcobWV0YSwgbWFwcGVkU3VwZXIsIGF0dHJzKTsKICAgICAgICBpZiAo\naXNRdWVyeU1vZGUoKSkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2Rl\nKE1PREVfUVVFUlksIHRydWUpOwoKICAgICAgICBfY2xzUG9zKys7CiAgICAg\nICAgX2ZpZWxkUG9zID0gMDsKICAgICAgICBhZGRDb21tZW50cyhtZXRhKTsK\nICAgICAgICBwdXNoRWxlbWVudChtZXRhKTsKICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGVu\nZENsYXNzKFN0cmluZyBlbGVtKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRp\nb24gewogICAgICAgIGlmIChfbW9kZSAhPSBNT0RFX1FVRVJZKSB7CiAgICAg\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBw\nb3BFbGVtZW50KCk7CiAgICAgICAgICAgIHN0b3JlQ2FsbGJhY2tzKG1ldGEp\nOwogICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAg\nICAgICAgICAgICAgICBlbmRDbGFzc01hcHBpbmcobWV0YSk7CiAgICAgICAg\nfQogICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgIHN1cGVyLmVuZENsYXNz\nKGVsZW0pOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRvIGFk\nZCBtYXBwaW5nIGF0dHJpYnV0ZXMgdG8gY2xhc3MuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHN0YXJ0Q2xhc3NNYXBwaW5nKENsYXNzTWV0YURhdGEg\nbWFwcGluZywKICAgICAgICBib29sZWFuIG1hcHBlZFN1cGVyLCBBdHRyaWJ1\ndGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IHRvIGZpbmFsaXplIGNsYXNz\nIG1hcHBpbmcuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGVuZENsYXNz\nTWFwcGluZyhDbGFzc01ldGFEYXRhIG1hcHBpbmcpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWZhdWx0\nIGFjY2VzcyBlbGVtZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5k\nQWNjZXNzKCkgewogICAgICAgIF9hY2Nlc3MgPSB0b0FjY2Vzc1R5cGUoY3Vy\ncmVudFRleHQoKSwgQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfVU5LTk9XTik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSB0aGUgZ2l2ZW4gc3RyaW5nIGFz\nIGFuIGVudGl0eSBhY2Nlc3MgdHlwZSwgZGVmYXVsdGluZyB0byBnaXZlbgog\nICAgICogZGVmYXVsdCBpZiBzdHJpbmcgaXMgZW1wdHkuCiAgICAgKi8KICAg\nIHByaXZhdGUgaW50IHRvQWNjZXNzVHlwZShTdHJpbmcgc3RyLCBpbnQgZGVm\nKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3RyKSkKICAg\nICAgICAgICAgcmV0dXJuIGRlZjsKICAgICAgICBpZiAoIlBST1BFUlRZIi5l\ncXVhbHMoc3RyKSkKICAgICAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEu\nQUNDRVNTX1BST1BFUlRZOwogICAgICAgIHJldHVybiBDbGFzc01ldGFEYXRh\nLkFDQ0VTU19GSUVMRDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGZs\ndXNoLW1vZGUgZWxlbWVudC4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIHN0YXJ0Rmx1c2hNb2RlKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhy\nb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZygp\nOwogICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCAiZmx1c2gtbW9k\nZSIsIGdldFNvdXJjZU5hbWUoKSkpOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHNlcXVlbmNlLWdlbmVyYXRv\nci4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3RhcnRTZXF1ZW5j\nZUdlbmVyYXRvcihBdHRyaWJ1dGVzIGF0dHJzKSB7CiAgICAgICAgaWYgKCFp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBTdHJpbmcgbmFtZSA9IGF0dHJzLmdldFZhbHVlKCJu\nYW1lIik7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlm\nIChsb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cuaW5mbyhf\nbG9jLmdldCgicGFyc2Utc2VxdWVuY2UiLCBuYW1lKSk7CgogICAgICAgIFNl\ncXVlbmNlTWV0YURhdGEgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNo\nZWRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9\nIG51bGwgJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoIm92ZXJyaWRlLXNlcXVlbmNlIiwgbmFtZSkpOwoK\nICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZFNlcXVlbmNlTWV0\nYURhdGEobmFtZSk7CiAgICAgICAgU3RyaW5nIHNlcSA9IGF0dHJzLmdldFZh\nbHVlKCJzZXF1ZW5jZS1uYW1lIik7CiAgICAgICAgU3RyaW5nIHZhbCA9IGF0\ndHJzLmdldFZhbHVlKCJpbml0aWFsLXZhbHVlIik7CiAgICAgICAgaW50IGlu\naXRpYWwgPSB2YWwgPT0gbnVsbCA/IDEgOiBJbnRlZ2VyLnBhcnNlSW50KHZh\nbCk7CiAgICAgICAgdmFsID0gYXR0cnMuZ2V0VmFsdWUoImFsbG9jYXRpb24t\nc2l6ZSIpOwogICAgICAgIGludCBhbGxvY2F0ZSA9IHZhbCA9PSBudWxsID8g\nNTAgOiBJbnRlZ2VyLnBhcnNlSW50KHZhbCk7CgogICAgICAgIFN0cmluZyBj\nbHNOYW1lLCBwcm9wczsKICAgICAgICBpZiAoc2VxID09IG51bGwgfHwgc2Vx\nLmluZGV4T2YoJygnKSA9PSAtMSkgewogICAgICAgICAgICBjbHNOYW1lID0g\nU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJv\ncHMgPSBudWxsOwogICAgICAgIH0gZWxzZSB7IC8vIHBsdWdpbgogICAgICAg\nICAgICBjbHNOYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKHNl\ncSk7CiAgICAgICAgICAgIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJv\ncGVydGllcyhzZXEpOwogICAgICAgICAgICBzZXEgPSBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgbWV0YS5zZXRTZXF1ZW5jZVBsdWdpbihDb25maWd1cmF0\naW9ucy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJvcHMpKTsKICAgICAgICBtZXRh\nLnNldFNlcXVlbmNlKHNlcSk7CiAgICAgICAgbWV0YS5zZXRJbml0aWFsVmFs\ndWUoaW5pdGlhbCk7CiAgICAgICAgbWV0YS5zZXRBbGxvY2F0ZShhbGxvY2F0\nZSk7CgogICAgICAgIE9iamVjdCBjdXIgPSBjdXJyZW50RWxlbWVudCgpOwog\nICAgICAgIE9iamVjdCBzY29wZSA9IChjdXIgaW5zdGFuY2VvZiBDbGFzc01l\ndGFEYXRhKQogICAgICAgICAgICA/ICgoQ2xhc3NNZXRhRGF0YSkgY3VyKS5n\nZXREZXNjcmliZWRUeXBlKCkgOiBudWxsOwogICAgICAgIG1ldGEuc2V0U291\ncmNlKGdldFNvdXJjZUZpbGUoKSwgc2NvcGUsIG1ldGEuU1JDX1hNTCk7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQg\nZW5kU2VxdWVuY2VHZW5lcmF0b3IoKSB7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBpZC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3Rh\ncnRJZChBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGFyc2VGaWVs\nZChhdHRycyk7CiAgICAgICAgZm1kLnNldEV4cGxpY2l0KHRydWUpOwogICAg\nICAgIGZtZC5zZXRQcmltYXJ5S2V5KHRydWUpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGVuZElkKCkKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBmaW5pc2hGaWVsZCgp\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZW1iZWRkZWQtaWQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHN0YXJ0RW1iZWRkZWRJZChB\ndHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24g\newogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gcGFyc2VGaWVsZChhdHRy\ncyk7CiAgICAgICAgZm1kLnNldEV4cGxpY2l0KHRydWUpOwogICAgICAgIGZt\nZC5zZXRQcmltYXJ5S2V5KHRydWUpOwogICAgICAgIGZtZC5zZXRFbWJlZGRl\nZCh0cnVlKTsKICAgICAgICBpZiAoZm1kLmdldEVtYmVkZGVkTWV0YURhdGEo\nKSA9PSBudWxsKQogICAgICAgICAgICBmbWQuYWRkRW1iZWRkZWRNZXRhRGF0\nYSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHByb3RlY3Rl\nZCB2b2lkIGVuZEVtYmVkZGVkSWQoKQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIGZpbmlzaEZpZWxkKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBpZC1jbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIGJvb2xlYW4gc3RhcnRJZENsYXNzKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAg\nICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBjdXJyZW50\nRWxlbWVudCgpOwogICAgICAgIFN0cmluZyBjbHMgPSBhdHRycy5nZXRWYWx1\nZSgiY2xhc3MiKTsKICAgICAgICBDbGFzcyBpZENscyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWRDbHMgPSBjbGFzc0Zvck5hbWUoY2xz\nKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAg\nICB0aHJvdyBnZXRFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQtaWQtY2xh\nc3MiLCBtZXRhLCBjbHMpLCB0KTsKICAgICAgICB9CiAgICAgICAgbWV0YS5z\nZXRPYmplY3RJZFR5cGUoaWRDbHMsIHRydWUpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGVuZElkQ2xhc3MoKQog\nICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgbG9iLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBzdGFydExvYihBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBT\nQVhFeGNlcHRpb24gewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gKEZp\nZWxkTWV0YURhdGEpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgaWYgKGZt\nZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlNUUklORwog\nICAgICAgICAgICAmJiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgIT0gY2hhcltd\nLmNsYXNzCiAgICAgICAgICAgICYmIGZtZC5nZXREZWNsYXJlZFR5cGUoKSAh\nPSBDaGFyYWN0ZXJbXS5jbGFzcwogICAgICAgICAgICAmJiBmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCkgIT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICYmIGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSAhPSBCeXRlW10uY2xhc3MpCiAgICAgICAg\nICAgIGZtZC5zZXRTZXJpYWxpemVkKHRydWUpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGVuZExvYigpCiAgICAg\nICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBnZW5lcmF0ZWQtdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIHN0YXJ0R2VuZXJhdGVkVmFsdWUoQXR0cmlidXRlcyBhdHRy\ncykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nIWlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIFN0cmluZyBzdHJhdGVneSA9IGF0dHJzLmdldFZh\nbHVlKCJzdHJhdGVneSIpOwogICAgICAgIFN0cmluZyBnZW5lcmF0b3IgPSBh\ndHRycy5nZXRWYWx1ZSgiZ2VuZXJhdG9yIik7CgogICAgICAgIC8vIFRPRE8g\nVVVJRF9IRVggLyBVVUlEX1NUUklORwogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gKEZpZWxkTWV0YURhdGEpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAg\nICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3RyYXRlZ3kpIHx8ICJBVVRP\nIi5lcXVhbHMoc3RyYXRlZ3kpKQogICAgICAgICAgICBmbWQuc2V0VmFsdWVT\nZXF1ZW5jZU5hbWUoU2VxdWVuY2VNZXRhRGF0YS5OQU1FX1NZU1RFTSk7CiAg\nICAgICAgZWxzZSBpZiAoIlRBQkxFIi5lcXVhbHMoc3RyYXRlZ3kpIHx8ICJT\nRVFVRU5DRSIuZXF1YWxzKHN0cmF0ZWd5KSkgewogICAgICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAgICAgICAg\nICAgZm1kLnNldFZhbHVlU2VxdWVuY2VOYW1lKFNlcXVlbmNlTWV0YURhdGEu\nTkFNRV9TWVNURU0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBmbWQuc2V0VmFsdWVTZXF1ZW5jZU5hbWUoZ2VuZXJhdG9yKTsKICAgICAg\nICB9IGVsc2UgaWYgKCJJREVOVElUWSIuZXF1YWxzKHN0cmF0ZWd5KSkKICAg\nICAgICAgICAgZm1kLnNldFZhbHVlU3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVz\nLkFVVE9BU1NJR04pOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKHN0cmF0ZWd5KTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmRHZW5l\ncmF0ZWRWYWx1ZSgpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBMYXppbHkgcGFyc2UgY2FzY2FkZXMuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHN0YXJ0Q2FzY2FkZShPYmpl\nY3QgdGFnLCBBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgICAgIGlmICghaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBTZXQ8Q2FzY2FkZVR5\ncGU+IGNhc2NhZGVzID0gbnVsbDsKICAgICAgICBpZiAoY3VycmVudEVsZW1l\nbnQoKSBpbnN0YW5jZW9mIEZpZWxkTWV0YURhdGEpIHsKICAgICAgICAgICAg\naWYgKF9jYXNjYWRlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2Nhc2Nh\nZGVzID0gRW51bVNldC5ub25lT2YoQ2FzY2FkZVR5cGUuY2xhc3MpOwogICAg\nICAgICAgICBjYXNjYWRlcyA9IF9jYXNjYWRlczsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBpZiAoX3BrZ0Nhc2NhZGVzID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfcGtnQ2FzY2FkZXMgPSBFbnVtU2V0Lm5vbmVPZihDYXNj\nYWRlVHlwZS5jbGFzcyk7CiAgICAgICAgICAgIGNhc2NhZGVzID0gX3BrZ0Nh\nc2NhZGVzOwogICAgICAgIH0KICAgICAgICBib29sZWFuIGFsbCA9IEVMRU1f\nQ0FTQ0FERV9BTEwgPT0gdGFnOwogICAgICAgIGlmIChhbGwgfHwgRUxFTV9D\nQVNDQURFX1BFUiA9PSB0YWcpCiAgICAgICAgICAgIGNhc2NhZGVzLmFkZChQ\nRVJTSVNUKTsKICAgICAgICBpZiAoYWxsIHx8IEVMRU1fQ0FTQ0FERV9SRU0g\nPT0gdGFnKQogICAgICAgICAgICBjYXNjYWRlcy5hZGQoUkVNT1ZFKTsKICAg\nICAgICBpZiAoYWxsIHx8IEVMRU1fQ0FTQ0FERV9NRVIgPT0gdGFnKQogICAg\nICAgICAgICBjYXNjYWRlcy5hZGQoTUVSR0UpOwogICAgICAgIGlmIChhbGwg\nfHwgRUxFTV9DQVNDQURFX1JFRiA9PSB0YWcpCiAgICAgICAgICAgIGNhc2Nh\nZGVzLmFkZChSRUZSRVNIKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGVkIGNhc2NhZGVzIGludG8g\ndGhlIGZpZWxkLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRDYXNj\nYWRlcyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIFNldDxDYXNjYWRl\nVHlwZT4gY2FzY2FkZXMgPSBfY2FzY2FkZXM7CiAgICAgICAgaWYgKF9jYXNj\nYWRlcyA9PSBudWxsKQogICAgICAgICAgICBjYXNjYWRlcyA9IF9wa2dDYXNj\nYWRlczsKICAgICAgICBpZiAoY2FzY2FkZXMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCA9IGZtZDsK\nICAgICAgICBzd2l0Y2ggKF9zdHJhdGVneSkgewogICAgICAgICAgICBjYXNl\nIE9ORV9NQU5ZOgogICAgICAgICAgICBjYXNlIE1BTllfTUFOWToKICAgICAg\nICAgICAgICAgIHZtZCA9IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgfQog\nICAgICAgIGZvciAoQ2FzY2FkZVR5cGUgY2FzY2FkZSA6IGNhc2NhZGVzKSB7\nCiAgICAgICAgICAgIHN3aXRjaCAoY2FzY2FkZSkgewogICAgICAgICAgICAg\nICAgY2FzZSBQRVJTSVNUOgogICAgICAgICAgICAgICAgICAgIHZtZC5zZXRD\nYXNjYWRlUGVyc2lzdChWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRF\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgTUVSR0U6CiAgICAgICAgICAgICAgICAgICAgdm1kLnNldENhc2Nh\nZGVBdHRhY2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFJFTU9WRToKICAgICAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZURl\nbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUkVG\nUkVTSDoKICAgICAgICAgICAgICAgICAgICB2bWQuc2V0Q2FzY2FkZVJlZnJl\nc2goVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgX2Nhc2NhZGVzID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGNvbW1vbiBmaWVsZCBhdHRyaWJ1dGVzLgogICAgICovCiAgICBw\ncml2YXRlIEZpZWxkTWV0YURhdGEgcGFyc2VGaWVsZChBdHRyaWJ1dGVzIGF0\ndHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IChDbGFzc01ldGFEYXRhKSBjdXJyZW50RWxl\nbWVudCgpOwogICAgICAgIFN0cmluZyBuYW1lID0gYXR0cnMuZ2V0VmFsdWUo\nIm5hbWUiKTsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gbWV0YS5n\nZXREZWNsYXJlZEZpZWxkKG5hbWUpOwogICAgICAgIGlmICgoZmllbGQgPT0g\nbnVsbCB8fCBmaWVsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBPYmplY3QuY2xh\nc3MpCiAgICAgICAgICAgICYmIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpICE9\nIE9iamVjdC5jbGFzcykgewogICAgICAgICAgICBNZW1iZXIgbWVtYmVyID0g\nbnVsbDsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IG51bGw7CiAgICAgICAg\nICAgIGludCBkZWYgPSBfcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0\nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgIGdldERlZmF1bHRBY2Nlc3NU\neXBlKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAo\nbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1Nf\nUFJPUEVSVFkKICAgICAgICAgICAgICAgICAgICB8fCAobWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfVU5LTk9XTgogICAg\nICAgICAgICAgICAgICAgICYmIGRlZiA9PSBDbGFzc01ldGFEYXRhLkFDQ0VT\nU19QUk9QRVJUWSkpIHsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgY2Fw\nID0gU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShuYW1lKTsKICAgICAgICAgICAg\nICAgICAgICB0eXBlID0gbWV0YS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbWVtYmVyID0gdHlwZS5nZXREZWNsYXJlZE1ldGhvZCgiZ2V0IiArIGNhcCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIChDbGFzc1tdKSBudWxsKTsg\nLy8gdmFyYXJncyBkaXNhbWJpZ3VhdGUKICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZXhjZXApIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbWJl\nciA9IHR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoImlzIiArIGNhcCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAoQ2xhc3NbXSkgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleGNl\ncDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGV4Y2Vw\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSAoKE1ldGhvZCkgbWVt\nYmVyKS5nZXRSZXR1cm5UeXBlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIG1lbWJlciA9IG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLmdldERlY2xhcmVkRmllbGQobmFtZSk7CiAgICAgICAgICAg\nICAgICAgICAgdHlwZSA9ICgoRmllbGQpIG1lbWJlcikuZ2V0VHlwZSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgZ2V0RXhjZXB0aW9uKF9s\nb2MuZ2V0KCJpbnZhbGlkLWF0dHIiLCBuYW1lLCBtZXRhKSwgZSk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBmaWVsZCA9IG1ldGEuYWRkRGVjbGFyZWRGaWVsZChu\nYW1lLCB0eXBlKTsKICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlTWV0YURh\ndGFEZWZhdWx0cy5zZXRDYXNjYWRlTm9uZShmaWVsZCk7CiAgICAgICAgICAg\nICAgICBQZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuc2V0Q2FzY2FkZU5v\nbmUoZmllbGQuZ2V0S2V5KCkpOwogICAgICAgICAgICAgICAgUGVyc2lzdGVu\nY2VNZXRhRGF0YURlZmF1bHRzLnNldENhc2NhZGVOb25lKGZpZWxkLmdldEVs\nZW1lbnQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmllbGQuYmFj\na2luZ01lbWJlcihtZW1iZXIpOwogICAgICAgIH0gZWxzZSBpZiAoZmllbGQg\nPT0gbnVsbCkgewogICAgICAgICAgICBmaWVsZCA9IG1ldGEuYWRkRGVjbGFy\nZWRGaWVsZChuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBQZXJz\naXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuc2V0Q2FzY2FkZU5vbmUoZmllbGQp\nOwogICAgICAgICAgICBQZXJzaXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuc2V0\nQ2FzY2FkZU5vbmUoZmllbGQuZ2V0S2V5KCkpOwogICAgICAgICAgICBQZXJz\naXN0ZW5jZU1ldGFEYXRhRGVmYXVsdHMuc2V0Q2FzY2FkZU5vbmUoZmllbGQu\nZ2V0RWxlbWVudCgpKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICBmaWVsZC5zZXRMaXN0aW5nSW5kZXgo\nX2ZpZWxkUG9zKTsKCiAgICAgICAgX2ZpZWxkUG9zKys7CiAgICAgICAgcHVz\naEVsZW1lbnQoZmllbGQpOwogICAgICAgIGFkZENvbW1lbnRzKGZpZWxkKTsK\nCiAgICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAg\nICAgICBzdGFydEZpZWxkTWFwcGluZyhmaWVsZCwgYXR0cnMpOwogICAgICAg\nIHJldHVybiBmaWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFBvcHMgZmll\nbGQgZWxlbWVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZpbmlzaEZp\nZWxkKCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZpZWxkID0gKEZpZWxkTWV0YURhdGEpIHBvcEVsZW1l\nbnQoKTsKICAgICAgICBzZXRDYXNjYWRlcyhmaWVsZCk7CiAgICAgICAgaWYg\nKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICBlbmRGaWVs\nZE1hcHBpbmcoZmllbGQpOwogICAgICAgIF9zdHJhdGVneSA9IG51bGw7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdG8gYWRkIGZpZWxkIG1h\ncHBpbmcgZGF0YS4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHN0YXJ0RmllbGRNYXBwaW5nKEZpZWxkTWV0\nYURhdGEgZmllbGQsIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBsZW1l\nbnQgdG8gZmluYWxpemUgZmllbGQgbWFwcGluZy4gRG9lcyBub3RoaW5nIGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGVuZEZpZWxk\nTWFwcGluZyhGaWVsZE1ldGFEYXRhIGZpZWxkKQogICAgICAgIHRocm93cyBT\nQVhFeGNlcHRpb24gewogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgdmVy\nc2lvbi4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3RhcnRWZXJz\naW9uKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBwYXJzZUZpZWxk\nKGF0dHJzKTsKICAgICAgICBmbWQuc2V0RXhwbGljaXQodHJ1ZSk7CiAgICAg\nICAgZm1kLnNldFZlcnNpb24odHJ1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgZW5kVmVyc2lvbigpCiAgICAg\nICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgZmluaXNoRmllbGQo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHN0cmF0ZWd5IGVsZW1l\nbnQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydFN0cmF0ZWd5\nKFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXRlZ3ksCiAgICAgICAgQXR0cmli\ndXRlcyBhdHRycykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IHBhcnNlRmllbGQoYXR0cnMpOwog\nICAgICAgIGZtZC5zZXRFeHBsaWNpdCh0cnVlKTsKICAgICAgICBmbWQuc2V0\nTWFuYWdlbWVudChGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKTsK\nCiAgICAgICAgU3RyaW5nIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJmZXRjaCIp\nOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgZm1kLnNl\ndEluRGVmYXVsdEZldGNoR3JvdXAoIkVBR0VSIi5lcXVhbHModmFsKSk7CiAg\nICAgICAgdmFsID0gYXR0cnMuZ2V0VmFsdWUoIm9wdGlvbmFsIik7CiAgICAg\nICAgaWYgKCJmYWxzZSIuZXF1YWxzKHZhbCkpCiAgICAgICAgICAgIGZtZC5z\nZXROdWxsVmFsdWUoRmllbGRNZXRhRGF0YS5OVUxMX0VYQ0VQVElPTik7CiAg\nICAgICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKSB7CiAgICAgICAg\nICAgIHZhbCA9IGF0dHJzLmdldFZhbHVlKCJtYXBwZWQtYnkiKTsKICAgICAg\nICAgICAgaWYgKHZhbCAhPSBudWxsKQogICAgICAgICAgICAgICAgZm1kLnNl\ndE1hcHBlZEJ5KHZhbCk7CiAgICAgICAgfQogICAgICAgIHBhcnNlU3RyYXRl\nZ3koZm1kLCBzdHJhdGVneSwgYXR0cnMpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBlbmRTdHJhdGVneShQZXJzaXN0\nZW5jZVN0cmF0ZWd5IHN0cmF0ZWd5KQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIGZpbmlzaEZpZWxkKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBzdHJhdGVneSBzcGVjaWZpYyBhdHRyaWJ1dGVzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VTdHJhdGVneShGaWVsZE1l\ndGFEYXRhIGZtZCwKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0\nZWd5LCBBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgICAg\nICAgY2FzZSBCQVNJQzoKICAgICAgICAgICAgICAgIHBhcnNlQmFzaWMoZm1k\nLCBhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBFTUJFRERFRDoKICAgICAgICAgICAgICAgIHBhcnNlRW1iZWRkZWQo\nZm1kLCBhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBPTkVfT05FOgogICAgICAgICAgICAgICAgcGFyc2VPbmVUb09u\nZShmbWQsIGF0dHJzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAgcGFyc2VNYW55\nVG9PbmUoZm1kLCBhdHRycyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBNQU5ZX01BTlk6CiAgICAgICAgICAgICAgICBwYXJz\nZU1hbnlUb01hbnkoZm1kLCBhdHRycyk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBPTkVfTUFOWToKICAgICAgICAgICAgICAg\nIHBhcnNlT25lVG9NYW55KGZtZCwgYXR0cnMpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVFJBTlNJRU5UOgogICAgICAgICAg\nICAgICAgZm1kLnNldE1hbmFnZW1lbnQoRmllbGRNZXRhRGF0YS5NQU5BR0Vf\nTk9ORSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBiYXNpYy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgcGFyc2VCYXNpYyhGaWVsZE1ldGFEYXRhIGZtZCwgQXR0\ncmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGVtYmVkZGVkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZUVtYmVkZGVkKEZpZWxkTWV0YURh\ndGEgZm1kLCBBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgICAgIGFzc2VydFBDKGZtZCwgIkVtYmVkZGVkIik7\nCiAgICAgICAgZm1kLnNldEVtYmVkZGVkKHRydWUpOwogICAgICAgIGZtZC5z\nZXRTZXJpYWxpemVkKGZhbHNlKTsgLy8gb3ZlcnJpZGUgYW55IExvYiBhbm5v\ndGF0aW9uCiAgICAgICAgaWYgKGZtZC5nZXRFbWJlZGRlZE1ldGFEYXRhKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgZm1kLmFkZEVtYmVkZGVkTWV0YURhdGEo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IHByb3BlciBleGNlcHRp\nb24gaWYgZ2l2ZW4gdmFsdWUgaXMgbm90IHBvc3NpYmx5IHBlcnNpc3RlbmNl\nCiAgICAgKiBjYXBhYmxlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNz\nZXJ0UEMoRmllbGRNZXRhRGF0YSBmbWQsIFN0cmluZyBhdHRyKQogICAgICAg\nIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmICghSmF2YVR5cGVz\nLm1heWJlUEMoZm1kKSkKICAgICAgICAgICAgdGhyb3cgZ2V0RXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLCBhdHRyKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBvbmUtdG8tb25lLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU9uZVRvT25lKEZpZWxkTWV0YURhdGEg\nZm1kLCBBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNl\ncHRpb24gewogICAgICAgIFN0cmluZyB2YWwgPSBhdHRycy5nZXRWYWx1ZSgi\ndGFyZ2V0LWVudGl0eSIpOwogICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAg\nICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShjbGFzc0Zvck5hbWUodmFs\nKSk7CiAgICAgICAgYXNzZXJ0UEMoZm1kLCAiT25lVG9PbmUiKTsKICAgICAg\nICBmbWQuc2V0U2VyaWFsaXplZChmYWxzZSk7IC8vIG92ZXJyaWRlIGFueSBM\nb2IgYW5ub3RhdGlvbgogICAgICAgIGlmICghZm1kLmlzRGVmYXVsdEZldGNo\nR3JvdXBFeHBsaWNpdCgpKQogICAgICAgICAgICBmbWQuc2V0SW5EZWZhdWx0\nRmV0Y2hHcm91cCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIG1hbnktdG8tb25lLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJz\nZU1hbnlUb09uZShGaWVsZE1ldGFEYXRhIGZtZCwgQXR0cmlidXRlcyBhdHRy\ncykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBTdHJp\nbmcgdmFsID0gYXR0cnMuZ2V0VmFsdWUoInRhcmdldC1lbnRpdHkiKTsKICAg\nICAgICBpZiAodmFsICE9IG51bGwpCiAgICAgICAgICAgIGZtZC5zZXRUeXBl\nT3ZlcnJpZGUoY2xhc3NGb3JOYW1lKHZhbCkpOwogICAgICAgIGFzc2VydFBD\nKGZtZCwgIk1hbnlUb09uZSIpOwogICAgICAgIGZtZC5zZXRTZXJpYWxpemVk\nKGZhbHNlKTsgLy8gb3ZlcnJpZGUgYW55IExvYiBhbm5vdGF0aW9uCiAgICAg\nICAgaWYgKCFmbWQuaXNEZWZhdWx0RmV0Y2hHcm91cEV4cGxpY2l0KCkpCiAg\nICAgICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgbWFueS10by1tYW55LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU1hbnlUb01hbnkoRmllbGRN\nZXRhRGF0YSBmbWQsIEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dz\nIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIHZhbCA9IGF0dHJzLmdl\ndFZhbHVlKCJ0YXJnZXQtZW50aXR5Iik7CiAgICAgICAgaWYgKHZhbCAhPSBu\ndWxsKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldERlY2xhcmVk\nVHlwZShjbGFzc0Zvck5hbWUodmFsKSk7CiAgICAgICAgYXNzZXJ0UENDb2xs\nZWN0aW9uKGZtZCwgIk1hbnlUb01hbnkiKTsKICAgICAgICBmbWQuc2V0U2Vy\naWFsaXplZChmYWxzZSk7IC8vIG92ZXJyaWRlIExvYiBpbiBhbm5vdGF0aW9u\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaHJvdyBleGNlcHRpb24gaWYgZ2l2\nZW4gZmllbGQgbm90IGEgY29sbGVjdGlvbiBvZiBwb3NzaWJsZSBwZXJzaXN0\nZW5jZQogICAgICogY2FwYWJsZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhc3NlcnRQQ0NvbGxlY3Rpb24oRmllbGRNZXRhRGF0YSBmbWQsIFN0cmlu\nZyBhdHRyKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAg\nIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgaWYgKEphdmFUeXBlcy5tYXliZVBD\nKGZtZC5nZXRFbGVtZW50KCkpKQogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IGdldEV4Y2VwdGlvbihfbG9j\nLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwgYXR0cikpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIG9uZS10by1tYW55LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZU9uZVRvTWFueShGaWVsZE1l\ndGFEYXRhIGZtZCwgQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgdmFsID0gYXR0cnMuZ2V0\nVmFsdWUoInRhcmdldC1lbnRpdHkiKTsKICAgICAgICBpZiAodmFsICE9IG51\nbGwpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVjbGFyZWRU\neXBlKGNsYXNzRm9yTmFtZSh2YWwpKTsKICAgICAgICBhc3NlcnRQQ0NvbGxl\nY3Rpb24oZm1kLCAiT25lVG9NYW55Iik7CiAgICAgICAgZm1kLnNldFNlcmlh\nbGl6ZWQoZmFsc2UpOyAvLyBvdmVycmlkZSBhbnkgTG9iIGFubm90YXRpb24K\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIG1hcC1rZXkuCiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBzdGFydE1hcEtleShBdHRyaWJ1dGVzIGF0\ndHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlm\nICghaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSAoRmllbGRN\nZXRhRGF0YSkgY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBTdHJpbmcgbWFw\nS2V5ID0gYXR0cnMuZ2V0VmFsdWUoIm5hbWUiKTsKICAgICAgICBpZiAobWFw\nS2V5ID09IG51bGwpCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRWYWx1\nZU1hcHBlZEJ5KFZhbHVlTWV0YURhdGEuTUFQUEVEX0JZX1BLKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRWYWx1ZU1hcHBl\nZEJ5KG1hcEtleSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBvcmRlci1ieS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGVuZE9yZGVyQnkoKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRp\nb24gewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gKEZpZWxkTWV0YURh\ndGEpIGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgU3RyaW5nIGRlYyA9IGN1\ncnJlbnRUZXh0KCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nZGVjKSkKICAgICAgICAgICAgZGVjID0gT3JkZXIuRUxFTUVOVCArICIgYXNj\nIjsKICAgICAgICBmbWQuc2V0T3JkZXJEZWNsYXJhdGlvbihkZWMpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGFyc2UgbmFtZWQtcXVlcnkuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBib29sZWFuIHN0YXJ0TmFtZWRRdWVyeShBdHRyaWJ1\ndGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nICAgIGlmICghaXNRdWVyeU1vZGUoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBTdHJpbmcgbmFtZSA9IGF0dHJzLmdldFZhbHVlKCJu\nYW1lIik7CiAgICAgICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlm\nIChsb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cuaW5mbyhf\nbG9jLmdldCgicGFyc2UtcXVlcnkiLCBuYW1lKSk7CgogICAgICAgIFF1ZXJ5\nTWV0YURhdGEgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5nZXRDYWNoZWRRdWVy\neU1ldGFEYXRhKG51bGwsIG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51\nbGwgJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLndh\ncm4oX2xvYy5nZXQoIm92ZXJyaWRlLXF1ZXJ5IiwgbmFtZSwgY3VycmVudExv\nY2F0aW9uKCkpKTsKCiAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnkoKS5h\nZGRRdWVyeU1ldGFEYXRhKG51bGwsIG5hbWUpOwogICAgICAgIG1ldGEuc2V0\nRGVmaW5pbmdUeXBlKF9jbHMpOwogICAgICAgIG1ldGEuc2V0UXVlcnlTdHJp\nbmcoYXR0cnMuZ2V0VmFsdWUoInF1ZXJ5IikpOwogICAgICAgIG1ldGEuc2V0\nTGFuZ3VhZ2UoSlBRTFBhcnNlci5MQU5HX0pQUUwpOwoKICAgICAgICBPYmpl\nY3QgY3VyID0gY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBPYmplY3Qgc2Nv\ncGUgPSAoY3VyIGluc3RhbmNlb2YgQ2xhc3NNZXRhRGF0YSkKICAgICAgICAg\nICAgPyAoKENsYXNzTWV0YURhdGEpIGN1cikuZ2V0RGVzY3JpYmVkVHlwZSgp\nIDogbnVsbDsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxl\nKCksIHNjb3BlLCBtZXRhLlNSQ19YTUwpOwogICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9E\nRV9NRVRBKTsKICAgICAgICBlbHNlIGlmIChpc01hcHBpbmdNb2RlKCkpCiAg\nICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX01BUFBJTkcpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1P\nREVfUVVFUlkpOwogICAgICAgIHB1c2hFbGVtZW50KG1ldGEpOwogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGVuZE5h\nbWVkUXVlcnkoKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nICAgIHBvcEVsZW1lbnQoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBzdGFydFF1ZXJ5U3RyaW5nKEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAg\ndGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgZW5kUXVlcnlTdHJpbmcoKQogICAg\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIFF1ZXJ5TWV0YURh\ndGEgbWV0YSA9IChRdWVyeU1ldGFEYXRhKSBjdXJyZW50RWxlbWVudCgpOwog\nICAgICAgIG1ldGEuc2V0UXVlcnlTdHJpbmcoY3VycmVudFRleHQoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBxdWVyeS1oaW50LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBzdGFydFF1ZXJ5SGludChBdHRyaWJ1\ndGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAg\nICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IChRdWVyeU1ldGFEYXRhKSBjdXJy\nZW50RWxlbWVudCgpOwogICAgICAgIG1ldGEuYWRkSGludChhdHRycy5nZXRW\nYWx1ZSgibmFtZSIpLCBhdHRycy5nZXRWYWx1ZSgidmFsdWUiKSk7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgZW5k\nUXVlcnlIaW50KCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBhcnNlIG5hdGl2ZS1uYW1lZC1xdWVyeS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc3RhcnROYW1lZE5hdGl2\nZVF1ZXJ5KEF0dHJpYnV0ZXMgYXR0cnMpCiAgICAgICAgdGhyb3dzIFNBWEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKCFpc1F1ZXJ5TW9kZSgpKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIFN0cmluZyBuYW1lID0gYXR0\ncnMuZ2V0VmFsdWUoIm5hbWUiKTsKICAgICAgICBMb2cgbG9nID0gZ2V0TG9n\nKCk7CiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAg\nICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJwYXJzZS1uYXRpdmUtcXVlcnkiLCBu\nYW1lKSk7CgogICAgICAgIFF1ZXJ5TWV0YURhdGEgbWV0YSA9IGdldFJlcG9z\naXRvcnkoKS5nZXRDYWNoZWRRdWVyeU1ldGFEYXRhKG51bGwsIG5hbWUpOwog\nICAgICAgIGlmIChtZXRhICE9IG51bGwgJiYgbG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoIm92ZXJyaWRlLXF1\nZXJ5IiwgbmFtZSwgY3VycmVudExvY2F0aW9uKCkpKTsKCiAgICAgICAgbWV0\nYSA9IGdldFJlcG9zaXRvcnkoKS5hZGRRdWVyeU1ldGFEYXRhKG51bGwsIG5h\nbWUpOwogICAgICAgIG1ldGEuc2V0RGVmaW5pbmdUeXBlKF9jbHMpOwogICAg\nICAgIG1ldGEuc2V0UXVlcnlTdHJpbmcoYXR0cnMuZ2V0VmFsdWUoInF1ZXJ5\nIikpOwogICAgICAgIG1ldGEuc2V0TGFuZ3VhZ2UoUXVlcnlMYW5ndWFnZXMu\nTEFOR19TUUwpOwogICAgICAgIFN0cmluZyB2YWwgPSBhdHRycy5nZXRWYWx1\nZSgicmVzdWx0LWNsYXNzIik7CiAgICAgICAgaWYgKHZhbCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIENsYXNzIHR5cGUgPSBjbGFzc0Zvck5hbWUodmFsKTsK\nICAgICAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZSh0eXBl\nKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0Q2FuZGlkYXRlVHlwZSh0eXBl\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0YS5zZXRS\nZXN1bHRUeXBlKHR5cGUpOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGN1\nciA9IGN1cnJlbnRFbGVtZW50KCk7CiAgICAgICAgT2JqZWN0IHNjb3BlID0g\nKGN1ciBpbnN0YW5jZW9mIENsYXNzTWV0YURhdGEpCiAgICAgICAgICAgID8g\nKChDbGFzc01ldGFEYXRhKSBjdXIpLmdldERlc2NyaWJlZFR5cGUoKSA6IG51\nbGw7CiAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNlRmlsZSgpLCBz\nY29wZSwgbWV0YS5TUkNfWE1MKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUVU\nQSk7CiAgICAgICAgZWxzZSBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAg\nICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9NQVBQSU5HKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX1FV\nRVJZKTsKICAgICAgICBwdXNoRWxlbWVudChtZXRhKTsKICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmROYW1lZE5h\ndGl2ZVF1ZXJ5KCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nICAgICBwb3BFbGVtZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdGFy\ndCBlbnRpdHktbGlzdGVuZXJzCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBzdGFydEVudGl0eUxpc3RlbmVycyhBdHRyaWJ1dGVzIGF0dHJzKQogICAg\nICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmICghaXNNZXRh\nRGF0YU1vZGUoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmIChjdXJyZW50RWxlbWVudCgpID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwoKICAgICAgICAvLyByZXNldCBsaXN0ZW5lcnMgZGVjbGFy\nZWQgaW4gYW5ub3RhdGlvbnMuCiAgICAgICAgTGlmZWN5Y2xlTWV0YURhdGEg\nbWV0YSA9ICgoQ2xhc3NNZXRhRGF0YSkgY3VycmVudEVsZW1lbnQoKSkuCiAg\nICAgICAgICAgIGdldExpZmVjeWNsZU1ldGFEYXRhKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRTLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBtZXRhLnNldERlY2xhcmVkQ2FsbGJh\nY2tzKGksIG51bGwsIDApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgZXhjbHVkZS1kZWZhdWx0LWxpc3RlbmVy\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHN0YXJ0RXhjbHVkZURl\nZmF1bHRMaXN0ZW5lcnMoQXR0cmlidXRlcyBhdHRycykKICAgICAgICB0aHJv\nd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWlzTWV0YURhdGFNb2Rl\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgY3VycmVudEVsZW1lbnQo\nKTsKICAgICAgICBtZXRhLmdldExpZmVjeWNsZU1ldGFEYXRhKCkuc2V0SWdu\nb3JlU3lzdGVtTGlzdGVuZXJzKHRydWUpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZXhjbHVkZS1zdXBlcmNs\nYXNzLWxpc3RlbmVycy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHN0\nYXJ0RXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5lcnMoQXR0cmlidXRlcyBhdHRy\ncykKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nIWlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkg\nY3VycmVudEVsZW1lbnQoKTsKICAgICAgICBtZXRhLmdldExpZmVjeWNsZU1l\ndGFEYXRhKCkuc2V0SWdub3JlU3VwZXJjbGFzc0NhbGxiYWNrcwogICAgICAg\nICAgICAoTGlmZWN5Y2xlTWV0YURhdGEuSUdOT1JFX0hJR0gpOwogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZW50\naXR5LWxpc3RlbmVyLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc3Rh\ncnRFbnRpdHlMaXN0ZW5lcihBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRo\ncm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIF9saXN0ZW5lciA9IGNsYXNz\nRm9yTmFtZShhdHRycy5nZXRWYWx1ZSgiY2xhc3MiKSk7CiAgICAgICAgYm9v\nbGVhbiBzeXN0ZW0gPSBjdXJyZW50RWxlbWVudCgpID09IG51bGw7CiAgICAg\nICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VkID0g\nCiAgICAgICAgICAgIEFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhUGFy\nc2VyLnBhcnNlQ2FsbGJhY2tNZXRob2RzKF9saXN0ZW5lciwKICAgICAgICAg\nICAgICAgIG51bGwsIHRydWUsIHRydWUsIF9yZXBvcyk7CiAgICAgICAgaWYg\nKHBhcnNlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAg\nICAgICAgaWYgKF9jYWxsYmFja3MgPT0gbnVsbCkgewogICAgICAgICAgICBf\nY2FsbGJhY2tzID0gKENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltd\nKQogICAgICAgICAgICAgICAgbmV3IENvbGxlY3Rpb25bTGlmZWN5Y2xlRXZl\nbnQuQUxMX0VWRU5UUy5sZW5ndGhdOwogICAgICAgICAgICBpZiAoIXN5c3Rl\nbSkKICAgICAgICAgICAgICAgIF9oaWdocyA9IG5ldyBpbnRbTGlmZWN5Y2xl\nRXZlbnQuQUxMX0VWRU5UUy5sZW5ndGhdOwogICAgICAgIH0KICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHBhcnNlZC5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAocGFyc2VkW2ldID09IG51bGwpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKF9jYWxsYmFja3NbaV0gPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9jYWxsYmFja3NbaV0gPSBwYXJzZWRb\naV07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYWxsYmFj\na3NbaV0uYWRkQWxsKHBhcnNlZFtpXSk7CiAgICAgICAgICAgIGlmICghc3lz\ndGVtKQogICAgICAgICAgICAgICAgX2hpZ2hzW2ldICs9IHBhcnNlZFtpXS5z\naXplKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCBlbmRFbnRpdHlMaXN0ZW5lcigpCiAgICAgICAg\ndGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2hvdWxkIGJlIGlu\nIGVuZEVudGl0eUxpc3RlbmVycyBJIHRoaW5rIHRvIG1lcmdlIGNhbGxiYWNr\ncwogICAgICAgIC8vIGludG8gYSBzaW5nbGUgbGlzdGVuZXIuICBCdXQgdGhl\nbiB0aGUgdXNlciBjYW5ub3QgcmVtb3ZlLgogICAgICAgIGlmIChjdXJyZW50\nRWxlbWVudCgpID09IG51bGwgJiYgX2NhbGxiYWNrcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgIF9yZXBvcy5hZGRTeXN0ZW1MaXN0ZW5lcihuZXcgUGVyc2lz\ndGVuY2VMaXN0ZW5lckFkYXB0ZXIKICAgICAgICAgICAgICAgIChfY2FsbGJh\nY2tzKSk7CiAgICAgICAgICAgIF9jYWxsYmFja3MgPSBudWxsOwogICAgICAg\nIH0KICAgICAgICBfbGlzdGVuZXIgPSBudWxsOwogICAgfQoKICAgIHByaXZh\ndGUgYm9vbGVhbiBzdGFydENhbGxiYWNrKE1ldGFEYXRhVGFnIGNhbGxiYWNr\nLCBBdHRyaWJ1dGVzIGF0dHJzKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRp\nb24gewogICAgICAgIGlmICghaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGludFtdIGV2ZW50cyA9IE1ldGFE\nYXRhUGFyc2Vycy5nZXRFdmVudFR5cGVzKGNhbGxiYWNrKTsKICAgICAgICBp\nZiAoZXZlbnRzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgYm9vbGVhbiBzeXN0ZW0gPSBjdXJyZW50RWxlbWVudCgpID09\nIG51bGw7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGN1cnJlbnRFbGVtZW50KCkg\nPT0gbnVsbCA/IG51bGwgOgogICAgICAgICAgICAoKENsYXNzTWV0YURhdGEp\nIGN1cnJlbnRFbGVtZW50KCkpLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAg\nICBpZiAodHlwZSA9PSBudWxsKQogICAgICAgICAgICB0eXBlID0gT2JqZWN0\nLmNsYXNzOwoKICAgICAgICBpZiAoX2NhbGxiYWNrcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIF9jYWxsYmFja3MgPSAoQ29sbGVjdGlvbjxMaWZlY3ljbGVD\nYWxsYmFja3M+W10pCiAgICAgICAgICAgICAgICBuZXcgQ29sbGVjdGlvbltM\naWZlY3ljbGVFdmVudC5BTExfRVZFTlRTLmxlbmd0aF07CiAgICAgICAgICAg\nIGlmICghc3lzdGVtKQogICAgICAgICAgICAgICAgX2hpZ2hzID0gbmV3IGlu\ndFtMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRTLmxlbmd0aF07CiAgICAgICAg\nfQoKICAgICAgICBNZXRhRGF0YURlZmF1bHRzIGRlZiA9IF9yZXBvcy5nZXRN\nZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpOwogICAgICAgIExpZmVj\neWNsZUNhbGxiYWNrcyBhZGFwdGVyOwogICAgICAgIGlmIChfbGlzdGVuZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgYWRhcHRlciA9IG5ldyBCZWFuTGlmZWN5\nY2xlQ2FsbGJhY2tzKF9saXN0ZW5lciwKICAgICAgICAgICAgICAgIGF0dHJz\nLmdldFZhbHVlKCJtZXRob2QtbmFtZSIpLCBmYWxzZSwgdHlwZSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBhZGFwdGVyID0gbmV3IE1ldGhvZExpZmVj\neWNsZUNhbGxiYWNrcyhfY2xzLAogICAgICAgICAgICAgICAgYXR0cnMuZ2V0\nVmFsdWUoIm1ldGhvZC1uYW1lIiksIGZhbHNlKTsKCiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgaW50IGV2ZW50ID0gZXZlbnRzW2ldOwogICAgICAgICAgICBpZiAoX2xp\nc3RlbmVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIE1ldGFEYXRhUGFy\nc2Vycy52YWxpZGF0ZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2soX2xpc3RlbmVy\nLCAKICAgICAgICAgICAgICAgICAgICBfY2FsbGJhY2tzW2V2ZW50XSwgKChC\nZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzKSBhZGFwdGVyKS4KICAgICAgICAgICAg\nICAgICAgICBnZXRDYWxsYmFja01ldGhvZCgpLCBjYWxsYmFjaywgZGVmLCBn\nZXRMb2coKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9jYWxs\nYmFja3NbZXZlbnRdID09IG51bGwpCiAgICAgICAgICAgICAgICBfY2FsbGJh\nY2tzW2V2ZW50XSA9IG5ldyBBcnJheUxpc3Q8TGlmZWN5Y2xlQ2FsbGJhY2tz\nPigzKTsKICAgICAgICAgICAgX2NhbGxiYWNrc1tldmVudF0uYWRkKGFkYXB0\nZXIpOwogICAgICAgICAgICBpZiAoIXN5c3RlbSAmJiBfbGlzdGVuZXIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIF9oaWdoc1tldmVudF0rKzsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTdG9yZSBsaWZlY3ljbGUgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBzdG9yZUNhbGxiYWNrcyhDbGFzc01ldGFEYXRhIGNscykgewog\nICAgICAgIExpZmVjeWNsZU1ldGFEYXRhIG1ldGEgPSBjbHMuZ2V0TGlmZWN5\nY2xlTWV0YURhdGEoKTsKICAgICAgICBDbGFzcyBzdXBDbHMgPSBjbHMuZ2V0\nRGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBDb2xs\nZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBzdXBDYWxscyA9IG51bGw7\nCiAgICAgICAgaWYgKCFPYmplY3QuY2xhc3MuZXF1YWxzKHN1cENscykpIHsK\nICAgICAgICAgICAgc3VwQ2FsbHMgPSBBbm5vdGF0aW9uUGVyc2lzdGVuY2VN\nZXRhRGF0YVBhcnNlci5wYXJzZUNhbGxiYWNrTWV0aG9kcwogICAgICAgICAg\nICAgICAgKHN1cENscywgbnVsbCwgdHJ1ZSwgZmFsc2UsIF9yZXBvcyk7CiAg\nICAgICAgfQogICAgICAgIGlmIChzdXBDYWxscyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGV2ZW50IDogTGlmZWN5Y2xlRXZlbnQuQUxMX0VW\nRU5UUykgewogICAgICAgICAgICAgICAgaWYgKHN1cENhbGxzW2V2ZW50XSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgbWV0YS5zZXROb25QQ1N1cGVyY2xhc3NDYWxsYmFja3MoZXZl\nbnQsIHN1cENhbGxzW2V2ZW50XS50b0FycmF5CiAgICAgICAgICAgICAgICAg\nICAgKG5ldyBMaWZlY3ljbGVDYWxsYmFja3Nbc3VwQ2FsbHNbZXZlbnRdLnNp\nemUoKV0pLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBp\nZiAoX2NhbGxiYWNrcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIGZvciAoaW50IGV2ZW50IDogTGlmZWN5Y2xlRXZlbnQuQUxMX0VW\nRU5UUykgewogICAgICAgICAgICBpZiAoX2NhbGxiYWNrc1tldmVudF0gPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBt\nZXRhLnNldERlY2xhcmVkQ2FsbGJhY2tzKGV2ZW50LCAoTGlmZWN5Y2xlQ2Fs\nbGJhY2tzW10pCiAgICAgICAgICAgICAgICBfY2FsbGJhY2tzW2V2ZW50XS50\nb0FycmF5CiAgICAgICAgICAgICAgICAgICAgKG5ldyBMaWZlY3ljbGVDYWxs\nYmFja3NbX2NhbGxiYWNrc1tldmVudF0uc2l6ZSgpXSksCiAgICAgICAgICAg\nICAgICBfaGlnaHNbZXZlbnRdKTsKICAgICAgICB9CiAgICAgICAgX2NhbGxi\nYWNrcyA9IG51bGw7CiAgICAgICAgX2hpZ2hzID0gbnVsbDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBnaXZlbiBjbGFzcywgdGFr\naW5nIGludG8gYWNjb3VudCB0aGUgZGVmYXVsdCBwYWNrYWdlLgoJICovCglw\ncm90ZWN0ZWQgQ2xhc3MgY2xhc3NGb3JOYW1lKFN0cmluZyBuYW1lKQoJCXRo\ncm93cyBTQVhFeGNlcHRpb24gewoJCWlmICgiRW50aXR5Ii5lcXVhbHMobmFt\nZSkpCgkJCXJldHVybiBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3M7CgkJcmV0\ndXJuIHN1cGVyLmNsYXNzRm9yTmFtZShuYW1lLCBpc1J1bnRpbWUoKSk7Cgl9\nCn0K\n","encoding":"base64"}

