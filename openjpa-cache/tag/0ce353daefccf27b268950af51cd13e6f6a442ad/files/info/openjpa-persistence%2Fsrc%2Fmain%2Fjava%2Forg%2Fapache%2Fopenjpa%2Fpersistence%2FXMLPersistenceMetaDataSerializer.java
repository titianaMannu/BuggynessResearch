{"sha":"dc31f048268841edaaaf26cbee8d15721336f4ff","node_id":"MDQ6QmxvYjIwNjM2NDpkYzMxZjA0ODI2ODg0MWVkYWFhZjI2Y2JlZThkMTU3MjEzMzZmNGZm","size":46945,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/dc31f048268841edaaaf26cbee8d15721336f4ff","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBqYXZhLmlvLkZpbGU7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Qcm9wZXJ0aWVzOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBv\ncnQgb3JnLnhtbC5zYXguU0FYRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb25z\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLkNGTWV0YURhdGFTZXJp\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlNv\ndXJjZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5N\nZXRhRGF0YUluaGVyaXRhbmNlQ29tcGFyYXRvcjsKaW1wb3J0IHN0YXRpYyBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVzLio7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5PcmRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlF1ZXJ5TWV0YURhdGE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5TZXF1ZW5jZU1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0\naW9uOwppbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogU2VyaWFs\naXplcyBwZXJzaXN0ZW5jZSBtZXRhZGF0YSBiYWNrIHRvIFhNTC4KICogVGhp\ncyBjbGFzcyBwcm9jZXNzZXMgYWxsIG9iamVjdCBsZXZlbCB0YWdzIHRoYXQg\nYXJlIHN0b3JlLWFnbm9zdGljLgogKiBIb3dldmVyLCBpdCBwcm92aWRlcyBo\nb29rcyBmb3IgdGhlIHN1YmNsYXNzZXMgdG8gaW5jbHVkZSBzdG9yZS1zcGVj\naWZpYwogKiB0YWdzIHRvIGJlIHNlcmlhbGl6ZWQgYm90aCBhdCAmbHQ7ZW50\naXR5LW1hcHBpbmdzJmd0OyBhbmQKICogJmx0O2VudGl0eSZndDsgbGV2ZWwu\nCiAqCiAqIEBzaW5jZSAwLjQuMAogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBA\nbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3MgWE1MUGVyc2lzdGVuY2VNZXRh\nRGF0YVNlcmlhbGl6ZXIKICAgIGV4dGVuZHMgQ0ZNZXRhRGF0YVNlcmlhbGl6\nZXIKICAgIGltcGxlbWVudHMgUGVyc2lzdGVuY2VNZXRhRGF0YUZhY3Rvcnku\nU2VyaWFsaXplciB7CgogICAgLy8gTk9URTogb3JkZXIgaXMgaW1wb3J0YW50\nISB0aGVzZSBjb25zdGFudHMgbXVzdCBiZSBtYWludGFpbmVkIGluCiAgICAv\nLyBzZXJpYWxpemF0aW9uIG9yZGVyLiBjb25zdGFudHMgYXJlIHNwYWNlZCBz\nbyB0aGF0IHN1YmNsYXNzZXMgY2FuCiAgICAvLyBzbGlwIHRhZ3MgaW4tYmV0\nd2VlbgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9TRVEg\nPSAxMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFRZUEVfUVVF\nUlkgPSAyMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFRZUEVf\nTUVUQSA9IDMwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQ\nRV9DTEFTU19TRVFTID0gNDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBUWVBFX0NMQVNTX1FVRVJJRVMgPSA1MDsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKFhNTFBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVy\nLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIE9wZW5KUEFDb25maWd1cmF0\naW9uIF9jb25mOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBDbGFzc01ldGFE\nYXRhPiBfbWV0YXMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBM\naXN0PiBfcXVlcmllcyA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxTdHJpbmcs\nIExpc3Q+IF9zZXFzID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9tb2RlID0g\nTU9ERV9OT05FOwogICAgcHJpdmF0ZSBib29sZWFuIF9hbm5vcyA9IHRydWU7\nCiAgICBwcml2YXRlIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yIF9jb21wID0g\nbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29u\nZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFhNTFBlcnNpc3RlbmNl\nTWV0YURhdGFTZXJpYWxpemVyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgc2V0TG9nKGNvbmYu\nZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRBREFUQSkpOwog\nICAgICAgIHNldE1vZGUoTU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5HIHwgTU9E\nRV9RVUVSWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9u\nLgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHNlcmlhbGl6ZSBjb250ZW50\nIG9yaWdpbmFsbHkgc3BlY2lmaWVkIGluIGFubm90YXRpb25zLgogICAgICog\nRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZ2V0U2VyaWFsaXplQW5ub3RhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9h\nbm5vczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gc2VyaWFs\naXplIGNvbnRlbnQgb3JpZ2luYWxseSBzcGVjaWZpZWQgaW4gYW5ub3RhdGlv\nbnMuCiAgICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRTZXJpYWxpemVBbm5vdGF0aW9ucyhib29sZWFuIGFubm9z\nKSB7CiAgICAgICAgX2Fubm9zID0gYW5ub3M7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgc2VyaWFsaXphdGlvbiBtb2RlIGFjY29yZGluZyB0byB0aGUg\nZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4gVGhlCiAgICAgKiBtb2RlIGNvbnN0\nYW50cyBhY3QgYXMgYml0IGZsYWdzLCBhbmQgdGhlcmVmb3JlIGNhbiBiZSBj\nb21iaW5lZC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNb2RlKCkgewog\nICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBzZXJpYWxpemF0aW9uIG1vZGUgYWNjb3JkaW5nIHRvIHRoZSBleHBlY3Rl\nZCBkb2N1bWVudCB0eXBlLiBUaGUKICAgICAqIG1vZGUgY29uc3RhbnRzIGFj\ndCBhcyBiaXQgZmxhZ3MsIGFuZCB0aGVyZWZvcmUgY2FuIGJlIGNvbWJpbmVk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBtb2RlKSB7\nCiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNlcmlhbGl6YXRpb24gbW9kZSBhY2NvcmRpbmcgdG8gdGhlIGV4cGVj\ndGVkIGRvY3VtZW50IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndE1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9k\nZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIHNldE1vZGUoTU9ERV9OT05F\nKTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgc2V0TW9kZShf\nbW9kZSB8IG1vZGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0TW9k\nZShfbW9kZSAmIH5tb2RlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE92ZXJy\naWRlIHRvIG5vdCBvdmVyd3JpdGUgYW5ub3RhdGlvbnMuCiAgICAgKi8KICAg\nIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIEZpbGUgZ2V0U291cmNlRmlsZShP\nYmplY3Qgb2JqKSB7CiAgICAgICAgRmlsZSBmaWxlID0gc3VwZXIuZ2V0U291\ncmNlRmlsZShvYmopOwogICAgICAgIGlmIChmaWxlID09IG51bGwgfHwgZmls\nZS5nZXROYW1lKCkuZW5kc1dpdGgoIi5qYXZhIikKICAgICAgICAgICAgfHwg\nZmlsZS5nZXROYW1lKCkuZW5kc1dpdGgoIi5jbGFzcyIpKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZmlsZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0\naW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIGlzTWV0YURhdGFNb2RlKCkgewogICAgICAgIHJldHVybiAoX21v\nZGUgJiBNT0RFX01FVEEpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb252ZW5pZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dl\ndE1vZGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1ZXJ5\nTW9kZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTU9ERV9RVUVSWSkg\nIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhv\nZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ01vZGUoKSB7CiAgICAg\nICAgcmV0dXJuIChfbW9kZSAmIE1PREVfTUFQUElORykgIT0gMDsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJw\ncmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uIFRha2VzIGludG8KICAgICAqIGFj\nY291bnQgd2hldGhlciBtYXBwaW5nIGluZm9ybWF0aW9uIGlzIGxvYWRlZCBm\nb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nYm9vbGVhbiBpc01hcHBpbmdNb2RlKENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIHJldHVybiBpc01hcHBpbmdNb2RlKCkgJiYgKG1ldGEuZ2V0U291\ncmNlTW9kZSgpICYgTU9ERV9NQVBQSU5HKSAhPSAwCiAgICAgICAgICAgICYm\nIChtZXRhLmdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbAogICAgICAg\nICAgICB8fCAhbWV0YS5pc0VtYmVkZGVkT25seSgpKQogICAgICAgICAgICAm\nJiAobWV0YS5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09IG51bGwKICAgICAg\nICAgICAgfHwgaXNNYXBwaW5nTW9kZShtZXRhLmdldEVtYmVkZGluZ01ldGFE\nYXRhKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1l\ndGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uIFRha2Vz\nIGludG8KICAgICAqIGFjY291bnQgd2hldGhlciBtYXBwaW5nIGluZm9ybWF0\naW9uIGlzIGxvYWRlZCBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdNb2RlKFZhbHVlTWV0\nYURhdGEgdm1kKSB7CiAgICAgICAgcmV0dXJuIGlzTWFwcGluZ01vZGUodm1k\nLmdldEZpZWxkTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgY2xhc3MgbWV0YSBkYXRhIHRv\nIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgYWRkTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpZiAoX21ldGFzID09IG51bGwpCiAgICAgICAgICAgIF9tZXRhcyA9\nIG5ldyBIYXNoTWFwPFN0cmluZywgQ2xhc3NNZXRhRGF0YT4oKTsKICAgICAg\nICBfbWV0YXMucHV0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSwgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBzZXF1ZW5j\nZSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhKFNlcXVl\nbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdCBzZXFzID0gbnVs\nbDsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAgaWYg\nKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQogICAg\nICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VTY29w\nZSgpKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKF9zZXFzID09IG51bGwpCiAg\nICAgICAgICAgIF9zZXFzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBMaXN0Pigp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VxcyA9IF9zZXFzLmdldChk\nZWZOYW1lKTsKCiAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkgewogICAgICAg\nICAgICBzZXFzID0gbmV3IEFycmF5TGlzdCgzKTsgLy8gZG9uJ3QgZXhwZWN0\nIG1hbnkgc2VxcyAvIGNsYXNzCiAgICAgICAgICAgIHNlcXMuYWRkKG1ldGEp\nOwogICAgICAgICAgICBfc2Vxcy5wdXQoZGVmTmFtZSwgc2Vxcyk7CiAgICAg\nICAgfSBlbHNlIGlmICghc2Vxcy5jb250YWlucyhtZXRhKSkKICAgICAgICAg\nICAgc2Vxcy5hZGQobWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\nYSBxdWVyeSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxpemVk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRRdWVyeU1ldGFEYXRhKFF1\nZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdCBxdWVyaWVzID0g\nbnVsbDsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAg\naWYgKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQog\nICAgICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VT\nY29wZSgpKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKF9xdWVyaWVzID09IG51\nbGwpCiAgICAgICAgICAgIF9xdWVyaWVzID0gbmV3IEhhc2hNYXA8U3RyaW5n\nLCBMaXN0PigpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcXVlcmllcyA9\nIF9xdWVyaWVzLmdldChkZWZOYW1lKTsKCiAgICAgICAgaWYgKHF1ZXJpZXMg\nPT0gbnVsbCkgewogICAgICAgICAgICBxdWVyaWVzID0gbmV3IEFycmF5TGlz\ndCgzKTsgLy8gZG9uJ3QgZXhwZWN0IG1hbnkgcXVlcmllcyAvIGNsYXNzCiAg\nICAgICAgICAgIHF1ZXJpZXMuYWRkKG1ldGEpOwogICAgICAgICAgICBfcXVl\ncmllcy5wdXQoZGVmTmFtZSwgcXVlcmllcyk7CiAgICAgICAgfSBlbHNlIGlm\nICghcXVlcmllcy5jb250YWlucyhtZXRhKSkKICAgICAgICAgICAgcXVlcmll\ncy5hZGQobWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYWxsIGNv\nbXBvbmVudHMgaW4gdGhlIGdpdmVuIHJlcG9zaXRvcnkgdG8gdGhlIHNldCB0\nbyBiZSBzZXJpYWxpemVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRB\nbGwoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgaWYgKHJl\ncG9zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgZm9y\nIChDbGFzc01ldGFEYXRhIG1ldGEgOiByZXBvcy5nZXRNZXRhRGF0YXMoKSkK\nICAgICAgICAgICAgYWRkTWV0YURhdGEobWV0YSk7CiAgICAgICAgZm9yIChT\nZXF1ZW5jZU1ldGFEYXRhIHNlcSA6IHJlcG9zLmdldFNlcXVlbmNlTWV0YURh\ndGFzKCkpCiAgICAgICAgICAgIGFkZFNlcXVlbmNlTWV0YURhdGEoc2VxKTsK\nICAgICAgICBmb3IgKFF1ZXJ5TWV0YURhdGEgcXVlcnkgOiByZXBvcy5nZXRR\ndWVyeU1ldGFEYXRhcygpKQogICAgICAgICAgICBhZGRRdWVyeU1ldGFEYXRh\nKHF1ZXJ5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG1ldGFk\nYXRhIGZyb20gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICoKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4g\nc2V0CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFEYXRh\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBfbWV0YXMg\nIT0gbnVsbCAmJiBtZXRhICE9IG51bGwKICAgICAgICAgICAgJiYgX21ldGFz\nLnJlbW92ZShtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpICE9\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzZXF1ZW5j\nZSBtZXRhZGF0YSBmcm9tIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2UgaWYg\nbm90IGluIHNldAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVT\nZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIGlmIChfc2VxcyA9PSBudWxsIHx8IG1ldGEgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIFN0cmluZyBkZWZOYW1lID0g\nbnVsbDsKICAgICAgICBpZiAobWV0YS5nZXRTb3VyY2VTY29wZSgpIGluc3Rh\nbmNlb2YgQ2xhc3MpCiAgICAgICAgICAgIGRlZk5hbWUgPSAoKENsYXNzKSBt\nZXRhLmdldFNvdXJjZVNjb3BlKCkpLmdldE5hbWUoKTsKICAgICAgICBMaXN0\nIHNlcXMgPSBfc2Vxcy5nZXQoZGVmTmFtZSk7CiAgICAgICAgaWYgKHNlcXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nICghc2Vxcy5yZW1vdmUobWV0YSkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoc2Vxcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIF9z\nZXFzLnJlbW92ZShkZWZOYW1lKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIHF1ZXJ5IG1ldGFkYXRhIGZy\nb20gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICoKICAgICAqIEBy\nZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gc2V0CiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURhdGEo\nUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9xdWVyaWVzID09\nIG51bGwgfHwgbWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgU3RyaW5nIGRlZk5hbWUgPSBudWxsOwogICAgICAgIGlm\nIChtZXRhLmdldFNvdXJjZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykKICAg\nICAgICAgICAgZGVmTmFtZSA9ICgoQ2xhc3MpIG1ldGEuZ2V0U291cmNlU2Nv\ncGUoKSkuZ2V0TmFtZSgpOwogICAgICAgIExpc3QgcXVlcmllcyA9IF9xdWVy\naWVzLmdldChkZWZOYW1lKTsKICAgICAgICBpZiAocXVlcmllcyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFxdWVy\naWVzLnJlbW92ZShtZXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmIChxdWVyaWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgX3F1\nZXJpZXMucmVtb3ZlKGRlZk5hbWUpOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGFsbCB0aGUgY29tcG9uZW50\ncyBpbiB0aGUgZ2l2ZW4gcmVwb3NpdG9yeSBmcm9tIHRoZSBzZXQgdG8gYmUK\nICAgICAqIHNlcmlhbGl6ZWQuCiAgICAgKgogICAgICogQHJldHVybiB0cnVl\nIGlmIGFueSBjb21wb25lbnRzIHJlbW92ZWQsIGZhbHNlIGlmIG5vbmUgaW4g\nc2V0CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChNZXRh\nRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBpZiAocmVwb3MgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBib29s\nZWFuIHJlbW92ZWQgPSBmYWxzZTsKICAgICAgICBDbGFzc01ldGFEYXRhW10g\nbWV0YXMgPSByZXBvcy5nZXRNZXRhRGF0YXMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBy\nZW1vdmVkIHw9IHJlbW92ZU1ldGFEYXRhKG1ldGFzW2ldKTsKICAgICAgICBT\nZXF1ZW5jZU1ldGFEYXRhW10gc2VxcyA9IHJlcG9zLmdldFNlcXVlbmNlTWV0\nYURhdGFzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVkIHw9IHJlbW92ZVNlcXVl\nbmNlTWV0YURhdGEoc2Vxc1tpXSk7CiAgICAgICAgUXVlcnlNZXRhRGF0YVtd\nIHF1ZXJpZXMgPSByZXBvcy5nZXRRdWVyeU1ldGFEYXRhcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcXVlcmllcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgcmVtb3ZlZCB8PSByZW1vdmVRdWVyeU1ldGFEYXRhKHF1ZXJp\nZXNbaV0pOwogICAgICAgIHJldHVybiByZW1vdmVkOwogICAgfQoKICAgIC8q\nKgogICAgICogQ2xlYXIgdGhlIHNldCBvZiBtZXRhZGF0YXMgdG8gYmUgc2Vy\naWFsaXplZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXIoKSB7CiAg\nICAgICAgaWYgKF9tZXRhcyAhPSBudWxsKQogICAgICAgICAgICBfbWV0YXMu\nY2xlYXIoKTsKICAgICAgICBpZiAoX3NlcXMgIT0gbnVsbCkKICAgICAgICAg\nICAgX3NlcXMuY2xlYXIoKTsKICAgICAgICBpZiAoX3F1ZXJpZXMgIT0gbnVs\nbCkKICAgICAgICAgICAgX3F1ZXJpZXMuY2xlYXIoKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldE9iamVjdHMo\nKSB7CiAgICAgICAgTGlzdCBhbGwgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgaWYgKGlzUXVlcnlNb2RlKCkpCiAgICAgICAgICAgIGFkZFF1ZXJ5TWV0\nYURhdGFzKGFsbCk7CiAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAg\nICAgICAgICAgYWRkU2VxdWVuY2VNZXRhRGF0YXMoYWxsKTsKICAgICAgICBp\nZiAoKGlzTWV0YURhdGFNb2RlKCkgfHwgaXNNYXBwaW5nTW9kZSgpKSAmJiBf\nbWV0YXMgIT0gbnVsbCkKICAgICAgICAgICAgYWxsLmFkZEFsbChfbWV0YXMu\ndmFsdWVzKCkpOwogICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAg\nICAgICAgIGFkZFN5c3RlbU1hcHBpbmdFbGVtZW50cyhhbGwpOwogICAgICAg\nIHNlcmlhbGl6YXRpb25Tb3J0KGFsbCk7CiAgICAgICAgcmV0dXJuIGFsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBzeXN0ZW0tbGV2ZWwgbWFwcGlu\nZyBlbGVtZW50cyB0byBiZSBzZXJpYWxpemVkLiBEb2VzIG5vdGhpbmcKICAg\nICAqIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFk\nZFN5c3RlbU1hcHBpbmdFbGVtZW50cyhDb2xsZWN0aW9uIHRvU2VyaWFsaXpl\nKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBTb3J0IHRoZSBnaXZlbiBjb2xs\nZWN0aW9uIG9mIG9iamVjdHMgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6YXRpb25Tb3J0KExpc3Qgb2Jqcykg\newogICAgICAgIGlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX2NvbXAgPT0gbnVs\nbCkKICAgICAgICAgICAgX2NvbXAgPSBuZXdTZXJpYWxpemF0aW9uQ29tcGFy\nYXRvcigpOwogICAgICAgIENvbGxlY3Rpb25zLnNvcnQob2JqcywgX2NvbXAp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbXBhcmF0\nb3IgZm9yIG9yZGVyaW5nIG9iamVjdHMgdGhhdCBhcmUgdG8gYmUgc2VyaWFs\naXplZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNlcmlhbGl6YXRpb25Db21w\nYXJhdG9yIG5ld1NlcmlhbGl6YXRpb25Db21wYXJhdG9yKCkgewogICAgICAg\nIHJldHVybiBfY29tcDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBzZXF1\nZW5jZSBtZXRhZGF0YSB0byB0aGUgZ2l2ZW4gbWV0YWRhdGFzIGNvbGxlY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXF1ZW5jZU1ldGFE\nYXRhcyhDb2xsZWN0aW9uIGFsbCkgewogICAgICAgIGlmIChfc2VxcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGZvciAoTWFwLkVu\ndHJ5IGVudHJ5IDogX3NlcXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBp\nZiAoZW50cnkuZ2V0S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGFs\nbC5hZGRBbGwoKExpc3QpIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAg\nICBlbHNlIGlmIChfbWV0YXMgPT0gbnVsbCB8fCAhX21ldGFzLmNvbnRhaW5z\nS2V5KGVudHJ5LmdldEtleSgpKSkKICAgICAgICAgICAgICAgIGFsbC5hZGQo\nbmV3IENsYXNzU2VxcygoTGlzdDxTZXF1ZW5jZU1ldGFEYXRhPikKICAgICAg\nICAgICAgICAgICAgICBlbnRyeS5nZXRWYWx1ZSgpKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIHF1ZXJ5IG1ldGFkYXRhIHRvIHRo\nZSBnaXZlbiBtZXRhZGF0YXMgY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZFF1ZXJ5TWV0YURhdGFzKENvbGxlY3Rpb24gYWxsKSB7\nCiAgICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgZm9yIChNYXAuRW50cnkgZW50cnkgOiBfcXVlcmll\ncy5lbnRyeVNldCgpKSB7CiAgICAgICAgICAgIGlmIChlbnRyeS5nZXRLZXko\nKSA9PSBudWxsKQogICAgICAgICAgICAgICAgYWxsLmFkZEFsbCgoTGlzdCkg\nZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKF9tb2Rl\nID09IE1PREVfUVVFUlkgfHwgX21ldGFzID09IG51bGwKICAgICAgICAgICAg\nICAgIHx8ICFfbWV0YXMuY29udGFpbnNLZXkoZW50cnkuZ2V0S2V5KCkpKQog\nICAgICAgICAgICAgICAgYWxsLmFkZChuZXcgQ2xhc3NRdWVyaWVzKChMaXN0\nPFF1ZXJ5TWV0YURhdGE+KQogICAgICAgICAgICAgICAgICAgIGVudHJ5Lmdl\ndFZhbHVlKCkpKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemUoQ29sbGVjdGlvbiBvYmplY3Rz\nKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIC8vIGNv\ncHkgY29sbGVjdGlvbiB0byBhdm9pZCBtdXRhdGlvbgogICAgICAgIE9iamVj\ndCBtZXRhOwogICAgICAgIGJvb2xlYW4gdW5pcXVlID0gdHJ1ZTsKICAgICAg\nICBib29sZWFuIGZpZWxkQWNjZXNzID0gZmFsc2U7CiAgICAgICAgYm9vbGVh\nbiBwcm9wZXJ0eUFjY2VzcyA9IGZhbHNlOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXQgPSBvYmplY3RzLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgbWV0YSA9IGl0Lm5leHQoKTsKICAgICAgICAgICAgc3dp\ndGNoICh0eXBlKG1ldGEpKSB7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVf\nTUVUQToKICAgICAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIGNscyA9\nIChDbGFzc01ldGFEYXRhKSBtZXRhOwogICAgICAgICAgICAgICAgICAgIGlm\nIChjbHMuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNT\nX0ZJRUxEKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEFjY2VzcyA9\nIHRydWU7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICBwcm9wZXJ0eUFjY2VzcyA9IHRydWU7CiAgICAgICAgICAg\nICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHVuaXF1ZSAmJiBnZXRQYWNrYWdl\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc2V0UGFja2Fn\nZShnZXRQYWNrYWdlKG1ldGEpKTsKICAgICAgICAgICAgICAgICAgICBlbHNl\nIGlmICh1bmlxdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVl\nID0gZ2V0UGFja2FnZSgpLmVxdWFscyhnZXRQYWNrYWdlKG1ldGEpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKCF1bmlxdWUpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzZXRQYWNrYWdlKG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nc2VyaWFsaXplTmFtZXNwYWNlQXR0cmlidXRlcygpOwogICAgICAgIHN0YXJ0\nRWxlbWVudCgiZW50aXR5LW1hcHBpbmdzIik7CiAgICAgICAgaWYgKGdldFBh\nY2thZ2UoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgi\ncGFja2FnZSIpOwogICAgICAgICAgICBhZGRUZXh0KGdldFBhY2thZ2UoKSk7\nCiAgICAgICAgICAgIGVuZEVsZW1lbnQoInBhY2thZ2UiKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKGZpZWxkQWNjZXNzICE9IHByb3BlcnR5QWNjZXNzKSAv\nLyBpLmUuIG9ubHkgb25lCiAgICAgICAgewogICAgICAgICAgICBpbnQgZGVm\nID0gZ2V0Q29uZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUlu\nc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YUZhY3Rvcnko\nKS5nZXREZWZhdWx0cygpLmdldERlZmF1bHRBY2Nlc3NUeXBlKCk7CiAgICAg\nICAgICAgIFN0cmluZyBhY2Nlc3MgPSBudWxsOwogICAgICAgICAgICBpZiAo\nZmllbGRBY2Nlc3MgJiYgZGVmID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BS\nT1BFUlRZKQogICAgICAgICAgICAgICAgYWNjZXNzID0gIkZJRUxEIjsKICAg\nICAgICAgICAgZWxzZSBpZiAocHJvcGVydHlBY2Nlc3MgJiYgZGVmID09IENs\nYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKQogICAgICAgICAgICAgICAgYWNj\nZXNzID0gIlBST1BFUlRZIjsKICAgICAgICAgICAgaWYgKGFjY2VzcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzdGFydEVsZW1lbnQoImFjY2VzcyIp\nOwogICAgICAgICAgICAgICAgYWRkVGV4dChhY2Nlc3MpOwogICAgICAgICAg\nICAgICAgZW5kRWxlbWVudCgiYWNjZXNzIik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgZm9yIChPYmplY3Qgb2JqIDogb2JqZWN0cykgewog\nICAgICAgICAgICBpbnQgdHlwZSA9IHR5cGUob2JqKTsKICAgICAgICAgICAg\nc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfTUVU\nQToKICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVDbGFzcygoQ2xhc3NN\nZXRhRGF0YSkgb2JqLCBmaWVsZEFjY2VzcwogICAgICAgICAgICAgICAgICAg\nICAgICAmJiBwcm9wZXJ0eUFjY2Vzcyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRZUEVfU0VROgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHNlcmlhbGl6ZVNlcXVlbmNlKChTZXF1ZW5jZU1ldGFE\nYXRhKSBvYmopOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFX1FVRVJZOgog\nICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVF1ZXJ5KChRdWVyeU1ldGFE\nYXRhKSBvYmopOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBUWVBFX0NMQVNTX1FVRVJJRVM6CiAgICAgICAgICAg\nICAgICAgICAgZm9yIChRdWVyeU1ldGFEYXRhIHF1ZXJ5IDogKChDbGFzc1F1\nZXJpZXMpIG9iaikKICAgICAgICAgICAgICAgICAgICAgICAgLmdldFF1ZXJp\nZXMoKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplUXVlcnko\ncXVlcnkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBUWVBFX0NMQVNTX1NFUVM6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZm9yIChTZXF1ZW5jZU1ldGFEYXRhIHNlcSA6ICgoQ2xhc3NTZXFzKSBv\nYmopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2VxdWVuY2Vz\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVTZXF1\nZW5jZShzZXEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nYXBwaW5nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxp\nemVTeXN0ZW1NYXBwaW5nRWxlbWVudChvYmopOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVu\nZEVsZW1lbnQoImVudGl0eS1tYXBwaW5ncyIpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRQYWNrYWdlKE9iamVjdCBv\nYmopIHsKICAgICAgICBpbnQgdHlwZSA9IHR5cGUob2JqKTsKICAgICAgICBz\nd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUWVBFX01FVEE6CiAg\nICAgICAgICAgICAgICByZXR1cm4gU3RyaW5ncy5nZXRQYWNrYWdlTmFtZSgo\nKENsYXNzTWV0YURhdGEpIG9iaikuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY2FzZSBUWVBFX1FVRVJZ\nOgogICAgICAgICAgICBjYXNlIFRZUEVfU0VROgogICAgICAgICAgICBjYXNl\nIFRZUEVfQ0xBU1NfUVVFUklFUzoKICAgICAgICAgICAgY2FzZSBUWVBFX0NM\nQVNTX1NFUVM6CiAgICAgICAgICAgICAgICBTb3VyY2VUcmFja2VyIHN0ID0g\nKFNvdXJjZVRyYWNrZXIpIG9iajsKICAgICAgICAgICAgICAgIGlmIChzdC5n\nZXRTb3VyY2VTY29wZSgpIGluc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoKENsYXNz\nKSBzdC5nZXRTb3VyY2VTY29wZSgpKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSB0eXBlIGNvbnN0YW50IGZvciB0aGUgZ2l2ZW4gb2JqZWN0\nIGJhc2VkIG9uIGl0cyBydW50aW1lCiAgICAgKiBjbGFzcy4gSWYgdGhlIHJ1\nbnRpbWUgY2xhc3MgZG9lcyBub3QgY29ycmVzcG9uZCB0byBhbnkgb2YgdGhl\nIGtub3duCiAgICAgKiB0eXBlcyB0aGVuIHJldHVybnMgLTEuIFRoaXMgY2Fu\nIGhhcHBlbiBmb3IgdGFncwogICAgICogdGhhdCBhcmUgbm90IGhhbmRsZWQg\nYXQgdGhpcyBzdG9yZS1hZ25vc3RpYyBsZXZlbC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGludCB0eXBlKE9iamVjdCBvKSB7CiAgICAgICAgaWYgKG8gaW5z\ndGFuY2VvZiBDbGFzc01ldGFEYXRhKQogICAgICAgICAgICByZXR1cm4gVFlQ\nRV9NRVRBOwogICAgICAgIGlmIChvIGluc3RhbmNlb2YgUXVlcnlNZXRhRGF0\nYSkKICAgICAgICAgICAgcmV0dXJuIFRZUEVfUVVFUlk7CiAgICAgICAgaWYg\nKG8gaW5zdGFuY2VvZiBTZXF1ZW5jZU1ldGFEYXRhKQogICAgICAgICAgICBy\nZXR1cm4gVFlQRV9TRVE7CiAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBDbGFz\nc1F1ZXJpZXMpCiAgICAgICAgICAgIHJldHVybiBUWVBFX0NMQVNTX1FVRVJJ\nRVM7CiAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBDbGFzc1NlcXMpCiAgICAg\nICAgICAgIHJldHVybiBUWVBFX0NMQVNTX1NFUVM7CiAgICAgICAgcmV0dXJu\nIC0xOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIG5hbWVzcGFj\nZSBhdHRyaWJ1dGVzCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxp\nemVOYW1lc3BhY2VBdHRyaWJ1dGVzKCkKICAgICAgICB0aHJvd3MgU0FYRXhj\nZXB0aW9uIHsKICAgICAgICBhZGRBdHRyaWJ1dGUoInhtbG5zIiwgImh0dHA6\nLy9qYXZhLnN1bi5jb20veG1sL25zL3BlcnNpc3RlbmNlL29ybSIpOwogICAg\nICAgIGFkZEF0dHJpYnV0ZSgieG1sbnM6eHNpIiwgImh0dHA6Ly93d3cudzMu\nb3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIik7CiAgICAgICAgYWRkQXR0\ncmlidXRlKCJ4c2k6c2NoZW1hTG9jYXRpb24iLAogICAgICAgICAgICAiaHR0\ncDovL2phdmEuc3VuLmNvbS94bWwvbnMvcGVyc2lzdGVuY2Uvb3JtIG9ybV8x\nXzAueHNkIik7CiAgICAgICAgYWRkQXR0cmlidXRlKCJ2ZXJzaW9uIiwgIjEu\nMCIpOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHVua25vd24g\nbWFwcGluZyBlbGVtZW50IGF0IHN5c3RlbSBsZXZlbC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplU3lzdGVtTWFwcGluZ0VsZW1lbnQo\nT2JqZWN0IG9iaikKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBxdWVyeSBtZXRhZGF0YS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5KFF1ZXJ5\nTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoIV9hbm5vcyAmJiBtZXRhLmdldFNvdXJjZVR5cGUoKSA9\nPSBtZXRhLlNSQ19BTk5PVEFUSU9OUykKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5p\nc0luZm9FbmFibGVkKCkpIHsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0U291\ncmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQogICAgICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoInNlci1jbHMtcXVlcnkiLAogICAgICAgICAg\nICAgICAgICAgIG1ldGEuZ2V0U291cmNlU2NvcGUoKSwgbWV0YS5nZXROYW1l\nKCkpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9nLmlu\nZm8oX2xvYy5nZXQoInNlci1xdWVyeSIsIG1ldGEuZ2V0TmFtZSgpKSk7CiAg\nICAgICAgfQoKICAgICAgICBhZGRDb21tZW50cyhtZXRhKTsKICAgICAgICBh\nZGRBdHRyaWJ1dGUoIm5hbWUiLCBtZXRhLmdldE5hbWUoKSk7CiAgICAgICAg\nYWRkQXR0cmlidXRlKCJxdWVyeSIsIG1ldGEuZ2V0UXVlcnlTdHJpbmcoKSk7\nCiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyht\nZXRhLmdldExhbmd1YWdlKCkpKSB7CiAgICAgICAgICAgIGlmIChtZXRhLmdl\ndFJlc3VsdFR5cGUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgYWRkQXR0\ncmlidXRlKCJyZXN1bHQtY2xhc3MiLCBtZXRhLmdldFJlc3VsdFR5cGUoKS5n\nZXROYW1lKCkpOwogICAgICAgICAgICBzdGFydEVsZW1lbnQoIm5hbWVkLW5h\ndGl2ZS1xdWVyeSIpOwogICAgICAgICAgICBzZXJpYWxpemVRdWVyeUhpbnRz\nKG1ldGEpOwogICAgICAgICAgICBlbmRFbGVtZW50KCJuYW1lZC1uYXRpdmUt\ncXVlcnkiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFydEVs\nZW1lbnQoIm5hbWVkLXF1ZXJ5Iik7CiAgICAgICAgICAgIHNlcmlhbGl6ZVF1\nZXJ5SGludHMobWV0YSk7CiAgICAgICAgICAgIGVuZEVsZW1lbnQoIm5hbWVk\nLXF1ZXJ5Iik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2Vy\naWFsaXplIHF1ZXJ5IGhpbnRzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nc2VyaWFsaXplUXVlcnlIaW50cyhRdWVyeU1ldGFEYXRhIG1ldGEpCiAgICAg\nICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nW10gaGlu\ndHMgPSBtZXRhLmdldEhpbnRLZXlzKCk7CiAgICAgICAgT2JqZWN0W10gdmFs\ndWVzID0gbWV0YS5nZXRIaW50VmFsdWVzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBoaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBh\nZGRBdHRyaWJ1dGUoIm5hbWUiLCBoaW50c1tpXSk7CiAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZSgidmFsdWUiLCBTdHJpbmcudmFsdWVPZih2YWx1ZXNbaV0p\nKTsKICAgICAgICAgICAgc3RhcnRFbGVtZW50KCJxdWVyeS1oaW50Iik7CiAg\nICAgICAgICAgIGVuZEVsZW1lbnQoInF1ZXJ5LWhpbnQiKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUgc2VxdWVuY2UgbWV0\nYWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZVNl\ncXVlbmNlKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIV9hbm5vcyAmJiBtZXRhLmdl\ndFNvdXJjZVR5cGUoKSA9PSBtZXRhLlNSQ19BTk5PVEFUSU9OUykKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAg\nICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgIGxv\nZy5pbmZvKF9sb2MuZ2V0KCJzZXItc2VxdWVuY2UiLCBtZXRhLmdldE5hbWUo\nKSkpOwoKICAgICAgICBhZGRDb21tZW50cyhtZXRhKTsKICAgICAgICBhZGRB\ndHRyaWJ1dGUoIm5hbWUiLCBtZXRhLmdldE5hbWUoKSk7CgogICAgICAgIC8v\nIHBhcnNlIG91dCB0aGUgZGF0YXN0b3JlIHNlcXVlbmNlIG5hbWUsIGlmIGFu\neQogICAgICAgIFN0cmluZyBwbHVnaW4gPSBtZXRhLmdldFNlcXVlbmNlUGx1\nZ2luKCk7CiAgICAgICAgU3RyaW5nIGNsc05hbWUgPSBDb25maWd1cmF0aW9u\ncy5nZXRDbGFzc05hbWUocGx1Z2luKTsKICAgICAgICBTdHJpbmcgcHJvcHMg\nPSBDb25maWd1cmF0aW9ucy5nZXRQcm9wZXJ0aWVzKHBsdWdpbik7CiAgICAg\nICAgU3RyaW5nIGRzID0gbnVsbDsKICAgICAgICBpZiAocHJvcHMgIT0gbnVs\nbCkgewogICAgICAgICAgICBQcm9wZXJ0aWVzIG1hcCA9IENvbmZpZ3VyYXRp\nb25zLnBhcnNlUHJvcGVydGllcyhwcm9wcyk7CiAgICAgICAgICAgIGRzID0g\nKFN0cmluZykgbWFwLnJlbW92ZSgiU2VxdWVuY2UiKTsKICAgICAgICAgICAg\naWYgKGRzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHByb3BzID0gQ29u\nZmlndXJhdGlvbnMuc2VyaWFsaXplUHJvcGVydGllcyhtYXApOwogICAgICAg\nICAgICAgICAgcGx1Z2luID0gQ29uZmlndXJhdGlvbnMuZ2V0UGx1Z2luKGNs\nc05hbWUsIHByb3BzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYgKGRzICE9IG51bGwpCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgi\nc2VxdWVuY2UtbmFtZSIsIGRzKTsKICAgICAgICBlbHNlIGlmIChwbHVnaW4g\nIT0gbnVsbCAmJiAhU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRS5lcXVh\nbHMKICAgICAgICAgICAgKHBsdWdpbikpCiAgICAgICAgICAgIGFkZEF0dHJp\nYnV0ZSgic2VxdWVuY2UtbmFtZSIsIHBsdWdpbik7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gMCAmJiBtZXRhLmdldEluaXRpYWxW\nYWx1ZSgpICE9IC0xKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImluaXRp\nYWwtdmFsdWUiLAogICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YobWV0\nYS5nZXRJbml0aWFsVmFsdWUoKSkpOwogICAgICAgIGlmIChtZXRhLmdldEFs\nbG9jYXRlKCkgIT0gNTAgJiYgbWV0YS5nZXRBbGxvY2F0ZSgpICE9IC0xKQog\nICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImFsbG9jYXRpb24tc2l6ZSIsCiAg\nICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihtZXRhLmdldEFsbG9jYXRl\nKCkpKTsKCiAgICAgICAgc3RhcnRFbGVtZW50KCJzZXF1ZW5jZS1nZW5lcmF0\nb3IiKTsKICAgICAgICBlbmRFbGVtZW50KCJzZXF1ZW5jZS1nZW5lcmF0b3Ii\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBjbGFzcyBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplQ2xh\nc3MoQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIGFjY2VzcykKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIV9hbm5vcyAm\nJiBtZXRhLmdldFNvdXJjZVR5cGUoKSA9PSBtZXRhLlNSQ19BTk5PVEFUSU9O\nUykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBMb2cgbG9nID0gZ2V0\nTG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJzZXItY2xhc3MiLCBtZXRhKSk7\nCgogICAgICAgIGFkZENvbW1lbnRzKG1ldGEpOwogICAgICAgIGFkZEF0dHJp\nYnV0ZSgiY2xhc3MiLCBnZXRDbGFzc05hbWUobWV0YS5nZXREZXNjcmliZWRU\neXBlKCkuCiAgICAgICAgICAgIGdldE5hbWUoKSkpOwoKICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKQogICAgICAgICAgICAmJiAhbWV0YS5nZXRUeXBl\nQWxpYXMoKS5lcXVhbHMoU3RyaW5ncy5nZXRDbGFzc05hbWUobWV0YS4KICAg\nICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSkpCiAgICAgICAgICAgIGFk\nZEF0dHJpYnV0ZSgibmFtZSIsIG1ldGEuZ2V0VHlwZUFsaWFzKCkpOwoKICAg\nICAgICBTdHJpbmcgbmFtZSA9IGdldEVudGl0eUVsZW1lbnROYW1lKG1ldGEp\nOwogICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICBh\nZGRDbGFzc0F0dHJpYnV0ZXMobWV0YSwgYWNjZXNzKTsKICAgICAgICBpZiAo\naXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBhZGRDbGFzc01hcHBpbmdB\ndHRyaWJ1dGVzKG1ldGEpOwoKICAgICAgICBzdGFydEVsZW1lbnQobmFtZSk7\nCiAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgc2Vy\naWFsaXplQ2xhc3NNYXBwaW5nQ29udGVudChtZXRhKTsKICAgICAgICBpZiAo\naXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgc2VyaWFsaXplSWRDbGFz\ncyhtZXRhKTsKICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKQogICAgICAg\nICAgICBzZXJpYWxpemVJbmhlcml0YW5jZUNvbnRlbnQobWV0YSk7CgogICAg\nICAgIGlmIChpc01hcHBpbmdNb2RlKCkpIHsKICAgICAgICAgICAgTGlzdCBz\nZXFzID0gKF9zZXFzID09IG51bGwpID8gbnVsbCA6IF9zZXFzLmdldAogICAg\nICAgICAgICAgICAgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGlmIChzZXFzICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHNlcmlhbGl6YXRpb25Tb3J0KHNlcXMpOwogICAgICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFzLnNpemUoKTsgaSsrKQogICAg\nICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVNlcXVlbmNlKChTZXF1ZW5jZU1l\ndGFEYXRhKSBzZXFzLmdldChpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpKSB7CiAgICAgICAgICAgIExp\nc3QgcXVlcmllcyA9IChfcXVlcmllcyA9PSBudWxsKSA/IG51bGwgOiBfcXVl\ncmllcy5nZXQKICAgICAgICAgICAgICAgIChtZXRhLmdldERlc2NyaWJlZFR5\ncGUoKS5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAocXVlcmllcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemF0aW9uU29ydChxdWVy\naWVzKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcXVl\ncmllcy5zaXplKCk7IGkrKykKICAgICAgICAgICAgICAgICAgICBzZXJpYWxp\nemVRdWVyeSgoUXVlcnlNZXRhRGF0YSkgcXVlcmllcy5nZXQoaSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAg\nICAgICAgICAgICAgICBzZXJpYWxpemVRdWVyeU1hcHBpbmdzKG1ldGEpOwog\nICAgICAgIH0KCiAgICAgICAgTGlzdDxGaWVsZE1ldGFEYXRhPiBmaWVsZHMg\nPSBuZXcgQXJyYXlMaXN0KEFycmF5cy5hc0xpc3QKICAgICAgICAgICAgKG1l\ndGEuZ2V0RGVmaW5lZEZpZWxkc0luTGlzdGluZ09yZGVyKCkpKTsKICAgICAg\nICBDb2xsZWN0aW9ucy5zb3J0KGZpZWxkcywgbmV3IEZpZWxkQ29tcGFyYXRv\ncigpKTsKCiAgICAgICAgLy8gc2VyaWFsaXplIGF0dHItb3ZlcnJpZGUKICAg\nICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpKSB7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIG9yaWc7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8RmllbGRNZXRhRGF0YT4gaXQg\nPSBmaWVsZHMuaXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykKICAgICAgICAg\nICAgewogICAgICAgICAgICAgICAgZm1kID0gaXQubmV4dCgpOwogICAgICAg\nICAgICAgICAgaWYgKG1ldGEuZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChm\nbWQuZ2V0TmFtZSgpKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAgICAgb3JpZyA9IG1ldGEuZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKS5nZXRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgICAgIGlmIChzZXJpYWxpemVBdHRyaWJ1dGVPdmVycmlkZShm\nbWQsIG9yaWcpKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZUF0dHJp\nYnV0ZU92ZXJyaWRlQ29udGVudChmbWQsIG9yaWcpOwogICAgICAgICAgICAg\nICAgaXQucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGlmIChmaWVsZHMuc2l6ZSgpID4gMCAmJiAoaXNNZXRhRGF0YU1vZGUo\nKSB8fCBpc01hcHBpbmdNb2RlKCkpKSB7CiAgICAgICAgICAgIHN0YXJ0RWxl\nbWVudCgiYXR0cmlidXRlcyIpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIG9yaWc7CiAgICAgICAgICAgIGZvciAoRmllbGRNZXRhRGF0YSBmbWQgOiBm\naWVsZHMpIHsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyaW5n\nVHlwZSgpICE9IGZtZC5nZXREZWZpbmluZ01ldGFEYXRhKCkuCiAgICAgICAg\nICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgb3JpZyA9IGZtZC5nZXREZWNsYXJpbmdNZXRhRGF0YSgpLmdl\ndERlY2xhcmVkRmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgKGZtZC5n\nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgb3JpZyA9IG51bGw7CiAgICAgICAgICAgICAgICBzZXJpYWxp\nemVGaWVsZChmbWQsIG9yaWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGVuZEVsZW1lbnQoImF0dHJpYnV0ZXMiKTsKICAgICAgICB9CiAgICAgICAg\nZW5kRWxlbWVudChuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZW50aXR5IGVsZW1lbnQgbmFtZS4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgU3RyaW5nIGdldEVudGl0eUVsZW1lbnROYW1lKENsYXNzTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIHN3aXRjaCAoZ2V0RW50aXR5VGFnKG1l\ndGEpKSB7CiAgICAgICAgICAgIGNhc2UgRU5USVRZOgogICAgICAgICAgICAg\nICAgcmV0dXJuICJlbnRpdHkiOwogICAgICAgICAgICBjYXNlIEVNQkVEREFC\nTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gImVtYmVkZGFibGUiOwogICAg\nICAgICAgICBjYXNlIE1BUFBFRF9TVVBFUkNMQVNTOgogICAgICAgICAgICAg\nICAgcmV0dXJuICJtYXBwZWQtc3VwZXJjbGFzcyI7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBNZXRhRGF0YVRhZyBmb3IgdGhlIGdpdmVuIGNsYXNzIG1l\ndGEgZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgTWV0YURhdGFU\nYWcgZ2V0RW50aXR5VGFnKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIC8vIEBFbWJlZGRhYmxlIGNsYXNzZXMgY2FuJ3QgZGVjbGFyZSBJZCBmaWVs\nZHMKICAgICAgICBpZiAobWV0YS5pc0VtYmVkZGVkT25seSgpICYmIG1ldGEu\nZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm4gTWV0YURhdGFUYWcuRU1CRUREQUJMRTsKICAgICAgICBpZiAo\nbWV0YS5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4gTWV0YURhdGFU\nYWcuRU5USVRZOwogICAgICAgIHJldHVybiBNZXRhRGF0YVRhZy5NQVBQRURf\nU1VQRVJDTEFTUzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBjbGFzcyBh\ndHRyaWJ1dGVzLgogICAgICoKICAgICAqIEBwYXJhbSBhY2Nlc3Mgd2hldGhl\nciB0byB3cml0ZSBhY2Nlc3MKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZENsYXNzQXR0cmlidXRlcyhDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4g\nYWNjZXNzKSB7CiAgICAgICAgaWYgKCFhY2Nlc3MpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBpbnQgZGVmID0gZ2V0Q29uZmlndXJhdGlvbigpLmdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdl\ndE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuZ2V0RGVmYXVsdEFj\nY2Vzc1R5cGUoKTsKICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkg\nPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQKICAgICAgICAgICAgJiYg\nZGVmID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZKQogICAgICAg\nICAgICBhZGRBdHRyaWJ1dGUoImFjY2VzcyIsICJGSUVMRCIpOwogICAgICAg\nIGVsc2UgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX1BST1BFUlRZCiAgICAgICAgICAgICYmIGRlZiA9PSBDbGFz\nc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkKICAgICAgICAgICAgYWRkQXR0cmli\ndXRlKCJhY2Nlc3MiLCAiUFJPUEVSVFkiKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBtYXBwaW5nIGF0dHJpYnV0ZXMgZm9yIHRoZSBnaXZlbiBjbGFz\ncy4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQKICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgYWRkQ2xhc3NNYXBwaW5nQXR0cmlidXRlcyhDbGFzc01ldGFE\nYXRhIG1hcHBpbmcpCiAgICAgICAgdGhyb3dzIFNBWEV4Y2VwdGlvbiB7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUgaWQtY2xhc3MuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBzZXJpYWxpemVJZENsYXNzKENsYXNzTWV0\nYURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFE\nYXRhLklEX0FQUExJQ0FUSU9OCiAgICAgICAgICAgIHx8IG1ldGEuaXNPcGVu\nSlBBSWRlbnRpdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBD\nbGFzc01ldGFEYXRhIHN1cCA9IG1ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKTsKICAgICAgICBDbGFzcyBvaWQgPSBtZXRhLmdldE9iamVjdElkVHlw\nZSgpOwogICAgICAgIGlmIChvaWQgIT0gbnVsbCAmJiAoc3VwID09IG51bGwg\nfHwgb2lkICE9IHN1cC5nZXRPYmplY3RJZFR5cGUoKSkpIHsKICAgICAgICAg\nICAgYWRkQXR0cmlidXRlKCJjbGFzcyIsIGdldENsYXNzTmFtZShvaWQuZ2V0\nTmFtZSgpKSk7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgiaWQtY2xhc3Mi\nKTsKICAgICAgICAgICAgZW5kRWxlbWVudCgiaWQtY2xhc3MiKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUgY2xhc3MgbWFw\ncGluZyBjb250ZW50LiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplQ2xhc3NNYXBwaW5nQ29u\ndGVudChDbGFzc01ldGFEYXRhIG1hcHBpbmcpCiAgICAgICAgdGhyb3dzIFNB\nWEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUg\naW5oZXJpdGFuY2UgY29udGVudC4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZUluaGVyaXRh\nbmNlQ29udGVudChDbGFzc01ldGFEYXRhIG1hcHBpbmcpCiAgICAgICAgdGhy\nb3dzIFNBWEV4Y2VwdGlvbiB7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJp\nYWxpemUgcXVlcnkgbWFwcGluZ3MuIERvZXMgbm90aGluZyBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVRdWVyeU1h\ncHBpbmdzKENsYXNzTWV0YURhdGEgbWV0YSkKICAgICAgICB0aHJvd3MgU0FY\nRXhjZXB0aW9uIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSB0\naGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXJp\nYWxpemVGaWVsZChGaWVsZE1ldGFEYXRhIGZtZCwgRmllbGRNZXRhRGF0YSBv\ncmlnKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlm\nIChmbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdF\nX1BFUlNJU1RFTlQKICAgICAgICAgICAgJiYgIWZtZC5pc0V4cGxpY2l0KCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYWRkQ29tbWVudHMoZm1k\nKTsKICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUiLCBmbWQuZ2V0TmFtZSgp\nKTsKCiAgICAgICAgU3RyaW5nIHN0cmF0ZWd5ID0gbnVsbDsKICAgICAgICBQ\nZXJzaXN0ZW5jZVN0cmF0ZWd5IHN0cmF0ID0gZ2V0U3RyYXRlZ3koZm1kKTsK\nICAgICAgICBWYWx1ZU1ldGFEYXRhIGNhc2NhZGVzID0gbnVsbDsKICAgICAg\nICBpZiAoZm1kLmlzUHJpbWFyeUtleSgpICYmIHN0cmF0ID09IFBlcnNpc3Rl\nbmNlU3RyYXRlZ3kuRU1CRURERUQpCiAgICAgICAgICAgIHN0cmF0ZWd5ID0g\nImVtYmVkZGVkLWlkIjsKICAgICAgICBlbHNlIGlmIChmbWQuaXNQcmltYXJ5\nS2V5KCkpCiAgICAgICAgICAgIHN0cmF0ZWd5ID0gImlkIjsKICAgICAgICBl\nbHNlIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAgICAgICAgICAgIHN0cmF0ZWd5\nID0gInZlcnNpb24iOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0\nY2ggKHN0cmF0KSB7CiAgICAgICAgICAgICAgICBjYXNlIFRSQU5TSUVOVDoK\nICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICJ0cmFuc2llbnQiOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBCQVNJQzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkQmFzaWNBdHRyaWJ1\ndGVzKGZtZCk7CiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAiYmFz\naWMiOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBFTUJFRERFRDoKICAgICAgICAgICAgICAgICAgICBzdHJhdGVn\neSA9ICJlbWJlZGRlZCI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBhZGRNYW55VG9PbmVBdHRyaWJ1dGVzKGZtZCk7CiAgICAgICAgICAg\nICAgICAgICAgc3RyYXRlZ3kgPSAibWFueS10by1vbmUiOwogICAgICAgICAg\nICAgICAgICAgIGNhc2NhZGVzID0gZm1kOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPTkVfT05FOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBhZGRPbmVUb09uZUF0dHJpYnV0ZXMoZm1kKTsKICAg\nICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICJvbmUtdG8tb25lIjsKICAg\nICAgICAgICAgICAgICAgICBjYXNjYWRlcyA9IGZtZDsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX01BTlk6\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGFkZE9uZVRvTWFueUF0dHJpYnV0ZXMo\nZm1kKTsKICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICJvbmUtdG8t\nbWFueSI7CiAgICAgICAgICAgICAgICAgICAgY2FzY2FkZXMgPSBmbWQuZ2V0\nRWxlbWVudCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBNQU5ZX01BTlk6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGFkZE1hbnlUb01hbnlBdHRyaWJ1dGVzKGZtZCk7CiAgICAgICAgICAgICAg\nICAgICAgc3RyYXRlZ3kgPSAibWFueS10by1tYW55IjsKICAgICAgICAgICAg\nICAgICAgICBjYXNjYWRlcyA9IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgIGFkZFN0cmF0\nZWd5TWFwcGluZ0F0dHJpYnV0ZXMoZm1kKTsKICAgICAgICB9CiAgICAgICAg\naWYgKGlzTWFwcGluZ01vZGUoZm1kKSkKICAgICAgICAgICAgYWRkRmllbGRN\nYXBwaW5nQXR0cmlidXRlcyhmbWQsIG9yaWcpOwoKICAgICAgICBzdGFydEVs\nZW1lbnQoc3RyYXRlZ3kpOwogICAgICAgIGlmIChmbWQuZ2V0T3JkZXJEZWNs\nYXJhdGlvbigpICE9IG51bGwpIHsKICAgICAgICAgICAgc3RhcnRFbGVtZW50\nKCJvcmRlci1ieSIpOwogICAgICAgICAgICBpZiAoIShPcmRlci5FTEVNRU5U\nICsgIiBhc2MiKS5lcXVhbHMoZm1kLmdldE9yZGVyRGVjbGFyYXRpb24oKSkp\nCiAgICAgICAgICAgICAgICBhZGRUZXh0KGZtZC5nZXRPcmRlckRlY2xhcmF0\naW9uKCkpOwogICAgICAgICAgICBlbmRFbGVtZW50KCJvcmRlci1ieSIpOwog\nICAgICAgIH0KICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpICYmIGZtZC5n\nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkgewogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhIG1hcEJ5ID0gZm1kLmdldEtleSgpLmdldFZh\nbHVlTWFwcGVkQnlNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoIW1hcEJ5\nLmlzUHJpbWFyeUtleSgpIHx8CiAgICAgICAgICAgICAgICBtYXBCeS5nZXRE\nZWZpbmluZ01ldGFEYXRhKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0\naCAhPSAxKSB7CiAgICAgICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm5hbWUi\nLCBmbWQuZ2V0S2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBzdGFydEVsZW1lbnQoIm1hcC1rZXkiKTsKICAg\nICAgICAgICAgZW5kRWxlbWVudCgibWFwLWtleSIpOwogICAgICAgIH0KICAg\nICAgICBpZiAoaXNNYXBwaW5nTW9kZShmbWQpKQogICAgICAgICAgICBzZXJp\nYWxpemVGaWVsZE1hcHBpbmdDb250ZW50KGZtZCwgc3RyYXQpOwogICAgICAg\nIGlmIChjYXNjYWRlcyAhPSBudWxsICYmIGlzTWV0YURhdGFNb2RlKCkpCiAg\nICAgICAgICAgIHNlcmlhbGl6ZUNhc2NhZGVzKGNhc2NhZGVzKTsKICAgICAg\nICBpZiAoaXNNYXBwaW5nTW9kZSgpICYmIHN0cmF0ID09IFBlcnNpc3RlbmNl\nU3RyYXRlZ3kuRU1CRURERUQpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBtZXRhID0gZm1kLmdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBvd25lciA9IGdldENvbmZpZ3VyYXRpb24oKS4K\nICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNl\nKCkuZ2V0TWV0YURhdGEKICAgICAgICAgICAgICAgIChtZXRhLmdldERlc2Ny\naWJlZFR5cGUoKSwgbWV0YS5nZXRFbnZDbGFzc0xvYWRlcigpLCB0cnVlKTsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBlb3JpZzsKICAgICAgICAgICAg\nZm9yIChGaWVsZE1ldGFEYXRhIGVmbWQgOiBtZXRhLmdldEZpZWxkcygpKSB7\nCiAgICAgICAgICAgICAgICBlb3JpZyA9IG93bmVyLmdldEZpZWxkKGVmbWQu\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIGlmIChzZXJpYWxpemVBdHRy\naWJ1dGVPdmVycmlkZShlZm1kLCBlb3JpZykpCiAgICAgICAgICAgICAgICAg\nICAgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVDb250ZW50KGVmbWQsIGVv\ncmlnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbmRFbGVt\nZW50KHN0cmF0ZWd5KTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBtYXBw\naW5nIGF0dHJpYnV0ZXMgZm9yIHRoZSBnaXZlbiBmaWVsZC4gRG9lcyBub3Ro\naW5nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFk\nZEZpZWxkTWFwcGluZ0F0dHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQsCiAg\nICAgICAgRmllbGRNZXRhRGF0YSBvcmlnKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgfQoKICAgIC8qKgogICAgICogQWx3YXlzIHJldHVy\nbnMgZmFsc2UgYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGUoRmllbGRNZXRhRGF0\nYSBmbWQsCiAgICAgICAgRmllbGRNZXRhRGF0YSBvcmlnKSB7CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXpl\nIGF0dHJpYnV0ZSBvdmVycmlkZSBjb250ZW50LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVDb250ZW50KEZp\nZWxkTWV0YURhdGEgZm1kLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZykK\nICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBhZGRBdHRy\naWJ1dGUoIm5hbWUiLCBmbWQuZ2V0TmFtZSgpKTsKICAgICAgICBzdGFydEVs\nZW1lbnQoImF0dHJpYnV0ZS1vdmVycmlkZSIpOwogICAgICAgIHNlcmlhbGl6\nZUF0dHJpYnV0ZU92ZXJyaWRlTWFwcGluZ0NvbnRlbnQoZm1kLCBvcmlnKTsK\nICAgICAgICBlbmRFbGVtZW50KCJhdHRyaWJ1dGUtb3ZlcnJpZGUiKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBhdHRyaWJ1dGUgb3ZlcnJp\nZGUgbWFwcGluZyBjb250ZW50LiBEb2VzIG5vdGhpbmcgYnkgZGVmYXVsdCwK\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2VyaWFsaXplQXR0cmlidXRl\nT3ZlcnJpZGVNYXBwaW5nQ29udGVudAogICAgICAgIChGaWVsZE1ldGFEYXRh\nIGZtZCwgRmllbGRNZXRhRGF0YSBvcmlnKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGNh\nc2NhZGVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplQ2Fz\nY2FkZXMoVmFsdWVNZXRhRGF0YSB2bWQpCiAgICAgICAgdGhyb3dzIFNBWEV4\nY2VwdGlvbiB7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IGNhc2NhZGVz\nID0gbnVsbDsKICAgICAgICBpZiAodm1kLmdldENhc2NhZGVQZXJzaXN0KCkg\nPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAg\nICAgICBpZiAoY2FzY2FkZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNh\nc2NhZGVzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgICAg\nIGNhc2NhZGVzLmFkZCgiY2FzY2FkZS1wZXJzaXN0Iik7CiAgICAgICAgfQog\nICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZUF0dGFjaCgpID09IFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAgICAgaWYgKGNh\nc2NhZGVzID09IG51bGwpCiAgICAgICAgICAgICAgICBjYXNjYWRlcyA9IG5l\ndyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgICAgICBjYXNjYWRlcy5h\nZGQoImNhc2NhZGUtbWVyZ2UiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZt\nZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURF\nX0lNTUVESUFURSkgewogICAgICAgICAgICBpZiAoY2FzY2FkZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGNhc2NhZGVzID0gbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KCk7CiAgICAgICAgICAgIGNhc2NhZGVzLmFkZCgiY2FzY2FkZS1y\nZW1vdmUiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZtZC5nZXRDYXNjYWRl\nUmVmcmVzaCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUp\nIHsKICAgICAgICAgICAgaWYgKGNhc2NhZGVzID09IG51bGwpCiAgICAgICAg\nICAgICAgICBjYXNjYWRlcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwog\nICAgICAgICAgICBjYXNjYWRlcy5hZGQoImNhc2NhZGUtcmVmcmVzaCIpOwog\nICAgICAgIH0KICAgICAgICBpZiAoY2FzY2FkZXMgIT0gbnVsbCAmJiBjYXNj\nYWRlcy5zaXplKCkgPT0gNCkgLy8gQUxMCiAgICAgICAgewogICAgICAgICAg\nICBjYXNjYWRlcy5jbGVhcigpOwogICAgICAgICAgICBjYXNjYWRlcy5hZGQo\nImNhc2NhZGUtYWxsIik7CiAgICAgICAgfQogICAgICAgIGlmIChjYXNjYWRl\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgIHN0YXJ0RWxlbWVudCgiY2FzY2Fk\nZSIpOwogICAgICAgICAgICBmb3IgKFN0cmluZyBjYXNjYWRlIDogY2FzY2Fk\nZXMpIHsKICAgICAgICAgICAgICAgIHN0YXJ0RWxlbWVudChjYXNjYWRlKTsK\nICAgICAgICAgICAgICAgIGVuZEVsZW1lbnQoY2FzY2FkZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgZW5kRWxlbWVudCgiY2FzY2FkZSIpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc2VyaWFs\naXplZCBzdHJhdGVneSBuYW1lLgogICAgICovCiAgICBwcm90ZWN0ZWQgUGVy\nc2lzdGVuY2VTdHJhdGVneSBnZXRTdHJhdGVneShGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IGZtZC5N\nQU5BR0VfTk9ORSkKICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kuVFJBTlNJRU5UOwoKICAgICAgICBpZiAoZm1kLmlzU2VyaWFsaXpl\nZCgpCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBi\neXRlW10uY2xhc3MKICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlw\nZSgpID09IEJ5dGVbXS5jbGFzcwogICAgICAgICAgICB8fCBmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNsYXNzCiAgICAgICAgICAgIHx8IGZt\nZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykKICAg\nICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUM7Cgog\nICAgICAgIEZpZWxkTWV0YURhdGEgbWFwcGVkQnk7CiAgICAgICAgc3dpdGNo\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgaWYgKGZtZC5pc0Vt\nYmVkZGVkKCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3Rl\nbmNlU3RyYXRlZ3kuRU1CRURERUQ7CiAgICAgICAgICAgICAgICBpZiAoZm1k\nLmdldE1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5PTkVfT05FOwogICAgICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGludmVyc2VzID0gZm1kLmdldEludmVy\nc2VNZXRhRGF0YXMoKTsKICAgICAgICAgICAgICAgIGlmIChpbnZlcnNlcy5s\nZW5ndGggPT0gMSAmJgogICAgICAgICAgICAgICAgICAgIGludmVyc2VzWzBd\nLmdldFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDICYmCiAgICAgICAgICAg\nICAgICAgICAgaW52ZXJzZXNbMF0uZ2V0TWFwcGVkQnlNZXRhRGF0YSgpID09\nIGZtZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5j\nZVN0cmF0ZWd5Lk9ORV9PTkU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5NQU5ZX09ORTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIG1hcHBlZEJ5ID0gZm1k\nLmdldE1hcHBlZEJ5TWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIGlmICht\nYXBwZWRCeSA9PSBudWxsIHx8IG1hcHBlZEJ5LmdldFR5cGVDb2RlKCkgIT0g\nSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJz\naXN0ZW5jZVN0cmF0ZWd5Lk1BTllfTUFOWTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk9ORV9NQU5ZOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nUGVyc2lzdGVuY2VTdHJhdGVneS5FTUJFRERFRDsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVN0cmF0\nZWd5LkJBU0lDOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCBiYXNpYyBhdHRyaWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkQmFzaWNBdHRyaWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAg\nIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmICghZm1kLmlzSW5E\nZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUo\nImZldGNoIiwgIkxBWlkiKTsKICAgICAgICBpZiAoZm1kLmdldE51bGxWYWx1\nZSgpID09IEZpZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pCiAgICAgICAg\nICAgIGFkZEF0dHJpYnV0ZSgib3B0aW9uYWwiLCAiZmFsc2UiKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCBtYW55LXRvLW9uZSBhdHRyaWJ1dGVzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFueVRvT25lQXR0cmlidXRl\ncyhGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoIWZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAo\nKSkKICAgICAgICAgICAgYWRkQXR0cmlidXRlKCJmZXRjaCIsICJMQVpZIik7\nCiAgICAgICAgaWYgKGZtZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1ldGFE\nYXRhLk5VTExfRVhDRVBUSU9OKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUo\nIm9wdGlvbmFsIiwgImZhbHNlIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgb25lLXRvLW9uZSBhdHRyaWJ1dGVzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkT25lVG9PbmVBdHRyaWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1k\nKQogICAgICAgIHRocm93cyBTQVhFeGNlcHRpb24gewogICAgICAgIGlmICgh\nZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBhZGRB\ndHRyaWJ1dGUoImZldGNoIiwgIkxBWlkiKTsKICAgICAgICBpZiAoZm1kLmdl\ndE51bGxWYWx1ZSgpID09IEZpZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04p\nCiAgICAgICAgICAgIGFkZEF0dHJpYnV0ZSgib3B0aW9uYWwiLCAiZmFsc2Ui\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBvbmUtdG8tbWFueSBhdHRy\naWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkT25lVG9NYW55\nQXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3Mg\nU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0\nY2hHcm91cCgpKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoImZldGNoIiwg\nIkVBR0VSIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgbWFueS10by1t\nYW55IGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRN\nYW55VG9NYW55QXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAg\nICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZm1kLmlzSW5E\nZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUo\nImZldGNoIiwgIkVBR0VSIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJp\nYWxpemUgZmllbGQgbWFwcGluZyBjb250ZW50OyB0aGlzIHdpbGwgYmUgY2Fs\nbGVkIGJlZm9yZQogICAgICoge0BsaW5rICNzZXJpYWxpemVWYWx1ZU1hcHBp\nbmdDb250ZW50fS4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHNlcmlhbGl6ZUZpZWxkTWFwcGluZ0NvbnRl\nbnQoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgUGVyc2lzdGVuY2VTdHJh\ndGVneSBzdHJhdGVneSkKICAgICAgICB0aHJvd3MgU0FYRXhjZXB0aW9uIHsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCBtYXBwaW5nIGF0dHJpYnV0ZXMg\nZm9yIHN0cmF0ZWd5LiBTZXRzIG1hcHBlZC1ieSBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRTdHJhdGVneU1hcHBpbmdBdHRy\naWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93cyBTQVhF\neGNlcHRpb24gewogICAgICAgIGlmIChmbWQuZ2V0TWFwcGVkQnkoKSAhPSBu\ndWxsKQogICAgICAgICAgICBhZGRBdHRyaWJ1dGUoIm1hcHBlZC1ieSIsIGZt\nZC5nZXRNYXBwZWRCeSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJl\nc2VudHMgb3JkZXJlZCBzZXQgb2Yge0BsaW5rIFNlcXVlbmNlTWV0YURhdGF9\ncyB3aXRoIGEKICAgICAqIGNvbW1vbiBjbGFzcyBzY29wZS4KICAgICAqCiAg\nICAgKiBAYXV0aG9yIFN0ZXBoZW4gS2ltCiAgICAgKiBAYXV0aG9yIFBpbmFr\naSBQb2RkYXIKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ2xh\nc3NTZXFzCiAgICAgICAgaW1wbGVtZW50cyBTb3VyY2VUcmFja2VyLCBDb21w\nYXJhYmxlPENsYXNzU2Vxcz4sCiAgICAgICAgQ29tcGFyYXRvcjxTZXF1ZW5j\nZU1ldGFEYXRhPiB7CgogICAgICAgIHByaXZhdGUgZmluYWwgU2VxdWVuY2VN\nZXRhRGF0YVtdIF9zZXFzOwoKICAgICAgICBwdWJsaWMgQ2xhc3NTZXFzKExp\nc3Q8U2VxdWVuY2VNZXRhRGF0YT4gc2VxcykgewogICAgICAgICAgICBpZiAo\nc2VxcyA9PSBudWxsIHx8IHNlcXMuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CgogICAgICAgICAg\nICBfc2VxcyA9IChTZXF1ZW5jZU1ldGFEYXRhW10pIHNlcXMudG9BcnJheQog\nICAgICAgICAgICAgICAgKG5ldyBTZXF1ZW5jZU1ldGFEYXRhW3NlcXMuc2l6\nZSgpXSk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KF9zZXFzLCB0aGlzKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTZXF1ZW5jZU1ldGFEYXRhW10g\nZ2V0U2VxdWVuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gX3NlcXM7CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDb21wYXJlIHNlcXVl\nbmNlIG1ldGFkYXRhIG9uIG5hbWUuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIGludCBjb21wYXJlKFNlcXVlbmNlTWV0YURhdGEgbzEsIFNlcXVlbmNl\nTWV0YURhdGEgbzIpIHsKICAgICAgICAgICAgcmV0dXJuIG8xLmdldE5hbWUo\nKS5jb21wYXJlVG8obzIuZ2V0TmFtZSgpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfc2Vxc1swXS5nZXRTb3VyY2VGaWxlKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgT2JqZWN0IGdldFNvdXJjZVNjb3BlKCkgewogICAgICAg\nICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0U291cmNlU2NvcGUoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0U291cmNlVHlwZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9zZXFzWzBdLmdldFNvdXJjZVR5cGUoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVzb3VyY2VOYW1l\nKCkgewogICAgICAgICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0UmVzb3VyY2VO\nYW1lKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmVU\nbyhDbGFzc1NlcXMgb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09\nIHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAg\naWYgKG90aGVyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7\nCiAgICAgICAgICAgIENsYXNzIHNjb3BlID0gKENsYXNzKSBnZXRTb3VyY2VT\nY29wZSgpOwogICAgICAgICAgICBDbGFzcyBvc2NvcGUgPSAoQ2xhc3MpIG90\naGVyLmdldFNvdXJjZVNjb3BlKCk7CiAgICAgICAgICAgIHJldHVybiBzY29w\nZS5nZXROYW1lKCkuY29tcGFyZVRvKG9zY29wZS5nZXROYW1lKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgb3JkZXJl\nZCBzZXQgb2Yge0BsaW5rIFF1ZXJ5TWV0YURhdGF9cyB3aXRoIGEKICAgICAq\nIGNvbW1vbiBjbGFzcyBzY29wZS4KICAgICAqCiAgICAgKiBAYXV0aG9yIFN0\nZXBoZW4gS2ltCiAgICAgKiBAYXV0aG9yIFBpbmFraSBQb2RkYXIKICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ2xhc3NRdWVyaWVzCiAgICAg\nICAgaW1wbGVtZW50cyBTb3VyY2VUcmFja2VyLCBDb21wYXJhYmxlPENsYXNz\nUXVlcmllcz4sCiAgICAgICAgQ29tcGFyYXRvcjxRdWVyeU1ldGFEYXRhPiB7\nCgogICAgICAgIHByaXZhdGUgZmluYWwgUXVlcnlNZXRhRGF0YVtdIF9xdWVy\naWVzOwoKICAgICAgICBwdWJsaWMgQ2xhc3NRdWVyaWVzKExpc3Q8UXVlcnlN\nZXRhRGF0YT4gcXVlcmllcykgewogICAgICAgICAgICBpZiAocXVlcmllcyA9\nPSBudWxsIHx8IHF1ZXJpZXMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CgogICAgICAgICAgICBf\ncXVlcmllcyA9IChRdWVyeU1ldGFEYXRhW10pIHF1ZXJpZXMudG9BcnJheQog\nICAgICAgICAgICAgICAgKG5ldyBRdWVyeU1ldGFEYXRhW3F1ZXJpZXMuc2l6\nZSgpXSk7CiAgICAgICAgICAgIEFycmF5cy5zb3J0KF9xdWVyaWVzLCB0aGlz\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBRdWVyeU1ldGFEYXRhW10g\nZ2V0UXVlcmllcygpIHsKICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVzOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcGFyZSBxdWVy\neSBtZXRhZGF0YS4gTm9ybWFsIHF1ZXJpZXMgYXBwZWFyIGJlZm9yZSBuYXRp\ndmUgcXVlcmllcy4KICAgICAgICAgKiBJZiB0aGUgZ2l2ZW4gcXVlcmllcyB1\nc2Ugc2FtZSBsYW5ndWFnZSwgdGhlbiB0aGVpciBuYW1lcyBhcmUKICAgICAg\nICAgKiBjb21wYXJlZC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgaW50\nIGNvbXBhcmUoUXVlcnlNZXRhRGF0YSBvMSwgUXVlcnlNZXRhRGF0YSBvMikg\newogICAgICAgICAgICAvLyBub3JtYWwgcXVlcmllcyBiZWZvcmUgbmF0aXZl\nCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuZXF1YWxzKG8xLmdldExh\nbmd1YWdlKCksIG8yLmdldExhbmd1YWdlKCkpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKG8xLmdldExh\nbmd1YWdlKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiAt\nMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbzEuZ2V0TmFt\nZSgpLmNvbXBhcmVUbyhvMi5nZXROYW1lKCkpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEZpbGUgZ2V0U291cmNlRmlsZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9xdWVyaWVzWzBdLmdldFNvdXJjZUZpbGUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcXVlcmllc1swXS5nZXRTb3VyY2VTY29wZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRTb3VyY2VUeXBl\nKCkgewogICAgICAgICAgICByZXR1cm4gX3F1ZXJpZXNbMF0uZ2V0U291cmNl\nVHlwZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRS\nZXNvdXJjZU5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllc1sw\nXS5nZXRSZXNvdXJjZU5hbWUoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBpbnQgY29tcGFyZVRvKENsYXNzUXVlcmllcyBvdGhlcikgewogICAgICAg\nICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVy\nbiAwOwogICAgICAgICAgICBpZiAob3RoZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgQ2xhc3Mgc2NvcGUgPSAo\nQ2xhc3MpIGdldFNvdXJjZVNjb3BlKCk7CiAgICAgICAgICAgIENsYXNzIG9z\nY29wZSA9IChDbGFzcykgb3RoZXIuZ2V0U291cmNlU2NvcGUoKTsKICAgICAg\nICAgICAgcmV0dXJuIHNjb3BlLmdldE5hbWUoKS5jb21wYXJlVG8ob3Njb3Bl\nLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQ29tcGFyZXMgY2xhc2VzLCBzZXF1ZW5jZXMsIGFuZCBxdWVyaWVzIHRvIG9y\nZGVyIHRoZW0gZm9yIHNlcmlhbGl6YXRpb24uCiAgICAgKiBQbGFjZXMgc2Vx\ndWVuY2VzIGZpcnN0LCB0aGVuIGNsYXNzZXMsIHRoZW4gcXVlcmllcy4gU2Vx\ndWVuY2VzIGFuZAogICAgICogcXVlcmllcyBhcmUgb3JkZXJlZCBhbHBoYWJl\ndGljYWxseSBieSBuYW1lLiBDbGFzc2VzIGFyZSBwbGFjZWQgaW4KICAgICAq\nIGxpc3Rpbmcgb3JkZXIsIGluIGluaGVyaXRhbmNlIG9yZGVyIHdpdGhpbiB0\naGF0LCBhbmQgaW4gYWxwaGFiZXRpY2FsCiAgICAgKiBvcmRlciB3aXRoaW4g\ndGhhdC4KICAgICAqCiAgICAgKiBAYXV0aG9yIFN0ZXBoZW4gS2ltCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBjbGFzcyBTZXJpYWxpemF0aW9uQ29tcGFyYXRv\ncgogICAgICAgIGV4dGVuZHMgTWV0YURhdGFJbmhlcml0YW5jZUNvbXBhcmF0\nb3IgewoKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoT2JqZWN0IG8xLCBP\nYmplY3QgbzIpIHsKICAgICAgICAgICAgaWYgKG8xID09IG8yKQogICAgICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGlmIChvMSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIGlmIChv\nMiA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAgICAg\nICAgICAgaW50IHQxID0gdHlwZShvMSk7CiAgICAgICAgICAgIGludCB0MiA9\nIHR5cGUobzIpOwogICAgICAgICAgICBpZiAodDEgIT0gdDIpCiAgICAgICAg\nICAgICAgICByZXR1cm4gdDEgLSB0MjsKCiAgICAgICAgICAgIHN3aXRjaCAo\ndDEpIHsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9NRVRBOgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBjb21wYXJlKChDbGFzc01ldGFEYXRhKSBv\nMSwgKENsYXNzTWV0YURhdGEpIG8yKTsKICAgICAgICAgICAgICAgIGNhc2Ug\nVFlQRV9RVUVSWToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcGFy\nZSgoUXVlcnlNZXRhRGF0YSkgbzEsIChRdWVyeU1ldGFEYXRhKSBvMik7CiAg\nICAgICAgICAgICAgICBjYXNlIFRZUEVfU0VROgogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBjb21wYXJlKChTZXF1ZW5jZU1ldGFEYXRhKSBvMSwKICAg\nICAgICAgICAgICAgICAgICAgICAgKFNlcXVlbmNlTWV0YURhdGEpIG8yKTsK\nICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9DTEFTU19RVUVSSUVTOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiAoKENvbXBhcmFibGUpIG8xKS5jb21w\nYXJlVG8obzIpOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFX0NMQVNTX1NF\nUVM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoQ29tcGFyYWJsZSkg\nbzEpLmNvbXBhcmVUbyhvMik7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wYXJlVW5rbm93bihvMSwg\nbzIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBDb21wYXJlIHR3byB1bnJlY29nbml6ZWQgZWxlbWVudHMgb2Yg\ndGhlIHNhbWUgdHlwZS4gVGhyb3dzCiAgICAgICAgICogZXhjZXB0aW9uIGJ5\nIGRlZmF1bHQuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVkIGludCBj\nb21wYXJlVW5rbm93bihPYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIENvbXBhcmUgYmV0d2VlbiB0d28g\nY2xhc3MgbWV0YWRhdGEuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBp\nbnQgY29tcGFyZShDbGFzc01ldGFEYXRhIG8xLCBDbGFzc01ldGFEYXRhIG8y\nKSB7CiAgICAgICAgICAgIGludCBsaTEgPSBvMS5nZXRMaXN0aW5nSW5kZXgo\nKTsKICAgICAgICAgICAgaW50IGxpMiA9IG8yLmdldExpc3RpbmdJbmRleCgp\nOwogICAgICAgICAgICBpZiAobGkxID09IC0xICYmIGxpMiA9PSAtMSkgewog\nICAgICAgICAgICAgICAgTWV0YURhdGFUYWcgdDEgPSBnZXRFbnRpdHlUYWco\nbzEpOwogICAgICAgICAgICAgICAgTWV0YURhdGFUYWcgdDIgPSBnZXRFbnRp\ndHlUYWcobzIpOwogICAgICAgICAgICAgICAgaWYgKHQxLmNvbXBhcmVUbyh0\nMikgIT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDEuY29tcGFy\nZVRvKHQyKTsKICAgICAgICAgICAgICAgIGludCBpbmhlciA9IHN1cGVyLmNv\nbXBhcmUobzEsIG8yKTsKICAgICAgICAgICAgICAgIGlmIChpbmhlciAhPSAw\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmhlcjsKICAgICAgICAg\nICAgICAgIHJldHVybiBvMS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgp\nLmNvbXBhcmVUbwogICAgICAgICAgICAgICAgICAgIChvMi5nZXREZXNjcmli\nZWRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgaWYgKGxpMSA9PSAtMSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwog\nICAgICAgICAgICBpZiAobGkyID09IC0xKQogICAgICAgICAgICAgICAgcmV0\ndXJuIC0xOwogICAgICAgICAgICByZXR1cm4gbGkxIC0gbGkyOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcGFyZSBxdWVyeSBtZXRh\nZGF0YS4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIGludCBjb21wYXJl\nKFF1ZXJ5TWV0YURhdGEgbzEsIFF1ZXJ5TWV0YURhdGEgbzIpIHsKICAgICAg\nICAgICAgLy8gbm9ybWFsIHF1ZXJpZXMgYmVmb3JlIG5hdGl2ZQogICAgICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFscyhvMS5nZXRMYW5ndWFnZSgp\nLCBvMi5nZXRMYW5ndWFnZSgpKSkgewogICAgICAgICAgICAgICAgaWYgKFF1\nZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFscyhvMS5nZXRMYW5ndWFnZSgp\nKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG8xLmdldE5hbWUoKS5jb21w\nYXJlVG8obzIuZ2V0TmFtZSgpKTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIENvbXBhcmUgc2VxdWVuY2UgbWV0YWRhdGEuCiAgICAgICAg\nICovCiAgICAgICAgcHJpdmF0ZSBpbnQgY29tcGFyZShTZXF1ZW5jZU1ldGFE\nYXRhIG8xLCBTZXF1ZW5jZU1ldGFEYXRhIG8yKSB7CiAgICAgICAgICAgIHJl\ndHVybiBvMS5nZXROYW1lKCkuY29tcGFyZVRvKG8yLmdldE5hbWUoKSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU29ydHMgZmllbGRzIGFj\nY29yZGluZyB0byBsaXN0aW5nIG9yZGVyLCB0aGVuIFhTRCBzdHJhdGVneSBv\ncmRlciwKICAgICAqIHRoZW4gbmFtZSBvcmRlci4KICAgICAqLwogICAgcHJp\ndmF0ZSBjbGFzcyBGaWVsZENvbXBhcmF0b3IKICAgICAgICBpbXBsZW1lbnRz\nIENvbXBhcmF0b3IgewoKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoT2Jq\nZWN0IG8xLCBPYmplY3QgbzIpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQxID0gKEZpZWxkTWV0YURhdGEpIG8xOwogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZDIgPSAoRmllbGRNZXRhRGF0YSkgbzI7CiAgICAgICAg\nICAgIGlmIChmbWQxLmdldExpc3RpbmdJbmRleCgpICE9IGZtZDIuZ2V0TGlz\ndGluZ0luZGV4KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZm1kMS5nZXRM\naXN0aW5nSW5kZXgoKSAtIGZtZDIuZ2V0TGlzdGluZ0luZGV4KCk7CiAgICAg\nICAgICAgIGlmIChmbWQxLmlzUHJpbWFyeUtleSgpKSB7CiAgICAgICAgICAg\nICAgICBpZiAoZm1kMi5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZm1kMS5jb21wYXJlVG8oZm1kMik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGZtZDIuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nMTsKCiAgICAgICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3QxID0gZm1k\nMS5pc1ZlcnNpb24oKSA/IG51bGwgOgogICAgICAgICAgICAgICAgZ2V0U3Ry\nYXRlZ3koZm1kMSk7CiAgICAgICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kg\nc3QyID0gZm1kMi5pc1ZlcnNpb24oKSA/IG51bGwgOgogICAgICAgICAgICAg\nICAgZ2V0U3RyYXRlZ3koZm1kMik7CiAgICAgICAgICAgIGlmIChmbWQxLmlz\nVmVyc2lvbigpKSB7CiAgICAgICAgICAgICAgICBpZiAoZm1kMi5pc1ZlcnNp\nb24oKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm1kMS5jb21wYXJl\nVG8gKGZtZDIpOwoJCQkJcmV0dXJuIHN0MiA9PSBQZXJzaXN0ZW5jZVN0cmF0\nZWd5LkJBU0lDID8gMSA6IC0xOwoJCQl9CgkJCWlmIChmbWQyLmlzVmVyc2lv\nbiAoKSkKCQkJCXJldHVybiBzdDEgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5C\nQVNJQyA/IC0xIDogMTsKCQkJcmV0dXJuIHN0MS5jb21wYXJlVG8gKHN0Mik7\nCgkJfQoJfQp9Cg==\n","encoding":"base64"}

