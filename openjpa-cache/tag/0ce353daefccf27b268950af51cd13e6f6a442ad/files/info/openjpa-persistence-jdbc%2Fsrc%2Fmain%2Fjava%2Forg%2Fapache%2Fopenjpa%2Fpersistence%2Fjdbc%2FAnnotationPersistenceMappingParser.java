{"sha":"e3f1c8186c4482d4cc60e69f1d89f5fcaf1a79bc","node_id":"MDQ6QmxvYjIwNjM2NDplM2YxYzgxODZjNDQ4MmQ0Y2M2MGU2OWYxZDg5ZjVmY2FmMWE3OWJj","size":50327,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e3f1c8186c4482d4cc60e69f1d89f5fcaf1a79bc","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5wZXJzaXN0ZW5jZS5qZGJjOwoKaW1wb3J0IGphdmEubGFuZy5h\nbm5vdGF0aW9uLkFubm90YXRpb247CmltcG9ydCBqYXZhLmxhbmcucmVmbGVj\ndC5Bbm5vdGF0ZWRFbGVtZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuQXNzb2NpYXRpb25PdmVycmlkZTsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLkFzc29jaWF0aW9uT3ZlcnJpZGVzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuQXR0cmlidXRlT3ZlcnJpZGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5BdHRyaWJ1dGVPdmVycmlkZXM7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5Db2x1bW5SZXN1bHQ7CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5EaXNjcmltaW5hdG9yQ29sdW1uOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRGlzY3JpbWluYXRvclZhbHVlOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuRW50aXR5UmVzdWx0OwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW51bVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnVtZXJh\ndGVkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRmllbGRSZXN1bHQ7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Jbmhlcml0YW5jZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLkpvaW5Db2x1bW47CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5Kb2luQ29sdW1uczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNl\nLkpvaW5UYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByaW1hcnlL\nZXlKb2luQ29sdW1uOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJpbWFy\neUtleUpvaW5Db2x1bW5zOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU2Vj\nb25kYXJ5VGFibGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TZWNvbmRh\ncnlUYWJsZXM7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5TcWxSZXN1bHRT\nZXRNYXBwaW5nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuU3FsUmVzdWx0\nU2V0TWFwcGluZ3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5UYWJsZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlRhYmxlR2VuZXJhdG9yOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuVGVtcG9yYWw7CgppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hN\nb2RlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xh\nc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5DbGFzc01hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLk1hcHBpbmdJbmZvOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuUXVlcnlSZXN1bHRNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5TZXF1\nZW5jZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5t\nZXRhLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLm1ldGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuc3RyYXRzLkVudW1WYWx1ZUhhbmRsZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5GbGF0\nQ2xhc3NTdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkZ1bGxDbGFzc1N0cmF0ZWd5OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJhdHMuVmVydGljYWxDbGFzc1N0\ncmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxv\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRh\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZS5Bbm5v\ndGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0YVBhcnNlcjsKaW1wb3J0IHN0YXRp\nYyBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuamRiYy5NYXBwaW5n\nVGFnLio7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5h\nbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1l\ndGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CgovKioKICogUGVyc2lzdGVuY2Ug\nYW5ub3RhdGlvbiBtYXBwaW5nIHBhcnNlci4KICoKICogQGF1dGhvciBQaW5h\na2kgUG9kZGFyCiAqIEBhdXRob3IgU3RldmUgS2ltCiAqIEBhdXRob3IgQWJl\nIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNl\nTWFwcGluZ1BhcnNlcgogICAgZXh0ZW5kcyBBbm5vdGF0aW9uUGVyc2lzdGVu\nY2VNZXRhRGF0YVBhcnNlciB7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5h\nbCBpbnQgVFJVRSA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGlu\ndCBGQUxTRSA9IDI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChBbm5v\ndGF0aW9uUGVyc2lzdGVuY2VNYXBwaW5nUGFyc2VyLmNsYXNzKTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBNYXA8Q2xhc3MsIE1hcHBpbmdUYWc+IF90\nYWdzID0KICAgICAgICBuZXcgSGFzaE1hcDxDbGFzcywgTWFwcGluZ1RhZz4o\nKTsKCiAgICBzdGF0aWMgewogICAgICAgIF90YWdzLnB1dChBc3NvY2lhdGlv\nbk92ZXJyaWRlLmNsYXNzLCBBU1NPQ19PVkVSUklERSk7CiAgICAgICAgX3Rh\nZ3MucHV0KEFzc29jaWF0aW9uT3ZlcnJpZGVzLmNsYXNzLCBBU1NPQ19PVkVS\nUklERVMpOwogICAgICAgIF90YWdzLnB1dChBdHRyaWJ1dGVPdmVycmlkZS5j\nbGFzcywgQVRUUl9PVkVSUklERSk7CiAgICAgICAgX3RhZ3MucHV0KEF0dHJp\nYnV0ZU92ZXJyaWRlcy5jbGFzcywgQVRUUl9PVkVSUklERVMpOwogICAgICAg\nIF90YWdzLnB1dChqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4uY2xhc3MsIENP\nTCk7CiAgICAgICAgX3RhZ3MucHV0KENvbHVtblJlc3VsdC5jbGFzcywgQ09M\nVU1OX1JFU1VMVCk7CiAgICAgICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0b3JD\nb2x1bW4uY2xhc3MsIERJU0NSSU1fQ09MKTsKICAgICAgICBfdGFncy5wdXQo\nRGlzY3JpbWluYXRvclZhbHVlLmNsYXNzLCBESVNDUklNX1ZBTCk7CiAgICAg\nICAgX3RhZ3MucHV0KEVudGl0eVJlc3VsdC5jbGFzcywgRU5USVRZX1JFU1VM\nVCk7CiAgICAgICAgX3RhZ3MucHV0KEVudW1lcmF0ZWQuY2xhc3MsIEVOVU1F\nUkFURUQpOwogICAgICAgIF90YWdzLnB1dChGaWVsZFJlc3VsdC5jbGFzcywg\nRklFTERfUkVTVUxUKTsKICAgICAgICBfdGFncy5wdXQoSW5oZXJpdGFuY2Uu\nY2xhc3MsIElOSEVSSVRBTkNFKTsKICAgICAgICBfdGFncy5wdXQoSm9pbkNv\nbHVtbi5jbGFzcywgSk9JTl9DT0wpOwogICAgICAgIF90YWdzLnB1dChKb2lu\nQ29sdW1ucy5jbGFzcywgSk9JTl9DT0xTKTsKICAgICAgICBfdGFncy5wdXQo\nSm9pblRhYmxlLmNsYXNzLCBKT0lOX1RBQkxFKTsKICAgICAgICBfdGFncy5w\ndXQoUHJpbWFyeUtleUpvaW5Db2x1bW4uY2xhc3MsIFBLX0pPSU5fQ09MKTsK\nICAgICAgICBfdGFncy5wdXQoUHJpbWFyeUtleUpvaW5Db2x1bW5zLmNsYXNz\nLCBQS19KT0lOX0NPTFMpOwogICAgICAgIF90YWdzLnB1dChTZWNvbmRhcnlU\nYWJsZS5jbGFzcywgU0VDT05EQVJZX1RBQkxFKTsKICAgICAgICBfdGFncy5w\ndXQoU2Vjb25kYXJ5VGFibGVzLmNsYXNzLCBTRUNPTkRBUllfVEFCTEVTKTsK\nICAgICAgICBfdGFncy5wdXQoU3FsUmVzdWx0U2V0TWFwcGluZy5jbGFzcywg\nU1FMX1JFU1VMVF9TRVRfTUFQUElORyk7CiAgICAgICAgX3RhZ3MucHV0KFNx\nbFJlc3VsdFNldE1hcHBpbmdzLmNsYXNzLCBTUUxfUkVTVUxUX1NFVF9NQVBQ\nSU5HUyk7CiAgICAgICAgX3RhZ3MucHV0KFRhYmxlLmNsYXNzLCBUQUJMRSk7\nCiAgICAgICAgX3RhZ3MucHV0KFRlbXBvcmFsLmNsYXNzLCBURU1QT1JBTCk7\nCiAgICAgICAgX3RhZ3MucHV0KFRhYmxlR2VuZXJhdG9yLmNsYXNzLCBUQUJM\nRV9HRU4pOwogICAgICAgIF90YWdzLnB1dChDbGFzc0NyaXRlcmlhLmNsYXNz\nLCBDTEFTU19DUklUKTsKICAgICAgICBfdGFncy5wdXQoQ29sdW1ucy5jbGFz\ncywgQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0KENvbnRhaW5lclRhYmxlLmNs\nYXNzLCBDT05UQUlORVJfVEFCTEUpOwogICAgICAgIF90YWdzLnB1dChEYXRh\nU3RvcmVJZENvbHVtbi5jbGFzcywgREFUQVNUT1JFX0lEX0NPTCk7CiAgICAg\nICAgX3RhZ3MucHV0KERpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzcywgRElT\nQ1JJTV9TVFJBVCk7CiAgICAgICAgX3RhZ3MucHV0KEVhZ2VyRmV0Y2hNb2Rl\nLmNsYXNzLCBFQUdFUl9GRVRDSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQo\nRWxlbWVudENsYXNzQ3JpdGVyaWEuY2xhc3MsIEVMRU1fQ0xBU1NfQ1JJVCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVsZW1lbnRGb3JlaWduS2V5LmNsYXNzLCBF\nTEVNX0ZLKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEluZGV4LmNsYXNz\nLCBFTEVNX0lOREVYKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudEpvaW5D\nb2x1bW4uY2xhc3MsIEVMRU1fSk9JTl9DT0wpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50Sm9pbkNvbHVtbnMuY2xhc3MsIEVMRU1fSk9JTl9DT0xTKTsK\nICAgICAgICBfdGFncy5wdXQoRWxlbWVudE5vbnBvbHltb3JwaGljLmNsYXNz\nLCBFTEVNX05PTlBPTFkpOwogICAgICAgIF90YWdzLnB1dChFbWJlZGRlZE1h\ncHBpbmcuY2xhc3MsIEVNQkVEREVEX01BUFBJTkcpOwogICAgICAgIF90YWdz\nLnB1dChGb3JlaWduS2V5LmNsYXNzLCBGSyk7CiAgICAgICAgX3RhZ3MucHV0\nKEluZGV4LmNsYXNzLCBJTkRFWCk7CiAgICAgICAgX3RhZ3MucHV0KE1hcHBp\nbmdPdmVycmlkZS5jbGFzcywgTUFQUElOR19PVkVSUklERSk7CiAgICAgICAg\nX3RhZ3MucHV0KE1hcHBpbmdPdmVycmlkZXMuY2xhc3MsIE1BUFBJTkdfT1ZF\nUlJJREVTKTsKICAgICAgICBfdGFncy5wdXQoTm9ucG9seW1vcnBoaWMuY2xh\nc3MsIE5PTlBPTFkpOwogICAgICAgIF90YWdzLnB1dChPcmRlckNvbHVtbi5j\nbGFzcywgT1JERVJfQ09MKTsKICAgICAgICBfdGFncy5wdXQoU3RyYXRlZ3ku\nY2xhc3MsIFNUUkFUKTsKICAgICAgICBfdGFncy5wdXQoU3ViY2xhc3NGZXRj\naE1vZGUuY2xhc3MsIFNVQkNMQVNTX0ZFVENIX01PREUpOwogICAgICAgIF90\nYWdzLnB1dChVbmlxdWUuY2xhc3MsIFVOSVFVRSk7CiAgICAgICAgX3RhZ3Mu\ncHV0KFZlcnNpb25Db2x1bW4uY2xhc3MsIFZFUlNJT05fQ09MKTsKICAgICAg\nICBfdGFncy5wdXQoVmVyc2lvbkNvbHVtbnMuY2xhc3MsIFZFUlNJT05fQ09M\nUyk7CiAgICAgICAgX3RhZ3MucHV0KFZlcnNpb25TdHJhdGVneS5jbGFzcywg\nVkVSU0lPTl9TVFJBVCk7CiAgICAgICAgX3RhZ3MucHV0KFhKb2luQ29sdW1u\nLmNsYXNzLCBYX0pPSU5fQ09MKTsKICAgICAgICBfdGFncy5wdXQoWEpvaW5D\nb2x1bW5zLmNsYXNzLCBYX0pPSU5fQ09MUyk7CiAgICAgICAgX3RhZ3MucHV0\nKFhTZWNvbmRhcnlUYWJsZS5jbGFzcywgWF9TRUNPTkRBUllfVEFCTEUpOwog\nICAgICAgIF90YWdzLnB1dChYU2Vjb25kYXJ5VGFibGVzLmNsYXNzLCBYX1NF\nQ09OREFSWV9UQUJMRVMpOwogICAgICAgIF90YWdzLnB1dChYVGFibGUuY2xh\nc3MsIFhfVEFCTEUpOwogICAgfQoKICAgIHB1YmxpYyBBbm5vdGF0aW9uUGVy\nc2lzdGVuY2VNYXBwaW5nUGFyc2VyKEpEQkNDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBzdXBlcihjb25mKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlUGFja2FnZU1hcHBpbmdBbm5vdGF0\naW9ucyhQYWNrYWdlIHBrZykgewogICAgICAgIE1hcHBpbmdUYWcgdGFnOwog\nICAgICAgIGZvciAoQW5ub3RhdGlvbiBhbm5vIDogcGtnLmdldERlY2xhcmVk\nQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQo\nYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duUGFja2Fn\nZU1hcHBpbmdBbm5vdGF0aW9uKHBrZywgYW5ubyk7CiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3dpdGNo\nICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEVfR0VOOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlVGFibGVHZW5lcmF0b3IocGtnLCAoVGFi\nbGVHZW5lcmF0b3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVu\nc3VwcG9ydGVkIiwgcGtnLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5v\nLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVu\na25vd24gYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29s\nZWFuIGhhbmRsZVVua25vd25QYWNrYWdlTWFwcGluZ0Fubm90YXRpb24oUGFj\na2FnZSBwa2csCiAgICAgICAgQW5ub3RhdGlvbiBhbm5vKSB7CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFRh\nYmxlR2VuZXJhdG9yLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VU\nYWJsZUdlbmVyYXRvcihBbm5vdGF0ZWRFbGVtZW50IGVsLCBUYWJsZUdlbmVy\nYXRvciBnZW4pIHsKICAgICAgICBTdHJpbmcgbmFtZSA9IGdlbi5uYW1lKCk7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tZ2VuLW5hbWUiLCBlbCkpOwoKICAgICAgICBMb2cgbG9nID0gZ2V0TG9n\nKCk7CiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAg\nICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJwYXJzZS1nZW4iLCBuYW1lKSk7Cgog\nICAgICAgIFNlcXVlbmNlTWFwcGluZyBtZXRhID0gKFNlcXVlbmNlTWFwcGlu\nZykgZ2V0UmVwb3NpdG9yeSgpLgogICAgICAgICAgICBnZXRDYWNoZWRTZXF1\nZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiZHVwLWdlbiIsIG5hbWUs\nIGVsKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIG1ldGEgPSAoU2VxdWVuY2VNYXBwaW5nKSBnZXRSZXBvc2l0b3J5KCkuYWRk\nU2VxdWVuY2VNZXRhRGF0YShuYW1lKTsKICAgICAgICBtZXRhLnNldFNlcXVl\nbmNlUGx1Z2luKFNlcXVlbmNlTWFwcGluZy5JTVBMX1ZBTFVFX1RBQkxFKTsK\nICAgICAgICBtZXRhLnNldFRhYmxlKHRvVGFibGVOYW1lKGdlbi5zY2hlbWEo\nKSwgZ2VuLnRhYmxlKCkpKTsKICAgICAgICBtZXRhLnNldFByaW1hcnlLZXlD\nb2x1bW4oZ2VuLnBrQ29sdW1uTmFtZSgpKTsKICAgICAgICBtZXRhLnNldFNl\ncXVlbmNlQ29sdW1uKGdlbi52YWx1ZUNvbHVtbk5hbWUoKSk7CiAgICAgICAg\nbWV0YS5zZXRQcmltYXJ5S2V5VmFsdWUoZ2VuLnBrQ29sdW1uVmFsdWUoKSk7\nCiAgICAgICAgbWV0YS5zZXRJbml0aWFsVmFsdWUoZ2VuLmluaXRpYWxWYWx1\nZSgpKTsKICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGdlbi5hbGxvY2F0aW9u\nU2l6ZSgpKTsKICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxl\nKCksIChlbCBpbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAg\nICAgICAgbWV0YS5TUkNfQU5OT1RBVElPTlMpOwoKICAgICAgICAvLyMjIyBF\nSkIzCiAgICAgICAgaWYgKGdlbi51bmlxdWVDb25zdHJhaW50cygpLmxlbmd0\naCA+IDAgJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoInVuaXF1ZS1jb25zdHJhaW50cyIsIG5hbWUpKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIGNtID0gKENsYXNzTWFwcGluZykgbWV0\nYTsKICAgICAgICBDbGFzcyBjbHMgPSBjbS5nZXREZXNjcmliZWRUeXBlKCk7\nCgogICAgICAgIE1hcHBpbmdUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3Rh\ndGlvbiBhbm5vIDogY2xzLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewog\nICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlw\nZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBoYW5kbGVVbmtub3duQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbihj\nbSwgYW5ubyk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAg\nICAgIGNhc2UgQVNTT0NfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRlcyhjbSwgKEFzc29jaWF0aW9uT3Zl\ncnJpZGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBBU1NPQ19PVkVSUklERVM6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRlcyhjbSwgKChBc3Nv\nY2lhdGlvbk92ZXJyaWRlcykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAg\nICAgIHZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBBVFRSX09WRVJSSURFOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlQXR0cmlidXRlT3ZlcnJpZGVzKGNtLCAoQXR0cmlidXRl\nT3ZlcnJpZGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBBVFRSX09WRVJSSURFUzoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZUF0dHJpYnV0ZU92ZXJyaWRlcyhjbSwgKChBdHRy\naWJ1dGVPdmVycmlkZXMpIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAg\nICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgRElTQ1JJTV9DT0w6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VEaXNjcmltaW5hdG9yQ29sdW1uKGNtLCAoRGlzY3JpbWluYXRv\nckNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIERJU0NSSU1fVkFMOgogICAgICAgICAgICAg\nICAgICAgIGNtLmdldERpc2NyaW1pbmF0b3IoKS5nZXRNYXBwaW5nSW5mbygp\nLnNldFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICgoKERpc2NyaW1p\nbmF0b3JWYWx1ZSkgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElOSEVSSVRBTkNFOgog\nICAgICAgICAgICAgICAgICAgIHBhcnNlSW5oZXJpdGFuY2UoY20sIChJbmhl\ncml0YW5jZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFBLX0pPSU5fQ09MOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5zKGNtLCAoUHJpbWFy\neUtleUpvaW5Db2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQS19KT0lOX0NPTFM6CiAgICAg\nICAgICAgICAgICAgICAgcGFyc2VQcmltYXJ5S2V5Sm9pbkNvbHVtbnMoY20s\nCiAgICAgICAgICAgICAgICAgICAgICAgICgoUHJpbWFyeUtleUpvaW5Db2x1\nbW5zKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBTRUNPTkRBUllfVEFCTEU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VTZWNvbmRhcnlUYWJsZXMoY20sIChTZWNvbmRhcnlUYWJsZSkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIFNFQ09OREFSWV9UQUJMRVM6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VTZWNvbmRhcnlUYWJsZXMoY20sICgoU2Vjb25kYXJ5VGFibGVzKSBh\nbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgU1FMX1JFU1VMVF9TRVRfTUFQUElORzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZVNRTFJlc3VsdFNldE1hcHBpbmdzKGNt\nLCAoU3FsUmVzdWx0U2V0TWFwcGluZykgYW5ubyk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNRTF9SRVNVTFRf\nU0VUX01BUFBJTkdTOgogICAgICAgICAgICAgICAgICAgIHBhcnNlU1FMUmVz\ndWx0U2V0TWFwcGluZ3MoY20sICgoU3FsUmVzdWx0U2V0TWFwcGluZ3MpIGFu\nbm8pLgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVEFC\nTEU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VUYWJsZShjbSwgKFRhYmxl\nKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgVEFCTEVfR0VOOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlVGFibGVHZW5lcmF0b3IoY2xzLCAoVGFibGVHZW5lcmF0b3IpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBEQVRBU1RPUkVfSURfQ09MOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlRGF0YVN0b3JlSWRDb2x1bW4oY20sIChEYXRhU3RvcmVJZENvbHVtbikg\nYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIERJU0NSSU1fU1RSQVQ6CiAgICAgICAgICAgICAgICAgICAg\nY20uZ2V0RGlzY3JpbWluYXRvcigpLmdldE1hcHBpbmdJbmZvKCkuc2V0U3Ry\nYXRlZ3kKICAgICAgICAgICAgICAgICAgICAgICAgKCgoRGlzY3JpbWluYXRv\nclN0cmF0ZWd5KSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRks6CiAgICAgICAgICAg\nICAgICAgICAgcGFyc2VGb3JlaWduS2V5KGNtLmdldE1hcHBpbmdJbmZvKCks\nIChGb3JlaWduS2V5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgTUFQUElOR19PVkVSUklERToKICAg\nICAgICAgICAgICAgICAgICBwYXJzZU1hcHBpbmdPdmVycmlkZXMoY20sIChN\nYXBwaW5nT3ZlcnJpZGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBNQVBQSU5HX09WRVJSSURFUzoK\nICAgICAgICAgICAgICAgICAgICBwYXJzZU1hcHBpbmdPdmVycmlkZXMoY20s\nCiAgICAgICAgICAgICAgICAgICAgICAgICgoTWFwcGluZ092ZXJyaWRlcykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFNUUkFUOgogICAgICAgICAgICAgICAgICAg\nIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0U3RyYXRlZ3koKChTdHJhdGVneSkg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFNVQkNMQVNTX0ZFVENIX01PREU6CiAgICAg\nICAgICAgICAgICAgICAgY20uc2V0U3ViY2xhc3NGZXRjaE1vZGUodG9FYWdl\nckZldGNoTW9kZUNvbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgo\nKFN1YmNsYXNzRmV0Y2hNb2RlKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFZFUlNJ\nT05fQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVmVyc2lvbkNvbHVt\nbnMoY20sIChWZXJzaW9uQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVkVSU0lPTl9DT0xT\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVmVyc2lvbkNvbHVtbnMoY20s\nICgoVmVyc2lvbkNvbHVtbnMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBWRVJTSU9O\nX1NUUkFUOgogICAgICAgICAgICAgICAgICAgIGNtLmdldFZlcnNpb24oKS5n\nZXRNYXBwaW5nSW5mbygpLnNldFN0cmF0ZWd5CiAgICAgICAgICAgICAgICAg\nICAgICAgICgoKFZlcnNpb25TdHJhdGVneSkgYW5ubykudmFsdWUoKSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFhfVEFCTEU6CiAgICAgICAgICAgICAgICBjYXNlIFhfU0VDT05EQVJZX1RB\nQkxFOgogICAgICAgICAgICAgICAgY2FzZSBYX1NFQ09OREFSWV9UQUJMRVM6\nCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWs7IG5vdCBzdXBwb3J0\nZWQgeWV0CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdl\ndCgidW5zdXBwb3J0ZWQiLCBjbSwKICAgICAgICAgICAgICAgICAgICAgICAg\nYW5ubykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5rbm93biBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaGFu\nZGxlVW5rbm93bkNsYXNzTWFwcGluZ0Fubm90YXRpb24oQ2xhc3NNYXBwaW5n\nIGNscywKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAQXNzb2Np\nYXRpb25PdmVycmlkZShzKS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlQXNzb2NpYXRpb25PdmVycmlkZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAg\nICAgIEFzc29jaWF0aW9uT3ZlcnJpZGUuLi4gYXNzb2NzKSB7CiAgICAgICAg\nRmllbGRNYXBwaW5nIHN1cDsKICAgICAgICBKb2luQ29sdW1uW10gc2NvbHM7\nCiAgICAgICAgaW50IHVuaXF1ZTsKICAgICAgICBMaXN0PENvbHVtbj4gamNv\nbHM7CiAgICAgICAgZm9yIChBc3NvY2lhdGlvbk92ZXJyaWRlIGFzc29jIDog\nYXNzb2NzKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5\nKGFzc29jLm5hbWUoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW92ZXJyaWRlLW5hbWUiLCBj\nbSkpOwogICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBjbS5nZXRE\nZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKGFzc29jLm5hbWUoKSk7CiAgICAgICAg\nICAgIGlmIChzdXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN1cCA9IChG\naWVsZE1hcHBpbmcpIGNtLmFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQKICAg\nICAgICAgICAgICAgICAgICAoYXNzb2MubmFtZSgpLCBPYmplY3QuY2xhc3Ms\nIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIHNjb2xzID0gYXNzb2Muam9p\nbkNvbHVtbnMoKTsKICAgICAgICAgICAgaWYgKHNjb2xzID09IG51bGwgfHwg\nc2NvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIGpjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHNj\nb2xzLmxlbmd0aCk7CiAgICAgICAgICAgIHVuaXF1ZSA9IDA7CiAgICAgICAg\nICAgIGZvciAoSm9pbkNvbHVtbiBzY29sIDogc2NvbHMpIHsKICAgICAgICAg\nICAgICAgIHVuaXF1ZSB8PSAoc2NvbC51bmlxdWUoKSkgPyBUUlVFIDogRkFM\nU0U7CiAgICAgICAgICAgICAgICBqY29scy5hZGQobmV3Q29sdW1uKHNjb2wp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRDb2x1bW5zKHN1cCwg\nc3VwLmdldFZhbHVlSW5mbygpLCBqY29scywgdW5pcXVlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAQXR0cmlidXRlT3ZlcnJp\nZGUocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUF0dHJpYnV0\nZU92ZXJyaWRlcyhDbGFzc01hcHBpbmcgY20sCiAgICAgICAgQXR0cmlidXRl\nT3ZlcnJpZGUuLi4gYXR0cnMpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgc3Vw\nOwogICAgICAgIGphdmF4LnBlcnNpc3RlbmNlLkNvbHVtbiBzY29sOwogICAg\nICAgIGludCB1bmlxdWU7CiAgICAgICAgZm9yIChBdHRyaWJ1dGVPdmVycmlk\nZSBhdHRyIDogYXR0cnMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkoYXR0ci5uYW1lKCkpKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1vdmVycmlkZS1u\nYW1lIiwgY20pKTsKICAgICAgICAgICAgc3VwID0gKEZpZWxkTWFwcGluZykg\nY20uZ2V0RGVmaW5lZFN1cGVyY2xhc3NGaWVsZChhdHRyLm5hbWUoKSk7CiAg\nICAgICAgICAgIGlmIChzdXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN1\ncCA9IChGaWVsZE1hcHBpbmcpIGNtLmFkZERlZmluZWRTdXBlcmNsYXNzRmll\nbGQoYXR0ci5uYW1lKCksCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNs\nYXNzLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBzY29sID0gYXR0ci5j\nb2x1bW4oKTsKICAgICAgICAgICAgaWYgKHNjb2wgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgdW5pcXVlID0gKHNj\nb2wudW5pcXVlKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgICAgICBzZXRD\nb2x1bW5zKHN1cCwgc3VwLmdldFZhbHVlSW5mbygpLCBBcnJheXMuYXNMaXN0\nCiAgICAgICAgICAgICAgICAobmV3IENvbHVtbltdeyBuZXdDb2x1bW4oc2Nv\nbCkgfSksIHVuaXF1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgaW5oZXJpdGFuY2UgQFByaW1hcnlLZXlKb2luQ29sdW1uKHMp\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VQcmltYXJ5S2V5Sm9p\nbkNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIFByaW1hcnlLZXlK\nb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAgTGlzdDxDb2x1bW4+IGNv\nbHMgPSBuZXcgQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsKICAg\nICAgICBmb3IgKFByaW1hcnlLZXlKb2luQ29sdW1uIGpvaW4gOiBqb2lucykK\nICAgICAgICAgICAgY29scy5hZGQobmV3Q29sdW1uKGpvaW4pKTsKICAgICAg\nICBjbS5nZXRNYXBwaW5nSW5mbygpLnNldENvbHVtbnMoY29scyk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3\naXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oUHJp\nbWFyeUtleUpvaW5Db2x1bW4gam9pbikgewogICAgICAgIENvbHVtbiBjb2wg\nPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZM\nQUdfUEtfSk9JTiwgdHJ1ZSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5p\nc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUo\nam9pbi5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5z\nZXROYW1lKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFt\nZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldChqb2luLnJlZmVyZW5j\nZWRDb2x1bW5OYW1lKCkpOwogICAgICAgIHJldHVybiBjb2w7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBAU2Vjb25kYXJ5VGFibGUocykuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVNlY29uZGFyeVRhYmxlcyhDbGFz\nc01hcHBpbmcgY20sCiAgICAgICAgU2Vjb25kYXJ5VGFibGUuLi4gdGFibGVz\nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gY20uZ2V0TWFw\ncGluZ0luZm8oKTsKICAgICAgICBMb2cgbG9nID0gZ2V0TG9nKCk7CgogICAg\nICAgIFN0cmluZyBuYW1lOwogICAgICAgIExpc3Q8Q29sdW1uPiBqb2luczsK\nICAgICAgICBib29sZWFuIHdhcm5VbmlxdWUgPSBmYWxzZTsKICAgICAgICBm\nb3IgKFNlY29uZGFyeVRhYmxlIHRhYmxlIDogdGFibGVzKSB7CiAgICAgICAg\nICAgIG5hbWUgPSB0YWJsZS5uYW1lKCk7CiAgICAgICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KG5hbWUpKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJzZWNvbmQtbmFtZSIs\nIGNtKSk7CiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eSh0\nYWJsZS5zY2hlbWEoKSkpCiAgICAgICAgICAgICAgICBuYW1lID0gdGFibGUu\nc2NoZW1hKCkgKyAiLiIgKyBuYW1lOwogICAgICAgICAgICBpZiAodGFibGUu\ncGtKb2luQ29sdW1ucygpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAg\nIGpvaW5zID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KHRhYmxlLnBrSm9pbkNv\nbHVtbnMoKS5sZW5ndGgpOwogICAgICAgICAgICAgICAgZm9yIChQcmltYXJ5\nS2V5Sm9pbkNvbHVtbiBqb2luIDogdGFibGUucGtKb2luQ29sdW1ucygpKQog\nICAgICAgICAgICAgICAgICAgIGpvaW5zLmFkZChuZXdDb2x1bW4oam9pbikp\nOwogICAgICAgICAgICAgICAgaW5mby5zZXRTZWNvbmRhcnlUYWJsZUpvaW5D\nb2x1bW5zKG5hbWUsIGpvaW5zKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICB3YXJuVW5pcXVlIHw9IHRhYmxlLnVuaXF1ZUNvbnN0cmFpbnRzKCkubGVu\nZ3RoID4gMDsKICAgICAgICB9CgogICAgICAgIC8vIyMjIEVKQjMKICAgICAg\nICBpZiAod2FyblVuaXF1ZSAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldCgidW5pcXVlLWNvbnN0cmFpbnRz\nIiwgY20pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBjbGFzcyB0YWJs\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVGFibGUoQ2xhc3NN\nYXBwaW5nIGNtLCBUYWJsZSB0YWJsZSkgewogICAgICAgIFN0cmluZyB0YWJs\nZU5hbWUgPSB0b1RhYmxlTmFtZSh0YWJsZS5zY2hlbWEoKSwgdGFibGUubmFt\nZSgpKTsKICAgICAgICBpZiAodGFibGVOYW1lICE9IG51bGwpCiAgICAgICAg\nICAgIGNtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVOYW1lKHRhYmxlTmFt\nZSk7CgogICAgICAgIC8vIyMjIEVKQjMKICAgICAgICBMb2cgbG9nID0gZ2V0\nTG9nKCk7CiAgICAgICAgaWYgKHRhYmxlLnVuaXF1ZUNvbnN0cmFpbnRzKCku\nbGVuZ3RoID4gMCAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldCgidW5pcXVlLWNvbnN0cmFpbnRzIiwgY20p\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcm0gYSBxdWFsaWZpZWQgdGFi\nbGUgbmFtZSBmcm9tIGEgc2NoZW1hIGFuZCB0YWJsZSBuYW1lLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgdG9UYWJsZU5hbWUoU3RyaW5n\nIHNjaGVtYSwgU3RyaW5nIHRhYmxlKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0\naWxzLmlzRW1wdHkodGFibGUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzY2hlbWEpKQogICAg\nICAgICAgICByZXR1cm4gdGFibGU7CiAgICAgICAgcmV0dXJuIHNjaGVtYSAr\nICIuIiArIHRhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2VzIHRo\nZSBnaXZlbiBhbm5vdGF0aW9uIHRvIGNyZWF0ZSBhbmQgY2FjaGUgYQogICAg\nICoge0BsaW5rIFNRTFJlc3VsdFNldE1hcHBpbmdNZXRhRGF0YX0uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVNRTFJlc3VsdFNldE1hcHBpbmdz\nKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBTcWxSZXN1bHRTZXRNYXBwaW5n\nLi4uIGFubm9zKSB7CiAgICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3Mg\nPSAoTWFwcGluZ1JlcG9zaXRvcnkpIGdldFJlcG9zaXRvcnkoKTsKICAgICAg\nICBMb2cgbG9nID0gZ2V0TG9nKCk7CiAgICAgICAgZm9yIChTcWxSZXN1bHRT\nZXRNYXBwaW5nIGFubm8gOiBhbm5vcykgewogICAgICAgICAgICBpZiAobG9n\nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJwYXJzZS1zcWxyc21hcHBpbmciLCBhbm5vLm5hbWUoKSkpOwoK\nICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nIHJlc3VsdCA9IHJlcG9z\nLmdldENhY2hlZFF1ZXJ5UmVzdWx0TWFwcGluZwogICAgICAgICAgICAgICAg\nKG51bGwsIGFubm8ubmFtZSgpKTsKICAgICAgICAgICAgaWYgKHJlc3VsdCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgi\nZHVwLXNxbHJzbWFwcGluZyIsIGFubm8ubmFtZSgpLCBjbSkpOwogICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHJlc3VsdCA9IHJlcG9zLmFkZFF1ZXJ5UmVzdWx0TWFwcGluZyhudWxsLCBh\nbm5vLm5hbWUoKSk7CiAgICAgICAgICAgIHJlc3VsdC5zZXRTb3VyY2UoZ2V0\nU291cmNlRmlsZSgpLCBjbS5nZXREZXNjcmliZWRUeXBlKCksCiAgICAgICAg\nICAgICAgICByZXN1bHQuU1JDX0FOTk9UQVRJT05TKTsKCiAgICAgICAgICAg\nIGZvciAoRW50aXR5UmVzdWx0IGVudGl0eSA6IGFubm8uZW50aXRpZXMoKSkg\newogICAgICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nLlBDUmVzdWx0\nIGVudGl0eVJlc3VsdCA9IHJlc3VsdC5hZGRQQ1Jlc3VsdAogICAgICAgICAg\nICAgICAgICAgIChlbnRpdHkuZW50aXR5Q2xhc3MoKSk7CiAgICAgICAgICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoZW50aXR5LmRpc2NyaW1p\nbmF0b3JDb2x1bW4oKSkpCiAgICAgICAgICAgICAgICAgICAgZW50aXR5UmVz\ndWx0LmFkZE1hcHBpbmcoZW50aXR5UmVzdWx0LkRJU0NSSU1JTkFUT1IsCiAg\nICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5kaXNjcmltaW5hdG9yQ29s\ndW1uKCkpOwoKICAgICAgICAgICAgICAgIGZvciAoRmllbGRSZXN1bHQgZmll\nbGQgOiBlbnRpdHkuZmllbGRzKCkpCiAgICAgICAgICAgICAgICAgICAgZW50\naXR5UmVzdWx0LmFkZE1hcHBpbmcoZmllbGQubmFtZSgpLCBmaWVsZC5jb2x1\nbW4oKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChDb2x1bW5S\nZXN1bHQgY29sdW1uIDogYW5uby5jb2x1bW5zKCkpCiAgICAgICAgICAgICAg\nICByZXN1bHQuYWRkQ29sdW1uUmVzdWx0KGNvbHVtbi5uYW1lKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBEaXNjcmltaW5h\ndG9yQ29sdW1uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEaXNj\ncmltaW5hdG9yQ29sdW1uKENsYXNzTWFwcGluZyBjbSwKICAgICAgICBEaXNj\ncmltaW5hdG9yQ29sdW1uIGRjb2wpIHsKICAgICAgICBDb2x1bW4gY29sID0g\nbmV3IENvbHVtbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShkY29sLm5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1lKGRjb2wu\nbmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoZGNv\nbC5jb2x1bW5EZWZpbml0aW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlw\nZU5hbWUoZGNvbC5jb2x1bW5EZWZpbml0aW9uKCkpOwogICAgICAgIHN3aXRj\naCAoZGNvbC5kaXNjcmltaW5hdG9yVHlwZSgpKSB7CiAgICAgICAgICAgIGNh\nc2UgQ0hBUjoKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShKYXZh\nVHlwZXMuQ0hBUik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBJTlRFR0VSOgogICAgICAgICAgICAgICAgY29sLnNldEphdmFU\neXBlKEphdmFUeXBlcy5JTlQpOwogICAgICAgICAgICAgICAgaWYgKGRjb2wu\nbGVuZ3RoKCkgIT0gMzEpCiAgICAgICAgICAgICAgICAgICAgY29sLnNldFNp\nemUoZGNvbC5sZW5ndGgoKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZh\nVHlwZShKYXZhVHlwZXMuU1RSSU5HKTsKICAgICAgICAgICAgICAgIGNvbC5z\nZXRTaXplKGRjb2wubGVuZ3RoKCkpOwogICAgICAgIH0KICAgICAgICBjbS5n\nZXREaXNjcmltaW5hdG9yKCkuZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5z\nCiAgICAgICAgICAgIChBcnJheXMuYXNMaXN0KG5ldyBDb2x1bW5bXXsgY29s\nIH0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBJbmhlcml0YW5j\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlSW5oZXJpdGFuY2Uo\nQ2xhc3NNYXBwaW5nIGNtLCBJbmhlcml0YW5jZSBpbmhlcml0KSB7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nSW5mbyBpbmZvID0gY20uZ2V0TWFwcGluZ0luZm8o\nKTsKICAgICAgICBzd2l0Y2ggKGluaGVyaXQuc3RyYXRlZ3koKSkgewogICAg\nICAgICAgICBjYXNlIFNJTkdMRV9UQUJMRToKICAgICAgICAgICAgICAgIGlu\nZm8uc2V0SGllcmFyY2h5U3RyYXRlZ3koRmxhdENsYXNzU3RyYXRlZ3kuQUxJ\nQVMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSk9JTkVEOgogICAgICAgICAgICAgICAgaW5mby5zZXRIaWVyYXJjaHlTdHJh\ndGVneShWZXJ0aWNhbENsYXNzU3RyYXRlZ3kuQUxJQVMpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVEFCTEVfUEVSX0NMQVNT\nOgogICAgICAgICAgICAgICAgaW5mby5zZXRIaWVyYXJjaHlTdHJhdGVneShG\ndWxsQ2xhc3NTdHJhdGVneS5BTElBUyk7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIGNsYXNzLWxldmVsIEBNYXBwaW5nT3ZlcnJp\nZGUocykuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1hcHBpbmdP\ndmVycmlkZXMoQ2xhc3NNYXBwaW5nIGNtLAogICAgICAgIE1hcHBpbmdPdmVy\ncmlkZS4uLiBvdmVycykgewogICAgICAgIEZpZWxkTWFwcGluZyBzdXA7CiAg\nICAgICAgZm9yIChNYXBwaW5nT3ZlcnJpZGUgb3ZlciA6IG92ZXJzKSB7CiAg\nICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KG92ZXIubmFtZSgp\nKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tb3ZlcnJpZGUtbmFtZSIsIGNtKSk7CiAgICAgICAg\nICAgIHN1cCA9IChGaWVsZE1hcHBpbmcpIGNtLmdldERlZmluZWRTdXBlcmNs\nYXNzRmllbGQob3Zlci5uYW1lKCkpOwogICAgICAgICAgICBpZiAoc3VwID09\nIG51bGwpCiAgICAgICAgICAgICAgICBzdXAgPSAoRmllbGRNYXBwaW5nKSBj\nbS5hZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKG92ZXIubmFtZSgpLAogICAg\nICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzKTsK\nICAgICAgICAgICAgcG9wdWxhdGUoc3VwLCBvdmVyKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQb3B1bGF0ZSB0aGUgZ2l2ZW4gZmllbGQg\nZnJvbSBvdmVycmlkZSBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncG9wdWxhdGUoRmllbGRNYXBwaW5nIGZtLCBNYXBwaW5nT3ZlcnJpZGUgb3Zl\ncikgewogICAgICAgIGlmIChvdmVyLmNvbnRhaW5lclRhYmxlKCkuc3BlY2lm\naWVkKCkpCiAgICAgICAgICAgIHBhcnNlQ29udGFpbmVyVGFibGUoZm0sIG92\nZXIuY29udGFpbmVyVGFibGUoKSk7CiAgICAgICAgcGFyc2VDb2x1bW5zKGZt\nLCBvdmVyLmNvbHVtbnMoKSk7CiAgICAgICAgcGFyc2VYSm9pbkNvbHVtbnMo\nZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLCBvdmVyLmpvaW5Db2x1bW5z\nKCkpOwogICAgICAgIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKGZtLCBvdmVy\nLmVsZW1lbnRKb2luQ29sdW1ucygpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFBhcnNlIGRhdGFzdG9yZSBpZGVudGl0eSBpbmZvcm1hdGlvbiBpbiBARGF0\nYVN0b3JlSWRDb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZURhdGFTdG9yZUlkQ29sdW1uKENsYXNzTWFwcGluZyBjbSwgRGF0YVN0b3Jl\nSWRDb2x1bW4gaWQpIHsKICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVt\nbigpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShpZC5uYW1l\nKCkpKQogICAgICAgICAgICBjb2wuc2V0TmFtZShpZC5uYW1lKCkpOwogICAg\nICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShpZC5jb2x1bW5EZWZpbml0\naW9uKCkpKQogICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoaWQuY29sdW1u\nRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoaWQucHJlY2lzaW9uKCkgIT0g\nMCkKICAgICAgICAgICAgY29sLnNldFNpemUoaWQucHJlY2lzaW9uKCkpOwog\nICAgICAgIGNvbC5zZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwg\nIWlkLmluc2VydGFibGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1u\nLkZMQUdfVU5VUERBVEFCTEUsICFpZC51cGRhdGFibGUoKSk7CiAgICAgICAg\nY20uZ2V0TWFwcGluZ0luZm8oKS5zZXRDb2x1bW5zKEFycmF5cy5hc0xpc3Qo\nbmV3IENvbHVtbltdeyBjb2wgfSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgdGhlIGdpdmVuIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcGFyc2VGb3JlaWduS2V5KE1hcHBpbmdJbmZvIGluZm8sIEZv\ncmVpZ25LZXkgZmspIHsKICAgICAgICBwYXJzZUZvcmVpZ25LZXkoaW5mbywg\nZmsubmFtZSgpLCBmay5lbmFibGVkKCksIGZrLmRlZmVycmVkKCksCiAgICAg\nICAgICAgIGZrLmRlbGV0ZUFjdGlvbigpLCBmay51cGRhdGVBY3Rpb24oKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZm9yZWlnbiBrZXkgZGF0YSBv\nbiB0aGUgZ2l2ZW4gbWFwcGluZyBpbmZvLgogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBwYXJzZUZvcmVpZ25LZXkoTWFwcGluZ0luZm8gaW5mbywgU3Ry\naW5nIG5hbWUsCiAgICAgICAgYm9vbGVhbiBlbmFibGVkLCBib29sZWFuIGRl\nZmVycmVkLCBGb3JlaWduS2V5QWN0aW9uIGRlbGV0ZUFjdGlvbiwKICAgICAg\nICBGb3JlaWduS2V5QWN0aW9uIHVwZGF0ZUFjdGlvbikgewogICAgICAgIGlm\nICghZW5hYmxlZCkgewogICAgICAgICAgICBpbmZvLnNldENhbkZvcmVpZ25L\nZXkoZmFsc2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktl\neSBmayA9CiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleSgpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShuYW1lKSkKICAgICAgICAgICAgZmsuc2V0TmFtZShuYW1l\nKTsKICAgICAgICBmay5zZXREZWZlcnJlZChkZWZlcnJlZCk7CiAgICAgICAg\nZmsuc2V0RGVsZXRlQWN0aW9uKHRvRm9yZWlnbktleUFjdGlvbihkZWxldGVB\nY3Rpb24pKTsKICAgICAgICBmay5zZXRVcGRhdGVBY3Rpb24odG9Gb3JlaWdu\nS2V5QWN0aW9uKGRlbGV0ZUFjdGlvbikpOwogICAgICAgIGluZm8uc2V0Rm9y\nZWlnbktleShmayk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IG91\nciBGSyBhY3Rpb24gZW51bSB0byBhbiBpbnRlcm5hbCBPcGVuSlBBIGFjdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgdG9Gb3JlaWduS2V5QWN0aW9u\nKEZvcmVpZ25LZXlBY3Rpb24gYWN0aW9uKSB7CiAgICAgICAgc3dpdGNoIChh\nY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBSRVNUUklDVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nRm9yZWlnbktleS5BQ1RJT05fUkVTVFJJQ1Q7CiAgICAgICAgICAgIGNhc2Ug\nQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERTsK\nICAgICAgICAgICAgY2FzZSBOVUxMOgogICAgICAgICAgICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5LkFD\nVElPTl9OVUxMOwogICAgICAgICAgICBjYXNlIERFRkFVTFQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkZvcmVpZ25LZXkuQUNUSU9OX0RFRkFVTFQ7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSB0\naGUgZ2l2ZW4gaW5kZXguCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZUluZGV4KE1hcHBpbmdJbmZvIGluZm8sIEluZGV4IGlkeCkgewogICAgICAg\nIHBhcnNlSW5kZXgoaW5mbywgaWR4Lm5hbWUoKSwgaWR4LmVuYWJsZWQoKSwg\naWR4LnVuaXF1ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBpbmRl\neCBkYXRhIG9uIHRoZSBnaXZlbiBtYXBwaW5nIGluZm8uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHBhcnNlSW5kZXgoTWFwcGluZ0luZm8gaW5mbywg\nU3RyaW5nIG5hbWUsCiAgICAgICAgYm9vbGVhbiBlbmFibGVkLCBib29sZWFu\nIHVuaXF1ZSkgewogICAgICAgIGlmICghZW5hYmxlZCkgewogICAgICAgICAg\nICBpbmZvLnNldENhbkluZGV4KGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkluZGV4IGlkeCA9CiAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuSW5kZXgoKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGlkeC5zZXRO\nYW1lKG5hbWUpOwogICAgICAgIGlkeC5zZXRVbmlxdWUodW5pcXVlKTsKICAg\nICAgICBpbmZvLnNldEluZGV4KGlkeCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdW5pcXVlIGRhdGEgb24gdGhlIGdpdmVuIG1hcHBpbmcgaW5mby4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVW5pcXVlKEZpZWxkTWFw\ncGluZyBmbSwgVW5pcXVlIGFubm8pIHsKICAgICAgICBWYWx1ZU1hcHBpbmdJ\nbmZvIGluZm8gPSBmbS5nZXRWYWx1ZUluZm8oKTsKICAgICAgICBpZiAoIWFu\nbm8uZW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGluZm8uc2V0Q2FuVW5pcXVl\nKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZSB1bnEg\nPQogICAgICAgICAgICBuZXcgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlVuaXF1ZSgpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0\neShhbm5vLm5hbWUoKSkpCiAgICAgICAgICAgIHVucS5zZXROYW1lKGFubm8u\nbmFtZSgpKTsKICAgICAgICB1bnEuc2V0RGVmZXJyZWQoYW5uby5kZWZlcnJl\nZCgpKTsKICAgICAgICBpbmZvLnNldFVuaXF1ZSh1bnEpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQFZlcnNpb25Db2x1bW4ocykuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZVZlcnNpb25Db2x1bW5zKENsYXNzTWFw\ncGluZyBjbSwgVmVyc2lvbkNvbHVtbi4uLiB2Y29scykgewogICAgICAgIGlm\nICh2Y29scy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBMaXN0PENvbHVtbj4gY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1u\nPih2Y29scy5sZW5ndGgpOwogICAgICAgIGZvciAoVmVyc2lvbkNvbHVtbiB2\nY29sIDogdmNvbHMpCiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbih2\nY29sKSk7CiAgICAgICAgY20uZ2V0VmVyc2lvbigpLmdldE1hcHBpbmdJbmZv\nKCkuc2V0Q29sdW1ucyhjb2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJv\nbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgQ29sdW1uIG5ld0NvbHVtbihWZXJzaW9uQ29sdW1uIGFubm8pIHsK\nICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm5hbWUoKSkpCiAgICAgICAg\nICAgIGNvbC5zZXROYW1lKGFubm8ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5jb2x1bW5EZWZpbml0aW9uKCkpKQog\nICAgICAgICAgICBjb2wuc2V0VHlwZU5hbWUoYW5uby5jb2x1bW5EZWZpbml0\naW9uKCkpOwogICAgICAgIGlmIChhbm5vLnByZWNpc2lvbigpICE9IDApCiAg\nICAgICAgICAgIGNvbC5zZXRTaXplKGFubm8ucHJlY2lzaW9uKCkpOwogICAg\nICAgIGVsc2UgaWYgKGFubm8ubGVuZ3RoKCkgIT0gMjU1KQogICAgICAgICAg\nICBjb2wuc2V0U2l6ZShhbm5vLmxlbmd0aCgpKTsKICAgICAgICBjb2wuc2V0\nTm90TnVsbCghYW5uby5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RGVj\naW1hbERpZ2l0cyhhbm5vLnNjYWxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFn\nKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSwgIWFubm8uaW5zZXJ0YWJsZSgp\nKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJM\nRSwgIWFubm8udXBkYXRhYmxlKCkpOwogICAgICAgIHJldHVybiBjb2w7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2xhdGUgdGhlIGZldGNoIG1vZGUg\nZW51bSB2YWx1ZSB0byB0aGUgaW50ZXJuYWwgT3BlbkpQQSBjb25zdGFudC4K\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHRvRWFnZXJGZXRjaE1v\nZGVDb25zdGFudChFYWdlckZldGNoVHlwZSB0eXBlKSB7CiAgICAgICAgc3dp\ndGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2UgTk9ORToKICAgICAgICAg\nICAgICAgIHJldHVybiBFYWdlckZldGNoTW9kZXMuRUFHRVJfTk9ORTsKICAg\nICAgICAgICAgY2FzZSBKT0lOOgogICAgICAgICAgICAgICAgcmV0dXJuIEVh\nZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9KT0lOOwogICAgICAgICAgICBjYXNlIFBB\nUkFMTEVMOgogICAgICAgICAgICAgICAgcmV0dXJuIEVhZ2VyRmV0Y2hNb2Rl\ncy5FQUdFUl9QQVJBTExFTDsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lk\nIHBhcnNlTG9iTWFwcGluZyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAg\nIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKGZtZC5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlNUUklORwogICAg\nICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gY2hhcltdLmNs\nYXNzCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBD\naGFyYWN0ZXJbXS5jbGFzcykKICAgICAgICAgICAgY29sLnNldFR5cGUoVHlw\nZXMuQ0xPQik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2wuc2V0VHlw\nZShUeXBlcy5CTE9CKTsKICAgICAgICAoKEZpZWxkTWFwcGluZykgZm1kKS5n\nZXRWYWx1ZUluZm8oKS5zZXRDb2x1bW5zKEFycmF5cy5hc0xpc3QKICAgICAg\nICAgICAgKG5ldyBDb2x1bW5bXXsgY29sIH0pKTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTWVtYmVyTWFwcGluZ0Fu\nbm90YXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgRmllbGRN\nYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykgZm1kOwogICAgICAgIEFubm90\nYXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxlbWVudCkgZ2V0UmVwb3Np\ndG9yeSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXRE\nZWZhdWx0cygpLmdldEJhY2tpbmdNZW1iZXIoZm1kKTsKCiAgICAgICAgTWFw\ncGluZ1RhZyB0YWc7CiAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBl\nbC5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFn\nID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAg\nICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxl\nVW5rbm93bk1lbWJlck1hcHBpbmdBbm5vdGF0aW9uKGZtLCBhbm5vKTsKICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgY2FzZSBBU1NP\nQ19PVkVSUklERToKICAgICAgICAgICAgICAgICAgICBwYXJzZUFzc29jaWF0\naW9uT3ZlcnJpZGVzKGZtLCAoQXNzb2NpYXRpb25PdmVycmlkZSkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEFTU09DX09WRVJSSURFUzoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZUFzc29jaWF0aW9uT3ZlcnJpZGVzKGZtLCAoKEFzc29jaWF0aW9uT3ZlcnJp\nZGVzKSBhbm5vKS4KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEFUVFJfT1ZFUlJJREU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VB\ndHRyaWJ1dGVPdmVycmlkZXMoZm0sIChBdHRyaWJ1dGVPdmVycmlkZSkgYW5u\nbyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEFUVFJfT1ZFUlJJREVTOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlQXR0cmlidXRlT3ZlcnJpZGVzKGZtLCAoKEF0dHJpYnV0ZU92ZXJyaWRl\ncykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBDT0w6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VDb2x1bW5zKGZtLCAo\namF2YXgucGVyc2lzdGVuY2UuQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ09MUzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUNvbHVtbnMoZm0sICgoQ29sdW1ucykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEVOVU1FUkFURUQ6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VFbnVtZXJhdGVkKGZtLCAoRW51bWVyYXRlZCkgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEpPSU5fQ09MOgogICAgICAgICAgICAgICAgICAgIHBhcnNlSm9pbkNv\nbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCB0cnVlLAogICAgICAgICAg\nICAgICAgICAgICAgICAoSm9pbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fQ09M\nUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZUpvaW5Db2x1bW5zKGZtLCBm\nbS5nZXRWYWx1ZUluZm8oKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAg\nICAgKChKb2luQ29sdW1ucykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEpPSU5fVEFC\nTEU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VKb2luVGFibGUoZm0sIChK\nb2luVGFibGUpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBQS19KT0lOX0NPTDoKICAgICAgICAgICAg\nICAgICAgICBwYXJzZVByaW1hcnlLZXlKb2luQ29sdW1ucyhmbSwgKFByaW1h\ncnlLZXlKb2luQ29sdW1uKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEtfSk9JTl9DT0xTOgogICAg\nICAgICAgICAgICAgICAgIHBhcnNlUHJpbWFyeUtleUpvaW5Db2x1bW5zKGZt\nLAogICAgICAgICAgICAgICAgICAgICAgICAoKFByaW1hcnlLZXlKb2luQ29s\ndW1ucykgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1\nZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgVEFCTEVfR0VOOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nVGFibGVHZW5lcmF0b3IoZWwsIChUYWJsZUdlbmVyYXRvcikgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFRFTVBPUkFMOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVGVtcG9yYWwo\nZm0sIChUZW1wb3JhbCkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIENMQVNTX0NSSVQ6CiAgICAgICAg\nICAgICAgICAgICAgZm0uZ2V0VmFsdWVJbmZvKCkuc2V0VXNlQ2xhc3NDcml0\nZXJpYQogICAgICAgICAgICAgICAgICAgICAgICAoKChDbGFzc0NyaXRlcmlh\nKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgQ09OVEFJTkVSX1RBQkxFOgogICAgICAg\nICAgICAgICAgICAgIHBhcnNlQ29udGFpbmVyVGFibGUoZm0sIChDb250YWlu\nZXJUYWJsZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEVBR0VSX0ZFVENIX01PREU6CiAgICAgICAg\nICAgICAgICAgICAgZm0uc2V0RWFnZXJGZXRjaE1vZGUodG9FYWdlckZldGNo\nTW9kZUNvbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgoKEVhZ2Vy\nRmV0Y2hNb2RlKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fQ0xBU1NfQ1JJ\nVDoKICAgICAgICAgICAgICAgICAgICBmbS5nZXRFbGVtZW50TWFwcGluZygp\nLmdldFZhbHVlSW5mbygpLnNldFVzZUNsYXNzQ3JpdGVyaWEKICAgICAgICAg\nICAgICAgICAgICAgICAgKCgoRWxlbWVudENsYXNzQ3JpdGVyaWEpIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFTEVNX0ZLOgogICAgICAgICAgICAgICAgICAgIEVs\nZW1lbnRGb3JlaWduS2V5IGVmayA9IChFbGVtZW50Rm9yZWlnbktleSkgYW5u\nbzsKICAgICAgICAgICAgICAgICAgICBwYXJzZUZvcmVpZ25LZXkoZm0uZ2V0\nRWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgZWZrLm5hbWUoKSwgZWZrLmVuYWJsZWQoKSwgZWZrLmRl\nZmVycmVkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGVmay5kZWxldGVB\nY3Rpb24oKSwgZWZrLnVwZGF0ZUFjdGlvbigpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9JTkRFWDoK\nICAgICAgICAgICAgICAgICAgICBFbGVtZW50SW5kZXggZWlkeCA9IChFbGVt\nZW50SW5kZXgpIGFubm87CiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbmRl\neChmbS5nZXRFbGVtZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLAogICAg\nICAgICAgICAgICAgICAgICAgICBlaWR4Lm5hbWUoKSwgZWlkeC5lbmFibGVk\nKCksIGVpZHgudW5pcXVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX0pPSU5fQ09MOgogICAgICAg\nICAgICAgICAgICAgIHBhcnNlRWxlbWVudEpvaW5Db2x1bW5zKGZtLCAoRWxl\nbWVudEpvaW5Db2x1bW4pIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTEVNX0pPSU5fQ09MUzoKICAg\nICAgICAgICAgICAgICAgICBwYXJzZUVsZW1lbnRKb2luQ29sdW1ucyhmbSwg\nKChFbGVtZW50Sm9pbkNvbHVtbnMpIGFubm8pLgogICAgICAgICAgICAgICAg\nICAgICAgICB2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgRUxFTV9OT05QT0xZOgogICAgICAgICAg\nICAgICAgICAgIGZtLmdldEVsZW1lbnRNYXBwaW5nKCkuc2V0UG9seW1vcnBo\naWModG9Qb2x5bW9ycGhpY0NvbnN0YW50CiAgICAgICAgICAgICAgICAgICAg\nICAgICgoKEVsZW1lbnROb25wb2x5bW9ycGhpYykgYW5ubykudmFsdWUoKSkp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBFTUJFRERFRF9NQVBQSU5HOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlRW1iZWRkZWRNYXBwaW5nKGZtLCAoRW1iZWRkZWRNYXBwaW5nKSBhbm5v\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgRks6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VGb3JlaWduS2V5\nKGZtLmdldFZhbHVlSW5mbygpLCAoRm9yZWlnbktleSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIElO\nREVYOgogICAgICAgICAgICAgICAgICAgIHBhcnNlSW5kZXgoZm0uZ2V0VmFs\ndWVJbmZvKCksIChJbmRleCkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE5PTlBPTFk6CiAgICAgICAg\nICAgICAgICAgICAgZm0uc2V0UG9seW1vcnBoaWModG9Qb2x5bW9ycGhpY0Nv\nbnN0YW50CiAgICAgICAgICAgICAgICAgICAgICAgICgoKE5vbnBvbHltb3Jw\naGljKSBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9SREVSX0NPTDoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZU9yZGVyQ29sdW1uKGZtLCAoT3JkZXJDb2x1bW4p\nIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBTVFJBVDoKICAgICAgICAgICAgICAgICAgICBmbS5nZXRW\nYWx1ZUluZm8oKS5zZXRTdHJhdGVneSgoKFN0cmF0ZWd5KSBhbm5vKS52YWx1\nZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgVU5JUVVFOgogICAgICAgICAgICAgICAgICAgIHBhcnNlVW5p\ncXVlKGZtLCAoVW5pcXVlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgWF9KT0lOX0NPTDoKICAgICAg\nICAgICAgICAgICAgICBwYXJzZVhKb2luQ29sdW1ucyhmbSwgZm0uZ2V0VmFs\ndWVJbmZvKCksIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIChYSm9p\nbkNvbHVtbikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFhfSk9JTl9DT0xTOgogICAgICAgICAgICAg\nICAgICAgIHBhcnNlWEpvaW5Db2x1bW5zKGZtLCBmbS5nZXRWYWx1ZUluZm8o\nKSwgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgKChYSm9pbkNvbHVt\nbnMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVu\nc3VwcG9ydGVkIiwgZm0sCiAgICAgICAgICAgICAgICAgICAgICAgIGFubm8u\ndG9TdHJpbmcoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUgdW5r\nbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaGFuZGxlVW5rbm93bk1lbWJlck1hcHBpbmdBbm5vdGF0aW9uKEZpZWxk\nTWFwcGluZyBmbSwKICAgICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHtAbGluayBWYWx1ZU1hcHBpbmd9IDxjb2RlPlBPTFlfKjwvY29kZT4g\nY29uc3RhbnQgZm9yCiAgICAgKiB0aGUgZ2l2ZW4gZW51bSB2YWx1ZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBpbnQgdG9Qb2x5bW9ycGhpY0Nv\nbnN0YW50KE5vbnBvbHltb3JwaGljVHlwZSB2YWwpIHsKICAgICAgICBzd2l0\nY2ggKHZhbCkgewogICAgICAgICAgICBjYXNlIEVYQUNUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIFZhbHVlTWFwcGluZy5QT0xZX0ZBTFNFOwogICAgICAg\nICAgICBjYXNlIEpPSU5BQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIFZh\nbHVlTWFwcGluZy5QT0xZX0pPSU5BQkxFOwogICAgICAgICAgICBjYXNlIEZB\nTFNFOgogICAgICAgICAgICAgICAgcmV0dXJuIFZhbHVlTWFwcGluZy5QT0xZ\nX1RSVUU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBnaXZlbiBAQXNzb2NpYXRpb25PdmVy\ncmlkZSBhbm5vdGF0aW9ucyBvbiBhbiBlbWJlZGRlZCBtYXBwaW5nLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VBc3NvY2lhdGlvbk92ZXJyaWRl\ncyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgQXNzb2NpYXRpb25PdmVycmlk\nZS4uLiBhc3NvY3MpIHsKICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQgPSBm\nbS5nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgICAgICBpZiAoZW1iZWQgPT0g\nbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJub3QtZW1iZWRkZWQiLCBmbSkpOwoKICAgICAgICBGaWVs\nZE1hcHBpbmcgZWZtOwogICAgICAgIEpvaW5Db2x1bW5bXSBlY29sczsKICAg\nICAgICBpbnQgdW5pcXVlOwogICAgICAgIExpc3Q8Q29sdW1uPiBqY29sczsK\nICAgICAgICBmb3IgKEFzc29jaWF0aW9uT3ZlcnJpZGUgYXNzb2MgOiBhc3Nv\nY3MpIHsKICAgICAgICAgICAgZWZtID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5n\nKGFzc29jLm5hbWUoKSk7CiAgICAgICAgICAgIGlmIChlZm0gPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiZW1iZWQtb3ZlcnJpZGUtbmFtZSIsCiAgICAgICAgICAgICAg\nICAgICAgZm0sIGFzc29jLm5hbWUoKSkpOwogICAgICAgICAgICBlY29scyA9\nIGFzc29jLmpvaW5Db2x1bW5zKCk7CiAgICAgICAgICAgIGlmIChlY29scyA9\nPSBudWxsIHx8IGVjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICB1bmlxdWUgPSAwOwogICAgICAgICAg\nICBqY29scyA9IG5ldyBBcnJheUxpc3Q8Q29sdW1uPihlY29scy5sZW5ndGgp\nOwogICAgICAgICAgICBmb3IgKEpvaW5Db2x1bW4gZWNvbCA6IGVjb2xzKSB7\nCiAgICAgICAgICAgICAgICB1bmlxdWUgfD0gKGVjb2wudW5pcXVlKCkpID8g\nVFJVRSA6IEZBTFNFOwogICAgICAgICAgICAgICAgamNvbHMuYWRkKG5ld0Nv\nbHVtbihlY29sKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0Q29s\ndW1ucyhlZm0sIGVmbS5nZXRWYWx1ZUluZm8oKSwgamNvbHMsIHVuaXF1ZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZ2l2ZW4g\nQEF0dHJpYnV0ZU92ZXJyaWRlIGFubm90YXRpb25zIG9uIGFuIGVtYmVkZGVk\nIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUF0dHJp\nYnV0ZU92ZXJyaWRlcyhGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgQXR0cmli\ndXRlT3ZlcnJpZGUuLi4gYXR0cnMpIHsKICAgICAgICBDbGFzc01hcHBpbmcg\nZW1iZWQgPSBmbS5nZXRFbWJlZGRlZE1hcHBpbmcoKTsKICAgICAgICBpZiAo\nZW1iZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtZW1iZWRkZWQiLCBmbSkpOwoKICAg\nICAgICBGaWVsZE1hcHBpbmcgZWZtOwogICAgICAgIGphdmF4LnBlcnNpc3Rl\nbmNlLkNvbHVtbiBlY29sOwogICAgICAgIGludCB1bmlxdWU7CiAgICAgICAg\nZm9yIChBdHRyaWJ1dGVPdmVycmlkZSBhdHRyIDogYXR0cnMpIHsKICAgICAg\nICAgICAgZWZtID0gZW1iZWQuZ2V0RmllbGRNYXBwaW5nKGF0dHIubmFtZSgp\nKTsKICAgICAgICAgICAgaWYgKGVmbSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlbWJl\nZC1vdmVycmlkZS1uYW1lIiwKICAgICAgICAgICAgICAgICAgICBmbSwgYXR0\nci5uYW1lKCkpKTsKICAgICAgICAgICAgZWNvbCA9IGF0dHIuY29sdW1uKCk7\nCiAgICAgICAgICAgIGlmIChlY29sID09IG51bGwpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKCiAgICAgICAgICAgIHVuaXF1ZSA9IChlY29sLnVuaXF1\nZSgpKSA/IFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgc2V0Q29sdW1ucyhl\nZm0sIGVmbS5nZXRWYWx1ZUluZm8oKSwgQXJyYXlzLmFzTGlzdAogICAgICAg\nICAgICAgICAgKG5ldyBDb2x1bW5bXXsgbmV3Q29sdW1uKGVjb2wpIH0pLCB1\nbmlxdWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBFbnVtZXJhdGVkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VF\nbnVtZXJhdGVkKEZpZWxkTWFwcGluZyBmbSwgRW51bWVyYXRlZCBhbm5vKSB7\nCiAgICAgICAgU3RyaW5nIHN0cmF0ID0gRW51bVZhbHVlSGFuZGxlci5jbGFz\ncy5nZXROYW1lKCkgKyAiKFN0b3JlT3JkaW5hbD0iCiAgICAgICAgICAgICsg\nU3RyaW5nLnZhbHVlT2YoYW5uby52YWx1ZSgpID09IEVudW1UeXBlLk9SRElO\nQUwpICsgIikiOwogICAgICAgIGZtLmdldFZhbHVlSW5mbygpLnNldFN0cmF0\nZWd5KHN0cmF0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBUZW1w\nb3JhbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlVGVtcG9yYWwo\nRmllbGRNYXBwaW5nIGZtLCBUZW1wb3JhbCBhbm5vKSB7CiAgICAgICAgTGlz\ndCBjb2xzID0gZm0uZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwogICAg\nICAgIGlmICghY29scy5pc0VtcHR5KCkgJiYgY29scy5zaXplKCkgIT0gMSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJudW0tY29scy1taXNtYXRjaCIsIGZtLAogICAgICAgICAgICAgICAg\nU3RyaW5nLnZhbHVlT2YoY29scy5zaXplKCkpLCAiMSIpKTsKICAgICAgICBp\nZiAoY29scy5pc0VtcHR5KCkpCiAgICAgICAgICAgIGNvbHMgPSBBcnJheXMu\nYXNMaXN0KG5ldyBDb2x1bW5bXXsgbmV3IENvbHVtbigpIH0pOwoKICAgICAg\nICBDb2x1bW4gY29sID0gKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAg\nc3dpdGNoIChhbm5vLnZhbHVlKCkpIHsKICAgICAgICAgICAgY2FzZSBEQVRF\nOgogICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMuREFURSk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUSU1FOgog\nICAgICAgICAgICAgICAgY29sLnNldFR5cGUoVHlwZXMuVElNRSk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUSU1FU1RBTVA6\nCiAgICAgICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5USU1FU1RBTVAp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgQENvbHVtbihzKS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgcGFyc2VDb2x1bW5zKEZpZWxkTWFwcGluZyBmbSwKICAg\nICAgICBqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4uLi4gcGNvbHMpIHsKICAg\nICAgICBpZiAocGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gbWlnaHQgYWxyZWFkeSBoYXZlIHNvbWUgY29sdW1u\nIGluZm9ybWF0aW9uIGZyb20gbWFwcGluZyBhbm5vdGF0aW9uCiAgICAgICAg\nTGlzdCBjb2xzID0gZm0uZ2V0VmFsdWVJbmZvKCkuZ2V0Q29sdW1ucygpOwog\nICAgICAgIGlmICghY29scy5pc0VtcHR5KCkgJiYgY29scy5zaXplKCkgIT0g\ncGNvbHMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm51bS1jb2xzLW1pc21hdGNoIiwgZm0sCiAg\nICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihjb2xzLnNpemUoKSksIFN0\ncmluZy52YWx1ZU9mKHBjb2xzLmxlbmd0aCkpKTsKCiAgICAgICAgaW50IHVu\naXF1ZSA9IDA7CiAgICAgICAgU3RyaW5nIHNlY29uZGFyeSA9IG51bGw7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwY29scy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBpZiAoY29scy5zaXplKCkgPiBpKQogICAgICAgICAg\nICAgICAgc2V0dXBDb2x1bW4oKENvbHVtbikgY29scy5nZXQoaSksIHBjb2xz\nW2ldKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAo\nY29scy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgY29scyA9IG5l\ndyBBcnJheUxpc3Q8Q29sdW1uPihwY29scy5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgY29scy5hZGQobmV3Q29sdW1uKHBjb2xzW2ldKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHVuaXF1ZSB8PSAocGNvbHNbaV0udW5pcXVl\nKCkpID8gVFJVRSA6IEZBTFNFOwogICAgICAgICAgICBzZWNvbmRhcnkgPSB0\ncmFja1NlY29uZGFyeVRhYmxlKGZtLCBzZWNvbmRhcnksCiAgICAgICAgICAg\nICAgICBwY29sc1tpXS50YWJsZSgpLCBpKTsKICAgICAgICB9CgogICAgICAg\nIHNldENvbHVtbnMoZm0sIGZtLmdldFZhbHVlSW5mbygpLCBjb2xzLCB1bmlx\ndWUpOwogICAgICAgIGlmIChzZWNvbmRhcnkgIT0gbnVsbCkKICAgICAgICAg\nICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5zZXRUYWJsZU5hbWUoc2Vjb25kYXJ5\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzY2hlbWEg\nY29sdW1uIHdpdGggaW5mb3JtYXRpb24gZnJvbSB0aGUgZ2l2ZW4gYW5ub3Rh\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ29sdW1uIG5ld0Nv\nbHVtbihqYXZheC5wZXJzaXN0ZW5jZS5Db2x1bW4gYW5ubykgewogICAgICAg\nIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgc2V0dXBDb2x1\nbW4oY29sLCBhbm5vKTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0dXAgdGhlIGdpdmVuIGNvbHVtbiB3aXRoIGluZm9y\nbWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIHZvaWQgc2V0dXBDb2x1bW4oQ29sdW1uIGNvbCwg\namF2YXgucGVyc2lzdGVuY2UuQ29sdW1uIGFubm8pIHsKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5uYW1lKCkpKQogICAgICAgICAg\nICBjb2wuc2V0TmFtZShhbm5vLm5hbWUoKSk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGFubm8uY29sdW1uRGVmaW5pdGlvbigpKSkKICAg\nICAgICAgICAgY29sLnNldFR5cGVOYW1lKGFubm8uY29sdW1uRGVmaW5pdGlv\nbigpKTsKICAgICAgICBpZiAoYW5uby5wcmVjaXNpb24oKSAhPSAwKQogICAg\nICAgICAgICBjb2wuc2V0U2l6ZShhbm5vLnByZWNpc2lvbigpKTsKICAgICAg\nICBlbHNlIGlmIChhbm5vLmxlbmd0aCgpICE9IDI1NSkKICAgICAgICAgICAg\nY29sLnNldFNpemUoYW5uby5sZW5ndGgoKSk7CiAgICAgICAgY29sLnNldE5v\ndE51bGwoIWFubm8ubnVsbGFibGUoKSk7CiAgICAgICAgY29sLnNldERlY2lt\nYWxEaWdpdHMoYW5uby5zY2FsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhD\nb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFhbm5vLmluc2VydGFibGUoKSk7\nCiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUs\nICFhbm5vLnVwZGF0YWJsZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gY29sdW1ucyBhcyB0aGUgY29sdW1ucyBmb3IgPGNvZGU+\nZm08L2NvZGU+LgogICAgICoKICAgICAqIEBwYXJhbSB1bmlxdWUgYml0d2lz\nZSBjb21iaW5hdGlvbiBvZiBUUlVFIGFuZCBGQUxTRSBmb3IgdGhlCiAgICAg\nKiB1bmlxdWUgYXR0cmlidXRlIG9mIGVhY2ggY29sdW1uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHNldENvbHVtbnMoRmllbGRNYXBwaW5nIGZtLCBN\nYXBwaW5nSW5mbyBpbmZvLAogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzLCBp\nbnQgdW5pcXVlKSB7CiAgICAgICAgaW5mby5zZXRDb2x1bW5zKGNvbHMpOwog\nICAgICAgIGlmICh1bmlxdWUgPT0gVFJVRSkKICAgICAgICAgICAgaW5mby5z\nZXRVbmlxdWUobmV3IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5V\nbmlxdWUoKSk7CgogICAgICAgIC8vIyMjIEVKQjMKICAgICAgICBMb2cgbG9n\nID0gZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkg\nJiYgdW5pcXVlID09IChUUlVFIHwgRkFMU0UpKQogICAgICAgICAgICBsb2cu\nd2FybihfbG9jLmdldCgiaW5jb25zaXN0LWNvbC1hdHRycyIsIGZtKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgdG8gdHJhY2sgdGhlIHNlY29u\nZGFyeSB0YWJsZSBmb3IgYSBzZXQgb2YgY29sdW1ucy4KICAgICAqCiAgICAg\nKiBAcGFyYW0gc2Vjb25kYXJ5IHNlY29uZGFyeSB0YWJsZSBmb3IgbGFzdCBj\nb2x1bW4KICAgICAqIEBwYXJhbSBjb2xTZWNvbmRhcnkgc2Vjb25kYXJ5IHRh\nYmxlIGZvciBjdXJyZW50IGNvbHVtbgogICAgICogQHJldHVybiBzZWNvbmRh\ncnkgdGFibGUgZm9yIGZpZWxkCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5n\nIHRyYWNrU2Vjb25kYXJ5VGFibGUoRmllbGRNYXBwaW5nIGZtLCBTdHJpbmcg\nc2Vjb25kYXJ5LAogICAgICAgIFN0cmluZyBjb2xTZWNvbmRhcnksIGludCBj\nb2wpIHsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShjb2xTZWNv\nbmRhcnkpKQogICAgICAgICAgICBjb2xTZWNvbmRhcnkgPSBudWxsOwogICAg\nICAgIGlmIChjb2wgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIGNvbFNlY29u\nZGFyeTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmVxdWFsc0lnbm9yZUNh\nc2Uoc2Vjb25kYXJ5LCBjb2xTZWNvbmRhcnkpKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoInNlY29uZC1pbmNv\nbnNpc3QiLCBmbSkpOwogICAgICAgIHJldHVybiBzZWNvbmRhcnk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBASm9pblRhYmxlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgcGFyc2VKb2luVGFibGUoRmllbGRNYXBwaW5nIGZt\nLCBKb2luVGFibGUgam9pbikgewogICAgICAgIGZtLmdldE1hcHBpbmdJbmZv\nKCkuc2V0VGFibGVOYW1lKHRvVGFibGVOYW1lKGpvaW4uc2NoZW1hKCksCiAg\nICAgICAgICAgIGpvaW4ubmFtZSgpKSk7CiAgICAgICAgcGFyc2VKb2luQ29s\ndW1ucyhmbSwgZm0uZ2V0TWFwcGluZ0luZm8oKSwgZmFsc2UsIGpvaW4uam9p\nbkNvbHVtbnMoKSk7CiAgICAgICAgcGFyc2VKb2luQ29sdW1ucyhmbSwgZm0u\nZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRWYWx1ZUluZm8oKSwgZmFsc2UsCiAg\nICAgICAgICAgIGpvaW4uaW52ZXJzZUpvaW5Db2x1bW5zKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUGFyc2UgZ2l2ZW4gQEpvaW5Db2x1bW4gYW5ub3Rh\ndGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUpvaW5Db2x1\nbW5zKEZpZWxkTWFwcGluZyBmbSwgTWFwcGluZ0luZm8gaW5mbywKICAgICAg\nICBib29sZWFuIHNlY29uZGFyeUFsbG93ZWQsIEpvaW5Db2x1bW4uLi4gam9p\nbnMpIHsKICAgICAgICBpZiAoam9pbnMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcg\nQXJyYXlMaXN0PENvbHVtbj4oam9pbnMubGVuZ3RoKTsKICAgICAgICBpbnQg\ndW5pcXVlID0gMDsKICAgICAgICBTdHJpbmcgc2Vjb25kYXJ5ID0gbnVsbDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGNvbHMuYWRkKG5ld0NvbHVtbihqb2luc1tpXSkp\nOwogICAgICAgICAgICB1bmlxdWUgfD0gKGpvaW5zW2ldLnVuaXF1ZSgpKSA/\nIFRSVUUgOiBGQUxTRTsKICAgICAgICAgICAgc2Vjb25kYXJ5ID0gdHJhY2tT\nZWNvbmRhcnlUYWJsZShmbSwgc2Vjb25kYXJ5LAogICAgICAgICAgICAgICAg\nam9pbnNbaV0udGFibGUoKSwgaSk7CiAgICAgICAgICAgIGlmICghc2Vjb25k\nYXJ5QWxsb3dlZCAmJiBzZWNvbmRhcnkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLXNlY29uZCIsIGZtKSk7CiAgICAgICAgfQoKICAgICAgICBzZXRDb2x1bW5z\nKGZtLCBpbmZvLCBjb2xzLCB1bmlxdWUpOwogICAgICAgIGlmIChzZWNvbmRh\ncnkgIT0gbnVsbCkKICAgICAgICAgICAgZm0uZ2V0TWFwcGluZ0luZm8oKS5z\nZXRUYWJsZU5hbWUoc2Vjb25kYXJ5KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBzY2hlbWEgY29sdW1uIHdpdGggaW5mb3JtYXRpb24g\nZnJvbSB0aGUgZ2l2ZW4gYW5ub3RhdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgQ29sdW1uIG5ld0NvbHVtbihKb2luQ29sdW1uIGpvaW4pIHsK\nICAgICAgICBDb2x1bW4gY29sID0gbmV3IENvbHVtbigpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2luLm5hbWUoKSkpCiAgICAgICAg\nICAgIGNvbC5zZXROYW1lKGpvaW4ubmFtZSgpKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoam9pbi5jb2x1bW5EZWZpbml0aW9uKCkpKQog\nICAgICAgICAgICBjb2wuc2V0TmFtZShqb2luLmNvbHVtbkRlZmluaXRpb24o\nKSk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGpvaW4ucmVm\nZXJlbmNlZENvbHVtbk5hbWUoKSkpCiAgICAgICAgICAgIGNvbC5zZXRUYXJn\nZXQoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKTsKICAgICAgICBjb2wu\nc2V0Tm90TnVsbCgham9pbi5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0\nRmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFqb2luLmluc2VydGFi\nbGUoKSk7CiAgICAgICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERB\nVEFCTEUsICFqb2luLnVwZGF0YWJsZSgpKTsKICAgICAgICByZXR1cm4gY29s\nOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgZ2l2ZW4gQFByaW1hcnlL\nZXlKb2luQ29sdW1uIGFubm90YXRpb25zLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcGFyc2VQcmltYXJ5S2V5Sm9pbkNvbHVtbnMoRmllbGRNYXBwaW5n\nIGZtLAogICAgICAgIFByaW1hcnlLZXlKb2luQ29sdW1uLi4uIGpvaW5zKSB7\nCiAgICAgICAgTGlzdDxDb2x1bW4+IGNvbHMgPSBuZXcgQXJyYXlMaXN0PENv\nbHVtbj4oam9pbnMubGVuZ3RoKTsKICAgICAgICBmb3IgKFByaW1hcnlLZXlK\nb2luQ29sdW1uIGpvaW4gOiBqb2lucykKICAgICAgICAgICAgY29scy5hZGQo\nbmV3Q29sdW1uKGpvaW4pKTsKICAgICAgICBzZXRDb2x1bW5zKGZtLCBmbS5n\nZXRWYWx1ZUluZm8oKSwgY29scywgMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBQYXJzZSBnaXZlbiBAWEpvaW5Db2x1bW4gYW5ub3RhdGlvbnMuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlWEpvaW5Db2x1bW5zKEZpZWxk\nTWFwcGluZyBmbSwgTWFwcGluZ0luZm8gaW5mbywKICAgICAgICBib29sZWFu\nIHNlY29uZGFyeUFsbG93ZWQsIFhKb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAg\nICAgICAgaWYgKGpvaW5zLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIExpc3Q8Q29sdW1uPiBjb2xzID0gbmV3IEFycmF5TGlz\ndDxDb2x1bW4+KGpvaW5zLmxlbmd0aCk7CiAgICAgICAgaW50IHVuaXF1ZSA9\nIDA7CiAgICAgICAgU3RyaW5nIHNlY29uZGFyeSA9IG51bGw7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBjb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0pKTsKICAgICAg\nICAgICAgdW5pcXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBUUlVFIDog\nRkFMU0U7CiAgICAgICAgICAgIHNlY29uZGFyeSA9IHRyYWNrU2Vjb25kYXJ5\nVGFibGUoZm0sIHNlY29uZGFyeSwKICAgICAgICAgICAgICAgIGpvaW5zW2ld\nLnRhYmxlKCksIGkpOwogICAgICAgICAgICBpZiAoIXNlY29uZGFyeUFsbG93\nZWQgJiYgc2Vjb25kYXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1zZWNvbmQi\nLCBmbSkpOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29sdW1ucyhmbSwgaW5m\nbywgY29scywgdW5pcXVlKTsKICAgICAgICBpZiAoc2Vjb25kYXJ5ICE9IG51\nbGwpCiAgICAgICAgICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0VGFibGVO\nYW1lKHNlY29uZGFyeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUg\nYSBuZXcgc2NoZW1hIGNvbHVtbiB3aXRoIGluZm9ybWF0aW9uIGZyb20gdGhl\nIGdpdmVuIGFubm90YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIENvbHVtbiBuZXdDb2x1bW4oWEpvaW5Db2x1bW4gam9pbikgewogICAgICAg\nIENvbHVtbiBjb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29s\nLnNldE5hbWUoam9pbi5uYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShqb2luLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAg\nICAgIGNvbC5zZXROYW1lKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsKICAg\nICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2Vk\nQ29sdW1uTmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldFRhcmdldChqb2lu\nLnJlZmVyZW5jZWRDb2x1bW5OYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShqb2luLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkp\nKQogICAgICAgICAgICBjb2wuc2V0VGFyZ2V0RmllbGQoam9pbi5yZWZlcmVu\nY2VkQXR0cmlidXRlTmFtZSgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCgh\nam9pbi5udWxsYWJsZSgpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4u\nRkxBR19VTklOU0VSVEFCTEUsICFqb2luLmluc2VydGFibGUoKSk7CiAgICAg\nICAgY29sLnNldEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUsICFqb2lu\nLnVwZGF0YWJsZSgpKTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgZW1iZWRkZWQgaW5mbyBmb3IgdGhlIGdpdmVu\nIG1hcHBpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUVtYmVk\nZGVkTWFwcGluZyhGaWVsZE1hcHBpbmcgZm0sIEVtYmVkZGVkTWFwcGluZyBh\nbm5vKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGVtYmVkID0gZm0uZ2V0RW1i\nZWRkZWRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVtYmVkID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm90LWVtYmVkZGVkIiwgZm0pKTsKCiAgICAgICAgRmllbGRNYXBwaW5n\nIGVmbTsKICAgICAgICBmb3IgKE1hcHBpbmdPdmVycmlkZSBvdmVyIDogYW5u\nby5vdmVycmlkZXMoKSkgewogICAgICAgICAgICBlZm0gPSBlbWJlZC5nZXRG\naWVsZE1hcHBpbmcob3Zlci5uYW1lKCkpOwogICAgICAgICAgICBpZiAoZWZt\nID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoImVtYmVkLW92ZXJyaWRlLW5hbWUiLAogICAg\nICAgICAgICAgICAgICAgIGZtLCBvdmVyLm5hbWUoKSkpOwogICAgICAgICAg\nICBwb3B1bGF0ZShlZm0sIG92ZXIpOwogICAgICAgIH0KCiAgICAgICAgU3Ry\naW5nIG51bGxJbmQgPSBudWxsOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShhbm5vLm51bGxJbmRpY2F0b3JBdHRyaWJ1dGVOYW1lKCkpKQog\nICAgICAgICAgICBudWxsSW5kID0gYW5uby5udWxsSW5kaWNhdG9yQXR0cmli\ndXRlTmFtZSgpOwogICAgICAgIGVsc2UgaWYgKCFTdHJpbmdVdGlscy5pc0Vt\ncHR5KGFubm8ubnVsbEluZGljYXRvckNvbHVtbk5hbWUoKSkpCiAgICAgICAg\nICAgIG51bGxJbmQgPSBhbm5vLm51bGxJbmRpY2F0b3JDb2x1bW5OYW1lKCk7\nCiAgICAgICAgaWYgKG51bGxJbmQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIGluZm8gPSBmbS5nZXRW\nYWx1ZUluZm8oKTsKICAgICAgICBpZiAoImZhbHNlIi5lcXVhbHMobnVsbElu\nZCkpCiAgICAgICAgICAgIGluZm8uc2V0Q2FuSW5kaWNhdGVOdWxsKGZhbHNl\nKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgQ29sdW1uIGNvbCA9IG5l\ndyBDb2x1bW4oKTsKICAgICAgICAgICAgaWYgKCEidHJ1ZSIuZXF1YWxzKG51\nbGxJbmQpKQogICAgICAgICAgICAgICAgY29sLnNldE5hbWUobnVsbEluZCk7\nCiAgICAgICAgICAgIGluZm8uc2V0Q29sdW1ucyhBcnJheXMuYXNMaXN0KG5l\ndyBDb2x1bW5bXXsgY29sIH0pKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBQYXJzZSBAQ29udGFpbmVyVGFibGUuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHBhcnNlQ29udGFpbmVyVGFibGUoRmllbGRNYXBwaW5n\nIGZtLCBDb250YWluZXJUYWJsZSBjdGJsKSB7CiAgICAgICAgZm0uZ2V0TWFw\ncGluZ0luZm8oKS5zZXRUYWJsZU5hbWUodG9UYWJsZU5hbWUoY3RibC5zY2hl\nbWEoKSwKICAgICAgICAgICAgY3RibC5uYW1lKCkpKTsKICAgICAgICBwYXJz\nZVhKb2luQ29sdW1ucyhmbSwgZm0uZ2V0TWFwcGluZ0luZm8oKSwgZmFsc2Us\nIGN0Ymwuam9pbkNvbHVtbnMoKSk7CiAgICAgICAgaWYgKGN0Ymwuam9pbkZv\ncmVpZ25LZXkoKS5zcGVjaWZpZWQoKSkKICAgICAgICAgICAgcGFyc2VGb3Jl\naWduS2V5KGZtLmdldE1hcHBpbmdJbmZvKCksIGN0Ymwuam9pbkZvcmVpZ25L\nZXkoKSk7CiAgICAgICAgaWYgKGN0Ymwuam9pbkluZGV4KCkuc3BlY2lmaWVk\nKCkpCiAgICAgICAgICAgIHBhcnNlSW5kZXgoZm0uZ2V0TWFwcGluZ0luZm8o\nKSwgY3RibC5qb2luSW5kZXgoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nYXJzZSBAT3JkZXJDb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\nYXJzZU9yZGVyQ29sdW1uKEZpZWxkTWFwcGluZyBmbSwgT3JkZXJDb2x1bW4g\nb3JkZXIpIHsKICAgICAgICBpZiAoIW9yZGVyLmVuYWJsZWQoKSkgewogICAg\nICAgICAgICBmbS5nZXRNYXBwaW5nSW5mbygpLnNldENhbk9yZGVyQ29sdW1u\nKGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgQ29sdW1uIGNvbCA9IG5ldyBDb2x1bW4oKTsKICAgICAgICBpZiAoIVN0\ncmluZ1V0aWxzLmlzRW1wdHkob3JkZXIubmFtZSgpKSkKICAgICAgICAgICAg\nY29sLnNldE5hbWUob3JkZXIubmFtZSgpKTsKICAgICAgICBpZiAoIVN0cmlu\nZ1V0aWxzLmlzRW1wdHkob3JkZXIuY29sdW1uRGVmaW5pdGlvbigpKSkKICAg\nICAgICAgICAgY29sLnNldFR5cGVOYW1lKG9yZGVyLmNvbHVtbkRlZmluaXRp\nb24oKSk7CiAgICAgICAgaWYgKG9yZGVyLnByZWNpc2lvbigpICE9IDApCiAg\nICAgICAgICAgIGNvbC5zZXRTaXplKG9yZGVyLnByZWNpc2lvbigpKTsKICAg\nICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19VTklOU0VSVEFCTEUsICFv\ncmRlci5pbnNlcnRhYmxlKCkpOwogICAgICAgIGNvbC5zZXRGbGFnKENvbHVt\nbi5GTEFHX1VOVVBEQVRBQkxFLCAhb3JkZXIudXBkYXRhYmxlKCkpOwogICAg\nICAgIGZtLmdldE1hcHBpbmdJbmZvKCkuc2V0T3JkZXJDb2x1bW4oY29sKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBFbGVtZW50Sm9pbkNvbHVt\nbihzKS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VFbGVtZW50\nSm9pbkNvbHVtbnMoRmllbGRNYXBwaW5nIGZtLAogICAgICAgIEVsZW1lbnRK\nb2luQ29sdW1uLi4uIGpvaW5zKSB7CiAgICAgICAgaWYgKGpvaW5zLmxlbmd0\naCA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIExpc3Q8Q29s\ndW1uPiBjb2xzID0gbmV3IEFycmF5TGlzdDxDb2x1bW4+KGpvaW5zLmxlbmd0\naCk7CiAgICAgICAgaW50IHVuaXF1ZSA9IDA7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBqb2lucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBj\nb2xzLmFkZChuZXdDb2x1bW4oam9pbnNbaV0pKTsKICAgICAgICAgICAgdW5p\ncXVlIHw9IChqb2luc1tpXS51bmlxdWUoKSkgPyBUUlVFIDogRkFMU0U7CiAg\nICAgICAgfQogICAgICAgIHNldENvbHVtbnMoZm0sIGZtLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCksIGNvbHMsIHVuaXF1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc2NoZW1hIGNvbHVtbiB3\naXRoIGluZm9ybWF0aW9uIGZyb20gdGhlIGdpdmVuIGFubm90YXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENvbHVtbiBuZXdDb2x1bW4oRWxl\nbWVudEpvaW5Db2x1bW4gam9pbikgewogICAgICAgIENvbHVtbiBjb2wgPSBu\nZXcgQ29sdW1uKCk7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGpvaW4ubmFtZSgpKSkKICAgICAgICAgICAgY29sLnNldE5hbWUoam9pbi5u\nYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShqb2lu\nLmNvbHVtbkRlZmluaXRpb24oKSkpCiAgICAgICAgICAgIGNvbC5zZXROYW1l\nKGpvaW4uY29sdW1uRGVmaW5pdGlvbigpKTsKICAgICAgICBpZiAoIVN0cmlu\nZ1V0aWxzLmlzRW1wdHkoam9pbi5yZWZlcmVuY2VkQ29sdW1uTmFtZSgpKSkK\nICAgICAgICAgICAgY29sLnNldFRhcmdldChqb2luLnJlZmVyZW5jZWRDb2x1\nbW5OYW1lKCkpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShq\nb2luLnJlZmVyZW5jZWRBdHRyaWJ1dGVOYW1lKCkpKQogICAgICAgICAgICBj\nb2wuc2V0VGFyZ2V0RmllbGQoam9pbi5yZWZlcmVuY2VkQXR0cmlidXRlTmFt\nZSgpKTsKICAgICAgICBjb2wuc2V0Tm90TnVsbCgham9pbi5udWxsYWJsZSgp\nKTsKICAgICAgICBjb2wuc2V0RmxhZyAoQ29sdW1uLkZMQUdfVU5JTlNFUlRB\nQkxFLCAham9pbi5pbnNlcnRhYmxlICgpKTsKCQljb2wuc2V0RmxhZyAoQ29s\ndW1uLkZMQUdfVU5VUERBVEFCTEUsICFqb2luLnVwZGF0YWJsZSAoKSk7CgkJ\ncmV0dXJuIGNvbDsKCX0KfQo=\n","encoding":"base64"}

