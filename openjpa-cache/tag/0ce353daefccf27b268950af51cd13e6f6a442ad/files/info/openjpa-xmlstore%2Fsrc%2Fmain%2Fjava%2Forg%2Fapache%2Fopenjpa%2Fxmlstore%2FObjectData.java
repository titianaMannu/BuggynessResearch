{"sha":"111a3e095f38a128f7f2d1a0cebbd9e355c6db38","node_id":"MDQ6QmxvYjIwNjM2NDoxMTFhM2UwOTVmMzhhMTI4ZjdmMmQxYTBjZWJiZDllMzU1YzZkYjM4","size":13700,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/111a3e095f38a128f7f2d1a0cebbd9e355c6db38","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS54bWxzdG9yZTsKCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5B\ncnJheTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFw\nOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGls\nLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFu\nZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IHNlcnAu\ndXRpbC5OdW1iZXJzOwoKLyoqCiAqIEluLW1lbW9yeSBmb3JtIG9mIGRhdGEg\naW4gZGF0YXN0b3JlIGJhY2tpbmcgYSBzaW5nbGUgcGVyc2lzdGVudCBvYmpl\nY3QuCiAqLwpwdWJsaWMgZmluYWwgY2xhc3MgT2JqZWN0RGF0YQogICAgaW1w\nbGVtZW50cyBDbG9uZWFibGUgewoKICAgIHByaXZhdGUgT2JqZWN0IF9vaWQ7\nCiAgICBwcml2YXRlIE9iamVjdFtdIF9kYXRhOwogICAgcHJpdmF0ZSBMb25n\nIF92ZXJzaW9uOwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIF9tZXRhOwoK\nICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBvYmplY3Qgd2l0aG91dCB1bmRl\ncmx5aW5nIGRhdGEuIEp1c3QgcGFzcyBpbiB0eXBlIHNwZWNpZmljCiAgICAg\nKiBtZXRhZGF0YSBhbmQgdGhlIG9pZC4KICAgICAqLwogICAgcHVibGljIE9i\namVjdERhdGEoT2JqZWN0IG9pZCwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgX29pZCA9IG9pZDsKICAgICAgICBfbWV0YSA9IG1ldGE7CiAgICAg\nICAgX2RhdGEgPSBuZXcgT2JqZWN0W21ldGEuZ2V0RmllbGRzKCkubGVuZ3Ro\nXTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHRlciBmb3Igb2lkLgogICAg\nICovCiAgICBwdWJsaWMgT2JqZWN0IGdldElkKCkgewogICAgICAgIHJldHVy\nbiBfb2lkOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBkYXRhIGZv\nciB0aGUgZmllbGQgd2l0aCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAgKi8KICAg\nIHB1YmxpYyBPYmplY3QgZ2V0RmllbGQoaW50IG51bSkgewogICAgICAgIHJl\ndHVybiBfZGF0YVtudW1dOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBkYXRhIGZvciB0aGUgZmllbGQgd2l0aCB0aGUgZ2l2ZW4gaW5kZXguCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEZpZWxkKGludCBudW0sIE9iamVj\ndCB2YWwpIHsKICAgICAgICBfZGF0YVtudW1dID0gdmFsOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSB2ZXJzaW9uIG51bWJlciBvZiB0aGUgb2Jq\nZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRWZXJzaW9uKExvbmcg\ndmVyc2lvbikgewogICAgICAgIF92ZXJzaW9uID0gdmVyc2lvbjsKICAgIH0K\nCiAgICAvKioKICAgICAqIEdldCB0aGUgdmVyc2lvbiBudW1iZXIgb2YgdGhl\nIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIExvbmcgZ2V0VmVyc2lvbigp\nIHsKICAgICAgICByZXR1cm4gX3ZlcnNpb247CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHZXQgdGhlIG1ldGFkYXRhIGFzc29jaWF0ZWQgd2l0aCB0aGUgdHlw\nZSBvZiBwZXJzaXN0ZW50IG9iamVjdCBmb3IKICAgICAqIHdoaWNoIHRoaXMg\nZGF0YSBhcHBsaWVzLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0\nYSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBMb2FkIHRoZSBkYXRhIGFuZCB2ZXJzaW9uIGlu\nZm9ybWF0aW9uIGZvciB0aGlzIG9iamVjdCBpbnRvIHRoZQogICAgICogZ2l2\nZW4gc3RhdGUgbWFuYWdlci4gT25seSBmaWVsZHMgaW4gdGhlIGdpdmVuIGZl\ndGNoIGNvbmZpZ3VyYXRpb24gYXJlCiAgICAgKiBsb2FkZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKHNtLmdl\ndFZlcnNpb24oKSA9PSBudWxsKQogICAgICAgICAgICBzbS5zZXRWZXJzaW9u\nKF92ZXJzaW9uKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBf\nbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghc20uZ2V0TG9h\nZGVkKCkuZ2V0KGkpICYmIGZldGNoLnJlcXVpcmVzRmV0Y2goZm1kc1tpXSkp\nCiAgICAgICAgICAgICAgICBzbS5zdG9yZShpLCB0b0xvYWRhYmxlKHNtLCBm\nbWRzW2ldLCBfZGF0YVtpXSwgZmV0Y2gpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIExvYWQgdGhlIGRhdGEgYW5kIHZlcnNpb24gaW5mb3JtYXRpb24gZm9y\nIHRoaXMgb2JqZWN0IGludG8gdGhlCiAgICAgKiBnaXZlbiBzdGF0ZSBtYW5h\nZ2VyLiBPbmx5IGZpZWxkcyBpbiB0aGUgZ2l2ZW4gYml0IHNldCB3aWxsIGJl\nIGxvYWRlZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgbG9hZChPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChzbS5nZXRWZXJz\naW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgc20uc2V0VmVyc2lvbihfdmVy\nc2lvbik7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEu\nZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSkK\nICAgICAgICAgICAgICAgIHNtLnN0b3JlKGksIHRvTG9hZGFibGUoc20sIGZt\nZHNbaV0sIF9kYXRhW2ldLCBmZXRjaCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3RvcmVkIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4g\naW50byBhIHZhbHVlIGZvciBsb2FkaW5nCiAgICAgKiBpbnRvIGEgc3RhdGUg\nbWFuYWdlci4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IHRv\nTG9hZGFibGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCwgT2JqZWN0IHZhbCwgRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sbGVjdGlvbiBjOwogICAgICAg\nIHN3aXRjaCAoZm1kLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIC8vIHRo\nZSBzdG9yZWQgdmFsdWUgbXVzdCBiZSBhIGNvbGxlY3Rpb24KICAgICAgICAg\nICAgICAgIGMgPSAoQ29sbGVjdGlvbikgdmFsOwoKICAgICAgICAgICAgICAg\nIC8vIHRoZSBzdGF0ZSBtYW5hZ2VyIHdpbGwgY3JlYXRlIGEgcHJveHkgY29s\nbGVjdGlvbiBvZiB0aGUgbmVlZGVkCiAgICAgICAgICAgICAgICAvLyB0eXBl\nIGRlcGVuZGluZyBvbiB0aGUgZGVjbGFyZWQgdHlwZSBvZiB0aGUgdXNlcidz\nIGZpZWxkOyB0aGUKICAgICAgICAgICAgICAgIC8vIHByb3h5IHdpbGwgcGVy\nZm9ybSBkaXJ0eSB0cmFja2luZywgZXRjCiAgICAgICAgICAgICAgICBDb2xs\nZWN0aW9uIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1k\nLmdldEluZGV4KCkpOwoKICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRo\nZSBwcm94eSBjb2xsZWN0aW9uIHdpdGggb3VyIHN0b3JlZCBkYXRhLCBjb252\nZXJ0aW5nCiAgICAgICAgICAgICAgICAvLyBpdCB0byB0aGUgcmlnaHQgdHlw\nZSBmcm9tIGl0cyBzdG9yZWQgZm9ybQogICAgICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBjLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQog\nICAgICAgICAgICAgICAgICAgIGMyLmFkZCh0b05lc3RlZExvYWRhYmxlKHNt\nLCBmbWQuZ2V0RWxlbWVudCgpLCBpdHIubmV4dCgpLAogICAgICAgICAgICAg\nICAgICAgICAgICBmZXRjaCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGMy\nOwoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAg\nICAgICAgICAvLyB0aGUgc3RvcmVkIHZhbHVlIG11c3QgYmUgYSBjb2xsZWN0\naW9uOyB3ZSBwdXQgYXJyYXlzIGludG8KICAgICAgICAgICAgICAgIC8vIGNv\nbGxlY3Rpb25zIGZvciBzdG9yYWdlCiAgICAgICAgICAgICAgICBjID0gKENv\nbGxlY3Rpb24pIHZhbDsKCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBu\nZXcgYXJyYXkgb2YgdGhlIHJpZ2h0IHR5cGU7IHVubGlrZSBjb2xsZWN0aW9u\ncyBpbgogICAgICAgICAgICAgICAgLy8gdGhlIGNhc2UgYWJvdmUsIGFycmF5\ncyBjYW5ub3QgYmUgcHJveGllZAogICAgICAgICAgICAgICAgT2JqZWN0IGEg\nPSBBcnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgpLmdldFR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICBjLnNpemUoKSk7CgogICAgICAgICAg\nICAgICAgLy8gcG9wdWxhdGUgdGhlIGFycmF5IHdpdGggb3VyIHN0b3JlZCBk\nYXRhLCBjb252ZXJ0aW5nIGl0IHRvIHRoZQogICAgICAgICAgICAgICAgLy8g\ncmlnaHQgdHlwZSBmcm9tIGl0cyBzdG9yZWQgZm9ybQogICAgICAgICAgICAg\nICAgaW50IGlkeCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4KyspCiAg\nICAgICAgICAgICAgICAgICAgQXJyYXkuc2V0KGEsIGlkeCwgdG9OZXN0ZWRM\nb2FkYWJsZShzbSwgZm1kLmdldEVsZW1lbnQoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgaXRyLm5leHQoKSwgZmV0Y2gpKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBhOwoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgog\nICAgICAgICAgICAgICAgLy8gdGhlIHN0b3JlZCB2YWx1ZSBtdXN0IGJlIGEg\nbWFwCiAgICAgICAgICAgICAgICBNYXAgbSA9IChNYXApIHZhbDsKCiAgICAg\nICAgICAgICAgICAvLyB0aGUgc3RhdGUgbWFuYWdlciB3aWxsIGNyZWF0ZSBh\nIHByb3h5IG1hcCBvZiB0aGUgbmVlZGVkCiAgICAgICAgICAgICAgICAvLyB0\neXBlIGRlcGVuZGluZyBvbiB0aGUgZGVjbGFyZWQgdHlwZSBvZiB0aGUgdXNl\ncidzIGZpZWxkOyB0aGUKICAgICAgICAgICAgICAgIC8vIHByb3h5IHdpbGwg\ncGVyZm9ybSBkaXJ0eSB0cmFja2luZywgZXRjCiAgICAgICAgICAgICAgICBN\nYXAgbTIgPSAoTWFwKSBzbS5uZXdGaWVsZFByb3h5KGZtZC5nZXRJbmRleCgp\nKTsKCiAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSB0aGUgcHJveHkgbWFw\nIHdpdGggb3VyIHN0b3JlZCBkYXRhLCBjb252ZXJ0aW5nCiAgICAgICAgICAg\nICAgICAvLyBpdCB0byB0aGUgcmlnaHQgdHlwZSBmcm9tIGl0cyBzdG9yZWQg\nZm9ybQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtLmVu\ndHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgICAgICBNYXAuRW50cnkgZSA9IChNYXAuRW50cnkpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgbTIucHV0KHRvTmVzdGVkTG9h\nZGFibGUoc20sIGZtZC5nZXRLZXkoKSwgZS5nZXRLZXkoKSxmZXRjaCksCiAg\nICAgICAgICAgICAgICAgICAgICAgIHRvTmVzdGVkTG9hZGFibGUoc20sIGZt\nZC5nZXRFbGVtZW50KCksIGUuZ2V0VmFsdWUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZldGNoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICByZXR1cm4gbTI7CgogICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgLy8ganVzdCBjb252ZXJ0IHRoZSBzdG9yZWQgdmFs\ndWUgaW50byBpdHMgbG9hZGFibGUgZXF1aXZhbGVudC4KICAgICAgICAgICAg\nICAgIHJldHVybiB0b05lc3RlZExvYWRhYmxlKHNtLCBmbWQsIHZhbCwgZmV0\nY2gpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIGdpdmVuIHN0b3JlZCB2YWx1ZSA8Y29kZT52YWw8L2NvZGU+IHRvIGEg\ndmFsdWUgZm9yIGxvYWRpbmcKICAgICAqIGludG8gYSBzdGF0ZSBtYW5hZ2Vy\nLiBUaGUgdmFsdWUgPGNvZGU+dmFsPC9jb2RlPiBtdXN0IGJlIGEgc2luZ3Vs\nYXIKICAgICAqIHZhbHVlOyBpdCBjYW5ub3QgYmUgYSBjb250YWluZXIuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0b05lc3RlZExvYWRh\nYmxlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgVmFsdWVNZXRh\nRGF0YSB2bWQsIE9iamVjdCB2YWwsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAodm1kLmdldFR5cGVDb2RlKCkp\nIHsKICAgICAgICAgICAgLy8gY2xvbmUgdGhlIGRhdGUgdG8gcHJldmVudCBk\naXJlY3QgbW9kaWZpY2F0aW9uIG9mIG91ciBzdG9yZWQgdmFsdWUKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJl\ndHVybiAoKERhdGUpIHZhbCkuY2xvbmUoKTsKCiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19V\nTlRZUEVEOgogICAgICAgICAgICAgICAgLy8gZm9yIHJlbGF0aW9ucyB0byBv\ndGhlciBwZXJzaXN0ZW50IG9iamVjdHMsIHdlIHN0b3JlIHRoZSByZWxhdGVk\nCiAgICAgICAgICAgICAgICAvLyBvYmplY3QncyBvaWQgLS0gY29udmVydCBp\ndCBiYWNrIGludG8gYSBwZXJzaXN0ZW50IGluc3RhbmNlCiAgICAgICAgICAg\nICAgICBTdG9yZUNvbnRleHQgY3R4ID0gc20uZ2V0Q29udGV4dCgpOwogICAg\nICAgICAgICAgICAgT2JqZWN0IHBjID0gY3R4LmZpbmQodmFsLCBmZXRjaCwg\nbnVsbCwgbnVsbCwgMCk7CiAgICAgICAgICAgICAgICBpZiAocGMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGM7CiAgICAgICAgICAg\nICAgICBPcnBoYW5lZEtleUFjdGlvbiBhY3Rpb24gPSBjdHguZ2V0Q29uZmln\ndXJhdGlvbigpLgogICAgICAgICAgICAgICAgICAgIGdldE9ycGhhbmVkS2V5\nQWN0aW9uSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rp\nb24ub3JwaGFuKHZhbCwgc20sIHZtZCk7CiAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBkYXRhIGFuZCB2ZXJzaW9uIGlu\nZm9ybWF0aW9uIGZvciB0aGlzIG9iamVjdCBmcm9tIHRoZQogICAgICogZ2l2\nZW4gc3RhdGUgbWFuYWdlci4gT25seSBkaXJ0eSBmaWVsZHMgd2lsbCBiZSBz\ndG9yZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN0b3JlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBfdmVyc2lvbiA9IChMb25nKSBz\nbS5nZXRWZXJzaW9uKCk7CgogICAgICAgIC8vIGlmIHRoZSB2ZXJzaW9uIGhh\ncyBub3QgYmVlbiBzZXQgaW4gdGhlIHN0YXRlIG1hbmFnZXIgKG9ubHkgdHJ1\nZQogICAgICAgIC8vIHdoZW4gdGhlIG9iamVjdCBpcyBuZXcpLCBzZXQgdGhl\nIHZlcnNpb24gbnVtYmVyIHRvIDAKICAgICAgICBpZiAoX3ZlcnNpb24gPT0g\nbnVsbCkKICAgICAgICAgICAgX3ZlcnNpb24gPSBOdW1iZXJzLnZhbHVlT2Yo\nMEwpOwoKICAgICAgICAvLyBydW4gdGhyb3VnaCBlYWNoIHBlcnNpc3RlbnQg\nZmllbGQgaW4gdGhlIHN0YXRlIG1hbmFnZXIgYW5kIHN0b3JlIGl0CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKHNtLmdldERpcnR5KCkuZ2V0KGkpCiAgICAg\nICAgICAgICAgICAmJiBmbWRzW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRz\nW2ldLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgX2RhdGFb\naV0gPSB0b1N0b3JhYmxlKGZtZHNbaV0sIHNtLmZldGNoKGkpLCBzbS5nZXRD\nb250ZXh0KCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIGdpdmVuIGZpZWxkIHZhbHVlIDxjb2RlPnZhbDwvY29kZT4g\ndG8gYSBmb3JtIHdlIGNhbiBzdG9yZS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0IHRvU3RvcmFibGUoRmllbGRNZXRhRGF0YSBmbWQsIE9i\namVjdCB2YWwsCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAg\nIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENvbGxlY3Rpb24gYzsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICBjID0gKENvbGxlY3Rpb24pIHZhbDsK\nCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBjb2xsZWN0aW9uIHRvIGNv\ncHkgdGhlIGVsZW1lbnRzIGludG8gZm9yIHN0b3JhZ2UsIGFuZAogICAgICAg\nICAgICAgICAgLy8gcG9wdWxhdGUgaXQgd2l0aCBjb252ZXJ0ZWQgZWxlbWVu\ndCB2YWx1ZXMKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gYzIgPSBuZXcg\nQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAg\nICAgICAgICAgYzIuYWRkKHRvTmVzdGVkU3RvcmFibGUoZm1kLmdldEVsZW1l\nbnQoKSwgaXRyLm5leHQoKSwgY3R4KSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYzI7CgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAg\nICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIGNvbGxlY3Rpb24gdG8gY29weSB0\naGUgZWxlbWVudHMgaW50byBmb3Igc3RvcmFnZSwgYW5kCiAgICAgICAgICAg\nICAgICAvLyBwb3B1bGF0ZSBpdCB3aXRoIGNvbnZlcnRlZCBlbGVtZW50IHZh\nbHVlcwogICAgICAgICAgICAgICAgYyA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBBcnJheS5nZXRM\nZW5ndGgodmFsKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAgICAgICAg\nIGMuYWRkKHRvTmVzdGVkU3RvcmFibGUoZm1kLmdldEVsZW1lbnQoKSwgQXJy\nYXkuZ2V0KHZhbCwgaSksCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eCkp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIGM7CgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBNYXAgbSA9IChNYXAp\nIHZhbDsKCiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBtYXAgdG8gY29w\neSB0aGUgZW50cmllcyBpbnRvIGZvciBzdG9yYWdlLCBhbmQKICAgICAgICAg\nICAgICAgIC8vIHBvcHVsYXRlIGl0IHdpdGggY29udmVydGVkIGVudHJ5IHZh\nbHVlcwogICAgICAgICAgICAgICAgTWFwIG0yID0gbmV3IEhhc2hNYXAoKTsK\nICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gbS5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICAgICAgTWFwLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAgICAgIG0yLnB1dCh0b05lc3RlZFN0b3JhYmxl\nKGZtZC5nZXRLZXkoKSwgZS5nZXRLZXkoKSwgY3R4KSwKICAgICAgICAgICAg\nICAgICAgICAgICAgdG9OZXN0ZWRTdG9yYWJsZShmbWQuZ2V0RWxlbWVudCgp\nLCBlLmdldFZhbHVlKCksIGN0eCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgcmV0dXJuIG0yOwoKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIC8vIGp1c3QgY29udmVydCB0aGUgbG9hZGVkIHZh\nbHVlIGludG8gaXRzIHN0b3JhYmxlIGVxdWl2YWxlbnQKICAgICAgICAgICAg\nICAgIHJldHVybiB0b05lc3RlZFN0b3JhYmxlKGZtZCwgdmFsLCBjdHgpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdp\ndmVuIGxvYWRlZCB2YWx1ZSA8Y29kZT52YWw8L2NvZGU+IHRvIGEgdmFsdWUg\nZm9yIHN0b3JpbmcuCiAgICAgKiBUaGUgdmFsdWUgPGNvZGU+dmFsPC9jb2Rl\nPiBtdXN0IGJlIGEgc2luZ3VsYXIgdmFsdWU7IGl0IGNhbm5vdCBiZSBhCiAg\nICAgKiBjb250YWluZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9i\namVjdCB0b05lc3RlZFN0b3JhYmxlKFZhbHVlTWV0YURhdGEgdm1kLCBPYmpl\nY3QgdmFsLAogICAgICAgIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAgICBp\nZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBzd2l0Y2ggKHZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICAvLyBpZiB0\naGUgZGF0ZSBpcyBhIHByb3h5IChzaW5jZSBEYXRlcyBhcmUgc2Vjb25kIGNs\nYXNzCiAgICAgICAgICAgICAgICAvLyBvYmplY3RzIChTQ09zKSB0aGV5IGNh\nbiBiZSBwcm94aWVkIGZvciBkaXJ0eSB0cmFja2luZywKICAgICAgICAgICAg\nICAgIC8vIGV0YykgdGhlbiBjb3B5IHRoZSB2YWx1ZSBvdXQgb2YgaXQgZm9y\nIHN0b3JhZ2UKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBQ\ncm94eSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChQcm94eSkgdmFs\nKS5jb3B5KHZhbCk7CiAgICAgICAgICAgICAgICByZXR1cm4gKChEYXRlKSB2\nYWwpLmNsb25lKCk7CgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAg\nICAgICAgICAgIHJldHVybiBjdHguZ2V0T2JqZWN0SWQodmFsKTsKCiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgICAgICAvLyBuZXN0ZWQgcmVsYXRpb24g\ndHlwZXMgKGUuZy4gY29sbGVjdGlvbnMgb2YgY29sbGVjdGlvbnMpCiAgICAg\nICAgICAgICAgICAvLyBhcmUgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigi\nVGhpcyBzdG9yZSBkb2VzIG5vdCBzdXBwb3J0ICIKICAgICAgICAgICAgICAg\nICAgICArICJuZXN0ZWQgY29udGFpbmVycyAoZS5nLiBjb2xsZWN0aW9ucyBv\nZiBjb2xsZWN0aW9ucykuIik7CgogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDbG9uZSB0aGlzIGRhdGEuCiAgICAgKi8KICAgIHB1Ymxp\nYyBPYmplY3QgY2xvbmUoKSB7CiAgICAgICAgT2JqZWN0RGF0YSBkYXRhID0g\nbmV3IE9iamVjdERhdGEoX29pZCwgX21ldGEpOwogICAgICAgIGRhdGEuc2V0\nVmVyc2lvbihfdmVyc2lvbik7CgogICAgICAgIC8vIGNvcHkgZWFjaCBmaWVs\nZAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSBfZGF0YVtpXTsK\nICAgICAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBkYXRhLnNldEZpZWxkKGksIG51bGwpOwogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoZm1k\nc1tpXS5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgZGF0YS5zZXRGaWVs\nZChpLCBuZXcgQXJyYXlMaXN0KChDb2xsZWN0aW9uKSB2YWwpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAgICBkYXRhLnNldEZpZWxk\nKGksIG5ldyBIYXNoTWFwKChNYXApIHZhbCkpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICBkYXRhLnNldEZpZWxkKGksIHZhbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWZm\nZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIkNsYXNzOiAoIiArIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXRO\nYW1lKCkgKyAiKVxuIik7CiAgICAgICAgYnVmLmFwcGVuZCgiT2JqZWN0IElk\nOiAoIiArIF9vaWQgKyAiKVxuIik7CiAgICAgICAgYnVmLmFwcGVuZCgiVmVy\nc2lvbjogKCIgKyBfdmVyc2lvbiArICIpXG4iKTsKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgIEZpZWxkOiAoIiArIGkgKyAiKVxuIik7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAgTmFtZTogKCIgKyBmbWRzW2ldLmdl\ndE5hbWUoKSArICIpXG4iKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICBW\nYWx1ZTogKCIgKyBfZGF0YVtpXSArICIpXG4iKTsKCQl9CgkJcmV0dXJuIGJ1\nZi50b1N0cmluZyAoKTsKCX0KfQo=\n","encoding":"base64"}

