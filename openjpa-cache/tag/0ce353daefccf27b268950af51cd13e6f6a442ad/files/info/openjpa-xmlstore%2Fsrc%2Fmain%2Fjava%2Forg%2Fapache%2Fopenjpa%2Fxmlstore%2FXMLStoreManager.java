{"sha":"62f052116804a8a6d6b0204768805368777ecbf5","node_id":"MDQ6QmxvYjIwNjM2NDo2MmYwNTIxMTY4MDRhOGE2ZDZiMDIwNDc2ODgwNTM2ODc3N2VjYmY1","size":10707,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/62f052116804a8a6d6b0204768805368777ecbf5","content":"LyoKICogQ29weXJpZ2h0IDIwMDYgVGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uLgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vu\nc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBu\nb3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRo\nZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExp\nY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2Vz\nL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNh\nYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICog\nZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQg\nb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9S\nIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGlt\ncGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxh\nbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlv\nbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUu\nb3BlbmpwYS54bWxzdG9yZTsKCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5D\nb2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsK\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuYWJzdHJhY3RzdG9yZS5BYnN0\ncmFjdFN0b3JlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5j\nb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5MaXN0UmVzdWx0T2JqZWN0\nUHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5S\nZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5PcHRpbWlzdGljRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBTdG9yZSBtYW5hZ2VyIHRvIGEgYmFjay1l\nbmQgY29uc2lzdGluZyBvZiBYTUwgZmlsZXMuIFRoaXMKICogaW1wbGVtZW50\nYXRpb24gYWNjZXNzZXMgZGF0YSB0aHJvdWdoIHRoZSB7QGxpbmsgWE1MU3Rv\ncmV9IGFzc29jaWF0ZWQgd2l0aAogKiBpdHMge0BsaW5rIFhNTENvbmZpZ3Vy\nYXRpb259LiBDb25maWd1cmF0aW9uIGluc3RhbmNlcyBhcmUgc2hhcmVkIGJ5\nIGFsbAogKiBzdG9yZSBtYW5hZ2VycyBvd25lZCBieSBhbGwgYnJva2VycyBj\ncmVhdGVkIHdpdGggdGhlIHNhbWUgZmFjdG9yeS4KICoKICogQHNlZSBBYnN0\ncmFjdFN0b3JlTWFuYWdlcgogKi8KcHVibGljIGNsYXNzIFhNTFN0b3JlTWFu\nYWdlcgogICAgZXh0ZW5kcyBBYnN0cmFjdFN0b3JlTWFuYWdlciB7CgogICAg\ncHJpdmF0ZSBYTUxDb25maWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBY\nTUxTdG9yZSBfc3RvcmU7CgogICAgLy8gY2hhbmdlZCBkYXRhIHdpdGhpbiB0\naGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAgcHJpdmF0ZSBDb2xsZWN0aW9u\nIF91cGRhdGVzOwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF9kZWxldGVzOwoK\nICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldFVuc3VwcG9ydGVkT3B0aW9u\ncygpIHsKICAgICAgICBDb2xsZWN0aW9uIGMgPSBzdXBlci5nZXRVbnN1cHBv\ncnRlZE9wdGlvbnMoKTsKCiAgICAgICAgLy8gcmVtb3ZlIG9wdGlvbnMgd2Ug\nZG8gc3VwcG9ydCBidXQgdGhlIGFic3RyYWN0IHN0b3JlIGRvZXNuJ3QKICAg\nICAgICBjLnJlbW92ZShPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fSURf\nREFUQVNUT1JFKTsKICAgICAgICBjLnJlbW92ZShPcGVuSlBBQ29uZmlndXJh\ndGlvbi5PUFRJT05fT1BUSU1JU1RJQyk7CgogICAgICAgIC8vIGFuZCBhZGQg\nc29tZSB0aGF0IHdlIGRvbid0IHN1cHBvcnQgYnV0IHRoZSBhYnN0cmFjdCBz\ndG9yZSBkb2VzCiAgICAgICAgYy5hZGQoT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nT1BUSU9OX0VNQkVEREVEX1JFTEFUSU9OKTsKICAgICAgICBjLmFkZChPcGVu\nSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fRU1CRURERURfQ09MTEVDVElPTl9S\nRUxBVElPTik7CiAgICAgICAgYy5hZGQoT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nT1BUSU9OX0VNQkVEREVEX01BUF9SRUxBVElPTik7CiAgICAgICAgcmV0dXJu\nIGM7CiAgICB9CgogICAgcHJvdGVjdGVkIE9wZW5KUEFDb25maWd1cmF0aW9u\nIG5ld0NvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgLy8gb3ZlcnJpZGUgdG8g\ndXNlIG91ciBjb25maWd1cmF0aW9uIHR5cGUKICAgICAgICByZXR1cm4gbmV3\nIFhNTENvbmZpZ3VyYXRpb24oKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9p\nZCBvcGVuKCkgewogICAgICAgIC8vIGNhY2hlIG9wZXJhdGlvbmFsIHN0YXRl\nCiAgICAgICAgX2NvbmYgPSAoWE1MQ29uZmlndXJhdGlvbikgY3R4LmdldENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICBfc3RvcmUgPSBfY29uZi5nZXRTdG9y\nZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGV4aXN0cyhPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8v\nIHNlZSBpZiB0aGUgZ2l2ZW4gb2JqZWN0IGV4aXN0cyBpbiB0aGUgc3RvcmUK\nICAgICAgICByZXR1cm4gX3N0b3JlLmdldERhdGEoc20uZ2V0TWV0YURhdGEo\nKSwgc20uZ2V0T2JqZWN0SWQoKSkgIT0gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEluY3JlbWVudCB0aGUgdmVyc2lvbiBpbmRpY2F0b3IgaW4gdGhl\nIGdpdmVuIHN0YXRlIG1hbmFnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIHZvaWQgaW5jcmVtZW50VmVyc2lvbihPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKSB7CiAgICAgICAgbG9uZyB2ZXJzaW9uID0gMDsKICAgICAgICBpZiAo\nc20uZ2V0VmVyc2lvbigpICE9IG51bGwpCiAgICAgICAgICAgIHZlcnNpb24g\nPSAoKExvbmcpIHNtLmdldFZlcnNpb24oKSkubG9uZ1ZhbHVlKCkgKyAxOwog\nICAgICAgIHNtLnNldE5leHRWZXJzaW9uKE51bWJlcnMudmFsdWVPZih2ZXJz\naW9uKSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaW5pdGlhbGl6ZShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLAogICAgICAg\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICAvLyB3ZSBtYXkgYWxyZWFkeSBoYXZlIGxvb2tlZCB1cCB0aGUg\nYmFja2luZyBPYmplY3REYXRhIChzZWUgb3VyIGV4dGVudAogICAgICAgIC8v\nIGltcGxlbWVudGF0aW9uIGJlbG93KSwgYW5kIHBhc3NlZCBpdCB0aHJvdWdo\nIGFzIHRoZSBjb250ZXh0OyBpZgogICAgICAgIC8vIG5vdCwgdGhlbiBsb29r\nIGl0IHVwIGluIHRoZSBzdG9yZQogICAgICAgIE9iamVjdERhdGEgZGF0YTsK\nICAgICAgICBpZiAoY29udGV4dCAhPSBudWxsKQogICAgICAgICAgICBkYXRh\nID0gKE9iamVjdERhdGEpIGNvbnRleHQ7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBkYXRhID0gX3N0b3JlLmdldERhdGEoc20uZ2V0TWV0YURhdGEoKSwg\nc20uZ2V0T2JqZWN0SWQoKSk7CgogICAgICAgIC8vIG5vIG1hdGNoaW5nIHJl\nY29yZD8KICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHN0YXRl\nIG1hbmFnZXIgd2l0aCBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgcmlnaHQKICAg\nICAgICAvLyB0eXBlIGFuZCBsaWZlY3ljbGUgc3RhdGUKICAgICAgICBzbS5p\nbml0aWFsaXplKGRhdGEuZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBl\nKCksIHN0YXRlKTsKCiAgICAgICAgLy8gbG9hZCB0aGUgZGF0YSBmcm9tIHRo\nZSBPYmplY3REYXRhIGludG8gdGhlIHN0YXRlIG1ncjsgbm90ZSB0aGF0CiAg\nICAgICAgLy8gdGhpcyBzdG9yZSBtYW5hZ2VyIGRvZXNuJ3QgZG8gYW55IGxv\nY2tpbmcgLS0gaXQgcmVsaWVzIG9uIHRoZQogICAgICAgIC8vIHN5c3RlbSdz\nIGxvY2sgbWFuYWdlciB0byBsb2NrIGFmdGVyIHRoZSBsb2FkIGlzIGNvbXBs\nZXRlCiAgICAgICAgZGF0YS5sb2FkKHNtLCBmZXRjaCk7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9hZChPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2JqZWN0\nIGNvbnRleHQpIHsKICAgICAgICAvLyB3ZSBtYXkgYWxyZWFkeSBoYXZlIGxv\nb2tlZCB1cCB0aGUgYmFja2luZyBPYmplY3REYXRhIChzZWUgb3VyIGV4dGVu\ndAogICAgICAgIC8vIGltcGxlbWVudGF0aW9uIGJlbG93KSwgYW5kIHBhc3Nl\nZCBpdCB0aHJvdWdoIGFzIHRoZSBjb250ZXh0OyBpZgogICAgICAgIC8vIG5v\ndCwgdGhlbiBsb29rIGl0IHVwIGluIHRoZSBzdG9yZQogICAgICAgIE9iamVj\ndERhdGEgZGF0YTsKICAgICAgICBpZiAoY29udGV4dCAhPSBudWxsKQogICAg\nICAgICAgICBkYXRhID0gKE9iamVjdERhdGEpIGNvbnRleHQ7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBkYXRhID0gX3N0b3JlLmdldERhdGEoc20uZ2V0\nTWV0YURhdGEoKSwgc20uZ2V0T2JqZWN0SWQoKSk7CgogICAgICAgIC8vIG5v\nIG1hdGNoaW5nIHJlY29yZD8KICAgICAgICBpZiAoZGF0YSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIGxvYWQgdGhl\nIGRhdGEgZnJvbSB0aGUgT2JqZWN0RGF0YSBpbnRvIHRoZSBzdGF0ZSBtZ3I7\nIG5vdGUgdGhhdAogICAgICAgIC8vIHRoaXMgc3RvcmUgbWFuYWdlciBkb2Vz\nbid0IGRvIGFueSBsb2NraW5nIC0tIGl0IHJlbGllcyBvbiB0aGUKICAgICAg\nICAvLyBzeXN0ZW0ncyBsb2NrIG1hbmFnZXIgdG8gbG9jayBhZnRlciB0aGUg\nbG9hZCBpcyBjb21wbGV0ZQogICAgICAgIGRhdGEubG9hZChzbSwgZmllbGRz\nLCBmZXRjaCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gc3luY1ZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBpZiAoc20uZ2V0VmVyc2lv\nbigpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgLy8gd2UgbWF5IGFscmVhZHkgaGF2ZSBsb29rZWQgdXAgdGhlIGJhY2tp\nbmcgT2JqZWN0RGF0YSAoc2VlIG91ciBleHRlbnQKICAgICAgICAvLyBpbXBs\nZW1lbnRhdGlvbiBiZWxvdyksIGFuZCBwYXNzZWQgaXQgdGhyb3VnaCBhcyB0\naGUgY29udGV4dDsgaWYKICAgICAgICAvLyBub3QsIHRoZW4gbG9vayBpdCB1\ncCBpbiB0aGUgc3RvcmUKICAgICAgICBPYmplY3REYXRhIGRhdGE7CiAgICAg\nICAgaWYgKGNvbnRleHQgIT0gbnVsbCkKICAgICAgICAgICAgZGF0YSA9IChP\nYmplY3REYXRhKSBjb250ZXh0OwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nZGF0YSA9IF9zdG9yZS5nZXREYXRhKHNtLmdldE1ldGFEYXRhKCksIHNtLmdl\ndE9iamVjdElkKCkpOwoKICAgICAgICAvLyBubyByZWNvcmQ/CiAgICAgICAg\naWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoK\nICAgICAgICAvLyBpZiB0aGUgdmVyc2lvbiBvZiBkYXRhIGhlbGQgYnkgdGhl\nIHN0YXRlIG1nciBpcyB0aGUgc2FtZSBhcyB0aGUKICAgICAgICAvLyB2ZXJz\naW9uIGluIHRoZSBkYXRhc3RvcmUsIHJldHVybiB0cnVlLCBsZXR0aW5nIHRo\nZSBicm9rZXIga25vdyB0aGF0CiAgICAgICAgLy8gaXQgZG9lc24ndCBuZWVk\nIHRvIGxvYWQgYW55IG1vcmUgZGF0YQogICAgICAgIGlmIChzbS5nZXRWZXJz\naW9uKCkuZXF1YWxzKGRhdGEuZ2V0VmVyc2lvbigpKSkKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CgogICAgICAgIC8vIHNldCB0aGUgdmVyc2lvbiB0byBi\nZSB1cC10by1kYXRlLCBhbmQgcmV0dXJuIGZhbHNlIGxldHRpbmcKICAgICAg\nICAvLyB0aGUgYnJva2VyIGtub3cgdGhhdCBpdCBuZWVkcyB0byBsb2FkIHVw\nLXRvLWRhdGUgZGF0YQogICAgICAgIHNtLnNldFZlcnNpb24oZGF0YS5nZXRW\nZXJzaW9uKCkpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBfc3RvcmUuYmVnaW5UcmFu\nc2FjdGlvbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBfc3RvcmUuZW5kVHJhbnNhY3Rp\nb24oX3VwZGF0ZXMsIF9kZWxldGVzKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBfdXBkYXRlcyA9IG51bGw7CiAgICAgICAgICAgIF9kZWxl\ndGVzID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncm9sbGJhY2soKSB7CiAgICAgICAgX3VwZGF0ZXMgPSBudWxsOwogICAgICAg\nIF9kZWxldGVzID0gbnVsbDsKICAgICAgICBfc3RvcmUuZW5kVHJhbnNhY3Rp\nb24obnVsbCwgbnVsbCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENvbGxlY3Rp\nb24gZmx1c2goQ29sbGVjdGlvbiBwTmV3LCBDb2xsZWN0aW9uIHBOZXdVcGRh\ndGVkLAogICAgICAgIENvbGxlY3Rpb24gcE5ld0ZsdXNoZWREZWxldGVkLCBD\nb2xsZWN0aW9uIHBEaXJ0eSwgQ29sbGVjdGlvbiBwRGVsZXRlZCkgewogICAg\nICAgIC8vIHdlIGRvbid0IHN1cHBvcnQgaW5jcmVtZW50YWwgZmx1c2hpbmcs\nIHNvIHBOZXdVcGRhdGVkIGFuZAogICAgICAgIC8vIHBOZXdGbHVzaGVkRGVs\nZXRlZCBzaG91bGQgYmUgZW1wdHk7IHdlIGlnbm9yZSB0aGVtIGhlcmUKCiAg\nICAgICAgLy8gdHJhY2sgb3B0aW1pc3RpYyB2aW9sYXRpb25zCiAgICAgICAg\nQ29sbGVjdGlvbiBleGNlcHMgPSBuZXcgTGlua2VkTGlzdCgpOwoKICAgICAg\nICAvLyBjb252ZXJ0IGluc3RhbmNlcyB0byBPYmplY3REYXRhcwogICAgICAg\nIF91cGRhdGVzID0gbmV3IEFycmF5TGlzdChwTmV3LnNpemUoKSArIHBEaXJ0\neS5zaXplKCkpOwogICAgICAgIF9kZWxldGVzID0gbmV3IEFycmF5TGlzdChw\nRGVsZXRlZC5zaXplKCkpOwoKICAgICAgICAvLyBjb252ZXJ0IGFkZGl0aW9u\ncwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcE5ldy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAvLyBjcmVhdGUgbmV3\nIG9iamVjdCBkYXRhIGZvciBpbnN0YW5jZQogICAgICAgICAgICBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBzbS5nZXRPYmplY3RJ\nZCgpOwogICAgICAgICAgICBPYmplY3REYXRhIGRhdGEgPSBfc3RvcmUuZ2V0\nRGF0YShzbS5nZXRNZXRhRGF0YSgpLCBvaWQpOwogICAgICAgICAgICBpZiAo\nZGF0YSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3Jl\nRXhjZXB0aW9uKCJBdHRlbXB0IHRvIGluc2VydCAiCiAgICAgICAgICAgICAg\nICAgICAgKyAibmV3IG9iamVjdCAiICsgc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkKICAgICAgICAgICAgICAgICAgICArICJ3aXRoIHRoZSBzYW1lIG9pZCBh\ncyBhbiBleGlzdGluZyBpbnN0YW5jZTogIiArIG9pZCkuCiAgICAgICAgICAg\nICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7CgogICAgICAgICAgICBkYXRhID0g\nbmV3IE9iamVjdERhdGEob2lkLCBzbS5nZXRNZXRhRGF0YSgpKTsKICAgICAg\nICAgICAgaW5jcmVtZW50VmVyc2lvbihzbSk7CiAgICAgICAgICAgIGRhdGEu\nc3RvcmUoc20pOwogICAgICAgICAgICBfdXBkYXRlcy5hZGQoZGF0YSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBjb252ZXJ0IHVwZGF0ZXMKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHBEaXJ0eS5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nID0gKE9wZW5KUEFTdGF0ZU1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIE9iamVjdERhdGEgZGF0YSA9IF9zdG9yZS5nZXREYXRhKHNtLmdldE1l\ndGFEYXRhKCksCiAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpKTsK\nCiAgICAgICAgICAgIC8vIGlmIGRhdGEgaGFzIGJlZW4gZGVsZXRlZCBvciBo\nYXMgdGhlIHdyb25nIHZlcnNpb24sIHJlY29yZAogICAgICAgICAgICAvLyBv\ncHQgbG9jayB2aW9sYXRpb24KICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVs\nbCB8fCAhZGF0YS5nZXRWZXJzaW9uKCkuZXF1YWxzKHNtLmdldFZlcnNpb24o\nKSkpIHsKICAgICAgICAgICAgICAgIGV4Y2Vwcy5hZGQobmV3IE9wdGltaXN0\naWNFeGNlcHRpb24KICAgICAgICAgICAgICAgICAgICAoc20uZ2V0TWFuYWdl\nZEluc3RhbmNlKCkpKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBzdG9yZSBjaGFuZ2VzCiAgICAg\nICAgICAgIGluY3JlbWVudFZlcnNpb24oc20pOwogICAgICAgICAgICBkYXRh\nID0gKE9iamVjdERhdGEpIGRhdGEuY2xvbmUoKTsKICAgICAgICAgICAgZGF0\nYS5zdG9yZShzbSk7CiAgICAgICAgICAgIF91cGRhdGVzLmFkZChkYXRhKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGNvbnZlcnQgZGVsZXRlcwogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gcERlbGV0ZWQuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICBPYmplY3REYXRhIGRhdGEgPSBfc3RvcmUuZ2V0RGF0YShzbS5n\nZXRNZXRhRGF0YSgpLAogICAgICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQo\nKSk7CgogICAgICAgICAgICAvLyByZWNvcmQgZGVsZXRlCiAgICAgICAgICAg\nIGlmIChkYXRhICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZGVsZXRlcy5h\nZGQoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZXhjZXBzOwog\nICAgfQoKICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRl\nRXh0ZW50KENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBib29sZWFuIHN1\nYmNsYXNzZXMsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIC8vIGFzayB0aGUgc3RvcmUgZm9yIGFsbCBPYmplY3REYXRhcyBmb3IgdGhl\nIGdpdmVuIHR5cGU7IHRoaXMKICAgICAgICAvLyBhY3R1YWxseSBnaXZlcyB1\ncyBhbGwgaW5zdGFuY2VzIG9mIHRoZSBiYXNlIGNsYXNzIG9mIHRoZSB0eXBl\nCiAgICAgICAgT2JqZWN0RGF0YVtdIGRhdGFzID0gX3N0b3JlLmdldERhdGEo\nbWV0YSk7CiAgICAgICAgQ2xhc3MgY2FuZGlkYXRlID0gbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCk7CgogICAgICAgIC8vIGNyZWF0ZSBhIGxpc3Qgb2YgdGhl\nIGNvcnJlc3BvbmRpbmcgcGVyc2lzdGVudCBvYmplY3RzIHRoYXQKICAgICAg\nICAvLyBtYXRjaCB0aGUgdHlwZSBhbmQgc3ViY2xhc3NlcyBjcml0ZXJpYQog\nICAgICAgIExpc3QgcGNzID0gbmV3IEFycmF5TGlzdChkYXRhcy5sZW5ndGgp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGF0YXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgLy8gZG9lcyB0aGlzIGluc3RhbmNlIGJlbG9u\nZyBpbiB0aGUgZXh0ZW50PwogICAgICAgICAgICBDbGFzcyBjID0gZGF0YXNb\naV0uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAg\nICAgIGlmIChjICE9IGNhbmRpZGF0ZSAmJiAoIXN1YmNsYXNzZXMKICAgICAg\nICAgICAgICAgIHx8ICFjYW5kaWRhdGUuaXNBc3NpZ25hYmxlRnJvbShjKSkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGxv\nb2sgdXAgdGhlIHBjIGluc3RhbmNlIGZvciB0aGUgZGF0YSwgcGFzc2luZyBp\nbiB0aGUgZGF0YQogICAgICAgICAgICAvLyBhcyB3ZWxsIHNvIHRoYXQgd2Ug\nY2FuIHRha2UgYWR2YW50YWdlIG9mIHRoZSBmYWN0IHRoYXQgd2UndmUKICAg\nICAgICAgICAgLy8gYWxyZWFkeSBsb29rZWQgaXQgdXAuICBub3RlIHRoYXQg\naW4gdGhlIHN0b3JlIG1hbmFnZXIncwogICAgICAgICAgICAvLyBpbml0aWFs\naXplKCksIGxvYWQoKSwgZXRjIG1ldGhvZHMgd2UgY2hlY2sgZm9yIHRoaXMg\nZGF0YQogICAgICAgICAgICAvLyBiZWluZyBwYXNzZWQgdGhyb3VnaCBhbmQg\nc2F2ZSBvdXJzZWx2ZXMgYSB0cmlwIHRvIHRoZSBzdG9yZQogICAgICAgICAg\nICAvLyBpZiBpdCBpcyBwcmVzZW50OyB0aGlzIGlzIHBhcnRpY3VsYXJseSBp\nbXBvcnRhbnQgaW4gc3lzdGVtcwogICAgICAgICAgICAvLyB3aGVyZSBhIHRy\naXAgdG8gdGhlIHN0b3JlIGNhbiBiZSBleHBlbnNpdmUuCiAgICAgICAgICAg\nIHBjcy5hZGQoY3R4LmZpbmQoZGF0YXNbaV0uZ2V0SWQoKSwgZmV0Y2gsIG51\nbGwsIGRhdGFzW2ldLCAwKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\nZXcgTGlzdFJlc3VsdE9iamVjdFByb3ZpZGVyKHBjcyk7CiAgICB9Cn0K\n","encoding":"base64"}

