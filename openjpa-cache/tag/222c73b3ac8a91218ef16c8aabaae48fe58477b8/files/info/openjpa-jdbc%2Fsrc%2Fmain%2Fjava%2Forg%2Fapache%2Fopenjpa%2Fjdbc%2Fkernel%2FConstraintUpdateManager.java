{"sha":"3db3198dd04ab43f37ef467c5cf6283796d4d45f","node_id":"MDQ6QmxvYjIwNjM2NDozZGIzMTk4ZGQwNGFiNDNmMzdlZjQ2N2M1Y2Y2MjgzNzk2ZDRkNDVm","size":21734,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3db3198dd04ab43f37ef467c5cf6283796d4d45f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbDsKCmltcG9ydCBq\nYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0\naW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlByaW1hcnlSb3c7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd0ltcGw7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dNYW5hZ2VySW1wbDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxFeGNlcHRpb25z\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3Rh\ndGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5ncmFw\naC5EZXB0aEZpcnN0QW5hbHlzaXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmdyYXBoLkVkZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmdyYXBoLkdyYXBoOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogPHA+U3RhbmRh\ncmQgdXBkYXRlIG1hbmFnZXIsIGNhcGFibGUgb2YgZm9yZWlnbiBrZXkgY29u\nc3RyYWludCBldmFsdWF0aW9uLjwvcD4KICoKICogQHNpbmNlIDEuMC4wCiAq\nLwpwdWJsaWMgY2xhc3MgQ29uc3RyYWludFVwZGF0ZU1hbmFnZXIKICAgIGV4\ndGVuZHMgQWJzdHJhY3RVcGRhdGVNYW5hZ2VyIHsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlCiAgICAgICAgKENvbnN0cmFpbnRVcGRhdGVNYW5hZ2VyLmNsYXNzKTsK\nCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckRpcnR5KCkgewogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgUHJlcGFyZWRTdGF0\nZW1lbnRNYW5hZ2VyIG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlcgogICAg\nICAgIChKREJDU3RvcmUgc3RvcmUsIENvbm5lY3Rpb24gY29ubikgewogICAg\nICAgIHJldHVybiBuZXcgUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VySW1wbChz\ndG9yZSwgY29ubik7CiAgICB9CgogICAgcHJvdGVjdGVkIFJvd01hbmFnZXIg\nbmV3Um93TWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gbmV3IFJvd01hbmFn\nZXJJbXBsKGZhbHNlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlv\nbiBmbHVzaChSb3dNYW5hZ2VyIHJvd01nciwKICAgICAgICBQcmVwYXJlZFN0\nYXRlbWVudE1hbmFnZXIgcHNNZ3IsIENvbGxlY3Rpb24gZXhjZXBzKSB7CiAg\nICAgICAgUm93TWFuYWdlckltcGwgcm1pbXBsID0gKFJvd01hbmFnZXJJbXBs\nKSByb3dNZ3I7CgogICAgICAgIC8vIGZpcnN0IHRha2UgY2FyZSBvZiBhbGwg\nc2Vjb25kYXJ5IHRhYmxlIGRlbGV0ZXMgYW5kICdhbGwgcm93JyBkZWxldGVz\nCiAgICAgICAgLy8gKHdoaWNoIGFyZSBwcm9iYWJseSBzZWNvbmRhcnkgdGFi\nbGUgZGVsZXRlcyksIHNpbmNlIG5vIGZvcmVpZ24KICAgICAgICAvLyBrZXlz\nIGV2ZXIgcmVseSBvbiBzZWNvbmRhcnkgdGFibGUgcGtzCiAgICAgICAgZmx1\nc2gocm1pbXBsLmdldEFsbFJvd0RlbGV0ZXMoKSwgcHNNZ3IpOwogICAgICAg\nIGZsdXNoKHJtaW1wbC5nZXRTZWNvbmRhcnlEZWxldGVzKCksIHBzTWdyKTsK\nCiAgICAgICAgLy8gbm93IGRvIGFueSAnYWxsIHJvdycgdXBkYXRlcwogICAg\nICAgIGZsdXNoKHJtaW1wbC5nZXRBbGxSb3dVcGRhdGVzKCksIHBzTWdyKTsK\nCiAgICAgICAgLy8gYW5hbHl6ZSBmb3JlaWduIGtleXMKICAgICAgICBDb2xs\nZWN0aW9uIGluc2VydHMgPSBybWltcGwuZ2V0SW5zZXJ0cygpOwogICAgICAg\nIENvbGxlY3Rpb24gdXBkYXRlcyA9IHJtaW1wbC5nZXRVcGRhdGVzKCk7CiAg\nICAgICAgQ29sbGVjdGlvbiBkZWxldGVzID0gcm1pbXBsLmdldERlbGV0ZXMo\nKTsKICAgICAgICBHcmFwaFtdIGdyYXBocyA9IG5ldyBHcmFwaFsyXTsgICAg\nLy8gaW5zZXJ0IGdyYXBoLCBkZWxldGUgZ3JhcGgKICAgICAgICBhbmFseXpl\nRm9yZWlnbktleXMoaW5zZXJ0cywgdXBkYXRlcywgZGVsZXRlcywgcm1pbXBs\nLCBncmFwaHMpOwoKICAgICAgICAvLyBmbHVzaCBpbnNlcnQgZ3JhcGgsIGlm\nIGFueQogICAgICAgIGJvb2xlYW4gYXV0b0Fzc2lnbiA9IHJtaW1wbC5oYXNB\ndXRvQXNzaWduQ29uc3RyYWludHMoKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBmbHVzaEdyYXBoKGdyYXBoc1swXSwgcHNNZ3IsIGF1dG9Bc3NpZ24p\nOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBTUUxFeGNlcHRp\nb25zLmdldFN0b3JlKHNlLCBkaWN0KSk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBleGNlcHMgPSBhZGRF\neGNlcHRpb24oZXhjZXBzLCBrZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBm\nbHVzaCB0aGUgcmVzdCBvZiB0aGUgaW5zZXJ0cyBhbmQgdXBkYXRlczsgaW5z\nZXJ0cyBiZWZvcmUgdXBkYXRlcwogICAgICAgIC8vIGJlY2F1c2Ugc29tZSB1\ncGRhdGUgZmtzIG1pZ2h0IHJlZmVyZW5jZSBwa3MgdGhhdCBoYXZlIHRvIGJl\nIGluc2VydGVkCiAgICAgICAgZmx1c2goaW5zZXJ0cywgcHNNZ3IpOwogICAg\nICAgIGZsdXNoKHVwZGF0ZXMsIHBzTWdyKTsKCiAgICAgICAgLy8gZmx1c2gg\ndGhlIGRlbGV0ZSBncmFwaCwgaWYgYW55CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZmx1c2hHcmFwaChncmFwaHNbMV0sIHBzTWdyLCBhdXRvQXNzaWdu\nKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgZXhjZXBzID0gYWRkRXhjZXB0aW9uKGV4Y2VwcywgU1FMRXhjZXB0\naW9ucy5nZXRTdG9yZShzZSwgZGljdCkpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgZXhjZXBzID0gYWRk\nRXhjZXB0aW9uKGV4Y2Vwcywga2UpOwogICAgICAgIH0KCiAgICAgICAgLy8g\ncHV0IHRoZSByZW1haW5kZXIgb2YgdGhlIGRlbGV0ZXMgYWZ0ZXIgdXBkYXRl\ncyBiZWNhdXNlIHNvbWUgdXBkYXRlcwogICAgICAgIC8vIG1heSBiZSBudWxs\naW5nIGZrcyB0byByb3dzIHRoYXQgYXJlIGdvaW5nIHRvIGJlIGRlbGV0ZWQK\nICAgICAgICBmbHVzaChkZWxldGVzLCBwc01ncik7CgogICAgICAgIC8vIHRh\na2UgY2FyZSBvZiBhbGwgc2Vjb25kYXJ5IHRhYmxlIGluc2VydHMgYW5kIHVw\nZGF0ZXMgbGFzdCwgc2luY2UKICAgICAgICAvLyB0aGV5IG1heSByZWx5IG9u\nIHByZXZpb3VzIGluc2VydHMgb3IgdXBkYXRlcywgYnV0IG5vdGhpbmcgcmVs\naWVzCiAgICAgICAgLy8gb24gdGhlbQogICAgICAgIGZsdXNoKHJtaW1wbC5n\nZXRTZWNvbmRhcnlVcGRhdGVzKCksIHBzTWdyKTsKCiAgICAgICAgLy8gZmx1\nc2ggYW55IGxlZnQgb3ZlciBwcmVwYXJlZCBzdGF0ZW1lbnRzCiAgICAgICAg\ncHNNZ3IuZmx1c2goKTsKICAgICAgICByZXR1cm4gZXhjZXBzOwogICAgfQoK\nICAgIC8qKgogICAgICogQW5hbHl6ZSBmb3JlaWduIGtleSBkZXBlbmRlbmNp\nZXMgb24gdGhlIGdpdmVuIHJvd3MKICAgICAqIGFuZCBjcmVhdGUgYW4gaW5z\nZXJ0IGFuZCBhIGRlbGV0ZSBncmFwaCB0byBleGVjdXRlLiAgVGhlIGluc2Vy\ndAogICAgICogZ3JhcGggd2lsbCBiZSBmbHVzaGVkIGJlZm9yZSBhbGwgb3Ro\nZXIgcm93cywgYW5kIHRoZSBkZWxldGUgZ3JhcGggd2lsbAogICAgICogYmUg\nZmx1c2hlZCBhZnRlciB0aGVtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYW5hbHl6ZUZvcmVpZ25LZXlzKENvbGxlY3Rpb24gaW5zZXJ0cywgQ29sbGVj\ndGlvbiB1cGRhdGVzLAogICAgICAgIENvbGxlY3Rpb24gZGVsZXRlcywgUm93\nTWFuYWdlckltcGwgcm93TWdyLCBHcmFwaFtdIGdyYXBocykgewogICAgICAg\nIC8vIGlmIHRoZXJlIGFyZSBhbnkgZGVsZXRlcywgd2UgaGF2ZSB0byBtYXAg\ndGhlIGluc2VydCBvYmplY3RzIG9uIHRoZWlyCiAgICAgICAgLy8gb2lkcyBz\nbyB3ZSdsbCBiZSBhYmxlIHRvIGRldGVjdCBkZWxldGUtdGhlbi1pbnNlcnQt\nc2FtZS1wayBjYXNlcwogICAgICAgIE1hcCBpbnNlcnRNYXAgPSBudWxsOwog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207CiAgICAgICAgaWYgKCFk\nZWxldGVzLmlzRW1wdHkoKSAmJiAhaW5zZXJ0cy5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgaW5zZXJ0TWFwID0gbmV3IEhhc2hNYXAoKGludCkgKGluc2Vy\ndHMuc2l6ZSgpICogMS4zMyArIDEpKTsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBpbnNlcnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICBzbSA9ICgoUm93KSBpdHIubmV4dCgpKS5n\nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVs\nbCAmJiBzbS5nZXRPYmplY3RJZCgpICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgaW5zZXJ0TWFwLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGZpcnN0IGNvbnN0\ncnVjdCB0aGUgZ3JhcGggZm9yIGRlbGV0ZXM7IHRoaXMgbWF5IGV4cGFuZCB0\nbyBpbmNsdWRlCiAgICAgICAgLy8gaW5zZXJ0cyBhbmQgdXBkYXRlcyBhcyB3\nZWxsIGlmIHRoZXJlIGFyZSBhbnkgaW5zZXJ0cyB0aGF0IHJlbHkgb24KICAg\nICAgICAvLyBkZWxldGVzIChkZWxldGUtdGhlbi1pbnNlcnQtc2FtZS1wayBj\nYXNlcykKICAgICAgICBQcmltYXJ5Um93IHJvdzsKICAgICAgICBSb3cgcm93\nMjsKICAgICAgICBGb3JlaWduS2V5W10gZmtzOwogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgZmtWYWw7CiAgICAgICAgYm9vbGVhbiBpZ25vcmVVcGRh\ndGVzID0gdHJ1ZTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGRlbGV0\nZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\ncm93ID0gKFByaW1hcnlSb3cpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlm\nICghcm93LmlzVmFsaWQoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgcm93MiA9IGdldEluc2VydFJvdyhpbnNlcnRNYXAsIHJv\nd01nciwgcm93KTsKICAgICAgICAgICAgaWYgKHJvdzIgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWdub3JlVXBkYXRlcyA9IGZhbHNlOwogICAgICAg\nICAgICAgICAgZ3JhcGhzWzFdID0gYWRkRWRnZShncmFwaHNbMV0sIChQcmlt\nYXJ5Um93KSByb3cyLCByb3csIG51bGwpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBub3cgY2hlY2sgdGhpcyByb3cncyBma3MgYWdhaW5zdCBv\ndGhlciBkZWxldGVzCiAgICAgICAgICAgIGZrcyA9IHJvdy5nZXRUYWJsZSgp\nLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAw\nOyBqIDwgZmtzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAvLyB3\naGVuIGRlbGV0aW5nIHJlZiBma3MgdGhleSdsbCBqdXN0IHNldCBhIHdoZXJl\nIHZhbHVlLCBzbwogICAgICAgICAgICAgICAgLy8gY2hlY2sgYm90aCBmb3Ig\nZmsgdXBkYXRlcyAocmVsYXRpb24gZmtzKSBhbmQgd2hlcmVzIChyZWYgZmtz\nKQogICAgICAgICAgICAgICAgZmtWYWwgPSByb3cuZ2V0Rm9yZWlnbktleVNl\ndChma3Nbal0pOwogICAgICAgICAgICAgICAgaWYgKGZrVmFsID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgZmtWYWwgPSByb3cuZ2V0Rm9yZWlnbktl\neVdoZXJlKGZrc1tqXSk7CiAgICAgICAgICAgICAgICBpZiAoZmtWYWwgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgICAgICByb3cyID0gcm93TWdyLmdldFJvdyhma3Nbal0uZ2V0UHJpbWFy\neUtleVRhYmxlKCksCiAgICAgICAgICAgICAgICAgICAgUm93LkFDVElPTl9E\nRUxFVEUsIGZrVmFsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAocm93\nMiAhPSBudWxsICYmIHJvdzIuaXNWYWxpZCgpICYmIHJvdzIgIT0gcm93KQog\nICAgICAgICAgICAgICAgICAgIGdyYXBoc1sxXSA9IGFkZEVkZ2UoZ3JhcGhz\nWzFdLCAoUHJpbWFyeVJvdykgcm93Miwgcm93LAogICAgICAgICAgICAgICAg\nICAgICAgICBma3Nbal0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBpZiAoaWdub3JlVXBkYXRlcykKICAgICAgICAgICAgZ3JhcGhzWzBd\nID0gYW5hbHl6ZUFnYWluc3RJbnNlcnRzKGluc2VydHMsIHJvd01nciwgZ3Jh\ncGhzWzBdKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcHV0IGlu\nc2VydHMgKmFuZCB1cGRhdGVzKiBpbiB0aGUgZGVsZXRlIGdyYXBoOyB0aGV5\nIGFsbCByZWx5CiAgICAgICAgICAgIC8vIG9uIGVhY2ggb3RoZXIKICAgICAg\nICAgICAgZ3JhcGhzWzFdID0gYW5hbHl6ZUFnYWluc3RJbnNlcnRzKHVwZGF0\nZXMsIHJvd01nciwgZ3JhcGhzWzFdKTsKICAgICAgICAgICAgZ3JhcGhzWzFd\nID0gYW5hbHl6ZUFnYWluc3RJbnNlcnRzKGluc2VydHMsIHJvd01nciwgZ3Jh\ncGhzWzFdKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVj\nayB0byBzZWUgaWYgdGhlcmUgaXMgYW4gaW5zZXJ0IGZvciBmb3IgdGhlIHNh\nbWUgdGFibGUgYW5kIHByaW1hcnkKICAgICAqIGtleSB2YWx1ZXMgYXMgdGhl\nIGdpdmVuIGRlbGV0ZSByb3cuCiAgICAgKi8KICAgIHByaXZhdGUgUm93IGdl\ndEluc2VydFJvdyhNYXAgaW5zZXJ0TWFwLCBSb3dNYW5hZ2VySW1wbCByb3dN\nZ3IsIFJvdyByb3cpIHsKICAgICAgICBpZiAoaW5zZXJ0TWFwID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtID0gcm93LmdldFByaW1hcnlLZXkoKTsKICAgICAgICBp\nZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIC8vIGxvb2sgZm9yIGEgbmV3IG9iamVjdCB3aG9zZSBpbnNlcnQgaWQg\naXMgdGhlIHNhbWUgYXMgdGhpcyBkZWxldGUgb25lCiAgICAgICAgT2JqZWN0\nIG9pZCA9IHNtLmdldE9iamVjdElkKCk7CiAgICAgICAgT3BlbkpQQVN0YXRl\nTWFuYWdlciBuc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgaW5zZXJ0TWFw\nLmdldChvaWQpOwogICAgICAgIGlmIChuc20gPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGZvdW5kIG5ldyBvYmplY3Q7\nIGdldCBpdHMgcm93CiAgICAgICAgcm93ID0gcm93TWdyLmdldFJvdyhyb3cu\nZ2V0VGFibGUoKSwgUm93LkFDVElPTl9JTlNFUlQsIG5zbSwgZmFsc2UpOwog\nICAgICAgIHJldHVybiAocm93ID09IG51bGwgfHwgcm93LmlzVmFsaWQoKSkg\nPyByb3cgOiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQW5hbHl6ZSB0\naGUgZ2l2ZW4gcm93cyBhZ2FpbnN0IHRoZSBpbnNlcnRzLCBwbGFjaW5nIGRl\ncGVuZGVuY2llcwogICAgICogaW4gdGhlIGdpdmVuIGdyYXBoLgogICAgICov\nCiAgICBwcml2YXRlIEdyYXBoIGFuYWx5emVBZ2FpbnN0SW5zZXJ0cyhDb2xs\nZWN0aW9uIHJvd3MsIFJvd01hbmFnZXJJbXBsIHJvd01nciwKICAgICAgICBH\ncmFwaCBncmFwaCkgewogICAgICAgIFByaW1hcnlSb3cgcm93OwogICAgICAg\nIFJvdyByb3cyOwogICAgICAgIEZvcmVpZ25LZXlbXSBma3M7CiAgICAgICAg\nQ29sdW1uW10gY29sczsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHJv\nd3MuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\ncm93ID0gKFByaW1hcnlSb3cpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlm\nICghcm93LmlzVmFsaWQoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgLy8gY2hlY2sgdGhpcyByb3cncyBma3MgYWdhaW5zdCBp\nbnNlcnRzOyBhIGxvZ2ljYWwgZmsgdG8gYW4gYXV0by1pbmMKICAgICAgICAg\nICAgLy8gY29sdW1uIGlzIHRyZWF0ZWQganVzdCBhcyBhY3R1YWwgZGF0YWJh\nc2UgZmsgYmVjYXVzZSB0aGUgcmVzdWx0CiAgICAgICAgICAgIC8vIGlzIHRo\nZSBzYW1lOiB0aGUgcGsgcm93IGhhcyB0byBiZSBpbnNlcnRlZCBiZWZvcmUg\ndGhlIGZrIHJvdwogICAgICAgICAgICBma3MgPSByb3cuZ2V0VGFibGUoKS5n\nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsg\naiA8IGZrcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKHJv\ndy5nZXRGb3JlaWduS2V5U2V0KGZrc1tqXSkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBzZWUg\naWYgdGhpcyByb3cgaXMgZGVwZW5kZW50IG9uIGFub3RoZXIuICBpZiBpdCdz\nIG9ubHkKICAgICAgICAgICAgICAgIC8vIGRlcGVuZW50IG9uIGl0c2VsZiwg\nc2VlIGlmIHRoZSBmayBpcyBsb2dpY2FsIG9yIGRlZmVycmVkLCBpbgogICAg\nICAgICAgICAgICAgLy8gd2hpY2ggY2FzZSBpdCBtdXN0IGJlIGFuIGF1dG8t\naW5jIGJlY2F1c2Ugb3RoZXJ3aXNlIHdlCiAgICAgICAgICAgICAgICAvLyB3\nb3VsZG4ndCBoYXZlIHJlY29yZGVkIGl0CiAgICAgICAgICAgICAgICByb3cy\nID0gcm93TWdyLmdldFJvdyhma3Nbal0uZ2V0UHJpbWFyeUtleVRhYmxlKCks\nCiAgICAgICAgICAgICAgICAgICAgUm93LkFDVElPTl9JTlNFUlQsIHJvdy5n\nZXRGb3JlaWduS2V5U2V0KGZrc1tqXSksIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGlmIChyb3cyICE9IG51bGwgJiYgcm93Mi5pc1ZhbGlkKCkgJiYgKHJv\ndzIgIT0gcm93CiAgICAgICAgICAgICAgICAgICAgfHwgZmtzW2pdLmlzRGVm\nZXJyZWQoKSB8fCBma3Nbal0uaXNMb2dpY2FsKCkpKQogICAgICAgICAgICAg\nICAgICAgIGdyYXBoID0gYWRkRWRnZShncmFwaCwgcm93LCAoUHJpbWFyeVJv\ndykgcm93MiwgZmtzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gc2VlIGlmIHRoZXJlIGFyZSBhbnkgcmVsYXRpb24gaWQgY29sdW1ucyBk\nZXBlbmRlbnQgb24KICAgICAgICAgICAgLy8gYXV0by1pbmMgb2JqZWN0cwog\nICAgICAgICAgICBjb2xzID0gcm93LmdldFRhYmxlKCkuZ2V0UmVsYXRpb25J\nZENvbHVtbnMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBj\nb2xzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtID0gcm93LmdldFJlbGF0aW9uSWRTZXQoY29sc1tqXSk7\nCiAgICAgICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICByb3cyID0gcm93\nTWdyLmdldFJvdyhnZXRCYXNlVGFibGUoc20pLCBSb3cuQUNUSU9OX0lOU0VS\nVCwKICAgICAgICAgICAgICAgICAgICBzbSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgaWYgKHJvdzIgIT0gbnVsbCAmJiByb3cyLmlzVmFsaWQoKSkKICAg\nICAgICAgICAgICAgICAgICBncmFwaCA9IGFkZEVkZ2UoZ3JhcGgsIHJvdywg\nKFByaW1hcnlSb3cpIHJvdzIsIGNvbHNbal0pOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBncmFwaDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgYmFzZSB0YWJsZSBmb3IgdGhlIGdpdmVuIGlu\nc3RhbmNlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBUYWJsZSBnZXRC\nYXNlVGFibGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIENs\nYXNzTWFwcGluZyBjbHMgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0\nYSgpOwogICAgICAgIHdoaWxlIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgY2xzID0gY2xzLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIHJldHVy\nbiBjbHMuZ2V0VGFibGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBh\nbiBlZGdlIGJldHdlZW4gdGhlIGdpdmVuIHJvd3MgaW4gdGhlIGdpdmVuIGZv\ncmVpZ24ga2V5IGdyYXBoLgogICAgICovCiAgICBwcml2YXRlIEdyYXBoIGFk\nZEVkZ2UoR3JhcGggZ3JhcGgsIFByaW1hcnlSb3cgcm93MSwgUHJpbWFyeVJv\ndyByb3cyLAogICAgICAgIE9iamVjdCBmaykgewogICAgICAgIC8vIGRlbGF5\nIGNyZWF0aW9uIG9mIHRoZSBncmFwaAogICAgICAgIGlmIChncmFwaCA9PSBu\ndWxsKQogICAgICAgICAgICBncmFwaCA9IG5ldyBHcmFwaCgpOwoKICAgICAg\nICByb3cxLnNldERlcGVuZGVudCh0cnVlKTsKICAgICAgICByb3cyLnNldERl\ncGVuZGVudCh0cnVlKTsKICAgICAgICBncmFwaC5hZGROb2RlKHJvdzEpOwog\nICAgICAgIGdyYXBoLmFkZE5vZGUocm93Mik7CgogICAgICAgIC8vIGFkZCBh\nbiBlZGdlIGZyb20gcm93MSB0byByb3cyLCBhbmQgc2V0IHRoZSBmayBjYXVz\naW5nIHRoZQogICAgICAgIC8vIGRlcGVuZGVuY3kgYXMgdGhlIHVzZXIgb2Jq\nZWN0IHNvIHdlIGNhbiByZXRyaWV2ZSBpdCB3aGVuIHJlc29sdmluZwogICAg\nICAgIC8vIGNpcmN1bGFyIGNvbnN0cmFpbnRzCiAgICAgICAgRWRnZSBlZGdl\nID0gbmV3IEVkZ2Uocm93MSwgcm93MiwgdHJ1ZSk7CiAgICAgICAgZWRnZS5z\nZXRVc2VyT2JqZWN0KGZrKTsKICAgICAgICBncmFwaC5hZGRFZGdlKGVkZ2Up\nOwoKICAgICAgICByZXR1cm4gZ3JhcGg7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGbHVzaCB0aGUgZ2l2ZW4gZ3JhcGggb2Ygcm93cyBpbiB0aGUgcHJvcGVy\nIG9yZGVyLgogICAgICogQHBhcmFtIGdyYXBoIFRoZSBncmFwaCBvZiBzdGF0\nZW1lbnRzIHRvIGJlIHdhbGtlZAogICAgICogQHBhcmFtIHBzTWdyIFRoZSBw\ncmVwYXJlZCBzdGF0ZW1lbnQgbWFuYWdlciB0byB1c2UgdG8gaXNzdWUgdGhl\nCiAgICAgKiBzdGF0ZW1lbnRzCiAgICAgKiBAcGFyYW0gYXV0b0Fzc2lnbiBX\naGV0aGVyIGFueSBvZiB0aGUgcm93cyBpbiB0aGUgZ3JhcGggaGF2ZSBhbnkK\nICAgICAqIGF1dG8tYXNzaWduIGNvbnN0cmFpbnRzCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGZsdXNoR3JhcGgoR3JhcGggZ3JhcGgsIFByZXBhcmVk\nU3RhdGVtZW50TWFuYWdlciBwc01nciwKICAgICAgICBib29sZWFuIGF1dG9B\nc3NpZ24pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGdyYXBoID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgRGVwdGhGaXJzdEFuYWx5c2lzIGRmYSA9IG5ld0RlcHRoRmlyc3RBbmFs\neXNpcyhncmFwaCwgYXV0b0Fzc2lnbik7CiAgICAgICAgQ29sbGVjdGlvbiBp\nbnNlcnRVcGRhdGVzID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBDb2xs\nZWN0aW9uIGRlbGV0ZVVwZGF0ZXMgPSBuZXcgTGlua2VkTGlzdCgpOwogICAg\nICAgIGJvb2xlYW4gcmVjYWxjdWxhdGU7CgogICAgICAgIC8vIEhhbmRsZSBj\naXJjdWxhciBjb25zdHJhaW50czoKICAgICAgICAvLyAtIGlmIGRlbGV0ZWQg\ncm93IEEgaGFzIGEgY2lyaWN1bGFyIGZrIHRvIGRlbGV0ZWQgcm93IEIsIAog\nICAgICAgIC8vICAgdGhlbiB1c2UgYW4gdXBkYXRlIHN0YXRlbWVudCB0byBu\ndWxsIEEncyBmayB0byBCIGJlZm9yZSBmbHVzaGluZywgCiAgICAgICAgLy8g\nICBhbmQgdGhlbiBmbHVzaAogICAgICAgIC8vIC0gaWYgaW5zZXJ0ZWQgcm93\nIEEgaGFzIGEgY2lyY3VsYXIgZmsgdG8gdXBkYXRlZC9pbnNlcnRlZCByb3cg\nQiwKICAgICAgICAvLyAgIHRoZW4gbnVsbCB0aGUgZmsgaW4gdGhlIEIgcm93\nIG9iamVjdCwgdGhlbiBmbHVzaCwKICAgICAgICAvLyAgIGFuZCBhZnRlciBm\nbHVzaGluZywgdXNlIGFuIHVwZGF0ZSB0byBzZXQgdGhlIGZrIGJhY2sgdG8g\nQQogICAgICAgIC8vIERlcGVuZGluZyBvbiB3aGVyZSBjaXJjdWxhciBkZXBl\nbmRlbmNpZXMgYXJlIGJyb2tlbiwgdGhlICAKICAgICAgICAvLyB0b3BvbG9n\naWNhbCBvcmRlciBvZiB0aGUgZ3JhcGggbm9kZXMgaGFzIHRvIGJlIHJlLWNh\nbGN1bGF0ZWQuCiAgICAgICAgcmVjYWxjdWxhdGUgPSByZXNvbHZlQ3ljbGVz\nKGdyYXBoLCBkZmEuZ2V0RWRnZXMoRWRnZS5UWVBFX0JBQ0spLAogICAgICAg\nICAgICAgICAgZGVsZXRlVXBkYXRlcywgaW5zZXJ0VXBkYXRlcyk7CiAgICAg\nICAgcmVjYWxjdWxhdGUgfD0gcmVzb2x2ZUN5Y2xlcyhncmFwaCwgZGZhLmdl\ndEVkZ2VzKEVkZ2UuVFlQRV9GT1JXQVJEKSwKICAgICAgICAgICAgICAgIGRl\nbGV0ZVVwZGF0ZXMsIGluc2VydFVwZGF0ZXMpOwoKICAgICAgICBpZiAocmVj\nYWxjdWxhdGUpIHsKICAgICAgICAgICAgZGZhID0gcmVjYWxjdWxhdGVEZXB0\naEZpcnN0QW5hbHlzaXMoZ3JhcGgsIGF1dG9Bc3NpZ24pOwogICAgICAgIH0K\nCiAgICAgICAgLy8gZmx1c2ggZGVsZXRlIHVwZGF0ZXMgdG8gbnVsbCBma3Ms\nIHRoZW4gYWxsIHJvd3MgaW4gb3JkZXIsIHRoZW4KICAgICAgICAvLyB0aGUg\naW5zZXJ0IHVwZGF0ZXMgdG8gc2V0IGNpcmN1bGFyIGZrIHZhbHVlcwogICAg\nICAgIGZsdXNoKGRlbGV0ZVVwZGF0ZXMsIHBzTWdyKTsKICAgICAgICBDb2xs\nZWN0aW9uIG5vZGVzID0gZGZhLmdldFNvcnRlZE5vZGVzKCk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBub2Rlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgcHNNZ3IuZmx1c2goKFJvd0ltcGwpIGl0\nci5uZXh0KCkpOwogICAgICAgIGZsdXNoKGluc2VydFVwZGF0ZXMsIHBzTWdy\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEJyZWFrIGEgY2lyY3VsYXIgZGVw\nZW5kZW5jeSBjYXVzZWQgYnkgZGVsZXRlIG9wZXJhdGlvbnMuCiAgICAgKiBJ\nZiBkZWxldGVkIHJvdyBBIGhhcyBhIGNpcmljdWxhciBmayB0byBkZWxldGVk\nIHJvdyBCLCB0aGVuIHVzZSBhbiB1cGRhdGUgCiAgICAgKiBzdGF0ZW1lbnQg\ndG8gbnVsbCBBJ3MgZmsgdG8gQiBiZWZvcmUgZGVsZXRpbmcgQiwgdGhlbiBk\nZWxldGUgQS4KICAgICAqIEBwYXJhbSBlZGdlIEVkZ2UgaW4gdGhlIGRlcGVu\nZGVuY3kgZ3JhcGggY29ycmVzcG9uZGluZyB0byBhIGZvcmVpZ24ga2V5CiAg\nICAgKiBjb25zdHJhaW50LiBUaGlzIGRlcGVuZGVuY3kgaXMgYnJva2VuIGJ5\nIG51bGxpZnlpbmcgdGhlIGZvcmVpZ24ga2V5LgogICAgICogQHBhcmFtIGRl\nbGV0ZVVwZGF0ZXMgQ29sbGVjdGlvbiBvZiB1cGRhdGUgc3RhdGVtZW50cyB0\naGF0IGFyZSBleGVjdXRlZAogICAgICogYmVmb3JlIHRoZSBkZWxldGUgb3Bl\ncmF0aW9ucyBhcmUgZmx1c2hlZCAKICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZERlbGV0ZVVwZGF0ZShFZGdlIGVkZ2UsIENvbGxlY3Rpb24gZGVsZXRl\nVXBkYXRlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBQcmltYXJ5Um93IHJvdzsKICAgICAgICBSb3dJbXBsIHVwZGF0ZTsKICAg\nICAgICBGb3JlaWduS2V5IGZrOwoKICAgICAgICAvLyBjb3B5IHdoZXJlIGNv\nbmRpdGlvbnMgaW50byBuZXcgdXBkYXRlIHRoYXQgbnVsbHMgdGhlIGZrCiAg\nICAgICAgcm93ID0gKFByaW1hcnlSb3cpIGVkZ2UuZ2V0VG8oKTsKICAgICAg\nICB1cGRhdGUgPSBuZXcgUHJpbWFyeVJvdyhyb3cuZ2V0VGFibGUoKSwgUm93\nLkFDVElPTl9VUERBVEUsIG51bGwpOwogICAgICAgIHJvdy5jb3B5SW50byh1\ncGRhdGUsIHRydWUpOwogICAgICAgIGlmIChlZGdlLmdldFVzZXJPYmplY3Qo\nKSBpbnN0YW5jZW9mIEZvcmVpZ25LZXkpIHsKICAgICAgICAgICAgZmsgPSAo\nRm9yZWlnbktleSkgZWRnZS5nZXRVc2VyT2JqZWN0KCk7CiAgICAgICAgICAg\nIHVwZGF0ZS5zZXRGb3JlaWduS2V5KGZrLCByb3cuZ2V0Rm9yZWlnbktleUlP\nKGZrKSwgbnVsbCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHVwZGF0\nZS5zZXROdWxsKChDb2x1bW4pIGVkZ2UuZ2V0VXNlck9iamVjdCgpKTsKCiAg\nICAgICAgZGVsZXRlVXBkYXRlcy5hZGQodXBkYXRlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEJyZWFrIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSBjYXVzZWQg\nYnkgaW5zZXJ0IG9wZXJhdGlvbnMuCiAgICAgKiBJZiBpbnNlcnRlZCByb3cg\nQSBoYXMgYSBjaXJjdWxhciBmayB0byB1cGRhdGVkL2luc2VydGVkIHJvdyBC\nLAogICAgICogdGhlbiBudWxsIHRoZSBmayBpbiB0aGUgQiByb3cgb2JqZWN0\nLCB0aGVuIGZsdXNoLAogICAgICogYW5kIGFmdGVyIGZsdXNoaW5nLCB1c2Ug\nYW4gdXBkYXRlIHRvIHNldCB0aGUgZmsgYmFjayB0byBBLgogICAgICogQHBh\ncmFtIHJvdyBSb3cgdG8gYmUgZmx1c2hlZAogICAgICogQHBhcmFtIGVkZ2Ug\nRWRnZSBpbiB0aGUgZGVwZW5kZW5jeSBncmFwaCBjb3JyZXNwb25kaW5nIHRv\nIGEgZm9yZWlnbiBrZXkKICAgICAqIGNvbnN0cmFpbnQuIFRoaXMgZGVwZW5k\nZW5jeSBpcyBicm9rZW4gYnkgbnVsbGlmeWluZyB0aGUgZm9yZWlnbiBrZXku\nCiAgICAgKiBAcGFyYW0gaW5zZXJ0VXBkYXRlcyBDb2xsZWN0aW9uIG9mIHVw\nZGF0ZSBzdGF0ZW1lbnRzIHRoYXQgYXJlIGV4ZWN1dGVkCiAgICAgKiBhZnRl\nciB0aGUgaW5zZXJ0L3VwZGF0ZSBvcGVyYXRpb25zIGFyZSBmbHVzaGVkIAog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkSW5zZXJ0VXBkYXRlKFByaW1h\ncnlSb3cgcm93LCBFZGdlIGVkZ2UsCiAgICAgICAgQ29sbGVjdGlvbiBpbnNl\ncnRVcGRhdGVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBSb3dJ\nbXBsIHVwZGF0ZTsKICAgICAgICBGb3JlaWduS2V5IGZrOwogICAgICAgIENv\nbHVtbiBjb2w7CgogICAgICAgIC8vIGNvcHkgd2hlcmUgY29uZGl0aW9ucyBp\nbnRvIG5ldyB1cGRhdGUgdGhhdCBzZXRzIHRoZSBmawogICAgICAgIHVwZGF0\nZSA9IG5ldyBQcmltYXJ5Um93KHJvdy5nZXRUYWJsZSgpLCBSb3cuQUNUSU9O\nX1VQREFURSwgbnVsbCk7CiAgICAgICAgaWYgKHJvdy5nZXRBY3Rpb24oKSA9\nPSBSb3cuQUNUSU9OX0lOU0VSVCkgewogICAgICAgICAgICBpZiAocm93Lmdl\ndFByaW1hcnlLZXkoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZWYtY3ljbGUiKSk7\nCiAgICAgICAgICAgIHVwZGF0ZS53aGVyZVByaW1hcnlLZXkocm93LmdldFBy\naW1hcnlLZXkoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g\nUm93LkFDVElPTl9VUERBVEUKICAgICAgICAgICAgcm93LmNvcHlJbnRvKHVw\nZGF0ZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmIChlZGdlLmdldFVz\nZXJPYmplY3QoKSBpbnN0YW5jZW9mIEZvcmVpZ25LZXkpIHsKICAgICAgICAg\nICAgZmsgPSAoRm9yZWlnbktleSkgZWRnZS5nZXRVc2VyT2JqZWN0KCk7CiAg\nICAgICAgICAgIHVwZGF0ZS5zZXRGb3JlaWduS2V5KGZrLCByb3cuZ2V0Rm9y\nZWlnbktleUlPKGZrKSwKICAgICAgICAgICAgICAgIHJvdy5nZXRGb3JlaWdu\nS2V5U2V0KGZrKSk7CiAgICAgICAgICAgIHJvdy5jbGVhckZvcmVpZ25LZXko\nZmspOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbCA9IChDb2x1\nbW4pIGVkZ2UuZ2V0VXNlck9iamVjdCgpOwogICAgICAgICAgICB1cGRhdGUu\nc2V0UmVsYXRpb25JZChjb2wsIHJvdy5nZXRSZWxhdGlvbklkU2V0KGNvbCks\nCiAgICAgICAgICAgICAgICByb3cuZ2V0UmVsYXRpb25JZENhbGxiYWNrKGNv\nbCkpOwogICAgICAgICAgICByb3cuY2xlYXJSZWxhdGlvbklkKGNvbCk7CiAg\nICAgICAgfQoKICAgICAgICBpbnNlcnRVcGRhdGVzLmFkZCh1cGRhdGUpOwog\nICAgfQoKICAgIC8qKgogICAgICogRmluZHMgYSBudWxsYWJsZSBmb3JlaWdu\nIGtleSBieSB3YWxraW5nIHRoZSBkZXBlbmRlbmN5IGN5Y2xlLiAKICAgICAq\nIENpcmN1bGFyIGRlcGVuZGVuY2llcyBjYW4gYmUgYnJva2VuIGF0IHRoaXMg\ncG9pbnQuCiAgICAgKiBAcGFyYW0gY3ljbGUgQ3ljbGUgaW4gdGhlIGRlcGVu\nZGVuY3kgZ3JhcGguCiAgICAgKiBAcmV0dXJuIEVkZ2UgY29ycmVzcG9uZGlu\nZyB0byBhIG51bGxhYmxlIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwcml2\nYXRlIEVkZ2UgZmluZEJyZWFrYWJsZUxpbmsoTGlzdCBjeWNsZSkgewogICAg\nICAgIEVkZ2UgYnJlYWthYmxlTGluayA9IG51bGw7CiAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdGVyID0gY3ljbGUuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0\nKCk7ICkgewogICAgICAgICAgICBFZGdlIGVkZ2UgPSAoRWRnZSkgaXRlci5u\nZXh0KCk7CiAgICAgICAgICAgIE9iamVjdCB1c2VyT2JqZWN0ID0gZWRnZS5n\nZXRVc2VyT2JqZWN0KCk7CiAgICAgICAgICAgIGlmICh1c2VyT2JqZWN0IGlu\nc3RhbmNlb2YgRm9yZWlnbktleSkgewogICAgICAgICAgICAgICAgIGlmICgh\nKChGb3JlaWduS2V5KSB1c2VyT2JqZWN0KS5oYXNOb3ROdWxsQ29sdW1ucygp\nKSB7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrYWJsZUxpbmsgPSBlZGdl\nOwogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlck9iamVjdCBpbnN0YW5j\nZW9mIENvbHVtbikgewogICAgICAgICAgICAgICAgaWYgKCEoKENvbHVtbikg\ndXNlck9iamVjdCkuaXNOb3ROdWxsKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBicmVha2FibGVMaW5rID0gZWRnZTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gYnJlYWthYmxlTGluazsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlLWNhbGN1bGF0ZXMgdGhlIERlcHRoRmlyc3RTZWFyY2gg\nYW5hbHlzaXMgb2YgdGhlIGdyYXBoIAogICAgICogYWZ0ZXIgc29tZSBvZiB0\naGUgZWRnZXMgaGF2ZSBiZWVuIHJlbW92ZWQuIEVuc3VyZXMKICAgICAqIHRo\nYXQgdGhlIGRlcGVuZGVuY3kgZ3JhcGggaXMgY3ljbGUgZnJlZS4KICAgICAq\nIEBwYXJhbSBncmFwaCBUaGUgZ3JhcGggb2Ygc3RhdGVtZW50cyB0byBiZSB3\nYWxrZWQKICAgICAqIEBwYXJhbSBhdXRvQXNzaWduIFdoZXRoZXIgYW55IG9m\nIHRoZSByb3dzIGluIHRoZSBncmFwaCBoYXZlIGFueQogICAgICogYXV0by1h\nc3NpZ24gY29uc3RyYWludHMKICAgICAqLwogICAgcHJpdmF0ZSBEZXB0aEZp\ncnN0QW5hbHlzaXMgcmVjYWxjdWxhdGVEZXB0aEZpcnN0QW5hbHlzaXMoR3Jh\ncGggZ3JhcGgsCiAgICAgICAgYm9vbGVhbiBhdXRvQXNzaWduKSB7CiAgICAg\nICAgRGVwdGhGaXJzdEFuYWx5c2lzIGRmYTsKICAgICAgICAvLyBjbGVhciBw\ncmV2aW91cyB0cmF2ZXJzYWwgZGF0YQogICAgICAgIGdyYXBoLmNsZWFyVHJh\ndmVyc2FsKCk7CiAgICAgICAgZGZhID0gbmV3RGVwdGhGaXJzdEFuYWx5c2lz\nKGdyYXBoLCBhdXRvQXNzaWduKTsKICAgICAgICAvLyBtYWtlIHN1cmUgdGhh\ndCB0aGUgZ3JhcGggaXMgbm9uLWN5Y2xpYyBub3cKICAgICAgICBhc3NlcnQg\nKGRmYS5oYXNOb0N5Y2xlcygpKTogX2xvYy5nZXQoImdyYXBoLW5vdC1jeWNs\nZS1mcmVlIik7CiAgICAgICAgcmV0dXJuIGRmYTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlc29sdmUgY2lyY3VsYXIgZGVwZW5kZW5jaWVzIGJ5IGlkZW50\naWZ5aW5nIGFuZCBicmVha2luZwogICAgICogYSBudWxsYWJsZSBmb3JlaWdu\nIGtleS4KICAgICAqIEBwYXJhbSBncmFwaCBEZXBlbmRlbmN5IGdyYXBoLgog\nICAgICogQHBhcmFtIGVkZ2VzIENvbGxlY3Rpb24gb2YgZWRnZXMuIEVhY2gg\nZWRnZSBpbmRpY2F0ZXMgYSBwb3NzaWJsZSAKICAgICAqIGNpcmN1bGFyIGRl\ncGVuZGVuY3kKICAgICAqIEBwYXJhbSBkZWxldGVVcGRhdGVzIENvbGxlY3Rp\nb24gb2YgdXBkYXRlIG9wZXJhdGlvbnMgKG51bGxpZnlpbmcgCiAgICAgKiBm\nb3JlaWduIGtleXMpIHRvIGJlIGZpbGxlZC4gVGhlc2UgdXBkYXRlcyB3aWxs\nIGJlIGV4ZWN1dGVkIGJlZm9yZSAKICAgICAqIHRoZSByb3dzIGluIHRoZSBk\nZXBlbmRlbmN5IGdyYXBoIGFyZSBmbHVzaGVkCiAgICAgKiBAcGFyYW0gaW5z\nZXJ0VXBkYXRlcyBDQ29sbGVjdGlvbiBvZiB1cGRhdGUgb3BlcmF0aW9ucyAo\nbnVsbGlmeWluZyAKICAgICAqIGZvcmVpZ24ga2V5cykgdG8gYmUgZmlsbGVk\nLiBUaGVzZSB1cGRhdGVzIHdpbGwgYmUgZXhlY3V0ZWQgYWZ0ZXIgCiAgICAg\nKiB0aGUgcm93cyBpbiB0aGUgZGVwZW5kZW5jeSBncmFwaCBhcmUgZmx1c2hl\nZAogICAgICogQHJldHVybiBEZXBlbmRpbmcgb24gd2hlcmUgY2lyY3VsYXIg\nZGVwZW5kZW5jaWVzIGFyZSBicm9rZW4sIHRoZSAgCiAgICAgKiB0b3BvbG9n\naWNhbCBvcmRlciBvZiB0aGUgZ3JhcGggbm9kZXMgaGFzIHRvIGJlIHJlLWNh\nbGN1bGF0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiByZXNvbHZl\nQ3ljbGVzKEdyYXBoIGdyYXBoLCBDb2xsZWN0aW9uIGVkZ2VzLAogICAgICAg\nIENvbGxlY3Rpb24gZGVsZXRlVXBkYXRlcywgQ29sbGVjdGlvbiBpbnNlcnRV\ncGRhdGVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGJvb2xlYW4gcmVjYWxjdWxhdGUgPSBmYWxzZTsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IGVkZ2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIEVkZ2UgZWRnZSA9IChFZGdlKSBpdHIubmV4dCgp\nOwogICAgICAgICAgICBMaXN0IGN5Y2xlID0gZWRnZS5nZXRDeWNsZSgpOwoK\nICAgICAgICAgICAgaWYgKGN5Y2xlICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIC8vIGZpbmQgYSBudWxsYWJsZSBmb3JlaWduIGtleQogICAgICAgICAg\nICAgICAgRWRnZSBicmVha2FibGVMaW5rID0gZmluZEJyZWFrYWJsZUxpbmso\nY3ljbGUpOwogICAgICAgICAgICAgICAgaWYgKGJyZWFrYWJsZUxpbmsgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJuby1udWxsYWJsZS1mayIpKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyB0b3BvbG9naWMgbm9kZSBv\ncmRlciBtdXN0IGJlIHJlLWNhbGN1bGF0ZWQsICBpZiB0aGUKICAgICAgICAg\nICAgICAgIC8vIGJyZWFrYWJsZSBsaW5rIGlzIGRpZmZlcmVudCBmcm9tIHRo\nZSBlZGdlIHdoZXJlCiAgICAgICAgICAgICAgICAvLyB0aGUgY2lyY3VsYXIg\nZGVwZW5kZW5jeSB3YXMgb3JpZ2luYWxseSBkZXRlY3RlZAogICAgICAgICAg\nICAgICAgaWYgKGVkZ2UgIT0gYnJlYWthYmxlTGluaykgewogICAgICAgICAg\nICAgICAgICAgIHJlY2FsY3VsYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICBpZiAoIWJyZWFrYWJsZUxpbmsuaXNSZW1v\ndmVkRnJvbUdyYXBoKCkpIHsKCiAgICAgICAgICAgICAgICAgICAgLy8gdXNl\nIGEgcHJpbWFyeSByb3cgdXBkYXRlIHRvIHByZXZlbnQgc2V0dGluZyBwayBh\nbmQgZmsgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgLy8gdW50aWwgYWZ0\nZXIgZmx1c2gsIHRvIGdldCBsYXRlc3QgYXV0by1pbmNyZW1lbnQgdmFsdWVz\nCiAgICAgICAgICAgICAgICAgICAgUHJpbWFyeVJvdyByb3cgPSAoUHJpbWFy\neVJvdykgYnJlYWthYmxlTGluay5nZXRGcm9tKCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cuQUNUSU9OX0RFTEVU\nRSkgewogICAgICAgICAgICAgICAgICAgICAgICBhZGREZWxldGVVcGRhdGUo\nYnJlYWthYmxlTGluaywgZGVsZXRlVXBkYXRlcyk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkSW5z\nZXJ0VXBkYXRlKHJvdywgYnJlYWthYmxlTGluaywgaW5zZXJ0VXBkYXRlcyk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdy\nYXBoLnJlbW92ZUVkZ2UoYnJlYWthYmxlTGluayk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJl\nY2FsY3VsYXRlOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIHtAbGluayBEZXB0aEZpcnN0QW5hbHlzaXN9IHN1aXRhYmxlIGZvciB0aGUg\nZ2l2ZW4gZ3JhcGgKICAgICAqIGFuZCBhdXRvLWFzc2lnbiBzZXR0aW5ncy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIERlcHRoRmlyc3RBbmFseXNpcyBuZXdE\nZXB0aEZpcnN0QW5hbHlzaXMoR3JhcGggZ3JhcGgsCiAgICAgICAgYm9vbGVh\nbiBhdXRvQXNzaWduKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEZXB0aEZpcnN0\nQW5hbHlzaXMoZ3JhcGgpOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2gg\ndGhlIGdpdmVuIGNvbGxlY3Rpb24gb2Ygc2Vjb25kYXJ5IHJvd3MuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGZsdXNoKENvbGxlY3Rpb24gcm93cywg\nUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VyIHBzTWdyKSB7CiAgICAgICAgaWYg\nKHJvd3Muc2l6ZSgpID09IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgUm93SW1wbCByb3c7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBy\nb3dzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7ICkgewogICAgICAgICAg\nICByb3cgPSAoUm93SW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYg\nKHJvdy5pc1ZhbGlkKCkgJiYgIXJvdy5pc0RlcGVuZGVudCgpKQogICAgICAg\nICAgICAgICAgcHNNZ3IuZmx1c2gocm93KTsKICAgICAgICB9CiAgICB9Cn0=\n","encoding":"base64"}

