{"sha":"484873ef1d9dfa05923750a4d0c750e056b4064c","node_id":"MDQ6QmxvYjIwNjM2NDo0ODQ4NzNlZjFkOWRmYTA1OTIzNzUwYTRkMGM3NTBlMDU2YjQwNjRj","size":6943,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/484873ef1d9dfa05923750a4d0c750e056b4064c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29u\ndGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuVmVyc2lv\nbkxvY2tNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkxvY2tFeGNlcHRpb247CgovKioKICogTG9jayBtYW5hZ2VyIHRoYXQgdXNl\ncyBleGNsdXNpdmUgZGF0YWJhc2UgbG9ja3MuCiAqCiAqIEBhdXRob3IgTWFy\nYyBQcnVkJ2hvbW1lYXV4CiAqLwpwdWJsaWMgY2xhc3MgUGVzc2ltaXN0aWNM\nb2NrTWFuYWdlcgogICAgZXh0ZW5kcyBWZXJzaW9uTG9ja01hbmFnZXIKICAg\nIGltcGxlbWVudHMgSkRCQ0xvY2tNYW5hZ2VyIHsKCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBMT0NLX0RBVEFTVE9SRV9PTkxZID0gMTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKFBlc3NpbWlzdGljTG9ja01hbmFnZXIu\nY2xhc3MpOwoKICAgIHByaXZhdGUgSkRCQ1N0b3JlIF9zdG9yZTsKCiAgICBw\ndWJsaWMgUGVzc2ltaXN0aWNMb2NrTWFuYWdlcigpIHsKICAgICAgICBzZXRW\nZXJzaW9uQ2hlY2tPblJlYWRMb2NrKGZhbHNlKTsKICAgICAgICBzZXRWZXJz\naW9uVXBkYXRlT25Xcml0ZUxvY2soZmFsc2UpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAg\nIHN1cGVyLnNldENvbnRleHQoY3R4KTsKICAgICAgICBfc3RvcmUgPSAoSkRC\nQ1N0b3JlKSBjdHguZ2V0U3RvcmVNYW5hZ2VyKCkuZ2V0SW5uZXJtb3N0RGVs\nZWdhdGUoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RGb3JV\ncGRhdGUoU2VsZWN0IHNlbCwgaW50IGxvY2tMZXZlbCkgewogICAgICAgIGlm\nIChsb2NrTGV2ZWwgPT0gTE9DS19OT05FKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gX3N0b3JlLmdl\ndERCRGljdGlvbmFyeSgpOwogICAgICAgIGlmIChkaWN0LnNpbXVsYXRlTG9j\na2luZykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGRpY3Qu\nYXNzZXJ0U3VwcG9ydChkaWN0LnN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlLAog\nICAgICAgICAgICAiU3VwcG9ydHNTZWxlY3RGb3JVcGRhdGUiKTsKCiAgICAg\nICAgaWYgKCFzZWwuc3VwcG9ydHNMb2NraW5nKCkpIHsKICAgICAgICAgICAg\naWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cu\naW5mbyhfbG9jLmdldCgiY2FudC1sb2NrLW9uLWxvYWQiLAogICAgICAgICAg\nICAgICAgICAgIHNlbC50b1NlbGVjdChmYWxzZSwgbnVsbCkuZ2V0U1FMKCkp\nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAg\nICAgZW5zdXJlU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oKTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2FkZWRGb3JV\ncGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIC8vIHdl\nIHNldCBhIGxvdyBsb2NrIGxldmVsIHRvIGluZGljYXRlIHRoYXQgd2UgZG9u\nJ3QgbmVlZCBkYXRhc3RvcmUKICAgICAgICAvLyBsb2NraW5nLCBidXQgd2Ug\nZG9uJ3QgbmVjZXNzYXJpbHkgaGF2ZSBhIHJlYWQgb3Igd3JpdGUgbG9jawog\nICAgICAgIC8vIGFjY29yZGluZyB0byBvdXIgc3VwZXJjbGFzcwogICAgICAg\nIGlmIChnZXRMb2NrTGV2ZWwoc20pID09IExPQ0tfTk9ORSkKICAgICAgICAg\nICAgc2V0TG9ja0xldmVsKHNtLCBMT0NLX0RBVEFTVE9SRV9PTkxZKTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBsb2NrSW50ZXJuYWwoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgaW50IGxldmVsLCBpbnQgdGltZW91dCwKICAgICAg\nICBPYmplY3Qgc2RhdGEpIHsKICAgICAgICAvLyB3ZSBjYW4gc2tpcCBhbnkg\nYWxyZWFkeS1sb2NrZWQgaW5zdGFuY2UgcmVnYXJkbGVzcyBvZiBsZXZlbCBi\nZWNhdXNlCiAgICAgICAgLy8gd2UgdHJlYXQgYWxsIGxvY2tzIHRoZSBzYW1l\nICh0aG91Z2ggc3VwZXIgZG9lc24ndCkKICAgICAgICBpZiAoZ2V0TG9ja0xl\ndmVsKHNtKSA9PSBMT0NLX05PTkUpIHsKICAgICAgICAgICAgLy8gb25seSBu\nZWVkIHRvIGxvY2sgaWYgbm90IGxvYWRlZCBmcm9tIGxvY2tpbmcgcmVzdWx0\nCiAgICAgICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSAoQ29ubmVjdGlv\nbkluZm8pIHNkYXRhOwogICAgICAgICAgICBpZiAoaW5mbyA9PSBudWxsIHx8\nIGluZm8ucmVzdWx0ID09IG51bGwgfHwgIWluZm8ucmVzdWx0LmlzTG9ja2lu\nZygpKQogICAgICAgICAgICAgICAgbG9ja1JvdyhzbSwgdGltZW91dCk7CiAg\nICAgICAgfQogICAgICAgIHN1cGVyLmxvY2tJbnRlcm5hbChzbSwgbGV2ZWws\nIHRpbWVvdXQsIHNkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvY2sg\ndGhlIHNwZWNpZmllZCBpbnN0YW5jZSByb3cgYnkgaXNzdWluZyBhICJTRUxF\nQ1QgLi4uIEZPUiBVUERBVEUiCiAgICAgKiBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBsb2NrUm93KE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIGludCB0aW1lb3V0KSB7CiAgICAgICAgLy8gYXNzZXJ0IHRoYXQgdGhl\nIGRpY3Rpb25hcnkgc3VwcG9ydHMgdGhlICJTRUxFQ1QgLi4uIEZPUiBVUERB\nVEUiCiAgICAgICAgLy8gY29uc3RydWN0OyBpZiBub3QsIGFuZCB3ZSB0aGUg\nYXNzZXJ0aW9uIGRvZXMgbm90IHRocm93IGFuCiAgICAgICAgLy8gZXhjZXB0\naW9uLCB0aGVuIGp1c3QgcmV0dXJuIHdpdGhvdXQgbG9ja2luZwogICAgICAg\nIERCRGljdGlvbmFyeSBkaWN0ID0gX3N0b3JlLmdldERCRGljdGlvbmFyeSgp\nOwogICAgICAgIGlmIChkaWN0LnNpbXVsYXRlTG9ja2luZykKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIGRpY3QuYXNzZXJ0U3VwcG9ydChkaWN0LnN1\ncHBvcnRzU2VsZWN0Rm9yVXBkYXRlLAogICAgICAgICAgICAiU3VwcG9ydHNT\nZWxlY3RGb3JVcGRhdGUiKTsKCiAgICAgICAgT2JqZWN0IGlkID0gc20uZ2V0\nT2JqZWN0SWQoKTsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChD\nbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgd2hpbGUg\nKG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmcuZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CgogICAgICAgIC8vIHNlbGVjdCBv\nbmx5IHRoZSBQSyBjb2x1bW5zLCBzaW5jZSB3ZSBqdXN0IHdhbnQgdG8gbG9j\nawogICAgICAgIFNlbGVjdCBzZWxlY3QgPSBfc3RvcmUuZ2V0U1FMRmFjdG9y\neSgpLm5ld1NlbGVjdCgpOwogICAgICAgIHNlbGVjdC5zZWxlY3QobWFwcGlu\nZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICBzZWxlY3Qud2hl\ncmVQcmltYXJ5S2V5KGlkLCBtYXBwaW5nLCBfc3RvcmUpOwogICAgICAgIFNR\nTEJ1ZmZlciBzcWwgPSBzZWxlY3QudG9TZWxlY3QodHJ1ZSwgX3N0b3JlLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpKTsKCiAgICAgICAgZW5zdXJlU3RvcmVN\nYW5hZ2VyVHJhbnNhY3Rpb24oKTsKICAgICAgICBDb25uZWN0aW9uIGNvbm4g\nPSBfc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0bW50ID0gc3FsLnBy\nZXBhcmVTdGF0ZW1lbnQoY29ubik7CiAgICAgICAgICAgIGlmICh0aW1lb3V0\nID49IDAgJiYgZGljdC5zdXBwb3J0c1F1ZXJ5VGltZW91dCkgewogICAgICAg\nICAgICAgICAgaWYgKHRpbWVvdXQgPCAxMDAwKSB7CiAgICAgICAgICAgICAg\nICAgICAgdGltZW91dCA9IDEwMDA7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KCJtaWxsaXMtcXVlcnktdGltZW91dCIpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRyeSB7IAogICAg\nICAgICAgICAgICAgICAgIHN0bW50LnNldFF1ZXJ5VGltZW91dCh0aW1lb3V0\nIC8gMTAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBj\nYXRjaChTUUxFeGNlcHRpb24gZSkgeyAKICAgICAgICAgICAgICAgICAgICBp\nZighIGRpY3QuaWdub3JlU1FMRXhjZXB0aW9uT25TZXRRdWVyeVRpbWVvdXQp\nIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9j\nLmdldCgiZXJyb3Itc2V0dGluZy1xdWVyeS10aW1lb3V0IiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBuZXcgSW50ZWdlcih0aW1lb3V0KSwg\nZS5nZXRNZXNzYWdlKCkpLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVy\neSgpOwogICAgICAgICAgICBpZiAoIXJzLm5leHQoKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBMb2NrRXhjZXB0aW9uKHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwg\nZGljdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHN0\nbW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9z\nZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAg\nIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMuY2xv\nc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAg\nICB0cnkgeyBjb25uLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBz\nZSkge30KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmZvcmNl\nIHRoYXQgd2UgaGF2ZSBhbiBhY3R1YWwgdHJhbnNhY3Rpb24gaW4gcHJvZ3Jl\nc3Mgc28gdGhhdCB3ZSBjYW4KICAgICAqIHN0YXJ0IGxvY2tpbmcuIFRoZSB0\ncmFuc2FjdGlvbiBzaG91bGQgYWxyZWFkeSBiZSBiZWd1biB3aGVuIHVzaW5n\nIGEKICAgICAqIGRhdGFzdG9yZSB0cmFuc2FjdGlvbjsgdGhpcyB3aWxsIGp1\nc3QgYmUgdXNlZCBpZiB3ZSBhcmUgbG9ja2luZyBpbgogICAgICogb3B0aW1p\nc3RpYyBtb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5zdXJlU3Rv\ncmVNYW5hZ2VyVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgaWYgKCFfc3RvcmUu\nZ2V0Q29udGV4dCgpLmlzU3RvcmVBY3RpdmUoKSkgewogICAgICAgICAgICBf\nc3RvcmUuZ2V0Q29udGV4dCgpLmJlZ2luU3RvcmUoKTsKICAgICAgICAgICAg\naWYgKGxvZy5pc0luZm9FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cu\naW5mbyhfbG9jLmdldCgic3RhcnQtdHJhbnMtZm9yLWxvY2siKSk7CiAgICAg\nICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

