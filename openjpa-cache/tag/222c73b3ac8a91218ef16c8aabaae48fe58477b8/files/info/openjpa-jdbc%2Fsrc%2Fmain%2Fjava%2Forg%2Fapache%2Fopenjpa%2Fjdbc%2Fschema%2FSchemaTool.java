{"sha":"fd974109ae9373aefbf6992cce8257afd634b908","node_id":"MDQ6QmxvYjIwNjM2NDpmZDk3NDEwOWFlOTM3M2FlZmJmNjk5MmNjZTgyNTdhZmQ2MzRiOTA4","size":54282,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fd974109ae9373aefbf6992cce8257afd634b908","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uUHJpbnRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLldy\naXRlcjsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZh\nLnNxbC5EYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgamF2YS5zcWwuU1FMRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBvcnQgamF2\nYS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnNxbC5EYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5KREJDQ29u\nZmlndXJhdGlvbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuREJEaWN0aW9uYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuRmlsZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogVGhlIFNj\naGVtYVRvb2wgaXMgdXNlZCB0byBtYW5hZ2UgdGhlIGRhdGFiYXNlIHNjaGVt\nYS4gTm90ZSB0aGF0IHRoZQogKiB0b29sIG5ldmVyIGFkZHMgb3IgZHJvcHMg\ndW5pcXVlIGNvbnN0cmFpbnRzIGZyb20gZXhpc3RpbmcgdGFibGVzLCBiZWNh\ndXNlCiAqIEpEQkMge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9IGRvZXMgbm90\nIGluY2x1ZGUgaW5mb3JtYXRpb24gb24gdGhlc2UKICogY29uc3RyYWludHMu\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGF0cmljayBM\naW5za2V5CiAqLwpwdWJsaWMgY2xhc3MgU2NoZW1hVG9vbCB7CgogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0FERCA9ICJhZGQiOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNUSU9OX0RST1AgPSAi\nZHJvcCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nUkVUQUlOID0gInJldGFpbiI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fUkVGUkVTSCA9ICJyZWZyZXNoIjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9CVUlMRCA9ICJidWlsZCI7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fUkVGTEVDVCA9\nICJyZWZsZWN0IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFD\nVElPTl9DUkVBVEVEQiA9ICJjcmVhdGVEQiI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBBQ1RJT05fRFJPUERCID0gImRyb3BEQiI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05fSU1QT1JUID0gImlt\ncG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBBQ1RJT05f\nRVhQT1JUID0gImV4cG9ydCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTID0gCiAgICAgICAg\nImRlbGV0ZVRhYmxlQ29udGVudHMiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgU3RyaW5nW10gQUNUSU9OUyA9IG5ldyBTdHJpbmdbXXsKICAgICAgICBB\nQ1RJT05fQURELAogICAgICAgIEFDVElPTl9EUk9QLAogICAgICAgIEFDVElP\nTl9SRVRBSU4sCiAgICAgICAgQUNUSU9OX1JFRlJFU0gsCiAgICAgICAgQUNU\nSU9OX0JVSUxELAogICAgICAgIEFDVElPTl9SRUZMRUNULAogICAgICAgIEFD\nVElPTl9DUkVBVEVEQiwKICAgICAgICBBQ1RJT05fRFJPUERCLAogICAgICAg\nIEFDVElPTl9JTVBPUlQsCiAgICAgICAgQUNUSU9OX0VYUE9SVCwKICAgICAg\nICBBQ1RJT05fREVMRVRFX1RBQkxFX0NPTlRFTlRTLAogICAgfTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlCiAgICAgICAgKFNjaGVtYVRvb2wuY2xhc3MpOwoKICAg\nIHByaXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gX2NvbmY7CiAgICBw\ncml2YXRlIGZpbmFsIERhdGFTb3VyY2UgX2RzOwogICAgcHJpdmF0ZSBmaW5h\nbCBMb2cgX2xvZzsKICAgIHByaXZhdGUgZmluYWwgREJEaWN0aW9uYXJ5IF9k\naWN0OwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX2FjdGlvbjsKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaWdub3JlRXJycyA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9vcGVuanBhVGFibGVzID0gZmFsc2U7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2Ryb3BUYWJsZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9kcm9wU2VxcyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX3Br\ncyA9IHRydWU7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ZrcyA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2luZGV4ZXMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zZXFzID0gdHJ1ZTsKICAgIHByaXZhdGUgUHJpbnRXcml0\nZXIgX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9n\ncm91cCA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVtYUdyb3VwIF9kYiA9IG51\nbGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2Z1bGxEQiA9IGZhbHNlOwoKICAg\nIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gVG9vbHMgY29uc3Ry\ndWN0ZWQgdGhpcyB3YXkgd2lsbCBub3QgaGF2ZSBhbgogICAgICogYWN0aW9u\nLCBzbyB0aGUge0BsaW5rICNydW4oKX0gbWV0aG9kIHdpbGwgYmUgYSBuby1v\ncC4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRvb2woSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIHRoaXMoY29uZiwgbnVsbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB0b29sIHRvIHBlcmZvcm0g\ndGhlIGdpdmVuIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIFNjaGVtYVRv\nb2woSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nIGFjdGlvbikgewog\nICAgICAgIGlmIChhY3Rpb24gIT0gbnVsbCAmJiAhQXJyYXlzLmFzTGlzdChB\nQ1RJT05TKS5jb250YWlucyhhY3Rpb24pKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJhY3Rpb24gPT0gIiArIGFj\ndGlvbik7CgogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBfYWN0aW9u\nID0gYWN0aW9uOwogICAgICAgIF9kcyA9IGNvbmYuZ2V0RGF0YVNvdXJjZTIo\nbnVsbCk7CiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25maWd1\ncmF0aW9uLkxPR19TQ0hFTUEpOwoKICAgICAgICAvLyBpbml0aWFsaXplIHRo\naXMgdXAtZnJvbnQ7IG90aGVyd2lzZSB0aGUgZGJkaWN0aW9uYXJ5ZmFjdG9y\neSBtaWdodAogICAgICAgIC8vIHRyeSB0byB0YWtlIGEgY29ubmVjdGlvbiB0\nbyBpbml0aWFsaXplIHdoZW4gd2UndmUgYWxyZWFkeSBnb3Qgb25lOgogICAg\nICAgIC8vIGJhZCBuZXdzIGlmIHRoZSBtYXggcG9vbCBpcyAxCiAgICAgICAg\nX2RpY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGFjdGlvbiBzdXBwbGllZCBvbiBjb25z\ndHJ1Y3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0QWN0aW9u\nKCkgewogICAgICAgIHJldHVybiBfYWN0aW9uOwogICAgfQoKICAgIC8qKgog\nICAgICogSWYgdHJ1ZSwgU1FMRXhjZXB0aW9ucyB0aHJvd24gZHVyaW5nIHNj\naGVtYSBtYW5pcHVsYXRpb24gd2lsbCBiZQogICAgICogcHJpbnRlZCBidXQg\naWdub3JlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3Jl\nRXJyb3JzKCkgewogICAgICAgIHJldHVybiBfaWdub3JlRXJyczsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHRydWUsIFNRTEV4Y2VwdGlvbnMgdGhyb3du\nIGR1cmluZyBzY2hlbWEgbWFuaXB1bGF0aW9uIHdpbGwgYmUKICAgICAqIHBy\naW50ZWQgYnV0IGlnbm9yZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndElnbm9yZUVycm9ycyhib29sZWFuIGlnbm9yZUVycnMpIHsKICAgICAgICBf\naWdub3JlRXJycyA9IGlnbm9yZUVycnM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRvIGFjdCBvbiBzcGVjaWFsIHRhYmxlcyB1c2VkIGJ5IE9w\nZW5KUEEgY29tcG9uZW50cwogICAgICogZm9yIGJvb2trZWVwaW5nLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRPcGVuSlBBVGFibGVzKCkgewog\nICAgICAgIHJldHVybiBfb3BlbmpwYVRhYmxlczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdG8gYWN0IG9uIHNwZWNpYWwgdGFibGVzIHVzZWQg\nYnkgT3BlbkpQQSBjb21wb25lbnRzCiAgICAgKiBmb3IgYm9va2tlZXBpbmcu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE9wZW5KUEFUYWJsZXMoYm9v\nbGVhbiBvcGVuanBhVGFibGVzKSB7CiAgICAgICAgX29wZW5qcGFUYWJsZXMg\nPSBvcGVuanBhVGFibGVzOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdHJ1\nZSwgdGFibGVzIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNlZCB3aWxsIGJlIGRy\nb3BwZWQuIERlZmF1bHRzIHRvCiAgICAgKiB0cnVlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXREcm9wVGFibGVzKCkgewogICAgICAgIHJldHVy\nbiBfZHJvcFRhYmxlczsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRydWUs\nIHRhYmxlcyB0aGF0IGFwcGVhciB0byBiZSB1bnVzZWQgd2lsbCBiZSBkcm9w\ncGVkLiBEZWZhdWx0cyB0bwogICAgICogdHJ1ZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RHJvcFRhYmxlcyhib29sZWFuIGRyb3BUYWJsZXMpIHsK\nICAgICAgICBfZHJvcFRhYmxlcyA9IGRyb3BUYWJsZXM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJZiB0cnVlLCBzZXF1ZW5jZXMgdGhhdCBhcHBlYXIgdG8g\nYmUgdW51c2VkIHdpbGwgYmUgZHJvcHBlZC4gRGVmYXVsdHMKICAgICAqIHRv\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldERyb3BTZXF1\nZW5jZXMoKSB7CiAgICAgICAgcmV0dXJuIF9kcm9wU2VxczsKICAgIH0KCiAg\nICAvKioKICAgICAqIElmIHRydWUsIHNlcXVlbmNlcyB0aGF0IGFwcGVhciB0\nbyBiZSB1bnVzZWQgd2lsbCBiZSBkcm9wcGVkLiBEZWZhdWx0cwogICAgICog\ndG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RHJvcFNlcXVl\nbmNlcyhib29sZWFuIGRyb3BTZXFzKSB7CiAgICAgICAgX2Ryb3BTZXFzID0g\nZHJvcFNlcXM7CiAgICAgICAgaWYgKGRyb3BTZXFzKQogICAgICAgICAgICBz\nZXRTZXF1ZW5jZXModHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuIERlZmF1bHRz\nIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFNlcXVl\nbmNlcygpIHsKICAgICAgICByZXR1cm4gX3NlcXM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHNlcXVlbmNlcyBzaG91bGQgYmUgbWFuaXB1bGF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNlcXVlbmNlcyhib29sZWFuIHNlcXMpIHsKICAgICAgICBfc2VxcyA9\nIHNlcXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGluZGV4ZXMg\nb24gZXhpc3RpbmcgdGFibGVzIHNob3VsZCBiZSBtYW5pcHVsYXRlZC4KICAg\nICAqIERlZmF1bHRzIHRvIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGdldEluZGV4ZXMoKSB7CiAgICAgICAgcmV0dXJuIF9pbmRleGVzOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBpbmRleGVzIG9uIGV4aXN0\naW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAgICAgKiBEZWZh\ndWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbmRl\neGVzKGJvb2xlYW4gaW5kZXhlcykgewogICAgICAgIF9pbmRleGVzID0gaW5k\nZXhlczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBr\nZXlzIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQu\nCiAgICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRGb3JlaWduS2V5cygpIHsKICAgICAgICByZXR1cm4gX2Zr\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgZm9yZWlnbiBrZXlz\nIG9uIGV4aXN0aW5nIHRhYmxlcyBzaG91bGQgYmUgbWFuaXB1bGF0ZWQuCiAg\nICAgKiBEZWZhdWx0cyB0byB0cnVlLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRGb3JlaWduS2V5cyhib29sZWFuIGZrcykgewogICAgICAgIF9ma3Mg\nPSBma3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkg\na2V5cyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVk\nLgogICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gZ2V0UHJpbWFyeUtleXMoKSB7CiAgICAgICAgcmV0dXJuIF9w\na3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHByaW1hcnkga2V5\ncyBvbiBleGlzdGluZyB0YWJsZXMgc2hvdWxkIGJlIG1hbmlwdWxhdGVkLgog\nICAgICogRGVmYXVsdHMgdG8gdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UHJpbWFyeUtleXMoYm9vbGVhbiBwa3MpIHsKICAgICAgICBfcGtz\nID0gcGtzOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmVhbSB0byB3\ncml0ZSB0byBmb3IgdGhlIGNyZWF0aW9uIG9mIFNRTCBzY3JpcHRzLiBJZiB0\naGUKICAgICAqIHN0cmVhbSBpcyBub24tbnVsbCwgYWxsIFNRTCB3aWxsIGJl\nIHdyaXR0ZW4gdG8gdGhpcyBzdHJlYW0gcmF0aGVyIHRoYW4KICAgICAqIGV4\nZWN1dGVkIGFnYWluc3QgdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBwdWJs\naWMgV3JpdGVyIGdldFdyaXRlcigpIHsKICAgICAgICByZXR1cm4gX3dyaXRl\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJlYW0gdG8gd3JpdGUg\ndG8gZm9yIHRoZSBjcmVhdGlvbiBvZiBTUUwgc2NyaXB0cy4gSWYgdGhlCiAg\nICAgKiBzdHJlYW0gaXMgbm9uLW51bGwsIGFsbCBTUUwgd2lsbCBiZSB3cml0\ndGVuIHRvIHRoaXMgc3RyZWFtIHJhdGhlciB0aGFuCiAgICAgKiBleGVjdXRl\nZCBhZ2FpbnN0IHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0V3JpdGVyKFdyaXRlciB3cml0ZXIpIHsKICAgICAgICBpZiAod3Jp\ndGVyID09IG51bGwpCiAgICAgICAgICAgIF93cml0ZXIgPSBudWxsOwogICAg\nICAgIGVsc2UgaWYgKHdyaXRlciBpbnN0YW5jZW9mIFByaW50V3JpdGVyKQog\nICAgICAgICAgICBfd3JpdGVyID0gKFByaW50V3JpdGVyKSB3cml0ZXI7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfd3JpdGVyID0gbmV3IFByaW50V3Jp\ndGVyKHdyaXRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAqLwog\nICAgcHVibGljIFNjaGVtYUdyb3VwIGdldFNjaGVtYUdyb3VwKCkgewogICAg\nICAgIHJldHVybiBfZ3JvdXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQg\ndGhlIHNjaGVtYSBncm91cCB0aGUgdG9vbCB3aWxsIGFjdCBvbi4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U2NoZW1hR3JvdXAoU2NoZW1hR3JvdXAg\nZ3JvdXApIHsKICAgICAgICBfZ3JvdXAgPSBncm91cDsKICAgIH0KCiAgICAv\nLy8vLy8vLy8vLwogICAgLy8gQWN0aW9ucwogICAgLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIFJ1biB0aGUgdG9vbCBhY3Rpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHJ1bigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF9hY3Rpb24gPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoQUNUSU9OX0FERC5lcXVhbHMoX2FjdGlv\nbikpCiAgICAgICAgICAgIGFkZCgpOwogICAgICAgIGVsc2UgaWYgKEFDVElP\nTl9EUk9QLmVxdWFscyhfYWN0aW9uKSkKICAgICAgICAgICAgZHJvcCgpOwog\nICAgICAgIGVsc2UgaWYgKEFDVElPTl9SRVRBSU4uZXF1YWxzKF9hY3Rpb24p\nKQogICAgICAgICAgICByZXRhaW4oKTsKICAgICAgICBlbHNlIGlmIChBQ1RJ\nT05fUkVGUkVTSC5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIHJlZnJl\nc2goKTsKICAgICAgICBlbHNlIGlmIChBQ1RJT05fQlVJTEQuZXF1YWxzKF9h\nY3Rpb24pKQogICAgICAgICAgICBidWlsZCgpOwogICAgICAgIGVsc2UgaWYg\nKEFDVElPTl9DUkVBVEVEQi5lcXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAg\nIGNyZWF0ZURCKCk7CiAgICAgICAgZWxzZSBpZiAoQUNUSU9OX0RST1BEQi5l\ncXVhbHMoX2FjdGlvbikpCiAgICAgICAgICAgIGRyb3BEQigpOwogICAgICAg\nIGVsc2UgaWYgKEFDVElPTl9ERUxFVEVfVEFCTEVfQ09OVEVOVFMuZXF1YWxz\nKF9hY3Rpb24pKQogICAgICAgICAgICBkZWxldGVUYWJsZUNvbnRlbnRzKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFueSBjb21wb25lbnRzIHBy\nZXNlbnQgaW4gdGhlIHNjaGVtYSByZXBvc2l0b3J5IGJ1dCBhYnNlbnQgZnJv\nbQogICAgICogdGhlIGRhdGFiYXNlLiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgYWRkKCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBhZGQoZ2V0REJTY2hlbWFHcm91cChm\nYWxzZSksIGFzc2VydFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgog\nICAgICogRHJvcHMgYWxsIHNjaGVtYSBjb21wb25lbnRzIGluIHRoZSBzY2hl\nbWEgcmVwb3NpdG9yeSB0aGF0IGFsc28gZXhpc3QKICAgICAqIGluIHRoZSBk\nYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZvciB0ZXN0aW5nLgogICAgICov\nCiAgICB2b2lkIGRyb3AoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGRyb3AoZ2V0REJTY2hlbWFHcm91cChmYWxzZSksIGFzc2Vy\ndFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcHMg\nZGF0YWJhc2UgY29tcG9uZW50cyB0aGF0IGFyZSBub3QgbWVudGlvbmVkIGlu\nIHRoZSBzY2hlbWEKICAgICAqIHJlcG9zaXRvcnkuIFBhY2thZ2UtcHJpdmF0\nZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAgdm9pZCByZXRhaW4oKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldGFpbihnZXRE\nQlNjaGVtYUdyb3VwKHRydWUpLCBhc3NlcnRTY2hlbWFHcm91cCgpLAogICAg\nICAgICAgICBnZXREcm9wVGFibGVzKCksIGdldERyb3BTZXF1ZW5jZXMoKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGFueSBjb21wb25lbnRzIHBy\nZXNlbnQgaW4gdGhlIHNjaGVtYSByZXBvc2l0b3J5IGJ1dCBhYnNlbnQgZnJv\nbQogICAgICogdGhlIGRhdGFiYXNlLCBhbmQgZHJvcHMgdW51c2VkIGRhdGFi\nYXNlIGNvbXBvbmVudHMuCiAgICAgKiBQYWNrYWdlLXByaXZhdGUgZm9yIHRl\nc3RpbmcuCiAgICAgKi8KICAgIHZvaWQgcmVmcmVzaCgpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2NoZW1hR3JvdXAgbG9jYWwg\nPSBhc3NlcnRTY2hlbWFHcm91cCgpOwogICAgICAgIFNjaGVtYUdyb3VwIGRi\nID0gZ2V0REJTY2hlbWFHcm91cCh0cnVlKTsKICAgICAgICByZXRhaW4oZGIs\nIGxvY2FsLCBnZXREcm9wVGFibGVzKCksIGdldERyb3BTZXF1ZW5jZXMoKSk7\nCiAgICAgICAgYWRkKGRiLCBsb2NhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZS1leGVjdXRlIGFsbCBTUUwgdXNlZCBmb3IgdGhlIGNyZWF0aW9uIG9m\nIHRoZSBjdXJyZW50IGRhdGFiYXNlOwogICAgICogdGhpcyBhY3Rpb24gaXMg\ndXN1YWxseSB1c2VkIHdoZW4gY3JlYXRpbmcgU1FMIHNjcmlwdHMuCiAgICAg\nKiBQYWNrYWdlLXByaXZhdGUgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHZv\naWQgY3JlYXRlREIoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gbmV3IFNjaGVtYUdyb3VwKCk7\nCiAgICAgICAgZ3JvdXAuYWRkU2NoZW1hKCk7CiAgICAgICAgYWRkKGdyb3Vw\nLCBnZXREQlNjaGVtYUdyb3VwKHRydWUpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlLWV4ZWN1dGUgYWxsIFNRTCB1c2VkIGZvciB0aGUgY3JlYXRpb24g\nb2YgdGhlIGN1cnJlbnQgZGF0YWJhc2U7CiAgICAgKiB0aGlzIGFjdGlvbiBp\ncyB1c3VhbGx5IHVzZWQgd2hlbiBjcmVhdGluZyBTUUwgc2NyaXB0cy4KICAg\nICAqIFBhY2thZ2UtcHJpdmF0ZSBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\ndm9pZCBidWlsZCgpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU2NoZW1hR3JvdXAgZ3JvdXAgPSBuZXcgU2NoZW1hR3JvdXAoKTsK\nICAgICAgICBncm91cC5hZGRTY2hlbWEoKTsKICAgICAgICBhZGQoZ3JvdXAs\nIGFzc2VydFNjaGVtYUdyb3VwKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRHJvcCB0aGUgY3VycmVudCBkYXRhYmFzZS4gUGFja2FnZS1wcml2YXRlIGZv\nciB0ZXN0aW5nLgogICAgICovCiAgICB2b2lkIGRyb3BEQigpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0YWluKGdldERCU2No\nZW1hR3JvdXAodHJ1ZSksIG5ldyBTY2hlbWFHcm91cCgpLCB0cnVlLCB0cnVl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIElzc3VlIERFTEVURSBzdGF0ZW1l\nbnQgYWdhaW5zdCBhbGwga25vd24gdGFibGVzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZGVsZXRlVGFibGVDb250ZW50cygpIAogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0g\nZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0g\nZ3JvdXAuZ2V0U2NoZW1hcygpOwogICAgICAgIENvbGxlY3Rpb24gdGFibGVz\nID0gbmV3IExpbmtlZEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgVGFi\nbGVbXSB0cyA9IHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgdHMubGVuZ3RoOyBqKyspCiAgICAgICAg\nICAgICAgICB0YWJsZXMuYWRkKHRzW2pdKTsKICAgICAgICB9CiAgICAgICAg\nVGFibGVbXSB0YWJsZUFycmF5ID0gKFRhYmxlW10pIHRhYmxlcy50b0FycmF5\nKG5ldyBUYWJsZVt0YWJsZXMuc2l6ZSgpXSk7CiAgICAgICAgU3RyaW5nW10g\nc3FsID0gX2NvbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKQogICAgICAg\nICAgICAuZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTCh0YWJsZUFycmF5KTsK\nICAgICAgICBpZiAoIWV4ZWN1dGVTUUwoc3FsKSkKICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkZWxldGUtdGFibGUtY29udGVudHMiKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIGNoYW5nZXMgbWFkZSB0\nbyB0aGUgREIgaW4gdGhlIGN1cnJlbnQge0BsaW5rIFNjaGVtYUZhY3Rvcnl9\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvcmQoKSB7CiAgICAgICAg\naWYgKF9kYiAhPSBudWxsICYmIF93cml0ZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgX2NvbmYuZ2V0U2NoZW1hRmFjdG9yeUluc3RhbmNlKCkuc3RvcmVTY2hl\nbWEoX2RiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYWxsIGRhdGFi\nYXNlIGNvbXBvbmVudHMgaW4gdGhlIHJlcG9zaXRvcnkgc2NoZW1hIHRoYXQg\nYXJlIG5vdAogICAgICogcHJlc2VudCBpbiB0aGUgZ2l2ZW4gZGF0YWJhc2Ug\nc2NoZW1hIHRvIHRoZSBkYXRhYmFzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZChTY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3MpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYWRkIHNl\ncXVlbmNlcwogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSByZXBvcy5nZXRT\nY2hlbWFzKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYTsKICAgICAgICBpZiAo\nX3NlcXMpIHsKICAgICAgICAgICAgU2VxdWVuY2VbXSBzZXFzOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIHNlcXMgPSBzY2hlbWFzW2ldLmdldFNlcXVl\nbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBz\nZXFzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRi\nLmZpbmRTZXF1ZW5jZShzY2hlbWFzW2ldLCBzZXFzW2pdLmdldEZ1bGxOYW1l\nKCkpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY3JlYXRlU2VxdWVuY2Uoc2Vx\nc1tqXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hID0gZGIu\nZ2V0U2NoZW1hKHNlcXNbal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgc2NoZW1hID0gZGIuYWRkU2NoZW1hKHNlcXNb\nal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2NoZW1hLmltcG9ydFNlcXVlbmNlKHNlcXNbal0pOwogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndh\ncm4oX2xvYy5nZXQoImFkZC1zZXEiLCBzZXFzW2pdKSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG9y\nZGVyIGlzIGltcG9ydGFudCBpbiB0aGlzIG1ldGhvZDsgc3RhcnQgd2l0aCBj\nb2x1bW5zCiAgICAgICAgVGFibGVbXSB0YWJzOwogICAgICAgIFRhYmxlIGRi\nVGFibGU7CiAgICAgICAgQ29sdW1uW10gY29sczsKICAgICAgICBDb2x1bW4g\nY29sOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRU\nYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJz\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBjb2xzID0gdGFic1tq\nXS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIu\nZmluZFRhYmxlKHNjaGVtYXNbaV0sIHRhYnNbal0uZ2V0RnVsbE5hbWUoKSk7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGNvbHMubGVu\nZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCA9IGRiVGFi\nbGUuZ2V0Q29sdW1uKGNvbHNba10uZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGNvbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoYWRkQ29sdW1uKGNvbHNba10pKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuaW1wb3J0Q29sdW1u\nKGNvbHNba10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiYWRkLWNvbCIsIGNvbHNba10sCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIGlmICghY29sc1trXS5lcXVhbHNDb2x1bW4oY29sKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJiYWQtY29sIiwgbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbCwgZGJUYWJsZSwgY29sLmdldERlc2NyaXB0\naW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sc1tr\nXS5nZXREZXNjcmlwdGlvbigpIH0pKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcHJpbWFyeSBr\nZXlzCiAgICAgICAgaWYgKF9wa3MpIHsKICAgICAgICAgICAgUHJpbWFyeUtl\neSBwazsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YWJzID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBqIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAg\nICAgIHBrID0gdGFic1tqXS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAgICAg\nICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZShzY2hlbWFzW2ldLCB0\nYWJzW2pdLmdldEZ1bGxOYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwayAhPSBudWxsICYmICFway5pc0xvZ2ljYWwoKSAmJiBkYlRhYmxlICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRiVGFibGUu\nZ2V0UHJpbWFyeUtleSgpID09IG51bGwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICYmIGFkZFByaW1hcnlLZXkocGspKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRQcmltYXJ5S2V5KHBrKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZGJUYWJsZS5nZXRQcmlt\nYXJ5S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIF9sb2cud2FybihfbG9jLmdldCgiYWRkLXBrIiwgcGssIHRhYnNbal0pKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXBrLmVxdWFsc1By\naW1hcnlLZXkoZGJUYWJsZS5nZXRQcmltYXJ5S2V5KCkpKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJiYWQtcGsi\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUuZ2V0\nUHJpbWFyeUtleSgpLCBkYlRhYmxlKSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyB0YWJsZXMKICAgICAgICBTZXQgbmV3VGFibGVzID0gbmV3\nIEhhc2hTZXQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVt\nYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNb\naV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBq\nIDwgdGFicy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKGRi\nLmZpbmRUYWJsZShzY2hlbWFzW2ldLCB0YWJzW2pdLmdldEZ1bGxOYW1lKCkp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICAgICAgaWYgKGNyZWF0ZVRhYmxlKHRhYnNbal0pKSB7CiAgICAg\nICAgICAgICAgICAgICAgbmV3VGFibGVzLmFkZCh0YWJzW2pdKTsKICAgICAg\nICAgICAgICAgICAgICBzY2hlbWEgPSBkYi5nZXRTY2hlbWEodGFic1tqXS5n\nZXRTY2hlbWFOYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChzY2hl\nbWEgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hID0g\nZGIuYWRkU2NoZW1hKHRhYnNbal0uZ2V0U2NoZW1hTmFtZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBzY2hlbWEuaW1wb3J0VGFibGUodGFic1tqXSk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoImFkZC10YWJsZSIsIHRhYnNbal0pKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaW5kZXhlcwogICAgICAg\nIEluZGV4W10gaWR4czsKICAgICAgICBJbmRleCBpZHg7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAg\nICAgICBmb3IgKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsK\nICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBpbmRleGVzIG9uIG5ldyB0YWJs\nZXMgZXZlbiBpZiBpbmRleGVzCiAgICAgICAgICAgICAgICAvLyBoYXZlIGJl\nZW4gdHVybmVkIG9mZgogICAgICAgICAgICAgICAgaWYgKCFfaW5kZXhlcyAm\nJiAhbmV3VGFibGVzLmNvbnRhaW5zKHRhYnNbal0pKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlkeHMgPSB0YWJz\nW2pdLmdldEluZGV4ZXMoKTsKICAgICAgICAgICAgICAgIGRiVGFibGUgPSBk\nYi5maW5kVGFibGUoc2NoZW1hc1tpXSwgdGFic1tqXS5nZXRGdWxsTmFtZSgp\nKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgaWR4cy5s\nZW5ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxl\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWR4ID0gZmlu\nZEluZGV4KGRiVGFibGUsIGlkeHNba10pOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoaWR4ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChjcmVhdGVJbmRleChpZHhzW2tdLCBkYlRhYmxlKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYlRhYmxlLmltcG9ydElu\nZGV4KGlkeHNba10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiYWRkLWluZGV4IiwgaWR4c1trXSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdGFic1tqXSkpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKCFpZHhzW2tdLmVxdWFsc0luZGV4KGlk\neCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xv\nYy5nZXQoImJhZC1pbmRleCIsIGlkeCwgZGJUYWJsZSkpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gVW5pcXVlIENvbnN0cmFpbnRzIG9uIGdy\nb3VwIG9mIGNvbHVtbnMKICAgICAgICBVbmlxdWVbXSB1bmlxdWVzOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsg\naisrKSB7CiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdW5pcXVlIGNvbnN0\ncmFpbnRzIG9ubHkgb24gbmV3IHRhYmxlcyAKICAgICAgICAgICAgICAgIGlm\nICghbmV3VGFibGVzLmNvbnRhaW5zKHRhYnNbal0pKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHVuaXF1ZXMgPSB0\nYWJzW2pdLmdldFVuaXF1ZXMoKTsKICAgICAgICAgICAgICAgIGlmICh1bmlx\ndWVzID09IG51bGwgfHwgdW5pcXVlcy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGRiVGFibGUg\nPSBkYi5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICBpZiAo\nZGJUYWJsZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsgPCB1bmlxdWVz\nLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5p\nbXBvcnRVbmlxdWUodW5pcXVlc1trXSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gZm9y\nZWlnbiBrZXlzCiAgICAgICAgRm9yZWlnbktleVtdIGZrczsKICAgICAgICBG\nb3JlaWduS2V5IGZrOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2No\nZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1h\nc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAvLyBj\ncmVhdGUgZm9yZWlnbiBrZXlzIG9uIG5ldyB0YWJsZXMgZXZlbiBpZiBma3MK\nICAgICAgICAgICAgICAgIC8vIGhhdmUgYmVlbiB0dXJuZWQgb2ZmCiAgICAg\nICAgICAgICAgICBpZiAoIV9ma3MgJiYgIW5ld1RhYmxlcy5jb250YWlucyh0\nYWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICBma3MgPSB0YWJzW2pdLmdldEZvcmVpZ25LZXlzKCk7CiAg\nICAgICAgICAgICAgICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHNjaGVtYXNb\naV0sdGFic1tqXS5nZXRGdWxsTmFtZSgpKTsKICAgICAgICAgICAgICAgIGZv\nciAoaW50IGsgPSAwOyBrIDwgZmtzLmxlbmd0aDsgaysrKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFma3Nba10uaXNMb2dpY2FsKCkgJiYgZGJUYWJs\nZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZrID0gZmlu\nZEZvcmVpZ25LZXkoZGJUYWJsZSwgZmtzW2tdKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGZrID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChhZGRGb3JlaWduS2V5KGZrc1trXSkpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5pbXBvcnRGb3JlaWdu\nS2V5KGZrc1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJhZGQtZmsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBma3Nba10sIHRhYnNbal0pKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIGlmICghZmtzW2tdLmVxdWFsc0ZvcmVpZ25LZXkoZmsp\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJiYWQtZmsiLCBmaywgZGJUYWJsZSkpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIERyb3BzIGFsbCBkYXRhYmFzZSBj\nb21wb25lbnRzIHRoYXQgYXJlIGluIHRoZSBnaXZlbiBkYXRhYmFzZSBzY2hl\nbWEKICAgICAqIGJ1dCBub3QgaW4gdGhlIHJlcG9zaXRvcnkgc2NoZW1hLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmV0YWluKFNjaGVtYUdyb3VwIGRi\nLCBTY2hlbWFHcm91cCByZXBvcywgYm9vbGVhbiB0YWJsZXMsCiAgICAgICAg\nYm9vbGVhbiBzZXF1ZW5jZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgU2NoZW1hW10gc2NoZW1hcyA9IGRiLmdldFNjaGVtYXMo\nKTsKICAgICAgICBpZiAoX3NlcXMgJiYgc2VxdWVuY2VzKSB7CiAgICAgICAg\nICAgIFNlcXVlbmNlW10gc2VxczsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBzZXFzID0gc2NoZW1hc1tpXS5nZXRTZXF1ZW5jZXMoKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgc2Vxcy5sZW5ndGg7IGorKykg\newogICAgICAgICAgICAgICAgICAgIGlmICghaXNEcm9wcGFibGUoc2Vxc1tq\nXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgICAgIGlmIChyZXBvcy5maW5kU2VxdWVuY2Uoc2Vxc1tqXSkg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcFNl\ncXVlbmNlKHNlcXNbal0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc2NoZW1hc1tpXS5yZW1vdmVTZXF1ZW5jZShzZXFzW2pdKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLXNlcSIsIHNlcXNbal0pKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG9yZGVyIGlzIGltcG9y\ndGFudCBpbiB0aGlzIG1ldGhvZDsgc3RhcnQgd2l0aCBmb3JlaWduIGtleXMK\nICAgICAgICBUYWJsZVtdIHRhYnM7CiAgICAgICAgVGFibGUgcmVwb3NUYWJs\nZTsKICAgICAgICBpZiAoX2ZrcykgewogICAgICAgICAgICBGb3JlaWduS2V5\nW10gZmtzOwogICAgICAgICAgICBGb3JlaWduS2V5IGZrOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygp\nOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxl\nbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3Bw\nYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgICAgICAgICAgZmtzID0gdGFic1tqXS5nZXRGb3Jl\naWduS2V5cygpOwogICAgICAgICAgICAgICAgICAgIHJlcG9zVGFibGUgPSBy\nZXBvcy5maW5kVGFibGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKCF0YWJsZXMgJiYgcmVwb3NUYWJsZSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAg\nZm9yIChpbnQgayA9IDA7IGsgPCBma3MubGVuZ3RoOyBrKyspIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGZrc1trXS5pc0xvZ2ljYWwoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgICAgICAgICAgZmsgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAocmVwb3NUYWJsZSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZmsgPSBmaW5kRm9yZWlnbktleShyZXBvc1RhYmxlLCBm\na3Nba10pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVwb3NUYWJs\nZSA9PSBudWxsIHx8IGZrID09IG51bGwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHx8ICFma3Nba10uZXF1YWxzRm9yZWlnbktleShmaykpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcm9wRm9yZWlnbktleShm\na3Nba10pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNb\nal0ucmVtb3ZlRm9yZWlnbktleShma3Nba10pOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIF9sb2cud2FybihfbG9jLmdldCgiZHJvcC1mayIsIGZrc1trXSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFic1tqXSkpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBwcmltYXJ5IGtleXMKICAgICAgICBpZiAoX3Brcykgewog\nICAgICAgICAgICBQcmltYXJ5S2V5IHBrOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIHRhYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisr\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3BwYWJsZSh0YWJz\nW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgICAgICAgICAgcGsgPSB0YWJzW2pdLmdldFByaW1hcnlLZXkoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocGsgIT0gbnVsbCAmJiBway5pc0xv\nZ2ljYWwoKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAgICAgICAgIHJlcG9zVGFibGUgPSByZXBvcy5maW5kVGFi\nbGUodGFic1tqXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrICE9IG51\nbGwgJiYgcmVwb3NUYWJsZSAhPSBudWxsCiAgICAgICAgICAgICAgICAgICAg\nICAgICYmIChyZXBvc1RhYmxlLmdldFByaW1hcnlLZXkoKSA9PSBudWxsCiAg\nICAgICAgICAgICAgICAgICAgICAgIHx8ICFway5lcXVhbHNQcmltYXJ5S2V5\nKHJlcG9zVGFibGUuZ2V0UHJpbWFyeUtleSgpKSkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGRyb3BQcmltYXJ5S2V5KHBrKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHRhYnNbal0ucmVtb3ZlUHJpbWFyeUtleSgp\nOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImRyb3AtcGsiLCBw\naywgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nY29sdW1ucwogICAgICAgIENvbHVtbltdIGNvbHM7CiAgICAgICAgQ29sdW1u\nIGNvbDsKICAgICAgICBDb2xsZWN0aW9uIGRyb3BzID0gbmV3IExpbmtlZExp\nc3QoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFicyA9IHNjaGVtYXNbaV0uZ2V0\nVGFibGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdGFi\ncy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3Bw\nYWJsZSh0YWJzW2pdKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgIGNvbHMgPSB0YWJzW2pdLmdldENvbHVtbnMoKTsK\nICAgICAgICAgICAgICAgIHJlcG9zVGFibGUgPSByZXBvcy5maW5kVGFibGUo\ndGFic1tqXSk7CiAgICAgICAgICAgICAgICBpZiAocmVwb3NUYWJsZSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgayA9IDA7IGsg\nPCBjb2xzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbCA9IHJlcG9zVGFibGUuZ2V0Q29sdW1uKGNvbHNba10uZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbCA9PSBudWxsIHx8\nICFjb2xzW2tdLmVxdWFsc0NvbHVtbihjb2wpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAodGFic1tqXS5nZXRDb2x1bW5zKCkubGVuZ3Ro\nID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHMu\nYWRkKHRhYnNbal0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxz\nZSBpZiAoZHJvcENvbHVtbihjb2xzW2tdKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0YWJzW2pdLnJlbW92ZUNvbHVtbihjb2xzW2tdKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImRyb3At\nY29sIiwgY29sc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGFic1tqXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3cgdGFibGVzCiAgICAg\nICAgaWYgKHRhYmxlcykgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRh\nYnMgPSBzY2hlbWFzW2ldLmdldFRhYmxlcygpOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKQogICAgICAg\nICAgICAgICAgICAgIGlmICghIWlzRHJvcHBhYmxlKHRhYnNbal0pCiAgICAg\nICAgICAgICAgICAgICAgICAgICYmIHJlcG9zLmZpbmRUYWJsZSh0YWJzW2pd\nKSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBkcm9wcy5hZGQo\ndGFic1tqXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZHJv\ncFRhYmxlcyhkcm9wcywgZGIpOwogICAgfQoKICAgIC8qKgogICAgICogRHJv\ncHMgYWxsIGRhdGFiYXNlIGNvbXBvbmVudHMgaW4gdGhlIGdpdmVuIHJlcG9z\naXRvcnkgc2NoZW1hLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZHJvcChT\nY2hlbWFHcm91cCBkYiwgU2NoZW1hR3JvdXAgcmVwb3MpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZHJvcCBzZXF1ZW5jZXMK\nICAgICAgICBTY2hlbWFbXSBzY2hlbWFzID0gcmVwb3MuZ2V0U2NoZW1hcygp\nOwogICAgICAgIGlmIChfc2VxcykgewogICAgICAgICAgICBTZXF1ZW5jZVtd\nIHNlcXM7CiAgICAgICAgICAgIFNlcXVlbmNlIGRiU2VxOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIHNlcXMgPSBzY2hlbWFzW2ldLmdldFNlcXVlbmNl\ncygpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBzZXFz\nLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ry\nb3BwYWJsZShzZXFzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgZGJTZXEgPSBkYi5maW5kU2Vx\ndWVuY2Uoc2Vxc1tqXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRiU2Vx\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BT\nZXF1ZW5jZShzZXFzW2pdKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGRiU2VxLmdldFNjaGVtYSgpLnJlbW92ZVNlcXVlbmNlKGRiU2VxKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJkcm9wLXNlcSIsIHNlcXNb\nal0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNhbGN1bGF0\nZSB0YWJsZXMgdG8gZHJvcDsgd2UgY2FuIG9ubHkgZHJvcCB0YWJsZXMgaWYg\nd2UncmUgc3VyZQogICAgICAgIC8vIHRoZSB1c2VyIGxpc3RlZCB0aGUgZW50\naXJlIHRhYmxlIGRlZmluaXRpb24gaW4gdGhlIHN0dWZmIHRoZXkgd2FudAog\nICAgICAgIC8vIGRyb3BwZWQ7IGVsc2UgdGhleSBtaWdodCBqdXN0IHdhbnQg\ndG8gZHJvcCBhIGZldyBjb2x1bW5zCiAgICAgICAgQ29sbGVjdGlvbiBkcm9w\ncyA9IG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgVGFibGVbXSB0YWJzOwog\nICAgICAgIFRhYmxlIGRiVGFibGU7CiAgICAgICAgQ29sdW1uW10gZGJDb2xz\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJs\nZXMoKTsKICAgICAgICAgICAgdGFibGVzOgogICAgICAgICAgICBmb3IgKGlu\ndCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAg\nICAgIGlmICghaXNEcm9wcGFibGUodGFic1tqXSkpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBkYlRhYmxlID0gZGIu\nZmluZFRhYmxlKHRhYnNbal0pOwogICAgICAgICAgICAgICAgaWYgKGRiVGFi\nbGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICBkYkNvbHMgPSBkYlRhYmxlLmdldENvbHVtbnMoKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGsgPSAwOyBrIDwgZGJDb2xzLmxl\nbmd0aDsgaysrKQogICAgICAgICAgICAgICAgICAgIGlmICh0YWJzW2pdLmdl\ndENvbHVtbihkYkNvbHNba10uZ2V0TmFtZSgpKSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZSB0YWJsZXM7CgogICAgICAgICAg\nICAgICAgZHJvcHMuYWRkKHRhYnNbal0pOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBvcmRlciBpcyBpbXBvcnRhbnQgaW4gdGhpcyBt\nZXRob2Q7IHN0YXJ0IHdpdGggZm9yZWlnbiBrZXlzIG1lbnRpb25lZAogICAg\nICAgIC8vIGluIHRoZSBkcm9wIHNjaGVtYQogICAgICAgIGlmIChfZmtzKSB7\nCiAgICAgICAgICAgIEZvcmVpZ25LZXlbXSBma3M7CiAgICAgICAgICAgIEZv\ncmVpZ25LZXkgZms7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGFicyA9\nIHNjaGVtYXNbaV0uZ2V0VGFibGVzKCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBqID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxlKHRhYnNbal0pKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAg\nICBma3MgPSB0YWJzW2pdLmdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAgICAg\nICAgICAgICAgZGJUYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAg\nICAgICAgICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IGZrcy5sZW5n\ndGg7IGsrKykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmtzW2td\nLmlzTG9naWNhbCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICBmayA9IG51bGw7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmayA9IGZpbmRGb3JlaWduS2V5\nKGRiVGFibGUsIGZrc1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChkYlRhYmxlID09IG51bGwgfHwgZmsgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGRyb3BGb3JlaWduS2V5KGZrc1trXSkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUucmVtb3ZlRm9yZWln\nbktleShmayk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2Mu\nZ2V0KCJkcm9wLWZrIiwgZmtzW2tdLCB0YWJzW2pdKSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBhbHNvIGRyb3AgaW1wb3J0ZWQgZm9yZWlnbiBrZXlz\nIGZvciB0YWJsZXMgdGhhdCB3aWxsIGJlIGRyb3BwZWQKICAgICAgICAgICAg\nVGFibGUgdGFiOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGRy\nb3BzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICB0YWIgPSAoVGFibGUpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICBkYlRhYmxlID0gZGIuZmluZFRhYmxlKHRhYik7CiAgICAgICAgICAgICAg\nICBpZiAoZGJUYWJsZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgICAgIGZrcyA9IGRiLmZpbmRFeHBvcnRl\nZEZvcmVpZ25LZXlzKGRiVGFibGUuZ2V0UHJpbWFyeUtleSgpKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRyb3BGb3JlaWduS2V5KGZr\nc1tpXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGRiVGFibGUucmVtb3Zl\nRm9yZWlnbktleShma3NbaV0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJk\ncm9wLWZrIiwgZmtzW2ldLCBkYlRhYmxlKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGRyb3AgdGhl\nIHRhYmxlcyB3ZSBjYWxjdWxhdGVkIGFib3ZlCiAgICAgICAgZHJvcFRhYmxl\ncyhkcm9wcywgZGIpOwoKICAgICAgICAvLyBjb2x1bW5zCiAgICAgICAgQ29s\ndW1uW10gY29sczsKICAgICAgICBDb2x1bW4gY29sOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgc2NoZW1hcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICB0YWJzID0gc2NoZW1hc1tpXS5nZXRUYWJsZXMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaiA9IDA7IGogPCB0YWJzLmxlbmd0aDsgaisrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoIWlzRHJvcHBhYmxlKHRhYnNbal0pKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29s\ncyA9IHRhYnNbal0uZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAgZGJU\nYWJsZSA9IGRiLmZpbmRUYWJsZSh0YWJzW2pdKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGsgPSAwOyBrIDwgY29scy5sZW5ndGg7IGsrKykgewogICAg\nICAgICAgICAgICAgICAgIGNvbCA9IG51bGw7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGRiVGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgY29sID0gZGJUYWJsZS5nZXRDb2x1bW4oY29sc1trXS5nZXROYW1lKCkp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChkYlRhYmxlID09IG51bGwgfHwg\nY29sID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZHJvcENvbHVtbihjb2xzW2td\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGJUYWJsZSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJUYWJsZS5yZW1v\ndmVDb2x1bW4oY29sKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJkcm9wLWNvbCIsIGNvbHNba10sIHRhYnNbal0pKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0\naGUgdGFibGUgaXMgZHJvcHBhYmxlLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gaXNEcm9wcGFibGUoVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1\ncm4gX29wZW5qcGFUYWJsZXMKICAgICAgICAgICAgfHwgKCF0YWJsZS5nZXRO\nYW1lKCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJPUEVOSlBBXyIpCiAg\nICAgICAgICAgICYmICF0YWJsZS5nZXROYW1lKCkudG9VcHBlckNhc2UoKS5z\ndGFydHNXaXRoKCJKRE9fIikpOyAvLyBsZWdhY3kKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBzZXF1ZW5jZSBpcyBkcm9wcGFi\nbGUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0Ryb3BwYWJsZShT\nZXF1ZW5jZSBzZXEpIHsKICAgICAgICByZXR1cm4gX29wZW5qcGFUYWJsZXMK\nICAgICAgICAgICAgfHwgKCFzZXEuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCku\nc3RhcnRzV2l0aCgiT1BFTkpQQV8iKQogICAgICAgICAgICAmJiAhc2VxLmdl\ndE5hbWUoKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIkpET18iKSk7IC8v\nIGxlZ2FjeQogICAgfQoKICAgIC8qKgogICAgICogRmluZCBhbiBpbmRleCBp\nbiB0aGUgZ2l2ZW4gdGFibGUgdGhhdCBtYXRjaGVzIHRoZSBnaXZlbiBvbmUu\nCiAgICAgKi8KICAgIHByaXZhdGUgSW5kZXggZmluZEluZGV4KFRhYmxlIGRi\nVGFibGUsIEluZGV4IGlkeCkgewogICAgICAgIEluZGV4W10gaWR4cyA9IGRi\nVGFibGUuZ2V0SW5kZXhlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgaWR4cy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGlkeC5jb2x1\nbW5zTWF0Y2goaWR4c1tpXS5nZXRDb2x1bW5zKCkpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGlkeHNbaV07CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaW5kIGEgZm9yZWlnbiBrZXkgaW4gdGhlIGdp\ndmVuIHRhYmxlIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gb25lLgogICAgICov\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgZmluZEZvcmVpZ25LZXkoVGFibGUg\nZGJUYWJsZSwgRm9yZWlnbktleSBmaykgewogICAgICAgIGlmIChmay5nZXRD\nb25zdGFudENvbHVtbnMoKS5sZW5ndGggPiAwCiAgICAgICAgICAgIHx8IGZr\nLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5ndGggPiAwKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBGb3JlaWduS2V5W10g\nZmtzID0gZGJUYWJsZS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBp\nZiAoZmsuY29sdW1uc01hdGNoKGZrc1tpXS5nZXRDb2x1bW5zKCksCiAgICAg\nICAgICAgICAgICBma3NbaV0uZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSkpCiAg\nICAgICAgICAgICAgICByZXR1cm4gZmtzW2ldOwogICAgICAgIHJldHVybiBu\ndWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBj\nb2xsZWN0aW9uIG9mIHRhYmxlcyBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEu\nIE9yZGVycwogICAgICogdGhlIHJlbW92YWxzIGFjY29yZGluZyB0byBmb3Jl\naWduIGtleSBjb25zdHJhaW50cyBvbiB0aGUgdGFibGVzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgZHJvcFRhYmxlcyhDb2xsZWN0aW9uIHRhYmxlcywg\nU2NoZW1hR3JvdXAgY2hhbmdlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh0YWJsZXMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIFRhYmxlIHRhYmxlOwogICAgICAgIFRhYmxl\nIGNoYW5nZVRhYmxlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdGFi\nbGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nIHRhYmxlID0gKFRhYmxlKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nZHJvcFRhYmxlKHRhYmxlKSkgewogICAgICAgICAgICAgICAgY2hhbmdlVGFi\nbGUgPSBjaGFuZ2UuZmluZFRhYmxlKHRhYmxlKTsKICAgICAgICAgICAgICAg\nIGlmIChjaGFuZ2VUYWJsZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGNoYW5nZVRhYmxlLmdldFNjaGVtYSgpLnJlbW92ZVRhYmxlKGNoYW5nZVRh\nYmxlKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBfbG9n\nLndhcm4oX2xvYy5nZXQoImRyb3AtdGFibGUiLCB0YWJsZSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gdGFibGUg\ndG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ug\nb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNyZWF0ZVRh\nYmxlKFRhYmxlIHRhYmxlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldENyZWF0ZVRh\nYmxlU1FMKHRhYmxlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRo\nZSBnaXZlbiB0YWJsZSBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAg\nKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1\nY2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBkcm9wVGFibGUoVGFibGUgdGFibGUpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2Rp\nY3QuZ2V0RHJvcFRhYmxlU1FMKHRhYmxlKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGdpdmVuIHNlcXVlbmNlIHRvIHRoZSBkYXRhYmFzZSBz\nY2hlbWEuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVy\nYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBjcmVhdGVTZXF1ZW5jZShTZXF1ZW5jZSBz\nZXEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGV4ZWN1dGVTUUwoX2RpY3QuZ2V0Q3JlYXRlU2VxdWVuY2VTUUwoc2Vx\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRoZSBnaXZlbiBzZXF1\nZW5jZSBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEuCiAgICAgKgogICAgICog\nQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWws\nIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBk\ncm9wU2VxdWVuY2UoU2VxdWVuY2Ugc2VxKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0Lmdl\ndERyb3BTZXF1ZW5jZVNRTChzZXEpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCB0aGUgZ2l2ZW4gaW5kZXggdG8gdGhlIGRhdGFiYXNlIHNjaGVtYS4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3\nYXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGNyZWF0ZUluZGV4KEluZGV4IGlkeCwgVGFibGUgdGFi\nbGUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CgogICAgICAgIGlm\nICghX2RpY3QubmVlZHNUb0NyZWF0ZUluZGV4KGlkeCx0YWJsZSkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaW50IG1heCA9IF9kaWN0\nLm1heEluZGV4ZXNQZXJUYWJsZTsKCiAgICAgICAgaW50IGxlbiA9IHRhYmxl\nLmdldEluZGV4ZXMoKS5sZW5ndGg7CiAgICAgICAgaWYgKHRhYmxlLmdldFBy\naW1hcnlLZXkoKSAhPSBudWxsKQogICAgICAgICAgICBsZW4gKz0gdGFibGUu\nZ2V0UHJpbWFyeUtleSgpLmdldENvbHVtbnMoKS5sZW5ndGg7CgogICAgICAg\nIGlmIChsZW4gPj0gbWF4KSB7CiAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgidG9vLW1hbnktaW5kZXhlcyIsIGlkeCwgdGFibGUsIG1heCArICIi\nKSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldENyZWF0ZUluZGV4U1FM\nKGlkeCkpOwogICAgfQoKICAgIC8qKgogICAgICogRHJvcCB0aGUgZ2l2ZW4g\naW5kZXggZnJvbSB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVs\nLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nZHJvcEluZGV4KEluZGV4IGlkeCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXREcm9w\nSW5kZXhTUUwoaWR4KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhl\nIGdpdmVuIGNvbHVtbiB0byB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoK\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNj\nZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gYWRkQ29sdW1uKENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVTUUwoX2RpY3Qu\nZ2V0QWRkQ29sdW1uU1FMKGNvbCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nRHJvcCB0aGUgZ2l2ZW4gY29sdW1uIGZyb20gdGhlIGRhdGFiYXNlIHNjaGVt\nYS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlv\nbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGRyb3BDb2x1bW4oQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0\nZVNRTChfZGljdC5nZXREcm9wQ29sdW1uU1FMKGNvbCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBwcmltYXJ5IGtleSB0byB0aGUg\nZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBp\nZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndp\nc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gYWRkUHJpbWFyeUtleShQ\ncmltYXJ5S2V5IHBrKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBleGVjdXRlU1FMKF9kaWN0LmdldEFkZFByaW1hcnlL\nZXlTUUwocGspKTsKICAgIH0KCiAgICAvKioKICAgICAqIERyb3AgdGhlIGdp\ndmVuIHByaW1hcnkga2V5IGZyb20gdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMg\nc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGRyb3BQcmltYXJ5S2V5KFByaW1hcnlLZXkgcGspCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGV4ZWN1\ndGVTUUwoX2RpY3QuZ2V0RHJvcFByaW1hcnlLZXlTUUwocGspKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdG8g\ndGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3Ro\nZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGFkZEZvcmVpZ25L\nZXkoRm9yZWlnbktleSBmaykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZVNRTChfZGljdC5nZXRBZGRGb3Jl\naWduS2V5U1FMKGZrKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEcm9wIHRo\nZSBnaXZlbiBmb3JlaWduIGtleSBmcm9tIHRoZSBkYXRhYmFzZSBzY2hlbWEu\nCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBvcGVyYXRpb24g\nd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBkcm9wRm9yZWlnbktleShGb3JlaWduS2V5IGZrKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBl\neGVjdXRlU1FMKF9kaWN0LmdldERyb3BGb3JlaWduS2V5U1FMKGZrKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGFiYXNlIHNjaGVt\nYS4KICAgICAqLwogICAgcHVibGljIFNjaGVtYUdyb3VwIGdldERCU2NoZW1h\nR3JvdXAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGdl\ndERCU2NoZW1hR3JvdXAodHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIGRhdGFiYXNlIHNjaGVtYS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0REJTY2hlbWFHcm91cChTY2hlbWFHcm91cCBkYikg\newogICAgICAgIF9kYiA9IGRiOwogICAgICAgIGlmIChkYiAhPSBudWxsKQog\nICAgICAgICAgICBfZnVsbERCID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgZGF0YWJhc2Ugc2NoZW1hLgogICAgICoKICAgICAq\nIEBwYXJhbSBmdWxsIGlmIGZhbHNlLCBvbmx5IHRoZSB0YWJsZXMgbmFtZWQg\naW4gdGhlIHNldCBzY2hlbWEKICAgICAqIHJlcG9zaXRvcnkgd2lsbCBiZSBn\nZW5lcmF0ZWQKICAgICAqLwogICAgcHJpdmF0ZSBTY2hlbWFHcm91cCBnZXRE\nQlNjaGVtYUdyb3VwKGJvb2xlYW4gZnVsbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2RiID09IG51bGwgfHwgKGZ1bGwg\nJiYgIV9mdWxsREIpKSB7CiAgICAgICAgICAgIFNjaGVtYUdlbmVyYXRvciBn\nZW4gPSBuZXcgU2NoZW1hR2VuZXJhdG9yKF9jb25mKTsKICAgICAgICAgICAg\nZ2VuLnNldFByaW1hcnlLZXlzKF9wa3MpOwogICAgICAgICAgICBnZW4uc2V0\nRm9yZWlnbktleXMoX2Zrcyk7CiAgICAgICAgICAgIGdlbi5zZXRJbmRleGVz\nKF9pbmRleGVzKTsKICAgICAgICAgICAgaWYgKGZ1bGwpCiAgICAgICAgICAg\nICAgICBnZW4uZ2VuZXJhdGVTY2hlbWFzKCk7CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgLy8gZ2VuZXJhdGUgb25seSB0aGUgdGFibGVz\nIGluIHRoZSBnaXZlbiByZXBvc2l0b3J5CiAgICAgICAgICAgICAgICAvLyBn\ncm91cDsgc29tZSBtYXkgbm90IGV4aXN0IHlldCwgd2hpY2ggaXMgT0s7IHdl\nIGp1c3QgbmVlZAogICAgICAgICAgICAgICAgLy8gdG8gbWFrZSBzdXJlIHdl\nIGNhbiBkZXRlY3QgdGhlIGNoYW5nZXMgdG8gdGhlIG9uZXMgdGhhdAogICAg\nICAgICAgICAgICAgLy8gZG8gZXhpc3QKICAgICAgICAgICAgICAgIENvbGxl\nY3Rpb24gdGFibGVzID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICAgICAg\nICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gYXNzZXJ0U2NoZW1hR3JvdXAoKTsK\nICAgICAgICAgICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBncm91cC5nZXRT\nY2hlbWFzKCk7CiAgICAgICAgICAgICAgICBUYWJsZVtdIHRhYnM7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICB0YWJzID0gc2NoZW1hc1tp\nXS5nZXRUYWJsZXMoKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBq\nID0gMDsgaiA8IHRhYnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHRhYnNbal0uZ2V0U2NoZW1hTmFtZSgpID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZXMuYWRkKCIuIiAr\nIHRhYnNbal0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVzLmFkZCh0\nYWJzW2pdLmdldEZ1bGxOYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghdGFibGVz\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBnZW4uZ2VuZXJhdGVT\nY2hlbWFzKChTdHJpbmdbXSkgdGFibGVzLnRvQXJyYXkKICAgICAgICAgICAg\nICAgICAgICAgICAgKG5ldyBTdHJpbmdbdGFibGVzLnNpemUoKV0pKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBfZGIgPSBnZW4uZ2V0U2NoZW1hR3Jv\ndXAoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9kYjsKICAgIH0KCiAg\nICBwcml2YXRlIFNjaGVtYUdyb3VwIGFzc2VydFNjaGVtYUdyb3VwKCkgewog\nICAgICAgIFNjaGVtYUdyb3VwIGxvY2FsID0gZ2V0U2NoZW1hR3JvdXAoKTsK\nICAgICAgICBpZiAobG9jYWwgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgidG9vbC1ub3Jl\ncG9zIikpOwogICAgICAgIHJldHVybiBsb2NhbDsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8vLy8K\nCiAgICAvKioKICAgICAqIEV4ZWN1dGVzIHRoZSBnaXZlbiBhcnJheSBvZiBu\nb24tc2VsZWN0aW5nIFNRTCBzdGF0ZW1lbnRzLCBjb3JyZWN0bHkKICAgICAq\nIGxvZ2dpbmcgdGhlIFNRTCBjYWxscyBhbmQgb3B0aW9uYWxseSBpZ25vcmlu\nZyBlcnJvcnMuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZXJl\nIHdhcyBTUUwgdG8gZXhlY3V0ZSBhbmQgdGhlIGNhbGxzIHdlcmUKICAgICAq\nIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gZXhlY3V0ZVNRTChTdHJpbmdbXSBzcWwpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgbm8gc3FsLCBw\ncm9iYWJseSBiL2MgZGljdGlvbmFyeSBkb2Vzbid0IHN1cHBvcnQgb3BlcmF0\naW9uCiAgICAgICAgaWYgKHNxbC5sZW5ndGggPT0gMCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICBib29sZWFuIGVyciA9IGZhbHNlOwog\nICAgICAgIGlmIChfd3JpdGVyID09IG51bGwpIHsKICAgICAgICAgICAgLy8g\ndGhpcyBpcyBvdXRzaWRlIHRoZSB0cnktY2F0Y2ggYmVjYXVzZSBhIGZhaWx1\ncmUgaGVyZSBpcwogICAgICAgICAgICAvLyByZWFsbHkgYmFkLCBhbmQgc2hv\ndWxkIG5vdCBiZSBpZ25vcmVkLgogICAgICAgICAgICBDb25uZWN0aW9uIGNv\nbm4gPSBfZHMuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgICAgICBTdGF0ZW1l\nbnQgc3RhdGVtZW50ID0gbnVsbDsKICAgICAgICAgICAgYm9vbGVhbiB3YXNB\ndXRvID0gdHJ1ZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHdhc0F1dG8gPSBjb25uLmdldEF1dG9Db21taXQoKTsKICAgICAgICAgICAg\nICAgIGlmICghd2FzQXV0bykKICAgICAgICAgICAgICAgICAgICBjb25uLnNl\ndEF1dG9Db21taXQodHJ1ZSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHNxbC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvbWUgY29u\nbmVjdGlvbnMgcmVxdWlyZSB0aGF0IHJvbGxiYWNrIGJlCiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIGNhbGxlZCBvbiB0aGUgY29ubmVjdGlvbiBiZWZv\ncmUgYW55IERETCBzdGF0ZW1lbnRzCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNhbiBiZSBydW4gb24gaXQsIGV2ZW4gd2hlbiBhdXRvY29tbWl0IGlz\nIG9uLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHNvbWV0\naW1lcyBiZWNhdXNlIHRoZSBjb25uZWN0aW9uIGRvZXMgbm90CiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGFsbG93IERETCBzdGF0ZW1lbnRzIHdoZW4g\ndGhlcmUgYXJlIG11bHRpcGxlCiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGNvbW1hbmRzIGlzc3VlZCBvbiB0aGUgY29ubmVjdGlvbiwgYW5kIHRoZQog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25uZWN0aW9uIHBvb2wgbWF5\nIGhhdmUgaXNzdWVkIHNvbWUgdmFsaWRhdGlvbiBTUUwuCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudCA9IGNvbm4u\nY3JlYXRlU3RhdGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0\nYXRlbWVudC5leGVjdXRlVXBkYXRlKHNxbFtpXSk7CgogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBzb21lIGNvbm5lY3Rpb25zIHNlZW0gdG8gcmVxdWly\nZSBhbiBleHBsaWNpdAogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb21t\naXQgZm9yIERETCBzdGF0ZW1lbnRzLCBldmVuIHdoZW4gYXV0b2NvbW1pdAog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBpcyBvbi4gVGhlIERhdGFEaXJl\nY3QgZHJpdmVycyBzZWVtIHRvIHN1ZmZlciBmcm9tCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIHRoaXMgbGltaXRhdGlvbi4KICAgICAgICAgICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbm4uY29tbWl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBl\ncnIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVFeGNl\ncHRpb24oc2UpOwogICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZW1lbnQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc3RhdGVtZW50LmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoIXdh\nc0F1dG8pCiAgICAgICAgICAgICAgICAgICAgY29ubi5zZXRBdXRvQ29tbWl0\nKGZhbHNlKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgY29ubi5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHNxbC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIF93\ncml0ZXIucHJpbnRsbihzcWxbaV0gKyAiOyIpOwogICAgICAgICAgICBfd3Jp\ndGVyLmZsdXNoKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gIWVycjsK\nICAgIH0KCiAgICAvKioKICAgICAqIEhhbmRsZSB0aGUgZ2l2ZW4gZXhjZXB0\naW9uLCBsb2dnaW5nIGl0IGFuZCBvcHRpb25hbGx5IGlnbm9yaW5nIGl0LAog\nICAgICogZGVwZW5kaW5nIG9uIHRoZSBmbGFncyB0aGlzIFNjaGVtYVRvb2wg\nd2FzIGNyZWF0ZWQgd2l0aC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGhh\nbmRsZUV4Y2VwdGlvbihTUUxFeGNlcHRpb24gc3FsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghX2lnbm9yZUVycnMpCiAg\nICAgICAgICAgIHRocm93IHNxbDsKICAgICAgICBfbG9nLndhcm4oc3FsLmdl\ndE1lc3NhZ2UoKSwgc3FsKTsKICAgIH0KCiAgICAvLy8vLy8vLwogICAgLy8g\nTWFpbgogICAgLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFVzYWdlOiBqYXZh\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFUb29sIFtv\ncHRpb25dKgogICAgICogWy1hY3Rpb24vLWEgJmx0O2FkZCB8IHJldGFpbiB8\nIGRyb3AgfCByZWZyZXNoIHwgY3JlYXRlREIgfCBkcm9wREIKICAgICAqIHwg\nYnVpbGQgfCByZWZsZWN0IHwgaW1wb3J0IHwgZXhwb3J0Jmd0O10KICAgICAq\nICZsdDsuc2NoZW1hIGZpbGUgb3IgcmVzb3VyY2UmZ3Q7KgogICAgICogIFdo\nZXJlIHRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgcmVjb2duaXplZC4KICAg\nICAqIDx1bD4KICAgICAqIDxsaT48aT4tcHJvcGVydGllcy8tcCAmbHQ7cHJv\ncGVydGllcyBmaWxlIG9yIHJlc291cmNlJmd0OzwvaT46IFRoZQogICAgICog\ncGF0aCBvciByZXNvdXJjZSBuYW1lIG9mIGEgT3BlbkpQQSBwcm9wZXJ0aWVz\nIGZpbGUgY29udGFpbmluZwogICAgICogaW5mb3JtYXRpb24gc3VjaCBhcyB0\naGUgbGljZW5zZSBrZXkJYW5kIGNvbm5lY3Rpb24gZGF0YSBhcwogICAgICog\nb3V0bGluZWQgaW4ge0BsaW5rIEpEQkNDb25maWd1cmF0aW9ufS4gT3B0aW9u\nYWwuPC9saT4KICAgICAqIDxsaT48aT4tJmx0O3Byb3BlcnR5IG5hbWUmZ3Q7\nICZsdDtwcm9wZXJ0eSB2YWx1ZSZndDs8L2k+OiBBbGwgYmVhbgogICAgICog\ncHJvcGVydGllcyBvZiB0aGUgT3BlbkpQQSB7QGxpbmsgSkRCQ0NvbmZpZ3Vy\nYXRpb259IGNhbiBiZSBzZXQgYnkKICAgICAqIHVzaW5nIHRoZWlyCW5hbWVz\nIGFuZCBzdXBwbHlpbmcgYSB2YWx1ZS4gRm9yIGV4YW1wbGU6CiAgICAgKiA8\nY29kZT4tbGljZW5zZUtleSBhZHNsZmphODNyM2xrYWRmPC9jb2RlPjwvbGk+\nCiAgICAgKiA8bGk+PGk+LWlnbm9yZUVycm9ycy8taSAmbHQ7dHJ1ZS90IHwg\nZmFsc2UvZiZndDs8L2k+OiBJZiBmYWxzZSwgYW4KICAgICAqIGV4Y2VwdGlv\nbiB3aWxsIHdpbGwgYmUgdGhyb3duIGlmIHRoZSB0b29sIGVuY291bnRlcnMg\nYW55IGRhdGFiYXNlCiAgICAgKiBleGNlcHRpb25zOyBkZWZhdWx0cyB0byA8\nY29kZT5mYWxzZTwvY29kZT4uPC9saT4KICAgICAqIDxsaT48aT4tZmlsZS8t\nZiAmbHQ7c3Rkb3V0IHwgb3V0cHV0IGZpbGUgb3IgcmVzb3VyY2UmZ3Q7PC9p\nPjogVXNlIHRoaXMKICAgICAqIG9wdGlvbiB0byB3cml0ZSBhIFNRTCBzY3Jp\ncHQgZm9yIHRoZSBwbGFubmVkIHNjaGVtYSBtb2RpZmljYXRpb25zLAogICAg\nICogcmF0aGVyIHRoYW4gY29tbWl0dGluZyB0aGVtIHRvIHRoZSBkYXRhYmFz\nZS4gVGhpcyBvcHRpb24gYWxzbwogICAgICogYXBwbGllcyB0byB0aGUgPGNv\nZGU+ZXhwb3J0PC9jb2RlPiBhbmQgPGNvZGU+cmVmbGVjdDwvY29kZT4gYWN0\naW9ucy48L2xpPgogICAgICogPGxpPjxpPi1vcGVuanBhVGFibGVzLy1rdCAm\nbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBVbmRlciB0aGUKICAgICAq\nIDxjb2RlPnJlZmxlY3Q8L2NvZGU+IGFjdGlvbiwgd2hldGhlciB0byByZWZs\nZWN0IG9uIHRhYmxlcyB3aXRoCiAgICAgKiB0aGUgbmFtZSA8Y29kZT5PUEVO\nSlBBXyo8L2NvZGU+LiBVbmRlciBvdGhlciBhY3Rpb25zLCB3aGV0aGVyIHRv\nCiAgICAgKiBkcm9wIHN1Y2ggdGFibGVzLiBEZWZhdWx0cyB0byA8Y29kZT5m\nYWxzZTwvY29kZT4uPC9saT4KICAgICAqIDxsaT48aT4tZHJvcFRhYmxlcy8t\nZHQgJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogU2V0IHRoaXMgb3B0\naW9uIHRvCiAgICAgKiB0cnVlIHRvIGRyb3AgdGFibGVzIHRoYXQgYXBwZWFy\nIHRvIGJlIHVudXNlZCBkdXJpbmcKICAgICAqIDxjb2RlPnJldGFpbjwvY29k\nZT4JYW5kIDxjb2RlPnJlZnJlc2g8L2NvZGU+IGFjdGlvbnMuIERlZmF1bHRz\nIHRvCiAgICAgKiA8Y29kZT50cnVlPC9jb2RlPi48L2xpPgogICAgICogPGxp\nPjxpPi1kcm9wU2VxdWVuY2VzLy1kc3EgJmx0O3RydWUvdCB8IGZhbHNlL2Ym\nZ3Q7PC9pPjogU2V0IHRoaXMgb3B0aW9uCiAgICAgKiB0byB0cnVlIHRvIGRy\nb3Agc2VxdWVuY2VzIHRoYXQgYXBwZWFyIHRvIGJlIHVudXNlZCBkdXJpbmcK\nICAgICAqIDxjb2RlPnJldGFpbjwvY29kZT4JYW5kIDxjb2RlPnJlZnJlc2g8\nL2NvZGU+IGFjdGlvbnMuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT50cnVl\nPC9jb2RlPi48L2xpPgogICAgICogPGxpPjxpPi1wcmltYXJ5S2V5cy8tcGsg\nJmx0O3RydWUvdCB8IGZhbHNlL2YmZ3Q7PC9pPjogV2hldGhlciBwcmltYXJ5\nCiAgICAgKiBrZXlzIG9uIGV4aXN0aW5nIHRhYmxlcyBhcmUgbWFuaXB1bGF0\nZWQuIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48aT4tZm9y\nZWlnbktleXMvLWZrICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0OzwvaT46IFdo\nZXRoZXIgZm9yZWlnbgogICAgICoga2V5cyBvbiBleGlzdGluZyB0YWJsZXMg\nYXJlIG1hbmlwdWxhdGVkLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAgICAg\nKiA8bGk+PGk+LWluZGV4ZXMvLWl4ICZsdDt0cnVlL3QgfCBmYWxzZS9mJmd0\nOzwvaT46IFdoZXRoZXIgaW5kZXhlcwogICAgICogb24gZXhpc3RpbmcgdGFi\nbGVzIGFyZSBtYW5pcHVsYXRlZC4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgog\nICAgICogPGxpPjxpPi1zZXF1ZW5jZXMvLXNxICZsdDt0cnVlL3QgfCBmYWxz\nZS9mJmd0OzwvaT46IFdoZXRoZXIgdG8KICAgICAqIG1hbmlwdWxhdGUgc2Vx\ndWVuY2VzLiBEZWZhdWx0cyB0byB0cnVlLjwvbGk+CiAgICAgKiA8bGk+PGk+\nLXJlY29yZC8tciAmbHQ7dHJ1ZS90IHwgZmFsc2UvZiZndDs8L2k+OiBTZXQg\ndGhpcyBvcHRpb24gdG8KICAgICAqIDxjb2RlPmZhbHNlPC9jb2RlPiB0byBw\ncmV2ZW50IHdyaXRpbmcgdGhlIHNjaGVtYSBjaGFuZ2VzIHRvIHRoZQogICAg\nICogY3VycmVudCB7QGxpbmsgU2NoZW1hRmFjdG9yeX0uPC9saT4KICAgICAq\nIDwvdWw+CiAgICAgKiAgQWN0aW9ucyBjYW4gYmUgY29tcG9zZWQgaW4gYSBj\nb21tYS1zZXBhcmF0ZWQgbGlzdC4gVGhlIHZhcmlvdXMgYWN0aW9ucyAKICAg\nICAqICBhcmUgYXMgZm9sbG93cy4KICAgICAqIDx1bD4KICAgICAqIDxsaT48\naT5hZGQ8L2k+OiBCcmluZyB0aGUgc2NoZW1hIHVwLXRvLWRhdGUgd2l0aCB0\naGUgbGF0ZXN0CiAgICAgKiBjaGFuZ2VzIHRvIHRoZSBzY2hlbWEgWE1MIGRh\ndGEgYnkgYWRkaW5nIHRhYmxlcywgY29sdW1ucywKICAgICAqIGluZGV4ZXMs\nIGV0Yy4gVGhpcyBhY3Rpb24gbmV2ZXIgZHJvcHMgYW55IGRhdGEuIFRoaXMg\naXMgdGhlCiAgICAgKiBkZWZhdWx0IGFjdGlvbi48L2xpPgogICAgICogPGxp\nPjxpPnJldGFpbjwvaT46IEtlZXAgYWxsIHNjaGVtYSBjb21wb25lbnRzIGlu\nIHRoZSBzY2hlbWEgWE1MLCBidXQKICAgICAqIGRyb3AgdGhlIHJlc3QgZnJv\nbSB0aGUgZGF0YWJhc2UuIFRoaXMgYWN0aW9uIG5ldmVyIGFkZHMgYW55IGRh\ndGEuPC9saT4KICAgICAqIDxsaT48aT5kcm9wPC9pPjogRHJvcCBhbGwgdGhl\nIHNjaGVtYSBjb21wb25lbnRzIGluIHRoZSBzY2hlbWEgWE1MLjwvbGk+CiAg\nICAgKiA8bGk+PGk+cmVmcmVzaDwvaT46IEVxdWl2YWxlbnQgdG8gcmV0YWlu\nLCB0aGVuIGFkZC48L2xpPgogICAgICogPGxpPjxpPmNyZWF0ZURCPC9pPjog\nRXhlY3V0ZSBTUUwgdG8gcmUtY3JlYXRlIHRoZSBjdXJyZW50IGRhdGFiYXNl\nLgogICAgICogVGhpcyBhY3Rpb24gaXMgdHlwaWNhbGx5IHVzZWQgaW4gY29u\nanVjdGlvbiB3aXRoIHRoZQogICAgICogPGNvZGU+ZmlsZTwvY29kZT4gb3B0\naW9uLjwvbGk+CiAgICAgKiA8bGk+PGk+YnVpbGQ8L2k+OiBFeGVjdXRlIFNR\nTCB0byBidWlsZCB0aGUgc2NoZW1hIGRlZmluZWQgaW4gdGhlIFhNTC4KICAg\nICAqIEJlY2F1c2UgaXQgZG9lc24ndCB0YWtlIHRoZSBjdXJyZW50IGRhdGFi\nYXNlIHNjaGVtYSBpbnRvIGFjY291bnQsCiAgICAgKiB0aGlzIGFjdGlvbiBp\ncyB0eXBpY2FsbHkgdXNlZCBpbiBjb25qdWN0aW9uIHdpdGggdGhlCiAgICAg\nKiA8Y29kZT5maWxlPC9jb2RlPiBvcHRpb24uPC9saT4KICAgICAqIDxsaT48\naT5yZWZsZWN0PC9pPjogUmVmbGVjdCBvbiB0aGUgY3VycmVudCBkYXRhYmFz\nZSBzY2hlbWEuIFdyaXRlIHRoZQogICAgICogc2NoZW1hJ3MgWE1MIHJlcHJl\nc2VudGF0aW9uIHRvIHRoZSBmaWxlIHNwZWNpZmllZCB3aXRoIHRoZQogICAg\nICogPGNvZGU+ZmlsZTwvY29kZT4gb3B0aW9uLCBvciB0byBzdGRvdXQgaWYg\nbm8gZmlsZSBpcyBnaXZlbi48L2xpPgogICAgICogPGxpPjxpPmRyb3BEQjwv\naT46IEV4ZWN1dGUgU1FMIHRvIGRyb3AgdGhlIGN1cnJlbnQgZGF0YWJhc2Uu\nIFRoaXMKICAgICAqIGFjdGlvbiBpbXBsaWVzIDxjb2RlPmRyb3BUYWJsZXM8\nL2NvZGU+LjwvbGk+CiAgICAgKiA8bGk+PGk+ZGVsZXRlVGFibGVDb250ZW50\nczwvaT46IEV4ZWN1dGUgU1FMIHRvIGRlbGV0ZSBhbGwgcm93cyBmcm9tIAog\nICAgICogYWxsIHRhYmxlcyB0aGF0IE9wZW5KUEEga25vd3MgYWJvdXQuPC9s\naT4KICAgICAqIDxsaT48aT5pbXBvcnQ8L2k+OiBJbXBvcnQgdGhlIGdpdmVu\nIFhNTCBzY2hlbWEgZGVmaW5pdGlvbiBpbnRvIHRoZQogICAgICogY3VycmVu\ndCB7QGxpbmsgU2NoZW1hRmFjdG9yeX0uPC9saT4KICAgICAqIDxsaT48aT5l\neHBvcnQ8L2k+OiBFeHBvcnQgdGhlIGN1cnJlbnQge0BsaW5rIFNjaGVtYUZh\nY3Rvcnl9J3MgcmVjb3JkZWQKICAgICAqIHNjaGVtYSB0byBhbiBYTUwgc2No\nZW1hIGRlZmluaXRpb24gZmlsZS48L2xpPgogICAgICogPC91bD4KICAgICAq\nICBFeGFtcGxlczoKICAgICAqIDx1bD4KICAgICAqIDxsaT5Xcml0ZSBhIHNj\ncmlwdCB0byBzdGRvdXQgdG8gcmUtY3JlYXRlIHRoZSBjdXJyZW50IGRhdGFi\nYXNlCiAgICAgKiBzY2hlbWE6PGJyIC8+CiAgICAgKiA8Y29kZT5qYXZhIG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFUb29sIC1mIHN0\nZG91dCAKICAgICAqIC1hIGNyZWF0ZURCPC9jb2RlPjwvbGk+CiAgICAgKiA8\nbGk+RHJvcCB0aGUgY3VycmVudCBkYXRhYmFzZSBzY2hlbWE6PGJyIC8+CiAg\nICAgKiA8Y29kZT5qYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5TY2hlbWFUb29sIAogICAgICogLWEgZHJvcERCPC9jb2RlPjwvbGk+CiAg\nICAgKiA8bGk+UmVmcmVzaCB0aGUgc2NoZW1hIGFuZCBkZWxldGUgYWxsIHJl\nY29yZHMgaW4gYWxsIHRhYmxlczo8YnIgLz4KICAgICAqIDxjb2RlPmphdmEg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2wgCiAg\nICAgKiAtYSByZWZyZXNoLGRlbGV0ZVRhYmxlQ29udGVudHM8L2NvZGU+PC9s\naT4KICAgICAqIDxsaT5DcmVhdGUgYSBzY2hlbWEgYmFzZWQgb24gYW4gWE1M\nIHNjaGVtYSBkZWZpbml0aW9uIGZpbGU6PGJyIC8+CiAgICAgKiA8Y29kZT5q\nYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFUb29s\nIAogICAgICogbXlzY2hlbWEueG1sPC9jb2RlPjwvbGk+CiAgICAgKiA8L3Vs\nPgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdb\nXSBhcmdzKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBPcHRpb25zIG9wdHMgPSBuZXcgT3B0aW9ucygpOwog\nICAgICAgIGFyZ3MgPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwogICAg\nICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgSkRCQ0NvbmZpZ3Vy\nYXRpb25JbXBsKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFy\ndW4oY29uZiwgYXJncywgb3B0cykpCiAgICAgICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oX2xvYy5nZXQoInRvb2wtdXNhZ2UiKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgY29uZi5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0aGUgdG9vbC4gUmV0dXJu\ncyBmYWxzZSBpZiBhbnkgaW52YWxpZCBvcHRpb25zIHdlcmUgZ2l2ZW4uCiAg\nICAgKgogICAgICogQHNlZSAjbWFpbgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGJvb2xlYW4gcnVuKEpEQkNDb25maWd1cmF0aW9uIGNvbmYsIFN0cmlu\nZ1tdIGFyZ3MsCiAgICAgICAgT3B0aW9ucyBvcHRzKQogICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAob3B0\ncy5jb250YWluc0tleSgiaGVscCIpIHx8IG9wdHMuY29udGFpbnNLZXkoIi1o\nZWxwIikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgRmxh\nZ3MgZmxhZ3MgPSBuZXcgRmxhZ3MoKTsKICAgICAgICBmbGFncy5kcm9wVGFi\nbGVzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAg\nKCJkcm9wVGFibGVzIiwgImR0IiwgZmxhZ3MuZHJvcFRhYmxlcyk7CiAgICAg\nICAgZmxhZ3MuZHJvcFNlcXVlbmNlcyA9IG9wdHMucmVtb3ZlQm9vbGVhblBy\nb3BlcnR5CiAgICAgICAgICAgICgiZHJvcFNlcXVlbmNlcyIsICJkc3EiLCBm\nbGFncy5kcm9wU2VxdWVuY2VzKTsKICAgICAgICBmbGFncy5pZ25vcmVFcnJv\ncnMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAo\nImlnbm9yZUVycm9ycyIsICJpIiwgZmxhZ3MuaWdub3JlRXJyb3JzKTsKICAg\nICAgICBmbGFncy5vcGVuanBhVGFibGVzID0gb3B0cy5yZW1vdmVCb29sZWFu\nUHJvcGVydHkKICAgICAgICAgICAgKCJvcGVuanBhVGFibGVzIiwgIm90Iiwg\nZmxhZ3Mub3BlbmpwYVRhYmxlcyk7CiAgICAgICAgZmxhZ3MucHJpbWFyeUtl\neXMgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAo\nInByaW1hcnlLZXlzIiwgInBrIiwgZmxhZ3MucHJpbWFyeUtleXMpOwogICAg\nICAgIGZsYWdzLmZvcmVpZ25LZXlzID0gb3B0cy5yZW1vdmVCb29sZWFuUHJv\ncGVydHkKICAgICAgICAgICAgKCJmb3JlaWduS2V5cyIsICJma3MiLCBmbGFn\ncy5mb3JlaWduS2V5cyk7CiAgICAgICAgZmxhZ3MuaW5kZXhlcyA9IG9wdHMu\ncmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgiaW5kZXhlcyIs\nICJpeCIsIGZsYWdzLmluZGV4ZXMpOwogICAgICAgIGZsYWdzLnNlcXVlbmNl\ncyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAgICgi\nc2VxdWVuY2VzIiwgInNxIiwgZmxhZ3Muc2VxdWVuY2VzKTsKICAgICAgICBm\nbGFncy5yZWNvcmQgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eSgicmVj\nb3JkIiwgInIiLCBmbGFncy5yZWNvcmQpOwogICAgICAgIFN0cmluZyBmaWxl\nTmFtZSA9IG9wdHMucmVtb3ZlUHJvcGVydHkoImZpbGUiLCAiZiIsIG51bGwp\nOwogICAgICAgIFN0cmluZyBzY2hlbWFzID0gb3B0cy5yZW1vdmVQcm9wZXJ0\neSgicyIpOwogICAgICAgIGlmIChzY2hlbWFzICE9IG51bGwpCiAgICAgICAg\nICAgIG9wdHMuc2V0UHJvcGVydHkoInNjaGVtYXMiLCBzY2hlbWFzKTsKCiAg\nICAgICAgU3RyaW5nW10gYWN0aW9ucyA9IG9wdHMucmVtb3ZlUHJvcGVydHko\nImFjdGlvbiIsICJhIiwgZmxhZ3MuYWN0aW9uKQogICAgICAgICAgICAuc3Bs\naXQoIiwiKTsKICAgICAgICAKICAgICAgICAvLyBzZXR1cCBhIGNvbmZpZ3Vy\nYXRpb24gaW5zdGFuY2Ugd2l0aCBjbWQtbGluZSBpbmZvCiAgICAgICAgQ29u\nZmlndXJhdGlvbnMucG9wdWxhdGVDb25maWd1cmF0aW9uKGNvbmYsIG9wdHMp\nOwoKICAgICAgICAvLyBjcmVhdGUgc2NyaXB0IHdyaXRlcgogICAgICAgIENs\nYXNzTG9hZGVyIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZlckluc3Rh\nbmNlKCkuCiAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKFNjaGVtYVRvb2wu\nY2xhc3MsIG51bGwpOwogICAgICAgIGZsYWdzLndyaXRlciA9IEZpbGVzLmdl\ndFdyaXRlcihmaWxlTmFtZSwgbG9hZGVyKTsKCiAgICAgICAgYm9vbGVhbiBy\nZXR1cm5WYWx1ZSA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBhY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZsYWdzLmFj\ndGlvbiA9IGFjdGlvbnNbaV07CiAgICAgICAgICAgIHJldHVyblZhbHVlICY9\nIHJ1bihjb25mLCBhcmdzLCBmbGFncywgbG9hZGVyKTsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlOwogICAgfQoKICAg\nIC8qKgogICAgICogUnVuIHRoZSB0b29sLiBSZXR1cm4gZmFsc2UgaWYgaW52\nYWxpZCBvcHRpb25zIHdlcmUgZ2l2ZW4uCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgYm9vbGVhbiBydW4oSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiwgU3Ry\naW5nW10gYXJncywKICAgICAgICBGbGFncyBmbGFncywgQ2xhc3NMb2FkZXIg\nbG9hZGVyKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uTE9HX1RPT0wpOwogICAgICAgIGlmIChBQ1RJT05fUkVG\nTEVDVC5lcXVhbHMoZmxhZ3MuYWN0aW9uKSkgewogICAgICAgICAgICBpZiAo\nYXJncy5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICBpZiAoZmxhZ3Mud3JpdGVyID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmbGFncy53cml0ZXIgPSBuZXcgUHJpbnRXcml0ZXIoU3lz\ndGVtLm91dCk7CgogICAgICAgICAgICBTY2hlbWFHZW5lcmF0b3IgZ2VuID0g\nbmV3IFNjaGVtYUdlbmVyYXRvcihjb25mKTsKICAgICAgICAgICAgZ2VuLnNl\ndFByaW1hcnlLZXlzKGZsYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICAgICAg\nZ2VuLnNldEluZGV4ZXMoZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgICAgIGdl\nbi5zZXRGb3JlaWduS2V5cyhmbGFncy5mb3JlaWduS2V5cyk7CiAgICAgICAg\nICAgIGdlbi5zZXRTZXF1ZW5jZXMoZmxhZ3Muc2VxdWVuY2VzKTsKICAgICAg\nICAgICAgZ2VuLnNldE9wZW5KUEFUYWJsZXMoZmxhZ3Mub3BlbmpwYVRhYmxl\ncyk7CgogICAgICAgICAgICBTdHJpbmcgc2NoZW1hcyA9IGNvbmYuZ2V0U2No\nZW1hcygpOwogICAgICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShz\nY2hlbWFzKSkKICAgICAgICAgICAgICAgIHNjaGVtYXMgPSAiYWxsIjsKICAg\nICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQoInNjaC1yZWZsZWN0Iiwgc2No\nZW1hcykpOwogICAgICAgICAgICBnZW4uZ2VuZXJhdGVTY2hlbWFzKCk7Cgog\nICAgICAgICAgICAvLyByZWNvcmQgdGhlIHNjaGVtYQogICAgICAgICAgICBs\nb2cuaW5mbyhfbG9jLmdldCgic2NoLXJlZmxlY3Qtd3JpdGUiKSk7CiAgICAg\nICAgICAgIFNjaGVtYVNlcmlhbGl6ZXIgc2VyID0gbmV3IFhNTFNjaGVtYVNl\ncmlhbGl6ZXIoY29uZik7CiAgICAgICAgICAgIHNlci5hZGRBbGwoZ2VuLmdl\ndFNjaGVtYUdyb3VwKCkpOwogICAgICAgICAgICBzZXIuc2VyaWFsaXplKGZs\nYWdzLndyaXRlciwgc2VyLlBSRVRUWSk7CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDAK\nICAgICAgICAgICAgJiYgIUFDVElPTl9DUkVBVEVEQi5lcXVhbHMoZmxhZ3Mu\nYWN0aW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0RST1BEQi5lcXVhbHMo\nZmxhZ3MuYWN0aW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0VYUE9SVC5l\ncXVhbHMoZmxhZ3MuYWN0aW9uKQogICAgICAgICAgICAmJiAhQUNUSU9OX0RF\nTEVURV9UQUJMRV9DT05URU5UUy5lcXVhbHMoZmxhZ3MuYWN0aW9uKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBwYXJzZSBpbiB0\naGUgYXJndW1lbnRzCiAgICAgICAgU2NoZW1hUGFyc2VyIHBhcnNlciA9IG5l\ndyBYTUxTY2hlbWFQYXJzZXIoY29uZik7CiAgICAgICAgcGFyc2VyLnNldERl\nbGF5Q29uc3RyYWludFJlc29sdmUodHJ1ZSk7CiAgICAgICAgRmlsZSBmaWxl\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBmaWxlID0gRmlsZXMuZ2V0RmlsZShhcmdzW2ld\nLCBsb2FkZXIpOwogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9v\nbC1ydW5uaW5nIiwgZmlsZSkpOwogICAgICAgICAgICBwYXJzZXIucGFyc2Uo\nZmlsZSk7CiAgICAgICAgfQogICAgICAgIHBhcnNlci5yZXNvbHZlQ29uc3Ry\nYWludHMoKTsKCiAgICAgICAgaWYgKEFDVElPTl9JTVBPUlQuZXF1YWxzKGZs\nYWdzLmFjdGlvbikpIHsKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQo\nInRvb2wtaW1wb3J0LXN0b3JlIikpOwogICAgICAgICAgICBTY2hlbWFHcm91\ncCBzY2hlbWEgPSBwYXJzZXIuZ2V0U2NoZW1hR3JvdXAoKTsKICAgICAgICAg\nICAgY29uZi5nZXRTY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5zdG9yZVNjaGVt\nYShzY2hlbWEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgaWYgKEFDVElPTl9FWFBPUlQuZXF1YWxzKGZsYWdzLmFjdGlv\nbikpIHsKICAgICAgICAgICAgaWYgKGZsYWdzLndyaXRlciA9PSBudWxsKQog\nICAgICAgICAgICAgICAgZmxhZ3Mud3JpdGVyID0gbmV3IFByaW50V3JpdGVy\nKFN5c3RlbS5vdXQpOwoKICAgICAgICAgICAgbG9nLmluZm8oX2xvYy5nZXQo\nInRvb2wtZXhwb3J0LWdlbiIpKTsKICAgICAgICAgICAgU2NoZW1hR3JvdXAg\nc2NoZW1hID0gY29uZi5nZXRTY2hlbWFGYWN0b3J5SW5zdGFuY2UoKS5yZWFk\nU2NoZW1hKCk7CgogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9v\nbC1leHBvcnQtd3JpdGUiKSk7CiAgICAgICAgICAgIFNjaGVtYVNlcmlhbGl6\nZXIgc2VyID0gbmV3IFhNTFNjaGVtYVNlcmlhbGl6ZXIoY29uZik7CiAgICAg\nICAgICAgIHNlci5hZGRBbGwoc2NoZW1hKTsKICAgICAgICAgICAgc2VyLnNl\ncmlhbGl6ZShmbGFncy53cml0ZXIsIHNlci5QUkVUVFkpOwogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIFNjaGVtYVRvb2wg\ndG9vbCA9IG5ldyBTY2hlbWFUb29sKGNvbmYsIGZsYWdzLmFjdGlvbik7CiAg\nICAgICAgdG9vbC5zZXRJZ25vcmVFcnJvcnMoZmxhZ3MuaWdub3JlRXJyb3Jz\nKTsKICAgICAgICB0b29sLnNldERyb3BUYWJsZXMoZmxhZ3MuZHJvcFRhYmxl\ncyk7CiAgICAgICAgdG9vbC5zZXRTZXF1ZW5jZXMoZmxhZ3Muc2VxdWVuY2Vz\nKTsgLy8gc2V0IGJlZm9yZSBkcm9wc2VxcwogICAgICAgIHRvb2wuc2V0RHJv\ncFNlcXVlbmNlcyhmbGFncy5kcm9wU2VxdWVuY2VzKTsKICAgICAgICB0b29s\nLnNldFByaW1hcnlLZXlzKGZsYWdzLnByaW1hcnlLZXlzKTsKICAgICAgICB0\nb29sLnNldEZvcmVpZ25LZXlzKGZsYWdzLmZvcmVpZ25LZXlzKTsKICAgICAg\nICB0b29sLnNldEluZGV4ZXMoZmxhZ3MuaW5kZXhlcyk7CiAgICAgICAgdG9v\nbC5zZXRPcGVuSlBBVGFibGVzKGZsYWdzLm9wZW5qcGFUYWJsZXMpOwogICAg\nICAgIGlmIChhcmdzLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHRvb2wuc2V0\nU2NoZW1hR3JvdXAocGFyc2VyLmdldFNjaGVtYUdyb3VwKCkpOwogICAgICAg\nIGlmIChmbGFncy53cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgdG9vbC5z\nZXRXcml0ZXIoZmxhZ3Mud3JpdGVyKTsKCiAgICAgICAgbG9nLmluZm8oX2xv\nYy5nZXQoInRvb2wtYWN0aW9uIiwgZmxhZ3MuYWN0aW9uKSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgdG9vbC5ydW4oKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAoZmxhZ3MucmVjb3JkKSB7CiAgICAgICAg\nICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgidG9vbC1yZWNvcmQiKSk7CiAg\nICAgICAgICAgICAgICB0b29sLnJlY29yZCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGlmIChmbGFncy53cml0ZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgZmxhZ3Mud3JpdGVyLmZsdXNoKCk7CgogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUnVuIGZsYWdzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEZsYWdzIHsKCiAgICAgICAg\ncHVibGljIFN0cmluZyBhY3Rpb24gPSBBQ1RJT05fQUREOwogICAgICAgIHB1\nYmxpYyBXcml0ZXIgd3JpdGVyID0gbnVsbDsKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBkcm9wVGFibGVzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBkcm9wU2VxdWVuY2VzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBpZ25vcmVFcnJvcnMgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBvcGVuanBhVGFibGVzID0gZmFsc2U7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gcHJpbWFyeUtleXMgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29sZWFu\nIGZvcmVpZ25LZXlzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nbmRleGVzID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBzZXF1ZW5j\nZXMgPSB0cnVlOwogICAgICAgIHB1YmxpYyBib29sZWFuIHJlY29yZCA9IHRy\ndWU7CiAgICB9Cn0K\n","encoding":"base64"}

