{"sha":"3a52c100287d6f351f077f32f283b8fd0167bc32","node_id":"MDQ6QmxvYjIwNjM2NDozYTUyYzEwMDI4N2Q2ZjM1MWYwNzdmMzJmMjgzYjhmZDAxNjdiYzMy","size":31102,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3a52c100287d6f351f077f32f283b8fd0167bc32","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5U\neXBlczsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0\naWwuU3RyaW5nVG9rZW5pemVyOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRmlsdGVyVmFs\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhw\ncy5MaXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5QYXJhbTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5leHBzLlZhbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNlcXVlbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5GaWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKCmltcG9ydCBzZXJwLnV0aWwu\nU3RyaW5nczsKCi8qKgogKiBEaWN0aW9uYXJ5IGZvciBJQk0gREIyIGRhdGFi\nYXNlLgogKi8KcHVibGljIGNsYXNzIERCMkRpY3Rpb25hcnkKICAgIGV4dGVu\nZHMgQWJzdHJhY3REQjJEaWN0aW9uYXJ5IHsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoREIyRGljdGlvbmFyeS5jbGFzcyk7CgogICAgcHVibGljIFN0\ncmluZyBvcHRpbWl6ZUNsYXVzZSA9ICJvcHRpbWl6ZSBmb3IiOwogICAgcHVi\nbGljIFN0cmluZyByb3dDbGF1c2UgPSAicm93IjsKICAgIHByb3RlY3RlZCBp\nbnQgZGIyU2VydmVyVHlwZSA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBkYjJJU2VyaWVzVjVSM09yRWFybGllciA9IDE7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBkYjJVREJWODFPckVhcmxpZXIgPSAyOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgZGIyWk9TVjh4T3JMYXRlciA9IDM7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBkYjJVREJWODJPckxhdGVy\nID0gNDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IGRiMklTZXJpZXNW\nNVI0T3JMYXRlciA9IDU7Cglwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nZm9yVXBkYXRlID0gIkZPUiBVUERBVEUiOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIHdpdGhSU0NsYXVzZSA9ICJXSVRIIFJTIjsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyB3aXRoUlJDbGF1c2UgPSAiV0lU\nSCBSUiI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgdXNlS2Vl\ncFVwZGF0ZUxvY2tDbGF1c2UKICAgICAgICA9ICJVU0UgQU5EIEtFRVAgVVBE\nQVRFIExPQ0tTIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyB1\nc2VLZWVwRXhjbHVzaXZlTG9ja0NsYXVzZQogICAgICAgID0gIlVTRSBBTkQg\nS0VFUCBFWENMVVNJVkUgTE9DS1MiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgU3RyaW5nIGZvclJlYWRPbmx5Q2xhdXNlID0gIkZPUiBSRUFEIE9OTFki\nOwogICAgcHJvdGVjdGVkIFN0cmluZyBkYXRhYmFzZVByb2R1Y3ROYW1lID0g\nIiI7CiAgICBwcm90ZWN0ZWQgU3RyaW5nIGRhdGFiYXNlUHJvZHVjdFZlcnNp\nb24gPSAiIjsKICAgIHByb3RlY3RlZCBpbnQgbWFqID0gMDsKICAgIHByb3Rl\nY3RlZCBpbnQgbWluID0gMDsKCiAgICBwdWJsaWMgREIyRGljdGlvbmFyeSgp\nIHsKICAgICAgICBwbGF0Zm9ybSA9ICJEQjIiOwogICAgICAgIHZhbGlkYXRp\nb25TUUwgPSAiU0VMRUNUIERJU1RJTkNUKENVUlJFTlQgVElNRVNUQU1QKSBG\nUk9NICIKICAgICAgICAgICAgKyAiU1lTSUJNLlNZU1RBQkxFUyI7CiAgICAg\nICAgc3VwcG9ydHNTZWxlY3RFbmRJbmRleCA9IHRydWU7CgogICAgICAgIG5l\neHRTZXF1ZW5jZVF1ZXJ5ID0gIlZBTFVFUyBORVhUVkFMIEZPUiB7MH0iOwoK\nICAgICAgICBzZXF1ZW5jZVNRTCA9ICJTRUxFQ1QgU0VRU0NIRU1BIEFTIFNF\nUVVFTkNFX1NDSEVNQSwgIgogICAgICAgICAgICArICJTRVFOQU1FIEFTIFNF\nUVVFTkNFX05BTUUgRlJPTSBTWVNDQVQuU0VRVUVOQ0VTIjsKICAgICAgICBz\nZXF1ZW5jZVNjaGVtYVNRTCA9ICJTRVFTQ0hFTUEgPSA/IjsKICAgICAgICBz\nZXF1ZW5jZU5hbWVTUUwgPSAiU0VRTkFNRSA9ID8iOwogICAgICAgIGNoYXJh\nY3RlckNvbHVtblNpemUgPSAyNTQ7CgogICAgICAgIGJpbmFyeVR5cGVOYW1l\nID0gIkJMT0IoMU0pIjsKICAgICAgICBsb25nVmFyYmluYXJ5VHlwZU5hbWUg\nPSAiQkxPQigxTSkiOwogICAgICAgIHZhcmJpbmFyeVR5cGVOYW1lID0gIkJM\nT0IoMU0pIjsKICAgICAgICBjbG9iVHlwZU5hbWUgPSAiQ0xPQigxTSkiOwog\nICAgICAgIGxvbmdWYXJjaGFyVHlwZU5hbWUgPSAiTE9ORyBWQVJDSEFSIjsK\nICAgICAgICBkYXRlUHJlY2lzaW9uID0gTUlDUk87CiAgICAgICAgc3RvcmVD\naGFyc0FzTnVtYmVycyA9IGZhbHNlOwoKICAgICAgICBmaXhlZFNpemVUeXBl\nTmFtZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAg\nICAgICAgICAgICJMT05HIFZBUkNIQVIgRk9SIEJJVCBEQVRBIiwgIkxPTkcg\nVkFSQ0hBUiIsICJMT05HIFZBUkdSQVBISUMiLAogICAgICAgIH0pKTsKICAg\nICAgICBzeXN0ZW1TY2hlbWFzID0gbmV3IFN0cmluZygKICAgICAgICAgICAg\nICAgICJTWVNDQVQsU1lTSUJNLFNZU1NUQVQsU1lTSUJNQURNLFNZU1RPT0xT\nIik7CiAgICAgICAgbWF4Q29uc3RyYWludE5hbWVMZW5ndGggPSAxODsKICAg\nICAgICBtYXhJbmRleE5hbWVMZW5ndGggPSAxODsKICAgICAgICBtYXhDb2x1\nbW5OYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgc3VwcG9ydHNEZWZlcnJlZENv\nbnN0cmFpbnRzID0gZmFsc2U7CiAgICAgICAgc3VwcG9ydHNEZWZhdWx0RGVs\nZXRlQWN0aW9uID0gZmFsc2U7CiAgICAgICAgc3VwcG9ydHNBbHRlclRhYmxl\nV2l0aERyb3BDb2x1bW4gPSBmYWxzZTsKCiAgICAgICAgc3VwcG9ydHNOdWxs\nVGFibGVGb3JHZXRDb2x1bW5zID0gZmFsc2U7CiAgICAgICAgcmVxdWlyZXND\nYXN0Rm9yTWF0aEZ1bmN0aW9ucyA9IHRydWU7CiAgICAgICAgcmVxdWlyZXND\nYXN0Rm9yQ29tcGFyaXNvbnMgPSB0cnVlOwoKICAgICAgICByZXNlcnZlZFdv\ncmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAg\nICAgICAgICAiQUZURVIiLCAiQUxJQVMiLCAiQUxMT1ciLCAiQVBQTElDQVRJ\nT04iLCAiQVNTT0NJQVRFIiwgIkFTVVRJTUUiLAogICAgICAgICAgICAiQVVE\nSVQiLCAiQVVYIiwgIkFVWElMSUFSWSIsICJCRUZPUkUiLCAiQklOQVJZIiwg\nIkJVRkZFUlBPT0wiLAogICAgICAgICAgICAiQ0FDSEUiLCAiQ0FMTCIsICJD\nQUxMRUQiLCAiQ0FQVFVSRSIsICJDQVJESU5BTElUWSIsICJDQ1NJRCIsCiAg\nICAgICAgICAgICJDTFVTVEVSIiwgIkNPTExFQ1RJT04iLCAiQ09MTElEIiwg\nIkNPTU1FTlQiLCAiQ09OQ0FUIiwKICAgICAgICAgICAgIkNPTkRJVElPTiIs\nICJDT05UQUlOUyIsICJDT1VOVF9CSUciLCAiQ1VSUkVOVF9MQ19DVFlQRSIs\nCiAgICAgICAgICAgICJDVVJSRU5UX1BBVEgiLCAiQ1VSUkVOVF9TRVJWRVIi\nLCAiQ1VSUkVOVF9USU1FWk9ORSIsICJDWUNMRSIsCiAgICAgICAgICAgICJE\nQVRBIiwgIkRBVEFCQVNFIiwgIkRBWVMiLCAiREIyR0VORVJBTCIsICJEQjJH\nRU5STCIsICJEQjJTUUwiLAogICAgICAgICAgICAiREJJTkZPIiwgIkRFRkFV\nTFRTIiwgIkRFRklOSVRJT04iLCAiREVURVJNSU5JU1RJQyIsICJESVNBTExP\nVyIsCiAgICAgICAgICAgICJETyIsICJEU05IQVRUUiIsICJEU1NJWkUiLCAi\nRFlOQU1JQyIsICJFQUNIIiwgIkVESVRQUk9DIiwgIkVMU0VJRiIsCiAgICAg\nICAgICAgICJFTkNPRElORyIsICJFTkQtRVhFQzEiLCAiRVJBU0UiLCAiRVhD\nTFVESU5HIiwgIkVYSVQiLCAiRkVOQ0VEIiwKICAgICAgICAgICAgIkZJRUxE\nUFJPQyIsICJGSUxFIiwgIkZJTkFMIiwgIkZSRUUiLCAiRlVOQ1RJT04iLCAi\nR0VORVJBTCIsCiAgICAgICAgICAgICJHRU5FUkFURUQiLCAiR1JBUEhJQyIs\nICJIQU5ETEVSIiwgIkhPTEQiLCAiSE9VUlMiLCAiSUYiLAogICAgICAgICAg\nICAiSU5DTFVESU5HIiwgIklOQ1JFTUVOVCIsICJJTkRFWCIsICJJTkhFUklU\nIiwgIklOT1VUIiwgIklOVEVHUklUWSIsCiAgICAgICAgICAgICJJU09CSUQi\nLCAiSVRFUkFURSIsICJKQVIiLCAiSkFWQSIsICJMQUJFTCIsICJMQ19DVFlQ\nRSIsICJMRUFWRSIsCiAgICAgICAgICAgICJMSU5LVFlQRSIsICJMT0NBTEUi\nLCAiTE9DQVRPUiIsICJMT0NBVE9SUyIsICJMT0NLIiwgIkxPQ0tNQVgiLAog\nICAgICAgICAgICAiTE9DS1NJWkUiLCAiTE9ORyIsICJMT09QIiwgIk1BWFZB\nTFVFIiwgIk1JQ1JPU0VDT05EIiwKICAgICAgICAgICAgIk1JQ1JPU0VDT05E\nUyIsICJNSU5VVEVTIiwgIk1JTlZBTFVFIiwgIk1PREUiLCAiTU9ESUZJRVMi\nLCAiTU9OVEhTIiwKICAgICAgICAgICAgIk5FVyIsICJORVdfVEFCTEUiLCAi\nTk9DQUNIRSIsICJOT0NZQ0xFIiwgIk5PREVOQU1FIiwgIk5PREVOVU1CRVIi\nLAogICAgICAgICAgICAiTk9NQVhWQUxVRSIsICJOT01JTlZBTFVFIiwgIk5P\nT1JERVIiLCAiTlVMTFMiLCAiTlVNUEFSVFMiLCAiT0JJRCIsCiAgICAgICAg\nICAgICJPTEQiLCAiT0xEX1RBQkxFIiwgIk9QVElNSVpBVElPTiIsICJPUFRJ\nTUlaRSIsICJPVVQiLCAiT1ZFUlJJRElORyIsCiAgICAgICAgICAgICJQQUNL\nQUdFIiwgIlBBUkFNRVRFUiIsICJQQVJUIiwgIlBBUlRJVElPTiIsICJQQVRI\nIiwgIlBJRUNFU0laRSIsCiAgICAgICAgICAgICJQTEFOIiwgIlBSSVFUWSIs\nICJQUk9HUkFNIiwgIlBTSUQiLCAiUVVFUllOTyIsICJSRUFEUyIsICJSRUNP\nVkVSWSIsCiAgICAgICAgICAgICJSRUZFUkVOQ0lORyIsICJSRUxFQVNFIiwg\nIlJFTkFNRSIsICJSRVBFQVQiLCAiUkVTRVQiLCAiUkVTSUdOQUwiLAogICAg\nICAgICAgICAiUkVTVEFSVCIsICJSRVNVTFQiLCAiUkVTVUxUX1NFVF9MT0NB\nVE9SIiwgIlJFVFVSTiIsICJSRVRVUk5TIiwKICAgICAgICAgICAgIlJPVVRJ\nTkUiLCAiUk9XIiwgIlJSTiIsICJSVU4iLCAiU0FWRVBPSU5UIiwgIlNDUkFU\nQ0hQQUQiLAogICAgICAgICAgICAiU0VDT05EUyIsICJTRUNRVFkiLCAiU0VD\nVVJJVFkiLCAiU0VOU0lUSVZFIiwgIlNJR05BTCIsICJTSU1QTEUiLAogICAg\nICAgICAgICAiU09VUkNFIiwgIlNQRUNJRklDIiwgIlNRTElEIiwgIlNUQU5E\nQVJEIiwgIlNUQVJUIiwgIlNUQVRJQyIsCiAgICAgICAgICAgICJTVEFZIiwg\nIlNUT0dST1VQIiwgIlNUT1JFUyIsICJTVFlMRSIsICJTVUJQQUdFUyIsICJT\nWU5PTllNIiwKICAgICAgICAgICAgIlNZU0ZVTiIsICJTWVNJQk0iLCAiU1lT\nUFJPQyIsICJTWVNURU0iLCAiVEFCTEVTUEFDRSIsICJUUklHR0VSIiwKICAg\nICAgICAgICAgIlRZUEUiLCAiVU5ETyIsICJVTlRJTCIsICJWQUxJRFBST0Mi\nLCAiVkFSSUFCTEUiLCAiVkFSSUFOVCIsICJWQ0FUIiwKICAgICAgICAgICAg\nIlZPTFVNRVMiLCAiV0hJTEUiLCAiV0xNIiwgIllFQVJTIiwKICAgICAgICB9\nKSk7CiAgICAgICAgCiAgICAgICAgc2VsZWN0V29yZFNldC5hZGQoIldJVEgi\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFj\nY2Vzc1Jlc3VsdFNldChTZWxlY3Qgc2VsLAogICAgICAgIGJvb2xlYW4gZm9y\nVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuICFmb3JVcGRhdGUKICAgICAgICAg\nICAgJiYgc3VwZXIuc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQoc2Vs\nLCBmb3JVcGRhdGUpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVu\nZFNlbGVjdFJhbmdlKFNRTEJ1ZmZlciBidWYsIGxvbmcgc3RhcnQsIGxvbmcg\nZW5kLAogICAgICAgIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAgICAgICAgLy8g\nYXBwZW5kcyB0aGUgbGl0ZXJhbCByYW5nZSBzdHJpbmcsIHNpbmNlIERCMiBp\ncyB1bmFibGUgdG8gaGFuZGxlCiAgICAgICAgLy8gYSBib3VuZCBwYXJhbWV0\nZXIgZm9yIGl0CiAgICAgICAgLy8gZG8gbm90IGdlbmVyYXRlIEZFVENIIEZJ\nUlNUIGNsYXVzZSBmb3Igc3Vic2VsZWN0CiAgICAgICAgaWYgKCFzdWJzZWxl\nY3QpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBGRVRDSCBGSVJTVCAiKS5h\ncHBlbmQoTG9uZy50b1N0cmluZyhlbmQpKS4KICAgICAgICAgICAgICAgIGFw\ncGVuZCgiIFJPV1MgT05MWSIpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXRDcmVhdGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAg\nICBTdHJpbmdbXSBzcWwgPSBzdXBlci5nZXRDcmVhdGVTZXF1ZW5jZVNRTChz\nZXEpOwogICAgICAgIGlmIChzZXEuZ2V0QWxsb2NhdGUoKSA+IDEpCiAgICAg\nICAgICAgIHNxbFswXSArPSAiIENBQ0hFICIgKyBzZXEuZ2V0QWxsb2NhdGUo\nKTsKICAgICAgICByZXR1cm4gc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCBT\ndHJpbmcgZ2V0U2VxdWVuY2VzU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJp\nbmcgc2VxdWVuY2VOYW1lKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9\nIG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5kKHNlcXVl\nbmNlU1FMKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsIHx8IHNl\ncXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nV0hFUkUgIik7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkgewog\nICAgICAgICAgICBidWYuYXBwZW5kKHNlcXVlbmNlU2NoZW1hU1FMKTsKICAg\nICAgICAgICAgaWYgKHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICB9CiAgICAgICAg\naWYgKHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBw\nZW5kKHNlcXVlbmNlTmFtZVNRTCk7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0\ncmluZygpOwogICAgfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGRlY29yYXRl\nKENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAvLyBzb21lIHZlcnNpb25zIG9mIHRoZSBEQjIgZHJpdmVy\nIHNlZW0gdG8gZGVmYXVsdCB0bwogICAgICAgIC8vIFJFQURfVU5DT01NSVRU\nRUQsIHdoaWNoIHdpbGwgcHJldmVudCBsb2NraW5nIGZyb20gd29ya2luZwog\nICAgICAgIC8vIChtdWx0aXBsZSBTRUxFQ1QgLi4uIEZPUiBVUERBVEUgc3Rh\ndGVtZW50cyBhcmUgYWxsb3dlZCBvbgogICAgICAgIC8vIHRoZSBzYW1lIGlu\nc3RhbmNlKTsgaWYgd2UgaGF2ZSBub3Qgb3ZlcnJpZGRlbiB0aGUKICAgICAg\nICAvLyB0cmFuc2FjdGlvbiBpc29sYXRpb24gaW4gdGhlIGNvbmZpZ3VyYXRp\nb24sIGRlZmF1bHQgdG8KICAgICAgICAvLyBUUkFOU0FDVElPTl9SRUFEX0NP\nTU1JVFRFRAogICAgICAgIGNvbm4gPSBzdXBlci5kZWNvcmF0ZShjb25uKTsK\nCiAgICAgICAgaWYgKGNvbmYuZ2V0VHJhbnNhY3Rpb25Jc29sYXRpb25Db25z\ndGFudCgpID09IC0xCiAgICAgICAgICAgICYmIGNvbm4uZ2V0VHJhbnNhY3Rp\nb25Jc29sYXRpb24oKSA8IGNvbm4uVFJBTlNBQ1RJT05fUkVBRF9DT01NSVRU\nRUQpCiAgICAgICAgICAgIGNvbm4uc2V0VHJhbnNhY3Rpb25Jc29sYXRpb24o\nY29ubi5UUkFOU0FDVElPTl9SRUFEX0NPTU1JVFRFRCk7CgogICAgICAgIHJl\ndHVybiBjb25uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbm5lY3RlZENv\nbmZpZ3VyYXRpb24oQ29ubmVjdGlvbiBjb25uKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgIAlzdXBlci5jb25uZWN0ZWRDb25maWd1cmF0aW9uKGNvbm4p\nOwoKICAgIAlEYXRhYmFzZU1ldGFEYXRhIG1ldGFEYXRhID0gY29ubi5nZXRN\nZXRhRGF0YSgpOwogICAgICAgIGRhdGFiYXNlUHJvZHVjdE5hbWUgPSBudWxs\nU2FmZShtZXRhRGF0YS5nZXREYXRhYmFzZVByb2R1Y3ROYW1lKCkpOwogICAg\nICAgIGRhdGFiYXNlUHJvZHVjdFZlcnNpb24gPSBudWxsU2FmZShtZXRhRGF0\nYS5nZXREYXRhYmFzZVByb2R1Y3RWZXJzaW9uKCkpOwogICAgICAgIAogICAg\nICAgIC8vIERldGVybWluZSB0aGUgdHlwZSBvZiBEQjIgZGF0YWJhc2UKICAg\nICAgICAvLyBGaXJzdCBjaGVjayBmb3IgQVMvNDAwCiAgICAgICAgZ2V0UHJv\nZHVjdFZlcnNpb25NYWpvck1pbm9yRm9ySVNlcmllcygpOwoKICAgICAgICBp\nZiAobWFqID4gMCkgewogICAgICAgICAgICBpZiAoaXNEQjJJU2VyaWVzVjVS\nM09yRWFybGllcigpKQogICAgICAgICAgICAgICAgZGIyU2VydmVyVHlwZSA9\nIGRiMklTZXJpZXNWNVIzT3JFYXJsaWVyOwogICAgICAgICAgICBlbHNlIGlm\nIChpc0RCMklTZXJpZXNWNVI0T3JMYXRlcigpKQogICAgICAgICAgICAgICAg\nZGIyU2VydmVyVHlwZSA9IGRiMklTZXJpZXNWNVI0T3JMYXRlcjsKICAgICAg\nICB9CiAgICAgICAgCiAgICAJaWYgKGRiMlNlcnZlclR5cGUgPT0gMCkgewog\nICAgCSAgICBpZiAoaXNKREJDMykgewogICAgCSAgICAgICAgbWFqID0gbWV0\nYURhdGEuZ2V0RGF0YWJhc2VNYWpvclZlcnNpb24oKTsKICAgIAkgICAgICAg\nIG1pbiA9IG1ldGFEYXRhLmdldERhdGFiYXNlTWlub3JWZXJzaW9uKCk7CiAg\nICAJICAgIH0KICAgIAkgICAgZWxzZQogICAgCSAgICAgICAgZ2V0UHJvZHVj\ndFZlcnNpb25NYWpvck1pbm9yKCk7CgogICAgCSAgICAvLyBEZXRlcm1pbmUg\ndGhlIHR5cGUgb2YgREIyIGRhdGFiYXNlIGZvciBaT1MgJiBVREIKICAgIAkg\nICAgaWYgKGlzREIyVURCVjgxT3JFYXJsaWVyKCkpCiAgICAJICAgICAgICBk\nYjJTZXJ2ZXJUeXBlID0gZGIyVURCVjgxT3JFYXJsaWVyOwogICAgCSAgICBl\nbHNlIGlmIChpc0RCMlpPU1Y4eE9yTGF0ZXIoKSkKICAgIAkgICAgICAgIGRi\nMlNlcnZlclR5cGUgPSBkYjJaT1NWOHhPckxhdGVyOwogICAgCSAgICBlbHNl\nIGlmIChpc0RCMlVEQlY4Mk9yTGF0ZXIoKSkKICAgIAkgICAgICAgIGRiMlNl\ncnZlclR5cGUgPSBkYjJVREJWODJPckxhdGVyOwogICAgICAgIH0KCiAgICAg\nICAgLy8gdmVyaWZ5IHRoYXQgZGF0YWJhZSBwcm9kdWN0IGlzIHN1cHBvcnRl\nZAogICAgICAgIGlmIChkYjJTZXJ2ZXJUeXBlID09IDAgfHwgbWFqID09IDAp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldCgiZGItbm90LXN1cHBvcnRlZCIsCiAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W10ge2RhdGFiYXNlUHJvZHVjdE5hbWUsIGRhdGFiYXNlUHJv\nZHVjdFZlcnNpb24gfSkpOyAgICAgICAgICAgICAgICAgICAgCgogICAgCWlm\nIChtYWogPj0gOSB8fCAobWFqID09IDggJiYgbWluID49IDIpKSB7CiAgICAJ\nICAgIHN1cHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcyA9IHRydWU7\nCiAgICAJICAgIHN1cHBvcnRzTG9ja2luZ1dpdGhJbm5lckpvaW4gPSB0cnVl\nOwogICAgCSAgICBzdXBwb3J0c0xvY2tpbmdXaXRoT3V0ZXJKb2luID0gdHJ1\nZTsKICAgIAkgICAgZm9yVXBkYXRlQ2xhdXNlID0gIldJVEggUlIgVVNFIEFO\nRCBLRUVQIFVQREFURSBMT0NLUyI7CiAgICAJICAgIGlmIChtYWogPj05KQog\nICAgCSAgICAgICAgc3VwcG9ydHNYTUxDb2x1bW4gPSB0cnVlOwogICAgCX0K\nCiAgICAgICAgLy8gcGxhdGZvcm0gc3BlY2lmaWMgc2V0dGluZ3MKICAgICAg\nICBzd2l0Y2ggKGRiMlNlcnZlclR5cGUpIHsKICAgICAgICBjYXNlICBkYjJa\nT1NWOHhPckxhdGVyOgogICAgICAgICAgICAvLyBEQjIgWi9PUyAKICAgICAg\nICAgICAgY2hhcmFjdGVyQ29sdW1uU2l6ZSA9IDI1NTsKICAgICAgICAgICAg\nbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gIlNFTEVDVCBJREVOVElUWV9WQUxf\nTE9DQUwoKSBGUk9NICIKICAgICAgICAgICAgICAgICsgIlNZU0lCTS5TWVNE\nVU1NWTEiOwogICAgICAgICAgICBuZXh0U2VxdWVuY2VRdWVyeSA9ICJTRUxF\nQ1QgTkVYVFZBTCBGT1IgezB9IEZST00gIgogICAgICAgICAgICAgICAgKyAi\nU1lTSUJNLlNZU0RVTU1ZMSI7CiAgICAgICAgICAgIHNlcXVlbmNlU1FMID0g\nIlNFTEVDVCBTQ0hFTUEgQVMgU0VRVUVOQ0VfU0NIRU1BLCAiCiAgICAgICAg\nICAgICAgICArICJOQU1FIEFTIFNFUVVFTkNFX05BTUUgRlJPTSBTWVNJQk0u\nU1lTU0VRVUVOQ0VTIjsKICAgICAgICAgICAgc2VxdWVuY2VTY2hlbWFTUUwg\nPSAiU0NIRU1BID0gPyI7CiAgICAgICAgICAgIHNlcXVlbmNlTmFtZVNRTCA9\nICJOQU1FID0gPyI7CiAgICAgICAgICAgIGlmIChtYWogPT0gOCkgewogICAg\nICAgICAgICAgICAgLy8gREIyIFovT1MgVmVyc2lvbiA4OiBubyBiaWdpbnQg\nc3VwcG9ydCwgaGVuY2UgbWFwIEphdmEKICAgICAgICAgICAgICAgIC8vIGxv\nbmcgdG8gZGVjaW1hbAogICAgICAgICAgICAgICAgYmlnaW50VHlwZU5hbWUg\nPSAiREVDSU1BTCgzMSwwKSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWdub3JlU1FMRXhjZXB0aW9uT25TZXRRdWVyeVRpbWVvdXQgPSB0cnVlOyAK\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBkYjJJU2VyaWVzVjVS\nM09yRWFybGllcjoKICAgICAgICBjYXNlIGRiMklTZXJpZXNWNVI0T3JMYXRl\ncjoKICAgICAgICAgICAgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gIlNFTEVD\nVCBJREVOVElUWV9WQUxfTE9DQUwoKSBGUk9NICIKICAgICAgICAgICAgICAg\nICsgIlNZU0lCTS5TWVNEVU1NWTEiOwogICAgICAgICAgICBuZXh0U2VxdWVu\nY2VRdWVyeSA9ICJTRUxFQ1QgTkVYVFZBTCBGT1IgezB9IEZST00gIgogICAg\nICAgICAgICAgICAgKyAiU1lTSUJNLlNZU0RVTU1ZMSI7CiAgICAgICAgICAg\nIHZhbGlkYXRpb25TUUwgPSAiU0VMRUNUIERJU1RJTkNUKENVUlJFTlQgVElN\nRVNUQU1QKSBGUk9NICIKICAgICAgICAgICAgICAgICsgIlFTWVMyLlNZU1RB\nQkxFUyI7CiAgICAgICAgICAgIHNlcXVlbmNlU1FMID0gIlNFTEVDVCBTRVFV\nRU5DRV9TQ0hFTUEsICIKICAgICAgICAgICAgICAgICsgIlNFUVVFTkNFX05B\nTUUgRlJPTSBRU1lTMi5TWVNTRVFVRU5DRVMiOwogICAgICAgICAgICBzZXF1\nZW5jZVNjaGVtYVNRTCA9ICJTRVFVRU5DRV9TQ0hFTUEgPSA/IjsKICAgICAg\nICAgICAgc2VxdWVuY2VOYW1lU1FMID0gIlNFUVVFTkNFX05BTUUgPSA/IjsK\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogR2V0IHRoZSB1cGRhdGUgY2xhdXNlIGZvciB0aGUgcXVlcnkgYmFz\nZWQgb24gdGhlCiAgICAgKiB1cGRhdGVDbGF1c2UgYW5kIGlzb2xhdGlvbkxl\ndmVsIGhpbnRzCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Rm9y\nVXBkYXRlQ2xhdXNlKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAg\nICAgICAgYm9vbGVhbiBpc0ZvclVwZGF0ZSwgU2VsZWN0IHNlbCkgewogICAg\nICAgIGludCBpc29sYXRpb25MZXZlbDsKICAgICAgICAvLyBGb3IgZGIyVURC\nVjgxT3JFYXJsaWVyIGFuZCBkYjJJU2VyaWVzVjVSM09yRWFybGllcjoKICAg\nICAgICAvLyAib3B0aW1pemUgZm9yIiBjbGF1c2UgYXBwZWFycyBiZWZvcmUg\nImZvciB1cGRhdGUiIGNsYXVzZS4KICAgICAgICBTdHJpbmdCdWZmZXIgZm9y\nVXBkYXRlU3RyaW5nID0gbmV3IFN0cmluZ0J1ZmZlcigKICAgICAgICAgICAg\nZ2V0T3B0aW1pemVDbGF1c2Uoc2VsKSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBpc29sYXRpb25MZXZlbDsgdGhlIGZl\ndGNoCiAgICAgICAgICAgIC8vIGNvbmZpZ3VyYXRpb24gZGF0YSBvdmVycmlk\nZXMgdGhlIHBlcnNpc3RlbmNlLnhtbCB2YWx1ZQogICAgICAgICAgICBpZiAo\nZmV0Y2ggIT0gbnVsbCAmJiBmZXRjaC5nZXRJc29sYXRpb24oKSAhPSAtMSkK\nICAgICAgICAgICAgICAgIGlzb2xhdGlvbkxldmVsID0gZmV0Y2guZ2V0SXNv\nbGF0aW9uKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlz\nb2xhdGlvbkxldmVsID0gY29uZi5nZXRUcmFuc2FjdGlvbklzb2xhdGlvbkNv\nbnN0YW50KCk7CgogICAgICAgICAgICBpZiAoaXNGb3JVcGRhdGUpIHsKICAg\nICAgICAgICAgICAgIHN3aXRjaChkYjJTZXJ2ZXJUeXBlKSB7CiAgICAgICAg\nICAgICAgICBjYXNlIGRiMklTZXJpZXNWNVIzT3JFYXJsaWVyOgogICAgICAg\nICAgICAgICAgY2FzZSBkYjJVREJWODFPckVhcmxpZXI6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzb2xhdGlvbkxldmVsID09IENvbm5lY3Rpb24uVFJB\nTlNBQ1RJT05fU0VSSUFMSVpBQkxFKQogICAgICAgICAgICAgICAgICAgICAg\nICBmb3JVcGRhdGVTdHJpbmcuYXBwZW5kKCIgIikuYXBwZW5kKGZvclVwZGF0\nZUNsYXVzZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAg\nICAgICAgICAgICAgICAgZm9yVXBkYXRlU3RyaW5nLmFwcGVuZCgiICIpLmFw\ncGVuZChmb3JVcGRhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nYXBwZW5kKCIgIikuYXBwZW5kKHdpdGhSU0NsYXVzZSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGRiMlpPU1Y4\neE9yTGF0ZXI6CiAgICAgICAgICAgICAgICBjYXNlIGRiMlVEQlY4Mk9yTGF0\nZXI6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzb2xhdGlvbkxldmVsID09\nIENvbm5lY3Rpb24uVFJBTlNBQ1RJT05fU0VSSUFMSVpBQkxFKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZvclVwZGF0ZVN0cmluZy5hcHBlbmQoIiAi\nKS5hcHBlbmQoZm9yUmVhZE9ubHlDbGF1c2UpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuYXBwZW5kKCIgIikuYXBwZW5kKHdpdGhSUkNsYXVzZSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoIiAiKS5hcHBl\nbmQodXNlS2VlcFVwZGF0ZUxvY2tDbGF1c2UpOyAgIAogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvclVw\nZGF0ZVN0cmluZy5hcHBlbmQoIiAiKS5hcHBlbmQoZm9yUmVhZE9ubHlDbGF1\nc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCIgIiku\nYXBwZW5kKHdpdGhSU0NsYXVzZSkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC5hcHBlbmQoIiAiKS5hcHBlbmQodXNlS2VlcFVwZGF0ZUxvY2tDbGF1\nc2UpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIGRiMklTZXJpZXNWNVI0T3JMYXRlcjoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNvbGF0aW9uTGV2ZWwgPT0gQ29ubmVjdGlvbi5U\nUkFOU0FDVElPTl9TRVJJQUxJWkFCTEUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgZm9yVXBkYXRlU3RyaW5nLmFwcGVuZCgiICIpLmFwcGVuZChmb3JS\nZWFkT25seUNsYXVzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5h\ncHBlbmQoIiAiKS5hcHBlbmQod2l0aFJSQ2xhdXNlKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLmFwcGVuZCgiICIpLmFwcGVuZCh1c2VLZWVwRXhj\nbHVzaXZlTG9ja0NsYXVzZSk7ICAgICAgIAogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvclVwZGF0ZVN0\ncmluZy5hcHBlbmQoIiAiKS5hcHBlbmQoZm9yUmVhZE9ubHlDbGF1c2UpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCIgIikuYXBwZW5k\nKHdpdGhSU0NsYXVzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5h\ncHBlbmQoIiAiKS5hcHBlbmQodXNlS2VlcEV4Y2x1c2l2ZUxvY2tDbGF1c2Up\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9n\nLmVycm9yKGUudG9TdHJpbmcoKSxlKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGZvclVwZGF0ZVN0cmluZy50b1N0cmluZygpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzREIyVURCVjgyT3JMYXRlcigpIHsKICAgICAgICBy\nZXR1cm4gKGRhdGFiYXNlUHJvZHVjdFZlcnNpb24uaW5kZXhPZigiU1FMIikg\nIT0gLTEKICAgICAgICAgICAgIHx8IGRhdGFiYXNlUHJvZHVjdE5hbWUuaW5k\nZXhPZigiREIyLyIpICE9IC0xKQogICAgICAgICAgICAgJiYgKChtYWogPT0g\nOCAmJiBtaW4gPj0gMikgfHwgKG1haiA+PSA5KSk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNEQjJaT1NWOHhPckxhdGVyKCkgewogICAgICAgcmV0\ndXJuIChkYXRhYmFzZVByb2R1Y3RWZXJzaW9uLmluZGV4T2YoIkRTTiIpICE9\nIC0xCiAgICAgICAgICAgIHx8IGRhdGFiYXNlUHJvZHVjdE5hbWUuaW5kZXhP\nZigiREIyLyIpID09IC0xKQogICAgICAgICAgICAmJiBtYWogPj0gODsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RCMklTZXJpZXNWNVIzT3JFYXJs\naWVyKCkgewogICAgICAgcmV0dXJuIChkYXRhYmFzZVByb2R1Y3ROYW1lLmlu\nZGV4T2YoIkFTIikgIT0gLTEKICAgICAgICAgICAmJiAoKG1haiA9PSA1ICYm\nIG1pbiA8PTMpIHx8IG1haiA8IDUpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0RCMklTZXJpZXNWNVI0T3JMYXRlcigpIHsKICAgICAgIHJldHVy\nbiBkYXRhYmFzZVByb2R1Y3ROYW1lLmluZGV4T2YoIkFTIikgIT0gLTEKICAg\nICAgICAgICAmJiAobWFqID49NiB8fCAobWFqID09IDUgJiYgbWluID49NCkp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzREIyVURCVjgxT3JFYXJs\naWVyKCkgewogICAgICAgIHJldHVybiAoZGF0YWJhc2VQcm9kdWN0VmVyc2lv\nbi5pbmRleE9mKCJTUUwiKSAhPSAtMSAKICAgICAgICAgICAgfHwgZGF0YWJh\nc2VQcm9kdWN0TmFtZS5pbmRleE9mKCJEQjIvIikgIT0gLTEpIAogICAgICAg\nICAgICAmJiAoKG1haiA9PSA4ICYmIG1pbiA8PSAxKSB8fCBtYWogPCA4KTsK\nICAgIH0KCiAgICAvKiogR2V0IHRoZSB2ZXJzaW9uIE1ham9yL01pbm9yIGZv\nciB0aGUgSVNlcmllcwogICAgICovCiAgICBwcml2YXRlIHZvaWQgZ2V0UHJv\nZHVjdFZlcnNpb25NYWpvck1pbm9yRm9ySVNlcmllcygpIHsKICAgICAgICAv\nLyBJU2VyaWVzICAgIERCUHJvZE5hbWUgICAgICAgICAgICAgICAgIERCMiBV\nREIgZm9yIEFTLzQwMAogICAgICAgIC8vICAgKFRvb2xib3gpREJQcm9kVmVy\nc2lvbiAgICAgICAgICAgICAgMDUuMDQuMDAwMCBWNVI0bTAKICAgICAgICAv\nLyBJU2VyaWVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCMiBV\nREIgZm9yIEFTLzQwMAogICAgICAgIC8vICAgKE5hdGl2ZSkgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgVjVSNE0wCiAgICAgICAgaWYgKGRhdGFiYXNl\nUHJvZHVjdE5hbWUuaW5kZXhPZigiQVMiKSAhPSAtMSkgewogICAgICAgICAg\nICAvLyBkZWZhdWx0IHRvIFY1UjQKICAgICAgICAgICAgbWFqID0gNTsKICAg\nICAgICAgICAgbWluID0gNDsKICAgICAgICAgICAgaW50IGluZGV4ID0gZGF0\nYWJhc2VQcm9kdWN0VmVyc2lvbi5pbmRleE9mKCdWJyk7CiAgICAgICAgICAg\nIGlmIChpbmRleCAhPSAtMSkgewogICAgICAgICAgICAJU3RyaW5nIHMgPSBk\nYXRhYmFzZVByb2R1Y3RWZXJzaW9uLnN1YnN0cmluZyhpbmRleCk7CiAgICAg\nICAgICAgIAlzID0gcy50b1VwcGVyQ2FzZSgpOwoKICAgICAgICAgICAgCVN0\ncmluZ1Rva2VuaXplciBzdHJpbmd0b2tlbml6ZXIgPSBuZXcgU3RyaW5nVG9r\nZW5pemVyKHMsICJWUk0iCiAgICAgICAgICAgIAkJCSwgZmFsc2UpOwogICAg\nICAgICAgICAJaWYgKHN0cmluZ3Rva2VuaXplci5jb3VudFRva2VucygpID09\nIDMpIHsKICAgICAgICAgICAgCQlTdHJpbmcgczEgPSBzdHJpbmd0b2tlbml6\nZXIubmV4dFRva2VuKCk7CiAgICAgICAgICAgIAkJbWFqID0gSW50ZWdlci5w\nYXJzZUludChzMSk7CiAgICAgICAgICAgIAkJU3RyaW5nIHMyID0gIHN0cmlu\nZ3Rva2VuaXplci5uZXh0VG9rZW4oKTsKICAgICAgICAgICAgCQltaW4gPSBJ\nbnRlZ2VyLnBhcnNlSW50KHMyKTsKICAgICAgICAgICAgCX0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgCWluZGV4ID0g\nZGF0YWJhc2VQcm9kdWN0VmVyc2lvbi5pbmRleE9mKCcwJyk7CiAgICAgICAg\nICAgIAlpZiAoaW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgCQlTdHJpbmcg\ncyA9IGRhdGFiYXNlUHJvZHVjdFZlcnNpb24uc3Vic3RyaW5nKGluZGV4KTsK\nICAgICAgICAgICAgCQlzID0gcy50b1VwcGVyQ2FzZSgpOwogICAgICAgICAg\nIAkJCVN0cmluZ1Rva2VuaXplciBzdHJpbmd0b2tlbml6ZXIgPSBuZXcgU3Ry\naW5nVG9rZW5pemVyKHMsICIwIgogICAgICAgICAgIAkJCQkJLCBmYWxzZSk7\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAJCQlpZiAoc3RyaW5n\ndG9rZW5pemVyLmNvdW50VG9rZW5zKCkgPT0gMikgewogICAgICAgICAgIAkJ\nCQlTdHJpbmcgczEgPSBzdHJpbmd0b2tlbml6ZXIubmV4dFRva2VuKCk7CiAg\nICAgICAgICAgCQkJCW1haiA9IEludGVnZXIucGFyc2VJbnQoczEpOwogICAg\nICAgICAgIAkJCQlTdHJpbmcgczIgPSAgc3RyaW5ndG9rZW5pemVyLm5leHRU\nb2tlbigpOwogICAgICAgICAgIAkJCQltaW4gPSBJbnRlZ2VyLnBhcnNlSW50\nKHMyKTsKICAgICAgICAgICAJCQl9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9p\nZCBnZXRQcm9kdWN0VmVyc2lvbk1ham9yTWlub3IoKSB7CiAgICAgICAgLy8g\nSW5jYXNlIEpEQkMgZHJpdmVyIHZlcnNpb24gaXMgbG93ZXIgdGhhbiAzCiAg\nICAgICAgLy8gdXNlIGZvbGxvd2luZyBpbmZvIHRvIGRldGVybWluZSBNYWpv\nciBhbmQgTWlub3IgCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAg\nICBDTEkgICAgdnMgICAgICBKQ0MKICAgICAgICAvLyBaREJWOCBEQlByb2RO\nYW1lICAgICAgIERCMiAgICAgICAgICAgIERCMgogICAgICAgIC8vICAgICAg\nIERCUHJvZFZlcnNpb24gICAgMDguMDEuMDAwNSAgICAgRFNOMDgwMTUKICAg\nICAgICAvLyBaREJWOSAgICAgICAgICAgICAgICAgIERCMiAgICAgICAgICAg\nIERCMgogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgMDkuMDEu\nMDAwNSAgICAgRFNOMDkwMTUKICAgICAgICAvLyBXaW5WOSAgICAgICAgICAg\nICAgICAgIERCMi9OVCAgICAgICAgIERCMi9OVAogICAgICAgIC8vICAgICAg\nICAgICAgICAgICAgICAgICAgMDkuMDEuMDAwMCAgICAgU1FMMDkwMTAKICAg\nICAgICAvLyBTb2xhcmlzVjkgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIERCMi9TVU42NAogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgU1FMMDkwMQogICAgICAgIC8vIExpbnV4ICAgICAg\nICAgICAgICAgICAgREIyL0xJTlVYICAgICAgREIyL0xJTlVYCiAgICAgICAg\nLy8gICAgICAgICAgICAgICAgICAgICAgICAwOS4wMS4wMDAwICAgICBTUUww\nOTAxCiAgICAgICAgaWYgKGRhdGFiYXNlUHJvZHVjdFZlcnNpb24uaW5kZXhP\nZigiMDkiKSAhPSAtMSkgewogICAgICAgICAgICBtYWogPSA5OwogICAgICAg\nICAgICBpZiAoZGF0YWJhc2VQcm9kdWN0VmVyc2lvbi5pbmRleE9mKCIwMSIp\nICE9IC0xKSB7CiAgICAgICAgICAgICAgICBtaW4gPSAxOwogICAgICAgICAg\nICB9CiAgICAgICAgfSBlbHNlIGlmIChkYXRhYmFzZVByb2R1Y3RWZXJzaW9u\nLmluZGV4T2YoIjA4IikgIT0gLTEpIHsKICAgICAgICAgICAgbWFqID0gODsK\nICAgICAgICAgICAgbWluID0gMjsKICAgICAgICAgICAgaWYgKGRhdGFiYXNl\nUHJvZHVjdFZlcnNpb24uaW5kZXhPZigiMDEiKSAhPSAtMSkgewogICAgICAg\nICAgICAgICAgbWluID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldE9wdGltaXplQ2xhdXNlKFNl\nbGVjdCBzZWwpIHsKICAgICAgICBpZiAoc2VsICE9IG51bGwgJiYgc2VsLmdl\ndEV4cGVjdGVkUmVzdWx0Q291bnQoKSA+IDApIHsKICAgICAgICAgICAgU3Ry\naW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcHRpbWl6ZUNsYXVzZSkuYXBw\nZW5kKCIgIikKICAgICAgICAgICAgICAgIC5hcHBlbmQoU3RyaW5nLnZhbHVl\nT2Yoc2VsLmdldEV4cGVjdGVkUmVzdWx0Q291bnQoKSkpCiAgICAgICAgICAg\nICAgICAuYXBwZW5kKCIgIikuYXBwZW5kKHJvd0NsYXVzZSk7CiAgICAgICAg\nICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgICAgICB9CgogICAgICAg\nIHJldHVybiAiIjsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQUV4Y2VwdGlv\nbiBuZXdTdG9yZUV4Y2VwdGlvbihTdHJpbmcgbXNnLCBTUUxFeGNlcHRpb25b\nXSBjYXVzZXMsCiAgICAgICAgT2JqZWN0IGZhaWxlZCkgewogICAgICAgIGlm\nIChjYXVzZXMgIT0gbnVsbCAmJiBjYXVzZXMubGVuZ3RoID4gMCkKICAgICAg\nICAgICAgbXNnID0gYXBwZW5kRXh0ZW5kZWRFeGNlcHRpb25Nc2cobXNnLCBj\nYXVzZXNbMF0pOwogICAgICAgIHJldHVybiBzdXBlci5uZXdTdG9yZUV4Y2Vw\ndGlvbihtc2csIGNhdXNlcywgZmFpbGVkKTsKICAgIH0KCiAgICAvKioKICAg\nICAqICBBcHBlbmQgZXhjZXB0aW9uIGluZm9ybWF0aW9uIGZyb20gU1FMQ0Eg\ndG8gdGhlIGV4c2lzdGluZwogICAgICogIGV4Y2VwdGlvbiBtZWFzc2FnZQog\nICAgICovCiAgICBwcml2YXRlIFN0cmluZyBhcHBlbmRFeHRlbmRlZEV4Y2Vw\ndGlvbk1zZyhTdHJpbmcgbXNnLCBTUUxFeGNlcHRpb24gc3FsZSl7CiAgICAg\nICBmaW5hbCBTdHJpbmcgR0VUU1FMQ0EgPSJnZXRTcWxjYSI7CiAgICAgICBT\ndHJpbmcgZXhjZXB0aW9uTXNnID0gbmV3IFN0cmluZygpOwogICAgICAgdHJ5\nIHsKICAgICAgICAgICAgTWV0aG9kIHNxbGNhTTIgPSBzcWxlLmdldE5leHRF\neGNlcHRpb24oKS5nZXRDbGFzcygpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLmdldE1ldGhvZChHRVRTUUxDQSxudWxsKTsKICAgICAgICAgICAg\nT2JqZWN0IHNxbGNhID0gc3FsY2FNMi5pbnZva2Uoc3FsZS5nZXROZXh0RXhj\nZXB0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXSB7fSk7CiAgICAgICAgICAgIE1ldGhvZCAg\nZ2V0U3FsRXJycE1ldGhkID0gc3FsY2EuZ2V0Q2xhc3MoKS4KICAgICAgICAg\nICAgZ2V0TWV0aG9kKCJnZXRTcWxFcnJwIiwgbnVsbCk7CiAgICAgICAgICAg\nIE1ldGhvZCAgZ2V0U3FsV2Fybk1ldGhkID0gc3FsY2EuZ2V0Q2xhc3MoKS4K\nICAgICAgICAgICAgZ2V0TWV0aG9kKCJnZXRTcWxXYXJuIiwgbnVsbCk7CiAg\nICAgICAgICAgIE1ldGhvZCAgZ2V0U3FsRXJyZE1ldGhkID0gc3FsY2EuZ2V0\nQ2xhc3MoKS4KICAgICAgICAgICAgZ2V0TWV0aG9kKCJnZXRTcWxFcnJkIiwg\nbnVsbCk7CiAgICAgICAgICAgIFN0cmluZ0J1ZmZlciBlcnJkU3RyID0gbmV3\nIFN0cmluZ0J1ZmZlcigpOwoKICAgICAgICAgICAgaW50W10gZXJyZHMgPSAo\naW50W10pIGdldFNxbEVycmRNZXRoZC5pbnZva2Uoc3FsY2EsIG5ldyBPYmpl\nY3RbXXt9KTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlcnJk\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGVycmRTdHIuYXBwZW5k\nKGVycmRTdHIubGVuZ3RoKCkgPiAwID8gIiwgIiA6ICIiKS4KICAgICAgICAg\nICAgICAgICAgICBhcHBlbmQoZXJyZHNbaV0pOwogICAgICAgICAgICBleGNl\ncHRpb25Nc2cgPSBleGNlcHRpb25Nc2cuY29uY2F0KCAiU1FMQ0EgT1VUUFVU\nIiArCiAgICAgICAgICAgICAgICAgICAgIltFcnJwPSIgKyBnZXRTcWxFcnJw\nTWV0aGQuaW52b2tlKHNxbGNhLCBuZXcgT2JqZWN0W117fSkKICAgICAgICAg\nICAgICAgICAgICArICIsIEVycmQ9IiArIGVycmRTdHIpOwoKICAgICAgICAg\nICAgU3RyaW5nIFdhcm4gPSBuZXcgU3RyaW5nKChjaGFyW10pIGdldFNxbFdh\ncm5NZXRoZC4KICAgICAgICAgICAgICAgICAgICBpbnZva2Uoc3FsY2EsIG5l\ndyBPYmplY3RbXXt9KSk7CiAgICAgICAgICAgIGlmKFdhcm4udHJpbSgpLmxl\nbmd0aCgpICE9IDApCiAgICAgICAgICAgICAgICBleGNlcHRpb25Nc2cgPSBl\neGNlcHRpb25Nc2cuY29uY2F0KCIsIFdhcm49IiArV2FybiArICJdIiApOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBleGNlcHRpb25Nc2cg\nPSBleGNlcHRpb25Nc2cuY29uY2F0KCAiXSIgKTsKICAgICAgICAgICAgbXNn\nID0gbXNnLmNvbmNhdChleGNlcHRpb25Nc2cpOwogICAgICAgICAgICByZXR1\ncm4gbXNnOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAgICAg\nICAgICAgIHJldHVybiBzcWxlLmdldE1lc3NhZ2UoKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIGludCBnZXREYjJTZXJ2ZXJUeXBlKCkgewogICAg\nICAgIHJldHVybiBkYjJTZXJ2ZXJUeXBlOwogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgdm9pZCBhcHBlbmRMZW5ndGgoU1FMQnVmZmVyIGJ1ZiwgaW50IHR5\ncGUpIHsKICAgICAgICBpZiAodHlwZSA9PSBUeXBlcy5WQVJDSEFSKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKEludGVnZXIudG9TdHJp\nbmcoY2hhcmFjdGVyQ29sdW1uU2l6ZSkpLgogICAgICAgICAgICAgICAgYXBw\nZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGlzIGRpY3Rp\nb25hcnkgc3VwcG9ydHMgWE1MIHR5cGUsCiAgICAgKiB1c2UgdGhpcyBtZXRo\nb2QgdG8gYXBwZW5kIHhtbCBwcmVkaWNhdGUuCiAgICAgKiAKICAgICAqIEBw\nYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlz\nb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24g\ndG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNp\nZGUgb2YgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJp\nZ2h0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFt\nIGxoc3htbCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgbGVmdCBvcGVyYW5kIG1h\ncHMgdG8geG1sCiAgICAgKiBAcGFyYW0gcmhzeG1sIGluZGljYXRlcyB3aGV0\naGVyIHRoZSByaWdodCBvcGVyYW5kIG1hcHMgdG8geG1sCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24oU1FMQnVmZmVyIGJ1\nZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVy\nVmFsdWUgcmhzLCBib29sZWFuIGxoc3htbCwgYm9vbGVhbiByaHN4bWwpIHsK\nICAgICAgICBzdXBlci5hcHBlbmRYbWxDb21wYXJpc29uKGJ1Ziwgb3AsIGxo\ncywgcmhzLCBsaHN4bWwsIHJoc3htbCk7CiAgICAgICAgaWYgKGxoc3htbCAm\nJiByaHN4bWwpCiAgICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24yKGJ1\nZiwgb3AsIGxocywgcmhzKTsKICAgICAgICBlbHNlIGlmIChsaHN4bWwpCiAg\nICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3AsIGxocywg\ncmhzKTsKICAgICAgICBlbHNlIAogICAgICAgICAgICBhcHBlbmRYbWxDb21w\nYXJpc29uMShidWYsIG9wLCByaHMsIGxocyk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBcHBlbmQgYW4geG1sIGNvbXBhcmlzb24gcHJlZGljYXRlLgogICAg\nICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUg\ndGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNv\nbiBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUg\nbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8geG1s\nIGNvbHVtbikKICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lk\nZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYXBwZW5kWG1sQ29tcGFyaXNvbjEoU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9w\nLCAKICAgICAgICAgICAgRmlsdGVyVmFsdWUgbGhzLCBGaWx0ZXJWYWx1ZSBy\naHMpIHsKICAgICAgICBib29sZWFuIGNhc3RyaHMgPSBmYWxzZTsKICAgICAg\nICBDbGFzcyByYyA9IEZpbHRlcnMud3JhcChyaHMuZ2V0VHlwZSgpKTsKICAg\nICAgICBpbnQgdHlwZSA9IDA7CiAgICAgICAgaWYgKHJocy5pc0NvbnN0YW50\nKCkpIHsKICAgICAgICAgICAgdHlwZSA9IGdldEpEQkNUeXBlKEphdmFUeXBl\ncy5nZXRUeXBlQ29kZShyYyksIGZhbHNlKTsKICAgICAgICAgICAgY2FzdHJo\ncyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGFwcGVuZFht\nbEV4aXN0cyhidWYsIGxocyk7CgogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5h\ncHBlbmQob3ApLmFwcGVuZCgiICIpOwogICAgICAgIAogICAgICAgIGJ1Zi5h\ncHBlbmQoIiQiKTsKICAgICAgICBpZiAoY2FzdHJocykKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiUGFybSIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\ncmhzLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgCiAgICAgICAgYnVmLmFwcGVu\nZCgiXScgUEFTU0lORyAiKTsKICAgICAgICBhcHBlbmRYbWxWYXIoYnVmLCBs\naHMpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgCiAgICAg\nICAgaWYgKGNhc3RyaHMpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCBy\naHMsIHR5cGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmhzLmFwcGVu\nZFRvKGJ1Zik7CiAgICAgICAgCiAgICAgICAgYnVmLmFwcGVuZCgiIEFTIFwi\nIik7CiAgICAgICAgaWYgKGNhc3RyaHMpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIlBhcm0iKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJocy5hcHBl\nbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlwiKSIpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIEFwcGVuZCBhbiB4bWwgY29tcGFyaXNvbiBw\ncmVkaWNhdGUuIChib3RoIG9wZXJhbmRzIG1hcCB0byB4bWwgY29sdW1uKQog\nICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3Jp\ndGUgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFy\naXNvbiBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0\naGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8g\neG1sIGNvbHVtbikKICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQg\nc2lkZSBvZiB0aGUgY29tcGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNvbjIo\nU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLCAKICAgICAgICAgICAgRmlsdGVy\nVmFsdWUgbGhzLCBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBhcHBlbmRY\nbWxFeGlzdHMoYnVmLCBsaHMpOwogICAgICAgIAogICAgICAgIGJ1Zi5hcHBl\nbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwogICAgICAgIAogICAg\nICAgIGJ1Zi5hcHBlbmQoIiQiKS5hcHBlbmQocmhzLmdldENvbHVtbkFsaWFz\nKAogICAgICAgICAgICByaHMuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0Q29sdW1u\ncygpWzBdKSkuCiAgICAgICAgICAgIGFwcGVuZCgiLyovIik7CiAgICAgICAg\ncmhzLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgCiAgICAgICAgYnVmLmFwcGVu\nZCgiXScgUEFTU0lORyAiKTsKICAgICAgICBhcHBlbmRYbWxWYXIoYnVmLCBs\naHMpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgYXBwZW5k\nWG1sVmFyKGJ1ZiwgcmhzKTsKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxWYXIoU1FMQnVm\nZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgdmFsKSB7CiAgICAgICAgYnVmLmFwcGVu\nZCh2YWwuZ2V0Q29sdW1uQWxpYXMoCiAgICAgICAgICAgIHZhbC5nZXRGaWVs\nZE1hcHBpbmcoKS5nZXRDb2x1bW5zKClbMF0pKS4KICAgICAgICAgICAgYXBw\nZW5kKCIgQVMgIikuCiAgICAgICAgICAgIGFwcGVuZCgiXCIiKS5hcHBlbmQo\ndmFsLmdldENvbHVtbkFsaWFzKAogICAgICAgICAgICB2YWwuZ2V0RmllbGRN\nYXBwaW5nKCkuZ2V0Q29sdW1ucygpWzBdKSkuCiAgICAgICAgICAgIGFwcGVu\nZCgiXCIiKTsgICAgICAgIAogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQg\nYXBwZW5kWG1sRXhpc3RzKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHZh\nbCkgewogICAgICAgIGJ1Zi5hcHBlbmQoIlhNTEVYSVNUUygnIik7CiAgICAg\nICAgYnVmLmFwcGVuZCgiJCIpLmFwcGVuZCh2YWwuZ2V0Q29sdW1uQWxpYXMo\nCiAgICAgICAgICAgIHZhbC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRDb2x1bW5z\nKClbMF0pKS4KICAgICAgICAgICAgYXBwZW5kKCIvKlsiKTsKICAgICAgICB2\nYWwuYXBwZW5kVG8oYnVmKTsgICAgICAgIAogICAgfQogICAgCiAgICAvKioK\nICAgICAqIGFkZCBDQVNUIGZvciBhIHNjYWxhciBmdW5jdGlvbiB3aGVyZSBv\ncGVyYW5kIGlzIGEgcGFyYW0KICAgICAqIAogICAgICogQHBhcmFtIGZ1bmMg\nb3JpZ2luYWwgc3RyaW5nCiAgICAgKiBAcGFyYW0gdGFyZ2V0IHN1YnN0cmlu\nZyB0byBsb29rIGZvcgogICAgICogQHBhcmFtIGFzU3RyaW5nIAogICAgICog\nQHJldHVybiB1cGRhdGVkIHN0cmluZyAoZnVuYykKICAgICAqLwogICAgcHJp\ndmF0ZSBTdHJpbmcgYWRkQ2FzdEFzU3RyaW5nKFN0cmluZyBmdW5jLCBTdHJp\nbmcgdGFyZ2V0LCAKICAgICAgICAgICAgU3RyaW5nIGFzU3RyaW5nKSB7CiAg\nICAgICAgU3RyaW5nIGZzdHJpbmcgPSBmdW5jOwogICAgICAgIGlmIChmdW5j\nLmluZGV4T2YodGFyZ2V0KSAhPSAtMSkKICAgICAgICAgICAgZnN0cmluZyA9\nIFN0cmluZ3MucmVwbGFjZSgKICAgICAgICAgICAgICAgIGZ1bmMsIHRhcmdl\ndCwgIkNBU1QoIiArIHRhcmdldCArIGFzU3RyaW5nICsgIikiKTsKICAgICAg\nICByZXR1cm4gZnN0cmluZzsKICAgIH0KCiAgICAvKioKICAgICAqIGFkZCBD\nQVNUIGZvciBhIGZ1bmN0aW9uIG9wZXJhdG9yIHdoZXJlIG9wZXJhbmQgaXMg\nYSBwYXJhbQogICAgICogCiAgICAgKiBAcGFyYW0gZnVuYyBmdW5jdGlvbiBu\nYW1lCiAgICAgKiBAcGFyYW0gdmFsIHR5cGUKICAgICAqIEByZXR1cm4gdXBk\nYXRlZCBzdHJpbmcgKGZ1bmMpCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nYWRkQ2FzdEFzVHlwZShTdHJpbmcgZnVuYywgVmFsIHZhbCkgewogICAgICAg\nIFN0cmluZyBmc3RyaW5nID0gbnVsbDsKICAgICAgICBTdHJpbmcgdHlwZSA9\nIGdldFR5cGVOYW1lKGdldEpEQkNUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29k\nZSh2YWwKICAgICAgICAgICAgLmdldFR5cGUoKSksIGZhbHNlKSk7CiAgICAg\nICAgZnN0cmluZyA9ICJDQVNUKD8gQVMgIiArIHR5cGUgKyAiKSI7CiAgICAg\nICAgcmV0dXJuIGZzdHJpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGNvcnJlY3QgQ0FTVCBmdW5jdGlvbiBzeW50YXgKICAgICAqIAog\nICAgICogQHBhcmFtIHZhbCBvcGVyYW5kIG9mIGNhc3QKICAgICAqIEBwYXJh\nbSBmdW5jIG9yaWdpbmFsIHN0cmluZwogICAgICogQHJldHVybiBhIFN0cmlu\nZyB3aXRoIHRoZSBjb3JyZWN0IENBU1QgZnVuY3Rpb24gc3ludGF4CiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2FzdEZ1bmN0aW9uKFZhbCB2YWws\nIFN0cmluZyBmdW5jKSB7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIExp\ndCB8fCB2YWwgaW5zdGFuY2VvZiBQYXJhbSkKICAgICAgICAgICAgaWYgKGZ1\nbmMuaW5kZXhPZigiVkFSQ0hBUiIpID09IC0xKQogICAgICAgICAgICAgICAg\nZnVuYyA9IGFkZENhc3RBc1N0cmluZyhmdW5jLCAiezB9IiwgIiBBUyBWQVJD\nSEFSKDEwMDApIik7CiAgICAgICAgcmV0dXJuIGZ1bmM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvcnJlY3QgQ0FTVCBmdW5jdGlvbiBz\neW50YXgKICAgICAqIAogICAgICogQHBhcmFtIHZhbCBvcGVyYW5kIG9mIGNh\nc3QKICAgICAqIEBwYXJhbSBmdW5jIG9yaWdpbmFsIHN0cmluZwogICAgICog\nQHBhcmFtIGNvbCBkYXRhYmFzZSBjb2x1bW4KICAgICAqIEByZXR1cm4gYSBT\ndHJpbmcgd2l0aCB0aGUgY29ycmVjdCBDQVNUIGZ1bmN0aW9uIHN5bnRheAog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldENhc3RGdW5jdGlvbihWYWwg\ndmFsLCBTdHJpbmcgZnVuYywgQ29sdW1uIGNvbCkgewogICAgICAgIGJvb2xl\nYW4gZG9DYXN0ID0gZmFsc2U7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9m\nIExpdCB8fCB2YWwgaW5zdGFuY2VvZiBQYXJhbSkgewogICAgICAgICAgICBk\nb0Nhc3QgPSB0cnVlOwogICAgICAgIH0KICAgICAgICAvLyBjYXN0IGFueXRo\naW5nIG5vdCBhbHJlYWR5IGEgVkFSQ0hBUiB0byBWQVJDSEFSCiAgICAgICAg\naWYgKGNvbC5nZXRUeXBlKCkgIT0gVHlwZXMuVkFSQ0hBUikgewogICAgICAg\nICAgICBkb0Nhc3QgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZG9D\nYXN0ID09IHRydWUpIHsKICAgICAgICAgICAgaWYgKGZ1bmMuaW5kZXhPZigi\nVkFSQ0hBUiIpID09IC0xKSB7CiAgICAgICAgICAgICAgICBmdW5jID0gYWRk\nQ2FzdEFzU3RyaW5nKGZ1bmMsICJ7MH0iLCAiIEFTIFZBUkNIQVIoMTAwMCki\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZnVu\nYzsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbmRleE9mKFNRTEJ1ZmZlciBi\ndWYsIEZpbHRlclZhbHVlIHN0ciwgRmlsdGVyVmFsdWUgZmluZCwKICAgICAg\nICAgICAgRmlsdGVyVmFsdWUgc3RhcnQpIHsKICAgICAgICBpZiAoZmluZC5n\nZXRWYWx1ZSgpICE9IG51bGwpIHsgLy8gbm9uIGNvbnN0YW50cwogICAgICAg\nICAgICBidWYuYXBwZW5kKCIoTE9DQVRFKENBU1QoKCIpOwogICAgICAgICAg\nICBmaW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIikgQVMgVkFSQ0hBUigxMDAwKSksICIpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIC8vIHRoaXMgaXMgYSBjb25zdGFudAogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIoTE9DQVRFKCIpOwogICAgICAgICAgICBmaW5kLmFwcGVu\nZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAg\nICAgfQogICAgICAgIGlmIChzdHIuZ2V0VmFsdWUoKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNBU1QoKCIpOwogICAgICAgICAgICBz\ndHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKSBB\nUyBWQVJDSEFSKDEwMDApKSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHN0ci5hcHBlbmRUbyhidWYpOwogICAgICAgIH0KICAgICAgICBpZiAo\nc3RhcnQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoc3RhcnQuZ2V0VmFs\ndWUoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIs\nIENBU1QoKCIpOwogICAgICAgICAgICAgICAgc3RhcnQuYXBwZW5kVG8oYnVm\nKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIikgQVMgSU5URUdFUikg\nKyAxIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBi\ndWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICAgICAgc3RhcnQuYXBwZW5k\nVG8oYnVmKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBidWYu\nYXBwZW5kKCIpIC0gMSkiKTsKICAgIH0KCiAgICAvKiogCiAgICAgKiBDYXN0\nIHRoZSBzcGVjaWZpZWQgdmFsdWUgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgog\nICAgICoKICAgICAqIEBwYXJhbSBidWYgdGhlIGJ1ZmZlciB0byBhcHBlbmQg\ndGhlIGNhc3QgdG8KICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGNh\nc3QKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHRoZSBjYXNlLCBl\nLmcuIHtAbGluayBUeXBlcyNOVU1FUklDfQogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhcHBlbmRDYXN0KFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHZh\nbCwgaW50IHR5cGUpIHsKCiAgICAgICAgLy8gQ29udmVydCB0aGUgY2FzdCBm\ndW5jdGlvbjogIkNBU1QoezB9IEFTIHsxfSkiCiAgICAgICAgaW50IGZpcnN0\nUGFyYW0gPSBjYXN0RnVuY3Rpb24uaW5kZXhPZigiezB9Iik7CiAgICAgICAg\nU3RyaW5nIHByZSA9IGNhc3RGdW5jdGlvbi5zdWJzdHJpbmcoMCwgZmlyc3RQ\nYXJhbSk7IC8vICJDQVNUKCIKICAgICAgICBTdHJpbmcgbWlkID0gY2FzdEZ1\nbmN0aW9uLnN1YnN0cmluZyhmaXJzdFBhcmFtICsgMyk7CiAgICAgICAgaW50\nIHNlY29uZFBhcmFtID0gbWlkLmluZGV4T2YoInsxfSIpOwogICAgICAgIFN0\ncmluZyBwb3N0OwogICAgICAgIGlmIChzZWNvbmRQYXJhbSA+IC0xKSB7CiAg\nICAgICAgICAgIHBvc3QgPSBtaWQuc3Vic3RyaW5nKHNlY29uZFBhcmFtICsg\nMyk7IC8vICIpIgogICAgICAgICAgICBtaWQgPSBtaWQuc3Vic3RyaW5nKDAs\nIHNlY29uZFBhcmFtKTsgLy8gIiBBUyAiCiAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgIHBvc3QgPSAiIjsKCiAgICAgICAgLy8gTm8gbmVlZCB0byBhZGQg\nQ0FTVCBpZiB0aGUgdmFsdWUgaXMgYSBjb25zdGFudAogICAgICAgIGlmICh2\nYWwgaW5zdGFuY2VvZiBMaXQgfHwgdmFsIGluc3RhbmNlb2YgUGFyYW0pIHsK\nICAgICAgICAgICAgYnVmLmFwcGVuZChwcmUpOwogICAgICAgICAgICB2YWwu\nYXBwZW5kVG8oYnVmKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChtaWQpOwog\nICAgICAgICAgICBidWYuYXBwZW5kKGdldFR5cGVOYW1lKHR5cGUpKTsKICAg\nICAgICAgICAgYXBwZW5kTGVuZ3RoKGJ1ZiwgdHlwZSk7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQocG9zdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgdmFsLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIFN0cmluZyBzcWxT\ndHJpbmcgPSBidWYuZ2V0U1FMKGZhbHNlKTsKICAgICAgICAgICAgaWYgKHNx\nbFN0cmluZy5lbmRzV2l0aCgiPyIpKSB7CiAgICAgICAgICAgICAgICAvLyBj\nYXNlICIoPyIgLSBjb252ZXJ0IHRvICJDQVNUKD8gQVMgdHlwZSIKICAgICAg\nICAgICAgICAgIFN0cmluZyB0eXBlTmFtZSA9IGdldFR5cGVOYW1lKHR5cGUp\nOwogICAgICAgICAgICAgICAgaWYgKFN0cmluZy5jbGFzcy5lcXVhbHModmFs\nLmdldFR5cGUoKSkpCiAgICAgICAgICAgICAgICAgICAgdHlwZU5hbWUgPSB0\neXBlTmFtZSArICIoIiArIGNoYXJhY3RlckNvbHVtblNpemUgKyAiKSI7CiAg\nICAgICAgICAgICAgICBTdHJpbmcgc3RyID0gIkNBU1QoPyBBUyAiICsgdHlw\nZU5hbWUgKyAiKSI7CiAgICAgICAgICAgICAgICBidWYucmVwbGFjZVNxbFN0\ncmluZyhzcWxTdHJpbmcubGVuZ3RoKCkgLSAxLAogICAgICAgICAgICAgICAg\nICAgICAgICBzcWxTdHJpbmcubGVuZ3RoKCksIHN0cik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4g\naW5kZXggaWYgbmVjZXNzYXJ5IGZvciBzb21lIGRhdGFiYXNlIHRhYmxlcwog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBjcmVhdGVJbmRleElmTmVjZXNzYXJ5\nKFNjaGVtYSBzY2hlbWEsIFN0cmluZyB0YWJsZSwKICAgICAgICAgICAgQ29s\ndW1uIHBrQ29sdW1uKSB7CiAgICAgICAgaWYgKGlzREIyWk9TVjh4T3JMYXRl\ncigpKSB7CiAgICAgICAgICAgIC8vIGJ1aWxkIHRoZSBpbmRleCBmb3IgdGhl\nIHNlcXVlbmNlIHRhYmxlcwogICAgICAgICAgICAvLyB0aGUgaW5kZXggbmFt\nZSB3aWxsIHRoZSBmdWxseSBxdWFsaWZpZWQgdGFibGUgbmFtZSArIF9JRFgK\nICAgICAgICAgICAgVGFibGUgdGFiID0gc2NoZW1hLmdldFRhYmxlKHRhYmxl\nKTsKICAgICAgICAgICAgSW5kZXggaWR4ID0gdGFiLmFkZEluZGV4KHRhYi5n\nZXRGdWxsTmFtZSgpICsgIl9JRFgiKTsKICAgICAgICAgICAgaWR4LnNldFVu\naXF1ZSh0cnVlKTsKICAgICAgICAgICAgaWR4LmFkZENvbHVtbihwa0NvbHVt\nbik7CiAgICAgICAgfQogICAgfQogICAgCiAgICBTdHJpbmcgbnVsbFNhZmUo\nU3RyaW5nIHMpIHsKICAgIAlyZXR1cm4gcyA9PSBudWxsID8gIiIgOiBzOwog\nICAgfQp9Cg==\n","encoding":"base64"}

