{"sha":"447d7622c824d92a1d09204c97dccaa62b389318","node_id":"MDQ6QmxvYjIwNjM2NDo0NDdkNzYyMmM4MjRkOTJhMWQwOTIwNGM5N2RjY2FhNjJiMzg5MzE4","size":147368,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/447d7622c824d92a1d09204c97dccaa62b389318","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSW5w\ndXRTdHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlJlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uU3RyaW5nUmVhZGVyOwppbXBvcnQgamF2YS5pby5Xcml0ZXI7\nCmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5JbnZvY2F0aW9uVGFyZ2V0RXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7CmltcG9ydCBqYXZhLm1hdGguQmln\nSW50ZWdlcjsKaW1wb3J0IGphdmEuc3FsLkFycmF5OwppbXBvcnQgamF2YS5z\ncWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZhLnNx\nbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0\nYTsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQg\namF2YS5zcWwuUmVmOwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU1FM\nV2FybmluZzsKaW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGph\ndmEuc3FsLlRpbWU7CmltcG9ydCBqYXZhLnNxbC5UaW1lc3RhbXA7CmltcG9y\ndCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEudGV4dC5NZXNzYWdlRm9y\nbWF0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRp\nbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YXguc3Fs\nLkRhdGFTb3VyY2U7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5j\nb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhw\nQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLkV4cFN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWw7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5KYXZhU1FMVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFT\nb3VyY2VGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuSW5kZXg7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuTmFtZVNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TZXF1ZW5jZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlvbkRl\nY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5M\nb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlJlZmVyZW50aWFsSW50ZWdyaXR5RXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU2VyaWFs\naXphdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3Jl\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5z\ndXBwb3J0ZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgc2VycC51dGls\nLk51bWJlcnM7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBD\nbGFzcyB3aGljaCBhbGxvd3MgdGhlIGNyZWF0aW9uIG9mIFNRTCBkeW5hbWlj\nYWxseSwgaW4gYQogKiBkYXRhYmFzZSBhZ25vc3RpYyBmYXNoaW9uLiBTdWJj\nbGFzcyBmb3IgdGhlIG51YW5jZXMgb2YgZGlmZmVyZW50IGRhdGEgc3RvcmVz\nLgogKi8KcHVibGljIGNsYXNzIERCRGljdGlvbmFyeQogICAgaW1wbGVtZW50\ncyBDb25maWd1cmFibGUsIENvbm5lY3Rpb25EZWNvcmF0b3IsIEpvaW5TeW50\nYXhlcywKICAgIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yLlNRTFdhcm5p\nbmdIYW5kbGVyIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBW\nRU5ET1JfT1RIRVIgPSAib3RoZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgVkVORE9SX0RBVEFESVJFQ1QgPSAiZGF0YWRpcmVjdCI7Cgog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0VfVVBQ\nRVIgPSAidXBwZXIiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nU0NIRU1BX0NBU0VfTE9XRVIgPSAibG93ZXIiOwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU0NIRU1BX0NBU0VfUFJFU0VSVkUgPSAicHJlc2Vy\ndmUiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENPTlNfTkFN\nRV9CRUZPUkUgPSAiYmVmb3JlIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIENPTlNfTkFNRV9NSUQgPSAibWlkIjsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIENPTlNfTkFNRV9BRlRFUiA9ICJhZnRlciI7Cgog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0VfUE9TVF9TRUxF\nQ1QgPSAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgUkFOR0Vf\nUFJFX0RJU1RJTkNUID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BPU1RfRElTVElOQ1QgPSAyOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgUkFOR0VfUE9TVF9MT0NLID0gMzsKCiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBOQU5PID0gMTsKICAgIHByb3RlY3Rl\nZCBzdGF0aWMgZmluYWwgaW50IE1JQ1JPID0gTkFOTyAqIDEwMDA7CiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBNSUxMSSA9IE1JQ1JPICogMTAw\nMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IENFTlRJID0gTUlM\nTEkgKiAxMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IERFQ0kg\nPSBNSUxMSSAqIDEwMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50\nIFNFQyA9IE1JTExJICogMTAwMDsKCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBOQU1FX0FOWSA9IDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBOQU1FX1RBQkxFID0gMTsKICAgIHByb3RlY3RlZCBzdGF0aWMg\nZmluYWwgaW50IE5BTUVfU0VRVUVOQ0UgPSAyOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIFN0cmluZyBaRVJPX0RBVEVfU1RSID0KICAgICAgICAiJyIg\nKyBuZXcgamF2YS5zcWwuRGF0ZSgwKSArICInIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIFN0cmluZyBaRVJPX1RJTUVfU1RSID0gIiciICsgbmV3IFRp\nbWUoMCkgKyAiJyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nWkVST19USU1FU1RBTVBfU1RSID0KICAgICAgICAiJyIgKyBuZXcgVGltZXN0\nYW1wKDApICsgIiciOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgTG9j\nYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChE\nQkRpY3Rpb25hcnkuY2xhc3MpOwoKICAgIC8vIHNjaGVtYSBkYXRhCiAgICBw\ndWJsaWMgU3RyaW5nIHBsYXRmb3JtID0gIkdlbmVyaWMiOwogICAgcHVibGlj\nIFN0cmluZyBkcml2ZXJWZW5kb3IgPSBudWxsOwogICAgcHVibGljIFN0cmlu\nZyBjYXRhbG9nU2VwYXJhdG9yID0gIi4iOwogICAgcHVibGljIGJvb2xlYW4g\nY3JlYXRlUHJpbWFyeUtleXMgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyBj\nb25zdHJhaW50TmFtZU1vZGUgPSBDT05TX05BTUVfQkVGT1JFOwogICAgcHVi\nbGljIGludCBtYXhUYWJsZU5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMg\naW50IG1heENvbHVtbk5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50\nIG1heENvbnN0cmFpbnROYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGlu\ndCBtYXhJbmRleE5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1h\neEluZGV4ZXNQZXJUYWJsZSA9IEludGVnZXIuTUFYX1ZBTFVFOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNGb3JlaWduS2V5cyA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0gdHJ1\nZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJh\naW50cyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3Ry\naWN0RGVsZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzQ2FzY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwogICAg\ncHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RVcGRh\ndGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHND\nYXNjYWRlVXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVlOwog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENv\nbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVy\nVGFibGVXaXRoRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgU3RyaW5n\nIHJlc2VydmVkV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzeXN0\nZW1TY2hlbWFzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtVGFi\nbGVzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VsZWN0V29yZHMgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBmaXhlZFNpemVUeXBlTmFtZXMgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1BX0NB\nU0VfVVBQRVI7CgogICAgLy8gc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZhbGlk\nYXRpb25TUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjbG9zZVBvb2xT\nUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBpbml0aWFsaXphdGlvblNR\nTCA9IG51bGw7CiAgICBwdWJsaWMgaW50IGpvaW5TeW50YXggPSBTWU5UQVhf\nU1FMOTI7CiAgICBwdWJsaWMgU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9ICJM\nRUZUIE9VVEVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBpbm5lckpvaW5D\nbGF1c2UgPSAiSU5ORVIgSk9JTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNyb3Nz\nSm9pbkNsYXVzZSA9ICJDUk9TUyBKT0lOIjsKICAgIHB1YmxpYyBib29sZWFu\nIHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAgICBw\ndWJsaWMgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRFIjsK\nICAgIHB1YmxpYyBTdHJpbmcgdGFibGVGb3JVcGRhdGVDbGF1c2UgPSBudWxs\nOwogICAgcHVibGljIFN0cmluZyBkaXN0aW5jdENvdW50Q29sdW1uU2VwYXJh\ndG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2VsZWN0\nRm9yVXBkYXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMgPSB0\ncnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aE9y\nZGVyQ2xhdXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nTG9ja2luZ1dpdGhPdXRlckpvaW4gPSB0cnVlOwogICAgcHVibGljIGJvb2xl\nYW4gc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbiA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2Ug\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRpbWVv\ndXQgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc2ltdWxhdGVMb2NraW5n\nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNlbGVj\ndCA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJlbGF0\nZWRTdWJzZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNIYXZpbmcgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNT\nZWxlY3RTdGFydEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgaW50\nIHJhbmdlUG9zaXRpb24gPSBSQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1Ymxp\nYyBib29sZWFuIHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxzZTsK\nICAgIHB1YmxpYyBib29sZWFuIGFsbG93c0FsaWFzSW5CdWxrQ2xhdXNlID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTXVsdGlwbGVOb250\ncmFuc2FjdGlvbmFsUmVzdWx0U2V0cyA9IHRydWU7CiAgICBwdWJsaWMgYm9v\nbGVhbiByZXF1aXJlc1NlYXJjaFN0cmluZ0VzY2FwZUZvckxpa2UgPSB0cnVl\nOwogICAgcHVibGljIFN0cmluZyBzZWFyY2hTdHJpbmdFc2NhcGUgPSAiXFwi\nOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0\naW9ucyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNDYXN0\nRm9yQ29tcGFyaXNvbnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzTW9kT3BlcmF0b3IgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzWE1MQ29sdW1uID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0Nhc2VDb252ZXJzaW9uRm9yTG9iID0gZmFsc2U7CgogICAg\nLyoqCiAgICAgKiBTb21lIERhdGFiYXNlcyBhcHBlbmQgd2hpdGVzcGFjZSBh\nZnRlciB0aGUgc2NoZW1hIG5hbWUKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gdHJpbVNjaGVtYU5hbWUgPSBmYWxzZTsKCiAgICAvLyBmdW5jdGlvbnMK\nICAgIHB1YmxpYyBTdHJpbmcgY2FzdEZ1bmN0aW9uID0gIkNBU1QoezB9IEFT\nIHsxfSkiOwogICAgcHVibGljIFN0cmluZyB0b0xvd2VyQ2FzZUZ1bmN0aW9u\nID0gIkxPV0VSKHswfSkiOwogICAgcHVibGljIFN0cmluZyB0b1VwcGVyQ2Fz\nZUZ1bmN0aW9uID0gIlVQUEVSKHswfSkiOwogICAgcHVibGljIFN0cmluZyBz\ndHJpbmdMZW5ndGhGdW5jdGlvbiA9ICJDSEFSX0xFTkdUSCh7MH0pIjsKICAg\nIHB1YmxpYyBTdHJpbmcgYml0TGVuZ3RoRnVuY3Rpb24gPSAiKE9DVEVUX0xF\nTkdUSCh7MH0pICogOCkiOwogICAgcHVibGljIFN0cmluZyB0cmltTGVhZGlu\nZ0Z1bmN0aW9uID0gIlRSSU0oTEVBRElORyB7MX0gRlJPTSB7MH0pIjsKICAg\nIHB1YmxpYyBTdHJpbmcgdHJpbVRyYWlsaW5nRnVuY3Rpb24gPSAiVFJJTShU\nUkFJTElORyB7MX0gRlJPTSB7MH0pIjsKICAgIHB1YmxpYyBTdHJpbmcgdHJp\nbUJvdGhGdW5jdGlvbiA9ICJUUklNKEJPVEggezF9IEZST00gezB9KSI7CiAg\nICBwdWJsaWMgU3RyaW5nIGNvbmNhdGVuYXRlRnVuY3Rpb24gPSAiKHswfXx8\nezF9KSI7CiAgICBwdWJsaWMgU3RyaW5nIGNvbmNhdGVuYXRlRGVsaW1pdGVy\nID0gIidPUEVOSlBBVE9LRU4nIjsKICAgIHB1YmxpYyBTdHJpbmcgc3Vic3Ry\naW5nRnVuY3Rpb25OYW1lID0gIlNVQlNUUklORyI7CiAgICBwdWJsaWMgU3Ry\naW5nIGN1cnJlbnREYXRlRnVuY3Rpb24gPSAiQ1VSUkVOVF9EQVRFIjsKICAg\nIHB1YmxpYyBTdHJpbmcgY3VycmVudFRpbWVGdW5jdGlvbiA9ICJDVVJSRU5U\nX1RJTUUiOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50VGltZXN0YW1wRnVu\nY3Rpb24gPSAiQ1VSUkVOVF9USU1FU1RBTVAiOwogICAgcHVibGljIFN0cmlu\nZyBkcm9wVGFibGVTUUwgPSAiRFJPUCBUQUJMRSB7MH0iOwoKICAgIC8vIHR5\ncGVzCiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yYWdlTGltaXRhdGlvbnNGYXRh\nbCA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3RvcmVMYXJnZU51bWJl\ncnNBc1N0cmluZ3MgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN0b3Jl\nQ2hhcnNBc051bWJlcnMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gdXNl\nR2V0Qnl0ZXNGb3JCbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\ndXNlU2V0Qnl0ZXNGb3JCbG9icyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xl\nYW4gdXNlR2V0T2JqZWN0Rm9yQmxvYnMgPSBmYWxzZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHVzZUdldFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiB1c2VTZXRTdHJpbmdGb3JDbG9icyA9IGZhbHNlOwogICAg\ncHVibGljIGludCBtYXhFbWJlZGRlZEJsb2JTaXplID0gLTE7CiAgICBwdWJs\naWMgaW50IG1heEVtYmVkZGVkQ2xvYlNpemUgPSAtMTsKICAgIHB1YmxpYyBp\nbnQgaW5DbGF1c2VMaW1pdCA9IC0xOwogICAgcHVibGljIGludCBkYXRlUHJl\nY2lzaW9uID0gTUlMTEk7CiAgICBwdWJsaWMgaW50IGNoYXJhY3RlckNvbHVt\nblNpemUgPSAyNTU7CiAgICBwdWJsaWMgU3RyaW5nIGFycmF5VHlwZU5hbWUg\nPSAiQVJSQVkiOwogICAgcHVibGljIFN0cmluZyBiaWdpbnRUeXBlTmFtZSA9\nICJCSUdJTlQiOwogICAgcHVibGljIFN0cmluZyBiaW5hcnlUeXBlTmFtZSA9\nICJCSU5BUlkiOwogICAgcHVibGljIFN0cmluZyBiaXRUeXBlTmFtZSA9ICJC\nSVQiOwogICAgcHVibGljIFN0cmluZyBibG9iVHlwZU5hbWUgPSAiQkxPQiI7\nCiAgICBwdWJsaWMgU3RyaW5nIGJvb2xlYW5UeXBlTmFtZSA9ICJCT09MRUFO\nIjsKICAgIHB1YmxpYyBTdHJpbmcgY2hhclR5cGVOYW1lID0gIkNIQVIiOwog\nICAgcHVibGljIFN0cmluZyBjbG9iVHlwZU5hbWUgPSAiQ0xPQiI7CiAgICBw\ndWJsaWMgU3RyaW5nIGRhdGVUeXBlTmFtZSA9ICJEQVRFIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgZGVjaW1hbFR5cGVOYW1lID0gIkRFQ0lNQUwiOwogICAgcHVi\nbGljIFN0cmluZyBkaXN0aW5jdFR5cGVOYW1lID0gIkRJU1RJTkNUIjsKICAg\nIHB1YmxpYyBTdHJpbmcgZG91YmxlVHlwZU5hbWUgPSAiRE9VQkxFIjsKICAg\nIHB1YmxpYyBTdHJpbmcgZmxvYXRUeXBlTmFtZSA9ICJGTE9BVCI7CiAgICBw\ndWJsaWMgU3RyaW5nIGludGVnZXJUeXBlTmFtZSA9ICJJTlRFR0VSIjsKICAg\nIHB1YmxpYyBTdHJpbmcgamF2YU9iamVjdFR5cGVOYW1lID0gIkpBVkFfT0JK\nRUNUIjsKICAgIHB1YmxpYyBTdHJpbmcgbG9uZ1ZhcmJpbmFyeVR5cGVOYW1l\nID0gIkxPTkdWQVJCSU5BUlkiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFy\nY2hhclR5cGVOYW1lID0gIkxPTkdWQVJDSEFSIjsKICAgIHB1YmxpYyBTdHJp\nbmcgbnVsbFR5cGVOYW1lID0gIk5VTEwiOwogICAgcHVibGljIFN0cmluZyBu\ndW1lcmljVHlwZU5hbWUgPSAiTlVNRVJJQyI7CiAgICBwdWJsaWMgU3RyaW5n\nIG90aGVyVHlwZU5hbWUgPSAiT1RIRVIiOwogICAgcHVibGljIFN0cmluZyBy\nZWFsVHlwZU5hbWUgPSAiUkVBTCI7CiAgICBwdWJsaWMgU3RyaW5nIHJlZlR5\ncGVOYW1lID0gIlJFRiI7CiAgICBwdWJsaWMgU3RyaW5nIHNtYWxsaW50VHlw\nZU5hbWUgPSAiU01BTExJTlQiOwogICAgcHVibGljIFN0cmluZyBzdHJ1Y3RU\neXBlTmFtZSA9ICJTVFJVQ1QiOwogICAgcHVibGljIFN0cmluZyB0aW1lVHlw\nZU5hbWUgPSAiVElNRSI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbWVzdGFtcFR5\ncGVOYW1lID0gIlRJTUVTVEFNUCI7CiAgICBwdWJsaWMgU3RyaW5nIHRpbnlp\nbnRUeXBlTmFtZSA9ICJUSU5ZSU5UIjsKICAgIHB1YmxpYyBTdHJpbmcgdmFy\nYmluYXJ5VHlwZU5hbWUgPSAiVkFSQklOQVJZIjsKICAgIHB1YmxpYyBTdHJp\nbmcgdmFyY2hhclR5cGVOYW1lID0gIlZBUkNIQVIiOwogICAgcHVibGljIFN0\ncmluZyB4bWxUeXBlTmFtZSA9ICJYTUwiOwogICAgcHVibGljIFN0cmluZyBn\nZXRTdHJpbmdWYWwgPSAiIjsKCiAgICAvLyBzY2hlbWEgbWV0YWRhdGEKICAg\nIHB1YmxpYyBib29sZWFuIHVzZVNjaGVtYU5hbWUgPSB0cnVlOwogICAgcHVi\nbGljIFN0cmluZyB0YWJsZVR5cGVzID0gIlRBQkxFIjsKICAgIHB1YmxpYyBi\nb29sZWFuIHN1cHBvcnRzU2NoZW1hRm9yR2V0VGFibGVzID0gdHJ1ZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2NoZW1hRm9yR2V0Q29sdW1ucyA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZv\nckdldENvbHVtbnMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNOdWxsVGFibGVGb3JHZXRQcmltYXJ5S2V5cyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRJbmRleEluZm8g\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRhYmxl\nRm9yR2V0SW1wb3J0ZWRLZXlzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VHZXRCZXN0Um93SWRlbnRpZmllckZvclByaW1hcnlLZXlzID0gZmFs\nc2U7CiAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc0F1dG9Db21taXRGb3JN\nZXRhRGF0YSA9IGZhbHNlOwoKICAgIC8vIGF1dG8taW5jcmVtZW50CiAgICBw\ndWJsaWMgaW50IG1heEF1dG9Bc3NpZ25OYW1lTGVuZ3RoID0gMzE7CiAgICBw\ndWJsaWMgU3RyaW5nIGF1dG9Bc3NpZ25DbGF1c2UgPSBudWxsOwogICAgcHVi\nbGljIFN0cmluZyBhdXRvQXNzaWduVHlwZU5hbWUgPSBudWxsOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNBdXRvQXNzaWduID0gZmFsc2U7CiAgICBw\ndWJsaWMgU3RyaW5nIGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9IG51bGw7CiAg\nICBwdWJsaWMgU3RyaW5nIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gbnVsbDsKICAg\nIHB1YmxpYyBTdHJpbmcgc2VxdWVuY2VTUUwgPSBudWxsOwogICAgcHVibGlj\nIFN0cmluZyBzZXF1ZW5jZVNjaGVtYVNRTCA9IG51bGw7CiAgICBwdWJsaWMg\nU3RyaW5nIHNlcXVlbmNlTmFtZVNRTCA9IG51bGw7CgogICAgcHJvdGVjdGVk\nIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBudWxsOwogICAgcHJvdGVjdGVk\nIExvZyBsb2cgPSBudWxsOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gY29ubmVj\ndGVkID0gZmFsc2U7CiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc0pEQkMzID0g\nZmFsc2U7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHJlc2VydmVkV29yZFNl\ndCA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHN5\nc3RlbVNjaGVtYVNldCA9IG5ldyBIYXNoU2V0KCk7CiAgICBwcm90ZWN0ZWQg\nZmluYWwgU2V0IHN5c3RlbVRhYmxlU2V0ID0gbmV3IEhhc2hTZXQoKTsKICAg\nIHByb3RlY3RlZCBmaW5hbCBTZXQgZml4ZWRTaXplVHlwZU5hbWVTZXQgPSBu\nZXcgSGFzaFNldCgpOwogICAgCiAgICAvKioKICAgICAqIFNvbWUgSkRCQyBk\ncml2ZXJzIC0gaWUgREIyIHR5cGUgMiBvbiBaL09TIHRocm93IGV4Y2VwdGlv\nbnMgb24KICAgICAqIHNldFF1ZXJ5VGltZW91dCB3aGVuIHByb3ZpZGVkIHNw\nZWNpZmljIGlucHV0IHZhbHVlcy4KICAgICAqIFRvIHJlbWFpbiBjb25zaXN0\nZW50IHdpdGggZWFybGllciB2ZXJzaW9ucyBvZiB0aGUgZHJpdmVyIHdlIHNo\nb3VsZCBpZ25vcmUKICAgICAqIHRoZSBleGNlcHRpb24uCiAgICAgKiAKICAg\nICAqIFRoaXMgdmFyaWFibGUgd2lsbCBiZSByZW1vdmVkIGluIGZ1dHVyZSBy\nZWxlYXNlcyB3aGVuIHdlIGNhbiBoYW5kbGUgdGhlCiAgICAgKiBleGNlcHRp\nb24gcHJvcGVybHkuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovIAogICAg\ncHVibGljIGJvb2xlYW4gaWdub3JlU1FMRXhjZXB0aW9uT25TZXRRdWVyeVRp\nbWVvdXQgPSBmYWxzZTsgCiAgICAKICAgIC8qKgogICAgICogSWYgYSBuYXRp\ndmUgcXVlcnkgYmVnaW5zIHdpdGggYW55IG9mIHRoZSB2YWx1ZXMgZm91bmQg\naGVyZSB0aGVuIGl0IHdpbGwKICAgICAqIGJlIHRyZWF0ZWQgYXMgYSBzZWxl\nY3Qgc3RhdGVtZW50LiAgCiAgICAgKi8KICAgIHByb3RlY3RlZCBmaW5hbCBT\nZXQgc2VsZWN0V29yZFNldCA9IG5ldyBIYXNoU2V0KCk7CgogICAgLy8gd2hl\nbiB3ZSBzdG9yZSB2YWx1ZXMgdGhhdCBsb3NlIHByZWNpb24sIHRyYWNrIHRo\nZSB0eXBlcyBzbyB0aGF0IHRoZQogICAgLy8gZmlyc3QgdGltZSBpdCBoYXBw\nZW5zIHdlIGNhbiB3YXJuIHRoZSB1c2VyCiAgICBwcml2YXRlIFNldCBfcHJl\nY2lzaW9uV2FybmVkVHlwZXMgPSBudWxsOwoKICAgIC8vIGNhY2hlIGxvYiBt\nZXRob2RzCiAgICBwcml2YXRlIE1ldGhvZCBfc2V0Qnl0ZXMgPSBudWxsOwog\nICAgcHJpdmF0ZSBNZXRob2QgX3NldFN0cmluZyA9IG51bGw7CiAgICBwcml2\nYXRlIE1ldGhvZCBfc2V0Q2hhclN0cmVhbSA9IG51bGw7CgogICAgcHVibGlj\nIERCRGljdGlvbmFyeSgpIHsKICAgICAgICBmaXhlZFNpemVUeXBlTmFtZVNl\ndC5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAg\nICAgICJCSUdJTlQiLCAiQklUIiwgIkJMT0IiLCAiQ0xPQiIsICJEQVRFIiwg\nIkRFQ0lNQUwiLCAiRElTVElOQ1QiLAogICAgICAgICAgICAiRE9VQkxFIiwg\nIkZMT0FUIiwgIklOVEVHRVIiLCAiSkFWQV9PQkpFQ1QiLCAiTlVMTCIsICJO\nVU1FUklDIiwKICAgICAgICAgICAgIk9USEVSIiwgIlJFQUwiLCAiUkVGIiwg\nIlNNQUxMSU5UIiwgIlNUUlVDVCIsICJUSU1FIiwgIlRJTUVTVEFNUCIsCiAg\nICAgICAgICAgICJUSU5ZSU5UIiwKICAgICAgICB9KSk7CiAgICAgICAgCiAg\nICAgICAgc2VsZWN0V29yZFNldC5hZGQoIlNFTEVDVCIpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4gdGhlIGRp\nY3Rpb25hcnkgZmlyc3Qgc2VlcyBhbnkgY29ubmVjdGlvbi4KICAgICAqIEl0\nIGlzIHVzZWQgdG8gaW5pdGlhbGl6ZSBkaWN0aW9uYXJ5IG1ldGFkYXRhIGlm\nIG5lZWRlZC4gSWYgeW91CiAgICAgKiBvdmVycmlkZSB0aGlzIG1ldGhvZCwg\nYmUgc3VyZSB0byBjYWxsCiAgICAgKiA8Y29kZT5zdXBlci5jb25uZWN0ZWRD\nb25maWd1cmF0aW9uPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nY29ubmVjdGVkQ29uZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhRGF0YSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgbWV0YURhdGEgPSBjb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAg\nIC8vIEpEQkMzLW9ubHkgbWV0aG9kLCBzbyBpdCBtaWdodCB0aHJvdyBhCiAg\nICAgICAgICAgIC8vIEFic3RyYWN0TWV0aG9kRXJyb3IKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGlzSkRCQzMgPSBtZXRhRGF0YS5nZXRK\nREJDTWFqb3JWZXJzaW9uKCkgPj0gMzsKICAgICAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBpZiBu\nb3QgSkRCQzMKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShlLnRvU3RyaW5nKCksIGUp\nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAobG9nLmlzVHJhY2VF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgbG9nLnRyYWNlKERCRGljdGlvbmFy\neUZhY3RvcnkudG9TdHJpbmcobWV0YURhdGEpKTsKICAgICAgICAgICAgaWYg\nKGlzSkRCQzMpCiAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQo\nImNvbm5lY3Rpb24tZGVmYXVsdHMiLCBuZXcgT2JqZWN0W117CiAgICAgICAg\nICAgICAgICAgICAgICAgIG5ldyBCb29sZWFuKGNvbm4uZ2V0QXV0b0NvbW1p\ndCgpKSwgCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJbnRlZ2VyKGNv\nbm4uZ2V0SG9sZGFiaWxpdHkoKSksCiAgICAgICAgICAgICAgICAgICAgICAg\nIG5ldyBJbnRlZ2VyKGNvbm4uZ2V0VHJhbnNhY3Rpb25Jc29sYXRpb24oKSl9\nKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbm5lY3RlZCA9IHRy\ndWU7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8g\nUmVzdWx0U2V0IHdyYXBwZXJzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIEFycmF5IGdldEFycmF5KFJl\nc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QXJyYXkoY29sdW1uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0g\nZ2V0QXNjaWlTdHJlYW0oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5n\nZXRBc2NpaVN0cmVhbShjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBCaWdEZWNpbWFsIGdldEJpZ0RlY2ltYWwoUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykgewog\nICAgICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJzLCBjb2x1bW4p\nOwogICAgICAgICAgICByZXR1cm4gKHN0ciA9PSBudWxsKSA/IG51bGwgOiBu\nZXcgQmlnRGVjaW1hbChzdHIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ncnMuZ2V0QmlnRGVjaW1hbChjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJucyB0aGUgc3BlY2lmaWVkIGNvbHVtbiB2YWx1ZSBhcyBhbiB1\nbmtub3duIG51bWVyaWMgdHlwZTsKICAgICAqIHdlIHRyeSBmcm9tIHRoZSBt\nb3N0IGdlbmVyaWMgdG8gdGhlIGxlYXN0IGdlbmVyaWMuCiAgICAgKi8KICAg\nIHB1YmxpYyBOdW1iZXIgZ2V0TnVtYmVyKFJlc3VsdFNldCBycywgaW50IGNv\nbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAv\nLyB0cnkgZnJvbSB0aGUgbW9zdCBnZW5lcmljLCBhbmQgaWYgZXJyb3JzIG9j\nY3VyLCB0cnkKICAgICAgICAvLyBsZXNzIGdlbmVyaWMgdHlwZXM7IHRoaXMg\nZW5hYmxlcyB1cyB0byBoYW5kbGUgdmFsdWVzCiAgICAgICAgLy8gbGlrZSBE\nb3VibGUuTmFOIHdpdGhvdXQgaGF2aW5nIHRvIGludHJvc3BlY3Qgb24gdGhl\nCiAgICAgICAgLy8gUmVzdWx0U2V0TWV0YURhdGEgKGJ1ZyAjMTA1MykuIG5v\ndGUgdGhhdCB3ZSBoYW5kbGUKICAgICAgICAvLyBnZW5lcmljIGV4Y2VwdGlv\nbnMsIHNpbmNlIHNvbWUgZHJpdmVycyBtYXkgdGhyb3cKICAgICAgICAvLyBO\ndW1iZXJGb3JtYXRFeGNlcHRpb25zLCB3aGVyZWFzIG90aGVycyBtYXkgdGhy\nb3cgU1FMRXhjZXB0aW9ucwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBnZXRCaWdEZWNpbWFsKHJzLCBjb2x1bW4pOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlMSkgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoZ2V0RG91YmxlKHJzLCBjb2x1\nbW4pKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUyKSB7CiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgRmxvYXQoZ2V0RmxvYXQocnMsIGNvbHVtbikpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUzKSB7CiAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE51\nbWJlcnMudmFsdWVPZihnZXRMb25nKHJzLCBjb2x1bW4pKTsKICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZ2V0SW50KHJzLCBjb2x1bW4p\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGU1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChlMSBpbnN0YW5jZW9mIFJ1bnRpbWVFeGNlcHRpb24p\nCiAgICAgICAgICAgICAgICB0aHJvdyhSdW50aW1lRXhjZXB0aW9uKSBlMTsK\nICAgICAgICAgICAgaWYgKGUxIGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQog\nICAgICAgICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSBlMTsKICAgICAg\nICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBCaWdJbnRlZ2VyIGdldEJpZ0ludGVnZXIoUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykg\newogICAgICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJzLCBjb2x1\nbW4pOwogICAgICAgICAgICByZXR1cm4gKHN0ciA9PSBudWxsKSA/IG51bGwg\nOiBuZXcgQmlnRGVjaW1hbChzdHIpLnRvQmlnSW50ZWdlcigpOwogICAgICAg\nIH0KICAgICAgICBCaWdEZWNpbWFsIGJkID0gZ2V0QmlnRGVjaW1hbChycywg\nY29sdW1uKTsKICAgICAgICByZXR1cm4gKGJkID09IG51bGwpID8gbnVsbCA6\nIGJkLnRvQmlnSW50ZWdlcigpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRCaW5hcnlTdHJlYW0oUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBycy5nZXRCaW5hcnlTdHJlYW0oY29sdW1uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQmxvYiBnZXRCbG9i\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QmxvYihjb2x1bW4p\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0\nQmxvYk9iamVjdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIEpEQkNTdG9y\nZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBJbnB1dFN0cmVhbSBpbiA9IG51bGw7CiAgICAgICAgaWYgKHVzZUdldEJ5\ndGVzRm9yQmxvYnMgfHwgdXNlR2V0T2JqZWN0Rm9yQmxvYnMpIHsKICAgICAg\nICAgICAgYnl0ZVtdIGJ5dGVzID0gZ2V0Qnl0ZXMocnMsIGNvbHVtbik7CiAg\nICAgICAgICAgIGlmIChieXRlcyAhPSBudWxsICYmIGJ5dGVzLmxlbmd0aCA+\nIDApCiAgICAgICAgICAgICAgICBpbiA9IG5ldyBCeXRlQXJyYXlJbnB1dFN0\ncmVhbShieXRlcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgQmxv\nYiBibG9iID0gZ2V0QmxvYihycywgY29sdW1uKTsKICAgICAgICAgICAgaWYg\nKGJsb2IgIT0gbnVsbCAmJiBibG9iLmxlbmd0aCgpID4gMCkKICAgICAgICAg\nICAgICAgIGluID0gYmxvYi5nZXRCaW5hcnlTdHJlYW0oKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKGluID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoc3RvcmUgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRl\nc2VyaWFsaXplKGluLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuIFNlcmlh\nbGl6YXRpb24uZGVzZXJpYWxpemUoaW4sIHN0b3JlLmdldENvbnRleHQoKSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGluLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElP\nRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEJvb2xl\nYW4oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCb29sZWFuKGNv\nbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9w\nZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJ5dGUg\nZ2V0Qnl0ZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJ5dGUo\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgYnl0\nZVtdIGdldEJ5dGVzKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlR2V0Qnl0\nZXNGb3JCbG9icykKICAgICAgICAgICAgcmV0dXJuIHJzLmdldEJ5dGVzKGNv\nbHVtbik7CiAgICAgICAgaWYgKHVzZUdldE9iamVjdEZvckJsb2JzKQogICAg\nICAgICAgICByZXR1cm4gKGJ5dGVbXSkgcnMuZ2V0T2JqZWN0KGNvbHVtbik7\nCgogICAgICAgIEJsb2IgYmxvYiA9IGdldEJsb2IocnMsIGNvbHVtbik7CiAg\nICAgICAgaWYgKGJsb2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgaW50IGxlbmd0aCA9IChpbnQpIGJsb2IubGVuZ3RoKCk7\nCiAgICAgICAgaWYgKGxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICByZXR1cm4gYmxvYi5nZXRCeXRlcygxLCBsZW5ndGgp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuIENvbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7QGxp\nbmsgVGltZXN0YW1wfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMg\nQ2FsZW5kYXIgZ2V0Q2FsZW5kYXIoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIERhdGUg\nZCA9IGdldERhdGUocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGQgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENhbGVuZGFy\nIGNhbCA9IENhbGVuZGFyLmdldEluc3RhbmNlKCk7CiAgICAgICAgY2FsLnNl\ndFRpbWUoZCk7CiAgICAgICAgcmV0dXJuIGNhbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgY2hhciBnZXRDaGFyKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoc3RvcmVDaGFyc0FzTnVtYmVycykKICAgICAgICAgICAgcmV0\ndXJuIChjaGFyKSBnZXRJbnQocnMsIGNvbHVtbik7CgogICAgICAgIFN0cmlu\nZyBzdHIgPSBnZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgcmV0dXJu\nIChTdHJpbmdVdGlscy5pc0VtcHR5KHN0cikpID8gMCA6IHN0ci5jaGFyQXQo\nMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFJlYWRlciBn\nZXRDaGFyYWN0ZXJTdHJlYW0oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBy\ncy5nZXRDaGFyYWN0ZXJTdHJlYW0oY29sdW1uKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgQ2xvYiBnZXRDbG9iKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gcnMuZ2V0Q2xvYihjb2x1bW4pOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUg\nU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhSZXN1\nbHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHVzZUdldFN0cmluZ0ZvckNsb2JzKQogICAg\nICAgICAgICByZXR1cm4gcnMuZ2V0U3RyaW5nKGNvbHVtbik7CgogICAgICAg\nIENsb2IgY2xvYiA9IGdldENsb2IocnMsIGNvbHVtbik7CiAgICAgICAgaWYg\nKGNsb2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKGNsb2IubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nICIiOwoKICAgICAgICAvLyB1bmxpa2VseSB0aGF0IHdlJ2xsIGhhdmUgc3Ry\naW5ncyBvdmVyIEludGVnZXIuTUFYX1ZBTFVFIGNoYXJzCiAgICAgICAgcmV0\ndXJuIGNsb2IuZ2V0U3ViU3RyaW5nKDEsIChpbnQpIGNsb2IubGVuZ3RoKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVk\nIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAg\nICAgKiBqYXZhIHR5cGUuIENvbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7QGxp\nbmsgVGltZXN0YW1wfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMg\nRGF0ZSBnZXREYXRlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBUaW1lc3RhbXAgdHN0\nYW1wID0gZ2V0VGltZXN0YW1wKHJzLCBjb2x1bW4sIG51bGwpOwogICAgICAg\nIGlmICh0c3RhbXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIC8vIGdldCB0aGUgZnJhY3Rpb25hbCBzZWNvbmRzIGNvbXBv\nbmVudCwgcm91bmRpbmcgYXdheSBhbnl0aGluZyBiZXlvbmQKICAgICAgICAv\nLyBtaWxsaXNlY29uZHMKICAgICAgICBpbnQgZnJhY3Rpb25hbCA9IChpbnQp\nIE1hdGgucm91bmQodHN0YW1wLmdldE5hbm9zKCkgLyAoZG91YmxlKSBNSUxM\nSSk7CgogICAgICAgIC8vIGdldCB0aGUgbWlsbGlzIGNvbXBvbmVudDsgc29t\nZSBKREJDIGRyaXZlcnMgcm91bmQgdGhpcyB0byB0aGUKICAgICAgICAvLyBu\nZWFyZXN0IHNlY29uZCwgd2hpbGUgb3RoZXJzIGRvIG5vdAogICAgICAgIGxv\nbmcgbWlsbGlzID0gKHRzdGFtcC5nZXRUaW1lKCkgLyAxMDAwTCkgKiAxMDAw\nTDsKICAgICAgICByZXR1cm4gbmV3IERhdGUobWlsbGlzICsgZnJhY3Rpb25h\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGphdmEuc3Fs\nLkRhdGUgZ2V0RGF0ZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENhbGVu\nZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5nZXRE\nYXRlKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldERhdGUoY29sdW1u\nLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3Bl\nY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJv\ncGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBkb3Vi\nbGUgZ2V0RG91YmxlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0\nRG91YmxlKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0\nIHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRv\nIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIGZsb2F0IGdldEZsb2F0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\ncnMuZ2V0RmxvYXQoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRT\nZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgaW50IGdldEludChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIHJzLmdldEludChjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBMb2NhbGUgZ2V0TG9jYWxlKFJlc3VsdFNldCBycywgaW50IGNv\nbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBT\ndHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJzLCBjb2x1bW4pOwogICAgICAgIGlm\nIChTdHJpbmdVdGlscy5pc0VtcHR5KHN0cikpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICBTdHJpbmdbXSBwYXJhbXMgPSBTdHJpbmdzLnNw\nbGl0KHN0ciwgIl8iLCAzKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA8\nIDMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBu\nZXcgTG9jYWxlKHBhcmFtc1swXSwgcGFyYW1zWzFdLCBwYXJhbXNbMl0pOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNv\nbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAg\nKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBsb25nIGdldExvbmco\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRMb25nKGNvbHVtbik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRP\nYmplY3QoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChtYXAgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldE9iamVjdChjb2x1bW4p\nOwogICAgICAgIHJldHVybiBycy5nZXRPYmplY3QoY29sdW1uLCBtYXApOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNv\nbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAg\nKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBSZWYgZ2V0UmVmKFJl\nc3VsdFNldCBycywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0UmVmKGNv\nbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9w\nZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIHNob3J0\nIGdldFNob3J0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0U2hv\ncnQoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJz\nLmdldFN0cmluZyhjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNl\ndCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBUaW1lIGdldFRpbWUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1u\nLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ncnMuZ2V0VGltZShjb2x1bW4pOwogICAgICAgIHJldHVybiBycy5nZXRUaW1l\nKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8g\ndGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJs\naWMgVGltZXN0YW1wIGdldFRpbWVzdGFtcChSZXN1bHRTZXQgcnMsIGludCBj\nb2x1bW4sIENhbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBycy5nZXRUaW1lc3RhbXAoY29sdW1uKTsKICAgICAgICByZXR1cm4g\ncnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByZXBhcmVkU3Rh\ndGVtZW50IHdyYXBwZXJzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMg\nYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0QXJyYXkoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGlu\ndCBpZHgsIEFycmF5IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEFycmF5\nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0QXNjaWlTdHJlYW0oUHJlcGFyZWRT\ndGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAgICAgSW5wdXRTdHJlYW0g\ndmFsLCBpbnQgbGVuZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEFzY2lpU3RyZWFtKGlk\neCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdEZWNpbWFsKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCaWdEZWNpbWFsIHZhbCwK\nICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0\naWJsZShUeXBlcy5WQVJDSEFSLCBudWxsLCAwLCAwKSkKICAgICAgICAgICAg\nfHwgKGNvbCA9PSBudWxsICYmIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdz\nKSkKICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC50b1N0\ncmluZygpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQu\nc2V0QmlnRGVjaW1hbChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpZ0ludGVn\nZXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEJpZ0ludGVn\nZXIgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBjb2wu\naXNDb21wYXRpYmxlKFR5cGVzLlZBUkNIQVIsIG51bGwsIDAsIDApKQogICAg\nICAgICAgICB8fCAoY29sID09IG51bGwgJiYgc3RvcmVMYXJnZU51bWJlcnNB\nc1N0cmluZ3MpKQogICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwg\ndmFsLnRvU3RyaW5nKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKHZh\nbCksIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpbmFyeVN0cmVhbShQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwKICAgICAgICBJbnB1dFN0cmVhbSB2\nYWwsIGludCBsZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QmluYXJ5U3RyZWFtKGlk\neCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCbG9iKFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBCbG9iIHZhbCwgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5z\nZXRCbG9iKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0\naGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVu\ndC4gVXNlcyB0aGUKICAgICAqIHtAbGluayAjc2VyaWFsaXplfSBtZXRob2Qg\ndG8gc2VyaWFsaXplIHRoZSB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0QmxvYk9iamVjdChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29sLCBKREJDU3Rv\ncmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc2V0Qnl0ZXMoc3RtbnQsIGlkeCwgc2VyaWFsaXplKHZhbCwgc3RvcmUp\nLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRCb29sZWFuKFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50LCBpbnQgaWR4LCBib29sZWFuIHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldEludChpZHgsICh2YWwpID8gMSA6IDApOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0\nbyB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRC\neXRlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBieXRlIHZh\nbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBzdG1udC5zZXRCeXRlKGlkeCwgdmFsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIg\ndG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQnl0ZXMoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGJ5dGVb\nXSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlU2V0Qnl0ZXNGb3JCbG9icykK\nICAgICAgICAgICAgc3RtbnQuc2V0Qnl0ZXMoaWR4LCB2YWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc2V0QmluYXJ5U3RyZWFtKHN0bW50LCBpZHgs\nIG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbSh2YWwpLAogICAgICAgICAgICAg\nICAgdmFsLmxlbmd0aCwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2hhcihQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgY2hhciB2YWwsIENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxlKFR5cGVzLklOVEVH\nRVIsIG51bGwsIDAsIDApKQogICAgICAgICAgICB8fCAoY29sID09IG51bGwg\nJiYgc3RvcmVDaGFyc0FzTnVtYmVycykpCiAgICAgICAgICAgIHNldEludChz\ndG1udCwgaWR4LCAoaW50KSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgU3RyaW5nLnZhbHVlT2Yo\ndmFsKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LAogICAgICAgIFJlYWRlciB2\nYWwsIGludCBsZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0Q2hhcmFjdGVyU3RyZWFt\nKGlkeCwgdmFsLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVt\nZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDbG9iKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBDbG9iIHZhbCwgQ29sdW1uIGNv\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1u\ndC5zZXRDbG9iKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2xvYlN0cmluZyhQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwK\nICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmICh1c2VTZXRTdHJpbmdGb3JDbG9icykKICAgICAg\nICAgICAgc3RtbnQuc2V0U3RyaW5nKGlkeCwgdmFsKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgLy8gc2V0IHJlYWRlciBmcm9tIHN0cmluZwogICAg\nICAgICAgICBTdHJpbmdSZWFkZXIgaW4gPSBuZXcgU3RyaW5nUmVhZGVyKHZh\nbCk7CiAgICAgICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwgaWR4\nLCBpbiwgdmFsLmxlbmd0aCgpLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0RGF0ZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgRGF0\nZSB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBlKCkg\nPT0gVHlwZXMuREFURSkKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4\nLCBuZXcgamF2YS5zcWwuRGF0ZSh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29s\nKTsKICAgICAgICBlbHNlIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlw\nZSgpID09IFR5cGVzLlRJTUUpCiAgICAgICAgICAgIHNldFRpbWUoc3RtbnQs\nIGlkeCwgbmV3IFRpbWUodmFsLmdldFRpbWUoKSksIG51bGwsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgVGltZXN0YW1wKQogICAg\nICAgICAgICBzZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwoVGltZXN0YW1wKSB2\nYWwsIG51bGwsIGNvbCk7ICAgCiAgICAgICAgZWxzZQogICAgICAgICAgICBz\nZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwgbmV3IFRpbWVzdGFtcCh2YWwuZ2V0\nVGltZSgpKSwgbnVsbCwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0ZShQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgamF2YS5zcWwuRGF0ZSB2YWws\nCiAgICAgICAgQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkK\nICAgICAgICAgICAgc3RtbnQuc2V0RGF0ZShpZHgsIHZhbCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzdG1udC5zZXREYXRlKGlkeCwgdmFsLCBjYWwp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBh\ncyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRDYWxlbmRhcihQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgQ2FsZW5kYXIgdmFsLAogICAgICAgIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYnkg\nZGVmYXVsdCB3ZSBtZXJlbHkgZGVsZWdhdGUgdGhlIHRoZSBEYXRlIHBhcmFt\nZXRlcgogICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgdmFsLmdldFRpbWUo\nKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ndmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0RG91YmxlKFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50LCBpbnQgaWR4LCBkb3VibGUgdmFsLAogICAgICAgIENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3Rt\nbnQuc2V0RG91YmxlKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RmxvYXQoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGZsb2F0IHZhbCwKICAg\nICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldEZsb2F0KGlkeCwgdmFsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0SW50KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQg\ndmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldEludChpZHgsIHZhbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndExvbmcoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGxvbmcg\ndmFsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldExvbmcoaWR4LCB2YWwpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRl\nciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRMb2NhbGUoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIExv\nY2FsZSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwg\ndmFsLmdldExhbmd1YWdlKCkgKyAiXyIgKyB2YWwuZ2V0Q291bnRyeSgpCiAg\nICAgICAgICAgICsgIl8iICsgdmFsLmdldFZhcmlhbnQoKSwgY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXJzIHRvIHRoZSBzdGF0ZW1lbnQuIFRoZSBjb2x1bW4KICAgICAq\nIHR5cGUgd2lsbCBjb21lIGZyb20ge0BsaW5rIFR5cGVzfS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgaW50IGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5z\nZXROdWxsKGlkeCwgY29sVHlwZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE51bWJlcihQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgTnVtYmVyIG51bSwKICAg\nICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIC8vIGNoZWNrIGZvciBrbm93biBmbG9hdGluZyBwb2ludCB0\neXBlcyB0byBnaXZlIGRyaXZlciBhIGNoYW5jZSB0bwogICAgICAgIC8vIGhh\nbmRsZSBzcGVjaWFsIG51bWJlcnMgbGlrZSBOYU4gYW5kIGluZmluaXR5OyBi\ndWcgIzEwNTMKICAgICAgICBpZiAobnVtIGluc3RhbmNlb2YgRG91YmxlKQog\nICAgICAgICAgICBzZXREb3VibGUoc3RtbnQsIGlkeCwgKChEb3VibGUpIG51\nbSkuZG91YmxlVmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmIChudW0g\naW5zdGFuY2VvZiBGbG9hdCkKICAgICAgICAgICAgc2V0RmxvYXQoc3RtbnQs\nIGlkeCwgKChGbG9hdCkgbnVtKS5mbG9hdFZhbHVlKCksIGNvbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgs\nIG5ldyBCaWdEZWNpbWFsKG51bS50b1N0cmluZygpKSwgY29sKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXJzIHRvIHRoZSBzdGF0ZW1lbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5\ncGUgd2lsbCBjb21lIGZyb20ge0BsaW5rIFR5cGVzfS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0T2JqZWN0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIGludCBjb2xUeXBlLCBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChjb2xUeXBlID09IC0xIHx8IGNvbFR5cGUgPT0gVHlwZXMuT1RI\nRVIpCiAgICAgICAgICAgIHN0bW50LnNldE9iamVjdChpZHgsIHZhbCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXRPYmplY3QoaWR4LCB2\nYWwsIGNvbFR5cGUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZWYoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIFJlZiB2YWwsIENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0UmVm\nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0U2hvcnQoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIHNob3J0IHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldFNob3J0KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3RyaW5nKFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBTdHJpbmcgdmFsLAog\nICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0U3RyaW5nKGlkeCwgdmFsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJh\nbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0VGltZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwg\nVGltZSB2YWwsCiAgICAgICAgQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjYWwg\nPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQuc2V0VGltZShpZHgsIHZhbCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG1udC5zZXRUaW1lKGlkeCwg\ndmFsLCBjYWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZl\nbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1lc3RhbXAoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsCiAgICAgICAgVGltZXN0YW1wIHZhbCwg\nQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIC8vIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBp\nbnNlcnQgZGF0ZXMgYXQgYSBncmVhdGVyIHByZWNpc2lvbiB0aGFuCiAgICAg\nICAgLy8gdGhhdCBhdCB3aGljaCB0aGV5IHdpbGwgYmUgcmV0dXJuZWQgYnkg\nYSBTRUxFQ1QKICAgICAgICBpbnQgcm91bmRlZCA9IChpbnQpIE1hdGgucm91\nbmQodmFsLmdldE5hbm9zKCkgLwogICAgICAgICAgICAoZG91YmxlKSBkYXRl\nUHJlY2lzaW9uKTsKICAgICAgICBpbnQgbmFub3MgPSByb3VuZGVkICogZGF0\nZVByZWNpc2lvbjsKICAgICAgICBpZiAobmFub3MgPiA5OTk5OTk5OTkpIHsK\nICAgICAgICAgICAgLy8gcm9sbG92ZXIgdG8gbmV4dCBzZWNvbmQKICAgICAg\nICAgICAgdmFsLnNldFRpbWUodmFsLmdldFRpbWUoKSArIDEwMDApOwogICAg\nICAgICAgICBuYW5vcyA9IDA7CiAgICAgICAgfQoKICAgICAgICB2YWwuc2V0\nTmFub3MobmFub3MpOwoKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAg\nICAgICAgIHN0bW50LnNldFRpbWVzdGFtcChpZHgsIHZhbCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzdG1udC5zZXRUaW1lc3RhbXAoaWR4LCB2YWws\nIGNhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYSBjb2x1bW4gdmFs\ndWUgaW50byBhIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gc3RtbnQgdGhlIHByZXBhcmVkIHN0YXRlbWVudCB0byBwYXJhbWV0\nZXJpemUKICAgICAqIEBwYXJhbSBpZHggdGhlIGluZGV4IG9mIHRoZSBwYXJh\nbWV0ZXIgaW4gdGhlIHByZXBhcmVkIHN0YXRlbWVudAogICAgICogQHBhcmFt\nIHZhbCB0aGUgdmFsdWUgb2YgdGhlIGNvbHVtbgogICAgICogQHBhcmFtIGNv\nbCB0aGUgY29sdW1uIGJlaW5nIHNldAogICAgICogQHBhcmFtIHR5cGUgdGhl\nIGZpZWxkIG1hcHBpbmcgdHlwZSBjb2RlIGZvciB0aGUgdmFsdWUKICAgICAq\nIEBwYXJhbSBzdG9yZSB0aGUgc3RvcmUgbWFuYWdlciBmb3IgdGhlIGN1cnJl\nbnQgY29udGV4dAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlZChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwK\nICAgICAgICBDb2x1bW4gY29sLCBpbnQgdHlwZSwgSkRCQ1N0b3JlIHN0b3Jl\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCkgewogICAgICAgICAgICBzZXROdWxsKHN0bW50LCBpZHgs\nIChjb2wgPT0gbnVsbCkgPyBUeXBlcy5PVEhFUiA6IGNvbC5nZXRUeXBlKCks\nCiAgICAgICAgICAgICAgICBjb2wpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICBTaXplZCBzOwogICAgICAgIENhbGVuZGFyZCBj\nOwogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQs\nIGlkeCwgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JK\nOgogICAgICAgICAgICAgICAgc2V0Qnl0ZShzdG1udCwgaWR4LCAoKE51bWJl\ncikgdmFsKS5ieXRlVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAg\nIHNldENoYXIoc3RtbnQsIGlkeCwgKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZh\nbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgc2V0RG91Ymxl\nKHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUX09CSjoKICAgICAgICAgICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgs\nICgoTnVtYmVyKSB2YWwpLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAg\nICAgICAgICBzZXRJbnQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuaW50\nVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIHNldExvbmcoc3Rt\nbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU0hPUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09C\nSjoKICAgICAgICAgICAgICAgIHNldFNob3J0KHN0bW50LCBpZHgsICgoTnVt\nYmVyKSB2YWwpLnNob3J0VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAg\nICAgICAgICAgICAgICBpZiAoY29sICE9IG51bGwgJiYgKGNvbC5nZXRUeXBl\nKCkgPT0gVHlwZXMuQ0xPQgogICAgICAgICAgICAgICAgICAgIHx8IGNvbC5n\nZXRUeXBlKCkgPT0gVHlwZXMuTE9OR1ZBUkNIQVIpKQogICAgICAgICAgICAg\nICAgICAgIHNldENsb2JTdHJpbmcoc3RtbnQsIGlkeCwgKFN0cmluZykgdmFs\nLCBjb2wpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgc2V0QmxvYk9iamVjdChz\ndG1udCwgaWR4LCB2YWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAg\nICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChEYXRlKSB2YWwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAgICAgICBzZXRDYWxlbmRh\ncihzdG1udCwgaWR4LCAoQ2FsZW5kYXIpIHZhbCwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdE\nRUNJTUFMOgogICAgICAgICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwg\naWR4LCAoQmlnRGVjaW1hbCkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6\nCiAgICAgICAgICAgICAgICBzZXRCaWdJbnRlZ2VyKHN0bW50LCBpZHgsIChC\naWdJbnRlZ2VyKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAg\nICAgICAgc2V0TnVtYmVyKHN0bW50LCBpZHgsIChOdW1iZXIpIHZhbCwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAgICBzZXRMb2NhbGUoc3Rt\nbnQsIGlkeCwgKExvY2FsZSkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJB\nWToKICAgICAgICAgICAgICAgIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJh\neSkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAg\nICAgICAgIHMgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldEFz\nY2lpU3RyZWFtKHN0bW50LCBpZHgsIChJbnB1dFN0cmVhbSkgcy52YWx1ZSwg\ncy5zaXplLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJJTkFSWV9TVFJFQU06CiAgICAgICAg\nICAgICAgICBzID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAgICAgICBzZXRC\naW5hcnlTdHJlYW0oc3RtbnQsIGlkeCwgKElucHV0U3RyZWFtKSBzLnZhbHVl\nLCBzLnNpemUsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQkxPQjoKICAgICAgICAgICAgICAg\nIHNldEJsb2Ioc3RtbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5CWVRFUzoKICAgICAgICAgICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgs\nIChieXRlW10pIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5DSEFSX1NUUkVBTToKICAg\nICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAg\nIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwgaWR4LCAoUmVhZGVyKSBzLnZh\nbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAg\nICAgIHNldENsb2Ioc3RtbnQsIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxU\neXBlcy5TUUxfREFURToKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFu\nY2VvZiBDYWxlbmRhcmQpIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENh\nbGVuZGFyZCkgdmFsOwogICAgICAgICAgICAgICAgICAgIHNldERhdGUoc3Rt\nbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIGMudmFsdWUsIGMuY2FsZW5kYXIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXREYXRlKHN0bW50LCBp\nZHgsIChqYXZhLnNxbC5EYXRlKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMu\nUkVGOgogICAgICAgICAgICAgICAgc2V0UmVmKHN0bW50LCBpZHgsIChSZWYp\nIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFTUUxUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgaWYg\nKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyZCkgewogICAgICAgICAgICAgICAg\nICAgIGMgPSAoQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAgICAgICAgICAg\nc2V0VGltZShzdG1udCwgaWR4LCAoVGltZSkgYy52YWx1ZSwgYy5jYWxlbmRh\nciwgY29sKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAg\nICAgICAgIHNldFRpbWUoc3RtbnQsIGlkeCwgKFRpbWUpIHZhbCwgbnVsbCwg\nY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFTUUxUeXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAgICAgICBpZiAo\ndmFsIGluc3RhbmNlb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgICAgICAg\nICAgYyA9IChDYWxlbmRhcmQpIHZhbDsKICAgICAgICAgICAgICAgICAgICBz\nZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwgKFRpbWVzdGFtcCkgYy52YWx1ZSwg\nYy5jYWxlbmRhciwKICAgICAgICAgICAgICAgICAgICAgICAgY29sKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRp\nbWVzdGFtcChzdG1udCwgaWR4LCAoVGltZXN0YW1wKSB2YWwsIG51bGwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiAoY29sLmdl\ndFR5cGUoKSA9PSBUeXBlcy5CTE9CCiAgICAgICAgICAgICAgICAgICAgfHwg\nY29sLmdldFR5cGUoKSA9PSBUeXBlcy5WQVJCSU5BUlkpKQogICAgICAgICAg\nICAgICAgICAgIHNldEJsb2JPYmplY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2ws\nIHN0b3JlKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBzZXRPYmplY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wuZ2V0VHlwZSgp\nLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCBh\nIGNvbXBsZXRlbHkgdW5rbm93biBwYXJhbWV0ZXIgaW50byBhIHByZXBhcmVk\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VW5rbm93\nbihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZh\nbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIFNpemVkIHNpemVkID0gbnVsbDsKICAgICAgICBD\nYWxlbmRhcmQgY2FsZCA9IG51bGw7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5j\nZW9mIFNpemVkKSB7CiAgICAgICAgICAgIHNpemVkID0gKFNpemVkKSB2YWw7\nCiAgICAgICAgICAgIHZhbCA9IHNpemVkLnZhbHVlOwogICAgICAgIH0gZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAg\nIGNhbGQgPSAoQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAgIHZhbCA9IGNh\nbGQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsID09IG51bGwp\nCiAgICAgICAgICAgIHNldE51bGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxs\nKSA/IFR5cGVzLk9USEVSIDogY29sLmdldFR5cGUoKSwKICAgICAgICAgICAg\nICAgIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgU3Ry\naW5nKQogICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRv\nU3RyaW5nKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNl\nb2YgSW50ZWdlcikKICAgICAgICAgICAgc2V0SW50KHN0bW50LCBpZHgsICgo\nSW50ZWdlcikgdmFsKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIEJvb2xlYW4pCiAgICAgICAgICAgIHNldEJv\nb2xlYW4oc3RtbnQsIGlkeCwgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1\nZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIExv\nbmcpCiAgICAgICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChMb25nKSB2\nYWwpLmxvbmdWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIEZsb2F0KQogICAgICAgICAgICBzZXRGbG9hdChzdG1udCwg\naWR4LCAoKEZsb2F0KSB2YWwpLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAg\nIHNldERvdWJsZShzdG1udCwgaWR4LCAoKERvdWJsZSkgdmFsKS5kb3VibGVW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIEJ5dGUpCiAgICAgICAgICAgIHNldEJ5dGUoc3RtbnQsIGlkeCwgKChCeXRl\nKSB2YWwpLmJ5dGVWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZh\nbCBpbnN0YW5jZW9mIENoYXJhY3RlcikKICAgICAgICAgICAgc2V0Q2hhcihz\ndG1udCwgaWR4LCAoKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29s\nKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBTaG9ydCkKICAg\nICAgICAgICAgc2V0U2hvcnQoc3RtbnQsIGlkeCwgKChTaG9ydCkgdmFsKS5z\naG9ydFZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3Rh\nbmNlb2YgTG9jYWxlKQogICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlk\neCwgKExvY2FsZSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIEJpZ0RlY2ltYWwpCiAgICAgICAgICAgIHNldEJpZ0RlY2lt\nYWwoc3RtbnQsIGlkeCwgKEJpZ0RlY2ltYWwpIHZhbCwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBCaWdJbnRlZ2VyKQogICAgICAg\nICAgICBzZXRCaWdJbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2\nYWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQXJy\nYXkpCiAgICAgICAgICAgIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkg\ndmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJs\nb2IpCiAgICAgICAgICAgIHNldEJsb2Ioc3RtbnQsIGlkeCwgKEJsb2IpIHZh\nbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBieXRl\nW10pCiAgICAgICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10p\nIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBD\nbG9iKQogICAgICAgICAgICBzZXRDbG9iKHN0bW50LCBpZHgsIChDbG9iKSB2\nYWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgUmVm\nKQogICAgICAgICAgICBzZXRSZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIGphdmEuc3Fs\nLkRhdGUpCiAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEu\nc3FsLkRhdGUpIHZhbCwKICAgICAgICAgICAgICAgIChjYWxkID09IG51bGwp\nID8gbnVsbCA6IGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgVGltZXN0YW1wKQogICAgICAgICAgICBzZXRU\naW1lc3RhbXAoc3RtbnQsIGlkeCwgKFRpbWVzdGFtcCkgdmFsLAogICAgICAg\nICAgICAgICAgKGNhbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRh\nciwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1l\nKQogICAgICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIChUaW1lKSB2YWws\nCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBudWxsKSA/IG51bGwgOiBjYWxk\nLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIERhdGUpCiAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKERh\ndGUpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2Vv\nZiBDYWxlbmRhcikKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAo\nKENhbGVuZGFyKSB2YWwpLmdldFRpbWUoKSwgY29sKTsKICAgICAgICBlbHNl\nIGlmICh2YWwgaW5zdGFuY2VvZiBSZWFkZXIpCiAgICAgICAgICAgIHNldENo\nYXJhY3RlclN0cmVhbShzdG1udCwgaWR4LCAoUmVhZGVyKSB2YWwsCiAgICAg\nICAgICAgICAgICAoc2l6ZWQgPT0gbnVsbCkgPyAwIDogc2l6ZWQuc2l6ZSwg\nY29sKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcGFyYW0iLCB2YWwuZ2V0Q2xhc3Mo\nKSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXJpYWxp\nemVkIGJ5dGVzIGZvciB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBw\ndWJsaWMgYnl0ZVtdIHNlcmlhbGl6ZShPYmplY3QgdmFsLCBKREJDU3RvcmUg\nc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAodmFsIGluc3RhbmNlb2YgU2VyaWFsaXplZERhdGEpCiAgICAg\nICAgICAgIHJldHVybiAoKFNlcmlhbGl6ZWREYXRhKSB2YWwpLmJ5dGVzOwog\nICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9uLnNlcmlhbGl6ZSh2YWwsIHN0\nb3JlLmdldENvbnRleHQoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZv\na2UgdGhlIEpESyAxLjQgPGNvZGU+c2V0Qnl0ZXM8L2NvZGU+IG1ldGhvZCBv\nbiB0aGUgZ2l2ZW4gQkxPQiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHB1dEJ5dGVzKE9iamVjdCBibG9iLCBieXRlW10gZGF0YSkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3NldEJ5dGVz\nID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIF9zZXRCeXRlcyA9IGJsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNldEJ5\ndGVzIiwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5j\nbGFzcywgYnl0ZVtdLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3Jl\nRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGludm9rZVB1dExvYk1ldGhvZChfc2V0Qnl0ZXMsIGJsb2IsCiAgICAgICAg\nICAgIG5ldyBPYmplY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8\nY29kZT5zZXRTdHJpbmc8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xP\nQgogICAgICogb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRT\ndHJpbmcoT2JqZWN0IGNsb2IsIFN0cmluZyBkYXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfc2V0U3RyaW5nID09IG51\nbGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRT\ndHJpbmcgPSBjbG9iLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRTdHJpbmci\nLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNz\nLCBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52\nb2tlUHV0TG9iTWV0aG9kKF9zZXRTdHJpbmcsIGNsb2IsCiAgICAgICAgICAg\nIG5ldyBPYmplY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29k\nZT5zZXRDaGFyYWN0ZXJTdHJlYW08L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2\nZW4KICAgICAqIENMT0Igb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBwdXRDaGFycyhPYmplY3QgY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9zZXRDaGFyU3Ry\nZWFtID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIF9zZXRDaGFyU3RyZWFtID0gY2xvYi5nZXRDbGFzcygpLmdldE1ldGhv\nZAogICAgICAgICAgICAgICAgICAgICgic2V0Q2hhcmFjdGVyU3RyZWFtIiwg\nbmV3IENsYXNzW117IGxvbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIFdyaXRlciB3cml0ZXIgPSAoV3JpdGVyKSBpbnZva2VQdXRMb2JN\nZXRob2QoX3NldENoYXJTdHJlYW0sIGNsb2IsCiAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFMKSB9KTsKICAgICAgICB0cnkg\newogICAgICAgICAgICB3cml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAg\nIHdyaXRlci5mbHVzaCgpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGlvZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGlv\nZS50b1N0cmluZygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnZva2UgdGhlIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRh\ncmdldCB3aXRoIHRoZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBPYmplY3QgaW52b2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRo\nb2QsIE9iamVjdCB0YXJnZXQsCiAgICAgICAgT2JqZWN0W10gYXJncykKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gbWV0aG9kLmludm9rZSh0YXJnZXQsIGFyZ3MpOwog\nICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24gaXRl\nKSB7CiAgICAgICAgICAgIFRocm93YWJsZSB0ID0gaXRlLmdldFRhcmdldEV4\nY2VwdGlvbigpOwogICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4\nY2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikg\ndDsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHQpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXYXJuIHRoYXQgYSBwYXJ0aWN1bGFyIHZhbHVlIGNv\ndWxkIG5vdCBiZSBzdG9yZWQgcHJlY2lzZWx5LgogICAgICogQWZ0ZXIgdGhl\nIGZpcnN0IHdhcm5pbmcgZm9yIGEgcGFydGljdWxhciB0eXBlLCBtZXNzYWdl\ncwogICAgICogd2lsbCBiZSB0dXJuZWQgaW50byB0cmFjZSBtZXNzYWdlcy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3RvcmFnZVdhcm5pbmcoT2Jq\nZWN0IG9yaWcsIE9iamVjdCBjb252ZXJ0ZWQpIHsKICAgICAgICBib29sZWFu\nIHdhcm47CiAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAg\nICAgIGlmIChfcHJlY2lzaW9uV2FybmVkVHlwZXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9wcmVjaXNpb25XYXJuZWRUeXBlcyA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgICAgIHdhcm4gPSBfcHJlY2lzaW9uV2FybmVkVHlwZXMu\nYWRkKG9yaWcuZ2V0Q2xhc3MoKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwgfHwgKHdhcm4gJiYgbG9nLmlzV2Fy\nbkVuYWJsZWQoKSkKICAgICAgICAgICAgfHwgKCF3YXJuICYmIGxvZy5pc1Ry\nYWNlRW5hYmxlZCgpKSkgewogICAgICAgICAgICBNZXNzYWdlIG1zZyA9IF9s\nb2MuZ2V0KCJzdG9yYWdlLXJlc3RyaWN0aW9uIiwgbmV3IE9iamVjdFtdewog\nICAgICAgICAgICAgICAgcGxhdGZvcm0sCiAgICAgICAgICAgICAgICBvcmln\nLAogICAgICAgICAgICAgICAgb3JpZy5nZXRDbGFzcygpLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgIGNvbnZlcnRlZCwKICAgICAgICAgICAgfSk7Cgog\nICAgICAgICAgICBpZiAoc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24obXNnKTsKCiAg\nICAgICAgICAgIGlmICh3YXJuKQogICAgICAgICAgICAgICAgbG9nLndhcm4o\nbXNnKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKG1zZyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLwogICAg\nLy8gVHlwZXMKICAgIC8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVzfSBjb25zdGFudCBmb3IgdGhl\nIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5cGVzfSBvciB7QGxpbmsgSmF2\nYVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAqLwogICAgcHVibGljIGludCBn\nZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2RlLCBib29sZWFuIGxvYikgewog\nICAgICAgIGlmIChsb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChtZXRhVHlw\nZUNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklO\nRzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NU\nUkVBTToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNIQVJf\nU1RSRUFNOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5CTE9CKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTl9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVk\nVHlwZShUeXBlcy5CSVQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJ\nTllJTlQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAg\nICAgIGlmIChzdG9yZUNoYXJzQXNOdW1iZXJzKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLklOVEVHRVIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nQ0hBUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAg\nICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRPVUJMRSk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5SRUFMKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuSU5URUdFUik7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdf\nT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUo\nVHlwZXMuQklHSU5UKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlNN\nQUxMSU5UKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAg\nICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5W\nQVJDSEFSKTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLkJJR0lOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJnZU51\nbWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdl\ndFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5ET1VCTEUpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5OVU1CRVI6CiAgICAgICAgICAgICAg\nICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hB\nUik7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5OVU1FUklDKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FM\nRU5EQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1F\nU1RBTVApOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxfQVJS\nQVk6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShU\neXBlcy5BUlJBWSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJJ\nTkFSWV9TVFJFQU06CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJM\nT0I6CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJZVEVTOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQkxP\nQik7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNMT0I6CiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5DTE9C\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0RBVEU6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5E\nQVRFKTsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuVElNRToKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJ\nTUUpOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5USU1FU1RBTVA6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5USU1FU1RBTVApOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQkxPQik7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVm\nZXJyZWQge0BsaW5rIFR5cGVzfSB0eXBlIGZvciB0aGUgZ2l2ZW4gb25lLiBS\nZXR1cm5zCiAgICAgKiB0aGUgZ2l2ZW4gdHlwZSBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwdWJsaWMgaW50IGdldFByZWZlcnJlZFR5cGUoaW50IHR5cGUp\nIHsKICAgICAgICByZXR1cm4gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgcHJlZmVycmVkIGRhdGFiYXNlIHR5cGUgbmFtZSBmb3Ig\ndGhlIGdpdmVuIGNvbHVtbidzIHR5cGUKICAgICAqIGZyb20ge0BsaW5rIFR5\ncGVzfS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRUeXBlTmFtZShD\nb2x1bW4gY29sKSB7CiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5\nKGNvbC5nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAgcmV0dXJuIGFwcGVu\nZFNpemUoY29sLCBjb2wuZ2V0VHlwZU5hbWUoKSk7CgogICAgICAgIGlmIChj\nb2wuaXNBdXRvQXNzaWduZWQoKSAmJiBhdXRvQXNzaWduVHlwZU5hbWUgIT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBhdXRv\nQXNzaWduVHlwZU5hbWUpOwoKICAgICAgICByZXR1cm4gYXBwZW5kU2l6ZShj\nb2wsIGdldFR5cGVOYW1lKGNvbC5nZXRUeXBlKCkpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgdGhlIHR5cGUgbmFtZSBmb3IgdGhlIHNwZWNp\nZmljIGNvbnN0YW50IGFzIGRlZmluZWQKICAgICAqIGJ5IHtAbGluayBqYXZh\nLnNxbC5UeXBlc30uCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5\ncGUKICAgICAqIEByZXR1cm4gdGhlIG5hbWUgZm9yIHRoZSB0eXBlCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZU5hbWUoaW50IHR5cGUpIHsK\nICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgIHJldHVybiBhcnJheVR5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJJR0lOVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBiaWdpbnRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5CSU5BUlk6CiAgICAgICAgICAgICAgICByZXR1cm4gYmluYXJ5VHlw\nZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGJpdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLkJMT0I6CiAgICAgICAgICAgICAgICByZXR1cm4gYmxvYlR5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIDE2OiAvLyBKREsgMS40IGludHJvZHVjZXMg\nVHlwZXMuQk9PTEVBTiwgd2hvc2UgdmFsdWUgaXMgMTYKICAgICAgICAgICAg\nICAgIHJldHVybiBib29sZWFuVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBjaGFyVHlwZU5h\nbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0xPQjoKICAgICAgICAgICAg\nICAgIHJldHVybiBjbG9iVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBkYXRlVHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuREVDSU1BTDoKICAgICAgICAgICAg\nICAgIHJldHVybiBkZWNpbWFsVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuRElTVElOQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gZGlzdGlu\nY3RUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ET1VCTEU6CiAg\nICAgICAgICAgICAgICByZXR1cm4gZG91YmxlVHlwZU5hbWU7CiAgICAgICAg\nICAgIGNhc2UgVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmxvYXRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5JTlRFR0VS\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGludGVnZXJUeXBlTmFtZTsKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5KQVZBX09CSkVDVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBqYXZhT2JqZWN0VHlwZU5hbWU7CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuTE9OR1ZBUkJJTkFSWToKICAgICAgICAgICAgICAgIHJldHVy\nbiBsb25nVmFyYmluYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuTE9OR1ZBUkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gbG9uZ1Zh\ncmNoYXJUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5OVUxMOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGxUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5OVU1FUklDOgogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bWVyaWNUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5PVEhF\nUjoKICAgICAgICAgICAgICAgIHJldHVybiBvdGhlclR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLlJFQUw6CiAgICAgICAgICAgICAgICByZXR1\ncm4gcmVhbFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlJFRjoK\nICAgICAgICAgICAgICAgIHJldHVybiByZWZUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5TTUFMTElOVDoKICAgICAgICAgICAgICAgIHJldHVy\nbiBzbWFsbGludFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlNU\nUlVDVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdHJ1Y3RUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHRpbWVUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5U\nSU1FU1RBTVA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZXN0YW1wVHlw\nZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElOWUlOVDoKICAgICAg\nICAgICAgICAgIHJldHVybiB0aW55aW50VHlwZU5hbWU7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuVkFSQklOQVJZOgogICAgICAgICAgICAgICAgcmV0dXJu\nIHZhcmJpbmFyeVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlZB\nUkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFyY2hhclR5cGVOYW1l\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJu\nIG90aGVyVHlwZU5hbWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogSGVscGVyIG1ldGhvZCB0byBhZGQgc2l6ZSBwcm9wZXJ0aWVzIHRvIHRo\nZSBzcGVjaWZpZWQgdHlwZS4KICAgICAqIElmIHByZXNlbnQsIHRoZSBzdHJp\nbmcgInswfSIgd2lsbCBiZSByZXBsYWNlZCB3aXRoIHRoZSBzaXplIGRlZmlu\naXRpb247CiAgICAgKiBvdGhlcndpc2UgdGhlIHNpemUgZGVmaW5pdGlvbiB3\naWxsIGJlIGFwcGVuZGVkIHRvIHRoZSB0eXBlIG5hbWUuCiAgICAgKiBJZiB5\nb3VyIGRhdGFiYXNlIGhhcyBjb2x1bW4gdHlwZXMgdGhhdCBkb24ndCBhbGxv\ndyBzaXplIGRlZmluaXRpb25zLAogICAgICogb3ZlcnJpZGUgdGhpcyBtZXRo\nb2QgdG8gcmV0dXJuIHRoZSB1bmFsdGVyZWQgdHlwZSBuYW1lIGZvciBjb2x1\nbW5zIG9mCiAgICAgKiB0aG9zZSB0eXBlcyAob3IgYWRkIHRoZSB0eXBlIG5h\nbWVzIHRvIHRoZQogICAgICogPGNvZGU+Zml4ZWRTaXplVHlwZU5hbWVTZXQ8\nL2NvZGU+KS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBhcHBlbmRT\naXplKENvbHVtbiBjb2wsIFN0cmluZyB0eXBlTmFtZSkgewogICAgICAgIGlm\nIChmaXhlZFNpemVUeXBlTmFtZVNldC5jb250YWlucyh0eXBlTmFtZS50b1Vw\ncGVyQ2FzZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lOwogICAg\nICAgIGlmICh0eXBlTmFtZS5pbmRleE9mKCcoJykgIT0gLTEpCiAgICAgICAg\nICAgIHJldHVybiB0eXBlTmFtZTsKCiAgICAgICAgU3RyaW5nIHNpemUgPSBu\ndWxsOwogICAgICAgIGlmIChjb2wuZ2V0U2l6ZSgpID4gMCkgewogICAgICAg\nICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigxMCk7\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBlbmQoY29sLmdldFNp\nemUoKSk7CiAgICAgICAgICAgIGlmIChjb2wuZ2V0RGVjaW1hbERpZ2l0cygp\nID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBwZW5k\nKGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpOwogICAgICAgICAgICBidWYuYXBw\nZW5kKCIpIik7CiAgICAgICAgICAgIHNpemUgPSBidWYudG9TdHJpbmcoKTsK\nICAgICAgICB9CgogICAgICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9m\nKCJ7MH0iKTsKICAgICAgICBpZiAoaWR4ID09IC0xICYmIHNpemUgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lICsgc2l6ZTsKICAgICAg\nICBpZiAoaWR4ID09IC0xKQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7\nCgogICAgICAgIC8vIHJlcGxhY2UgJ3swfScgd2l0aCBzaXplCiAgICAgICAg\nU3RyaW5nIHJldCA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAg\nICAgIGlmIChzaXplICE9IG51bGwpCiAgICAgICAgICAgIHJldCA9IHJldCAr\nIHNpemU7CiAgICAgICAgaWYgKHR5cGVOYW1lLmxlbmd0aCgpID4gaWR4ICsg\nMykKICAgICAgICAgICAgcmV0ID0gcmV0ICsgdHlwZU5hbWUuc3Vic3RyaW5n\nKGlkeCArIDMpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8KICAgIC8vIFNlbGVjdHMKICAgIC8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIG5hbWUgb2YgdGhlIGpvaW4gc3ludGF4IHRv\nIHVzZTogc3FsOTIsIHRyYWRpdGlvbmFsLCBkYXRhYmFzZQogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRKb2luU3ludGF4KFN0cmluZyBzeW50YXgpIHsK\nICAgICAgICBpZiAoInNxbDkyIi5lcXVhbHMoc3ludGF4KSkKICAgICAgICAg\nICAgam9pblN5bnRheCA9IFNZTlRBWF9TUUw5MjsKICAgICAgICBlbHNlIGlm\nICgidHJhZGl0aW9uYWwiLmVxdWFscyhzeW50YXgpKQogICAgICAgICAgICBq\nb2luU3ludGF4ID0gU1lOVEFYX1RSQURJVElPTkFMOwogICAgICAgIGVsc2Ug\naWYgKCJkYXRhYmFzZSIuZXF1YWxzKHN5bnRheCkpCiAgICAgICAgICAgIGpv\naW5TeW50YXggPSBTWU5UQVhfREFUQUJBU0U7CiAgICAgICAgZWxzZSBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoc3ludGF4KSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihzeW50YXgpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgU1FMIHN0cmluZyB0byBhY3Qg\nYXMgYSBwbGFjZWhvbGRlciBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRQbGFjZWhvbGRlclZhbHVlU3RyaW5n\nKENvbHVtbiBjb2wpIHsKICAgICAgICBzd2l0Y2ggKGNvbC5nZXRUeXBlKCkp\nIHsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSUdJTlQ6CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuQklUOgogICAgICAgICAgICBjYXNlIFR5cGVzLklOVEVH\nRVI6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuTlVNRVJJQzoKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5TTUFMTElOVDoKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5USU5ZSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuICIwIjsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJu\nIChzdG9yZUNoYXJzQXNOdW1iZXJzKSA/ICIwIiA6ICInICciOwogICAgICAg\nICAgICBjYXNlIFR5cGVzLkNMT0I6CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nTE9OR1ZBUkNIQVI6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVkFSQ0hBUjoK\nICAgICAgICAgICAgICAgIHJldHVybiAiJyciOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gWkVST19EQVRF\nX1NUUjsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ERUNJTUFMOgogICAgICAg\nICAgICBjYXNlIFR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5GTE9BVDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5SRUFMOgogICAgICAg\nICAgICAgICAgcmV0dXJuICIwLjAiOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLlRJTUU6CiAgICAgICAgICAgICAgICByZXR1cm4gWkVST19USU1FX1NUUjsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAg\nICAgICByZXR1cm4gWkVST19USU1FU1RBTVBfU1RSOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICJOVUxMIjsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBTRUxFQ1QgQ09V\nTlQgc3RhdGVtZW50IGluIHRoZSBwcm9wZXIgam9pbiBzeW50YXggZm9yIHRo\nZQogICAgICogZ2l2ZW4gaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBT\nUUxCdWZmZXIgdG9TZWxlY3RDb3VudChTZWxlY3Qgc2VsKSB7CiAgICAgICAg\nU1FMQnVmZmVyIHNlbGVjdFNRTCA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAg\nICAgICAgU1FMQnVmZmVyIGZyb207CiAgICAgICAgc2VsLmFkZEpvaW5DbGFz\nc0NvbmRpdGlvbnMoKTsKICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3Qo\nKSAhPSBudWxsKQogICAgICAgICAgICBmcm9tID0gZ2V0RnJvbVNlbGVjdChz\nZWwsIGZhbHNlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZyb20gPSBn\nZXRGcm9tKHNlbCwgZmFsc2UpOwogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9\nIGdldFdoZXJlKHNlbCwgZmFsc2UpOwoKICAgICAgICAvLyBpZiBubyBncm91\ncGluZyBhbmQgbm8gcmFuZ2UsIHdlIG1pZ2h0IGJlIGFibGUgdG8gZ2V0IGJ5\nIHdpdGhvdXQKICAgICAgICAvLyBhIHN1YnNlbGVjdAogICAgICAgIGlmIChz\nZWwuZ2V0R3JvdXBpbmcoKSA9PSBudWxsICYmIHNlbC5nZXRTdGFydEluZGV4\nKCkgPT0gMAogICAgICAgICAgICAmJiBzZWwuZ2V0RW5kSW5kZXgoKSA9PSBM\nb25nLk1BWF9WQUxVRSkgewogICAgICAgICAgICAvLyBpZiB0aGUgc2VsZWN0\nIGhhcyBubyBpZGVudGlmaWVyIGNvbHMsIHVzZSBDT1VOVCgqKQogICAgICAg\nICAgICBMaXN0IGFsaWFzZXMgPSAoIXNlbC5pc0Rpc3RpbmN0KCkpID8gQ29s\nbGVjdGlvbnMuRU1QVFlfTElTVAogICAgICAgICAgICAgICAgOiBzZWwuZ2V0\nSWRlbnRpZmllckFsaWFzZXMoKTsKICAgICAgICAgICAgaWYgKGFsaWFzZXMu\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5k\nKCJDT1VOVCgqKSIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvU2VsZWN0\nKHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwgd2hlcmUsIG51bGwsIG51bGwsIG51\nbGwsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25n\nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlm\nIHRoZXJlIGlzIGEgc2luZ2xlIGRpc3RpbmN0IGNvbCwgdXNlIENPVU5UKERJ\nU1RJTkNUIGNvbCkKICAgICAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpID09\nIDEpIHsKICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5U\nKERJU1RJTkNUICIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChhbGlh\nc2VzLmdldCgwKS50b1N0cmluZygpKS5hcHBlbmQoIikiKTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20s\nIHdoZXJlLCBudWxsLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAg\nIGZhbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBjYW4gd2UgY29tYmluZSBkaXN0aW5jdCBj\nb2xzPwogICAgICAgICAgICBpZiAoZGlzdGluY3RDb3VudENvbHVtblNlcGFy\nYXRvciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBw\nZW5kKCJDT1VOVChESVNUSU5DVCAiKTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgYWxpYXNlcy5zaXplKCk7IGkrKykgewogICAgICAg\nICAgICAgICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBzZWxlY3RTUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoZGlzdGluY3RDb3VudENvbHVtblNl\ncGFyYXRvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5h\ncHBlbmQoIiAiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZChhbGlhc2VzLmdldChpKS50b1N0\ncmluZygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNl\nbGVjdFNRTC5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\nb1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdoZXJlLCBudWxsLCBu\ndWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwg\nMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBzaW5jZSB3ZSBjYW4ndCBjb21iaW5lIGRpc3RpbmN0IGNv\nbHMsIHdlIGhhdmUgdG8gcGVyZm9ybSBhbiBvdXRlcgogICAgICAgIC8vIENP\nVU5UKCopIHNlbGVjdCB1c2luZyB0aGUgb3JpZ2luYWwgc2VsZWN0IGFzIGEg\nc3Vic2VsZWN0IGluIHRoZQogICAgICAgIC8vIEZST00gY2xhdXNlCiAgICAg\nICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1N1YnNlbGVjdCwgIlN1cHBvcnRz\nU3Vic2VsZWN0Iik7CgogICAgICAgIFNRTEJ1ZmZlciBzdWJTZWxlY3QgPSBn\nZXRTZWxlY3RzKHNlbCwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIFNRTEJ1ZmZl\nciBzdWJGcm9tID0gZnJvbTsKICAgICAgICBmcm9tID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgICBmcm9tLmFwcGVuZCgiKCIpOwogICAgICAgIGZy\nb20uYXBwZW5kKHRvU2VsZWN0KHN1YlNlbGVjdCwgbnVsbCwgc3ViRnJvbSwg\nd2hlcmUsCiAgICAgICAgICAgIHNlbC5nZXRHcm91cGluZygpLCBzZWwuZ2V0\nSGF2aW5nKCksIG51bGwsIHNlbC5pc0Rpc3RpbmN0KCksCiAgICAgICAgICAg\nIGZhbHNlLCBzZWwuZ2V0U3RhcnRJbmRleCgpLCBzZWwuZ2V0RW5kSW5kZXgo\nKSwgdHJ1ZSkpOwogICAgICAgIGZyb20uYXBwZW5kKCIpIik7CiAgICAgICAg\naWYgKHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QpCiAgICAgICAgICAgIGZy\nb20uYXBwZW5kKCIgIikuYXBwZW5kKFNlbGVjdC5GUk9NX1NFTEVDVF9BTElB\nUyk7CgogICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIkNPVU5UKCopIik7CiAg\nICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwg\nbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgZmFsc2UsIGZh\nbHNlLCAwLCBMb25nLk1BWF9WQUxVRSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBERUxFVEUgc3RhdGVtZW50IGZvciB0aGUgc3BlY2lmaWVk\nIFNlbGVjdC4gSWYgdGhlCiAgICAgKiBkYXRhYmFzZSBkb2VzIG5vdCBzdXBw\nb3J0IHRoZSBidWxrIGRlbGV0ZSBzdGF0ZW1lbnQgKHN1Y2ggYXMKICAgICAq\nIGNhc2VzIHdoZXJlIGEgc3Vic2VsZWN0IGlzIHJlcXVpcmVkIGFuZCB0aGUg\nZGF0YWJhc2UgZG9lc24ndCBzdXBwb3J0CiAgICAgKiBzdWJzZWxlY3RzKSwg\ndGhpcyBtZXRob2Qgc2hvdWxkIHJldHVybiBudWxsLgogICAgICovCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvRGVsZXRlKENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBTZWxlY3Qgc2VsLCAKICAgICAgICBPYmplY3RbXSBwYXJhbXMpIHsKICAg\nICAgICByZXR1cm4gdG9CdWxrT3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwgbnVs\nbCwgcGFyYW1zLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVy\nIHRvVXBkYXRlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLAog\nICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0W10gcGFyYW1zLCBNYXAg\ndXBkYXRlcykgewogICAgICAgIHJldHVybiB0b0J1bGtPcGVyYXRpb24obWFw\ncGluZywgc2VsLCBzdG9yZSwgcGFyYW1zLCB1cGRhdGVzKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIFNRTCBmb3IgYSBidWxrIG9wZXJh\ndGlvbiwgZWl0aGVyIGEgREVMRVRFIG9yIGFuIFVQREFURS4KICAgICAqCiAg\nICAgKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcG5nIGFnYWluc3Qgd2hpY2gg\nd2UgYXJlIG9wZXJhdGluZwogICAgICogQHBhcmFtIHNlbCB0aGUgU2VsZWN0\nIHRoYXQgd2lsbCBjb25zdGl0dXRlIHRoZSBXSEVSRSBjbGF1c2UKICAgICAq\nIEBwYXJhbSBzdG9yZSB0aGUgY3VycmVudCBzdG9yZQogICAgICogQHBhcmFt\nIHVwZGF0ZVBhcmFtcyB0aGUgTWFwIHRoYXQgaG9sZHMgdGhlIHVwZGF0ZSBw\nYXJhbWV0ZXJzOyBhIG51bGwKICAgICAqIHZhbHVlIGluZGljYXRlcyB0aGF0\nIHRoaXMgaXMgYSBkZWxldGUgb3BlcmF0aW9uCiAgICAgKiBAcmV0dXJuIHRo\nZSBTUUxCdWZmZXIgZm9yIHRoZSB1cGRhdGUsIG9yIDxlbT5udWxsPC9lbT4g\naWYgaXQgaXMgbm90CiAgICAgKiBwb3NzaWJsZSB0byBwZXJmb3JtIHRoZSBi\ndWxrIHVwZGF0ZQogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIHRv\nQnVsa09wZXJhdGlvbihDbGFzc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNl\nbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVjdFtdIHBhcmFtcywg\nTWFwIHVwZGF0ZVBhcmFtcykgewogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBu\nZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGlmICh1cGRhdGVQYXJhbXMg\nPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVuZCgiREVMRVRFIEZST00g\nIik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzcWwuYXBwZW5kKCJVUERB\nVEUgIik7CiAgICAgICAgc2VsLmFkZEpvaW5DbGFzc0NvbmRpdGlvbnMoKTsK\nCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgb25seSBhIHNpbmdsZSB0YWJsZSBp\nbiB0aGUgc2VsZWN0LCB0aGVuIHdlIGNhbgogICAgICAgIC8vIGp1c3QgaXNz\ndWUgYSBzaW5nbGUgREVMRVRFIEZST00gVEFCTEUgV0hFUkUgPGNvbmRpdGlv\nbnM+CiAgICAgICAgLy8gc3RhdGVtZW50OyBvdGhlcndpc2UsIHNpbmNlIFNR\nTCBkb2Vzbid0IGFsbG93IGRlbGV0aW5nCiAgICAgICAgLy8gZnJvbSBvbmUg\nb2YgYSBtdWx0aS10YWJsZSBzZWxlY3QsIHdlIG5lZWQgdG8gaXNzdWUgYSBz\ndWJzZWxlY3QKICAgICAgICAvLyBsaWtlIERFTEVURSBGUk9NIFRBQkxFIFdI\nRVJFIEVYSVNUUwogICAgICAgIC8vIChTRUxFQ1QgMSBGUk9NIFRBQkxFIHQw\nIFdIRVJFIHQwLklEID0gVEFCTEUuSUQpOyBhbHNvLCBzb21lCiAgICAgICAg\nLy8gZGF0YWJhc2VzIGRvIG5vdCBhbGxvdyBhbGlhc2VzIGluIGRlbGV0ZSBz\ndGF0ZW1lbnRzLCB3aGljaAogICAgICAgIC8vIGFsc28gY2F1c2VzIHVzIHRv\nIHVzZSBhIHN1YnNlbGVjdAogICAgICAgIGlmIChzZWwuZ2V0VGFibGVBbGlh\nc2VzKCkuc2l6ZSgpID09IDEgJiYgc3VwcG9ydHNTdWJzZWxlY3QKICAgICAg\nICAgICAgJiYgYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpIHsKICAgICAgICAg\nICAgU1FMQnVmZmVyIGZyb207CiAgICAgICAgICAgIGlmIChzZWwuZ2V0RnJv\nbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBmcm9tID0gZ2V0\nRnJvbVNlbGVjdChzZWwsIGZhbHNlKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgZnJvbSA9IGdldEZyb20oc2VsLCBmYWxzZSk7CgogICAg\nICAgICAgICBzcWwuYXBwZW5kKGZyb20pOwogICAgICAgICAgICBhcHBlbmRV\ncGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMs\nCiAgICAgICAgICAgICAgICBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSk7Cgog\nICAgICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBzZWwuZ2V0V2hlcmUoKTsK\nICAgICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwgJiYgIXdoZXJlLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFICIp\nOwogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCh3aGVyZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNxbDsKICAgICAgICB9CgogICAg\nICAgIFRhYmxlIHRhYmxlID0gbWFwcGluZy5nZXRUYWJsZSgpOwogICAgICAg\nIFN0cmluZyB0YWJsZU5hbWUgPSBnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2Up\nOwoKICAgICAgICAvLyBvbmx5IHVzZSBhICBzdWJzZWxlY3QgaWYgdGhlIHdo\nZXJlIGlzIG5vdCBlbXB0eTsgb3RoZXJ3aXNlCiAgICAgICAgLy8gYW4gdW5x\ndWFsaWZpZWQgZGVsZXRlIG9yIHVwZGF0ZSB3aWxsIHdvcmsKICAgICAgICBp\nZiAoc2VsLmdldFdoZXJlKCkgPT0gbnVsbCB8fCBzZWwuZ2V0V2hlcmUoKS5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUp\nOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwg\ncGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsKICAgICAgICAgICAgcmV0\ndXJuIHNxbDsKICAgICAgICB9CgogICAgICAgIC8vIHdlIG5lZWQgdG8gdXNl\nIGEgc3Vic2VsZWN0IGlmIHdlIGFyZSB0byBidWxrIGRlbGV0ZSB3aGVyZQog\nICAgICAgIC8vIHRoZSBzZWxlY3QgaW5jbHVkZXMgbXVsdGlwbGUgdGFibGVz\nOyBpZiB0aGUgZGF0YWJhc2UKICAgICAgICAvLyBkb2Vzbid0IHN1cHBvcnQg\naXQsIHRoZW4gd2UgbmVlZCB0byBzaWdhbCB0aGlzIGJ5IHJldHVybmluZyBu\ndWxsCiAgICAgICAgaWYgKCFzdXBwb3J0c1N1YnNlbGVjdCB8fCAhc3VwcG9y\ndHNDb3JyZWxhdGVkU3Vic2VsZWN0KQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgQ29sdW1uW10gcGtzID0gbWFwcGluZy5nZXRQcmltYXJ5\nS2V5Q29sdW1ucygpOwogICAgICAgIHNlbC5jbGVhclNlbGVjdHMoKTsKICAg\nICAgICBzZWwuc2V0RGlzdGluY3QodHJ1ZSk7CgogICAgICAgIC8vIGlmIHdl\nIGhhdmUgb25seSBhIHNpbmdsZSBQSywgd2UgY2FuIHVzZSBhIG5vbi1jb3Jy\nZWxhdGVkCiAgICAgICAgLy8gc3VicXVlcnkgKHVzaW5nIGFuIElOIHN0YXRl\nbWVudCksIHdoaWNoIGlzIG11Y2ggZmFzdGVyIHRoYW4KICAgICAgICAvLyBh\nIGNvcnJlbGF0ZWQgc3VicXVlcnkgKHNpbmNlIGEgY29ycmVsYXRlZCBzdWJx\ndWVyeSBuZWVkcwogICAgICAgIC8vIHRvIGJlIGV4ZWN1dGVkIG9uY2UgZm9y\nIGVhY2ggcm93IGluIHRoZSB0YWJsZSkKICAgICAgICBpZiAocGtzLmxlbmd0\naCA9PSAxKSB7CiAgICAgICAgICAgIHNlbC5zZWxlY3QocGtzWzBdKTsKICAg\nICAgICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBh\ncHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQ\nYXJhbXMsIGZhbHNlKTsKICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJF\nICIpLgogICAgICAgICAgICAgICAgYXBwZW5kKHBrc1swXSkuYXBwZW5kKCIg\nSU4gKCIpLgogICAgICAgICAgICAgICAgYXBwZW5kKHNlbC50b1NlbGVjdChm\nYWxzZSwgbnVsbCkpLmFwcGVuZCgiKSIpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIHNlbC5jbGVhclNlbGVjdHMoKTsKICAgICAgICAgICAgc2Vs\nLnNldERpc3RpbmN0KGZhbHNlKTsKCiAgICAgICAgICAgIC8vIHNpbmNlIHRo\nZSBzZWxlY3QgaXMgdXNpbmcgYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5LCB3ZQog\nICAgICAgICAgICAvLyBvbmx5IG5lZWQgdG8gc2VsZWN0IGEgYm9ndXMgdmly\ndHVhbCBjb2x1bW4KICAgICAgICAgICAgc2VsLnNlbGVjdCgiMSIsIG51bGwp\nOwoKICAgICAgICAgICAgLy8gYWRkIGluIHRoZSBqb2lucyB0byB0aGUgdGFi\nbGUKICAgICAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldFByaW1h\ncnlLZXkoKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBi\ndWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgICAgICBidWYuYXBw\nZW5kKCIoIik7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29s\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGkgPiAwKQog\nICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgIik7CgogICAg\nICAgICAgICAgICAgLy8gYWRkIGluICJ0MC5QSyA9IE1ZVEFCTEUuUEsiCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlhcyhj\nb2xzW2ldLCBudWxsKSkuYXBwZW5kKCIgPSAiKS4KICAgICAgICAgICAgICAg\nICAgICBhcHBlbmQodGFibGUpLmFwcGVuZChjYXRhbG9nU2VwYXJhdG9yKS5h\ncHBlbmQoY29sc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiKSIpOwogICAgICAgICAgICBzZWwud2hlcmUoYnVmLCBudWxs\nKTsKCiAgICAgICAgICAgIHNxbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAg\nICAgICAgYXBwZW5kVXBkYXRlcyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywg\ndXBkYXRlUGFyYW1zLCBmYWxzZSk7CiAgICAgICAgICAgIHNxbC5hcHBlbmQo\nIiBXSEVSRSBFWElTVFMgKCIpLgogICAgICAgICAgICAgICAgYXBwZW5kKHNl\nbC50b1NlbGVjdChmYWxzZSwgbnVsbCkpLmFwcGVuZCgiKSIpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCB2\nb2lkIGFwcGVuZFVwZGF0ZXMoU2VsZWN0IHNlbCwgSkRCQ1N0b3JlIHN0b3Jl\nLCBTUUxCdWZmZXIgc3FsLAogICAgICAgIE9iamVjdFtdIHBhcmFtcywgTWFw\nIHVwZGF0ZVBhcmFtcywgYm9vbGVhbiBhbGxvd0FsaWFzKSB7CiAgICAgICAg\naWYgKHVwZGF0ZVBhcmFtcyA9PSBudWxsIHx8IHVwZGF0ZVBhcmFtcy5zaXpl\nKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBtYW51\nYWxseSBidWlsZCB1cCB0aGUgU0VUIGNsYXVzZSBmb3IgdGhlIFVQREFURSBz\ndGF0ZW1lbnQKICAgICAgICBzcWwuYXBwZW5kKCIgU0VUICIpOwogICAgICAg\nIEV4cENvbnRleHQgY3R4ID0gbmV3IEV4cENvbnRleHQoc3RvcmUsIHBhcmFt\ncywgCiAgICAgICAgICAgIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigp\nKTsKCiAgICAgICAgLy8gSWYgdGhlIHVwZGF0ZXMgbWFwIGNvbnRhaW5zIGFu\neSB2ZXJzaW9uIGZpZWxkcywgYXNzdW1lIHRoYXQgdGhlCiAgICAgICAgLy8g\nb3B0aW1pc3RpYyBsb2NrIHZlcnNpb24gZGF0YSBpcyBiZWluZyBoYW5kbGVk\nIHByb3Blcmx5IGJ5IHRoZQogICAgICAgIC8vIGNhbGxlci4gT3RoZXJ3aXNl\nLCBnaXZlIHRoZSB2ZXJzaW9uIGluZGljYXRvciBhbiBvcHBvcnR1bml0eSB0\nbwogICAgICAgIC8vIGFkZCBtb3JlIHVwZGF0ZSBjbGF1c2VzIGFzIG5lZWRl\nZC4KICAgICAgICBib29sZWFuIGF1Z21lbnRVcGRhdGVzID0gdHJ1ZTsKCiAg\nICAgICAgZm9yIChJdGVyYXRvciBpID0gdXBkYXRlUGFyYW1zLmVudHJ5U2V0\nKCkuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE1h\ncC5FbnRyeSBuZXh0ID0gKE1hcC5FbnRyeSkgaS5uZXh0KCk7CiAgICAgICAg\nICAgIEZpZWxkTWFwcGluZyBmbWQgPSAoRmllbGRNYXBwaW5nKSBuZXh0Lmdl\ndEtleSgpOwoKICAgICAgICAgICAgaWYgKGZtZC5pc1ZlcnNpb24oKSkKICAg\nICAgICAgICAgICAgIGF1Z21lbnRVcGRhdGVzID0gZmFsc2U7CgogICAgICAg\nICAgICBWYWwgdmFsID0gKFZhbCkgbmV4dC5nZXRWYWx1ZSgpOwoKICAgICAg\nICAgICAgQ29sdW1uIGNvbCA9IGZtZC5nZXRDb2x1bW5zKClbMF07CiAgICAg\nICAgICAgIHNxbC5hcHBlbmQoY29sLmdldE5hbWUoKSk7CiAgICAgICAgICAg\nIHNxbC5hcHBlbmQoIiA9ICIpOwoKICAgICAgICAgICAgRXhwU3RhdGUgc3Rh\ndGUgPSB2YWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAg\nIHZhbC5jYWxjdWxhdGVWYWx1ZShzZWwsIGN0eCwgc3RhdGUsIG51bGwsIG51\nbGwpOwoKICAgICAgICAgICAgLy8gYXBwZW5kIHRoZSB2YWx1ZSB3aXRoIGEg\nbnVsbCBmb3IgdGhlIFNlbGVjdDsgaQogICAgICAgICAgICAvLyBpbmRpY2F0\nZXMgdGhhdCB0aGUKICAgICAgICAgICAgaW50IGxlbmd0aCA9IHZhbC5sZW5n\ndGgoc2VsLCBjdHgsIHN0YXRlKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9\nIDA7IGogPCBsZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIHZhbC5hcHBl\nbmRUbygoYWxsb3dBbGlhcykgPyBzZWwgOiBudWxsLCBjdHgsIHN0YXRlLCBz\ncWwsIGopOwoKICAgICAgICAgICAgaWYgKGkuaGFzTmV4dCgpKQogICAgICAg\nICAgICAgICAgc3FsLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChhdWdtZW50VXBkYXRlcykgewogICAgICAgICAgICBDbGFzc01hcHBp\nbmcgbWV0YSA9CiAgICAgICAgICAgICAgICAoKEZpZWxkTWFwcGluZykgdXBk\nYXRlUGFyYW1zLmtleVNldCgpLml0ZXJhdG9yKCkubmV4dCgpKQogICAgICAg\nICAgICAgICAgICAgIC5nZXREZWNsYXJpbmdNYXBwaW5nKCk7CiAgICAgICAg\nICAgIE1hcCB1cGRhdGVzID0gbWV0YS5nZXRWZXJzaW9uKCkuZ2V0QnVsa1Vw\nZGF0ZVZhbHVlcygpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIg\nPSB1cGRhdGVzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAg\nICAgIGl0ZXIuaGFzTmV4dCgpOyApIHsKICAgICAgICAgICAgICAgIE1hcC5F\nbnRyeSBlID0gKE1hcC5FbnRyeSkgaXRlci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBDb2x1bW4gY29sID0gKENvbHVtbikgZS5nZXRLZXkoKTsKICAgICAg\nICAgICAgICAgIFN0cmluZyB2YWwgPSAoU3RyaW5nKSBlLmdldFZhbHVlKCk7\nCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIsICIpLmFwcGVuZChjb2wu\nZ2V0TmFtZSgpKQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoIiA9ICIp\nLmFwcGVuZCh2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQog\nICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBTUUwgdG8gZGVsZXRlIHRoZSBj\nb250ZW50cyBvZiB0aGUgc3BlY2lmaWVkIHRhYmxlcy4gCiAgICAgKiBUaGUg\nZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBkcm9wcyBhbGwgbm9uLWRlZmVycmVk\nIFJFU1RSSUNUIGZvcmVpZ24ga2V5IAogICAgICogY29uc3RyYWludHMgaW52\nb2x2aW5nIHRoZSBzcGVjaWZpZWQgdGFibGVzLCBpc3N1ZXMgREVMRVRFIHN0\nYXRlbWVudHMgCiAgICAgKiBhZ2FpbnN0IHRoZSB0YWJsZXMsIGFuZCB0aGVu\nIGFkZHMgdGhlIGRyb3BwZWQgY29uc3RyYWludHMgYmFjayBpbi4gCiAgICAg\nKiBEYXRhYmFzZXMgd2l0aCBtb3JlIG9wdGltYWwgd2F5cyBvZiBkZWxldGlu\nZyB0aGUgY29udGVudHMgb2Ygc2V2ZXJhbCAKICAgICAqIHRhYmxlcyBzaG91\nbGQgb3ZlcnJpZGUgdGhpcyBtZXRob2QuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmdbXSBnZXREZWxldGVUYWJsZUNvbnRlbnRzU1FMKFRhYmxlW10gdGFi\nbGVzKSB7CiAgICAgICAgQ29sbGVjdGlvbiBzcWwgPSBuZXcgQXJyYXlMaXN0\nKCk7CiAgICAgICAgCiAgICAgICAgLy8gY29sbGVjdCBhbmQgZHJvcCBub24t\nZGVmZXJyZWQgcGh5c2ljYWwgcmVzdHJpY3QgY29uc3RyYWludHMsIGFuZAog\nICAgICAgIC8vIGNvbGxlY3QgdGhlIERFTEVURSBGUk9NIHN0YXRlbWVudHMK\nICAgICAgICBDb2xsZWN0aW9uIGRlbGV0ZVNRTCA9IG5ldyBBcnJheUxpc3Qo\ndGFibGVzLmxlbmd0aCk7CiAgICAgICAgQ29sbGVjdGlvbiByZXN0cmljdENv\nbnN0cmFpbnRzID0gbmV3IExpbmtlZEhhc2hTZXQoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHRhYmxlcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBGb3JlaWduS2V5W10gZmtzID0gdGFibGVzW2ldLmdldEZvcmVpZ25L\nZXlzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZmtzLmxl\nbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZrc1tqXS5pc0xv\nZ2ljYWwoKSAmJiAhZmtzW2pdLmlzRGVmZXJyZWQoKSAKICAgICAgICAgICAg\nICAgICAgICAmJiBma3Nbal0uZ2V0RGVsZXRlQWN0aW9uKCkgPT0gRm9yZWln\nbktleS5BQ1RJT05fUkVTVFJJQ1QpCiAgICAgICAgICAgICAgICByZXN0cmlj\ndENvbnN0cmFpbnRzLmFkZChma3Nbal0pOwogICAgICAgICAgICAgICAgU3Ry\naW5nW10gY29uc3RyYWludFNRTCA9IGdldERyb3BGb3JlaWduS2V5U1FMKGZr\nc1tqXSk7CiAgICAgICAgICAgICAgICBzcWwuYWRkQWxsKEFycmF5cy5hc0xp\nc3QoY29uc3RyYWludFNRTCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIAogICAgICAgICAgICBkZWxldGVTUUwuYWRkKCJERUxFVEUgRlJPTSAiICsg\ndGFibGVzW2ldLmdldEZ1bGxOYW1lKCkpOwogICAgICAgIH0KICAgICAgICAK\nICAgICAgICAvLyBhZGQgdGhlIGRlbGV0ZSBzdGF0ZW1lbnRzIGFmdGVyIGFs\nbCB0aGUgY29uc3RyYWludCBtdXRhdGlvbnMKICAgICAgICBzcWwuYWRkQWxs\nKGRlbGV0ZVNRTCk7CiAgICAgICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxl\ndGVkIGNvbnN0cmFpbnRzIGJhY2sgdG8gdGhlIHNjaGVtYQogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRlciA9IHJlc3RyaWN0Q29uc3RyYWludHMuaXRlcmF0\nb3IoKTsgaXRlci5oYXNOZXh0KCk7ICkgewogICAgICAgICAgICBTdHJpbmdb\nXSBjb25zdHJhaW50U1FMID0gCiAgICAgICAgICAgICAgICBnZXRBZGRGb3Jl\naWduS2V5U1FMKChGb3JlaWduS2V5KSBpdGVyLm5leHQoKSk7CiAgICAgICAg\nICAgIHNxbC5hZGRBbGwoQXJyYXlzLmFzTGlzdChjb25zdHJhaW50U1FMKSk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAoU3RyaW5nW10p\nIHNxbC50b0FycmF5KG5ldyBTdHJpbmdbc3FsLnNpemUoKV0pOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgU0VMRUNUIHN0YXRlbWVudCBpbiB0\naGUgcHJvcGVyIGpvaW4gc3ludGF4IGZvciB0aGUgZ2l2ZW4KICAgICAqIGlu\nc3RhbmNlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0\nKFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBzZWwuYWRkSm9p\nbkNsYXNzQ29uZGl0aW9ucygpOwogICAgICAgIGJvb2xlYW4gdXBkYXRlID0g\nZm9yVXBkYXRlICYmIHNlbC5nZXRGcm9tU2VsZWN0KCkgPT0gbnVsbDsKICAg\nICAgICBTUUxCdWZmZXIgc2VsZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIGZhbHNl\nLCB1cGRhdGUpOwogICAgICAgIFNRTEJ1ZmZlciBvcmRlcmluZyA9IG51bGw7\nCiAgICAgICAgaWYgKCFzZWwuaXNBZ2dyZWdhdGUoKSB8fCBzZWwuZ2V0R3Jv\ndXBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBvcmRlcmluZyA9IHNlbC5n\nZXRPcmRlcmluZygpOwogICAgICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAg\nIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAg\nIGZyb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwgZm9yVXBkYXRlKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tKHNlbCwgdXBkYXRl\nKTsKICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBnZXRXaGVyZShzZWwsIHVw\nZGF0ZSk7CiAgICAgICAgcmV0dXJuIHRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gs\nIGZyb20sIHdoZXJlLCBzZWwuZ2V0R3JvdXBpbmcoKSwKICAgICAgICAgICAg\nc2VsLmdldEhhdmluZygpLCBvcmRlcmluZywgc2VsLmlzRGlzdGluY3QoKSwg\nZm9yVXBkYXRlLAogICAgICAgICAgICBzZWwuZ2V0U3RhcnRJbmRleCgpLCBz\nZWwuZ2V0RW5kSW5kZXgoKSwgc2VsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRlbWVudCBi\nZXR3ZWVuIHRoZSBGUk9NIGtleXdvcmQKICAgICAqIGFuZCB0aGUgV0hFUkUg\na2V5d29yZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRG\ncm9tKFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAg\nU1FMQnVmZmVyIGZyb21TUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAg\nICAgIENvbGxlY3Rpb24gYWxpYXNlcyA9IHNlbC5nZXRUYWJsZUFsaWFzZXMo\nKTsKICAgICAgICBpZiAoYWxpYXNlcy5zaXplKCkgPCAyIHx8IHNlbC5nZXRK\nb2luU3ludGF4KCkgIT0gU1lOVEFYX1NRTDkyKSB7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gYWxpYXNlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoaXRy\nLm5leHQoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIGlmIChmb3JV\ncGRhdGUgJiYgdGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJs\nZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgICAgICAgICBpZiAoaXRyLmhh\nc05leHQoKSkKICAgICAgICAgICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCgi\nLCAiKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsKICAg\nICAgICAgICAgYm9vbGVhbiBmaXJzdCA9IHRydWU7CiAgICAgICAgICAgIHdo\naWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICBmcm9tU1FM\nLmFwcGVuZCh0b1NRTDkySm9pbigoSm9pbikgaXRyLm5leHQoKSwgZm9yVXBk\nYXRlLAogICAgICAgICAgICAgICAgICAgIGZpcnN0KSk7CiAgICAgICAgICAg\nICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBmcm9tU1FMOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBGUk9NIGNsYXVzZSBmb3IgYSBzZWxlY3QgdGhhdCBzZWxl\nY3RzIGZyb20gYSB0bXAgdGFibGUKICAgICAqIGNyZWF0ZWQgYnkgYW4gaW5u\nZXIgc2VsZWN0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdl\ndEZyb21TZWxlY3QoU2VsZWN0IHNlbCwgYm9vbGVhbiBmb3JVcGRhdGUpIHsK\nICAgICAgICBTUUxCdWZmZXIgZnJvbVNRTCA9IG5ldyBTUUxCdWZmZXIodGhp\ncyk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQoIigiKTsKICAgICAgICBmcm9t\nU1FMLmFwcGVuZCh0b1NlbGVjdChzZWwuZ2V0RnJvbVNlbGVjdCgpLCBmb3JV\ncGRhdGUsIG51bGwpKTsKICAgICAgICBmcm9tU1FMLmFwcGVuZCgiKSIpOwog\nICAgICAgIGlmIChyZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAgICAg\nICAgICBmcm9tU1FMLmFwcGVuZCgiICIpLmFwcGVuZChTZWxlY3QuRlJPTV9T\nRUxFQ1RfQUxJQVMpOwogICAgICAgIHJldHVybiBmcm9tU1FMOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBXSEVSRSBwb3J0aW9uIG9mIHRo\nZSBzZWxlY3Qgc3RhdGVtZW50LCBvciBudWxsIGlmIG5vIHdoZXJlCiAgICAg\nKiBjb25kaXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVy\nIGdldFdoZXJlKFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAg\nICAgICAgSm9pbnMgam9pbnMgPSBzZWwuZ2V0Sm9pbnMoKTsKICAgICAgICBp\nZiAoc2VsLmdldEpvaW5TeW50YXgoKSA9PSBTWU5UQVhfU1FMOTIKICAgICAg\nICAgICAgfHwgam9pbnMgPT0gbnVsbCB8fCBqb2lucy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybiBzZWwuZ2V0V2hlcmUoKTsKCiAgICAgICAgU1FM\nQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBp\nZiAoc2VsLmdldFdoZXJlKCkgIT0gbnVsbCkKICAgICAgICAgICAgd2hlcmUu\nYXBwZW5kKHNlbC5nZXRXaGVyZSgpKTsKICAgICAgICBpZiAoam9pbnMgIT0g\nbnVsbCkKICAgICAgICAgICAgc2VsLmFwcGVuZCh3aGVyZSwgam9pbnMpOwog\nICAgICAgIHJldHVybiB3aGVyZTsKICAgIH0KCiAgICAvKioKICAgICAqIFVz\nZSB0aGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0byBjcmVhdGUgU1FMIGpvaW5p\nbmcgaXRzIHRhYmxlcyBpbgogICAgICogdGhlIHRyYWRpdGlvbmFsIHN0eWxl\nLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvVHJhZGl0aW9uYWxK\nb2luKEpvaW4gam9pbikgewogICAgICAgIEZvcmVpZ25LZXkgZmsgPSBqb2lu\nLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJvb2xlYW4gaW52ZXJz\nZSA9IGpvaW4uaXNGb3JlaWduS2V5SW52ZXJzZWQoKTsKICAgICAgICBDb2x1\nbW5bXSBmcm9tID0gKGludmVyc2UpID8gZmsuZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKQogICAgICAgICAgICA6IGZrLmdldENvbHVtbnMoKTsKICAgICAgICBD\nb2x1bW5bXSB0byA9IChpbnZlcnNlKSA/IGZrLmdldENvbHVtbnMoKQogICAg\nICAgICAgICA6IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CgogICAgICAg\nIC8vIGRvIGNvbHVtbiBqb2lucwogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBu\nZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGludCBjb3VudCA9IDA7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmcm9tLmxlbmd0aDsgaSsrLCBj\nb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLmFwcGVuZChm\ncm9tW2ldKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7CiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczIoKSkuYXBwZW5kKCIu\nIikuYXBwZW5kKHRvW2ldKTsKICAgICAgICB9CgogICAgICAgIC8vIGRvIGNv\nbnN0YW50IGpvaW5zCiAgICAgICAgQ29sdW1uW10gY29uc3RDb2xzID0gZmsu\nZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAg\nICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNvbnN0\nQ29sc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSkuYXBw\nZW5kKCIuIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0Q29s\nc1tpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwoKICAgICAg\nICAgICAgaWYgKGludmVyc2UpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAg\nICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0pOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUoZmsuZ2V0Q29uc3Rh\nbnQoY29uc3RDb2xzW2ldKSwgY29uc3RDb2xzW2ldKTsKICAgICAgICB9Cgog\nICAgICAgIENvbHVtbltdIGNvbnN0Q29sc1BLID0gZmsuZ2V0Q29uc3RhbnRQ\ncmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29uc3RDb2xzUEsubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAgICAg\nICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgpKS5hcHBlbmQo\nIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoY29uc3RDb2xzUEtb\naV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kVmFsdWUoZmsuZ2V0UHJpbWFyeUtleUNvbnN0YW50KGNvbnN0Q29sc1BL\nW2ldKSwKICAgICAgICAgICAgICAgICAgICBjb25zdENvbHNQS1tpXSk7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwoKICAgICAgICAgICAgaWYg\nKGludmVyc2UpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUoZmsu\nZ2V0UHJpbWFyeUtleUNvbnN0YW50KGNvbnN0Q29sc1BLW2ldKSwKICAgICAg\nICAgICAgICAgICAgICBjb25zdENvbHNQS1tpXSk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlhczIo\nKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKGNv\nbnN0Q29sc1BLW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1ZjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFVzZSB0aGUgZ2l2ZW4gam9pbiBpbnN0\nYW5jZSB0byBjcmVhdGUgU1FMIGpvaW5pbmcgaXRzIHRhYmxlcyBpbgogICAg\nICogdGhlIFNRTDkyIHN0eWxlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVm\nZmVyIHRvU1FMOTJKb2luKEpvaW4gam9pbiwgYm9vbGVhbiBmb3JVcGRhdGUs\nIGJvb2xlYW4gZmlyc3QpIHsKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3\nIFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpZiAoZmlyc3QpIHsKICAgICAg\nICAgICAgYnVmLmFwcGVuZChqb2luLmdldFRhYmxlMSgpKS5hcHBlbmQoIiAi\nKS4KICAgICAgICAgICAgICAgIGFwcGVuZChqb2luLmdldEFsaWFzMSgpKTsK\nICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVwZGF0ZUNs\nYXVzZSAhPSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAg\nICAgICBidWYuYXBwZW5kKCIgIik7CiAgICAgICAgaWYgKGpvaW4uZ2V0VHlw\nZSgpID09IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgYnVmLmFwcGVu\nZChvdXRlckpvaW5DbGF1c2UpOwogICAgICAgIGVsc2UgaWYgKGpvaW4uZ2V0\nVHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikKICAgICAgICAgICAgYnVmLmFw\ncGVuZChpbm5lckpvaW5DbGF1c2UpOwogICAgICAgIGVsc2UgLy8gY3Jvc3MK\nICAgICAgICAgICAgYnVmLmFwcGVuZChjcm9zc0pvaW5DbGF1c2UpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIiAiKTsKCiAgICAgICAgYnVmLmFwcGVuZChqb2lu\nLmdldFRhYmxlMigpKS5hcHBlbmQoIiAiKS5hcHBlbmQoam9pbi5nZXRBbGlh\nczIoKSk7CiAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVwZGF0\nZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgIiku\nYXBwZW5kKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsKCiAgICAgICAgaWYgKGpv\naW4uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBPTiAiKS5hcHBlbmQodG9UcmFkaXRpb25hbEpvaW4oam9pbikp\nOwogICAgICAgIGVsc2UgaWYgKHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NK\nb2luICYmCiAgICAgICAgICAgIGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQ\nRV9DUk9TUykKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9OICgxID0gMSki\nKTsKCiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioKICAgICAq\nIFVzZSB0aGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0byBjcmVhdGUgU1FMIGpv\naW5pbmcgaXRzIHRhYmxlcyBpbgogICAgICogdGhlIGRhdGFiYXNlJ3MgbmF0\naXZlIHN5bnRheC4gVGhyb3dzIGFuIGV4Y2VwdGlvbiBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvTmF0aXZlSm9pbihKb2lu\nIGpvaW4pIHsKICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRp\nb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgaWYgdGhlIGdp\ndmVuIGZvcmVpZ24ga2V5IGNhbiBiZSBlYWdlcmx5IGxvYWRlZCB1c2luZyBv\ndGhlciBqb2lucy4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gY2FuT3V0\nZXJKb2luKGludCBzeW50YXgsIEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBy\nZXR1cm4gc3ludGF4ICE9IFNZTlRBWF9UUkFESVRJT05BTDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGNvbXBvbmVudHMgaW50\nbyBhIFNFTEVDVCBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxC\ndWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNR\nTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1\nZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29sZWFu\nIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9u\nZyBlbmQpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24oZ2V0U2VsZWN0\nT3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwgd2hlcmUsCiAgICAg\nICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwgc3RhcnQs\nIGVuZCwKICAgICAgICAgICAgZ2V0Rm9yVXBkYXRlQ2xhdXNlKGZldGNoLCBm\nb3JVcGRhdGUsIG51bGwpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbWJp\nbmUgdGhlIGdpdmVuIGNvbXBvbmVudHMgaW50byBhIFNFTEVDVCBzdGF0ZW1l\nbnQuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FM\nQnVmZmVyIHNlbGVjdHMsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nCiAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FM\nQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1\nZmZlciBvcmRlciwKICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBib29sZWFu\nIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgYm9v\nbGVhbiBzdWJzZWxlY3QpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24o\nZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwgd2hl\ncmUsCiAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5j\ndCwgc3RhcnQsIGVuZCwKICAgICAgICAgICAgZ2V0Rm9yVXBkYXRlQ2xhdXNl\nKGZldGNoLCBmb3JVcGRhdGUsIG51bGwpLCBzdWJzZWxlY3QpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZlciBz\nZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAg\nICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZm\nZXIgZ3JvdXAsCiAgICAgICAgICAgIFNRTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1\nZmZlciBvcmRlciwKICAgICAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9v\nbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAg\nICAgICBib29sZWFuIHN1YnNlbGVjdCwgYm9vbGVhbiBjaGVja1RhYmxlRm9y\nVXBkYXRlKSB7CiAgICAgICAgICAgIHJldHVybiB0b09wZXJhdGlvbihnZXRT\nZWxlY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwK\nICAgICAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5j\ndCwgc3RhcnQsIGVuZCwKICAgICAgICAgICAgICAgIGdldEZvclVwZGF0ZUNs\nYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxsKSwgc3Vic2VsZWN0LCBjaGVj\na1RhYmxlRm9yVXBkYXRlKTsKICAgICAgICB9CgogICAgLyoqCiAgICAgKiBD\nb21iaW5lIHRoZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBTRUxFQ1Qgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0\nKFNRTEJ1ZmZlciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUs\nIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBT\nUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9v\nbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kCiAgICAgICAg\nLCBTZWxlY3Qgc2VsKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdl\ndFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJl\nLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlzdGluY3Qs\nIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNsYXVzZShm\nZXRjaCwgZm9yVXBkYXRlLCBzZWwpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEdldCB0aGUgdXBkYXRlIGNsYXVzZSBmb3IgdGhlIHF1ZXJ5IGJhc2VkIG9u\nIHRoZQogICAgICogdXBkYXRlQ2xhdXNlIGFuZCBpc29sYXRpb25MZXZlbCBo\naW50cwogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldEZvclVwZGF0\nZUNsYXVzZShKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAg\nIGJvb2xlYW4gaXNGb3JVcGRhdGUsIFNlbGVjdCBzZWwpIHsKICAgICAgICBp\nZiAoZmV0Y2ggIT0gbnVsbCAmJiBmZXRjaC5nZXRJc29sYXRpb24oKSAhPSAt\nMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgImlzb2xhdGlvbi1sZXZl\nbC1jb25maWctbm90LXN1cHBvcnRlZCIsIGdldENsYXNzKCkuZ2V0TmFtZSgp\nKSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0ZvclVwZGF0ZSAmJiAhc2ltdWxh\ndGVMb2NraW5nKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9y\ndHNTZWxlY3RGb3JVcGRhdGUsICJTdXBwb3J0c1NlbGVjdEZvclVwZGF0ZSIp\nOwogICAgICAgICAgICByZXR1cm4gZm9yVXBkYXRlQ2xhdXNlOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgIlNFTEVDVCIgb3Bl\ncmF0aW9uIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFpbGFibGUgaGludHMsIGV0\nYy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTZWxlY3RPcGVyYXRp\nb24oSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJl\ndHVybiAiU0VMRUNUIjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAg\nICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihTdHJpbmcg\nb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZlciBmcm9t\nLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVy\nIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xlYW4gZGlz\ndGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0cmluZyBm\nb3JVcGRhdGVDbGF1c2UpIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24o\nb3AsIHNlbGVjdHMsIGZyb20sIHdoZXJlLCBncm91cCwgaGF2aW5nLCBvcmRl\nciwKICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0LCBlbmQsIGZvclVwZGF0\nZUNsYXVzZSwgZmFsc2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJhdGlvbihT\ndHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNRTEJ1ZmZl\nciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FM\nQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIsIGJvb2xl\nYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFN0\ncmluZyBmb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAg\nICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBmcm9tLCB3\naGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAgICAgICAgICBk\naXN0aW5jdCwgc3RhcnQsIGVuZCwgZm9yVXBkYXRlQ2xhdXNlLCBzdWJzZWxl\nY3QsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJhdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9w\nLCBTUUxCdWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwg\nU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBo\nYXZpbmcsCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3Rp\nbmN0LCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9y\nVXBkYXRlQ2xhdXNlLCBib29sZWFuIHN1YnNlbGVjdCwgYm9vbGVhbiBjaGVj\na1RhYmxlRm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5l\ndyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgYnVmLmFwcGVuZChvcCk7Cgog\nICAgICAgIGJvb2xlYW4gcmFuZ2UgPSBzdGFydCAhPSAwIHx8IGVuZCAhPSBM\nb25nLk1BWF9WQUxVRTsKICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3Np\ndGlvbiA9PSBSQU5HRV9QUkVfRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVu\nZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKICAg\nICAgICBpZiAoZGlzdGluY3QpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBE\nSVNUSU5DVCIpOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9u\nID09IFJBTkdFX1BPU1RfRElTVElOQ1QpCiAgICAgICAgICAgIGFwcGVuZFNl\nbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2VsZWN0KTsKCiAgICAg\nICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChzZWxlY3RzKS5hcHBlbmQoIiBG\nUk9NICIpLmFwcGVuZChmcm9tKTsKCiAgICAgICAgaWYgKGNoZWNrVGFibGVG\nb3JVcGRhdGUKICAgICAgICAgICAgICAgICYmIChTdHJpbmdVdGlscy5pc0Vt\ncHR5KGZvclVwZGF0ZUNsYXVzZSkgJiYgIVN0cmluZ1V0aWxzCiAgICAgICAg\nICAgICAgICAgICAgICAgIC5pc0VtcHR5KHRhYmxlRm9yVXBkYXRlQ2xhdXNl\nKSkpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJs\nZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hl\ncmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgV0hFUkUgIikuYXBwZW5kKHdoZXJlKTsKICAgICAgICBp\nZiAoZ3JvdXAgIT0gbnVsbCAmJiAhZ3JvdXAuaXNFbXB0eSgpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgR1JPVVAgQlkgIikuYXBwZW5kKGdyb3VwKTsK\nICAgICAgICBpZiAoaGF2aW5nICE9IG51bGwgJiYgIWhhdmluZy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c0hhdmlu\nZywgIlN1cHBvcnRzSGF2aW5nIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBIQVZJTkcgIikuYXBwZW5kKGhhdmluZyk7CiAgICAgICAgfQogICAgICAg\nIGlmIChvcmRlciAhPSBudWxsICYmICFvcmRlci5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBPUkRFUiBCWSAiKS5hcHBlbmQob3JkZXIp\nOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0aW9uID09IFJBTkdF\nX1BPU1RfU0VMRUNUKQogICAgICAgICAgICBhcHBlbmRTZWxlY3RSYW5nZShi\ndWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAgICAgaWYgKGZvclVw\nZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nIikuYXBwZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgaWYgKHJhbmdl\nICYmIHJhbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9MT0NLKQogICAgICAg\nICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNl\nbGVjdCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICAvKioKICAg\nICAqIElmIHRoaXMgZGljdGlvbmFyeSBjYW4gc2VsZWN0IHJhbmdlcywKICAg\nICAqIHVzZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgdGhlIHJhbmdlIFNRTC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kU2VsZWN0UmFuZ2Uo\nU1FMQnVmZmVyIGJ1ZiwgbG9uZyBzdGFydCwgbG9uZyBlbmQKICAgICAgICAs\nIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0\nd2VlbiB0aGUgU0VMRUNUIGtleXdvcmQKICAgICAqIGFuZCB0aGUgRlJPTSBr\nZXl3b3JkLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNl\nbGVjdHMoU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJz\nLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gYXBw\nZW5kIHRoZSBhbGlhc2VzIGZvciBhbGwgdGhlIGNvbHVtbnMKICAgICAgICBT\nUUxCdWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAg\nICAgICBMaXN0IGFsaWFzZXM7CiAgICAgICAgaWYgKGRpc3RpbmN0SWRlbnRp\nZmllcnMpCiAgICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0SWRlbnRpZmll\nckFsaWFzZXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFsaWFzZXMg\nPSBzZWwuZ2V0U2VsZWN0QWxpYXNlcygpOwoKICAgICAgICBPYmplY3QgYWxp\nYXM7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhbGlhc2VzLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFsaWFzID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGFsaWFzIGluc3RhbmNlb2Yg\nU1FMQnVmZmVyKQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgo\nU1FMQnVmZmVyKSBhbGlhcyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoYWxpYXMudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAg\nc2VsZWN0U1FMLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHNlbGVjdFNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndHJ1ZSBpZiBhICJGT1IgVVBEQVRFIiBjbGF1c2UgY2FuIGJlIHVzZWQgZm9y\nIHRoZSBzcGVjaWZpZWQKICAgICAqIFNlbGVjdCBvYmplY3QuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZyhTZWxlY3Qgc2Vs\nKSB7CiAgICAgICAgaWYgKHNlbC5pc0FnZ3JlZ2F0ZSgpKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NlbGVjdEZv\nclVwZGF0ZSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nICghc3VwcG9ydHNMb2NraW5nV2l0aFNlbGVjdFJhbmdlICYmIChzZWwuZ2V0\nU3RhcnRJbmRleCgpICE9IDAKICAgICAgICAgICAgfHwgc2VsLmdldEVuZElu\nZGV4KCkgIT0gTG9uZy5NQVhfVkFMVUUpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIG9ubHkgaW5uZXIgc2VsZWN0IGlzIGxvY2tl\nZAogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAg\nICAgICAgICAgIHNlbCA9IHNlbC5nZXRGcm9tU2VsZWN0KCk7CgogICAgICAg\nIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aERpc3RpbmN0Q2xhdXNlICYmIHNl\nbC5pc0Rpc3RpbmN0KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcwog\nICAgICAgICAgICAmJiBzZWwuZ2V0VGFibGVBbGlhc2VzKCkuc2l6ZSgpID4g\nMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3Vw\ncG9ydHNMb2NraW5nV2l0aE9yZGVyQ2xhdXNlICYmIHNlbC5nZXRPcmRlcmlu\nZygpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gfHwgIXN1cHBv\ncnRzTG9ja2luZ1dpdGhJbm5lckpvaW4pIHsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBKb2luIGpvaW4gPSAoSm9pbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICghc3VwcG9ydHNMb2Nr\naW5nV2l0aE91dGVySm9pbgogICAgICAgICAgICAgICAgICAgICYmIGpvaW4u\nZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIXN1cHBv\ncnRzTG9ja2luZ1dpdGhJbm5lckpvaW4KICAgICAgICAgICAgICAgICAgICAm\nJiBqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGZhbHNlIGlmIHRoZSBnaXZlbiBzZWxlY3QgcmVxdWlyZXMg\nYSBmb3J3YXJkLW9ubHkgcmVzdWx0IHNldC4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQoU2VsZWN0\nIHNlbCwKICAgICAgICBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIHJl\ndHVybiAhc2VsLmlzQWdncmVnYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGUgZ2l2ZW4gZGljdGlvbmFyeSBmbGFnIGlzIHRy\ndWUuIElmIGl0IGlzIG5vdCB0cnVlLAogICAgICogdGhyb3cgYW4gZXJyb3Ig\nc2F5aW5nIHRoYXQgdGhlIGdpdmVuIHNldHRpbmcgbmVlZHMgdG8gcmV0dXJu\nIHRydWUgZm9yCiAgICAgKiB0aGUgY3VycmVudCBvcGVyYXRpb24gdG8gd29y\nay4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0U3VwcG9ydChib29s\nZWFuIGZlYXR1cmUsIFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIGlmICgh\nZmVhdHVyZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJmZWF0dXJlLW5vdC1zdXBwb3J0ZWQiLAogICAg\nICAgICAgICAgICAgZ2V0Q2xhc3MoKSwgcHJvcGVydHkpKTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUXVlcnkgZnVuY3Rpb25z\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogSW52\nb2tlIHRoaXMgZGF0YWJhc2UncyBzdWJzdHJpbmcgZnVuY3Rpb24uCiAgICAg\nKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0\naGUgc3Vic3RyaW5nIGludm9jYXRpb24gdG8KICAgICAqIEBwYXJhbSBzdHIg\nYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHRhcmdldCBzdHJpbmcK\nICAgICAqIEBwYXJhbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGlu\nZyB0aGUgc3RhcnQgaW5kZXgKICAgICAqIEBwYXJhbSBlbmQgYSBxdWVyeSB2\nYWx1ZSByZXByZXNlbnRpbmcgdGhlIGVuZCBpbmRleCwgb3IgbnVsbCBmb3Ig\nbm9uZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzdWJzdHJpbmcoU1FMQnVm\nZmVyIGJ1ZiwgRmlsdGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBzdGFydCwK\nICAgICAgICBGaWx0ZXJWYWx1ZSBlbmQpIHsKICAgICAgICBidWYuYXBwZW5k\nKHN1YnN0cmluZ0Z1bmN0aW9uTmFtZSkuYXBwZW5kKCIoKCIpOwogICAgICAg\nIHN0ci5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiksICgi\nKTsKICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIiArIDEpIik7CiAgICAgICAgaWYgKGVuZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiwgKCIpOwogICAgICAgICAgICBlbmQu\nYXBwZW5kVG8oYnVmKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIC0gKCIp\nOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKCIpKSIpOwogICAgICAgIH0KICAgICAgICBidWYuYXBw\nZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhpcyBk\nYXRhYmFzZSdzIGluZGV4T2YgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBh\ncmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgaW5kZXhPZiBp\nbnZvY2F0aW9uIHRvCiAgICAgKiBAcGFyYW0gc3RyIGEgcXVlcnkgdmFsdWUg\ncmVwcmVzZW50aW5nIHRoZSB0YXJnZXQgc3RyaW5nCiAgICAgKiBAcGFyYW0g\nZmluZCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgc2VhcmNoIHN0\ncmluZwogICAgICogQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUgcmVwcmVz\nZW50aW5nIHRoZSBzdGFydCBpbmRleCwgb3IgbnVsbAogICAgICogdG8gc3Rh\ncnQgYXQgdGhlIGJlZ2lubmluZwogICAgICovCiAgICBwdWJsaWMgdm9pZCBp\nbmRleE9mKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHN0ciwgRmlsdGVy\nVmFsdWUgZmluZCwKICAgICAgICBGaWx0ZXJWYWx1ZSBzdGFydCkgewogICAg\nICAgIGJ1Zi5hcHBlbmQoIihJTlNUUigoIik7CiAgICAgICAgaWYgKHN0YXJ0\nICE9IG51bGwpCiAgICAgICAgICAgIHN1YnN0cmluZyhidWYsIHN0ciwgc3Rh\ncnQsIG51bGwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RyLmFwcGVu\nZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiKSwgKCIpOwogICAgICAg\nIGZpbmQuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIpKSAt\nIDEiKTsKICAgICAgICBpZiAoc3RhcnQgIT0gbnVsbCkgewogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgKyAiKTsKICAgICAgICAgICAgc3RhcnQuYXBwZW5k\nVG8oYnVmKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgiKSIpOwog\nICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIHRoZSBudW1lcmljIHBhcnRz\nIG9mIGEgbWF0aGVtYXRpY2FsIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEBw\nYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIG1hdGggZnVu\nY3Rpb24KICAgICAqIEBwYXJhbSBvcCB0aGUgbWF0aGVtYXRpY2FsIG9wZXJh\ndGlvbiB0byBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhh\nbmQgc2lkZSBvZiB0aGUgbWF0aCBmdW5jdGlvbgogICAgICogQHBhcmFtIHJo\ncyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBtYXRoIGZ1bmN0aW9uCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIG1hdGhGdW5jdGlvbihTUUxCdWZmZXIg\nYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAgICBGaWx0\nZXJWYWx1ZSByaHMpIHsKICAgICAgICBib29sZWFuIGNhc3RsaHMgPSBmYWxz\nZTsKICAgICAgICBib29sZWFuIGNhc3RyaHMgPSBmYWxzZTsKICAgICAgICBD\nbGFzcyBsYyA9IEZpbHRlcnMud3JhcChsaHMuZ2V0VHlwZSgpKTsKICAgICAg\nICBDbGFzcyByYyA9IEZpbHRlcnMud3JhcChyaHMuZ2V0VHlwZSgpKTsKICAg\nICAgICBpbnQgdHlwZSA9IDA7CiAgICAgICAgaWYgKHJlcXVpcmVzQ2FzdEZv\nck1hdGhGdW5jdGlvbnMgJiYgKGxjICE9IHJjCiAgICAgICAgICAgIHx8IChs\naHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpKSkgewogICAg\nICAgICAgICBDbGFzcyBjID0gRmlsdGVycy5wcm9tb3RlKGxjLCByYyk7CiAg\nICAgICAgICAgIHR5cGUgPSBnZXRKREJDVHlwZShKYXZhVHlwZXMuZ2V0VHlw\nZUNvZGUoYyksIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0gVHlw\nZXMuVkFSQklOQVJZICYmIHR5cGUgIT0gVHlwZXMuQkxPQikgewogICAgICAg\nICAgICAgICAgY2FzdGxocyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5p\nc0NvbnN0YW50KCkpIHx8IGxjICE9IGM7CiAgICAgICAgICAgICAgICBjYXN0\ncmhzID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkg\nfHwgcmMgIT0gYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nYm9vbGVhbiBtb2QgPSAiTU9EIi5lcXVhbHMob3ApOwogICAgICAgIGlmICht\nb2QpIHsKICAgICAgICAgICAgaWYgKHN1cHBvcnRzTW9kT3BlcmF0b3IpCiAg\nICAgICAgICAgICAgICBvcCA9ICIlIjsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChvcCk7CiAgICAgICAgfQogICAgICAg\nIGJ1Zi5hcHBlbmQoIigiKTsKCiAgICAgICAgaWYgKGNhc3RsaHMpCiAgICAg\nICAgICAgIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5cGUpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7CgogICAgICAgIGlm\nIChtb2QgJiYgIXN1cHBvcnRzTW9kT3BlcmF0b3IpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiwgIik7CiAgICAgICAgZWxzZQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAiKTsKCiAgICAgICAg\naWYgKGNhc3RyaHMpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCByaHMs\nIHR5cGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmhzLmFwcGVuZFRv\nKGJ1Zik7CgogICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFwcGVuZCBhIGNvbXBhcmlzb24uCiAgICAgKgogICAgICog\nQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFy\naXNvbgogICAgICogQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlv\nbiB0byBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQg\nc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIHJocyB0aGUg\ncmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGNvbXBhcmlzb24oU1FMQnVmZmVyIGJ1ZiwgU3RyaW5n\nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVyVmFsdWUgcmhz\nKSB7CiAgICAgICAgYm9vbGVhbiBsaHN4bWwgPSBsaHMuZ2V0WFBhdGgoKSAh\nPSBudWxsOwogICAgICAgIGJvb2xlYW4gcmhzeG1sID0gcmhzLmdldFhQYXRo\nKCkgIT0gbnVsbDsKICAgICAgICBpZiAobGhzeG1sIHx8IHJoc3htbCkgewog\nICAgICAgICAgICBhcHBlbmRYbWxDb21wYXJpc29uKGJ1Ziwgb3AsIGxocywg\ncmhzLCBsaHN4bWwsIHJoc3htbCk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CiAgICAgICAgYm9vbGVhbiBjYXN0bGhzID0gZmFsc2U7CiAgICAg\nICAgYm9vbGVhbiBjYXN0cmhzID0gZmFsc2U7CiAgICAgICAgQ2xhc3MgbGMg\nPSBGaWx0ZXJzLndyYXAobGhzLmdldFR5cGUoKSk7CiAgICAgICAgQ2xhc3Mg\ncmMgPSBGaWx0ZXJzLndyYXAocmhzLmdldFR5cGUoKSk7CiAgICAgICAgaW50\nIHR5cGUgPSAwOwogICAgICAgIGlmIChyZXF1aXJlc0Nhc3RGb3JDb21wYXJp\nc29ucyAmJiAobGMgIT0gcmMKICAgICAgICAgICAgfHwgKGxocy5pc0NvbnN0\nYW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkpKSB7CiAgICAgICAgICAgIENs\nYXNzIGMgPSBGaWx0ZXJzLnByb21vdGUobGMsIHJjKTsKICAgICAgICAgICAg\ndHlwZSA9IGdldEpEQkNUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZShjKSwg\nZmFsc2UpOwogICAgICAgICAgICBpZiAodHlwZSAhPSBUeXBlcy5WQVJCSU5B\nUlkgJiYgdHlwZSAhPSBUeXBlcy5CTE9CKSB7CiAgICAgICAgICAgICAgICBj\nYXN0bGhzID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQo\nKSkgfHwgbGMgIT0gYzsKICAgICAgICAgICAgICAgIGNhc3RyaHMgPSAobGhz\nLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8fCByYyAhPSBj\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY2FzdGxo\ncykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIGxocywgdHlwZSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBsaHMuYXBwZW5kVG8oYnVmKTsKCiAg\nICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7\nCgogICAgICAgIGlmIChjYXN0cmhzKQogICAgICAgICAgICBhcHBlbmRDYXN0\nKGJ1ZiwgcmhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJo\ncy5hcHBlbmRUbyhidWYpOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhp\ncyBkaWN0aW9uYXJ5IHN1cHBvcnRzIFhNTCB0eXBlLAogICAgICogdXNlIHRo\naXMgbWV0aG9kIHRvIGFwcGVuZCB4bWwgcHJlZGljYXRlLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBhcHBlbmRYbWxDb21wYXJpc29uKFNRTEJ1ZmZlciBi\ndWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAgIEZpbHRl\nclZhbHVlIHJocywgYm9vbGVhbiBsaHN4bWwsIGJvb2xlYW4gcmhzeG1sKSB7\nCiAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1hNTENvbHVtbiwgIlN1\ncHBvcnRzWE1MQ29sdW1uIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBl\nbmQgU1FMIGZvciB0aGUgZ2l2ZW4gbnVtZXJpYyB2YWx1ZSB0byB0aGUgYnVm\nZmVyLCBjYXN0aW5nIGFzIG5lZWRlZC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIHZvaWQgYXBwZW5kTnVtZXJpY0Nhc3QoU1FMQnVmZmVyIGJ1ZiwgRmlsdGVy\nVmFsdWUgdmFsKSB7CiAgICAgICAgaWYgKHZhbC5pc0NvbnN0YW50KCkpCiAg\nICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCB2YWwsIFR5cGVzLk5VTUVSSUMp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFsLmFwcGVuZFRvKGJ1Zik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDYXN0IHRoZSBzcGVjaWZpZWQgdmFs\ndWUgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICoKICAgICAqIEBwYXJh\nbSBidWYgdGhlIGJ1ZmZlciB0byBhcHBlbmQgdGhlIGNhc3QgdG8KICAgICAq\nIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGNhc3QKICAgICAqIEBwYXJhbSB0\neXBlIHRoZSB0eXBlIG9mIHRoZSBjYXNlLCBlLmcuIHtAbGluayBUeXBlcyNO\nVU1FUklDfQogICAgICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRDYXN0KFNR\nTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHZhbCwgaW50IHR5cGUpIHsKICAg\nICAgICAvLyBDb252ZXJ0IHRoZSBjYXN0IGZ1bmN0aW9uOiAiQ0FTVCh7MH0g\nQVMgezF9KSIKICAgICAgICBpbnQgZmlyc3RQYXJhbSA9IGNhc3RGdW5jdGlv\nbi5pbmRleE9mKCJ7MH0iKTsKICAgICAgICBTdHJpbmcgcHJlID0gY2FzdEZ1\nbmN0aW9uLnN1YnN0cmluZygwLCBmaXJzdFBhcmFtKTsgLy8gIkNBU1QoIgog\nICAgICAgIFN0cmluZyBtaWQgPSBjYXN0RnVuY3Rpb24uc3Vic3RyaW5nKGZp\ncnN0UGFyYW0gKyAzKTsKICAgICAgICBpbnQgc2Vjb25kUGFyYW0gPSBtaWQu\naW5kZXhPZigiezF9Iik7CiAgICAgICAgU3RyaW5nIHBvc3Q7CiAgICAgICAg\naWYgKHNlY29uZFBhcmFtID4gLTEpIHsKICAgICAgICAgICAgcG9zdCA9IG1p\nZC5zdWJzdHJpbmcoc2Vjb25kUGFyYW0gKyAzKTsgLy8gIikiCiAgICAgICAg\nICAgIG1pZCA9IG1pZC5zdWJzdHJpbmcoMCwgc2Vjb25kUGFyYW0pOyAvLyAi\nIEFTICIKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcG9zdCA9ICIiOwoK\nICAgICAgICBidWYuYXBwZW5kKHByZSk7CiAgICAgICAgdmFsLmFwcGVuZFRv\nKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZChtaWQpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoZ2V0VHlwZU5hbWUodHlwZSkpOwogICAgICAgIGFwcGVuZExlbmd0\naChidWYsIHR5cGUpOwogICAgICAgIGJ1Zi5hcHBlbmQocG9zdCk7CiAgICB9\nCiAgICAKICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZExlbmd0aChTUUxCdWZm\nZXIgYnVmLCBpbnQgdHlwZSkgeyAgICAgICAgCiAgICB9CgogICAgCiAgICAv\nKioKICAgICAqIGFkZCBDQVNUIGZvciBhIGZ1bmN0aW9uIG9wZXJhdG9yIHdo\nZXJlIG9wZXJhbmQgaXMgYSBwYXJhbQogICAgICogQHBhcmFtIGZ1bmMgIGZ1\nbmN0aW9uIG5hbWUKICAgICAqIEBwYXJhbSB2YWwgCiAgICAgKiBAcmV0dXJu\nIHVwZGF0ZWQgZnVuYwogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGFkZENh\nc3RBc1R5cGUoU3RyaW5nIGZ1bmMsIFZhbCB2YWwpIHsKICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0gICAgCgoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBE\nREwgU1FMCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogSW5jcmVt\nZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgYW55IHRhYmxlIGNvbXBvbmVu\ndHMgdGhhdCB0aGlzCiAgICAgKiBkaWN0aW9uYXJ5IGFkZHMgdGhhdCBhcmUg\nbm90IHVzZWQgYnkgbWFwcGluZ3MuIERvZXMgbm90aGluZyBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWZTY2hlbWFDb21wb25lbnRz\nKFRhYmxlIHRhYmxlKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBpbmNsdWRpbmcgdGhlIHNj\naGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxpbmsgI2NhdGFsb2dTZXBh\ncmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFt\nZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dpY2FsKSB7CiAgICAgICAgaWYg\nKCF1c2VTY2hlbWFOYW1lIHx8IHRhYmxlLmdldFNjaGVtYU5hbWUoKSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gdGFibGUuZ2V0TmFtZSgpOwogICAg\nICAgIGlmIChsb2dpY2FsIHx8ICIuIi5lcXVhbHMoY2F0YWxvZ1NlcGFyYXRv\ncikpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5nZXRGdWxsTmFtZSgpOwog\nICAgICAgIHJldHVybiB0YWJsZS5nZXRTY2hlbWFOYW1lKCkgKyBjYXRhbG9n\nU2VwYXJhdG9yICsgdGFibGUuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgZnVsbCBuYW1lIG9mIHRoZSBpbmRleCwgaW5j\nbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGltaXRlZAogICAgICogYnkgdGhlIHJl\nc3VsdCBvZiB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAgICAqLwog\nICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJbmRleCBpbmRleCkgewog\nICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBpbmRleC5nZXRTY2hlbWFO\nYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGluZGV4LmdldE5h\nbWUoKTsKICAgICAgICBpZiAoIi4iLmVxdWFscyhjYXRhbG9nU2VwYXJhdG9y\nKSkKICAgICAgICAgICAgcmV0dXJuIGluZGV4LmdldEZ1bGxOYW1lKCk7CiAg\nICAgICAgcmV0dXJuIGluZGV4LmdldFNjaGVtYU5hbWUoKSArIGNhdGFsb2dT\nZXBhcmF0b3IgKyBpbmRleC5nZXROYW1lKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHNlcXVlbmNlLCBp\nbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB0aGUg\ncmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1bGxOYW1lKFNlcXVlbmNlIHNlcSkg\newogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBzZXEuZ2V0U2NoZW1h\nTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBzZXEuZ2V0TmFt\nZSgpOwogICAgICAgIGlmICgiLiIuZXF1YWxzKGNhdGFsb2dTZXBhcmF0b3Ip\nKQogICAgICAgICAgICByZXR1cm4gc2VxLmdldEZ1bGxOYW1lKCk7CiAgICAg\nICAgcmV0dXJuIHNlcS5nZXRTY2hlbWFOYW1lKCkgKyBjYXRhbG9nU2VwYXJh\ndG9yICsgc2VxLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB0YWJsZSBu\nYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBE\nQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFRhYmxlTmFt\nZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHdoaWxl\nIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5h\nbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlk\nKG5hbWUsIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBt\nYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfVEFCTEUpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9y\nIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFZhbGlkU2VxdWVuY2VOYW1lKFN0cmluZyBuYW1lLCBTY2hlbWEgc2NoZW1h\nKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAg\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgcmV0\ndXJuIG1ha2VOYW1lVmFsaWQoIlNfIiArIG5hbWUsIHNjaGVtYS5nZXRTY2hl\nbWFHcm91cCgpLAogICAgICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGgsIE5B\nTUVfU0VRVUVOQ0UpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkg\nbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGNvbHVtbiBuYW1lIHRv\nIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBEQi4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZENvbHVtbk5hbWUoU3Ry\naW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUu\nc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJz\ndHJpbmcoMSk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQobmFtZSwg\ndGFibGUsIG1heENvbHVtbk5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRv\nIHRoZSBnaXZlbiBwcmltYXJ5IGtleSBuYW1lIHRvIG1ha2UgaXQKICAgICAq\nIHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRWYWxpZFByaW1hcnlLZXlOYW1lKFN0cmluZyBuYW1lLCBU\nYWJsZSB0YWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgo\nIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwog\nICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJQXyIgKyBuYW1lLCB0YWJs\nZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhl\nIGdpdmVuIGZvcmVpZ24ga2V5IG5hbWUgdG8gbWFrZSBpdAogICAgICogdmFs\naWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFZhbGlkRm9yZWlnbktleU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxl\nIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsKICAgICAgICB3aGls\nZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAgIG5hbWUgPSBu\nYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0g\ndGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4gPSBNYXRoLm1pbih0\nYWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIG5hbWUgPSAiRl8iICsg\nc2hvcnRlbih0YWJsZU5hbWUsIGxlbikgKyAiXyIgKyBuYW1lOwogICAgICAg\nIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLmdldFNjaGVtYSgp\nLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heENvbnN0cmFpbnRO\nYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gaW5kZXgg\nbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQg\nREIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRJbmRleE5h\nbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgd2hpbGUg\nKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9IHRh\nYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5taW4odGFi\nbGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIklfIiArIHNo\nb3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAgICAgICBy\nZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5n\nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhJbmRleE5hbWVMZW5n\ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55\nIG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB1bmlxdWUgY29uc3Ry\nYWludCBuYW1lIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkIGZvciB0aGUgY3Vy\ncmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFVu\naXF1ZU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\nd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1l\nID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxlTmFt\nZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0aC5t\naW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0gIlVf\nIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsKICAg\nICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRTY2hl\nbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhDb25zdHJh\naW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2hvcnRlbiB0aGUgc3BlY2lmaWVkIG5hbWUgdG8gdGhlIHNwZWNpZmll\nZCB0YXJnZXQgbmFtZS4gVGhpcyB3aWxsCiAgICAgKiBiZSBkb25lIGJ5IGZp\ncnN0IHN0cmlwcGluZyBvdXQgdGhlIHZvd2VscywgYW5kIHRoZW4gcmVtb3Zp\nbmcKICAgICAqIGNoYXJhY3RlcnMgZnJvbSB0aGUgbWlkZGxlIG9mIHRoZSB3\nb3JkIHVudGlsIGl0IHJlYWNoZXMgdGhlIHRhcmdldAogICAgICogbGVuZ3Ro\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIFN0cmluZyBzaG9ydGVu\nKFN0cmluZyBuYW1lLCBpbnQgdGFyZ2V0TGVuZ3RoKSB7CiAgICAgICAgaWYg\nKG5hbWUgPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpIDw9IHRhcmdldExlbmd0\naCkKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CgogICAgICAgIFN0cmluZ0J1\nZmZlciBubSA9IG5ldyBTdHJpbmdCdWZmZXIobmFtZSk7CiAgICAgICAgd2hp\nbGUgKG5tLmxlbmd0aCgpID4gdGFyZ2V0TGVuZ3RoKSB7CiAgICAgICAgICAg\nIGlmICghc3RyaXBWb3dlbChubSkpIHsKICAgICAgICAgICAgICAgIC8vIGN1\ndCBvdXQgdGhlIG1pZGRsZSBjaGFyCiAgICAgICAgICAgICAgICBubS5yZXBs\nYWNlKG5tLmxlbmd0aCgpIC8gMiwgKG5tLmxlbmd0aCgpIC8gMikgKyAxLCAi\nIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5t\nLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdm93\nZWxzIGZyb20gdGhlIHNwZWNpZmllZCBTdHJpbmdCdWZmZXIuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIGFueSB2b3dlbHMgaGF2ZSBiZWVuIHJl\nbW92ZWQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBzdHJp\ncFZvd2VsKFN0cmluZ0J1ZmZlciBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUg\nPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9IHsgJ0EnLCAn\nRScsICdJJywgJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCB2b3dlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaW50IGlu\nZGV4ID0gbmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5kZXhPZih2\nb3dlbHNbaV0pOwogICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEpIHsKICAg\nICAgICAgICAgICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5kZXggKyAxLCAi\nIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2\nZW4gbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0\nIGlzIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBh\ncHBlbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdp\ndGggYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhlIGxhc3QKICAg\nICAqIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuICcxJywg\nZXRjLgogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVuIG1heSBi\nZSAwIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAgICogaW5jb21w\nbGV0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBtYWtlTmFtZVZh\nbGlkKFN0cmluZyBuYW1lLCBOYW1lU2V0IHNldCwgaW50IG1heExlbiwKICAg\nICAgICBpbnQgbmFtZVR5cGUpIHsKICAgICAgICBpZiAobWF4TGVuIDwgMSkK\nICAgICAgICAgICAgbWF4TGVuID0gMjU1OwogICAgICAgIGlmIChuYW1lLmxl\nbmd0aCgpID4gbWF4TGVuKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJz\ndHJpbmcoMCwgbWF4TGVuKTsKICAgICAgICBpZiAocmVzZXJ2ZWRXb3JkU2V0\nLmNvbnRhaW5zKG5hbWUudG9VcHBlckNhc2UoKSkpIHsKICAgICAgICAgICAg\naWYgKG5hbWUubGVuZ3RoKCkgPT0gbWF4TGVuKQogICAgICAgICAgICAgICAg\nbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoKCkgLSAxKTsK\nICAgICAgICAgICAgbmFtZSArPSAiMCI7CiAgICAgICAgfQoKICAgICAgICAv\nLyBub3cgbWFrZSBzdXJlIHRoZSBuYW1lIGlzIHVuaXF1ZQogICAgICAgIGlm\nIChzZXQgIT0gbnVsbCkgewogICAgICAgICAgICBvdXRlcjoKICAgICAgICAg\nICAgZm9yIChpbnQgdmVyc2lvbiA9IDEsIGNoYXJzID0gMTsgdHJ1ZTsgdmVy\nc2lvbisrKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgdGFibGUgbmFtZXMs\nIHdlIGNoZWNrIGZvciB0aGUgdGFibGUgaXRzZWxmIGluIGNhc2UgdGhlCiAg\nICAgICAgICAgICAgICAvLyBuYW1lIHNldCBpcyBsYXp5IGFib3V0IHNjaGVt\nYSByZWZsZWN0aW9uCiAgICAgICAgICAgICAgICBzd2l0Y2ggKG5hbWVUeXBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBOQU1FX1RBQkxFOgogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoISgoU2NoZW1hR3JvdXApIHNldCku\naXNLbm93blRhYmxlKG5hbWUpKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTkFNRV9TRVFVRU5DRToKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKCEoKFNjaGVtYUdyb3VwKSBzZXQp\nLmlzS25vd25TZXF1ZW5jZShuYW1lKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrIG91dGVyOwogICAgICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIXNldC5pc05hbWVUYWtlbihuYW1lKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGEgc2luZ2xlIGNoYXIg\nZm9yIHRoZSB2ZXJzaW9uIGlzIHByb2JhYmx5IGVub3VnaCwgYnV0IG1pZ2h0\nCiAgICAgICAgICAgICAgICAvLyBhcyB3ZWxsIGJlIGdlbmVyYWwgYWJvdXQg\naXQuLi4KICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uID4gMSkKICAgICAg\nICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5s\nZW5ndGgoKSAtIGNoYXJzKTsKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9u\nID49IE1hdGgucG93KDEwLCBjaGFycykpCiAgICAgICAgICAgICAgICAgICAg\nY2hhcnMrKzsKICAgICAgICAgICAgICAgIGlmIChuYW1lLmxlbmd0aCgpICsg\nY2hhcnMgPiBtYXhMZW4pCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG5h\nbWUuc3Vic3RyaW5nKDAsIG1heExlbiAtIGNoYXJzKTsKICAgICAgICAgICAg\nICAgIG5hbWUgPSBuYW1lICsgdmVyc2lvbjsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbmFtZS50b1VwcGVyQ2FzZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0\nZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gdGFibGUsIGNvbXBsZXRlCiAg\nICAgKiB3aXRoIGNvbHVtbnMuIEluZGV4ZXMgYW5kIGNvbnN0cmFpbnRzIHdp\nbGwgYmUgY3JlYXRlZCBzZXBhcmF0ZWx5LgogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwoVGFibGUgdGFibGUpIHsKICAg\nICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwog\nICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSBUQUJMRSAiKS5hcHBlbmQoZ2V0\nRnVsbE5hbWUodGFibGUsIGZhbHNlKSkuCiAgICAgICAgICAgIGFwcGVuZCgi\nICgiKTsKCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldENvbHVt\nbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKGkgPiAwKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChn\nZXREZWNsYXJlQ29sdW1uU1FMKGNvbHNbaV0sIGZhbHNlKSk7CiAgICAgICAg\nfQoKICAgICAgICBQcmltYXJ5S2V5IHBrID0gdGFibGUuZ2V0UHJpbWFyeUtl\neSgpOwogICAgICAgIFN0cmluZyBwa1N0cjsKICAgICAgICBpZiAocGsgIT0g\nbnVsbCkgewogICAgICAgICAgICBwa1N0ciA9IGdldFByaW1hcnlLZXlDb25z\ndHJhaW50U1FMKHBrKTsKICAgICAgICAgICAgaWYgKHBrU3RyICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZChwa1N0\ncik7CiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1bnFzID0gdGFibGUu\nZ2V0VW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFTdHI7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwodW5xc1tp\nXSk7CiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiwgIikuYXBwZW5kKHVucVN0cik7CiAgICAg\nICAgfQoKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0\nbyBkcm9wIHRoZSBnaXZlbiB0YWJsZS4gSW5kZXhlcwogICAgICogd2lsbCBi\nZSBkcm9wcGVkIHNlcGFyYXRlbHkuIFJldHVybnMKICAgICAqIDxjb2RlPkRS\nT1AgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcFRhYmxlU1FM\nKFRhYmxlIHRhYmxlKSB7CiAgICAgICAgU3RyaW5nIGRyb3AgPSBNZXNzYWdl\nRm9ybWF0LmZvcm1hdChkcm9wVGFibGVTUUwsIG5ldyBPYmplY3RbXXsKICAg\nICAgICAgICAgZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSB9KTsKICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1tdeyBkcm9wIH07CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8g\nY3JlYXRlIHRoZSBnaXZlbiBzZXF1ZW5jZS4gUmV0dXJucwogICAgICogPGNv\nZGU+Q1JFQVRFIFNFUVVFTkNFICZsdDtzZXF1ZW5jZSBuYW1lJmd0O1sgU1RB\nUlQgV0lUSCAmbHQ7c3RhcnQmZ3Q7XQogICAgICogWyBJTkNSRU1FTlQgQlkg\nJmx0O2luY3JlbWVudCZndDtdPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlU2VxdWVuY2VTUUwoU2Vx\ndWVuY2Ugc2VxKSB7CiAgICAgICAgaWYgKG5leHRTZXF1ZW5jZVF1ZXJ5ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJp\nbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1\nZi5hcHBlbmQoIkNSRUFURSBTRVFVRU5DRSAiKTsKICAgICAgICBidWYuYXBw\nZW5kKGdldEZ1bGxOYW1lKHNlcSkpOwogICAgICAgIGlmIChzZXEuZ2V0SW5p\ndGlhbFZhbHVlKCkgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIFNU\nQVJUIFdJVEggIikuYXBwZW5kKHNlcS5nZXRJbml0aWFsVmFsdWUoKSk7CiAg\nICAgICAgaWYgKHNlcS5nZXRJbmNyZW1lbnQoKSA+IDEpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBJTkNSRU1FTlQgQlkgIikuYXBwZW5kKHNlcS5nZXRJ\nbmNyZW1lbnQoKSk7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVm\nLnRvU3RyaW5nKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZlbiBz\nZXF1ZW5jZS4gUmV0dXJucwogICAgICogPGNvZGU+RFJPUCBTRVFVRU5DRSAm\nbHQ7c2VxdWVuY2UgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wU2VxdWVuY2VTUUwoU2Vx\ndWVuY2Ugc2VxKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkRS\nT1AgU0VRVUVOQ0UgIiArIGdldEZ1bGxOYW1lKHNlcSkgfTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50\ncyB0byBjcmVhdGUgdGhlIGdpdmVuIGluZGV4LiBSZXR1cm5zCiAgICAgKiA8\nY29kZT5DUkVBVEUgW1VOSVFVRV0gSU5ERVggJmx0O2luZGV4IG5hbWUmZ3Q7\nIE9OICZsdDt0YWJsZSBuYW1lJmd0OwogICAgICogKCZsdDtjb2wgbGlzdCZn\ndDspPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0Q3JlYXRlSW5kZXhTUUwoSW5kZXggaW5kZXgpIHsKICAgICAg\nICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIkNSRUFURSAiKTsKICAgICAgICBpZiAoaW5kZXgu\naXNVbmlxdWUoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiVU5JUVVFICIp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIklOREVYICIpLmFwcGVuZChpbmRleC5n\nZXROYW1lKCkpOwoKICAgICAgICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5k\nKGdldEZ1bGxOYW1lKGluZGV4LmdldFRhYmxlKCksIGZhbHNlKSk7CiAgICAg\nICAgYnVmLmFwcGVuZCgiICgiKS5hcHBlbmQoU3RyaW5ncy5qb2luKGluZGV4\nLmdldENvbHVtbnMoKSwgIiwgIikpLgogICAgICAgICAgICBhcHBlbmQoIiki\nKTsKCiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5n\nKCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBv\nZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZlbiBpbmRleC4gUmV0\ndXJucwogICAgICogPGNvZGU+RFJPUCBJTkRFWCAmbHQ7aW5kZXggbmFtZSZn\ndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmdbXSBnZXREcm9wSW5kZXhTUUwoSW5kZXggaW5kZXgpIHsKICAgICAgICBy\nZXR1cm4gbmV3IFN0cmluZ1tdeyAiRFJPUCBJTkRFWCAiICsgZ2V0RnVsbE5h\nbWUoaW5kZXgpIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBz\nZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZlbiBjb2x1\nbW4gdG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5\nIGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLiBSZXR1cm5zCiAgICAgKiA8\nY29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQUREICgmbHQ7\nY29sIGRlYyZndDspPC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZENvbHVtblNRTChDb2x1bW4g\nY29sdW1uKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0FsdGVyVGFibGVXaXRo\nQWRkQ29sdW1uKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsK\nCiAgICAgICAgU3RyaW5nIGRlYyA9IGdldERlY2xhcmVDb2x1bW5TUUwoY29s\ndW1uLCB0cnVlKTsKICAgICAgICBpZiAoZGVjID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVs\nbE5hbWUoY29sdW1uLmdldFRhYmxlKCksIGZhbHNlKSArICIgQUREICIgKyBk\nZWMgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBv\nZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZlbiBjb2x1bW4gZnJv\nbQogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYg\nb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuIFJldHVybnMKICAgICAqIDxjb2Rl\nPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTFVNTiAm\nbHQ7Y29sIG5hbWUmZ3Q7PC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BDb2x1bW5TUUwoQ29s\ndW1uIGNvbHVtbikgewogICAgICAgIGlmICghc3VwcG9ydHNBbHRlclRhYmxl\nV2l0aERyb3BDb2x1bW4pCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5n\nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJM\nRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoY29sdW1uLmdldFRhYmxl\nKCksIGZhbHNlKQogICAgICAgICAgICArICIgRFJPUCBDT0xVTU4gIiArIGNv\nbHVtbiB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVz\nIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gcHJpbWFyeSBr\nZXkgdG8KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5\nIGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8\nY29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQURECiAgICAg\nKiAmbHQ7cGsgY29ucyBzcWwgJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldEFkZFByaW1hcnlLZXlTUUwo\nUHJpbWFyeUtleSBwaykgewogICAgICAgIFN0cmluZyBwa3NxbCA9IGdldFBy\naW1hcnlLZXlDb25zdHJhaW50U1FMKHBrKTsKICAgICAgICBpZiAocGtzcWwg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAg\nICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAg\nICAgICAgICAgKyBnZXRGdWxsTmFtZShway5nZXRUYWJsZSgpLCBmYWxzZSkg\nKyAiIEFERCAiICsgcGtzcWwgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBn\naXZlbiBwcmltYXJ5IGtleSBmcm9tCiAgICAgKiBpdHMgdGFibGUuIFJldHVy\nbiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4K\nICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5h\nbWUmZ3Q7IERST1AgQ09OU1RSQUlOVAogICAgICogJmx0O3BrIG5hbWUmZ3Q7\nPC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nW10gZ2V0RHJvcFByaW1hcnlLZXlTUUwoUHJpbWFyeUtleSBwaykgewogICAg\nICAgIGlmIChway5nZXROYW1lKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShw\nay5nZXRUYWJsZSgpLCBmYWxzZSkKICAgICAgICAgICAgKyAiIERST1AgQ09O\nU1RSQUlOVCAiICsgcGsuZ2V0TmFtZSgpIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gYWRk\nIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0bwogICAgICogaXRzIHRhYmxlLiBS\nZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0\nZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJs\nZSBuYW1lJmd0OyBBREQKICAgICAqICZsdDtmayBjb25zIHNxbCAmZ3Q7PC9j\nb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10g\nZ2V0QWRkRm9yZWlnbktleVNRTChGb3JlaWduS2V5IGZrKSB7CiAgICAgICAg\nU3RyaW5nIGZrU1FMID0gZ2V0Rm9yZWlnbktleUNvbnN0cmFpbnRTUUwoZmsp\nOwogICAgICAgIGlmIChma1NRTCA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1td\neyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKGZr\nLmdldFRhYmxlKCksIGZhbHNlKSArICIgQUREICIgKyBma1NRTCB9OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0\nZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGZyb20KICAg\nICAqIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJh\ndGlvbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8Y29kZT5BTFRF\nUiBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgRFJPUCBDT05TVFJBSU5UCiAg\nICAgKiAmbHQ7ZmsgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wRm9yZWlnbktleVNRTChG\nb3JlaWduS2V5IGZrKSB7CiAgICAgICAgaWYgKGZrLmdldE5hbWUoKSA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAgICAg\nICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAgICAg\nICAgICArIGdldEZ1bGxOYW1lKGZrLmdldFRhYmxlKCksIGZhbHNlKQogICAg\nICAgICAgICArICIgRFJPUCBDT05TVFJBSU5UICIgKyBmay5nZXROYW1lKCkg\nfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRp\nb24gU1FMIGZvciB0aGUgZ2l2ZW4gY29sdW1uLiBUaGlzIG1ldGhvZCBpcyB1\nc2VkCiAgICAgKiBmb3IgZWFjaCBjb2x1bW4gZnJvbSB3aXRoaW4ge0BsaW5r\nICNnZXRDcmVhdGVUYWJsZVNRTH0gYW5kCiAgICAgKiB7QGxpbmsgI2dldEFk\nZENvbHVtblNRTH0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nRGVjbGFyZUNvbHVtblNRTChDb2x1bW4gY29sLCBib29sZWFuIGFsdGVyKSB7\nCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo\nKTsKICAgICAgICBidWYuYXBwZW5kKGNvbCkuYXBwZW5kKCIgIik7CiAgICAg\nICAgYnVmLmFwcGVuZChnZXRUeXBlTmFtZShjb2wpKTsKCiAgICAgICAgLy8g\nY2FuJ3QgYWRkIGNvbnN0cmFpbnRzIHRvIGEgY29sdW1uIHdlJ3JlIGFkZGlu\nZyBhZnRlciB0YWJsZQogICAgICAgIC8vIGNyZWF0aW9uLCBjYXVzZSBzb21l\nIGRhdGEgbWlnaHQgYWxyZWFkeSBiZSBpbnNlcnRlZAogICAgICAgIGlmICgh\nYWx0ZXIpIHsKICAgICAgICAgICAgaWYgKGNvbC5nZXREZWZhdWx0U3RyaW5n\nKCkgIT0gbnVsbCAmJiAhY29sLmlzQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIgREVGQVVMVCAiKS5hcHBlbmQoY29sLmdl\ndERlZmF1bHRTdHJpbmcoKSk7CiAgICAgICAgICAgIGlmIChjb2wuaXNOb3RO\ndWxsKCkpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgTk9UIE5VTEwi\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbC5pc0F1dG9Bc3NpZ25lZCgp\nKSB7CiAgICAgICAgICAgIGlmICghc3VwcG9ydHNBdXRvQXNzaWduKQogICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQtYXV0b2Fz\nc2lnbiIsIHBsYXRmb3JtLCBjb2wpKTsKICAgICAgICAgICAgZWxzZSBpZiAo\nYXV0b0Fzc2lnbkNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiICIpLmFwcGVuZChhdXRvQXNzaWduQ2xhdXNlKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRo\nZSBnaXZlbiBwcmltYXJ5IGtleS4gVGhpcyBtZXRob2QgaXMKICAgICAqIHVz\nZWQgZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0gYW5k\nCiAgICAgKiB7QGxpbmsgI2dldEFkZFByaW1hcnlLZXlTUUx9LiBSZXR1cm5z\nCiAgICAgKiA8Y29kZT5DT05TVFJBSU5UICZsdDtwayBuYW1lJmd0OyBQUklN\nQVJZIEtFWSAoJmx0O2NvbCBsaXN0Jmd0Oyk8L2NvZGU+CiAgICAgKiBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFByaW1h\ncnlLZXlDb25zdHJhaW50U1FMKFByaW1hcnlLZXkgcGspIHsKICAgICAgICAv\nLyBpZiB3ZSBoYXZlIGRpc2FibGVkIHRoZSBjcmVhdGlvbiBvZiBwcmltYXJ5\nIGtleXMsIGFib3J0IGhlcmUKICAgICAgICBpZiAoIWNyZWF0ZVByaW1hcnlL\nZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5n\nIG5hbWUgPSBway5nZXROYW1lKCk7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVs\nbCAmJiByZXNlcnZlZFdvcmRTZXQuY29udGFpbnMobmFtZS50b1VwcGVyQ2Fz\nZSgpKSkKICAgICAgICAgICAgbmFtZSA9IG51bGw7CgogICAgICAgIFN0cmlu\nZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgaWYg\nKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVfQkVGT1JFLmVxdWFscyhjb25z\ndHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJDT05T\nVFJBSU5UICIpLmFwcGVuZChuYW1lKS5hcHBlbmQoIiAiKTsKICAgICAgICBi\ndWYuYXBwZW5kKCJQUklNQVJZIEtFWSAiKTsKICAgICAgICBpZiAobmFtZSAh\nPSBudWxsICYmIENPTlNfTkFNRV9NSUQuZXF1YWxzKGNvbnN0cmFpbnROYW1l\nTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQobmFtZSkuYXBwZW5kKCIg\nIik7CiAgICAgICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJpbmdzLmpv\naW4ocGsuZ2V0Q29sdW1ucygpLCAiLCAiKSkuCiAgICAgICAgICAgIGFwcGVu\nZCgiKSIpOwogICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgQ09OU19OQU1F\nX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBlbmQobmFtZSk7CiAg\nICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZl\nbiBmb3JlaWduIGtleSwgb3IgbnVsbCBpZiBpdCBpcwogICAgICogbm90IHN1\ncHBvcnRlZC4gVGhpcyBtZXRob2QgaXMgdXNlZCBmcm9tIHdpdGhpbgogICAg\nICoge0BsaW5rICNnZXRDcmVhdGVUYWJsZVNRTH0gYW5kIHtAbGluayAjZ2V0\nQWRkRm9yZWlnbktleVNRTH0uIFJldHVybnMKICAgICAqIDxjb2RlPkNPTlNU\nUkFJTlQgJmx0O2NvbnMgbmFtZSZndDsgRk9SRUlHTiBLRVkgKCZsdDtjb2wg\nbGlzdCZndDspCiAgICAgKiBSRUZFUkVOQ0VTICZsdDtmb3JlaWduIHRhYmxl\nJmd0OyAoJmx0O2NvbCBsaXN0Jmd0OykKICAgICAqIFtPTiBERUxFVEUgJmx0\nO2FjdGlvbiZndDtdIFtPTiBVUERBVEUgJmx0O2FjdGlvbiZndDtdPC9jb2Rl\nPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndEZvcmVpZ25LZXlDb25zdHJhaW50U1FMKEZvcmVpZ25LZXkgZmspIHsKICAg\nICAgICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIGlmIChmay5nZXREZWxldGVBY3Rpb24oKSA9\nPSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAoZmsuaXNEZWZlcnJlZCgpICYmICFzdXBwb3J0\nc0RlZmVycmVkRm9yZWlnbktleUNvbnN0cmFpbnRzKCkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGlmICghc3VwcG9ydHNEZWxldGVBY3Rp\nb24oZmsuZ2V0RGVsZXRlQWN0aW9uKCkpCiAgICAgICAgICAgIHx8ICFzdXBw\nb3J0c1VwZGF0ZUFjdGlvbihmay5nZXRVcGRhdGVBY3Rpb24oKSkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1bW5bXSBsb2NhbHMg\nPSBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gZm9yZWlnbnMg\nPSBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICBpbnQgZGVs\nQWN0aW9uSWQgPSBmay5nZXREZWxldGVBY3Rpb24oKTsKICAgICAgICBpZiAo\nZGVsQWN0aW9uSWQgPT0gRm9yZWlnbktleS5BQ1RJT05fTlVMTCkgewogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxvY2Fscy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKGxvY2Fsc1tpXS5pc05vdE51bGwo\nKSkKICAgICAgICAgICAgICAgICAgICBkZWxBY3Rpb25JZCA9IEZvcmVpZ25L\nZXkuQUNUSU9OX05PTkU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIFN0cmluZyBkZWxBY3Rpb24gPSBnZXRBY3Rpb25OYW1lKGRlbEFjdGlv\nbklkKTsKICAgICAgICBTdHJpbmcgdXBBY3Rpb24gPSBnZXRBY3Rpb25OYW1l\nKGZrLmdldFVwZGF0ZUFjdGlvbigpKTsKCiAgICAgICAgU3RyaW5nQnVmZmVy\nIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAoZmsuZ2V0\nTmFtZSgpICE9IG51bGwKICAgICAgICAgICAgJiYgQ09OU19OQU1FX0JFRk9S\nRS5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiQ09OU1RSQUlOVCAiKS5hcHBlbmQoZmsuZ2V0TmFtZSgpKS5h\ncHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5kKCJGT1JFSUdOIEtFWSAi\nKTsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgpICE9IG51bGwgJiYgQ09OU19O\nQU1FX01JRC5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAg\nICAgYnVmLmFwcGVuZChmay5nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBlbmQoU3RyaW5ncy5qb2luKGxvY2Fs\ncywgIiwgIikpLmFwcGVuZCgiKSIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiBS\nRUZFUkVOQ0VTICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0RnVsbE5hbWUo\nZm9yZWlnbnNbMF0uZ2V0VGFibGUoKSwgZmFsc2UpKTsKICAgICAgICBidWYu\nYXBwZW5kKCIgKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4oZm9yZWlnbnMsICIs\nICIpKS5hcHBlbmQoIikiKTsKICAgICAgICBpZiAoZGVsQWN0aW9uICE9IG51\nbGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiBERUxFVEUgIikuYXBw\nZW5kKGRlbEFjdGlvbik7CiAgICAgICAgaWYgKHVwQWN0aW9uICE9IG51bGwp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiBVUERBVEUgIikuYXBwZW5k\nKHVwQWN0aW9uKTsKICAgICAgICBpZiAoZmsuaXNEZWZlcnJlZCgpKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgSU5JVElBTExZIERFRkVSUkVEIik7CiAg\nICAgICAgaWYgKHN1cHBvcnRzRGVmZXJyZWRGb3JlaWduS2V5Q29uc3RyYWlu\ndHMoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIERFRkVSUkFCTEUiKTsK\nICAgICAgICBpZiAoZmsuZ2V0TmFtZSgpICE9IG51bGwKICAgICAgICAgICAg\nJiYgQ09OU19OQU1FX0FGVEVSLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUp\nKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQ09OU1RSQUlOVCAiKS5hcHBl\nbmQoZmsuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5n\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0aGlz\nIGRpY3Rpb25hcnkgc3VwcG9ydHMgZGVmZXJyZWQgZm9yZWlnbiBrZXkgY29u\nc3RyYWludHMuCiAgICAgKiBUaGlzIGltcGxlbWVudGF0aW9uIHJldHVybnMg\ne0BsaW5rICNzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzfS4KICAgICAqCiAg\nICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25LZXlDb25zdHJhaW50cygpIHsK\nICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZlcnJlZENvbnN0cmFpbnRzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBn\naXZlbiBmb3JlaWduIGtleSBhY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nU3RyaW5nIGdldEFjdGlvbk5hbWUoaW50IGFjdGlvbikgewogICAgICAgIHN3\naXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5B\nQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJldHVybiAiQ0FTQ0FE\nRSI7CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoK\nICAgICAgICAgICAgICAgIHJldHVybiAiU0VUIE5VTEwiOwogICAgICAgICAg\nICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFVTFQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gIlNFVCBERUZBVUxUIjsKICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBkYXRhYmFzZSBzdXBw\nb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgZGVsZXRlIGFjdGlvbi4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWxldGVBY3Rpb24o\naW50IGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gRm9yZWlnbktl\neS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAg\nICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBwb3J0c1Jlc3RyaWN0RGVsZXRlQWN0aW9uOwog\nICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NBREU6CiAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNDYXNjYWRlRGVsZXRlQWN0\naW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX05VTEw6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNOdWxsRGVsZXRlQWN0\naW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFV\nTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZhdWx0RGVs\nZXRlQWN0aW9uOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdGhpcyBkYXRhYmFzZSBzdXBwb3J0cyB0aGUgZ2l2ZW4g\nZm9yZWlnbiBrZXkgdXBkYXRlIGFjdGlvbi4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNVcGRhdGVBY3Rpb24oaW50IGFjdGlvbikgewog\nICAgICAgIGlmIChhY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCFzdXBwb3J0\nc0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBGb3JlaWdu\nS2V5LkFDVElPTl9SRVNUUklDVDoKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBwb3J0c1Jlc3RyaWN0VXBkYXRlQWN0aW9uOwogICAgICAgICAgICBjYXNl\nIEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NBREU6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gc3VwcG9ydHNDYXNjYWRlVXBkYXRlQWN0aW9uOwogICAgICAgICAg\nICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX05VTEw6CiAgICAgICAgICAgICAg\nICByZXR1cm4gc3VwcG9ydHNOdWxsVXBkYXRlQWN0aW9uOwogICAgICAgICAg\nICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFVTFQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwcG9ydHNEZWZhdWx0VXBkYXRlQWN0aW9uOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGVjbGFyYXRpb24gU1FMIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGNvbnN0cmFp\nbnQuIFRoaXMKICAgICAqIG1ldGhvZCBpcyB1c2VkIGZyb20gd2l0aGluIHtA\nbGluayAjZ2V0Q3JlYXRlVGFibGVTUUx9LgogICAgICogUmV0dXJucwk8Y29k\nZT5DT05TVFJBSU5UICZsdDtuYW1lJmd0OyBVTklRVUUgKCZsdDtjb2wgbGlz\ndCZndDspPC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFN0cmluZyBnZXRVbmlxdWVDb25zdHJhaW50U1FMKFVuaXF1\nZSB1bnEpIHsKICAgICAgICBpZiAoIXN1cHBvcnRzVW5pcXVlQ29uc3RyYWlu\ndHMKICAgICAgICAgICAgfHwgKHVucS5pc0RlZmVycmVkKCkgJiYgIXN1cHBv\ncnRzRGVmZXJyZWRVbmlxdWVDb25zdHJhaW50cygpKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgaWYgKHVucS5nZXROYW1lKCkgIT0g\nbnVsbAogICAgICAgICAgICAmJiBDT05TX05BTUVfQkVGT1JFLmVxdWFscyhj\nb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJD\nT05TVFJBSU5UICIpLmFwcGVuZCh1bnEuZ2V0TmFtZSgpKS5hcHBlbmQoIiAi\nKTsKICAgICAgICBidWYuYXBwZW5kKCJVTklRVUUgIik7CiAgICAgICAgaWYg\nKHVucS5nZXROYW1lKCkgIT0gbnVsbCAmJiBDT05TX05BTUVfTUlELmVxdWFs\ncyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5k\nKHVucS5nZXROYW1lKCkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIigiKS5hcHBlbmQoU3RyaW5ncy5qb2luKHVucS5nZXRDb2x1bW5zKCks\nICIsICIpKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CiAgICAgICAgaWYg\nKHVucS5pc0RlZmVycmVkKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJ\nTklUSUFMTFkgREVGRVJSRUQiKTsKICAgICAgICBpZiAoc3VwcG9ydHNEZWZl\ncnJlZFVuaXF1ZUNvbnN0cmFpbnRzKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBERUZFUlJBQkxFIik7CiAgICAgICAgaWYgKHVucS5nZXROYW1lKCkg\nIT0gbnVsbAogICAgICAgICAgICAmJiBDT05TX05BTUVfQUZURVIuZXF1YWxz\nKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBDT05TVFJBSU5UICIpLmFwcGVuZCh1bnEuZ2V0TmFtZSgpKTsKICAgICAg\nICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIG9yIG5vdCB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgZGVm\nZXJyZWQgdW5pcXVlIGNvbnN0cmFpbnRzLgogICAgICogVGhpcyBpbXBsZW1l\nbnRhdGlvbiByZXR1cm5zIHtAbGluayAjc3VwcG9ydHNVbmlxdWVDb25zdHJh\naW50c30uCiAgICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRVbmlxdWVDb25z\ndHJhaW50cygpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZlcnJlZENv\nbnN0cmFpbnRzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gRGF0YWJhc2UgbWV0YWRhdGEKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBm\naWx0ZXIgc3lzdGVtIHRhYmxlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgog\nICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIHRhYmxlIG5hbWUgcmVw\ncmVzZW50cyBhIHN5c3RlbSB0YWJsZSB0aGF0CiAgICAgKiBzaG91bGQgbm90\nIGFwcGVhciBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIEJ5IGRlZmF1bHQs\nIHJldHVybnMKICAgICAqIHRydWUgb25seSBpZiB0aGUgZ2l2ZW4gdGFibGUg\naXMgaW4gdGhlIGludGVybmFsIGxpc3Qgb2Ygc3lzdGVtIHRhYmxlcywKICAg\nICAqIG9yIGlmIHRoZSBnaXZlbiBzY2hlbWEgaXMgaW4gdGhlIGxpc3Qgb2Yg\nc3lzdGVtIHNjaGVtYXMgYW5kIGlzIG5vdAogICAgICogdGhlIHRhcmdldCBz\nY2hlbWEuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxlIG5h\nbWUKICAgICAqIEBwYXJhbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsgbWF5\nIGJlIG51bGwKICAgICAqIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1ZSwg\ndGhlbiB0aGUgZ2l2ZW4gc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAqIHRo\nZSB1c2VyIGFzIG9uZSBvZiBoaXMgc2NoZW1hcwogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBpc1N5c3RlbVRhYmxlKFN0cmluZyBuYW1lLCBTdHJpbmcg\nc2NoZW1hLAogICAgICAgIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7CiAgICAg\nICAgaWYgKHN5c3RlbVRhYmxlU2V0LmNvbnRhaW5zKG5hbWUudG9VcHBlckNh\nc2UoKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVy\nbiAhdGFyZ2V0U2NoZW1hICYmIHNjaGVtYSAhPSBudWxsCiAgICAgICAgICAg\nICYmIHN5c3RlbVNjaGVtYVNldC5jb250YWlucyhzY2hlbWEudG9VcHBlckNh\nc2UoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1\nc2VkIHRvIGZpbHRlciBzeXN0ZW0gaW5kZXhlcyBmcm9tIGRhdGFiYXNlIG1l\ndGFkYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluZGV4\nIG5hbWUgcmVwcmVzZW50cyBhIHN5c3RlbSBpbmRleCB0aGF0CiAgICAgKiBz\naG91bGQgbm90IGFwcGVhciBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uIFJl\ndHVybnMgZmFsc2UgYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nbmFtZSB0aGUgaW5kZXggbmFtZQogICAgICogQHBhcmFtIHRhYmxlIHRoZSBp\nbmRleCB0YWJsZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5c3Rl\nbUluZGV4KFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBzZXF1ZW5jZXMgZnJvbSBkYXRh\nYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBnaXZl\nbiBzZXF1ZW5jZSByZXByZXNlbnRzIGEgc3lzdGVtIHNlcXVlbmNlIHRoYXQK\nICAgICAqIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5p\ndGlvbi4gUmV0dXJucyB0cnVlIGlmIHN5c3RlbQogICAgICogc2NoZW1hIGJ5\nIGRlZmF1bHQuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxl\nIG5hbWUKICAgICAqIEBwYXJhbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsg\nbWF5IGJlIG51bGwKICAgICAqIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1\nZSwgdGhlbiB0aGUgZ2l2ZW4gc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAq\nIHRoZSB1c2VyIGFzIG9uZSBvZiBoaXMgc2NoZW1hcwogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1N5c3RlbVNlcXVlbmNlKFN0cmluZyBuYW1lLCBT\ndHJpbmcgc2NoZW1hLAogICAgICAgIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7\nCiAgICAgICAgcmV0dXJuICF0YXJnZXRTY2hlbWEgJiYgc2NoZW1hICE9IG51\nbGwKICAgICAgICAgICAgJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5zKHNj\naGVtYS50b1VwcGVyQ2FzZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHRhYmxlcyBtYXRjaGluZyB0\naGUgZ2l2ZW4gbmFtZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMgVGFi\nbGVbXSBnZXRUYWJsZXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcg\nY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRh\nYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmICghc3VwcG9ydHNTY2hlbWFGb3JHZXRU\nYWJsZXMpCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBudWxsOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGdldFNjaGVtYU5hbWVG\nb3JNZXRhZGF0YShzY2hlbWFOYW1lKTsKCiAgICAgICAgU3RyaW5nW10gdHlw\nZXMgPSBTdHJpbmdzLnNwbGl0KHRhYmxlVHlwZXMsICIsIiwgMCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0eXBlcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgdHlwZXNbaV0gPSB0eXBlc1tpXS50cmltKCk7CgogICAgICAg\nIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3Vs\ndFNldCB0YWJsZXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHRhYmxlcyA9IG1ldGEuZ2V0VGFibGVzKGdldENhdGFsb2dOYW1lRm9yTWV0\nYWRhdGEoY2F0YWxvZyksCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lLCBn\nZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0YWJsZU5hbWUpLCB0eXBlcyk7CiAg\nICAgICAgICAgIExpc3QgdGFibGVMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwog\nICAgICAgICAgICB3aGlsZSAodGFibGVzICE9IG51bGwgJiYgdGFibGVzLm5l\neHQoKSkKICAgICAgICAgICAgICAgIHRhYmxlTGlzdC5hZGQobmV3VGFibGUo\ndGFibGVzKSk7CiAgICAgICAgICAgIHJldHVybiAoVGFibGVbXSkgdGFibGVM\naXN0LnRvQXJyYXkobmV3IFRhYmxlW3RhYmxlTGlzdC5zaXplKCldKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAodGFibGVzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHRhYmxlcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgdGFibGUgZnJvbSB0aGUg\naW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFRhYmxlIG5ld1RhYmxlKFJlc3VsdFNldCB0YWJsZU1l\ndGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgVGFi\nbGUgdCA9IG5ldyBUYWJsZSgpOwogICAgICAgIHQuc2V0TmFtZSh0YWJsZU1l\ndGEuZ2V0U3RyaW5nKCJUQUJMRV9OQU1FIikpOwogICAgICAgIHJldHVybiB0\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1h\nIHRvIGZpbmQgc2VxdWVuY2VzIG1hdGNoaW5nIHRoZSBnaXZlbiBuYW1lIHBh\ndHRlcm4uCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IGFycmF5IGJ5IGRlZmF1\nbHQsIGFzIHRoZXJlIGlzIG5vIHN0YW5kYXJkIHdheSB0bwogICAgICogcmV0\ncmlldmUgYSBsaXN0IG9mIHNlcXVlbmNlcy4KICAgICAqLwogICAgcHVibGlj\nIFNlcXVlbmNlW10gZ2V0U2VxdWVuY2VzKERhdGFiYXNlTWV0YURhdGEgbWV0\nYSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyBzZXF1ZW5jZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc3RyID0g\nZ2V0U2VxdWVuY2VzU1FMKHNjaGVtYU5hbWUsIHNlcXVlbmNlTmFtZSk7CiAg\nICAgICAgaWYgKHN0ciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3\nIFNlcXVlbmNlWzBdOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudChzdHIpOwogICAgICAgIFJlc3Vs\ndFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50\nIGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzdG1udC5zZXRTdHJpbmcoaWR4KyssIHNjaGVt\nYU5hbWUudG9VcHBlckNhc2UoKSk7CiAgICAgICAgICAgIGlmIChzZXF1ZW5j\nZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0bW50LnNldFN0cmlu\nZyhpZHgrKywgc2VxdWVuY2VOYW1lKTsKCiAgICAgICAgICAgIHJzID0gc3Rt\nbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3Qgc2VxTGlzdCA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHJzLm5leHQo\nKSkKICAgICAgICAgICAgICAgIHNlcUxpc3QuYWRkKG5ld1NlcXVlbmNlKHJz\nKSk7CiAgICAgICAgICAgIHJldHVybiAoU2VxdWVuY2VbXSkgc2VxTGlzdC50\nb0FycmF5KG5ldyBTZXF1ZW5jZVtzZXFMaXN0LnNpemUoKV0pOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBzZXF1ZW5jZSBm\ncm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2UgbmV3U2VxdWVuY2UoUmVz\ndWx0U2V0IHNlcXVlbmNlTWV0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBTZXF1ZW5jZSBzZXEgPSBuZXcgU2VxdWVuY2UoKTsK\nICAgICAgICBzZXEuc2V0U2NoZW1hTmFtZShzZXF1ZW5jZU1ldGEuZ2V0U3Ry\naW5nKCJTRVFVRU5DRV9TQ0hFTUEiKSk7CiAgICAgICAgc2VxLnNldE5hbWUo\nc2VxdWVuY2VNZXRhLmdldFN0cmluZygiU0VRVUVOQ0VfTkFNRSIpKTsKICAg\nICAgICByZXR1cm4gc2VxOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBTUUwgbmVlZGVkIHRvIHNlbGVjdCB0aGUgbGlzdCBvZiBzZXF1ZW5j\nZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2Vz\nU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lKSB7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBjb2x1bW5zIG1hdGNoaW5n\nIHRoZSBnaXZlbiB0YWJsZSBhbmQKICAgICAqIGNvbHVtbiBwYXR0ZXJucy4K\nICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJh\nc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJp\nbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVt\nbk5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1\ncHBvcnRzTnVsbFRhYmxlRm9yR2V0Q29sdW1ucykKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGlmICghc3VwcG9ydHNTY2hlbWFGb3JHZXRD\nb2x1bW5zKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gbnVsbDsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBnZXRTY2hlbWFOYW1l\nRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSk7CgogICAgICAgIGJlZm9yZU1ldGFk\nYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBjb2xzID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb2xzID0gbWV0YS5n\nZXRDb2x1bW5zKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyks\nCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lLCBnZXRUYWJsZU5hbWVGb3JN\nZXRhZGF0YSh0YWJsZU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0Q29sdW1u\nTmFtZUZvck1ldGFkYXRhKGNvbHVtbk5hbWUpKTsKCiAgICAgICAgICAgIExp\nc3QgY29sdW1uTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nd2hpbGUgKGNvbHMgIT0gbnVsbCAmJiBjb2xzLm5leHQoKSkKICAgICAgICAg\nICAgICAgIGNvbHVtbkxpc3QuYWRkKG5ld0NvbHVtbihjb2xzKSk7CiAgICAg\nICAgICAgIHJldHVybiAoQ29sdW1uW10pIGNvbHVtbkxpc3QudG9BcnJheQog\nICAgICAgICAgICAgICAgKG5ldyBDb2x1bW5bY29sdW1uTGlzdC5zaXplKCld\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoY29scyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBjb2xzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb2x1bW4gZnJvbSB0\naGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIENvbHVtbiBuZXdDb2x1bW4oUmVzdWx0U2V0IGNv\nbE1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ29sdW1uIGMgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgYy5zZXRTY2hlbWFO\nYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIpKTsKICAgICAg\nICBjLnNldFRhYmxlTmFtZShjb2xNZXRhLmdldFN0cmluZygiVEFCTEVfTkFN\nRSIpKTsKICAgICAgICBjLnNldE5hbWUoY29sTWV0YS5nZXRTdHJpbmcoIkNP\nTFVNTl9OQU1FIikpOwogICAgICAgIGMuc2V0VHlwZShjb2xNZXRhLmdldElu\ndCgiREFUQV9UWVBFIikpOwogICAgICAgIGMuc2V0VHlwZU5hbWUoY29sTWV0\nYS5nZXRTdHJpbmcoIlRZUEVfTkFNRSIpKTsKICAgICAgICBjLnNldFNpemUo\nY29sTWV0YS5nZXRJbnQoIkNPTFVNTl9TSVpFIikpOwogICAgICAgIGMuc2V0\nRGVjaW1hbERpZ2l0cyhjb2xNZXRhLmdldEludCgiREVDSU1BTF9ESUdJVFMi\nKSk7CiAgICAgICAgYy5zZXROb3ROdWxsKGNvbE1ldGEuZ2V0SW50KCJOVUxM\nQUJMRSIpCiAgICAgICAgICAgID09IERhdGFiYXNlTWV0YURhdGEuY29sdW1u\nTm9OdWxscyk7CgogICAgICAgIFN0cmluZyBkZWYgPSBjb2xNZXRhLmdldFN0\ncmluZygiQ09MVU1OX0RFRiIpOwogICAgICAgIGlmICghU3RyaW5nVXRpbHMu\naXNFbXB0eShkZWYpICYmICEibnVsbCIuZXF1YWxzSWdub3JlQ2FzZShkZWYp\nKQogICAgICAgICAgICBjLnNldERlZmF1bHRTdHJpbmcoZGVmKTsKICAgICAg\nICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24g\ndGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVu\nIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBQcmltYXJ5S2V5\nW10gZ2V0UHJpbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLAogICAg\nICAgIFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5n\nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1c2VHZXRCZXN0Um93SWRlbnRp\nZmllckZvclByaW1hcnlLZXlzKQogICAgICAgICAgICByZXR1cm4gZ2V0UHJp\nbWFyeUtleXNGcm9tQmVzdFJvd0lkZW50aWZpZXIobWV0YSwgY2F0YWxvZywK\nICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwgY29ubik7\nCiAgICAgICAgcmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlL\nZXlzKG1ldGEsIGNhdGFsb2csCiAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRh\nYmxlTmFtZSwgY29ubik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0\nIG9uIHRoZSBzY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBn\naXZlbiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJp\nbWFyeUtleVtdIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlLZXlzCiAg\nICAgICAgKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2cs\nIFN0cmluZyBzY2hlbWFOYW1lLAogICAgICAgICAgICBTdHJpbmcgdGFibGVO\nYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsICYmICFzdXBw\nb3J0c051bGxUYWJsZUZvckdldFByaW1hcnlLZXlzKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24o\nY29ubik7CiAgICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcGtzID0gbWV0YS5nZXRQcmltYXJ5S2V5cyhn\nZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAg\nICAgICAgZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAog\nICAgICAgICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVO\nYW1lKSk7CgogICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxsICYmIHBrcy5u\nZXh0KCkpCiAgICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlL\nZXkocGtzKSk7CiAgICAgICAgICAgIHJldHVybiAoUHJpbWFyeUtleVtdKSBw\na0xpc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBQcmltYXJ5S2V5\nW3BrTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBpZiAocGtzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIHBrcy5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcg\ncHJpbWFyeSBrZXkgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVt\nYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXkg\nbmV3UHJpbWFyeUtleShSZXN1bHRTZXQgcGtNZXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIFByaW1hcnlLZXkgcGsgPSBuZXcg\nUHJpbWFyeUtleSgpOwogICAgICAgIHBrLnNldFNjaGVtYU5hbWUocGtNZXRh\nLmdldFN0cmluZygiVEFCTEVfU0NIRU0iKSk7CiAgICAgICAgcGsuc2V0VGFi\nbGVOYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAg\nICAgcGsuc2V0Q29sdW1uTmFtZShwa01ldGEuZ2V0U3RyaW5nKCJDT0xVTU5f\nTkFNRSIpKTsKICAgICAgICBway5zZXROYW1lKHBrTWV0YS5nZXRTdHJpbmco\nIlBLX05BTUUiKSk7CiAgICAgICAgcmV0dXJuIHBrOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFy\neSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21C\nZXN0Um93SWRlbnRpZmllcgogICAgICAgIChEYXRhYmFzZU1ldGFEYXRhIG1l\ndGEsIFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFtZSwKICAgICAg\nICAgICAgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh0YWJsZU5h\nbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3Vs\ndFNldCBwa3MgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBr\ncyA9IG1ldGEuZ2V0QmVzdFJvd0lkZW50aWZpZXIoY2F0YWxvZywgc2NoZW1h\nTmFtZSwKICAgICAgICAgICAgICAgIHRhYmxlTmFtZSwgMCwgZmFsc2UpOwoK\nICAgICAgICAgICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAg\nICAgICAgICAgIHdoaWxlIChwa3MgIT0gbnVsbCAmJiBwa3MubmV4dCgpKSB7\nCiAgICAgICAgICAgICAgICBQcmltYXJ5S2V5IHBrID0gbmV3IFByaW1hcnlL\nZXkoKTsKICAgICAgICAgICAgICAgIHBrLnNldFNjaGVtYU5hbWUoc2NoZW1h\nTmFtZSk7CiAgICAgICAgICAgICAgICBway5zZXRUYWJsZU5hbWUodGFibGVO\nYW1lKTsKICAgICAgICAgICAgICAgIHBrLnNldENvbHVtbk5hbWUocGtzLmdl\ndFN0cmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAgICAgICAgICBwa0xp\nc3QuYWRkKHBrKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nKFByaW1hcnlLZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAgICAgICAgICAgICAg\nIChuZXcgUHJpbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBwa3MuY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgaW5kZXhlcyBtYXRj\naGluZyB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqLwogICAgcHVi\nbGljIEluZGV4W10gZ2V0SW5kZXhJbmZvKERhdGFiYXNlTWV0YURhdGEgbWV0\nYSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNjaGVtYU5hbWUs\nIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLAogICAgICAgIGJv\nb2xlYW4gYXBwcm94LCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxs\nICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4SW5mbykKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3Bl\ncmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBpbmRleGVzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbmRleGVzID0gbWV0YS5n\nZXRJbmRleEluZm8oZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9n\nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShz\nY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFtZUZvck1l\ndGFkYXRhKHRhYmxlTmFtZSksIHVuaXF1ZSwgYXBwcm94KTsKCiAgICAgICAg\nICAgIExpc3QgaW5kZXhMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nICAgICB3aGlsZSAoaW5kZXhlcyAhPSBudWxsICYmIGluZGV4ZXMubmV4dCgp\nKQogICAgICAgICAgICAgICAgaW5kZXhMaXN0LmFkZChuZXdJbmRleChpbmRl\neGVzKSk7CiAgICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkgaW5kZXhMaXN0\nLnRvQXJyYXkobmV3IEluZGV4W2luZGV4TGlzdC5zaXplKCldKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoaW5kZXhlcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBp\nbmRleGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpbmRleCBmcm9tIHRoZSBp\nbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgSW5kZXggbmV3SW5kZXgoUmVzdWx0U2V0IGlkeE1ldGEp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5kZXgg\naWR4ID0gbmV3IEluZGV4KCk7CiAgICAgICAgaWR4LnNldFNjaGVtYU5hbWUo\naWR4TWV0YS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIikpOwogICAgICAgIGlk\neC5zZXRUYWJsZU5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUi\nKSk7CiAgICAgICAgaWR4LnNldENvbHVtbk5hbWUoaWR4TWV0YS5nZXRTdHJp\nbmcoIkNPTFVNTl9OQU1FIikpOwogICAgICAgIGlkeC5zZXROYW1lKGlkeE1l\ndGEuZ2V0U3RyaW5nKCJJTkRFWF9OQU1FIikpOwogICAgICAgIGlkeC5zZXRV\nbmlxdWUoIWlkeE1ldGEuZ2V0Qm9vbGVhbigiTk9OX1VOSVFVRSIpKTsKICAg\nICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVj\ndCBvbiB0aGUgc2NoZW1hIHRvIHJldHVybiBmb3JlaWduIGtleXMgaW1wb3J0\nZWQgYnkgdGhlIGdpdmVuCiAgICAgKiB0YWJsZSBwYXR0ZXJuLgogICAgICov\nCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRh\nYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0\ncmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9u\nIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBv\ncnRzTnVsbFRhYmxlRm9yR2V0SW1wb3J0ZWRLZXlzKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24o\nY29ubik7CiAgICAgICAgUmVzdWx0U2V0IGtleXMgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGtleXMgPSBtZXRhLmdldEltcG9ydGVkS2V5\ncyhnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAogICAgICAg\nICAgICAgICAgZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUp\nLAogICAgICAgICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEodGFi\nbGVOYW1lKSk7CgogICAgICAgICAgICBMaXN0IGltcG9ydGVkS2V5TGlzdCA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKGtleXMgIT0g\nbnVsbCAmJiBrZXlzLm5leHQoKSkKICAgICAgICAgICAgICAgIGltcG9ydGVk\nS2V5TGlzdC5hZGQobmV3Rm9yZWlnbktleShrZXlzKSk7CiAgICAgICAgICAg\nIHJldHVybiAoRm9yZWlnbktleVtdKSBpbXBvcnRlZEtleUxpc3QudG9BcnJh\neQogICAgICAgICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ltcG9ydGVkS2V5\nTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAoa2V5cyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBrZXlzLmNsb3NlKCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBm\nb3JlaWduIGtleSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1h\nIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgRm9yZWlnbktleSBu\nZXdGb3JlaWduS2V5KFJlc3VsdFNldCBma01ldGEpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRm9yZWlnbktleSBmayA9IG5ldyBG\nb3JlaWduS2V5KCk7CiAgICAgICAgZmsuc2V0U2NoZW1hTmFtZShma01ldGEu\nZ2V0U3RyaW5nKCJGS1RBQkxFX1NDSEVNIikpOwogICAgICAgIGZrLnNldFRh\nYmxlTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS1RBQkxFX05BTUUiKSk7CiAg\nICAgICAgZmsuc2V0Q29sdW1uTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS0NP\nTFVNTl9OQU1FIikpOwogICAgICAgIGZrLnNldE5hbWUoZmtNZXRhLmdldFN0\ncmluZygiRktfTkFNRSIpKTsKICAgICAgICBmay5zZXRQcmltYXJ5S2V5U2No\nZW1hTmFtZShma01ldGEuZ2V0U3RyaW5nKCJQS1RBQkxFX1NDSEVNIikpOwog\nICAgICAgIGZrLnNldFByaW1hcnlLZXlUYWJsZU5hbWUoZmtNZXRhLmdldFN0\ncmluZygiUEtUQUJMRV9OQU1FIikpOwogICAgICAgIGZrLnNldFByaW1hcnlL\nZXlDb2x1bW5OYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBLQ09MVU1OX05BTUUi\nKSk7CiAgICAgICAgZmsuc2V0S2V5U2VxdWVuY2UoZmtNZXRhLmdldFNob3J0\nKCJLRVlfU0VRIikpOwogICAgICAgIGZrLnNldERlZmVycmVkKGZrTWV0YS5n\nZXRTaG9ydCgiREVGRVJSQUJJTElUWSIpCiAgICAgICAgICAgID09IERhdGFi\nYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCk7Cgog\nICAgICAgIGludCBkZWwgPSBma01ldGEuZ2V0U2hvcnQoIkRFTEVURV9SVUxF\nIik7CiAgICAgICAgc3dpdGNoIChkZWwpIHsKICAgICAgICAgICAgY2FzZSBE\nYXRhYmFzZU1ldGFEYXRhLmltcG9ydGVkS2V5U2V0TnVsbDoKICAgICAgICAg\nICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9O\nVUxMKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0OgogICAg\nICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNU\nSU9OX0RFRkFVTFQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleUNhc2NhZGU6\nCiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktl\neS5BQ1RJT05fQ0FTQ0FERSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0\nZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZrOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdGFibGUgbmFtZSB0\naGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAg\nICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0cmluZyBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YShT\ndHJpbmcgdGFibGVOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hl\nbWFDYXNlKHRhYmxlTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIHRoZSBzY2hlbWEgbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0\nYWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFz\nZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRT\nY2hlbWFOYW1lRm9yTWV0YWRhdGEoU3RyaW5nIHNjaGVtYU5hbWUpIHsKICAg\nICAgICBpZiAoc2NoZW1hTmFtZSA9PSBudWxsKQogICAgICAgICAgICBzY2hl\nbWFOYW1lID0gY29uZi5nZXRTY2hlbWEoKTsKICAgICAgICByZXR1cm4gY29u\ndmVydFNjaGVtYUNhc2Uoc2NoZW1hTmFtZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBjYXRhbG9nIG5hbWUgdGhhdCB3aWxsIGJlIHVz\nZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxp\nbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShTdHJpbmcgY2F0YWxv\nZ05hbWUpIHsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVtYUNhc2UoY2F0\nYWxvZ05hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nY29sdW1uIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBp\nbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0\nYX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Q29sdW1uTmFt\nZUZvck1ldGFkYXRhKFN0cmluZyBjb2x1bW5OYW1lKSB7CiAgICAgICAgcmV0\ndXJuIGNvbnZlcnRTY2hlbWFDYXNlKGNvbHVtbk5hbWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIHNjaGVtYSBuYW1l\nIHRvIGEgbmFtZSB0aGF0IHRoZSBkYXRhYmFzZSB3aWxsCiAgICAgKiBiZSBh\nYmxlIHRvIHVuZGVyc3RhbmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJp\nbmcgY29udmVydFNjaGVtYUNhc2UoU3RyaW5nIG9iamVjdE5hbWUpIHsKICAg\nICAgICBpZiAob2JqZWN0TmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIHNjYXNlID0gZ2V0U2NoZW1hQ2Fz\nZSgpOwogICAgICAgIGlmIChTQ0hFTUFfQ0FTRV9MT1dFUi5lcXVhbHMoc2Nh\nc2UpKQogICAgICAgICAgICByZXR1cm4gb2JqZWN0TmFtZS50b0xvd2VyQ2Fz\nZSgpOwogICAgICAgIGlmIChTQ0hFTUFfQ0FTRV9QUkVTRVJWRS5lcXVhbHMo\nc2Nhc2UpKQogICAgICAgICAgICByZXR1cm4gb2JqZWN0TmFtZTsKICAgICAg\nICByZXR1cm4gb2JqZWN0TmFtZS50b1VwcGVyQ2FzZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIERCIHNwZWNpZmljIHNjaGVtYUNhc2UgCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U2NoZW1hQ2FzZSgpewogICAg\nICAgIHJldHVybiBzY2hlbWFDYXNlOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFByZXBhcmVkIHRoZSBjb25uZWN0aW9uIGZvciBtZXRhZGF0YSBvcGVy\nYXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVmb3JlTWV0YWRh\ndGFPcGVyYXRpb24oQ29ubmVjdGlvbiBjKSB7CiAgICAgICAgaWYgKHJlcXVp\ncmVzQXV0b0NvbW1pdEZvck1ldGFEYXRhKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBjLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghYy5nZXRBdXRv\nQ29tbWl0KCkpCiAgICAgICAgICAgICAgICAgICAgYy5zZXRBdXRvQ29tbWl0\nKHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3Fs\nZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZXF1ZW5jZXMgYW5k\nIEF1dG8tQXNzaWduCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsYXN0IGdlbmVyYXRlZCB2\nYWx1ZSBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqIFRocm93cyBhbiBl\neGNlcHRpb24gYnkgZGVmYXVsdCBpZiB7QGxpbmsgI2xhc3RHZW5lcmF0ZWRL\nZXlRdWVyeX0gaXMgbnVsbC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBn\nZXRHZW5lcmF0ZWRLZXkoQ29sdW1uIGNvbCwgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChsYXN0\nR2VuZXJhdGVkS2V5UXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hdXRvLWFzc2lnbiIp\nKTsKCiAgICAgICAgLy8gcmVwbGFjZSB0aGluZ3MgbGlrZSAiU0VMRUNUIE1B\nWCh7MH0pIEZST00gezF9IgogICAgICAgIFN0cmluZyBxdWVyeSA9IGxhc3RH\nZW5lcmF0ZWRLZXlRdWVyeTsKICAgICAgICBpZiAocXVlcnkuaW5kZXhPZign\neycpICE9IC0xKSAvLyBvbmx5IGlmIHRoZSB0b2tlbiBpcyBpbiB0aGUgc3Ry\naW5nCiAgICAgICAgewogICAgICAgICAgICBxdWVyeSA9IE1lc3NhZ2VGb3Jt\nYXQuZm9ybWF0KHF1ZXJ5LCBuZXcgT2JqZWN0W117CiAgICAgICAgICAgICAg\nICBjb2wuZ2V0TmFtZSgpLCBnZXRGdWxsTmFtZShjb2wuZ2V0VGFibGUoKSwg\nZmFsc2UpLAogICAgICAgICAgICAgICAgZ2V0R2VuZXJhdGVkS2V5U2VxdWVu\nY2VOYW1lKGNvbCksCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAg\nICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0\nZW1lbnQocXVlcnkpOwogICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVl\ncnkoKTsKICAgICAgICAgICAgaWYgKCFycy5uZXh0KCkpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWdl\nbmtleSIpKTsKICAgICAgICAgICAgT2JqZWN0IGtleSA9IHJzLmdldE9iamVj\ndCgxKTsKICAgICAgICAgICAgaWYgKGtleSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImludmFsaWQtZ2Vua2V5IiwgY29s\nKSk7CiAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHt9CiAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlKCk7IH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkge30gCiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBzZXF1ZW5jZSBuYW1lIHVzZWQgYnkgZGF0\nYWJhc2VzIGZvciB0aGUgZ2l2ZW4gYXV0b2Fzc2lnbmVkCiAgICAgKiBjb2x1\nbW4uIFRoaXMgaXMgb25seSB1c2VkIGJ5IGRhdGFiYXNlcyB0aGF0IHJlcXVp\ncmUgYW4gZXhwbGljaXQgbmFtZQogICAgICogdG8gYmUgdXNlZCBmb3IgYXV0\nby1hc3NpZ24gc3VwcG9ydC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmlu\nZyBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoQ29sdW1uIGNvbCkgewog\nICAgICAgIFN0cmluZyB0bmFtZSA9IGNvbC5nZXRUYWJsZU5hbWUoKTsKICAg\nICAgICBTdHJpbmcgY25hbWUgPSBjb2wuZ2V0TmFtZSgpOwogICAgICAgIGlu\ndCBtYXggPSBtYXhBdXRvQXNzaWduTmFtZUxlbmd0aDsKICAgICAgICBpbnQg\nZXh0cmFDaGFycyA9IC1tYXggKyB0bmFtZS5sZW5ndGgoKSArIDEgLy8gPHRu\nYW1lPiArICdfJwogICAgICAgICAgICArIGNuYW1lLmxlbmd0aCgpICsgNDsg\nLy8gPGNuYW1lPiArICdfU0VRJwogICAgICAgIGlmIChleHRyYUNoYXJzID4g\nMCkgewogICAgICAgICAgICAvLyB0aGlzIGFzc3VtZXMgdGhhdCB0bmFtZSBp\ncyBsb25nZXIgdGhhbiBleHRyYUNoYXJzCiAgICAgICAgICAgIHRuYW1lID0g\ndG5hbWUuc3Vic3RyaW5nKDAsIHRuYW1lLmxlbmd0aCgpIC0gZXh0cmFDaGFy\ncyk7CiAgICAgICAgfQogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcg\nU3RyaW5nQnVmZmVyKG1heCk7CiAgICAgICAgYnVmLmFwcGVuZCh0bmFtZSku\nYXBwZW5kKCJfIikuYXBwZW5kKGNuYW1lKS5hcHBlbmQoIl9TRVEiKTsKICAg\nICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uZmlndXJhYmxl\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25m\naWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICB0aGlzLmNvbmYgPSAoSkRCQ0Nv\nbmZpZ3VyYXRpb24pIGNvbmY7CiAgICAgICAgdGhpcy5sb2cgPSB0aGlzLmNv\nbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsKCiAgICAg\nICAgLy8gd2FybiBhYm91dCB1bnN1cHBvcnRlZCBkaWN0cwogICAgICAgIGlm\nIChsb2cuaXNXYXJuRW5hYmxlZCgpICYmICFpc1N1cHBvcnRlZCgpKQogICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldCgiZGljdC1ub3Qtc3VwcG9ydGVk\nIiwgZ2V0Q2xhc3MoKSkpOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBp\nc1N1cHBvcnRlZCgpIHsKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgY3VzdG9t\nIGRpY3QsIHRyYXZlcnNlIHRvIHdoYXRldmVyIG9wZW5qcGEgZGljdCBpdCBl\neHRlbmRzCiAgICAgICAgQ2xhc3MgYyA9IGdldENsYXNzKCk7CiAgICAgICAg\nd2hpbGUgKCFjLmdldE5hbWUoKS5zdGFydHNXaXRoKCJvcmcuYXBhY2hlLm9w\nZW5qcGEuIikpCiAgICAgICAgICAgIGMgPSBjLmdldFN1cGVyY2xhc3MoKTsK\nCiAgICAgICAgLy8gdGhlIGdlbmVyaWMgZGJkaWN0aW9uYXJ5IGlzIG5vdCBj\nb25zaWRlcmVkIGEgc3VwcG9ydGVkIGRpY3Q7IGFsbAogICAgICAgIC8vIG90\naGVyIGNvbmNyZXRlIGRpY3Rpb25hcmllcyBhcmUKICAgICAgICBpZiAoYyA9\nPSBEQkRpY3Rpb25hcnkuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdGFydENvbmZpZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZv\naWQgZW5kQ29uZmlndXJhdGlvbigpIHsKICAgICAgICAvLyBpbml0aWFsaXpl\nIHRoZSBzZXQgb2YgcmVzZXJ2ZWQgU1FMOTIgd29yZHMgZnJvbSByZXNvdXJj\nZQogICAgICAgIElucHV0U3RyZWFtIGluID0gREJEaWN0aW9uYXJ5LmNsYXNz\nLmdldFJlc291cmNlQXNTdHJlYW0KICAgICAgICAgICAgKCJzcWwta2V5d29y\nZHMucnNyYyIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZyBr\nZXl3b3JkcyA9IG5ldyBCdWZmZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1S\nZWFkZXIoaW4pKS4KICAgICAgICAgICAgICAgIHJlYWRMaW5lKCk7CiAgICAg\nICAgICAgIGluLmNsb3NlKCk7CiAgICAgICAgICAgIHJlc2VydmVkV29yZFNl\ndC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAg\nICAgICAgICAoa2V5d29yZHMsICIsIiwgMCkpKTsKICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24oaW9lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB0cnkgeyBpbi5jbG9zZSgpOyB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBlKSB7fQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIGFkZGl0aW9uYWwg\ncmVzZXJ2ZWQgd29yZHMgc2V0IGJ5IHVzZXIKICAgICAgICBpZiAocmVzZXJ2\nZWRXb3JkcyAhPSBudWxsKQogICAgICAgICAgICByZXNlcnZlZFdvcmRTZXQu\nYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAg\nICAgICAgKHJlc2VydmVkV29yZHMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkp\nOwoKICAgICAgICAvLyBhZGQgc3lzdGVtIHNjaGVtYXMgc2V0IGJ5IHVzZXIK\nICAgICAgICBpZiAoc3lzdGVtU2NoZW1hcyAhPSBudWxsKQogICAgICAgICAg\nICBzeXN0ZW1TY2hlbWFTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5n\ncy5zcGxpdAogICAgICAgICAgICAgICAgKHN5c3RlbVNjaGVtYXMudG9VcHBl\nckNhc2UoKSwgIiwiLCAwKSkpOwoKICAgICAgICAvLyBhZGQgc3lzdGVtIHRh\nYmxlcyBzZXQgYnkgdXNlcgogICAgICAgIGlmIChzeXN0ZW1UYWJsZXMgIT0g\nbnVsbCkKICAgICAgICAgICAgc3lzdGVtVGFibGVTZXQuYWRkQWxsKEFycmF5\ncy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKHN5c3Rl\nbVRhYmxlcy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8v\nIGFkZCBmaXhlZCBzaXplIHR5cGUgbmFtZXMgc2V0IGJ5IHRoZSB1c2VyCiAg\nICAgICAgaWYgKGZpeGVkU2l6ZVR5cGVOYW1lcyAhPSBudWxsKQogICAgICAg\nICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoZml4ZWRTaXplVHlw\nZU5hbWVzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKICAgICAgICAKICAg\nICAgICAvLyBpZiB1c2VyIGhhcyB1bnNldCBzZXF1ZW5jZSBzcWwsIG51bGwg\naXQgb3V0IHNvIHdlIGtub3cgc2VxdWVuY2VzCiAgICAgICAgLy8gYXJlbid0\nIHN1cHBvcnRlZAogICAgICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gU3RyaW5n\nVXRpbHMudHJpbVRvTnVsbChuZXh0U2VxdWVuY2VRdWVyeSk7CiAgICAgICAg\nCiAgICAgICAgaWYgKHNlbGVjdFdvcmRzICE9IG51bGwpCiAgICAgICAgICAg\nIHNlbGVjdFdvcmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5z\ncGxpdChzZWxlY3RXb3JkcwogICAgICAgICAgICAgICAgICAgIC50b1VwcGVy\nQ2FzZSgpLCAiLCIsIDApKSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbm5lY3Rpb25EZWNv\ncmF0b3IgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBEZWNvcmF0ZSB0\naGUgZ2l2ZW4gY29ubmVjdGlvbiBpZiBuZWVkZWQuIFNvbWUgZGF0YWJhc2Vz\nIHJlcXVpcmUgc3BlY2lhbAogICAgICogaGFuZGxpbmcgZm9yIEpEQkMgYnVn\ncy4gVGhpcyBpbXBsZW1lbnRhdGlvbiBpc3N1ZXMgYW55CiAgICAgKiB7QGxp\nbmsgI2luaXRpYWxpemF0aW9uU1FMfSB0aGF0IGhhcyBiZWVuIHNldCBmb3Ig\ndGhlIGRpY3Rpb25hcnkgYnV0CiAgICAgKiBkb2VzIG5vdCBkZWNvcmVhdGUg\ndGhlIGNvbm5lY3Rpb24uCiAgICAgKi8KICAgIHB1YmxpYyBDb25uZWN0aW9u\nIGRlY29yYXRlKENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWNvbm5lY3RlZCkKICAgICAgICAg\nICAgY29ubmVjdGVkQ29uZmlndXJhdGlvbihjb25uKTsKICAgICAgICBpZiAo\nIVN0cmluZ1V0aWxzLmlzRW1wdHkoaW5pdGlhbGl6YXRpb25TUUwpKSB7CiAg\nICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gbnVsbDsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50ID0gY29ubi5w\ncmVwYXJlU3RhdGVtZW50KGluaXRpYWxpemF0aW9uU1FMKTsKICAgICAgICAg\nICAgICAgIHN0bW50LmV4ZWN1dGUoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoZS50\nb1N0cmluZygpLCBlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0bW50LmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBjb25uOwogICAgfQoKICAgIC8qKgog\nICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhlCiAgICAgKiB7QGxpbmsgTG9n\nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FMV2FybmluZ0hhbmRsZXJ9IGlu\ndGVyZmFjZQogICAgICogdGhhdCBhbGxvd3MgY3VzdG9taXphdGlvbiBvZiB0\naGUgYWN0aW9ucyB0byBwZXJmb3JtIHdoZW4gYQogICAgICoge0BsaW5rIFNR\nTFdhcm5pbmd9IG9jY3VycyBhdCBhbnkgcG9pbnQgb24gYSB7QGxpbmsgQ29u\nbmVjdGlvbn0sCiAgICAgKiB7QGxpbmsgU3RhdGVtZW50fSwgb3Ige0BsaW5r\nIFJlc3VsdFNldH0uIFRoaXMgbWV0aG9kIG1heQogICAgICogYmUgdXNlZCBk\nZXRlcm1pbmUgdGhvc2Ugd2FybmluZ3MgdGhlIGFwcGxpY2F0aW9uIHdhbnRz\nIHRvCiAgICAgKiBjb25zaWRlciBjcml0aWNhbCBmYWlsdXJlcywgYW5kIHRo\ncm93IHRoZSB3YXJuaW5nIGluIHRob3NlCiAgICAgKiBjYXNlcy4gQnkgZGVm\nYXVsdCwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLgogICAgICoKICAgICAq\nIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3Ijc2V0V2FybmluZ0Fj\ndGlvbgogICAgICogQHNlZSBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvciNz\nZXRXYXJuaW5nSGFuZGxlcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBoYW5k\nbGVXYXJuaW5nKFNRTFdhcm5pbmcgd2FybmluZykKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBh\nIG5ldyBleGNlcHRpb24gdGhhdCB3cmFwcyA8Y29kZT5jYXVzZXM8L2NvZGU+\nLgogICAgICogSG93ZXZlciwgdGhlIGRldGFpbHMgb2YgZXhhY3RseSB3aGF0\nIHR5cGUgb2YgZXhjZXB0aW9uIGlzIHJldHVybmVkIGNhbgogICAgICogYmUg\nZGV0ZXJtaW5lZCBieSB0aGUgaW1wbGVtZW50YXRpb24uIFRoaXMgbWF5IHRh\na2UgaW50byBhY2NvdW50CiAgICAgKiBEQi1zcGVjaWZpYyBleGNlcHRpb24g\naW5mb3JtYXRpb24gaW4gPGNvZGU+Y2F1c2VzPC9jb2RlPi4KICAgICAqLwog\nICAgcHVibGljIE9wZW5KUEFFeGNlcHRpb24gbmV3U3RvcmVFeGNlcHRpb24o\nU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uW10gY2F1c2VzLAogICAgICAgIE9i\namVjdCBmYWlsZWQpIHsKICAgICAgICBpZiAoY2F1c2VzLmxlbmd0aCA+IDAg\nJiYgIjIzMDAwIi5lcXVhbHMoY2F1c2VzWzBdLmdldFNRTFN0YXRlKCkpKQog\nICAgICAgICAgICByZXR1cm4gbmV3IFJlZmVyZW50aWFsSW50ZWdyaXR5RXhj\nZXB0aW9uKG1zZykuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qo\nZmFpbGVkKS5zZXROZXN0ZWRUaHJvd2FibGVzKGNhdXNlcyk7CiAgICAgICAg\ncmV0dXJuIG5ldyBTdG9yZUV4Y2VwdGlvbihtc2cpLnNldEZhaWxlZE9iamVj\ndChmYWlsZWQpLgogICAgICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKGNh\ndXNlcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZXMgdGhlIHNwZWNp\nZmllZCB7QGxpbmsgRGF0YVNvdXJjZX0gYW5kIHJlbGVhc2VzIGFueQogICAg\nICogcmVzb3VyY2VzIGFzc29jaWF0ZWQgd2l0aCBpdC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZGF0YVNvdXJjZSB0aGUgRGF0YVNvdXJjZSB0byBjbG9zZQog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZURhdGFTb3VyY2UoRGF0YVNv\ndXJjZSBkYXRhU291cmNlKSB7CiAgICAgICAgRGF0YVNvdXJjZUZhY3Rvcnku\nY2xvc2VEYXRhU291cmNlKGRhdGFTb3VyY2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogVXNlZCBieSBzb21lIG1hcHBpbmdzIHRvIHJlcHJlc2VudCBkYXRh\nIHRoYXQgaGFzIGFscmVhZHkgYmVlbgogICAgICogc2VyaWFsaXplZCBzbyB0\naGF0IHdlIGRvbid0IGhhdmUgdG8gc2VyaWFsaXplIG11bHRpcGxlIHRpbWVz\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFNlcmlhbGl6ZWRE\nYXRhIHsKCiAgICAgICAgcHVibGljIGZpbmFsIGJ5dGVbXSBieXRlczsKCiAg\nICAgICAgcHVibGljIFNlcmlhbGl6ZWREYXRhKGJ5dGVbXSBieXRlcykgewog\nICAgICAgICAgICB0aGlzLmJ5dGVzID0gYnl0ZXM7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB2ZXJzaW9uIGNvbHVtbiBu\nYW1lCiAgICAgKiBAcGFyYW0gY29sdW1uCiAgICAgKiBAcGFyYW0gdGFibGVB\nbGlhcyA6IHRoaXMgaXMgbmVlZGVkIGZvciBwbGF0Zm9ybSBzcGVjaWZpYyB2\nZXJzaW9uIGNvbHVtbgogICAgICogQHJldHVybgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFZlcnNpb25Db2x1bW4oQ29sdW1uIGNvbHVtbiwgU3Ry\naW5nIHRhYmxlQWxpYXMpIHsKICAgICAgICByZXR1cm4gY29sdW1uLnRvU3Ry\naW5nKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQXR0YWNoIENBU1Qg\ndG8gdGhlIGN1cnJlbnQgZnVuY3Rpb24gaWYgbmVjZXNzYXJ5CiAgICAgKiAK\nICAgICAqIEBwYXJhbSB2YWwgb3BlcmFuZCB2YWx1ZQogICAgICogQHBhcm1h\nIGZ1bmMgdGhlIHNxbCBmdW5jdGlvbiBzdGF0ZW1lbnQKICAgICAqIEByZXR1\ncm4gYSBTdHJpbmcgd2l0aCB0aGUgY29ycmVjdCBDQVNUIGZ1bmN0aW9uIHN5\nbnRheAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldENhc3RGdW5jdGlv\nbihWYWwgdmFsLCBTdHJpbmcgZnVuYykgewogICAgICAgIHJldHVybiBmdW5j\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjb3JyZWN0IENB\nU1QgZnVuY3Rpb24gc3ludGF4LiAgVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGVu\nIGJ5IHN1YmNsYXNzZXMKICAgICAqIHRoYXQgbmVlZCBhY2Nlc3MgdG8gdGhl\nIENvbHVtbiBpbmZvcm1hdGlvbi4KICAgICAqIAogICAgICogQHBhcmFtIHZh\nbCBvcGVyYW5kIG9mIGNhc3QKICAgICAqIEBwYXJhbSBmdW5jIG9yaWdpbmFs\nIHN0cmluZwogICAgICogQHBhcmFtIGNvbCBkYXRhYmFzZSBjb2x1bW4KICAg\nICAqIEByZXR1cm4gYSBTdHJpbmcgd2l0aCB0aGUgY29ycmVjdCBDQVNUIGZ1\nbmN0aW9uIHN5bnRheAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldENh\nc3RGdW5jdGlvbihWYWwgdmFsLCBTdHJpbmcgZnVuYywgQ29sdW1uIGNvbCkg\newogICAgICAgIHJldHVybiBnZXRDYXN0RnVuY3Rpb24gKHZhbCwgZnVuYyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gaW5kZXggaWYgbmVj\nZXNzYXJ5IGZvciBzb21lIGRhdGFiYXNlIHRhYmxlcwogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBjcmVhdGVJbmRleElmTmVjZXNzYXJ5KFNjaGVtYSBzY2hl\nbWEsIFN0cmluZyB0YWJsZSwKICAgICAgICAgICAgQ29sdW1uIHBrQ29sdW1u\nKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciB0\naGUgcHJvdmlkZWQgPGNvZGU+c3FsPC9jb2RlPiBtYXkgYmUgdHJlYXRlZCBh\ncyBhIAogICAgICogc2VsZWN0IHN0YXRlbWVudCBvbiB0aGlzIGRhdGFiYXNl\nLgogICAgICogIAogICAgICogQHBhcmFtIHNxbCAgIEEgc3FsIHN0YXRlbWVu\ndC4gCiAgICAgKiAKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiA8Y29kZT5zcWw8\nL2NvZGU+IHJlcHJlc2VudHMgYSBzZWxlY3Qgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NlbGVjdChTdHJpbmcgc3FsKSB7CiAg\nICAgICAgSXRlcmF0b3IgaSA9IHNlbGVjdFdvcmRTZXQuaXRlcmF0b3IoKTsK\nICAgICAgICBTdHJpbmcgY3VyOwogICAgICAgIHdoaWxlIChpLmhhc05leHQo\nKSkgewogICAgICAgICAgICBjdXIgPSAoU3RyaW5nKSBpLm5leHQoKTsKICAg\nICAgICAgICAgaWYgKHNxbC5sZW5ndGgoKSA+PSBjdXIubGVuZ3RoKCkKICAg\nICAgICAgICAgICAgICAgICAmJiBzcWwuc3Vic3RyaW5nKDAsIGN1ci5sZW5n\ndGgoKSkuZXF1YWxzSWdub3JlQ2FzZShjdXIpKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbmVl\nZHNUb0NyZWF0ZUluZGV4KEluZGV4IGlkeCwgVGFibGUgdGFibGUpIHsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRUcmltU2NoZW1hTmFtZSgpIHsKICAgICAgICByZXR1cm4gdHJpbVNjaGVt\nYU5hbWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VHJpbVNjaGVtYU5h\nbWUoYm9vbGVhbiB0cmltU2NoZW1hTmFtZSkgewogICAgICAgIHRoaXMudHJp\nbVNjaGVtYU5hbWUgPSB0cmltU2NoZW1hTmFtZTsKICAgIH0KfQo=\n","encoding":"base64"}

