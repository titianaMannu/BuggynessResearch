{"sha":"0da1e5fb8aebbda5e97e4776be1a25ce7ea420a3","node_id":"MDQ6QmxvYjIwNjM2NDowZGExZTVmYjhhZWJiZGE1ZTk3ZTQ3NzZiZTFhMjVjZTdlYTQyMGEz","size":43374,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0da1e5fb8aebbda5e97e4776be1a25ce7ea420a3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpE\nQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJWYWx1ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5n\nRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuamRiYy5EZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247\nCgppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogRGljdGlvbmFy\neSBmb3IgT3JhY2xlLgogKi8KcHVibGljIGNsYXNzIE9yYWNsZURpY3Rpb25h\ncnkKICAgIGV4dGVuZHMgREJEaWN0aW9uYXJ5IHsKCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIFN0cmluZyBTRUxFQ1RfSElOVCA9ICJvcGVuanBhLmhpbnQu\nT3JhY2xlU2VsZWN0SGludCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBWRU5ET1JfT1JBQ0xFID0gIm9yYWNsZSI7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEJFSEFWRV9PVEhFUiA9IDA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX09SQUNMRSA9IDE7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX0RBVEFESVJFQ1QzMSA9IDI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgQmxvYiBFTVBUWV9CTE9CID0gbnVsbDsK\nICAgIHByaXZhdGUgc3RhdGljIENsb2IgRU1QVFlfQ0xPQiA9IG51bGw7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2Nh\nbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChPcmFjbGVEaWN0aW9uYXJ5LmNs\nYXNzKTsKCiAgICAvKioKICAgICAqIElmIHRydWUsIHRoZW4gc2ltdWxhdGUg\nYXV0by1hc3NpZ25lZCB2YWx1ZXMgaW4gT3JhY2xlIGJ5CiAgICAgKiB1c2lu\nZyBhIHRyaWdnZXIgdGhhdCBpbnNlcnRzIGEgc2VxdWVuY2UgdmFsdWUgaW50\nbyB0aGUKICAgICAqIHByaW1hcnkga2V5IHZhbHVlIHdoZW4gYSByb3cgaXMg\naW5zZXJ0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHVzZVRyaWdn\nZXJzRm9yQXV0b0Fzc2lnbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVGhl\nIGdsb2JhbCBzZXF1ZW5jZSBuYW1lIHRvIHVzZSBmb3IgYXV0b2Fzc2lnbiBz\naW11bGF0aW9uLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGF1dG9Bc3Np\nZ25TZXF1ZW5jZU5hbWUgPSBudWxsOwoKICAgIC8qKgogICAgICogRmxhZyB0\nbyB1c2UgT3BlbkpQQSAwLjMgc3R5bGUgbmFtaW5nIGZvciBhdXRvIGFzc2ln\nbiBzZXF1ZW5jZSBuYW1lIGFuZAogICAgICogdHJpZ2dlciBuYW1lIGZvciBi\nYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gb3BlbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcyA9IGZhbHNlOwoKICAg\nIC8qKgogICAgICogSWYgdHJ1ZSwgdGhlbiBPcGVuSlBBIHdpbGwgYXR0ZW1w\ndCB0byB1c2UgdGhlIHNwZWNpYWwKICAgICAqIE9yYWNsZVByZXBhcmVkU3Rh\ndGVtZW50LnNldEZvcm1PZlVzZSBtZXRob2QgdG8KICAgICAqIGNvbmZpZ3Vy\nZSBzdGF0ZW1lbnRzIHRoYXQgaXQgZGV0ZWN0cyBhcmUgb3BlcmF0aW5nIG9u\nIHVuaWNvZGUgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB1\nc2VTZXRGb3JtT2ZVc2VGb3JVbmljb2RlID0gdHJ1ZTsKCiAgICAvLyBzb21l\nIG9yYWNsZSBkcml2ZXJzIGhhdmUgcHJvYmxlbXMgd2l0aCBzZWxlY3QgZm9y\nIHVwZGF0ZTsgd2FybiB0aGUKICAgIC8vIGZpcnN0IHRpbWUgbG9ja2luZyBp\ncyBhdHRlbXB0ZWQKICAgIHByaXZhdGUgYm9vbGVhbiBfY2hlY2tlZFVwZGF0\nZUJ1ZyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF93YXJuZWRDaGFy\nQ29sdW1uID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3dhcm5lZE5j\naGFyQ29sdW1uID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfZHJpdmVyQmVo\nYXZpb3IgPSAtMTsKCiAgICAvLyBjYWNoZSBsb2IgbWV0aG9kcwogICAgcHJp\ndmF0ZSBNZXRob2QgX3B1dEJ5dGVzID0gbnVsbDsKICAgIHByaXZhdGUgTWV0\naG9kIF9wdXRTdHJpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2QgX3B1\ndENoYXJzID0gbnVsbDsKCiAgICBwdWJsaWMgT3JhY2xlRGljdGlvbmFyeSgp\nIHsKICAgICAgICBwbGF0Zm9ybSA9ICJPcmFjbGUiOwogICAgICAgIHZhbGlk\nYXRpb25TUUwgPSAiU0VMRUNUIFNZU0RBVEUgRlJPTSBEVUFMIjsKICAgICAg\nICBuZXh0U2VxdWVuY2VRdWVyeSA9ICJTRUxFQ1QgezB9Lk5FWFRWQUwgRlJP\nTSBEVUFMIjsKICAgICAgICBzdHJpbmdMZW5ndGhGdW5jdGlvbiA9ICJMRU5H\nVEgoezB9KSI7CiAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9EQVRBQkFT\nRTsKICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGggPSAzMDsKICAgICAgICBt\nYXhDb2x1bW5OYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4SW5kZXhOYW1l\nTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgg\nPSAzMDsKICAgICAgICBtYXhFbWJlZGRlZEJsb2JTaXplID0gNDAwMDsKICAg\nICAgICBtYXhFbWJlZGRlZENsb2JTaXplID0gNDAwMDsKICAgICAgICBpbkNs\nYXVzZUxpbWl0ID0gMTAwMDsKCiAgICAgICAgc3VwcG9ydHNEZWZlcnJlZENv\nbnN0cmFpbnRzID0gdHJ1ZTsKICAgICAgICBzdXBwb3J0c0xvY2tpbmdXaXRo\nRGlzdGluY3RDbGF1c2UgPSBmYWxzZTsKICAgICAgICBzdXBwb3J0c1NlbGVj\ndFN0YXJ0SW5kZXggPSB0cnVlOwogICAgICAgIHN1cHBvcnRzU2VsZWN0RW5k\nSW5kZXggPSB0cnVlOwoKICAgICAgICBzeXN0ZW1TY2hlbWFTZXQuYWRkQWxs\nKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAgICAiQ1RY\nU1lTIiwgIk1EU1lTIiwgIlNZUyIsICJTWVNURU0iLCAiV0tTWVMiLCAiV01T\nWVMiLCAiWERCIiwKICAgICAgICB9KSk7CgogICAgICAgIHN1cHBvcnRzWE1M\nQ29sdW1uID0gdHJ1ZTsKICAgICAgICB4bWxUeXBlTmFtZSA9ICJYTUxUeXBl\nIjsKICAgICAgICBiaWdpbnRUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAg\nICAgIGJpdFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgZGVjaW1h\nbFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgZG91YmxlVHlwZU5h\nbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBpbnRlZ2VyVHlwZU5hbWUgPSAi\nTlVNQkVSezB9IjsKICAgICAgICBudW1lcmljVHlwZU5hbWUgPSAiTlVNQkVS\nezB9IjsKICAgICAgICBzbWFsbGludFR5cGVOYW1lID0gIk5VTUJFUnswfSI7\nCiAgICAgICAgdGlueWludFR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAg\nICAgbG9uZ1ZhcmNoYXJUeXBlTmFtZSA9ICJMT05HIjsKICAgICAgICBiaW5h\ncnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICB2YXJiaW5hcnlUeXBlTmFt\nZSA9ICJCTE9CIjsKICAgICAgICBsb25nVmFyYmluYXJ5VHlwZU5hbWUgPSAi\nQkxPQiI7CiAgICAgICAgdGltZVR5cGVOYW1lID0gIkRBVEUiOwogICAgICAg\nIHZhcmNoYXJUeXBlTmFtZSA9ICJWQVJDSEFSMnswfSI7CiAgICAgICAgZml4\nZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0\ncmluZ1tdewogICAgICAgICAgICAiTE9ORyBSQVciLCAiUkFXIiwgIkxPTkci\nLCAiUkVGIiwKICAgICAgICB9KSk7CiAgICAgICAgcmVzZXJ2ZWRXb3JkU2V0\nLmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsKICAgICAgICAg\nICAgIkFDQ0VTUyIsICJBVURJVCIsICJDTFVTVEVSIiwgIkNPTU1FTlQiLCAi\nQ09NUFJFU1MiLCAiRVhDTFVTSVZFIiwKICAgICAgICAgICAgIkZJTEUiLCAi\nSURFTlRJRklFRCIsICJJTkNSRU1FTlQiLCAiSU5ERVgiLCAiSU5JVElBTCIs\nICJMT0NLIiwKICAgICAgICAgICAgIkxPTkciLCAiTUFYRVhURU5UUyIsICJN\nSU5VUyIsICJNT0RFIiwgIk5PQVVESVQiLCAiTk9DT01QUkVTUyIsCiAgICAg\nICAgICAgICJOT1dBSVQiLCAiT0ZGTElORSIsICJPTkxJTkUiLCAiUENURlJF\nRSIsICJST1ciLAogICAgICAgIH0pKTsKICAgICAgICAKICAgICAgICBzZWxl\nY3RXb3JkU2V0LmFkZCgiV0lUSCIpOwogICAgICAgIHJlcXVpcmVzU2VhcmNo\nU3RyaW5nRXNjYXBlRm9yTGlrZSA9IGZhbHNlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgc3VwZXIuZW5k\nQ29uZmlndXJhdGlvbigpOwogICAgICAgIGlmICh1c2VUcmlnZ2Vyc0ZvckF1\ndG9Bc3NpZ24pCiAgICAgICAgICAgIHN1cHBvcnRzQXV0b0Fzc2lnbiA9IHRy\ndWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29ubmVjdGVkQ29uZmlndXJh\ndGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc3VwZXIuY29ubmVjdGVkQ29uZmlndXJhdGlvbihj\nb25uKTsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9yID09IG51bGwpIHsKICAg\nICAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRhID0gY29ubi5nZXRNZXRh\nRGF0YSgpOwogICAgICAgICAgICBTdHJpbmcgdXJsID0gKG1ldGEuZ2V0VVJM\nKCkgPT0gbnVsbCkgPyAiIiA6IG1ldGEuZ2V0VVJMKCk7CiAgICAgICAgICAg\nIFN0cmluZyBkcml2ZXJOYW1lID0gbWV0YS5nZXREcml2ZXJOYW1lKCk7CiAg\nICAgICAgICAgIFN0cmluZyBtZXRhZGF0YUNsYXNzTmFtZTsKICAgICAgICAg\nICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nRGF0YWJhc2VNZXRh\nRGF0YSkKICAgICAgICAgICAgICAgIG1ldGFkYXRhQ2xhc3NOYW1lID0gKChE\nZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSkgbWV0YSkuCiAgICAgICAgICAg\nICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKS5nZXRDbGFzcygpLmdl\ndE5hbWUoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWV0\nYWRhdGFDbGFzc05hbWUgPSBtZXRhLmdldENsYXNzKCkuZ2V0TmFtZSgpOwoK\nICAgICAgICAgICAgLy8gY2hlY2sgYm90aCB0aGUgZHJpdmVyIGNsYXNzIG5h\nbWUgYW5kIHRoZSBVUkwgZm9yIGtub3duIHBhdHRlcm5zCiAgICAgICAgICAg\nIGlmIChtZXRhZGF0YUNsYXNzTmFtZS5zdGFydHNXaXRoKCJvcmFjbGUuIikK\nICAgICAgICAgICAgICAgIHx8IHVybC5pbmRleE9mKCJqZGJjOm9yYWNsZToi\nKSAhPSAtMQogICAgICAgICAgICAgICAgfHwgIk9yYWNsZSBKREJDIGRyaXZl\nciIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAgICAgICAgICAgICBkcml2\nZXJWZW5kb3IgPSBWRU5ET1JfT1JBQ0xFICsgbWV0YS5nZXREcml2ZXJNYWpv\nclZlcnNpb24oKQogICAgICAgICAgICAgICAgICAgICsgbWV0YS5nZXREcml2\nZXJNaW5vclZlcnNpb24oKTsKCiAgICAgICAgICAgICAgICBTdHJpbmcgcHJv\nZHVjdFZlcnNpb24gPSBtZXRhLmdldERhdGFiYXNlUHJvZHVjdFZlcnNpb24o\nKQogICAgICAgICAgICAgICAgICAgIC5zcGxpdCgiUmVsZWFzZSAiLDApWzFd\nLnNwbGl0KCJcXC4iLDApWzBdOwogICAgICAgICAgICAgICAgaW50IHJlbGVh\nc2UgPSBJbnRlZ2VyLnBhcnNlSW50KHByb2R1Y3RWZXJzaW9uKTsKICAgICAg\nICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gd2FybiBzcWw5MgogICAg\nICAgICAgICAgICAgaWYgKHJlbGVhc2UgPD0gOCkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChqb2luU3ludGF4ID09IFNZTlRBWF9TUUw5MiAmJiBsb2cu\naXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cu\nd2FybihfbG9jLmdldCgib3JhY2xlLXN5bnRheCIpKTsKICAgICAgICAgICAg\nICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwogICAgICAg\nICAgICAgICAgICAgIGRhdGVUeXBlTmFtZSA9ICJEQVRFIjsgLy8gYWRkZWQg\nb3JhY2xlIDkKICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXBUeXBlTmFt\nZSA9ICJEQVRFIjsgLy8gYWRkZWQgb3JhY2xlIDkKICAgICAgICAgICAgICAg\nICAgICBzdXBwb3J0c1hNTENvbHVtbiA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAg\nIC8vIHNlbGVjdCBvZiBhbiB4bWwgY29sdW1uIHJlcXVpcmVzICIuZ2V0U3Ry\naW5nVmFsKCkiCiAgICAgICAgICAgICAgICAgICAgLy8gc3VmZml4LiBlZy4g\ndDAueG1sY29sLmdldFN0cmluZ1ZhbCgpCiAgICAgICAgICAgICAgICAgICAg\nZ2V0U3RyaW5nVmFsID0gIi5nZXRTdHJpbmdWYWwoKSI7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3RhcnRzV2l0aCgiY29t\nLmRkdGVrLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5kZXhPZigiamRi\nYzpkYXRhZGlyZWN0Om9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAg\nfHwgIk9yYWNsZSIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAgICAgICAg\nICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfREFUQURJUkVDVCArIG1ldGEu\nZ2V0RHJpdmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAgICAgICAgICAr\nIG1ldGEuZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09U\nSEVSOwogICAgICAgIH0KICAgICAgICBjYWNoZURyaXZlckJlaGF2aW9yKGRy\naXZlclZlbmRvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBjb25z\ndGFudCBmb3IgZHJpdmVycyB3aXRoIGJlaGF2aW9ycyB3ZSBoYXZlIHRvIGRl\nYWwgd2l0aC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRHJpdmVy\nQmVoYXZpb3IoU3RyaW5nIGRyaXZlclZlbmRvcikgewogICAgICAgIGlmIChf\nZHJpdmVyQmVoYXZpb3IgIT0gLTEpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgZHJpdmVyVmVuZG9yID0gZHJpdmVyVmVuZG9yLnRvTG93ZXJDYXNl\nKCk7CiAgICAgICAgaWYgKGRyaXZlclZlbmRvci5zdGFydHNXaXRoKFZFTkRP\nUl9PUkFDTEUpKQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3IgPSBCRUhB\nVkVfT1JBQ0xFOwogICAgICAgIGVsc2UgaWYgKGRyaXZlclZlbmRvci5lcXVh\nbHMoVkVORE9SX0RBVEFESVJFQ1QgKyAiMzAiKQogICAgICAgICAgICB8fCBk\ncml2ZXJWZW5kb3IuZXF1YWxzKFZFTkRPUl9EQVRBRElSRUNUICsgIjMxIikp\nCiAgICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9EQVRBRElS\nRUNUMzE7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHJpdmVyQmVoYXZp\nb3IgPSBCRUhBVkVfT1RIRVI7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbnN1\ncmUgdGhhdCB0aGUgZHJpdmVyIHZlbmRvciBoYXMgYmVlbiBzZXQsIGFuZCBp\nZiBub3QsIHNldCBpdCBub3cuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGVu\nc3VyZURyaXZlclZlbmRvcigpIHsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9y\nICE9IG51bGwpIHsKICAgICAgICAgICAgY2FjaGVEcml2ZXJCZWhhdmlvcihk\ncml2ZXJWZW5kb3IpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAg\nbG9nLmluZm8oX2xvYy5nZXQoIm9yYWNsZS1jb25uZWN0aW5nLWZvci1kcml2\nZXIiKSk7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBjb25uID0gY29uZi5nZXREYXRhU291cmNl\nMihudWxsKS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIGNvbm5lY3Rl\nZENvbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIHRoaXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0xvY2tpbmcoU2VsZWN0IHNlbCkgewogICAgICAgIGlmICghc3Vw\nZXIuc3VwcG9ydHNMb2NraW5nKHNlbCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICByZXR1cm4gIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFu\nZ2Uoc2VsLmdldFN0YXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVu\nZEluZGV4KCksIHNlbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygp\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNlbGVjdHMo\nU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJzLAogICAg\nICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gaWYgcmFuZ2Ug\nZG9lc24ndCByZXF1aXJlIGEgc3Vic2VsZWN0IGNhbiB1c2Ugc3VwZXIKICAg\nICAgICBpZiAoIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc2VsLmdldFN0\nYXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVuZEluZGV4KCksIHNl\nbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygpKSkKICAgICAgICAg\nICAgcmV0dXJuIHN1cGVyLmdldFNlbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50\naWZpZXJzLCBmb3JVcGRhdGUpOwoKICAgICAgICAvLyBpZiB0aGVyZSBhcmUg\nbm8gam9pbnMgaW52b2x2ZWQgb3Igd2UncmUgdXNpbmcgYSBmcm9tIHNlbGVj\ndCBzbwogICAgICAgIC8vIHRoYXQgYWxsIGNvbHMgYWxyZWFkeSBoYXZlIHVu\naXF1ZSBhbGlhc2VzLCBjYW4gdXNlIHN1cGVyCiAgICAgICAgaWYgKHNlbC5n\nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCB8fCBzZWwuZ2V0VGFibGVBbGlhc2Vz\nKCkuc2l6ZSgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNl\nbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50aWZpZXJzLCBmb3JVcGRhdGUpOwoK\nICAgICAgICAvLyBzaW5jZSBub25lIG9mIHRoZSBjb25kaXRpb25zIGFib3Zl\nIHdlcmUgbWV0LCB3ZSdyZSBkZWFsaW5nIHdpdGgKICAgICAgICAvLyBhIHNl\nbGVjdCB0aGF0IHVzZXMgam9pbnMgYW5kIHJlcXVpcmVzIHN1YnNlbGVjdHMg\ndG8gc2VsZWN0IHRoZQogICAgICAgIC8vIHByb3BlciByYW5nZTsgYWxpYXMg\nYWxsIGNvbHVtbiB2YWx1ZXMgc28gdGhhdCB0aGV5IGFyZSB1bmlxdWUgd2l0\naGluCiAgICAgICAgLy8gdGhlIHN1YnNlbGVjdAogICAgICAgIFNRTEJ1ZmZl\nciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIExp\nc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVudGlmaWVycykK\nICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNl\ncygpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5n\nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBhbGlhczsKICAg\nICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBh\nbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGkrKykgewogICAg\nICAgICAgICBhbGlhcyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChh\nbGlhcyBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgICAgIHNl\nbGVjdFNRTC5hcHBlbmQoKFNRTEJ1ZmZlcikgYWxpYXMpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGFsaWFz\nLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIg\nQVMgYyIpLmFwcGVuZChTdHJpbmcudmFsdWVPZihpKSk7CiAgICAgICAgICAg\nIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgc2VsZWN0U1FM\nLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVj\ndFNRTDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5PdXRlckpvaW4o\naW50IHN5bnRheCwgRm9yZWlnbktleSBmaykgewogICAgICAgIGlmICghc3Vw\nZXIuY2FuT3V0ZXJKb2luKHN5bnRheCwgZmspKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKGZrICE9IG51bGwgJiYgc3ludGF4ID09\nIFNZTlRBWF9EQVRBQkFTRSkgewogICAgICAgICAgICBpZiAoZmsuZ2V0Q29u\nc3RhbnRzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb25zdGFu\ndHMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvTmF0aXZlSm9pbihKb2luIGpvaW4pIHsKICAg\nICAgICBpZiAoam9pbi5nZXRUeXBlKCkgIT0gSm9pbi5UWVBFX09VVEVSKQog\nICAgICAgICAgICByZXR1cm4gdG9UcmFkaXRpb25hbEpvaW4oam9pbik7Cgog\nICAgICAgIEZvcmVpZ25LZXkgZmsgPSBqb2luLmdldEZvcmVpZ25LZXkoKTsK\nICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGJvb2xlYW4gaW52ZXJzZSA9IGpvaW4uaXNGb3JlaWdu\nS2V5SW52ZXJzZWQoKTsKICAgICAgICBDb2x1bW5bXSBmcm9tID0gKGludmVy\nc2UpID8gZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKQogICAgICAgICAgICA6\nIGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0byA9IChpbnZl\ncnNlKSA/IGZrLmdldENvbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdldFBy\naW1hcnlLZXlDb2x1bW5zKCk7CgogICAgICAgIC8vIGRvIGNvbHVtbiBqb2lu\ncwogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMp\nOwogICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmcm9tLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAg\nICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxp\nYXMxKCkpLmFwcGVuZCgiLiIpLmFwcGVuZChmcm9tW2ldKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nam9pbi5nZXRBbGlhczIoKSkuYXBwZW5kKCIuIikuYXBwZW5kKHRvW2ldKTsK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCspIik7CiAgICAgICAgfQoKICAg\nICAgICAvLyBjaGVjayBjb25zdGFudCBqb2lucwogICAgICAgIGlmIChmay5n\nZXRDb25zdGFudENvbHVtbnMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm9yYWNsZS1jb25z\ndGFudCIsCiAgICAgICAgICAgICAgICBqb2luLmdldFRhYmxlMSgpLCBqb2lu\nLmdldFRhYmxlMigpKSkuc2V0RmF0YWwodHJ1ZSk7CgogICAgICAgIGlmIChm\nay5nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID4gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJvcmFjbGUtY29uc3RhbnQiLAogICAgICAgICAgICAgICAgam9pbi5nZXRU\nYWJsZTEoKSwgam9pbi5nZXRUYWJsZTIoKSkpLnNldEZhdGFsKHRydWUpOwog\nICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0LCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciB0YWJsZXMsIFNRTEJ1\nZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1ZmZl\nciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29sZWFuIGRp\nc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBl\nbmQsCiAgICAgICAgU2VsZWN0IHNlbCkgewogICAgICAgIGlmICghX2NoZWNr\nZWRVcGRhdGVCdWcpIHsKICAgICAgICAgICAgZW5zdXJlRHJpdmVyVmVuZG9y\nKCk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgX2RyaXZlckJlaGF2\naW9yID09IEJFSEFWRV9EQVRBRElSRUNUMzEpCiAgICAgICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgiZGQtbG9jay1idWciKSk7CiAgICAgICAgICAg\nIF9jaGVja2VkVXBkYXRlQnVnID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAg\nIC8vIGlmIG5vIHJhbmdlLCB1c2Ugc3RhbmRhcmQgc2VsZWN0CiAgICAgICAg\naWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IExvbmcuTUFYX1ZBTFVFKQogICAg\nICAgICAgICByZXR1cm4gc3VwZXIudG9TZWxlY3Qoc2VsZWN0LCBmZXRjaCwg\ndGFibGVzLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAgICAg\nIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxV\nRSwgc2VsKTsKCiAgICAgICAgLy8gaWYgbm8gc2tpcCwgb3JkZXJpbmcsIG9y\nIGRpc3RpbmN0IGNhbiB1c2Ugcm93bnVtIGRpcmVjdGx5CiAgICAgICAgU1FM\nQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYg\nKCFyZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKHN0YXJ0LCBlbmQsIGRpc3Rp\nbmN0LCBvcmRlcikpIHsKICAgICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwg\nJiYgIXdoZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQod2hlcmUpLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAgICAgICAg\nICAgIHJldHVybiBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJs\nZXMsIGJ1ZiwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAgICAgIG9yZGVy\nLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSwgc2Vs\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoZXJlIGlzIG9yZGVyaW5n\nLCBza2lwLCBvciBkaXN0aW5jdCB3ZSBoYXZlIHRvIHVzZSBzdWJzZWxlY3Rz\nCiAgICAgICAgU1FMQnVmZmVyIG5ld3NlbCA9IHN1cGVyLnRvU2VsZWN0KHNl\nbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hlcmUsCiAgICAgICAgICAgIGdyb3Vw\nLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25n\nLk1BWF9WQUxVRSwKICAgICAgICAgICAgc2VsKTsKCiAgICAgICAgLy8gaWYg\nbm8gc2tpcCwgY2FuIHVzZSBzaW5nbGUgbmVzdGVkIHN1YnNlbGVjdAogICAg\nICAgIGlmIChzdGFydCA9PSAwKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSArICIgKiBGUk9NICgiKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZChuZXdzZWwpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKCIpIFdIRVJFIFJPV05VTSA8PSAiKS5hcHBlbmRWYWx1ZShlbmQp\nOwogICAgICAgICAgICByZXR1cm4gYnVmOwogICAgICAgIH0KCiAgICAgICAg\nLy8gd2l0aCBhIHNraXAsIHdlIGhhdmUgdG8gdXNlIGEgZG91YmxlLW5lc3Rl\nZCBzdWJzZWxlY3QgdG8gcHV0CiAgICAgICAgLy8gd2hlcmUgY29uZGl0aW9u\ncyBvbiB0aGUgcm93bnVtCiAgICAgICAgYnVmLmFwcGVuZChnZXRTZWxlY3RP\ncGVyYXRpb24oZmV0Y2gpCiAgICAgICAgICAgICsgIiAqIEZST00gKFNFTEVD\nVCByLiosIFJPV05VTSBSTlVNIEZST00gKCIpOwogICAgICAgIGJ1Zi5hcHBl\nbmQobmV3c2VsKTsKICAgICAgICBidWYuYXBwZW5kKCIpIHIiKTsKICAgICAg\nICBpZiAoZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgV0hFUkUgUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7\nCiAgICAgICAgYnVmLmFwcGVuZCgiKSBXSEVSRSBSTlVNID4gIikuYXBwZW5k\nVmFsdWUoc3RhcnQpOwogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgc2VsZWN0IHdpdGggdGhl\nIGdpdmVuIHBhcmFtZXRlcnMgbmVlZHMgYQogICAgICogc3Vic2VsZWN0IHRv\nIGFwcGx5IGEgcmFuZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBy\nZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKGxvbmcgc3RhcnQsIGxvbmcgZW5k\nLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIFNRTEJ1ZmZlciBvcmRlcikg\newogICAgICAgIGlmIChzdGFydCA9PSAwICYmIGVuZCA9PSBMb25nLk1BWF9W\nQUxVRSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVy\nbiBzdGFydCAhPSAwIHx8IGRpc3RpbmN0IHx8IChvcmRlciAhPSBudWxsICYm\nICFvcmRlci5pc0VtcHR5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hl\nY2sgdG8gc2VlIGlmIHdlIGhhdmUgc2V0IHRoZSB7QGxpbmsgI1NFTEVDVF9I\nSU5UfSBpbiB0aGUKICAgICAqIGZldGNoIGNvbmZpZ3VyYWl0b24sIGFuZCBp\nZiBzbywgYXBwZW5kIHRoZSBPcmFjaGUgaGludCBhZnRlciB0aGUKICAgICAq\nICJTRUxFQ1QiIHBhcnQgb2YgdGhlIHF1ZXJ5LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nIGdldFNlbGVjdE9wZXJhdGlvbihKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgT2JqZWN0IGhpbnQgPSBmZXRjaCA9\nPSBudWxsID8gbnVsbCA6IGZldGNoLmdldEhpbnQoU0VMRUNUX0hJTlQpOwog\nICAgICAgIFN0cmluZyBzZWxlY3QgPSAiU0VMRUNUIjsKICAgICAgICBpZiAo\naGludCAhPSBudWxsKQogICAgICAgICAgICBzZWxlY3QgKz0gIiAiICsgaGlu\ndDsKICAgICAgICByZXR1cm4gc2VsZWN0OwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN1YnN0cmluZyhTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIs\nIEZpbHRlclZhbHVlIHN0YXJ0LAogICAgICAgIEZpbHRlclZhbHVlIGVuZCkg\newogICAgICAgIGJ1Zi5hcHBlbmQoIlNVQlNUUigiKTsKICAgICAgICBzdHIu\nYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBwZW5kKCIsICgiKTsKICAg\nICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQo\nIiArIDEpIik7CiAgICAgICAgaWYgKGVuZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiwgKCIpOwogICAgICAgICAgICBlbmQuYXBwZW5k\nVG8oYnVmKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIC0gIik7CiAgICAg\nICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIikiKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgiKSIp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFN0cmluZyhQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIC8vIG9yYWNsZSBOQ0hBUi9OVkFSQ0hBUi9OQ0xPQiB1bmljb2RlIGNv\nbHVtbnMgcmVxdWlyZSBzb21lCiAgICAgICAgLy8gc3BlY2lhbCBoYW5kbGlu\nZyB0byBjb25maWd1cmUgdGhlbSBjb3JyZWN0bHk7IHNlZToKICAgICAgICAv\nLyBodHRwOi8vd3d3Lm9yYWNsZS5jb20vdGVjaG5vbG9neS9zYW1wbGVfY29k\nZS90ZWNoL2phdmEvCiAgICAgICAgLy8gc3Fsal9qZGJjL2ZpbGVzLzlpX2pk\nYmMvTkNIQVJzdXBwb3J0NFVuaWNvZGVTYW1wbGUvUmVhZG1lLmh0bWwKICAg\nICAgICBTdHJpbmcgdHlwZU5hbWUgPSAoY29sID09IG51bGwpID8gbnVsbCA6\nIGNvbC5nZXRUeXBlTmFtZSgpOwogICAgICAgIGlmICh1c2VTZXRGb3JtT2ZV\nc2VGb3JVbmljb2RlICYmIHR5cGVOYW1lICE9IG51bGwgJiYKICAgICAgICAg\nICAgKHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgibnZhcmNo\nYXIiKSB8fAogICAgICAgICAgICAgICAgdHlwZU5hbWUudG9Mb3dlckNhc2Uo\nKS5zdGFydHNXaXRoKCJuY2hhciIpIHx8CiAgICAgICAgICAgICAgICB0eXBl\nTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoIm5jbG9iIikpKSB7CiAg\nICAgICAgICAgIFN0YXRlbWVudCBpbm5lciA9IHN0bW50OwogICAgICAgICAg\nICBpZiAoaW5uZXIgaW5zdGFuY2VvZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0\nZW1lbnQpCiAgICAgICAgICAgICAgICBpbm5lciA9ICgoRGVsZWdhdGluZ1By\nZXBhcmVkU3RhdGVtZW50KSBpbm5lcikuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKGlzT3Jh\nY2xlUHJlcGFyZWRTdGF0ZW1lbnQoaW5uZXIpKSB7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlubmVyLmdldENsYXNzKCku\nZ2V0TWV0aG9kKCJzZXRGb3JtT2ZVc2UiLAogICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzLCBzaG9ydC5jbGFzcyB9KS4K\nICAgICAgICAgICAgICAgICAgICAgICAgaW52b2tlKGlubmVyLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG5ldyBJbnRlZ2VyKGlkeCksCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIm9yYWNsZS5qZGJj\nLk9yYWNsZVByZXBhcmVkU3RhdGVtZW50IikuCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldEZpZWxkKCJGT1JNX05DSEFSIikuZ2V0\nKG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIGxvZy53YXJu\nKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYg\nKCFfd2FybmVkTmNoYXJDb2x1bW4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgX3dhcm5lZE5jaGFyQ29sdW1uID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJ1bmNvbmZpZ3Vy\nZWQtbmNoYXItY29scyIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gY2FsbCBzZXRGaXhlZENIQVIgZm9yIGZpeGVkIHdpZHRoIGNo\nYXJhY3RlciBjb2x1bW5zIHRvIGdldCBwYWRkaW5nCiAgICAgICAgLy8gc2Vt\nYW50aWNzCiAgICAgICAgaWYgKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBl\nKCkgPT0gVHlwZXMuQ0hBUgogICAgICAgICAgICAmJiB2YWwgIT0gbnVsbCAm\nJiB2YWwubGVuZ3RoKCkgIT0gY29sLmdldFNpemUoKSkgewogICAgICAgICAg\nICBTdGF0ZW1lbnQgaW5uZXIgPSBzdG1udDsKICAgICAgICAgICAgaWYgKGlu\nbmVyIGluc3RhbmNlb2YgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KQog\nICAgICAgICAgICAgICAgaW5uZXIgPSAoKERlbGVnYXRpbmdQcmVwYXJlZFN0\nYXRlbWVudCkgaW5uZXIpLgogICAgICAgICAgICAgICAgICAgIGdldElubmVy\nbW9zdERlbGVnYXRlKCk7CiAgICAgICAgICAgIGlmIChpc09yYWNsZVByZXBh\ncmVkU3RhdGVtZW50KGlubmVyKSkgewogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBpbm5lci5nZXRDbGFzcygpLmdldE1ldGhv\nZCgic2V0Rml4ZWRDSEFSIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IGludC5jbGFzcywgU3RyaW5nLmNsYXNzIH0pLgogICAgICAg\nICAgICAgICAgICAgICAgICBpbnZva2UoaW5uZXIsIG5ldyBPYmplY3RbXXsg\nbmV3IEludGVnZXIoaWR4KSwgdmFsIH0pOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghX3dh\ncm5lZENoYXJDb2x1bW4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgX3dhcm5lZENoYXJDb2x1bW4gPSB0cnVlOwogICAgICAg\nICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVucGFkZGVkLWNoYXItY29s\ncyIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdXBlci5z\nZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLCBjb2wpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldE51bGwoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGlu\ndCBpZHgsIGludCBjb2xUeXBlLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNvbFR5cGUg\nPT0gVHlwZXMuQkxPQiAmJiBfZHJpdmVyQmVoYXZpb3IgPT0gQkVIQVZFX09S\nQUNMRSkKICAgICAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgsIGdldEVtcHR5\nQmxvYigpKTsKICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09IFR5cGVzLkNM\nT0IgJiYgX2RyaXZlckJlaGF2aW9yID09IEJFSEFWRV9PUkFDTEUKICAgICAg\nICAgICAgJiYgIWNvbC5pc1hNTCgpKQogICAgICAgICAgICBzdG1udC5zZXRD\nbG9iKGlkeCwgZ2V0RW1wdHlDbG9iKCkpOwogICAgICAgIGVsc2UgaWYgKChj\nb2xUeXBlID09IFR5cGVzLlNUUlVDVCB8fCBjb2xUeXBlID09IFR5cGVzLk9U\nSEVSKQogICAgICAgICAgICAmJiBjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlw\nZU5hbWUoKSAhPSBudWxsKQogICAgICAgICAgICBzdG1udC5zZXROdWxsKGlk\neCwgVHlwZXMuU1RSVUNULCBjb2wuZ2V0VHlwZU5hbWUoKSk7CiAgICAgICAg\nICAgIC8vIHNvbWUgdmVyc2lvbnMgb2YgdGhlIE9yYWNsZSBKREJDIGRyaXZl\nciB3aWxsIGZhaWwgaWYgY2FsbGluZwogICAgICAgICAgICAvLyBzZXROdWxs\nIHdpdGggREFURTsgc2VlIGJ1ZyAjMTE3MQogICAgICAgIGVsc2UgaWYgKGNv\nbFR5cGUgPT0gVHlwZXMuREFURSkKICAgICAgICAgICAgc3VwZXIuc2V0TnVs\nbChzdG1udCwgaWR4LCBUeXBlcy5USU1FU1RBTVAsIGNvbCk7CiAgICAgICAg\nLy8gdGhlIE9yYWNsZSBkcml2ZXIgZG9lcyBub3Qgc3VwcG9ydCBUeXBlcy5P\nVEhFUiB3aXRoIHNldE51bGwKICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09\nIFR5cGVzLk9USEVSIHx8IGNvbC5pc1hNTCgpKQogICAgICAgICAgICBzdXBl\nci5zZXROdWxsKHN0bW50LCBpZHgsIFR5cGVzLk5VTEwsIGNvbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzdXBlci5zZXROdWxsKHN0bW50LCBpZHgs\nIGNvbFR5cGUsIGNvbCk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRD\nbG9iU3RyaW5nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2RyaXZlckJlaGF2\naW9yICE9IEJFSEFWRV9PUkFDTEUpCiAgICAgICAgICAgIHJldHVybiBzdXBl\nci5nZXRDbG9iU3RyaW5nKHJzLCBjb2x1bW4pOwoKICAgICAgICBDbG9iIGNs\nb2IgPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChjbG9iID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChj\nbG9iLmdldENsYXNzKCkuZ2V0TmFtZSgpLmVxdWFscygib3JhY2xlLnNxbC5D\nTE9CIikpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlm\nICgoKEJvb2xlYW4pIENsYXNzLmZvck5hbWUoIm9yYWNsZS5zcWwuQ0xPQiIp\nLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGhvZCgiaXNFbXB0eUxvYiIs\nIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICAgICAgaW52b2tlKGNs\nb2IsIG5ldyBPYmplY3RbMF0pKS4KICAgICAgICAgICAgICAgICAgICBib29s\nZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIC8vIHBvc3NpYmx5IGRpZmZlcmVudCB2ZXJzaW9uIG9mIHRoZSBk\ncml2ZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2xv\nYi5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZlIHN0cmluZ3Mgb3Zl\nciA0IGJpbGxpb24gY2hhcnMKICAgICAgICByZXR1cm4gY2xvYi5nZXRTdWJT\ndHJpbmcoMSwgKGludCkgY2xvYi5sZW5ndGgoKSk7CiAgICB9CgogICAgcHVi\nbGljIFRpbWVzdGFtcCBnZXRUaW1lc3RhbXAoUmVzdWx0U2V0IHJzLCBpbnQg\nY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGltZXN0\nYW1wKHJzLCBjb2x1bW4sIGNhbCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEFy\ncmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBhZSkgewogICAgICAgICAg\nICAgICAgLy8gQ1IyOTU2MDQ6IGlzc3VlIGEgd2FybmluZyB0aGlzIHRoaXMg\nYnVnIGNhbiBiZSBnb3R0ZW4KICAgICAgICAgICAgICAgIC8vIGFyb3VuZCB3\naXRoIFN1cHBvcnRzVGltZXN0YW1wTmFub3M9ZmFsc2UKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJvcmFjbGUtdGltZXN0YW1wLWJ1ZyIp\nLCBhZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBhZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIE9yYWNsZSBidWcgd2hl\ncmUgbmFub3Mgbm90IHJldHVybmVkIGZyb20gY2FsbCB3aXRoIENhbGVuZGFy\nCiAgICAgICAgLy8gcGFyYW1ldGVyCiAgICAgICAgVGltZXN0YW1wIHRzID0g\ncnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAgICAgICBpZiAodHMg\nIT0gbnVsbCAmJiB0cy5nZXROYW5vcygpID09IDApCiAgICAgICAgICAgIHRz\nLnNldE5hbm9zKHJzLmdldFRpbWVzdGFtcChjb2x1bW4pLmdldE5hbm9zKCkp\nOwogICAgICAgIHJldHVybiB0czsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldE9iamVjdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIE1hcCBtYXAp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcmVj\nZW50IG9yYWNsZSBkcml2ZXJzIHJldHVybiBvcmFjbGUtc3BlY2lmaWMgdHlw\nZXMgZm9yIHRpbWVzdGFtcHMKICAgICAgICAvLyBhbmQgZGF0ZXMKICAgICAg\nICBPYmplY3Qgb2JqID0gc3VwZXIuZ2V0T2JqZWN0KHJzLCBjb2x1bW4sIG1h\ncCk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAoIm9yYWNsZS5zcWwuREFURSIuZXF1YWxz\nKG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAgICAgICAgIG9iaiA9\nIGNvbnZlcnRGcm9tT3JhY2xlVHlwZShvYmosICJkYXRlVmFsdWUiKTsKICAg\nICAgICBlbHNlIGlmICgib3JhY2xlLnNxbC5USU1FU1RBTVAiLmVxdWFscyhv\nYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICBvYmogPSBj\nb252ZXJ0RnJvbU9yYWNsZVR5cGUob2JqLCAidGltZXN0YW1wVmFsdWUiKTsK\nICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVydCBhbiBvYmplY3QgZnJvbSBpdHMgcHJvcHJpZXRhcnkgT3JhY2xlIHR5\ncGUgdG8gdGhlIHN0YW5kYXJkCiAgICAgKiBKYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb252ZXJ0RnJvbU9yYWNsZVR5\ncGUoT2JqZWN0IG9iaiwKICAgICAgICBTdHJpbmcgY29udmVydE1ldGhvZCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBNZXRob2QgbSA9IG9iai5nZXRDbGFzcygpLmdldE1ldGhv\nZChjb252ZXJ0TWV0aG9kLCAoQ2xhc3NbXSkgbnVsbCk7CiAgICAgICAgICAg\nIHJldHVybiBtLmludm9rZShvYmosIChPYmplY3RbXSkgbnVsbCk7CiAgICAg\nICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgaWYgKHQg\naW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uKQogICAgICAg\nICAgICAgICAgdCA9ICgoSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbikgdCku\nZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIGlmICh0IGluc3Rh\nbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdGhyb3coU1FM\nRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0\naW9uKHQuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwg\nU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUsIENvbm5lY3Rp\nb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBDb2x1bW5bXSBjb2xzID0gc3VwZXIuZ2V0Q29sdW1ucyhtZXRhLCBjYXRh\nbG9nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsCiAgICAgICAgICAgIGNvbHVt\nbk5hbWUsIGNvbm4pOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgY29scyAh\nPSBudWxsICYmIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmIChjb2xzW2ldLmdldFR5cGVOYW1lKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoY29sc1tpXS5nZXRU\neXBlTmFtZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgiVElNRVNUQU1Q\nIikpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuVElN\nRVNUQU1QKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkJMT0IiLmVxdWFsc0ln\nbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgpKSkKICAgICAgICAgICAg\nICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAg\nZWxzZSBpZiAoIkNMT0IiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRU\neXBlTmFtZSgpKQogICAgICAgICAgICAgICAgfHwgIk5DTE9CIi5lcXVhbHNJ\nZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAgICAg\nICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAgICAg\nIGVsc2UgaWYgKCJGTE9BVCIuZXF1YWxzSWdub3JlQ2FzZShjb2xzW2ldLmdl\ndFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29sc1tpXS5zZXRUeXBl\nKFR5cGVzLkZMT0FUKTsKICAgICAgICAgICAgZWxzZSBpZiAoIk5WQVJDSEFS\nIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAg\nICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuVkFSQ0hBUik7\nCiAgICAgICAgICAgIGVsc2UgaWYgKCJOQ0hBUiIuZXF1YWxzSWdub3JlQ2Fz\nZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29s\nc1tpXS5zZXRUeXBlKFR5cGVzLkNIQVIpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gY29sczsKICAgIH0KCiAgICBwdWJsaWMgUHJpbWFyeUtleVtdIGdl\ndFByaW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwKICAgICAgICBT\ndHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJs\nZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVDVCB0MC5PV05F\nUiBBUyBUQUJMRV9TQ0hFTSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAu\nVEFCTEVfTkFNRSBBUyBUQUJMRV9OQU1FLCAiKS4KICAgICAgICAgICAgYXBw\nZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFNRSwgIikuCiAgICAg\nICAgICAgIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1FIEFTIFBLX05BTUUg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xVTU5T\nIHQwLCBBTExfQ09OU1RSQUlOVFMgdDEgIikuCiAgICAgICAgICAgIGFwcGVu\nZCgiV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RSQUlO\nVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05TVFJB\nSU5UX1RZUEUgPSAnUCciKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBu\ndWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0g\nPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwoKICAg\nICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0\nYXRlbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVzdWx0U2V0IHJz\nID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4ID0g\nMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNjaGVtYU5hbWUu\ndG9VcHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICh0YWJsZU5h\nbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwg\naWR4KyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKCiAgICAg\nICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAg\nIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3\naGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpCiAgICAgICAgICAgICAg\nICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocnMpKTsKICAgICAgICAgICAg\ncmV0dXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAgICAg\nICAgICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5j\nbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIEluZGV4W10gZ2V0SW5kZXhJbmZvKERhdGFiYXNlTWV0\nYURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLCBi\nb29sZWFuIGFwcHJveCwKICAgICAgICBDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nQnVmZmVy\nIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBwZW5k\nKCJTRUxFQ1QgdDAuSU5ERVhfT1dORVIgQVMgVEFCTEVfU0NIRU0sICIpLgog\nICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUgQVMgVEFCTEVfTkFN\nRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RFKHQxLlVOSVFVRU5F\nU1MsICdVTklRVUUnLCAwLCAnTk9OVU5JUVVFJywgMSkgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiQVMgTk9OX1VOSVFVRSwgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgidDAuSU5ERVhfTkFNRSBBUyBJTkRFWF9OQU1FLCAiKS4KICAgICAg\nICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFNRSAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJGUk9NIEFMTF9JTkRfQ09MVU1OUyB0\nMCwgQUxMX0lOREVYRVMgdDEgIikuCiAgICAgICAgICAgIGFwcGVuZCgiV0hF\nUkUgdDAuSU5ERVhfT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJBTkQgdDAuSU5ERVhfTkFNRSA9IHQxLklOREVYX05BTUUiKTsK\nICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxFX09XTkVSID0gPyIpOwogICAgICAg\nIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwoKICAgICAgICBQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudChidWYu\ndG9TdHJpbmcoKSk7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4ID0gMTsKICAgICAgICAg\nICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNl\ndFN0cmluZyhzdG1udCwgaWR4KyssIHNjaGVtYU5hbWUudG9VcHBlckNhc2Uo\nKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHRhYmxl\nTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKCiAgICAgICAgICAgIHJzID0g\nc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3QgaWR4TGlz\ndCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHJzICE9\nIG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICAgICAgaWR4TGlzdC5h\nZGQobmV3SW5kZXgocnMpKTsKICAgICAgICAgICAgcmV0dXJuIChJbmRleFtd\nKSBpZHhMaXN0LnRvQXJyYXkobmV3IEluZGV4W2lkeExpc3Quc2l6ZSgpXSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVkS2V5\ncyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAg\nICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgU3RyaW5nQnVmZmVyIGRlbEFjdGlvbiA9IG5ldyBTdHJpbmdCdWZm\nZXIoIkRFQ09ERSh0MS5ERUxFVEVfUlVMRSIpLgogICAgICAgICAgICBhcHBl\nbmQoIiwgJ05PIEFDVElPTicsICIpLmFwcGVuZChtZXRhLmltcG9ydGVkS2V5\nTm9BY3Rpb24pLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1JFU1RSSUNUJywg\nIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlSZXN0cmljdCkuCiAgICAgICAg\nICAgIGFwcGVuZCgiLCAnQ0FTQ0FERScsICIpLmFwcGVuZChtZXRhLmltcG9y\ndGVkS2V5Q2FzY2FkZSkuCiAgICAgICAgICAgIGFwcGVuZCgiLCAnU0VUIE5V\nTEwnLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtleVNldE51bGwpLgogICAg\nICAgICAgICBhcHBlbmQoIiwgJ1NFVCBERUZBVUxUJywgIikuYXBwZW5kKG1l\ndGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0KS4KICAgICAgICAgICAgYXBwZW5k\nKCIpIik7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5n\nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIHQyLk9XTkVS\nIEFTIFBLVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQoInQy\nLlRBQkxFX05BTUUgQVMgUEtUQUJMRV9OQU1FLCAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJ0Mi5DT0xVTU5fTkFNRSBBUyBQS0NPTFVNTl9OQU1FLCAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJ0MC5PV05FUiBBUyBGS1RBQkxFX1NDSEVN\nLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJMRV9OQU1FIEFTIEZL\nVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09MVU1O\nX05BTUUgQVMgRktDT0xVTU5fTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVu\nZCgidDAuUE9TSVRJT04gQVMgS0VZX1NFUSwgIikuCiAgICAgICAgICAgIGFw\ncGVuZChkZWxBY3Rpb24pLmFwcGVuZCgiIEFTIERFTEVURV9SVUxFLCAiKS4K\nICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT05TVFJBSU5UX05BTUUgQVMgRktf\nTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RFKHQxLkRFRkVS\nUkVELCAnREVGRVJSRUQnLCAiKS4KICAgICAgICAgICAgYXBwZW5kKG1ldGEu\naW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCkuCiAgICAgICAgICAgIGFw\ncGVuZCgiLCAnSU1NRURJQVRFJywgIikuCiAgICAgICAgICAgIGFwcGVuZCht\nZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5SW1tZWRpYXRlKS4KICAgICAgICAg\nICAgYXBwZW5kKCIpIEFTIERFRkVSUkFCSUxJVFkgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xVTU5TIHQwLCBBTExfQ09OU1RS\nQUlOVFMgdDEsICIpLgogICAgICAgICAgICBhcHBlbmQoIkFMTF9DT05TX0NP\nTFVNTlMgdDIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiV0hFUkUgdDAuT1dO\nRVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDAu\nQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RSQUlOVF9OQU1FICIpLgogICAg\nICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05TVFJBSU5UX1RZUEUgPSAnUicg\nIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJfT1dORVIgPSB0Mi5P\nV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEuUl9DT05TVFJB\nSU5UX05BTUUgPSB0Mi5DT05TVFJBSU5UX05BTUUgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgiQU5EIHQwLlBPU0lUSU9OID0gdDIuUE9TSVRJT04iKTsKICAg\nICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0gPyIpOwogICAgICAgIGlmICh0YWJs\nZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCB0\nMC5UQUJMRV9OQU1FID0gPyIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiBPUkRF\nUiBCWSB0Mi5PV05FUiwgdDIuVEFCTEVfTkFNRSwgdDAuUE9TSVRJT04iKTsK\nCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnByZXBh\ncmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAgICAgIFJlc3VsdFNl\ndCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGlk\neCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBzY2hlbWFO\nYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwogICAgICAgICAgICBpZiAodGFi\nbGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3Rt\nbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7Cgog\nICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAg\nICAgICBMaXN0IGZrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAg\nICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAg\nICAgICAgZmtMaXN0LmFkZChuZXdGb3JlaWduS2V5KHJzKSk7CiAgICAgICAg\nICAgIHJldHVybiAoRm9yZWlnbktleVtdKSBma0xpc3QudG9BcnJheQogICAg\nICAgICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ZrTGlzdC5zaXplKCldKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\ncnMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVUYWJsZVNRTChU\nYWJsZSB0YWJsZSkgewogICAgICAgIC8vIG9ubHkgb3ZlcnJpZGUgaWYgd2Ug\nYXJlIHNpbXVsYXRpbmcgYXV0by1pbmNyZW1lbmV0IHdpdGggdHJpZ2dlcnMK\nICAgICAgICBTdHJpbmdbXSBjcmVhdGUgPSBzdXBlci5nZXRDcmVhdGVUYWJs\nZVNRTCh0YWJsZSk7CiAgICAgICAgaWYgKCF1c2VUcmlnZ2Vyc0ZvckF1dG9B\nc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBjcmVhdGU7CgogICAgICAgIENv\nbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRDb2x1bW5zKCk7CiAgICAgICAgTGlz\ndCBzZXFzID0gbnVsbDsKICAgICAgICBTdHJpbmcgc2VxLCB0cmlnOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBjb2xzICE9IG51bGwgJiYgaSA8IGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFjb2xzW2ldLmlzQXV0\nb0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgaWYgKHNlcXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlcXMg\nPSBuZXcgQXJyYXlMaXN0KDQpOwoKICAgICAgICAgICAgc2VxID0gYXV0b0Fz\nc2lnblNlcXVlbmNlTmFtZTsKICAgICAgICAgICAgaWYgKHNlcSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAob3BlbmpwYTNHZW5lcmF0ZWRLZXlO\nYW1lcykKICAgICAgICAgICAgICAgICAgICBzZXEgPSBnZXRPcGVuSlBBM0dl\nbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2xzW2ldKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXEgPSBnZXRHZW5lcmF0\nZWRLZXlTZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAgICAgICAgICAgICBz\nZXFzLmFkZCgiQ1JFQVRFIFNFUVVFTkNFICIgKyBzZXEgKyAiIFNUQVJUIFdJ\nVEggMSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcGVuanBh\nM0dlbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICAgICAgdHJpZyA9IGdl\ndE9wZW5KUEEzR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUoY29sc1tpXSk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRyaWcgPSBnZXRHZW5l\ncmF0ZWRLZXlUcmlnZ2VyTmFtZShjb2xzW2ldKTsKCiAgICAgICAgICAgIC8v\nIGNyZWF0ZSB0aGUgdHJpZ2dlciB0aGF0IHdpbGwgaW5zZXJ0IG5ldyB2YWx1\nZXMgaW50bwogICAgICAgICAgICAvLyB0aGUgdGFibGUgd2hlbmV2ZXIgYSBy\nb3cgaXMgY3JlYXRlZAogICAgICAgICAgICBzZXFzLmFkZCgiQ1JFQVRFIE9S\nIFJFUExBQ0UgVFJJR0dFUiAiICsgdHJpZwogICAgICAgICAgICAgICAgKyAi\nIEJFRk9SRSBJTlNFUlQgT04gIiArIHRhYmxlLmdldE5hbWUoKQogICAgICAg\nICAgICAgICAgKyAiIEZPUiBFQUNIIFJPVyBCRUdJTiBTRUxFQ1QgIiArIHNl\ncSArICIubmV4dHZhbCBJTlRPICIKICAgICAgICAgICAgICAgICsgIjpuZXcu\nIiArIGNvbHNbaV0uZ2V0TmFtZSgpICsgIiBGUk9NIERVQUw7ICIKICAgICAg\nICAgICAgICAgICsgIkVORCAiICsgdHJpZyArICI7Iik7CiAgICAgICAgfQog\nICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBj\ncmVhdGU7CgogICAgICAgIC8vIGNvbWJpbmUgY3JlYXRlIHRhYmxlIHNxbCBh\nbmQgY3JlYXRlIHNlcWVuY2VzIHNxbAogICAgICAgIFN0cmluZ1tdIHNxbCA9\nIG5ldyBTdHJpbmdbY3JlYXRlLmxlbmd0aCArIHNlcXMuc2l6ZSgpXTsKICAg\nICAgICBTeXN0ZW0uYXJyYXljb3B5KGNyZWF0ZSwgMCwgc3FsLCAwLCBjcmVh\ndGUubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcXMu\nc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIHNxbFtjcmVhdGUubGVuZ3RoICsg\naV0gPSAoU3RyaW5nKSBzZXFzLmdldChpKTsKICAgICAgICByZXR1cm4gc3Fs\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVTZXF1ZW5j\nZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBTdHJpbmdbXSBzcWwgPSBz\ndXBlci5nZXRDcmVhdGVTZXF1ZW5jZVNRTChzZXEpOwogICAgICAgIGlmIChz\nZXEuZ2V0QWxsb2NhdGUoKSA+IDEpCiAgICAgICAgICAgIHNxbFswXSArPSAi\nIENBQ0hFICIgKyBzZXEuZ2V0QWxsb2NhdGUoKTsKICAgICAgICByZXR1cm4g\nc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2Vz\nU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1lKSB7\nCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo\nKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgU0VRVUVOQ0VfT1dORVIg\nQVMgU0VRVUVOQ0VfU0NIRU1BLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJT\nRVFVRU5DRV9OQU1FIEZST00gQUxMX1NFUVVFTkNFUyIpOwogICAgICAgIGlm\nIChzY2hlbWFOYW1lICE9IG51bGwgfHwgc2VxdWVuY2VOYW1lICE9IG51bGwp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAiKTsKICAgICAgICBp\nZiAoc2NoZW1hTmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIlNFUVVFTkNFX09XTkVSID0gPyIpOwogICAgICAgICAgICBpZiAoc2Vx\ndWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VxdWVuY2VOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX05B\nTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3RyaW5n\nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRT\nY2hlbWEpIHsKICAgICAgICBpZiAoc3VwZXIuaXNTeXN0ZW1TZXF1ZW5jZShu\nYW1lLCBzY2hlbWEsIHRhcmdldFNjaGVtYSkpCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwoKICAgICAgICAvLyBmaWx0ZXIgb3V0IGdlbmVyYXRlZCBzZXF1\nZW5jZXMgdXNlZCBmb3IgYXV0by1hc3NpZ24KICAgICAgICByZXR1cm4gKGF1\ndG9Bc3NpZ25TZXF1ZW5jZU5hbWUgIT0gbnVsbAogICAgICAgICAgICAmJiBu\nYW1lLmVxdWFsc0lnbm9yZUNhc2UoYXV0b0Fzc2lnblNlcXVlbmNlTmFtZSkp\nCiAgICAgICAgICAgIHx8IChhdXRvQXNzaWduU2VxdWVuY2VOYW1lID09IG51\nbGwKICAgICAgICAgICAgJiYgbmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dp\ndGgoIlNUXyIpKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEdlbmVy\nYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCF1c2VUcmlnZ2Vy\nc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZh\nbHVlT2YoMEwpOwoKICAgICAgICAvLyBpZiB3ZSBzaW11bGF0ZSBhdXRvLWFz\nc2lnbmVkIGNvbHVtbnMgdXNpbmcgdHJpZ2dlcnMgYW5kCiAgICAgICAgLy8g\nc2VxdWVuY2VzLCB0aGVuIHJldHVybiB0aGUgY3VycmVudCB2YWx1ZSBvZiB0\naGUgc2VxdWVuY2UKICAgICAgICAvLyBmcm9tIGF1dG9Bc3NpZ25TZXF1ZW5j\nZU5hbWUKICAgICAgICBTdHJpbmcgc2VxID0gYXV0b0Fzc2lnblNlcXVlbmNl\nTmFtZTsKICAgICAgICBpZiAoc2VxID09IG51bGwgJiYgb3BlbmpwYTNHZW5l\ncmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgc2VxID0gZ2V0T3BlbkpQQTNH\nZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAgICBlbHNlIGlm\nIChzZXEgPT0gbnVsbCkKICAgICAgICAgICAgc2VxID0gZ2V0R2VuZXJhdGVk\nS2V5U2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoIlNFTEVDVCAiICsg\nc2VxCiAgICAgICAgICAgICsgIi5jdXJydmFsIEZST00gRFVBTCIpOwogICAg\nICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAg\ncnMubmV4dCgpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9m\nKHJzLmdldExvbmcoMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMu\nY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAg\nICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJp\nZ2dlciBuYW1lIGZvciBzaW11bGF0aW5nIGF1dG8tYXNzaWduIHZhbHVlcyBv\nbiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldEdlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsK\nICAgICAgICAvLyByZXBsYWNlIHRyYWlsaW5nIF9TRVEgd2l0aCBfVFJHCiAg\nICAgICAgU3RyaW5nIHNlcU5hbWUgPSBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5j\nZU5hbWUoY29sKTsKICAgICAgICByZXR1cm4gc2VxTmFtZS5zdWJzdHJpbmco\nMCwgc2VxTmFtZS5sZW5ndGgoKSAtIDMpICsgIlRSRyI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFt\nZSBmb3IgYW4gYXV0by1hc3NpZ24gc2VxdWVuY2UuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdHJpbmcgZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlTZXF1ZW5j\nZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gY29s\nLmdldFRhYmxlKCk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlNF\nUV8iICsgdGFibGUuZ2V0TmFtZSgpLCB0YWJsZS5nZXRTY2hlbWEoKS4KICAg\nICAgICAgICAgZ2V0U2NoZW1hR3JvdXAoKSwgbWF4VGFibGVOYW1lTGVuZ3Ro\nLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEg\nT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0by1hc3NpZ24g\ndHJpZ2dlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRPcGVu\nSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsKICAg\nICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgpOwogICAgICAgIHJl\ndHVybiBtYWtlTmFtZVZhbGlkKCJUUklHXyIgKyB0YWJsZS5nZXROYW1lKCks\nIHRhYmxlLmdldFNjaGVtYSgpLgogICAgICAgICAgICBnZXRTY2hlbWFHcm91\ncCgpLCBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRCeXRlczwv\nY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVjdC4KICAgICAq\nIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBibG9iIGlzIHdyYXBwZWQg\naW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3Ig\nZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAg\nICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUg\nbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Qnl0ZXMoT2Jq\nZWN0IGJsb2IsIGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChibG9iID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICBpZiAoX3B1dEJ5dGVzID09IG51bGwpIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9wdXRCeXRlcyA9IGJs\nb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInB1dEJ5dGVzIiwKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0ZVtdLmNs\nYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1l\ndGhvZChfcHV0Qnl0ZXMsIGJsb2IsIGRhdGEpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1dFN0cmluZzwvY29kZT4g\nbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CIG9iamVjdC4KICAgICAqIFVzZXMg\ncmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQgaW4gYW5v\ndGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3IgZXhhbXBs\nZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAgICAqIGxv\nYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUgbWV0aG9k\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0U3RyaW5nKE9iamVjdCBj\nbG9iLCBTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoX3B1dFN0cmluZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0U3RyaW5nID0gY2xvYi5n\nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0U3RyaW5nIiwKICAgICAgICAgICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgU3RyaW5nLmNsYXNz\nIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1ldGhv\nZChfcHV0U3RyaW5nLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRDaGFyczwvY29kZT4gbWV0\naG9kIG9uIHRoZSBnaXZlbiBDTE9CCiAgICAgKiBvYmplY3QuIFVzZXMgcmVm\nbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQgaW4gYW5vdGhl\ncgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3IgZXhhbXBsZSBX\nZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAgICAqIGxvYnMg\naW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUgbWV0aG9kcy4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Q2hhcnMoT2JqZWN0IGNsb2Is\nIGNoYXJbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmIChfcHV0Q2hhcnMgPT0gbnVsbCkgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgX3B1dENoYXJzID0gY2xvYi5nZXRDbGFz\ncygpLmdldE1ldGhvZCgicHV0Q2hhcnMiLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBjaGFyW10uY2xhc3MgfSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9wdXRD\naGFycywgY2xvYiwgZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZv\na2UgdGhlIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRhcmdldCB3\naXRoIHRoZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyB2b2lkIGludm9rZVB1dExvYk1ldGhvZChNZXRob2QgbWV0aG9kLCBPYmpl\nY3QgdGFyZ2V0LAogICAgICAgIE9iamVjdCBkYXRhKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1l\ndGhvZC5pbnZva2UodGFyZ2V0LCBuZXcgT2JqZWN0W117IE51bWJlcnMudmFs\ndWVPZigxTCksIGRhdGEgfSk7CiAgICAgICAgfSBjYXRjaCAoSW52b2NhdGlv\nblRhcmdldEV4Y2VwdGlvbiBpdGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxl\nIHQgPSBpdGUuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIGlm\nICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAgICAg\ndGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24odCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIENsb2IgZ2V0RW1wdHlD\nbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoRU1QVFlfQ0xPQiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gRU1Q\nVFlfQ0xPQjsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gRU1Q\nVFlfQ0xPQiA9IChDbG9iKSBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuc3FsLkNM\nT0IiLCB0cnVlLAogICAgICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb250ZXh0Q2xhc3NM\nb2FkZXJBY3Rpb24oKSkpCiAgICAgICAgICAgICAgICAuZ2V0TWV0aG9kKCJl\nbXB0eV9sb2IiLCBuZXcgQ2xhc3NbMF0pLgogICAgICAgICAgICAgICAgaW52\nb2tlKG51bGwsIG5ldyBPYmplY3RbMF0pOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRp\nb24oZS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2\nYXRlIEJsb2IgZ2V0RW1wdHlCbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoRU1QVFlfQkxPQiAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gRU1QVFlfQkxPQjsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gRU1QVFlfQkxPQiA9IChCbG9iKSBDbGFzcy5mb3JO\nYW1lKCJvcmFjbGUuc3FsLkJMT0IiLCB0cnVlLAogICAgICAgICAgICAgICAg\nICAgIChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5nZXRDb250ZXh0Q2xhc3NMb2FkZXJBY3Rpb24oKSkpLgogICAgICAgICAg\nICAgICAgZ2V0TWV0aG9kKCJlbXB0eV9sb2IiLCBuZXcgQ2xhc3NbMF0pLgog\nICAgICAgICAgICAgICAgaW52b2tlKG51bGwsIG5ldyBPYmplY3RbMF0pOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBTUUxFeGNlcHRpb24oZS5nZXRNZXNzYWdlKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzT3JhY2xl\nUHJlcGFyZWRTdGF0ZW1lbnQoU3RhdGVtZW50IHN0bW50KSB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgcmV0dXJuIENsYXNzLmZvck5hbWUoIm9yYWNs\nZS5qZGJjLk9yYWNsZVByZXBhcmVkU3RhdGVtZW50IikuCiAgICAgICAgICAg\nICAgICBpc0luc3RhbmNlKHN0bW50KTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQogICAgfQogICAgCiAgICAvKioKICAgICAqIElmIHRoaXMgZGljdGlvbmFy\neSBzdXBwb3J0cyBYTUwgdHlwZSwKICAgICAqIHVzZSB0aGlzIG1ldGhvZCB0\nbyBhcHBlbmQgeG1sIHByZWRpY2F0ZS4KICAgICAqIAogICAgICogQHBhcmFt\nIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNvbgog\nICAgICogQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0byBw\nZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lkZSBv\nZiB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIHJocyB0aGUgcmlnaHQg\naGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24oU1FMQnVmZmVyIGJ1ZiwgU3Ry\naW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVyVmFsdWUg\ncmhzLCBib29sZWFuIGxoc3htbCwgYm9vbGVhbiByaHN4bWwpIHsKICAgICAg\nICBzdXBlci5hcHBlbmRYbWxDb21wYXJpc29uKGJ1Ziwgb3AsIGxocywgcmhz\nLCBsaHN4bWwsIHJoc3htbCk7CiAgICAgICAgaWYgKGxoc3htbCAmJiByaHN4\nbWwpCiAgICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24yKGJ1Ziwgb3As\nIGxocywgcmhzKTsKICAgICAgICBlbHNlIGlmIChsaHN4bWwpCiAgICAgICAg\nICAgIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3AsIGxocywgcmhzKTsK\nICAgICAgICBlbHNlIAogICAgICAgICAgICBhcHBlbmRYbWxDb21wYXJpc29u\nMShidWYsIG9wLCByaHMsIGxocyk7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogQXBwZW5kIGFuIHhtbCBjb21wYXJpc29uIHByZWRpY2F0ZQogICAgICoK\nICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhl\nIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBv\ncGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVm\ndCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8geG1sIGNv\nbHVtbikKICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBv\nZiB0aGUgY29tcGFyaXNvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXBw\nZW5kWG1sQ29tcGFyaXNvbjEoU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLAog\nICAgICAgIEZpbHRlclZhbHVlIGxocywgRmlsdGVyVmFsdWUgcmhzKSB7CiAg\nICAgICAgYXBwZW5kWG1sRXh0cmFjdFZhbHVlKGJ1ZiwgbGhzKTsKICAgICAg\nICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAiKTsKICAg\nICAgICByaHMuYXBwZW5kVG8oYnVmKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBBcHBlbmQgYW4geG1sIGNvbXBhcmlzb24gcHJlZGljYXRlIChib3Ro\nIG9wZXJhbmRzIG1hcCB0byB4bWwgY29sdW1uKQogICAgICoKICAgICAqIEBw\nYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlz\nb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24g\ndG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNp\nZGUgb2YgdGhlIGNvbXBhcmlzb24gKG1hcHMgdG8geG1sIGNvbHVtbikKICAg\nICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgY29t\ncGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNvbjIoU1FMQnVmZmVyIGJ1Ziwg\nU3RyaW5nIG9wLCAKICAgICAgICBGaWx0ZXJWYWx1ZSBsaHMsIEZpbHRlclZh\nbHVlIHJocykgewogICAgICAgIGFwcGVuZFhtbEV4dHJhY3RWYWx1ZShidWYs\nIGxocyk7CiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBw\nZW5kKCIgIik7CiAgICAgICAgYXBwZW5kWG1sRXh0cmFjdFZhbHVlKGJ1Ziwg\ncmhzKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGFwcGVuZFhtbEV4\ndHJhY3RWYWx1ZShTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSB2YWwpIHsK\nICAgICAgICBidWYuYXBwZW5kKCJleHRyYWN0VmFsdWUoIikuCiAgICAgICAg\nICAgIGFwcGVuZCh2YWwuZ2V0Q29sdW1uQWxpYXMoCiAgICAgICAgICAgIHZh\nbC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRDb2x1bW5zKClbMF0pKS4KICAgICAg\nICAgICAgYXBwZW5kKCIsJy8qLyIpOwogICAgICAgIHZhbC5hcHBlbmRUbyhi\ndWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIicpIik7CiAgICB9Cn0K\n","encoding":"base64"}

