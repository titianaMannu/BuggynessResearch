{"sha":"e745c4b8c3e8c5412f91486af4f59a0c158cc456","node_id":"MDQ6QmxvYjIwNjM2NDplNzQ1YzRiOGMzZThjNTQxMmY5MTQ4NmFmNGY1OWEwYzE1OGNjNDU2","size":97383,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e745c4b8c3e8c5412f91486af4f59a0c158cc456","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyB0byBjYWNoZSB0YWJsZSBh\nbGlhcyB1c2luZyBUYWJsZSBhcyB0aGUga2V5CiAgICBwcml2YXRlIE1hcCBf\ndGFibGVBbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CiAgICAgCiAgICAvKioK\nICAgICAqIEhlbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgdGFi\nbGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBhbGlhcyBpbmRleC4KICAgICAqLwog\nICAgc3RhdGljIFN0cmluZyB0b0FsaWFzKGludCBpbmRleCkgewogICAgICAg\nIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgaWYgKGluZGV4IDwgVEFCTEVfQUxJQVNFUy5sZW5ndGgpCiAgICAg\nICAgICAgIHJldHVybiBUQUJMRV9BTElBU0VTW2luZGV4XTsKICAgICAgICBy\nZXR1cm4gInQiICsgaW5kZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHJldHVybiB0aGUgcHJvcGVyIG9yZGVyIGFsaWFzIGZv\nciB0aGUgZ2l2ZW4gb3JkZXIKICAgICAqIGNvbHVtbiBpbmRleC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgdG9PcmRlckFsaWFzKGludCBp\nbmRleCkgewogICAgICAgIGlmIChpbmRleCA9PSAtMSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGluZGV4IDwgT1JERVJfQUxJQVNF\nUy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBPUkRFUl9BTElBU0VTW2lu\nZGV4XTsKICAgICAgICByZXR1cm4gIm8iICsgaW5kZXg7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24u\nCiAgICAgKi8KICAgIHB1YmxpYyBTZWxlY3RJbXBsKEpEQkNDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2Rp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAg\nIF9qb2luU3ludGF4ID0gX2RpY3Quam9pblN5bnRheDsKICAgICAgICBfc2Vs\nZWN0cy5fZGljdCA9IF9kaWN0OwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0RXhlY3V0b3IgaW1w\nbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyBKREJDQ29uZmlndXJhdGlvbiBnZXRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBw\ndWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KGJvb2xlYW4gZm9yVXBkYXRlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0LnRvU2VsZWN0KHRoaXMsIGZvclVwZGF0ZSwgZmV0Y2gpOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3RDb3VudCgpIHsKICAg\nICAgICByZXR1cm4gX2RpY3QudG9TZWxlY3RDb3VudCh0aGlzKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBdXRvRGlzdGluY3QoKSB7CiAgICAg\nICAgcmV0dXJuIChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNUKSA9PSAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EaXN0aW5jdChib29sZWFu\nIHZhbCkgewogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9mbGFncyAm\nPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIF9mbGFncyB8PSBOT05BVVRPX0RJU1RJTkNUOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzRGlzdGluY3QoKSB7CiAgICAgICAgcmV0dXJuIChfZmxh\nZ3MgJiBOT1RfRElTVElOQ1QpID09IDAgJiYgKChfZmxhZ3MgJiBESVNUSU5D\nVCkgIT0gMAogICAgICAgICAgICB8fCAoKF9mbGFncyAmIE5PTkFVVE9fRElT\nVElOQ1QpID09IDAKICAgICAgICAgICAgJiYgKF9mbGFncyAmIElNUExJQ0lU\nX0RJU1RJTkNUKSAhPSAwKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nRGlzdGluY3QoYm9vbGVhbiBkaXN0aW5jdCkgewogICAgICAgIC8vIG5lZWQg\ndHdvIGZsYWdzIGluIGNhc2Ugc2V0IG5vdF9kaXN0aW5jdCwgdGhlbiBhIHRv\nLW1hbnkgam9pbiBoYXBwZW5zCiAgICAgICAgLy8gYW5kIGRpc3RpbmN0IGZs\nYWcgZ2V0cyBzZXQgYXV0b21hdGljYWxseQogICAgICAgIGlmIChkaXN0aW5j\ndCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+Tk9UX0RJU1RJTkNUOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIF9mbGFncyB8PSBOT1RfRElTVElOQ1Q7CiAgICAgICAg\nICAgIF9mbGFncyAmPSB+RElTVElOQ1Q7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzTFJTKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgTFJTKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExS\nUyhib29sZWFuIGxycykgewogICAgICAgIGlmIChscnMpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBMUlM7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkxSUzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEV4cGVjdGVk\nUmVzdWx0Q291bnQoKSB7CiAgICAgICAgLy8gaWYgdGhlIGNvdW50IGlzbid0\nIGZvcmNlZCBhbmQgd2UgaGF2ZSB0by1tYW55IGVhZ2VyIGpvaW5zIHRoYXQg\nY291bGQKICAgICAgICAvLyB0aHJvdyB0aGUgY291bnQgb2ZmLCBkb24ndCBw\nYXkgYXR0ZW50aW9uIHRvIGl0CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGT1JD\nRV9DT1VOVCkgPT0gMCAmJiBoYXNFYWdlckpvaW4odHJ1ZSkpCiAgICAgICAg\nICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBfZXhwZWN0ZWRSZXN1bHRD\nb3VudDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFeHBlY3RlZFJlc3Vs\ndENvdW50KGludCBleHBlY3RlZFJlc3VsdENvdW50LCBib29sZWFuIGZvcmNl\nKSB7CiAgICAgICAgX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBleHBlY3RlZFJl\nc3VsdENvdW50OwogICAgICAgIGlmIChmb3JjZSkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZPUkNFX0NPVU5UOwogICAgICAgIGVsc2UgCiAgICAgICAgICAg\nIF9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICB9CgogICAgcHVibGljIGlu\ndCBnZXRKb2luU3ludGF4KCkgewogICAgICAgIHJldHVybiBfam9pblN5bnRh\neDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luU3ludGF4KGludCBq\nb2luU3ludGF4KSB7CiAgICAgICAgX2pvaW5TeW50YXggPSBqb2luU3ludGF4\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFuZG9tQWNj\nZXNzKGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0\nLnN1cHBvcnRzUmFuZG9tQWNjZXNzUmVzdWx0U2V0KHRoaXMsIGZvclVwZGF0\nZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nKCkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBwb3J0c0xvY2tpbmcodGhp\ncyk7CiAgICB9CgogICAgcHVibGljIGludCBnZXRDb3VudChKREJDU3RvcmUg\nc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0g\ndG9TZWxlY3RDb3VudCgpOwogICAgICAgICAgICBjb25uID0gc3RvcmUuZ2V0\nQ29ubmVjdGlvbigpOwogICAgICAgICAgICBzdG1udCA9IHNxbC5wcmVwYXJl\nU3RhdGVtZW50KGNvbm4pOwogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1\ndGVRdWVyeSgpOwogICAgICAgICAgICBycy5uZXh0KCk7CiAgICAgICAgICAg\nIHJldHVybiBycy5nZXRJbnQoMSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgaWYgKHJzICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkg\neyBycy5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAg\nICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7fQogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgY29ubi5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQg\nZXhlY3V0ZShKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNoID0gc3Rv\ncmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIGV4\nZWN1dGUoc3RvcmUuZ2V0Q29udGV4dCgpLCBzdG9yZSwgZmV0Y2gsCiAgICAg\nICAgICAgIGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSk7CiAgICB9CgogICAg\ncHVibGljIFJlc3VsdCBleGVjdXRlKEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgbG9ja0xldmVs\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLCBsb2NrTGV2ZWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGlzIHNlbGVjdCBpbiB0\naGUgY29udGV4dCBvZiB0aGUgZ2l2ZW4gc3RvcmUgbWFuYWdlci4gVGhlCiAg\nICAgKiBjb250ZXh0IGlzIHBhc3NlZCBpbiBzZXBhcmF0ZWx5IGZvciBwcm9m\naWxpbmcgcHVycG9zZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBSZXN1bHQg\nZXhlY3V0ZShTdG9yZUNvbnRleHQgY3R4LCBKREJDU3RvcmUgc3RvcmUsIAog\nICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2Nr\nTGV2ZWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nYm9vbGVhbiBmb3JVcGRhdGUgPSBmYWxzZTsKICAgICAgICBpZiAoIWlzQWdn\ncmVnYXRlKCkgJiYgX2dyb3VwaW5nID09IG51bGwpIHsKICAgICAgICAgICAg\nSkRCQ0xvY2tNYW5hZ2VyIGxtID0gc3RvcmUuZ2V0TG9ja01hbmFnZXIoKTsK\nICAgICAgICAgICAgaWYgKGxtICE9IG51bGwpCiAgICAgICAgICAgICAgICBm\nb3JVcGRhdGUgPSBsbS5zZWxlY3RGb3JVcGRhdGUodGhpcywgbG9ja0xldmVs\nKTsKICAgICAgICB9CgogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSB0b1NlbGVj\ndChmb3JVcGRhdGUsIGZldGNoKTsKICAgICAgICBpbnQgcnNUeXBlID0gKGlz\nTFJTKCkgJiYgc3VwcG9ydHNSYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAg\nICAgICAgICAgPyAtMSA6IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsK\nICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9u\nKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwog\nICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKGlzTFJTKCkpCiAgICAgICAgICAgICAgICBzdG1udCA9\nIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCByc1R5cGUsIC0x\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RtbnQgPSBz\ncWwucHJlcGFyZVN0YXRlbWVudChjb25uLCByc1R5cGUsIC0xKTsKCiAgICAg\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhl\nIGxvY2sgdGltZW91dCBpcyBncmVhdGVyIHRoYW4KICAgICAgICAgICAgLy8g\ndGhlIGNvbmZpZ3VyZWQgcXVlcnkgdGltZW91dCwgdXNlIHRoZSBsb2NrIHRp\nbWVvdXQKICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiBfZGljdC5zdXBw\nb3J0c1F1ZXJ5VGltZW91dCAmJiBmZXRjaCAhPSBudWxsIAogICAgICAgICAg\nICAgICAgJiYgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSA+IHN0bW50LmdldFF1\nZXJ5VGltZW91dCgpICogMTAwMCkgewogICAgICAgICAgICAgICAgTG9nIGxv\nZyA9IF9jb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRCQyk7\nCiAgICAgICAgICAgICAgICBpbnQgdGltZW91dCA9IGZldGNoLmdldExvY2tU\naW1lb3V0KCk7CiAgICAgICAgICAgICAgICBpZiAodGltZW91dCA8IDEwMDAp\nIHsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gMTAwMDsgCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJtaWxsaXMt\ncXVlcnktdGltZW91dCIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIHRyeSB7IAogICAgICAgICAgICAgICAgICAgIHN0bW50LnNldFF1\nZXJ5VGltZW91dChmZXRjaC5nZXRMb2NrVGltZW91dCgpIC8gMTAwMCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaChTUUxFeGNl\ncHRpb24gZSkgeyAKICAgICAgICAgICAgICAgICAgICBpZihfZGljdC5pZ25v\ncmVTUUxFeGNlcHRpb25PblNldFF1ZXJ5VGltZW91dCkgeyAKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQo\nImVycm9yLXNldHRpbmctcXVlcnktdGltZW91dCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IEludGVnZXIodGltZW91dCksIGUuZ2V0\nTWVzc2FnZSgpKSwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxz\nZSB7IAogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAv\nLyBjbGVhbiB1cCBzdGF0ZW1lbnQKICAgICAgICAgICAgaWYgKHN0bW50ICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UyKSB7fQogICAgICAgICAgICB0cnkg\neyBjb25uLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9\nCiAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgIH0KCiAgICAgICAgU2Vs\nZWN0UmVzdWx0IHJlcyA9IG5ldyBTZWxlY3RSZXN1bHQoY29ubiwgc3RtbnQs\nIHJzLCBfZGljdCk7CiAgICAgICAgcmVzLnNldFNlbGVjdCh0aGlzKTsKICAg\nICAgICByZXMuc2V0U3RvcmUoc3RvcmUpOwogICAgICAgIHJlcy5zZXRMb2Nr\naW5nKGZvclVwZGF0ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYWRk\nRWFnZXJSZXN1bHRzKHJlcywgdGhpcywgc3RvcmUsIGZldGNoKTsKICAgICAg\nICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgcmVz\nLmNsb3NlKCk7CiAgICAgICAgICAgIHRocm93IHNlOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0\nZSBvdXIgZWFnZXIgc2VsZWN0cywgYWRkaW5nIHRoZSByZXN1bHRzIHVuZGVy\nIHRoZSBzYW1lIGtleXMKICAgICAqIHRvIHRoZSBnaXZlbiByZXN1bHQuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYWRkRWFnZXJSZXN1bHRz\nKFNlbGVjdFJlc3VsdCByZXMsIFNlbGVjdEltcGwgc2VsLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vs\nLl9lYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIGV4ZWN1dGUgZWFnZXIgc2VsZWN0cwogICAgICAgIE1hcC5FbnRyeSBl\nbnRyeTsKICAgICAgICBSZXN1bHQgZXJlczsKICAgICAgICBNYXAgZWFnZXI7\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBzZWwuX2VhZ2VyLmVudHJ5\nU2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOwoKICAgICAgICAg\nICAgLy8gc2ltdWxhdGVkIGJhdGNoZWQgc2VsZWN0cyBmb3IgaW5uZXIvb3V0\nZXIgam9pbnM7IGZvciBzZXBhcmF0ZQogICAgICAgICAgICAvLyBzZWxlY3Rz\nLCBkb24ndCBwYXNzIG9uIGxvY2sgbGV2ZWwsIGJlY2F1c2UgdGhleSdyZSBw\ncm9iYWJseQogICAgICAgICAgICAvLyBmb3IgcmVsYXRpb25zIGFuZCB0aGVy\nZWZvcmUgc2hvdWxkIHVzZSBkZWZhdWx0IGxldmVsCiAgICAgICAgICAgIGlm\nIChlbnRyeS5nZXRWYWx1ZSgpID09IHNlbCkKICAgICAgICAgICAgICAgIGVy\nZXMgPSByZXM7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGVy\nZXMgPSAoKFNlbGVjdEV4ZWN1dG9yKSBlbnRyeS5nZXRWYWx1ZSgpKS5leGVj\ndXRlKHN0b3JlLAogICAgICAgICAgICAgICAgICAgIGZldGNoKTsKCiAgICAg\nICAgICAgIGVhZ2VyID0gcmVzLmdldEVhZ2VyTWFwKGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKGVhZ2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGVh\nZ2VyID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHJlcy5zZXRF\nYWdlck1hcChlYWdlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWFn\nZXIucHV0KGVudHJ5LmdldEtleSgpLCBlcmVzKTsKICAgICAgICB9CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU2VsZWN0\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCgogICAgcHVibGljIGludCBpbmRleE9mKCkgewogICAgICAgIHJldHVybiAw\nOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFN1YnNlbGVjdHMoKSB7CiAg\nICAgICAgcmV0dXJuIChfc3Vic2VscyA9PSBudWxsKSA/IENvbGxlY3Rpb25z\nLkVNUFRZX0xJU1QgOiBfc3Vic2VsczsKICAgIH0KCiAgICBwdWJsaWMgU2Vs\nZWN0IGdldFBhcmVudCgpIHsKICAgICAgICByZXR1cm4gX3BhcmVudDsKICAg\nIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFN1YnNlbGVjdFBhdGgoKSB7CiAg\nICAgICAgcmV0dXJuIF9zdWJQYXRoOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFBhcmVudChTZWxlY3QgcGFyZW50LCBTdHJpbmcgcGF0aCkgewogICAg\nICAgIGlmIChwYXRoICE9IG51bGwpCiAgICAgICAgICAgIF9zdWJQYXRoID0g\ncGF0aCArICc6JzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zdWJQYXRo\nID0gbnVsbDsKCiAgICAgICAgaWYgKHBhcmVudCA9PSBfcGFyZW50KQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkK\nICAgICAgICAgICAgX3BhcmVudC5fc3Vic2Vscy5yZW1vdmUodGhpcyk7Cgog\nICAgICAgIC8vIyMjIHJpZ2h0IG5vdyB3ZSBjYW4ndCB1c2Ugc3FsOTIgam9p\nbnMgd2l0aCBzdWJzZWxlY3RzLCBjYXVzZQogICAgICAgIC8vIyMjIEkgY2Fu\nJ3QgZmlndXJlIG91dCB3aGF0IHRvIGRvIHdoZW4gdGhlIHN1YnNlbGVjdCBo\nYXMgYSBqb2luCiAgICAgICAgLy8jIyMgd2l0aCBhbiBhbGlhcyBhbHNvIHBy\nZXNlbnQgaW4gdGhlIG91dGVyIHNlbGVjdC4uLiB5b3UgZG9uJ3Qgd2FudAog\nICAgICAgIC8vIyMjIHRoZSBqb2luIHRvIGFwcGVhciBpbiB0aGUgRlJPTSBj\nbGF1c2Ugb2YgdGhlIHN1YnNlbGVjdCBjYXVzZQogICAgICAgIC8vIyMjIHRo\nZW4gaXQgcmUtYWxpYXNlcyBib3RoIHRhYmxlcyBpbiB0aGUgc2NvcGUgb2Yg\ndGhlIHN1YnNlbGVjdAogICAgICAgIC8vIyMjIGFuZCB0aGUgY29ycmVsYXRp\nb24gd2l0aCB0aGUgb3V0ZXIgc2VsZWN0IGlzIGxvc3QKICAgICAgICBfcGFy\nZW50ID0gKFNlbGVjdEltcGwpIHBhcmVudDsKICAgICAgICBpZiAoX3BhcmVu\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfcGFyZW50Ll9zdWJzZWxz\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzID0g\nbmV3IEFycmF5TGlzdCgyKTsKICAgICAgICAgICAgX3BhcmVudC5fc3Vic2Vs\ncy5hZGQodGhpcyk7CiAgICAgICAgICAgIGlmIChfcGFyZW50Ll9qb2luU3lu\ndGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfU1FMOTIpCiAgICAgICAgICAg\nICAgICBfam9pblN5bnRheCA9IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElU\nSU9OQUw7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9qb2lu\nU3ludGF4ID0gX3BhcmVudC5fam9pblN5bnRheDsKICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgaWYgKF9wYXJlbnQuZ2V0QWxpYXNlcygpID09IG51bGwg\nfHwgX3N1YlBhdGggPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChfcGFyZW50Ll9hbGlhc2Vz\nLnNpemUoKSA8PSAxKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIERvIG5vdCByZW1vdmUgYWxpYXNlcyBmb3IgZGF0YWJh\nc2VzIHRoYXQgdXNlIFNZTlRBWF9EQVRBQkFTRSAob3JhY2xlKQogICAgICAg\nIGlmKF9wYXJlbnQuX2pvaW5TeW50YXggIT0gSm9pblN5bnRheGVzLlNZTlRB\nWF9EQVRBQkFTRSkgewogICAgICAgICAgICAvLyByZXNvbHZlIGFsaWFzZXMg\nZm9yIHN1YnNlbGVjdCBmcm9tIHBhcmVudAogICAgICAgICAgICBTZXQgZW50\ncmllcyA9IF9wYXJlbnQuZ2V0QWxpYXNlcygpLmVudHJ5U2V0KCk7CiAgICAg\nICAgICAgIEl0ZXJhdG9yIGl0ID0gZW50cmllcy5pdGVyYXRvcigpOwogICAg\nICAgICAgICB3aGlsZSAoaXQuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAg\nICBNYXAuRW50cnkgZW50cnkgPSAoTWFwLkVudHJ5KSBpdC5uZXh0KCk7CiAg\nICAgICAgICAgICAgICBPYmplY3Qga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAg\nICAgICAgICAgICAgICBJbnRlZ2VyIGFsaWFzID0gKEludGVnZXIpIGVudHJ5\nLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAoa2V5LnRvU3RyaW5n\nKCkuaW5kZXhPZihfc3ViUGF0aCkgIT0gLTEgfHwKICAgICAgICAgICAgICAg\nICAgICAgICAgX3BhcmVudC5maW5kVGFibGVBbGlhcyhhbGlhcykgPT0gZmFs\nc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFz\naE1hcCgpOwogICAgICAgICAgICAgICAgICAgIF9hbGlhc2VzLnB1dChrZXks\nIGFsaWFzKTsKCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IHRhYmxlU3Ry\naW5nID0gX3BhcmVudC5nZXRUYWJsZXMoKS5nZXQoYWxpYXMpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChfdGFibGVzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgIF90YWJsZXMgPSBuZXcgVHJlZU1hcCgpOwogICAgICAg\nICAgICAgICAgICAgIF90YWJsZXMucHV0KGFsaWFzLCB0YWJsZVN0cmluZyk7\nCgogICAgICAgICAgICAgICAgICAgIF9yZW1vdmVkQWxpYXNGcm9tUGFyZW50\nLnNldChhbGlhcy5pbnRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF9hbGlhc2VzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIC8vIGFsaWFzZXMgbW92ZWQgaW50byBzdWJz\nZWxlY3Qgc2hvdWxkIGJlIHJlbW92ZWQgZnJvbSBwYXJlbnQKICAgICAgICAg\nICAgICAgIGVudHJpZXMgPSBfYWxpYXNlcy5lbnRyeVNldCgpOwogICAgICAg\nICAgICAgICAgaXQgPSBlbnRyaWVzLml0ZXJhdG9yKCk7CiAgICAgICAgICAg\nICAgICB3aGlsZSAoaXQuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgTWFwLkVudHJ5IGVudHJ5ID0gKE1hcC5FbnRyeSkgaXQubmV4dCgpOwog\nICAgICAgICAgICAgICAgICAgIE9iamVjdCBrZXkgPSBlbnRyeS5nZXRLZXko\nKTsKICAgICAgICAgICAgICAgICAgICBJbnRlZ2VyIGFsaWFzID0gKEludGVn\nZXIpIGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGtleS50b1N0cmluZygpLmluZGV4T2YoX3N1YlBhdGgpICE9IC0xIHx8CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBfcGFyZW50LmZpbmRUYWJsZUFs\naWFzKGFsaWFzKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBfcGFyZW50LnJlbW92ZUFsaWFzKGtleSk7CgogICAgICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgdGFibGVTdHJpbmcgPSBfcGFyZW50LmdldFRhYmxl\ncygpLmdldChhbGlhcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9wYXJl\nbnQucmVtb3ZlVGFibGUoYWxpYXMpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFuIGZpbmRUYWJsZUFsaWFzKElu\ndGVnZXIgYWxpYXMpIHsKICAgICAgICAvLyBpZiBhbGlhcyBpcyBkZWZpbmVk\nIGFuZCByZWZlcmVuY2VkLCByZXR1cm4gdHJ1ZS4KICAgICAgICBTdHJpbmcg\ndmFsdWUgPSAidCIgKyBhbGlhcy50b1N0cmluZygpICsgIi4iOwogICAgICAg\nIGlmIChfdGFibGVBbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgIGlmIChf\ndGFibGVBbGlhc2VzLmNvbnRhaW5zVmFsdWUodmFsdWUpKQogICAgICAgICAg\nICAgICByZXR1cm4gX3RhYmxlcy5jb250YWluc0tleShhbGlhcyk7CiAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICByZXR1cm4gX2pvaW5zICE9IG51\nbGw7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KICAgIAogICAgcHVibGljIE1hcCBnZXRBbGlhc2VzKCkgewogICAgICAg\nIHJldHVybiBfYWxpYXNlczsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQg\ncmVtb3ZlQWxpYXMoT2JqZWN0IGtleSkgewogICAgICAgIF9hbGlhc2VzLnJl\nbW92ZShrZXkpOwogICAgfQogICAgCiAgICBwdWJsaWMgTWFwIGdldFRhYmxl\ncygpIHsKICAgICAgICByZXR1cm4gX3RhYmxlczsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgcmVtb3ZlVGFibGUoT2JqZWN0IGtleSkgewogICAgICAg\nIF90YWJsZXMucmVtb3ZlKGtleSk7CiAgICB9CgogICAgcHVibGljIFNlbGVj\ndCBnZXRGcm9tU2VsZWN0KCkgewogICAgICAgIHJldHVybiBfZnJvbTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWwp\nIHsKICAgICAgICBfZnJvbSA9IChTZWxlY3RJbXBsKSBzZWw7CiAgICAgICAg\naWYgKF9mcm9tICE9IG51bGwpCiAgICAgICAgICAgIF9mcm9tLl9vdXRlciA9\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzRWFnZXJKb2lu\nKGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgaWYgKHRvTWFueSkKICAgICAg\nICAgICAgcmV0dXJuIChfZmxhZ3MgJiBFQUdFUl9UT19NQU5ZKSAhPSAwOwog\nICAgICAgIHJldHVybiAoX2ZsYWdzICYgRUFHRVJfVE9fT05FKSAhPSAwOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0pvaW4oYm9vbGVhbiB0b01h\nbnkpIHsKICAgICAgICBpZiAodG9NYW55KQogICAgICAgICAgICByZXR1cm4g\nKF9mbGFncyAmIFRPX01BTlkpICE9IDA7CiAgICAgICAgcmV0dXJuIF90YWJs\nZXMgIT0gbnVsbCAmJiBfdGFibGVzLnNpemUoKSA+IDE7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNTZWxlY3RlZChUYWJsZSB0YWJsZSkgewogICAg\nICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKG51bGwsIGZhbHNlKTsKICAg\nICAgICBpZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9m\ncm9tLmdldFRhYmxlSW5kZXgodGFibGUsIHBqLCBmYWxzZSkgIT0gLTE7CiAg\nICAgICAgcmV0dXJuIGdldFRhYmxlSW5kZXgodGFibGUsIHBqLCBmYWxzZSkg\nIT0gLTE7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VGFibGVB\nbGlhc2VzKCkgewogICAgICAgIHJldHVybiAoX3RhYmxlcyA9PSBudWxsKSA/\nIENvbGxlY3Rpb25zLkVNUFRZX1NFVCA6IF90YWJsZXMudmFsdWVzKCk7CiAg\nICB9CgogICAgcHVibGljIExpc3QgZ2V0U2VsZWN0QWxpYXNlcygpIHsKICAg\nICAgICByZXR1cm4gX3NlbGVjdHMuZ2V0QWxpYXNlcyhmYWxzZSwgX291dGVy\nICE9IG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldElkZW50aWZp\nZXJBbGlhc2VzKCkgewogICAgICAgIHJldHVybiBfc2VsZWN0cy5nZXRBbGlh\nc2VzKHRydWUsIF9vdXRlciAhPSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\nU1FMQnVmZmVyIGdldE9yZGVyaW5nKCkgewogICAgICAgIHJldHVybiBfb3Jk\nZXJpbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRHcm91cGlu\nZygpIHsKICAgICAgICByZXR1cm4gX2dyb3VwaW5nOwogICAgfQoKICAgIHB1\nYmxpYyBTUUxCdWZmZXIgZ2V0V2hlcmUoKSB7CiAgICAgICAgcmV0dXJuIF93\naGVyZTsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldEhhdmluZygp\nIHsKICAgICAgICByZXR1cm4gX2hhdmluZzsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBhZGRKb2luQ2xhc3NDb25kaXRpb25zKCkgewogICAgICAgIGlmIChf\nam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuam9pbnMoKSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGpvaW4gc2V0IGl0ZXJhdG9y\nIGFsbG93cyBjb25jdXJyZW50IG1vZGlmaWNhdGlvbgogICAgICAgIEpvaW4g\najsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9qb2lucy5qb2lucygp\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGog\nPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGouZ2V0UmVs\nYXRpb25UYXJnZXQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBqLmdl\ndFJlbGF0aW9uVGFyZ2V0KCkuZ2V0RGlzY3JpbWluYXRvcigpLmFkZENsYXNz\nQ29uZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICh0aGlzLCBqLmdldFN1\nYmNsYXNzZXMoKSA9PSBTVUJTX0pPSU5BQkxFLCAKICAgICAgICAgICAgICAg\nICAgICBqLmdldFJlbGF0aW9uSm9pbnMoKSk7CiAgICAgICAgICAgICAgICBq\nLnNldFJlbGF0aW9uKG51bGwsIDAsIG51bGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBKb2lucyBnZXRKb2lucygpIHsK\nICAgICAgICByZXR1cm4gX2pvaW5zOwogICAgfQoKICAgIHB1YmxpYyBJdGVy\nYXRvciBnZXRKb2luSXRlcmF0b3IoKSB7CiAgICAgICAgaWYgKF9qb2lucyA9\nPSBudWxsIHx8IF9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVy\nbiBFbXB0eUl0ZXJhdG9yLklOU1RBTkNFOwogICAgICAgIHJldHVybiBfam9p\nbnMuam9pbnMoKS5qb2luSXRlcmF0b3IoKTsKICAgIH0KCiAgICBwdWJsaWMg\nbG9uZyBnZXRTdGFydEluZGV4KCkgewogICAgICAgIHJldHVybiBfc3RhcnRJ\nZHg7CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0RW5kSW5kZXgoKSB7CiAg\nICAgICAgcmV0dXJuIF9lbmRJZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0UmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBfc3Rh\ncnRJZHggPSBzdGFydDsKICAgICAgICBfZW5kSWR4ID0gZW5kOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCkg\newogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIChKb2lucykg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlh\ncyhDb2x1bW4gY29sLCBKb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBn\nZXRDb2x1bW5BbGlhcyhjb2wsIGdldEpvaW5zKGpvaW5zLCBmYWxzZSkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhl\nIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0\nQ29sdW1uQWxpYXMoQ29sdW1uIGNvbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAg\nICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbC5nZXROYW1lKCksIGNvbC5n\nZXRUYWJsZSgpLCBwaik7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRD\nb2x1bW5BbGlhcyhTdHJpbmcgY29sLCBUYWJsZSB0YWJsZSkgewogICAgICAg\nIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIHRhYmxlLCAoSm9pbnMpIG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMo\nU3RyaW5nIGNvbCwgVGFibGUgdGFibGUsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgcmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbCwgdGFibGUsIGdldEpvaW5z\nKGpvaW5zLCBmYWxzZSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqLwogICAg\ncHJpdmF0ZSBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFi\nbGUgdGFibGUsIFBhdGhKb2lucyBwaikgewogICAgICAgIFN0cmluZyB0YWJs\nZUFsaWFzID0gbnVsbDsKICAgICAgICBpZiAocGogPT0gbnVsbCB8fCBwai5w\nYXRoKCkgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX3RhYmxlQWxpYXNl\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3RhYmxlQWxpYXNlcyA9IG5l\ndyBIYXNoTWFwKCk7CiAgICAgICAgICAgIHRhYmxlQWxpYXMgPSAoU3RyaW5n\nKSBfdGFibGVBbGlhc2VzLmdldCh0YWJsZSk7CiAgICAgICAgICAgIGlmICh0\nYWJsZUFsaWFzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRhYmxlQWxp\nYXMgPSBnZXRUYWJsZUFsaWFzKHRhYmxlLCBwaikudG9TdHJpbmcoKTsKICAg\nICAgICAgICAgICAgIF90YWJsZUFsaWFzZXMucHV0KHRhYmxlLCB0YWJsZUFs\naWFzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFN0\ncmluZ0J1ZmZlcih0YWJsZUFsaWFzKS5hcHBlbmQoY29sKS50b1N0cmluZygp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0VGFibGVBbGlhcyh0YWJs\nZSwgcGopLmFwcGVuZChjb2wpLnRvU3RyaW5nKCk7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgU3RyaW5nQnVmZmVyIGdldFRhYmxlQWxpYXMoVGFibGUgdGFi\nbGUsIFBhdGhKb2lucyBwaikgewogICAgICAgIFN0cmluZ0J1ZmZlciBidWYg\nPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgaWYgKF9mcm9tICE9IG51\nbGwpIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gdG9BbGlhcyhfZnJv\nbS5nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpOwogICAgICAgICAg\nICBpZiAoX2RpY3QucmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAg\nICAgICAgICAgIHJldHVybiBidWYuYXBwZW5kKEZST01fU0VMRUNUX0FMSUFT\nKS5hcHBlbmQoIi4iKS5hcHBlbmQoYWxpYXMpLgogICAgICAgICAgICAgICAg\nICAgIGFwcGVuZCgiXyIpOwogICAgICAgICAgICByZXR1cm4gYnVmLmFwcGVu\nZChhbGlhcykuYXBwZW5kKCJfIik7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBidWYuYXBwZW5kKHRvQWxpYXMoZ2V0VGFibGVJbmRleCh0YWJsZSwgcGos\nIHRydWUpKSkuYXBwZW5kKCIuIik7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNBZ2dyZWdhdGUoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBB\nR0dSRUdBVEUpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QWdn\ncmVnYXRlKGJvb2xlYW4gYWdnKSB7CiAgICAgICAgaWYgKGFnZykKICAgICAg\nICAgICAgX2ZsYWdzIHw9IEFHR1JFR0FURTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9mbGFncyAmPSB+QUdHUkVHQVRFOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzTG9iKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYg\nTE9CKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExvYihib29s\nZWFuIGxvYikgewogICAgICAgIGlmIChsb2IpCiAgICAgICAgICAgIF9mbGFn\ncyB8PSBMT0I7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZmxhZ3MgJj0g\nfkxPQjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhclNlbGVjdHMoKSB7\nCiAgICAgICAgX3NlbGVjdHMuY2xlYXIoKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzZWxlY3QoU1FMQnVmZmVyIHNxbCwgT2JqZWN0IGlkKSB7CiAg\nICAgICAgcmV0dXJuIHNlbGVjdChzcWwsIGlkLCBudWxsKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU1FMQnVmZmVyIHNxbCwgT2JqZWN0\nIGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygp\nKQogICAgICAgICAgICByZXR1cm4gc2VsZWN0KChPYmplY3QpIHNxbCwgaWQs\nIGpvaW5zKTsKICAgICAgICBncm91cEJ5KHNxbCwgam9pbnMpOwogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCB0\naGUgc2VsZWN0IG9mIHRoZSBnaXZlbiBTUUwgYnVmZmVyIG9yIHN0cmluZy4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdChPYmplY3Qgc3Fs\nLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgZ2V0Sm9pbnMo\nam9pbnMsIHRydWUpOwogICAgICAgIGJvb2xlYW4gY29udGFpbnM7CiAgICAg\nICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAgaW50IGlkeCA9IF9z\nZWxlY3RzLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAgICAgICBjb250YWlu\ncyA9IGlkeCAhPSAtMTsKICAgICAgICAgICAgaWYgKGNvbnRhaW5zKQogICAg\nICAgICAgICAgICAgaWQgPSBfc2VsZWN0cy5nZXQoaWR4KTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgaWQgPSBudWxsSWQoKTsKICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgY29udGFpbnMgPSBfc2VsZWN0cy5jb250\nYWlucyhpZCk7CgogICAgICAgIGlmIChjb250YWlucykKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIF9zZWxlY3RzLnNldEFsaWFzKGlkLCBz\ncWwsIGZhbHNlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgYSB1bmlxdWUgaWQgZm9yIGEgU1FMIHN0cmlu\nZyB3aG9zZSBnaXZlbiBpZCBpcyBudWxsLgogICAgICovCiAgICBwcml2YXRl\nIE9iamVjdCBudWxsSWQoKSB7CiAgICAgICAgaWYgKF9udWxsSWRzID49IE5V\nTExfSURTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBOdWxsSWQo\nKTsKICAgICAgICByZXR1cm4gTlVMTF9JRFNbX251bGxJZHMrK107CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFN0cmluZyBzcWwsIE9iamVj\ndCBpZCkgewogICAgICAgIHJldHVybiBzZWxlY3Qoc3FsLCBpZCwgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFN0cmluZyBzcWws\nIE9iamVjdCBpZCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoIWlzR3Jv\ndXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdCgoT2JqZWN0KSBz\ncWwsIGlkLCBqb2lucyk7CiAgICAgICAgZ3JvdXBCeShzcWwsIGpvaW5zKTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZWxlY3RQbGFjZWhvbGRlcihTdHJpbmcgc3FsKSB7CiAgICAgICAgT2JqZWN0\nIGhvbGRlciA9IChfcGxhY2Vob2xkZXJzID49IFBMQUNFSE9MREVSUy5sZW5n\ndGgpCiAgICAgICAgICAgID8gbmV3IFBsYWNlaG9sZGVyKCkgOiBQTEFDRUhP\nTERFUlNbX3BsYWNlaG9sZGVycysrXTsKICAgICAgICBzZWxlY3Qoc3FsLCBo\nb2xkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0IGEgcGxhY2Vo\nb2xkZXIgYXQgdGhlIGdpdmVuIGluZGV4OyB1c2UgYSBuZWdhdGl2ZSBpbmRl\neAogICAgICogdG8gY291bnQgZnJvbSB0aGUgYmFjayBvZiB0aGUgc2VsZWN0\nIGxpc3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGluc2VydFBsYWNlaG9s\nZGVyKFN0cmluZyBzcWwsIGludCBwb3MpIHsKICAgICAgICBPYmplY3QgaG9s\nZGVyID0gKF9wbGFjZWhvbGRlcnMgPj0gUExBQ0VIT0xERVJTLmxlbmd0aCkK\nICAgICAgICAgICAgPyBuZXcgUGxhY2Vob2xkZXIoKSA6IFBMQUNFSE9MREVS\nU1tfcGxhY2Vob2xkZXJzKytdOwogICAgICAgIF9zZWxlY3RzLmluc2VydEFs\naWFzKHBvcywgaG9sZGVyLCBzcWwpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2xlYXIgc2VsZWN0ZWQgcGxhY2Vob2xkZXJzLCBhbmQgcmV0dXJuIHJlbW92\nZWQgc2VsZWN0IGluZGV4ZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNs\nZWFyUGxhY2Vob2xkZXJTZWxlY3RzKCkgewogICAgICAgIF9zZWxlY3RzLmNs\nZWFyUGxhY2Vob2xkZXJzKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nc2VsZWN0KENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KGNv\nbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\nZWxlY3QoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAo\nIWlzR3JvdXBpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdChjb2ws\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgZmFsc2UpOwogICAgICAgIGdyb3Vw\nQnkoY29sLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgc2VsZWN0KENvbHVtbltdIGNvbHMpIHsKICAgICAg\nICByZXR1cm4gc2VsZWN0KGNvbHMsIG51bGwpOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgc2VsZWN0KENvbHVtbltdIGNvbHMsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoaXNHcm91cGluZygp\nKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywgam9pbnMpOwogICAgICAg\nICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgUGF0aEpvaW5zIHBq\nID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGludCBzZWxkID0g\nMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29sc1tpXSwgcGosIGZhbHNl\nKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAgIHJl\ndHVybiBzZWxkOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBn\naXZlbiBjb2x1bW4gYWZ0ZXIgbWFraW5nIHRoZSBnaXZlbiBqb2lucy4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNlbGVjdChDb2x1bW4gY29sLCBQ\nYXRoSm9pbnMgcGosIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAvLyB3ZSBj\nYWNoZSBvbiBjb2x1bW4gb2JqZWN0IGlmIHRoZXJlIGFyZSBubyBqb2lucyBz\nbyB0aGF0IHdoZW4KICAgICAgICAvLyBsb29raW5nIHVwIGNvbHVtbnMgaW4g\ndGhlIHJlc3VsdCB3ZSBkb24ndCBoYXZlIHRvIGNyZWF0ZSBhIHN0cmluZwog\nICAgICAgIC8vIGJ1ZmZlciBmb3IgdGhlIHRhYmxlICsgY29sdW1uIGFsaWFz\nOyBpZiB0aGVyZSBhcmUgam9pbnMsIHRoZW4KICAgICAgICAvLyB3ZSBrZXkg\nb24gdGhlIGFsaWFzCiAgICAgICAgU3RyaW5nIGFsaWFzID0gZ2V0Q29sdW1u\nQWxpYXMoY29sLCBwaik7CiAgICAgICAgT2JqZWN0IGlkOwogICAgICAgIGlm\nIChwaiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAg\nICBpZCA9IGNvbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlkID0gYWxp\nYXM7CiAgICAgICAgaWYgKF9zZWxlY3RzLmNvbnRhaW5zKGlkKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoY29sLmdldFR5cGUo\nKSA9PSBUeXBlcy5CTE9CIHx8IGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0xP\nQikKICAgICAgICAgICAgc2V0TG9iKHRydWUpOwogICAgICAgIF9zZWxlY3Rz\nLnNldEFsaWFzKGlkLCBhbGlhcywgaWRlbnQpOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdChDbGFzc01hcHBp\nbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFn\nZXIpIHsKICAgICAgICBzZWxlY3QobWFwcGluZywgc3ViY2xhc3Nlcywgc3Rv\ncmUsIGZldGNoLCBlYWdlciwgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3Nl\ncywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIGludCBlYWdlciwKICAgICAgICBKb2lucyBqb2lucykg\newogICAgICAgIHNlbGVjdCh0aGlzLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBz\ndG9yZSwgZmV0Y2gsIGVhZ2VyLCBqb2lucywgZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2VsZWN0IHRoZSBnaXZlbiBtYXBwaW5nLgogICAgICov\nCiAgICB2b2lkIHNlbGVjdChTZWxlY3Qgd3JhcHBlciwgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFuIGlkZW50KSB7CiAgICAg\nICAgLy8gbm90ZSB0aGF0IHRoaXMgaXMgb25lIGNhc2Ugd2hlcmUgd2UgZG9u\nJ3Qgd2FudCB0byB1c2UgdGhlIHJlc3VsdAogICAgICAgIC8vIG9mIGdldEpv\naW5zKCk7IGp1c3QgdXNlIHRoZSBnaXZlbiBqb2lucywgd2hpY2ggd2lsbCBl\naXRoZXIgYmUgY2xlYW4KICAgICAgICAvLyBvciB0aGUgcmVzdWx0IG9mIHBy\nZXZpb3VzIHByZS1qb2lucy4gdGhpcyB3YXkgd2UgZG9uJ3QgcHVzaCBleHRy\nYQogICAgICAgIC8vIHN0YWNrIHN0dWZmIHdoZW4gbm8gYWN0dWFsIG5ldyBq\nb2lucyBoYXZlIGJlZW4gbWFkZSwgYW5kIHdlIGRvbid0CiAgICAgICAgLy8g\ndGhpbmsgdGhlIHVzZXIgd2FudHMgb3V0ZXIgam9pbnMgd2hlbiBhY3R1YWxs\neSBvbmx5IHRoZSBwcmV2aW91cwogICAgICAgIC8vIGpvaW5zIHdlcmUgb3V0\nZXIuICB3ZSBkbyBpbnZva2UgZ2V0Sm9pbnMoKSwgdGhvdWdoLCB0byBhZGQg\ndGhlc2UKICAgICAgICAvLyBqb2lucyAoaWYgYW55KSB0byBvdXIgdG9wLWxl\ndmVsIGpvaW5zOyBvdGhlcndpc2UgaXQnZCBiZSBwb3NzaWJsZQogICAgICAg\nIC8vIGZvciB0aGUgdXNlciB0byBpbW1lZGlhdGVseSBkbyBhbm90aGVyIGpv\naW4gYW5kIHNlbGVjdCBzb21ldGhpbmcsCiAgICAgICAgLy8gYW5kIGlmIHdl\nJ3JlIGluIG91dGVyIG1vZGUgYWxsIHRoZXNlIGpvaW5zIHdpbGwgZ2V0IHN3\naXRjaGVkIHRvIG91dGVyCiAgICAgICAgLy8gam9pbnMuICBjYWNoaW5nIHRo\nZW0gYXMgdGhlaXIgb3JpZ2luYWwgam9pbiB0eXBlIHByZXZlbnRzIHRoYXQK\nICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CgogICAgICAgIFBhdGhK\nb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5zOwogICAgICAgIGJvb2xlYW4g\naGFzSm9pbnMgPSBwaiAhPSBudWxsICYmIHBqLmlzRGlydHkoKTsKICAgICAg\nICBpZiAoaGFzSm9pbnMpIHsKICAgICAgICAgICAgaWYgKF9wcmVKb2lucyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3ByZUpvaW5zID0gbmV3IFN0YWNr\nKCk7CiAgICAgICAgICAgIF9wcmVKb2lucy5wdXNoKHBqKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGlmIHRoZXkgYXJlIHNlbGVjdGluZyB0aGlzIG1hcHBp\nbmcgd2l0aCBvdXRlciBqb2lucywgdGhlbiBhbGwgam9pbnMKICAgICAgICAv\nLyBmcm9tIHRoaXMgbWFwcGluZyBzaG91bGQgYWxzbyBiZSBvdXRlcgogICAg\nICAgIGJvb2xlYW4gd2FzT3V0ZXIgPSAoX2ZsYWdzICYgT1VURVIpICE9IDA7\nCiAgICAgICAgaWYgKGhhc0pvaW5zICYmICF3YXNPdXRlciAmJiBwai5pc091\ndGVyKCkpCiAgICAgICAgICAgIF9mbGFncyB8PSBPVVRFUjsKCiAgICAgICAg\nLy8gZGVsZWdhdGUgdG8gc3RvcmUgbWFuYWdlciB0byBzZWxlY3QgaW4gc2Ft\nZSBvcmRlciBpdCBsb2FkcyByZXN1bHQKICAgICAgICAoKEpEQkNTdG9yZU1h\nbmFnZXIpIHN0b3JlKS5zZWxlY3Qod3JhcHBlciwgbWFwcGluZywgc3ViY2xh\nc3NlcywgbnVsbCwKICAgICAgICAgICAgbnVsbCwgZmV0Y2gsIGVhZ2VyLCBp\nZGVudCwgKF9mbGFncyAmIE9VVEVSKSAhPSAwKTsKCiAgICAgICAgLy8gcmVz\nZXQKICAgICAgICBpZiAoaGFzSm9pbnMpCiAgICAgICAgICAgIF9wcmVKb2lu\ncy5wb3AoKTsKICAgICAgICBpZiAoIXdhc091dGVyICYmIChfZmxhZ3MgJiBP\nVVRFUikgIT0gMCkKICAgICAgICAgICAgX2ZsYWdzICY9IH5PVVRFUjsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVyKENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gc2VsZWN0SWRlbnRpZmllcihjb2ws\nIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2Vs\nZWN0SWRlbnRpZmllcihDb2x1bW4gY29sLCBKb2lucyBqb2lucykgewogICAg\nICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICByZXR1cm4gc2Vs\nZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCB0cnVlKTsKICAgICAg\nICBncm91cEJ5KGNvbCwgam9pbnMpOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdElkZW50aWZpZXIoQ29sdW1u\nW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3RJZGVudGlmaWVyKGNv\nbHMsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0SWRlbnRp\nZmllcihDb2x1bW5bXSBjb2xzLCBKb2lucyBqb2lucykgewogICAgICAgIGlm\nIChjb2xzID09IG51bGwgfHwgY29scy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGlzR3JvdXBpbmcoKSkgewogICAg\nICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAgICAgICAgICAgcmV0\ndXJuIDA7CiAgICAgICAgfQogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpv\naW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBpZiAoc2VsZWN0KGNvbHNbaV0sIHBqLCB0cnVlKSkKICAgICAg\nICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAgIHJldHVybiBzZWxk\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdElkZW50aWZpZXIoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\naW50IGVhZ2VyKSB7CiAgICAgICAgc2VsZWN0SWRlbnRpZmllcihtYXBwaW5n\nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RJZGVudGlmaWVyKENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBl\nYWdlciwKICAgICAgICBKb2lucyBqb2lucykgewogICAgICAgIHNlbGVjdCh0\naGlzLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2Vy\nLCBqb2lucywgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3RQ\ncmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgcmV0\ndXJuIHNlbGVjdFByaW1hcnlLZXkobWFwcGluZywgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIGludCBzZWxlY3RQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBt\nYXBwaW5nLCBKb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBwcmltYXJ5\nS2V5T3BlcmF0aW9uKG1hcHBpbmcsIHRydWUsIG51bGwsIGpvaW5zLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVyYXRlIG9uIHByaW1hcnkg\na2V5IGRhdGEuIFJldHVybiBhIGJpdCBtYXNrIG9mIHNlbGVjdGVkIGNvbHVt\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHByaW1hcnlLZXlPcGVyYXRp\nb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gc2VsLAogICAgICAg\nIEJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBhbGlhc09yZGVy\nKSB7CiAgICAgICAgaWYgKCFzZWwgJiYgYXNjID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiAwOwoKICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcgY2Fu\nJ3Qgc2VsZWN0IHRoZSBmdWxsIHBrIHZhbHVlcywgdGhlbiBqb2luIHRvCiAg\nICAgICAgLy8gc3VwZXIgYW5kIHJlY3Vyc2UKICAgICAgICBDbGFzc01hcHBp\nbmcgc3VwOwogICAgICAgIGlmICghbWFwcGluZy5pc1ByaW1hcnlLZXlPYmpl\nY3RJZCh0cnVlKSkgewogICAgICAgICAgICBzdXAgPSBtYXBwaW5nLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAgICBpZiAo\nam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3Sm9p\nbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNs\nYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybiBwcmltYXJ5\nS2V5T3BlcmF0aW9uKHN1cCwgc2VsLCBhc2MsIGpvaW5zLCBhbGlhc09yZGVy\nKTsKICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBtYXBwaW5n\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgaWYgKGlzR3JvdXBp\nbmcoKSkgewogICAgICAgICAgICBncm91cEJ5KGNvbHMsIGpvaW5zKTsKICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBQYXRoSm9p\nbnMgcGogPSBnZXRKb2lucyhqb2lucywgZmFsc2UpOwogICAgICAgIGludCBz\nZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb2x1bW5PcGVyYXRpb24oY29s\nc1tpXSwgc2VsLCBhc2MsIHBqLCBhbGlhc09yZGVyKSkKICAgICAgICAgICAg\nICAgIHNlbGQgfD0gMiA8PCBpOwoKICAgICAgICAvLyBpZiB0aGlzIG1hcHBp\nbmcgaGFzIG5vdCBiZWVuIHVzZWQgaW4gdGhlIHNlbGVjdCB5ZXQgKGFuZCB0\naGVyZWZvcmUKICAgICAgICAvLyBpcyBub3Qgam9pbmVkIHRvIGFueXRoaW5n\nKSwgYnV0IGhhcyBhbiBvdGhlci10YWJsZSBzdXBlcmNsYXNzIHRoYXQKICAg\nICAgICAvLyBoYXMgYmVlbiB1c2VkLCBtYWtlIHN1cmUgdG8gam9pbiB0byBp\ndAogICAgICAgIGJvb2xlYW4gam9pbmVkID0gZmFsc2U7CiAgICAgICAgZm9y\nIChzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpOyBzdXAgIT0gbnVsbDsKICAgICAgICAgICAgbWFwcGluZyA9IHN1cCwg\nc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKSkgewogICAgICAgICAgICBpZiAoc3VwLmdldFRhYmxlKCkgPT0gbWFwcGlu\nZy5nZXRUYWJsZSgpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAg\nICAgICAgICBpZiAobWFwcGluZy5nZXRUYWJsZSgpICE9IHN1cC5nZXRUYWJs\nZSgpCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUluZGV4KG1hcHBpbmcu\nZ2V0VGFibGUoKSwgcGosIGZhbHNlKSA9PSAtMQogICAgICAgICAgICAgICAg\nJiYgZ2V0VGFibGVJbmRleChzdXAuZ2V0VGFibGUoKSwgcGosIGZhbHNlKSAh\nPSAtMSkgewogICAgICAgICAgICAgICAgaWYgKHBqID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBuZXdKb2lucygpOwog\nICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBtYXBwaW5nLmpvaW5T\ndXBlcmNsYXNzKHBqLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBqb2luZWQg\nPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoam9pbmVkKQogICAgICAgICAg\nICB3aGVyZShwaik7CgogICAgICAgIHJldHVybiBzZWxkOwogICAgfQoKICAg\nIC8qKgogICAgICogUGVyZm9ybSBhbiBvcGVyYXRpb24gb24gYSBjb2x1bW4u\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBjb2x1bW5PcGVyYXRpb24o\nQ29sdW1uIGNvbCwgYm9vbGVhbiBzZWwsIEJvb2xlYW4gYXNjLAogICAgICAg\nIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAg\nU3RyaW5nIGFzID0gbnVsbDsKICAgICAgICBpZiAoYXNjICE9IG51bGwgJiYg\nKGFsaWFzT3JkZXIgfHwgKF9mbGFncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAw\nKSkgewogICAgICAgICAgICBPYmplY3QgaWQ7CiAgICAgICAgICAgIGlmIChw\naiA9PSBudWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgaWQgPSBjb2w7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIGlkID0gZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7CiAgICAgICAgICAgIGlm\nICgoX2ZsYWdzICYgUkVDT1JEX09SREVSRUQpICE9IDApIHsKICAgICAgICAg\nICAgICAgIGlmIChfb3JkZXJlZCA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIF9vcmRlcmVkID0gbmV3IEFycmF5TGlzdCg1KTsKICAgICAgICAgICAg\nICAgIF9vcmRlcmVkLmFkZChpZCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKGFsaWFzT3JkZXIpIHsKICAgICAgICAgICAgICAgIGFzID0gdG9P\ncmRlckFsaWFzKF9vcmRlcnMrKyk7CiAgICAgICAgICAgICAgICBfc2VsZWN0\ncy5zZXRTZWxlY3RBcyhpZCwgYXMpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBib29sZWFuIHNlbGQgPSBzZWwgJiYgc2VsZWN0KGNvbCwg\ncGosIGZhbHNlKTsKICAgICAgICBpZiAoYXNjICE9IG51bGwpIHsKICAgICAg\nICAgICAgU3RyaW5nIGFsaWFzID0gKGFzICE9IG51bGwpID8gYXMgOiBnZXRD\nb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAgICAgICAgYXBwZW5kT3JkZXJp\nbmcoYWxpYXMsIGFzYy5ib29sZWFuVmFsdWUoKSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBzZWxkOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5k\nIG9yZGVyaW5nIGluZm9ybWF0aW9uIHRvIG91ciBpbnRlcm5hbCBidWZmZXIu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRPcmRlcmluZyhPYmpl\nY3Qgb3JkZXJCeSwgYm9vbGVhbiBhc2MpIHsKICAgICAgICBpZiAoX29yZGVy\naW5nID09IG51bGwpCiAgICAgICAgICAgIF9vcmRlcmluZyA9IG5ldyBTUUxC\ndWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX29yZGVy\naW5nLmFwcGVuZCgiLCAiKTsKCiAgICAgICAgaWYgKG9yZGVyQnkgaW5zdGFu\nY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQo\nKFNRTEJ1ZmZlcikgb3JkZXJCeSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfb3JkZXJpbmcuYXBwZW5kKChTdHJpbmcpIG9yZGVyQnkpOwogICAgICAg\nIGlmIChhc2MpCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoIiBBU0Mi\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQo\nIiBERVNDIik7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFy\neUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAg\nICAgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeVByaW1h\ncnlLZXkobWFwcGluZywgYXNjLCBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFu\nIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5UHJpbWFyeUtleShtYXBw\naW5nLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBj\nb2x1bW5zLgogICAgICovCiAgICBwdWJsaWMgaW50IG9yZGVyQnlQcmltYXJ5\nS2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIGFzYywKICAgICAg\nICBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsIGJvb2xlYW4gYWxpYXNPcmRl\ncikgewogICAgICAgIHJldHVybiBwcmltYXJ5S2V5T3BlcmF0aW9uKG1hcHBp\nbmcsIHNlbCwKICAgICAgICAgICAgKGFzYykgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFLCBqb2lucywgYWxpYXNPcmRlcik7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gb3JkZXJCeShDb2x1bW4gY29sLCBib29sZWFuIGFz\nYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2ws\nIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBv\ncmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2wsIGFz\nYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMu\nCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJCeShDb2x1bW4gY29sLCBib29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJv\nb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVybiBjb2x1bW5PcGVy\nYXRpb24oY29sLCBzZWwsIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRSwKICAgICAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCBh\nbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IG9yZGVyQnkoQ29s\ndW1uW10gY29scywgYm9vbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAgICAg\nICAgcmV0dXJuIG9yZGVyQnkoY29scywgYXNjLCBudWxsLCBzZWwpOwogICAg\nfQoKICAgIHB1YmxpYyBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAg\ncmV0dXJuIG9yZGVyQnkoY29scywgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFs\naWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgaW50IG9yZGVy\nQnkoQ29sdW1uW10gY29scywgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBi\nb29sZWFuIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAg\nICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAg\nICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbHVtbk9w\nZXJhdGlvbihjb2xzW2ldLCBzZWwsCiAgICAgICAgICAgICAgICAoYXNjKSA/\nIEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIHBqLCBhbGlhc09yZGVy\nKSkKICAgICAgICAgICAgICAgIHNlbGQgfD0gMiA8PCBpOwogICAgICAgIHJl\ndHVybiBzZWxkOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnko\nU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIGJvb2xlYW4gc2VsKSB7CiAg\nICAgICAgcmV0dXJuIG9yZGVyQnkoc3FsLCBhc2MsIChKb2lucykgbnVsbCwg\nc2VsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1\nZmZlciBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywKICAgICAgICBi\nb29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5KHNxbCwgYXNj\nLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIgY29sdW1ucy4K\nICAgICAqLwogICAgYm9vbGVhbiBvcmRlckJ5KFNRTEJ1ZmZlciBzcWwsIGJv\nb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsCiAgICAgICAg\nYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnko\nKE9iamVjdCkgc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGFsaWFzT3JkZXIpOwog\nICAgfQoKICAgIC8qKgogICAgICogT3JkZXIgb24gYSBTUUwgYnVmZmVyIG9y\nIHN0cmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIG9yZGVyQnko\nT2JqZWN0IHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFu\nIHNlbCwKICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBP\nYmplY3Qgb3JkZXIgPSBzcWw7CiAgICAgICAgaWYgKGFsaWFzT3JkZXIpIHsK\nICAgICAgICAgICAgb3JkZXIgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsK\nICAgICAgICAgICAgX3NlbGVjdHMuc2V0U2VsZWN0QXMoc3FsLCAoU3RyaW5n\nKSBvcmRlcik7CiAgICAgICAgfQogICAgICAgIGlmICgoX2ZsYWdzICYgUkVD\nT1JEX09SREVSRUQpICE9IDApIHsKICAgICAgICAgICAgaWYgKF9vcmRlcmVk\nID09IG51bGwpCiAgICAgICAgICAgICAgICBfb3JkZXJlZCA9IG5ldyBBcnJh\neUxpc3QoNSk7CiAgICAgICAgICAgIF9vcmRlcmVkLmFkZChzcWwpOwogICAg\nICAgIH0KCiAgICAgICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAg\nIGFwcGVuZE9yZGVyaW5nKG9yZGVyLCBhc2MpOwogICAgICAgIGlmIChzZWwp\nIHsKICAgICAgICAgICAgaW50IGlkeCA9IF9zZWxlY3RzLmluZGV4T2ZBbGlh\ncyhzcWwpOwogICAgICAgICAgICBpZiAoaWR4ID09IC0xKSB7CiAgICAgICAg\nICAgICAgICBfc2VsZWN0cy5zZXRBbGlhcyhudWxsSWQoKSwgc3FsLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gb3JkZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFz\nYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShzcWws\nIGFzYywgbnVsbCwgc2VsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBv\ncmRlckJ5KFN0cmluZyBzcWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFz\nYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMu\nCiAgICAgKi8KICAgIGJvb2xlYW4gb3JkZXJCeShTdHJpbmcgc3FsLCBib29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJv\nb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIHJldHVybiBvcmRlckJ5KChP\nYmplY3QpIHNxbCwgYXNjLCBqb2lucywgc2VsLCBhbGlhc09yZGVyKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhck9yZGVyaW5nKCkgewogICAgICAg\nIF9vcmRlcmluZyA9IG51bGw7CiAgICAgICAgX29yZGVycyA9IDA7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gcmVjb3JkIHRoZSBz\nZWxlY3QgbGlzdCBpbmRleGVzIG9mIGl0ZW1zIHdlIG9yZGVyIGJ5LgogICAg\nICovCiAgICB2b2lkIHNldFJlY29yZE9yZGVyZWRJbmRleGVzKGJvb2xlYW4g\ncmVjb3JkKSB7CiAgICAgICAgaWYgKHJlY29yZCkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IFJFQ09SRF9PUkRFUkVEOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICBfb3JkZXJlZCA9IG51bGw7CiAgICAgICAgICAgIF9mbGFncyAmPSB+\nUkVDT1JEX09SREVSRUQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBpbmRleGVzIGluIHRoZSBzZWxlY3QgbGlzdCBvZiBh\nbGwgaXRlbXMgd2UncmUgb3JkZXJpbmcKICAgICAqIGJ5LCBvciBudWxsIGlm\nIG5vbmUuIEZvciB1c2Ugd2l0aCB1bmlvbnMuCiAgICAgKi8KICAgIExpc3Qg\nZ2V0T3JkZXJlZEluZGV4ZXMoKSB7CiAgICAgICAgaWYgKF9vcmRlcmVkID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIExpc3Qg\naWR4cyA9IG5ldyBBcnJheUxpc3QoX29yZGVyZWQuc2l6ZSgpKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IF9vcmRlcmVkLnNpemUoKTsgaSsrKQog\nICAgICAgICAgICBpZHhzLmFkZChOdW1iZXJzLnZhbHVlT2YoX3NlbGVjdHMu\naW5kZXhPZihfb3JkZXJlZC5nZXQoaSkpKSk7CiAgICAgICAgcmV0dXJuIGlk\neHM7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmVQcmltYXJ5S2V5KE9i\namVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSkgewogICAgICAgIHdoZXJlUHJpbWFyeUtleShvaWQsIG1h\ncHBpbmcsIG51bGwsIHN0b3JlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB3aGVyZSBjb25kaXRpb25zIHNldHRpbmcgdGhlIG1hcHBpbmcncyBwcmlt\nYXJ5IGtleSB0byB0aGUgZ2l2ZW4KICAgICAqIG9pZCB2YWx1ZXMuIElmIHRo\nZSBnaXZlbiBtYXBwaW5nIGRvZXMgbm90IHVzZSBvaWQgdmFsdWVzIGZvciBp\ndHMKICAgICAqIHByaW1hcnkga2V5LCB3ZSB3aWxsIHJlY3Vyc2l2ZWx5IGpv\naW4gdG8gaXRzIHN1cGVyY2xhc3MgdW50aWwgd2UgZmluZAogICAgICogYW4g\nYW5jZXN0b3IgdGhhdCBkb2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nd2hlcmVQcmltYXJ5S2V5KE9iamVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBw\naW5nLCBKb2lucyBqb2lucywKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsK\nICAgICAgICAvLyBpZiB0aGlzIG1hcHBpbmcncyBpZGVudGlmaWVycyBpbmNs\ndWRlIHNvbWV0aGluZyBvdGhlciB0aGFuCiAgICAgICAgLy8gdGhlIHBrIHZh\nbHVlcywgam9pbiB0byBzdXBlciBhbmQgcmVjdXJzZQogICAgICAgIGlmICgh\nbWFwcGluZy5pc1ByaW1hcnlLZXlPYmplY3RJZChmYWxzZSkpIHsKICAgICAg\nICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQ\nQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwog\nICAgICAgICAgICBqb2lucyA9IG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9p\nbnMsIGZhbHNlKTsKICAgICAgICAgICAgd2hlcmVQcmltYXJ5S2V5KG9pZCwg\nc3VwLCBqb2lucywgc3RvcmUpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gbWFwcGluZy5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIHdoZXJlKG9pZCwgbWFwcGluZywg\nY29scywgY29scywgbnVsbCwgbnVsbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nLAogICAgICAgICAgICBzdG9yZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9iamVjdCBvaWQsCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNTdG9yZSBzdG9yZSkg\newogICAgICAgIHdoZXJlRm9yZWlnbktleShmaywgb2lkLCBtYXBwaW5nLCBu\ndWxsLCBzdG9yZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgd2hlcmUg\nY29uZGl0aW9ucyBzZXR0aW5nIHRoZSBnaXZlbiBmb3JlaWduIGtleSB0byB0\naGUgZ2l2ZW4KICAgICAqIG9pZCB2YWx1ZXMuCiAgICAgKgogICAgICogQHNl\nZSAjd2hlcmVQcmltYXJ5S2V5CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3\naGVyZUZvcmVpZ25LZXkoRm9yZWlnbktleSBmaywgT2JqZWN0IG9pZCwKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgSm9pbnMgam9pbnMsIEpEQkNT\ndG9yZSBzdG9yZSkgewogICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZydzIGlk\nZW50aWZpZXJzIGluY2x1ZGUgc29tZXRoaW5nIG90aGVyIHRoYW4KICAgICAg\nICAvLyB0aGUgcGsgdmFsdWVzLCBvciBpZiB0aGlzIGZvcmVpZ24ga2V5IGRv\nZXNuJ3QgbGluayB0byBvbmx5CiAgICAgICAgLy8gaWRlbnRpZmllcnMsIGpv\naW4gdG8gdGFibGUgYW5kIGRvIGEgZ2V0UHJpbWFyeUtleQogICAgICAgIGlm\nICghbWFwcGluZy5pc1ByaW1hcnlLZXlPYmplY3RJZChmYWxzZSkgfHwgIWNv\nbnRhaW5zQWxsCiAgICAgICAgICAgIChtYXBwaW5nLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCksIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpKSB7CiAgICAg\nICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgam9p\nbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICAvLyB0cmF2ZXJzZSB0byBm\nb3JlaWduIGtleSB0YXJnZXQgbWFwcGluZwogICAgICAgICAgICB3aGlsZSAo\nbWFwcGluZy5nZXRUYWJsZSgpICE9IGZrLmdldFByaW1hcnlLZXlUYWJsZSgp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBqb2lucyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAg\nICAgICBqb2lucyA9IG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBwaW5nLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAgICAgICAg\naWYgKG1hcHBpbmcgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBqb2lucyA9IGpvaW5zLmpvaW4oZmssIGZhbHNlLCBmYWxzZSk7\nCiAgICAgICAgICAgIHdoZXJlUHJpbWFyeUtleShvaWQsIG1hcHBpbmcsIGpv\naW5zLCBzdG9yZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIENvbHVtbltdIGZyb21Db2xzID0gZmsuZ2V0Q29sdW1ucygpOwog\nICAgICAgIENvbHVtbltdIHRvQ29scyA9IGZrLmdldFByaW1hcnlLZXlDb2x1\nbW5zKCk7CiAgICAgICAgQ29sdW1uW10gY29uc3RDb2xzID0gZmsuZ2V0Q29u\nc3RhbnRDb2x1bW5zKCk7CiAgICAgICAgT2JqZWN0W10gY29uc3RzID0gZmsu\nZ2V0Q29uc3RhbnRzKCk7CiAgICAgICAgd2hlcmUob2lkLCBtYXBwaW5nLCB0\nb0NvbHMsIGZyb21Db2xzLCBjb25zdHMsIGNvbnN0Q29scywKICAgICAgICAg\nICAgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCBzdG9yZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJbnRlcm5hbCBtZXRob2QgdG8gZmx1c2ggdGhlIG9pZCB2\nYWx1ZXMgYXMgd2hlcmUgY29uZGl0aW9ucyB0byB0aGUKICAgICAqIGdpdmVu\nIGNvbHVtbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3aGVyZShPYmpl\nY3Qgb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywgQ29sdW1uW10gdG9Db2xz\nLAogICAgICAgIENvbHVtbltdIGZyb21Db2xzLCBPYmplY3RbXSB2YWxzLCBD\nb2x1bW5bXSBjb25zdENvbHMsIFBhdGhKb2lucyBwaiwKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUpIHsKICAgICAgICBWYWx1ZU1hcHBpbmcgZW1iZWQgPSBt\nYXBwaW5nLmdldEVtYmVkZGluZ01hcHBpbmcoKTsKICAgICAgICBpZiAoZW1i\nZWQgIT0gbnVsbCkgewogICAgICAgICAgICB3aGVyZShvaWQsIGVtYmVkLmdl\ndEZpZWxkTWFwcGluZygpLmdldERlZmluaW5nTWFwcGluZygpLAogICAgICAg\nICAgICAgICAgdG9Db2xzLCBmcm9tQ29scywgdmFscywgY29uc3RDb2xzLCBw\naiwgc3RvcmUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyBvbmx5IGJvdGhlciB0byBwYWNrIHBrIHZhbHVlcyBpbnRvIGFy\ncmF5IGlmIGFwcCBpZAogICAgICAgIE9iamVjdFtdIHBrcyA9IG51bGw7CiAg\nICAgICAgaWYgKG1hcHBpbmcuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NN\nYXBwaW5nLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICBwa3MgPSBBcHBs\naWNhdGlvbklkcy50b1BLVmFsdWVzKG9pZCwgbWFwcGluZyk7CgogICAgICAg\nIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAgICAg\nICBKb2luYWJsZSBqb2luOwogICAgICAgIE9iamVjdCB2YWw7CiAgICAgICAg\naW50IGNvdW50ID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRv\nQ29scy5sZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICBpZiAo\ncGtzID09IG51bGwpCiAgICAgICAgICAgICAgICB2YWwgPSAob2lkID09IG51\nbGwpID8gbnVsbCA6IE51bWJlcnMudmFsdWVPZigoKElkKSBvaWQpLmdldElk\nKCkpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG11\nc3QgYmUgYXBwIGlkZW50aXR5OyB1c2UgcGsgaW5kZXggdG8gZ2V0IGNvcnJl\nY3QgcGsgdmFsdWUKICAgICAgICAgICAgICAgIGpvaW4gPSBtYXBwaW5nLmFz\nc2VydEpvaW5hYmxlKHRvQ29sc1tpXSk7CiAgICAgICAgICAgICAgICB2YWwg\nPSBwa3NbbWFwcGluZy5nZXRGaWVsZChqb2luLmdldEZpZWxkSW5kZXgoKSku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0UHJpbWFyeUtleUluZGV4KCldOwog\nICAgICAgICAgICAgICAgdmFsID0gam9pbi5nZXRKb2luVmFsdWUodmFsLCB0\nb0NvbHNbaV0sIHN0b3JlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBB\nTkQgIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMo\nZnJvbUNvbHNbaV0sIHBqKSk7CiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJUyAiKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0gIik7\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1ZSh2YWwsIGZyb21Db2xzW2ld\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb25zdENvbHMgIT0gbnVsbCAm\nJiBjb25zdENvbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGNvbnN0Q29scy5sZW5ndGg7IGkrKywgY291bnQrKykg\newogICAgICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICAgICAg\nYnVmLmFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb25zdENvbHNbaV0sIHBqKSk7\nCgogICAgICAgICAgICAgICAgaWYgKHZhbHNbaV0gPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiID0g\nIik7CiAgICAgICAgICAgICAgICBidWYuYXBwZW5kVmFsdWUodmFsc1tpXSwg\nY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgd2hlcmUoYnVmLCBwaik7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0\nIHRvIHNlZSBpZiB0aGUgZ2l2ZW4gc2V0IG9mIGNvbHVtbnMgY29udGFpbnMg\nYWxsIHRoZQogICAgICogY29sdW1ucyBpbiB0aGUgZ2l2ZW4gcG90ZW50aWFs\nIHN1YnNldC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBj\nb250YWluc0FsbChDb2x1bW5bXSBzZXQsIENvbHVtbltdIHN1YikgewogICAg\nICAgIGlmIChzdWIubGVuZ3RoID4gc2V0Lmxlbmd0aCkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB0aGlzIGlzIG9idmlvdXNseSBu\nXjIsIGJ1dCB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgc2hvdWxkIGJlIGluCiAg\nICAgICAgLy8gdGhlIDEtMiByYW5nZSwgc28gbm8gYmlnZ2llCiAgICAgICAg\nYm9vbGVhbiBmb3VuZCA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBzdWIubGVuZ3RoICYmIGZvdW5kOyBpKyspIHsKICAgICAgICAgICAg\nZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCBzZXQubGVuZ3RoICYmICFmb3VuZDsgaisrKQogICAgICAgICAgICAgICAg\nZm91bmQgPSBzdWJbaV0gPT0gc2V0W2pdOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZm91bmQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoSm9p\nbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMgIT0gbnVsbCkKICAgICAg\nICAgICAgd2hlcmUoKFN0cmluZykgbnVsbCwgam9pbnMpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlKFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICB3\naGVyZShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0byB0aGUg\nV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hlcmUo\nU1FMQnVmZmVyIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gbm8g\nbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoc3FsID09IG51bGwg\nfHwgc3FsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBpZiAoX3doZXJlID09IG51bGwpCiAgICAgICAgICAgIF93aGVyZSA9IG5l\ndyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfd2hlcmUu\naXNFbXB0eSgpKQogICAgICAgICAgICBfd2hlcmUuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB3aGVyZShTdHJpbmcgc3FsKSB7CiAgICAgICAgd2hlcmUoc3Fs\nLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJl\nKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgd2hlcmUoc3Fs\nLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIFdIRVJFIGNsYXVz\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlKFN0cmluZyBzcWws\nIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpv\naW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3doZXJlID09IG51\nbGwpCiAgICAgICAgICAgIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX2RpY3Qp\nOwogICAgICAgIGVsc2UgaWYgKCFfd2hlcmUuaXNFbXB0eSgpKQogICAgICAg\nICAgICBfd2hlcmUuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF93aGVyZS5h\ncHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZpbmcoU1FM\nQnVmZmVyIHNxbCkgewogICAgICAgIGhhdmluZyhzcWwsIChKb2lucykgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBz\ncWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaGF2aW5nKHNxbCwgZ2V0Sm9p\nbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0\naGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBzcWwsIFBh\ndGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5z\nLi4uCiAgICAgICAgaWYgKHNxbCA9PSBudWxsIHx8IHNxbC5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9oYXZpbmcgPT0g\nbnVsbCkKICAgICAgICAgICAgX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIoX2Rp\nY3QpOwogICAgICAgIGVsc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgX2hhdmluZy5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX2hh\ndmluZy5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZp\nbmcoU3RyaW5nIHNxbCkgewogICAgICAgIGhhdmluZyhzcWwsIChKb2lucykg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFN0cmluZyBz\ncWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaGF2aW5nKHNxbCwgZ2V0Sm9p\nbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0\naGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNlLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5nKFN0cmluZyBzcWwsIFBhdGhK\nb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5zLi4u\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2hhdmluZyA9PSBudWxsKQog\nICAgICAgICAgICBfaGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAg\nICAgICAgZWxzZSBpZiAoIV9oYXZpbmcuaXNFbXB0eSgpKQogICAgICAgICAg\nICBfaGF2aW5nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBfaGF2aW5nLmFw\ncGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FM\nQnVmZmVyIHNxbCkgewogICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMpIG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FMQnVmZmVy\nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywg\ndHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVuZChzcWwuZ2V0U1FMKCkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNxbCkgewog\nICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZ3Jv\ndXBCeUFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3Vw\nQnkoQ29sdW1uIGNvbCkgewogICAgICAgIGdyb3VwQnkoY29sLCBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENvbHVtbiBjb2wsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMo\nam9pbnMsIHRydWUpOwogICAgICAgIGdyb3VwQnlBcHBlbmQoZ2V0Q29sdW1u\nQWxpYXMoY29sLCBwaikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3Vw\nQnkoQ29sdW1uW10gY29scykgewogICAgICAgIGdyb3VwQnkoY29scywgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW5bXSBj\nb2xzLCBKb2lucyBqb2lucykgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXBCeUFw\ncGVuZChnZXRDb2x1bW5BbGlhcyhjb2xzW2ldLCBwaikpOwogICAgICAgIH0K\nICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGdyb3VwQnlBcHBlbmQoU3Ry\naW5nIHNxbCkgewogICAgICAgIGlmIChfZ3JvdXBlZCA9PSBudWxsIHx8ICFf\nZ3JvdXBlZC5jb250YWlucyhzcWwpKSB7CiAgICAgICAgICAgIGlmIChfZ3Jv\ndXBpbmcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2dyb3VwaW5nID0g\nbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgICAgICAgICBfZ3JvdXBl\nZCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICBfZ3JvdXBpbmcuYXBwZW5kKCIsICIpOwoKICAgICAgICAg\nICAgX2dyb3VwaW5nLmFwcGVuZChzcWwpOwogICAgICAgICAgICBfZ3JvdXBl\nZC5hZGQoc3FsKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZ3JvdXBCeShDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMs\nIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKSB7CiAgICAgICAgZ3JvdXBCeShtYXBwaW5nLCBzdWJjbGFz\nc2VzLCBzdG9yZSwgZmV0Y2gsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGdyb3VwQnkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFz\nc2VzLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpIHsKICAgICAgICAvLyB3ZSBp\nbXBsZW1lbnQgdGhpcyBieSBwdXR0aW5nIG91cnNlbHZlcyBpbnRvIGdyb3Vw\naW5nIG1vZGUsIHdoZXJlCiAgICAgICAgLy8gYWxsIHNlbGVjdCBpbnZvY2F0\naW9ucyBhcmUgcmUtcm91dGVkIHRvIGdyb3VwLWJ5IGludm9jYXRpb25zIGlu\nc3RlYWQuCiAgICAgICAgLy8gdGhpcyBhbGxvd3MgdXMgdG8gdXRpbGl6ZSB0\naGUgc2FtZSBzZWxlY3QgQVBJcyBvZiB0aGUgc3RvcmUgbWFuYWdlcgogICAg\nICAgIC8vIGFuZCBhbGwgdGhlIG1hcHBpbmcgc3RyYXRlZ2llcywgcmF0aGVy\nIHRoYW4gaGF2aW5nIHRvIGNyZWF0ZSAKICAgICAgICAvLyBlcXVpdmFsZW50\nIEFQSXMgYW5kIGR1cGxpY2F0ZSBsb2dpYyBmb3IgZ3JvdXBpbmcKICAgICAg\nICBib29sZWFuIHdhc0dyb3VwaW5nID0gaXNHcm91cGluZygpOwogICAgICAg\nIF9mbGFncyB8PSBHUk9VUElORzsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBzZWxlY3QobWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNoLCAK\nICAgICAgICAgICAgICAgIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9OT05FLCBq\nb2lucyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKCF3\nYXNHcm91cGluZykKICAgICAgICAgICAgICAgIF9mbGFncyAmPSB+R1JPVVBJ\nTkc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB3\nZSdyZSBpbiBncm91cCBtb2RlLCB3aGVyZSBhbnkgc2VsZWN0IGlzIGNoYW5n\nZWQgdG8gYSBncm91cC1ieQogICAgICogY2FsbC4KICAgICAqLwogICAgcHJp\ndmF0ZSBib29sZWFuIGlzR3JvdXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBHUk9VUElORykgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgam9pbnMgdG8gdXNlIGZvciBjb2x1bW4gYWxpYXNlcywg\nZXRjLgogICAgICoKICAgICAqIEBwYXJhbSBqb2lucyBqb2lucyBnaXZlbiBi\neSB0aGUgdXNlcgogICAgICogQHJldHVybiB0aGUgam9pbnMgdG8gdXNlIGZv\nciBhbGlhc2VzLCBldGMKICAgICAqLwogICAgcHJpdmF0ZSBQYXRoSm9pbnMg\nZ2V0Sm9pbnMoSm9pbnMgam9pbnMsIGJvb2xlYW4gcmVjb3JkKSB7CiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9pbnM7CiAgICAgICAg\nYm9vbGVhbiBwcmUgPSAocGogPT0gbnVsbCB8fCAhcGouaXNEaXJ0eSgpKQog\nICAgICAgICAgICAmJiBfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5z\nLmlzRW1wdHkoKTsKICAgICAgICBpZiAocHJlKQogICAgICAgICAgICBwaiA9\nIChQYXRoSm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CgogICAgICAgIGlmIChw\naiA9PSBudWxsIHx8ICFwai5pc0RpcnR5KCkpCiAgICAgICAgICAgIHBqID0g\nX2pvaW5zOwogICAgICAgIGVsc2UgaWYgKCFwcmUpIHsKICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBPVVRFUikgIT0gMCkKICAgICAgICAgICAgICAgIHBq\nID0gKFBhdGhKb2lucykgb3V0ZXIocGopOwogICAgICAgICAgICBpZiAocmVj\nb3JkKSB7CiAgICAgICAgICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgICAgICByZW1vdmVQYXJlbnRKb2lucyhwaik7CiAgICAg\nICAgICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkgewogICAgICAgICAgICAg\nICAgICAgIHJlbW92ZUpvaW5zRnJvbVN1YnNlbGVjdHMocGopOwogICAgICAg\nICAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgX2pvaW5zID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChfam9pbnMuam9pbnMoKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBfam9pbnMuc2V0Sm9pbnMobmV3\nIEpvaW5TZXQocGouam9pbnMoKSkpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zLmpvaW5zKCkuYWRk\nQWxsKHBqLmpvaW5zKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBwajsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlbW92ZSBhbnkgam9pbnMgYWxyZWFkeSBpbiBvdXIgcGFy\nZW50IHNlbGVjdCBmcm9tIHRoZSBnaXZlbiBub24tZW1wdHkKICAgICAqIGpv\naW4gc2V0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlUGFyZW50\nSm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKF9wYXJlbnQgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChfcGFyZW50\nLl9qb2lucyAhPSBudWxsICYmICFfcGFyZW50Ll9qb2lucy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVkID0gZmFsc2U7CiAgICAg\nICAgICAgIGlmICghX3JlbW92ZWRBbGlhc0Zyb21QYXJlbnQuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBqLmpv\naW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgICAgIEpvaW4gam4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc1ZhbHVlKG5ldyBJ\nbnRlZ2VyKGpuLmdldEluZGV4MSgpKSkpCiAgICAgICAgICAgICAgICAgICAg\nICAgcmVtb3ZlZCA9IF9wYXJlbnQuX2pvaW5zLmpvaW5zKCkucmVtb3ZlKGpu\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAoIXJlbW92ZWQpCiAgICAgICAgICAgICAgICBwai5qb2lucygpLnJl\nbW92ZUFsbChfcGFyZW50Ll9qb2lucy5qb2lucygpKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKCFwai5pc0VtcHR5KCkpCiAgICAgICAgICAgIF9wYXJlbnQu\ncmVtb3ZlUGFyZW50Sm9pbnMocGopOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVtb3ZlIHRoZSBnaXZlbiBub24tZW1wdHkgam9pbnMgZnJvbSB0aGUgam9p\nbnMgb2Ygb3VyIHN1YnNlbGVjdHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCByZW1vdmVKb2luc0Zyb21TdWJzZWxlY3RzKFBhdGhKb2lucyBwaikgewog\nICAgICAgIGlmIChfc3Vic2VscyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgU2VsZWN0SW1wbCBzdWI7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBfc3Vic2Vscy5zaXplKCk7IGkrKykgewogICAgICAgICAg\nICBzdWIgPSAoU2VsZWN0SW1wbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAg\nICAgICBpZiAoc3ViLl9qb2lucyAhPSBudWxsICYmICFzdWIuX2pvaW5zLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgIHN1Yi5fam9pbnMuam9pbnMoKS5y\nZW1vdmVBbGwocGouam9pbnMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBTZWxlY3RFeGVjdXRvciB3aGVyZUNsb25lKGludCBzZWxzKSB7CiAg\nICAgICAgaWYgKHNlbHMgPCAxKQogICAgICAgICAgICBzZWxzID0gMTsKCiAg\nICAgICAgU2VsZWN0W10gY2xvbmVzID0gbnVsbDsKICAgICAgICBTZWxlY3RJ\nbXBsIHNlbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlbHM7IGkr\nKykgewogICAgICAgICAgICBzZWwgPSAoU2VsZWN0SW1wbCkgX2NvbmYuZ2V0\nU1FMRmFjdG9yeUluc3RhbmNlKCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAg\nIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAgICAgIHNlbC5fZmxhZ3Mg\nJj0gfkFHR1JFR0FURTsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+T1VU\nRVI7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkxSUzsKICAgICAgICAg\nICAgc2VsLl9mbGFncyAmPSB+RUFHRVJfVE9fT05FOwogICAgICAgICAgICBz\nZWwuX2ZsYWdzICY9IH5FQUdFUl9UT19NQU5ZOwogICAgICAgICAgICBzZWwu\nX2ZsYWdzICY9IH5GT1JDRV9DT1VOVDsKICAgICAgICAgICAgc2VsLl9qb2lu\nU3ludGF4ID0gX2pvaW5TeW50YXg7CiAgICAgICAgICAgIGlmIChfYWxpYXNl\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2VsLl9hbGlhc2VzID0gbmV3\nIEhhc2hNYXAoX2FsaWFzZXMpOwogICAgICAgICAgICBpZiAoX3RhYmxlcyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgc2VsLl90YWJsZXMgPSBuZXcgVHJl\nZU1hcChfdGFibGVzKTsKICAgICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgc2VsLl9qb2lucyA9IF9qb2lucy5jbG9uZShz\nZWwpOwogICAgICAgICAgICBpZiAoX3doZXJlICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBzZWwuX3doZXJlID0gbmV3IFNRTEJ1ZmZlcihfd2hlcmUpOwog\nICAgICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgc2VsLl9mcm9tID0gKFNlbGVjdEltcGwpIF9mcm9tLndoZXJlQ2xvbmUo\nMSk7CiAgICAgICAgICAgICAgICBzZWwuX2Zyb20uX291dGVyID0gc2VsOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBzZWwuX3N1YnNlbHMgPSBuZXcgQXJyYXlM\naXN0KF9zdWJzZWxzLnNpemUoKSk7CiAgICAgICAgICAgICAgICBTZWxlY3RJ\nbXBsIHN1Yiwgc2VsU3ViOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9\nIDA7IGogPCBfc3Vic2Vscy5zaXplKCk7IGorKykgewogICAgICAgICAgICAg\nICAgICAgIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaik7CiAg\nICAgICAgICAgICAgICAgICAgc2VsU3ViID0gKFNlbGVjdEltcGwpIHN1Yi5m\ndWxsQ2xvbmUoMSk7CiAgICAgICAgICAgICAgICAgICAgc2VsU3ViLl9wYXJl\nbnQgPSBzZWw7CiAgICAgICAgICAgICAgICAgICAgc2VsU3ViLl9zdWJQYXRo\nID0gc3ViLl9zdWJQYXRoOwogICAgICAgICAgICAgICAgICAgIHNlbC5fc3Vi\nc2Vscy5hZGQoc2VsU3ViKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2Vs\nLl93aGVyZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWwu\nX3doZXJlLnJlcGxhY2Uoc3ViLCBzZWxTdWIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VscyA9PSAxKQog\nICAgICAgICAgICAgICAgcmV0dXJuIHNlbDsKICAgICAgICAgICAgaWYgKGNs\nb25lcyA9PSBudWxsKQogICAgICAgICAgICAgICAgY2xvbmVzID0gbmV3IFNl\nbGVjdFtzZWxzXTsKICAgICAgICAgICAgY2xvbmVzW2ldID0gc2VsOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3Rh\nbmNlKCkubmV3VW5pb24oY2xvbmVzKTsKICAgIH0KCiAgICBwdWJsaWMgU2Vs\nZWN0RXhlY3V0b3IgZnVsbENsb25lKGludCBzZWxzKSB7CiAgICAgICAgaWYg\nKHNlbHMgPCAxKQogICAgICAgICAgICBzZWxzID0gMTsKCiAgICAgICAgU2Vs\nZWN0W10gY2xvbmVzID0gbnVsbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlbHM7IGkrKykgewogICAg\nICAgICAgICBzZWwgPSAoU2VsZWN0SW1wbCkgd2hlcmVDbG9uZSgxKTsKICAg\nICAgICAgICAgc2VsLl9mbGFncyA9IF9mbGFnczsKICAgICAgICAgICAgc2Vs\nLl9leHBlY3RlZFJlc3VsdENvdW50ID0gX2V4cGVjdGVkUmVzdWx0Q291bnQ7\nCiAgICAgICAgICAgIHNlbC5fc2VsZWN0cy5hZGRBbGwoX3NlbGVjdHMpOwog\nICAgICAgICAgICBpZiAoX29yZGVyaW5nICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBzZWwuX29yZGVyaW5nID0gbmV3IFNRTEJ1ZmZlcihfb3JkZXJpbmcp\nOwogICAgICAgICAgICBzZWwuX29yZGVycyA9IF9vcmRlcnM7CiAgICAgICAg\nICAgIGlmIChfZ3JvdXBpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNl\nbC5fZ3JvdXBpbmcgPSBuZXcgU1FMQnVmZmVyKF9ncm91cGluZyk7CiAgICAg\nICAgICAgIGlmIChfaGF2aW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nZWwuX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIoX2hhdmluZyk7CiAgICAgICAg\nICAgIGlmIChfZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzZWwu\nX2Zyb20gPSAoU2VsZWN0SW1wbCkgX2Zyb20uZnVsbENsb25lKDEpOwogICAg\nICAgICAgICAgICAgc2VsLl9mcm9tLl9vdXRlciA9IHNlbDsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKHNlbHMgPT0gMSkKICAgICAgICAgICAg\nICAgIHJldHVybiBzZWw7CiAgICAgICAgICAgIGlmIChjbG9uZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107\nCiAgICAgICAgICAgIGNsb25lc1tpXSA9IHNlbDsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1Vu\naW9uKGNsb25lcyk7CiAgICB9CgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9y\nIGVhZ2VyQ2xvbmUoRmllbGRNYXBwaW5nIGtleSwgaW50IGVhZ2VyVHlwZSwK\nICAgICAgICBib29sZWFuIHRvTWFueSwgaW50IHNlbHMpIHsKICAgICAgICBp\nZiAoZWFnZXJUeXBlID09IEVBR0VSX09VVEVSCiAgICAgICAgICAgICYmIF9q\nb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChfZWFnZXJL\nZXlzICE9IG51bGwgJiYgX2VhZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gZ2xvYmFsIHNldCBv\nZiBlYWdlciBrZXlzCiAgICAgICAgaWYgKF9lYWdlcktleXMgPT0gbnVsbCkK\nICAgICAgICAgICAgX2VhZ2VyS2V5cyA9IG5ldyBIYXNoU2V0KCk7CiAgICAg\nICAgX2VhZ2VyS2V5cy5hZGQoa2V5KTsKCiAgICAgICAgU2VsZWN0RXhlY3V0\nb3Igc2VsOwogICAgICAgIGlmIChlYWdlclR5cGUgIT0gRUFHRVJfUEFSQUxM\nRUwpIHsKICAgICAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAgICAgICAg\nIF9mbGFncyB8PSBFQUdFUl9UT19NQU5ZOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBfZmxhZ3MgfD0gRUFHRVJfVE9fT05FOwogICAgICAg\nICAgICBzZWwgPSB0aGlzOwogICAgICAgIH0gZWxzZSBpZiAoc2VscyA8IDIp\nCiAgICAgICAgICAgIHNlbCA9IHBhcmFsbGVsQ2xvbmUoKTsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgU2VsZWN0W10gY2xvbmVzID0gbmV3IFNlbGVj\ndFtzZWxzXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbG9u\nZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjbG9uZXNbaV0gPSBw\nYXJhbGxlbENsb25lKCk7CiAgICAgICAgICAgIHNlbCA9IF9jb25mLmdldFNR\nTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25lcyk7CiAgICAgICAg\nfQoKICAgICAgICBpZiAoX2VhZ2VyID09IG51bGwpCiAgICAgICAgICAgIF9l\nYWdlciA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2VhZ2VyLnB1dCh0b0Vh\nZ2VyS2V5KGtleSwgZ2V0Sm9pbnMobnVsbCwgZmFsc2UpKSwgc2VsKTsKICAg\nICAgICByZXR1cm4gc2VsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgY2xvbmUgb2YgdGhpcyBzZWxlY3QgZm9yIHVzZSBpbiBlYWdlciBwYXJh\nbGxlbCBzZWxlY3RzLgogICAgICovCiAgICBwcml2YXRlIFNlbGVjdEltcGwg\ncGFyYWxsZWxDbG9uZSgpIHsKICAgICAgICBTZWxlY3RJbXBsIHNlbCA9IChT\nZWxlY3RJbXBsKSB3aGVyZUNsb25lKDEpOwogICAgICAgIHNlbC5fZmxhZ3Mg\nJj0gfk5PTkFVVE9fRElTVElOQ1Q7CiAgICAgICAgc2VsLl9lYWdlcktleXMg\nPSBfZWFnZXJLZXlzOwogICAgICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAm\nJiAhX3ByZUpvaW5zLmlzRW1wdHkoKSkgewogICAgICAgICAgICBzZWwuX3By\nZUpvaW5zID0gbmV3IFN0YWNrKCk7CiAgICAgICAgICAgIHNlbC5fcHJlSm9p\nbnMucHVzaCgoKFNlbGVjdEpvaW5zKSBfcHJlSm9pbnMucGVlaygpKS4KICAg\nICAgICAgICAgICAgIGNsb25lKHNlbCkpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gc2VsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHZpZXcg\nb2YgZWFnZXIgc2VsZWN0cy4gTWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHB1\nYmxpYyBNYXAgZ2V0RWFnZXJNYXAoKSB7CiAgICAgICAgcmV0dXJuIF9lYWdl\ncjsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3IgZ2V0RWFnZXIo\nRmllbGRNYXBwaW5nIGtleSkgewogICAgICAgIGlmIChfZWFnZXIgPT0gbnVs\nbCB8fCAhX2VhZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKFNlbGVjdEV4ZWN1dG9yKSBf\nZWFnZXIuZ2V0KHRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsLAogICAg\nICAgICAgICBmYWxzZSkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZWFnZXIga2V5IHRvIHVzZSBmb3IgdGhlIHVzZXItZ2l2ZW4ga2V5\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgdG9FYWdlcktl\neShGaWVsZE1hcHBpbmcga2V5LCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBp\nZiAocGogPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGtleTsKICAgICAgICByZXR1cm4gbmV3IEtleShwai5wYXRo\nKCkudG9TdHJpbmcoKSwga2V5KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nbmV3Sm9pbnMoKSB7CiAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYm\nICFfcHJlSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIFNlbGVjdEpv\naW5zIHNqID0gKFNlbGVjdEpvaW5zKSBfcHJlSm9pbnMucGVlaygpOwogICAg\nICAgICAgICByZXR1cm4gc2ouY2xvbmUodGhpcyk7CiAgICAgICAgfQogICAg\nICAgIC8vIHJldHVybiB0aGlzIGZvciBlZmZpY2llbmN5IGluIGNhc2Ugbm8g\nam9pbnMgZW5kIHVwIGJlaW5nIG1hZGUKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgbmV3T3V0ZXJKb2lucygpIHsKICAg\nICAgICByZXR1cm4gKChQYXRoSm9pbnMpIG5ld0pvaW5zKCkpLnNldE91dGVy\nKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZChTUUxCdWZm\nZXIgYnVmLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChqb2lucyA9PSBu\ndWxsIHx8IGpvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpZiAoIWJ1Zi5pc0VtcHR5KCkpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBBTkQgIik7CiAgICAgICAgSm9pbiBqb2luID0gbnVsbDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9ICgoUGF0aEpvaW5zKSBqb2lucyku\nam9pbnMoKS5qb2luSXRlcmF0b3IoKTsKICAgICAgICAgICAgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgp\nOwogICAgICAgICAgICBzd2l0Y2ggKF9qb2luU3ludGF4KSB7CiAgICAgICAg\nICAgICAgICBjYXNlIEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUw6\nCiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfZGljdC50b1RyYWRp\ndGlvbmFsSm9pbihqb2luKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIEpvaW5TeW50YXhlcy5TWU5UQVhfREFU\nQUJBU0U6CiAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZChfZGljdC50\nb05hdGl2ZUpvaW4oam9pbikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgSm9pbnMgYW5kKEpvaW5zIGpvaW5zMSwgSm9pbnMgam9pbnMy\nKSB7CiAgICAgICAgcmV0dXJuIGFuZCgoUGF0aEpvaW5zKSBqb2luczEsIChQ\nYXRoSm9pbnMpIGpvaW5zMiwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb21iaW5lIHRoZSBnaXZlbiBqb2lucy4KICAgICAqLwogICAgcHJpdmF0\nZSBTZWxlY3RKb2lucyBhbmQoUGF0aEpvaW5zIGoxLCBQYXRoSm9pbnMgajIs\nIGJvb2xlYW4gbnVsbEpvaW5zKSB7CiAgICAgICAgaWYgKChqMSA9PSBudWxs\nIHx8IGoxLmlzRW1wdHkoKSkKICAgICAgICAgICAgJiYgKGoyID09IG51bGwg\nfHwgajIuaXNFbXB0eSgpKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIFNlbGVjdEpvaW5zIHNqID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nOwogICAgICAgIGlmIChqMSA9PSBudWxsIHx8IGoxLmlzRW1wdHkoKSkgewog\nICAgICAgICAgICBpZiAobnVsbEpvaW5zKQogICAgICAgICAgICAgICAgc2ou\nc2V0Sm9pbnMoajIuam9pbnMoKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIHNqLnNldEpvaW5zKG5ldyBKb2luU2V0KGoyLmpvaW5zKCkp\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBKb2luU2V0IHNldDsK\nICAgICAgICAgICAgaWYgKG51bGxKb2lucykKICAgICAgICAgICAgICAgIHNl\ndCA9IGoxLmpvaW5zKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHNldCA9IG5ldyBKb2luU2V0KGoxLmpvaW5zKCkpOwoKICAgICAgICAg\nICAgaWYgKGoyICE9IG51bGwgJiYgIWoyLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgIHNldC5hZGRBbGwoajIuam9pbnMoKSk7CiAgICAgICAgICAgIHNq\nLnNldEpvaW5zKHNldCk7CiAgICAgICAgfQoKICAgICAgICAvLyBudWxsIHBy\nZXZpb3VzIGpvaW5zOyBhbGwgYXJlIGNvbWJpbmVkIGludG8gdGhpcyBvbmUK\nICAgICAgICBpZiAobnVsbEpvaW5zICYmIGoxICE9IG51bGwpCiAgICAgICAg\nICAgIGoxLm51bGxKb2lucygpOwogICAgICAgIGlmIChudWxsSm9pbnMgJiYg\najIgIT0gbnVsbCkKICAgICAgICAgICAgajIubnVsbEpvaW5zKCk7CgogICAg\nICAgIHJldHVybiBzajsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3IoSm9p\nbnMgam9pbnMxLCBKb2lucyBqb2luczIpIHsKICAgICAgICBQYXRoSm9pbnMg\najEgPSAoUGF0aEpvaW5zKSBqb2luczE7CiAgICAgICAgUGF0aEpvaW5zIGoy\nID0gKFBhdGhKb2lucykgam9pbnMyOwoKICAgICAgICAvLyBpZiBubyBjb21t\nb24gam9pbnMsIHJldHVybiBudWxsOyBpZiBvbmUgc2lkZSBvZiB0aGUgb3Ig\nY2xhdXNlIGhhcwogICAgICAgIC8vIGRpZmZlcmVudCBqb2lucyB0aGFuIHRo\nZSBvdGhlciwgdGhlbiB3ZSBuZWVkIHRvIHVzZSBkaXN0aW5jdAogICAgICAg\nIGJvb2xlYW4gajFFbXB0eSA9IGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgp\nOwogICAgICAgIGJvb2xlYW4gajJFbXB0eSA9IGoyID09IG51bGwgfHwgajIu\naXNFbXB0eSgpOwogICAgICAgIGlmIChqMUVtcHR5IHx8IGoyRW1wdHkpIHsK\nICAgICAgICAgICAgaWYgKGoxRW1wdHkgJiYgIWoyRW1wdHkpIHsKICAgICAg\nICAgICAgICAgIGNvbGxlY3RPdXRlckpvaW5zKGoyKTsKICAgICAgICAgICAg\nICAgIGlmICghajIuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIF9m\nbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChqMkVtcHR5ICYmICFqMUVtcHR5KSB7CiAgICAgICAgICAgICAgICBj\nb2xsZWN0T3V0ZXJKb2lucyhqMSk7CiAgICAgICAgICAgICAgICBpZiAoIWox\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gSU1Q\nTElDSVRfRElTVElOQ1Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBhbGwgY29tbW9u\nIGpvaW5zLCBtb3ZlIGFsbCBqb2lucyB0byByZXR1cm5lZCBpbnN0YW5jZQog\nICAgICAgIFNlbGVjdEpvaW5zIHNqID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nOwogICAgICAgIGlmIChqMS5qb2lucygpLmVxdWFscyhqMi5qb2lucygpKSkg\newogICAgICAgICAgICBzai5zZXRKb2lucyhqMS5qb2lucygpKTsKICAgICAg\nICAgICAgajEubnVsbEpvaW5zKCk7CiAgICAgICAgICAgIGoyLm51bGxKb2lu\ncygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpvaW5TZXQgY29t\nbW9uSm9pbnMgPSBuZXcgSm9pblNldChqMS5qb2lucygpKTsKICAgICAgICAg\nICAgY29tbW9uSm9pbnMucmV0YWluQWxsKGoyLmpvaW5zKCkpOwogICAgICAg\nICAgICBpZiAoIWNvbW1vbkpvaW5zLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgLy8gcHV0IGNvbW1vbiBqb2lucyBpbiByZXR1cm5lZCBpbnN0YW5j\nZTsgcmVtb3ZlIHRoZW0gZnJvbQogICAgICAgICAgICAgICAgLy8gZWFjaCBn\naXZlbiBpbnN0YW5jZQogICAgICAgICAgICAgICAgc2ouc2V0Sm9pbnMoY29t\nbW9uSm9pbnMpOwogICAgICAgICAgICAgICAgajEuam9pbnMoKS5yZW1vdmVB\nbGwoY29tbW9uSm9pbnMpOwogICAgICAgICAgICAgICAgajIuam9pbnMoKS5y\nZW1vdmVBbGwoY29tbW9uSm9pbnMpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNvbGxlY3RPdXRlckpvaW5zKGoxKTsKICAgICAgICAgICAgY29sbGVj\ndE91dGVySm9pbnMoajIpOwoKICAgICAgICAgICAgLy8gaWYgb25lIHNpZGUg\nb2YgdGhlIG9yIGNsYXVzZSBoYXMgZGlmZmVyZW50IGpvaW5zIHRoYW4gdGhl\nIG90aGVyLAogICAgICAgICAgICAvLyB0aGVuIHdlIG5lZWQgdG8gdXNlIGRp\nc3RpbmN0CiAgICAgICAgICAgIGlmICghajEuaXNFbXB0eSgpIHx8ICFqMi5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gSU1QTElDSVRf\nRElTVElOQ1Q7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzajsKICAgIH0K\nCiAgICBwdWJsaWMgSm9pbnMgb3V0ZXIoSm9pbnMgam9pbnMpIHsKICAgICAg\nICBpZiAoX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFE\nSVRJT05BTCB8fCBqb2lucyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nam9pbnM7CgogICAgICAgIC8vIHJlY29yZCB0aGF0IHRoaXMgaXMgYW4gb3V0\nZXIgam9pbiBzZXQsIGV2ZW4gaWYgaXQncyBlbXB0eQogICAgICAgIFBhdGhK\nb2lucyBwaiA9ICgoUGF0aEpvaW5zKSBqb2lucykuc2V0T3V0ZXIodHJ1ZSk7\nCiAgICAgICAgaWYgKHBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nIHBqOwoKICAgICAgICBKb2luIGpvaW47CiAgICAgICAgSm9pbiByZWM7CiAg\nICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IF9qb2lucyAhPSBudWxsICYmIF9q\nb2lucy5qb2lucygpICE9IG51bGw7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBwai5qb2lucygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgaWYgKGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikg\newogICAgICAgICAgICAgICAgaWYgKCFoYXNKb2lucykKICAgICAgICAgICAg\nICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5UWVBFX09VVEVSKTsKICAgICAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlYyA9IF9q\nb2lucy5qb2lucygpLmdldFJlY29yZGVkSm9pbihqb2luKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocmVjID09IG51bGwgfHwgcmVjLmdldFR5cGUoKSA9\nPSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAgICAgICAgICAgICAgICAgIGpv\naW4uc2V0VHlwZShKb2luLlRZUEVfT1VURVIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBqb2lu\nczsKICAgIH0KCiAgICAvKioKICAgICAqIE1vdmVzIHRoZSBqb2lucyBmcm9t\nIHRoZSBnaXZlbiBpbnN0YW5jZSBpbnRvIG91ciBvdXRlciBqb2lucyBzZXQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjb2xsZWN0T3V0ZXJKb2lucyhQ\nYXRoSm9pbnMgcGopIHsKICAgICAgICBpZiAoX2pvaW5TeW50YXggPT0gSm9p\nblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTCB8fCBwaiA9PSBudWxsCiAg\nICAgICAgICAgIHx8IHBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBpZiAoX2pvaW5zID09IG51bGwpCiAgICAgICAgICAgIF9q\nb2lucyA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKCiAgICAgICAgYm9vbGVh\nbiBhZGQgPSB0cnVlOwogICAgICAgIGlmIChfam9pbnMuam9pbnMoKSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIF9qb2lucy5zZXRKb2lucyhwai5qb2lucygp\nKTsKICAgICAgICAgICAgYWRkID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICBKb2luIGpvaW47CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBwai5q\nb2lucygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYg\nKGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5FUikgewogICAgICAg\nICAgICAgICAgaWYgKGpvaW4uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwKICAg\nICAgICAgICAgICAgICAgICAmJiAhX2RpY3QuY2FuT3V0ZXJKb2luKF9qb2lu\nU3ludGF4LCBqb2luLmdldEZvcmVpZ25LZXkoKSkpIHsKICAgICAgICAgICAg\nICAgICAgICBMb2cgbG9nID0gX2NvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0\naW9uLkxPR19KREJDKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlz\nV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndh\ncm4oX2xvYy5nZXQoImNhbnQtb3V0ZXItZmsiLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgam9pbi5nZXRGb3JlaWduS2V5KCkpKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGpvaW4uc2V0VHlw\nZShKb2luLlRZUEVfT1VURVIpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChhZGQpCiAgICAgICAgICAgICAgICBfam9pbnMuam9pbnMoKS5hZGQo\nam9pbik7CiAgICAgICAgfQogICAgICAgIHBqLm51bGxKb2lucygpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhlIGdp\ndmVuIHRhYmxlIHVuZGVyIHRoZSBnaXZlbiBqb2lucy4KICAgICAqIE5PVEU6\nIFdFIFJFTFkgT04gVEhFU0UgSU5ERVhFUyBCRUlORyBNT05PVE9OSUNBTExZ\nIElOQ1JFQVNJTkcgRlJPTSAwCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGdl\ndFRhYmxlSW5kZXgoVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaiwgYm9vbGVh\nbiBjcmVhdGUpIHsKICAgICAgICAvLyBpZiB3ZSBoYXZlIGEgZnJvbSBzZWxl\nY3QsIHRoZW4gdGhlcmUgYXJlIG5vIHRhYmxlIGFsaWFzZXMKICAgICAgICBp\nZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIC0xOwoKICAg\nICAgICBPYmplY3Qga2V5ID0gdGFibGUuZ2V0RnVsbE5hbWUoKTsKICAgICAg\nICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAg\nICAgICAga2V5ID0gbmV3IEtleShwai5wYXRoKCkudG9TdHJpbmcoKSwga2V5\nKTsKCiAgICAgICAgLy8gY2hlY2sgb3V0IGV4aXN0aW5nIGFsaWFzZXMKICAg\nICAgICBJbnRlZ2VyIGkgPSBmaW5kQWxpYXModGFibGUsIGtleSwgZmFsc2Us\nIG51bGwpOwogICAgICAgIGlmIChpICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBpLmludFZhbHVlKCk7CiAgICAgICAgaWYgKCFjcmVhdGUpCiAgICAg\nICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgLy8gbm90IGZvdW5kOyBjcmVh\ndGUgYWxpYXMKICAgICAgICBpID0gTnVtYmVycy52YWx1ZU9mKGFsaWFzU2l6\nZSgpKTsKICAgICAgICByZWNvcmRUYWJsZUFsaWFzKHRhYmxlLCBrZXksIGkp\nOwogICAgICAgIHJldHVybiBpLmludFZhbHVlKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBdHRlbXB0IHRvIGZpbmQgdGhlIGFsaWFzIGZvciB0aGUgZ2l2\nZW4ga2V5LgogICAgICoKICAgICAqIEBwYXJhbSBmcm9tUGFyZW50IHdoZXRo\nZXIgYSBwYXJlbnQgaXMgY2hlY2tpbmcgaXRzIHN1YnNlbGVjdHMKICAgICAq\nIEBwYXJhbSBmcm9tU3ViIHRoZSBzdWJzZWxlY3QgY2hlY2tpbmcgaXRzIHBh\ncmVudAogICAgICovCiAgICBwcml2YXRlIEludGVnZXIgZmluZEFsaWFzKFRh\nYmxlIHRhYmxlLCBPYmplY3Qga2V5LCBib29sZWFuIGZyb21QYXJlbnQsCiAg\nICAgICAgU2VsZWN0SW1wbCBmcm9tU3ViKSB7CiAgICAgICAgSW50ZWdlciBh\nbGlhcyA9IG51bGw7CiAgICAgICAgaWYgKF9hbGlhc2VzICE9IG51bGwpIHsK\nICAgICAgICAgICAgYWxpYXMgPSAoSW50ZWdlcikgKChmcm9tUGFyZW50KSA/\nIF9hbGlhc2VzLnJlbW92ZShrZXkpCiAgICAgICAgICAgICAgICA6IF9hbGlh\nc2VzLmdldChrZXkpKTsKICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGlmIChmcm9tUGFyZW50KQogICAgICAgICAg\nICAgICAgICAgIF90YWJsZXMucmVtb3ZlKGFsaWFzKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBhbGlhczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoIWZyb21QYXJlbnQgJiYgX3BhcmVudCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGJvb2xlYW4gcmVtb3ZlQWxpYXNGcm9tUGFyZW50ID0ga2V5\nLnRvU3RyaW5nKCkuaW5kZXhPZigiOiIpICE9IC0xOwogICAgICAgICAgICBh\nbGlhcyA9IF9wYXJlbnQuZmluZEFsaWFzKHRhYmxlLCBrZXksIHJlbW92ZUFs\naWFzRnJvbVBhcmVudCwgdGhpcyk7CiAgICAgICAgICAgIGlmIChhbGlhcyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVtb3ZlQWxpYXNGcm9t\nUGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmVjb3JkVGFibGVBbGlh\ncyh0YWJsZSwga2V5LCBhbGlhcyk7CiAgICAgICAgICAgICAgICAgICAgX3Jl\nbW92ZWRBbGlhc0Zyb21QYXJlbnQuc2V0KGFsaWFzLmludFZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFz\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChfc3Vic2Vs\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgIFNlbGVjdEltcGwgc3ViOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9zdWJzZWxzLnNpemUoKTsg\naSsrKSB7CiAgICAgICAgICAgICAgICBzdWIgPSAoU2VsZWN0SW1wbCkgX3N1\nYnNlbHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgaWYgKHN1YiA9PSBmcm9t\nU3ViKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoc3ViLl9hbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHN1Yi5fYWxpYXNlcy5yZW1vdmUoa2V5KTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoc3ViLl90YWJsZXMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgc3ViLl90YWJsZXMucmVtb3ZlKGFsaWFzKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtl\neSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICAgICAgICAgICAg\nICBhbGlhcyA9IHN1Yi5maW5kQWxpYXModGFibGUsIGtleSwgdHJ1ZSwgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZnJvbVBhcmVudCAm\nJiBhbGlhcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBhbGlhcyk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBhbGlhczsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlY29yZCB0aGUgbWFwcGluZyBvZiB0aGUgZ2l2ZW4ga2V5\nIHRvIHRoZSBnaXZlbiBhbGlhcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHJlY29yZFRhYmxlQWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXksIElu\ndGVnZXIgYWxpYXMpIHsKICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVsbCkK\nICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAg\nIF9hbGlhc2VzLnB1dChrZXksIGFsaWFzKTsKCiAgICAgICAgU3RyaW5nIHRh\nYmxlU3RyaW5nID0gX2RpY3QuZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSAr\nICIgIgogICAgICAgICAgICArIHRvQWxpYXMoYWxpYXMuaW50VmFsdWUoKSk7\nCiAgICAgICAgaWYgKF90YWJsZXMgPT0gbnVsbCkKICAgICAgICAgICAgX3Rh\nYmxlcyA9IG5ldyBUcmVlTWFwKCk7CiAgICAgICAgX3RhYmxlcy5wdXQoYWxp\nYXMsIHRhYmxlU3RyaW5nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGN1\nbGF0ZSB0b3RhbCBudW1iZXIgb2YgYWxpYXNlcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBpbnQgYWxpYXNTaXplKCkgewogICAgICAgIHJldHVybiBhbGlhc1Np\nemUoZmFsc2UsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3Vs\nYXRlIHRvdGFsIG51bWJlciBvZiBhbGlhc2VzLgogICAgICoKICAgICAqIEBw\nYXJhbSBmcm9tUGFyZW50IHdoZXRoZXIgYSBwYXJlbnQgaXMgY2hlY2tpbmcg\naXRzIHN1YnNlbGVjdHMKICAgICAqIEBwYXJhbSBmcm9tU3ViIHRoZSBzdWJz\nZWxlY3QgY2hlY2tpbmcgaXRzIHBhcmVudAogICAgICovCiAgICBwcml2YXRl\nIGludCBhbGlhc1NpemUoYm9vbGVhbiBmcm9tUGFyZW50LCBTZWxlY3RJbXBs\nIGZyb21TdWIpIHsKICAgICAgICBpbnQgYWxpYXNlcyA9IChmcm9tUGFyZW50\nIHx8IF9wYXJlbnQgPT0gbnVsbCkgPyAwCiAgICAgICAgICAgIDogX3BhcmVu\ndC5hbGlhc1NpemUoZmFsc2UsIHRoaXMpOwogICAgICAgIGFsaWFzZXMgKz0g\nKF9hbGlhc2VzID09IG51bGwpID8gMCA6IF9hbGlhc2VzLnNpemUoKTsKICAg\nICAgICBpZiAoX3N1YnNlbHMgIT0gbnVsbCkgewogICAgICAgICAgICBTZWxl\nY3RJbXBsIHN1YjsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\nc3Vic2Vscy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgc3ViID0g\nKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAgICAgICAg\nIGlmIChzdWIgIT0gZnJvbVN1YikKICAgICAgICAgICAgICAgICAgICBhbGlh\nc2VzICs9IHN1Yi5hbGlhc1NpemUodHJ1ZSwgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzZXM7CiAgICB9Cgog\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4g\ndG9TZWxlY3QoZmFsc2UsIG51bGwpLmdldFNRTCgpOwogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFBhdGhKb2lucyBp\nbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLwoKICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0\nZXIoYm9vbGVhbiBvdXRlcikgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0\nSm9pbnModGhpcykuc2V0T3V0ZXIodHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBKb2luU2V0IGpvaW5z\nKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgam9pbkNvdW50KCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJs\nZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZWxlY3RKb2lucyh0aGlzKS5jcm9zc0pvaW4obG9jYWxUYWJsZSwgZm9yZWln\nblRhYmxlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWdu\nS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5qb2luKGZrLCBp\nbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRl\nckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFu\nIHRvTWFueSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnModGhp\ncykub3V0ZXJKb2luKGZrLCBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAg\nIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVp\nZ25LZXkgZmssIENsYXNzTWFwcGluZyB0YXJnZXQsCiAgICAgICAgaW50IHN1\nYnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAg\nICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW5SZWxhdGlvbihu\nYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJzZSwg\ndG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVs\nYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAgIENs\nYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RK\nb2lucyh0aGlzKS5vdXRlckpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0\nLCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAgIH0K\nCiAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewog\nICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5zZXRW\nYXJpYWJsZSh2YXIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBzZXRTdWJz\nZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgaWYgKGFsaWFzID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVybiBu\nZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0U3Vic2VsZWN0KGFsaWFzKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSBTUUwgc3RyaW5nIHNl\nbGVjdGVkIHdpdGggbnVsbCBpZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTnVsbElkIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJl\nc2VudHMgYSBwbGFjZWhvbGRlciBTUUwgc3RyaW5nLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBQbGFjZWhvbGRlciB7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBLZXkgdHlwZSB1c2VkIGZvciBhbGlhc2VzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBLZXkgewoKICAgICAgICBwcml2\nYXRlIGZpbmFsIFN0cmluZyBfcGF0aDsKICAgICAgICBwcml2YXRlIGZpbmFs\nIE9iamVjdCBfa2V5OwoKICAgICAgICBwdWJsaWMgS2V5KFN0cmluZyBwYXRo\nLCBPYmplY3Qga2V5KSB7CiAgICAgICAgICAgIF9wYXRoID0gcGF0aDsKICAg\nICAgICAgICAgX2tleSA9IGtleTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcGF0aC5o\nYXNoQ29kZSgpIF4gX2tleS5oYXNoQ29kZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAg\nICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICBpZiAob3RoZXIuZ2V0Q2xhc3MoKSAh\nPSBnZXRDbGFzcygpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICBLZXkgayA9IChLZXkpIG90aGVyOwogICAgICAgICAgICBy\nZXR1cm4gay5fcGF0aC5lcXVhbHMoX3BhdGgpICYmIGsuX2tleS5lcXVhbHMo\nX2tleSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3Ry\naW5nKCkgewogICAgICAgICAgICByZXR1cm4gX3BhdGggKyAifCIgKyBfa2V5\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEge0BsaW5rIFJl\nc3VsdH0gaW1wbGVtZW50YXRpb24gd3JhcHBlZCBhcm91bmQgdGhpcyBzZWxl\nY3QuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2VsZWN0UmVz\ndWx0CiAgICAgICAgZXh0ZW5kcyBSZXN1bHRTZXRSZXN1bHQKICAgICAgICBp\nbXBsZW1lbnRzIFBhdGhKb2lucyB7CgogICAgICAgIHByaXZhdGUgU2VsZWN0\nSW1wbCBfc2VsID0gbnVsbDsKCiAgICAgICAgLy8gcG9zaXRpb24gaW4gc2Vs\nZWN0ZWQgY29sdW1ucyBsaXN0IHdoZXJlIHdlIGV4cGVjdCB0aGUgbmV4dCBs\nb2FkCiAgICAgICAgcHJpdmF0ZSBpbnQgX3BvcyA9IDA7CiAgICAgICAgcHJp\ndmF0ZSBTdGFjayBfcHJlSm9pbnMgPSBudWxsOwoKICAgICAgICAvKioKICAg\nICAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgU2VsZWN0UmVzdWx0KENvbm5lY3Rpb24gY29ubiwgU3RhdGVtZW50IHN0\nbW50LCBSZXN1bHRTZXQgcnMsCiAgICAgICAgICAgIERCRGljdGlvbmFyeSBk\naWN0KSB7CiAgICAgICAgICAgIHN1cGVyKGNvbm4sIHN0bW50LCBycywgZGlj\ndCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3Qg\nZm9yIHRoaXMgcmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBT\nZWxlY3RJbXBsIGdldFNlbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9z\nZWw7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3Qg\nZm9yIHRoaXMgcmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2\nb2lkIHNldFNlbGVjdChTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAgICBf\nc2VsID0gc2VsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBn\nZXRFYWdlcihGaWVsZE1hcHBpbmcga2V5KSB7CiAgICAgICAgICAgIC8vIGRv\nbid0IGJvdGhlciBjcmVhdGluZyBrZXkgaWYgd2Uga25vdyB3ZSBkb24ndCBo\nYXZlIGFueQogICAgICAgICAgICAvLyBlYWdlciByZXN1bHRzCiAgICAgICAg\nICAgIGlmIChfc2VsLl9lYWdlciA9PSBudWxsIHx8ICFfc2VsLl9lYWdlcktl\neXMuY29udGFpbnMoa2V5KSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICBNYXAgbWFwID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0\nRWFnZXJNYXAodHJ1ZSk7CiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1\ncm4gbWFwLmdldChfc2VsLnRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxs\nKSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHV0RWFnZXIo\nRmllbGRNYXBwaW5nIGtleSwgT2JqZWN0IHJlcykgewogICAgICAgICAgICBN\nYXAgbWFwID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAodHJ1ZSk7\nCiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgbWFwID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHNldEVh\nZ2VyTWFwKG1hcCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFwLnB1\ndChfc2VsLnRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSksIHJlcyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGxvYWQoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICAgICAg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpCiAg\nICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBi\nb29sZWFuIGhhc0pvaW5zID0gam9pbnMgIT0gbnVsbAogICAgICAgICAgICAg\nICAgJiYgKChQYXRoSm9pbnMpIGpvaW5zKS5wYXRoKCkgIT0gbnVsbDsKICAg\nICAgICAgICAgaWYgKGhhc0pvaW5zKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX3ByZUpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3ByZUpv\naW5zID0gbmV3IFN0YWNrKCk7CiAgICAgICAgICAgICAgICBfcHJlSm9pbnMu\ncHVzaChqb2lucyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9iamVj\ndCBvYmogPSBzdXBlci5sb2FkKG1hcHBpbmcsIHN0b3JlLCBmZXRjaCwgam9p\nbnMpOwoKICAgICAgICAgICAgLy8gcmVzZXQKICAgICAgICAgICAgaWYgKGhh\nc0pvaW5zKQogICAgICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAg\nICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIEpvaW5zIG5ld0pvaW5zKCkgewogICAgICAgICAgICBQYXRoSm9pbnMgcHJl\nID0gZ2V0UHJlSm9pbnMoKTsKICAgICAgICAgICAgaWYgKHByZSA9PSBudWxs\nIHx8IHByZS5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwoKICAgICAgICAgICAgUGF0aEpvaW5zSW1wbCBwaiA9IG5ldyBQ\nYXRoSm9pbnNJbXBsKCk7CiAgICAgICAgICAgIHBqLnBhdGggPSBuZXcgU3Ry\naW5nQnVmZmVyKHByZS5wYXRoKCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAg\nIHJldHVybiBwajsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBib29s\nZWFuIGNvbnRhaW5zSW50ZXJuYWwoT2JqZWN0IG9iaiwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICAgICAgLy8gd2Uga2V5IGRpcmVjdGx5IG9uIG9ianMgYW5k\nIGpvaW4tbGVzcyBjb2xzLCBvciBvbiB0aGUgYWxpYXMKICAgICAgICAgICAg\nLy8gZm9yIGNvbHMgd2l0aCBqb2lucwogICAgICAgICAgICBQYXRoSm9pbnMg\ncGogPSBnZXRKb2lucyhqb2lucyk7CiAgICAgICAgICAgIGlmIChwaiAhPSBu\ndWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgb2Jq\nID0gZ2V0Q29sdW1uQWxpYXMoKENvbHVtbikgb2JqLCBwaik7CiAgICAgICAg\nICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBfc2VsLl9zZWxlY3RzLmNvbnRh\naW5zKG9iaik7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBjb250YWluc0FsbEludGVybmFsKE9iamVjdFtdIG9ianMsIEpvaW5zIGpv\naW5zKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAg\nICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG9ianMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChw\naiAhPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIG9iaiA9IGdldENvbHVtbkFsaWFzKChDb2x1bW4pIG9ianNbaV0s\nIHBqKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICBvYmogPSBvYmpzW2ldOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsIHx8ICFfc2VsLl9zZWxlY3RzLmNvbnRhaW5zKG9iaikpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgcHVzaEJhY2soKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAgIHN1cGVy\nLnB1c2hCYWNrKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBhYnNvbHV0ZUludGVybmFsKGludCByb3cpCiAgICAgICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBfcG9zID0gMDsKICAg\nICAgICAgICAgcmV0dXJuIHN1cGVyLmFic29sdXRlSW50ZXJuYWwocm93KTsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIG5leHRJbnRl\ncm5hbCgpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICBfcG9zID0gMDsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm5l\neHRJbnRlcm5hbCgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGlu\ndCBmaW5kT2JqZWN0KE9iamVjdCBvYmosIEpvaW5zIGpvaW5zKQogICAgICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF9w\nb3MgPT0gX3NlbC5fc2VsZWN0cy5zaXplKCkpCiAgICAgICAgICAgICAgICBf\ncG9zID0gMDsKCiAgICAgICAgICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBv\nYmpzIGFuZCBqb2luLWxlc3MgY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAg\nICAgICAgIC8vIGZvciBjb2xzIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0\naEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMpOwogICAgICAgICAgICBCb29s\nZWFuIHBrID0gbnVsbDsKICAgICAgICAgICAgaWYgKHBqICE9IG51bGwgJiYg\ncGoucGF0aCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENvbHVtbiBj\nb2wgPSAoQ29sdW1uKSBvYmo7CiAgICAgICAgICAgICAgICBwayA9IChjb2wu\naXNQcmltYXJ5S2V5KCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgICAgICAgICAgICAgIG9iaiA9IGdldENvbHVtbkFsaWFzKGNvbCwg\ncGopOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTUUxFeGNlcHRpb24oY29sLmdldFRh\nYmxlKCkgKyAiOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgcGoucGF0\naCgpICsgIiAoIiArIF9zZWwuX2FsaWFzZXMgKyAiKSIpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyB3ZSBsb2FkIGluIHRoZSBzYW1lIG9yZGVy\nIHdlIHNlbGVjdCwgbW9yZSBvciBsZXNzLi4uCiAgICAgICAgICAgIGlmIChf\nc2VsLl9zZWxlY3RzLmdldChfcG9zKS5lcXVhbHMob2JqKSkKICAgICAgICAg\nICAgICAgIHJldHVybiArK19wb3M7CgogICAgICAgICAgICAvLyBpZiB3ZSdy\nZSBsb29raW5nIGZvciBhIHByaW1hcnkga2V5LCB0cnkgYmFjayBhIGNvdXBs\nZSBwbGFjZXMsCiAgICAgICAgICAgIC8vIHNpbmNlIHBrcyBtaWdodCBiZSBz\nZWxlY3RlZCBpbiBhIHNsaWdodGx5IGRpZmZlcmVudCBvcmRlciB0aGFuCiAg\nICAgICAgICAgIC8vIHRoZXkgYXJlIGxvYWRlZCBiYWNrOyBkb24ndCBjaGFu\nZ2UgdGhlIG1hcmtlciBwb3NpdGlvbgogICAgICAgICAgICBpZiAocGsgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHBrID0gKG9iaiBpbnN0YW5jZW9mIENv\nbHVtbiAmJiAoKENvbHVtbikgb2JqKS5pc1ByaW1hcnlLZXkoKSkKICAgICAg\nICAgICAgICAgICAgICA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgIGlmIChway5ib29sZWFuVmFsdWUoKSkgewogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IF9wb3MgLSAxOyBpID49IDAgJiYgaSA+\nPSBfcG9zIC0gMzsgaS0tKQogICAgICAgICAgICAgICAgICAgIGlmIChfc2Vs\nLl9zZWxlY3RzLmdldChpKS5lcXVhbHMob2JqKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGkgKyAxOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBzZWFyY2ggZm9yd2FyZCBvbiB0aGUgYXNzdW1wdGlvbiB0aGF0\nIHdlIG1pZ2h0IGJlIHNraXBwaW5nCiAgICAgICAgICAgIC8vIHNlbGVjdHMg\nZm9yIHNpYmxpbmcgY2xhc3NlczsgYWR2YW5jZSB0aGUgcG9zaXRpb24gaWYg\nd2UgZmluZAogICAgICAgICAgICAvLyBzb21ldGhpbmcgZm9yd2FyZAogICAg\nICAgICAgICBmb3IgKGludCBpID0gX3BvcyArIDE7IGkgPCBfc2VsLl9zZWxl\nY3RzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoX3NlbC5f\nc2VsZWN0cy5nZXQoaSkuZXF1YWxzKG9iaikpIHsKICAgICAgICAgICAgICAg\nICAgICBfcG9zID0gaTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKytf\ncG9zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBtYXliZSB0aGUgY29sdW1uIHdhcyBzZWxlY3RlZCBieSAyIGRp\nZmZlcmVudCBtYXBwaW5ncywgc28gaXQncwogICAgICAgICAgICAvLyBzb21l\nd2hlcmUgcHJpb3IgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb247IGluIHRoaXMg\nY2FzZSBsZWF2ZSB0aGUKICAgICAgICAgICAgLy8gcG9zaXRpb24gbWFya2Vy\nIGF0IGl0cyBjdXJyZW50IHBsYWNlIGNhdXNlIHN1YnNlcXVlbnQgbG9hZHMg\nd2lsbAogICAgICAgICAgICAvLyBzdGlsbCBwcm9iYWJseSBzdGFydCBmcm9t\nIHRoZXJlCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX3Bvczsg\naSsrKQogICAgICAgICAgICAgICAgaWYgKF9zZWwuX3NlbGVjdHMuZ2V0KGkp\nLmVxdWFscyhvYmopKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsg\nMTsKCiAgICAgICAgICAgIC8vIHNvbWV0aGluZ3MncyB3cm9uZy4uLgogICAg\nICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKG9iai50b1N0cmluZygp\nKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0\naGUgam9pbnMgdG8gdXNlIHRvIGZpbmQgY29sdW1uIGRhdGEuCiAgICAgICAg\nICovCiAgICAgICAgcHJpdmF0ZSBQYXRoSm9pbnMgZ2V0Sm9pbnMoSm9pbnMg\nam9pbnMpIHsKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lu\ncykgam9pbnM7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBh\ndGgoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHBqOwogICAg\nICAgICAgICByZXR1cm4gZ2V0UHJlSm9pbnMoKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgcHJlIGpvaW5zIGZvciB0\naGUgcmVzdWx0LCBvciBudWxsIGlmIG5vbmUuIE5vdGUgdGhhdAogICAgICAg\nICAqIHdlIGhhdmUgdG8gdGFrZSB0aGUgU2VsZWN0J3MgcHJlIGpvaW5zIGlu\ndG8gYWNjb3VudCB0b28sIHNpbmNlCiAgICAgICAgICogYmF0Y2hlZCBzZWxl\nY3RzIGNhbiBoYXZlIGFkZGl0aW9uYWwgcHJlIGpvaW5zIG9uIHRoZSBzdGFj\nayBldmVuCiAgICAgICAgICogb24gZXhlY3V0aW9uLgogICAgICAgICAqLwog\nICAgICAgIHByaXZhdGUgUGF0aEpvaW5zIGdldFByZUpvaW5zKCkgewogICAg\nICAgICAgICBpZiAoX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lucy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gKFBhdGhKb2lucykg\nX3ByZUpvaW5zLnBlZWsoKTsKICAgICAgICAgICAgaWYgKF9zZWwuX3ByZUpv\naW5zICE9IG51bGwgJiYgIV9zZWwuX3ByZUpvaW5zLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgICAgIHJldHVybiAoUGF0aEpvaW5zKSBfc2VsLl9wcmVKb2lu\ncy5wZWVrKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBhbGlhcyB1c2Vk\nIHRvIGtleSBvbiB0aGUgY29sdW1uIGRhdGEsIGNvbnNpZGVyaW5nIHRoZQog\nICAgICAgICAqIGdpdmVuIGpvaW5zLgogICAgICAgICAqLwogICAgICAgIHBy\naXZhdGUgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIFBhdGhK\nb2lucyBwaikgewogICAgICAgICAgICBTdHJpbmcgYWxpYXM7CiAgICAgICAg\nICAgIGlmIChfc2VsLl9mcm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGFsaWFzID0gX3NlbC50b0FsaWFzKF9zZWwuX2Zyb20uZ2V0VGFibGVJbmRl\neAogICAgICAgICAgICAgICAgICAgIChjb2wuZ2V0VGFibGUoKSwgcGosIGZh\nbHNlKSk7CiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAg\nIGlmIChfc2VsLl9kaWN0LnJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIEZST01fU0VMRUNUX0FMSUFTICsg\nIi4iICsgYWxpYXMgKyAiXyIgKyBjb2w7CiAgICAgICAgICAgICAgICByZXR1\ncm4gYWxpYXMgKyAiXyIgKyBjb2w7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgYWxpYXMgPSBfc2VsLnRvQWxpYXMoX3NlbC5nZXRUYWJsZUluZGV4KGNv\nbC5nZXRUYWJsZSgpLCBwaiwgZmFsc2UpKTsKICAgICAgICAgICAgcmV0dXJu\nIChhbGlhcyA9PSBudWxsKSA/IG51bGwgOiBhbGlhcyArICIuIiArIGNvbDsK\nICAgICAgICB9CgogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgICAgICAvLyBQYXRoSm9pbnMgaW1wbGVtZW50YXRpb24KICAgICAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0\nZXIoYm9vbGVhbiBvdXRlcikgewogICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmdCdWZmZXIgcGF0aCgpIHsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pblNldCBq\nb2lucygpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBudWxs\nSm9pbnMoKSB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxU\nYWJsZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW4o\nRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFu\neSkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBq\nb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAogICAg\nICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVh\nbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1\ncm4gbmV3IFBhdGhKb2luc0ltcGwoKS5qb2luUmVsYXRpb24obmFtZSwgZmss\nIHRhcmdldCwgc3VicywgCiAgICAgICAgICAgICAgICBpbnZlcnNlLCB0b01h\nbnkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9p\nblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLAogICAgICAg\nICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4g\nbmV3IFBhdGhKb2luc0ltcGwoKS5vdXRlckpvaW5SZWxhdGlvbihuYW1lLCBm\naywgdGFyZ2V0LCBzdWJzLAogICAgICAgICAgICAgICAgaW52ZXJzZSwgdG9N\nYW55KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRWYXJp\nYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgICAgIGlmICh2YXIgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICBy\nZXR1cm4gbmV3IFBhdGhKb2luc0ltcGwoKS5zZXRWYXJpYWJsZSh2YXIpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldFN1YnNlbGVjdChT\ndHJpbmcgYWxpYXMpIHsKICAgICAgICAgICAgaWYgKGFsaWFzID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBQYXRoSm9pbnNJbXBsKCkuc2V0U3Vic2VsZWN0KGFsaWFzKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBCYXNlIGpvaW5zIGlt\ncGxlbWVudGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBQYXRoSm9pbnNJbXBsCiAgICAgICAgaW1wbGVtZW50cyBQYXRoSm9pbnMg\newoKICAgICAgICBwcm90ZWN0ZWQgU3RyaW5nQnVmZmVyIHBhdGggPSBudWxs\nOwogICAgICAgIHByb3RlY3RlZCBTdHJpbmcgdmFyID0gbnVsbDsKCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFBhdGhKb2lu\ncyBzZXRPdXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNE\naXJ0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHZhciAhPSBudWxsIHx8IHBh\ndGggIT0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmdC\ndWZmZXIgcGF0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pblNldCBqb2lucygpIHsKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\naW50IGpvaW5Db3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKSB7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5n\nIHZhcikgewogICAgICAgICAgICB0aGlzLnZhciA9IHZhcjsKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9p\nbnMgc2V0U3Vic2VsZWN0KFN0cmluZyBhbGlhcykgewogICAgICAgICAgICBp\nZiAoIWFsaWFzLmVuZHNXaXRoKCI6IikpCiAgICAgICAgICAgICAgICBhbGlh\ncyArPSAnOic7CiAgICAgICAgICAgIGFwcGVuZChhbGlhcyk7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NKb2luKFRhYmxl\nIGxvY2FsVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewogICAgICAgICAg\nICBhcHBlbmQodmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pbnMgam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJv\nb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAg\nICAgICAgICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9y\nZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkg\newogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAgICAgICAgdmFyID0g\nbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBG\nb3JlaWduS2V5IGZrLCAKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdl\ndCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkp\nIHsKICAgICAgICAgICAgYXBwZW5kKG5hbWUpOwogICAgICAgICAgICBhcHBl\nbmQodmFyKTsKICAgICAgICAgICAgdmFyID0gbnVsbDsKICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMg\nb3V0ZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmss\nCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBi\nb29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAg\nIGFwcGVuZChuYW1lKTsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAg\nICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5kKFN0cmlu\nZyBzdHIpIHsKICAgICAgICAgICAgaWYgKHN0ciAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBpZiAocGF0aCA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHBhdGggPSBuZXcgU3RyaW5nQnVmZmVyKHN0cik7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoJy4n\nKS5hcHBlbmQoc3RyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0\ndXJuICJQYXRoSm9pbnNJbXBsPCIgKyBoYXNoQ29kZSgpICsgIj46ICIKICAg\nICAgICAgICAgICAgICsgU3RyaW5nLnZhbHVlT2YocGF0aCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogSm9pbnMgaW1wbGVtZW50YXRpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFNlbGVjdEpvaW5z\nCiAgICAgICAgZXh0ZW5kcyBQYXRoSm9pbnNJbXBsIAogICAgICAgIGltcGxl\nbWVudHMgQ2xvbmVhYmxlIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTZWxl\nY3RJbXBsIF9zZWw7CiAgICAgICAgcHJpdmF0ZSBKb2luU2V0IF9qb2lucyA9\nIG51bGw7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIF9vdXRlciA9IGZhbHNl\nOwogICAgICAgIHByaXZhdGUgaW50IF9jb3VudCA9IDA7CgogICAgICAgIHB1\nYmxpYyBTZWxlY3RKb2lucyhTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAg\nICBfc2VsID0gc2VsOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW4gaXNPdXRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9vdXRlcjsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9v\nbGVhbiBvdXRlcikgewogICAgICAgICAgICBfb3V0ZXIgPSBvdXRlcjsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgICAgICByZXR1cm4gc3Vw\nZXIuaXNEaXJ0eSgpIHx8ICFpc0VtcHR5KCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgSm9pblNldCBqb2lucygpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9qb2luczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldEpv\naW5zKEpvaW5TZXQgam9pbnMpIHsKICAgICAgICAgICAgX2pvaW5zID0gam9p\nbnM7CiAgICAgICAgICAgIF9vdXRlciA9IGpvaW5zICE9IG51bGwgJiYgam9p\nbnMubGFzdCgpICE9IG51bGwKICAgICAgICAgICAgICAgICYmIGpvaW5zLmxh\nc3QoKS5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBqb2luQ291bnQoKSB7CiAgICAgICAgICAg\nIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBf\nY291bnQ7CiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChfY291bnQsIF9q\nb2lucy5zaXplKCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nbnVsbEpvaW5zKCkgewogICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfY291bnQgPSBNYXRoLm1heChfY291bnQsIF9q\nb2lucy5zaXplKCkpOwogICAgICAgICAgICBfam9pbnMgPSBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5pc0Vt\ncHR5KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgY3Jvc3NK\nb2luKFRhYmxlIGxvY2FsVGFibGUsIFRhYmxlIGZvcmVpZ25UYWJsZSkgewog\nICAgICAgICAgICAvLyBjcm9zcyBqb2lucyBhcmUgZm9yIHVuYm91bmQgdmFy\naWFibGVzOyB1bmZvcnR1bmF0ZWx5IHdlIGhhdmUKICAgICAgICAgICAgLy8g\ndG8gYWx3YXlzIGdvIERJU1RJTkNUIGZvciB1bmJvdW5kIHZhcnMgYmVjYXVz\nZSB0aGVyZSBhcmUgY2VydGFpbgogICAgICAgICAgICAvLyBjYXNlcyB0aGF0\nIHJlcXVpcmUgaXQsIGFuZCB3ZSBjYW4ndCBkaWZmZXJlbnRpYXRlIHRoZW0g\nZnJvbSB0aGUKICAgICAgICAgICAgLy8gY2FzZXMgdGhhdCBkb24ndAogICAg\nICAgICAgICBfc2VsLl9mbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsKCiAg\nICAgICAgICAgIGlmIChfc2VsLmdldEpvaW5TeW50YXgoKSAhPSBKb2luU3lu\ndGF4ZXMuU1lOVEFYX1NRTDkyCiAgICAgICAgICAgICAgICB8fCBfc2VsLl9m\ncm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGRvbid0IG1ha2Ug\nYW55IGpvaW5zLCBidXQgdXBkYXRlIHRoZSBwYXRoIGlmIGEgdmFyaWFibGUK\nICAgICAgICAgICAgICAgIC8vIGhhcyBiZWVuIHNldAogICAgICAgICAgICAg\nICAgdGhpcy5hcHBlbmQodGhpcy52YXIpOwogICAgICAgICAgICAgICAgdGhp\ncy52YXIgPSBudWxsOwogICAgICAgICAgICAgICAgX291dGVyID0gZmFsc2U7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gZG9uJ3QgbGV0IHRoZSBnZXQgYWxpYXMgbWV0aG9k\ncyBzZWUgdGhhdCBhIHZhciBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgLy8g\ndW50aWwgd2UgZ2V0IHBhc3QgdGhlIGxvY2FsIHRhYmxlCiAgICAgICAgICAg\nIFN0cmluZyB2YXIgPSB0aGlzLnZhcjsKICAgICAgICAgICAgdGhpcy52YXIg\nPSBudWxsOwoKICAgICAgICAgICAgaW50IGFsaWFzMSA9IF9zZWwuZ2V0VGFi\nbGVJbmRleChsb2NhbFRhYmxlLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAg\ndGhpcy5hcHBlbmQodmFyKTsKICAgICAgICAgICAgaW50IGFsaWFzMiA9IF9z\nZWwuZ2V0VGFibGVJbmRleChmb3JlaWduVGFibGUsIHRoaXMsIHRydWUpOwog\nICAgICAgICAgICBKb2luIGogPSBuZXcgSm9pbihsb2NhbFRhYmxlLCBhbGlh\nczEsIGZvcmVpZ25UYWJsZSwgYWxpYXMyLAogICAgICAgICAgICAgICAgbnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICBqLnNldFR5cGUoSm9pbi5UWVBFX0NS\nT1NTKTsKCiAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9qb2lucyA9IG5ldyBKb2luU2V0KCk7CiAgICAgICAgICAg\nIF9qb2lucy5hZGQoaik7CiAgICAgICAgICAgIF9vdXRlciA9IGZhbHNlOwog\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJz\nZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgcmV0dXJuIGpvaW4o\nbnVsbCwgZmssIG51bGwsIC0xLCBpbnZlcnNlLCB0b01hbnksIGZhbHNlKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW4oRm9y\nZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkg\newogICAgICAgICAgICByZXR1cm4gam9pbihudWxsLCBmaywgbnVsbCwgLTEs\nIGludmVyc2UsIHRvTWFueSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWdu\nS2V5IGZrLCAKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50\nIHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAg\nICAgICAgICAgcmV0dXJuIGpvaW4obmFtZSwgZmssIHRhcmdldCwgc3Vicywg\naW52ZXJzZSwgdG9NYW55LCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZv\ncmVpZ25LZXkgZmssCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQs\nIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgICAgIHJldHVybiBqb2luKG5hbWUsIGZrLCB0YXJnZXQsIHN1\nYnMsIGludmVyc2UsIHRvTWFueSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAg\nICBwcml2YXRlIEpvaW5zIGpvaW4oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkg\nZmssIENsYXNzTWFwcGluZyB0YXJnZXQsCiAgICAgICAgICAgIGludCBzdWJz\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55LCBib29sZWFuIG91\ndGVyKSB7CiAgICAgICAgICAgIC8vIGRvbid0IGxldCB0aGUgZ2V0IGFsaWFz\nIG1ldGhvZHMgc2VlIHRoYXQgYSB2YXIgaGFzIGJlZW4gc2V0CiAgICAgICAg\nICAgIC8vIHVudGlsIHdlIGdldCBwYXN0IHRoZSBsb2NhbCB0YWJsZQogICAg\nICAgICAgICBTdHJpbmcgdmFyID0gdGhpcy52YXI7CiAgICAgICAgICAgIHRo\naXMudmFyID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGdldCBmaXJzdCB0YWJs\nZSBhbGlhcyBiZWZvcmUgdXBkYXRpbmcgcGF0aDsgaWYgdGhlcmUgaXMgYSBm\ncm9tCiAgICAgICAgICAgIC8vIHNlbGVjdCB0aGVuIHdlIHNob3VsZG4ndCBh\nY3R1YWxseSBjcmVhdGUgYSBqb2luIG9iamVjdCwgc2luY2UKICAgICAgICAg\nICAgLy8gdGhlIGpvaW5zIHdpbGwgYWxsIGJlIGRvbmUgaW4gdGhlIGZyb20g\nc2VsZWN0CiAgICAgICAgICAgIGJvb2xlYW4gY3JlYXRlSm9pbiA9IF9zZWwu\nX2Zyb20gPT0gbnVsbDsKICAgICAgICAgICAgVGFibGUgdGFibGUxID0gbnVs\nbDsKICAgICAgICAgICAgaW50IGFsaWFzMSA9IC0xOwogICAgICAgICAgICBp\nZiAoY3JlYXRlSm9pbikgewogICAgICAgICAgICAgICAgdGFibGUxID0gKGlu\ndmVyc2UpID8gZmsuZ2V0UHJpbWFyeUtleVRhYmxlKCkgOiBmay5nZXRUYWJs\nZSgpOwogICAgICAgICAgICAgICAgYWxpYXMxID0gX3NlbC5nZXRUYWJsZUlu\nZGV4KHRhYmxlMSwgdGhpcywgdHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHVwZGF0ZSB0aGUgcGF0aCB3aXRoIHRoZSByZWxhdGlvbiBu\nYW1lIGJlZm9yZSBnZXR0aW5nIHBrIGFsaWFzCiAgICAgICAgICAgIHRoaXMu\nYXBwZW5kKG5hbWUpOwogICAgICAgICAgICB0aGlzLmFwcGVuZCh2YXIpOwog\nICAgICAgICAgICBpZiAodG9NYW55KSB7CiAgICAgICAgICAgICAgICBfc2Vs\nLl9mbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsKICAgICAgICAgICAgICAg\nIF9zZWwuX2ZsYWdzIHw9IFRPX01BTlk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgX291dGVyID0gb3V0ZXI7CgogICAgICAgICAgICBpZiAoY3JlYXRl\nSm9pbikgewogICAgICAgICAgICAgICAgVGFibGUgdGFibGUyID0gKGludmVy\nc2UpID8gZmsuZ2V0VGFibGUoKSAKICAgICAgICAgICAgICAgICAgICA6IGZr\nLmdldFByaW1hcnlLZXlUYWJsZSgpOwogICAgICAgICAgICAgICAgaW50IGFs\naWFzMiA9IF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTIsIHRoaXMsIHRydWUp\nOwogICAgICAgICAgICAgICAgSm9pbiBqID0gbmV3IEpvaW4odGFibGUxLCBh\nbGlhczEsIHRhYmxlMiwgYWxpYXMyLCBmaywgaW52ZXJzZSk7CiAgICAgICAg\nICAgICAgICBqLnNldFR5cGUoKG91dGVyKSA/IEpvaW4uVFlQRV9PVVRFUiA6\nIEpvaW4uVFlQRV9JTk5FUik7CgogICAgICAgICAgICAgICAgaWYgKF9qb2lu\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9qb2lucyA9IG5ldyBK\nb2luU2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoX2pvaW5zLmFkZChqKSAm\nJiAoc3VicyA9PSBTZWxlY3QuU1VCU19KT0lOQUJMRSAKICAgICAgICAgICAg\nICAgICAgICB8fCBzdWJzID09IFNlbGVjdC5TVUJTX05PTkUpKQogICAgICAg\nICAgICAgICAgICAgIGouc2V0UmVsYXRpb24odGFyZ2V0LCBzdWJzLCBjbG9u\nZShfc2VsKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU2VsZWN0Sm9pbnMgY2xv\nbmUoU2VsZWN0SW1wbCBzZWwpIHsKICAgICAgICAgICAgU2VsZWN0Sm9pbnMg\nc2ogPSBuZXcgU2VsZWN0Sm9pbnMoc2VsKTsKICAgICAgICAgICAgc2oudmFy\nID0gdmFyOwogICAgICAgICAgICBpZiAocGF0aCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgc2oucGF0aCA9IG5ldyBTdHJpbmdCdWZmZXIocGF0aC50b1N0\ncmluZygpKTsKICAgICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsICYmICFf\nam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgc2ouX2pvaW5zID0g\nbmV3IEpvaW5TZXQoX2pvaW5zKTsKICAgICAgICAgICAgc2ouX291dGVyID0g\nX291dGVyOwogICAgICAgICAgICByZXR1cm4gc2o7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICBy\nZXR1cm4gc3VwZXIudG9TdHJpbmcoKSArICIgKCIgKyBfb3V0ZXIgKyAiKTog\nIiArIF9qb2luczsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHByb3RlY3Rl\nZCBTZWxlY3RzIG5ld1NlbGVjdHMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZWxlY3RzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgY2xhc3Mg\ndG8gdHJhY2sgc2VsZWN0ZWQgY29sdW1ucywgd2l0aCBmYXN0IGNvbnRhaW5z\nIG1ldGhvZC4KICAgICAqIEFjdHMgYXMgYSBsaXN0IG9mIHNlbGVjdCBpZHMs\nIHdpdGggYWRkaXRpb25hbCBtZXRob2RzIHRvIG1hbmlwdWxhdGUKICAgICAq\nIHRoZSBhbGlhcyBvZiBlYWNoIHNlbGVjdGVkIGlkLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgc3RhdGljIGNsYXNzIFNlbGVjdHMKICAgICAgICBleHRlbmRz\nIEFic3RyYWN0TGlzdCB7CgogICAgICAgIHByb3RlY3RlZCBMaXN0IF9pZHMg\nPSBudWxsOwogICAgICAgIHByb3RlY3RlZCBMaXN0IF9pZGVudHMgPSBudWxs\nOwogICAgICAgIHByb3RlY3RlZCBNYXAgX2FsaWFzZXMgPSBudWxsOwogICAg\nICAgIHByb3RlY3RlZCBNYXAgX3NlbGVjdEFzID0gbnVsbDsKICAgICAgICBw\ncm90ZWN0ZWQgREJEaWN0aW9uYXJ5IF9kaWN0ID0gbnVsbDsKCiAgICAgICAg\nLyoqCiAgICAgICAgICogQWRkIGFsbCBhbGlhc2VzIGZyb20gYW5vdGhlciBp\nbnN0YW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGRB\nbGwoU2VsZWN0cyBzZWxzKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51\nbGwgJiYgc2Vscy5faWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRz\nID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZHMpOwogICAgICAgICAgICBlbHNl\nIGlmIChzZWxzLl9pZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9pZHMu\nYWRkQWxsKHNlbHMuX2lkcyk7CgogICAgICAgICAgICBpZiAoX2lkZW50cyA9\nPSBudWxsICYmIHNlbHMuX2lkZW50cyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX2lkZW50cyA9IG5ldyBBcnJheUxpc3Qoc2Vscy5faWRlbnRzKTsKICAg\nICAgICAgICAgZWxzZSBpZiAoc2Vscy5faWRlbnRzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfaWRlbnRzLmFkZEFsbChzZWxzLl9pZGVudHMpOwoKICAg\nICAgICAgICAgaWYgKF9hbGlhc2VzID09IG51bGwgJiYgc2Vscy5fYWxpYXNl\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFz\naE1hcChzZWxzLl9hbGlhc2VzKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vs\ncy5fYWxpYXNlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FsaWFzZXMu\ncHV0QWxsKHNlbHMuX2FsaWFzZXMpOwoKICAgICAgICAgICAgaWYgKF9zZWxl\nY3RBcyA9PSBudWxsICYmIHNlbHMuX3NlbGVjdEFzICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBfc2VsZWN0QXMgPSBuZXcgSGFzaE1hcChzZWxzLl9zZWxl\nY3RBcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbHMuX3NlbGVjdEFzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfc2VsZWN0QXMucHV0QWxsKHNlbHMu\nX3NlbGVjdEFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIFJldHVybnMgdGhlIGFsaWFzIG9mIGEgZ2l2ZW4gaWQuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRBbGlhcyhPYmplY3QgaWQpIHsK\nICAgICAgICAgICAgcmV0dXJuIChfYWxpYXNlcyA9PSBudWxsKSA/IG51bGwg\nOiBfYWxpYXNlcy5nZXQoaWQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBhIGdpdmVuIGlkLgogICAgICAg\nICAqLwogICAgICAgIHB1YmxpYyBpbnQgc2V0QWxpYXMoT2JqZWN0IGlkLCBP\nYmplY3QgYWxpYXMsIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAgICAgaWYg\nKF9pZHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2lkcyA9IG5ldyBB\ncnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIF9hbGlhc2VzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50IGlkeDsK\nICAgICAgICAgICAgaWYgKF9hbGlhc2VzLnB1dChpZCwgYWxpYXMpICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBpZHggPSBfaWRzLmluZGV4T2YoaWQpOwog\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIF9pZHMuYWRkKGlk\nKTsKICAgICAgICAgICAgICAgIGlkeCA9IF9pZHMuc2l6ZSgpIC0gMTsKCiAg\nICAgICAgICAgICAgICBpZiAoaWRlbnQpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoX2lkZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBfaWRlbnRzID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICAgICAgICAg\nICAgICBfaWRlbnRzLmFkZChpZCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGlkeDsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFNldCBhbiBhbGlhcyBmb3IgYSBnaXZl\nbiBpbmRleC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBzZXRB\nbGlhcyhpbnQgaWR4LCBPYmplY3QgYWxpYXMpIHsKICAgICAgICAgICAgT2Jq\nZWN0IGlkID0gX2lkcy5nZXQoaWR4KTsKICAgICAgICAgICAgX2FsaWFzZXMu\ncHV0KGlkLCBhbGlhcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBJbnNlcnQgYW4gYWxpYXMgYmVmb3JlIHRoZSBnaXZlbiBpbmRleCwg\ndXNpbmcgbmVnYXRpdmUgaW5kZXhlcwogICAgICAgICAqIHRvIGNvdW50IGJh\nY2t3YXJkcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBpbnNl\ncnRBbGlhcyhpbnQgaWR4LCBPYmplY3QgaWQsIE9iamVjdCBhbGlhcykgewog\nICAgICAgICAgICBfYWxpYXNlcy5wdXQoaWQsIGFsaWFzKTsKICAgICAgICAg\nICAgaWYgKGlkeCA+PSAwKQogICAgICAgICAgICAgICAgX2lkcy5hZGQoaWR4\nLCBpZCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9pZHMu\nYWRkKF9pZHMuc2l6ZSgpICsgaWR4LCBpZCk7CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGluZGV4IG9mIHRoZSBnaXZl\nbiBhbGlhcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgaW50IGluZGV4\nT2ZBbGlhcyhPYmplY3QgYWxpYXMpIHsKICAgICAgICAgICAgaWYgKF9hbGlh\nc2VzID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2lkcy5zaXplKCk7IGkrKykK\nICAgICAgICAgICAgICAgIGlmIChhbGlhcy5lcXVhbHMoX2FsaWFzZXMuZ2V0\nKF9pZHMuZ2V0KGkpKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7\nCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIEEgbGlzdCByZXByZXNlbnRhdGlvbiBvZiB0aGUgYWxp\nYXNlcywgaW4gc2VsZWN0IG9yZGVyLCB3aXRoCiAgICAgICAgICogQVMgYWxp\nYXNlcyBwcmVzZW50LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBMaXN0\nIGdldEFsaWFzZXMoZmluYWwgYm9vbGVhbiBpZGVudCwgZmluYWwgYm9vbGVh\nbiBpbm5lcikgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7Cgog\nICAgICAgICAgICByZXR1cm4gbmV3IEFic3RyYWN0TGlzdCgpIHsKICAgICAg\nICAgICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKGlkZW50ICYmIF9pZGVudHMgIT0gbnVsbCkgPyBfaWRl\nbnRzLnNpemUoKQogICAgICAgICAgICAgICAgICAgICAgICA6IF9pZHMuc2l6\nZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1Ymxp\nYyBPYmplY3QgZ2V0KGludCBpKSB7CiAgICAgICAgICAgICAgICAgICAgT2Jq\nZWN0IGlkID0gKGlkZW50ICYmIF9pZGVudHMgIT0gbnVsbCkgPyBfaWRlbnRz\nLmdldChpKQogICAgICAgICAgICAgICAgICAgICAgICA6IF9pZHMuZ2V0KGkp\nOwogICAgICAgICAgICAgICAgICAgIE9iamVjdCBhbGlhcyA9IF9hbGlhc2Vz\nLmdldChpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkIGluc3RhbmNl\nb2YgQ29sdW1uICYmICgoQ29sdW1uKSBpZCkuaXNYTUwoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgYWxpYXMgPSBhbGlhcyArIF9kaWN0LmdldFN0cmlu\nZ1ZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIGFzID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBp\nZiAoaW5uZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGFzID0gKChTdHJp\nbmcpIGFsaWFzKS5yZXBsYWNlKCcuJywgJ18nKTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlIGlmIChfc2VsZWN0QXMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgYXMgPSAoU3RyaW5nKSBfc2VsZWN0QXMuZ2V0KGlkKTsK\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGFzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGlkZW50ICYmIF9pZGVudHMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhczsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGFsaWFzIGluc3RhbmNlb2YgU1FM\nQnVmZmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXMgPSBu\nZXcgU1FMQnVmZmVyKChTUUxCdWZmZXIpIGFsaWFzKS4KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBhcHBlbmQoIiBBUyAiKS5hcHBlbmQoYXMp\nOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhbGlhcyA9IGFsaWFzICsgIiBBUyAiICsgYXM7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBhbGlhczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGF0IGEgZ2l2\nZW4gaWQncyBhbGlhcyBoYXMgYW4gQVMgdmFsdWUuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIHZvaWQgc2V0U2VsZWN0QXMoT2JqZWN0IGlkLCBTdHJp\nbmcgYXMpIHsKICAgICAgICAgICAgaWYgKF9zZWxlY3RBcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgX3NlbGVjdEFzID0gbmV3IEhhc2hNYXAoKGludCkg\nKDUgKiAxLjMzICsgMSkpOwogICAgICAgICAgICBfc2VsZWN0QXMucHV0KGlk\nLCBhcyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDbGVh\nciBhbGwgcGxhY2Vob2xkZXJzIGFuZCBzZWxlY3QgQVMgY2xhdXNlcy4KICAg\nICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBjbGVhclBsYWNlaG9sZGVy\ncygpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIE9iamVjdCBpZDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfaWRzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBpZCA9IGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICBpZiAoaWQgaW5zdGFuY2VvZiBQbGFjZWhv\nbGRlcikgewogICAgICAgICAgICAgICAgICAgIGl0ci5yZW1vdmUoKTsKICAg\nICAgICAgICAgICAgICAgICBfYWxpYXNlcy5yZW1vdmUoaWQpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBjb250YWlucyhPYmplY3QgaWQpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9hbGlhc2VzICE9IG51bGwgJiYgX2FsaWFzZXMuY29udGFp\nbnNLZXkoaWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBn\nZXQoaW50IGkpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNF\neGNlcHRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIF9pZHMuZ2V0KGkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAg\nICAgICByZXR1cm4gKF9pZHMgPT0gbnVsbCkgPyAwIDogX2lkcy5zaXplKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAg\nICAgICAgICAgX2lkcyA9IG51bGw7CiAgICAgICAgICAgIF9hbGlhc2VzID0g\nbnVsbDsKICAgICAgICAgICAgX3NlbGVjdEFzID0gbnVsbDsKICAgICAgICAg\nICAgX2lkZW50cyA9IG51bGw7CiAgICAgICAgfQogICAgfQp9CgovKioKICog\nQ29tbW9uIGpvaW5zIGludGVyZmFjZSB1c2VkIGludGVybmFsbHkuIENhbm5v\ndCBiZSBtYWRlIGFuIGlubmVyIGNsYXNzCiAqIGJlY2F1c2UgdGhlIG91dGVy\nIGNsYXNzIChTZWxlY3QpIGhhcyB0byBpbXBsZW1lbnQgaXQuCiAqLwppbnRl\ncmZhY2UgUGF0aEpvaW5zCiAgICBleHRlbmRzIEpvaW5zIHsKCiAgICAvKioK\nICAgICAqIE1hcmsgdGhpcyBhcyBhbiBvdXRlciBqb2lucyBzZXQuCiAgICAg\nKi8KICAgIHB1YmxpYyBQYXRoSm9pbnMgc2V0T3V0ZXIoYm9vbGVhbiBvdXRl\ncik7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGluc3Rh\nbmNlIGhhcyBhIHBhdGgsIGFueSBqb2lucywgb3IgYSB2YXJpYWJsZS4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpOwoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSByZWxhdGlvbiBwYXRoIHRyYXZlcnNlZCBieSB0\naGVzZSBqb2lucywgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nQnVmZmVyIHBhdGgoKTsKCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgc2V0IG9mIHtAbGluayBKb2lufSBlbGVtZW50cywgb3IgbnVsbCBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgSm9pblNldCBqb2lucygpOwoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtYXhpbXVtIG51bWJlciBvZiBq\nb2lucyBjb250YWluZWQgaW4gdGhpcyBpbnN0YW5jZSBhdCBhbnkKICAgICAq\nIHRpbWUuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgam9pbkNvdW50KCk7Cgog\nICAgLyoqCiAgICAgKiBOdWxsIHRoZSBzZXQgb2Yge0BsaW5rIEpvaW59IGVs\nZW1lbnRzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMoKTsK\nfQoK\n","encoding":"base64"}

