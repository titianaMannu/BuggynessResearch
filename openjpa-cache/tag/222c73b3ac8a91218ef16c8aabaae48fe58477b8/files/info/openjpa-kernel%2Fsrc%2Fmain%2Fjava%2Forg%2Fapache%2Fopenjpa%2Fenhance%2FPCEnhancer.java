{"sha":"54bf484f8ca25d00c391ad9c7670d7e7ccb21d29","node_id":"MDQ6QmxvYjIwNjM2NDo1NGJmNDg0ZjhjYTI1ZDAwYzM5MWFkOWM3NjcwZDdlN2NjYjIxZDI5","size":177144,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/54bf484f8ca25d00c391ad9c7670d7e7ccb21d29","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5s\nYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNv\nbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbkltcGw7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuQ2xhc3NBcmdQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQnl0ZWNvZGVXcml0\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuRmlsZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLk9w\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU2Vy\ndmljZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9j\nYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkRhdGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkRvdWJsZUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5TdHJpbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9wZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFz\nczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAu\nYnl0ZWNvZGUuRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmll\nbGRJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJ\nbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0\nZWNvZGUuTG9hZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5N\nZXRob2RJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuUHJvamVj\ndDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuVGFibGVTd2l0Y2hJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQ2xhc3NJbnN0cnVjdGlvbjsKaW1w\nb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2VycC51dGlsLlN0cmlu\nZ3M7CgovKioKICogQnl0ZWNvZGUgZW5oYW5jZXIgdXNlZCB0byBlbmhhbmNl\nIHBlcnNpc3RlbnQgY2xhc3NlcyBmcm9tIG1ldGFkYXRhLiBUaGUKICogZW5o\nYW5jZXIgbXVzdCBiZSBpbnZva2VkIG9uIGFsbCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIGFuZCBwZXJzaXN0ZW5jZSBhd2FyZQogKiBjbGFzc2VzLgogKgogKiBA\nYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFBDRW5oYW5jZXIg\newogICAgLy8gRGVzaWduYXRlcyBhIHZlcnNpb24gZm9yIG1haW50YWluaW5n\nIGNvbXBhdGJpbGl0eSB3aGVuIFBDRW5oYW5jZXIKICAgIC8vIG1vZGlmaWVz\nIGVuaGFuY2VtZW50IHRoYXQgY2FuIGJyZWFrIHNlcmlhbGl6YXRpb24gb3Ig\nb3RoZXIgY29udHJhY3RzCiAgICAvLyBFYWNoIGVuaGFuY2VkIGNsYXNzIHdp\nbGwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIHZpYQogICAgLy8g\ncHVibGljIGludCBnZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbigpCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFUl9WRVJTSU9OID0g\nMjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX05PTkUg\nPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5IQU5DRV9BV0FS\nRSA9IDIgPDwgMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFO\nQ0VfSU5URVJGQUNFID0gMiA8PCAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRV9QQyA9IDIgPDwgMjsKCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBQUkUgPSAicGMiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSVNERVRBQ0hFRFNUQVRFREVGSU5JVElWRSA9IFBSRSAK\nICAgICAgICArICJpc0RldGFjaGVkU3RhdGVEZWZpbml0aXZlIjsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBQQ1RZUEUgPSBQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU00gPSBQUkUgKyAiU3RhdGVNYW5hZ2VyIjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzIFNNVFlQRSA9IFN0YXRlTWFuYWdlci5jbGFzczsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBJTkhFUklUID0gUFJF\nICsgIkluaGVyaXRlZEZpZWxkQ291bnQiOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIENPTlRFWFROQU1FID0gIkdlbmVyaWNDb250ZXh0IjsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFVTRVJFWENFUCA9IFVz\nZXJFeGNlcHRpb24uY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\nbGFzcyBJTlRFUk5FWENFUCA9IEludGVybmFsRXhjZXB0aW9uLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSEVMUEVSVFlQRSA9IFBD\nUmVnaXN0cnkuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgU1VQRVIgPSBQUkUgKyAiUENTdXBlcmNsYXNzIjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIENsYXNzIE9JREZTVFlQRSA9IEZpZWxkU3VwcGxpZXIu\nY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBPSURGQ1RZ\nUEUgPSBGaWVsZENvbnN1bWVyLmNsYXNzOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoUENFbmhhbmNlci5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUkVERUZJTkVEX0FUVFJJQlVURQogICAgICAgID0g\nUENFbmhhbmNlci5jbGFzcy5nZXROYW1lKCkgKyAiI3JlZGVmaW5lZC10eXBl\nIjsKICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQXV4aWxpYXJ5RW5o\nYW5jZXJbXSBfYXV4RW5oYW5jZXJzOwogICAgc3RhdGljIHsKICAgICAgICBD\nbGFzc1tdIGNsYXNzZXMgPSBTZXJ2aWNlcy5nZXRJbXBsZW1lbnRvckNsYXNz\nZXMoCiAgICAgICAgICAgIEF1eGlsaWFyeUVuaGFuY2VyLmNsYXNzLAogICAg\nICAgICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xh\nc3NMb2FkZXJBY3Rpb24oQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MpKSk7CiAg\nICAgICAgTGlzdCBhdXhFbmhhbmNlcnMgPSBuZXcgQXJyYXlMaXN0KGNsYXNz\nZXMubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsYXNz\nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGF1eEVuaGFuY2Vycy5hZGQoQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3SW5zdGFuY2VBY3Rpb24oY2xhc3Nlc1tpXSkpKTsKCQkgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGF1eCBlbmhh\nbmNlciBtYXkgcmVseSBvbiBub24tZXhpc3RhbnQgc3BlYyBjbGFzc2VzLCBl\ndGMKCQkgICAgfQoJCX0KICAgIAlfYXV4RW5oYW5jZXJzID0gKEF1eGlsaWFy\neUVuaGFuY2VyW10pIGF1eEVuaGFuY2Vycy50b0FycmF5CiAgICAgICAgICAg\nIChuZXcgQXV4aWxpYXJ5RW5oYW5jZXJbYXV4RW5oYW5jZXJzLnNpemUoKV0p\nOwogICAgfQoKICAgIHByaXZhdGUgQkNDbGFzcyBfcGM7CiAgICBwcml2YXRl\nIGZpbmFsIEJDQ2xhc3MgX21hbmFnZWRUeXBlOwogICAgcHJpdmF0ZSBmaW5h\nbCBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAgcHJpdmF0ZSBmaW5h\nbCBDbGFzc01ldGFEYXRhIF9tZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cg\nX2xvZzsKICAgIHByaXZhdGUgQ29sbGVjdGlvbiBfb2lkcyA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2RlZkNvbnMgPSB0cnVlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9yZWRlZmluZSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9zdWJjbGFzcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9m\nYWlsID0gZmFsc2U7CiAgICBwcml2YXRlIFNldCBfdmlvbGF0aW9ucyA9IG51\nbGw7CiAgICBwcml2YXRlIEZpbGUgX2RpciA9IG51bGw7CiAgICBwcml2YXRl\nIEJ5dGVjb2RlV3JpdGVyIF93cml0ZXIgPSBudWxsOwogICAgcHJpdmF0ZSBN\nYXAgX2JhY2tpbmdGaWVsZHMgPSBudWxsOyAvLyBtYXAgb2Ygc2V0IC8gZ2V0\nIG5hbWVzID0+IGZpZWxkIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfYXR0cnNU\nb0ZpZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBhdHRyIG5hbWVzID0+IGZpZWxk\nIG5hbWVzCiAgICBwcml2YXRlIE1hcCBfZmllbGRzVG9BdHRycyA9IG51bGw7\nIC8vIG1hcCBvZiBmaWVsZCBuYW1lcyA9PiBhdHRyIG5hbWVzCiAgICBwcml2\nYXRlIGJvb2xlYW4gX2lzQWxyZWFkeVJlZGVmaW5lZCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9pc0FscmVhZHlTdWJjbGFzc2VkID0gZmFsc2U7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Jjc0NvbmZpZ3VyZWQgPSBmYWxzZTsK\nCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJh\ndGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLgogICAgICovCiAgICBwdWJsaWMg\nUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzcyB0\neXBlKSB7CiAgICAgICAgdGhpcyhjb25mLCAoQkNDbGFzcykgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3QoKSwgdHlw\nZSkpLAogICAgICAgICAgICAoTWV0YURhdGFSZXBvc2l0b3J5KSBudWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29u\nZmlndXJhdGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLgogICAgICovCiAgICBw\ndWJsaWMgUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBD\nbGFzc01ldGFEYXRhIHR5cGUpIHsKICAgICAgICB0aGlzKGNvbmYsIChCQ0Ns\nYXNzKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAubG9hZFByb2plY3RDbGFzc0FjdGlvbihuZXcg\nUHJvamVjdCgpLCB0eXBlLmdldERlc2NyaWJlZFR5cGUoKSkpLAogICAgICAg\nICAgICB0eXBlLmdldFJlcG9zaXRvcnkoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAg\nKgogICAgICogQHBhcmFtIHR5cGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0\naW9uIGZvIHRoZSB0eXBlIHRvCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBi\nZSBjcmVhdGVkIGZyb20gYW55IHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFy\nYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBvc2l0b3J5IHRvIHVzZSBmb3IgbWV0\nYWRhdGEgYWNjZXNzLAogICAgICogb3IgbnVsbCB0byBjcmVhdGUgYSBuZXcg\ncmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRvcnkKICAgICAqIGZyb20gdGhlIGdp\ndmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3QgdXNlZCBieSBkZWZhdWx0CiAgICAg\nKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0aW9uIG1pZ2h0IGJlIGFuCiAgICAg\nKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZpYyBzdWJjbGFzcyB3aG9zZSBtZXRh\nZGF0YQogICAgICogcmVxdWlyZWQgbW9yZSB0aGFuIGp1c3QgYmFzZSBtZXRh\nZGF0YSBmaWxlcwogICAgICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayAjUENF\nbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiwgQkNDbGFzcywKICAgICAg\nICBNZXRhRGF0YVJlcG9zaXRvcnksIENsYXNzTG9hZGVyKX0gaW5zdGVhZC4g\nCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAgICBNZXRhRGF0YVJl\ncG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICB0aGlzKGNvbmYsIHR5cGUsIHJl\ncG9zLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9y\nLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0g\ndHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gZm8gdGhlIHR5cGUg\ndG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJlIGNyZWF0ZWQgZnJvbSBh\nbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJhbSByZXBvcyBhIG1ldGFk\nYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nlc3MsCiAg\nICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5OyB0aGUg\ncmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4gY29uZmlndXJhdGlv\nbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1c2UgdGhlIGNv\nbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGltcGxlbWVudGF0aW9u\nLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRhCiAgICAgKiByZXF1\naXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZpbGVzCiAgICAg\nKiBAcGFyYW0gbG9hZGVyIHRoZSBlbnZpcm9ubWVudCBjbGFzc2xvYWRlciB0\nbyB1c2UgZm9yIGxvYWRpbmcKICAgICAqIGNsYXNzZXMgYW5kIHJlc291cmNl\ncy4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZp\nZ3VyYXRpb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIE1ldGFEYXRh\nUmVwb3NpdG9yeSByZXBvcywgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAg\nICAgX21hbmFnZWRUeXBlID0gdHlwZTsKICAgICAgICBfcGMgPSB0eXBlOwoK\nICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRp\nb24uTE9HX0VOSEFOQ0UpOwoKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkg\newogICAgICAgICAgICBfcmVwb3MgPSBjb25mLm5ld01ldGFEYXRhUmVwb3Np\ndG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIF9yZXBvcy5zZXRTb3VyY2VN\nb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01FVEEpOwogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfbWV0\nYSA9IF9yZXBvcy5nZXRNZXRhRGF0YSh0eXBlLmdldFR5cGUoKSwgbG9hZGVy\nLCBmYWxzZSk7CiAgICB9CgogICAgc3RhdGljIFN0cmluZyB0b1BDU3ViY2xh\nc3NOYW1lKENsYXNzIGNscykgewogICAgICAgIHJldHVybiBTdHJpbmdzLmdl\ndFBhY2thZ2VOYW1lKFBDRW5oYW5jZXIuY2xhc3MpICsgIi4iCiAgICAgICAg\nICAgICsgY2xzLmdldE5hbWUoKS5yZXBsYWNlKCcuJywgJyQnKSArICIkcGNz\ndWJjbGFzcyI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4g\nU3VwcGx5IGNvbmZpZ3VyYXRpb24sIHR5cGUsIGFuZCBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIHRoaXMoY29uZiwgdHlwZSwgbWV0YS5nZXRSZXBv\nc2l0b3J5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBi\neXRlY29kZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgcGVyc2lzdGVuY2UtY2Fw\nYWJsZSBjbGFzcwogICAgICogYmVpbmcgbWFuaXB1bGF0ZWQuCiAgICAgKi8K\nICAgIHB1YmxpYyBCQ0NsYXNzIGdldFBDQnl0ZWNvZGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9wYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hbmFnZWQgY2xhc3Mg\nYmVpbmcKICAgICAqIG1hbmlwdWxhdGVkLiBUaGlzIGlzIHVzdWFsbHkgdGhl\nIHNhbWUgYXMge0BsaW5rICNnZXRQQ0J5dGVjb2RlfSwKICAgICAqIGV4Y2Vw\ndCB3aGVuIHJ1bm5pbmcgdGhlIGVuaGFuY2VyIHRvIHJlZGVmaW5lIGFuZCBz\ndWJjbGFzcwogICAgICogZXhpc3RpbmcgcGVyc2lzdGVudCB0eXBlcy4KICAg\nICAqLwogICAgcHVibGljIEJDQ2xhc3MgZ2V0TWFuYWdlZFR5cGVCeXRlY29k\nZSgpIHsKICAgICAgICByZXR1cm4gX21hbmFnZWRUeXBlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNz\nIGJlaW5nIG1hbmlwdWxhdGVkLCBvciBudWxsIGlmIG5vdAogICAgICogYSBw\nZXJzaXN0ZW50IHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfbWV0YTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBj\nb25zdHJ1Y3RvciBpZiBvbmUgaXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0\naGUgY2xhc3MuIE9wZW5KUEEKICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1h\ncmcgY29uc3RydWN0b3IgKHdoZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGls\nZXIKICAgICAqIG9yIGJ5IHRoZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25z\ndHJ1Y3RvcigpIHsKICAgICAgICByZXR1cm4gX2RlZkNvbnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRo\nZSBlbmhhbmNlciBzaG91bGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3Ry\ndWN0b3IgaWYgb25lIGlzIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNs\nYXNzLiBPcGVuSlBBCiAgICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNv\nbnN0cnVjdG9yICh3aGV0aGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAg\nICAgKiBvciBieSB0aGUgdXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3Io\nYm9vbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IpIHsKICAgICAgICBfZGVm\nQ29ucyA9IGFkZERlZmF1bHRDb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRz\nIGFyZ3VtZW50cywgb3IganVzdCBydW4gdmFsaWRhdGlvbgogICAgICogYW5k\nIG9wdGlvbmFsIHN1YmNsYXNzaW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkg\ndXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVh\ndGVTdWJjbGFzcyh0cnVlKTwvY29kZT4uCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFJlZGVmaW5l\nKCkgewogICAgICAgIHJldHVybiBfcmVkZWZpbmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0\ncyBhcmd1bWVudHMsIG9yIGp1c3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFu\nZCBvcHRpb25hbCBzdWJjbGFzc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5\nIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3Jl\nYXRlU3ViY2xhc3ModHJ1ZSk8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5j\nZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZWRlZmluZShi\nb29sZWFuIHJlZGVmaW5lKSB7CiAgICAgICAgX3JlZGVmaW5lID0gcmVkZWZp\nbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRo\nYXQgdGhpcyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVl\nbgogICAgICogcmVkZWZpbmVkLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAu\nMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FscmVhZHlSZWRlZmlu\nZWQoKSB7CiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlSZWRlZmluZWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhp\ncyBpbnN0YW5jZSBpcyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAg\nICogc3ViY2xhc3NlZCBpbiB0aGlzIGluc3RhbmNlJ3MgZW52aXJvbm1lbnQg\nY2xhc3Nsb2FkZXIuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQWxyZWFkeVN1YmNsYXNzZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9pc0FscmVhZHlTdWJjbGFzc2VkOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1h\na2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICog\nb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRDcmVhdGVTdWJjbGFzcygpIHsKICAgICAgICByZXR1cm4g\nX3N1YmNsYXNzOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\nZW5oYW5jZXIgc2hvdWxkIG1ha2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5j\nZS1jYXBhYmxlLAogICAgICogb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1j\nYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDcmVhdGVTdWJjbGFzcyhib29s\nZWFuIHN1YmNsYXNzKSB7CiAgICAgICAgX3N1YmNsYXNzID0gc3ViY2xhc3M7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYgdGhl\nIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQKICAg\nICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJlIHZp\nb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyByZXN0\ncmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucygpIHsKICAgICAgICByZXR1cm4gX2Zh\naWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGZhaWwgaWYg\ndGhlIHBlcnNpc3RlbnQgdHlwZSB1c2VzIHByb3BlcnR5IGFjY2VzcyBhbmQK\nICAgICAqIGJ5dGVjb2RlIGFuYWx5c2lzIHNob3dzIHRoYXQgaXQgbWF5IGJl\nIHZpb2xhdGluZyBPcGVuSlBBJ3MgcHJvcGVydHkKICAgICAqIGFjY2VzcyBy\nZXN0cmljdGlvbnMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEVuZm9y\nY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyhib29sZWFuIGZhaWwpIHsKICAgICAg\nICBfZmFpbCA9IGZhaWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhdGVk\nIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERlZmF1bHRzIHRvCiAgICAgKiBv\ndmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xhc3MgZmlsZSBpZiBudWxsLgog\nICAgICovCiAgICBwdWJsaWMgRmlsZSBnZXREaXJlY3RvcnkoKSB7CiAgICAg\nICAgcmV0dXJuIF9kaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgYmFz\nZSBidWlsZCBkaXJlY3RvcnkgdG8gZ2VuZXJhdGUgY29kZSB0by4gVGhlIHBy\nb3BlciBwYWNrYWdlCiAgICAgKiBzdHJ1Y3R1cmUgd2lsbCBiZSBjcmVhZWQg\nYmVuZWF0aCB0aGlzIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8KICAgICAqIG92\nZXJ3cml0aW5nIHRoZSBleGlzdGluZyBjbGFzcyBmaWxlIGlmIG51bGwuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERpcmVjdG9yeShGaWxlIGRpcikg\newogICAgICAgIF9kaXIgPSBkaXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIGN1cnJlbnQge0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3\ncml0ZSB0byBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBC\neXRlY29kZVdyaXRlciBnZXRCeXRlY29kZVdyaXRlcigpIHsKICAgICAgICBy\nZXR1cm4gX3dyaXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\ne0BsaW5rIEJ5dGVjb2RlV3JpdGVyfSB0byB3cml0ZSB0aGUgYnl0ZWNvZGUg\ndG8gb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRCeXRlY29kZVdyaXRlcihCeXRlY29kZVdyaXRlciB3cml0ZXIpIHsKICAg\nICAgICBfd3JpdGVyID0gd3JpdGVyOwogICAgfQoKICAgIC8qKgogICAgICog\nUGVyZm9ybSBieXRlY29kZSBlbmhhbmNlbWVudHMuCiAgICAgKgogICAgICog\nQHJldHVybiA8Y29kZT5FTkhBTkNFXyo8L2NvZGU+IGNvbnN0YW50CiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgcnVuKCkgewogICAgICAgIGlmIChfbG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoImVuaGFuY2Utc3RhcnQiLCBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIG1hbmFnZWQgaW50\nZXJmYWNlLCBza2lwCiAgICAgICAgICAgIGlmIChfbWFuYWdlZFR5cGUuaXNJ\nbnRlcmZhY2UoKSkKICAgICAgICAgICAgICAgIHJldHVybiBFTkhBTkNFX0lO\nVEVSRkFDRTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGFscmVhZHkgZW5o\nYW5jZWQKICAgICAgICAgICAgQ2xhc3NbXSBpbnRlcmZhY2VzID0gX21hbmFn\nZWRUeXBlLmdldERlY2xhcmVkSW50ZXJmYWNlVHlwZXMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpbnRlcmZhY2VzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaW50ZXJmYWNlc1tpXS5nZXROYW1l\nKCkuZXF1YWxzKFBDVFlQRS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGMtdHlwZSIsIF9t\nYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gRU5IQU5DRV9OT05FOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBjb25maWd1cmVCQ3MoKTsKCiAgICAgICAg\nICAgIC8vIHZhbGlkYXRlIHByb3BlcnRpZXMgYmVmb3JlIHJlcGxhY2luZyBm\naWVsZCBhY2Nlc3Mgc28gdGhhdAogICAgICAgICAgICAvLyB3ZSBidWlsZCB1\ncCBhIHJlY29yZCBvZiBiYWNraW5nIGZpZWxkcywgZXRjCiAgICAgICAgICAg\nIGlmIChfbWV0YSAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBfbWV0YS5n\nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVS\nVFkpIHsKICAgICAgICAgICAgICAgIHZhbGlkYXRlUHJvcGVydGllcygpOwog\nICAgICAgICAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAg\nICAgICAgICAgICAgICAgYWRkQXR0cmlidXRlVHJhbnNsYXRpb24oKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVs\nZEFjY2VzcygpOwogICAgICAgICAgICBwcm9jZXNzVmlvbGF0aW9ucygpOwoK\nICAgICAgICAgICAgaWYgKF9tZXRhICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGVuaGFuY2VDbGFzcygpOwogICAgICAgICAgICAgICAgYWRkRmllbGRz\nKCk7CiAgICAgICAgICAgICAgICBhZGRTdGF0aWNJbml0aWFsaXplcigpOwog\nICAgICAgICAgICAgICAgYWRkUENNZXRob2RzKCk7CiAgICAgICAgICAgICAg\nICBhZGRBY2Nlc3NvcnMoKTsKICAgICAgICAgICAgICAgIGFkZEF0dGFjaERl\ndGFjaENvZGUoKTsKICAgICAgICAgICAgICAgIGFkZFNlcmlhbGl6YXRpb25D\nb2RlKCk7CiAgICAgICAgICAgICAgICBhZGRDbG9uaW5nQ29kZSgpOwogICAg\nICAgICAgICAgICAgcnVuQXV4aWxpYXJ5RW5oYW5jZXJzKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gRU5IQU5DRV9QQzsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJwZXJzLWF3YXJlIiwgX21hbmFn\nZWRUeXBlLmdldFR5cGUoKSkpOwogICAgICAgICAgICByZXR1cm4gRU5IQU5D\nRV9BV0FSRTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJlbmhhbmNlLWVycm9yIiwKICAgICAgICAgICAg\nICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkuZ2V0TmFtZSgpLCBlLmdldE1l\nc3NhZ2UoKSksIGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgY29uZmlndXJlQkNzKCkgewogICAgICAgIGlmICghX2Jjc0NvbmZpZ3Vy\nZWQpIHsKICAgICAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0QXR0cmlidXRlKFJFREVG\nSU5FRF9BVFRSSUJVVEUpID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nX21hbmFnZWRUeXBlLmFkZEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRF\nKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBf\naXNBbHJlYWR5UmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAg\nICAgICAgIFBDU3ViY2xhc3NWYWxpZGF0b3IgdmFsID0gbmV3IFBDU3ViY2xh\nc3NWYWxpZGF0b3IoCiAgICAgICAgICAgICAgICAgICAgX21ldGEsIF9tYW5h\nZ2VkVHlwZSwgX2xvZywgX2ZhaWwpOwogICAgICAgICAgICAgICAgdmFsLmFz\nc2VydENhblN1YmNsYXNzKCk7CgogICAgICAgICAgICAgICAgX3BjID0gX21h\nbmFnZWRUeXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoCiAgICAgICAgICAg\nICAgICAgICAgdG9QQ1N1YmNsYXNzTmFtZShfbWFuYWdlZFR5cGUuZ2V0VHlw\nZSgpKSk7CiAgICAgICAgICAgICAgICBpZiAoX3BjLmdldFN1cGVyY2xhc3NC\nQygpICE9IF9tYW5hZ2VkVHlwZSkgewogICAgICAgICAgICAgICAgICAgIF9w\nYy5zZXRTdXBlcmNsYXNzKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAg\nICAgICAgX3BjLnNldEFic3RyYWN0KF9tYW5hZ2VkVHlwZS5pc0Fic3RyYWN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNl\nKER5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfaXNBbHJlYWR5\nU3ViY2xhc3NlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfcGMgPSBfbWFuYWdlZFR5\ncGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9iY3NDb25maWd1cmVk\nID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0\nZSB0aGUgZ2VuZXJhdGVkIGJ5dGVjb2RlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCByZWNvcmQoKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKF9tYW5hZ2VkVHlwZSAhPSBfcGMgJiYgZ2V0UmVkZWZpbmUo\nKSkKICAgICAgICAgICAgcmVjb3JkKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAg\ncmVjb3JkKF9wYyk7CiAgICAgICAgaWYgKF9vaWRzICE9IG51bGwpCiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX29pZHMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICByZWNvcmQoKEJDQ2xh\nc3MpIGl0ci5uZXh0KCkpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUg\ndGhlIGdpdmVuIGNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVj\nb3JkKEJDQ2xhc3MgYmMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoX3dyaXRlciAhPSBudWxsKQogICAgICAgICAgICBfd3Jp\ndGVyLndyaXRlKGJjKTsKICAgICAgICBlbHNlIGlmIChfZGlyID09IG51bGwp\nCiAgICAgICAgICAgIGJjLndyaXRlKCk7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIEZpbGUgZGlyID0gRmlsZXMuZ2V0UGFja2FnZUZpbGUoX2Rpciwg\nYmMuZ2V0UGFja2FnZU5hbWUoKSwgdHJ1ZSk7CiAgICAgICAgICAgIGJjLndy\naXRlKG5ldyBGaWxlKGRpciwgYmMuZ2V0Q2xhc3NOYW1lKCkgKyAiLmNsYXNz\nIikpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRl\nIHRoYXQgdGhlIG1ldGhvZHMgaW4gdGhpcyBwcm9wZXJ0eS1hY2Nlc3MgaW5z\ndGFuY2UgYXJlCiAgICAgKiB3cml0dGVuIGNvcnJlY3RseS4gVGhpcyBtZXRo\nb2QgYWxzbyBnYXRoZXJzIGluZm9ybWF0aW9uIG9uIGVhY2gKICAgICAqIHBy\nb3BlcnR5J3MgYmFja2luZyBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHZhbGlkYXRlUHJvcGVydGllcygpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kczsKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkK\nICAgICAgICAgICAgZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgZm1kcyA9IF9tZXRhLmdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgTWV0aG9kIG1ldGg7CiAgICAgICAgQkNNZXRob2Qg\nZ2V0dGVyLCBzZXR0ZXI7CiAgICAgICAgQkNGaWVsZCByZXR1cm5lZCwgYXNz\naWduZWQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIShmbWRzW2ldLmdl\ndEJhY2tpbmdNZW1iZXIoKSBpbnN0YW5jZW9mIE1ldGhvZCkpIHsKICAgICAg\nICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktYmFkLW1lbWJlciIs\nCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBmbWRzW2ldLCBm\nbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKSB9LAogICAgICAgICAgICAgICAg\nICAgIHRydWUpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIG1ldGggPSAoTWV0aG9kKSBmbWRzW2ldLmdl\ndEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgLy8gIyMjIyMgdGhpcyB3\naWxsIGZhaWwgaWYgd2Ugb3ZlcnJpZGUgYW5kIGRvbid0IGNhbGwgc3VwZXIu\nCiAgICAgICAgICAgIEJDQ2xhc3MgZGVjbGFyaW5nVHlwZSA9IF9tYW5hZ2Vk\nVHlwZS5nZXRQcm9qZWN0KCkKICAgICAgICAgICAgICAgIC5sb2FkQ2xhc3Mo\nZm1kc1tpXS5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICBnZXR0\nZXIgPSBkZWNsYXJpbmdUeXBlLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBl\ncygpKTsKICAgICAgICAgICAgaWYgKGdldHRlciA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LW5vLWdldHRlciIs\nIG5ldyBPYmplY3RbXXsgZm1kc1tpXSB9LAogICAgICAgICAgICAgICAgICAg\nIHRydWUpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuZWQgPSBnZXRSZXR1cm5lZEZpZWxkKGdl\ndHRlcik7CiAgICAgICAgICAgIGlmIChyZXR1cm5lZCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmVnaXN0ZXJCYWNraW5nRmllbGRJbmZvKGZtZHNbaV0s\nIGdldHRlciwgcmV0dXJuZWQpOwoKICAgICAgICAgICAgc2V0dGVyID0gZGVj\nbGFyaW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZt\nZHNbaV0pLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgICAgIGlmIChzZXR0ZXIg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHJldHVybmVkID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3Bl\ncnR5LW5vLXNldHRlciIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgZm1kc1tpXSB9LCB0cnVlKTsKICAgICAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWdldFJl\nZGVmaW5lKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgc3lu\ndGhldGljIHNldHRlcgogICAgICAgICAgICAgICAgICAgIHNldHRlciA9IF9t\nYW5hZ2VkVHlwZS5kZWNsYXJlTWV0aG9kKGdldFNldHRlck5hbWUoZm1kc1tp\nXSksCiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdeyBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAg\nICAgICAgICAgICAgIHNldHRlci5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAg\nICAgICAgICAgIENvZGUgY29kZSA9IHNldHRlci5nZXRDb2RlKHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKDApOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChy\nZXR1cm5lZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChzZXR0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGFzc2ln\nbmVkID0gZ2V0QXNzaWduZWRGaWVsZChzZXR0ZXIpOwoKICAgICAgICAgICAg\naWYgKGFzc2lnbmVkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChz\nZXR0ZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZWdpc3RlckJh\nY2tpbmdGaWVsZEluZm8oZm1kc1tpXSwgc2V0dGVyLCBhc3NpZ25lZCk7Cgog\nICAgICAgICAgICAgICAgaWYgKGFzc2lnbmVkICE9IHJldHVybmVkKQogICAg\nICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktc2V0dGVy\nLWdldHRlci1taXNtYXRjaCIsIG5ldyBPYmplY3RbXQogICAgICAgICAgICAg\nICAgICAgICAgICB7IGZtZHNbaV0sIGFzc2lnbmVkLmdldE5hbWUoKSwgKHJl\ndHVybmVkID09IG51bGwpIAogICAgICAgICAgICAgICAgICAgICAgICA/IG51\nbGwgOiByZXR1cm5lZC5nZXROYW1lKCkgfSwgZmFsc2UpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWdpc3Rl\nckJhY2tpbmdGaWVsZEluZm8oRmllbGRNZXRhRGF0YSBmbWQsIEJDTWV0aG9k\nIG1ldGhvZCwKICAgICAgICBCQ0ZpZWxkIGZpZWxkKSB7CiAgICAgICAgaWYg\nKF9iYWNraW5nRmllbGRzID09IG51bGwpCiAgICAgICAgICAgIF9iYWNraW5n\nRmllbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfYmFja2luZ0ZpZWxk\ncy5wdXQobWV0aG9kLmdldE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgpKTsKCiAg\nICAgICAgaWYgKF9hdHRyc1RvRmllbGRzID09IG51bGwpCiAgICAgICAgICAg\nIF9hdHRyc1RvRmllbGRzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfYXR0\ncnNUb0ZpZWxkcy5wdXQoZm1kLmdldE5hbWUoKSwgZmllbGQuZ2V0TmFtZSgp\nKTsKCiAgICAgICAgaWYgKF9maWVsZHNUb0F0dHJzID09IG51bGwpCiAgICAg\nICAgICAgIF9maWVsZHNUb0F0dHJzID0gbmV3IEhhc2hNYXAoKTsKICAgICAg\nICBfZmllbGRzVG9BdHRycy5wdXQoZmllbGQuZ2V0TmFtZSgpLCBmbWQuZ2V0\nTmFtZSgpKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYWRkQXR0cmlidXRl\nVHJhbnNsYXRpb24oKSB7CiAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2Uo\nQXR0cmlidXRlVHJhbnNsYXRvci5jbGFzcyk7CiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkF0dHJpYnV0ZUlu\nZGV4VG9GaWVsZE5hbWUiLAogICAgICAgICAgICBTdHJpbmcuY2xhc3MsIG5l\ndyBDbGFzc1tdIHsgaW50LmNsYXNzIH0pOwogICAgICAgIG1ldGhvZC5tYWtl\nUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEu\nZ2V0RmllbGRzKCk7CgogICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAg\nIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBUYWJsZVN3aXRj\naEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAg\nICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgIHRhYmlucy5zZXRIaWdo\nKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgIC8vIGNhc2UgaToKICAgICAg\nICAvLyAgICAgcmV0dXJuIDxfYXR0cnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5n\nZXROYW1lKCkpPgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgKICAgICAgICAgICAgICAgIF9hdHRy\nc1RvRmllbGRzLmdldChmbWRzW2ldLmdldE5hbWUoKSkpKTsKICAgICAgICAg\nICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWZh\ndWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAg\nICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRpb24K\nICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5j\nbGFzcykpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgbmFtZSBvZiB0aGUgc2V0dGVyIG1ldGhv\nZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBTdHJpbmcgZ2V0U2V0dGVyTmFtZShGaWVsZE1ldGFEYXRhIGZtZCkg\newogICAgICAgIHJldHVybiAic2V0IiArIFN0cmluZ1V0aWxzLmNhcGl0YWxp\nemUoZm1kLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGZpZWxkIHJldHVybmVkIGJ5IHRoZSBnaXZlbiBtZXRob2QsIG9y\nIG51bGwgaWYgbm9uZS4KICAgICAqIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBz\ndGF0aWMgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxk\nIGdldFJldHVybmVkRmllbGQoQkNNZXRob2QgbWV0aCkgewogICAgICAgIHJl\ndHVybiBmaW5kRmllbGQobWV0aCwgKChDb2RlKSBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3\nQ29kZUFjdGlvbigpKSkueHJldHVybigpCiAgICAgICAgICAgIC5zZXRUeXBl\nKG1ldGguZ2V0UmV0dXJuVHlwZSgpKSwgZmFsc2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCBhc3NpZ25lZCBpbiB0aGUgZ2l2\nZW4gbWV0aG9kLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKiBQYWNrYWdlLXBy\nb3RlY3RlZCBhbmQgc3RhdGljIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBz\ndGF0aWMgQkNGaWVsZCBnZXRBc3NpZ25lZEZpZWxkKEJDTWV0aG9kIG1ldGgp\nIHsKICAgICAgICByZXR1cm4gZmluZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Q\ncml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLnB1dGZpZWxkKCksIHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmaWVsZCByZXR1\ncm5lZCAvIGFzc2lnbmVkIGJ5IDxjb2RlPm1ldGg8L2NvZGU+LiBSZXR1cm5z\nCiAgICAgKiBudWxsIGlmIG5vbi1maWVsZHMgKG1ldGhvZHMsIGxpdGVyYWxz\nLCBwYXJhbWV0ZXJzLCB2YXJpYWJsZXMpIGFyZQogICAgICogcmV0dXJuZWQs\nIG9yIGlmIG5vbi1wYXJhbWV0ZXJzIGFyZSBhc3NpZ25lZCB0byBmaWVsZHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIEJDRmllbGQgZmluZEZpZWxk\nKEJDTWV0aG9kIG1ldGgsIEluc3RydWN0aW9uIHRlbXBsYXRlLAogICAgICAg\nIGJvb2xlYW4gZmluZEFjY2Vzc2VkKSB7CiAgICAgICAgLy8gaWdub3JlIGFu\neSBzdGF0aWMgbWV0aG9kcy4gT3BlbkpQQSBvbmx5IGN1cnJlbnRseSBzdXBw\nb3J0cwogICAgICAgIC8vIG5vbi1zdGF0aWMgc2V0dGVycyBhbmQgZ2V0dGVy\ncwogICAgICAgIGlmIChtZXRoLmlzU3RhdGljKCkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUo\nZmFsc2UpOwogICAgICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAg\nICAgICAgQkNGaWVsZCBmaWVsZCA9IG51bGwsIGN1cjsKICAgICAgICBJbnN0\ncnVjdGlvbiB0ZW1wbGF0ZUlucywgcHJldklucywgZWFybGllckluczsKICAg\nICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlKSkgewog\nICAgICAgICAgICBpbnQgYmFja3VwQ291bnQgPSAzOwogICAgICAgICAgICB0\nZW1wbGF0ZUlucyA9IGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgaWYg\nKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlvdXMoKTsK\nCiAgICAgICAgICAgIGlmIChwcmV2SW5zIGluc3RhbmNlb2YgQ2xhc3NJbnN0\ncnVjdGlvbgogICAgICAgICAgICAgICAgJiYgY29kZS5oYXNQcmV2aW91cygp\nKSB7CiAgICAgICAgICAgICAgICBwcmV2SW5zID0gY29kZS5wcmV2aW91cygp\nOwogICAgICAgICAgICAgICAgYmFja3VwQ291bnQrKzsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKCFjb2RlLmhhc1ByZXZpb3VzKCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZWFybGllcklu\ncyA9IGNvZGUucHJldmlvdXMoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBv\ncGNvZGUgdHdvIGJlZm9yZSB0aGUgdGVtcGxhdGUgd2FzIGFuIGFsb2FkXzAs\nIGNoZWNrCiAgICAgICAgICAgIC8vIGFnYWluc3QgdGhlIG1pZGRsZSBpbnN0\ncnVjdGlvbiBiYXNlZCBvbiB3aGF0IHR5cGUgb2YgZmluZAogICAgICAgICAg\nICAvLyB3ZSdyZSBkb2luZwogICAgICAgICAgICBpZiAoIShlYXJsaWVySW5z\nIGluc3RhbmNlb2YgTG9hZEluc3RydWN0aW9uKQogICAgICAgICAgICAgICAg\nfHwgISgoTG9hZEluc3RydWN0aW9uKSBlYXJsaWVySW5zKS5pc1RoaXMoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgLy8g\naWYgdGhlIG1pZGRsZSBpbnN0cnVjdGlvbiB3YXMgYSBnZXRmaWVsZCwgdGhl\nbiBpdCdzIHRoZQogICAgICAgICAgICAvLyBmaWVsZCB0aGF0J3MgYmVpbmcg\nYWNjZXNzZWQKICAgICAgICAgICAgaWYgKCFmaW5kQWNjZXNzZWQgJiYgcHJl\ndklucyBpbnN0YW5jZW9mIEdldEZpZWxkSW5zdHJ1Y3Rpb24pIHsKICAgICAg\nICAgICAgICAgIGZpbmFsIEZpZWxkSW5zdHJ1Y3Rpb24gZlByZXZJbnMgPSAo\nRmllbGRJbnN0cnVjdGlvbikgcHJldkluczsKICAgICAgICAgICAgICAgIGN1\nciA9IChCQ0ZpZWxkKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRGaWVsZElu\nc3RydWN0aW9uRmllbGRBY3Rpb24oZlByZXZJbnMpKTsKICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2Fk\nXzEsIHRoZW4gdGhlCiAgICAgICAgICAgICAgICAvLyBtYXRjaGVkIGluc3Ry\ndWN0aW9uIGlzIHRoZSBmaWVsZCB0aGF0J3MgYmVpbmcgc2V0LgogICAgICAg\nICAgICB9IGVsc2UgaWYgKGZpbmRBY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3Rh\nbmNlb2YgTG9hZEluc3RydWN0aW9uCiAgICAgICAgICAgICAgICAmJiAoKExv\nYWRJbnN0cnVjdGlvbikgcHJldklucykuZ2V0UGFyYW0oKSA9PSAwKSB7CiAg\nICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZUZW1wbGF0\nZUlucyA9CiAgICAgICAgICAgICAgICAgICAgKEZpZWxkSW5zdHJ1Y3Rpb24p\nIHRlbXBsYXRlSW5zOwogICAgICAgICAgICAgICAgY3VyID0gKEJDRmllbGQp\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVy\nCiAgICAgICAgICAgICAgICAgICAgLmdldEZpZWxkSW5zdHJ1Y3Rpb25GaWVs\nZEFjdGlvbihmVGVtcGxhdGVJbnMpKTsKICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGlmIChm\naWVsZCAhPSBudWxsICYmIGN1ciAhPSBmaWVsZCkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgICAgICBmaWVsZCA9IGN1cjsKCiAgICAg\nICAgICAgIC8vIHJlYWR5IGZvciBuZXh0IHNlYXJjaCBpdGVyYXRpb24KICAg\nICAgICAgICAgd2hpbGUgKGJhY2t1cENvdW50ID4gMCkgewogICAgICAgICAg\nICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICBiYWNrdXBDb3Vu\ndC0tOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBm\naWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZCBhIHZpb2xhdGlv\nbiBvZiB0aGUgcHJvcGVydHkgYWNjZXNzIHJlc3RyaWN0aW9ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZFZpb2xhdGlvbihTdHJpbmcga2V5LCBP\nYmplY3RbXSBhcmdzLCBib29sZWFuIGZhdGFsKSB7CiAgICAgICAgaWYgKF92\naW9sYXRpb25zID09IG51bGwpCiAgICAgICAgICAgIF92aW9sYXRpb25zID0g\nbmV3IEhhc2hTZXQoKTsKICAgICAgICBfdmlvbGF0aW9ucy5hZGQoX2xvYy5n\nZXQoa2V5LCBhcmdzKSk7CiAgICAgICAgX2ZhaWwgfD0gZmF0YWw7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBMb2cgLyB0aHJvdyByZWNvcmRlZCBwcm9wZXJ0\neSBhY2Nlc3MgdmlvbGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHByb2Nlc3NWaW9sYXRpb25zKCkgewogICAgICAgIGlmIChfdmlvbGF0aW9u\ncyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFN0cmlu\nZyBzZXAgPSBKMkRvUHJpdkhlbHBlci5nZXRMaW5lU2VwYXJhdG9yKCk7CiAg\nICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF92aW9sYXRpb25zLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgp\nKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChzZXApOwogICAgICAgIH0K\nICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJwcm9wZXJ0eS12aW9s\nYXRpb25zIiwgYnVmKTsKCiAgICAgICAgaWYgKF9mYWlsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihtc2cpOwogICAgICAgIGlmIChf\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKG1z\nZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlZCBhbGwgZGlyZWN0\nIGFjY2VzcyB0byBtYW5hZ2VkIGZpZWxkcyB3aXRoIHRoZSBhcHByb3ByaWF0\nZQogICAgICogcGNHZXQvcGNTZXQgbWV0aG9kLiBOb3RlIHRoYXQgdGhpcyBp\nbmNsdWRlcyBhY2Nlc3MgdG8gZmllbGRzCiAgICAgKiBvd25lZCBieSBQZXJz\naXN0ZW5jZUNhcGFibGUgY2xhc3NlcyBvdGhlciB0aGFuIHRoaXMgb25lLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVwbGFjZUFuZFZhbGlkYXRlRmll\nbGRBY2Nlc3MoKSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgcHV0ZmllbGQvZ2V0ZmllbGQgaW5z\ndHJ1Y3Rpb25zIHRvIHNlYXJjaCBmb3IKICAgICAgICBDb2RlIHRlbXBsYXRl\nID0gKENvZGUpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpOwogICAg\nICAgIEluc3RydWN0aW9uIHB1dCA9IHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAg\nICAgICAgSW5zdHJ1Y3Rpb24gZ2V0ID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsK\nICAgICAgICBJbnN0cnVjdGlvbiBzdGF0ID0gdGVtcGxhdGUuaW52b2tlc3Rh\ndGljKCk7CgogICAgICAgIC8vIGxvb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsg\ndGhpcyBpcyBkb25lIGJlZm9yZSBhbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAg\nICAgICAvLyBzbyB3ZSBkb24ndCBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1\nZGluZyBzeW50aGV0aWMgbWV0aG9kcy4KICAgICAgICBCQ01ldGhvZFtdIG1l\ndGhvZHMgPSBfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAg\nICAgICAgQ29kZSBjb2RlOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbWV0aG9kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlID0gbWV0\naG9kc1tpXS5nZXRDb2RlKGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGRvbid0\nIG1vZGlmeSB0aGUgbWV0aG9kcyBzcGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFy\neSBlbmhhbmNlcnMKICAgICAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAh\nc2tpcEVuaGFuY2UobWV0aG9kc1tpXSkpIHsKICAgICAgICAgICAgICAgIHJl\ncGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwg\nc3RhdCk7CiAgICAgICAgICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVs\nZEFjY2Vzcyhjb2RlLCBwdXQsIGZhbHNlLCBzdGF0KTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2VzIGFs\nbCBpbnN0cnVjdGlvbnMgbWF0Y2hpbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGlu\nIHRoZSBnaXZlbgogICAgICogY29kZSBibG9jayB3aXRoIGNhbGxzIHRvIHRo\nZSBhcHByb3ByaWF0ZSBnZW5lcmF0ZWQgZ2V0dGVyL3NldHRlci4KICAgICAq\nCiAgICAgKiBAcGFyYW0gY29kZSB0aGUgY29kZSBibG9jayB0byBtb2RpZnk7\nIHRoZSBjb2RlIGl0ZXJhdG9yIHdpbGwKICAgICAqIGJlIHBsYWNlZCBiZWZv\ncmUgdGhlIGZpcnN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBzdGFydCwKICAg\nICAqIGFuZCB3aWxsIGJlIGFmdGVyIHRoZSBsYXN0IGluc3RydWN0aW9uIG9u\nIG1ldGhvZCBjb21wbGV0aW9uCiAgICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1w\nbGF0ZSBpbnN0cnVjdGlvbiB0byBzZWFyY2ggZm9yOyBlaXRoZXIgYQogICAg\nICogZ2V0ZmllbGQgb3IgcHV0ZmllbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBw\nYXJhbSBnZXQgYm9vbGVhbiBpbmRpY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQg\naW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBzdGF0IHRlbXBsYXRlIGludm9r\nZXN0YXRpYyBpbnN0cnVjdGlvbiB0byByZXBsYWNlIHdpdGgKICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNz\nKENvZGUgY29kZSwgSW5zdHJ1Y3Rpb24gaW5zLAogICAgICAgIGJvb2xlYW4g\nZ2V0LCBJbnN0cnVjdGlvbiBzdGF0KSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAg\nIEZpZWxkSW5zdHJ1Y3Rpb24gZmk7CiAgICAgICAgTWV0aG9kSW5zdHJ1Y3Rp\nb24gbWk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBvd25lcjsKICAgICAgICBT\ndHJpbmcgbmFtZSwgdHlwZU5hbWUsIG1ldGhvZE5hbWU7CiAgICAgICAgd2hp\nbGUgKGNvZGUuc2VhcmNoRm9yd2FyZChpbnMpKSB7CiAgICAgICAgICAgIC8v\nIGJhY2sgdXAgdG8gdGhlIG1hdGNoZWQgaW5zdHJ1Y3Rpb24KICAgICAgICAg\nICAgZmkgPSAoRmllbGRJbnN0cnVjdGlvbikgY29kZS5wcmV2aW91cygpOwog\nICAgICAgICAgICBuYW1lID0gZmkuZ2V0RmllbGROYW1lKCk7CiAgICAgICAg\nICAgIHR5cGVOYW1lID0gZmkuZ2V0RmllbGRUeXBlTmFtZSgpOwogICAgICAg\nICAgICBvd25lciA9IGdldFBlcnNpc3RlbmNlQ2FwYWJsZU93bmVyKG5hbWUs\nIGZpLmdldEZpZWxkRGVjbGFyZXJUeXBlKCkpOwoKICAgICAgICAgICAgaWYg\nKG93bmVyICE9IG51bGwKICAgICAgICAgICAgICAgICYmIG93bmVyLmdldEFj\nY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkg\newogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgZGlyZWN0bHkgYWNjZXNz\naW5nIGEgZmllbGQgaW4gYW5vdGhlciBjbGFzcwogICAgICAgICAgICAgICAg\nLy8gaGllcmFyY2h5IHRoYXQgdXNlcyBwcm9wZXJ0eSBhY2Nlc3MsIHNvbWV0\naGluZyBpcyB3cm9uZwogICAgICAgICAgICAgICAgaWYgKG93bmVyICE9IF9t\nZXRhICYmIG93bmVyLmdldERlY2xhcmVkRmllbGQobmFtZSkgIT0gbnVsbCAm\nJgogICAgICAgICAgICAgICAgICAgIF9tZXRhICE9IG51bGwgJiYgIW93bmVy\nLmdldERlc2NyaWJlZFR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICAu\naXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwcm9wZXJ0eS1maWVsZC1hY2Nlc3MiLAogICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W117IF9tZXRhLCBvd25lciwgbmFtZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0TWV0aG9kKCku\nZ2V0TmFtZSgpIH0pKTsKCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBk\naXJlY3RseSBhY2Nlc3NpbmcgYSBwcm9wZXJ0eS1iYWNraW5nIGZpZWxkIG91\ndHNpZGUKICAgICAgICAgICAgICAgIC8vIHRoZSBwcm9wZXJ0eSBpbiBvdXIg\nb3duIGNsYXNzLCBub3RpZnkgdXNlcgogICAgICAgICAgICAgICAgaWYgKGlz\nQmFja2luZ0ZpZWxkT2ZBbm90aGVyUHJvcGVydHkobmFtZSwgY29kZSkpCiAg\nICAgICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1maWVs\nZC1hY2Nlc3MiLCBuZXcgT2JqZWN0W117IF9tZXRhLAogICAgICAgICAgICAg\nICAgICAgICAgICBvd25lciwgbmFtZSwgY29kZS5nZXRNZXRob2QoKS5nZXRO\nYW1lKCkgfSwgZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAob3duZXIgPT0gbnVsbCB8fAogICAgICAgICAgICAgICAgb3duZXIuZ2V0\nRGVjbGFyZWRGaWVsZChmcm9tQmFja2luZ0ZpZWxkTmFtZShuYW1lKSkgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgLy8gbm90IHBlcnNpc3RlbnQgZmll\nbGQ/CiAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRSZWRl\nZmluZSgpICYmICFnZXRDcmVhdGVTdWJjbGFzcygpCiAgICAgICAgICAgICAg\nICAmJiBvd25lci5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5B\nQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhl\nIGluc3RydWN0aW9uIHdpdGggYSBjYWxsIHRvIHRoZSBnZW5lcmF0ZWQgYWNj\nZXNzCiAgICAgICAgICAgICAgICAvLyBtZXRob2QKICAgICAgICAgICAgICAg\nIG1pID0gKE1ldGhvZEluc3RydWN0aW9uKSBjb2RlLnNldChzdGF0KTsKCiAg\nICAgICAgICAgICAgICAvLyBpbnZva2UgdGhlIHByb3BlciBhY2Nlc3MgbWV0\naG9kLCB3aGV0aGVyIGdldHRlciBvciBzZXR0ZXIKICAgICAgICAgICAgICAg\nIFN0cmluZyBwcmVmaXggPSAoZ2V0KSA/IFBSRSArICJHZXQiIDogUFJFICsg\nIlNldCI7CiAgICAgICAgICAgICAgICBtZXRob2ROYW1lID0gcHJlZml4ICsg\nbmFtZTsKICAgICAgICAgICAgICAgIGlmIChnZXQpIHsKICAgICAgICAgICAg\nICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlwZShvd25lcikuZ2V0TmFtZSgp\nLAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2ROYW1lLCB0eXBlTmFt\nZSwgbmV3IFN0cmluZ1tdCiAgICAgICAgICAgICAgICAgICAgICAgIHsgZ2V0\nVHlwZShvd25lcikuZ2V0TmFtZSgpIH0pOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBtaS5zZXRNZXRob2QoZ2V0VHlw\nZShvd25lcikuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRob2ROYW1lLCAidm9pZCIsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAg\nICAgICAgICAgICB7IGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwgdHlwZU5h\nbWUgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChnZXRSZWRlZmluZSgp\nKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gZnJvbUJhY2tpbmdGaWVsZE5h\nbWUobmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAg\nICAgICAgICAgICAgYWRkTm90aWZ5QWNjZXNzKGNvZGUsIG93bmVyLmdldEZp\nZWxkKG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLm5leHQoKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gaW5zZXJ0IHRoZSBzZXQgb3BlcmF0aW9ucyBhZnRlciB0aGUgZmllbGQg\nbXV0YXRpb24sIGJ1dAogICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IGxv\nYWQgdGhlIG9sZCB2YWx1ZSBmb3IgdXNlIGluIHRoZQogICAgICAgICAgICAg\nICAgICAgIC8vIFN0YXRlTWFuYWdlci5zZXR0aW5nWFhYIG1ldGhvZC4KICAg\nICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0\naW9uIGZGaSA9IGZpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZCgKICAgICAgICAgICAgICAgICAgICAgICAgKEJDRmll\nbGQpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0RmllbGRJbnN0\ncnVjdGlvbkZpZWxkQWN0aW9uKGZGaSkpKTsKICAgICAgICAgICAgICAgICAg\nICBpbnQgdmFsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLnhzdG9yZSgpLnNldExvY2FsKHZhbCkuc2V0\nVHlwZShmaS5nZXRGaWVsZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgICAg\nIC8vIG1vdmUgcGFzdCB0aGUgcHV0ZmllbGQKICAgICAgICAgICAgICAgICAg\nICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBhZGROb3RpZnlN\ndXRhdGlvbihjb2RlLCBvd25lci5nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBhZGROb3RpZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVs\nZE1ldGFEYXRhIGZtZCkgewogICAgICAgIC8vIFBDSGVscGVyLmFjY2Vzc2lu\nZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4pOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGZtZC5nZXRJbmRleCgpKTsKICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsCiAg\nICAgICAgICAgICJhY2Nlc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAg\nICAgICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3Mg\nfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG11c3QgYmUgY2FsbGVk\nIGFmdGVyIHNldHRpbmcgdGhlIHZhbHVlIGluIHRoZSBvYmplY3QuCiAgICAg\nKiAKICAgICAqIEBwYXJhbSBjb2RlCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBw\nb3NpdGlvbiBpbiB0aGUgbG9jYWwgdmFyaWFibGUgdGFibGUgd2hlcmUgdGhl\nCiAgICAgKiBvbGQgdmFsdWUgaXMgc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFy\nYW0gdGhlIHBhcmFtZXRlciBwb3NpdGlvbiBjb250YWluaW5nIHRoZSBuZXcg\ndmFsdWUsIG9yCiAgICAgKiAtMSBpZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZh\naWxhYmxlIGFuZCBzaG91bGQgdGhlcmVmb3JlIGJlIGxvb2tlZAogICAgICog\ndXAuCiAgICAgKiBAdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBj\nb2RlLCBGaWVsZE1ldGFEYXRhIGZtZCwgaW50IHZhbCwKICAgICAgICBpbnQg\ncGFyYW0pCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gUENIZWxwZXIuc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNv\nbHV0ZS1pbmRleD4sIG9sZCwgbmV3KTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0VGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShm\nbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKTsKICAgICAgICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lh\nbCBzaWduYXR1cmVzIGZvciBwcmltaXRpdmVzIGFuZCBTdHJpbmdzCiAgICAg\nICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcu\nY2xhc3MpCiAgICAgICAgICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAg\nICAgY29kZS54bG9hZCgpLnNldExvY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsK\nICAgICAgICBpZiAocGFyYW0gPT0gLTEpIHsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdl\ndE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNl\ndFR5cGUodHlwZSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52b2tlc3Rh\ndGljKCkuc2V0TWV0aG9kKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywgInNl\ndHRpbmdGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdIHsKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgaW50LmNsYXNz\nLCB0eXBlLCB0eXBlCiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNz\nZXMgYSBmaWVsZCB0aGF0IGlzIGEgYmFja2luZwogICAgICogZmllbGQgb2Yg\nYW5vdGhlciBwcm9wZXJ0eSBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBjbGFz\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzQmFja2luZ0ZpZWxk\nT2ZBbm90aGVyUHJvcGVydHkoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewog\nICAgICAgIFN0cmluZyBtZXRoTmFtZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0\nTmFtZSgpOwogICAgICAgIHJldHVybiAhIjxpbml0PiIuZXF1YWxzKG1ldGhO\nYW1lKQogICAgICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAg\nICAgICAgICAgICYmICFuYW1lLmVxdWFscyhfYmFja2luZ0ZpZWxkcy5nZXQo\nbWV0aE5hbWUpKQogICAgICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcy5jb250\nYWluc1ZhbHVlKG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVy\nIG1ldGhvZCB0byByZXR1cm4gdGhlIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNh\ncGFibGUgY2xhc3Mgb2YKICAgICAqIHRoZSBnaXZlbiBmaWVsZC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gZmllbGROYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVs\nZAogICAgICogQHBhcmFtIG93bmVyIHRoZSBub21pbmFsIG93bmVyIG9mIHRo\nZSBmaWVsZAogICAgICogQHJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQ\nZXJzaXN0ZW5jZUNhcGFibGUgdHlwZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0\naGUgZmllbGQgKGFuZCB0aGVyZWZvcmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9k\nKSwgb3IgbnVsbCBpZiBub25lCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NN\nZXRhRGF0YSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihTdHJpbmcgZmll\nbGROYW1lLAogICAgICAgIENsYXNzIG93bmVyKSB7CiAgICAgICAgLy8gZmlu\nZCB0aGUgYWN0dWFsIGFuY2VzdG9yIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhl\nIGZpZWxkLCB0aGVuCiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlz\nIHBlcnNpc3RlbnQsIGFuZCBpZiB0aGUgZmllbGQgaXMgbWFuYWdlZAogICAg\nICAgIEZpZWxkIGYgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvd25lciwgZmll\nbGROYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGYgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIG1hbmFnZWQgaW50ZXJm\nYWNlCiAgICAgICAgaWYgKF9tZXRhICE9IG51bGwgJiYgX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHJldHVy\nbiBfbWV0YTsKCiAgICAgICAgcmV0dXJuIF9yZXBvcy5nZXRNZXRhRGF0YShm\nLmdldERlY2xhcmluZ0NsYXNzKCksIG51bGwsIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZHMgYWxsIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRo\nZSBieXRlY29kZSBieSBkZWxlZ2F0aW5nIHRvCiAgICAgKiB0aGUgdmFyaW91\ncyBhZGRYWFhNZXRob2RzICgpIGZ1bmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJ\nbmNsdWRlcwogICAgICogYWxsIHN0YXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9k\ncy4KICAgICAqIE5vdGUgdGhhdCB0aGUgJ3N0b2NrJyBtZXRob2RzIGxpa2Ug\nPGNvZGU+cGNJc1RyYW5zYWN0aW9uYWw8L2NvZGU+LAogICAgICogPGNvZGU+\ncGNGZXRjaE9iamVjdElkPC9jb2RlPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkg\naW4gdGhlCiAgICAgKiBsZWFzdC1kZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJs\nZSB0eXBlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUENNZXRob2Rz\nKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICBhZGRDbGVhckZpZWxkc01ldGhvZCgpOwogICAgICAgIGFkZE5ld0lu\nc3RhbmNlTWV0aG9kKHRydWUpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0\naG9kKGZhbHNlKTsKICAgICAgICBhZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhv\nZCgpOwogICAgICAgIGFkZFJlcGxhY2VGaWVsZHNNZXRob2RzKCk7CiAgICAg\nICAgYWRkUHJvdmlkZUZpZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRDb3B5\nRmllbGRzTWV0aG9kKCk7CgogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVy\nY2xhc3MoKSA9PSBudWxsIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAg\nICAgICAgICAgYWRkU3RvY2tNZXRob2RzKCk7CiAgICAgICAgICAgIGFkZEdl\ndFZlcnNpb25NZXRob2QoKTsKICAgICAgICAgICAgYWRkUmVwbGFjZVN0YXRl\nTWFuYWdlck1ldGhvZCgpOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElk\nZW50aXR5VHlwZSgpICE9IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04p\nCiAgICAgICAgICAgICAgICBhZGROb09wQXBwbGljYXRpb25JZGVudGl0eU1l\ndGhvZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCB0aGUgYXBwIGlk\nIG1ldGhvZHMgdG8gZWFjaCBzdWJjbGFzcyByYXRoZXIKICAgICAgICAvLyB0\naGFuIGp1c3QgdGhlIHN1cGVyY2xhc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxl\nIHRvIGhhdmUKICAgICAgICAvLyBhIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlk\nIGhpZXJhcmNoeSB0aGF0IG1hdGNoZXMgdGhlCiAgICAgICAgLy8gcGVyc2lz\ndGVudCBjbGFzcyBpbmhlcml0YW5jZSBoaWVyYXJjaHkKICAgICAgICBpZiAo\nX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9B\nUFBMSUNBVElPTgogICAgICAgICAgICAmJiAoX21ldGEuZ2V0UENTdXBlcmNs\nYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpIHx8CiAgICAg\nICAgICAgICAgICBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSAhPQogICAgICAg\nICAgICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCku\nZ2V0T2JqZWN0SWRUeXBlKCkpKSB7CiAgICAgICAgICAgIGFkZENvcHlLZXlG\naWVsZHNUb09iamVjdElkTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRD\nb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAg\nICAgIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7\nCiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRo\nb2QoZmFsc2UpOwogICAgICAgICAgICBpZiAoX21ldGEuaGFzQWJzdHJhY3RQ\nS0ZpZWxkKCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAJYWRkR2V0SURPd25p\nbmdDbGFzcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZE5ld09i\namVjdElkSW5zdGFuY2VNZXRob2QodHJ1ZSk7CiAgICAgICAgICAgIGFkZE5l\nd09iamVjdElkSW5zdGFuY2VNZXRob2QoZmFsc2UpOwogICAgICAgIH0gZWxz\nZSBpZiAoX21ldGEuaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcygpKSB7\nCiAgICAgICAgICAgIGFkZEdldElET3duaW5nQ2xhc3MoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBtZXRob2QgdG8gY2xlYXIg\nYWxsIHBlcnNpc3RlbnQgZmllbGRzOyB3ZSdsbCBjYWxsIHRoaXMgZnJvbQog\nICAgICogdGhlIG5ldyBpbnN0YW5jZSBtZXRob2QgdG8gZW5zdXJlIHRoYXQg\ndW5sb2FkZWQgZmllbGRzIGhhdmUKICAgICAqIGRlZmF1bHQgdmFsdWVzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xlYXJGaWVsZHNNZXRob2Qo\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIC8vIHByb3RlY3RlZCB2b2lkIHBjQ2xlYXJGaWVsZHMgKCkKICAgICAg\nICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAgICAgICBudWxsKTsK\nICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzdXBl\nci5wY0NsZWFyRmllbGRzICgpCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3Vw\nZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsK\nICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21l\ndGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nKSwgUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywKICAgICAgICAg\nICAgICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0gRmllbGRN\nZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRP\nVUJMRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoMEQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYWRkU2V0TWFuYWdl\nZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9CgogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNOZXdJbnN0YW5j\nZTwvY29kZT4gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqIFRoZXNl\nIG1ldGhvZHMgYXJlIHVzZWQgYnkgdGhlIGltcGwgaGVscGVyIHRvIGNyZWF0\nZSBuZXcKICAgICAqIG1hbmFnZWQgaW5zdGFuY2VzIGVmZmljaWVudGx5IHdp\ndGhvdXQgcmVmbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gb2lkIHNl\ndCB0byB0cnVlIHRvIG1pbWljIHRoZSBtZXRob2QgdmVyc2lvbiB0aGF0IHRh\na2VzCiAgICAgKiBhbiBvaWQgdmFsdWUgYXMgd2VsbCBhcyBhIHN0YXRlIG1h\nbmFnZXIKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5ld0luc3RhbmNl\nTWV0aG9kKGJvb2xlYW4gb2lkKSB7CiAgICAgICAgLy8gcHVibGljIFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwY05ld0luc3RhbmNlICguLi4pCiAgICAgICAgQ2xh\nc3NbXSBhcmdzID0KICAgICAgICAgICAgKG9pZCkgPyBuZXcgQ2xhc3NbXXsg\nU01UWVBFLCBPYmplY3QuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfQogICAgICAg\nICAgICAgICAgOiBuZXcgQ2xhc3NbXXsgU01UWVBFLCBib29sZWFuLmNsYXNz\nIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIk5ld0luc3RhbmNlIiwgUENUWVBFLCBhcmdzKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gaWYgdGhlIHR5cGUgaXMgYWJzdHJhY3QsIHRocm93IGEgVXNlckV4Y2Vw\ndGlvbgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKSB7CiAgICAgICAg\nICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIFVTRVJFWENFUCk7CiAgICAgICAg\nICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICAvLyBYWFggcGMgPSBuZXcgWFhYICgpOwogICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUoX3BjKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGluc3QgPSBjb2RlLmdldE5leHRM\nb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\naW5zdCk7CgogICAgICAgIC8vIGlmIChjbGVhcikKICAgICAgICAvLyAgIHBj\nLnBjQ2xlYXJGaWVsZHMgKCk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBh\ncmFtKChvaWQpID8gMiA6IDEpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBu\nb2NsZWFyID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndExvY2FsKGluc3QpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLCBudWxs\nKTsKCiAgICAgICAgLy8gcGMucGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAg\nICBub2NsZWFyLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5z\ndCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CgogICAg\nICAgIC8vIGNvcHkga2V5IGZpZWxkcyBmcm9tIG9pZAogICAgICAgIGlmIChv\naWQpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3Qp\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAi\nQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAg\nICAgIH0KCiAgICAgICAgLy8gcmV0dXJuIHBjOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIHRoZSA8Y29kZT5wcm90ZWN0ZWQgc3RhdGljIGludCBwY0dldE1h\nbmFnZWRGaWVsZENvdW50ICgpPC9jb2RlPgogICAgICogbWV0aG9kIHRvIHRo\nZSBieXRlY29kZSwgcmV0dXJuaW5nIHRoZSBpbmhlcml0ZWQgZmllbGQgY291\nbnQgYWRkZWQKICAgICAqIHRvIHRoZSBudW1iZXIgb2YgbWFuYWdlZCBmaWVs\nZHMgaW4gdGhlIGN1cnJlbnQgUGVyc2lzdGVuY2VDYXBhYmxlIGNsYXNzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFuYWdlZEZpZWxkQ291bnRN\nZXRob2QoKSB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNH\nZXRNYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIEJDTWV0aG9kIG1ldGhv\nZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRNYW5hZ2VkRmllbGRD\nb3VudCIsCiAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAg\nbWV0aG9kLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBtZXRob2QubWFrZVBy\nb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwoKICAgICAgICAvLyByZXR1cm4gPGZpZWxkcz4gKyBwY0luaGVy\naXRlZEZpZWxkQ291bnQKICAgICAgICAvLyBhd2hpdGU6IHRoZSBhYm92ZSBz\naG91bGQgd29yaywgYnV0IEknbSBzZWVpbmcgYSBtZXNzZWQgdXAgc2l0dWF0\naW9uCiAgICAgICAgLy8gYWxsIG9mIGEgc3VkZGVuIHdoZXJlIHdoZW4gYSBz\ndWJjbGFzcyBjYWxscyB0aGlzIG1ldGhvZCwgaXQgc29tZWhvdwogICAgICAg\nIC8vIGhhcHBlbnMgYmVmb3JlIDxjbGluaXQ+IGlzIGV2ZXIgaW52b2tlZCwg\nYW5kIHNvIG91cgogICAgICAgIC8vIHBjSW5oZXJpdGVkRmllbGRDb3VudCBm\naWVsZCBpc24ndCBpbml0aWFsaXplZCEgIHNvIGluc3RlYWQsCiAgICAgICAg\nLy8gcmV0dXJuIDxmaWVsZHM+ICsgPHN1cGVyY2xhc3M+LnBjR2V0TWFuYWdl\nZEZpZWxkQ291bnQgKCkKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5ndGgpOwogICAgICAg\nIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIENsYXNzIHN1cGVyQ2xhc3MgPSBnZXRUeXBlKF9tZXRhLmdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCkpOwogICAgICAgICAgICBTdHJpbmcgc3Vw\nZXJOYW1lID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/CiAgICAgICAgICAgICAg\nICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoc3VwZXJDbGFzcykgOgog\nICAgICAgICAgICAgICAgc3VwZXJDbGFzcy5nZXROYW1lKCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKHN1cGVyTmFtZSwK\nICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3VudCIs\nIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAgICAgICBjb2Rl\nLmlhZGQoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pcmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNw\nY1Byb3ZpZGVGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVyc2lzdGVuY2VD\nYXBhYmxlI3BjUHJvdmlkZUZpZWxkc30gbWV0aG9kcyB0byB0aGUgYnl0ZWNv\nZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm92aWRlRmllbGRz\nTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNQcm92aWRlRmllbGQgKGlu\ndCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwgdm9pZC5jbGFz\ncywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQog\nICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9kKFBSRSAr\nICJQcm92aWRlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYgbm8gZmll\nbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24KICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkg\nPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERl\nY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDAp\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCku\nc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaElu\nc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAg\nICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNl\ndEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIC8vIDxmaWVs\nZD4gPSBwY1N0YXRlTWFuYWdlci5wcm92aWRlZDx0eXBlPkZpZWxkCiAgICAg\nICAgICAgIC8vICAgICAodGhpcywgZmllbGROdW1iZXIpOwogICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgY29kZS5nZXRm\naWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAgICAgICAg\nICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgInByb3ZpZGVkIiwgZmFs\nc2UsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0\nYWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAg\nICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkc30gbWV0aG9kcyB0\nbyB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRS\nZXBsYWNlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNSZXBs\nYWNlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVwbGFjZUZpZWxk\nIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5j\nbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhl\nIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNo\nTWV0aG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCBjb2RlKTsKCiAgICAgICAg\nLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNl\ncHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0\nZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6\nIF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUs\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBj\nb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBU\nYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0\nY2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAg\nICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAg\nICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5yZXBsYWNlPHR5cGU+\nRmllbGQKICAgICAgICAgICAgLy8gICh0aGlzLCBmaWVsZE51bWJlcik7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBhZGRTZXRNYW5hZ2Vk\nVmFsdWVDb2RlIGNhbGwgYmVsb3cuCiAgICAgICAgICAgICAgICB0YWJpbnMu\nYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsK\nCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5pbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAg\nICAgICAgICAgICAgICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCks\nICJyZXBsYWNlIiwgdHJ1ZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGlm\nICghZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKS5pc1ByaW1pdGl2ZSgpKQog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShm\nbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAgICAgICAgICBh\nZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAg\nICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJn\nZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgICAgIChjb2RlLCBJbGxl\nZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAgICAgICB9CgogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBhZGRNdWx0aXBsZUZpZWxk\nc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNDb3B5Rmll\nbGRzfSBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkQ29weUZpZWxkc01ldGhvZCgpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZv\naWQgcGNDb3B5RmllbGQgKE9iamVjdCBwYywgaW50IGZpZWxkKQogICAgICAg\nIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJD\nb3B5RmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwK\nICAgICAgICAgICAgbmV3IFN0cmluZ1tdeyBfbWFuYWdlZFR5cGUuZ2V0TmFt\nZSgpLCBpbnQuY2xhc3MuZ2V0TmFtZSgpIH0pOwogICAgICAgIG1ldGhvZC5t\nYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdl\ndENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJv\ndWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVsTG9jYWwgPSBiZWdp\nblN3aXRjaE1ldGhvZChQUkUgKyAiQ29weUZpZWxkIiwgY29kZSk7CgogICAg\nICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cg\nZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRD\ncmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAg\nICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChm\nbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihj\nb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAg\nIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICAg\nICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAgICAg\nICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxl\nc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAg\nICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBvdGhlci48ZmllbGQ+\nOwogICAgICAgICAgICAgICAgLy8gb3Igc2V0PGZpZWxkPiAob3RoZXIuZ2V0\nPGZpZWxkPik7CiAgICAgICAgICAgICAgICB0YWJpbnMuYWRkVGFyZ2V0KGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAg\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSwgZmFsc2Up\nOwogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWRzW2ldKTsKCiAgICAgICAgICAgICAgICAvLyBicmVhazsKICAgICAg\nICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uICgpCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFy\nZ2V0KHRocm93RXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVs\nZHNNZXRob2RWZXJzaW9uKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCB0aGUgY29kZSBjb21tb24gdG8gdGhl\nIGJlZ2lubmluZyBvZiBib3RoIHRoZQogICAgICogcGNSZXBsYWNlRmllbGQg\nbWV0aG9kIGFuZCB0aGUgcGNQcm92aWRlRmllbGQgbWV0aG9kLiBUaGlzIGlu\nY2x1ZGVzCiAgICAgKiBjYWxjdWxhdGluZyB0aGUgcmVsYXRpdmUgZmllbGQg\nbnVtYmVyIG9mIHRoZSBkZXNpcmVkIGZpZWxkIGFuZCBjYWxsaW5nCiAgICAg\nKiB0aGUgc3VwZXJjbGFzcyBpZiBuZWNlc3NhcnkuCiAgICAgKgogICAgICog\nQHJldHVybiB0aGUgaW5kZXggaW4gd2hpY2ggdGhlIGxvY2FsIHZhcmlhYmxl\nIGhvbGRpbmcgdGhlIHJlbGF0aXZlCiAgICAgKiBmaWVsZCBudW1iZXIgaXMg\nc3RvcmVkCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGJlZ2luU3dpdGNoTWV0\naG9kKFN0cmluZyBuYW1lLCBDb2RlIGNvZGUpIHsKICAgICAgICBib29sZWFu\nIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFscyhuYW1lKTsKICAg\nICAgICBpbnQgZmllbGROdW1iZXIgPSAoY29weSkgPyAxIDogMDsKCiAgICAg\nICAgaW50IHJlbExvY2FsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAg\nICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXIpOwogICAgICAg\nICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKHJlbExvY2FsKTsKICAgICAg\nICAgICAgcmV0dXJuIHJlbExvY2FsOwogICAgICAgIH0KCiAgICAgICAgLy8g\naW50IHJlbCA9IGZpZWxkTnVtYmVyIC0gcGNJbmhlcml0ZWRGaWVsZENvdW50\nCiAgICAgICAgY29kZS5pbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsK\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGlu\ndC5jbGFzcyk7CiAgICAgICAgY29kZS5pc3ViKCk7CiAgICAgICAgY29kZS5p\nc3RvcmUoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgY29kZS5pbG9h\nZCgpLnNldExvY2FsKHJlbExvY2FsKTsKCiAgICAgICAgLy8gc3VwZXI6IGlm\nIChyZWwgPCAwKSBzdXBlci5wY1JlcGxhY2VGaWVsZCAoZmllbGROdW1iZXIp\nOyByZXR1cm47CiAgICAgICAgLy8gbm8gc3VwZXI6IGlmIChyZWwgPCAwKSB0\naHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZnZSgpOwogICAgICAg\nIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBTdHJpbmdbXSBhcmdzOwogICAgICAgICAgICBpZiAoY29weSkg\newogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgZ2V0VHlw\nZShfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS4KICAgICAgICAg\nICAgICAgICAgICBnZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkgfTsK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IFN0\ncmluZ1tdeyBpbnQuY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgIGNv\nZGUuaWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRh\nLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSku\nZ2V0TmFtZSgpLCBuYW1lLCAKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3Mu\nZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7\nCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNv\nZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CgogICAgICAg\nIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAgICByZXR1cm4g\ncmVsTG9jYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGhlbHBlciBt\nZXRob2QsIGdpdmVuIHRoZSBwY1JlcGxhY2VGaWVsZCBvciBwY1Byb3ZpZGVG\naWVsZAogICAgICogbWV0aG9kLCBhZGRzIHRoZSBieXRlY29kZSBmb3IgdGhl\nIGNvcnJlc3BvbmRpbmcgJ3BsdXJhbCcgdmVyc2lvbgogICAgICogb2YgdGhl\nIG1ldGhvZCAtLSB0aGUgdmVyc2lvbiB0aGF0IHRha2VzIGFuIGludFtdIG9m\nIGZpZWxkcyB0bwogICAgICogdG8gYWNjZXNzIHJhdGhlciB0aGFuIGEgc2lu\nZ2xlIGZpZWxkLiBUaGUgbXVsdGlwbGUgZmllbGRzIHZlcnNpb24KICAgICAq\nIHNpbXBseSBsb29wcyB0aHJvdWdoIHRoZSBwcm92aWRlZCBpbmRleGVzIGFu\nZCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiBzaW5ndWxhciB2ZXJzaW9uIGZv\nciBlYWNoIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE11bHRp\ncGxlRmllbGRzTWV0aG9kVmVyc2lvbihCQ01ldGhvZCBzaW5nbGUpIHsKICAg\nICAgICBib29sZWFuIGNvcHkgPSAoUFJFICsgIkNvcHlGaWVsZCIpLmVxdWFs\ncyhzaW5nbGUuZ2V0TmFtZSgpKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQg\nPG1ldGhvZD5zIChpbnRbXSBmaWVsZHMpCiAgICAgICAgQ2xhc3NbXSBhcmdz\nID0gKGNvcHkpID8gbmV3IENsYXNzW117IE9iamVjdC5jbGFzcywgaW50W10u\nY2xhc3MgfQogICAgICAgICAgICA6IG5ldyBDbGFzc1tdeyBpbnRbXS5jbGFz\ncyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKHNpbmdsZS5nZXROYW1lKCkgKyAicyIsCiAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICBpbnQgZmllbGROdW1iZXJzID0gMDsKICAg\nICAgICBpbnQgaW5zdCA9IDA7CiAgICAgICAgaWYgKGNvcHkpIHsKICAgICAg\nICAgICAgZmllbGROdW1iZXJzID0gMTsKCiAgICAgICAgICAgIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICAvLyBnZXQgdGhl\nIG1hbmFnZWQgaW5zdGFuY2UgaW50byB0aGUgbG9jYWwgdmFyaWFibGUgdGFi\nbGUKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsK\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKEltcGxIZWxwZXIuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgImdldE1h\nbmFnZWRJbnN0YW5jZSIsIE9iamVjdC5jbGFzcywKICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShfbWFuYWdlZFR5cGUp\nOwogICAgICAgICAgICAgICAgaW5zdCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0lu\nZGV4KCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2Fs\nKGluc3QpOwoKICAgICAgICAgICAgICAgIC8vIHRoZXJlIG1pZ2h0IGJlIGEg\nZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBjbGFzc2VzIG9mICd0aGlzJwogICAg\nICAgICAgICAgICAgLy8gdnMgJ290aGVyJyBpbiB0aGlzIGNvbnRleHQ7IHVz\nZSB0aGUgUEMgbWV0aG9kcyB0byBnZXQgdGhlIFNNCiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgICAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAg\nICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoSW1wbEhlbHBlci5j\nbGFzcywKICAgICAgICAgICAgICAgICAgICAidG9QZXJzaXN0ZW5jZUNhcGFi\nbGUiLCBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAg\nICAgICAgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIE9iamVjdC5jbGFz\ncyB9KTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCku\nc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAg\nICAgICAgICAgICAicGNHZXRTdGF0ZU1hbmFnZXIiLCBTdGF0ZU1hbmFnZXIu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgLy8gWFhYIG90aGVyID0gKFhYWCkgcGM7CiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBj\nb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX3BjKTsKICAgICAgICAgICAgICAg\nIGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgICAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAgICAg\nICAgICAgICAvLyBhY2Nlc3MgdGhlIG90aGVyJ3Mgc20gZmllbGQgZGlyZWN0\nbHkKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0\nKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYg\nKG90aGVyLnBjU3RhdGVNYW5hZ2VyICE9IHBjU3RhdGVNYW5hZ2VyKQogICAg\nICAgICAgICAvLwl0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nCgogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmYWNtcGVxKCk7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNv\nZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgICAg\nIC8vIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxsKQogICAgICAgICAgICAv\nLyAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbgogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgICAg\nIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbi5j\nbGFzcyk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgp\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGZvciAoaW50IGkgPSAwOwogICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAgICBpbnQg\naWR4ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2Rl\nLmlzdG9yZSgpLnNldExvY2FsKGlkeCk7CiAgICAgICAgSnVtcEluc3RydWN0\naW9uIHRlc3RpbnMgPSBjb2RlLmdvMigpOwoKICAgICAgICAvLyA8bWV0aG9k\nPiAoZmllbGRzW2ldKTsKICAgICAgICBJbnN0cnVjdGlvbiBib2R5aW5zID0g\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgaWYg\nKGNvcHkpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0\nKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXJz\nKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoaWR4KTsKICAgICAg\nICBjb2RlLmlhbG9hZCgpOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChzaW5nbGUpOwoKICAgICAgICAvLyBpKys7CiAgICAgICAg\nY29kZS5paW5jKCkuc2V0SW5jcmVtZW50KDEpLnNldExvY2FsKGlkeCk7Cgog\nICAgICAgIC8vIGkgPCBmaWVsZHMubGVuZ3RoCiAgICAgICAgdGVzdGlucy5z\nZXRUYXJnZXQoY29kZS5pbG9hZCgpLnNldExvY2FsKGlkeCkpOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcnMpOwogICAgICAg\nIGNvZGUuYXJyYXlsZW5ndGgoKTsKICAgICAgICBjb2RlLmlmaWNtcGx0KCku\nc2V0VGFyZ2V0KGJvZHlpbnMpOwogICAgICAgIGNvZGUudnJldHVybigpOwoK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdGhlICdzdG9jaycgbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGU7IHRo\nZXNlIGluY2x1ZGUgbWV0aG9kcwogICAgICogbGlrZSB7QGxpbmsgUGVyc2lz\ndGVuY2VDYXBhYmxlI3BjRmV0Y2hPYmplY3RJZH0KICAgICAqIGFuZCB7QGxp\nbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjSXNUcmFuc2FjdGlvbmFsfS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN0b2NrTWV0aG9kcygpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gcGNHZXRHZW5lcmljQ29udGV4dAogICAgICAg\nICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAg\nICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVj\nbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFNN\nVFlQRSwgImdldCIgKyBDT05URVhUTkFNRSwgKENsYXNzW10pIG51bGwpKSwg\nZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjRmV0Y2hPYmplY3RJZAog\nICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0aG9kKAog\nICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAg\nICAgIFNNVFlQRSwgImZldGNoT2JqZWN0SWQiLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RlbGV0ZWQKICAg\nICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAg\nICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdl\ndERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAg\nICBTTVRZUEUsICJpc0RlbGV0ZWQiLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxz\nZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc0RpcnR5CiAgICAgICAgICAg\nIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAg\nICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJl\nZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBF\nLCAiaXNEaXJ0eSIsIChDbGFzc1tdKSBudWxsKSksIHRydWUpOwogICAgCiAg\nICAgICAgICAgIC8vIHBjSXNOZXcKICAgICAgICAgICAgdHJhbnNsYXRlRnJv\nbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRob2Qp\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJpc05ldyIsIChD\nbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBw\nY0lzUGVyc2lzdGVudAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVN\nYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAg\nICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzUGVyc2lzdGVudCIsIChD\nbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBw\nY0lzVHJhbnNhY3Rpb25hbAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3Rh\ndGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzVHJhbnNhY3Rpb25h\nbCIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAg\nICAvLyBwY1NlcmlhbGl6aW5nCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21T\ndGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAic2VyaWFsaXppbmci\nLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAg\nLy8gcGNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5h\nZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJE\nb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgIFNNVFlQRSwgImRpcnR5IiwgbmV3IENsYXNzW117\nIFN0cmluZy5jbGFzcyB9KSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAv\nLyBwY0dldFN0YXRlTWFuYWdlcgogICAgICAgICAgICBCQ01ldGhvZCBtZXRo\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFN0YXRlTWFuYWdlciIs\nCiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXIuY2xhc3MsIG51bGwpOwog\nICAgICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFN0YXRl\nTWFuYWdlci5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwog\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfSBjYXRj\naCAoUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAg\nICAgIHRocm93IChOb1N1Y2hNZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNl\ncHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIGFkZCBhIHN0b2NrIG1ldGhvZCB0byB0aGUgYnl0ZWNv\nZGUuIEVhY2gKICAgICAqIHN0b2NrIG1ldGhvZCBzaW1wbHkgZGVsZWdhdGVz\nIHRvIGEgY29ycmVzcG9uZGluZyBTdGF0ZU1hbmFnZXIgbWV0aG9kLgogICAg\nICogR2l2ZW4gdGhlIFN0YXRlTWFuYWdlciBtZXRob2QsIHRoZW4sIHRoaXMg\nZnVuY3Rpb24gdHJhbnNsYXRlcyBpdCBpbnRvCiAgICAgKiB0aGUgd3JhcHBl\nciBtZXRob2QgdGhhdCBzaG91bGQgYmUgYWRkZWQgdG8gdGhlIGJ5dGVjb2Rl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNsYXRlRnJvbVN0YXRl\nTWFuYWdlck1ldGhvZChNZXRob2QgbSwKICAgICAgICBib29sZWFuIGlzRGly\ndHlDaGVja01ldGhvZCkgewogICAgICAgIC8vIGZvcm0gdGhlIG5hbWUgb2Yg\ndGhlIG1ldGhvZCBieSBwcmVwZW5kaW5nICdwYycgdG8gdGhlIHNtIG1ldGhv\nZAogICAgICAgIFN0cmluZyBuYW1lID0gUFJFICsgU3RyaW5nVXRpbHMuY2Fw\naXRhbGl6ZShtLmdldE5hbWUoKSk7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMg\nPSBtLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgQ2xhc3MgcmV0dXJu\nVHlwZSA9IG0uZ2V0UmV0dXJuVHlwZSgpOwoKICAgICAgICAvLyBhZGQgdGhl\nIG1ldGhvZCB0byB0aGUgcGMKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChuYW1lLCByZXR1cm5UeXBlLCBwYXJhbXMpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJuIDxk\nZWZhdWx0PjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5p\nZm5vbm51bGwoKTsKICAgICAgICBpZiAocmV0dXJuVHlwZS5lcXVhbHMoYm9v\nbGVhbi5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShmYWxzZSk7CiAgICAgICAgZWxzZSBpZiAoIXJldHVyblR5cGUuZXF1\nYWxzKHZvaWQuY2xhc3MpKQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0TnVsbCgpOwogICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUocmV0\ndXJuVHlwZSk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGRpcnR5LWNo\nZWNrIG1ldGhvZCBhbmQgd2UncmUgc3ViY2xhc3NpbmcgYnV0IG5vdAogICAg\nICAgIC8vIHJlZGVmaW5pbmcsIGhvb2sgaW50byBQQ0hlbHBlciB0byBkbyB0\naGUgZGlydHkgY2hlY2sKICAgICAgICBpZiAoaXNEaXJ0eUNoZWNrTWV0aG9k\nICYmICFnZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIFJlZGVmaW5p\ndGlvbkhlbHBlci5kaXJ0eUNoZWNrKHNtKTsKICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsK\nICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZ\nUEUpOwogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgdGhlIHJldHVy\nbiBzdGF0ZW1lbnQgYmVsb3cKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNzLCAKICAg\nICAgICAgICAgICAgICJkaXJ0eUNoZWNrIiwgdm9pZC5jbGFzcywgbmV3IENs\nYXNzW10geyBTTVRZUEUgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxk\nKFNNLCBTTVRZUEUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBy\nZXR1cm4gcGNTdGF0ZU1hbmFnZXIuPG1ldGhvZD4gKDxhcmdzPik7CiAgICAg\nICAgLy8gbWFuYWdlZCBpbnN0YW5jZSBsb2FkZWQgYWJvdmUgaW4gaWYtZWxz\nZSBibG9jawogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0o\naSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nbSk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBl\nKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjR2V0\nVmVyc2lvbn0gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZEdldFZlcnNpb25NZXRob2QoKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRWZXJzaW9u\nIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\naWYgKHBjU3RhdGVNYW5hZ2VyID09IG51bGwpCiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSB2ZXJzaW9uRmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQo\nKTsKCiAgICAgICAgaWYgKHZlcnNpb25GaWVsZCA9PSBudWxsKQogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOyAvLyByZXR1cm4gbnVs\nbDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gcmV0dXJuIDx2ZXJz\naW9uRmllbGQ+OwogICAgICAgICAgICBDbGFzcyB3cmFwcGVyID0gdG9Qcmlt\naXRpdmVXcmFwcGVyKHZlcnNpb25GaWVsZCk7CiAgICAgICAgICAgIGlmICh3\ncmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJlZFR5cGUoKSkgewog\nICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh3cmFwcGVyKTsK\nICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lv\nbkZpZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIgIT0gdmVyc2lvbkZp\nZWxkLmdldERlY2xhcmVkVHlwZSgpKQogICAgICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHdyYXBwZXIsICI8aW5pdD4iLCB2\nb2lkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyB2\nZXJzaW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfQog\nICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyByZXR1cm4gcGNT\ndGF0ZU1hbmFnZXIuZ2V0VmVyc2lvbiAoKTsKICAgICAgICBpZmlucy5zZXRU\nYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZUEUs\nICJnZXRWZXJzaW9uIiwgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICBudWxs\nKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZlcnNp\nb24gZmllbGQgdHlwZSBhcyBhIHByaW1pdGl2ZSB3cmFwcGVyLCBvciBudWxs\nIGlmCiAgICAgKiB0aGUgdmVyc2lvbiBmaWVsZCBpcyBub3QgcHJpbWl0aXZl\nLgogICAgICovCiAgICBwcml2YXRlIENsYXNzIHRvUHJpbWl0aXZlV3JhcHBl\ncihGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4u\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gQnl0ZS5jbGFzczsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBDaGFy\nYWN0ZXIuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgIHJldHVybiBEb3VibGUuY2xhc3M7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAg\ncmV0dXJuIEZsb2F0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci5jbGFzczsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAg\nICAgIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBTaG9ydC5jbGFz\nczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdGhlIHtAbGluayBQ\nZXJzaXN0ZW5jZUNhcGFibGUjcGNSZXBsYWNlU3RhdGVNYW5hZ2VyfQogICAg\nICogbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZFJlcGxhY2VTdGF0ZU1hbmFnZXJNZXRob2QoKSB7CiAgICAg\nICAgLy8gcHVibGljIHZvaWQgcGNSZXBsYWNlU3RhdGVNYW5hZ2VyIChTdGF0\nZU1hbmFnZXIgc20pCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIiLAogICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU01UWVBFIH0pOwog\nICAgICAgIG1ldGhvZC5zZXRTeW5jaHJvbml6ZWQodHJ1ZSk7CiAgICAgICAg\nbWV0aG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKFNlY3Vy\naXR5RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBjU3RhdGVNYW5h\nZ2VyICE9IG51bGwpCiAgICAgICAgLy8JcGNTdGF0ZU1hbmFnZXIgPSBwY1N0\nYXRlTWFuYWdlci5yZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVt\ncEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgInJlcGxhY2VTdGF0ZU1hbmFnZXIi\nLAogICAgICAgICAgICBTTVRZUEUsIG5ldyBDbGFzc1tdeyBTTVRZUEUgfSk7\nCiAgICAgICAgY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBTZWN1cml0\neU1hbmFnZXIgc2VjID0gU3lzdGVtLmdldFNlY3VyaXR5TWFuYWdlciAoKTsK\nICAgICAgICAvLyBpZiAoc2VjICE9IG51bGwpCiAgICAgICAgLy8JCXNlYy5j\naGVja1Blcm1pc3Npb24gKFBlcm1pc3Npb24uU0VUX1NUQVRFX01BTkFHRVIp\nOwogICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLmludm9rZXN0YXRpYygp\nLnNldE1ldGhvZChTeXN0ZW0uY2xhc3MsCiAgICAgICAgICAgICJnZXRTZWN1\ncml0eU1hbmFnZXIiLCBTZWN1cml0eU1hbmFnZXIuY2xhc3MsIG51bGwpKTsK\nCiAgICAgICAgLy8gcGNTdGF0ZU1hbmFnZXIgPSBzbTsKICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBj\nb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgUGVyc2lzdGVuY2VDYXBh\nYmxlIG1ldGhvZHMgZGVhbGluZyB3aXRoIGFwcGxpY2F0aW9uCiAgICAgKiBp\nZGVudGl0eSBhbmQgZ2l2ZXMgdGhlbSBuby1vcCBpbXBsZW1lbnRhdGlvbnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGROb09wQXBwbGljYXRpb25J\nZGVudGl0eU1ldGhvZHMoKSB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGND\nb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0SWRGaWVsZFN1cHBsaWVy\nIGZzLAogICAgICAgIC8vIAlPYmplY3Qgb2lkKQogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5Rmll\nbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdeyBPSURGU1RZUEUsIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09i\namVjdElkIChPYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xh\nc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtl\neUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZj\nLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3Bj\nLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNGcm9tT2JqZWN0\nSWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lE\nRkNUWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVybigpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAgIC8vIHB1\nYmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0\nIG9pZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUg\nKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUu\ndnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3Rh\nbmNlICgpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJF\nICsgIk5ld09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBPYmplY3Qu\nY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0\ncnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5j\nZSAoT2JqZWN0IG9iaikKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAg\nIE9iamVjdC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdGhlIDxjb2RlPnBjQ29weUtleUZpZWxkc1RvT2JqZWN0\nSWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBw\nbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRDb3B5S2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxk\nTWFuYWdlcikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNUb09i\namVjdElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAgICAgICAgLy8J\nT2JqZWN0IG9pZCkKICAgICAgICBTdHJpbmdbXSBhcmdzID0gKGZpZWxkTWFu\nYWdlcikgPwogICAgICAgICAgICBuZXcgU3RyaW5nW117IE9JREZTVFlQRS5n\nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAg\nICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9Owog\nICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJDb3B5S2V5RmllbGRzVG9PYmplY3RJZCIsCiAgICAgICAgICAgIHZv\naWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc2luZ2xlIGZp\nZWxkIGlkZW50aXR5IGFsd2F5cyB0aHJvd3MgZXhjZXB0aW9uCiAgICAgICAg\naWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAg\ndGhyb3dFeGNlcHRpb24oY29kZSwgSU5URVJORVhDRVApOwogICAgICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhvZAogICAgICAgIGlmIChfbWV0YS5n\nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFnZXRDcmVhdGVTdWJjbGFz\ncygpKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3Mu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oaSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNl\ndE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwgdm9pZC5jbGFz\ncy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gT2Jq\nZWN0IGlkID0gb2lkOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAg\nICAgaWYgKF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAg\nICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElkICgpOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0SWQuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLy8gPG9p\nZCB0eXBlPiBpZCA9ICg8b2lkIHR5cGU+KSBvaWQ7CiAgICAgICAgaW50IGlk\nID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBDbGFzcyBv\naWRUeXBlID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUu\nYXN0b3JlKCkuc2V0TG9jYWwoaWQpOwoKICAgICAgICAvLyBpbnQgaW5oZXJp\ndGVkID0gcGNJbmhlcml0ZWRGaWVsZENvdW50OwogICAgICAgIGludCBpbmhl\ncml0ZWQgPSAwOwogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsKICAgICAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQu\nY2xhc3MpOwogICAgICAgICAgICBpbmhlcml0ZWQgPSBjb2RlLmdldE5leHRM\nb2NhbHNJbmRleCgpOwogICAgICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExv\nY2FsKGluaGVyaXRlZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZC48Zmll\nbGQ+ID0gZnMuZmV0Y2g8dHlwZT5GaWVsZCAoPGluZGV4Pik7IG9yLi4uCiAg\nICAgICAgLy8gaWQuPGZpZWxkPiA9IHBjLjxmaWVsZD47CiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21l\ndGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgIENsYXNzIHR5cGU7CiAgICAgICAgU3RyaW5n\nIG5hbWU7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAgICAgTWV0aG9kIHNl\ndHRlcjsKICAgICAgICBib29sZWFuIHJlZmxlY3Q7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\naWQpOwoKICAgICAgICAgICAgbmFtZSA9IGZtZHNbaV0uZ2V0TmFtZSgpOwog\nICAgICAgICAgICB0eXBlID0gZm1kc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlw\nZSgpOwogICAgICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09\nIENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAg\nICBzZXR0ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgZmllbGQgPSBSZWZs\nZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVlKTsKICAgICAg\nICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMoZmllbGQu\nZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAgICAgaWYgKHJlZmxlY3Qp\nIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5z\nZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rp\nb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAiZmluZEZpZWxk\nIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgYm9vbGVhbi5j\nbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDsKICAgICAgICAgICAg\nICAgIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihvaWRUeXBlLCBu\nYW1lLCB0eXBlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAh\nTW9kaWZpZXIuaXNQdWJsaWMoc2V0dGVyLmdldE1vZGlmaWVycygpKTsKICAg\nICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgp\nLnNldENsYXNzKHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNz\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRTZXR0ZXIiLCBNZXRo\nb2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3MsCiAgICAgICAg\nICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgQ2xhc3MuY2xhc3MsIGJv\nb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsKICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAg\nICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpbmhlcml0ZWQpOwogICAgICAg\nICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZWludGVyZmFjZSgpLnNldE1ldGhvZAogICAgICAgICAgICAgICAgICAg\nIChnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKHR5cGUpKTsKCiAgICAgICAgICAg\nICAgICAvLyBpZiB0aGUgdHlwZSBvZiB0aGlzIGZpZWxkIG1ldGEgZGF0YSBp\ncwogICAgICAgICAgICAgICAgLy8gbm9uLXByaW1pdGl2ZSBhbmQgbm9uLXN0\ncmluZywgYmUgc3VyZSB0byBjYXN0CiAgICAgICAgICAgICAgICAvLyB0byB0\naGUgYXBwcm9wcmlhdGUgdHlwZS4KICAgICAgICAgICAgICAgIGlmICghcmVm\nbGVjdCAmJiAhdHlwZS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAgICAgICAg\nICAgJiYgIXR5cGUuZ2V0TmFtZSgpLmVxdWFscyhTdHJpbmcuY2xhc3MuZ2V0\nTmFtZSgpKSkKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgp\nLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1k\nc1tpXSk7CgogICAgICAgICAgICAgICAgLy8gZ2V0IGlkL3BrIGZyb20gcGMg\naW5zdGFuY2UKICAgICAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAg\nICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwg\nZm1kc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZWZs\nZWN0ICYmIGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJz\nZXQiLCAKICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7IE9iamVjdC5jbGFzcywgRmllbGQuY2xhc3MsCiAgICAgICAgICAg\nICAgICAgICAgKHR5cGUuaXNQcmltaXRpdmUoKSkgPyB0eXBlIDogT2JqZWN0\nLmNsYXNzIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlZmxlY3QpIHsg\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwgCiAgICAgICAgICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBPYmplY3QuY2xhc3MsIE1l\ndGhvZC5jbGFzcywKICAgICAgICAgICAgICAgICAgICAodHlwZS5pc1ByaW1p\ndGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoZmllbGQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGNv\nZGUucHV0ZmllbGQoKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChzZXR0ZXIpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgY29kZSB0byBleHRyYWN0IHRoZSBpZCBvZiB0aGUgZ2l2ZW4g\ncHJpbWFyeSBrZXkgcmVsYXRpb24gZmllbGQgZm9yCiAgICAgKiBzZXR0aW5n\nIGludG8gYW4gb2JqZWN0aWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29kZShDb2Rl\nIGNvZGUsIEZpZWxkTWV0YURhdGEgcGspIHsKICAgICAgICAvLyBpZiAodmFs\nICE9IG51bGwpIAogICAgICAgIC8vICB2YWwgPSAoKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSkgdmFsKS5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICBpbnQgcGMg\nPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0\nb3JlKCkuc2V0TG9jYWwocGMpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRM\nb2NhbChwYyk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmbnVsbDEgPSBj\nb2RlLmlmbnVsbCgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChw\nYyk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5jbGFzcyk7IAogICAgICAgIGNvZGUuaW52b2tlaW50ZXJm\nYWNlKCkuc2V0TWV0aG9kKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAg\nICAgICAgICAgUFJFICsgIkZldGNoT2JqZWN0SWQiLCBPYmplY3QuY2xhc3Ms\nIG51bGwpOwogICAgICAgIGludCBvaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJ\nbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwob2lkKTsK\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBK\ndW1wSW5zdHJ1Y3Rpb24gaWZudWxsMiA9IGNvZGUuaWZudWxsKCk7IAoKICAg\nICAgICAvLyBmb3IgZGF0YXN0b3JlIC8gc2luZ2xlLWZpZWxkIGlkZW50aXR5\nOgogICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAvLyAgIHZh\nbCA9ICgoT3BlbkpQQUlkKSB2YWwpLmdldElkKCk7CiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBwa21ldGEgPSBway5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgp\nOwogICAgICAgIGludCBwa2NvZGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlw\nZUNvZGUoKTsKICAgICAgICBDbGFzcyBwa3R5cGUgPSBway5nZXRPYmplY3RJ\nZEZpZWxkVHlwZSgpOwogICAgICAgIGlmIChwa21ldGEuZ2V0SWRlbnRpdHlU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUgCiAgICAgICAg\nICAgICYmIHBrY29kZSA9PSBKYXZhVHlwZXMuTE9ORykgewogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgY29k\nZS5jaGVja2Nhc3QoKS5zZXRUeXBlKElkLmNsYXNzKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKElkLmNsYXNzLCAiZ2V0\nSWQiLCAKICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAg\nICAgIH0gZWxzZSBpZiAocGttZXRhLmdldElkZW50aXR5VHlwZSgpID09IENs\nYXNzTWV0YURhdGEuSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgIH0gZWxzZSBpZiAocGtt\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgc3dpdGNo\nIChwa2NvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZ\nVEVfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5\ncGUoQnl0ZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQnl0ZUlkLmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoQnl0ZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAg\nICAgICAgICBieXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5CWVRFX09CSikKICAgICAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKEJ5dGUuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2J5dGUuY2xhc3N9KTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUoQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8v\nIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFS\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShDaGFySWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChDaGFySWQuY2xhc3MsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVz\nLkNIQVJfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoQ2hhcmFjdGVyLmNsYXNzLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXSB7Y2hhci5jbGFzc30pOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxF\nX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKERvdWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAo\nKTsKICAgICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEb3VibGVJZC5jbGFz\ncyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKERvdWJsZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAg\nICAgICAgICAgICAgICBkb3VibGUuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkRPVUJMRV9PQkop\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZChEb3VibGUuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2Rv\ndWJsZS5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAg\nICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoRmxvYXQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShGbG9hdElkLmNsYXNzKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRmxvYXRJ\nZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgZmxv\nYXQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2Nv\nZGUgPT0gSmF2YVR5cGVzLkZMT0FUX09CSikKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEZsb2F0LmNs\nYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtmbG9hdC5jbGFzc30pOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXco\nKS5zZXRUeXBlKEludGVnZXIuY2xhc3MpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoSW50SWQu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChJbnRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5JTlRfT0JKKQogICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoSW50ZWdlci5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7aW50LmNs\nYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKExvbmcuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxP\nTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2Fs\nKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKExvbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKExvbmdJZC5jbGFzcywgImdl\ndElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9uZy5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlw\nZXMuTE9OR19PQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChMb25nLmNsYXNzLCAiPGluaXQ+IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHtsb25nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShTaG9y\ndC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFNob3J0SWQuY2xhc3MpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChTaG9ydElkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAg\nICAgICBzaG9ydC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuU0hPUlRfT0JKKQogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nU2hvcnQuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde3Nob3J0LmNsYXNzfSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEYXRlSWQuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChE\nYXRlSWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAg\nIERhdGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShT\ndHJpbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZ0lkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmlnRGVjaW1hbElkLmNs\nYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoQmlnRGVjaW1hbElkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBCaWdEZWNpbWFsSWQuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoQmlnSW50ZWdlcklkLmNs\nYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoQmlnSW50ZWdlcklkLmNsYXNzLCAiZ2V0SWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBCaWdJbnRlZ2VySWQuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5j\nbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBp\nZiAocGttZXRhLmdldE9iamVjdElkVHlwZSgpICE9IG51bGwpIHsKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShwa3R5cGUpOwogICAgICAgIH0g\nZWxzZQogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28yID0gY29kZS5nbzIoKTsKCiAg\nICAgICAgLy8gaWYgKHZhbCA9PSBudWxsKQogICAgICAgIC8vICAgdmFsID0g\nPGRlZmF1bHQ+OwogICAgICAgIEluc3RydWN0aW9uIGRlZjsKICAgICAgICBz\nd2l0Y2ggKHBrY29kZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAg\nZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChieXRlKSAwKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DSEFSOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKChjaGFyKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBkZWYg\nPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAg\nICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgw\nTCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoKHNob3J0KSAwKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\nZGVmID0gY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICB9CiAg\nICAgICAgaWZudWxsMS5zZXRUYXJnZXQoZGVmKTsKICAgICAgICBpZm51bGwy\nLnNldFRhcmdldChkZWYpOwogICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5u\nb3AoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5w\nY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAg\nICAqIHRvIGNsYXNzZXMgdXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5S2V5RmllbGRzRnJvbU9i\namVjdElkTWV0aG9kKGJvb2xlYW4gZmllbGRNYW5hZ2VyKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1Ymxp\nYyB2b2lkIHBjQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRG\naWVsZENvbnN1bWVyIGZjLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAg\nICAgU3RyaW5nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpIAogICAgICAgICAg\nICA/ICBuZXcgU3RyaW5nW117IE9JREZDVFlQRS5nZXROYW1lKCksIE9iamVj\ndC5jbGFzcy5nZXROYW1lKCkgfQogICAgICAgICAgICA6IG5ldyBTdHJpbmdb\nXXsgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5Rmll\nbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXRO\nYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9k\nCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwg\nJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShpKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAg\nICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXRO\nYW1lKCksCiAgICAgICAgICAgICAgICBQUkUgKyAiQ29weUtleUZpZWxkc0Zy\nb21PYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAg\nICAgICB9CgogICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYg\nKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0\nSWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8gb2lkID0gKChPYmpl\nY3RJZCkgaWQpLmdldElkICgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUoT2JqZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2Rl\nLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJn\nZXRJZCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gPG9pZCB0eXBlPiBjYXN0ID0gKDxvaWQg\ndHlwZT4pIG9pZDsKICAgICAgICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2Nh\nbHNJbmRleCgpOwogICAgICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRP\nYmplY3RJZFR5cGUoKTsKICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChp\nZCk7CgogICAgICAgIC8vIGZzLnN0b3JlPHR5cGU+RmllbGQgKDxpbmRleD4s\nIGlkLjxmaWVsZD4pOyBvci4uLgogICAgICAgIC8vIHRoaXMuPGZpZWxkPiA9\nIGlkLjxmaWVsZD4KICAgICAgICAvLyBvciBmb3Igc2luZ2xlIGZpZWxkIGlk\nZW50aXR5OiBpZC5nZXRJZCAoKQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygp\nCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAg\nICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBDbGFzcyB0eXBlOwogICAgICAg\nIENsYXNzIHVud3JhcHBlZDsKICAgICAgICBGaWVsZCBmaWVsZDsKICAgICAg\nICBNZXRob2QgZ2V0dGVyOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0u\naXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIG5hbWUgPSBmbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAg\nICAgdHlwZSA9IGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAg\nICAgICAgICAgaWYgKCFmaWVsZE1hbmFnZXIgCiAgICAgICAgICAgICAgICAm\nJiBmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nUEMpIHsKICAgICAgICAgICAgICAgIC8vIHNtLmdldFBDUHJpbWFyeUtleShv\naWQsIGkgKyBwY0luaGVyaXRlZEZpZWxkQ291bnQpOyAKICAgICAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgY29kZS5kdXAoKTsgLy8gbGVhdmUgb3JpZyBvbiBzdGFjayB0\nbyBzZXQgdmFsdWUgaW50bwogICAgICAgICAgICAgICAgY29kZS5nZXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKICAgICAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAg\nICAgICAgICAgICAgIGNvZGUuaWFkZCgpOwogICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU3RhdGVNYW5hZ2VyLmNs\nYXNzLCAKICAgICAgICAgICAgICAgICAgICAiZ2V0UENQcmltYXJ5S2V5Iiwg\nT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3Nb\nXSB7IE9iamVjdC5jbGFzcywgaW50LmNsYXNzIH0pOwogICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFy\nZWRUeXBlKCkpOwogICAgICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAg\nICAgIHVud3JhcHBlZCA9IChmbWRzW2ldLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuUEMpIAogICAgICAgICAgICAgICAgICAgID8gdHlw\nZSA6IHVud3JhcFNpbmdsZUZpZWxkSWRlbnRpdHkoZm1kc1tpXSk7CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQs\nIGludC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKCiAgICAgICAgICAg\nICAgICBpZiAodW53cmFwcGVkICE9IHR5cGUpIHsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwogICAgICAgICAg\nICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAob2lkVHlwZSA9PSBPYmplY3RJZC5jbGFzcykg\newogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2Qob2lkVHlwZSwgImdldElkIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2VyICYmIHR5cGUgIT0gT2Jq\nZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCkp\nOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2lkVHlwZSA9PSBE\nYXRlSWQuY2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRlLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFnZXIgJiYg\ndHlwZSAhPSBEYXRlLmNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKGZtZHNbaV0uZ2V0RGVjbGFy\nZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChvaWRUeXBlLCAiZ2V0SWQiLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHVud3JhcHBlZCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICh1bndyYXBwZWQgIT0gdHlwZSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBl\nLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgdW53cmFwcGVkIH0pOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX21l\ndGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJ\nRUxEKXsKICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IFJlZmxlY3Rpb24u\nZmluZEZpZWxkKG9pZFR5cGUsIG5hbWUsIHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChNb2RpZmllci5pc1B1YmxpYyhmaWVsZC5nZXRNb2RpZmll\ncnMoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uZ2V0WFhY\nKG9pZCwgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKG9p\nZFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVj\ndGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmaW5k\nRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10geyAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3Ms\nIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1ldGhvZCh0eXBlLCBG\naWVsZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXR5\ncGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZSh0eXBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdldHRlciA9IFJl\nZmxlY3Rpb24uZmluZEdldHRlcihvaWRUeXBlLCBuYW1lLCB0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNQdWJsaWMoZ2V0dGVy\nLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKGdldHRlcik7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIFJlZmxlY3Rpb24uZ2V0WFhYKG9pZCwgUmVmbGVjdGlvbi5maW5kR2V0dGVy\nKC4uLikpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29u\nc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGlj\nKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAiZmluZEdldHRlciIsIE1ldGhvZC5jbGFzcywgbmV3\nIENsYXNzW10gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3Mu\nY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChnZXRSZWZsZWN0aW9u\nR2V0dGVyTWV0aG9kKHR5cGUsIE1ldGhvZC5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBl\nICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRGaWVsZENvbnN1\nbWVyTWV0aG9kKHR5cGUpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsK\nICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGlm\nIHRoZSBjbGFzcyB1c2VzIHRoZSBDbGFzcy9TdHJpbmcgY29uc3RydWN0b3IK\nICAgICAqIGluc3RlYWQgb2YganVzdCBTdHJpbmcuCiAgICAgKi8KICAgIHBy\naXZhdGUgQm9vbGVhbiB1c2VzQ2xhc3NTdHJpbmdJZENvbnN0cnVjdG9yKCkg\newogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSAhPSBDbGFz\nc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4g\nQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgaWYgKF9tZXRhLmlzT3BlbkpQQUlk\nZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKF9tZXRhLmdldE9iamVjdElk\nVHlwZSgpID09IE9iamVjdElkLmNsYXNzKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAg\nICAgICAgfQoKICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2Jq\nZWN0SWRUeXBlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lkVHlw\nZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0\ncmluZy5jbGFzcyB9KTsKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJV\nRTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgIH0K\nICAgICAgICB0cnkgewogICAgICAgICAgICBvaWRUeXBlLmdldENvbnN0cnVj\ndG9yKG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAg\nIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSB0KSB7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogSWYgdGhlIGdpdmVuIGZpZWxkIGlzIGEgd3Jh\ncHBlci10eXBlIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBwcmltYXJ5IGtleSwK\nICAgICAqIHJldHVybiBpdHMgY29ycmVzcG9uZGluZyBwcmltaXRpdmUgY2xh\nc3MuIEVsc2UgcmV0dXJuIHRoZSBmaWVsZCB0eXBlLgogICAgICovCiAgICBw\ncml2YXRlIENsYXNzIHVud3JhcFNpbmdsZUZpZWxkSWRlbnRpdHkoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoIWZtZC5nZXREZWZpbmluZ01l\ndGFEYXRhKCkuaXNPcGVuSlBBSWRlbnRpdHkoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZtZC5nZXREZWNsYXJlZFR5cGUoKTsKCiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGJ5\ndGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JK\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXIuY2xhc3M7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZG91YmxlLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZmxvYXQu\nY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAg\nICAgICAgICAgICAgICByZXR1cm4gaW50LmNsYXNzOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICByZXR1\ncm4gc2hvcnQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxP\nTkdfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmcuY2xhc3M7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZm1k\nLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGdldHRlciBtZXRob2Qgb2YgdGhl\nIHtAbGluayBSZWZsZWN0aW9ufSBoZWxwZXIgZm9yCiAgICAgKiBhIGZpZWxk\nIG9yIGdldHRlciBtZXRob2Qgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgTWV0aG9kIGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2Qo\nQ2xhc3MgdHlwZSwgQ2xhc3MgYXJnVHlwZSkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbmFtZSA9ICJn\nZXQiOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAg\nICAgIG5hbWUgKz0gU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZSh0eXBlLmdldE5h\nbWUoKSk7CiAgICAgICAgcmV0dXJuIFJlZmxlY3Rpb24uY2xhc3MuZ2V0TWV0\naG9kKG5hbWUsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCAKICAgICAg\nICAgICAgYXJnVHlwZSB9KTsgCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhlIE9iamVjdElkRmll\nbGRTdXBwbGllciBmb3IKICAgICAqIGEgZmllbGQgb2YgdGhlIGdpdmVuIHR5\ncGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldEZpZWxkU3VwcGxp\nZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0TWV0aG9kKE9JREZT\nVFlQRSwgdHlwZSwgImZldGNoIiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJvcGVyIGZldGNoIG1l\ndGhvZCBvZiB0aGUgT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZvcgogICAgICog\nYSBmaWVsZCBvZiB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHJpdmF0\nZSBNZXRob2QgZ2V0RmllbGRDb25zdW1lck1ldGhvZChDbGFzcyB0eXBlKQog\nICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBnZXRNZXRob2QoT0lERkNUWVBFLCB0eXBlLCAic3RvcmUiLCBm\nYWxzZSwgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgdGhlIHBjTmV3T2JqZWN0SWRJbnN0YW5jZSBtZXRob2QgdG8gY2xhc3Nl\ncyB1c2luZwogICAgICogYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGROZXdPYmplY3RJZEluc3RhbmNlTWV0aG9k\nKGJvb2xlYW4gb2JqKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJ\nZEluc3RhbmNlICgpCiAgICAgICAgQ2xhc3NbXSBhcmdzID0gKG9iaikgPyBu\nZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0gOiBudWxsOwogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdP\nYmplY3RJZEluc3RhbmNlIiwKICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBh\ncmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgQm9vbGVhbiB1c2VzQ2xzU3RyaW5nID0gdXNlc0NsYXNz\nU3RyaW5nSWRDb25zdHJ1Y3RvcigpOwogICAgICAgIENsYXNzIG9pZFR5cGUg\nPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBpZiAob2JqICYm\nIHVzZXNDbHNTdHJpbmcgPT0gbnVsbCkgewogICAgICAgICAgICAvLyB0aHJv\ndyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICguLi4pOwogICAgICAg\nICAgICBTdHJpbmcgbXNnID0gX2xvYy5nZXQoInN0ci1jb25zIiwgb2lkVHlw\nZSwKICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSku\nZ2V0TWVzc2FnZSgpOwogICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAg\nIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShtc2cpOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uLmNsYXNzLAogICAg\nICAgICAgICAgICAgIjxpbml0PiIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIGNvZGUuYXRocm93KCk7\nCiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYg\nX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAgICAgICAv\nLyBuZXcgT2JqZWN0SWQgKGNscywgb2lkKQogICAgICAgICAgICBjb2RlLmFu\nZXcoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgaWYgKF9tZXRhLmhhc0Fic3RyYWN0UEtG\naWVsZCgpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBjb2RlLmNsYXNz\nY29uc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9tZXRhKSk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKAogICAgICAgICAgICAgICAgICAgICAgICBQUkUgKyAiR2V0\nSURPd25pbmdDbGFzcyIsIENsYXNzLmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbmV3IDxvaWQgY2xhc3M+ICgp\nOwogICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUob2lkVHlwZSk7CiAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRl\nbnRpdHkoKSB8fCAob2JqICYmIHVzZXNDbHNTdHJpbmcgPT0gQm9vbGVhbi5U\nUlVFKSkKICAgICAgICB7CiAgICAgICAgCWlmIChfbWV0YS5oYXNBYnN0cmFj\ndFBLRmllbGQoKSA9PSBmYWxzZSkgewogICAgICAgIAkJY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAgICAgIAl9\nIGVsc2UgewogICAgICAgIAkgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICAJICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZCgK\nICAgICAgICAJICAgICAgICAgICAgUFJFICsgIkdldElET3duaW5nQ2xhc3Mi\nLCBDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgCX0KICAgICAgICB9CiAg\nICAgICAgaWYgKG9iaikgewogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlw\nZShTdHJpbmcuY2xhc3MpOwogICAgICAgICAgICBpZiAodXNlc0Nsc1N0cmlu\nZyA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3\nIENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MgfTsKICAgICAg\nICAgICAgZWxzZSBpZiAodXNlc0Nsc1N0cmluZyA9PSBCb29sZWFuLkZBTFNF\nKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBDbGFzc1tdeyBTdHJpbmcu\nY2xhc3MgfTsKICAgICAgICB9IGVsc2UgaWYgKF9tZXRhLmlzT3BlbkpQQUlk\nZW50aXR5KCkpIHsKICAgICAgICAgICAgLy8gbmV3IDx0eXBlPklkZW50aXR5\nIChYWFguY2xhc3MsIDxwaz4pOwogICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYSBwayA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKVswXTsKICAgICAg\nICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBwayk7CiAgICAg\nICAgICAgIGlmIChway5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5\ncGVzLlBDKQogICAgICAgICAgICAgICAgYWRkRXh0cmFjdE9iamVjdElkRmll\nbGRWYWx1ZUNvZGUoY29kZSwgcGspOwogICAgICAgICAgICBpZiAoX21ldGEu\nZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2JqZWN0SWQuY2xhc3MpCiAgICAgICAg\nICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBPYmpl\nY3QuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZSBpZiAoX21ldGEuZ2V0T2Jq\nZWN0SWRUeXBlKCkgPT0gRGF0ZS5jbGFzcykKICAgICAgICAgICAgICAgIGFy\nZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIERhdGUuY2xhc3MgfTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBD\nbGFzc1tdeyBDbGFzcy5jbGFzcywgcGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGUo\nKSB9OwogICAgICAgIH0KCiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKG9pZFR5cGUsICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBhcmdz\nKTsKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgJiYg\nX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAi\nPGluaXQ+IiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFz\nc1tdeyBDbGFzcy5jbGFzcywgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIGNv\nZGUuYXJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNr\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0K\nICAgCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0SURPd25pbmdDbGFzcygpIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgCSBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0SURPd25pbmdD\nbGFzcyIsCiAgICAJCQlDbGFzcy5jbGFzcywgbnVsbCk7CiAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgCiAgICAg\nICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0\nYSkpOwogICAgICAgIGNvZGUuYXJldHVybigpOyAgICAgICAKCiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7ICAgICAgIAogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFdoZW4gY29tbXVuaWNhdGluZyB3aXRoIHRoZSBTdGF0ZU1hbmFnZXIs\nIG1hbnkgbWV0aG9kcyBhcmUgdXNlZAogICAgICogZGVwZW5kaW5nIG9uIHRo\nZSBjbGFzcyBvZiBzdGF0ZSBiZWluZyBwYXNzZWQuIFRoaXMgbWV0aG9kLAog\nICAgICogZ2l2ZW4gdGhlIHR5cGUgb2YgaW5mb3JtYXRpb24gYmVpbmcgcGFz\nc2VkIGFuZCB0aGUgcHJlZml4CiAgICAgKiAoJ3Byb3ZpZGVkJywgJ3JlcGxh\nY2UnLCBldGMpIG9mIHRoZSBtZXRob2QgdG8KICAgICAqIGNhbGwsIHJldHVy\nbnMgdGhlIFN0YXRlTWFuYWdlciBtZXRob2QgdGhhdCBzaG91bGQgYmUgdXNl\nZC4KICAgICAqCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0\nZSBiZWluZyBwYXNzZWQKICAgICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZp\neCBvZiB0aGUgbWV0aG9kIHRvIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBl\nbmQgaW4gJ1tzdGF0ZSB0eXBlXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZh\ncmllcwogICAgICogQHBhcmFtIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZv\ncm1hdGlvbiBmcm9tIHRoZQogICAgICogU3RhdGVNYW5hZ2VyLCBmYWxzZSBp\nZiBwYXNzaW5nIGl0IHRvIHRoZSBTTQogICAgICogQHBhcmFtIGN1clZhbHVl\nIHRydWUgaWYgdGhlIGN1cnJlbnQgc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRv\nCiAgICAgKiB0aGUgU3RhdGVNYW5hZ2VyIGFzIGFuIGV4dHJhIGFyZ3VtZW50\nCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldFN0YXRlTWFuYWdlck1l\ndGhvZChDbGFzcyB0eXBlLCBTdHJpbmcgcHJlZml4LAogICAgICAgIGJvb2xl\nYW4gZ2V0LCBib29sZWFuIGN1clZhbHVlKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRNZXRob2Qo\nU01UWVBFLCB0eXBlLCBwcmVmaXgsIGdldCwgdHJ1ZSwgY3VyVmFsdWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRob2Qgb2YgdGhl\nIGdpdmVuIG93bmVyIHR5cGUgbWF0Y2hpbmcgdGhlIGdpdmVuIGNyaXRlcmlh\nLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHN0YXRl\nIGJlaW5nIHBhc3NlZAogICAgICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4\nIG9mIHRoZSBtZXRob2QgdG8gY2FsbDsgYWxsIG1ldGhvZHMKICAgICAqIGVu\nZCBpbiAnW3N0YXRlIHR5cGVdRmllbGQnOyBvbmx5IHRoZSBwcmVmaXggdmFy\naWVzCiAgICAgKiBAcGFyYW0gZ2V0IHRydWUgaWYgcmVjZWl2aW5nIGluZm9y\nbWF0aW9uIGZyb20gdGhlCiAgICAgKiBvd25lciwgZmFsc2UgaWYgcGFzc2lu\nZyBpdCB0byB0aGUgb3duZXIKICAgICAqIEBwYXJhbSBoYXNwYyB0cnVlIGlm\nIHRoZSBwYyBpcyBwYXNzZWQgYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAq\nIEBwYXJhbSBjdXJWYWx1ZSB0cnVlIGlmIHRoZSBjdXJyZW50IHN0YXRlIHZh\nbHVlIGlzIHBhc3NlZCB0bwogICAgICogdGhlIG93bmVyIGFzIGFuIGV4dHJh\nIGFyZ3VtZW50CiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldE1ldGhv\nZChDbGFzcyBvd25lciwgQ2xhc3MgdHlwZSwgU3RyaW5nIHByZWZpeCwKICAg\nICAgICBib29sZWFuIGdldCwgYm9vbGVhbiBoYXNwYywgYm9vbGVhbiBjdXJW\nYWx1ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBhbGwgbWV0aG9kcyBlbmQgaW4gW2ZpZWxkIHR5cGVdRmll\nbGQsIHdoZXJlIHRoZSBmaWVsZCB0eXBlCiAgICAgICAgLy8gY2FuIGJlIGFu\neSBvZiB0aGUgcHJpbWl0dmUgdHlwZXMgKGJ1dCBjYXBpdGFsaXplZCksICdT\ndHJpbmcnLAogICAgICAgIC8vIG9yICdPYmplY3QnOyBmaWd1cmUgb3V0IHdo\nYXQgdHlwZSB0byB1c2UKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0eXBl\nLmdldE5hbWUoKTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQog\nICAgICAgICAgICB0eXBlTmFtZSA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCAx\nKS50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICArIHR5cGVOYW1lLnN1\nYnN0cmluZygxKTsKICAgICAgICBlbHNlIGlmICh0eXBlLmVxdWFscyhTdHJp\nbmcuY2xhc3MpKQogICAgICAgICAgICB0eXBlTmFtZSA9ICJTdHJpbmciOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICB0eXBlTmFtZSA9ICJPYmplY3Qi\nOwogICAgICAgICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwogICAgICAgIH0K\nCiAgICAgICAgLy8gdGhlIGZpZWxkIGluZGV4IGlzIGFsd2F5cyBwYXNzZWQg\nYXMgYW4gYXJnOyB0aGUgcGMgaW5zdGFuY2UgYW5kCiAgICAgICAgLy8gdGhl\nIGN1cnJlbnQgdmFsdWUgbWF5IGJlIHBhc3NlZDsgaWYgc2V0dGluZyB0aGUg\nbmV3IHZhbHVlIGlzCiAgICAgICAgLy8gYWxzbyBwYXNzZWQKICAgICAgICBM\naXN0IHBsaXN0ID0gbmV3IEFycmF5TGlzdCg0KTsKICAgICAgICBpZiAoaGFz\ncGMpCiAgICAgICAgICAgIHBsaXN0LmFkZChQQ1RZUEUpOwogICAgICAgIHBs\naXN0LmFkZChpbnQuY2xhc3MpOwogICAgICAgIGlmICghZ2V0IHx8IGN1clZh\nbHVlKQogICAgICAgICAgICBwbGlzdC5hZGQodHlwZSk7CiAgICAgICAgaWYg\nKCFnZXQgJiYgY3VyVmFsdWUpIHsKICAgICAgICAgICAgcGxpc3QuYWRkKHR5\ncGUpOwogICAgICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHVzZSByZWZsZWN0aW9uIHRvIHJldHVybiB0aGUg\ncmlnaHQgbWV0aG9kCiAgICAgICAgU3RyaW5nIG5hbWUgPSBwcmVmaXggKyB0\neXBlTmFtZSArICJGaWVsZCI7CiAgICAgICAgQ2xhc3NbXSBwYXJhbXMgPSAo\nQ2xhc3NbXSkgcGxpc3QudG9BcnJheShuZXcgQ2xhc3NbcGxpc3Quc2l6ZSgp\nXSk7CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJu\nIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RB\nY3Rpb24ob3duZXIsIG5hbWUsIHBhcmFtcykpOwogICAgICAgIH0gY2F0Y2gg\nKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAgICAgICAg\nICB0aHJvdyAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uKSBwYWUuZ2V0RXhjZXB0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVy\nIG1ldGhvZCB0byBhZGQgdGhlIGNvZGUgbmVjZXNzYXJ5IHRvIHRocm93IHRo\nZSBnaXZlbgogICAgICogZXhjZXB0aW9uIHR5cGUsIHNhbnMgbWVzc2FnZS4K\nICAgICAqLwogICAgcHJpdmF0ZSBJbnN0cnVjdGlvbiB0aHJvd0V4Y2VwdGlv\nbihDb2RlIGNvZGUsIENsYXNzIHR5cGUpIHsKICAgICAgICBJbnN0cnVjdGlv\nbiBpbnMgPSBjb2RlLmFuZXcoKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIGNv\nZGUuZHVwKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKHR5cGUsICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBudWxsKTsKICAgICAg\nICBjb2RlLmF0aHJvdygpOwogICAgICAgIHJldHVybiBpbnM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW50\nZXJmYWNlIHRvIHRoZSBjbGFzcyBiZWluZwogICAgICogZW5oYW5jZWQsIGFu\nZCBhZGRzIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciBmb3IgdXNlIGJ5IE9wZW5K\nUEEKICAgICAqIGlmIGl0IGlzIG5vdCBhbHJlYWR5IHByZXNlbnQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBlbmhhbmNlQ2xhc3MoKSB7CiAgICAgICAg\nLy8gbWFrZSB0aGUgY2xhc3MgaW1wbGVtZW50IFBlcnNpc3RlbmNlQ2FwYWJs\nZQogICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKFBDVFlQRSk7CgogICAg\nICAgIC8vIGFkZCBhIHZlcnNpb24gc3RhbXAKICAgICAgICBhZGRHZXRFbmhh\nbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpOwoKICAgICAgICAvLyBm\naW5kIHRoZSBkZWZhdWx0IGNvbnN0cnVjdG9yCiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4iLCAoU3Ry\naW5nW10pIG51bGwpOwoKICAgICAgICAvLyBhIGRlZmF1bHQgY29uc3RydWN0\nb3IgaXMgcmVxdWlyZWQKICAgICAgICBpZiAobWV0aG9kID09IG51bGwpIHsK\nICAgICAgICAgICAgU3RyaW5nIG5hbWUgPSBfcGMuZ2V0TmFtZSgpOwogICAg\nICAgICAgICBpZiAoIV9kZWZDb25zKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImVuaGFuY2UtZGVmYXVsdGNv\nbnN0IiwgbmFtZSkpOwoKICAgICAgICAgICAgbWV0aG9kID0gX3BjLmFkZERl\nZmF1bHRDb25zdHJ1Y3RvcigpOwogICAgICAgICAgICBTdHJpbmcgYWNjZXNz\nOwogICAgICAgICAgICBpZiAoX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAg\nICAgICAgICAgICAgIC8vIGV4dGVybmFsaXphYmxlIHJlcXVpcmVzIHRoYXQg\ndGhlIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAgICAvLyBiZSBwdWJsaWMs\nIHNvIG1ha2UgdGhlIGFkZGVkIGNvbnN0cnVjdG9yIHB1YmxpYwogICAgICAg\nICAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICAgICAgICAg\nIGFjY2VzcyA9ICJwdWJsaWMiOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9w\nYy5pc0ZpbmFsKCkpIHsKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJp\ndmF0ZSgpOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInByaXZhdGUiOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWV0aG9kLm1h\na2VQcm90ZWN0ZWQoKTsKICAgICAgICAgICAgICAgIGFjY2VzcyA9ICJwcm90\nZWN0ZWQiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghKF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpIHx8IGdldENyZWF0\nZVN1YmNsYXNzKCkpCiAgICAgICAgICAgICAgICAmJiBfbG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgi\nZW5oYW5jZS1hZGRkZWZhdWx0Y29uc3QiLCBuYW1lLCBhY2Nlc3MpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBmb2xsb3dp\nbmcgZmllbGRzIHRvIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdGFuY2U6\nCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMg\naW50IHBjSW5oZXJpdGVkRmllbGRDb3VudDwvY29kZT48L2xpPgogICAgICog\nPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIENsYXNzIHBjUENTdXBlcmNsYXNz\nPC9jb2RlPgogICAgICogPC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRl\nIHN0YXRpYyBTdHJpbmdbXSBwY0ZpZWxkTmFtZXM8L2NvZGU+PC9saT4KICAg\nICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBDbGFzc1tdIHBjRmllbGRU\neXBlczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3Rh\ndGljIGJ5dGVbXSBwY0ZpZWxkRmxhZ3M8L2NvZGU+PC9saT4KICAgICAqIDxs\naT48Y29kZT5wcm90ZWN0ZWQgdHJhbnNpZW50IFN0YXRlTWFuYWdlciBwY1N0\nYXRlTWFuYWdlcjwvY29kZT4KICAgICAqIGlmIG5vIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBzdXBlcmNsYXNzIHByZXNlbnQpPC9saT4KICAgICAqIDwvdWw+CiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRGaWVsZHMoKSB7CiAgICAgICAg\nX3BjLmRlY2xhcmVGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpLnNldFN0YXRp\nYyh0cnVlKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVs\nZE5hbWVzIiwgU3RyaW5nW10uY2xhc3MpLnNldFN0YXRpYyh0cnVlKTsKICAg\nICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xh\nc3NbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9wYy5kZWNs\nYXJlRmllbGQoUFJFICsgIkZpZWxkRmxhZ3MiLCBieXRlW10uY2xhc3MpLnNl\ndFN0YXRpYyh0cnVlKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFNVUEVS\nLCBDbGFzcy5jbGFzcykuc2V0U3RhdGljKHRydWUpOwoKICAgICAgICBpZiAo\nX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMu\nZGVjbGFyZUZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICBmaWVsZC5t\nYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGZpZWxkLnNldFRyYW5zaWVu\ndCh0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNb2Rp\nZmllcyB0aGUgY2xhc3MgaW5pdGlhbGl6YXRpb24gbWV0aG9kIChjcmVhdGlu\nZyBvbmUgaWYgbmVjZXNzYXJ5KQogICAgICogdG8gaW5pdGlhbGl6ZSB0aGUg\nc3RhdGljIGZpZWxkcyBvZiB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGluc3Rh\nbmNlIGFuZAogICAgICogdG8gcmVnaXN0ZXIgaXQgd2l0aCB0aGUgaW1wbCBo\nZWxwZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTdGF0aWNJbml0\naWFsaXplcigpIHsKICAgICAgICBDb2RlIGNvZGUgPSBnZXRPckNyZWF0ZUNs\nYXNzSW5pdENvZGUodHJ1ZSk7CiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3Vw\nZXJjbGFzcygpICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGdldENyZWF0\nZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwKTsKICAgICAgICAgICAgICAgIGNvZGUucHV0c3RhdGlj\nKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHBjSW5oZXJpdGVkRmllbGRD\nb3VudCA9IDxzdXBlckNsYXNzPi5wY0dldE1hbmFnZWRGaWVsZENvdW50KCkK\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICAgICAgZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKSkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAg\nICAgIFBSRSArICJHZXRNYW5hZ2VkRmllbGRDb3VudCIsIGludC5jbGFzcy5n\nZXROYW1lKCksIG51bGwpOwogICAgICAgICAgICAgICAgY29kZS5wdXRzdGF0\naWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBwY1BDU3VwZXJjbGFzcyA9IDxzdXBlckNs\nYXNzPjsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xh\nc3MoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkpKTsKICAgICAgICAgICAgY29kZS5wdXRzdGF0aWMo\nKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3IFN0cmluZ1tdIHsgIjxuYW1l\nMT4iLCAiPG5hbWUyPiIsIC4uLiB9OwogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAg\nIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGNv\nZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0YXRp\nYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10uY2xh\nc3MpOwoKICAgICAgICAvLyBwY0ZpZWxkVHlwZXMgPSBuZXcgQ2xhc3NbXSB7\nIDx0eXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xhc3MsIC4uLiB9OwogICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAg\nICAgY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBlKENsYXNzLmNsYXNzKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNsYXNzY29u\nc3RhbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsK\nICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAgICAgfQogICAgICAg\nIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMi\nLCBDbGFzc1tdLmNsYXNzKTsKCiAgICAgICAgLy8gcGNGaWVsZEZsYWdzID0g\nbmV3IGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFnMj4sIC4uLiB9OwogICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxlbmd0aCk7CiAgICAg\nICAgY29kZS5uZXdhcnJheSgpLnNldFR5cGUoYnl0ZS5jbGFzcyk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKGdldEZpZWxkRmxhZyhmbWRzW2ldKSk7CiAgICAgICAgICAg\nIGNvZGUuYmFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1dHN0\nYXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNs\nYXNzKTsKCiAgICAgICAgLy8gUENSZWdpc3RyeS5yZWdpc3RlciAoY2xzLAog\nICAgICAgIC8vCXBjRmllbGROYW1lcywgcGNGaWVsZFR5cGVzLCBwY0ZpZWxk\nRmxhZ3MsCiAgICAgICAgLy8gIHBjUENTdXBlcmNsYXNzLCBhbGlhcywgbmV3\nIFhYWCAoKSk7CiAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xh\nc3MoX21hbmFnZWRUeXBlKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNl\ndEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwgU3RyaW5nW10uY2xhc3MpOwog\nICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoUFJFICsgIkZpZWxk\nVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNz\nKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFNVUEVSLCBD\nbGFzcy5jbGFzcyk7CiAgICAgICAgCiAgICAgICAgaWYgKF9tZXRhLmlzTWFw\ncGVkKCkpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShf\nbWV0YS5nZXRUeXBlQWxpYXMoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwoKICAgICAgICBpZiAoX3Bj\nLmlzQWJzdHJhY3QoKSkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndE51bGwoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29kZS5hbmV3\nKCkuc2V0VHlwZShfcGMpOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0\nPiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgY29k\nZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoSEVMUEVSVFlQRSwgInJlZ2lz\ndGVyIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IENs\nYXNzLmNsYXNzLCBTdHJpbmdbXS5jbGFzcywgQ2xhc3NbXS5jbGFzcywKICAg\nICAgICAgICAgICAgIGJ5dGVbXS5jbGFzcywgQ2xhc3MuY2xhc3MsIFN0cmlu\nZy5jbGFzcywgUENUWVBFIH0pOwoKICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZsYWcgZm9yIHRoZSBnaXZlbiBmaWVs\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYnl0ZSBnZXRGaWVsZEZs\nYWcoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoZm1kLmdldE1h\nbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9OT05FKQogICAg\nICAgICAgICByZXR1cm4gLTE7CgogICAgICAgIGJ5dGUgZmxhZ3MgPSAwOwog\nICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUo\nKQogICAgICAgICAgICB8fCBTZXJpYWxpemFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpKQogICAgICAgICAgICBm\nbGFncyA9IFBlcnNpc3RlbmNlQ2FwYWJsZS5TRVJJQUxJWkFCTEU7CgogICAg\nICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEu\nTUFOQUdFX1RSQU5TQUNUSU9OQUwpCiAgICAgICAgICAgIGZsYWdzIHw9IFBl\ncnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURTsKICAgICAgICBlbHNlIGlm\nICghZm1kLmlzUHJpbWFyeUtleSgpICYmICFmbWQuaXNJbkRlZmF1bHRGZXRj\naEdyb3VwKCkpCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5DSEVDS19XUklURQogICAgICAgICAgICAgICAgfCBQZXJzaXN0ZW5j\nZUNhcGFibGUuQ0hFQ0tfUkVBRDsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1dSSVRFCiAg\nICAgICAgICAgICAgICB8IFBlcnNpc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1JF\nQUQ7CiAgICAgICAgcmV0dXJuIGZsYWdzOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyB0aGUgY29kZSB0byBwcm9wZXJseSBoYW5kbGUgUGVyc2lzdGVu\nY2VDYXBhYmxlIHNlcmlhbGl6YXRpb24KICAgICAqIHRvIHRoZSBieXRlY29k\nZS4gVGhpcyBpbmNsdWRlcyBjcmVhdGluZyBhbmQgaW5pdGlhbGl6aW5nIHRo\nZQogICAgICogc3RhdGljIDxjb2RlPnNlcmlhbFZlcnNpb25VSUQ8L2NvZGU+\nIGNvbnN0YW50IGlmIG5vdCBhbHJlYWR5IGRlZmluZWQsCiAgICAgKiBhcyB3\nZWxsIGFzIGNyZWF0aW5nIGEgY3VzdG9tIDxjb2RlPndyaXRlT2JqZWN0PC9j\nb2RlPiBtZXRob2QgaWYgdGhlCiAgICAgKiBjbGFzcyBpcyBTZXJpYWxpemFi\nbGUgYW5kIGRvZXMgbm90IGRlZmluZSB0aGVtLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkU2VyaWFsaXphdGlvbkNvZGUoKSB7CiAgICAgICAgaWYg\nKGV4dGVybmFsaXplRGV0YWNoZWQoKQogICAgICAgICAgICB8fCAhU2VyaWFs\naXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAo\nZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICBpZiAoIUV4dGVy\nbmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oCiAgICAgICAgICAg\nICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAg\nICAgYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBub3QgYWxyZWFk\neSBwcmVzZW50LCBhZGQgYSBzZXJpYWxWZXJzaW9uVUlEIGZpZWxkOyBpZiB0\naGUgaW5zdGFuY2UKICAgICAgICAvLyBpcyBkZXRhY2hhYmxlIGFuZCB1c2Vz\nIGRldGFjaGVkIHN0YXRlIHdpdGhvdXQgYSBkZWNsYXJlZCBmaWVsZCwKICAg\nICAgICAvLyBjYW4ndCBhZGQgYSBzZXJpYWwgdmVyc2lvbiBVSUQgYmVjYXVz\nZSB3ZSdsbCBiZSBhZGRpbmcgZXh0cmEgZmllbGRzCiAgICAgICAgLy8gdG8g\ndGhlIGVuaGFuY2VkIHZlcnNpb24KICAgICAgICBCQ0ZpZWxkIGZpZWxkID0g\nX3BjLmdldERlY2xhcmVkRmllbGQoInNlcmlhbFZlcnNpb25VSUQiKTsKICAg\nICAgICBpZiAoZmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBMb25nIHVp\nZCA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB1\naWQgPSBOdW1iZXJzLnZhbHVlT2YoT2JqZWN0U3RyZWFtQ2xhc3MubG9va3Vw\nCiAgICAgICAgICAgICAgICAgICAgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSkuZ2V0U2VyaWFsVmVyc2lvblVJRCgpKTsKICAgICAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGxhc3QtY2hh\nbmNlIGNhdGNoIGZvciBidWcgIzI4MyAod2hpY2ggY2FuIGhhcHBlbgogICAg\nICAgICAgICAgICAgLy8gaW4gYSB2YXJpZXR5IG9mIENsYXNzTG9hZGluZyBl\nbnZpcm9ubWVudHMpCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9j\nLmdldCgiZW5oYW5jZS11aWQtYWNjZXNzIiwgX21ldGEpLCB0KTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4o\nX2xvYy5nZXQoImVuaGFuY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHdlIGNvdWxkbid0IGFjY2Vz\ncyB0aGUgc2VyaWFsVmVyc2lvblVJRCwgd2Ugd2lsbCBoYXZlIHRvCiAgICAg\nICAgICAgIC8vIHNraXAgdGhlIG92ZXJyaWRlIG9mIHRoYXQgZmllbGQgYW5k\nIG5vdCBiZSBzZXJpYWxpemF0aW9uCiAgICAgICAgICAgIC8vIGNvbXBhdGli\nbGUgd2l0aCBub24tZW5oYW5jZWQgY2xhc3NlcwogICAgICAgICAgICBpZiAo\ndWlkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gX3BjLmRl\nY2xhcmVGaWVsZCgic2VyaWFsVmVyc2lvblVJRCIsIGxvbmcuY2xhc3MpOwog\nICAgICAgICAgICAgICAgZmllbGQubWFrZVByaXZhdGUoKTsKICAgICAgICAg\nICAgICAgIGZpZWxkLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAgICAgICAg\nIGZpZWxkLnNldEZpbmFsKHRydWUpOwoKICAgICAgICAgICAgICAgIENvZGUg\nY29kZSA9IGdldE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShmYWxzZSk7CiAgICAg\nICAgICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodWlkLmxvbmdWYWx1ZSgpKTsK\nICAgICAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoZmll\nbGQpOwoKICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHdy\naXRlIG9iamVjdCBtZXRob2QKICAgICAgICBCQ01ldGhvZCB3cml0ZSA9IF9w\nYy5nZXREZWNsYXJlZE1ldGhvZCgid3JpdGVPYmplY3QiLAogICAgICAgICAg\nICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH0pOwog\nICAgICAgIGJvb2xlYW4gZnVsbCA9IHdyaXRlID09IG51bGw7CiAgICAgICAg\naWYgKGZ1bGwpIHsKICAgICAgICAgICAgLy8gcHJpdmF0ZSB2b2lkIHdyaXRl\nT2JqZWN0IChPYmplY3RPdXRwdXRTdHJlYW0gb3V0KQogICAgICAgICAgICB3\ncml0ZSA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3cml0ZU9iamVjdCIsIHZvaWQu\nY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0\ncHV0U3RyZWFtLmNsYXNzIH0pOwogICAgICAgICAgICB3cml0ZS5nZXRFeGNl\ncHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgICAgIHdyaXRlLm1ha2VQcml2YXRlKCk7CiAgICAgICAgfQog\nICAgICAgIG1vZGlmeVdyaXRlT2JqZWN0TWV0aG9kKHdyaXRlLCBmdWxsKTsK\nCiAgICAgICAgLy8gYW5kIHJlYWQgb2JqZWN0CiAgICAgICAgQkNNZXRob2Qg\ncmVhZCA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsCiAg\nICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVhbS5jbGFz\ncyB9KTsKICAgICAgICBmdWxsID0gcmVhZCA9PSBudWxsOwogICAgICAgIGlm\nIChmdWxsKSB7CiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCByZWFkT2Jq\nZWN0IChPYmplY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICAgICAgcmVhZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKCJyZWFkT2JqZWN0Iiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dFN0cmVh\nbS5jbGFzcyB9KTsKICAgICAgICAgICAgcmVhZC5nZXRFeGNlcHRpb25zKHRy\ndWUpLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAg\nICAgICAgICAgICAgIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsK\nICAgICAgICAgICAgcmVhZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAg\nICAgICBtb2RpZnlSZWFkT2JqZWN0TWV0aG9kKHJlYWQsIGZ1bGwpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBhZGRTdWJjbGFzc1NlcmlhbGl6YXRpb25D\nb2RlKCkgewogICAgICAgIC8vIGZvciBnZW5lcmF0ZWQgc3ViY2xhc3Nlcywg\nc2VyaWFsaXphdGlvbiBtdXN0IHdyaXRlIGFuIGluc3RhbmNlIG9mCiAgICAg\nICAgLy8gdGhlIHN1cGVyY2xhc3MgaW5zdGVhZCBvZiB0aGUgc3ViY2xhc3Ms\nIHNvIHRoYXQgdGhlIGNsaWVudCBWTSBjYW4KICAgICAgICAvLyBkZXNlcmlh\nbGl6ZSBzdWNjZXNzZnVsbHkuCgogICAgICAgIC8vIHByaXZhdGUgT2JqZWN0\nIHdyaXRlUmVwbGFjZSgpIHRocm93cyBPYmplY3RTdHJlYW1FeGNlcHRpb24K\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZCgi\nd3JpdGVSZXBsYWNlIiwgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICBt\nZXRob2QuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oT2JqZWN0\nU3RyZWFtRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gT2JqZWN0IG8gPSBu\nZXcgPG1hbmFnZWQtdHlwZT4oKQogICAgICAgIGNvZGUuYW5ldygpLnNldFR5\ncGUoX21hbmFnZWRUeXBlKTsgLy8gZm9yIHJldHVybgogICAgICAgIGNvZGUu\nZHVwKCk7IC8vIGZvciBwb3N0LTxpbml0PiB3b3JrCiAgICAgICAgY29kZS5k\ndXAoKTsgLy8gZm9yIDxpbml0PgogICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLCAiPGluaXQ+\nIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbnVsbCk7CgogICAgICAgIC8v\nIGNvcHkgYWxsIHRoZSBmaWVsZHMuCiAgICAgICAgLy8gIyMjIyMgbGltaXRp\nbmcgdG8gSlBBIEBUcmFuc2llbnQgbGltaXRhdGlvbnMKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIC8vIG8uPGZpZWxkPiA9IHRo\naXMuPGZpZWxkPiAob3IgcmVmbGVjdGl2ZSBhbmFsb2cpCiAgICAgICAgICAg\nIGNvZGUuZHVwKCk7IC8vIGZvciBwdXRmaWVsZAogICAgICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0VGhpcygpOyAvLyBmb3IgZ2V0ZmllbGQKICAgICAgICAg\nICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRUeXBlLCBmbWRzW2ldLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlw\nZSwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBmbWRzW2ld\nLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUu\nYXJldHVybigpLnNldFR5cGUoT2JqZWN0LmNsYXNzKTsKCiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\nZSBjbGFzcyBiZWluZyBlbmhhbmNlZCBzaG91bGQgZXh0ZXJuYWxpemUgdG8g\nYSBkZXRhY2hlZAogICAgICogaW5zdGFuY2UgcmF0aGVyIHRoYW4gc2VyaWFs\naXplLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZXh0ZXJuYWxpemVE\nZXRhY2hlZCgpIHsKICAgICAgICByZXR1cm4gQ2xhc3NNZXRhRGF0YS5TWU5U\nSEVUSUMuZXF1YWxzKF9tZXRhLmdldERldGFjaGVkU3RhdGUoKSkKICAgICAg\nICAgICAgJiYgU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\nX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKQogICAgICAgICAgICAmJiAhX3Jl\ncG9zLmdldENvbmZpZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNl\nKCkuCiAgICAgICAgICAgIGlzRGV0YWNoZWRTdGF0ZVRyYW5zaWVudCgpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIGN1c3RvbSB3cml0ZU9iamVj\ndCBtZXRob2QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxpbmsg\nT2JqZWN0T3V0cHV0U3RyZWFtI2RlZmF1bHRXcml0ZU9iamVjdH0gbWV0aG9k\nLAogICAgICogYnV0IG9ubHkgYWZ0ZXIgY2FsbGluZyB0aGUgaW50ZXJuYWwg\nPGNvZGU+cGNTZXJpYWxpemluZzwvY29kZT4gbWV0aG9kLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgbW9kaWZ5V3JpdGVPYmplY3RNZXRob2QoQkNNZXRo\nb2QgbWV0aG9kLCBib29sZWFuIGZ1bGwpIHsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmJlZm9yZUZp\ncnN0KCk7CgogICAgICAgIC8vIGJvb2wgY2xlYXIgPSBwY1NlcmlhbGl6aW5n\nICgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUg\nKyAiU2VyaWFsaXppbmciLAogICAgICAgICAgICBib29sZWFuLmNsYXNzLCBu\ndWxsKTsKICAgICAgICBpbnQgY2xlYXIgPSBjb2RlLmdldE5leHRMb2NhbHNJ\nbmRleCgpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoY2xlYXIp\nOwoKICAgICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBvdXQuZGVm\nYXVsdFdyaXRlT2JqZWN0ICgpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MsCiAgICAgICAg\nICAgICAgICAiZGVmYXVsdFdyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIH0KCiAg\nICAgICAgSW5zdHJ1Y3Rpb24gdG1wbGF0ZSA9ICgoQ29kZSkgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLm5ld0NvZGVBY3Rpb24oKSkpLnZyZXR1cm4oKTsKICAgICAgICBKdW1w\nSW5zdHJ1Y3Rpb24gdG9yZXQ7CiAgICAgICAgSW5zdHJ1Y3Rpb24gcmV0Owog\nICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKICAgICAgICB3aGlsZSAoY29k\nZS5zZWFyY2hGb3J3YXJkKHRtcGxhdGUpKSB7CiAgICAgICAgICAgIHJldCA9\nIGNvZGUucHJldmlvdXMoKTsKICAgICAgICAgICAgLy8gaWYgKGNsZWFyKSBw\nY1NldERldGFjaGVkU3RhdGUgKG51bGwpOwogICAgICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0TG9jYWwoY2xlYXIpOwogICAgICAgICAgICB0b3JldCA9IGNv\nZGUuaWZlcSgpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51\nbGwoKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAg\nICAgICAgICAgIHRvcmV0LnNldFRhcmdldChyZXQpOwogICAgICAgICAgICBj\nb2RlLm5leHQoKTsgLy8ganVtcCBvdmVyIHJldHVybgogICAgICAgIH0KICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgYSBjdXN0b20gcmVhZE9iamVjdCBtZXRob2QgdGhhdCBkZWxlZ2F0ZXMg\ndG8gdGhlCiAgICAgKiB7QGxpbmsgT2JqZWN0SW5wdXRTdHJlYW0jcmVhZE9i\namVjdH0gbWV0aG9kLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgbW9kaWZ5\nUmVhZE9iamVjdE1ldGhvZChCQ01ldGhvZCBtZXRob2QsIGJvb2xlYW4gZnVs\nbCkgewogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUp\nOwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3QoKTsKCiAgICAgICAgLy8gaWYg\ndGhpcyBpbnN0YW5jZSB1c2VzIHN5bnRoZXRpYyBkZXRhY2hlZCBzdGF0ZSwg\nbm90ZSB0aGF0IGl0IGhhcwogICAgICAgIC8vIGJlZW4gZGVzZXJpYWxpemVk\nCiAgICAgICAgaWYgKENsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhf\nbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpKSB7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFz\ncywKICAgICAgICAgICAgICAgICJERVNFUklBTElaRUQiLCBPYmplY3QuY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAg\nICAgICB9CgogICAgICAgIGlmIChmdWxsKSB7CiAgICAgICAgICAgIC8vIGlu\nLmRlZmF1bHRSZWFkT2JqZWN0ICgpOwogICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChPYmplY3RJbnB1dFN0cmVhbS5jbGFzcywKICAgICAg\nICAgICAgICAgICJkZWZhdWx0UmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9Cgog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlcyB0aGUgcGNJc0RldGFjaGVkKCkgbWV0aG9kIHRvIGRldGVybWlu\nZSBpZiBhbiBpbnN0YW5jZQogICAgICogaXMgZGV0YWNoZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRJc0RldGFjaGVkTWV0aG9kKCkKICAgICAg\nICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBw\ndWJsaWMgYm9vbGVhbiBwY0lzRGV0YWNoZWQoKQogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJJc0RldGFjaGVk\nIiwKICAgICAgICAgICAgQm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAg\nbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBib29sZWFuIG5lZWRzRGVmaW5p\ndGl2ZU1ldGhvZCA9IHdyaXRlSXNEZXRhY2hlZE1ldGhvZChjb2RlKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICBpZiAoIW5lZWRzRGVmaW5p\ndGl2ZU1ldGhvZCkgCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8g\ncHJpdmF0ZSBib29sZWFuIHBjSXNEZXRhY2hlZFN0YXRlRGVmaW5pdGl2ZSgp\nCiAgICAgICAgLy8gICByZXR1cm4gZmFsc2U7CiAgICAgICAgLy8gYXV4aWxs\naWFyeSBlbmhhbmNlcnMgbWF5IGNoYW5nZSB0aGUgcmV0dXJuIHZhbHVlIG9m\nIHRoaXMgbWV0aG9kCiAgICAgICAgLy8gaWYgdGhlaXIgc3BlY3MgY29uc2lk\nZXIgZGV0YWNoZWQgc3RhdGUgZGVmaW5pdGl2ZQogICAgICAgIG1ldGhvZCA9\nIF9wYy5kZWNsYXJlTWV0aG9kKElTREVUQUNIRURTVEFURURFRklOSVRJVkUs\nIGJvb2xlYW4uY2xhc3MsCiAgICAgICAgICAgIG51bGwpOwogICAgICAgIG1l\ndGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZmFsc2UpOwogICAgICAgIGNvZGUuaXJldHVybigpOwogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUg\nYm9keSBvZiB0aGUgcGNJc0RldGFjaGVkKCkgbWV0aG9kIHRvIGRldGVybWlu\nZSBpZiBhbgogICAgICogaW5zdGFuY2UgaXMgZGV0YWNoZWQuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIHdlIG5lZWQgYSBwY0lzRGV0YWNoZWRT\ndGF0ZURlZmluaXRpdmUgbWV0aG9kLCBmYWxzZQogICAgICogb3RoZXJ3aXNl\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiB3cml0ZUlzRGV0YWNoZWRN\nZXRob2QoQ29kZSBjb2RlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIC8vIG5vdCBkZXRhY2hhYmxlOiByZXR1cm4g\nQm9vbGVhbi5GQUxTRQogICAgICAgIGlmICghX21ldGEuaXNEZXRhY2hhYmxl\nKCkpIHsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChC\nb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNzKTsKICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIChzbSAhPSBudWxsKQogICAg\nICAgIC8vCQlyZXR1cm4gKHNtLmlzRGV0YWNoZWQgKCkpID8gQm9vbGVhbi5U\nUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\naW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoU01UWVBFLCAiaXNEZXRhY2hlZCIsCiAgICAgICAg\nICAgIGJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBpZmZhbHNlID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5nZXRz\ndGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xl\nYW4uY2xhc3MpOwogICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIGlm\nZmFsc2Uuc2V0VGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9v\nbGVhbi5jbGFzcywgIkZBTFNFIiwKICAgICAgICAgICAgQm9vbGVhbi5jbGFz\ncykpOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICAvLyBpZiB3\nZSB1c2UgZGV0YWNoZWQgc3RhdGU6CiAgICAgICAgLy8gaWYgKHBjR2V0RGV0\nYWNoZWRTdGF0ZSAoKSAhPSBudWxsCiAgICAgICAgLy8gICAgICYmIHBjR2V0\nRGV0YWNoZWRTdGF0ZSAhPSBERVNFUklBTElaRUQpCiAgICAgICAgLy8gICAg\nIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgQm9vbGVhbiBzdGF0ZSA9\nIF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCk7CiAgICAgICAgSnVtcEluc3Ry\ndWN0aW9uIG5vdGRlc2VyID0gbnVsbDsKICAgICAgICBJbnN0cnVjdGlvbiB0\nYXJnZXQ7CiAgICAgICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uRkFMU0UpIHsK\nICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIGlmaW5zID0gY29kZS5pZm51bGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0\nZSIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICJERVNFUklBTElaRUQi\nLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBub3RkZXNlciA9IGNvZGUu\naWZhY21wZXEoKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRG\naWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwog\nICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgICAgIGlmIChz\ndGF0ZSA9PSBCb29sZWFuLlRSVUUpIHsKICAgICAgICAgICAgICAgIC8vIGlm\nIHdlIGhhdmUgdG8gdXNlIGRldGFjaGVkIHN0YXRlOgogICAgICAgICAgICAg\nICAgLy8gcmV0dXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgICAgICB0\nYXJnZXQgPSBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xh\nc3MsICJGQUxTRSIsCiAgICAgICAgICAgICAgICAgICAgQm9vbGVhbi5jbGFz\ncyk7CiAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsK\nICAgICAgICAgICAgICAgIG5vdGRlc2VyLnNldFRhcmdldCh0YXJnZXQpOwog\nICAgICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIGNyZWF0ZSBhcnRpZmljaWFsIHRhcmdldCB0byBzaW1wbGlmeQog\nICAgICAgIHRhcmdldCA9IGNvZGUubm9wKCk7CiAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KHRhcmdldCk7CiAgICAgICAgaWYgKG5vdGRlc2VyICE9IG51bGwp\nCiAgICAgICAgICAgIG5vdGRlc2VyLnNldFRhcmdldCh0YXJnZXQpOwoKICAg\nICAgICAvLyBhbGxvdyB1c2VycyB3aXRoIHZlcnNpb24gb3IgYXV0by1hc3Np\nZ25lZCBwayBmaWVsZHMgdG8gbWFudWFsbHkgCiAgICAgICAgLy8gY29uc3Ry\ndWN0IGEgImRldGFjaGVkIiBpbnN0YW5jZSwgc28gY2hlY2sgdGhlc2UgYmVm\nb3JlIHRha2luZyBpbnRvIAogICAgICAgIC8vIGFjY291bnQgbm9uLWV4aXN0\nZW50IGRldGFjaGVkIHN0YXRlCgogICAgICAgIC8vIGNvbnNpZGVyIGRldGFj\naGVkIGlmIHZlcnNpb24gaXMgbm9uLWRlZmF1bHQKICAgICAgICBGaWVsZE1l\ndGFEYXRhIHZlcnNpb24gPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKICAg\nICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVFICYmIHZlcnNpb24gIT0g\nbnVsbCkgewogICAgICAgICAgICAvLyBpZiAoPHZlcnNpb24+ICE9IDxkZWZh\ndWx0PikKICAgICAgICAgICAgLy8JCXJldHVybiB0cnVlOwogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCB2ZXJzaW9uKTsKICAg\nICAgICAgICAgaWZpbnMgPSBpZkRlZmF1bHRWYWx1ZShjb2RlLCB2ZXJzaW9u\nKTsKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29s\nZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAg\nICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZB\nTFNFIiwKICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpKTsKICAgICAg\nICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbnNpZGVyIGRldGFjaGVkIGlm\nIGF1dG8tZ2VubmVkIHByaW1hcnkga2V5cyBhcmUgbm9uLWRlZmF1bHQKICAg\nICAgICBpZmlucyA9IG51bGw7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\naW5zMiA9IG51bGw7CiAgICAgICAgYm9vbGVhbiBoYXNBdXRvQXNzaWduZWRQ\nSyA9IGZhbHNlOwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLlRSVUUK\nICAgICAgICAgICAgJiYgX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikgewogICAgICAgICAgICAvLyBm\nb3IgZWFjaCBwayBmaWVsZDoKICAgICAgICAgICAgLy8gaWYgKDxwaz4gIT0g\nPGRlZmF1bHQ+IFsmJiAhIiIuZXF1YWxzICg8cGs+KV0pCiAgICAgICAgICAg\nIC8vCQlyZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gcGtzID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0\nZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdGFyZ2V0ID0gbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICBpZiAoaWZpbnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmIChpZmlu\nczIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBpZmluczIuc2V0VGFy\nZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZmluczIgPSBudWxsOwoK\nICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\ncGtzW2ldKTsKICAgICAgICAgICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFs\ndWUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChwa3NbaV0u\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5TVFJJTkcpIHsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nIiIpOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGFkZEdldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgcGtzW2ldKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoU3RyaW5nLmNsYXNz\nLCAiZXF1YWxzIiwKICAgICAgICAgICAgICAgICAgICAgICAgYm9vbGVhbi5j\nbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAg\nICAgICAgICAgICBpZmluczIgPSBjb2RlLmlmbmUoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLAogICAgICAgICAgICAgICAgICAg\nIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0\nZSBhcnRpZmljaWFsIHRhcmdldCB0byBzaW1wbGlmeQogICAgICAgIHRhcmdl\ndCA9IGNvZGUubm9wKCk7CiAgICAgICAgaWYgKGlmaW5zICE9IG51bGwpCiAg\nICAgICAgICAgIGlmaW5zLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgIGlm\nIChpZmluczIgIT0gbnVsbCkKICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdl\ndCh0YXJnZXQpOwoKICAgICAgICAvLyBpZiBoYXMgYXV0by1hc3NpZ25lZCBw\nayBhbmQgd2UgZ2V0IHRvIHRoaXMgcG9pbnQsIG11c3QgaGF2ZSBkZWZhdWx0\nCiAgICAgICAgLy8gdmFsdWUsIHNvIG11c3QgYmUgbmV3IGluc3RhbmNlCiAg\nICAgICAgaWYgKGhhc0F1dG9Bc3NpZ25lZFBLKSB7CiAgICAgICAgICAgIGNv\nZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNF\nIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAg\nICAvLyBpZiBkZXRhY2hlZCBzdGF0ZSBpcyBub3QgZGVmaW5pdGl2ZSwganVz\ndCBnaXZlIHVwIG5vdyBhbmQgcmV0dXJuCiAgICAgICAgLy8gbnVsbCBzbyB0\naGF0IHRoZSBydW50aW1lIHdpbGwgcGVyZm9ybSBhIERCIGxvb2t1cCB0byBk\nZXRlcm1pbmUKICAgICAgICAvLyB3aGV0aGVyIHdlJ3JlIGRldGFjaGVkIG9y\nIG5ldwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAg\nY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKElTREVUQUNIRURTVEFU\nRURFRklOSVRJVkUsIGJvb2xlYW4uY2xhc3MsCiAgICAgICAgICAgIG51bGwp\nOwogICAgICAgIGlmaW5zID0gY29kZS5pZm5lKCk7CiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAg\nIC8vIG5vIGRldGFjaGVkIHN0YXRlOiBpZiBpbnN0YW5jZSB1c2VzIGRldGFj\naGVkIHN0YXRlIGFuZCBpdCdzIG5vdAogICAgICAgIC8vIHN5bnRoZXRpYyBv\nciB0aGUgaW5zdGFuY2UgaXMgbm90IHNlcmlhbGl6YWJsZSBvciB0aGUgc3Rh\ndGUgaXNuJ3QKICAgICAgICAvLyB0cmFuc2llbnQsIG11c3Qgbm90IGJlIGRl\ndGFjaGVkCiAgICAgICAgaWYgKHN0YXRlID09IG51bGwKICAgICAgICAgICAg\nJiYgKCFDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0\nRGV0YWNoZWRTdGF0ZSgpKQogICAgICAgICAgICB8fCAhU2VyaWFsaXphYmxl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKQogICAgICAgICAgICB8fCAhX3JlcG9zLmdldENvbmZpZ3VyYXRpb24o\nKS5nZXREZXRhY2hTdGF0ZUluc3RhbmNlKCkuCiAgICAgICAgICAgIGlzRGV0\nYWNoZWRTdGF0ZVRyYW5zaWVudCgpKSkgewogICAgICAgICAgICAvLyByZXR1\ncm4gQm9vbGVhbi5GQUxTRQogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygp\nLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xh\nc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBubyBkZXRhY2hl\nZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSAoYW5k\nIG11c3QgYmUKICAgICAgICAvLyBzeW50aGV0aWMgYW5kIHRyYW5zaWVudCBp\nbiBzZXJpYWxpemFibGUgaW5zdGFuY2UgYXQgdGhpcyBwb2ludCksCiAgICAg\nICAgLy8gbm90IGRldGFjaGVkIGlmIHN0YXRlIG5vdCBzZXQgdG8gREVTRVJJ\nQUxJWkVECiAgICAgICAgaWYgKHN0YXRlID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gaWYgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSA9PSBudWxsKSAvLyBp\nbnN0ZWFkIG9mIERFU0VSSUFMSVpFRAogICAgICAgICAgICAvLyAgICAgcmV0\ndXJuIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIs\nIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gZ2l2ZSB1cDsgd2UganVzdCBkb24ndCBrbm93\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbXBhcmUgdGhlIGdpdmVuIGZpZWxkIHRvIGl0cyBK\nYXZhIGRlZmF1bHQsIHJldHVybmluZyB0aGUKICAgICAqIGNvbXBhcmlzb24g\naW5zdHJ1Y3Rpb24uIFRoZSBmaWVsZCB2YWx1ZSB3aWxsIGFscmVhZHkgYmUg\nb24gdGhlIHN0YWNrLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBKdW1w\nSW5zdHJ1Y3Rpb24gaWZEZWZhdWx0VmFsdWUoQ29kZSBjb2RlLAogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJPT0xFQU46CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRCk7CiAgICAgICAg\nICAgICAgICBjb2RlLmRjbXBsKCk7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FU\nOgogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBG\nKTsKICAgICAgICAgICAgICAgIGNvZGUuZmNtcGwoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZSgwTCk7CiAgICAgICAgICAgICAgICBjb2RlLmxjbXAoKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlmbnVsbCgp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRo\nb2QgdG8gZ2V0IHRoZSBjb2RlIGZvciB0aGUgY2xhc3MgaW5pdGlhbGl6ZXIg\nbWV0aG9kLAogICAgICogY3JlYXRpbmcgdGhlIG1ldGhvZCBpZiBpdCBkb2Vz\nIG5vdCBhbHJlYWR5IGV4aXN0LgogICAgICovCiAgICBwcml2YXRlIENvZGUg\nZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKGJvb2xlYW4gcmVwbGFjZUxhc3Qp\nIHsKICAgICAgICBCQ01ldGhvZCBjbGluaXQgPSBfcGMuZ2V0RGVjbGFyZWRN\nZXRob2QoIjxjbGluaXQ+Iik7CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAg\nIGlmIChjbGluaXQgIT0gbnVsbCkgewogICAgICAgICAgICBjb2RlID0gY2xp\nbml0LmdldENvZGUodHJ1ZSk7CiAgICAgICAgICAgIGlmIChyZXBsYWNlTGFz\ndCkgewogICAgICAgICAgICAgICAgQ29kZSB0ZW1wbGF0ZSA9IChDb2RlKSBB\nY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpOwogICAgICAg\nICAgICAgICAgY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRlLnZyZXR1cm4o\nKSk7CiAgICAgICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAg\nICAgICAgICBjb2RlLnNldCh0ZW1wbGF0ZS5ub3AoKSk7CiAgICAgICAgICAg\nICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gY29kZTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCBzdGF0aWMg\naW5pdGlhbGl6ZXIgbWV0aG9kIGlmIG5vbiBleGlzdHMKICAgICAgICBjbGlu\naXQgPSBfcGMuZGVjbGFyZU1ldGhvZCgiPGNsaW5pdD4iLCB2b2lkLmNsYXNz\nLCBudWxsKTsKICAgICAgICBjbGluaXQubWFrZVBhY2thZ2UoKTsKICAgICAg\nICBjbGluaXQuc2V0U3RhdGljKHRydWUpOwogICAgICAgIGNsaW5pdC5zZXRG\naW5hbCh0cnVlKTsKCiAgICAgICAgY29kZSA9IGNsaW5pdC5nZXRDb2RlKHRy\ndWUpOwogICAgICAgIGlmICghcmVwbGFjZUxhc3QpIHsKICAgICAgICAgICAg\nY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIGNvZGUucHJldmlvdXMoKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvZGU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGRzIGJ5dGVjb2RlIG1vZGlmeWluZyB0aGUgY2xvbmluZyBi\nZWhhdmlvciBvZiB0aGUgY2xhc3MgYmVpbmcKICAgICAqIGVuaGFuY2VkIHRv\nIGNvcnJlY3RseSByZXBsYWNlIHRoZSA8Y29kZT5wY1N0YXRlTWFuYWdlcjwv\nY29kZT4gCiAgICAgKiBpbnN0YW5jZSBmaWVsZHMgb2YgYW55IGNsb25lIGNy\nZWF0ZWQgd2l0aCB0aGVpciBkZWZhdWx0IHZhbHVlcy4gCiAgICAgKiBBbHNv\nLCBpZiB0aGlzIGNsYXNzIGlzIHRoZSBiYXNlIFBDIHR5cGUgYW5kIGRvZXMg\nbm90IGRlY2xhcmVkIAogICAgICogYSBjbG9uZSBtZXRob2QsIG9uZSB3aWxs\nIGJlIGFkZGVkLiBBbHNvLCBpZiBfcGMgaXMgYSBzeW50aGV0aWMKICAgICAq\nIHN1YmNsYXNzLCBjcmVhdGUgdGhlIGNsb25lKCkgbWV0aG9kIHRoYXQgY2xl\nYXJzIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgKiB0aGF0IG1heSBoYXZlIGJl\nZW4gaW5pdGlhbGl6ZWQgaW4gYSBzdXBlcidzIGNsb25lKCkgbWV0aG9kLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xvbmluZ0NvZGUoKSB7CiAg\nICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYg\nIWdldENyZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgLy8gYWRkIHRoZSBjbG9uZSBtZXRob2QgaWYgbmVjZXNzYXJ5CiAg\nICAgICAgQkNNZXRob2QgY2xvbmUgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2Qo\nImNsb25lIiwgCiAgICAgICAgICAgIChTdHJpbmdbXSkgbnVsbCk7CiAgICAg\nICAgU3RyaW5nIHN1cGVyTmFtZSA9IF9tYW5hZ2VkVHlwZS5nZXRTdXBlcmNs\nYXNzTmFtZSgpOwogICAgICAgIENvZGUgY29kZSA9IG51bGw7CiAgICAgICAg\naWYgKGNsb25lID09IG51bGwpIHsKICAgICAgICAgICAgLy8gYWRkIGNsb25l\nIHN1cHBvcnQgZm9yIGJhc2UgY2xhc3NlcwogICAgICAgICAgICAvLyB3aGlj\naCBhbHNvIGltcGxlbWVudCBjbG9uZWFibGUKICAgICAgICAgICAgYm9vbGVh\nbiBpc0Nsb25lYWJsZSA9IENsb25lYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVG\ncm9tKAogICAgICAgICAgICAgICAgX21hbmFnZWRUeXBlLmdldFR5cGUoKSk7\nCiAgICAgICAgICAgIGJvb2xlYW4gZXh0ZW5kc09iamVjdCA9CiAgICAgICAg\nICAgICAgICBzdXBlck5hbWUuZXF1YWxzKE9iamVjdC5jbGFzcy5nZXROYW1l\nKCkpOwogICAgICAgICAgICBpZiAoIWlzQ2xvbmVhYmxlIHx8ICghZXh0ZW5k\nc09iamVjdCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkpCiAgICAgICAgICAg\nICAgICByZXR1cm47CgogICAgICAgICAgICBpZiAoIWdldENyZWF0ZVN1YmNs\nYXNzKCkpCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoCiAgICAgICAg\nICAgICAgICAgICAgICAgIF9sb2MuZ2V0KCJlbmhhbmNlLWNsb25lYWJsZSIs\nIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCkpKTsKCiAgICAgICAgICAgIC8vIGFk\nZCBjbG9uZSBtZXRob2QKICAgICAgICAgICAgLy8gcHJvdGVjdGVkIE9iamVj\ndCBjbG9uZSAoKSB0aHJvd3MgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24K\nICAgICAgICAgICAgY2xvbmUgPSBfcGMuZGVjbGFyZU1ldGhvZCgiY2xvbmUi\nLCBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBpZiAoIXNldFZp\nc2liaWxpdHlUb1N1cGVyTWV0aG9kKGNsb25lKSkKICAgICAgICAgICAgICAg\nIGNsb25lLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICAgICAgY2xvbmUuZ2V0\nRXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24KICAgICAgICAgICAgICAg\nIChDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIGNvZGUgPSBjbG9uZS5nZXRDb2RlKHRydWUpOwoKICAgICAgICAgICAg\nLy8gcmV0dXJuIHN1cGVyLmNsb25lICgpOwogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cGVyTmFtZSwgImNsb25lIiwK\nICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcy5nZXROYW1lKCksIG51bGwp\nOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAvLyBnZXQgdGhlIGNsb25lIG1ldGhvZCBjb2RlCiAg\nICAgICAgICAgIGNvZGUgPSBjbG9uZS5nZXRDb2RlKGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKGNvZGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSB0ZW1wbGF0ZSBzdXBl\nci5jbG9uZSAoKSBpbnN0cnVjdGlvbiB0byBtYXRjaCBhZ2FpbnN0CiAgICAg\nICAgSW5zdHJ1Y3Rpb24gdGVtcGxhdGUgPSAoKENvZGUpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5uZXdDb2RlQWN0aW9uKCkpKS5pbnZva2VzcGVjaWFsKCkKICAgICAgICAg\nICAgLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9uZSIsIE9iamVjdC5jbGFz\ncy5nZXROYW1lKCksIG51bGwpOwoKICAgICAgICAvLyBmaW5kIGNhbGxzIHRv\nIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlvbjsgb24gbWF0Y2gKICAgICAgICAv\nLyBjbG9uZSB3aWxsIGJlIG9uIHN0YWNrCiAgICAgICAgY29kZS5iZWZvcmVG\naXJzdCgpOwogICAgICAgIGlmIChjb2RlLnNlYXJjaEZvcndhcmQodGVtcGxh\ndGUpKSB7CiAgICAgICAgICAgIC8vICgoPHR5cGU+KSBjbG9uZSkucGNTdGF0\nZU1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoX3BjKTsKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAg\nY29kZS5wdXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwoKICAgICAg\nICAgICAgLy8gaWYgbW9kaWZpZWQsIGluY3JlYXNlIHN0YWNrCiAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZXRzIHRoZSBhdXhpbGlhcnkgZW5oYW5jZXJzIHJlZ2lz\ndGVyZWQgYXMge0BsaW5rIFNlcnZpY2VzIHNlcnZpY2VzfS4KICAgICAqLwog\nICAgcHVibGljIEF1eGlsaWFyeUVuaGFuY2VyW10gZ2V0QXV4aWxpYXJ5RW5o\nYW5jZXJzKCkgewoJCXJldHVybiBfYXV4RW5oYW5jZXJzOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEFsbG93IGFueSByZWdpc3RlcmVkIGF1eGlsaWFy\neSBjb2RlIGdlbmVyYXRvcnMgdG8gcnVuLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcnVuQXV4aWxpYXJ5RW5oYW5jZXJzKCkgewogICAgCWZvciAoaW50\nIGkgPSAwOyBpIDwgX2F1eEVuaGFuY2Vycy5sZW5ndGg7IGkrKykKICAgIAkJ\nX2F1eEVuaGFuY2Vyc1tpXS5ydW4oX3BjLCBfbWV0YSk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgZ2l2ZW4gbWV0aG9kIGJl\nIHNraXBwZWQuCiAgICAgKiAKICAgICAqIEBwYXJhbSBtZXRob2QgbWV0aG9k\nIHRvIGJlIHNraXBwZWQgb3Igbm90CiAgICAgKiBAcmV0dXJuIHRydWUgaWYg\nYW55IG9mIHRoZSBhdXhpbGlhcnkgZW5oYW5jZXJzIHNraXBzIHRoZSBnaXZl\nbiBtZXRob2QsCiAgICAgKiBvciBpZiB0aGUgbWV0aG9kIGlzIGEgY29uc3Ry\ndWN0b3IKICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIHNraXBFbmhhbmNl\nKEJDTWV0aG9kIG1ldGhvZCkgewogICAgICAgIGlmICgiPGluaXQ+Ii5lcXVh\nbHMobWV0aG9kLmdldE5hbWUoKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2F1eEVu\naGFuY2Vycy5sZW5ndGg7IGkrKykKICAgIAkJaWYgKF9hdXhFbmhhbmNlcnNb\naV0uc2tpcEVuaGFuY2UobWV0aG9kKSkKICAgIAkJCXJldHVybiB0cnVlOwog\nICAgICAgIAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgc3ludGhldGljIGZpZWxkIGFjY2VzcyBtZXRob2RzIHRo\nYXQgd2lsbCByZXBsYWNlIGFsbCBkaXJlY3QKICAgICAqIGZpZWxkIGFjY2Vz\nc2VzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQWNjZXNzb3JzKCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkg\nPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERl\nY2xhcmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgICAgICBpZiAoIWdldFJlZGVmaW5l\nKCkKICAgICAgICAgICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nlc3NUeXBl\nKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAg\nICAgICAgICAgICBhZGRTdWJjbGFzc1NldE1ldGhvZChmbWRzW2ldKTsKICAg\nICAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc0dldE1ldGhvZChmbWRzW2ld\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGFkZEdldE1ldGhvZChpLCBmbWRzW2ldKTsKICAgICAg\nICAgICAgICAgIGFkZFNldE1ldGhvZChpLCBmbWRzW2ldKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBu\nb24tc3RhdGljIHNldHRlciB0aGF0IGRlbGVnYXRlcyB0byB0aGUgc3VwZXIg\nbWV0aG9kcywgYW5kCiAgICAgKiBwZXJmb3JtcyBhbnkgbmVjZXNzYXJ5IGZp\nZWxkIHRyYWNraW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3Vi\nY2xhc3NTZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3MgcHJv\ncFR5cGUgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgU3RyaW5n\nIHNldHRlck5hbWUgPSBnZXRTZXR0ZXJOYW1lKGZtZCk7CiAgICAgICAgQkNN\nZXRob2Qgc2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2Qoc2V0dGVyTmFtZSwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW10geyBwcm9wVHlw\nZSB9KTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChzZXR0\nZXIpOwogICAgICAgIENvZGUgY29kZSA9IHNldHRlci5nZXRDb2RlKHRydWUp\nOwoKICAgICAgICAvLyBub3QgbmVjZXNzYXJ5IGlmIHdlJ3JlIGFscmVhZHkg\ndHJhY2tpbmcgYWNjZXNzIHZpYSByZWRlZmluaXRpb24KICAgICAgICBpZiAo\nIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBvcmln\nIHZhbHVlIG9udG8gc3RhY2sKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShj\nb2RlLCBmbWQpOwogICAgICAgICAgICBpbnQgdmFsID0gY29kZS5nZXROZXh0\nTG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRM\nb2NhbCh2YWwpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAg\nICAgICAgICAgYWRkTm90aWZ5TXV0YXRpb24oY29kZSwgZm1kLCB2YWwsIDAp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gIyMjIyMgdGVzdCBjYXNlOiBCIGV4\ndGVuZHMgQS4gTWV0aG9kcyBkZWZpbmVkIGluIEEuIFdoYXQKICAgICAgICAv\nLyAjIyMjIyBoYXBwZW5zPwogICAgICAgIC8vIHN1cGVyLnNldFhYWCguLi4p\nCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2Rl\nLnhsb2FkKCkuc2V0UGFyYW0oMCkuc2V0VHlwZShwcm9wVHlwZSk7CiAgICAg\nICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2VkVHlw\nZS5nZXRUeXBlKCksCiAgICAgICAgICAgIHNldHRlck5hbWUsIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdIHsgcHJvcFR5cGUgfSk7CgogICAgICAgIGNvZGUu\ndnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAg\nIHByaXZhdGUgYm9vbGVhbiBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChC\nQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMg\nPSBfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRob2QuZ2V0TmFtZSgpLAog\nICAgICAgICAgICBtZXRob2QuZ2V0UGFyYW1UeXBlcygpKTsKICAgICAgICBp\nZiAobWV0aG9kcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWFjY2Vzc29yIiwKICAgICAg\nICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCksIG1ldGhvZC5nZXRO\nYW1lKCkpKTsKICAgICAgICBCQ01ldGhvZCBzdXBlck1ldGggPSBtZXRob2Rz\nWzBdOwogICAgICAgIGlmIChzdXBlck1ldGguaXNQcml2YXRlKCkpIHsKICAg\nICAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRoLmlzUGFj\na2FnZSgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtlUGFja2FnZSgpOwog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1\ncGVyTWV0aC5pc1Byb3RlY3RlZCgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5t\nYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRoLmlzUHVibGljKCkpIHsKICAgICAg\nICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgYSBub24tc3RhdGljIGdldHRlciB0aGF0\nIGRlbGVnYXRlcyB0byB0aGUgc3VwZXIgbWV0aG9kcywgYW5kCiAgICAgKiBw\nZXJmb3JtcyBhbnkgbmVjZXNzYXJ5IGZpZWxkIHRyYWNraW5nLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NHZXRNZXRob2QoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWUgPSAiZ2V0\nIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdldE5hbWUoKSk7CiAg\nICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXRNZXRob2RzKG1ldGhOYW1lLCBu\nZXcgQ2xhc3NbMF0pLmxlbmd0aCA9PSAwKQogICAgICAgICAgICBtZXRoTmFt\nZSA9ICJpcyIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1l\nKCkpOwogICAgICAgIEJDTWV0aG9kIGdldHRlciA9IF9wYy5kZWNsYXJlTWV0\naG9kKG1ldGhOYW1lLCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAg\nICAgIG51bGwpOwogICAgICAgIHNldFZpc2liaWxpdHlUb1N1cGVyTWV0aG9k\nKGdldHRlcik7CiAgICAgICAgZ2V0dGVyLm1ha2VQdWJsaWMoKTsKICAgICAg\nICBDb2RlIGNvZGUgPSBnZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gaWYgd2UncmUgbm90IGFscmVhZHkgdHJhY2tpbmcgZmllbGQgYWNjZXNz\nIHZpYSByZWZsZWN0aW9uLCB0aGVuIHdlCiAgICAgICAgLy8gbXVzdCBtYWtl\nIHRoZSBnZXR0ZXIgaG9vayBpbiBsYXp5IGxvYWRpbmcgYmVmb3JlIGFjY2Vz\nc2luZyB0aGUgc3VwZXIKICAgICAgICAvLyBtZXRob2QuCiAgICAgICAgaWYg\nKCFnZXRSZWRlZmluZSgpKQogICAgICAgICAgICBhZGROb3RpZnlBY2Nlc3Mo\nY29kZSwgZm1kKTsKCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoX21hbmFn\nZWRUeXBlLmdldFR5cGUoKSwgbWV0aE5hbWUsCiAgICAgICAgICAgIGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSwgbnVsbCk7CiAgICAgICAgY29kZS54cmV0dXJu\nKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBhIHN0\nYXRpYyBnZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAgICAg\nKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUgaW5z\ndGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5hZ2VyIHRvIGdl\ndCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAgICAqIEBwYXJh\nbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBmaWVsZAogICAg\nICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmllbGQgdG8gZ2V0\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRHZXRNZXRob2QoaW50IGlu\nZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBj\ncmVhdGVHZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgcmVhZHMgYXJlIG5v\ndCBjaGVja2VkLCBqdXN0IHJldHVybiB0aGUgdmFsdWUKICAgICAgICBieXRl\nIGZpZWxkRmxhZyA9IGdldEZpZWxkRmxhZyhmbWQpOwogICAgICAgIGlmICgo\nZmllbGRGbGFnICYgUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1JFQUQpID09\nIDAKICAgICAgICAgICAgJiYgKGZpZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5NRURJQVRFX1JFQUQpID09IDApIHsKICAgICAgICAgICAgbG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICAgICAgYWRkR2V0\nTWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgICAgICBjb2Rl\nLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7Cgog\nICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIChpbnN0LnBjU3RhdGVN\nYW5hZ2VyID09IG51bGwpIHJldHVybiBpbnN0LjxmaWVsZD47CiAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVt\ncEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGFk\nZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2Rl\nLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7Cgog\nICAgICAgIC8vIGludCBmaWVsZCA9IHBjSW5oZXJpdGVkRmllbGRDb3VudCAr\nIDxmaWVsZGluZGV4PjsKICAgICAgICBpbnQgZmllbGRMb2NhbCA9IGNvZGUu\nZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNz\nKSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsK\nICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNl\ndExvY2FsKGZpZWxkTG9jYWwpOwoKICAgICAgICAvLyBpbnN0LnBjU3RhdGVN\nYW5hZ2VyLmFjY2Vzc2luZ0ZpZWxkIChmaWVsZCk7CiAgICAgICAgLy8gcmV0\ndXJuIGluc3QuPGZpZWxkPjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwo\nZmllbGRMb2NhbCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5z\nZXRNZXRob2QoU01UWVBFLCAiYWNjZXNzaW5nRmllbGQiLCB2b2lkLmNsYXNz\nLAogICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0pOwogICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAg\nYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIGNv\nZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsK\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBZGRzIGEgc3RhdGljIHNldHRlciBtZXRob2QgZm9yIHRoZSBnaXZlbiBm\naWVsZC4KICAgICAqIFRoZSBnZW5lcmF0ZWQgbWV0aG9kIGludGVyYWN0cyB3\naXRoIHRoZSBpbnN0YW5jZSBzdGF0ZSBhbmQgdGhlCiAgICAgKiBTdGF0ZU1h\nbmFnZXIgdG8gc2V0IHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQuCiAgICAgKgog\nICAgICogQHBhcmFtIGluZGV4IHRoZSByZWxhdGl2ZSBudW1iZXIgb2YgdGhl\nIGZpZWxkCiAgICAgKiBAcGFyYW0gZm1kIG1ldGFkYXRhIGFib3V0IHRoZSBm\naWVsZCB0byBzZXQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNldE1l\ndGhvZChpbnQgaW5kZXgsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRo\ncm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIEJDTWV0aG9k\nIG1ldGhvZCA9IGNyZWF0ZVNldE1ldGhvZChmbWQpOwogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBQQ0Vu\naGFuY2VyIHVzZXMgc3RhdGljIG1ldGhvZHM7IFBDU3ViY2xhc3NlciBkb2Vz\nIG5vdC4KICAgICAgICBpbnQgZmlyc3RQYXJhbU9mZnNldCA9IGdldEFjY2Vz\nc29yUGFyYW1ldGVyT2Zmc2V0KCk7CgogICAgICAgIC8vIGlmIChpbnN0LnBj\nU3RhdGVNYW5hZ2VyID09IG51bGwpIGluc3QuPGZpZWxkPiA9IHZhbHVlOwog\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7\nCiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAg\nICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oZmlyc3RQYXJhbU9mZnNldCk7\nCiAgICAgICAgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwog\nICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAvLyBpbnN0LnBjU3Rh\ndGVNYW5hZ2VyLnNldHRpbmc8ZmllbGRUeXBlPkZpZWxkIChpbnN0LAogICAg\nICAgIC8vICAgICBwY0luaGVyaXRlZEZpZWxkQ291bnQgKyA8aW5kZXg+LCBp\nbnN0LjxmaWVsZD4sIHZhbHVlLCAwKTsKICAgICAgICBpZmlucy5zZXRUYXJn\nZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKSk7CiAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29k\nZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7CiAgICAg\nICAgY29kZS5pYWRkKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCB0cnVlKTsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIGZtZCk7CiAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZpcnN0\nUGFyYW1PZmZzZXQpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgwKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAgICAgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSwgInNldHRpbmciLCBmYWxzZSwgdHJ1ZSkpOwogICAg\nICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZXMgd2hpY2ggYXR0YWNo\nIC8gZGV0YWNoIG1ldGhvZHMgdG8gdXNlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkQXR0YWNoRGV0YWNoQ29kZSgpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2VlIGlmIGFueSBz\ndXBlcmNsYXNzZXMgYXJlIGRldGFjaGFibGUKICAgICAgICBib29sZWFuIHBh\ncmVudERldGFjaGFibGUgPSBmYWxzZTsKICAgICAgICBmb3IgKENsYXNzTWV0\nYURhdGEgcGFyZW50ID0gX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICAgICAgcGFyZW50ICE9IG51bGw7IHBhcmVudCA9IHBhcmVu\ndC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKSB7CiAgICAgICAgICAgIGlm\nIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgICAgIHBh\ncmVudERldGFjaGFibGUgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIHBhcmVu\ndCBub3QgZGV0YWNoYWJsZSwgd2UgbmVlZCB0byBhZGQgdGhlIGRldGFjaCBz\ndGF0ZSBmaWVsZHMgYW5kCiAgICAgICAgLy8gYWNjZXNzb3IgbWV0aG9kcwog\nICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8\nIGdldENyZWF0ZVN1YmNsYXNzKCkKICAgICAgICAgICAgfHwgcGFyZW50RGV0\nYWNoYWJsZSAhPSBfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAg\nICBhZGRJc0RldGFjaGVkTWV0aG9kKCk7CiAgICAgICAgICAgIGFkZERldGFj\naGVkU3RhdGVNZXRob2RzKF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkKICAg\nICAgICAgICAgICAgICE9IEJvb2xlYW4uRkFMU0UpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgd2UgZGV0YWNoIG9uIHNlcmlhbGl6ZSwgd2UgYWxzbyBu\nZWVkIHRvIGltcGxlbWVudCB0aGUKICAgICAgICAvLyBleHRlcm5hbGl6YWJs\nZSBpbnRlcmZhY2UgdG8gd3JpdGUganVzdCB0aGUgc3RhdGUgZm9yIHRoZSBm\naWVsZHMKICAgICAgICAvLyBiZWluZyBkZXRhY2hlZAogICAgICAgIGlmIChl\neHRlcm5hbGl6ZURldGFjaGVkKCkpIHsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGFkZERldGFjaEV4dGVybmFsaXplKHBhcmVudERldGFj\naGFibGUsCiAgICAgICAgICAgICAgICAgICAgX21ldGEudXNlc0RldGFjaGVk\nU3RhdGUoKSAhPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICAgICAgfSBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKG5zbWUpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRo\nZSBmaWVsZHMgdG8gaG9sZCBkZXRhY2hlZCBzdGF0ZSBhbmQgdGhlaXIgYWNj\nZXNzb3IgbWV0aG9kcy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW1wbCB3aGV0\naGVyIHRvIGZ1bGx5IGltcGxlbWVudCBkZXRhY2ggc3RhdGUgZnVuY3Rpb25h\nbGl0eQogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkRGV0YWNoZWRTdGF0\nZU1ldGhvZHMoYm9vbGVhbiBpbXBsKSB7CiAgICAgICAgRmllbGQgZGV0YWNo\nRmllbGQgPSBfbWV0YS5nZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAg\nICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAgU3RyaW5nIGRlY2xhcmVy\nID0gbnVsbDsKICAgICAgICBpZiAoaW1wbCAmJiBkZXRhY2hGaWVsZCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIG5hbWUgPSBQUkUgKyAiRGV0YWNoZWRTdGF0\nZSI7CiAgICAgICAgICAgIGRlY2xhcmVyID0gX3BjLmdldE5hbWUoKTsKICAg\nICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQobmFt\nZSwgT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgZmllbGQubWFrZVByaXZh\ndGUoKTsKICAgICAgICAgICAgZmllbGQuc2V0VHJhbnNpZW50KHRydWUpOwog\nICAgICAgIH0gZWxzZSBpZiAoaW1wbCkgewogICAgICAgICAgICBuYW1lID0g\nZGV0YWNoRmllbGQuZ2V0TmFtZSgpOwogICAgICAgICAgICBkZWNsYXJlciA9\nIGRldGFjaEZpZWxkLmdldERlY2xhcmluZ0NsYXNzKCkuZ2V0TmFtZSgpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gcHVibGljIE9iamVjdCBwY0dldERldGFj\naGVkU3RhdGUgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLnNldFN0\nYXRpYyhmYWxzZSk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAg\nICAgICBpbnQgYWNjZXNzID0gbWV0aG9kLmdldEFjY2Vzc0ZsYWdzKCk7Cgog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAg\nICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBwY0RldGFj\naGVkU3RhdGU7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBfbWFuYWdl\nZFR5cGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAg\nICAgICAgICAgICBuYW1lKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKCiAgICAgICAgLy8gcHVi\nbGljIHZvaWQgcGNTZXREZXRhY2hlZFN0YXRlIChPYmplY3Qgc3RhdGUpCiAg\nICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNldERl\ndGFjaGVkU3RhdGUiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3MgW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBtZXRob2Quc2V0QWNj\nZXNzRmxhZ3MoYWNjZXNzKTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgaWYgKGltcGwpIHsKICAgICAgICAgICAgLy8g\ncGNEZXRhY2hlZFN0YXRlID0gc3RhdGU7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUs\nIF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9hZENsYXNzKGRlY2xhcmVy\nKSwKICAgICAgICAgICAgICAgIG5hbWUsIE9iamVjdC5jbGFzcyk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0byA8Y29kZT5j\nb2RlPC9jb2RlPiB0aGUgaW5zdHJ1Y3Rpb25zIHRvIGdldCBmaWVsZAogICAg\nICogPGNvZGU+YXR0ck5hbWU8L2NvZGU+IGRlY2xhcmVkIGluIHR5cGUgPGNv\nZGU+ZGVjbGFyZXI8L2NvZGU+CiAgICAgKiBvbnRvIHRoZSB0b3Agb2YgdGhl\nIHN0YWNrLgogICAgICoKICAgICAqIFRoZSBpbnN0YW5jZSB0byBhY2Nlc3Mg\nbXVzdCBhbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlCiAgICAgKiBzdGFj\nayB3aGVuIHRoaXMgaXMgaW52b2tlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGdldGZpZWxkKENvZGUgY29kZSwgQkNDbGFzcyBkZWNsYXJlciwgU3Ry\naW5nIGF0dHJOYW1lKSB7CiAgICAgICAgaWYgKGRlY2xhcmVyID09IG51bGwp\nCiAgICAgICAgICAgIGRlY2xhcmVyID0gX21hbmFnZWRUeXBlOwoKICAgICAg\nICAvLyBmaXJzdCwgc2VlIGlmIHdlIGNhbiBjb252ZXJ0IHRoZSBhdHRyaWJ1\ndGUgbmFtZSB0byBhIGZpZWxkIG5hbWUKICAgICAgICBTdHJpbmcgZmllbGRO\nYW1lID0gdG9CYWNraW5nRmllbGROYW1lKGF0dHJOYW1lKTsKCiAgICAgICAg\nLy8gbmV4dCwgZmluZCB0aGUgZmllbGQgaW4gdGhlIG1hbmFnZWQgdHlwZS4K\nICAgICAgICBCQ0ZpZWxkW10gZmllbGRzID0gKEJDRmllbGRbXSkgQWNjZXNz\nQ29udHJvbGxlcgogICAgICAgICAgICAuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2\nSGVscGVyLmdldEJDQ2xhc3NGaWVsZHNBY3Rpb24oX21hbmFnZWRUeXBlLAog\nICAgICAgICAgICAgICAgZmllbGROYW1lKSk7IAogICAgICAgIEJDRmllbGQg\nZmllbGQgPSBudWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmll\nbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpZWxkID0gZmllbGRz\nW2ldOwogICAgICAgICAgICAvLyBpZiB3ZSByZWFjaCBhIGZpZWxkIGRlY2xh\ncmVkIGluIHRoaXMgdHlwZSwgdGhlbiB0aGlzIGlzIHRoZQogICAgICAgICAg\nICAvLyBtb3N0LW1hc2tpbmcgZmllbGQsIGFuZCBpcyB0aGUgb25lIHRoYXQg\nd2Ugd2FudC4KICAgICAgICAgICAgLy8gIyMjIyMgcHJvYmFibHkgc2hvdWxk\nIHdhbGsgdXAgdGhlIGhpZXJhcmNoeSwgb3IgY2hlY2sgdGhhdAogICAgICAg\nICAgICAvLyAjIyMjIyBzZXJwIGRvZXMgdGhhdC4KICAgICAgICAgICAgaWYg\nKGZpZWxkc1tpXS5nZXREZWNsYXJlcigpID09IGRlY2xhcmVyKSB7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkgJiYgY29kZS5nZXRNZXRo\nb2QoKS5nZXREZWNsYXJlcigpID09IF9wYwogICAgICAgICAgICAmJiAoZmll\nbGQgPT0gbnVsbCB8fCAhZmllbGQuaXNQdWJsaWMoKSkpIHsKICAgICAgICAg\nICAgLy8gd2UncmUgY3JlYXRpbmcgdGhlIHN1YmNsYXNzLCBub3QgcmVkZWZp\nbmluZyB0aGUgdXNlciB0eXBlLgoKICAgICAgICAgICAgLy8gUmVmbGVjdGlv\nbi5nZXRYWFgodGhpcywgUmVmbGVjdGlvbi5maW5kRmllbGQoLi4uKSk7CiAg\nICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKGRlY2xh\ncmVyKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZp\nZWxkTmFtZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSh0cnVlKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoUmVmbGVjdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICJmaW5k\nRmllbGQiLCBGaWVsZC5jbGFzcywgbmV3IENsYXNzW10gewogICAgICAgICAg\nICAgICAgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgYm9vbGVhbi5jbGFz\ncyB9KTsKICAgICAgICAgICAgQ2xhc3MgdHlwZSA9IF9tZXRhLmdldEZpZWxk\nKGF0dHJOYW1lKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kKAogICAgICAgICAgICAgICAgICAgIGdldFJlZmxlY3Rpb25HZXR0ZXJN\nZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAgfSBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIC8vIHNob3VsZCBuZXZlciBoYXBwZW4KICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoIXR5cGUuaXNQcmltaXRpdmUoKSAmJiB0eXBlICE9IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZSh0eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBm\naWVsZE5hbWUsCiAgICAgICAgICAgICAgICBmaWVsZC5nZXRUeXBlKCkuZ2V0\nTmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIHRvIDxjb2RlPmNvZGU8L2NvZGU+IHRoZSBpbnN0cnVjdGlvbnMgdG8gc2V0\nIGZpZWxkCiAgICAgKiA8Y29kZT5hdHRyTmFtZTwvY29kZT4gZGVjbGFyZWQg\naW4gdHlwZSA8Y29kZT5kZWNsYXJlcjwvY29kZT4KICAgICAqIHRvIHRoZSB2\nYWx1ZSBvZiB0eXBlIDxjb2RlPmZpZWxkVHlwZTwvY29kZT4gb24gdGhlIHRv\ncCBvZiB0aGUgc3RhY2suCiAgICAgKgogICAgICogV2hlbiB0aGlzIG1ldGhv\nZCBpcyBpbnZva2VkLCB0aGUgdmFsdWUgdG8gbG9hZCBtdXN0CiAgICAgKiBh\nbHJlYWR5IGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGluIDxjb2RlPmNv\nZGU8L2NvZGU+LAogICAgICogYW5kIHRoZSBpbnN0YW5jZSB0byBsb2FkIGlu\ndG8gbXVzdCBiZSBzZWNvbmQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBw\ndXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBh\ndHRyTmFtZSwKICAgICAgICBDbGFzcyBmaWVsZFR5cGUpIHsKICAgICAgICBp\nZiAoZGVjbGFyZXIgPT0gbnVsbCkKICAgICAgICAgICAgZGVjbGFyZXIgPSBf\nbWFuYWdlZFR5cGU7CgogICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSB0b0Jh\nY2tpbmdGaWVsZE5hbWUoYXR0ck5hbWUpOwoKICAgICAgICBpZiAoZ2V0UmVk\nZWZpbmUoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAg\nIC8vIFJlZmxlY3Rpb24uc2V0KHRoaXMsIFJlZmxlY3Rpb24uZmluZEZpZWxk\nKC4uLiksIHZhbHVlKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50\nKCkuc2V0Q2xhc3MoZGVjbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAg\nICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7CiAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNs\nYXNzLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLAogICAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZS5pc1ByaW1pdGl2ZSgp\nID8gZmllbGRUeXBlIDogT2JqZWN0LmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICBGaWVsZC5jbGFzcyB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBjb2RlLnB1dGZpZWxkKCkKICAgICAgICAgICAgICAgIC5zZXRGaWVs\nZChkZWNsYXJlci5nZXROYW1lKCksIGZpZWxkTmFtZSwgZmllbGRUeXBlLmdl\ndE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYg\ndXNpbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZm\nZXJlbnQgYmFja2luZyBmaWVsZAogICAgICogbmFtZSBmb3IgdGhlIHBlcnNp\nc3RlbnQgYXR0cmlidXRlIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICovCiAg\nICBwcml2YXRlIFN0cmluZyB0b0JhY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5h\nbWUpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENs\nYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZCiAgICAgICAgICAgICYmIF9h\ndHRyc1RvRmllbGRzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAgICBu\nYW1lID0gKFN0cmluZykgX2F0dHJzVG9GaWVsZHMuZ2V0KG5hbWUpOwogICAg\nICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogSWYgdXNp\nbmcgcHJvcGVydHkgYWNjZXNzLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZmZXJl\nbnQgcGVyc2lzdGVudAogICAgICogYXR0cmlidXRlIG5hbWUgZm9yIHRoZSBi\nYWNraW5nIGZpZWxkIDxjb2RlPm5hbWU8L2NvZGU+LgogICAgICovCiAgICBw\ncml2YXRlIFN0cmluZyBmcm9tQmFja2luZ0ZpZWxkTmFtZShTdHJpbmcgbmFt\nZSkgewogICAgICAgIC8vIG1ldGEgaXMgbnVsbCB3aGVuIGRvaW5nIHBlcnNp\nc3RlbmNlLWF3YXJlIGVuaGFuY2VtZW50CiAgICAgICAgaWYgKF9tZXRhICE9\nIG51bGwKICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09\nIENsYXNzTWV0YURhdGEuQUNDRVNTX1BST1BFUlRZCiAgICAgICAgICAgICYm\nIF9maWVsZHNUb0F0dHJzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAgICAg\nICByZXR1cm4gKFN0cmluZykgX2ZpZWxkc1RvQXR0cnMuZ2V0KG5hbWUpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhlIGV4dGVybmFsaXphYmxlIGlu\ndGVyZmFjZSB0byBkZXRhY2ggb24gc2VyaWFsaXplLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkRGV0YWNoRXh0ZXJuYWxpemUoYm9vbGVhbiBwYXJl\nbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBlbnN1cmUgdGhhdCB0aGUgZGVjbGFyZWQgZGVmYXVsdCBjb25zdHJ1\nY3RvciBpcyBwdWJsaWMgCiAgICAgICAgLy8gZm9yIGV4dGVybmFsaXphdGlv\nbgogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZ2V0RGVjbGFyZWRNZXRo\nb2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7CiAgICAgICAgaWYgKCFt\nZXRoLmlzUHVibGljKCkpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJlbmhhbmNlLWRlZmNvbnMtZXh0ZXJuIiwgCiAgICAgICAgICAgICAgICAg\nIF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpOwogICAgICAgICAgICBtZXRo\nLm1ha2VQdWJsaWMoKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVjbGFyZSBl\neHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UKICAgICAgICBpZiAoIUV4dGVybmFs\naXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKSkKICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2Uo\nRXh0ZXJuYWxpemFibGUuY2xhc3MpOwoKICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhlIHVzZXIgZG9lc24ndCBhbHJlYWR5IGhhdmUgY3VzdG9tIGV4dGVybmFs\naXphdGlvbiBvcgogICAgICAgIC8vIHNlcmlhbGl6YXRpb24gbWV0aG9kcwog\nICAgICAgIENsYXNzW10gaW5wdXQgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5w\ndXRTdHJlYW0uY2xhc3MgfTsKICAgICAgICBDbGFzc1tdIG91dHB1dCA9IG5l\ndyBDbGFzc1tdeyBPYmplY3RPdXRwdXRTdHJlYW0uY2xhc3MgfTsKICAgICAg\nICBpZiAoX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkT2Jq\nZWN0IiwgaW5wdXQpICE9IG51bGwKICAgICAgICAgICAgfHwgX21hbmFnZWRU\neXBlLmdldERlY2xhcmVkTWV0aG9kKCJ3cml0ZU9iamVjdCIsIG91dHB1dCkg\nIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImRldGFjaC1jdXN0b20tc2VyIiwgX21ldGEpKTsKICAgICAg\nICBpbnB1dFswXSA9IE9iamVjdElucHV0LmNsYXNzOwogICAgICAgIG91dHB1\ndFswXSA9IE9iamVjdE91dHB1dC5jbGFzczsKICAgICAgICBpZiAoX21hbmFn\nZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCBpbnB1\ndCkgIT0gbnVsbAogICAgICAgICAgICB8fCBfbWFuYWdlZFR5cGUuZ2V0RGVj\nbGFyZWRNZXRob2QoIndyaXRlRXh0ZXJuYWwiLCBvdXRwdXQpICE9IG51bGwp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJkZXRhY2gtY3VzdG9tLWV4dGVybiIsIF9tZXRhKSk7CgogICAgICAgIC8v\nIGNyZWF0ZSBsaXN0IG9mIGFsbCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZp\nZWxkcwogICAgICAgIEJDRmllbGRbXSBmaWVsZHMgPSBfbWFuYWdlZFR5cGUu\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBDb2xsZWN0aW9uIHVubWdk\nID0gbmV3IEFycmF5TGlzdChmaWVsZHMubGVuZ3RoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBpZiAoIWZpZWxkc1tpXS5pc1RyYW5zaWVudCgpICYmICFmaWVsZHNb\naV0uaXNTdGF0aWMoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5p\nc0ZpbmFsKCkKICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uZ2V0TmFt\nZSgpLnN0YXJ0c1dpdGgoUFJFKQogICAgICAgICAgICAgICAgJiYgX21ldGEu\nZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgpKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgdW5tZ2QuYWRkKGZpZWxkc1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICBhZGRSZWFkRXh0ZXJuYWwocGFyZW50RGV0YWNoYWJs\nZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkUmVhZFVubWFuYWdlZCh1\nbm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7CiAgICAgICAgYWRkV3JpdGVFeHRl\ncm5hbChwYXJlbnREZXRhY2hhYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAg\nICBhZGRXcml0ZVVubWFuYWdlZCh1bm1nZCwgcGFyZW50RGV0YWNoYWJsZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY3VzdG9tIHJlYWRFeHRlcm5h\nbCBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZWFkRXh0\nZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlLAogICAgICAgIGJvb2xl\nYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9IG5ldyBDbGFz\nc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1l\ndGggPSBfcGMuZGVjbGFyZU1ldGhvZCgicmVhZEV4dGVybmFsIiwgdm9pZC5j\nbGFzcywgaW5hcmdzKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1l\ndGguZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhj\nZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBleGNlcHMuYWRk\nRXhjZXB0aW9uKENsYXNzTm90Rm91bmRFeGNlcHRpb24uY2xhc3MpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAg\nLy8gc3VwZXIucmVhZEV4dGVybmFsIChpbik7CiAgICAgICAgQ2xhc3Mgc3Vw\nID0gX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldFN1cGVyY2xhc3MoKTsK\nICAgICAgICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJyZWFkRXh0ZXJuYWwi\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgaW5hcmdzKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHJlYWRVbm1hbmFnZWQgKGluKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEpLAogICAgICAgICAgICBQ\nUkUgKyAiUmVhZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIGluYXJncyk7Cgog\nICAgICAgIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIHBj\nU2V0RGV0YWNoZWRTdGF0ZSAoaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAg\nICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNs\nYXNzLCAicmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUiLAogICAgICAgICAg\nICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9\nKTsKCiAgICAgICAgICAgIC8vIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoKFN0\nYXRlTWFuYWdlcikgaW4ucmVhZE9iamVjdCAoKSk7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdElucHV0LmNsYXNzLCAi\ncmVhZE9iamVjdCIsCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51\nbGwpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3Rh\ndGVNYW5hZ2VyLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFBSRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTdGF0\nZU1hbmFnZXIuY2xhc3MgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZWFk\nIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghZm1kc1tp\nXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgcmVhZEV4dGVybmFs\nKGNvZGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAg\nIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlYWQgdW5tYW5hZ2VkIGZpZWxkcyBmcm9t\nIHRoZSBzdHJlYW0gKHBjUmVhZFVubWFuYWdlZCkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRSZWFkVW5tYW5hZ2VkKENvbGxlY3Rpb24gdW5tZ2Qs\nIGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIGluYXJncyA9\nIG5ldyBDbGFzc1tdeyBPYmplY3RJbnB1dC5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGggPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVhZFVu\nbWFuYWdlZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgIGluYXJncyk7CiAg\nICAgICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9u\ncyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAg\nZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFzc05vdEZvdW5kRXhjZXB0aW9u\nLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRoLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRVbm1hbmFnZWQgKGluKTsKICAg\nICAgICBpZiAocGFyZW50RGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAg\nICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiUmVh\nZFVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAogICAgICAgICAgICAgICAgaW5h\ncmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgZGVjbGFyZWQgdW5t\nYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZp\nZWxkOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAo\nQkNGaWVsZCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgcmVhZEV4dGVybmFs\nKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwgZmllbGQuZ2V0VHlwZSgpLCBudWxs\nKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIHJlYWQgYSBmaWVsZCBmcm9tIGFuIGV4dGVybmFsaXphdGlv\nbiBpbnB1dCBzdHJlYW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWFk\nRXh0ZXJuYWwoQ29kZSBjb2RlLCBTdHJpbmcgZmllbGROYW1lLCBDbGFzcyB0\neXBlLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRo\nTmFtZTsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKSB7CiAgICAg\nICAgICAgIG1ldGhOYW1lID0gdHlwZS5nZXROYW1lKCk7CiAgICAgICAgICAg\nIG1ldGhOYW1lID0gQ2hhcmFjdGVyLnRvVXBwZXJDYXNlKG1ldGhOYW1lLmNo\nYXJBdCgwKSkKICAgICAgICAgICAgICAgICsgbWV0aE5hbWUuc3Vic3RyaW5n\nKDEpOwogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFkIiArIG1ldGhOYW1l\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFk\nT2JqZWN0IjsKCiAgICAgICAgLy8gPGZpZWxkPiA9IGluLnJlYWQ8dHlwZT4g\nKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIENs\nYXNzIHJldCA9ICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVj\ndC5jbGFzczsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1l\ndGhvZChPYmplY3RJbnB1dC5jbGFzcywgbWV0aE5hbWUsCiAgICAgICAgICAg\nIHJldCwgbnVsbCk7CiAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkg\nJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAoZm1kID09IG51\nbGwpCiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZpZWxkTmFt\nZSwgdHlwZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFkZFNldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgc3dpdGNo\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAg\nICAgICAgICAgICAgICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgLy8gICBzbS5wcm94eURldGFjaGVkRGVzZXJpYWxpemVkICg8\naW5kZXg+KTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAg\nICAgICAgSWZJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAg\nICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nU01UWVBFLAogICAgICAgICAgICAgICAgICAgICAgICAicHJveHlEZXRhY2hl\nZERlc2VyaWFsaXplZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAg\nICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGN1\nc3RvbSB3cml0ZUV4dGVybmFsIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGFkZFdyaXRlRXh0ZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hh\nYmxlLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1td\nIG91dGFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0LmNsYXNzIH07\nCiAgICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3\ncml0ZUV4dGVybmFsIiwgdm9pZC5jbGFzcywgb3V0YXJncyk7CiAgICAgICAg\nRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7\nCiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFz\ncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoK\nICAgICAgICAvLyBzdXBlci53cml0ZUV4dGVybmFsIChvdXQpOwogICAgICAg\nIENsYXNzIHN1cCA9IGdldFR5cGUoX21ldGEpLmdldFN1cGVyY2xhc3MoKTsK\nICAgICAgICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFi\nbGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJ3cml0ZUV4dGVybmFs\nIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gd3JpdGVVbm1hbmFnZWQgKG91dCk7CiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhKSwKICAgICAgICAg\nICAgUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgb3V0YXJn\ncyk7CgogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBnbzIgPSBudWxsOwogICAg\nICAgIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIGlmIChz\nbSAhPSBudWxsKQogICAgICAgICAgICAvLyAgIGlmIChzbS53cml0ZURldGFj\naGVkIChvdXQpKQogICAgICAgICAgICAvLyAgICAgIHJldHVybjsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICAgICAgSWZJbnN0cnVjdGlvbiBpZm51bGwgPSBjb2RlLmlmbnVs\nbCgpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0\naG9kKFNNVFlQRSwgIndyaXRlRGV0YWNoZWQiLAogICAgICAgICAgICAgICAg\nYm9vbGVhbi5jbGFzcywgb3V0YXJncyk7CiAgICAgICAgICAgIGdvMiA9IGNv\nZGUuaWZlcSgpOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAg\nICAgICAgIC8vIGVsc2UKICAgICAgICAgICAgLy8gICBvdXQud3JpdGVPYmpl\nY3QgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSk7CiAgICAgICAgICAgIENsYXNz\nW10gb2JqYXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfTsKICAg\nICAgICAgICAgaWZudWxsLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0\nTWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAg\nICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywK\nICAgICAgICAgICAgICAgICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9i\namFyZ3MpOwogICAgICAgICAgICAvLyAgICBvdXQud3JpdGVPYmplY3QgKG51\nbGwpIC8vIFN0YXRlTWFuYWdlcgogICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZSgoT2JqZWN0KSBudWxsKTsKICAgICAgICAgICAgY29kZS5pbnZva2Vp\nbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNzLAogICAg\nICAgICAgICAgICAgIndyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgb2JqYXJn\ncyk7CiAgICAgICAgfQogICAgICAgIGlmIChnbzIgIT0gbnVsbCkKICAgICAg\nICAgICAgZ28yLnNldFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgLy8g\nd3JpdGUgbWFuYWdlZCBmaWVsZHMKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICB3cml0ZUV4\ndGVybmFsKGNvZGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAg\nICAgICAgIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoK\nICAgICAgICAvLyByZXR1cm4KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdy\naXRlIHVubWFuYWdlZCBmaWVsZHMgdG8gdGhlIHN0cmVhbSAocGNXcml0ZVVu\nbWFuYWdlZCkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZVVu\nbWFuYWdlZChDb2xsZWN0aW9uIHVubWdkLCBib29sZWFuIHBhcmVudERldGFj\naGFibGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgQ2xhc3NbXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVj\ndE91dHB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICBvdXRhcmdzKTsKICAgICAgICBtZXRoLm1ha2VQ\ncm90ZWN0ZWQoKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGgu\nZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0\naW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRoLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlVW5t\nYW5hZ2VkIChvdXQpOwogICAgICAgIGlmIChwYXJlbnREZXRhY2hhYmxlKSB7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBl\nKF9tZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSksIFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAog\nICAgICAgICAgICAgICAgb3V0YXJncyk7CiAgICAgICAgfQoKICAgICAgICAv\nLyB3cml0ZSBkZWNsYXJlZCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxk\ncwogICAgICAgIEJDRmllbGQgZmllbGQ7CiAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSB1bm1nZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICBmaWVsZCA9IChCQ0ZpZWxkKSBpdHIubmV4dCgpOwogICAg\nICAgICAgICB3cml0ZUV4dGVybmFsKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwg\nZmllbGQuZ2V0VHlwZSgpLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgY29k\nZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHdyaXRlIGEgZmllbGQg\ndG8gYW4gZXh0ZXJuYWxpemF0aW9uIG91dHB1dCBzdHJlYW0uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCB3cml0ZUV4dGVybmFsKENvZGUgY29kZSwgU3Ry\naW5nIGZpZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWU7CiAgICAgICAgaWYgKHR5cGUu\naXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBtZXRoTmFtZSA9IHR5cGUu\nZ2V0TmFtZSgpOwogICAgICAgICAgICBtZXRoTmFtZSA9IENoYXJhY3Rlci50\nb1VwcGVyQ2FzZShtZXRoTmFtZS5jaGFyQXQoMCkpCiAgICAgICAgICAgICAg\nICArIG1ldGhOYW1lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgbWV0aE5h\nbWUgPSAid3JpdGUiICsgbWV0aE5hbWU7CiAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgIG1ldGhOYW1lID0gIndyaXRlT2JqZWN0IjsKCiAgICAgICAgLy8g\nb3V0LndyaXRlPHR5cGU+ICg8ZmllbGQ+KTsKICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAg\nICAgICBnZXRmaWVsZChjb2RlLCBudWxsLCBmaWVsZE5hbWUpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWQpOwogICAgICAgIENsYXNzW10gYXJncyA9IG5ldyBDbGFzc1tdeyB0\neXBlIH07CiAgICAgICAgaWYgKHR5cGUgPT0gYnl0ZS5jbGFzcyB8fCB0eXBl\nID09IGNoYXIuY2xhc3MgfHwgdHlwZSA9PSBzaG9ydC5jbGFzcykKICAgICAg\nICAgICAgYXJnc1swXSA9IGludC5jbGFzczsKICAgICAgICBlbHNlIGlmICgh\ndHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICBhcmdzWzBdID0gT2Jq\nZWN0LmNsYXNzOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywgbWV0aE5hbWUsCiAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIGFyZ3MpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRh\nRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlv\nbiB7CiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQs\nIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZmllbGQg\ndmFsdWUgc3BlY2lmaWVkIGJ5IDxjb2RlPmZtZDwvY29kZT4gb250byB0aGUg\nc3RhY2suCiAgICAgKiBCZWZvcmUgdGhpcyBtZXRob2QgaXMgY2FsbGVkLCB0\naGUgb2JqZWN0IHRoYXQgdGhlIGRhdGEgc2hvdWxkIGJlIGxvYWRlZAogICAg\nICogZnJvbSB3aWxsIGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrLgogICAg\nICoKICAgICAqIEBwYXJhbSBmcm9tU2FtZUNsYXNzIGlmIDxjb2RlPnRydWU8\nL2NvZGU+LCB0aGVuIDxjb2RlPmZtZDwvY29kZT4gaXMKICAgICAqIGJlaW5n\nIGxvYWRlZCBmcm9tIGFuIGluc3RhbmNlIG9mIHRoZSBzYW1lIGNsYXNzIGFz\nIHRoZSBjdXJyZW50IGV4ZWN1dGlvbgogICAgICogY29udGV4dC4gSWYgPGNv\nZGU+ZmFsc2U8L2NvZGU+LCB0aGVuIHRoZSBpbnN0YW5jZSBvbiB0aGUgdG9w\nIG9mIHRoZSBzdGFjawogICAgICogbWlnaHQgYmUgYSBzdXBlcmNsYXNzIG9m\nIHRoZSBjdXJyZW50IGV4ZWN1dGlvbiBjb250ZXh0J3MgJ3RoaXMnIGluc3Rh\nbmNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZh\nbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAg\nIGJvb2xlYW4gZnJvbVNhbWVDbGFzcykKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiByZWRlZmluaW5nLCB0\naGVuIHdlIG11c3QgYWx3YXlzIHJlZmxlY3QgKG9yIGFjY2VzcyB0aGUgZmll\nbGQKICAgICAgICAvLyBkaXJlY3RseSBpZiBhY2Nlc3NpYmxlKSwgc2luY2Ug\ndGhlIHJlZGVmaW5lZCBtZXRob2RzIHdpbGwgYWx3YXlzCiAgICAgICAgLy8g\ndHJpZ2dlciBtZXRob2QgY2FsbHMgdG8gU3RhdGVNYW5hZ2VyLCBldmVuIGZy\nb20gaW50ZXJuYWwgZGlyZWN0LQogICAgICAgIC8vIGFjY2VzcyB1c2FnZS4g\nV2UgY291bGQgd29yayBhcm91bmQgdGhpcyBieSBub3QgcmVkZWZpbmluZywg\nYW5kCiAgICAgICAgLy8ganVzdCBkbyBhIHN1YmNsYXNzIGFwcHJvYWNoIGlu\nc3RlYWQuIEJ1dCB0aGlzIGlzIG5vdCBhIGdvb2Qgb3B0aW9uLAogICAgICAg\nIC8vIHNpbmNlIGl0IHdvdWxkIHNhY3JpZmljZSBsYXp5IGxvYWRpbmcgYW5k\nIGVmZmljaWVudCBkaXJ0eSB0cmFja2luZy4KCiAgICAgICAgaWYgKGdldFJl\nZGVmaW5lKCkKICAgICAgICAgICAgfHwgX21ldGEuZ2V0QWNjZXNzVHlwZSgp\nID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAg\nIGdldGZpZWxkKGNvZGUsIG51bGwsIGZtZC5nZXROYW1lKCkpOwogICAgICAg\nIH0gZWxzZSBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAg\nICAvLyBwcm9wZXJ0eSBhY2Nlc3MsIGFuZCB3ZSdyZSBub3QgcmVkZWZpbmlu\nZy4gSWYgd2UncmUgb3BlcmF0aW5nCiAgICAgICAgICAgIC8vIG9uIGFuIGlu\nc3RhbmNlIHRoYXQgaXMgZGVmaW5pdGVseSB0aGUgc2FtZSB0eXBlIGFzICd0\naGlzJywgdGhlbgogICAgICAgICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0\naG9kIHRvIGJ5cGFzcyB0cmFja2luZy4gT3RoZXJ3aXNlLCByZWZsZWN0CiAg\nICAgICAgICAgIC8vIHRvIGJvdGggYnlwYXNzIHRyYWNraW5nIGFuZCBhdm9p\nZCBjbGFzcyB2ZXJpZmljYXRpb24gZXJyb3JzLgogICAgICAgICAgICBpZiAo\nZnJvbVNhbWVDbGFzcykgewogICAgICAgICAgICAgICAgTWV0aG9kIG1ldGgg\nPSAoTWV0aG9kKSBmbWQuZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKG1ldGgpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ2V0ZmllbGQo\nY29kZSwgbnVsbCwgZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyByZWd1bGFyIGVuaGFuY2Vt\nZW50ICsgcHJvcGVydHkgYWNjZXNzCiAgICAgICAgICAgIE1ldGhvZCBtZXRo\nID0gKE1ldGhvZCkgZm1kLmdldEJhY2tpbmdNZW1iZXIoKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArIG1ldGgu\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBl\nKCksIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIHZhbHVlIGF0IHRoZSB0b3Ag\nb2YgdGhlIHN0YWNrIGludG8gdGhlIGZpZWxkIHZhbHVlIHNwZWNpZmllZAog\nICAgICogYnkgPGNvZGU+Zm1kPC9jb2RlPi4gQmVmb3JlIHRoaXMgbWV0aG9k\nIGlzIGNhbGxlZCwgdGhlIGRhdGEgdG8gbG9hZCB3aWxsCiAgICAgKiBiZSBv\nbiB0aGUgdG9wIG9mIHRoZSBzdGFjayBhbmQgdGhlIG9iamVjdCB0aGF0IHRo\nZSBkYXRhIHNob3VsZCBiZSBsb2FkZWQKICAgICAqIGludG8gd2lsbCBiZSBz\nZWNvbmQgaW4gdGhlIHN0YWNrLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkU2V0TWFuYWdlZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZpZWxkTWV0YURh\ndGEgZm1kKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIGlmIHJlZGVmaW5pbmcsIHRoZW4gd2UgbXVzdCBhbHdh\neXMgcmVmbGVjdCAob3IgYWNjZXNzIHRoZSBmaWVsZAogICAgICAgIC8vIGRp\ncmVjdGx5IGlmIGFjY2Vzc2libGUpLCBzaW5jZSB0aGUgcmVkZWZpbmVkIG1l\ndGhvZHMgd2lsbCBhbHdheXMKICAgICAgICAvLyB0cmlnZ2VyIG1ldGhvZCBj\nYWxscyB0byBTdGF0ZU1hbmFnZXIsIGV2ZW4gZnJvbSBpbnRlcm5hbCBkaXJl\nY3QtCiAgICAgICAgLy8gYWNjZXNzIHVzYWdlLiBXZSBjb3VsZCB3b3JrIGFy\nb3VuZCB0aGlzIGJ5IG5vdCByZWRlZmluaW5nLCBhbmQKICAgICAgICAvLyBq\ndXN0IGRvIGEgc3ViY2xhc3MgYXBwcm9hY2ggaW5zdGVhZC4gQnV0IHRoaXMg\naXMgbm90IGEgZ29vZCBvcHRpb24sCiAgICAgICAgLy8gc2luY2UgaXQgd291\nbGQgc2FjcmlmaWNlIGxhenkgbG9hZGluZyBhbmQgZWZmaWNpZW50IGRpcnR5\nIHRyYWNraW5nLgoKICAgICAgICBpZiAoZ2V0UmVkZWZpbmUoKQogICAgICAg\nICAgICB8fCBfbWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0\nYS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAgICAgcHV0ZmllbGQoY29kZSwg\nbnVsbCwgZm1kLmdldE5hbWUoKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpKTsK\nICAgICAgICB9IGVsc2UgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAg\nICAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNzLCBhbmQgd2UncmUgbm90IHJl\nZGVmaW5pbmcuIGludm9rZSB0aGUKICAgICAgICAgICAgLy8gc3VwZXJjbGFz\ncyBtZXRob2QgdG8gYnlwYXNzIHRyYWNraW5nLgogICAgICAgICAgICBjb2Rl\nLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdldFR5\ncGUoKSwKICAgICAgICAgICAgICAgIGdldFNldHRlck5hbWUoZm1kKSwgdm9p\nZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgZm1kLmdl\ndERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIC8vIHJlZ3VsYXIgZW5oYW5jZW1lbnQgKyBwcm9wZXJ0eSBhY2Nlc3MK\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBS\nRSArIGdldFNldHRlck5hbWUoZm1kKSwKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdIHsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0p\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nb2Zmc2V0IHRoYXQgdGhlIGZpcnN0IG1lYW5pbmdmdWwgYWNjZXNzb3IgcGFy\nYW1ldGVyIGlzIGF0LgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRBY2Nl\nc3NvclBhcmFtZXRlck9mZnNldCgpIHsKICAgICAgICByZXR1cm4gKF9tZXRh\nLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVM\nRCkgPyAxIDogMDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUge0Bs\naW5rIEluc3RydWN0aW9ufXMgdG8gbG9hZCB0aGUgaW5zdGFuY2UgdG8gbW9k\naWZ5IG9udG8gdGhlCiAgICAgKiBzdGFjaywgYW5kIHJldHVybiBpdC4gSWYg\nPGNvZGU+Zm9yU3RhdGljPC9jb2RlPiBpcyBzZXQsIHRoZW4KICAgICAqIDxj\nb2RlPmNvZGU8L2NvZGU+IGlzIGluIGFuIGFjY2Vzc29yIG1ldGhvZCBvciBh\nbm90aGVyIHN0YXRpYyBtZXRob2Q7CiAgICAgKiBvdGhlcndpc2UsIGl0IGlz\nIGluIG9uZSBvZiB0aGUgUEMtc3BlY2lmaWVkIG1ldGhvZHMuCiAgICAgKgog\nICAgICogQHJldHVybiB0aGUgZmlyc3QgaW5zdHJ1Y3Rpb24gYWRkZWQgdG8g\nPGNvZGU+Y29kZTwvY29kZT4uCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1\nY3Rpb24gbG9hZE1hbmFnZWRJbnN0YW5jZShDb2RlIGNvZGUsIGJvb2xlYW4g\nZm9yU3RhdGljKSB7CiAgICAgICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19GSUVMRCAmJiBmb3JTdGF0aWMp\nCiAgICAgICAgICAgIHJldHVybiBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgcmV0dXJuIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgdGhlIGdlbmVyYXRlZCBnZXR0ZXIg\ne0BsaW5rIEJDTWV0aG9kfSBmb3IgPGNvZGU+Zm1kPC9jb2RlPi4gVGhlCiAg\nICAgKiBjYWxsaW5nIGVudmlyb25tZW50IHdpbGwgdGhlbiBwb3B1bGF0ZSB0\naGlzIG1ldGhvZCdzIGNvZGUgYmxvY2suCiAgICAgKi8KICAgIHByaXZhdGUg\nQkNNZXRob2QgY3JlYXRlR2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgQkNNZXRob2QgZ2V0dGVyOwogICAgICAgIGlmIChfbWV0YS5n\nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQp\nIHsKICAgICAgICAgICAgLy8gc3RhdGljIDxmaWVsZHR5cGU+IHBjR2V0PGZp\nZWxkPiAoWFhYIGluc3QpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBf\ncGMuZ2V0RGVjbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgZ2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldCIgKyBm\nbWQuZ2V0TmFtZSgpLCBmbWQuCiAgICAgICAgICAgICAgICBnZXREZWNsYXJl\nZFR5cGUoKS5nZXROYW1lKCksIG5ldyBTdHJpbmdbXXsgX3BjLmdldE5hbWUo\nKSB9KTsKICAgICAgICAgICAgZ2V0dGVyLnNldEFjY2Vzc0ZsYWdzKGZpZWxk\nLmdldEFjY2Vzc0ZsYWdzKCkKICAgICAgICAgICAgICAgICYgfkNvbnN0YW50\ncy5BQ0NFU1NfVFJBTlNJRU5UICYgfkNvbnN0YW50cy5BQ0NFU1NfVk9MQVRJ\nTEUpOwogICAgICAgICAgICBnZXR0ZXIuc2V0U3RhdGljKHRydWUpOwogICAg\nICAgICAgICBnZXR0ZXIuc2V0RmluYWwodHJ1ZSk7CiAgICAgICAgICAgIHJl\ndHVybiBnZXR0ZXI7CiAgICAgICAgfQoKICAgICAgICAvLyBwcm9wZXJ0eSBh\nY2Nlc3M6CiAgICAgICAgLy8gY29weSB0aGUgdXNlcidzIGdldHRlciBtZXRo\nb2QgdG8gYSBuZXcgbmFtZTsgd2UgY2FuJ3QganVzdCByZXNldAogICAgICAg\nIC8vIHRoZSBuYW1lLCBiZWNhdXNlIHRoYXQgd2lsbCBhbHNvIHJlc2V0IGFs\nbCBjYWxscyB0byB0aGUgbWV0aG9kCiAgICAgICAgTWV0aG9kIG1ldGggPSAo\nTWV0aG9kKSBmbWQuZ2V0QmFja2luZ01lbWJlcigpOwogICAgICAgIGdldHRl\nciA9IF9wYy5nZXREZWNsYXJlZE1ldGhvZChtZXRoLmdldE5hbWUoKSwKICAg\nICAgICAgICAgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBC\nQ01ldGhvZCBuZXdnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyBt\nZXRoLmdldE5hbWUoKSwKICAgICAgICAgICAgbWV0aC5nZXRSZXR1cm5UeXBl\nKCksIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMoKSk7CiAgICAgICAgbmV3Z2V0\ndGVyLnNldEFjY2Vzc0ZsYWdzKGdldHRlci5nZXRBY2Nlc3NGbGFncygpKTsK\nICAgICAgICBuZXdnZXR0ZXIubWFrZVByb3RlY3RlZCgpOyAKICAgICAgICB0\ncmFuc2ZlckNvZGVBdHRyaWJ1dGVzKGdldHRlciwgbmV3Z2V0dGVyKTsKICAg\nICAgICByZXR1cm4gZ2V0dGVyOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIHRoZSBnZW5lcmF0ZWQgc2V0dGVyIHtAbGluayBCQ01ldGhvZH0gZm9y\nIDxjb2RlPmZtZDwvY29kZT4uIFRoZQogICAgICogY2FsbGluZyBlbnZpcm9u\nbWVudCB3aWxsIHRoZW4gcG9wdWxhdGUgdGhpcyBtZXRob2QncyBjb2RlIGJs\nb2NrLgogICAgICovCiAgICBwcml2YXRlIEJDTWV0aG9kIGNyZWF0ZVNldE1l\ndGhvZChGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIEJDTWV0aG9kIHNl\ndHRlcjsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENs\nYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgIC8vIHN0\nYXRpYyB2b2lkIHBjU2V0PGZpZWxkPiAoWFhYIGluc3QsIDxmaWVsZHR5cGU+\nIHZhbHVlKQogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmdldERl\nY2xhcmVkRmllbGQoZm1kLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHNldHRl\nciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXQiICsgZm1kLmdldE5h\nbWUoKSwgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1td\neyBnZXRUeXBlKF9tZXRhKSwgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwog\nICAgICAgICAgICBzZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNj\nZXNzRmxhZ3MoKQogICAgICAgICAgICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VT\nU19UUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAg\nICAgICAgICAgIHNldHRlci5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAg\nIHNldHRlci5zZXRGaW5hbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHNl\ndHRlcjsKICAgICAgICB9CgogICAgICAgIC8vIHByb3BlcnR5IGFjY2VzczoK\nICAgICAgICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBh\nIG5ldyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0CiAgICAgICAgLy8gdGhl\nIG5hbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28gcmVzZXQgYWxsIGNhbGxz\nIHRvIHRoZSBtZXRob2QKICAgICAgICBzZXR0ZXIgPSBfcGMuZ2V0RGVjbGFy\nZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAgICBuZXcg\nQ2xhc3NbXXsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIEJD\nTWV0aG9kIG5ld3NldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArIHNl\ndHRlci5nZXROYW1lKCksCiAgICAgICAgICAgIHNldHRlci5nZXRSZXR1cm5O\nYW1lKCksIHNldHRlci5nZXRQYXJhbU5hbWVzKCkpOwogICAgICAgIG5ld3Nl\ndHRlci5zZXRBY2Nlc3NGbGFncyhzZXR0ZXIuZ2V0QWNjZXNzRmxhZ3MoKSk7\nCiAgICAgICAgbmV3c2V0dGVyLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICB0\ncmFuc2ZlckNvZGVBdHRyaWJ1dGVzKHNldHRlciwgbmV3c2V0dGVyKTsKICAg\nICAgICByZXR1cm4gc2V0dGVyOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBh\nZGRHZXRFbmhhbmNlbWVudENvbnRyYWN0VmVyc2lvbk1ldGhvZCgpIHsKICAg\nICAgICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJz\naW9uKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAKICAgICAgICAgICAgICAgICJHZXRFbmhhbmNlbWVudENv\nbnRyYWN0VmVyc2lvbiIsIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0\naG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoRU5IQU5DRVJfVkVSU0lPTik7CiAgICAgICAgY29kZS5pcmV0dXJuKCk7\nCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGNvbmNyZXRlIHR5cGUgZm9yIHRoZSBnaXZlbiBjbGFz\ncywgaS5lLiBpbXBsIGZvciBtYW5hZ2VkCiAgICAgKiBpbnRlcmZhY2VzCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXRUeXBlKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldEludGVyZmFjZUltcGwoKSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CiAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogTW92ZSBjb2RlLXJlbGF0ZWQgYXR0\ncmlidXRlcyBmcm9tIG9uZSBtZXRob2QgdG8gYW5vdGhlci4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCB0cmFuc2ZlckNvZGVBdHRyaWJ1dGVz\nKEJDTWV0aG9kIGZyb20sIEJDTWV0aG9kIHRvKSB7CiAgICAgICAgQ29kZSBj\nb2RlID0gZnJvbS5nZXRDb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShjb2RlKTsK\nICAgICAgICAgICAgZnJvbS5yZW1vdmVDb2RlKCk7CiAgICAgICAgfQoKICAg\nICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IGZyb20uZ2V0RXhjZXB0aW9ucyhm\nYWxzZSk7CiAgICAgICAgaWYgKGV4Y2VwcyAhPSBudWxsKQogICAgICAgICAg\nICB0by5hZGRBdHRyaWJ1dGUoZXhjZXBzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFVzYWdlOiBqYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBD\nRW5oYW5jZXIgW29wdGlvbl0qCiAgICAgKiAmbHQ7Y2xhc3MgbmFtZSB8IC5q\nYXZhIGZpbGUgfCAuY2xhc3MgZmlsZSB8IC5qZG8gZmlsZSZndDsrCiAgICAg\nKiAgV2hlcmUgdGhlIGZvbGxvd2luZyBvcHRpb25zIGFyZSByZWNvZ25pemVk\nLgogICAgICogPHVsPgogICAgICogPGxpPjxpPi1wcm9wZXJ0aWVzLy1wICZs\ndDtwcm9wZXJ0aWVzIGZpbGUmZ3Q7PC9pPjogVGhlIHBhdGggdG8gYSBPcGVu\nSlBBCiAgICAgKiBwcm9wZXJ0aWVzIGZpbGUgY29udGFpbmluZyBpbmZvcm1h\ndGlvbiBhcyBvdXRsaW5lZCBpbgogICAgICoge0BsaW5rIENvbmZpZ3VyYXRp\nb259OyBvcHRpb25hbC48L2xpPgogICAgICogPGxpPjxpPi0mbHQ7cHJvcGVy\ndHkgbmFtZSZndDsgJmx0O3Byb3BlcnR5IHZhbHVlJmd0OzwvaT46IEFsbCBi\nZWFuCiAgICAgKiBwcm9wZXJ0aWVzIG9mIHRoZSBzdGFuZGFyZCBPcGVuSlBB\nIHtAbGluayBPcGVuSlBBQ29uZmlndXJhdGlvbn0gY2FuIGJlCiAgICAgKiBz\nZXQgYnkgdXNpbmcgdGhlaXIgbmFtZXMgYW5kIHN1cHBseWluZyBhIHZhbHVl\nOyBmb3IgZXhhbXBsZToKICAgICAqIDxsaT48aT4tZGlyZWN0b3J5Ly1kICZs\ndDtidWlsZCBkaXJlY3RvcnkmZ3Q7PC9pPjogVGhlIHBhdGggdG8gdGhlIGJh\nc2UKICAgICAqIGRpcmVjdG9yeSB3aGVyZSBlbmhhbmNlZCBjbGFzc2VzIGFy\nZSBzdG9yZWQuIEJ5IGRlZmF1bHQsIHRoZQogICAgICogZW5oYW5jZXIgb3Zl\ncndyaXRlcyB0aGUgb3JpZ2luYWwgLmNsYXNzIGZpbGUgd2l0aCB0aGUgZW5o\nYW5jZWQKICAgICAqIHZlcnNpb24uIFVzZSB0aGlzIG9wdGlvbiB0byBzdG9y\nZSB0aGUgZ2VuZXJhdGVkIC5jbGFzcyBmaWxlIGluCiAgICAgKiBhbm90aGVy\nIGRpcmVjdG9yeS4gVGhlIHBhY2thZ2Ugc3RydWN0dXJlIHdpbGwgYmUgY3Jl\nYXRlZCBiZW5lYXRoCiAgICAgKiB0aGUgZ2l2ZW4gZGlyZWN0b3J5LjwvbGk+\nCiAgICAgKiA8bGk+PGk+LWFkZERlZmF1bHRDb25zdHJ1Y3Rvci8tYWRjIFt0\ncnVlL3QgfCBmYWxzZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGFkZCBh\nIGRlZmF1bHQgY29uc3RydWN0b3IgdG8gcGVyc2lzdGVudCBjbGFzc2VzIG1p\nc3Npbmcgb25lLCBhcwogICAgICogb3Bwb3NlZCB0byB0aHJvd2luZyBhbiBl\neGNlcHRpb24uIERlZmF1bHRzIHRvIHRydWUuPC9saT4KICAgICAqIDxsaT48\naT4tdG1wQ2xhc3NMb2FkZXIvLXRjbCBbdHJ1ZS90IHwgZmFsc2UvZl08L2k+\nOiBXaGV0aGVyIHRvCiAgICAgKiBsb2FkIHRoZSBwcmUtZW5oYW5jZWQgY2xh\nc3NlcyB1c2luZyBhIHRlbXBvcmFyeSBjbGFzcyBsb2FkZXIuCiAgICAgKiBE\nZWZhdWx0cyB0byB0cnVlLiBTZXQgdGhpcyB0byBmYWxzZSB3aGVuIGF0dGVt\ncHRpbmcgdG8gZGVidWcKICAgICAqIGNsYXNzIGxvYWRpbmcgZXJyb3JzLjwv\nbGk+CiAgICAgKiA8bGk+PGk+LWVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9u\ncy8tZXByIFt0cnVlL3QgfCBmYWxzZS9mXTwvaT46CiAgICAgKiBXaGV0aGVy\nIHRvIHRocm93IGFuIGV4Y2VwdGlvbiBpZiBhIFBST1BFUlRZIGFjY2VzcyBl\nbnRpdHkgYXBwZWFycwogICAgICogdG8gYmUgdmlvbGF0aW5nIHN0YW5kYXJk\nIHByb3BlcnR5IHJlc3RyaWN0aW9ucy4gRGVmYXVsdHMgdG8gZmFsc2UuPC9s\naT4KICAgICAqIDwvdWw+CiAgICAgKiAgRWFjaCBhZGRpdGlvbmFsIGFyZ3Vt\nZW50IGNhbiBiZSBlaXRoZXIgdGhlIGZ1bGwgY2xhc3MgbmFtZSBvZiB0aGUK\nICAgICAqIHR5cGUgdG8gZW5oYW5jZSwgdGhlIHBhdGggdG8gdGhlIC5qYXZh\nIGZpbGUgZm9yIHRoZSB0eXBlLCB0aGUgcGF0aCB0bwogICAgICogdGhlIC5j\nbGFzcyBmaWxlIGZvciB0aGUgdHlwZSwgb3IgdGhlIHBhdGggdG8gYSAuamRv\nIGZpbGUgbGlzdGluZyBvbmUKICAgICAqIG9yIG1vcmUgdHlwZXMgdG8gZW5o\nYW5jZS4KICAgICAqIElmIHRoZSB0eXBlIGJlaW5nIGVuaGFuY2VkIGhhcyBt\nZXRhZGF0YSwgaXQgd2lsbCBiZSBlbmhhbmNlZCBhcyBhCiAgICAgKiBwZXJz\naXN0ZW5jZSBjYXBhYmxlIGNsYXNzLiBJZiBub3QsIGl0IHdpbGwgYmUgY29u\nc2lkZXJlZCBhIHBlcnNpc3RlbmNlCiAgICAgKiBhd2FyZSBjbGFzcywgYW5k\nIGFsbCBhY2Nlc3MgdG8gZmllbGRzIG9mIHBlcnNpc3RlbmNlIGNhcGFibGUg\nY2xhc3NlcwogICAgICogd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYXBwcm9w\ncmlhdGUJZ2V0L3NldCBtZXRob2QuIElmIHRoZSB0eXBlCiAgICAgKiBleHBs\naWNpdGx5IGRlY2xhcmVzIHRoZSBwZXJzaXN0ZW5jZS1jYXBhYmxlIGludGVy\nZmFjZSwgaXQgd2lsbAogICAgICogbm90IGJlIGVuaGFuY2VkLiBUaHVzLCBp\ndCBpcyBzYWZlIHRvIGludm9rZSB0aGUgZW5oYW5jZXIgb24gY2xhc3Nlcwog\nICAgICogdGhhdCBhcmUgYWxyZWFkeSBlbmhhbmNlZC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykKICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIE9wdGlvbnMgb3B0cyA9\nIG5ldyBPcHRpb25zKCk7CiAgICAgICAgYXJncyA9IG9wdHMuc2V0RnJvbUNt\nZExpbmUoYXJncyk7CiAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29u\nZiA9IG5ldyBPcGVuSlBBQ29uZmlndXJhdGlvbkltcGwoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoIXJ1bihjb25mLCBhcmdzLCBvcHRzKSkK\nICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbihfbG9jLmdldCgi\nZW5oYW5jZS11c2FnZSIpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBjb25mLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUnVuIHRoZSB0b29sLiBSZXR1cm5zIGZhbHNlIGlmIGludmFsaWQg\nb3B0aW9ucyBnaXZlbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29s\nZWFuIHJ1bihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBh\ncmdzLAogICAgICAgIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGlmIChvcHRzLmNvbnRhaW5zS2V5KCJoZWxw\nIikgfHwgb3B0cy5jb250YWluc0tleSgiLWhlbHAiKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICBGbGFncyBmbGFncyA9IG5ldyBGbGFn\ncygpOwogICAgICAgIGZsYWdzLmRpcmVjdG9yeSA9IEZpbGVzLmdldEZpbGUo\nb3B0cy5yZW1vdmVQcm9wZXJ0eSgiZGlyZWN0b3J5IiwgImQiLAogICAgICAg\nICAgICBudWxsKSwgbnVsbCk7CiAgICAgICAgZmxhZ3MuYWRkRGVmYXVsdENv\nbnN0cnVjdG9yID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAg\nICAgICAgKCJhZGREZWZhdWx0Q29uc3RydWN0b3IiLCAiYWRjIiwgZmxhZ3Mu\nYWRkRGVmYXVsdENvbnN0cnVjdG9yKTsKICAgICAgICBmbGFncy50bXBDbGFz\nc0xvYWRlciA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAg\nICAgICgidG1wQ2xhc3NMb2FkZXIiLCAidGNsIiwgZmxhZ3MudG1wQ2xhc3NM\nb2FkZXIpOwogICAgICAgIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0\naW9ucyA9IG9wdHMucmVtb3ZlQm9vbGVhblByb3BlcnR5CiAgICAgICAgICAg\nICgiZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zIiwgImVwciIsCiAgICAg\nICAgICAgICAgICBmbGFncy5lbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMp\nOwoKICAgICAgICBDb25maWd1cmF0aW9ucy5wb3B1bGF0ZUNvbmZpZ3VyYXRp\nb24oY29uZiwgb3B0cyk7CiAgICAgICAgcmV0dXJuIHJ1bihjb25mLCBhcmdz\nLCBmbGFncywgbnVsbCwgbnVsbCwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBFbmhhbmNlIHRoZSBnaXZlbiBjbGFzc2VzLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYsIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgRmxhZ3MgZmxhZ3MsIE1l\ndGFEYXRhUmVwb3NpdG9yeSByZXBvcywgQnl0ZWNvZGVXcml0ZXIgd3JpdGVy\nLAogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlcikKICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIGlmIChsb2FkZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgbG9hZGVyID0gY29uZi5nZXRDbGFzc1Jlc29sdmVySW5zdGFu\nY2UoKS4KICAgICAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKFBDRW5oYW5j\nZXIuY2xhc3MsIG51bGwpOwogICAgICAgIGlmIChmbGFncy50bXBDbGFzc0xv\nYWRlcikKICAgICAgICAgICAgbG9hZGVyID0gKENsYXNzTG9hZGVyKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAg\nICAgICAgICAgICAgLm5ld1RlbXBvcmFyeUNsYXNzTG9hZGVyQWN0aW9uKGxv\nYWRlcikpOwoKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkgewogICAgICAg\nICAgICByZXBvcyA9IGNvbmYubmV3TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFu\nY2UoKTsKICAgICAgICAgICAgcmVwb3Muc2V0U291cmNlTW9kZShNZXRhRGF0\nYVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsKICAgICAgICB9CgogICAgICAgIExv\nZyBsb2cgPSBjb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0df\nVE9PTCk7CiAgICAgICAgQ29sbGVjdGlvbiBjbGFzc2VzOwogICAgICAgIGlm\nIChhcmdzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJydW5uaW5nLWFsbC1jbGFzc2VzIikpOwogICAgICAgICAgICBj\nbGFzc2VzID0gcmVwb3MuZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyh0cnVlLCBs\nb2FkZXIpOwogICAgICAgICAgICBpZiAoY2xhc3NlcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIAlsb2cud2FybihfbG9jLmdldCgibm8tY2xhc3MtdG8tZW5o\nYW5jZSIpKTsKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzQXJnUGFy\nc2VyIGNhcCA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhRmFjdG9yeSgpLm5ld0Ns\nYXNzQXJnUGFyc2VyKCk7CiAgICAgICAgICAgIGNhcC5zZXRDbGFzc0xvYWRl\ncihsb2FkZXIpOwogICAgICAgICAgICBjbGFzc2VzID0gbmV3IEhhc2hTZXQo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChjYXAucGFyc2VUeXBlcyhhcmdzW2ldKSkpOwogICAgICAgIH0K\nICAgICAgICAKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVj\ndCgpOwogICAgICAgIEJDQ2xhc3MgYmM7CiAgICAgICAgUENFbmhhbmNlciBl\nbmhhbmNlcjsKICAgICAgICBpbnQgc3RhdHVzOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBPYmplY3QgbyA9IGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1ydW5uaW5nIiwgbykp\nOwoKICAgICAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAg\nICAgICAgICAgICBiYyA9IHByb2plY3QubG9hZENsYXNzKChTdHJpbmcpIG8s\nIGxvYWRlcik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJj\nID0gcHJvamVjdC5sb2FkQ2xhc3MoKENsYXNzKSBvKTsKICAgICAgICAgICAg\nZW5oYW5jZXIgPSBuZXcgUENFbmhhbmNlcihjb25mLCBiYywgcmVwb3MsIGxv\nYWRlcik7CiAgICAgICAgICAgIGlmICh3cml0ZXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGVuaGFuY2VyLnNldEJ5dGVjb2RlV3JpdGVyKHdyaXRlcik7\nCiAgICAgICAgICAgIGVuaGFuY2VyLnNldERpcmVjdG9yeShmbGFncy5kaXJl\nY3RvcnkpOwogICAgICAgICAgICBlbmhhbmNlci5zZXRBZGREZWZhdWx0Q29u\nc3RydWN0b3IoZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yKTsKICAgICAg\nICAgICAgc3RhdHVzID0gZW5oYW5jZXIucnVuKCk7CiAgICAgICAgICAgIGlm\nIChzdGF0dXMgPT0gRU5IQU5DRV9OT05FKSB7CiAgICAgICAgICAgICAgICBp\nZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLW5vcnVuIikpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0lOVEVSRkFDRSkg\newogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5j\nZS1pbnRlcmZhY2UiKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVz\nID09IEVOSEFOQ0VfQVdBUkUpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJh\nY2UoX2xvYy5nZXQoImVuaGFuY2UtYXdhcmUiKSk7CiAgICAgICAgICAgICAg\nICBlbmhhbmNlci5yZWNvcmQoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICBlbmhhbmNlci5yZWNvcmQoKTsKICAgICAgICAgICAgcHJv\namVjdC5jbGVhcigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJ1biBmbGFncy4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBjbGFzcyBGbGFncyB7CgogICAgICAgIHB1YmxpYyBG\naWxlIGRpcmVjdG9yeSA9IG51bGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4g\nYWRkRGVmYXVsdENvbnN0cnVjdG9yID0gdHJ1ZTsKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiB0bXBDbGFzc0xvYWRlciA9IHRydWU7CgkJcHVibGljIGJvb2xl\nYW4gZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zID0gZmFsc2U7Cgl9CgoJ\nLyoqCiAJICogUGx1Z2luIGludGVyZmFjZSBmb3IgYWRkaXRpb25hbCBlbmhh\nbmNlbWVudC4KCSAqLwoJcHVibGljIHN0YXRpYyBpbnRlcmZhY2UgQXV4aWxp\nYXJ5RW5oYW5jZXIKCXsKCQlwdWJsaWMgdm9pZCBydW4gKEJDQ2xhc3MgYmMs\nIENsYXNzTWV0YURhdGEgbWV0YSk7CgkJcHVibGljIGJvb2xlYW4gc2tpcEVu\naGFuY2UoQkNNZXRob2QgbSk7Cgl9Cn0K\n","encoding":"base64"}

