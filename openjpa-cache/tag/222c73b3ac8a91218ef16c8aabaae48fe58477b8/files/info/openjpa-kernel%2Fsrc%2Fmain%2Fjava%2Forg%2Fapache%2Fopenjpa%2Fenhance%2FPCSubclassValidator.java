{"sha":"aef221a3223762557d2d3c570628c63e318767b3","node_id":"MDQ6QmxvYjIwNjM2NDphZWYyMjFhMzIyMzc2MjU1N2QyZDNjNTcwNjI4YzYzZTMxODc2N2Iz","size":10773,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/aef221a3223762557d2d3c570628c63e318767b3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEu\nbGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxl\nY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxh\nbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVzZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkJDRmllbGQ7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLkJDTWV0aG9kOwoKLyoqCiAqCTxwPlZhbGlk\nYXRlcyB0aGF0IGEgZ2l2ZW4gdHlwZSBtZWV0cyB0aGUgSlBBIGNvbnRyYWN0\nLCBwbHVzIGEgZmV3CiAqICBPcGVuSlBBLXNwZWNpZmljIGFkZGl0aW9ucyBm\nb3Igc3ViY2xhc3NpbmcgLyByZWRlZmluaXRpb246CiAqCiAqCTx1bD4KICog\nCQk8bGk+bXVzdCBoYXZlIGFuIGFjY2Vzc2libGUgbm8tYXJncyBjb25zdHJ1\nY3RvcjwvbGk+CiAqIAkJPGxpPm11c3QgYmUgYSBwdWJsaWMgb3IgcHJvdGVj\ndGVkIGNsYXNzPC9saT4KICogCQk8bGk+bXVzdCBub3QgYmUgZmluYWw8L2xp\nPgogKiAJCTxsaT5tdXN0IG5vdCBleHRlbmQgYW4gZW5oYW5jZWQgY2xhc3M8\nL2xpPgogKgkJPGxpPmFsbCBwZXJzaXN0ZW50IGRhdGEgcmVwcmVzZW50ZWQg\nYnkgYWNjZXNzaWJsZSBzZXR0ZXIvZ2V0dGVyCiAqIAkJCW1ldGhvZHMgKHBl\ncnNpc3RlbnQgcHJvcGVydGllcyk8L2xpPgogKiAJCTxsaT5pZiB2ZXJzaW9u\naW5nIGlzIHRvIGJlIHVzZWQsIGV4YWN0bHkgb25lIHBlcnNpc3RlbnQgcHJv\ncGVydHkgZm9yCiAqIAkJCXRoZSBudW1lcmljIHZlcnNpb24gZGF0YTwvbGk+\nIDwhLS0gIyMjIyMgaXMgdGhpcyB0cnVlPyAtLT4KICoKICogCQk8bGk+V2hl\nbiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHRoZSBiYWNraW5nIGZpZWxkIGZv\nciBhIHBlcnNpc3RlbnQKICogICAgICAgICAgcHJvcGVydHkgbXVzdCBiZToK\nICogCQkJPHVsPgogKiAJCQkJPCEtLSAjIyMjIyBKUEEgdmFsaWRhdGlvbiBv\nZiB0aGVzZSBuZWVkcyB0byBiZSB0ZXN0ZWQgLS0+CiAqIAkJCQk8bGk+cHJp\ndmF0ZTwvbGk+CiAqIAkJCQk8bGk+c2V0IG9ubHkgaW4gdGhlIGRlc2lnbmF0\nZWQgc2V0dGVyLAogKiAJCQkJCWluIHRoZSBjb25zdHJ1Y3Rvciwgb3IgaW4g\ne0BsaW5rIE9iamVjdCNjbG9uZSgpfSwKICogCQkJCQk8Y29kZT5yZWFkT2Jq\nZWN0KE9iamVjdElucHV0U3RyZWFtKTwvY29kZT4sIG9yCiAqIAkJCQkJe0Bs\naW5rIEV4dGVybmFsaXphYmxlI3JlYWRFeHRlcm5hbChPYmplY3RJbnB1dCl9\nLjwvbGk+CiAqIAkJCQk8bGk+cmVhZCBvbmx5IGluIHRoZSBkZXNpZ25hdGVk\nIGdldHRlciBhbmQgdGhlCiAqIAkJCQkJY29uc3RydWN0b3IuPC9saT4KICoJ\nCQk8L3VsPgogKiAJCTwvbGk+CiAqIAk8L3VsPgogKgogKiAJPHA+SWYgeW91\nIHVzZSB0aGlzIHRlY2huaXF1ZSBhbmQgdXNlIHRoZSA8Y29kZT5uZXc8L2Nv\nZGU+IGtleXdvcmQgaW5zdGVhZCBvZgogKiAJYSBPcGVuSlBBLXN1cHBsaWVk\nIGNvbnN0cnVjdGlvbiByb3V0aW5lLCBPcGVuSlBBIHdpbGwgbmVlZCB0byBk\nbyBleHRyYSB3b3JrCiAqICB3aXRoIHBlcnNpc3RlbnQtbmV3LWZsdXNoZWQg\naW5zdGFuY2VzLCBzaW5jZSBPcGVuSlBBIGNhbm5vdCBpbiB0aGlzIGNhc2UK\nICogIHRyYWNrIHdoYXQgaGFwcGVucyB0byBzdWNoIGFuIGluc3RhbmNlLjwv\ncD4KICoKICogCUBzaW5jZSAxLjAuMAogKi8KcHVibGljIGNsYXNzIFBDU3Vi\nY2xhc3NWYWxpZGF0b3IgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nY2FsaXplciBsb2MgPQogICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdlKFBD\nU3ViY2xhc3NWYWxpZGF0b3IuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwg\nQ2xhc3NNZXRhRGF0YSBtZXRhOwogICAgcHJpdmF0ZSBmaW5hbCBCQ0NsYXNz\nIHBjOwogICAgcHJpdmF0ZSBmaW5hbCBMb2cgbG9nOwogICAgcHJpdmF0ZSBm\naW5hbCBib29sZWFuIGZhaWxPbkNvbnRyYWN0VmlvbGF0aW9uczsKCiAgICBw\ncml2YXRlIENvbGxlY3Rpb24gZXJyb3JzOwogICAgcHJpdmF0ZSBDb2xsZWN0\naW9uIGNvbnRyYWN0VmlvbGF0aW9uczsKCiAgICBwdWJsaWMgUENTdWJjbGFz\nc1ZhbGlkYXRvcihDbGFzc01ldGFEYXRhIG1ldGEsIEJDQ2xhc3MgYmMsIExv\nZyBsb2csCiAgICAgICAgYm9vbGVhbiBlbmZvcmNlQ29udHJhY3RWaW9sYXRp\nb25zKSB7CiAgICAgICAgdGhpcy5tZXRhID0gbWV0YTsKICAgICAgICB0aGlz\nLnBjID0gYmM7CiAgICAgICAgdGhpcy5sb2cgPSBsb2c7CiAgICAgICAgdGhp\ncy5mYWlsT25Db250cmFjdFZpb2xhdGlvbnMgPSBlbmZvcmNlQ29udHJhY3RW\naW9sYXRpb25zOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydENhblN1\nYmNsYXNzKCkgewogICAgICAgIENsYXNzIHN1cGVyY2xhc3MgPSBtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKTsKICAgICAgICBTdHJpbmcgbmFtZSA9IHN1cGVy\nY2xhc3MuZ2V0TmFtZSgpOwogICAgICAgIGlmIChzdXBlcmNsYXNzLmlzSW50\nZXJmYWNlKCkpCiAgICAgICAgICAgIGFkZEVycm9yKGxvYy5nZXQoInN1YmNs\nYXNzZXItbm8taWZhY2VzIiwgbmFtZSksIG1ldGEpOwogICAgICAgIGlmIChN\nb2RpZmllci5pc0ZpbmFsKHN1cGVyY2xhc3MuZ2V0TW9kaWZpZXJzKCkpKQog\nICAgICAgICAgICBhZGRFcnJvcihsb2MuZ2V0KCJzdWJjbGFzc2VyLW5vLWZp\nbmFsLWNsYXNzZXMiLCBuYW1lKSwgbWV0YSk7CiAgICAgICAgaWYgKE1vZGlm\naWVyLmlzUHJpdmF0ZShzdXBlcmNsYXNzLmdldE1vZGlmaWVycygpKSkKICAg\nICAgICAgICAgYWRkRXJyb3IobG9jLmdldCgic3ViY2xhc3Nlci1uby1wcml2\nYXRlLWNsYXNzZXMiLCBuYW1lKSwgbWV0YSk7CiAgICAgICAgaWYgKFBlcnNp\nc3RlbmNlQ2FwYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cGVyY2xh\nc3MpKQogICAgICAgICAgICBhZGRFcnJvcihsb2MuZ2V0KCJzdWJjbGFzc2Vy\nLXN1cGVyLWFscmVhZHktcGMiLCBuYW1lKSwgbWV0YSk7CgogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIENvbnN0cnVjdG9yIGMgPSBzdXBlcmNsYXNzLmdl\ndERlY2xhcmVkQ29uc3RydWN0b3IobmV3IENsYXNzWzBdKTsKICAgICAgICAg\nICAgaWYgKCEoTW9kaWZpZXIuaXNQcm90ZWN0ZWQoYy5nZXRNb2RpZmllcnMo\nKSkKICAgICAgICAgICAgICAgIHx8IE1vZGlmaWVyLmlzUHVibGljKGMuZ2V0\nTW9kaWZpZXJzKCkpKSkKICAgICAgICAgICAgICAgIGFkZEVycm9yKGxvYy5n\nZXQoInN1YmNsYXNzZXItcHJpdmF0ZS1jdG9yIiwgbmFtZSksIG1ldGEpOwog\nICAgICAgIH0KICAgICAgICBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgYWRkRXJyb3IobG9jLmdldCgic3ViY2xhc3Nl\nci1uby12b2lkLWN0b3IiLCBuYW1lKSwKICAgICAgICAgICAgICAgIG1ldGEp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhlIEJDQ2xhc3Mgd2UgbG9h\nZGVkIGlzIGFscmVhZHkgcGMgYW5kIHRoZSBzdXBlcmNsYXNzIGlzIG5vdCwK\nICAgICAgICAvLyB0aGVuIHdlIHNob3VsZCBuZXZlciBnZXQgaGVyZSwgc28g\nbGV0J3MgbWFrZSBzdXJlIHRoYXQgdGhlCiAgICAgICAgLy8gY2FsbGluZyBj\nb250ZXh0IGlzIGNhY2hpbmcgY29ycmVjdGx5IGJ5IHRocm93aW5nIGFuIGV4\nY2VwdGlvbi4KICAgICAgICBpZiAocGMuaXNJbnN0YW5jZU9mKFBlcnNpc3Rl\nbmNlQ2FwYWJsZS5jbGFzcykgJiYKICAgICAgICAgICAgIVBlcnNpc3RlbmNl\nQ2FwYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cGVyY2xhc3MpKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICBsb2MuZ2V0KCJzdWJjbGFzc2VyLWNsYXNzLWFscmVhZHkt\ncGMiLCBuYW1lKSk7CgogICAgICAgIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19QUk9QRVJUWSkKICAgICAgICAg\nICAgY2hlY2tQcm9wZXJ0aWVzQXJlSW50ZXJjZXB0YWJsZSgpOwoKICAgICAg\nICBpZiAoZXJyb3JzICE9IG51bGwgJiYgIWVycm9ycy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGVycm9ycy50b1N0\ncmluZygpKTsKICAgICAgICBlbHNlIGlmIChjb250cmFjdFZpb2xhdGlvbnMg\nIT0gbnVsbCAmJgogICAgICAgICAgICAhY29udHJhY3RWaW9sYXRpb25zLmlz\nRW1wdHkoKSAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBs\nb2cud2Fybihjb250cmFjdFZpb2xhdGlvbnMudG9TdHJpbmcoKSk7CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIGNoZWNrUHJvcGVydGllc0FyZUludGVyY2Vw\ndGFibGUoKSB7CiAgICAgICAgLy8ganVzdCBjb25zaWRlcnMgYWNjZXNzb3Ig\nbWV0aG9kcyBmb3Igbm93LgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgTWV0aG9kIGdl\ndHRlciA9IChNZXRob2QpIGZtZHNbaV0uZ2V0QmFja2luZ01lbWJlcigpOwog\nICAgICAgICAgICBpZiAoZ2V0dGVyID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGFkZEVycm9yKGxvYy5nZXQoInN1YmNsYXNzZXItbm8tZ2V0dGVyIiwK\nICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE5hbWUoKSksIGZtZHNb\naV0pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgQkNGaWVsZCByZXR1cm5lZEZpZWxkID0gY2hlY2tHZXR0\nZXJJc1N1YmNsYXNzYWJsZShnZXR0ZXIsIGZtZHNbaV0pOwoKICAgICAgICAg\nICAgTWV0aG9kIHNldHRlciA9IHNldHRlckZvckZpZWxkKGZtZHNbaV0pOwog\nICAgICAgICAgICBpZiAoc2V0dGVyID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGFkZEVycm9yKGxvYy5nZXQoInN1YmNsYXNzZXItbm8tc2V0dGVyIiwg\nZm1kc1tpXS5nZXROYW1lKCkpLAogICAgICAgICAgICAgICAgICAgIGZtZHNb\naV0pOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgQkNGaWVsZCBhc3NpZ25lZEZpZWxkID0gY2hlY2tTZXR0\nZXJJc1N1YmNsYXNzYWJsZShzZXR0ZXIsIGZtZHNbaV0pOwogICAgICAgICAg\nICBpZiAoYXNzaWduZWRGaWVsZCA9PSBudWxsKQogICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICBpZiAoYXNzaWduZWRGaWVsZCAhPSBy\nZXR1cm5lZEZpZWxkKQogICAgICAgICAgICAgICAgYWRkQ29udHJhY3RWaW9s\nYXRpb24obG9jLmdldAogICAgICAgICAgICAgICAgICAgICgic3ViY2xhc3Nl\nci1zZXR0ZXItZ2V0dGVyLWZpZWxkLW1pc21hdGNoIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgZm1kc1tpXS5nZXROYW1lKCksIHJldHVybmVkRmllbGQs\nYXNzaWduZWRGaWVsZCksCiAgICAgICAgICAgICAgICAgICAgZm1kc1tpXSk7\nCgogICAgICAgICAgICAvLyAjIyMgc2NhbiB0aHJvdWdoIGFsbCB0aGUgcmVz\ndCBvZiB0aGUgY2xhc3MgdG8gbWFrZSBzdXJlIGl0CiAgICAgICAgICAgIC8v\nICMjIyBkb2Vzbid0IHVzZSB0aGUgZmllbGQuCiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgTWV0aG9kIHNldHRlckZvckZpZWxkKEZpZWxkTWV0YURh\ndGEgZm1kKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGZt\nZC5nZXREZWNsYXJpbmdUeXBlKCkuZ2V0RGVjbGFyZWRNZXRob2QoCiAgICAg\nICAgICAgICAgICAic2V0IiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1k\nLmdldE5hbWUoKSksCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgZm1k\nLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIH0KICAgICAgICBjYXRj\naCAoTm9TdWNoTWV0aG9kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHJl\ndHVybiB0aGUgbmFtZSBvZiB0aGUgZmllbGQgdGhhdCBpcyByZXR1cm5lZCBi\neSA8Y29kZT5tZXRoPC9jb2RlPiwgb3IKICAgICAqICAgICAgICAgPGNvZGU+\nbnVsbDwvY29kZT4gaWYgc29tZXRoaW5nIG90aGVyIHRoYW4gYSBzaW5nbGUg\nZmllbGQgaXMKICAgICAqICAgICAgICAgcmV0dXJuZWQsIG9yIGlmIGl0IGNh\nbm5vdCBiZSBkZXRlcm1pbmVkIHdoYXQgaXMgcmV0dXJuZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgQkNGaWVsZCBjaGVja0dldHRlcklzU3ViY2xhc3NhYmxl\nKE1ldGhvZCBtZXRoLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGNo\nZWNrTWV0aG9kSXNTdWJjbGFzc2FibGUobWV0aCwgZm1kKTsKICAgICAgICBC\nQ0ZpZWxkIGZpZWxkID0gUENFbmhhbmNlci5nZXRSZXR1cm5lZEZpZWxkKGdl\ndEJDTWV0aG9kKG1ldGgpKTsKICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkg\newogICAgICAgICAgICBhZGRDb250cmFjdFZpb2xhdGlvbihsb2MuZ2V0KCJz\ndWJjbGFzc2VyLWludmFsaWQtZ2V0dGVyIiwKICAgICAgICAgICAgICAgIGZt\nZC5nZXROYW1lKCkpLCBmbWQpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmllbGQ7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHJldHVybiB0aGUgZmll\nbGQgdGhhdCBpcyBzZXQgaW4gPGNvZGU+bWV0aDwvY29kZT4sIG9yCiAgICAg\nKiAgICAgICAgIDxjb2RlPm51bGw8L2NvZGU+IGlmIHNvbWV0aGluZyBvdGhl\nciB0aGFuIGEgc2luZ2xlIGZpZWxkIGlzCiAgICAgKiAgICAgICAgIHNldCwg\nb3IgaWYgaXQgY2Fubm90IGJlIGRldGVybWluZWQgd2hhdCBpcyBzZXQuCiAg\nICAgKi8KICAgIHByaXZhdGUgQkNGaWVsZCBjaGVja1NldHRlcklzU3ViY2xh\nc3NhYmxlKE1ldGhvZCBtZXRoLCBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAg\nICAgIGNoZWNrTWV0aG9kSXNTdWJjbGFzc2FibGUobWV0aCwgZm1kKTsKICAg\nICAgICBCQ0ZpZWxkIGZpZWxkID0gUENFbmhhbmNlci5nZXRBc3NpZ25lZEZp\nZWxkKGdldEJDTWV0aG9kKG1ldGgpKTsKICAgICAgICBpZiAoZmllbGQgPT0g\nbnVsbCkgewogICAgICAgICAgICBhZGRDb250cmFjdFZpb2xhdGlvbihsb2Mu\nZ2V0KCJzdWJjbGFzc2VyLWludmFsaWQtc2V0dGVyIiwKICAgICAgICAgICAg\nICAgIGZtZC5nZXROYW1lKCkpLCBmbWQpOwogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmll\nbGQ7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgQkNNZXRob2QgZ2V0\nQkNNZXRob2QoTWV0aG9kIG1ldGgpIHsKICAgICAgICBCQ0NsYXNzIGJjID0g\ncGMuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhtZXRoLmdldERlY2xhcmluZ0Ns\nYXNzKCkpOwogICAgICAgIHJldHVybiBiYy5nZXREZWNsYXJlZE1ldGhvZCht\nZXRoLmdldE5hbWUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgY2hlY2tNZXRob2RJc1N1YmNsYXNzYWJs\nZShNZXRob2QgbWV0aCwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBT\ndHJpbmcgY2xhc3NOYW1lID0gZm1kLmdldERlZmluaW5nTWV0YURhdGEoKS4K\nICAgICAgICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKTsKICAg\nICAgICBpZiAoIShNb2RpZmllci5pc1Byb3RlY3RlZChtZXRoLmdldE1vZGlm\naWVycygpKQogICAgICAgICAgICB8fCBNb2RpZmllci5pc1B1YmxpYyhtZXRo\nLmdldE1vZGlmaWVycygpKSkpCiAgICAgICAgICAgIGFkZEVycm9yKGxvYy5n\nZXQoInN1YmNsYXNzZXItcHJpdmF0ZS1hY2Nlc3NvcnMtdW5zdXBwb3J0ZWQi\nLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lLCBtZXRoLmdldE5hbWUoKSks\nIGZtZCk7CiAgICAgICAgaWYgKE1vZGlmaWVyLmlzRmluYWwobWV0aC5nZXRN\nb2RpZmllcnMoKSkpCiAgICAgICAgICAgIGFkZEVycm9yKGxvYy5nZXQoInN1\nYmNsYXNzZXItZmluYWwtbWV0aG9kcy1ub3QtYWxsb3dlZCIsCiAgICAgICAg\nICAgICAgICBjbGFzc05hbWUsIG1ldGguZ2V0TmFtZSgpKSwgZm1kKTsKICAg\nICAgICBpZiAoTW9kaWZpZXIuaXNOYXRpdmUobWV0aC5nZXRNb2RpZmllcnMo\nKSkpCiAgICAgICAgICAgIGFkZENvbnRyYWN0VmlvbGF0aW9uKGxvYy5nZXQK\nICAgICAgICAgICAgICAgICgic3ViY2xhc3Nlci1uYXRpdmUtbWV0aG9kcy1u\nb3QtYWxsb3dlZCIsIGNsYXNzTmFtZSwKICAgICAgICAgICAgICAgICAgICBt\nZXRoLmdldE5hbWUoKSksCiAgICAgICAgICAgICAgICBmbWQpOwogICAgICAg\nIGlmIChNb2RpZmllci5pc1N0YXRpYyhtZXRoLmdldE1vZGlmaWVycygpKSkK\nICAgICAgICAgICAgYWRkRXJyb3IobG9jLmdldCgic3ViY2xhc3Nlci1zdGF0\naWMtbWV0aG9kcy1ub3Qtc3VwcG9ydGVkIiwKICAgICAgICAgICAgICAgIGNs\nYXNzTmFtZSwgbWV0aC5nZXROYW1lKCkpLCBmbWQpOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBhZGRFcnJvcihNZXNzYWdlIHMsIENsYXNzTWV0YURhdGEg\nY2xzKSB7CiAgICAgICAgaWYgKGVycm9ycyA9PSBudWxsKQogICAgICAgICAg\nICBlcnJvcnMgPSBuZXcgQXJyYXlMaXN0KCk7CgogICAgICAgIGVycm9ycy5h\nZGQobG9jLmdldCgic3ViY2xhc3Nlci1lcnJvci1tZXRhIiwgcywKICAgICAg\nICAgICAgY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCksCiAgICAg\nICAgICAgIGNscy5nZXRTb3VyY2VGaWxlKCkpKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgYWRkRXJyb3IoTWVzc2FnZSBzLCBGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIGlmIChlcnJvcnMgPT0gbnVsbCkKICAgICAgICAgICAg\nZXJyb3JzID0gbmV3IEFycmF5TGlzdCgpOwoKICAgICAgICBlcnJvcnMuYWRk\nKGxvYy5nZXQoInN1YmNsYXNzZXItZXJyb3ItZmllbGQiLCBzLAogICAgICAg\nICAgICBmbWQuZ2V0RnVsbE5hbWUoKSwKICAgICAgICAgICAgZm1kLmdldERl\nY2xhcmluZ01ldGFEYXRhKCkuZ2V0U291cmNlRmlsZSgpKSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGFkZENvbnRyYWN0VmlvbGF0aW9uKE1lc3NhZ2Ug\nbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBhZGQgdGhlIHZp\nb2xhdGlvbiBhcyBhbiBlcnJvciBpbiBjYXNlIHdlJ3JlIHByb2Nlc3Npbmcg\ndmlvbGF0aW9ucwogICAgICAgIC8vIGFzIGVycm9yczsgdGhpcyBrZWVwcyB0\naGVtIGluIHRoZSBvcmRlciB0aGF0IHRoZXkgd2VyZSBmb3VuZCByYXRoZXIK\nICAgICAgICAvLyB0aGFuIGp1c3QgYWRkaW5nIHRoZSB2aW9sYXRpb25zIHRv\nIHRoZSBlbmQgb2YgdGhlIGxpc3QuCiAgICAgICAgaWYgKGZhaWxPbkNvbnRy\nYWN0VmlvbGF0aW9ucykKICAgICAgICAgICAgYWRkRXJyb3IobSwgZm1kKTsK\nCiAgICAgICAgaWYgKGNvbnRyYWN0VmlvbGF0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICBjb250cmFjdFZpb2xhdGlvbnMgPSBuZXcgQXJyYXlMaXN0KCk7\nCgogICAgICAgIGNvbnRyYWN0VmlvbGF0aW9ucy5hZGQobG9jLmdldAogICAg\nICAgICAgICAoInN1YmNsYXNzZXItY29udHJhY3QtdmlvbGF0aW9uLWZpZWxk\nIiwgbS5nZXRNZXNzYWdlKCksCiAgICAgICAgICAgICAgICBmbWQuZ2V0RnVs\nbE5hbWUoKSwgZm1kLmdldERlY2xhcmluZ01ldGFEYXRhKCkuZ2V0U291cmNl\nRmlsZSgpKSk7CiAgICB9Cn0K\n","encoding":"base64"}

