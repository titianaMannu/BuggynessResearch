{"sha":"17ad0a7cc696b0191fc734b910f1bacc62498dd3","node_id":"MDQ6QmxvYjIwNjM2NDoxN2FkMGE3Y2M2OTZiMDE5MWZjNzM0YjkxMGYxYmFjYzYyNDk4ZGQz","size":15070,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/17ad0a7cc696b0191fc734b910f1bacc62498dd3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkFycmF5OwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsK\naW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3JwaGFuZWRLZXlBY3Rpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Qcm94eTsKCi8qKgogKiBBYnN0\ncmFjdCBiYXNlIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgY29yZSBQQ0RhdGEg\nYmVoYXZpb3IuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAqIEBh\ndXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0\ncmFjdCBjbGFzcyBBYnN0cmFjdFBDRGF0YQogICAgaW1wbGVtZW50cyBQQ0Rh\ndGEgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBu\nZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Rb\nXSBFTVBUWV9BUlJBWSA9IG5ldyBPYmplY3RbMF07CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGxvYWRlZCBmaWVsZCBtYXNrLgogICAgICovCiAgICBw\ndWJsaWMgYWJzdHJhY3QgQml0U2V0IGdldExvYWRlZCgpOwoKICAgIC8qKgog\nICAgICogQ3JlYXRlIGEgbmV3IHBjZGF0YSBmb3IgaG9sZGluZyB0aGUgc3Rh\ndGUgb2YgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1Ymxp\nYyBhYnN0cmFjdCBBYnN0cmFjdFBDRGF0YSBuZXdFbWJlZGRlZFBDRGF0YShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtKTsKCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0xvYWRlZChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0TG9hZGVk\nKCkuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9y\nbSB0aGUgZ2l2ZW4gZGF0YSB2YWx1ZSBpbnRvIGl0cyBmaWVsZCB2YWx1ZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCB0b0ZpZWxkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIE9i\namVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgUHJveHlEYXRhTGlzdCBjID0g\nKFByb3h5RGF0YUxpc3QpIGRhdGE7CiAgICAgICAgICAgICAgICBDb2xsZWN0\naW9uIGMyID0gKENvbGxlY3Rpb24pIHNtLm5ld0ZpZWxkUHJveHkoZm1kLmdl\ndEluZGV4KCkpOwogICAgICAgICAgICAgICAgYzIgPSB0b05lc3RlZEZpZWxk\ncyhzbSwgZm1kLmdldEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIGRhdGEsCiAg\nICAgICAgICAgICAgICAgICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgICAg\nICAgICAgaWYgKGMyIGluc3RhbmNlb2YgUHJveHkpIHsKICAgICAgICAgICAg\nICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94eSkgYzIpLmdldENo\nYW5nZVRyYWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgY3Quc2V0TmV4dFNlcXVl\nbmNlKGMubmV4dFNlcXVlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJldHVybiBjMjsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgTWFwIG0gPSAoTWFwKSBkYXRhOwog\nICAgICAgICAgICAgICAgTWFwIG0yID0gKE1hcCkgc20ubmV3RmllbGRQcm94\neShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBDb2xsZWN0aW9u\nIGtleXMgPSBuZXcgQXJyYXlMaXN0KG0uc2l6ZSgpKTsKICAgICAgICAgICAg\nICAgIENvbGxlY3Rpb24gdmFsdWVzID0gbmV3IEFycmF5TGlzdChtLnNpemUo\nKSk7CiAgICAgICAgICAgICAgICBNYXAuRW50cnkgZTsKCiAgICAgICAgICAg\nICAgICBJdGVyYXRvciBpdHIgPSBtLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsK\nICAgICAgICAgICAgICAgIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgZSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAga2V5cy5hZGQoZS5nZXRLZXkoKSk7CiAgICAg\nICAgICAgICAgICAgICAgdmFsdWVzLmFkZChlLmdldFZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIE9iamVjdFtdIGtleUFy\ncmF5ID0ga2V5cy50b0FycmF5KCk7CiAgICAgICAgICAgICAgICBPYmplY3Rb\nXSB2YWx1ZUFycmF5ID0gdG9OZXN0ZWRGaWVsZHMoc20sIGZtZC5nZXRFbGVt\nZW50KCksIHZhbHVlcywgZmV0Y2gsIGNvbnRleHQpLnRvQXJyYXkoKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGlkeCA9IDA7IGlkeCA8IGtleUFycmF5\nLmxlbmd0aDsgaWR4KyspIHsKICAgICAgICAgICAgICAgICAgICBtMi5wdXQo\na2V5QXJyYXlbaWR4XSwgdmFsdWVBcnJheVtpZHhdKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBtMjsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpbnQgbGVu\nZ3RoID0gQXJyYXkuZ2V0TGVuZ3RoKGRhdGEpOwogICAgICAgICAgICAgICAg\nT2JqZWN0IGEgPSBBcnJheS5uZXdJbnN0YW5jZShmbWQuZ2V0RWxlbWVudCgp\nLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGxlbmd0\naCk7CiAgICAgICAgICAgICAgICBpZiAobGVuZ3RoID09IDApCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGE7CgogICAgICAgICAgICAgICAgaWYgKGlz\nSW1tdXRhYmxlVHlwZShmbWQuZ2V0RWxlbWVudCgpKSkgewogICAgICAgICAg\nICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoZGF0YSwgMCwgYSwgMCwgbGVu\nZ3RoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgICAgICBBcnJheS5zZXQoYSwgaSwgdG9OZXN0ZWRG\naWVsZChzbSwgZm1kLmdldEVsZW1lbnQoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEFycmF5LmdldChkYXRhLCBpKSwgZmV0Y2gsIGNvbnRleHQp\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIHJldHVybiB0b05lc3RlZEZpZWxkKHNtLCBmbWQs\nIGRhdGEsIGZldGNoLCBjb250ZXh0KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUcmFuc2Zvcm0gdGhlIGdpdmVuIGRhdGEgdmFsdWUgdG8g\naXRzIGZpZWxkIHZhbHVlLiBUaGUgZGF0YSB2YWx1ZQogICAgICogbWF5IGJl\nIGEga2V5LCB2YWx1ZSwgb3IgZWxlbWVudCBvZiBhIG1hcCBvciBjb2xsZWN0\naW9uLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvTmVzdGVkRmll\nbGQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgVmFsdWVNZXRhRGF0YSB2bWQs\nCiAgICAgICAgT2JqZWN0IGRhdGEsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBpZiAoZGF0YSA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgc3dpdGNoICh2\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gKChEYXRl\nKSBkYXRhKS5jbG9uZSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT0NBTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gKExvY2FsZSkgZGF0YTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAg\nICBpZiAodm1kLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gdG9FbWJlZGRlZEZpZWxkKHNtLCB2bWQsIGRhdGEsIGZldGNoLCBj\nb250ZXh0KTsKICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAg\nICBPYmplY3QgcmV0ID0KICAgICAgICAgICAgICAgICAgICB0b1JlbGF0aW9u\nRmllbGQoc20sIHZtZCwgZGF0YSwgZmV0Y2gsIGNvbnRleHQpOwogICAgICAg\nICAgICAgICAgaWYgKHJldCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiByZXQ7CiAgICAgICAgICAgICAgICBPcnBoYW5lZEtleUFjdGlv\nbiBhY3Rpb24gPSBzbS5nZXRDb250ZXh0KCkuZ2V0Q29uZmlndXJhdGlvbigp\nLgogICAgICAgICAgICAgICAgICAgIGdldE9ycGhhbmVkS2V5QWN0aW9uSW5z\ndGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24ub3JwaGFu\nKGRhdGEsIHNtLCB2bWQpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVHJhbnNmb3JtIHRoZSBnaXZlbiBkYXRhIHZhbHVlIHRvIGl0\ncyBmaWVsZCB2YWx1ZS4gVGhlIGRhdGEgdmFsdWUKICAgICAqIG1heSBiZSBh\nIGtleSwgdmFsdWUsIG9yIGVsZW1lbnQgb2YgYSBtYXAgb3IgY29sbGVjdGlv\nbi4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gdG9OZXN0ZWRG\naWVsZHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgCiAgICAgICAgVmFsdWVN\nZXRhRGF0YSB2bWQsIENvbGxlY3Rpb24gZGF0YSwgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLAogICAgICAgIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAg\naWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIENvbGxlY3Rpb24gcmV0ID0gbmV3IEFycmF5TGlzdChkYXRhLnNp\nemUoKSk7CiAgICAgICAgc3dpdGNoICh2bWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0cj1kYXRhLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgIHJldC5hZGQo\nKChEYXRlKWl0ci5uZXh0KCkpLmNsb25lKCkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHJldDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxF\nOgogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHI9ZGF0YS5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBy\nZXQuYWRkKChMb2NhbGUpIGl0ci5uZXh0KCkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHJldDsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAg\nICAgICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0cj1kYXRhLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgICAgICByZXQu\nYWRkKHRvRW1iZWRkZWRGaWVsZChzbSwgdm1kLCBpdHIubmV4dCgpLCBmZXRj\naAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjb250ZXh0KSk7CiAg\nICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5QQ19VTlRZUEVEOgogICAgICAgICAgICAgICAgT2JqZWN0W10g\nciA9IHRvUmVsYXRpb25GaWVsZHMoc20sIGRhdGEsIGZldGNoKTsKICAgICAg\nICAgICAgICAgIGlmIChyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChyW2ldICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXQuYWRkKHJbaV0pOwogICAgICAgICAgICAg\nICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0LmFkZChzbS5nZXRDb250ZXh0KCkuZ2V0Q29uZmlndXJhdGlvbigpLgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0T3JwaGFuZWRLZXlB\nY3Rpb25JbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgb3JwaGFuKGRhdGEsIHNtLCB2bWQpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9CiAgICB9CgogICAgCiAgICAv\nKioKICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZGF0YSBpbnRvIGEgcmVs\nYXRpb24gZmllbGQgdmFsdWUuIERlZmF1bHQKICAgICAqIGltcGxlbWVudGF0\naW9uIGFzc3VtZXMgdGhlIGRhdGEgaXMgYW4gb2lkLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgT2JqZWN0IHRvUmVsYXRpb25GaWVsZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBWYWx1ZU1ldGFEYXRhIHZtZCwKICAgICAgICBPYmplY3Qg\nZGF0YSwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgIHJldHVybiBzbS5nZXRDb250ZXh0KCkuZmluZChkYXRh\nLCBmZXRjaCwgbnVsbCwgbnVsbCwgMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUcmFuc2Zvcm0gdGhlIGdpdmVuIGRhdGEgaW50byByZWxhdGlvbiBmaWVs\nZCB2YWx1ZXMuIERlZmF1bHQKICAgICAqIGltcGxlbWVudGF0aW9uIGFzc3Vt\nZXMgdGhlIGRhdGEgaXMgYW4gb2lkLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nT2JqZWN0W10gdG9SZWxhdGlvbkZpZWxkcyhPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLAogICAgICAgIE9iamVjdCBkYXRhLCBGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gpIHsKICAgICAgICByZXR1cm4gc20uZ2V0Q29udGV4dCgpLmZpbmRB\nbGwoKENvbGxlY3Rpb24pIGRhdGEsIGZldGNoLCBudWxsLCBudWxsLCAwKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZGF0\nYSBpbnRvIGFuIGVtYmVkZGVkIFBDIGZpZWxkIHZhbHVlLiBEZWZhdWx0CiAg\nICAgKiBpbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZSBkYXRhIGlzIGFuIHtA\nbGluayBBYnN0cmFjdFBDRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBP\nYmplY3QgdG9FbWJlZGRlZEZpZWxkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIFZhbHVlTWV0YURhdGEgdm1kLAogICAgICAgIE9iamVjdCBkYXRhLCBGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBjb250ZXh0KSB7CiAgICAg\nICAgQWJzdHJhY3RQQ0RhdGEgcGNkYXRhID0gKEFic3RyYWN0UENEYXRhKSBk\nYXRhOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZW1iZWRkZWQgPSBz\nbS5nZXRDb250ZXh0KCkuZW1iZWQobnVsbCwKICAgICAgICAgICAgcGNkYXRh\nLmdldElkKCksIHNtLCB2bWQpOwogICAgICAgIHBjZGF0YS5sb2FkKGVtYmVk\nZGVkLCAoQml0U2V0KSBwY2RhdGEuZ2V0TG9hZGVkKCkuY2xvbmUoKSwKICAg\nICAgICAgICAgZmV0Y2gsIGNvbnRleHQpOwogICAgICAgIHJldHVybiBlbWJl\nZGRlZC5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRyYW5zZm9ybSB0aGUgZ2l2ZW4gZmllbGQgdmFsdWUgdG8gYSBkYXRh\nIHZhbHVlIGZvciBjYWNoaW5nLiBSZXR1cm4KICAgICAqIHtAbGluayAjTlVM\nTH0gaWYgdW5hYmxlIHRvIGNhY2hlLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nT2JqZWN0IHRvRGF0YShGaWVsZE1ldGFEYXRhIGZtZCwgT2JqZWN0IHZhbCwg\nU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIGlmICh2YWwgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHN3aXRjaCAoZm1k\nLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgQ29sbGVjdGlv\nbiBjID0gKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICAgICAgICAgIGlmIChj\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJveHlE\nYXRhTGlzdC5FTVBUWV9MSVNUOwogICAgICAgICAgICAgICAgUHJveHlEYXRh\nTGlzdCBjMiA9IG51bGw7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZTsKICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgY2kgPSBjLml0ZXJhdG9yKCk7\nIGNpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSB0\nb05lc3RlZERhdGEoZm1kLmdldEVsZW1lbnQoKSwgY2kubmV4dCgpLCBjdHgp\nOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gTlVMTCkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGMyID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgc2l6ZSA9IGMuc2l6ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nMiA9IG5ldyBQcm94eURhdGFMaXN0KHNpemUpOwogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBDaGFuZ2VUcmFja2VyIGN0ID0gKChQcm94eSkg\nYykuZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYzIubmV4dFNlcXVlbmNlID0gY3QuZ2V0TmV4dFNlcXVlbmNl\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYzIubmV4dFNlcXVlbmNlID0gc2l6ZTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYzIuYWRk\nKHZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1\ncm4gYzI7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAg\nICAgICAgICAgIE1hcCBtID0gKE1hcCkgdmFsOwogICAgICAgICAgICAgICAg\naWYgKG0uaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5FTVBUWV9NQVA7CiAgICAgICAgICAgICAgICBNYXAgbTIg\nPSBudWxsOwogICAgICAgICAgICAgICAgTWFwLkVudHJ5IGU7CiAgICAgICAg\nICAgICAgICBPYmplY3QgdmFsMjsKICAgICAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgbWkgPSBtLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgbWkuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgICAgIGUgPSAoTWFwLkVudHJ5KSBt\naS5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gdG9OZXN0ZWRE\nYXRhKGZtZC5nZXRLZXkoKSwgZS5nZXRLZXkoKSwgY3R4KTsKICAgICAgICAg\nICAgICAgICAgICBpZiAodmFsID09IE5VTEwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICAgICAgICAgICAgIHZhbDIg\nPSB0b05lc3RlZERhdGEoZm1kLmdldEVsZW1lbnQoKSwgZS5nZXRWYWx1ZSgp\nLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWwyID09IE5VTEwp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAg\nICAgICAgICAgICAgIGlmIChtMiA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICBtMiA9IG5ldyBIYXNoTWFwKG0uc2l6ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBtMi5wdXQodmFsLCB2YWwyKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHJldHVybiBtMjsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBpbnQgbGVuZ3Ro\nID0gQXJyYXkuZ2V0TGVuZ3RoKHZhbCk7CiAgICAgICAgICAgICAgICBpZiAo\nbGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZ\nX0FSUkFZOwoKICAgICAgICAgICAgICAgIE9iamVjdCBhOwogICAgICAgICAg\nICAgICAgaWYgKGlzSW1tdXRhYmxlVHlwZShmbWQuZ2V0RWxlbWVudCgpKSkg\newogICAgICAgICAgICAgICAgICAgIGEgPSBBcnJheS5uZXdJbnN0YW5jZShm\nbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KHZhbCwgMCwgYSwgMCwgbGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0\nW10gZGF0YSA9IG5ldyBPYmplY3RbbGVuZ3RoXTsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGRhdGFbaV0gPSB0b05lc3RlZERhdGEoZm1k\nLmdldEVsZW1lbnQoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBB\ncnJheS5nZXQodmFsLCBpKSwgY3R4KTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgYSA9IGRhdGE7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiB0b05lc3RlZERhdGEoZm1k\nLCB2YWwsIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHdoZXRoZXIgdGhlIGRlY2xhcmVkIHR5cGUgb2YgdGhlIGdpdmVu\nIHZhbHVlIGlzIGltbXV0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIGlzSW1tdXRhYmxlVHlwZShWYWx1ZU1ldGFEYXRhIGVsZW1lbnQpIHsK\nICAgICAgICBzd2l0Y2ggKGVsZW1lbnQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRP\nVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVJfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JK\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJ\nR0RFQ0lNQUw6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVH\nRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm0gdGhlIGdpdmVu\nIG5lc3RlZCB2YWx1ZSB0byBhIGNhY2hhYmxlIHZhbHVlLiBSZXR1cm4KICAg\nICAqIHtAbGluayAjTlVMTH0gaWYgdGhlIHZhbHVlIGNhbm5vdCBiZSBjYWNo\nZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgdG9OZXN0ZWREYXRh\nKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3QgdmFsLAogICAgICAgIFN0b3Jl\nQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBzd2l0Y2ggKHZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWQoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9FbWJlZGRlZERhdGEodmFs\nLCBjdHgpOwogICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUENfVU5UWVBFRDoKICAgICAgICAgICAgICAg\nIHJldHVybiB0b1JlbGF0aW9uRGF0YSh2YWwsIGN0eCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBpZiAodmFs\nIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nICgoUHJveHkpIHZhbCkuY29weSh2YWwpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKERhdGUpIHZhbCkuY2xv\nbmUoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAg\nICAgICAgICAgICAgcmV0dXJuIChMb2NhbGUpIHZhbDsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgaWYgKHZh\nbCBpbnN0YW5jZW9mIFByb3h5KQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiAoKFByb3h5KSB2YWwpLmNvcHkodmFsKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVlIHRv\nIGNhY2hlIGZvciB0aGUgZ2l2ZW4gb2JqZWN0LiBDYWNoZXMgaXRzIG9pZCBi\neQogICAgICogZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVj\ndCB0b1JlbGF0aW9uRGF0YShPYmplY3QgdmFsLCBTdG9yZUNvbnRleHQgY3R4\nKSB7CiAgICAgICAgcmV0dXJuIGN0eC5nZXRPYmplY3RJZCh2YWwpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSB0byBjYWNoZSBm\nb3IgdGhlIGdpdmVuIGVtYmVkZGVkIFBDLiBDYWNoZXMgYQogICAgICoge0Bs\naW5rIFBDRGF0YX0gZnJvbSB7QGxpbmsgI25ld0VtYmVkZGVkUENEYXRhfSBi\neSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvRW1i\nZWRkZWREYXRhKE9iamVjdCB2YWwsIFN0b3JlQ29udGV4dCBjdHgpIHsKICAg\nICAgICBpZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBOVUxM\nOwoKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gY3R4LmdldFN0\nYXRlTWFuYWdlcih2YWwpOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gTlVMTDsKCiAgICAgICAgLy8gaGF2ZSB0byBjYWNo\nZSBhbGwgZGF0YSwgc28gbWFrZSBzdXJlIGl0J3MgYWxsIGxvYWRlZAogICAg\nICAgIC8vICMjIyBwcmV2ZW50IGxvYWRpbmcgb2YgdGhpbmdzIHRoYXQgYXJl\nbid0IGNhY2hlZCAobG9icywgbHJzLCBldGMpCiAgICAgICAgY3R4LnJldHJp\nZXZlKHZhbCwgZmFsc2UsIG51bGwpOwoKICAgICAgICBQQ0RhdGEgcGNkYXRh\nID0gbmV3RW1iZWRkZWRQQ0RhdGEoc20pOwogICAgICAgIHBjZGF0YS5zdG9y\nZShzbSk7CiAgICAgICAgcmV0dXJuIHBjZGF0YTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRyYWNrcyBwcm94eSBkYXRhIGFsb25nIHdpdGggbGlzdCBlbGVt\nZW50cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUHJveHlE\nYXRhTGlzdAogICAgICAgIGV4dGVuZHMgQXJyYXlMaXN0IHsKCiAgICAgICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBQcm94eURhdGFMaXN0IEVNUFRZX0xJU1Qg\nPSBuZXcgUHJveHlEYXRhTGlzdCgwKTsKCiAgICAgICAgcHVibGljIGludCBu\nZXh0U2VxdWVuY2UgPSAwOwoKICAgICAgICBwdWJsaWMgUHJveHlEYXRhTGlz\ndChpbnQgc2l6ZSkgewoJCQlzdXBlciAoc2l6ZSk7CgkJfQoJfQp9Cg==\n","encoding":"base64"}

