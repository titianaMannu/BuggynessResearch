{"sha":"a3963c54e2075d7ffb7ab629e747542dbbbb541b","node_id":"MDQ6QmxvYjIwNjM2NDphMzk2M2M1NGUyMDc1ZDdmZmI3YWI2MjllNzQ3NTQyZGJiYmI1NDFi","size":166404,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a3963c54e2075d7ffb7ab629e747542dbbbb541b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTW9kaWZpZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xs\nZXI7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RDb2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLlN0YXR1czsKaW1wb3J0IGphdmF4\nLnRyYW5zYWN0aW9uLlN5bmNocm9uaXphdGlvbjsKCmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuaXRlcmF0b3JzLkl0ZXJhdG9yQ2hh\naW47CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFw\nLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxl\nY3Rpb25zLm1hcC5MaW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY29sbGVjdGlvbnMuc2V0Lk1hcEJhY2tlZFNldDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVlLk1hbmFnZWRSdW50aW1lOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNl\nQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5MaWZl\nY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5ldmVudC5M\naWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuUmVtb3RlQ29tbWl0RXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5zYWN0aW9uRXZlbnQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuVHJhbnNhY3Rpb25FdmVudE1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMu\nRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRp\nbC5KMkRvUHJpdkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLnV0aWwuUmVmZXJlbmNlSGFzaE1hcDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VIYXNoU2V0OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLlJlZmVyZW5jZU1hcDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5jb25jdXJyZW50LlJlZW50\ncmFudExvY2s7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFz\nc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmll\nbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1l\ndGFEYXRhUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLlNlcXVlbmNlTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5DYWxsYmFja0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTm9UcmFuc2FjdGlv\nbkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9i\namVjdEV4aXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9iamVjdElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuT2JqZWN0Tm90Rm91bmRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFu\nc2xhdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5VbnN1\ncHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlVzZXJFeGNlcHRpb247CgovKioKICogQ29uY3JldGUge0BsaW5rIEJy\nb2tlcn0uIFRoZSBicm9rZXIgaGFuZGxlcyBvYmplY3QtbGV2ZWwgYmVoYXZp\nb3IsCiAqIGJ1dCBsZWF2ZXMgYWxsIGludGVyYWN0aW9uIHdpdGggdGhlIGRh\ndGEgc3RvcmUgdG8gYSB7QGxpbmsgU3RvcmVNYW5hZ2VyfQogKiB0aGF0IG11\nc3QgYmUgc3VwcGxpZWQgYXQgaW5pdGlhbGl6YXRpb24uCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgQnJva2VySW1wbAogICAg\naW1wbGVtZW50cyBCcm9rZXIsIEZpbmRDYWxsYmFja3MsIENsb25lYWJsZSB7\nCgogICAgLyoqCiAgICAgKiBJbmNyZW1lbnRhbCBmbHVzaC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxVU0hfSU5DID0gMDsK\nCiAgICAvKioKICAgICAqIEZsdXNoIGluIHByZXBhcmF0aW9uIG9mIGNvbW1p\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRkxV\nU0hfQ09NTUlUID0gMTsKCiAgICAvKioKICAgICAqIEZsdXNoIHRvIGNoZWNr\nIGNvbnNpc3RlbmN5IG9mIGNhY2hlLCB0aGVuIGltbWVkaWF0ZWx5IHJvbGxi\nYWNrIGNoYW5nZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgaW50IEZMVVNIX1JPTExCQUNLID0gMjsKCiAgICAvKioKICAgICAqIFJ1\nbiBwZXJzaXN0ZW5jZS1ieS1yZWFjaGFiaWxpdHkgYW5kIG90aGVyIGZsdXNo\nLXRpbWUgb3BlcmF0aW9ucyB3aXRob3V0CiAgICAgKiBhY2Nlc3NpbmcgdGhl\nIGRhdGFiYXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBGTFVTSF9MT0dJQ0FMID0gMzsKCiAgICBzdGF0aWMgZmluYWwgaW50\nIFNUQVRVU19JTklUID0gMDsKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVT\nX1RSQU5TSUVOVCA9IDE7CiAgICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19P\nSURfQVNTSUdOID0gMjsKICAgIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTX0NP\nTU1JVF9ORVcgPSAzOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBG\nTEFHX0FDVElWRSA9IDIgPDwgMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX1NUT1JFX0FDVElWRSA9IDIgPDwgMTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0NMT1NFX0lOVk9LRUQgPSAyIDw8IDI7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19QUkVTVE9SSU5H\nID0gMiA8PCAzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nREVSRUZERUxFVElORyA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0ZMVVNISU5HID0gMiA8PCA1OwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEZMQUdfU1RPUkVfRkxVU0hJTkcgPSAyIDw8IDY7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVTSEVEID0g\nMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxV\nU0hfUkVRVUlSRUQgPSAyIDw8IDg7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBpbnQgRkxBR19SRU1PVEVfTElTVEVORVIgPSAyIDw8IDk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19SRVRBSU5FRF9DT05OID0gMiA8\nPCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1RSQU5T\nX0VORElORyA9IDIgPDwgMTE7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPQogICAgICAgIExvY2FsaXplci5mb3JQYWNrYWdl\nKEJyb2tlckltcGwuY2xhc3MpOwoKICAgIC8vCXRoZSBzdG9yZSBtYW5hZ2Vy\nIGluIHVzZTsgdGhpcyBtYXkgYmUgYSBkZWNvcmF0b3Igc3VjaCBhcyBhCiAg\nICAvLwlkYXRhIGNhY2hlIHN0b3JlIG1hbmFnZXIgYXJvdW5kIHRoZSBuYXRp\ndmUgc3RvcmUgbWFuYWdlcgogICAgcHJpdmF0ZSBEZWxlZ2F0aW5nU3RvcmVN\nYW5hZ2VyIF9zdG9yZSA9IG51bGw7CgogICAgLy8gcmVmIHRvIHByb2R1Y2lu\nZyBmYWN0b3J5IGFuZCBjb25maWd1cmF0aW9uCiAgICBwcml2YXRlIEFic3Ry\nYWN0QnJva2VyRmFjdG9yeSBfZmFjdG9yeSA9IG51bGw7CiAgICBwcml2YXRl\nIE9wZW5KUEFDb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKICAgIHByaXZh\ndGUgQ29tcGF0aWJpbGl0eSBfY29tcGF0ID0gbnVsbDsKICAgIHByaXZhdGUg\nRmV0Y2hDb25maWd1cmF0aW9uIF9mYyA9IG51bGw7CiAgICBwcml2YXRlIExv\nZyBfbG9nID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF91c2VyID0gbnVs\nbDsKICAgIHByaXZhdGUgU3RyaW5nIF9wYXNzID0gbnVsbDsKICAgIHByaXZh\ndGUgTWFuYWdlZFJ1bnRpbWUgX3J1bnRpbWUgPSBudWxsOwogICAgcHJpdmF0\nZSBMb2NrTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBJbnZlcnNl\nTWFuYWdlciBfaW0gPSBudWxsOwogICAgcHJpdmF0ZSBSZWVudHJhbnRMb2Nr\nIF9sb2NrID0gbnVsbDsKICAgIHByaXZhdGUgT3BDYWxsYmFja3MgX2NhbGwg\nPSBudWxsOwogICAgcHJpdmF0ZSBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRv\nciBfZXh0cmFucyA9IG51bGw7CgogICAgLy8gY2FjaGUgY2xhc3MgbG9hZGVy\nIGFzc29jaWF0ZWQgd2l0aCB0aGUgYnJva2VyCiAgICBwcml2YXRlIENsYXNz\nTG9hZGVyIF9sb2FkZXIgPSBudWxsOwoKICAgIC8vIHVzZXIgc3RhdGUKICAg\nIHByaXZhdGUgU3luY2hyb25pemF0aW9uIF9zeW5jID0gbnVsbDsKICAgIHBy\naXZhdGUgTWFwIF91c2VyT2JqZWN0cyA9IG51bGw7CgogICAgLy8gbWFuYWdl\nZCBvYmplY3QgY2FjaGVzCiAgICBwcml2YXRlIE1hbmFnZWRDYWNoZSBfY2Fj\naGUgPSBudWxsOwogICAgcHJpdmF0ZSBUcmFuc2FjdGlvbmFsQ2FjaGUgX3Ry\nYW5zQ2FjaGUgPSBudWxsOwogICAgcHJpdmF0ZSBTZXQgX3RyYW5zQWRkaXRp\nb25zID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9kZXJlZkNhY2hlID0gbnVs\nbDsKICAgIHByaXZhdGUgU2V0IF9kZXJlZkFkZGl0aW9ucyA9IG51bGw7CiAg\nICBwcml2YXRlIE1hcCBfbG9hZGluZyA9IG51bGw7CiAgICBwcml2YXRlIFNl\ndCBfb3BlcmF0aW5nID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF9wZXJzaXN0\nZWRDbHNzID0gbnVsbDsKICAgIHByaXZhdGUgU2V0IF91cGRhdGVkQ2xzcyA9\nIG51bGw7CiAgICBwcml2YXRlIFNldCBfZGVsZXRlZENsc3MgPSBudWxsOwog\nICAgcHJpdmF0ZSBTZXQgX3BlbmRpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBp\nbnQgZmluZEFsbERlcHRoID0gMDsKCiAgICAvLyB0cmFjayBpbnN0YW5jZXMg\ndGhhdCBiZWNvbWUgdHJhbnNhY3Rpb25hbCBhZnRlciB0aGUgZmlyc3Qgc2F2\nZXBvaW50CiAgICAvLyAodGhlIGZpcnN0IHVzZXMgdGhlIHRyYW5zYWN0aW9u\nYWwgY2FjaGUpCiAgICBwcml2YXRlIFNldCBfc2F2ZXBvaW50Q2FjaGUgPSBu\ndWxsOwogICAgcHJpdmF0ZSBMaW5rZWRNYXAgX3NhdmVwb2ludHMgPSBudWxs\nOwogICAgcHJpdmF0ZSBTYXZlcG9pbnRNYW5hZ2VyIF9zcG0gPSBudWxsOwoK\nICAgIC8vIHRyYWNrIG9wZW4gcXVlcmllcyBhbmQgZXh0ZW50cyBzbyB3ZSBj\nYW4gZnJlZSB0aGVpciByZXNvdXJjZXMgb24gY2xvc2UKICAgIHByaXZhdGUg\nUmVmZXJlbmNlSGFzaFNldCBfcXVlcmllcyA9IG51bGw7CiAgICBwcml2YXRl\nIFJlZmVyZW5jZUhhc2hTZXQgX2V4dGVudHMgPSBudWxsOwoKICAgIC8vIHRy\nYWNrIG9wZXJhdGlvbiBzdGFjayBkZXB0aAogICAgcHJpdmF0ZSBpbnQgX29w\nZXJhdGlvbkNvdW50ID0gMDsKCiAgICAvLyBvcHRpb25zCiAgICBwcml2YXRl\nIGJvb2xlYW4gX25vbnRyYW5zUmVhZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBi\nb29sZWFuIF9ub250cmFuc1dyaXRlID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX3JldGFpblN0YXRlID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBf\nYXV0b0NsZWFyID0gQ0xFQVJfREFUQVNUT1JFOwogICAgcHJpdmF0ZSBpbnQg\nX3Jlc3RvcmVTdGF0ZSA9IFJFU1RPUkVfSU1NVVRBQkxFOwogICAgcHJpdmF0\nZSBib29sZWFuIF9vcHRpbWlzdGljID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX2lnbm9yZUNoYW5nZXMgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfbXVsdGl0aHJlYWRlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9tYW5hZ2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N5\nbmNNYW5hZ2VkID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfY29ublJldGFp\nbk1vZGUgPSBDT05OX1JFVEFJTl9ERU1BTkQ7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX2V2aWN0RGF0YUNhY2hlID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX3BvcHVsYXRlRGF0YUNhY2hlID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfbGFyZ2VUcmFuc2FjdGlvbiA9IGZhbHNlOwogICAgcHJpdmF0ZSBp\nbnQgX2F1dG9EZXRhY2ggPSAwOwogICAgcHJpdmF0ZSBpbnQgX2RldGFjaFN0\nYXRlID0gREVUQUNIX0xPQURFRDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZGV0\nYWNoZWROZXcgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9vcmRlckRp\ncnR5ID0gZmFsc2U7CgogICAgLy8gc3RhdHVzCiAgICBwcml2YXRlIGludCBf\nZmxhZ3MgPSAwOwogICAgcHJpdmF0ZSBib29sZWFuIF9jbG9zZWQgPSBmYWxz\nZTsKICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiBfY2xvc2VkRXhjZXB0\naW9uID0gbnVsbDsKCiAgICAvLyBldmVudCBtYW5hZ2VycwogICAgcHJpdmF0\nZSBUcmFuc2FjdGlvbkV2ZW50TWFuYWdlciBfdHJhbnNFdmVudE1hbmFnZXIg\nPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX3RyYW5zQ2FsbGJhY2tNb2RlID0g\nMDsKICAgIHByaXZhdGUgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIF9saWZlRXZl\nbnRNYW5hZ2VyID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9saWZlQ2FsbGJh\nY2tNb2RlID0gMDsKCiAgICBwcml2YXRlIGJvb2xlYW4gX2luaXRpYWxpemVX\nYXNJbnZva2VkID0gZmFsc2U7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBP\nYmplY3RbXSBFTVBUWV9PQkpFQ1RTID0gbmV3IE9iamVjdFswXTsKCiAgICAv\nKioKICAgICAqIFNldCB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlcidzIGF1dGhl\nbnRpY2F0aW9uLiBUaGlzIGlzIHRoZSBmaXJzdAogICAgICogbWV0aG9kIGNh\nbGxlZCBhZnRlciBjb25zdHJ1Y3Rpb24uCiAgICAgKgogICAgICogQHBhcmFt\nIHVzZXIgdGhlIHVzZXJuYW1lIHRoaXMgYnJva2VyIHJlcHJlc2VudHM7IHVz\nZWQgd2hlbiBwb29saW5nCiAgICAgKiBicm9rZXJzIHRvIG1ha2Ugc3VyZSB0\naGF0IGEgcmVxdWVzdCB0byB0aGUgZmFjdG9yeSBmb3IKICAgICAqIGEgY29u\nbmVjdGlvbiB3aXRoIGFuIGV4cGxpY2l0IHVzZXIgaXMgZGVsZWdhdGVkIHRv\nIGEgc3VpdGFibGUgYnJva2VyCiAgICAgKiBAcGFyYW0gcGFzcyB0aGUgcGFz\nc3dvcmQgZm9yIHRoZSBhYm92ZSB1c2VyCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEF1dGhlbnRpY2F0aW9uKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFz\ncykgewogICAgICAgIF91c2VyID0gdXNlcjsKICAgICAgICBfcGFzcyA9IHBh\nc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHRoZSBwZXJz\naXN0ZW5jZSBtYW5hZ2VyLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQKICAgICAq\nIGF1dG9tYXRpY2FsbHkgYnkgdGhlIGZhY3RvcnkgYmVmb3JlIHVzZS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0aGUgZmFjdG9yeSB1c2VkIHRv\nIGNyZWF0ZSB0aGlzIGJyb2tlcgogICAgICogQHBhcmFtIHNtIGEgY29uY3Jl\ndGUgU3RvcmVNYW5hZ2VyIGltcGxlbWVudGF0aW9uIHRvCiAgICAgKiBoYW5k\nbGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgZGF0YSBzdG9yZQogICAgICogQHBh\ncmFtIG1hbmFnZWQgdGhlIHRyYW5zYWN0aW9uIG1vZGUKICAgICAqIEBwYXJh\nbSBjb25uTW9kZSB0aGUgY29ubmVjdGlvbiByZXRhaW4gbW9kZQogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXplKEFic3RyYWN0QnJva2VyRmFj\ndG9yeSBmYWN0b3J5LAogICAgICAgIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIg\nc20sIGJvb2xlYW4gbWFuYWdlZCwgaW50IGNvbm5Nb2RlKSB7CiAgICAgICAg\nX2luaXRpYWxpemVXYXNJbnZva2VkID0gdHJ1ZTsKICAgICAgICBfbG9hZGVy\nID0gKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q29udGV4dENsYXNz\nTG9hZGVyQWN0aW9uKCkpOwogICAgICAgIF9jb25mID0gZmFjdG9yeS5nZXRD\nb25maWd1cmF0aW9uKCk7CiAgICAgICAgX2NvbXBhdCA9IF9jb25mLmdldENv\nbXBhdGliaWxpdHlJbnN0YW5jZSgpOwogICAgICAgIF9mYWN0b3J5ID0gZmFj\ndG9yeTsKICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKE9wZW5KUEFDb25m\naWd1cmF0aW9uLkxPR19SVU5USU1FKTsKICAgICAgICBfY2FjaGUgPSBuZXcg\nTWFuYWdlZENhY2hlKG5ld01hbmFnZWRPYmplY3RDYWNoZSgpKTsKICAgICAg\nICBfb3BlcmF0aW5nID0gTWFwQmFja2VkU2V0LmRlY29yYXRlKG5ldyBJZGVu\ndGl0eU1hcCgpKTsKICAgICAgICBfY29ublJldGFpbk1vZGUgPSBjb25uTW9k\nZTsKICAgICAgICBfbWFuYWdlZCA9IG1hbmFnZWQ7CiAgICAgICAgaWYgKG1h\nbmFnZWQpCiAgICAgICAgICAgIF9ydW50aW1lID0gX2NvbmYuZ2V0TWFuYWdl\nZFJ1bnRpbWVJbnN0YW5jZSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nX3J1bnRpbWUgPSBuZXcgTG9jYWxNYW5hZ2VkUnVudGltZSh0aGlzKTsKCiAg\nICAgICAgX2xpZmVFdmVudE1hbmFnZXIgPSBuZXcgTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyKAogICAgICAgICAgICBfY29uZi5nZXRMb2coT3BlbkpQQUNvbmZp\nZ3VyYXRpb24uTE9HX1JVTlRJTUUpKTsKICAgICAgICBfdHJhbnNFdmVudE1h\nbmFnZXIgPSBuZXcgVHJhbnNhY3Rpb25FdmVudE1hbmFnZXIoKTsKICAgICAg\nICBpbnQgY21vZGUgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpLgogICAgICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXRE\nZWZhdWx0cygpLmdldENhbGxiYWNrTW9kZSgpOwogICAgICAgIHNldExpZmVj\neWNsZUxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2RlKTsKICAgICAgICBzZXRU\ncmFuc2FjdGlvbkxpc3RlbmVyQ2FsbGJhY2tNb2RlKGNtb2RlKTsKCiAgICAg\nICAgLy8gc2V0dXAgZGVmYXVsdCBvcHRpb25zCiAgICAgICAgX2ZhY3Rvcnku\nY29uZmlndXJlQnJva2VyKHRoaXMpOwoKICAgICAgICAvLyBtYWtlIHN1cmUg\ndG8gZG8gdGhpcyBhZnRlciBjb25maWd1cmluZyBicm9rZXIgc28gdGhhdCBz\ndG9yZSBtYW5hZ2VyCiAgICAgICAgLy8gY2FuIGxvb2sgdG8gYnJva2VyIGNv\nbmZpZ3VyYXRpb247IHdlIHNldCBib3RoIHN0b3JlIGFuZCBsb2NrIG1hbmFn\nZXJzCiAgICAgICAgLy8gYmVmb3JlIGluaXRpYWxpemluZyB0aGVtIGJlY2F1\nc2UgdGhleSBtYXkgZWFjaCB0cnkgdG8gYWNjZXNzIHRoZQogICAgICAgIC8v\nIG90aGVyIGluIHRoaWVyIGluaXRpYWxpemF0aW9uCiAgICAgICAgX3N0b3Jl\nID0gc207CiAgICAgICAgX2xtID0gX2NvbmYubmV3TG9ja01hbmFnZXJJbnN0\nYW5jZSgpOwogICAgICAgIF9pbSA9IF9jb25mLm5ld0ludmVyc2VNYW5hZ2Vy\nSW5zdGFuY2UoKTsKICAgICAgICBfc3BtID0gX2NvbmYuZ2V0U2F2ZXBvaW50\nTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX3N0b3JlLnNldENvbnRleHQo\ndGhpcyk7CiAgICAgICAgX2xtLnNldENvbnRleHQodGhpcyk7CgogICAgICAg\nIGlmIChfY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5fQUxXQVlTKQog\nICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAgICAgICAgX2ZjID0g\nX3N0b3JlLm5ld0ZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIF9mYy5z\nZXRDb250ZXh0KHRoaXMpOwoKICAgICAgICAvLyBzeW5jaCB3aXRoIHRoZSBn\nbG9iYWwgdHJhbnNhY3Rpb24gaW4gcHJvZ3Jlc3MsIGlmIGFueQogICAgICAg\nIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbih0aGlz\nLCBmYWxzZSkpCiAgICAgICAgICAgIGJlZ2luSW50ZXJuYWwoKTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGNsb25lKCkKICAgICAgICB0aHJvd3MgQ2xv\nbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGlmIChfaW5pdGlh\nbGl6ZVdhc0ludm9rZWQpCiAgICAgICAgICAgIHRocm93IG5ldyBDbG9uZU5v\ndFN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICByZXR1cm4gc3VwZXIuY2xvbmUoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSB7QGxpbmsgTWFwfSB0byBiZSB1c2Vk\nIGZvciB0aGUgcHJpbWFyeSBtYW5hZ2VkIG9iamVjdCBjYWNoZS4KICAgICAq\nIE1hcHMgb2lkcyB0byBzdGF0ZSBtYW5hZ2Vycy4gQnkgZGVmYXVsdCwgdGhp\ncyBjcmVhdGVzIGEKICAgICAqIHtAbGluayBSZWZlcmVuY2VNYXB9IHdpdGgg\nc29mdCB2YWx1ZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBNYXAgbmV3TWFu\nYWdlZE9iamVjdENhY2hlKCkgewogICAgICAgIHJldHVybiBuZXcgUmVmZXJl\nbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAuSEFSRCwgUmVmZXJlbmNlTWFwLlNP\nRlQpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIFN0b3JlQ29udGV4dAog\nICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewogICAgICAgIHJldHVybiB0aGlz\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcm9wZXJ0aWVz\nCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNldEltcGxp\nY2l0QmVoYXZpb3IoT3BDYWxsYmFja3MgY2FsbCwKICAgICAgICBSdW50aW1l\nRXhjZXB0aW9uVHJhbnNsYXRvciBleCkgewogICAgICAgIGlmIChfY2FsbCA9\nPSBudWxsKQogICAgICAgICAgICBfY2FsbCA9IGNhbGw7CiAgICAgICAgaWYg\nKF9leHRyYW5zID09IG51bGwpCiAgICAgICAgICAgIF9leHRyYW5zID0gZXg7\nCiAgICB9CgogICAgUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgZ2V0SW5z\ndGFuY2VFeGNlcHRpb25UcmFuc2xhdG9yKCkgewogICAgICAgIHJldHVybiAo\nX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4dHJhbnMgOiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5IGdldEJyb2tlckZhY3Rvcnko\nKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5OwogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25maWd1cmF0aW9uKCkgewog\nICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0Q29ubmVj\ndGlvblJldGFpbk1vZGUoKSB7CiAgICAgICAgcmV0dXJuIF9jb25uUmV0YWlu\nTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc01hbmFnZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9tYW5hZ2VkOwogICAgfQoKICAgIHB1YmxpYyBN\nYW5hZ2VkUnVudGltZSBnZXRNYW5hZ2VkUnVudGltZSgpIHsKICAgICAgICBy\nZXR1cm4gX3J1bnRpbWU7CiAgICB9CgogICAgcHVibGljIENsYXNzTG9hZGVy\nIGdldENsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBfbG9hZGVyOwog\nICAgfQoKICAgIHB1YmxpYyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIGdldFN0\nb3JlTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX3N0b3JlOwogICAgfQoK\nICAgIHB1YmxpYyBMb2NrTWFuYWdlciBnZXRMb2NrTWFuYWdlcigpIHsKICAg\nICAgICByZXR1cm4gX2xtOwogICAgfQoKICAgIHB1YmxpYyBJbnZlcnNlTWFu\nYWdlciBnZXRJbnZlcnNlTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX2lt\nOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ubmVjdGlvblVzZXJO\nYW1lKCkgewogICAgICAgIHJldHVybiBfdXNlcjsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIGdldENvbm5lY3Rpb25QYXNzd29yZCgpIHsKICAgICAgICBy\nZXR1cm4gX3Bhc3M7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0TXVs\ndGl0aHJlYWRlZCgpIHsKICAgICAgICByZXR1cm4gX211bHRpdGhyZWFkZWQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TXVsdGl0aHJlYWRlZChib29s\nZWFuIG11bHRpdGhyZWFkZWQpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgX211bHRpdGhyZWFkZWQgPSBtdWx0aXRocmVhZGVkOwogICAgICAg\nIGlmIChtdWx0aXRocmVhZGVkICYmIF9sb2NrID09IG51bGwpCiAgICAgICAg\nICAgIF9sb2NrID0gbmV3IFJlZW50cmFudExvY2soKTsKICAgICAgICBlbHNl\nIGlmICghbXVsdGl0aHJlYWRlZCkKICAgICAgICAgICAgX2xvY2sgPSBudWxs\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldElnbm9yZUNoYW5nZXMo\nKSB7CiAgICAgICAgcmV0dXJuIF9pZ25vcmVDaGFuZ2VzOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldElnbm9yZUNoYW5nZXMoYm9vbGVhbiB2YWwpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2lnbm9yZUNoYW5nZXMg\nPSB2YWw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0Tm9udHJhbnNh\nY3Rpb25hbFJlYWQoKSB7CiAgICAgICAgcmV0dXJuIF9ub250cmFuc1JlYWQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Tm9udHJhbnNhY3Rpb25hbFJl\nYWQoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbGxl\nZ2FsLW9wLWluLXByZXN0b3JlIikpOwoKICAgICAgICAvLyBtYWtlIHN1cmUg\ndGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAgICBpZiAodmFsICYmICFf\nY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMKICAgICAgICAgICAg\nKF9jb25mLk9QVElPTl9OT05UUkFOU19SRUFEKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAoIm5vbnRyYW5zLXJlYWQtbm90LXN1cHBvcnRlZCIpKTsKCiAg\nICAgICAgX25vbnRyYW5zUmVhZCA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsV3JpdGUoKSB7CiAgICAgICAg\ncmV0dXJuIF9ub250cmFuc1dyaXRlOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldE5vbnRyYW5zYWN0aW9uYWxXcml0ZShib29sZWFuIHZhbCkgewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nUFJFU1RPUklORykgIT0gMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwtb3AtaW4tcHJlc3RvcmUiKSk7\nCgogICAgICAgIF9ub250cmFuc1dyaXRlID0gdmFsOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldE9wdGltaXN0aWMoKSB7CiAgICAgICAgcmV0dXJu\nIF9vcHRpbWlzdGljOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE9wdGlt\naXN0aWMoYm9vbGVhbiB2YWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgidHJhbnMtYWN0aXZlIiwKICAgICAgICAgICAgICAgICJPcHRpbWlzdGlj\nIikpOwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9y\ndHMgaXQKICAgICAgICBpZiAodmFsICYmICFfY29uZi5zdXBwb3J0ZWRPcHRp\nb25zKCkuY29udGFpbnMoX2NvbmYuT1BUSU9OX09QVElNSVNUSUMpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICgib3B0aW1pc3RpYy1ub3Qtc3VwcG9ydGVk\nIikpOwoKICAgICAgICBfb3B0aW1pc3RpYyA9IHZhbDsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IGdldFJlc3RvcmVTdGF0ZSgpIHsKICAgICAgICByZXR1cm4g\nX3Jlc3RvcmVTdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXN0\nb3JlU3RhdGUoaW50IHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAgICAgICAgIlJlc3RvcmUiKSk7\nCgogICAgICAgIF9yZXN0b3JlU3RhdGUgPSB2YWw7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0UmV0YWluU3RhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9yZXRhaW5TdGF0ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXRh\naW5TdGF0ZShib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nImlsbGVnYWwtb3AtaW4tcHJlc3RvcmUiKSk7CiAgICAgICAgX3JldGFpblN0\nYXRlID0gdmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QXV0b0NsZWFy\nKCkgewogICAgICAgIHJldHVybiBfYXV0b0NsZWFyOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldEF1dG9DbGVhcihpbnQgdmFsKSB7CiAgICAgICAgYXNz\nZXJ0T3BlbigpOwogICAgICAgIF9hdXRvQ2xlYXIgPSB2YWw7CiAgICB9Cgog\nICAgcHVibGljIGludCBnZXRBdXRvRGV0YWNoKCkgewogICAgICAgIHJldHVy\nbiBfYXV0b0RldGFjaDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRBdXRv\nRGV0YWNoKGludCBkZXRhY2hGbGFncykgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBfYXV0b0RldGFjaCA9IGRldGFjaEZsYWdzOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFjaEZsYWcs\nIGJvb2xlYW4gb24pIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\naWYgKG9uKQogICAgICAgICAgICBfYXV0b0RldGFjaCB8PSBkZXRhY2hGbGFn\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2F1dG9EZXRhY2ggJj0gfmRl\ndGFjaEZsYWc7CiAgICB9CgogICAgcHVibGljIGludCBnZXREZXRhY2hTdGF0\nZSgpIHsKICAgICAgICByZXR1cm4gX2RldGFjaFN0YXRlOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldERldGFjaFN0YXRlKGludCBtb2RlKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9kZXRhY2hTdGF0ZSA9IG1vZGU7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hlZE5ldygpIHsK\nICAgICAgICByZXR1cm4gX2RldGFjaGVkTmV3OwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldERldGFjaGVkTmV3KGJvb2xlYW4gaXNOZXcpIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2RldGFjaGVkTmV3ID0gaXNOZXc7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0U3luY1dpdGhNYW5hZ2Vk\nVHJhbnNhY3Rpb25zKCkgewogICAgICAgIHJldHVybiBfc3luY01hbmFnZWQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3luY1dpdGhNYW5hZ2VkVHJh\nbnNhY3Rpb25zKGJvb2xlYW4gc3luYykgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBfc3luY01hbmFnZWQgPSBzeW5jOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGdldEV2aWN0RnJvbURhdGFDYWNoZSgpIHsKICAgICAg\nICByZXR1cm4gX2V2aWN0RGF0YUNhY2hlOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEV2aWN0RnJvbURhdGFDYWNoZShib29sZWFuIGV2aWN0KSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9ldmljdERhdGFDYWNoZSA9\nIGV2aWN0OwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFBvcHVsYXRl\nRGF0YUNhY2hlKCkgewogICAgICAgIHJldHVybiBfcG9wdWxhdGVEYXRhQ2Fj\naGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UG9wdWxhdGVEYXRhQ2Fj\naGUoYm9vbGVhbiBjYWNoZSkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBfcG9wdWxhdGVEYXRhQ2FjaGUgPSBjYWNoZTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1RyYWNrQ2hhbmdlc0J5VHlwZSgpIHsKICAgICAg\nICByZXR1cm4gX2xhcmdlVHJhbnNhY3Rpb247CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0VHJhY2tDaGFuZ2VzQnlUeXBlKGJvb2xlYW4gbGFyZ2VUcmFu\nc2FjdGlvbikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfbGFy\nZ2VUcmFuc2FjdGlvbiA9IGxhcmdlVHJhbnNhY3Rpb247CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBnZXRVc2VyT2JqZWN0KE9iamVjdCBrZXkpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIChfdXNlck9iamVjdHMgPT0gbnVsbCkgPyBudWxs\nIDogX3VzZXJPYmplY3RzLmdldChrZXkpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IHB1dFVzZXJPYmplY3QoT2JqZWN0IGtleSwg\nT2JqZWN0IHZhbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAodmFsID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0cyA9PSBudWxsKSA/\nIG51bGwgOiBfdXNlck9iamVjdHMucmVtb3ZlKGtleSk7CgogICAgICAgICAg\nICBpZiAoX3VzZXJPYmplY3RzID09IG51bGwpCiAgICAgICAgICAgICAgICBf\ndXNlck9iamVjdHMgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICByZXR1\ncm4gX3VzZXJPYmplY3RzLnB1dChrZXksIHZhbCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8vLy8vLy8vLy8KICAgIC8vIEV2ZW50cwogICAgLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyB2b2lkIGFkZExpZmVjeWNsZUxpc3RlbmVyKE9i\namVjdCBsaXN0ZW5lciwgQ2xhc3NbXSBjbGFzc2VzKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIF9saWZlRXZlbnRNYW5hZ2VyLmFkZExpc3RlbmVyKGxpc3RlbmVyLCBjbGFz\nc2VzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVt\nb3ZlTGlmZWN5Y2xlTGlzdGVuZXIoT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKGxpc3Rl\nbmVyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBnZXRM\naWZlY3ljbGVMaXN0ZW5lckNhbGxiYWNrTW9kZSgpIHsKICAgICAgICByZXR1\ncm4gX2xpZmVDYWxsYmFja01vZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0TGlmZWN5Y2xlTGlzdGVuZXJDYWxsYmFja01vZGUoaW50IG1vZGUpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgX2xpZmVDYWxsYmFja01vZGUgPSBtb2RlOwogICAgICAg\nICAgICBfbGlmZUV2ZW50TWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENB\nTExCQUNLX0ZBSUxfRkFTVCkgIT0gMCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2l2ZSBzdGF0ZSBtYW5hZ2VycyBhY2Nlc3MgdG8g\ndGhlIGxpZmVjeWNsZSBldmVudCBtYW5hZ2VyLgogICAgICovCiAgICBwdWJs\naWMgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyIGdldExpZmVjeWNsZUV2ZW50TWFu\nYWdlcigpIHsKICAgICAgICByZXR1cm4gX2xpZmVFdmVudE1hbmFnZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGaXJlIGdpdmVuIGxpZmVjeWNsZSBldmVu\ndCwgaGFuZGxpbmcgYW55IGV4Y2VwdGlvbnMgYXBwcm9wcmlhdGVseS4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHdoZXRoZXIgZXZlbnRzIGFyZSBiZWluZyBw\ncm9jZXNzZWQgYXQgdGhpcyB0aW1lCiAgICAgKi8KICAgIGJvb2xlYW4gZmly\nZUxpZmVjeWNsZUV2ZW50KE9iamVjdCBzcmMsIE9iamVjdCByZWxhdGVkLCBD\nbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgaW50IGV2ZW50VHlwZSkgewog\nICAgICAgIGlmIChfbGlmZUV2ZW50TWFuYWdlciA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaGFuZGxlQ2FsbGJhY2tFeGNl\ncHRpb25zKF9saWZlRXZlbnRNYW5hZ2VyLmZpcmVFdmVudChzcmMsIHJlbGF0\nZWQsIAogICAgICAgICAgICBtZXRhLCBldmVudFR5cGUpLCBfbGlmZUNhbGxi\nYWNrTW9kZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUYWtlIGFjdGlvbnMgb24gY2FsbGJhY2sgZXhjZXB0aW9ucyBk\nZXBlbmRpbmcgb24gY2FsbGJhY2sgbW9kZS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhFeGNlcHRpb25bXSBl\neGNlcHMsIGludCBtb2RlKSB7CiAgICAgICAgaWYgKGV4Y2Vwcy5sZW5ndGgg\nPT0gMCB8fCAobW9kZSAmIENBTExCQUNLX0lHTk9SRSkgIT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBPcGVuSlBBRXhjZXB0aW9uIGNlOwog\nICAgICAgIGlmIChleGNlcHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgIGNl\nID0gbmV3IENhbGxiYWNrRXhjZXB0aW9uKGV4Y2Vwc1swXSk7CiAgICAgICAg\nZWxzZSAKICAgICAgICAgICAgY2UgPSBuZXcgQ2FsbGJhY2tFeGNlcHRpb24o\nX2xvYy5nZXQoImNhbGxiYWNrLWVyciIpKS4KICAgICAgICAgICAgICAgIHNl\ndE5lc3RlZFRocm93YWJsZXMoZXhjZXBzKTsKICAgICAgICBpZiAoKG1vZGUg\nJiBDQUxMQkFDS19ST0xMQkFDSykgIT0gMCAmJiAoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgY2Uuc2V0RmF0YWwodHJ1ZSk7\nCiAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGNlKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfTE9HKSAhPSAw\nICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLndh\ncm4oY2UpOwogICAgICAgIGlmICgobW9kZSAmIENBTExCQUNLX1JFVEhST1cp\nICE9IDApCiAgICAgICAgICAgIHRocm93IGNlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGFkZFRyYW5zYWN0aW9uTGlzdGVuZXIoT2JqZWN0IHRsKSB7CiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIF90cmFuc0V2ZW50TWFuYWdlci5hZGRMaXN0ZW5lcih0bCk7\nCiAgICAgICAgICAgIGlmICh0bCBpbnN0YW5jZW9mIFJlbW90ZUNvbW1pdEV2\nZW50TWFuYWdlcikKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1JF\nTU9URV9MSVNURU5FUjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVtb3ZlVHJhbnNhY3Rpb25MaXN0ZW5lcihPYmplY3QgdGwpIHsK\nICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5yZW1vdmVMaXN0\nZW5lcih0bCkKICAgICAgICAgICAgICAgICYmICh0bCBpbnN0YW5jZW9mIFJl\nbW90ZUNvbW1pdEV2ZW50TWFuYWdlcikpCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfUkVNT1RFX0xJU1RFTkVSOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgaW50IGdldFRyYW5zYWN0aW9uTGlzdGVuZXJDYWxs\nYmFja01vZGUoKSB7CiAgICAgICAgcmV0dXJuIF90cmFuc0NhbGxiYWNrTW9k\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUcmFuc2FjdGlvbkxpc3Rl\nbmVyQ2FsbGJhY2tNb2RlKGludCBtb2RlKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF90cmFu\nc0NhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAgICAgIF90cmFuc0V2ZW50\nTWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENBTExCQUNLX0ZBSUxfRkFT\nVCkgIT0gMCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nRmlyZSBnaXZlbiB0cmFuc2FjdGlvbiBldmVudCwgaGFuZGxpbmcgYW55IGV4\nY2VwdGlvbnMgYXBwcm9wcmlhdGVseS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGZpcmVUcmFuc2FjdGlvbkV2ZW50KFRyYW5zYWN0aW9uRXZlbnQgdHJh\nbnMpIHsKICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyICE9IG51bGwp\nCiAgICAgICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhfdHJhbnNF\ndmVudE1hbmFnZXIuZmlyZUV2ZW50KHRyYW5zKSwKICAgICAgICAgICAgICAg\nIF90cmFuc0NhbGxiYWNrTW9kZSk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8K\nICAgIC8vIExvb2t1cHMKICAgIC8vLy8vLy8vLy8vCgogICAgcHVibGljIE9i\namVjdCBmaW5kKE9iamVjdCBvaWQsIGJvb2xlYW4gdmFsaWRhdGUsIEZpbmRD\nYWxsYmFja3MgY2FsbCkgewogICAgICAgIGludCBmbGFncyA9IE9JRF9DT1BZ\nIHwgT0lEX0FMTE9XX05FVyB8IE9JRF9OT0RFTEVURUQ7CiAgICAgICAgaWYg\nKCF2YWxpZGF0ZSkKICAgICAgICAgICAgZmxhZ3MgfD0gT0lEX05PVkFMSURB\nVEU7CiAgICAgICAgcmV0dXJuIGZpbmQob2lkLCBfZmMsIG51bGwsIG51bGws\nIGZsYWdzLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZpbmQo\nT2JqZWN0IG9pZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBCaXRTZXQg\nZXhjbHVkZSwKICAgICAgICBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewog\nICAgICAgIHJldHVybiBmaW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGVkYXRh\nLCBmbGFncywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5h\nbCBmaW5kZXIuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmplY3QgZmluZChP\nYmplY3Qgb2lkLCBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEJpdFNldCBl\neGNsdWRlLAogICAgICAgIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzLCBGaW5k\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQog\nICAgICAgICAgICBjYWxsID0gdGhpczsKICAgICAgICBvaWQgPSBjYWxsLnBy\nb2Nlc3NBcmd1bWVudChvaWQpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PVkFMSURBVEUpID09\nIDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgT2JqZWN0Tm90Rm91bmRF\neGNlcHRpb24oX2xvYy5nZXQoIm51bGwtb2lkIikpOwogICAgICAgICAgICBy\nZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRj\naCA9IF9mYzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJl\nYWQoKTsKCiAgICAgICAgICAgIC8vIGNhY2hlZCBpbnN0YW5jZT8KICAgICAg\nICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlcklt\ncGxCeUlkKG9pZCwKICAgICAgICAgICAgICAgIChmbGFncyAmIE9JRF9BTExP\nV19ORVcpICE9IDAgfHwgKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgIT0gMCk7\nCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoIXJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRhLCBm\nbGFncykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vz\nc1JldHVybihvaWQsIHNtKTsKCiAgICAgICAgICAgICAgICBpZiAoIXNtLmlz\nTG9hZGluZygpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIGFsbCB0aGUgY29uZmlndXJlZCBmaWVsZHMgYXJlIGxvYWRlZDsgZG8gdGhp\ncwogICAgICAgICAgICAgICAgICAgIC8vIGFmdGVyIG1ha2luZyBpbnN0YW5j\nZSB0cmFuc2FjdGlvbmFsIGZvciBsb2NraW5nCiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB1c2VUcmFuc2FjdGlv\nbmFsU3RhdGUoZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgICAgICBzbS50\ncmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBs\nb2FkZWQ7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9hZGVkID0gc20ubG9hZChmZXRjaCwgU3RhdGVNYW5h\nZ2VySW1wbC5MT0FEX0ZHUywgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBleGNsdWRlLCBlZGF0YSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT0RFTEVU\nRUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IChmbGFn\ncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm8g\nZGF0YSBuZWVkZWQgdG8gYmUgbG9hZGVkIGFuZCB0aGUgdXNlciB3YW50cyB0\nbwogICAgICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlLCBqdXN0IG1ha2Ug\nc3VyZSB0aGUgb2JqZWN0IGV4aXN0cwogICAgICAgICAgICAgICAgICAgIGlm\nICghbG9hZGVkICYmIChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAwCiAg\nICAgICAgICAgICAgICAgICAgICAgICYmIF9jb21wYXQuZ2V0VmFsaWRhdGVU\ncnVlQ2hlY2tzU3RvcmUoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAh\nc20uaXNUcmFuc2FjdGlvbmFsKCkKICAgICAgICAgICAgICAgICAgICAgICAg\nJiYgIV9zdG9yZS5leGlzdHMoc20sIGVkYXRhKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkgPT0gMCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLnByb2Nl\nc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAoImRlbC1pbnN0YW5jZSIsIHNt\nLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBvaWQpKS4KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5hZ2VkSW5z\ndGFuY2UoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBvYmplY3Qgd2Fz\nIGNhY2hlZCwgd2UgbWF5IG5lZWQgdG8gdXBncmFkZSBsb2NrCiAgICAgICAg\nICAgICAgICAvLyBpZiBjdXJyZW50IGxldmVsIGlzIGhpZ2hlciB0aGFuIGxl\ndmVsIG9mIGluaXRpYWwgbG9hZAogICAgICAgICAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgICAg\nIGludCBsZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAg\nICAgICAgICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWwsIGZldGNoLmdldExv\nY2tUaW1lb3V0KCksIGVkYXRhKTsKICAgICAgICAgICAgICAgICAgICBzbS5y\nZWFkTG9ja2VkKGxldmVsLCBmZXRjaC5nZXRXcml0ZUxvY2tMZXZlbCgpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm8gY2FjaGVkIHNtIGZvciBhIG5ldy90\ncmFuc2llbnQgaWQgdHlwZSwgd2UKICAgICAgICAgICAgLy8gaXQgZGVmaW5p\ndGVseSBkb2Vzbid0IGV4aXN0CiAgICAgICAgICAgIGlmIChvaWQgaW5zdGFu\nY2VvZiBTdGF0ZU1hbmFnZXJJZCkKICAgICAgICAgICAgICAgIHJldHVybiBj\nYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAgICAgICAgICAgIC8v\nIGluaXRpYWxpemUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGRhdGFz\ndG9yZSBpbnN0YW5jZQogICAgICAgICAgICBzbSA9IG5ld1N0YXRlTWFuYWdl\nckltcGwob2lkLCAoZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7CiAgICAgICAg\nICAgIGJvb2xlYW4gbG9hZCA9IHJlcXVpcmVzTG9hZChzbSwgZmFsc2UsIGZl\ndGNoLCBlZGF0YSwgZmxhZ3MpOwogICAgICAgICAgICBzbSA9IGluaXRpYWxp\nemUoc20sIGxvYWQsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgIGlmIChz\nbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lE\nX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBhbGwgY29u\nZmlndXJlZCBmaWVsZHMgd2VyZSBsb2FkZWQKICAgICAgICAgICAgaWYgKGxv\nYWQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywg\nZXhjbHVkZSwKICAgICAgICAgICAgICAgICAgICAgICAgZWRhdGEsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhj\nZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGZsYWdz\nICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAgICAgICAgICAg\nICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemUgYSBu\nZXdseS1jb25zdHJ1Y3RlZCBzdGF0ZSBtYW5hZ2VyLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBpbml0aWFsaXplKFN0YXRlTWFu\nYWdlckltcGwgc20sIGJvb2xlYW4gbG9hZCwKICAgICAgICBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgICAgIGlmICgh\nbG9hZCkgewogICAgICAgICAgICBzbS5pbml0aWFsaXplKHNtLmdldE1ldGFE\nYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgUENT\ndGF0ZS5IT0xMT1cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFBD\nU3RhdGUgc3RhdGUgPSAodXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKSkK\nICAgICAgICAgICAgICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQQ1N0YXRlLlBO\nT05UUkFOUzsKICAgICAgICAgICAgc20uc2V0TG9hZGluZyh0cnVlKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX3N0b3JlLmlu\naXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgc20uc2V0TG9hZGluZyhmYWxzZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rpb24gb2lkcywg\nYm9vbGVhbiB2YWxpZGF0ZSwKICAgICAgICBGaW5kQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBpbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9JRF9BTExPV19O\nRVcgfCBPSURfTk9ERUxFVEVEOwogICAgICAgIGlmICghdmFsaWRhdGUpCiAg\nICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwogICAgICAgIHJl\ndHVybiBmaW5kQWxsKG9pZHMsIF9mYywgbnVsbCwgbnVsbCwgZmxhZ3MsIGNh\nbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENvbGxl\nY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAg\nIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFncykgewog\nICAgICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIGZldGNoLCBleGNsdWRlLCBl\nZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogSW50\nZXJuYWwgZmluZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0W10g\nZmluZEFsbChDb2xsZWN0aW9uIG9pZHMsIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IGVkYXRhLCBp\nbnQgZmxhZ3MsIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZpbmRB\nbGxEZXB0aCArKzsKCiAgICAgICAgLy8gdGhyb3cgYW55IGV4Y2VwdGlvbnMg\nZm9yIG51bGwgb2lkcyB1cCBpbW1lZGlhdGVseQogICAgICAgIGlmIChvaWRz\nID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4\nY2VwdGlvbigib2lkcyA9PSBudWxsIik7CiAgICAgICAgaWYgKChmbGFncyAm\nIE9JRF9OT1ZBTElEQVRFKSAhPSAwICYmIG9pZHMuY29udGFpbnMobnVsbCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJudWxsLW9pZHMiKSk7CgogICAgICAgIC8vIHdlIGhhdmUgdG8gdXNlIGEg\nbWFwIG9mIG9pZC0+c20gcmF0aGVyIHRoYW4gYSBzaW1wbGUKICAgICAgICAv\nLyBhcnJheSwgc28gdGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRvIGNyZWF0ZSBt\ndWx0aXBsZSBzbXMgZm9yIGVxdWl2YWxlbnQKICAgICAgICAvLyBvaWRzIGlm\nIHRoZSB1c2VyIGhhcyBkdXBsaWNhdGVzIGluIHRoZSBnaXZlbiBhcnJheQog\nICAgICAgIGlmIChfbG9hZGluZyA9PSBudWxsKQogICAgICAgICAgICBfbG9h\nZGluZyA9IG5ldyBIYXNoTWFwKChpbnQpIChvaWRzLnNpemUoKSAqIDEuMzMg\nKyAxKSk7CgogICAgICAgIGlmIChjYWxsID09IG51bGwpCiAgICAgICAgICAg\nIGNhbGwgPSB0aGlzOwogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAg\nICAgICAgICBmZXRjaCA9IF9mYzsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm9udHJh\nbnNhY3Rpb25hbFJlYWQoKTsKCiAgICAgICAgICAgIC8vIGNvbGxlY3Rpb24g\nb2Ygc3RhdGUgbWFuYWdlcnMgdG8gcGFzcyB0byBzdG9yZSBtYW5hZ2VyCiAg\nICAgICAgICAgIExpc3QgbG9hZCA9IG51bGw7CiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIGJvb2xlYW4gaW5pdGlhbGl6\nZWQ7CiAgICAgICAgICAgIGJvb2xlYW4gdHJhbnNTdGF0ZSA9IHVzZVRyYW5z\nYWN0aW9uYWxTdGF0ZShmZXRjaCk7CiAgICAgICAgICAgIE9iamVjdCBvYmos\nIG9pZDsKICAgICAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOyBpZHgrKykgewogICAgICAgICAgICAgICAgLy8gaWYgd2UndmUgYWxy\nZWFkeSBzZWVuIHRoaXMgb2lkLCBza2lwIHJlcGVhdHMKICAgICAgICAgICAg\nICAgIG9iaiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBvaWQgPSBj\nYWxsLnByb2Nlc3NBcmd1bWVudChvYmopOwogICAgICAgICAgICAgICAgaWYg\nKG9pZCA9PSBudWxsIHx8IF9sb2FkaW5nLmNvbnRhaW5zS2V5KG9iaikpCiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAg\nLy8gaWYgd2UgZG9uJ3QgaGF2ZSBhIGNhY2hlZCBpbnN0YW5jZSBvciBpdCBp\ncyBub3QgdHJhbnNhY3Rpb25hbAogICAgICAgICAgICAgICAgLy8gYW5kIGlz\nIGhvbGxvdyBvciB3ZSBuZWVkIHRvIHZhbGlkYXRlLCBsb2FkIGl0CiAgICAg\nICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwg\nKGZsYWdzICYgT0lEX0FMTE9XX05FVykgIT0gMAogICAgICAgICAgICAgICAg\nICAgIHx8IChfZmxhZ3MgJiBGTEFHX0ZMVVNIRUQpICE9IDApOwogICAgICAg\nICAgICAgICAgaW5pdGlhbGl6ZWQgPSBzbSAhPSBudWxsOwogICAgICAgICAg\nICAgICAgaWYgKCFpbml0aWFsaXplZCkKICAgICAgICAgICAgICAgICAgICBz\nbSA9IG5ld1N0YXRlTWFuYWdlckltcGwob2lkLCAoZmxhZ3MgJiBPSURfQ09Q\nWSkgIT0gMCk7CgogICAgICAgICAgICAgICAgX2xvYWRpbmcucHV0KG9iaiwg\nc20pOwogICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVzTG9hZChzbSwgaW5p\ndGlhbGl6ZWQsIGZldGNoLCBlZGF0YSwgZmxhZ3MpKSB7CiAgICAgICAgICAg\nICAgICAgICAgdHJhbnNTdGF0ZSA9IHRyYW5zU3RhdGUgfHwgdXNlVHJhbnNh\nY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\naW5pdGlhbGl6ZWQgJiYgIXNtLmlzVHJhbnNhY3Rpb25hbCgpICYmIHRyYW5z\nU3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9u\nYWwoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9hZCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5TGlzdChv\naWRzLnNpemUoKSAtIGlkeCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZC5h\nZGQoc20pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaW5pdGlhbGl6\nZWQpCiAgICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShzbS5nZXRN\nZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgUENTdGF0ZS5IT0xMT1cpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBwYXNzIGFsbCBzdGF0ZSBtYW5hZ2VycyBpbiBuZWVkIG9m\nIGxvYWRpbmcgb3IgdmFsaWRhdGlvbiB0byB0aGUKICAgICAgICAgICAgLy8g\nc3RvcmUgbWFuYWdlcgogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBQQ1N0YXRlIHN0YXRlID0gKHRyYW5zU3RhdGUp\nID8gUENTdGF0ZS5QQ0xFQU4KICAgICAgICAgICAgICAgICAgICA6IFBDU3Rh\ndGUuUE5PTlRSQU5TOwogICAgICAgICAgICAgICAgQ29sbGVjdGlvbiBmYWls\nZWQgPSBfc3RvcmUubG9hZEFsbChsb2FkLCBzdGF0ZSwKICAgICAgICAgICAg\nICAgICAgICBTdG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FLCBmZXRjaCwg\nZWRhdGEpOwoKICAgICAgICAgICAgICAgIC8vIHNldCBmYWlsZWQgaW5zdGFu\nY2VzIHRvIG51bGwKICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVs\nbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAg\nIGlmICgoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRp\nb24oZmFpbGVkKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGZhaWxlZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAg\nICAgICAgICAgICAgICAgICAgICAgX2xvYWRpbmcucHV0KGl0ci5uZXh0KCks\nIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBjcmVhdGUgcmVzdWx0cyBhcnJheTsgbWFrZSBzdXJlIGFs\nbCBjb25maWd1cmVkIGZpZWxkcyBhcmUKICAgICAgICAgICAgLy8gbG9hZGVk\nIGluIGVhY2ggaW5zdGFuY2UKICAgICAgICAgICAgT2JqZWN0W10gcmVzdWx0\ncyA9IG5ldyBPYmplY3Rbb2lkcy5zaXplKCldOwogICAgICAgICAgICBib29s\nZWFuIGFjdGl2ZSA9IChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMDsKICAg\nICAgICAgICAgaW50IGxldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgp\nOwogICAgICAgICAgICBpZHggPSAwOwogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IG9pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4\nKyspIHsKICAgICAgICAgICAgICAgIG9pZCA9IGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbG9hZGluZy5n\nZXQob2lkKTsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsICYmIHJl\ncXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVkYXRhLCBmbGFncykpIHsK\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICBzbS5sb2FkKGZldGNoLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdT\nLAogICAgICAgICAgICAgICAgICAgICAgICAJZXhjbHVkZSwgZWRhdGEsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVs\nLCBmZXRjaC5nZXRMb2NrVGltZW91dCgpLCBlZGF0YSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBmZXRjaC5n\nZXRXcml0ZUxvY2tMZXZlbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBj\nYXRjaCAoT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24gb25mZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkg\nIT0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGZsYWdzICYg\nT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBvbmZlOwogICAgICAgICAgICAgICAgICAgICAgICBzbSA9\nIG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmVzdWx0c1tpZHhdID0gY2FsbC5wcm9jZXNz\nUmV0dXJuKG9pZCwgc20pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiByZXN1bHRzOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZmluZEFsbERlcHRoLS07CiAgICAgICAgICAgIGlmIChm\naW5kQWxsRGVwdGggPT0gMCkKICAgICAgICAgICAgICAgIF9sb2FkaW5nID0g\nbnVsbDsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVu\nIGluc3RhbmNlIG5lZWRzIGxvYWRpbmcgYmVmb3JlIGJlaW5nIHJldHVybmVk\nCiAgICAgKiB0byB0aGUgdXNlci4KICAgICAqLwogICAgcHJpdmF0ZSBib29s\nZWFuIHJlcXVpcmVzTG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29s\nZWFuIGluaXRpYWxpemVkLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgT2JqZWN0IGVkYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICBpZiAo\nIWZldGNoLnJlcXVpcmVzTG9hZCgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAw\nKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZWRhdGEg\nIT0gbnVsbCkgLy8gdGFrZSBhZHZhbnRhZ2Ugb2YgZXhpc3RpbmcgcmVzdWx0\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmIChpbml0aWFs\naXplZCAmJiBzbS5nZXRQQ1N0YXRlKCkgIT0gUENTdGF0ZS5IT0xMT1cpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIWluaXRpYWxp\nemVkICYmIHNtLmdldE1ldGFEYXRhKCkuZ2V0UENTdWJjbGFzc2VzKCkubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0\ndXJuICFfY29tcGF0LmdldFZhbGlkYXRlRmFsc2VSZXR1cm5zSG9sbG93KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0byB1c2Ug\nYSB0cmFuc2FjdGlvbmFsIHN0YXRlLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gdXNlVHJhbnNhY3Rpb25hbFN0YXRlKEZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDAgJiYgKCFfb3B0aW1pc3RpYwogICAgICAgICAgICB8fCBfYXV0\nb0NsZWFyID09IENMRUFSX0FMTAogICAgICAgICAgICB8fCBmZXRjaC5nZXRS\nZWFkTG9ja0xldmVsKCkgIT0gTE9DS19OT05FKTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGZpbmRDYWNoZWQoT2JqZWN0IG9pZCwgRmluZENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAg\nICAgY2FsbCA9IHRoaXM7CiAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJn\ndW1lbnQob2lkKTsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGxCeUlkKG9pZCwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBDbGFzcyBnZXRPYmplY3RJZFR5cGUoQ2xhc3MgY2xzKSB7\nCiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25m\nLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAg\nICAgICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIGZhbHNlKTsKICAgICAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbAogICAgICAgICAgICAgICAgfHwgbWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05P\nV04pCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAg\naWYgKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgICAgIHJldHVybiBtZXRhLmdl\ndE9iamVjdElkVHlwZSgpOwoKICAgICAgICAgICAgcmV0dXJuIF9zdG9yZS5n\nZXREYXRhU3RvcmVJZFR5cGUobWV0YSk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdPYmplY3RJZChDbGFz\ncyBjbHMsIE9iamVjdCB2YWwpIHsKICAgICAgICBpZiAodmFsID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKGNscywgX2xv\nYWRlciwgdHJ1ZSk7CiAgICAgICAgICAgIHN3aXRjaCAobWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSkgewogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEu\nSURfREFUQVNUT1JFOgogICAgICAgICAgICAgICAgLy8gZGVsZWdhdGUgdG8g\nc3RvcmUgbWFuYWdlciBmb3IgZGF0YXN0b3JlIGlkcwogICAgICAgICAgICAg\nICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmluZwogICAgICAgICAgICAgICAg\nICAgICYmICgoU3RyaW5nKSB2YWwpLnN0YXJ0c1dpdGgoU3RhdGVNYW5hZ2Vy\nSWQuU1RSSU5HX1BSRUZJWCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG5ldyBTdGF0ZU1hbmFnZXJJZCgoU3RyaW5nKSB2YWwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIF9zdG9yZS5uZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEp\nOwogICAgICAgICAgICBjYXNlIENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJ\nT046CiAgICAgICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc0Fzc2lnbmFi\nbGUobWV0YS5nZXRPYmplY3RJZFR5cGUoKSwgCiAgICAgICAgICAgICAgICAg\nICAgdmFsLmdldENsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFtZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgCiAgICAgICAgICAgICAgICAg\nICAgICAgICYmIG1ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPYmplY3RJZChjbHMsIHZh\nbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBzdHJpbmdpZmllZCBhcHAg\naWQ/CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5n\nIAogICAgICAgICAgICAgICAgICAgICYmICFfY29uZi5nZXRDb21wYXRpYmls\naXR5SW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0U3Ry\naWN0SWRlbnRpdHlWYWx1ZXMoKQogICAgICAgICAgICAgICAgICAgICYmICFN\nb2RpZmllci5pc0Fic3RyYWN0KGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIFBDUmVnaXN0cnkubmV3T2JqZWN0SWQo\nY2xzLCAoU3RyaW5nKSB2YWwpOwoKICAgICAgICAgICAgICAgIE9iamVjdFtd\nIGFyciA9ICh2YWwgaW5zdGFuY2VvZiBPYmplY3RbXSkgPyAoT2JqZWN0W10p\nIHZhbAogICAgICAgICAgICAgICAgICAgIDogbmV3IE9iamVjdFtdeyB2YWwg\nfTsKICAgICAgICAgICAgICAgIHJldHVybiBBcHBsaWNhdGlvbklkcy5mcm9t\nUEtWYWx1ZXMoYXJyLCBtZXRhKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJtZXRhLXVua25vd25pZCIsIGNscykpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChDbGFzc0Nhc3RFeGNlcHRp\nb24gY2NlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtaWQtdmFsdWUiLCB2YWwsCiAgICAgICAgICAgICAg\nICB2YWwuZ2V0Q2xhc3MoKS5nZXROYW1lKCksIGNscykpLnNldENhdXNlKGNj\nZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIHN0YXRlIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiBvaWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgU3RhdGVNYW5hZ2VySW1wbCBuZXdTdGF0ZU1hbmFnZXJJbXBs\nKE9iamVjdCBvaWQsIGJvb2xlYW4gY29weSkgewogICAgICAgIC8vIHNlZSBp\nZiB3ZSdyZSBpbiB0aGUgcHJvY2VzcyBvZiBsb2FkaW5nIHRoaXMgb2lkIGlu\nIGEgbG9hZEFsbCBjYWxsCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsK\nICAgICAgICBpZiAoX2xvYWRpbmcgIT0gbnVsbCkgewogICAgICAgICAgICBz\nbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbG9hZGluZy5nZXQob2lkKTsKICAg\nICAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0UGVyc2lzdGVuY2VD\nYXBhYmxlKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsK\nICAgICAgICB9CgogICAgICAgIC8vIGZpbmQgbWV0YWRhdGEgZm9yIHRoZSBv\naWQKICAgICAgICBDbGFzcyBwY1R5cGUgPSBfc3RvcmUuZ2V0TWFuYWdlZFR5\ncGUob2lkKTsKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBf\nY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBpZiAocGNUeXBlICE9IG51\nbGwpCiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5nZXRNZXRhRGF0YShwY1R5\ncGUsIF9sb2FkZXIsIHRydWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nbWV0YSA9IHJlcG9zLmdldE1ldGFEYXRhKG9pZCwgX2xvYWRlciwgdHJ1ZSk7\nCgogICAgICAgIC8vIGNvcHkgdGhlIG9pZCBpZiBuZWVkZWQKICAgICAgICBp\nZiAoY29weSAmJiBfY29tcGF0LmdldENvcHlPYmplY3RJZHMoKSkgewogICAg\nICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICAgICAgb2lkID0g\nQXBwbGljYXRpb25JZHMuY29weShvaWQsIG1ldGEpOwogICAgICAgICAgICBl\nbHNlIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURh\ndGEuSURfVU5LTk9XTikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIG1ldGEpKTsK\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb2lkID0gX3N0b3Jl\nLmNvcHlEYXRhU3RvcmVJZChvaWQsIG1ldGEpOwogICAgICAgIH0KCiAgICAg\nICAgc20gPSBuZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgbWV0YSk7CiAgICAg\nICAgc20uc2V0T2JqZWN0SWQob2lkKTsKICAgICAgICByZXR1cm4gc207CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBzdGF0ZSBtYW5hZ2VyIGZv\nciB0aGUgZ2l2ZW4gb2lkIGFuZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFN0YXRlTWFuYWdlckltcGwgbmV3U3RhdGVNYW5hZ2VySW1wbChP\nYmplY3Qgb2lkLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAg\nICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySW1wbChvaWQsIG1ldGEsIHRo\naXMpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLwogICAgLy8gVHJhbnNh\nY3Rpb24KICAgIC8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGJl\nZ2luKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUp\nICE9IDApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJhY3RpdmUiKSk7CiAgICAgICAgICAgIF9m\nYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIHRydWUp\nOwogICAgICAgICAgICBiZWdpbkludGVybmFsKCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogTm90aWZ5IHRoZSBzdG9yZSBtYW5hZ2Vy\nIG9mIGEgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBi\nZWdpbkludGVybmFsKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJl\nZ2luU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24oX29wdGltaXN0aWMpOwogICAg\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19BQ1RJVkU7CgogICAgICAgICAgICAv\nLyBzdGFydCBsb2NraW5nCiAgICAgICAgICAgIGlmICghX29wdGltaXN0aWMp\nIHsKICAgICAgICAgICAgICAgIF9mYy5zZXRSZWFkTG9ja0xldmVsKF9jb25m\nLmdldFJlYWRMb2NrTGV2ZWxDb25zdGFudCgpKTsKICAgICAgICAgICAgICAg\nIF9mYy5zZXRXcml0ZUxvY2tMZXZlbChfY29uZi5nZXRXcml0ZUxvY2tMZXZl\nbENvbnN0YW50KCkpOwogICAgICAgICAgICAgICAgX2ZjLnNldExvY2tUaW1l\nb3V0KF9jb25mLmdldExvY2tUaW1lb3V0KCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9sbS5iZWdpblRyYW5zYWN0aW9uKCk7CgogICAgICAgICAg\nICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0JlZ2luTGlzdGVuZXJzKCkp\nCiAgICAgICAgICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJh\nbnNhY3Rpb25FdmVudCh0aGlzLAogICAgICAgICAgICAgICAgICAgIFRyYW5z\nYWN0aW9uRXZlbnQuQUZURVJfQkVHSU4sIG51bGwsIG51bGwsIG51bGwsIG51\nbGwpKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIC8vIGlmIHdlIGFscmVhZHkgc3RhcnRlZCB0aGUgdHJh\nbnNhY3Rpb24sIGRvbid0IGxldCBpdCBjb21taXQKICAgICAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAgICAgICAg\nIHNldFJvbGxiYWNrT25seUludGVybmFsKGtlKTsKICAgICAgICAgICAgdGhy\nb3cga2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBhbHJlYWR5\nIHN0YXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBkb24ndCBsZXQgaXQgY29tbWl0\nCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9IDAp\nCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChyZSk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSkuc2V0\nRmF0YWwodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3BlbmRpbmcg\nIT0gbnVsbCkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ID0gX3BlbmRpbmcuaXRlcmF0\nb3IoKTsgaXQuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSAo\nU3RhdGVNYW5hZ2VySW1wbCkgaXQubmV4dCgpOwogICAgICAgICAgICAgICAg\nc20udHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlz\nRGlydHkoKSkKICAgICAgICAgICAgICAgICAgICBzZXREaXJ0eShzbSwgdHJ1\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3BlbmRpbmcgPSBudWxs\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpblN0b3Jl\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9uKCk7\nCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUp\nID09IDApCiAgICAgICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5z\nYWN0aW9uKGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFN0b3JlRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBCZWdpbiBhIHN0b3JlIG1hbmFnZXIgdHJhbnNhY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWdpblN0b3JlTWFuYWdl\nclRyYW5zYWN0aW9uKGJvb2xlYW4gb3B0aW1pc3RpYykgewogICAgICAgIGlm\nICghb3B0aW1pc3RpYykgewogICAgICAgICAgICByZXRhaW5Db25uZWN0aW9u\nKCk7CiAgICAgICAgICAgIF9zdG9yZS5iZWdpbigpOwogICAgICAgICAgICBf\nZmxhZ3MgfD0gRkxBR19TVE9SRV9BQ1RJVkU7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgaWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JFVEFJ\nTl9UUkFOUykKICAgICAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsK\nICAgICAgICAgICAgX3N0b3JlLmJlZ2luT3B0aW1pc3RpYygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVuZCB0aGUgY3VycmVudCBzdG9y\nZSBtYW5hZ2VyIHRyYW5zYWN0aW9uLiBUaHJvd3MgYW4KICAgICAqIGV4Y2Vw\ndGlvbiB0byBzaWduYWwgYSBmb3JjZWQgcm9sbGJhY2sgYWZ0ZXIgZmFpbGVk\nIGNvbW1pdCwgb3RoZXJ3aXNlCiAgICAgKiByZXR1cm5zIGFueSBleGNlcHRp\nb24gZW5jb3VudGVyZWQgZHVyaW5nIHRoZSBlbmQgcHJvY2Vzcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBSdW50aW1lRXhjZXB0aW9uIGVuZFN0b3JlTWFuYWdl\nclRyYW5zYWN0aW9uKGJvb2xlYW4gcm9sbGJhY2spIHsKICAgICAgICBib29s\nZWFuIGZvcmNlZFJvbGxiYWNrID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBy\nZWxlYXNlQ29ubiA9IGZhbHNlOwogICAgICAgIFJ1bnRpbWVFeGNlcHRpb24g\nZXJyID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAg\nICAgICByZWxlYXNlQ29ubiA9IF9jb25uUmV0YWluTW9kZSAhPSBDT05OX1JF\nVEFJTl9BTFdBWVM7CiAgICAgICAgICAgICAgICBpZiAocm9sbGJhY2spCiAg\nICAgICAgICAgICAgICAgICAgX3N0b3JlLnJvbGxiYWNrKCk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX3N0b3JlLmNvbW1p\ndCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVs\nZWFzZUNvbm4gPSBfY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5fVFJB\nTlM7CiAgICAgICAgICAgICAgICBfc3RvcmUucm9sbGJhY2tPcHRpbWlzdGlj\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKFJ1\nbnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgaWYgKCFyb2xsYmFj\naykgewogICAgICAgICAgICAgICAgZm9yY2VkUm9sbGJhY2sgPSB0cnVlOwog\nICAgICAgICAgICAgICAgdHJ5IHsgX3N0b3JlLnJvbGxiYWNrKCk7IH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUyKSB7fQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGVyciA9IHJlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIF9mbGFncyAmPSB+RkxBR19TVE9SRV9BQ1RJVkU7CiAgICAgICAg\nfQoKICAgICAgICBpZiAocmVsZWFzZUNvbm4pIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VDb25uZWN0aW9uKCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgICAgIGlmIChlcnIgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICBlcnIgPSByZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYgKGZvcmNlZFJvbGxiYWNrKQogICAgICAgICAgICB0aHJvdyBlcnI7CiAg\nICAgICAgcmV0dXJuIGVycjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb21t\naXQoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9u\nKCk7CgogICAgICAgICAgICBqYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlv\nbiB0cmFucyA9CiAgICAgICAgICAgICAgICBfcnVudGltZS5nZXRUcmFuc2Fj\ndGlvbk1hbmFnZXIoKS5nZXRUcmFuc2FjdGlvbigpOwogICAgICAgICAgICBp\nZiAodHJhbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtdHJhbnMiKSk7\nCgogICAgICAgICAgICAvLyB0aGlzIGNvbW1pdCBvbiB0aGUgdHJhbnNhY3Rp\nb24gd2lsbCBjYXVzZSBvdXIKICAgICAgICAgICAgLy8gYmVmb3JlQ29tcGxl\ndGlvbiBtZXRob2QgdG8gYmUgaW52b2tlZAogICAgICAgICAgICB0cmFucy5j\nb21taXQoKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMt\nZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBpZiAoX2xvZy5p\nc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShf\nbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIGUpOwogICAgICAgICAgICB0\naHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwoKICAgICAgICAgICAgamF2\nYXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAg\nICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJh\nbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cmFucy5yb2xsYmFjaygpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJy\nb3IiKSwgZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlv\nbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0\nT3BlbigpOwogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICghX21hbmFn\nZWQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJ0cmFucy1ub3QtbWFuYWdlZCIpKTsKICAgICAg\nICAgICAgaWYgKF9mYWN0b3J5LnN5bmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9u\nKHRoaXMsIGZhbHNlKSkgewogICAgICAgICAgICAgICAgYmVnaW5JbnRlcm5h\nbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBjb21taXRBbmRSZXN1bWUoKSB7CiAgICAgICAgZW5k\nQW5kUmVzdW1lKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxi\nYWNrQW5kUmVzdW1lKCkgewogICAgICAgIGVuZEFuZFJlc3VtZShmYWxzZSk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGVuZEFuZFJlc3VtZShib29sZWFu\nIGNvbW1pdCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoY29tbWl0KQogICAgICAgICAg\nICAgICAgY29tbWl0KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHJvbGxiYWNrKCk7CiAgICAgICAgICAgIGJlZ2luKCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGdldFJvbGxiYWNrT25s\neSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9\nPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAg\nICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAg\nICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCku\nZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIHJldHVybiB0cmFucy5nZXRTdGF0dXMoKSA9PSBTdGF0dXMuU1RBVFVTX01B\nUktFRF9ST0xMQkFDSzsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgVGhyb3dhYmxlIGdldFJvbGxiYWNrQ2F1c2UoKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rp\nb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRp\nbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsK\nICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKHRyYW5zLmdldFN0YXR1\ncygpID09IFN0YXR1cy5TVEFUVVNfTUFSS0VEX1JPTExCQUNLKQogICAgICAg\nICAgICAgICAgcmV0dXJuIF9ydW50aW1lLmdldFJvbGxiYWNrQ2F1c2UoKTsK\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNrT25seSgpIHsKICAgICAg\nICBzZXRSb2xsYmFja09ubHkobmV3IFVzZXJFeGNlcHRpb24oKSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Um9sbGJhY2tPbmx5KFRocm93YWJsZSBj\nYXVzZSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0aW9u\nKCk7CiAgICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKGNhdXNl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRo\nZSBjdXJyZW50IHRyYW5zYWN0aW9uIGFzIHJvbGxiYWNrLW9ubHkuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChU\naHJvd2FibGUgY2F1c2UpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBq\nYXZheC50cmFuc2FjdGlvbi5UcmFuc2FjdGlvbiB0cmFucyA9CiAgICAgICAg\nICAgICAgICBfcnVudGltZS5nZXRUcmFuc2FjdGlvbk1hbmFnZXIoKS5nZXRU\ncmFuc2FjdGlvbigpOwogICAgICAgICAgICBpZiAodHJhbnMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoIm51bGwtdHJhbnMiKSk7CiAgICAgICAgICAgIC8vIGVu\nc3VyZSB0cmFuIGlzIGluIGEgdmFsaWQgc3RhdGUgdG8gYWNjZXB0IHRoZSBz\nZXRSb2xsYmFja09ubHkKICAgICAgICAgICAgaW50IHRyYW5TdGF0dXMgPSB0\ncmFucy5nZXRTdGF0dXMoKTsKICAgICAgICAgICAgaWYgKCh0cmFuU3RhdHVz\nICE9IFN0YXR1cy5TVEFUVVNfTk9fVFJBTlNBQ1RJT04pCiAgICAgICAgICAg\nICAgICAgICAgJiYgKHRyYW5TdGF0dXMgIT0gU3RhdHVzLlNUQVRVU19ST0xM\nRURCQUNLKQogICAgICAgICAgICAgICAgICAgICYmICh0cmFuU3RhdHVzICE9\nIFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVEKSkKICAgICAgICAgICAgICAgIF9y\ndW50aW1lLnNldFJvbGxiYWNrT25seShjYXVzZSk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIF9sb2cudHJhY2UoX2xvYy5nZXQoImludmFsaWQtdHJhbi1zdGF0dXMiLCBu\nZXcgSW50ZWdlcigKICAgICAgICAgICAgICAgICAgICAgICAgdHJhblN0YXR1\ncyksICJzZXRSb2xsYmFja09ubHkiKSk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0U2F2ZXBvaW50KFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAg\nICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgX3NhdmVwb2ludHMuY29u\ndGFpbnNLZXkobmFtZSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgic2F2ZXBvaW50LWV4aXN0cyIsIG5hbWUp\nKTsKCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAh\nPSAwCiAgICAgICAgICAgICAgICAmJiAhX3NwbS5zdXBwb3J0c0luY3JlbWVu\ndGFsRmx1c2goKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgi\nc2F2ZXBvaW50LWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgICAg\nICBPcGVuSlBBU2F2ZXBvaW50IHNhdmUgPSBfc3BtLm5ld1NhdmVwb2ludChu\nYW1lLCB0aGlzKTsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51\nbGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAg\nICBzYXZlLnNhdmUoZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpKTsKICAgICAg\nICAgICAgICAgIF9zYXZlcG9pbnRzID0gbmV3IExpbmtlZE1hcCgpOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKF9zYXZlcG9p\nbnRDYWNoZSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNhdmUuc2F2\nZShDb2xsZWN0aW9ucy5FTVBUWV9TRVQpOwogICAgICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZS5zYXZlKF9zYXZlcG9pbnRD\nYWNoZSk7CiAgICAgICAgICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNs\nZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgX3NhdmVwb2ludHMucHV0KG5hbWUsIHNhdmUpOwogICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbGVhc2VTYXZlcG9pbnQo\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9z\nYXZlcG9pbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50Iikp\nOwogICAgICAgICAgICByZWxlYXNlU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZl\ncG9pbnRzLmdldAogICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUo\nKSAtIDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncmVsZWFzZVNhdmVwb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBp\nbnQgaW5kZXggPSAoX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAgICAg\nICAgICAgICAgOiBfc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7CiAg\nICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwg\nc2F2ZXBvaW50KSk7CgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2\nZXJzZQogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAg\nICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEp\nIHsKICAgICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkg\nX3NhdmVwb2ludHMucmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9zYXZl\ncG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5yZWxl\nYXNlKGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2ZSA9\nIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgp\nOwogICAgICAgICAgICBzYXZlLnJlbGVhc2UodHJ1ZSk7CiAgICAgICAgICAg\nIGlmIChfc2F2ZXBvaW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9zYXZlcG9pbnRDYWNoZS5jbGVhcigpOwogICAgICAgIH0gY2F0Y2ggKE9w\nZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoKSB7CiAg\nICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyA9PSBudWxsIHx8IF9zYXZlcG9p\nbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1sYXN0c2F2ZXBvaW50IikpOwogICAg\nICAgICAgICByb2xsYmFja1RvU2F2ZXBvaW50KChTdHJpbmcpIF9zYXZlcG9p\nbnRzLmdldAogICAgICAgICAgICAgICAgKF9zYXZlcG9pbnRzLnNpemUoKSAt\nIDEpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9s\nbGJhY2tUb1NhdmVwb2ludChTdHJpbmcgc2F2ZXBvaW50KSB7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CgogICAgICAgICAgICBp\nbnQgaW5kZXggPSAoX3NhdmVwb2ludHMgPT0gbnVsbCkgPyAtMQogICAgICAg\nICAgICAgICAgOiBfc2F2ZXBvaW50cy5pbmRleE9mKHNhdmVwb2ludCk7CiAg\nICAgICAgICAgIGlmIChpbmRleCA8IDApCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2F2ZXBvaW50Iiwg\nc2F2ZXBvaW50KSk7CgogICAgICAgICAgICAvLyBjbGVhciBvbGQgaW4gcmV2\nZXJzZQogICAgICAgICAgICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAg\nICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cy5zaXplKCkgPiBpbmRleCArIDEp\nIHsKICAgICAgICAgICAgICAgIHNhdmUgPSAoT3BlbkpQQVNhdmVwb2ludCkg\nX3NhdmVwb2ludHMucmVtb3ZlCiAgICAgICAgICAgICAgICAgICAgKF9zYXZl\ncG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgc2F2ZS5yZWxl\nYXNlKGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2F2ZSA9\nIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoaW5kZXgp\nOwogICAgICAgICAgICBDb2xsZWN0aW9uIHNhdmVkID0gc2F2ZS5yb2xsYmFj\nayhfc2F2ZXBvaW50cy52YWx1ZXMoKSk7CiAgICAgICAgICAgIGlmIChfc2F2\nZXBvaW50Q2FjaGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zYXZlcG9p\nbnRDYWNoZS5jbGVhcigpOwogICAgICAgICAgICBpZiAoaGFzVHJhbnNhY3Rp\nb25hbE9iamVjdHMoKSkgewogICAgICAgICAgICAgICAgLy8gYnVpbGQgdXAg\nYSBuZXcgY29sbGVjdGlvbiBvZiBzdGF0ZXMKICAgICAgICAgICAgICAgIFRy\nYW5zYWN0aW9uYWxDYWNoZSBvbGRUcmFuc0NhY2hlID0gX3RyYW5zQ2FjaGU7\nCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbmFsQ2FjaGUgbmV3VHJhbnND\nYWNoZSA9IG5ldyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICAgICAgICAg\nICAgICAoX29yZGVyRGlydHkpOwogICAgICAgICAgICAgICAgX3RyYW5zQ2Fj\naGUgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRseSB0aGVy\nZSBpcyB0aGUgYXNzdW1wdGlvbiB0aGF0IGluY3JlbWVudGFsCiAgICAgICAg\nICAgICAgICAvLyBmbHVzaCBpcyBlaXRoZXIgYSkgbm90IGFsbG93ZWQsIG9y\nIGIpIHJlcXVpcmVkCiAgICAgICAgICAgICAgICAvLyBwcmUtc2F2ZXBvaW50\nLiAgdGhpcyBzb2x2ZXMgYSBudW1iZXIgb2YgaXNzdWVzIGluY2x1ZGluZwog\nICAgICAgICAgICAgICAgLy8gc3RvcmluZyBmbHVzaGVkIHN0YXRlcyBhcyB3\nZWxsIGFzIE9JRCBoYW5kbGluZy4KICAgICAgICAgICAgICAgIC8vIGlmIGZ1\ndHVyZSBwbHVnaW5zIGRvIG5vdCBmb2xsb3cgdGhpcywgd2UgbmVlZCB0byBj\nYWNoZQogICAgICAgICAgICAgICAgLy8gbW9yZSBpbmZvIHBlciBzdGF0ZQog\nICAgICAgICAgICAgICAgU2F2ZXBvaW50RmllbGRNYW5hZ2VyIGZtOwogICAg\nICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc2F2ZWQuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAgICBmbSA9IChTYXZl\ncG9pbnRGaWVsZE1hbmFnZXIpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICAgICAgc20gPSBmbS5nZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAg\nICAgICAgICBzbS5yb2xsYmFja1RvU2F2ZXBvaW50KGZtKTsKICAgICAgICAg\nICAgICAgICAgICBvbGRUcmFuc0NhY2hlLnJlbW92ZShzbSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtLmlzRGlydHkoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3VHJhbnNDYWNoZS5hZGREaXJ0eShzbSk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBuZXdU\ncmFuc0NhY2hlLmFkZENsZWFuKHNtKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2xkVHJhbnNDYWNo\nZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2soKTsKICAgICAgICAgICAg\nICAgICAgICByZW1vdmVGcm9tVHJhbnNhY3Rpb24oc20pOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgb2xkVHJhbnNDYWNoZS5jbGVhcigp\nOwogICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXdUcmFuc0NhY2hl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBmbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyByZXR1\ncm4gc2lsZW50bHkgaWYgbm8gdHJhbnMgaXMgYWN0aXZlLCBvciBpZiB0aGlz\nIGlzIGEgcmVlbnRyYW50CiAgICAgICAgICAgIC8vIGNhbGwsIHdoaWNoIGNh\nbiBoYXBwZW4gaWYgdGhlIHN0b3JlIG1hbmFnZXIgdHJpZXMgdG8gZ2V0IGFu\nCiAgICAgICAgICAgIC8vIGF1dG8taW5jIG9pZCBkdXJpbmcgZmx1c2gKICAg\nICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMAogICAg\nICAgICAgICAgICAgfHwgKF9mbGFncyAmIEZMQUdfU1RPUkVfRkxVU0hJTkcp\nICE9IDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAv\nLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUgc3VwcG9ydHMgaXQKICAgICAgICAg\nICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRPcHRpb25zKCkuY29udGFpbnMoX2Nv\nbmYuT1BUSU9OX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAoImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7\nCiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2\nZXBvaW50cy5pc0VtcHR5KCkKICAgICAgICAgICAgICAgICYmICFfc3BtLnN1\ncHBvcnRzSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIp\nKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmbHVzaFNh\nZmUoRkxVU0hfSU5DKTsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFH\nX0ZMVVNIRUQ7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIG9uIGZsdXNo\nIGVycm9yOyBvYmplY3RzIG1heSBiZSBpbiBpbmNvbnNpc3RlbnQgc3RhdGUK\nICAgICAgICAgICAgICAgIHNldFJvbGxiYWNrT25seShrZSk7CiAgICAgICAg\nICAgICAgICB0aHJvdyBrZS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgLy8gcm9sbGJhY2sgb24gZmx1c2ggZXJyb3I7IG9iamVjdHMgbWF5IGJl\nIGluIGluY29uc2lzdGVudCBzdGF0ZQogICAgICAgICAgICAgICAgc2V0Um9s\nbGJhY2tPbmx5KHJlKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9y\nZUV4Y2VwdGlvbihyZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncmVGbHVzaCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNU\nSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX0xP\nR0lDQUwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB2\nYWxpZGF0ZUNoYW5nZXMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgbm8gdHJhbnMs\nIGp1c3QgcmV0dXJuOyBpZiBhY3RpdmUgZGF0YXN0b3JlIHRyYW5zLCBmbHVz\naAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAw\nKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwKSB7CiAgICAgICAgICAg\nICAgICBmbHVzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIHJ1bnRpbWUg\nc3VwcG9ydHMgaW5jIGZsdXNoCiAgICAgICAgICAgIGlmICghX2NvbmYuc3Vw\ncG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zKF9jb25mLk9QVElPTl9JTkNfRkxV\nU0gpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhj\nZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJpbmNyZW1l\nbnRhbC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVTSF9ST0xMQkFDSyk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgU3RvcmVFeGNlcHRpb24ocmUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNB\nY3RpdmUoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0FD\nVElWRSkgIT0gMDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNTdG9yZUFjdGl2ZSgpIHsKICAgICAgICAvLyB3ZSBuZWVkIHRv\nIGxvY2sgaGVyZSwgYmVjYXVzZSB3ZSBtaWdodCBiZSBpbiB0aGUgbWlkZGxl\nIG9mIGFuCiAgICAgICAgLy8gYXRvbWljIHRyYW5zYWN0aW9uIHByb2Nlc3Mg\nKGUuZy4sIGNvbW1pdEFuZFJlc3VtZSkKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBjdXJy\nZW50IHRyYW5zYWN0aW9uIGlzIGVuZGluZywgaS5lLiBpbiB0aGUgMm5kIHBo\nYXNlCiAgICAgKiBvZiBhIGNvbW1pdCBvciByb2xsYmFjawogICAgICovCiAg\nICBib29sZWFuIGlzVHJhbnNhY3Rpb25FbmRpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBGTEFHX1RSQU5TX0VORElORykgIT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBiZWdpbk9wZXJhdGlvbihib29sZWFuIHN5\nbmNUcmFucykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgICAgICBpZiAoc3luY1Ry\nYW5zICYmIF9vcGVyYXRpb25Db3VudCA9PSAwICYmIF9zeW5jTWFuYWdlZAog\nICAgICAgICAgICAgICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAw\nKQogICAgICAgICAgICAgICAgc3luY1dpdGhNYW5hZ2VkVHJhbnNhY3Rpb24o\nKTsKICAgICAgICAgICAgcmV0dXJuIF9vcGVyYXRpb25Db3VudCsrID09IDE7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1h\ncmsgdGhlIG9wZXJhdGlvbiBvdmVyLiBJZiBvdXRlcm1vc3QgY2FsbGVyIG9m\nIHN0YWNrLCByZXR1cm5zIHRydWUKICAgICAqIGFuZCB3aWxsIGRldGFjaCBt\nYW5hZ2VkIGluc3RhbmNlcyBpZiBuZWNlc3NhcnkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGVuZE9wZXJhdGlvbigpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDEgJiYgKF9hdXRv\nRGV0YWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMAogICAgICAgICAgICAg\nICAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKSB7CiAgICAgICAg\nICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxsKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50IDwgMSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdl\ndCgibXVsdGktdGhyZWFkZWQtYWNjZXNzIikpOwogICAgICAgICAgICByZXR1\ncm4gX29wZXJhdGlvbkNvdW50ID09IDE7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBfb3BlcmF0aW9uQ291bnQtLTsKICAg\nICAgICAgICAgaWYgKF9vcGVyYXRpb25Db3VudCA9PSAwKQogICAgICAgICAg\nICAgICAgX29wZXJhdGluZy5jbGVhcigpOwogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN5bmNocm9uaXphdGlv\nbiBnZXRTeW5jaHJvbml6YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9zeW5j\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFN5bmNocm9uaXphdGlvbihT\neW5jaHJvbml6YXRpb24gc3luYykgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBfc3luYyA9IHN5bmM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIElt\ncGxlbWVudGF0aW9uIG9mIFN5bmNocm9uaXphdGlvbiBpbnRlcmZhY2UKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgcHVibGljIHZvaWQgYmVmb3JlQ29tcGxldGlvbigpIHsKICAg\nICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gdXNlci1zdXBwbGllZCBzeW5jaHJvbml6YXRpb24KICAg\nICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc3luYy5iZWZvcmVDb21wbGV0aW9uKCk7CgogICAgICAgICAgICBmbHVzaFNh\nZmUoRkxVU0hfQ09NTUlUKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJl\nbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAgICB0aHJvdyB0cmFu\nc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlvbihrZSk7CiAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICBp\nZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiksIHJlKTsKICAg\nICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBsZXRpb25FeGNl\ncHRpb24obmV3IFN0b3JlRXhjZXB0aW9uKHJlKSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGFmdGVyQ29tcGxldGlvbihpbnQgc3Rh\ndHVzKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7\nCgogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19UUkFOU19FTkRJTkc7CiAg\nICAgICAgICAgIGVuZFRyYW5zYWN0aW9uKHN0YXR1cyk7CiAgICAgICAgICAg\nIGlmIChfc3luYyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N5bmMuYWZ0\nZXJDb21wbGV0aW9uKHN0YXR1cyk7CgogICAgICAgICAgICBpZiAoKF9hdXRv\nRGV0YWNoICYgREVUQUNIX0NPTU1JVCkgIT0gMCkKICAgICAgICAgICAgICAg\nIGRldGFjaEFsbEludGVybmFsKG51bGwpOwogICAgICAgICAgICBlbHNlIGlm\nIChzdGF0dXMgPT0gU3RhdHVzLlNUQVRVU19ST0xMRURCQUNLIAogICAgICAg\nICAgICAgICAgJiYgKF9hdXRvRGV0YWNoICYgREVUQUNIX1JPTExCQUNLKSAh\nPSAwKSB7CiAgICAgICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChudWxs\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaW4gYW4gZWUgY29u\ndGV4dCwgaXQncyBwb3NzaWJsZSB0aGF0IHRoZSB1c2VyIHRyaWVkIHRvIGNs\nb3NlCiAgICAgICAgICAgIC8vIHVzIGJ1dCB3ZSBkaWRuJ3QgYWN0dWFsbHkg\nY2xvc2UgYmVjYXVzZSB3ZSB3ZXJlIHdhaXRpbmcgb24gdGhpcwogICAgICAg\nICAgICAvLyB0cmFuc2FjdGlvbjsgaWYgdGhhdCdzIHRydWUsIHRoZW4gY2xv\nc2Ugbm93CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19DTE9TRV9J\nTlZPS0VEKSAhPSAwCiAgICAgICAgICAgICAgICAmJiBfY29tcGF0LmdldENs\nb3NlT25NYW5hZ2VkQ29tbWl0KCkpCiAgICAgICAgICAgICAgICBmcmVlKCk7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9yIiks\nIGtlKTsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlTWFuYWdlZENvbXBs\nZXRpb25FeGNlcHRpb24oa2UpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQo\nImVuZC10cmFucy1lcnJvciIpLCByZSk7CiAgICAgICAgICAgIHRocm93IHRy\nYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKG5ldyBTdG9yZUV4\nY2VwdGlvbihyZSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9mbGFncyAmPSB+RkxBR19BQ1RJVkU7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nVFJBTlNfRU5ESU5HOwoKICAgICAgICAgICAgLy8gZXZlbnQgbWFuYWdlciBu\ndWxsZWQgaWYgZnJlZWQgYnJva2VyCiAgICAgICAgICAgIGlmIChfdHJhbnNF\ndmVudE1hbmFnZXIgIT0gbnVsbCAKICAgICAgICAgICAgICAgICYmIF90cmFu\nc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAgICAgICAg\nICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZl\nbnQodGhpcywKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPT0gU3RhdHVz\nLlNUQVRVU19DT01NSVRURUQKICAgICAgICAgICAgICAgICAgICAgICAgPyBU\ncmFuc2FjdGlvbkV2ZW50LkFGVEVSX0NPTU1JVF9DT01QTEVURQogICAgICAg\nICAgICAgICAgICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfUk9M\nTEJBQ0tfQ09NUExFVEUsCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVs\nbCwgbnVsbCwgbnVsbCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJZiB3ZSdyZSBpbiBhIG1hbmFnZWQgdHJhbnNhY3Rpb24sIHVzZSBvdXIg\naW1wbGljaXQgYmVoYXZpb3IgZXhjZXB0aW9uCiAgICAgKiB0cmFuc2xhdG9y\nIHRvIHRyYW5zbGF0ZSBiZWZvcmUvYWZ0ZXJDb21wbGV0aW9uIGNhbGxiYWNr\nIGVycm9ycy4KICAgICAqLwogICAgcHJpdmF0ZSBSdW50aW1lRXhjZXB0aW9u\nIHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uCiAgICAgICAg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICByZXR1cm4gKCFfbWFu\nYWdlZCB8fCBfZXh0cmFucyA9PSBudWxsKSA/IHJlIDogX2V4dHJhbnMudHJh\nbnNsYXRlKHJlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHNhZmVs\neSwgY2F0Y2hpbmcgcmVlbnRyYW50IGNhbGxzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZmx1c2hTYWZlKGludCByZWFzb24pIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfRkxVU0hJTkcpICE9IDApCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlZW50\ncmFudC1mbHVzaCIpKTsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hJ\nTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmx1c2gocmVhc29uKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfRkxVU0hJTkc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nRmx1c2ggdGhlIHRyYW5zYWN0aW9uYWwgc3RhdGUgdG8gdGhlIGRhdGEgc3Rv\ncmUuIFN1YmNsYXNzZXMgdGhhdAogICAgICogY3VzdG9taXplIGNvbW1pdCBi\nZWhhdmlvciBzaG91bGQgb3ZlcnJpZGUgdGhpcyBtZXRob2QuIFRoZSBtZXRo\nb2QKICAgICAqIGFzc3VtZXMgdGhhdCB0aGUgcGVyc2lzdGVuY2UgbWFuYWdl\nciBpcyBsb2NrZWQsIGlzIG5vdCBjbG9zZWQsCiAgICAgKiBhbmQgaGFzIGFu\nIGFjdGl2ZSB0cmFuc2FjdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gcmVh\nc29uIG9uZSBvZiB7QGxpbmsgI0ZMVVNIX0lOQ30sIHtAbGluayAjRkxVU0hf\nQ09NTUlUfSwKICAgICAqIHtAbGluayAjRkxVU0hfUk9MTEJBQ0t9LCBvciB7\nQGxpbmsgI0ZMVVNIX0xPR0lDQUx9CiAgICAgKiBAc2luY2UgMC4yLjUKICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZmx1c2goaW50IHJlYXNvbikgewog\nICAgICAgIC8vIHRoaXMgd2lsbCBlbmxpc3QgcHJveGllZCBzdGF0ZXMgYXMg\nbmVjZXNzYXJ5IHNvIHdlIGtub3cgd2hldGhlciB3ZQogICAgICAgIC8vIGhh\ndmUgYW55dGhpbmcgdG8gZmx1c2gKICAgICAgICBDb2xsZWN0aW9uIHRyYW5z\nYWN0aW9uYWwgPSBnZXRUcmFuc2FjdGlvbmFsU3RhdGVzKCk7CgogICAgICAg\nIC8vIGRvIHdlIGFjdHVhbGx5IGhhdmUgdG8gZmx1c2g/ICBvbmx5IGlmIG91\nciBmbGFncyBzYXkgc28sIG9yIGlmCiAgICAgICAgLy8gd2UgaGF2ZSB0cmFu\nc2FjdGlvbiBsaXN0ZW5lcnMgdGhhdCBuZWVkIHRvIGJlIGludm9rZWQgZm9y\nIGNvbW1pdAogICAgICAgIC8vIChubyBuZWVkIHRvIGludm9rZSB0aGVtIG9u\nIGluYyBmbHVzaCBpZiBub3RoaW5nIGlzIGRpcnR5KS4gIHdlCiAgICAgICAg\nLy8gc3BlY2lhbCBjYXNlIHRoZSByZW1vdGUgY29tbWl0IGxpc3RlbmVyIHVz\nZWQgYnkgdGhlIGRhdGFjYWNoZSBjYXVzZQogICAgICAgIC8vIHdlIGtub3cg\naXQgZG9lc24ndCByZXF1aXJlIHRoZSBjb21taXQgZXZlbnQgd2hlbiBub3Ro\naW5nIGNoYW5nZXMKICAgICAgICBib29sZWFuIGZsdXNoID0gKF9mbGFncyAm\nIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7CiAgICAgICAgYm9vbGVhbiBs\naXN0ZW5lcnMgPSAoX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVu\nZXJzKCkKICAgICAgICAgICAgfHwgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0Vu\nZExpc3RlbmVycygpKQogICAgICAgICAgICAmJiAoKF9mbGFncyAmIEZMQUdf\nUkVNT1RFX0xJU1RFTkVSKSA9PSAwCiAgICAgICAgICAgIHx8IF90cmFuc0V2\nZW50TWFuYWdlci5nZXRMaXN0ZW5lcnMoKS5zaXplKCkgPiAxKTsKICAgICAg\nICBpZiAoIWZsdXNoICYmIChyZWFzb24gIT0gRkxVU0hfQ09NTUlUIHx8ICFs\naXN0ZW5lcnMpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENvbGxl\nY3Rpb24gbW9ianMgPSBudWxsOwogICAgICAgIF9mbGFncyB8PSBGTEFHX1BS\nRVNUT1JJTkc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGZsdXNo\nKSB7CiAgICAgICAgICAgICAgICAvLyBjYWxsIHByZSBzdG9yZSBvbiBhbGwg\nY3VycmVudGx5IHRyYW5zYWN0aW9uYWwgb2JqcwogICAgICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSB0cmFuc2FjdGlvbmFsLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgICAgICgoU3RhdGVN\nYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuYmVmb3JlRmx1c2gocmVhc29uLCBf\nY2FsbCk7CiAgICAgICAgICAgICAgICBmbHVzaEFkZGl0aW9ucyh0cmFuc2Fj\ndGlvbmFsLCByZWFzb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBob3BlZnVsbHkgbm93IGFsbCBkZXBlbmRlbnQgaW5zdGFuY2VzIHRoYXQg\nYXJlIGdvaW5nIHRvIGVuZAogICAgICAgICAgICAvLyB1cCByZWZlcmVuY2Vk\nIGhhdmUgYmVlbiBtYXJrZWQgYXMgc3VjaDsgZGVsZXRlIHVucmVmZWQKICAg\nICAgICAgICAgLy8gZGVwZW5kZW50cwogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19ERVJFRkRFTEVUSU5HOwogICAgICAgICAgICBpZiAoZmx1c2ggJiYg\nX2RlcmVmQ2FjaGUgIT0gbnVsbCAmJiAhX2RlcmVmQ2FjaGUuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9kZXJl\nZkNhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAg\nICAgICAgICAgIGRlbGV0ZURlcmVmKChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIu\nbmV4dCgpKTsKICAgICAgICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5z\nYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkgewogICAgICAgICAgICAg\nICAgLy8gaWYgbm8gZGF0YXN0b3JlIHRyYW5zYWN0aW9uLCBzdGFydCBvbmU7\nIGV2ZW4gaWYgd2UgZG9uJ3QKICAgICAgICAgICAgICAgIC8vIHRoaW5rIHdl\nJ2xsIG5lZWQgdG8gZmx1c2ggYXQgdGhpcyBwb2ludCwgb3VyIHRyYW5zYWN0\naW9uCiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5lcnMgbWlnaHQgaW50cm9k\ndWNlIHNvbWUgZGlydHkgb2JqZWN0cyBvciBpbnRlcmFjdAogICAgICAgICAg\nICAgICAgLy8gZGlyZWN0bHkgd2l0aCB0aGUgZGF0YWJhc2UKICAgICAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2Fj\ndGlvbihmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKChfdHJhbnNFdmVu\ndE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQogICAgICAgICAgICAgICAg\nICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkK\nICAgICAgICAgICAgICAgICAgICAmJiAoZmx1c2ggfHwgcmVhc29uID09IEZM\nVVNIX0NPTU1JVCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBmaXJlIGV2\nZW50cwogICAgICAgICAgICAgICAgICAgIG1vYmpzID0gbmV3IE1hbmFnZWRP\nYmplY3RDb2xsZWN0aW9uKHRyYW5zYWN0aW9uYWwpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfQ09NTUlUCiAgICAgICAgICAg\nICAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0\nZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaXJlVHJhbnNh\nY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0aGlzLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQuQkVGT1JF\nX0NPTU1JVCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBf\ncGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsK\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoQWRkaXRpb25zKHRyYW5z\nYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlSRUQpICE9IDA7CiAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAo\nZmx1c2ggJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJz\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9u\nRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkJFRk9SRV9GTFVT\nSCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGVyc2lz\ndGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENsc3MpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnModHJhbnNhY3Rpb25h\nbCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVTVE9SSU5HOwog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVSRUZERUxFVElORzsKICAg\nICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbnVsbDsKICAgICAgICAgICAg\nX2RlcmVmQWRkaXRpb25zID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGFsc28g\nY2xlYXIgZGVyZWZlZCBzZXQ7IHRoZSBkZWxldGVzIGhhdmUgYmVlbiByZWNv\ncmRlZAogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9kZXJlZkNhY2hlLmNsZWFyKCk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBmbHVzaCB0byBzdG9yZSBtYW5hZ2VyCiAgICAgICAgTGlz\ndCBleGNlcHMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkgewogICAgICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU1RPUkVfRkxVU0hJTkc7CiAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAgICAgICAgICAg\nICAgICAgIG5ld0ZsdXNoRXhjZXB0aW9uKF9zdG9yZS5mbHVzaCh0cmFuc2Fj\ndGlvbmFsKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NUT1JFX0ZMVVNISU5HOwoK\nICAgICAgICAgICAgaWYgKHJlYXNvbiA9PSBGTFVTSF9ST0xMQkFDSykKICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGVuZFN0b3JlTWFu\nYWdlclRyYW5zYWN0aW9uKHRydWUpKTsKICAgICAgICAgICAgZWxzZSBpZiAo\ncmVhc29uICE9IEZMVVNIX0xPR0lDQUwpCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfRkxVU0hfUkVRVUlSRUQ7CgogICAgICAgICAgICAvLyBt\nYXJrIHN0YXRlcyBhcyBmbHVzaGVkCiAgICAgICAgICAgIGlmIChmbHVzaCkg\newogICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNhY3Rpb25hbC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gdGhlIHN0YXRlIG1heSBoYXZlIGJlY29tZSB0cmFuc2llbnQsIHN1Y2gg\nYXMgaWYKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgaXMgZW1iZWRk\nZWQgYW5kIHRoZSBvd25lciBoYXMgYmVlbiBkZWxldGVkIGR1cmluZwogICAg\nICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZsdXNoIHByb2Nlc3M7IGJ1\nZyAjMTEwMAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uZ2V0UENT\ndGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAg\nICBzbS5hZnRlckZsdXNoKHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChyZWFzb24gPT0gRkxVU0hfSU5DKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAvLyBpZiBub3QgYWJvdXQgdG8gY2xlYXIgdHJhbnMg\nY2FjaGUgZm9yIGNvbW1pdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGFueXdheSwgcmUtY2FjaGUgZGlydHkgb2JqZWN0cyB3aXRoIGRlZmF1\nbHQgc29mdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVmczsg\nd2UgZG9uJ3QgbmVlZCBoYXJkIHJlZnMgbm93IHRoYXQgdGhlIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlcyBoYXZlIGJlZW4gZmx1\nc2hlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20ucHJveHlGaWVs\nZHModHJ1ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nX3RyYW5zQ2FjaGUuZmx1c2hlZChzbSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHRocm93\nIGFueSBleGNlcHRpb25zIHRvIHNob3J0Y3V0IGxpc3RlbmVycyBvbiBmYWls\nCiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgdHJ1ZSk7\nCgogICAgICAgIGlmIChmbHVzaCAmJiByZWFzb24gIT0gRkxVU0hfUk9MTEJB\nQ0sgJiYgcmVhc29uICE9IEZMVVNIX0xPR0lDQUwKICAgICAgICAgICAgJiYg\nX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0ZsdXNoTGlzdGVuZXJzKCkpIHsKICAg\nICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9u\nRXZlbnQodGhpcywKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRXZlbnQu\nQUZURVJfRkxVU0gsIG1vYmpzLCBfcGVyc2lzdGVkQ2xzcywKICAgICAgICAg\nICAgICAgIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRDbHNzKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggbmV3bHktdHJhbnNhY3Rp\nb25hbCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZmx1c2hB\nZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFuc2FjdGlvbmFsLCBpbnQgcmVhc29u\nKSB7CiAgICAgICAgYm9vbGVhbiBsb29wOwogICAgICAgIGRvIHsKICAgICAg\nICAgICAgLy8gZmx1c2ggbmV3IHRyYW5zYWN0aW9uYWwgaW5zdGFuY2VzOyBu\nb3RlIGxvZ2ljYWwgb3IKICAgICAgICAgICAgbG9vcCA9IGZsdXNoVHJhbnNB\nZGRpdGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKQogICAgICAgICAgICAg\nICAgfCBkZWxldGVEZXJlZkFkZGl0aW9ucyhfZGVyZWZDYWNoZSk7CiAgICAg\nICAgfSB3aGlsZSAobG9vcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbHVz\naCB0cmFuc2FjdGlvbmFsIGFkZGl0aW9ucy4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIGZsdXNoVHJhbnNBZGRpdGlvbnMoQ29sbGVjdGlvbiB0cmFu\nc2FjdGlvbmFsLCBpbnQgcmVhc29uKSB7CiAgICAgICAgaWYgKF90cmFuc0Fk\nZGl0aW9ucyA9PSBudWxsIHx8IF90cmFuc0FkZGl0aW9ucy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8ga2VlcCBs\nb2NhbCB0cmFuc2FjdGlvbmFsIGxpc3QgY29weSB1cCB0byBkYXRlCiAgICAg\nICAgdHJhbnNhY3Rpb25hbC5hZGRBbGwoX3RyYW5zQWRkaXRpb25zKTsKCiAg\nICAgICAgLy8gY29weSB0aGUgY2hhbmdlIHNldCwgdGhlbiBjbGVhciBpdCBm\nb3IgdGhlIG5leHQgaXRlcmF0aW9uCiAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbFtdIHN0YXRlcyA9IChTdGF0ZU1hbmFnZXJJbXBsW10pIF90cmFuc0FkZGl0\naW9ucy4KICAgICAgICAgICAgdG9BcnJheShuZXcgU3RhdGVNYW5hZ2VySW1w\nbFtfdHJhbnNBZGRpdGlvbnMuc2l6ZSgpXSk7CiAgICAgICAgX3RyYW5zQWRk\naXRpb25zLmNsZWFyKCk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc3RhdGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBzdGF0ZXNbaV0uYmVm\nb3JlRmx1c2gocmVhc29uLCBfY2FsbCk7CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgbmV3IGRlcmVmZXJlbmNl\nZCBvYmplY3RzLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gZGVsZXRl\nRGVyZWZBZGRpdGlvbnMoQ29sbGVjdGlvbiBkZXJlZnMpIHsKICAgICAgICBp\nZiAoX2RlcmVmQWRkaXRpb25zID09IG51bGwgfHwgX2RlcmVmQWRkaXRpb25z\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICAvLyByZW1lbWJlciB0aGVzZSBhZGRpdGlvbnMgaW4gY2FzZSBvbmUgYmVj\nb21lcyBkZXJlZmVkIGFnYWluIGxhdGVyCiAgICAgICAgZGVyZWZzLmFkZEFs\nbChfZGVyZWZBZGRpdGlvbnMpOwoKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nW10gc3RhdGVzID0gKFN0YXRlTWFuYWdlckltcGxbXSkgX2RlcmVmQWRkaXRp\nb25zLgogICAgICAgICAgICB0b0FycmF5KG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nW19kZXJlZkFkZGl0aW9ucy5zaXplKCldKTsKICAgICAgICBfZGVyZWZBZGRp\ndGlvbnMuY2xlYXIoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ndGF0ZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGRlbGV0ZURlcmVmKHN0\nYXRlc1tpXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZWxldGUgYSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgZGVsZXRlRGVyZWYoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1l\nbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLAogICAgICAgICAgICBzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSwgc20sIG51bGwpOwogICAgICAgIGlmICgoYWN0\naW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCkKICAgICAgICAgICAg\nc20uZGVsZXRlKCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNr\ncy5BQ1RfQ0FTQ0FERSkgIT0gMCkKICAgICAgICAgICAgc20uY2FzY2FkZURl\nbGV0ZShfY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUg\ndGhlIGFjdGlvbiB0byB0YWtlIGJhc2VkIG9uIHRoZSB1c2VyJ3MgZ2l2ZW4g\nY2FsbGJhY2tzIGFuZAogICAgICogb3VyIGltcGxpY2l0IGJlaGF2aW9yLgog\nICAgICovCiAgICBwcml2YXRlIGludCBwcm9jZXNzQXJndW1lbnQoaW50IG9w\nLCBPYmplY3Qgb2JqLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoY2FsbCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzQXJndW1lbnQob3As\nIG9iaiwgc20pOwogICAgICAgIGlmIChfY2FsbCAhPSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gX2NhbGwucHJvY2Vzc0FyZ3VtZW50KG9wLCBvYmosIHNt\nKTsKICAgICAgICByZXR1cm4gT3BDYWxsYmFja3MuQUNUX1JVTiB8IE9wQ2Fs\nbGJhY2tzLkFDVF9DQVNDQURFOwogICAgfQoKICAgIC8qKgogICAgICogVGhy\nb3cgdGhlIHByb3BlciBleGNlcHRpb24gYmFzZWQgb24gdGhlIGdpdmVuIHNl\ndCBvZiBmbHVzaCBlcnJvcnMsIG9yCiAgICAgKiBkbyBub3RoaW5nIGlmIG5v\nIGVycm9ycyBvY2N1cnJlZC4KICAgICAqLwogICAgcHJpdmF0ZSBPcGVuSlBB\nRXhjZXB0aW9uIG5ld0ZsdXNoRXhjZXB0aW9uKENvbGxlY3Rpb24gZXhjZXBz\nKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9PSBudWxsIHx8IGV4Y2Vwcy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBUaHJv\nd2FibGVbXSB0ID0gKFRocm93YWJsZVtdKSBleGNlcHMudG9BcnJheQogICAg\nICAgICAgICAobmV3IFRocm93YWJsZVtleGNlcHMuc2l6ZSgpXSk7CiAgICAg\nICAgTGlzdCBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0KHQubGVuZ3RoKTsKCiAg\nICAgICAgLy8gY3JlYXRlIGZhdGFsIGV4Y2VwdGlvbiB3aXRoIG5lc3RlZCBl\neGNlcHRpb25zIGZvciBhbGwgdGhlIGZhaWxlZAogICAgICAgIC8vIG9iamVj\ndHM7IGlmIGFsbCBPTCBleGNlcHRpb25zLCB0aHJvdyBhIHRvcC1sZXZlbCBP\nTCBleGNlcHRpb24KICAgICAgICBib29sZWFuIG9wdCA9IHRydWU7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IG9wdCAmJiBpIDwgdC5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICBvcHQgPSB0W2ldIGluc3RhbmNlb2YgT3B0aW1pc3Rp\nY0V4Y2VwdGlvbjsKICAgICAgICAgICAgaWYgKG9wdCkgewogICAgICAgICAg\nICAgICAgT2JqZWN0IGYgPSAoKE9wdGltaXN0aWNFeGNlcHRpb24pIHRbaV0p\nLmdldEZhaWxlZE9iamVjdCgpOwogICAgICAgICAgICAgICAgaWYgKGYgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBmYWlsZWQuYWRkKGYpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHQgJiYgIWZhaWxl\nZC5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3Rp\nY0V4Y2VwdGlvbihmYWlsZWQsIHQpOwogICAgICAgIGlmIChvcHQpCiAgICAg\nICAgICAgIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbih0KTsKICAg\nICAgICByZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyb2xs\nZWQtYmFjayIpKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyh0\nKS5zZXRGYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZCB0\naGUgY3VycmVudCB0cmFuc2FjdGlvbiwgbWFraW5nIGFwcHJvcHJpYXRlIHN0\nYXRlIHRyYW5zaXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBl\nbmRUcmFuc2FjdGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgLy8gaWYgYSBk\nYXRhIHN0b3JlIHRyYW5zYWN0aW9uIHdhcyBpbiBwcm9ncmVzcywgZG8gdGhl\nCiAgICAgICAgLy8gYXBwcm9wcmlhdGUgdHJhbnNhY3Rpb24gY2hhbmdlCiAg\nICAgICAgYm9vbGVhbiByb2xsYmFjayA9IHN0YXR1cyAhPSBTdGF0dXMuU1RB\nVFVTX0NPTU1JVFRFRDsKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIGVuZFN0b3JlTWFuYWdlclRyYW5zYWN0aW9uKHJvbGxiYWNrKSk7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICByb2xsYmFjayA9IHRydWU7CiAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChl\neGNlcHMsIHJlKTsKICAgICAgICB9CgogICAgICAgIC8vIGdvIGJhY2sgdG8g\nZGVmYXVsdCBub25lIGxvY2sgbGV2ZWwKICAgICAgICBfZmMuc2V0UmVhZExv\nY2tMZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9mYy5zZXRXcml0ZUxvY2tM\nZXZlbChMT0NLX05PTkUpOwogICAgICAgIF9mYy5zZXRMb2NrVGltZW91dCgt\nMSk7CgogICAgICAgIENvbGxlY3Rpb24gdHJhbnNTdGF0ZXM7CiAgICAgICAg\naWYgKGhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgIHRy\nYW5zU3RhdGVzID0gX3RyYW5zQ2FjaGU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICB0cmFuc1N0YXRlcyA9IENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKCiAg\nICAgICAgLy8gZmlyZSBhZnRlciByb2xsYmFjay9jb21taXQgZXZlbnQKICAg\nICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsKICAgICAgICBpZiAoX3Ry\nYW5zRXZlbnRNYW5hZ2VyLmhhc0VuZExpc3RlbmVycygpKSB7CiAgICAgICAg\nICAgIG1vYmpzID0gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5z\nU3RhdGVzKTsKICAgICAgICAgICAgaW50IGV2ZW50VHlwZSA9IChyb2xsYmFj\naykgPyBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX1JPTExCQUNLCiAgICAgICAg\nICAgICAgICA6IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfQ09NTUlUOwogICAg\nICAgICAgICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25F\ndmVudCh0aGlzLCBldmVudFR5cGUsIG1vYmpzLCAKICAgICAgICAgICAgICAg\nIF9wZXJzaXN0ZWRDbHNzLCBfdXBkYXRlZENsc3MsIF9kZWxldGVkQ2xzcykp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCB0cmFuc2FjdGlvbmFsIGNh\nY2hlcyBub3cgc28gdGhhdCBhbGwgdGhlIHJlbW92ZUZyb21UcmFuc2FjdGlv\nbgogICAgICAgIC8vIGNhbGxzIGFzIHdlIHRyYW5zaXRpb24gZWFjaCBvYmpl\nY3QgZG9uJ3QgaGF2ZSB0byBkbyBhbnkgd29yazsgZG9uJ3QKICAgICAgICAv\nLyBjbGVhciB0cmFucyBjYWNoZSBvYmplY3QgYmVjYXVzZSB3ZSBzdGlsbCBu\nZWVkIHRoZSB0cmFuc1N0YXRlcwogICAgICAgIC8vIHJlZmVyZW5jZSB0byBp\ndCBiZWxvdwogICAgICAgIF90cmFuc0NhY2hlID0gbnVsbDsKICAgICAgICBp\nZiAoX3BlcnNpc3RlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAgX3BlcnNp\nc3RlZENsc3MuY2xlYXIoKTsKICAgICAgICBpZiAoX3VwZGF0ZWRDbHNzICE9\nIG51bGwpCiAgICAgICAgICAgIF91cGRhdGVkQ2xzcy5jbGVhcigpOwogICAg\nICAgIGlmIChfZGVsZXRlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAgX2Rl\nbGV0ZWRDbHNzLmNsZWFyKCk7CgogICAgICAgIC8vIG5ldyBjYWNoZSB3b3Vs\nZCBnZXQgY2xlYXJlZCBhbnl3YXkgZHVyaW5nIHRyYW5zaXRpb25zLCBidXQg\nZG9pbmcgc28KICAgICAgICAvLyBpbW1lZGlhdGVseSBzYXZlcyB1cyBzb21l\nIGxvb2t1cHMKICAgICAgICBfY2FjaGUuY2xlYXJOZXcoKTsKCiAgICAgICAg\nLy8gdGVsbCBhbGwgZGVyZWZlZCBpbnN0YW5jZXMgdGhleSdyZSBubyBsb25n\nZXIgZGVyZWZlZDsgd2UgY2FuJ3QKICAgICAgICAvLyByZWx5IG9uIHJvbGxi\nYWNrIGFuZCBjb21taXQgY2FsbHMgYmVsb3cgY2F1c2Ugc29tZSBpbnN0YW5j\nZXMgbWlnaHQKICAgICAgICAvLyBub3QgYmUgdHJhbnNhY3Rpb25hbAogICAg\nICAgIGlmIChfZGVyZWZDYWNoZSAhPSBudWxsICYmICFfZGVyZWZDYWNoZS5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBf\nZGVyZWZDYWNoZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKSkuc2V0\nRGVyZWZlcmVuY2VkRGVwZW5kZW50CiAgICAgICAgICAgICAgICAgICAgKGZh\nbHNlLCBmYWxzZSk7CiAgICAgICAgICAgIF9kZXJlZkNhY2hlLmNsZWFyKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBwZWZvcm0gY29tbWl0IG9yIHJvbGxi\nYWNrIHN0YXRlIHRyYW5zaXRpb25zIG9uIGVhY2ggaW5zdGFuY2UKICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gdHJhbnNTdGF0ZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChy\nb2xsYmFjaykgewogICAgICAgICAgICAgICAgICAgIC8vIHRlbGwgb2JqZWN0\ncyB0aGF0IG1heSBoYXZlIGJlZW4gZGVyZWZlZCB0aGVuIGZsdXNoZWQKICAg\nICAgICAgICAgICAgICAgICAvLyAoYW5kIHRoZXJlZm9yZSBkZWxldGVkKSB0\nbyB1bi1kZXJlZgogICAgICAgICAgICAgICAgICAgIHNtLnNldERlcmVmZXJl\nbmNlZERlcGVuZGVudChmYWxzZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIHNtLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgICAgICAgICBzbS5jb21taXQoKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAgICAg\nZXhjZXBzID0gYWRkKGV4Y2VwcywgcmUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBub3RpZnkgdGhlIGxvY2sgbWFuYWdlciB0byBj\nbGVhbiB1cCBhbmQgcmVsZWFzZSByZW1haW5pbmcgbG9ja3MKICAgICAgICBf\nbG0uZW5kVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgLy8gY2xlYXIgb2xkIHNh\ndmVwb2ludHMgaW4gcmV2ZXJzZQogICAgICAgIE9wZW5KUEFTYXZlcG9pbnQg\nc2F2ZTsKICAgICAgICB3aGlsZSAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiBf\nc2F2ZXBvaW50cy5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgIHNhdmUgPQog\nICAgICAgICAgICAgICAgKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRz\nLnJlbW92ZShfc2F2ZXBvaW50cy5zaXplKCkgLSAxKTsKICAgICAgICAgICAg\nc2F2ZS5yZWxlYXNlKGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgX3NhdmVw\nb2ludHMgPSBudWxsOwogICAgICAgIF9zYXZlcG9pbnRDYWNoZSA9IG51bGw7\nCgogICAgICAgIC8vIGZpcmUgYWZ0ZXIgc3RhdGUgY2hhbmdlIGV2ZW50CiAg\nICAgICAgaWYgKF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMo\nKSkKICAgICAgICAgICAgZmlyZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5z\nYWN0aW9uRXZlbnQodGhpcywgVHJhbnNhY3Rpb25FdmVudC4KICAgICAgICAg\nICAgICAgIEFGVEVSX1NUQVRFX1RSQU5TSVRJT05TLCBtb2JqcywgbnVsbCwg\nbnVsbCwgbnVsbCkpOwoKICAgICAgICAvLyBub3cgY2xlYXIgdHJhbnMgY2Fj\naGU7IGtlZXAgY2xlYXJlZCB2ZXJzaW9uIHJhdGhlciB0aGFuCiAgICAgICAg\nLy8gbnVsbCB0byBhdm9pZCBoYXZpbmcgdG8gcmUtY3JlYXRlIHRoZSBzZXQg\nbGF0ZXI7IG1vcmUgZWZmaWNpZW50CiAgICAgICAgaWYgKHRyYW5zU3RhdGVz\nICE9IENvbGxlY3Rpb25zLkVNUFRZX1NFVCkgewogICAgICAgICAgICBfdHJh\nbnNDYWNoZSA9IChUcmFuc2FjdGlvbmFsQ2FjaGUpIHRyYW5zU3RhdGVzOwog\nICAgICAgICAgICBfdHJhbnNDYWNoZS5jbGVhcigpOwogICAgICAgIH0KCiAg\nICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgdHJ1ZSk7CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE9iamVjdCBs\naWZlY3ljbGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIHZvaWQgcGVyc2lzdChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgcGVyc2lzdChvYmosIG51bGwsIHRydWUsIGNhbGwpOwogICAg\nfQoKICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIHBlcnNpc3QoT2Jq\nZWN0IG9iaiwgT2JqZWN0IGlkLAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICByZXR1cm4gcGVyc2lzdChvYmosIGlkLCB0cnVlLCBjYWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0QWxsKENvbGxlY3Rp\nb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHBlcnNpc3RB\nbGwob2JqcywgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQ\nZXJzaXN0IHRoZSBnaXZlbiBvYmplY3RzLiAgSW5kaWNhdGUgd2hldGhlciB0\naGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAgICAgKiAoUE5FVykgb3Ig\nYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9WSVNJT05BTCkuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3RBbGwoQ29sbGVjdGlvbiBvYmpz\nLCBib29sZWFuIGV4cGxpY2l0LCAKICAgICAgICBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAg\nIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwoKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHBlcnNpc3QoaXRyLm5leHQoKSwgZXhwbGljaXQsIGNhbGwpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgICAg\nICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBub3Qg\nbnVsbCwgYWRkIGl0IHRvIHRoZSBnaXZlbiBsaXN0LAogICAgICogY3JlYXRp\nbmcgdGhlIGxpc3QgaWYgbmVjZXNzYXJ5LgogICAgICovCiAgICBwcml2YXRl\nIExpc3QgYWRkKExpc3QgbCwgT2JqZWN0IG8pIHsKICAgICAgICBpZiAobyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbDsKICAgICAgICBpZiAobCA9\nPSBudWxsKQogICAgICAgICAgICBsID0gbmV3IExpbmtlZExpc3QoKTsKICAg\nICAgICBsLmFkZChvKTsKICAgICAgICByZXR1cm4gbDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlvbiB3cmFwcGluZyB0aGUgZ2l2\nZW4gbmVzdGVkIGV4Y2VwdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoTGlzdCBleGNlcHMsIGJvb2xlYW4g\nZGF0YXN0b3JlKSB7CiAgICAgICAgaWYgKGV4Y2VwcyA9PSBudWxsIHx8IGV4\nY2Vwcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBp\nZiAoZGF0YXN0b3JlICYmIGV4Y2Vwcy5zaXplKCkgPT0gMSkKICAgICAgICAg\nICAgdGhyb3cgKFJ1bnRpbWVFeGNlcHRpb24pIGV4Y2Vwcy5nZXQoMCk7Cgog\nICAgICAgIGJvb2xlYW4gZmF0YWwgPSBmYWxzZTsKICAgICAgICBUaHJvd2Fi\nbGVbXSB0ID0gKFRocm93YWJsZVtdKSBleGNlcHMudG9BcnJheQogICAgICAg\nICAgICAobmV3IFRocm93YWJsZVtleGNlcHMuc2l6ZSgpXSk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCB0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmICh0W2ldIGluc3RhbmNlb2YgT3BlbkpQQUV4Y2VwdGlvbgogICAg\nICAgICAgICAgICAgJiYgKChPcGVuSlBBRXhjZXB0aW9uKSB0W2ldKS5pc0Zh\ndGFsKCkpCiAgICAgICAgICAgICAgICBmYXRhbCA9IHRydWU7CiAgICAgICAg\nfQogICAgICAgIE9wZW5KUEFFeGNlcHRpb24gZXJyOwogICAgICAgIGlmIChk\nYXRhc3RvcmUpCiAgICAgICAgICAgIGVyciA9IG5ldyBTdG9yZUV4Y2VwdGlv\nbihfbG9jLmdldCgibmVzdGVkLWV4Y2VwcyIpKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGVyciA9IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nZXN0ZWQtZXhjZXBzIikpOwogICAgICAgIHRocm93IGVyci5zZXROZXN0ZWRU\naHJvd2FibGVzKHQpLnNldEZhdGFsKGZhdGFsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVjdC4gIEluZGljYXRlIHdo\nZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lzdAogICAgICogKFBO\nRVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVXUFJPVklTSU9OQUwp\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT2JqZWN0IG9iaiwg\nYm9vbGVhbiBleHBsaWNpdCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIHBlcnNpc3Qob2JqLCBudWxsLCBleHBsaWNpdCwgY2FsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQZXJzaXN0IHRoZSBnaXZlbiBvYmplY3QuICBJbmRp\nY2F0ZSB3aGV0aGVyIHRoaXMgd2FzIGFuIGV4cGxpY2l0IHBlcnNpc3QKICAg\nICAqIChQTkVXKSBvciBhIHByb3Zpc29uYWwgcGVyc2lzdCAoUE5FV1BST1ZJ\nU0lPTkFMKS4KICAgICAqIFNlZSB7QGxpbmsgQnJva2VyfSBmb3IgZGV0YWls\ncyBvbiB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgcGVyc2lzdChPYmplY3Qgb2JqLCBPYmplY3QgaWQsIGJv\nb2xlYW4gZXhwbGljaXQsCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewog\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CgogICAg\nICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoIV9vcGVyYXRpbmcu\nYWRkKG9iaikpCiAgICAgICAgICAgICAgICByZXR1cm4gc207CgogICAgICAg\nICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tz\nLk9QX1BFUlNJU1QsIG9iaiwgc20sIGNhbGwpOwogICAgICAgICAgICBpZiAo\nYWN0aW9uID09IE9wQ2FsbGJhY2tzLkFDVF9OT05FKQogICAgICAgICAgICAg\nICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAgLy8gQUNUX0NBU0NBREUKICAg\nICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9\nPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjYXNjYWRlVHJh\nbnNpZW50KE9wQ2FsbGJhY2tzLk9QX1BFUlNJU1QsIG9iaiwgY2FsbCwKICAg\nICAgICAgICAgICAgICAgICAgICAgInBlcnNpc3QiKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBzbTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nQUNUX1JVTgogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGM7CiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICAgICAgICAgKCJwZXJzaXN0LWRldGFjaGVkIiwgRXhjZXB0aW9u\ncy50b1N0cmluZyhvYmopKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIHNl\ndEZhaWxlZE9iamVjdChvYmopOwoKICAgICAgICAgICAgICAgIGlmICghc20u\naXNFbWJlZGRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgc20ucGVyc2lz\ndCgpOwogICAgICAgICAgICAgICAgICAgIF9jYWNoZS5wZXJzaXN0KHNtKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tz\nLkFDVF9DQVNDQURFKSAhPSAwKQogICAgICAgICAgICAgICAgICAgICAgICBz\nbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gc207CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nLy8gYW4gZW1iZWRkZWQgZmllbGQ7IG5vdGlmeSB0aGUgb3duZXIgdGhhdCB0\naGUgdmFsdWUgaGFzCiAgICAgICAgICAgICAgICAvLyBjaGFuZ2VkIGJ5IGJl\nY29taW5nIGluZGVwZW5kZW50bHkgcGVyc2lzdGVudAogICAgICAgICAgICAg\nICAgc20uZ2V0T3duZXIoKS5kaXJ0eShzbS5nZXRPd25lck1ldGFEYXRhKCku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RmllbGRNZXRhRGF0YSgpLmdldElu\nZGV4KCkpOwogICAgICAgICAgICAgICAgX2NhY2hlLnBlcnNpc3Qoc20pOwog\nICAgICAgICAgICAgICAgcGMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUo\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBjID0g\nYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CiAgICAgICAgICAgICAg\nICBpZiAocGMucGNJc0RldGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRp\nb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJwZXJzaXN0\nLWRldGFjaGVkIiwgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuCiAgICAg\nICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChvYmopOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBf\nY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAg\nICAgICAgICAgZ2V0TWV0YURhdGEob2JqLmdldENsYXNzKCksIF9sb2FkZXIs\nIHRydWUpOwogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQob2JqLCBu\ndWxsLCBtZXRhLCBMaWZlY3ljbGVFdmVudC5CRUZPUkVfUEVSU0lTVCk7Cgog\nICAgICAgICAgICAvLyBjcmVhdGUgaWQgZm9yIGluc3RhbmNlCiAgICAgICAg\nICAgIGlmIChpZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAobWV0\nYS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJ\nQ0FUSU9OKQogICAgICAgICAgICAgICAgICAgIGlkID0gQXBwbGljYXRpb25J\nZHMuY3JlYXRlKHBjLCBtZXRhKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9V\nTktOT1dOKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVua25vd25pZCIsIG1ldGEpKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZCA9IFN0\nYXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgd2UgZG9uJ3QgYWxyZWFkeSBo\nYXZlIHRoZSBpbnN0YW5jZSBjYWNoZWQKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBvdGhlciA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKGlkLCBm\nYWxzZSk7CiAgICAgICAgICAgIGlmIChvdGhlciAhPSBudWxsICYmICFvdGhl\nci5pc0RlbGV0ZWQoKSAmJiAhb3RoZXIuaXNOZXcoKSkKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24oX2xvYy5nZXQo\nImNhY2hlLWV4aXN0cyIsCiAgICAgICAgICAgICAgICAgICAgb2JqLmdldENs\nYXNzKCkuZ2V0TmFtZSgpLCBpZCkpLnNldEZhaWxlZE9iamVjdChvYmopOwoK\nICAgICAgICAgICAgLy8gaWYgaGFkIGVtYmVkZGVkIHNtLCBudWxsIGl0CiAg\nICAgICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGMu\ncGNSZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwoKICAgICAgICAgICAgLy8g\nY3JlYXRlIG5ldyBzbQogICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFn\nZXJJbXBsKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYg\nKGV4cGxpY2l0KQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUo\ncGMsIFBDU3RhdGUuUE5FVyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVX\nUFJPVklTSU9OQUwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgIHNtLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5PTlRSQU5TTkVXKTsK\nICAgICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FT\nQ0FERSkgIT0gMCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0\nKGNhbGwpOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZW1wb3JhcmlseSBt\nYW5hZ2UgdGhlIGdpdmVuIGluc3RhbmNlIGluIG9yZGVyIHRvIGNhc2NhZGUg\ndGhlIGdpdmVuCiAgICAgKiBvcGVyYXRpb24gdGhyb3VnaCBpdC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGNhc2NhZGVUcmFuc2llbnQoaW50IG9wLCBP\nYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFN0cmluZyBl\ncnJPcCkgewogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopOwoKICAgICAgICAvLyBpZiB1c2lu\nZyBkZXRhY2hlZCBzdGF0ZSBtYW5hZ2VyLCBkb24ndCByZXBsYWNlCiAgICAg\nICAgaWYgKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCBlcnJPcCk7\nCgogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFE\nYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFE\nYXRhKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwoU3Rh\ndGVNYW5hZ2VySWQuCiAgICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBt\nZXRhLCB0aGlzKTsKICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRl\nLlRMT0FERUQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAo\nb3ApIHsKICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVS\nU0lTVDoKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChj\nYWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfREVMRVRFOgogICAgICAgICAgICAg\nICAgICAgIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tz\nLk9QX1JFRlJFU0g6CiAgICAgICAgICAgICAgICAgICAgc20uZ2F0aGVyQ2Fz\nY2FkZVJlZnJlc2goY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihv\ncCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkg\newogICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBkZWxldGVBbGwoQ29sbGVjdGlvbiBvYmpz\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVP\ncGVyYXRpb24oKTsKCiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsK\nICAgICAgICAgICAgT2JqZWN0IG9iajsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG9i\naiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iaiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUob2JqLCBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSksIGNhbGwpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvd05l\nc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPYmplY3Qgb2JqLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0\naW9uKCk7CiAgICAgICAgICAgIGRlbGV0ZShvYmosIGdldFN0YXRlTWFuYWdl\nckltcGwob2JqLCB0cnVlKSwgY2FsbCk7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBkZWxldGUuCiAg\nICAgKi8KICAgIHZvaWQgZGVsZXRlKE9iamVjdCBvYmosIFN0YXRlTWFuYWdl\nckltcGwgc20sIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoIV9v\ncGVyYXRpbmcuYWRkKG9iaikpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5P\nUF9ERUxFVEUsIG9iaiwgc20sIGNhbGwpOwogICAgICAgIGlmIChhY3Rpb24g\nPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gQUNUX0NBU0NBREUKICAgICAgICBpZiAoKGFjdGlvbiAm\nIE9wQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApIHsKICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwpCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRl\nKGNhbGwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjYXNj\nYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tzLk9QX0RFTEVURSwgb2JqLCBjYWxs\nLCAiZGVsZXRlIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIC8vIEFDVF9SVU4KICAgICAgICBpZiAoc20gIT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAiZGVsZXRlIik7\nCiAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX0NB\nU0NBREUpICE9IDApCiAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRl\nKGNhbGwpOwogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICB9IGVs\nc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLnBjSXNEZXRh\nY2hlZCgpID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgdGhyb3cgbmV3\nRGV0YWNoZWRFeGNlcHRpb24ob2JqLCAiZGVsZXRlIik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gaW5kaWNhdGluZyB0aGF0\nIHRoZSBjdXJyZW50IGFjdGlvbiBjYW4ndCBiZQogICAgICogcGVyZm9ybWVk\nIG9uIGEgZGV0YWNoZWQgb2JqZWN0LgogICAgICovCiAgICBwcml2YXRlIE9w\nZW5KUEFFeGNlcHRpb24gbmV3RGV0YWNoZWRFeGNlcHRpb24oT2JqZWN0IG9i\naiwKICAgICAgICBTdHJpbmcgb3BlcmF0aW9uKSB7CiAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1kZXRhY2hlZC1vcCIs\nIG9wZXJhdGlvbiwKICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhv\nYmopKSkuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVsZWFzZUFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmVsZWFzZShpdHIubmV4dCgpLCBjYWxsKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAg\nICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhy\nb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlKE9iamVjdCBvYmos\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAg\nICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxs\nYmFja3MuT1BfUkVMRUFTRSwgb2JqLCBzbSwgY2FsbCk7CgogICAgICAgICAg\nICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSAh\nPSAwICYmIHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAgICBi\nb29sZWFuIHBlbmRpbmcgPSBzbS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCk7\nCiAgICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgICAg\nICAgICAgaWYgKHBlbmRpbmcpCiAgICAgICAgICAgICAgICAgICAgcmVtb3Zl\nRnJvbVBlbmRpbmdUcmFuc2FjdGlvbihzbSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPcGVuSlBBU3RhdGVNYW5hZ2VyIGVtYmVkKE9iamVjdCBvYmosIE9iamVj\ndCBpZCwKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVyLCBWYWx1\nZU1ldGFEYXRhIG93bmVyTWV0YSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgb3JpZyA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsK\nICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgLy8gaWYgYWxyZWFkeSBlbWJlZGRlZCwgbm90aGluZyB0byBkbwogICAg\nICAgICAgICAgICAgaWYgKG9yaWcuZ2V0T3duZXIoKSA9PSBvd25lciAmJiBv\ncmlnLmdldE1ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0RW1i\nZWRkaW5nTWV0YURhdGEoKSA9PSBvd25lck1ldGEpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG9yaWc7CgogICAgICAgICAgICAgICAgLy8gb3RoZXJ3\naXNlIG1ha2Ugc3VyZSBwYyBpcyBmdWxseSBsb2FkZWQgZm9yIHdoZW4gd2Ug\nY29weSBpdHMKICAgICAgICAgICAgICAgIC8vIGRhdGEgYmVsb3cKICAgICAg\nICAgICAgICAgIG9yaWcubG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9B\nRF9BTEwsIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gY3JlYXRlIG5ldyBzdGF0ZSBtYW5hZ2VyIHdpdGggZW1i\nZWRkZWQgbWV0YWRhdGEKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gb3duZXJNZXRhLmdldEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICAg\nICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWVtYmVkIiwgb3du\nZXJNZXRhKSk7CgogICAgICAgICAgICBpZiAoaWQgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhp\ncyk7CgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gbmV3IFN0\nYXRlTWFuYWdlckltcGwoaWQsIG1ldGEsIHRoaXMpOwogICAgICAgICAgICBz\nbS5zZXRPd25lcigoU3RhdGVNYW5hZ2VySW1wbCkgb3duZXIsIG93bmVyTWV0\nYSk7CgogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgY29weTsKICAg\nICAgICAgICAgUENTdGF0ZSBzdGF0ZTsKICAgICAgICAgICAgQ2xhc3MgdHlw\nZSA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICBpZiAo\ndHlwZS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICAgICAgdHlwZSA9IG1l\ndGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwogICAgICAgICAgICBpZiAob2JqICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGdpdmUgY29weSBhbmQgdGhl\nIG9yaWdpbmFsIGluc3RhbmNlIHRoZSBzYW1lIHN0YXRlIG1hbmFnZXIKICAg\nICAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIGNvcHkgZmllbGRzIGZy\nb20gb25lIHRvIHRoZSBvdGhlcgogICAgICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBjb3B5U007CiAgICAgICAgICAgICAgICBQZXJzaXN0ZW5jZUNh\ncGFibGUgcGM7CiAgICAgICAgICAgICAgICBpZiAob3JpZyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgY29weVNNID0gc207CiAgICAgICAgICAg\nICAgICAgICAgcGMgPSBhc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsK\nICAgICAgICAgICAgICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIo\nc20pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBjb3B5U00gPSBvcmlnOwogICAgICAgICAgICAgICAgICAgIHBjID0g\nb3JpZy5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIC8vIGNvcHkgdGhlIGluc3RhbmNlLiAgd2UgZG8gdGhpcyBldmVuIGlmIGl0\nIGRvZXNuJ3QgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgIC8vIGhhdmUg\nYSBzdGF0ZSBtYW5hZ2VyIGluIGNhc2UgaXQgaXMgbGF0ZXIgYXNzaWduZWQg\ndG8gYQogICAgICAgICAgICAgICAgICAgIC8vIFBDIGZpZWxkOyBhdCB0aGF0\nIHBvaW50IGl0J3MgdG9vIGxhdGUgdG8gY29weQogICAgICAgICAgICAgICAg\nICAgIGNvcHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUsIGNvcHlT\nTSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGludFtdIGZpZWxkcyA9\nIG5ldyBpbnRbbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGhdOwogICAgICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0gPSBpOwog\nICAgICAgICAgICAgICAgICAgIGNvcHkucGNDb3B5RmllbGRzKHBjLCBmaWVs\nZHMpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FQ09Q\nWTsKICAgICAgICAgICAgICAgICAgICBjb3B5LnBjUmVwbGFjZVN0YXRlTWFu\nYWdlcihudWxsKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gaWYgdGhlIGluc3RhbmNlIGRpZG4ndCBoYXZl\nIGEgc3RhdGUgbWFuYWdlciB0byBzdGFydCwKICAgICAgICAgICAgICAgICAg\nICAvLyByZXZlcnQgaXQgdG8gYmVpbmcgdHJhbnNpZW50CiAgICAgICAgICAg\nICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgY29weSA9IFBDUmVnaXN0cnkubmV3SW5zdGFuY2UodHlwZSwgc20sIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDAgJiYgIV9vcHRpbWlzdGljKQogICAgICAgICAgICAgICAgICAg\nIHN0YXRlID0gUENTdGF0ZS5FQ0xFQU47CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBQQ1N0YXRlLkVOT05UUkFO\nUzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShj\nb3B5LCBzdGF0ZSk7CiAgICAgICAgICAgIHJldHVybiBzbTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElmIG5vdCBh\nbHJlYWR5IGNhY2hlZCwgY3JlYXRlIGFuIGVtcHR5IGNvcHkgb2YgdGhlIGdp\ndmVuIHN0YXRlCiAgICAgKiBtYW5hZ2VyIGluIHRoZSBnaXZlbiBzdGF0ZS4K\nICAgICAqLwogICAgT3BlbkpQQVN0YXRlTWFuYWdlciBjb3B5KE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgY29weSwgUENTdGF0ZSBzdGF0ZSkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgT2JqZWN0IG9pZCA9IGNvcHku\nZmV0Y2hPYmplY3RJZCgpOwogICAgICAgICAgICBDbGFzcyB0eXBlID0gY29w\neS5nZXRNYW5hZ2VkSW5zdGFuY2UoKS5nZXRDbGFzcygpOwogICAgICAgICAg\nICBpZiAob2lkID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICAgICAgLy8gY2FjaGVkIGlu\nc3RhbmNlPwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gbnVs\nbDsKICAgICAgICAgICAgaWYgKCFjb3B5LmlzRW1iZWRkZWQoKSkKICAgICAg\nICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbEJ5SWQob2lkLCB0\ncnVlKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9jb25mLgogICAg\nICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNl\nKCk7CiAgICAgICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSByZXBv\ncy5nZXRNZXRhRGF0YSh0eXBlLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAg\nICAgICAgIC8vIGNvbnN0cnVjdCBhIG5ldyBzdGF0ZSBtYW5hZ2VyIHdpdGgg\nYWxsIGluZm8ga25vd24KICAgICAgICAgICAgICAgIHNtID0gbmV3IFN0YXRl\nTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgICAg\nIHNtLnNldE9iamVjdElkKG9pZCk7CiAgICAgICAgICAgICAgICBzbS5pbml0\naWFsaXplKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLCBz\ndGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNtOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWZyZXNoQWxs\nKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJl\nZnJlc2goaXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgIGlmIChfb3Bl\ncmF0aW5nLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgaWYgKF9vcGVyYXRpbmcuc2l6ZSgpID09IDEpCiAgICAgICAg\nICAgICAgICByZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZy5pdGVyYXRvcigp\nLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIHJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLCBjYWxsKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVmcmVzaChPYmplY3Qg\nb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE5v\nbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICBnYXRoZXJDYXNj\nYWRlUmVmcmVzaChvYmosIGNhbGwpOwogICAgICAgICAgICBpZiAoX29wZXJh\ndGluZy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIGlmIChfb3BlcmF0aW5nLnNpemUoKSA9PSAxKQogICAgICAgICAg\nICAgICAgcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcuaXRlcmF0b3IoKS5u\nZXh0KCksIGNhbGwpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICByZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywgY2FsbCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2F0aGVycyBhbGwgb2JqZWN0\ncyByZWFjaGFibGUgdGhyb3VnaCBjYXNjYWRlLXJlZnJlc2ggcmVsYXRpb25z\nCiAgICAgKiBpbnRvIHRoZSBvcGVyYXRpbmcgc2V0LgogICAgICovCiAgICB2\nb2lkIGdhdGhlckNhc2NhZGVSZWZyZXNoKE9iamVjdCBvYmosIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoIV9vcGVyYXRpbmcuYWRkKG9iaikp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RhdGVNYW5hZ2VySW1w\nbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCBmYWxzZSk7CiAgICAg\nICAgaW50IGFjdGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5P\nUF9SRUZSRVNILCBvYmosIHNtLCBjYWxsKTsKICAgICAgICBpZiAoKGFjdGlv\nbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSA9PSAwKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAg\nICBzbS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIGNhc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1Bf\nUkVGUkVTSCwgb2JqLCBjYWxsLCAicmVmcmVzaCIpOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdpdGggdGhlIGZ1bGwg\nc2V0IG9mIG9iamVjdHMgcmVhY2hhYmxlIHZpYQogICAgICogY2FzY2FkZS1y\nZWZyZXNoIHJlbGF0aW9ucyBmcm9tIHRoZSB1c2VyLWdpdmVuIGluc3RhbmNl\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcmVmcmVzaEludGVybmFs\nKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICAvLyBjb2xsZWN0IGluc3RhbmNlcyB0aGF0IG5lZWQgYSByZWZyZXNoCiAg\nICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9IG51bGw7CiAgICAgICAgICAg\nIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIE9iamVjdCBvYmo7\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2JqID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5h\nZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmICgo\ncHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFRlJFU0gsIG9iaiwg\nc20sIGNhbGwpCiAgICAgICAgICAgICAgICAgICAgICAgICYgT3BDYWxsYmFj\na3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CgogICAgICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hl\nZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKHNtLmJlZm9yZVJlZnJlc2godHJ1ZSkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJh\neUxpc3Qob2Jqcy5zaXplKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhc3NlcnRQZXJzaXN0ZW5j\nZUNhcGFibGUob2JqKS5wY0lzRGV0YWNoZWQoKQogICAgICAgICAgICAgICAg\nICAgICAgICA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2gi\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBz\nLCBrZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHJlZnJlc2ggYWxsCiAgICAgICAgICAgIGlmIChsb2FkICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gZmFpbGVkID0g\nX3N0b3JlLmxvYWRBbGwobG9hZCwgbnVsbCwKICAgICAgICAgICAgICAgICAg\nICBTdG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9SRUZSRVNILCBfZmMsIG51bGwp\nOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmICFmYWls\nZWQuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFk\nZChleGNlcHMsIG5ld09iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCkp\nOwoKICAgICAgICAgICAgICAgIC8vIHBlcmZvcm0gcG9zdC1yZWZyZXNoIHRy\nYW5zaXRpb25zIGFuZCBtYWtlIHN1cmUgYWxsIGZldGNoCiAgICAgICAgICAg\nICAgICAvLyBncm91cCBmaWVsZHMgYXJlIGxvYWRlZAogICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBsb2FkLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSAoU3RhdGVN\nYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVkLmNvbnRhaW5zKHNtLmdldElk\nKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc20uYWZ0ZXJSZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNt\nLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxsLCBu\ndWxsLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNl\ncHMsIGtlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyBpbnZva2Ug\ncG9zdFJlZnJlc2ggb24gYWxsIHRoZSBpbnN0YW5jZXMKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChpdHIubmV4dCgpLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiAh\nc20uaXNEZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJl\nTGlmZWN5Y2xlRXZlbnQoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGws\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgp\nLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9SRUZSRVNIKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0K\nICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBPcHRpbWl6YXRpb24gZm9yIHNpbmds\nZS1vYmplY3QgcmVmcmVzaC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\ncmVmcmVzaEludGVybmFsKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAg\nICAgICBpZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZS\nRVNILCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENhbGxi\nYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAg\nICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3JlUmVmcmVzaChmYWxzZSkp\nIHsKICAgICAgICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5h\nZ2VySW1wbC5MT0FEX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNtLmdl\ndE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICAgICAgICAg\nIHNtLmdldE1ldGFEYXRhKCksIExpZmVjeWNsZUV2ZW50LkFGVEVSX1JFRlJF\nU0gpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNl\nQ2FwYWJsZShvYmopLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAgICA9\nPSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRh\nY2hlZEV4Y2VwdGlvbihvYmosICJyZWZyZXNoIik7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0cmlldmVBbGwoQ29s\nbGVjdGlvbiBvYmpzLCBib29sZWFuIGRmZ09ubHksCiAgICAgICAgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAx\nKSB7CiAgICAgICAgICAgIHJldHJpZXZlKG9ianMuaXRlcmF0b3IoKS5uZXh0\nKCksIGRmZ09ubHksIGNhbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICBMaXN0IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlv\nbmFsUmVhZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVjdCBhbGwgaG9sbG93\nIGluc3RhbmNlcyBmb3IgbG9hZAogICAgICAgICAgICBPYmplY3Qgb2JqOwog\nICAgICAgICAgICBDb2xsZWN0aW9uIGxvYWQgPSBudWxsOwogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBDb2xsZWN0aW9u\nIHNtcyA9IG5ldyBBcnJheUxpc3Qob2Jqcy5zaXplKCkpOwogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG9iaiA9IGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKHByb2Nlc3NBcmd1\nbWVudChPcENhbGxiYWNrcy5PUF9SRVRSSUVWRSwgb2JqLCBzbSwgY2FsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVO\nKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChzbS5pc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoc20uZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgID09IEJv\nb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nRGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAgICAg\nICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGxvYWQg\nYWxsIGhvbGxvdyBpbnN0YW5jZXMKICAgICAgICAgICAgQ29sbGVjdGlvbiBm\nYWlsZWQgPSBudWxsOwogICAgICAgICAgICBpZiAobG9hZCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/IF9zdG9y\nZS5GT1JDRV9MT0FEX0RGRwogICAgICAgICAgICAgICAgICAgIDogX3N0b3Jl\nLkZPUkNFX0xPQURfQUxMOwogICAgICAgICAgICAgICAgZmFpbGVkID0gX3N0\nb3JlLmxvYWRBbGwobG9hZCwgbnVsbCwgbW9kZSwgX2ZjLCBudWxsKTsKICAg\nICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmV0cmlldmUgYWxsIG5vbi1m\nYWlsZWQgaW5zdGFuY2VzCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gc21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwog\nICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5j\nb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgICAgICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/\nIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MKICAgICAgICAgICAgICAgICAg\nICA6IFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJlYWQoLTEp\nOwogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBudWxs\nLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBz\nID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dO\nZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJldHJpZXZlKE9iamVjdCBvYmosIGJvb2xlYW4gZGZnT25s\neSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlv\nbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVu\nKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7\nCgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3RhdGVN\nYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHByb2Nl\nc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRVRSSUVWRSwgb2JqLCBzbSwg\nY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikg\nPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlm\nIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRh\nY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVk\nRXhjZXB0aW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAgICBp\nZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICBp\nbnQgbW9kZSA9IChkZmdPbmx5KSA/IFN0YXRlTWFuYWdlckltcGwuTE9BRF9G\nR1MKICAgICAgICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJbXBs\nLkxPQURfQUxMOwogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJlYWQo\nLTEpOwogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBu\ndWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiku\ncGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAgID09IEJvb2xlYW4uVFJV\nRSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9u\nKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQTm9u\nVHJhbnMgb2JqZWN0cwogICAgICAgICAgICBDb2xsZWN0aW9uIGMgPSBnZXRN\nYW5hZ2VkU3RhdGVzKCk7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYy5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSAo\nU3RhdGVNYW5hZ2VySW1wbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmIChzbS5pc1BlcnNpc3RlbnQoKSAmJiAhc20uaXNEaXJ0eSgpKQogICAg\nICAgICAgICAgICAgICAgIGV2aWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgp\nLCBjYWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5h\nbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKENvbGxlY3Rpb24gb2Jq\ncywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIExpc3QgZXhjZXBzID0g\nbnVsbDsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGV2aWN0KGl0ci5uZXh0KCksIGNh\nbGwpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1\nZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgICAgICB0aHJvd05lc3RlZEV4Y2VwdGlvbnMoZXhjZXBzLCBm\nYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoRXh0ZW50\nIGV4dGVudCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChleHRl\nbnQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdp\nbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nLy8gZXZpY3QgYWxsIFBDbGVhbiBhbmQgUE5vblRyYW5zIG9iamVjdHMgaW4g\nZXh0ZW50CiAgICAgICAgICAgIENvbGxlY3Rpb24gYyA9IGdldE1hbmFnZWRT\ndGF0ZXMoKTsKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAg\nICAgICAgICAgQ2xhc3MgY2xzOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50KCkgJiYgIXNt\nLmlzRGlydHkoKSkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChjbHMgPT0gZXh0ZW50LmdldEVsZW1lbnRUeXBlKCkKICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgKGV4dGVudC5oYXNTdWJjbGFzc2Vz\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgZXh0ZW50LmdldEVsZW1l\nbnRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShjbHMpKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIGNh\nbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0KE9iamVjdCBvYmos\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAg\nICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9Q\nX0VWSUNULCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgJiBPcENh\nbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgICAgIHNtLmV2aWN0KCk7CiAgICAgICAgICAg\nIGlmIChfZXZpY3REYXRhQ2FjaGUgJiYgc20uZ2V0T2JqZWN0SWQoKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBzbS5n\nZXRNZXRhRGF0YSgpLmdldERhdGFDYWNoZSgpOwogICAgICAgICAgICAgICAg\naWYgKGNhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY2FjaGUu\ncmVtb3ZlKHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGRldGFjaChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBj\nYWxsID0gX2NhbGw7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGV0YWNoTWFu\nYWdlcih0aGlzLCBmYWxzZSwgY2FsbCkuZGV0YWNoKG9iaik7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9iamVjdFtdIGRl\ndGFjaEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBFTVBUWV9PQkpFQ1RTOwogICAgICAgIGlmIChjYWxsID09IG51\nbGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNlLCBjYWxsKS5kZXRh\nY2hBbGwob2Jqcyk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwpIHsK\nICAgICAgICBkZXRhY2hBbGwoY2FsbCwgdHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgZGV0YWNoQWxsKE9wQ2FsbGJhY2tzIGNhbGwsIGJvb2xlYW4g\nZmx1c2gpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBJZiBhIGZsdXNoIGlzIGRlc2lyZWQg\nKGJhc2VkIG9uIGlucHV0IHBhcm0pLCB0aGVuIGNoZWNrIGlmIHRoZQogICAg\nICAgICAgICAvLyAgICJkaXJ0eSIgZmxhZyBpcyBzZXQgYmVmb3JlIGNhbGxp\nbmcgZmx1c2goKS4KICAgICAgICAgICAgaWYgKChmbHVzaCkgJiYgKChfZmxh\nZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwKSkKICAgICAgICAgICAg\nICAgIGZsdXNoKCk7CiAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKGNh\nbGwpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBkZXRhY2hBbGxJbnRlcm5hbChPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgQ29sbGVjdGlvbiBzdGF0ZXMgPSBnZXRNYW5hZ2VkU3RhdGVz\nKCk7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBp\ndHIubmV4dCgpOwogICAgICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVudCgp\nKQogICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICBl\nbHNlIGlmICghc20uZ2V0TWV0YURhdGEoKS5pc0RldGFjaGFibGUoKSkgewog\nICAgICAgICAgICAgICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAg\nICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoc3RhdGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBjYWxs\nID0gX2NhbGw7CiAgICAgICAgbmV3IERldGFjaE1hbmFnZXIodGhpcywgdHJ1\nZSwgY2FsbCkuZGV0YWNoQWxsCiAgICAgICAgICAgIChuZXcgTWFuYWdlZE9i\namVjdENvbGxlY3Rpb24oc3RhdGVzKSk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBhdHRhY2goT2JqZWN0IG9iaiwgYm9vbGVhbiBjb3B5TmV3LCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\ndHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJl\nIG5vdCB0byB0cnkgdG8gc2V0IHJvbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWls\ncwogICAgICAgICAgICBhc3NlcnRXcml0ZU9wZXJhdGlvbigpOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRhY2hN\nYW5hZ2VyKHRoaXMsIGNvcHlOZXcsIGNhbGwpLmF0dGFjaChvYmopOwogICAg\nICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9uIG9lKSB7CiAg\nICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHkob2UpOwogICAgICAgICAg\nICAgICAgdGhyb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gYXR0YWNoQWxsKENvbGxl\nY3Rpb24gb2JqcywgYm9vbGVhbiBjb3B5TmV3LAogICAgICAgIE9wQ2FsbGJh\nY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqcyA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBFTVBUWV9PQkpFQ1RTOwoKICAgICAgICBi\nZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgbm90IHRvIHRyeSB0byBzZXQgcm9sbGJhY2sgb25s\neSBpZiB0aGlzIGZhaWxzCiAgICAgICAgICAgIGFzc2VydFdyaXRlT3BlcmF0\naW9uKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEF0dGFjaE1hbmFnZXIodGhpcywgY29weU5ldywgY2FsbCkuYXR0\nYWNoQWxsKG9ianMpOwogICAgICAgICAgICB9IGNhdGNoIChPcHRpbWlzdGlj\nRXhjZXB0aW9uIG9lKSB7CiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09u\nbHkob2UpOwogICAgICAgICAgICAgICAgdGhyb3cgb2Uuc2V0RmF0YWwodHJ1\nZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBu\nb250cmFuc2FjdGlvbmFsQWxsKENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIG5vbnRyYW5zYWN0aW9uYWwoaXRyLm5leHQoKSwg\nY2FsbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9u\nIHVlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vw\ncywgdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbm9udHJhbnNh\nY3Rpb25hbChPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3Vt\nZW50KE9wQ2FsbGJhY2tzLk9QX05PTlRSQU5TQUNUSU9OQUwsIG9iaiwgc20s\nIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9SVU4p\nID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlm\nIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgc20ubm9udHJhbnNhY3Rp\nb25hbCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gaW5zdGFuY2VzIHRyYW5zYWN0aW9u\nYWwuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHRyYW5zYWN0aW9uYWxBbGwo\nQ29sbGVjdGlvbiBvYmpzLCBib29sZWFuIHVwZGF0ZVZlcnNpb24sCiAgICAg\nICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNp\nemUoKSA9PSAxKSB7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwob2Jqcy5p\ndGVyYXRvcigpLm5leHQoKSwgdXBkYXRlVmVyc2lvbiwgY2FsbCk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGNvbGxl\nY3QgYWxsIGhvbGxvdyBpbnN0YW5jZXMgZm9yIGxvYWQsIGFuZCBtYWtlIHVu\nbWFuYW5nZWQKICAgICAgICAgICAgLy8gaW5zdGFuY2VzIHRyYW5zaWVudC10\ncmFuc2FjdGlvbmFsCiAgICAgICAgICAgIENvbGxlY3Rpb24gbG9hZCA9IG51\nbGw7CiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYTsKICAgICAgICAgICAgQ29sbGVjdGlvbiBzbXMgPSBuZXcgTGlua2VkSGFz\naFNldChvYmpzLnNpemUoKSk7CiAgICAgICAgICAgIExpc3QgZXhjZXBzID0g\nbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvYmpzLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBv\nYmogPSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfVFJBTlNBQ1RJ\nT05BTCwgb2JqLCBzbSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbCkg\nJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHNt\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFuYWdl\nIHRyYW5zaWVudCBpbnN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5n\nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIChTdGF0ZU1hbmFnZXJJZC5uZXdJbnN0YW5jZSh0\naGlzKSwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaiksCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBQQ1N0YXRlLlRDTEVBTik7CiAg\nICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzbS5pc1BlcnNpc3RlbnQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFu\nc2FjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICBzbXMuYWRkKHNt\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUo\nKSA9PSBQQ1N0YXRlLkhPTExPVykgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2FkID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbG9hZC5hZGQoc20pOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRD\naGVja1ZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nICh1cGRhdGVWZXJzaW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc20uc2V0VXBkYXRlVmVyc2lvbih0cnVlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNp\nb24gY2hlY2svdXAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoVXNlckV4Y2VwdGlvbiB1\nZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gbG9hZCBhbGwgaG9sbG93IGluc3RhbmNlcwogICAgICAgICAg\nICBDb2xsZWN0aW9uIGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChs\nb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9zdG9y\nZS5sb2FkQWxsKGxvYWQsIG51bGwsIF9zdG9yZS5GT1JDRV9MT0FEX05PTkUs\nCiAgICAgICAgICAgICAgICAgICAgX2ZjLCBudWxsKTsKICAgICAgICAgICAg\nICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLAogICAg\nICAgICAgICAgICAgICAgICAgICBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlv\nbihmYWlsZWQpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJhbnNh\nY3Rpb25hbFN0YXRlc0FsbChzbXMsIGZhaWxlZCwgZXhjZXBzKTsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\ndGhlIGdpdmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlvbmFsKE9iamVjdCBvYmosIGJvb2xl\nYW4gdXBkYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1h\nbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vz\nc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwg\nc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tzLkFDVF9S\nVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAg\nICBpZiAoc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQoKSkgewogICAg\nICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAg\nICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAg\nIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfRkdTLCBudWxs\nLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5zZXRDaGVja1Zl\ncnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAodXBkYXRlVmVyc2lv\nbikKICAgICAgICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVWZXJzaW9uKHRy\ndWUpOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hfUkVR\nVUlSRUQ7IC8vIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAgICAgfSBlbHNl\nIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtYW5hZ2Ug\ndHJhbnNpZW50IGluc3RhbmNlCiAgICAgICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5j\nZSgpLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRhKG9iai5nZXRD\nbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIE9iamVj\ndCBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwogICAg\nICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1wbChpZCwgbWV0\nYSwgdGhpcyk7CiAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2Vy\ndFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAg\nIFBDU3RhdGUuVENMRUFOKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9u\nKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFu\nc2l0aW9uIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0cmFuc2FjdGlv\nbmFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNhY3Rpb25hbFN0\nYXRlc0FsbChDb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlvbiBmYWlsZWQsCiAg\nICAgICAgTGlzdCBleGNlcHMpIHsKICAgICAgICAvLyBtYWtlIGluc3RhbmNl\ncyB0cmFuc2FjdGlvbmFsIGFuZCBtYWtlIHN1cmUgdGhleSBhcmUgbG9hZGVk\nCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3IgKEl0\nZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4\ndCgpOwogICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgZmFpbGVk\nLmNvbnRhaW5zKHNtLmdldElkKCkpKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc20udHJh\nbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAgICAgc20ubG9hZChfZmMsIFN0\nYXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51bGwsIGZhbHNlKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93TmVzdGVkRXhjZXB0\naW9ucyhleGNlcHMsIGZhbHNlKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gRXh0ZW50LCBRdWVyeQogICAgLy8vLy8vLy8vLy8vLy8v\nLy8KCiAgICBwdWJsaWMgRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBi\nb29sZWFuIHN1YmNsYXNzZXMpIHsKICAgICAgICByZXR1cm4gbmV3RXh0ZW50\nKHR5cGUsIHN1YmNsYXNzZXMsIG51bGwpOwogICAgfQoKICAgIHByaXZhdGUg\nRXh0ZW50IG5ld0V4dGVudChDbGFzcyB0eXBlLCBib29sZWFuIHN1YmNsYXNz\nZXMsCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgRXh0ZW50SW1wbCBleHRlbnQgPSBuZXcgRXh0ZW50SW1wbCh0aGlz\nLCB0eXBlLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgICAgIGlmIChf\nZXh0ZW50cyA9PSBudWxsKQogICAgICAgICAgICAgICAgX2V4dGVudHMgPSBu\nZXcgUmVmZXJlbmNlSGFzaFNldChSZWZlcmVuY2VIYXNoU2V0LldFQUspOwog\nICAgICAgICAgICBfZXh0ZW50cy5hZGQoZXh0ZW50KTsKCiAgICAgICAgICAg\nIHJldHVybiBleHRlbnQ7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIEl0ZXJhdG9yIGV4dGVudEl0ZXJhdG9yKENsYXNzIHR5\ncGUsIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIGJvb2xlYW4gaWdub3JlQ2hhbmdlcykgewogICAgICAg\nIEV4dGVudCBleHRlbnQgPSBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3Nlcywg\nZmV0Y2gpOwogICAgICAgIGV4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKGlnbm9y\nZUNoYW5nZXMpOwogICAgICAgIHJldHVybiBleHRlbnQuaXRlcmF0b3IoKTsK\nICAgIH0KCiAgICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcs\nIENsYXNzIGNscywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgUXVlcnkgcSA9\nIG5ld1F1ZXJ5KGxhbmcsIHF1ZXJ5KTsKICAgICAgICBxLnNldENhbmRpZGF0\nZVR5cGUoY2xzLCB0cnVlKTsKICAgICAgICByZXR1cm4gcTsKICAgIH0KCiAg\nICBwdWJsaWMgUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmcsIE9iamVjdCBx\ndWVyeSkgewogICAgICAgIC8vIGNvbW1vbiBtaXN0YWtlcwogICAgICAgIGlm\nIChxdWVyeSBpbnN0YW5jZW9mIEV4dGVudCB8fCBxdWVyeSBpbnN0YW5jZW9m\nIENsYXNzKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLW5ldy1xdWVyeSIpKTsKCiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0b3Jl\nUXVlcnkgc3EgPSBfc3RvcmUubmV3UXVlcnkobGFuZyk7CiAgICAgICAgICAg\nIGlmIChzcSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBFeHByZXNzaW9u\nUGFyc2VyIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2VyRm9yTGFuZ3VhZ2Uo\nbGFuZyk7CiAgICAgICAgICAgICAgICBpZiAoZXAgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBzcSA9IG5ldyBFeHByZXNzaW9uU3RvcmVRdWVyeShl\ncCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChRdWVyeUxhbmd1YWdlcy5M\nQU5HX01FVEhPRFFMLmVxdWFscyhsYW5nKSkKICAgICAgICAgICAgICAgICAg\nICBzcSA9IG5ldyBNZXRob2RTdG9yZVF1ZXJ5KCk7CiAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9y\ndGVkRXhjZXB0aW9uKGxhbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBRdWVyeSBxID0gbmV3UXVlcnlJbXBsKGxhbmcsIHNxKTsKICAgICAgICAg\nICAgcS5zZXRJZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFuZ2VzKTsKICAgICAg\nICAgICAgaWYgKHF1ZXJ5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBxLnNl\ndFF1ZXJ5KHF1ZXJ5KTsKCiAgICAgICAgICAgIC8vIHRyYWNrIHF1ZXJpZXMK\nICAgICAgICAgICAgaWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfcXVlcmllcyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJlZmVyZW5j\nZUhhc2hTZXQuV0VBSyk7CiAgICAgICAgICAgIF9xdWVyaWVzLmFkZChxKTsK\nICAgICAgICAgICAgcmV0dXJuIHE7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcXVlcnkuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBRdWVyeUltcGwgbmV3UXVlcnlJbXBsKFN0\ncmluZyBsYW5nLCBTdG9yZVF1ZXJ5IHNxKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBRdWVyeUltcGwodGhpcywgbGFuZywgc3EpOwogICAgfQoKICAgIHB1Ymxp\nYyBTZXEgZ2V0SWRlbnRpdHlTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEp\nIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2UobWV0YSwgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIFNlcSBnZXRWYWx1ZVNlcXVlbmNlKEZp\nZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKGZtZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U2Vx\ndWVuY2UoZm1kLmdldERlZmluaW5nTWV0YURhdGEoKSwgZm1kKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcXVlbmNlIGZvciB0aGUgZ2l2\nZW4gY2xhc3MgYW5kIG9wdGlvbmFsIGZpZWxkLgogICAgICovCiAgICBwcml2\nYXRlIFNlcSBnZXRTZXF1ZW5jZShDbGFzc01ldGFEYXRhIG1ldGEsIEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgLy8gZ2V0IHNlcXVlbmNlIHN0cmF0\nZWd5IGZyb20gbWV0YWRhdGEKICAgICAgICBpbnQgc3RyYXRlZ3k7CiAgICAg\nICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBzdHJhdGVneSA9IG1l\ndGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3RyYXRlZ3kgPSBmbWQuZ2V0VmFsdWVTdHJhdGVneSgpOwoKICAg\nICAgICAvLyB3ZSBjYW4gaGFuZGxlIG5vbi1uYXRpdmUgc3RyYXRlZ2llcyB3\naXRob3V0IHRoZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgc3dpdGNoIChzdHJh\ndGVneSkgewogICAgICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlE\nX0hFWDoKICAgICAgICAgICAgICAgIHJldHVybiBVVUlESGV4U2VxLmdldElu\nc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgVmFsdWVTdHJhdGVnaWVzLlVV\nSURfU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIFVVSURTdHJpbmdT\nZXEuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0\nZWdpZXMuU0VRVUVOQ0U6CiAgICAgICAgICAgICAgICBTZXF1ZW5jZU1ldGFE\nYXRhIHNtZCA9IChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICA/\nIG1ldGEuZ2V0SWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRhKCkKICAgICAgICAg\nICAgICAgICAgICA6IGZtZC5nZXRWYWx1ZVNlcXVlbmNlTWV0YURhdGEoKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBzbWQuZ2V0SW5zdGFuY2UoX2xvYWRl\ncik7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyB1\nc2Ugc3RvcmUgbWFuYWdlciBmb3IgbmF0aXZlIHNlcXVlbmNlCiAgICAgICAg\nICAgICAgICBpZiAoZm1kID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyB0aGlzIHdpbGwgcmV0dXJuIGEgc2VxdWVuY2UgZXZlbiBmb3IgYXBw\nIGlkIGNsYXNzZXMsCiAgICAgICAgICAgICAgICAgICAgLy8gd2hpY2ggaXMg\nd2hhdCB3ZSB3YW50IGZvciBiYWNrd2FyZHMtY29tcGF0aWJpbGl0eQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0b3JlSWRT\nZXF1ZW5jZShtZXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHJldHVybiBfc3RvcmUuZ2V0VmFsdWVTZXF1ZW5jZShmbWQpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9ja2luZwog\nICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBsb2NrKE9iamVjdCBv\nYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVsIGFsd2F5\ncyBOT05FCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9jayhvYmosIF9m\nYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9ja1RpbWVvdXQoKSwg\nY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxv\nY2soT2JqZWN0IG9iaiwgaW50IGxldmVsLCBpbnQgdGltZW91dCwgT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2Fj\ndGlvbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdl\ndFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYg\nKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1BfTE9DSywgb2JqLCBz\nbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JV\nTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\naWYgKHNtID09IG51bGwgfHwgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX2xtLmxvY2soc20sIGxl\ndmVsLCB0aW1lb3V0LCBudWxsKTsKICAgICAgICAgICAgc20ucmVhZExvY2tl\nZChsZXZlbCwgbGV2ZWwpOyAvLyB1c2Ugc2FtZSBsZXZlbCBmb3IgZnV0dXJl\nIHdyaXRlCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7IC8v\nIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVsIGFsd2F5cyBOT05FCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgbG9ja0FsbChvYmpzLCBfZmMuZ2V0V3Jp\ndGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0KCksCiAgICAgICAg\nICAgICAgICBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIGludCBsZXZlbCwgaW50\nIHRpbWVvdXQsCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgIGxvY2so\nb2Jqcy5pdGVyYXRvcigpLm5leHQoKSwgbGV2ZWwsIHRpbWVvdXQsIGNhbGwp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgQ29sbGVj\ndGlvbiBzbXMgPSBuZXcgTGlua2VkSGFzaFNldChvYmpzLnNpemUoKSk7CiAg\nICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jq\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAg\nICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmog\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVl\nKTsKICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAg\nICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwgJiYgc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICAg\nICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9s\nbS5sb2NrQWxsKHNtcywgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICgoU3RhdGVNYW5hZ2VySW1w\nbCkgaXRyLm5leHQoKSkucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOwogICAg\nICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlv\nbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlv\nbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBDb25uZWN0aW9uCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyBib29sZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAvLyB0aGlzIG1l\ndGhvZCBkb2VzIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRvIGFsbG93IGEg\nZGlmZmVyZW50CiAgICAgICAgLy8gdGhyZWFkIHRvIGJlIGFibGUgdG8gY2Fu\nY2VsIG9uIGEgbG9ja2VkLXVwIHBlcnNpc3RlbmNlIG1hbmFnZXIKCiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8v\nIGlmIHdlJ3JlIGZsdXNoaW5nLCBoYXZlIHRvIHNldCByb2xsYmFjayBvbmx5\nIC0tIGRvIHRoaXMgYmVmb3JlIHdlCiAgICAgICAgICAgIC8vIGF0dGVtcHQg\ndG8gY2FuY2VsLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2FuY2VsIG1pZ2h0\nIGNhc2UgdGhlCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHRvIGNvbXBs\nZXRlIGJlZm9yZSB3ZSBoYXZlIGEgY2hhbmNlIHRvIHNldCB0aGUKICAgICAg\nICAgICAgLy8gcm9sbGJhY2sgb25seSBmbGFnCiAgICAgICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAg\nICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKG5ldyBVc2VyRXhjZXB0\naW9uKCkpOwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmNhbmNlbEFsbCgp\nOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAg\nICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5zCiAg\nICAgICAgICAgIChfY29uZi5PUFRJT05fREFUQVNUT1JFX0NPTk5FQ1RJT04p\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24o\nX2xvYy5nZXQoImNvbm4tbm90LXN1cHBvcnRlZCIpKTsKCiAgICAgICAgcmV0\ndXJuIF9zdG9yZS5nZXRDbGllbnRDb25uZWN0aW9uKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaGFzQ29ubmVjdGlvbigpIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX1JFVEFJ\nTkVEX0NPTk4pICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxsIHN0\nb3JlIHRvIHJldGFpbiBjb25uZWN0aW9uIGlmIHdlIGhhdmVuJ3QgYWxyZWFk\neS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJldGFpbkNvbm5lY3Rpb24o\nKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NPTk4p\nID09IDApIHsKICAgICAgICAgICAgX3N0b3JlLnJldGFpbkNvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUkVUQUlORURfQ09OTjsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxsIHN0b3JlIHRv\nIHJlbGVhc2UgY29ubmVjdGlvbiBpZiB3ZSBoYXZlIHJldGFpbmVkIG9uZS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VDb25uZWN0aW9uKCkg\newogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19SRVRBSU5FRF9DT05OKSAh\nPSAwKSB7CiAgICAgICAgICAgIF9zdG9yZS5yZWxlYXNlQ29ubmVjdGlvbigp\nOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUkVUQUlORURfQ09OTjsK\nICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBDYWNoZQog\nICAgLy8vLy8vLy8vCgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0TWFuYWdl\nZE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdlZE9i\namVjdENvbGxlY3Rpb24oZ2V0TWFuYWdlZFN0YXRlcygpKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VHJhbnNhY3Rp\nb25hbE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2Up\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTWFuYWdl\nZE9iamVjdENvbGxlY3Rpb24oZ2V0VHJhbnNhY3Rpb25hbFN0YXRlcygpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nUGVuZGluZ1RyYW5zYWN0aW9uYWxPYmplY3RzKCkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAgICAgICAg\nICAgICAoZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxTdGF0ZXMoKSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldERpcnR5\nT2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNYW5hZ2VkT2Jq\nZWN0Q29sbGVjdGlvbihnZXREaXJ0eVN0YXRlcygpKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0T3JkZXJEaXJ0eU9iamVj\ndHMoKSB7CiAgICAgICAgcmV0dXJuIF9vcmRlckRpcnR5OwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldE9yZGVyRGlydHlPYmplY3RzKGJvb2xlYW4gb3Jk\nZXIpIHsKICAgICAgICBfb3JkZXJEaXJ0eSA9IG9yZGVyOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgbWFuYWdlZCBzdGF0\nZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24g\nZ2V0TWFuYWdlZFN0YXRlcygpIHsKICAgICAgICByZXR1cm4gX2NhY2hlLmNv\ncHkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvcHkgb2Yg\nYWxsIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBDb2xsZWN0aW9uIGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMo\nKSB7CiAgICAgICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQog\nICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAg\nICAgIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5KCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIG9yIG5vdCB0aGVyZSBhcmUgYW55IHRyYW5zYWN0\naW9uYWwgb2JqZWN0cyBpbiB0aGUgY3VycmVudAogICAgICogcGVyc2lzdGVu\nY2UgY29udGV4dC4gSWYgdGhlcmUgYXJlIGFueSBpbnN0YW5jZXMgd2l0aCB1\nbnRyYWNrZWQgc3RhdGUsCiAgICAgKiB0aGlzIG1ldGhvZCB3aWxsIGNhdXNl\nIHRob3NlIGluc3RhbmNlcyB0byBiZSBzY2FubmVkLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSB7CiAg\nICAgICAgX2NhY2hlLmRpcnR5Q2hlY2soKTsKICAgICAgICByZXR1cm4gX3Ry\nYW5zQ2FjaGUgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJzLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXREaXJ0eVN0YXRlcygpIHsK\nICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAg\nICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CgogICAgICAg\nIHJldHVybiBfdHJhbnNDYWNoZS5jb3B5RGlydHkoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHN0YXRlIG1hbmFnZXJz\nIHdoaWNoIHdpbGwgYmVjb21lCiAgICAgKiB0cmFuc2FjdGlvbmFsIHVwb24g\ndGhlIG5leHQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBD\nb2xsZWN0aW9uIGdldFBlbmRpbmdUcmFuc2FjdGlvbmFsU3RhdGVzKCkgewog\nICAgICAgIGlmIChfcGVuZGluZyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgIHJldHVybiBuZXcg\nTGlua2VkSGFzaFNldChfcGVuZGluZyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGNhY2hlZCBTdGF0ZU1hbmFnZXIgZm9yIHRoZSBpbnN0YW5j\nZSB0aGF0IGhhZCB0aGUgZ2l2ZW4gb2lkLgogICAgICogVGhpcyBtZXRob2Qg\nbXVzdCBub3QgYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZvciBuZXcgaW5z\ndGFuY2VzLgogICAgICoKICAgICAqIEBwYXJhbSBpZCB0aGUgaWQgcHJldmlv\ndXNseSB1c2VkIGJ5IHRoZSBpbnN0YW5jZQogICAgICogQHBhcmFtIHNtIHRo\nZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgaW5zdGFuY2U7IGlmIHRoZSBzdGF0\nZQogICAgICogbWFuYWdlciBpcyB0cmFuc2llbnQsIHdlJ2xsIHN0b3AgbWFu\nYWdpbmcgdGhlIGluc3RhbmNlOwogICAgICogaWYgaXQgaGFzIHVwZGF0ZWQg\naXRzIG9pZCwgd2UnbGwgcmUtY2FjaGUgdW5kZXIgdGhlIG5ldyBvaWQKICAg\nICAqIEBwYXJhbSBzdGF0dXMgb25lIG9mIG91ciBTVEFUVVMgY29uc3RhbnRz\nIGRlc2NyaWJpbmcgd2h5IHdlJ3JlCiAgICAgKiBzZXR0aW5nIHRoZSBzdGF0\nZSBtYW5hZ2VyCiAgICAgKi8KICAgIHZvaWQgc2V0U3RhdGVNYW5hZ2VyKE9i\namVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSwgaW50IHN0YXR1cykgewog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBzd2l0\nY2ggKHN0YXR1cykgewogICAgICAgICAgICAgICAgY2FzZSBTVEFUVVNfSU5J\nVDoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUuYWRkKHNtKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgU1RB\nVFVTX1RSQU5TSUVOVDoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUucmVt\nb3ZlKGlkLCBzbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIFNUQVRVU19PSURfQVNTSUdOOgogICAgICAgICAg\nICAgICAgICAgIF9jYWNoZS5hc3NpZ25PYmplY3RJZChpZCwgc20pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBT\nVEFUVVNfQ09NTUlUX05FVzoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUu\nY29tbWl0TmV3KGlkLCBzbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZnkg\ndGhlIGJyb2tlciB0aGF0IHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VyIHNob3Vs\nZAogICAgICogYmUgYWRkZWQgdG8gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52\nb2x2ZWQgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAg\nIHZvaWQgYWRkVG9UcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7\nCiAgICAgICAgLy8gd2Ugb25seSBhZGQgY2xlYW4gaW5zdGFuY2VzIG5vdzsg\nZGlydHkgaW5zdGFuY2VzIGFyZSBhZGRlZCBpbgogICAgICAgIC8vIHRoZSBz\nZXREaXJ0eSBjYWxsYmFjawogICAgICAgIGlmIChzbS5pc0RpcnR5KCkpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICghaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMo\nKSkKICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0\naW9uYWxDYWNoZShfb3JkZXJEaXJ0eSk7CiAgICAgICAgICAgIF90cmFuc0Nh\nY2hlLmFkZENsZWFuKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBOb3RpZnkgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgdGhhdCB0aGUgZ2l2\nZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAqIGJlIHJlbW92ZWQgZnJv\nbSB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZlZCBpbiB0aGUgY3VycmVu\ndCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgdm9pZCByZW1vdmVGcm9tVHJh\nbnNhY3Rpb24oU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3RyYW5zQ2FjaGUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIC8vIGludGVudGlvbmFsIGRpcmVj\ndCBhY2Nlc3M7IHdlIGRvbid0IHdhbnQgdG8gcmVjb21wdXRlCiAgICAgICAg\nICAgICAgICAvLyBkaXJ0aW5lc3Mgd2hpbGUgcmVtb3ZpbmcgaW5zdGFuY2Vz\nIGZyb20gdGhlIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAgICBfdHJhbnND\nYWNoZS5yZW1vdmUoc20pOwogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUg\nIT0gbnVsbCAmJiAhc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAg\nICBfZGVyZWZDYWNoZS5yZW1vdmUoc20pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE5vdGlmaWNhdGlvbiB0aGF0IHRoZSBnaXZlbiBpbnN0YW5j\nZSBoYXMgYmVlbiBkaXJ0aWVkLiBUaGlzCiAgICAgKiBub3RpZmljYXRpb24g\naXMgZ2l2ZW4gd2hlbiBhbiBvYmplY3QgZmlyc3QgdHJhbnNpdGlvbnMgdG8g\nYSBkaXJ0eSBzdGF0ZSwKICAgICAqIGFuZCBldmVyeSB0aW1lIHRoZSBvYmpl\nY3QgaXMgbW9kaWZpZWQgYnkgdGhlIHVzZXIgdGhlcmVhZnRlci4KICAgICAq\nLwogICAgdm9pZCBzZXREaXJ0eShTdGF0ZU1hbmFnZXJJbXBsIHNtLCBib29s\nZWFuIGZpcnN0RGlydHkpIHsKICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50\nKCkpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0ZMVVNIX1JFUVVJUkVE\nOwoKICAgICAgICBpZiAoX3NhdmVwb2ludHMgIT0gbnVsbCAmJiAhX3NhdmVw\nb2ludHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlmIChfc2F2ZXBvaW50\nQ2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNo\nZSA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIF9zYXZlcG9pbnRDYWNo\nZS5hZGQoc20pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpcnN0RGlydHkg\nJiYgc20uaXNUcmFuc2FjdGlvbmFsKCkpIHsKICAgICAgICAgICAgbG9jaygp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gY2FjaGUg\nZGlydHkgaW5zdGFuY2UKICAgICAgICAgICAgICAgIGlmICghaGFzVHJhbnNh\nY3Rpb25hbE9iamVjdHMoKSkKICAgICAgICAgICAgICAgICAgICBfdHJhbnND\nYWNoZSA9IG5ldyBUcmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOwog\nICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUuYWRkRGlydHkoc20pOwoKICAg\nICAgICAgICAgICAgIC8vIGFsc28gcmVjb3JkIHRoYXQgdGhlIGNsYXNzIGlz\nIGRpcnR5CiAgICAgICAgICAgICAgICBpZiAoc20uaXNOZXcoKSkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChfcGVyc2lzdGVkQ2xzcyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcyA9IG5ldyBI\nYXNoU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgX3BlcnNpc3RlZENsc3Mu\nYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoc20uaXNEZWxldGVkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoX2RlbGV0ZWRDbHNzID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9kZWxldGVkQ2xzcyA9IG5ldyBIYXNo\nU2V0KCk7CiAgICAgICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzLmFkZChz\nbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChfdXBk\nYXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgX3Vw\nZGF0ZWRDbHNzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgICAgICAg\nICBfdXBkYXRlZENsc3MuYWRkKHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAvLyBpZiB0cmFja2luZyBjaGFuZ2VzIGFuZCB0aGlzIGluc3RhbmNlIHdh\nc24ndCBhbHJlYWR5IGRpcnR5LAogICAgICAgICAgICAgICAgLy8gYWRkIHRv\nIGNoYW5nZWQgc2V0OyB3ZSB1c2UgdGhpcyBmb3IgZGV0ZWN0aW5nIGluc3Rh\nbmNlcyB0aGF0CiAgICAgICAgICAgICAgICAvLyBlbnRlciB0aGUgdHJhbnNh\nY3Rpb24gZHVyaW5nIHByZSBzdG9yZQogICAgICAgICAgICAgICAgaWYgKChf\nZmxhZ3MgJiBGTEFHX1BSRVNUT1JJTkcpICE9IDApIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoX3RyYW5zQWRkaXRpb25zID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG5ldyBIYXNoU2V0\nKCk7CiAgICAgICAgICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zLmFkZChz\nbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmeSB0aGUgYnJva2Vy\nIHRoYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBi\nZSBhZGRlZCB0byB0aGUgc2V0IG9mIGluc3RhbmNlcyB0aGF0IHdpbGwgYmVj\nb21lIHRyYW5zYWN0aW9uYWwKICAgICAqIG9uIHRoZSBuZXh0IHRyYW5zYWN0\naW9uCiAgICAgKi8KICAgIHZvaWQgYWRkVG9QZW5kaW5nVHJhbnNhY3Rpb24o\nU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoX3BlbmRpbmcgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9wZW5kaW5nID0gbmV3IEhhc2hTZXQoKTsKICAgICAg\nICAgICAgX3BlbmRpbmcuYWRkKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBOb3RpZnkgdGhlIHBlcnNpc3RlbmNlIG1hbmFnZXIgdGhhdCB0\naGUgZ2l2ZW4gc3RhdGUgbWFuYWdlciBzaG91bGQKICAgICAqIGJlIHJlbW92\nZWQgZnJvbSB0aGUgc2V0IG9mIGluc3RhbmNlcyBpbnZvbHZlZCBpbiB0aGUg\nbmV4dCB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgdm9pZCByZW1vdmVGcm9t\nUGVuZGluZ1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9w\nZW5kaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfcGVuZGluZy5yZW1v\ndmUoc20pOwogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUgIT0gbnVsbCAm\nJiAhc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgICAgICBfZGVyZWZD\nYWNoZS5yZW1vdmUoc20pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCBhIGRlcmVmZXJlbmNlZCBkZXBlbmRlbnQgb2JqZWN0IHRvIHRoZSBw\nZXJzaXN0ZW5jZSBtYW5hZ2VyJ3MgY2FjaGUuCiAgICAgKiBPbiBmbHVzaCwg\ndGhlc2Ugb2JqZWN0cyB3aWxsIGJlIGRlbGV0ZWQuCiAgICAgKi8KICAgIHZv\naWQgYWRkRGVyZWZlcmVuY2VkRGVwZW5kZW50KFN0YXRlTWFuYWdlckltcGwg\nc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBmbHVzaCBhbmQgaW50\ncm9kdWNpbmcgbW9yZSBkZXJlZnMKICAgICAgICAgICAgLy8gdmlhIGluc3Rh\nbmNlIGNhbGxiYWNrcywgYWRkIHRoZW0gdG8gdGhlIHNwZWNpYWwgYWRkaXRp\nb25zIHNldAogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfREVSRUZE\nRUxFVElORykgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9kZXJlZkFk\nZGl0aW9ucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9kZXJlZkFk\nZGl0aW9ucyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgICAgICBfZGVy\nZWZBZGRpdGlvbnMuYWRkKHNtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIGlmIChfZGVyZWZDYWNoZSA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbmV3IEhhc2hTZXQoKTsKICAg\nICAgICAgICAgICAgIF9kZXJlZkNhY2hlLmFkZChzbSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92\nZSB0aGUgZ2l2ZW4gcHJldmlvdXNseSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50\nIG9iamVjdCBmcm9tIHRoZQogICAgICogY2FjaGUuIEl0IGlzIG5vdyByZWZl\ncmVuY2VkLgogICAgICovCiAgICB2b2lkIHJlbW92ZURlcmVmZXJlbmNlZERl\ncGVuZGVudChTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmVtb3ZlZCA9\nIGZhbHNlOwogICAgICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZW1vdmVkID0gX2RlcmVmQWRkaXRpb25z\nLnJlbW92ZShzbSk7CiAgICAgICAgICAgIGlmICghcmVtb3ZlZCAmJiAoX2Rl\ncmVmQ2FjaGUgPT0gbnVsbCB8fCAhX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKSkp\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3QtZGVyZWZlZCIsCiAgICAgICAgICAgICAgICAg\nICAgRXhjZXB0aW9ucy50b1N0cmluZyhzbS5nZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSkpKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpLgogICAgICAgICAgICAgICAgICAgIHNl\ndEZhdGFsKHRydWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBk\naXJ0eVR5cGUoQ2xhc3MgY2xzKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9u\nKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3VwZGF0\nZWRDbHNzID09IG51bGwpCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3Mg\nPSBuZXcgSGFzaFNldCgpOwogICAgICAgICAgICBfdXBkYXRlZENsc3MuYWRk\nKGNscyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0\naW9uIGdldFBlcnNpc3RlZFR5cGVzKCkgewogICAgICAgIGlmIChfcGVyc2lz\ndGVkQ2xzcyA9PSBudWxsIHx8IF9wZXJzaXN0ZWRDbHNzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlQ29sbGVjdGlv\nbihfcGVyc2lzdGVkQ2xzcyk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rp\nb24gZ2V0VXBkYXRlZFR5cGVzKCkgewogICAgICAgIGlmIChfdXBkYXRlZENs\nc3MgPT0gbnVsbCB8fCBfdXBkYXRlZENsc3MuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0aW9uKF91cGRh\ndGVkQ2xzcyk7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0RGVs\nZXRlZFR5cGVzKCkgewogICAgICAgIGlmIChfZGVsZXRlZENsc3MgPT0gbnVs\nbCB8fCBfZGVsZXRlZENsc3MuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgIHJldHVybiBDb2xs\nZWN0aW9ucy51bm1vZGlmaWFibGVDb2xsZWN0aW9uKF9kZWxldGVkQ2xzcyk7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8KICAgIC8vIENsb3NpbmcKICAgIC8v\nLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7CiAg\nICAgICAgcmV0dXJuIF9jbG9zZWQ7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaXNDbG9zZUludm9rZWQoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZWQg\nfHwgKF9mbGFncyAmIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdGhy\nb3cgYW4gZXhjZXB0aW9uIGlmIGNsb3NpbmcgaW4gYW4gYWN0aXZlIGxvY2Fs\nIHRyYW5zCiAgICAgICAgICAgIGlmICghX21hbmFnZWQgJiYgKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiYWN0aXZlIikpOwoK\nICAgICAgICAgICAgLy8gb25seSBjbG9zZSBpZiBub3QgYWN0aXZlOyBpZiBh\nY3RpdmUgbWFuYWdlZCB0cmFucyB3YWl0CiAgICAgICAgICAgIC8vIGZvciBj\nb21wbGV0aW9uCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX0NMT1NFX0lO\nVk9LRUQ7CgogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZF\nKSA9PSAwKQogICAgICAgICAgICAgICAgZnJlZSgpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEZyZWUgdGhlIHJlc291cmNlcyB1c2Vk\nIGJ5IHRoaXMgcGVyc2lzdGVuY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgZnJlZSgpIHsKICAgICAgICBSdW50aW1lRXhjZXB0aW9u\nIGVyciA9IG51bGw7CiAgICAgICAgaWYgKChfYXV0b0RldGFjaCAmIERFVEFD\nSF9DTE9TRSkgIT0gMCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgZGV0YWNoQWxsSW50ZXJuYWwoX2NhbGwpOwogICAgICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAg\nICBlcnIgPSByZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nX3N5bmMgPSBudWxsOwogICAgICAgIF91c2VyT2JqZWN0cyA9IG51bGw7CiAg\nICAgICAgX2NhY2hlLmNsZWFyKCk7CiAgICAgICAgX3RyYW5zQ2FjaGUgPSBu\ndWxsOwogICAgICAgIF9wZXJzaXN0ZWRDbHNzID0gbnVsbDsKICAgICAgICBf\ndXBkYXRlZENsc3MgPSBudWxsOwogICAgICAgIF9kZWxldGVkQ2xzcyA9IG51\nbGw7CiAgICAgICAgX2RlcmVmQ2FjaGUgPSBudWxsOwogICAgICAgIF9wZW5k\naW5nID0gbnVsbDsKICAgICAgICBfbG9hZGVyID0gbnVsbDsKICAgICAgICBf\ndHJhbnNFdmVudE1hbmFnZXIgPSBudWxsOwogICAgICAgIF9saWZlRXZlbnRN\nYW5hZ2VyID0gbnVsbDsKCiAgICAgICAgT3BlbkpQQVNhdmVwb2ludCBzYXZl\nOwogICAgICAgIHdoaWxlIChfc2F2ZXBvaW50cyAhPSBudWxsICYmICFfc2F2\nZXBvaW50cy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgc2F2ZSA9CiAgICAg\nICAgICAgICAgICAoT3BlbkpQQVNhdmVwb2ludCkgX3NhdmVwb2ludHMucmVt\nb3ZlKF9zYXZlcG9pbnRzLnNpemUoKSAtIDEpOwogICAgICAgICAgICBzYXZl\nLnJlbGVhc2UoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBfc2F2ZXBvaW50\ncyA9IG51bGw7CiAgICAgICAgX3NhdmVwb2ludENhY2hlID0gbnVsbDsKCiAg\nICAgICAgaWYgKF9xdWVyaWVzICE9IG51bGwpIHsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBfcXVlcmllcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAoKFF1ZXJ5KSBpdHIubmV4dCgpKS5jbG9zZVJlc291cmNlcygp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBy\nZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIF9xdWVyaWVzID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmIChf\nZXh0ZW50cyAhPSBudWxsKSB7CiAgICAgICAgICAgIEV4dGVudCBlOwogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9leHRlbnRzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlID0gKEV4\ndGVudCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgZS5jbG9zZUFsbCgpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9leHRlbnRzID0gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIHRyeSB7IHJlbGVhc2VDb25uZWN0aW9u\nKCk7IH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHt9CgogICAgICAg\nIF9sbS5jbG9zZSgpOwogICAgICAgIF9zdG9yZS5jbG9zZSgpOwogICAgICAg\nIF9mbGFncyA9IDA7CiAgICAgICAgX2Nsb3NlZCA9IHRydWU7CiAgICAgICAg\naWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2Nsb3Nl\nZEV4Y2VwdGlvbiA9IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsKCiAg\nICAgICAgaWYgKGVyciAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBlcnI7\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU3luY2hy\nb25pemF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGlj\nIHZvaWQgbG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAg\nICAgICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAg\nICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KICAgIC8vIFN0YXRlIG1hbmFnZW1lbnQKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBuZXdJbnN0YW5jZShD\nbGFzcyBjbHMpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CgogICAgICAgIGlm\nIChjbHMuaXNJbnRlcmZhY2UoKSkgewogICAgICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5j\nZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9hZGVy\nLCB0cnVlKTsKICAgICAgICAgICAgY2xzID0gbWV0YS5nZXRJbnRlcmZhY2VJ\nbXBsKCk7CiAgICAgICAgfSBlbHNlIGlmIChNb2RpZmllci5pc0Fic3RyYWN0\nKGNscy5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbihfbG9jLmdldAogICAgICAg\nICAgICAgICAgKCJuZXctYWJzdHJhY3QiLCBjbHMpLmdldE1lc3NhZ2UoKSk7\nCgogICAgICAgIC8vIDEuNSBkb2Vzbid0IGluaXRpYWxpemUgY2xhc3NlcyB3\naXRob3V0IGEgdHJ1ZSBDbGFzcy5mb3JOYW1lCiAgICAgICAgaWYgKCFQQ1Jl\nZ2lzdHJ5LmlzUmVnaXN0ZXJlZChjbHMpKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNscy5nZXROYW1lKCks\nIHRydWUsIAogICAgICAgICAgICAgICAgICAgIChDbGFzc0xvYWRlcikgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNs\ncykpKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gUENSZWdpc3Ry\neS5uZXdJbnN0YW5jZShjbHMsIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGdldE9iamVjdElkKE9iamVjdCBvYmopIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5h\nZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50\nb1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkKICAgICAgICAgICAg\nICAgIC5wY0ZldGNoT2JqZWN0SWQoKTsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldExvY2tMZXZlbChPYmplY3Qgbykg\newogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAobyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gTG9ja0xldmVscy5MT0NLX05PTkU7Cgog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBnZXRTdGF0ZU1hbmFn\nZXIobyk7CiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsKICAgICAgICByZXR1cm4gZ2V0\nTG9ja01hbmFnZXIoKS5nZXRMb2NrTGV2ZWwoc20pOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZ2V0VmVyc2lvbihPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9Q\nZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjR2V0VmVyc2lvbigp\nOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzRGlydHkoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkg\newogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVs\ncGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwogICAgICAg\nICAgICByZXR1cm4gcGMucGNJc0RpcnR5KCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1Ry\nYW5zYWN0aW9uYWwoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4o\nKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkK\nICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VD\nYXBhYmxlKG9iaiwgX2NvbmYpKQogICAgICAgICAgICAgICAgLnBjSXNUcmFu\nc2FjdGlvbmFsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzUGVyc2lzdGVudChPYmplY3Qgb2JqKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlz\nTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxw\nZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpLnBjSXNQZXJz\naXN0ZW50KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzTmV3KE9iamVjdCBvYmopIHsKICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxl\nKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNp\nc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNJc05ldygpOwogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Rl\nbGV0ZWQoT2JqZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAg\nICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkKICAgICAg\nICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxl\nKG9iaiwgX2NvbmYpKS5wY0lzRGVsZXRlZCgpOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RldGFjaGVkKE9i\namVjdCBvYmopIHsKICAgICAgICBpZiAoIShJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBsSGVscGVyLnRvUGVyc2lz\ndGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpOwogICAgICAgIEJvb2xlYW4gZGV0\nYWNoZWQgPSBwYy5wY0lzRGV0YWNoZWQoKTsKICAgICAgICBpZiAoZGV0YWNo\nZWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRldGFjaGVkLmJvb2xl\nYW5WYWx1ZSgpOwoKICAgICAgICAvLyBsYXN0IHJlc29ydDogaW5zdGFuY2Ug\naXMgZGV0YWNoZWQgaWYgaXQgaGFzIGEgc3RvcmUgcmVjb3JkCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0TWV0YURhdGEoSW1wbEhl\nbHBlci5nZXRNYW5hZ2VkSW5zdGFuY2UocGMpLmdldENsYXNzKCksCiAgICAg\nICAgICAgICAgICBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBPYmplY3Qgb2lk\nID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKHBjLCBtZXRhKTsKICAgICAgICBp\nZiAob2lkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICByZXR1cm4gZmluZChvaWQsIG51bGwsIEVYQ0xVREVfQUxMLCBudWxs\nLCAwKSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIGdldFN0YXRlTWFuYWdlcihPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIHJldHVybiBnZXRTdGF0ZU1hbmFnZXJJ\nbXBsKG9iaiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgZ2l2ZW4gaW5zdGFuY2UsIG9y\nIG51bGwuCiAgICAgKgogICAgICogQHBhcmFtIGFzc2VydFRoaXNDb250ZXh0\nIGlmIHRydWUsIHRob3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBnaXZlbgogICAg\nICogb2JqZWN0IGlzIG1hbmFnZWQgYnkgYW5vdGhlciBicm9rZXIKICAgICAq\nLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdlckltcGwgZ2V0U3RhdGVNYW5h\nZ2VySW1wbChPYmplY3Qgb2JqLAogICAgICAgIGJvb2xlYW4gYXNzZXJ0VGhp\nc0NvbnRleHQpIHsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFi\nbGUob2JqKSkgewogICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMg\nPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYp\nOwogICAgICAgICAgICBpZiAocGMucGNHZXRHZW5lcmljQ29udGV4dCgpID09\nIHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gKFN0YXRlTWFuYWdlcklt\ncGwpIHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIGlmIChh\nc3NlcnRUaGlzQ29udGV4dCAmJiBwYy5wY0dldEdlbmVyaWNDb250ZXh0KCkg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3QtbWFuYWdlZCIsCiAgICAgICAgICAgICAgICAg\nICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuc2V0RmFpbGVkT2JqZWN0\nKG9iaik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0\naGUgZ2l2ZW4gb2lkLgogICAgICoKICAgICAqIEBwYXJhbSBhbGxvd05ldyBp\nZiB0cnVlLCBvYmplY3RzIG1hZGUgcGVyc2lzdGVudCBpbiB0aGUgY3VycmVu\ndAogICAgICogdHJhbnNhY3Rpb24gd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUg\nc2VhcmNoOyBpZgogICAgICogbXVsdGlwbGUgbmV3IG9iamVjdHMgbWF0Y2gg\ndGhlIGdpdmVuIG9pZCwgaXQgaXMKICAgICAqIHVuZGVmaW5lZCB3aGljaCB3\naWxsIGJlIHJldHVybmVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1h\nbmFnZXJJbXBsIGdldFN0YXRlTWFuYWdlckltcGxCeUlkKE9iamVjdCBvaWQs\nCiAgICAgICAgYm9vbGVhbiBhbGxvd05ldykgewogICAgICAgIHJldHVybiBf\nY2FjaGUuZ2V0QnlJZChvaWQsIGFsbG93TmV3KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZ2l2ZW4gaW5zdGFuY2UgYXMgYSB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlfS4KICAgICAqIElmIHRoZSBpbnN0YW5jZSBp\ncyBub3QgbWFuYWdlYWJsZSB0aHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlvbi4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBhc3Nl\ncnRQZXJzaXN0ZW5jZUNhcGFibGUoT2JqZWN0IG9iaikgewogICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAg\nICAgIHJldHVybiBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9i\naiwgX2NvbmYpOwoKICAgICAgICAvLyBjaGVjayBmb3IgZGlmZmVyZW50IGlu\nc3RhbmNlcyBvZiB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZQog\nICAgICAgIC8vIGFuZCB0aHJvdyBhIGJldHRlciBlcnJvciB0aGF0IG1lbnRp\nb25zIHRoZSBjbGFzcyBsb2FkZXJzCiAgICAgICAgQ2xhc3NbXSBpbnRmcyA9\nIG9iai5nZXRDbGFzcygpLmdldEludGVyZmFjZXMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaW50ZnMgIT0gbnVsbCAmJiBpIDwgaW50ZnMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKGludGZzW2ldLmdldE5hbWUoKS5l\ncXVhbHMoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmdldE5hbWUoKSkpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJwYy1sb2FkZXItZGlmZmVyZW50IiwKICAgICAgICAgICAgICAgICAg\nICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaiksCiAgICAgICAgICAgICAgICAg\nICAgKENsYXNzTG9hZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZCgKICAgICAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0\nQ2xhc3NMb2FkZXJBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpKSwKICAgICAgICAgICAgICAg\nICAgICAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5n\nZXRDbGFzc0xvYWRlckFjdGlvbihpbnRmc1tpXSkpKSkKICAgICAgICAgICAg\nICAgICAgICAuc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIG5vdCBlbmhhbmNlZAogICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJwYy1jYXN0IiwKICAg\nICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuc2V0RmFpbGVk\nT2JqZWN0KG9iaik7CiAgICB9CgogICAgLy8vLy8vLy8vCiAgICAvLyBVdGls\ncwogICAgLy8vLy8vLy8vCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4Y2Vw\ndGlvbiBpZiB0aGUgY29udGV4dCBpcyBjbG9zZWQuICBUaGUgZXhhY3QgbWVz\nc2FnZSBhbmQKICAgICAqIGNvbnRlbnQgb2YgdGhlIGV4Y2VwdGlvbiB2YXJp\nZXMgd2hldGhlciBUUkFDRSBpcyBlbmFibGVkIG9yIG5vdC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgYXNzZXJ0T3BlbigpIHsKICAgICAgICBpZiAoX2Ns\nb3NlZCkgewogICAgICAgICAgICBpZiAoX2Nsb3NlZEV4Y2VwdGlvbiA9PSBu\ndWxsKSAgLy8gVFJBQ0Ugbm90IGVuYWJsZWQKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoImNsb3Nl\nZC1ub3RyYWNlIikpCiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRGYXRh\nbCh0cnVlKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2xvc2Vk\nIiksCiAgICAgICAgICAgICAgICAgICAgICAgIF9jbG9zZWRFeGNlcHRpb24p\nLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpIHsKICAgICAgICBpZiAo\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSA9PSAwKQogICAgICAgICAgICB0aHJv\ndyBuZXcgTm9UcmFuc2FjdGlvbkV4Y2VwdGlvbihfbG9jLmdldCgibm90LWFj\ndGl2ZSIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGV4Y2VwdGlv\nbiBpZiBhIHRyYW5zYWN0aW9uLXJlbGF0ZWQgb3BlcmF0aW9uIGlzIGF0dGVt\ncHRlZCBhbmQKICAgICAqIG5vIHRyYW5zYWN0aW9uIGlzIGFjdGl2ZS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydFRyYW5zYWN0aW9uT3BlcmF0\naW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09\nIDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vdC1hY3RpdmUiKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKSB7CiAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCAmJiAhX25vbnRyYW5z\nUmVhZCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgibm9uLXRyYW5zLXJlYWQiKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgYXNzZXJ0V3JpdGVPcGVyYXRpb24oKSB7CiAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCAmJiAoIV9ub250cmFu\nc1dyaXRlCiAgICAgICAgICAgIHx8IChfYXV0b0RldGFjaCAmIERFVEFDSF9O\nT05UWFJFQUQpICE9IDApKQogICAgICAgICAgICB0aHJvdyBuZXcgTm9UcmFu\nc2FjdGlvbkV4Y2VwdGlvbihfbG9jLmdldCgid3JpdGUtb3BlcmF0aW9uIikp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFuIG9iamVjdCBub3Qg\nZm91bmQgZXhjZXB0aW9uIGNvbnRhaW5pbmcgbmVzdGVkIGV4Y2VwdGlvbnMK\nICAgICAqIGZvciBhbGwgb2YgdGhlIGdpdmVuIGZhaWxlZCBvYmplY3RzLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbiBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbgogICAgICAgIChDb2xs\nZWN0aW9uIGZhaWxlZCkgewogICAgICAgIFRocm93YWJsZVtdIHQgPSBuZXcg\nVGhyb3dhYmxlW2ZhaWxlZC5zaXplKCldOwogICAgICAgIGludCBpZHggPSAw\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmFpbGVkLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7IGlkeCsrKQogICAgICAgICAgICB0W2lkeF0g\nPSBuZXcgT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oaXRyLm5leHQoKSk7CiAg\nICAgICAgcmV0dXJuIG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWls\nZWQsIHQpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBGaW5kQ2FsbGJhY2tzIGltcGxlbWVudGF0aW9uCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1Ymxp\nYyBPYmplY3QgcHJvY2Vzc0FyZ3VtZW50KE9iamVjdCBvaWQpIHsKICAgICAg\nICByZXR1cm4gb2lkOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgcHJvY2Vz\nc1JldHVybihPYmplY3Qgb2lkLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7\nCiAgICAgICAgcmV0dXJuIChzbSA9PSBudWxsKSA/IG51bGwgOiBzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhY2hl\nIG9mIG1hbmFnZWQgb2JqZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgTWFuYWdlZENhY2hlIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBNYXAgX21haW47IC8vIG9pZCAtPiBzbQogICAgICAgIHByaXZhdGUgTWFw\nIF9jb25mbGljdHMgPSBudWxsOyAvLyBjb25mbGljdCBvaWQgLT4gbmV3IHNt\nCiAgICAgICAgcHJpdmF0ZSBNYXAgX25ld3MgPSBudWxsOyAvLyB0bXAgaWQg\nLT4gbmV3IHNtCiAgICAgICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF9lbWJlZHMg\nPSBudWxsOyAvLyBlbWJlZGRlZC9ub24tcGVyc2lzdGVudCBzbXMKICAgICAg\nICBwcml2YXRlIENvbGxlY3Rpb24gX3VudHJhY2tlZCA9IG51bGw7IC8vIGhh\ncmQgcmVmcyB0byB1bnRyYWNrZWQgc21zCgogICAgICAgIC8qKgogICAgICAg\nICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgcHJpbWFyeSBjYWNoZSBtYXAuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIE1hbmFnZWRDYWNoZShNYXAgY2Fj\naGUpIHsKICAgICAgICAgICAgX21haW4gPSBjYWNoZTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgaW5zdGFuY2UgZm9y\nIHRoZSBnaXZlbiBvaWQsIG9wdGlvbmFsbHkgYWxsb3dpbmcKICAgICAgICAg\nKiBuZXcgaW5zdGFuY2VzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBT\ndGF0ZU1hbmFnZXJJbXBsIGdldEJ5SWQoT2JqZWN0IG9pZCwgYm9vbGVhbiBh\nbGxvd05ldykgewogICAgICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8vIGNoZWNr\nIG1haW4gY2FjaGUgZm9yIG9pZAogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWluLmdldChvaWQpOwog\nICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtMjsKICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGl0J3Mg\nYSBuZXcgaW5zdGFuY2UsIHdlIGtub3cgaXQncyB0aGUgb25seSBtYXRjaCwg\nYmVjYXVzZQogICAgICAgICAgICAgICAgLy8gb3RoZXIgcGVycyBpbnN0YW5j\nZXMgb3ZlcnJpZGUgbmV3IGluc3RhbmNlcyBpbiBfY2FjaGUKICAgICAgICAg\nICAgICAgIGlmIChzbS5pc05ldygpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiAoYWxsb3dOZXcpID8gc20gOiBudWxsOwogICAgICAgICAgICAgICAg\naWYgKCFhbGxvd05ldyB8fCAhc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHNtOwoKICAgICAgICAgICAgICAgIC8vIHNtIGlz\nIGRlbGV0ZWQ7IGNoZWNrIGNvbmZsaWN0IGNhY2hlCiAgICAgICAgICAgICAg\nICBpZiAoX2NvbmZsaWN0cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgc20yID0gKFN0YXRlTWFuYWdlckltcGwpIF9jb25mbGljdHMuZ2V0KG9p\nZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNtMiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gc20yOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhdCB0aGlzIHBv\naW50IHNtIGlzIG51bGwgb3IgZGVsZXRlZDsgY2hlY2sgdGhlIG5ldyBjYWNo\nZSBmb3IKICAgICAgICAgICAgLy8gYW55IG1hdGNoZXMuIHRoaXMgYWxsb3dz\nIHVzIHRvIG1hdGNoIGFwcCBpZCBvYmplY3RzIHRvIG5ldwogICAgICAgICAg\nICAvLyBpbnN0YW5jZXMgd2l0aG91dCBwZXJtYW5hbnQgb2lkcwogICAgICAg\nICAgICBpZiAoYWxsb3dOZXcgJiYgX25ld3MgIT0gbnVsbCAmJiAhX25ld3Mu\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzbTIgPSAoU3RhdGVNYW5h\nZ2VySW1wbCkgX25ld3MuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAo\nc20yICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNtMjsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBDYWxsIHRoaXMgbWV0aG9kIHdo\nZW4gYSBuZXcgc3RhdGUgbWFuYWdlciBpbml0aWFsaXplcyBpdHNlbGYuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkKFN0YXRlTWFuYWdl\nckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKCFzbS5pc0ludGVyY2VwdGlu\nZygpKSB7CiAgICAgICAgICAgICAgICBpZiAoX3VudHJhY2tlZCA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIF91bnRyYWNrZWQgPSBuZXcgSGFzaFNl\ndCgpOwogICAgICAgICAgICAgICAgX3VudHJhY2tlZC5hZGQoc20pOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXNtLmlzUGVyc2lzdGVudCgp\nIHx8IHNtLmlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgaWYgKF9l\nbWJlZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfZW1iZWRzID0g\nbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsK\nICAgICAgICAgICAgICAgIF9lbWJlZHMuYWRkKHNtKTsKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaW5p\ndGlhbGl6aW5nIG5ldyBpbnN0YW5jZTsgcHV0IGluIG5ldyBjYWNoZSBiZWNh\ndXNlIHdvbid0IGhhdmUKICAgICAgICAgICAgLy8gcGVybWFuZW50IG9pZCB5\nZXQKICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChfbmV3cyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9u\nZXdzID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9uZXdzLnB1\ndChzbS5nZXRJZCgpLCBzbSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGluaXRpYWxpemluZyBwZXJz\naXN0ZW50IGluc3RhbmNlOyBwdXQgaW4gbWFpbiBjYWNoZQogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkg\nX21haW4ucHV0CiAgICAgICAgICAgICAgICAoc20uZ2V0T2JqZWN0SWQoKSwg\nc20pOwogICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwgb3JpZyk7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiZHVwLWxvYWQiLAogICAgICAgICAgICAgICAgICAgIHNtLmdldE9iamVj\ndElkKCksIEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAgICAgICAg\nICAob3JpZy5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpKS4KICAgICAgICAgICAg\nICAgICAgICBzZXRGYWlsZWRPYmplY3Qoc20uZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgZnJvbSB0\naGUgY2FjaGUgd2hlbiBpdCB0cmFuc2l0aW9ucwogICAgICAgICAqIHRvIHRy\nYW5zaWVudC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCByZW1v\ndmUoT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAg\nICAgIC8vIGlmIGl0IGhhcyBhIHBlcm1hbmVudCBvaWQsIHJlbW92ZSBmcm9t\nIG1haW4gLyBjb25mbGljdCBjYWNoZSwKICAgICAgICAgICAgLy8gZWxzZSBy\nZW1vdmUgZnJvbSBlbWJlZGRlZC9ub250cmFucyBjYWNoZSwgYW5kIGlmIG5v\ndCB0aGVyZQogICAgICAgICAgICAvLyByZW1vdmUgZnJvbSBuZXcgY2FjaGUK\nICAgICAgICAgICAgT2JqZWN0IG9yaWc7CiAgICAgICAgICAgIGlmIChzbS5n\nZXRPYmplY3RJZCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9yaWcg\nPSBfbWFpbi5yZW1vdmUoaWQpOwogICAgICAgICAgICAgICAgaWYgKG9yaWcg\nIT0gc20pIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3JpZyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgICAgICBfbWFpbi5wdXQoaWQsIG9yaWcp\nOyAvLyBwdXQgYmFjawogICAgICAgICAgICAgICAgICAgIGlmIChfY29uZmxp\nY3RzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZyA9\nIF9jb25mbGljdHMucmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKG9yaWcgIT0gbnVsbCAmJiBvcmlnICE9IHNtKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgX2NvbmZsaWN0cy5wdXQoaWQsIG9yaWcpOyAv\nLyBwdXQgYmFjawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgoX2VtYmVkcyA9PSBudWxs\nIHx8ICFfZW1iZWRzLnJlbW92ZShzbSkpCiAgICAgICAgICAgICAgICAmJiBf\nbmV3cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBvcmlnID0gX25ld3Mu\ncmVtb3ZlKGlkKTsKICAgICAgICAgICAgICAgIGlmIChvcmlnICE9IG51bGwg\nJiYgb3JpZyAhPSBzbSkKICAgICAgICAgICAgICAgICAgICBfbmV3cy5wdXQo\naWQsIG9yaWcpOyAvLyBwdXQgYmFjawogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAoX3VudHJhY2tlZCAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX3VudHJhY2tlZC5yZW1vdmUoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogQW4gZW1iZWRkZWQgb3Igbm9ucGVyc2lzdGVudCBtYW5h\nZ2VkIGluc3RhbmNlIGhhcyBiZWVuIHBlcnNpc3RlZC4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBwZXJzaXN0KFN0YXRlTWFuYWdlckltcGwg\nc20pIHsKICAgICAgICAgICAgaWYgKF9lbWJlZHMgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9lbWJlZHMucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqIEEgbmV3IGluc3RhbmNlIGhhcyBqdXN0IGJl\nZW4gYXNzaWduZWQgYSBwZXJtYW5lbnQgb2lkLgogICAgICAgICAqLwogICAg\nICAgIHB1YmxpYyB2b2lkIGFzc2lnbk9iamVjdElkKE9iamVjdCBpZCwgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICAvLyBpZiBhc3NpZ25p\nbmcgb2lkLCByZW1vdmUgZnJvbSBuZXcgY2FjaGUgYW5kIHB1dCBpbiBwcmlt\nYXJ5OyBtYXkKICAgICAgICAgICAgLy8gbm90IGJlIGluIG5ldyBjYWNoZSBp\nZiBhbm90aGVyIG5ldyBpbnN0YW5jZSBoYWQgc2FtZSBpZAogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcgPSAoU3RhdGVNYW5hZ2VySW1wbCkg\nX25ld3MucmVtb3ZlKGlkKTsKICAgICAgICAgICAgaWYgKG9yaWcgIT0gbnVs\nbCAmJiBvcmlnICE9IHNtKQogICAgICAgICAgICAgICAgX25ld3MucHV0KGlk\nLCBvcmlnKTsgLy8gcHV0IGJhY2sKCiAgICAgICAgICAgIC8vIHB1dCBpbiBt\nYWluIGNhY2hlLCBidXQgbWFrZSBzdXJlIHdlIGRvbid0IHJlcGxhY2UgYW5v\ndGhlcgogICAgICAgICAgICAvLyBpbnN0YW5jZSB3aXRoIHRoZSBzYW1lIG9p\nZAogICAgICAgICAgICBvcmlnID0gKFN0YXRlTWFuYWdlckltcGwpIF9tYWlu\nLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAgICAgICAgICAgIGlmIChv\ncmlnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9tYWluLnB1dChzbS5n\nZXRPYmplY3RJZCgpLCBvcmlnKTsKICAgICAgICAgICAgICAgIGlmICghb3Jp\nZy5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZHVwLW9pZC1hc3NpZ24iLAogICAg\nICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBFeGNlcHRp\nb25zLnRvU3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIChzbS5nZXRN\nYW5hZ2VkSW5zdGFuY2UoKSkpKS4KICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpKTsKCiAg\nICAgICAgICAgICAgICAvLyBzYW1lIG9pZCBhcyBkZWxldGVkIGluc3RhbmNl\nOyBwdXQgaW4gY29uZmxpY3QgY2FjaGUKICAgICAgICAgICAgICAgIGlmIChf\nY29uZmxpY3RzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2NvbmZs\naWN0cyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICBfY29uZmxp\nY3RzLnB1dChzbS5nZXRPYmplY3RJZCgpLCBzbSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEEgbmV3IGluc3Rh\nbmNlIGhhcyBjb21taXR0ZWQ7IHJlY2FjaGUgdW5kZXIgcGVybWFuZW50IG9p\nZC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBjb21taXROZXco\nT2JqZWN0IGlkLCBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAg\nIC8vIGlmIHRoZSBpZCBkaWRuJ3QgY2hhbmdlLCB0aGUgaW5zdGFuY2Ugd2Fz\nIGFscmVhZHkgYXNzaWduZWQgYW4KICAgICAgICAgICAgLy8gaWQsIGJ1dCBp\ndCBjb3VsZCBoYXZlIGJlZW4gaW4gY29uZmxpY3QgY2FjaGUKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBvcmlnOwogICAgICAgICAgICBpZiAoc20u\nZ2V0T2JqZWN0SWQoKSA9PSBpZCkgewogICAgICAgICAgICAgICAgb3JpZyA9\nIChfY29uZmxpY3RzID09IG51bGwpID8gbnVsbAogICAgICAgICAgICAgICAg\nICAgIDogKFN0YXRlTWFuYWdlckltcGwpIF9jb25mbGljdHMucmVtb3ZlKGlk\nKTsKICAgICAgICAgICAgICAgIGlmIChvcmlnID09IHNtKSB7CiAgICAgICAg\nICAgICAgICAgICAgb3JpZyA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbWFpbi5w\ndXQoaWQsIHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAob3JpZyAhPSBu\ndWxsICYmICFvcmlnLmlzRGVsZXRlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIF9tYWluLnB1dChzbS5nZXRPYmplY3RJZCgpLCBvcmlnKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImR1cC1vaWQtYXNzaWduIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHNtLmdldE9iamVjdElkKCksIEV4Y2VwdGlvbnMudG9TdHJp\nbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzbS5nZXRNYW5hZ2Vk\nSW5zdGFuY2UoKSkpKS5zZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIChzbS5nZXRNYW5hZ2VkSW5zdGFuY2UoKSkuc2V0RmF0\nYWwodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBvaWQgY2hhbmdlZCwgc28gaXQgbXVzdCBwcmV2aW91\nc2x5IGhhdmUgYmVlbiBhIG5ldyBpbnN0YW5jZQogICAgICAgICAgICAvLyB3\naXRob3V0IGFuIGFzc2lnbmVkIG9pZC4gIHJlbW92ZSBpdCBmcm9tIHRoZSBu\nZXcgY2FjaGU7IG9rIGlmCiAgICAgICAgICAgIC8vIHdlIGVuZCB1cCByZW1v\ndmluZyBhbm90aGVyIGluc3RhbmNlIHdpdGggc2FtZSBpZAogICAgICAgICAg\nICBpZiAoX25ld3MgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9uZXdzLnJl\nbW92ZShpZCk7CgogICAgICAgICAgICAvLyBhbmQgcHV0IGludG8gbWFpbiBj\nYWNoZSBub3cgdGhhdCBpZCBpcyBhc3NzaWduZWQKICAgICAgICAgICAgb3Jp\nZyA9IChTdGF0ZU1hbmFnZXJJbXBsKSBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0\nSWQoKSwgc20pOwogICAgICAgICAgICBpZiAob3JpZyAhPSBudWxsICYmIG9y\naWcgIT0gc20gJiYgIW9yaWcuaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAg\nICAgIC8vIHB1dCBiYWNrIG9yaWcgYW5kIHRocm93IGVycm9yCiAgICAgICAg\nICAgICAgICBfbWFpbi5wdXQoc20uZ2V0T2JqZWN0SWQoKSwgb3JpZyk7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgiZHVwLW9pZC1hc3NpZ24iLAogICAgICAgICAgICAgICAgICAgIHNtLmdl\ndE9iamVjdElkKCksIEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAg\nICAgICAgICAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuc2V0RmFpbGVk\nT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgKHNtLmdldE1hbmFnZWRJbnN0\nYW5jZSgpKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29weSBvZiBh\nbGwgY2FjaGVkIHBlcnNpc3RlbnQgb2JqZWN0cy4KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgQ29sbGVjdGlvbiBjb3B5KCkgewogICAgICAgICAgICAv\nLyBwcm94aWVzIG5vdCBpbmNsdWRlZCBoZXJlIGJlY2F1c2UgdGhlIHN0YXRl\nIG1hbmFnZXIgaXMgYWx3YXlzCiAgICAgICAgICAgIC8vIHByZXNlbnQgaW4g\nb3RoZXIgY2FjaGVzIHRvbwoKICAgICAgICAgICAgaW50IHNpemUgPSBfbWFp\nbi5zaXplKCk7CiAgICAgICAgICAgIGlmIChfY29uZmxpY3RzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzaXplICs9IF9jb25mbGljdHMuc2l6ZSgpOwog\nICAgICAgICAgICBpZiAoX25ld3MgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHNpemUgKz0gX25ld3Muc2l6ZSgpOwogICAgICAgICAgICBpZiAoX2VtYmVk\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfZW1iZWRzLnNp\nemUoKTsKICAgICAgICAgICAgaWYgKHNpemUgPT0gMCkKICAgICAgICAgICAg\nICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9MSVNUOwoKICAgICAgICAg\nICAgTGlzdCBjb3B5ID0gbmV3IEFycmF5TGlzdChzaXplKTsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSBfbWFpbi52YWx1ZXMoKS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgIGNvcHkuYWRk\nKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAoX2NvbmZsaWN0cyAhPSBu\ndWxsICYmICFfY29uZmxpY3RzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gX2NvbmZsaWN0cy52YWx1ZXMoKS5pdGVy\nYXRvcigpOwogICAgICAgICAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KQog\nICAgICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAg\nICAgICAgICBpZiAoX25ld3MgIT0gbnVsbCAmJiAhX25ld3MuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfbmV3cy52\nYWx1ZXMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAg\nICAgICAgICAgICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAg\naWYgKF9lbWJlZHMgIT0gbnVsbCAmJiAhX2VtYmVkcy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9lbWJlZHMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAg\nY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIHJldHVybiBjb3B5\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXIgdGhl\nIGNhY2hlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgICAgICBfbWFpbi5jbGVhcigpOwogICAgICAgICAgICBp\nZiAoX2NvbmZsaWN0cyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2NvbmZs\naWN0cy5jbGVhcigpOwogICAgICAgICAgICBpZiAoX25ld3MgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF9uZXdzLmNsZWFyKCk7CiAgICAgICAgICAgIGlm\nIChfZW1iZWRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZW1iZWRzLmNs\nZWFyKCk7CiAgICAgICAgICAgIGlmIChfdW50cmFja2VkICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBfdW50cmFja2VkLmNsZWFyKCk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBDbGVhciBuZXcgaW5zdGFuY2VzIHdp\ndGhvdXQgcGVybWFuZW50IG9pZHMuCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIHZvaWQgY2xlYXJOZXcoKSB7CiAgICAgICAgICAgIGlmIChfbmV3cyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX25ld3MuY2xlYXIoKTsKICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBkaXJ0eUNoZWNrKCkgewogICAg\nICAgICAgICBpZiAoX3VudHJhY2tlZCA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdGVyID0g\nX3VudHJhY2tlZC5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTsgKQogICAg\nICAgICAgICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKSBpdGVyLm5leHQoKSku\nZGlydHlDaGVjaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRyYW5zYWN0aW9uYWwgY2FjaGUgdGhhdCBob2xkcyBzb2Z0IHJlZnMgdG8g\nY2xlYW4gaW5zdGFuY2VzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAgICAgICBpbXBsZW1lbnRzIFNl\ndCB7CgogICAgICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBfb3JkZXJEaXJ0\neTsKICAgICAgICBwcml2YXRlIFNldCBfZGlydHkgPSBudWxsOwogICAgICAg\nIHByaXZhdGUgU2V0IF9jbGVhbiA9IG51bGw7CgogICAgICAgIHB1YmxpYyBU\ncmFuc2FjdGlvbmFsQ2FjaGUoYm9vbGVhbiBvcmRlckRpcnR5KSB7CiAgICAg\nICAgICAgIF9vcmRlckRpcnR5ID0gb3JkZXJEaXJ0eTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIHRy\nYW5zYWN0aW9uYWwgc3RhdGUgbWFuYWdlcnMuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIENvbGxlY3Rpb24gY29weSgpIHsKICAgICAgICAgICAgaWYg\nKGlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9u\ncy5FTVBUWV9TRVQ7CgogICAgICAgICAgICAvLyBzaXplIG1heSBub3QgYmUg\nZW50aXJlbHkgYWNjdXJhdGUgZHVlIHRvIHJlZnMgZXhwaXJpbmcsIHNvCiAg\nICAgICAgICAgIC8vIG1hbnVhbGx5IGNvcHkgZWFjaCBvYmplY3Q7IGRvZXNu\nJ3QgbWF0dGVyIHRoaXMgd2F5IGlmIHNpemUgdG9vCiAgICAgICAgICAgIC8v\nIGJpZyBieSBzb21lCiAgICAgICAgICAgIFNldCBjb3B5ID0gbmV3IExpbmtl\nZEhhc2hTZXQoc2l6ZSgpKTsKICAgICAgICAgICAgaWYgKF9kaXJ0eSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfZGly\ndHkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAg\nICAgICAgY29weS5hZGQoaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChf\nY2xlYW4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX2NsZWFuLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAg\nICAgICAgICAgICAgICAgIGNvcHkuYWRkKGl0ci5uZXh0KCkpOwogICAgICAg\nICAgICByZXR1cm4gY29weTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJldHVybiBhIGNvcHkgb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFn\nZXJzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBDb2xsZWN0aW9uIGNv\ncHlEaXJ0eSgpIHsKICAgICAgICAgICAgaWYgKF9kaXJ0eSA9PSBudWxsIHx8\nIF9kaXJ0eS5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gQ29s\nbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgICAgICByZXR1cm4gbmV3IExp\nbmtlZEhhc2hTZXQoX2RpcnR5KTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIFRyYW5zZmVyIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHRo\nZSBkaXJ0eSBjYWNoZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgZmx1c2hlZChTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgICAgIGlmIChzbS5pc0RpcnR5KCkgJiYgX2RpcnR5\nICE9IG51bGwgJiYgX2RpcnR5LnJlbW92ZShzbSkpCiAgICAgICAgICAgICAg\nICBhZGRDbGVhbkludGVybmFsKHNtKTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGNs\nZWFuIGNhY2hlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFk\nZENsZWFuKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYg\nKGFkZENsZWFuSW50ZXJuYWwoc20pICYmIF9kaXJ0eSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX2RpcnR5LnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAg\nICAgICBwcml2YXRlIGJvb2xlYW4gYWRkQ2xlYW5JbnRlcm5hbChTdGF0ZU1h\nbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgICAgIGlmIChfY2xlYW4gPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9jbGVhbiA9IG5ldyBSZWZlcmVuY2VIYXNo\nU2V0KFJlZmVyZW5jZUhhc2hTZXQuU09GVCk7CiAgICAgICAgICAgIHJldHVy\nbiBfY2xlYW4uYWRkKHNtKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIEFkZCB0aGUgZ2l2ZW4gaW5zdGFuY2UgdG8gdGhlIGRpcnR5IGNh\nY2hlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZERpcnR5\nKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAgICAgICAgaWYgKF9kaXJ0\neSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX29yZGVyRGlydHkp\nCiAgICAgICAgICAgICAgICAgICAgX2RpcnR5ID0gTWFwQmFja2VkU2V0LmRl\nY29yYXRlKG5ldyBMaW5rZWRNYXAoKSk7CiAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgX2RpcnR5ID0gbmV3IEhhc2hTZXQoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX2RpcnR5LmFkZChzbSkp\nCiAgICAgICAgICAgICAgICByZW1vdmVDbGVhbkludGVybmFsKHNtKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlbW92ZSB0aGUgZ2l2\nZW4gaW5zdGFuY2UgZnJvbSB0aGUgY2FjaGUuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKFN0YXRlTWFuYWdlckltcGwgc20p\nIHsKICAgICAgICAgICAgcmV0dXJuIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20p\nCiAgICAgICAgICAgICAgICB8fCAoX2RpcnR5ICE9IG51bGwgJiYgX2RpcnR5\nLnJlbW92ZShzbSkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBib29s\nZWFuIHJlbW92ZUNsZWFuSW50ZXJuYWwoU3RhdGVNYW5hZ2VySW1wbCBzbSkg\newogICAgICAgICAgICByZXR1cm4gX2NsZWFuICE9IG51bGwgJiYgX2NsZWFu\nLnJlbW92ZShzbSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSXRlcmF0\nb3IgaXRlcmF0b3IoKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yQ2hhaW4gY2hh\naW4gPSBuZXcgSXRlcmF0b3JDaGFpbigpOwogICAgICAgICAgICBpZiAoX2Rp\ncnR5ICE9IG51bGwgJiYgIV9kaXJ0eS5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICBjaGFpbi5hZGRJdGVyYXRvcihfZGlydHkuaXRlcmF0b3IoKSk7CiAg\nICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVsbCAmJiAhX2NsZWFuLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9yKF9jbGVh\nbi5pdGVyYXRvcigpKTsKICAgICAgICAgICAgcmV0dXJuIGNoYWluOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoT2JqZWN0\nIG9iaikgewogICAgICAgICAgICByZXR1cm4gKF9kaXJ0eSAhPSBudWxsICYm\nIF9kaXJ0eS5jb250YWlucyhvYmopKQogICAgICAgICAgICAgICAgfHwgKF9j\nbGVhbiAhPSBudWxsICYmIF9jbGVhbi5jb250YWlucyhvYmopKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbGxl\nY3Rpb24gY29sbCkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAg\nICAgICBpZiAoIWNvbnRhaW5zKGl0ci5uZXh0KCkpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAg\nICAgICAgICAgaWYgKF9kaXJ0eSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2RpcnR5LmNsZWFyKCk7CiAgICAgICAgICAgIGlmIChfY2xlYW4gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9jbGVhbi5jbGVhcigpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgJiYgKF9jbGVhbiA9PSBudWxsIHx8IF9jbGVh\nbi5pc0VtcHR5KCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBz\naXplKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAgICAgICAg\nIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNpemUgKz0g\nX2RpcnR5LnNpemUoKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxs\nKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfY2xlYW4uc2l6ZSgpOwogICAg\nICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGFkZChPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKENvbGxlY3Rpb24g\nY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVy\nYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIHJlbW92ZShPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENvbGxlY3Rp\nb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRP\ncGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBib29sZWFuIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9u\nRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0\nW10gdG9BcnJheShPYmplY3RbXSBhcnIpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVW5pcXVlIGlkIGZvciBzdGF0ZSBt\nYW5hZ2VycyBvZiBuZXcgZGF0YXN0b3JlIGluc3RhbmNlcyB3aXRob3V0IGFz\nc2lnbmVkCiAgICAgKiBvYmplY3QgaWRzLgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJZAogICAgICAgIGltcGxlbWVu\ndHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgU1RSSU5HX1BSRUZJWCA9ICJvcGVuanBhc206IjsKCiAgICAg\nICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyBfZ2VuZXJhdG9yID0gMDsKCiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2JoYXNoOwogICAgICAgIHByaXZhdGUg\nZmluYWwgbG9uZyBfaWQ7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgU3RhdGVN\nYW5hZ2VySWQgbmV3SW5zdGFuY2UoQnJva2VyIGIpIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJZChTeXN0ZW0uaWRlbnRpdHlIYXNo\nQ29kZShiKSwgX2dlbmVyYXRvcisrKTsKICAgICAgICB9CgogICAgICAgIHBy\naXZhdGUgU3RhdGVNYW5hZ2VySWQoaW50IGJoYXNoLCBsb25nIGlkKSB7CiAg\nICAgICAgICAgIF9iaGFzaCA9IGJoYXNoOwogICAgICAgICAgICBfaWQgPSBp\nZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXJJZChT\ndHJpbmcgc3RyKSB7CiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmco\nU1RSSU5HX1BSRUZJWC5sZW5ndGgoKSk7CiAgICAgICAgICAgIGludCBpZHgg\nPSBzdHIuaW5kZXhPZignOicpOwogICAgICAgICAgICBfYmhhc2ggPSBJbnRl\nZ2VyLnBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMCwgaWR4KSk7CiAgICAgICAg\nICAgIF9pZCA9IExvbmcucGFyc2VMb25nKHN0ci5zdWJzdHJpbmcoaWR4ICsg\nMSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxz\nKE9iamVjdCBvdGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhp\ncykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBp\nZiAoIShvdGhlciBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgU3RhdGVNYW5h\nZ2VySWQgc2lkID0gKFN0YXRlTWFuYWdlcklkKSBvdGhlcjsKICAgICAgICAg\nICAgcmV0dXJuIF9iaGFzaCA9PSBzaWQuX2JoYXNoICYmIF9pZCA9PSBzaWQu\nX2lkOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIChpbnQpIChfaWQgXiAoX2lkID4+PiAz\nMikpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmlu\nZygpIHsKICAgICAgICAgICAgcmV0dXJuIFNUUklOR19QUkVGSVggKyBfYmhh\nc2ggKyAiOiIgKyBfaWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQ29sbGVjdGlvbiB0eXBlIHRoYXQgaG9sZHMgc3RhdGUgbWFuYWdlcnMg\nYnV0IHdob3NlIGludGVyZmFjZSBkZWFscwogICAgICogd2l0aCB0aGUgY29y\ncmVzcG9uZGluZyBtYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uCiAgICAg\nICAgZXh0ZW5kcyBBYnN0cmFjdENvbGxlY3Rpb24gewoKICAgICAgICBwcml2\nYXRlIGZpbmFsIENvbGxlY3Rpb24gX3N0YXRlczsKCiAgICAgICAgcHVibGlj\nIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKENvbGxlY3Rpb24gc3RhdGVzKSB7\nCiAgICAgICAgICAgIF9zdGF0ZXMgPSBzdGF0ZXM7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRTdGF0ZU1hbmFnZXJzKCkgewog\nICAgICAgICAgICByZXR1cm4gX3N0YXRlczsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zdGF0\nZXMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0ZXJhdG9y\nIGl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9y\nKCkgewogICAgICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBJdGVyYXRvciBf\naXRyID0gX3N0YXRlcy5pdGVyYXRvcigpOwoKICAgICAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIF9pdHIuaGFzTmV4dCgpOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBfaXRy\nLm5leHQoKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1hbmFnZWRJ\nbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

