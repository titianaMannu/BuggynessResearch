{"sha":"4fbbda488acf23ed881736383b7f51aa98db4f10","node_id":"MDQ6QmxvYjIwNjM2NDo0ZmJiZGE0ODhhY2YyM2VkODgxNzM2MzgzYjdmNTFhYTk4ZGI0ZjEw","size":106514,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4fbbda488acf23ed881736383b7f51aa98db4f10","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQg\namF2YS51dGlsLio7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlBDUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5NYW5hZ2VkSW5zdGFuY2VQcm92\naWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLkR5bmFt\naWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PYmpl\nY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0\naWwuTnVtYmVyczsKCi8qKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUge0Bs\naW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXJ9IGludGVyZmFjZSBmb3IgdXNlCiAq\nIHdpdGggdGhpcyBydW50aW1lLiBFYWNoIHN0YXRlIG1hbmFnZXIgbWFuYWdl\ncyB0aGUgc3RhdGUgb2YgYSBzaW5nbGUKICogcGVyc2lzdGVuY2UgY2FwYWJs\nZSBpbnN0YW5jZS4gVGhlIHN0YXRlIG1hbmFnZXIgaXMgYWxzbyByZXNwb25z\naWJsZSBmb3IKICogYWxsIGNvbW11bmljYXRpb25zIGFib3V0IHRoZSBpbnN0\nYW5jZSB0byB0aGUge0BsaW5rIFN0b3JlTWFuYWdlcn0uCiAqICBUaGUgc3Rh\ndGUgbWFuYWdlciB1c2VzIHRoZSBTdGF0ZSBwYXR0ZXJuIGluIGJvdGggaXRz\nIGludGVyYWN0aW9uIHdpdGgKICogdGhlIGdvdmVybmVkIGluc3RhbmNlIGFu\nZCBpdHMgaW50ZXJhY3Rpb24gd2l0aCB0aGUgYnJva2VyLgogKiBJbiBpdHMg\naW50ZXJhY3Rpb25zIHdpdGggdGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgaW5z\ndGFuY2UsIGl0IHVzZXMgdGhlCiAqIHtAbGluayBGaWVsZE1hbmFnZXJ9IGlu\ndGVyZmFjZS4gU2ltaWxhcmx5LCB3aGVuIGludGVyYWN0aW5nIHdpdGggdGhl\nCiAqIGJyb2tlciwgaXQgdXNlcyB0aGUge0BsaW5rIFBDU3RhdGV9IHNpbmds\nZXRvbiB0aGF0IHJlcHJlc2VudHMKICogdGhlIGN1cnJlbnQgbGlmZWN5Y2xl\nIHN0YXRlIG9mIHRoZSBpbnN0YW5jZS4KICoKICogQGF1dGhvciBBYmUgV2hp\ndGUKICovCnB1YmxpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJbXBsCiAgICBpbXBs\nZW1lbnRzIE9wZW5KUEFTdGF0ZU1hbmFnZXIgewoKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IExPQURfRkdTID0gMDsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IExPQURfQUxMID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IExPQURfU0VSSUFMSVpFID0gMjsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19TQVZFID0gMiA8PCAwOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEZMQUdfREVSRUYgPSAyIDw8IDE7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19MT0FERUQgPSAyIDw8IDI7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19SRUFEX0xPQ0tFRCA9\nIDIgPDwgMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1dS\nSVRFX0xPQ0tFRCA9IDIgPDwgNDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBGTEFHX09JRF9BU1NJR05FRCA9IDIgPDwgNTsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0xPQURJTkcgPSAyIDw8IDY7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19QUkVfREVMRVRJTkcgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19GTFVT\nSEVEID0gMiA8PCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFX0ZMVVNIRUQgPSAyIDw8IDk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRkxBR19GTFVTSEVEX0RJUlRZID0gMiA8PCAxMDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0lNUExfQ0FDSEUgPSAyIDw8\nIDExOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfSU5WRVJT\nRVMgPSAyIDw8IDEyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfTk9fVU5QUk9YWSA9IDIgPDwgMTM7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgRkxBR19WRVJTSU9OX0NIRUNLID0gMiA8PCAxNDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1ZFUlNJT05fVVBEQVRFID0g\nMiA8PCAxNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RF\nVEFDSElORyA9IDIgPDwgMTY7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAg\nIChTdGF0ZU1hbmFnZXJJbXBsLmNsYXNzKTsKCiAgICAvLyBpbmZvcm1hdGlv\nbiBhYm91dCB0aGUgaW5zdGFuY2UKICAgIHByaXZhdGUgUGVyc2lzdGVuY2VD\nYXBhYmxlIF9wYyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEg\nX21ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51\nbGw7CiAgICBwcml2YXRlIEJpdFNldCBfZGlydHkgPSBudWxsOwogICAgcHJp\ndmF0ZSBCaXRTZXQgX2ZsdXNoID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9m\nbGFncyA9IDA7CgogICAgLy8gaWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRl\nbnRpdHk7IG9pZCBpcyB0aGUgcGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAog\nICAgLy8gbWF5IGJlIG51bGwgZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQt\ndHJhbnNhY3Rpb25hbCBvYmplY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2Vz\nIHRoYXQgaGF2ZW4ndCBiZWVuIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJl\nYXNzaWduZWQgdG8gb2lkCiAgICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3Np\nZ25tZW50IChvciBmbHVzaCBjb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMK\nICAgIC8vIGR1cmluZyBmbHVzaCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9\nIG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAv\nLyB0aGUgbWFuYWdpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5\nY2xlIHN0YXRlCiAgICBwcml2YXRlIGZpbmFsIEJyb2tlckltcGwgX2Jyb2tl\ncjsKICAgIHByaXZhdGUgUENTdGF0ZSBfc3RhdGUgPSBQQ1N0YXRlLlRSQU5T\nSUVOVDsKCiAgICAvLyB0aGUgY3VycmVudCBhbmQgbGFzdCBsb2FkZWQgdmVy\nc2lvbiBpbmRpY2F0b3JzLCBhbmQgdGhlIGxvY2sgb2JqZWN0CiAgICBwcml2\nYXRlIE9iamVjdCBfdmVyc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVj\ndCBfbG9hZFZlcnNpb24gPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xv\nY2sgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX3JlYWRMb2NrTGV2ZWwgPSAt\nMTsKICAgIHByaXZhdGUgaW50IF93cml0ZUxvY2tMZXZlbCA9IC0xOwoKICAg\nIC8vIGRlbGVnYXRlcyB3aGVuIHByb3ZpZGluZy9yZXBsYWNpbmcgaW5zdGFu\nY2UgZGF0YQogICAgcHJpdmF0ZSBTaW5nbGVGaWVsZE1hbmFnZXIgX3Npbmds\nZSA9IG51bGw7CiAgICBwcml2YXRlIFNhdmVGaWVsZE1hbmFnZXIgX3NhdmVk\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNYW5hZ2VyIF9mbSA9IG51bGw7\nCgogICAgLy8gaW1wbGRhdGE7IGZpZWxkIGltcGxkYXRhIGFuZCBpbnRlcm1l\nZGlhdGUgZGF0YSBzaGFyZSB0aGUgc2FtZSBhcnJheQogICAgcHJpdmF0ZSBP\nYmplY3QgX2ltcGwgPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZmll\nbGRJbXBsID0gbnVsbDsKCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUg\nb3duZXIgb2YgdGhpcyBpbnN0YW5jZSwgaWYgaXQgaXMgZW1iZWRkZWQKICAg\nIHByaXZhdGUgU3RhdGVNYW5hZ2VySW1wbCBfb3duZXIgPSBudWxsOwogICAg\ncHJpdmF0ZSBWYWx1ZU1ldGFEYXRhIF9vd25lck1ldGEgPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3I7IHN1cHBseSBpZCwgdHlwZSBtZXRh\nZGF0YSwgYW5kIG93bmluZyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbChPYmplY3QgaWQsIENs\nYXNzTWV0YURhdGEgbWV0YSwgCiAgICAgICAgQnJva2VySW1wbCBicm9rZXIp\nIHsKICAgICAgICBfaWQgPSBpZDsKICAgICAgICBfbWV0YSA9IG1ldGE7CiAg\nICAgICAgX2Jyb2tlciA9IGJyb2tlcjsKICAgICAgICBfc2luZ2xlID0gbmV3\nIFNpbmdsZUZpZWxkTWFuYWdlcih0aGlzLCBicm9rZXIpOwoKICAgICAgICBp\nZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5J\nRF9VTktOT1dOKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBfbWV0YSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBvd25pbmcgc3RhdGUgYW5kIGZpZWxk\nIGlmIHRoaXMgaXMgYW4gZW1iZWRkZWQgaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHZvaWQgc2V0T3duZXIoU3RhdGVNYW5hZ2VySW1wbCBvd25lciwgVmFsdWVN\nZXRhRGF0YSBvd25lck1ldGEpIHsKICAgICAgICBfb3duZXIgPSBvd25lcjsK\nICAgICAgICBfb3duZXJNZXRhID0gb3duZXJNZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGlzIHN0YXRlIG1hbmFnZXIgaXMgaW4gdGhl\nIG1pZGRsZSBvZiBhIGxvYWQuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNMb2Fk\naW5nKCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19MT0FESU5H\nKSA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3Rh\ndGUgbWFuYWdlciBpcyBpbiB0aGUgbWlkZGxlIG9mIGEgbG9hZCBpbml0aWF0\nZWQKICAgICAqIGJ5IG91dHNpZGUgY29kZTsgZm9yIGFueSBpbnRlcm5hbCBt\nZXRob2RzIHRoYXQgY2F1c2UgbG9hZGluZywgdGhlCiAgICAgKiBsb2FkaW5n\nIGZsYWcgaXMgc2V0IGF1dG9tYXRpY2FsbHkuCiAgICAgKi8KICAgIHZvaWQg\nc2V0TG9hZGluZyhib29sZWFuIGxvYWRpbmcpIHsKICAgICAgICBpZiAobG9h\nZGluZykKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BRElORzsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19MT0FESU5H\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9yIHJlc2V0IHRoZSBsaWZl\nY3ljbGUgc3RhdGUgb2YgdGhlIG1hbmFnZWQgaW5zdGFuY2UuIElmIHRoZQog\nICAgICogdHJhbnNhY3Rpb25hbCBzdGF0ZSBvZiB0aGUgaW5zdGFuY2UgY2hh\nbmdlcywgaXQgd2lsbCBiZSBlbmxpc3RlZC8KICAgICAqIGRlbGlzdGVkIGZy\nb20gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gYXMgbmVjZXNzYXJ5LiBUaGUg\nZ2l2ZW4KICAgICAqIHN0YXRlIHdpbGwgYmUgaW5pdGlhbGl6ZWQgYWZ0ZXIg\nYmVpbmcgc2V0LiBJZiB0aGUgZ2l2ZW4gc3RhdGUKICAgICAqIGlzIHRoZSBz\nYW1lIGFzIHRoZSBjdXJyZW50IHN0YXRlLCB0aGlzIG1ldGhvZCB3aWxsIGhh\ndmUgbm8gZWZmZWN0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2V0UENT\ndGF0ZShQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgaWYgKF9zdGF0ZSA9PSBz\ndGF0ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbm90aWZ5IHRoZSBzdG9yZSBt\nYW5hZ2VyIHRoYXQgd2UncmUgY2hhbmdpbmcgc3RhdGVzOyBjYW4gdmV0bwog\nICAgICAgICAgICBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmJlZm9yZVN0\nYXRlQ2hhbmdlKHRoaXMsIF9zdGF0ZSwgc3RhdGUpOwoKICAgICAgICAgICAg\nLy8gcmVwbGFjZSBzdGF0ZQogICAgICAgICAgICBib29sZWFuIHdhc0RlbGV0\nZWQgPSBfc3RhdGUuaXNEZWxldGVkKCk7CiAgICAgICAgICAgIGJvb2xlYW4g\nd2FzRGlydHkgPSBfc3RhdGUuaXNEaXJ0eSgpOwogICAgICAgICAgICBib29s\nZWFuIHdhc1BlbmRpbmcgPSBfc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rpb25h\nbCgpOwogICAgICAgICAgICBfc3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgICAg\nIC8vIGVubGlzdC9kZWxpc3QgZnJvbSB0cmFuc2FjdGlvbgogICAgICAgICAg\nICBpZiAoX3N0YXRlLmlzVHJhbnNhY3Rpb25hbCgpKSB7CiAgICAgICAgICAg\nICAgICBfYnJva2VyLmFkZFRvVHJhbnNhY3Rpb24odGhpcyk7CiAgICAgICAg\nICAgICAgICBpZiAoX3N0YXRlLmlzRGVsZXRlZCgpICE9IHdhc0RlbGV0ZWQp\nCiAgICAgICAgICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCAh\nd2FzRGlydHkgfHwgaXNGbHVzaGVkKCkpOwogICAgICAgICAgICAgICAgZWxz\nZSBpZiAoX3N0YXRlLmlzRGlydHkoKSAmJiAhd2FzRGlydHkpCiAgICAgICAg\nICAgICAgICAgICAgX2Jyb2tlci5zZXREaXJ0eSh0aGlzLCB0cnVlKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmICghd2FzUGVuZGluZyAmJiBfc3RhdGUuaXNQ\nZW5kaW5nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tl\nci5hZGRUb1BlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAg\nZWxzZSBpZiAod2FzUGVuZGluZyAmJiAhX3N0YXRlLmlzUGVuZGluZ1RyYW5z\nYWN0aW9uYWwoKSkKICAgICAgICAgICAgICAgIF9icm9rZXIucmVtb3ZlRnJv\nbVBlbmRpbmdUcmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1vdmVGcm9tVHJhbnNhY3Rpb24o\ndGhpcyk7CgogICAgICAgICAgICAvLyBpbml0aWFsaXplCiAgICAgICAgICAg\nIF9zdGF0ZS5pbml0aWFsaXplKHRoaXMpOwogICAgICAgICAgICBpZiAoX3N0\nYXRlLmlzRGVsZXRlZCgpICYmICF3YXNEZWxldGVkKQogICAgICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RF\nTEVURSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoQ2xh\nc3MgY2xzLCBQQ1N0YXRlIHN0YXRlKSB7CiAgICAgICAgLy8gY2hlY2sgdG8g\nc2VlIGlmIG91ciBjdXJyZW50IG9iamVjdCBpZCBpbnN0YW5jZSBpcyB0aGUK\nICAgICAgICAvLyBjb3JyZWN0IGlkIHR5cGUgZm9yIHRoZSBzcGVjaWZpZWQg\nY2xhc3M7IHRoaXMgaXMgZm9yIGNhc2VzCiAgICAgICAgLy8gd2hlbiB3ZSBo\nYXZlIGFuIGFwcGxpY2F0aW9uIGlkIGhpZXJhcmNoeSBhbmQgd2UgaGFkIHNl\ndCB0aGUKICAgICAgICAvLyBtZXRhZGF0YSB0byBhIHN1cGVyY2xhc3MgaWQg\nLS0gdGhlIHN1YmNsYXNzJyBpZCBtYXkgYmUgYQogICAgICAgIC8vIGRpZmZl\ncmVudCBjbGFzcywgc28gd2UgbmVlZCB0byByZXNldCBpdAogICAgICAgIGlm\nIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkgIT0gY2xzKSB7CiAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgc3ViID0gX21ldGEuZ2V0UmVwb3NpdG9yeSgp\nLmdldE1ldGFEYXRhCiAgICAgICAgICAgICAgICAoY2xzLCBfYnJva2VyLmdl\ndENsYXNzTG9hZGVyKCksIHRydWUpOwogICAgICAgICAgICBpZiAoX29pZCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRp\ndHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUpCiAgICAg\nICAgICAgICAgICAgICAgX29pZCA9IF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2Vy\nKCkuY29weURhdGFTdG9yZUlkKF9vaWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgIHN1Yik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChfbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBB\ncHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIHN1Yik7CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChzdWIuZ2V0T2JqZWN0SWRUeXBlKCkgIT0gX21ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Rb\nXSBwa0ZpZWxkcyA9IEFwcGxpY2F0aW9uSWRzLnRvUEtWYWx1ZXMoX29pZCwg\nX21ldGEpOwogICAgICAgICAgICAgICAgICAgIF9vaWQgPSBBcHBsaWNhdGlv\nbklkcy5mcm9tUEtWYWx1ZXMocGtGaWVsZHMsIHN1Yik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX21ldGEgPSBzdWI7\nCiAgICAgICAgfQogICAgICAgIGlmIChjbHMuaXNJbnRlcmZhY2UoKSkKICAg\nICAgICAgICAgY2xzID0gX21ldGEuZ2V0SW50ZXJmYWNlSW1wbCgpOwoKICAg\nICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgaW5zdCA9IFBDUmVnaXN0cnkubmV3\nSW5zdGFuY2UoY2xzLCB0aGlzLCBfb2lkLCB0cnVlKTsKICAgICAgICBpZiAo\naW5zdCA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHRoZSBpbnN0YW5jZSB3\nYXMgbnVsbDogY2hlY2sgdG8gc2VlIGlmIHRoZSBpbnN0YW5jZSBpcwogICAg\nICAgICAgICAvLyBhYnN0cmFjdCAoYXMgY2FuIHNvbWV0aW1lcyBiZSB0aGUg\nY2FzZSB3aGVuIHRoZQogICAgICAgICAgICAvLyBjbGFzcyBkaXNjcmltaW5h\ndG9yIHN0cmF0ZWd5IGlzIG5vdCBjb25maWd1cmVkIGNvcnJlY3RseSkKICAg\nICAgICAgICAgaWYgKE1vZGlmaWVyLmlzQWJzdHJhY3QoY2xzLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJpbnN0YW50aWF0ZS1hYnN0cmFjdCIsCiAgICAgICAg\nICAgICAgICAgICAgY2xzLmdldE5hbWUoKSwgX29pZCkpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICB9Cgog\nICAgICAgIGluaXRpYWxpemUoaW5zdCwgc3RhdGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW5pdGlhbGl6ZSB3aXRoIHRoZSBnaXZlbiBpbnN0YW5jZSBh\nbmQgc3RhdGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGluaXRpYWxp\nemUoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBQQ1N0YXRlIHN0YXRlKSB7CiAg\nICAgICAgaWYgKHBjID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbml0LW51bGwtcGMiLCBfbWV0YSkp\nOwogICAgICAgIGlmIChwYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IG51bGwg\nJiYgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKSAhPSB0aGlzKQogICAgICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiaW5pdC1zbS1w\nYyIsCiAgICAgICAgICAgICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKHBjKSkp\nLnNldEZhaWxlZE9iamVjdChwYyk7CiAgICAgICAgcGMucGNSZXBsYWNlU3Rh\ndGVNYW5hZ2VyKHRoaXMpOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIF9sb2FkZWQgPSBuZXcg\nQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICBfZmx1c2ggPSBuZXcgQml0\nU2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICBfZGlydHkgPSBuZXcgQml0U2V0\nKGZtZHMubGVuZ3RoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIG1hcmsgcHJpbWFy\neSBrZXkgYW5kIG5vbi1wZXJzaXN0ZW50IGZpZWxkcyBhcyBsb2FkZWQKICAg\nICAgICAgICAgaWYgKGZtZHNbaV0uaXNQcmltYXJ5S2V5KCkKICAgICAgICAg\nICAgICAgIHx8IGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IGZtZHNbaV0u\nTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBfbG9hZGVkLnNl\ndChpKTsKCiAgICAgICAgICAgIC8vIHJlY29yZCB3aGV0aGVyIHRoZXJlIGFy\nZSBhbnkgbWFuYWdlZCBpbnZlcnNlIGZpZWxkcwogICAgICAgICAgICBpZiAo\nX2Jyb2tlci5nZXRJbnZlcnNlTWFuYWdlcigpICE9IG51bGwKICAgICAgICAg\nICAgICAgICYmIGZtZHNbaV0uZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0\naCA+IDApCiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19JTlZFUlNF\nUzsKICAgICAgICB9CgogICAgICAgIHBjLnBjU2V0RGV0YWNoZWRTdGF0ZShu\ndWxsKTsKICAgICAgICBfcGMgPSBwYzsKCiAgICAgICAgaWYgKF9vaWQgaW5z\ndGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQQUlkKSBf\nb2lkKS5zZXRNYW5hZ2VkSW5zdGFuY2VUeXBlKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSk7CgogICAgICAgIC8vIGluaXRpYWxpemUgb3VyIHN0YXRlIGFu\nZCBhZGQgb3Vyc2VsdmVzIHRvIHRoZSBicm9rZXIncyBjYWNoZQogICAgICAg\nIHNldFBDU3RhdGUoc3RhdGUpOwogICAgICAgIF9icm9rZXIuc2V0U3RhdGVN\nYW5hZ2VyKF9pZCwgdGhpcywgQnJva2VySW1wbC5TVEFUVVNfSU5JVCk7CiAg\nICAgICAgaWYgKHN0YXRlID09IFBDU3RhdGUuUE5FVykKICAgICAgICAgICAg\nZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJ\nU1QpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEgbm9uLXRyYWNraW5nIFBD\nLCBhZGQgYSBoYXJkIHJlZiB0byB0aGUgYXBwcm9wcmlhdGUgZGF0YQogICAg\nICAgIC8vIHNldHMgYW5kIGdpdmUgaXQgYW4gb3Bwb3J0dW5pdHkgdG8gbWFr\nZSBhIHN0YXRlIHNuYXBzaG90LgogICAgICAgIGlmICghaXNJbnRlcmNlcHRp\nbmcoKSkKICAgICAgICAgICAgc2F2ZUZpZWxkcyh0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90IGRhdGEgYWNjZXNzIGluIHRo\naXMgaW5zdGFuY2UgaXMgaW50ZXJjZXB0ZWQuIFRoaXMgZGlmZmVycwogICAg\nICogZnJvbSB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNpc0ludGVyY2VwdGluZygp\nfSBpbiB0aGF0IGl0IGNoZWNrcyBmb3IKICAgICAqIHByb3BlcnR5IGFjY2Vz\ncyArIHN1YmNsYXNzaW5nIGluIGFkZGl0aW9uIHRvIHRoZSByZWRlZmluaXRp\nb24gLwogICAgICogZW5oYW5jZW1lbnQgY2hlY2tzLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAgICBpZiAo\nZ2V0TWV0YURhdGEoKS5pc0ludGVyY2VwdGluZygpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZ2V0TWV0YURhdGEoKS5nZXRBY2Nl\nc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQKICAgICAg\nICAgICAgJiYgX3BjIGluc3RhbmNlb2YgRHluYW1pY1BlcnNpc3RlbmNlQ2Fw\nYWJsZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpcmUgdGhlIGdpdmVu\nIGxpZmVjeWNsZSBldmVudCB0byBhbGwgbGlzdGVuZXJzLgogICAgICovCiAg\nICBwcml2YXRlIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2ZW50KGludCB0eXBl\nKSB7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50\nKGdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICBfbWV0\nYSwgdHlwZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZChGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBsb2FkKGZldGNoLCBMT0FE\nX0ZHUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogTG9hZCB0aGUgc3RhdGUgb2YgdGhpcyBpbnN0YW5jZSBiYXNlZCBvbiB0\naGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICogYW5kIGxvYWQg\nbW9kZS4gUmV0dXJuIHRydWUgaWYgYW55IGRhdGEgd2FzIGxvYWRlZCwgZmFs\nc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBs\nb2FkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvYWRNb2RlLAog\nICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3Qgc2RhdGEsIGJvb2xlYW4g\nZm9yV3JpdGUpIHsKICAgICAgICBpZiAoIWZvcldyaXRlICYmICghaXNQZXJz\naXN0ZW50KCkgfHwgaXNOZXcoKSB8fCBpc0RlbGV0ZWQoKSkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gaWYgYW55IGZpZWxkcyBi\nZWluZyBsb2FkZWQsIGRvIHN0YXRlIHRyYW5zaXRpb25zIGZvciByZWFkCiAg\nICAgICAgQml0U2V0IGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0\nY2gsIGxvYWRNb2RlLCBleGNsdWRlKTsKICAgICAgICBib29sZWFuIGFjdGl2\nZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsKICAgICAgICBpZiAoIWZvcldyaXRl\nICYmIGZpZWxkcyAhPSBudWxsKQogICAgICAgICAgICBiZWZvcmVSZWFkKC0x\nKTsKCiAgICAgICAgLy8gY2FsbCBsb2FkIGV2ZW4gaWYgbm8gZmllbGRzIGFy\nZSBiZWluZyBsb2FkZWQsIGJlY2F1c2UgaXQgdGFrZXMKICAgICAgICAvLyBj\nYXJlIG9mIGNoZWNraW5nIGlmIHRoZSBERkcgaXMgbG9hZGVkLCBtYWtpbmcg\nc3VyZSB2ZXJzaW9uIGluZm8KICAgICAgICAvLyBpcyBsb2FkZWQsIGV0Ywog\nICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2ZWwoYWN0\naXZlLCBmb3JXcml0ZSwgZmV0Y2gpOwogICAgICAgIGJvb2xlYW4gcmV0ID0g\nbG9hZEZpZWxkcyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIHNkYXRhLCBm\nb3JXcml0ZSk7CiAgICAgICAgb2J0YWluTG9ja3MoYWN0aXZlLCBmb3JXcml0\nZSwgbG9ja0xldmVsLCBmZXRjaCwgc2RhdGEpOwogICAgICAgIHJldHVybiBy\nZXQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKSB7CiAgICAgICAgaWYgKF9wYyBpbnN0YW5jZW9mIE1hbmFnZWRJbnN0\nYW5jZVByb3ZpZGVyKQogICAgICAgICAgICByZXR1cm4gKChNYW5hZ2VkSW5z\ndGFuY2VQcm92aWRlcikgX3BjKS5nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBfcGM7CiAgICB9CgogICAg\ncHVibGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXRQZXJzaXN0ZW5jZUNhcGFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIF9wYzsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX21ldGE7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nZ2V0T3duZXIoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0KCiAg\nICBwdWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRPd25lck1ldGFEYXRhKCkgewog\nICAgICAgIHJldHVybiBfb3duZXJNZXRhOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRW1iZWRkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lciAh\nPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZCgp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRCkgPiAw\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1c2hlZERpcnR5KCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZ\nKSA+IDA7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXRMb2FkZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9sb2FkZWQ7CiAgICB9CgogICAgcHVibGljIEJp\ndFNldCBnZXRGbHVzaGVkKCkgewogICAgICAgIHJldHVybiBfZmx1c2g7CiAg\nICB9CgogICAgcHVibGljIEJpdFNldCBnZXREaXJ0eSgpIHsKICAgICAgICBy\nZXR1cm4gX2RpcnR5OwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0VW5s\nb2FkZWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgLy8g\nY29sbGVjdCBmaWVsZHMgdG8gbG9hZCBmcm9tIGRhdGEgc3RvcmUgYmFzZWQg\nb24gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIEJpdFNldCBmaWVsZHMg\nPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7\nCiAgICAgICAgcmV0dXJuIChmaWVsZHMgPT0gbnVsbCkgPyBuZXcgQml0U2V0\nKDApIDogZmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwg\ndmVyc2lvbiBvZiB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlciNnZXRVbmxv\nYWRlZH0gdGhhdCBhdm9pZHMKICAgICAqIGNyZWF0aW5nIGFuIGVtcHR5IGJp\ndCBzZXQgYnkgcmV0dXJuaW5nIG51bGwgd2hlbiB0aGVyZSBhcmUgbm8gdW5s\nb2FkZWQKICAgICAqIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRT\nZXQgZ2V0VW5sb2FkZWRJbnRlcm5hbChGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGludCBtb2RlLAogICAgICAgIEJpdFNldCBleGNsdWRlKSB7CiAgICAg\nICAgaWYgKGV4Y2x1ZGUgPT0gU3RvcmVDb250ZXh0LkVYQ0xVREVfQUxMKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQml0U2V0IGZpZWxk\ncyA9IG51bGw7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIGxvYWQ7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChfbG9hZGVkLmdldChpKSB8fCAoZXhjbHVkZSAhPSBudWxs\nICYmIGV4Y2x1ZGUuZ2V0KGkpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CiAgICAgICAgICAgICAg\nICBjYXNlIExPQURfU0VSSUFMSVpFOgogICAgICAgICAgICAgICAgICAgIGxv\nYWQgPSAhZm1kc1tpXS5pc1RyYW5zaWVudCgpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMT0FEX0ZHUzoKICAg\nICAgICAgICAgICAgICAgICBsb2FkID0gZmV0Y2ggPT0gbnVsbCB8fCBmZXRj\naC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAgICAgICAgICAgICAg\nICAgICAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTk9ORTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nIC8vIExPQURfQUxMCiAgICAgICAgICAgICAgICAgICAgbG9hZCA9IHRydWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2FkKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxlbmd0aCk7CiAgICAg\nICAgICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9CgogICAgcHVibGlj\nIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiBf\nYnJva2VyOwogICAgfQoKICAgIC8qKgogICAgICogTWFuYWdpbmcgYnJva2Vy\nLgogICAgICovCiAgICBCcm9rZXJJbXBsIGdldEJyb2tlcigpIHsKICAgICAg\nICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndElkKCkgewogICAgICAgIHJldHVybiBfaWQ7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRPYmplY3RJZCgpIHsKICAgICAgICBTdGF0ZU1hbmFnZXJJ\nbXBsIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20uZ2V0T3duZXIoKSAh\nPSBudWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJbXBsKSBz\nbS5nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbS5fb2lkOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldE9iamVjdElkKE9iamVjdCBvaWQpIHsKICAg\nICAgICBfb2lkID0gb2lkOwogICAgICAgIGlmIChfcGMgIT0gbnVsbCAmJiBv\naWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQ\nQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3Np\nZ25PYmplY3RJZChib29sZWFuIGZsdXNoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBhc3NpZ25PYmplY3RJ\nZChmbHVzaCwgZmFsc2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEFzayBzdG9yZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIgb2lkLCBvcHRpb25h\nbGx5IGZsdXNoaW5nIGFuZAogICAgICogb3B0aW9uYWxseSByZWNhY2hpbmcg\nb24gdGhlIG5ldyBvaWQuCiAgICAgKi8KICAgIGJvb2xlYW4gYXNzaWduT2Jq\nZWN0SWQoYm9vbGVhbiBmbHVzaCwgYm9vbGVhbiBwcmVGbHVzaGluZykgewog\nICAgICAgIGlmIChfb2lkICE9IG51bGwgfHwgaXNFbWJlZGRlZCgpIHx8ICFp\nc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAg\nICAgIGlmIChfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmFzc2lnbk9iamVj\ndElkKHRoaXMsIHByZUZsdXNoaW5nKSkgewogICAgICAgICAgICBpZiAoIXBy\nZUZsdXNoaW5nKQogICAgICAgICAgICAgICAgYXNzZXJ0T2JqZWN0SWRBc3Np\nZ25lZCh0cnVlKTsKICAgICAgICB9IGVsc2UgaWYgKGZsdXNoKQogICAgICAg\nICAgICBfYnJva2VyLmZsdXNoKCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgd2Ugd2VyZSBhc3NpZ25lZCBhbiBv\naWQsIGFuZCBwZXJmb3JtIGFjdGlvbnMgdG8gbWFrZSBpdAogICAgICogcGVy\nbWFuZW50LgogICAgICoKICAgICAqIEBwYXJhbSByZWNhY2hlIHdoZXRoZXIg\ndG8gcmVjYWNoZSBvdXJzZWxmIG9uIHRoZSBuZXcgb2lkCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKGJvb2xlYW4g\ncmVjYWNoZSkgewogICAgICAgIGlmICghaXNOZXcoKSB8fCBpc0RlbGV0ZWQo\nKSB8fCBpc1Byb3Zpc2lvbmFsKCkgCiAgICAgICAgICAgIHx8IChfZmxhZ3Mg\nJiBGTEFHX09JRF9BU1NJR05FRCkgIT0gMCkKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIGlmIChfb2lkID09IG51bGwpIHsKICAgICAgICAgICAgaWYg\nKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURf\nREFUQVNUT1JFKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKEV4Y2VwdGlvbnMudG9TdHJpbmcKICAgICAgICAgICAgICAg\nICAgICAoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAgICAgICAgICAgX29p\nZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShfcGMsIF9tZXRhKTsKICAgICAg\nICB9CgogICAgICAgIE9iamVjdCBvcmlnID0gX2lkOwogICAgICAgIF9pZCA9\nIF9vaWQ7CiAgICAgICAgaWYgKHJlY2FjaGUpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKG9y\naWcsIHRoaXMsCiAgICAgICAgICAgICAgICAgICAgQnJva2VySW1wbC5TVEFU\nVVNfT0lEX0FTU0lHTik7CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIF9pZCA9IG9yaWc7CiAg\nICAgICAgICAgICAgICBfb2lkID0gbnVsbDsKICAgICAgICAgICAgICAgIHRo\ncm93IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9mbGFn\ncyB8PSBGTEFHX09JRF9BU1NJR05FRDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFzc2lnbiB0aGUgcHJvcGVyIGdlbmVyYXRlZCB2YWx1ZSB0byB0aGUgZ2l2\nZW4gZmllbGQgYmFzZWQgb24gaXRzCiAgICAgKiB2YWx1ZS1zdHJhdGVneS4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGFzc2lnbkZpZWxkKGludCBm\naWVsZCwgYm9vbGVhbiBwcmVGbHVzaGluZykgewogICAgICAgIE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20gPSB0aGlzOwogICAgICAgIHdoaWxlIChzbS5pc0Vt\nYmVkZGVkKCkpCiAgICAgICAgICAgIHNtID0gc20uZ2V0T3duZXIoKTsKICAg\nICAgICBpZiAoIXNtLmlzTmV3KCkgfHwgc20uaXNGbHVzaGVkKCkgfHwgc20u\naXNEZWxldGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgLy8gc3BlY2lhbC1jYXNlIG9pZCBmaWVsZHMsIHdoaWNoIHJlcXVpcmUg\ndXMgdG8gbG9vayBpbnNpZGUgdGhlIG9pZAogICAgICAgIC8vIG9iamVjdAog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAgLy8gdHJ5IHRvIHNob3J0\nY3V0IGlmIHBvc3NpYmxlCiAgICAgICAgICAgIGlmIChfb2lkICE9IG51bGwg\nfHwgaXNFbWJlZGRlZCgpIHx8ICFpc1BlcnNpc3RlbnQoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgLy8gY2hlY2sgZW1i\nZWRkZWQgZmllbGRzIG9mIG9pZCBmb3IgdmFsdWUgc3RyYXRlZ3kgKyBkZWZh\ndWx0IHZhbHVlCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBm\nbWQuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLmdldEZpZWxkcygpOwogICAgICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG9pZHNtID0gbnVsbDsKICAgICAg\nICAgICAgYm9vbGVhbiBhc3NpZ24gPSBmYWxzZTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7ICFhc3NpZ24gJiYgaSA8IHBrcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5\nKCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAob2lkc20gPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBvaWRzbSA9IG5ldyBPYmplY3RJZFN0\nYXRlTWFuYWdlcihmZXRjaE9iamVjdEZpZWxkKGZpZWxkKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhpcywgZm1kKTsKICAgICAgICAgICAgICAgIGFz\nc2lnbiA9IG9pZHNtLmlzRGVmYXVsdFZhbHVlKGkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBhc3NpZ24gJiYgYXNzaWduT2JqZWN0SWQo\nIXByZUZsdXNoaW5nLCBwcmVGbHVzaGluZyk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBKdXN0IHJldHVybiBpZiB0aGVyZSdzIG5vIHZhbHVlIGdlbmVyYXRp\nb24gc3RyYXRlZ3kKICAgICAgICBpZiAoZm1kLmdldFZhbHVlU3RyYXRlZ3ko\nKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIAogICAgICAgIC8vIFRocm93IGV4Y2VwdGlvbiBp\nZiBmaWVsZCBhbHJlYWR5IGhhcyBhIHZhbHVlIGFzc2lnbmVkLgogICAgICAg\nIC8vIEBHZW5lcmF0ZWRWYWx1ZSBvdmVycmlkZXMgUE9KTyBpbml0aWFsIHZh\nbHVlcyBhbmQgc2V0dGVyIG1ldGhvZHMKICAgICAgICBpZiAoIWlzRGVmYXVs\ndFZhbHVlKGZpZWxkKSAmJiAhZm1kLmlzVmFsdWVHZW5lcmF0ZWQoKSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9j\nLmdldCgKICAgICAgICAgICAgICAgICAgICAiZXhpc3RpbmctdmFsdWUtb3Zl\ncnJpZGUtZXhjZXAiLCBmbWQuZ2V0RnVsbE5hbWUoZmFsc2UpKSk7CgogICAg\nICAgIC8vIGZvciBwcmltYXJ5IGtleSBmaWVsZHMsIGFzc2lnbiB0aGUgb2Jq\nZWN0IGlkIGFuZCByZWNhY2hlIHNvIHRoYXQKICAgICAgICAvLyB0byB0aGUg\ndXNlciwgc28gaXQgbG9va3MgbGlrZSB0aGUgb2lkIGFsd2F5cyBtYXRjaGVz\nIHRoZSBwayBmaWVsZHMKICAgICAgICBpZiAoZm1kLmlzUHJpbWFyeUtleSgp\nICYmICFpc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIHJldHVybiBhc3NpZ25P\nYmplY3RJZCghcHJlRmx1c2hpbmcsIHByZUZsdXNoaW5nKTsKCiAgICAgICAg\nLy8gZm9yIG90aGVyIGZpZWxkcyBqdXN0IGFzc2lnbiB0aGUgZmllbGQgb3Ig\nZmx1c2ggaWYgbmVlZGVkCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0U3RvcmVN\nYW5hZ2VyKCkuYXNzaWduRmllbGQodGhpcywgZmllbGQsIHByZUZsdXNoaW5n\nKSkgewogICAgICAgICAgICBmbWQuc2V0VmFsdWVHZW5lcmF0ZWQodHJ1ZSk7\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBp\nZiAoIXByZUZsdXNoaW5nKQogICAgICAgICAgICBfYnJva2VyLmZsdXNoKCk7\nCiAgICAgICAgcmV0dXJuICFwcmVGbHVzaGluZzsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldExvY2soKSB7CiAgICAgICAgcmV0dXJuIF9sb2NrOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldExvY2soT2JqZWN0IGxvY2spIHsK\nICAgICAgICBfbG9jayA9IGxvY2s7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBnZXRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfdmVyc2lvbjsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRWZXJzaW9uKE9iamVjdCB2ZXJzaW9u\nKSB7CiAgICAgICAgX2xvYWRWZXJzaW9uID0gdmVyc2lvbjsKICAgICAgICBh\nc3NpZ25WZXJzaW9uRmllbGQodmVyc2lvbik7CiAgICB9CgogICAgT2JqZWN0\nIGdldExvYWRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBfbG9hZFZlcnNp\nb247CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TmV4dFZlcnNpb24oT2Jq\nZWN0IHZlcnNpb24pIHsKICAgICAgICBhc3NpZ25WZXJzaW9uRmllbGQodmVy\nc2lvbik7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFzc2lnblZlcnNpb25G\naWVsZChPYmplY3QgdmVyc2lvbikgewogICAgICAgIF92ZXJzaW9uID0gdmVy\nc2lvbjsKICAgICAgICBGaWVsZE1ldGFEYXRhIHZmaWVsZCA9IF9tZXRhLmdl\ndFZlcnNpb25GaWVsZCgpOwogICAgICAgIGlmICh2ZmllbGQgIT0gbnVsbCkK\nICAgICAgICAgICAgc3RvcmUodmZpZWxkLmdldEluZGV4KCksIEphdmFUeXBl\ncy5jb252ZXJ0KHZlcnNpb24sCiAgICAgICAgICAgICAgICB2ZmllbGQuZ2V0\nVHlwZUNvZGUoKSkpOwogICAgfQoKICAgIHB1YmxpYyBQQ1N0YXRlIGdldFBD\nU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZTsKICAgIH0KCiAgICBw\ndWJsaWMgc3luY2hyb25pemVkIE9iamVjdCBnZXRJbXBsRGF0YSgpIHsKICAg\nICAgICByZXR1cm4gX2ltcGw7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9u\naXplZCBPYmplY3Qgc2V0SW1wbERhdGEoT2JqZWN0IGRhdGEsIGJvb2xlYW4g\nY2FjaGVhYmxlKSB7CiAgICAgICAgT2JqZWN0IG9sZCA9IF9pbXBsOwogICAg\nICAgIF9pbXBsID0gZGF0YTsKICAgICAgICBpZiAoY2FjaGVhYmxlICYmIGRh\ndGEgIT0gbnVsbCkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfSU1QTF9D\nQUNIRTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19JTVBMX0NBQ0hFOwogICAgICAgIHJldHVybiBvbGQ7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNJbXBsRGF0YUNhY2hlYWJsZSgpIHsKICAgICAg\nICByZXR1cm4gKF9mbGFncyAmIEZMQUdfSU1QTF9DQUNIRSkgIT0gMDsKICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEltcGxEYXRhKGludCBmaWVsZCkg\newogICAgICAgIHJldHVybiBnZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgdHJ1\nZSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBzZXRJbXBsRGF0YShpbnQg\nZmllbGQsIE9iamVjdCBkYXRhKSB7CiAgICAgICAgcmV0dXJuIHNldEV4dHJh\nRmllbGREYXRhKGZpZWxkLCBkYXRhLCB0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgc3luY2hyb25pemVkIGJvb2xlYW4gaXNJbXBsRGF0YUNhY2hlYWJsZShp\nbnQgZmllbGQpIHsKICAgICAgICBpZiAoX2ZpZWxkSW1wbCA9PSBudWxsIHx8\nICFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICBpZiAoX21ldGEuZ2V0RmllbGQoZmllbGQpLnVzZXNJbXBs\nRGF0YSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChm\naWVsZCk7CiAgICAgICAgcmV0dXJuIGlkeCAhPSAtMSAmJiBfZmllbGRJbXBs\nW2lkeF0gIT0gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldElu\ndGVybWVkaWF0ZShpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0RXh0\ncmFGaWVsZERhdGEoZmllbGQsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzZXRJbnRlcm1lZGlhdGUoaW50IGZpZWxkLCBPYmplY3QgZGF0YSkg\newogICAgICAgIHNldEV4dHJhRmllbGREYXRhKGZpZWxkLCBkYXRhLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRhdGEgZnJv\nbSB0aGUgcHJvcGVyIGluZGV4IG9mIHRoZSBleHRyYSBmaWVsZCBkYXRhIGFy\ncmF5LgogICAgICovCiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBPYmplY3Qg\nZ2V0RXh0cmFGaWVsZERhdGEoaW50IGZpZWxkLCBib29sZWFuIGlzTG9hZGVk\nKSB7CiAgICAgICAgLy8gb25seSByZXR1cm4gdGhlIGZpZWxkIGRhdGEgaWYg\ndGhlIGZpZWxkIGlzIGluIHRoZSByaWdodCBsb2FkZWQKICAgICAgICAvLyBz\ndGF0ZTsgb3RoZXJ3aXNlIHdlIG1pZ2h0IHJldHVybiBpbnRlcm1lZGlhdGUg\nZm9yIGltcGwgZGF0YSBvcgogICAgICAgIC8vIHZpY2UgdmVyc2EKICAgICAg\nICBpZiAoX2ZpZWxkSW1wbCA9PSBudWxsIHx8IF9sb2FkZWQuZ2V0KGZpZWxk\nKSAhPSBpc0xvYWRlZCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaW50IGlkeCA9IF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5kZXgoZmll\nbGQpOwogICAgICAgIHJldHVybiAoaWR4ID09IC0xKSA/IG51bGwgOiBfZmll\nbGRJbXBsW2lkeF07CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGRh\ndGEgZnJvbSB0byBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxkIGRh\ndGEgYXJyYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVkIE9i\namVjdCBzZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIE9iamVjdCBkYXRh\nLAogICAgICAgIGJvb2xlYW4gbG9hZGVkKSB7CiAgICAgICAgaW50IGlkeCA9\nIF9tZXRhLmdldEV4dHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwogICAgICAg\nIGlmIChpZHggPT0gLTEpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5h\nbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihfbWV0YS5nZXRGaWVsZChmaWVs\nZCkpKTsKCiAgICAgICAgT2JqZWN0IG9sZCA9IChfZmllbGRJbXBsID09IG51\nbGwpID8gbnVsbCA6IF9maWVsZEltcGxbaWR4XTsKICAgICAgICBpZiAoZGF0\nYSAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNhbm5vdCBzZXQgaWYgZmll\nbGQgaW4gd3JvbmcgbG9hZGVkIHN0YXRlCiAgICAgICAgICAgIGlmIChfbG9h\nZGVkLmdldChmaWVsZCkgIT0gbG9hZGVkKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRh\nLmdldEZpZWxkCiAgICAgICAgICAgICAgICAgICAgKGZpZWxkKSkpOwoKICAg\nICAgICAgICAgLy8gc2V0IGRhdGEKICAgICAgICAgICAgaWYgKF9maWVsZElt\ncGwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9maWVsZEltcGwgPSBuZXcg\nT2JqZWN0W19tZXRhLmdldEV4dHJhRmllbGREYXRhTGVuZ3RoKCldOwogICAg\nICAgICAgICBfZmllbGRJbXBsW2lkeF0gPSBkYXRhOwogICAgICAgIH0gZWxz\nZSBpZiAoX2ZpZWxkSW1wbCAhPSBudWxsICYmIF9sb2FkZWQuZ2V0KGZpZWxk\nKSA9PSBsb2FkZWQpCiAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IG51\nbGw7CiAgICAgICAgcmV0dXJuIG9sZDsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGZldGNoKGludCBmaWVsZCkgewogICAgICAgIE9iamVjdCB2YWwgPSBm\nZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIF9tZXRh\nLmdldEZpZWxkKGZpZWxkKS5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tl\ncik7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaEZpZWxkKGludCBm\naWVsZCwgYm9vbGVhbiB0cmFuc2l0aW9ucykgewogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlm\nIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkIiwKICAgICAgICAgICAgICAgIFN0\ncmluZy52YWx1ZU9mKGZpZWxkKSwgZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0\nQ2xhc3MoKSkpLgogICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KGdl\ndE1hbmFnZWRJbnN0YW5jZSgpKTsKCiAgICAgICAgLy8gZG8gbm9ybWFsIHN0\nYXRlIHRyYW5zaXRpb25zCiAgICAgICAgaWYgKCFmbWQuaXNQcmltYXJ5S2V5\nKCkgJiYgdHJhbnNpdGlvbnMpCiAgICAgICAgICAgIGFjY2Vzc2luZ0ZpZWxk\nKGZpZWxkKTsKCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoK\nICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaFN0cmluZ0ZpZWxkKGZpZWxk\nKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAg\nICAgcmV0dXJuIChmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCkpID8gQm9vbGVh\nbi5UUlVFCiAgICAgICAgICAgICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBCeXRlKGZldGNoQnl0ZUZpZWxkKGZpZWxkKSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IENoYXJhY3RlcihmZXRjaENoYXJGaWVsZChmaWVsZCkp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IERvdWJsZShmZXRjaERvdWJsZUZpZWxkKGZp\nZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdChmZXRjaEZsb2F0RmllbGQo\nZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAg\nICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihmZXRjaEludEZp\nZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZldGNo\nTG9uZ0ZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydChmZXRj\naFNob3J0RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHJldHVybiBmZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmUoaW50IGZp\nZWxkLCBPYmplY3QgdmFsKSB7CiAgICAgICAgdmFsID0gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpLmdldEZpZWxkVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAg\nICBzdG9yZUZpZWxkKGZpZWxkLCB2YWwpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0b3JlRmllbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsKSB7CiAgICAg\nICAgc3RvcmVGaWVsZChmaWVsZCwgdmFsLCB0aGlzKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIDxwPkNoZWNrcyB3aGV0aGVyIG9yIG5vdCA8Y29kZT5fcGM8\nL2NvZGU+IGlzIGRpcnR5LiBJbiB0aGUgY2FzZXMgd2hlcmUKICAgICAqIGZp\nZWxkIHRyYWNraW5nIGlzIG5vdCBoYXBwZW5pbmcgKHNlZSBiZWxvdyksIHRo\naXMgbWV0aG9kIHdpbGwgZG8gYQogICAgICogc3RhdGUgY29tcGFyaXNvbiB0\nbyBmaW5kIHdoZXRoZXIgPGNvZGU+X3BjPC9jb2RlPiBpcyBkaXJ0eSwgYW5k\nIHdpbGwKICAgICAqIHVwZGF0ZSB0aGlzIGluc3RhbmNlIHdpdGggdGhpcyBp\nbmZvcm1hdGlvbi4gSW4gdGhlIGNhc2VzIHdoZXJlIGZpZWxkCiAgICAgKiB0\ncmFja2luZyBpcyBoYXBwZW5pbmcsIHRoaXMgbWV0aG9kIGlzIGEgbm8tb3Au\nPC9wPgogICAgICoKICAgICAqIDxwPkZpZWxkcyBhcmUgdHJhY2tlZCBmb3Ig\nYWxsIGNsYXNzZXMgdGhhdCBhcmUgcnVuIHRocm91Z2ggdGhlIE9wZW5KUEEK\nICAgICAqIGVuaGFuY2VyIHByaW9yIHRvIG9yIGR1cmluZyBkZXBsb3ltZW50\nLCBhbmQgYWxsIGNsYXNzZXMgKGVuaGFuY2VkIG9yCiAgICAgKiB1bmVuaGFu\nY2VkKSBpbiBhIEphdmEgNiBlbnZpcm9ubWVudCBvciBuZXdlci48L3A+CiAg\nICAgKgogICAgICogPHA+SW4gYSBKYXZhIDUgVk0gb3Igb2xkZXI6CiAgICAg\nKiA8YnI+LSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2VzIHRoYXQg\ndXNlCiAgICAgKiBwcm9wZXJ0eSBhY2Nlc3MgYW5kIG9iZXkgdGhlIHByb3Bl\ncnR5IGFjY2VzcyBsaW1pdGF0aW9ucyBhcmUgdHJhY2tlZAogICAgICogd2hl\nbiB0aGUgaW5zdGFuY2VzIGFyZSBsb2FkZWQgZnJvbSB0aGUgZGF0YWJhc2Ug\nYnkgT3BlbkpQQSwgYW5kIGFyZQogICAgICogbm90IHRyYWNrZWQgd2hlbiB0\naGUgaW5zdGFuY2VzIGFyZSBjcmVhdGVkIGJ5IGFwcGxpY2F0aW9uIGNvZGUu\nCiAgICAgKiA8YnI+LSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2Vz\nIHRoYXQgdXNlIGZpZWxkIGFjY2VzcyBhcmUKICAgICAqIG5ldmVyIHRyYWNr\nZWQuPC9wPgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBkaXJ0eUNoZWNrKCkgewogICAgICAgIGlmICghbmVl\nZHNEaXJ0eUNoZWNrKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nU2F2ZUZpZWxkTWFuYWdlciBzYXZlZCA9IGdldFNhdmVGaWVsZE1hbmFnZXIo\nKTsKICAgICAgICBpZiAoc2F2ZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZlZC1m\naWVsZHMiKSk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0\nTWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gcGsg\nYW5kIHZlcnNpb24gZmllbGRzIGNhbm5vdCBiZSBtdXRhdGVkOyBkb24ndCBt\nYXJrIHRoZW0KICAgICAgICAgICAgLy8gYXMgc3VjaC4gIyMjIyMgdmFsaWRh\ndGU/CiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAm\nJiAhZm1kc1tpXS5pc1ZlcnNpb24oKQogICAgICAgICAgICAgICAgJiYgX2xv\nYWRlZC5nZXQoaSkpIHsKICAgICAgICAgICAgICAgIGlmICghc2F2ZWQuaXNG\naWVsZEVxdWFsKGksIGZldGNoKGkpKSkgewogICAgICAgICAgICAgICAgICAg\nIGRpcnR5KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBuZWVkc0RpcnR5\nQ2hlY2soKSB7CiAgICAgICAgaWYgKGlzSW50ZXJjZXB0aW5nKCkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoaXNEZWxldGVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoaXNOZXco\nKSAmJiAhaXNGbHVzaGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGZldGNoSW5pdGlhbEZpZWxkKGludCBmaWVsZCkgewogICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAg\nIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpID09IFJlc3RvcmVTdGF0\nZS5SRVNUT1JFX05PTkUKICAgICAgICAgICAgJiYgKChfZmxhZ3MgJiBGTEFH\nX0lOVkVSU0VTKSA9PSAwCiAgICAgICAgICAgIHx8IGZtZC5nZXRJbnZlcnNl\nTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZXN0b3JlLXVu\nc2V0IikpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5N\nQVA6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAg\nICAgICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBzYXZpbmcgbXV0YWJsZSB0eXBl\ncywgdGhyb3cgYW4gZXhjZXB0aW9uCiAgICAgICAgICAgICAgICBpZiAoX2Jy\nb2tlci5nZXRSZXN0b3JlU3RhdGUoKSAhPSBSZXN0b3JlU3RhdGUuUkVTVE9S\nRV9BTEwKICAgICAgICAgICAgICAgICAgICAmJiAoKF9mbGFncyAmIEZMQUdf\nSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0\nSW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0aCA9PSAwKSkKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgibXV0YWJsZS1yZXN0b3Jl\nLXVuc2V0IikpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmIChfc2F2ZWQgPT0gbnVsbCB8fCAhX2xv\nYWRlZC5nZXQoZmllbGQpIHx8ICFfZGlydHkuZ2V0KGZpZWxkKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7Cgog\nICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgaXMgZGlydHkgYnV0IHdlIG5l\ndmVyIGxvYWRlZCBpdCwgd2UgY2FuJ3QgcmVzdG9yZSBpdAogICAgICAgICAg\nICBpZiAoX3NhdmVkLmdldFVubG9hZGVkKCkuZ2V0KGZpZWxkKSkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQoImluaXRpYWwtdW5sb2FkZWQiLAogICAgICAgICAgICAgICAgICAg\nIGZtZCkpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9zYXZlZC5nZXRT\ndGF0ZSgpLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBm\nZXRjaEZpZWxkKF9zaW5nbGUsIGZtZCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogRmV0Y2ggdGhlIHNwZWNpZmllZCBmaWVsZCBmcm9tIHRoZSBz\ncGVjaWZpZWQgZmllbGQgbWFuYWdlciwgd3JhcHBpbmcgaXQKICAgICAqIGlu\nIGFuIG9iamVjdCBpZiBpdCdzIGEgcHJpbWl0aXZlLiBBIGZpZWxkIHNob3Vs\nZCBiZSBwcm92aWRlZCB0byB0aGUKICAgICAqIGZpZWxkIG1hbmFnZXIgYmVm\nb3JlIHRoaXMgY2FsbCBpcyBtYWRlLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBPYmplY3QgZmV0Y2hGaWVsZChGaWVsZE1hbmFnZXIgZm0sIEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaW50IGZpZWxkID0gZm1kLmdldElu\nZGV4KCk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAg\nICAgICAgICAgICAgICByZXR1cm4gKGZtLmZldGNoQm9vbGVhbkZpZWxkKGZp\nZWxkKSkgPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJv\nb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoZm0uZmV0Y2hCeXRl\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hB\nUjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFjdGVyKGZtLmZl\ndGNoQ2hhckZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91Ymxl\nKGZtLmZldGNoRG91YmxlRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIEZsb2F0KGZtLmZldGNoRmxvYXRGaWVsZChmaWVsZCkpOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nTnVtYmVycy52YWx1ZU9mKGZtLmZldGNoSW50RmllbGQoZmllbGQpKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAg\nIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0Y2hMb25nRmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IFNob3J0KGZtLmZldGNoU2hvcnRGaWVs\nZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZm0uZmV0Y2hTdHJpbmdGaWVsZChm\naWVsZCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZm0uZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFJlbW90ZShpbnQgZmllbGQsIE9i\namVjdCB2YWx1ZSkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVh\nbi5GQUxTRSwgZmFsc2UpOwogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxk\nLCB2YWx1ZSwgX3NpbmdsZSk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChf\ncGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0\nYXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIExpZmVjeWNsZSBvcGVyYXRpb25zCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlvbiB0\naGF0IHRoZSBvYmplY3QgaXMgYWJvdXQgdG8gYmUgYWNjZXNzZWQuCiAgICAg\nKgogICAgICogQHBhcmFtIGZpZWxkIHRoZSBmaWVsZCBudW1iZXIgYmVpbmcg\ncmVhZCwgb3IgLTEgaWYgbm90IGEgc2luZ2xlCiAgICAgKiBmaWVsZCByZWFk\nCiAgICAgKi8KICAgIHZvaWQgYmVmb3JlUmVhZChpbnQgZmllbGQpIHsKICAg\nICAgICAvLyBhbGxvdyB1bm1lZGlhdGVkIHJlYWRzIG9mIHByaW1hcnkga2V5\nIGZpZWxkcwogICAgICAgIGlmIChmaWVsZCAhPSAtMSAmJiBfbWV0YS5nZXRG\naWVsZChmaWVsZCkuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgaWYgKF9icm9rZXIuaXNBY3RpdmUoKSAmJiAhX2Jyb2tl\nci5pc1RyYW5zYWN0aW9uRW5kaW5nKCkpIHsKICAgICAgICAgICAgaWYgKF9i\ncm9rZXIuZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUuYmVmb3JlT3B0aW1pc3RpY1JlYWQodGhpcywgZmllbGQp\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUuYmVmb3JlUmVhZCh0aGlzLCBmaWVsZCkpOwogICAgICAgIH0g\nZWxzZSBpZiAoX2Jyb2tlci5nZXROb250cmFuc2FjdGlvbmFsUmVhZCgpKQog\nICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVOb250cmFuc2Fj\ndGlvbmFsUmVhZCh0aGlzLCBmaWVsZCkpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm9uLXRyYW5zLXJlYWQiKSkuCiAgICAgICAgICAgICAgICBzZXRGYWls\nZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAg\nICoKICAgICAqIEBzZWUgUENTdGF0ZSNiZWZvcmVGbHVzaAogICAgICovCiAg\nICB2b2lkIGJlZm9yZUZsdXNoKGludCByZWFzb24sIE9wQ2FsbGJhY2tzIGNh\nbGwpIHsKICAgICAgICBfc3RhdGUuYmVmb3JlRmx1c2godGhpcywgcmVhc29u\nID09IEJyb2tlckltcGwuRkxVU0hfTE9HSUNBTCwgY2FsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUu\nCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2ZsdXNoCiAgICAgKi8KICAg\nIHZvaWQgYWZ0ZXJGbHVzaChpbnQgcmVhc29uKSB7CiAgICAgICAgLy8gbm90\naGluZyBoYXBwZW5zIHdoZW4gd2UgZmx1c2ggbm9uLXBlcnNpc3RlbnQgc3Rh\ndGVzCiAgICAgICAgaWYgKCFpc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAocmVhc29uICE9IEJyb2tlckltcGwuRkxV\nU0hfUk9MTEJBQ0sKICAgICAgICAgICAgJiYgcmVhc29uICE9IEJyb2tlcklt\ncGwuRkxVU0hfTE9HSUNBTCkgewogICAgICAgICAgICAvLyBhbmFseXplIHBy\nZXZpb3VzIHN0YXRlIGZvciBsYXRlcgogICAgICAgICAgICBib29sZWFuIHdh\nc05ldyA9IGlzTmV3KCk7CiAgICAgICAgICAgIGJvb2xlYW4gd2FzRmx1c2hl\nZCA9IGlzRmx1c2hlZCgpOwogICAgICAgICAgICBib29sZWFuIHdhc0RlbGV0\nZWQgPSBpc0RlbGV0ZWQoKTsKCiAgICAgICAgICAgIC8vIGFsbCBkaXJ0eSBm\naWVsZHMgd2VyZSBmbHVzaGVkCiAgICAgICAgICAgIF9mbHVzaC5vcihfZGly\ndHkpOwoKICAgICAgICAgICAgLy8gaW1wb3J0YW50IHRvIHNldCBmbHVzaGVk\nIGJpdCBhZnRlciBjYWxsaW5nIF9zdGF0ZS5mbHVzaCBzbwogICAgICAgICAg\nICAvLyB0aGF0IHRoZSBzdGF0ZSBjYW4gdGVsbCB3aGV0aGVyIHRoaXMgaXMg\ndGhlIGZpcnN0IGZsdXNoCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRl\nLmZsdXNoKHRoaXMpKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxV\nU0hFRDsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElS\nVFk7CgogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9DSEVD\nSzsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05fVVBEQVRF\nOwoKICAgICAgICAgICAgLy8gaWYgdGhpcyB3YXMgYW4gaW5jIGZsdXNoIGR1\ncmluZyB3aGljaCB3ZSBoYWQgb3VyIGlkZW50aXR5CiAgICAgICAgICAgIC8v\nIGFzc2lnbmVkLCB0ZWxsIHRoZSBicm9rZXIgdG8gY2FjaGUgdXMgdW5kZXIg\nb3VyIGZpbmFsIG9pZAogICAgICAgICAgICBpZiAocmVhc29uID09IEJyb2tl\nckltcGwuRkxVU0hfSU5DKQogICAgICAgICAgICAgICAgYXNzZXJ0T2JqZWN0\nSWRBc3NpZ25lZCh0cnVlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoaXMgb2Jq\nZWN0IHdhcyBzdG9yZWQgd2l0aCBwcmVGbHVzaCwgZG8gcG9zdC1zdG9yZSBj\nYWxsYmFjawogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfUFJFX0ZM\nVVNIRUQpID4gMCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVu\ndChMaWZlY3ljbGVFdmVudC5BRlRFUl9TVE9SRSk7CgogICAgICAgICAgICAv\nLyBkbyBwb3N0LXVwZGF0ZSBhcyBuZWVkZWQKICAgICAgICAgICAgaWYgKHdh\nc05ldyAmJiAhd2FzRmx1c2hlZCkKICAgICAgICAgICAgICAgIGZpcmVMaWZl\nY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9QRVJTSVNUX1BFUkZP\nUk1FRCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHdhc0RlbGV0ZWQpCiAgICAg\nICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQu\nQUZURVJfREVMRVRFX1BFUkZPUk1FRCk7CiAgICAgICAgICAgIGVsc2UgCiAg\nICAgICAgICAgICAgICAvLyB1cGRhdGVzIGFuZCBuZXctZmx1c2hlZCB3aXRo\nIGNoYW5nZXMKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChM\naWZlY3ljbGVFdmVudC5BRlRFUl9VUERBVEVfUEVSRk9STUVEKTsKICAgICAg\nICB9IGVsc2UgaWYgKHJlYXNvbiA9PSBCcm9rZXJJbXBsLkZMVVNIX1JPTExC\nQUNLKSB7CiAgICAgICAgICAgIC8vIHJldmVydCB0byBsYXN0IGxvYWRlZCB2\nZXJzaW9uIGFuZCBvcmlnaW5hbCBvaWQKICAgICAgICAgICAgYXNzaWduVmVy\nc2lvbkZpZWxkKF9sb2FkVmVyc2lvbik7CiAgICAgICAgICAgIGlmIChpc05l\ndygpICYmIChfZmxhZ3MgJiBGTEFHX09JRF9BU1NJR05FRCkgPT0gMCkKICAg\nICAgICAgICAgICAgIF9vaWQgPSBudWxsOwogICAgICAgIH0KICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfUFJFX0ZMVVNIRUQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUgYWZ0ZXIgY2hl\nY2tpbmcgdGhlIHZhbHVlCiAgICAgKiBvZiB0aGUgUmV0YWluU3RhdGUgZmxh\nZy4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjY29tbWl0CiAgICAgKiBA\nc2VlIFBDU3RhdGUjY29tbWl0UmV0YWluCiAgICAgKi8KICAgIHZvaWQgY29t\nbWl0KCkgewogICAgICAgIC8vIHJlbGVhc2UgbG9ja3MgYmVmb3JlIG9pZCB1\ncGRhdGVkCiAgICAgICAgcmVsZWFzZUxvY2tzKCk7CgogICAgICAgIC8vIHVw\nZGF0ZSB2ZXJzaW9uIGFuZCBvaWQgaW5mb3JtYXRpb24KICAgICAgICBzZXRW\nZXJzaW9uKF92ZXJzaW9uKTsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxV\nU0hFRDsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJUWTsK\nCiAgICAgICAgT2JqZWN0IG9yaWcgPSBfaWQ7CiAgICAgICAgYXNzZXJ0T2Jq\nZWN0SWRBc3NpZ25lZChmYWxzZSk7CgogICAgICAgIGJvb2xlYW4gd2FzTmV3\nID0gaXNOZXcoKSAmJiAhaXNEZWxldGVkKCkgJiYgIWlzUHJvdmlzaW9uYWwo\nKTsKICAgICAgICBpZiAoX2Jyb2tlci5nZXRSZXRhaW5TdGF0ZSgpKQogICAg\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5jb21taXRSZXRhaW4odGhpcykp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUu\nY29tbWl0KHRoaXMpKTsKCiAgICAgICAgLy8gYXNrIHRoZSBicm9rZXIgdG8g\ncmUtY2FjaGUgdXMgaWYgd2Ugd2VyZSBuZXcgcHJldmlvdXNseQogICAgICAg\nIGlmICh3YXNOZXcpCiAgICAgICAgICAgIF9icm9rZXIuc2V0U3RhdGVNYW5h\nZ2VyKG9yaWcsIHRoaXMsIEJyb2tlckltcGwuU1RBVFVTX0NPTU1JVF9ORVcp\nOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJy\nZW50IHN0YXRlIGFmdGVyIGNoZWNraW5nIHRoZSB2YWx1ZQogICAgICogb2Yg\ndGhlIFJldGFpblN0YXRlIGZsYWcuCiAgICAgKgogICAgICogQHNlZSBQQ1N0\nYXRlI3JvbGxiYWNrCiAgICAgKiBAc2VlIFBDU3RhdGUjcm9sbGJhY2tSZXN0\nb3JlCiAgICAgKi8KICAgIHZvaWQgcm9sbGJhY2soKSB7CiAgICAgICAgLy8g\ncmVsZWFzZSBsb2NrcwogICAgICAgIHJlbGVhc2VMb2NrcygpOwogICAgICAg\nIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEOwogICAgICAgIF9mbGFncyAmPSB+\nRkxBR19GTFVTSEVEX0RJUlRZOwogICAgICAgIGFmdGVyRmx1c2goQnJva2Vy\nSW1wbC5GTFVTSF9ST0xMQkFDSyk7CgogICAgICAgIGlmIChfYnJva2VyLmdl\ndFJlc3RvcmVTdGF0ZSgpICE9IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUp\nCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnJvbGxiYWNrUmVzdG9y\nZSh0aGlzKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5yb2xsYmFjayh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSb2xsYmFjayBzdGF0ZSBvZiB0aGUgbWFuYWdlZCBpbnN0YW5jZSB0byB0\naGUgZ2l2ZW4gc2F2ZXBvaW50LgogICAgICovCiAgICB2b2lkIHJvbGxiYWNr\nVG9TYXZlcG9pbnQoU2F2ZXBvaW50RmllbGRNYW5hZ2VyIHNhdmVwb2ludCkg\newogICAgICAgIF9zdGF0ZSA9IHNhdmVwb2ludC5nZXRQQ1N0YXRlKCk7CiAg\nICAgICAgQml0U2V0IGxvYWRlZCA9IHNhdmVwb2ludC5nZXRMb2FkZWQoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gbG9hZGVkLmxlbmd0aCgp\nOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaWYgKGxvYWRlZC5nZXQo\naSkgJiYgc2F2ZXBvaW50LnJlc3RvcmVGaWVsZChpKSkgewogICAgICAgICAg\nICAgICAgcHJvdmlkZUZpZWxkKHNhdmVwb2ludC5nZXRDb3B5KCksIHNhdmVw\nb2ludCwgaSk7CiAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBz\nYXZlcG9pbnQsIGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIF9sb2FkZWQgPSBsb2FkZWQ7CiAgICAgICAgX2RpcnR5ID0gc2F2ZXBvaW50\nLmdldERpcnR5KCk7CiAgICAgICAgX2ZsdXNoID0gc2F2ZXBvaW50LmdldEZs\ndXNoZWQoKTsKICAgICAgICBfdmVyc2lvbiA9IHNhdmVwb2ludC5nZXRWZXJz\naW9uKCk7CiAgICAgICAgX2xvYWRWZXJzaW9uID0gc2F2ZXBvaW50LmdldExv\nYWRWZXJzaW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMg\ndG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0\nYXRlI3BlcnNpc3QKICAgICAqIEBzZWUgQnJva2VyI3BlcnNpc3QKICAgICAq\nLwogICAgdm9pZCBwZXJzaXN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0\nYXRlLnBlcnNpc3QodGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVs\nZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBz\nZWUgUENTdGF0ZSNkZWxldGUKICAgICAqIEBzZWUgQnJva2VyI2RlbGV0ZQog\nICAgICovCiAgICB2b2lkIGRlbGV0ZSgpIHsKICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS5kZWxldGUodGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICog\nRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAq\nIEBzZWUgUENTdGF0ZSNub250cmFuc2FjdGlvbmFsCiAgICAgKiBAc2VlIEJy\nb2tlciNub250cmFuc2FjdGlvbmFsCiAgICAgKi8KICAgIHZvaWQgbm9udHJh\nbnNhY3Rpb25hbCgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub250\ncmFuc2FjdGlvbmFsKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERl\nbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBA\nc2VlIFBDU3RhdGUjdHJhbnNhY3Rpb25hbAogICAgICogQHNlZSBCcm9rZXIj\ndHJhbnNhY3Rpb25hbAogICAgICovCiAgICB2b2lkIHRyYW5zYWN0aW9uYWwo\nKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUudHJhbnNhY3Rpb25hbCh0\naGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhl\nIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI25v\nbnByb3Zpc2lvbmFsCiAgICAgKi8KICAgIHZvaWQgbm9ucHJvdmlzaW9uYWwo\nYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAg\nc2V0UENTdGF0ZShfc3RhdGUubm9ucHJvdmlzaW9uYWwodGhpcywgbG9naWNh\nbCwgY2FsbCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRv\nIHRoZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0\nZSNyZWxlYXNlCiAgICAgKiBAc2VlIEJyb2tlciNyZWxlYXNlCiAgICAgKi8K\nICAgIHZvaWQgcmVsZWFzZShib29sZWFuIHVucHJveHkpIHsKICAgICAgICBy\nZWxlYXNlKHVucHJveHksIGZhbHNlKTsKICAgIH0KCiAgICB2b2lkIHJlbGVh\nc2UoYm9vbGVhbiB1bnByb3h5LCBib29sZWFuIGZvcmNlKSB7CiAgICAgICAg\nLy8gb3B0aW1pemF0aW9uIGZvciBkZXRhY2gtaW4tcGxhY2Ugc3BlY2lhbCBj\nYXNlIHdoZW4gZmllbGRzIGFyZQogICAgICAgIC8vIGFscmVhZHkgKHVuKXBy\nb3hpZWQgY29ycmVjdGx5CiAgICAgICAgaWYgKCF1bnByb3h5KQogICAgICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19OT19VTlBST1hZOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChmb3JjZSkKICAgICAgICAgICAgICAgIHNldFBD\nU3RhdGUoUENTdGF0ZS5UUkFOU0lFTlQpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5yZWxlYXNlKHRoaXMp\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfTk9fVU5QUk9YWTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgog\nICAgICogQHNlZSBQQ1N0YXRlI2V2aWN0CiAgICAgKiBAc2VlIEJyb2tlciNl\ndmljdAogICAgICovCiAgICB2b2lkIGV2aWN0KCkgewogICAgICAgIHNldFBD\nU3RhdGUoX3N0YXRlLmV2aWN0KHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdhdGhlciByZWxhdGlvbnMgcmVhY2hhYmxlIGZyb20gdmFsdWVzIHVz\naW5nCiAgICAgKiB7QGxpbmsgVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lNTUVE\nSUFURX0uCiAgICAgKi8KICAgIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2go\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoaSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIGlmIChmbWRzW2ldLmdldENhc2NhZGVSZWZyZXNoKCkgPT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAg\nICAgfHwgZm1kc1tpXS5nZXRLZXkoKS5nZXRDYXNjYWRlUmVmcmVzaCgpCiAg\nICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJ\nQVRFCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEVsZW1lbnQoKS5n\nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChpLCBmYWxz\nZSkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5nYXRoZXJDYXNjYWRlUmVm\ncmVzaChjYWxsKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBiZWZvcmVSZWZyZXNoKGJvb2xlYW4gcmVmcmVzaEFsbCkgewogICAg\nICAgIC8vIG5vdGU6IGFsbCBsb2dpYyBwbGFjZWQgaGVyZSByYXRoZXIgdGhh\nbiBpbiB0aGUgc3RhdGVzIGZvcgogICAgICAgIC8vIG9wdGltaXphdGlvbjsg\ndGhpcyBtZXRob2QgcHVibGljIGIvYyB1c2VkIGJ5IHJlbW90ZSBwYWNrYWdl\nCgogICAgICAgIC8vIG5vdGhpbmcgdG8gZG8gZm9yIG5vbiBwZXJzaXN0ZW50\nIG9yIG5ldyB1bmZsdXNoZWQgaW5zdGFuY2VzCiAgICAgICAgaWYgKCFpc1Bl\ncnNpc3RlbnQoKSB8fCAoaXNOZXcoKSAmJiAhaXNGbHVzaGVkKCkpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBpZiBkaXJ0eSBuZWVkIHRvIGNsZWFy\nIGZpZWxkcwogICAgICAgICAgICBpZiAoaXNEaXJ0eSgpKSB7CiAgICAgICAg\nICAgICAgICBjbGVhckZpZWxkcygpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHNvbWUg\nZmllbGRzIGhhdmUgYmVlbiBsb2FkZWQgYnV0IHRoZSBpbnN0YW5jZSBpcyBv\ndXQgb2YKICAgICAgICAgICAgLy8gZGF0ZSBvciB0aGlzIGlzIHBhcnQgb2Yg\nYSByZWZyZXNoQWxsKCkgYW5kIHdlIGRvbid0IHdhbnQgdG8KICAgICAgICAg\nICAgLy8gdGFrZSB0aGUgZXh0cmEgaGl0IHRvIHNlZSBpZiB0aGUgaW5zdGFu\nY2UgaXMgb3V0IG9mIGRhdGUsIGNsZWFyCiAgICAgICAgICAgIGlmIChfbG9h\nZGVkLmxlbmd0aCgpID4gMCAmJiAocmVmcmVzaEFsbCB8fCBpc0VtYmVkZGVk\nKCkKICAgICAgICAgICAgICAgIHx8ICFzeW5jVmVyc2lvbihudWxsKSkpIHsK\nICAgICAgICAgICAgICAgIE9iamVjdCB2ZXJzaW9uID0gX3ZlcnNpb247CiAg\nICAgICAgICAgICAgICBjbGVhckZpZWxkcygpOwoKICAgICAgICAgICAgICAg\nIC8vIGlmIHN5bmNWZXJzaW9uIGp1c3QgcmVwbGFjZWQgdGhlIHZlcnNpb24s\nIHJlc2V0IGl0CiAgICAgICAgICAgICAgICBpZiAoIXJlZnJlc2hBbGwgJiYg\nIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAgICAgICBzZXRWZXJzaW9u\nKHZlcnNpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gc3RhdGUgdHJhbnNpdGlvbnMg\nYWZ0ZXIgcmVmcmVzaC4gVGhpcyBtZXRob2QgaXMgb25seQogICAgICogY2Fs\nbGVkIGlmIHtAbGluayAjYmVmb3JlUmVmcmVzaH0gcmV0dXJucyB0cnVlLgog\nICAgICovCiAgICB2b2lkIGFmdGVyUmVmcmVzaCgpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gdHJhbnNpdGlvbiB0\nbyBjbGVhbiBvciBub250cmFuc2FjdGlvbmFsIGRlcGVuZGluZyBvbiB0cmFu\ncyBzdGF0dXMKICAgICAgICAgICAgaWYgKCFfYnJva2VyLmlzQWN0aXZlKCkp\nCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5hZnRlck5vbnRy\nYW5zYWN0aW9uYWxSZWZyZXNoKCkpOwogICAgICAgICAgICBlbHNlIGlmIChf\nYnJva2VyLmdldE9wdGltaXN0aWMoKSkKICAgICAgICAgICAgICAgIHNldFBD\nU3RhdGUoX3N0YXRlLmFmdGVyT3B0aW1pc3RpY1JlZnJlc2goKSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRl\nLmFmdGVyUmVmcmVzaCgpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYXJrIHRoaXMgb2JqZWN0IGFzIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVu\ndCBvYmplY3QuCiAgICAgKi8KICAgIHZvaWQgc2V0RGVyZWZlcmVuY2VkRGVw\nZW5kZW50KGJvb2xlYW4gZGVyZWYsIGJvb2xlYW4gbm90aWZ5KSB7CiAgICAg\nICAgaWYgKCFkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19ERVJFRikgPiAwKSB7\nCiAgICAgICAgICAgIGlmIChub3RpZnkpCiAgICAgICAgICAgICAgICBfYnJv\na2VyLnJlbW92ZURlcmVmZXJlbmNlZERlcGVuZGVudCh0aGlzKTsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX0RFUkVGOwogICAgICAgIH0gZWxzZSBp\nZiAoZGVyZWYgJiYgKF9mbGFncyAmIEZMQUdfREVSRUYpID09IDApIHsKICAg\nICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfREVSRUY7CiAgICAgICAgICAgIGlm\nIChub3RpZnkpCiAgICAgICAgICAgICAgICBfYnJva2VyLmFkZERlcmVmZXJl\nbmNlZERlcGVuZGVudCh0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLy8v\nLy8vLy8vLy8KICAgIC8vIExvY2tpbmcKICAgIC8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB3ZSd2ZSBiZWVuIHJlYWQt\nbG9ja2VkLiBQYXNzIGluIHRoZSBsZXZlbCBhdCB3aGljaAogICAgICogd2Ug\nd2VyZSBsb2NrZWQgYW5kIHRoZSBsZXZlbCBhdCB3aGljaCB3ZSBzaG91bGQg\nd3JpdGUgbG9jayBvdXJzZWx2ZXMKICAgICAqIG9uIGRpcnR5LgogICAgICov\nCiAgICB2b2lkIHJlYWRMb2NrZWQoaW50IHJlYWRMb2NrTGV2ZWwsIGludCB3\ncml0ZUxvY2tMZXZlbCkgewogICAgICAgIC8vIG1ha2Ugc3VyZSBvYmplY3Qg\naXMgYWRkZWQgdG8gdHJhbnNhY3Rpb24gc28gbG9jayB3aWxsIGdldAogICAg\nICAgIC8vIGNsZWFyZWQgb24gY29tbWl0L3JvbGxiYWNrCiAgICAgICAgaWYg\nKHJlYWRMb2NrTGV2ZWwgIT0gTG9ja0xldmVscy5MT0NLX05PTkUpCiAgICAg\nICAgICAgIHRyYW5zYWN0aW9uYWwoKTsKCiAgICAgICAgX3JlYWRMb2NrTGV2\nZWwgPSByZWFkTG9ja0xldmVsOwogICAgICAgIF93cml0ZUxvY2tMZXZlbCA9\nIHdyaXRlTG9ja0xldmVsOwogICAgICAgIF9mbGFncyB8PSBGTEFHX1JFQURf\nTE9DS0VEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19XUklURV9MT0NLRUQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxvY2sgbGV2ZWwg\ndG8gdXNlIHdoZW4gbG9hZGluZyBzdGF0ZS4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgY2FsY3VsYXRlTG9ja0xldmVsKGJvb2xlYW4gYWN0aXZlLCBib29s\nZWFuIGZvcldyaXRlLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkgewogICAgICAgIGlmICghYWN0aXZlKQogICAgICAgICAgICByZXR1cm4g\nTG9ja0xldmVscy5MT0NLX05PTkU7CiAgICAgICAgaWYgKGZldGNoID09IG51\nbGwpCiAgICAgICAgICAgIGZldGNoID0gX2Jyb2tlci5nZXRGZXRjaENvbmZp\nZ3VyYXRpb24oKTsKCiAgICAgICAgaWYgKF9yZWFkTG9ja0xldmVsID09IC0x\nKQogICAgICAgICAgICBfcmVhZExvY2tMZXZlbCA9IGZldGNoLmdldFJlYWRM\nb2NrTGV2ZWwoKTsKICAgICAgICBpZiAoX3dyaXRlTG9ja0xldmVsID09IC0x\nKQogICAgICAgICAgICBfd3JpdGVMb2NrTGV2ZWwgPSBmZXRjaC5nZXRXcml0\nZUxvY2tMZXZlbCgpOwogICAgICAgIHJldHVybiAoZm9yV3JpdGUpID8gX3dy\naXRlTG9ja0xldmVsIDogX3JlYWRMb2NrTGV2ZWw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYWtlIHN1cmUgd2UncmUgbG9ja2VkIGF0IHRoZSBnaXZlbiBs\nZXZlbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG9idGFpbkxvY2tzKGJv\nb2xlYW4gYWN0aXZlLCBib29sZWFuIGZvcldyaXRlLCBpbnQgbG9ja0xldmVs\nLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IHNk\nYXRhKSB7CiAgICAgICAgaWYgKCFhY3RpdmUpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZW4ndCBiZWVuIGxvY2tlZCB5ZXQs\nIGxvY2sgbm93IGF0IHRoZSBnaXZlbiBsZXZlbAogICAgICAgIGludCBmbGFn\nID0gKGZvcldyaXRlKSA/IEZMQUdfV1JJVEVfTE9DS0VEIDogRkxBR19SRUFE\nX0xPQ0tFRDsKICAgICAgICBpZiAoKF9mbGFncyAmIGZsYWcpID09IDApIHsK\nICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG9iamVjdCBpcyBhZGRlZCB0byB0\ncmFuc2FjdGlvbiBzbyBsb2NrIHdpbGwgZ2V0CiAgICAgICAgICAgIC8vIGNs\nZWFyZWQgb24gY29tbWl0L3JvbGxiYWNrCiAgICAgICAgICAgIGlmIChsb2Nr\nTGV2ZWwgIT0gTG9ja0xldmVscy5MT0NLX05PTkUpCiAgICAgICAgICAgICAg\nICB0cmFuc2FjdGlvbmFsKCk7CgogICAgICAgICAgICBpZiAoZmV0Y2ggPT0g\nbnVsbCkKICAgICAgICAgICAgICAgIGZldGNoID0gX2Jyb2tlci5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgX2Jyb2tlci5nZXRMb2Nr\nTWFuYWdlcigpLmxvY2sodGhpcywgbG9ja0xldmVsLAogICAgICAgICAgICAg\nICAgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgc2RhdGEpOwogICAgICAgICAg\nICBfZmxhZ3MgfD0gRkxBR19SRUFEX0xPQ0tFRDsKICAgICAgICAgICAgX2Zs\nYWdzIHw9IGZsYWc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmVsZWFzZSBsb2Nrcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbGVh\nc2VMb2NrcygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkKICAgICAg\nICAgICAgX2Jyb2tlci5nZXRMb2NrTWFuYWdlcigpLnJlbGVhc2UodGhpcyk7\nCiAgICAgICAgX3JlYWRMb2NrTGV2ZWwgPSAtMTsKICAgICAgICBfd3JpdGVM\nb2NrTGV2ZWwgPSAtMTsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUkVBRF9M\nT0NLRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1dSSVRFX0xPQ0tFRDsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3RhdGVNYW5h\nZ2VyIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBzZXJpYWxp\nemluZygpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX21ldGEu\naXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRGV0YWNo\nTWFuYWdlci5wcmVTZXJpYWxpemUodGhpcyk7CgogICAgICAgICAgICBsb2Fk\nKF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksIExPQURfU0VSSUFM\nSVpFLCBudWxsLCBudWxsLCAKICAgICAgICAgICAgICAgIGZhbHNlKTsKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRl\nKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gd3Jp\ndGVEZXRhY2hlZChPYmplY3RPdXRwdXQgb3V0KQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgQml0U2V0IGlkeHMgPSBuZXcgQml0U2V0\nKF9tZXRhLmdldEZpZWxkcygpLmxlbmd0aCk7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gZGV0c20gPSBEZXRh\nY2hNYW5hZ2VyLndyaXRlRGV0YWNoZWRTdGF0ZSh0aGlzLCBvdXQsIGlkeHMp\nOwogICAgICAgICAgICBpZiAoZGV0c20pCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19ERVRBQ0hJTkc7CgogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChmbWRzW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBwcm92aWRl\nRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuc2VyaWFsaXplKG91dCwgIWlkeHMuZ2V0KGkpKTsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFH\nX0RFVEFDSElORzsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3h5RGV0YWNoZWREZXNlcmlhbGl6\nZWQoaW50IGlkeCkgewogICAgICAgIC8vIHdlIGRvbid0IHNlcmlhbGl6ZSBz\ndGF0ZSBtYW5hZ2VyIGltcGxzCiAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFu\nc2FjdGlvbmFsKCkgewogICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgVENM\nRUFOLCB3aGljaCB3ZSB3YW50IHRvIGFwcGVhciBub24tdHJhbnMgdG8KICAg\nICAgICAvLyBpbnRlcm5hbCBjb2RlLCBidXQgd2hpY2ggcHVibGljbHkgc2hv\ndWxkIGJlIHRyYW5zYWN0aW9uYWwKICAgICAgICByZXR1cm4gX3N0YXRlID09\nIFBDU3RhdGUuVENMRUFOIHx8IF9zdGF0ZS5pc1RyYW5zYWN0aW9uYWwoKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlbmRpbmdUcmFuc2FjdGlv\nbmFsKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNQZW5kaW5nVHJhbnNh\nY3Rpb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUHJvdmlz\naW9uYWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1Byb3Zpc2lvbmFs\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZXJzaXN0ZW50KCkg\newogICAgICAgIHJldHVybiBfc3RhdGUuaXNQZXJzaXN0ZW50KCk7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNOZXcoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdGF0ZS5pc05ldygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRGVsZXRlZCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzRGVsZXRlZCgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5pc0RpcnR5KCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNEZXRhY2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIEZMQUdfREVUQUNISU5HKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZ2V0R2VuZXJpY0NvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9i\ncm9rZXI7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaE9iamVjdElk\nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2lnbk9iamVjdElk\nKHRydWUpOwogICAgICAgICAgICBpZiAoX29pZCA9PSBudWxsIHx8ICFfYnJv\na2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgIGdldENv\nbXBhdGliaWxpdHlJbnN0YW5jZSgpLmdldENvcHlPYmplY3RJZHMoKSkKICAg\nICAgICAgICAgICAgIHJldHVybiBfb2lkOwoKICAgICAgICAgICAgaWYgKF9t\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFU\nQVNUT1JFKQogICAgICAgICAgICAgICAgcmV0dXJuIF9icm9rZXIuZ2V0U3Rv\ncmVNYW5hZ2VyKCkuY29weURhdGFTdG9yZUlkKF9vaWQsIF9tZXRhKTsKICAg\nICAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgX21l\ndGEpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBnZXRQQ1ByaW1hcnlLZXkoT2JqZWN0\nIG9pZCwgaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgT2JqZWN0IHBrID0g\nQXBwbGljYXRpb25JZHMuZ2V0KG9pZCwgZm1kKTsKICAgICAgICBpZiAocGsg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENs\nYXNzTWV0YURhdGEgcmVsbWV0YSA9IGZtZC5nZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpOwogICAgICAgIGlmIChyZWxtZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFCiAgICAgICAgICAgICYm\nIGZtZC5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nTE9ORykKICAgICAgICAgICAgcGsgPSBfYnJva2VyLmdldFN0b3JlTWFuYWdl\ncigpLm5ld0RhdGFTdG9yZUlkKHBrLCByZWxtZXRhKTsKICAgICAgICBlbHNl\nIGlmIChyZWxtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURh\ndGEuSURfQVBQTElDQVRJT04gCiAgICAgICAgICAgICYmIGZtZC5nZXRPYmpl\nY3RJZEZpZWxkVHlwZSgpICE9IHJlbG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCkp\nCiAgICAgICAgICAgIHBrID0gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVz\nKG5ldyBPYmplY3RbXSB7IHBrIH0sIHJlbG1ldGEpOwogICAgICAgIHJldHVy\nbiBfYnJva2VyLmZpbmQocGssIGZhbHNlLCBudWxsKTsKICAgIH0KCiAgICBw\ndWJsaWMgYnl0ZSByZXBsYWNlRmxhZ3MoKSB7CiAgICAgICAgLy8gd2UgYWx3\nYXlzIHVzZSBsb2FkIHJlcXVpcmVkIHNvIHRoYXQgd2UgY2FuIGRldGVjdCB3\naGVuIG9iamVjdHMKICAgICAgICAvLyBhcmUgdG91Y2hlZCBmb3IgbG9ja2lu\nZyBvciBtYWtpbmcgdHJhbnNhY3Rpb25hbAogICAgICAgIHJldHVybiBQZXJz\naXN0ZW5jZUNhcGFibGUuTE9BRF9SRVFVSVJFRDsKICAgIH0KCiAgICBwdWJs\naWMgU3RhdGVNYW5hZ2VyIHJlcGxhY2VTdGF0ZU1hbmFnZXIoU3RhdGVNYW5h\nZ2VyIHNtKSB7CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGFjY2Vzc2luZ0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIC8v\nIHBvc3NpYmx5IGNoYW5nZSBzdGF0ZQogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGJlZm9yZVJlYWQoZmllbGQpOwogICAgICAgICAgICBiZWZvcmVBY2Nl\nc3NGaWVsZChmaWVsZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVu\nIGZpZWxkIGJlZm9yZSBhY2Nlc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIGJlZm9yZUFjY2Vzc0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIGFjdGl2\nZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsKICAgICAgICAgICAgaW50IGxvY2tM\nZXZlbCA9IGNhbGN1bGF0ZUxvY2tMZXZlbChhY3RpdmUsIGZhbHNlLCBudWxs\nKTsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAg\nICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgZmFsc2Us\nIHRydWUpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhc3Np\nZ25GaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgICAgICBvYnRhaW5Mb2Nr\ncyhhY3RpdmUsIGZhbHNlLCBsb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgZGlydHkoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\naWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUo\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkIiwgZmllbGQs\nCiAgICAgICAgICAgICAgICBJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0YW5j\nZShfcGMpLmdldENsYXNzKCkpKQogICAgICAgICAgICAgICAgLnNldEZhaWxl\nZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwoKICAgICAgICBkaXJ0\neShmbWQuZ2V0SW5kZXgoKSwgbnVsbCwgdHJ1ZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgZGlydHkoaW50IGZpZWxkKSB7CiAgICAgICAgZGlydHkoZmll\nbGQsIG51bGwsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSB0\naGUgZ2l2ZW4gZmllbGQgZGlydHkuCiAgICAgKgogICAgICogQHBhcmFtIG11\ndGF0ZSBpZiBudWxsLCBtYXkgYmUgYW4gU0NPIG11dGF0aW9uOyBpZiB0cnVl\nLCBpcyBjZXJ0YWlubHkKICAgICAqIGEgbXV0YXRpb24gKG9yIGF0IGxlYXN0\nIHRyZWF0IGFzIG9uZSkKICAgICAqIEByZXR1cm4ge0BsaW5rIEJvb2xlYW4j\nRkFMU0V9IGlmIHRoaXMgaW5zdGFuY2Ugd2FzIGFscmVhZHkgZGlydHksCiAg\nICAgKiA8Y29kZT5udWxsPC9jb2RlPiBpZiBpdCB3YXMgZGlydHkgYnV0IG5v\ndCBzaW5jZSBmbHVzaCwgYW5kCiAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVF\nfSBpZiBpdCB3YXMgbm90IGRpcnR5CiAgICAgKi8KICAgIHByaXZhdGUgQm9v\nbGVhbiBkaXJ0eShpbnQgZmllbGQsIEJvb2xlYW4gbXV0YXRlLCBib29sZWFu\nIGxvYWRGZXRjaEdyb3VwKSB7CiAgICAgICAgYm9vbGVhbiBsb2NrZWQgPSBm\nYWxzZTsKICAgICAgICBib29sZWFuIG5ld0ZsdXNoID0gZmFsc2U7CiAgICAg\nICAgYm9vbGVhbiBjbGVhbiA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgICAgICBpZiAoIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCkp\nIHsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3ko\nKSA9PSBVcGRhdGVTdHJhdGVnaWVzLlJFU1RSSUNUKQogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICAgICAgICAgKCJ1cGRhdGUtcmVzdHJpY3Qi\nLCBmbWQpKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0VXBkYXRlU3Ry\nYXRlZ3koKSA9PSBVcGRhdGVTdHJhdGVnaWVzLklHTk9SRSkKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgaWYgKGlzRW1iZWRkZWQoKSkgewogICAgICAgICAg\nICAgICAgLy8gbm90aWZ5IG93bmVyIG9mIGNoYW5nZQogICAgICAgICAgICAg\nICAgX293bmVyLmRpcnR5KF9vd25lck1ldGEuZ2V0RmllbGRNZXRhRGF0YSgp\nLmdldEluZGV4KCksCiAgICAgICAgICAgICAgICAgICAgQm9vbGVhbi5UUlVF\nLCBsb2FkRmV0Y2hHcm91cCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGlzIHRoaXMgYSBkaXJlY3QgbXV0YXRpb24gb2YgYW4gc2NvIGZpZWxk\nPwogICAgICAgICAgICBpZiAobXV0YXRlID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAg\nICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFuLlRSVUU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUg\nPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZtZC5pc0VtYmVkZGVk\nKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRlID0gQm9vbGVh\nbi5GQUxTRTsgLy8gbm90IHNjbwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBwb3NzaWJseSBjaGFuZ2Ugc3RhdGUK\nICAgICAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSBfYnJva2VyLmlzQWN0aXZl\nKCk7CiAgICAgICAgICAgIGNsZWFuID0gIV9zdGF0ZS5pc0RpcnR5KCk7IC8v\nIGludGVudGlvbmFsIGRpcmVjdCBhY2Nlc3MKCiAgICAgICAgICAgIC8vIGZp\ncmUgZXZlbnQgZmFzdCBiZWZvcmUgc3RhdGUgY2hhbmdlLgogICAgICAgICAg\nICBpZiAoY2xlYW4pCiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZl\nbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RJUlRZKTsKICAgICAgICAgICAg\naWYgKGFjdGl2ZSkgewogICAgICAgICAgICAgICAgaWYgKF9icm9rZXIuZ2V0\nT3B0aW1pc3RpYygpKQogICAgICAgICAgICAgICAgICAgIHNldFBDU3RhdGUo\nX3N0YXRlLmJlZm9yZU9wdGltaXN0aWNXcml0ZSh0aGlzLCBmaWVsZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgpKSk7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUuYmVmb3JlV3JpdGUodGhpcywgZmllbGQsCiAgICAg\nICAgICAgICAgICAgICAgICAgIG11dGF0ZS5ib29sZWFuVmFsdWUoKSkpOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0g\nRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkgewogICAgICAgICAg\nICAgICAgaWYgKGlzUGVyc2lzdGVudCgpICYmICFfYnJva2VyLmdldE5vbnRy\nYW5zYWN0aW9uYWxXcml0ZSgpKQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAg\nICAgICAgICAgICAgICAgKCJub24tdHJhbnMtd3JpdGUiKSkuc2V0RmFpbGVk\nT2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIChnZXRNYW5hZ2VkSW5z\ndGFuY2UoKSk7CgogICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUu\nYmVmb3JlTm9udHJhbnNhY3Rpb25hbFdyaXRlKHRoaXMsIGZpZWxkLAogICAg\nICAgICAgICAgICAgICAgIG11dGF0ZS5ib29sZWFuVmFsdWUoKSkpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfRkxV\nU0hFRCkgIT0gMCkgewogICAgICAgICAgICAgICAgbmV3Rmx1c2ggPSAoX2Zs\nYWdzICYgRkxBR19GTFVTSEVEX0RJUlRZKSA9PSAwOwogICAgICAgICAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hFRF9ESVJUWTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgbG9jaygpOwogICAgICAgICAgICBsb2NrZWQgPSB0\ncnVlOwoKICAgICAgICAgICAgLy8gbm90ZSB0aGF0IHRoZSBmaWVsZCBpcyBp\nbiBuZWVkIG9mIGZsdXNoaW5nIGFnYWluLCBhbmQgdGVsbCB0aGUKICAgICAg\nICAgICAgLy8gYnJva2VyIHRvbwogICAgICAgICAgICBfZmx1c2guY2xlYXIo\nZmllbGQpOwogICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRoaXMsIG5l\nd0ZsdXNoICYmICFjbGVhbik7CgogICAgICAgICAgICAvLyBzYXZlIHRoZSBm\naWVsZCBmb3Igcm9sbGJhY2sgaWYgbmVlZGVkCiAgICAgICAgICAgIHNhdmVG\naWVsZChmaWVsZCk7CgogICAgICAgICAgICAvLyBkaXJ0eSB0aGUgZmllbGQg\nYW5kIG1hcmsgbG9hZGVkOyBsb2FkIGZldGNoIGdyb3VwIGlmIG5lZWRlZAog\nICAgICAgICAgICBpbnQgbG9ja0xldmVsID0gY2FsY3VsYXRlTG9ja0xldmVs\nKGFjdGl2ZSwgdHJ1ZSwgbnVsbCk7CiAgICAgICAgICAgIGlmICghX2RpcnR5\nLmdldChmaWVsZCkpIHsKICAgICAgICAgICAgICAgIHNldExvYWRlZChmaWVs\nZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBfZGlydHkuc2V0KGZpZWxkKTsK\nCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGZpZWxkJ3MgZmV0\nY2ggZ3JvdXAgaXMgbG9hZGVkCiAgICAgICAgICAgICAgICBpZiAobG9hZEZl\ndGNoR3JvdXAgJiYgaXNQZXJzaXN0ZW50KCkKICAgICAgICAgICAgICAgICAg\nICAmJiBmbWQuZ2V0TWFuYWdlbWVudCgpID09IGZtZC5NQU5BR0VfUEVSU0lT\nVEVOVCkKICAgICAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIGxv\nY2tMZXZlbCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgb2J0YWluTG9ja3MoYWN0aXZlLCB0cnVlLCBsb2NrTGV2ZWwsIG51bGws\nIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAobG9ja2VkKQogICAgICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY2xlYW4p\nCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgaWYg\nKG5ld0ZsdXNoKSB7CiAgICAgICAgICAgIC8vIHRoaXMgZXZlbnQgY2FuIGJl\nIGZpcmVkIGxhdGVyIGNhdXNlIHdlJ3JlIGFscmVhZHkgZGlydHkuCiAgICAg\nICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZP\nUkVfRElSVFlfRkxVU0hFRCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEZpcmUgcG9zdC1kaXJ0eSBldmVudHMgYWZ0ZXIg\nZmllbGQgdmFsdWUgY2hhbmdlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3Rh\ndHVzIHJldHVybiB2YWx1ZSBmcm9tIHtAbGluayAjZGlydHkoaW50LCBCb29s\nZWFuLCBib29sZWFuKX0KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBvc3RE\naXJ0eShCb29sZWFuIHN0YXR1cykgewogICAgICAgIGlmIChCb29sZWFuLlRS\nVUUuZXF1YWxzKHN0YXR1cykpCiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVF\ndmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJUWSk7CiAgICAgICAgZWxz\nZSBpZiAoc3RhdHVzID09IG51bGwpCiAgICAgICAgICAgIGZpcmVMaWZlY3lj\nbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9ESVJUWV9GTFVTSEVEKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVkKGludCBmaWVsZCwgT2Jq\nZWN0IHJlbW92ZWQsIGJvb2xlYW4ga2V5KSB7CiAgICAgICAgaWYgKHJlbW92\nZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBkZXJlZmVyZW5jZSBkZXBlbmRlbnQgZmllbGRz\nLCBkZWxldGUgZW1iZWRkZWQKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIFZhbHVl\nTWV0YURhdGEgdm1kID0gKGtleSkgPyBmbWQuZ2V0S2V5KCkgOiBmbWQuZ2V0\nRWxlbWVudCgpOwogICAgICAgICAgICBpZiAodm1kLmlzRW1iZWRkZWRQQygp\nKQogICAgICAgICAgICAgICAgX3NpbmdsZS5kZWxldGUodm1kLCByZW1vdmVk\nLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBpZiAodm1kLmdldENhc2NhZGVE\nZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTykKICAgICAg\nICAgICAgICAgIF9zaW5nbGUuZGVyZWZlcmVuY2VEZXBlbmRlbnQocmVtb3Zl\nZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgT2JqZWN0IG5ld1Byb3h5KGludCBmaWVsZCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBuZXdGaWVsZFByb3h5KGZpZWxkKTsKCiAgICAgICAg\nc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSA9PSBqYXZhLnNxbC5EYXRlLmNsYXNzKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgamF2YS5zcWwuRGF0ZShTeXN0ZW0u\nY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1k\nLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3FsLlRpbWVzdGFtcC5jbGFz\ncykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGphdmEuc3FsLlRp\nbWVzdGFtcChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3Fs\nLlRpbWUuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBq\nYXZhLnNxbC5UaW1lKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSgpOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIHJldHVy\nbiBDYWxlbmRhci5nZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQ\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoTWFwKCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgbmV3RmllbGRQcm94eShpbnQgZmllbGQpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICBQcm94eU1hbmFnZXIgbWdyID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9u\nKCkuCiAgICAgICAgICAgIGdldFByb3h5TWFuYWdlckluc3RhbmNlKCk7CiAg\nICAgICAgT2JqZWN0IGluaXQgPSBmbWQuZ2V0SW5pdGlhbGl6ZXIoKTsKCiAg\nICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAg\nICByZXR1cm4gbWdyLm5ld0RhdGVQcm94eShmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAg\nICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3Q2FsZW5kYXJQcm94eShmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgaW5pdCBp\nbnN0YW5jZW9mIFRpbWVab25lID8gKFRpbWVab25lKSBpbml0IDogbnVsbCk7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAg\nICAgICAgICAgICByZXR1cm4gbWdyLm5ld0NvbGxlY3Rpb25Qcm94eShmbWQu\nZ2V0UHJveHlUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgZm1kLmdldEVs\nZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRvciA/IChDb21wYXJhdG9yKSBp\nbml0IDogbnVsbCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3TWFwUHJveHkoZm1kLmdl\ndFByb3h5VHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXko\nKS5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgICAgIGluaXQgaW5zdGFuY2VvZiBDb21wYXJhdG9yID8gKENvbXBhcmF0\nb3IpIGluaXQgOiBudWxsKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNEZWZhdWx0VmFsdWUo\naW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgcHJvdmlk\nZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBib29s\nZWFuIHJldCA9IF9zaW5nbGUuaXNEZWZhdWx0VmFsdWUoKTsKICAgICAgICAg\nICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICByZXR1cm4gcmV0Owog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlY29yZCB0\naGF0IHRoZSBmaWVsZCBpcyBkaXJ0eSAod2hpY2ggbWlnaHQgbG9hZCBERkcp\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nQm9v\nbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIGJvb2xlYW4gY3VyVmFsLCBib29sZWFuIG5ld1ZhbCwgaW50IHNl\ndCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAg\nICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChmaWVs\nZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFzc2Vy\ndE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBz\ndGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRf\nVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVCb29sZWFuRmllbGQo\nZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdCeXRlRmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAg\nYnl0ZSBjdXJWYWwsIGJ5dGUgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAg\naWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdW\nYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5\nQ2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShm\naWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAg\nICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgbmV3VmFsKTsK\nICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7\nCiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2V0dGluZ0NoYXJGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFyIGN1clZhbCwgY2hh\nciBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9S\nRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYg\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwog\nICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZB\nTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlQ2hhckZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBs\nYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9z\ndERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXR0aW5nRG91YmxlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgZG91YmxlIGN1clZhbCwgZG91YmxlIG5ld1ZhbCwg\naW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewog\nICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdl\ndChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9v\nbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9\nPSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVEb3VibGVG\naWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxk\nKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShz\ndGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0Zs\nb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAg\nICAgICAgZmxvYXQgY3VyVmFsLCBmbG9hdCBuZXdWYWwsIGludCBzZXQpIHsK\nICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAg\naWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1By\naW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9\nIGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIp\nOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwg\nbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xl\nLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0ludEZpZWxkKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGludCBjdXJW\nYWwsIGludCBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9\nIFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJW\nYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmll\nbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29s\nZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2lu\nZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAg\nIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldHRpbmdMb25nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgbG9uZyBjdXJWYWwsIGxvbmcgbmV3VmFsLCBp\nbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAg\nICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0\nKGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29s\nZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09\nIFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUxvbmdGaWVs\nZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ09iamVj\ndEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAg\nICAgIE9iamVjdCBjdXJWYWwsIE9iamVjdCBuZXdWYWwsIGludCBzZXQpIHsK\nICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkpIHsKICAgICAgICAg\nICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyBvbmx5IGNvbXBhcmUg\nbmV3IHRvIG9sZCB2YWx1ZXMgaWYgdGhlIGNvbXBhcmlzb24gaXMgZ29pbmcg\ndG8KICAgICAgICAgICAgICAgIC8vIGJlIGNoZWFwIC0tIGRvbid0IGNvbXBh\ncmUgY29sbGVjdGlvbnMsIG1hcHMsIFVEVHMKICAgICAgICAgICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgIT0gbnVsbCAmJiBuZXdW\nYWwuZXF1YWxzKGN1clZhbCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgZGVwZW5kZW50\nIHVubG9hZGVkIGZpZWxkLCBtYWtlIHN1cmUgdG8gbG9hZAogICAgICAgICAg\nICAgICAgLy8gaXQgbm93CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldENh\nc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTwog\nICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRLZXkoKS5nZXRDYXNjYWRl\nRGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRF\nbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAgICAgICAg\nICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pCiAgICAgICAgICAg\nICAgICAgICAgY3VyVmFsID0gZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNo\nYW5nZShmaWVsZCk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAgICAgICAgICAgICBh\nc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQobmV3VmFsKTsKICAgICAgICB9Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29s\nZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09\nIFNFVF9VU0VSKTsKICAgICAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RF\nKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQo\nZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnVucHJv\neHkoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVyZWZlcmVuY2VEZXBl\nbmRlbnQoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0Rmll\nbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChw\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3Rh\ndCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdTaG9y\ndEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAg\nICAgIHNob3J0IGN1clZhbCwgc2hvcnQgbmV3VmFsLCBpbnQgc2V0KSB7CiAg\nICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlm\nIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9Qcmlt\nYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBk\naXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsK\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNob3J0RmllbGQoZmllbGQsIG5l\nd1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdTdHJpbmdGaWVsZChQZXJz\naXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBTdHJpbmcg\nY3VyVmFsLCBTdHJpbmcgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYg\nKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChTdHJpbmdV\ndGlscy5lcXVhbHMobmV3VmFsLCBjdXJWYWwpICYmIF9sb2FkZWQuZ2V0KGZp\nZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNz\nZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFu\nIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNF\nVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVN0cmluZ0ZpZWxk\nKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMs\nIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERpc2FsbG93cyBjaGFu\nZ2luZyBwcmltYXJ5IGtleSBmaWVsZHMgZm9yIGluc3RhbmNlcy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShp\nbnQgZmllbGQpIHsKICAgICAgICBpZiAoX29pZCAhPSBudWxsICYmIF9tZXRh\nLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAg\ndGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xv\nYy5nZXQKICAgICAgICAgICAgICAgICgiY2hhbmdlLWlkZW50aXR5IikpLnNl\ndEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogRGlzYWxsb3dzIHNldHRpbmcgYW4gb2JqZWN0IGlk\nIGZpZWxkIHRvIGEgbWFuYWdlZCBpbnN0YW5jZS4KICAgICAqLwogICAgdm9p\nZCBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQoT2JqZWN0IHZhbCkgewogICAg\nICAgIGlmICh2YWwgIT0gbnVsbAogICAgICAgICAgICAmJiAoSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh2YWwsCiAgICAgICAgICAgICAgICAg\nZ2V0Q29udGV4dCgpLmdldENvbmZpZ3VyYXRpb24oKSkpLnBjR2V0R2VuZXJp\nY0NvbnRleHQoKSE9IG51bGwpCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAoIm1hbmFnZWQtb2lkIiwgRXhjZXB0aW9ucy50b1N0cmluZyh2\nYWwpLAogICAgICAgICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmco\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBEZWxlZ2F0\nZSB0byBGaWVsZE1hbmFnZXIKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEJvb2xlYW5GaWVsZChQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBib29s\nZWFuIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUJvb2xlYW5GaWVsZChm\naWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRl\nZEJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBieXRlIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUJ5dGVG\naWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncm92aWRlZENoYXJGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBjaGFyIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9y\nZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBwcm92aWRlZERvdWJsZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJsZSBjdXJWYWwpIHsKICAgICAg\nICBfZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEZsb2F0RmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZmxvYXQgY3VyVmFs\nKSB7CiAgICAgICAgX2ZtLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3VyVmFs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEludEZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGludCBj\ndXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVJbnRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZExvbmdGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBs\nb25nIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZUxvbmdGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZE9i\namVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIE9iamVjdCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVPYmpl\nY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBwcm92aWRlZFNob3J0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3VyVmFsKSB7CiAgICAgICAgX2Zt\nLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBwcm92aWRlZFN0cmluZ0ZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIFN0cmluZyBjdXJWYWwpIHsK\nICAgICAgICBfZm0uc3RvcmVTdHJpbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXBsYWNlQm9vbGVhbkZpZWxk\nKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAg\ncmV0dXJuIF9mbS5mZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CiAgICB9Cgog\nICAgcHVibGljIGJ5dGUgcmVwbGFjZUJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0\nY2hCeXRlRmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBjaGFyIHJl\ncGxhY2VDaGFyRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmll\nbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoQ2hhckZpZWxkKGZpZWxk\nKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIHJlcGxhY2VEb3VibGVGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAg\nIHJldHVybiBfZm0uZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAgICB9Cgog\nICAgcHVibGljIGZsb2F0IHJlcGxhY2VGbG9hdEZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5m\nZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\ncmVwbGFjZUludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEludEZpZWxkKGZpZWxk\nKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyByZXBsYWNlTG9uZ0ZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0\ndXJuIF9mbS5mZXRjaExvbmdGaWVsZChmaWVsZCk7CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCByZXBsYWNlT2JqZWN0RmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNo\nT2JqZWN0RmllbGQoZmllbGQpOwogICAgfQoKICAgIHB1YmxpYyBzaG9ydCBy\nZXBsYWNlU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hTaG9ydEZpZWxkKGZp\nZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHJlcGxhY2VTdHJpbmdG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAg\nICAgIHJldHVybiBfZm0uZmV0Y2hTdHJpbmdGaWVsZChmaWVsZCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAg\nLy8gSW1wbGVtZW50YXRpb24gb2YgRmllbGRNYW5hZ2VyCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGJvb2xl\nYW4gZmV0Y2hCb29sZWFuKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlm\nICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBm\nZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwg\nPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgo\nQm9vbGVhbikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSku\nYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZmV0\nY2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2\nZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHBy\nb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncmV0dXJuIF9zaW5nbGUuZmV0Y2hCb29sZWFuRmllbGQoZmllbGQpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBmZXRjaEJ5dGUoaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZldGNoQnl0ZUZpZWxkKGZpZWxkKTsKCiAg\nICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsK\nICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVl\nKHZhbCwgX2Jyb2tlcikpLmJ5dGVWYWx1ZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQu\nZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwg\nTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAg\nICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoQnl0ZUZpZWxkKGZpZWxkKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGNoYXIgZmV0Y2hDaGFyKGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaENoYXJGaWVsZChmaWVsZCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CiAgICAgICAgcmV0dXJuICgoQ2hhcmFjdGVyKSBmbWQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5jaGFyVmFsdWUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgY2hhciBmZXRjaENoYXJGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaENoYXJGaWVsZChm\naWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBkb3VibGUgZmV0Y2hE\nb3VibGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNF\neHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoRG91Ymxl\nRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVs\nZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1k\nLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKSkuZG91YmxlVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIGZldGNoRG91YmxlRmllbGQo\naW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAg\nICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwg\nZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMs\nIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUu\nZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBmbG9hdCBmZXRjaEZsb2F0KGludCBmaWVsZCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJl\ndHVybiBmZXRjaEZsb2F0RmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3Qg\ndmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2Vy\nKSkuZmxvYXRWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBmbG9hdCBmZXRj\naEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQp\nKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxz\nLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3Zp\nZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0\ndXJuIF9zaW5nbGUuZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIGludCBmZXRjaEludChpbnQgZmllbGQpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICByZXR1cm4gZmV0Y2hJbnRGaWVsZChmaWVsZCk7CgogICAgICAgIE9i\namVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZmV0\nY2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkp\nCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMu\nTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlk\nZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1\ncm4gX3NpbmdsZS5mZXRjaEludEZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25nKGludCBmaWVsZCkgewogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAg\nICAgIHJldHVybiBmZXRjaExvbmdGaWVsZChmaWVsZCk7CgogICAgICAgIE9i\namVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBm\nZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVs\nZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZl\nbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJv\ndmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBy\nZXR1cm4gX3NpbmdsZS5mZXRjaExvbmdGaWVsZChmaWVsZCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3QoaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQoZmllbGQpOwoK\nICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2Up\nOwogICAgICAgIHJldHVybiBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3RG\naWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAg\nICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19O\nT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxk\nKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3Np\nbmdsZS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHNob3J0IGZldGNoU2hvcnQoaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZldGNoU2hvcnRGaWVsZChmaWVsZCk7CgogICAgICAgIE9i\namVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpKS5zaG9ydFZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIHNob3J0\nIGZldGNoU2hvcnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tM\nZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAg\ncHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICByZXR1cm4gX3NpbmdsZS5mZXRjaFNob3J0RmllbGQoZmllbGQpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGZldGNoU3RyaW5nKGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVk\nKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaFN0cmluZ0ZpZWxkKGZpZWxk\nKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZh\nbHNlKTsKICAgICAgICByZXR1cm4gKFN0cmluZykgZm1kLmdldEV4dGVybmFs\nVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQo\nZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAg\nICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTdHJpbmdGaWVsZChmaWVsZCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQm9vbGVhbihpbnQg\nZmllbGQsIGJvb2xlYW4gZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUJv\nb2xlYW5GaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICBPYmplY3QgdmFsID0gKGV4dGVybmFsVmFsKSA/IEJv\nb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIHN0b3Jl\nRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKHZhbCwgX2Jyb2tlcikp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJvb2xl\nYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3VyVmFsKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3Rv\ncmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\nc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQo\nZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZUJ5dGUoaW50IGZpZWxkLCBieXRlIGV4dGVybmFsVmFsKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgc3RvcmVCeXRlRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRG\naWVsZFZhbHVlKG5ldyBCeXRlKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAg\nICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUJ5\ndGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFsKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVC\neXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9h\nZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQs\nIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUNo\nYXIoaW50IGZpZWxkLCBjaGFyIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3Rv\ncmVDaGFyRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZh\nbHVlKG5ldyBDaGFyYWN0ZXIoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAg\nICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hh\nckZpZWxkKGludCBmaWVsZCwgY2hhciBjdXJWYWwpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUNo\nYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2Fk\nZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwg\nbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlRG91\nYmxlKGludCBmaWVsZCwgZG91YmxlIGV4dGVybmFsVmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\nc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZp\nZWxkVmFsdWUobmV3IERvdWJsZShleHRlcm5hbFZhbCksCiAgICAgICAgICAg\nICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVE\nb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJsZSBjdXJWYWwpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVGbG9hdChpbnQgZmllbGQsIGZsb2F0IGV4dGVybmFsVmFsKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVs\nZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAg\nICAgICAgc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQu\nZ2V0RmllbGRWYWx1ZShuZXcgRmxvYXQoZXh0ZXJuYWxWYWwpLAogICAgICAg\nICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0IGN1clZhbCkgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9h\nZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0b3JlSW50KGludCBmaWVsZCwgaW50IGV4dGVybmFsVmFsKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgc3RvcmVJbnRGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZp\nZWxkVmFsdWUoTnVtYmVycy52YWx1ZU9mKGV4dGVybmFsVmFsKSwKICAgICAg\nICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZUludEZpZWxkKGludCBmaWVsZCwgaW50IGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlSW50RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxh\nY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0\nTG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmll\nbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9y\nZUxvbmcoaW50IGZpZWxkLCBsb25nIGV4dGVybmFsVmFsKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAg\nc3RvcmVMb25nRmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVs\nZFZhbHVlKE51bWJlcnMudmFsdWVPZihleHRlcm5hbFZhbCksCiAgICAgICAg\nICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVMb25nRmllbGQoaW50IGZpZWxkLCBsb25nIGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBs\nYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNl\ndExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZp\nZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVPYmplY3QoaW50IGZpZWxkLCBPYmplY3QgZXh0ZXJuYWxWYWwpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBleHRlcm5hbFZhbCA9IGZtZC5vcmRlcihleHRlcm5hbFZh\nbCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAg\nICAgICAgc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1k\nLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxWYWwsIF9icm9rZXIpKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdEZpZWxkKGludCBmaWVsZCwg\nT2JqZWN0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIF9zaW5nbGUucHJveHkodHJ1ZSwgZmFs\nc2UpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAg\nICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc3RvcmVTaG9ydChpbnQgZmllbGQsIHNob3J0\nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVTaG9ydEZpZWxkKGZpZWxk\nLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9y\nZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgU2hvcnQoZXh0\nZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlU2hvcnRGaWVsZChpbnQgZmllbGQsIHNo\nb3J0IGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3Vy\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwg\nZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwog\nICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nKGludCBmaWVsZCwgU3Ry\naW5nIGV4dGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNF\neHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVTdHJpbmdGaWVsZChm\naWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxW\nYWwsIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZVN0\ncmluZ0ZpZWxkKGludCBmaWVsZCwgU3RyaW5nIGN1clZhbCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlU3RyaW5nRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\nc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQo\nZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0\nb3JlIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZSBpbnRvIHRoZSBnaXZlbiBmaWVs\nZCBtYW5hZ2VyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc3RvcmVGaWVs\nZChpbnQgZmllbGQsIE9iamVjdCB2YWwsIEZpZWxkTWFuYWdlciBmbSkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmIChmbWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkLWluZGV4\nIiwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKGZpZWxkKSwgX21l\ndGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkuCiAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIGJv\nb2xlYW4gYm9vbCA9IHZhbCAhPSBudWxsICYmICgoQm9vbGVhbikgdmFsKS5i\nb29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlQm9vbGVh\nbkZpZWxkKGZpZWxkLCBib29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAg\nICAgYnl0ZSBiID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFs\nKS5ieXRlVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlQnl0ZUZp\nZWxkKGZpZWxkLCBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgY2hh\nciBjID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKENoYXJhY3RlcikgdmFsKS5j\naGFyVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlQ2hhckZpZWxk\nKGZpZWxkLCBjKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBkb3Vi\nbGUgZCA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuZG91\nYmxlVmFsdWUoKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlRG91YmxlRmll\nbGQoZmllbGQsIGQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgZmxv\nYXQgZiA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuZmxv\nYXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgZm0uc3RvcmVGbG9hdEZpZWxk\nKGZpZWxkLCBmKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBpbnQgaSA9\nICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuaW50VmFsdWUo\nKTsKICAgICAgICAgICAgICAgIGZtLnN0b3JlSW50RmllbGQoZmllbGQsIGkp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICBsb25nIGwgPSAodmFsID09\nIG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgZm0uc3RvcmVMb25nRmllbGQoZmllbGQsIGwpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICAgICAgc2hvcnQgcyA9ICh2YWwgPT0gbnVs\nbCkgPyAwIDogKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgZm0uc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBzKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nVFJJTkc6CiAgICAgICAgICAgICAgICBmbS5zdG9yZVN0cmluZ0ZpZWxkKGZp\nZWxkLCAoU3RyaW5nKSB2YWwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBmbS5zdG9yZU9i\namVjdEZpZWxkKGZpZWxkLCB2YWwpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nLy8vLy8vLy8vLy8vCiAgICAvLyBVdGlsaXRpZXMKICAgIC8vLy8vLy8vLy8v\nLy8KCiAgICAvKioKICAgICAqIEVyYXNlIHRoZSBmYWN0IHRoYXQgdGhpcyBp\nbnN0YW5jZSBoYXMgYmVlbiBmbHVzaGVkLgogICAgICovCiAgICB2b2lkIGVy\nYXNlRmx1c2goKSB7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRUQ7\nCiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CgogICAg\nICAgIGludCBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kczsgaSsrKQogICAgICAgICAg\nICBfZmx1c2guY2xlYXIoaSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNv\ncmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxkcyBhcmUvYXJlIG5vdCBsb2Fk\nZWQuCiAgICAgKiBQcmltYXJ5IGtleSBhbmQgbm9uLXBlcnNpc3RlbnQgZmll\nbGRzIGFyZSBub3QgYWZmZWN0ZWQuCiAgICAgKi8KICAgIHZvaWQgc2V0TG9h\nZGVkKGJvb2xlYW4gdmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZt\nZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmlzUHJpbWFyeUtleSgpCiAgICAgICAgICAgICAgICAmJiBmbWRz\nW2ldLmdldE1hbmFnZW1lbnQoKSA9PSBmbWRzW2ldLk1BTkFHRV9QRVJTSVNU\nRU5UKQogICAgICAgICAgICAgICAgc2V0TG9hZGVkKGksIHZhbCk7CiAgICAg\nICAgfQogICAgICAgIGlmICghdmFsKSB7CiAgICAgICAgICAgIF9mbGFncyAm\nPSB+RkxBR19MT0FERUQ7CiAgICAgICAgICAgIHNldERpcnR5KGZhbHNlKTsK\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9B\nREVEOwogICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkcyB0aGF0IGFsbCBp\nbnN0YW5jZSBmaWVsZHMgYXJlL2FyZSBub3QgZGlydHksCiAgICAgKiBhbmQg\nY2hhbmdlcyB0aGUgZmxhZ3Mgb2YgdGhlIGluc3RhbmNlIGFjY29yZGluZ2x5\nLgogICAgICovCiAgICB2b2lkIHNldERpcnR5KGJvb2xlYW4gdmFsKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICBib29sZWFuIHVwZGF0ZSA9ICFpc05ldygpIHx8IGlzRmx1\nc2hlZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodmFsICYmICghdXBkYXRlCiAg\nICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldFVwZGF0ZVN0cmF0ZWd5KCkg\nIT0gVXBkYXRlU3RyYXRlZ2llcy5JR05PUkUpKQogICAgICAgICAgICAgICAg\nX2RpcnR5LnNldChpKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXZhbCkgewog\nICAgICAgICAgICAgICAgLy8gd2UgbmV2ZXIgY29uc2lkZXIgY2xlYW4gZmll\nbGRzIGZsdXNoZWQ7IHRoaXMgYWxzbyB0YWtlcwogICAgICAgICAgICAgICAg\nLy8gY2FyZSBvZiBjbGVhcmluZyB0aGUgZmx1c2hlZCBmaWVsZHMgb24gY29t\nbWl0L3JvbGxiYWNrCiAgICAgICAgICAgICAgICBfZmx1c2guY2xlYXIoaSk7\nCiAgICAgICAgICAgICAgICBfZGlydHkuY2xlYXIoaSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0xPQURFRDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4\nZWN1dGVzIHByZS1jbGVhciBjYWxsYmFja3MsIGNsZWFycyBhbGwgbWFuYWdl\nZCBmaWVsZHMsIGFuZCBjYWxscyB0aGUKICAgICAqIHtAbGluayAjc2V0TG9h\nZGVkfSBtZXRob2Qgd2l0aCBhIHZhbHVlIG9mIGZhbHNlLiBQcmltYXJ5IGtl\neSBmaWVsZHMKICAgICAqIGFyZSBub3QgY2xlYXJlZC4KICAgICAqLwogICAg\ndm9pZCBjbGVhckZpZWxkcygpIHsKICAgICAgICBpZiAoIWlzSW50ZXJjZXB0\naW5nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgZmlyZUxpZmVj\neWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9DTEVBUik7CgogICAg\nICAgIC8vIHVucHJveHkgYWxsIGZpZWxkcwogICAgICAgIHVucHJveHlGaWVs\nZHMoKTsKCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIGNsZWFyIG5vbi1wayBmaWVsZHMKICAgICAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkgJiYg\nZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkKICAgICAgICAgICAgICAgICAgICA9\nPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAg\nICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIENsZWFyRmllbGRNYW5hZ2Vy\nLmdldEluc3RhbmNlKCksIGkpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBmb3JnZXQgdmVyc2lvbiBpbmZvIGFuZCBpbXBsIGRhdGEgc28gd2Ug\ncmUtcmVhZCBuZXh0IHRpbWUKICAgICAgICAgICAgc2V0TG9hZGVkKGZhbHNl\nKTsKICAgICAgICAgICAgX3ZlcnNpb24gPSBudWxsOwogICAgICAgICAgICBf\nbG9hZFZlcnNpb24gPSBudWxsOwogICAgICAgICAgICBpZiAoX2ZpZWxkSW1w\nbCAhPSBudWxsKQogICAgICAgICAgICAgICAgQXJyYXlzLmZpbGwoX2ZpZWxk\nSW1wbCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQoKICAgICAgICBmaXJlTGlmZWN5Y2xlRXZl\nbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfQ0xFQVIpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVjb3JkIHRoYXQgd2Ugc2hvdWxkIHNhdmUgYW55IGZpZWxk\ncyB0aGF0IGNoYW5nZSBmcm9tIHRoaXMgcG9pbnQKICAgICAqIGZvcndhcmQu\nCiAgICAgKi8KICAgIHZvaWQgc2F2ZUZpZWxkcyhib29sZWFuIGltbWVkaWF0\nZSkgewogICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpID09\nIFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUKICAgICAgICAgICAgJiYgKF9m\nbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDApCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfU0FWRTsKICAgICAgICBpZiAo\naW1tZWRpYXRlKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4g\nPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAg\nICAgICBzYXZlRmllbGQoaSk7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxB\nR19TQVZFOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElmIHRo\nZSBmaWVsZCBpc24ndCBhbHJlYWR5IHNhdmVkLCBzYXZlcyB0aGUgY3VycmVu\ndGx5IGxvYWRlZCBmaWVsZAogICAgICogc3RhdGUgb2YgdGhlIGluc3RhbmNl\nLiBUaGUgc2F2ZWQgdmFsdWVzIGNhbiBhbGwgYmUgcmVzdG9yZWQgdmlhCiAg\nICAgKiB7QGxpbmsgI3Jlc3RvcmVGaWVsZHN9LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgc2F2ZUZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGlmICgo\nX2ZsYWdzICYgRkxBR19TQVZFKSA9PSAwKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBtYW5hZ2VkIGludmVyc2UgZmll\nbGQsIGxvYWQgaXQgc28gd2UncmUgc3VyZSB0byBoYXZlCiAgICAgICAgLy8g\ndGhlIG9yaWdpbmFsIHZhbHVlCiAgICAgICAgaWYgKCFfbG9hZGVkLmdldChm\naWVsZCkgJiYgKChfZmxhZ3MgJiBGTEFHX0lOVkVSU0VTKSAhPSAwCiAgICAg\nICAgICAgICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5nZXRJbnZlcnNlTWV0\nYURhdGFzKCkubGVuZ3RoID4gMCkpCiAgICAgICAgICAgIGxvYWRGaWVsZChm\naWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7Cgog\nICAgICAgIC8vIGRvbid0IGJvdGhlciBjcmVhdGluZyB0aGUgc2F2ZSBmaWVs\nZCBtYW5hZ2VyIGlmIHdlJ3JlIG5vdCBnb2luZyB0bwogICAgICAgIC8vIHNh\ndmUgdGhlIG9sZCBmaWVsZCB2YWx1ZSBhbnl3YXkKICAgICAgICBpZiAoX3Nh\ndmVkID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGZp\nZWxkKSkKICAgICAgICAgICAgICAgIF9zYXZlZCA9IG5ldyBTYXZlRmllbGRN\nYW5hZ2VyKHRoaXMsIG51bGwsIF9kaXJ0eSk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8v\nIGNvcHkgdGhlIGZpZWxkIHRvIHNhdmUgZmllbGQgbWFuYWdlcjsgaWYgdGhl\nIGZpZWxkIGlzIG5vdCBkaXJlY3RseQogICAgICAgIC8vIGNvcHlhYmxlLCBp\nbW1lZGlhdGVseSBwcm92aWRlIGFuZCByZXBsYWNlIGl0IHZpYSB0aGUgc2F2\nZSBmaWVsZAogICAgICAgIC8vIG1hbmFnZXIsIHdoaWNoIHdpbGwgY29weSB0\naGUgbXV0YWJsZSB2YWx1ZSB0byBwcmV2ZW50IGJ5LXJlZiBtb2RzCiAgICAg\nICAgaWYgKF9zYXZlZC5zYXZlRmllbGQoZmllbGQpKSB7CiAgICAgICAgICAg\nIHByb3ZpZGVGaWVsZChfcGMsIF9zYXZlZCwgZmllbGQpOwogICAgICAgICAg\nICByZXBsYWNlRmllbGQoX3NhdmVkLmdldFN0YXRlKCksIF9zYXZlZCwgZmll\nbGQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE5vdGlmaWNh\ndGlvbiB0aGF0IHRoZSBzdGF0ZSB3aWxsIG5vdCBuZWVkIHRvIGJlIHJvbGxl\nZCBiYWNrCiAgICAgKiB0byB0aGF0IG9mIHRoZSBsYXN0IGNhbGwgdG8ge0Bs\naW5rICNzYXZlRmllbGRzfS4KICAgICAqLwogICAgdm9pZCBjbGVhclNhdmVk\nRmllbGRzKCkgewogICAgICAgIGlmIChpc0ludGVyY2VwdGluZygpKSB7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19TQVZFOwogICAgICAgICAgICBf\nc2F2ZWQgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU2F2\nZUZpZWxkTWFuYWdlciBnZXRTYXZlRmllbGRNYW5hZ2VyKCkgewogICAgICAg\nIHJldHVybiBfc2F2ZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSb2xsYmFj\nayB0aGUgc3RhdGUgb2YgdGhlIGluc3RhbmNlIHRvIHRoZSBzYXZlZCBzdGF0\nZSBmcm9tIHRoZQogICAgICogbGFzdCBjYWxsIHRvIHtAbGluayAjc2F2ZUZp\nZWxkc30sIG9yIHRvIGRlZmF1bHQgdmFsdWVzIGlmIG5ldmVyIHNhdmVkLgog\nICAgICovCiAgICB2b2lkIHJlc3RvcmVGaWVsZHMoKSB7CiAgICAgICAgbG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc2F2ZWQgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1NB\nVkUpID09IDApCiAgICAgICAgICAgICAgICAgICAgY2xlYXJGaWVsZHMoKTsK\nICAgICAgICAgICAgICAgIGVsc2UgLy8gb25seSB1bmxvYWRlZCBmaWVsZHMg\nd2VyZSBkaXJ0aWVkCiAgICAgICAgICAgICAgICAgICAgX2xvYWRlZC5hbmRO\nb3QoX2xvYWRlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gd2Ug\nZGlyZWN0IHN0YXRlIHRyYW5zaXRpb25zIGJhc2VkIG9uIG91ciBvd24gZ2V0\nUmVzdG9yZVN0YXRlCiAgICAgICAgICAgIC8vIG1ldGhvZCwgYnV0IHRvIGRl\nY2lkZSB3aGV0aGVyIHRvIGFjdHVhbGx5IHJvbGxiYWNrIGZpZWxkCiAgICAg\nICAgICAgIC8vIHZhbHVlcywgd2UgY29uc3VsdCB0aGUgYnJva2VyIGZvciB0\naGUgdXNlcidzIHNldHRpbmcKICAgICAgICAgICAgZWxzZSBpZiAoX2Jyb2tl\nci5nZXRSZXN0b3JlU3RhdGUoKSAhPSBSZXN0b3JlU3RhdGUuUkVTVE9SRV9O\nT05FKSB7CiAgICAgICAgICAgICAgICAvLyByb2xsYmFjayBhbGwgY3VycmVu\ndGx5LWxvYWRlZCBmaWVsZHMKICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspCiAg\nICAgICAgICAgICAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGkpICYmIF9zYXZl\nZC5yZXN0b3JlRmllbGQoaSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zYXZlZCwgaSk7CgogICAgICAgICAgICAgICAg\nLy8gcm9sbGJhY2sgbG9hZGVkIHNldAogICAgICAgICAgICAgICAgX2xvYWRl\nZC5hbmROb3QoX3NhdmVkLmdldFVubG9hZGVkKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNl\ncyBhbGwgc2Vjb25kIGNsYXNzIG9iamVjdCBmaWVsZHMgd2l0aCBmcmVzaCBw\ncm94aWVkIGluc3RhbmNlcwogICAgICogY29udGFpbmluZyB0aGUgc2FtZSBp\nbmZvcm1hdGlvbiBhcyB0aGUgb3JpZ2luYWxzLgogICAgICovCiAgICB2b2lk\nIHByb3h5RmllbGRzKGJvb2xlYW4gcmVzZXQsIGJvb2xlYW4gcmVwbGFjZU51\nbGwpIHsKICAgICAgICAvLyB3ZSBvbmx5IHJlcGxhY2UgbnVsbHMgaWYgdGhl\nIHJ1bnRpbWUgY2FuJ3QgZGlmZmVyZW50aWF0ZSBiZXR3ZWVuCiAgICAgICAg\nLy8gbnVsbCBhbmQgZW1wdHkgY29udGFpbmVycy4gIHdlIHJlcGxhY2UgbnVs\nbHMgaW4gdGhpcyBjYXNlIHRvCiAgICAgICAgLy8gbWFpbnRhaW4gY29uc2lz\ndGVuY3kgd2hldGhlciB2YWx1ZXMgYXJlIGJlaW5nIHJldGFpbmVkIG9yIG5v\ndAogICAgICAgIGlmIChyZXBsYWNlTnVsbCkKICAgICAgICAgICAgcmVwbGFj\nZU51bGwgPSAhX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuc3VwcG9ydGVk\nT3B0aW9ucygpLgogICAgICAgICAgICAgICAgY29udGFpbnMoT3BlbkpQQUNv\nbmZpZ3VyYXRpb24uT1BUSU9OX05VTExfQ09OVEFJTkVSKTsKCiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChpKSkgewogICAgICAg\nICAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChfc2luZ2xlLnByb3h5KHJlc2V0LCBy\nZXBsYWNlTnVsbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVW5wcm94eSBhbGwgZmllbGRzLgogICAgICovCiAg\nICB2b2lkIHVucHJveHlGaWVsZHMoKSB7CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX05PX1VOUFJPWFkpICE9IDApCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwLCBsZW4gPSBfbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVu\nOyBpKyspIHsKICAgICAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9z\naW5nbGUsIGkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS51bnByb3h5KCk7\nCiAgICAgICAgICAgICAgICBfc2luZ2xlLnJlbGVhc2VFbWJlZGRlZCgpOwog\nICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgcmVh\nZHkgZm9yIGEgZmx1c2guIFBlcnNpc3RzIGFsbCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIG9iamVjdCBmaWVsZHMsCiAgICAgKiBhbmQgY2hlY2tzIGZvciBpbGxl\nZ2FsIG51bGwgdmFsdWVzLiBBbHNvIGFzc2lnbnMgb2lkcyBhbmQgZmllbGQg\ndmFsdWVzCiAgICAgKiBmb3IgYWxsIHN0cmF0ZWdpZXMgdGhhdCBkb24ndCBy\nZXF1aXJlIGZsdXNoaW5nLgogICAgICovCiAgICB2b2lkIHByZUZsdXNoKGJv\nb2xlYW4gbG9naWNhbCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19QUkVfRkxVU0hFRCkgIT0gMCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpZiAoaXNQZXJzaXN0ZW50KCkpIHsKICAg\nICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9TVE9SRSk7CiAgICAgICAgICAgIC8vIEJFRk9SRV9QRVJTSVNUIGlz\nIGhhbmRsZWQgZHVyaW5nIEJyb2tlci5wZXJzaXN0IGFuZCBCcm9rZXIuYXR0\nYWNoCiAgICAgICAgICAgIGlmIChpc0RlbGV0ZWQoKSkKICAgICAgICAgICAg\nICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVf\nREVMRVRFKTsKICAgICAgICAgICAgZWxzZSBpZiAoIShpc05ldygpICYmICFp\nc0ZsdXNoZWQoKSkpCiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZl\nbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1VQREFURSk7CiAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX1BSRV9GTFVTSEVEOwogICAgICAgIH0KCiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghbG9n\naWNhbCkKICAgICAgICAgICAgICAgIGFzc2lnbk9iamVjdElkKGZhbHNlLCB0\ncnVlKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9tZXRh\nLmdldEZpZWxkcygpLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBpZiAoKGxvZ2ljYWwgfHwgIWFzc2lnbkZpZWxkKGksIHRydWUp\nKSAmJiAhX2ZsdXNoLmdldChpKQogICAgICAgICAgICAgICAgICAgICYmIF9k\naXJ0eS5nZXQoaSkpIHsKICAgICAgICAgICAgICAgICAgICBwcm92aWRlRmll\nbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nX3NpbmdsZS5wcmVGbHVzaChsb2dpY2FsLCBjYWxsKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAg\nICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAg\nICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGRpcnR5Q2hlY2soKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBNYWtlIGNhbGxiYWNrcyBmb3IgZGVsZXRpb24u\nCiAgICAgKi8KICAgIHZvaWQgcHJlRGVsZXRlKCkgewogICAgICAgIC8vIHNl\ndCBhIGZsYWcgd2hpbGUgY2FsbCBwcmUgZGVsZXRlIGNhbGxiYWNrIHNvIHRo\nYXQgdXNlciBjYW4ndAogICAgICAgIC8vIGdldCBpbnRvIGluZmluaXRlIHJl\nY3Vyc2lvbiBieSBjYWxsaW5nIGRlbGV0ZSh0aGlzKQogICAgICAgIC8vIHdp\ndGhpbiBoaXMgY2FsbGJhY2sgbWV0aG9kCiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGTEFHX1BSRV9ERUxFVElORykgPT0gMCkgewogICAgICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19QUkVfREVMRVRJTkc7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZl\nbnQuQkVGT1JFX0RFTEVURSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfUFJFX0RFTEVUSU5HOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQ2FzY2FkZSBkZWxldGVzIGFuZCBkZXJlZmVyZW5jZSBkZXBlbmRlbnQgZmll\nbGRzLgogICAgICovCiAgICB2b2lkIGNhc2NhZGVEZWxldGUoT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21l\ndGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmbWRzW2ldLmdl\ndENhc2NhZGVEZWxldGUoKSAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9O\nRQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRLZXkoKS5nZXRDYXNj\nYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICE9IFZhbHVlTWV0YURhdGEu\nQ0FTQ0FERV9OT05FCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEVs\nZW1lbnQoKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICE9\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKSB7CiAgICAgICAgICAgICAg\nICBfc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChpLCBm\nYWxzZSkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5kZWxldGUoY2FsbCk7\nCiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxsZWQgYWZ0\nZXIgYW4gaW5zdGFuY2UgaXMgcGVyc2lzdGVkIGJ5IGEgdXNlciB0aHJvdWdo\nIHRoZSBicm9rZXIuCiAgICAgKiBDYXNjYWRlcyB0aGUgcGVyc2lzdCBvcGVy\nYXRpb24gdG8gZmllbGRzIG1hcmtlZAogICAgICoge0BsaW5rIFZhbHVlTWV0\nYURhdGEjQ0FTQ0FERV9JTU1FRElBVEV9LgogICAgICovCiAgICB2b2lkIGNh\nc2NhZGVQZXJzaXN0KE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGkpKQogICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRl\nUGVyc2lzdCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUK\nICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0S2V5KCkuZ2V0Q2FzY2Fk\nZVBlcnNpc3QoKQogICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5n\nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZVBlcnNpc3QoKQogICAgICAgICAgICAg\nICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAg\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVjdEZpZWxkKGksIGZldGNo\nRmllbGQoaSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUucGVy\nc2lzdChjYWxsKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIExvYWQgdGhlIGdpdmVuIGZpZWxkIHNldCBmcm9tIHRoZSBkYXRhIHN0b3Jl\nIGludG8gdGhlIGluc3RhbmNlLgogICAgICogUmV0dXJuIHRydWUgaWYgYW55\nIGRhdGEgaXMgbG9hZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAg\nIGJvb2xlYW4gbG9hZEZpZWxkcyhCaXRTZXQgZmllbGRzLCBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIGludCBsb2NrTGV2ZWwsCiAgICAgICAgT2JqZWN0\nIHNkYXRhLCBib29sZWFuIGZvcldyaXRlKSB7CiAgICAgICAgLy8gY2FuJ3Qg\nbG9hZCB2ZXJzaW9uIGZpZWxkIGZyb20gc3RvcmUKICAgICAgICBpZiAoZmll\nbGRzICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSB2Zmll\nbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKICAgICAgICAgICAgaWYg\nKHZmaWVsZCAhPSBudWxsKQogICAgICAgICAgICAgICAgZmllbGRzLmNsZWFy\nKHZmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIGJvb2xl\nYW4gcmV0ID0gZmFsc2U7CiAgICAgICAgc2V0TG9hZGluZyh0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBhbnkgZmllbGRzIGdpdmVu\nLCBsb2FkIHRoZW0KICAgICAgICAgICAgaW50IGxlbiA9IChmaWVsZHMgPT0g\nbnVsbCkgPyAwIDogZmllbGRzLmxlbmd0aCgpOwogICAgICAgICAgICBpZiAo\nbGVuID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGZldGNoID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNo\nQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKCFfYnJva2Vy\nLmdldFN0b3JlTWFuYWdlcigpLmxvYWQodGhpcywgZmllbGRzLCBmZXRjaCwK\nICAgICAgICAgICAgICAgICAgICBsb2NrTGV2ZWwsIHNkYXRhKSkgewogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2Vw\ndGlvbihfbG9jLmdldCgiZGVsLWluc3RhbmNlIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBfb2lkKSkuCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBtYWtlIHN1cmUgdmVyc2lvbiBpbmZvcm1hdGlvbiBoYXMgYmVlbiBzZXQ7\nIHZlcnNpb24gaW5mbyBtdXN0CiAgICAgICAgICAgIC8vIGFsd2F5cyBiZSBz\nZXQgYWZ0ZXIgdGhlIGZpcnN0IHN0YXRlIGxvYWQgb3Igc2V0ICh3aGljaCBp\ncyB3aHkKICAgICAgICAgICAgLy8gd2UgZG8gdGhpcyBldmVuIGlmIG5vIGZp\nZWxkcyB3ZXJlIGxvYWRlZCAtLSBjb3VsZCBiZSB0aGF0IHRoaXMKICAgICAg\nICAgICAgLy8gbWV0aG9kIGlzIGJlaW5nIGNhbGxlZCBhZnRlciBhIGZpZWxk\nIGlzIHNldCkuLi4gc29tZSBpbnN0YW5jZXMKICAgICAgICAgICAgLy8gbWln\naHQgbm90IGhhdmUgdmVyc2lvbiBpbmZvLCBpbiB3aGljaCBjYXNlIHRoaXMg\nZ2V0cyBjYWxsZWQKICAgICAgICAgICAgLy8gbXV0aXBsZSB0aW1lczsgdGhh\ndCBzaG91bGQgYmUgb2sgdG9vCiAgICAgICAgICAgIGlmIChfbG9hZFZlcnNp\nb24gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc3luY1ZlcnNpb24oc2Rh\ndGEpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IF9sb2FkVmVyc2lv\nbiAhPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZp\nbmFsbHkgewogICAgICAgICAgICBzZXRMb2FkaW5nKGZhbHNlKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHNlZSBpZiB0aGUgZGZnIGlzIG5vdyBsb2FkZWQ7\nIGRvIHRoaXMgcmVnYXJkbGVzcyBvZiB3aGV0aGVyIHdlCiAgICAgICAgLy8g\nbG9hZGVkIGFueSBmaWVsZHMsIGNhdXNlIG1heSBhbHJlYWR5IGhhdmUgYmVl\nbiBsb2FkZWQgYnkKICAgICAgICAvLyBTdG9yZU1hbmFnZXIgZHVyaW5nIGlu\naXRpYWxpemF0aW9uCiAgICAgICAgcG9zdExvYWQoLTEsIGZldGNoKTsKICAg\nICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0\naGUgZ2l2ZW4gZmllbGQncyBmZXRjaCBncm91cDsgdGhlIGZpZWxkIGl0c2Vs\nZiBtYXkgYWxyZWFkeSBiZQogICAgICogbG9hZGVkIGlmIGl0IGlzIGJlaW5n\nIHNldCBieSB0aGUgdXNlci4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nbG9hZEZpZWxkKGludCBmaWVsZCwgaW50IGxvY2tMZXZlbCwgYm9vbGVhbiBm\nb3JXcml0ZSwKICAgICAgICBib29sZWFuIGZncykgewogICAgICAgIEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgQml0U2V0IGZpZWxkcyA9IG51bGw7\nCgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBkZmcgZmllbGQgb3Igd2UgbmVl\nZCB0byBsb2FkIG91ciBkZmcsIGRvIHNvCiAgICAgICAgaWYgKGZncyAmJiAo\nX2ZsYWdzICYgRkxBR19MT0FERUQpID09IDApCiAgICAgICAgICAgIGZpZWxk\ncyA9IGdldFVubG9hZGVkSW50ZXJuYWwoZmV0Y2gsIExPQURfRkdTLCBudWxs\nKTsKICAgICAgICAKICAgICAgICAvLyBjaGVjayBmb3IgbG9hZCBmZXRjaCBn\ncm91cAogICAgICAgIFN0cmluZyBsZmcgPSBmbWQuZ2V0TG9hZEZldGNoR3Jv\ndXAoKTsKICAgICAgICBib29sZWFuIGxmZ0FkZGVkID0gZmFsc2U7CiAgICAg\nICAgaWYgKGxmZyAhPSBudWxsKSB7ICAKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGkpICYmIChpID09IGZpZWxk\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5pc0luRmV0Y2hHcm91\ncChsZmcpKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJp\ndFNldChmbWRzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgZmllbGRz\nLnNldChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gcmVsYXRpb24gZmllbGQgaXMgbG9hZGVkIHdpdGggdGhl\nIGxvYWQtZmV0Y2gtZ3JvdXAKICAgICAgICAgICAgLy8gYnV0IHRoaXMgYWRk\naXRpb24gbXVzdCBiZSByZXZlcnRlZCBvbmNlIHRoZSBsb2FkIGlzIG92ZXIK\nICAgICAgICAgICAgaWYgKCFmZXRjaC5oYXNGZXRjaEdyb3VwKGxmZykpIHsK\nICAgICAgICAgICAgICAgIGZldGNoLmFkZEZldGNoR3JvdXAobGZnKTsKICAg\nICAgICAgICAgICAgIGxmZ0FkZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZWxzZSBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgp\nICYmIGZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG5vIGxvYWQg\nZ3JvdXAgYnV0IGRmZzogYWRkIGRmZyBmaWVsZHMgaWYgd2UgaGF2ZW4ndCBh\nbHJlYWR5CiAgICAgICAgICAgIGZpZWxkcyA9IGdldFVubG9hZGVkSW50ZXJu\nYWwoZmV0Y2gsIExPQURfRkdTLCBudWxsKTsKICAgICAgICB9IGVsc2UgaWYg\nKCFfbG9hZGVkLmdldChmbWQuZ2V0SW5kZXgoKSkpIHsKICAgICAgICAgICAg\nLy8gbm8gbG9hZCBncm91cCBvciBkZmc6IGxvYWQgaW5kaXZpZHVhbCBmaWVs\nZAogICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBmaWVsZHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgICAgIGZpZWxk\ncy5zZXQoZm1kLmdldEluZGV4KCkpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2FsbCB0aGlzIG1ldGhvZCBldmVuIGlmIHRoZXJlIGFyZSBubyB1bmxvYWRl\nZCBmaWVsZHM7IGxvYWRGaWVsZHMKICAgICAgICAvLyB0YWtlcyBjYXJlIG9m\nIHRoaW5ncyBsaWtlIGxvYWRpbmcgdmVyc2lvbiBpbmZvIGFuZCBzZXR0aW5n\nIFBDIGZsYWdzCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9hZEZpZWxk\ncyhmaWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIG51bGwsIGZvcldyaXRlKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAobGZnQWRkZWQp\nCiAgICAgICAgICAgICAgICBmZXRjaC5yZW1vdmVGZXRjaEdyb3VwKGxmZyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB0byBwcm92aWRlIHRoZSBnaXZlbiBmaWVsZCBudW1iZXIgdG8gdGhlIGdp\ndmVuCiAgICAgKiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAgICB2b2lkIHBy\nb3ZpZGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIEZpZWxkTWFuYWdl\nciBzdG9yZSwgaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNYW5hZ2VyIGJl\nZm9yZUZNID0gX2ZtOwogICAgICAgIF9mbSA9IHN0b3JlOwogICAgICAgIHBj\nLnBjUHJvdmlkZUZpZWxkKGZpZWxkKTsKICAgICAgICAvLyBSZXRhaW5pbmcg\nb3JpZ2luYWwgRk0gYmVjYXVzZSBvZiB0aGUgcG9zc2liaWxpdHkgb2YgcmVl\nbnRyYW50IGNhbGxzCiAgICAgICAgX2ZtID0gYmVmb3JlRk07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHJlcGxhY2UgdGhlIGdp\ndmVuIGZpZWxkIG51bWJlciB0byB0aGUgZ2l2ZW4KICAgICAqIGZpZWxkIG1h\nbmFnZXIuCiAgICAgKi8KICAgIHZvaWQgcmVwbGFjZUZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgRmllbGRNYW5hZ2VyIGxvYWQsIGludCBmaWVsZCkg\newogICAgICAgIEZpZWxkTWFuYWdlciBiZWZvcmVGTSA9IF9mbTsKICAgICAg\nICBfZm0gPSBsb2FkOwogICAgICAgIHBjLnBjUmVwbGFjZUZpZWxkKGZpZWxk\nKTsKICAgICAgICAvLyBSZXRhaW5pbmcgb3JpZ2luYWwgRk0gYmVjYXVzZSBv\nZiB0aGUgcG9zc2liaWxpdHkgb2YgcmVlbnRyYW50IGNhbGxzCiAgICAgICAg\nX2ZtID0gYmVmb3JlRk07CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRo\nZSBmaWVsZCBhcyBsb2FkZWQgb3IgdW5sb2FkZWQuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBzZXRMb2FkZWQoaW50IGZpZWxkLCBib29sZWFuIGlzTG9h\nZGVkKSB7CiAgICAgICAgLy8gZG9uJ3QgY29udGludWUgaWYgbG9hZGVkIHN0\nYXRlIGlzIGFscmVhZHkgY29ycmVjdDsgb3RoZXJ3aXNlIHdlCiAgICAgICAg\nLy8gY2FuIGVuZCB1cCBjbGVhcmluZyBfZmllbGRJbXBsIHdoZW4gd2Ugc2hv\ndWxkbid0CiAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSA9PSBpc0xv\nYWRlZCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiBsb2Fk\naW5nLCBjbGVhciBpbnRlcm1lZGlhdGUgZGF0YTsgaWYgdW5sb2FkaW5nLCBj\nbGVhciBpbXBsIGRhdGEKICAgICAgICBpZiAoX2ZpZWxkSW1wbCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxk\nRGF0YUluZGV4KGZpZWxkKTsKICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkK\nICAgICAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IG51bGw7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoaXNMb2FkZWQpCiAgICAgICAgICAgIF9sb2Fk\nZWQuc2V0KGZpZWxkKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9sb2Fk\nZWQuY2xlYXIoZmllbGQpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9y\nbSBwb3N0LWxvYWQgc3RlcHMsIGluY2x1ZGluZyB0aGUgcG9zdCBsb2FkIGNh\nbGxiYWNrLgogICAgICogV2UgaGF2ZSB0byBjaGVjayB0aGUgZGZnIGFmdGVy\nIGFsbCBmaWVsZCBsb2FkcyBiZWNhdXNlIGl0IG1pZ2h0IGJlCiAgICAgKiBs\nb2FkZWQgaW4gbXVsdGlwbGUgc3RlcHMgd2hlbiBwYWdpbmcgaXMgaW52b2x2\nZWQ7IHRoZSBpbml0aWFsIGxvYWQKICAgICAqIG1pZ2h0IGV4Y2x1ZGUgc29t\nZSBmaWVsZHMgd2hpY2ggYXJlIHRoZW4gaW1tZWRpYXRlbHkgbG9hZGVkIGlu\nIGEKICAgICAqIHNlcGFyYXRlIHN0ZXAgYmVmb3JlIGJlaW5nIHJldHVybmVk\nIHRvIHRoZSB1c2VyLgogICAgICoKICAgICAqIEBwYXJhbSBmaWVsZCB0aGUg\nZmllbGQgaW5kZXggdGhhdCB3YXMgbG9hZGVkLCBvciAtMSB0byBpbmRpY2F0\nZQogICAgICogdGhhdCBhIGdyb3VwIG9mIHBvc3NpYmx5IHVua25vd24gZmll\nbGRzIHdhcyBsb2FkZWQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBvc3RM\nb2FkKGludCBmaWVsZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAg\nICAgICAgLy8gbm8gbmVlZCBmb3IgcG9zdExvYWQgY2FsbGJhY2s/CiAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX0xPQURFRCkgIT0gMCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAvLyBpbiB0aGUgbWlkZGxlIG9mIGEgZ3Jv\ndXAgbG9hZCwgYWZ0ZXIgd2hpY2ggdGhpcyBtZXRob2Qgd2lsbCBiZQogICAg\nICAgIC8vIGNhbGxlZCBhZ2Fpbj8KICAgICAgICBpZiAoZmllbGQgIT0gLTEg\nJiYgaXNMb2FkaW5nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gbm8gbGlzdGVuZXJzPwogICAgICAgIExpZmVjeWNsZUV2ZW50TWFuYWdl\nciBtZ3IgPSBfYnJva2VyLmdldExpZmVjeWNsZUV2ZW50TWFuYWdlcigpOwog\nICAgICAgIGlmIChtZ3IgPT0gbnVsbCB8fCAhbWdyLmhhc0xvYWRMaXN0ZW5l\ncnMoZ2V0TWFuYWdlZEluc3RhbmNlKCksIF9tZXRhKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAg\nICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwog\nICAgICAgIC8vIGlzIHRoaXMgZmllbGQgYSBwb3N0LWxvYWQgZmllbGQ/CiAg\nICAgICAgaWYgKGZpZWxkICE9IC0xKSB7CiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAg\nICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAgICAg\nICAgICAgJiYgZmV0Y2guaGFzRmV0Y2hHcm91cChGZXRjaEdyb3VwLk5BTUVf\nREVGQVVMVCkKICAgICAgICAgICAgICAgICYmIHBvc3RMb2FkKEZldGNoR3Jv\ndXAuTkFNRV9ERUZBVUxULCBmZXRjaCkpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIFN0cmluZ1tdIGZncyA9IGZtZC5nZXRDdXN0b21G\nZXRjaEdyb3VwcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmZXRjaC5o\nYXNGZXRjaEdyb3VwKGZnc1tpXSkgJiYgcG9zdExvYWQoZmdzW2ldLCBmZXRj\naCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmV0Y2guZ2V0\nRmV0Y2hHcm91cHMoKS5pdGVyYXRvcigpOyAKICAgICAgICAgICAgICAgIGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBpZiAocG9zdExvYWQo\nKFN0cmluZykgaXRyLm5leHQoKSwgZmV0Y2gpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFBlcmZvcm0gcG9zdC1sb2FkIGFjdGlvbnMgaWYgdGhl\nIGdpdmVuIGZldGNoIGdyb3VwIGlzIGEgcG9zdC1sb2FkIGdyb3VwCiAgICAg\nKiBhbmQgaXMgZnVsbHkgbG9hZGVkLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gcG9zdExvYWQoU3RyaW5nIGZnTmFtZSwgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IF9tZXRhLmdl\ndEZldGNoR3JvdXAoZmdOYW1lKTsKICAgICAgICBpZiAoZmcgPT0gbnVsbCB8\nfCAhZmcuaXNQb3N0TG9hZCgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGkpICYmIGZt\nZHNbaV0uaXNJbkZldGNoR3JvdXAoZmdOYW1lKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BREVE\nOwogICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50KGdldE1hbmFn\nZWRJbnN0YW5jZSgpLCBmZXRjaCwgX21ldGEsIAogICAgICAgIAlMaWZlY3lj\nbGVFdmVudC5BRlRFUl9MT0FEKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIG91ciB2ZXJzaW9uIG9i\namVjdCB3aXRoIHRoZSBkYXRhc3RvcmUuCiAgICAgKi8KICAgIHByaXZhdGUg\nYm9vbGVhbiBzeW5jVmVyc2lvbihPYmplY3Qgc2RhdGEpIHsKICAgICAgICBy\nZXR1cm4gX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5zeW5jVmVyc2lvbih0\naGlzLCBzZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHdo\nZXRoZXIgdGhpcyBpbnN0YW5jZSBuZWVkcyBhIHZlcnNpb24gY2hlY2suCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVmVyc2lvbkNoZWNrUmVxdWly\nZWQoKSB7CiAgICAgICAgLy8gZXhwbGljaXQgZmxhZyBmb3IgdmVyc2lvbiBj\naGVjawogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19WRVJTSU9OX0NIRUNL\nKSAhPSAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgaWYg\nKCFfYnJva2VyLmdldE9wdGltaXN0aWMoKSAmJiAhX2Jyb2tlci5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldENvbXBhdGliaWxpdHlJbnN0\nYW5jZSgpLmdldE5vbk9wdGltaXN0aWNWZXJzaW9uQ2hlY2soKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfc3RhdGUuaXNW\nZXJzaW9uQ2hlY2tSZXF1aXJlZCh0aGlzKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgcmVxdWlyZXMgYSB2ZXJz\naW9uIGNoZWNrIG9uIHRoZSBuZXh0IGZsdXNoLgogICAgICovCiAgICB2b2lk\nIHNldENoZWNrVmVyc2lvbihib29sZWFuIHZlcnNpb25DaGVjaykgewogICAg\nICAgIGlmICh2ZXJzaW9uQ2hlY2spCiAgICAgICAgICAgIF9mbGFncyB8PSBG\nTEFHX1ZFUlNJT05fQ0hFQ0s7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9DSEVDSzsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgd2hldGhlciB0aGlzIGluc3RhbmNlIG5lZWRzIGEg\ndmVyc2lvbiB1cGRhdGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlz\nVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkgewogICAgICAgIHJldHVybiAoX2Zs\nYWdzICYgRkxBR19WRVJTSU9OX1VQREFURSkgPiAwOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHdoZXRoZXIgdGhpcyBpbnN0YW5jZSByZXF1aXJlcyBh\nIHZlcnNpb24gdXBkYXRlIG9uIHRoZSBuZXh0IGZsdXNoLgogICAgICovCiAg\nICB2b2lkIHNldFVwZGF0ZVZlcnNpb24oYm9vbGVhbiB2ZXJzaW9uVXBkYXRl\nKSB7CiAgICAgICAgaWYgKHZlcnNpb25VcGRhdGUpCiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX1ZFUlNJT05fVVBEQVRFOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05fVVBEQVRFOwogICAg\nfQoKICAgIC8qKgogICAgICogVHJhbnNsYXRlIHRoZSBnaXZlbiBleGNlcHRp\nb24gYmFzZWQgb24gdGhlIGJyb2tlcidzIGltcGxpY2l0IGJlaGF2aW9yLgog\nICAgICogVHJhbnNsYXRpb24gb25seSBvY2N1cnMgaWYgdGhlIGV4Y2VwdGlv\nbiBpcyBpbml0aWF0ZWQgYnkgYSB1c2VyIGFjdGlvbgogICAgICogb24gYW4g\naW5zdGFuY2UsIGFuZCB0aGVyZWZvcmUgd2lsbCBub3QgYmUgY2F1Z2h0IGFu\nZCB0cmFuc2xhdGVkIGJ5IHRoZQogICAgICogYnJva2VyLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgUnVudGltZUV4Y2VwdGlvbiB0cmFuc2xhdGUoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgIFJ1bnRpbWVFeGNlcHRpb25UcmFu\nc2xhdG9yIHRyYW5zID0gX2Jyb2tlci4KICAgICAgICAgICAgZ2V0SW5zdGFu\nY2VFeGNlcHRpb25UcmFuc2xhdG9yKCk7CiAgICAgICAgcmV0dXJuICh0cmFu\ncyA9PSBudWxsKSA/IHJlIDogdHJhbnMudHJhbnNsYXRlKHJlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIExvY2sgdGhlIHN0YXRlIG1hbmFnZXIgaWYgdGhl\nIG11bHRpdGhyZWFkZWQgb3B0aW9uIGlzIHNldC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgbG9jaygpIHsKICAgICAgICAvLyB1c2UgYnJva2VyLWxl\ndmVsIGxvY2sgdG8gYXZvaWQgZGVhZGxvY2sgc2l0dWF0aW9ucyB3aXRoIHRo\nZSBzdGF0ZQogICAgICAgIC8vIG1hbmFnZXIgbG9jayBhbmQgYnJva2VyIGxv\nY2sgYmVpbmcgb2J0YWluZWQgaW4gZGlmZmVyZW50IG9yZGVycwogICAgICAg\nIF9icm9rZXIubG9jaygpOwogICAgfQoKICAgIC8qKgogICAgICogVW5sb2Nr\nIHRoZSBzdGF0ZSBtYW5hZ2VyLgogICAgICovCglwcm90ZWN0ZWQgdm9pZCB1\nbmxvY2sgKCkKCXsKCQkvLyB1c2UgYnJva2VyLWxldmVsIGxvY2sgdG8gYXZv\naWQgZGVhZGxvY2sgc2l0dWF0aW9ucyB3aXRoIHRoZSBzdGF0ZSAKCQkvLyBt\nYW5hZ2VyIGxvY2sgYW5kIGJyb2tlciBsb2NrIGJlaW5nIG9idGFpbmVkIGlu\nIGRpZmZlcmVudCBvcmRlcnMKCQlfYnJva2VyLnVubG9jayAoKTsKCX0KfQo=\n","encoding":"base64"}

