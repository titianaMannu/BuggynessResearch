{"sha":"c7a3eaa29d5254d6b2bd0e2c7f38b9c551e89d66","node_id":"MDQ6QmxvYjIwNjM2NDpjN2EzZWFhMjlkNTI1NGQ2YjJiZDBlMmM3ZjM4YjljNTUxZTg5ZDY2","size":87048,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c7a3eaa29d5254d6b2bd0e2c7f38b9c551e89d66","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubWV0YS5Tb3VyY2VUcmFja2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2\nSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxv\nY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5P\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwuQ29t\nbWVudGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CaWdE\nZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CaWdJ\nbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5CeXRl\nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW50SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT2JqZWN0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5PcGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEudXRpbC5TaG9ydElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuU3RyaW5nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5V\nbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsK\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJh\ndGlvbnM7CgovKioKICogQ29udGFpbnMgbWV0YWRhdGEgYWJvdXQgYSBwZXJz\naXN0ZW50IHR5cGUuCiAqIFRoaXMgbWV0YWRhdGEgaXMgYXZhaWxhYmxlIGJv\ndGggYXQgZW5oYW5jZW1lbnQgdGltZSBhbmQgcnVudGltZS4KICogIE5vdGUg\ndGhhdCB0aGlzIGNsYXNzIGVtcGxveXMgYWdncmVzc2l2ZSBjYWNoaW5nLCBh\nbmQgdGhlcmVmb3JlIGl0IGlzCiAqIGltcG9ydGFudCB0byBmaW5hbGl6ZSB0\naGUgY29uZmlndXJhdGlvbiBvZiBmaWVsZCBtZXRhZGF0YXMgYmVmb3JlIGlu\ndm9raW5nCiAqIG1ldGhvZHMgdGhhdCBkZXBlbmQgb24gdGhhdCBjb25maWd1\ncmF0aW9uLCBzdWNoIGFzCiAqIHtAbGluayAjZ2V0UHJpbWFyeUtleUZpZWxk\nc30uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3Mg\nQ2xhc3NNZXRhRGF0YQogICAgZXh0ZW5kcyBFeHRlbnNpb25zCiAgICBpbXBs\nZW1lbnRzIENvbXBhcmFibGUsIFNvdXJjZVRyYWNrZXIsIE1ldGFEYXRhQ29u\ndGV4dCwgTWV0YURhdGFNb2RlcywKICAgIENvbW1lbnRhYmxlIHsKCiAgICAv\nKioKICAgICAqIFVua29ud24gaWRlbnRpdHkgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSURfVU5LTk9XTiA9IDA7CgogICAg\nLyoqCiAgICAgKiBEYXRhc3RvcmUgaWRlbnRpdHkgdHlwZS4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSURfREFUQVNUT1JFID0gMTsK\nCiAgICAvKioKICAgICAqIEFwcGxpY2F0aW9uIGlkZW50aXR5IHR5cGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IElEX0FQUExJQ0FU\nSU9OID0gMjsKCiAgICAvKioKICAgICAqIFVua25vd24gYWNjZXNzIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDQ0VTU19V\nTktOT1dOID0gMDsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgYXR0cmli\ndXRlcyBhcmUgYWNjZXNzZWQgdmlhIGRpcmVjdCBmaWVsZCBhY2Nlc3MuIEJp\ndCBmbGFnLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBB\nQ0NFU1NfRklFTEQgPSAyIDw8IDA7CgogICAgLyoqCiAgICAgKiBQZXJzaXN0\nZW50IGF0dHJpYnV0ZXMgYXJlIGFjY2Vzc2VkIHZpYSBzZXR0ZXJzIGFuZCBn\nZXR0ZXJzLiBCaXQgZmxhZy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgQUNDRVNTX1BST1BFUlRZID0gMiA8PCAxOwoKICAgIC8qKgog\nICAgICogVmFsdWUgZm9yIHVzaW5nIGEgc3ludGhldGljIGRldGFjaGVkIHN0\nYXRlIGZpZWxkLCB3aGljaCBpcyB0aGUgZGVmYXVsdC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgU1lOVEhFVElDID0gImBzeW4i\nOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgU3RyaW5nIERFRkFVTFRf\nU1RSSU5HID0gImAiOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoQ2xh\nc3NNZXRhRGF0YS5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nRmV0Y2hHcm91cFtdIEVNUFRZX0ZFVENIX0dST1VQX0FSUkFZCiAgICAgICAg\nPSBuZXcgRmV0Y2hHcm91cFswXTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0cmluZ1tdIEVNUFRZX1NUUklOR19BUlJBWSA9IG5ldyBTdHJpbmdbMF07\nCgogICAgcHJpdmF0ZSBNZXRhRGF0YVJlcG9zaXRvcnkgX3JlcG9zOwogICAg\ncHJpdmF0ZSB0cmFuc2llbnQgQ2xhc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7\nCgogICAgcHJpdmF0ZSBmaW5hbCBWYWx1ZU1ldGFEYXRhIF9vd25lcjsKICAg\nIHByaXZhdGUgZmluYWwgTGlmZWN5Y2xlTWV0YURhdGEgX2xpZmVNZXRhID0g\nbmV3IExpZmVjeWNsZU1ldGFEYXRhKHRoaXMpOwogICAgcHJpdmF0ZSBGaWxl\nIF9zcmNGaWxlID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9zcmNUeXBlID0g\nU1JDX09USEVSOwogICAgcHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVudHMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgX2xpc3RJbmRleCA9IC0xOwogICAgcHJp\ndmF0ZSBpbnQgX3NyY01vZGUgPSBNT0RFX01FVEEgfCBNT0RFX01BUFBJTkc7\nCiAgICBwcml2YXRlIGludCBfcmVzTW9kZSA9IE1PREVfTk9ORTsKCiAgICBw\ncml2YXRlIENsYXNzIF90eXBlID0gT2JqZWN0LmNsYXNzOwogICAgcHJpdmF0\nZSBmaW5hbCBNYXAgX2ZpZWxkTWFwID0gbmV3IFRyZWVNYXAoKTsKICAgIHBy\naXZhdGUgTWFwIF9zdXBGaWVsZE1hcCA9IG51bGw7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDb2xs\nZWN0aW9uIF9zdGF0aWNGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBpbnRb\nXSBfZmllbGREYXRhVGFibGUgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2Zn\nTWFwID0gbnVsbDsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAg\nLy8gTm90ZTogaWYgeW91IGFkZCBhZGRpdGlvbmFsIHN0YXRlLCBtYWtlIHN1\ncmUgdG8gYWRkIGl0IHRvIGNvcHkoKQogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwcml2YXRlIENsYXNzIF9vYmplY3RJZCA9IG51bGw7CiAg\nICBwcml2YXRlIEJvb2xlYW4gX29iamVjdElkU2hhcmVkID0gbnVsbDsKICAg\nIHByaXZhdGUgQm9vbGVhbiBfb3BlbmpwYUlkID0gbnVsbDsKICAgIHByaXZh\ndGUgQm9vbGVhbiBfZXh0ZW50ID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVh\nbiBfZW1iZWRkZWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9pbnRl\ncmZhY2UgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfaW1wbCA9IG51bGw7\nCiAgICBwcml2YXRlIExpc3QgX2ludGVyZmFjZXMgPSBudWxsOwogICAgcHJp\ndmF0ZSBmaW5hbCBNYXAgX2lmYWNlTWFwID0gbmV3IEhhc2hNYXAoKTsKICAg\nIHByaXZhdGUgaW50IF9pZGVudGl0eSA9IElEX1VOS05PV047CiAgICBwcml2\nYXRlIGludCBfaWRTdHJhdGVneSA9IFZhbHVlU3RyYXRlZ2llcy5OT05FOwog\nICAgcHJpdmF0ZSBpbnQgX2FjY2Vzc1R5cGUgPSBBQ0NFU1NfVU5LTk9XTjsK\nCiAgICBwcml2YXRlIFN0cmluZyBfc2VxTmFtZSA9IERFRkFVTFRfU1RSSU5H\nOwogICAgcHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIF9zZXFNZXRhID0gbnVs\nbDsKICAgIHByaXZhdGUgU3RyaW5nIF9jYWNoZU5hbWUgPSBERUZBVUxUX1NU\nUklORzsKICAgIHByaXZhdGUgaW50IF9jYWNoZVRpbWVvdXQgPSBJbnRlZ2Vy\nLk1JTl9WQUxVRTsKICAgIHByaXZhdGUgQm9vbGVhbiBfZGV0YWNoYWJsZSA9\nIG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBfZGV0YWNoU3RhdGUgPSBERUZB\nVUxUX1NUUklORzsKICAgIHByaXZhdGUgU3RyaW5nIF9hbGlhcyA9IG51bGw7\nCiAgICBwcml2YXRlIGludCBfdmVyc2lvbklkeCA9IEludGVnZXIuTUlOX1ZB\nTFVFOwoKICAgIHByaXZhdGUgQ2xhc3MgX3N1cGVyID0gbnVsbDsKICAgIHBy\naXZhdGUgQ2xhc3NNZXRhRGF0YSBfc3VwZXJNZXRhID0gbnVsbDsKICAgIHBy\naXZhdGUgQ2xhc3NbXSBfc3VicyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNz\nTWV0YURhdGFbXSBfc3ViTWV0YXMgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFz\nc01ldGFEYXRhW10gX21hcFN1Yk1ldGFzID0gbnVsbDsKCiAgICBwcml2YXRl\nIEZpZWxkTWV0YURhdGFbXSBfZmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUg\nRmllbGRNZXRhRGF0YVtdIF91bm1nZEZpZWxkcyA9IG51bGw7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsRmllbGRzID0gbnVsbDsKICAgIHBy\naXZhdGUgRmllbGRNZXRhRGF0YVtdIF9hbGxQS0ZpZWxkcyA9IG51bGw7CiAg\nICBwcml2YXRlIEZpZWxkTWV0YURhdGFbXSBfYWxsREZHRmllbGRzID0gbnVs\nbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9kZWZpbmVkRmllbGRz\nID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9saXN0aW5n\nRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtdIF9h\nbGxMaXN0aW5nRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmV0Y2hHcm91\ncFtdIF9mZ3MgPSBudWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3VwW10gX2N1\nc3RvbUZHcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2ludGVyY2Vw\ndGluZyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF9hYnN0cmFjdCA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBCb29sZWFuIF9oYXNBYnN0cmFjdFBLRmll\nbGQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9oYXNQS0ZpZWxkc0Zy\nb21BYnN0cmFjdENsYXNzID0gbnVsbDsKCiAgICBwcml2YXRlIEJvb2xlYW4g\nX2lzQ2FjaGVhYmxlID0gbnVsbDsgCgogICAgLyoqCiAgICAgKiBDb25zdHJ1\nY3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0eXBlIGFuZCByZXBvc2l0b3J5Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0YShDbGFzcyB0eXBl\nLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBfcmVwb3Mg\nPSByZXBvczsKICAgICAgICBfb3duZXIgPSBudWxsOwogICAgICAgIHNldERl\nc2NyaWJlZFR5cGUodHlwZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWJl\nZGRlZCBjb25zdHJ1Y3Rvci4gU3VwcGx5IGVtYmVkZGluZyB2YWx1ZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIENsYXNzTWV0YURhdGEoVmFsdWVNZXRhRGF0\nYSBvd25lcikgewogICAgICAgIF9vd25lciA9IG93bmVyOwogICAgICAgIF9y\nZXBvcyA9IG93bmVyLmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBzZXRFbnZD\nbGFzc0xvYWRlcihvd25lci5nZXRGaWVsZE1ldGFEYXRhKCkuZ2V0RGVmaW5p\nbmdNZXRhRGF0YSgpLgogICAgICAgICAgICBnZXRFbnZDbGFzc0xvYWRlcigp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgb3duaW5nIHJl\ncG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBNZXRhRGF0YVJlcG9zaXRv\ncnkgZ2V0UmVwb3NpdG9yeSgpIHsKICAgICAgICByZXR1cm4gX3JlcG9zOwog\nICAgfQoKICAgIC8qKgogICAgICogSWYgdGhpcyBtZXRhZGF0YSBpcyBmb3Ig\nYW4gZW1iZWRkZWQgb2JqZWN0LCByZXR1cm5pbmcgdGhlIG93bmluZyB2YWx1\nZS4KICAgICAqLwogICAgcHVibGljIFZhbHVlTWV0YURhdGEgZ2V0RW1iZWRk\naW5nTWV0YURhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lcjsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIGNsYXNz\nIGRlc2NyaWJlZCBieSB0aGlzIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3MgZ2V0RGVzY3JpYmVkVHlwZSgpIHsKICAgICAgICByZXR1cm4g\nX3R5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGNsYXNzIGRl\nc2NpYmVkIGJ5IHRoaXMgbWV0YWRhdGEuIFRoZSB0eXBlIG1heSBiZSByZXNl\ndCB3aGVuCiAgICAgKiBhbiBlbWJlZGRlZCB2YWx1ZSBjaGFuZ2VzIGl0cyBk\nZWNsYXJlZCB0eXBlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRE\nZXNjcmliZWRUeXBlKENsYXNzIHR5cGUpIHsKICAgICAgICBpZiAodHlwZS5n\nZXRTdXBlcmNsYXNzKCkgIT0gbnVsbCAmJiAiamF2YS5sYW5nLkVudW0iLmVx\ndWFscwogICAgICAgICAgICAodHlwZS5nZXRTdXBlcmNsYXNzKCkuZ2V0TmFt\nZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJlbnVtIiwgdHlwZSkpOwogICAgICAgIF90eXBlID0gdHlw\nZTsKICAgICAgICBpZiAoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgIHNldEludGVyY2VwdGlu\nZyh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBlbnZpcm9ubWVu\ndGFsIGxvYWRlciB1c2VkIHdoZW4gbG9hZGluZyB0aGlzIG1ldGFkYXRhLgog\nICAgICogVGhlIGNsYXNzIG1ldGFkYXRhIHNob3VsZCB1c2UgdGhpcyBsb2Fk\nZXIgd2hlbiBsb2FkaW5nIG1ldGFkYXRhIGZvcgogICAgICogaXRzIHN1cGVy\nY2xhc3MgYW5kIGZpZWxkIHR5cGVzLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NMb2FkZXIgZ2V0RW52Q2xhc3NMb2FkZXIoKSB7CiAgICAgICAgcmV0dXJu\nIF9sb2FkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgZW52\naXJvbm1lbnRhbCBsb2FkZXIgdXNlZCB3aGVuIGxvYWRpbmcgdGhpcyBtZXRh\nZGF0YS4KICAgICAqIFRoZSBjbGFzcyBtZXRhZGF0YSBzaG91bGQgdXNlIHRo\naXMgbG9hZGVyIHdoZW4gbG9hZGluZyBtZXRhZGF0YSBmb3IKICAgICAqIGl0\ncyBzdXBlcmNsYXNzIGFuZCBmaWVsZCB0eXBlcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVy\nKSB7CiAgICAgICAgX2xvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3Mgb2Yg\ndGhlIGRlc2NyaWJlZCB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3Mg\nZ2V0UENTdXBlcmNsYXNzKCkgewogICAgICAgIHJldHVybiBfc3VwZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBz\ndXBlcmNsYXNzIG9mIHRoZSBkZXNjcmliZWQgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0UENTdXBlcmNsYXNzKENsYXNzIHBjKSB7CiAgICAg\nICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgX3N1cGVyID0gcGM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgZm9yIHRoaXMg\nY2xhc3MnIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01l\ndGFEYXRhIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkgewogICAgICAgIGlm\nIChfc3VwZXJNZXRhID09IG51bGwgJiYgX3N1cGVyICE9IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF9vd25lciAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBfc3VwZXJNZXRhID0gX3JlcG9zLm5ld0VtYmVkZGVkQ2xhc3NNZXRhRGF0\nYShfb3duZXIpOwogICAgICAgICAgICAgICAgX3N1cGVyTWV0YS5zZXREZXNj\ncmliZWRUeXBlKF9zdXBlcik7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgX3N1cGVyTWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YShfc3Vw\nZXIsIF9sb2FkZXIsIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX3N1cGVyTWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0\nYSBmb3IgdGhpcyBjbGFzcycgc3VwZXJjbGFzcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0UENTdXBlcmNsYXNzTWV0YURhdGEoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAg\nICAgX3N1cGVyTWV0YSA9IG1ldGE7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVs\nbCkKICAgICAgICAgICAgc2V0UENTdXBlcmNsYXNzKG1ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhp\ncyBjbGFzcyBpcyBtYXBwZWQgdG8gdGhlIGRhdGFzdG9yZS4gQnkgZGVmYXVs\ndCwgb25seQogICAgICogcmV0dXJucyBmYWxzZSBpZiBjbGFzcyBpcyBlbWJl\nZGRlZC1vbmx5LCBidXQgc3ViY2xhc3NlcyBtaWdodCBvdmVycmlkZQogICAg\nICogdG8gYWxsb3cgdW5tYXBwZWQgb3RoZXIgdHlwZXMuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzTWFwcGVkKCkgewogICAgICAgIHJldHVybiBf\nZW1iZWRkZWQgIT0gQm9vbGVhbi5UUlVFOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBjbG9zZXN0IG1hcHBlZCBzdXBlcmNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNYXBwZWRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpIHsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCA9\nPSBudWxsIHx8IHN1cC5pc01hcHBlZCgpKQogICAgICAgICAgICByZXR1cm4g\nc3VwOwogICAgICAgIHJldHVybiBzdXAuZ2V0TWFwcGVkUENTdXBlcmNsYXNz\nTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\na25vd24gcGVyc2lzdGVuY2UgY2FwYWJsZSBzdWJjbGFzc2VzIG9mIHRoZSBk\nZXNjcmliZWQgdHlwZSwKICAgICAqIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUg\nb3IgaWYgdGhpcyBpcyBlbWJlZGRlZCBtZXRhZGF0YS4KICAgICAqLwogICAg\ncHVibGljIENsYXNzW10gZ2V0UENTdWJjbGFzc2VzKCkgewogICAgICAgIGlm\nIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9yZXBvcy5F\nTVBUWV9DTEFTU0VTOwoKICAgICAgICBfcmVwb3MucHJvY2Vzc1JlZ2lzdGVy\nZWRDbGFzc2VzKF9sb2FkZXIpOwogICAgICAgIGlmIChfc3VicyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc3VicyA9IF9yZXBvcy5nZXRQ\nQ1N1YmNsYXNzZXMoX3R5cGUpOwogICAgICAgICAgICBfc3VicyA9IChDbGFz\nc1tdKSBzdWJzLnRvQXJyYXkobmV3IENsYXNzW3N1YnMuc2l6ZSgpXSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfc3ViczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBrbm93biBwZXJz\naXN0ZW5jZSBjYXBhYmxlIHN1YmNsYXNzZXMgb2YKICAgICAqIHRoZSBkZXNj\ncmliZWQgdHlwZSwgb3IgZW1wdHkgYXJyYXkgaWYgbm9uZSBvciBpZiB0aGlz\nIGlzIGVtYmVkZGVkCiAgICAgKiBtZXRhZGF0YS4KICAgICAqLwogICAgcHVi\nbGljIENsYXNzTWV0YURhdGFbXSBnZXRQQ1N1YmNsYXNzTWV0YURhdGFzKCkg\newogICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIF9yZXBvcy5FTVBUWV9NRVRBUzsKCiAgICAgICAgQ2xhc3NbXSBzdWJz\nID0gZ2V0UENTdWJjbGFzc2VzKCk7IC8vIGNoZWNrcyBmb3IgbmV3CiAgICAg\nICAgaWYgKF9zdWJNZXRhcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChz\ndWJzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgX3N1Yk1ldGFzID0g\nX3JlcG9zLkVNUFRZX01FVEFTOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIENsYXNzTWV0YURhdGFbXSBtZXRhcyA9IF9yZXBvcy5uZXdD\nbGFzc01ldGFEYXRhQXJyYXkKICAgICAgICAgICAgICAgICAgICAoc3Vicy5s\nZW5ndGgpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ndWJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIG1ldGFzW2ld\nID0gX3JlcG9zLmdldE1ldGFEYXRhKHN1YnNbaV0sIF9sb2FkZXIsIHRydWUp\nOwogICAgICAgICAgICAgICAgX3N1Yk1ldGFzID0gbWV0YXM7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9zdWJNZXRhczsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgbWFwcGVkIHN1YmNsYXNz\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhW10gZ2V0TWFw\ncGVkUENTdWJjbGFzc01ldGFEYXRhcygpIHsKICAgICAgICBpZiAoX293bmVy\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfcmVwb3MuRU1QVFlfTUVU\nQVM7CgogICAgICAgIENsYXNzTWV0YURhdGFbXSBzdWJzID0gZ2V0UENTdWJj\nbGFzc01ldGFEYXRhcygpOyAvLyBjaGVja3MgZm9yIG5ldwogICAgICAgIGlm\nIChfbWFwU3ViTWV0YXMgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoc3Vi\ncy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgICAgIF9tYXBTdWJNZXRhcyA9\nIHN1YnM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgTGlz\ndCBtYXBwZWQgPSBuZXcgQXJyYXlMaXN0KHN1YnMubGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic1tpXS5pc01hcHBlZCgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWQuYWRkKHN1YnNbaV0p\nOwogICAgICAgICAgICAgICAgX21hcFN1Yk1ldGFzID0gKENsYXNzTWV0YURh\ndGFbXSkgbWFwcGVkLnRvQXJyYXkKICAgICAgICAgICAgICAgICAgICAoX3Jl\ncG9zLm5ld0NsYXNzTWV0YURhdGFBcnJheShtYXBwZWQuc2l6ZSgpKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9tYXBTdWJN\nZXRhczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0eXBlIG9mIGlkZW50\naXR5IGJlaW5nIHVzZWQuIFRoaXMgd2lsbCBiZSBvbmUgb2Y6CiAgICAgKiA8\ndWw+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9VTktOT1dOfTogdW5rbm93biBp\nZGVudGl0eSB0eXBlPC9saT4KICAgICAqIDxsaT57QGxpbmsgI0lEX0RBVEFT\nVE9SRX06IGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGRhdGEgc3RvcmUgYW5k\nCiAgICAgKiBpbmRlcGVuZGVudAlvZiB0aGUgZmllbGRzIG9mIHRoZSBpbnN0\nYW5jZTwvbGk+CiAgICAgKiA8bGk+e0BsaW5rICNJRF9BUFBMSUNBVElPTn06\nIGlkZW50aXR5IG1hbmFnZWQgYnkgdGhlIGFwcGxpY2F0aW9uIGFuZAogICAg\nICogZGVmaW5lZCBieSBvbmUgb3IgbW9yZSBmaWVsZHMgb2YgdGhlIGluc3Rh\nbmNlPC9saT4KICAgICAqIDwvdWw+IElmIHVuc3BlY2lmaWVkLCBkZWZhdWx0\ncyB0byB7QGxpbmsgI0lEX0RBVEFTVE9SRX0gaWYgdGhlcmUgYXJlIG5vCiAg\nICAgKiBwcmltYXJ5IGtleSBmaWVsZHMsIGFuZCB7QGxpbmsgI0lEX0FQUExJ\nQ0FUSU9OfSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nSWRlbnRpdHlUeXBlKCkgewogICAgICAgIGlmIChfaWRlbnRpdHkgPT0gSURf\nVU5LTk9XTikgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAg\nIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfVU5LTk9X\nTikKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IHN1cC5nZXRJZGVudGl0\neVR5cGUoKTsKICAgICAgICAgICAgZWxzZSBpZiAoZ2V0UHJpbWFyeUtleUZp\nZWxkcygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBfaWRlbnRpdHkg\nPSBJRF9BUFBMSUNBVElPTjsKICAgICAgICAgICAgZWxzZSBpZiAoaXNNYXBw\nZWQoKSkKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IElEX0RBVEFTVE9S\nRTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkZW50aXR5\nID0gX3JlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVmYXVsdElkZW50aXR5VHlwZSgp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2lkZW50aXR5OwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHR5cGUgb2YgaWRlbnRpdHkgYmVpbmcgdXNl\nZC4gVGhpcyB3aWxsIGJlIG9uZSBvZjoKICAgICAqIDx1bD4KICAgICAqIDxs\naT57QGxpbmsgI0lEX1VOS05PV059OiB1bmtub3duIGlkZW50aXR5IHR5cGU8\nL2xpPgogICAgICogPGxpPntAbGluayAjSURfREFUQVNUT1JFfTogaWRlbnRp\ndHkgbWFuYWdlZCBieSB0aGUgZGF0YSBzdG9yZSBhbmQKICAgICAqIGluZGVw\nZW5kZW50CW9mIHRoZSBmaWVsZHMgb2YgdGhlIGluc3RhbmNlPC9saT4KICAg\nICAqIDxsaT57QGxpbmsgI0lEX0FQUExJQ0FUSU9OfTogaWRlbnRpdHkgbWFu\nYWdlZCBieSB0aGUgYXBwbGljYXRpb24gYW5kCiAgICAgKiBkZWZpbmVkIGJ5\nIG9uZSBvciBtb3JlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAg\nICogPC91bD4gSWYgdW5zcGVjaWZpZWQsIGRlZmF1bHRzIHRvIHtAbGluayAj\nSURfREFUQVNUT1JFfSBpZiB0aGVyZSBhcmUgbm8KICAgICAqIHByaW1hcnkg\na2V5IGZpZWxkcywgYW5kIHtAbGluayAjSURfQVBQTElDQVRJT059IG90aGVy\nd2lzZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SWRlbnRpdHlUeXBl\nKGludCB0eXBlKSB7CiAgICAgICAgX2lkZW50aXR5ID0gdHlwZTsKICAgICAg\nICBpZiAodHlwZSAhPSBJRF9BUFBMSUNBVElPTikgewogICAgICAgICAgICBf\nb2JqZWN0SWQgPSBudWxsOwogICAgICAgICAgICBfb3BlbmpwYUlkID0gbnVs\nbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRh\ndGEtc3BlY2lmaWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVjdCBJRC4K\nICAgICAqLwogICAgcHVibGljIENsYXNzIGdldE9iamVjdElkVHlwZSgpIHsK\nICAgICAgICBpZiAoX29iamVjdElkICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBfb2JqZWN0SWQ7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgp\nICE9IElEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsICYmIHN1cC5nZXRJ\nZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKSB7CiAgICAgICAgICAgIF9v\nYmplY3RJZCA9IHN1cC5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICAgICAg\ncmV0dXJuIF9vYmplY3RJZDsKICAgICAgICB9CgogICAgICAgIC8vIGZpZ3Vy\nZSBvdXQgb3BlbmpwYSBpZGVudGl0eSB0eXBlIGJhc2VkIG9uIHByaW1hcnkg\na2V5IGZpZWxkCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGdldFBy\naW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICBpZiAocGtzLmxlbmd0aCAhPSAx\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBzd2l0Y2ggKHBr\nc1swXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEJ5\ndGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IENo\nYXJJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQg\nPSBEb3VibGVJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgX29iamVj\ndElkID0gRmxvYXRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0\nSWQgPSBJbnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJ\nZCA9IExvbmdJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgX29iamVj\ndElkID0gU2hvcnRJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBTdHJpbmdJZC5jbGFzczsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgog\nICAgICAgICAgICAgICAgX29iamVjdElkID0gRGF0ZUlkLmNsYXNzOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk9JRDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAg\nICAgICAgICAgICAgX29iamVjdElkID0gT2JqZWN0SWQuY2xhc3M7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQklHREVDSU1BTDoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEJpZ0Rl\nY2ltYWxJZC5jbGFzczsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgICAgICAg\nICAgX29iamVjdElkID0gQmlnSW50ZWdlcklkLmNsYXNzOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfb2JqZWN0\nSWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEtc3BlY2lm\naWVkIGNsYXNzIHRvIHVzZSBmb3IgdGhlIG9iamVjdCBJRC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0T2JqZWN0SWRUeXBlKENsYXNzIGNscywgYm9v\nbGVhbiBzaGFyZWQpIHsKICAgICAgICBfb2JqZWN0SWQgPSBudWxsOwogICAg\nICAgIF9vcGVuanBhSWQgPSBudWxsOwogICAgICAgIF9vYmplY3RJZFNoYXJl\nZCA9IG51bGw7CiAgICAgICAgaWYgKGNscyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIC8vIGRvbid0IGxldCBwZW9wbGUgYXNzaWduIE9wZW5KUEFJZCB0eXBl\nczsgc2FmZXIgdG8gY2FsY3VsYXRlIGl0CiAgICAgICAgICAgIC8vIG91cnNl\nbHZlcwogICAgICAgICAgICBzZXRJZGVudGl0eVR5cGUoSURfQVBQTElDQVRJ\nT04pOwogICAgICAgICAgICBpZiAoIU9wZW5KUEFJZC5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKGNscykpIHsKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9\nIGNsczsKICAgICAgICAgICAgICAgIF9vYmplY3RJZFNoYXJlZCA9IChzaGFy\nZWQpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIg\ndGhpcyB0eXBlIHVzZXMgYW4gYXBwbGljYXRpb24gaWRlbnRpdHkgY2xhc3Mg\ndGhhdCBpcyBzaGFyZWQKICAgICAqIHdpdGggb3RoZXIgY2xhc3NlcywgYW5k\nIGlzIHRoZXJlZm9yZSB3cmFwcGVkIGluIGFuIHtAbGluayBPYmplY3RJZH0u\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzT2JqZWN0SWRUeXBlU2hh\ncmVkKCkgewogICAgICAgIGlmIChfb2JqZWN0SWRTaGFyZWQgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RJZFNoYXJlZC5ib29sZWFuVmFs\ndWUoKTsKICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmlzT2JqZWN0SWRU\neXBlU2hhcmVkKCk7CiAgICAgICAgcmV0dXJuIGlzT3BlbkpQQUlkZW50aXR5\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgdHlwZSB1\nc2VzIE9wZW5KUEEgaWRlbnRpdHkuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGlzT3BlbkpQQUlkZW50aXR5KCkgewogICAgICAgIGlmIChfb3Blbmpw\nYUlkID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3MgY2xzID0gZ2V0T2Jq\nZWN0SWRUeXBlKCk7CiAgICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgX29wZW5q\ncGFJZCA9IChPcGVuSlBBSWQuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShjbHMp\nKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAgOiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX29wZW5qcGFJZC5ib29s\nZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJhdGVn\neSB0byB1c2UgZm9yIGRhdGFzdG9yZSBpZGVudGl0eSBnZW5lcmF0aW9uLgog\nICAgICogT25lIG9mIHRoZSBjb25zdGFudHMgZnJvbSB7QGxpbmsgVmFsdWVT\ndHJhdGVnaWVzfS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRJZGVudGl0\neVN0cmF0ZWd5KCkgewogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUoKSA9\nPSBJRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYgX2lkU3RyYXRlZ3kgPT0g\nVmFsdWVTdHJhdGVnaWVzLk5PTkUpIHsKICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlwZSgp\nICE9IElEX1VOS05PV04pCiAgICAgICAgICAgICAgICBfaWRTdHJhdGVneSA9\nIHN1cC5nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIF9pZFN0cmF0ZWd5ID0gVmFsdWVTdHJhdGVnaWVz\nLk5BVElWRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9pZFN0cmF0ZWd5\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHRvIHVzZSBm\nb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdlbmVyYXRpb24uCiAgICAgKiBPbmUg\nb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXN9\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJZGVudGl0eVN0cmF0ZWd5\nKGludCBzdHJhdGVneSkgewogICAgICAgIF9pZFN0cmF0ZWd5ID0gc3RyYXRl\nZ3k7CiAgICAgICAgaWYgKHN0cmF0ZWd5ICE9IFZhbHVlU3RyYXRlZ2llcy5T\nRVFVRU5DRSkKICAgICAgICAgICAgc2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUo\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGF0YXN0b3JlIGlk\nZW50aXR5IHNlcXVlbmNlIG5hbWUsIG9yIG51bGwgZm9yIG5vbmUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUo\nKSB7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFscyhfc2VxTmFt\nZSkpIHsKICAgICAgICAgICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX3NlcU5hbWUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nLmdldElkZW50aXR5U2VxdWVuY2VOYW1lKCk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIF9zZXFOYW1lID0gbnVsbDsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9zZXFOYW1lOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1ZW5jZSBuYW1lLCBvciBudWxs\nIGZvciBub25lLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJZGVudGl0\neVNlcXVlbmNlTmFtZShTdHJpbmcgc2VxTmFtZSkgewogICAgICAgIF9zZXFO\nYW1lID0gc2VxTmFtZTsKICAgICAgICBfc2VxTWV0YSA9IG51bGw7CiAgICAg\nICAgaWYgKHNlcU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgc2V0SWRlbnRp\ndHlTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuU0VRVUVOQ0UpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWV0YWRhdGEgZm9yIHRoZSBkYXRhc3RvcmUgaWRl\nbnRpdHkgc2VxdWVuY2UuCiAgICAgKi8KICAgIHB1YmxpYyBTZXF1ZW5jZU1l\ndGFEYXRhIGdldElkZW50aXR5U2VxdWVuY2VNZXRhRGF0YSgpIHsKICAgICAg\nICBpZiAoX3NlcU1ldGEgPT0gbnVsbCAmJiBnZXRJZGVudGl0eVNlcXVlbmNl\nTmFtZSgpICE9IG51bGwpCiAgICAgICAgICAgIF9zZXFNZXRhID0gX3JlcG9z\nLmdldFNlcXVlbmNlTWV0YURhdGEodGhpcywKICAgICAgICAgICAgICAgIGdl\ndElkZW50aXR5U2VxdWVuY2VOYW1lKCksIHRydWUpOwogICAgICAgIHJldHVy\nbiBfc2VxTWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIEluZm9ybWF0aW9u\nIGFib3V0IGxpZmVjeWNsZSBjYWxsYmFja3MgZm9yIHRoaXMgY2xhc3MuCiAg\nICAgKi8KICAgIHB1YmxpYyBMaWZlY3ljbGVNZXRhRGF0YSBnZXRMaWZlY3lj\nbGVNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4gX2xpZmVNZXRhOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgYWxpYXMgZm9yIHRoZSBk\nZXNjcmliZWQgdHlwZSwgb3IgPGNvZGU+bnVsbDwvY29kZT4gaWYgbm9uZQog\nICAgICogaGFzIGJlZW4gc2V0LgogICAgICogCiAgICAgKiBAc2VlICNzZXRU\neXBlQWxpYXMKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRUeXBlQWxp\nYXMoKSB7CiAgICAgICAgaWYgKF9hbGlhcyA9PSBudWxsKQogICAgICAgICAg\nICBfYWxpYXMgPSBTdHJpbmdzLmdldENsYXNzTmFtZShfdHlwZSk7CiAgICAg\nICAgcmV0dXJuIF9hbGlhczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMg\ndGhlIGFsaWFzIGZvciB0aGUgZGVzY3JpYmVkIHR5cGUuIFRoZSBhbGlhcyBj\nYW4gYmUKICAgICAqIGFueSBhcmJpdHJhcnkgc3RyaW5nIHRoYXQgdGhlIGlt\ncGxlbWVudGF0aW9uIGNhbiBsYXRlciB1c2UgdG8KICAgICAqIHJlZmVyIHRv\nIHRoZSBjbGFzcy4gTm90ZSB0aGF0IGF0IHJ1bnRpbWUsIG9ubHkgdGhlIGFs\naWFzCiAgICAgKiBjb21wdXRlZCB3aGVuIHRoZSBwZXJzaXN0ZW50IHR5cGUg\nd2FzIGVuaGFuY2VkIGlzIHVzZWQuCiAgICAgKgogICAgICogQHBhcmFtIGFs\naWFzIHRoZSBhbGlhcyBuYW1lIHRvIGFwcGx5IHRvIHRoZSBkZXNjcmliZWQg\ndHlwZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlQWxpYXMoU3Ry\naW5nIGFsaWFzKSB7CiAgICAgICAgX2FsaWFzID0gYWxpYXM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgYWNjZXNzIHR5cGUgdXNlZCBieSB0aGlzIGNs\nYXNzLiBFaXRoZXIge0BsaW5rICNBQ0NFU1NfRklFTER9CiAgICAgKiBvciB7\nQGxpbmsgI0FDQ0VTU19QUk9QRVJUWX0uCiAgICAgKi8KICAgIHB1YmxpYyBp\nbnQgZ2V0QWNjZXNzVHlwZSgpIHsKICAgICAgICBpZiAoX2FjY2Vzc1R5cGUg\nPT0gQUNDRVNTX1VOS05PV04pIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0\nYSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAg\nICBpZiAoc3VwICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\nLmdldEFjY2Vzc1R5cGUoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhRmFj\ndG9yeSgpLgogICAgICAgICAgICAgICAgICAgIGdldERlZmF1bHRzKCkuZ2V0\nRGVmYXVsdEFjY2Vzc1R5cGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gX2FjY2Vzc1R5cGU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgYWNjZXNzIHR5cGUgdXNlZCBieSB0aGlzIGNsYXNzLiBNdXN0\nIGJlIGVpdGhlcgogICAgICoge0BsaW5rICNBQ0NFU1NfRklFTER9IG9yIHtA\nbGluayAjQUNDRVNTX1BST1BFUlRZfS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0QWNjZXNzVHlwZShpbnQgdHlwZSkgewogICAgICAgIF9hY2Nlc3NU\neXBlID0gdHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhl\nIHR5cGUgcmVxdWlyZXMgZXh0ZW50IG1hbmFnZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGdldFJlcXVpcmVzRXh0ZW50KCkgewogICAgICAg\nIGlmIChfb3duZXIgIT0gbnVsbCB8fCBpc0VtYmVkZGVkT25seSgpKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChfZXh0ZW50ID09\nIG51bGwpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQ\nQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAoc3VwICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfZXh0ZW50ID0gKHN1cC5nZXRSZXF1\naXJlc0V4dGVudCgpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAgICAg\nICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgX2V4dGVudCA9IEJvb2xlYW4uVFJVRTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9leHRlbnQuYm9vbGVhblZhbHVlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHJlcXVpcmVzIGV4dGVu\ndCBtYW5hZ2VtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXF1\naXJlc0V4dGVudChib29sZWFuIHJlcSkgewogICAgICAgIF9leHRlbnQgPSAo\ncmVxKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGNhbiBvbmx5IGJlIHVz\nZWQgYXMgYW4gZW1iZWRkZWQgb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0VtYmVkZGVkT25seSgpIHsKICAgICAgICBpZiAoX2VtYmVk\nZGVkID09IG51bGwpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAg\nPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBpZiAo\nc3VwICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZW1iZWRkZWQgPSAoc3Vw\nLmlzRW1iZWRkZWRPbmx5KCkpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAg\nICAgICAgICAgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBfZW1iZWRkZWQgPSBCb29sZWFuLkZBTFNFOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2VtYmVkZGVkLmJvb2xlYW5WYWx1ZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSBjYW4g\nb25seSBiZSB1c2VkIGFzIGFuIGVtYmVkZGVkIG9iamVjdC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0RW1iZWRkZWRPbmx5KGJvb2xlYW4gZW1iZWQp\nIHsKICAgICAgICBfZW1iZWRkZWQgPSAoZW1iZWQpID8gQm9vbGVhbi5UUlVF\nIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIHR5cGUncyBmaWVsZHMgYXJlIGFjdGl2ZWx5IGludGVyY2VwdGVk\nLCBlaXRoZXIgYnkKICAgICAqIHJlZGVmaW5pdGlvbiBvciBlbmhhbmNlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNJbnRlcmNlcHRpbmco\nKSB7CiAgICAgICAgcmV0dXJuIF9pbnRlcmNlcHRpbmc7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlJ3MgZmllbGRzIGFyZSBhY3Rp\ndmVseSBpbnRlcmNlcHRlZCwgZWl0aGVyIGJ5CiAgICAgKiByZWRlZmluaXRp\nb24gb3IgZW5oYW5jZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEludGVyY2VwdGluZyhib29sZWFuIGludGVyY2VwdGluZykgewogICAgICAg\nIF9pbnRlcmNlcHRpbmcgPSBpbnRlcmNlcHRpbmc7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFuYWdlZCBpbnRlcmZh\nY2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZEludGVy\nZmFjZSgpIHsKICAgICAgICBpZiAoIV90eXBlLmlzSW50ZXJmYWNlKCkpCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX2ludGVy\nZmFjZSA9PSBudWxsID8gZmFsc2UgOiBfaW50ZXJmYWNlLmJvb2xlYW5WYWx1\nZSgpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSBp\ncyBhIG1hbmFnZWQgaW50ZXJmYWNlCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE1hbmFnZWRJbnRlcmZhY2UoYm9vbGVhbiBtYW5hZ2VkSW50ZXJmYWNl\nKSB7CiAgICAgICAgaWYgKCFfdHlwZS5pc0ludGVyZmFjZSgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\ndC1pbnRlcmZhY2UiLCBfdHlwZSkpOwogICAgICAgIF9pbnRlcmZhY2UgPSBt\nYW5hZ2VkSW50ZXJmYWNlID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxT\nRTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWFuYWdlZCBp\nbnRlcmZhY2UgaW1wbGVtZW50b3IgaWYgYW55LgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3MgZ2V0SW50ZXJmYWNlSW1wbCgpIHsKICAgICAgICByZXR1cm4g\nX2ltcGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG1hbmFnZWQg\naW50ZXJmYWNlIGltcGxlbWVudG9yIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRJbnRlcmZhY2VJbXBsKENsYXNzIGltcGwpIHsKICAgICAg\nICBfaW1wbCA9IGltcGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYWxsIGV4cGxpY2l0bHkgZGVjbGFyZWQgaW50ZXJmYWNlcyB0aGlzIGNsYXNz\nIGltcGxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1tdIGdldERl\nY2xhcmVkSW50ZXJmYWNlcygpIHsKICAgICAgICBpZiAoX2ludGVyZmFjZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRhUmVwb3NpdG9y\neS5FTVBUWV9DTEFTU0VTOwogICAgICAgIHJldHVybiAoQ2xhc3NbXSkgX2lu\ndGVyZmFjZXMudG9BcnJheShuZXcgQ2xhc3NbX2ludGVyZmFjZXMuc2l6ZSgp\nXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHBsaWNpdGx5IGRlY2xhcmUg\ndGhlIGdpdmVuIGludGVyZmFjZSBhbW9uZyB0aGUgb25lcyB0aGlzCiAgICAg\nKiBjbGFzcyBpbXBsZW1lbnRzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBh\nZGREZWNsYXJlZEludGVyZmFjZShDbGFzcyBpZmFjZSkgewogICAgICAgIGlm\nIChpZmFjZSA9PSBudWxsIHx8ICFpZmFjZS5pc0ludGVyZmFjZSgpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImRlY2xhcmUtbm9uLWludGVyZmFjZSIsCiAgICAgICAgICAgICAgICB0aGlz\nLCBpZmFjZSkpOwogICAgICAgIGlmIChfaW50ZXJmYWNlcyA9PSBudWxsKQog\nICAgICAgICAgICBfaW50ZXJmYWNlcyA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICBfaW50ZXJmYWNlcy5hZGQoaWZhY2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIHRoZSBnaXZlbiBpbnRlcmZhY2UgZnJvbSB0aGUgZGVj\nbGFyZWQgbGlzdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3Zl\nRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgICAgICBpZiAo\nX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIHJldHVybiBfaW50ZXJmYWNlcy5yZW1vdmUoaWZhY2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWxpYXMgcHJvcGVydGllcyBmcm9tIHRo\nZSBnaXZlbiBpbnRlcmZhY2UgZHVyaW5nICBxdWVyaWVzIHRvCiAgICAgKiB0\naGUgbG9jYWwgZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElu\ndGVyZmFjZVByb3BlcnR5QWxpYXMoQ2xhc3MgaWZhY2UsIFN0cmluZyBvcmln\nLCAKICAgICAgICBTdHJpbmcgbG9jYWwpIHsKICAgICAgICBzeW5jaHJvbml6\nZWQgKF9pZmFjZU1hcCkgewogICAgICAgICAgICBNYXAgZmllbGRzID0gKE1h\ncCkgX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVs\nZHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9pZmFjZU1hcC5wdXQoaWZhY2Us\nIGZpZWxkcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpZWxk\ncy5jb250YWluc0tleShvcmlnKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZHVwbGljYXRlLWlmYWNl\nLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgdGhpcywgb3JpZywgbG9j\nYWwpKTsKICAgICAgICAgICAgZmllbGRzLnB1dChvcmlnLCBsb2NhbCk7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldCBsb2NhbCBm\naWVsZCBhbGlhcyBmb3IgdGhlIGdpdmVuIGludGVyZmFjZSBwcm9wZXJ0eS4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJbnRlcmZhY2VQcm9wZXJ0\neUFsaWFzKENsYXNzIGlmYWNlLCBTdHJpbmcgb3JpZykgewogICAgICAgIHN5\nbmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAgICAgICAgIE1hcCBmaWVs\nZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAg\naWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKSBmaWVsZHMuZ2V0KG9y\naWcpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYWxsIGFsaWFzZXMgcHJvcGVydHkgbmFtZWQgZm9yIHRoZSBnaXZlbiBp\nbnRlcmZhY2UuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRJbnRl\ncmZhY2VBbGlhc2VkUHJvcGVydGllcyhDbGFzcyBpZmFjZSkgewogICAgICAg\nIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAgICAgICAgIE1hcCBm\naWVsZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAg\nICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIEVNUFRZX1NUUklOR19BUlJBWTsKICAgICAgICAgICAgcmV0dXJuIChTdHJp\nbmdbXSkgZmllbGRzLmtleVNldCgpLnRvQXJyYXkoCiAgICAgICAgICAgICAg\nICBuZXcgU3RyaW5nW2ZpZWxkcy5zaXplKCldKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgZmll\nbGRzIHRoYXQgdXNlIGltcGwgb3IgaW50ZXJtZWRpYXRlIGRhdGEsIGluCiAg\nICAgKiBvcmRlciB0byBjcmVhdGUgYSBjb21wYWN0ZWQgYXJyYXkgZm9yIHN0\nb3JhZ2Ugb2Ygc2FpZCBkYXRhLgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEV4dHJhRmllbGREYXRhTGVuZ3RoKCkgewogICAgICAgIGludFtdIHRhYmxl\nID0gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpOwogICAgICAgIGZvciAoaW50\nIGkgPSB0YWJsZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAg\nICAgaWYgKHRhYmxlW2ldICE9IC0xKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRhYmxlW2ldICsgMTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgaW1wbCAvIGludGVybWVkaWF0ZSBmaWVs\nZCBkYXRhIGluZGV4IG9mIHRoZSBnaXZlbiBmaWVsZAogICAgICogaW4gdGhl\nIGNvbXBhY3RlZCBhcnJheSwgb3IgLTEgaWYgdGhlIGZpZWxkIGRvZXMgbm90\nIHVzZSBleHRyYSBkYXRhLgogICAgICoKICAgICAqIEBzZWUgI2dldEV4dHJh\nRmllbGREYXRhTGVuZ3RoCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0\ncmFGaWVsZERhdGFJbmRleChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4g\nZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpW2ZpZWxkXTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZXMgYSB0YWJsZSBtYXBwaW5nIGVhY2ggZmllbGQg\naW5kZXggdG8gaXRzIGV4dHJhIGRhdGEgaW5kZXguCiAgICAgKi8KICAgIHBy\naXZhdGUgaW50W10gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpIHsKICAgICAg\nICBpZiAoX2ZpZWxkRGF0YVRhYmxlID09IG51bGwpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgaW50W10gdGFibGUgPSBuZXcgaW50W2ZtZHMubGVuZ3RoXTsKICAgICAg\nICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGZtZHNbaV0udXNlc0ludGVybWVkaWF0ZSgpCiAgICAgICAgICAgICAgICAg\nICAgfHwgZm1kc1tpXS51c2VzSW1wbERhdGEoKSAhPSBCb29sZWFuLkZBTFNF\nKQogICAgICAgICAgICAgICAgICAgIHRhYmxlW2ldID0gaWR4Kys7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGFibGVbaV0g\nPSAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfZmllbGREYXRhVGFi\nbGUgPSB0YWJsZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9maWVsZERh\ndGFUYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBuYW1lIHJlcHJlc2VudHMgYSBtYW5hZ2VkIG9yIHN0YXRp\nYyBmaWVsZCBvZgogICAgICogdGhpcyBjbGFzcywgaW5jbHVkaW5nIHN1cGVy\nY2xhc3MgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Fj\nY2Vzc2libGVGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAgICBpZiAoZ2V0\nRGVjbGFyZWRGaWVsZChmaWVsZCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgaWYgKF9zdGF0aWNGaWVsZHMgPT0gbnVsbCkg\newogICAgICAgICAgICBGaWVsZFtdIGZpZWxkcyA9IChGaWVsZFtdKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldERlY2xhcmVkRmllbGRzQWN0aW9uKF90eXBlKSk7\nIAogICAgICAgICAgICBTZXQgbmFtZXMgPSBuZXcgSGFzaFNldCgoaW50KSAo\nZmllbGRzLmxlbmd0aCAqIDEuMzMgKyAxKSk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgaWYgKE1vZGlmaWVyLmlzU3RhdGljKGZpZWxkc1tpXS5nZXRNb2Rp\nZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYWRkKGZpZWxk\nc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBfc3RhdGljRmllbGRzID0g\nbmFtZXM7CiAgICAgICAgfQogICAgICAgIGlmIChfc3RhdGljRmllbGRzLmNv\nbnRhaW5zKGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKS5pc0FjY2Vzc2libGVGaWVsZChmaWVs\nZCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGFsbCBmaWVsZCBtZXRhZGF0YXMsIGluY2x1ZGluZyBzdXBl\ncmNsYXNzIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURh\ndGFbXSBnZXRGaWVsZHMoKSB7CiAgICAgICAgaWYgKF9hbGxGaWVsZHMgPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfYWxsRmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsK\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBGaWVsZHMgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEZpZWxk\ncygpOwoKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBhbGxGaWVs\nZHMgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAg\nICAgICAgICAgKGZpZWxkcy5sZW5ndGggKyBzdXBGaWVsZHMubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoc3VwRmllbGRzLCAw\nLCBhbGxGaWVsZHMsIDAsIHN1cEZpZWxkcy5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgcmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKGFsbEZpZWxk\ncywgc3VwRmllbGRzLmxlbmd0aCk7CgogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBmaWVsZHNbaV0uc2V0SW5kZXgoc3VwRmllbGRzLmxlbmd0\naCArIGkpOwogICAgICAgICAgICAgICAgICAgIGFsbEZpZWxkc1tzdXBGaWVs\nZHMubGVuZ3RoICsgaV0gPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfYWxsRmllbGRzID0gYWxsRmllbGRzOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsRmllbGRz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSBzdXBlcmNsYXNzIGZp\nZWxkcyB0aGF0IHdlIGRlZmluZSB3aXRoIG91ciB2ZXJzaW9uLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmll\nbGRzKEZpZWxkTWV0YURhdGFbXSBmaWVsZHMsCiAgICAgICAgaW50IGxlbikg\newogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbCB8fCAhX2RlZlN1\ncEZpZWxkcykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBkb24n\ndCBhc3N1bWUgZmllbGRzIGFyZSBpbiBvcmRlcjsgdGhpcyBtZXRob2QgaXMg\ndXNlZCBmb3IKICAgICAgICAvLyBsaXN0aW5nIG9yZGVyIGFzIHdlbGwKICAg\nICAgICBGaWVsZE1ldGFEYXRhIHN1cEZpZWxkOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgc3VwRmllbGQg\nPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChmaWVsZHNbaV0u\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cEZpZWxkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZpZWxkc1tpXSA9IHN1cEZpZWxkOwogICAg\nICAgICAgICAgICAgc3VwRmllbGQuc2V0SW5kZXgoaSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHN1cGVyY2xhc3MgY29weSBvZiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhIGdldFN1cGVyY2xhc3NGaWVs\nZChGaWVsZE1ldGFEYXRhIHN1cEZpZWxkKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBzbSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBzbSA9PSBudWxsID8gbnVsbCA6IHNtLmdl\ndEZpZWxkKHN1cEZpZWxkLmdldE5hbWUoKSk7CiAgICAgICAgaWYgKGZtZCA9\nPSBudWxsIHx8IGZtZC5nZXRNYW5hZ2VtZW50KCkgIT0gZm1kLk1BTkFHRV9Q\nRVJTSVNURU5UKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoInVubWFuYWdlZC1zdXAtZmllbGQiLAogICAgICAg\nICAgICAgICAgc3VwRmllbGQsIHRoaXMpKTsKICAgICAgICByZXR1cm4gZm1k\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIG9ubHkgdGhlIGZpZWxk\ncyBmb3IgdGhpcyBjbGFzcywgd2l0aG91dCBzdXBlcmNsYXNzIGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJl\nZEZpZWxkcygpIHsKICAgICAgICBpZiAoX2ZpZWxkcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIExpc3QgZmllbGRzID0gbmV3IEFycmF5TGlzdChfZmllbGRN\nYXAuc2l6ZSgpKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2ZpZWxkTWFwLnZhbHVl\ncygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICBmbWQgPSAoRmllbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0\nYURhdGEuTUFOQUdFX05PTkUpIHsKICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0RGVjbGFyZWRJbmRleChmaWVsZHMuc2l6ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoZm1kLmdldEluZGV4KCkgPT0gLTEpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGZtZC5zZXRJbmRleChmbWQuZ2V0RGVjbGFyZWRJbmRl\neCgpKTsKICAgICAgICAgICAgICAgICAgICBmaWVsZHMuYWRkKGZtZCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Zp\nZWxkcyA9IChGaWVsZE1ldGFEYXRhW10pIGZpZWxkcy50b0FycmF5CiAgICAg\nICAgICAgICAgICAoX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheShmaWVs\nZHMuc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZmllbGRz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHByaW1hcnkga2V5IGZp\nZWxkcywgb3IgZW1wdHkgYXJyYXkgaWYgbm9uZS4gVGhlIG9yZGVyCiAgICAg\nKiBpbiB3aGljaCB0aGUga2V5cyBhcmUgcmV0dXJuZWQgd2lsbCBiZSB0aGUg\nb3JkZXIgaW4gd2hpY2gKICAgICAqIHRoZSBmaWVsZHMgYXJlIGRlY2xhcmVk\nLCBzdGFydGluZyBhdCB0aGUgbGVhc3QtZGVyaXZlZCBzdXBlcmNsYXNzCiAg\nICAgKiBhbmQgZW5kaW5nIHdpdGggdGhlIHByaW1hcnkga2V5IGZpZWxkcyBv\nZiB0aGUgbW9zdC1kZXJpdmVkIHN1YmNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YVtdIGdldFByaW1hcnlLZXlGaWVsZHMoKSB7CiAg\nICAgICAgLy8gY2hlY2sgZm9yIHBrIGZpZWxkcyBldmVuIGlmIG5vdCBzZXQg\ndG8gSURfQVBQTElDQVRJT04gc28gdGhhdAogICAgICAgIC8vIGFwcCBpZCB0\nb29sIHNlZXMgdGhlbSBldmVuIHdoZW4gdXNlciBkb2Vzbid0IGRlY2xhcmUg\nYXBwIGlkCiAgICAgICAgaWYgKF9hbGxQS0ZpZWxkcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMo\nKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgaWYgKGZpZWxkc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgICAgICAgICBudW0rKzsKCiAgICAgICAgICAgIGlmIChudW0gPT0gMCkK\nICAgICAgICAgICAgICAgIF9hbGxQS0ZpZWxkcyA9IF9yZXBvcy5FTVBUWV9G\nSUVMRFM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHBrcyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJy\nYXkobnVtKTsKICAgICAgICAgICAgICAgIG51bSA9IDA7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5\nS2V5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ldLnNl\ndFByaW1hcnlLZXlJbmRleChudW0pOwogICAgICAgICAgICAgICAgICAgICAg\nICBwa3NbbnVtXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAgICAgICAgICAg\nICAgbnVtKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgX2FsbFBLRmllbGRzID0gcGtzOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsUEtGaWVs\nZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2Yg\nZmllbGRzIGluIHRoZSBkZWZhdWx0IGZldGNoIGdyb3VwLAogICAgICogaW5j\nbHVkaW5nIHN1cGVyY2xhc3MgZmllbGRzLCBvciBhbiBlbXB0eSBhcnJheSBp\nZiBub25lLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdl\ndERlZmF1bHRGZXRjaEdyb3VwRmllbGRzKCkgewogICAgICAgIGlmIChfYWxs\nREZHRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgICAgICBpbnQgbnVt\nID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlz\nSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAgICAgICAgICAgICAgICAgIG51\nbSsrOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRmZ3MgPSBfcmVw\nb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51bSk7CiAgICAgICAgICAgIG51\nbSA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5p\nc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAgICAgICAgICBk\nZmdzW251bSsrXSA9IGZpZWxkc1tpXTsKICAgICAgICAgICAgX2FsbERGR0Zp\nZWxkcyA9IGRmZ3M7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsREZH\nRmllbGRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2ZXJz\naW9uIGZpZWxkIGZvciB0aGlzIGNsYXNzLCBpZiBhbnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldFZlcnNpb25GaWVsZCgpIHsKICAg\nICAgICBpZiAoX3ZlcnNpb25JZHggPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsK\nICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxk\ncygpOwogICAgICAgICAgICBpbnQgaWR4ID0gLTE7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzVmVyc2lvbigpKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIm11bHQtdmVycy1maWVs\nZHMiLCB0aGlzLCBmaWVsZHNbaWR4XSwgZmllbGRzW2ldKSk7CiAgICAgICAg\nICAgICAgICAgICAgaWR4ID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICBfdmVyc2lvbklkeCA9IGlkeDsKICAgICAg\nICB9CiAgICAgICAgaWYgKF92ZXJzaW9uSWR4ID09IC0xKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0RmllbGRzKClbX3Zl\ncnNpb25JZHhdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBt\nZXRhZGF0YSBmb3IgdGhlIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBm\naWVsZCB3aXRoCiAgICAgKiB0aGUgZ2l2ZW4gYWJzb2x1dGUgaW5kZXguCiAg\nICAgKgogICAgICogQHJldHVybiB0aGUgZmllbGQncyBtZXRhZGF0YSwgb3Ig\nbnVsbCBpZiBub3QgZm91bmQKICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGEgZ2V0RmllbGQoaW50IGluZGV4KSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAgICAgIGlmIChpbmRl\neCA8IDAgfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0aCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkc1tpbmRleF07CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0\naGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAg\nICAqIHRoZSBnaXZlbiByZWxhdGl2ZSBpbmRleC4KICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBm\nb3VuZAogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXREZWNs\nYXJlZEZpZWxkKGludCBpbmRleCkgewogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChp\nbmRleCA8IDAgfHwgaW5kZXggPj0gZmllbGRzLmxlbmd0aCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZpZWxkc1tpbmRleF07\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZv\nciB0aGUgcGVyc2lzdGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgK\nICAgICAqIHRoZSBnaXZlbiBuYW1lLgogICAgICoKICAgICAqIEByZXR1cm4g\ndGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldEZpZWxkKFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBnZXREZWNs\nYXJlZEZpZWxkKG5hbWUpOwogICAgICAgIGlmIChmbWQgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZtZDsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFw\nICE9IG51bGwgJiYgX2RlZlN1cEZpZWxkcykgewogICAgICAgICAgICBmbWQg\nPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAg\nICAgICAgICAgaWYgKGZtZCAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZtZDsKICAgICAgICB9CiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKS5nZXRGaWVsZChuYW1lKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBw\nZXJzaXN0ZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQgd2l0aAogICAgICog\ndGhlIGdpdmVuIG5hbWUsIHdpdGhvdXQgaW5jbHVkaW5nIHN1cGVyY2xhc3Mg\nZmllbGRzLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0\nYWRhdGEsIG9yIG51bGwgaWYgbm90IGZvdW5kCiAgICAgKi8KICAgIHB1Ymxp\nYyBGaWVsZE1ldGFEYXRhIGdldERlY2xhcmVkRmllbGQoU3RyaW5nIG5hbWUp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkID0gKEZpZWxkTWV0YURh\ndGEpIF9maWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKGZpZWxkID09\nIG51bGwgfHwgZmllbGQuZ2V0TWFuYWdlbWVudCgpID09IGZpZWxkLk1BTkFH\nRV9OT05FKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1\ncm4gZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW55IGZp\nZWxkcyB0aGF0IHdlcmUgYWRkZWQgYXMgbm9uLW1hbmFnZWQuCiAgICAgKiBB\nbGwgb3RoZXIgbWV0aG9kcyB0byBnZXQgZmllbGRzIHJldHVybiBvbmx5IHRo\nb3NlIHRoYXQgYXJlIG1hbmFnZWQuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVs\nZE1ldGFEYXRhW10gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKSB7CiAg\nICAgICAgaWYgKF91bm1nZEZpZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIENvbGxlY3Rpb24gdW5tYW5hZ2VkID0gbmV3IEFycmF5TGlzdCgzKTsKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZDsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBfZmllbGRNYXAudmFsdWVzKCkuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGZpZWxkID0g\nKEZpZWxkTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBp\nZiAoZmllbGQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFO\nQUdFX05PTkUpCiAgICAgICAgICAgICAgICAgICAgdW5tYW5hZ2VkLmFkZChm\naWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3VubWdkRmllbGRz\nID0gKEZpZWxkTWV0YURhdGFbXSkgdW5tYW5hZ2VkLnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KHVubWFu\nYWdlZC5zaXplKCkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF91bm1n\nZEZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG5ldyBmaWVs\nZCBtZXRhZGF0YSB0byB0aGlzIGNsYXNzLgogICAgICovCiAgICBwdWJsaWMg\nRmllbGRNZXRhRGF0YSBhZGREZWNsYXJlZEZpZWxkKFN0cmluZyBuYW1lLCBD\nbGFzcyB0eXBlKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfcmVw\nb3MubmV3RmllbGRNZXRhRGF0YShuYW1lLCB0eXBlLCB0aGlzKTsKICAgICAg\nICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRNYXAucHV0KG5h\nbWUsIGZtZCk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2VtZW50\nLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQgd2Fz\nIHJlbW92ZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVEZWNsYXJlZEZpZWxkKEZpZWxkTWV0YURhdGEgZmll\nbGQpIHsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAmJiBfZmllbGRNYXAu\ncmVtb3ZlKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAgICAgICAg\nICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgZGVmaW5lZCBzdXBlcmNsYXNzIGZpZWxk\nIHdpdGggdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVmaW5lZFN1cGVyY2xh\nc3NGaWVsZChTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfc3VwRmllbGRN\nYXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\ncmV0dXJuIChGaWVsZE1ldGFEYXRhKSBfc3VwRmllbGRNYXAuZ2V0KG5hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgbmV3IGRlZmluZWQgc3Vw\nZXJjbGFzcyBmaWVsZCBtZXRhZGF0YSB0byB0aGlzIGNsYXNzLgogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBhZGREZWZpbmVkU3VwZXJjbGFz\nc0ZpZWxkKFN0cmluZyBuYW1lLCBDbGFzcyB0eXBlLAogICAgICAgIENsYXNz\nIHN1cCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5l\nd0ZpZWxkTWV0YURhdGEobmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgZm1k\nLnNldERlY2xhcmluZ1R5cGUoc3VwKTsKICAgICAgICBjbGVhckFsbEZpZWxk\nQ2FjaGUoKTsKICAgICAgICBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICAg\nICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsKQogICAgICAgICAgICBfc3Vw\nRmllbGRNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgIF9zdXBGaWVsZE1h\ncC5wdXQobmFtZSwgZm1kKTsKICAgICAgICByZXR1cm4gZm1kOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBmaWVsZCBmcm9tIG1h\nbmFnZW1lbnQuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBm\naWVsZCB3YXMgcmVtb3ZlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZURlZmluZWRTdXBlcmNsYXNzRmllbGQo\nRmllbGRNZXRhRGF0YSBmaWVsZCkgewogICAgICAgIGlmIChmaWVsZCAhPSBu\ndWxsICYmIF9zdXBGaWVsZE1hcCAhPSBudWxsCiAgICAgICAgICAgICYmIF9z\ndXBGaWVsZE1hcC5yZW1vdmUoZmllbGQuZ2V0TmFtZSgpKSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGNsZWFyQWxsRmllbGRDYWNoZSgpOwogICAgICAgICAg\nICBfZGVmU3VwRmllbGRzID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBJbmNvcnBvcmF0ZSBzdXBlcmNsYXNzIGZpZWxkcyBy\nZWRlZmluZWQgaW4gdGhpcyBzdWJjbGFzcyBpbnRvIHRoaXMKICAgICAqIG1l\ndGFkYXRhLiBUaGlzIG1ldGhvZCBpcyBnZW5lcmFsbHkgY2FsbGVkIGFmdGVy\nIG1ldGFkYXRhIGlzIHJlc29sdmVkCiAgICAgKiBhbmQgbWFwcGluZyBpbmZv\ncm1hdGlvbiBpcyBsb2FkZWQsIGJ1dCBiZWZvcmUgbWFwcGluZyByZXNvbHZl\nLgogICAgICoKICAgICAqIEBwYXJhbSBmb3JjZSB3aGV0aGVyIHRvIGZvcmNl\nIHJlLW1hcHBpbmcgb2YgZXZlbiBtYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMK\nICAgICAqLwogICAgcHVibGljIHZvaWQgZGVmaW5lU3VwZXJjbGFzc0ZpZWxk\ncyhib29sZWFuIGZvcmNlKSB7CiAgICAgICAgaWYgKF9kZWZTdXBGaWVsZHMp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChp\nc01hcHBlZCgpICYmIHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHJl\nZGVmaW5lIGFsbCB1bm1hcHBlZCBzdXBlcmNsYXNzIGZpZWxkcwogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gc3VwcyA9IHN1cC5nZXRGaWVsZHMoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZvcmNlIHx8ICFzdXBzW2ld\nLmdldERlZmluaW5nTWV0YURhdGEoKS5pc01hcHBlZCgpKQogICAgICAgICAg\nICAgICAgICAgICYmIGdldERlZmluZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tp\nXS5nZXROYW1lKCkpID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBh\nZGREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0TmFtZSgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdldERlY2xhcmVkVHlw\nZSgpLCBzdXBzW2ldLmdldERlY2xhcmluZ1R5cGUoKSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzb2x2\nZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCk7CgogICAgICAgIC8vIHRoaXMg\nZW5zdXJlcyB0aGF0IGFsbCBmaWVsZCBpbmRleGVzIGdldCBzZXQgd2hlbiBm\naWVsZHMgYXJlIGNhY2hlZC4KICAgICAgICAvLyBJIGRvbid0IGxpa2UgZG9p\nbmcgdGhpcyB0d2ljZSAoaXQncyBhbHNvIGRvbmUgaW4gcmVzb2x2ZU1ldGEp\nLCBidXQKICAgICAgICAvLyB3ZSBoYXZlIHRvIHJlLWNhY2hlIGluIGNhc2Ug\ndGhpcyBjbGFzcyBvciBhbnkgc3VwZXJjbGFzcyByZXBsYWNlZAogICAgICAg\nIC8vIHNvbWUgZmllbGRzIHdpdGggcmVkZWZpbmVkIHZlcnNpb25zLCBhbmQg\nSSBkb24ndCB3YW50IG91dHNpZGUgY29kZQogICAgICAgIC8vIHRvIGhhdmUg\ndG8gY2FsbCB0aGlzIG1ldGhvZCBhZnRlciByZXNvbHZlIGp1c3QgdG8gZ2V0\nIGZpZWxkIGluZGV4ZXMsCiAgICAgICAgLy8gZXRjIHNldCBjb3JyZWN0bHkK\nICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBjYWNoZUZp\nZWxkcygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZSBzdXBlcmNs\nYXNzIGZpZWxkcyB3ZSd2ZSByZWRlZmluZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCByZXNvbHZlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMoKSB7CiAg\nICAgICAgX2RlZlN1cEZpZWxkcyA9IHRydWU7CiAgICAgICAgaWYgKF9zdXBG\naWVsZE1hcCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kOwogICAgICAgIEZpZWxkTWV0YURhdGEgc3Vw\nOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3N1cEZpZWxkTWFwLnZh\nbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIGZtZCA9IChGaWVsZE1ldGFEYXRhKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICBzdXAgPSBnZXRTdXBlcmNsYXNzRmllbGQoZm1kKTsKCiAgICAgICAg\nICAgIC8vIGpwYSBtZXRhZGF0YSBkb2Vzbid0IHF1YWxpZnkgc3VwZXJjbGFz\ncyBmaWVsZCBuYW1lcywgc28gd2UKICAgICAgICAgICAgLy8gbWlnaHQgbm90\nIGtub3cgdGhlIGRlY2xhcmluZyB0eXBlIHVudGlsIG5vdwogICAgICAgICAg\nICBpZiAoZm1kLmdldERlY2xhcmluZ1R5cGUoKSA9PSBPYmplY3QuY2xhc3Mp\nIHsKICAgICAgICAgICAgICAgIGZtZC5zZXREZWNsYXJpbmdUeXBlKHN1cC5n\nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgZm1kLmJhY2tp\nbmdNZW1iZXIoZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFEYXRhRmFjdG9yeSgp\nLgogICAgICAgICAgICAgICAgICAgIGdldERlZmF1bHRzKCkuZ2V0QmFja2lu\nZ01lbWJlcihmbWQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbWQu\nY29weShzdXApOwogICAgICAgICAgICBmbWQucmVzb2x2ZShNT0RFX01FVEEp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYW4g\nYXJyYXkgb2YgYWxsIHRoZSBmaWVsZHMgZGVmaW5lZCBieSB0aGlzIGNsYXNz\nLgogICAgICogVGhpcyBpbmNsdWRlcyBtYXBwZWQgZGVjbGFyZWQgZmllbGRz\nIGFuZCBhbnkgY29uY3JldGUgbWFwcGluZyBvZgogICAgICogdW5tYXBwZWQg\nc3VwZXJjbGFzcyBmaWVsZHMgcGVyZm9ybWVkIGJ5IHRoaXMgY2xhc3MuCiAg\nICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0RGVmaW5lZEZp\nZWxkcygpIHsKICAgICAgICBpZiAoX2RlZmluZWRGaWVsZHMgPT0gbnVsbCkg\newogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0Rmll\nbGRzKCk7CiAgICAgICAgICAgIExpc3QgZGVmaW5lZCA9IG5ldyBBcnJheUxp\nc3QoZmllbGRzLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBp\nZiAoZmllbGRzW2ldLmlzTWFwcGVkKCkKICAgICAgICAgICAgICAgICAgICAm\nJiBmaWVsZHNbaV0uZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09IHRoaXMpCiAg\nICAgICAgICAgICAgICAgICAgZGVmaW5lZC5hZGQoZmllbGRzW2ldKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IChGaWVs\nZE1ldGFEYXRhW10pIGRlZmluZWQudG9BcnJheQogICAgICAgICAgICAgICAg\nKF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkoZGVmaW5lZC5zaXplKCkp\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9kZWZpbmVkRmllbGRzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgZmllbGRzIGluIHRo\nZSBvcmRlciB0aGV5IGFyZSBsaXN0ZWQgaW4gdGhlIG1ldGFkYXRhCiAgICAg\nKiBmaWxlLiBVbmxpc3RlZCBmaWVsZHMgYXJlIHBsYWNlZCBhZnRlciBsaXN0\nZWQgb25lcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBn\nZXRGaWVsZHNJbkxpc3RpbmdPcmRlcigpIHsKICAgICAgICBpZiAoX2FsbExp\nc3RpbmdGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBjb21iaW5l\nIGRlY2xhcmVkIGFuZCB1bm1hbmFnZWQgZmllbGRzIGludG8gbGlzdGluZyBv\ncmRlciBhcnJheQogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZGVjID0g\nZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIHVubWdkID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVsZHMoKTsKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRlY0xpc3RpbmcgPSBfcmVwb3Mu\nbmV3RmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAoZGVjLmxl\nbmd0aCArIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkoZGVjLCAwLCBkZWNMaXN0aW5nLCAwLCBkZWMubGVuZ3RoKTsKICAg\nICAgICAgICAgU3lzdGVtLmFycmF5Y29weSh1bm1nZCwgMCwgZGVjTGlzdGlu\nZywgZGVjLmxlbmd0aCwgdW5tZ2QubGVuZ3RoKTsKICAgICAgICAgICAgQXJy\nYXlzLnNvcnQoZGVjTGlzdGluZywgTGlzdGluZ09yZGVyQ29tcGFyYXRvci5n\nZXRJbnN0YW5jZSgpKTsKCiAgICAgICAgICAgIGlmIChfc3VwZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9hbGxMaXN0aW5nRmllbGRzID0gZGVjTGlz\ndGluZzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBw\nbGFjZSBzdXBlcmNsYXNzIGZpZWxkcyBpbiBsaXN0aW5nIG9yZGVyIGJlZm9y\nZSBvdXIKICAgICAgICAgICAgICAgIC8vIGxpc3Rpbmctb3JkZXIgZGVjbGFy\nZWQgZmllbGRzCiAgICAgICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gc3Vw\nID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4KICAgICAgICAgICAgICAg\nICAgICBnZXRGaWVsZHNJbkxpc3RpbmdPcmRlcigpOwogICAgICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBfcmVwb3MubmV3RmllbGRN\nZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAgICAgKHN1cC5sZW5ndGgg\nKyBkZWNMaXN0aW5nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0u\nYXJyYXljb3B5KHN1cCwgMCwgbGlzdGluZywgMCwgc3VwLmxlbmd0aCk7CiAg\nICAgICAgICAgICAgICByZXBsYWNlRGVmaW5lZFN1cGVyY2xhc3NGaWVsZHMo\nbGlzdGluZywgc3VwLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBTeXN0ZW0u\nYXJyYXljb3B5KGRlY0xpc3RpbmcsIDAsIGxpc3RpbmcsIHN1cC5sZW5ndGgs\nCiAgICAgICAgICAgICAgICAgICAgZGVjTGlzdGluZy5sZW5ndGgpOwogICAg\nICAgICAgICAgICAgX2FsbExpc3RpbmdGaWVsZHMgPSBsaXN0aW5nOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsTGlzdGlu\nZ0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIGZp\nZWxkcyBkZWZpbmVkIGJ5IHRoaXMgY2xhc3MgaW4gdGhlIG9yZGVyIHRoZXkg\nYXJlIGxpc3RlZAogICAgICogaW4gdGhlIG1ldGFkYXRhIGZpbGUuIFVubGlz\ndGVkIGZpZWxkcyBhcmUgcGxhY2VkIGFmdGVyIGxpc3RlZCBvbmVzLgogICAg\nICogVGhpcyBhcnJheSBpbmNsdWRlcyBkZWNsYXJlZCB0cmFuc2FjdGlvbmFs\nIGFuZCB1bm1hbmFnZWQgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgRmll\nbGRNZXRhRGF0YVtdIGdldERlZmluZWRGaWVsZHNJbkxpc3RpbmdPcmRlcigp\nIHsKICAgICAgICBpZiAoX2xpc3RpbmdGaWVsZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7\nCiAgICAgICAgICAgIExpc3QgZGVmaW5lZCA9IG5ldyBBcnJheUxpc3QoZmll\nbGRzLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZpZWxk\nc1tpXS5nZXREZWZpbmluZ01ldGFEYXRhKCkgPT0gdGhpcykKICAgICAgICAg\nICAgICAgICAgICBkZWZpbmVkLmFkZChmaWVsZHNbaV0pOwogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhW10gdW5tZ2QgPSBnZXREZWNsYXJlZFVubWFuYWdl\nZEZpZWxkcygpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gbGlzdGlu\nZyA9IF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkKICAgICAgICAgICAg\nICAgIChkZWZpbmVkLnNpemUoKSArIHVubWdkLmxlbmd0aCk7CiAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVmaW5lZC5zaXplKCk7IGkrKykK\nICAgICAgICAgICAgICAgIGxpc3RpbmdbaV0gPSAoRmllbGRNZXRhRGF0YSkg\nZGVmaW5lZC5nZXQoaSk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHko\ndW5tZ2QsIDAsIGxpc3RpbmcsIGRlZmluZWQuc2l6ZSgpLCB1bm1nZC5sZW5n\ndGgpOwogICAgICAgICAgICBBcnJheXMuc29ydChsaXN0aW5nLCBMaXN0aW5n\nT3JkZXJDb21wYXJhdG9yLmdldEluc3RhbmNlKCkpOwogICAgICAgICAgICBf\nbGlzdGluZ0ZpZWxkcyA9IGxpc3Rpbmc7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfbGlzdGluZ0ZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIFRo\nZSBuYW1lIG9mIHRoZSBkYXRhY2FjaGUgdG8gdXNlIGZvciB0aGlzIGNsYXNz\nLiBJZiB0aGlzIGNsYXNzIGlzIG5vdAogICAgICogZWxpZ2libGUgZm9yIGNh\nY2hpbmcgYmFzZWQgaXRzIGFubm90YXRpb24gb3IgdGhlIGNhY2hlIGNvbmZp\nZ3VyYXRpb24KICAgICAqIG51bGwgd2lsbCBiZSByZXR1cm5lZC4KICAgICAq\nIAogICAgICogQHJldHVybiBUaGUgY2FjaGUgbmFtZSwgb3IgbnVsbCBpZiB0\naGlzIHR5cGUgc2hvdWxkIG5vdCBiZSBjYWNoZWQuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0RGF0YUNhY2hlTmFtZSgpIHsKICAgICAgICBpZiAo\nREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9jYWNoZU5hbWUpKSB7CiAgICAgICAg\nICAgIGlmIChfc3VwZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2Nh\nY2hlTmFtZSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RGF0YUNh\nY2hlTmFtZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgX2NhY2hlTmFtZSA9IERhdGFDYWNoZS5OQU1FX0RF\nRkFVTFQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIWlzQ2FjaGVh\nYmxlKCkpIHsgCiAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBudWxsOyAK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NhY2hl\nTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGUgbmFt\nZSBmb3IgdGhpcyBjbGFzcy4gU2V0IHRvIG51bGwgdG8gZGlzYWJsZSBjYWNo\naW5nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVOYW1l\nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgX2NhY2hlTmFtZSA9IG5hbWU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2FjaGUgdGltZW91dCBmb3IgdGhp\ncyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVvdXQuCiAgICAgKi8KICAg\nIHB1YmxpYyBpbnQgZ2V0RGF0YUNhY2hlVGltZW91dCgpIHsKICAgICAgICBp\nZiAoX2NhY2hlVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkgewogICAg\nICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nY2FjaGVUaW1lb3V0ID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4KICAg\nICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQgPSBf\ncmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAgICAg\nIGdldERhdGFDYWNoZVRpbWVvdXQoKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9jYWNoZVRpbWVvdXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nY2FjaGUgdGltZW91dCBmb3IgdGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5v\nIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGFDYWNo\nZVRpbWVvdXQoaW50IHRpbWVvdXQpIHsKICAgICAgICBfY2FjaGVUaW1lb3V0\nID0gdGltZW91dDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGF0YSBjYWNoZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBpZiBpdCBpcyBu\nb3QgY2FjaGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBEYXRhQ2FjaGUgZ2V0\nRGF0YUNhY2hlKCkgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RGF0YUNh\nY2hlTmFtZSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0Q29u\nZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgpLgog\nICAgICAgICAgICBnZXREYXRhQ2FjaGUobmFtZSwgdHJ1ZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIGluc3RhbmNlcyBhcmUgZGV0YWNoYWJs\nZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hhYmxlKCkg\newogICAgICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxsKSB7CiAgICAgICAg\nICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXRh\nY2hhYmxlID0gKGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNEZXRhY2hh\nYmxlKCkpCiAgICAgICAgICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBfZGV0YWNoYWJsZSA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfZGV0YWNoYWJsZS5ib29sZWFuVmFsdWUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRhY2hh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hhYmxlKGJv\nb2xlYW4gZGV0YWNoYWJsZSkgewogICAgICAgIF9kZXRhY2hhYmxlID0gKGRl\ndGFjaGFibGUpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3Rh\ndGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXREZXRhY2hlZFN0YXRlKCkgewogICAgICAgIGlmIChERUZB\nVUxUX1NUUklORy5lcXVhbHMoX2RldGFjaFN0YXRlKSkgewogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNEZXRh\nY2hhYmxlKCkgPT0gaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICBf\nZGV0YWNoU3RhdGUgPSBzdXAuZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gdXNlID0gdXNl\nc0RldGFjaGVkU3RhdGUoU1lOVEhFVElDLCB0cnVlKTsKICAgICAgICAgICAg\nICAgIF9kZXRhY2hTdGF0ZSA9IChCb29sZWFuLkZBTFNFLmVxdWFscyh1c2Up\nKSA/IG51bGwgOiBTWU5USEVUSUM7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQsIG9y\nIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGV0\nYWNoZWRTdGF0ZShTdHJpbmcgZmllbGQpIHsKICAgICAgICBfZGV0YWNoU3Rh\ndGUgPSBmaWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGV0YWNoIHN0YXRlIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8K\nICAgIHB1YmxpYyBGaWVsZCBnZXREZXRhY2hlZFN0YXRlRmllbGQoKSB7CiAg\nICAgICAgLy8gbm8gY2FjaGluZzsgb25seSB1c2VkIGF0IGVuaGFuY2VtZW50\nCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IGdldERldGFjaGVkU3RhdGUo\nKTsKICAgICAgICBpZiAoZmllbGROYW1lID09IG51bGwgfHwgU1lOVEhFVElD\nLmVxdWFscyhmaWVsZE5hbWUpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgRmllbGQgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKF90eXBl\nLCBmaWVsZE5hbWUsIGZhbHNlKTsKICAgICAgICBpZiAoZiAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZjsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbigKICAgICAgICAgICAgICAg\nIF9sb2MuZ2V0KCJuby1kZXRhY2gtc3RhdGUiLCBmaWVsZE5hbWUsIF90eXBl\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGFuIGluc3RhbmNl\nIG9mIHRoaXMgdHlwZSBoYXMgZGV0YWNoZWQgc3RhdGUuCiAgICAgKgogICAg\nICogQHJldHVybiB0cnVlIGlmIGEgZGV0YWNoZWQgaW5zdGFuY2UgbXVzdCBo\nYXZlIGRldGFjaGVkIHN0YXRlLCBmYWxzZQogICAgICogaWYgaXQgZG9lcyBu\nb3QsIGFuZCBudWxsIGlmIGl0IG1heSB1c2UgYQogICAgICogbWFudWFsbHkt\nY29uc3RydWN0ZWQgaW5zdGFuY2Ugd2l0aG91dCBkZXRhY2hlZCBzdGF0ZQog\nICAgICovCiAgICBwdWJsaWMgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZSgp\nIHsKICAgICAgICAvLyBubyBuZWVkIHRvIGxldCBjb25mIGRpc2FsbG93IGJl\nY2F1c2UgaXQncyB0YWtlbiBpbnRvIGFjY291bnQgaW4KICAgICAgICAvLyBn\nZXREZXRhY2hlZFN0YXRlKCkgY2FsbAogICAgICAgIHJldHVybiB1c2VzRGV0\nYWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0YXRlKCksIGZhbHNlKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhpcyB0\neXBlIGhhcyBkZXRhY2hlZCBzdGF0ZSwgYXNzdW1pbmcgdGhlIGdpdmVuCiAg\nICAgKiBkZXRhY2hlZCBzdGF0ZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgYSBkZXRhY2hlZCBpbnN0YW5jZSBtdXN0IGhhdmUgZGV0\nYWNoZWQgc3RhdGUsIGZhbHNlCiAgICAgKiBpZiBpdCBkb2VzIG5vdCwgYW5k\nIG51bGwgaWYgaXQgbWF5IHVzZSBhCiAgICAgKiBtYW51YWxseS1jb25zdHJ1\nY3RlZCBpbnN0YW5jZSB3aXRob3V0IGRldGFjaGVkIHN0YXRlCiAgICAgKi8K\nICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZShTdHJpbmcg\nZGV0YWNoZWRGaWVsZCwKICAgICAgICBib29sZWFuIGNvbmZEaXNhbGxvd3Mp\nIHsKICAgICAgICBpZiAoIWlzRGV0YWNoYWJsZSgpKQogICAgICAgICAgICBy\nZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgLy8gaWYgd2UgZGVjbGFy\nZSBhIGRldGFjaGVkIHN0YXRlIGZpZWxkLCBoYXZlIHRvIHVzZSBpdAogICAg\nICAgIGlmIChkZXRhY2hlZEZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIGlmICghU1lOVEhFVElDLmVx\ndWFscyhkZXRhY2hlZEZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uVFJVRTsKCiAgICAgICAgLy8gYWxsb3cgY29uZiB0byBkaXNhbGxvdwog\nICAgICAgIGlmIChjb25mRGlzYWxsb3dzICYmICFfcmVwb3MuZ2V0Q29uZmln\ndXJhdGlvbigpLgogICAgICAgICAgICBnZXREZXRhY2hTdGF0ZUluc3RhbmNl\nKCkuZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCkpCiAgICAgICAgICAgIHJldHVy\nbiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBoYXZlIHRvIHVzZSBkZXRh\nY2hlZCBzdGF0ZSB0byBzdG9yZSBkYXRhc3RvcmUgaWQKICAgICAgICBpZiAo\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gSURfREFUQVNUT1JFKQogICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBkZXRh\nY2hlZCBzdGF0ZSB1c2UsIGJ1dCBkb24ndCByZXF1aXJlCiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNoZWQg\nZmllbGQgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJB\nbGxGaWVsZENhY2hlKCkgewogICAgICAgIF9hbGxGaWVsZHMgPSBudWxsOwog\nICAgICAgIF9hbGxERkdGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxQS0Zp\nZWxkcyA9IG51bGw7CiAgICAgICAgX2RlZmluZWRGaWVsZHMgPSBudWxsOwog\nICAgICAgIF9saXN0aW5nRmllbGRzID0gbnVsbDsKICAgICAgICBfYWxsTGlz\ndGluZ0ZpZWxkcyA9IG51bGw7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxlID0g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGRlZmluZWQgZmll\nbGQgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZp\nbmVkRmllbGRDYWNoZSgpIHsKICAgICAgICBfZGVmaW5lZEZpZWxkcyA9IG51\nbGw7CiAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyRmllbGRDYWNoZSgpIHsKICAgICAg\nICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRzID0gbnVs\nbDsKICAgICAgICBfdW5tZ2RGaWVsZHMgPSBudWxsOwogICAgICAgIF92ZXJz\naW9uSWR4ID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDbGVhciBjYWNoZWQgc3ViY2xhc3MgZGF0YS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgY2xlYXJTdWJjbGFzc0NhY2hlKCkgewogICAgICAg\nIF9zdWJzID0gbnVsbDsKICAgICAgICBfc3ViTWV0YXMgPSBudWxsOwogICAg\nICAgIF9tYXBTdWJNZXRhcyA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbGVhciBpbXBsIGRhdGEgYW5kIGludGVybWVkaWF0ZSBkYXRhIHRhYmxl\nLgogICAgICovCiAgICB2b2lkIGNsZWFyRXh0cmFGaWVsZERhdGFUYWJsZSgp\nIHsKICAgICAgICBfZmllbGREYXRhVGFibGUgPSBudWxsOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2FjaGUgZmllbGQgYXJyYXlzLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgY2FjaGVGaWVsZHMoKSB7CiAgICAgICAgZ2V0RmllbGRz\nKCk7CiAgICAgICAgZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBl\nLmdldE5hbWUoKS5oYXNoQ29kZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIg\nPT0gdGhpcykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYg\nKCEob3RoZXIgaW5zdGFuY2VvZiBDbGFzc01ldGFEYXRhKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfdHlwZSA9PSAoKENs\nYXNzTWV0YURhdGEpIG90aGVyKS5nZXREZXNjcmliZWRUeXBlKCk7CiAgICB9\nCgogICAgcHVibGljIGludCBjb21wYXJlVG8oT2JqZWN0IG90aGVyKSB7CiAg\nICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiAw\nOwogICAgICAgIHJldHVybiBfdHlwZS5nZXROYW1lKCkuY29tcGFyZVRvKCgo\nQ2xhc3NNZXRhRGF0YSkgb3RoZXIpLgogICAgICAgICAgICBnZXREZXNjcmli\nZWRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiBnZXREZXNjcmliZWRUeXBl\nKCkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gUmVzb2x2ZSBhbmQgdmFsaWRhdGUKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogVGhlIHJlc29sdmUg\nbW9kZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRSZXNvbHZlKCkgewogICAgICAgIHJldHVybiBfcmVzTW9kZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRoaXMg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUo\naW50IG1vZGUpIHsKICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1ldGFk\nYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBt\nb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9O\nT05FKQogICAgICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICAgICAgZWxz\nZSBpZiAob24pCiAgICAgICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBfcmVzTW9kZSAmPSB+bW9kZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc29sdmUgYW5kIHZhbGlkYXRlIG1ldGFkYXRh\nLiBSZXR1cm4gdHJ1ZSBpZiBhbHJlYWR5IHJlc29sdmVkLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiByZXNvbHZlKGludCBtb2RlKSB7CiAgICAgICAg\naWYgKChfcmVzTW9kZSAmIG1vZGUpID09IG1vZGUpCiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIGludCBjdXIgPSBfcmVzTW9kZTsKICAgICAg\nICBfcmVzTW9kZSB8PSBtb2RlOwoKICAgICAgICBpbnQgdmFsID0gX3JlcG9z\nLmdldFZhbGlkYXRlKCk7CiAgICAgICAgYm9vbGVhbiBydW50aW1lID0gKHZh\nbCAmIF9yZXBvcy5WQUxJREFURV9SVU5USU1FKSAhPSAwOwogICAgICAgIGJv\nb2xlYW4gdmFsaWRhdGUgPQogICAgICAgICAgICAhSW1wbEhlbHBlci5pc01h\nbmFnZWRUeXBlKGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9uKCks\nIF90eXBlKQogICAgICAgICAgICB8fCAodmFsICYgTWV0YURhdGFSZXBvc2l0\nb3J5LlZBTElEQVRFX1VORU5IQU5DRUQpID09IDA7CgogICAgICAgIC8vIHdl\nIG9ubHkgZG8gYW55IGFjdGlvbnMgZm9yIG1ldGFkYXRhIG1vZGUKICAgICAg\nICBpZiAoKG1vZGUgJiBNT0RFX01FVEEpICE9IDAgJiYgKGN1ciAmIE1PREVf\nTUVUQSkgPT0gMCkgewogICAgICAgICAgICByZXNvbHZlTWV0YShydW50aW1l\nKTsKICAgICAgICAgICAgaWYgKHZhbGlkYXRlICYmICh2YWwgJiBfcmVwb3Mu\nVkFMSURBVEVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgICAgIHZhbGlkYXRl\nTWV0YShydW50aW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYg\nTU9ERV9NQVBQSU5HKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkcpID09\nIDApIHsKICAgICAgICAgICAgcmVzb2x2ZU1hcHBpbmcocnVudGltZSk7CiAg\nICAgICAgICAgIGlmICh2YWxpZGF0ZSAmJiAodmFsICYgX3JlcG9zLlZBTElE\nQVRFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU1h\ncHBpbmcocnVudGltZSk7CiAgICAgICAgfQogICAgICAgIGlmICgobW9kZSAm\nIE1PREVfTUFQUElOR19JTklUKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJ\nTkdfSU5JVCkgPT0gMCkKICAgICAgICAgICAgaW5pdGlhbGl6ZU1hcHBpbmco\nKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXNvbHZlIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZXNvbHZlTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBib29s\nZWFuIGVtYmVkID0gX293bmVyICE9IG51bGwgJiYgX293bmVyLmdldERlY2xh\ncmVkVHlwZSgpID09IF90eXBlOwogICAgICAgIExvZyBsb2cgPSBfcmVwb3Mu\nZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoKGVtYmVkKSA/ICJyZXNv\nbHZlLWVtYmVkLW1ldGEiIDogInJlc29sdmUtbWV0YSIsCiAgICAgICAgICAg\nICAgICB0aGlzICsgIkAiICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhp\ncykpKTsKCiAgICAgICAgaWYgKHJ1bnRpbWUgJiYgIV90eXBlLmlzSW50ZXJm\nYWNlKCkgJiYKICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNNYW5hZ2VkVHlw\nZShnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLF90eXBlKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJub3QtZW5oYW5jZWQiLCBfdHlwZSkpOwoKICAgICAgICAvLyBhcmUg\nd2UgdGhlIHRhcmdldCBvZiBhbiBlbWJlZGRlZCB2YWx1ZT8KICAgICAgICBp\nZiAoZW1iZWQpIHsKICAgICAgICAgICAgaWYgKF9vd25lci5nZXRGaWVsZE1l\ndGFEYXRhKCkuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAgICAg\nICAgZ2V0RGVzY3JpYmVkVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX3R5cGUp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJyZWN1cnNlLWVtYmVkIiwgX293bmVyKSk7CgogICAgICAg\nICAgICAvLyBjb3B5IGluZm8gZnJvbSB0aGUgInJlYWwiIG1ldGFkYXRhIGZv\nciB0aGlzIHR5cGUKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0g\nX3JlcG9zLmdldE1ldGFEYXRhKF90eXBlLCBfbG9hZGVyLCB0cnVlKTsKICAg\nICAgICAgICAgbWV0YS5yZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAgICAg\nIGNvcHkodGhpcywgbWV0YSk7CiAgICAgICAgICAgIF9lbWJlZGRlZCA9IEJv\nb2xlYW4uRkFMU0U7IC8vIGVtYmVkZGVkIGluc3RhbmNlIGlzbid0IGVtYmVk\nZGVkLW9ubHkKICAgICAgICB9CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBl\ncmNsYXNzIGlzIHJlc29sdmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAg\nPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAg\nIT0gbnVsbCkgewogICAgICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01FVEEp\nOwogICAgICAgICAgICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgICAgIC8v\nIGVtYmVkZGVkIGluc3RhbmNlIGFsd2F5cyByZWRlZmluZSBhbGwgc3VwZXJj\nbGFzcyBmaWVsZHMKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBz\ndXBzID0gc3VwLmdldEZpZWxkcygpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsCiAgICAgICAgICAg\nICAgICAgICAgICAgIHx8ICFfc3VwRmllbGRNYXAuY29udGFpbnNLZXkoc3Vw\nc1tpXS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFk\nZERlZmluZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5nZXROYW1lKCksCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdldERlY2xhcmVk\nVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5n\nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gcmVzb2x2ZSBmaWVsZHMgYW5kIHJlbW92ZSBpbnZhbGlkcwogICAg\nICAgIEZpZWxkTWV0YURhdGEgZm1kOwogICAgICAgIGZvciAoSXRlcmF0b3Ig\naXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIC8vIG9ubHkgcGFzcyBvbiBtZXRhZGF0\nYSByZXNvbHZlIG1vZGUgc28gdGhhdCBtZXRhZGF0YSBpcyBhbHdheXMKICAg\nICAgICAgICAgLy8gcmVzb2x2ZWQgYmVmb3JlIGFueSBvdGhlciByZXNvbHZl\nIG1vZGVzIG91ciBzdWJjbGFzc2VzIHBhc3MgYWxvbmcKICAgICAgICAgICAg\nZm1kID0gKEZpZWxkTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nIGZtZC5yZXNvbHZlKE1PREVfTUVUQSk7CgogICAgICAgICAgICBpZiAoIWZt\nZC5pc0V4cGxpY2l0KCkKICAgICAgICAgICAgICAgICYmIChmbWQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PQkpFQ1QKICAgICAgICAg\nICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5\ncGVzLlBDX1VOVFlQRUQKICAgICAgICAgICAgICAgIHx8IChmbWQuZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWQogICAgICAgICAg\nICAgICAgJiYgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkKICAgICAgICAgICAgICAgID09IEphdmFUeXBlcy5PQkpFQ1QpKSkgewog\nICAgICAgICAgICAgICAgX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5nZXQo\nInJtLWZpZWxkIiwgZm1kKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdl\ndExpc3RpbmdJbmRleCgpICE9IC0xKQogICAgICAgICAgICAgICAgICAgIGZt\nZC5zZXRNYW5hZ2VtZW50KGZtZC5NQU5BR0VfTk9ORSk7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwog\nICAgICAgICAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIGVtYmVkZGVkIGluc3RhbmNlcyBt\ndXN0IGVtYmVkIGFsbCBzdXBlcmNsYXNzIGZpZWxkcyB0b28KICAgICAgICBp\nZiAoZW1iZWQpIHsKICAgICAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7\nCiAgICAgICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkcygp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQgYWxs\nIGZpZWxkIGluZGV4ZXMgZ2V0IHNldCB3aGVuIGZpZWxkcyBhcmUgY2FjaGVk\nCiAgICAgICAgY2FjaGVGaWVsZHMoKTsKCiAgICAgICAgLy8gcmVzb2x2ZSBs\naWZlY3ljbGUgbWV0YWRhdGEgbm93IHRvIHByZXZlbnQgbGF6eSB0aHJlYWRp\nbmcgcHJvYmxlbXMKICAgICAgICBfbGlmZU1ldGEucmVzb2x2ZSgpOwoKICAg\nICAgICAvLyByZWNvcmQgaW1wbGVtZW50cyBpbiB0aGUgcmVwb3NpdG9yeQog\nICAgICAgIGlmIChfaW50ZXJmYWNlcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGZvciAoSXRlcmF0b3IgaXQgPSBfaW50ZXJmYWNlcy5pdGVyYXRvcigpOyBp\ndC5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgX3JlcG9zLmFkZERlY2xh\ncmVkSW50ZXJmYWNlSW1wbCh0aGlzLCAoQ2xhc3MpIGl0Lm5leHQoKSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyByZXNvbHZlIGZldGNoIGdyb3VwcwogICAg\nICAgIGlmIChfZmdNYXAgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBfZmdNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICAoKEZldGNoR3JvdXApIGl0ci5u\nZXh0KCkpLnJlc29sdmUoKTsKCiAgICAgICAgaWYgKCFlbWJlZCAmJiBfdHlw\nZS5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAgIGlmIChfaW50ZXJmYWNl\nICE9IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW50ZXJmYWNlIiwgX3R5cGUp\nKTsKCiAgICAgICAgICAgIGlmIChydW50aW1lKSB7CiAgICAgICAgICAgICAg\nICBfaW1wbCA9IF9yZXBvcy5nZXRJbXBsR2VuZXJhdG9yKCkuY3JlYXRlSW1w\nbCh0aGlzKTsKICAgICAgICAgICAgICAgIF9yZXBvcy5zZXRJbnRlcmZhY2VJ\nbXBsKHRoaXMsIF9pbXBsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgdGhpcyBpcyBydW50aW1lLCBjcmVhdGUgYSBwYyBpbnN0\nYW5jZSBhbmQgc2NhbiBpdCBmb3IgY29tcGFyYXRvcnMKICAgICAgICBpZiAo\ncnVudGltZSAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChfdHlwZS5nZXRNb2Rp\nZmllcnMoKSkpIHsKICAgICAgICAgICAgUHJveHlTZXR1cFN0YXRlTWFuYWdl\nciBzbSA9IG5ldyBQcm94eVNldHVwU3RhdGVNYW5hZ2VyKCk7CiAgICAgICAg\nICAgIHNtLnNldFByb3h5RGF0YShQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKF90\neXBlLCBzbSwgZmFsc2UpLCB0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBWYWxpZGF0ZSByZXNvbHZlZCBtZXRhZGF0YS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNZXRhKGJvb2xlYW4gcnVu\ndGltZSkgewogICAgICAgIHZhbGlkYXRlRGF0YUNhY2hlKCk7CiAgICAgICAg\ndmFsaWRhdGVEZXRhY2hhYmxlKCk7CiAgICAgICAgdmFsaWRhdGVFeHRlbnNp\nb25LZXlzKCk7CiAgICAgICAgdmFsaWRhdGVJZGVudGl0eSgpOwogICAgICAg\nIHZhbGlkYXRlQWNjZXNzVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVzb2x2ZSBtYXBwaW5nIGRhdGEuIExvZ3MgcmVzb2x2ZSBtZXNzYWdlIGFu\nZCByZXNvbHZlcyBzdXBlciBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCByZXNvbHZlTWFwcGluZyhib29sZWFuIHJ1bnRpbWUpIHsK\nICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlm\nIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJyZXNvbHZlLW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAg\nICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7\nCgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29sdmVk\nIGZpcnN0CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAg\nICAgICAgICAgc3VwLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFZhbGlkYXRlIG1hcHBpbmcgZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNYXBwaW5nKGJvb2xlYW4gcnVu\ndGltZSkgewogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBtYXBw\naW5nLiBMb2dzIGluaXQgbWVzc2FnZSBieSBkZWZhdWx0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFwcGluZygpIHsKICAgICAg\nICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChsb2cu\naXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2Mu\nZ2V0KCJpbml0LW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAgICAg\nICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBkYXRhIGNhY2hlIHNldHRpbmdzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVEYXRhQ2FjaGUoKSB7\nCiAgICAgICAgaW50IHRpbWVvdXQgPSBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7\nCiAgICAgICAgaWYgKHRpbWVvdXQgPCAtMSB8fCB0aW1lb3V0ID09IDApCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgiY2FjaGUtdGltZW91dC1pbnZhbGlkIiwKICAgICAgICAgICAgICAgIF90\neXBlLCBTdHJpbmcudmFsdWVPZih0aW1lb3V0KSkpOwoKICAgICAgICBpZiAo\nX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBT\ndHJpbmcgY2FjaGUgPSBnZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAgaWYg\nKGNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nU3RyaW5nIHN1cGVyQ2FjaGUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxz\nLmVxdWFscyhjYWNoZSwgc3VwZXJDYWNoZSkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtbmFtZXMi\nLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAgICAgIHsgX3R5cGUsIGNhY2hl\nLCBfc3VwZXIsIHN1cGVyQ2FjaGUgfSkpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXNzZXJ0IHRoYXQgdGhlIGlkZW50aXR5IGhhbmRsaW5nIGZvciB0aGlz\nIGNsYXNzIGlzIHZhbGlkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFs\naWRhdGVJZGVudGl0eSgpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgaWRlbnRp\ndHkgdHlwZXMgYXJlIGNvbnNpc3RlbnQKICAgICAgICBDbGFzc01ldGFEYXRh\nIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaW50\nIGlkID0gZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgaWYgKHN1cCAhPSBu\ndWxsICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOCiAg\nICAgICAgICAgICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJpZC10eXBlcyIsIF90eXBlKSk7CgogICAgICAgIC8vIGNoZWNrIGZvciB0\naGluZ3MgdGhlIGRhdGEgc3RvcmUgZG9lc24ndCBzdXBwb3J0CiAgICAgICAg\nQ29sbGVjdGlvbiBvcHRzID0gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5z\ndXBwb3J0ZWRPcHRpb25zKCk7CiAgICAgICAgaWYgKGlkID09IElEX0FQUExJ\nQ0FUSU9OCiAgICAgICAgICAgICYmICFvcHRzLmNvbnRhaW5zKE9wZW5KUEFD\nb25maWd1cmF0aW9uLk9QVElPTl9JRF9BUFBMSUNBVElPTikpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJhcHBpZC1ub3Qtc3VwcG9ydGVkIiwKICAgICAgICAgICAgICAgIF90eXBl\nKSk7CiAgICAgICAgfQogICAgICAgIGlmIChpZCA9PSBJRF9EQVRBU1RPUkUK\nICAgICAgICAgICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24uT1BUSU9OX0lEX0RBVEFTVE9SRSkpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAg\nICAgICAgICAoImRhdGFzdG9yZWlkLW5vdC1zdXBwb3J0ZWQiLCBfdHlwZSkp\nOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FUSU9O\nKSB7CiAgICAgICAgICAgIGlmIChfaWRTdHJhdGVneSAhPSBWYWx1ZVN0cmF0\nZWdpZXMuTk9ORSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYXBwaWQtc3RyYXRlZ3kiLCBfdHlwZSkp\nOwogICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3MoKTsKICAgICAgICB9\nIGVsc2UgaWYgKGlkICE9IElEX1VOS05PV04pCiAgICAgICAgICAgIHZhbGlk\nYXRlTm9QS0ZpZWxkcygpOwoKICAgICAgICBpbnQgc3RyYXRlZ3kgPSBnZXRJ\nZGVudGl0eVN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09IFZh\nbHVlU3RyYXRlZ2llcy5TRVFVRU5DRQogICAgICAgICAgICAmJiBnZXRJZGVu\ndGl0eVNlcXVlbmNlTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUi\nLCBfdHlwZSkpOwoKICAgICAgICBWYWx1ZVN0cmF0ZWdpZXMuYXNzZXJ0U3Vw\ncG9ydGVkKHN0cmF0ZWd5LCB0aGlzLAogICAgICAgICAgICAiZGF0YXN0b3Jl\nIGlkZW50aXR5IHN0cmF0ZWd5Iik7CiAgICB9CgogICAgLyoqCiAgICAgKiBN\nYWtlIHN1cmUgdGhlIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIGlzIHZh\nbGlkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJZENs\nYXNzKCkgewogICAgICAgIC8vIGJhc2UgdHlwZXMgbXVzdCBkZWNsYXJlIGFu\nIG9pZCBjbGFzcyBpZiBub3Qgc2luZ2xlLWZpZWxkIGlkZW50aXR5CiAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGdldFByaW1hcnlLZXlGaWVsZHMo\nKTsKICAgICAgICBpZiAoZ2V0T2JqZWN0SWRUeXBlKCkgPT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAocGtzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1\ncHBvcnRlZC1pZC10eXBlIiwKICAgICAgICAgICAgICAgICAgICBfdHlwZSwg\ncGtzWzBdLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBwa3NbMF0u\nZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8taWQtY2xh\nc3MiLCBfdHlwZSkpOwogICAgICAgIH0KICAgICAgICBpZiAoX29iamVjdElk\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGlz\nT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKHBrc1swXS5n\nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewogICAg\nICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrc1swXS5nZXRF\nbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFw\ncElkQ2xhc3NNZXRob2RzKGVtYmVkLmdldERlc2NyaWJlZFR5cGUoKSk7CiAg\nICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NQS3MoZW1iZWQsIGVt\nYmVkLmdldEZpZWxkcygpLAogICAgICAgICAgICAgICAgICAgIGVtYmVkLmdl\ndERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9zdXBlciAhPSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIGNvbmNyZXRlIHN1cGVyY2xhc3Mgb2lkcyBt\ndXN0IG1hdGNoIG9yIGJlIHBhcmVudCBvZiBvdXJzCiAgICAgICAgICAgIENs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICAgICAgQ2xhc3Mgb2JqZWN0SWRUeXBlID0gc3VwLmdldE9iamVj\ndElkVHlwZSgpOwogICAgICAgICAgICBpZiAob2JqZWN0SWRUeXBlICE9IG51\nbGwgJiYKICAgICAgICAgICAgICAgICFvYmplY3RJZFR5cGUuaXNBc3NpZ25h\nYmxlRnJvbShfb2JqZWN0SWQpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImlkLWNsYXNzZXMiLAog\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgX3R5cGUsIF9vYmpl\nY3RJZCwgX3N1cGVyLAogICAgICAgICAgICAgICAgICAgICAgICBzdXAuZ2V0\nT2JqZWN0SWRUeXBlKCkgfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyB2YWxpZGF0ZSB0aGF0IG5vIG90aGVyIHBrcyBhcmUgZGVjbGFyZWQg\naWYgd2UgaGF2ZSBhCiAgICAgICAgICAgIC8vIGNvbmNyZXRlIFBDIHN1cGVy\nY2xhc3MKICAgICAgICAgICAgaWYgKGhhc0NvbmNyZXRlUENTdXBlcmNsYXNz\nKCkpCiAgICAgICAgICAgICAgICB2YWxpZGF0ZU5vUEtGaWVsZHMoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgY2xhc3MgaGFzIGl0cyBvd24g\nb2lkIGNsYXNzLCBkbyBzb21lIG1vcmUgdmFsaWRhdGlvbgogICAgICAgIGlm\nIChfc3VwZXIgPT0gbnVsbAogICAgICAgICAgICB8fCBfb2JqZWN0SWQgIT0g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS5nZXRPYmplY3RJZFR5cGUoKSkg\newogICAgICAgICAgICAvLyBtYWtlIHN1cmUgbm9uLWFic3RyYWN0IG9pZCBj\nbGFzc2VzIG92ZXJyaWRlIHRoZSBwcm9wZXIgbWV0aG9kcwogICAgICAgICAg\nICBpZiAoIU1vZGlmaWVyLmlzQWJzdHJhY3QoX29iamVjdElkLmdldE1vZGlm\naWVycygpKSkKICAgICAgICAgICAgICAgIHZhbGlkYXRlQXBwSWRDbGFzc01l\ndGhvZHMoX29iamVjdElkKTsKCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0\naGUgYXBwIGlkIGNsYXNzIGhhcyBhbGwgcGsgZmllbGRzCiAgICAgICAgICAg\nIHZhbGlkYXRlQXBwSWRDbGFzc1BLcyh0aGlzLCBwa3MsIF9vYmplY3RJZCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUg\naWYgdGhpcyBjbGFzcyBoYXMgYSBjb25jcmV0ZSBwZXJzaXN0ZW50IHN1cGVy\nY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBoYXNDb25jcmV0\nZVBDU3VwZXJjbGFzcygpIHsKICAgICAgICBpZiAoX3N1cGVyID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIU1vZGlm\naWVyLmlzQWJzdHJhY3QoX3N1cGVyLmdldE1vZGlmaWVycygpKSkKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCkuaGFzQ29uY3JldGVQQ1N1cGVyY2xhc3MoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSB0aGF0IHRoZSB1c2VyIGhhcyBv\ndmVycmlkZGVuIHRoZSBlcXVhbHMgYW5kIGhhc2hDb2RlIG1ldGhvZHMsCiAg\nICAgKiBhbmQgaGFzIHRoZSBwcm9wZXIgY29uc3RydWN0b3JzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzTWV0aG9kcyhD\nbGFzcyBvaWQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBvaWQuZ2V0\nQ29uc3RydWN0b3IoKENsYXNzW10pIG51bGwpOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibnVsbC1jb25zIiwgX3R5cGUpKS4KICAg\nICAgICAgICAgICAgIHNldENhdXNlKGUpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gY2hlY2sgZm9yIGVxdWFscyBhbmQgaGFzaGNvZGUgb3ZlcnJpZGVzOyBk\nb24ndCBlbmZvcmNlIGl0CiAgICAgICAgLy8gZm9yIGFic3RyYWN0IGFwcCBp\nZCBjbGFzc2VzLCBzaW5jZSB0aGV5IG1heSBub3QgbmVjZXNzYXJpbHkKICAg\nICAgICAvLyBkZWNsYXJlIHByaW1hcnkga2V5IGZpZWxkcwogICAgICAgIE1l\ndGhvZCBtZXRob2Q7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9k\nID0gb2lkLmdldE1ldGhvZCgiZXF1YWxzIiwgbmV3IENsYXNzW117IE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKS5zZXRG\nYXRhbCh0cnVlKTsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gYWJzID0g\nTW9kaWZpZXIuaXNBYnN0cmFjdChfdHlwZS5nZXRNb2RpZmllcnMoKSk7CiAg\nICAgICAgaWYgKCFhYnMgJiYgbWV0aG9kLmdldERlY2xhcmluZ0NsYXNzKCkg\nPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImVxLW1ldGhvZCIsIF90eXBlKSk7Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1ldGhvZCA9IG9pZC5nZXRNZXRo\nb2QoImhhc2hDb2RlIiwgKENsYXNzW10pIG51bGwpOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUpOwogICAgICAgIH0KICAg\nICAgICBpZiAoIWFicyAmJiBtZXRob2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9\nPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiaGMtbWV0aG9kIiwgX3R5cGUpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIHByaW1hcnkg\na2V5IGNsYXNzIGhhcyBhbGwgcGsgZmllbGRzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgdmFsaWRhdGVBcHBJZENsYXNzUEtzKENsYXNzTWV0YURhdGEg\nbWV0YSwKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcywgQ2xhc3Mgb2lk\nKSB7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDAgJiYgIU1vZGlmaWVy\nLmlzQWJzdHJhY3QobWV0YS5nZXREZXNjcmliZWRUeXBlKCkuCiAgICAgICAg\nICAgIGdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1wayIsIF90eXBlKSk7Cgog\nICAgICAgIC8vIGNoZWNrIHRoYXQgdGhlIG9pZCB0eXBlIGNvbnRhaW5zIGFs\nbCBwayBmaWVsZHMKICAgICAgICBGaWVsZCBmOwogICAgICAgIE1ldGhvZCBt\nOwogICAgICAgIENsYXNzIGM7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGMg\nPSBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLmdldENvbXBvbmVudFR5cGUo\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYyA9PSBieXRlLmNsYXNzIHx8\nIGMgPT0gQnl0ZS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBj\nID09IGNoYXIuY2xhc3MgfHwgYyA9PSBDaGFyYWN0ZXIuY2xhc3MpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0uZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIG5v\nIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQ19VTlRZ\nUEVEOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDogLy8gd2UncmUgdmFsaWRh\ndGluZyBlbWJlZGRlZCBmaWVsZHMKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1way10eXBl\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgZm1kc1tpXSkpOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBjID0gZm1k\nc1tpXS5nZXRPYmplY3RJZEZpZWxkVHlwZSgpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAobWV0YS5nZXRBY2Nlc3NUeXBlKCkgPT0gQUNDRVNT\nX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICBmID0gUmVmbGVjdGlvbi5maW5k\nRmllbGQob2lkLCBmbWRzW2ldLmdldE5hbWUoKSwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgaWYgKGYgPT0gbnVsbCB8fCAhZi5nZXRUeXBlKCkuaXNBc3Np\nZ25hYmxlRnJvbShjKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQtaWQiLAogICAg\nICAgICAgICAgICAgICAgICAgICBfdHlwZSwgZm1kc1tpXS5nZXROYW1lKCkp\nKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUo\nKSA9PSBBQ0NFU1NfUFJPUEVSVFkpIHsKICAgICAgICAgICAgICAgIG0gPSBS\nZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkLCBmbWRzW2ldLmdldE5hbWUoKSwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCB8fCAhbS5n\nZXRSZXR1cm5UeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShjKSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImludmFsaWQtaWQiLAogICAgICAgICAgICAgICAgICAgICAgICBfdHlw\nZSwgZm1kc1tpXS5nZXROYW1lKCkpKTsKICAgICAgICAgICAgICAgIG0gPSBS\nZWZsZWN0aW9uLmZpbmRTZXR0ZXIob2lkLCBmbWRzW2ldLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldE9iamVjdElkRmllbGRU\neXBlKCksIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChtID09IG51bGwg\nfHwgbS5nZXRSZXR1cm5UeXBlKCkgIT0gdm9pZC5jbGFzcykKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImludmFsaWQtaWQiLAogICAgICAgICAgICAgICAgICAgICAgICBfdHlw\nZSwgZm1kc1tpXS5nZXROYW1lKCkpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhpcyBj\nbGFzcyBkb2Vzbid0IGRlY2xhcmUgYW55IHByaW1hcnkga2V5IGZpZWxkcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZhbGlkYXRlTm9QS0ZpZWxkcygp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RGVjbGFy\nZWRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc1By\naW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXBrIiwgZmllbGRzW2ldKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGlzIGNsYXNzJyBh\nY2Nlc3MgdHlwZSBpcyBhbGxvd2VkLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgdmFsaWRhdGVBY2Nlc3NUeXBlKCkgewogICAgICAgIGlmIChfYWNjZXNz\nVHlwZSA9PSBBQ0NFU1NfVU5LTk9XTikKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0\nYURhdGEoKTsKICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldEFj\nY2Vzc1R5cGUoKSAhPSBBQ0NFU1NfVU5LTk9XTgogICAgICAgICAgICAmJiBz\ndXAuZ2V0QWNjZXNzVHlwZSgpICE9IF9hY2Nlc3NUeXBlICYmCiAgICAgICAg\nICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0RmllbGRzKCkubGVu\nZ3RoID4gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImluY29uc2lzdGVudC1hY2Nlc3MiLAogICAgICAg\nICAgICAgICAgdGhpcywgc3VwKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQXNzZXJ0IHRoYXQgZGV0YWNobWVudCBjb25maWd1cmF0aW9u\nIGlzIHZhbGlkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVE\nZXRhY2hhYmxlKCkgewogICAgICAgIGJvb2xlYW4gZmlyc3QgPSB0cnVlOwog\nICAgICAgIGZvciAoQ2xhc3NNZXRhRGF0YSBwYXJlbnQgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICBmaXJzdCAmJiBwYXJlbnQg\nIT0gbnVsbDsgcGFyZW50ID0gcGFyZW50LmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkpCiAgICAgICAgewogICAgICAgICAgICBpZiAocGFyZW50LmlzRGV0\nYWNoYWJsZSgpKQogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAg\nICAgICB9CgogICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0RGV0YWNoZWRTdGF0\nZUZpZWxkKCk7CiAgICAgICAgaWYgKGZpZWxkICE9IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKCFmaXJzdCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicGFyZW50LWRldGFjaC1zdGF0\nZSIsCiAgICAgICAgICAgICAgICAgICAgX3R5cGUpKTsKICAgICAgICAgICAg\naWYgKGdldEZpZWxkKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibWFuYWdlZC1kZXRhY2gtc3RhdGUiLAogICAgICAgICAgICAgICAgICAg\nIGZpZWxkLmdldE5hbWUoKSwgX3R5cGUpKTsKICAgICAgICAgICAgaWYgKGZp\nZWxkLmdldFR5cGUoKSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1k\nZXRhY2gtc3RhdGUiLAogICAgICAgICAgICAgICAgICAgIGZpZWxkLmdldE5h\nbWUoKSwgX3R5cGUpKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vCiAgICAvLyBGZXRjaCBHcm91cAogICAgLy8vLy8vLy8vLy8vLy8v\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZldGNoIGdyb3VwcyBkZWNs\nYXJlZCBleHBsaWNpdGx5IGluIHRoaXMgdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIEZldGNoR3JvdXBbXSBnZXREZWNsYXJlZEZldGNoR3JvdXBzKCkgewog\nICAgICAgIGlmIChfZmdzID09IG51bGwpCiAgICAgICAgICAgIF9mZ3MgPSAo\nX2ZnTWFwID09IG51bGwpID8gRU1QVFlfRkVUQ0hfR1JPVVBfQVJSQVkgOiAo\nRmV0Y2hHcm91cFtdKQogICAgICAgICAgICAgICAgX2ZnTWFwLnZhbHVlcygp\nLnRvQXJyYXkobmV3IEZldGNoR3JvdXBbX2ZnTWFwLnNpemUoKV0pOyAKICAg\nICAgICByZXR1cm4gX2ZnczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhbGwgZmV0Y2ggZ3JvdXBzIGZvciB0aGlzIHR5cGUsIGluY2x1ZGluZyBz\ndXBlcmNsYXNzIGdyb3Vwcy4KICAgICAqLwogICAgcHVibGljIEZldGNoR3Jv\ndXBbXSBnZXRDdXN0b21GZXRjaEdyb3VwcygpIHsKICAgICAgICBpZiAoX2N1\nc3RvbUZHcyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG1hcCBmZ3MgdG8g\nbmFtZXMsIGFsbG93aW5nIG91ciBmZ3MgdG8gb3ZlcnJpZGUgc3VwZXJzCiAg\nICAgICAgICAgIE1hcCBmZ3MgPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAg\nICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRh\nKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAgICAgICAgICAg\newogICAgICAgICAgICAgICAgRmV0Y2hHcm91cFtdIHN1cEZHcyA9IHN1cC5n\nZXRDdXN0b21GZXRjaEdyb3VwcygpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzdXBGR3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICAgICAgZmdzLnB1dChzdXBGR3NbaV0uZ2V0TmFtZSgpLCBzdXBGR3Nb\naV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEZldGNoR3JvdXBbXSBk\nZWNzID0gZ2V0RGVjbGFyZWRGZXRjaEdyb3VwcygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGRlY3MubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBmZ3MucHV0KGRlY3NbaV0uZ2V0TmFtZSgpLCBkZWNzW2ldKTsK\nICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJlbW92ZSBzdGQgZ3JvdXBz\nCiAgICAgICAgICAgIGZncy5yZW1vdmUoRmV0Y2hHcm91cC5OQU1FX0RFRkFV\nTFQpOwogICAgICAgICAgICBmZ3MucmVtb3ZlKEZldGNoR3JvdXAuTkFNRV9B\nTEwpOwoKICAgICAgICAgICAgX2N1c3RvbUZHcyA9IChGZXRjaEdyb3VwW10p\nIGZncy52YWx1ZXMoKS50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IEZl\ndGNoR3JvdXBbZmdzLnNpemUoKV0pOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2N1c3RvbUZHczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldHMgYSBu\nYW1lZCBmZWN0aCBncm91cC4gSWYgbm90IGF2YWlsYWJsZSBpbiB0aGlzIHJl\nY2VpdmVyIHRoZW4gbG9va3MKICAgICAqIHVwIHRoZSBpbmhlcml0ZW5jZSBo\naWVyYXJjaHkuIAogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIG5hbWUgb2Yg\nYSBmZXRjaCBncm91cC4KICAgICAqIEByZXR1cm4gYW4gZXhpc3RpbmcgZmVj\ndGggZ3JvdXAgb2YgdGhlIGdpdmVuIG5hbWUgaWYga25vd24gdG8gdGhpcyAK\nICAgICAqIHJlY2VpdmVyIG9yIGFueSBvZiBpdHMgc3VwZXJjbGFzc2VzLiBP\ndGhlcndpc2UgbnVsbC4KICAgICAqLwogICAgcHVibGljIEZldGNoR3JvdXAg\nZ2V0RmV0Y2hHcm91cChTdHJpbmcgbmFtZSkgewogICAgICAgIEZldGNoR3Jv\ndXAgZmcgPSAoX2ZnTWFwID09IG51bGwpID8gbnVsbCA6IChGZXRjaEdyb3Vw\nKSBfZmdNYXAuZ2V0KG5hbWUpOwogICAgICAgIGlmIChmZyAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gZmc7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChz\ndXAgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHN1cC5nZXRGZXRjaEdy\nb3VwKG5hbWUpOwogICAgICAgIGlmIChGZXRjaEdyb3VwLk5BTUVfREVGQVVM\nVC5lcXVhbHMobmFtZSkpCiAgICAgICAgICAgIHJldHVybiBGZXRjaEdyb3Vw\nLkRFRkFVTFQ7CiAgICAgICAgaWYgKEZldGNoR3JvdXAuTkFNRV9BTEwuZXF1\nYWxzKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gRmV0Y2hHcm91cC5BTEw7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGRzIGZldGNoIGdyb3VwIG9mIHRoZSBnaXZlbiBuYW1lLCBvciByZXR1cm5z\nIGV4aXN0aW5nIGluc3RhbmNlLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1l\nIGEgbm9uLW51bGwsIG5vbi1lbXB0eSBuYW1lLiBNdXN0IGJlIHVuaXF1ZSB3\naXRoaW4gdGhpcwogICAgICogcmVjZWl2ZXIncyBzY29wZS4gVGhlIHN1cGVy\nIGNsYXNzIDxlbT5tYXk8L2VtPiBoYXZlIGEgZ3JvdXAgd2l0aAogICAgICog\ndGhlIHNhbWUgbmFtZS4KICAgICAqLwogICAgcHVibGljIEZldGNoR3JvdXAg\nYWRkRGVjbGFyZWRGZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7CiAgICAJaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAJCXRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZW1wdHktZmctbmFtZSIsIHRo\naXMpKTsKICAgICAgICBpZiAoX2ZnTWFwID09IG51bGwpCiAgICAgICAgICAg\nIF9mZ01hcCA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgRmV0Y2hHcm91cCBm\nZyA9IChGZXRjaEdyb3VwKSBfZmdNYXAuZ2V0KG5hbWUpOwogICAgICAgIGlm\nIChmZyA9PSBudWxsKSB7CiAgICAgICAgCWZnID0gbmV3IEZldGNoR3JvdXAo\ndGhpcywgbmFtZSk7CiAgICAgICAgCV9mZ01hcC5wdXQobmFtZSwgZmcpOwog\nICAgICAgICAgICBfZmdzID0gbnVsbDsKICAgICAgICAgICAgX2N1c3RvbUZH\ncyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmZzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSBhIGRlY2xhcmVkIGZldGNoIGdyb3Vw\nLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVEZWNsYXJlZEZl\ndGNoR3JvdXAoRmV0Y2hHcm91cCBmZykgewogICAgICAgIGlmIChmZyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9m\nZ01hcC5yZW1vdmUoZmcuZ2V0TmFtZSgpKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIF9mZ3MgPSBudWxsOwogICAgICAgICAgICBfY3VzdG9tRkdzID0gbnVs\nbDsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gU291cmNlVHJhY2tlcgogICAgLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAgIHJldHVy\nbiBfc3JjRmlsZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFNvdXJj\nZVNjb3BlKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgZ2V0U291cmNlVHlwZSgpIHsKICAgICAgICByZXR1cm4gX3Ny\nY1R5cGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U291cmNlKEZpbGUg\nZmlsZSwgaW50IHNyY1R5cGUpIHsKICAgICAgICBfc3JjRmlsZSA9IGZpbGU7\nCiAgICAgICAgX3NyY1R5cGUgPSBzcmNUeXBlOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0UmVzb3VyY2VOYW1lKCkgewogICAgICAgIHJldHVybiBf\ndHlwZS5nZXROYW1lKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc291\ncmNlIG1vZGUgdGhpcyBtZXRhZGF0YSBoYXMgYmVlbiBsb2FkZWQgdW5kZXIu\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0U291cmNlTW9kZSgpIHsKICAg\nICAgICByZXR1cm4gX3NyY01vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgc291cmNlIG1vZGUgdGhpcyBtZXRhZGF0YSBoYXMgYmVlbiBsb2FkZWQg\ndW5kZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFNvdXJjZU1vZGUo\naW50IG1vZGUpIHsKICAgICAgICBfc3JjTW9kZSA9IG1vZGU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgdGhpcyBtZXRhZGF0YSBo\nYXMgYmVlbiBsb2FkZWQgdW5kZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldFNvdXJjZU1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsKICAgICAg\nICBpZiAobW9kZSA9PSBNT0RFX05PTkUpCiAgICAgICAgICAgIF9zcmNNb2Rl\nID0gbW9kZTsKICAgICAgICBlbHNlIGlmIChvbikKICAgICAgICAgICAgX3Ny\nY01vZGUgfD0gbW9kZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zcmNN\nb2RlICY9IH5tb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIGluZGV4\nIGluIHdoaWNoIHRoaXMgY2xhc3Mgd2FzIGxpc3RlZCBpbiB0aGUgbWV0YWRh\ndGEuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT4tMTwvY29kZT4gaWYgdGhp\ncyBjbGFzcyB3YXMgbm90IGxpc3RlZCBpbiB0aGUgbWV0YWRhdGEuCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgZ2V0TGlzdGluZ0luZGV4KCkgewogICAgICAg\nIHJldHVybiBfbGlzdEluZGV4OwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIGluZGV4IGluIHdoaWNoIHRoaXMgZmllbGQgd2FzIGxpc3RlZCBpbiB0aGUg\nbWV0YWRhdGEuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT4tMTwvY29kZT4g\naWYgdGhpcyBjbGFzcyB3YXMgbm90IGxpc3RlZCBpbiB0aGUgbWV0YWRhdGEu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExpc3RpbmdJbmRleChpbnQg\naW5kZXgpIHsKICAgICAgICBfbGlzdEluZGV4ID0gaW5kZXg7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb21tZW50YWJsZQogICAgLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIFN0cmluZ1tdIGdldENvbW1lbnRz\nKCkgewogICAgICAgIHJldHVybiAoX2NvbW1lbnRzID09IG51bGwpID8gRU1Q\nVFlfQ09NTUVOVFMgOiBfY29tbWVudHM7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Q29tbWVudHMoU3RyaW5nW10gY29tbWVudHMpIHsKICAgICAgICBf\nY29tbWVudHMgPSBjb21tZW50czsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLwogICAgLy8gU3RhdGUgY29weQogICAgLy8vLy8vLy8vLy8vLy8KCiAgICAv\nKioKICAgICAqIENvcHkgdGhlIG1ldGFkYXRhIGZyb20gdGhlIGdpdmVuIGlu\nc3RhbmNlIHRvIHRoaXMgb25lLiBEbyBub3QKICAgICAqIGNvcHkgbWFwcGlu\nZyBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgY29weShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YS5nZXREZXNj\ncmliZWRUeXBlKCkgIT0gX3R5cGUpCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIHN1cGVyLmNvcHkobWV0YSk7\nCgogICAgICAgIC8vIGNvcHkgY2xhc3MtbGV2ZWwgaW5mbzsgdXNlIGdldCBt\nZXRob2RzIHRvIGZvcmNlIHJlc29sdXRpb24gb2YKICAgICAgICAvLyBsYXp5\nIGRhdGEKICAgICAgICBfc3VwZXIgPSBtZXRhLmdldFBDU3VwZXJjbGFzcygp\nOwogICAgICAgIF9vYmplY3RJZCA9IG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgX2V4dGVudCA9IChtZXRhLmdldFJlcXVpcmVzRXh0ZW50KCkp\nID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBfZW1i\nZWRkZWQgPSAobWV0YS5pc0VtYmVkZGVkT25seSgpKSA/IEJvb2xlYW4uVFJV\nRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgX2ludGVyZmFjZSA9IChtZXRh\nLmlzTWFuYWdlZEludGVyZmFjZSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xl\nYW4uRkFMU0U7CiAgICAgICAgX2ltcGwgPSBtZXRhLmdldEludGVyZmFjZUlt\ncGwoKTsKICAgICAgICBfaWRlbnRpdHkgPSBtZXRhLmdldElkZW50aXR5VHlw\nZSgpOwogICAgICAgIF9pZFN0cmF0ZWd5ID0gbWV0YS5nZXRJZGVudGl0eVN0\ncmF0ZWd5KCk7CiAgICAgICAgX3NlcU5hbWUgPSBtZXRhLmdldElkZW50aXR5\nU2VxdWVuY2VOYW1lKCk7CiAgICAgICAgX3NlcU1ldGEgPSBudWxsOwogICAg\nICAgIF9hbGlhcyA9IG1ldGEuZ2V0VHlwZUFsaWFzKCk7CiAgICAgICAgX2Fj\nY2Vzc1R5cGUgPSBtZXRhLmdldEFjY2Vzc1R5cGUoKTsKCiAgICAgICAgLy8g\nb25seSBjb3B5IHRoaXMgaW5mb3JtYXRpb24gaWYgaXQgd2Fzbid0IHNldCBl\neHBsaWNpdGx5IGZvciB0aGlzCiAgICAgICAgLy8gaW5zdGFuY2UKICAgICAg\nICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9jYWNoZU5hbWUpKQogICAg\nICAgICAgICBfY2FjaGVOYW1lID0gbWV0YS5nZXREYXRhQ2FjaGVOYW1lKCk7\nCiAgICAgICAgaWYgKF9jYWNoZVRpbWVvdXQgPT0gSW50ZWdlci5NSU5fVkFM\nVUUpCiAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQgPSBtZXRhLmdldERhdGFD\nYWNoZVRpbWVvdXQoKTsKICAgICAgICBpZiAoX2RldGFjaGFibGUgPT0gbnVs\nbCkKICAgICAgICAgICAgX2RldGFjaGFibGUgPSBtZXRhLl9kZXRhY2hhYmxl\nOwogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2RldGFjaFN0\nYXRlKSkKICAgICAgICAgICAgX2RldGFjaFN0YXRlID0gbWV0YS5nZXREZXRh\nY2hlZFN0YXRlKCk7CgogICAgICAgIC8vIHN5bmNoIGZpZWxkIGluZm9ybWF0\naW9uOyBmaXJzdCByZW1vdmUgZXh0cmEgZmllbGRzCiAgICAgICAgY2xlYXJG\naWVsZENhY2hlKCk7CiAgICAgICAgX2ZpZWxkTWFwLmtleVNldCgpLnJldGFp\nbkFsbChtZXRhLl9maWVsZE1hcC5rZXlTZXQoKSk7CgogICAgICAgIC8vIGFk\nZCBjb3BpZXMgb2YgZGVjbGFyZWQgZmllbGRzOyBvdGhlciBkZWZpbmVkIGZp\nZWxkcyBhbHJlYWR5IGNvcGllZAogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\naWVsZHMgPSBtZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmaWVsZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBmaWVsZCA9IGdl\ndERlY2xhcmVkRmllbGQoZmllbGRzW2ldLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgIGlmIChmaWVsZCA9PSBudWxsKQogICAgICAgICAgICAgICAgZmllbGQg\nPSBhZGREZWNsYXJlZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1lKCksCiAgICAg\nICAgICAgICAgICAgICAgZmllbGRzW2ldLmdldERlY2xhcmVkVHlwZSgpKTsK\nICAgICAgICAgICAgZmllbGQuc2V0RGVjbGFyZWRJbmRleCgtMSk7CiAgICAg\nICAgICAgIGZpZWxkLnNldEluZGV4KC0xKTsKICAgICAgICAgICAgZmllbGQu\nY29weShmaWVsZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgLy8gY29weSBm\nZXRjaCBncm91cHMKICAgICAgICBGZXRjaEdyb3VwW10gZmdzID0gbWV0YS5n\nZXREZWNsYXJlZEZldGNoR3JvdXBzKCk7CiAgICAgICAgRmV0Y2hHcm91cCBm\nZzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZncy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBmZyA9IGFkZERlY2xhcmVkRmV0Y2hHcm91cChm\nZ3NbaV0uZ2V0TmFtZSgpKTsKICAgICAgICAgICAgZmcuY29weShmZ3NbaV0p\nOyAKICAgICAgICB9CgogICAgICAgIC8vIGNvcHkgaWZhY2UgcmUtbWFwcGlu\nZwogICAgICAgIF9pZmFjZU1hcC5jbGVhcigpOwogICAgICAgIF9pZmFjZU1h\ncC5wdXRBbGwobWV0YS5faWZhY2VNYXApOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVjdXJzaXZlIGhlbHBlciB0byBjb3B5IGVtYmVkZGVkIG1ldGFkYXRh\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGNvcHkoQ2xhc3NN\nZXRhRGF0YSBlbWJlZCwgQ2xhc3NNZXRhRGF0YSBkZWMpIHsKICAgICAgICBD\nbGFzc01ldGFEYXRhIHN1cCA9IGRlYy5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICBl\nbWJlZC5zZXRQQ1N1cGVyY2xhc3Moc3VwLmdldERlc2NyaWJlZFR5cGUoKSk7\nCiAgICAgICAgICAgIGNvcHkoZW1iZWQuZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKSwgc3VwKTsKICAgICAgICB9CiAgICAgICAgZW1iZWQuY29weShkZWMp\nOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZEV4dGVuc2lvbktleXMo\nQ29sbGVjdGlvbiBleHRzKSB7CiAgICAgICAgX3JlcG9zLmdldE1ldGFEYXRh\nRmFjdG9yeSgpLmFkZENsYXNzRXh0ZW5zaW9uS2V5cyhleHRzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbXBhcmF0b3IgdXNlZCB0byBwdXQgZmllbGQg\nbWV0YWRhdGFzIGludG8gbGlzdGluZyBvcmRlci4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgTGlzdGluZ09yZGVyQ29tcGFyYXRvcgogICAg\nICAgIGltcGxlbWVudHMgQ29tcGFyYXRvciB7CgogICAgICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IgX2luc3RhbmNl\nCiAgICAgICAgICAgID0gbmV3IExpc3RpbmdPcmRlckNvbXBhcmF0b3IoKTsK\nCiAgICAgICAgLyoqCiAgICAgICAgICogQWNjZXNzIHNpbmdsZXRvbiBpbnN0\nYW5jZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgc3RhdGljIExpc3Rp\nbmdPcmRlckNvbXBhcmF0b3IgZ2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfaW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\naW50IGNvbXBhcmUoT2JqZWN0IG8xLCBPYmplY3QgbzIpIHsKICAgICAgICAg\nICAgaWYgKG8xID09IG8yKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAg\nICAgICAgICAgIGlmIChvMSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuIDE7CiAgICAgICAgICAgIGlmIChvMiA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIC0xOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBm\nMSA9IChGaWVsZE1ldGFEYXRhKSBvMTsKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YSBmMiA9IChGaWVsZE1ldGFEYXRhKSBvMjsKICAgICAgICAgICAgaWYg\nKGYxLmdldExpc3RpbmdJbmRleCgpID09IGYyLmdldExpc3RpbmdJbmRleCgp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoZjEuZ2V0SW5kZXgoKSA9PSBmMi5n\nZXRJbmRleCgpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmMS5nZXRG\ndWxsTmFtZShmYWxzZSkuY29tcGFyZVRvCiAgICAgICAgICAgICAgICAgICAg\nICAgIChmMi5nZXRGdWxsTmFtZShmYWxzZSkpOwoJCQkJaWYgKGYxLmdldElu\nZGV4ICgpID09IC0xKQoJCQkJCXJldHVybiAxOwoJCQkJaWYgKGYyLmdldElu\nZGV4ICgpID09IC0xKQoJCQkJCXJldHVybiAtMTsKCQkJCXJldHVybiBmMS5n\nZXRJbmRleCAoKSAtIGYyLmdldEluZGV4ICgpOwoJCQl9CQoJCQlpZiAoZjEu\nZ2V0TGlzdGluZ0luZGV4ICgpID09IC0xKQoJCQkJcmV0dXJuIDE7CgkJCWlm\nIChmMi5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJCQlyZXR1cm4gLTE7\nCgkJCXJldHVybiBmMS5nZXRMaXN0aW5nSW5kZXggKCkgLSBmMi5nZXRMaXN0\naW5nSW5kZXggKCk7CgkJfQoJfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5l\nIHdoZXRoZXIgdGhpcyBUeXBlIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUg\nRGF0YUNhY2hlIChpZiBvbmUKICAgICAqIGlzIHByb3ZpZGVkKSBiYXNlZCBv\nbiB0aGUgRGF0YUNhY2hlJ3MgY29uZmlndXJhdGlvbi4KICAgICAqIAogICAg\nICogQHJldHVybiB0cnVlIGlmIHRoZSBEYXRhQ2FjaGUgd2lsbCBhY2NlcHQg\ndGhpcyB0eXBlLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBpc0NhY2hlYWJsZSgpIHsKICAgICAgICBpZiAoX2lzQ2Fj\naGVhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIF9pc0NhY2hl\nYWJsZS5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgc2V0SXND\nYWNoZWFibGUodHJ1ZSwgZmFsc2UpOwogICAgICAgIHJldHVybiBfaXNDYWNo\nZWFibGUuYm9vbGVhblZhbHVlKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogPHA+CiAgICAgKiBTZXQgd2hldGhlciBvciBub3QgdGhlIGNsYXNzIHJl\ncHJlc2VudGVkIGJ5IHRoaXMgQ2xhc3NNZXRhRGF0YSBvYmplY3Qgc2hvdWxk\nIGJlIGluY2x1ZGVkIGluIHRoZSBkYXRhY2FjaGUuIFRoZQogICAgICogYXJn\ndW1lbnRzIHByb3ZpZGVkIGFyZSAqaGludHMqIGFzIHRvIHdoZXRoZXIgdGhl\nIGNsYXNzIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgZGF0YWNhY2hlLCBh\nbmQgY2FuIGJlIG92ZXJyaWRkZW4KICAgICAqIGJ5IHRoZSBjb25maWd1cmF0\naW9uIHNldCBpbiBvcGVuanBhLkRhdGFjYWNoZS4KICAgICAqIDwvcD4KICAg\nICAqIAogICAgICogPHA+CiAgICAgKiBSdWxlcyBmb3IgdGhpcyBkZXRlcm1p\nbmF0aW9uIGFyZToKICAgICAqIDwvcD4KICAgICAqIDxvbD4KICAgICAqIDxs\naT5JZiB0aGUgY2xhc3Mgc2hvd3MgdXAgaW4gdGhlIGxpc3Qgb2YgZXhjbHVk\nZWQgdHlwZXMsIGl0IGRvZXMgbm90IGdldCBjYWNoZWQsIHBlcmlvZC48L2xp\nPgogICAgICogPGxpPklmIHRoZSBjbGFzcyBkb2VzIG5vdCBzaG93IHVwIGlu\nIHRoZSBleGNsdWRlZCB0eXBlcywgYnV0IHRoZSBpbmNsdWRlZCB0eXBlcyBm\naWVsZCBpcyBzZXQgKGllLCBoYXMgYXQgbGVhc3QKICAgICAqIG9uZSBjbGFz\ncyksIHRoZW46CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+SWYgdGhlIGNsYXNz\nIGlzIGxpc3RlZCBpbiB0aGUgaW5jbHVkZSBsaXN0LCB0aGVuIGl0IGdldHMg\nY2FjaGVkPC9saT4KICAgICAqIDxsaT5JZiB0aGUgY2xhc3MgaXMgc2V0IGFz\nIGNhY2hlYWJsZSBieSB0aGUgQERhdGFjYWNoZSBhbm5vdGF0aW9uLCBpdCBn\nZXRzIGNhY2hlZDwvbGk+CiAgICAgKiA8bGk+SWYgbmVpdGhlciBhIG9yIGIg\nYXJlIHRydWUsIHRoZW4gdGhlIGNsYXNzIGRvZXMgbm90IGdldCBjYWNoZWQ8\nL2xpPgogICAgICogPC9vbD4KICAgICAqIDwvbGk+CiAgICAgKiA8bGk+SWYg\nbmVpdGhlciB0aGUgaW5jbHVkZSBvciBleGNsdWRlIGxpc3RzIGFyZSBkZWZp\nbmVkLCB0aGVuIGdvIGFsb25nIHdpdGggdGhlIHZhbHVlIHBhc3NlZCBpbnRv\nIHRoZSBhcmd1bWVudCwKICAgICAqIHdoaWNoIGlzIGVpdGhlciB0aGUgZGVm\nYXVsdCB2YWx1ZSAodHJ1ZSkgb3Igd2hhdGV2ZXIgd2FzIHNldCB3aXRoIHRo\nZSBARGF0YWNhY2hlIGFubm90YXRpb248L2xpPgogICAgICogPC9vbD4KICAg\nICAqIAogICAgICogQHBhcmFtIGlzQ2FjaGVhYmxlCiAgICAgKiAgICAgICAg\nICAgIEhpbnQgd2hldGhlciB0aGlzIGNsYXNzIHNob3VsZCBiZSBpbmNsdWRl\nZCBpbiB0aGUgZGF0YWNhY2hlLiBEZWZhdWx0IGJlaGF2aW9yIGlzIHllcywg\ndGhvdWdoIHRoZQogICAgICogICAgICAgICAgICBARGF0YWNhY2hlIGFubm90\nYXRpb24gY2FuIHNwZWNpZnkgaWYgaXQgc2hvdWxkIG5vdCBiZSBjYWNoZWQu\nCiAgICAgKiBAcGFyYW0gYW5ub3RhdGlvbk92ZXJyaWRlCiAgICAgKiAgICAg\nICAgICAgIFdoZXRoZXIgdGhpcyBoaW50IG9yaWdpbmF0ZWQgZnJvbSB0aGUg\nQERhdGFjYWNoZSBhbm5vdGF0aW9uIG9yIHdoZXRoZXIgdGhpcyBpcyB0aGUg\nZGVmYXVsdCAieWVzIiBoaW50LgogICAgICogICAgICAgICAgICBUaGUgb3Jp\nZ2luYXRpb24gb2YgdGhlIGhpbnQgaW5mbHVlbmNlcyB0aGUgZGVjaXNpb24g\nbWFraW5nIHByb2Nlc3MgaW4gcnVsZSAjMmIuCiAgICAgKiAKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0SXNDYWNoZWFibGUoYm9vbGVhbiBpc0NhY2hl\nYWJsZSwgYm9vbGVhbiBhbm5vdGF0aW9uT3ZlcnJpZGUpIHsKICAgICAgIE9w\ndGlvbnMgZGF0YUNhY2hlT3B0aW9ucyA9IGdldERhdGFDYWNoZU9wdGlvbnMo\nKTsKICAgICAgIFNldCBleGNsdWRlZFR5cGVzID0gZXh0cmFjdERhdGFDYWNo\nZUNsYXNzTGlzdGluZyhkYXRhQ2FjaGVPcHRpb25zLmdldFByb3BlcnR5KCJF\neGNsdWRlZFR5cGVzIiwgbnVsbCkpOwogICAgICAgU2V0IHR5cGVzID0gZXh0\ncmFjdERhdGFDYWNoZUNsYXNzTGlzdGluZyhkYXRhQ2FjaGVPcHRpb25zLmdl\ndFByb3BlcnR5KCJUeXBlcyIsIG51bGwpKTsKICAgICAgIAogICAgICAgU3Ry\naW5nIGNsYXNzTmFtZSA9IGdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCk7\nCiAgICAgICBpZiAoZXhjbHVkZWRUeXBlcyAhPSBudWxsICYmIGV4Y2x1ZGVk\nVHlwZXMuY29udGFpbnMoY2xhc3NOYW1lKSkgewogICAgICAgICAgIC8vIFJ1\nbGUgIzEKICAgICAgICAgICBfaXNDYWNoZWFibGUgPSBCb29sZWFuLkZBTFNF\nOwogICAgICAgfSBlbHNlIGlmICh0eXBlcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgLy8gUnVsZSAjMgogICAgICAgICAgIGlmICgoYW5ub3RhdGlvbk92ZXJy\naWRlICYmIGlzQ2FjaGVhYmxlKSB8fCAodHlwZXMuY29udGFpbnMoY2xhc3NO\nYW1lKSkpIHsKICAgICAgICAgICAgICAgX2lzQ2FjaGVhYmxlID0gQm9vbGVh\nbi5UUlVFOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIF9p\nc0NhY2hlYWJsZSA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgfQogICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAvLyBSdWxlICMzCiAgICAgICAgICAg\nX2lzQ2FjaGVhYmxlID0gaXNDYWNoZWFibGUgPyBCb29sZWFuLlRSVUUgOiBC\nb29sZWFuLkZBTFNFOwogICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAg\nICAqIEV4dHJhY3QgYWxsIG9mIHRoZSBEYXRhQ2FjaGUgcGx1Z2luIG9wdGlv\nbnMgZnJvbSB0aGUgY29uZmlndXJhdGlvbgogICAgICogCiAgICAgKi8KICAg\nIHByaXZhdGUgT3B0aW9ucyBnZXREYXRhQ2FjaGVPcHRpb25zKCkgewogICAg\nICAgU3RyaW5nIGRhdGFDYWNoZUNvbmZpZyA9IGdldFJlcG9zaXRvcnkoKS5n\nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGF0YUNhY2hlKCk7CiAgICAgICAgT3B0\naW9ucyBkYXRhQ2FjaGVPcHRpb25zID0gQ29uZmlndXJhdGlvbnMucGFyc2VQ\ncm9wZXJ0aWVzKENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMoZGF0YUNh\nY2hlQ29uZmlnKSk7CiAgICAgICAgcmV0dXJuIGRhdGFDYWNoZU9wdGlvbnM7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogVG9vbCB0byBleHRyYWN0IGNs\nYXNzZXMgZGVmaW5lZCBpbiB0aGUgZGF0YWNhY2hlIGluY2x1ZGUgYW5kIGV4\nY2x1ZGUgbGlzdCBpbnRvCiAgICAgKiBpbmRpdmlkdWFsIGVudHJpZXMgaW4g\nYSBTZXQuCiAgICAgKiAKICAgICAqLwogICAgcHJpdmF0ZSBmaW5hbCBTZXQg\nZXh0cmFjdERhdGFDYWNoZUNsYXNzTGlzdGluZyhTdHJpbmcgY2xhc3NMaXN0\nKSB7CiAgICAgICBpZiAoY2xhc3NMaXN0ID09IG51bGwgfHwgY2xhc3NMaXN0\nLmxlbmd0aCgpID09IDApIHsKICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgIH0KICAgICAgIAogICAgICAgSGFzaFNldCByZXR1cm5TZXQgPSBuZXcg\nSGFzaFNldCgpOwogICAgICAgU3RyaW5nW10gZW50cmllcyA9IGNsYXNzTGlz\ndC5zcGxpdCgiOyIpOwogICAgICAgZm9yIChpbnQgaW5kZXggPSAwOyBpbmRl\neCA8IGVudHJpZXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgcmV0\ndXJuU2V0LmFkZChlbnRyaWVzW2luZGV4XSk7CiAgICAgICB9CiAgICAgICBy\nZXR1cm4gcmV0dXJuU2V0OwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdHJ1ZSBpZiB0aGUgcGNUeXBlIG1vZGVsZWQgYnkgdGhpcyBDbGFz\nc01ldGFEYXRhCiAgICAgKiBvYmplY3QgaXMgYWJzdHJhY3QgKGllLCBhIE1h\ncHBlZFN1cGVyY2xhc3MgaW4gSlBBIHRlcm1zLikKICAgICAqIAogICAgICog\nQHJldHVybgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Fic3RyYWN0\nKCkgewogICAgICAgIHJldHVybiBfYWJzdHJhY3Q7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXRzIHRoZSB2YWx1ZSBkZXRlcm1pbmluZyBpZiB0aGUgcGNU\neXBlIG1vZGVsZWQgYnkgdGhpcwogICAgICogQ2xhc3NNZXRhRGF0YSBvYmpl\nY3QgaXMgYWJzdHJhY3QgKGllLCBhIE1hcHBlZFN1cGVyY2xhc3MgaW4gSlBB\nIHRlcm1zLikKICAgICAqIAogICAgICogQHJldHVybgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRBYnN0cmFjdChib29sZWFuIGZsYWcpIHsKICAgICAg\nICBfYWJzdHJhY3QgPSBmbGFnOwogICAgICAgIF9oYXNBYnN0cmFjdFBLRmll\nbGQgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIGRldGVybWluZSBpZiB0aGUgcGNUeXBlIG1vZGVsZWQgYnkK\nICAgICAqIHRoaXMgQ2xhc3NNZXRhRGF0YSBvYmplY3QgaXMgYm90aCBhYnN0\ncmFjdCBhbmQgZGVjbGFyZXMgUEtGaWVsZHMuIFRoaXMKICAgICAqIG1ldGhv\nZCBpcyB1c2VkIGJ5IHRoZSBQQ0VuaGFuY2VyIHRvIGRldGVybWluZSBpZiBz\ncGVjaWFsIGhhbmRsaW5nIGlzCiAgICAgKiByZXF1aXJlZC4KICAgICAqIAog\nICAgICogQHJldHVybgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNB\nYnN0cmFjdFBLRmllbGQoKSB7CiAgICAgICAgaWYgKF9oYXNBYnN0cmFjdFBL\nRmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gX2hhc0Fic3Ry\nYWN0UEtGaWVsZC5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9CgogICAgICAg\nIC8vIERlZmF1bHQgdG8gZmFsc2UsIHNldCB0byB0cnVlIG9ubHkgaWYgdGhp\ncyB0eXBlIGlzIGFic3RyYWN0IGFuZAogICAgICAgIC8vIGRlY2xhcmVzIGEg\nUEtGaWVsZC4KICAgICAgICBfaGFzQWJzdHJhY3RQS0ZpZWxkID0gQm9vbGVh\nbi5GQUxTRTsKCiAgICAgICAgaWYgKGlzQWJzdHJhY3QoKSA9PSB0cnVlKSB7\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBkZWNsYXJlZEZpZWxkcyA9\nIGdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgIGlmIChkZWNsYXJl\nZEZpZWxkcyAhPSBudWxsICYmIGRlY2xhcmVkRmllbGRzLmxlbmd0aCAhPSAw\nKSB7CiAgICAgICAgICAgICAgICBmb3IoaW50IGkgPSAwIDsgaSA8IGRlY2xh\ncmVkRmllbGRzLmxlbmd0aDsgaSArKykgewogICAgICAgICAgICAgICAgICAg\nIGlmIChkZWNsYXJlZEZpZWxkc1tpXS5pc1ByaW1hcnlLZXkoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBfaGFzQWJzdHJhY3RQS0ZpZWxkID0gQm9v\nbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBfaGFzQWJzdHJhY3RQ\nS0ZpZWxkLmJvb2xlYW5WYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVuaWVuY2UgbWV0aG9kIHRvIGRldGVybWluZSBpZiB0aGlzIHR5cGUg\naXMgYSBkaXJlY3QKICAgICAqIGRlY2VuZGVudCBvZiBhbiBhYnN0cmFjdCB0\neXBlIGRlY2xhcmluZyBQS0ZpZWxkcy4gUmV0dXJucyB0cnVlIGlmIHRoZXJl\nCiAgICAgKiBhcmUgbm8gcGNUeXBlcyBtYXBwZWQgdG8gYSB0YWJsZSBiZXR3\nZWVuIHRoaXMgdHlwZSBhbmQgYW4gYWJzdHJhY3QgcGNUeXBlCiAgICAgKiBk\nZWNsYXJpbmcgUEtGaWVsZHMuIFJldHVybnMgZmFsc2UgaWYgdGhlcmUgbm8g\nc3VjaCBhYnN0cmFjdCBwY1R5cGVzIGluCiAgICAgKiB0aGUgaW5oZXJpdGFu\nY2UgaGllcmFyY2h5IG9yIGlmIHRoZXJlIGFyZSBhbnkgcGNUeXBlcyBtYXBw\nZWQgdG8gdGFibGVzIGluCiAgICAgKiBiZXR3ZWVuIHRoZSB0eXBlIHJlcHJl\nc2VudGVkIGJ5IHRoaXMgQ2xhc3NNZXRhRGF0YSBvYmplY3QgYW5kIHRoZQog\nICAgICogYWJzdHJhY3QgcGNUeXBlIGRlY2xhcmluZyBQS0ZpZWxkcy4KICAg\nICAqIAogICAgICogQHJldHVybgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzKCkgewogICAgICAgIGlm\nIChfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFzcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgIHJldHVybiBfaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RDbGFz\ncy5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIERlZmF1\nbHQgdG8gRkFMU0UsIHVudGlsIHByb3ZlbiB0cnVlLgogICAgICAgIF9oYXNQ\nS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzID0gQm9vbGVhbi5GQUxTRTsKCiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIHBrRmllbGRzID0gZ2V0UHJpbWFyeUtl\neUZpZWxkcygpOwogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kOyAKICAgICAg\nICBmb3IoaW50IGkgPSAwIDsgaSA8IHBrRmllbGRzLmxlbmd0aDsgaSsrKSB7\nIAogICAgICAgICAgICBmbWQgPSBwa0ZpZWxkc1tpXTsKICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBmbWRETURBID0gZm1kLmdldERlY2xhcmluZ01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGlmIChmbWRETURBLmlzQWJzdHJhY3QoKSkg\newogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBjbWQgPSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgd2hpbGUgKGNt\nZCAhPSBmbWRETURBKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZtZERN\nREEuaXNBYnN0cmFjdCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNt\nZCA9IGNtZC5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGlmIChjbWQgPT0gZm1kRE1EQSkgewogICAgICAg\nICAgICAgICAgICAgIF9oYXNQS0ZpZWxkc0Zyb21BYnN0cmFjdENsYXNzID0g\nQm9vbGVhbi5UUlVFOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gX2hhc1BLRmllbGRzRnJvbUFic3RyYWN0Q2xhc3MuYm9vbGVh\nblZhbHVlKCk7CiAgICB9Cn0K\n","encoding":"base64"}

