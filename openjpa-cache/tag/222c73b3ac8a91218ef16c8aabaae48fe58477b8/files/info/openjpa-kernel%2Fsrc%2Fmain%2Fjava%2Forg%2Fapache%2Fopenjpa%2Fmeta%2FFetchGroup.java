{"sha":"d84345fea6d8e158bdf595d852c9611bf91d8920","node_id":"MDQ6QmxvYjIwNjM2NDpkODQzNDVmZWE2ZDhlMTU4YmRmNTk1ZDg1MmM5NjExYmY5MWQ4OTIw","size":12265,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d84345fea6d8e158bdf595d852c9611bf91d8920","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQg\namF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogQ2FwdHVyZXMg\nZmV0Y2ggZ3JvdXAgbWV0YWRhdGEuCiAqLwpwdWJsaWMgY2xhc3MgRmV0Y2hH\ncm91cCAKICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAvKioK\nICAgICAqIE5hbWUgb2YgdGhlIGRlZmF1bHQgZmV0Y2ggZ3JvdXAuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIE5BTUVfREVGQVVM\nVCA9ICJkZWZhdWx0IjsKCiAgICAvKioKICAgICAqIE5hbWUgb2YgdGhlICJh\nbGwiIGZldGNoIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIFN0cmluZyBOQU1FX0FMTCA9ICJhbGwiOwoKICAgIC8qKgogICAgICog\nRGVmYXVsdCBmaWVsZCByZWN1cnNpb24gZGVwdGguCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IFJFQ1VSU0lPTl9ERVBUSF9ERUZBVUxU\nID0gMTsKCiAgICAvKioKICAgICAqIEluZmluaXRlIGRlcHRoLgogICAgICov\nCglwdWJsaWMgc3RhdGljIGZpbmFsIGludCBERVBUSF9JTkZJTklURSA9IC0x\nOwoKICAgIC8qKgogICAgICogIFN0YW5kYXJkIGRlZmF1bHQgZmV0Y2ggZ3Jv\ndXAuCiAgICAgKi8KICAgIHN0YXRpYyBmaW5hbCBGZXRjaEdyb3VwIERFRkFV\nTFQgPSBuZXcgRmV0Y2hHcm91cChOQU1FX0RFRkFVTFQsIHRydWUpOwoKICAg\nIC8qKgogICAgICogIFN0YW5kYXJkICJhbGwiIGZldGNoIGdyb3VwLgogICAg\nICovCiAgICBzdGF0aWMgZmluYWwgRmV0Y2hHcm91cCBBTEwgPSBuZXcgRmV0\nY2hHcm91cChOQU1FX0FMTCwgZmFsc2UpOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoRmV0Y2hHcm91cC5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5h\nbCBTdHJpbmcgX25hbWU7CiAgICBwcml2YXRlIGZpbmFsIENsYXNzTWV0YURh\ndGEgX21ldGE7CiAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX3JlYWRPbmx5\nOwogICAgcHJpdmF0ZSBMaXN0IF9pbmNsdWRlczsKICAgIHByaXZhdGUgU2V0\nICBfY29udGFpbmVkQnk7CiAgICBwcml2YXRlIE1hcCBfZGVwdGhzOwogICAg\ncHJpdmF0ZSBCb29sZWFuIF9wb3N0TG9hZDsKCiAgICAvKioKICAgICAqIENv\nbnN0cnVjdG9yOyBzdXBwbHkgaW1tdXRhYmxlIG5hbWUuCiAgICAgKgogICAg\nICogQHBhcmFtIG5hbWUgbXVzdCBub3QgYnkgbnVsbCBvciBlbXB0eS4KICAg\nICAqLwogICAgRmV0Y2hHcm91cChDbGFzc01ldGFEYXRhIGNtLCBTdHJpbmcg\nbmFtZSkgewogICAgICAgIF9tZXRhID0gY207CiAgICAgICAgX25hbWUgPSBu\nYW1lOwogICAgICAgIF9yZWFkT25seSA9IGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogSW50ZXJuYWwgY29uc3RydWN0b3IgZm9yIGJ1aWx0aW4gZmV0\nY2ggZ3JvdXBzLgogICAgICovCiAgICBwcml2YXRlIEZldGNoR3JvdXAoU3Ry\naW5nIG5hbWUsIGJvb2xlYW4gcG9zdExvYWQpIHsKICAgICAgICBfbWV0YSA9\nIG51bGw7CiAgICAgICAgX25hbWUgPSBuYW1lOwogICAgICAgIF9wb3N0TG9h\nZCA9IChwb3N0TG9hZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgIF9yZWFkT25seSA9IHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb3B5IHN0YXRlIGZyb20gdGhlIGdpdmVuIGZldGNoIGdyb3VwLgog\nICAgICovCiAgICB2b2lkIGNvcHkoRmV0Y2hHcm91cCBmZykgewogICAgICAg\nIGlmIChmZy5faW5jbHVkZXMgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBmZy5faW5jbHVkZXMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICBhZGREZWNsYXJlZEluY2x1ZGUo\nKFN0cmluZykgaXRyLm5leHQoKSk7CiAgICAgICAgaWYgKGZnLl9jb250YWlu\nZWRCeSAhPSBudWxsKSAKICAgICAgICAJdGhpcy5fY29udGFpbmVkQnkgPSBu\nZXcgSGFzaFNldChmZy5fY29udGFpbmVkQnkpOwogICAgICAgIAogICAgICAg\nIGlmIChmZy5fZGVwdGhzICE9IG51bGwpIHsKICAgICAgICAgICAgTWFwLkVu\ndHJ5IGVudHJ5OwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGZn\nLl9kZXB0aHMuZW50cnlTZXQoKS5pdGVyYXRvcigpOyAKICAgICAgICAgICAg\nICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9\nIChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBzZXRS\nZWN1cnNpb25EZXB0aCgoRmllbGRNZXRhRGF0YSkgZW50cnkuZ2V0S2V5KCks\nICgoTnVtYmVyKSAKICAgICAgICAgICAgICAgICAgICBlbnRyeS5nZXRWYWx1\nZSgpKS5pbnRWYWx1ZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoZmcuX3Bvc3RMb2FkICE9IG51bGwpCiAgICAgICAgICAgIF9w\nb3N0TG9hZCA9IGZnLl9wb3N0TG9hZDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZldGNoIGdyb3VwIG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gX25hbWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJbmNsdWRlcyBnaXZlbiBmZXRjaCBncm91cCB3aXRoaW4g\ndGhpcyByZWNlaXZlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgYWRkRGVj\nbGFyZWRJbmNsdWRlKFN0cmluZyBmZ05hbWUpIHsKICAgICAgICBpZiAoX3Jl\nYWRPbmx5KQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVy\nYXRpb25FeGNlcHRpb24oKTsKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNF\nbXB0eShmZ05hbWUpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm51bGwtaW5jbHVkZS1mZyIsIHRoaXMpKTsK\nICAgICAgICBpZiAoX2luY2x1ZGVzID09IG51bGwpCiAgICAgICAgICAgIF9p\nbmNsdWRlcyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICBpZiAoIV9pbmNs\ndWRlcy5jb250YWlucyhmZ05hbWUpKQogICAgICAgICAgICBfaW5jbHVkZXMu\nYWRkKGZnTmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlm\nIGdpdmVuIGZldGNoIGdyb3VwIGlzIGluY2x1ZGVkIGJ5IHRoaXMgcmVjZWl2\nZXIuICBJbmNsdWRlcwogICAgICogc3VwZXJjbGFzcyBkZWZpbml0aW9uIG9m\nIGZldGNoIGdyb3VwIGFuZCBvcHRpb25hbGx5IG90aGVyIGluY2x1ZGVkIAog\nICAgICogZ3JvdXBzLgogICAgICoKICAgICAqIEBwYXJhbSByZWN1cnNlIGlm\nIHRydWUgdGhlbiByZWN1cnNpdmVseSBjaGVja3Mgd2l0aGluIHRoZSBpbmNs\ndWRlZAogICAgICogZmVjdGggZ3JvdXBzCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGluY2x1ZGVzKFN0cmluZyBmZ05hbWUsIGJvb2xlYW4gcmVjdXJz\nZSkgewogICAgICAgIC8vIGNoZWNrIG91ciBpbmNsdWRlcwogICAgICAgIGlm\nIChfaW5jbHVkZXMgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoX2luY2x1\nZGVzLmNvbnRhaW5zKGZnTmFtZSkpCiAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgaWYgKHJlY3Vyc2UgJiYgX21ldGEhPW51bGwp\nIHsKICAgICAgICAgICAgICAgIEZldGNoR3JvdXAgZmc7CiAgICAgICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGkgPSBfaW5jbHVkZXMuaXRlcmF0b3IoKTsg\naS5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICAgICAgZmcgPSBfbWV0\nYS5nZXRGZXRjaEdyb3VwKChTdHJpbmcpIGkubmV4dCgpKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoZmcgIT0gbnVsbCAmJiBmZy5pbmNsdWRlcyhmZ05h\nbWUsIHRydWUpKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAvLyBj\naGVjayBzdXBlcmNsYXNzIGluY2x1ZGVzCiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBGZXRjaEdyb3VwIHN1cEZHID0gc3VwLmdldEZldGNoR3JvdXAoX25hbWUp\nOwogICAgICAgICAgICAgICAgaWYgKHN1cEZHICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHN1cEZHLmluY2x1ZGVzKGZnTmFtZSwgcmVj\ndXJzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFkZHMgdGhpcyBy\nZWNlaXZlciBhcyBvbmUgb2YgdGhlIGluY2x1ZGVkIGZldGNoIGdyb3VwcyBv\nZiB0aGUgZ2l2ZW4KICAgICAqIHBhcmVudC4gCiAgICAgKiBUaGUgcGFyZW50\nIGZlY3RoIGdyb3VwIHdpbGwgaW5jbHVkZSB0aGlzIHJlY2VpdmVyIGFzIGEg\nc2lkZS1lZmZlY3Qgb2YKICAgICAqIHRoaXMgY2FsbC4KICAgICAqIAogICAg\nICogQHNlZSAjaW5jbHVkZXMoU3RyaW5nLCBib29sZWFuKQogICAgICogQHNl\nZSAjYWRkRGVjbGFyZWRJbmNsdWRlKFN0cmluZykgCiAgICAgKiAKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiBnaXZlbiBwYXJlbnQgaXMgYSBuZXcgYWRkaXRp\nb24uIGZhbHNlIG90aHJ3aXNlLgogICAgICogQHNpbmNlIDEuMS4xICAgCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGFkZENvbnRhaW5lZEJ5KEZldGNo\nR3JvdXAgcGFyZW50KSB7CiAgICAJcGFyZW50LmFkZERlY2xhcmVkSW5jbHVk\nZSh0aGlzLmdldE5hbWUoKSk7CiAgICAJaWYgKF9jb250YWluZWRCeT09bnVs\nbCkKICAgIAkJX2NvbnRhaW5lZEJ5ID0gbmV3IEhhc2hTZXQoKTsKICAgIAly\nZXR1cm4gX2NvbnRhaW5lZEJ5LmFkZChwYXJlbnQuZ2V0TmFtZSgpKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBuYW1lIG9mIHRoZSBm\nZXRjaCBncm91cHMgaW4gd2hpY2ggdGhpcyByZWNlaXZlciBoYXMgYmVlbgog\nICAgICogaW5jbHVkZWQuCiAgICAgKiAKICAgICAqIEBzZWUgI2FkZENvbnRh\naW5lZEJ5KEZldGNoR3JvdXApCiAgICAgKiBAc2luY2UgMS4xLjEgICAKICAg\nICAqLwogICAgcHVibGljIFNldCBnZXRDb250YWluZWRCeSgpIHsKICAgIAly\nZXR1cm4gKF9jb250YWluZWRCeSA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVN\nUFRZX1NFVCA6CiAgICAgICAgICAgIENvbGxlY3Rpb25zLnVubW9kaWZpYWJs\nZVNldChfY29udGFpbmVkQnkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBmZXRjaCBncm91cCBuYW1lcyBkZWNsYXJlZCBpbmNsdWRlZCBi\neSB0aGlzIGdyb3VwLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0\nRGVjbGFyZWRJbmNsdWRlcygpIHsKICAgICAgICAvLyBvbmx5IHVzZWQgZHVy\naW5nIHNlcmlhbGl6YXRpb247IG5vIG5lZWQgdG8gY2FjaGUKICAgICAgICBy\nZXR1cm4gKF9pbmNsdWRlcyA9PSBudWxsKSA/IG5ldyBTdHJpbmdbMF0KICAg\nICAgICAgICAgOiAoU3RyaW5nW10pIF9pbmNsdWRlcy50b0FycmF5KG5ldyBT\ndHJpbmdbX2luY2x1ZGVzLnNpemUoKV0pOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVjdXJzaW9uIGRlcHRoIGZvciB0aGUgZ2l2ZW4gZmllbGQuICBUaGlz\nIGlzIHRoZSBkZXB0aCBvZiByZWxhdGlvbnMgb2YKICAgICAqIHRoZSBzYW1l\nIGNsYXNzIGFzIHRoaXMgb25lIHdlIGNhbiBmZXRjaCB0aHJvdWdoIHRoZSBn\naXZlbiBmaWVsZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UmVjdXJz\naW9uRGVwdGgoRmllbGRNZXRhRGF0YSBmbSwgaW50IGRlcHRoKSB7CiAgICAg\nICAgaWYgKF9yZWFkT25seSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgaWYgKGRlcHRo\nIDwgLTEpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiaW52YWxpZC1mZy1kZXB0aCIsIF9uYW1lLCBmbSwgCiAg\nICAgICAgICAgICAgICBOdW1iZXJzLnZhbHVlT2YoZGVwdGgpKSk7CiAgICAg\nICAgaWYgKF9kZXB0aHMgPT0gbnVsbCkKICAgICAgICAgICAgX2RlcHRocyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2RlcHRocy5wdXQoZm0sIE51bWJl\ncnMudmFsdWVPZihkZXB0aCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVj\ndXJzaW9uIGRlcHRoIGZvciB0aGUgZ2l2ZW4gZmllbGQuICBUaGlzIGlzIHRo\nZSBkZXB0aCBvZiByZWxhdGlvbnMgb2YKICAgICAqIHRoZSBzYW1lIGNsYXNz\nIGFzIHRoaXMgb25lIHdlIGNhbiBmZXRjaCB0aHJvdWdoIHRoZSBnaXZlbiBm\naWVsZC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRSZWN1cnNpb25EZXB0\naChGaWVsZE1ldGFEYXRhIGZtKSB7CiAgICAgICAgTnVtYmVyIGRlcHRoID0g\nZmluZFJlY3Vyc2lvbkRlcHRoKGZtKTsKICAgICAgICByZXR1cm4gKGRlcHRo\nID09IG51bGwpID8gUkVDVVJTSU9OX0RFUFRIX0RFRkFVTFQgOiBkZXB0aC5p\nbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBy\nZWN1cnNpb24gZGVwdGggZGVjbGFyZWQgZm9yIHRoZSBnaXZlbiBmaWVsZCwg\nb3IgCiAgICAgKiAwIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0RGVjbGFyZWRSZWN1cnNpb25EZXB0aChGaWVsZE1ldGFEYXRhIGZtKSB7\nCiAgICAgICAgTnVtYmVyIGRlcHRoID0gKF9kZXB0aHMgPT0gbnVsbCkgPyBu\ndWxsIDogKE51bWJlcikgX2RlcHRocy5nZXQoZm0pOwogICAgICAgIHJldHVy\nbiAoZGVwdGggPT0gbnVsbCkgPyAwIDogZGVwdGguaW50VmFsdWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEhlbHBlciB0byBmaW5kIHJlY3Vyc2lvbiBk\nZXB0aCByZWN1cnNpdmVseSBpbiBvdXIgaW5jbHVkZXMuCiAgICAgKi8KICAg\nIHByaXZhdGUgTnVtYmVyIGZpbmRSZWN1cnNpb25EZXB0aChGaWVsZE1ldGFE\nYXRhIGZtKSB7IAogICAgICAgIE51bWJlciBkZXB0aCA9IChfZGVwdGhzID09\nIG51bGwpID8gbnVsbCA6IChOdW1iZXIpIF9kZXB0aHMuZ2V0KGZtKTsKICAg\nICAgICBpZiAoZGVwdGggIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGRl\ncHRoOwoKICAgICAgICAvLyBjaGVjayBmb3Igc3VwZXJjbGFzcyBkZWNsYXJh\ndGlvbiBvZiBkZXB0aAogICAgICAgIE51bWJlciBtYXggPSBudWxsOwogICAg\nICAgIGlmIChfbWV0YSAhPSBudWxsICYmIGZtLmdldERlY2xhcmluZ01ldGFE\nYXRhKCkgIT0gX21ldGEpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAg\nICAgICBpZiAoc3VwICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEZldGNo\nR3JvdXAgc3VwRkcgPSBzdXAuZ2V0RmV0Y2hHcm91cChfbmFtZSk7CiAgICAg\nICAgICAgICAgICBpZiAoc3VwRkcgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBtYXggPSBzdXBGRy5maW5kUmVjdXJzaW9uRGVwdGgoZm0pOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChfaW5jbHVkZXMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1heDsKCiAgICAgICAgLy8gZmlu\nZCBsYXJnZXN0IGluY2x1ZGVkIGRlcHRoCiAgICAgICAgRmV0Y2hHcm91cCBm\nZzsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9pbmNsdWRlcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBmZyA9IF9t\nZXRhLmdldEZldGNoR3JvdXAoKFN0cmluZykgaXRyLm5leHQoKSk7CiAgICAg\nICAgICAgIGRlcHRoID0gKGZnID09IG51bGwpID8gbnVsbCA6IGZnLmZpbmRS\nZWN1cnNpb25EZXB0aChmbSk7CiAgICAgICAgICAgIGlmIChkZXB0aCAhPSBu\ndWxsICYmIChtYXggPT0gbnVsbCAKICAgICAgICAgICAgICAgIHx8IGRlcHRo\nLmludFZhbHVlKCkgPiBtYXguaW50VmFsdWUoKSkpCiAgICAgICAgICAgICAg\nICBtYXggPSBkZXB0aDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1heDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGRzIHdpdGgg\nZGVjbGFyZWQgcmVjdXJzaW9uIGRlcHRocyBpbiB0aGlzIGdyb3VwLgogICAg\nICovCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlY2xhcmVkUmVj\ndXJzaW9uRGVwdGhGaWVsZHMoKSB7CiAgICAgICAgLy8gdXNlZCBpbiBzZXJp\nYWxpemF0aW9uIG9ubHk7IG5vIG5lZWQgdG8gY2FjaGUKICAgICAgICBpZiAo\nX2RlcHRocyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxk\nTWV0YURhdGFbMF07CiAgICAgICAgIHJldHVybiAoRmllbGRNZXRhRGF0YVtd\nKSBfZGVwdGhzLmtleVNldCgpLnRvQXJyYXkKICAgICAgICAgICAgKG5ldyBG\naWVsZE1ldGFEYXRhW19kZXB0aHMuc2l6ZSgpXSk7CiAgICB9IAoKICAgIC8q\nKgogICAgICogV2hldGhlciBsb2FkaW5nIHRoaXMgZmV0Y2ggZ3JvdXAgY2F1\nc2VzIGEgcG9zdC1sb2FkIGNhbGxiYWNrIG9uIHRoZQogICAgICogbG9hZGVk\nIGluc3RhbmNlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQb3N0TG9h\nZCAoYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgaWYgKF9yZWFkT25seSAmJiBm\nbGFnICE9IGlzUG9zdExvYWQoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAJX3Bvc3RMb2Fk\nID0gKGZsYWcpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgbG9hZGluZyB0aGlzIGZldGNo\nIGdyb3VwIGNhdXNlcyBhIHBvc3QtbG9hZCBjYWxsYmFjayBvbiB0aGUKICAg\nICAqIGxvYWRlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNQb3N0TG9hZCAoKSB7CiAgICAJaWYgKF9wb3N0TG9hZCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gX3Bvc3RMb2FkLmJvb2xlYW5WYWx1ZSgp\nOwoKICAgICAgICBpZiAoX21ldGEgIT0gbnVsbCkgewogICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIHN1cCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgRmV0Y2hHcm91cCBzdXBGRyA9IHN1cC5nZXRGZXRjaEdyb3Vw\nKF9uYW1lKTsKICAgICAgICAgICAgICAgIGlmIChzdXBGRyAhPSBudWxsICYm\nIHN1cEZHLmlzUG9zdExvYWQoKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKF9pbmNsdWRlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgRmV0Y2hHcm91cCBmZzsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9pbmNsdWRlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBmZyA9IF9tZXRhLmdldEZldGNoR3JvdXAoKFN0cmlu\nZykgaXRyLm5leHQoKSk7CiAgICAgICAgICAgIGlmIChmZyAhPSBudWxsICYm\nIGZnLmlzUG9zdExvYWQoKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBwb3N0LWxvYWQgdmFsdWUgaXMgZGVj\nbGFyZWQgZm9yIHRoaXMgZ3JvdXAuICAKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaXNQb3N0TG9hZEV4cGxpY2l0KCkgewogICAgICAgIHJldHVybiBf\ncG9zdExvYWQgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc29s\ndmUgYW5kIHZhbGlkYXRlIGZldGNoIGdyb3VwIG1ldGFkYXRhLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCByZXNvbHZlKCkgewogICAgICAgIGlmIChfaW5j\nbHVkZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAv\nLyB2YWxpZGF0ZSBpbmNsdWRlcwogICAgICAgIFN0cmluZyBuYW1lOwogICAg\nICAgIEZldGNoR3JvdXAgZmc7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBfaW5jbHVkZXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgbmFtZSA9IChTdHJpbmcpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGlmIChuYW1lLmVxdWFscyhfbmFtZSkpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImN5Y2xpYy1m\nZyIsIHRoaXMsIG5hbWUpKTsKICAgICAgICAgICAgZmcgPSBfbWV0YS5nZXRG\nZXRjaEdyb3VwKG5hbWUpOwogICAgICAgICAgICBpZiAoZmcgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLWZnLWluY2x1ZGUiLCB0aGlzLAogICAgICAgICAgICAg\nICAgICAgIG5hbWUpKTsKICAgICAgICAgICAgaWYgKGZnLmluY2x1ZGVzKF9u\nYW1lLCB0cnVlKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiY3ljbGljLWZnIiwgdGhpcywgbmFtZSkp\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1z\nIGVxdWFsaXR5IGlmIHRoZSBvdGhlciBoYXMgdGhlIHNhbWUgbmFtZSBhbmQg\nZGVjbGFyaW5nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGVx\ndWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhp\ncykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3Ro\nZXIgaW5zdGFuY2VvZiBGZXRjaEdyb3VwKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIEZldGNoR3JvdXAgdGhhdCA9IChGZXRjaEdyb3Vw\nKSBvdGhlcjsKICAgICAgICByZXR1cm4gX25hbWUuZXF1YWxzKHRoYXQuX25h\nbWUpCiAgICAgICAgICAgICYmIE9iamVjdFV0aWxzLmVxdWFscyhfbWV0YSwg\ndGhhdC5fbWV0YSk7CiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgp\nIHsKICAgICAgICByZXR1cm4gX25hbWUuaGFzaENvZGUoKSArICgoX21ldGEg\nPT0gbnVsbCkgPyAwIDogX21ldGEuaGFzaENvZGUoKSk7CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gKChf\nbWV0YSA9PSBudWxsKSA/ICJCdWlsdGluIiA6IF9tZXRhLnRvU3RyaW5nICgp\nKSArICIuIiArIF9uYW1lOwogICAgfQp9Cg==\n","encoding":"base64"}

