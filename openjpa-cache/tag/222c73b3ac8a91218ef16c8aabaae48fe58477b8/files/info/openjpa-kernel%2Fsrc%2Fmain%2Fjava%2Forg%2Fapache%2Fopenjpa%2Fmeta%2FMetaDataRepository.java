{"sha":"276d13fa699381611f74389848c73a900f42c2d8","node_id":"MDQ6QmxvYjIwNjM2NDoyNzZkMTNmYTY5OTM4MTYxMWY3NDM4OTg0OGM3M2E5MDBmNDJjMmQ4","size":69321,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/276d13fa699381611f74389848c73a900f42c2d8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc2VjdXJpdHkuQWNjZXNz\nQ29udHJvbGxlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNl\ndDsKaW1wb3J0IGphdmEudXRpbC5UcmVlU2V0OwoKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5EeW5hbWljUGVyc2lzdGVuY2VD\nYXBhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENS\nZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBl\ncnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5l\nbmhhbmNlLlBDUmVnaXN0cnkuUmVnaXN0ZXJDbGFzc0xpc3RlbmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50TWFu\nYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYu\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\nbG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5D\nbG9zZWFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkludGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5PcGVuSlBBSWQ7CgppbXBvcnQgc2VycC51dGlsLlN0cmlu\nZ3M7CgovKioKICogUmVwb3NpdG9yeSBvZiBhbmQgZmFjdG9yeSBmb3IgcGVy\nc2lzdGVudCBtZXRhZGF0YS4KICoKICogQHNpbmNlIDAuMy4wCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RldmUgS2ltIChxdWVyeSBtZXRh\nZGF0YSkKICovCnB1YmxpYyBjbGFzcyBNZXRhRGF0YVJlcG9zaXRvcnkKICAg\nIGltcGxlbWVudHMgUENSZWdpc3RyeS5SZWdpc3RlckNsYXNzTGlzdGVuZXIs\nIENvbmZpZ3VyYWJsZSwgQ2xvc2VhYmxlLCAKICAgIE1ldGFEYXRhTW9kZXMs\nIFNlcmlhbGl6YWJsZSB7CgogICAgLyoqCiAgICAgKiBDb25zdGFudCB0byBu\nb3QgdmFsaWRhdGUgYW55IG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9OT05FID0gMDsKCiAgICAvKioK\nICAgICAqIEJpdCBmbGFnIHRvIHZhbGlkYXRlIG1ldGFkYXRhLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJREFURV9NRVRBID0g\nMTsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRvIHZhbGlkYXRlIG1hcHBp\nbmdzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQUxJ\nREFURV9NQVBQSU5HID0gMjsKCiAgICAvKioKICAgICAqIEJpdCBmbGFnIHRv\nIHZhbGlkYXRlIHVuZW5oYW5jZWQgbWV0YWRhdGEgb25seS4KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVkFMSURBVEVfVU5FTkhBTkNF\nRCA9IDQ7CgogICAgLyoqCiAgICAgKiBCaXQgZmxhZyBmb3IgcnVudGltZSB2\nYWxpZGF0aW9uLiBSZXF1aXJlcyB0aGF0IGFsbCBjbGFzc2VzIGFyZQogICAg\nICogZW5oYW5jZWQsIGFuZCBwZXJmb3JtcyBleHRyYSBmaWVsZCByZXNvbHV0\naW9uIHN0ZXBzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu\ndCBWQUxJREFURV9SVU5USU1FID0gODsKCiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIENsYXNzW10gRU1QVFlfQ0xBU1NFUyA9IG5ldyBDbGFzc1swXTsK\nICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgTm9uUGVyc2lzdGVudE1ldGFE\nYXRhW10gRU1QVFlfTk9OX1BFUlNJU1RFTlQgPSAKICAgIAluZXcgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhWzBdOwogICAgcHJvdGVjdGVkIGZpbmFsIENsYXNz\nTWV0YURhdGFbXSBFTVBUWV9NRVRBUzsKICAgIHByb3RlY3RlZCBmaW5hbCBG\naWVsZE1ldGFEYXRhW10gRU1QVFlfRklFTERTOwogICAgcHJvdGVjdGVkIGZp\nbmFsIE9yZGVyW10gRU1QVFlfT1JERVJTOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoTWV0YURhdGFSZXBvc2l0b3J5LmNsYXNzKTsKCiAgICAvLyBz\neXN0ZW0gc2VxdWVuY2UKICAgIHByaXZhdGUgU2VxdWVuY2VNZXRhRGF0YSBf\nc3lzU2VxID0gbnVsbDsKCiAgICAvLyBjYWNoZSBvZiBwYXJzZWQgbWV0YWRh\ndGEsIG9pZCBjbGFzcyB0byBjbGFzcywgYW5kIGludGVyZmFjZSBjbGFzcwog\nICAgLy8gdG8gbWV0YWRhdGFzCiAgICBwcml2YXRlIGZpbmFsIE1hcCBfbWV0\nYXMgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX29p\nZHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXAo\nKSk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfaW1wbHMgPSBDb2xsZWN0aW9u\ncy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXAoKSk7CiAgICBwcml2YXRl\nIGZpbmFsIE1hcCBfaWZhY2VzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVk\nTWFwKG5ldyBIYXNoTWFwKCkpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAgX3F1\nZXJpZXMgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAg\nX3NlcXMgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBmaW5hbCBNYXAg\nX2FsaWFzZXMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhh\nc2hNYXAoKSk7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfcGF3YXJlcyA9IENv\nbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcgSGFzaE1hcCgpKTsKICAg\nIHByaXZhdGUgZmluYWwgTWFwIF9ub25NYXBwZWQgPSBDb2xsZWN0aW9ucy5z\neW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXAoKSk7CiAgICAKICAgIC8vIG1h\ncCBvZiBjbGFzc2VzIHRvIGxpc3RzIG9mIHRoZWlyIHN1YmNsYXNzZXMKICAg\nIHByaXZhdGUgZmluYWwgTWFwIF9zdWJzID0gQ29sbGVjdGlvbnMuc3luY2hy\nb25pemVkTWFwKG5ldyBIYXNoTWFwKCkpOwoKICAgIC8vIHhtbCBtYXBwaW5n\nCiAgICBwcm90ZWN0ZWQgZmluYWwgWE1MTWV0YURhdGFbXSBFTVBUWV9YTUxN\nRVRBUzsKICAgIHByaXZhdGUgZmluYWwgTWFwIF94bWxtZXRhcyA9IG5ldyBI\nYXNoTWFwKCk7CgogICAgcHJpdmF0ZSB0cmFuc2llbnQgT3BlbkpQQUNvbmZp\nZ3VyYXRpb24gX2NvbmYgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nTG9nIF9sb2cgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgSW50ZXJm\nYWNlSW1wbEdlbmVyYXRvciBfaW1wbEdlbiA9IG51bGw7CiAgICBwcml2YXRl\nIHRyYW5zaWVudCBNZXRhRGF0YUZhY3RvcnkgX2ZhY3RvcnkgPSBudWxsOwoK\nICAgIHByaXZhdGUgaW50IF9yZXNNb2RlID0gTU9ERV9NRVRBIHwgTU9ERV9N\nQVBQSU5HOwogICAgcHJpdmF0ZSBpbnQgX3NvdXJjZU1vZGUgPSBNT0RFX01F\nVEEgfCBNT0RFX01BUFBJTkcgfCBNT0RFX1FVRVJZOwogICAgcHJpdmF0ZSBp\nbnQgX3ZhbGlkYXRlID0gVkFMSURBVEVfTUVUQSB8IFZBTElEQVRFX1VORU5I\nQU5DRUQ7CgogICAgLy8gd2UgYnVmZmVyIHVwIGFueSBjbGFzc2VzIHRoYXQg\ncmVnaXN0ZXIgdGhlbXNlbHZlcyB0byBwcmV2ZW50CiAgICAvLyByZWVudHJh\nbmN5IGVycm9ycyBpZiBjbGFzc2VzIHJlZ2lzdGVyIGR1cmluZyBhIGN1cnJl\nbnQgcGFyc2UgKGNvbW1vbikKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVnaXN0\nZXJlZEVtcHR5ID0gdHJ1ZTsKICAgIHByaXZhdGUgZmluYWwgQ29sbGVjdGlv\nbiBfcmVnaXN0ZXJlZCA9IG5ldyBBcnJheUxpc3QoKTsKCiAgICAvLyBzZXQg\nb2YgbWV0YWRhdGFzIHdlJ3JlIGluIHRoZSBwcm9jZXNzIG9mIHJlc29sdmlu\nZwogICAgcHJpdmF0ZSBmaW5hbCBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0\nYUxpc3QgX3Jlc29sdmluZyA9CiAgICAgICAgbmV3IEluaGVyaXRhbmNlT3Jk\nZXJlZE1ldGFEYXRhTGlzdCgpOwogICAgcHJpdmF0ZSBmaW5hbCBJbmhlcml0\nYW5jZU9yZGVyZWRNZXRhRGF0YUxpc3QgX21hcHBpbmcgPQogICAgICAgIG5l\ndyBJbmhlcml0YW5jZU9yZGVyZWRNZXRhRGF0YUxpc3QoKTsKICAgIHByaXZh\ndGUgZmluYWwgTGlzdCBfZXJycyA9IG5ldyBMaW5rZWRMaXN0KCk7CgogICAg\nLy8gc3lzdGVtIGxpc3RlbmVycwogICAgcHJpdmF0ZSBMaWZlY3ljbGVFdmVu\ndE1hbmFnZXIuTGlzdGVuZXJMaXN0IF9saXN0ZW5lcnMgPQogICAgICAgIG5l\ndyBMaWZlY3ljbGVFdmVudE1hbmFnZXIuTGlzdGVuZXJMaXN0KDMpOwoKICAg\nIC8qKgogICAgICogRGVmYXVsdCBjb25zdHJ1Y3Rvci4gIENvbmZpZ3VyZSB2\naWEge0BsaW5rIENvbmZpZ3VyYWJsZX0uCiAgICAgKi8KICAgIHB1YmxpYyBN\nZXRhRGF0YVJlcG9zaXRvcnkoKSB7CiAgICAgICAgRU1QVFlfTUVUQVMgPSBu\nZXdDbGFzc01ldGFEYXRhQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfRklFTERT\nID0gbmV3RmllbGRNZXRhRGF0YUFycmF5KDApOwogICAgICAgIEVNUFRZX09S\nREVSUyA9IG5ld09yZGVyQXJyYXkoMCk7CiAgICAgICAgRU1QVFlfWE1MTUVU\nQVMgPSBuZXdYTUxDbGFzc01ldGFEYXRhQXJyYXkoMCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBy\nZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gX2Nv\nbmY7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRh\nIGxvZy4KICAgICAqLwogICAgcHVibGljIExvZyBnZXRMb2coKSB7CiAgICAg\nICAgcmV0dXJuIF9sb2c7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgSS9P\nIHVzZWQgdG8gbG9hZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIE1l\ndGFEYXRhRmFjdG9yeSBnZXRNZXRhRGF0YUZhY3RvcnkoKSB7CiAgICAgICAg\ncmV0dXJuIF9mYWN0b3J5OwogICAgfQoKICAgIC8qKgogICAgICogVGhlIEkv\nTyB1c2VkIHRvIGxvYWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldE1ldGFEYXRhRmFjdG9yeShNZXRhRGF0YUZhY3RvcnkgZmFjdG9y\neSkgewogICAgICAgIGZhY3Rvcnkuc2V0UmVwb3NpdG9yeSh0aGlzKTsKICAg\nICAgICBfZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgbWV0YWRhdGEgdmFsaWRhdGlvbiBsZXZlbC4gRGVmYXVsdHMgdG8K\nICAgICAqIDxjb2RlPlZBTElEQVRFX01FVEEgfCBWQUxJREFURV9VTkVOSEFO\nQ0VEPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIGludCBnZXRWYWxpZGF0\nZSgpIHsKICAgICAgICByZXR1cm4gX3ZhbGlkYXRlOwogICAgfQoKICAgIC8q\nKgogICAgICogVGhlIG1ldGFkYXRhIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1\nbHRzIHRvCiAgICAgKiA8Y29kZT5WQUxJREFURV9NRVRBIHwgVkFMSURBVEVf\nVU5FTkhBTkNFRDwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFZhbGlkYXRlKGludCB2YWxpZGF0ZSkgewogICAgICAgIF92YWxpZGF0ZSA9\nIHZhbGlkYXRlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRh\nIHZhbGlkYXRpb24gbGV2ZWwuIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5W\nQUxJREFURV9NRVRBIHwgVkFMSURBVEVfTUFQUElORyB8IFZBTElEQVRFX1VO\nRU5IQU5DRUQ8L2NvZGU+LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRW\nYWxpZGF0ZShpbnQgdmFsaWRhdGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBp\nZiAodmFsaWRhdGUgPT0gVkFMSURBVEVfTk9ORSkKICAgICAgICAgICAgX3Zh\nbGlkYXRlID0gdmFsaWRhdGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAg\nICAgICAgIF92YWxpZGF0ZSB8PSB2YWxpZGF0ZTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF92YWxpZGF0ZSAmPSB+dmFsaWRhdGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgbWV0YWRhdGEgcmVzb2x1dGlvbiBtb2RlLiBEZWZh\ndWx0cyB0bwogICAgICogPGNvZGU+TU9ERV9NRVRBIHwgTU9ERV9NQVBQSU5H\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIGludCBnZXRSZXNvbHZlKCkg\newogICAgICAgIHJldHVybiBfcmVzTW9kZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBtZXRhZGF0YSByZXNvbHV0aW9uIG1vZGUuIERlZmF1bHRzIHRv\nCiAgICAgKiA8Y29kZT5NT0RFX01FVEEgfCBNT0RFX01BUFBJTkc8L2NvZGU+\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGludCBtb2Rl\nKSB7CiAgICAgICAgX3Jlc01vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIG1ldGFkYXRhIHJlc29sdXRpb24gbW9kZS4gRGVmYXVsdHMg\ndG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1PREVfTUFQUElORzwvY29k\nZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29sdmUoaW50IG1v\nZGUsIGJvb2xlYW4gb24pIHsKICAgICAgICBpZiAobW9kZSA9PSBNT0RFX05P\nTkUpCiAgICAgICAgICAgIF9yZXNNb2RlID0gbW9kZTsKICAgICAgICBlbHNl\nIGlmIChvbikKICAgICAgICAgICAgX3Jlc01vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9yZXNNb2RlICY9IH5tb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdo\nYXQgbWV0YWRhdGEgdG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2Rl\nPk1PREVfTUVUQSB8IE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZU1vZGUoKSB7CiAg\nICAgICAgcmV0dXJuIF9zb3VyY2VNb2RlOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEg\ndG8gbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8\nIE1PREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlKSB7CiAgICAg\nICAgX3NvdXJjZU1vZGUgPSBtb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhlIHNvdXJjZSBtb2RlIGRldGVybWluaW5nIHdoYXQgbWV0YWRhdGEgdG8g\nbG9hZC4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPk1PREVfTUVUQSB8IE1P\nREVfTUFQUElORyB8IE1PREVfUVVFUlk8L2NvZGU+LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRTb3VyY2VNb2RlKGludCBtb2RlLCBib29sZWFuIG9u\nKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9OT05FKQogICAgICAgICAg\nICBfc291cmNlTW9kZSA9IG1vZGU7CiAgICAgICAgZWxzZSBpZiAob24pCiAg\nICAgICAgICAgIF9zb3VyY2VNb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfc291cmNlTW9kZSAmPSB+bW9kZTsKICAgIH0gCgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4g\nY2xhc3MuCiAgICAgKgogICAgICogQHBhcmFtIGNscyB0aGUgY2xhc3MgdG8g\ncmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVy\nIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAg\nKiBAcGFyYW0gbXVzdEV4aXN0IGlmIHRydWUsIHRocm93cyBhIHtAbGluayBN\nZXRhRGF0YUV4Y2VwdGlvbn0KICAgICAqIGlmIG5vIG1ldGFkYXRhIGlzIGZv\ndW5kCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgQ2xhc3NNZXRh\nRGF0YSBnZXRNZXRhRGF0YShDbGFzcyBjbHMsCiAgICAgICAgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlm\nIChjbHMgIT0gbnVsbCAmJgogICAgICAgICAgICBEeW5hbWljUGVyc2lzdGVu\nY2VDYXBhYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oY2xzKSkKICAgICAg\nICAgICAgY2xzID0gY2xzLmdldFN1cGVyY2xhc3MoKTsKCiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gZ2V0TWV0YURhdGFJbnRlcm5hbChjbHMsIGVu\ndkxvYWRlcik7CiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCAmJiBtdXN0RXhp\nc3QpIHsKICAgICAgICAgICAgaWYgKGNscyAhPSBudWxsICYmCiAgICAgICAg\nICAgICAgICAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKF9jb25mLCBjbHMp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1tZXRhLW5vdHBjIiwgY2xzKSkuCiAgICAgICAgICAg\nICAgICAgICAgc2V0RmF0YWwoZmFsc2UpOwoKICAgICAgICAgICAgU2V0IHBj\nTmFtZXMgPSBnZXRQZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBlbnZMb2Fk\nZXIpOwogICAgICAgICAgICBpZiAocGNOYW1lcyAhPSBudWxsICYmIHBjTmFt\nZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YS10eXBlcyIsCiAgICAg\nICAgICAgICAgICAgICAgY2xzLCBwY05hbWVzKSk7CgogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1ldGEi\nLCBjbHMpKTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZShtZXRhKTsKICAg\nICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBhbGlhcyBuYW1lLgogICAg\nICoKICAgICAqIEBwYXJhbSBhbGlhcyB0aGUgYWxpYXMgdG8gY2xhc3MgdG8g\ncmV0cmlldmUgbWV0YWRhdGEgZm9yCiAgICAgKiBAcGFyYW0gZW52TG9hZGVy\nIHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciwgaWYgYW55CiAgICAg\nKiBAcGFyYW0gbXVzdEV4aXN0IGlmIHRydWUsIHRocm93cyBhIHtAbGluayBN\nZXRhRGF0YUV4Y2VwdGlvbn0KICAgICAqIGlmIG5vIG1ldGFkYXRhIGlzIGZv\ndW5kCiAgICAgKiBAc2VlIENsYXNzTWV0YURhdGEjZ2V0VHlwZUFsaWFzCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKFN0\ncmluZyBhbGlhcywgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLAogICAgICAgIGJv\nb2xlYW4gbXVzdEV4aXN0KSB7CiAgICAgICAgaWYgKGFsaWFzID09IG51bGwg\nJiYgbXVzdEV4aXN0KQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWFsaWFzLW1ldGEiLCBhbGlhcywKICAg\nICAgICAgICAgICAgIF9hbGlhc2VzKSk7CiAgICAgICAgaWYgKGFsaWFzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBj\naGVjayBjYWNoZQogICAgICAgIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3Nlcyhl\nbnZMb2FkZXIpOwogICAgICAgIExpc3QgY2xhc3NMaXN0ID0gKExpc3QpIF9h\nbGlhc2VzLmdldChhbGlhcyk7CgogICAgICAgIC8vIG11bHRpcGxlIGNsYXNz\nZXMgbWF5IGhhdmUgYmVlbiBkZWZpbmVkIHdpdGggdGhlIHNhbWUgYWxpYXM6\nIHdlCiAgICAgICAgLy8gd2lsbCBmaWx0ZXIgYnkgY2hlY2tpbmcgYWdhaW5z\ndCB0aGUgY3VycmVudCBsaXN0IG9mIHRoZQogICAgICAgIC8vIHBlcnNpc3Rl\nbnQgdHlwZXMgYW5kIGZpbHRlciBiYXNlZCBvbiB3aGljaCBjbGFzc2VzIGFy\nZSBsb2FkYWJsZQogICAgICAgIC8vIHZpYSB0aGUgY3VycmVudCBlbnZpcm9u\nbWVudCdzIENsYXNzTG9hZGVyCiAgICAgICAgU2V0IHBjTmFtZXMgPSBnZXRQ\nZXJzaXN0ZW50VHlwZU5hbWVzKGZhbHNlLCBlbnZMb2FkZXIpOwogICAgICAg\nIENsYXNzIGNscyA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGNs\nYXNzTGlzdCAhPSBudWxsICYmIGkgPCBjbGFzc0xpc3Quc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IChDbGFzcykgY2xhc3NMaXN0Lmdl\ndChpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIHJl\nLWxvYWQgdGhlIGNsYXNzIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50IGxv\nYWRlciBzbwogICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBjYW4gaGFuZGxl\nIHJlZGVwbG95bWVudCBvZiB0aGUgc2FtZSBjbGFzcyBuYW1lCiAgICAgICAg\nICAgICAgICBDbGFzcyBuYyA9IENsYXNzLmZvck5hbWUoYy5nZXROYW1lKCks\nIGZhbHNlLCBlbnZMb2FkZXIpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHdl\nIGhhdmUgc3BlY2lmaWVkIGEgbGlzdCBvZiBwZXJzaXN0ZW50IGNsYXNlcywK\nICAgICAgICAgICAgICAgIC8vIGFsc28gY2hlY2sgdG8gZW5zdXJlIHRoYXQg\ndGhlIGNsYXNzIGlzIGluIHRoYXQgbGlzdAogICAgICAgICAgICAgICAgaWYg\nKHBjTmFtZXMgPT0gbnVsbCB8fCBwY05hbWVzLnNpemUoKSA9PSAwIAogICAg\nICAgICAgICAgICAgICAgIHx8IHBjTmFtZXMuY29udGFpbnMobmMuZ2V0TmFt\nZSgpKSkgewogICAgICAgICAgICAgICAgICAgIGNscyA9IG5jOwogICAgICAg\nICAgICAgICAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTGlzdC5hZGQoY2xzKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAg\nICAgIC8vIHRoaXMgaGFwcGVucyB3aGVuIHRoZSBjbGFzcyBpcyBub3QgbG9h\nZGFibGUgYnkKICAgICAgICAgICAgICAgIC8vIHRoZSBlbnZpcm9ubWVudCBj\nbGFzcyBsb2FkZXIsIHNvIGl0IHdhcyBwcm9iYWJseQogICAgICAgICAgICAg\nICAgLy8gbGlzdGVkIGVsc2V3aGVyZTsgYWxzbyBpZ25vcmUgbGlua2FnZSBm\nYWlsdXJlcyBhbmQKICAgICAgICAgICAgICAgIC8vIG90aGVyIGNsYXNzIGxv\nYWRpbmcgcHJvYmxlbXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRNZXRh\nRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAgICAgLy8g\nbWF5YmUgdGhpcyBpcyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQganVzdCBp\nc24ndCB2YWxpZAogICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc0tleShh\nbGlhcykpIHsKICAgICAgICAgICAgaWYgKG11c3RFeGlzdCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgi\nbm8tYWxpYXMtbWV0YSIsIGFsaWFzLAogICAgICAgICAgICAgICAgICAgIF9h\nbGlhc2VzLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQoKICAgICAgICAvLyByZWNvcmQgdGhhdCB0aGlzIGlzIGFu\nIGludmFsaWQgdHlwZQogICAgICAgIF9hbGlhc2VzLnB1dChhbGlhcywgbnVs\nbCk7CgogICAgICAgIGlmICghbXVzdEV4aXN0KQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLWFsaWFzLW1ldGEiLCBhbGlhcywgX2FsaWFzZXMpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIG1ldGhvZCB0byBnZXQg\ndGhlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIHdpdGhvdXQKICAg\nICAqIHJlc29sdmluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01l\ndGFEYXRhIGdldE1ldGFEYXRhSW50ZXJuYWwoQ2xhc3MgY2xzLAogICAgICAg\nIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIGlmIChjbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGNo\nZWNrIGNhY2hlIGZvciBleGlzdGluZyBtZXRhZGF0YSwgb3IgZ2l2ZSB1cCBp\nZiBubyBtZXRhZGF0YSBhbmQKICAgICAgICAvLyBvdXIgbGlzdCBvZiBjb25m\naWd1cmVkIHBlcnNpc3RlbnQgdHlwZXMgZG9lc24ndCBpbmNsdWRlIHRoZSBj\nbGFzcwogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IChDbGFzc01ldGFE\nYXRhKSBfbWV0YXMuZ2V0KGNscyk7CiAgICAgICAgaWYgKG1ldGEgIT0gbnVs\nbCAmJiAoKG1ldGEuZ2V0U291cmNlTW9kZSgpICYgTU9ERV9NRVRBKSAhPSAw\nCiAgICAgICAgICAgIHx8IChfc291cmNlTW9kZSAmIE1PREVfTUVUQSkgPT0g\nMCkpCiAgICAgICAgICAgIHJldHVybiBtZXRhOwoKICAgICAgICAvLyBpZiBy\ndW50aW1lLCBjdXQgb2ZmIHNlYXJjaCBpZiBub3QgaW4gcGMgbGlzdC4gIHdl\nIGRvbid0IGRvIHRoaXMgYXQKICAgICAgICAvLyBkZXYgdGltZSBzbyB0aGF0\nIHVzZXIgY2FuIG1hbmlwdWxhdGUgcGVyc2lzdGVudCBjbGFzc2VzIGhlJ3Mg\nd3JpdGluZwogICAgICAgIC8vIGJlZm9yZSBhZGRpbmcgdGhlbSB0byB0aGUg\nbGlzdAogICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElN\nRSkgIT0gMCkgewogICAgICAgICAgICBTZXQgcGNOYW1lcyA9IGdldFBlcnNp\nc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlcik7CiAgICAgICAgICAg\nIGlmIChwY05hbWVzICE9IG51bGwgJiYgIXBjTmFtZXMuY29udGFpbnMoY2xz\nLmdldE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbWV0YTsKICAg\nICAgICB9CgogICAgICAgIGlmIChtZXRhID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gY2hlY2sgdG8gc2VlIGlmIG1heWJlIHdlIGtub3cgdGhpcyBjbGFz\ncyBoYXMgbm8gbWV0YWRhdGEKICAgICAgICAgICAgaWYgKF9tZXRhcy5jb250\nYWluc0tleShjbHMpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhpcyBpc24ndCBhbiBvYnZpb3Vz\nbHkgYmFkIGNsYXNzCiAgICAgICAgICAgIGlmIChjbHMuaXNQcmltaXRpdmUo\nKSB8fCBjbHMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImphdmEuIikKICAgICAg\nICAgICAgICAgIHx8IGNscyA9PSBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3Mp\nCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIC8v\nIGRlc2lnbmVkIHRvIGdldCBhcm91bmQgamlrZXMgMS4xNyAvIEpESzEuNSBp\nc3N1ZSB3aGVyZSBzdGF0aWMKICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZXJz\nIGFyZSBub3QgaW52b2tlZCB3aGVuIGEgY2xhc3MgaXMgcmVmZXJlbmNlZCwg\nc28gdGhlCiAgICAgICAgICAgIC8vIGNsYXNzIG5ldmVyIHJlZ2lzdGVycyBp\ndHNlbGYgd2l0aCB0aGUgc3lzdGVtCiAgICAgICAgICAgIGlmICgoX3ZhbGlk\nYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNs\ncy5nZXROYW1lKCksIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIChD\nbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRD\nbGFzc0xvYWRlckFjdGlvbihjbHMpKSk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBub3QgaW4gY2FjaGU6IGxv\nYWQgbWV0YWRhdGEgb3IgbWFwcGluZ3MgZGVwZW5kaW5nIG9uIHNvdXJjZSBt\nb2RlLgogICAgICAgIC8vIGxvYWRpbmcgbWV0YWRhdGEgbWlnaHQgYWxzbyBs\nb2FkIG1hcHBpbmdzLCBidXQgZG9lc24ndCBoYXZlIHRvCiAgICAgICAgaW50\nIG1vZGUgPSAwOwogICAgICAgIGlmICgoX3NvdXJjZU1vZGUgJiBNT0RFX01F\nVEEpICE9IDApCiAgICAgICAgICAgIG1vZGUgPSBfc291cmNlTW9kZSAmIH5N\nT0RFX01BUFBJTkc7CiAgICAgICAgZWxzZSBpZiAoKF9zb3VyY2VNb2RlICYg\nTU9ERV9NQVBQSU5HKSA9PSAwKQogICAgICAgICAgICBtb2RlID0gX3NvdXJj\nZU1vZGU7CiAgICAgICAgaWYgKG1vZGUgIT0gTU9ERV9OT05FKSB7CiAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJsb2FkLWNscyIsIGNscywgdG9N\nb2RlU3RyaW5nKG1vZGUpKSk7CiAgICAgICAgICAgIF9mYWN0b3J5LmxvYWQo\nY2xzLCBtb2RlLCBlbnZMb2FkZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY2hlY2sgY2FjaGUgYWdhaW4KICAgICAgICBpZiAobWV0YSA9PSBudWxsKQog\nICAgICAgICAgICBtZXRhID0gKENsYXNzTWV0YURhdGEpIF9tZXRhcy5nZXQo\nY2xzKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsICYmICgobWV0YS5nZXRT\nb3VyY2VNb2RlKCkgJiBNT0RFX01FVEEpICE9IDAKICAgICAgICAgICAgfHwg\nKF9zb3VyY2VNb2RlICYgTU9ERV9NRVRBKSA9PSAwKSkKICAgICAgICAgICAg\ncmV0dXJuIG1ldGE7CgogICAgICAgIC8vIHJlY29yZCB0aGF0IHRoaXMgY2xh\nc3MgaGFzIG5vIG1ldGFkYXRhOyBjaGVja2luZyBmb3IgdGhpcyBsYXRlcgog\nICAgICAgIC8vIHNwZWVkcyB0aGluZ3MgdXAgaW4gZW52aXJvbm1lbnRzIHdp\ndGggc2xvdyBjbGFzcyBsb2FkaW5nCiAgICAgICAgLy8gbGlrZSBhcHBzZXJ2\nZXJzCiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAgICAgICAgICAgcmVt\nb3ZlTWV0YURhdGEobWV0YSk7CiAgICAgICAgX21ldGFzLnB1dChjbHMsIG51\nbGwpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZl\nbiBtb2RlIGZsYWdzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJp\nbmcgdG9Nb2RlU3RyaW5nKGludCBtb2RlKSB7CiAgICAgICAgU3RyaW5nQnVm\nZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoMzEpOwogICAgICAgIGlmICgo\nbW9kZSAmIE1PREVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiW01FVEFdIik7CiAgICAgICAgaWYgKChtb2RlICYgTU9ERV9RVUVSWSkg\nIT0gMCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiW1FVRVJZXSIpOwogICAg\nICAgIGlmICgobW9kZSAmIE1PREVfTUFQUElORykgIT0gMCkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiW01BUFBJTkddIik7CiAgICAgICAgaWYgKChtb2Rl\nICYgTU9ERV9NQVBQSU5HX0lOSVQpICE9IDApCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIltNQVBQSU5HX0lOSVRdIik7CiAgICAgICAgcmV0dXJuIGJ1Zi50\nb1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUHJlcGFyZSBtZXRh\nZGF0YSBmb3IgbWFwcGluZyByZXNvbHV0aW9uLiBUaGlzIG1ldGhvZCBtaWdo\ndCBtYXAgcGFydHMKICAgICAqIG9mIHRoZSBtZXRhZGF0YSB0aGF0IGRvbid0\nIHJlbHkgb24gb3RoZXIgY2xhc3NlcyBiZWluZyBtYXBwZWQsIGJ1dCB0aGF0\nCiAgICAgKiBvdGhlciBjbGFzc2VzIG1pZ2h0IHJlbHkgb24gZHVyaW5nIHRo\nZWlyIG93biBtYXBwaW5nIChmb3IgZXhhbXBsZSwKICAgICAqIHByaW1hcnkg\na2V5IGZpZWxkcykuIEJ5IGRlZmF1bHQsIHRoaXMgbWV0aG9kIG9ubHkgY2Fs\nbHMKICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2RlZmluZVN1cGVyY2xh\nc3NGaWVsZHN9LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwcmVwYXJl\nTWFwcGluZyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBtZXRhLmRl\nZmluZVN1cGVyY2xhc3NGaWVsZHMoZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVzb2x2ZSB0aGUgZ2l2ZW4gbWV0YWRhdGEgaWYgbmVlZGVkLiBU\naGVyZSBhcmUgdGhyZWUgZ29hbHM6CiAgICAgKiA8b2w+CiAgICAgKiA8bGk+\nTWFrZSBzdXJlIG5vIHVucmVzb2x2ZWQgbWV0YWRhdGEgZ2V0cyBiYWNrIHRv\nIHRoZSBjbGllbnQuPC9saT4KICAgICAqIDxsaT5Bdm9pZCBpbmZpbml0ZSBy\nZWVudHJhbnQgY2FsbHMgZm9yIG11dHVhbGx5LWRlcGVuZGVudCBtZXRhZGF0\nYXMgYnkKICAgICAqIGFsbG93aW5nIHVucmVzb2x2ZWQgbWV0YWRhdGEgdG8g\nYmUgcmV0dXJuZWQgdG8gb3RoZXIgbWV0YWRhdGFzLjwvbGk+CiAgICAgKiA8\nbGk+QWx3YXlzIG1ha2Ugc3VyZSB0aGUgc3VwZXJjbGFzcyBtZXRhZGF0YSBp\ncyByZXNvbHZlZCBiZWZvcmUgdGhlCiAgICAgKiBzdWJjbGFzcyBtZXRhZGF0\nYSBzbyB0aGF0IHRoZSBzdWJjbGFzcyBjYW4gYWNjZXNzIHRoZSBzdXBlcidz\nIGxpc3QKICAgICAqIG9mIGZpZWxkcy48L2xpPgogICAgICogPC9vbD4gTm90\nZSB0aGF0IHRoZSBjb2RlIGNhbGxpbmcgdGhpcyBtZXRob2QgaXMgc3luY2hy\nb25pemVkLCBzbyB0aGlzCiAgICAgKiBtZXRob2QgZG9lc24ndCBoYXZlIHRv\nIGJlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZShDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICAvLyByZXR1cm4gYW55dGhpbmcgdGhh\ndCBoYXMgaXRzIG1ldGFkYXRhIHJlc29sdmVkLCBiZWNhdXNlIHRoYXQgbWVh\nbnMKICAgICAgICAvLyBpdCBpcyBlaXRoZXIgZnVsbHkgcmVzb2x2ZWQgb3Ig\nbXVzdCBhdCBsZWFzdCBiZSBpbiB0aGUgcHJvY2VzcyBvZgogICAgICAgIC8v\nIHJlc29sdmluZyBtYXBwaW5nLCBldGMgc2luY2Ugd2UgZG8gdGhhdCByaWdo\ndCBhZnRlciBtZXRhIHJlc29sdmUKICAgICAgICBpZiAobWV0YSA9PSBudWxs\nIHx8IF9yZXNNb2RlID09IE1PREVfTk9ORQogICAgICAgICAgICB8fCAobWV0\nYS5nZXRSZXNvbHZlKCkgJiBNT0RFX01FVEEpICE9IDApCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgLy8gcmVzb2x2ZSBtZXRhZGF0YQogICAgICAg\nIExpc3QgcmVzb2x2ZWQgPSByZXNvbHZlTWV0YShtZXRhKTsKICAgICAgICBp\nZiAocmVzb2x2ZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAvLyBsb2FkIG1hcHBpbmcgZGF0YQogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgcmVzb2x2ZWQuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIGxv\nYWRNYXBwaW5nKChDbGFzc01ldGFEYXRhKSByZXNvbHZlZC5nZXQoaSkpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVzb2x2ZWQuc2l6ZSgpOyBp\nKyspCiAgICAgICAgICAgIHByZU1hcHBpbmcoKENsYXNzTWV0YURhdGEpIHJl\nc29sdmVkLmdldChpKSk7CgogICAgICAgIC8vIHJlc29sdmUgbWFwcGluZ3MK\nICAgICAgICBib29sZWFuIGVyciA9IHRydWU7CiAgICAgICAgaWYgKChfcmVz\nTW9kZSAmIE1PREVfTUFQUElORykgIT0gMCkKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCByZXNvbHZlZC5zaXplKCk7IGkrKykKICAgICAgICAg\nICAgICAgIGVyciAmPSByZXNvbHZlTWFwcGluZygoQ2xhc3NNZXRhRGF0YSkg\ncmVzb2x2ZWQuZ2V0KGkpKTsKCiAgICAgICAgLy8gdGhyb3cgZXJyb3JzIGVu\nY291bnRlcmVkCiAgICAgICAgaWYgKGVyciAmJiAhX2VycnMuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIFJ1bnRpbWVFeGNlcHRpb24gcmU7CiAgICAgICAg\nICAgIGlmIChfZXJycy5zaXplKCkgPT0gMSkKICAgICAgICAgICAgICAgIHJl\nID0gKFJ1bnRpbWVFeGNlcHRpb24pIF9lcnJzLmdldCgwKTsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgcmUgPSBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoInJlc29sdmUtZXJycyIpKS4KICAgICAgICAgICAg\nICAgICAgICBzZXROZXN0ZWRUaHJvd2FibGVzKChUaHJvd2FibGVbXSkgX2Vy\ncnMudG9BcnJheQogICAgICAgICAgICAgICAgICAgICAgICAobmV3IEV4Y2Vw\ndGlvbltfZXJycy5zaXplKCldKSk7CiAgICAgICAgICAgIF9lcnJzLmNsZWFy\nKCk7CiAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJlc29sdmUgbWV0YWRhdGEgbW9kZSwgcmV0dXJuaW5n\nIGxpc3Qgb2YgcHJvY2Vzc2VkIG1ldGFkYWRhdGFzLCBvciBudWxsCiAgICAg\nKiBpZiB3ZSdyZSBzdGlsbCBpbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcg\nb3RoZXIgbWV0YWRhdGFzLgogICAgICovCiAgICBwcml2YXRlIExpc3QgcmVz\nb2x2ZU1ldGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCkgewogICAgICAgICAgICAv\nLyBzZXQgc3VwZXJjbGFzcwogICAgICAgICAgICBDbGFzcyBzdXAgPSBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAg\nICAgIENsYXNzTWV0YURhdGEgc3VwTWV0YTsKICAgICAgICAgICAgd2hpbGUg\nKHN1cCAhPSBudWxsICYmIHN1cCAhPSBPYmplY3QuY2xhc3MpIHsKICAgICAg\nICAgICAgICAgIHN1cE1ldGEgPSBnZXRNZXRhRGF0YShzdXAsIG1ldGEuZ2V0\nRW52Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYg\nKHN1cE1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIG1ldGEu\nc2V0UENTdXBlcmNsYXNzKHN1cCk7CiAgICAgICAgICAgICAgICAgICAgbWV0\nYS5zZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YShzdXBNZXRhKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAg\nICAgICAgICAgICAgICAgIHN1cCA9IHN1cC5nZXRTdXBlcmNsYXNzKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmlzSW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgICAgIENsYXNz\nW10gc3VwcyA9IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldEludGVyZmFj\nZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vw\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHN1cE1ldGEg\nPSBnZXRNZXRhRGF0YShzdXBzW2ldLCBtZXRhLmdldEVudkNsYXNzTG9hZGVy\nKCksIAogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHN1cE1ldGEgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhLnNldFBDU3VwZXJjbGFzcyhzdXApOwogICAg\nICAgICAgICAgICAgICAgICAgICBtZXRhLnNldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKHN1cE1ldGEpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImFzc2ln\nbmVkLXN1cCIsIG1ldGEsCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRQ\nQ1N1cGVyY2xhc3MoKSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzb2x2\nZSByZWxhdGlvbiBwcmltYXJ5IGtleSBmaWVsZHMgZm9yIG1hcHBpbmcgZGVw\nZW5kZW5jaWVzCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBtZXRh\nLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZm1kc1tp\nXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgICAgIGdldE1ldGFEYXRh\nKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIAogICAgICAgICAgICAgICAg\nICAgIG1ldGEuZ2V0RW52Q2xhc3NMb2FkZXIoKSwgZmFsc2UpOwoKICAgICAg\nICAvLyByZXNvbHZlIG1ldGFkYXRhOyBpZiB3ZSdyZSBub3QgaW4gdGhlIHBy\nb2Nlc3Mgb2YgcmVzb2x2aW5nCiAgICAgICAgLy8gb3RoZXJzLCB0aGlzIHdp\nbGwgcmV0dXJuIHRoZSBzZXQgb2YgaW50ZXJyZWxhdGVkIG1ldGFzIHRoYXQK\nICAgICAgICAvLyByZXNvbHZlZAogICAgICAgIHJldHVybiBwcm9jZXNzQnVm\nZmVyKG1ldGEsIF9yZXNvbHZpbmcsIE1PREVfTUVUQSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBMb2FkIG1hcHBpbmcgaW5mb3JtYXRpb24gZm9yIHRoZSBn\naXZlbiBtZXRhZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvYWRN\nYXBwaW5nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICgobWV0\nYS5nZXRSZXNvbHZlKCkgJiBNT0RFX01BUFBJTkcpICE9IDApCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgLy8gbG9hZCBtYXBwaW5nIGluZm9ybWF0\naW9uCiAgICAgICAgaWYgKChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVf\nTUFQUElORykgPT0gMAogICAgICAgICAgICAmJiAoX3NvdXJjZU1vZGUgJiBN\nT0RFX01BUFBJTkcpICE9IDApIHsKICAgICAgICAgICAgLy8gZW1iZWRkZWQt\nb25seSBtZXRhZGF0YSBkb2Vzbid0IGhhdmUgbWFwcGluZywgc28gYWx3YXlz\nIGxvYWRlZAogICAgICAgICAgICBpZiAobWV0YS5pc0VtYmVkZGVkT25seSgp\nKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1PREVfTUFQ\nUElORywgdHJ1ZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgLy8gbG9hZCBtYXBwaW5nIGRhdGEKICAgICAgICAgICAgICAgIGludCBt\nb2RlID0gX3NvdXJjZU1vZGUgJiB+TU9ERV9NRVRBOwogICAgICAgICAgICAg\nICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJsb2FkLW1hcHBpbmciLCBtZXRh\nLAogICAgICAgICAgICAgICAgICAgICAgICB0b01vZGVTdHJpbmcobW9kZSkp\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nX2ZhY3RvcnkubG9hZChtZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgbW9kZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRFbnZDbGFzc0xvYWRl\ncigpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICByZW1vdmVNZXRhRGF0YSht\nZXRhKTsKICAgICAgICAgICAgICAgICAgICBfZXJycy5hZGQocmUpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUHJlLW1hcHBpbmcgcHJlcGFyYXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwcmVNYXBwaW5nKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIGlmICgobWV0YS5nZXRSZXNvbHZlKCkgJiBNT0RF\nX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gcHJlcGFyZSBtYXBwaW5ncyBmb3IgcmVzb2x2ZTsgaWYgbm90IHJlc29s\ndmluZyBtYXBwaW5ncywgdGhlbgogICAgICAgIC8vIG1ha2Ugc3VyZSBhbnkg\nc3VwZXJjbGFzcyBmaWVsZHMgZGVmaW5lZCBpbiBtZXRhZGF0YSBhcmUgcmVz\nb2x2ZWQKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKF9yZXNNb2Rl\nICYgTU9ERV9NQVBQSU5HKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9s\nb2cudHJhY2UoX2xvYy5nZXQoInByZXAtbWFwcGluZyIsIG1ldGEpKTsKICAg\nICAgICAgICAgICAgIHByZXBhcmVNYXBwaW5nKG1ldGEpOwogICAgICAgICAg\nICB9IGVsc2UKICAgICAgICAgICAgICAgIG1ldGEuZGVmaW5lU3VwZXJjbGFz\nc0ZpZWxkcyhmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsK\nICAgICAgICAgICAgX2VycnMuYWRkKHJlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXNvbHZlIGFuZCBpbml0aWFsaXplIG1hcHBpbmcu\nCiAgICAgKgogICAgICogQHJldHVybiBmYWxzZSBpZiB3ZSdyZSBzdGlsbCBp\nbiB0aGUgcHJvY2VzcyBvZiByZXNvbHZpbmcgbWFwcGluZ3MKICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIHJlc29sdmVNYXBwaW5nKENsYXNzTWV0YURh\ndGEgbWV0YSkgewogICAgICAgIExpc3QgbWFwcGVkID0gcHJvY2Vzc0J1ZmZl\ncihtZXRhLCBfbWFwcGluZywgTU9ERV9NQVBQSU5HKTsKICAgICAgICBpZiAo\nbWFwcGVkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgLy8gaW5pdGlhbGl6ZSBtYXBwaW5nIGZvciBydW50aW1lIHVzZQog\nICAgICAgIGlmICgoX3Jlc01vZGUgJiBNT0RFX01BUFBJTkdfSU5JVCkgIT0g\nMCkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBlZC5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgbWV0YSA9IChDbGFzc01l\ndGFEYXRhKSBtYXBwZWQuZ2V0KGkpOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBtZXRhLnJlc29sdmUoTU9ERV9NQVBQSU5H\nX0lOSVQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICAgICAgICAgIHJlbW92ZU1ldGFEYXRh\nKG1ldGEpOwogICAgICAgICAgICAgICAgICAgIF9lcnJzLmFkZChyZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNz\nIHRoZSBnaXZlbiBtZXRhZGF0YSBhbmQgdGhlIGFzc29jaWF0ZWQgYnVmZmVy\nLgogICAgICovCiAgICBwcml2YXRlIExpc3QgcHJvY2Vzc0J1ZmZlcihDbGFz\nc01ldGFEYXRhIG1ldGEsCiAgICAgICAgSW5oZXJpdGFuY2VPcmRlcmVkTWV0\nYURhdGFMaXN0IGJ1ZmZlciwgaW50IG1vZGUpIHsKICAgICAgICAvLyBpZiB3\nZSdyZSBhbHJlYWR5IHByb2Nlc3NpbmcgYSBtZXRhZGF0YSwganVzdCBidWZm\nZXIgdGhpcyBvbmU7IHdoZW4KICAgICAgICAvLyB0aGUgaW5pdGlhbCBtZXRh\nZGF0YSBmaW5pc2hlcyBwcm9jZXNzaW5nLCB3ZSB0cmF2ZXJzZSB0aGUgYnVm\nZmVyCiAgICAgICAgLy8gYW5kIHByb2Nlc3MgYWxsIHRoZSBvdGhlcnMgdGhh\ndCB3ZXJlIGludHJvZHVjZWQgZHVyaW5nIHJlZW50cmFudAogICAgICAgIC8v\nIGNhbGxzCiAgICAgICAgaWYgKCFidWZmZXIuYWRkKG1ldGEpIHx8IGJ1ZmZl\nci5zaXplKCkgIT0gMSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAg\nICAgIC8vIGNvbnRpbnVhbGx5IHBvcCBhIG1ldGFkYXRhIGFuZCBwcm9jZXNz\nIGl0IHVudGlsIHdlIHJ1biBvdXQ7IG5vdGUKICAgICAgICAvLyB0aGF0IGVh\nY2ggcHJvY2Vzc2luZyBjYWxsIG1pZ2h0IHBsYWNlIG1vcmUgbWV0YXMgaW4g\ndGhlIGJ1ZmZlciBhcwogICAgICAgIC8vIG9uZSBjbGFzcyB0cmllcyB0byBh\nY2Nlc3MgbWV0YWRhdGEgZm9yIGFub3RoZXI7IGFsc28gbm90ZSB0aGF0IHRo\nZQogICAgICAgIC8vIGJ1ZmZlciBvcmRlcnMgaXRzZWxmIGZyb20gbGVhc3Qg\ndG8gbW9zdCBkZXJpdmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBidWZmZXJl\nZDsKICAgICAgICBMaXN0IHByb2Nlc3NlZCA9IG5ldyBBcnJheUxpc3QoNSk7\nCiAgICAgICAgd2hpbGUgKCFidWZmZXIuaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgIGJ1ZmZlcmVkID0gYnVmZmVyLnBlZWsoKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGJ1ZmZlcmVkLnJlc29sdmUobW9kZSk7CiAg\nICAgICAgICAgICAgICBwcm9jZXNzZWQuYWRkKGJ1ZmZlcmVkKTsKICAgICAg\nICAgICAgICAgIGJ1ZmZlci5yZW1vdmUoYnVmZmVyZWQpOwogICAgICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nICAgICBfZXJycy5hZGQocmUpOwoKICAgICAgICAgICAgICAgIC8vIGFueSBl\neGNlcHRpb24gZHVyaW5nIHJlc29sdXRpb24gb2Ygb25lIHR5cGUgbWVhbnMg\nd2UgY2FuJ3QKICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgYW55IG9mIHRo\nZSByZWxhdGVkIHR5cGVzLCBzbyBjbGVhciBidWZmZXIuICB0aGlzIGFsc28K\nICAgICAgICAgICAgICAgIC8vIGVuc3VyZXMgdGhhdCBpZiB0d28gdHlwZXMg\ncmVsYXRlIHRvIGVhY2ggb3RoZXIgYW5kIG9uZQogICAgICAgICAgICAgICAg\nLy8gZGllcywgd2UgZG9uJ3QgZ2V0IGludG8gaW5maW5pdGUgY3ljbGVzCiAg\nICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGJ1ZmZlci5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAg\nIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgICAgICByZW1vdmVNZXRhRGF0YShtZXRhKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAobWV0YSAhPSBidWZmZXJlZCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBfZXJycy5hZGQobmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoInByZXYtZXJy\ncyIsIG1ldGEsIGJ1ZmZlcmVkKSkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJ1ZmZlci5jbGVh\ncigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBw\ncm9jZXNzZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIHRo\nZSBtZXRhZGF0YSBpbnN0YW5jZXMgY3VycmVudGx5IGluIHRoZSByZXBvc2l0\nb3J5LgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIENsYXNzTWV0\nYURhdGFbXSBnZXRNZXRhRGF0YXMoKSB7CiAgICAgICAgLy8gcHJldmVudCBj\nb25jdXJyZW50IG1vZCBlcnJvcnMgd2hlbiByZXNvbHZpbmcgb25lIG1ldGFk\nYXRhCiAgICAgICAgLy8gaW50cm9kdWNlcyBvdGhlcnMKICAgICAgICBDbGFz\nc01ldGFEYXRhW10gbWV0YXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSBfbWV0YXMu\ndmFsdWVzKCkuCiAgICAgICAgICAgIHRvQXJyYXkobmV3IENsYXNzTWV0YURh\ndGFbX21ldGFzLnNpemUoKV0pOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbWV0YXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChtZXRhc1tp\nXSAhPSBudWxsKQogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEobWV0YXNb\naV0uZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIG1l\ndGFzW2ldLmdldEVudkNsYXNzTG9hZGVyKCksIHRydWUpOwoKICAgICAgICBM\naXN0IHJlc29sdmVkID0gbmV3IEFycmF5TGlzdChfbWV0YXMuc2l6ZSgpKTsK\nICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBfbWV0YXMudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgbWV0YSA9IChDbGFzc01ldGFEYXRh\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAobWV0YSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmVzb2x2ZWQuYWRkKG1ldGEpOwogICAgICAgIH0K\nICAgICAgICBtZXRhcyA9IChDbGFzc01ldGFEYXRhW10pIHJlc29sdmVkLnRv\nQXJyYXkKICAgICAgICAgICAgKG5ld0NsYXNzTWV0YURhdGFBcnJheShyZXNv\nbHZlZC5zaXplKCkpKTsKICAgICAgICBBcnJheXMuc29ydChtZXRhcyk7CiAg\nICAgICAgcmV0dXJuIG1ldGFzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBjYWNoZWQgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcywg\nd2l0aG91dCBhbnkgcmVzb2x1dGlvbi4KICAgICAqIFJldHVybiBudWxsIGlm\nIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldENh\nY2hlZE1ldGFEYXRhKENsYXNzIGNscykgewogICAgICAgIHJldHVybiAoQ2xh\nc3NNZXRhRGF0YSkgX21ldGFzLmdldChjbHMpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIENyZWF0ZSBhIG5ldyBtZXRhZGF0YSwgcG9wdWxhdGUgaXQg\nd2l0aCBkZWZhdWx0IGluZm9ybWF0aW9uLCBhZGQgaXQgdG8KICAgICAqIHRo\nZSByZXBvc2l0b3J5LCBhbmQgcmV0dXJuIGl0LiBVc2UgdGhlIGRlZmF1bHQg\nYWNjZXNzIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRh\nIGFkZE1ldGFEYXRhKENsYXNzIGNscykgewogICAgICAgIHJldHVybiBhZGRN\nZXRhRGF0YShjbHMsIENsYXNzTWV0YURhdGEuQUNDRVNTX1VOS05PV04pOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IG1ldGFkYXRhLCBw\nb3B1bGF0ZSBpdCB3aXRoIGRlZmF1bHQgaW5mb3JtYXRpb24sIGFkZCBpdCB0\nbwogICAgICogdGhlIHJlcG9zaXRvcnksIGFuZCByZXR1cm4gaXQuCiAgICAg\nKgogICAgICogQHBhcmFtIGFjY2VzcyB0aGUgYWNjZXNzIHR5cGUgdG8gdXNl\nIGluIHBvcHVsYXRpbmcgbWV0YWRhdGEKICAgICAqLwogICAgcHVibGljIENs\nYXNzTWV0YURhdGEgYWRkTWV0YURhdGEoQ2xhc3MgY2xzLCBpbnQgYWNjZXNz\nKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsIHx8IGNscy5pc1ByaW1pdGl2\nZSgpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ2xhc3NN\nZXRhRGF0YSBtZXRhID0gbmV3Q2xhc3NNZXRhRGF0YShjbHMpOwogICAgICAg\nIF9mYWN0b3J5LmdldERlZmF1bHRzKCkucG9wdWxhdGUobWV0YSwgYWNjZXNz\nKTsKCiAgICAgICAgLy8gc3luY2hyb25pemUgb24gdGhpcyByYXRoZXIgdGhh\nbiB0aGUgbWFwLCBiZWNhdXNlIGFsbCBvdGhlciBtZXRob2RzCiAgICAgICAg\nLy8gdGhhdCBhY2Nlc3MgX21ldGFzIGFyZSBzeW5jaHJvbml6ZWQgb24gdGhp\ncwogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBp\nZiAoX3Bhd2FyZXMuY29udGFpbnNLZXkoY2xzKSkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgicGMtYW5k\nLWF3YXJlIiwgY2xzKSk7CiAgICAgICAgICAgIF9tZXRhcy5wdXQoY2xzLCBt\nZXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1ldGE7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNsYXNzIG1ldGFkYXRh\nIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRhRGF0\nYSBuZXdDbGFzc01ldGFEYXRhKENsYXNzIHR5cGUpIHsKICAgICAgICByZXR1\ncm4gbmV3IENsYXNzTWV0YURhdGEodHlwZSwgdGhpcyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgYXJyYXkgb2YgdGhlIHByb3BlciBj\nbGFzcyBtZXRhZGF0YSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVk\nIENsYXNzTWV0YURhdGFbXSBuZXdDbGFzc01ldGFEYXRhQXJyYXkoaW50IGxl\nbmd0aCkgewogICAgICAgIHJldHVybiBuZXcgQ2xhc3NNZXRhRGF0YVtsZW5n\ndGhdOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGZpZWxk\nIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgRmll\nbGRNZXRhRGF0YSBuZXdGaWVsZE1ldGFEYXRhKFN0cmluZyBuYW1lLCBDbGFz\ncyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEgb3duZXIpIHsKICAgICAg\nICByZXR1cm4gbmV3IEZpZWxkTWV0YURhdGEobmFtZSwgdHlwZSwgb3duZXIp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGFycmF5IG9m\nIHRoZSBwcm9wZXIgZmllbGQgbWV0YWRhdGEgc3ViY2xhc3MuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhW10gbmV3RmllbGRNZXRhRGF0\nYUFycmF5KGludCBsZW5ndGgpIHsKICAgICAgICByZXR1cm4gbmV3IEZpZWxk\nTWV0YURhdGFbbGVuZ3RoXTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBhcnJheSBvZiB0aGUgcHJvcGVyIHhtbCBjbGFzcyBtZXRhZGF0\nYSBzdWJjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIFhNTE1ldGFEYXRh\nW10gbmV3WE1MQ2xhc3NNZXRhRGF0YUFycmF5KGludCBsZW5ndGgpIHsKICAg\nICAgICByZXR1cm4gbmV3IFhNTENsYXNzTWV0YURhdGFbbGVuZ3RoXTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBlbWJlZGRlZCBjbGFz\ncyBtZXRhZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIENs\nYXNzTWV0YURhdGEgbmV3RW1iZWRkZWRDbGFzc01ldGFEYXRhKFZhbHVlTWV0\nYURhdGEgb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3IENsYXNzTWV0YURh\ndGEob3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIHZhbHVlIG1ldGFkYXRhIGluc3RhbmNlLgogICAgICovCiAgICBwcm90ZWN0\nZWQgVmFsdWVNZXRhRGF0YSBuZXdWYWx1ZU1ldGFEYXRhKEZpZWxkTWV0YURh\ndGEgb3duZXIpIHsKICAgICAgICByZXR1cm4gbmV3IFZhbHVlTWV0YURhdGFJ\nbXBsKG93bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiB7\nQGxpbmsgT3JkZXJ9IGZvciB0aGUgZ2l2ZW4gZmllbGQgYW5kIGRlY2xhcmF0\naW9uLiBUaGlzCiAgICAgKiBtZXRob2QgZGVsZWdhdGVzIHRvIHtAbGluayAj\nbmV3UmVsYXRlZEZpZWxkT3JkZXJ9IGFuZAogICAgICoge0BsaW5rICNuZXdW\nYWx1ZUZpZWxkT3JkZXJ9IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBPcmRlciBuZXdPcmRlcihGaWVsZE1ldGFEYXRhIG93bmVyLCBTdHJp\nbmcgbmFtZSwgYm9vbGVhbiBhc2MpIHsKICAgICAgICAvLyBwYXRocyBjYW4g\nc3RhcnQgd2l0aCAob3IgZXF1YWwpICcjZWxlbWVudCcKICAgICAgICBpZiAo\nbmFtZS5zdGFydHNXaXRoKE9yZGVyLkVMRU1FTlQpKQogICAgICAgICAgICBu\nYW1lID0gbmFtZS5zdWJzdHJpbmcoT3JkZXIuRUxFTUVOVC5sZW5ndGgoKSk7\nCiAgICAgICAgaWYgKG5hbWUubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAg\ncmV0dXJuIG5ld1ZhbHVlT3JkZXIob3duZXIsIGFzYyk7CgogICAgICAgIC8v\nIG5leHQgdG9rZW4gc2hvdWxkIGJlICcuJwogICAgICAgIGlmIChuYW1lLmNo\nYXJBdCgwKSA9PSAnLicpCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0\ncmluZygxKTsKCiAgICAgICAgLy8gcmVsYXRlZCBmaWVsZAogICAgICAgIENs\nYXNzTWV0YURhdGEgbWV0YSA9IG93bmVyLmdldEVsZW1lbnQoKS5nZXRUeXBl\nTWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nbnBjLWZpZWxkLW9yZGVyYWJsZSIsCiAgICAgICAgICAgICAgICBvd25lciwg\nbmFtZSkpOwogICAgICAgIEZpZWxkTWV0YURhdGEgcmVsID0gbWV0YS5nZXRG\naWVsZChuYW1lKTsKICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFk\nLWZpZWxkLW9yZGVyYWJsZSIsCiAgICAgICAgICAgICAgICBvd25lciwgbmFt\nZSkpOwogICAgICAgIHJldHVybiBuZXdSZWxhdGVkRmllbGRPcmRlcihvd25l\nciwgcmVsLCBhc2MpOwogICAgfQoKICAgIC8qKgogICAgICogT3JkZXIgYnkg\ndGhlIGZpZWxkIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgT3JkZXIg\nbmV3VmFsdWVPcmRlcihGaWVsZE1ldGFEYXRhIG93bmVyLCBib29sZWFuIGFz\nYykgewogICAgICAgIHJldHVybiBuZXcgSW5NZW1vcnlWYWx1ZU9yZGVyKGFz\nYywgZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE9yZGVyIGJ5IGEgZmllbGQgb2YgdGhlIHJlbGF0ZWQgdHlwZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIE9yZGVyIG5ld1JlbGF0ZWRGaWVsZE9yZGVyKEZp\nZWxkTWV0YURhdGEgb3duZXIsCiAgICAgICAgRmllbGRNZXRhRGF0YSByZWws\nIGJvb2xlYW4gYXNjKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbk1lbW9yeVJl\nbGF0ZWRGaWVsZE9yZGVyKHJlbCwgYXNjLCBnZXRDb25maWd1cmF0aW9uKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGFycmF5IG9mIG9y\nZGVycyBvZiB0aGUgZ2l2ZW4gc2l6ZS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIE9yZGVyW10gbmV3T3JkZXJBcnJheShpbnQgc2l6ZSkgewogICAgICAgIHJl\ndHVybiBuZXcgT3JkZXJbc2l6ZV07CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgYSBtZXRhZGF0YSBpbnN0YW5jZSBmcm9tIHRoZSByZXBvc2l0b3J5\nLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxz\nZSBpZiBub3QgaW4gdGhpcyByZXBvc2l0b3J5CiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIHJlbW92ZU1ldGFEYXRhKENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICByZXR1cm4gcmVtb3ZlTWV0YURhdGEobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIGEgbWV0YWRhdGEgaW5zdGFuY2UgZnJvbSB0aGUgcmVwb3NpdG9yeS4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2Ug\naWYgbm90IGluIHRoaXMgcmVwb3NpdG9yeQogICAgICovCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlTWV0YURhdGEoQ2xhc3MgY2xz\nKSB7CiAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKF9tZXRhcy5yZW1vdmUoY2xzKSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIENsYXNzIGltcGwgPSAoQ2xhc3MpIF9pZmFj\nZXMucmVtb3ZlKGNscyk7CiAgICAgICAgICAgIGlmIChpbXBsICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfbWV0YXMucmVtb3ZlKGltcGwpOwogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBtZXRh\nZGF0YSBhcyBkZWNsYXJlZCBpbnRlcmZhY2UgaW1wbGVtZW50YXRpb24uCiAg\nICAgKi8KICAgIHZvaWQgYWRkRGVjbGFyZWRJbnRlcmZhY2VJbXBsKENsYXNz\nTWV0YURhdGEgbWV0YSwgQ2xhc3MgaWZhY2UpIHsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKF9pbXBscykgewogICAgICAgICAgICBDb2xsZWN0aW9uIHZhbHMg\nPSAoQ29sbGVjdGlvbikgX2ltcGxzLmdldChpZmFjZSk7CiAgICAgICAgICAg\nIAogICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhlIHN1cGVyY2xh\nc3MgYWxyZWFkeSBkZWNsYXJlcyB0byBhdm9pZCBkdXBzCiAgICAgICAgICAg\nIGlmICh2YWxzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwog\nICAgICAgICAgICAgICAgZm9yICg7IHN1cCAhPSBudWxsOyBzdXAgPSBzdXAu\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAgICAgICAgICAgICAgICAg\nICBpZiAodmFscy5jb250YWlucyhzdXAuZ2V0RGVzY3JpYmVkVHlwZSgpKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfaW1wbHMsIGlmYWNlLCBt\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSwgZmFsc2UpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgaW1wbGVtZW50YXRpb24gZm9y\nIHRoZSBnaXZlbiBtYW5hZ2VkIGludGVyZmFjZS4KICAgICAqLwogICAgc3lu\nY2hyb25pemVkIHZvaWQgc2V0SW50ZXJmYWNlSW1wbChDbGFzc01ldGFEYXRh\nIG1ldGEsIENsYXNzIGltcGwpIHsKICAgICAgICBpZiAoIW1ldGEuaXNNYW5h\nZ2VkSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW1hbmFnZWQtaW50ZXJmYWNlIiwg\nCiAgICAgICAgICAgICAgICBtZXRhLCBpbXBsKSk7CiAgICAgICAgX2lmYWNl\ncy5wdXQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIGltcGwpOwogICAgICAg\nIF9tZXRhcy5wdXQoaW1wbCwgbWV0YSk7CiAgICAgICAgYWRkRGVjbGFyZWRJ\nbnRlcmZhY2VJbXBsKG1ldGEsIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsK\nICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IG1ldGEuZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICB3aGlsZSAoc3VwICE9IG51bGwpIHsK\nICAgICAgICAgICAgLy8gcmVjb3JkIHN1cGVyY2xhc3MgaW50ZXJmYWNlIGlu\nZm8gd2hpbGUgd2UgY2FuIGFzIHdlbGwgYXMgd2UKICAgICAgICAgICAgLy8g\nd2lsbCBvbmx5IHJlZ2lzdGVyIGNvbmNyZXRlIHN1cGVyY2xhc3MgaW4gUENS\nZWdpc3RyeQogICAgICAgICAgICBzdXAuY2xlYXJTdWJjbGFzc0NhY2hlKCk7\nCiAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihfc3Vicywgc3VwLmdldERl\nc2NyaWJlZFR5cGUoKSwgaW1wbCwgdHJ1ZSk7CiAgICAgICAgICAgIHN1cCA9\nIChDbGFzc01ldGFEYXRhKSBzdXAuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHN5bmNocm9uaXplZCBJbnRl\ncmZhY2VJbXBsR2VuZXJhdG9yIGdldEltcGxHZW5lcmF0b3IoKSB7CiAgICAg\nICAgaWYgKF9pbXBsR2VuID09IG51bGwpCiAgICAgICAgICAgIF9pbXBsR2Vu\nID0gbmV3IEludGVyZmFjZUltcGxHZW5lcmF0b3IodGhpcyk7CiAgICAgICAg\ncmV0dXJuIF9pbXBsR2VuOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBsZWFzdC1kZXJpdmVkIGNsYXNzIG1ldGFkYXRhIGZvciB0aGUgZ2l2\nZW4gYXBwbGljYXRpb24KICAgICAqIGlkZW50aXR5IG9iamVjdC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gb2lkIHRoZSBvaWQgdG8gZ2V0IHRoZSBtZXRhZGF0\nYSBmb3IKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIgdGhlIGVudmlyb25tZW50\nYWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkKICAgICAqIEBwYXJhbSBtdXN0RXhp\nc3QgaWYgdHJ1ZSwgdGhyb3dzIGEge0BsaW5rIE1ldGFEYXRhRXhjZXB0aW9u\nfQogICAgICogaWYgbm8gbWV0YWRhdGEgaXMgZm91bmQKICAgICAqLwogICAg\ncHVibGljIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoT2JqZWN0IG9pZCwg\nQ2xhc3NMb2FkZXIgZW52TG9hZGVyLAogICAgICAgIGJvb2xlYW4gbXVzdEV4\naXN0KSB7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsICYmIG11c3RFeGlzdCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1vaWQtbWV0YSIsIG9pZCwgIj8iLAogICAgICAgICAgICAgICAg\nX29pZHMudG9TdHJpbmcoKSkpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmIChvaWQgaW5z\ndGFuY2VvZiBPcGVuSlBBSWQpIHsKICAgICAgICAgICAgQ2xhc3MgY2xzID0g\nKChPcGVuSlBBSWQpIG9pZCkuZ2V0VHlwZSgpOwogICAgICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIG11c3RFeGlzdCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAgICAgIHByb2Nl\nc3NSZWdpc3RlcmVkQ2xhc3NlcyhlbnZMb2FkZXIpOwogICAgICAgIENsYXNz\nIGNscyA9IChDbGFzcykgX29pZHMuZ2V0KG9pZC5nZXRDbGFzcygpKTsKICAg\nICAgICBpZiAoY2xzICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBnZXRN\nZXRhRGF0YShjbHMsIGVudkxvYWRlciwgbXVzdEV4aXN0KTsKCiAgICAgICAg\nLy8gbWF5YmUgdGhpcyBpcyBzb21lIHR5cGUgd2UndmUgc2VlbiBidXQganVz\ndCBpc24ndCB2YWxpZAogICAgICAgIGlmIChfb2lkcy5jb250YWluc0tleShv\naWQuZ2V0Q2xhc3MoKSkpIHsKICAgICAgICAgICAgaWYgKG11c3RFeGlzdCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihf\nbG9jLmdldCgibm8tb2lkLW1ldGEiLCBvaWQsCiAgICAgICAgICAgICAgICAg\nICAgb2lkLmdldENsYXNzKCksIF9vaWRzKSk7CiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgc3RpbGwgbm90IG1h\ndGNoLCByZWdpc3RlciBhbnkgY2xhc3NlcyB0aGF0IGxvb2sgc2ltaWxhciB0\nbyB0aGUKICAgICAgICAvLyBvaWQgY2xhc3MgYW5kIGNoZWNrIGFnYWluCiAg\nICAgICAgcmVzb2x2ZUlkZW50aXR5Q2xhc3Mob2lkKTsKICAgICAgICBpZiAo\ncHJvY2Vzc1JlZ2lzdGVyZWRDbGFzc2VzKGVudkxvYWRlcikubGVuZ3RoID4g\nMCkgewogICAgICAgICAgICBjbHMgPSAoQ2xhc3MpIF9vaWRzLmdldChvaWQu\nZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAgIGlmIChjbHMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRl\nciwgbXVzdEV4aXN0KTsKICAgICAgICB9CgogICAgICAgIC8vIHJlY29yZCB0\naGF0IHRoaXMgaXMgYW4gaW52YWxpZCB0eXBlCiAgICAgICAgX29pZHMucHV0\nKG9pZC5nZXRDbGFzcygpLCBudWxsKTsKCiAgICAgICAgaWYgKCFtdXN0RXhp\nc3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tb2lkLW1ldGEiLCBv\naWQsCiAgICAgICAgICAgIG9pZC5nZXRDbGFzcygpLCBfb2lkcykpLnNldEZh\naWxlZE9iamVjdChvaWQpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBz\nb21lIGd1ZXNzZXMgYWJvdXQgdGhlIG5hbWUgb2YgYSB0YXJnZXQgY2xhc3Mg\nZm9yIGFuCiAgICAgKiB1bmtub3duIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNs\nYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZUlkZW50aXR5\nQ2xhc3MoT2JqZWN0IG9pZCkgewogICAgICAgIGlmIChvaWQgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDbGFzcyBvaWRDbGFzcyA9\nIG9pZC5nZXRDbGFzcygpOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFi\nbGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoInJlc29s\ndmUtaWRlbnRpdHkiLCBvaWRDbGFzcykpOwoKICAgICAgICBDbGFzc0xvYWRl\nciBjbCA9IChDbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9h\nZGVyQWN0aW9uKG9pZENsYXNzKSk7IAogICAgICAgIFN0cmluZyBjbGFzc05h\nbWU7CiAgICAgICAgd2hpbGUgKG9pZENsYXNzICE9IG51bGwgJiYgb2lkQ2xh\nc3MgIT0gT2JqZWN0LmNsYXNzKSB7CiAgICAgICAgICAgIGNsYXNzTmFtZSA9\nIG9pZENsYXNzLmdldE5hbWUoKTsKCiAgICAgICAgICAgIC8vIHdlIHRha2Ug\nYSBicnV0ZS1mb3JjZSBhcHByb2FjaDogdHJ5IHRvIGxvYWQgYWxsIHRoZSBj\nbGFzcycKICAgICAgICAgICAgLy8gc3Vic3RyaW5ncy4gdGhpcyB3aWxsIGhh\nbmRsZSB0aGUgZm9sbG93aW5nIGNvbW1vbiBuYW1pbmcgY2FzZXM6CiAgICAg\nICAgICAgIC8vCiAgICAgICAgICAgIC8vICAgY29tLmNvbXBhbnkuTXlDbGFz\ncyRJRAktPiBjb20uY29tcGFueS5NeUNsYXNzCiAgICAgICAgICAgIC8vICAg\nY29tLmNvbXBhbnkuTXlDbGFzc0lkCS0+IGNvbS5jb21wYW55Lk15Q2xhc3MK\nICAgICAgICAgICAgLy8gICBjb20uY29tcGFueS5NeUNsYXNzT2lkCS0+IGNv\nbS5jb21wYW55Lk15Q2xhc3MKICAgICAgICAgICAgLy8gICBjb20uY29tcGFu\neS5NeUNsYXNzUEsJLT4gY29tLmNvbXBhbnkuTXlDbGFzcwogICAgICAgICAg\nICAvLwogICAgICAgICAgICAvLyB0aGlzIGlzbid0IHRoZSBmYXN0ZXN0IHRo\naW5nIHBvc3NpYmxlLCBidXQgdGhpcyBtZXRob2Qgd2lsbAogICAgICAgICAg\nICAvLyBvbmx5IGJlIGNhbGxlZCBvbmNlIHBlciBKVk0gcGVyIHVua25vd24g\nYXBwIGlkIGNsYXNzCiAgICAgICAgICAgIGZvciAoaW50IGkgPSBjbGFzc05h\nbWUubGVuZ3RoKCk7IGkgPiAxOyBpLS0pIHsKICAgICAgICAgICAgICAgIGlm\nIChjbGFzc05hbWUuY2hhckF0KGkgLSAxKSA9PSAnLicpCiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBDbGFzcy5mb3JOYW1lKGNsYXNzTmFtZS5zdWJzdHJp\nbmcoMCwgaSksIHRydWUsIGNsKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9IC8vIGNvbnN1bWUg\nYWxsIGV4Y2VwdGlvbnMKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbW92ZSB1cCB0aGUgT0lEIGhpZXJhcmNoeQogICAgICAgICAgICBvaWRDbGFz\ncyA9IG9pZENsYXNzLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIGxlYXN0LWRlcml2ZWQgbWV0\nYWRhdGFzIHdpdGggc29tZSBtYXBwZWQgYXNzaWduYWJsZSB0eXBlIHRoYXQK\nICAgICAqIGltcGxlbWVudCB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKgogICAg\nICogQHBhcmFtIGNscyB0aGUgY2xhc3Mgb3IgaW50ZXJmYWNlIHRvIHJldHJp\nZXZlIGltcGxlbWVudG9ycyBmb3IKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIg\ndGhlIGVudmlyb25tZW50YWwgY2xhc3MgbG9hZGVyLCBpZiBhbnkKICAgICAq\nIEBwYXJhbSBtdXN0RXhpc3QgaWYgdHJ1ZSwgdGhyb3dzIGEge0BsaW5rIE1l\ndGFEYXRhRXhjZXB0aW9ufQogICAgICogaWYgbm8gbWV0YWRhdGEgaXMgZm91\nbmQKICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGFbXSBnZXRJbXBs\nZW1lbnRvck1ldGFEYXRhcyhDbGFzcyBjbHMsCiAgICAgICAgQ2xhc3NMb2Fk\nZXIgZW52TG9hZGVyLCBib29sZWFuIG11c3RFeGlzdCkgewogICAgICAgIGlm\nIChjbHMgPT0gbnVsbCAmJiBtdXN0RXhpc3QpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YSIsIGNs\ncykpOwogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIEVNUFRZX01FVEFTOwoKICAgICAgICAvLyBnZXQgaW1wbHMgb2YgZ2l2\nZW4gaW50ZXJmYWNlIC8gYWJzdHJhY3QgY2xhc3MKICAgICAgICBsb2FkUmVn\naXN0ZXJlZENsYXNzTWV0YURhdGEoZW52TG9hZGVyKTsKICAgICAgICBDb2xs\nZWN0aW9uIHZhbHMgPSAoQ29sbGVjdGlvbikgX2ltcGxzLmdldChjbHMpOwog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YTsKICAgICAgICBDb2xsZWN0aW9u\nIG1hcHBlZCA9IG51bGw7CiAgICAgICAgaWYgKHZhbHMgIT0gbnVsbCkgewog\nICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHZhbHMpIHsKICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdmFscy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgICAgIG1ldGEgPSBnZXRN\nZXRhRGF0YSgoQ2xhc3MpIGl0ci5uZXh0KCksIGVudkxvYWRlciwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGEuaXNNYXBwZWQoKQogICAg\nICAgICAgICAgICAgICAgICAgICB8fCBtZXRhLmdldE1hcHBlZFBDU3ViY2xh\nc3NNZXRhRGF0YXMoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChtYXBwZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG1hcHBlZCA9IG5ldyBBcnJheUxpc3QodmFscy5zaXplKCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBtYXBwZWQuYWRkKG1ldGEpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1hcHBlZCA9PSBudWxs\nICYmIG11c3RFeGlzdCkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRhIiwgY2xzKSk7CiAgICAgICAg\naWYgKG1hcHBlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gRU1QVFlf\nTUVUQVM7CiAgICAgICAgcmV0dXJuIChDbGFzc01ldGFEYXRhW10pIG1hcHBl\nZC50b0FycmF5KG5ld0NsYXNzTWV0YURhdGFBcnJheQogICAgICAgICAgICAo\nbWFwcGVkLnNpemUoKSkpOwogICAgfQogICAgIAogICAgLyoqCiAgICAgKiBH\nZXRzIHRoZSBtZXRhZGF0YSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBw\nZXJzaXN0ZW5jZS1hd2FyZSBjbGFzcy4gCiAgICAgKiBSZXR1cm5zIG51bGws\nIGlmIHRoZSBnaXZlbiBjbGFzcyBpcyBub3QgcmVnaXN0ZXJlZCBhcyAKICAg\nICAqIHBlcnNpc3RlbmNlLWF3YXJlLgogICAgICovCiAgICBwdWJsaWMgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhIGdldFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3Mg\nY2xzKSB7CiAgICAJcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGEpX3Bh\nd2FyZXMuZ2V0KGNscyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0\ncyBhbGwgdGhlIG1ldGFkYXRhcyBmb3IgcGVyc2lzdGVuY2UtYXdhcmUgY2xh\nc3NlcwogICAgICogCiAgICAgKiBAcmV0dXJuIGVtcHR5IGFycmF5IGlmIG5v\nIGNsYXNzIGhhcyBiZWVuIHJlZ2lzdGVyZWQgYXMgcGVycy1hd2FyZQogICAg\nICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhW10gZ2V0UGVy\nc2lzdGVuY2VBd2FyZXMoKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfcGF3\nYXJlcykgewogICAgICAgICAgICBpZiAoX3Bhd2FyZXMuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIEVNUFRZX05PTl9QRVJTSVNURU5UOwog\nICAgICAgICAgICByZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdKV9w\nYXdhcmVzLnZhbHVlcygpLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcg\nTm9uUGVyc2lzdGVudE1ldGFEYXRhW19wYXdhcmVzLnNpemUoKV0pOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY2xh\nc3MgYXMgcGVyc2lzdGVuY2UtYXdhcmUuCiAgICAgKiAKICAgICAqIEBwYXJh\nbSBjbHMgbm9uLW51bGwgYW5kIG11c3Qgbm90IGFscmVhZGR5IGJlIGFkZGVk\nIGFzIHBlcnNpdGVuY2UtY2FwYWJsZQogICAgICovCiAgICBwdWJsaWMgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhIGFkZFBlcnNpc3RlbmNlQXdhcmUoQ2xhc3Mg\nY2xzKSB7CiAgICAJaWYgKGNscyA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVs\nbDsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICBp\nZiAoX3Bhd2FyZXMuY29udGFpbnNLZXkoY2xzKSkKICAgICAgICAgICAgICAg\nIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKV9wYXdhcmVzLmdldChj\nbHMpOwogICAgICAgICAgICBpZiAoZ2V0Q2FjaGVkTWV0YURhdGEoY2xzKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYy1hbmQtYXdhcmUiLCBjbHMpKTsKICAgICAg\nICAgICAgTm9uUGVyc2lzdGVudE1ldGFEYXRhIG1ldGEgPSBuZXcgTm9uUGVy\nc2lzdGVudE1ldGFEYXRhKGNscywgdGhpcywKICAgICAgICAgICAgICAgIE5v\nblBlcnNpc3RlbnRNZXRhRGF0YS5UWVBFX1BFUlNJU1RFTkNFX0FXQVJFKTsK\nICAgICAgICAgICAgX3Bhd2FyZXMucHV0KGNscywgbWV0YSk7CiAgICAgICAg\nICAgIHJldHVybiBtZXRhOwogICAgCX0KICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSBhIHBlcnNpdGVuY2UtYXdhcmUgY2xhc3MgZnJvbSB0aGUgcmVw\nb3NpdG9yeQogICAgICogCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3Zl\nZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVQZXJzaXN0ZW5j\nZUF3YXJlKENsYXNzIGNscykgewogICAgCXJldHVybiBfcGF3YXJlcy5yZW1v\ndmUoY2xzKSAhPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0\naGUgbWV0YWRhdGEgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gbm9uLW1h\ncHBlZCBpbnRlcmZhY2UuCiAgICAgKiBSZXR1cm5zIG51bGwsIGlmIHRoZSBn\naXZlbiBpbnRlcmZhY2UgaXMgbm90IHJlZ2lzdGVyZWQgYXMgCiAgICAgKiBw\nZXJzaXN0ZW5jZS1hd2FyZS4KICAgICAqLwogICAgcHVibGljIE5vblBlcnNp\nc3RlbnRNZXRhRGF0YSBnZXROb25NYXBwZWRJbnRlcmZhY2UoQ2xhc3MgaWZh\nY2UpIHsKICAgIAlyZXR1cm4gKE5vblBlcnNpc3RlbnRNZXRhRGF0YSlfbm9u\nTWFwcGVkLmdldChpZmFjZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nR2V0cyB0aGUgY29ycmVzcG9uZGluZyBtZXRhZGF0YXMgZm9yIGFsbCByZWdp\nc3RlcmVkLCBub24tbWFwcGVkCiAgICAgKiBpbnRlcmZhY2VzCiAgICAgKiAK\nICAgICAqIEByZXR1cm4gZW1wdHkgYXJyYXkgaWYgbm8gbm9uLW1hcHBlZCBp\nbnRlcmZhY2UgaGFzIGJlZW4gcmVnaXN0ZXJlZC4KICAgICAqLwogICAgcHVi\nbGljIE5vblBlcnNpc3RlbnRNZXRhRGF0YVtdIGdldE5vbk1hcHBlZEludGVy\nZmFjZXMoKSB7CiAgICAgICAgc3luY2hyb25pemVkIChfbm9uTWFwcGVkKSB7\nCiAgICAgICAgICAgIGlmIChfbm9uTWFwcGVkLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBFTVBUWV9OT05fUEVSU0lTVEVOVDsKICAgICAg\nICAgICAgcmV0dXJuIChOb25QZXJzaXN0ZW50TWV0YURhdGFbXSlfbm9uTWFw\ncGVkLnZhbHVlcygpLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgTm9u\nUGVyc2lzdGVudE1ldGFEYXRhW19ub25NYXBwZWQuc2l6ZSgpXSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBub24t\nbWFwcGVkIGludGVyZmFjZSB0byB0aGUgcmVwb3NpdG9yeS4KICAgICAqIAog\nICAgICogQHBhcmFtIGlmYWNlIHRoZSBub24tbWFwcGVkIGludGVyZmFjZQog\nICAgICovCiAgICBwdWJsaWMgTm9uUGVyc2lzdGVudE1ldGFEYXRhIGFkZE5v\nbk1hcHBlZEludGVyZmFjZShDbGFzcyBpZmFjZSkgewogICAgCWlmIChpZmFj\nZSA9PSBudWxsKQogICAgCQlyZXR1cm4gbnVsbDsKICAgICAgICBpZiAoIWlm\nYWNlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LW5vbi1tYXBwZWQiLCBpZmFj\nZSkpOwogICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAg\nIGlmIChfbm9uTWFwcGVkLmNvbnRhaW5zS2V5KGlmYWNlKSkKICAgICAgICAg\nICAgICAgIHJldHVybiAoTm9uUGVyc2lzdGVudE1ldGFEYXRhKV9ub25NYXBw\nZWQuZ2V0KGlmYWNlKTsKICAgICAgICAgICAgaWYgKGdldENhY2hlZE1ldGFE\nYXRhKGlmYWNlKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tbWFwcGVkLXBjIiwg\naWZhY2UpKTsKICAgICAgICAgICAgTm9uUGVyc2lzdGVudE1ldGFEYXRhIG1l\ndGEgPSBuZXcgTm9uUGVyc2lzdGVudE1ldGFEYXRhKGlmYWNlLCB0aGlzLAog\nICAgICAgICAgICAgICAgTm9uUGVyc2lzdGVudE1ldGFEYXRhLlRZUEVfTk9O\nX01BUFBFRF9JTlRFUkZBQ0UpOwogICAgICAgICAgICBfbm9uTWFwcGVkLnB1\ndChpZmFjZSwgbWV0YSk7CiAgICAgICAgICAgIHJldHVybiBtZXRhOwogICAg\nCX0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG5vbi1tYXBwZWQg\naW50ZXJmYWNlIGZyb20gdGhlIHJlcG9zaXRvcnkKICAgICAqIAogICAgICog\nQHJldHVybiB0cnVlIGlmIHJlbW92ZWQKICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gcmVtb3ZlTm9uTWFwcGVkSW50ZXJmYWNlKENsYXNzIGlmYWNlKSB7\nCiAgICAJcmV0dXJuIF9ub25NYXBwZWQucmVtb3ZlKGlmYWNlKSAhPSBudWxs\nOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgdGhlIGNhY2hlIG9mIHBh\ncnNlZCBtZXRhZGF0YS4gVGhpcyBtZXRob2QgYWxzbyBjbGVhcnMgdGhlCiAg\nICAgKiBpbnRlcm5hbCB7QGxpbmsgTWV0YURhdGFGYWN0b3J5IE1ldGFEYXRh\nRmFjdG9yeX0ncyBjYWNoZS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCB2b2lkIGNsZWFyKCkgewogICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImNs\nZWFyLXJlcG9zIiwgdGhpcykpOwoKICAgICAgICBfbWV0YXMuY2xlYXIoKTsK\nICAgICAgICBfb2lkcy5jbGVhcigpOwogICAgICAgIF9zdWJzLmNsZWFyKCk7\nCiAgICAgICAgX2ltcGxzLmNsZWFyKCk7CiAgICAgICAgX3F1ZXJpZXMuY2xl\nYXIoKTsKICAgICAgICBfc2Vxcy5jbGVhcigpOwogICAgICAgIF9yZWdpc3Rl\ncmVkLmNsZWFyKCk7CiAgICAgICAgX2ZhY3RvcnkuY2xlYXIoKTsKICAgICAg\nICBfYWxpYXNlcy5jbGVhcigpOwogICAgICAgIF9wYXdhcmVzLmNsZWFyKCk7\nCiAgICAgICAgX25vbk1hcHBlZC5jbGVhcigpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBzZXQgb2YgY29uZmlndXJlZCBwZXJzaXN0ZW50\nIGNsYXNzZXMsIG9yIG51bGwgaWYgdGhlIHVzZXIKICAgICAqIGRpZCBub3Qg\nY29uZmlndXJlIGFueS4KICAgICAqCiAgICAgKiBAcGFyYW0gZGV2cGF0aCBp\nZiB0cnVlLCBzZWFyY2ggZm9yIG1ldGFkYXRhIGZpbGVzIGluIGRpcmVjdG9y\naWVzCiAgICAgKiBpbiB0aGUgY2xhc3NwYXRoIGlmIG5vIGNsYXNzZXMgYXJl\nIGNvbmZpZ3VyZWQgZXhwbGljaXRseQogICAgICogQHBhcmFtIGVudkxvYWRl\nciB0aGUgY2xhc3MgbG9hZGVyIHRvIHVzZSwgb3IgbnVsbCBmb3IgZGVmYXVs\ndAogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFNldCBnZXRQZXJz\naXN0ZW50VHlwZU5hbWVzKGJvb2xlYW4gZGV2cGF0aCwKICAgICAgICBDbGFz\nc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICByZXR1cm4gX2ZhY3Rvcnku\nZ2V0UGVyc2lzdGVudFR5cGVOYW1lcyhkZXZwYXRoLCBlbnZMb2FkZXIpOwog\nICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgcGVyc2lzdGVudCBjbGFz\nc2VzIG5hbWVkIGluIGNvbmZpZ3VyYXRpb24uCiAgICAgKiBUaGlzIGVuc3Vy\nZXMgdGhhdCBhbGwgc3ViY2xhc3NlcyBhbmQgYXBwbGljYXRpb24gaWRlbnRp\ndHkgY2xhc3NlcyBvZgogICAgICogZWFjaCB0eXBlIGFyZSBrbm93biBpbiBh\nZHZhbmNlLCB3aXRob3V0IGhhdmluZyB0byByZWx5IG9uIHRoZQogICAgICog\nYXBwbGljYXRpb24gbG9hZGluZyB0aGUgY2xhc3NlcyBiZWZvcmUgcGVyZm9y\nbWluZyBvcGVyYXRpb25zIHRoYXQKICAgICAqIG1pZ2h0IGludm9sdmUgdGhl\nbS4KICAgICAqCiAgICAgKiBAcGFyYW0gZGV2cGF0aCBpZiB0cnVlLCBzZWFy\nY2ggZm9yIG1ldGFkYXRhIGZpbGVzIGluIGRpcmVjdG9yaWVzCiAgICAgKiBp\nbiB0aGUgY2xhc3NwYXRoIGlmIHRoZSBubyBjbGFzc2VzIGFyZSBjb25maWd1\ncmVkIGV4cGxpY2l0bHkKICAgICAqIEBwYXJhbSBlbnZMb2FkZXIgdGhlIGNs\nYXNzIGxvYWRlciB0byB1c2UsIG9yIG51bGwgZm9yIGRlZmF1bHQKICAgICAq\nIEByZXR1cm4gdGhlIGxvYWRlZCBjbGFzc2VzLCBvciBlbXB0eSBjb2xsZWN0\naW9uIGlmIG5vbmUKICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBD\nb2xsZWN0aW9uIGxvYWRQZXJzaXN0ZW50VHlwZXMoYm9vbGVhbiBkZXZwYXRo\nLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIFNl\ndCBuYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZGV2cGF0aCwgZW52\nTG9hZGVyKTsKICAgICAgICBpZiAobmFtZXMgPT0gbnVsbCB8fCBuYW1lcy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBU\nWV9MSVNUOwoKICAgICAgICAvLyBhdHRlbXB0IHRvIGxvYWQgY2xhc3NlcyBz\nbyB0aGF0IHRoZXkgZ2V0IHByb2Nlc3NlZAogICAgICAgIENsYXNzTG9hZGVy\nIGNsc0xvYWRlciA9IF9jb25mLmdldENsYXNzUmVzb2x2ZXJJbnN0YW5jZSgp\nLgogICAgICAgICAgICBnZXRDbGFzc0xvYWRlcihnZXRDbGFzcygpLCBlbnZM\nb2FkZXIpOwogICAgICAgIExpc3QgY2xhc3NlcyA9IG5ldyBBcnJheUxpc3Qo\nbmFtZXMuc2l6ZSgpKTsKICAgICAgICBDbGFzcyBjbHM7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBuYW1lcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICBjbHMgPSBjbGFzc0Zvck5hbWUoKFN0cmlu\nZykgaXRyLm5leHQoKSwgY2xzTG9hZGVyKTsKICAgICAgICAgICAgaWYgKGNs\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgY2xhc3Nlcy5hZGQoY2xzKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNsYXNzZXM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNsYXNzIGZvciB0aGUgZ2l2ZW4gbmFt\nZSwgb3IgbnVsbCBpZiBub3QgbG9hZGFibGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgQ2xhc3MgY2xhc3NGb3JOYW1lKFN0cmluZyBuYW1lLCBDbGFzc0xvYWRl\nciBsb2FkZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nQ2xhc3MuZm9yTmFtZShuYW1lLCB0cnVlLCBsb2FkZXIpOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmICgoX3ZhbGlk\nYXRlICYgVkFMSURBVEVfUlVOVElNRSkgIT0gMCkgewogICAgICAgICAgICAg\nICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nICAgIF9sb2cud2FybihfbG9jLmdldCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwg\nbmFtZSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKF9sb2cuaXNJbmZvRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJi\nYWQtZGlzY292ZXItY2xhc3MiLCBuYW1lKSk7CiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKGUpOwogICAgICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEVycm9yIG5z\nbWUpIHsKICAgICAgICAgICAgaWYgKG5zbWUuZ2V0TWVzc2FnZSgpLmluZGV4\nT2YoIi5wYyIpID09IC0xKQogICAgICAgICAgICAgICAgdGhyb3cgbnNtZTsK\nCiAgICAgICAgICAgIC8vIGlmIHRoZSBlcnJvciBpcyBhYm91dCBhIG1ldGhv\nZCB0aGF0IHVzZXMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZQogICAgICAgICAg\nICAvLyAncGMnIG1ldGhvZCBwcmVmaXgsIHBlcmZvcm0gc29tZSBsb2dnaW5n\nIGFuZCBjb250aW51ZS4gVGhpcwogICAgICAgICAgICAvLyBwcm9iYWJseSBq\ndXN0IG1lYW5zIHRoYXQgdGhlIGNsYXNzIGlzIG5vdCB5ZXQgZW5oYW5jZWQu\nCiAgICAgICAgICAgIGlmICgoX3ZhbGlkYXRlICYgVkFMSURBVEVfUlVOVElN\nRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiYmFkLWRpc2NvdmVyLWNsYXNzIiwgbmFtZSkpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKF9sb2cuaXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJiYWQtZGlzY292ZXItY2xhc3MiLCBu\nYW1lKSk7CiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKG5zbWUpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiBhbGwga25vd24gc3ViY2xhc3NlcyBmb3IgdGhlIGdpdmVuIGNsYXNz\nIG1hcHBpbmcuIE5vdGUKICAgICAqIHRoYXQgdGhpcyBtZXRob2Qgb25seSB3\nb3JrcyBkdXJpbmcgcnVudGltZSB3aGVuIHRoZSByZXBvc2l0b3J5IGlzCiAg\nICAgKiByZWdpc3RlcmVkIGFzIGEge0BsaW5rIFJlZ2lzdGVyQ2xhc3NMaXN0\nZW5lcn0uCiAgICAgKi8KICAgIENvbGxlY3Rpb24gZ2V0UENTdWJjbGFzc2Vz\nKENsYXNzIGNscykgewogICAgICAgIENvbGxlY3Rpb24gc3VicyA9IChDb2xs\nZWN0aW9uKSBfc3Vicy5nZXQoY2xzKTsKICAgICAgICBpZiAoc3VicyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElT\nVDsKICAgICAgICByZXR1cm4gc3ViczsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBSZWdpc3Rl\nckNsYXNzTGlzdGVuZXIgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9p\nZCByZWdpc3RlcihDbGFzcyBjbHMpIHsKICAgICAgICAvLyBidWZmZXIgcmVn\naXN0ZXJlZCBjbGFzc2VzIHVudGlsIGFuIG9pZCBtZXRhZGF0YSByZXF1ZXN0\nIGlzIG1hZGUsCiAgICAgICAgLy8gYXQgd2hpY2ggcG9pbnQgd2UnbGwgcGFy\nc2UgZXZlcnl0aGluZyBpbiB0aGUgYnVmZmVyCiAgICAgICAgc3luY2hyb25p\nemVkIChfcmVnaXN0ZXJlZCkgewogICAgICAgICAgICBfcmVnaXN0ZXJlZEVt\ncHR5ID0gZmFsc2U7CiAgICAgICAgICAgIF9yZWdpc3RlcmVkLmFkZChjbHMp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlcyB0aGUg\nbWV0YWRhdGEgZm9yIGFsbCByZWdpc3RlcmVkIGNsYXNzZXMuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBsb2FkUmVnaXN0ZXJlZENsYXNzTWV0YURhdGEo\nQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgQ2xhc3NbXSByZWcg\nPSBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoZW52TG9hZGVyKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHJlZy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEocmVn\nW2ldLCBlbnZMb2FkZXIsIGZhbHNlKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nTWV0YURhdGFFeGNlcHRpb24gbWUpIHsKICAgICAgICAgICAgICAgIGlmIChf\nbG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9n\nLndhcm4obWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogVXBkYXRlcyBvdXIgZGF0YXN0cnVjdHVyZXMgd2l0aCB0\naGUgbGF0ZXN0IHJlZ2lzdGVyZWQgY2xhc3Nlcy4gVGhpcyBtZXRob2Qgd2ls\nbCBvbmx5IGJsb2NrCiAgICAgKiB3aGVuIHRoZXJlIGFyZSBjbGFzcyByZWdp\nc3RyYXRpb25zIHdhaXRpbmcgdG8gYmUgcHJvY2Vzc2VkLiAKICAgICAqIAog\nICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBjbGFzc2VzIHRoYXQgd2FzIHBy\nb2Nlc3NlZCBkdWUgdG8gdGhpcyBtZXRob2QgY2FsbC4KICAgICAqLwogICAg\nQ2xhc3NbXSBwcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMoQ2xhc3NMb2FkZXIg\nZW52TG9hZGVyKSB7CiAgICAgICAgQ2xhc3NbXSByZXMgPSBFTVBUWV9DTEFT\nU0VTOwogICAgICAgIGlmIChfcmVnaXN0ZXJlZEVtcHR5ID09IGZhbHNlKSB7\nCiAgICAgICAgICAgIC8vIFRoZSByZWFzb24gdGhhdCB3ZSdyZSBsb2NraW5n\nIG9uIHRoaXMgYW5kIF9yZWdpc3RlcmVkIGlzIHRoYXQgdGhpcwogICAgICAg\nICAgICAvLyBjbGFzcyBoYXMgbG9ja2luZyBzZW1hbnRpY3Mgc3VjaCB0aGF0\nIHdlIGFsd2F5cyBuZWVkIHRvIGxvY2sgJ3RoaXMnLCB0aGVuIFt4XS4KICAg\nICAgICAgICAgLy8gVGhpcyBtZXRob2QgY2FuIHJlc3VsdCBpbiBwcm9jZXNz\nUmVnaXN0ZXJlZENsYXNzKC4uKSBiZWluZyBjYWxsZWQgYW5kIGlmIHdlIGRp\nZG4ndAogICAgICAgICAgICAvLyBsb2NrIG9uICd0aGlzJyB3ZSBjb3VsZCBj\nYXVzZSBhIGRlYWRsb2NrLiBpZTogT25lIHRocmVhZCBjb21pbmcgaW4gb24g\nZ2V0U2VxdWVuY2VNZXRhRGF0YSguLikgCiAgICAgICAgICAgIC8vIGFuZCBh\nbm90aGVyIG9uIGdldE1ldGFEYXRhKFN0cmluZyAsIENsYXNzTG9hZGVyICwg\nYm9vbGVhbiApIC4KICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpewog\nICAgICAgICAgICAgICAgc3luY2hyb25pemVkKF9yZWdpc3RlcmVkKXsKICAg\nICAgICAgICAgICAgICAgICAvLyBDaGVjayBhZ2FpbiwgaXQgaXMgcG9zc2li\nbGUgYW5vdGhlciB0aHJlYWQgYWxyZWFkeSBwcm9jZXNzZWQuCiAgICAgICAg\nICAgICAgICAgICAgaWYgKF9yZWdpc3RlcmVkRW1wdHkgPT0gZmFsc2UpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmVzID0gcHJvY2Vzc1JlZ2lzdGVy\nZWRDbGFzc2VzSW50ZXJuYWwoZW52TG9hZGVyKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKF9yZWdpc3RlcmVkLnNpemUoKSA9PSAwKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBJdCBpcyBwb3NzaWJsZSB0aGF0\nIHdlIGZhaWxlZCB0byByZWdpc3RlciBhIGNsYXNzIGFuZCBpdCB3YXMgYWRk\nZWQgYmFjayBpbnRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBv\ndXIgX3JlZ2lzdGVyZWQgY2xhc3MgbGlzdCB0byB0cnkgYWdhaW4gbGF0ZXIu\nIEBzZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9wZW5KUEFD\nb25maWd1cmF0aW9uI2dldFJldHJ5Q2xhc3NSZWdpc3RyYXRpb24KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF9yZWdpc3RlcmVkRW1wdHkgPSB0cnVl\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CiAgICAgICAgIAogICAgLyoq\nCiAgICAgKiBQcml2YXRlIHdvcmtlciBtZXRob2QgdGhhdCBwcm9jZXNzZXMg\ndGhlIHJlZ2lzdGVyZWQgY2xhc3NlcyBsaXN0LiBObyBsb2NraW5nIGlzIHBl\ncmZvcm1lZCBpbiB0aGlzCiAgICAgKiBtZXRob2QgYXMgdGhlIGNhbGxlciBu\nZWVkcyB0byBob2xkIGEgbG9jayBvbiBfcmVnaXN0ZXJlZC4KICAgICAqLwog\nICAgcHJpdmF0ZSBDbGFzc1tdIHByb2Nlc3NSZWdpc3RlcmVkQ2xhc3Nlc0lu\ndGVybmFsKENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAgICAgIC8vIFBy\nb2JhYmx5IG92ZXJraWxsCiAgICAgICAgaWYgKF9yZWdpc3RlcmVkLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0NMQVNTRVM7CgogICAg\nICAgIC8vIGNvcHkgaW50byBuZXcgY29sbGVjdGlvbiB0byBhdm9pZCBjb25j\ndXJyZW50IG1vZCBlcnJvcnMgb24gcmVlbnRyYW50CiAgICAgICAgLy8gcmVn\naXN0cmF0aW9ucwogICAgICAgIENsYXNzW10gcmVnID0gKENsYXNzW10pIF9y\nZWdpc3RlcmVkLnRvQXJyYXkobmV3IENsYXNzW19yZWdpc3RlcmVkLnNpemUo\nKV0pOwogICAgICAgIF9yZWdpc3RlcmVkLmNsZWFyKCk7CgogICAgICAgIENv\nbGxlY3Rpb24gcGNOYW1lcyA9IGdldFBlcnNpc3RlbnRUeXBlTmFtZXMoZmFs\nc2UsIGVudkxvYWRlcik7CiAgICAgICAgQ29sbGVjdGlvbiBmYWlsZWQgPSBu\ndWxsOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcmVnLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIC8vIGRvbid0IHByb2Nlc3MgdHlwZXMgdGhh\ndCBhcmVuJ3QgbGlzdGVkIGJ5IHRoZSB1c2VyOyBtYXkgYmVsb25nCiAgICAg\nICAgICAgIC8vIHRvIGEgZGlmZmVyZW50IHBlcnNpc3RlbmNlIHVuaXQKICAg\nICAgICAgICAgaWYgKHBjTmFtZXMgIT0gbnVsbCAmJiAhcGNOYW1lcy5pc0Vt\ncHR5KCkKICAgICAgICAgICAgICAgICYmICFwY05hbWVzLmNvbnRhaW5zKHJl\nZ1tpXS5nZXROYW1lKCkpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcHJvY2Vzc1JlZ2lz\ndGVyZWRDbGFzcyhyZWdbaV0pOwogICAgICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgICAgICAgICAgaWYgKCFfY29uZi5nZXRSZXRy\neUNsYXNzUmVnaXN0cmF0aW9uKCkpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJlcnJvci1yZWdp\nc3RlcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVnW2ldKSwgdCk7\nCgogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZmFpbGVk\nLXJlZ2lzdGVyZWQiLCByZWdbaV0pLCB0KTsKICAgICAgICAgICAgICAgIGlm\nIChmYWlsZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmYWlsZWQg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgICAgICBmYWlsZWQuYWRk\nKHJlZ1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKGZhaWxlZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfcmVnaXN0ZXJl\nZC5hZGRBbGwoZmFpbGVkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJl\nZzsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZXMgb3VyIGRhdGFzdHJ1\nY3R1cmVzIHdpdGggdGhlIGdpdmVuIHJlZ2lzdGVyZWQgY2xhc3MuCiAgICAg\nKiBSZWxpZXMgb24gdGhlIGZhY3QgdGhhdCBhIGNoaWxkIGNsYXNzIGNhbm5v\ndCByZWdpc3RlciBpdHNlbGYgd2l0aG91dAogICAgICogYWxzbyByZWdpc3Rl\ncmluZyBpdHMgcGFyZW50IGNsYXNzIGJ5IHNwZWNpZnlpbmcgaXRzIHBlcnNp\nc3RlbmNlCiAgICAgKiBjYXBhYmxlIHN1cGVyY2xhc3MgaW4gdGhlIHJlZ2lz\ndHJhdGlvbiBldmVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHByb2Nl\nc3NSZWdpc3RlcmVkQ2xhc3MoQ2xhc3MgY2xzKSB7CiAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFjZShf\nbG9jLmdldCgicHJvY2Vzcy1yZWdpc3RlcmVkIiwgY2xzKSk7CgogICAgICAg\nIC8vIHVwZGF0ZSBzdWJjbGFzcyBsaXN0czsgc3luY2hyb25pemUgb24gdGhp\ncyBiZWNhdXNlIGFjY2Vzc2luZyBfbWV0YXMKICAgICAgICAvLyByZXF1aXJl\ncyBpdAogICAgICAgIENsYXNzIGxlYXN0RGVyaXZlZCA9IGNsczsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBtZXRhOwogICAgICAgICAgICBmb3IgKENsYXNzIGFuYyA9IGNsczsK\nICAgICAgICAgICAgICAgIChhbmMgPSBQQ1JlZ2lzdHJ5LmdldFBlcnNpc3Rl\nbnRTdXBlcmNsYXNzKGFuYykpICE9IG51bGw7KSB7CiAgICAgICAgICAgICAg\nICBhZGRUb0NvbGxlY3Rpb24oX3N1YnMsIGFuYywgY2xzLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIG1ldGEgPSAoQ2xhc3NNZXRhRGF0YSkgX21ldGFzLmdl\ndChhbmMpOwogICAgICAgICAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBtZXRhLmNsZWFyU3ViY2xhc3NDYWNoZSgpOwog\nICAgICAgICAgICAgICAgbGVhc3REZXJpdmVkID0gYW5jOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICAvLyB1cGRhdGUgb2lkIG1hcHBpbmdz\nIGlmIHRoaXMgaXMgYSBiYXNlIGNvbmNyZXRlIGNsYXNzCiAgICAgICAgT2Jq\nZWN0IG9pZCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lk\nID0gUENSZWdpc3RyeS5uZXdPYmplY3RJZChjbHMpOwogICAgICAgIH0gY2F0\nY2ggKEludGVybmFsRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIC8vIHRo\ncm93biBmb3Igc2luZ2xlIGZpZWxkIGlkZW50aXR5IHdpdGggbnVsbCBwayBm\naWVsZCB2YWx1ZQogICAgICAgIH0KICAgICAgICBpZiAob2lkICE9IG51bGwp\nIHsKICAgICAgICAgICAgQ2xhc3MgZXhpc3RpbmcgPSAoQ2xhc3MpIF9vaWRz\nLmdldChvaWQuZ2V0Q2xhc3MoKSk7CiAgICAgICAgICAgIGlmIChleGlzdGlu\nZyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBh\nbHJlYWR5IGEgY2xhc3MgZm9yIHRoaXMgT0lELCB0aGVuIHdlIGtub3cKICAg\nICAgICAgICAgICAgIC8vIHRoYXQgbXVsdGlwbGUgY2xhc3NlcyBhcmUgdXNp\nbmcgdGhlIHNhbWUgT0lEOiB0aGVyZWZvcmUsCiAgICAgICAgICAgICAgICAv\nLyBwdXQgdGhlIGxlYXN0IGRlcml2ZWQgUEMgc3VwZXJjbGFzcyBpbnRvIHRo\nZSBtYXAuIFRoaXMKICAgICAgICAgICAgICAgIC8vIGdldHMgYXJvdW5kIHRo\nZSBwcm9ibGVtIG9mIGFuIGFic3RyYWN0IFBDIHN1cGVyY2xhc3MKICAgICAg\nICAgICAgICAgIC8vIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50aXR5IChzaW5j\nZSBuZXdPYmplY3RJZAogICAgICAgICAgICAgICAgLy8gd2lsbCByZXR1cm4g\nbnVsbCBmb3IgYWJzdHJhY3QgY2xhc3NlcykuCiAgICAgICAgICAgICAgICBD\nbGFzcyBzdXAgPSBjbHM7CiAgICAgICAgICAgICAgICB3aGlsZSAoUENSZWdp\nc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJjbGFzcyhzdXApICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgc3VwID0gUENSZWdpc3RyeS5nZXRQZXJzaXN0\nZW50U3VwZXJjbGFzcyhzdXApOwoKICAgICAgICAgICAgICAgIF9vaWRzLnB1\ndChvaWQuZ2V0Q2xhc3MoKSwgc3VwKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChleGlzdGluZyA9PSBudWxsIHx8IGNscy5pc0Fzc2lnbmFibGVGcm9tKGV4\naXN0aW5nKSkKICAgICAgICAgICAgICAgIF9vaWRzLnB1dChvaWQuZ2V0Q2xh\nc3MoKSwgY2xzKTsKICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBtYXBw\naW5ncyBmcm9tIGludGVyZmFjZXMgYW5kIG5vbi1wYyBzdXBlcmNsYXNzZXMg\ndG8KICAgICAgICAvLyBwYyBpbXBsZW1lbnRpbmcgdHlwZXMKICAgICAgICBz\neW5jaHJvbml6ZWQgKF9pbXBscykgewogICAgICAgICAgICB1cGRhdGVJbXBs\ncyhjbHMsIGxlYXN0RGVyaXZlZCwgY2xzKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHNldCBhbGlhcyBmb3IgY2xhc3MKICAgICAgICBTdHJpbmcgYWxpYXMg\nPSBQQ1JlZ2lzdHJ5LmdldFR5cGVBbGlhcyhjbHMpOwogICAgICAgIGlmIChh\nbGlhcyAhPSBudWxsKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoX2Fs\naWFzZXMpIHsKICAgICAgICAgICAgICAgIExpc3QgY2xhc3NMaXN0ID0gKExp\nc3QpIF9hbGlhc2VzLmdldChhbGlhcyk7CiAgICAgICAgICAgICAgICBpZiAo\nY2xhc3NMaXN0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjbGFz\nc0xpc3QgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICAgICAgICAg\nIF9hbGlhc2VzLnB1dChhbGlhcywgY2xhc3NMaXN0KTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5z\nKGNscykpCiAgICAgICAgICAgICAgICAgICAgY2xhc3NMaXN0LmFkZChjbHMp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVXBkYXRlIHRoZSBsaXN0IG9mIGltcGxlbWVudGF0aW9ucyBvZiBiYXNl\nIGNsYXNzZXMgYW5kIGludGVyZmFjZXMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB1cGRhdGVJbXBscyhDbGFzcyBjbHMsIENsYXNzIGxlYXN0RGVyaXZl\nZCwgQ2xhc3MgY2hlY2spIHsKICAgICAgICAvLyBhbGxvdyB1c2VycyB0byBx\ndWVyeSBvbiBjb21tb24gbm9uLXBjIHN1cGVyY2xhc3NlcwogICAgICAgIENs\nYXNzIHN1cCA9IGNoZWNrLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICBpZiAo\nbGVhc3REZXJpdmVkID09IGNscyAmJiBzdXAgIT0gbnVsbCAmJiBzdXAgIT0g\nT2JqZWN0LmNsYXNzKSB7CiAgICAgICAgICAgIGFkZFRvQ29sbGVjdGlvbihf\naW1wbHMsIHN1cCwgY2xzLCBmYWxzZSk7CiAgICAgICAgICAgIHVwZGF0ZUlt\ncGxzKGNscywgbGVhc3REZXJpdmVkLCBzdXApOwogICAgICAgIH0KCiAgICAg\nICAgLy8gYWxsb3cgdXNlcnMgdG8gcXVlcnkgb24gYW55IGltcGxlbWVudGVk\nIGludGVyZmFjZXMgdW5sZXNzIGRlZmF1bHRzIAogICAgICAgIC8vIHNheSB0\naGUgdXNlciBtdXN0IGltcGxlbWVudCBwZXJzaXN0ZW50IGludGVyZmFjZXMg\nZXhwbGljaXRseSBpbiBtZXRhCiAgICAgICAgaWYgKCFfZmFjdG9yeS5nZXRE\nZWZhdWx0cygpLmlzRGVjbGFyZWRJbnRlcmZhY2VQZXJzaXN0ZW50KCkpCiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICBDbGFzc1tdIGludHMgPSBjaGVj\nay5nZXRJbnRlcmZhY2VzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBpbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGRvbid0IG1h\ncCBqYXZhLXN0YW5kYXJkIGludGVyZmFjZXMKICAgICAgICAgICAgaWYgKGlu\ndHNbaV0uZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoImphdmEuIikpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIG9ubHkgbWFwIGxl\nYXN0LWRlcml2ZWQgaW50ZXJmYWNlIGltcGxlbWVudG9ycwogICAgICAgICAg\nICBpZiAobGVhc3REZXJpdmVkID09IGNscyB8fCBpc0xlYXN0RGVyaXZlZElt\ncGwoaW50c1tpXSwgY2xzKSkgewogICAgICAgICAgICAgICAgYWRkVG9Db2xs\nZWN0aW9uKF9pbXBscywgaW50c1tpXSwgY2xzLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICB1cGRhdGVJbXBscyhjbHMsIGxlYXN0RGVyaXZlZCwgaW50c1tp\nXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gY2xhc3MgaXMgdGhlIGxl\nYXN0LWRlcml2ZWQgcGVyc2lzdGVudAogICAgICogaW1wbGVtZW50b3Igb2Yg\ndGhlIGdpdmVuIGludGVyZmFjZSwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICov\nCiAgICBwcml2YXRlIGJvb2xlYW4gaXNMZWFzdERlcml2ZWRJbXBsKENsYXNz\nIGludGVyLCBDbGFzcyBjbHMpIHsKICAgICAgICBDbGFzcyBwYXJlbnQgPSBQ\nQ1JlZ2lzdHJ5LmdldFBlcnNpc3RlbnRTdXBlcmNsYXNzKGNscyk7CiAgICAg\nICAgd2hpbGUgKHBhcmVudCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChB\ncnJheXMuYXNMaXN0KHBhcmVudC5nZXRJbnRlcmZhY2VzKCkpLmNvbnRhaW5z\nKGludGVyKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgcGFyZW50ID0gUENSZWdpc3RyeS5nZXRQZXJzaXN0ZW50U3VwZXJj\nbGFzcyhwYXJlbnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gdmFsdWUgdG8g\ndGhlIGNvbGxlY3Rpb24gY2FjaGVkIGluIHRoZSBnaXZlbiBtYXAgdW5kZXIK\nICAgICAqIHRoZSBnaXZlbiBrZXkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRUb0NvbGxlY3Rpb24oTWFwIG1hcCwgQ2xhc3Mga2V5LCBDbGFzcyB2\nYWx1ZSwKICAgICAgICBib29sZWFuIGluaGVyaXRhbmNlKSB7CiAgICAgICAg\nc3luY2hyb25pemVkIChtYXApIHsKICAgICAgICAgICAgQ29sbGVjdGlvbiBj\nb2xsID0gKENvbGxlY3Rpb24pIG1hcC5nZXQoa2V5KTsKICAgICAgICAgICAg\naWYgKGNvbGwgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGluaGVy\naXRhbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgSW5oZXJpdGFuY2VDb21w\nYXJhdG9yIGNvbXAgPSBuZXcgSW5oZXJpdGFuY2VDb21wYXJhdG9yKCk7CiAg\nICAgICAgICAgICAgICAgICAgY29tcC5zZXRCYXNlKGtleSk7CiAgICAgICAg\nICAgICAgICAgICAgY29sbCA9IG5ldyBUcmVlU2V0KGNvbXApOwogICAgICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgY29sbCA9IG5l\ndyBMaW5rZWRMaXN0KCk7CiAgICAgICAgICAgICAgICBtYXAucHV0KGtleSwg\nY29sbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29sbC5hZGQodmFs\ndWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCiAgICAvLyBDb25maWd1cmFibGUgaW1wbGVtZW50YXRp\nb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgdm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29u\nZikgewogICAgICAgIF9jb25mID0gKE9wZW5KUEFDb25maWd1cmF0aW9uKSBj\nb25mOwogICAgICAgIF9sb2cgPSBfY29uZi5nZXRMb2coT3BlbkpQQUNvbmZp\nZ3VyYXRpb24uTE9HX01FVEFEQVRBKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdGFydENvbmZpZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZv\naWQgZW5kQ29uZmlndXJhdGlvbigpIHsKICAgICAgICBpbml0aWFsaXplTWV0\nYURhdGFGYWN0b3J5KCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGluaXRp\nYWxpemVNZXRhRGF0YUZhY3RvcnkoKSB7CiAgICAgICAgaWYgKF9mYWN0b3J5\nID09IG51bGwpIHsKICAgICAgICAgICAgTWV0YURhdGFGYWN0b3J5IG1kZiA9\nIF9jb25mLm5ld01ldGFEYXRhRmFjdG9yeUluc3RhbmNlKCk7CiAgICAgICAg\nICAgIGlmIChtZGYgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbWV0YWRhdGFmYWN0\nb3J5IikpOwogICAgICAgICAgICBzZXRNZXRhRGF0YUZhY3RvcnkobWRmKTsK\nICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAv\nLyBRdWVyeSBtZXRhZGF0YQogICAgLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gcXVlcnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZl\nbiBjbGFzcywgbmFtZSwgYW5kIGNsYXNzbG9hZGVyLgogICAgICovCiAgICBw\ndWJsaWMgc3luY2hyb25pemVkIFF1ZXJ5TWV0YURhdGEgZ2V0UXVlcnlNZXRh\nRGF0YShDbGFzcyBjbHMsIFN0cmluZyBuYW1lLAogICAgICAgIENsYXNzTG9h\nZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICBR\ndWVyeU1ldGFEYXRhIG1ldGEgPSBnZXRRdWVyeU1ldGFEYXRhSW50ZXJuYWwo\nY2xzLCBuYW1lLCBlbnZMb2FkZXIpOwogICAgICAgIGlmIChtZXRhID09IG51\nbGwpIHsKICAgICAgICAgICAgLy8gbG9hZCBhbGwgdGhlIG1ldGFkYXRhcyBm\nb3IgYWxsIHRoZSBrbm93biBjbGFzc2VzIHNvIHRoYXQKICAgICAgICAgICAg\nLy8gcXVlcnkgbmFtZXMgYXJlIHNlZW4gYW5kIHJlZ2lzdGVyZWQKICAgICAg\nICAgICAgcmVzb2x2ZUFsbChlbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRh\nID0gZ2V0UXVlcnlNZXRhRGF0YUludGVybmFsKGNscywgbmFtZSwgZW52TG9h\nZGVyKTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXRhID09IG51bGwgJiYg\nbXVzdEV4aXN0KSB7CiAgICAgICAgICAgIGlmIChjbHMgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgKCJuby1uYW1lZC1xdWVyeS1u\ndWxsLWNsYXNzIiwgCiAgICAgICAgICAgICAgICAgICAgICAgIGdldFBlcnNp\nc3RlbnRUeXBlTmFtZXMoZmFsc2UsIGVudkxvYWRlciksIG5hbWUpKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmFtZWQtcXVlcnkiLAog\nICAgICAgICAgICAgICAgICAgIGNscywgbmFtZSkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAv\nKiogCiAgICAgKiBSZXNvbHZlIGFsbCBrbm93biBtZXRhZGF0YSBjbGFzc2Vz\nLiAKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVBbGwoQ2xhc3NM\nb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgQ29sbGVjdGlvbiB0eXBlcyA9\nIGxvYWRQZXJzaXN0ZW50VHlwZXMoZmFsc2UsIGVudkxvYWRlcik7CiAgICAg\nICAgZm9yIChJdGVyYXRvciBpID0gdHlwZXMuaXRlcmF0b3IoKTsgaS5oYXNO\nZXh0KCk7ICkgewogICAgICAgICAgICBDbGFzcyBjID0gKENsYXNzKSBpLm5l\neHQoKTsKICAgICAgICAgICAgZ2V0TWV0YURhdGEoYywgZW52TG9hZGVyLCBm\nYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHF1ZXJ5IG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MsIG5hbWUsIGFu\nZCBjbGFzc2xvYWRlci4KICAgICAqLwogICAgcHJpdmF0ZSBRdWVyeU1ldGFE\nYXRhIGdldFF1ZXJ5TWV0YURhdGFJbnRlcm5hbChDbGFzcyBjbHMsIFN0cmlu\nZyBuYW1lLAogICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlcikgewogICAg\nICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICAvLyBjaGVjayBjYWNoZQogICAgICAgIE9iamVjdCBrZXkg\nPSBnZXRRdWVyeUtleShjbHMsIG5hbWUpOwogICAgICAgIFF1ZXJ5TWV0YURh\ndGEgcW0gPSAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0KGtleSk7CiAg\nICAgICAgaWYgKHFtICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBxbTsK\nCiAgICAgICAgLy8gZ2V0IG1ldGFkYXRhIGZvciBjbGFzcywgd2hpY2ggd2ls\nbCBmaW5kIHF1ZXJpZXMgaW4gbWV0YWRhdGEgZmlsZQogICAgICAgIGlmIChj\nbHMgIT0gbnVsbCAmJiBnZXRNZXRhRGF0YShjbHMsIGVudkxvYWRlciwgZmFs\nc2UpICE9IG51bGwpIHsKICAgICAgICAgICAgcW0gPSAoUXVlcnlNZXRhRGF0\nYSkgX3F1ZXJpZXMuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChxbSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHFtOwogICAgICAgIH0KICAg\nICAgICBpZiAoKF9zb3VyY2VNb2RlICYgTU9ERV9RVUVSWSkgPT0gMCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHNlZSBpZiBmYWN0\nb3J5IGNhbiBmaWd1cmUgb3V0IGEgc2NvcGUgZm9yIHRoaXMgcXVlcnkKICAg\nICAgICBpZiAoY2xzID09IG51bGwpCiAgICAgICAgICAgIGNscyA9IF9mYWN0\nb3J5LmdldFF1ZXJ5U2NvcGUobmFtZSwgZW52TG9hZGVyKTsKCiAgICAgICAg\nLy8gbm90IGluIGNhY2hlOyBsb2FkCiAgICAgICAgX2ZhY3RvcnkubG9hZChj\nbHMsIE1PREVfUVVFUlksIGVudkxvYWRlcik7CiAgICAgICAgcmV0dXJuIChR\ndWVyeU1ldGFEYXRhKSBfcXVlcmllcy5nZXQoa2V5KTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHF1ZXJ5IG1ldGFkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFF1ZXJ5TWV0YURhdGFb\nXSBnZXRRdWVyeU1ldGFEYXRhcygpIHsKICAgICAgICByZXR1cm4gKFF1ZXJ5\nTWV0YURhdGFbXSkgX3F1ZXJpZXMudmFsdWVzKCkudG9BcnJheQogICAgICAg\nICAgICAobmV3IFF1ZXJ5TWV0YURhdGFbX3F1ZXJpZXMuc2l6ZSgpXSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlZCBxdWVyeSBt\nZXRhZGF0YSBmb3IgdGhlIGdpdmVuIG5hbWUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgUXVlcnlNZXRhRGF0YSBnZXRDYWNoZWRRdWVyeU1l\ndGFEYXRhKENsYXNzIGNscywKICAgICAgICBTdHJpbmcgbmFtZSkgewogICAg\nICAgIHJldHVybiAoUXVlcnlNZXRhRGF0YSkgX3F1ZXJpZXMuZ2V0KGdldFF1\nZXJ5S2V5KGNscywgbmFtZSkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIGEgbmV3IHF1ZXJ5IG1ldGFkYXRhIHRvIHRoZSByZXBvc2l0b3J5IGFuZCBy\nZXR1cm4gaXQuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgUXVl\ncnlNZXRhRGF0YSBhZGRRdWVyeU1ldGFEYXRhKENsYXNzIGNscywgU3RyaW5n\nIG5hbWUpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGEgPSBuZXdRdWVy\neU1ldGFEYXRhKGNscywgbmFtZSk7CiAgICAgICAgX3F1ZXJpZXMucHV0KGdl\ndFF1ZXJ5S2V5KG1ldGEpLCBtZXRhKTsKICAgICAgICByZXR1cm4gbWV0YTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBxdWVyeSBtZXRh\nZGF0YSBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFF1ZXJ5TWV0\nYURhdGEgbmV3UXVlcnlNZXRhRGF0YShDbGFzcyBjbHMsIFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRhID0gbmV3IFF1ZXJ5TWV0\nYURhdGEobmFtZSk7CiAgICAgICAgbWV0YS5zZXREZWZpbmluZ1R5cGUoY2xz\nKTsKICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlbW92ZSB0aGUgZ2l2ZW4gcXVlcnkgbWV0YWRhdGEgZnJvbSB0aGUgcmVw\nb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBib29s\nZWFuIHJlbW92ZVF1ZXJ5TWV0YURhdGEoUXVlcnlNZXRhRGF0YSBtZXRhKSB7\nCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiBfcXVlcmllcy5yZW1vdmUoZ2V0UXVl\ncnlLZXkobWV0YSkpICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgcXVlcnkgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcyBuYW1l\nIGlmIGluIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgc3lu\nY2hyb25pemVkIGJvb2xlYW4gcmVtb3ZlUXVlcnlNZXRhRGF0YShDbGFzcyBj\nbHMsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfcXVl\ncmllcy5yZW1vdmUoZ2V0UXVlcnlLZXkoY2xzLCBuYW1lKSkgIT0gbnVsbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHVuaXF1ZSBrZXkgZm9y\nIGEgZ2l2ZW4gUXVlcnlNZXRhRGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgT2JqZWN0IGdldFF1ZXJ5S2V5KFF1ZXJ5TWV0YURhdGEgbWV0YSkg\newogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHJldHVybiBnZXRRdWVyeUtleShtZXRhLmdldERl\nZmluaW5nVHlwZSgpLCBtZXRhLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSB1bmlxdWUga2V5IGZvciBhIGdpdmVuIGNsYXNz\nIC8gbmFtZS4gVGhlIGNsYXNzCiAgICAgKiBhcmd1bWVudCBjYW4gYmUgbnVs\nbC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBPYmplY3QgZ2V0UXVl\ncnlLZXkoQ2xhc3MgY2xzLCBTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChj\nbHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICAgICAg\nUXVlcnlLZXkga2V5ID0gbmV3IFF1ZXJ5S2V5KCk7CiAgICAgICAga2V5LmNs\nc05hbWUgPSBjbHMuZ2V0TmFtZSgpOwogICAgICAgIGtleS5uYW1lID0gbmFt\nZTsKICAgICAgICByZXR1cm4ga2V5OwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gU2VxdWVuY2UgbWV0YWRhdGEKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHNlcXVl\nbmNlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZSBhbmQgY2xhc3Nsb2Fk\nZXIuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgU2VxdWVuY2VN\nZXRhRGF0YSBnZXRTZXF1ZW5jZU1ldGFEYXRhKFN0cmluZyBuYW1lLAogICAg\nICAgIENsYXNzTG9hZGVyIGVudkxvYWRlciwgYm9vbGVhbiBtdXN0RXhpc3Qp\nIHsKICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSBnZXRTZXF1ZW5j\nZU1ldGFEYXRhSW50ZXJuYWwobmFtZSwgZW52TG9hZGVyKTsKICAgICAgICBp\nZiAobWV0YSA9PSBudWxsICYmIFNlcXVlbmNlTWV0YURhdGEuTkFNRV9TWVNU\nRU0uZXF1YWxzKG5hbWUpKSB7CiAgICAgICAgICAgIGlmIChfc3lzU2VxID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfc3lzU2VxID0gbmV3U2VxdWVuY2VN\nZXRhRGF0YShuYW1lKTsKICAgICAgICAgICAgcmV0dXJuIF9zeXNTZXE7CiAg\nICAgICAgfQogICAgICAgIGlmIChtZXRhID09IG51bGwgJiYgbXVzdEV4aXN0\nKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoIm5vLW5hbWVkLXNlcXVlbmNlIiwgbmFtZSkpOwogICAgICAgIHJl\ndHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogVXNlZCBpbnRlcm5h\nbGx5IGJ5IG1ldGFkYXRhIHRvIHJldHJpZXZlIHNlcXVlbmNlIG1ldGFkYXRh\ncyBiYXNlZCBvbgogICAgICogcG9zc2libHktdW5xdWFsaWZpZWQgc2VxdWVu\nY2UgbmFtZS4KICAgICAqLwogICAgU2VxdWVuY2VNZXRhRGF0YSBnZXRTZXF1\nZW5jZU1ldGFEYXRhKENsYXNzTWV0YURhdGEgY29udGV4dCwgU3RyaW5nIG5h\nbWUsCiAgICAgICAgYm9vbGVhbiBtdXN0RXhpc3QpIHsKICAgICAgICAvLyB0\ncnkgd2l0aCBnaXZlbiBuYW1lCiAgICAgICAgTWV0YURhdGFFeGNlcHRpb24g\nZSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU2VxdWVuY2VN\nZXRhRGF0YSBzZXEgPSBnZXRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUsCiAgICAg\nICAgICAgICAgICBjb250ZXh0LmdldEVudkNsYXNzTG9hZGVyKCksIG11c3RF\neGlzdCk7CiAgICAgICAgICAgIGlmIChzZXEgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBzZXE7CiAgICAgICAgfSBjYXRjaCAoTWV0YURhdGFF\neGNlcHRpb24gbWRlKSB7CiAgICAgICAgICAgIGUgPSBtZGU7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiBnaXZlbiBuYW1lIGFscmVhZHkgZnVsbHkgcXVh\nbGlmaWVkLCBnaXZlIHVwCiAgICAgICAgaWYgKG5hbWUuaW5kZXhPZignLicp\nICE9IC0xKSB7CiAgICAgICAgICAgIGlmIChlICE9IG51bGwpCiAgICAgICAg\nICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICB9CgogICAgICAgIC8vIHRyeSB3aXRoIHF1YWxpZmllZCBuYW1lCiAg\nICAgICAgbmFtZSA9IFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoY29udGV4dC5n\nZXREZXNjcmliZWRUeXBlKCkpCiAgICAgICAgICAgICsgIi4iICsgbmFtZTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2VN\nZXRhRGF0YShuYW1lLCBjb250ZXh0LmdldEVudkNsYXNzTG9hZGVyKCksCiAg\nICAgICAgICAgICAgICBtdXN0RXhpc3QpOwogICAgICAgIH0gY2F0Y2ggKE1l\ndGFEYXRhRXhjZXB0aW9uIG1kZSkgewogICAgICAgICAgICAvLyB0aHJvdyBv\ncmlnaW5hbCBleGNlcHRpb24KICAgICAgICAgICAgaWYgKGUgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIHRocm93IG1k\nZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gc2Vx\ndWVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBuYW1lIGFuZCBjbGFzc2xv\nYWRlci4KICAgICAqLwogICAgcHJpdmF0ZSBTZXF1ZW5jZU1ldGFEYXRhIGdl\ndFNlcXVlbmNlTWV0YURhdGFJbnRlcm5hbChTdHJpbmcgbmFtZSwKICAgICAg\nICBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAobmFtZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8g\nY2hlY2sgY2FjaGUKICAgICAgICBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEgPSAo\nU2VxdWVuY2VNZXRhRGF0YSkgX3NlcXMuZ2V0KG5hbWUpOwogICAgICAgIGlm\nIChtZXRhID09IG51bGwpIHsKICAgICAgICAgICAgLy8gbG9hZCBtZXRhZGF0\nYSBmb3IgcmVnaXN0ZXJlZCBjbGFzc2VzIHRvIGhvcGVmdWxseSBmaW5kIHNl\ncXVlbmNlCiAgICAgICAgICAgIC8vIGRlZmluaXRpb24KICAgICAgICAgICAg\nbG9hZFJlZ2lzdGVyZWRDbGFzc01ldGFEYXRhKGVudkxvYWRlcik7CiAgICAg\nICAgICAgIG1ldGEgPSAoU2VxdWVuY2VNZXRhRGF0YSkgX3NlcXMuZ2V0KG5h\nbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIHNlcXVlbmNlIG1ldGFk\nYXRhLgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFNlcXVlbmNl\nTWV0YURhdGFbXSBnZXRTZXF1ZW5jZU1ldGFEYXRhcygpIHsKICAgICAgICBy\nZXR1cm4gKFNlcXVlbmNlTWV0YURhdGFbXSkgX3NlcXMudmFsdWVzKCkudG9B\ncnJheQogICAgICAgICAgICAobmV3IFNlcXVlbmNlTWV0YURhdGFbX3NlcXMu\nc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNh\nY2hlZCBhIHNlcXVlbmNlIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gbmFtZS4K\nICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCBTZXF1ZW5jZU1ldGFE\nYXRhIGdldENhY2hlZFNlcXVlbmNlTWV0YURhdGEoCiAgICAgICAgU3RyaW5n\nIG5hbWUpIHsKICAgICAgICByZXR1cm4gKFNlcXVlbmNlTWV0YURhdGEpIF9z\nZXFzLmdldChuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG5l\ndyBzZXF1ZW5jZSBtZXRhZGF0YSB0byB0aGUgcmVwb3NpdG9yeSBhbmQgcmV0\ndXJuIGl0LgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25pemVkIFNlcXVl\nbmNlTWV0YURhdGEgYWRkU2VxdWVuY2VNZXRhRGF0YShTdHJpbmcgbmFtZSkg\newogICAgICAgIFNlcXVlbmNlTWV0YURhdGEgbWV0YSA9IG5ld1NlcXVlbmNl\nTWV0YURhdGEobmFtZSk7CiAgICAgICAgX3NlcXMucHV0KG5hbWUsIG1ldGEp\nOwogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IHNlcXVlbmNlIG1ldGFkYXRhIGluc3RhbmNlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2VNZXRhRGF0YSBuZXdTZXF1ZW5j\nZU1ldGFEYXRhKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5ldyBT\nZXF1ZW5jZU1ldGFEYXRhKG5hbWUsIHRoaXMpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIHRoZSBnaXZlbiBzZXF1ZW5jZSBtZXRhZGF0YSBmcm9t\nIHRoZSByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIGJvb2xlYW4gcmVtb3ZlU2VxdWVuY2VNZXRhRGF0YShTZXF1ZW5jZU1l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIF9zZXFzLnJl\nbW92ZShtZXRhLmdldE5hbWUoKSkgIT0gbnVsbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJlbW92ZSBzZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIG5hbWUg\naWYgaW4gdGhlIHJlcG9zaXRvcnkuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5j\naHJvbml6ZWQgYm9vbGVhbiByZW1vdmVTZXF1ZW5jZU1ldGFEYXRhKFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfc2Vxcy5yZW1vdmUo\nbmFtZSkgIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUg\nZ2l2ZW4gc3lzdGVtIGxpZmVjeWNsZSBsaXN0ZW5lci4KICAgICAqLwogICAg\ncHVibGljIHN5bmNocm9uaXplZCB2b2lkIGFkZFN5c3RlbUxpc3RlbmVyKE9i\namVjdCBsaXN0ZW5lcikgewogICAgICAgIC8vIGNvcHkgdG8gYXZvaWQgaXNz\ndWVzIHdpdGggTGlzdGVuZXJMaXN0IGFuZCBhdm9pZCB1bm5jZXNzYXJ5CiAg\nICAgICAgLy8gbG9ja2luZyBvbiB0aGUgbGlzdCBkdXJpbmcgcnVudGltZQog\nICAgICAgIExpZmVjeWNsZUV2ZW50TWFuYWdlci5MaXN0ZW5lckxpc3QgbGlz\ndGVuZXJzID0gbmV3CiAgICAgICAgICAgIExpZmVjeWNsZUV2ZW50TWFuYWdl\nci5MaXN0ZW5lckxpc3QoX2xpc3RlbmVycyk7CiAgICAgICAgbGlzdGVuZXJz\nLmFkZChsaXN0ZW5lcik7CiAgICAgICAgX2xpc3RlbmVycyA9IGxpc3RlbmVy\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gc3lz\ndGVtIGxpZmVjeWNsZSBsaXN0ZW5lci4KICAgICAqLwogICAgcHVibGljIHN5\nbmNocm9uaXplZCBib29sZWFuIHJlbW92ZVN5c3RlbUxpc3RlbmVyKE9iamVj\ndCBsaXN0ZW5lcikgewogICAgICAgIGlmICghX2xpc3RlbmVycy5jb250YWlu\ncyhsaXN0ZW5lcikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgLy8gY29weSB0byBhdm9pZCBpc3N1ZXMgd2l0aCBMaXN0ZW5lckxpc3Qg\nYW5kIGF2b2lkIHVubmNlc3NhcnkKICAgICAgICAvLyBsb2NraW5nIG9uIHRo\nZSBsaXN0IGR1cmluZyBydW50aW1lCiAgICAgICAgTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyLkxpc3RlbmVyTGlzdCBsaXN0ZW5lcnMgPSBuZXcKICAgICAgICAg\nICAgTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdChfbGlzdGVu\nZXJzKTsKICAgICAgICBsaXN0ZW5lcnMucmVtb3ZlKGxpc3RlbmVyKTsKICAg\nICAgICBfbGlzdGVuZXJzID0gbGlzdGVuZXJzOwogICAgICAgIHJldHVybiB0\ncnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzeXN0ZW0g\nbGlmZWN5Y2xlIGxpc3RlbmVycwogICAgICovCiAgICBwdWJsaWMgTGlmZWN5\nY2xlRXZlbnRNYW5hZ2VyLkxpc3RlbmVyTGlzdCBnZXRTeXN0ZW1MaXN0ZW5l\ncnMoKSB7CiAgICAgICAgcmV0dXJuIF9saXN0ZW5lcnM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGcmVlIHRoZSByZXNvdXJjZXMgdXNlZCBieSB0aGlzIHJl\ncG9zaXRvcnkuIENsb3NlcyBhbGwgdXNlciBzZXF1ZW5jZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBjbG9zZSgpIHsKICAgICAg\nICBTZXF1ZW5jZU1ldGFEYXRhW10gc21kcyA9IGdldFNlcXVlbmNlTWV0YURh\ndGFzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBzbWRzW2ldLmNsb3NlKCk7CiAgICAgICAg\nY2xlYXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFF1ZXJ5IGtleSBzdHJ1\nY3QuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFF1ZXJ5S2V5\nCiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBw\ndWJsaWMgU3RyaW5nIGNsc05hbWU7CiAgICAgICAgcHVibGljIFN0cmluZyBu\nYW1lOwoKICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAg\nICAgICBpbnQgY2xzSGFzaCA9IChjbHNOYW1lID09IG51bGwpID8gMCA6IGNs\nc05hbWUuaGFzaENvZGUoKTsKICAgICAgICAgICAgaW50IG5hbWVIYXNoID0g\nKG5hbWUgPT0gbnVsbCkgPyAwIDogbmFtZS5oYXNoQ29kZSgpOwogICAgICAg\nICAgICByZXR1cm4gY2xzSGFzaCArIG5hbWVIYXNoOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvYmopCgkJewoJ\nCQlpZiAob2JqID09IHRoaXMpCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJaWYgKCEo\nb2JqIGluc3RhbmNlb2YgUXVlcnlLZXkpKQoJCQkJcmV0dXJuIGZhbHNlOwoJ\nCQoJCQlRdWVyeUtleSBxayA9IChRdWVyeUtleSkgb2JqOwoJCQlyZXR1cm4g\nU3RyaW5nVXRpbHMuZXF1YWxzIChjbHNOYW1lLCBxay5jbHNOYW1lKQoJCQkJ\nJiYgU3RyaW5nVXRpbHMuZXF1YWxzIChuYW1lLCBxay5uYW1lKTsJCgkJfQoJ\nfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiBYTUwgbWV0YWRhdGEgZm9y\nIGEgZ2l2ZW4gZmllbGQgbWV0YWRhdGEKICAgICAqIEBwYXJhbSBmbWQKICAg\nICAqIEByZXR1cm4gWE1MIG1ldGFkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBz\neW5jaHJvbml6ZWQgWE1MTWV0YURhdGEgZ2V0WE1MTWV0YURhdGEoRmllbGRN\nZXRhRGF0YSBmbWQpIHsKICAgICAgICBDbGFzcyBjbHMgPSBmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCk7CiAgICAgICAgLy8gY2hlY2sgaWYgY2FjaGVkIGJlZm9y\nZQogICAgICAgIFhNTE1ldGFEYXRhIHhtbG1ldGEgPSAoWE1MQ2xhc3NNZXRh\nRGF0YSkgX3htbG1ldGFzLmdldChjbHMpOwogICAgICAgIGlmICh4bWxtZXRh\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB4bWxtZXRhOwogICAgICAg\nIAogICAgICAgIC8vIGxvYWQgSkFYQiBYTUwgbWV0YWRhdGEKICAgICAgICBf\nZmFjdG9yeS5sb2FkWE1MTWV0YURhdGEoZm1kKTsKICAgICAgICAKICAgICAg\nICB4bWxtZXRhID0gKFhNTENsYXNzTWV0YURhdGEpIF94bWxtZXRhcy5nZXQo\nY2xzKTsKCiAgICAgICAgcmV0dXJuIHhtbG1ldGE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgbWV0YWRhdGEsIHBvcHVsYXRlIGl0IHdp\ndGggZGVmYXVsdCBpbmZvcm1hdGlvbiwgYWRkIGl0IHRvCiAgICAgKiB0aGUg\ncmVwb3NpdG9yeSwgYW5kIHJldHVybiBpdC4KICAgICAqCiAgICAgKiBAcGFy\nYW0gYWNjZXNzIHRoZSBhY2Nlc3MgdHlwZSB0byB1c2UgaW4gcG9wdWxhdGlu\nZyBtZXRhZGF0YQogICAgICovCiAgICBwdWJsaWMgWE1MQ2xhc3NNZXRhRGF0\nYSBhZGRYTUxNZXRhRGF0YShDbGFzcyB0eXBlLCBTdHJpbmcgbmFtZSkgewog\nICAgICAgIFhNTENsYXNzTWV0YURhdGEgbWV0YSA9IG5ld1hNTENsYXNzTWV0\nYURhdGEodHlwZSwgbmFtZSk7CiAgICAgICAgCiAgICAgICAgLy8gc3luY2hy\nb25pemUgb24gdGhpcyByYXRoZXIgdGhhbiB0aGUgbWFwLCBiZWNhdXNlIGFs\nbCBvdGhlciBtZXRob2RzCiAgICAgICAgLy8gdGhhdCBhY2Nlc3MgX3htbG1l\ndGFzIGFyZSBzeW5jaHJvbml6ZWQgb24gdGhpcwogICAgICAgIHN5bmNocm9u\naXplZCAodGhpcykgewogICAgICAgICAgICBfeG1sbWV0YXMucHV0KHR5cGUs\nIG1ldGEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWV0YTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY2FjaGVkIFhNTENsYXNzTWV0\nYURhdGEgZm9yIHRoZSBnaXZlbiBjbGFzcwogICAgICogUmV0dXJuIG51bGwg\naWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFhNTE1ldGFEYXRhIGdldENh\nY2hlZFhNTE1ldGFEYXRhKENsYXNzIGNscykgewogICAgICAgIHJldHVybiAo\nWE1MTWV0YURhdGEpIF94bWxtZXRhcy5nZXQoY2xzKTsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgeG1sIGNsYXNzIG1ldGFkYXRh\nCiAgICAgKiBAcGFyYW0gdHlwZQogICAgICogQHBhcmFtIG5hbWUKICAgICAq\nIEByZXR1cm4gYSBYTUxDbGFzc01ldGFEYXRhCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBYTUxDbGFzc01ldGFEYXRhIG5ld1hNTENsYXNzTWV0YURhdGEoQ2xh\nc3MgdHlwZSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFhN\nTENsYXNzTWV0YURhdGEodHlwZSwgbmFtZSk7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogQ3JlYXRlIGEgbmV3IHhtbCBmaWVsZCBtZXRhLCBhZGQgaXQg\ndG8gdGhlIGZpZWxkTWFwIGluIHRoZSBnaXZlbiAKICAgICAqICAgICB4bWwg\nY2xhc3MgbWV0YWRhdGEKICAgICAqIEBwYXJhbSB0eXBlCiAgICAgKiBAcGFy\nYW0gbmFtZQogICAgICogQHBhcmFtIG1ldGEKICAgICAqIEByZXR1cm4gYSBY\nTUxGaWVsZE1ldGFEYXRhCiAgICAgKi8KICAgIHB1YmxpYyBYTUxGaWVsZE1l\ndGFEYXRhIG5ld1hNTEZpZWxkTWV0YURhdGEoQ2xhc3MgdHlwZSwgU3RyaW5n\nIG5hbWUpIHsKICAgICAgICByZXR1cm4gbmV3IFhNTEZpZWxkTWV0YURhdGEo\ndHlwZSwgbmFtZSk7CiAgICB9Cn0K\n","encoding":"base64"}

