{"sha":"1228778462a11d1f0f25075b69d3f1ddf04ecdd8","node_id":"MDQ6QmxvYjIwNjM2NDoxMjI4Nzc4NDYyYTExZDFmMGYyNTA3NWI2OWQzZjFkZGYwNGVjZGQ4","size":11713,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1228778462a11d1f0f25075b69d3f1ddf04ecdd8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEu\naW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0\nIGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5KYXZhVmVyc2lvbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmF0ZWRDbGFz\nc2VzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFzczsKCi8qKgog\nKiBSZWRlZmluZXMgdGhlIG1ldGhvZCBib2RpZXMgb2YgZXhpc3RpbmcgdW5l\nbmhhbmNlZCBjbGFzc2VzIHRvIG1ha2UgdGhlbQogKiBub3RpZnkgc3RhdGUg\nbWFuYWdlcnMgb2YgbXV0YXRpb25zLgogKgogKiBAc2luY2UgMS4wLjAKICov\nCnB1YmxpYyBjbGFzcyBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyIHsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UoCiAgICAgICAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci5j\nbGFzcyk7CgogICAgLyoqCiAgICAgKiBGb3IgZWFjaCBlbGVtZW50IGluIDxj\nb2RlPmNsYXNzZXM8L2NvZGU+LCBjcmVhdGVzIGFuZCByZWdpc3RlcnMgYQog\nICAgICogbmV3IHN1YmNsYXNzIHRoYXQgaW1wbGVtZW50cyB7QGxpbmsgUGVy\nc2lzdGVuY2VDYXBhYmxlfSwgYW5kIHByZXBhcmVzCiAgICAgKiBPcGVuSlBB\nIHRvIGhhbmRsZSBuZXcgaW5zdGFuY2VzIG9mIHRoZSB1bmVuaGFuY2VkIHR5\ncGUuIElmIHRoaXMgaXMKICAgICAqIGludm9rZWQgaW4gYSBKYXZhIDYgZW52\naXJvbm1lbnQsIHRoaXMgbWV0aG9kIHdpbGwgcmVkZWZpbmUgdGhlIG1ldGhv\nZHMKICAgICAqIGZvciBlYWNoIGNsYXNzIGluIHRoZSBhcmd1bWVudCBsaXN0\nIHN1Y2ggdGhhdCBmaWVsZCBhY2Nlc3NlcyBhcmUKICAgICAqIGludGVyY2Vw\ndGVkIGluLWxpbmUuIElmIGludm9rZWQgaW4gYSBKYXZhIDUgZW52aXJvbm1l\nbnQsIHRoaXMKICAgICAqIHJlZGVmaW5pdGlvbiBpcyBub3QgcG9zc2libGU7\nIGluIHRoZXNlIGNvbnRleHRzLCB3aGVuIHVzaW5nIGZpZWxkCiAgICAgKiBh\nY2Nlc3MsIE9wZW5KUEEgd2lsbCBuZWVkIHRvIGRvIHN0YXRlIGNvbXBhcmlz\nb25zIHRvIGRldGVjdCBhbnkgY2hhbmdlCiAgICAgKiB0byBhbnkgaW5zdGFu\nY2UgYXQgYW55IHRpbWUsIGFuZCB3aGVuIHVzaW5nIHByb3BlcnR5IGFjY2Vz\ncywgT3BlbkpQQQogICAgICogd2lsbCBuZWVkIHRvIGRvIHN0YXRlIGNvbXBh\ncmlzb25zIHRvIGRldGVjdCBjaGFuZ2VzIHRvIG5ld2x5IGluc2VydGVkCiAg\nICAgKiBpbnN0YW5jZXMgYWZ0ZXIgYSBmbHVzaCBoYXMgYmVlbiBjYWxsZWQu\nCiAgICAgKgogICAgICogQHJldHVybiB0aGUgbmV3IHN1YmNsYXNzZXMsIG9y\nIDxjb2RlPm51bGw8L2NvZGU+IGlmIDxjb2RlPmNsYXNzZXM8L2NvZGU+CiAg\nICAgKiBpcyA8Y29kZT5udWxsPC9jb2RlPi4KICAgICAqIEB0aHJvd3MgVXNl\nckV4Y2VwdGlvbiBpZiA8Y29kZT5jb25mPC9jb2RlPiByZXF1aXJlcyBidWls\nZC10aW1lCiAgICAgKiBlbmhhbmNlbWVudCBhbmQgPGNvZGU+Y2xhc3Nlczwv\nY29kZT4gaW5jbHVkZXMgdW5lbmhhbmNlZCB0eXBlcy4KICAgICAqCiAgICAg\nKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBMaXN0\nPENsYXNzPiBwcmVwYXJlVW5lbmhhbmNlZENsYXNzZXMoCiAgICAgICAgZmlu\nYWwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBmaW5hbCBD\nb2xsZWN0aW9uPD8gZXh0ZW5kcyBDbGFzcz4gY2xhc3NlcywKICAgICAgICBm\naW5hbCBDbGFzc0xvYWRlciBlbnZMb2FkZXIpIHsKICAgICAgICBpZiAoY2xh\nc3NlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAoY2xhc3Nlcy5zaXplKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CgogICAgICAgIExvZyBsb2cgPSBj\nb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfRU5IQU5DRSk7\nCiAgICAgICAgaWYgKGNvbmYuZ2V0UnVudGltZVVuZW5oYW5jZWRDbGFzc2Vz\nQ29uc3RhbnQoKQogICAgICAgICAgICAhPSBSdW50aW1lVW5lbmhhbmNlZENs\nYXNzc2VzTW9kZXMuU1VQUE9SVEVEKSB7CiAgICAgICAgICAgIENvbGxlY3Rp\nb24gdW5lbmhhbmNlZCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAg\nZm9yIChDbGFzcyBjbHMgOiBjbGFzc2VzKQogICAgICAgICAgICAgICAgaWYg\nKCFQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShj\nbHMpKQogICAgICAgICAgICAgICAgICAgIHVuZW5oYW5jZWQuYWRkKGNscyk7\nCiAgICAgICAgICAgIGlmICh1bmVuaGFuY2VkLnNpemUoKSA+IDApIHsKICAg\nICAgICAgICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5nZXQoInJ1bnRpbWUt\nb3B0aW1pemF0aW9uLWRpc2FibGVkIiwKICAgICAgICAgICAgICAgICAgICB1\nbmVuaGFuY2VkKTsKICAgICAgICAgICAgICAgIGlmIChjb25mLmdldFJ1bnRp\nbWVVbmVuaGFuY2VkQ2xhc3Nlc0NvbnN0YW50KCkKICAgICAgICAgICAgICAg\nICAgICA9PSBSdW50aW1lVW5lbmhhbmNlZENsYXNzc2VzTW9kZXMuV0FSTikK\nICAgICAgICAgICAgICAgICAgICBsb2cud2Fybihtc2cpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKG1zZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIHJlZGVmaW5l\nID0gQ2xhc3NSZWRlZmluZXIuY2FuUmVkZWZpbmVDbGFzc2VzKCk7CiAgICAg\nICAgaWYgKHJlZGVmaW5lKQogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdl\ndCgiZW5oYW5jZS1hbmQtc3ViY2xhc3MtYW5kLXJlZGVmLXN0YXJ0IiwKICAg\nICAgICAgICAgICAgIGNsYXNzZXMpKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJlbmhhbmNlLWFuZC1zdWJjbGFzcy1u\nby1yZWRlZi1zdGFydCIsCiAgICAgICAgICAgICAgICBjbGFzc2VzKSk7Cgog\nICAgICAgIGZpbmFsIE1hcDxDbGFzcywgYnl0ZVtdPiBtYXAgPSBuZXcgSGFz\naE1hcDxDbGFzcywgYnl0ZVtdPigpOwogICAgICAgIGZpbmFsIExpc3Qgc3Vi\ncyA9IG5ldyBBcnJheUxpc3QoY2xhc3Nlcy5zaXplKCkpOwogICAgICAgIGZp\nbmFsIExpc3QgaW50cyA9IG5ldyBBcnJheUxpc3QoY2xhc3Nlcy5zaXplKCkp\nOwogICAgICAgIFNldDxDbGFzcz4gdW5zcGVjaWZpZWQgPSBudWxsOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGNsYXNzZXMuaXRlcmF0b3IoKTsg\naXRlci5oYXNOZXh0KCk7ICkgewogICAgICAgICAgICBmaW5hbCBDbGFzcyBj\nbHMgPSAoQ2xhc3MpIGl0ZXIubmV4dCgpOwogICAgICAgICAgICBmaW5hbCBQ\nQ0VuaGFuY2VyIGVuaGFuY2VyID0gbmV3IFBDRW5oYW5jZXIoY29uZiwgY2xz\nKTsKCiAgICAgICAgICAgIGVuaGFuY2VyLnNldEJ5dGVjb2RlV3JpdGVyKG5l\ndyBCeXRlY29kZVdyaXRlcigpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHdyaXRlKEJDQ2xhc3MgYmMpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICAgICAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci53cml0\nZShiYywgZW5oYW5jZXIsIG1hcCwKICAgICAgICAgICAgICAgICAgICAgICAg\nY2xzLCBzdWJzLCBpbnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSk7CiAgICAgICAgICAgIGlmIChyZWRlZmluZSkKICAgICAgICAgICAg\nICAgIGVuaGFuY2VyLnNldFJlZGVmaW5lKHRydWUpOwogICAgICAgICAgICBl\nbmhhbmNlci5zZXRDcmVhdGVTdWJjbGFzcyh0cnVlKTsKICAgICAgICAgICAg\nZW5oYW5jZXIuc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKHRydWUpOwoKICAg\nICAgICAgICAgLy8gc2V0IHRoaXMgYmVmb3JlIGVuaGFuY2VtZW50IGFzIHdl\nbGwgYXMgYWZ0ZXIgc2luY2UgZW5oYW5jZW1lbnQKICAgICAgICAgICAgLy8g\ndXNlcyBhIGRpZmZlcmVudCBtZXRhZGF0YSByZXBvc2l0b3J5LCBhbmQgdGhl\nIG1ldGFkYXRhIGNvbmZpZwogICAgICAgICAgICAvLyBtYXR0ZXJzIGluIHRo\nZSBlbmhhbmNlbWVudCBjb250cmFjdC4gRG9uJ3QgZG8gYW55IHdhcm5pbmcg\naGVyZSwKICAgICAgICAgICAgLy8gc2luY2Ugd2UnbGwgaXNzdWUgd2Fybmlu\nZ3Mgd2hlbiB3ZSBkbyB0aGUgZmluYWwgbWV0YWRhdGEKICAgICAgICAgICAg\nLy8gcmVjb25maWd1cmF0aW9uIGF0IHRoZSBlbmQgb2YgdGhpcyBtZXRob2Qu\nCiAgICAgICAgICAgIGNvbmZpZ3VyZU1ldGFEYXRhKGVuaGFuY2VyLmdldE1l\ndGFEYXRhKCksIGNvbmYsIHJlZGVmaW5lLCBmYWxzZSk7CgogICAgICAgICAg\nICB1bnNwZWNpZmllZCA9IGNvbGxlY3RSZWxhdGVkVW5zcGVjaWZpZWRUeXBl\ncyhlbmhhbmNlci5nZXRNZXRhRGF0YSgpLAogICAgICAgICAgICAgICAgY2xh\nc3NlcywgdW5zcGVjaWZpZWQpOwoKICAgICAgICAgICAgaW50IHJ1blJlc3Vs\ndCA9IGVuaGFuY2VyLnJ1bigpOwogICAgICAgICAgICBpZiAocnVuUmVzdWx0\nID09IFBDRW5oYW5jZXIuRU5IQU5DRV9QQykgewogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlci5yZWNvcmQoKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBvdXIgaW1wbCBvZiBCeXRlY29kZVdyaXRl\nciBkb2Vzbid0IHRocm93IElPRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\ndW5zcGVjaWZpZWQgIT0gbnVsbCAmJiAhdW5zcGVjaWZpZWQuaXNFbXB0eSgp\nKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgidW5zcGVjaWZpZWQtdW5lbmhhbmNlZC10eXBlcyIsCiAgICAgICAgICAg\nICAgICBjbGFzc2VzLCB1bnNwZWNpZmllZCkpOwoKICAgICAgICBDbGFzc1Jl\nZGVmaW5lci5yZWRlZmluZUNsYXNzZXMoY29uZiwgbWFwKTsKICAgICAgICBm\nb3IgKENsYXNzIGNscyA6IG1hcC5rZXlTZXQoKSkgewogICAgICAgICAgICBz\nZXRJbnRlcmNlcHRpbmcoY29uZiwgZW52TG9hZGVyLCBjbHMpOwogICAgICAg\nICAgICBjb25maWd1cmVNZXRhRGF0YShjb25mLCBlbnZMb2FkZXIsIGNscywg\ncmVkZWZpbmUpOwogICAgICAgIH0KICAgICAgICBmb3IgKENsYXNzIGNscyA6\nIChDb2xsZWN0aW9uPENsYXNzPikgc3VicykKICAgICAgICAgICAgY29uZmln\ndXJlTWV0YURhdGEoY29uZiwgZW52TG9hZGVyLCBjbHMsIHJlZGVmaW5lKTsK\nICAgICAgICBmb3IgKENsYXNzIGNscyA6IChDb2xsZWN0aW9uPENsYXNzPikg\naW50cykKICAgICAgICAgICAgc2V0SW50ZXJjZXB0aW5nKGNvbmYsIGVudkxv\nYWRlciwgY2xzKTsKCiAgICAgICAgcmV0dXJuIHN1YnM7CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgU2V0PENsYXNzPiBjb2xsZWN0UmVsYXRlZFVuc3Bl\nY2lmaWVkVHlwZXMoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIENvbGxl\nY3Rpb248PyBleHRlbmRzIENsYXNzPiBjbGFzc2VzLCBTZXQ8Q2xhc3M+IHVu\nc3BlY2lmaWVkKSB7CiAgICAgICAgdW5zcGVjaWZpZWQgPSBjb2xsZWN0VW5z\ncGVjaWZpZWRUeXBlKG1ldGEuZ2V0UENTdXBlcmNsYXNzKCksIGNsYXNzZXMs\nCiAgICAgICAgICAgIHVuc3BlY2lmaWVkKTsKCiAgICAgICAgZm9yIChGaWVs\nZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RmllbGRzKCkpIHsKICAgICAgICAg\nICAgaWYgKGZtZC5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgIGlmIChmbWQuaXNUeXBlUEMoKSkKICAgICAg\nICAgICAgICAgIHVuc3BlY2lmaWVkID0gY29sbGVjdFVuc3BlY2lmaWVkVHlw\nZShmbWQuZ2V0VHlwZSgpLCBjbGFzc2VzLAogICAgICAgICAgICAgICAgICAg\nIHVuc3BlY2lmaWVkKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50\nKCkgIT0gbnVsbCAmJiBmbWQuZ2V0RWxlbWVudCgpLmlzVHlwZVBDKCkpCiAg\nICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9IGNvbGxlY3RVbnNwZWNpZmll\nZFR5cGUoZm1kLmdldEVsZW1lbnQoKS5nZXRUeXBlKCksCiAgICAgICAgICAg\nICAgICAgICAgY2xhc3NlcywgdW5zcGVjaWZpZWQpOwogICAgICAgICAgICBp\nZiAoZm1kLmdldEtleSgpICE9IG51bGwgJiYgZm1kLmdldEtleSgpLmlzVHlw\nZVBDKCkpCiAgICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9IGNvbGxlY3RV\nbnNwZWNpZmllZFR5cGUoZm1kLmdldEtleSgpLmdldFR5cGUoKSwKICAgICAg\nICAgICAgICAgICAgICBjbGFzc2VzLCB1bnNwZWNpZmllZCk7CiAgICAgICAg\nICAgIGlmIChmbWQuZ2V0VmFsdWUoKSAhPSBudWxsICYmIGZtZC5nZXRWYWx1\nZSgpLmlzVHlwZVBDKCkpCiAgICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9\nIGNvbGxlY3RVbnNwZWNpZmllZFR5cGUoZm1kLmdldFZhbHVlKCkuZ2V0VHlw\nZSgpLAogICAgICAgICAgICAgICAgICAgIGNsYXNzZXMsIHVuc3BlY2lmaWVk\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuc3BlY2lmaWVkOwogICAg\nfQoKICAgIHByaXZhdGUgc3RhdGljIFNldDxDbGFzcz4gY29sbGVjdFVuc3Bl\nY2lmaWVkVHlwZShDbGFzcyBjbHMsCiAgICAgICAgQ29sbGVjdGlvbjw/IGV4\ndGVuZHMgQ2xhc3M+IGNsYXNzZXMsIFNldDxDbGFzcz4gdW5zcGVjaWZpZWQp\nIHsKICAgICAgICBpZiAoY2xzICE9IG51bGwgJiYgIWNsYXNzZXMuY29udGFp\nbnMoY2xzKQogICAgICAgICAgICAmJiAhSW1wbEhlbHBlci5pc01hbmFnZWRU\neXBlKG51bGwsIGNscykpIHsKICAgICAgICAgICAgaWYgKHVuc3BlY2lmaWVk\nID09IG51bGwpCiAgICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9IG5ldyBI\nYXNoU2V0PENsYXNzPigpOwogICAgICAgICAgICB1bnNwZWNpZmllZC5hZGQo\nY2xzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuc3BlY2lmaWVkOwog\nICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgY29uZmlndXJlTWV0YURh\ndGEoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBDbGFzc0xv\nYWRlciBlbnZMb2FkZXIsIENsYXNzIGNscywgYm9vbGVhbiByZWRlZmluZUF2\nYWlsYWJsZSkgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGNvbmYu\nZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKQogICAgICAgICAgICAu\nZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIHRydWUpOwogICAgICAgIGNv\nbmZpZ3VyZU1ldGFEYXRhKG1ldGEsIGNvbmYsIHJlZGVmaW5lQXZhaWxhYmxl\nLCB0cnVlKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGNvbmZp\nZ3VyZU1ldGFEYXRhKENsYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBjb25mLCBib29sZWFuIHJlZGVmaW5lQXZhaWxh\nYmxlLCBib29sZWFuIHdhcm4pIHsKCiAgICAgICAgc2V0RGV0YWNoZWRTdGF0\nZShtZXRhKTsKCiAgICAgICAgaWYgKHdhcm4gJiYgbWV0YS5nZXRBY2Nlc3NU\neXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQKICAgICAgICAg\nICAgJiYgIXJlZGVmaW5lQXZhaWxhYmxlKSB7CiAgICAgICAgICAgIC8vIG9u\nbHkgd2FybiBhYm91dCBkZWNsYXJlZCBmaWVsZHM7IHN1cGVyY2xhc3MgZmll\nbGRzIHdpbGwgYmUKICAgICAgICAgICAgLy8gd2FybmVkIGFib3V0IHdoZW4g\ndGhlIHN1cGVyY2xhc3MgaXMgaGFuZGxlZAogICAgICAgICAgICBmb3IgKEZp\nZWxkTWV0YURhdGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKSB7\nCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElP\nTjoKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGNhbiBsYXppbHkgbG9hZCB0\naGVzZSwgc2luY2Ugd2Ugb3duIHRoZQogICAgICAgICAgICAgICAgICAgICAg\nICAvLyByZWxhdGlvbnNoaXAgY29udGFpbmVyCiAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0\nY2hHcm91cCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAhKGZt\nZC5pc1ZlcnNpb24oKSB8fCBmbWQuaXNQcmltYXJ5S2V5KCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMb2cgbG9nID0gY29uZi5nZXRMb2co\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3BlbkpQQUNvbmZp\nZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInN1YmNsYXNzZXItZmV0Y2gtZ3Jv\ndXAtb3ZlcnJpZGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0TmFtZSgpKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmbWQuc2V0SW5EZWZhdWx0RmV0Y2hH\ncm91cCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIHZvaWQgd3JpdGUoQkNDbGFzcyBiYywgUENFbmhh\nbmNlciBlbmhhbmNlciwKICAgICAgICBNYXA8Q2xhc3MsIGJ5dGVbXT4gbWFw\nLCBDbGFzcyBjbHMsIExpc3Qgc3VicywgTGlzdCBpbnRzKQogICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CgogICAgICAgIGlmIChiYyA9PSBlbmhhbmNl\nci5nZXRNYW5hZ2VkVHlwZUJ5dGVjb2RlKCkpIHsKICAgICAgICAgICAgLy8g\naWYgaXQgd2FzIGFscmVhZHkgZGVmaW5lZCwgZG9uJ3QgcHV0IGl0IGluIHRo\nZSBtYXAsCiAgICAgICAgICAgIC8vIGJ1dCBkbyBzZXQgdGhlIG1ldGFkYXRh\nIGFjY29yZGluZ2x5LgogICAgICAgICAgICBpZiAoZW5oYW5jZXIuaXNBbHJl\nYWR5UmVkZWZpbmVkKCkpCiAgICAgICAgICAgICAgICBpbnRzLmFkZChiYy5n\nZXRUeXBlKCkpOwogICAgICAgICAgICBlbHNlIGlmIChKYXZhVmVyc2lvbnMu\nVkVSU0lPTiA+PSA1KQogICAgICAgICAgICAgICAgbWFwLnB1dChiYy5nZXRU\neXBlKCksIGJjLnRvQnl0ZUFycmF5KCkpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGlmICghZW5oYW5jZXIuaXNBbHJlYWR5U3ViY2xhc3NlZCgp\nKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBuZXcgc3ViY2xh\nc3MKICAgICAgICAgICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IEdlbmVy\nYXRlZENsYXNzZXMuZ2V0TW9zdERlcml2ZWRMb2FkZXIoCiAgICAgICAgICAg\nICAgICAgICAgY2xzLCBQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MpOwogICAg\nICAgICAgICAgICAgc3Vicy5hZGQoR2VuZXJhdGVkQ2xhc3Nlcy5sb2FkQkND\nbGFzcyhiYywgbG9hZGVyKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBzZXRJbnRlcmNlcHRpbmco\nT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICBDbGFzc0xvYWRl\nciBlbnZMb2FkZXIsIENsYXNzIGNscykgewogICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YSA9IGNvbmYuZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2Uo\nKQogICAgICAgICAgICAuZ2V0TWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIHRy\ndWUpOwogICAgICAgIG1ldGEuc2V0SW50ZXJjZXB0aW5nKHRydWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogSWYgdGhlIG1ldGFkYXRhIGlzIGNvbmZpZ3Vy\nZWQgdG8gdXNlIGEgc3ludGhldGljCiAgICAgKiBkZXRhY2hlZCBzdGF0ZSwg\ncmVzZXQgaXQgdG8gbm90IHVzZSBhIGRldGFjaGVkCiAgICAgKiBzdGF0ZSBm\naWVsZCwgc2luY2Ugd2UgY2FuJ3QgYWRkIGZpZWxkcyB3aGVuIHJlZGVmaW5p\nbmcuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgc2V0RGV0YWNo\nZWRTdGF0ZShDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoQ2xh\nc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNoZWRT\ndGF0ZSgpKSkKICAgICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKG51\nbGwpOwogICAgfQp9Cg==\n","encoding":"base64"}

