{"sha":"fb440e74af504743de2b0c79803d7c32fe8659e6","node_id":"MDQ6QmxvYjIwNjM2NDpmYjQ0MGU3NGFmNTA0NzQzZGUyYjBjNzk4MDNkN2MzMmZlODY1OWU2","size":51894,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fb440e74af504743de2b0c79803d7c32fe8659e6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnRlc3Q7CgppbXBvcnQg\namF2YS5iZWFucy5CZWFuSW5mbzsKaW1wb3J0IGphdmEuYmVhbnMuSW50cm9z\ncGVjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuYmVhbnMuSW50cm9zcGVj\ndG9yOwppbXBvcnQgamF2YS5iZWFucy5Qcm9wZXJ0eURlc2NyaXB0b3I7Cmlt\ncG9ydCBqYXZhLmlvLkJ5dGVBcnJheUlucHV0U3RyZWFtOwppbXBvcnQgamF2\nYS5pby5CeXRlQXJyYXlPdXRwdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkZp\nbGU7CmltcG9ydCBqYXZhLmlvLkZpbGVJbnB1dFN0cmVhbTsKaW1wb3J0IGph\ndmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5G\naWxlT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLk9i\namVjdElucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRT\ndHJlYW07CmltcG9ydCBqYXZhLmlvLlByaW50U3RyZWFtOwppbXBvcnQgamF2\nYS5pby5QcmludFdyaXRlcjsKaW1wb3J0IGphdmEuaW8uU3RyaW5nV3JpdGVy\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1w\nb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJp\nZ0ludGVnZXI7CmltcG9ydCBqYXZhLm5ldC5VUkw7CmltcG9ydCBqYXZhLnRl\neHQuTnVtYmVyRm9ybWF0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0\nIGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkRhdGU7\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdEl0ZXJhdG9y\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Ob1N1\nY2hFbGVtZW50RXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLlN0cmluZ1Rv\na2VuaXplcjsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7Cmlt\ncG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdFJlc3VsdDsKaW1wb3J0IGp1bml0\nLnRleHR1aS5UZXN0UnVubmVyOwppbXBvcnQgb3JnLmFwYWNoZS5yZWdleHAu\nUkU7CmltcG9ydCBvcmcuYXBhY2hlLnJlZ2V4cC5SRVN5bnRheEV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUucmVnZXhwLlJFVXRpbDsKaW1wb3J0IG9y\nZy5hcGFjaGUudG9vbHMuYW50LkFudENsYXNzTG9hZGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS50b29scy5hbnQuUHJvamVjdDsKaW1wb3J0IG9yZy5hcGFjaGUu\ndG9vbHMuYW50LlByb2plY3RIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmxvZy5Mb2dGYWN0b3J5SW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CgovKioKICogVGVzdENhc2UgZnJh\nbWV3b3JrIHRvIHJ1biB2YXJpb3VzIHRlc3RzIGFnYWluc3Qgc29sYXJtZXRy\naWMgY29kZS4KICogVGhpcyBjbGFzcyBjb250YWlucyB2YXJpb3VzIHV0aWxp\ndHkgbWV0aG9kcyBmb3IgdGhlIGZvbGxvd2luZyBmdW5jdGlvbnM6CiAqIDx1\nbD4KICogPGxpPlVzaW5nIG11bHRpcGxlLCBpc29sYXRlZCBDbGFzc0xvYWRl\ncnM8L2xpPgogKiA8bGk+UnVubmluZyBhIHRlc3QgaW4gbXVsdGlwbGUgY29u\nY3VycmVudCB0aHJlYWRzPC9saT4KICogPGxpPkFzc2VydGlvbiBoZWxwZXJz\nPC9saT4KICogPGxpPkNyZWF0aW5nIHJhbmRvbSBTdHJpbmdzLCBudW1iZXJz\nLCBldGMuPC9saT4KICogPC91bD4KICoKICogQGF1dGhvciBNYXJjIFBydWQn\naG9tbWVhdXgKICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICovCnB1Ymxp\nYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFRlc3RDYXNlIGV4dGVuZHMgVGVz\ndENhc2UgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFRFU1Rf\nTUVUSE9EUyA9CiAgICAgICAgU3lzdGVtLmdldFByb3BlcnR5KEFic3RyYWN0\nVGVzdENhc2UuY2xhc3MuZ2V0TmFtZSgpICsgIi50ZXN0TWV0aG9kcyIpOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBsb25nIFBMQVRGT1JNX0FMTCA9IDIg\nPDwgMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgbG9uZyBQTEFURk9STV9V\nTktOT1dOID0gMiA8PCAyOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry\naW5nIFNLSVBfVE9LRU4gPSAiU09MQVJTS0lQIjsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIFNLSVBfREVMSU1JVEVSID0gInwiOwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBM\nb2NhbGl6ZXIuZm9yUGFja2FnZShBYnN0cmFjdFRlc3RDYXNlLmNsYXNzKTsK\nCiAgICBwcm90ZWN0ZWQgU3RyaW5nIG11bHRpVGhyZWFkRXhlY3V0aW5nID0g\nbnVsbDsKICAgIHByb3RlY3RlZCBib29sZWFuIGluVGltZW91dFRocmVhZCA9\nIGZhbHNlOwoKICAgIHByaXZhdGUgTG9nIGxvZyA9IG51bGw7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgTWFwIF90aW1lcyA9IG5ldyBIYXNoTWFwKCk7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgQWJzdHJhY3RUZXN0Q2FzZSBfbGFzdFRlc3QgPSBu\ndWxsOwoKICAgIHByaXZhdGUgc3RhdGljIFdhdGNoZG9nVGhyZWFkIF93YXRj\naGRvZyA9IG5ldyBXYXRjaGRvZ1RocmVhZCgpOwogICAgcHJpdmF0ZSBsb25n\nIF90aW1lb3V0OwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIENyZWF0\nZSBhIHRlc3QgY2FzZSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4KICAgICAq\nLwogICAgcHVibGljIEFic3RyYWN0VGVzdENhc2UoU3RyaW5nIHRlc3QpIHsK\nICAgICAgICBzdXBlcih0ZXN0KTsKICAgIH0KCiAgICBwdWJsaWMgQWJzdHJh\nY3RUZXN0Q2FzZSgpIHsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZmluYWwgTG9n\nIGdldExvZygpIHsKICAgICAgICBpZiAobG9nID09IG51bGwpCiAgICAgICAg\nICAgIGxvZyA9IG5ld0xvZygpOwogICAgICAgIHJldHVybiBsb2c7CiAgICB9\nCgogICAgcHJvdGVjdGVkIExvZyBuZXdMb2coKSB7CiAgICAgICAgLy8gdGhp\ncyBpbXBsZW1lbnRhdGlvbiBsZWF2ZXMgbXVjaCB0byBiZSBkZXNpcmVkLCBh\ncyBpdCBqdXN0CiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBMb2dGYWN0b3J5\nSW1wbCBlYWNoIHRpbWUsIGFuZCBkb2VzIG5vdCBhcHBseQogICAgICAgIC8v\nIGFueSBjb25maWd1cmF0aW9ucy4KICAgICAgICByZXR1cm4gbmV3IExvZ0Zh\nY3RvcnlJbXBsKCkuZ2V0TG9nKGdldExvZ05hbWUoKSk7CiAgICB9CgogICAg\ncHJvdGVjdGVkIFN0cmluZyBnZXRMb2dOYW1lKCkgewogICAgICAgIHJldHVy\nbiAiY29tLnNvbGFybWV0cmljLlJ1bnRpbWUiOwogICAgfQoKICAgIC8qKgog\nICAgICogQ2FsbGVkIGJlZm9yZSB0aGUgd2F0Y2hkb2cgdGhyZWFkIGlzIGFi\nb3V0IHRvIGtpbGwgdGhlIGVudGlyZQogICAgICogSlZNIGR1ZSB0byBhIHRl\nc3QgY2FzZSdzIHRpbWVvdXQuIFRoaXMgbWV0aG9kIG9mZmVycyB0aGUKICAg\nICAqIGFiaWxpdHkgdG8gdHJ5IHRvIHJlc29sdmUgd2hhdGV2ZXIgY29udGVu\ndGlvbiBpcyB0YWtpbmcgcGxhY2UKICAgICAqIGluIHRoZSB0ZXN0LiBJdCB3\naWxsIGJlIGdpdmVuIDEwIHNlY29uZHMgdG8gdHJ5IHRvIGVuZCB0aGUKICAg\nICAqIHRlc3QgcGVhY2VmdWxseSBiZWZvcmUgdGhlIHdhdGNoZG9nIGV4aXRz\nIHRoZSBKVk0uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHByZVRpbWVv\ndXQoKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgcnVuKFRlc3RSZXN1bHQg\ncmVzdWx0KSB7CiAgICAgICAgaWYgKHNraXBUZXN0KCkpIHsKICAgICAgICAg\nICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgdGVzdHMgd2Ugc2tpcCBzbyB0aGF0\nIHdlIGNhbiBnZXQgYW4KICAgICAgICAgICAgLy8gaWRlYSBpbiB0aGUgYXV0\nb2J1aWxkIHN0YXR1cwogICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4o\nU0tJUF9UT0tFTiArIFNLSVBfREVMSU1JVEVSCiAgICAgICAgICAgICAgICAr\nICgiIiArIGdldENsYXNzKCkuZ2V0TmFtZSgpKQogICAgICAgICAgICAgICAg\nKyAiLiIgKyBnZXROYW1lKCkgKyBTS0lQX0RFTElNSVRFUik7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChfbGFzdFRlc3Qg\nIT0gbnVsbCAmJiBfbGFzdFRlc3QuZ2V0Q2xhc3MoKSAhPSBnZXRDbGFzcygp\nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfbGFzdFRl\nc3QudGVhckRvd25UZXN0Q2xhc3MoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIGdldExvZygpLmVycm9y\nKG51bGwsIHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBp\nZiAoX2xhc3RUZXN0ID09IG51bGwgfHwgX2xhc3RUZXN0LmdldENsYXNzKCkg\nIT0gZ2V0Q2xhc3MoKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgc2V0VXBUZXN0Q2xhc3MoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgIGdldExvZygpLmVycm9y\nKG51bGwsIHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBf\nbGFzdFRlc3QgPSB0aGlzOwoKICAgICAgICAvLyBpbmZvcm0gdGhlIHdhdGNo\nZG9nIHRocmVhZCB0aGF0IHdlIGFyZSBlbnRlcmluZyB0aGUgdGVzdAogICAg\nICAgIF93YXRjaGRvZy5lbnRlcmluZ1Rlc3QodGhpcyk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgc3VwZXIucnVuKHJlc3VsdCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgX3dhdGNoZG9nLmxlYXZpbmdUZXN0KHRo\naXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElmIHRoaXMg\ndGVzdCBzaG91bGQgYmUgc2tpcHBlZCBnaXZlbiB0aGUgY3VycmVudAogICAg\nICogZW52aXJvbm1lbnQsIHJldHVybiA8Y29kZT50cnVlPC9jb2RlPi4gVGhp\ncyBhbGxvd3MgYSB1bml0IHRlc3QKICAgICAqIGNsYXNzIHRvIGRpc2FibGUg\ndGVzdCBjYXNlcyBvbiBhIHBlci1tZXRob2QgZ3JhbnVsYXJpdHksIGFuZAog\nICAgICogcHJldmVudHMgdGhlIHRlc3QgZnJvbSBzaG93aW5nIHVwIGFzIGEg\ncGFzc2VkIHRlc3QganVzdAogICAgICogYmVjYXVzZSBpdCB3YXMgc2tpcHBl\nZC4KICAgICAqIEZvciBleGFtcGxlLCBpZiBhIHBhcnRpY3VsYXIgdGVzdCBj\nYXNlIG1ldGhvZCBzaG91bGQgbm90IGJlCiAgICAgKiBydW4gYWdhaW5zdCBh\nIGNlcnRhaW4gZGF0YWJhc2UsIHRoaXMgbWV0aG9kIGNvdWxkIGNoZWNrIHRo\nZQogICAgICogbmFtZSBvZiB0aGUgdGVzdCByZXN1bHQgYW5kIHRoZSBjdXJy\nZW50IGRhdGFiYXNlIGNvbmZpZ3VyYXRpb24KICAgICAqIGluIG9yZGVyIHRv\nIG1ha2UgdGhlIGRlY2lzaW9uOgogICAgICogPHAvPgogICAgICogPGNvZGU+\nIHByb3RlY3RlZCBib29sZWFuIHNraXBUZXN0KCkgewogICAgICogLy8gZG9u\nJ3QgcnVuIHdpdGggcG9pbnRiYXNlOiBpdCB1c2VzIGEgRGF0YVNvdXJjZSwg\nd2hpY2gKICAgICAqIC8vIGNhbid0IGJlIHRyYW5zbGF0ZWQgaW50byBhIEpC\nb3NzIERhdGFTb3VyY2UgY29uZmlndXJhdGlvbi4KICAgICAqIGlmICgidGVz\ndEpCb3NzIi5lcXVhbHMoZ2V0TmFtZSgpKSAmJgogICAgICogZ2V0Q3VycmVu\ndFBsYXRmb3JtKCkgPT0gUExBVEZPUk1fUE9JTlRCQVNFKQogICAgICogcmV0\ndXJuIHRydWU7CiAgICAgKiB9CiAgICAgKiA8L2NvZGU+CiAgICAgKiBJZiB5\nb3Ugd2FudCB0byBkaXNhYmxlIGV4ZWN1dGlvbiBvZiBhbiBlbnRpcmUgdGVz\ndCBjYXNlCiAgICAgKiBjbGFzcyBmb3IgYSBnaXZlbiBkYXRhYmFzZSwgeW91\nIG1pZ2h0IHdhbnQgdG8gYWRkIHRoZSBjbGFzcyB0bwogICAgICogdGhlIGV4\nY2x1ZGVkIHRlc3QgbGlzdCBpbiB0aGF0IGRhdGFiYXNlJ3MgcHJvcGVydGll\ncyBmaWxlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBza2lwVGVz\ndCgpIHsKICAgICAgICBpZiAoVEVTVF9NRVRIT0RTICE9IG51bGwgJiYgVEVT\nVF9NRVRIT0RTLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgcmV0dXJuIFRF\nU1RfTUVUSE9EUy5pbmRleE9mKGdldE5hbWUoKSkgPT0gLTE7CgogICAgICAg\nIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIGNhbGxlZCBiZWZvcmUgdGhlIGZpcnN0IHRlc3QgaW4gdGhpcyB0\nZXN0IGNsYXNzCiAgICAgKiBpcyBleGVjdXRlZC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0VXBUZXN0Q2xhc3MoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBh\nZnRlciB0aGUgbGFzdCB0ZXN0IGluIHRoaXMgdGVzdCBjbGFzcwogICAgICog\naXMgZXhlY3V0ZWQuIEl0IGNhbiBiZSB1c2VkIHRvIGRvIHRoaW5ncyBsaWtl\nIGNsZWFuIHVwCiAgICAgKiBsYXJnZSwgc2xvdyBwcm9jZXNzZXMgdGhhdCBt\nYXkgaGF2ZSBiZWVuIHN0YXJ0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHRlYXJEb3duVGVzdENsYXNzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoInRydWUiLmVxdWFscyhTeXN0ZW0uZ2V0UHJvcGVy\ndHkoIm1lbWluZm8iKSkpCiAgICAgICAgICAgIHByaW50TWVtb3J5SW5mbygp\nOwoKICAgICAgICBzdXBlci50ZWFyRG93bigpOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBHZW5lcmF0aW5nIHJhbmRv\nbSBkYXRhCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9tIEludGVn\nZXIgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgSW50\nZWdlciByYW5kb21JbnQoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJbnRlZ2Vy\nKChpbnQpIChNYXRoLnJhbmRvbSgpICogSW50ZWdlci5NQVhfVkFMVUUpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBh\nIHJhbmRvbSBDaGFyYWN0ZXIgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgQ2hhcmFjdGVyIHJhbmRvbUNoYXIoKSB7CiAgICAgICAg\nY2hhciBbXSBURVNUX0NIQVJfQVJSQVkgPSBuZXcgY2hhciBbXXsKICAgICAg\nICAgICAgJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdmJywgJ2cnLCAnaCcs\nICdpJywKICAgICAgICAgICAgJ2onLCAnaycsICdsJywgJ20nLCAnbicsICdv\nJywgJ3AnLCAncScsICdyJywKICAgICAgICAgICAgJ3MnLCAndCcsICd1Jywg\nJ3YnLCAndycsICd4JywgJ3knLCAneicsICcxJywKICAgICAgICAgICAgJzIn\nLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScgfTsKCiAgICAg\nICAgcmV0dXJuIG5ldyBDaGFyYWN0ZXIoVEVTVF9DSEFSX0FSUkFZWwogICAg\nICAgICAgICAoaW50KSAoTWF0aC5yYW5kb20oKSAqIFRFU1RfQ0hBUl9BUlJB\nWS5sZW5ndGgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1l\ndGhvZCB0byBnZXQgYSByYW5kb20gTG9uZyBmb3IgdGVzdGluZy4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBMb25nIHJhbmRvbUxvbmcoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBMb25nKChsb25nKSAoTWF0aC5yYW5kb20oKSAqIExv\nbmcuTUFYX1ZBTFVFKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0\nIG1ldGhvZCB0byBnZXQgYSByYW5kb20gU2hvcnQgZm9yIHRlc3RpbmcuCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU2hvcnQgcmFuZG9tU2hvcnQoKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBTaG9ydCgoc2hvcnQpIChNYXRoLnJhbmRv\nbSgpICogU2hvcnQuTUFYX1ZBTFVFKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQgYSByYW5kb20gRG91YmxlIGZvciB0\nZXN0aW5nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIERvdWJsZSByYW5k\nb21Eb3VibGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoKGRvdWJs\nZSkgKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDUwMDBkKSkgLyAxMDAw\nZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBn\nZXQgYSByYW5kb20gRmxvYXQgZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgRmxvYXQgcmFuZG9tRmxvYXQoKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBGbG9hdCgoZmxvYXQpIChNYXRoLnJvdW5kKE1hdGgucmFuZG9t\nKCkgKiA1MDAwZikpIC8gMTAwMGYpOwogICAgfQoKICAgIC8qKgogICAgICog\nU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9tIEJ5dGUgZm9yIHRlc3Rp\nbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQnl0ZSByYW5kb21CeXRl\nKCkgewogICAgICAgIHJldHVybiBuZXcgQnl0ZSgoYnl0ZSkgKE1hdGgucmFu\nZG9tKCkgKiBCeXRlLk1BWF9WQUxVRSkpOwogICAgfQoKICAgIC8qKgogICAg\nICogU3VwcG9ydCBtZXRob2QgdG8gZ2V0IGEgcmFuZG9tIEJvb2xlYW4gZm9y\nIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgQm9vbGVhbiBy\nYW5kb21Cb29sZWFuKCkgewogICAgICAgIHJldHVybiBuZXcgQm9vbGVhbihN\nYXRoLnJhbmRvbSgpID4gMC41ID8gdHJ1ZSA6IGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFN1cHBvcnQgbWV0aG9kIHRvIGdldCBhIHJhbmRvbSBE\nYXRlIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIERh\ndGUgcmFuZG9tRGF0ZSgpIHsKICAgICAgICBsb25nIG1pbGxpcyA9IChsb25n\nKSAoTWF0aC5yYW5kb20oKSAqIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nKTsKCiAgICAgICAgLy8gcm91bmQgbWlsbGlzIHRvIHRoZSBuZWFyZXN0IDEw\nMDA6IHRoaXMgaXMgYmVjYXVzZSBzb21lCiAgICAgICAgLy8gZGF0YWJhc2Vz\nIGRvIG5vdCBzdG9yZSB0aGUgbWlsbGlzZWNvbmRzIGNvcnJlY3RseShlLmcu\nLCBNeVNRTCkuCiAgICAgICAgLy8gVGhpcyBpcyBhIHJlYWxseSBhIGJ1ZyB3\nZSBzaG91bGQgZml4LiBGQyAjMjcuCiAgICAgICAgbWlsbGlzIC09IChtaWxs\naXMgJSAxMDAwKTsKCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKG1pbGxpcyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQg\nYSByYW5kb20gU3RyaW5nIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIFN0cmluZyByYW5kb21TdHJpbmcoKSB7CiAgICAgICAgLy8g\nZGVmYXVsdCB0byBhIHNtYWxsIHN0cmluZywgaW4gY2FzZSBjb2x1bW4gc2l6\nZXMgYXJlCiAgICAgICAgLy8gbGltaXRlZChzdWNoIGFzIHdpdGggYSBzdHJp\nbmcgcHJpbWFyeSBrZXkpCiAgICAgICAgcmV0dXJuIHJhbmRvbVN0cmluZyg1\nMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBn\nZXQgYSByYW5kb20gU3RyaW5nIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIFN0cmluZyByYW5kb21TdHJpbmcoaW50IGxlbikgewog\nICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAoaW50KSAoTWF0aC5yYW5k\nb20oKSAqIGxlbikgKyAxOyBpKyspCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\ncmFuZG9tQ2hhcigpKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQg\nYSByYW5kb20gY2xvYiBmb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBTdHJpbmcgcmFuZG9tQ2xvYigpIHsKICAgICAgICBTdHJpbmdC\ndWZmZXIgc2J1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICB3aGls\nZSAoc2J1Zi5sZW5ndGgoKSA8ICg1ICogMTAyNCkpIHsgLy8gYXQgbGVhc3Qg\nNUsKICAgICAgICAgICAgc2J1Zi5hcHBlbmQocmFuZG9tU3RyaW5nKDEwMjQp\nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzYnVmLnRvU3RyaW5nKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQg\nYSByYW5kb20gQmlnSW50ZWdlciBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBCaWdJbnRlZ2VyIHJhbmRvbUJpZ0ludGVnZXIoKSB7\nCiAgICAgICAgLy8gdG9vIG1hbnkgb2Ygb3VyIHRlc3QgZGF0YWJhc2VzIGRv\nbid0IHN1cHBvcnQgYmlnaW50cyA+IE1BWF9MT05HOgogICAgICAgIC8vIEkg\nZG9uJ3QgbGlrZSBpdCwgYnV0IGZvciBub3csIGxldCdzIG9ubHkgdGVzdCBi\nZWxvdyBNQVhfTE9ORwogICAgICAgIEJpZ0ludGVnZXIgbG5nID0gbmV3IEJp\nZ0ludGVnZXIoCiAgICAgICAgICAgICgobG9uZykgKE1hdGgucmFuZG9tKCkg\nKiBMb25nLk1BWF9WQUxVRSkpICsgIiIpOwoKICAgICAgICBCaWdJbnRlZ2Vy\nIG11bHRpcGxpZXIgPSBuZXcgQmlnSW50ZWdlcigiMSIpOwogICAgICAgIC8v\nICgxICsgKGludCkoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSkgKyAiIik7CiAg\nICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUpCiAgICAgICAgICAgIG11\nbHRpcGxpZXIgPSBtdWx0aXBsaWVyLm11bHRpcGx5KG5ldyBCaWdJbnRlZ2Vy\nKCItMSIpKTsKCiAgICAgICAgcmV0dXJuIGxuZy5tdWx0aXBseShtdWx0aXBs\naWVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN1cHBvcnQgbWV0aG9kIHRv\nIGdldCBhIHJhbmRvbSBCaWdEZWNpbWFsIGZvciB0ZXN0aW5nLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIEJpZ0RlY2ltYWwgcmFuZG9tQmlnRGVjaW1h\nbCgpIHsKICAgICAgICBCaWdJbnRlZ2VyIHN0YXJ0ID0gcmFuZG9tQmlnSW50\nZWdlcigpOwogICAgICAgIFN0cmluZyBzdHIgPSBzdGFydC50b1N0cmluZygp\nOwogICAgICAgIC8vIHRydW5jYXRlIG9mZiB0aGUgbGFzdCA4IGRpZ2l0czog\nd2Ugc3RpbGwgZ2V0IHNvbWUKICAgICAgICAvLyBvdmVyZmxvd3Mgd2l0aCBs\nYW1lIGRhdGFiYXNlcy4KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDg7\nIGkrKykKICAgICAgICAgICAgaWYgKHN0ci5sZW5ndGgoKSA+IDIpCiAgICAg\nICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIHN0ci5sZW5ndGgo\nKSAtIDEpOwogICAgICAgIHN0YXJ0ID0gbmV3IEJpZ0ludGVnZXIoc3RyKTsK\nCiAgICAgICAgU3RyaW5nIHZhbCA9IHN0YXJ0ICsgIi4iICsgKChpbnQpIChN\nYXRoLnJhbmRvbSgpICogMTApKQogICAgICAgICAgICArICgoaW50KSAoTWF0\naC5yYW5kb20oKSAqIDEwKSkKICAgICAgICAgICAgKyAoKGludCkgKE1hdGgu\ncmFuZG9tKCkgKiAxMCkpCiAgICAgICAgICAgICsgKChpbnQpIChNYXRoLnJh\nbmRvbSgpICogMTApKQogICAgICAgICAgICArICgoaW50KSAoTWF0aC5yYW5k\nb20oKSAqIDEwKSkKICAgICAgICAgICAgKyAoKGludCkgKE1hdGgucmFuZG9t\nKCkgKiAxMCkpCiAgICAgICAgICAgICsgKChpbnQpIChNYXRoLnJhbmRvbSgp\nICogMTApKQogICAgICAgICAgICArICgoaW50KSAoTWF0aC5yYW5kb20oKSAq\nIDEwKSkKICAgICAgICAgICAgKyAoKGludCkgKE1hdGgucmFuZG9tKCkgKiAx\nMCkpCiAgICAgICAgICAgICsgKChpbnQpIChNYXRoLnJhbmRvbSgpICogMTAp\nKTsKCiAgICAgICAgcmV0dXJuIG5ldyBCaWdEZWNpbWFsKHZhbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTdXBwb3J0IG1ldGhvZCB0byBnZXQgYSByYW5k\nb20gYmxvYiBmb3IgdGVzdGluZy4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBieXRlW10gcmFuZG9tQmxvYigpIHsKICAgICAgICAvLyB1cCB0byAxMDBL\nIGJsb2IKICAgICAgICBieXRlIFtdIGJsb2IgPSBuZXcgYnl0ZSBbKGludCkg\nKE1hdGgucmFuZG9tKCkgKiAxMDI0ICogMTAwKV07CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBibG9iLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBi\nbG9iW2ldID0gcmFuZG9tQnl0ZSgpLmJ5dGVWYWx1ZSgpOwoKICAgICAgICBy\nZXR1cm4gYmxvYjsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSBzZXR0\nZXJzIGZvciBwaW1pdGl2ZXMgYW5kIHByaW1pdGl2ZSB3cmFwcGVycyBvbiB0\naGUKICAgICAqIHNwZWNpZmllZCBvYmplY3QuCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgT2JqZWN0IHJhbmRvbWl6ZUJlYW4oT2JqZWN0IGJlYW4pCiAg\nICAgICAgdGhyb3dzIEludHJvc3BlY3Rpb25FeGNlcHRpb24sIElsbGVnYWxB\nY2Nlc3NFeGNlcHRpb24sCiAgICAgICAgSW52b2NhdGlvblRhcmdldEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQmVhbkluZm8gaW5mbyA9IEludHJvc3BlY3Rvci5n\nZXRCZWFuSW5mbyhiZWFuLmdldENsYXNzKCkpOwogICAgICAgIFByb3BlcnR5\nRGVzY3JpcHRvciBbXSBwcm9wcyA9IGluZm8uZ2V0UHJvcGVydHlEZXNjcmlw\ndG9ycygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcHJvcHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgTWV0aG9kIHdyaXRlID0gcHJvcHNb\naV0uZ2V0V3JpdGVNZXRob2QoKTsKICAgICAgICAgICAgaWYgKHdyaXRlID09\nIG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nIENsYXNzIFtdIHBhcmFtcyA9IHdyaXRlLmdldFBhcmFtZXRlclR5cGVzKCk7\nCiAgICAgICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCB8fCBwYXJhbXMubGVu\nZ3RoICE9IDEpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIENsYXNzIHBhcmFtVHlwZSA9IHBhcmFtc1swXTsKICAgICAgICAgICAg\nT2JqZWN0IGFyZyA9IG51bGw7CgogICAgICAgICAgICBpZiAocGFyYW1UeXBl\nID09IGJvb2xlYW4uY2xhc3MgfHwgcGFyYW1UeXBlID09IEJvb2xlYW4uY2xh\nc3MpCiAgICAgICAgICAgICAgICBhcmcgPSByYW5kb21Cb29sZWFuKCk7CiAg\nICAgICAgICAgIGVsc2UgaWYgKHBhcmFtVHlwZSA9PSBieXRlLmNsYXNzIHx8\nIHBhcmFtVHlwZSA9PSBCeXRlLmNsYXNzKQogICAgICAgICAgICAgICAgYXJn\nID0gcmFuZG9tQnl0ZSgpOwogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5\ncGUgPT0gY2hhci5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gQ2hhcmFjdGVyLmNs\nYXNzKQogICAgICAgICAgICAgICAgYXJnID0gcmFuZG9tQ2hhcigpOwogICAg\nICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUgPT0gc2hvcnQuY2xhc3MgfHwg\ncGFyYW1UeXBlID09IFNob3J0LmNsYXNzKQogICAgICAgICAgICAgICAgYXJn\nID0gcmFuZG9tU2hvcnQoKTsKICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1U\neXBlID09IGludC5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gSW50ZWdlci5jbGFz\ncykKICAgICAgICAgICAgICAgIGFyZyA9IHJhbmRvbUludCgpOwogICAgICAg\nICAgICBlbHNlIGlmIChwYXJhbVR5cGUgPT0gbG9uZy5jbGFzcyB8fCBwYXJh\nbVR5cGUgPT0gTG9uZy5jbGFzcykKICAgICAgICAgICAgICAgIGFyZyA9IHJh\nbmRvbUxvbmcoKTsKICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1UeXBlID09\nIGRvdWJsZS5jbGFzcyB8fCBwYXJhbVR5cGUgPT0gRG91YmxlLmNsYXNzKQog\nICAgICAgICAgICAgICAgYXJnID0gcmFuZG9tRG91YmxlKCk7CiAgICAgICAg\nICAgIGVsc2UgaWYgKHBhcmFtVHlwZSA9PSBmbG9hdC5jbGFzcyB8fCBwYXJh\nbVR5cGUgPT0gRmxvYXQuY2xhc3MpCiAgICAgICAgICAgICAgICBhcmcgPSBy\nYW5kb21GbG9hdCgpOwogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUg\nPT0gU3RyaW5nLmNsYXNzKQogICAgICAgICAgICAgICAgYXJnID0gcmFuZG9t\nU3RyaW5nKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtVHlwZSA9PSBC\naWdJbnRlZ2VyLmNsYXNzKQogICAgICAgICAgICAgICAgYXJnID0gcmFuZG9t\nQmlnSW50ZWdlcigpOwogICAgICAgICAgICBlbHNlIGlmIChwYXJhbVR5cGUg\nPT0gQmlnRGVjaW1hbC5jbGFzcykKICAgICAgICAgICAgICAgIGFyZyA9IHJh\nbmRvbUJpZ0RlY2ltYWwoKTsKICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1U\neXBlID09IERhdGUuY2xhc3MpCiAgICAgICAgICAgICAgICBhcmcgPSByYW5k\nb21EYXRlKCk7CgogICAgICAgICAgICBpZiAoYXJnICE9IG51bGwpCiAgICAg\nICAgICAgICAgICB3cml0ZS5pbnZva2UoYmVhbiwgbmV3IE9iamVjdCBbXXsg\nYXJnIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJlYW47CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTXVsdGkgdGhyZWFk\naW5nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBS\nZS1leGVjdXRlIHRoZSBpbnZva2luZyBtZXRob2QgYSByYW5kb20gbnVtYmVy\nIG9mIHRpbWVzCiAgICAgKiBpbiBhIHJhbmRvbSBudW1iZXIgb2YgVGhyZWFk\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgbXR0ZXN0KCkgdGhyb3dzIFRo\ncmVhZGluZ0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gNiBpdGVyYXRpb25zIGlu\nIDggdGhyZWFkcyBpcyBhIGdvb2QgdHJhZGUtb2ZmIGJldHdlZW4KICAgICAg\nICAvLyB0ZXN0cyB0YWtpbmcgd2F5IHRvbyBsb25nIGFuZCBoYXZpbmcgYSBk\nZWNlbnQgY2hhbmNlIG9mCiAgICAgICAgLy8gaWRlbnRpZnlpbmcgTVQgcHJv\nYmxlbXMuCiAgICAgICAgaW50IGl0ZXJhdGlvbnMgPSA2OwogICAgICAgIGlu\ndCB0aHJlYWRzID0gODsKCiAgICAgICAgbXR0ZXN0KHRocmVhZHMsIGl0ZXJh\ndGlvbnMpOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0aGUgY2Fs\nbGluZyBtZXRob2QgPGNvZGU+aXRlcmF0aW9uczwvY29kZT4KICAgICAqIHRp\nbWVzIGluIDxjb2RlPnRocmVhZHM8L2NvZGU+IFRocmVhZHMuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIG10dGVzdChpbnQgdGhyZWFkcywgaW50IGl0ZXJh\ndGlvbnMpIHsKICAgICAgICBtdHRlc3QoMCwgdGhyZWFkcywgaXRlcmF0aW9u\ncyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgbXR0ZXN0KGludCBzZXJpYWxD\nb3VudCwgaW50IHRocmVhZHMsIGludCBpdGVyYXRpb25zKQogICAgICAgIHRo\ncm93cyBUaHJlYWRpbmdFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtZXRo\nb2ROYW1lID0gY2FsbGluZ01ldGhvZCgibXR0ZXN0Iik7CiAgICAgICAgbXR0\nZXN0KHNlcmlhbENvdW50LCB0aHJlYWRzLCBpdGVyYXRpb25zLCBtZXRob2RO\nYW1lLCBuZXcgT2JqZWN0IFswXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBF\neGVjdXRlIGEgdGVzdCBtZXRob2QgaW4gbXVsdGlwbGUgdGhyZWFkcy4KICAg\nICAqCiAgICAgKiBAcGFyYW0gdGhyZWFkcyB0aGUgbnVtYmVyIG9mIFRocmVh\nZHMgdG8gcnVuIGluCiAgICAgKiBAcGFyYW0gaXRlcmF0aW9ucyB0aGUgbnVt\nYmVyIG9mIHRpbWVzIHRoZSBtZXRob2Qgc2hvdWxkCiAgICAgKiBiZSBleGVj\ndXRlIGluIGEgc2luZ2xlIFRocmVhZAogICAgICogQHBhcmFtIG1ldGhvZCB0\naGUgbmFtZSBvZiB0aGUgbWV0aG9kIHRvIGV4ZWN1dGUKICAgICAqIEBwYXJh\nbSBhcmdzIHRoZSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgbWV0aG9kCiAg\nICAgKiBAdGhyb3dzIFRocmVhZGluZ0V4Y2VwdGlvbiBpZiBhbiBlcnJvcnMg\nb2NjdXIgaW4KICAgICAqIGFueSBvZiB0aGUgVGhyZWFkcy4gVGhlIGFjdHVh\nbCBleGNlcHRpb25zCiAgICAgKiB3aWxsIGJlIGVtYmVkZGVkIGluIHRoZSBl\neGNlcHRpb24uIE5vdGUgdGhhdAogICAgICogdGhpcyBtZWFucyB0aGF0IGFz\nc2VydCgpIGZhaWx1cmVzIHdpbGwgYmUKICAgICAqIHRyZWF0ZWQgYXMgZXJy\nb3JzIHJhdGhlciB0aGFuIHdhcm5pbmdzLgogICAgICogQGF1dGhvciBNYXJj\nIFBydWQnaG9tbWVhdXgKICAgICAqLwogICAgcHVibGljIHZvaWQgbXR0ZXN0\nKGludCB0aHJlYWRzLCBpbnQgaXRlcmF0aW9ucywgZmluYWwgU3RyaW5nIG1l\ndGhvZCwKICAgICAgICBmaW5hbCBPYmplY3QgW10gYXJncykgdGhyb3dzIFRo\ncmVhZGluZ0V4Y2VwdGlvbiB7CiAgICAgICAgbXR0ZXN0KDAsIHRocmVhZHMs\nIGl0ZXJhdGlvbnMsIG1ldGhvZCwgYXJncyk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgbXR0ZXN0KGludCBzZXJpYWxDb3VudCwKICAgICAgICBpbnQgdGhy\nZWFkcywgaW50IGl0ZXJhdGlvbnMsIGZpbmFsIFN0cmluZyBtZXRob2QsIGZp\nbmFsIE9iamVjdCBbXSBhcmdzKQogICAgICAgIHRocm93cyBUaHJlYWRpbmdF\neGNlcHRpb24gewogICAgICAgIGlmIChtdWx0aVRocmVhZEV4ZWN1dGluZyAh\nPSBudWxsICYmIG11bHRpVGhyZWFkRXhlY3V0aW5nLmVxdWFscyhtZXRob2Qp\nKQogICAgICAgIHsKICAgICAgICAgICAgLy8gd2UgYXJlIGN1cnJlbnRseSBl\neGVjdXRpbmcgaW4gbXVsdGktdGhyZWFkZWQgbW9kZToKICAgICAgICAgICAg\nLy8gZG9uJ3QgZGVhZGxvY2shCiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIG11bHRpVGhyZWFkRXhlY3V0aW5nID0gbWV0aG9kOwoK\nICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzcyBbXSBwYXJhbUNsYXNz\nZXMgPSBuZXcgQ2xhc3MgW2FyZ3MubGVuZ3RoXTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBwYXJhbUNsYXNzZXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICBwYXJhbUNsYXNzZXNbaV0gPSBhcmdzW2ldLmdldENs\nYXNzKCk7CgogICAgICAgICAgICBmaW5hbCBNZXRob2QgbWV0aDsKCiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBtZXRoID0gZ2V0Q2xhc3Mo\nKS5nZXRNZXRob2QobWV0aG9kLCBwYXJhbUNsYXNzZXMpOwogICAgICAgICAg\nICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gbnNtZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFRocmVhZGluZ0V4Y2VwdGlvbihuc21l\nLnRvU3RyaW5nKCksIG5zbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBmaW5hbCBPYmplY3QgdGhpeiA9IHRoaXM7CgogICAgICAgICAgICBtdHRl\nc3QoInJlZmxlY3Rpb24gaW52b2NhdGlvbjogKCIgKyBtZXRob2QgKyAiKSIs\nCiAgICAgICAgICAgICAgICBzZXJpYWxDb3VudCwgdGhyZWFkcywgaXRlcmF0\naW9ucywgbmV3IFZvbGF0aWxlUnVubmFibGUoKSB7CiAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBydW4oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgICAgICBtZXRoLmludm9rZSh0aGl6LCBhcmdzKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgbXVsdGlUaHJlYWRFeGVjdXRpbmcgPSBudWxsOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBtdHRlc3QoU3RyaW5n\nIHRpdGxlLCBmaW5hbCBpbnQgdGhyZWFkcywgZmluYWwgaW50IGl0ZXJhdGlv\nbnMsCiAgICAgICAgZmluYWwgVm9sYXRpbGVSdW5uYWJsZSBydW5uZXIpIHRo\ncm93cyBUaHJlYWRpbmdFeGNlcHRpb24gewogICAgICAgIG10dGVzdCh0aXRs\nZSwgMCwgdGhyZWFkcywgaXRlcmF0aW9ucywgcnVubmVyKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEV4ZWN1dGUgYSB0ZXN0IG1ldGhvZCBpbiBtdWx0aXBs\nZSB0aHJlYWRzLgogICAgICoKICAgICAqIEBwYXJhbSB0aXRsZSBhIGRlc2Ny\naXB0aW9uIG9mIHRoZSB0ZXN0LCBmb3IgaW5jbHVzaW9uIGluIHRoZQogICAg\nICogZXJyb3IgbWVzc2FnZQogICAgICogQHBhcmFtIHNlcmlhbENvdW50IHRo\nZSBudW1iZXIgb2YgdGltZXMgdG8gcnVuIHRoZSBtZXRob2QKICAgICAqIHNl\ncmlhbGx5IGJlZm9yZSBzcGF3bmluZyB0aHJlYWRzLgogICAgICogQHBhcmFt\nIHRocmVhZHMgdGhlIG51bWJlciBvZiBUaHJlYWRzIHRvIHJ1biBpbgogICAg\nICogQHBhcmFtIGl0ZXJhdGlvbnMgdGhlIG51bWJlciBvZiB0aW1lcyB0aGUg\nbWV0aG9kIHNob3VsZAogICAgICogQHBhcmFtIHJ1bm5lciB0aGUgVm9sYXRp\nbGVSdW5uYWJsZSB0aGF0IHdpbGwgZXhlY3V0ZQogICAgICogdGhlIGFjdHVh\nbCB0ZXN0IGZyb20gd2l0aGluIHRoZSBUaHJlYWQuCiAgICAgKiBAdGhyb3dz\nIFRocmVhZGluZ0V4Y2VwdGlvbiBpZiBhbiBlcnJvcnMgb2NjdXIgaW4KICAg\nICAqIGFueSBvZiB0aGUgVGhyZWFkcy4gVGhlIGFjdHVhbCBleGNlcHRpb25z\nCiAgICAgKiB3aWxsIGJlIGVtYmVkZGVkIGluIHRoZSBleGNlcHRpb24uIE5v\ndGUgdGhhdAogICAgICogdGhpcyBtZWFucyB0aGF0IGFzc2VydCgpIGZhaWx1\ncmVzIHdpbGwgYmUKICAgICAqIHRyZWF0ZWQgYXMgZXJyb3JzIHJhdGhlciB0\naGFuIHdhcm5pbmdzLgogICAgICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVh\ndXggYmUgZXhlY3V0ZSBpbiBhIHNpbmdsZSBUaHJlYWQKICAgICAqIEBhdXRo\nb3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIG10dGVzdChTdHJpbmcgdGl0bGUsIGZpbmFsIGludCBzZXJpYWxDb3VudCwK\nICAgICAgICBmaW5hbCBpbnQgdGhyZWFkcywgZmluYWwgaW50IGl0ZXJhdGlv\nbnMsIGZpbmFsIFZvbGF0aWxlUnVubmFibGUgcnVubmVyKQogICAgICAgIHRo\ncm93cyBUaHJlYWRpbmdFeGNlcHRpb24gewogICAgICAgIGZpbmFsIExpc3Qg\nZXhjZXB0aW9ucyA9IENvbGxlY3Rpb25zLnN5bmNocm9uaXplZExpc3QobmV3\nIExpbmtlZExpc3QoKSk7CgogICAgICAgIFRocmVhZCBbXSBydW5uZXJzID0g\nbmV3IFRocmVhZCBbdGhyZWFkc107CgogICAgICAgIGZpbmFsIGxvbmcgc3Rh\ncnRNaWxsaXMgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSArIDEwMDA7\nCgogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDw9IHRocmVhZHM7IGkrKykg\newogICAgICAgICAgICBmaW5hbCBpbnQgdGhpc1RocmVhZCA9IGk7CgogICAg\nICAgICAgICBydW5uZXJzW2kgLSAxXSA9CiAgICAgICAgICAgICAgICBuZXcg\nVGhyZWFkKHRpdGxlICsgIiBbIiArIGkgKyAiIG9mICIgKyB0aHJlYWRzICsg\nIl0iKSB7CiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkg\newogICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyBvdXIgYmVzdCB0byBo\nYXZlIGFsbCB0aHJlYWRzIHN0YXJ0IGF0IHRoZSBleGFjdAogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBzYW1lIHRpbWUuIFRoaXMgaXMgaW1wZXJmZWN0\nLCBidXQgdGhlIGNsb3NlciB3ZQogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBnZXQgdG8gZXZlcnlvbmUgc3RhcnRpbmcgYXQgdGhlIHNhbWUgdGltZSwg\ndGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJldHRlciBjaGFuY2Ug\nd2UgaGF2ZSBmb3IgaWRlbnRpZnlpbmcgTVQgcHJvYmxlbXMuCiAgICAgICAg\nICAgICAgICAgICAgICAgIHdoaWxlIChTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKSA8IHN0YXJ0TWlsbGlzKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgeWllbGQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGludCB0aGlz\nSXRlcmF0aW9uID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoOyB0aGlzSXRlcmF0\naW9uIDw9IGl0ZXJhdGlvbnM7IHRoaXNJdGVyYXRpb24rKykKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAvLyBnbyBnbyBnbyEKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBydW5uZXIucnVuKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93\nYWJsZSBlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChleGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gZW1iZWQgdGhlIGV4Y2VwdGlvbiBpbnRvIHNvbWV0\naGluZyB0aGF0IGdpdmVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gdXMgc29tZSBtb3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0aHJl\nYWRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnZp\ncm9ubWVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2Vw\ndGlvbnMuYWRkKG5ldyBUaHJlYWRpbmdFeGNlcHRpb24oInRocmVhZD0iCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdGhpcy50b1N0\ncmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nIjt0aHJlYWROdW09IiArIHRoaXNUaHJlYWQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiO21heFRocmVhZHM9IiArIHRocmVhZHMK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiO2l0ZXJh\ndGlvbj0iICsgdGhpc0l0ZXJhdGlvbgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArICI7bWF4SXRlcmF0aW9ucz0iICsgaXRlcmF0aW9u\ncywgZXJyb3IpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICAvLyBzdGFy\ndCB0aGUgc2VyaWFsIHRlc3RzKGRvZXMgbm90IHNwYXduIHRoZSB0aHJlYWRz\nKQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VyaWFsQ291bnQ7IGkr\nKykgewogICAgICAgICAgICBydW5uZXJzWzBdLnJ1bigpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gc3RhcnQgdGhlIG11bHRpdGhyZWFkZWQKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHRocmVhZHM7IGkrKykgewogICAgICAgICAg\nICBydW5uZXJzW2ldLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyB3\nYWl0IGZvciB0aGVtIGFsbCB0byBjb21wbGV0ZQogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgdGhyZWFkczsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBydW5uZXJzW2ldLmpvaW4oKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXhjZXB0aW9ucy5zaXpl\nKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOyAvLyBzd2VlZWVlZWVldDog\nbm8gZXJyb3JzCgogICAgICAgIC8vIGVtYmVkIGFsbCB0aGUgZXhjZXB0aW9u\ncyB0aGF0IHdlcmUgdGhyb3dzIGludG8gYQogICAgICAgIC8vIFRocmVhZGlu\nZ0V4Y2VwdGlvbgogICAgICAgIFRocm93YWJsZSBbXSBlcnJvcnMgPSAoVGhy\nb3dhYmxlIFtdKSBleGNlcHRpb25zLnRvQXJyYXkoCiAgICAgICAgICAgIG5l\ndyBUaHJvd2FibGUgWzBdKTsKICAgICAgICB0aHJvdyBuZXcgVGhyZWFkaW5n\nRXhjZXB0aW9uKCJUaGUgIgogICAgICAgICAgICArIGVycm9ycy5sZW5ndGgg\nKyAiIGVtYmVkZGVkIGVycm9ycyAiCiAgICAgICAgICAgICsgIm9jY3VyZWQg\naW4gdGhlIGV4ZWN1dGlvbiBvZiAiICsgaXRlcmF0aW9ucyArICIgaXRlcmF0\naW9ucyAiCiAgICAgICAgICAgICsgIm9mICIgKyB0aHJlYWRzICsgIiB0aHJl\nYWRzOiBbIiArIHRpdGxlICsgIl0iLCBlcnJvcnMpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ2hlY2sgdG8gc2VlIGlmIHdlIGFyZSBpbiB0aGUgdG9wLWxl\ndmVsIGV4ZWN1dGlvbiBzdGFjay4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNSb290VGhyZWFkKCkgewogICAgICAgIHJldHVybiBtdWx0aVRocmVh\nZEV4ZWN1dGluZyA9PSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBsYXN0IG1ldGhvZCBuYW1lIHRoYXQgY2FsbGVkIHRoaXMgb25l\nIGJ5CiAgICAgKiBwYXJzaW5nIHRoZSBjdXJyZW50IHN0YWNrIHRyYWNlLgog\nICAgICoKICAgICAqIEBwYXJhbSBleGNsdWRlIGEgbWV0aG9kIG5hbWUgdG8g\nc2tpcAogICAgICogQHRocm93cyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24gSWYg\ndGhlIGNhbGxpbmcgbWV0aG9kIGNvdWxkIG5vdCBiZQogICAgICogaWRlbnRp\nZmllZC4KICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgY2FsbGluZ01ldGhvZChTdHJpbmcgZXhj\nbHVkZSkgewogICAgICAgIC8vIGRldGVybWluZSB0aGUgY3VycmVudGx5IGV4\nZWN1dGluZyBtZXRob2QgYnkKICAgICAgICAvLyBsb29raW5nIGF0IHRoZSBz\ndGFjayB0cmFjay4gSGFja2lzaCwgYnV0IGNvbnZlbmllbnQuCiAgICAgICAg\nU3RyaW5nV3JpdGVyIHN3ID0gbmV3IFN0cmluZ1dyaXRlcigpOwogICAgICAg\nIG5ldyBFeGNlcHRpb24oKS5wcmludFN0YWNrVHJhY2UobmV3IFByaW50V3Jp\ndGVyKHN3KSk7CiAgICAgICAgZm9yIChTdHJpbmdUb2tlbml6ZXIgc3RhY2tU\ncmFjZSA9IG5ldyBTdHJpbmdUb2tlbml6ZXIoc3cudG9TdHJpbmcoKSwKICAg\nICAgICAgICAgU3lzdGVtLmdldFByb3BlcnR5KCJsaW5lLnNlcGFyYXRvciIp\nKTsKICAgICAgICAgICAgc3RhY2tUcmFjZS5oYXNNb3JlVG9rZW5zKCk7KSB7\nCiAgICAgICAgICAgIFN0cmluZyBsaW5lID0gc3RhY2tUcmFjZS5uZXh0VG9r\nZW4oKS50cmltKCk7CgogICAgICAgICAgICAvLyBub3QgYSBzdGFjayB0cmFj\nZSBlbGVtZW50CiAgICAgICAgICAgIGlmICghKGxpbmUuc3RhcnRzV2l0aCgi\nYXQgIikpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICBTdHJpbmcgZnVsbE1ldGhvZE5hbWUgPSBsaW5lLnN1YnN0cmluZygwLCBs\naW5lLmluZGV4T2YoIigiKSk7CgogICAgICAgICAgICBTdHJpbmcgc2hvcnRN\nZXRob2ROYW1lID0gZnVsbE1ldGhvZE5hbWUuc3Vic3RyaW5nKAogICAgICAg\nICAgICAgICAgZnVsbE1ldGhvZE5hbWUubGFzdEluZGV4T2YoIi4iKSArIDEp\nOwoKICAgICAgICAgICAgLy8gc2tpcCBvdXIgb3duIG1ldGhvZHMhCiAgICAg\nICAgICAgIGlmIChzaG9ydE1ldGhvZE5hbWUuZXF1YWxzKCJjYWxsaW5nTWV0\naG9kIikpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAg\naWYgKGV4Y2x1ZGUgIT0gbnVsbCAmJiBzaG9ydE1ldGhvZE5hbWUuZXF1YWxz\nKGV4Y2x1ZGUpKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICByZXR1cm4gc2hvcnRNZXRob2ROYW1lOwogICAgICAgIH0KCiAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQ291bGQgbm90\nIGlkZW50aWZ5IGNhbGxpbmcgIgogICAgICAgICAgICArICJtZXRob2QgaW4g\nc3RhY2sgdHJhY2UiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEEgUnVubmFi\nbGUgdGhhdCBjYW4gdGhyb3cgYW4gRXhjZXB0aW9uOiB1c2VkIHRvIHRlc3Qg\nY2FzZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIFZv\nbGF0aWxlUnVubmFibGUgewoKICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB0\naHJvd3MgRXhjZXB0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogRXhjZXB0\naW9uIGZvciBlcnJvcnMgY2F1Z2h0IGR1cmluZyB0aHJlYWRpbmcgdGVzdHMu\nCiAgICAgKi8KICAgIHB1YmxpYyBjbGFzcyBUaHJlYWRpbmdFeGNlcHRpb24g\nZXh0ZW5kcyBSdW50aW1lRXhjZXB0aW9uIHsKCiAgICAgICAgcHJpdmF0ZSBm\naW5hbCBUaHJvd2FibGVbXSBfbmVzdGVkOwoKICAgICAgICBwdWJsaWMgVGhy\nZWFkaW5nRXhjZXB0aW9uKFN0cmluZyBtc2csIFRocm93YWJsZSBuZXN0ZWQp\nIHsKICAgICAgICAgICAgc3VwZXIobXNnKTsKICAgICAgICAgICAgaWYgKG5l\nc3RlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgX25lc3RlZCA9IG5ldyBU\naHJvd2FibGVbMF07CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIF9uZXN0ZWQgPSBuZXcgVGhyb3dhYmxlW117IG5lc3RlZCB9OwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFRocmVhZGluZ0V4Y2VwdGlvbihTdHJpbmcg\nbXNnLCBUaHJvd2FibGVbXSBuZXN0ZWQpIHsKICAgICAgICAgICAgc3VwZXIo\nbXNnKTsKICAgICAgICAgICAgaWYgKG5lc3RlZCA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX25lc3RlZCA9IG5ldyBUaHJvd2FibGVbMF07CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9uZXN0ZWQgPSBuZXN0ZWQ7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBwcmludFN0YWNrVHJhY2Uo\nKSB7CiAgICAgICAgICAgIHByaW50U3RhY2tUcmFjZShTeXN0ZW0ub3V0KTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHByaW50U3RhY2tUcmFj\nZShQcmludFN0cmVhbSBvdXQpIHsKICAgICAgICAgICAgcHJpbnRTdGFja1Ry\nYWNlKG5ldyBQcmludFdyaXRlcihvdXQpKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHByaW50U3RhY2tUcmFjZShQcmludFdyaXRlciBvdXQp\nIHsKICAgICAgICAgICAgc3VwZXIucHJpbnRTdGFja1RyYWNlKG91dCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX25lc3RlZC5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICAgICAgb3V0LnByaW50KCJOZXN0ZWQgVGhy\nb3dhYmxlICMiICsgKGkgKyAxKSArICI6ICIpOwogICAgICAgICAgICAgICAg\nX25lc3RlZFtpXS5wcmludFN0YWNrVHJhY2Uob3V0KTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vCiAgICAvLyBUaW1p\nbmcKICAgIC8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFNsZWVwIHRoZSBj\ndXJyZW50IFRocmVhZCBmb3IgYSByYW5kb20gYW1vdW50IG9mIHRpbWUgZnJv\nbSAwLTEwMDAgbXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNsZWVwUmFu\nZG9tKCkgewogICAgICAgIHNsZWVwUmFuZG9tKDEwMDApOwogICAgfQoKICAg\nIC8qKgogICAgICogU2xlZXAgdGhlIGN1cnJlbnQgVGhyZWFkIGZvciBhIHJh\nbmRvbSBhbW91bnQgb2YgdGltZSBmcm9tCiAgICAgKiAwLTxjb2RlPm1heDwv\nY29kZT4gbXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNsZWVwUmFuZG9t\nKGludCBtYXgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBUaHJlYWQu\nY3VycmVudFRocmVhZCgpLnNsZWVwKChsb25nKSAoTWF0aC5yYW5kb20oKSAq\nIG1heCkpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGV4KSB7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmUtcnVu\nIHRoaXMgbWV0aG9kIGluIHRoZSBjdXJyZW50IHRocmVhZCwgdGltaW5nIG91\ndAogICAgICogYWZ0ZXIgdGhlIHNwZWNpZmllZCBudW1iZXIgb2Ygc2Vjb25k\ncy4KICAgICAqIFVzYWdlOgogICAgICogPHByZT4gcHVibGljIHZvaWQgdGlt\nZU91dE9wZXJhdGlvbigpIHsgaWYgKHRpbWVvdXQoNSAqIDEwMDApKSByZXR1\ncm47CiAgICAgKiAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5zbGVlcCgxMCAq\nIDEwMDApOyB9CiAgICAgKiA8L3ByZT4KICAgICAqIDxwLz4KICAgICAqIDxw\nLz4KICAgICAqIDxzdHJvbmc+V2FybmluZzwvc3Ryb25nPiB0aGlzIG1ldGhv\nZCBzaG91bGQgYmUgdXNlZCBzcGFyaW5nbHksCiAgICAgKiBhbmQgb25seSB3\naGVuIHlvdSBleHBlY3QgdGhhdCBhIHRpbWVvdXQgd2lsbCA8c3Ryb25nPm5v\ndDwvc3Ryb25nPgogICAgICogb2NjdXIuIEl0IHV0aWxpemVkIHRoZSBkZXBy\nZWNhdGVkIHtAbGluayBUaHJlYWQjc3RvcCgpfSBhbmQKICAgICAqIHtAbGlu\nayBUaHJlYWQjaW50ZXJydXB0fSBtZXRob2RzLCB3aGljaCBjYW4gbGVhdmUg\nbW9uaXRvcnMgaW4gYW4KICAgICAqIGludmFsaWQgc3RhdGUuIEl0IGlzIG9u\nbHkgdXNlZCBiZWNhdXNlIGl0IHByb3ZpZGVzIG1vcmUKICAgICAqIG1lYW5p\nbmdmdWwgaW5mb3JtYXRpb24gdGhhbiBqdXN0IHNlZWluZyB0aGF0IHRoZSBl\nbnRpcmUgYXV0b2J1aWxkCiAgICAgKiB0aW1lZCBvdXQuCiAgICAgKgogICAg\nICogQHBhcmFtIG1pbGxpcyB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB3\nZSBzaG91bGQgd2FpdC4KICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB3ZSBhcmUg\nYXJlIGluIHRoZSB0aHJlYWQgdGhhdCByZXF1ZXN0ZWQgdGhlCiAgICAgKiAg\nICAgICAgIHRpbWVvdXQsIGZhbHNlIGlmIHdlIGFyZSBpbiB0aGUgdGltZW91\ndCB0aHJlYWQgaXRzZWxmLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB0\naW1lb3V0KGxvbmcgbWlsbGlzKSB0aHJvd3MgVGhyb3dhYmxlIHsKICAgICAg\nICBTdHJpbmcgbWV0aG9kTmFtZSA9IGNhbGxpbmdNZXRob2QoInRpbWVvdXQi\nKTsKICAgICAgICByZXR1cm4gdGltZW91dChtaWxsaXMsIG1ldGhvZE5hbWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjdGltZW91dChsb25nKQog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB0aW1lb3V0KGxvbmcgbWlsbGlz\nLCBTdHJpbmcgbWV0aG9kTmFtZSkgdGhyb3dzIFRocm93YWJsZSB7CiAgICAg\nICAgLy8gd2UgYXJlIGluIHRoZSB0aW1pbmcgb3V0LXRocmVhZDogZG8gbm90\naGluZyBzbyB0aGUKICAgICAgICAvLyBhY3R1YWwgdGVzdCBtZXRob2QgY2Fu\nIHJ1bgogICAgICAgIGlmIChpblRpbWVvdXRUaHJlYWQpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgaW5UaW1lb3V0VGhyZWFkID0gdHJ1\nZTsKICAgICAgICBsb25nIGVuZFRpbWUgPSBTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKSArIG1pbGxpczsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nZmluYWwgTWV0aG9kIG1ldGhvZCA9IGdldENsYXNzKCkuCiAgICAgICAgICAg\nICAgICBnZXRNZXRob2QobWV0aG9kTmFtZSwgKENsYXNzW10pIG51bGwpOwog\nICAgICAgICAgICBmaW5hbCBPYmplY3QgdGh6ID0gdGhpczsKCiAgICAgICAg\nICAgIC8vIHNwYXduIHRocmVhZAogICAgICAgICAgICBUaW1lT3V0VGhyZWFk\nIHRvdCA9IG5ldyBUaW1lT3V0VGhyZWFkKCJUaW1lT3V0VGhyZWFkIFsiCiAg\nICAgICAgICAgICAgICArIG1ldGhvZE5hbWUgKyAiXSAoIiArIG1pbGxpcyAr\nICJtcykiKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgbWV0aG9kLmludm9rZSh0aHosIChPYmplY3RbXSkgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3dhYmxlID0gdDsKICAgICAgICAg\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAg\nICBjb21wbGV0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHRv\ndC5zdGFydCgpOwoKICAgICAgICAgICAgLy8gd2FpdCBmb3IgdGhlIGNvbXBs\nZXRpb24gb3IgYSB0aW1lb3V0IHRvIG9jY3VyCiAgICAgICAgICAgIHRvdC5q\nb2luKG1pbGxpcyk7CgogICAgICAgICAgICAvLyBoYXZlIHdlIHRpbWVkIG91\ndD8gS2lsbCB0aGUgdGhyZWFkIGFuZCB0aHJvdyBhbiBleGNlcHRpb24KICAg\nICAgICAgICAgaWYgKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpID49IGVu\nZFRpbWUpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGFyZSB3YWl0aW5n\nIG9uIGEgbW9uaXRvciwgdGhpcyB3aWxsIGdpdmUKICAgICAgICAgICAgICAg\nIC8vIHVzIGEgdXNlZnVsIHN0YWNrIHRyYWNlLgogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICB0b3QuaW50ZXJydXB0KCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJl\nYWQoKS5zbGVlcCg1MDApOwoKICAgICAgICAgICAgICAgIC8vIHRyeSB0byBr\naWxsIHRoZSB0aHJlYWQKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgdG90LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFRocm93YWJsZSBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLnNsZWVwKDUwMCk7Cgog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9wZXJhdGlvblRpbWVkT3V0RXhj\nZXB0aW9uKCJFeGVjdXRpb24gb2YgXCIiCiAgICAgICAgICAgICAgICAgICAg\nKyBtZXRob2ROYW1lICsgIlwiIHRpbWVkIG91dCBhZnRlciAiCiAgICAgICAg\nICAgICAgICAgICAgKyBtaWxsaXMgKyAiIG1pbGxpc2Vjb25kcyIsIHRvdC50\naHJvd2FibGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB0aHJv\ndyBhbnkgZXhjZXB0aW9ucyB0aGF0IG1heSBoYXZlIG9jY3VyZWQKICAgICAg\nICAgICAgaWYgKHRvdC50aHJvd2FibGUgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHRocm93IHRvdC50aHJvd2FibGU7CgogICAgICAgICAgICAvLyBJIGd1\nZXNzIGV2ZXJ5dGhpbmcgd2FzIE9LCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGluVGltZW91dFRo\ncmVhZCA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFV0aWxpdHkgbWV0aG9kIHRvIHN0YXJ0IGEgcHJvZmlsZS4KICAgICAqCiAg\nICAgKiBAc2VlICNlbmRQcm9maWxlKFN0cmluZykKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc3RhcnRQcm9maWxlKFN0cmluZyBuYW1lKSB7CiAgICAgICAg\nX3RpbWVzLnB1dChuYW1lLCBuZXcgTG9uZyhTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogVXRpbGl0eSB0byBl\nbmQgdGhlIHByb2ZpbGUgYW5kIHByaW50IG91dCB0aGUgdGltZS4gRXhhbXBs\nZSB1c2FnZToKICAgICAqIDxwLz4KICAgICAqIDxwcmU+PGNvZGU+IHN0YXJ0\nUHJvZmlsZSgiU29tZSBsb25nIHRhc2siKTsgZG9Tb21lTG9uZ1Rhc2soKTsK\nICAgICAqIGVuZFByb2ZpbGUoIlNvbWUgbG9uZyB0YXNrIik7CiAgICAgKiA8\nL2NvZGU+PC9wcmU+CiAgICAgKgogICAgICogQHBhcmFtIG5hbWUKICAgICAq\nIEByZXR1cm4gdGhlIGFtb3VudCBvZiB0aW1lIHRoYXQgdGhpcyBwcm9maWxl\nIGludm9jYXRpb24gdG9vaywgb3IKICAgICAqICAgICAgICAgLTEgaWYgPGNv\nZGU+bmFtZTwvY29kZT4gd2FzIG5ldmVyIHN0YXJ0ZWQuCiAgICAgKi8KICAg\nIHB1YmxpYyBsb25nIGVuZFByb2ZpbGUoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICBMb25nIHRpbWUgPSAoTG9uZykgX3RpbWVzLnJlbW92ZShuYW1lKTsKCiAg\nICAgICAgbG9uZyBlbGFwc2VkID0gLTE7CiAgICAgICAgaWYgKHRpbWUgIT0g\nbnVsbCkKICAgICAgICAgICAgZWxhcHNlZCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpIC0gdGltZS5sb25nVmFsdWUoKTsKCiAgICAgICAgZ2V0TG9n\nKCkuaW5mbyhfbG9jLmdldCgicHJvZmlsZS1pbmZvIiwgbmFtZSwKICAgICAg\nICAgICAgKHRpbWUgPT0gbnVsbCA/ICI/Pz8iIDogIiIgKyBlbGFwc2VkKSkp\nOwogICAgICAgIHJldHVybiBlbGFwc2VkOwogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFRpbWVPdXRUaHJlYWQgZXh0ZW5kcyBUaHJlYWQgewoK\nICAgICAgICBwdWJsaWMgVGhyb3dhYmxlIHRocm93YWJsZSA9IG51bGw7CiAg\nICAgICAgcHVibGljIGJvb2xlYW4gY29tcGxldGVkID0gZmFsc2U7CgogICAg\nICAgIHB1YmxpYyBUaW1lT3V0VGhyZWFkKFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgICAgIHN1cGVyKG5hbWUpOwogICAgICAgICAgICBzZXREYWVtb24odHJ1\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5kaWNhdGVz\nIHRoYXQgYSB0aW1lb3V0IG9jY3VyZWQuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgY2xhc3MgT3BlcmF0aW9uVGltZWRPdXRFeGNlcHRpb24gZXh0ZW5k\ncyBSdW50aW1lRXhjZXB0aW9uIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBU\naHJvd2FibGUgX2VycjsKCiAgICAgICAgcHVibGljIE9wZXJhdGlvblRpbWVk\nT3V0RXhjZXB0aW9uKFN0cmluZyBtc2csIFRocm93YWJsZSB0aHJvd2FibGUp\nIHsKICAgICAgICAgICAgc3VwZXIobXNnKTsKICAgICAgICAgICAgX2VyciA9\nIHRocm93YWJsZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHBy\naW50U3RhY2tUcmFjZSgpIHsKICAgICAgICAgICAgcHJpbnRTdGFja1RyYWNl\nKFN5c3RlbS5vdXQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\ncHJpbnRTdGFja1RyYWNlKFByaW50U3RyZWFtIG91dCkgewogICAgICAgICAg\nICBwcmludFN0YWNrVHJhY2UobmV3IFByaW50V3JpdGVyKG91dCkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHJpbnRTdGFja1RyYWNlKFBy\naW50V3JpdGVyIG91dCkgewogICAgICAgICAgICBzdXBlci5wcmludFN0YWNr\nVHJhY2Uob3V0KTsKICAgICAgICAgICAgaWYgKF9lcnIgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgb3V0LnByaW50KCJOZXN0ZWQgVGhyb3dhYmxlOiAi\nKTsKICAgICAgICAgICAgICAgIF9lcnIucHJpbnRTdGFja1RyYWNlKG91dCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ2xhc3NMb2FkZXIgZnVuY3Rpb25z\nCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBDbGFzc0xvYWRlciB0aGF0IHdpbGwgbm90IHVzZSB0aGUg\ncGFyZW50CiAgICAgKiBDbGFzc0xvYWRlciB0byByZXNvbHZlIGNsYXNzZXMu\nIFRoaXMgaXMgdXNlZnVsIGZvcgogICAgICogdGVzdGluZyBpbnRlcmFjdGlv\nbnMgYmV0d2VlbiBLb2RvIGluIHJ1bm5pbmcKICAgICAqIGluIENsYXNzTG9h\nZGVyQSBhbmQgaW5zdGFuY2VzIGluIENsYXNzTG9hZGVyQi4KICAgICAqLwog\nICAgcHVibGljIENsYXNzTG9hZGVyIGNyZWF0ZUlzb2xhdGVkQ2xhc3NMb2Fk\nZXIoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJc29sYXRlZENsYXNzTG9hZGVy\nKCk7CiAgICB9CgogICAgcHVibGljIE5lc3RlZENsYXNzTG9hZGVyIGNyZWF0\nZU5lc3RlZENsYXNzTG9hZGVyKCkgewogICAgICAgIHJldHVybiBuZXcgTmVz\ndGVkQ2xhc3NMb2FkZXIoZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyBOZXN0\nZWRDbGFzc0xvYWRlciBjcmVhdGVOZXN0ZWRQYXJlbnRDbGFzc0xvYWRlcigp\nIHsKICAgICAgICByZXR1cm4gbmV3IE5lc3RlZENsYXNzTG9hZGVyKHRydWUp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVsb2FkIHRoZSBzcGVjaWZpZWQg\nY2xhc3MgaW4gYW4gaXNvbGF0ZWQgQ2xhc3NMb2FkZXIuCiAgICAgKgogICAg\nICogQHBhcmFtIHRhcmdldCB0aGUgdGFyZ2V0IGNsYXNzIHRvIGxvYWQKICAg\nICAqIEByZXR1cm4gdGhlIENsYXNzIGFzIHJlbG9hZGVkIGluIGFuIG5ldyBD\nbGFzc0xvYWRlcgogICAgICovCiAgICBwdWJsaWMgQ2xhc3MgaXNvbGF0ZShD\nbGFzcyB0YXJnZXQpIHRocm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsK\nICAgICAgICBDbGFzcyByZXN1bHQgPSBpc29sYXRlKHRhcmdldC5nZXROYW1l\nKCkpOwogICAgICAgIGFzc2VydFRydWUocmVzdWx0ICE9IHRhcmdldCk7CiAg\nICAgICAgYXNzZXJ0Tm90RXF1YWxzKHJlc3VsdCwgdGFyZ2V0KTsKICAgICAg\nICBhc3NlcnRUcnVlKHJlc3VsdC5nZXRDbGFzc0xvYWRlcigpICE9IHRhcmdl\ndC5nZXRDbGFzc0xvYWRlcigpKTsKICAgICAgICByZXR1cm4gcmVzdWx0Owog\nICAgfQoKICAgIHB1YmxpYyBDbGFzcyBpc29sYXRlKFN0cmluZyB0YXJnZXQp\nIHRocm93cyBDbGFzc05vdEZvdW5kRXhjZXB0aW9uIHsKICAgICAgICBDbGFz\nc0xvYWRlciBpbCA9IGNyZWF0ZUlzb2xhdGVkQ2xhc3NMb2FkZXIoKTsKICAg\nICAgICBDbGFzcyByZXN1bHQgPSBpbC5sb2FkQ2xhc3ModGFyZ2V0KTsKICAg\nICAgICBhc3NlcnRFcXVhbHMocmVzdWx0LmdldE5hbWUoKSwgdGFyZ2V0KTsK\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBwdWJsaWMgQ2xh\nc3MgbmVzdChDbGFzcyB0YXJnZXQpIHRocm93cyBDbGFzc05vdEZvdW5kRXhj\nZXB0aW9uIHsKICAgICAgICBDbGFzc0xvYWRlciBpbCA9IGNyZWF0ZU5lc3Rl\nZENsYXNzTG9hZGVyKCk7CiAgICAgICAgQ2xhc3MgcmVzdWx0ID0gaWwubG9h\nZENsYXNzKHRhcmdldC5nZXROYW1lKCkpOwogICAgICAgIGFzc2VydFRydWUo\ncmVzdWx0ICE9IHRhcmdldCk7CiAgICAgICAgYXNzZXJ0Tm90RXF1YWxzKHJl\nc3VsdCwgdGFyZ2V0KTsKICAgICAgICBhc3NlcnRUcnVlKHJlc3VsdC5nZXRD\nbGFzc0xvYWRlcigpICE9IHRhcmdldC5nZXRDbGFzc0xvYWRlcigpKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMocmVzdWx0LmdldE5hbWUoKSwgdGFyZ2V0Lmdl\ndE5hbWUoKSk7CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAg\ncHVibGljIE9iamVjdCBpc29sYXRlTmV3KENsYXNzIHRhcmdldCkKICAgICAg\nICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgSWxsZWdhbEFjY2Vz\nc0V4Y2VwdGlvbiwKICAgICAgICBJbnN0YW50aWF0aW9uRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gaXNvbGF0ZSh0YXJnZXQpLm5ld0luc3RhbmNlKCk7\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTmVzdGVkQ2xhc3NM\nb2FkZXIgZXh0ZW5kcyBBbnRDbGFzc0xvYWRlciB7CgogICAgICAgIHB1Ymxp\nYyBOZXN0ZWRDbGFzc0xvYWRlcihib29sZWFuIHVzZVBhcmVudCkgewogICAg\nICAgICAgICBzdXBlcihDbGFzc0xvYWRlci5nZXRTeXN0ZW1DbGFzc0xvYWRl\ncigpLCB1c2VQYXJlbnQpOwoKICAgICAgICAgICAgZm9yIChTdHJpbmdUb2tl\nbml6ZXIgY2x0b2sgPSBuZXcgU3RyaW5nVG9rZW5pemVyKAogICAgICAgICAg\nICAgICAgU3lzdGVtLmdldFByb3BlcnR5KCJqYXZhLmNsYXNzLnBhdGgiKSwg\nRmlsZS5wYXRoU2VwYXJhdG9yKTsKICAgICAgICAgICAgICAgIGNsdG9rLmhh\nc01vcmVUb2tlbnMoKTspIHsKICAgICAgICAgICAgICAgIFN0cmluZyBwYXRo\nID0gY2x0b2submV4dFRva2VuKCk7CgogICAgICAgICAgICAgICAgLy8gb25s\neSBsb2FkIHRlc3QgcGF0aHMsIG5vdCBqYXIgZmlsZXMKICAgICAgICAgICAg\nICAgIGlmIChwYXRoLmluZGV4T2YoIi5qYXIiKSAhPSAtMSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChwYXRo\nLmluZGV4T2YoIi56aXAiKSAhPSAtMSkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICBhZGRQYXRoRWxlbWVudChwYXRo\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGlmICghdXNlUGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZShsb2FkQ2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAg\nKEFic3RyYWN0VGVzdENhc2UuY2xhc3MuZ2V0TmFtZSgpKS5nZXRDbGFzc0xv\nYWRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICE9IEFic3RyYWN0VGVz\ndENhc2UuY2xhc3MuZ2V0Q2xhc3NMb2FkZXIoKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRp\nb24gY25mZSkgewogICAgICAgICAgICAgICAgZmFpbChjbmZlLnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nQ2xhc3MgZmluZENsYXNzKFN0cmluZyBuYW1lKSB0aHJvd3MgQ2xhc3NOb3RG\nb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIC8vIGRvbid0IGlzb2xhdGUg\nUEMgYW5kIHJlbGF0ZWQgY2xhc3NlcyBpbiBrb2RvLmVuaG5hY2UKICAgICAg\nICAgICAgaWYgKG5hbWUuaW5kZXhPZigiLmVuaGFuY2UuIikgIT0gLTEpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlv\nbihuYW1lKTsKICAgICAgICAgICAgaWYgKG5hbWUuaW5kZXhPZigiL2VuaGFu\nY2UvIikgIT0gLTEpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NO\nb3RGb3VuZEV4Y2VwdGlvbihuYW1lKTsKICAgICAgICAgICAgcmV0dXJuIHN1\ncGVyLmZpbmRDbGFzcyhuYW1lKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBIENsYXNzTG9hZGVyIHRoYXQgaXMgY29tcGxldGVseSBpc29s\nYXRlZCB3aXRoIHJlc3BlY3QgdG8KICAgICAqIGFueSBjbGFzc2VzIHRoYXQg\nYXJlIGxvYWRlZCBpbiB0aGUgU3lzdGVtIENsYXNzTG9hZGVyLgogICAgICoK\nICAgICAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIElzb2xhdGVkQ2xhc3NMb2FkZXIgZXh0\nZW5kcyBOZXN0ZWRDbGFzc0xvYWRlciB7CgogICAgICAgIHB1YmxpYyBJc29s\nYXRlZENsYXNzTG9hZGVyKCkgewogICAgICAgICAgICBzdXBlcihmYWxzZSk7\nCiAgICAgICAgICAgIHNldElzb2xhdGVkKGZhbHNlKTsKICAgICAgICB9CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb2xsZWN0aW9ucwog\nICAgLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0\naGF0IHRoZSBzcGVjaWZpZWQge0BsaW5rIENvbGxlY3Rpb259IGZ1bGZpbGxz\nIHRoZQogICAgICogQ29sbGVjdGlvbiBjb250cmFjdCBhcyBzcGVjaWZpZWQg\nYnkgdGhlIENvbGxlY3Rpb25zIEFQSS4KICAgICAqIDxwLz4KICAgICAqIDxz\ndHJvbmc+Tm90ZTwvc3Ryb25nPjogZG9lcyBub3QgdmFsaWRhdGUgbXV0YWJs\nZSBvcGVyYXRpb25zCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCB2\nYWxpZGF0ZUNvbGxlY3Rpb24oQ29sbGVjdGlvbiBjb2xsZWN0aW9uKSB7CiAg\nICAgICAgaW50IHNpemUgPSBjb2xsZWN0aW9uLnNpemUoKTsKICAgICAgICBp\nbnQgaXRlcmF0ZWQgPSAwOwogICAgICAgIC8vIGVuc3VyZSB3ZSBjYW4gd2Fs\nayBhbG9uZyB0aGUgaXRlcmF0b3IKICAgICAgICBmb3IgKEl0ZXJhdG9yIGkg\nPSBjb2xsZWN0aW9uLml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBpdGVyYXRlZCsrOwogICAgICAgICAgICBpLm5leHQoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGVuc3VyZSB0aGUgbnVtYmVyIG9mIHZhbHVl\ncyBpdGVyYXRlZCBpcyB0aGUgc2FtZSBhcyB0aGUgbGlzdCBzaXplCiAgICAg\nICAgYXNzZXJ0RXF1YWxzKHNpemUsIGl0ZXJhdGVkKTsKCiAgICAgICAgLy8g\nYWxzbyB2YWxpZGF0ZSB0aGUgbGlzdAogICAgICAgIGlmIChjb2xsZWN0aW9u\nIGluc3RhbmNlb2YgTGlzdCkgewogICAgICAgICAgICBMaXN0IGxsID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIDEwMDsgaSsrKQogICAgICAgICAgICAgICAgbGwuYWRkKG5ldyBJbnRlZ2Vy\nKGkpKTsKICAgICAgICAgICAgdmFsaWRhdGVMaXN0KChMaXN0KSBsbCk7CiAg\nICAgICAgICAgIHZhbGlkYXRlTGlzdCgoTGlzdCkgY29sbGVjdGlvbik7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0\naGUgc3BlY2lmaWVkIHtAbGluayBMaXN0fSBmdWxmaWxscyB0aGUKICAgICAq\nIExpc3QgY29udHJhY3QgYXMgc3BlY2lmaWVkIGJ5IHRoZSBDb2xsZWN0aW9u\ncyBBUEkuCiAgICAgKiA8cC8+CiAgICAgKiA8c3Ryb25nPk5vdGU8L3N0cm9u\nZz46IGRvZXMgbm90IHZhbGlkYXRlIG11dGFibGUgb3BlcmF0aW9ucwogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgdmFsaWRhdGVMaXN0KExpc3Qg\nbGlzdCkgewogICAgICAgIE9iamVjdCBbXSBjb3JlVmFsdWVzID0gbGlzdC50\nb0FycmF5KCk7CiAgICAgICAgT2JqZWN0IFtdIHZhbHVlczEgPSBuZXcgT2Jq\nZWN0IFtsaXN0LnNpemUoKV07CiAgICAgICAgT2JqZWN0IFtdIHZhbHVlczIg\nPSBuZXcgT2JqZWN0IFtsaXN0LnNpemUoKV07CiAgICAgICAgT2JqZWN0IFtd\nIHZhbHVlczMgPSBuZXcgT2JqZWN0IFtsaXN0LnNpemUoKV07CiAgICAgICAg\nT2JqZWN0IFtdIHZhbHVlczQgPSBuZXcgT2JqZWN0IFtsaXN0LnNpemUoKV07\nCgogICAgICAgIC8vIGZpbGwgc2VxdWVudGlhbCBpbmRleCBhY2Nlc3MgbGlz\ndAogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkr\nKykKICAgICAgICAgICAgdmFsdWVzMVtpXSA9IGxpc3QuZ2V0KGkpOwoKICAg\nICAgICAvLyBmaWxsIHNlcXVlbnRpYWwgbGlzdAogICAgICAgIGludCBpbmRl\neCA9IDA7CiAgICAgICAgTGlzdEl0ZXJhdG9yIGl0ZXI7CiAgICAgICAgZm9y\nIChpdGVyID0gbGlzdC5saXN0SXRlcmF0b3IoMCk7IGl0ZXIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICBhc3NlcnRFcXVhbHMoaW5kZXgsIGl0ZXIubmV4\ndEluZGV4KCkpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoaW5kZXgsIGl0\nZXIucHJldmlvdXNJbmRleCgpICsgMSk7CiAgICAgICAgICAgIHZhbHVlczJb\naW5kZXhdID0gaXRlci5uZXh0KCk7CiAgICAgICAgICAgIGFzc2VydFRydWUo\nbGlzdC5jb250YWlucyh2YWx1ZXMyW2luZGV4XSkpOwogICAgICAgICAgICBp\nbmRleCsrOwogICAgICAgIH0KCiAgICAgICAgLy8gZW5zdXJlIE5vU3VjaEVs\nZW1lbnRFeGNlcHRpb24gaXMgdGhyb3duIGFzIGFwcHJvcHJpYXRlCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaXRlci5uZXh0KCk7CiAgICAgICAgICAg\nIGZhaWwoIm5leHQoKSBzaG91bGQgaGF2ZSByZXN1bHRlZCBpbiBhIE5vU3Vj\naEVsZW1lbnRFeGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChOb1N1Y2hF\nbGVtZW50RXhjZXB0aW9uIGUpIHsKICAgICAgICB9IC8vIGFzIGV4cGVjdGVk\nCgogICAgICAgIC8vIGZpbGwgcmV2ZXJzZSBzZXF1ZW50aWFsIGxpc3QKICAg\nICAgICBpbnQgYmFjayA9IDA7CiAgICAgICAgZm9yIChpdGVyID0gbGlzdC5s\naXN0SXRlcmF0b3IobGlzdC5zaXplKCkpOyBpdGVyLmhhc1ByZXZpb3VzKCk7\nKSB7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhpbmRleCwgaXRlci5wcmV2\naW91c0luZGV4KCkgKyAxKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGlu\nZGV4LCBpdGVyLm5leHRJbmRleCgpKTsKICAgICAgICAgICAgdmFsdWVzM1st\nLWluZGV4XSA9IGl0ZXIucHJldmlvdXMoKTsKICAgICAgICAgICAgYmFjaysr\nOwogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMobGlzdC5zaXplKCks\nIGJhY2spOwoKICAgICAgICAvLyBlbnN1cmUgTm9TdWNoRWxlbWVudEV4Y2Vw\ndGlvbiBpcyB0aHJvd24gYXMgYXBwcm9wcmlhdGUKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpdGVyLnByZXZpb3VzKCk7CiAgICAgICAgICAgIGZhaWwo\nInByZXZpb3VzKCkgc2hvdWxkIGhhdmUgcmVzdWx0ZWQgaW4gYSAiCiAgICAg\nICAgICAgICAgICArICJOb1N1Y2hFbGVtZW50RXhjZXB0aW9uIik7CiAgICAg\nICAgfSBjYXRjaCAoTm9TdWNoRWxlbWVudEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgfSAvLyBhcyBleHBlY3RlZAoKICAgICAgICAvLyBmaWxsIHJhbmRvbSBh\nY2Nlc3MgbGlzdAogICAgICAgIExpc3QgaW5kaWNlcyA9IG5ldyBMaW5rZWRM\naXN0KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaXN0LnNpemUo\nKTsgaSsrKQogICAgICAgICAgICBpbmRpY2VzLmFkZChuZXcgSW50ZWdlcihp\nKSk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlzdC5zaXplKCk7\nIGkrKykgewogICAgICAgICAgICBpbnQgcmFuZCA9IChpbnQpIChNYXRoLnJh\nbmRvbSgpICogaW5kaWNlcy5zaXplKCkpOwogICAgICAgICAgICBJbnRlZ2Vy\nIHJhbmRJbmRleCA9IChJbnRlZ2VyKSBpbmRpY2VzLnJlbW92ZShyYW5kKTsK\nICAgICAgICAgICAgdmFsdWVzNFtyYW5kSW5kZXguaW50VmFsdWUoKV0gPSBs\naXN0LmdldChyYW5kSW5kZXguaW50VmFsdWUoKSk7CiAgICAgICAgfQoKICAg\nICAgICBhc3NlcnRFcXVhbHMoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVzKSwg\nQXJyYXlzLmFzTGlzdCh2YWx1ZXMxKSk7CiAgICAgICAgYXNzZXJ0SWRlbnRp\nY2FsKEFycmF5cy5hc0xpc3QoY29yZVZhbHVlcyksIEFycmF5cy5hc0xpc3Qo\ndmFsdWVzMSkpOwogICAgICAgIGFzc2VydEVxdWFscyhBcnJheXMuYXNMaXN0\nKGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNMaXN0KHZhbHVlczIpKTsKICAgICAg\nICBhc3NlcnRJZGVudGljYWwoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVzKSwg\nQXJyYXlzLmFzTGlzdCh2YWx1ZXMyKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKEFycmF5cy5hc0xpc3QoY29yZVZhbHVlcyksIEFycmF5cy5hc0xpc3QodmFs\ndWVzNCkpOwogICAgICAgIGFzc2VydElkZW50aWNhbChBcnJheXMuYXNMaXN0\nKGNvcmVWYWx1ZXMpLCBBcnJheXMuYXNMaXN0KHZhbHVlczQpKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMoQXJyYXlzLmFzTGlzdChjb3JlVmFsdWVzKSwgQXJy\nYXlzLmFzTGlzdCh2YWx1ZXMzKSk7CiAgICAgICAgYXNzZXJ0SWRlbnRpY2Fs\nKEFycmF5cy5hc0xpc3QoY29yZVZhbHVlcyksIEFycmF5cy5hc0xpc3QodmFs\ndWVzMykpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhl\nIGdpdmVuIExpc3QgY29udGFpbiB0aGUgZXhhY3Qgc2FtZQogICAgICogZWxl\nbWVudHMuIFRoaXMgaXMgZGlmZmVyZW50IHRoYW4gdGhlIG5vcm1hbCBMaXN0\nIGNvbnRyYWN0LCB3aGljaAogICAgICogc3RhdGVzIHRoYXQgbGlzdDEuZXF1\nYWxzKGxpc3QyKSBpZiBlYWNoIGVsZW1lbnQgZTEuZXF1YWxzKGUyKS4KICAg\nICAqIFRoaXMgbWV0aG9kIGFzc2VydHMgdGhhdCBlMSA9PSBuMi4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyB2b2lkIGFzc2VydElkZW50aWNhbChMaXN0\nIGMxLCBMaXN0IGMyKSB7CiAgICAgICAgYXNzZXJ0RXF1YWxzKGMxLnNpemUo\nKSwgYzIuc2l6ZSgpKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGkxID0gYzEu\naXRlcmF0b3IoKSwgaTIgPSBjMi5pdGVyYXRvcigpOwogICAgICAgICAgICBp\nMS5oYXNOZXh0KCkgJiYgaTIuaGFzTmV4dCgpOykKICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZShpMS5uZXh0KCkgPT0gaTIubmV4dCgpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSBjb2xsZWN0aW9uIHBhcmFtZXRl\nciBpcyBhbHJlYWR5IG9yZGVyZWQKICAgICAqIGFjY29yZGluZyB0byB0aGUg\nc3BlY2lmaWVkIGNvbXBhcmF0b3IuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE9yZGVyZWQoQ29sbGVjdGlvbiBjLCBDb21wYXJhdG9yIGNvbXAp\nIHsKICAgICAgICBMaXN0IGwxID0gbmV3IExpbmtlZExpc3QoYyk7CiAgICAg\nICAgTGlzdCBsMiA9IG5ldyBMaW5rZWRMaXN0KGMpOwogICAgICAgIGFzc2Vy\ndEVxdWFscyhsMSwgbDIpOwogICAgICAgIENvbGxlY3Rpb25zLnNvcnQobDIs\nIGNvbXApOwogICAgICAgIGFzc2VydEVxdWFscyhsMSwgbDIpOwogICAgICAg\nIENvbGxlY3Rpb25zLnNvcnQobDEsIGNvbXApOwogICAgICAgIGFzc2VydEVx\ndWFscyhsMSwgbDIpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBBc3NlcnRpb24gSGVscGVycwogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb3RFcXVhbHMoT2JqZWN0\nIGEsIE9iamVjdCBiKSB7CiAgICAgICAgaWYgKGEgPT0gbnVsbCAmJiBiICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoYSAhPSBu\ndWxsICYmIGIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIGlmICghKGEuZXF1YWxzKGIpKSkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGlmICghKGIuZXF1YWxzKGEpKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBmYWlsKCJleHBlY3RlZCAhPCIgKyBhICsgIj4uZXF1YWxzKDwi\nICsgYiArICI+KSIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydFNp\nemUoaW50IHNpemUsIE9iamVjdCBvYikgewogICAgICAgIGlmIChvYiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhzaXplLCAwKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9iIGlu\nc3RhbmNlb2YgQ29sbGVjdGlvbikKICAgICAgICAgICAgb2IgPSAoKENvbGxl\nY3Rpb24pIG9iKS5pdGVyYXRvcigpOwogICAgICAgIGlmIChvYiBpbnN0YW5j\nZW9mIEl0ZXJhdG9yKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yIGkgPSAoSXRl\ncmF0b3IpIG9iOwogICAgICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAg\nICAgICB3aGlsZSAoaS5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgIGNv\ndW50Kys7CiAgICAgICAgICAgICAgICBpLm5leHQoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHNpemUsIGNvdW50KTsKICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgZmFpbCgiYXNzZXJ0U2l6ZTogZXhw\nZWN0ZWQgQ29sbGVjdGlvbiwgSXRlcmF0b3IsICIKICAgICAgICAgICAgICAg\nICsgIlF1ZXJ5LCBvciBFeHRlbnQsIGJ1dCBnb3QgIiArIG9iLmdldENsYXNz\nKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KICAgIC8vIEdlbmVyaWMgdXRpbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBjb3B5KEZpbGUgZnJvbSwgRmls\nZSB0bykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBjb3B5KG5ldyBG\naWxlSW5wdXRTdHJlYW0oZnJvbSksIHRvKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjb3B5KElucHV0U3RyZWFtIGluLCBGaWxlIHRvKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIEZpbGVPdXRwdXRTdHJlYW0gZm91dCA9IG5l\ndyBGaWxlT3V0cHV0U3RyZWFtKHRvKTsKCiAgICAgICAgYnl0ZVtdIGIgPSBu\nZXcgYnl0ZVsxMDI0XTsKCiAgICAgICAgZm9yIChpbnQgbiA9IDA7IChuID0g\naW4ucmVhZChiKSkgIT0gLTE7KQogICAgICAgICAgICBmb3V0LndyaXRlKGIs\nIDAsIG4pOwogICAgfQoKICAgIC8qKgogICAgICogUHJpbnQgb3V0IGluZm9y\nbWF0aW9uIG9uIG1lbW9yeSB1c2FnZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgcHJpbnRNZW1vcnlJbmZvKCkgewogICAgICAgIFJ1bnRpbWUgcnQgPSBS\ndW50aW1lLmdldFJ1bnRpbWUoKTsKICAgICAgICBsb25nIHRvdGFsID0gcnQu\ndG90YWxNZW1vcnkoKTsKICAgICAgICBsb25nIGZyZWUgPSBydC5mcmVlTWVt\nb3J5KCk7CiAgICAgICAgbG9uZyB1c2VkID0gdG90YWwgLSBmcmVlOwoKICAg\nICAgICBOdW1iZXJGb3JtYXQgbmYgPSBOdW1iZXJGb3JtYXQuZ2V0SW5zdGFu\nY2UoKTsKICAgICAgICBnZXRMb2coKS53YXJuKF9sb2MuZ2V0KCJtZW0taW5m\nbyIsCiAgICAgICAgICAgIG5mLmZvcm1hdCh1c2VkKSwKICAgICAgICAgICAg\nbmYuZm9ybWF0KHRvdGFsKSwKICAgICAgICAgICAgbmYuZm9ybWF0KGZyZWUp\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBsaXN0IG9mIGFs\nbCB2YWx1ZXMgaXRlcmF0ZWQgYnkgdGhlIGdpdmVuIGl0ZXJhdG9yLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIExpc3QgaXRlcmF0b3JUb0xpc3QoSXRl\ncmF0b3IgaSkgewogICAgICAgIExpbmtlZExpc3QgbGlzdCA9IG5ldyBMaW5r\nZWRMaXN0KCk7CiAgICAgICAgd2hpbGUgKGkuaGFzTmV4dCgpKQogICAgICAg\nICAgICBsaXN0LmFkZChpLm5leHQoKSk7CiAgICAgICAgcmV0dXJuIGxpc3Q7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gYXJyYXkgb2YgdGhl\nIG9iamVjdHMgaXRlcmF0ZWQgYnkgdGhlIGdpdmVuIGl0ZXJhdG9yLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBbXSBpdGVyYXRvclRvQXJy\nYXkoSXRlcmF0b3IgaSwgQ2xhc3MgW10gY2xhenopIHsKICAgICAgICByZXR1\ncm4gaXRlcmF0b3JUb0xpc3QoaSkudG9BcnJheShjbGF6eik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSdW4gYW50IG9uIHRoZSBzcGVjaWZpZWQgYnVpbGQg\nZmlsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVpbGRGaWxlIHRoZSBidWls\nZCBmaWxlIHRvIHVzZQogICAgICogQHBhcmFtIHRhcmdldCB0aGUgbmFtZSBv\nZiB0aGUgdGFyZ2V0IHRvIGludm9rZQogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBhbnQoRmlsZSBidWlsZEZpbGUsIFN0cmluZyB0YXJnZXQpIHsKICAgICAg\nICBhc3NlcnRUcnVlKGJ1aWxkRmlsZS5pc0ZpbGUoKSk7CgogICAgICAgIFBy\nb2plY3QgcHJvamVjdCA9IG5ldyBQcm9qZWN0KCk7CiAgICAgICAgcHJvamVj\ndC5pbml0KCk7CiAgICAgICAgcHJvamVjdC5zZXRVc2VyUHJvcGVydHkoImFu\ndC5maWxlIiwgYnVpbGRGaWxlLmdldEFic29sdXRlUGF0aCgpKTsKICAgICAg\nICBQcm9qZWN0SGVscGVyLmNvbmZpZ3VyZVByb2plY3QocHJvamVjdCwgYnVp\nbGRGaWxlKTsKICAgICAgICBwcm9qZWN0LmV4ZWN1dGVUYXJnZXQodGFyZ2V0\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBhbmQgZGVzZXJp\nYWxpemUgdGhlIG9iamVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0gdmFsaWRh\ndGVFcXVhbGl0eSBtYWtlIHN1cmUgdGhlIGhhc2hDb2RlIGFuZCBlcXVhbHMK\nICAgICAqIG1ldGhvZHMgaG9sZCB0cnVlCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgT2JqZWN0IHJvdW5kdHJpcChPYmplY3Qgb3JpZywgYm9vbGVhbiB2\nYWxpZGF0ZUVxdWFsaXR5KQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwg\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0Tm90TnVs\nbChvcmlnKTsKCiAgICAgICAgQnl0ZUFycmF5T3V0cHV0U3RyZWFtIGJvdXQg\nPSBuZXcgQnl0ZUFycmF5T3V0cHV0U3RyZWFtKCk7CiAgICAgICAgT2JqZWN0\nT3V0cHV0U3RyZWFtIG91dCA9IG5ldyBPYmplY3RPdXRwdXRTdHJlYW0oYm91\ndCk7CiAgICAgICAgb3V0LndyaXRlT2JqZWN0KG9yaWcpOwogICAgICAgIEJ5\ndGVBcnJheUlucHV0U3RyZWFtIGJpbiA9IG5ldyBCeXRlQXJyYXlJbnB1dFN0\ncmVhbSgKICAgICAgICAgICAgYm91dC50b0J5dGVBcnJheSgpKTsKICAgICAg\nICBPYmplY3RJbnB1dFN0cmVhbSBpbiA9IG5ldyBPYmplY3RJbnB1dFN0cmVh\nbShiaW4pOwogICAgICAgIE9iamVjdCByZXN1bHQgPSBpbi5yZWFkT2JqZWN0\nKCk7CgogICAgICAgIGlmICh2YWxpZGF0ZUVxdWFsaXR5KSB7CiAgICAgICAg\nICAgIGFzc2VydEVxdWFscyhvcmlnLmhhc2hDb2RlKCksIHJlc3VsdC5oYXNo\nQ29kZSgpKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKG9yaWcsIHJlc3Vs\ndCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoK\nICAgIC8qKgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBzcGVjaWZpZWQg\naW5wdXQgbWF0Y2hlcyB0aGUgcmVndWxhciBleHByZXNzaW9uIHJlZ2V4Lgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gbWF0Y2hlcyhTdHJp\nbmcgcmVnZXgsIFN0cmluZyBpbnB1dCkKICAgICAgICB0aHJvd3MgUkVTeW50\nYXhFeGNlcHRpb24gewogICAgICAgIFJFIHJlID0gUkVVdGlsLmNyZWF0ZVJF\nKHJlZ2V4KTsKICAgICAgICByZXR1cm4gcmUubWF0Y2goaW5wdXQpOwogICAg\nfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBhc3NlcnRNYXRjaGVzKFN0cmlu\nZyByZWdleCwgU3RyaW5nIGlucHV0KSB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCEobWF0Y2hlcyhyZWdleCwgaW5wdXQpKSkKICAgICAgICAg\nICAgICAgIGZhaWwoIkV4cGVjdGVkIHJlZ3VsYXIgZXhwcmVzc2lvbjogPCIg\nKyByZWdleCArICI+IgogICAgICAgICAgICAgICAgICAgICsgIiBkaWQgbm90\nIG1hdGNoOiA8IiArIGlucHV0ICsgIj4iKTsKICAgICAgICB9IGNhdGNoIChS\nRVN5bnRheEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZS50b1N0cmluZygpKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyB2b2lkIGFzc2VydE5vdE1h\ndGNoZXMoU3RyaW5nIHJlZ2V4LCBTdHJpbmcgaW5wdXQpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAobWF0Y2hlcyhyZWdleCwgaW5wdXQpKQog\nICAgICAgICAgICAgICAgZmFpbCgiUmVndWxhciBleHByZXNzaW9uOiA8IiAr\nIHJlZ2V4ICsgIj4iCiAgICAgICAgICAgICAgICAgICAgKyAiIHNob3VsZCBu\nb3QgbWF0Y2g6IDwiICsgaW5wdXQgKyAiPiIpOwogICAgICAgIH0gY2F0Y2gg\nKFJFU3ludGF4RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihlLnRvU3RyaW5nKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoZSBsaXN0IGlm\nIHN0cmluZ3MgYW5kIHJldHVybiB0aGUgb25lcyB0aGF0IG1hdGNoCiAgICAg\nKiB0aGUgc3BlY2lmaWVkIG1hdGNoLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIExpc3QgbWF0Y2hlcyhTdHJpbmcgcmVnZXgsIENvbGxlY3Rpb24gaW5w\ndXQpCiAgICAgICAgdGhyb3dzIFJFU3ludGF4RXhjZXB0aW9uIHsKICAgICAg\nICBMaXN0IG1hdGNoZXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpID0gaW5wdXQuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIFN0cmluZyBjaGVjayA9IChTdHJpbmcpIGkubmV4\ndCgpOwogICAgICAgICAgICBpZiAobWF0Y2hlcyhyZWdleCwgY2hlY2spKQog\nICAgICAgICAgICAgICAgbWF0Y2hlcy5hZGQoY2hlY2spOwogICAgICAgIH0K\nCiAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGUgc3BlY2lmaWVkIGNvbGxlY3Rpb24gb2YgU3Ry\naW5ncyBjb250YWlucyBhdCBsZWFzdAogICAgICogb25lIHN0cmluZyB0aGF0\nIG1hdGNoZXMgdGhlIHNwZWNpZmllZCByZWd1bGFyIGV4cHJlc3Npb24uCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBhc3NlcnRNYXRjaGVzKFN0\ncmluZyByZWdleCwgQ29sbGVjdGlvbiBpbnB1dCkgewogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGlmIChtYXRjaGVzKHJlZ2V4LCBpbnB1dCkuc2l6ZSgp\nID09IDApCiAgICAgICAgICAgICAgICBmYWlsKCJUaGUgc3BlY2lmaWVkIGxp\nc3Qgb2Ygc2l6ZSAiICsgaW5wdXQuc2l6ZSgpCiAgICAgICAgICAgICAgICAg\nICAgKyAiIGRpZCBub3QgY29udGFpbiBhbnkgc3RyaW5ncyB0aGF0IG1hdGNo\nIHRoZSIKICAgICAgICAgICAgICAgICAgICArICIgc3BlY2lmaWVkIHJlZ3Vs\nYXIgZXhwcmVzc2lvbihcIiIgKyByZWdleCArICJcIikiKTsKICAgICAgICB9\nIGNhdGNoIChSRVN5bnRheEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZS50b1N0cmluZygp\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhh\ndCB0aGUgc3BlY2lmaWVkIGNvbGxlY3Rpb24gb2YgU3RyaW5ncyBkb2VzIG5v\ndCBtYXRjaAogICAgICogdGhlIHNwZWNpZmllZCByZWd1bGFyIGV4cHJlc3Np\nb24uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBhc3NlcnROb3RN\nYXRjaGVzKFN0cmluZyByZWdleCwgQ29sbGVjdGlvbiBpbnB1dCkgewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIExpc3QgbWF0Y2hlczsKCiAgICAgICAg\nICAgIGlmICgoKG1hdGNoZXMgPSBtYXRjaGVzKHJlZ2V4LCBpbnB1dCkpKS5z\naXplKCkgPiAwKQogICAgICAgICAgICAgICAgZmFpbCgiVGhlIHNwZWNpZmll\nZCBsaXN0IG9mIHNpemUgIiArIGlucHV0LnNpemUoKQogICAgICAgICAgICAg\nICAgICAgICsgIiBkaWQgY29udGFpbiBvbmUgb3IgbW9yZSBzdHJpbmdzIHRo\nYXQgbWF0Y2hzIHRoZSIKICAgICAgICAgICAgICAgICAgICArICIgc3BlY2lm\naWVkIGlsbGVnYWwgcmVndWxhciBleHByZXNzaW9uIgogICAgICAgICAgICAg\nICAgICAgICsgIiAoXCIiICsgcmVnZXggKyAiXCIpLiIKICAgICAgICAgICAg\nICAgICAgICArICIgRmlyc3QgZXhhbXBsZSBvZiBhIG1hdGNoaW5nIG1lc3Nh\nZ2UgaXM6ICIKICAgICAgICAgICAgICAgICAgICArIG1hdGNoZXMuaXRlcmF0\nb3IoKS5uZXh0KCkpOwogICAgICAgIH0gY2F0Y2ggKFJFU3ludGF4RXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbihlLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRvIGJlIGNhbGxlZCBieSB0aGUgY2hpbGQuIEUuZy46\nCiAgICAgKiA8Y29kZT4gcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5n\nIFtdIGFyZ3MpIHsgbWFpbihUZXN0QnVnMzc1LmNsYXNzKTsKICAgICAqIH0K\nICAgICAqIDwvY29kZT4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lk\nIG1haW4oQ2xhc3MgYykgewogICAgICAgIFRlc3RSdW5uZXIucnVuKGMpOwog\nICAgfQoKICAgIC8qKgogICAgICogVG8gYmUgY2FsbGVkIGJ5IGNoaWxkLiBG\naWd1cmVzIG91dCB0aGUgY2xhc3MgZnJvbSB0aGUgY2FsbGluZyBjb250ZXh0\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbigpIHsKICAg\nICAgICBTdHJpbmcgY2FsbGVyID0gbmV3IFNlY3VyaXR5TWFuYWdlcigpIHsK\nICAgICAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRDbGFzc0NvbnRleHQoKVsyXS5nZXROYW1l\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LnRvU3RyaW5nKCk7CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIG1haW4oQ2xhc3MuZm9yTmFtZShjYWxs\nZXIpKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9u\nIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRp\nb24oY25mZS50b1N0cmluZygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRoZSBqYXIgZmlsZSBpbiB3aGljaCB0aGUgY2xh\nc3MgaXMgY29udGFpbmVkLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGph\nciBmaWxlLCBvciBub25lIGlmIHRoZSBjbGFzcyBpcyBub3QgaW4gYSBqYXIK\nICAgICAqIEB0aHJvd3MgRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGlmIHRoZSBq\nYXIgZmlsZSBjYW5ub3QgbG9jYXRlZAogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIEZpbGUgZ2V0SmFyRmlsZShDbGFzcyBjbGF6eikgdGhyb3dzIEZpbGVO\nb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgVVJMIHVybCA9IGNsYXp6Lmdl\ndFJlc291cmNlKGNsYXp6LmdldE5hbWUoKS5zdWJzdHJpbmcoCiAgICAgICAg\nICAgIGNsYXp6LmdldE5hbWUoKS5sYXN0SW5kZXhPZigiLiIpICsgMSkgKyAi\nLmNsYXNzIik7CiAgICAgICAgaWYgKHVybCA9PSBudWxsKQogICAgICAgICAg\nICB0aHJvdyBuZXcgRmlsZU5vdEZvdW5kRXhjZXB0aW9uKGNsYXp6LnRvU3Ry\naW5nKCkpOwoKICAgICAgICBTdHJpbmcgZmlsZSA9IHVybC5nZXRGaWxlKCk7\nCiAgICAgICAgaWYgKGZpbGUgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IEZpbGVOb3RGb3VuZEV4Y2VwdGlvbih1cmwudG9TdHJpbmcoKSk7CiAg\nICAgICAgaW50IGluZGV4ID0gZmlsZS5pbmRleE9mKCIhIik7CiAgICAgICAg\naWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICB0aHJvdyBuZXcgRmlsZU5v\ndEZvdW5kRXhjZXB0aW9uKGZpbGUpOwoKICAgICAgICBmaWxlID0gZmlsZS5z\ndWJzdHJpbmcoMCwgaW5kZXgpOwogICAgICAgIGZpbGUgPSBmaWxlLnN1YnN0\ncmluZygiZmlsZToiLmxlbmd0aCgpKTsKCiAgICAgICAgRmlsZSBmID0gbmV3\nIEZpbGUoZmlsZSk7CiAgICAgICAgaWYgKCEoZi5pc0ZpbGUoKSkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBGaWxlTm90Rm91bmRFeGNlcHRpb24oZmlsZSk7\nCgogICAgICAgIHJldHVybiBmLmdldEFic29sdXRlRmlsZSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgZWFj\naCB0ZXN0IGNhc2Ugd2lsbCBoYXZlIGZvciBhIHRpbWVvdXQuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFRpbWVvdXQobG9uZyB0aW1lb3V0KSB7CiAg\nICAgICAgX3RpbWVvdXQgPSB0aW1lb3V0OwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgZWFjaCB0ZXN0IGNhc2Ug\nd2lsbCBoYXZlIGZvciBhIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1YmxpYyBs\nb25nIGdldFRpbWVvdXQoKSB7CiAgICAgICAgcmV0dXJuIF90aW1lb3V0Owog\nICAgfQoKICAgIC8qKgogICAgICogQSB3YXRjaGRvZyB0aGF0IGp1c3QgZXhp\ndHMgdGhlIEpWTSBpZiBhIHRlc3QgaGFzIG5vdCBjb21wbGV0ZWQgaW4KICAg\nICAqIGEgY2VydGFpbiBhbW91bnQgb2YgdGltZS4gVGhpcyBzcGVlZHMgdXAg\ndGhlIG1lY2hhbmlzbSBvZiBkZXRlcm1pbmluZwogICAgICogaWYgYSB0aW1l\nb3V0IGhhcyBvY2N1cnJlZCwgc2luY2Ugd2UgY2FuIGV4aXQgdGhlIGVudGly\nZSB0ZXN0IHJ1bgogICAgICogaWYgYSB0ZXN0IGhhc24ndCBjb21wbGV0ZWQg\naW4gYSBzaG9ydGVkIGFtb3VudCBvZiB0aW1lIHRoYW4KICAgICAqIHRoZSBn\nbG9iYWwgdGVzdCB0aW1lb3V0LgogICAgICoKICAgICAqIEBhdXRob3IgTWFy\nYyBQcnVkJ2hvbW1lYXV4CiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIFdhdGNoZG9nVGhyZWFkIGV4dGVuZHMgVGhyZWFkIHsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBsb25nIF90aW1lb3V0bXM7CiAgICAgICAgcHJpdmF0\nZSBsb25nIF9lbmR0aW1lID0gLTE7CiAgICAgICAgcHJpdmF0ZSBBYnN0cmFj\ndFRlc3RDYXNlIF9jdXJ0ZXN0ID0gbnVsbDsKCiAgICAgICAgcHVibGljIFdh\ndGNoZG9nVGhyZWFkKCkgewogICAgICAgICAgICBzdXBlcigiS29kbyB0ZXN0\nIGNhc2Ugd2F0Y2hkb2cgdGhyZWFkIik7CiAgICAgICAgICAgIHNldERhZW1v\nbih0cnVlKTsKCiAgICAgICAgICAgIGludCB0aW1lb3V0TWluID0gbmV3IElu\ndGVnZXIKICAgICAgICAgICAgICAgIChTeXN0ZW0uZ2V0UHJvcGVydHkoImF1\ndG9idWlsZC50ZXN0Y2FzZS50aW1lb3V0IiwgIjIwIikpCiAgICAgICAgICAg\nICAgICAuaW50VmFsdWUoKTsKCiAgICAgICAgICAgIF90aW1lb3V0bXMgPSB0\naW1lb3V0TWluICogNjAgKiAxMDAwOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbGVl\ncCgyMDApOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICBpZiAoX2VuZHRpbWUgPiAwICYmIFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpID4gX2VuZHRpbWUpIHsKICAgICAgICAgICAgICAgICAgICBUaHJl\nYWQgcHJlVGltZW91dCA9IG5ldyBUaHJlYWQKICAgICAgICAgICAgICAgICAg\nICAgICAgKCJBdHRlbXB0aW5nIHByZS10aW1lb3V0IGZvciAiICsgX2N1cnRl\nc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVu\nKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2N1cnRlc3QucHJl\nVGltZW91dCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBwcmVUaW1lb3V0\nLnN0YXJ0KCk7CgogICAgICAgICAgICAgICAgICAgIC8vIHdhaXQgYSBsaXR0\nbGUgd2hpbGUgZm9yIHRoZSBwcmUtdGltZW91dAogICAgICAgICAgICAgICAg\nICAgIC8vIHRocmVhZCB0byBjb21wbGV0ZQogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZVRpbWVvdXQuam9p\nbigxMCAqIDEwMDApOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICAvLyBnaXZlIGl0IGEgZmV3IG1vcmUgc2Vjb25kcy4uLgog\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNsZWVwKDUgKiAxMDAwKTsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAgICAgLy8gbmV3IGVuZHRpbWU/IHJlc3VtZS4uLgog\nICAgICAgICAgICAgICAgICAgIGlmIChTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKSA8IF9lbmR0aW1lKQogICAgICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKCiAgICAgICAgICAgICAgICAgICAgbmV3IEV4Y2VwdGlvbigidGVz\ndCBjYXNlICIKICAgICAgICAgICAgICAgICAgICAgICAgKyAoX2N1cnRlc3Qg\nIT0gbnVsbCA/IF9jdXJ0ZXN0LmdldE5hbWUoKQogICAgICAgICAgICAgICAg\nICAgICAgICA6ICJVTktOT1dOIikgKyAiIHRpbWVkIG91dCBhZnRlciAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICsgX3RpbWVvdXRtcyArICJtcyIpLnBy\naW50U3RhY2tUcmFjZSgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBhbHNv\nIHJ1biAia2lsbGFsbCAtUVVJVCBqYXZhIiB0byB0cnkgdG8gZ3JhYgogICAg\nICAgICAgICAgICAgICAgIC8vIGEgc3RhY2sgdHJhY2UKICAgICAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBSdW50aW1l\nLmdldFJ1bnRpbWUoKS5leGVjCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAobmV3IFN0cmluZ1tdeyAia2lsbGFsbCIsICItUVVJVCIsICJqYXZhIiB9\nKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2xlZXAoMTAwMCk7CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgIC8vIG5vdyBhY3R1YWxseSBleGl0CiAgICAgICAgICAgICAgICAg\nICAgU3lzdGVtLmV4aXQoMTExKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN5bmNocm9uaXpl\nZCB2b2lkIGVudGVyaW5nVGVzdChBYnN0cmFjdFRlc3RDYXNlIHRlc3QpIHsK\nICAgICAgICAgICAgbG9uZyB0aW1lb3V0ID0gdGVzdC5nZXRUaW1lb3V0KCk7\nCiAgICAgICAgICAgIGlmICh0aW1lb3V0IDw9IDApCiAgICAgICAgICAgICAg\nICB0aW1lb3V0ID0gX3RpbWVvdXRtczsKCiAgICAgICAgICAgIF9lbmR0aW1l\nID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgKyB0aW1lb3V0OwogICAg\nICAgICAgICBfY3VydGVzdCA9IHRlc3Q7CgogICAgICAgICAgICBpZiAoIWlz\nQWxpdmUoKSkKICAgICAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgbGVhdmluZ1Rlc3Qo\nQWJzdHJhY3RUZXN0Q2FzZSB0ZXN0KSB7CiAgICAgICAgICAgIF9lbmR0aW1l\nID0gLTE7CiAgICAgICAgICAgIF9jdXJ0ZXN0ID0gbnVsbDsKICAgICAgICB9\nCiAgICB9Cn0K\n","encoding":"base64"}

