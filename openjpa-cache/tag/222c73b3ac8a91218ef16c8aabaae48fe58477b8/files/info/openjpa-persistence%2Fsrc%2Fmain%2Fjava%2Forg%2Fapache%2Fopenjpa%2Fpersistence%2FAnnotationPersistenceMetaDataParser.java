{"sha":"e7e832e17cfa662bf77b01f8f4ea1c2ac9c5e84c","node_id":"MDQ6QmxvYjIwNjM2NDplN2U4MzJlMTdjZmE2NjJiZjc3YjAxZjhmNGVhMWMyYWM5YzVlODRj","size":62999,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e7e832e17cfa662bf77b01f8f4ea1c2ac9c5e84c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBq\nYXZhLm5ldC5VUklTeW50YXhFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5V\nUkw7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJl\nZVNldDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkJhc2ljOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRl\nZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVuZXJzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVy\nczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZldGNoVHlwZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwppbXBvcnQgc3RhdGljIGphdmF4\nLnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFVVE87CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLklk\nQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTWFwS2V5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwcGVkU3VwZXJj\nbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJpZXM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJ5OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PcmRl\nckJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdExvYWQ7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UGVyc2lzdDsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlBvc3RSZW1vdmU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5Qb3N0VXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJl\nUGVyc2lzdDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVJlbW92ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVVwZGF0ZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVmVyc2lvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkJlYW5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lk1ldGhvZExpZmVjeWNs\nZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdjVIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rv\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1v\nZGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFS\nZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuT3Jk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuTWV0YURhdGFEZWZhdWx0czsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuKjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2Vy\ncC51dGlsLlN0cmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlv\nbiBtZXRhZGF0YSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQog\nKiBkZXBsb3ltZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJz\nZXIKICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFw\nPENsYXNzLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNo\nTWFwPENsYXNzLCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAg\nICAgIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJFRERFRF9JRCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5jbGFzcywgRU5U\nSVRZX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVEZWZh\ndWx0TGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJT\nKTsKICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5l\ncnMuY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNU\nRU5FUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVUeXBlLmNsYXNz\nLCBGTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2VuZXJhdGVkVmFs\ndWUuY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAgX3RhZ3MucHV0\nKElkLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElkQ2xhc3MuY2xh\nc3MsIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5LmNsYXNz\nLCBNQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVy\naWVzLmNsYXNzLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0\nKE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAg\nICAgX3RhZ3MucHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAg\nICAgICAgX3RhZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAg\nICAgICBfdGFncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAg\nICAgIF90YWdzLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAg\nICAgICBfdGFncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lT\nVCk7CiAgICAgICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1Rf\nUkVNT1ZFKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywg\nUE9TVF9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNs\nYXNzLCBQUkVfUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92\nZS5jbGFzcywgUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVw\nZGF0ZS5jbGFzcywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNl\ncXVlbmNlR2VuZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAg\nICBfdGFncy5wdXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAg\nX3RhZ3MucHV0KERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAg\nICAgX3RhZ3MucHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQp\nOwogICAgICAgIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVO\nVCk7CiAgICAgICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERF\nVEFDSEVEX1NUQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVu\nZGVudC5jbGFzcywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50VHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFn\ncy5wdXQoRXh0ZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwog\nICAgICAgIF90YWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFM\nSVpFUik7CiAgICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RP\nUlkpOwogICAgICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRD\nSF9HUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNz\nLCBGRVRDSF9HUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9n\naWNhbC5jbGFzcywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5RGVwZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAg\nICBfdGFncy5wdXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAg\nIF90YWdzLnB1dChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9H\nUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAg\nICAgICBfdGFncy5wdXQoUmVhZE9ubHkuY2xhc3MsIFJFQURfT05MWSk7CiAg\nICAgICAgX3RhZ3MucHV0KFR5cGUuY2xhc3MsIFRZUEUpOwogICAgfQoKICAg\nIHByaXZhdGUgZmluYWwgT3BlbkpQQUNvbmZpZ3VyYXRpb24gX2NvbmY7CiAg\nICBwcml2YXRlIGZpbmFsIExvZyBfbG9nOwogICAgcHJpdmF0ZSBNZXRhRGF0\nYVJlcG9zaXRvcnkgX3JlcG9zID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NM\nb2FkZXIgX2VudkxvYWRlciA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX292ZXJyaWRlID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1P\nREVfTk9ORTsKCiAgICAvLyBwYWNrYWdlcyBhbmQgdGhlaXIgcGFyc2UgbW9k\nZXMKICAgIHByaXZhdGUgZmluYWwgTWFwPFBhY2thZ2UsIEludGVnZXI+IF9w\na2dzID0gbmV3IEhhc2hNYXA8UGFja2FnZSwgSW50ZWdlcj4oKTsKCiAgICAv\nLyB0aGUgY2xhc3Mgd2Ugd2VyZSBpbnZva2VkIHRvIHBhcnNlCiAgICBwcml2\nYXRlIENsYXNzIF9jbHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWxlIF9maWxl\nID0gbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIEFubm90YXRpb25Q\nZXJzaXN0ZW5jZU1ldGFEYXRhUGFyc2VyKE9wZW5KUEFDb25maWd1cmF0aW9u\nIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2xvZyA9\nIGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19NRVRBREFU\nQSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25maWd1cmF0aW9uIHN1cHBs\naWVkIG9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgcHVibGljIE9wZW5K\nUEFDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAg\ncmV0dXJuIF9jb25mOwogICAgfQoKICAgIC8qKgogICAgICogTWV0YWRhdGEg\nbG9nLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygpIHsKICAgICAg\nICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndGhlIHJlcG9zaXRvcnkgZm9yIHRoaXMgcGFyc2VyLiBJZiBub25lIGhhcyBi\nZWVuIHNldCwKICAgICAqIGNyZWF0ZSBhIG5ldyByZXBvc2l0b3J5IGFuZCBz\nZXRzIGl0LgogICAgICovCiAgICBwdWJsaWMgTWV0YURhdGFSZXBvc2l0b3J5\nIGdldFJlcG9zaXRvcnkoKSB7CiAgICAgICAgaWYgKF9yZXBvcyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9j\nb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAg\nICAgIE1ldGFEYXRhRmFjdG9yeSBtZGYgPSByZXBvcy5nZXRNZXRhRGF0YUZh\nY3RvcnkoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIERlbGVn\nYXRpbmdNZXRhRGF0YUZhY3RvcnkpCiAgICAgICAgICAgICAgICBtZGYgPSAo\nKERlbGVnYXRpbmdNZXRhRGF0YUZhY3RvcnkpIG1kZikuZ2V0SW5uZXJtb3N0\nRGVsZWdhdGUoKTsKICAgICAgICAgICAgaWYgKG1kZiBpbnN0YW5jZW9mIFBl\ncnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5KQogICAgICAgICAgICAgICAgKChQ\nZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeSkgbWRmKS5zZXRBbm5vdGF0aW9u\nUGFyc2VyKHRoaXMpOwogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIF9yZXBvczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgbWV0YWRhdGEgcmVwb3NpdG9yeSBmb3IgdGhpcyBw\nYXJzZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcG9zaXRvcnko\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgX3JlcG9zID0g\ncmVwb3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGVudmly\nb25tZW50YWwgY2xhc3MgbG9hZGVyIHRvIHBhc3Mgb24gdG8gcGFyc2VkCiAg\nICAgKiBtZXRhZGF0YSBpbnN0YW5jZXMuCiAgICAgKi8KICAgIHB1YmxpYyBD\nbGFzc0xvYWRlciBnZXRFbnZDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1\ncm4gX2VudkxvYWRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFzcyBvbiB0byBwYXJz\nZWQKICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RW52Q2xhc3NMb2FkZXIoQ2xhc3NMb2FkZXIgbG9hZGVy\nKSB7CiAgICAgICAgX2VudkxvYWRlciA9IGxvYWRlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1h\ncHBpbmcgaW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIg\naW5mb3JtYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBm\nYWxzZS4gVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEg\nY2xhc3MsIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAg\nICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5n\ncyBhcmUgc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNYXBwaW5nT3ZlcnJpZGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9vdmVycmlkZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdG8gYWxsb3cgbGF0ZXIgcGFyc2VzIG9mIG1hcHBpbmcg\naW5mb3JtYXRpb24gdG8gb3ZlcnJpZGUKICAgICAqIGVhcmxpZXIgaW5mb3Jt\nYXRpb24gZm9yIHRoZSBzYW1lIGNsYXNzLiBEZWZhdWx0cyB0byBmYWxzZS4g\nVXNlZnVsCiAgICAgKiB3aGVuIGEgdG9vbCBpcyBtYXBwaW5nIGEgY2xhc3Ms\nIHNvIHRoYXQgYW5ub3RhdGlvbiBwYXJ0aWFsIG1hcHBpbmcKICAgICAqIGlu\nZm9ybWF0aW9uIGNhbiBiZSB1c2VkIGV2ZW4gd2hlbiBtYXBwaW5ncyBhcmUg\nc3RvcmVkIGluIGFub3RoZXIKICAgICAqIGxvY2F0aW9uLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRNYXBwaW5nT3ZlcnJpZGUoYm9vbGVhbiBvdmVy\ncmlkZSkgewogICAgICAgIF9vdmVycmlkZSA9IG92ZXJyaWRlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgZ2V0TW9kZSgpIHsKICAgICAgICByZXR1cm4gX21vZGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9kZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0TW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikg\newogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAg\nX21vZGUgPSBNT0RFX05PTkU7CiAgICAgICAgZWxzZSBpZiAob24pCiAgICAg\nICAgICAgIF9tb2RlIHw9IG1vZGU7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfbW9kZSAmPSB+bW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBw\nYXJzZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGlu\ndCBtb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcg\ne0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaXNNZXRhRGF0YU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9kZSAm\nIE1PREVfTUVUQSkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\nbmllbmNlIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9k\nZX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzUXVlcnlNb2Rl\nKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX1FVRVJZKSAhPSAw\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZv\nciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgpIHsKICAgICAgICBy\nZXR1cm4gKF9tb2RlICYgTU9ERV9NQVBQSU5HKSAhPSAwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHdlJ3JlIGluIG1hcHBpbmcg\nbW9kZSBvciBpbiBtZXRhZGF0YSBtb2RlIHdpdGgKICAgICAqIG1hcHBpbmcg\nb3ZlcmlkZSBlbmFibGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBpc01hcHBpbmdPdmVycmlkZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIGlz\nTWFwcGluZ01vZGUoKSB8fCAoX292ZXJyaWRlICYmIGlzTWV0YURhdGFNb2Rl\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVzLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBfY2xzID0g\nbnVsbDsKICAgICAgICBfZmlsZSA9IG51bGw7CiAgICAgICAgX3BrZ3MuY2xl\nYXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIHBlcnNpc3RlbmNl\nIG1ldGFkYXRhIGZvciB0aGUgZ2l2ZW4gY2xhc3MuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHBhcnNlKENsYXNzIGNscykgewogICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoInBhcnNlLWNsYXNzIiwgY2xzLmdldE5hbWUoKSkpOwoKICAgICAg\nICBfY2xzID0gY2xzOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcnNl\nUGFja2FnZUFubm90YXRpb25zKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURh\ndGEgbWV0YSA9IHBhcnNlQ2xhc3NBbm5vdGF0aW9ucygpOwogICAgICAgICAg\nICB1cGRhdGVTb3VyY2VNb2RlKG1ldGEpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgICAgICBfZmlsZSA9\nIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRl\nIHRoZSBzb3VyY2UgbW9kZSB0byB0aGUgY2xhc3MgcGFja2FnZSBhbmQgY2xh\nc3MgdG8gaW5kaWNhdGUgdGhhdAogICAgICogd2UndmUgZnVsbHkgcGFyc2Vk\nIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVTb3VyY2VN\nb2RlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfY2xzLmdl\ndFBhY2thZ2UoKSAhPSBudWxsKQogICAgICAgICAgICBhZGRTb3VyY2VNb2Rl\nKF9jbHMuZ2V0UGFja2FnZSgpLCBfbW9kZSk7CiAgICAgICAgaWYgKG1ldGEg\nIT0gbnVsbCkKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKF9tb2Rl\nLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGluZm9ybWF0\naW9uIGluIHBhY2thZ2UtbGV2ZWwgY2xhc3MgYW5ub3RhdGlvbnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBhY2thZ2VBbm5vdGF0aW9ucygp\nIHsKICAgICAgICBQYWNrYWdlIHBrZyA9IF9jbHMuZ2V0UGFja2FnZSgpOwog\nICAgICAgIGlmIChwa2cgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpbnQgcGtnTW9kZSA9IGdldFNvdXJjZU1vZGUocGtnKTsKICAg\nICAgICBpZiAocGtnTW9kZSA9PSAwICYmIF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtcGFj\na2FnZSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgaWYgKChwa2dNb2Rl\nICYgX21vZGUpID09IF9tb2RlKSAvLyBhbHJlYWR5IHZpc2l0ZWQKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAg\nICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBwa2cuZ2V0RGVjbGFyZWRBbm5v\ndGF0aW9ucygpKSB7CiAgICAgICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5v\nLmFubm90YXRpb25UeXBlKCkpOwogICAgICAgICAgICBpZiAodGFnID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGhhbmRsZVVua25vd25QYWNrYWdlQW5u\nb3RhdGlvbihwa2csIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYgTU9E\nRV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VO\nYW1lZE5hdGl2ZVF1ZXJpZXMocGtnLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKChOYW1lZE5hdGl2ZVF1ZXJpZXMpIGFubm8pLnZhbHVlKCkpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBOQVRJVkVfUVVFUlk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVl\ncnlNb2RlKCkgJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhw\na2csIChOYW1lZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAg\nICAgICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9k\nZSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlTmFtZWRRdWVyaWVzKHBrZywgKChOYW1lZFF1ZXJpZXMpIGFubm8p\nLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAgICBpZiAo\naXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfUVVFUlkpID09IDAp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFtZWRRdWVyaWVzKHBr\nZywgKE5hbWVkUXVlcnkpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSAm\nJgogICAgICAgICAgICAgICAgICAgICAgICAocGtnTW9kZSAmIE1PREVfTUFQ\nUElORykgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1\nZW5jZUdlbmVyYXRvcihwa2csIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBwa2csCiAg\nICAgICAgICAgICAgICAgICAgICAgIGFubm8udG9TdHJpbmcoKSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhbHdheXMgcGFyc2Ug\nbWFwcGluZyBzdHVmZiBhZnRlciBtZXRhZGF0YSBzdHVmZiwgaW4gY2FzZSB0\naGVyZSBhcmUKICAgICAgICAvLyBkZXBlbmRlbmNpZXMgb24gbWV0YWRhdGEK\nICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgKHBrZ01v\nZGUgJiBNT0RFX01BUFBJTkcpID09IDApCiAgICAgICAgICAgIHBhcnNlUGFj\na2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhwa2cpOwogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2UgcGFja2FnZSBtYXBwaW5nIGFubm90YXRpb25zLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBwYXJzZVBhY2thZ2VNYXBwaW5nQW5u\nb3RhdGlvbnMoUGFja2FnZSBwa2cpIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlv\nbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25v\nd25QYWNrYWdlQW5ub3RhdGlvbihQYWNrYWdlIHBrZywKICAgICAgICBBbm5v\ndGF0aW9uIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc291cmNlIG1vZGUgZm9yIHRoZSBnaXZlbiBw\nYWNrYWdlLgogICAgICovCiAgICBwcml2YXRlIGludCBnZXRTb3VyY2VNb2Rl\nKFBhY2thZ2UgcGtnKSB7CiAgICAgICAgTnVtYmVyIG51bSA9IF9wa2dzLmdl\ndChwa2cpOwogICAgICAgIHJldHVybiAobnVtID09IG51bGwpID8gMCA6IG51\nbS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRvIHRo\nZSBzb3VyY2UgbW9kZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRTb3VyY2VNb2RlKFBhY2thZ2UgcGtnLCBp\nbnQgbW9kZSkgewogICAgICAgIEludGVnZXIgbnVtID0gX3BrZ3MuZ2V0KHBr\nZyk7CiAgICAgICAgaWYgKG51bSA9PSBudWxsKQogICAgICAgICAgICBudW0g\nPSBOdW1iZXJzLnZhbHVlT2YobW9kZSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBudW0gPSBOdW1iZXJzLnZhbHVlT2YobnVtLmludFZhbHVlKCkgfCBt\nb2RlKTsKICAgICAgICBfcGtncy5wdXQocGtnLCBudW0pOwogICAgfQoKICAg\nIC8qKgogICAgICogUmVhZCBhbm5vdGF0aW9ucyBmb3IgdGhlIGN1cnJlbnQg\ndHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzc01ldGFEYXRhIHBhcnNl\nQ2xhc3NBbm5vdGF0aW9ucygpIHsKICAgICAgICAvLyBjaGVjayBpbW1lZGlh\ndGVseSB3aGV0aGVyIHRoZSB1c2VyIGlzIHVzaW5nIGFueSBhbm5vdGF0aW9u\ncywKICAgICAgICAvLyByZWdhcmRsZXNzIG9mIG1vZGUuICB0aGlzIHByZXZl\nbnRzIGFkZGluZyBub24tZW50aXR5IGNsYXNzZXMgdG8KICAgICAgICAvLyBy\nZXBvc2l0b3J5IGlmIHdlJ3JlIGlnbm9yaW5nIHRoZXNlIGFubm90YXRpb25z\nIGluIG1hcHBpbmcgbW9kZQogICAgICAgIGlmICghKChCb29sZWFuKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxwZXIKICAg\nICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oX2NscywgRW50\naXR5LmNsYXNzKSkpLmJvb2xlYW5WYWx1ZSgpCiAgICAgICAgICAgICYmICEo\nKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Q\ncml2NUhlbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNl\nbnRBY3Rpb24oX2NscywgRW1iZWRkYWJsZS5jbGFzcykpKQogICAgICAgICAg\nICAgICAgLmJvb2xlYW5WYWx1ZSgpCiAgICAgICAgICAgICYmICEoKEJvb2xl\nYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2NUhl\nbHBlcgogICAgICAgICAgICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rp\nb24oX2NscywgTWFwcGVkU3VwZXJjbGFzcy5jbGFzcykpKQogICAgICAgICAg\nICAgICAgLmJvb2xlYW5WYWx1ZSgpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gZmluZCAvIGNyZWF0ZSBtZXRhZGF0YQogICAgICAg\nIENsYXNzTWV0YURhdGEgbWV0YSA9IGdldE1ldGFEYXRhKCk7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIEVudGl0eSBlbnRpdHkgPSAoRW50aXR5KSBfY2xzLmdldEFubm90\nYXRpb24oRW50aXR5LmNsYXNzKTsKICAgICAgICBNYXBwZWRTdXBlcmNsYXNz\nIG1hcHBlZCA9IChNYXBwZWRTdXBlcmNsYXNzKQogICAgICAgIAlfY2xzLmdl\ndEFubm90YXRpb24oTWFwcGVkU3VwZXJjbGFzcy5jbGFzcyk7CiAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpIHsKICAgICAgICAJbWV0YS5zZXRBYnN0\ncmFjdChtYXBwZWQgIT0gbnVsbCk7CiAgICAgICAgICAgIC8vIHdoaWxlIHRo\nZSBzcGVjIG9ubHkgcHJvdmlkZXMgZm9yIGVtYmVkZGVkIGV4Y2x1c2l2ZSwg\naXQgZG9lc24ndAogICAgICAgICAgICAvLyBzZWVtIGhhcmQgdG8gc3VwcG9y\ndCBvdGhlcndpc2UKICAgICAgICAgICAgaWYgKGVudGl0eSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgbWV0YS5zZXRFbWJlZGRlZE9ubHkodHJ1ZSk7CiAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbWV0YS5zZXRFbWJl\nZGRlZE9ubHkoZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdV\ndGlscy5pc0VtcHR5KGVudGl0eS5uYW1lKCkpKQogICAgICAgICAgICAgICAg\nICAgIG1ldGEuc2V0VHlwZUFsaWFzKGVudGl0eS5uYW1lKCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0cmFjayBmZXRjaCBncm91\ncHMgdG8gcGFyc2UgdGhlbSBhZnRlciBmaWVsZHMsIHNpbmNlIHRoZXkKICAg\nICAgICAvLyByZWx5IG9uIGZpZWxkIG1ldGFkYXRhCiAgICAgICAgRmV0Y2hH\ncm91cFtdIGZncyA9IG51bGw7CiAgICAgICAgRGV0YWNoZWRTdGF0ZSBkZXRh\nY2hlZCA9IG51bGw7CgogICAgICAgIC8vIHRyYWNrIGxpc3RlbmVycyBzaW5j\nZSB3ZSBuZWVkIHRvIG1lcmdlIHRoZW0gd2l0aCBlbnRpdHkgY2FsbGJhY2tz\nCiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gbGlz\ndGVuZXJzID0gbnVsbDsKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAgICAg\nICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBfY2xzLmdldERlY2xhcmVkQW5u\nb3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQoYW5u\nby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duQ2xhc3NBbm5v\ndGF0aW9uKG1ldGEsIGFubm8pOwogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIEVOVElUWV9MSVNURU5FUlM6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIGxpc3RlbmVycyA9IHBhcnNlRW50aXR5TGlzdGVuZXJz\nKG1ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoRW50aXR5TGlz\ndGVuZXJzKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRVhDTFVERV9ERUZBVUxUX0xJU1RFTkVSUzoK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRhRGF0\nYSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWdub3JlU3lz\ndGVtTGlzdGVuZXJzKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBFWENMVURFX1NVUEVSQ0xBU1NfTElT\nVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9k\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhLmdldExpZmVjeWNs\nZU1ldGFEYXRhKCkuc2V0SWdub3JlU3VwZXJjbGFzc0NhbGxiYWNrcwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKExpZmVjeWNsZU1ldGFEYXRhLklH\nTk9SRV9ISUdIKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgRkxVU0hfTU9ERToKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgd2FybkZsdXNoTW9kZShtZXRhKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSURfQ0xBU1M6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgIG1ldGEuc2V0T2JqZWN0SWRUeXBlKCgoSWRDbGFzcykg\nYW5ubykudmFsdWUoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhfY2xzLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKChOYW1lZE5hdGl2ZVF1ZXJp\nZXMpIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBOQVRJVkVfUVVFUlk6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKF9jbHMsIChOYW1l\nZE5hdGl2ZVF1ZXJ5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgUVVFUklFUzoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKChOYW1lZFF1ZXJpZXMp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNRdWVyeU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKE5hbWVkUXVlcnkpIGFubm8pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBTRVFfR0VORVJBVE9SOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01h\ncHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFyc2VTZXF1ZW5jZUdlbmVyYXRvcihfY2xzLCAoU2VxdWVuY2VHZW5lcmF0\nb3IpIGFubm8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBEQVRBX0NBQ0hFOgogICAgICAgICAgICAgICAgICAg\nIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAg\nICBwYXJzZURhdGFDYWNoZShtZXRhLCAoRGF0YUNhY2hlKSBhbm5vKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nREFUQVNUT1JFX0lEOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZURhdGFT\ndG9yZUlkKG1ldGEsIChEYXRhU3RvcmVJZCkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERFVEFDSEVE\nX1NUQVRFOgogICAgICAgICAgICAgICAgICAgIGRldGFjaGVkID0gKERldGFj\naGVkU3RhdGUpIGFubm87CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEZFVENIX0dST1VQOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBmZ3MgPSBuZXcgRmV0Y2hHcm91cFtdeyAoRmV0Y2hHcm91cCkg\nYW5ubyB9OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBGRVRDSF9HUk9VUFM6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZncyA9ICgoRmV0Y2hHcm91cHMpIGFubm8pLnZhbHVlKCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBfY2xzLAogICAgICAgICAg\nICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpIHsK\nICAgICAgICAgICAgcGFyc2VEZXRhY2hlZFN0YXRlKG1ldGEsIGRldGFjaGVk\nKTsKCiAgICAgICAgICAgIC8vIG1lcmdlIGNhbGxiYWNrIG1ldGhvZHMgd2l0\naCBkZWNsYXJlZCBsaXN0ZW5lcnMKICAgICAgICAgICAgaW50W10gaGlnaHMg\nPSBudWxsOwogICAgICAgICAgICBpZiAobGlzdGVuZXJzICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGhpZ2hzID0gbmV3IGludFtsaXN0ZW5lcnMubGVu\nZ3RoXTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlz\ndGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGlmIChs\naXN0ZW5lcnNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\naGlnaHNbaV0gPSBsaXN0ZW5lcnNbaV0uc2l6ZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJlY29yZENhbGxiYWNrcyhtZXRhLCBwYXJzZUNhbGxi\nYWNrTWV0aG9kcyhfY2xzLCBsaXN0ZW5lcnMsIGZhbHNlLAogICAgICAgICAg\nICAgICAgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIGhpZ2hzLCBmYWxzZSk7\nCgogICAgICAgICAgICAvLyBzY2FuIHBvc3NpYmx5IG5vbi1QQyBoaWVyYXJj\naHkgZm9yIGNhbGxiYWNrcy4KICAgICAgICAgICAgLy8gcmVkdW5kYW50IGZv\nciBQQyBzdXBlcmNsYXNzIGJ1dCB3ZSBkb24ndCBrbm93IHRoYXQgeWV0CiAg\nICAgICAgICAgIC8vIHNvIGxldCBMaWZlY3ljbGVNZXRhRGF0YSBkZXRlcm1p\nbmUgdGhhdAogICAgICAgICAgICBpZiAoIU9iamVjdC5jbGFzcy5lcXVhbHMo\nX2Nscy5nZXRTdXBlcmNsYXNzKCkpKSB7CiAgICAgICAgICAgICAgICByZWNv\ncmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhvZHMoX2Nscy5n\nZXRTdXBlcmNsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgdHJ1\nZSwgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIG51bGwsIHRydWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKEZpZWxkTWV0YURh\ndGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKQogICAgICAgICAg\nICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgcGFyc2VNZW1iZXJB\nbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIC8vIHBhcnNlIGZldGNoIGdyb3Vw\ncyBhZnRlciBmaWVsZHMKICAgICAgICBpZiAoZmdzICE9IG51bGwpCiAgICAg\nICAgICAgIHBhcnNlRmV0Y2hHcm91cHMobWV0YSwgZmdzKTsKCiAgICAgICAg\nLy8gYWx3YXlzIHBhcnNlIG1hcHBpbmcgYWZ0ZXIgbWV0YWRhdGEgaW4gY2Fz\nZSB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYgKGlzTWFwcGlu\nZ092ZXJyaWRlTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNlQ2xhc3NNYXBw\naW5nQW5ub3RhdGlvbnMobWV0YSk7CiAgICAgICAgICAgIGZvciAoRmllbGRN\nZXRhRGF0YSBmbWQgOiBtZXRhLmdldERlY2xhcmVkRmllbGRzKCkpCiAgICAg\nICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1l\ndGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgICAg\nIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRpb25zKGZtZCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgY2xhc3MgbWFwcGluZyBhbm5vdGF0aW9ucy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgcGFyc2VDbGFzc01hcHBpbmdBbm5vdGF0aW9ucyhD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgIH0KCiAgICAvKioKICAgICAqIEFs\nbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5ub3RhdGlvbnMu\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRsZVVua25vd25D\nbGFzc0Fubm90YXRpb24oQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIEFu\nbm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEZpbmQgb3IgY3JlYXRlIG1ldGFkYXRhIGZvciB0\naGUgZ2l2ZW4gdHlwZS4gTWF5IHJldHVybiBudWxsIGlmCiAgICAgKiB0aGlz\nIGNsYXNzIGhhcyBhbHJlYWR5IGJlZW4gcGFyc2VkIGZ1bGx5LgogICAgICov\nCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB7CiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdl\ndENhY2hlZE1ldGFEYXRhKF9jbHMpOwogICAgICAgIGlmIChtZXRhICE9IG51\nbGwgJiYKICAgICAgICAgICAgKChpc01ldGFEYXRhTW9kZSgpICYmIChtZXRh\nLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCkgfHwKICAgICAg\nICAgICAgICAgIChpc01hcHBpbmdNb2RlKCkgJiYKICAgICAgICAgICAgICAg\nICAgICAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01BUFBJTkcpICE9\nIDApKSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImR1cC1tZXRh\nZGF0YSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewog\nICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFkZE1ldGFEYXRh\nKF9jbHMpOwogICAgICAgICAgICBtZXRhLnNldEVudkNsYXNzTG9hZGVyKF9l\nbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9E\nRV9OT05FKTsKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNl\nRmlsZSgpLCBtZXRhLlNSQ19BTk5PVEFUSU9OUyk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJt\naW5lIHRoZSBzb3VyY2UgZmlsZSB3ZSdyZSBwYXJzaW5nLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAgIGlm\nIChfZmlsZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2ZpbGU7Cgog\nICAgICAgIENsYXNzIGNscyA9IF9jbHM7CiAgICAgICAgd2hpbGUgKGNscy5n\nZXRFbmNsb3NpbmdDbGFzcygpICE9IG51bGwpCiAgICAgICAgICAgIGNscyA9\nIGNscy5nZXRFbmNsb3NpbmdDbGFzcygpOwoKICAgICAgICBTdHJpbmcgcnNy\nYyA9IFN0cmluZ1V0aWxzLnJlcGxhY2UoY2xzLmdldE5hbWUoKSwgIi4iLCAi\nLyIpOwogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IChDbGFzc0xvYWRl\ncikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAg\nIEoyRG9Qcml2NUhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlvbihjbHMpKTsg\nCiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAgICAgICBsb2Fk\nZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXY1SGVscGVyLmdldFN5c3Rl\nbUNsYXNzTG9hZGVyQWN0aW9uKCkpOyAKICAgICAgICBpZiAobG9hZGVyID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIFVSTCB1\ncmwgPSAoVVJMKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAg\nICAgICAgICAgSjJEb1ByaXY1SGVscGVyLmdldFJlc291cmNlQWN0aW9uKGxv\nYWRlciwgcnNyYyArICIuamF2YSIpKTsgCiAgICAgICAgaWYgKHVybCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIHVybCA9IChVUkwpIEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXY1SGVs\ncGVyLmdldFJlc291cmNlQWN0aW9uKGxvYWRlciwgcnNyYyArICIuY2xhc3Mi\nKSk7IAogICAgICAgICAgICBpZiAodXJsID09IG51bGwpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgX2ZpbGUgPSBuZXcgRmlsZSh1cmwudG9VUkkoKSk7CiAgICAg\nICAgfSBjYXRjaCAoVVJJU3ludGF4RXhjZXB0aW9uIGUpIHsKICAgICAgICB9\nIGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWFlKSB7CiAgICAg\nICAgICAgIC8vIHRoaXMgaXMgdGhyb3duIHdoZW4gdGhlIFVSSSBpcyBub24t\naGllcmFyY2hpY2FsIChha2EgSkJvc3MpCiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfZmlsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBEYXRh\nU3RvcmVJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGF0YVN0\nb3JlSWQoQ2xhc3NNZXRhRGF0YSBtZXRhLCBEYXRhU3RvcmVJZCBpZCkgewog\nICAgICAgIG1ldGEuc2V0SWRlbnRpdHlUeXBlKENsYXNzTWV0YURhdGEuSURf\nREFUQVNUT1JFKTsKCiAgICAgICAgaW50IHN0cmF0ID0gZ2V0R2VuZXJhdGVk\nVmFsdWVTdHJhdGVneShtZXRhLCBpZC5zdHJhdGVneSgpLAogICAgICAgICAg\nICBpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgaWYgKHN0cmF0ICE9IC0xKQog\nICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3koc3RyYXQpOwog\nICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKGlkLnN0cmF0ZWd5\nKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAg\nICAgICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAgICAgICAgICAgIC8vIHRl\nY2huaWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFyYXRlIHN5c3RlbSB0YWJs\nZSBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBnZW5lcmF0\nb3JzLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCByZWx5IG9uCiAgICAgICAg\nICAgICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcuYXBhY2hlLm9wZW5qcGEu\nU2VxdWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAgICAgICAgICAgICAgICAg\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGlkLmdlbmVyYXRvcigpKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVNlcXVlbmNl\nTmFtZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcXVlbmNlTWV0\nYURhdGEuTkFNRV9TWVNURU0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVNlcXVl\nbmNlTmFtZShpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFVVE86CiAgICAgICAgICAg\nICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0ZWd5KFZhbHVlU3RyYXRl\nZ2llcy5OQVRJVkUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBJREVOVElUWToKICAgICAgICAgICAgICAgICAg\nICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVzLkFV\nVE9BU1NJR04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oaWQuc3RyYXRlZ3koKS50b1N0cmlu\nZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFdhcm4gdGhhdCBARmx1c2hNb2RlIGlzIG5vdCBzdXBwb3J0ZWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3YXJuRmx1c2hNb2RlKE9iamVj\ndCBjb250ZXh0KSB7CiAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgp\nKQogICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoInVuc3VwcG9ydGVk\nIiwgIkZsdXNoTW9kZSIsIGNvbnRleHQpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFBhcnNlIEBEYXRhQ2FjaGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBwYXJzZURhdGFDYWNoZShDbGFzc01ldGFEYXRhIG1ldGEsIERhdGFDYWNo\nZSBjYWNoZSkgewogICAgICAgIGlmIChjYWNoZS50aW1lb3V0KCkgIT0gSW50\nZWdlci5NSU5fVkFMVUUpCiAgICAgICAgICAgIG1ldGEuc2V0RGF0YUNhY2hl\nVGltZW91dChjYWNoZS50aW1lb3V0KCkpOwogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShjYWNoZS5uYW1lKCkpKQogICAgICAgICAgICBtZXRh\nLnNldERhdGFDYWNoZU5hbWUoY2FjaGUubmFtZSgpKTsKICAgICAgICBlbHNl\nIGlmIChjYWNoZS5lbmFibGVkKCkpCiAgICAgICAgICAgIG1ldGEuc2V0RGF0\nYUNhY2hlTmFtZSgKICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUub3Blbmpw\nYS5kYXRhY2FjaGUuRGF0YUNhY2hlLk5BTUVfREVGQVVMVCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUobnVsbCk7\nCiAgICAgICAgCiAgICAgICAgbWV0YS5zZXRJc0NhY2hlYWJsZShjYWNoZS5l\nbmFibGVkKCksIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nQERldGFjaGVkU3RhdGUuIFRoZSBhbm5vdGF0aW9uIG1heSBiZSBudWxsLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VEZXRhY2hlZFN0YXRlKENs\nYXNzTWV0YURhdGEgbWV0YSwKICAgICAgICBEZXRhY2hlZFN0YXRlIGRldGFj\naGVkKSB7CiAgICAgICAgaWYgKGRldGFjaGVkICE9IG51bGwpIHsKICAgICAg\nICAgICAgaWYgKCFkZXRhY2hlZC5lbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBtZXRhLnNldERldGFjaGVkU3RhdGUobnVsbCk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZGV0YWNoZWQuZmllbGROYW1l\nKCkpKQogICAgICAgICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKENs\nYXNzTWV0YURhdGEuU1lOVEhFVElDKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKGRldGFjaGVkLmZp\nZWxkTmFtZSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBGaWVs\nZFtdIGZpZWxkcyA9IChGaWVsZFtdKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJp\ndmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXRE\nZWNsYXJlZEZpZWxkc0FjdGlvbigKICAgICAgICAgICAgICAgICAgICBtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSkpOyAKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAg\nICBpZiAoKChCb29sZWFuKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdjVIZWxwZXIKICAgICAgICAgICAgICAgICAgICAuaXNBbm5v\ndGF0aW9uUHJlc2VudEFjdGlvbihmaWVsZHNbaV0sIERldGFjaGVkU3RhdGUu\nY2xhc3MpKSkKICAgICAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkp\nCiAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKGZp\nZWxkc1tpXS5nZXROYW1lKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIEBFbnRpdHlMaXN0ZW5lcnMKICAgICAqLwogICAgcHJp\ndmF0ZSBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBwYXJzZUVu\ndGl0eUxpc3RlbmVycwogICAgICAgIChDbGFzc01ldGFEYXRhIG1ldGEsIEVu\ndGl0eUxpc3RlbmVycyBsaXN0ZW5lcnMpIHsKICAgICAgICBDbGFzc1tdIGNs\nYXNzZXMgPSBsaXN0ZW5lcnMudmFsdWUoKTsKICAgICAgICBDb2xsZWN0aW9u\nPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBwYXJzZWQgPSBudWxsOwogICAgICAg\nIGZvciAoQ2xhc3MgY2xzIDogY2xhc3NlcykKICAgICAgICAgICAgcGFyc2Vk\nID0gcGFyc2VDYWxsYmFja01ldGhvZHMoY2xzLCBwYXJzZWQsIHRydWUsIHRy\ndWUsIAogICAgICAgICAgICAgICAgZ2V0UmVwb3NpdG9yeSgpKTsKICAgICAg\nICByZXR1cm4gcGFyc2VkOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2Ug\nY2FsbGJhY2sgbWV0aG9kcyBpbnRvIHRoZSBnaXZlbiBhcnJheSwgYW5kIHJl\ndHVybiB0aGF0IGFycmF5LAogICAgICogY3JlYXRpbmcgb25lIGlmIG51bGwu\nIEVhY2ggaW5kZXggaW50byB0aGUgYXJyYXkgaXMgYSBjb2xsZWN0aW9uIG9m\nCiAgICAgKiBjYWxsYmFjayBhZGFwdGVycyBmb3IgdGhhdCBudW1lcmljIGV2\nZW50IHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIHN1cHMgd2hldGhlciB0\nbyBzY2FuIHN1cGVyY2xhc3NlcwogICAgICogQHBhcmFtIGxpc3RlbmVyIHdo\nZXRoZXIgdGhpcyBpcyBhIGxpc3RlbmVyIG9yIG5vdAogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIENvbGxlY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltd\nIHBhcnNlQ2FsbGJhY2tNZXRob2RzCiAgICAgICAgKENsYXNzIGNscywgQ29s\nbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gY2FsbGJhY2tzLCBib29s\nZWFuIHN1cHMsCiAgICAgICAgYm9vbGVhbiBsaXN0ZW5lciwgTWV0YURhdGFS\nZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgLy8gZmlyc3Qgc29ydCAvIGZp\nbHRlciBiYXNlZCBvbiBpbmhlcml0YW5jZQogICAgICAgIFNldDxNZXRob2Q+\nIG1ldGhvZHMgPSBuZXcgVHJlZVNldDxNZXRob2Q+KE1ldGhvZENvbXBhcmF0\nb3IuCiAgICAgICAgICAgIGdldEluc3RhbmNlKCkpOwoKICAgICAgICBpbnQg\nbW9kczsKICAgICAgICBDbGFzcyBzdXAgPSBjbHM7CiAgICAgICAgTWV0aG9k\nS2V5IGtleTsKICAgICAgICBTZXQ8TWV0aG9kS2V5PiBzZWVuID0gbmV3IEhh\nc2hTZXQ8TWV0aG9kS2V5PigpOwogICAgICAgIGRvIHsKICAgICAgICAgICAg\nZm9yIChNZXRob2QgbSA6IChNZXRob2RbXSkgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdjVIZWxwZXIu\nZ2V0RGVjbGFyZWRNZXRob2RzQWN0aW9uKHN1cCkpKSB7CiAgICAgICAgICAg\nICAgICBtb2RzID0gbS5nZXRNb2RpZmllcnMoKTsKICAgICAgICAgICAgICAg\nIGlmIChNb2RpZmllci5pc1N0YXRpYyhtb2RzKSB8fCBNb2RpZmllci5pc0Zp\nbmFsKG1vZHMpIHx8CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNz\nLmVxdWFscyhtLmdldERlY2xhcmluZ0NsYXNzKCkpKQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGtleSA9IG5ldyBN\nZXRob2RLZXkobSk7CiAgICAgICAgICAgICAgICBpZiAoIXNlZW4uY29udGFp\nbnMoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIG1ldGhvZHMuYWRkKG0p\nOwogICAgICAgICAgICAgICAgICAgIHNlZW4uYWRkKGtleSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3VwID0gc3Vw\nLmdldFN1cGVyY2xhc3MoKTsKICAgICAgICB9IHdoaWxlIChzdXBzICYmICFP\nYmplY3QuY2xhc3MuZXF1YWxzKHN1cCkpOwoKICAgICAgICBNZXRhRGF0YURl\nZmF1bHRzIGRlZiA9IHJlcG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpLmdldERl\nZmF1bHRzKCk7CiAgICAgICAgZm9yIChNZXRob2QgbSA6IG1ldGhvZHMpIHsK\nICAgICAgICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiAoQW5ub3RhdGlv\nbltdKSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAgICAgICAgICAuZG9Qcml2\naWxlZ2VkKEoyRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAgICAgICAgIC5n\nZXREZWNsYXJlZEFubm90YXRpb25zQWN0aW9uKG0pKSkgewogICAgICAgICAg\nICAgICAgTWV0YURhdGFUYWcgdGFnID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3Rh\ndGlvblR5cGUoKSk7CiAgICAgICAgICAgICAgICBpZiAodGFnID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAg\nICBpbnRbXSBldmVudHMgPSBNZXRhRGF0YVBhcnNlcnMuZ2V0RXZlbnRUeXBl\ncyh0YWcpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50cyA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAg\nIGlmIChjYWxsYmFja3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBj\nYWxsYmFja3MgPSAoQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10p\nCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDb2xsZWN0aW9uW0xpZmVj\neWNsZUV2ZW50LkFMTF9FVkVOVFMubGVuZ3RoXTsKCiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICAgICAgICAgIGludCBlID0gZXZlbnRzW2ldOwogICAgICAg\nICAgICAgICAgICAgIGlmIChjYWxsYmFja3NbZV0gPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdID0gbmV3IEFycmF5TGlz\ndCgzKTsKICAgICAgICAgICAgICAgICAgICBNZXRhRGF0YVBhcnNlcnMudmFs\naWRhdGVNZXRob2RzRm9yU2FtZUNhbGxiYWNrKGNscywgCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNhbGxiYWNrc1tlXSwgbSwgdGFnLCBkZWYsIHJlcG9z\nLmdldExvZygpKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLmFkZChu\nZXcgQmVhbkxpZmVjeWNsZUNhbGxiYWNrcyhjbHMsIG0sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmYWxzZSkpOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tl\nXS5hZGQobmV3IE1ldGhvZExpZmVjeWNsZUNhbGxiYWNrcyhtLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZmFsc2UpKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrczsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBTdG9yZSBsaWZlY3ljbGUgbWV0YWRhdGEuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZWNvcmRDYWxsYmFja3MoQ2xhc3NNZXRhRGF0\nYSBjbHMsCiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+\nW10gY2FsbGJhY2tzLCBpbnRbXSBoaWdocywKICAgICAgICBib29sZWFuIHN1\ncGVyQ2xhc3MpIHsKICAgICAgICBpZiAoY2FsbGJhY2tzID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICBMaWZlY3ljbGVNZXRhRGF0YSBt\nZXRhID0gY2xzLmdldExpZmVjeWNsZU1ldGFEYXRhKCk7CiAgICAgICAgTGlm\nZWN5Y2xlQ2FsbGJhY2tzW10gYXJyYXk7CiAgICAgICAgZm9yIChpbnQgZXZl\nbnQgOiBMaWZlY3ljbGVFdmVudC5BTExfRVZFTlRTKSB7CiAgICAgICAgICAg\nIGlmIChjYWxsYmFja3NbZXZlbnRdID09IG51bGwpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgYXJyYXkgPSBjYWxsYmFja3NbZXZl\nbnRdLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgTGlmZWN5Y2xlQ2Fs\nbGJhY2tzW2NhbGxiYWNrc1tldmVudF0uc2l6ZSgpXSk7CgogICAgICAgICAg\nICBpZiAoc3VwZXJDbGFzcykgewogICAgICAgICAgICAgICAgbWV0YS5zZXRO\nb25QQ1N1cGVyY2xhc3NDYWxsYmFja3MoZXZlbnQsIGFycmF5LAogICAgICAg\nICAgICAgICAgICAgIChoaWdocyA9PSBudWxsKSA/IDAgOiBoaWdoc1tldmVu\ndF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWV0\nYS5zZXREZWNsYXJlZENhbGxiYWNrcyhldmVudCwgYXJyYXksCiAgICAgICAg\nICAgICAgICAgICAgKGhpZ2hzID09IG51bGwpID8gMCA6IGhpZ2hzW2V2ZW50\nXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgZmV0Y2ggZ3JvdXBzLgogICAgICogSWYgRmV0Y2hHcm91\ncCBBIGluY2x1ZGVzIEZldGNoR3JvdXAgQiwgdGhlbiBhIGJpLWxpbmsgaXMg\nc2V0IGJldHdlZW4KICAgICAqIEEgYW5kIEIuIEJvdGggQSBhbmQgQiBtdXN0\nIGJlIGRlY2xhcmVkIGluIHRoZSBzYW1lIENsYXNzLiAKICAgICAqIDxicj4K\nICAgICAqIENhbGwge0BsaW5rICNwYXJzZUZldGNoQXR0cmlidXRlKENsYXNz\nTWV0YURhdGEsIAogICAgICogb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0\nY2hHcm91cCwgRmV0Y2hBdHRyaWJ1dGUpIG9ubHkgYWZ0ZXIgdGhlCiAgICAg\nKiBiaS1saW5rcyBoYXZlIGJlZW4gZXN0YWJsaXNoZWQsIGJlY2F1c2UgYSBm\naWVsZCBmIHdpbGwgbm90IG9ubHkgYWRkIHRoZQogICAgICogZmV0Y2ggZ3Jv\ndXAgQSB3aGljaCBleHBsaWN0bHkgaW5jbHVkZXMgZiB0byBpdHMgY3VzdG9t\nIGZldGNoIGdyb3VwcyBidXQgCiAgICAgKiBhbHNvIHdpbGwgYWxzbyBhZGQg\nYW55IGZldGNoIGdyb3VwIEIgdGhhdCBpbmNsdWRlcyBBLiAgCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBwYXJzZUZldGNoR3JvdXBzKENsYXNzTWV0YURh\ndGEgbWV0YSwgRmV0Y2hHcm91cC4uLiBncm91cHMpIHsKICAgICAgICBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwIGZnOwogICAgICAgIGZv\nciAoRmV0Y2hHcm91cCBncm91cCA6IGdyb3VwcykgewogICAgICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShncm91cC5uYW1lKCkpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ1bm5hbWVkLWZnIiwgbWV0YSkpOwoKICAgICAgICAgICAgZmcgPSBtZXRh\nLmFkZERlY2xhcmVkRmV0Y2hHcm91cChncm91cC5uYW1lKCkpOwogICAgICAg\nICAgICBpZiAoZ3JvdXAucG9zdExvYWQoKSkKICAgICAgICAgICAgICAgIGZn\nLnNldFBvc3RMb2FkKHRydWUpOyAKICAgICAgICAgICAgZm9yIChTdHJpbmcg\ncyA6IGdyb3VwLmZldGNoR3JvdXBzKCkpIHsKICAgICAgICAgICAgICAgIGZn\nLmFkZERlY2xhcmVkSW5jbHVkZShzKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICAvLyBBZGQgdGhlIHBhcmVudC1jaGlsZCBzdHlsZSBiaS1s\naW5rcyBiZXR3ZWVuIGZldGNoIGdyb3VwcyBpbiBhIAogICAgICAgIC8vIHNl\ncGFyYXRlIHBhc3MuIAogICAgICAgIGZvciAoRmV0Y2hHcm91cCBncm91cDpn\ncm91cHMpIHsKICAgICAgICAJZmcgPSBtZXRhLmdldEZldGNoR3JvdXAoZ3Jv\ndXAubmFtZSgpKTsKICAgICAgICAJU3RyaW5nW10gaW5jbHVkZWRGZXRjaEdy\nb3BOYW1lcyA9IGZnLmdldERlY2xhcmVkSW5jbHVkZXMoKTsKICAgICAgICAJ\nZm9yIChTdHJpbmcgaW5jbHVkZWRGZWN0Y2hHcm91cE5hbWU6aW5jbHVkZWRG\nZXRjaEdyb3BOYW1lcykgewogICAgICAgIAkJb3JnLmFwYWNoZS5vcGVuanBh\nLm1ldGEuRmV0Y2hHcm91cCBjaGlsZCA9CiAgICAgICAgCSAgICBtZXRhLmdl\ndEZldGNoR3JvdXAoaW5jbHVkZWRGZWN0Y2hHcm91cE5hbWUpOwogICAgICAg\nIAkJaWYgKGNoaWxkID09IG51bGwpIAogICAgICAgIAkJCXRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtaXNzaW5nLWluY2x1ZGVkLWZnIiwg\nCiAgICAgICAgCQkJCW1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSwgZmcuZ2V0TmFtZSgpLAogICAgICAgIAkJCQlpbmNsdWRlZEZlY3RjaEdy\nb3VwTmFtZSkpOwogICAgICAgIAkJY2hpbGQuYWRkQ29udGFpbmVkQnkoZmcp\nOwogICAgICAgIAl9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciAo\nRmV0Y2hHcm91cCBncm91cCA6IGdyb3VwcykgewogICAgICAgICAgICBmZyA9\nIG1ldGEuZ2V0RmV0Y2hHcm91cChncm91cC5uYW1lKCkpOwogICAgICAgICAg\nICBmb3IgKEZldGNoQXR0cmlidXRlIGF0dHIgOiBncm91cC5hdHRyaWJ1dGVz\nKCkpCiAgICAgICAgICAgICAgICBwYXJzZUZldGNoQXR0cmlidXRlKG1ldGEs\nIGZnLCBhdHRyKTsKICAgICAgICB9CiAgICB9CiAgICAKCiAgICAvKioKICAg\nICAqIFNldCBhIGZpZWxkJ3MgZmV0Y2ggZ3JvdXAuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZUZldGNoQXR0cmlidXRlKENsYXNzTWV0YURhdGEg\nbWV0YSwgCiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hH\ncm91cCBmZywgRmV0Y2hBdHRyaWJ1dGUgYXR0cikgewogICAgICAgIEZpZWxk\nTWV0YURhdGEgZmllbGQgPSBtZXRhLmdldERlY2xhcmVkRmllbGQoYXR0ci5u\nYW1lKCkpOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxsCiAgICAgICAgICAg\nIHx8IGZpZWxkLmdldE1hbmFnZW1lbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1mZy1maWVsZCIsIGZnLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgIG1ldGEsIGF0dHIubmFtZSgpKSk7Cgog\nICAgICAgIGZpZWxkLnNldEluRmV0Y2hHcm91cChmZy5nZXROYW1lKCksIHRy\ndWUpOwogICAgICAgIFNldCBwYXJlbnRGZXRjaEdyb3VwcyA9IGZnLmdldENv\nbnRhaW5lZEJ5KCk7CiAgICAgICAgZm9yIChPYmplY3QgcGFyZW50RmV0Y2hH\ncm91cDpwYXJlbnRGZXRjaEdyb3VwcykKICAgICAgICAJZmllbGQuc2V0SW5G\nZXRjaEdyb3VwKHBhcmVudEZldGNoR3JvdXAudG9TdHJpbmcoKSwgdHJ1ZSk7\nCiAgICAgICAgaWYgKGF0dHIucmVjdXJzaW9uRGVwdGgoKSAhPSBJbnRlZ2Vy\nLk1JTl9WQUxVRSkKICAgICAgICAgICAgZmcuc2V0UmVjdXJzaW9uRGVwdGgo\nZmllbGQsIGF0dHIucmVjdXJzaW9uRGVwdGgoKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWFkIGFubm90YXRpb25zIGZvciB0aGUgZ2l2ZW4gbWVtYmVy\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcGFyc2VNZW1iZXJBbm5vdGF0\naW9ucyhGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIC8vIGxvb2sgZm9y\nIHBlcnNpc3RlbmNlIHN0cmF0ZWd5IGluIGFubm90YXRpb24gdGFibGUKICAg\nICAgICBNZW1iZXIgbWVtYmVyID0gZ2V0UmVwb3NpdG9yeSgpLmdldE1ldGFE\nYXRhRmFjdG9yeSgpLmdldERlZmF1bHRzKCkuCiAgICAgICAgICAgIGdldEJh\nY2tpbmdNZW1iZXIoZm1kKTsKICAgICAgICBQZXJzaXN0ZW5jZVN0cmF0ZWd5\nIHBzdHJhdCA9IFBlcnNpc3RlbmNlTWV0YURhdGFEZWZhdWx0cy4KICAgICAg\nICAgICAgZ2V0UGVyc2lzdGVuY2VTdHJhdGVneShmbWQsIG1lbWJlcik7CiAg\nICAgICAgaWYgKHBzdHJhdCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgZm1kLnNldEV4cGxpY2l0KHRydWUpOwoKICAgICAgICBBbm5v\ndGF0ZWRFbGVtZW50IGVsID0gKEFubm90YXRlZEVsZW1lbnQpIG1lbWJlcjsK\nICAgICAgICBib29sZWFuIGxvYiA9ICgoQm9vbGVhbikgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAg\nIC5pc0Fubm90YXRpb25QcmVzZW50QWN0aW9uKGVsLCBMb2IuY2xhc3MpKSku\nYm9vbGVhblZhbHVlKCk7CiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkp\nIHsKICAgICAgICAgICAgc3dpdGNoIChwc3RyYXQpIHsKICAgICAgICAgICAg\nICAgIGNhc2UgQkFTSUM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VCYXNp\nYyhmbWQsIChCYXNpYykgZWwuZ2V0QW5ub3RhdGlvbihCYXNpYy5jbGFzcyks\nIGxvYik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAgICAgICAgIHBhcnNl\nTWFueVRvT25lKGZtZCwgKE1hbnlUb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgog\nICAgICAgICAgICAgICAgICAgICAgICAoTWFueVRvT25lLmNsYXNzKSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIE9ORV9PTkU6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VPbmVUb09uZShm\nbWQsIChPbmVUb09uZSkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAg\nICAgICAgICAgICAoT25lVG9PbmUuY2xhc3MpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRU1CRURERUQ6CiAg\nICAgICAgICAgICAgICAgICAgcGFyc2VFbWJlZGRlZChmbWQsIChFbWJlZGRl\nZCkgZWwuZ2V0QW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAo\nRW1iZWRkZWQuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgT05FX01BTlk6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VPbmVUb01hbnkoZm1kLCAoT25lVG9NYW55KSBlbC5nZXRB\nbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChPbmVUb01hbnku\nY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgTUFOWV9NQU5ZOgogICAgICAgICAgICAgICAgICAgIHBh\ncnNlTWFueVRvTWFueShmbWQsIChNYW55VG9NYW55KSBlbC5nZXRBbm5vdGF0\naW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChNYW55VG9NYW55LmNsYXNz\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIFBFUlM6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0\nZW50KGZtZCwgKFBlcnNpc3RlbnQpIGVsLmdldEFubm90YXRpb24KICAgICAg\nICAgICAgICAgICAgICAgICAgKFBlcnNpc3RlbnQuY2xhc3MpKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEVS\nU19DT0xMOgogICAgICAgICAgICAgICAgICAgIHBhcnNlUGVyc2lzdGVudENv\nbGxlY3Rpb24oZm1kLCAoUGVyc2lzdGVudENvbGxlY3Rpb24pCiAgICAgICAg\nICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRpb24oUGVyc2lzdGVudENv\nbGxlY3Rpb24uY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgUEVSU19NQVA6CiAgICAgICAgICAgICAg\nICAgICAgcGFyc2VQZXJzaXN0ZW50TWFwKGZtZCwgKFBlcnNpc3RlbnRNYXAp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmdldEFubm90YXRpb24oUGVy\nc2lzdGVudE1hcC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBUUkFOU0lFTlQ6CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNNYXBw\naW5nT3ZlcnJpZGVNb2RlKCkgJiYgbG9iKQogICAgICAgICAgICBwYXJzZUxv\nYk1hcHBpbmcoZm1kKTsKCiAgICAgICAgLy8gZXh0ZW5zaW9ucwogICAgICAg\nIE1ldGFEYXRhVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRpb24gYW5u\nbyA6IGVsLmdldERlY2xhcmVkQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAg\nICB0YWcgPSBfdGFncy5nZXQoYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAg\nICAgICAgICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBo\nYW5kbGVVbmtub3duTWVtYmVyQW5ub3RhdGlvbihmbWQsIGFubm8pOwogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICBjYXNlIEZMVVNI\nX01PREU6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5GbHVzaE1vZGUoZm1k\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgR0VORVJBVEVEX1ZBTFVFOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGFyc2VHZW5lcmF0ZWRWYWx1ZShmbWQsIChHZW5lcmF0ZWRWYWx1\nZSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIElEOgogICAgICAgICAgICAgICAgY2FzZSBFTUJFRERF\nRF9JRDoKICAgICAgICAgICAgICAgICAgICBmbWQuc2V0UHJpbWFyeUtleSh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgTUFQX0tFWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlTWFwS2V5KGZtZCwgKE1hcEtleSkgYW5ubyk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9SREVSX0JZ\nOgogICAgICAgICAgICAgICAgICAgIHBhcnNlT3JkZXJCeShmbWQsCiAgICAg\nICAgICAgICAgICAgICAgICAgIChPcmRlckJ5KSBlbC5nZXRBbm5vdGF0aW9u\nKE9yZGVyQnkuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgU0VRX0dFTkVSQVRPUjoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoZWws\nIChTZXF1ZW5jZUdlbmVyYXRvcikgYW5ubyk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFZFUlNJT046CiAgICAg\nICAgICAgICAgICAgICAgZm1kLnNldFZlcnNpb24odHJ1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERFUEVO\nREVOVDoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUo\nKSAmJiAoKERlcGVuZGVudCkgYW5ubykudmFsdWUoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgZm1kLnNldENhc2NhZGVEZWxldGUoVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBFTEVNX0RFUEVOREVOVDoKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSAmJiAoKEVsZW1lbnRE\nZXBlbmRlbnQpIGFubm8pLnZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0Q2FzY2FkZURlbGV0ZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9B\nVVRPKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgRUxFTV9UWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChp\nc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLnNldFR5cGVPdmVycmlkZSh0b092ZXJyaWRlVHlwZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKCgoRWxlbWVudFR5cGUpIGFu\nbm8pLnZhbHVlKCkpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRVhURVJOQUxfVkFMUzoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgZm1kLnNldEV4dGVybmFsVmFsdWVzKFN0cmluZ3Muam9pbigo\nKEV4dGVybmFsVmFsdWVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nYW5ubykudmFsdWUoKSwgIiwiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVYVEVSTkFMSVpFUjoKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kLnNldEV4dGVybmFsaXplcigoKEV4dGVybmFs\naXplcikgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZBQ1RPUlk6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIGZtZC5zZXRGYWN0b3J5KCgoRmFjdG9yeSkgYW5ubykudmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIElOVkVSU0VfTE9HSUNBTDoKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLnNldEludmVyc2UoKChJbnZlcnNlTG9naWNhbCkgYW5ubykudmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEtFWV9ERVBFTkRFTlQ6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkgJiYgKChLZXlEZXBlbmRlbnQpIGFubm8p\nLnZhbHVlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRLZXko\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldENhc2NhZGVEZWxl\ndGUoVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBLRVlfVFlQRToK\nICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldFR5cGVPdmVy\ncmlkZSh0b092ZXJyaWRlVHlwZSgoKEtleVR5cGUpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhbm5vKS52YWx1ZSgpKSk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIExPQURfRkVUQ0hf\nR1JPVVA6CiAgICAgICAgICAgICAgICAJaWYgKGlzTWV0YURhdGFNb2RlKCkp\nCiAgICAgICAgICAgICAgICAJCWZtZC5zZXRMb2FkRmV0Y2hHcm91cCgoKExv\nYWRGZXRjaEdyb3VwKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAg\nIAlicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTFJTOgogICAgICAgICAg\nICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBmbWQuc2V0TFJTKCgoTFJTKSBhbm5vKS52YWx1ZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgUkVBRF9PTkxZOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFE\nYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZVJlYWRP\nbmx5KGZtZCwgKFJlYWRPbmx5KSBhbm5vKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRToKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlkZSh0b092ZXJyaWRlVHlw\nZSgoKFR5cGUpIGFubm8pLgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoInVuc3VwcG9ydGVk\nIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5n\nKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFBhcnNlIG1lbWJlciBtYXBwaW5nIGNvbXBvbmVudHMuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90\nYXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBbGxvdyBzdWJjbGFzc2VzIHRvIGhhbmRsZSB1bmtub3duIGFubm90\nYXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBoYW5kbGVV\nbmtub3duTWVtYmVyQW5ub3RhdGlvbihGaWVsZE1ldGFEYXRhIGZtZCwKICAg\nICAgICBBbm5vdGF0aW9uIGFubm8pIHsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBnaXZlbiBjbGFz\ncyB0byBpdHMgT3BlbkpQQSB0eXBlIG92ZXJyaWRlIGVxdWl2YWxlbnQuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNzIHRvT3ZlcnJpZGVUeXBl\nKENsYXNzIGNscykgewogICAgICAgIHJldHVybiAoY2xzID09IEVudGl0eS5j\nbGFzcykKICAgICAgICAgICAgPyBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5j\nZS5QZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MgOiBjbHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAUmVhZE9ubHkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBwYXJzZVJlYWRPbmx5KEZpZWxkTWV0YURhdGEgZm1kLCBSZWFk\nT25seSBybykgewogICAgICAgIGlmIChyby52YWx1ZSgpID09IFVwZGF0ZUFj\ndGlvbi5SRVNUUklDVCkKICAgICAgICAgICAgZm1kLnNldFVwZGF0ZVN0cmF0\nZWd5KFVwZGF0ZVN0cmF0ZWdpZXMuUkVTVFJJQ1QpOwogICAgICAgIGVsc2Ug\naWYgKHJvLnZhbHVlKCkgPT0gVXBkYXRlQWN0aW9uLklHTk9SRSkKICAgICAg\nICAgICAgZm1kLnNldFVwZGF0ZVN0cmF0ZWd5KFVwZGF0ZVN0cmF0ZWdpZXMu\nSUdOT1JFKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\ncyB2YWx1ZSBnZW5lcmF0aW9uIGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4g\nZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUdlbmVyYXRl\nZFZhbHVlKEZpZWxkTWV0YURhdGEgZm1kLCBHZW5lcmF0ZWRWYWx1ZSBnZW4p\nIHsKICAgICAgICBHZW5lcmF0aW9uVHlwZSBzdHJhdGVneSA9IGdlbi5zdHJh\ndGVneSgpOwogICAgICAgIFN0cmluZyBnZW5lcmF0b3IgPSBnZW4uZ2VuZXJh\ndG9yKCk7CiAgICAgICAgcGFyc2VHZW5lcmF0ZWRWYWx1ZShmbWQsIHN0cmF0\nZWd5LCBnZW5lcmF0b3IpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB2\nYWx1ZSBnZW5lcmF0aW9uIGluZm9ybWF0aW9uIGZvciB0aGUgZ2l2ZW4gZmll\nbGQuCiAgICAgKi8KICAgIHN0YXRpYyB2b2lkIHBhcnNlR2VuZXJhdGVkVmFs\ndWUoRmllbGRNZXRhRGF0YSBmbWQsIEdlbmVyYXRpb25UeXBlIHN0cmF0ZWd5\nLAogICAgICAgIFN0cmluZyBnZW5lcmF0b3IpIHsKICAgICAgICBpbnQgc3Ry\nYXQgPSBnZXRHZW5lcmF0ZWRWYWx1ZVN0cmF0ZWd5KGZtZCwgc3RyYXRlZ3ks\nIGdlbmVyYXRvcik7CiAgICAgICAgaWYgKHN0cmF0ICE9IC0xKQogICAgICAg\nICAgICBmbWQuc2V0VmFsdWVTdHJhdGVneShzdHJhdCk7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHsKICAgICAgICAg\nICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAgICAgICBjYXNlIFNFUVVF\nTkNFOgogICAgICAgICAgICAgICAgICAgIC8vIHRlY2huaWNhbGx5IHdlIHNo\nb3VsZCBoYXZlIHNlcGFyYXRlIHN5c3RlbSB0YWJsZSBhbmQKICAgICAgICAg\nICAgICAgICAgICAvLyBzZXF1ZW5jZSBnZW5lcmF0b3JzLCBidXQgaXQncyBl\nYXNpZXIgdG8ganVzdCByZWx5IG9uCiAgICAgICAgICAgICAgICAgICAgLy8g\ndGhlIHN5c3RlbSBvcmcuYXBhY2hlLm9wZW5qcGEuU2VxdWVuY2Ugc2V0dGlu\nZyBmb3IgYm90aAogICAgICAgICAgICAgICAgICAgIGlmIChTdHJpbmdVdGls\ncy5pc0VtcHR5KGdlbmVyYXRvcikpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRWYWx1ZVNlcXVlbmNlTmFtZShTZXF1ZW5jZU1ldGFEYXRhLk5B\nTUVfU1lTVEVNKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZtZC5zZXRWYWx1ZVNlcXVlbmNlTmFtZShnZW5l\ncmF0b3IpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBBVVRPOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRW\nYWx1ZVNlcXVlbmNlTmFtZShTZXF1ZW5jZU1ldGFEYXRhLk5BTUVfU1lTVEVN\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSURFTlRJVFk6CiAgICAgICAgICAgICAgICAgICAgZm1kLnNldFZh\nbHVlU3RyYXRlZ3koVmFsdWVTdHJhdGVnaWVzLkFVVE9BU1NJR04pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVs\ndDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oc3RyYXRlZ3kudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZh\nbHVlIHN0cmF0ZWd5IGZvciB0aGUgZ2l2ZW4gZ2VuZXJhdG9yLCBvciAtMSBp\nZiB0aGUKICAgICAqIHN0cmF0ZWd5IGRlcGVuZHMgb24gdGhlIDxjb2RlPkdl\nbmVyYXRpb25UeXBlPC9jb2RlPiByYXRoZXIgdGhhbiB0aGUKICAgICAqIGdl\nbmVyYXRvciBuYW1lLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBpbnQg\nZ2V0R2VuZXJhdGVkVmFsdWVTdHJhdGVneShPYmplY3QgY29udGV4dCwKICAg\nICAgICBHZW5lcmF0aW9uVHlwZSBzdHJhdGVneSwgU3RyaW5nIGdlbmVyYXRv\ncikgewogICAgICAgIGlmIChzdHJhdGVneSAhPSBBVVRPIHx8IFN0cmluZ1V0\naWxzLmlzRW1wdHkoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIC0x\nOwoKICAgICAgICBpZiAoR2VuZXJhdG9yLlVVSURfSEVYLmVxdWFscyhnZW5l\ncmF0b3IpKQogICAgICAgICAgICByZXR1cm4gVmFsdWVTdHJhdGVnaWVzLlVV\nSURfSEVYOwogICAgICAgIGlmIChHZW5lcmF0b3IuVVVJRF9TVFJJTkcuZXF1\nYWxzKGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBWYWx1ZVN0cmF0\nZWdpZXMuVVVJRF9TVFJJTkc7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJnZW5lcmF0b3ItYmFkLXN0cmF0ZWd5IiwK\nICAgICAgICAgICAgY29udGV4dCwgZ2VuZXJhdG9yKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAQmFzaWMuIEdpdmVuIGFubm90YXRpb24gbWF5\nIGJlIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUJhc2lj\nKEZpZWxkTWV0YURhdGEgZm1kLCBCYXNpYyBhbm5vLCBib29sZWFuIGxvYikg\newogICAgICAgIENsYXNzIHR5cGUgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7\nCiAgICAgICAgaWYgKGxvYiAmJiB0eXBlICE9IFN0cmluZy5jbGFzcwogICAg\nICAgICAgICAmJiB0eXBlICE9IGNoYXJbXS5jbGFzcyAmJiB0eXBlICE9IENo\nYXJhY3RlcltdLmNsYXNzCiAgICAgICAgICAgICYmIHR5cGUgIT0gYnl0ZVtd\nLmNsYXNzICYmIHR5cGUgIT0gQnl0ZVtdLmNsYXNzKQogICAgICAgICAgICBm\nbWQuc2V0U2VyaWFsaXplZCh0cnVlKTsKICAgICAgICBlbHNlIGlmICghbG9i\nKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgICAgIGlmIChFbnVtLmNsYXNzLmlzQXNzaWdu\nYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKFNlcmlh\nbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0U2VyaWFsaXplZCh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQsICJC\nYXNpYyIpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAg\nICAgIGlmICh0eXBlID09IGNoYXJbXS5jbGFzcyB8fCB0eXBlID09IENoYXJh\nY3RlcltdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHR5cGUg\nPT0gYnl0ZVtdLmNsYXNzIHx8IHR5cGUgPT0gQnl0ZVtdLmNsYXNzKQogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICBpZiAoU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20KICAg\nICAgICAgICAgICAgICAgICAgICAgKHR5cGUuZ2V0Q29tcG9uZW50VHlwZSgp\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldFNlcmlhbGl6ZWQo\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLCAiQmFzaWMiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChhbm5vID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBmbWQuc2V0SW5E\nZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVB\nR0VSKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAg\nICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBU\nSU9OKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBNYW55VG9PbmUu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1hbnlUb09uZShGaWVs\nZE1ldGFEYXRhIGZtZCwgTWFueVRvT25lIGFubm8pIHsKICAgICAgICBpZiAo\nIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQt\nbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIk1hbnlUb09uZSIp\nKTsKCiAgICAgICAgLy8gZG9uJ3Qgc3BlY2lmaWNhbGx5IGV4Y2x1ZGUgcmVs\nYXRpb24gZnJvbSBERkcgYi9jIHRoYXQgd2lsbCBwcmV2ZW50CiAgICAgICAg\nLy8gdXMgZnJvbSBldmVuIHJlYWRpbmcgdGhlIGZrIHdoZW4gcmVhZGluZyBm\ncm9tIHRoZSBwcmltYXJ5IHRhYmxlLAogICAgICAgIC8vIHdoaWNoIGlzIG5v\ndCB3aGF0IG1vc3QgdXNlcnMgd2lsbCB3YW50CiAgICAgICAgaWYgKGFubm8u\nZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpCiAgICAgICAgICAgIGZtZC5z\nZXRJbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwogICAgICAgIGlmICghYW5u\nby5vcHRpb25hbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZp\nZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pOwogICAgICAgIGlmIChhbm5v\nLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZt\nZC5zZXRUeXBlT3ZlcnJpZGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBAT25lVG9PbmUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZU9uZVRvT25lKEZpZWxkTWV0YURhdGEgZm1kLCBP\nbmVUb09uZSBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwK\nICAgICAgICAgICAgICAgICJPbmVUb09uZSIpKTsKCiAgICAgICAgLy8gZG9u\nJ3Qgc3BlY2lmaWNhbGx5IGV4Y2x1ZGUgcmVsYXRpb24gZnJvbSBERkcgYi9j\nIHRoYXQgd2lsbCBwcmV2ZW50CiAgICAgICAgLy8gdXMgZnJvbSBldmVuIHJl\nYWRpbmcgdGhlIGZrIHdoZW4gcmVhZGluZyBmcm9tIHRoZSBwcmltYXJ5IHRh\nYmxlLAogICAgICAgIC8vIHdoaWNoIGlzIG5vdCB3aGF0IG1vc3QgdXNlcnMg\nd2lsbCB3YW50CiAgICAgICAgaWYgKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5\ncGUuRUFHRVIpCiAgICAgICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdy\nb3VwKHRydWUpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQogICAg\nICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9F\nWENFUFRJT04pOwoKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2Rl\nKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkK\nICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7\nCiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFz\ncykKICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdl\ndEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2Fz\nY2FkZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBFbWJlZGRl\nZC4gR2l2ZW4gYW5ub3RhdGlvbiBtYXkgYmUgbnVsbC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRkZWQoRmllbGRNZXRhRGF0YSBmbWQs\nIEVtYmVkZGVkIGFubm8pIHsKICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXli\nZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1k\nLAogICAgICAgICAgICAgICAgIkVtYmVkZGVkIikpOwoKICAgICAgICBmbWQu\nc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAgICBmbWQuc2V0\nRW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgaWYgKGZtZC5nZXRFbWJlZGRlZE1l\ndGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgZm1kLmFkZEVtYmVkZGVk\nTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBPbmVU\nb01hbnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU9uZVRvTWFu\neShGaWVsZE1ldGFEYXRhIGZtZCwgT25lVG9NYW55IGFubm8pIHsKICAgICAg\nICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk1BUDoKICAgICAgICAgICAgICAgIGlmIChKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAg\nICAgICAgICAgICAgIk9uZVRvTWFueSIpKTsKICAgICAgICB9CgogICAgICAg\nIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBG\nZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlk\nZU1vZGUoKSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5\nKCkpKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRC\neSgpKTsKICAgICAgICBpZiAoYW5uby50YXJnZXRFbnRpdHkoKSAhPSB2b2lk\nLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldERlY2xh\ncmVkVHlwZShhbm5vLnRhcmdldEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNj\nYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmNhc2NhZGUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBATWFueVRvTWFueS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRvTWFueShGaWVsZE1ldGFEYXRh\nIGZtZCwgTWFueVRvTWFueSBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1l\nbnQoKSkpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJP\nbmVUb01hbnkiKSk7CiAgICAgICAgfQoKICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VS\nKTsKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAg\nICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAg\naWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5uby50\nYXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVs\nZW1lbnQoKSwgYW5uby5jYXNjYWRlKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQE1hcEtleS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlTWFwS2V5KEZpZWxkTWV0YURhdGEgZm1kLCBNYXBLZXkgYW5ubykgewog\nICAgICAgIFN0cmluZyBuYW1lID0gYW5uby5uYW1lKCk7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZtZC5n\nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KFZhbHVlTWV0YURhdGEuTUFQUEVE\nX0JZX1BLKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZtZC5nZXRLZXko\nKS5zZXRWYWx1ZU1hcHBlZEJ5KG5hbWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0dXAgdGhlIGZpZWxkIGFzIGEgTE9CIG1hcHBpbmcuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTG9iTWFwcGluZyhGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9yZGVy\nQnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU9yZGVyQnkoRmll\nbGRNZXRhRGF0YSBmbWQsIE9yZGVyQnkgYW5ubykgewogICAgICAgIFN0cmlu\nZyBkZWMgPSBhbm5vLnZhbHVlKCk7CiAgICAgICAgaWYgKGRlYy5sZW5ndGgo\nKSA9PSAwKQogICAgICAgICAgICBkZWMgPSBPcmRlci5FTEVNRU5UICsgIiBh\nc2MiOwogICAgICAgIGZtZC5zZXRPcmRlckRlY2xhcmF0aW9uKGRlYyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudChGaWVsZE1ldGFE\nYXRhIGZtZCwgUGVyc2lzdGVudCBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAgICAgICAg\nICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0ZVtdLmNsYXNz\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgp\nID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVu\ndCIpKTsKICAgICAgICB9CgogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQuc2V0TWFw\ncGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VS\nKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAg\nZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9O\nKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2FkZSgpKTsK\nICAgICAgICBpZiAoYW5uby5lbWJlZGRlZCgpKSB7CiAgICAgICAgICAgIGlm\nICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJQ\nZXJzaXN0ZW50KGVtYmVkZGVkPXRydWUpIikpOwogICAgICAgICAgICBmbWQu\nc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBmbWQu\nYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50Q29sbGVjdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudENvbGxlY3Rpb24o\nRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgUGVyc2lzdGVudENvbGxlY3Rp\nb24gYW5ubykgewogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpICE9IEphdmFUeXBlcy5BUlJBWQogICAgICAgICAgICAmJiBmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5DT0xMRUNUSU9OKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiUGVy\nc2lzdGVudENvbGxlY3Rpb24iKSk7CgogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQu\nc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0\nSW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBl\nLkVBR0VSKTsKICAgICAgICBpZiAoYW5uby5lbGVtZW50VHlwZSgpICE9IHZv\naWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVj\nbGFyZWRUeXBlKGFubm8uZWxlbWVudFR5cGUoKSk7CiAgICAgICAgc2V0Q2Fz\nY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5lbGVtZW50Q2FzY2FkZSgp\nKTsKICAgICAgICBpZiAoYW5uby5lbGVtZW50RW1iZWRkZWQoKSkgewogICAg\nICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRFbGVtZW50\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAg\nICAgICAgICAgICJQZXJzaXN0ZW50Q29sbGVjdGlvbihlbWJlZGRlZEVsZW1l\nbnQ9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0\nRW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVu\ndCgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFBlcnNp\nc3RlbnRNYXAuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNp\nc3RlbnRNYXAoRmllbGRNZXRhRGF0YSBmbWQsIFBlcnNpc3RlbnRNYXAgYW5u\nbykgewogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9\nIEphdmFUeXBlcy5NQVApCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAg\nICAgICAgICAgICAgICJQZXJzaXN0ZW50TWFwIikpOwoKICAgICAgICBmbWQu\nc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hU\neXBlLkVBR0VSKTsKICAgICAgICBpZiAoYW5uby5rZXlUeXBlKCkgIT0gdm9p\nZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldERlY2xhcmVk\nVHlwZShhbm5vLmtleVR5cGUoKSk7CiAgICAgICAgaWYgKGFubm8uZWxlbWVu\ndFR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxl\nbWVudCgpLnNldERlY2xhcmVkVHlwZShhbm5vLmVsZW1lbnRUeXBlKCkpOwog\nICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRLZXkoKSwgYW5uby5rZXlDYXNj\nYWRlKCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCks\nIGFubm8uZWxlbWVudENhc2NhZGUoKSk7CiAgICAgICAgaWYgKGFubm8ua2V5\nRW1iZWRkZWQoKSkgewogICAgICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXli\nZVBDKGZtZC5nZXRLZXkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBm\nbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRk\nZWRLZXk9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRF\nbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRLZXkoKS5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGZtZC5nZXRLZXkoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJlZGRlZCgpKSB7CiAgICAg\nICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQo\nKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAg\nICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRkZWRWYWx1ZT10cnVlKSIp\nKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRFbWJlZGRlZCh0\ncnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgY2FzY2FkZXMgb24gcmVsYXRp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRDYXNjYWRlcyhWYWx1\nZU1ldGFEYXRhIHZtZCwgQ2FzY2FkZVR5cGVbXSBjYXNjYWRlcykgewogICAg\nICAgIGZvciAoQ2FzY2FkZVR5cGUgY2FzY2FkZSA6IGNhc2NhZGVzKSB7CiAg\nICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBj\nYXNjYWRlID09IENhc2NhZGVUeXBlLlJFTU9WRSkKICAgICAgICAgICAgICAg\nIHZtZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9J\nTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRl\nVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5QRVJTSVNUKQog\nICAgICAgICAgICAgICAgdm1kLnNldENhc2NhZGVQZXJzaXN0KFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2Fz\nY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRl\nVHlwZS5NRVJHRSkKICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlQXR0\nYWNoKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAg\nICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2Fk\nZSA9PSBDYXNjYWRlVHlwZS5SRUZSRVNIKQogICAgICAgICAgICAgICAgdm1k\nLnNldENhc2NhZGVSZWZyZXNoKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1F\nRElBVEUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBTZXF1ZW5jZUdlbmVyYXRvci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoQW5ub3RhdGVkRWxlbWVudCBlbCwK\nICAgICAgICBTZXF1ZW5jZUdlbmVyYXRvciBnZW4pIHsKICAgICAgICBTdHJp\nbmcgbmFtZSA9IGdlbi5uYW1lKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCBlbCkpOwoKICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1zZXF1ZW5jZSIsIG5hbWUpKTsK\nCiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3NpdG9y\neSgpLmdldENhY2hlZFNlcXVlbmNlTWV0YURhdGEKICAgICAgICAgICAgKG5h\nbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAg\naWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkdXAtc2VxdWVuY2UiLCBuYW1lLCBlbCkpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgbmV3IHNlcXVlbmNlCiAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnko\nKS5hZGRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAgIFN0cmluZyBz\nZXEgPSBnZW4uc2VxdWVuY2VOYW1lKCk7CiAgICAgICAgaW50IGluaXRpYWwg\nPSBnZW4uaW5pdGlhbFZhbHVlKCk7CiAgICAgICAgaW50IGFsbG9jYXRlID0g\nZ2VuLmFsbG9jYXRpb25TaXplKCk7CiAgICAgICAgLy8gZG9uJ3QgYWxsb3cg\naW5pdGlhbCBvZiAwIGIvYyBsb29rcyBsaWtlIGRlZiB2YWx1ZQogICAgICAg\nIGlmIChpbml0aWFsID09IDApCiAgICAgICAgICAgIGluaXRpYWwgPSAxOwoK\nICAgICAgICAvLyBjcmVhdGUgcGx1Z2luIHN0cmluZyBmcm9tIGluZm8KICAg\nICAgICBTdHJpbmcgY2xzTmFtZSwgcHJvcHM7CiAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoc2VxKSkgewogICAgICAgICAgICBjbHNOYW1lID0g\nU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJv\ncHMgPSBudWxsOwogICAgICAgIH0gZWxzZSBpZiAoc2VxLmluZGV4T2YoJygn\nKSAhPSAtMSkgLy8gcGx1Z2luCiAgICAgICAgewogICAgICAgICAgICBjbHNO\nYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKHNlcSk7CiAgICAg\nICAgICAgIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhz\nZXEpOwogICAgICAgICAgICBzZXEgPSBudWxsOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGNsc05hbWUgPSBTZXF1ZW5jZU1ldGFEYXRhLklNUExf\nTkFUSVZFOwogICAgICAgICAgICBwcm9wcyA9IG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2luKENvbmZpZ3VyYXRpb25z\nLmdldFBsdWdpbihjbHNOYW1lLCBwcm9wcykpOwogICAgICAgIG1ldGEuc2V0\nU2VxdWVuY2Uoc2VxKTsKICAgICAgICBtZXRhLnNldEluaXRpYWxWYWx1ZShp\nbml0aWFsKTsKICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGFsbG9jYXRlKTsK\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgbWV0\nYS5TUkNfQU5OT1RBVElPTlMpOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQE5hbWVkUXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZU5hbWVkUXVlcmllcyhBbm5vdGF0ZWRFbGVtZW50IGVsLCBOYW1lZFF1ZXJ5\nLi4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7CiAg\nICAgICAgZm9yIChOYW1lZFF1ZXJ5IHF1ZXJ5IDogcXVlcmllcykgewogICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVyeS5uYW1lKCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1xdWVyeS1uYW1lIiwgZWwpKTsKICAgICAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLXF1ZXJ5LXN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgcXVl\ncnkubmFtZSgpLCBlbCkpOwoKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoInBhcnNlLXF1ZXJ5IiwgcXVlcnkubmFtZSgpKSk7CgogICAgICAgICAg\nICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFF1ZXJ5TWV0YURh\ndGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgaWYgKG1ldGEg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCkpOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1l\ndGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRhRGF0YShudWxsLCBx\ndWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNldFF1ZXJ5U3RyaW5n\nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRhLnNldExhbmd1YWdl\nKEpQUUxQYXJzZXIuTEFOR19KUFFMKTsKICAgICAgICAgICAgZm9yIChRdWVy\neUhpbnQgaGludCA6IHF1ZXJ5LmhpbnRzKCkpCiAgICAgICAgICAgICAgICBt\nZXRhLmFkZEhpbnQoaGludC5uYW1lKCksIGhpbnQudmFsdWUoKSk7CgogICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgICAg\nIG1ldGEuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1v\nZGUoTU9ERV9NRVRBKTsKICAgICAgICAgICAgZWxzZSBpZiAoaXNNYXBwaW5n\nTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1P\nREVfTUFQUElORyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX1FVRVJZKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATmFtZWROYXRpdmVRdWVyeS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTmFtZWROYXRpdmVRdWVy\naWVzKEFubm90YXRlZEVsZW1lbnQgZWwsCiAgICAgICAgTmFtZWROYXRpdmVR\ndWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRh\nOwogICAgICAgIGZvciAoTmFtZWROYXRpdmVRdWVyeSBxdWVyeSA6IHF1ZXJp\nZXMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVl\ncnkubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmF0aXZlLXF1ZXJ5LW5hbWUiLAog\nICAgICAgICAgICAgICAgICAgIGVsKSk7CiAgICAgICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1u\nYXRpdmUtcXVlcnktc3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICBxdWVy\neS5uYW1lKCksIGVsKSk7CgogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdl\ndCgicGFyc2UtbmF0aXZlLXF1ZXJ5IiwgcXVlcnkubmFtZSgpKSk7CgogICAg\nICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFF1ZXJ5\nTWV0YURhdGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgaWYg\nKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNX\nYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCkpOwogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRhRGF0YShu\ndWxsLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNldFF1ZXJ5\nU3RyaW5nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRhLnNldExh\nbmd1YWdlKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMKTsKICAgICAgICAgICAg\nQ2xhc3MgcmVzID0gcXVlcnkucmVzdWx0Q2xhc3MoKTsKICAgICAgICAgICAg\naWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRDb25maWd1cmF0aW9u\nKCksIHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldENhbmRpZGF0ZVR5\ncGUocmVzKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXZvaWQuY2xhc3MuZXF1\nYWxzKHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldFJlc3VsdFR5cGUo\ncmVzKTsKCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShx\ndWVyeS5yZXN1bHRTZXRNYXBwaW5nKCkpKQogICAgICAgICAgICAgICAgbWV0\nYS5zZXRSZXN1bHRTZXRNYXBwaW5nTmFtZShxdWVyeS5yZXN1bHRTZXRNYXBw\naW5nKCkpOwoKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNl\nRmlsZSgpLCAoZWwgaW5zdGFuY2VvZiBDbGFzcykgPyBlbCA6IG51bGwsCiAg\nICAgICAgICAgICAgICBtZXRhLlNSQ19BTk5PVEFUSU9OUyk7CiAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0\nU291cmNlTW9kZShNT0RFX01BUFBJTkcpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9RVUVSWSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1l\ndGhvZEtleSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWV0aG9kIF9tZXRo\nb2Q7CgogICAgICAgIHB1YmxpYyBNZXRob2RLZXkoTWV0aG9kIG0pIHsKICAg\nICAgICAgICAgX21ldGhvZCA9IG07CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQgY29kZSA9IDQ2\nICogMTIgKyBfbWV0aG9kLmdldE5hbWUoKS5oYXNoQ29kZSgpOwogICAgICAg\nICAgICBmb3IgKENsYXNzIHBhcmFtIDogX21ldGhvZC5nZXRQYXJhbWV0ZXJU\neXBlcygpKQogICAgICAgICAgICAgICAgY29kZSA9IDQ2ICogY29kZSArIHBh\ncmFtLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBjb2RlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\nKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNZXRob2RLZXkp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBN\nZXRob2Qgb3RoZXIgPSAoKE1ldGhvZEtleSkgbykuX21ldGhvZDsKICAgICAg\nICAgICAgaWYgKCFfbWV0aG9kLmdldE5hbWUoKS5lcXVhbHMob3RoZXIuZ2V0\nTmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgcmV0dXJuIEFycmF5cy5lcXVhbHMoX21ldGhvZC5nZXRQYXJhbWV0\nZXJUeXBlcygpLAogICAgICAgICAgICAgICAgb3RoZXIuZ2V0UGFyYW1ldGVy\nVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIE1ldGhvZENvbXBhcmF0b3IgaW1wbGVtZW50cyBDb21wYXJhdG9y\nIHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgTWV0aG9kQ29tcGFyYXRvciBJ\nTlNUQU5DRSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgTWV0aG9k\nQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsKICAgICAgICAgICAgaWYgKElO\nU1RBTkNFID09IG51bGwpCiAgICAgICAgICAgICAgICBJTlNUQU5DRSA9IG5l\ndyBNZXRob2RDb21wYXJhdG9yKCk7CiAgICAgICAgICAgIHJldHVybiBJTlNU\nQU5DRTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShP\nYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBNZXRob2QgbTEg\nPSAoTWV0aG9kKSBvMTsKICAgICAgICAgICAgTWV0aG9kIG0yID0gKE1ldGhv\nZCkgbzI7CgogICAgICAgICAgICBDbGFzcyBjMSA9IG0xLmdldERlY2xhcmlu\nZ0NsYXNzKCk7CiAgICAgICAgICAgIENsYXNzIGMyID0gbTIuZ2V0RGVjbGFy\naW5nQ2xhc3MoKTsKICAgICAgICAgICAgaWYgKCFjMS5lcXVhbHMoYzIpKSB7\nCiAgICAgICAgICAgICAgICBpZiAoYzEuaXNBc3NpZ25hYmxlRnJvbShjMikp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAg\nICAgZWxzZQoJCQkJCXJldHVybiAxOwoJCQl9CgkJCWludCBjb21wYXJlID0g\nbTEuZ2V0TmFtZSAoKS5jb21wYXJlVG8gKG0yLmdldE5hbWUgKCkpOwoJCQlp\nZiAoY29tcGFyZSA9PSAwKQoJCQkJcmV0dXJuIG0xLmhhc2hDb2RlICgpIC0g\nbTIuaGFzaENvZGUgKCk7CgkJCXJldHVybiBjb21wYXJlOwoJCX0KCX0KfQo=\n","encoding":"base64"}

