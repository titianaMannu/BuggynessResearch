{"sha":"fac8bfb92a46e8ba8edf1f18dc75499919f808bb","node_id":"MDQ6QmxvYjIwNjM2NDpmYWM4YmZiOTJhNDZlOGJhOGVkZjFmMThkYzc1NDk5OTE5ZjgwOGJi","size":21726,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fac8bfb92a46e8ba8edf1f18dc75499919f808bb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEu\naW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLkJ5dGVBcnJheU91dHB1\ndFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0T3V0cHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RJbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEu\naW8uQnl0ZUFycmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEu\nbGFuZy5yZWZsZWN0LkZpZWxkOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS50ZXN0LlNpbmdsZUVNRlRlc3RDYXNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNlLk9wZW5KUEFFbnRpdHlN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNpc3RlbmNl\nLkpQQUZhY2FkZUhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmV2ZW50LkFic3RyYWN0TGlmZWN5Y2xlTGlzdGVuZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7Cgpw\ndWJsaWMgYWJzdHJhY3QgY2xhc3MgQWJzdHJhY3RVbmVuaGFuY2VkQ2xhc3NU\nZXN0CiAgICBleHRlbmRzIFNpbmdsZUVNRlRlc3RDYXNlIHsKCiAgICAvLyAj\nIyMjIyBUbyBkbzoKICAgIC8vIC0gY2xlYXJpbmcgaW4gcG5ldyBwcm9wZXJ0\neS1hY2Nlc3Mgd2l0aG91dCByZWRlZmluaXRpb24KICAgIC8vIC0gZmlndXJl\nIG91dCBob3cgdG8gYXV0by10ZXN0IHRoZSByZWRlZmluaXRpb24gY29kZSwg\nZWl0aGVyIGluIEphdmEgNQogICAgLy8gICBvciBpbiBKYXZhIDYKICAgIC8v\nIC0gcnVuIENUUyBpbiB0aGUgZm9sbG93aW5nIGNvbWJpbmF0aW9uczoKICAg\nIC8vICAgKiBKYXZhIDYKICAgIC8vICAgKiBKYXZhIDUgd2l0aCBqYXZhYWdl\nbnQKICAgIC8vICAgKiBKYXZhIDUgd2l0aG91dCBqYXZhYWdlbnQKCiAgICBw\ndWJsaWMgdm9pZCBzZXRVcCgpIHsKICAgICAgICBzZXRVcChnZXRVbmVuaGFu\nY2VkQ2xhc3MoKSwgZ2V0VW5lbmhhbmNlZFN1YmNsYXNzKCksIENMRUFSX1RB\nQkxFUyk7CiAgICAgICAgLy8gdHJpZ2dlciBjbGFzcyByZWRlZmluaXRpb24K\nICAgICAgICBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpLmNsb3NlKCk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIGFic3RyYWN0IENsYXNzPD8gZXh0ZW5kcyBV\nbmVuaGFuY2VkVHlwZT4gZ2V0VW5lbmhhbmNlZENsYXNzKCk7CgogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IFVuZW5oYW5jZWRUeXBlIG5ld1VuZW5oYW5jZWRJ\nbnN0YW5jZSgpOwoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCBDbGFzczw/IGV4\ndGVuZHMgVW5lbmhhbmNlZFN1YnR5cGU+IGdldFVuZW5oYW5jZWRTdWJjbGFz\ncygpOwoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCBVbmVuaGFuY2VkU3VidHlw\nZSBuZXdVbmVuaGFuY2VkU3ViY2xhc3NJbnN0YW5jZSgpOwoKICAgIHByaXZh\ndGUgVW5lbmhhbmNlZFR5cGUgbmV3SW5zdGFuY2UoYm9vbGVhbiBzdWIpIHsK\nICAgICAgICByZXR1cm4gc3ViID8gbmV3VW5lbmhhbmNlZFN1YmNsYXNzSW5z\ndGFuY2UoKQogICAgICAgICAgICA6IG5ld1VuZW5oYW5jZWRJbnN0YW5jZSgp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RNZXRhRGF0YSgpIHsKICAg\nICAgICBDbGFzc01ldGFEYXRhIG1ldGEgPSBKUEFGYWNhZGVIZWxwZXIuZ2V0\nTWV0YURhdGEoZW1mLAogICAgICAgICAgICBnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKENsYXNzUmVkZWZpbmVyLmNhblJl\nZGVmaW5lQ2xhc3NlcygpLAogICAgICAgICAgICBtZXRhLmlzSW50ZXJjZXB0\naW5nKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RJbXBsSGVscGVy\nQ2FsbHMoKSB7CiAgICAgICAgYXNzZXJ0VHJ1ZShJbXBsSGVscGVyLmlzTWFu\nYWdlZFR5cGUobnVsbCwgZ2V0VW5lbmhhbmNlZENsYXNzKCkpKTsKCiAgICAg\nICAgVW5lbmhhbmNlZFR5cGUgdW4gPSBuZXdVbmVuaGFuY2VkSW5zdGFuY2Uo\nKTsKICAgICAgICBhc3NlcnRGYWxzZSh1biBpbnN0YW5jZW9mIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSk7CiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0g\nSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh1biwKICAgICAgICAg\nICAgZW1mLmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAgYXNzZXJ0Tm90\nTnVsbChwYyk7CiAgICAgICAgYXNzZXJ0VHJ1ZShJbXBsSGVscGVyLmlzTWFu\nYWdlYWJsZSh1bikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RCYXNp\nY1BlcnNpc3RlbmNlQ2FwYWJsZUJlaGF2aW9yKCkgewogICAgICAgIFVuZW5o\nYW5jZWRUeXBlIHVuID0gbmV3VW5lbmhhbmNlZEluc3RhbmNlKCk7CiAgICAg\nICAgdW4uc2V0U3RyaW5nRmllbGQoImJhciIpOwogICAgICAgIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYyA9IEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFi\nbGUodW4sCiAgICAgICAgICAgIGVtZi5nZXRDb25maWd1cmF0aW9uKCkpOwog\nICAgICAgIGFzc2VydEZhbHNlKHBjLnBjSXNEZWxldGVkKCkpOwogICAgICAg\nIGFzc2VydEZhbHNlKHBjLnBjSXNEaXJ0eSgpKTsKICAgICAgICBhc3NlcnRG\nYWxzZShwYy5wY0lzTmV3KCkpOwogICAgICAgIGFzc2VydEZhbHNlKHBjLnBj\nSXNQZXJzaXN0ZW50KCkpOwogICAgICAgIGFzc2VydEZhbHNlKHBjLnBjSXNU\ncmFuc2FjdGlvbmFsKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RQ\nQ1JlZ2lzdHJ5KCkgewogICAgICAgIGFzc2VydFRydWUoUENSZWdpc3RyeS5p\nc1JlZ2lzdGVyZWQoZ2V0VW5lbmhhbmNlZENsYXNzKCkpKTsKICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNl\nKAogICAgICAgICAgICBnZXRVbmVuaGFuY2VkQ2xhc3MoKSwgbnVsbCwgZmFs\nc2UpOwogICAgICAgIGFzc2VydE5vdE51bGwocGMpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHRlc3RDbGVhcmluZ09uU3VidHlwZUluc3RhbmNlKCkgewog\nICAgICAgIC8vIHRoZSBib29sZWFuIGF0IHRoZSBlbmQgb2YgbmV3SW5zdGFu\nY2Ugd2lsbCBjYXVzZSBjbGVhciB0byBiZSBpbnZva2VkCiAgICAgICAgVW5l\nbmhhbmNlZFR5cGUgdW4gPSAoVW5lbmhhbmNlZFR5cGUpCiAgICAgICAgICAg\nIFBDUmVnaXN0cnkubmV3SW5zdGFuY2UoZ2V0VW5lbmhhbmNlZENsYXNzKCks\nIG51bGwsIHRydWUpOwogICAgICAgIGFzc2VydEVxdWFscyhudWxsLCB1bi5n\nZXRTdHJpbmdGaWVsZCgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nR2V0T2JqZWN0SWRPbk9wZW5KUEFUeXBlKCkgewogICAgICAgIGdldE9iamVj\ndElkSGVscGVyKHRydWUsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0R2V0T2JqZWN0SWRPbk9wZW5KUEFUeXBlU3ViY2xhc3MoKSB7CiAg\nICAgICAgZ2V0T2JqZWN0SWRIZWxwZXIoZmFsc2UsIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0T2JqZWN0SWRPblVzZXJEZWZpbmVk\nKCkgewogICAgICAgIGdldE9iamVjdElkSGVscGVyKHRydWUsIHRydWUpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RHZXRPYmplY3RJZE9uVXNlckRl\nZmluZWRTdWJjbGFzcygpIHsKICAgICAgICBnZXRPYmplY3RJZEhlbHBlcihm\nYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGdldE9iamVj\ndElkSGVscGVyKGJvb2xlYW4gc3ViLCBib29sZWFuIHVzZXJEZWZpbmVkKSB7\nCiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRl\nRW50aXR5TWFuYWdlcigpOwogICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCku\nYmVnaW4oKTsKICAgICAgICBVbmVuaGFuY2VkVHlwZSB1biA9IG5ld0luc3Rh\nbmNlKHN1Yik7CiAgICAgICAgZW0ucGVyc2lzdCh1bik7CiAgICAgICAgZW0u\nZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKCiAgICAgICAgaWYgKCF1c2Vy\nRGVmaW5lZCkgewogICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAg\nICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgICAg\nIHVuID0gZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3MoKSwgdW4uZ2V0SWQo\nKSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnROb3ROdWxsKGVtLmdldE9i\namVjdElkKHVuKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdE9wZXJh\ndGlvbnNPblVzZXJEZWZpbmVkKCkgewogICAgICAgIG9wc0hlbHBlcihmYWxz\nZSwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFN1YmNsYXNz\nT3BlcmF0aW9uc09uVXNlckRlZmluZWQoKSB7CiAgICAgICAgb3BzSGVscGVy\nKHRydWUsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RPcGVy\nYXRpb25zT25PcGVuSlBBRGVmaW5lZCgpIHsKICAgICAgICBvcHNIZWxwZXIo\nZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3Vi\nY2xhc3NPcGVyYXRpb25zT25PcGVuSlBBRGVmaW5lZCgpIHsKICAgICAgICBv\ncHNIZWxwZXIodHJ1ZSwgZmFsc2UpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBvcHNIZWxwZXIoYm9vbGVhbiBzdWIsIGJvb2xlYW4gdXNlckRlZmluZWQp\nIHsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4gPSBu\nZXdJbnN0YW5jZShzdWIpOwogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CgogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgICAgIGVtLnBlcnNpc3QodW4pOwogICAg\nICAgICAgICB1bi5zZXRTdHJpbmdGaWVsZCgiYmFyIik7CiAgICAgICAgICAg\nIGFzc2VydEVxdWFscygiYmFyIiwgdW4uZ2V0U3RyaW5nRmllbGQoKSk7CiAg\nICAgICAgICAgIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4dChlbSwgdW4sIHRy\ndWUsIHRydWUsIHN1Yik7CiAgICAgICAgICAgIGVtLmZsdXNoKCk7CiAgICAg\nICAgICAgIGFzc2VydFBlcnNpc3RlbmNlQ29udGV4dChlbSwgdW4sIHRydWUs\nIHRydWUsIHN1Yik7CiAgICAgICAgICAgIGFzc2VydFRydWUodW4uZ2V0SWQo\nKSAhPSAwKTsKICAgICAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4yID0gZW0u\nZmluZChnZXRVbmVuaGFuY2VkQ2xhc3MoKSwgdW4uZ2V0SWQoKSk7CiAgICAg\nICAgICAgIGFzc2VydFNhbWUodW4sIHVuMik7CiAgICAgICAgICAgIGVtLmdl\ndFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgIGFzc2VydFBl\ncnNpc3RlbmNlQ29udGV4dChlbSwgdW4sIGZhbHNlLCBmYWxzZSwgc3ViKTsK\nICAgICAgICAgICAgdW4yID0gZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKSwgdW4uZ2V0SWQoKSk7CiAgICAgICAgICAgIGFzc2VydFNhbWUodW4sIHVu\nMik7CgogICAgICAgICAgICBpZiAoIXVzZXJEZWZpbmVkKSB7CiAgICAgICAg\nICAgICAgICBlbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgZW0gPSBlbWYu\nY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhhbmNlZENsYXNzKCksIHVuLmdl\ndElkKCkpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKHVuKTsKICAgICAg\nICAgICAgaWYgKCF1c2VyRGVmaW5lZCkKICAgICAgICAgICAgICAgIGFzc2Vy\ndFRydWUodW4gaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZUNhcGFibGUpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoImJhciIsIHVuLmdldFN0cmluZ0ZpZWxk\nKCkpOwogICAgICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7\nCiAgICAgICAgICAgIHVuLnNldFN0cmluZ0ZpZWxkKCJiYXoiKTsKICAgICAg\nICAgICAgYXNzZXJ0UGVyc2lzdGVuY2VDb250ZXh0KGVtLCB1biwgdHJ1ZSwg\ndHJ1ZSwgc3ViKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJiYXoiLCB1\nbi5nZXRTdHJpbmdGaWVsZCgpKTsKCiAgICAgICAgICAgIGlmIChzdWIpCiAg\nICAgICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSB1bikuc2V0SW50\nRmllbGQoMTcpOwoKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShlbS5pc0RpcnR5\nKHVuKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbS5nZXRUcmFuc2Fj\ndGlvbigpLmNvbW1pdCgpOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRo\nYXQgdGhlIHZhbHVlcyBhcmUgc3RpbGwgdXAtdG8tZGF0ZSBhZnRlcgogICAg\nICAgICAgICAvLyB0aGUgY29tbWl0IGhhcHBlbnMKICAgICAgICAgICAgYXNz\nZXJ0RXF1YWxzKCJiYXoiLCB1bi5nZXRTdHJpbmdGaWVsZCgpKTsKICAgICAg\nICAgICAgCiAgICAgICAgICAgIGVtLmNsb3NlKCk7CgogICAgICAgICAgICBl\nbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgICAgIHVu\nID0gZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3MoKSwgdW4uZ2V0SWQoKSk7\nCiAgICAgICAgICAgIGFzc2VydE5vdE51bGwodW4pOwogICAgICAgICAgICBh\nc3NlcnRUcnVlKHVuIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VDYXBhYmxlKTsK\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJiYXoiLCB1bi5nZXRTdHJpbmdG\naWVsZCgpKTsKICAgICAgICAgICAgaWYgKHN1YikKICAgICAgICAgICAgICAg\nIGFzc2VydEVxdWFscygxNywgKChVbmVuaGFuY2VkU3VidHlwZSkgdW4pLmdl\ndEludEZpZWxkKCkpOwogICAgICAgICAgICBlbS5jbG9zZSgpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChlbSAhPSBudWxsICYmIGVt\nLmdldFRyYW5zYWN0aW9uKCkuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAg\nIGVtLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAg\naWYgKGVtICE9IG51bGwgJiYgZW0uaXNPcGVuKCkpCiAgICAgICAgICAgICAg\nICBlbS5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgYXNzZXJ0UGVyc2lzdGVuY2VDb250ZXh0KE9wZW5KUEFFbnRpdHlNYW5h\nZ2VyIGVtLAogICAgICAgIFVuZW5oYW5jZWRUeXBlIHVuLCBib29sZWFuIHRy\nYW5zYWN0aW9uYWwsIGJvb2xlYW4gZGlydHksIGJvb2xlYW4gc3ViKSB7CiAg\nICAgICAgYXNzZXJ0RXF1YWxzKHRyYW5zYWN0aW9uYWwsIGVtLmdldFRyYW5z\nYWN0aW9uYWxPYmplY3RzKCkuY29udGFpbnModW4pKTsKICAgICAgICBhc3Nl\ncnRFcXVhbHMoZGlydHksIGVtLmdldERpcnR5T2JqZWN0cygpLmNvbnRhaW5z\nKHVuKSk7CiAgICAgICAgaWYgKGRpcnR5KSB7CiAgICAgICAgICAgIENsYXNz\nIGNscyA9IHN1YiA/IGdldFVuZW5oYW5jZWRTdWJjbGFzcygpIDogZ2V0VW5l\nbmhhbmNlZENsYXNzKCk7CiAgICAgICAgICAgIGFzc2VydFRydWUoZW0uZ2V0\nVXBkYXRlZENsYXNzZXMoKS5jb250YWlucyhjbHMpCiAgICAgICAgICAgICAg\nICB8fCBlbS5nZXRQZXJzaXN0ZWRDbGFzc2VzKCkuY29udGFpbnMoY2xzKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWxhdGlv\nbnMoKSB7CiAgICAgICAgT3BlbkpQQUVudGl0eU1hbmFnZXIgZW0gPSBlbWYu\nY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIGVtLmdldFRyYW5zYWN0\naW9uKCkuYmVnaW4oKTsKICAgICAgICBVbmVuaGFuY2VkU3VidHlwZSB1biA9\nIG5ld1VuZW5oYW5jZWRTdWJjbGFzc0luc3RhbmNlKCk7CiAgICAgICAgZW0u\ncGVyc2lzdCh1bik7CiAgICAgICAgdW4uc2V0U3RyaW5nRmllbGQoImFvZXUi\nKTsKICAgICAgICBVbmVuaGFuY2VkU3VidHlwZSByZWxhdGVkID0gbmV3VW5l\nbmhhbmNlZFN1YmNsYXNzSW5zdGFuY2UoKTsKICAgICAgICB1bi5zZXRSZWxh\ndGVkKHJlbGF0ZWQpOwogICAgICAgIHJlbGF0ZWQuc2V0U3RyaW5nRmllbGQo\nInNudGgiKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgp\nOwogICAgICAgIGVtLmNsb3NlKCk7CgogICAgICAgIGVtID0gZW1mLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB1biA9IChVbmVuaGFuY2VkU3Vi\ndHlwZSkgZW0uZmluZChnZXRVbmVuaGFuY2VkQ2xhc3MoKSwgdW4uZ2V0SWQo\nKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJhb2V1IiwgdW4uZ2V0U3RyaW5n\nRmllbGQoKSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbCh1bi5nZXRSZWxhdGVk\nKCkpOwogICAgICAgIGFzc2VydEVxdWFscygic250aCIsIHVuLmdldFJlbGF0\nZWQoKS5nZXRTdHJpbmdGaWVsZCgpKTsKICAgICAgICBlbS5jbG9zZSgpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RFbmhhbmNlcigpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxDbGFzcz4gc3VicyA9ICBNYW5h\nZ2VkQ2xhc3NTdWJjbGFzc2VyLnByZXBhcmVVbmVuaGFuY2VkQ2xhc3NlcygK\nICAgICAgICAgICAgZW1mLmdldENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAg\nICAgQ29sbGVjdGlvbnMuc2luZ2xldG9uKGdldFVuZW5oYW5jZWRDbGFzcygp\nKSwgbnVsbCk7CiAgICAgICAgQ2xhc3Mgc3ViID0gc3Vicy5nZXQoMCk7CiAg\nICAgICAgYXNzZXJ0Tm90TnVsbChzdWIpOwogICAgICAgIGFzc2VydEVxdWFs\ncygib3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuIgogICAgICAgICAgICAr\nIGdldFVuZW5oYW5jZWRDbGFzcygpLmdldE5hbWUoKS5yZXBsYWNlKCcuJywg\nJyQnKSArICIkcGNzdWJjbGFzcyIsCiAgICAgICAgICAgIHN1Yi5nZXROYW1l\nKCkpOwogICAgICAgIGFzc2VydFRydWUoUGVyc2lzdGVuY2VDYXBhYmxlLmNs\nYXNzLmlzQXNzaWduYWJsZUZyb20oc3ViKSk7CiAgICAgICAgYXNzZXJ0VHJ1\nZShnZXRVbmVuaGFuY2VkQ2xhc3MoKS5pc0Fzc2lnbmFibGVGcm9tKHN1Yikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RQQ1N1YmNsYXNzTmFtZSgp\nIHsKICAgICAgICBhc3NlcnRFcXVhbHMoIm9yZy5hcGFjaGUub3BlbmpwYS5l\nbmhhbmNlLiIKICAgICAgICAgICAgKyBnZXRVbmVuaGFuY2VkQ2xhc3MoKS5n\nZXROYW1lKCkucmVwbGFjZSgnLicsICckJykgKyAiJHBjc3ViY2xhc3MiLAog\nICAgICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoZ2V0VW5l\nbmhhbmNlZENsYXNzKCkpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nRXZpY3Rpb25JblVzZXJDcmVhdGVkSW5zdGFuY2UoKQogICAgICAgIHRocm93\ncyBOb1N1Y2hGaWVsZEV4Y2VwdGlvbiwgSWxsZWdhbEFjY2Vzc0V4Y2VwdGlv\nbiB7CiAgICAgICAgZXZpY3Rpb25IZWxwZXIodHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgdGVzdEV2aWN0aW9uSW5PcGVuSlBBQ3JlYXRlZEluc3Rh\nbmNlKCkKICAgICAgICB0aHJvd3MgTm9TdWNoRmllbGRFeGNlcHRpb24sIEls\nbGVnYWxBY2Nlc3NFeGNlcHRpb24gewogICAgICAgIGV2aWN0aW9uSGVscGVy\nKGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZXZpY3Rpb25IZWxw\nZXIoYm9vbGVhbiB1c2VyRGVmaW5lZCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nRmllbGRFeGNlcHRpb24sIElsbGVnYWxBY2Nlc3NFeGNlcHRpb24gewogICAg\nICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0gZW1mLmNyZWF0ZUVudGl0\neU1hbmFnZXIoKTsKICAgICAgICBVbmVuaGFuY2VkVHlwZSB1biA9IG5ld1Vu\nZW5oYW5jZWRJbnN0YW5jZSgpOwogICAgICAgIGVtLmdldFRyYW5zYWN0aW9u\nKCkuYmVnaW4oKTsKICAgICAgICBlbS5wZXJzaXN0KHVuKTsKICAgICAgICBl\nbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwoKICAgICAgICBpZiAoIXVz\nZXJEZWZpbmVkKSB7CiAgICAgICAgICAgIGVtLmNsb3NlKCk7CiAgICAgICAg\nICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICAg\nICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFzcygpLCB1bi5nZXRJ\nZCgpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShnZXRVbmVuaGFuY2VkQ2xh\nc3MoKSAhPSB1bi5nZXRDbGFzcygpKTsKICAgICAgICB9CgogICAgICAgIGVt\nLmV2aWN0KHVuKTsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0g\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIpCiAgICAgICAgICAgIEltcGxIZWxwZXIu\ndG9QZXJzaXN0ZW5jZUNhcGFibGUodW4sIG51bGwpLnBjR2V0U3RhdGVNYW5h\nZ2VyKCk7CgogICAgICAgIC8vIHdlIG9ubHkgZXhwZWN0IGxhenkgbG9hZGlu\nZyB0byB3b3JrIHdoZW4gd2UgY2FuIHJlZGVmaW5lIGNsYXNzZXMKICAgICAg\nICAvLyBvciB3aGVuIGFjY2Vzc2luZyBhIHByb3BlcnR5LWFjY2VzcyByZWNv\ncmQgdGhhdCBPcGVuSlBBIGNyZWF0ZWQuCiAgICAgICAgaWYgKENsYXNzUmVk\nZWZpbmVyLmNhblJlZGVmaW5lQ2xhc3NlcygpCiAgICAgICAgICAgIHx8ICgh\ndXNlckRlZmluZWQgJiYgc20uZ2V0TWV0YURhdGEoKS5nZXRBY2Nlc3NUeXBl\nKCkKICAgICAgICAgICAgICAgICE9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJ\nRUxEKSkgewoKICAgICAgICAgICAgYXNzZXJ0RmFsc2Uoc20uZ2V0TG9hZGVk\nKCkKICAgICAgICAgICAgICAgIC5nZXQoc20uZ2V0TWV0YURhdGEoKS5nZXRG\naWVsZCgic3RyaW5nRmllbGQiKS5nZXRJbmRleCgpKSk7CgogICAgICAgICAg\nICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgdmFsdWUgd2FzIGNsZWFyZWQuLi4K\nICAgICAgICAgICAgRmllbGQgZmllbGQgPSBnZXRVbmVuaGFuY2VkQ2xhc3Mo\nKS5nZXREZWNsYXJlZEZpZWxkKAogICAgICAgICAgICAgICAgaXNGaWVsZEFj\nY2Vzc1Rlc3QoKSA/ICJzdHJpbmdGaWVsZCIgOiAic2YiKTsKICAgICAgICAg\nICAgZmllbGQuc2V0QWNjZXNzaWJsZSh0cnVlKTsKICAgICAgICAgICAgYXNz\nZXJ0RXF1YWxzKG51bGwsIGZpZWxkLmdldCh1bikpOwoKICAgICAgICAgICAg\nLy8gLi4uIGFuZCB0aGF0IGl0IGdldHMgcmVsb2FkZWQgcHJvcGVybHkKICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKCJmb28iLCB1bi5nZXRTdHJpbmdGaWVs\nZCgpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShzbS5nZXRMb2FkZWQoKQog\nICAgICAgICAgICAgICAgLmdldChzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxk\nKCJzdHJpbmdGaWVsZCIpLmdldEluZGV4KCkpKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAvLyB1bnJlZGVmaW5lZCBwcm9wZXJ0aWVzIHdpdGgg\ndXNlci1kZWZpbmVkIGluc3RhbmNlLCBvciBhbnkKICAgICAgICAgICAgLy8g\ndW5yZWRlZmluZWQgZmllbGQgYWNjZXNzCiAgICAgICAgICAgIGFzc2VydFRy\ndWUoc20uZ2V0TG9hZGVkKCkKICAgICAgICAgICAgICAgIC5nZXQoc20uZ2V0\nTWV0YURhdGEoKS5nZXRGaWVsZCgic3RyaW5nRmllbGQiKS5nZXRJbmRleCgp\nKSk7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgdmFsdWUg\nd2FzIG5vdCBjbGVhcmVkCiAgICAgICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0\nVW5lbmhhbmNlZENsYXNzKCkuZ2V0RGVjbGFyZWRGaWVsZCgKICAgICAgICAg\nICAgICAgIGlzRmllbGRBY2Nlc3NUZXN0KCkgPyAic3RyaW5nRmllbGQiIDog\nInNmIik7CiAgICAgICAgICAgIGZpZWxkLnNldEFjY2Vzc2libGUodHJ1ZSk7\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiZm9vIiwgZmllbGQuZ2V0KHVu\nKSk7CiAgICAgICAgfQoKICAgICAgICBlbS5jbG9zZSgpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBhYnN0cmFjdCBib29sZWFuIGlzRmllbGRBY2Nlc3NUZXN0\nKCk7CgogICAgcHVibGljIHZvaWQgdGVzdExhenlMb2FkaW5nKCkKICAgICAg\nICB0aHJvd3MgTm9TdWNoRmllbGRFeGNlcHRpb24sIElsbGVnYWxBY2Nlc3NF\neGNlcHRpb24gewogICAgICAgIE9wZW5KUEFFbnRpdHlNYW5hZ2VyIGVtID0g\nZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBVbmVuaGFuY2Vk\nVHlwZSB1biA9IG5ld1VuZW5oYW5jZWRJbnN0YW5jZSgpOwogICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBlbS5wZXJzaXN0\nKHVuKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwog\nICAgICAgIGVtLmNsb3NlKCk7CgogICAgICAgIGVtID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhh\nbmNlZENsYXNzKCksIHVuLmdldElkKCkpOwogICAgICAgIGFzc2VydFRydWUo\nZ2V0VW5lbmhhbmNlZENsYXNzKCkgIT0gdW4uZ2V0Q2xhc3MoKSk7CiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IChPcGVuSlBBU3RhdGVNYW5h\nZ2VyKQogICAgICAgICAgICBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBh\nYmxlKHVuLCBudWxsKS5wY0dldFN0YXRlTWFuYWdlcigpOwoKICAgICAgICAv\nLyB3ZSBvbmx5IGV4cGVjdCBsYXp5IGxvYWRpbmcgdG8gd29yayB3aGVuIHdl\nIGNhbiByZWRlZmluZSBjbGFzc2VzCiAgICAgICAgLy8gb3Igd2hlbiBhY2Nl\nc3NpbmcgYSBwcm9wZXJ0eS1hY2Nlc3MgcmVjb3JkIHRoYXQgT3BlbkpQQSBj\ncmVhdGVkLgogICAgICAgIGlmIChDbGFzc1JlZGVmaW5lci5jYW5SZWRlZmlu\nZUNsYXNzZXMoKQogICAgICAgICAgICB8fCAoc20uZ2V0TWV0YURhdGEoKS5n\nZXRBY2Nlc3NUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQp\nKQogICAgICAgIHsKICAgICAgICAgICAgYXNzZXJ0RmFsc2Uoc20uZ2V0TG9h\nZGVkKCkKICAgICAgICAgICAgICAgIC5nZXQoc20uZ2V0TWV0YURhdGEoKS5n\nZXRGaWVsZCgibGF6eUZpZWxkIikuZ2V0SW5kZXgoKSkpOwoKICAgICAgICAg\nICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHZhbHVlIHdhcyBjbGVhcmVkCiAg\nICAgICAgICAgIEZpZWxkIGZpZWxkID0gZ2V0VW5lbmhhbmNlZENsYXNzKCku\nZ2V0RGVjbGFyZWRGaWVsZCgibGF6eUZpZWxkIik7CiAgICAgICAgICAgIGZp\nZWxkLnNldEFjY2Vzc2libGUodHJ1ZSk7CiAgICAgICAgICAgIGFzc2VydEVx\ndWFscyhudWxsLCBmaWVsZC5nZXQodW4pKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAvLyB1bnJlZGVmaW5lZCBmaWVsZCBhY2Nlc3MKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZShzbS5nZXRMb2FkZWQoKQogICAgICAgICAgICAg\nICAgLmdldChzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKCJsYXp5RmllbGQi\nKS5nZXRJbmRleCgpKSk7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhh\ndCB0aGUgdmFsdWUgd2FzIGxvYWRlZCBhbHJlYWR5CiAgICAgICAgICAgIEZp\nZWxkIGZpZWxkID0gZ2V0VW5lbmhhbmNlZENsYXNzKCkuZ2V0RGVjbGFyZWRG\naWVsZCgibGF6eUZpZWxkIik7CiAgICAgICAgICAgIGZpZWxkLnNldEFjY2Vz\nc2libGUodHJ1ZSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygibGF6eSIs\nIGZpZWxkLmdldCh1bikpOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSBz\ndXJlIHRoYXQgdGhlIHZhbHVlIGlzIGF2YWlsYWJsZSwgb25lIHdheSBvciBh\nbm90aGVyCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJsYXp5IiwgdW4uZ2V0TGF6\neUZpZWxkKCkpOwogICAgICAgIGFzc2VydFRydWUoc20uZ2V0TG9hZGVkKCkK\nICAgICAgICAgICAgLmdldChzbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKCJs\nYXp5RmllbGQiKS5nZXRJbmRleCgpKSk7CgogICAgICAgIGVtLmNsb3NlKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFNlcmlhbGl6YXRpb25PZlVz\nZXJEZWZpbmVkSW5zdGFuY2UoKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlv\nbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgc2VyaWFsaXph\ndGlvbkhlbHBlcih0cnVlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgdGVzdFNlcmlhbGl6YXRpb25PZlVzZXJEZWZpbmVkU3ViY2xhc3NJbnN0\nYW5jZSgpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uIHsKICAgICAgICBzZXJpYWxpemF0aW9uSGVscGVyKHRy\ndWUsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RTZXJpYWxp\nemF0aW9uT2ZPcGVuSlBBRGVmaW5lZEluc3RhbmNlKCkKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewogICAg\nICAgIHNlcmlhbGl6YXRpb25IZWxwZXIoZmFsc2UsIGZhbHNlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0U2VyaWFsaXphdGlvbk9mT3BlbkpQQURl\nZmluZWRTdWJjbGFzc0luc3RhbmNlKCkKICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewogICAgICAgIHNlcmlh\nbGl6YXRpb25IZWxwZXIoZmFsc2UsIHRydWUpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBzZXJpYWxpemF0aW9uSGVscGVyKGJvb2xlYW4gdXNlckRlZmlu\nZWQsIGJvb2xlYW4gc3ViKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwg\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgT3BlbkpQQUVudGl0\neU1hbmFnZXIgZW0gPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAg\nICAgIFVuZW5oYW5jZWRUeXBlIHVuID0gbmV3SW5zdGFuY2Uoc3ViKTsKICAg\nICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgZW0u\ncGVyc2lzdCh1bik7CgogICAgICAgIGlmIChzdWIpIHsKICAgICAgICAgICAg\nVW5lbmhhbmNlZFR5cGUgcmVsYXRlZCA9IG5ld0luc3RhbmNlKGZhbHNlKTsK\nICAgICAgICAgICAgcmVsYXRlZC5zZXRTdHJpbmdGaWVsZCgicmVsYXRlZCIp\nOwogICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSB1bikuc2V0UmVs\nYXRlZChyZWxhdGVkKTsKICAgICAgICB9CgogICAgICAgIGVtLmdldFRyYW5z\nYWN0aW9uKCkuY29tbWl0KCk7CgogICAgICAgIGlmICghdXNlckRlZmluZWQp\nIHsKICAgICAgICAgICAgZW0uY2xvc2UoKTsKICAgICAgICAgICAgZW0gPSBl\nbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIH0KCiAgICAgICAg\ndW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFzcygpLCB1bi5nZXRJZCgp\nKTsKICAgICAgICBCeXRlQXJyYXlPdXRwdXRTdHJlYW0gb3V0ID0gbmV3IEJ5\ndGVBcnJheU91dHB1dFN0cmVhbSgpOwogICAgICAgIE9iamVjdE91dHB1dFN0\ncmVhbSBvb3V0ID0gbmV3IE9iamVjdE91dHB1dFN0cmVhbShvdXQpOwogICAg\nICAgIG9vdXQud3JpdGVPYmplY3QodW4pOwogICAgICAgIG9vdXQuZmx1c2go\nKTsKICAgICAgICBieXRlW10gYnl0ZXMgPSBvdXQudG9CeXRlQXJyYXkoKTsK\nCiAgICAgICAgT2JqZWN0SW5wdXRTdHJlYW0gb2luID0gbmV3IE9iamVjdElu\ncHV0U3RyZWFtKAogICAgICAgICAgICBuZXcgQnl0ZUFycmF5SW5wdXRTdHJl\nYW0oYnl0ZXMpKTsKICAgICAgICBVbmVuaGFuY2VkVHlwZSBkZXNlcmlhbGl6\nZWQgPSAoVW5lbmhhbmNlZFR5cGUpIG9pbi5yZWFkT2JqZWN0KCk7CgogICAg\nICAgIGNvcGllZEluc3RhbmNlSGVscGVyKHN1YiwgZW0sIHVuLCBkZXNlcmlh\nbGl6ZWQsIGZhbHNlKTsKICAgICAgICBlbS5jbG9zZSgpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHRlc3RDbG9uaW5nT2ZVc2VyRGVmaW5lZEluc3RhbmNl\nKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRF\neGNlcHRpb24sIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAg\nICBjbG9uZUhlbHBlcih0cnVlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgdGVzdENsb25pbmdPZlVzZXJEZWZpbmVkU3ViY2xhc3NJbnN0YW5j\nZSgpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uLCBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAg\nICAgY2xvbmVIZWxwZXIodHJ1ZSwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgdGVzdENsb25pbmdPZk9wZW5KUEFEZWZpbmVkSW5zdGFuY2UoKQog\nICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2Vw\ndGlvbiwgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGNs\nb25lSGVscGVyKGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgdGVzdENsb25pbmdPZk9wZW5KUEFEZWZpbmVkU3ViY2xhc3NJbnN0YW5j\nZSgpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5k\nRXhjZXB0aW9uLCBDbG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbiB7CiAgICAg\nICAgY2xvbmVIZWxwZXIoZmFsc2UsIHRydWUpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBjbG9uZUhlbHBlcihib29sZWFuIHVzZXJEZWZpbmVkLCBib29s\nZWFuIHN1YikKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90\nRm91bmRFeGNlcHRpb24sIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsK\nICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdlciBlbSA9IGVtZi5jcmVhdGVF\nbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgVW5lbmhhbmNlZFR5cGUgdW4gPSBu\nZXdJbnN0YW5jZShzdWIpOwogICAgICAgIGVtLmdldFRyYW5zYWN0aW9uKCku\nYmVnaW4oKTsKICAgICAgICBlbS5wZXJzaXN0KHVuKTsKCiAgICAgICAgaWYg\nKHN1YikgewogICAgICAgICAgICBVbmVuaGFuY2VkVHlwZSByZWxhdGVkID0g\nbmV3SW5zdGFuY2UoZmFsc2UpOwogICAgICAgICAgICByZWxhdGVkLnNldFN0\ncmluZ0ZpZWxkKCJyZWxhdGVkIik7CiAgICAgICAgICAgICgoVW5lbmhhbmNl\nZFN1YnR5cGUpIHVuKS5zZXRSZWxhdGVkKHJlbGF0ZWQpOwogICAgICAgIH0K\nCiAgICAgICAgZW0uZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKCiAgICAg\nICAgaWYgKCF1c2VyRGVmaW5lZCkgewogICAgICAgICAgICBlbS5jbG9zZSgp\nOwogICAgICAgICAgICBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7\nCiAgICAgICAgfQoKICAgICAgICB1biA9IGVtLmZpbmQoZ2V0VW5lbmhhbmNl\nZENsYXNzKCksIHVuLmdldElkKCkpOwogICAgICAgIFVuZW5oYW5jZWRUeXBl\nIGNsb25lZCA9IChVbmVuaGFuY2VkVHlwZSkgdW4uY2xvbmUoKTsKCiAgICAg\nICAgY29waWVkSW5zdGFuY2VIZWxwZXIoc3ViLCBlbSwgdW4sIGNsb25lZCwg\ndHJ1ZSk7CiAgICAgICAgZW0uY2xvc2UoKTsKICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgY29waWVkSW5zdGFuY2VIZWxwZXIoYm9vbGVhbiBzdWIsIE9wZW5K\nUEFFbnRpdHlNYW5hZ2VyIGVtLAogICAgICAgIFVuZW5oYW5jZWRUeXBlIHVu\nLCBVbmVuaGFuY2VkVHlwZSBjb3B5LCBib29sZWFuIHZpYUNsb25lKSB7CiAg\nICAgICAgYXNzZXJ0Tm90U2FtZSh1biwgY29weSk7CiAgICAgICAgaWYgKCF2\naWFDbG9uZSkKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKHN1YiA/IGdldFVu\nZW5oYW5jZWRTdWJjbGFzcygpIDogZ2V0VW5lbmhhbmNlZENsYXNzKCksCiAg\nICAgICAgICAgICAgICBjb3B5LmdldENsYXNzKCkpOwogICAgICAgIGFzc2Vy\ndEVxdWFscyh1bi5nZXRJZCgpLCBjb3B5LmdldElkKCkpOwogICAgICAgIGFz\nc2VydEVxdWFscyh1bi5nZXRTdHJpbmdGaWVsZCgpLCBjb3B5LmdldFN0cmlu\nZ0ZpZWxkKCkpOwogICAgICAgIGlmIChzdWIpIHsKICAgICAgICAgICAgYXNz\nZXJ0RXF1YWxzKAogICAgICAgICAgICAgICAgKChVbmVuaGFuY2VkU3VidHlw\nZSkgdW4pLmdldEludEZpZWxkKCksCiAgICAgICAgICAgICAgICAoKFVuZW5o\nYW5jZWRTdWJ0eXBlKSBjb3B5KS5nZXRJbnRGaWVsZCgpKTsKICAgICAgICAg\nICAgYXNzZXJ0Tm90U2FtZSgKICAgICAgICAgICAgICAgICgoVW5lbmhhbmNl\nZFN1YnR5cGUpIHVuKS5nZXRSZWxhdGVkKCksCiAgICAgICAgICAgICAgICAo\nKFVuZW5oYW5jZWRTdWJ0eXBlKSBjb3B5KS5nZXRSZWxhdGVkKCkpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoCiAgICAgICAgICAgICAgICAoKFVuZW5o\nYW5jZWRTdWJ0eXBlKSB1bikuZ2V0UmVsYXRlZCgpLmdldElkKCksCiAgICAg\nICAgICAgICAgICAoKFVuZW5oYW5jZWRTdWJ0eXBlKSBjb3B5KS5nZXRSZWxh\ndGVkKCkuZ2V0SWQoKSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRGYWxz\nZShlbS5pc0RldGFjaGVkKHVuKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShlbS5p\nc0RldGFjaGVkKGNvcHkpKTsKICAgICAgICBjb3B5LnNldFN0cmluZ0ZpZWxk\nKCJvZmZsaW5lIHVwZGF0ZSIpOwoKICAgICAgICBlbS5nZXRUcmFuc2FjdGlv\nbigpLmJlZ2luKCk7CiAgICAgICAgYXNzZXJ0U2FtZSh1biwgZW0ubWVyZ2Uo\nY29weSkpOwogICAgICAgIGFzc2VydFRydWUoZW0uaXNEaXJ0eSh1bikpOwog\nICAgICAgIGFzc2VydEVxdWFscygib2ZmbGluZSB1cGRhdGUiLCB1bi5nZXRT\ndHJpbmdGaWVsZCgpKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNv\nbW1pdCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RMaXN0ZW5lcnNP\nblVzZXJEZWZpbmVkSW5zdGFuY2UoKQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RTdXBwb3J0\nZWRFeGNlcHRpb24gewogICAgICAgIGxpc3RlbmVySGVscGVyKHRydWUsIGZh\nbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGlzdGVuZXJzT25V\nc2VyRGVmaW5lZFN1YmNsYXNzSW5zdGFuY2UoKQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RT\ndXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGxpc3RlbmVySGVscGVyKHRy\ndWUsIHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RMaXN0ZW5l\ncnNPbk9wZW5KUEFEZWZpbmVkSW5zdGFuY2UoKQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgQ2xvbmVOb3RT\ndXBwb3J0ZWRFeGNlcHRpb24gewogICAgICAgIGxpc3RlbmVySGVscGVyKGZh\nbHNlLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdExpc3Rl\nbmVyc09uT3BlbkpQQURlZmluZWRTdWJjbGFzc0luc3RhbmNlKCkKICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24s\nIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAgICBsaXN0ZW5l\nckhlbHBlcihmYWxzZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGxpc3RlbmVySGVscGVyKGJvb2xlYW4gdXNlckRlZmluZWQsIGJvb2xlYW4g\nc3ViKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3Vu\nZEV4Y2VwdGlvbiwgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gewogICAg\nICAgIExpc3RlbmVySW1wbCBsaXN0ZW5lciA9IG5ldyBMaXN0ZW5lckltcGwo\nKTsKICAgICAgICBlbWYuYWRkTGlmZWN5Y2xlTGlzdGVuZXIobGlzdGVuZXIs\nIChDbGFzc1tdKSBudWxsKTsKICAgICAgICBPcGVuSlBBRW50aXR5TWFuYWdl\nciBlbSA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAgICAgICAgVW5l\nbmhhbmNlZFR5cGUgdW4gPSBuZXdJbnN0YW5jZShzdWIpOwogICAgICAgIGVt\nLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICBlbS5wZXJzaXN0\nKHVuKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwoK\nICAgICAgICBpZiAoIXVzZXJEZWZpbmVkKSB7CiAgICAgICAgICAgIGVtLmNs\nb3NlKCk7CiAgICAgICAgICAgIGVtID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFn\nZXIoKTsKICAgICAgICB9CgogICAgICAgIGxpc3RlbmVyLmludm9rZWQgPSBm\nYWxzZTsKCiAgICAgICAgdW4gPSBlbS5maW5kKGdldFVuZW5oYW5jZWRDbGFz\ncygpLCB1bi5nZXRJZCgpKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigp\nLmJlZ2luKCk7CiAgICAgICAgdW4uc2V0U3RyaW5nRmllbGQoInVwZGF0ZWQi\nKTsKICAgICAgICBlbS5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAg\nICAgIGFzc2VydFRydWUobGlzdGVuZXIuaW52b2tlZCk7CiAgICAgICAgZW0u\nY2xvc2UoKTsKCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJ1cGRhdGVkIiwgbGlz\ndGVuZXIuc3RyaW5nRmllbGQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRl\nc3RHZXRNZXRhRGF0YU9mU3VidHlwZSgpIHsKICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBKUEFGYWNhZGVIZWxwZXIuZ2V0TWV0YURhdGEoZW1mLAog\nICAgICAgICAgICBnZXRVbmVuaGFuY2VkQ2xhc3MoKSk7CiAgICAgICAgTGlz\ndDxDbGFzcz4gc3VicyA9ICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyLnByZXBh\ncmVVbmVuaGFuY2VkQ2xhc3NlcygKICAgICAgICAgICAgZW1mLmdldENvbmZp\nZ3VyYXRpb24oKSwKICAgICAgICAgICAgQ29sbGVjdGlvbnMuc2luZ2xldG9u\nKGdldFVuZW5oYW5jZWRDbGFzcygpKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0\nU2FtZShtZXRhLCBKUEFGYWNhZGVIZWxwZXIuZ2V0TWV0YURhdGEoZW1mLCBz\ndWJzLmdldCgwKSkpOwoKICAgICAgICBtZXRhID0gSlBBRmFjYWRlSGVscGVy\nLmdldE1ldGFEYXRhKGVtZiwgZ2V0VW5lbmhhbmNlZFN1YmNsYXNzKCkpOwog\nICAgICAgIHN1YnMgPSAgTWFuYWdlZENsYXNzU3ViY2xhc3Nlci5wcmVwYXJl\nVW5lbmhhbmNlZENsYXNzZXMoCiAgICAgICAgICAgIGVtZi5nZXRDb25maWd1\ncmF0aW9uKCksCiAgICAgICAgICAgIENvbGxlY3Rpb25zLnNpbmdsZXRvbihn\nZXRVbmVuaGFuY2VkU3ViY2xhc3MoKSksIG51bGwpOwogICAgICAgIGFzc2Vy\ndFNhbWUobWV0YSwgSlBBRmFjYWRlSGVscGVyLmdldE1ldGFEYXRhKGVtZiwg\nc3Vicy5nZXQoMCkpKTsKICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIExpc3Rl\nbmVySW1wbAogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RMaWZlY3ljbGVMaXN0\nZW5lciB7CgogICAgICAgIFN0cmluZyBzdHJpbmdGaWVsZDsKICAgICAgICBi\nb29sZWFuIGludm9rZWQ7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIGFmdGVyU3RvcmUoTGlmZWN5Y2xlRXZlbnQgZXZlbnQpIHsK\nICAgICAgICAgICAgaW52b2tlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmlu\nZ0ZpZWxkID0gKChVbmVuaGFuY2VkVHlwZSkgZXZlbnQuZ2V0U291cmNlKCkp\nLmdldFN0cmluZ0ZpZWxkKCk7CiAgICAgICAgfQogICAgfQp9\n","encoding":"base64"}

