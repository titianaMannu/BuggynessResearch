{"sha":"e2a7ffaeb44a33d44a98013c0d032a55c12dd8f1","node_id":"MDQ6QmxvYjIwNjM2NDplMmE3ZmZhZWI0NGEzM2Q0NGE5ODAxM2MwZDAzMmE1NWMxMmRkOGYx","size":14530,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e2a7ffaeb44a33d44a98013c0d032a55c12dd8f1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlNRTEV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWlu\nYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmll\nbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5TdHJhdGVneTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5EQkRpY3Rpb25hcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TUUxFeGNlcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlzdGljRXhjZXB0aW9u\nOwoKLyoqCiAqIEJhc2UgdXBkYXRlIG1hbmFnZXIgd2l0aCBjb21tb24gZnVu\nY3Rpb25hbGl0eS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1Ymxp\nYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFVwZGF0ZU1hbmFnZXIKICAgIGlt\ncGxlbWVudHMgVXBkYXRlTWFuYWdlciwgQ29uZmlndXJhYmxlIHsKCiAgICBw\ncm90ZWN0ZWQgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZiA9IG51bGw7CiAgICBw\ncm90ZWN0ZWQgREJEaWN0aW9uYXJ5IGRpY3QgPSBudWxsOwoKICAgIHB1Ymxp\nYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25mKSB7\nCiAgICAgICAgdGhpcy5jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBjb25m\nOwogICAgICAgIGRpY3QgPSB0aGlzLmNvbmYuZ2V0REJEaWN0aW9uYXJ5SW5z\ndGFuY2UoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENvbmZpZ3Vy\nYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29uZmlndXJh\ndGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBmbHVzaChD\nb2xsZWN0aW9uIHN0YXRlcywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAg\nQ29ubmVjdGlvbiBjb25uID0gc3RvcmUuZ2V0Q29ubmVjdGlvbigpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50TWFuYWdl\nciBwc01nciA9IG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlcihzdG9yZSwK\nICAgICAgICAgICAgICAgIGNvbm4pOwogICAgICAgICAgICByZXR1cm4gZmx1\nc2goc3RhdGVzLCBzdG9yZSwgcHNNZ3IpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlKSB7fQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIENvbGxlY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBzdGF0ZXMsIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXIgcHNN\nZ3IpIHsKICAgICAgICAvLyBydW4gdGhyb3VnaCBhbGwgdGhlIHN0YXRlcyBh\nbmQgdXBkYXRlIHRoZW0gYXMgbmVjZXNzYXJ5CiAgICAgICAgUm93TWFuYWdl\nciByb3dNZ3IgPSBuZXdSb3dNYW5hZ2VyKCk7CiAgICAgICAgQ29sbGVjdGlv\nbiBjdXN0b21zID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBDb2xsZWN0\naW9uIGV4Y2VwcyA9IHBzTWdyLmdldEV4Y2VwdGlvbnMoKTsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHN0YXRlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgZXhjZXBzID0gcG9wdWxhdGVSb3dNYW5h\nZ2VyKChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpdHIubmV4dCgpLAogICAgICAg\nICAgICAgICAgcm93TWdyLCBzdG9yZSwgZXhjZXBzLCBjdXN0b21zKTsKCiAg\nICAgICAgLy8gZmx1c2ggcm93cwogICAgICAgIGV4Y2VwcyA9IGZsdXNoKHJv\nd01nciwgcHNNZ3IsIGV4Y2Vwcyk7CgogICAgICAgIC8vIG5vdyBkbyBhbnkg\nY3VzdG9tIG1hcHBpbmdzCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBj\ndXN0b21zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAoKEN1c3RvbU1hcHBpbmcpIGl0\nci5uZXh0KCkpLmV4ZWN1dGUoc3RvcmUpOwogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9\nIGFkZEV4Y2VwdGlvbihleGNlcHMsIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUo\nc2UsIGRpY3QpKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkRXhjZXB0\naW9uKGV4Y2Vwcywga2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyByZXR1cm4gYWxsIGV4Y2VwdGlvbnMKICAgICAgICByZXR1cm4g\nZXhjZXBzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3IHtA\nbGluayBSb3dNYW5hZ2VyfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IFJvd01hbmFnZXIgbmV3Um93TWFuYWdlcigpOwoKICAgIC8qKgogICAg\nICogUmV0dXJuIGEgbmV3IHtAbGluayBQcmVwYXJlZFN0YXRlbWVudE1hbmFn\nZXJ9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgUHJlcGFyZWRT\ndGF0ZW1lbnRNYW5hZ2VyIG5ld1ByZXBhcmVkU3RhdGVtZW50TWFuYWdlcigK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUsIENvbm5lY3Rpb24gY29ubik7Cgog\nICAgLyoqCiAgICAgKiBGbHVzaCBhbGwgcm93cyBvZiB0aGUgZ2l2ZW4gcm93\nIG1hbmFnZXIuIEFkZCBleGNlcHRpb25zIHRvCiAgICAgKiA8Y29kZT5leGNl\ncHM8L2NvZGU+ICh3aGljaCBtYXkgc3RhcnQgYXMgbnVsbCkgdXNpbmcKICAg\nICAqIHtAbGluayAjYWRkRXhjZXB0aW9ufS4gUmV0dXJuIDxjb2RlPmV4Y2Vw\nczwvY29kZT4uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBDb2xs\nZWN0aW9uIGZsdXNoKFJvd01hbmFnZXIgcm93TWdyLAogICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50TWFuYWdlciBwc01nciwgQ29sbGVjdGlvbiBleGNlcHMp\nOwoKICAgIC8qKgogICAgICogUG9wdWxhdGUgdGhlIHJvdyBtYW5hZ2VyIHdp\ndGggcm93cyB0byBiZSBmbHVzaGVkIGZvciB0aGUgZ2l2ZW4gc3RhdGUuCiAg\nICAgKgogICAgICogQHBhcmFtIGV4Y2VwcyBleGNlcHRpb25zIGVuY291bnRl\ncmVkIHdoZW4gZmx1c2hpbmcgd2lsbCBiZSBhZGRlZCB0bwogICAgICogdGhp\ncyBsaXN0IGFuZCByZXR1cm5lZDsgdGhlIGxpc3QgbWF5IGJlIG51bGwgaW5p\ndGlhbGx5CiAgICAgKiBAcGFyYW0gY3VzdG9tcyBidWZmZXIgY3VzdG9tIG1h\ncHBpbmdzCiAgICAgKiBAcmV0dXJuIHRoZSBleGNlcHRpb25zIGxpc3QKICAg\nICAqLwogICAgcHJvdGVjdGVkIENvbGxlY3Rpb24gcG9wdWxhdGVSb3dNYW5h\nZ2VyKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgUm93TWFuYWdl\nciByb3dNZ3IsIEpEQkNTdG9yZSBzdG9yZSwgQ29sbGVjdGlvbiBleGNlcHMs\nCiAgICAgICAgQ29sbGVjdGlvbiBjdXN0b21zKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgQml0U2V0IGRpcnR5OwogICAgICAgICAgICBpZiAoc20u\nZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuUE5FVyAmJiAhc20uaXNGbHVzaGVk\nKCkpIHsKICAgICAgICAgICAgICAgIGluc2VydChzbSwgKENsYXNzTWFwcGlu\nZykgc20uZ2V0TWV0YURhdGEoKSwgcm93TWdyLCBzdG9yZSwKICAgICAgICAg\nICAgICAgICAgICBjdXN0b21zKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChz\nbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QTkVXRkxVU0hFRERFTEVURUQK\nICAgICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRl\nLlBERUxFVEVEKSB7CiAgICAgICAgICAgICAgICBkZWxldGUoc20sIChDbGFz\nc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCksIHJvd01nciwgc3RvcmUsCiAg\nICAgICAgICAgICAgICAgICAgY3VzdG9tcyk7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoKGRpcnR5ID0gSW1wbEhlbHBlci5nZXRVcGRhdGVGaWVsZHMoc20p\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB1cGRhdGUoc20sIGRpcnR5\nLCAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpLCByb3dNZ3IsCiAg\nICAgICAgICAgICAgICAgICAgc3RvcmUsIGN1c3RvbXMsIGZhbHNlKTsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChzbS5pc1ZlcnNpb25VcGRhdGVSZXF1aXJl\nZCgpKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVJbmRpY2F0b3JzKHNtLCAo\nQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpLCByb3dNZ3IsCiAgICAg\nICAgICAgICAgICAgICAgc3RvcmUsIGN1c3RvbXMsIHRydWUpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHNtLmlzVmVyc2lvbkNoZWNrUmVxdWlyZWQoKSkg\newogICAgICAgICAgICAgICAgaWYgKCEoKENsYXNzTWFwcGluZykgc20uZ2V0\nTWV0YURhdGEoKSkuZ2V0VmVyc2lvbigpLgogICAgICAgICAgICAgICAgICAg\nIGNoZWNrVmVyc2lvbihzbSwgc3RvcmUsIGZhbHNlKSkKICAgICAgICAgICAg\nICAgICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBuZXcgT3B0\naW1pc3RpY0V4Y2VwdGlvbihzbS4KICAgICAgICAgICAgICAgICAgICAgICAg\nZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICBleGNl\ncHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBTUUxFeGNlcHRpb25zLmdldFN0\nb3JlKHNlLCBkaWN0KSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24o\nZXhjZXBzLCBrZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGNlcHM7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGV4Y2VwdGlv\nbiB0byB0aGUgZ2l2ZW4gbGlzdCwgd2hpY2ggbWF5IHN0YXJ0IG91dCBhcyBu\ndWxsLgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBhZGRFeGNl\ncHRpb24oQ29sbGVjdGlvbiBleGNlcHMsIEV4Y2VwdGlvbiBlcnIpIHsKICAg\nICAgICBpZiAoZXhjZXBzID09IG51bGwpCiAgICAgICAgICAgIGV4Y2VwcyA9\nIG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgZXhjZXBzLmFkZChlcnIpOwog\nICAgICAgIHJldHVybiBleGNlcHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWN1cnNpdmUgbWV0aG9kIHRvIGluc2VydCB0aGUgZ2l2ZW4gaW5zdGFuY2Us\nIGJhc2UgY2xhc3MgZmlyc3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lk\nIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBDbGFzc01hcHBpbmcg\nbWFwcGluZywKICAgICAgICBSb3dNYW5hZ2VyIHJvd01nciwgSkRCQ1N0b3Jl\nIHN0b3JlLCBDb2xsZWN0aW9uIGN1c3RvbXMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgQm9vbGVhbiBjdXN0b20gPSBtYXBwaW5n\nLmlzQ3VzdG9tSW5zZXJ0KHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKCFCb29s\nZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAgICAgICBtYXBwaW5n\nLmN1c3RvbUluc2VydChzbSwgc3RvcmUpOwogICAgICAgIGlmIChCb29sZWFu\nLlRSVUUuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgQ2xhc3NNYXBwaW5nIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQ\nQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxs\nKQogICAgICAgICAgICBpbnNlcnQoc20sIHN1cCwgcm93TWdyLCBzdG9yZSwg\nY3VzdG9tcyk7CgogICAgICAgIG1hcHBpbmcuaW5zZXJ0KHNtLCBzdG9yZSwg\ncm93TWdyKTsKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmaWVsZHMgPSBtYXBw\naW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgQml0U2V0\nIGRpcnR5ID0gc20uZ2V0RGlydHkoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAo\nZGlydHkuZ2V0KGZpZWxkc1tpXS5nZXRJbmRleCgpKQogICAgICAgICAgICAg\nICAgJiYgIWJ1ZmZlckN1c3RvbUluc2VydChmaWVsZHNbaV0sIHNtLCBzdG9y\nZSwgY3VzdG9tcykpIHsKICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5pbnNl\ncnQoc20sIHN0b3JlLCByb3dNZ3IpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGlmIChzdXAgPT0gbnVsbCkgewogICAgICAgICAgICBWZXJz\naW9uIHZlcnMgPSBtYXBwaW5nLmdldFZlcnNpb24oKTsKICAgICAgICAgICAg\naWYgKCFidWZmZXJDdXN0b21JbnNlcnQodmVycywgc20sIHN0b3JlLCBjdXN0\nb21zKSkKICAgICAgICAgICAgICAgIHZlcnMuaW5zZXJ0KHNtLCBzdG9yZSwg\ncm93TWdyKTsKICAgICAgICAgICAgRGlzY3JpbWluYXRvciBkc2MgPSBtYXBw\naW5nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICAgICAgaWYgKCFidWZm\nZXJDdXN0b21JbnNlcnQoZHNjLCBzbSwgc3RvcmUsIGN1c3RvbXMpKQogICAg\nICAgICAgICAgICAgZHNjLmluc2VydChzbSwgc3RvcmUsIHJvd01ncik7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgdGhlIGdpdmVuIG1h\ncHBpbmcgdXNlcyBhIGN1c3RvbSBpbnNlcnQsIHBsYWNlcyBhCiAgICAgKiB7\nQGxpbmsgQ3VzdG9tTWFwcGluZ30gc3RydWN0IGZvciBpdCBpbiB0aGUgZ2l2\nZW4gY29sbGVjdGlvbiBhbmQKICAgICAqIHJldHVybnMgdHJ1ZSwgZWxzZSBy\nZXR1cm5zIGZhbHNlLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gYnVm\nZmVyQ3VzdG9tSW5zZXJ0KFN0cmF0ZWd5IHN0cmF0LCBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgQ29sbGVjdGlv\nbiBjdXN0b21zKSB7CiAgICAgICAgQm9vbGVhbiBjdXN0b20gPSBzdHJhdC5p\nc0N1c3RvbUluc2VydChzbSwgc3RvcmUpOwogICAgICAgIGlmICghQm9vbGVh\nbi5GQUxTRS5lcXVhbHMoY3VzdG9tKSkKICAgICAgICAgICAgY3VzdG9tcy5h\nZGQobmV3IEN1c3RvbU1hcHBpbmcoQ3VzdG9tTWFwcGluZy5JTlNFUlQsIHNt\nLCBzdHJhdCkpOwogICAgICAgIHJldHVybiBCb29sZWFuLlRSVUUuZXF1YWxz\nKGN1c3RvbSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgbWV0\naG9kIHRvIGRlbGV0ZSB0aGUgZ2l2ZW4gaW5zdGFuY2UsIGJhc2UgY2xhc3Mg\nbGFzdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZGVsZXRlKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAg\nICAgIFJvd01hbmFnZXIgcm93TWdyLCBKREJDU3RvcmUgc3RvcmUsIENvbGxl\nY3Rpb24gY3VzdG9tcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBCb29sZWFuIGN1c3RvbSA9IG1hcHBpbmcuaXNDdXN0b21EZWxl\ndGUoc20sIHN0b3JlKTsKICAgICAgICBpZiAoIUJvb2xlYW4uRkFMU0UuZXF1\nYWxzKGN1c3RvbSkpCiAgICAgICAgICAgIG1hcHBpbmcuY3VzdG9tRGVsZXRl\nKHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMo\nY3VzdG9tKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1h\ncHBpbmdbXSBmaWVsZHMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBp\nbmdzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tRGVsZXRl\nKGZpZWxkc1tpXSwgc20sIHN0b3JlLCBjdXN0b21zKSkKICAgICAgICAgICAg\nICAgIGZpZWxkc1tpXS5kZWxldGUoc20sIHN0b3JlLCByb3dNZ3IpOwoKICAg\nICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRKb2luYWJsZVBD\nU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBpZiAoc3VwID09IG51bGwp\nIHsKICAgICAgICAgICAgVmVyc2lvbiB2ZXJzID0gbWFwcGluZy5nZXRWZXJz\naW9uKCk7CiAgICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tRGVsZXRlKHZl\ncnMsIHNtLCBzdG9yZSwgY3VzdG9tcykpCiAgICAgICAgICAgICAgICB2ZXJz\nLmRlbGV0ZShzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAgICAgIERpc2Ny\naW1pbmF0b3IgZHNjID0gbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCk7CiAg\nICAgICAgICAgIGlmICghYnVmZmVyQ3VzdG9tRGVsZXRlKGRzYywgc20sIHN0\nb3JlLCBjdXN0b21zKSkKICAgICAgICAgICAgICAgIGRzYy5kZWxldGUoc20s\nIHN0b3JlLCByb3dNZ3IpOwogICAgICAgIH0KICAgICAgICBtYXBwaW5nLmRl\nbGV0ZShzbSwgc3RvcmUsIHJvd01ncik7CgogICAgICAgIGlmIChzdXAgIT0g\nbnVsbCkKICAgICAgICAgICAgZGVsZXRlKHNtLCBzdXAsIHJvd01nciwgc3Rv\ncmUsIGN1c3RvbXMpOwogICAgfQoKICAgIC8qKgogICAgICogQHNlZSAjYnVm\nZmVyQ3VzdG9tSW5zZXJ0CiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBi\ndWZmZXJDdXN0b21EZWxldGUoU3RyYXRlZ3kgc3RyYXQsIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBDb2xsZWN0\naW9uIGN1c3RvbXMpIHsKICAgICAgICBCb29sZWFuIGN1c3RvbSA9IHN0cmF0\nLmlzQ3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICAgICAgaWYgKCFCb29s\nZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAgICAgICBjdXN0b21z\nLmFkZChuZXcgQ3VzdG9tTWFwcGluZyhDdXN0b21NYXBwaW5nLkRFTEVURSwg\nc20sIHN0cmF0KSk7CiAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRS5lcXVh\nbHMoY3VzdG9tKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBt\nZXRob2QgdG8gdXBkYXRlIHRoZSBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgdXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEJpdFNldCBkaXJ0eSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGlu\nZywgUm93TWFuYWdlciByb3dNZ3IsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAg\nICBDb2xsZWN0aW9uIGN1c3RvbXMsIGJvb2xlYW4gdXBkYXRlSW5kaWNhdG9y\ncykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQm9vbGVhbiBjdXN0\nb20gPSBtYXBwaW5nLmlzQ3VzdG9tVXBkYXRlKHNtLCBzdG9yZSk7CiAgICAg\nICAgaWYgKCFCb29sZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAg\nICAgICBtYXBwaW5nLmN1c3RvbVVwZGF0ZShzbSwgc3RvcmUpOwogICAgICAg\nIGlmIChCb29sZWFuLlRSVUUuZXF1YWxzKGN1c3RvbSkpCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgLy8gdXBkYXRlIGFsbCBmaWVsZHMgYmVmb3Jl\nIGFsbCBtYXBwaW5ncyBzbyB0aGF0IHRoZSBtYXBwaW5ncyBjYW4KICAgICAg\nICAvLyBkZXRlY3Qgd2hldGhlciBhbnkgZmllbGRzIGluIHRoZWlyIHJvd3Mg\naGF2ZSBiZWVuIG1vZGlmaWVkCiAgICAgICAgRmllbGRNYXBwaW5nW10gZmll\nbGRzID0gbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmaWVsZCA9IGZpZWxkc1tpXTsK\nICAgICAgICAgICAgaWYgKGRpcnR5LmdldChmaWVsZC5nZXRJbmRleCgpKQog\nICAgICAgICAgICAgICAgJiYgIWJ1ZmZlckN1c3RvbVVwZGF0ZShmaWVsZCwg\nc20sIHN0b3JlLCBjdXN0b21zKSkgewogICAgICAgICAgICAgICAgZmllbGQu\ndXBkYXRlKHNtLCBzdG9yZSwgcm93TWdyKTsKICAgICAgICAgICAgICAgIGlm\nICghdXBkYXRlSW5kaWNhdG9ycykgewogICAgICAgICAgICAgICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGludmVyc2VGaWVsZE1hcHBpbmdzID0KICAgICAgICAg\nICAgICAgICAgICAgICAgZmllbGQuZ2V0SW52ZXJzZU1hcHBpbmdzKCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGludmVyc2VGaWVsZE1hcHBpbmdzLmxl\nbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUlu\nZGljYXRvcnMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nZm9yIChGaWVsZE1hcHBpbmcgaW52ZXJzZUZpZWxkTWFwcGluZyA6CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpbnZlcnNlRmllbGRNYXBwaW5ncykg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludmVyc2VGaWVs\nZE1hcHBpbmcuZ2V0TWFwcGVkQnkoKSAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdXBkYXRlSW5kaWNhdG9ycyA9IHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIENsYXNzTWFwcGlu\nZyBzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpOwogICAgICAgIGlmIChzdXAgPT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAodXBkYXRlSW5kaWNhdG9ycykgewogICAgICAgICAgICAgICAgdXBkYXRl\nSW5kaWNhdG9ycyhzbSwgbWFwcGluZywgcm93TWdyLCBzdG9yZSwgY3VzdG9t\ncywgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVs\nc2UKICAgICAgICAgICAgdXBkYXRlKHNtLCBkaXJ0eSwgc3VwLCByb3dNZ3Is\nIHN0b3JlLCBjdXN0b21zLCB1cGRhdGVJbmRpY2F0b3JzKTsKCiAgICAgICAg\nbWFwcGluZy51cGRhdGUoc20sIHN0b3JlLCByb3dNZ3IpOwogICAgfQoKICAg\nIC8qKgogICAgICogVXBkYXRlIHZlcnNpb24gYW5kIGRpc2NyaW1pbmF0b3Ig\naW5kaWNhdG9ycy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgdXBkYXRl\nSW5kaWNhdG9ycyhPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBDbGFzc01hcHBp\nbmcgbWFwcGluZywKICAgICAgICBSb3dNYW5hZ2VyIHJvd01nciwgSkRCQ1N0\nb3JlIHN0b3JlLCBDb2xsZWN0aW9uIGN1c3RvbXMsCiAgICAgICAgYm9vbGVh\nbiB2ZXJzaW9uVXBkYXRlT25seSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgd2hpbGUgKG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CgogICAgICAg\nIFZlcnNpb24gdmVycyA9IG1hcHBpbmcuZ2V0VmVyc2lvbigpOwogICAgICAg\nIGlmICghYnVmZmVyQ3VzdG9tVXBkYXRlKHZlcnMsIHNtLCBzdG9yZSwgY3Vz\ndG9tcykpCiAgICAgICAgICAgIHZlcnMudXBkYXRlKHNtLCBzdG9yZSwgcm93\nTWdyKTsKCiAgICAgICAgaWYgKHZlcnNpb25VcGRhdGVPbmx5KSB7CiAgICAg\nICAgICAgIC8vIGlmIHdlIGFyZSBvbmx5IHVwZGF0aW5nIHRoZSB2ZXJzaW9u\nIGNvbHVtbiwgd2UgbmVlZCB0byBhZGQKICAgICAgICAgICAgLy8gaW4gdGhl\nIHByaW1hcnkga2V5IHNlbGVjdAogICAgICAgICAgICBtYXBwaW5nLnVwZGF0\nZShzbSwgc3RvcmUsIHJvd01ncik7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgLy8gb3RoZXJ3aXNlIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHdlIHVw\nZGF0ZSB0aGUgZGlzY3JpbWluYXRvciB0b28KICAgICAgICAgICAgRGlzY3Jp\nbWluYXRvciBkc2MgPSBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKTsKICAg\nICAgICAgICAgaWYgKCFidWZmZXJDdXN0b21VcGRhdGUoZHNjLCBzbSwgc3Rv\ncmUsIGN1c3RvbXMpKQogICAgICAgICAgICAgICAgZHNjLnVwZGF0ZShzbSwg\nc3RvcmUsIHJvd01ncik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQHNlZSAjYnVmZmVyQ3VzdG9tSW5zZXJ0CiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBidWZmZXJDdXN0b21VcGRhdGUoU3RyYXRlZ3kgc3RyYXQs\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0\nb3JlLCBDb2xsZWN0aW9uIGN1c3RvbXMpIHsKICAgICAgICBCb29sZWFuIGN1\nc3RvbSA9IHN0cmF0LmlzQ3VzdG9tVXBkYXRlKHNtLCBzdG9yZSk7CiAgICAg\nICAgaWYgKCFCb29sZWFuLkZBTFNFLmVxdWFscyhjdXN0b20pKQogICAgICAg\nICAgICBjdXN0b21zLmFkZChuZXcgQ3VzdG9tTWFwcGluZyhDdXN0b21NYXBw\naW5nLlVQREFURSwgc20sIHN0cmF0KSk7CiAgICAgICAgcmV0dXJuIEJvb2xl\nYW4uVFJVRS5lcXVhbHMoY3VzdG9tKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEV4ZWN1dGVzIGN1c3RvbWl6ZWQgbWFwcGluZyB1cGRhdGVzLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIEN1c3RvbU1hcHBpbmcgewoK\nICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJTlNFUlQgPSAwOwog\nICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFVQREFURSA9IDE7CiAg\nICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgREVMRVRFID0gMzsKCiAg\nICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2FjdGlvbjsKICAgICAgICBwcml2\nYXRlIGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgX3NtOwogICAgICAgIHBy\naXZhdGUgZmluYWwgU3RyYXRlZ3kgX3N0cmF0OwoKICAgICAgICBwdWJsaWMg\nQ3VzdG9tTWFwcGluZyhpbnQgYWN0aW9uLCBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBTdHJhdGVneSBzdHJhdCkgewogICAgICAgICAgICBfYWN0aW9uID0g\nYWN0aW9uOwogICAgICAgICAgICBfc20gPSBzbTsKICAgICAgICAgICAgX3N0\ncmF0ID0gc3RyYXQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBl\neGVjdXRlKEpEQkNTdG9yZSBzdG9yZSkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHN3aXRjaCAoX2FjdGlvbikgewogICAgICAgICAgICBj\nYXNlIElOU0VSVDoKICAgICAgICAgICAgICAgIF9zdHJhdC5jdXN0b21JbnNl\ncnQoX3NtLCBzdG9yZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBVUERBVEU6CiAgICAgICAgICAgICAgICBfc3RyYXQuY3Vz\ndG9tVXBkYXRlKF9zbSwgc3RvcmUpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgREVMRVRFOgogICAgICAgICAgICAgICAgX3N0\ncmF0LmN1c3RvbURlbGV0ZShfc20sIHN0b3JlKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

