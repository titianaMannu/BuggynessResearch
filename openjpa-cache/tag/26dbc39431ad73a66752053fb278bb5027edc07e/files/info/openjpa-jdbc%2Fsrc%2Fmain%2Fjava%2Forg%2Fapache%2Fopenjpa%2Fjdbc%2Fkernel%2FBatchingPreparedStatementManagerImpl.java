{"sha":"ba25c0d8de89f44f9a1bcd6b8a84756926e95a4b","node_id":"MDQ6QmxvYjIwNjM2NDpiYTI1YzBkOGRlODlmNDRmOWExYmNkNmI4YTg0NzU2OTI2ZTk1YTRi","size":12622,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ba25c0d8de89f44f9a1bcd6b8a84756926e95a4b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuU3RhdGVtZW50OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlJvd0ltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuU1FMRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRpbWlzdGljRXhjZXB0aW9uOwoKLyoq\nCiAqIEJhdGNoIHByZXBhcmVkIHN0YXRlbWVudCBtYW5hZ2VyIGltcGxlbWVu\ndGF0aW9uLiBUaGlzIHByZXBhcmVkIHN0YXRlbWVudAogKiBtYW5hZ2VyIHdp\nbGwgdXRpbGl6ZSB0aGUgSkRCQyBhZGRCYXRjaCgpIGFuZCBleGNldXRlQmF0\nY2goKSB0byBiYXRjaCB0aGUgU1FMCiAqIHN0YXRlbWVudHMgdG9nZXRoZXIg\ndG8gaW1wcm92ZSB0aGUgZXhlY3V0aW9uIHBlcmZvcm1hbmNlLgogKiAKICog\nQGF1dGhvciBUZXJlc2EgS2FuCiAqLwoKcHVibGljIGNsYXNzIEJhdGNoaW5n\nUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VySW1wbCBleHRlbmRzCiAgICAgICAg\nUHJlcGFyZWRTdGF0ZW1lbnRNYW5hZ2VySW1wbCB7CgogICAgcHJpdmF0ZSBm\naW5hbCBzdGF0aWMgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIKICAgICAg\nICAgICAgLmZvclBhY2thZ2UoQmF0Y2hpbmdQcmVwYXJlZFN0YXRlbWVudE1h\nbmFnZXJJbXBsLmNsYXNzKTsKCiAgICBwcml2YXRlIFN0cmluZyBfYmF0Y2hl\nZFNxbCA9IG51bGw7CiAgICBwcml2YXRlIExpc3QgX2JhdGNoZWRSb3dzID0g\nbmV3IEFycmF5TGlzdCgpOwogICAgcHJpdmF0ZSBpbnQgX2JhdGNoTGltaXQ7\nCiAgICBwcml2YXRlIGJvb2xlYW4gX2Rpc2FibGVCYXRjaCA9IGZhbHNlOwog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgTG9nIF9sb2cgPSBudWxsOwoKICAgIC8q\nKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25uZWN0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgQmF0Y2hpbmdQcmVwYXJlZFN0YXRlbWVudE1hbmFn\nZXJJbXBsKEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBDb25uZWN0aW9uIGNv\nbm4sIGludCBiYXRjaExpbWl0KSB7CiAgICAgICAgc3VwZXIoc3RvcmUsIGNv\nbm4pOwogICAgICAgIF9iYXRjaExpbWl0ID0gYmF0Y2hMaW1pdDsKICAgICAg\nICBfbG9nID0gc3RvcmUuZ2V0Q29uZmlndXJhdGlvbigpLmdldExvZyhKREJD\nQ29uZmlndXJhdGlvbi5MT0dfSkRCQyk7CiAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdl\ndCgiYmF0Y2hfbGltaXQiLCBTdHJpbmcudmFsdWVPZihfYmF0Y2hMaW1pdCkp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIHRoZSBnaXZlbiByb3cg\naW1tZWRpYXRlbHkgb3IgZGVmZXJyZWQgdGhlIGZsdXNoIGluIGJhdGNoLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBmbHVzaEFuZFVwZGF0ZShSb3dJ\nbXBsIHJvdykgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGlz\nQmF0Y2hEaXNhYmxlZChyb3cpKSB7CiAgICAgICAgICAgIC8vIGlmIHRoZXJl\nIHdlcmUgc29tZSBzdGF0ZW1lbnRzIGJhdGNoZWQgYmVmb3JlLCB0aGVuCiAg\nICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZmx1c2ggdGhlbSBvdXQgZmlyc3Qg\nYmVmb3JlIHByb2Nlc3NpbmcgdGhlCiAgICAgICAgICAgIC8vIGN1cnJlbnQg\nbm9uIGJhdGNoIHByb2Nlc3MuCiAgICAgICAgICAgIGZsdXNoQmF0Y2goKTsK\nCiAgICAgICAgICAgIHN1cGVyLmZsdXNoQW5kVXBkYXRlKHJvdyk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcHJvY2VzcyB0aGUgU1FMIHN0\nYXRlbWVudCwgZWl0aGVyIGV4ZWN1dGUgaXQgaW1tZWRpYXRlbHkgb3IKICAg\nICAgICAgICAgLy8gYmF0Y2ggaXQgZm9yIGxhdGVyIGV4ZWN1dGlvbi4KICAg\nICAgICAgICAgYmF0Y2hPckV4ZWN1dGVSb3cocm93KTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYmF0Y2hPckV4ZWN1dGVSb3coUm93\nSW1wbCByb3cpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmlu\nZyBzcWwgPSByb3cuZ2V0U1FMKF9kaWN0KTsKICAgICAgICBpZiAoX2JhdGNo\nZWRTcWwgPT0gbnVsbCkgewogICAgICAgICAgICAvLyBicmFuZCBuZXcgU1FM\nCiAgICAgICAgICAgIF9iYXRjaGVkU3FsID0gc3FsOwogICAgICAgIH0gZWxz\nZSBpZiAoIXNxbC5lcXVhbHMoX2JhdGNoZWRTcWwpKSB7CiAgICAgICAgICAg\nIC8vIFNRTCBzdGF0ZW1lbnRzIGNoYW5nZWQuCiAgICAgICAgICAgIHN3aXRj\naCAoX2JhdGNoZWRSb3dzLnNpemUoKSkgewogICAgICAgICAgICBjYXNlIDA6\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgog\nICAgICAgICAgICAgICAgLy8gc2luZ2xlIGVudHJ5IGluIGNhY2hlLCBkaXJl\nY3QgU1FMIGV4ZWN1dGlvbi4gCiAgICAgICAgICAgICAgICBzdXBlci5mbHVz\naEFuZFVwZGF0ZSgoUm93SW1wbCkgX2JhdGNoZWRSb3dzLmdldCgwKSk7CiAg\nICAgICAgICAgICAgICBfYmF0Y2hlZFJvd3MuY2xlYXIoKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgLy8gZmx1c2ggYWxsIGVudHJpZXMgaW4gY2FjaGUgaW4gYmF0Y2gu\nCiAgICAgICAgICAgICAgICBmbHVzaEJhdGNoKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgX2JhdGNoZWRTcWwgPSBzcWw7CiAgICAgICAgfQogICAg\nICAgIF9iYXRjaGVkUm93cy5hZGQocm93KTsKICAgIH0KCiAgICAvKgogICAg\nICogQ29tcHV0ZSBpZiBiYXRjaGluZyBpcyBkaXNhYmxlZCwgYmFzZWQgb24g\ndmFsdWVzIG9mIGJhdGNoIGxpbWl0CiAgICAgKiBhbmQgZGF0YWJhc2UgY2hh\ncmFjdGVyaXN0aWNzLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNC\nYXRjaERpc2FibGVkKFJvd0ltcGwgcm93KSB7CiAgICAgICAgYm9vbGVhbiBy\ndG5WYWwgPSB0cnVlOwogICAgICAgIGludCBsaW1pdCA9IGdldEJhdGNoTGlt\naXQoKTsKICAgICAgICBpZiAoKGxpbWl0IDwgMCB8fCBsaW1pdCA+IDEpICYm\nICFpc0JhdGNoRGlzYWJsZWQoKSkgewogICAgICAgICAgICBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtID0gcm93LmdldFByaW1hcnlLZXkoKTsKICAgICAgICAg\nICAgQ2xhc3NNYXBwaW5nIGNtZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChz\nbSAhPSBudWxsKQogICAgICAgICAgICAgICAgY21kID0gKENsYXNzTWFwcGlu\nZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgQ29sdW1uW10gYXV0\nb0Fzc2lnbiA9IG51bGw7CiAgICAgICAgICAgIGlmIChyb3cuZ2V0QWN0aW9u\nKCkgPT0gUm93LkFDVElPTl9JTlNFUlQpCiAgICAgICAgICAgICAgICBhdXRv\nQXNzaWduID0gcm93LmdldFRhYmxlKCkuZ2V0QXV0b0Fzc2lnbmVkQ29sdW1u\ncygpOwogICAgICAgICAgICAvLyB2YWxpZGF0ZSBiYXRjaCBjYXBhYmlsaXR5\nCiAgICAgICAgICAgIHJ0blZhbCA9IF9kaWN0CiAgICAgICAgICAgICAgICAu\ndmFsaWRhdGVCYXRjaFByb2Nlc3Mocm93LCBhdXRvQXNzaWduLCBzbSwgY21k\nKTsKICAgICAgICAgICAgc2V0QmF0Y2hEaXNhYmxlZChydG5WYWwpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcnRuVmFsOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIGZsdXNoIGFsbCBjYWNoZWQgdXAgc3RhdGVtZW50cyB0byBi\nZSBleGVjdXRlZCBhcyBhIHNpbmdsZSBvciBiYXRjaGVkCiAgICAgKiBwcmVw\nYXJlZCBzdGF0ZW1lbnRzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBm\nbHVzaEJhdGNoKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgTGlz\ndCBiYXRjaGVkUm93cyA9IGdldEJhdGNoZWRSb3dzKCk7CiAgICAgICAgU3Ry\naW5nIGJhdGNoZWRTcWwgPSBnZXRCYXRjaGVkU3FsKCk7CiAgICAgICAgaWYg\nKGJhdGNoZWRSb3dzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgaW50IGJhdGNoU2l6ZSA9IGJhdGNoZWRSb3dzLnNpemUoKTsKICAg\nICAgICBpZiAoYmF0Y2hlZFNxbCAhPSBudWxsICYmICBiYXRjaFNpemUgPiAw\nKSB7CiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHBzID0gbnVsbDsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFJvd0ltcGwgb25l\ncm93ID0gbnVsbDsKICAgICAgICAgICAgICAgIHBzID0gcHJlcGFyZVN0YXRl\nbWVudChiYXRjaGVkU3FsKTsKICAgICAgICAgICAgICAgIGlmIChiYXRjaFNp\nemUgPT0gMSkgewogICAgICAgICAgICAgICAgICAgIC8vIGV4ZWN1dGUgYSBz\naW5nbGUgcm93LgogICAgICAgICAgICAgICAgICAgIG9uZXJvdyA9IChSb3dJ\nbXBsKSBiYXRjaGVkUm93cy5nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAg\nZmx1c2hTaW5nbGVSb3cob25lcm93LCBwcyk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGNhY2hlIGhhcyBtb3Jl\nIHRoYW4gb25lIHJvd3MsIGV4ZWN1dGUgYXMgYmF0Y2guCiAgICAgICAgICAg\nICAgICAgICAgaW50IGNvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICBp\nbnQgYmF0Y2hlZFJvd3NCYXNlSW5kZXggPSAwOwogICAgICAgICAgICAgICAg\nICAgIEl0ZXJhdG9yIGl0ciA9IGJhdGNoZWRSb3dzLml0ZXJhdG9yKCk7CiAg\nICAgICAgICAgICAgICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgb25lcm93ID0gKFJvd0ltcGwpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfYmF0Y2hMaW1p\ndCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaFNp\nbmdsZVJvdyhvbmVyb3csIHBzKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3Vu\ndCA8IF9iYXRjaExpbWl0IHx8IF9iYXRjaExpbWl0ID09IC0xKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZXJvdy5mbHVz\naChwcywgX2RpY3QsIF9zdG9yZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYWRkQmF0Y2gocHMsIG9uZXJvdywgY291bnQpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHJlYWNoIHRoZSBiYXRjaExpbWl0LCBleGVjdXRl\nIHRoZSBiYXRjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlu\ndFtdIHJ0biA9IGV4ZWN1dGVCYXRjaChwcyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY2hlY2tVcGRhdGVDb3VudChydG4sIGJhdGNoZWRS\nb3dzQmFzZUluZGV4LCBwcyk7CgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGJhdGNoZWRSb3dzQmFzZUluZGV4ICs9IF9iYXRjaExpbWl0OwoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lcm93\nLmZsdXNoKHBzLCBfZGljdCwgX3N0b3JlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhZGRCYXRjaChwcywgb25lcm93LCBjb3VudCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgdGhlIGNv\ndW50IHRvIDEgZm9yIG5ldyBiYXRjaAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvdW50ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbmQgb2YgdGhlIGxv\nb3AsIGV4ZWN1dGUgdGhlIGJhdGNoCiAgICAgICAgICAgICAgICAgICAgaW50\nW10gcnRuID0gZXhlY3V0ZUJhdGNoKHBzKTsKICAgICAgICAgICAgICAgICAg\nICBjaGVja1VwZGF0ZUNvdW50KHJ0biwgYmF0Y2hlZFJvd3NCYXNlSW5kZXgs\nIHBzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICBTUUxFeGNlcHRp\nb24gc3FleCA9IHNlLmdldE5leHRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nICAgIGlmIChzcWV4ID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc3Fl\neCA9IHNlOwogICAgICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzcWV4LCBwcywgX2RpY3QpOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgX2JhdGNoZWRTcWwgPSBudWxsOwogICAg\nICAgICAgICAgICAgYmF0Y2hlZFJvd3MuY2xlYXIoKTsKICAgICAgICAgICAg\nICAgIGlmIChwcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHMuY2xvc2UoKTsKICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FleCkgewog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdl\ndFN0b3JlKHNxZXgsIHBzLCBfZGljdCk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qCiAgICAgKiBFeGVjdXRlIGFuIHVwZGF0ZSBvZiBhIHNp\nbmdsZSByb3cuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBmbHVzaFNpbmds\nZVJvdyhSb3dJbXBsIHJvdywgUHJlcGFyZWRTdGF0ZW1lbnQgcHMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHBzICE9IG51\nbGwpCiAgICAgICAgICAgIHJvdy5mbHVzaChwcywgX2RpY3QsIF9zdG9yZSk7\nCiAgICAgICAgaW50IGNvdW50ID0gZXhlY3V0ZVVwZGF0ZShwcywgcm93Lmdl\ndFNRTChfZGljdCksIHJvdyk7CiAgICAgICAgaWYgKGNvdW50ICE9IDEpIHsK\nICAgICAgICAgICAgT2JqZWN0IGZhaWxlZCA9IHJvdy5nZXRGYWlsZWRPYmpl\nY3QoKTsKICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2V4Y2VwdGlvbnMuYWRkKG5ldyBPcHRpbWlzdGljRXhjZXB0\naW9uKGZhaWxlZCkpOwogICAgICAgICAgICBlbHNlIGlmIChyb3cuZ2V0QWN0\naW9uKCkgPT0gUm93LkFDVElPTl9JTlNFUlQpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgU1FMRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1cGRhdGUtZmFpbGVk\nLW5vLWZhaWxlZC1vYmoiLAogICAgICAgICAgICAgICAgICAgIFN0cmluZy52\nYWx1ZU9mKGNvdW50KSwgcm93LmdldFNRTChfZGljdCkpLmdldE1lc3NhZ2Uo\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBQcm9jZXNzIGV4\nZWN1dGVCYXRjaCBmdW5jdGlvbiBhcnJheSBvZiByZXR1cm4gY291bnRzLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgY2hlY2tVcGRhdGVDb3VudChpbnRb\nXSBjb3VudCwgaW50IGJhdGNoZWRSb3dzQmFzZUluZGV4LAogICAgICAgIFBy\nZXBhcmVkU3RhdGVtZW50IHBzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIC8vIHZhbHVlIGluIGludFtdIGNvdW50ICByZXR1cm5l\nZCBmcm9tIGV4ZWN1dGVCYXRjaDogCiAgICAgICAgLy8gICAgICAgICAgICAg\nICBVcGRhdGUgICAgICAgICAgRGVsZXRlICAgICAgICBJbnNlcnQKICAgICAg\nICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAvLyAgICAgICAgICAg\nICAgIE9LIC8gRXJyb3IgICAgICBPSyAvIEVycm9yICAgIE9LIC8gRXJyb3IK\nICAgICAgICAvLyBEQjJMVVcgICAgICAgICAxIC8gMCAgICAgICAgICAgMSAv\nIDAgICAgICAgICAxIC8gU1FMRXhjZXB0aW9uCiAgICAgICAgLy8gREIyL1pP\nUyAgICAgICAgMSAvIDAgICAgICAgICAgIDEgLyAwICAgICAgICAtMiAvIFNR\nTEV4Y2VwdGlvbgogICAgICAgIC8vIE9yYWNsZSAgICAgICAgLTIgLyAtMiAg\nICAgICAgIC0yIC8gLTIgICAgICAgLTIgLyBTUUxFeGNlcHRpb24KICAgICAg\nICBpbnQgY250ID0gMDsKICAgICAgICBpbnQgdXBkYXRlU3VjY2Vzc0NudCA9\nIF9kaWN0LmdldEJhdGNoVXBkYXRlQ291bnQocHMpOwogICAgICAgIE9iamVj\ndCBmYWlsZWQgPSBudWxsOwogICAgICAgIExpc3QgYmF0Y2hlZFJvd3MgPSBn\nZXRCYXRjaGVkUm93cygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY291bnQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY250ID0gY291bnRb\naV07CiAgICAgICAgICAgIFJvd0ltcGwgcm93ID0gKFJvd0ltcGwpIGJhdGNo\nZWRSb3dzLmdldChiYXRjaGVkUm93c0Jhc2VJbmRleCArIGkpOwogICAgICAg\nICAgICBmYWlsZWQgPSByb3cuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAgICAg\nICAgIHN3aXRjaCAoY250KSB7CiAgICAgICAgICAgIGNhc2UgU3RhdGVtZW50\nLkVYRUNVVEVfRkFJTEVEOiAvLyAtMwogICAgICAgICAgICAgICAgaWYgKGZh\naWxlZCAhPSBudWxsIHx8IHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cuQUNUSU9O\nX1VQREFURSkKICAgICAgICAgICAgICAgICAgICBfZXhjZXB0aW9ucy5hZGQo\nbmV3IE9wdGltaXN0aWNFeGNlcHRpb24oZmFpbGVkKSk7CiAgICAgICAgICAg\nICAgICBlbHNlIGlmIChyb3cuZ2V0QWN0aW9uKCkgPT0gUm93LkFDVElPTl9J\nTlNFUlQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2Vw\ndGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgInVwZGF0\nZS1mYWlsZWQtbm8tZmFpbGVkLW9iaiIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIFN0cmluZy52YWx1ZU9mKGNvdW50W2ldKSwgCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJvdy5nZXRTUUwoX2RpY3QpKS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgU3RhdGVt\nZW50LlNVQ0NFU1NfTk9fSU5GTzogLy8gLTIKICAgICAgICAgICAgICAgIGlm\nIChfZGljdC5yZXBvcnRzU3VjY2Vzc05vSW5mb09uQmF0Y2hVcGRhdGVzICYm\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB1cGRh\ndGVTdWNjZXNzQ250ICE9IGNvdW50Lmxlbmd0aCkgewogICAgICAgICAgICAg\nICAgICAgIC8vIE9yYWNsZSBiYXRjaGluZyBzcGVjaWZpY3M6CiAgICAgICAg\nICAgICAgICAgICAgLy8gdHJlYXQgdXBkYXRlL2RlbGV0ZSBvZiBTVUNDRVNT\nX05PX0lORk8gYXMgZmFpbGVkIGNhc2UKICAgICAgICAgICAgICAgICAgICAv\nLyBiZWNhdXNlOgogICAgICAgICAgICAgICAgICAgIC8vIDEuIHRyYW5zYWN0\naW9uIHNob3VsZCBiZSByb2xsZWQgYmFjay4KICAgICAgICAgICAgICAgICAg\nICAvLyAyLiBpZiBEYXRhQ2FjaGUgaXMgZW5hYmxlZCwgb2JqZWN0cyBpbgog\nICAgICAgICAgICAgICAgICAgIC8vICAgIGNhY2hlIHNob3VsZCBiZSByZW1v\ndmVkLgogICAgICAgICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgX2V4Y2VwdGlvbnMuYWRkKG5ldyBP\ncHRpbWlzdGljRXhjZXB0aW9uKGZhaWxlZCkpOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UgaWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cuQUNUSU9OX0lO\nU0VSVCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4\nY2VwdGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICJ1cGRhdGUtZmFpbGVkLW5vLWZhaWxlZC1vYmoiLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY291bnRbaV0pLCAKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5nZXRTUUwoX2RpY3QpKS5n\nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJiYXRjaF91cGRhdGVfaW5mbyIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKGNudCks\nIAogICAgICAgICAgICAgICAgICAgICAgICByb3cuZ2V0U1FMKF9kaWN0KSku\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIDA6IC8vIG5vIHJvdyBpcyBpbnNlcnRlZCwgdHJlYXRzIGl0\nIGFzIGZhaWxlZAogICAgICAgICAgICAgICAgLy8gY2FzZQogICAgICAgICAg\nICAgICAgaWYgKGZhaWxlZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIF9leGNlcHRpb25zLmFkZChuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWls\nZWQpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJvdy5nZXRBY3Rpb24o\nKSA9PSBSb3cuQUNUSU9OX0lOU0VSVCkKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgU1FMRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAg\nICAgICAgICAgICAidXBkYXRlLWZhaWxlZC1uby1mYWlsZWQtb2JqIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2YoY291bnRbaV0p\nLCAKICAgICAgICAgICAgICAgICAgICAgICAgcm93LmdldFNRTChfZGljdCkp\nLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNCYXRjaERpc2FibGVkKCkgewogICAg\nICAgIHJldHVybiBfZGlzYWJsZUJhdGNoOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldEJhdGNoRGlzYWJsZWQoYm9vbGVhbiBkaXNhYmxlQmF0Y2gpIHsK\nICAgICAgICBfZGlzYWJsZUJhdGNoID0gZGlzYWJsZUJhdGNoOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgZ2V0QmF0Y2hMaW1pdCgpIHsKICAgICAgICByZXR1\ncm4gX2JhdGNoTGltaXQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QmF0\nY2hMaW1pdChpbnQgYmF0Y2hMaW1pdCkgewogICAgICAgIF9iYXRjaExpbWl0\nID0gYmF0Y2hMaW1pdDsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRCYXRj\naGVkUm93cygpIHsKICAgICAgICByZXR1cm4gX2JhdGNoZWRSb3dzOwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0QmF0Y2hlZFNxbCgpIHsKICAgICAg\nICByZXR1cm4gX2JhdGNoZWRTcWw7CiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgYWRkQmF0Y2goUHJlcGFyZWRTdGF0ZW1lbnQgcHMsIFJvd0ltcGwgcm93\nLCAKICAgICAgICAgICAgaW50IGNvdW50KSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBwcy5hZGRCYXRjaCgpOwogICAgfQoKICAgIHByb3RlY3Rl\nZCBpbnRbXSBleGVjdXRlQmF0Y2goUHJlcGFyZWRTdGF0ZW1lbnQgcHMpIAog\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHBzLmV4\nZWN1dGVCYXRjaCgpOwogICAgfQp9Cg==\n","encoding":"base64"}

