{"sha":"8b869da049997eac79a3af7d1a1703023bcd3bf6","node_id":"MDQ6QmxvYjIwNjM2NDo4Yjg2OWRhMDQ5OTk3ZWFjNzlhM2FmN2QxYTE3MDMwMjNiY2QzYmY2","size":22278,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8b869da049997eac79a3af7d1a1703023bcd3bf6","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbDsNCg0KaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247DQppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOw0KaW1wb3J0IGphdmEudXRpbC5D\nb2xsZWN0aW9uOw0KaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOw0KaW1wb3J0\nIGphdmEudXRpbC5JdGVyYXRvcjsNCmltcG9ydCBqYXZhLnV0aWwuTGlua2Vk\nTGlzdDsNCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsNCmltcG9ydCBqYXZhLnV0\naWwuTWFwOw0KDQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5DbGFzc01hcHBpbmc7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkNvbHVtbjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuRm9yZWlnbktleTsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlByaW1hcnlSb3c7DQppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlJvdzsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuUm93SW1wbDsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlckltcGw7DQppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlvbnM7DQppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuZ3JhcGguRGVw\ndGhGaXJzdEFuYWx5c2lzOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIuZ3JhcGguRWRnZTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmdyYXBoLkdyYXBoOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC5Mb2NhbGl6ZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW50ZXJuYWxFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOw0KDQovKioNCiAqIDxwPlN0\nYW5kYXJkIHVwZGF0ZSBtYW5hZ2VyLCBjYXBhYmxlIG9mIGZvcmVpZ24ga2V5\nIGNvbnN0cmFpbnQgZXZhbHVhdGlvbi48L3A+DQogKg0KICogQHNpbmNlIDEu\nMC4wDQogKi8NCnB1YmxpYyBjbGFzcyBDb25zdHJhaW50VXBkYXRlTWFuYWdl\ncg0KICAgIGV4dGVuZHMgQWJzdHJhY3RVcGRhdGVNYW5hZ2VyIHsNCg0KICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UNCiAgICAgICAgKENvbnN0cmFpbnRVcGRhdGVNYW5h\nZ2VyLmNsYXNzKTsNCg0KICAgIHB1YmxpYyBib29sZWFuIG9yZGVyRGlydHko\nKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHByb3Rl\nY3RlZCBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXIgbmV3UHJlcGFyZWRTdGF0\nZW1lbnRNYW5hZ2VyDQogICAgICAgIChKREJDU3RvcmUgc3RvcmUsIENvbm5l\nY3Rpb24gY29ubikgew0KICAgICAgICByZXR1cm4gbmV3IFByZXBhcmVkU3Rh\ndGVtZW50TWFuYWdlckltcGwoc3RvcmUsIGNvbm4pOw0KICAgIH0NCg0KICAg\nIHByb3RlY3RlZCBSb3dNYW5hZ2VyIG5ld1Jvd01hbmFnZXIoKSB7DQogICAg\nICAgIHJldHVybiBuZXcgUm93TWFuYWdlckltcGwoZmFsc2UpOw0KICAgIH0N\nCg0KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uIGZsdXNoKFJvd01hbmFnZXIg\ncm93TWdyLA0KICAgICAgICBQcmVwYXJlZFN0YXRlbWVudE1hbmFnZXIgcHNN\nZ3IsIENvbGxlY3Rpb24gZXhjZXBzKSB7DQogICAgICAgIFJvd01hbmFnZXJJ\nbXBsIHJtaW1wbCA9IChSb3dNYW5hZ2VySW1wbCkgcm93TWdyOw0KDQogICAg\nICAgIC8vIGZpcnN0IHRha2UgY2FyZSBvZiBhbGwgc2Vjb25kYXJ5IHRhYmxl\nIGRlbGV0ZXMgYW5kICdhbGwgcm93JyBkZWxldGVzDQogICAgICAgIC8vICh3\naGljaCBhcmUgcHJvYmFibHkgc2Vjb25kYXJ5IHRhYmxlIGRlbGV0ZXMpLCBz\naW5jZSBubyBmb3JlaWduDQogICAgICAgIC8vIGtleXMgZXZlciByZWx5IG9u\nIHNlY29uZGFyeSB0YWJsZSBwa3MNCiAgICAgICAgZmx1c2gocm1pbXBsLmdl\ndEFsbFJvd0RlbGV0ZXMoKSwgcHNNZ3IpOw0KICAgICAgICBmbHVzaChybWlt\ncGwuZ2V0U2Vjb25kYXJ5RGVsZXRlcygpLCBwc01ncik7DQoNCiAgICAgICAg\nLy8gbm93IGRvIGFueSAnYWxsIHJvdycgdXBkYXRlcw0KICAgICAgICBmbHVz\naChybWltcGwuZ2V0QWxsUm93VXBkYXRlcygpLCBwc01ncik7DQoNCiAgICAg\nICAgLy8gYW5hbHl6ZSBmb3JlaWduIGtleXMNCiAgICAgICAgQ29sbGVjdGlv\nbiBpbnNlcnRzID0gcm1pbXBsLmdldEluc2VydHMoKTsNCiAgICAgICAgQ29s\nbGVjdGlvbiB1cGRhdGVzID0gcm1pbXBsLmdldFVwZGF0ZXMoKTsNCiAgICAg\nICAgQ29sbGVjdGlvbiBkZWxldGVzID0gcm1pbXBsLmdldERlbGV0ZXMoKTsN\nCiAgICAgICAgR3JhcGhbXSBncmFwaHMgPSBuZXcgR3JhcGhbMl07ICAgIC8v\nIGluc2VydCBncmFwaCwgZGVsZXRlIGdyYXBoDQogICAgICAgIGFuYWx5emVG\nb3JlaWduS2V5cyhpbnNlcnRzLCB1cGRhdGVzLCBkZWxldGVzLCBybWltcGws\nIGdyYXBocyk7DQoNCiAgICAgICAgLy8gZmx1c2ggaW5zZXJ0IGdyYXBoLCBp\nZiBhbnkNCiAgICAgICAgYm9vbGVhbiBhdXRvQXNzaWduID0gcm1pbXBsLmhh\nc0F1dG9Bc3NpZ25Db25zdHJhaW50cygpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgZmx1c2hHcmFwaChncmFwaHNbMF0sIHBzTWdyLCBhdXRvQXNz\naWduKTsNCiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7DQog\nICAgICAgICAgICBleGNlcHMgPSBhZGRFeGNlcHRpb24oZXhjZXBzLCBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBkaWN0KSk7DQogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIGV4Y2Vw\ncyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIGtlKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIC8vIGZsdXNoIHRoZSByZXN0IG9mIHRoZSBpbnNlcnRzIGFuZCB1\ncGRhdGVzOyBpbnNlcnRzIGJlZm9yZSB1cGRhdGVzDQogICAgICAgIC8vIGJl\nY2F1c2Ugc29tZSB1cGRhdGUgZmtzIG1pZ2h0IHJlZmVyZW5jZSBwa3MgdGhh\ndCBoYXZlIHRvIGJlIGluc2VydGVkDQogICAgICAgIGZsdXNoKGluc2VydHMs\nIHBzTWdyKTsNCiAgICAgICAgZmx1c2godXBkYXRlcywgcHNNZ3IpOw0KDQog\nICAgICAgIC8vIGZsdXNoIHRoZSBkZWxldGUgZ3JhcGgsIGlmIGFueQ0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgZmx1c2hHcmFwaChncmFwaHNbMV0s\nIHBzTWdyLCBhdXRvQXNzaWduKTsNCiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7DQogICAgICAgICAgICBleGNlcHMgPSBhZGRFeGNlcHRp\nb24oZXhjZXBzLCBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBkaWN0KSk7\nDQogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAg\nICAgICAgICAgIGV4Y2VwcyA9IGFkZEV4Y2VwdGlvbihleGNlcHMsIGtlKTsN\nCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHB1dCB0aGUgcmVtYWluZGVyIG9m\nIHRoZSBkZWxldGVzIGFmdGVyIHVwZGF0ZXMgYmVjYXVzZSBzb21lIHVwZGF0\nZXMNCiAgICAgICAgLy8gbWF5IGJlIG51bGxpbmcgZmtzIHRvIHJvd3MgdGhh\ndCBhcmUgZ29pbmcgdG8gYmUgZGVsZXRlZA0KICAgICAgICBmbHVzaChkZWxl\ndGVzLCBwc01ncik7DQoNCiAgICAgICAgLy8gdGFrZSBjYXJlIG9mIGFsbCBz\nZWNvbmRhcnkgdGFibGUgaW5zZXJ0cyBhbmQgdXBkYXRlcyBsYXN0LCBzaW5j\nZQ0KICAgICAgICAvLyB0aGV5IG1heSByZWx5IG9uIHByZXZpb3VzIGluc2Vy\ndHMgb3IgdXBkYXRlcywgYnV0IG5vdGhpbmcgcmVsaWVzDQogICAgICAgIC8v\nIG9uIHRoZW0NCiAgICAgICAgZmx1c2gocm1pbXBsLmdldFNlY29uZGFyeVVw\nZGF0ZXMoKSwgcHNNZ3IpOw0KDQogICAgICAgIC8vIGZsdXNoIGFueSBsZWZ0\nIG92ZXIgcHJlcGFyZWQgc3RhdGVtZW50cw0KICAgICAgICBwc01nci5mbHVz\naCgpOw0KICAgICAgICByZXR1cm4gZXhjZXBzOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIEFuYWx5emUgZm9yZWlnbiBrZXkgZGVwZW5kZW5jaWVzIG9u\nIHRoZSBnaXZlbiByb3dzDQogICAgICogYW5kIGNyZWF0ZSBhbiBpbnNlcnQg\nYW5kIGEgZGVsZXRlIGdyYXBoIHRvIGV4ZWN1dGUuICBUaGUgaW5zZXJ0DQog\nICAgICogZ3JhcGggd2lsbCBiZSBmbHVzaGVkIGJlZm9yZSBhbGwgb3RoZXIg\ncm93cywgYW5kIHRoZSBkZWxldGUgZ3JhcGggd2lsbA0KICAgICAqIGJlIGZs\ndXNoZWQgYWZ0ZXIgdGhlbS4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQg\nYW5hbHl6ZUZvcmVpZ25LZXlzKENvbGxlY3Rpb24gaW5zZXJ0cywgQ29sbGVj\ndGlvbiB1cGRhdGVzLA0KICAgICAgICBDb2xsZWN0aW9uIGRlbGV0ZXMsIFJv\nd01hbmFnZXJJbXBsIHJvd01nciwgR3JhcGhbXSBncmFwaHMpIHsNCiAgICAg\nICAgLy8gaWYgdGhlcmUgYXJlIGFueSBkZWxldGVzLCB3ZSBoYXZlIHRvIG1h\ncCB0aGUgaW5zZXJ0IG9iamVjdHMgb24gdGhlaXINCiAgICAgICAgLy8gb2lk\ncyBzbyB3ZSdsbCBiZSBhYmxlIHRvIGRldGVjdCBkZWxldGUtdGhlbi1pbnNl\ncnQtc2FtZS1wayBjYXNlcw0KICAgICAgICBNYXAgaW5zZXJ0TWFwID0gbnVs\nbDsNCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbTsNCiAgICAgICAg\naWYgKCFkZWxldGVzLmlzRW1wdHkoKSAmJiAhaW5zZXJ0cy5pc0VtcHR5KCkp\nIHsNCiAgICAgICAgICAgIGluc2VydE1hcCA9IG5ldyBIYXNoTWFwKChpbnQp\nIChpbnNlcnRzLnNpemUoKSAqIDEuMzMgKyAxKSk7DQogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IGluc2VydHMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICBzbSA9ICgoUm93KSBpdHIu\nbmV4dCgpKS5nZXRQcmltYXJ5S2V5KCk7DQogICAgICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgc20uZ2V0T2JqZWN0SWQoKSAhPSBudWxsKQ0KICAg\nICAgICAgICAgICAgICAgICBpbnNlcnRNYXAucHV0KHNtLmdldE9iamVjdElk\nKCksIHNtKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAg\nIC8vIGZpcnN0IGNvbnN0cnVjdCB0aGUgZ3JhcGggZm9yIGRlbGV0ZXM7IHRo\naXMgbWF5IGV4cGFuZCB0byBpbmNsdWRlDQogICAgICAgIC8vIGluc2VydHMg\nYW5kIHVwZGF0ZXMgYXMgd2VsbCBpZiB0aGVyZSBhcmUgYW55IGluc2VydHMg\ndGhhdCByZWx5IG9uDQogICAgICAgIC8vIGRlbGV0ZXMgKGRlbGV0ZS10aGVu\nLWluc2VydC1zYW1lLXBrIGNhc2VzKQ0KICAgICAgICBQcmltYXJ5Um93IHJv\ndzsNCiAgICAgICAgUm93IHJvdzI7DQogICAgICAgIEZvcmVpZ25LZXlbXSBm\na3M7DQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZmtWYWw7DQogICAg\nICAgIGJvb2xlYW4gaWdub3JlVXBkYXRlcyA9IHRydWU7DQogICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gZGVsZXRlcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykgew0KICAgICAgICAgICAgcm93ID0gKFByaW1hcnlSb3cpIGl0\nci5uZXh0KCk7DQogICAgICAgICAgICBpZiAoIXJvdy5pc1ZhbGlkKCkpDQog\nICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAgICAgIHJvdzIg\nPSBnZXRJbnNlcnRSb3coaW5zZXJ0TWFwLCByb3dNZ3IsIHJvdyk7DQogICAg\nICAgICAgICBpZiAocm93MiAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAg\naWdub3JlVXBkYXRlcyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGdyYXBo\nc1sxXSA9IGFkZEVkZ2UoZ3JhcGhzWzFdLCAoUHJpbWFyeVJvdykgcm93Miwg\ncm93LCBudWxsKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8g\nbm93IGNoZWNrIHRoaXMgcm93J3MgZmtzIGFnYWluc3Qgb3RoZXIgZGVsZXRl\ncw0KICAgICAgICAgICAgZmtzID0gcm93LmdldFRhYmxlKCkuZ2V0Rm9yZWln\nbktleXMoKTsNCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZmtz\nLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgICAgLy8gd2hlbiBkZWxl\ndGluZyByZWYgZmtzIHRoZXknbGwganVzdCBzZXQgYSB3aGVyZSB2YWx1ZSwg\nc28NCiAgICAgICAgICAgICAgICAvLyBjaGVjayBib3RoIGZvciBmayB1cGRh\ndGVzIChyZWxhdGlvbiBma3MpIGFuZCB3aGVyZXMgKHJlZiBma3MpDQogICAg\nICAgICAgICAgICAgZmtWYWwgPSByb3cuZ2V0Rm9yZWlnbktleVNldChma3Nb\nal0pOw0KICAgICAgICAgICAgICAgIGlmIChma1ZhbCA9PSBudWxsKQ0KICAg\nICAgICAgICAgICAgICAgICBma1ZhbCA9IHJvdy5nZXRGb3JlaWduS2V5V2hl\ncmUoZmtzW2pdKTsNCiAgICAgICAgICAgICAgICBpZiAoZmtWYWwgPT0gbnVs\nbCkNCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQoNCiAgICAgICAg\nICAgICAgICByb3cyID0gcm93TWdyLmdldFJvdyhma3Nbal0uZ2V0UHJpbWFy\neUtleVRhYmxlKCksDQogICAgICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05f\nREVMRVRFLCBma1ZhbCwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIGlmIChy\nb3cyICE9IG51bGwgJiYgcm93Mi5pc1ZhbGlkKCkgJiYgcm93MiAhPSByb3cp\nDQogICAgICAgICAgICAgICAgICAgIGdyYXBoc1sxXSA9IGFkZEVkZ2UoZ3Jh\ncGhzWzFdLCAoUHJpbWFyeVJvdykgcm93Miwgcm93LA0KICAgICAgICAgICAg\nICAgICAgICAgICAgZmtzW2pdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAg\nfQ0KDQogICAgICAgIGlmIChpZ25vcmVVcGRhdGVzKQ0KICAgICAgICAgICAg\nZ3JhcGhzWzBdID0gYW5hbHl6ZUFnYWluc3RJbnNlcnRzKGluc2VydHMsIHJv\nd01nciwgZ3JhcGhzWzBdKTsNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAg\nICAvLyBwdXQgaW5zZXJ0cyAqYW5kIHVwZGF0ZXMqIGluIHRoZSBkZWxldGUg\nZ3JhcGg7IHRoZXkgYWxsIHJlbHkNCiAgICAgICAgICAgIC8vIG9uIGVhY2gg\nb3RoZXINCiAgICAgICAgICAgIGdyYXBoc1sxXSA9IGFuYWx5emVBZ2FpbnN0\nSW5zZXJ0cyh1cGRhdGVzLCByb3dNZ3IsIGdyYXBoc1sxXSk7DQogICAgICAg\nICAgICBncmFwaHNbMV0gPSBhbmFseXplQWdhaW5zdEluc2VydHMoaW5zZXJ0\ncywgcm93TWdyLCBncmFwaHNbMV0pOw0KICAgICAgICB9DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogQ2hlY2sgdG8gc2VlIGlmIHRoZXJlIGlzIGFuIGlu\nc2VydCBmb3IgZm9yIHRoZSBzYW1lIHRhYmxlIGFuZCBwcmltYXJ5DQogICAg\nICoga2V5IHZhbHVlcyBhcyB0aGUgZ2l2ZW4gZGVsZXRlIHJvdy4NCiAgICAg\nKi8NCiAgICBwcml2YXRlIFJvdyBnZXRJbnNlcnRSb3coTWFwIGluc2VydE1h\ncCwgUm93TWFuYWdlckltcGwgcm93TWdyLCBSb3cgcm93KSB7DQogICAgICAg\nIGlmIChpbnNlcnRNYXAgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOw0KDQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSByb3cu\nZ2V0UHJpbWFyeUtleSgpOw0KICAgICAgICBpZiAoc20gPT0gbnVsbCkNCiAg\nICAgICAgICAgIHJldHVybiBudWxsOw0KDQogICAgICAgIC8vIGxvb2sgZm9y\nIGEgbmV3IG9iamVjdCB3aG9zZSBpbnNlcnQgaWQgaXMgdGhlIHNhbWUgYXMg\ndGhpcyBkZWxldGUgb25lDQogICAgICAgIE9iamVjdCBvaWQgPSBzbS5nZXRP\nYmplY3RJZCgpOw0KICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG5zbSA9\nIChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBpbnNlcnRNYXAuZ2V0KG9pZCk7DQog\nICAgICAgIGlmIChuc20gPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOw0KDQogICAgICAgIC8vIGZvdW5kIG5ldyBvYmplY3Q7IGdldCBpdHMg\ncm93DQogICAgICAgIHJvdyA9IHJvd01nci5nZXRSb3cocm93LmdldFRhYmxl\nKCksIFJvdy5BQ1RJT05fSU5TRVJULCBuc20sIGZhbHNlKTsNCiAgICAgICAg\ncmV0dXJuIChyb3cgPT0gbnVsbCB8fCByb3cuaXNWYWxpZCgpKSA/IHJvdyA6\nIG51bGw7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQW5hbHl6ZSB0aGUg\nZ2l2ZW4gcm93cyBhZ2FpbnN0IHRoZSBpbnNlcnRzLCBwbGFjaW5nIGRlcGVu\nZGVuY2llcw0KICAgICAqIGluIHRoZSBnaXZlbiBncmFwaC4NCiAgICAgKi8N\nCiAgICBwcml2YXRlIEdyYXBoIGFuYWx5emVBZ2FpbnN0SW5zZXJ0cyhDb2xs\nZWN0aW9uIHJvd3MsIFJvd01hbmFnZXJJbXBsIHJvd01nciwNCiAgICAgICAg\nR3JhcGggZ3JhcGgpIHsNCiAgICAgICAgUHJpbWFyeVJvdyByb3c7DQogICAg\nICAgIFJvdyByb3cyOw0KICAgICAgICBGb3JlaWduS2V5W10gZmtzOw0KICAg\nICAgICBDb2x1bW5bXSBjb2xzOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IHJvd3MuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAg\nICAgICAgIHJvdyA9IChQcmltYXJ5Um93KSBpdHIubmV4dCgpOw0KICAgICAg\nICAgICAgaWYgKCFyb3cuaXNWYWxpZCgpKQ0KICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOw0KDQogICAgICAgICAgICAvLyBjaGVjayB0aGlzIHJvdydzIGZr\ncyBhZ2FpbnN0IGluc2VydHM7IGEgbG9naWNhbCBmayB0byBhbiBhdXRvLWlu\nYw0KICAgICAgICAgICAgLy8gY29sdW1uIGlzIHRyZWF0ZWQganVzdCBhcyBh\nY3R1YWwgZGF0YWJhc2UgZmsgYmVjYXVzZSB0aGUgcmVzdWx0DQogICAgICAg\nICAgICAvLyBpcyB0aGUgc2FtZTogdGhlIHBrIHJvdyBoYXMgdG8gYmUgaW5z\nZXJ0ZWQgYmVmb3JlIHRoZSBmayByb3cNCiAgICAgICAgICAgIGZrcyA9IHJv\ndy5nZXRUYWJsZSgpLmdldEZvcmVpZ25LZXlzKCk7DQogICAgICAgICAgICBm\nb3IgKGludCBqID0gMDsgaiA8IGZrcy5sZW5ndGg7IGorKykgew0KICAgICAg\nICAgICAgICAgIGlmIChyb3cuZ2V0Rm9yZWlnbktleVNldChma3Nbal0pID09\nIG51bGwpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KDQogICAg\nICAgICAgICAgICAgLy8gc2VlIGlmIHRoaXMgcm93IGlzIGRlcGVuZGVudCBv\nbiBhbm90aGVyLiAgaWYgaXQncyBvbmx5DQogICAgICAgICAgICAgICAgLy8g\nZGVwZW5lbnQgb24gaXRzZWxmLCBzZWUgaWYgdGhlIGZrIGlzIGxvZ2ljYWwg\nb3IgZGVmZXJyZWQsIGluDQogICAgICAgICAgICAgICAgLy8gd2hpY2ggY2Fz\nZSBpdCBtdXN0IGJlIGFuIGF1dG8taW5jIGJlY2F1c2Ugb3RoZXJ3aXNlIHdl\nDQogICAgICAgICAgICAgICAgLy8gd291bGRuJ3QgaGF2ZSByZWNvcmRlZCBp\ndA0KICAgICAgICAgICAgICAgIHJvdzIgPSByb3dNZ3IuZ2V0Um93KGZrc1tq\nXS5nZXRQcmltYXJ5S2V5VGFibGUoKSwNCiAgICAgICAgICAgICAgICAgICAg\nUm93LkFDVElPTl9JTlNFUlQsIHJvdy5nZXRGb3JlaWduS2V5U2V0KGZrc1tq\nXSksIGZhbHNlKTsNCiAgICAgICAgICAgICAgICBpZiAocm93MiAhPSBudWxs\nICYmIHJvdzIuaXNWYWxpZCgpICYmIChyb3cyICE9IHJvdw0KICAgICAgICAg\nICAgICAgICAgICB8fCBma3Nbal0uaXNEZWZlcnJlZCgpIHx8IGZrc1tqXS5p\nc0xvZ2ljYWwoKSkpDQogICAgICAgICAgICAgICAgICAgIGdyYXBoID0gYWRk\nRWRnZShncmFwaCwgcm93LCAoUHJpbWFyeVJvdykgcm93MiwgZmtzW2pdKTsN\nCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gc2VlIGlmIHRoZXJl\nIGFyZSBhbnkgcmVsYXRpb24gaWQgY29sdW1ucyBkZXBlbmRlbnQgb24NCiAg\nICAgICAgICAgIC8vIGF1dG8taW5jIG9iamVjdHMNCiAgICAgICAgICAgIGNv\nbHMgPSByb3cuZ2V0VGFibGUoKS5nZXRSZWxhdGlvbklkQ29sdW1ucygpOw0K\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBjb2xzLmxlbmd0aDsg\naisrKSB7DQogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSA9IHJvdy5nZXRSZWxhdGlvbklkU2V0KGNvbHNbal0pOw0KICAgICAgICAg\nICAgICAgIGlmIChzbSA9PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsNCg0KICAgICAgICAgICAgICAgIHJvdzIgPSByb3dNZ3IuZ2V0\nUm93KGdldEJhc2VUYWJsZShzbSksIFJvdy5BQ1RJT05fSU5TRVJULA0KICAg\nICAgICAgICAgICAgICAgICBzbSwgZmFsc2UpOw0KICAgICAgICAgICAgICAg\nIGlmIChyb3cyICE9IG51bGwgJiYgcm93Mi5pc1ZhbGlkKCkpDQogICAgICAg\nICAgICAgICAgICAgIGdyYXBoID0gYWRkRWRnZShncmFwaCwgcm93LCAoUHJp\nbWFyeVJvdykgcm93MiwgY29sc1tqXSk7DQogICAgICAgICAgICB9DQogICAg\nICAgIH0NCiAgICAgICAgcmV0dXJuIGdyYXBoOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIFJldHVybiB0aGUgYmFzZSB0YWJsZSBmb3IgdGhlIGdpdmVu\nIGluc3RhbmNlLg0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIFRhYmxl\nIGdldEJhc2VUYWJsZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7DQogICAg\nICAgIENsYXNzTWFwcGluZyBjbHMgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRN\nZXRhRGF0YSgpOw0KICAgICAgICB3aGlsZSAoY2xzLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpICE9IG51bGwpDQogICAgICAgICAgICBjbHMg\nPSBjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7DQogICAg\nICAgIHJldHVybiBjbHMuZ2V0VGFibGUoKTsNCiAgICB9DQoNCiAgICAvKioN\nCiAgICAgKiBBZGQgYW4gZWRnZSBiZXR3ZWVuIHRoZSBnaXZlbiByb3dzIGlu\nIHRoZSBnaXZlbiBmb3JlaWduIGtleSBncmFwaC4NCiAgICAgKi8NCiAgICBw\ncml2YXRlIEdyYXBoIGFkZEVkZ2UoR3JhcGggZ3JhcGgsIFByaW1hcnlSb3cg\ncm93MSwgUHJpbWFyeVJvdyByb3cyLA0KICAgICAgICBPYmplY3QgZmspIHsN\nCiAgICAgICAgLy8gZGVsYXkgY3JlYXRpb24gb2YgdGhlIGdyYXBoDQogICAg\nICAgIGlmIChncmFwaCA9PSBudWxsKQ0KICAgICAgICAgICAgZ3JhcGggPSBu\nZXcgR3JhcGgoKTsNCg0KICAgICAgICByb3cxLnNldERlcGVuZGVudCh0cnVl\nKTsNCiAgICAgICAgcm93Mi5zZXREZXBlbmRlbnQodHJ1ZSk7DQogICAgICAg\nIGdyYXBoLmFkZE5vZGUocm93MSk7DQogICAgICAgIGdyYXBoLmFkZE5vZGUo\ncm93Mik7DQoNCiAgICAgICAgLy8gYWRkIGFuIGVkZ2UgZnJvbSByb3cxIHRv\nIHJvdzIsIGFuZCBzZXQgdGhlIGZrIGNhdXNpbmcgdGhlDQogICAgICAgIC8v\nIGRlcGVuZGVuY3kgYXMgdGhlIHVzZXIgb2JqZWN0IHNvIHdlIGNhbiByZXRy\naWV2ZSBpdCB3aGVuIHJlc29sdmluZw0KICAgICAgICAvLyBjaXJjdWxhciBj\nb25zdHJhaW50cw0KICAgICAgICBFZGdlIGVkZ2UgPSBuZXcgRWRnZShyb3cx\nLCByb3cyLCB0cnVlKTsNCiAgICAgICAgZWRnZS5zZXRVc2VyT2JqZWN0KGZr\nKTsNCiAgICAgICAgZ3JhcGguYWRkRWRnZShlZGdlKTsNCg0KICAgICAgICBy\nZXR1cm4gZ3JhcGg7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmx1c2gg\ndGhlIGdpdmVuIGdyYXBoIG9mIHJvd3MgaW4gdGhlIHByb3BlciBvcmRlci4N\nCiAgICAgKiBAcGFyYW0gZ3JhcGggVGhlIGdyYXBoIG9mIHN0YXRlbWVudHMg\ndG8gYmUgd2Fsa2VkDQogICAgICogQHBhcmFtIHBzTWdyIFRoZSBwcmVwYXJl\nZCBzdGF0ZW1lbnQgbWFuYWdlciB0byB1c2UgdG8gaXNzdWUgdGhlDQogICAg\nICogc3RhdGVtZW50cw0KICAgICAqIEBwYXJhbSBhdXRvQXNzaWduIFdoZXRo\nZXIgYW55IG9mIHRoZSByb3dzIGluIHRoZSBncmFwaCBoYXZlIGFueQ0KICAg\nICAqIGF1dG8tYXNzaWduIGNvbnN0cmFpbnRzDQogICAgICovDQogICAgcHJv\ndGVjdGVkIHZvaWQgZmx1c2hHcmFwaChHcmFwaCBncmFwaCwgUHJlcGFyZWRT\ndGF0ZW1lbnRNYW5hZ2VyIHBzTWdyLA0KICAgICAgICBib29sZWFuIGF1dG9B\nc3NpZ24pDQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAgICAg\nICBpZiAoZ3JhcGggPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybjsNCg0K\nICAgICAgICBEZXB0aEZpcnN0QW5hbHlzaXMgZGZhID0gbmV3RGVwdGhGaXJz\ndEFuYWx5c2lzKGdyYXBoLCBhdXRvQXNzaWduKTsNCiAgICAgICAgQ29sbGVj\ndGlvbiBpbnNlcnRVcGRhdGVzID0gbmV3IExpbmtlZExpc3QoKTsNCiAgICAg\nICAgQ29sbGVjdGlvbiBkZWxldGVVcGRhdGVzID0gbmV3IExpbmtlZExpc3Qo\nKTsNCiAgICAgICAgYm9vbGVhbiByZWNhbGN1bGF0ZTsNCg0KICAgICAgICAv\nLyBIYW5kbGUgY2lyY3VsYXIgY29uc3RyYWludHM6DQogICAgICAgIC8vIC0g\naWYgZGVsZXRlZCByb3cgQSBoYXMgYSBjaXJpY3VsYXIgZmsgdG8gZGVsZXRl\nZCByb3cgQiwgDQogICAgICAgIC8vICAgdGhlbiB1c2UgYW4gdXBkYXRlIHN0\nYXRlbWVudCB0byBudWxsIEEncyBmayB0byBCIGJlZm9yZSBmbHVzaGluZywg\nDQogICAgICAgIC8vICAgYW5kIHRoZW4gZmx1c2gNCiAgICAgICAgLy8gLSBp\nZiBpbnNlcnRlZCByb3cgQSBoYXMgYSBjaXJjdWxhciBmayB0byB1cGRhdGVk\nL2luc2VydGVkIHJvdyBCLA0KICAgICAgICAvLyAgIHRoZW4gbnVsbCB0aGUg\nZmsgaW4gdGhlIEIgcm93IG9iamVjdCwgdGhlbiBmbHVzaCwNCiAgICAgICAg\nLy8gICBhbmQgYWZ0ZXIgZmx1c2hpbmcsIHVzZSBhbiB1cGRhdGUgdG8gc2V0\nIHRoZSBmayBiYWNrIHRvIEENCiAgICAgICAgLy8gRGVwZW5kaW5nIG9uIHdo\nZXJlIGNpcmN1bGFyIGRlcGVuZGVuY2llcyBhcmUgYnJva2VuLCB0aGUgIA0K\nICAgICAgICAvLyB0b3BvbG9naWNhbCBvcmRlciBvZiB0aGUgZ3JhcGggbm9k\nZXMgaGFzIHRvIGJlIHJlLWNhbGN1bGF0ZWQuDQogICAgICAgIHJlY2FsY3Vs\nYXRlID0gcmVzb2x2ZUN5Y2xlcyhncmFwaCwgZGZhLmdldEVkZ2VzKEVkZ2Uu\nVFlQRV9CQUNLKSwNCiAgICAgICAgICAgICAgICBkZWxldGVVcGRhdGVzLCBp\nbnNlcnRVcGRhdGVzKTsNCiAgICAgICAgcmVjYWxjdWxhdGUgfD0gcmVzb2x2\nZUN5Y2xlcyhncmFwaCwgZGZhLmdldEVkZ2VzKEVkZ2UuVFlQRV9GT1JXQVJE\nKSwNCiAgICAgICAgICAgICAgICBkZWxldGVVcGRhdGVzLCBpbnNlcnRVcGRh\ndGVzKTsNCg0KICAgICAgICBpZiAocmVjYWxjdWxhdGUpIHsNCiAgICAgICAg\nICAgIGRmYSA9IHJlY2FsY3VsYXRlRGVwdGhGaXJzdEFuYWx5c2lzKGdyYXBo\nLCBhdXRvQXNzaWduKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGZsdXNo\nIGRlbGV0ZSB1cGRhdGVzIHRvIG51bGwgZmtzLCB0aGVuIGFsbCByb3dzIGlu\nIG9yZGVyLCB0aGVuDQogICAgICAgIC8vIHRoZSBpbnNlcnQgdXBkYXRlcyB0\nbyBzZXQgY2lyY3VsYXIgZmsgdmFsdWVzDQogICAgICAgIGZsdXNoKGRlbGV0\nZVVwZGF0ZXMsIHBzTWdyKTsNCiAgICAgICAgQ29sbGVjdGlvbiBub2RlcyA9\nIGRmYS5nZXRTb3J0ZWROb2RlcygpOw0KICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IG5vZGVzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQ0KICAg\nICAgICAgICAgcHNNZ3IuZmx1c2goKFJvd0ltcGwpIGl0ci5uZXh0KCkpOw0K\nICAgICAgICBmbHVzaChpbnNlcnRVcGRhdGVzLCBwc01ncik7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogQnJlYWsgYSBjaXJjdWxhciBkZXBlbmRlbmN5\nIGNhdXNlZCBieSBkZWxldGUgb3BlcmF0aW9ucy4NCiAgICAgKiBJZiBkZWxl\ndGVkIHJvdyBBIGhhcyBhIGNpcmljdWxhciBmayB0byBkZWxldGVkIHJvdyBC\nLCB0aGVuIHVzZSBhbiB1cGRhdGUgDQogICAgICogc3RhdGVtZW50IHRvIG51\nbGwgQSdzIGZrIHRvIEIgYmVmb3JlIGRlbGV0aW5nIEIsIHRoZW4gZGVsZXRl\nIEEuDQogICAgICogQHBhcmFtIGVkZ2UgRWRnZSBpbiB0aGUgZGVwZW5kZW5j\neSBncmFwaCBjb3JyZXNwb25kaW5nIHRvIGEgZm9yZWlnbiBrZXkNCiAgICAg\nKiBjb25zdHJhaW50LiBUaGlzIGRlcGVuZGVuY3kgaXMgYnJva2VuIGJ5IG51\nbGxpZnlpbmcgdGhlIGZvcmVpZ24ga2V5Lg0KICAgICAqIEBwYXJhbSBkZWxl\ndGVVcGRhdGVzIENvbGxlY3Rpb24gb2YgdXBkYXRlIHN0YXRlbWVudHMgdGhh\ndCBhcmUgZXhlY3V0ZWQNCiAgICAgKiBiZWZvcmUgdGhlIGRlbGV0ZSBvcGVy\nYXRpb25zIGFyZSBmbHVzaGVkIA0KICAgICAqLw0KICAgIHByaXZhdGUgdm9p\nZCBhZGREZWxldGVVcGRhdGUoRWRnZSBlZGdlLCBDb2xsZWN0aW9uIGRlbGV0\nZVVwZGF0ZXMpDQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAg\nICAgICBQcmltYXJ5Um93IHJvdzsNCiAgICAgICAgUm93SW1wbCB1cGRhdGU7\nDQogICAgICAgIEZvcmVpZ25LZXkgZms7DQoNCiAgICAgICAgLy8gY29weSB3\naGVyZSBjb25kaXRpb25zIGludG8gbmV3IHVwZGF0ZSB0aGF0IG51bGxzIHRo\nZSBmaw0KICAgICAgICByb3cgPSAoUHJpbWFyeVJvdykgZWRnZS5nZXRUbygp\nOw0KICAgICAgICB1cGRhdGUgPSBuZXcgUHJpbWFyeVJvdyhyb3cuZ2V0VGFi\nbGUoKSwgUm93LkFDVElPTl9VUERBVEUsIG51bGwpOw0KICAgICAgICByb3cu\nY29weUludG8odXBkYXRlLCB0cnVlKTsNCiAgICAgICAgaWYgKGVkZ2UuZ2V0\nVXNlck9iamVjdCgpIGluc3RhbmNlb2YgRm9yZWlnbktleSkgew0KICAgICAg\nICAgICAgZmsgPSAoRm9yZWlnbktleSkgZWRnZS5nZXRVc2VyT2JqZWN0KCk7\nDQogICAgICAgICAgICB1cGRhdGUuc2V0Rm9yZWlnbktleShmaywgcm93Lmdl\ndEZvcmVpZ25LZXlJTyhmayksIG51bGwpOw0KICAgICAgICB9IGVsc2UNCiAg\nICAgICAgICAgIHVwZGF0ZS5zZXROdWxsKChDb2x1bW4pIGVkZ2UuZ2V0VXNl\nck9iamVjdCgpKTsNCg0KICAgICAgICBkZWxldGVVcGRhdGVzLmFkZCh1cGRh\ndGUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEJyZWFrIGEgY2lyY3Vs\nYXIgZGVwZW5kZW5jeSBjYXVzZWQgYnkgaW5zZXJ0IG9wZXJhdGlvbnMuDQog\nICAgICogSWYgaW5zZXJ0ZWQgcm93IEEgaGFzIGEgY2lyY3VsYXIgZmsgdG8g\ndXBkYXRlZC9pbnNlcnRlZCByb3cgQiwNCiAgICAgKiB0aGVuIG51bGwgdGhl\nIGZrIGluIHRoZSBCIHJvdyBvYmplY3QsIHRoZW4gZmx1c2gsDQogICAgICog\nYW5kIGFmdGVyIGZsdXNoaW5nLCB1c2UgYW4gdXBkYXRlIHRvIHNldCB0aGUg\nZmsgYmFjayB0byBBLg0KICAgICAqIEBwYXJhbSByb3cgUm93IHRvIGJlIGZs\ndXNoZWQNCiAgICAgKiBAcGFyYW0gZWRnZSBFZGdlIGluIHRoZSBkZXBlbmRl\nbmN5IGdyYXBoIGNvcnJlc3BvbmRpbmcgdG8gYSBmb3JlaWduIGtleQ0KICAg\nICAqIGNvbnN0cmFpbnQuIFRoaXMgZGVwZW5kZW5jeSBpcyBicm9rZW4gYnkg\nbnVsbGlmeWluZyB0aGUgZm9yZWlnbiBrZXkuDQogICAgICogQHBhcmFtIGlu\nc2VydFVwZGF0ZXMgQ29sbGVjdGlvbiBvZiB1cGRhdGUgc3RhdGVtZW50cyB0\naGF0IGFyZSBleGVjdXRlZA0KICAgICAqIGFmdGVyIHRoZSBpbnNlcnQvdXBk\nYXRlIG9wZXJhdGlvbnMgYXJlIGZsdXNoZWQgDQogICAgICovDQogICAgcHJp\ndmF0ZSB2b2lkIGFkZEluc2VydFVwZGF0ZShQcmltYXJ5Um93IHJvdywgRWRn\nZSBlZGdlLA0KICAgICAgICBDb2xsZWN0aW9uIGluc2VydFVwZGF0ZXMpIHRo\ncm93cyBTUUxFeGNlcHRpb24gew0KICAgICAgICBSb3dJbXBsIHVwZGF0ZTsN\nCiAgICAgICAgRm9yZWlnbktleSBmazsNCiAgICAgICAgQ29sdW1uIGNvbDsN\nCg0KICAgICAgICAvLyBjb3B5IHdoZXJlIGNvbmRpdGlvbnMgaW50byBuZXcg\ndXBkYXRlIHRoYXQgc2V0cyB0aGUgZmsNCiAgICAgICAgdXBkYXRlID0gbmV3\nIFByaW1hcnlSb3cocm93LmdldFRhYmxlKCksIFJvdy5BQ1RJT05fVVBEQVRF\nLCBudWxsKTsNCiAgICAgICAgaWYgKHJvdy5nZXRBY3Rpb24oKSA9PSBSb3cu\nQUNUSU9OX0lOU0VSVCkgew0KICAgICAgICAgICAgaWYgKHJvdy5nZXRQcmlt\nYXJ5S2V5KCkgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoInJlZi1jeWNsZSIpKTsNCiAg\nICAgICAgICAgIHVwZGF0ZS53aGVyZVByaW1hcnlLZXkocm93LmdldFByaW1h\ncnlLZXkoKSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBS\nb3cuQUNUSU9OX1VQREFURQ0KICAgICAgICAgICAgcm93LmNvcHlJbnRvKHVw\nZGF0ZSwgdHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGVkZ2UuZ2V0\nVXNlck9iamVjdCgpIGluc3RhbmNlb2YgRm9yZWlnbktleSkgew0KICAgICAg\nICAgICAgZmsgPSAoRm9yZWlnbktleSkgZWRnZS5nZXRVc2VyT2JqZWN0KCk7\nDQogICAgICAgICAgICB1cGRhdGUuc2V0Rm9yZWlnbktleShmaywgcm93Lmdl\ndEZvcmVpZ25LZXlJTyhmayksDQogICAgICAgICAgICAgICAgcm93LmdldEZv\ncmVpZ25LZXlTZXQoZmspKTsNCiAgICAgICAgICAgIHJvdy5jbGVhckZvcmVp\nZ25LZXkoZmspOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29s\nID0gKENvbHVtbikgZWRnZS5nZXRVc2VyT2JqZWN0KCk7DQogICAgICAgICAg\nICB1cGRhdGUuc2V0UmVsYXRpb25JZChjb2wsIHJvdy5nZXRSZWxhdGlvbklk\nU2V0KGNvbCksDQogICAgICAgICAgICAgICAgcm93LmdldFJlbGF0aW9uSWRD\nYWxsYmFjayhjb2wpKTsNCiAgICAgICAgICAgIHJvdy5jbGVhclJlbGF0aW9u\nSWQoY29sKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGluc2VydFVwZGF0ZXMu\nYWRkKHVwZGF0ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmluZHMg\nYSBudWxsYWJsZSBmb3JlaWduIGtleSBieSB3YWxraW5nIHRoZSBkZXBlbmRl\nbmN5IGN5Y2xlLiANCiAgICAgKiBDaXJjdWxhciBkZXBlbmRlbmNpZXMgY2Fu\nIGJlIGJyb2tlbiBhdCB0aGlzIHBvaW50Lg0KICAgICAqIEBwYXJhbSBjeWNs\nZSBDeWNsZSBpbiB0aGUgZGVwZW5kZW5jeSBncmFwaC4NCiAgICAgKiBAcmV0\ndXJuIEVkZ2UgY29ycmVzcG9uZGluZyB0byBhIG51bGxhYmxlIGZvcmVpZ24g\na2V5Lg0KICAgICAqLw0KICAgIHByaXZhdGUgRWRnZSBmaW5kQnJlYWthYmxl\nTGluayhMaXN0IGN5Y2xlKSB7DQogICAgICAgIEVkZ2UgYnJlYWthYmxlTGlu\nayA9IG51bGw7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRlciA9IGN5Y2xl\nLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyApIHsNCiAgICAgICAgICAg\nIEVkZ2UgZWRnZSA9IChFZGdlKSBpdGVyLm5leHQoKTsNCiAgICAgICAgICAg\nIE9iamVjdCB1c2VyT2JqZWN0ID0gZWRnZS5nZXRVc2VyT2JqZWN0KCk7DQog\nICAgICAgICAgICBpZiAodXNlck9iamVjdCBpbnN0YW5jZW9mIEZvcmVpZ25L\nZXkpIHsNCiAgICAgICAgICAgICAgICAgaWYgKCEoKEZvcmVpZ25LZXkpIHVz\nZXJPYmplY3QpLmhhc05vdE51bGxDb2x1bW5zKCkpIHsNCiAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrYWJsZUxpbmsgPSBlZGdlOw0KICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgIH0NCiAgICAgICAg\nICAgIH0gZWxzZSBpZiAodXNlck9iamVjdCBpbnN0YW5jZW9mIENvbHVtbikg\new0KICAgICAgICAgICAgICAgIGlmICghKChDb2x1bW4pIHVzZXJPYmplY3Qp\nLmlzTm90TnVsbCgpKSB7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrYWJs\nZUxpbmsgPSBlZGdlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAg\nICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAg\nICAgICAgcmV0dXJuIGJyZWFrYWJsZUxpbms7DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogUmUtY2FsY3VsYXRlcyB0aGUgRGVwdGhGaXJzdFNlYXJjaCBh\nbmFseXNpcyBvZiB0aGUgZ3JhcGggDQogICAgICogYWZ0ZXIgc29tZSBvZiB0\naGUgZWRnZXMgaGF2ZSBiZWVuIHJlbW92ZWQuIEVuc3VyZXMNCiAgICAgKiB0\naGF0IHRoZSBkZXBlbmRlbmN5IGdyYXBoIGlzIGN5Y2xlIGZyZWUuDQogICAg\nICogQHBhcmFtIGdyYXBoIFRoZSBncmFwaCBvZiBzdGF0ZW1lbnRzIHRvIGJl\nIHdhbGtlZA0KICAgICAqIEBwYXJhbSBhdXRvQXNzaWduIFdoZXRoZXIgYW55\nIG9mIHRoZSByb3dzIGluIHRoZSBncmFwaCBoYXZlIGFueQ0KICAgICAqIGF1\ndG8tYXNzaWduIGNvbnN0cmFpbnRzDQogICAgICovDQogICAgcHJpdmF0ZSBE\nZXB0aEZpcnN0QW5hbHlzaXMgcmVjYWxjdWxhdGVEZXB0aEZpcnN0QW5hbHlz\naXMoR3JhcGggZ3JhcGgsDQogICAgICAgIGJvb2xlYW4gYXV0b0Fzc2lnbikg\new0KICAgICAgICBEZXB0aEZpcnN0QW5hbHlzaXMgZGZhOw0KICAgICAgICAv\nLyBjbGVhciBwcmV2aW91cyB0cmF2ZXJzYWwgZGF0YQ0KICAgICAgICBncmFw\naC5jbGVhclRyYXZlcnNhbCgpOw0KICAgICAgICBkZmEgPSBuZXdEZXB0aEZp\ncnN0QW5hbHlzaXMoZ3JhcGgsIGF1dG9Bc3NpZ24pOw0KICAgICAgICAvLyBt\nYWtlIHN1cmUgdGhhdCB0aGUgZ3JhcGggaXMgbm9uLWN5Y2xpYyBub3cNCiAg\nICAgICAgYXNzZXJ0IChkZmEuaGFzTm9DeWNsZXMoKSk6IF9sb2MuZ2V0KCJn\ncmFwaC1ub3QtY3ljbGUtZnJlZSIpOw0KICAgICAgICByZXR1cm4gZGZhOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc29sdmUgY2lyY3VsYXIgZGVw\nZW5kZW5jaWVzIGJ5IGlkZW50aWZ5aW5nIGFuZCBicmVha2luZw0KICAgICAq\nIGEgbnVsbGFibGUgZm9yZWlnbiBrZXkuDQogICAgICogQHBhcmFtIGdyYXBo\nIERlcGVuZGVuY3kgZ3JhcGguDQogICAgICogQHBhcmFtIGVkZ2VzIENvbGxl\nY3Rpb24gb2YgZWRnZXMuIEVhY2ggZWRnZSBpbmRpY2F0ZXMgYSBwb3NzaWJs\nZSANCiAgICAgKiBjaXJjdWxhciBkZXBlbmRlbmN5DQogICAgICogQHBhcmFt\nIGRlbGV0ZVVwZGF0ZXMgQ29sbGVjdGlvbiBvZiB1cGRhdGUgb3BlcmF0aW9u\ncyAobnVsbGlmeWluZyANCiAgICAgKiBmb3JlaWduIGtleXMpIHRvIGJlIGZp\nbGxlZC4gVGhlc2UgdXBkYXRlcyB3aWxsIGJlIGV4ZWN1dGVkIGJlZm9yZSAN\nCiAgICAgKiB0aGUgcm93cyBpbiB0aGUgZGVwZW5kZW5jeSBncmFwaCBhcmUg\nZmx1c2hlZA0KICAgICAqIEBwYXJhbSBpbnNlcnRVcGRhdGVzIENDb2xsZWN0\naW9uIG9mIHVwZGF0ZSBvcGVyYXRpb25zIChudWxsaWZ5aW5nIA0KICAgICAq\nIGZvcmVpZ24ga2V5cykgdG8gYmUgZmlsbGVkLiBUaGVzZSB1cGRhdGVzIHdp\nbGwgYmUgZXhlY3V0ZWQgYWZ0ZXIgDQogICAgICogdGhlIHJvd3MgaW4gdGhl\nIGRlcGVuZGVuY3kgZ3JhcGggYXJlIGZsdXNoZWQNCiAgICAgKiBAcmV0dXJu\nIERlcGVuZGluZyBvbiB3aGVyZSBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYXJl\nIGJyb2tlbiwgdGhlICANCiAgICAgKiB0b3BvbG9naWNhbCBvcmRlciBvZiB0\naGUgZ3JhcGggbm9kZXMgaGFzIHRvIGJlIHJlLWNhbGN1bGF0ZWQuDQogICAg\nICovDQogICAgcHJpdmF0ZSBib29sZWFuIHJlc29sdmVDeWNsZXMoR3JhcGgg\nZ3JhcGgsIENvbGxlY3Rpb24gZWRnZXMsDQogICAgICAgIENvbGxlY3Rpb24g\nZGVsZXRlVXBkYXRlcywgQ29sbGVjdGlvbiBpbnNlcnRVcGRhdGVzKQ0KICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAgICAgYm9vbGVhbiBy\nZWNhbGN1bGF0ZSA9IGZhbHNlOw0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0\nciA9IGVkZ2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAg\nICAgICAgICBFZGdlIGVkZ2UgPSAoRWRnZSkgaXRyLm5leHQoKTsNCiAgICAg\nICAgICAgIExpc3QgY3ljbGUgPSBlZGdlLmdldEN5Y2xlKCk7DQoNCiAgICAg\nICAgICAgIGlmIChjeWNsZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAg\nLy8gZmluZCBhIG51bGxhYmxlIGZvcmVpZ24ga2V5DQogICAgICAgICAgICAg\nICAgRWRnZSBicmVha2FibGVMaW5rID0gZmluZEJyZWFrYWJsZUxpbmsoY3lj\nbGUpOw0KICAgICAgICAgICAgICAgIGlmIChicmVha2FibGVMaW5rID09IG51\nbGwpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLW51bGxhYmxlLWZrIikpOw0KICAgICAgICAg\nICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIHRvcG9sb2dpYyBub2Rl\nIG9yZGVyIG11c3QgYmUgcmUtY2FsY3VsYXRlZCwgIGlmIHRoZQ0KICAgICAg\nICAgICAgICAgIC8vIGJyZWFrYWJsZSBsaW5rIGlzIGRpZmZlcmVudCBmcm9t\nIHRoZSBlZGdlIHdoZXJlDQogICAgICAgICAgICAgICAgLy8gdGhlIGNpcmN1\nbGFyIGRlcGVuZGVuY3kgd2FzIG9yaWdpbmFsbHkgZGV0ZWN0ZWQNCiAgICAg\nICAgICAgICAgICBpZiAoZWRnZSAhPSBicmVha2FibGVMaW5rKSB7DQogICAg\nICAgICAgICAgICAgICAgIHJlY2FsY3VsYXRlID0gdHJ1ZTsNCiAgICAgICAg\nICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoIWJyZWFrYWJsZUxp\nbmsuaXNSZW1vdmVkRnJvbUdyYXBoKCkpIHsNCg0KICAgICAgICAgICAgICAg\nICAgICAvLyB1c2UgYSBwcmltYXJ5IHJvdyB1cGRhdGUgdG8gcHJldmVudCBz\nZXR0aW5nIHBrIGFuZCBmayB2YWx1ZXMNCiAgICAgICAgICAgICAgICAgICAg\nLy8gdW50aWwgYWZ0ZXIgZmx1c2gsIHRvIGdldCBsYXRlc3QgYXV0by1pbmNy\nZW1lbnQgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgIFByaW1hcnlSb3cg\ncm93ID0gKFByaW1hcnlSb3cpIGJyZWFrYWJsZUxpbmsuZ2V0RnJvbSgpOw0K\nICAgICAgICAgICAgICAgICAgICBpZiAocm93LmdldEFjdGlvbigpID09IFJv\ndy5BQ1RJT05fREVMRVRFKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBh\nZGREZWxldGVVcGRhdGUoYnJlYWthYmxlTGluaywgZGVsZXRlVXBkYXRlcyk7\nDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAg\nICAgICAgICAgICBhZGRJbnNlcnRVcGRhdGUocm93LCBicmVha2FibGVMaW5r\nLCBpbnNlcnRVcGRhdGVzKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAg\nICAgICAgICAgICAgICAgICBncmFwaC5yZW1vdmVFZGdlKGJyZWFrYWJsZUxp\nbmspOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAg\nICAgfQ0KICAgICAgICByZXR1cm4gcmVjYWxjdWxhdGU7DQogICAgfQ0KDQog\nICAgLyoqDQogICAgICogQ3JlYXRlIGEgbmV3IHtAbGluayBEZXB0aEZpcnN0\nQW5hbHlzaXN9IHN1aXRhYmxlIGZvciB0aGUgZ2l2ZW4gZ3JhcGgNCiAgICAg\nKiBhbmQgYXV0by1hc3NpZ24gc2V0dGluZ3MuDQogICAgICovDQogICAgcHJv\ndGVjdGVkIERlcHRoRmlyc3RBbmFseXNpcyBuZXdEZXB0aEZpcnN0QW5hbHlz\naXMoR3JhcGggZ3JhcGgsDQogICAgICAgIGJvb2xlYW4gYXV0b0Fzc2lnbikg\new0KICAgICAgICByZXR1cm4gbmV3IERlcHRoRmlyc3RBbmFseXNpcyhncmFw\naCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmx1c2ggdGhlIGdpdmVu\nIGNvbGxlY3Rpb24gb2Ygc2Vjb25kYXJ5IHJvd3MuDQogICAgICovDQogICAg\ncHJvdGVjdGVkIHZvaWQgZmx1c2goQ29sbGVjdGlvbiByb3dzLCBQcmVwYXJl\nZFN0YXRlbWVudE1hbmFnZXIgcHNNZ3IpIHsNCiAgICAgICAgaWYgKHJvd3Mu\nc2l6ZSgpID09IDApDQogICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAg\nUm93SW1wbCByb3c7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcm93\ncy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyApIHsNCiAgICAgICAgICAg\nIHJvdyA9IChSb3dJbXBsKSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgaWYg\nKHJvdy5pc1ZhbGlkKCkgJiYgIXJvdy5pc0RlcGVuZGVudCgpKQ0KICAgICAg\nICAgICAgICAgIHBzTWdyLmZsdXNoKHJvdyk7DQogICAgICAgIH0NCiAgICB9\nDQp9\n","encoding":"base64"}

