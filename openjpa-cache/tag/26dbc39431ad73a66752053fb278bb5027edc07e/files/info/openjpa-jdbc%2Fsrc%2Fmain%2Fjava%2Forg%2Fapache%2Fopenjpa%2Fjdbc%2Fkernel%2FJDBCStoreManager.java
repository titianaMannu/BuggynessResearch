{"sha":"29b7ec1bf7691b2a45466d21e15753333850fb0b","node_id":"MDQ6QmxvYjIwNjM2NDoyOWI3ZWMxYmY3NjkxYjJhNDU0NjZkMjFlMTU3NTMzMzM4NTBmYjBi","size":67646,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/29b7ec1bf7691b2a45466d21e15753333850fb0b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBv\ncnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3Rh\ndGVtZW50OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQg\namF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsK\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5j\nZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuT3Jw\naGFuZWRLZXlBY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuY29uZi5RdWVyeVNRTENhY2hlVmFsdWU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWluYXRv\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRN\nYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5W\nYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU1FMRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuTG9ja01hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2VzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TZXE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Npb25Q\nYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuRGVs\nZWdhdGluZ0Nvbm5lY3Rpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nbGliLmpkYmMuRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRpbmdTdGF0ZW1l\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5NZXJnZWRSZXN1bHRP\nYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ncm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubWV0YS5GZXRjaEdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAqIFN0b3JlTWFuYWdl\nciBwbHVnaW4gdGhhdCB1c2VzIEpEQkMgdG8gc3RvcmUgcGVyc2lzdGVudCBk\nYXRhIGluIGEKICogcmVsYXRpb25hbCBkYXRhIHN0b3JlLgogKgogKiBAYXV0\naG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJsaWMgY2xhc3Mg\nSkRCQ1N0b3JlTWFuYWdlciAKICAgIGltcGxlbWVudHMgU3RvcmVNYW5hZ2Vy\nLCBKREJDU3RvcmUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2Fs\naXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoSkRC\nQ1N0b3JlTWFuYWdlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBTdG9yZUNvbnRl\neHQgX2N0eCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkNDb25maWd1cmF0aW9u\nIF9jb25mID0gbnVsbDsKICAgIHByaXZhdGUgREJEaWN0aW9uYXJ5IF9kaWN0\nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMRmFjdG9yeSBfc3FsID0gbnVsbDsK\nICAgIHByaXZhdGUgSkRCQ0xvY2tNYW5hZ2VyIF9sbSA9IG51bGw7CiAgICBw\ncml2YXRlIERhdGFTb3VyY2UgX2RzID0gbnVsbDsKICAgIHByaXZhdGUgUmVm\nQ291bnRDb25uZWN0aW9uIF9jb25uID0gbnVsbDsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfYWN0aXZlID0gZmFsc2U7CgogICAgLy8gdHJhY2sgdGhlIHBlbmRp\nbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRoZW0KICAgIHByaXZh\ndGUgU2V0IF9zdG1udHMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRTZXQo\nbmV3IEhhc2hTZXQoKSk7CiAgICAKICAgIHByaXZhdGUgTWFwIF9zcWxDYWNo\nZSA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2lzUXVlcnlTUUxDYWNo\nZSA9IHRydWU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3QgX251\nbGxDYWNoZVZhbHVlID0gbmV3IE9iamVjdCgpOwogICAgCiAgICBwdWJsaWMg\nU3RvcmVDb250ZXh0IGdldENvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9j\ndHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNv\nbnRleHQgY3R4KSB7CiAgICAgICAgc2V0Q29udGV4dChjdHgsIChKREJDQ29u\nZmlndXJhdGlvbikgY3R4LmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0IGN0\neCwgSkRCQ0NvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jdHggPSBj\ndHg7CiAgICAgICAgX2NvbmYgPSBjb25mOwogICAgICAgIF9kaWN0ID0gX2Nv\nbmYuZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKTsKICAgICAgICBfc3FsID0g\nX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCk7CgogICAgICAgIExvY2tN\nYW5hZ2VyIGxtID0gY3R4LmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAgaWYg\nKGxtIGluc3RhbmNlb2YgSkRCQ0xvY2tNYW5hZ2VyKQogICAgICAgICAgICBf\nbG0gPSAoSkRCQ0xvY2tNYW5hZ2VyKSBsbTsKCiAgICAgICAgaWYgKCFjdHgu\naXNNYW5hZ2VkKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVN\nYW5hZ2VkKCkpCiAgICAgICAgICAgIF9kcyA9IF9jb25mLmdldERhdGFTb3Vy\nY2UyKGN0eCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHMgPSBfY29u\nZi5nZXREYXRhU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRV\ncGRhdGVNYW5hZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAg\nICAgIGN0eC5zZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgICAgICAK\nICAgICAgICBfc3FsQ2FjaGUgPSBfY29uZi5nZXRRdWVyeVNRTENhY2hlSW5z\ndGFuY2UoKTsKICAgICAgICBfaXNRdWVyeVNRTENhY2hlID0gX2NvbmYuaXNR\ndWVyeVNRTENhY2hlT24oKTsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0NvbmZp\nZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4g\nX2NvbmY7CiAgICB9CgogICAgcHVibGljIERCRGljdGlvbmFyeSBnZXREQkRp\nY3Rpb25hcnkoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0OwogICAgfQoKICAg\nIHB1YmxpYyBTUUxGYWN0b3J5IGdldFNRTEZhY3RvcnkoKSB7CiAgICAgICAg\ncmV0dXJuIF9zcWw7CiAgICB9CgogICAgcHVibGljIEpEQkNMb2NrTWFuYWdl\nciBnZXRMb2NrTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX2xtOwogICAg\nfQoKICAgIHB1YmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGdldEZldGNo\nQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gKEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24pIF9jdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5PcHRpbWlzdGljKCkgewogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrT3B0aW1pc3RpYygpIHsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBfYWN0aXZl\nID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoKCFfY3R4\nLmlzTWFuYWdlZCgpIHx8ICFfY29uZi5pc0Nvbm5lY3Rpb25GYWN0b3J5TW9k\nZU1hbmFnZWQoKSkKICAgICAgICAgICAgICAgICYmIF9jb25uLmdldEF1dG9D\nb21taXQoKSkKICAgICAgICAgICAgICAgIF9jb25uLnNldEF1dG9Db21taXQo\nZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICBfYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIHRocm93\nIFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2Nv\nbmYuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5hZ2VkKCkpCiAgICAgICAg\nICAgICAgICBfY29ubi5jb21taXQoKTsKICAgICAgICB9IGNhdGNoIChTUUxF\neGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIF9jb25uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZTIpIHsKICAgICAgICAgICAgfQogICAgICAgICAgICB0\naHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsK\nICAgICAgICAvLyBhbHJlYWR5IHJvbGxlZCBiYWNrIG91cnNlbHZlcz8KICAg\nICAgICBpZiAoIV9hY3RpdmUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9jb25uICE9IG51bGwKICAgICAg\nICAgICAgICAgICYmICghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2NvbmYKICAg\nICAgICAgICAgICAgICAgICAuaXNDb25uZWN0aW9uRmFjdG9yeU1vZGVNYW5h\nZ2VkKCkpKQogICAgICAgICAgICAgICAgX2Nvbm4ucm9sbGJhY2soKTsKICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\ndGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBmYWxzZTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmV0YWluQ29ubmVj\ndGlvbigpIHsKICAgICAgICBjb25uZWN0KGZhbHNlKTsKICAgICAgICBfY29u\nbi5zZXRSZXRhaW4odHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVs\nZWFzZUNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKF9jb25uICE9IG51bGwp\nCiAgICAgICAgICAgIF9jb25uLnNldFJldGFpbihmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBnZXRDbGllbnRDb25uZWN0aW9uKCkgewogICAg\nICAgIHJldHVybiBuZXcgQ2xpZW50Q29ubmVjdGlvbihnZXRDb25uZWN0aW9u\nKCkpOwogICAgfQoKICAgIHB1YmxpYyBDb25uZWN0aW9uIGdldENvbm5lY3Rp\nb24oKSB7CiAgICAgICAgY29ubmVjdCh0cnVlKTsKICAgICAgICByZXR1cm4g\nX2Nvbm47CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBEYXRhU291cmNlIGdl\ndERhdGFTb3VyY2UoKSB7CiAgICAJcmV0dXJuIF9kczsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUgY29uZGl0\naW9ucyBvbiBiYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1YmNsYXNz\nCiAgICAgICAgLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZpZXIKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgcmV0dXJuIGV4aXN0cyhtYXBwaW5n\nLCBzbS5nZXRPYmplY3RJZCgpLCBjb250ZXh0KTsKICAgIH0KCiAgICBwcml2\nYXRlIGJvb2xlYW4gZXhpc3RzKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPYmpl\nY3Qgb2lkLCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIGFkZCB3aGVy\nZSBjb25kaXRpb25zIG9uIGJhc2UgY2xhc3MgdG8gYXZvaWQgam9pbnMgaWYg\nc3ViY2xhc3MKICAgICAgICAvLyBkb2Vzbid0IHVzZSBvaWQgYXMgaWRlbnRp\nZmllcgogICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwog\nICAgICAgIHdoaWxlIChtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIG1hcHBpbmcgPSBtYXBw\naW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAg\nICBzZWwud2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFwcGluZywgdGhpcyk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHNlbC5nZXRDb3VudCh0\naGlzKSAhPSAwOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNl\nLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHN5bmNWZXJzaW9uKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xh\nc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJldHVybiBtYXBwaW5nLmdldFZlcnNpb24oKS5jaGVja1Zl\ncnNpb24oc20sIHRoaXMsIHRydWUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25z\nLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBpbnQgY29tcGFyZVZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBz\ndGF0ZSwgT2JqZWN0IHYxLCBPYmplY3QgdjIpIHsKICAgICAgICBDbGFzc01h\ncHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHN0YXRlLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNv\nbXBhcmVWZXJzaW9uKHYxLCB2Mik7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRl\nIHN0YXRlLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0g\nKENvbm5lY3Rpb25JbmZvKSBjb250ZXh0OwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJldHVybiBpbml0aWFsaXplU3RhdGUoc20sIHN0YXRlLCAoSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbikgZmV0Y2gsIAogICAgICAgICAgICAgICAg\naW5mbyk7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlv\nbiBjbmZlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBf\nZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlh\nbGl6ZSBhIG5ld2x5LWxvYWRlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaW5pdGlhbGl6ZVN0YXRlKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIFBDU3RhdGUgc3RhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgQ29ubmVjdGlvbkluZm8gaW5mbykKICAgICAg\nICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0T2JqZWN0SWQoKTsKICAg\nICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNt\nLmdldE1ldGFEYXRhKCk7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBp\nbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXMgPSBp\nbmZvLnJlc3VsdDsKICAgICAgICAgICAgICAgIGluZm8uc20gPSBzbTsKICAg\nICAgICAgICAgICAgIGlmIChpbmZvLm1hcHBpbmcgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAg\nICAgICAgICAgbWFwcGluZyA9IGluZm8ubWFwcGluZzsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQKICAgICAgICAg\nICAgICAgICYmICEoKE9wZW5KUEFJZCkgb2lkKS5oYXNTdWJjbGFzc2VzKCkp\nIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9h\nZChzbSwgbWFwcGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAgICAgICAg\nIGlmIChjdXN0b20gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gY3VzdG9tLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAgcmVz\nID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRj\naCwKICAgICAgICAgICAgICAgICAgICBTZWxlY3QuU1VCU19FWEFDVCk7CiAg\nICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVjdFByaW1h\ncnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eVJl\nc3VsdChyZXMpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZ1tdIG1hcHBpbmdzID0gbWFwcGluZy4KICAgICAgICAgICAgICAgICAg\nICBnZXRJbmRlcGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgICAg\nICAgICAgICAgaWYgKG1hcHBpbmdzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAg\nICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBpbmdzWzBdOwogICAgICAgICAg\nICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFw\ncGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nY3VzdG9tICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBjdXN0b20uYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAg\ncmVzID0gZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBm\nZXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0LlNVQlNfQU5Z\nX0pPSU5BQkxFKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzID09IG51\nbGwgJiYgIXNlbGVjdFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0\nSW5pdGlhbGl6ZVN0YXRlVW5pb25SZXN1bHQoc20sIG1hcHBpbmcsIG1hcHBp\nbmdzLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaCk7CiAgICAgICAg\nICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChyZXMpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gZmlndXJlIG91dCB3aGF0IHR5cGUgb2Ygb2JqZWN0IHRoaXMgaXM7\nIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgIC8vIG9ubHkgZ3VhcmFu\ndGVlcyB0byBwcm92aWRlIGEgYmFzZSBjbGFzcwogICAgICAgICAgICBDbGFz\ncyB0eXBlOwogICAgICAgICAgICBpZiAoKHR5cGUgPSBnZXRUeXBlKHJlcywg\nbWFwcGluZykpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXMu\nZ2V0QmFzZU1hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIG1hcHBpbmcgPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICAgICAg\nICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KG1hcHBpbmcuZ2V0RGlzY3JpbWlu\nYXRvcigpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgdHlwZSA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmdldENs\nYXNzKHRoaXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ncyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIHJlcy5lbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFsaXplIHRo\nZSBzdGF0ZSBtYW5hZ2VyOyB0aGlzIG1heSBjaGFuZ2UgdGhlIG1hcHBpbmcK\nICAgICAgICAgICAgLy8gYW5kIHRoZSBvYmplY3QgaWQgaW5zdGFuY2UgaWYg\ndGhlIHR5cGUgYXMgZGV0ZXJtaW5lZAogICAgICAgICAgICAvLyBmcm9tIHRo\nZSBpbmRpY2F0b3IgaXMgYSBzdWJjbGFzcyBvZiBleHBlY3RlZCB0eXBlCiAg\nICAgICAgICAgIHNtLmluaXRpYWxpemUodHlwZSwgc3RhdGUpOwoKICAgICAg\nICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3VsdCAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkQnlGaWVs\nZE1hcHBpbmcgPSBpbmZvLnJlc3VsdC4KICAgICAgICAgICAgICAgICAgICBn\nZXRNYXBwZWRCeUZpZWxkTWFwcGluZygpOwogICAgICAgICAgICAgICAgT2Jq\nZWN0IG1hcHBlZEJ5T2JqZWN0ID0gaW5mby5yZXN1bHQuZ2V0TWFwcGVkQnlW\nYWx1ZSgpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5RmllbGRNYXBw\naW5nICE9IG51bGwgJiYgbWFwcGVkQnlPYmplY3QgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBpZiAobWFwcGVkQnlPYmplY3QgaW5zdGFuY2VvZiBP\ncGVuSlBBSWQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZy5n\nZXRFeHRyYUZpZWxkRGF0YUluZGV4KG1hcHBlZEJ5RmllbGRNYXBwaW5nLgog\nICAgICAgICAgICAgICAgICAgICAgICBnZXRJbmRleCgpKSAhPSAtMSkKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGludmVyc2UgcmVsYXRpb24g\nY2FuIG5vdCBiZSBzZXQgc2luY2UKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gd2UgYXJlIGVhZ2VybHkgbG9hZGluZyB0aGlzIHNtIGZvcgogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBhIHNtIG93bmVyIHRoYXQgaXMgc3RpbGwg\naW4gdGhlIHByb2Nlc3Mgb2YgCiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGluaXRpYWxpemluZyBpdHNlbGYuCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIFJlbWVtYmVyIG93bmVyIG9pZCBieSBzZXRJbnRlcm1lZGlhdGUoKS4K\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGludmVyc2UgcmVsYXRp\nb24gaXMgc2V0IGxhdGVyIGJ5CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIHNldEludmVyc2VSZWxhdGlvbigpIHdoZW4gdGhlIHNtIG93bmVyIGlzIGZ1\nbGx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemVkLgog\nICAgICAgICAgICAgICAgICAgICAgICBzbS5zZXRJbnRlcm1lZGlhdGUobWFw\ncGVkQnlGaWVsZE1hcHBpbmcuZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNldE1hcHBlZEJ5\nKHNtLCBtYXBwZWRCeUZpZWxkTWFwcGluZywgbWFwcGVkQnlPYmplY3QpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGxvYWQgdGhlIHNlbGVjdGVk\nIG1hcHBpbmdzIGludG8gdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIKICAgICAg\nICAgICAgaWYgKHJlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBy\nZS1nZXQgdGhlIG1hcHBpbmcgaW4gY2FzZSB0aGUgaW5zdGFuY2Ugd2FzIGEg\nc3ViY2xhc3MKICAgICAgICAgICAgICAgIG1hcHBpbmcgPSAoQ2xhc3NNYXBw\naW5nKSBzbS5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgbG9hZCht\nYXBwaW5nLCBzbSwgZmV0Y2gsIHJlcyk7CiAgICAgICAgICAgICAgICBnZXRW\nZXJzaW9uKG1hcHBpbmcsIHNtLCByZXMpOwogICAgICAgICAgICAgICAgc2V0\nSW52ZXJzZVJlbGF0aW9uKHNtLCBtYXBwaW5nLCByZXMpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCAmJiAoaW5mbyA9PSBu\ndWxsIHx8IHJlcyAhPSBpbmZvLnJlc3VsdCkpCiAgICAgICAgICAgICAgICBy\nZXMuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHNldEludmVyc2VSZWxhdGlvbihPcGVuSlBBU3RhdGVNYW5hZ2VyIG93bmVy\nLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBSZXN1bHQgcmVzKSB7\nCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVs\nZE1hcHBpbmdzKCk7CgogICAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIHRoZSBv\nd25lciBpcyBmdWxseSBpbml0aWFsaXplZC4KICAgICAgICAvLyBDaGVjayBp\nZiB0aGUgb3duZXIgaGFzIGVhZ2VybHkgbG9hZGVkIFRvTWFueSByZWxhdGlv\nbnMuCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKHJlcy5nZXRFYWdlcihmbXNbaV0pICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIE9iamVjdCBjb2xsID0gIG93bmVy\nLmZldGNoT2JqZWN0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAgICAgICAg\nICAgIGlmIChjb2xsIGluc3RhbmNlb2YgQ29sbGVjdGlvbiAmJiAKICAgICAg\nICAgICAgICAgICAgICAoKENvbGxlY3Rpb24pIGNvbGwpLnNpemUoKSA+IDAp\nIHsKICAgICAgICAgICAgICAgICAgICAvLyBGb3VuZCBlYWdlcmx5IGxvYWRl\nZCBjb2xsZWN0aW9uLgogICAgICAgICAgICAgICAgICAgIC8vIFB1Ymxpc2hl\nciAoMSkgPD09PiAgKE0pIE1hZ2F6aW5lCiAgICAgICAgICAgICAgICAgICAg\nLy8gICAgcHVibGlzaGVyIGhhcyBhIEVBR0VSIE9uZVRvTWFueSByZWxhdGlv\nbgogICAgICAgICAgICAgICAgICAgIC8vICAgIG1hZ2F6aW5lIGhhcyBhIEVB\nR0VSIG9yIExBWlkgTWFueVRvT25lIHB1Ymxpc2hlcgogICAgICAgICAgICAg\nICAgICAgIC8vIEZvciBlYWNoIG1lbWJlciAoTWFnYXppbmUpIGluIHRoZSBj\nb2xsZWN0aW9uLCAKICAgICAgICAgICAgICAgICAgICAvLyBzZXQgaXRzIGlu\ndmVyc2UgcmVsYXRpb24gKFB1Ymxpc2hlcikuCiAgICAgICAgICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpdHIgPSAoKENvbGxlY3Rpb24pIGNvbGwpLml0\nZXJhdG9yKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYyA9IChQZXJzaXN0ZW5jZUNhcGFibGUpIGl0ci5uZXh0KCk7Cgog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAg\nICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA9IChPcGVuSlBB\nU3RhdGVNYW5hZ2VyKSBwYy4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHBjR2V0U3RhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZtZCA9ICgoQ2xhc3NNYXBwaW5nKSBzbS5nZXRN\nZXRhRGF0YSgpKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEZp\nZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChp\nbnQgaiA9IDA7IGogPCBmbWQubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIE9iamVjdCBvaWQgPSBzbS5nZXRJbnRlcm1lZGlh\ndGUoZm1kW2pdLmdldEluZGV4KCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gaWYgb2lkIHdhcyBzZXRJbnRlcm1lZGlhdGUoKSBwcmV2aW91\nc2x5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgaXQgaXMg\ndGhlIHNhbWUgYXMgdGhlIG93bmVyLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gdGhlbiBzZXQgdGhlIGludmVyc2UgcmVsYXRpb24KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChvaWQgIT0gbnVsbCAmJgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9pZC5lcXVhbHMob3duZXIu\nZ2V0T2JqZWN0SWQoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBzbS5zdG9yZU9iamVjdChmbWRbal0uZ2V0SW5kZXgoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIuZ2V0UGVyc2lz\ndGVuY2VDYXBhYmxlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIHNldE1hcHBlZEJ5KE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgRmllbGRNYXBwaW5nIG1hcHBlZEJ5Rmll\nbGRNYXBwaW5nLCBPYmplY3QgbWFwcGVkQnlPYmplY3QpIHsKICAgICAgICBD\nbGFzc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1l\ndGFEYXRhKCk7CiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0gbWFwcGlu\nZy5nZXREZWNsYXJlZEZpZWxkTWFwcGluZ3MoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoZm1zW2ldID09IG1hcHBlZEJ5RmllbGRNYXBwaW5nKSB7CiAgICAgICAg\nICAgICAgICBzbS5zdG9yZU9iamVjdChmbXNbaV0uZ2V0SW5kZXgoKSwgbWFw\ncGVkQnlPYmplY3QpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3Ig\nSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB2\nZXJzaW9uIGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGdldFZlcnNpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgUmVzdWx0IHJlcykgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9u\nKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBu\nb24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBv\nZiBjaGVja2luZyB3aGV0aGVyIHRoZSByZXN1bHQgc2V0IGlzIGVtcHR5IG9y\nIG5vdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNFbXB0eVJl\nc3VsdChSZXN1bHQgcmVzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAocmVzICE9IG51bGwgJiYgIXJlcy5uZXh0KCkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBnZXR0aW5nIHR5cGUgZnJvbSB0aGUgcmVzdWx0IHNl\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIENsYXNzIGdldFR5cGUoUmVzdWx0\nIHJlcywgQ2xhc3NNYXBwaW5nIG1hcHBpbmcpewogICAgICAgIGlmIChyZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG1hcHBpbmcuZ2V0RGVzY3Jp\nYmVkVHlwZSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogQWxsb3cgdGhlIG1hcHBpbmcgdG8gY3VzdG9tIGxvYWQgZGF0\nYS4gUmV0dXJuIG51bGwgaWYgdGhlIG1hcHBpbmcKICAgICAqIGRvZXMgbm90\nIHVzZSBjdXN0b20gbG9hZGluZy4KICAgICAqLwogICAgcHJpdmF0ZSBCb29s\nZWFuIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgUENTdGF0ZSBzdGF0ZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAgICB0aHJvd3MgQ2xhc3NO\nb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBj\naGVjayB0byBzZWUgaWYgdGhlIG1hcHBpbmcgdGFrZXMgY2FyZSBvZiBpbml0\naWFsaXphdGlvbgogICAgICAgIGlmICghbWFwcGluZy5jdXN0b21Mb2FkKHNt\nLCB0aGlzLCBzdGF0ZSwgZmV0Y2gpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxv\nYWQoc20sIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVF\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0aGUgZGF0YSBmb3IgdGhlIGdp\ndmVuIGluc3RhbmNlIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4gUmV0dXJuCiAg\nICAgKiBudWxsIGlmIHRoZXJlIGlzIG5vIGRhdGEgaW4gdGhlIGN1cnJlbnQg\nZmV0Y2ggZ3JvdXBzIHRvIHNlbGVjdC4KICAgICAqLwogICAgcHJpdmF0ZSBS\nZXN1bHQgZ2V0SW5pdGlhbGl6ZVN0YXRlUmVzdWx0KE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBzdWJzKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIExpc3QgcGFyYW1zID0gbmV3\nIEFycmF5TGlzdCgpOwogICAgICAgIFNlbGVjdCBzZWwgPSBuZXdTZWxlY3Qo\nc20sIG1hcHBpbmcsIGZldGNoLCBzdWJzLCBwYXJhbXMpOwogICAgICAgIGlm\nIChzZWwgPT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIHNl\nbC5leGVjdXRlKHRoaXMsIGZldGNoLCBwYXJhbXMpOwogICAgfQoKICAgIHBy\naXZhdGUgU2VsZWN0IG5ld1NlbGVjdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgc3VicywKICAgICAgICBMaXN0IHBhcmFt\ncykgewogICAgICAgIGlmICghX2lzUXVlcnlTUUxDYWNoZSkgCiAgICAgICAg\nICAgIHJldHVybiBuZXdTZWxlY3Qoc20sIG1hcHBpbmcsIGZldGNoLCBzdWJz\nKTsgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgTWFwPFNlbGVjdEtleSwg\nU2VsZWN0PiBzZWxlY3RJbXBsQ2FjaGVNYXAgPSAKICAgICAgICAgICAgZ2V0\nQ2FjaGVNYXBGcm9tUXVlcnlTUUxDYWNoZShKREJDU3RvcmVNYW5hZ2VyLmNs\nYXNzKTsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoQ2xv\nbmUgPSBuZXcgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwoKTsKICAgICAg\nICBmZXRjaENsb25lLmNvcHkoZmV0Y2gpOwogICAgICAgIFNlbGVjdEtleSBz\nZWxLZXkgPSBuZXcgU2VsZWN0S2V5KG1hcHBpbmcsIG51bGwsIGZldGNoQ2xv\nbmUpOwogICAgICAgIFNlbGVjdCBzZWwgPSBudWxsOwogICAgICAgIGJvb2xl\nYW4gZm91bmQgPSB0cnVlOwogICAgICAgIE9iamVjdCBvYmogPSBzZWxlY3RJ\nbXBsQ2FjaGVNYXAuZ2V0KHNlbEtleSk7CiAgICAgICAgaWYgKG9iaiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc2VsZWN0SW1wbENh\nY2hlTWFwKSB7CiAgICAgICAgICAgICAgICBvYmogPSBzZWxlY3RJbXBsQ2Fj\naGVNYXAuZ2V0KHNlbEtleSk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBOb3QgZm91bmQgaW4g\nY2FjaGUsIGNyZWF0ZSBhIG5ldyBzZWxlY3QKICAgICAgICAgICAgICAgICAg\nICBvYmogPSBuZXdTZWxlY3Qoc20sIG1hcHBpbmcsIGZldGNoLCBzdWJzKTsK\nICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAg\naWYgKG9iaiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYg\ndGhlIGdlbmVyYXRlZCBTZWxlY3RJbXBsIGlzIG51bGwsIHN0b3JlIGEgZ2Vu\nZXJpYwogICAgICAgICAgICAgICAgICAgIC8vIGtub3duIG9iamVjdCBpbiB0\naGUgY2FjaGUgYXMgYSBwbGFjZWhvbGRlci4gU29tZSBtYXAgCiAgICAgICAg\nICAgICAgICAgICAgLy8gaW1wbGVtZW50YXRpb25zIGRvIG5vdCBhbGxvdyBu\ndWxsIHZhbHVlcy4KICAgICAgICAgICAgICAgICAgICBvYmogPSBfbnVsbENh\nY2hlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9i\naiAhPSBfbnVsbENhY2hlVmFsdWUpCiAgICAgICAgICAgICAgICB7CiAgICAg\nICAgICAgICAgICAgICAgc2VsID0gKFNlbGVjdClvYmo7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKHNlbC5nZXRTUUwoKSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNlbC5zZXRTUUwodGhpcywgZmV0Y2gpOwogICAg\nICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGlmICghZm91bmQpIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb1NxbENh\nY2hlKHNlbGVjdEltcGxDYWNoZU1hcCwgc2VsS2V5LCBvYmopOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBp\nZiAob2JqICE9IG51bGwgJiYgb2JqICE9IF9udWxsQ2FjaGVWYWx1ZSkKICAg\nICAgICAgICAgc2VsID0gKFNlbGVjdCkgb2JqOwoKICAgICAgICBMb2cgbG9n\nID0gX2NvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsK\nICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgaWYgKCFmb3VuZCkKICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9j\nLmdldCgiY2FjaGUtbWlzc2VkIiwgbWFwcGluZywgdGhpcy5nZXRDbGFzcygp\nKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvZy50cmFj\nZShfbG9jLmdldCgiY2FjaGUtaGl0IiwgbWFwcGluZywgdGhpcy5nZXRDbGFz\ncygpKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIAogICAgICAgIE9iamVj\ndCBvaWQgPSBzbS5nZXRPYmplY3RJZCgpOwogICAgICAgIENvbHVtbltdIGNv\nbHMgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAg\nc2VsLndoZXJlUHJpbWFyeUtleShtYXBwaW5nLCBjb2xzLCBjb2xzLCBvaWQs\nIHRoaXMsIAogICAgICAgIAludWxsLCBudWxsLCBwYXJhbXMpOwogICAgICAg\nIHJldHVybiBzZWw7CiAgICB9CgogICAgcHJvdGVjdGVkIFNlbGVjdCBuZXdT\nZWxlY3QoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBDbGFzc01h\ncHBpbmcgbWFwcGluZywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwg\naW50IHN1YnMpIHsKICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxl\nY3QoKTsKICAgICAgICBpZiAoIXNlbGVjdChzZWwsIG1hcHBpbmcsIHN1YnMs\nIHNtLCBudWxsLCBmZXRjaCwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbi5FQUdFUl9KT0lOLCB0cnVlLCBmYWxzZSkpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXkoc20u\nZ2V0T2JqZWN0SWQoKSwgbWFwcGluZywgdGhpcyk7CiAgICAgICAgc2VsLnNl\ndEV4cGVjdGVkUmVzdWx0Q291bnQoMSwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgYSB1bmlvbiBv\nZiB0aGUgZGF0YSBmb3IgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gcG9zc2li\nbGUgY29uY3JldGUKICAgICAqIG1hcHBpbmdzIGFuZCByZXR1cm4gdGhlIHJl\nc3VsdC4KICAgICAqLwogICAgcHJpdmF0ZSBSZXN1bHQgZ2V0SW5pdGlhbGl6\nZVN0YXRlVW5pb25SZXN1bHQoZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgZmluYWwgQ2xhc3NN\nYXBwaW5nW10gbWFwcGluZ3MsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgZmluYWwgSkRCQ1N0b3JlTWFuYWdlciBzdG9yZSA9IHRoaXM7CiAgICAg\nICAgZmluYWwgaW50IGVhZ2VyID0gTWF0aC5taW4oZmV0Y2guZ2V0RWFnZXJG\nZXRjaE1vZGUoKSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbi5FQUdFUl9KT0lOKTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBfc3FsLm5l\nd1VuaW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgdW5pb24uc2V0RXhw\nZWN0ZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7CiAgICAgICAgaWYgKGZldGNo\nLmdldFN1YmNsYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGZldGNoLkVBR0VS\nX0pPSU4pCiAgICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAg\nICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGkpIHsK\nICAgICAgICAgICAgICAgIHNlbC5zZWxlY3QobWFwcGluZ3NbaV0sIFNlbGVj\ndC5TVUJTX0FOWV9KT0lOQUJMRSwgc3RvcmUsIGZldGNoLAogICAgICAgICAg\nICAgICAgICAgIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZVBy\naW1hcnlLZXkoc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZ3NbaV0sIHN0b3Jl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiB1\nbmlvbi5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNlbGVjdCBwcmltYXJ5IGtleSBkYXRhIHRvIG1ha2Ugc3VyZSB0aGUg\nZ2l2ZW4gaW5zdGFuY2UgZXhpc3RzLCBsb2NraW5nCiAgICAgKiBpZiBuZWVk\nZWQuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBzZWxlY3RQcmltYXJ5\nS2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2VsZWN0\nIHBrcyBmcm9tIGJhc2UgY2xhc3MgcmVjb3JkIHRvIGVuc3VyZSBpdCBleGlz\ndHMgYW5kIGxvY2sKICAgICAgICAvLyBpdCBpZiBuZWVkZWQKICAgICAgICBD\nbGFzc01hcHBpbmcgYmFzZSA9IG1hcHBpbmc7CiAgICAgICAgd2hpbGUgKGJh\nc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkK\nICAgICAgICAgICAgYmFzZSA9IGJhc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7CgogICAgICAgIFNlbGVjdCBzZWwgPSBfc3FsLm5ld1Nl\nbGVjdCgpOwogICAgICAgIHNlbC5zZWxlY3QoYmFzZS5nZXRQcmltYXJ5S2V5\nQ29sdW1ucygpKTsKICAgICAgICBzZWwud2hlcmVQcmltYXJ5S2V5KHNtLmdl\ndE9iamVjdElkKCksIGJhc2UsIHRoaXMpOwogICAgICAgIFJlc3VsdCBleGlz\ndHMgPSBzZWwuZXhlY3V0ZSh0aGlzLCBmZXRjaCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKGlzRW1wdHlSZXN1bHQoZXhpc3RzKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIHJlY29y\nZCBsb2NrZWQ/CiAgICAgICAgICAgIGlmIChfYWN0aXZlICYmIF9sbSAhPSBu\ndWxsICYmIGV4aXN0cy5pc0xvY2tpbmcoKSkKICAgICAgICAgICAgICAgIF9s\nbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBleGlzdHMuY2xv\nc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9h\nZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAg\nICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwg\nT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGpmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSBmZXRjaDsK\nCiAgICAgICAgLy8gZ2V0IGEgY29ubmVjdGlvbiwgb3IgcmV1c2UgY3VycmVu\ndCBvbmUKICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5lY3Rp\nb25JbmZvKSBjb250ZXh0OwogICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwog\nICAgICAgIGlmIChpbmZvICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYg\naW5pdGlhbGl6ZSgpIGZhaWxzIHRvIGxvYWQgcmVxdWlyZWQgZmllbGRzLCB0\naGVuIHRoaXMgbWV0aG9kCiAgICAgICAgICAgIC8vIGlzIGNhbGxlZDsgbWFr\nZSBzdXJlIG5vdCB0byB0cnkgdG8gdXNlIHRoZSBnaXZlbiByZXN1bHQgaWYg\naXQncwogICAgICAgICAgICAvLyB0aGUgc2FtZSBvbmUgd2UganVzdCBmYWls\nZWQgdG8gY29tcGxldGVseSBpbml0aWFsaXplKCkgd2l0aAogICAgICAgICAg\nICBpZiAoaW5mby5zbSAhPSBzbSkKICAgICAgICAgICAgICAgIHJlcyA9IGlu\nZm8ucmVzdWx0OwogICAgICAgICAgICBpbmZvLnNtID0gbnVsbDsKICAgICAg\nICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBh\nbiBleGlzdGluZyByZXN1bHQsIGxvYWQgYWxsIHdlIGNhbiBmcm9tIGl0CiAg\nICAgICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nID0gKENsYXNzTWFwcGlu\nZykgc20uZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHJlcyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0\nY2gsIHJlcyk7CiAgICAgICAgICAgICAgICByZW1vdmVMb2FkZWRGaWVsZHMo\nc20sIGZpZWxkcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlm\nIHRoZSBpbnN0YW5jZSBpcyBob2xsb3cgYW5kIHRoZXJlJ3MgYSBjdXN0b21p\nemVkCiAgICAgICAgICAgIC8vIGdldCBieSBpZCBtZXRob2QsIHVzZSBpdAog\nICAgICAgICAgICBpZiAoc20uZ2V0TG9hZGVkKCkubGVuZ3RoKCkgPT0gMCAK\nICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuY3VzdG9tTG9hZChzbSwgdGhp\ncywgbnVsbCwgamZldGNoKSkKICAgICAgICAgICAgICAgIHJlbW92ZUxvYWRl\nZEZpZWxkcyhzbSwgZmllbGRzKTsKCiAgICAgICAgICAgIC8vIyMjIHNlbGVj\ndCBpcyBraW5kIG9mIGEgYmlnIG9iamVjdCwgYW5kIGluIHNvbWUgY2FzZXMg\nd2UgZG9uJ3QKICAgICAgICAgICAgLy8jIyMgdXNlIGl0Li4uIHdvdWxkIGl0\nIGJlIHdvcnRoIGl0IHRvIGhhdmUgYSBzbWFsbCBzaGVsbCBzZWxlY3QKICAg\nICAgICAgICAgLy8jIyMgb2JqZWN0IHRoYXQgb25seSBjcmVhdGVzIGEgcmVh\nbCBzZWxlY3Qgd2hlbiBhY3R1YWxseSB1c2VkPwoKICAgICAgICAgICAgU2Vs\nZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIGlmIChz\nZWxlY3Qoc2VsLCBtYXBwaW5nLCBTZWxlY3QuU1VCU19FWEFDVCwgc20sIGZp\nZWxkcywgamZldGNoLAogICAgICAgICAgICAgICAgRWFnZXJGZXRjaE1vZGVz\nLkVBR0VSX0pPSU4sIHRydWUsIGZhbHNlKSkgewogICAgICAgICAgICAgICAg\nc2VsLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5n\nLCB0aGlzKTsKICAgICAgICAgICAgICAgIHJlcyA9IHNlbC5leGVjdXRlKHRo\naXMsIGpmZXRjaCwgbG9ja0xldmVsKTsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgCWlmIChpc0VtcHR5UmVzdWx0KHJlcykpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICBsb2FkKG1hcHBpbmcsIHNtLCBqZmV0Y2gsIHJlcyk7CiAg\nICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAg\nIHJlcy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBub3cgYWxsb3cgdGhlIGZpZWxkcyB0byBsb2Fk\nIHRoZW1zZWx2ZXMgaW5kaXZpZHVhbGx5IHRvbwogICAgICAgICAgICBGaWVs\nZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldEZpZWxkTWFwcGluZ3MoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICBpZiAoZmllbGRzLmdldChpKSAmJiAhc20u\nZ2V0TG9hZGVkKCkuZ2V0KGkpKQogICAgICAgICAgICAgICAgICAgIGZtc1tp\nXS5sb2FkKHNtLCB0aGlzLCBqZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSkp\nOwogICAgICAgICAgICBtYXBwaW5nLmdldFZlcnNpb24oKS5hZnRlckxvYWQo\nc20sIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nIGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGNuZmUpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGNuZmUpOwogICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJv\ndyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbGlzdCBmb3JtZWQg\nYnkgcmVtb3ZpbmcgYWxsIGxvYWRlZCBmaWVsZHMgZnJvbSB0aGUgZ2l2ZW4g\nb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlTG9hZGVkRmll\nbGRzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMpIHsK\nICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gZmllbGRzLmxlbmd0aCgp\nOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgIGlmIChmaWVsZHMuZ2V0KGkp\nICYmIHNtLmdldExvYWRlZCgpLmdldChpKSkKICAgICAgICAgICAgICAgIGZp\nZWxkcy5jbGVhcihpKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBs\nb2FkQWxsKENvbGxlY3Rpb24gc21zLCBQQ1N0YXRlIHN0YXRlLCBpbnQgbG9h\nZCwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIubG9hZEFsbChz\nbXMsIHRoaXMsIHN0YXRlLCBsb2FkLCBmZXRjaCwgY29udGV4dCk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgYmVmb3JlU3RhdGVDaGFuZ2UoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgUENTdGF0ZSBmcm9tU3RhdGUsCiAgICAgICAgUENT\ndGF0ZSB0b1N0YXRlKSB7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24g\nZmx1c2goQ29sbGVjdGlvbiBzbXMpIHsKICAgICAgICByZXR1cm4gX2NvbmYu\nZ2V0VXBkYXRlTWFuYWdlckluc3RhbmNlKCkuZmx1c2goc21zLCB0aGlzKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5jZWxBbGwoKSB7CiAgICAg\nICAgLy8gbm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGxvY2sgdGhl\nIGNvbnRleHQsIHNpbmNlCiAgICAgICAgLy8gd2Ugd2FudCB0byBhbGxvdyBh\nIGRpZmZlcmVudCB0aHJlYWQgdG8gYmUgYWJsZSB0byBjYW5jZWwgdGhlCiAg\nICAgICAgLy8gb3V0c3RhbmRpbmcgc3RhdGVtZW50IG9uIGEgZGlmZmVyZW50\nIGNvbnRleHQKCiAgICAgICAgQ29sbGVjdGlvbiBzdG1udHM7CiAgICAgICAg\nc3luY2hyb25pemVkIChfc3RtbnRzKSB7CiAgICAgICAgICAgIGlmIChfc3Rt\nbnRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgc3RtbnRzID0gbmV3IEFycmF5TGlzdChfc3RtbnRzKTsK\nICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gc3RtbnRzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKQogICAgICAgICAgICAgICAgKChTdGF0ZW1lbnQpIGl0ci5uZXh0KCkpLmNh\nbmNlbCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25PYmplY3RJZChPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBib29sZWFuIHByZUZsdXNoKSB7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0YURhdGEoKTsKICAgICAg\nICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRh\nLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICByZXR1cm4gQXBwbGljYXRp\nb25JZHMuYXNzaWduKHNtLCB0aGlzLCBwcmVGbHVzaCk7CgogICAgICAgIC8v\nIGRhdGFzdG9yZSBpZGVudGl0eQogICAgICAgIE9iamVjdCB2YWwgPSBJbXBs\nSGVscGVyLmdlbmVyYXRlSWRlbnRpdHlWYWx1ZShfY3R4LCBtZXRhLAogICAg\nICAgICAgICBKYXZhVHlwZXMuTE9ORyk7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsICYmIG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpICE9IFZhbHVlU3Ry\nYXRlZ2llcy5OQVRJVkUpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgIHZhbCA9IGdldERh\ndGFTdG9yZUlkU2VxdWVuY2UobWV0YSkubmV4dChfY3R4LCBtZXRhKTsKICAg\nICAgICBzbS5zZXRPYmplY3RJZChuZXdEYXRhU3RvcmVJZCh2YWwsIG1ldGEp\nKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBhc3NpZ25GaWVsZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQg\nZmllbGQsCiAgICAgICAgYm9vbGVhbiBwcmVGbHVzaCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgT2JqZWN0IHZhbCA9IEltcGxIZWxwZXIuZ2VuZXJh\ndGVGaWVsZFZhbHVlKF9jdHgsIGZtZCk7CiAgICAgICAgaWYgKHZhbCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc20uc3Rv\ncmUoZmllbGQsIHZhbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgcHVibGljIENsYXNzIGdldE1hbmFnZWRUeXBlKE9iamVjdCBvaWQpIHsK\nICAgICAgICBpZiAob2lkIGluc3RhbmNlb2YgSWQpCiAgICAgICAgICAgIHJl\ndHVybiAoKElkKSBvaWQpLmdldFR5cGUoKTsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0RGF0YVN0b3JlSWRUeXBl\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBJZC5jbGFz\nczsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGNvcHlEYXRhU3RvcmVJZChP\nYmplY3Qgb2lkLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBJZCBp\nZCA9IChJZCkgb2lkOwogICAgICAgIHJldHVybiBuZXcgSWQobWV0YS5nZXRE\nZXNjcmliZWRUeXBlKCksIGlkLmdldElkKCksIGlkLmhhc1N1YmNsYXNzZXMo\nKSk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdEYXRhU3RvcmVJZChP\nYmplY3QgdmFsLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1\ncm4gSWQubmV3SW5zdGFuY2UobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIHZh\nbCk7CiAgICB9CgogICAgcHVibGljIElkIG5ld0RhdGFTdG9yZUlkKGxvbmcg\naWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIHN1YnMpIHsKICAg\nICAgICByZXR1cm4gbmV3IElkKG1hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgp\nLCBpZCwgc3Vicyk7CiAgICB9CgogICAgcHVibGljIFJlc3VsdE9iamVjdFBy\nb3ZpZGVyIGV4ZWN1dGVFeHRlbnQoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAg\nICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xhc3NlcywgRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAo\nQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAgICAgIGZpbmFsIENsYXNzTWFwcGlu\nZ1tdIG1hcHBpbmdzOwogICAgICAgIGlmIChzdWJjbGFzc2VzKQogICAgICAg\nICAgICBtYXBwaW5ncyA9IG1hcHBpbmcuZ2V0SW5kZXBlbmRlbnRBc3NpZ25h\nYmxlTWFwcGluZ3MoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1hcHBp\nbmdzID0gbmV3IENsYXNzTWFwcGluZ1tdIHsgbWFwcGluZyB9OwoKICAgICAg\nICBSZXN1bHRPYmplY3RQcm92aWRlcltdIHJvcHMgPSBudWxsOwogICAgICAg\nIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gamZldGNoID0gKEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24pIGZldGNoOwogICAgICAgIGlmIChqZmV0Y2gu\nZ2V0U3ViY2xhc3NGZXRjaE1vZGUobWFwcGluZykgIT0gamZldGNoLkVBR0VS\nX0pPSU4pCiAgICAgICAgICAgIHJvcHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJv\ndmlkZXJbbWFwcGluZ3MubGVuZ3RoXTsKCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gY2hlY2sgZm9yIGN1c3RvbSBsb2FkcwogICAgICAgICAgICBS\nZXN1bHRPYmplY3RQcm92aWRlciByb3A7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIHJvcCA9IG1hcHBpbmdzW2ldLmN1c3RvbUxvYWQodGhpcywgc3Vi\nY2xhc3NlcywgamZldGNoLCAwLAogICAgICAgICAgICAgICAgICAgIExvbmcu\nTUFYX1ZBTFVFKTsKICAgICAgICAgICAgICAgIGlmIChyb3AgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgIGlmIChyb3BzID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJvcHMgPSBuZXcgUmVzdWx0T2JqZWN0UHJv\ndmlkZXJbbWFwcGluZ3MubGVuZ3RoXTsKICAgICAgICAgICAgICAgICAgICBy\nb3BzW2ldID0gcm9wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBpZiB3ZSdyZSBzZWxlY3RpbmcgaW5kZXBlbmRl\nbnQgbWFwcGluZ3Mgc2VwYXJhdGVseSBvciBoYXZlCiAgICAgICAgICAgIC8v\nIGN1c3RvbSBsb2FkcywgZG8gaW5kaXZpZHVhbCBzZWxlY3RzIGZvciBlYWNo\nIGNsYXNzCiAgICAgICAgICAgIHJvcCA9IG51bGw7CiAgICAgICAgICAgIGlm\nIChyb3BzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAocm9wc1tpXSAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0\nIHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7CiAgICAgICAgICAgICAgICAgICAg\nc2VsLnNldExSUyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBCaXRTZXQg\ncGFnZWQgPSBzZWxlY3RFeHRlbnQoc2VsLCBtYXBwaW5nc1tpXSwgamZldGNo\nLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJjbGFzc2VzKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgcm9wc1tpXSA9IG5ldyBJbnN0YW5jZVJlc3VsdE9iamVj\ndFByb3ZpZGVyKHNlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1h\ncHBpbmdzW2ldLCB0aGlzLCBqZmV0Y2gpOwogICAgICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9IG5ldyBQ\nYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcihzZWwsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtYXBwaW5nc1tpXSwgdGhpcywgamZldGNoLCBwYWdl\nZCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaWYgKHJvcHMubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHJvcHNbMF07CiAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IE1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyKHJvcHMpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBwZXJmb3JtIGEgdW5pb24gb24gYWxs\nIGluZGVwZW5kZW50IGNsYXNzZXMKICAgICAgICAgICAgVW5pb24gdW5pb24g\nPSBfc3FsLm5ld1VuaW9uKG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgICAg\nIHVuaW9uLnNldExSUyh0cnVlKTsKICAgICAgICAgICAgZmluYWwgQml0U2V0\nW10gcGFnZWQgPSBuZXcgQml0U2V0W21hcHBpbmdzLmxlbmd0aF07CiAgICAg\nICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7CiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwg\naW50IGlkeCkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VkW2lkeF0gPSBz\nZWxlY3RFeHRlbnQoc2VsLCBtYXBwaW5nc1tpZHhdLCBqZmV0Y2gsCiAgICAg\nICAgICAgICAgICAgICAgICAgIHN1YmNsYXNzZXMpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIHVzaW5nIHBh\nZ2luZyByb3AgaWYgYW55IHVuaW9uIGVsZW1lbnQgaGFzIHBhZ2VkIGZpZWxk\ncwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBhZ2VkLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGFnZWRbaV0gIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBhZ2luZ1Jlc3Vs\ndE9iamVjdFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5ncywKICAgICAgICAgICAg\nICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBqZmV0Y2gsIHBh\nZ2VkLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIG5ldyBJbnN0YW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHVu\naW9uLCBtYXBwaW5nc1swXSwgdGhpcywKICAgICAgICAgICAgICAgIGpmZXRj\naCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhl\nIGdpdmVuIG1hcHBpbmcgZm9yIHVzZSBpbiBhbiBleHRlbnQsIHJldHVybmlu\nZyBwYWdlZCBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IHNl\nbGVjdEV4dGVudChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGluZywK\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFu\nIHN1YmNsYXNzZXMpIHsKICAgICAgICBpbnQgc3VicyA9IChzdWJjbGFzc2Vz\nKSA/IFNlbGVjdC5TVUJTX0pPSU5BQkxFIDogU2VsZWN0LlNVQlNfTk9ORTsK\nICAgICAgICAvLyBkZWNpZGUgYmV0d2VlbiBwYWdpbmcgYW5kIHN0YW5kYXJk\nIGl0ZXJhdGlvbgogICAgICAgIEJpdFNldCBwYWdlZCA9IFBhZ2luZ1Jlc3Vs\ndE9iamVjdFByb3ZpZGVyLmdldFBhZ2VkRmllbGRzKHNlbCwgbWFwcGluZywK\nICAgICAgICAgICAgdGhpcywgZmV0Y2gsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24uRUFHRVJfUEFSQUxMRUwsCiAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVF\nKTsKICAgICAgICBpZiAocGFnZWQgPT0gbnVsbCkKICAgICAgICAgICAgc2Vs\nLnNlbGVjdElkZW50aWZpZXIobWFwcGluZywgc3VicywgdGhpcywgZmV0Y2gs\nCiAgICAgICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VS\nX1BBUkFMTEVMKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNlbC5zZWxl\nY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YnMsIHRoaXMsIGZldGNoLAogICAg\nICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lO\nKTsKICAgICAgICByZXR1cm4gcGFnZWQ7CiAgICB9CgogICAgcHVibGljIFN0\nb3JlUXVlcnkgbmV3UXVlcnkoU3RyaW5nIGxhbmd1YWdlKSB7CiAgICAgICAg\nRXhwcmVzc2lvblBhcnNlciBlcCA9IFF1ZXJ5TGFuZ3VhZ2VzLnBhcnNlckZv\nckxhbmd1YWdlKGxhbmd1YWdlKTsKICAgICAgICBpZiAoZXAgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBKREJDU3RvcmVRdWVyeSh0aGlzLCBl\ncCk7CiAgICAgICAgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMLmVxdWFs\ncyhsYW5ndWFnZSkpCiAgICAgICAgICAgIHJldHVybiBuZXcgU1FMU3RvcmVR\ndWVyeSh0aGlzKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIG5ld0ZldGNoQ29uZmlndXJhdGlv\nbigpIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb25JbXBsKCk7CiAgICB9CgogICAgcHVibGljIFNlcSBnZXREYXRhU3RvcmVJ\nZFNlcXVlbmNlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmICht\nZXRhLmdldElkZW50aXR5U3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMu\nTkFUSVZFCiAgICAgICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVn\neSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICByZXR1\ncm4gX2NvbmYuZ2V0U2VxdWVuY2VJbnN0YW5jZSgpOwogICAgICAgIHJldHVy\nbiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5j\nZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGlmIChf\nY29ubiAhPSBudWxsKQogICAgICAgICAgICBfY29ubi5mcmVlKCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8v\nLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBDb25uZWN0IHRvIHRoZSBkYi4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNvbm5lY3QoYm9vbGVhbiByZWYp\nIHsKICAgICAgICBfY3R4LmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBjb25uZWN0IGlmIHRoZSBjb25uZWN0aW9uIGlzIGN1cnJlbnRs\neSBudWxsLCBvciBpZgogICAgICAgICAgICAvLyB0aGUgY29ubmVjdGlvbiBo\nYXMgYmVlbiBjbG9zZWQgb3V0IGZyb20gdW5kZXIgdXMKICAgICAgICAgICAg\naWYgKF9jb25uID09IG51bGwpCiAgICAgICAgICAgICAgICBfY29ubiA9IGNv\nbm5lY3RJbnRlcm5hbCgpOwogICAgICAgICAgICBpZiAocmVmKQogICAgICAg\nICAgICAgICAgX2Nvbm4ucmVmKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMu\nZ2V0U3RvcmUoc2UsIF9kaWN0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBfY3R4LnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENvbm5lY3QgdG8gdGhlIGRhdGFiYXNlLiBUaGlzIG1ldGhv\nZCBpcyBzZXBhcmF0ZWQgb3V0IHNvIHRoYXQgaXQKICAgICAqIGNhbiBiZSBv\ndmVycmlkZGVuLgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVmQ291bnRDb25u\nZWN0aW9uIGNvbm5lY3RJbnRlcm5hbCgpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBuZXcgUmVmQ291bnRDb25uZWN0aW9uKF9kcy5n\nZXRDb25uZWN0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICogRmluZCB0\naGUgb2JqZWN0IHdpdGggdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAgcHVi\nbGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIFZhbHVlTWFwcGluZyB2bSwg\nCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAg\nICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgT2JqZWN0IHBjID0gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIG51\nbGwsIG51bGwsIDApOwogICAgICAgIGlmIChwYyA9PSBudWxsICYmIHZtICE9\nIG51bGwpIHsKICAgICAgICAgICAgT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9u\nID0gX2NvbmYuZ2V0T3JwaGFuZWRLZXlBY3Rpb25JbnN0YW5jZSgpOwogICAg\nICAgICAgICBwYyA9IGFjdGlvbi5vcnBoYW4ob2lkLCBudWxsLCB2bSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBwYzsKICAgIH0KCiAgICAvKioKICAg\nICAqIExvYWQgdGhlIG9iamVjdCBpbiB0aGUgY3VycmVudCByb3cgb2YgdGhl\nIGdpdmVuIHJlc3VsdC4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBsb2Fk\nKENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLAogICAgICAgIEJpdFNldCBleGNsdWRlLCBSZXN1bHQgcmVzdWx0\nKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIW1hcHBpbmcu\naXNNYXBwZWQoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0\nZUV4Y2VwdGlvbihfbG9jLmdldCgidmlydHVhbC1tYXBwaW5nIiwgCiAgICAg\nICAgICAgICAgICBtYXBwaW5nKSk7CgogICAgICAgIC8vIGdldCB0aGUgb2Jq\nZWN0IGlkIGZvciB0aGUgcm93OyBiYXNlIGNsYXNzIHNlbGVjdHMgcGsgY29s\ndW1ucwogICAgICAgIENsYXNzTWFwcGluZyBiYXNlID0gbWFwcGluZzsKICAg\nICAgICB3aGlsZSAoYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKSAhPSBudWxsKQogICAgICAgICAgICBiYXNlID0gYmFzZS5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICBPYmplY3Qgb2lk\nID0gYmFzZS5nZXRPYmplY3RJZCh0aGlzLCByZXN1bHQsIG51bGwsIHRydWUs\nIG51bGwpOwogICAgICAgIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgIENvbm5lY3Rpb25JbmZvIGluZm8gPSBu\nZXcgQ29ubmVjdGlvbkluZm8oKTsKICAgICAgICBpbmZvLnJlc3VsdCA9IHJl\nc3VsdDsKICAgICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwoKICAgICAg\nICAvLyBpZiBpbnZlcnNlIHJlbGF0aW9uIGlzIGtub3duLCBleGNsdWRlIGxv\nYWRpbmcgZHVyaW5nIGZpbmQKICAgICAgICBleGNsdWRlID0gZXhjbHVkZUlu\ndmVyc2VSZWxhdGlvbihtYXBwaW5nLCBpbmZvLCBleGNsdWRlKTsKICAgICAg\nICByZXR1cm4gX2N0eC5maW5kKG9pZCwgZmV0Y2gsIGV4Y2x1ZGUsIGluZm8s\nIDApOwogICAgfQoKICAgIHByaXZhdGUgQml0U2V0IGV4Y2x1ZGVJbnZlcnNl\nUmVsYXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgQ29ubmVj\ndGlvbkluZm8gaW5mbywgQml0U2V0IGV4Y2x1ZGUpIHsKICAgICAgICBGaWVs\nZE1hcHBpbmcgaW52ZXJzZSA9IGluZm8ucmVzdWx0LmdldE1hcHBlZEJ5Rmll\nbGRNYXBwaW5nKCk7CiAgICAgICAgaWYgKGludmVyc2UgIT0gbnVsbCkgewog\nICAgICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBtYXBwaW5nLmdldERl\nZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgICAgIGlmIChleGNsdWRl\nID09IG51bGwpCiAgICAgICAgICAgICAgICBleGNsdWRlID0gbmV3IEJpdFNl\ndChmbXMubGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChmbXNb\naV0gPT0gaW52ZXJzZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGUu\nc2V0KGZtc1tpXS5nZXRJbmRleCgpKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gZXhjbHVkZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIExvYWQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgd2l0aCBkYXRhIGZy\nb20gdGhlIHJlc3VsdCBzZXQuIE9ubHkKICAgICAqIG1hcHBpbmdzIG9yaWdp\nbmFsbHkgc2VsZWN0ZWQgd2lsbCBiZSBsb2FkZWQuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5nLCBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSA9IGxvYWQobWFwcGlu\nZywgc20sIGZldGNoLCByZXMsIG51bGwpOwogICAgICAgIGlmIChlYWdlclRv\nTWFueSAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueS5sb2FkRWFn\nZXJKb2luKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZWFnZXJUb01h\nbnkpLAogICAgICAgICAgICAgICAgcmVzKTsKICAgICAgICBpZiAoX2FjdGl2\nZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2NraW5nKCkpCiAgICAgICAg\nICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAgfQoKICAgIC8qKgog\nICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBnaXZlbiBtYXBwaW5nLiBS\nZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQKICAgICAqIHdpdGhvdXQg\nbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcg\nbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBS\nZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG1hcHBpbmcuY3Vz\ndG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykpCiAgICAgICAgICAgIHJl\ndHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8gbG9hZCBzdXBlcmNsYXNz\nIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lvbgogICAgICAgIENsYXNz\nTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJlbnQgIT0gbnVsbCkKICAg\nICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBhcmVudCwgc20sIGZldGNo\nLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBlbHNlIGlmIChzbS5nZXRW\nZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgbWFwcGluZy5nZXRWZXJz\naW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAgICAgICAgLy8gbG9hZCB1\nbmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBt\nYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgT2Jq\nZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1zW2ld\nLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRlZCgpLmdldChmbXNbaV0u\nZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBlYWdlciByZXN1bHQs\nIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFyZCBsb2FkCiAgICAgICAg\nICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ldKTsKICAgICAgICAgICAg\ncmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0gcmVzKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09IG51bGwgJiYgZm1zW2ld\nLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9hZEVhZ2Vy\nSm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgICAgIAlmZXRj\naC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdlclBhcmFsbGVsKHNtLCB0\naGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJD\nKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcm9j\nZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnB1\ndEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5sb2FkKHNtLCB0aGlz\nLCBmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHJlcy5lbmREYXRhUmVx\ndWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvciBpbXBs\nZW1lbnRhdGlvbiB1c2Ugb25seS4KICAgICAqIFJldHVybiBhIHNlbGVjdCBm\nb3IgdGhlIHByb3BlciBtYXBwaW5ncy4gUmV0dXJuIG51bGwgaWYgbm8gc2Vs\nZWN0IGlzCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRob2QgaXMgZGVzaWduZWQg\ndG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGUgbG9hZCBtZXRob2RzLgogICAg\nICoKICAgICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRvIGJ1aWxkIG9uCiAgICAg\nKiBAcGFyYW0gbWFwcGluZyB0aGUgbWFwcGluZyBmb3IgdGhlIGJhc2UgdHlw\nZSB0byBzZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gc3VicyB3aGV0aGVyIHRo\nZSBzZWxlY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFzc2VzIG9mIHRoZQogICAg\nICogZ2l2ZW4gbWFwcGluZwogICAgICogQHBhcmFtIHNtIHN0YXRlIG1hbmFn\nZXIgaWYgYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9hZGVkIG9yCiAgICAgKiBp\nbml0aWFsaXplZCwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmllbGRzIGlm\nIGEgc3RhdGUgbWFuYWdlciBpcyBiZWluZyBsb2FkZWQsIHRoZSBzZXQgb2YK\nICAgICAqIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9hZGVkIGluIG9yZGVyLCBl\nbHNlIG51bGwKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2ggY29uZmln\ndXJhdGlvbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBmaWVsZHMKICAgICAqIG11\nc3QgYmUgbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNlbGVjdGluZyByZWxhdGlv\nbnMKICAgICAqIEBwYXJhbSBlYWdlciBlYWdlciBmZXRjaCBtb2RlIHRvIHVz\nZQogICAgICogQHBhcmFtIGlkZW50IHdoZXRoZXIgdG8gc2VsZWN0IHByaW1h\ncnkga2V5IGNvbHVtbnMgYXMgZGlzdGluY3QKICAgICAqIGlkZW50aWZpZXJz\nCiAgICAgKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3ZSdyZSBvdXRlci1qb2lu\naW5nIHRvIHRoaXMgdHlwZQogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBz\nZWxlY3QgaXMgcmVxdWlyZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyLCBib29sZWFuIGlkZW50LCBi\nb29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gYWRkIGNsYXNzIGNvbmRpdGlv\nbnMgc28gdGhhdCB0aGV5J3JlIGNsb25lZCBmb3IgYW55IGJhdGNoZWQgc2Vs\nZWN0cwogICAgICAgIGJvb2xlYW4gam9pbmVkU3VwZXJzID0gZmFsc2U7CiAg\nICAgICAgaWYgKChzbSA9PSBudWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQ\nQ1N0YXRlLlRSQU5TSUVOVCkKICAgICAgICAgICAgJiYgKHN1YnMgPT0gU2Vs\nZWN0LlNVQlNfSk9JTkFCTEUgfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05F\nKSkgewogICAgICAgICAgICBsb2FkU3ViY2xhc3NlcyhtYXBwaW5nKTsgCiAg\nICAgICAgICAgIEpvaW5zIGpvaW5zID0gKG91dGVyKSA/IHNlbC5uZXdPdXRl\nckpvaW5zKCkgOiBudWxsOwogICAgICAgICAgICBqb2luZWRTdXBlcnMgPSBt\nYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRDbGFzc0NvbmRpdGlvbnMo\nc2VsLAogICAgICAgICAgICAgICAgc3VicyA9PSBTZWxlY3QuU1VCU19KT0lO\nQUJMRSwgam9pbnMpOwogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIGFs\nbCBvdXIgZWFnZXIgc2VsZWN0cyBzbyB0aGF0IHRob3NlIGZpZWxkcyBhcmUg\ncmVzZXJ2ZWQKICAgICAgICAvLyBhbmQgY2Fubm90IGJlIHJldXNlZCBkdXJp\nbmcgdGhlIGFjdHVhbCBlYWdlciBzZWxlY3QgcHJvY2VzcywKICAgICAgICAv\nLyBwcmV2ZW50aW5nIGluZmluaXRlIHJlY3Vyc2lvbgogICAgICAgIGVhZ2Vy\nID0gTWF0aC5taW4oZWFnZXIsIGZldGNoLmdldEVhZ2VyRmV0Y2hNb2RlKCkp\nOwogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSA9IGNyZWF0ZUVh\nZ2VyU2VsZWN0cyhzZWwsIG1hcHBpbmcsIHNtLCBmaWVsZHMsCiAgICAgICAg\nICAgIGZldGNoLCBlYWdlcik7CgogICAgICAgIC8vIHNlbGVjdCBhbGwgYmFz\nZSBjbGFzcyBtYXBwaW5nczsgZG8gdGhpcyBhZnRlciBiYXRjaGluZyBzbyB0\naGF0CiAgICAgICAgLy8gdGhlIGpvaW5zIG5lZWRlZCBieSB0aGVzZSBzZWxl\nY3RzIGRvbid0IGdldCBpbiB0aGUgV0hFUkUgY2xhdXNlCiAgICAgICAgLy8g\nb2YgdGhlIGJhdGNoZWQgc2VsZWN0cwogICAgICAgIGludCBzZWxkID0gc2Vs\nZWN0QmFzZU1hcHBpbmdzKHNlbCwgbWFwcGluZywgbWFwcGluZywgc20sIGZp\nZWxkcywKICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyLCBlYWdlclRvTWFueSwg\naWRlbnQsIGpvaW5lZFN1cGVycyk7CgogICAgICAgIC8vIHNlbGVjdCBlYWdl\nciB0by1tYW55IHJlbGF0aW9ucyBsYXN0IGJlY2F1c2UgZHVyaW5nIGxvYWQg\ndGhleQogICAgICAgIC8vIGFkdmFuY2UgdGhlIHJlc3VsdCBzZXQgYW5kIGNv\ndWxkIGV4aGF1c3QgaXQsIHNvIG5vIG90aGVyIG1hcHBpbmdzCiAgICAgICAg\nLy8gY2FuIGxvYWQgYWZ0ZXJ3b3JkcwogICAgICAgIGlmIChlYWdlclRvTWFu\neSAhPSBudWxsKQogICAgICAgICAgICBlYWdlclRvTWFueS5zZWxlY3RFYWdl\nckpvaW4oc2VsLCBzbSwgdGhpcywgCiAgICAgICAgICAgICAgICBmZXRjaC50\ncmF2ZXJzZUpEQkMoZWFnZXJUb01hbnkpLCBlYWdlcik7CgogICAgICAgIC8v\nIG9wdGlvbmFsbHkgc2VsZWN0IHN1YmNsYXNzIG1hcHBpbmdzCiAgICAgICAg\naWYgKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgfHwgc3VicyA9PSBT\nZWxlY3QuU1VCU19BTllfSk9JTkFCTEUpCiAgICAgICAgICAgIHNlbGVjdFN1\nYmNsYXNzTWFwcGluZ3Moc2VsLCBtYXBwaW5nLCBzbSwgZmV0Y2gpOwogICAg\nICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICBzZWwuc2V0RGlzdGlu\nY3QoZmFsc2UpOwogICAgICAgIHJldHVybiBzZWxkID4gMDsKICAgIH0KCiAg\nICAvKioKICAgICAqIE1hcmsgdGhlIGZpZWxkcyBvZiB0aGlzIG1hcHBpbmcg\nYXMgcmVzZXJ2ZWQgc28gdGhhdCBlYWdlciBmZXRjaGVzIGNhbid0CiAgICAg\nKiBnZXQgaW50byBpbmZpbml0ZSByZWN1cnNpdmUgc2l0dWF0aW9ucy4KICAg\nICAqLwogICAgcHJpdmF0ZSBGaWVsZE1hcHBpbmcgY3JlYXRlRWFnZXJTZWxl\nY3RzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGVhZ2VyKSB7\nCiAgICAgICAgaWYgKG1hcHBpbmcgPT0gbnVsbCB8fCBlYWdlciA9PSBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX05PTkUpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkg\nPSBjcmVhdGVFYWdlclNlbGVjdHMoc2VsLCAKICAgICAgICAgICAgbWFwcGlu\nZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSwgc20sIGZpZWxk\ncywgZmV0Y2gsIGVhZ2VyKTsKCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1z\nID0gbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAg\nIGJvb2xlYW4gaW5FYWdlckpvaW4gPSBzZWwuaGFzRWFnZXJKb2luKGZhbHNl\nKTsKICAgICAgICBpbnQgc2VsczsKICAgICAgICBpbnQganR5cGU7CiAgICAg\nICAgaW50IG1vZGU7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbW9kZSA9IGZtc1tpXS5nZXRF\nYWdlckZldGNoTW9kZSgpOwogICAgICAgICAgICBpZiAobW9kZSA9PSBmZXRj\naC5FQUdFUl9OT05FKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIGlmICghcmVxdWlyZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRz\nLCBmZXRjaCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAg\nICAgIC8vIHRyeSB0byBzZWxlY3Qgd2l0aCBqb2luIGZpcnN0CiAgICAgICAg\nICAgIGp0eXBlID0gKGZtc1tpXS5nZXROdWxsVmFsdWUoKSA9PSBmbXNbaV0u\nTlVMTF9FWENFUFRJT04pIAogICAgICAgICAgICAgICAgPyBzZWwuRUFHRVJf\nSU5ORVIgOiBzZWwuRUFHRVJfT1VURVI7CiAgICAgICAgICAgIGlmIChtb2Rl\nICE9IGZldGNoLkVBR0VSX1BBUkFMTEVMICYmICFmbXNbaV0uaXNFYWdlclNl\nbGVjdFRvTWFueSgpCiAgICAgICAgICAgICAgICAmJiBmbXNbaV0uc3VwcG9y\ndHNTZWxlY3Qoc2VsLCBqdHlwZSwgc20sIHRoaXMsIGZldGNoKSA+IDAKICAg\nICAgICAgICAgICAgICYmIHNlbC5lYWdlckNsb25lKGZtc1tpXSwganR5cGUs\nIGZhbHNlLCAxKSAhPSBudWxsKQogICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICBib29sZWFuIGhhc0pvaW4gPSBmZXRjaC5oYXNKb2lu\nKGZtc1tpXS5nZXRGdWxsTmFtZShmYWxzZSkpOwoKICAgICAgICAgICAgLy8g\naWYgdGhlIGZpZWxkIGRlY2xhcmVzIGEgcHJlZmVycmVkIHNlbGVjdCBtb2Rl\nIG9mIGpvaW4gb3IgZG9lcyBub3QKICAgICAgICAgICAgLy8gaGF2ZSBhIHBy\nZWZlcnJlZCBtb2RlIGFuZCB3ZSdyZSBkb2luZyBhIGJ5LWlkIGxvb2t1cCwg\ndHJ5CiAgICAgICAgICAgIC8vIHRvIHVzZSBhIHRvLW1hbnkgam9pbiBhbHNv\nLiAgY3VycmVudGx5IHdlIGxpbWl0IGVhZ2VyCiAgICAgICAgICAgIC8vIG91\ndGVyIGpvaW5zIHRvIG5vbi1MUlMsIG5vbi1yYW5nZWQgc2VsZWN0cyB0aGF0\nIGRvbid0IGFscmVhZHkKICAgICAgICAgICAgLy8gaGF2ZSBhbiBlYWdlciB0\nby1tYW55IGpvaW4KICAgICAgICAgICAgaWYgKChoYXNKb2luIHx8IG1vZGUg\nPT0gZmV0Y2guRUFHRVJfSk9JTiAKICAgICAgICAgICAgICAgIHx8IChtb2Rl\nID09IGZldGNoLkRFRkFVTFQgJiYgc20gIT0gbnVsbCkpCiAgICAgICAgICAg\nICAgICAmJiBmbXNbaV0uaXNFYWdlclNlbGVjdFRvTWFueSgpCiAgICAgICAg\nICAgICAgICAmJiAhaW5FYWdlckpvaW4KICAgICAgICAgICAgICAgICYmICFz\nZWwuaGFzRWFnZXJKb2luKHRydWUpCiAgICAgICAgICAgICAgICAmJiAoIXNl\nbC5nZXRBdXRvRGlzdGluY3QoKSB8fCAoIXNlbC5pc0xSUygpCiAgICAgICAg\nICAgICAgICAmJiBzZWwuZ2V0U3RhcnRJbmRleCgpID09IDAgCiAgICAgICAg\nICAgICAgICAmJiBzZWwuZ2V0RW5kSW5kZXgoKSA9PSBMb25nLk1BWF9WQUxV\nRSkpCiAgICAgICAgICAgICAgICAmJiBmbXNbaV0uc3VwcG9ydHNTZWxlY3Qo\nc2VsLCBqdHlwZSwgc20sIHRoaXMsIGZldGNoKSA+IDApIHsKICAgICAgICAg\nICAgICAgIGlmIChzZWwuZWFnZXJDbG9uZShmbXNbaV0sIGp0eXBlLCB0cnVl\nLCAxKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGVhZ2VyVG9NYW55\nID0gZm1zW2ldOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBmaW5hbGx5LCB0cnkgcGFyYWxsZWwKICAgICAgICAgICAgaWYgKGVhZ2Vy\nID09IGZldGNoLkVBR0VSX1BBUkFMTEVMCiAgICAgICAgICAgICAgICAmJiAo\nc2VscyA9IGZtc1tpXS5zdXBwb3J0c1NlbGVjdChzZWwsIHNlbC5FQUdFUl9Q\nQVJBTExFTCwgc20sCiAgICAgICAgICAgICAgICB0aGlzLCBmZXRjaCkpICE9\nIDApCiAgICAgICAgICAgICAgICBzZWwuZWFnZXJDbG9uZShmbXNbaV0sIFNl\nbGVjdC5FQUdFUl9QQVJBTExFTCwgCiAgICAgICAgICAgICAgICAgICAgZm1z\nW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSwgc2Vscyk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBlYWdlclRvTWFueTsKICAgIH0KCiAgICAvKioKICAg\nICAqIERldGVybWluZSBpZiB0aGUgZ2l2ZW4gZmllbGQgbmVlZHMgdG8gYmUg\nc2VsZWN0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4g\ncmVxdWlyZXNTZWxlY3QoRmllbGRNYXBwaW5nIGZtLAogICAgICAgIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAoZmllbGRzICE9IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBmaWVsZHMuZ2V0KGZtLmdldEluZGV4\nKCkpOwogICAgICAgIGlmIChzbSAhPSBudWxsICYmIHNtLmdldFBDU3RhdGUo\nKSAhPSBQQ1N0YXRlLlRSQU5TSUVOVAogICAgICAgICAgICAmJiBzbS5nZXRM\nb2FkZWQoKS5nZXQoZm0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICByZXR1cm4gZmV0Y2gucmVxdWlyZXNGZXRjaChm\nbSkgPT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX0xPQUQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGZpZWxkIG1hcHBpbmdzIG9mIHRo\nZSBnaXZlbiBjbGFzcyBhbmQgYWxsIGl0cyBzdXBlcmNsYXNzZXMuCiAgICAg\nKgogICAgICogQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQogICAgICog\nQHBhcmFtIG1hcHBpbmcgdGhlIG1vc3QtZGVyaXZlZCB0eXBlIHRvIHNlbGVj\ndCBmb3IKICAgICAqIEBwYXJhbSBvcmlnIHRoZSBvcmlnaW5hbCBtYXBwaW5n\nIHR5cGUgc2VsZWN0ZWQKICAgICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2Ug\nYmVpbmcgc2VsZWN0ZWQgZm9yLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBw\nYXJhbSBmaWVsZHMgdGhlIGZpZWxkcyB0byBsb2FkCiAgICAgKiBAcGFyYW0g\nZmV0Y2ggZmV0Y2ggY29uZmlndXJhdGlvbiB0byB1c2UgZm9yIGxvYWRpbmcg\ncmVsYXRpb25zCiAgICAgKiBAcGFyYW0gZWFnZXIgdGhlIGVhZ2VyIGZldGNo\nIG1vZGUgdG8gdXNlCiAgICAgKiBAcGFyYW0gam9pbmVkIHdoZXRoZXIgdGhl\nIGNsYXNzIGhhcyBhbHJlYWR5IGJlZW4gam9pbmVkIGRvd24gdG8KICAgICAq\nIGl0cyBiYXNlIGNsYXNzCiAgICAgKiBAcmV0dXJuICZndDsgMCBpZiB0aGUg\nc2VsZWN0IGlzIHJlcXVpcmVkLCAwIGlmIGRhdGEgd2FzCiAgICAgKiBzZWxl\nY3RlZCBidXQgaXMgbm90IHJlcXVpcmVkLCBhbmQgJmx0OyAwIGlmIG5vdGhp\nbmcgd2FzIHNlbGVjdGVkCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHNlbGVj\ndEJhc2VNYXBwaW5ncyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFwcGlu\nZywKICAgICAgICBDbGFzc01hcHBpbmcgb3JpZywgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgQml0U2V0IGZpZWxkcywKICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIsIEZpZWxkTWFwcGluZyBlYWdl\nclRvTWFueSwKICAgICAgICBib29sZWFuIGlkZW50LCBib29sZWFuIGpvaW5l\nZCkgewogICAgICAgIENsYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdl\ndEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChw\nYXJlbnQgPT0gbnVsbCAmJiAhbWFwcGluZy5pc01hcHBlZCgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJ2aXJ0dWFsLW1hcHBpbmciLCBtYXBwaW5nLgogICAgICAgICAgICAgICAg\nZ2V0RGVzY3JpYmVkVHlwZSgpKSk7CgogICAgICAgIGludCBzZWxkID0gLTE7\nCiAgICAgICAgaW50IHBzZWxkID0gLTE7CgogICAgICAgIC8vIGJhc2UgY2xh\nc3Mgc2VsZWN0cyBwa3MsIGV0YwogICAgICAgIGlmIChwYXJlbnQgPT0gbnVs\nbCkgewogICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSwgc2VsZWN0IHBr\ncwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKGlkZW50KQogICAgICAgICAgICAgICAgICAgIHNlbC5zZWxlY3RJ\nZGVudGlmaWVyKG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2VsLnNl\nbGVjdChtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCkpOwogICAgICAg\nICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGlmIG5vIGluc3RhbmNlIG9yIG5vdCBpbml0aWFsaXplZCBhbmQgbm90\nIGV4YWN0IG9pZCwgc2VsZWN0IHR5cGUKICAgICAgICAgICAgaWYgKChzbSA9\nPSBudWxsIHx8IChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5UUkFOU0lF\nTlQgCiAgICAgICAgICAgICAgICAmJiAoIShzbS5nZXRPYmplY3RJZCgpIGlu\nc3RhbmNlb2YgT3BlbkpQQUlkKSAKICAgICAgICAgICAgICAgIHx8ICgoT3Bl\nbkpQQUlkKSBzbS5nZXRPYmplY3RJZCgpKS5oYXNTdWJjbGFzc2VzKCkpKSkK\nICAgICAgICAgICAgICAgICYmIG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigp\nLnNlbGVjdChzZWwsIG9yaWcpKQogICAgICAgICAgICAgICAgc2VsZCA9IDE7\nCgogICAgICAgICAgICAvLyBpZiBubyBpbnN0YW5jZSBvciBubyB2ZXJzaW9u\nLCBzZWxlY3QgdmVyc2lvbgogICAgICAgICAgICBpZiAoKHNtID09IG51bGwg\nfHwgc20uZ2V0VmVyc2lvbigpID09IG51bGwpCiAgICAgICAgICAgICAgICAm\nJiBtYXBwaW5nLmdldFZlcnNpb24oKS5zZWxlY3Qoc2VsLCBvcmlnKSkKICAg\nICAgICAgICAgICAgIHNlbGQgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIC8vIHJlY3Vyc2Ugb24gcGFyZW50CiAgICAgICAgICAgIHBzZWxk\nID0gc2VsZWN0QmFzZU1hcHBpbmdzKHNlbCwgcGFyZW50LCBvcmlnLCBzbSwg\nZmllbGRzLAogICAgICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyLCBlYWdlclRv\nTWFueSwgaWRlbnQsIGpvaW5lZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBz\nZWxlY3QgdGhlIG1hcHBpbmdzIGluIHRoZSBnaXZlbiBmaWVsZHMgc2V0LCBv\nciBiYXNlZCBvbiBmZXRjaAogICAgICAgIC8vIGNvbmZpZ3VyYXRpb24gaWYg\nbm8gZmllbGRzIGdpdmVuCiAgICAgICAgRmllbGRNYXBwaW5nW10gZm1zID0g\nbWFwcGluZy5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgIFNl\nbGVjdEV4ZWN1dG9yIGVzZWw7CiAgICAgICAgaW50IGZzZWxkOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIC8vIHNraXAgZWFnZXIgdG8tbWFueSBzZWxlY3Q7IHdlIGRvIHRo\nYXQgc2VwYXJhdGVseSBpbiBjYWxsaW5nCiAgICAgICAgICAgIC8vIG1ldGhv\nZAogICAgICAgICAgICBpZiAoZm1zW2ldID09IGVhZ2VyVG9NYW55KQogICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvLyBjaGVjayBm\nb3IgZWFnZXIgc2VsZWN0CiAgICAgICAgICAgIGVzZWwgPSBzZWwuZ2V0RWFn\nZXIoZm1zW2ldKTsKICAgICAgICAgICAgaWYgKGVzZWwgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKGVzZWwgPT0gc2VsKQogICAgICAgICAgICAg\nICAgICAgIGZtc1tpXS5zZWxlY3RFYWdlckpvaW4oc2VsLCBzbSwgdGhpcywg\nCiAgICAgICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRCQyhmbXNb\naV0pLCBlYWdlcik7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VyUGFyYWxsZWwoZXNlbCwgc20s\nIHRoaXMsIAogICAgICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpE\nQkMoZm1zW2ldKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2VsZCA9IE1h\ndGgubWF4KDAsIHNlbGQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlcXVp\ncmVzU2VsZWN0KGZtc1tpXSwgc20sIGZpZWxkcywgZmV0Y2gpKSB7CiAgICAg\nICAgICAgICAgICBmc2VsZCA9IGZtc1tpXS5zZWxlY3Qoc2VsLCBzbSwgdGhp\ncywgCiAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tp\nXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNlbGQgPSBNYXRoLm1heChm\nc2VsZCwgc2VsZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0U2VsZWN0\nKGZtc1tpXSwgc2VsLCBzbSwgZmV0Y2gpKSB7CiAgICAgICAgICAgICAgICBm\nc2VsZCA9IGZtc1tpXS5zZWxlY3Qoc2VsLCBzbSwgdGhpcywgCiAgICAgICAg\nICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tpXSksIGZldGNoLkVB\nR0VSX05PTkUpOwoKICAgICAgICAgICAgICAgIC8vIGRvbid0IHVwZ3JhZGUg\nc2VsZCB0byA+IDAgYmFzZWQgb24gdGhlc2UgZmllbGRzLCBzaW5jZQogICAg\nICAgICAgICAgICAgLy8gdGhleSdyZSBub3QgaW4gdGhlIGNhbGN1bGF0ZWQg\nZmllbGQgc2V0CiAgICAgICAgICAgICAgICBpZiAoZnNlbGQgPj0gMCAmJiBz\nZWxkIDwgMCkKICAgICAgICAgICAgICAgICAgICBzZWxkID0gMDsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gam9pbiB0byBwYXJlbnQg\ndGFibGUgaWYgdGhlIHBhcmVudCAvIGFueSBhbmNlc3RvcnMgaGF2ZSBzZWxl\nY3RlZAogICAgICAgIC8vIGFueXRoaW5nCiAgICAgICAgaWYgKCFqb2luZWQg\nJiYgcHNlbGQgPj0gMCAmJiBwYXJlbnQuZ2V0VGFibGUoKSAhPSBtYXBwaW5n\nLmdldFRhYmxlKCkpCiAgICAgICAgICAgIHNlbC53aGVyZShtYXBwaW5nLmpv\naW5TdXBlcmNsYXNzKHNlbC5uZXdKb2lucygpLCBmYWxzZSkpOwoKICAgICAg\nICAvLyByZXR1cm4gdGhlIGhpZ2hlc3QgdmFsdWUKICAgICAgICByZXR1cm4g\nTWF0aC5tYXgocHNlbGQsIHNlbGQpOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hlbiBzZWxlY3RpbmcgZmllbGRlcywgYSBzcGVjaWFsIGNhc2UgaXMgbWFk\nZSBmb3IgbWFwcGluZ3MgdGhhdCB1c2UKICAgICAqIDItcGFydCBzZWxlY3Rz\nIHRoYXQgYXJlbid0IGV4cGxpY2l0bHkgKm5vdCogaW4gdGhlIGRmZyBzbyB0\naGF0IHRoZXkKICAgICAqIGNhbiBnZXQgdGhlaXIgcHJpbWFyeSB0YWJsZSBk\nYXRhLiBUaGlzIG1ldGhvZCB0ZXN0cyBmb3IgdGhhdCBzcGVjaWFsCiAgICAg\nKiBjYXNlIGFzIGFuIG9wdGltaXphdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBib29sZWFuIG9wdFNlbGVjdChGaWVsZE1hcHBpbmcgZm0sIFNlbGVjdCBz\nZWwsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVybiAhZm0uaXNJ\nbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAgICYmICFmbS5pc0Rl\nZmF1bHRGZXRjaEdyb3VwRXhwbGljaXQoKQogICAgICAgICAgICAmJiAoc20g\nPT0gbnVsbCB8fCBzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5UUkFOU0lF\nTlQgCiAgICAgICAgICAgIHx8ICFzbS5nZXRMb2FkZWQoKS5nZXQoZm0uZ2V0\nSW5kZXgoKSkpCiAgICAgICAgICAgICYmIGZtLnN1cHBvcnRzU2VsZWN0KHNl\nbCwgc2VsLlRZUEVfVFdPX1BBUlQsIHNtLCB0aGlzLCBmZXRjaCkgPiAwOwog\nICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGZpZWxkIG1hcHBpbmdzIHRo\nYXQgbWF0Y2ggdGhlIGdpdmVuIGZldGNoIGNvbmZpZ3VyYXRpb24gZm9yCiAg\nICAgKiBzdWJjbGFzc2VzIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICoKICAg\nICAqIEBwYXJhbSBzZWwgdGhlIHNlbGVjdCB0byB1c2UKICAgICAqIEBwYXJh\nbSBtYXBwaW5nIHRoZSB0eXBlIHdob3NlIHN1YmNsYXNzZXMgdG8gc2VsZWN0\nCiAgICAgKiBAcGFyYW0gc20gdGhlIGluc3RhbmNlIGJlaW5nIHNlbGVjdGVk\nIGZvciwgb3IgbnVsbCBpZiBub25lCiAgICAgKiBAcGFyYW0gZmV0Y2ggdGhl\nIGZldGNoIGNvbmZpZ3VyYXRpb24KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNlbGVjdFN1YmNsYXNzTWFwcGluZ3MoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGxvYWRT\ndWJjbGFzc2VzKG1hcHBpbmcpOwogICAgICAgIENsYXNzTWFwcGluZ1tdIHN1\nYk1hcHBpbmdzID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3ViY2xhc3NNYXBw\naW5ncygpOwogICAgICAgIGlmIChzdWJNYXBwaW5ncy5sZW5ndGggPT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBzZWxlY3QgYWxsIHN1\nYmNsYXNzIG1hcHBpbmdzIHRoYXQgbWF0Y2ggdGhlIGZldGNoIGNvbmZpZ3Vy\nYXRpb24KICAgICAgICAvLyBhbmQgd2hvc2UgdGFibGUgaXMgaW4gdGhlIGxp\nc3Qgb2YgdGhvc2Ugc2VsZWN0ZWQgc28gZmFyOyB0aGlzCiAgICAgICAgLy8g\nd2F5IHdlIHNlbGVjdCB0aGUgbWF4IHBvc3NpYmxlIHdpdGhvdXQgc2VsZWN0\naW5nIGFueSB0YWJsZXMgdGhhdAogICAgICAgIC8vIGFyZW4ndCBwcmVzZW50\nIGluIGFsbCBwb3NzaWJsZSBxdWVyeSBtYXRjaGVzOyBhIHNwZWNpYWwgY2Fz\nZQogICAgICAgIC8vIGlzIG1hZGUgZm9yIG1hcHBpbmdzIHRoYXQgdXNlIDIt\ncGFydCBzZWxlY3RzIHRoYXQgYXJlbid0CiAgICAgICAgLy8gZXhwbGljaXRs\neSAqbm90KiBpbiB0aGUgZGVmYXVsdCBzbyB0aGF0IHRoZXkgY2FuIGdldCB0\naGVpcgogICAgICAgIC8vIHByaW1hcnkgdGFibGUgZGF0YQogICAgICAgIEZp\nZWxkTWFwcGluZ1tdIGZtczsKICAgICAgICBib29sZWFuIGpvaW5lZDsKICAg\nICAgICBib29sZWFuIGNhbkpvaW4gPSBfZGljdC5qb2luU3ludGF4ICE9IEpv\naW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwKICAgICAgICAgICAgJiYg\nZmV0Y2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUobWFwcGluZykgIT0gZmV0Y2gu\nRUFHRVJfTk9ORTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1Yk1h\ncHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghc3ViTWFw\ncGluZ3NbaV0uc3VwcG9ydHNFYWdlclNlbGVjdChzZWwsIHNtLCB0aGlzLCBt\nYXBwaW5nLAogICAgICAgICAgICAgICAgZmV0Y2gpKQogICAgICAgICAgICAg\nICAgY29udGludWU7CgogICAgICAgICAgICAvLyBpbml0aWFsaXplIHNvIHRo\nYXQgaWYgd2UgY2FuJ3Qgam9pbiwgd2UgcHJldGVuZCB3ZSBhbHJlYWR5IGhh\ndmUKICAgICAgICAgICAgam9pbmVkID0gIWNhbkpvaW47CiAgICAgICAgICAg\nIGZtcyA9IHN1Yk1hcHBpbmdzW2ldLmdldERlZmluZWRGaWVsZE1hcHBpbmdz\nKCk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZm1zLmxlbmd0\naDsgaisrKSB7CiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgaW4gb25l\nIG9mIGNvbmZpZ3VyZWQgZmV0Y2ggZ3JvdXBzCiAgICAgICAgICAgIAlpZiAo\nZmV0Y2gucmVxdWlyZXNGZXRjaChmbXNbal0pICE9IEZldGNoQ29uZmlndXJh\ndGlvbi5GRVRDSF9MT0FECiAgICAgICAgICAgICAgICAgICAgJiYgKCghZm1z\nW2pdLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAgICAgICAgICAg\nICAgICYmIGZtc1tqXS5pc0RlZmF1bHRGZXRjaEdyb3VwRXhwbGljaXQoKSkK\nICAgICAgICAgICAgICAgICAgICB8fCBmbXNbal0uc3VwcG9ydHNTZWxlY3Qo\nc2VsLCBzZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIAogICAgICAgICAg\nICAgICAgICAgIGZldGNoKSA8PSAwKSkgCiAgICAgICAgICAgIAkJY29udGlu\ndWU7CgogICAgICAgICAgICAgICAgLy8gaWYgd2UgY2FuIGpvaW4gdG8gdGhl\nIHN1YmNsYXNzLCBkbyBzbzsgbXVjaCBiZXR0ZXIgY2hhbmNlCiAgICAgICAg\nICAgICAgICAvLyB0aGF0IHRoZSBmaWVsZCB3aWxsIGJlIGFibGUgdG8gc2Vs\nZWN0IGl0c2VsZiB3aXRob3V0IGpvaW5zCiAgICAgICAgICAgICAgICBpZiAo\nIWpvaW5lZCkgewogICAgICAgICAgICAgICAgICAgIC8vIG1hcmsgam9pbmVk\nIHdoZXRoZXIgb3Igbm90IHdlIGpvaW4sIHNvIHdlIGRvbid0IGhhdmUgdG8K\nICAgICAgICAgICAgICAgICAgICAvLyB0ZXN0IGNvbmRpdGlvbnMgYWdhaW4g\nZm9yIHRoaXMgc3ViY2xhc3MKICAgICAgICAgICAgICAgICAgICBqb2luZWQg\nPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHNlbC53aGVyZShqb2luU3Vi\nY2xhc3Moc2VsLCBtYXBwaW5nLCBzdWJNYXBwaW5nc1tpXSwgbnVsbCkpOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIGNhbiBz\nZWxlY3Qgd2l0aCB0YWJsZXMgYWxyZWFkeSBzZWxlY3RlZCwgZG8gaXQKICAg\nICAgICAgICAgICAgIGlmIChmbXNbal0uc3VwcG9ydHNTZWxlY3Qoc2VsLCBz\nZWwuVFlQRV9KT0lOTEVTUywgc20sIHRoaXMsCiAgICAgICAgICAgICAgICAg\nICAgZmV0Y2gpID4gMCkKICAgICAgICAgICAgICAgICAgICBmbXNbal0uc2Vs\nZWN0KHNlbCwgbnVsbCwgdGhpcywgZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tq\nXSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoLkVBR0VSX05PTkUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogSGVscGVyIG1ldGhvZCB0byBqb2luIGZyb20gY2xhc3MgdG8gaXRzIHN1\nYmNsYXNzLiBSZWN1cnNpdmUgdG8gYWxsb3cKICAgICAqIGZvciBtdWx0aXBs\nZSBob3BzLCBzdGFydGluZyBmcm9tIHRoZSBiYXNlIGNsYXNzLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBKb2lucyBqb2luU3ViY2xhc3MoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIGJhc2UsCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHN1YiwgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoc3ViID09IGJhc2Ug\nfHwgc3ViLmdldFRhYmxlKCkgPT0gYmFzZS5nZXRUYWJsZSgpCiAgICAgICAg\nICAgIHx8IHNlbC5pc1NlbGVjdGVkKHN1Yi5nZXRUYWJsZSgpKSkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHJlY3Vyc2UgZmlyc3Qg\nc28gd2UgZ28gbGVhc3QtPm1vc3QgZGVyaXZlZAogICAgICAgIENsYXNzTWFw\ncGluZyBzdXAgPSBzdWIuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCk7CiAgICAgICAgam9pbnMgPSBqb2luU3ViY2xhc3Moc2VsLCBiYXNlLCBz\ndXAsIGpvaW5zKTsKICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgam9pbnMgPSBzZWwubmV3Sm9pbnMoKTsKICAgICAgICByZXR1cm4g\nc3ViLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCB0cnVlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIE1ha2VzIHN1cmUgYWxsIHN1YmNsYXNzZXMgb2YgdGhlIGdp\ndmVuIHR5cGUgYXJlIGxvYWRlZCBpbiB0aGUgSlZNLgogICAgICogVGhpcyBp\ncyB1c3VhbGx5IGRvbmUgYXV0b21hdGljYWxseS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgbG9hZFN1YmNsYXNzZXMoQ2xhc3NNYXBwaW5nIG1hcHBpbmcp\nIHsKICAgICAgICBEaXNjcmltaW5hdG9yIGRzYyA9IG1hcHBpbmcuZ2V0RGlz\nY3JpbWluYXRvcigpOwogICAgICAgIGlmIChkc2MuZ2V0U3ViY2xhc3Nlc0xv\nYWRlZCgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIHRo\nZSBzdWJjbGFzcyBsaXN0IGlzIHNldCwgbm8gbmVlZCB0byBsb2FkIHN1YnMK\nICAgICAgICBpZiAobWFwcGluZy5nZXRSZXBvc2l0b3J5KCkuZ2V0UGVyc2lz\ndGVudFR5cGVOYW1lcyhmYWxzZSwKICAgICAgICAgICAgX2N0eC5nZXRDbGFz\nc0xvYWRlcigpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGRzYy5zZXRTdWJj\nbGFzc2VzTG9hZGVkKHRydWUpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBkc2MubG9hZFN1YmNs\nYXNzZXModGhpcyk7CiAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RGb3VuZEV4\nY2VwdGlvbiBjbmZlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4\nY2VwdGlvbihjbmZlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9y\nZShzZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2UgdGhlIHN0YXRlbWVudCBhIGNhbmRpZGF0ZSBmb3IgY2FuY2VsbGF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVmb3JlRXhlY3V0ZVN0\nYXRlbWVudChTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICBfc3RtbnRzLmFk\nZChzdG1udCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHN0\nYXRlbWVudCBmcm9tIHRoZSBjYW5jZWxsYWJsZSBzZXQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQoU3RhdGVtZW50\nIHN0bW50KSB7CiAgICAgICAgX3N0bW50cy5yZW1vdmUoc3RtbnQpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiByZXR1cm5lZCB0byBjbGll\nbnQgY29kZS4gTWFrZXMgc3VyZSBpdHMgd3JhcHBlZCBjb25uZWN0aW9uCiAg\nICAgKiByZWYgY291bnQgaXMgZGVjcmVtZW50ZWQgb24gZmluYWxpemUuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENsaWVudENvbm5lY3Rp\nb24gZXh0ZW5kcyBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHBy\naXZhdGUgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CgogICAgICAgIHB1Ymxp\nYyBDbGllbnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikgewogICAgICAg\nICAgICBzdXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIGNsb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIF9jbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBzdXBlci5jbG9zZSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZmluYWxpemUoKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKCFfY2xvc2Vk\nKQogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHdyYXBwZXIgdGhhdCBrZWVwcyBh\nbiBpbnRlcm5hbCByZWYgY291bnQgc28gdGhhdCBpdCBrbm93cwogICAgICog\nd2hlbiB0byByZWFsbHkgY2xvc2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBj\nbGFzcyBSZWZDb3VudENvbm5lY3Rpb24gZXh0ZW5kcyBEZWxlZ2F0aW5nQ29u\nbmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfcmV0YWluID0g\nZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX3JlZnMgPSAwOwogICAgICAg\nIHByaXZhdGUgYm9vbGVhbiBfZnJlZWQgPSBmYWxzZTsKCiAgICAgICAgcHVi\nbGljIFJlZkNvdW50Q29ubmVjdGlvbihDb25uZWN0aW9uIGNvbm4pIHsKICAg\nICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBnZXRSZXRhaW4oKSB7CiAgICAgICAgICAgIHJldHVybiBf\ncmV0YWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc2V0UmV0\nYWluKGJvb2xlYW4gcmV0YWluKSB7CiAgICAgICAgICAgIGlmIChfcmV0YWlu\nICYmICFyZXRhaW4gJiYgX3JlZnMgPD0gMCkKICAgICAgICAgICAgICAgIGZy\nZWUoKTsKICAgICAgICAgICAgX3JldGFpbiA9IHJldGFpbjsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHJlZigpIHsKICAgICAgICAgICAgLy8g\nZG9uJ3QgaGF2ZSB0byBsb2NrOyBjYWxsZWQgZnJvbSBjb25uZWN0KCksIHdo\naWNoIGlzIGxvY2tlZAogICAgICAgICAgICBfcmVmcysrOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgLy8gbG9jayBhdCBicm9rZXIgbGV2ZWwgdG8g\nYXZvaWQgZGVhZGxvY2tzCiAgICAgICAgICAgIF9jdHgubG9jaygpOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3JlZnMtLTsKICAgICAg\nICAgICAgICAgIGlmIChfcmVmcyA8PSAwICYmICFfcmV0YWluKQogICAgICAg\nICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGZyZWUoKSB7CiAgICAg\nICAgICAgIC8vIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBjbG9zZSB0aGUgdW5k\nZXJseWluZyBjb25uZWN0aW9uCiAgICAgICAgICAgIC8vIG11bHRpcGxlIHRp\nbWVzOyB0aGlzIGNvdWxkIGhhcHBlbiBpZiBzb21lb25lIChlLmcuLCBhbgog\nICAgICAgICAgICAvLyBFeHRlbnQpIGhvbGRzIGEgUmVmQ29ubmVjdGlvbiwg\nYW5kIHRoZW4gY2xvc2VzIGl0IChlLmcuLCBpbgogICAgICAgICAgICAvLyB0\naGUgZmluYWxpemVyKSBhZnRlciB0aGUgU3RvcmVNYW5hZ2VyIGhhcyBhbHJl\nYWR5IGJlZW4gY2xvc2VkLgogICAgICAgICAgICBpZiAoX2ZyZWVkKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGdldERlbGVnYXRlKCkuY2xvc2UoKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgX2ZyZWVkID0gdHJ1ZTsKICAgICAgICAgICAgX2Nvbm4gPSBu\ndWxsOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFN0YXRlbWVudCBj\ncmVhdGVTdGF0ZW1lbnQoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxTdGF0ZW1lbnQo\nc3VwZXIuY3JlYXRlU3RhdGVtZW50KGZhbHNlKSwKICAgICAgICAgICAgICAg\nIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAg\nIHByb3RlY3RlZCBTdGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGludCByc1R5\ncGUsIGludCByc0NvbmN1ciwKICAgICAgICAgICAgYm9vbGVhbiB3cmFwKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBD\nYW5jZWxTdGF0ZW1lbnQoc3VwZXIuY3JlYXRlU3RhdGVtZW50KHJzVHlwZSwg\ncnNDb25jdXIsCiAgICAgICAgICAgICAgICBmYWxzZSksIFJlZkNvdW50Q29u\nbmVjdGlvbi50aGlzKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBQ\ncmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KFN0cmluZyBzcWws\nIGJvb2xlYW4gd3JhcCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2VsUHJlcGFyZWRTdGF0\nZW1lbnQoc3VwZXIucHJlcGFyZVN0YXRlbWVudChzcWwsCiAgICAgICAgICAg\nICAgICBmYWxzZSksIFJlZkNvdW50Q29ubmVjdGlvbi50aGlzKTsKICAgICAg\nICB9CgogICAgICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVw\nYXJlU3RhdGVtZW50KFN0cmluZyBzcWwsIGludCByc1R5cGUsCiAgICAgICAg\nICAgIGludCByc0NvbmN1ciwgYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxQcmVwYXJl\nZFN0YXRlbWVudChzdXBlci5wcmVwYXJlU3RhdGVtZW50KHNxbCwKICAgICAg\nICAgICAgICAgIHJzVHlwZSwgcnNDb25jdXIsIGZhbHNlKSwgUmVmQ291bnRD\nb25uZWN0aW9uLnRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFN0YXRlbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3ZlcyBpdHNl\nbGYgZnJvbSB0aGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVtZW50cyBz\nbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAgcHJpdmF0\nZSBjbGFzcyBDYW5jZWxTdGF0ZW1lbnQgZXh0ZW5kcyBEZWxlZ2F0aW5nU3Rh\ndGVtZW50IHsKCiAgICAgICAgcHVibGljIENhbmNlbFN0YXRlbWVudChTdGF0\nZW1lbnQgc3RtbnQsIENvbm5lY3Rpb24gY29ubikgewogICAgICAgICAgICBz\ndXBlcihzdG1udCwgY29ubik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\naW50IGV4ZWN1dGVVcGRhdGUoU3RyaW5nIHNxbCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGJlZm9yZUV4ZWN1dGVTdGF0ZW1lbnQodGhp\ncyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nc3VwZXIuZXhlY3V0ZVVwZGF0ZShzcWwpOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRo\naXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0\nZWQgUmVzdWx0U2V0IGV4ZWN1dGVRdWVyeShTdHJpbmcgc3FsLCBib29sZWFu\nIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1\ndGVRdWVyeShzcWwsIHdyYXApOwogICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgYWZ0ZXJFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nU3RhdGVtZW50IHR5cGUgdGhhdCBhZGRzIGFuZCByZW1vdmVzIGl0c2VsZiBm\ncm9tIHRoZSBzZXQgb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1lbnRzIHNvIHRo\nYXQgaXQgY2FuIGJlIGNhbmNlbGVkLgogICAgICovCiAgICBwcml2YXRlIGNs\nYXNzIENhbmNlbFByZXBhcmVkU3RhdGVtZW50IGV4dGVuZHMgRGVsZWdhdGlu\nZ1ByZXBhcmVkU3RhdGVtZW50IHsKCiAgICAgICAgcHVibGljIENhbmNlbFBy\nZXBhcmVkU3RhdGVtZW50KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCAKICAg\nICAgICAgICAgQ29ubmVjdGlvbiBjb25uKSB7CiAgICAgICAgICAgIHN1cGVy\nKHN0bW50LCBjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQg\nZXhlY3V0ZVVwZGF0ZSgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmV4ZWN1dGVV\ncGRhdGUoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVj\ndXRlUXVlcnkoYm9vbGVhbiB3cmFwKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5l\neGVjdXRlUXVlcnkod3JhcCk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVTdGF0ZW1lbnQodGhpcyk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnRbXSBl\neGVjdXRlQmF0Y2goKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlQmF0\nY2goKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIE1hcCBnZXRDYWNoZU1h\ncEZyb21RdWVyeVNRTENhY2hlKE9iamVjdCBrZXkpIHsKICAgICAgICBzeW5j\naHJvbml6ZWQoX3NxbENhY2hlKSB7CiAgICAgICAgICAgIC8vc3FsQ2FjaGUg\naXMgYSBtYXAgb2YgbWFwCiAgICAgICAgICAgIE1hcCBjYWNoZU1hcCA9IChN\nYXApX3NxbENhY2hlLmdldChrZXkpOwogICAgICAgICAgICBpZiAoY2FjaGVN\nYXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2FjaGVNYXAgPSBjcmVh\ndGVTUUxDYWNoZSgpOwogICAgICAgICAgICAgICAgX3NxbENhY2hlLnB1dChr\nZXksIGNhY2hlTWFwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gY2FjaGVNYXA7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMg\ndm9pZCBhZGRUb1NxbENhY2hlKE1hcCBjYWNoZU1hcCwgT2JqZWN0IGtleSwg\nT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgY2FjaGVNYXAucHV0KGtleSwgdmFs\ndWUpOwogICAgfQogICAgCiAgICBwdWJsaWMgTWFwIGNyZWF0ZVNRTENhY2hl\nKCkgewogICAgICAgIFF1ZXJ5U1FMQ2FjaGVWYWx1ZSBxdWVyeVNRTENhY2hl\nID0gX2NvbmYuZ2V0UXVlcnlTUUxDYWNoZSgpOwogICAgICAgIHJldHVybiAo\nTWFwKXF1ZXJ5U1FMQ2FjaGUubmV3SW5zdGFuY2UoKTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1F1ZXJ5U1FMQ2FjaGVPbigpIHsKICAgICAgICBy\nZXR1cm4gX2lzUXVlcnlTUUxDYWNoZTsgIAogICAgfQogICAgCiAgICBwdWJs\naWMgTWFwIGdldFF1ZXJ5U1FMQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9z\ncWxDYWNoZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBjbGFzcyBT\nZWxlY3RLZXkgewogICAgICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgbWFwcGlu\nZzsKICAgICAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGZtOwogICAgICAgIHB1\nYmxpYyBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoOwogICAgICAgIAog\nICAgICAgIHB1YmxpYyBTZWxlY3RLZXkgKENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBGaWVsZE1hcHBpbmcgZm0sIAogICAgICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgICAgIHRoaXMubWFwcGluZyA9\nIG1hcHBpbmc7CiAgICAgICAgICAgIHRoaXMuZm0gPSBmbTsKICAgICAgICAg\nICAgdGhpcy5mZXRjaCA9IGZldGNoOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAg\nICAgICAgaWYgKHRoaXMgPT0gbykgcmV0dXJuIHRydWU7CiAgICAgICAgICAg\nIGlmIChvID09IG51bGwgfHwgZ2V0Q2xhc3MoKSAhPSBvLmdldENsYXNzKCkp\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIFNlbGVjdEtleSBzZWxlY3RL\nZXkgPSAoU2VsZWN0S2V5KSBvOwogICAgICAgICAgICBpZiAoZmV0Y2ggIT0g\nbnVsbCA/ICFlcXVhbHMoZmV0Y2gsIHNlbGVjdEtleS5mZXRjaCkgOgogICAg\nICAgICAgICAgICAgc2VsZWN0S2V5LmZldGNoICE9IG51bGwpIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgaWYgKG1hcHBpbmcgIT0gbnVsbCA/ICFtYXBw\naW5nLmVxdWFscyhzZWxlY3RLZXkubWFwcGluZykgOgogICAgICAgICAgICAg\nICAgc2VsZWN0S2V5Lm1hcHBpbmcgIT0gbnVsbCkgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICBpZiAoZm0gIT0gbnVsbCA/ICFmbS5lcXVhbHMoc2VsZWN0\nS2V5LmZtKSA6CiAgICAgICAgICAgICAgICBzZWxlY3RLZXkuZm0gIT0gbnVs\nbCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxz\nKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gxLAogICAgICAgIAlKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoMikgewogICAgICAgICAgICBpZiAo\nZmV0Y2gxID09IGZldGNoMikgCiAgICAgICAgICAgIAlyZXR1cm4gdHJ1ZTsK\nCiAgICAgICAgICAgIGlmIChmZXRjaDEuZ2V0SXNvbGF0aW9uKCkgIT0gZmV0\nY2gyLmdldElzb2xhdGlvbigpKSAKICAgICAgICAgICAgCXJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgaWYgKGZldGNoMS5nZXRGZXRjaERpcmVjdGlvbigp\nICE9IGZldGNoMi5nZXRGZXRjaERpcmVjdGlvbigpKSAKICAgICAgICAgICAg\nCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGZldGNoMS5nZXRFYWdl\nckZldGNoTW9kZSgpICE9IGZldGNoMi5nZXRFYWdlckZldGNoTW9kZSgpKSAK\nICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGZl\ndGNoMS5nZXRTdWJjbGFzc0ZldGNoTW9kZSgpICE9IGZldGNoMi5nZXRTdWJj\nbGFzc0ZldGNoTW9kZSgpKSAKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgaWYgKGZldGNoMS5nZXRKb2luU3ludGF4KCkgIT0gZmV0\nY2gyLmdldEpvaW5TeW50YXgoKSkgCiAgICAgICAgICAgIAlyZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIFNldCBqb2luczEgPSBmZXRjaDEuZ2V0Sm9pbnMo\nKTsKICAgICAgICAgICAgU2V0IGpvaW5zMiA9IGZldGNoMi5nZXRKb2lucygp\nOwogICAgICAgICAgICBpZiAoam9pbnMxICE9IG51bGwgPyAham9pbnMxLmVx\ndWFscyhqb2luczIpIDogam9pbnMyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAo\nZmV0Y2gxLmdldE1heEZldGNoRGVwdGgoKSAhPSBmZXRjaDIuZ2V0TWF4RmV0\nY2hEZXB0aCgpKSAKICAgICAgICAgICAgCXJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgaWYgKGZldGNoMS5nZXRSZWFkTG9ja0xldmVsKCkgIT0gZmV0Y2gy\nLmdldFJlYWRMb2NrTGV2ZWwoKSkgCiAgICAgICAgICAgIAlyZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIGlmIChmZXRjaDEuZ2V0V3JpdGVMb2NrTGV2ZWwo\nKSAhPSBmZXRjaDIuZ2V0V3JpdGVMb2NrTGV2ZWwoKSkgCiAgICAgICAgICAg\nIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIAogICAgICAgICAgICBib29s\nZWFuIHNhbWVGZXRjaEdyb3VwID0gZmFsc2U7CiAgICAgICAgICAgIGJvb2xl\nYW4gaGFzRmV0Y2hHcm91cEFsbCA9ICgoSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbkltcGwpZmV0Y2gxKS4KICAgICAgICAgICAgCWhhc0ZldGNoR3JvdXBBbGwo\nKTsKICAgICAgICAgICAgYm9vbGVhbiBoYXNGZXRjaEdyb3VwQWxsMSA9ICgo\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbkltcGwpZmV0Y2gyKS4KICAgICAgICAg\nICAgCWhhc0ZldGNoR3JvdXBBbGwoKTsKICAgICAgICAgICAgaWYgKGhhc0Zl\ndGNoR3JvdXBBbGwgJiYgaGFzRmV0Y2hHcm91cEFsbDEpIAogICAgICAgICAg\nICAgICAgc2FtZUZldGNoR3JvdXAgPSB0cnVlOwogICAgICAgICAgICBlbHNl\nIGlmICghaGFzRmV0Y2hHcm91cEFsbCAmJiAhaGFzRmV0Y2hHcm91cEFsbDEp\newogICAgICAgICAgICAgICAgYm9vbGVhbiBoYXNGZXRjaEdyb3VwRGVmYXVs\ndCA9IAogICAgICAgICAgICAgICAgCSgoSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbkltcGwpZmV0Y2gxKS5oYXNGZXRjaEdyb3VwRGVmYXVsdCgpOwogICAgICAg\nICAgICAgICAgYm9vbGVhbiBoYXNGZXRjaEdyb3VwRGVmYXVsdDEgPSAKICAg\nICAgICAgICAgICAgIAkoKEpEQkNGZXRjaENvbmZpZ3VyYXRpb25JbXBsKWZl\ndGNoMikuaGFzRmV0Y2hHcm91cERlZmF1bHQoKTsKICAgICAgICAgICAgICAg\nIGlmIChoYXNGZXRjaEdyb3VwRGVmYXVsdCAmJiBoYXNGZXRjaEdyb3VwRGVm\nYXVsdDEpIAogICAgICAgICAgICAgICAgICAgIHNhbWVGZXRjaEdyb3VwID0g\ndHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAg\naWYgKCFzYW1lRmV0Y2hHcm91cCkgewogICAgICAgICAgICAgICAgU2V0IGZl\ndGNoR3JvdXBzID0gZmV0Y2gxLmdldEZldGNoR3JvdXBzKCk7CiAgICAgICAg\nICAgICAgICBTZXQgZmV0Y2hHcm91cHMxID0gZmV0Y2gyLmdldEZldGNoR3Jv\ndXBzKCk7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2hHcm91cHMgIT0gbnVs\nbCA/ICFmZXRjaEdyb3Vwcy5lcXVhbHMoZmV0Y2hHcm91cHMxKSA6IAogICAg\nICAgICAgICAgICAgCWZldGNoR3JvdXBzMSAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAKICAgICAgICAgICAgU2V0IGZpZWxkcyA9IGZldGNoMS5nZXRGaWVs\nZHMoKTsKICAgICAgICAgICAgU2V0IGZpZWxkczEgPSBmZXRjaDIuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgICAgIGludCBzaXplID0gZmllbGRzLnNpemUoKTsK\nICAgICAgICAgICAgaW50IHNpemUxID0gZmllbGRzMS5zaXplKCk7CiAgICAg\nICAgICAgIGlmIChzaXplID09IDAgJiYgc2l6ZTEgPT0gMCkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBlbHNlIGlmIChzaXpl\nICE9IHNpemUxKSAKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAK\nICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChmaWVsZHMgIT0gbnVsbCA/\nICFmaWVsZHMuZXF1YWxzKGZpZWxkczEpIDogZmllbGRzMSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIAogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAg\nICAgIGludCByZXN1bHQgPSAwOwogICAgICAgICAgICByZXN1bHQgPSAzMSAq\nIHJlc3VsdCArIChtYXBwaW5nICE9IG51bGwgPyBtYXBwaW5nLmhhc2hDb2Rl\nKCkgOiAwKTsKICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiByZXN1bHQgKyAo\nZm0gIT0gbnVsbCA/IGZtLmhhc2hDb2RlKCkgOiAwKTsKICAgICAgICAgICAg\ncmVzdWx0ID0gMzEgKiByZXN1bHQgKyBmZXRjaC5nZXRJc29sYXRpb24oKTsK\nICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiByZXN1bHQgKyBmZXRjaC5nZXRG\nZXRjaERpcmVjdGlvbigpOwogICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJl\nc3VsdCArIGZldGNoLmdldEVhZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAg\nIHJlc3VsdCA9IDMxICogcmVzdWx0ICsgZmV0Y2guZ2V0U3ViY2xhc3NGZXRj\naE1vZGUoKTsKICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiByZXN1bHQgKyBm\nZXRjaC5nZXRKb2luU3ludGF4KCk7CiAgICAgICAgICAgIFNldCBqb2lucyA9\nIGZldGNoLmdldEpvaW5zKCk7CiAgICAgICAgICAgIHJlc3VsdCA9IDMxICog\ncmVzdWx0ICsgKGpvaW5zICE9IG51bGwgPyBqb2lucy5oYXNoQ29kZSgpIDog\nMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJl\nc3VsdCArIGZldGNoLmdldE1heEZldGNoRGVwdGgoKTsKICAgICAgICAgICAg\ncmVzdWx0ID0gMzEgKiByZXN1bHQgKyBmZXRjaC5nZXRSZWFkTG9ja0xldmVs\nKCk7CiAgICAgICAgICAgIHJlc3VsdCA9IDMxICogcmVzdWx0ICsgZmV0Y2gu\nZ2V0V3JpdGVMb2NrTGV2ZWwoKTsKICAgICAgICAJCiAgICAgICAgICAgIGlm\nICgoKEpEQkNGZXRjaENvbmZpZ3VyYXRpb25JbXBsKWZldGNoKS5oYXNGZXRj\naEdyb3VwQWxsKCkpIAogICAgICAgICAgICAJcmVzdWx0ID0gMzEgKiByZXN1\nbHQgKyBGZXRjaEdyb3VwLk5BTUVfQUxMLmhhc2hDb2RlKCk7CiAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgU2V0IGZldGNoR3JvdXBzID0g\nZmV0Y2guZ2V0RmV0Y2hHcm91cHMoKTsKICAgICAgICAgICAgICAgIGlmICgo\nKEpEQkNGZXRjaENvbmZpZ3VyYXRpb25JbXBsKWZldGNoKS5oYXNGZXRjaEdy\nb3VwRGVmYXVsdCgpIAogICAgICAgICAgICAgICAgCSYmIGZldGNoR3JvdXBz\nICE9IG51bGwgJiYgZmV0Y2hHcm91cHMuc2l6ZSgpID09IDEpCiAgICAgICAg\nICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiByZXN1bHQgKyBGZXRjaEdyb3Vw\nLk5BTUVfREVGQVVMVC5oYXNoQ29kZSgpOwogICAgICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gMzEgKiByZXN1bHQg\nKyAoZmV0Y2hHcm91cHMgIT0gbnVsbCAmJiAKICAgICAgICAgICAgICAgICAg\nICAgICAgZmV0Y2hHcm91cHMuc2l6ZSgpID4gMCA/IAogICAgICAgICAgICAg\nICAgICAgICAgICBmZXRjaEdyb3Vwcy5oYXNoQ29kZSgpIDogMCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0IGZp\nZWxkcyA9IGZldGNoLmdldEZpZWxkcygpOwogICAgICAgIAlyZXN1bHQgPSAz\nMSAqIHJlc3VsdCArIChmaWVsZHMgIT0gbnVsbCAmJiAgZmllbGRzLnNpemUo\nKSA+IDAgPyAKICAgICAgICAJCWZpZWxkcy5oYXNoQ29kZSgpIDogMCk7CiAg\nICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAg\nIH0KICAgIH0KfQo=\n","encoding":"base64"}

