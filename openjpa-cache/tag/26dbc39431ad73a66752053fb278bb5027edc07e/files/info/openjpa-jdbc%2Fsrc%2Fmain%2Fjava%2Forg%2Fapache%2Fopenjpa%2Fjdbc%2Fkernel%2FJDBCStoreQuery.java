{"sha":"5a5c25dea4341dae64ed1c3944608bdc19f640cd","node_id":"MDQ6QmxvYjIwNjM2NDo1YTVjMjVkZWE0MzQxZGFlNjRlZDFjMzk0NDYwOGJkYzE5ZjY0MGNk","size":39374,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5a5c25dea4341dae64ed1c3944608bdc19f640cd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuRXhwQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5leHBzLkdldENvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNFeHByZXNzaW9uRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkpEQkNTdHJpbmdDb250YWluczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNXaWxkY2FyZE1hdGNoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUENQYXRoOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUXVl\ncnlFeHByZXNzaW9uc1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLmV4cHMuU1FMRW1iZWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TUUxFeHByZXNzaW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU1FMVmFs\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhw\ncy5WYWw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlVuaW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5FeHByZXNzaW9uU3Rv\ncmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmls\ndGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQ\nQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuT3JkZXJpbmdNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuUXVlcnlIaW50czsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9u\nRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5FeHByZXNzaW9uUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkZpbHRlckxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmtlcm5lbC5leHBzLkxpdGVyYWw7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLk1lcmdlZFJlc3VsdE9i\namVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5y\nb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0\naW9uOwppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogSkRCQyBx\ndWVyeSBpbXBsZW1lbnRhdGlvbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZVF1ZXJ5\nIAogICAgZXh0ZW5kcyBFeHByZXNzaW9uU3RvcmVRdWVyeSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgVGFibGUgSU5WQUxJRCA9IG5ldyBUYWJsZSgp\nOwoKICAgIC8vIGFkZCBhbGwgc3RhbmRhcmQgZmlsdGVyIGFuZCBhZ2dyZWdh\ndGUgbGlzdGVuZXJzIHRvIHRoZXNlIG1hcHMKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIE1hcCBfbGlzdGVuZXJzID0gbmV3IEhhc2hNYXAoKTsKCiAgICBz\ndGF0aWMgewogICAgICAgIC8vIGRlcHJlY2F0ZWQgZXh0ZW5zaW9ucwogICAg\nICAgIF9saXN0ZW5lcnMucHV0KEpEQkNTdHJpbmdDb250YWlucy5UQUcsIG5l\ndyBKREJDU3RyaW5nQ29udGFpbnMoKSk7CiAgICAgICAgX2xpc3RlbmVycy5w\ndXQoSkRCQ1dpbGRjYXJkTWF0Y2guVEFHLCBuZXcgSkRCQ1dpbGRjYXJkTWF0\nY2goKSk7CiAgICAgICAgX2xpc3RlbmVycy5wdXQoU1FMRXhwcmVzc2lvbi5U\nQUcsIG5ldyBTUUxFeHByZXNzaW9uKCkpOwogICAgICAgIF9saXN0ZW5lcnMu\ncHV0KFNRTFZhbHVlLlRBRywgbmV3IFNRTFZhbHVlKCkpOwoKICAgICAgICAv\nLyBqZGJjLXNwZWNpZmljIGV4dGVuc2lvbnMKICAgICAgICBfbGlzdGVuZXJz\nLnB1dChHZXRDb2x1bW4uVEFHLCBuZXcgR2V0Q29sdW1uKCkpOwogICAgICAg\nIF9saXN0ZW5lcnMucHV0KFNRTEVtYmVkLlRBRywgbmV3IFNRTEVtYmVkKCkp\nOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgdHJhbnNpZW50IEpEQkNTdG9y\nZSBfc3RvcmU7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5\nIHN0b3JlIG1hbmFnZXIuCiAgICAgKi8KICAgIHB1YmxpYyBKREJDU3RvcmVR\ndWVyeShKREJDU3RvcmUgc3RvcmUsIEV4cHJlc3Npb25QYXJzZXIgcGFyc2Vy\nKSB7CiAgICAgICAgc3VwZXIocGFyc2VyKTsKICAgICAgICBfc3RvcmUgPSBz\ndG9yZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc3RvcmUu\nCiAgICAgKi8KICAgIHB1YmxpYyBKREJDU3RvcmUgZ2V0U3RvcmUoKSB7CiAg\nICAgICAgcmV0dXJuIF9zdG9yZTsKICAgIH0KCiAgICBwdWJsaWMgRmlsdGVy\nTGlzdGVuZXIgZ2V0RmlsdGVyTGlzdGVuZXIoU3RyaW5nIHRhZykgewogICAg\nICAgIHJldHVybiAoRmlsdGVyTGlzdGVuZXIpIF9saXN0ZW5lcnMuZ2V0KHRh\nZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdDb21waWxhdGlvbktl\neSgpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0g\nKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGN0eAogICAgICAgICAgICAuZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0dXJuIE51bWJlcnMu\ndmFsdWVPZihmZXRjaC5nZXRKb2luU3ludGF4KCkpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkgewog\nICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHByb3RlY3RlZCBDbGFz\nc01ldGFEYXRhW10gZ2V0SW5kZXBlbmRlbnRFeHByZXNzaW9uQ2FuZGlkYXRl\ncygKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gc3ViY2xh\nc3NlcykgewogICAgICAgIGlmICghc3ViY2xhc3NlcykKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBDbGFzc01hcHBpbmdbXSB7IChDbGFzc01hcHBpbmcpIG1l\ndGEgfTsKICAgICAgICByZXR1cm4gKChDbGFzc01hcHBpbmcpIG1ldGEpLmdl\ndEluZGVwZW5kZW50QXNzaWduYWJsZU1hcHBpbmdzKCk7CiAgICB9CgogICAg\ncHJvdGVjdGVkIEV4cHJlc3Npb25GYWN0b3J5IGdldEV4cHJlc3Npb25GYWN0\nb3J5KENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBuZXcg\nSkRCQ0V4cHJlc3Npb25GYWN0b3J5KChDbGFzc01hcHBpbmcpIG1ldGEpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBSZXN1bHRPYmplY3RQcm92aWRlciBleGVj\ndXRlUXVlcnkoRXhlY3V0b3IgZXgsCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBi\nYXNlLCBDbGFzc01ldGFEYXRhW10gbWV0YXMsIGJvb2xlYW4gc3ViY2xhc3Nl\ncywKICAgICAgICBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLCBRdWVyeUV4\ncHJlc3Npb25zW10gZXhwcywgT2JqZWN0W10gcGFyYW1zLAogICAgICAgIFJh\nbmdlIHJhbmdlKSB7CiAgICAgICAgaWYgKG1ldGFzLmxlbmd0aCA+IDEgJiYg\nZXhwc1swXS5pc0FnZ3JlZ2F0ZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihMb2NhbGl6ZXIuZm9yUGFja2FnZShKREJDU3RvcmVR\ndWVyeS5jbGFzcykuCiAgICAgICAgICAgICAgICBnZXQoIm11bHQtbWFwcGlu\nZy1hZ2dyZWdhdGUiLCBBcnJheXMuYXNMaXN0KG1ldGFzKSkpOwoKICAgICAg\nICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IChDbGFzc01hcHBpbmdbXSkg\nbWV0YXM7CiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9\nIChKREJDRmV0Y2hDb25maWd1cmF0aW9uKSAKICAgICAgICAgICAgY3R4Lmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIGlmIChleHBzWzBdLmZl\ndGNoUGF0aHMgIT0gbnVsbCkgewogICAgICAgICAgICBmZXRjaC5hZGRGaWVs\nZHMoQXJyYXlzLmFzTGlzdChleHBzWzBdLmZldGNoUGF0aHMpKTsKICAgICAg\nICAgICAgZmV0Y2guYWRkSm9pbnMoQXJyYXlzLmFzTGlzdChleHBzWzBdLmZl\ndGNoUGF0aHMpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGV4cHNbMF0uZmV0\nY2hJbm5lclBhdGhzICE9IG51bGwpCiAgICAgICAgICAgIGZldGNoLmFkZEZl\ndGNoSW5uZXJKb2lucyhBcnJheXMuYXNMaXN0KGV4cHNbMF0uZmV0Y2hJbm5l\nclBhdGhzKSk7CgogICAgICAgIGludCBlYWdlciA9IGNhbGN1bGF0ZUVhZ2Vy\nTW9kZShleHBzWzBdLCByYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTsKICAgICAg\nICBpbnQgc3ViY2xhc3NNb2RlID0gZmV0Y2guZ2V0U3ViY2xhc3NGZXRjaE1v\nZGUoKENsYXNzTWFwcGluZykgYmFzZSk7CiAgICAgICAgREJEaWN0aW9uYXJ5\nIGRpY3QgPSBfc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCk7CiAgICAgICAgbG9u\nZyBzdGFydCA9IChtYXBwaW5ncy5sZW5ndGggPT0gMSAmJiBkaWN0LnN1cHBv\ncnRzU2VsZWN0U3RhcnRJbmRleCkgCiAgICAgICAgICAgID8gcmFuZ2Uuc3Rh\ncnQgOiAwTDsKICAgICAgICBsb25nIGVuZCA9IChkaWN0LnN1cHBvcnRzU2Vs\nZWN0RW5kSW5kZXgpID8gcmFuZ2UuZW5kIDogTG9uZy5NQVhfVkFMVUU7Cgog\nICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtdIHN0YXRlcyA9IG5ldyBR\ndWVyeUV4cHJlc3Npb25zU3RhdGVbZXhwcy5sZW5ndGhdOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBzdGF0ZXNbaV0gPSBuZXcgUXVlcnlFeHByZXNzaW9uc1N0YXRlKCk7\nCiAgICAgICAgRXhwQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChfc3Rv\ncmUsIHBhcmFtcywgZmV0Y2gpOwoKICAgICAgICAvLyBhZGQgc2VsZWN0cyB3\naXRoIHBvcHVsYXRlIFdIRVJFIGNvbmRpdGlvbnMgdG8gbGlzdAogICAgICAg\nIExpc3Qgc2VscyA9IG5ldyBBcnJheUxpc3QobWFwcGluZ3MubGVuZ3RoKTsK\nICAgICAgICBMaXN0IHNlbE1hcHBpbmdzID0gbmV3IEFycmF5TGlzdChtYXBw\naW5ncy5sZW5ndGgpOwogICAgICAgIEJpdFNldCBzdWJjbGFzc0JpdHMgPSBu\nZXcgQml0U2V0KCk7CiAgICAgICAgQml0U2V0IG5leHRCaXRzID0gbmV3IEJp\ndFNldCgpOwogICAgICAgIGJvb2xlYW4gdW5pb25hYmxlID0gY3JlYXRlV2hl\ncmVTZWxlY3RzKHNlbHMsIG1hcHBpbmdzLCBzZWxNYXBwaW5ncywKICAgICAg\nICAgICAgc3ViY2xhc3Nlcywgc3ViY2xhc3NCaXRzLCBuZXh0Qml0cywgZmFj\ndHMsIGV4cHMsIHN0YXRlcywgY3R4LAogICAgICAgICAgICBzdWJjbGFzc01v\nZGUpCiAgICAgICAgICAgICYmIHN1YmNsYXNzTW9kZSA9PSBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uLkVBR0VSX0pPSU4KICAgICAgICAgICAgJiYgc3RhcnQg\nPT0gMAogICAgICAgICAgICAmJiBlbmQgPT0gTG9uZy5NQVhfVkFMVUU7Cgog\nICAgICAgIC8vIHdlIG1pZ2h0IHdhbnQgdG8gdXNlIGxycyBzZXR0aW5ncyBp\nZiB3ZSBjYW4ndCB1c2UgdGhlIHJhbmdlCiAgICAgICAgaWYgKHNlbHMuc2l6\nZSgpID4gMSkKICAgICAgICAgICAgc3RhcnQgPSAwTDsKICAgICAgICBib29s\nZWFuIGxycyA9IHJhbmdlLmxycyB8fCAoZmV0Y2guZ2V0RmV0Y2hCYXRjaFNp\nemUoKSA+PSAwIAogICAgICAgICAgICAmJiAoc3RhcnQgIT0gcmFuZ2Uuc3Rh\ncnQgfHwgZW5kICE9IHJhbmdlLmVuZCkpOwoKICAgICAgICBSZXN1bHRPYmpl\nY3RQcm92aWRlcltdIHJvcHMgPSBudWxsOwogICAgICAgIFJlc3VsdE9iamVj\ndFByb3ZpZGVyIHJvcCA9IG51bGw7CiAgICAgICAgaWYgKHVuaW9uYWJsZSkg\newogICAgICAgICAgICBVbmlvbiB1bmlvbiA9IF9zdG9yZS5nZXRTUUxGYWN0\nb3J5KCkubmV3VW5pb24oCiAgICAgICAgICAgICAgICAoU2VsZWN0W10pIHNl\nbHMudG9BcnJheShuZXcgU2VsZWN0W3NlbHMuc2l6ZSgpXSkpOwogICAgICAg\nICAgICBCaXRTZXRbXSBwYWdlZCA9IHBvcHVsYXRlVW5pb24odW5pb24sIG1h\ncHBpbmdzLCBzdWJjbGFzc2VzLCBmYWN0cywKICAgICAgICAgICAgICAgIGV4\ncHMsIHN0YXRlcywgY3R4LCBscnMsIGVhZ2VyLCBzdGFydCwgZW5kKTsKICAg\nICAgICAgICAgdW5pb24uc2V0TFJTKGxycyk7CiAgICAgICAgICAgIHJvcCA9\nIGV4ZWN1dGVVbmlvbih1bmlvbiwgbWFwcGluZ3MsIGV4cHMsIHN0YXRlcywg\nY3R4LCBwYWdlZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYg\nKHNlbHMuc2l6ZSgpID4gMSkKICAgICAgICAgICAgICAgIHJvcHMgPSBuZXcg\nUmVzdWx0T2JqZWN0UHJvdmlkZXJbc2Vscy5zaXplKCldOwoKICAgICAgICAg\nICAgU2VsZWN0IHNlbDsKICAgICAgICAgICAgQml0U2V0IHBhZ2VkOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMCwgaWR4ID0gMDsgaSA8IHNlbHMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHNlbCA9IChTZWxlY3QpIHNl\nbHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgcGFnZWQgPSBwb3B1bGF0ZVNl\nbGVjdChzZWwsIChDbGFzc01hcHBpbmcpIHNlbE1hcHBpbmdzLmdldChpKSwK\nICAgICAgICAgICAgICAgICAgICBzdWJjbGFzc0JpdHMuZ2V0KGkpLCAoSkRC\nQ0V4cHJlc3Npb25GYWN0b3J5KSBmYWN0c1tpZHhdLAogICAgICAgICAgICAg\nICAgICAgIGV4cHNbaWR4XSwgc3RhdGVzW2lkeF0sIGN0eCwgbHJzLCBlYWdl\nciwgc3RhcnQsIGVuZCk7CgogICAgICAgICAgICAgICAgcm9wID0gZXhlY3V0\nZVNlbGVjdChzZWwsIChDbGFzc01hcHBpbmcpIHNlbE1hcHBpbmdzLmdldChp\nKSwKICAgICAgICAgICAgICAgICAgICBleHBzW2lkeF0sIHN0YXRlc1tpZHhd\nLCBjdHgsIHBhZ2VkLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAgICAgIGlm\nIChyb3BzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcm9wc1tpXSA9\nIHJvcDsKCiAgICAgICAgICAgICAgICBpZiAobmV4dEJpdHMuZ2V0KGkpKQog\nICAgICAgICAgICAgICAgICAgIGlkeCsrOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpZiAocm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChleHBzWzBdLmFzY2VuZGluZy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgICAgIHJvcCA9IG5ldyBNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihy\nb3BzKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByb3Ag\nPSBuZXcgT3JkZXJpbmdNZXJnZWRSZXN1bHRPYmplY3RQcm92aWRlcihyb3Bz\nLAogICAgICAgICAgICAgICAgICAgIGV4cHNbMF0uYXNjZW5kaW5nLCBleCwg\ndGhpcywgcGFyYW1zKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gbmVlZCB0byBmYWtlIHJlc3VsdCByYW5nZT8KICAgICAgICBpZiAo\nKHJvcHMgIT0gbnVsbCAmJiByYW5nZS5lbmQgIT0gTG9uZy5NQVhfVkFMVUUp\nIAogICAgICAgICAgICB8fCBzdGFydCAhPSByYW5nZS5zdGFydCB8fCBlbmQg\nIT0gcmFuZ2UuZW5kKQogICAgICAgICAgICByb3AgPSBuZXcgUmFuZ2VSZXN1\nbHRPYmplY3RQcm92aWRlcihyb3AsIHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQp\nOwogICAgICAgIHJldHVybiByb3A7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZWxlY3QgZGF0YSBmb3IgdGhlIGdpdmVuIHVuaW9uLCByZXR1cm5pbmcgcGFn\nZWQgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldFtdIHBvcHVs\nYXRlVW5pb24oVW5pb24gdW5pb24sIGZpbmFsIENsYXNzTWFwcGluZ1tdIG1h\ncHBpbmdzLAogICAgICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xhc3NlcywgZmlu\nYWwgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywKICAgICAgICBmaW5hbCBR\ndWVyeUV4cHJlc3Npb25zW10gZXhwcywgZmluYWwgUXVlcnlFeHByZXNzaW9u\nc1N0YXRlW10gc3RhdGVzLAogICAgICAgIGZpbmFsIEV4cENvbnRleHQgY3R4\nLCBmaW5hbCBib29sZWFuIGxycywgZmluYWwgaW50IGVhZ2VyLAogICAgICAg\nIGZpbmFsIGxvbmcgc3RhcnQsIGZpbmFsIGxvbmcgZW5kKSB7CiAgICAgICAg\nZmluYWwgQml0U2V0W10gcGFnZWQgPSAoZXhwc1swXS5wcm9qZWN0aW9ucy5s\nZW5ndGggPiAwKSA/IG51bGwKICAgICAgICAgICAgOiBuZXcgQml0U2V0W21h\ncHBpbmdzLmxlbmd0aF07CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlv\nbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0\nKFNlbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIEJpdFNl\ndCBiaXRzID0gcG9wdWxhdGVTZWxlY3Qoc2VsLCBtYXBwaW5nc1tpZHhdLCBz\ndWJjbGFzc2VzLAogICAgICAgICAgICAgICAgICAgIChKREJDRXhwcmVzc2lv\nbkZhY3RvcnkpIGZhY3RzW2lkeF0sIGV4cHNbaWR4XSwgc3RhdGVzW2lkeF0s\nCiAgICAgICAgICAgICAgICAgICAgY3R4LCAgbHJzLCBlYWdlciwgc3RhcnQs\nIGVuZCk7CiAgICAgICAgICAgICAgICBpZiAocGFnZWQgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBwYWdlZFtpZHhdID0gYml0czsKICAgICAgICAg\nICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBwYWdlZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNlbGVjdCBkYXRhIGZvciB0aGUgZ2l2ZW4gc2Vs\nZWN0LCByZXR1cm5pbmcgcGFnZWQgZmllbGRzLgogICAgICovCiAgICBwcml2\nYXRlIEJpdFNldCBwb3B1bGF0ZVNlbGVjdChTZWxlY3Qgc2VsLCBDbGFzc01h\ncHBpbmcgbWFwcGluZywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMsIEpE\nQkNFeHByZXNzaW9uRmFjdG9yeSBmYWN0LCBRdWVyeUV4cHJlc3Npb25zIGV4\ncHMsCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlLCBFeHBD\nb250ZXh0IGN0eCwgYm9vbGVhbiBscnMsIGludCBlYWdlciwKICAgICAgICBs\nb25nIHN0YXJ0LCBsb25nIGVuZCkgewogICAgICAgIHNlbC5zZXRMUlMobHJz\nKTsKICAgICAgICBzZWwuc2V0UmFuZ2Uoc3RhcnQsIGVuZCk7CgogICAgICAg\nIEJpdFNldCBwYWdlZCA9IG51bGw7CiAgICAgICAgaWYgKGV4cHMucHJvamVj\ndGlvbnMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgcGFnZWQgPSBQYWdp\nbmdSZXN1bHRPYmplY3RQcm92aWRlci5nZXRQYWdlZEZpZWxkcyhzZWwsIG1h\ncHBpbmcsCiAgICAgICAgICAgICAgICBfc3RvcmUsIGN0eC5mZXRjaCwgZWFn\nZXIsIGVuZCAtIHN0YXJ0KTsKICAgICAgICAgICAgaWYgKHBhZ2VkICE9IG51\nbGwpCiAgICAgICAgICAgICAgICBlYWdlciA9IEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24uRUFHRVJfSk9JTjsKICAgICAgICB9CgogICAgICAgIGZhY3QuZ2V0\nU2VsZWN0Q29uc3RydWN0b3IoKS5zZWxlY3Qoc2VsLCBjdHgsIG1hcHBpbmcs\nIHN1YmNsYXNzZXMsIGV4cHMsCiAgICAgICAgICAgIHN0YXRlLCBlYWdlcik7\nCiAgICAgICAgcmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIC8qKgogICAgICog\nRXhlY3V0ZSB0aGUgZ2l2ZW4gdW5pb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgZXhlY3V0ZVVuaW9uKFVuaW9uIHVuaW9u\nLAogICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzLCBRdWVyeUV4cHJl\nc3Npb25zW10gZXhwcywgCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRl\nW10gc3RhdGVzLCBFeHBDb250ZXh0IGN0eCwgQml0U2V0W10gcGFnZWQpIHsK\nICAgICAgICBpZiAoZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5ndGggPiAwKQog\nICAgICAgICAgICByZXR1cm4gbmV3IFByb2plY3Rpb25SZXN1bHRPYmplY3RQ\ncm92aWRlcih1bmlvbiwgZXhwcywgc3RhdGVzLCBjdHgpOwoKICAgICAgICBp\nZiAocGFnZWQgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBwYWdlZC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChw\nYWdlZFtpXSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgUGFnaW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdz\nLAogICAgICAgICAgICAgICAgICAgICAgICBfc3RvcmUsIGN0eC5mZXRjaCwg\ncGFnZWQsIExvbmcuTUFYX1ZBTFVFKTsKCiAgICAgICAgcmV0dXJuIG5ldyBJ\nbnN0YW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5nc1sw\nXSwgX3N0b3JlLAogICAgICAgICAgICBjdHguZmV0Y2gpOwogICAgfQoKICAg\nIC8qKgogICAgICogRXhlY3V0ZSB0aGUgZ2l2ZW4gc2VsZWN0LgogICAgICov\nCiAgICBwcml2YXRlIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVTZWxl\nY3QoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAg\nUXVlcnlFeHByZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJlc3Npb25zU3RhdGUg\nc3RhdGUsIEV4cENvbnRleHQgY3R4LCAKICAgICAgICBCaXRTZXQgcGFnZWQs\nIGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgaWYgKGV4cHMucHJv\namVjdGlvbnMubGVuZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBQ\ncm9qZWN0aW9uUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLCBleHBzLCBzdGF0\nZSwgY3R4KTsKICAgICAgICBpZiAocGFnZWQgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcihzZWws\nIG1hcHBpbmcsIF9zdG9yZSwgCiAgICAgICAgICAgICAgICBjdHguZmV0Y2gs\nIHBhZ2VkLCBlbmQgLSBzdGFydCk7CiAgICAgICAgcmV0dXJuIG5ldyBJbnN0\nYW5jZVJlc3VsdE9iamVjdFByb3ZpZGVyKHNlbCwgbWFwcGluZywgX3N0b3Jl\nLCAKICAgICAgICAgICAgY3R4LmZldGNoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdlbmVyYXRlIHRoZSBzZWxlY3RzIHdpdGggV0hFUkUgY29uZGl0aW9u\ncyBuZWVkZWQgdG8gZXhlY3V0ZSB0aGUgcXVlcnkKICAgICAqIGZvciB0aGUg\nZ2l2ZW4gbWFwcGluZ3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBj\ncmVhdGVXaGVyZVNlbGVjdHMoTGlzdCBzZWxzLCBDbGFzc01hcHBpbmdbXSBt\nYXBwaW5ncywKICAgICAgICBMaXN0IHNlbE1hcHBpbmdzLCBib29sZWFuIHN1\nYmNsYXNzZXMsIEJpdFNldCBzdWJjbGFzc0JpdHMsCiAgICAgICAgQml0U2V0\nIG5leHRCaXRzLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLCBRdWVyeUV4\ncHJlc3Npb25zW10gZXhwcywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zU3Rh\ndGVbXSBzdGF0ZXMsIEV4cENvbnRleHQgY3R4LCBpbnQgc3ViY2xhc3NNb2Rl\nKSB7CiAgICAgICAgTnVtYmVyIG9wdEhpbnQgPSAoTnVtYmVyKSBjdHguZmV0\nY2guZ2V0SGludAogICAgICAgICAgICAoUXVlcnlIaW50cy5ISU5UX1JFU1VM\nVF9DT1VOVCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gdmVydHM7CiAgICAg\nICAgYm9vbGVhbiB1bmlvbmFibGUgPSB0cnVlOwogICAgICAgIFNlbGVjdCBz\nZWw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAvLyBkZXRlcm1pbmUgdmVydGljYWwg\nbWFwcGluZ3MgdG8gc2VsZWN0IHNlcGFyYXRlbHkKICAgICAgICAgICAgdmVy\ndHMgPSBnZXRWZXJ0aWNhbE1hcHBpbmdzKG1hcHBpbmdzW2ldLCBzdWJjbGFz\nc2VzLCBleHBzW2ldLAogICAgICAgICAgICAgICAgc3ViY2xhc3NNb2RlKTsK\nICAgICAgICAgICAgaWYgKHZlcnRzLmxlbmd0aCA9PSAxICYmIHN1YmNsYXNz\nZXMpCiAgICAgICAgICAgICAgICBzdWJjbGFzc0JpdHMuc2V0KHNlbHMuc2l6\nZSgpKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBjcml0ZXJpYSBzZWxlY3Qg\nYW5kIGNsb25lIGZvciBlYWNoIHZlcnQgbWFwcGluZwogICAgICAgICAgICBz\nZWwgPSAoKEpEQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFjdHNbaV0pLmdldFNl\nbGVjdENvbnN0cnVjdG9yKCkuCiAgICAgICAgICAgICAgICBldmFsdWF0ZShj\ndHgsIG51bGwsIG51bGwsIGV4cHNbaV0sIHN0YXRlc1tpXSk7CiAgICAgICAg\nICAgIGlmIChvcHRIaW50ICE9IG51bGwpCiAgICAgICAgICAgICAgIHNlbC5z\nZXRFeHBlY3RlZFJlc3VsdENvdW50KG9wdEhpbnQuaW50VmFsdWUoKSwgdHJ1\nZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuY3R4LmlzVW5pcXVlKCkp\nCiAgICAgICAgICAgICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgx\nLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdmVy\ndHMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIHNlbE1hcHBpbmdz\nLmFkZCh2ZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICBpZiAoaiA9PSB2ZXJ0\ncy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEJpdHMu\nc2V0KHNlbHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICBzZWxzLmFk\nZChzZWwpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgc2Vscy5hZGQoc2VsLmZ1bGxDbG9uZSgxKSk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHR1cm4gb2ZmIHVuaW9uaW5nIGlmIGEgZ2l2\nZW4gaW5kZXBlbmRlbnQgbWFwcGluZyByZXF1aXJlcwogICAgICAgICAgICAv\nLyBtdWx0aXBsZSBzZWxlY3RzLCBvciBpZiB3ZSdyZSB1c2luZyBGUk9NIHNl\nbGVjdHMKICAgICAgICAgICAgaWYgKHZlcnRzLmxlbmd0aCA+IDEgfHwgc2Vs\nLmdldEZyb21TZWxlY3QoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdW5p\nb25hYmxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1bmlv\nbmFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIHRoZSB2\nZXJ0aWNhbCBtYXBwaW5ncyB0byBzZWxlY3Qgc2VwYXJhdGVseS4gRGVwZW5k\ncyBvbgogICAgICogc3ViY2xhc3MgZmV0Y2ggbW9kZSBhbmQgdGhlIHR5cGUg\nb2YgcXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nW10g\nZ2V0VmVydGljYWxNYXBwaW5ncyhDbGFzc01hcHBpbmcgbWFwcGluZywKICAg\nICAgICBib29sZWFuIHN1YmNsYXNzZXMsIFF1ZXJ5RXhwcmVzc2lvbnMgZXhw\ncywgaW50IHN1YmNsYXNzTW9kZSkgewogICAgICAgIGlmICghc3ViY2xhc3Nl\ncyB8fCBleHBzLnByb2plY3Rpb25zLmxlbmd0aCA+IDApCiAgICAgICAgICAg\nIHJldHVybiBuZXcgQ2xhc3NNYXBwaW5nW10geyBtYXBwaW5nIH07CgogICAg\nICAgIGlmIChzdWJjbGFzc01vZGUgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbi5FQUdFUl9QQVJBTExFTAogICAgICAgICAgICB8fCAhaGFzVmVydGljYWxT\ndWJjbGFzc2VzKG1hcHBpbmcpKQogICAgICAgICAgICByZXR1cm4gbmV3IENs\nYXNzTWFwcGluZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBMaXN0IHN1YnMg\nPSBuZXcgQXJyYXlMaXN0KDQpOwogICAgICAgIGFkZFN1YmNsYXNzZXMobWFw\ncGluZywgc3Vicyk7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkg\nc3Vicy50b0FycmF5KG5ldyBDbGFzc01hcHBpbmdbc3Vicy5zaXplKCldKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgdG8gYWRk\nIG1hcHBpbmdzIGZvciBzdWJjbGFzc2VzIHRvIHRoZSBnaXZlbiBsaXN0Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NlcyhDbGFzc01h\ncHBpbmcgbWFwcGluZywgQ29sbGVjdGlvbiBzdWJzKSB7CiAgICAgICAgLy8g\ncG9zc2libGUgZnV0dXJlIG9wdGltaXphdGlvbnM6CiAgICAgICAgLy8gLSBp\nZiBubyBmaWVsZHMgaW4gbWV0YSBvciBpdHMgc3ViY2xhc3NlcyAoYW5kIG5v\ndCBpbiBhbgogICAgICAgIC8vICAgYWxyZWFkeS1zZWxlY3RlZCB0YWJsZSkg\nYXJlIGluIHRoZSBjdXJyZW50IGZldGNoCiAgICAgICAgLy8gICBjb25maWd1\ncmF0aW9uLCBzdG9wIGNyZWF0aW5nIG5ldyBleGVjdXRvcnMKICAgICAgICAv\nLyAtIGFsbG93IGFuIGV4ZWN1dG9yIHRvIHNlbGVjdCBhIHJhbmdlIG9mIHN1\nYmNsYXNzZXMsIHJhdGhlcgogICAgICAgIC8vICAgdGhhbiBqdXN0IGFsbCBz\ndWJjbGFzc2VzIC8gbm8gc3ViY2xhc3NlczsgdGhpcyB3b3VsZAogICAgICAg\nIC8vICAgYWxsb3cgdXMgdG8gZG8ganVzdCBvbmUgcXVlcnkgcGVyIGFjdHVh\nbCB2ZXJ0aWNhbGx5LW1hcHBlZAogICAgICAgIC8vICAgc3ViY2xhc3MsIHJh\ndGhlciB0aGFuIG9uZSBwZXIgbWFwcGVkIHN1YmNsYXNzLCBhcyBpcyBoYXBw\nZW5pbmcgbm93CgogICAgICAgIHN1YnMuYWRkKG1hcHBpbmcpOwogICAgICAg\nIGlmICghaGFzVmVydGljYWxTdWJjbGFzc2VzKG1hcHBpbmcpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIHJlY3Vyc2Ugb24gaW1tZWRpYXRl\nIHN1YmNsYXNzZXMKICAgICAgICBDbGFzc01hcHBpbmdbXSBzdWJNYXBwaW5n\ncyA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1Yk1hcHBpbmdzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoc3ViTWFwcGluZ3NbaV0uZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgPT0gbWFwcGluZykKICAgICAg\nICAgICAgICAgIGFkZFN1YmNsYXNzZXMoc3ViTWFwcGluZ3NbaV0sIHN1YnMp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdp\ndmVuIGNsYXNzIGhhcyBhbnkgdmVydGljYWwgc3ViY2xhc3Nlcy4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBoYXNWZXJ0aWNhbFN1YmNs\nYXNzZXMoQ2xhc3NNYXBwaW5nIG1hcHBpbmcpIHsKICAgICAgICBDbGFzc01h\ncHBpbmdbXSBzdWJzID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3ViY2xhc3NN\nYXBwaW5ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHN1YnNbaV0uZ2V0U3RyYXRl\nZ3koKSBpbnN0YW5jZW9mIFZlcnRpY2FsQ2xhc3NTdHJhdGVneSkKICAgICAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBlYWdlciBtb2RlIGRlcGVuZHMg\nb24gdGhlIHVuaXF1ZSBzZXR0aW5nIGFuZCByYW5nZS4gSWYgdGhlIHJhbmdl\nCiAgICAgKiBwcm9kdWNlcyAwIHJlc3VsdHMsIHVzZSBlYWdlciBzZXR0aW5n\nIG9mIG5vbmUuIElmIGl0IHByb2R1Y2VzIDEgcmVzdWx0CiAgICAgKiBvciB0\naGUgcXVlcnkgaXMgdW5pcXVlLCB1c2UgYW4gZWFnZXIgc2V0dGluZyBvZiBz\naW5nbGUuIE90aGVyd2lzZSB1c2UKICAgICAqIGFuIGVhZ2VyIG1vZGUgb2Yg\nbXVsdGlwbGUuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGNhbGN1bGF0ZUVh\nZ2VyTW9kZShRdWVyeUV4cHJlc3Npb25zIGV4cHMsIGxvbmcgc3RhcnQsCiAg\nICAgICAgbG9uZyBlbmQpIHsKICAgICAgICBpZiAoZXhwcy5wcm9qZWN0aW9u\ncy5sZW5ndGggPiAwIHx8IHN0YXJ0ID49IGVuZCkKICAgICAgICAgICAgcmV0\ndXJuIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9OT05FOwogICAgICAgIGlmIChl\nbmQgLSBzdGFydCA9PSAxIHx8IGN0eC5pc1VuaXF1ZSgpKQogICAgICAgICAg\nICByZXR1cm4gRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU47CiAgICAgICAg\ncmV0dXJuIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9QQVJBTExFTDsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgTnVtYmVyIGV4ZWN1dGVEZWxldGUoRXhlY3V0b3Ig\nZXgsIENsYXNzTWV0YURhdGEgYmFzZSwKICAgICAgICBDbGFzc01ldGFEYXRh\nW10gbWV0YXMsIGJvb2xlYW4gc3ViY2xhc3NlcywgRXhwcmVzc2lvbkZhY3Rv\ncnlbXSBmYWN0cywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zW10gZXhwcywg\nT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVCdWxr\nT3BlcmF0aW9uKG1ldGFzLCBzdWJjbGFzc2VzLCBmYWN0cywgZXhwcywKICAg\nICAgICAgICAgcGFyYW1zLCBudWxsKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nTnVtYmVyIGV4ZWN1dGVVcGRhdGUoRXhlY3V0b3IgZXgsIENsYXNzTWV0YURh\ndGEgYmFzZSwKICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMsIGJvb2xl\nYW4gc3ViY2xhc3NlcywgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywKICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zW10gZXhwcywgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVCdWxrT3BlcmF0aW9uKG1ldGFz\nLCBzdWJjbGFzc2VzLCBmYWN0cywgZXhwcywKICAgICAgICAgICAgcGFyYW1z\nLCBleHBzWzBdLnVwZGF0ZXMpOwogICAgfQoKICAgIHByaXZhdGUgTnVtYmVy\nIGV4ZWN1dGVCdWxrT3BlcmF0aW9uKENsYXNzTWV0YURhdGFbXSBtZXRhcywK\nICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5\nW10gZmFjdHMsIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLAogICAgICAgIE9i\namVjdFtdIHBhcmFtcywgTWFwIHVwZGF0ZXMpIHsKICAgICAgICAvLyB3ZSBj\nYW5ub3QgZXhlY3V0ZSBhIGJ1bGsgZGVsZXRlIHN0YXRlbWVudCB3aGVuIGhh\ndmUgbWFwcGluZ3MgaW4KICAgICAgICAvLyBtdWx0aXBsZSB0YWJsZXMsIHNv\nIGluZGljYXRlIHdlIHdhbnQgdG8gdXNlIGluLW1lbW9yeSB3aXRoIG51bGwK\nICAgICAgICBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncyA9IChDbGFzc01hcHBp\nbmdbXSkgbWV0YXM7CgogICAgICAgIC8vIHNwZWNpZmljYXRpb24gb2YgdGhl\nICJ1cGRhdGVzIiBtYXAgaW5kaWNhdGVzIHRoYXQgdGhpcyBpcwogICAgICAg\nIC8vIGFuIHVwZGF0ZSBxdWVyeTsgb3RoZXJ3aXNlLCB0aGlzIGlzIGEgZGVs\nZXRlIHN0YXRlbWVudAogICAgICAgIGJvb2xlYW4gaXNVcGRhdGUgPSB1cGRh\ndGVzICE9IG51bGwgJiYgdXBkYXRlcy5zaXplKCkgPiAwOwoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmICghaXNTaW5nbGVUYWJsZU1hcHBpbmcobWFwcGluZ3Nb\naV0sIHN1YmNsYXNzZXMpICYmICFpc1VwZGF0ZSkKICAgICAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICAgICAgaWYgKCFpc1VwZGF0ZSkgewog\nICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIGFueSBkZWxldGUgY2Fs\nbGJhY2tzLCB3ZSBuZWVkIHRvCiAgICAgICAgICAgICAgICAvLyBleGVjdXRl\nIGluLW1lbW9yeSBzbyB0aGUgY2FsbGJhY2tzIGFyZSBpbnZva2VkCiAgICAg\nICAgICAgICAgICBMaWZlY3ljbGVFdmVudE1hbmFnZXIgbWdyID0gY3R4Lmdl\ndFN0b3JlQ29udGV4dCgpLmdldEJyb2tlcigpCiAgICAgICAgICAgICAgICAg\nICAgLmdldExpZmVjeWNsZUV2ZW50TWFuYWdlcigpOwogICAgICAgICAgICAg\nICAgaWYgKG1nci5oYXNEZWxldGVMaXN0ZW5lcnMobnVsbCwgbWFwcGluZ3Nb\naV0pKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIAogICAgICAg\nICAgICBjdHguZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgRXhw\nQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChfc3RvcmUsIHBhcmFtcywg\nZmV0Y2gpOwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gX3N0b3JlLmdl\ndERCRGljdGlvbmFyeSgpOwogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNTdGF0\nZVtdIHN0YXRlID0gbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtleHBzLmxl\nbmd0aF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGF0ZS5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgc3RhdGVbaV0gPSBuZXcgUXVlcnlFeHBy\nZXNzaW9uc1N0YXRlKCk7CgogICAgICAgIFNRTEJ1ZmZlcltdIHNxbCA9IG5l\ndyBTUUxCdWZmZXJbbWFwcGluZ3MubGVuZ3RoXTsKICAgICAgICBKREJDRXhw\ncmVzc2lvbkZhY3RvcnkgamRiY0ZhY3Rvcnk7CiAgICAgICAgU2VsZWN0IHNl\nbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1hcHBpbmdzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGpkYmNGYWN0b3J5ID0gKEpEQkNFeHBy\nZXNzaW9uRmFjdG9yeSkgZmFjdHNbaV07CiAgICAgICAgICAgIHNlbCA9IGpk\nYmNGYWN0b3J5LmdldFNlbGVjdENvbnN0cnVjdG9yKCkuZXZhbHVhdGUoY3R4\nLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgZXhwc1tpXSwgc3RhdGVb\naV0pOwogICAgICAgICAgICBqZGJjRmFjdG9yeS5nZXRTZWxlY3RDb25zdHJ1\nY3RvcigpLnNlbGVjdChzZWwsIGN0eCwgbWFwcGluZ3NbaV0sIAogICAgICAg\nICAgICAgICAgc3ViY2xhc3NlcywgZXhwc1tpXSwgc3RhdGVbaV0sIAogICAg\nICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05F\nKTsKCiAgICAgICAgICAgIC8vIFRoZSBidWxrIG9wZXJhdGlvbiB3aWxsIHJl\ndHVybiBudWxsIHRvIGluZGljYXRlIHRoYXQgdGhlIGRhdGFiYXNlCiAgICAg\nICAgICAgIC8vIGRvZXMgbm90IHN1cHBvcnQgdGhlIHJlcXVlc3QgYnVsayBk\nZWxldGUgb3BlcmF0aW9uOyBpbgogICAgICAgICAgICAvLyB0aGlzIGNhc2Us\nIHdlIG5lZWQgdG8gcGVyZm9ybSB0aGUgcXVlcnkgaW4tbWVtb3J5IGFuZAog\nICAgICAgICAgICAvLyBtYW51YWxseSBkZWxldGUgdGhlIGluc3RhbmNlcwog\nICAgICAgICAgICBpZiAoIWlzVXBkYXRlKQogICAgICAgICAgICAgICAgc3Fs\nW2ldID0gZGljdC50b0RlbGV0ZShtYXBwaW5nc1tpXSwgc2VsLCBwYXJhbXMp\nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzcWxbaV0gPSBk\naWN0LnRvVXBkYXRlKG1hcHBpbmdzW2ldLCBzZWwsIF9zdG9yZSwgcGFyYW1z\nLAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZXMpOwoKICAgICAgICAgICAg\naWYgKHNxbFtpXSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgfQoKICAgICAgICAvLyB3ZSBuZWVkIHRvIG1ha2Ugc3Vy\nZSB3ZSBoYXZlIGFuIGFjdGl2ZSBzdG9yZSBjb25uZWN0aW9uCiAgICAgICAg\nX3N0b3JlLmdldENvbnRleHQoKS5iZWdpblN0b3JlKCk7CgogICAgICAgIENv\nbm5lY3Rpb24gY29ubiA9IF9zdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAg\nICAgbG9uZyBjb3VudCA9IDA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQ7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgc3FsLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBzdG1udCA9IG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBz\ncWxbaV0pOwogICAgICAgICAgICAgICAgICAgIGNvdW50ICs9IGV4ZWN1dGVV\ncGRhdGUoY29ubiwgc3RtbnQsIHNxbFtpXSwgaXNVcGRhdGUpOyAgICAgICAg\nICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBTUUxFeGNl\ncHRpb25zLmdldFN0b3JlKHNlLCBzcWxbaV0uZ2V0U1FMKCksIAogICAgICAg\nICAgICAgICAgICAgICAgICBfc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwog\nICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9zZSgpOyB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoY291bnQpOwogICAgfQoKICAgIC8q\nKgogICAgICogV2hldGhlciB0aGUgZ2l2ZW4gbWFwcGluZyBvY2N1cGllcyBv\nbmx5IG9uZSB0YWJsZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlz\nU2luZ2xlVGFibGVNYXBwaW5nKENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAg\nICAgIGJvb2xlYW4gc3ViY2xhc3NlcykgewogICAgICAgIENsYXNzTWFwcGlu\nZyByb290ID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAocm9vdC5nZXRKb2lu\nYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAg\nICByb290ID0gcm9vdC5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKTsKICAgICAgICBpZiAoaGFzVmVydGljYWxTdWJjbGFzc2VzKHJvb3QpKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHdlIGNhbm5v\ndCBleGVjdXRlIGEgYnVsayBkZWxldGUgaWYgYW55IG9mIHRoZQogICAgICAg\nIC8vIGZpZWxkIG1hcHBpbmdzIGZvciB0aGUgY2FuZGlkYXRlcyBoYXZlIGNv\nbHVtbnMKICAgICAgICAvLyBpbiBhbnkgb3RoZXIgdGFibGUsIHNpbmNlIGJ1\nbGsgZGVsZXRpbmcganVzdCBmcm9tIHRoZQogICAgICAgIC8vIGNsYXNzIHdp\nbGwgbGVhdmUgZGFuZ2xpbmcgcmVsYXRpb25zOyB3ZSBtaWdodCBiZSBhYmxl\nCiAgICAgICAgLy8gdG8gaXNzdWUgYnVsayBkZWxldGVzIHNlcGFyYXRlbHkg\nZm9yIHRoZSBqb2lucyAocG9zc2libHkKICAgICAgICAvLyB1c2luZyBhIHRl\nbXBvcmFyeSB0YWJsZSB0byBzZWxlY3QgdGhlIHByaW1hcnkga2V5cyBmb3IK\nICAgICAgICAvLyBhbGwgdGhlIHJlbGF0ZWQgdGFibGVzIGFuZCB0aGVuIGlz\nc2luZyBhIGRlbGV0ZSBhZ2FpbnN0IHRob3NlCiAgICAgICAgLy8ga2V5cyks\nIGJ1dCB0aGF0IGxvZ2ljIGlzIG5vdCBjdXJyZW50bHkgaW1wbGVtZW50ZWQK\nICAgICAgICBUYWJsZSB0YWJsZSA9IGdldFRhYmxlKG1hcHBpbmcuZ2V0Rmll\nbGRNYXBwaW5ncygpLCBudWxsKTsKICAgICAgICBpZiAodGFibGUgPT0gSU5W\nQUxJRCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAo\nc3ViY2xhc3NlcykgewogICAgICAgICAgICAvLyBpZiB3ZSBhcmUgaW5jbHVk\naW5nIHN1YmNsYXNzZXMsIHdlIGFsc28gbmVlZCB0byBnYXRoZXIKICAgICAg\nICAgICAgLy8gYWxsIHRoZSBtYXBwaW5ncyBmb3IgYWxsIGtub3duIHN1YmNs\nYXNzZXMKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3VicyA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IHN1YnMgIT0gbnVsbCAmJiBpIDwgc3Vicy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGFibGUgPSBnZXRUYWJs\nZShzdWJzW2ldLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCksIHRhYmxlKTsK\nICAgICAgICAgICAgICAgIGlmICh0YWJsZSA9PSBJTlZBTElEKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgc2luZ2xlIHRhYmxlIGZvciB0aGUgZ2l2ZW4gZmll\nbGRzLCBvciBJTlZBTElEIGlmIHRoZXkKICAgICAqIHVzZSBtdWx0aXBsZSB0\nYWJsZXMuCiAgICAgKi8KICAgIHByaXZhdGUgVGFibGUgZ2V0VGFibGUoRmll\nbGRNYXBwaW5nW10gZmllbGRzLCBUYWJsZSB0YWJsZSkgewogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIHRhYmxlID0gZ2V0VGFibGUoZmllbGRzW2ldLCB0YWJsZSk7CiAg\nICAgICAgICAgIGlmICh0YWJsZSA9PSBJTlZBTElEKQogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YWJsZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdGFibGUgZm9yIHRoZSBm\naWVsZCBpZiB0aGUgZ2l2ZW4gdGFibGUgaGFzbid0IGJlZW4gc2V0CiAgICAg\nKiB5ZXQsIG9yIGlmIHRoZSB0YWJsZXMgbWF0Y2guIElmIHRoZSBmaWVsZCB1\nc2VzIGEgZGlmZmVyZW50IHRhYmxlLAogICAgICogcmV0dXJucyBJTlZBTElE\nLiBBbHNvIHJldHVybnMgSU5WQUxJRCBpZiBmaWVsZCBpcyBkZXBlbmRlbnQu\nCiAgICAgKi8KICAgIHByaXZhdGUgVGFibGUgZ2V0VGFibGUoRmllbGRNYXBw\naW5nIGZtLCBUYWJsZSB0YWJsZSkgewogICAgICAgIGlmIChmbS5nZXRDYXNj\nYWRlRGVsZXRlKCkgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUpCiAg\nICAgICAgICAgIHJldHVybiBJTlZBTElEOwoKICAgICAgICBDb2x1bW5bXSBj\nb2x1bW5zID0gZm0uZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBjb2x1bW5zICE9IG51bGwgJiYgaSA8IGNvbHVtbnMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAg\nICAgICAgICB0YWJsZSA9IGNvbHVtbnNbaV0uZ2V0VGFibGUoKTsKICAgICAg\nICAgICAgZWxzZSBpZiAodGFibGUgIT0gY29sdW1uc1tpXS5nZXRUYWJsZSgp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIElOVkFMSUQ7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0YWJsZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgTnVt\nYmVyIGV4ZWN1dGVVcGRhdGUoQ2xhc3NNZXRhRGF0YSBiYXNlLCBDbGFzc01l\ndGFEYXRhW10gbWV0YXMsCiAgICAgICAgYm9vbGVhbiBzdWJjbGFzc2VzLCBF\neHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLAogICAgICAgIFF1ZXJ5RXhwcmVz\nc2lvbnNbXSBwYXJzZWQsIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmdbXSBnZXRE\nYXRhU3RvcmVBY3Rpb25zKENsYXNzTWV0YURhdGEgYmFzZSwKICAgICAgICBD\nbGFzc01ldGFEYXRhW10gbWV0YXMsIGJvb2xlYW4gc3ViY2xhc3NlcywgRXhw\ncmVzc2lvbkZhY3RvcnlbXSBmYWN0cywKICAgICAgICBRdWVyeUV4cHJlc3Np\nb25zW10gZXhwcywgT2JqZWN0W10gcGFyYW1zLCBSYW5nZSByYW5nZSkgewog\nICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0gKENsYXNzTWFwcGlu\nZ1tdKSBtZXRhczsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGN0eC4KICAgICAgICAg\nICAgZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKGV4cHNb\nMF0uZmV0Y2hQYXRocyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZldGNoLmFk\nZEZpZWxkcyhBcnJheXMuYXNMaXN0KGV4cHNbMF0uZmV0Y2hQYXRocykpOwog\nICAgICAgICAgICBmZXRjaC5hZGRKb2lucyhBcnJheXMuYXNMaXN0KGV4cHNb\nMF0uZmV0Y2hQYXRocykpOwogICAgICAgIH0KICAgICAgICBpZiAoZXhwc1sw\nXS5mZXRjaElubmVyUGF0aHMgIT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2gu\nYWRkRmV0Y2hJbm5lckpvaW5zKEFycmF5cy5hc0xpc3QoZXhwc1swXS5mZXRj\naElubmVyUGF0aHMpKTsKCiAgICAgICAgaW50IGVhZ2VyID0gY2FsY3VsYXRl\nRWFnZXJNb2RlKGV4cHNbMF0sIHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpOwog\nICAgICAgIGVhZ2VyID0gTWF0aC5taW4oZWFnZXIsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24uRUFHRVJfSk9JTik7CiAgICAgICAgaW50IHN1YmNsYXNzTW9k\nZSA9IGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKChDbGFzc01hcHBpbmcp\nIGJhc2UpOwogICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gX3N0b3JlLmdl\ndERCRGljdGlvbmFyeSgpOwogICAgICAgIGxvbmcgc3RhcnQgPSAobWFwcGlu\nZ3MubGVuZ3RoID09IDEgJiYgZGljdC5zdXBwb3J0c1NlbGVjdFN0YXJ0SW5k\nZXgpIAogICAgICAgICAgICA/IHJhbmdlLnN0YXJ0IDogMEw7CiAgICAgICAg\nbG9uZyBlbmQgPSAoZGljdC5zdXBwb3J0c1NlbGVjdEVuZEluZGV4KSA/IHJh\nbmdlLmVuZCA6IExvbmcuTUFYX1ZBTFVFOwoKICAgICAgICBRdWVyeUV4cHJl\nc3Npb25zU3RhdGVbXSBzdGF0ZXMgPSBuZXcgUXVlcnlFeHByZXNzaW9uc1N0\nYXRlW2V4cHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHN0YXRlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgc3RhdGVzW2ldID0g\nbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZSgpOwogICAgICAgIEV4cENvbnRl\neHQgY3R4ID0gbmV3IEV4cENvbnRleHQoX3N0b3JlLCBwYXJhbXMsIGZldGNo\nKTsKCiAgICAgICAgLy8gYWRkIHNlbGVjdHMgd2l0aCBwb3B1bGF0ZSBXSEVS\nRSBjb25kaXRpb25zIHRvIGxpc3QKICAgICAgICBMaXN0IHNlbHMgPSBuZXcg\nQXJyYXlMaXN0KG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgTGlzdCBzZWxN\nYXBwaW5ncyA9IG5ldyBBcnJheUxpc3QobWFwcGluZ3MubGVuZ3RoKTsKICAg\nICAgICBCaXRTZXQgc3ViY2xhc3NCaXRzID0gbmV3IEJpdFNldCgpOwogICAg\nICAgIEJpdFNldCBuZXh0Qml0cyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICBi\nb29sZWFuIHVuaW9uYWJsZSA9IGNyZWF0ZVdoZXJlU2VsZWN0cyhzZWxzLCBt\nYXBwaW5ncywgc2VsTWFwcGluZ3MsCiAgICAgICAgICAgIHN1YmNsYXNzZXMs\nIHN1YmNsYXNzQml0cywgbmV4dEJpdHMsIGZhY3RzLCBleHBzLCBzdGF0ZXMs\nIGN0eCwgCiAgICAgICAgICAgIHN1YmNsYXNzTW9kZSkgJiYgc3ViY2xhc3NN\nb2RlID09IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTjsKICAg\nICAgICBpZiAoc2Vscy5zaXplKCkgPiAxKQogICAgICAgICAgICBzdGFydCA9\nIDBMOwoKICAgICAgICBpZiAodW5pb25hYmxlKSB7CiAgICAgICAgICAgIFVu\naW9uIHVuaW9uID0gX3N0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdVbmlvbigK\nICAgICAgICAgICAgICAgIChTZWxlY3RbXSkgc2Vscy50b0FycmF5KG5ldyBT\nZWxlY3Rbc2Vscy5zaXplKCldKSk7CiAgICAgICAgICAgIHBvcHVsYXRlVW5p\nb24odW5pb24sIG1hcHBpbmdzLCBzdWJjbGFzc2VzLCBmYWN0cywgZXhwcywg\nc3RhdGVzLCBjdHgsCiAgICAgICAgICAgICAgICBmYWxzZSwgZWFnZXIsIHN0\nYXJ0LCBlbmQpOwogICAgICAgICAgICBpZiAodW5pb24uaXNVbmlvbigpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXSB7dW5pb24udG9T\nZWxlY3QoZmFsc2UsIGZldGNoKS5nZXRTUUwodHJ1ZSl9OwogICAgICAgICAg\nICBzZWxzID0gQXJyYXlzLmFzTGlzdCh1bmlvbi5nZXRTZWxlY3RzKCkpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFNlbGVjdCBzZWw7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwLCBpZHggPSAwOyBpIDwgc2Vscy5zaXpl\nKCk7IGkrKykgewogICAgICAgICAgICAgICAgc2VsID0gKFNlbGVjdCkgc2Vs\ncy5nZXQoaSk7CiAgICAgICAgICAgICAgICBwb3B1bGF0ZVNlbGVjdChzZWws\nIChDbGFzc01hcHBpbmcpIHNlbE1hcHBpbmdzLmdldChpKSwKICAgICAgICAg\nICAgICAgICAgICBzdWJjbGFzc0JpdHMuZ2V0KGkpLCAoSkRCQ0V4cHJlc3Np\nb25GYWN0b3J5KSBmYWN0c1tpZHhdLAogICAgICAgICAgICAgICAgICAgIGV4\ncHNbaWR4XSwgc3RhdGVzW2lkeF0sIGN0eCwgZmFsc2UsIGVhZ2VyLCBzdGFy\ndCwgZW5kKTsKICAgICAgICAgICAgICAgIGlmIChuZXh0Qml0cy5nZXQoaSkp\nCiAgICAgICAgICAgICAgICAgICAgaWR4Kys7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIFN0cmluZ1tdIHNxbCA9IG5ldyBTdHJpbmdbc2Vs\ncy5zaXplKCldOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2Vscy5z\naXplKCk7IGkrKykKICAgICAgICAgICAgc3FsW2ldID0gKChTZWxlY3QpIHNl\nbHMuZ2V0KGkpKS50b1NlbGVjdChmYWxzZSwgZmV0Y2gpLmdldFNRTCh0cnVl\nKTsKICAgICAgICByZXR1cm4gc3FsOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5v\nbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9m\nIGV4ZWN1dGluZyB1cGRhdGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBpbnQg\nZXhlY3V0ZVVwZGF0ZShDb25uZWN0aW9uIGNvbm4sIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCAKICAgICAgICBTUUxCdWZmZXIgc3FsQnVmLCBib29sZWFu\nIGlzVXBkYXRlKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gc3RtbnQuZXhlY3V0ZVVwZGF0ZSgpOwogICAgfQogICAgICAgICAgICAK\nICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVy\ncmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVt\nZW50YXRpb24gb2YgcHJlcGFyaW5nIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQo\nQ29ubmVjdGlvbiBjb25uLCBTUUxCdWZmZXIgc3FsKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBzcWwucHJlcGFyZVN0\nYXRlbWVudChjb25uKTsKICAgIH0gICAgCgogICAgcHVibGljIE9iamVjdCBl\ndmFsdWF0ZShPYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10gcGFy\nYW1zLCAKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAg\nICAgaW50IGlkID0gMDsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWwpCiAgICAg\nICAgICAgIGlkID0gKChvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5WYWwpdmFsdWUpLmdldElkKCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsgCgogICAg\nICAgIHN3aXRjaChpZCkgewogICAgICAgIGNhc2UgVmFsLk1BVEhfVkFMOgog\nICAgICAgICAgICByZXR1cm4gaGFuZGxlTWF0aFZhbCh2YWx1ZSwgb2IsIHBh\ncmFtcywgc20pOwogICAgICAgIGNhc2UgVmFsLkNPTkNBVF9WQUw6CiAgICAg\nICAgICAgIHJldHVybiBoYW5kbGVDb25jYXRWYWwodmFsdWUsIG9iLCBwYXJh\nbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5TVUJTVFJJTkdfVkFMOgogICAg\nICAgICAgICByZXR1cm4gaGFuZGxlU3Vic3RyaW5nVmFsKHZhbHVlLCBvYiwg\ncGFyYW1zLCBzbSk7CiAgICAgICAgY2FzZSBWYWwuQVJHU19WQUw6CiAgICAg\nICAgICAgIHJldHVybiBoYW5kbGVBcmdzVmFsKHZhbHVlLCBvYiwgcGFyYW1z\nLCBzbSk7CiAgICAgICAgY2FzZSBWYWwuTE9XRVJfVkFMOgogICAgICAgICAg\nICByZXR1cm4gaGFuZGxlTG93ZXJWYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNt\nKTsKICAgICAgICBjYXNlIFZhbC5VUFBFUl9WQUw6CiAgICAgICAgICAgIHJl\ndHVybiBoYW5kbGVVcHBlclZhbCh2YWx1ZSwgb2IsIHBhcmFtcywgc20pOwog\nICAgICAgIGNhc2UgVmFsLkxFTkdUSF9WQUw6CiAgICAgICAgICAgIHJldHVy\nbiBoYW5kbGVMZW5ndGhWYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAg\nICAgICBjYXNlIFZhbC5UUklNX1ZBTDoKICAgICAgICAgICAgcmV0dXJuIGhh\nbmRsZVRyaW1WYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBj\nYXNlIFZhbC5JTkRFWE9GX1ZBTDoKICAgICAgICAgICAgcmV0dXJuIGhhbmRs\nZUluZGV4T2ZWYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBj\nYXNlIFZhbC5BQlNfVkFMOgogICAgICAgICAgICByZXR1cm4gaGFuZGxlQWJz\nVmFsKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgY2FzZSBWYWwu\nU1FSVF9WQUw6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVTcXJ0VmFsKHZh\nbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgZGVmYXVsdDogICAgCiAg\nICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVNYXRo\nVmFsKE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMs\nIAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5NYXRoIG1hdGhW\nYWwgPQogICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2Vy\nbmVsLmV4cHMuTWF0aCkgdmFsdWU7CiAgICAgICAgVmFsIHZhbHVlMSA9IG1h\ndGhWYWwuZ2V0VmFsMSgpOwogICAgICAgIE9iamVjdCB2YWwxID0gZ2V0VmFs\ndWUodmFsdWUxLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgQ2xhc3MgYzEg\nPSB2YWx1ZTEuZ2V0VHlwZSgpOwoKICAgICAgICBWYWwgdmFsdWUyID0gbWF0\naFZhbC5nZXRWYWwyKCk7CiAgICAgICAgT2JqZWN0IHZhbDIgPSBnZXRWYWx1\nZSh2YWx1ZTIsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBDbGFzcyBjMiA9\nIHZhbHVlMi5nZXRUeXBlKCk7CgogICAgICAgIFN0cmluZyBvcCA9IG1hdGhW\nYWwuZ2V0T3BlcmF0aW9uKCk7CiAgICAgICAgaWYgKG9wLmVxdWFscyhvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5NYXRoLkFERCkpIAog\nICAgICAgICAgICByZXR1cm4gRmlsdGVycy5hZGQodmFsMSwgYzEsIHZhbDIs\nIGMyKTsKICAgICAgICBlbHNlIGlmIChvcC5lcXVhbHMoCiAgICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5NYXRo\nLlNVQlRSQUNUKSkKICAgICAgICAgICAgcmV0dXJuIEZpbHRlcnMuc3VidHJh\nY3QodmFsMSwgYzEsIHZhbDIsIGMyKTsKICAgICAgICBlbHNlIGlmIChvcC5l\ncXVhbHMoCiAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuZXhwcy5NYXRoLk1VTFRJUExZKSkgCiAgICAgICAgICAgIHJl\ndHVybiBGaWx0ZXJzLm11bHRpcGx5KHZhbDEsIGMxLCB2YWwyLCBjMik7CiAg\nICAgICAgZWxzZSBpZiAob3AuZXF1YWxzKAogICAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuTWF0aC5ESVZJREUp\nKSAKICAgICAgICAgICAgcmV0dXJuIEZpbHRlcnMuZGl2aWRlKHZhbDEsIGMx\nLCB2YWwyLCBjMik7CiAgICAgICAgZWxzZSBpZiAob3AuZXF1YWxzKG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLk1hdGguTU9EKSkgCiAg\nICAgICAgICAgIHJldHVybiBGaWx0ZXJzLm1vZCh2YWwxLCBjMSwgdmFsMiwg\nYzIpOwogICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigp\nOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZUNvbmNhdFZhbChP\nYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLAogICAg\nICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5Db25jYXQgY29uY2F0VmFs\nID0KICAgICAgICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5l\nbC5leHBzLkNvbmNhdCl2YWx1ZTsKICAgICAgICBWYWwgdmFsdWUxID0gY29u\nY2F0VmFsLmdldFZhbDEoKTsKICAgICAgICBPYmplY3QgdmFsMSA9IGdldFZh\nbHVlKHZhbHVlMSwgb2IsIHBhcmFtcywgc20pOwoKICAgICAgICBWYWwgdmFs\ndWUyID0gY29uY2F0VmFsLmdldFZhbDIoKTsKICAgICAgICBPYmplY3QgdmFs\nMiA9IGdldFZhbHVlKHZhbHVlMiwgb2IsIHBhcmFtcywgc20pOwogICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nQnVmZmVyKDEwMCkuYXBwZW5kKHZhbDEpLmFw\ncGVuZCh2YWwyKS50b1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgT2Jq\nZWN0IGhhbmRsZVN1YnN0cmluZ1ZhbChPYmplY3QgdmFsdWUsIE9iamVjdCBv\nYiwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20pIHsKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuZXhwcy5TdWJzdHJpbmcgc3Vic3RyVmFsID0KICAgICAgICAgICAgKG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlN1YnN0cmluZykg\ndmFsdWU7CiAgICAgICAgVmFsIHZhbHVlMSA9IHN1YnN0clZhbC5nZXRWYWwx\nKCk7CiAgICAgICAgU3RyaW5nIHZhbDEgPSAoU3RyaW5nKSBnZXRWYWx1ZSh2\nYWx1ZTEsIG9iLCBwYXJhbXMsIHNtKTsKCiAgICAgICAgVmFsIHZhbHVlMiA9\nIHN1YnN0clZhbC5nZXRWYWwyKCk7CiAgICAgICAgT2JqZWN0IHZhbDIgPSBn\nZXRWYWx1ZSh2YWx1ZTIsIG9iLCBwYXJhbXMsIHNtKTsKCiAgICAgICAgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlZhbHVlW10gdmFsQXJ5MiA9\nIAogICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBz\nLlZhbHVlW10pIHZhbDI7CiAgICAgICAgT2JqZWN0IGFyZzEgPSBnZXRWYWx1\nZSh2YWxBcnkyWzBdLCBvYiwgcGFyYW1zLCBzbSk7IC8vc3RhcnRpbmcgcG9z\nCiAgICAgICAgT2JqZWN0IGFyZzIgPSBnZXRWYWx1ZSh2YWxBcnkyWzFdLCBv\nYiwgcGFyYW1zLCBzbSk7IC8vIGxlbmd0aAogICAgICAgIGludCBzdGFydElk\neCA9ICgoTG9uZykgYXJnMSkuaW50VmFsdWUoKTsKICAgICAgICBpbnQgbGVu\nZ3RoID0gKChMb25nKSBhcmcyKS5pbnRWYWx1ZSgpOwogICAgICAgIGludCBl\nbmRJZHggPSBzdGFydElkeCArIGxlbmd0aDsKICAgICAgICByZXR1cm4gdmFs\nMS5zdWJzdHJpbmcoc3RhcnRJZHgsIGVuZElkeCk7CiAgICB9CgogICAgcHJp\ndmF0ZSBPYmplY3QgaGFuZGxlQXJnc1ZhbChPYmplY3QgdmFsdWUsIE9iamVj\ndCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtKSB7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLmV4cHMuQXJncyBhcmdzVmFsID0gCiAgICAgICAgICAgIChvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5BcmdzKSB2YWx1ZTsK\nICAgICAgICByZXR1cm4gYXJnc1ZhbC5nZXRWYWx1ZXMoKTsKICAgIH0KCiAg\nICBwcml2YXRlIE9iamVjdCBoYW5kbGVMb3dlclZhbChPYmplY3QgdmFsdWUs\nIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAgICBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLmV4cHMuVG9Mb3dlckNhc2UgbG93ZXJWYWwgPSAKICAg\nICAgICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLlRvTG93ZXJDYXNlKSB2YWx1ZTsKICAgICAgICBWYWwgdmFsID0gbG93ZXJW\nYWwuZ2V0VmFsdWUoKTsKICAgICAgICByZXR1cm4gKChTdHJpbmcpIGdldFZh\nbHVlKHZhbCwgb2IsIHBhcmFtcywgc20pKS50b0xvd2VyQ2FzZSgpOwogICAg\nfQoKICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZVVwcGVyVmFsKE9iamVjdCB2\nYWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMsIAogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pewogICAgICAgIG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5leHBzLlRvVXBwZXJDYXNlIHVwcGVyVmFsID0g\nCiAgICAgICAgICAgIChvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5Ub1VwcGVyQ2FzZSkgdmFsdWU7CiAgICAgICAgVmFsIHZhbCA9IHVw\ncGVyVmFsLmdldFZhbHVlKCk7CiAgICAgICAgcmV0dXJuICgoU3RyaW5nKSBn\nZXRWYWx1ZSh2YWwsIG9iLCBwYXJhbXMsIHNtKSkudG9VcHBlckNhc2UoKTsK\nICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVMZW5ndGhWYWwoT2Jq\nZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywgCiAgICAg\nICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSl7CiAgICAgICAgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU3RyaW5nTGVuZ3RoIHN0ckxl\nblZhbCA9IAogICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLmV4cHMuU3RyaW5nTGVuZ3RoKSB2YWx1ZTsKICAgICAgICBWYWwg\ndmFsID0gc3RyTGVuVmFsLmdldFZhbHVlKCk7CiAgICAgICAgcmV0dXJuICgo\nU3RyaW5nKSBnZXRWYWx1ZSh2YWwsIG9iLCBwYXJhbXMsIHNtKSkubGVuZ3Ro\nKCk7CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3QgaGFuZGxlVHJpbVZhbChP\nYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuVHJpbSB0cmltVmFsID0g\nCiAgICAgICAgICAgIChvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5UcmltKSB2YWx1ZTsKICAgICAgICBWYWwgdmFsID0gdHJpbVZhbC5n\nZXRWYWwoKTsKICAgICAgICBTdHJpbmcgdmFsU3RyID0gKFN0cmluZykgZ2V0\nVmFsdWUodmFsLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgVmFsIHRyaW1D\naGFyID0gdHJpbVZhbC5nZXRUcmltQ2hhcigpOwogICAgICAgIGNoYXIgdHJp\nbUNoYXJPYmogPSAoKFN0cmluZykgZ2V0VmFsdWUodHJpbUNoYXIsIG9iLCBw\nYXJhbXMsIHNtKSkuCiAgICAgICAgICAgIGNoYXJBdCgwKTsKICAgICAgICBC\nb29sZWFuIHdoZXJlID0gdHJpbVZhbC5nZXRXaGVyZSgpOwogICAgICAgIGlm\nICh3aGVyZSA9PSBudWxsKSB7IC8vdHJpbSBib3RoCiAgICAgICAgICAgIHJl\ndHVybiB0cmltTGVhZGluZyh0cmltVHJhaWxpbmcodmFsU3RyLCB0cmltQ2hh\nck9iaiksIHRyaW1DaGFyT2JqKTsKICAgICAgICB9IGVsc2UgaWYgKHdoZXJl\nLmJvb2xlYW5WYWx1ZSgpKSB7IC8vIHRyaW0gbGVhZGluZwogICAgICAgICAg\nICByZXR1cm4gdHJpbUxlYWRpbmcodmFsU3RyLCB0cmltQ2hhck9iaik7CiAg\nICAgICAgfSBlbHNlIHsgLy8gdHJpbSB0cmFpbGluZwogICAgICAgICAgICBy\nZXR1cm4gdHJpbVRyYWlsaW5nKHZhbFN0ciwgdHJpbUNoYXJPYmopOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyB0cmltTGVhZGluZyhT\ndHJpbmcgdmFsdWUsIGNoYXIgdHJpbUNoYXIpIHsKICAgICAgICBpbnQgc3Rh\ncnRJZHggPSAwOwogICAgICAgIGludCBsZW4gPSB2YWx1ZS5sZW5ndGgoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICh2YWx1ZS5jaGFyQXQoaSkgIT0gdHJpbUNoYXIpIHsKICAg\nICAgICAgICAgICAgIHN0YXJ0SWR4ID0gaTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2\nYWx1ZS5zdWJzdHJpbmcoc3RhcnRJZHgpOwogICAgfQoKICAgIHByaXZhdGUg\nU3RyaW5nIHRyaW1UcmFpbGluZyhTdHJpbmcgdmFsdWUsIGNoYXIgdHJpbUNo\nYXIpIHsKICAgICAgICBpbnQgZW5kSWR4ID0gMDsKICAgICAgICBpbnQgbGVu\nID0gdmFsdWUubGVuZ3RoKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IGxlbi0x\nOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBpZiAodmFsdWUuY2hhckF0\nKGkpICE9IHRyaW1DaGFyKSB7CiAgICAgICAgICAgICAgICBlbmRJZHggPSBp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHZhbHVlLnN1YnN0cmluZygwLCBlbmRJZHgr\nMSk7CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3QgaGFuZGxlSW5kZXhPZlZh\nbChPYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLAog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5JbmRleE9mIGxvY2F0\nZVZhbCA9IAogICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLmV4cHMuSW5kZXhPZikgdmFsdWU7CiAgICAgICAgU3RyaW5nIHZh\nbDEgPSAoU3RyaW5nKSBnZXRWYWx1ZShsb2NhdGVWYWwuZ2V0VmFsMSgpLCBv\nYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgVmFsW10gdmFsMiA9IChWYWxbXSkg\nZ2V0VmFsdWUobG9jYXRlVmFsLmdldFZhbDIoKSwgb2IsIHBhcmFtcywgc20p\nOwogICAgICAgIFN0cmluZyBzdHJWYWwgPSAoU3RyaW5nKSBnZXRWYWx1ZSh2\nYWwyWzBdLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgaW50IGlkeCA9ICgo\nTG9uZykgZ2V0VmFsdWUodmFsMlsxXSwgb2IsIHBhcmFtcywgc20pKS5pbnRW\nYWx1ZSgpOwogICAgICAgIHJldHVybiBzdHJWYWwuaW5kZXhPZih2YWwxLCBp\nZHgpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZUFic1ZhbChP\nYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuQWJzIGFic1ZhbCA9IAog\nICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4\ncHMuQWJzKSB2YWx1ZTsKICAgICAgICBPYmplY3QgdmFsID0gZ2V0VmFsdWUo\nYWJzVmFsLmdldFZhbHVlKCksIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBD\nbGFzcyBjID0gdmFsLmdldENsYXNzKCk7CiAgICAgICAgaWYgKGMgPT0gSW50\nZWdlci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnRlZ2VyKGph\ndmEubGFuZy5NYXRoLmFicygoKEludGVnZXIpIHZhbCkuaW50VmFsdWUoKSkp\nOwogICAgICAgIGVsc2UgaWYgKGMgPT0gRmxvYXQuY2xhc3MpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgRmxvYXQoamF2YS5sYW5nLk1hdGguYWJzKCgoRmxv\nYXQpIHZhbCkuZmxvYXRWYWx1ZSgpKSk7CiAgICAgICAgZWxzZSBpZiAoYyA9\nPSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBuZXcgRG91Ymxl\nKGphdmEubGFuZy5NYXRoLmFicygoKERvdWJsZSkgdmFsKS5kb3VibGVWYWx1\nZSgpKSk7CiAgICAgICAgZWxzZSBpZiAoYyA9PSBMb25nLmNsYXNzKQogICAg\nICAgICAgICByZXR1cm4gbmV3IExvbmcoamF2YS5sYW5nLk1hdGguYWJzKCgo\nTG9uZykgdmFsKS5sb25nVmFsdWUoKSkpOwogICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfQoKICAgIHByaXZhdGUgT2Jq\nZWN0IGhhbmRsZVNxcnRWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9i\namVjdFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkgewogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5l\neHBzLlNxcnQgc3FydFZhbCA9IAogICAgICAgICAgICAob3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuU3FydCkgdmFsdWU7CiAgICAgICAg\nT2JqZWN0IHZhbCA9IGdldFZhbHVlKHNxcnRWYWwuZ2V0VmFsdWUoKSwgb2Is\nIHBhcmFtcywgc20pOwogICAgICAgIENsYXNzIGMgPSB2YWwuZ2V0Q2xhc3Mo\nKTsKICAgICAgICBpZiAoYyA9PSBJbnRlZ2VyLmNsYXNzKQogICAgICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZShqYXZhLmxhbmcuTWF0aC5zcXJ0KCgoSW50\nZWdlcikgdmFsKS4KICAgICAgICAgICAgICAgIGRvdWJsZVZhbHVlKCkpKTsK\nICAgICAgICBlbHNlIGlmIChjID09IEZsb2F0LmNsYXNzKQogICAgICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZShqYXZhLmxhbmcuTWF0aC5zcXJ0KCgoRmxv\nYXQpIHZhbCkuZmxvYXRWYWx1ZSgpKSk7CiAgICAgICAgZWxzZSBpZiAoYyA9\nPSBEb3VibGUuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBuZXcgRG91Ymxl\nKGphdmEubGFuZy5NYXRoLnNxcnQoKChEb3VibGUpIHZhbCkuCiAgICAgICAg\nICAgICAgICBkb3VibGVWYWx1ZSgpKSk7CiAgICAgICAgZWxzZSBpZiAoYyA9\nPSBMb25nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShq\nYXZhLmxhbmcuTWF0aC5zcXJ0KCgoTG9uZykgdmFsKS5kb3VibGVWYWx1ZSgp\nKSk7CiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKCk7\nCiAgICB9ICAgIAoKICAgIHByaXZhdGUgT2JqZWN0IGdldFZhbHVlKE9iamVj\ndCB2YWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIGlmICh2YWx1ZSBp\nbnN0YW5jZW9mIFBDUGF0aCkgewogICAgICAgICAgICBGaWVsZE1hcHBpbmcg\nZm0gPSAoRmllbGRNYXBwaW5nKSgoUENQYXRoKSB2YWx1ZSkubGFzdCgpOwog\nICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWUob2IsIGZtLCBzbSk7CiAgICAg\nICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExpdGVyYWwpIHsKICAg\nICAgICAgICAgcmV0dXJuICgoTGl0ZXJhbCkgdmFsdWUpLmdldFZhbHVlKCk7\nCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIENvbnN0YW50\nKSB7CiAgICAgICAgICAgIHJldHVybiAoKENvbnN0YW50KSB2YWx1ZSkuZ2V0\nVmFsdWUocGFyYW1zKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBy\nZXR1cm4gZXZhbHVhdGUodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3QgZ2V0VmFsdWUoT2JqZWN0\nIG9iLCBGaWVsZE1hcHBpbmcgZm1kLAogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20pIHsKICAgICAgICBpbnQgaSA9IGZtZC5nZXRJbmRleCgpOwog\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgIHJl\ndHVybiBzbS5mZXRjaEJvb2xlYW5GaWVsZChpKTsKICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFOgogICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hCeXRl\nRmllbGQoaSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgcmV0dXJuIHNtLmZldGNoQ2hhckZpZWxkKGkpOwogICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgcmV0dXJuIHNtLmZl\ndGNoRG91YmxlRmllbGQoaSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVQ6CiAgICAgICAgICAgIHJldHVybiBzbS5mZXRjaEZsb2F0RmllbGQoaSk7\nCiAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICByZXR1\ncm4gc20uZmV0Y2hJbnRGaWVsZChpKTsKICAgICAgICBjYXNlIEphdmFUeXBl\ncy5MT05HOgogICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hMb25nRmllbGQo\naSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nIHJldHVybiBzbS5mZXRjaFNob3J0RmllbGQoaSk7CiAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hT\ndHJpbmdGaWVsZChpKTsKICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgog\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk5VTUJFUjoKICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOX09CSjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nWVRFX09CSjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlRfT0JKOgogICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJ\nR0lOVEVHRVI6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9DQUxFOgogICAg\nICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICBjYXNlIEphdmFU\neXBlcy5PSUQ6CiAgICAgICAgICAgIHJldHVybiBzbS5mZXRjaE9iamVjdEZp\nZWxkKGkpOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5l\ndyBVbnN1cHBvcnRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

