{"sha":"e59a58252fd988c3a0b4ac36becf8678e5d2668d","node_id":"MDQ6QmxvYjIwNjM2NDplNTlhNTgyNTJmZDk4OGMzYTBiNGFjMzZiZWNmODY3OGU1ZDI2Njhk","size":29490,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e59a58252fd988c3a0b4ac36becf8678e5d2668d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3RJdGVyYXRvcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5P\nYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWdu\nS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNj\naGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9p\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEJ1ZmZl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5YTUxNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247Cgov\nKioKICogQSBwYXRoIHJlcHJlc2VudHMgYSB0cmF2ZXJzYWwgaW50byBmaWVs\nZHMgb2YgYSBjYW5kaWRhdGUgb2JqZWN0LgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKi8KcHVibGljIGNsYXNzIFBDUGF0aAogICAgZXh0ZW5kcyBBYnN0\ncmFjdFZhbAogICAgaW1wbGVtZW50cyBKREJDUGF0aCB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IFBBVEggPSAwOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEJPVU5EX1ZBUiA9IDE7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgVU5CT1VORF9WQVIgPSAyOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFVOQUNDRVNTRURfVkFSID0gMzsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBYUEFUSCA9IDQ7CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2Fn\nZShQQ1BhdGguY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNYXBw\naW5nIF9jYW5kaWRhdGU7CiAgICBwcml2YXRlIENsYXNzTWFwcGluZyBfY2xh\nc3MgPSBudWxsOwogICAgcHJpdmF0ZSBMaW5rZWRMaXN0IF9hY3Rpb25zID0g\nbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfa2V5ID0gZmFsc2U7CiAgICBw\ncml2YXRlIGludCBfdHlwZSA9IFBBVEg7CiAgICBwcml2YXRlIFN0cmluZyBf\ndmFyTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzIF9jYXN0ID0gbnVs\nbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2lkID0gZmFsc2U7CiAgICBwcml2\nYXRlIEZpZWxkTWV0YURhdGEgX3htbGZpZWxkID0gbnVsbDsKCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgd2l0aCB0aGUgJ3RoaXMn\nIHB0ci4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFzc01hcHBpbmcg\ndHlwZSkgewogICAgICAgIF9jYW5kaWRhdGUgPSB0eXBlOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRoZSBn\naXZlbiB2YXJpYWJsZS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChDbGFz\nc01hcHBpbmcgY2FuZGlkYXRlLCBWYXJpYWJsZSB2YXIpIHsKICAgICAgICBf\nY2FuZGlkYXRlID0gY2FuZGlkYXRlOwogICAgICAgIF9hY3Rpb25zID0gbmV3\nIExpbmtlZExpc3QoKTsKCiAgICAgICAgUENQYXRoIG90aGVyID0gdmFyLmdl\ndFBDUGF0aCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9u\nKCk7CiAgICAgICAgaWYgKG90aGVyID09IG51bGwpIHsKICAgICAgICAgICAg\nX3R5cGUgPSBVTkJPVU5EX1ZBUjsKICAgICAgICAgICAgYWN0aW9uLm9wID0g\nQWN0aW9uLlVOQk9VTkRfVkFSOwogICAgICAgICAgICBhY3Rpb24uZGF0YSA9\nIHZhcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBib3VuZCB2\nYXJpYWJsZTsgY29weSBwYXRoCiAgICAgICAgICAgIF90eXBlID0gVU5BQ0NF\nU1NFRF9WQVI7CiAgICAgICAgICAgIF9hY3Rpb25zLmFkZEFsbChvdGhlci5f\nYWN0aW9ucyk7CiAgICAgICAgICAgIF9rZXkgPSBvdGhlci5fa2V5OwoKICAg\nICAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLlZBUjsKICAgICAgICAgICAg\nYWN0aW9uLmRhdGEgPSB2YXIuZ2V0TmFtZSgpOwogICAgICAgIH0KICAgICAg\nICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IHZhci5n\nZXRUeXBlKCk7IC8vIGluaXRpYWwgdHlwZSBpcyB2YXIgdHlwZQogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIGEgcGF0aCBzdGFydGluZyBmcm9tIHRo\nZSBnaXZlbiBzdWJxdWVyeS4KICAgICAqLwogICAgcHVibGljIFBDUGF0aChT\ndWJRIHN1YikgewogICAgICAgIF9jYW5kaWRhdGUgPSBzdWIuZ2V0Q2FuZGlk\nYXRlKCk7CiAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2VkTGlzdCgpOwoK\nICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwogICAgICAg\nIGFjdGlvbi5vcCA9IEFjdGlvbi5TVUJRVUVSWTsKICAgICAgICBhY3Rpb24u\nZGF0YSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgICAgIF9hY3Rp\nb25zLmFkZChhY3Rpb24pOwogICAgICAgIF9jYXN0ID0gc3ViLmdldFR5cGUo\nKTsgLy8gaW5pdGlhbCB0eXBlIGlzIHN1YnF1ZXJ5IHR5cGUKICAgICAgICBf\ndmFyTmFtZSA9IHN1Yi5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHRoZSBwYXRoIGFzIGEgYmluZGluZyBvZiB0aGUg\nZ2l2ZW4gdmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZFZh\ncmlhYmxlQWN0aW9uKFZhcmlhYmxlIHZhcikgewogICAgICAgIF92YXJOYW1l\nID0gdmFyLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0cnVlIGlmIHRoaXMgaXMgYSBib3VuZCB2YXJpYWJsZSB0aGF0IGhhcyBu\nb3QgYmVlbiBhY2Nlc3NlZAogICAgICogYWZ0ZXIgYmluZGluZy4gVXNlZnVs\nIGZvciBmaWx0ZXJzIGxpa2UKICAgICAqICJjb2xsLmNvbnRhaW5zICh2YXIp\nICZhbXA7JmFtcDsgdmFyID09IG51bGwiLCB3aGljaCBzaG91bGQgcmVhbGx5\nCiAgICAgKiBqdXN0IGFjdCBsaWtlICJjb2xsLmNvbnRhaW5zIChudWxsKSIu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVW5hY2Nlc3NlZFZhcmlh\nYmxlKCkgewogICAgICAgIHJldHVybiBfdHlwZSA9PSBVTkFDQ0VTU0VEX1ZB\nUjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoaXMg\naXMgYSBwYXRoIGludm9sdmluZyBhIHZhcmlhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1ZhcmlhYmxlUGF0aCgpIHsKICAgICAgICByZXR1\ncm4gX3R5cGUgIT0gUEFUSDsKICAgIH0KCiAgICAvKioKICAgICAqIElmIHRo\naXMgcGF0aCBpcyBwYXJ0IG9mIGEgY29udGFpbnMgY2xhdXNlLCB0aGVuIGFs\naWFzIGl0IHRvIHRoZQogICAgICogcHJvcGVyIGNvbnRhaW5zIGlkIGJlZm9y\nZSBpbml0aWFsaXphdGlvbi4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9u\naXplZCB2b2lkIHNldENvbnRhaW5zSWQoU3RyaW5nIGlkKSB7CiAgICAgICAg\naWYgKF9jaWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gdHJl\nYXQgaXQganVzdCBsaWtlIGEgdW5pcXVlIHZhcmlhYmxlCiAgICAgICAgQWN0\naW9uIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24ub3Ag\nPSBBY3Rpb24uVkFSOwogICAgICAgIGFjdGlvbi5kYXRhID0gaWQ7CiAgICAg\nICAgaWYgKF9hY3Rpb25zID09IG51bGwpCiAgICAgICAgICAgIF9hY3Rpb25z\nID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBfYWN0aW9ucy5hZGQoYWN0\naW9uKTsKICAgICAgICBfY2lkID0gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMg\nQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsKICAgICAgICByZXR1cm4g\nX2NsYXNzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1ldGFEYXRhKENs\nYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIF9jbGFzcyA9IChDbGFzc01h\ncHBpbmcpIG1ldGE7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNLZXko\nKSB7CiAgICAgICAgcmV0dXJuIF9rZXk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBib29sZWFuIGlzWFBhdGgoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlID09\nIFhQQVRIOwogICAgfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGdldFhQYXRo\nKCkgewogICAgICAgIFN0cmluZ0J1ZmZlciB4cGF0aCA9IG5ldyBTdHJpbmdC\ndWZmZXIoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uOwogICAgICAgIEl0ZXJh\ndG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7CiAgICAgICAgCiAgICAg\nICAgLy8gU2tpcCB2YXJpYWJsZSBhY3Rpb25zIHNpbmNlIHRoZXkgYXJlIG5v\ndCBwYXJ0IG9mIHRoZSB4cGF0aAogICAgICAgIC8vIHVudGlsIHdlIHJlYWNo\nIHRoZSBmaXJzdCB4cGF0aCBhY3Rpb24uCiAgICAgICAgLy8gVGhlIGZpcnN0\nIHhwYXRoIGFjdGlvbiBtYXBzIHRvIHRoZSByb290IG9mIGFuIHhtbCBkb2N1\nbWVudC4KICAgICAgICBkbyAKICAgICAgICAgICAgYWN0aW9uID0gKEFjdGlv\nbikgaXRyLm5leHQoKTsgCiAgICAgICAgd2hpbGUgKGFjdGlvbi5vcCAhPSBB\nY3Rpb24uR0VUX1hQQVRIKTsKICAgICAgICAKICAgICAgICAvLyBTa2lwIFht\nbFJvb3RFbGVtZW50OgogICAgICAgIC8vIFdlIGNhbid0IHJlbHkgb24gdGhl\nIGFjY3VyYWN5IG9mIHRoZSBuYW1lIG9mIHRoZSByb290IGVsZW1lbnQsCiAg\nICAgICAgLy8gYmVjYXVzZSBpdCBjb3VsZCBiZSBzZXQgdG8gc29tZSBkZWZh\ndWx0IGJ5IEpBWEIgWE1MIEJpbmRpbmcuCiAgICAgICAgLy8gVGhlIGNhbGxl\ncihEQkRpY3Rpb25hcnkpIHNob3VsZCBzdGFydCB3aXRoICIvKiIgb3IgIi8q\nLyIsCiAgICAgICAgLy8gd2UgYnVpbGQgdGhlIHJlbWFpbmluZyB4cGF0aCB0\naGF0IGZvbGxvd3MgdGhlIHJvb3QgZWxlbWVudC4KICAgICAgICB3aGlsZSAo\naXRyLmhhc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9u\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoKChYTUxNZXRhRGF0YSkg\nYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSAhPSBudWxsKSAgICAgICAgICAg\nICAgICAgCiAgICAgICAgICAgICAgICB4cGF0aC5hcHBlbmQoKChYTUxNZXRh\nRGF0YSkgYWN0aW9uLmRhdGEpLmdldFhtbG5hbWUoKSk7CiAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgIHhwYXRoLmFwcGVuZCgiKiIpOwogICAg\nICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIHhw\nYXRoLmFwcGVuZCgiLyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4geHBh\ndGgudG9TdHJpbmcoKTsKICAgIH0KICAgIAogICAgcHVibGljIFN0cmluZyBn\nZXRQYXRoKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gKF92YXJOYW1lID09IG51bGwpID8gIiIgOiBfdmFy\nTmFtZSArICIuIjsKCiAgICAgICAgU3RyaW5nQnVmZmVyIHBhdGggPSBuZXcg\nU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rpb24p\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0\naW9uLlZBUiB8fCBhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAg\nICAgICAgICAgICAgcGF0aC5hcHBlbmQoYWN0aW9uLmRhdGEpOwogICAgICAg\nICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRfVkFS\nKQogICAgICAgICAgICAgICAgcGF0aC5hcHBlbmQoKChWYXJpYWJsZSkgYWN0\naW9uLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGVsc2UgCiAgICAg\nICAgICAgICAgICBwYXRoLmFwcGVuZCgoKEZpZWxkTWFwcGluZykgYWN0aW9u\nLmRhdGEpLmdldE5hbWUoKSk7CiAgICAgICAgICAgIHBhdGguYXBwZW5kKCcu\nJyk7CiAgICAgICAgfQogICAgICAgIGlmIChfdmFyTmFtZSAhPSBudWxsKQog\nICAgICAgICAgICBwYXRoLmFwcGVuZChfdmFyTmFtZSkuYXBwZW5kKCcuJyk7\nCiAgICAgICAgcmV0dXJuIHBhdGgudG9TdHJpbmcoKTsKICAgIH0KCiAgICBw\ndWJsaWMgQ2xhc3NNYXBwaW5nIGdldENsYXNzTWFwcGluZyhFeHBTdGF0ZSBz\ndGF0ZSkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4\ncFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CiAgICAgICAgaWYgKF9r\nZXkpIHsKICAgICAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRLZXkoKS5n\nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFR5cGVN\nYXBwaW5nKCk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0K\nICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBz\ndGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5n\nKCk7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVs\nZC5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0RmllbGRNYXBwaW5nKEV4\ncFN0YXRlIHN0YXRlKSB7CiAgICAgICAgcmV0dXJuICgoUGF0aEV4cFN0YXRl\nKSBzdGF0ZSkuZmllbGQ7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdl\ndENvbHVtbnMoRXhwU3RhdGUgc3RhdGUpIHsKICAgICAgICBQYXRoRXhwU3Rh\ndGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYg\nKHBzdGF0ZS5jb2xzID09IG51bGwpCiAgICAgICAgICAgIHBzdGF0ZS5jb2xz\nID0gY2FsY3VsYXRlQ29sdW1ucyhwc3RhdGUpOwogICAgICAgIHJldHVybiBw\nc3RhdGUuY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBjb2x1bW5z\nIHVzZWQgYnkgdGhpcyBwYXRoLgogICAgICovCiAgICBwcml2YXRlIENvbHVt\nbltdIGNhbGN1bGF0ZUNvbHVtbnMoUGF0aEV4cFN0YXRlIHBzdGF0ZSkgewog\nICAgICAgIGlmIChfa2V5KSB7CiAgICAgICAgICAgIGlmICghcHN0YXRlLmpv\naW5lZFJlbCAKICAgICAgICAgICAgICAgICYmIHBzdGF0ZS5maWVsZC5nZXRL\nZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGpvaW5SZWxhdGlvbihwc3RhdGUsIF9rZXksIGZhbHNlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKHBzdGF0ZS5qb2luZWRSZWwgCiAgICAg\nICAgICAgICAgICAmJiBwc3RhdGUuZmllbGQuZ2V0S2V5KCkuZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICByZXR1cm4g\ncHN0YXRlLmZpZWxkLmdldEtleU1hcHBpbmcoKS5nZXRUeXBlTWFwcGluZygp\nLgogICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGlu\nZygpLmdldENvbHVtbnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHBzdGF0\nZS5maWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN3aXRjaCAocHN0YXRl\nLmZpZWxkLmdldFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgICAgICBWYWx1ZU1hcHBpbmcgZWxlbSA9\nIHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChwc3RhdGUuam9pbmVkUmVsICYmIGVsZW0uZ2V0VHlw\nZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBlbGVtLmdldFR5cGVNYXBwaW5nKCkuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbS5nZXRD\nb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGVsZW0uZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygpOwogICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBzdGF0ZS5qb2luZWRSZWwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlwZU1hcHBpbmcoKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGdldFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRD\nb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29sdW1ucygpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoX2NsYXNz\nID09IG51bGwpID8gU2NoZW1hcy5FTVBUWV9DT0xVTU5TCiAgICAgICAgICAg\nIDogX2NsYXNzLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZSgpIHsKICAgICAgICBpZiAoX2Fj\ndGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIEFjdGlvbiBhY3Rpb24gPSAoQWN0aW9uKSBfYWN0aW9ucy5nZXRMYXN0\nKCk7CiAgICAgICAgcmV0dXJuIGFjdGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VO\nRF9WQVIgfHwgYWN0aW9uLm9wID09IEFjdGlvbi5WQVI7IAogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGdldChGaWVsZE1ldGFEYXRhIGZpZWxkLCBib29sZWFu\nIG51bGxUcmF2ZXJzYWwpIHsKICAgICAgICBpZiAoX2FjdGlvbnMgPT0gbnVs\nbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlua2VkTGlzdCgpOwog\nICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAgICAgICAg\nYWN0aW9uLm9wID0gKG51bGxUcmF2ZXJzYWwpID8gQWN0aW9uLkdFVF9PVVRF\nUiA6IEFjdGlvbi5HRVQ7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBmaWVsZDsK\nICAgICAgICBfYWN0aW9ucy5hZGQoYWN0aW9uKTsKICAgICAgICBpZiAoX3R5\ncGUgPT0gVU5BQ0NFU1NFRF9WQVIpCiAgICAgICAgICAgIF90eXBlID0gQk9V\nTkRfVkFSOwogICAgICAgIF9jYXN0ID0gbnVsbDsKICAgICAgICBfa2V5ID0g\nZmFsc2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGdldChGaWVsZE1l\ndGFEYXRhIGZtZCwgWE1MTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChf\nYWN0aW9ucyA9PSBudWxsKQogICAgICAgICAgICBfYWN0aW9ucyA9IG5ldyBM\naW5rZWRMaXN0KCk7CiAgICAgICAgQWN0aW9uIGFjdGlvbiA9IG5ldyBBY3Rp\nb24oKTsKICAgICAgICBhY3Rpb24ub3AgPSBBY3Rpb24uR0VUX1hQQVRIOwog\nICAgICAgIGFjdGlvbi5kYXRhID0gbWV0YTsKICAgICAgICBfYWN0aW9ucy5h\nZGQoYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tl\neSA9IGZhbHNlOwogICAgICAgIF90eXBlID0gWFBBVEg7CiAgICAgICAgX3ht\nbGZpZWxkID0gZm1kOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBnZXQo\nWE1MTWV0YURhdGEgbWV0YSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICBBY3Rp\nb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwogICAgICAgIGFjdGlvbi5vcCA9\nIEFjdGlvbi5HRVRfWFBBVEg7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBtZXRh\nLmdldEZpZWxkTWFwcGluZyhuYW1lKTsKICAgICAgICBfYWN0aW9ucy5hZGQo\nYWN0aW9uKTsKICAgICAgICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tleSA9\nIGZhbHNlOwogICAgICAgIF90eXBlID0gWFBBVEg7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBYTUxNZXRhRGF0YSBnZXRYbWxNYXBwaW5nKCkgewogICAgICAg\nIEFjdGlvbiBhY3QgPSAoQWN0aW9uKSBfYWN0aW9ucy5nZXRMYXN0KCk7CiAg\nICAgICAgaWYgKGFjdCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gKFhN\nTE1ldGFEYXRhKSBhY3QuZGF0YTsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgZ2V0S2V5KCkgewog\nICAgICAgIGlmIChfY2lkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIGNoYW5nZSB0aGUgbGFzdCBhY3Rpb24gdG8gYSBnZXQga2V5CiAgICAg\nICAgQWN0aW9uIGFjdGlvbiA9IChBY3Rpb24pIF9hY3Rpb25zLmdldExhc3Qo\nKTsKICAgICAgICBhY3Rpb24ub3AgPSBBY3Rpb24uR0VUX0tFWTsKICAgICAg\nICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tleSA9IHRydWU7CiAgICB9Cgog\nICAgcHVibGljIEZpZWxkTWV0YURhdGEgbGFzdCgpIHsKICAgICAgICBBY3Rp\nb24gYWN0ID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAgcmV0dXJuIChh\nY3QgPT0gbnVsbCkgPyBudWxsIDogaXNYUGF0aCgpID8gX3htbGZpZWxkIDoK\nICAgICAgICAgICAgKEZpZWxkTWV0YURhdGEpIGFjdC5kYXRhOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsYXN0IGFjdGlvbiB0aGF0IGdl\ndHMgYSBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBBY3Rpb24gbGFzdEZp\nZWxkQWN0aW9uKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKGlzWFBhdGgo\nKSkKICAgICAgICAgICAgcmV0dXJuIChBY3Rpb24pIF9hY3Rpb25zLmdldExh\nc3QoKTsKICAgICAgICAKICAgICAgICBMaXN0SXRlcmF0b3IgaXRyID0gX2Fj\ndGlvbnMubGlzdEl0ZXJhdG9yKF9hY3Rpb25zLnNpemUoKSk7CiAgICAgICAg\nQWN0aW9uIHByZXY7CiAgICAgICAgd2hpbGUgKGl0ci5oYXNQcmV2aW91cygp\nKSB7CiAgICAgICAgICAgIHByZXYgPSAoQWN0aW9uKSBpdHIucHJldmlvdXMo\nKTsKICAgICAgICAgICAgaWYgKHByZXYub3AgPT0gQWN0aW9uLkdFVCB8fCBw\ncmV2Lm9wID09IEFjdGlvbi5HRVRfT1VURVIKICAgICAgICAgICAgICAgIHx8\nIHByZXYub3AgPT0gQWN0aW9uLkdFVF9LRVkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gcHJldjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIENsYXNzIGdldFR5cGUoKSB7CiAgICAgICAgaWYg\nKF9jYXN0ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FzdDsKICAg\nICAgICBBY3Rpb24gYWN0ID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAg\naWYgKGFjdCAhPSBudWxsICYmIGFjdC5vcCA9PSBBY3Rpb24uR0VUX1hQQVRI\nKQogICAgICAgICAgICByZXR1cm4gKChYTUxNZXRhRGF0YSkgYWN0LmRhdGEp\nLmdldFR5cGUoKTsKICAgICAgICAKICAgICAgICBGaWVsZE1ldGFEYXRhIGZs\nZCA9IChhY3QgPT0gbnVsbCkgPyBudWxsIDogKEZpZWxkTWV0YURhdGEpIGFj\ndC5kYXRhOwogICAgICAgIGJvb2xlYW4ga2V5ID0gYWN0ICE9IG51bGwgJiYg\nYWN0Lm9wID09IEFjdGlvbi5HRVRfS0VZOwogICAgICAgIGlmIChmbGQgIT0g\nbnVsbCkgewogICAgICAgICAgICBzd2l0Y2ggKGZsZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFS\nUkFZOgogICAgICAgICAgICAgICAgICAgIGlmIChmbGQuZ2V0RGVjbGFyZWRU\neXBlKCkgPT0gYnl0ZVtdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAg\nIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBCeXRlW10uY2xhc3MKICAg\nICAgICAgICAgICAgICAgICAgICAgfHwgZmxkLmdldERlY2xhcmVkVHlwZSgp\nID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBm\nbGQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQ2hhcmFjdGVyW10uY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRLZXkoKS5n\nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmxkLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGZsZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRU\neXBlKCk7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmbGQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9jbGFzcyAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gX2NsYXNzLmdldERlc2NyaWJlZFR5cGUoKTsK\nICAgICAgICByZXR1cm4gT2JqZWN0LmNsYXNzOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldEltcGxpY2l0VHlwZShDbGFzcyB0eXBlKSB7CiAgICAgICAg\nX2Nhc3QgPSB0eXBlOwogICAgfQoKICAgIHB1YmxpYyBFeHBTdGF0ZSBpbml0\naWFsaXplKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBpbnQgZmxhZ3Mp\nIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gbmV3IFBhdGhFeHBT\ndGF0ZShzZWwubmV3Sm9pbnMoKSk7CiAgICAgICAgYm9vbGVhbiBrZXkgPSBm\nYWxzZTsKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIgPSBmYWxzZTsKICAg\nICAgICBDbGFzc01hcHBpbmcgcmVsID0gX2NhbmRpZGF0ZTsKCiAgICAgICAg\nLy8gaXRlcmF0ZSB0byB0aGUgZmluYWwgZmllbGQKICAgICAgICBDbGFzc01h\ncHBpbmcgb3duZXI7CiAgICAgICAgQ2xhc3NNYXBwaW5nIGZyb20sIHRvOwog\nICAgICAgIEFjdGlvbiBhY3Rpb247CiAgICAgICAgVmFyaWFibGUgdmFyOwog\nICAgICAgIEl0ZXJhdG9yIGl0ciA9IChfYWN0aW9ucyA9PSBudWxsKSA/IG51\nbGwgOiBfYWN0aW9ucy5pdGVyYXRvcigpOwogICAgICAgIEZpZWxkTWFwcGlu\nZyBmaWVsZDsKICAgICAgICB3aGlsZSAoaXRyICE9IG51bGwgJiYgaXRyLmhh\nc05leHQoKSkgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9uKSBpdHIu\nbmV4dCgpOwoKICAgICAgICAgICAgLy8gdHJlYXQgc3VicXVlcmllcyBsaWtl\nIHZhcmlhYmxlcyBmb3IgYWxpYXMgZ2VuZXJhdGlvbiBwdXJwb3NlcwogICAg\nICAgICAgICBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5WQVIpCiAgICAgICAg\nICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0VmFyaWFi\nbGUoKFN0cmluZykgYWN0aW9uLmRhdGEpOwogICAgICAgICAgICBlbHNlIGlm\nIChhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAgICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFN1YnNlbGVjdCgo\nU3RyaW5nKSBhY3Rpb24uZGF0YSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGFj\ndGlvbi5vcCA9PSBBY3Rpb24uVU5CT1VORF9WQVIpIHsKICAgICAgICAgICAg\nICAgIC8vIHVuYm91bmQgdmFycyBhcmUgY3Jvc3Mtam9pbmVkIHRvIHRoZSBj\nYW5kaWRhdGUgdGFibGUKICAgICAgICAgICAgICAgIHZhciA9IChWYXJpYWJs\nZSkgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAgICByZWwgPSAoQ2xhc3NN\nYXBwaW5nKSB2YXIuZ2V0TWV0YURhdGEoKTsKICAgICAgICAgICAgICAgIHBz\ndGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5zZXRWYXJpYWJsZSh2YXIuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0\nZS5qb2lucy5jcm9zc0pvaW4oX2NhbmRpZGF0ZS5nZXRUYWJsZSgpLCAKICAg\nICAgICAgICAgICAgICAgICByZWwuZ2V0VGFibGUoKSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBtb3ZlIHBhc3QgdGhlIHBy\nZXZpb3VzIGZpZWxkLCBpZiBhbnkKICAgICAgICAgICAgICAgIGZpZWxkID0g\nKGFjdGlvbi5vcCA9PSBBY3Rpb24uR0VUX1hQQVRIKSA/IChGaWVsZE1hcHBp\nbmcpIF94bWxmaWVsZCA6CiAgICAgICAgICAgICAgICAgICAgKEZpZWxkTWFw\ncGluZykgYWN0aW9uLmRhdGE7CiAgICAgICAgICAgICAgICBpZiAocHN0YXRl\nLmZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0\naGlzIGlzIHRoZSBzZWNvbmQtdG8tbGFzdCBmaWVsZCBhbmQgdGhlIGxhc3Qg\naXMKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcmVsYXRlZCBmaWVsZCB0\naGlzIGZpZWxkIGpvaW5zIHRvLCBubyBuZWVkIHRvCiAgICAgICAgICAgICAg\nICAgICAgLy8gdHJhdmVyc2U6IGp1c3QgdXNlIHRoaXMgZmllbGQncyBmayBj\nb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdHIuaGFzTmV4dCgp\nICYmIChmbGFncyAmIEpPSU5fUkVMKSA9PSAwCiAgICAgICAgICAgICAgICAg\nICAgICAgICYmIGlzSm9pbmVkRmllbGQocHN0YXRlLmZpZWxkLCBrZXksIGZp\nZWxkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwc3RhdGUuY21wZmll\nbGQgPSBmaWVsZDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlbCA9\nIHRyYXZlcnNlRmllbGQocHN0YXRlLCBrZXksIGZvcmNlT3V0ZXIsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBtYXJr\nIGlmIHRoZSBuZXh0IHRyYXZlcnNhbCBzaG91bGQgZ28gdGhyb3VnaAogICAg\nICAgICAgICAgICAgLy8gdGhlIGtleSByYXRoZXIgdGhhbiB2YWx1ZQogICAg\nICAgICAgICAgICAga2V5ID0gYWN0aW9uLm9wID09IEFjdGlvbi5HRVRfS0VZ\nOwogICAgICAgICAgICAgICAgZm9yY2VPdXRlciB8PSBhY3Rpb24ub3AgPT0g\nQWN0aW9uLkdFVF9PVVRFUjsKCiAgICAgICAgICAgICAgICAvLyBnZXQgbWFw\ncGluZyBmb3IgdGhlIGN1cnJlbnQgZmllbGQKICAgICAgICAgICAgICAgIHBz\ndGF0ZS5maWVsZCA9IGZpZWxkOwogICAgICAgICAgICAgICAgb3duZXIgPSBw\nc3RhdGUuZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7CiAgICAgICAgICAg\nICAgICBpZiAocHN0YXRlLmZpZWxkLmdldE1hbmFnZW1lbnQoKSAKICAgICAg\nICAgICAgICAgICAgICAhPSBGaWVsZE1hcHBpbmcuTUFOQUdFX1BFUlNJU1RF\nTlQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vbi1wZXJzLWZpZWxkIiwgCiAgICAgICAgICAgICAg\nICAgICAgICAgIHBzdGF0ZS5maWVsZCkpOwoKICAgICAgICAgICAgICAgIC8v\nIGZpbmQgdGhlIG1vc3QtZGVyaXZlZCB0eXBlIGJldHdlZW4gdGhlIGRlY2xh\ncmVkIHJlbGF0aW9uCiAgICAgICAgICAgICAgICAvLyB0eXBlIGFuZCB0aGUg\nZmllbGQncyBvd25lciwgYW5kIGpvaW4gZnJvbSB0aGF0IHR5cGUgdG8KICAg\nICAgICAgICAgICAgIC8vIHRoZSBsZXNzZXIgZGVyaXZlZCB0eXBlCiAgICAg\nICAgICAgICAgICBpZiAocmVsICE9IG93bmVyICYmIHJlbCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbC5nZXREZXNjcmliZWRUeXBl\nKCkuaXNBc3NpZ25hYmxlRnJvbQogICAgICAgICAgICAgICAgICAgICAgICAo\nb3duZXIuZ2V0RGVzY3JpYmVkVHlwZSgpKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBmcm9tID0gb3duZXI7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHRvID0gcmVsOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZyb20gPSByZWw7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHRvID0gb3duZXI7CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICBmb3IgKDsgZnJvbSAhPSBudWxsICYmIGZy\nb20gIT0gdG87CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBmcm9t\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKSB7CiAgICAgICAg\nICAgICAgICAgICAgCUZpZWxkTWFwcGluZyBjYXN0ID0gZnJvbS5nZXRGaWVs\nZE1hcHBpbmcocHN0YXRlLmZpZWxkCiAgICAgICAgICAgICAgICAgICAgCQkJ\nLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgCWlmIChjYXN0ICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgCQlwc3RhdGUuZmllbGQgPSBj\nYXN0OwogICAgICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBm\ncm9tLmpvaW5TdXBlcmNsYXNzKHBzdGF0ZS5qb2lucywgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIC8vIG5vdGhpbmcgbW9yZSB0byBkbyBmcm9tIGhlcmUgb24gYXMg\nd2UgZW5jb3VudGVyZWQgYW4geHBhdGggYWN0aW9uCiAgICAgICAgICAgICAg\nICBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5HRVRfWFBBVEgpCiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaWYgKF92YXJOYW1lICE9IG51bGwpCiAgICAgICAgICAgIHBzdGF0\nZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5zZXRWYXJpYWJsZShfdmFyTmFtZSk7\nCgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBjb21wYXJpbmcgdG8gbnVsbCBv\nciBkb2luZyBhbiBpc0VtcHR5LCB0aGVuCiAgICAgICAgLy8gam9pbiBpbnRv\nIHRoZSBkYXRhIG9uIHRoZSBmaW5hbCBmaWVsZDsgb2J2aW91c2x5IHdlIGNh\nbid0IGRvIHRoZXNlCiAgICAgICAgLy8gam9pbnMgd2hlbiBjb21wYXJpbmcg\ndG8gbnVsbCBiL2MgdGhlIHdob2xlIHB1cnBvc2UgaXMgdG8gc2VlCiAgICAg\nICAgLy8gd2hldGhlciB0aGUgam9pbnMgZXZlbiBleGlzdAogICAgICAgIGlm\nICgoZmxhZ3MgJiBOVUxMX0NNUCkgPT0gMCkKICAgICAgICAgICAgdHJhdmVy\nc2VGaWVsZChwc3RhdGUsIGtleSwgZm9yY2VPdXRlciwgdHJ1ZSk7CiAgICAg\nICAgcHN0YXRlLmpvaW5lZFJlbCA9IGZhbHNlOwogICAgICAgIGlmICgoZmxh\nZ3MgJiBKT0lOX1JFTCkgIT0gMCkKICAgICAgICAgICAgam9pblJlbGF0aW9u\nKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVyIHx8IChmbGFncyAmIEZPUkNFX09V\nVEVSKSAhPSAwLAogICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgIHJl\ndHVybiBwc3RhdGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGUgZ2l2ZW4gc291cmNlIGZpZWxkIGpvaW5zIHRvIHRoZSBnaXZl\nbiB0YXJnZXQgZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gaXNKb2luZWRGaWVsZChGaWVsZE1hcHBpbmcgc3JjLCBib29sZWFu\nIGtleSwgCiAgICAgICAgRmllbGRNYXBwaW5nIHRhcmdldCkgewogICAgICAg\nIFZhbHVlTWFwcGluZyB2bTsKICAgICAgICBzd2l0Y2ggKHNyYy5nZXRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nICAgICAgICAgdm0gPSBzcmMuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5N\nQVA6CiAgICAgICAgICAgICAgICB2bSA9IChrZXkpID8gc3JjLmdldEtleU1h\ncHBpbmcoKSA6IHNyYy5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICB2bSA9IHNyYzsKICAgICAgICB9CiAgICAgICAgaWYgKHZtLmdldEpv\naW5EaXJlY3Rpb24oKSAhPSBWYWx1ZU1hcHBpbmcuSk9JTl9GT1JXQVJEKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgRm9yZWlnbktleSBm\nayA9IHZtLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBpZiAoZmsgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAKICAgICAgICAKICAgICAg\nICAvLyBmb3JlaWduIGtleSBtdXN0IGpvaW4gdG8gdGFyZ2V0IGNvbHVtbnMK\nICAgICAgICBDb2x1bW5bXSByZWxzID0gZmsuZ2V0Q29sdW1ucygpOwogICAg\nICAgIENvbHVtbltdIHBrcyA9IHRhcmdldC5nZXRDb2x1bW5zKCk7IAogICAg\nICAgIGlmIChyZWxzLmxlbmd0aCAhPSBwa3MubGVuZ3RoKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBy\nZWxzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoZmsuZ2V0UHJpbWFy\neUtleUNvbHVtbihyZWxzW2ldKSAhPSBwa3NbaV0pCiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBFeHByZXNzaW9uIHN0YXRlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGNsYXNzIFBhdGhFeHBTdGF0ZQogICAgICAgIGV4dGVu\nZHMgRXhwU3RhdGUgewoKICAgICAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGZp\nZWxkID0gbnVsbDsKICAgICAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGNtcGZp\nZWxkID0gbnVsbDsKICAgICAgICBwdWJsaWMgQ29sdW1uW10gY29scyA9IG51\nbGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4gam9pbmVkUmVsID0gZmFsc2U7\nCgogICAgICAgIHB1YmxpYyBQYXRoRXhwU3RhdGUoSm9pbnMgam9pbnMpIHsK\nICAgICAgICAgICAgc3VwZXIoam9pbnMpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRyYXZlcnNlIGludG8gdGhlIHByZXZpb3VzIGZpZWxk\nIG9mIGEgcmVsYXRpb24gcGF0aC4KICAgICAqCiAgICAgKiBAcGFyYW0gbGFz\ndCB3aGV0aGVyIHRoaXMgaXMgdGhlIGxhc3QgZmllbGQgaW4gdGhlIHBhdGgK\nICAgICAqIEByZXR1cm4gdGhlIG1hcHBpbmcgb2YgdGhlIHJlbGF0ZWQgdHlw\nZSwgb3IgbnVsbAogICAgICovCiAgICBwcml2YXRlIENsYXNzTWFwcGluZyB0\ncmF2ZXJzZUZpZWxkKFBhdGhFeHBTdGF0ZSBwc3RhdGUsIGJvb2xlYW4ga2V5\nLCAKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIsIGJvb2xlYW4gbGFzdCkg\newogICAgICAgIGlmIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIHRyYXZlcnNlIGludG8gZmll\nbGQgdmFsdWUKICAgICAgICBpZiAoa2V5KQogICAgICAgICAgICBwc3RhdGUu\nam9pbnMgPSBwc3RhdGUuZmllbGQuam9pbktleShwc3RhdGUuam9pbnMsIGZv\ncmNlT3V0ZXIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmpv\naW5zID0gcHN0YXRlLmZpZWxkLmpvaW4ocHN0YXRlLmpvaW5zLCBmb3JjZU91\ndGVyKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpc24ndCB0aGUgbGFzdCBmaWVs\nZCwgdHJhdmVyc2UgaW50byB0aGUgcmVsYXRpb24KICAgICAgICBpZiAoIWxh\nc3QpCiAgICAgICAgICAgIGpvaW5SZWxhdGlvbihwc3RhdGUsIGtleSwgZm9y\nY2VPdXRlciwgdHJ1ZSk7CgogICAgICAgIC8vIHJldHVybiB0aGUgbWFwaW5n\nIG9mIHRoZSByZWxhdGVkIHR5cGUsIGlmIGFueQogICAgICAgIGlmIChrZXkp\nCiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0S2V5TWFwcGlu\nZygpLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVs\nZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMp\nCiAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0RWxlbWVudE1h\ncHBpbmcoKS5nZXRUeXBlTWFwcGluZygpOwogICAgICAgIHJldHVybiBwc3Rh\ndGUuZmllbGQuZ2V0VHlwZU1hcHBpbmcoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEpvaW4gaW50byB0aGUgcmVsYXRpb24gcmVwcmVzZW50ZWQgYnkgdGhl\nIGN1cnJlbnQgZmllbGQsIGlmIGFueS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGpvaW5SZWxhdGlvbihQYXRoRXhwU3RhdGUgcHN0YXRlLCBib29sZWFu\nIGtleSwgCiAgICAgICAgYm9vbGVhbiBmb3JjZU91dGVyLCBib29sZWFuIHRy\nYXZlcnNlKSB7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKGtleSkKICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmZpZWxkLmpvaW5LZXlSZWxhdGlv\nbihwc3RhdGUuam9pbnMsIAogICAgICAgICAgICAgICAgZm9yY2VPdXRlciwg\ndHJhdmVyc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmpv\naW5zID0gcHN0YXRlLmZpZWxkLmpvaW5SZWxhdGlvbihwc3RhdGUuam9pbnMs\nIGZvcmNlT3V0ZXIsCiAgICAgICAgICAgICAgICB0cmF2ZXJzZSk7CiAgICAg\nICAgcHN0YXRlLmpvaW5lZFJlbCA9IHRydWU7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCB0b0RhdGFTdG9yZVZhbHVlKFNlbGVjdCBzZWwsIEV4cENvbnRl\neHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgT2JqZWN0IHZhbCkg\newogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRl\nKSBzdGF0ZTsKICAgICAgICBGaWVsZE1hcHBpbmcgZmllbGQgPSAocHN0YXRl\nLmNtcGZpZWxkICE9IG51bGwpID8gcHN0YXRlLmNtcGZpZWxkIAogICAgICAg\nICAgICA6IHBzdGF0ZS5maWVsZDsKICAgICAgICBpZiAoaXNYUGF0aCgpKQog\nICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgIGlmIChmaWVsZCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChfa2V5KQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZpZWxkLnRvS2V5RGF0YVN0b3JlVmFsdWUodmFsLCBjdHguc3Rv\ncmUpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0RWxlbWVudCgpLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMuT0JKRUNUKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZpZWxkLnRvRGF0YVN0b3JlVmFsdWUodmFsLCBj\ndHguc3RvcmUpOwoKICAgICAgICAgICAgdmFsID0gZmllbGQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIGN0eC5zdG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAg\nICAgICByZXR1cm4gZmllbGQudG9EYXRhU3RvcmVWYWx1ZSh2YWwsIGN0eC5z\ndG9yZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY2xhc3MudG9EYXRh\nU3RvcmVWYWx1ZSh2YWwsIF9jbGFzcy5nZXRQcmltYXJ5S2V5Q29sdW1ucygp\nLAogICAgICAgICAgICBjdHguc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhwU3Rh\ndGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gcGtzKSB7CiAgICAgICAgc2Vs\nZWN0Q29sdW1ucyhzZWwsIGN0eCwgc3RhdGUsIHBrcyk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2VsZWN0Q29sdW1ucyhTZWxlY3Qgc2VsLCBFeHBDb250\nZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gcGtz\nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSBnZXRDbGFzc01h\ncHBpbmcoc3RhdGUpOwogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAo\nUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAobWFwcGluZyA9PSBu\ndWxsIHx8ICFwc3RhdGUuam9pbmVkUmVsKQogICAgICAgICAgICBzZWwuc2Vs\nZWN0KGdldENvbHVtbnMoc3RhdGUpLCBwc3RhdGUuam9pbnMpOwogICAgICAg\nIGVsc2UgaWYgKHBrcykKICAgICAgICAgICAgc2VsLnNlbGVjdChtYXBwaW5n\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCksIHBzdGF0ZS5qb2lucyk7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHNlbGVjdCB0aGUgbWFwcGluZzsg\nYWxsb3cgYW55IHN1YnMgYmVjYXVzZSB3ZSBrbm93IHRoaXMgbXVzdAogICAg\nICAgICAgICAvLyBiZSBlaXRoZXIgYSByZWxhdGlvbiwgaW4gd2hpY2ggY2Fz\nZSBpdCB3aWxsIGFscmVhZHkgYmUKICAgICAgICAgICAgLy8gY29uc3RyYWlu\nZWQgYnkgdGhlIGpvaW5zLCBvciAndGhpcycsIGluIHdoaWNoIGNhc2UgdGhl\nCiAgICAgICAgICAgIC8vIEpEQkNFeHByZXNzaW9uRmFjdG9yeSB0YWtlcyBj\nYXJlIG9mIGFkZGluZyBjbGFzcyBjb25kaXRpb25zIGZvcgogICAgICAgICAg\nICAvLyB0aGUgY2FuZGlkYXRlIGNsYXNzIG9uIHRoZSBzZWxlY3QKICAgICAg\nICAgICAgaW50IHN1YnMgPSAoX3R5cGUgPT0gVU5CT1VORF9WQVIpID8gU2Vs\nZWN0LlNVQlNfSk9JTkFCTEUKICAgICAgICAgICAgICAgIDogU2VsZWN0LlNV\nQlNfQU5ZX0pPSU5BQkxFOwogICAgICAgICAgICBzZWwuc2VsZWN0KG1hcHBp\nbmcsIHN1YnMsIGN0eC5zdG9yZSwgY3R4LmZldGNoLAogICAgICAgICAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FLCBzZWwub3V0\nZXIocHN0YXRlLmpvaW5zKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4\ncFN0YXRlIHN0YXRlKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcg\nPSBnZXRDbGFzc01hcHBpbmcoc3RhdGUpOwogICAgICAgIFBhdGhFeHBTdGF0\nZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAo\nbWFwcGluZyA9PSBudWxsIHx8ICFwc3RhdGUuam9pbmVkUmVsKQogICAgICAg\nICAgICBzZWwuZ3JvdXBCeShnZXRDb2x1bW5zKHN0YXRlKSwgc2VsLm91dGVy\nKHBzdGF0ZS5qb2lucykpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBp\nbnQgc3VicyA9IChfdHlwZSA9PSBVTkJPVU5EX1ZBUikgPyBTZWxlY3QuU1VC\nU19KT0lOQUJMRQogICAgICAgICAgICAgICAgOiBTZWxlY3QuU1VCU19BTllf\nSk9JTkFCTEU7CiAgICAgICAgICAgIHNlbC5ncm91cEJ5KG1hcHBpbmcsIHN1\nYnMsIGN0eC5zdG9yZSwgY3R4LmZldGNoLCAKICAgICAgICAgICAgICAgIHNl\nbC5vdXRlcihwc3RhdGUuam9pbnMpKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgb3JkZXJCeShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0\neCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIGJvb2xlYW4gYXNjKSB7CiAg\nICAgICAgc2VsLm9yZGVyQnkoZ2V0Q29sdW1ucyhzdGF0ZSksIGFzYywgc2Vs\nLm91dGVyKHN0YXRlLmpvaW5zKSwgZmFsc2UpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgbG9hZChFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUs\nIFJlc3VsdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIGxvYWQoY3R4LCBzdGF0ZSwgcmVzLCBmYWxzZSk7CiAg\nICB9CgogICAgT2JqZWN0IGxvYWQoRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRl\nIHN0YXRlLCBSZXN1bHQgcmVzLCBib29sZWFuIHBrcykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGlu\nZyA9IGdldENsYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0aEV4cFN0\nYXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlm\nIChtYXBwaW5nICE9IG51bGwgJiYgKHBzdGF0ZS5maWVsZCA9PSBudWxsIAog\nICAgICAgICAgICB8fCAhcHN0YXRlLmZpZWxkLmlzRW1iZWRkZWQoKSkpIHsK\nICAgICAgICAgICAgaWYgKHBrcykKICAgICAgICAgICAgICAgIHJldHVybiBt\nYXBwaW5nLmdldE9iamVjdElkKGN0eC5zdG9yZSwgcmVzLCBudWxsLCB0cnVl\nLCAKICAgICAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwogICAgICAg\nICAgICByZXR1cm4gcmVzLmxvYWQobWFwcGluZywgY3R4LnN0b3JlLCBjdHgu\nZmV0Y2gsIHBzdGF0ZS5qb2lucyk7CiAgICAgICAgfQoKICAgICAgICBPYmpl\nY3QgcmV0OwogICAgICAgIGlmIChfa2V5KQogICAgICAgICAgICByZXQgPSBw\nc3RhdGUuZmllbGQubG9hZEtleVByb2plY3Rpb24oY3R4LnN0b3JlLCBjdHgu\nZmV0Y2gsIHJlcywgCiAgICAgICAgICAgICAgICBwc3RhdGUuam9pbnMpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0ID0gcHN0YXRlLmZpZWxkLmxv\nYWRQcm9qZWN0aW9uKGN0eC5zdG9yZSwgY3R4LmZldGNoLCByZXMsIAogICAg\nICAgICAgICAgICAgcHN0YXRlLmpvaW5zKTsKICAgICAgICBpZiAoX2Nhc3Qg\nIT0gbnVsbCkKICAgICAgICAgICAgcmV0ID0gRmlsdGVycy5jb252ZXJ0KHJl\ndCwgX2Nhc3QpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY2FsY3VsYXRlVmFsdWUoU2VsZWN0IHNlbCwgRXhwQ29udGV4\ndCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBWYWwgb3RoZXIsIEV4\ncFN0YXRlIG90aGVyU3RhdGUpIHsKICAgICAgICAvLyB3ZSBkb24ndCBjcmVh\ndGUgdGhlIFNRTCBiL2MgaXQgZm9yY2VzIHRoZSBTZWxlY3QgdG8gY2FjaGUg\nYWxpYXNlcwogICAgICAgIC8vIGZvciB0aGUgdGFibGVzIHdlIHVzZSwgYW5k\nIHRoZXNlIGFsaWFzZXMgbWlnaHQgbm90IGV2ZXIgYmUgdXNlZCBpZgogICAg\nICAgIC8vIHdlIGV2ZW50dWFsbHkgY2FsbCBhcHBlbmRJc0VtcHR5IG9yIGFw\ncGVuZElzTnVsbCByYXRoZXIgdGhhbiBhcHBlbmRUbwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgbGVuZ3RoKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBF\neHBTdGF0ZSBzdGF0ZSkgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5zKHN0\nYXRlKS5sZW5ndGg7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kVG8o\nU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAK\nICAgICAgICBTUUxCdWZmZXIgc3FsLCBpbnQgaW5kZXgpIHsKICAgICAgICBD\nb2x1bW4gY29sID0gZ2V0Q29sdW1ucyhzdGF0ZSlbaW5kZXhdOwoKICAgICAg\nICAvLyBpZiBzZWxlY3QgaXMgbnVsbCwgaXQgbWVhbnMgd2UgYXJlIG5vdCBh\nbGlhc2luZyBjb2x1bW5zCiAgICAgICAgLy8gKGUuZy4sIGR1cmluZyBhIGJ1\nbGsgdXBkYXRlKQogICAgICAgIGlmIChzZWwgPT0gbnVsbCkKICAgICAgICAg\nICAgc3FsLmFwcGVuZChjb2wuZ2V0TmFtZSgpKTsKICAgICAgICBlbHNlIGlm\nIChfdHlwZSA9PSBYUEFUSCkKICAgICAgICAgICAgLy8gaWYgdGhpcyBpcyBh\nbiB4cGF0aCwgYXBwZW5kIHhwYXRoIHN0cmluZwogICAgICAgICAgICBzcWwu\nYXBwZW5kKGdldFhQYXRoKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sLCBzdGF0ZS5qb2lu\ncykpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzRW1wdHkoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAg\nICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBz\ndGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChwc3Rh\ndGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVuZChGQUxT\nRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmllbGQuYXBw\nZW5kSXNFbXB0eShzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBhcHBlbmRJc05vdEVtcHR5KFNlbGVjdCBzZWwsIEV4\ncENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgU1FMQnVm\nZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0\naEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09\nIG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoRkFMU0UpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZElzTm90RW1w\ndHkoc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgYXBwZW5kU2l6ZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAg\nICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3Rh\ndGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAg\nICAgICBzcWwuYXBwZW5kKCIxIik7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBwc3RhdGUuZmllbGQuYXBwZW5kU2l6ZShzcWwsIHNlbCwgcHN0YXRlLmpv\naW5zKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJc051bGwoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAg\nICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBz\ndGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChwc3Rh\ndGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVuZChGQUxT\nRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmllbGQuYXBw\nZW5kSXNOdWxsKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90TnVsbChTZWxlY3Qgc2VsLCBFeHBD\nb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZl\nciBzcWwpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhF\neHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBu\ndWxsKQogICAgICAgICAgICBzcWwuYXBwZW5kKFRSVUUpOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgcHN0YXRlLmZpZWxkLmFwcGVuZElzTm90TnVsbChz\ncWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIGhhc2hDb2RlKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gX2NhbmRpZGF0ZS5oYXNoQ29kZSgpOwogICAg\nICAgIHJldHVybiBfY2FuZGlkYXRlLmhhc2hDb2RlKCkgXiBfYWN0aW9ucy5o\nYXNoQ29kZSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhP\nYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCEob3RoZXIgaW5z\ndGFuY2VvZiBQQ1BhdGgpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgUENQYXRoIHBhdGggPSAoUENQYXRoKSBvdGhlcjsKICAgICAgICBy\nZXR1cm4gT2JqZWN0VXRpbHMuZXF1YWxzKF9jYW5kaWRhdGUsIHBhdGguX2Nh\nbmRpZGF0ZSkKICAgICAgICAgICAgJiYgT2JqZWN0VXRpbHMuZXF1YWxzKF9h\nY3Rpb25zLCBwYXRoLl9hY3Rpb25zKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEhlbHBlciBjbGFzcyByZXByZXNlbnRpbmcgYW4gYWN0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBBY3Rpb24KICAgICAgICBpbXBs\nZW1lbnRzIFNlcmlhbGl6YWJsZSB7CgogICAgICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IEdFVCA9IDA7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgR0VUX09VVEVSID0gMTsKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBHRVRfS0VZID0gMjsKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBWQVIgPSAzOwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IFNVQlFVRVJZID0gNDsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBVTkJPVU5EX1ZBUiA9IDU7CiAgICAgICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgQ0FTVCA9IDY7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgR0VUX1hQQVRIID0gNzsKCiAgICAgICAgcHVibGljIGludCBvcCA9\nIC0xOwogICAgICAgIHB1YmxpYyBPYmplY3QgZGF0YSA9IG51bGw7CgogICAg\nICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBvcCArICJ8IiArIGRhdGE7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpZiAoZGF0YSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG9wOwogICAgICAgICAgICBy\nZXR1cm4gb3AgXiBkYXRhLmhhc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAg\nICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgICAgIEFjdGlvbiBhID0gKEFjdGlvbikgb3Ro\nZXI7CiAgICAgICAgICAgIHJldHVybiBvcCA9PSBhLm9wCiAgICAgICAgICAg\nICAgICAmJiBPYmplY3RVdGlscy5lcXVhbHMoZGF0YSwgYS5kYXRhKTsKICAg\nICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

