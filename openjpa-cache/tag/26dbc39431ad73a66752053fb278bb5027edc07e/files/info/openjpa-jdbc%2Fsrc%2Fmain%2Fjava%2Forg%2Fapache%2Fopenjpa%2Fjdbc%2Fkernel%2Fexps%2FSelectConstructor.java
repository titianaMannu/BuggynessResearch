{"sha":"200f404214366318fd9981c75a9356322b62f0a6","node_id":"MDQ6QmxvYjIwNjM2NDoyMDBmNDA0MjE0MzY2MzE4ZmQ5OTgxYzc1YTkzNTYzMjJiNjJmMGE2","size":14384,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/200f404214366318fd9981c75a9356322b62f0a6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5BYnN0cmFjdEV4cHJl\nc3Npb25WaXNpdG9yOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLkNvbnN0YW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5leHBzLkV4cHJlc3Npb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9uczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZTsKCi8qKgogKiBUdXJu\ncyBwYXJzZWQgcXVlcmllcyBpbnRvIHNlbGVjdHMuCiAqCiAqIEBhdXRob3Ig\nQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBTZWxl\nY3RDb25zdHJ1Y3RvcgogICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoK\nICAgIHByaXZhdGUgYm9vbGVhbiBfZXh0ZW50ID0gZmFsc2U7CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBrbm93IHRoZSBzZWxlY3QgdG8g\naGF2ZSBvbiBjcml0ZXJpYTsgdG8gYmUgYW4gZXh0ZW50LgogICAgICogTm90\nZSB0aGF0IGV2ZW4gaWYgdGhpcyBtZXRob2QgcmV0dXJucyBmYWxzZSwge0Bs\naW5rICNldmFsdWF0ZX0gbWF5IHN0aWxsCiAgICAgKiByZXR1cm4gbnVsbCBp\nZiB3ZSBoYXZlbid0IGNhY2hlZCB3aGV0aGVyIHRoZSBxdWVyeSBpcyBhbiBl\neHRlbnQgeWV0LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0V4dGVu\ndCgpIHsKICAgICAgICByZXR1cm4gX2V4dGVudDsKICAgIH0KCiAgICAvKioK\nICAgICAqIEV2YWx1YXRlIHRoZSBleHByZXNzaW9uLCByZXR1cm5pbmcgYSBu\nZXcgc2VsZWN0IGFuZCBmaWxsaW5nIGluIGFueQogICAgICogYXNzb2NpYXRl\nZCBleHByZXNzaW9uIHN0YXRlLiBVc2Uge0BsaW5rICNzZWxlY3R9IHRvIHRo\nZW4gc2VsZWN0IHRoZSBkYXRhLgogICAgICogCiAgICAgKiBAcGFyYW0gY3R4\nIGZpbGwgd2l0aCBleGVjdXRpb24gY29udGV4dAogICAgICogQHBhcmFtIHN0\nYXRlIHdpbGwgYmUgZmlsbGVkIHdpdGggZXhwcmVzc2lvbiBzdGF0ZQogICAg\nICovCiAgICBwdWJsaWMgU2VsZWN0IGV2YWx1YXRlKEV4cENvbnRleHQgY3R4\nLCBTZWxlY3QgcGFyZW50LCBTdHJpbmcgYWxpYXMsIAogICAgICAgIFF1ZXJ5\nRXhwcmVzc2lvbnMgZXhwcywgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRl\nKSB7CiAgICAgICAgLy8gYWxyZWFkeSBrbm93IHRoYXQgdGhpcyBxdWVyeSBp\ncyBlcXVpdmFsZW50IHRvIGFuIGV4dGVudD8KICAgICAgICBTZWxlY3Qgc2Vs\nOwogICAgICAgIGlmIChfZXh0ZW50KSB7CiAgICAgICAgICAgIHNlbCA9IGN0\neC5zdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAg\nICAgIHNlbC5zZXRBdXRvRGlzdGluY3QoKGV4cHMuZGlzdGluY3QgJiBleHBz\nLkRJU1RJTkNUX0FVVE8pICE9IDApOwogICAgICAgICAgICByZXR1cm4gc2Vs\nOwogICAgICAgIH0KCiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IHNlbGVjdCBh\nbmQgaW5pdGlhbGl6ZSBpdCB3aXRoIHRoZSBqb2lucyBuZWVkZWQgZm9yCiAg\nICAgICAgLy8gdGhlIGNyaXRlcmlhIG9mIHRoaXMgcXVlcnkKICAgICAgICBz\nZWwgPSBuZXdTZWxlY3QoY3R4LCBwYXJlbnQsIGFsaWFzLCBleHBzLCBzdGF0\nZSk7CgogICAgICAgIC8vIGNyZWF0ZSB3aGVyZSBjbGF1c2U7IGlmIHRoZXJl\nIGFyZSBubyB3aGVyZSBjb25kaXRpb25zIGFuZAogICAgICAgIC8vIG5vIG9y\nZGVyaW5nIG9yIHByb2plY3Rpb25zLCB3ZSByZXR1cm4gbnVsbCB0byBzaWdu\naWZ5IHRoYXQgdGhpcwogICAgICAgIC8vIHF1ZXJ5IHNob3VsZCBiZSB0cmVh\ndGVkIGxpa2UgYW4gZXh0ZW50CiAgICAgICAgU2VsZWN0IGlubmVyID0gc2Vs\nLmdldEZyb21TZWxlY3QoKTsKICAgICAgICBTUUxCdWZmZXIgd2hlcmUgPSBi\ndWlsZFdoZXJlKChpbm5lciAhPSBudWxsKSA/IGlubmVyIDogc2VsLCBjdHgs\nIAogICAgICAgICAgICBzdGF0ZS5maWx0ZXIsIGV4cHMuZmlsdGVyKTsKICAg\nICAgICBpZiAod2hlcmUgPT0gbnVsbCAmJiBleHBzLnByb2plY3Rpb25zLmxl\nbmd0aCA9PSAwCiAgICAgICAgICAgICYmIGV4cHMub3JkZXJpbmcubGVuZ3Ro\nID09IDAKICAgICAgICAgICAgJiYgKHNlbC5nZXRKb2lucygpID09IG51bGwg\nfHwgc2VsLmdldEpvaW5zKCkuaXNFbXB0eSgpKSkgewogICAgICAgICAgICBf\nZXh0ZW50ID0gdHJ1ZTsKICAgICAgICAgICAgc2VsLnNldEF1dG9EaXN0aW5j\ndCgoZXhwcy5kaXN0aW5jdCAmIGV4cHMuRElTVElOQ1RfQVVUTykgIT0gMCk7\nCiAgICAgICAgICAgIHJldHVybiBzZWw7CiAgICAgICAgfQoKICAgICAgICAv\nLyBub3cgc2V0IHNxbCBjcml0ZXJpYTsgaXQgZ29lcyBvbiB0aGUgaW5uZXIg\nc2VsZWN0IGlmIHByZXNlbnQKICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgaW5uZXIud2hlcmUod2hlcmUpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc2VsLndoZXJlKHdoZXJlKTsKCiAgICAgICAgLy8gYXBw\nbHkgZ3JvdXBpbmcgYW5kIGhhdmluZy4gIHRoaXMgZG9lcyBub3Qgc2VsZWN0\nIHRoZSBncm91cGluZwogICAgICAgIC8vIGNvbHVtbnMsIGp1c3QgYnVpbGRz\nIHRoZSBHUk9VUCBCWSBjbGF1c2VzLiAgd2UgZG9uJ3QgYnVpbGQgdGhlCiAg\nICAgICAgLy8gT1JERVIgQlkgY2xhdXNlcyB5ZXQgYmVjYXVzZSBpZiB3ZSBk\nZWNpZGUgdG8gYWRkIHRoaXMgc2VsZWN0CiAgICAgICAgLy8gdG8gYSB1bmlv\nbiwgdGhlIE9SREVSIEJZIHZhbHVlcyBnZXQgYWxpYXNlZCBkaWZmZXJlbnRs\neQogICAgICAgIGlmIChleHBzLmhhdmluZyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIEV4cCBoYXZpbmdFeHAgPSAoRXhwKSBleHBzLmhhdmluZzsKICAgICAg\nICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIoY3R4LnN0b3Jl\nLmdldERCRGljdGlvbmFyeSgpKTsKICAgICAgICAgICAgaGF2aW5nRXhwLmFw\ncGVuZFRvKHNlbCwgY3R4LCBzdGF0ZS5oYXZpbmcsIGJ1Zik7CiAgICAgICAg\nICAgIHNlbC5oYXZpbmcoYnVmKTsKICAgICAgICB9CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBleHBzLmdyb3VwaW5nLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAoKFZhbCkgZXhwcy5ncm91cGluZ1tpXSkuZ3JvdXBCeShzZWws\nIGN0eCwgc3RhdGUuZ3JvdXBpbmdbaV0pOwogICAgICAgIHJldHVybiBzZWw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBuZXcgc2VsZWN0IHdp\ndGggZXhwcmVzc2lvbnMgaW5pdGlhbGl6ZWQuCiAgICAgKi8KICAgIHByaXZh\ndGUgU2VsZWN0IG5ld1NlbGVjdChFeHBDb250ZXh0IGN0eCwgU2VsZWN0IHBh\ncmVudCwKICAgICAgICBTdHJpbmcgYWxpYXMsIFF1ZXJ5RXhwcmVzc2lvbnMg\nZXhwcywgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7CiAgICAgICAg\nU2VsZWN0IHNlbCA9IGN0eC5zdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2Vs\nZWN0KCk7CiAgICAgICAgc2VsLnNldEF1dG9EaXN0aW5jdCgoZXhwcy5kaXN0\naW5jdCAmIGV4cHMuRElTVElOQ1RfQVVUTykgIT0gMCk7CiAgICAgICAgc2Vs\nLnNldEpvaW5TeW50YXgoY3R4LmZldGNoLmdldEpvaW5TeW50YXgoKSk7CiAg\nICAgICAgc2VsLnNldFBhcmVudChwYXJlbnQsIGFsaWFzKTsKICAgICAgICBp\nbml0aWFsaXplKHNlbCwgY3R4LCBleHBzLCBzdGF0ZSk7CgogICAgICAgIGlm\nICghc2VsLmdldEF1dG9EaXN0aW5jdCgpKSB7CiAgICAgICAgICAgIGlmICgo\nZXhwcy5kaXN0aW5jdCAmIGV4cHMuRElTVElOQ1RfVFJVRSkgIT0gMCkKICAg\nICAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAg\nICAgZWxzZSBpZiAoKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX0ZB\nTFNFKSAhPSAwKQogICAgICAgICAgICAgICAgc2VsLnNldERpc3RpbmN0KGZh\nbHNlKTsKICAgICAgICB9IGVsc2UgaWYgKGV4cHMucHJvamVjdGlvbnMubGVu\nZ3RoID4gMCkgewogICAgICAgICAgICBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkg\nJiYgKGV4cHMuZGlzdGluY3QgJiBleHBzLkRJU1RJTkNUX1RSVUUpICE9IDAp\newogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHNlbGVjdCBpcyBub3QgZGlz\ndGluY3QgYnV0IHRoZSBxdWVyeSBpcywgZm9yY2UKICAgICAgICAgICAgICAg\nIC8vIHRoZSBzZWxlY3QgdG8gYmUgZGlzdGluY3QKICAgICAgICAgICAgICAg\nIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChzZWwuaXNEaXN0aW5jdCgpKSB7CiAgICAgICAgICAgICAgICAvLyB3aGVu\nIGFnZ3JlZ2F0aW5nIGRhdGEgb3IgbWFraW5nIGEgbm9uLWRpc3RpbmN0IHBy\nb2plY3Rpb24KICAgICAgICAgICAgICAgIC8vIGZyb20gYSBkaXN0aW5jdCBz\nZWxlY3QsIHdlIGhhdmUgdG8gc2VsZWN0IGZyb20gYSB0bXAKICAgICAgICAg\nICAgICAgIC8vIHRhYmxlIGZvcm1lZCBieSBhIGRpc3RpbmN0IHN1YnNlbGVj\ndCBpbiB0aGUgZnJvbSBjbGF1c2U7CiAgICAgICAgICAgICAgICAvLyB0aGlz\nIHN1YnNlbGVjdCBzZWxlY3RzIHRoZSBwa3Mgb2YgdGhlIGNhbmRpZGF0ZSAo\ndG8KICAgICAgICAgICAgICAgIC8vIGdldCB1bmlxdWUgY2FuZGlkYXRlIHZh\nbHVlcykgYW5kIG5lZWRlZCBmaWVsZCB2YWx1ZXMgYW5kCiAgICAgICAgICAg\nICAgICAvLyBhcHBsaWVzIHRoZSB3aGVyZSBjb25kaXRpb25zOyB0aGUgb3V0\nZXIgc2VsZWN0IGFwcGxpZXMKICAgICAgICAgICAgICAgIC8vIG9yZGVyaW5n\nLCBncm91cGluZywgZXRjCiAgICAgICAgICAgICAgICBib29sZWFuIGFnZyA9\nIGV4cHMuaXNBZ2dyZWdhdGUoKTsKICAgICAgICAgICAgICAgIGJvb2xlYW4g\nY2FuZGlkYXRlID0gUHJvamVjdGlvbkV4cHJlc3Npb25WaXNpdG9yLgogICAg\nICAgICAgICAgICAgICAgIGhhc0NhbmRpZGF0ZVByb2plY3Rpb25zKGV4cHMu\ncHJvamVjdGlvbnMpOwogICAgICAgICAgICAgICAgaWYgKGFnZyB8fCAoY2Fu\nZGlkYXRlIAogICAgICAgICAgICAgICAgICAgICYmIChleHBzLmRpc3RpbmN0\nICYgZXhwcy5ESVNUSU5DVF9UUlVFKSA9PSAwKSkgewogICAgICAgICAgICAg\nICAgICAgIERCRGljdGlvbmFyeSBkaWN0ID0gY3R4LnN0b3JlLmdldERCRGlj\ndGlvbmFyeSgpOwogICAgICAgICAgICAgICAgICAgIGRpY3QuYXNzZXJ0U3Vw\ncG9ydChkaWN0LnN1cHBvcnRzU3Vic2VsZWN0LAogICAgICAgICAgICAgICAg\nICAgICAgICAiU3VwcG9ydHNTdWJzZWxlY3QiKTsKCiAgICAgICAgICAgICAg\nICAgICAgU2VsZWN0IGlubmVyID0gc2VsOwogICAgICAgICAgICAgICAgICAg\nIHNlbCA9IGN0eC5zdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7\nCiAgICAgICAgICAgICAgICAgICAgc2VsLnNldFBhcmVudChwYXJlbnQsIGFs\naWFzKTsKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoYWdn\nCiAgICAgICAgICAgICAgICAgICAgICAgICYmIChleHBzLmRpc3RpbmN0ICYg\nZXhwcy5ESVNUSU5DVF9UUlVFKSAhPSAwKTsKICAgICAgICAgICAgICAgICAg\nICBzZWwuc2V0RnJvbVNlbGVjdChpbm5lcik7CgogICAgICAgICAgICAgICAg\nLy8gYXV0by1kaXN0aW5jdGluZyBoYXBwZW5zIHRvIGdldCB1bmlxdWUgY2Fu\nZGlkYXRlIGluc3RhbmNlcwogICAgICAgICAgICAgICAgLy8gYmFjazsgZG9u\nJ3QgYXV0by1kaXN0aW5jdCBpZiB0aGUgdXNlciBpc24ndCBzZWxlY3Rpbmcg\nCiAgICAgICAgICAgICAgICAvLyBjYW5kaWRhdGUgZGF0YQogICAgICAgICAg\nICAgICAgfSBlbHNlIGlmICghY2FuZGlkYXRlIAogICAgICAgICAgICAgICAg\nICAgICYmIChleHBzLmRpc3RpbmN0ICYgZXhwcy5ESVNUSU5DVF9UUlVFKSA9\nPSAwKSAKICAgICAgICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFs\nc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBz\nZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGFsbCBleHBy\nZXNzaW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGluaXRpYWxpemUo\nU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIFF1ZXJ5RXhwcmVzc2lvbnMg\nZXhwcywgCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlKSB7\nCiAgICAgICAgTWFwIGNvbnRhaW5zID0gbnVsbDsKICAgICAgICBpZiAoSGFz\nQ29udGFpbnNFeHByZXNzaW9uVmlzaXRvci5oYXNDb250YWlucyhleHBzLmZp\nbHRlcikKICAgICAgICAgICAgfHwgSGFzQ29udGFpbnNFeHByZXNzaW9uVmlz\naXRvci5oYXNDb250YWlucyhleHBzLmhhdmluZykpCiAgICAgICAgICAgIGNv\nbnRhaW5zID0gbmV3IEhhc2hNYXAoNyk7CgogICAgICAgIC8vIGluaXRpYWxp\nemUgZmlsdGVyIGFuZCBoYXZpbmcgZXhwcmVzc2lvbnMKICAgICAgICBFeHAg\nZmlsdGVyRXhwID0gKEV4cCkgZXhwcy5maWx0ZXI7CiAgICAgICAgc3RhdGUu\nZmlsdGVyID0gZmlsdGVyRXhwLmluaXRpYWxpemUoc2VsLCBjdHgsIGNvbnRh\naW5zKTsKICAgICAgICBFeHAgaGF2aW5nRXhwID0gKEV4cCkgZXhwcy5oYXZp\nbmc7CiAgICAgICAgaWYgKGhhdmluZ0V4cCAhPSBudWxsKQogICAgICAgICAg\nICBzdGF0ZS5oYXZpbmcgPSBoYXZpbmdFeHAuaW5pdGlhbGl6ZShzZWwsIGN0\neCwgY29udGFpbnMpOwoKICAgICAgICAvLyBnZXQgdGhlIHRvcC1sZXZlbCBq\nb2lucyBhbmQgbnVsbCB0aGUgZXhwcmVzc2lvbidzIGpvaW5zCiAgICAgICAg\nLy8gYXQgdGhlIHNhbWUgdGltZSBzbyB0aGV5IGFyZW4ndCBpbmNsdWRlZCBp\nbiB0aGUgd2hlcmUvaGF2aW5nIFNRTAogICAgICAgIEpvaW5zIGZpbHRlckpv\naW5zID0gc3RhdGUuZmlsdGVyLmpvaW5zOwogICAgICAgIEpvaW5zIGhhdmlu\nZ0pvaW5zID0gKHN0YXRlLmhhdmluZyA9PSBudWxsKSA/IG51bGwgOiBzdGF0\nZS5oYXZpbmcuam9pbnM7CiAgICAgICAgSm9pbnMgam9pbnMgPSBzZWwuYW5k\nKGZpbHRlckpvaW5zLCBoYXZpbmdKb2lucyk7CgogICAgICAgIC8vIGluaXRp\nYWxpemUgcmVzdWx0IHZhbHVlcwogICAgICAgIGlmIChleHBzLnByb2plY3Rp\nb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgc3RhdGUucHJvamVjdGlv\nbnMgPSBuZXcgRXhwU3RhdGVbZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGhdOwog\nICAgICAgICAgICBWYWwgcmVzdWx0VmFsOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGV4cHMucHJvamVjdGlvbnMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIHJlc3VsdFZhbCA9IChWYWwpIGV4cHMucHJvamVj\ndGlvbnNbaV07CiAgICAgICAgICAgICAgICAvLyBoYXZlIHRvIGpvaW4gdGhy\nb3VnaCB0byByZWxhdGVkIHR5cGUgZm9yIHBjIG9iamVjdCAKICAgICAgICAg\nICAgICAgIC8vIHByb2plY3Rpb25zOyB0aGlzIGVuc3VyZXMgdGhhdCB3ZSBo\nYXZlIGFsbCBvdXIgam9pbnMgY2FjaGVkCiAgICAgICAgICAgICAgICBzdGF0\nZS5wcm9qZWN0aW9uc1tpXSA9IHJlc3VsdFZhbC5pbml0aWFsaXplKHNlbCwg\nY3R4LCAKICAgICAgICAgICAgICAgICAgICBWYWwuSk9JTl9SRUwgfCBWYWwu\nRk9SQ0VfT1VURVIpOwogICAgICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5k\nKGpvaW5zLCBzdGF0ZS5wcm9qZWN0aW9uc1tpXS5qb2lucyk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGluaXRpYWxpemUgZ3JvdXBp\nbmcKICAgICAgICBpZiAoZXhwcy5ncm91cGluZy5sZW5ndGggPiAwKSB7CiAg\nICAgICAgICAgIHN0YXRlLmdyb3VwaW5nID0gbmV3IEV4cFN0YXRlW2V4cHMu\nZ3JvdXBpbmcubGVuZ3RoXTsKICAgICAgICAgICAgVmFsIGdyb3VwVmFsOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGV4cHMuZ3JvdXBpbmcu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGdyb3VwVmFsID0gKFZh\nbCkgZXhwcy5ncm91cGluZ1tpXTsKICAgICAgICAgICAgICAgIC8vIGhhdmUg\ndG8gam9pbiB0aHJvdWdoIHRvIHJlbGF0ZWQgdHlwZSBmb3IgcGMgb2JqZWN0\nIGdyb3VwaW5nczsKICAgICAgICAgICAgICAgIC8vIHRoaXMgZW5zdXJlcyB0\naGF0IHdlIGhhdmUgYWxsIG91ciBqb2lucyBjYWNoZWQKICAgICAgICAgICAg\nICAgIHN0YXRlLmdyb3VwaW5nW2ldID0gZ3JvdXBWYWwuaW5pdGlhbGl6ZShz\nZWwsIGN0eCwgVmFsLkpPSU5fUkVMKTsKICAgICAgICAgICAgICAgIGpvaW5z\nID0gc2VsLmFuZChqb2lucywgc3RhdGUuZ3JvdXBpbmdbaV0uam9pbnMpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpbml0aWFsaXpl\nIG9yZGVyaW5nCiAgICAgICAgaWYgKGV4cHMub3JkZXJpbmcubGVuZ3RoID4g\nMCkgewogICAgICAgICAgICBzdGF0ZS5vcmRlcmluZyA9IG5ldyBFeHBTdGF0\nZVtleHBzLm9yZGVyaW5nLmxlbmd0aF07CiAgICAgICAgICAgIFZhbCBvcmRl\nclZhbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLm9y\nZGVyaW5nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBvcmRlclZh\nbCA9IChWYWwpIGV4cHMub3JkZXJpbmdbaV07CiAgICAgICAgICAgICAgICBz\ndGF0ZS5vcmRlcmluZ1tpXSA9IG9yZGVyVmFsLmluaXRpYWxpemUoc2VsLCBj\ndHgsIDApOwogICAgICAgICAgICAgICAgam9pbnMgPSBzZWwuYW5kKGpvaW5z\nLCBzdGF0ZS5vcmRlcmluZ1tpXS5qb2lucyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgc2VsLndoZXJlKGpvaW5zKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSB0aGUgd2hlcmUgc3FsLgogICAgICovCiAgICBw\ncml2YXRlIFNRTEJ1ZmZlciBidWlsZFdoZXJlKFNlbGVjdCBzZWwsIEV4cENv\nbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgRXhwcmVzc2lv\nbiBmaWx0ZXIpIHsKICAgICAgICAvLyBjcmVhdGUgd2hlcmUgYnVmZmVyCiAg\nICAgICAgU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcihjdHguc3Rv\ncmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAgIHdoZXJlLmFwcGVuZCgi\nKCIpOwogICAgICAgIEV4cCBmaWx0ZXJFeHAgPSAoRXhwKSBmaWx0ZXI7CiAg\nICAgICAgZmlsdGVyRXhwLmFwcGVuZFRvKHNlbCwgY3R4LCBzdGF0ZSwgd2hl\ncmUpOwoKICAgICAgICBpZiAod2hlcmUuc3FsRXF1YWxzKCIoIikgfHwgd2hl\ncmUuc3FsRXF1YWxzKCIoMSA9IDEiKSkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgcmV0dXJuIHdoZXJlLmFwcGVuZCgiKSIpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2VsZWN0IHRoZSBkYXRhIGZvciB0aGlzIHF1ZXJ5\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwg\nRXhwQ29udGV4dCBjdHgsIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAg\nIGJvb2xlYW4gc3ViY2xhc3NlcywgUXVlcnlFeHByZXNzaW9ucyBleHBzLCBR\ndWVyeUV4cHJlc3Npb25zU3RhdGUgc3RhdGUsCiAgICAgICAgaW50IGVhZ2Vy\nKSB7CiAgICAgICAgU2VsZWN0IGlubmVyID0gc2VsLmdldEZyb21TZWxlY3Qo\nKTsKICAgICAgICBWYWwgdmFsOwogICAgICAgIEpvaW5zIGpvaW5zID0gbnVs\nbDsKICAgICAgICBpZiAoc2VsLmdldFN1YnNlbGVjdFBhdGgoKSAhPSBudWxs\nKQogICAgICAgICAgICBqb2lucyA9IHNlbC5uZXdKb2lucygpLnNldFN1YnNl\nbGVjdChzZWwuZ2V0U3Vic2VsZWN0UGF0aCgpKTsKCiAgICAgICAgLy8gYnVp\nbGQgb3JkZXJpbmcgY2xhdXNlcyBiZWZvcmUgc2VsZWN0IHNvIHRoYXQgYW55\nIGVhZ2VyIGpvaW4KICAgICAgICAvLyBvcmRlcmluZyBnZXRzIGFwcGxpZWQg\nYWZ0ZXIgcXVlcnkgb3JkZXJpbmcKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGV4cHMub3JkZXJpbmcubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICgo\nVmFsKSBleHBzLm9yZGVyaW5nW2ldKS5vcmRlckJ5KHNlbCwgY3R4LCBzdGF0\nZS5vcmRlcmluZ1tpXSwKICAgICAgICAgICAgICAgIGV4cHMuYXNjZW5kaW5n\nW2ldKTsKCiAgICAgICAgLy8gaWYgbm8gcmVzdWx0IHN0cmluZyBzZXQsIHNl\nbGVjdCBtYXRjaGluZyBvYmplY3RzIGxpa2Ugbm9ybWFsCiAgICAgICAgaWYg\nKGV4cHMucHJvamVjdGlvbnMubGVuZ3RoID09IDAgJiYgc2VsLmdldFBhcmVu\ndCgpID09IG51bGwpIHsKICAgICAgICAgICAgaW50IHN1YnMgPSAoc3ViY2xh\nc3NlcykgPyBTZWxlY3QuU1VCU19KT0lOQUJMRSA6IFNlbGVjdC5TVUJTX05P\nTkU7CiAgICAgICAgICAgIHNlbC5zZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcs\nIHN1YnMsIGN0eC5zdG9yZSwgY3R4LmZldGNoLCBlYWdlcik7CiAgICAgICAg\nfSBlbHNlIGlmIChleHBzLnByb2plY3Rpb25zLmxlbmd0aCA9PSAwKSB7CiAg\nICAgICAgICAgIC8vIHN1YnNlbGVjdCBmb3Igb2JqZWN0czsgd2UgcmVhbGx5\nIGp1c3QgbmVlZCB0aGUgcHJpbWFyeSBrZXkgdmFsdWVzCiAgICAgICAgICAg\nIHNlbC5zZWxlY3QobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBq\nb2lucyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaWYgd2Ug\naGF2ZSBhbiBpbm5lciBzZWxlY3QsIHdlIG5lZWQgdG8gc2VsZWN0IHRoZSBj\nYW5kaWRhdGUKICAgICAgICAgICAgLy8gY2xhc3MnIHBrIGNvbHVtbnMgdG8g\nZ3VhcmFudGVlIHVuaXF1ZSBpbnN0YW5jZXMKICAgICAgICAgICAgaWYgKGlu\nbmVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBpbm5lci5zZWxlY3QobWFw\ncGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBqb2lucyk7CgogICAgICAg\nICAgICAvLyBzZWxlY3QgZWFjaCByZXN1bHQgdmFsdWU7IG5vIG5lZWQgdG8g\ncGFzcyBvbiB0aGUgZWFnZXIgbW9kZSBzaW5jZQogICAgICAgICAgICAvLyB1\nbmRlciBwcm9qZWN0aW9ucyB3ZSBhbHdheXMgdXNlIEVBR0VSX05PTkUKICAg\nICAgICAgICAgYm9vbGVhbiBwa3MgPSBzZWwuZ2V0UGFyZW50KCkgIT0gbnVs\nbDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLnByb2pl\nY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YWwgPSAo\nVmFsKSBleHBzLnByb2plY3Rpb25zW2ldOwogICAgICAgICAgICAgICAgaWYg\nKGlubmVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgdmFsLnNlbGVj\ndENvbHVtbnMoaW5uZXIsIGN0eCwgc3RhdGUucHJvamVjdGlvbnNbaV0sIHBr\ncyk7CiAgICAgICAgICAgICAgICB2YWwuc2VsZWN0KHNlbCwgY3R4LCBzdGF0\nZS5wcm9qZWN0aW9uc1tpXSwgcGtzKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gbWFrZSBzdXJlIGhhdmluZyBjb2x1bW5zIGFyZSBzZWxlY3Rl\nZCBzaW5jZSBpdCBpcyByZXF1aXJlZCBieSAKICAgICAgICAgICAgLy8gc29t\nZSBEQnMuICBwdXQgdGhlbSBsYXN0IHNvIHRoZXkgZG9uJ3QgYWZmZWN0IHJl\nc3VsdCBwcm9jZXNzaW5nCiAgICAgICAgICAgIGlmIChleHBzLmhhdmluZyAh\nPSBudWxsICYmIGlubmVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAoKEV4\ncCkgZXhwcy5oYXZpbmcpLnNlbGVjdENvbHVtbnMoaW5uZXIsIGN0eCwgc3Rh\ndGUuaGF2aW5nLCAKICAgICAgICAgICAgICAgICAgICB0cnVlKTsKICAgICAg\nICB9CgogICAgICAgIC8vIHNlbGVjdCBvcmRlcmluZyBjb2x1bW5zLCBzaW5j\nZSBpdCBpcyByZXF1aXJlZCBieSBzb21lIERCcy4gIHB1dCB0aGVtCiAgICAg\nICAgLy8gbGFzdCBzbyB0aGV5IGRvbid0IGFmZmVjdCByZXN1bHQgcHJvY2Vz\nc2luZwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXhwcy5vcmRlcmlu\nZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSAoVmFsKSBleHBz\nLm9yZGVyaW5nW2ldOwogICAgICAgICAgICBpZiAoaW5uZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHZhbC5zZWxlY3RDb2x1bW5zKGlubmVyLCBjdHgs\nIHN0YXRlLm9yZGVyaW5nW2ldLCB0cnVlKTsKICAgICAgICAgICAgdmFsLnNl\nbGVjdChzZWwsIGN0eCwgc3RhdGUub3JkZXJpbmdbaV0sIHRydWUpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gYWRkIGNvbmRpdGlvbnMgbGltaXRpbmcgdGhl\nIHByb2plY3Rpb25zIHRvIHRoZSBwcm9wZXIgY2xhc3NlczsgaWYKICAgICAg\nICAvLyB0aGlzIGlzbid0IGEgcHJvamVjdGlvbiBvciBhIHN1YnEgdGhlbiB0\naGV5IHdpbGwgYWxyZWFkeSBiZSBhZGRlZAogICAgICAgIGlmIChleHBzLnBy\nb2plY3Rpb25zLmxlbmd0aCA+IDAgfHwgc2VsLmdldFBhcmVudCgpICE9IG51\nbGwpIHsKICAgICAgICAgICAgY3R4LnN0b3JlLmxvYWRTdWJjbGFzc2VzKG1h\ncHBpbmcpOwogICAgICAgICAgICBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3Io\nKS5hZGRDbGFzc0NvbmRpdGlvbnMoKGlubmVyICE9IG51bGwpIAogICAgICAg\nICAgICAgICAgPyBpbm5lciA6IHNlbCwgc3ViY2xhc3Nlcywgam9pbnMpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVzZWQgdG8gY2hlY2sg\nd2hldGhlciBhIHF1ZXJ5J3MgcmVzdWx0IHByb2plY3Rpb25zIGFyZSBvbiB0\naGUgY2FuZGlkYXRlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBQcm9qZWN0aW9uRXhwcmVzc2lvblZpc2l0b3IKICAgICAgICBleHRlbmRz\nIEFic3RyYWN0RXhwcmVzc2lvblZpc2l0b3IgewoKICAgICAgICBwcml2YXRl\nIGJvb2xlYW4gX2NhbmRpZGF0ZSA9IGZhbHNlOwogICAgICAgIHByaXZhdGUg\naW50IF9sZXZlbCA9IDA7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVh\nbiBoYXNDYW5kaWRhdGVQcm9qZWN0aW9ucyhWYWx1ZVtdIHByb2pzKSB7CiAg\nICAgICAgICAgIFByb2plY3Rpb25FeHByZXNzaW9uVmlzaXRvciB2ID0gbmV3\nIFByb2plY3Rpb25FeHByZXNzaW9uVmlzaXRvcigpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHByb2pzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBwcm9qc1tpXS5hY2NlcHRWaXNpdCh2KTsKICAgICAgICAg\nICAgICAgIGlmICh2Ll9jYW5kaWRhdGUpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZW50ZXIo\nVmFsdWUgdmFsKSB7CiAgICAgICAgICAgIGlmICghX2NhbmRpZGF0ZSkgewog\nICAgICAgICAgICAgICAgX2NhbmRpZGF0ZSA9IChfbGV2ZWwgPT0gMCAmJiB2\nYWwgaW5zdGFuY2VvZiBDb25zdGFudCkKICAgICAgICAgICAgICAgICAgICB8\nfCAodmFsIGluc3RhbmNlb2YgUENQYXRoIAogICAgICAgICAgICAgICAgICAg\nICYmICEoKFBDUGF0aCkgdmFsKS5pc1ZhcmlhYmxlUGF0aCgpKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBfbGV2ZWwrKzsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGV4aXQoVmFsdWUgdmFsKSB7CiAgICAgICAgICAg\nIF9sZXZlbC0tOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

