{"sha":"fd9344455bb4be3bb30819d183454d2d374707a8","node_id":"MDQ6QmxvYjIwNjM2NDpmZDkzNDQ0NTViYjRiZTNiYjMwODE5ZDE4MzQ1NGQyZDM3NDcwN2E4","size":37271,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fd9344455bb4be3bb30819d183454d2d374707a8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5J\ndGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBv\ncnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0\nb3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuTm9uZUNsYXNzU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5tZXRhLnN0cmF0cy5SZWxhdGlvbkZpZWxkU3RyYXRlZ3k7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbklP\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVp\nZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nU2NoZW1hczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVt\nYS5UYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5K\nb2luczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1\nbHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93TWFu\nYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TZWxl\nY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZldGNoQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUENTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9w\nLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKCi8qKgogKiBTcGVj\naWFsaXphdGlvbiBvZiBtZXRhZGF0YSBmb3IgcmVsYXRpb25hbCBkYXRhYmFz\nZXMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3Mg\nQ2xhc3NNYXBwaW5nCiAgICBleHRlbmRzIENsYXNzTWV0YURhdGEKICAgIGlt\ncGxlbWVudHMgQ2xhc3NTdHJhdGVneSB7CgogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBDbGFzc01hcHBpbmdbXSBFTVBUWV9NQVBQSU5HUyA9IG5ldyBDbGFz\nc01hcHBpbmdbMF07CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxp\nemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChDbGFz\nc01hcHBpbmcuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNYXBw\naW5nSW5mbyBfaW5mbzsKICAgIHByaXZhdGUgZmluYWwgRGlzY3JpbWluYXRv\nciBfZGlzY3JpbTsKICAgIHByaXZhdGUgZmluYWwgVmVyc2lvbiBfdmVyc2lv\nbjsKICAgIHByaXZhdGUgQ2xhc3NTdHJhdGVneSBfc3RyYXRlZ3kgPSBudWxs\nOwoKICAgIHByaXZhdGUgVGFibGUgX3RhYmxlID0gbnVsbDsKICAgIHByaXZh\ndGUgQ29sdW1uSU8gX2lvID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uW10g\nX2NvbHMgPSBTY2hlbWFzLkVNUFRZX0NPTFVNTlM7CiAgICBwcml2YXRlIEZv\ncmVpZ25LZXkgX2ZrID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9zdWJjbGFz\nc01vZGUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKCiAgICBwcml2YXRlIENsYXNz\nTWFwcGluZ1tdIF9qb2luU3ViTWFwcyA9IG51bGw7CiAgICBwcml2YXRlIENs\nYXNzTWFwcGluZ1tdIF9hc3NpZ25NYXBzID0gbnVsbDsKCiAgICAvLyBtYXBz\nIGNvbHVtbnMgdG8gam9pbmFibGVzCiAgICBwcml2YXRlIGZpbmFsIE1hcCBf\nam9pbmFibGVzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkTWFwKG5ldyBI\nYXNoTWFwKCkpOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBkZXNjcmliZWQgdHlwZSBhbmQgb3duaW5nIHJlcG9zaXRvcnkuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBDbGFzc01hcHBpbmcoQ2xhc3MgdHlwZSwgTWFw\ncGluZ1JlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBzdXBlcih0eXBlLCBy\nZXBvcyk7CiAgICAgICAgX2Rpc2NyaW0gPSByZXBvcy5uZXdEaXNjcmltaW5h\ndG9yKHRoaXMpOwogICAgICAgIF92ZXJzaW9uID0gcmVwb3MubmV3VmVyc2lv\nbih0aGlzKTsKICAgICAgICBfaW5mbyA9IHJlcG9zLm5ld01hcHBpbmdJbmZv\nKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogRW1iZWRkZWQgY29uc3Ry\ndWN0b3IuIFN1cHBseSBlbWJlZGRpbmcgdmFsdWUgYW5kIG93bmluZyByZXBv\nc2l0b3J5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xhc3NNYXBwaW5nKFZh\nbHVlTWV0YURhdGEgdm1kKSB7CiAgICAgICAgc3VwZXIodm1kKTsKICAgICAg\nICBfZGlzY3JpbSA9IGdldE1hcHBpbmdSZXBvc2l0b3J5KCkubmV3RGlzY3Jp\nbWluYXRvcih0aGlzKTsKICAgICAgICBfdmVyc2lvbiA9IGdldE1hcHBpbmdS\nZXBvc2l0b3J5KCkubmV3VmVyc2lvbih0aGlzKTsKICAgICAgICBfaW5mbyA9\nIGdldE1hcHBpbmdSZXBvc2l0b3J5KCkubmV3TWFwcGluZ0luZm8odGhpcyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgZGlzY3JpbWluYXRv\nci4KICAgICAqLwogICAgcHVibGljIERpc2NyaW1pbmF0b3IgZ2V0RGlzY3Jp\nbWluYXRvcigpIHsKICAgICAgICByZXR1cm4gX2Rpc2NyaW07CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgdmVyc2lvbiBpbmRpY2F0b3IuCiAgICAgKi8K\nICAgIHB1YmxpYyBWZXJzaW9uIGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF92ZXJzaW9uOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBS\ndW50aW1lCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBvaWQgdmFsdWUgc3RvcmVkIGluIHRoZSByZXN1bHQuIFRoaXMgaW1w\nbGVtZW50YXRpb24gd2lsbAogICAgICogcmVjdXJzZSB1bnRpbCBpdCBmaW5k\ncyBhbiBhbmNlc3RvciBjbGFzcyB3aG8gdXNlcyBvaWQgdmFsdWVzIGZvciBp\ndHMKICAgICAqIHByaW1hcnkga2V5LgogICAgICoKICAgICAqIEBwYXJhbSBm\nayBpZiBub24tbnVsbCwgdXNlIHRoZSBsb2NhbCBjb2x1bW5zIG9mIHRoZSBn\naXZlbiBmb3JlaWduCiAgICAgKiBrZXkgaW4gcGxhY2Ugb2YgdGhpcyBjbGFz\ncycgcHJpbWFyeSBrZXkgY29sdW1ucwogICAgICogQHNlZSAjaXNQcmltYXJ5\nS2V5T2JqZWN0SWQKICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRPYmpl\nY3RJZChKREJDU3RvcmUgc3RvcmUsIFJlc3VsdCByZXMsIEZvcmVpZ25LZXkg\nZmssCiAgICAgICAgYm9vbGVhbiBzdWJzLCBKb2lucyBqb2lucykKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBWYWx1ZU1hcHBpbmcg\nZW1iZWQgPSBnZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAgICAgICAgaWYgKGVt\nYmVkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBlbWJlZC5nZXRGaWVs\nZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBpbmcoKS4KICAgICAgICAgICAg\nICAgIGdldE9iamVjdElkKHN0b3JlLCByZXMsIGZrLCBzdWJzLCBqb2lucyk7\nCgogICAgICAgIHJldHVybiBnZXRPYmplY3RJZCh0aGlzLCBzdG9yZSwgcmVz\nLCBmaywgc3Vicywgam9pbnMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVj\ndXJzaXZlIGhlbHBlciBmb3IgcHVibGljIDxjb2RlPmdldE9iamVjdElkPC9j\nb2RlPiBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGdldE9i\namVjdElkKENsYXNzTWFwcGluZyBjbHMsIEpEQkNTdG9yZSBzdG9yZSwgUmVz\ndWx0IHJlcywKICAgICAgICBGb3JlaWduS2V5IGZrLCBib29sZWFuIHN1YnMs\nIEpvaW5zIGpvaW5zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGlmICghaXNQcmltYXJ5S2V5T2JqZWN0SWQodHJ1ZSkpCiAgICAg\nICAgICAgIHJldHVybiBnZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkuZ2V0T2Jq\nZWN0SWQoY2xzLCBzdG9yZSwgcmVzLCBmaywKICAgICAgICAgICAgICAgIHN1\nYnMsIGpvaW5zKTsKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nSURfVU5LTk9XTikKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhj\nZXB0aW9uKCk7CgogICAgICAgIENvbHVtbltdIHBrcyA9IGdldFByaW1hcnlL\nZXlDb2x1bW5zKCk7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgpID09\nIElEX0RBVEFTVE9SRSkgewogICAgICAgICAgICBDb2x1bW4gY29sID0gKGZr\nID09IG51bGwpID8gcGtzWzBdIDogZmsuZ2V0Q29sdW1uKHBrc1swXSk7CiAg\nICAgICAgICAgIGxvbmcgaWQgPSByZXMuZ2V0TG9uZyhjb2wsIGpvaW5zKTsK\nICAgICAgICAgICAgcmV0dXJuIChpZCA9PSAwICYmIHJlcy53YXNOdWxsKCkp\nID8gbnVsbAogICAgICAgICAgICAgICAgOiBzdG9yZS5uZXdEYXRhU3RvcmVJ\nZChpZCwgY2xzLCBzdWJzKTsKICAgICAgICB9CgogICAgICAgIC8vIGFwcGxp\nY2F0aW9uIGlkZW50aXR5CiAgICAgICAgT2JqZWN0W10gdmFscyA9IG5ldyBP\nYmplY3RbZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0aF07CiAgICAgICAg\nRmllbGRNYXBwaW5nIGZtOwogICAgICAgIEpvaW5hYmxlIGpvaW47CiAgICAg\nICAgaW50IHBrSWR4OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGtz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIHdlIGtub3cgdGhhdCBh\nbGwgcGsgY29sdW1uIGpvaW4gbWFwcGluZ3MgdXNlIHByaW1hcnkga2V5IGZp\nZWxkcywKICAgICAgICAgICAgLy8gY2F1c2UgdGhpcyBtYXBwaW5nIHVzZXMg\ndGhlIG9pZCBhcyBpdHMgcHJpbWFyeSBrZXkgKHdlIHJlY3Vyc2VkCiAgICAg\nICAgICAgIC8vIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIG1ldGhvZCB0byBl\nbnN1cmUgdGhpcykKICAgICAgICAgICAgam9pbiA9IGFzc2VydEpvaW5hYmxl\nKHBrc1tpXSk7CiAgICAgICAgICAgIGZtID0gZ2V0RmllbGRNYXBwaW5nKGpv\naW4uZ2V0RmllbGRJbmRleCgpKTsKICAgICAgICAgICAgcGtJZHggPSBmbS5n\nZXRQcmltYXJ5S2V5SW5kZXgoKTsKCiAgICAgICAgICAgIC8vIGNvdWxkIGhh\ndmUgYWxyZWFkeSBzZXQgdmFsdWUgd2l0aCBwcmV2aW91cyBtdWx0aS1jb2x1\nbW4gam9pbmFibGUKICAgICAgICAgICAgaWYgKHZhbHNbcGtJZHhdID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIHJlcy5zdGFydERhdGFSZXF1ZXN0KGZt\nKTsKICAgICAgICAgICAgICAgIHZhbHNbcGtJZHhdID0gam9pbi5nZXRQcmlt\nYXJ5S2V5VmFsdWUocmVzLCBqb2luLmdldENvbHVtbnMoKSwKICAgICAgICAg\nICAgICAgICAgICBmaywgc3RvcmUsIGpvaW5zKTsKICAgICAgICAgICAgICAg\nIHJlcy5lbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgaWYgKHZh\nbHNbcGtJZHhdID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHRo\nZSBvaWQgZGF0YSBpcyBsb2FkZWQgYnkgdGhlIGJhc2UgdHlwZSwgYnV0IGlm\nIGRpc2NyaW1pbmF0b3IgZGF0YQogICAgICAgIC8vIGlzIHByZXNlbnQsIG1h\na2Ugc3VyZSB0byB1c2UgaXQgdG8gY29uc3RydWN0IHRoZSBhY3R1YWwgb2lk\nIGluc3RhbmNlCiAgICAgICAgLy8gc28gdGhhdCB3ZSBnZXQgdGhlIGNvcnJl\nY3QgYXBwIGlkIGNsYXNzLCBldGMKICAgICAgICBDbGFzc01hcHBpbmcgZGNs\ncyA9IGNsczsKICAgICAgICBpZiAoc3VicykgewogICAgICAgICAgICByZXMu\nc3RhcnREYXRhUmVxdWVzdChjbHMuZ2V0RGlzY3JpbWluYXRvcigpKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENsYXNzIGR0eXBlID0g\nY2xzLmdldERpc2NyaW1pbmF0b3IoKS5nZXRDbGFzcyhzdG9yZSwgY2xzLCBy\nZXMpOwogICAgICAgICAgICAgICAgaWYgKGR0eXBlICE9IGNscy5nZXREZXNj\ncmliZWRUeXBlKCkpCiAgICAgICAgICAgICAgICAgIGRjbHMgPSBjbHMuZ2V0\nTWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nKGR0eXBlLCAKICAgICAg\nICAgICAgICAgICAgICBzdG9yZS5nZXRDb250ZXh0KCkuZ2V0Q2xhc3NMb2Fk\nZXIoKSwgdHJ1ZSk7IAogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgLy8gaW50ZW50aW9uYWxseSBpZ25vcmVk\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzLmVuZERhdGFSZXF1ZXN0\nKCk7ICAKICAgICAgICB9CiAgICAgICAgT2JqZWN0IG9pZCA9IEFwcGxpY2F0\naW9uSWRzLmZyb21QS1ZhbHVlcyh2YWxzLCBkY2xzKTsKICAgICAgICBpZiAo\nb2lkIGluc3RhbmNlb2YgT3BlbkpQQUlkKSB7CiAgICAgICAgICAgICgoT3Bl\nbkpQQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoZGNscy5nZXRE\nZXNjcmliZWRUeXBlKCksIAogICAgICAgICAgICAgICAgc3Vicyk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBvaWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIGdpdmVuIGNvbHVtbiB2YWx1ZShzKSBmb3IgdGhlIGdp\ndmVuIG9iamVjdC4gVGhlIGdpdmVuCiAgICAgKiBjb2x1bW5zIHdpbGwgYmUg\ncHJpbWFyeSBrZXkgY29sdW1ucyBvZiB0aGlzIG1hcHBpbmcsIGJ1dCBtYXkg\nYmUgaW4KICAgICAqIGFueSBvcmRlci4gSWYgdGhlcmUgaXMgb25seSBvbmUg\nY29sdW1uLCByZXR1cm4gaXRzIHZhbHVlLiBJZiB0aGVyZQogICAgICogYXJl\nIG11bHRpcGxlIGNvbHVtbnMsIHJldHVybiBhbiBvYmplY3QgYXJyYXkgb2Yg\ndGhlaXIgdmFsdWVzLCBpbiB0aGUKICAgICAqIHNhbWUgb3JkZXIgdGhlIGNv\nbHVtbnMgYXJlIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IHRv\nRGF0YVN0b3JlVmFsdWUoT2JqZWN0IG9iaiwgQ29sdW1uW10gY29scywgSkRC\nQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgT2JqZWN0IHJldCA9IChjb2xzLmxl\nbmd0aCA9PSAxKSA/IG51bGwgOiBuZXcgT2JqZWN0W2NvbHMubGVuZ3RoXTsK\nCiAgICAgICAgLy8gaW4gdGhlIHBhc3Qgd2UndmUgYmVlbiBsZW5pZW50IGFi\nb3V0IGJlaW5nIGFibGUgdG8gdHJhbnNsYXRlIG9iamVjdHMKICAgICAgICAv\nLyBmcm9tIG90aGVyIHBlcnNpc3RlbmNlIGNvbnRleHRzLCBzbyB0cnkgdG8g\nZ2V0IHNtIGRpcmVjdGx5IGZyb20KICAgICAgICAvLyBpbnN0YW5jZSBiZWZv\ncmUgYXNraW5nIG91ciBjb250ZXh0CiAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUo\nb2JqKSkgewogICAgICAgIAlQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSBJbXBs\nSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwKICAgICAgICAgICAg\nICAgICAgICBnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpKTsK\nICAgICAgICAgICAgc20gPSAoT3BlbkpQQVN0YXRlTWFuYWdlcikgcGMucGNH\nZXRTdGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwp\nIHsKICAgICAgICAgICAgCXJldCA9IGdldFZhbHVlRnJvbVVubWFuYWdlZElu\nc3RhbmNlKG9iaiwgY29scywgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBp\nZiAoc20uaXNEZXRhY2hlZCgpKSB7CiAgICAgICAgICAgIAlvYmogPSBzdG9y\nZS5nZXRDb250ZXh0KCkuZmluZChzbS5nZXRPYmplY3RJZCgpLCBmYWxzZSwg\nbnVsbCk7CiAgICAgICAgICAgIAlzbSA9IHN0b3JlLmdldENvbnRleHQoKS5n\nZXRTdGF0ZU1hbmFnZXIob2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIHNtID0gc3RvcmUuZ2V0Q29udGV4dCgpLmdl\ndFN0YXRlTWFuYWdlcihvYmopOwogICAgICAgIH0KICAgICAgICBpZiAoc20g\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJldDsKCiAgICAgICAgT2Jq\nZWN0IHZhbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFsID0gYXNzZXJ0Sm9pbmFibGUo\nY29sc1tpXSkuZ2V0Sm9pblZhbHVlKHNtLCBjb2xzW2ldLCBzdG9yZSk7CiAg\nICAgICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAg\nICAgcmV0ID0gdmFsOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAoKE9iamVjdFtdKSByZXQpW2ldID0gdmFsOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gcmV0OwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgam9pbmFibGUgZm9yIHRoZSBnaXZlbiBjb2x1bW4sIG9yIHRocm93\nIGFuIGV4Y2VwdGlvbiBpZgogICAgICogbm9uZSBpcyBhdmFpbGFibGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBKb2luYWJsZSBhc3NlcnRKb2luYWJsZShDb2x1\nbW4gY29sKSB7CiAgICAgICAgSm9pbmFibGUgam9pbiA9IGdldEpvaW5hYmxl\nKGNvbCk7CiAgICAgICAgaWYgKGpvaW4gPT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1qb2lu\nYWJsZSIsCiAgICAgICAgICAgICAgICBjb2wuZ2V0RnVsbE5hbWUoKSkpOwog\nICAgICAgIHJldHVybiBqb2luOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSB7QGxpbmsgSm9pbmFibGV9IGZvciB0aGUgZ2l2ZW4gY29sdW1u\nLiBBbnkgY29sdW1uIHRoYXQKICAgICAqIGFub3RoZXIgbWFwcGluZyBqb2lu\ncyB0byBtdXN0IGJlIGNvbnRyb2xsZWQgYnkgYSBqb2luYWJsZS4KICAgICAq\nLwogICAgcHVibGljIEpvaW5hYmxlIGdldEpvaW5hYmxlKENvbHVtbiBjb2wp\nIHsKICAgICAgICBKb2luYWJsZSBqb2luOwogICAgICAgIGlmIChnZXRFbWJl\nZGRpbmdNZXRhRGF0YSgpICE9IG51bGwpIHsKICAgICAgICAgICAgam9pbiA9\nIGdldEVtYmVkZGluZ01hcHBpbmcoKS5nZXRGaWVsZE1hcHBpbmcoKS4KICAg\nICAgICAgICAgICAgIGdldERlZmluaW5nTWFwcGluZygpLmdldEpvaW5hYmxl\nKGNvbCk7CiAgICAgICAgICAgIGlmIChqb2luICE9IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gam9pbjsKICAgICAgICB9CiAgICAgICAgQ2xhc3NN\nYXBwaW5nIHN1cCA9IGdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygp\nOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkgewogICAgICAgICAgICBqb2lu\nID0gc3VwLmdldEpvaW5hYmxlKGNvbCk7CiAgICAgICAgICAgIGlmIChqb2lu\nICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gam9pbjsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIChKb2luYWJsZSkgX2pvaW5hYmxlcy5nZXQo\nY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2ZW4gY29s\ndW1uLXRvLWpvaW5hYmxlIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNldEpvaW5hYmxlKENvbHVtbiBjb2wsIEpvaW5hYmxlIGpvaW5hYmxl\nKSB7CiAgICAgICAgLy8gZG9uJ3QgbGV0IG5vbi1wayBvdmVycmlkZSBwawog\nICAgICAgIEpvaW5hYmxlIGpvaW4gPSAoSm9pbmFibGUpIF9qb2luYWJsZXMu\nZ2V0KGNvbCk7CiAgICAgICAgaWYgKGpvaW4gPT0gbnVsbCB8fCAoam9pbi5n\nZXRGaWVsZEluZGV4KCkgIT0gLTEKICAgICAgICAgICAgJiYgZ2V0RmllbGQo\nam9pbi5nZXRGaWVsZEluZGV4KCkpLmdldFByaW1hcnlLZXlJbmRleCgpID09\nIC0xKSkKICAgICAgICAgICAgX2pvaW5hYmxlcy5wdXQoY29sLCBqb2luYWJs\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGUg\nY29sdW1ucyBvZiB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdG8gdGhpcyBtYXBw\naW5nCiAgICAgKiBjYW4gYmUgdXNlZCB0byBjb25zdHJ1Y3QgYW4gb2JqZWN0\nIGlkIGZvciB0aGlzIHR5cGUuIFRoaXMgaXMgYQogICAgICogcmVsYXRpdmVs\neSBleHBlbnNpdmUgb3BlcmF0aW9uOyBpdHMgcmVzdWx0cyBzaG91bGQgYmUg\nY2FjaGVkLgogICAgICoKICAgICAqIEByZXR1cm4ge0BsaW5rIEJvb2xlYW4j\nVFJVRX0gaWYgdGhlIGZvcmVpZ24ga2V5IGNvbnRhaW5zIGFsbCBvaWQKICAg\nICAqIGNvbHVtbnMsIDxjb2RlPm51bGw8L2NvZGU+IGlmIGl0IGNvbnRhaW5z\nIG9ubHkgc29tZSBjb2x1bW5zLAogICAgICogb3Ige0BsaW5rIEJvb2xlYW4j\nRkFMU0V9IGlmIGl0IGNvbnRhaW5zIG5vbi1vaWQgY29sdW1ucwogICAgICov\nCiAgICBwdWJsaWMgQm9vbGVhbiBpc0ZvcmVpZ25LZXlPYmplY3RJZChGb3Jl\naWduS2V5IGZrKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgcHJp\nbWFyeSBrZXkgY2FuJ3QgY29uc3RydWN0IGFuIG9pZCwgdGhlbiBubyB3YXkK\nICAgICAgICAvLyBmb3JlaWduIGtleSBjYW4KICAgICAgICBpZiAoZ2V0SWRl\nbnRpdHlUeXBlKCkgPT0gSURfVU5LTk9XTiB8fCAhaXNQcmltYXJ5S2V5T2Jq\nZWN0SWQoZmFsc2UpKQogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5GQUxT\nRTsKCiAgICAgICAgLy8gd2l0aCBkYXRhc3RvcmUgaWRlbnRpdHksIGl0J3Mg\nYWxsIG9yIG5vdGhpbmcKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZmsuZ2V0\nUHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlU\neXBlKCkgPT0gSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAgIGlmIChjb2xz\nLmxlbmd0aCAhPSAxIHx8IGNvbHNbMF0gIT0gZ2V0UHJpbWFyeUtleUNvbHVt\nbnMoKVswXSkKICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0K\nCiAgICAgICAgLy8gY2hlY2sgdGhlIGpvaW4gbWFwcGluZyBmb3IgZWFjaCBw\nayBjb2x1bW4gdG8gc2VlIGlmIGl0IGxpbmtzIHVwIHRvCiAgICAgICAgLy8g\nYSBwcmltYXJ5IGtleSBmaWVsZAogICAgICAgIEpvaW5hYmxlIGpvaW47CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGpvaW4gPSBhc3NlcnRKb2luYWJsZShjb2xzW2ldKTsK\nICAgICAgICAgICAgaWYgKGpvaW4uZ2V0RmllbGRJbmRleCgpICE9IC0xCiAg\nICAgICAgICAgICAgICAmJiBnZXRGaWVsZChqb2luLmdldEZpZWxkSW5kZXgo\nKSkuZ2V0UHJpbWFyeUtleUluZGV4KCkgPT0gLTEpCiAgICAgICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9CgogICAgICAgIC8v\nIGlmIGFsbCBwcmltYXJ5IGtleSBsaW5rcywgc2VlIHdoZXRoZXIgd2Ugam9p\nbiB0byBhbGwgcGtzCiAgICAgICAgaWYgKGlzUHJpbWFyeUtleU9iamVjdElk\nKHRydWUpCiAgICAgICAgICAgICYmIGNvbHMubGVuZ3RoID09IGdldFByaW1h\ncnlLZXlDb2x1bW5zKCkubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gQm9v\nbGVhbi5UUlVFOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8v\nLy8vLy8KICAgIC8vIE9STQogICAgLy8vLy8vLwoKICAgIC8qKgogICAgICog\nUmF3IG1hcHBpbmcgZGF0YS4KICAgICAqLwogICAgcHVibGljIENsYXNzTWFw\ncGluZ0luZm8gZ2V0TWFwcGluZ0luZm8oKSB7CiAgICAgICAgcmV0dXJuIF9p\nbmZvOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHVzZWQg\ndG8gbWFwIHRoaXMgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIENsYXNz\nU3RyYXRlZ3kgZ2V0U3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJh\ndGVneTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzdHJhdGVneSB1c2Vk\nIHRvIG1hcCB0aGlzIG1hcHBpbmcuIFRoZSA8Y29kZT5hZGFwdDwvY29kZT4K\nICAgICAqIHBhcmFtZXRlciBkZXRlcm1pbmVzIHdoZXRoZXIgdG8gYWRhcHQg\nd2hlbiBtYXBwaW5nIHRoZSBzdHJhdGVneTsKICAgICAqIHVzZSBudWxsIGlm\nIHRoZSBzdHJhdGVneSBzaG91bGQgbm90IGJlIG1hcHBlZC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0U3RyYXRlZ3koQ2xhc3NTdHJhdGVneSBzdHJh\ndGVneSwgQm9vbGVhbiBhZGFwdCkgewogICAgICAgIC8vIHNldCBzdHJhdGVn\neSBmaXJzdCBzbyB3ZSBjYW4gYWNjZXNzIGl0IGR1cmluZyBtYXBwaW5nCiAg\nICAgICAgQ2xhc3NTdHJhdGVneSBvcmlnID0gX3N0cmF0ZWd5OwogICAgICAg\nIF9zdHJhdGVneSA9IHN0cmF0ZWd5OwogICAgICAgIGlmIChzdHJhdGVneSAh\nPSBudWxsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBz\ndHJhdGVneS5zZXRDbGFzc01hcHBpbmcodGhpcyk7CiAgICAgICAgICAgICAg\nICBpZiAoYWRhcHQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzdHJh\ndGVneS5tYXAoYWRhcHQuYm9vbGVhblZhbHVlKCkpOwogICAgICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAg\nICAvLyByZXNldCBzdHJhdGVneQogICAgICAgICAgICAgICAgX3N0cmF0ZWd5\nID0gb3JpZzsKICAgICAgICAgICAgICAgIHRocm93IHJlOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1hcHBp\nbmcncyBwcmltYXJ5IHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgVGFibGUg\nZ2V0VGFibGUoKSB7CiAgICAgICAgcmV0dXJuIF90YWJsZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtYXBwaW5nJ3MgcHJpbWFyeSB0YWJsZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0VGFibGUoVGFibGUgdGFibGUpIHsK\nICAgICAgICBfdGFibGUgPSB0YWJsZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBjb2x1bW5zIHRoaXMgbWFwcGluZyB1c2VzIHRvIHVuaXF1ZWx5IGlk\nZW50aWZ5IGFuIG9iamVjdC4KICAgICAqIFRoZXNlIHdpbGwgdHlwaWNhbGx5\nIGJlIHRoZSBwcmltYXJ5IGtleSBjb2x1bW5zIG9yIHRoZSBjb2x1bW5zIHRo\naXMKICAgICAqIGNsYXNzIHVzZXMgdG8gbGluayB0byBpdHMgc3VwZXJjbGFz\ncyB0YWJsZS4KICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdldFByaW1h\ncnlLZXlDb2x1bW5zKCkgewogICAgICAgIGlmIChnZXRJZGVudGl0eVR5cGUo\nKSA9PSBJRF9BUFBMSUNBVElPTiAmJiBpc01hcHBlZCgpKSB7CiAgICAgICAg\nICAgIGlmIChfY29scy5sZW5ndGggPT0gMCkgeyAgICAgICAgICAgIAogICAg\nICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gcGtzID0gZ2V0UHJpbWFyeUtl\neUZpZWxkTWFwcGluZ3MoKTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb24g\nY29scyA9IG5ldyBBcnJheUxpc3QocGtzLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBDb2x1bW5bXSBmaWVsZENvbHM7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgICAgIGZpZWxkQ29scyA9IHBrc1tpXS5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkQ29scy5sZW5ndGggPT0gMCkg\newogICAgICAgICAgICAgICAgICAgICAgICBfY29scyA9IG5ldyBDb2x1bW5b\nMF07CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29sczsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yIChp\nbnQgaiA9IDA7IGogPCBmaWVsZENvbHMubGVuZ3RoOyBqKyspCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbHMuYWRkKGZpZWxkQ29sc1tqXSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfY29scyA9IChDb2x1bW5b\nXSkgY29scy50b0FycmF5KG5ldyBDb2x1bW5bY29scy5zaXplKCldKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NvbHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgY29sdW1ucyB0aGlzIG1hcHBpbmcg\ndXNlcyB0byB1bmlxdWVseSBpZGVudGlmeSBhbiBvYmplY3QuCiAgICAgKiBU\naGVzZSB3aWxsIHR5cGljYWxseSBiZSB0aGUgcHJpbWFyeSBrZXkgY29sdW1u\ncyBvciB0aGUgY29sdW1ucyB0aGlzCiAgICAgKiBjbGFzcyB1c2VzIHRvIGxp\nbmsgdG8gaXRzIHN1cGVyY2xhc3MgdGFibGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFByaW1hcnlLZXlDb2x1bW5zKENvbHVtbltdIGNvbHMpIHsK\nICAgICAgICBpZiAoY29scyA9PSBudWxsKQogICAgICAgICAgICBjb2xzID0g\nU2NoZW1hcy5FTVBUWV9DT0xVTU5TOwogICAgICAgIF9jb2xzID0gY29sczsK\nICAgIH0KCiAgICAvKioKICAgICAqIEkvTyBpbmZvcm1hdGlvbiBvbiB0aGUg\na2V5IGNvbHVtbnMgLyBqb2luIGtleS4KICAgICAqLwogICAgcHVibGljIENv\nbHVtbklPIGdldENvbHVtbklPKCkgewogICAgICAgIHJldHVybiAoX2lvID09\nIG51bGwpID8gQ29sdW1uSU8uVU5SRVNUUklDVEVEIDogX2lvOwogICAgfQoK\nICAgIC8qKgogICAgICogSS9PIGluZm9ybWF0aW9uIG9uIHRoZSBrZXkgY29s\ndW1ucyAvIGpvaW4ga2V5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRD\nb2x1bW5JTyhDb2x1bW5JTyBpbykgewogICAgICAgIF9pbyA9IGlvOwogICAg\nfQoKICAgIC8qKgogICAgICogRm9yZWlnbiBrZXkgbGlua2luZyB0aGUgcHJp\nbWFyeSBrZXkgY29sdW1ucyB0byB0aGUgc3VwZXJjbGFzcyB0YWJsZSwKICAg\nICAqIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIEZvcmVp\nZ25LZXkgZ2V0Sm9pbkZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJuIF9m\nazsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcmVpZ24ga2V5IGxpbmtpbmcg\ndGhlIHByaW1hcnkga2V5IGNvbHVtbnMgdG8gdGhlIHN1cGVyY2xhc3MgdGFi\nbGUsCiAgICAgKiBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEpvaW5Gb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAg\nICAgICBfZmsgPSBmazsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWZTY2hl\nbWFDb21wb25lbnRzKCkgewogICAgICAgIGlmIChnZXRFbWJlZGRpbmdNZXRh\nRGF0YSgpID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF90YWJsZSAhPSBu\ndWxsICYmIF90YWJsZS5nZXRQcmltYXJ5S2V5KCkgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF90YWJsZS5nZXRQcmltYXJ5S2V5KCkucmVmKCk7CiAgICAg\nICAgICAgIGlmIChfZmsgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9may5y\nZWYoKTsKICAgICAgICAgICAgQ29sdW1uW10gcGtzID0gZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBw\na3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBwa3NbaV0ucmVmKCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10g\nZmllbGRzID0gZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGZpZWxkc1tpXS5yZWZTY2hlbWFDb21wb25lbnRzKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgbWFwcGluZyBpbmZv\ncm1hdGlvbiwgaW5jbHVkaW5nIHN0cmF0ZWd5LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjbGVhck1hcHBpbmcoKSB7CiAgICAgICAgX3N0cmF0ZWd5ID0g\nbnVsbDsKICAgICAgICBfY29scyA9IFNjaGVtYXMuRU1QVFlfQ09MVU1OUzsK\nICAgICAgICBfZmsgPSBudWxsOwogICAgICAgIF90YWJsZSA9IG51bGw7CiAg\nICAgICAgX2luZm8uY2xlYXIoKTsKICAgICAgICBzZXRSZXNvbHZlKE1PREVf\nTUFQUElORyB8IE1PREVfTUFQUElOR19JTklULCBmYWxzZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBVcGRhdGUge0BsaW5rIE1hcHBpbmdJbmZvfSB3aXRo\nIG91ciBjdXJyZW50IG1hcHBpbmcgaW5mb3JtYXRpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHN5bmNNYXBwaW5nSW5mbygpIHsKICAgICAgICBpZiAo\nZ2V0RW1iZWRkaW5nTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAgICBf\naW5mby5zeW5jV2l0aCh0aGlzKTsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgX2luZm8uY2xlYXIoKTsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10g\nZmllbGRzID0gZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGZpZWxkc1tpXS5zeW5jTWFwcGluZ0luZm8oKTsKICAgICAgICB9\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTWV0\nYURhdGEgaW50ZXJmYWNlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgcHJvdGVjdGVkIHZvaWQgc2V0RGVzY3JpYmVkVHlwZShDbGFzcyB0eXBl\nKSB7CiAgICAgICAgc3VwZXIuc2V0RGVzY3JpYmVkVHlwZSh0eXBlKTsKICAg\nICAgICAvLyB0aGlzIG1ldGhvZCBjYWxsZWQgZnJvbSBzdXBlcmNsYXNzIGNv\nbnN0cnVjdG9yLCBzbyBfaW5mbyBub3QgeWV0CiAgICAgICAgLy8gaW5pdGlh\nbGl6ZWQKICAgICAgICBpZiAoX2luZm8gIT0gbnVsbCkKICAgICAgICAgICAg\nX2luZm8uc2V0Q2xhc3NOYW1lKHR5cGUuZ2V0TmFtZSgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBzdWJjbGFzcyBmZXRjaCBtb2RlLCBhcyBvbmUg\nb2YgdGhlIGVhZ2VyIGNvbnN0YW50cyBpbgogICAgICoge0BsaW5rIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb259LgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndFN1YmNsYXNzRmV0Y2hNb2RlKCkgewogICAgICAgIGlmIChfc3ViY2xhc3NN\nb2RlID09IEludGVnZXIuTUFYX1ZBTFVFKSB7CiAgICAgICAgICAgIGlmIChn\nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N1\nYmNsYXNzTW9kZSA9IGdldFBDU3VwZXJjbGFzc01hcHBpbmcoKS4KICAgICAg\nICAgICAgICAgICAgICBnZXRTdWJjbGFzc0ZldGNoTW9kZSgpOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfc3ViY2xhc3NNb2RlID0gRmV0\nY2hDb25maWd1cmF0aW9uLkRFRkFVTFQ7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfc3ViY2xhc3NNb2RlOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIHN1YmNsYXNzIGZldGNoIG1vZGUsIGFzIG9uZSBvZiB0aGUgZWFnZXIgY29u\nc3RhbnRzIGluCiAgICAgKiB7QGxpbmsgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbn0uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFN1YmNsYXNzRmV0Y2hN\nb2RlKGludCBtb2RlKSB7CiAgICAgICAgX3N1YmNsYXNzTW9kZSA9IG1vZGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8g\ncGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRh\nI2dldFJlcG9zaXRvcnl9LgogICAgICovCiAgICBwdWJsaWMgTWFwcGluZ1Jl\ncG9zaXRvcnkgZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKSB7CiAgICAgICAgcmV0\ndXJuIChNYXBwaW5nUmVwb3NpdG9yeSkgZ2V0UmVwb3NpdG9yeSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZv\ncm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXRF\nbWJlZGRpbmdNZXRhRGF0YX0KICAgICAqLwogICAgcHVibGljIFZhbHVlTWFw\ncGluZyBnZXRFbWJlZGRpbmdNYXBwaW5nKCkgewogICAgICAgIHJldHVybiAo\nVmFsdWVNYXBwaW5nKSBnZXRFbWJlZGRpbmdNZXRhRGF0YSgpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgY2xhc3MgZG9l\ncyBub3QgdXNlIHRoZSAibm9uZSIgc3RyYXRlZ3kgKGluY2x1ZGluZwogICAg\nICogaWYgaXQgaGFzIGEgbnVsbCBzdHJhdGVneSwgYW5kIHRoZXJlZm9yZSBp\ncyBwcm9iYWJseSBpbiB0aGUgcHJvY2VzcyBvZgogICAgICogYmVpbmcgbWFw\ncGVkKS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNNYXBwZWQoKSB7\nCiAgICAgICAgaWYgKCFzdXBlci5pc01hcHBlZCgpKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9zdHJhdGVneSAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gX3N0cmF0ZWd5ICE9IE5vbmVDbGFzc1N0cmF0\nZWd5LmdldEluc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuICFOb25lQ2xhc3NT\ndHJhdGVneS5BTElBUy5lcXVhbHMoX2luZm8uZ2V0U3RyYXRlZ3koKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVy\nZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhfS4KICAgICAqLwogICAgcHVibGljIENs\nYXNzTWFwcGluZyBnZXRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgewogICAgICAg\nIHJldHVybiAoQ2xhc3NNYXBwaW5nKSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9k\nIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NNZXRh\nRGF0YSNnZXRNYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0YX0uCiAgICAgKi8K\nICAgIHB1YmxpYyBDbGFzc01hcHBpbmcgZ2V0TWFwcGVkUENTdXBlcmNsYXNz\nTWFwcGluZygpIHsKICAgICAgICByZXR1cm4gKENsYXNzTWFwcGluZykgZ2V0\nTWFwcGVkUENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgbmVhcmVzdCBtYXBwZWQgc3VwZXJjbGFzcyB0\naGF0IGNhbiBqb2luIHRvIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDbGFzc01hcHBpbmcgZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCkgewogICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBnZXRNYXBwZWRQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHN1cCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoX2ZrICE9IG51\nbGwgfHwgX3RhYmxlID09IG51bGwgfHwgX3RhYmxlLmVxdWFscyhzdXAuZ2V0\nVGFibGUoKSkpCiAgICAgICAgICAgIHJldHVybiBzdXA7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBt\nZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFz\nc01ldGFEYXRhI2dldFBDU3ViY2xhc3NNZXRhRGF0YXN9LgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3NNYXBwaW5nW10gZ2V0UENTdWJjbGFzc01hcHBpbmdz\nKCkgewogICAgICAgIHJldHVybiAoQ2xhc3NNYXBwaW5nW10pIGdldFBDU3Vi\nY2xhc3NNZXRhRGF0YXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\nbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0Bs\naW5rIENsYXNzTWV0YURhdGEjZ2V0TWFwcGVkUENTdWJjbGFzc01ldGFEYXRh\nc30uCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc01hcHBpbmdbXSBnZXRNYXBw\nZWRQQ1N1YmNsYXNzTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChDbGFz\nc01hcHBpbmdbXSkgZ2V0TWFwcGVkUENTdWJjbGFzc01ldGFEYXRhcygpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIG1hcHBlZCBzdWJjbGFzc2Vz\nIHRoYXQgYXJlIHJlYWNoYWJsZSB2aWEgam9pbnMuCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzc01hcHBpbmdbXSBnZXRKb2luYWJsZVBDU3ViY2xhc3NNYXBw\naW5ncygpIHsKICAgICAgICBDbGFzc01hcHBpbmdbXSBzdWJzID0gZ2V0TWFw\ncGVkUENTdWJjbGFzc01hcHBpbmdzKCk7IC8vIGNoZWNrcyBmb3IgbmV3CiAg\nICAgICAgaWYgKF9qb2luU3ViTWFwcyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChzdWJzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgX2pvaW5T\ndWJNYXBzID0gc3ViczsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICBMaXN0IGpvaW5hYmxlID0gbmV3IEFycmF5TGlzdChzdWJzLmxlbmd0\naCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3ViSm9p\nbmFibGUoc3Vic1tpXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5h\nYmxlLmFkZChzdWJzW2ldKTsKICAgICAgICAgICAgICAgIF9qb2luU3ViTWFw\ncyA9IChDbGFzc01hcHBpbmdbXSkgam9pbmFibGUudG9BcnJheQogICAgICAg\nICAgICAgICAgICAgIChuZXcgQ2xhc3NNYXBwaW5nW2pvaW5hYmxlLnNpemUo\nKV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBf\nam9pblN1Yk1hcHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB3ZSBjYW4gcmVhY2ggdGhlIGdpdmVuIHN1YmNsYXNzIHZpYSBqb2lu\ncy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzU3ViSm9pbmFibGUo\nQ2xhc3NNYXBwaW5nIHN1YikgewogICAgICAgIGlmIChzdWIgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChzdWIgPT0g\ndGhpcykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJu\nIGlzU3ViSm9pbmFibGUoc3ViLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFw\ncGluZygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGNs\nb3Nlc3QtZGVyaXZlZCBsaXN0IG9mIG5vbi1pbnRlci1qb2luYWJsZSBtYXBw\nZWQgdHlwZXMKICAgICAqIGFzc2lnbmFibGUgdG8gdGhpcyB0eXBlLiBNYXkg\ncmV0dXJuIHRoaXMgbWFwcGluZy4KICAgICAqLwogICAgcHVibGljIENsYXNz\nTWFwcGluZ1tdIGdldEluZGVwZW5kZW50QXNzaWduYWJsZU1hcHBpbmdzKCkg\newogICAgICAgIENsYXNzTWFwcGluZ1tdIHN1YnMgPSBnZXRNYXBwZWRQQ1N1\nYmNsYXNzTWFwcGluZ3MoKTsgLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBp\nZiAoX2Fzc2lnbk1hcHMgPT0gbnVsbCkgewogICAgICAgICAgICAvLyByZW1v\ndmUgdW5tYXBwZWQgc3VicwogICAgICAgICAgICBpZiAoc3Vicy5sZW5ndGgg\nPT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGlzTWFwcGVkKCkpCiAgICAg\nICAgICAgICAgICAgICAgX2Fzc2lnbk1hcHMgPSBuZXcgQ2xhc3NNYXBwaW5n\nW117IHRoaXMgfTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBfYXNzaWduTWFwcyA9IHN1YnM7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZSA9IChpbnQpIChzdWJzLmxl\nbmd0aCAqIDEuMzMgKyAyKTsKICAgICAgICAgICAgICAgIFNldCBpbmRlcGVu\nZGVudCA9IG5ldyBMaW5rZWRIYXNoU2V0KHNpemUpOwogICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGVkKCkpCiAgICAgICAgICAgICAgICAgICAgaW5kZXBl\nbmRlbnQuYWRkKHRoaXMpOwogICAgICAgICAgICAgICAgaW5kZXBlbmRlbnQu\nYWRkQWxsKEFycmF5cy5hc0xpc3Qoc3VicykpOwoKICAgICAgICAgICAgICAg\nIC8vIHJlbW92ZSBhbGwgbWFwcGluZ3MgdGhhdCBoYXZlIGEgc3VwZXJjbGFz\ncyBtYXBwaW5nIGluIHRoZSBzZXQKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBtYXAsIHN1cDsKICAgICAgICAgICAgICAgIExpc3QgY2xlYXIgPSBu\ndWxsOwogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBpbmRl\ncGVuZGVudC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgICAgIG1hcCA9IChDbGFzc01hcHBpbmcpIGl0ci5uZXh0KCk7\nCiAgICAgICAgICAgICAgICAgICAgc3VwID0gbWFwLmdldEpvaW5hYmxlUENT\ndXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAgICAgICAgICAgIGlmIChz\ndXAgIT0gbnVsbCAmJiBpbmRlcGVuZGVudC5jb250YWlucyhzdXApKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChjbGVhciA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXIgPSBuZXcgQXJyYXlMaXN0\nKGluZGVwZW5kZW50LnNpemUoKSAtIDEpOwogICAgICAgICAgICAgICAgICAg\nICAgICBjbGVhci5hZGQobWFwKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY2xlYXIgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBpbmRlcGVuZGVudC5yZW1vdmVB\nbGwoY2xlYXIpOwoKICAgICAgICAgICAgICAgIF9hc3NpZ25NYXBzID0gKENs\nYXNzTWFwcGluZ1tdKSBpbmRlcGVuZGVudC50b0FycmF5CiAgICAgICAgICAg\nICAgICAgICAgKG5ldyBDbGFzc01hcHBpbmdbaW5kZXBlbmRlbnQuc2l6ZSgp\nXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9h\nc3NpZ25NYXBzOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tIHtAbGluayBDbGFzc01ldGFE\nYXRhI2dldEZpZWxkc30uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBp\nbmdbXSBnZXRGaWVsZE1hcHBpbmdzKCkgewogICAgICAgIHJldHVybiAoRmll\nbGRNYXBwaW5nW10pIGdldEZpZWxkcygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAg\nICAgKiB7QGxpbmsgQ2xhc3NNZXRhRGF0YSNnZXREZWNsYXJlZEZpZWxkc30u\nCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBnZXREZWNsYXJl\nZEZpZWxkTWFwcGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIChGaWVsZE1hcHBp\nbmdbXSkgZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJmb3JtIGNhc3QgZnJvbQog\nICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0UHJpbWFyeUtleUZpZWxk\nc30uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdbXSBnZXRQcmlt\nYXJ5S2V5RmllbGRNYXBwaW5ncygpIHsKICAgICAgICByZXR1cm4gKEZpZWxk\nTWFwcGluZ1tdKSBnZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0\nIGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldFZlcnNpb25G\naWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmcgZ2V0VmVy\nc2lvbkZpZWxkTWFwcGluZygpIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFw\ncGluZykgZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAg\nICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldERlZmF1bHRGZXRjaEdyb3Vw\nRmllbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZ1tdIGdl\ndERlZmF1bHRGZXRjaEdyb3VwRmllbGRNYXBwaW5ncygpIHsKICAgICAgICBy\nZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWZhdWx0RmV0Y2hHcm91cEZp\nZWxkcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0\naG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7QGxpbmsgQ2xhc3NN\nZXRhRGF0YSNnZXREZWZpbmVkRmllbGRzfS4KICAgICAqLwogICAgcHVibGlj\nIEZpZWxkTWFwcGluZ1tdIGdldERlZmluZWRGaWVsZE1hcHBpbmdzKCkgewog\nICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdldERlZmluZWRGaWVs\nZHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhv\nZCB0byBwZXJmb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0\nYURhdGEjZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXJ9LgogICAgICovCiAgICBw\ndWJsaWMgRmllbGRNYXBwaW5nW10gZ2V0RmllbGRNYXBwaW5nc0luTGlzdGlu\nZ09yZGVyKCkgewogICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdl\ndEZpZWxkc0luTGlzdGluZ09yZGVyKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20KICAg\nICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldERlZmluZWRGaWVsZHNJbkxp\nc3RpbmdPcmRlcn0uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBpbmdb\nXSBnZXREZWZpbmVkRmllbGRNYXBwaW5nc0luTGlzdGluZ09yZGVyKCkgewog\nICAgICAgIHJldHVybiAoRmllbGRNYXBwaW5nW10pIGdldERlZmluZWRGaWVs\nZHNJbkxpc3RpbmdPcmRlcigpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tIHtAbGluayBD\nbGFzc01ldGFEYXRhI2dldEZpZWxkfS4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWFwcGluZyBnZXRGaWVsZE1hcHBpbmcoaW50IGluZGV4KSB7CiAgICAg\nICAgcmV0dXJuIChGaWVsZE1hcHBpbmcpIGdldEZpZWxkKGluZGV4KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBwZXJm\nb3JtIGNhc3QgZnJvbQogICAgICoge0BsaW5rIENsYXNzTWV0YURhdGEjZ2V0\nRGVjbGFyZWRGaWVsZH0uCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1hcHBp\nbmcgZ2V0RGVjbGFyZWRGaWVsZE1hcHBpbmcoaW50IGluZGV4KSB7CiAgICAg\nICAgcmV0dXJuIChGaWVsZE1hcHBpbmcpIGdldERlY2xhcmVkRmllbGQoaW5k\nZXgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9k\nIHRvIHBlcmZvcm0gY2FzdCBmcm9tIHtAbGluayBDbGFzc01ldGFEYXRhI2dl\ndEZpZWxkfS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBnZXRG\naWVsZE1hcHBpbmcoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gKEZp\nZWxkTWFwcGluZykgZ2V0RmllbGQobmFtZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBjYXN0IGZyb20K\nICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldERlY2xhcmVkRmllbGR9\nLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGdldERlY2xhcmVk\nRmllbGRNYXBwaW5nKFN0cmluZyBuYW1lKSB7CiAgICAgICAgcmV0dXJuIChG\naWVsZE1hcHBpbmcpIGdldERlY2xhcmVkRmllbGQobmFtZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2QgdG8gcGVyZm9ybSBj\nYXN0IGZyb20KICAgICAqIHtAbGluayBDbGFzc01ldGFEYXRhI2dldERlY2xh\ncmVkVW5tYW5hZ2VkRmllbGRzfS4KICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWFwcGluZ1tdIGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRNYXBwaW5ncygp\nIHsKICAgICAgICByZXR1cm4gKEZpZWxkTWFwcGluZ1tdKSBnZXREZWNsYXJl\nZFVubWFuYWdlZEZpZWxkcygpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\ndmVuaWVuY2UgbWV0aG9kIHRvIHBlcmZvcm0gY2FzdCBmcm9tCiAgICAgKiB7\nQGxpbmsgQ2xhc3NNZXRhRGF0YSNhZGREZWNsYXJlZEZpZWxkfS4KICAgICAq\nLwogICAgcHVibGljIEZpZWxkTWFwcGluZyBhZGREZWNsYXJlZEZpZWxkTWFw\ncGluZyhTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSkgewogICAgICAgIHJldHVy\nbiAoRmllbGRNYXBwaW5nKSBhZGREZWNsYXJlZEZpZWxkKG5hbWUsIHR5cGUp\nOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHJlc29sdmVNYXBwaW5nKGJv\nb2xlYW4gcnVudGltZSkgewogICAgICAgIHN1cGVyLnJlc29sdmVNYXBwaW5n\nKHJ1bnRpbWUpOwoKICAgICAgICAvLyBtYXAgY2xhc3Mgc3RyYXRlZ3k7IGl0\nIG1heSBhbHJlYWR5IGJlIG1hcHBlZCBieSB0aGUgcmVwb3NpdG9yeSBiZWZv\ncmUKICAgICAgICAvLyB0aGUgcmVzb2x2ZSBwcm9jZXNzIGJlZ2lucwogICAg\nICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gZ2V0TWFwcGluZ1JlcG9z\naXRvcnkoKTsKICAgICAgICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAg\nICAgICAgIHJlcG9zLmdldFN0cmF0ZWd5SW5zdGFsbGVyKCkuaW5zdGFsbFN0\ncmF0ZWd5KHRoaXMpOwogICAgICAgIExvZyBsb2cgPSBnZXRSZXBvc2l0b3J5\nKCkuZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoInN0cmF0ZWd5Iiwg\ndGhpcywgX3N0cmF0ZWd5LmdldEFsaWFzKCkpKTsKCiAgICAgICAgLy8gbWFr\nZSBzdXJlIHVubWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzIGFyZSBkZWZpbmVk\nIGlmIHdlJ3JlIG1hcHBlZDsKICAgICAgICAvLyBhbHNvIG1heSBoYXZlIGJl\nZW4gZG9uZSBieSByZXBvc2l0b3J5IGFscmVhZHkKICAgICAgICBkZWZpbmVT\ndXBlcmNsYXNzRmllbGRzKGdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGlu\nZygpID09IG51bGwpOwoKICAgICAgICAvLyByZXNvbHZlIGV2ZXJ5dGhpbmcg\ndGhhdCBkb2Vzbid0IHJlbHkgb24gYW55IHJlbGF0aW9ucyB0byBhdm9pZAog\nICAgICAgIC8vIHJlY3Vyc2lvbiwgdGhlbiByZXNvbHZlIGFsbCBmaWVsZHMK\nICAgICAgICByZXNvbHZlTm9uUmVsYXRpb25NYXBwaW5ncygpOwogICAgICAg\nIEZpZWxkTWFwcGluZ1tdIGZtcyA9IGdldEZpZWxkTWFwcGluZ3MoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAoZm1zW2ldLmdldERlZmluaW5nTWV0YURhdGEoKSA9\nPSB0aGlzKSB7CiAgICAgICAgICAgICAgICBib29sZWFuIGZpbGwgPQogICAg\nICAgICAgICAgICAgICAgIGdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFw\ncGluZ0RlZmF1bHRzKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmRlZmF1\nbHRNaXNzaW5nSW5mbygpOwogICAgICAgICAgICAgICAgRm9yZWlnbktleSBm\nayA9IGZtc1tpXS5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgICAgICAgICBp\nZiAoZmlsbCAmJiBmayAhPSBudWxsICYmIAogICAgICAgICAgICAgICAgICAg\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID09IDApIHsgCiAg\nICAgICAgICAgICAgICAgICAgLy8gc2V0IHJlc29sdmUgbW9kZSB0byBmb3Jj\nZSB0aGlzIGZpZWxkIG1hcHBpbmcgdG8gYmUgCiAgICAgICAgICAgICAgICAg\nICAgLy8gcmVzb2x2ZWQgYWdhaW4uIFRoZSBuZWVkIHRvIHJlc29sdmUgYWdh\naW4gb2NjdXJzIHdoZW4gCiAgICAgICAgICAgICAgICAgICAgLy8gYSBwcmlt\nYXJ5IGtleSBpcyBhIHJlbGF0aW9uIGZpZWxkIHdpdGggdGhlIGZvcmVpZ24g\na2V5CiAgICAgICAgICAgICAgICAgICAgLy8gYW5ub3RhdGlvbi4gSW4gdGhp\ncyBzaXR1YXRpb24sIHRoaXMgcHJpbWFyeSBrZXkgZmllbGQKICAgICAgICAg\nICAgICAgICAgICAvLyBtYXBwaW5nIGlzIHJlc29sdmVkIGR1cmluZyB0aGUg\nY2FsbCB0byAKICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZlTm9uUmVs\nYXRpb25NYXBwaW5nLiBTaW5jZSBpdCBpcyBhIHJlbGF0aW9uCiAgICAgICAg\nICAgICAgICAgICAgLy8gZmllbGQsIHRoZSBmb3JlaWduIGtleSB3aWxsIGJl\nIGNvbnN0cnVjdGVkLiBIb3dldmVyLCAKICAgICAgICAgICAgICAgICAgICAv\nLyB0aGUgcHJpbWFyeSBrZXkgb2YgdGhlIHBhcmVudCBlbnRpdHkgbWF5IG5v\ndCBoYXZlIGJlZW4gCiAgICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZWQg\neWV0LCByZXN1bHRpbmcgaW4gbWlzc2luZyBpbmZvcm1haXRvbiBpbiB0aGUg\nZmsKICAgICAgICAgICAgICAgICAgICBmbXNbaV0uc2V0UmVzb2x2ZShNT0RF\nX01FVEEpOwogICAgICAgICAgICAgICAgICAgIGZtc1tpXS5nZXRTdHJhdGVn\neSgpLm1hcChmYWxzZSk7CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAg\nICAgICB9ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm1zW2ld\nLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBmbXMgPSBnZXREZWNsYXJlZFVubWFuYWdlZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgZm1zW2ldLnJlc29sdmUoTU9ERV9NQVBQ\nSU5HKTsKCiAgICAgICAgLy8gbWFyayBtYXBwZWQgY29sdW1ucwogICAgICAg\nIGlmIChfY29scyAhPSBudWxsKSB7CiAgICAgICAgICAgIENvbHVtbklPIGlv\nID0gZ2V0Q29sdW1uSU8oKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBfY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGlvLmlzSW5zZXJ0YWJsZShpLCBmYWxzZSkpCiAgICAgICAgICAgICAgICAg\nICAgX2NvbHNbaV0uc2V0RmxhZyhDb2x1bW4uRkxBR19ESVJFQ1RfSU5TRVJU\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChpby5pc1VwZGF0YWJsZShp\nLCBmYWxzZSkpCiAgICAgICAgICAgICAgICAgICAgX2NvbHNbaV0uc2V0Rmxh\nZyhDb2x1bW4uRkxBR19ESVJFQ1RfVVBEQVRFLCB0cnVlKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICAvLyBvbmNlIGNvbHVtbnMgYXJlIHJl\nc29sdmVkLCByZXNvbHZlIHVuaXF1ZSBjb25zdHJhaW50cyBhcyB0aGV5IG5l\nZWQKICAgICAgICAvLyB0aGUgY29sdW1ucyBiZSByZXNvbHZlZCAKICAgICAg\nICBfaW5mby5nZXRVbmlxdWVzKHRoaXMsIHRydWUpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFJlc29sdmUgbm9uLXJlbGF0aW9uIGZpZWxkIG1hcHBp\nbmdzIHNvIHRoYXQgd2hlbiB3ZSBkbyByZWxhdGlvbgogICAgICogbWFwcGlu\nZ3MgdGhleSBjYW4gcmVseSBvbiB0aGVtIGZvciBqb2lucy4KICAgICAqLwog\nICAgdm9pZCByZXNvbHZlTm9uUmVsYXRpb25NYXBwaW5ncygpIHsKICAgICAg\nICAvLyBtYWtlIHN1cmUgcHJpbWFyeSBrZXkgZmllbGRzIGFyZSByZXNvbHZl\nZCBmaXJzdCBiZWNhdXNlIG90aGVyCiAgICAgICAgLy8gZmllbGRzIG1pZ2h0\nIHJlbHkgb24gdGhlbQogICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IGdl\ndFByaW1hcnlLZXlGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGZtc1tp\nXS5yZXNvbHZlKE1PREVfTUFQUElORyk7CgogICAgICAgIC8vIHJlc29sdmUg\nZGVmaW5lZCBmaWVsZHMgdGhhdCBhcmUgc2FmZTsgdGhhdCBkb24ndCByZWx5\nIG9uIG90aGVyIHR5cGVzCiAgICAgICAgLy8gYWxzbyBiZWluZyByZXNvbHZl\nZC4gIGRvbid0IHVzZSBnZXREZWZpbmVkRmllbGRzIGIvYyBpdCByZWxpZXMg\nb24KICAgICAgICAvLyB3aGV0aGVyIGZpZWxkcyBhcmUgbWFwcGVkLCB3aGlj\naCBpc24ndCBrbm93biB5ZXQKICAgICAgICBmbXMgPSBnZXRGaWVsZE1hcHBp\nbmdzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIGlmIChmbXNbaV0uZ2V0RGVmaW5pbmdNZXRh\nRGF0YSgpID09IHRoaXMKICAgICAgICAgICAgICAgICYmICFmbXNbaV0uaXNU\neXBlUEMoKSAmJiAhZm1zW2ldLmdldEtleSgpLmlzVHlwZVBDKCkKICAgICAg\nICAgICAgICAgICYmICFmbXNbaV0uZ2V0RWxlbWVudCgpLmlzVHlwZVBDKCkp\nCiAgICAgICAgICAgICAgICBmbXNbaV0ucmVzb2x2ZShNT0RFX01BUFBJTkcp\nOwoKICAgICAgICBfZGlzY3JpbS5yZXNvbHZlKE1PREVfTUFQUElORyk7CiAg\nICAgICAgX3ZlcnNpb24ucmVzb2x2ZShNT0RFX01BUFBJTkcpOyAgICAgICAg\nCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgaW5pdGlhbGl6ZU1hcHBpbmco\nKSB7CiAgICAgICAgc3VwZXIuaW5pdGlhbGl6ZU1hcHBpbmcoKTsKCiAgICAg\nICAgRmllbGRNYXBwaW5nW10gZmllbGRzID0gZ2V0RGVmaW5lZEZpZWxkTWFw\ncGluZ3MoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgZmllbGRzW2ldLnJlc29sdmUoTU9E\nRV9NQVBQSU5HX0lOSVQpOwogICAgICAgIF9kaXNjcmltLnJlc29sdmUoTU9E\nRV9NQVBQSU5HX0lOSVQpOwogICAgICAgIF92ZXJzaW9uLnJlc29sdmUoTU9E\nRV9NQVBQSU5HX0lOSVQpOwogICAgICAgIF9zdHJhdGVneS5pbml0aWFsaXpl\nKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZWZpbmVkRmll\nbGRDYWNoZSgpIHsKICAgICAgICAvLyBqdXN0IG1ha2UgdGhpcyBtZXRob2Qg\nYXZhaWxhYmxlIHRvIG90aGVyIGNsYXNzZXMgaW4gdGhpcyBwYWNrYWdlCiAg\nICAgICAgc3VwZXIuY2xlYXJEZWZpbmVkRmllbGRDYWNoZSgpOwogICAgfQoK\nICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyU3ViY2xhc3NDYWNoZSgpIHsKICAg\nICAgICBzdXBlci5jbGVhclN1YmNsYXNzQ2FjaGUoKTsKICAgICAgICBfam9p\nblN1Yk1hcHMgPSBudWxsOwogICAgICAgIF9hc3NpZ25NYXBzID0gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb3B5KENsYXNzTWV0YURhdGEgY2xz\nKSB7CiAgICAgICAgc3VwZXIuY29weShjbHMpOwogICAgICAgIGlmIChfc3Vi\nY2xhc3NNb2RlID09IEludGVnZXIuTUFYX1ZBTFVFKQogICAgICAgICAgICBf\nc3ViY2xhc3NNb2RlID0gKChDbGFzc01hcHBpbmcpIGNscykuZ2V0U3ViY2xh\nc3NGZXRjaE1vZGUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiB2\nYWxpZGF0ZURhdGFTdG9yZUV4dGVuc2lvblByZWZpeChTdHJpbmcgcHJlZml4\nKSB7CiAgICAgICAgcmV0dXJuICJqZGJjLSIuZXF1YWxzKHByZWZpeCk7CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIENsYXNzU3RyYXRlZ3kgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIFN0cmluZyBn\nZXRBbGlhcygpIHsKICAgICAgICByZXR1cm4gYXNzZXJ0U3RyYXRlZ3koKS5n\nZXRBbGlhcygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIG1hcChib29sZWFu\nIGFkYXB0KSB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5tYXAoYWRhcHQp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxpemUoKSB7CiAgICAg\nICAgYXNzZXJ0U3RyYXRlZ3koKS5pbml0aWFsaXplKCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpE\nQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJhdGVneSgpLmluc2Vy\ndChzbSwgc3RvcmUsIHJtKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB1cGRh\ndGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBS\nb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIGFzc2VydFN0cmF0ZWd5KCkudXBkYXRlKHNtLCBzdG9yZSwgcm0p\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYXNzZXJ0U3Ry\nYXRlZ3koKS5kZWxldGUoc20sIHN0b3JlLCBybSk7CiAgICB9CgogICAgcHVi\nbGljIEJvb2xlYW4gaXNDdXN0b21JbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbSwgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIGFzc2Vy\ndFN0cmF0ZWd5KCkuaXNDdXN0b21JbnNlcnQoc20sIHN0b3JlKTsKICAgIH0K\nCiAgICBwdWJsaWMgQm9vbGVhbiBpc0N1c3RvbVVwZGF0ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1\ncm4gYXNzZXJ0U3RyYXRlZ3koKS5pc0N1c3RvbVVwZGF0ZShzbSwgc3RvcmUp\nOwogICAgfQoKICAgIHB1YmxpYyBCb29sZWFuIGlzQ3VzdG9tRGVsZXRlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkgewogICAg\nICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmlzQ3VzdG9tRGVsZXRlKHNt\nLCBzdG9yZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgY3VzdG9tSW5zZXJ0\nKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSkKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRTdHJh\ndGVneSgpLmN1c3RvbUluc2VydChzbSwgc3RvcmUpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGN1c3RvbVVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNt\nLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgYXNzZXJ0U3RyYXRlZ3koKS5jdXN0b21VcGRhdGUoc20s\nIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjdXN0b21EZWxldGUo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGFzc2VydFN0cmF0\nZWd5KCkuY3VzdG9tRGVsZXRlKHNtLCBzdG9yZSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0Q2xhc3NNYXBwaW5nKENsYXNzTWFwcGluZyBvd25lcikg\newogICAgICAgIGFzc2VydFN0cmF0ZWd5KCkuc2V0Q2xhc3NNYXBwaW5nKG93\nbmVyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1ByaW1hcnlLZXlP\nYmplY3RJZChib29sZWFuIGhhc0FsbCkgewogICAgICAgIHJldHVybiBhc3Nl\ncnRTdHJhdGVneSgpLmlzUHJpbWFyeUtleU9iamVjdElkKGhhc0FsbCk7CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIGpvaW5TdXBlcmNsYXNzKEpvaW5zIGpv\naW5zLCBib29sZWFuIHRvVGhpcykgewogICAgICAgIHJldHVybiBhc3NlcnRT\ndHJhdGVneSgpLmpvaW5TdXBlcmNsYXNzKGpvaW5zLCB0b1RoaXMpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRWFnZXJTZWxlY3QoU2Vs\nZWN0IHNlbCwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwKICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIENsYXNzTWFwcGluZyBiYXNlLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0\nZWd5KCkuc3VwcG9ydHNFYWdlclNlbGVjdChzZWwsIHNtLCBzdG9yZSwgYmFz\nZSwKICAgICAgICAgICAgZmV0Y2gpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1\nbHRPYmplY3RQcm92aWRlciBjdXN0b21Mb2FkKEpEQkNTdG9yZSBzdG9yZSwg\nYm9vbGVhbiBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIGxvbmcgc3RhcnRJZHgsIGxvbmcgZW5kSWR4KQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBhc3Nl\ncnRTdHJhdGVneSgpLmN1c3RvbUxvYWQoc3RvcmUsIHN1YmNsYXNzZXMsIGZl\ndGNoLAogICAgICAgICAgICBzdGFydElkeCwgZW5kSWR4KTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBjdXN0b21Mb2FkKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBQQ1N0YXRlIHN0YXRl\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNlcHRpb24gewogICAg\nICAgIHJldHVybiBhc3NlcnRTdHJhdGVneSgpLmN1c3RvbUxvYWQoc20sIHN0\nb3JlLCBzdGF0ZSwgZmV0Y2gpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGN1c3RvbUxvYWQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3Jl\nIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIFJlc3VsdCByZXN1bHQpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGFzc2VydFN0cmF0ZWd5KCkuY3VzdG9tTG9hZChz\nbSwgc3RvcmUsIGZldGNoLCByZXN1bHQpOwogICAgfQogICAgCiAgICBwcml2\nYXRlIENsYXNzU3RyYXRlZ3kgYXNzZXJ0U3RyYXRlZ3koKSB7CiAgICAgICAg\naWYgKF9zdHJhdGVneSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24oKTsKICAgICAgICByZXR1cm4gX3N0cmF0ZWd5\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEZpbmQgdGhlIGZpZWxkIG1h\ncHBpbmdzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgZ2l2ZW4gY29sdW1ucy4K\nICAgICAqIAogICAgICogQHJldHVybiBudWxsIGlmIG5vIGNvbHVtbnMgYXJl\nIGdpdmVuIG9yIG5vIGZpZWxkIG1hcHBpbmcgdXNlcyB0aGUgZ2l2ZW4KICAg\nICAqIGNvbHVtbnMuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxGaWVsZE1h\ncHBpbmc+IGdldEZpZWxkTWFwcGluZ3MoQ29sdW1uW10gY29scywgYm9vbGVh\nbiBwcmltZSkgewogICAgCWlmIChjb2xzID09IG51bGwgfHwgY29scy5sZW5n\ndGggPT0gMCkKICAgIAkJcmV0dXJuIG51bGw7CiAgICAJTGlzdDxGaWVsZE1h\ncHBpbmc+IHJlc3VsdCA9IG51bGw7CiAgICAJZm9yIChDb2x1bW4gYyA6IGNv\nbHMpIHsKICAgIAkJTGlzdDxGaWVsZE1hcHBpbmc+IGZtcyA9IGhhc0NvbHVt\nbihjLCBwcmltZSk7CiAgICAJCWlmIChmbXMgPT0gbnVsbCkgY29udGludWU7\nCgkJCWlmIChyZXN1bHQgPT0gbnVsbCkKCQkJCXJlc3VsdCA9IG5ldyBBcnJh\neUxpc3Q8RmllbGRNYXBwaW5nPigpOwoJCQlmb3IgKEZpZWxkTWFwcGluZyBm\nbSA6IGZtcykKCQkJCWlmICghcmVzdWx0LmNvbnRhaW5zKGZtKSkKCQkJCQly\nZXN1bHQuYWRkKGZtKTsKICAgIAl9CiAgICAJcmV0dXJuIHJlc3VsdDsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBMb29rcyB1cCBpbiByZXZlcnNlIHRv\nIGZpbmQgdGhlIGxpc3Qgb2YgZmllbGQgbWFwcGluZ3MgdGhhdCBpbmNsdWRl\nIHRoZQogICAgICogZ2l2ZW4gY29sdW1uLiBDb3N0bHkuCiAgICAgKiAKICAg\nICAqIEByZXR1cm4gbnVsbCBpZiBubyBmaWVsZCBtYXBwaW5ncyBjYXJyeSB0\naGlzIGNvbHVtbi4gCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxGaWVsZE1h\ncHBpbmc+IGhhc0NvbHVtbihDb2x1bW4gYywgYm9vbGVhbiBwcmltZSkgewog\nICAgCUxpc3Q8RmllbGRNYXBwaW5nPiByZXN1bHQgPSBudWxsOwogICAgCUZp\nZWxkTWFwcGluZ1tdIGZtcyA9IChwcmltZSkgPyAKICAgIAkJZ2V0UHJpbWFy\neUtleUZpZWxkTWFwcGluZ3MoKSA6IGdldEZpZWxkTWFwcGluZ3MoKTsKICAg\nIAlmb3IgKEZpZWxkTWFwcGluZyBmbSA6IGZtcykgewogICAgCQlDb2x1bW5b\nXSBjb2xzID0gZm0uZ2V0Q29sdW1ucygpOwogICAgCQlpZiAoY29udGFpbnMo\nY29scywgYykpIHsKICAgIAkJCWlmIChyZXN1bHQgPT0gbnVsbCkKICAgIAkJ\nCQlyZXN1bHQgPSBuZXcgQXJyYXlMaXN0PEZpZWxkTWFwcGluZz4oKTsKICAg\nIAkJCXJlc3VsdC5hZGQoZm0pOwogICAgCQl9CiAgICAJfQogICAgCXJldHVy\nbiByZXN1bHQ7CiAgICB9CiAgICAKICAgIGJvb2xlYW4gY29udGFpbnMoQ29s\ndW1uW10gY29scywgQ29sdW1uIGMpIHsKICAgIAlmb3IgKENvbHVtbiBjb2wg\nOiBjb2xzKQogICAgCQlpZiAoY29sID09IGMpCiAgICAJCQlyZXR1cm4gdHJ1\nZTsKICAgIAlyZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogR2V0cyB0aGUgZmllbGQgdmFsdWVzIG9mIHRoZSBnaXZlbiBpbnN0YW5j\nZSBmb3IgdGhlIGdpdmVuIGNvbHVtbnMuCiAgICAgKiBUaGUgZ2l2ZW4gY29s\ndW1ucyBhcmUgdXNlZCB0byBpZGVudGlmeSB0aGUgZmllbGRzIGJ5IGEgcmV2\nZXJzZSBsb29rdXAuCiAgICAgKiAgCiAgICAgKiBAcmV0dXJuIGEgc2luZ2xl\nIG9iamVjdCBvciBhbiBhcnJheSBvZiBvYmplY3RzIGJhc2VkIG9uIG51bWJl\nciBvZiAKICAgICAqIGZpZWxkcyB0aGUgZ2l2ZW4gY29sdW1ucyByZXByZXNl\nbnQuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGdldFZhbHVlRnJvbVVu\nbWFuYWdlZEluc3RhbmNlKE9iamVjdCBvYmosIENvbHVtbltdIGNvbHMsIAog\nICAgCQlib29sZWFuIHByaW1lKSB7CiAgICAJTGlzdDxGaWVsZE1hcHBpbmc+\nIGZtcyA9IGdldEZpZWxkTWFwcGluZ3MoY29scywgcHJpbWUpOwogICAgCWlm\nIChmbXMgPT0gbnVsbCkKICAgIAkJcmV0dXJuIG51bGw7CiAgICAJaWYgKGZt\ncy5zaXplKCkgPT0gMSkKICAgIAkJcmV0dXJuIFJlZmxlY3Rpb24uZ2V0VmFs\ndWUob2JqLCBmbXMuZ2V0KDApLmdldE5hbWUoKSwgdHJ1ZSk7CiAgICAJT2Jq\nZWN0W10gcmVzdWx0ID0gbmV3IE9iamVjdFtmbXMuc2l6ZSgpXTsKICAgIAlp\nbnQgaSA9IDA7CiAgICAJZm9yIChGaWVsZE1hcHBpbmcgZm0gOiBmbXMpIHsK\nICAgIAkJcmVzdWx0W2krK10gPSBSZWZsZWN0aW9uLmdldFZhbHVlKG9iaiwg\nZm0uZ2V0TmFtZSgpLCB0cnVlKTsKICAgIAl9CiAgICAJcmV0dXJuIHJlc3Vs\ndDsKICAgIH0KfQo=\n","encoding":"base64"}

