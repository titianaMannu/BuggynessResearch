{"sha":"fca07397ed24d48bd4b90dac89711aaf1acf34f6","node_id":"MDQ6QmxvYjIwNjM2NDpmY2EwNzM5N2VkMjRkNDhiZDRiOTBkYWM4OTcxMWFhZjFhY2YzNGY2","size":13618,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/fca07397ed24d48bd4b90dac89711aaf1acf34f6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWE7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hR3JvdXA7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIueG1sLkNvbW1lbnRh\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFDb250\nZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2Vy\nRXhjZXB0aW9uOwoKLyoqCiAqIEluZm9ybWF0aW9uIGFib3V0IHRoZSBtYXBw\naW5nIGZyb20gYSBmaWVsZCB0byB0aGUgc2NoZW1hLCBpbiByYXcgZm9ybS4K\nICogVGhlIGNvbHVtbnMgYW5kIHRhYmxlcyB1c2VkIGluIG1hcHBpbmcgaW5m\nbyB3aWxsIG5vdCBiZSBwYXJ0IG9mIHRoZQogKiB7QGxpbmsgU2NoZW1hR3Jv\ndXB9IHVzZWQgYXQgcnVudGltZS4gUmF0aGVyLCB0aGV5IHdpbGwgYmUgc3Ry\ndWN0cwogKiB3aXRoIHRoZSByZWxldmFudCBwaWVjZXMgb2YgaW5mb3JtYXRp\nb24gZmlsbGVkIGluLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAYXV0\naG9yIFBpbmFraSBQb2RkYXIKICovCnB1YmxpYyBjbGFzcyBGaWVsZE1hcHBp\nbmdJbmZvCiAgICBleHRlbmRzIE1hcHBpbmdJbmZvCiAgICBpbXBsZW1lbnRz\nIENvbW1lbnRhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2Nh\nbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKEZp\nZWxkTWFwcGluZ0luZm8uY2xhc3MpOwoKICAgIHByaXZhdGUgU3RyaW5nIF90\nYWJsZU5hbWUgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9vdXRlciA9\nIGZhbHNlOwogICAgcHJpdmF0ZSBDb2x1bW4gX29yZGVyQ29sID0gbnVsbDsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfY2FuT3JkZXJDb2wgPSB0cnVlOwogICAg\ncHJpdmF0ZSBTdHJpbmdbXSBfY29tbWVudHMgPSBudWxsOwogICAgcHJpdmF0\nZSBMaXN0PFVuaXF1ZT4gX2pvaW5UYWJsZVVuaXF1ZXM7IC8vIFVuaXF1ZSBj\nb25zdHJhaW50cyBvbiB0aGUgSm9pblRhYmxlCgogICAgLyoqCiAgICAgKiBU\naGUgdXNlci1zdXBwbGllZCBuYW1lIG9mIHRoZSB0YWJsZSBmb3IgdGhpcyBm\naWVsZC4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRUYWJsZU5hbWUo\nKSB7CiAgICAgICAgcmV0dXJuIF90YWJsZU5hbWU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgdXNlci1zdXBwbGllZCBuYW1lIG9mIHRoZSB0YWJsZSBm\nb3IgdGhpcyBmaWVsZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGFi\nbGVOYW1lKFN0cmluZyB0YWJsZU5hbWUpIHsKICAgICAgICBfdGFibGVOYW1l\nID0gdGFibGVOYW1lOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0\naGUgZmllbGQncyB0YWJsZSBpcyBqb2luZWQgdG8gdGhlIGNsYXNzIHRhYmxl\nIHRocm91Z2ggYW4KICAgICAqIG91dGVyIGpvaW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzSm9pbk91dGVyKCkgewogICAgICAgIHJldHVybiBf\nb3V0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBmaWVs\nZCdzIHRhYmxlIGlzIGpvaW5lZCB0byB0aGUgY2xhc3MgdGFibGUgdGhyb3Vn\naCBhbgogICAgICogb3V0ZXIgam9pbi4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0Sm9pbk91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICBfb3V0\nZXIgPSBvdXRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBzeW50aGV0\naWMgb3JkZXJpbmcgY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgQ29sdW1u\nIGdldE9yZGVyQ29sdW1uKCkgewogICAgICAgIHJldHVybiBfb3JkZXJDb2w7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSYXcgc3ludGhldGljIG9yZGVyaW5n\nIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0T3JkZXJDb2x1\nbW4oQ29sdW1uIG9yZGVyKSB7CiAgICAgICAgX29yZGVyQ29sID0gb3JkZXI7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHdlIGNhbiBoYXZlIGFu\nIG9yZGVyaW5nIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\nY2FuT3JkZXJDb2x1bW4oKSB7CiAgICAgICAgcmV0dXJuIF9jYW5PcmRlckNv\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgd2UgY2FuIGhhdmUg\nYW4gb3JkZXJpbmcgY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRDYW5PcmRlckNvbHVtbihib29sZWFuIGNhbk9yZGVyKSB7CiAgICAgICAg\nX2Nhbk9yZGVyQ29sID0gY2FuT3JkZXI7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHRhYmxlIGZvciB0aGUgZ2l2ZW4gZmllbGQsIG9yIG51\nbGwgaWYgbm8gdGFibGUgZ2l2ZW4uCiAgICAgKi8KICAgIHB1YmxpYyBUYWJs\nZSBnZXRUYWJsZShmaW5hbCBGaWVsZE1hcHBpbmcgZmllbGQsIGJvb2xlYW4g\nY3JlYXRlLAogICAgICAgIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBpZiAo\nX3RhYmxlTmFtZSA9PSBudWxsICYmICFjcmVhdGUpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBUYWJsZSB0YWJsZSA9IGZpZWxkLmdldERl\nZmluaW5nTWFwcGluZygpLmdldFRhYmxlKCk7CiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUgPSAodGFibGUgPT0gbnVsbCkgPyBudWxsIAogICAgICAgICAg\nICA6IHRhYmxlLmdldFNjaGVtYSgpLmdldE5hbWUoKTsKCiAgICAgICAgLy8g\naWYgd2UgaGF2ZSBubyBqb2luIGNvbHVtbnMgZGVmaW5lZCwgdGhlcmUgbWF5\nIGJlIGNsYXNzLWxldmVsIGpvaW4KICAgICAgICAvLyBpbmZvcm1hdGlvbiB3\naXRoIGEgbW9yZSBmdWxseS1xdWFsaWZpZWQgbmFtZSBmb3Igb3VyIHRhYmxl\nCiAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSA9IF90YWJsZU5hbWU7CiAgICAg\nICAgaWYgKHRhYmxlTmFtZSAhPSBudWxsICYmIGdldENvbHVtbnMoKS5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHRhYmxlTmFtZSA9IGZpZWxkLmdldERlZmlu\naW5nTWFwcGluZygpLmdldE1hcHBpbmdJbmZvKCkuCiAgICAgICAgICAgICAg\nICBnZXRTZWNvbmRhcnlUYWJsZU5hbWUodGFibGVOYW1lKTsKCiAgICAgICAg\ncmV0dXJuIGNyZWF0ZVRhYmxlKGZpZWxkLCBuZXcgVGFibGVEZWZhdWx0cygp\nIHsKICAgICAgICAgICAgcHVibGljIFN0cmluZyBnZXQoU2NoZW1hIHNjaGVt\nYSkgewogICAgICAgICAgICAgICAgLy8gZGVsYXkgdGhpcyBzbyB0aGF0IHdl\nIGRvbid0IGRvIHNjaGVtYSByZWZsZWN0aW9uIGZvciB1bmlxdWUKICAgICAg\nICAgICAgICAgIC8vIHRhYmxlIG5hbWUgdW5sZXNzIG5lY2Vzc2FyeQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmdldE1hcHBpbmdSZXBvc2l0b3J5\nKCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0VGFibGVOYW1lKGZpZWxkLCBzY2hlbWEpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSwgc2NoZW1hTmFtZSwgdGFibGVOYW1lLCBhZGFwdCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGpvaW4gZnJvbSB0aGUgZmll\nbGQgdGFibGUgdG8gdGhlIG93bmluZyBjbGFzcyB0YWJsZS4KICAgICAqLwog\nICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0Sm9pbihmaW5hbCBGaWVsZE1hcHBp\nbmcgZmllbGQsIFRhYmxlIHRhYmxlLAogICAgICAgIGJvb2xlYW4gYWRhcHQp\nIHsKICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vIGpvaW4gY29sdW1ucyBkZWZp\nbmVkLCBjaGVjayBjbGFzcy1sZXZlbCBqb2luCiAgICAgICAgTGlzdCBjb2xz\nID0gZ2V0Q29sdW1ucygpOwogICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgY29scyA9IGZpZWxkLmdldERlZmluaW5nTWFwcGluZygp\nLmdldE1hcHBpbmdJbmZvKCkuCiAgICAgICAgICAgICAgICBnZXRTZWNvbmRh\ncnlUYWJsZUpvaW5Db2x1bW5zKF90YWJsZU5hbWUpOwoKICAgICAgICBGb3Jl\naWduS2V5RGVmYXVsdHMgZGVmID0gbmV3IEZvcmVpZ25LZXlEZWZhdWx0cygp\nIHsKICAgICAgICAgICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0KFRhYmxlIGxv\nY2FsLCBUYWJsZSBmb3JlaWduLCBib29sZWFuIGludmVyc2UpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRNYXBwaW5nUmVwb3NpdG9yeSgp\nLmdldE1hcHBpbmdEZWZhdWx0cygpLgogICAgICAgICAgICAgICAgICAgIGdl\ndEpvaW5Gb3JlaWduS2V5KGZpZWxkLCBsb2NhbCwgZm9yZWlnbik7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBvcHVsYXRlKFRh\nYmxlIGxvY2FsLCBUYWJsZSBmb3JlaWduLCBDb2x1bW4gY29sLAogICAgICAg\nICAgICAgICAgT2JqZWN0IHRhcmdldCwgYm9vbGVhbiBpbnZlcnNlLCBpbnQg\ncG9zLCBpbnQgY29scykgewogICAgICAgICAgICAgICAgZmllbGQuZ2V0TWFw\ncGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAg\nICAgICAgICAgICAgICBwb3B1bGF0ZUpvaW5Db2x1bW4oZmllbGQsIGxvY2Fs\nLCBmb3JlaWduLCBjb2wsIHRhcmdldCwKICAgICAgICAgICAgICAgICAgICAg\nICAgcG9zLCBjb2xzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIGNscyA9IGZpZWxkLmdldERlZmluaW5nTWFwcGlu\nZygpOwogICAgICAgIHJldHVybiBjcmVhdGVGb3JlaWduS2V5KGZpZWxkLCAi\nam9pbiIsIGNvbHMsIGRlZiwgdGFibGUsIGNscywgY2xzLAogICAgICAgICAg\nICBmYWxzZSwgYWRhcHQpOwogICAgfQoKICAgIC8qKgogICAgICogVW5pcXVl\nIGNvbnN0cmFpbnQgb24gdGhlIGZpZWxkIGpvaW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBVbmlxdWUgZ2V0Sm9pblVuaXF1ZShGaWVsZE1hcHBpbmcgZmllbGQs\nIGJvb2xlYW4gZGVmLAogICAgICAgIGJvb2xlYW4gYWRhcHQpIHsKICAgICAg\nICBGb3JlaWduS2V5IGZrID0gZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKTsK\nICAgICAgICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIFVuaXF1ZSB1bnEgPSBudWxsOwogICAgICAgIGlmIChm\nay5nZXRDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgdW5xID0g\nZmllbGQuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVs\ndHMoKS4KICAgICAgICAgICAgICAgIGdldEpvaW5VbmlxdWUoZmllbGQsIGZr\nLmdldFRhYmxlKCksIGZrLmdldENvbHVtbnMoKSk7CiAgICAgICAgcmV0dXJu\nIGNyZWF0ZVVuaXF1ZShmaWVsZCwgImpvaW4iLCB1bnEsIGZrLmdldENvbHVt\nbnMoKSwgYWRhcHQpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFkZCBV\nbmlxdWUgQ29uc3RyYWludCB0byB0aGUgSm9pbiBUYWJsZS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgYWRkSm9pblRhYmxlVW5pcXVlKFVuaXF1ZSB1KSB7\nCiAgICAJaWYgKF9qb2luVGFibGVVbmlxdWVzID09IG51bGwpCiAgICAJCV9q\nb2luVGFibGVVbmlxdWVzID0gbmV3IEFycmF5TGlzdDxVbmlxdWU+KCk7CiAg\nICAJX2pvaW5UYWJsZVVuaXF1ZXMuYWRkKHUpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEdldCB0aGUgdW5pcXVlIGNvbnN0cmFpbnRzIGFzc29jaWF0\nZWQgd2l0aCB0aGUgU2VxdWVuY2UgdGFibGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBVbmlxdWVbXSBnZXRKb2luVGFibGVVbmlxdWVzKEZpZWxkTWFwcGluZyBm\naWVsZCwgYm9vbGVhbiBkZWYsIAogICAgCQlib29sZWFuIGFkYXB0KSB7CiAg\nICAgICAgcmV0dXJuIGdldFVuaXF1ZXMoZmllbGQsIF9qb2luVGFibGVVbmlx\ndWVzLCBkZWYsIGFkYXB0KTsKICAgIH0gICAKICAgIAogICAgcHJpdmF0ZSBV\nbmlxdWVbXSBnZXRVbmlxdWVzKEZpZWxkTWFwcGluZyBmaWVsZCwgTGlzdDxV\nbmlxdWU+IHVuaXF1ZXMsIAogICAgCQlib29sZWFuIGRlZiwgYm9vbGVhbiBh\nZGFwdCkgewogICAgICAgIGlmICh1bmlxdWVzID09IG51bGwgfHwgdW5pcXVl\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgVW5pcXVlWzBd\nOwogICAgICAgIENvbGxlY3Rpb248VW5pcXVlPiByZXN1bHQgPSBuZXcgQXJy\nYXlMaXN0PFVuaXF1ZT4oKTsKICAgICAgICBmb3IgKFVuaXF1ZSB0ZW1wbGF0\nZSA6IHVuaXF1ZXMpIHsKICAgICAgICAgICAgQ29sdW1uW10gdGVtcGxhdGVD\nb2x1bW5zID0gdGVtcGxhdGUuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICBD\nb2x1bW5bXSB1bmlxdWVDb2x1bW5zID0gbmV3IENvbHVtblt0ZW1wbGF0ZUNv\nbHVtbnMubGVuZ3RoXTsKICAgICAgICAgICAgVGFibGUgdGFibGUgPSBnZXRU\nYWJsZShmaWVsZCwgdHJ1ZSwgYWRhcHQpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpPTA7IGk8dW5pcXVlQ29sdW1ucy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgU3RyaW5nIGNvbHVtbk5hbWUgPSB0ZW1wbGF0ZUNvbHVtbnNb\naV0uZ2V0TmFtZSgpOwogICAgICAgICAgICAgICAgQ29sdW1uIHVuaXF1ZUNv\nbHVtbiA9IHRhYmxlLmdldENvbHVtbihjb2x1bW5OYW1lKTsKICAgICAgICAg\nICAgICAgIHVuaXF1ZUNvbHVtbnNbaV0gPSB1bmlxdWVDb2x1bW47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgVW5pcXVlIHVuaXF1ZSA9IGNyZWF0ZVVu\naXF1ZShmaWVsZCwgInVuaXF1ZSIsIHRlbXBsYXRlLCAgCiAgICAgICAgICAg\nICAgICB1bmlxdWVDb2x1bW5zLCBhZGFwdCk7CiAgICAgICAgICAgIGlmICh1\nbmlxdWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGQodW5p\ncXVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdC50b0FycmF5\nKG5ldyBVbmlxdWVbcmVzdWx0LnNpemUoKV0pOwogICAgfSAgIAogICAgCiAg\nIC8qKgogICAgICogSW5kZXggb24gdGhlIGZpZWxkIGpvaW4uCiAgICAgKi8K\nICAgIHB1YmxpYyBJbmRleCBnZXRKb2luSW5kZXgoRmllbGRNYXBwaW5nIGZp\nZWxkLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgRm9yZWlnbktleSBmayA9\nIGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZrID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBJbmRl\neCBpZHggPSBudWxsOwogICAgICAgIGlmIChmay5nZXRDb2x1bW5zKCkubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgaWR4ID0gZmllbGQuZ2V0TWFwcGluZ1Jl\ncG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAgICAg\nICAgIGdldEpvaW5JbmRleChmaWVsZCwgZmsuZ2V0VGFibGUoKSwgZmsuZ2V0\nQ29sdW1ucygpKTsKICAgICAgICByZXR1cm4gY3JlYXRlSW5kZXgoZmllbGQs\nICJqb2luIiwgaWR4LCBmay5nZXRDb2x1bW5zKCksIGFkYXB0KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgb3JkZXJpbmcgY29sdW1uIGZv\nciB0aGlzIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2x1bW4gZ2V0T3JkZXJDb2x1bW4oRmllbGRNYXBwaW5nIGZpZWxk\nLCBUYWJsZSB0YWJsZSwKICAgICAgICBib29sZWFuIGFkYXB0KSB7CiAgICAg\nICAgaWYgKF9vcmRlckNvbCAhPSBudWxsICYmIGZpZWxkLmdldE9yZGVyRGVj\nbGFyYXRpb24oKSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm9yZGVyLWNvbmZsaWN0IiwgZmll\nbGQpKTsKCiAgICAgICAgLy8gcmVzZXQgSU8KICAgICAgICBzZXRDb2x1bW5J\nTyhudWxsKTsKCiAgICAgICAgLy8gaGFzIHVzZXIgaGFzIGV4cGxpY2l0bHkg\ndHVybmVkIG9yZGVyaW5nIG9mZj8KICAgICAgICBpZiAoIV9jYW5PcmRlckNv\nbCB8fCBmaWVsZC5nZXRPcmRlckRlY2xhcmF0aW9uKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGlmIG5vIGRlZmF1\nbHRzIHJldHVybiBudWxsCiAgICAgICAgTWFwcGluZ0RlZmF1bHRzIGRlZiA9\nIGZpZWxkLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgIGdl\ndE1hcHBpbmdEZWZhdWx0cygpOwogICAgICAgIGlmIChfb3JkZXJDb2wgPT0g\nbnVsbCAmJiAoIWFkYXB0ICYmICFkZWYuZGVmYXVsdE1pc3NpbmdJbmZvKCkp\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29sdW1uIHRt\ncGxhdGUgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgdG1wbGF0ZS5zZXROYW1l\nKCJvcmRyIik7CiAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlw\nZXMuSU5UKTsKICAgICAgICBpZiAoIWRlZi5wb3B1bGF0ZU9yZGVyQ29sdW1u\ncyhmaWVsZCwgdGFibGUsIG5ldyBDb2x1bW5bXXsgdG1wbGF0ZSB9KQogICAg\nICAgICAgICAmJiBfb3JkZXJDb2wgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIGlmIChfb3JkZXJDb2wgIT0gbnVsbCAmJiAo\nX29yZGVyQ29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKQog\nICAgICAgICAgICB8fCBfb3JkZXJDb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19V\nTlVQREFUQUJMRSkpKSB7CiAgICAgICAgICAgIENvbHVtbklPIGlvID0gbmV3\nIENvbHVtbklPKCk7CiAgICAgICAgICAgIGlvLnNldEluc2VydGFibGUoMCwg\nIV9vcmRlckNvbC5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJMRSkp\nOwogICAgICAgICAgICBpby5zZXRVcGRhdGFibGUoMCwgIV9vcmRlckNvbC5n\nZXRGbGFnKENvbHVtbi5GTEFHX1VOVVBEQVRBQkxFKSk7CiAgICAgICAgICAg\nIHNldENvbHVtbklPKGlvKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBt\nZXJnZUNvbHVtbihmaWVsZCwgIm9yZGVyIiwgdG1wbGF0ZSwgdHJ1ZSwgX29y\nZGVyQ29sLCB0YWJsZSwKICAgICAgICAgICAgYWRhcHQsIGRlZi5kZWZhdWx0\nTWlzc2luZ0luZm8oKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jaHJv\nbml6ZSBpbnRlcm5hbCBpbmZvcm1hdGlvbiB3aXRoIHRoZSBtYXBwaW5nIGRh\ndGEgZm9yIHRoZSBnaXZlbgogICAgICogZmllbGQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHN5bmNXaXRoKEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAg\nICAgIGNsZWFyKGZhbHNlKTsKCiAgICAgICAgaWYgKGZpZWxkLmdldEpvaW5G\nb3JlaWduS2V5KCkgIT0gbnVsbCkKICAgICAgICAgICAgX3RhYmxlTmFtZSA9\nIGZpZWxkLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0REJEaWN0aW9uYXJ5\nKCkuCiAgICAgICAgICAgICAgICBnZXRGdWxsTmFtZShmaWVsZC5nZXRUYWJs\nZSgpLCB0cnVlKTsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIGRlZiA9IGZpZWxk\nLmdldERlZmluaW5nTWFwcGluZygpOwogICAgICAgIHNldENvbHVtbklPKGZp\nZWxkLmdldEpvaW5Db2x1bW5JTygpKTsKICAgICAgICBpZiAoZmllbGQuZ2V0\nSm9pbkZvcmVpZ25LZXkoKSAhPSBudWxsICYmIGRlZi5nZXRUYWJsZSgpICE9\nIG51bGwpCiAgICAgICAgICAgIHN5bmNGb3JlaWduS2V5KGZpZWxkLCBmaWVs\nZC5nZXRKb2luRm9yZWlnbktleSgpLAogICAgICAgICAgICAgICAgZmllbGQu\nZ2V0VGFibGUoKSwgZGVmLmdldFRhYmxlKCkpOwogICAgICAgIF9vdXRlciA9\nIGZpZWxkLmlzSm9pbk91dGVyKCk7CgogICAgICAgIHN5bmNJbmRleChmaWVs\nZCwgZmllbGQuZ2V0Sm9pbkluZGV4KCkpOwogICAgICAgIHN5bmNVbmlxdWUo\nZmllbGQsIGZpZWxkLmdldEpvaW5VbmlxdWUoKSk7CiAgICAgICAgc3luY0pv\naW5UYWJsZVVuaXF1ZXMoZmllbGQsIGZpZWxkLmdldEpvaW5UYWJsZVVuaXF1\nZXMoKSk7CiAgICAgICAgc3luY09yZGVyQ29sdW1uKGZpZWxkKTsKICAgICAg\nICBzeW5jU3RyYXRlZ3koZmllbGQpOwogICAgfQoKICAgIC8qKgogICAgICog\nU3luY2hyb25pemUgaW50ZXJuYWwgbWFwcGluZyBzdHJhdGVneSBpbmZvcm1h\ndGlvbiB3aXRoIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc3luY1N0cmF0ZWd5KEZpZWxkTWFwcGluZyBmaWVsZCkgewogICAg\nICAgIHNldFN0cmF0ZWd5KG51bGwpOwogICAgICAgIGlmIChmaWVsZC5nZXRI\nYW5kbGVyKCkgIT0gbnVsbCB8fCBmaWVsZC5nZXRTdHJhdGVneSgpID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZXhwbGljaXQg\nc3RyYXRlZ3kgaWYgdGhlIHN0cmF0ZWd5IGlzbid0IHRoZSBleHBlY3RlZCBk\nZWZhdWx0CiAgICAgICAgU3RyYXRlZ3kgc3RyYXQgPSBmaWVsZC5nZXRNYXBw\naW5nUmVwb3NpdG9yeSgpLmRlZmF1bHRTdHJhdGVneQogICAgICAgICAgICAo\nZmllbGQsIGZhbHNlKTsKICAgICAgICBpZiAoc3RyYXQgPT0gbnVsbCB8fCAh\nc3RyYXQuZ2V0QWxpYXMoKS5lcXVhbHMoZmllbGQuZ2V0QWxpYXMoKSkpCiAg\nICAgICAgICAgIHNldFN0cmF0ZWd5KGZpZWxkLmdldEFsaWFzKCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogU3luY2hyb25pemUgaW50ZXJuYWwgb3JkZXIg\nY29sdW1uIGluZm9ybWF0aW9uIHdpdGggdGhlIGdpdmVuIGZpZWxkLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzeW5jT3JkZXJDb2x1bW4oRmllbGRNYXBw\naW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKGZpZWxkLmdldE9yZGVyQ29sdW1u\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgX29yZGVyQ29sID0gc3luY0NvbHVt\nbihmaWVsZCwgZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSwgMSwgZmFsc2UsCiAg\nICAgICAgICAgICAgICBmaWVsZC5nZXRUYWJsZSgpLCBudWxsLCBudWxsLCBm\nYWxzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfb3JkZXJDb2wgPSBu\ndWxsOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFNldHMgaW50ZXJuYWwg\nY29uc3RyYWludCBpbmZvcm1hdGlvbiB0byBtYXRjaCBnaXZlbiBtYXBwZWQg\nY29uc3RyYWludC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3luY0pv\naW5UYWJsZVVuaXF1ZXMoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFVuaXF1\nZVtdIHVucXMpIHsKICAgICAgICBpZiAodW5xcyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIF9qb2luVGFibGVVbmlxdWVzID0gbnVsbDsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KICAgICAgICBfam9pblRhYmxlVW5pcXVlcyA9\nIG5ldyBBcnJheUxpc3Q8VW5pcXVlPigpOwogICAgICAgIGZvciAoVW5pcXVl\nIHVuaXF1ZTp1bnFzKSB7CiAgICAgICAgCVVuaXF1ZSBjb3B5ID0gbmV3IFVu\naXF1ZSgpOwogICAgICAgIAljb3B5LnNldE5hbWUodW5pcXVlLmdldE5hbWUo\nKSk7CiAgICAgICAgCWNvcHkuc2V0RGVmZXJyZWQodW5pcXVlLmlzRGVmZXJy\nZWQoKSk7CiAgICAgICAgCV9qb2luVGFibGVVbmlxdWVzLmFkZCh1bmlxdWUp\nOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGJvb2xlYW4gaGFzU2No\nZW1hQ29tcG9uZW50cygpIHsKICAgICAgICByZXR1cm4gc3VwZXIuaGFzU2No\nZW1hQ29tcG9uZW50cygpIHx8IF90YWJsZU5hbWUgIT0gbnVsbAogICAgICAg\nICAgICB8fCBfb3JkZXJDb2wgIT0gbnVsbDsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgdm9pZCBjbGVhcihib29sZWFuIGNhbkZsYWdzKSB7CiAgICAgICAgc3Vw\nZXIuY2xlYXIoY2FuRmxhZ3MpOwogICAgICAgIF90YWJsZU5hbWUgPSBudWxs\nOwogICAgICAgIF9vcmRlckNvbCA9IG51bGw7CiAgICAgICAgaWYgKGNhbkZs\nYWdzKQogICAgICAgICAgICBfY2FuT3JkZXJDb2wgPSB0cnVlOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGNvcHkoTWFwcGluZ0luZm8gaW5mbykgewogICAg\nICAgIHN1cGVyLmNvcHkoaW5mbyk7CiAgICAgICAgaWYgKCEoaW5mbyBpbnN0\nYW5jZW9mIEZpZWxkTWFwcGluZ0luZm8pKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIEZpZWxkTWFwcGluZ0luZm8gZmluZm8gPSAoRmllbGRNYXBw\naW5nSW5mbykgaW5mbzsKICAgICAgICBpZiAoX3RhYmxlTmFtZSA9PSBudWxs\nKQogICAgICAgICAgICBfdGFibGVOYW1lID0gZmluZm8uZ2V0VGFibGVOYW1l\nKCk7CiAgICAgICAgaWYgKCFfb3V0ZXIpCiAgICAgICAgICAgIF9vdXRlciA9\nIGZpbmZvLmlzSm9pbk91dGVyKCk7CiAgICAgICAgaWYgKF9jYW5PcmRlckNv\nbCAmJiBfb3JkZXJDb2wgPT0gbnVsbCkKICAgICAgICAgICAgX2Nhbk9yZGVy\nQ29sID0gZmluZm8uY2FuT3JkZXJDb2x1bW4oKTsKICAgICAgICBpZiAoX2Nh\nbk9yZGVyQ29sICYmIGZpbmZvLmdldE9yZGVyQ29sdW1uKCkgIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoX29yZGVyQ29sID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfb3JkZXJDb2wgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgICAg\nIF9vcmRlckNvbC5jb3B5KGZpbmZvLmdldE9yZGVyQ29sdW1uKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q29tbWVudHMo\nKSB7CiAgICAgICAgcmV0dXJuIChfY29tbWVudHMgPT0gbnVsbCkgPyBFTVBU\nWV9DT01NRU5UUyA6IF9jb21tZW50czsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRDb21tZW50cyhTdHJpbmdbXSBjb21tZW50cykgewogICAgICAgIF9j\nb21tZW50cyA9IGNvbW1lbnRzOwogICAgfQp9Cg==\n","encoding":"base64"}

