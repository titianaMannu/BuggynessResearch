{"sha":"a0937361d1ad9ce7c2d759b457007e0aa037481d","node_id":"MDQ6QmxvYjIwNjM2NDphMDkzNzM2MWQxYWQ5Y2U3YzJkNzU5YjQ1NzAwN2UwYWEwMzc0ODFk","size":66627,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a0937361d1ad9ce7c2d759b457007e0aa037481d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVt\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW5JTzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5G\nb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUNvbnRleHQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsKaW1wb3J0\nIHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEJhc2UgY2xhc3Mgc3Rvcmlu\nZyByYXcgbWFwcGluZyBpbmZvcm1hdGlvbjsgZGVmaW5lcyB1dGlsaXR5IG1l\ndGhvZHMgZm9yCiAqIGNvbnZlcnRpbmcgcmF3IG1hcHBpbmcgaW5mb3JtYXRp\nb24gdG8gZnVsbCBtYXBwaW5nIHRvIHRoZSBzY2hlbWEuCiAqCiAqIEBhdXRo\nb3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgTWFwcGlu\nZ0luZm8KICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBKT0lOX05PTkUgPSAwOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgSk9JTl9GT1JXQVJEID0gMTsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IEpPSU5fSU5WRVJTRSA9IDI7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0IE5VTEwgPSBuZXcgT2JqZWN0KCk7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChNYXBwaW5nSW5mby5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBTdHJpbmcgX3N0cmF0ZWd5ID0gbnVsbDsKICAg\nIHByaXZhdGUgTGlzdCBfY29scyA9IG51bGw7CiAgICBwcml2YXRlIEluZGV4\nIF9pZHggPSBudWxsOwogICAgcHJpdmF0ZSBVbmlxdWUgX3VucSA9IG51bGw7\nCiAgICBwcml2YXRlIEZvcmVpZ25LZXkgX2ZrID0gbnVsbDsKICAgIHByaXZh\ndGUgYm9vbGVhbiBfY2FuSWR4ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfY2FuVW5xID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfY2FuRksg\nPSB0cnVlOwogICAgcHJpdmF0ZSBpbnQgX2pvaW4gPSBKT0lOX05PTkU7CiAg\nICBwcml2YXRlIENvbHVtbklPIF9pbyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBNYXBwaW5nIHN0cmF0ZWd5IG5hbWUuCiAgICAgKi8KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0U3RyYXRlZ3koKSB7CiAgICAgICAgcmV0dXJuIF9zdHJhdGVn\neTsKICAgIH0KCiAgICAvKioKICAgICAqIE1hcHBpbmcgc3RyYXRlZ3kgbmFt\nZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3RyYXRlZ3koU3RyaW5n\nIHN0cmF0ZWd5KSB7CiAgICAgICAgX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSYXcgY29sdW1uIGRhdGEuCiAgICAgKi8K\nICAgIHB1YmxpYyBMaXN0IGdldENvbHVtbnMoKSB7CiAgICAgICAgcmV0dXJu\nIChfY29scyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QgOiBf\nY29sczsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBjb2x1bW4gZGF0YS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Q29sdW1ucyhMaXN0IGNvbHMp\nIHsKICAgICAgICBfY29scyA9IGNvbHM7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgaW5kZXguCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBnZXRJbmRl\neCgpIHsKICAgICAgICByZXR1cm4gX2lkeDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJhdyBpbmRleC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW5k\nZXgoSW5kZXggaWR4KSB7CiAgICAgICAgX2lkeCA9IGlkeDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhw\nbGljaXRseSBub24taW5kZXhhYmxlLgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjYW5JbmRleCgpIHsKICAgICAgICByZXR1cm4gX2NhbklkeDsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMg\nYXMgZXhwbGljaXRseSBub24taW5kZXhhYmxlLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRDYW5JbmRleChib29sZWFuIGluZGV4YWJsZSkgewogICAg\nICAgIF9jYW5JZHggPSBpbmRleGFibGU7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSYXcgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1\nYmxpYyBGb3JlaWduS2V5IGdldEZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0\ndXJuIF9mazsKICAgIH0KCiAgICAvKioKICAgICAqIFJhdyBmb3JlaWduIGtl\neSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Rm9y\nZWlnbktleShGb3JlaWduS2V5IGZrKSB7CiAgICAgICAgX2ZrID0gZms7CiAg\nICAgICAgaWYgKGZrICE9IG51bGwgJiYgX2pvaW4gPT0gSk9JTl9OT05FKQog\nICAgICAgICAgICBfam9pbiA9IEpPSU5fRk9SV0FSRDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSB1c2VyIGNhbiBtYXJrIGNvbHVtbnMgYXMgZXhwbGlj\naXRseSBub3QgaGF2aW5nIGEgZm9yZWlnbiBrZXkuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGNhbkZvcmVpZ25LZXkoKSB7CiAgICAgICAgcmV0dXJu\nIF9jYW5GSzsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB1c2VyIGNhbiBt\nYXJrIGNvbHVtbnMgYXMgZXhwbGljaXRseSBub3QgaGF2aW5nIGEgZm9yZWln\nbiBrZXkuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldENhbkZvcmVpZ25L\nZXkoYm9vbGVhbiBma2FibGUpIHsKICAgICAgICBfY2FuRksgPSBma2FibGU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSYXcgdW5pcXVlIGNvbnN0cmFpbnQg\naW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBVbmlxdWUgZ2V0VW5p\ncXVlKCkgewogICAgICAgIHJldHVybiBfdW5xOwogICAgfQoKICAgIC8qKgog\nICAgICogUmF3IHVuaXF1ZSBjb25zdHJhaW50IGluZm9ybWF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRVbmlxdWUoVW5pcXVlIHVucSkgewog\nICAgICAgIF91bnEgPSB1bnE7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\ndXNlciBjYW4gbWFyayBjb2x1bW5zIGFzIGV4cGxpY2l0bHkgbm90IGhhdmlu\nZyBhIHVuaXF1ZSBjb25zdHJhaW50LgogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiBjYW5VbmlxdWUoKSB7CiAgICAgICAgcmV0dXJuIF9jYW5VbnE7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgdXNlciBjYW4gbWFyayBjb2x1bW5z\nIGFzIGV4cGxpY2l0bHkgbm90IGhhdmluZyBhIHVuaXF1ZSBjb25zdHJhaW50\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRDYW5VbmlxdWUoYm9vbGVh\nbiB1bmlxdWFibGUpIHsKICAgICAgICBfY2FuVW5xID0gdW5pcXVhYmxlOwog\nICAgfQoKICAgIC8qKgogICAgICogSS9PIGZvciB0aGUgY29sdW1ucyBjcmVh\ndGVkIGJ5IHRoZSBsYXN0IGNhbGwgdG8ge0BsaW5rICNjcmVhdGVDb2x1bW5z\nfSwKICAgICAqIG9yIGZvciB0aGUgZm9yZWlnbiBrZXkgY3JlYXRlZCBieSB0\naGUgbGFzdCBjYWxsIHRvCiAgICAgKiB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25L\nZXl9LiBUaGlzIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJlY3Rs\neQogICAgICogcHJpb3IgdG8gY2FsbHMgdG8ge0BsaW5rICNzeW5jQ29sdW1u\nc30gYW5kIHtAbGluayAjc3luY0ZvcmVpZ25LZXl9LgogICAgICovCiAgICBw\ndWJsaWMgQ29sdW1uSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAgcmV0dXJu\nIF9pbzsKICAgIH0KCiAgICAvKioKICAgICAqIEkvTyBmb3IgdGhlIGNvbHVt\nbnMgY3JlYXRlZCBieSB0aGUgbGFzdCBjYWxsIHRvIHtAbGluayAjY3JlYXRl\nQ29sdW1uc30sCiAgICAgKiBvciBmb3IgdGhlIGZvcmVpZ24ga2V5IGNyZWF0\nZWQgYnkgdGhlIGxhc3QgY2FsbCB0bwogICAgICoge0BsaW5rICNjcmVhdGVG\nb3JlaWduS2V5fS4gVGhpcyBpcyBhbHNvIGV4cGVjdGVkIHRvIGJlIHNldCBj\nb3JyZWN0bHkKICAgICAqIHByaW9yIHRvIGNhbGxzIHRvIHtAbGluayAjc3lu\nY0NvbHVtbnN9IGFuZCB7QGxpbmsgI3N5bmNGb3JlaWduS2V5fS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0Q29sdW1uSU8oQ29sdW1uSU8gaW8pIHsK\nICAgICAgICBfaW8gPSBpbzsKICAgIH0KCiAgICAvKioKICAgICAqIERpcmVj\ndGlvbiBvZiB0aGUgam9pbiB0aGF0IHRoZSBjb2x1bW5zIG9mIHRoaXMgbWFw\ncGluZyBpbmZvIGZvcm0uIFRoaXMKICAgICAqIGlzIHVzdWFsbHkgYXV0b21h\ndGljYWxseSBzZXQgYnkge0BsaW5rICNjcmVhdGVGb3JlaWduS2V5fS4gVGhp\ncyBmbGFnCiAgICAgKiBpcyBhbHNvIGV4cGVjdGVkIHRvIGJlIHNldCBjb3Jy\nZWN0bHkgcHJpb3IgdG8gY2FsbHMgdG8KICAgICAqIHtAbGluayAjc3luY0Zv\ncmVpZ25LZXl9IGlmIHRoZSBqb2luIGlzIGludmVyc2VkLgogICAgICovCiAg\nICBwdWJsaWMgaW50IGdldEpvaW5EaXJlY3Rpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF9qb2luOwogICAgfQoKICAgIC8qKgogICAgICogRGlyZWN0aW9uIG9m\nIHRoZSBqb2luIHRoYXQgdGhlIGNvbHVtbnMgb2YgdGhpcyBtYXBwaW5nIGlu\nZm8gZm9ybS4gVGhpcwogICAgICogaXMgdXN1YWxseSBhdXRvbWF0aWNhbGx5\nIHNldCBieSB7QGxpbmsgI2NyZWF0ZUZvcmVpZ25LZXl9LiBUaGlzIGZsYWcK\nICAgICAqIGlzIGFsc28gZXhwZWN0ZWQgdG8gYmUgc2V0IGNvcnJlY3RseSBw\ncmlvciB0byBjYWxscyB0bwogICAgICoge0BsaW5rICNzeW5jRm9yZWlnbktl\neX0gaWYgdGhlIGpvaW4gaXMgaW52ZXJzZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldEpvaW5EaXJlY3Rpb24oaW50IGpvaW4pIHsKICAgICAgICBf\nam9pbiA9IGpvaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwg\nbWFwcGluZyBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7CiAgICAgICAgY2xlYXIodHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDbGVhciBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSBjYW5GbGFncyB3aGV0aGVyIHRvIGNsZWFyIGluZm9ybWF0\naW9uIGFib3V0IHdoZXRoZXIgd2UKICAgICAqIGNhbiBwbGFjZSBpbmRleGVk\nLCBmb3JlaWduIGtleXMsIGV0YyBvbiB0aGlzIG1hcHBpbmcKICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXIoYm9vbGVhbiBjYW5GbGFncykgewog\nICAgICAgIF9zdHJhdGVneSA9IG51bGw7CiAgICAgICAgX2NvbHMgPSBudWxs\nOwogICAgICAgIF9pbyA9IG51bGw7CiAgICAgICAgX2lkeCA9IG51bGw7CiAg\nICAgICAgX3VucSA9IG51bGw7CiAgICAgICAgX2ZrID0gbnVsbDsKICAgICAg\nICBfam9pbiA9IEpPSU5fTk9ORTsKICAgICAgICBpZiAoY2FuRmxhZ3MpIHsK\nICAgICAgICAgICAgX2NhbklkeCA9IHRydWU7CiAgICAgICAgICAgIF9jYW5G\nSyA9IHRydWU7CiAgICAgICAgICAgIF9jYW5VbnEgPSB0cnVlOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgbWlzc2luZyBpbmZvIGZy\nb20gdGhlIGluc3RhbmNlIHRvIHRoaXMgb25lLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjb3B5KE1hcHBpbmdJbmZvIGluZm8pIHsKICAgICAgICBpZiAo\nX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgIF9zdHJhdGVneSA9IGlu\nZm8uZ2V0U3RyYXRlZ3koKTsKICAgICAgICBpZiAoX2NhbklkeCAmJiBfaWR4\nID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKGluZm8uZ2V0SW5kZXgoKSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgX2lkeCA9IGluZm8uZ2V0SW5kZXgo\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2NhbklkeCA9\nIGluZm8uY2FuSW5kZXgoKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9jYW5V\nbnEgJiYgX3VucSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpbmZvLmdl\ndFVuaXF1ZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBfdW5xID0gaW5m\nby5nZXRVbmlxdWUoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgX2NhblVucSA9IGluZm8uY2FuVW5pcXVlKCk7CiAgICAgICAgfQogICAg\nICAgIGlmIChfY2FuRksgJiYgX2ZrID09IG51bGwpIHsKICAgICAgICAgICAg\naWYgKGluZm8uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfZmsgPSBpbmZvLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgX2NhbkZLID0gaW5mby5jYW5Gb3JlaWdu\nS2V5KCk7CiAgICAgICAgfQoKICAgICAgICBMaXN0IGNvbHMgPSBnZXRDb2x1\nbW5zKCk7CiAgICAgICAgTGlzdCBpY29scyA9IGluZm8uZ2V0Q29sdW1ucygp\nOwogICAgICAgIGlmICghaWNvbHMuaXNFbXB0eSgpICYmIChjb2xzLmlzRW1w\ndHkoKQogICAgICAgICAgICB8fCBjb2xzLnNpemUoKSA9PSBpY29scy5zaXpl\nKCkpKSB7CiAgICAgICAgICAgIGlmIChjb2xzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIGNvbHMgPSBuZXcgQXJyYXlMaXN0KGljb2xzLnNpemUoKSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaWNvbHMuc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChjb2xzLnNpemUoKSA9PSBp\nKQogICAgICAgICAgICAgICAgICAgIGNvbHMuYWRkKG5ldyBDb2x1bW4oKSk7\nCiAgICAgICAgICAgICAgICAoKENvbHVtbikgY29scy5nZXQoaSkpLmNvcHko\nKENvbHVtbikgaWNvbHMuZ2V0KGkpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRDb2x1bW5zKGNvbHMpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMgaW5mbyBoYXMgY29sdW1u\ncywgZm9yZWlnbiBrZXkgaW5mb3JtYXRpb24sIGluZGV4CiAgICAgKiBpbmZv\ncm1hdGlvbiwgZXRjLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNT\nY2hlbWFDb21wb25lbnRzKCkgewogICAgICAgIHJldHVybiAoX2NvbHMgIT0g\nbnVsbCAmJiAhX2NvbHMuaXNFbXB0eSgpKQogICAgICAgICAgICB8fCBfaWR4\nICE9IG51bGwKICAgICAgICAgICAgfHwgX3VucSAhPSBudWxsCiAgICAgICAg\nICAgIHx8IF9mayAhPSBudWxsCiAgICAgICAgICAgIHx8ICFfY2FuSWR4CiAg\nICAgICAgICAgIHx8ICFfY2FuRksKICAgICAgICAgICAgfHwgIV9jYW5VbnE7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhhdCB0aGUgdXNlciBk\naWQgbm90IHN1cHBseSBhbnkgY29sdW1ucywgaW5kZXgsIHVuaXF1ZQogICAg\nICogY29uc3RyYWludCwgb3IgZm9yZWlnbiBrZXkgZm9yIHRoaXMgbWFwcGlu\nZy4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNzZXJ0Tm9TY2hlbWFDb21w\nb25lbnRzKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBib29sZWFuIGRpZSkg\newogICAgICAgIGlmIChfY29scyA9PSBudWxsIHx8IF9jb2xzLmlzRW1wdHko\nKSkgewogICAgICAgICAgICBhc3NlcnROb0luZGV4KGNvbnRleHQsIGRpZSk7\nCiAgICAgICAgICAgIGFzc2VydE5vVW5pcXVlKGNvbnRleHQsIGRpZSk7CiAg\nICAgICAgICAgIGFzc2VydE5vRm9yZWlnbktleShjb250ZXh0LCBkaWUpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBNZXNzYWdl\nIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLWNvbHMiLCBjb250ZXh0KTsK\nICAgICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRv\ncnkoKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGlzIGluZm8gaGFzIHRoZSBnaXZlbiBzdHJhdGVn\neSBvciBubyBzdHJhdGVneS4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXNz\nZXJ0U3RyYXRlZ3koTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIE9iamVjdCBj\nb250ZXh0U3RyYXQsCiAgICAgICAgT2JqZWN0IGV4cGVjdGVkLCBib29sZWFu\nIGRpZSkgewogICAgICAgIGlmIChjb250ZXh0U3RyYXQgPT0gZXhwZWN0ZWQp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHN0cmF0Owog\nICAgICAgIGlmIChjb250ZXh0U3RyYXQgPT0gbnVsbCkgewogICAgICAgICAg\nICBpZiAoX3N0cmF0ZWd5ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGlmIChfc3RyYXRlZ3kuZXF1YWxzKGV4cGVjdGVk\nLmdldENsYXNzKCkuZ2V0TmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgaWYgKGV4cGVjdGVkIGluc3RhbmNlb2YgU3RyYXRl\nZ3kKICAgICAgICAgICAgICAgICYmIF9zdHJhdGVneS5lcXVhbHMoKChTdHJh\ndGVneSkgZXhwZWN0ZWQpLmdldEFsaWFzKCkpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICBzdHJhdCA9IF9zdHJhdGVneTsKICAgICAg\nICB9IGVsc2UgaWYgKGNvbnRleHRTdHJhdCBpbnN0YW5jZW9mIFN0cmF0ZWd5\nKQogICAgICAgICAgICBzdHJhdCA9ICgoU3RyYXRlZ3kpIGNvbnRleHRTdHJh\ndCkuZ2V0QWxpYXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0cmF0\nID0gY29udGV4dFN0cmF0LmdldENsYXNzKCkuZ2V0TmFtZSgpOwoKICAgICAg\nICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1bmV4cGVjdGVkLXN0cmF0ZWd5\nIiwgY29udGV4dCwgZXhwZWN0ZWQsCiAgICAgICAgICAgIHN0cmF0KTsKICAg\nICAgICBpZiAoZGllKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24obXNnKTsKICAgICAgICBjb250ZXh0LmdldFJlcG9zaXRvcnko\nKS5nZXRMb2coKS53YXJuKG1zZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NlcnQgdGhhdCB0aGUgdXNlciBkaWQgbm90IHRyeSB0byBwbGFjZSBhbiBp\nbmRleCBvbiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE5vSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIGJvb2xl\nYW4gZGllKSB7CiAgICAgICAgaWYgKF9pZHggPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJ1\nbmV4cGVjdGVkLWluZGV4IiwgY29udGV4dCk7CiAgICAgICAgaWYgKGRpZSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKG1zZyk7\nCiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9nKCkud2Fy\nbihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRoYXQgdGhl\nIHVzZXIgZGlkIG5vdCB0cnkgdG8gcGxhY2UgYSB1bmlxdWUgY29uc3RyYWlu\ndCBvbiB0aGlzCiAgICAgKiBtYXBwaW5nLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnROb1VuaXF1ZShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwg\nYm9vbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX3VucSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2UgbXNnID0gX2xvYy5n\nZXQoInVuZXhwZWN0ZWQtdW5pcXVlIiwgY29udGV4dCk7CiAgICAgICAgaWYg\nKGRpZSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKG1zZyk7CiAgICAgICAgY29udGV4dC5nZXRSZXBvc2l0b3J5KCkuZ2V0TG9n\nKCkud2Fybihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZXJ0IHRo\nYXQgdGhlIHVzZXIgZGlkIG5vdCB0cnkgdG8gcGxhY2UgYSBmb3JlaWduIGtl\neSBvbiB0aGlzIG1hcHBpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFz\nc2VydE5vRm9yZWlnbktleShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgYm9v\nbGVhbiBkaWUpIHsKICAgICAgICBpZiAoX2ZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKCiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgi\ndW5leHBlY3RlZC1mayIsIGNvbnRleHQpOwogICAgICAgIGlmIChkaWUpCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihtc2cpOwog\nICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpLmdldExvZygpLndhcm4o\nbXNnKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSB1\nc2VyIGRpZCBub3QgdHJ5IHRvIGpvaW4uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFzc2VydE5vSm9pbihNZXRhRGF0YUNvbnRleHQgY29udGV4dCwgYm9v\nbGVhbiBkaWUpIHsKICAgICAgICBib29sZWFuIGpvaW4gPSBmYWxzZTsKICAg\nICAgICBpZiAoX2NvbHMgIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1bW4g\nY29sOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgIWpvaW4gJiYgaSA8\nIF9jb2xzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb2wgPSAo\nQ29sdW1uKSBfY29scy5nZXQoaSk7CiAgICAgICAgICAgICAgICBpZiAoY29s\nLmdldFRhcmdldCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgam9p\nbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYg\nKCFqb2luKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQoInVuZXhwZWN0ZWQtam9pbiIsIGNvbnRleHQpOwog\nICAgICAgIGlmIChkaWUpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihtc2cpOwogICAgICAgIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpLndhcm4obXNnKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZpbmQgb3IgZ2VuZXJhdGUgYSB0YWJsZSBmb3IgYSBtYXBwaW5nLgogICAg\nICoKICAgICAqIEBwYXJhbSBjb250ZXh0IHRoZSBtYXBwaW5nIHRoYXQgdXNl\ncyB0aGUgdGFibGUKICAgICAqIEBwYXJhbSBkZWYgZGVmYXVsdCB0YWJsZSBu\nYW1lIHByb3ZpZGVyCiAgICAgKiBAcGFyYW0gc2NoZW1hTmFtZSBkZWZhdWx0\nIHNjaGVtYSBpZiBrbm93biwgb3IgbnVsbAogICAgICogQHBhcmFtIGdpdmVu\nIGdpdmVuIHRhYmxlIG5hbWUKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVy\nIHdlIGNhbiBhbHRlciB0aGUgc2NoZW1hIG9yIG1hcHBpbmdzCiAgICAgKi8K\nICAgIHB1YmxpYyBUYWJsZSBjcmVhdGVUYWJsZShNZXRhRGF0YUNvbnRleHQg\nY29udGV4dCwgVGFibGVEZWZhdWx0cyBkZWYsCiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyBnaXZlbiwgYm9vbGVhbiBhZGFwdCkgewogICAg\nICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0\nb3J5KSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBpZiAoZ2l2\nZW4gPT0gbnVsbCAmJiAoZGVmID09IG51bGwgfHwgKCFhZGFwdAogICAgICAg\nICAgICAmJiAhcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1p\nc3NpbmdJbmZvKCkpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby10YWJsZSIsIGNvbnRleHQpKTsKCiAg\nICAgICAgaWYgKHNjaGVtYU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgc2No\nZW1hTmFtZSA9IFNjaGVtYXMuZ2V0TmV3VGFibGVTY2hlbWEoKEpEQkNDb25m\naWd1cmF0aW9uKQogICAgICAgICAgICAgICAgcmVwb3MuZ2V0Q29uZmlndXJh\ndGlvbigpKTsKCiAgICAgICAgLy8gaWYgbm8gZ2l2ZW4gYW5kIGFkYXB0aW5n\nIG9yIGRlZmF1bHRpbmcgbWlzc2luZyBpbmZvLCB1c2UgdGVtcGxhdGUKICAg\nICAgICBTY2hlbWFHcm91cCBncm91cCA9IHJlcG9zLmdldFNjaGVtYUdyb3Vw\nKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IG51bGw7CiAgICAgICAgaWYg\nKGdpdmVuID09IG51bGwpIHsKICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAu\nZ2V0U2NoZW1hKHNjaGVtYU5hbWUpOwogICAgICAgICAgICBpZiAoc2NoZW1h\nID09IG51bGwpCiAgICAgICAgICAgICAgICBzY2hlbWEgPSBncm91cC5hZGRT\nY2hlbWEoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGdpdmVuID0gZGVmLmdl\ndChzY2hlbWEpOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGZ1bGxOYW1l\nOwogICAgICAgIGludCBkb3RJZHggPSBnaXZlbi5sYXN0SW5kZXhPZignLicp\nOwogICAgICAgIGlmIChkb3RJZHggPT0gLTEpCiAgICAgICAgICAgIGZ1bGxO\nYW1lID0gKHNjaGVtYU5hbWUgPT0gbnVsbCkgPyBnaXZlbiA6IHNjaGVtYU5h\nbWUgKyAiLiIgKyBnaXZlbjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nZnVsbE5hbWUgPSBnaXZlbjsKICAgICAgICAgICAgc2NoZW1hID0gbnVsbDsK\nICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGdpdmVuLnN1YnN0cmluZygwLCBk\nb3RJZHgpOwogICAgICAgICAgICBnaXZlbiA9IGdpdmVuLnN1YnN0cmluZyhk\nb3RJZHggKyAxKTsKICAgICAgICB9CgogICAgICAgIC8vIGxvb2sgZm9yIG5h\nbWVkIHRhYmxlIHVzaW5nIGZ1bGwgbmFtZSBhbmQgZmluZFRhYmxlLCB3aGlj\naCBhbGxvd3MKICAgICAgICAvLyB0aGUgZHluYW1pYyBzY2hlbWEgZmFjdG9y\neSB0byBjcmVhdGUgdGhlIHRhYmxlIGlmIG5lZWRlZAogICAgICAgIFRhYmxl\nIHRhYmxlID0gZ3JvdXAuZmluZFRhYmxlKGZ1bGxOYW1lKTsKICAgICAgICBp\nZiAodGFibGUgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRhYmxlOwog\nICAgICAgIGlmICghYWRhcHQpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXRhYmxlIiwgZ2l2ZW4sIGNv\nbnRleHQpKTsKCiAgICAgICAgLy8gbmFtZWQgdGFibGUgZG9lc24ndCBleGlz\ndDsgY3JlYXRlIGl0CiAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHNjaGVtYSA9IGdyb3VwLmdldFNjaGVtYShzY2hlbWFOYW1l\nKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgc2NoZW1hID0gZ3JvdXAuYWRkU2NoZW1hKHNjaGVtYU5hbWUpOwog\nICAgICAgIH0KICAgICAgICB0YWJsZSA9IHNjaGVtYS5nZXRUYWJsZShnaXZl\nbik7CiAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgIHRh\nYmxlID0gc2NoZW1hLmFkZFRhYmxlKGdpdmVuKTsKICAgICAgICByZXR1cm4g\ndGFibGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZS9jcmVhdGUg\nY29sdW1ucyBvbiB0aGUgZ2l2ZW4gdGFibGUgYnkgbWVyZ2luZyB0aGUgZ2l2\nZW4KICAgICAqIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55IHVzZXIt\ncHJvdmlkZWQgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNv\nbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBjb2x1bW5zIGZv\ncgogICAgICogQHBhcmFtIHByZWZpeCBsb2NhbGl6ZWQgZXJyb3IgbWVzc2Fn\nZSBrZXkgcHJlZml4CiAgICAgKiBAcGFyYW0gdG1wbGF0ZXMgdGVtcGxhdGUg\nY29sdW1ucwogICAgICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhl\nIGNvbHVtbnMKICAgICAqIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBt\nb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBDb2x1bW5bXSBjcmVhdGVDb2x1bW5zKE1ldGFEYXRh\nQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgcHJlZml4LAogICAgICAgIENvbHVt\nbltdIHRtcGxhdGVzLCBUYWJsZSB0YWJsZSwgYm9vbGVhbiBhZGFwdCkgewog\nICAgICAgIGFzc2VydFRhYmxlKGNvbnRleHQsIHRhYmxlKTsKICAgICAgICBp\nZiAocHJlZml4ID09IG51bGwpCiAgICAgICAgICAgIHByZWZpeCA9ICJnZW5l\ncmljIjsKCiAgICAgICAgLy8gdGhlIHVzZXIgaGFzIHRvIGdpdmUgdGhlIHJp\nZ2h0IG51bWJlciBvZiBleHBlY3RlZCBjb2x1bW5zIGZvciB0aGlzCiAgICAg\nICAgLy8gbWFwcGluZywgb3Igbm9uZSBhdCBhbGwgaWYgd2UncmUgYWRhcHRp\nbmcuICBjYW4ndCBqdXN0IGdpdmVuIG9uZSBvZgogICAgICAgIC8vIG4gY29s\ndW1ucyBiZWNhdXNlIHdlIGRvbid0IGtub3cgd2hpY2ggb2YgdGhlIG4gY29s\ndW1ucyB0aGUgaW5mbwogICAgICAgIC8vIGFwcGxpZXMgdG8KICAgICAgICBM\naXN0IGdpdmVuID0gZ2V0Q29sdW1ucygpOwogICAgICAgIGJvb2xlYW4gZmls\nbCA9ICgoTWFwcGluZ1JlcG9zaXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9y\neSgpKS4KICAgICAgICAgICAgZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVs\ndE1pc3NpbmdJbmZvKCk7CiAgICAgICAgaWYgKCghZ2l2ZW4uaXNFbXB0eSgp\nIHx8ICghYWRhcHQgJiYgIWZpbGwpKQogICAgICAgICAgICAmJiBnaXZlbi5z\naXplKCkgIT0gdG1wbGF0ZXMubGVuZ3RoKQogICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1udW0t\nY29scyIsCiAgICAgICAgICAgICAgICBjb250ZXh0LCBTdHJpbmcudmFsdWVP\nZih0bXBsYXRlcy5sZW5ndGgpLAogICAgICAgICAgICAgICAgU3RyaW5nLnZh\nbHVlT2YoZ2l2ZW4uc2l6ZSgpKSkpOwoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gbmV3IENvbHVtblt0bXBsYXRlcy5sZW5ndGhdOwogICAgICAgIF9pbyA9\nIG51bGw7CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHRtcGxhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGNvbCA9IChnaXZlbi5pc0VtcHR5KCkpID8gbnVsbCA6IChDb2x1bW4pIGdp\ndmVuLmdldChpKTsKICAgICAgICAgICAgY29sc1tpXSA9IG1lcmdlQ29sdW1u\nKGNvbnRleHQsIHByZWZpeCwgdG1wbGF0ZXNbaV0sIHRydWUsIGNvbCwKICAg\nICAgICAgICAgICAgIHRhYmxlLCBhZGFwdCwgZmlsbCk7CiAgICAgICAgICAg\nIHNldElPRnJvbUNvbHVtbkZsYWdzKGNvbCwgaSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjb2xzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBwcm9wZXIgaW50ZXJuYWwgY29sdW1uIEkvTyBtZXRhZGF0YSBmb3IgdGhl\nIGdpdmVuIGNvbHVtbidzIGZsYWdzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgc2V0SU9Gcm9tQ29sdW1uRmxhZ3MoQ29sdW1uIGNvbCwgaW50IGkpIHsK\nICAgICAgICBpZiAoY29sID09IG51bGwgfHwgKCFjb2wuZ2V0RmxhZyhDb2x1\nbW4uRkxBR19VTklOU0VSVEFCTEUpCiAgICAgICAgICAgICYmICFjb2wuZ2V0\nRmxhZyhDb2x1bW4uRkxBR19VTlVQREFUQUJMRSkKICAgICAgICAgICAgJiYg\nIWNvbC5pc05vdE51bGwoKSkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgaWYgKF9pbyA9PSBudWxsKQogICAgICAgICAgICBfaW8gPSBuZXcgQ29s\ndW1uSU8oKTsKICAgICAgICBfaW8uc2V0SW5zZXJ0YWJsZShpLCAhY29sLmdl\ndEZsYWcoQ29sdW1uLkZMQUdfVU5JTlNFUlRBQkxFKSk7CiAgICAgICAgX2lv\nLnNldFVwZGF0YWJsZShpLCAhY29sLmdldEZsYWcoQ29sdW1uLkZMQUdfVU5V\nUERBVEFCTEUpKTsKICAgICAgICBfaW8uc2V0TnVsbEluc2VydGFibGUoaSwg\nIWNvbC5pc05vdE51bGwoKSk7CiAgICAgICAgX2lvLnNldE51bGxVcGRhdGFi\nbGUoaSwgIWNvbC5pc05vdE51bGwoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBc3NlcnQgdGhhdCB0aGUgZ2l2ZW4gdGFibGUgaXMgbm9uLW51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgYXNzZXJ0VGFibGUoTWV0\nYURhdGFDb250ZXh0IGNvbnRleHQsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAg\naWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgidW5tYXBwZWQiLCBjb250ZXh0KSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBNZXJnZSB0aGUgZ2l2ZW4gY29sdW1u\ncyBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0\naGUgbWFwcGluZyB3ZSdyZSByZXRyaWV2aW5nIGNvbHVtbnMgZm9yCiAgICAg\nKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBlcnJvciBtZXNzYWdlIGtleSBw\ncmVmaXgKICAgICAqIEBwYXJhbSB0bXBsYXRlIHRlbXBsYXRlIGZvciBleHBl\nY3RlZCBjb2x1bW4gaW5mb3JtYXRpb24KICAgICAqIEBwYXJhbSBjb21wYXQg\nd2hldGhlciB0aGUgZXhpc3RpbmcgY29sdW1uIHR5cGUgbXVzdCBiZSBjb21w\nYXRpYmxlCiAgICAgKiB3aXRoIHRoZSB0eXBlIG9mIHRoZSB0ZW1wbGF0ZSBj\nb2x1bW4KICAgICAqIEBwYXJhbSBnaXZlbiB0aGUgZ2l2ZW4gY29sdW1uIGlu\nZm9ybWF0aW9uIGZyb20gbWFwcGluZyBpbmZvCiAgICAgKiBAcGFyYW0gdGFi\nbGUgdGhlIHRhYmxlIGZvciB0aGUgY29sdW1ucwogICAgICogQHBhcmFtIGFk\nYXB0IHdoZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGlu\nZyBvciBzY2hlbWEKICAgICAqIEBwYXJhbSBmaWxsIHdoZXRoZXIgdG8gZGVm\nYXVsdCBtaXNzaW5nIGNvbHVtbiBpbmZvcm1hdGlvbgogICAgICovCiAgICBw\ncm90ZWN0ZWQgc3RhdGljIENvbHVtbiBtZXJnZUNvbHVtbihNZXRhRGF0YUNv\nbnRleHQgY29udGV4dCwgU3RyaW5nIHByZWZpeCwKICAgICAgICBDb2x1bW4g\ndG1wbGF0ZSwgYm9vbGVhbiBjb21wYXQsIENvbHVtbiBnaXZlbiwgVGFibGUg\ndGFibGUsCiAgICAgICAgYm9vbGVhbiBhZGFwdCwgYm9vbGVhbiBmaWxsKSB7\nCiAgICAgICAgYXNzZXJ0VGFibGUoY29udGV4dCwgdGFibGUpOwoKICAgICAg\nICAvLyBpZiBub3QgYWRhcHRpbmcgbXVzdCBwcm92aWRlIGNvbHVtbiBuYW1l\nIGF0IGEgbWluaW11bQogICAgICAgIFN0cmluZyBjb2xOYW1lID0gKGdpdmVu\nID09IG51bGwpID8gbnVsbCA6IGdpdmVuLmdldE5hbWUoKTsKICAgICAgICBp\nZiAoY29sTmFtZSA9PSBudWxsICYmICFhZGFwdCAmJiAhZmlsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHBy\nZWZpeCArICItbm8tY29sLW5hbWUiLAogICAgICAgICAgICAgICAgY29udGV4\ndCkpOwoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGNvbHVtbiBuYW1lIGJh\nc2VkIG9uIGdpdmVuIGluZm8sIG9yIHRlbXBsYXRlIGlmIG5vbmU7CiAgICAg\nICAgLy8gYWxzbyBtYWtlIHN1cmUgdGhhdCBpZiB0aGUgdXNlciBnYXZlIGEg\nY29sdW1uIG5hbWUsIGhlIGRpZG4ndCB0cnkKICAgICAgICAvLyB0byBwdXQg\ndGhlIGNvbHVtbiBpbiBhbiB1bmV4cGVjdGVkIHRhYmxlCiAgICAgICAgaWYg\nKGNvbE5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgY29sTmFtZSA9IHRtcGxh\ndGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBkb3RJZHggPSBjb2xOYW1lLmxh\nc3RJbmRleE9mKCcuJyk7CiAgICAgICAgaWYgKGRvdElkeCA9PSAwKQogICAg\nICAgICAgICBjb2xOYW1lID0gY29sTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAg\nICAgZWxzZSBpZiAoZG90SWR4ICE9IC0xKSB7CiAgICAgICAgICAgIGZpbmRU\nYWJsZShjb250ZXh0LCBjb2xOYW1lLnN1YnN0cmluZygwLCBkb3RJZHgpLCB0\nYWJsZSwKICAgICAgICAgICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAg\nICBjb2xOYW1lID0gY29sTmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBmaW5kIGV4aXN0aW5nIGNvbHVtbgogICAg\nICAgIENvbHVtbiBjb2wgPSB0YWJsZS5nZXRDb2x1bW4oY29sTmFtZSk7CiAg\nICAgICAgaWYgKGNvbCA9PSBudWxsICYmICFhZGFwdCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeCAr\nICItYmFkLWNvbC1uYW1lIiwKICAgICAgICAgICAgICAgIGNvbnRleHQsIGNv\nbE5hbWUsIHRhYmxlKSk7CgogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJl\ncG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBjb250ZXh0LmdldFJlcG9zaXRv\ncnkoKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IHJlcG9zLmdldERC\nRGljdGlvbmFyeSgpOwoKICAgICAgICAvLyB1c2UgaW5mb3JtYXRpb24gZnJv\nbSB0ZW1wbGF0ZSBjb2x1bW4gYnkgZGVmYXVsdCwgYWxsb3dpbmcgYW55CiAg\nICAgICAgLy8gdXNlci1naXZlbiBzcGVjaWZpY3MgdG8gb3ZlcnJpZGUgaXQK\nICAgICAgICBpbnQgdHlwZSA9IHRtcGxhdGUuZ2V0VHlwZSgpOwogICAgICAg\nIGludCBzaXplID0gdG1wbGF0ZS5nZXRTaXplKCk7CiAgICAgICAgaWYgKHR5\ncGUgPT0gVHlwZXMuT1RIRVIpCiAgICAgICAgICAgIHR5cGUgPSBkaWN0Lmdl\ndEpEQkNUeXBlKHRtcGxhdGUuZ2V0SmF2YVR5cGUoKSwgc2l6ZSA9PSAtMSk7\nCiAgICAgICAgYm9vbGVhbiB0dHlwZSA9IHRydWU7CiAgICAgICAgaW50IG90\neXBlID0gdHlwZTsKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0bXBsYXRl\nLmdldFR5cGVOYW1lKCk7CiAgICAgICAgQm9vbGVhbiBub3ROdWxsID0gbnVs\nbDsKICAgICAgICBpZiAodG1wbGF0ZS5pc05vdE51bGxFeHBsaWNpdCgpKQog\nICAgICAgICAgICBub3ROdWxsID0gKHRtcGxhdGUuaXNOb3ROdWxsKCkpID8g\nQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBpbnQgZGVj\naW1hbHMgPSB0bXBsYXRlLmdldERlY2ltYWxEaWdpdHMoKTsKICAgICAgICBT\ndHJpbmcgZGVmU3RyID0gdG1wbGF0ZS5nZXREZWZhdWx0U3RyaW5nKCk7CiAg\nICAgICAgYm9vbGVhbiBhdXRvQXNzaWduID0gdG1wbGF0ZS5pc0F1dG9Bc3Np\nZ25lZCgpOwogICAgICAgIGJvb2xlYW4gcmVsYXRpb25JZCA9IHRtcGxhdGUu\naXNSZWxhdGlvbklkKCk7CiAgICAgICAgU3RyaW5nIHRhcmdldEZpZWxkID0g\ndG1wbGF0ZS5nZXRUYXJnZXRGaWVsZCgpOwogICAgICAgIGlmIChnaXZlbiAh\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIHVzZSBnaXZlbiB0eXBlIGlmIHBy\nb3ZpZGVkLCBidXQgd2FybiBpZiBpdCBpc24ndCBjb21wYXRpYmxlIHdpdGgK\nICAgICAgICAgICAgLy8gdGhlIGV4cGVjdGVkIGNvbHVtbiB0eXBlCiAgICAg\nICAgICAgIGlmIChnaXZlbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsK\nICAgICAgICAgICAgICAgIHR0eXBlID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICBpZiAoY29tcGF0ICYmICFnaXZlbi5pc0NvbXBhdGlibGUodHlwZSwgdHlw\nZU5hbWUsIHNpemUsIAogICAgICAgICAgICAgICAgICAgIGRlY2ltYWxzKSkg\newogICAgICAgICAgICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5nZXRMb2co\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQo\ncHJlZml4ICsgIi1pbmNvbXBhdC1jb2wiLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGV4dCwgY29sTmFtZSwgU2NoZW1hcy5nZXRKREJDTmFt\nZSh0eXBlKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nb3R5cGUgPSBnaXZlbi5nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICB0eXBl\nID0gZGljdC5nZXRQcmVmZXJyZWRUeXBlKG90eXBlKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB0eXBlTmFtZSA9IGdpdmVuLmdldFR5cGVOYW1lKCk7\nCiAgICAgICAgICAgIHNpemUgPSBnaXZlbi5nZXRTaXplKCk7CiAgICAgICAg\nICAgIGRlY2ltYWxzID0gZ2l2ZW4uZ2V0RGVjaW1hbERpZ2l0cygpOwoKICAg\nICAgICAgICAgLy8gbGVhdmUgdGhpcyBpbmZvIGFzIHRoZSB0ZW1wbGF0ZSBk\nZWZhdWx0cyB1bmxlc3MgdGhlIHVzZXIKICAgICAgICAgICAgLy8gZXhwbGlj\naXRseSB0dXJucyBpdCBvbiBpbiB0aGUgZ2l2ZW4gY29sdW1uCiAgICAgICAg\nICAgIGlmIChnaXZlbi5pc05vdE51bGxFeHBsaWNpdCgpKQogICAgICAgICAg\nICAgICAgbm90TnVsbCA9IChnaXZlbi5pc05vdE51bGwoKSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBpZiAoZ2l2ZW4u\nZ2V0RGVmYXVsdFN0cmluZygpICE9IG51bGwpCiAgICAgICAgICAgICAgICBk\nZWZTdHIgPSBnaXZlbi5nZXREZWZhdWx0U3RyaW5nKCk7CiAgICAgICAgICAg\nIGlmIChnaXZlbi5pc0F1dG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAg\nYXV0b0Fzc2lnbiA9IHRydWU7CiAgICAgICAgICAgIGlmIChnaXZlbi5pc1Jl\nbGF0aW9uSWQoKSkKICAgICAgICAgICAgICAgIHJlbGF0aW9uSWQgPSB0cnVl\nOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVmYXVsdCBjaGFyIGNvbHVtbiBz\naXplIGlmIG9yaWdpbmFsIHR5cGUgaXMgY2hhciAodGVzdCBvcmlnaW5hbAog\nICAgICAgIC8vIHR5cGUgcmF0aGVyIHRoYW4gZmluYWwgdHlwZSBiZWNhdXNl\nIG9yaWcgbWlnaHQgYmUgY2xvYiwgdHJhbnNsYXRlZAogICAgICAgIC8vIHRv\nIGFuIHVuc2l6ZWQgdmFyY2hhciwgd2hpY2ggaXMgc3VwcG9ydGVkIGJ5IHNv\nbWUgZGJzKQogICAgICAgIGlmIChzaXplID09IDAgJiYgKG90eXBlID09IFR5\ncGVzLlZBUkNIQVIgfHwgb3R5cGUgPT0gVHlwZXMuQ0hBUikpCiAgICAgICAg\nICAgIHNpemUgPSBkaWN0LmNoYXJhY3RlckNvbHVtblNpemU7CgogICAgICAg\nIC8vIGNyZWF0ZSBjb2x1bW4sIG9yIG1ha2Ugc3VyZSBleGlzdGluZyBjb2x1\nbW4gbWF0Y2hlcyBleHBlY3RlZCB0eXBlCiAgICAgICAgaWYgKGNvbCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGNvbCA9IHRhYmxlLmFkZENvbHVtbihjb2xO\nYW1lKTsKICAgICAgICAgICAgY29sLnNldFR5cGUodHlwZSk7CiAgICAgICAg\nfSBlbHNlIGlmICgoY29tcGF0IHx8ICF0dHlwZSkgJiYgIWNvbC5pc0NvbXBh\ndGlibGUodHlwZSwgdHlwZU5hbWUsIAogICAgICAgICAgICBzaXplLCBkZWNp\nbWFscykpIHsKICAgICAgICAgICAgLy8gaWYgZXhpc3RpbmcgY29sdW1uIGlz\nbid0IGNvbXBhdGlibGUgd2l0aCBkZXNpcmVkIHR5cGUsIGRpZSBpZgogICAg\nICAgICAgICAvLyBjYW4ndCBhZGFwdCwgZWxzZSB3YXJuIGFuZCBjaGFuZ2Ug\ndGhlIGV4aXN0aW5nIGNvbHVtbiB0eXBlCiAgICAgICAgICAgIE1lc3NhZ2Ug\nbXNnID0gX2xvYy5nZXQocHJlZml4ICsgIi1iYWQtY29sIiwgY29udGV4dCwK\nICAgICAgICAgICAgICAgIFNjaGVtYXMuZ2V0SkRCQ05hbWUodHlwZSksIGNv\nbC5nZXREZXNjcmlwdGlvbigpKTsKICAgICAgICAgICAgaWYgKCFhZGFwdCkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbiht\nc2cpOwogICAgICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAg\nICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgbG9nLndhcm4obXNnKTsKCiAgICAgICAgICAgIGNvbC5zZXRUeXBl\nKHR5cGUpOwogICAgICAgIH0gZWxzZSBpZiAoZ2l2ZW4gIT0gbnVsbCAmJiBn\naXZlbi5nZXRUeXBlKCkgIT0gVHlwZXMuT1RIRVIpIHsKICAgICAgICAgICAg\nLy8gYXMgbG9uZyBhcyB0eXBlcyBhcmUgY29tcGF0aWJsZSwgc2V0IGNvbHVt\nbiB0byBleHBlY3RlZCB0eXBlCiAgICAgICAgICAgIGNvbC5zZXRUeXBlKHR5\ncGUpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWx3YXlzIHNldCB0aGUgamF2\nYSB0eXBlIGFuZCBhdXRvYXNzaWduIHRvIGV4cGVjdGVkIHZhbHVlcywgZXZl\nbiBvbgogICAgICAgIC8vIGFuIGV4aXN0aW5nIGNvbHVtbiwgc2luY2Ugd2Ug\nZG9uJ3QgZ2V0IHRoaXMgZnJvbSB0aGUgREIKICAgICAgICBpZiAoY29tcGF0\nKQogICAgICAgICAgICBjb2wuc2V0SmF2YVR5cGUodG1wbGF0ZS5nZXRKYXZh\nVHlwZSgpKTsKICAgICAgICBlbHNlIGlmIChjb2wuZ2V0SmF2YVR5cGUoKSA9\nPSBKYXZhVHlwZXMuT0JKRUNUKSB7CiAgICAgICAgICAgIGlmIChnaXZlbiAh\nPSBudWxsICYmIGdpdmVuLmdldEphdmFUeXBlKCkgIT0gSmF2YVR5cGVzLk9C\nSkVDVCkKICAgICAgICAgICAgICAgIGNvbC5zZXRKYXZhVHlwZShnaXZlbi5n\nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgY29sLnNldEphdmFUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZQogICAg\nICAgICAgICAgICAgICAgIChTY2hlbWFzLmdldEphdmFUeXBlKGNvbC5nZXRU\neXBlKCksIGNvbC5nZXRTaXplKCksCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbC5nZXREZWNpbWFsRGlnaXRzKCkpKSk7CiAgICAgICAgfQogICAgICAg\nIGNvbC5zZXRBdXRvQXNzaWduZWQoYXV0b0Fzc2lnbik7CiAgICAgICAgY29s\nLnNldFJlbGF0aW9uSWQocmVsYXRpb25JZCk7CiAgICAgICAgY29sLnNldFRh\ncmdldEZpZWxkKHRhcmdldEZpZWxkKTsKCiAgICAgICAgLy8gd2UgbmVlZCB0\naGlzIGZvciBydW50aW1lLCBhbmQgdGhlIGR5bmFtaWMgc2NoZW1hIGZhY3Rv\ncnkgbWlnaHQKICAgICAgICAvLyBub3Qga25vdyBpdCwgc28gc2V0IGl0IGV2\nZW4gaWYgbm90IGFkYXB0aW5nCiAgICAgICAgaWYgKGRlZlN0ciAhPSBudWxs\nKQogICAgICAgICAgICBjb2wuc2V0RGVmYXVsdFN0cmluZyhkZWZTdHIpOwog\nICAgICAgIGlmIChub3ROdWxsICE9IG51bGwpCiAgICAgICAgICAgIGNvbC5z\nZXROb3ROdWxsKG5vdE51bGwuYm9vbGVhblZhbHVlKCkpOwoKICAgICAgICAv\nLyBhZGQgb3RoZXIgZGV0YWlscyBpZiBhZGFwdGluZwogICAgICAgIGlmIChh\nZGFwdCkgewogICAgICAgICAgICBpZiAodHlwZU5hbWUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIGNvbC5zZXRUeXBlTmFtZSh0eXBlTmFtZSk7CiAgICAg\nICAgICAgIGlmIChzaXplICE9IDApCiAgICAgICAgICAgICAgICBjb2wuc2V0\nU2l6ZShzaXplKTsKICAgICAgICAgICAgaWYgKGRlY2ltYWxzICE9IDApCiAg\nICAgICAgICAgICAgICBjb2wuc2V0RGVjaW1hbERpZ2l0cyhkZWNpbWFscyk7\nCiAgICAgICAgfQoKICAgICAgICBpZiAodG1wbGF0ZS5oYXNDb21tZW50KCkp\nCiAgICAgICAgICAgIGNvbC5zZXRDb21tZW50KHRtcGxhdGUuZ2V0Q29tbWVu\ndCgpKTsKICAgICAgICByZXR1cm4gY29sOwogICAgfQoKICAgIC8qKgogICAg\nICogRmluZCB0aGUgdGFibGUgbmFtZWQgYnkgYSBjb2x1bW4gb3IgdGFyZ2V0\nLgogICAgICoKICAgICAqIEBwYXJhbSBjb250ZXh0IGNvbnRleHQgZm9yIGVy\ncm9yIG1lc3NhZ2VzLCBldGMuCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFi\nbGUgbmFtZSwgcG9zc2libHkgaW5jbHVkaW5nIHNjaGVtYQogICAgICogQHBh\ncmFtIGV4cGVjdGVkIHRoZSBleHBlY3RlZCB0YWJsZTsgbWF5IGJlIG51bGwK\nICAgICAqIEBwYXJhbSBpbnZlcnNlIHRoZSBwb3NzaWJsZSBpbnZlcnNlIHRh\nYmxlOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHJlbCBpZiB3ZSdyZSBm\naW5kaW5nIHRoZSB0YXJnZXQgdGFibGUgb2YgYSBqb2luLCB0aGUKICAgICAq\nIGpvaW5lZC10byB0eXBlOyBhbGxvd3MgdXMgdG8gYWxzbyBsb29rIGluIGl0\ncyBzdXBlcmNsYXNzIHRhYmxlcwogICAgICovCiAgICBwcml2YXRlIHN0YXRp\nYyBUYWJsZSBmaW5kVGFibGUoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIFN0\ncmluZyBuYW1lLAogICAgICAgIFRhYmxlIGV4cGVjdGVkLCBUYWJsZSBpbnZl\ncnNlLCBDbGFzc01hcHBpbmcgcmVsKSB7CiAgICAgICAgLy8gaXMgdGhpcyB0\naGUgZXhwZWN0ZWQgdGFibGU/CiAgICAgICAgaWYgKGV4cGVjdGVkID09IG51\nbGwgJiYgcmVsICE9IG51bGwpCiAgICAgICAgICAgIGV4cGVjdGVkID0gcmVs\nLmdldFRhYmxlKCk7CiAgICAgICAgaWYgKGV4cGVjdGVkICE9IG51bGwgJiYg\naXNUYWJsZU5hbWUobmFtZSwgZXhwZWN0ZWQpKQogICAgICAgICAgICByZXR1\ncm4gZXhwZWN0ZWQ7CgogICAgICAgIC8vIGNoZWNrIGZvciBpbnZlcnNlCiAg\nICAgICAgaWYgKGludmVyc2UgIT0gbnVsbCAmJiBpc1RhYmxlTmFtZShuYW1l\nLCBpbnZlcnNlKSkKICAgICAgICAgICAgcmV0dXJuIGludmVyc2U7CgogICAg\nICAgIC8vIHN1cGVyY2xhc3MgdGFibGU/CiAgICAgICAgaWYgKHJlbCAhPSBu\ndWxsKQogICAgICAgICAgICByZWwgPSByZWwuZ2V0Sm9pbmFibGVQQ1N1cGVy\nY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgd2hpbGUgKHJlbCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGlmIChpc1RhYmxlTmFtZShuYW1lLCByZWwuZ2V0VGFi\nbGUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gcmVsLmdldFRhYmxlKCk7\nCiAgICAgICAgICAgIHJlbCA9IHJlbC5nZXRKb2luYWJsZVBDU3VwZXJjbGFz\nc01hcHBpbmcoKTsKICAgICAgICB9CgogICAgICAgIC8vIG5vbmUgb2YgdGhl\nIHBvc3NpYmxlIHRhYmxlcwogICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiY29sLXdyb25nLXRhYmxlIiwgY29udGV4dCwK\nICAgICAgICAgICAgZXhwZWN0ZWQsIG5hbWUpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBuYW1lIG1hdGNoZXMg\ndGhlIGdpdmVuIHRhYmxlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBi\nb29sZWFuIGlzVGFibGVOYW1lKFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkg\newogICAgICAgIHJldHVybiBuYW1lLmVxdWFsc0lnbm9yZUNhc2UodGFibGUu\nZ2V0TmFtZSgpKQogICAgICAgICAgICB8fCBuYW1lLmVxdWFsc0lnbm9yZUNh\nc2UodGFibGUuZ2V0RnVsbE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXRyaWV2ZS9jcmVhdGUgYW4gaW5kZXggb24gdGhlIGdpdmVuIGNvbHVt\nbnMgYnkgbWVyZ2luZyB0aGUgZ2l2ZW4KICAgICAqIHRlbXBsYXRlIGluZm9y\nbWF0aW9uIHdpdGggYW55IHVzZXItcHJvdmlkZWQgaW5mb3JtYXRpb24uCiAg\nICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUg\ncmV0cmlldmluZyBhbiBpbmRleCBmb3IKICAgICAqIEBwYXJhbSBwcmVmaXgg\nbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICogQHBh\ncmFtIHRtcGxhdGUgdGVtcGxhdGUgZm9yIGV4cGVjdGVkIGluZGV4IGluZm9y\nbWF0aW9uCiAgICAgKiBAcGFyYW0gY29scyB0aGUgaW5kZXhlZCBjb2x1bW5z\nCiAgICAgKiBAcGFyYW0gYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRo\nZSBleGlzdGluZyBtYXBwaW5nIG9yIHNjaGVtYQogICAgICovCiAgICBwcm90\nZWN0ZWQgSW5kZXggY3JlYXRlSW5kZXgoTWV0YURhdGFDb250ZXh0IGNvbnRl\neHQsIFN0cmluZyBwcmVmaXgsCiAgICAgICAgSW5kZXggdG1wbGF0ZSwgQ29s\ndW1uW10gY29scywgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmIChwcmVm\naXggPT0gbnVsbCkKICAgICAgICAgICAgcHJlZml4ID0gImdlbmVyaWMiOwoK\nICAgICAgICAvLyBjYW4ndCBjcmVhdGUgYW4gaW5kZXggaWYgdGhlcmUgYXJl\nIG5vIGNvbHMKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgaWYgKF9pZHggIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldChwcmVmaXgKICAgICAgICAgICAgICAgICAgICArICItbm8taW5kZXgt\nY29scyIsIGNvbnRleHQpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQoKICAgICAgICAvLyBsb29rIGZvciBhbiBleGlzdGluZyBpbmRl\neCBvbiB0aGVzZSBjb2x1bW5zCiAgICAgICAgVGFibGUgdGFibGUgPSBjb2xz\nWzBdLmdldFRhYmxlKCk7CiAgICAgICAgSW5kZXhbXSBpZHhzID0gdGFibGUu\nZ2V0SW5kZXhlcygpOwogICAgICAgIEluZGV4IGV4aXN0ID0gbnVsbDsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGlkeHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGlkeHNbaV0uY29sdW1uc01hdGNoKGNvbHMpKSB7\nCiAgICAgICAgICAgICAgICBleGlzdCA9IGlkeHNbaV07CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nLy8gcmVtb3ZlIGV4aXN0aW5nIGluZGV4PwogICAgICAgIGlmICghX2Nhbklk\neCkgewogICAgICAgICAgICBpZiAoZXhpc3QgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoIWFkYXB0KQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KHByZWZpeCArICItaW5kZXgtZXhpc3RzIiwKICAgICAgICAgICAg\nICAgICAgICBjb250ZXh0KSk7CiAgICAgICAgICAgIHRhYmxlLnJlbW92ZUlu\nZGV4KGV4aXN0KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQoKICAgICAgICAvLyBpZiB3ZSBoYXZlIGFuIGV4aXN0aW5nIGluZGV4LCBt\nZXJnZSBnaXZlbiBpbmZvIGludG8gaXQKICAgICAgICBpZiAoZXhpc3QgIT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX2lkeCAhPSBudWxsICYmIF9pZHgu\naXNVbmlxdWUoKSAmJiAhZXhpc3QuaXNVbmlxdWUoKSkgewogICAgICAgICAg\nICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAg\nICAgICAgICAgICAgICAgICsgIi1pbmRleC1ub3QtdW5pcXVlIiwgY29udGV4\ndCkpOwogICAgICAgICAgICAgICAgZXhpc3Quc2V0VW5pcXVlKHRydWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBleGlzdDsKICAgICAg\nICB9CgogICAgICAgIC8vIGlmIG5vIGRlZmF1bHRzIHJldHVybiBudWxsCiAg\nICAgICAgTWFwcGluZ1JlcG9zaXRvcnkgcmVwb3MgPSAoTWFwcGluZ1JlcG9z\naXRvcnkpIGNvbnRleHQuZ2V0UmVwb3NpdG9yeSgpOwogICAgICAgIGJvb2xl\nYW4gZmlsbCA9IHJlcG9zLmdldE1hcHBpbmdEZWZhdWx0cygpLmRlZmF1bHRN\naXNzaW5nSW5mbygpOwogICAgICAgIGlmIChfaWR4ID09IG51bGwgJiYgKHRt\ncGxhdGUgPT0gbnVsbCB8fCAoIWFkYXB0ICYmICFmaWxsKSkpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgbmFtZSA9IG51bGw7\nCiAgICAgICAgYm9vbGVhbiB1bnE7CiAgICAgICAgaWYgKF9pZHggIT0gbnVs\nbCkgewogICAgICAgICAgICBuYW1lID0gX2lkeC5nZXROYW1lKCk7CiAgICAg\nICAgICAgIHVucSA9IF9pZHguaXNVbmlxdWUoKTsKICAgICAgICAgICAgLy8g\ncHJlc2VydmUgbXVsdGlwbGUgY29sdW1ucyBpZiB0aGV5IGFyZSBzcGVjaWZp\nZWQgaW4gdGhlIGluZGV4CiAgICAgICAgICAgIGlmIChfaWR4LmdldENvbHVt\nbnMoKSAhPSBudWxsICYmIF9pZHguZ2V0Q29sdW1ucygpLmxlbmd0aCA+IDEp\nCiAgICAgICAgICAgICAgICBjb2xzID0gX2lkeC5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgIHVucSA9IHRtcGxhdGUuaXNVbmlx\ndWUoKTsKCiAgICAgICAgLy8gaWYgbm8gbmFtZSBwcm92aWRlZCBieSB1c2Vy\nIGluZm8sIG1ha2Ugb25lCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkgewog\nICAgICAgICAgICBpZiAodG1wbGF0ZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgbmFtZSA9IHRtcGxhdGUuZ2V0TmFtZSgpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBjb2xzWzBdLmdldE5hbWUoKTsK\nICAgICAgICAgICAgICAgIG5hbWUgPSByZXBvcy5nZXREQkRpY3Rpb25hcnko\nKS5nZXRWYWxpZEluZGV4TmFtZShuYW1lLCB0YWJsZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIEluZGV4IGlkeCA9IHRhYmxlLmFkZElu\nZGV4KG5hbWUpOwogICAgICAgIGlkeC5zZXRVbmlxdWUodW5xKTsKICAgICAg\nICBpZHguc2V0Q29sdW1ucyhjb2xzKTsKICAgICAgICByZXR1cm4gaWR4Owog\nICAgfQoKICAgIC8qKgogICAgICogUmV0cmlldmUvY3JlYXRlIGEgdW5pcXVl\nIGNvbnN0cmFpbnQgb24gdGhlIGdpdmVuIGNvbHVtbnMgYnkgbWVyZ2luZyB0\naGUKICAgICAqIGdpdmVuIHRlbXBsYXRlIGluZm9ybWF0aW9uIHdpdGggYW55\nIHVzZXItcHJvdmlkZWQgaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBh\ncmFtIGNvbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBhIGNv\nbnN0cmFpbnQgZm9yCiAgICAgKiBAcGFyYW0gcHJlZml4IGxvY2FsaXplZCBl\ncnJvciBtZXNzYWdlIGtleSBwcmVmaXgKICAgICAqIEBwYXJhbSB0bXBsYXRl\nIHRlbXBsYXRlIGZvciBleHBlY3RlZCB1bmlxdWUgaW5mb3JtYXRpb24KICAg\nICAqIEBwYXJhbSBjb2xzIHRoZSBjb25zdHJhaW50IGNvbHVtbnMKICAgICAq\nIEBwYXJhbSBhZGFwdCB3aGV0aGVyIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0\naW5nIG1hcHBpbmcgb3Igc2NoZW1hCiAgICAgKi8KICAgIHByb3RlY3RlZCBV\nbmlxdWUgY3JlYXRlVW5pcXVlKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LCBT\ndHJpbmcgcHJlZml4LAogICAgICAgIFVuaXF1ZSB0bXBsYXRlLCBDb2x1bW5b\nXSBjb2xzLCBib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKHByZWZpeCA9\nPSBudWxsKQogICAgICAgICAgICBwcmVmaXggPSAiZ2VuZXJpYyI7CgogICAg\nICAgIC8vIGNhbid0IGNyZWF0ZSBhIGNvbnN0cmFpbnQgaWYgdGhlcmUgYXJl\nIG5vIGNvbHMKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgaWYgKF91bnEgIT0gbnVsbCB8fCB0\nbXBsYXRlICE9IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0\nYURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAg\nICAgICAgKyAiLW5vLXVuaXF1ZS1jb2xzIiwgY29udGV4dCkpOwogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGxvb2sg\nZm9yIGFuIGV4aXN0aW5nIGNvbnN0cmFpbnQgb24gdGhlc2UgY29sdW1ucwog\nICAgICAgIFRhYmxlIHRhYmxlID0gY29sc1swXS5nZXRUYWJsZSgpOwogICAg\nICAgIFVuaXF1ZVtdIHVucXMgPSB0YWJsZS5nZXRVbmlxdWVzKCk7CiAgICAg\nICAgVW5pcXVlIGV4aXN0ID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHVucXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHVu\ncXNbaV0uY29sdW1uc01hdGNoKGNvbHMpKSB7CiAgICAgICAgICAgICAgICBl\neGlzdCA9IHVucXNbaV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGV4aXN0aW5n\nIHVuaXF1ZT8KICAgICAgICBpZiAoIV9jYW5VbnEpIHsKICAgICAgICAgICAg\naWYgKGV4aXN0ID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgaWYgKCFhZGFwdCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAg\nICAgICAgICAgICAgICAgICArICItdW5pcXVlLWV4aXN0cyIsIGNvbnRleHQp\nKTsKICAgICAgICAgICAgdGFibGUucmVtb3ZlVW5pcXVlKGV4aXN0KTsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBu\nbyBkZWZhdWx0czsgcmV0dXJuIGV4aXN0aW5nIGNvbnN0cmFpbnQgKGlmIGFu\neSkKICAgICAgICBpZiAodG1wbGF0ZSA9PSBudWxsICYmIF91bnEgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGV4aXN0OwoKICAgICAgICBNYXBwaW5n\nUmVwb3NpdG9yeSByZXBvcyA9IChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgaWYgKGV4aXN0ICE9IG51bGwp\nIHsKICAgICAgICAgICAgaWYgKF91bnEgIT0gbnVsbCAmJiBfdW5xLmlzRGVm\nZXJyZWQoKSAmJiAhZXhpc3QuaXNEZWZlcnJlZCgpKSB7CiAgICAgICAgICAg\nICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgICAgICAg\nICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBsb2cud2FybihfbG9jLmdldChwcmVmaXggKyAiLWRlZmVyLXVuaXF1ZSIs\nIGNvbnRleHQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nZXhpc3Q7CiAgICAgICAgfQoKICAgICAgICAvLyBkaWN0IGNhbid0IGhhbmRs\nZSB1bmlxdWUgY29uc3RyYWludHM/CiAgICAgICAgREJEaWN0aW9uYXJ5IGRp\nY3QgPSByZXBvcy5nZXREQkRpY3Rpb25hcnkoKTsKICAgICAgICBpZiAoX3Vu\ncSAhPSBudWxsICYmICFkaWN0LnN1cHBvcnRzVW5pcXVlQ29uc3RyYWludHMp\nIHsKICAgICAgICAgICAgTG9nIGxvZyA9IHJlcG9zLmdldExvZygpOwogICAg\nICAgICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgIGxvZy53YXJuKF9sb2MuZ2V0KHByZWZpeCArICItdW5pcXVlLXN1cHBv\ncnQiLCBjb250ZXh0KSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgYm9vbGVhbiBmaWxsID0gcmVwb3MuZ2V0TWFwcGlu\nZ0RlZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJbmZvKCk7CiAgICAgICAgaWYg\nKCFhZGFwdCAmJiAhZmlsbCAmJiBfdW5xID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgbmFtZTsKICAgICAgICBi\nb29sZWFuIGRlZmVycmVkOwogICAgICAgIGlmIChfdW5xICE9IG51bGwpIHsK\nICAgICAgICAgICAgbmFtZSA9IF91bnEuZ2V0TmFtZSgpOwogICAgICAgICAg\nICBkZWZlcnJlZCA9IF91bnEuaXNEZWZlcnJlZCgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIG5hbWUgPSB0bXBsYXRlLmdldE5hbWUoKTsKICAg\nICAgICAgICAgZGVmZXJyZWQgPSB0bXBsYXRlLmlzRGVmZXJyZWQoKTsKICAg\nICAgICB9CgogICAgICAgIGlmIChkZWZlcnJlZCAmJiAhZGljdC5zdXBwb3J0\nc0RlZmVycmVkQ29uc3RyYWludHMpIHsKICAgICAgICAgICAgTG9nIGxvZyA9\nIHJlcG9zLmdldExvZygpOwogICAgICAgICAgICBpZiAobG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KHBy\nZWZpeCArICItY3JlYXRlLWRlZmVyLXVuaXF1ZSIsCiAgICAgICAgICAgICAg\nICAgICAgY29udGV4dCwgZGljdC5wbGF0Zm9ybSkpOwogICAgICAgICAgICBk\nZWZlcnJlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShuYW1lKSkgewogICAgICAgIAluYW1l\nID0gY29sc1swXS5nZXROYW1lKCk7CiAgICAgICAgCW5hbWUgPSByZXBvcy5n\nZXREQkRpY3Rpb25hcnkoKS5nZXRWYWxpZFVuaXF1ZU5hbWUobmFtZSwgdGFi\nbGUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBVbmlxdWUgdW5xID0g\ndGFibGUuYWRkVW5pcXVlKG5hbWUpOwogICAgICAgIHVucS5zZXREZWZlcnJl\nZChkZWZlcnJlZCk7CiAgICAgICAgdW5xLnNldENvbHVtbnMoY29scyk7CiAg\nICAgICAgcmV0dXJuIHVucTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHJp\nZXZlL2NyZWF0ZSBhIGZvcmVpZ24ga2V5IChwb3NzaWJseSBsb2dpY2FsKSBv\nbiB0aGUgZ2l2ZW4gY29sdW1ucwogICAgICogYnkgbWVyZ2luZyB0aGUgZ2l2\nZW4gdGVtcGxhdGUgaW5mb3JtYXRpb24gd2l0aCBhbnkgdXNlci1wcm92aWRl\nZAogICAgICogaW5mb3JtYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIGNv\nbnRleHQgdGhlIG1hcHBpbmcgd2UncmUgcmV0cmlldmluZyBhIGtleSBmb3IK\nICAgICAqIEBwYXJhbSBwcmVmaXggbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Ug\na2V5IHByZWZpeAogICAgICogQHBhcmFtIGdpdmVuIHRoZSBjb2x1bW5zIGdp\ndmVuIGJ5IHRoZSB1c2VyCiAgICAgKiBAcGFyYW0gZGVmIGRlZmF1bHRzIHBy\nb3ZpZGVyCiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIHRhYmxlIGZvciB0aGUg\na2V5CiAgICAgKiBAcGFyYW0gY2xzIHR5cGUgd2UncmUgam9pbmluZyBmcm9t\nCiAgICAgKiBAcGFyYW0gcmVsIHRhcmdldCB0eXBlIHdlJ3JlIGpvaW5pbmcg\ndG8KICAgICAqIEBwYXJhbSBpbnZlcnNhYmxlIHdoZXRoZXIgdGhlIGZvcmVp\nZ24ga2V5IGNhbiBiZSBpbnZlcnNlZAogICAgICogQHBhcmFtIGFkYXB0IHdo\nZXRoZXIgd2UgY2FuIG1vZGlmeSB0aGUgZXhpc3RpbmcgbWFwcGluZyBvciBz\nY2hlbWEKICAgICAqLwogICAgcHJvdGVjdGVkIEZvcmVpZ25LZXkgY3JlYXRl\nRm9yZWlnbktleShNZXRhRGF0YUNvbnRleHQgY29udGV4dCwKICAgICAgICBT\ndHJpbmcgcHJlZml4LCBMaXN0IGdpdmVuLCBGb3JlaWduS2V5RGVmYXVsdHMg\nZGVmLCBUYWJsZSB0YWJsZSwKICAgICAgICBDbGFzc01hcHBpbmcgY2xzLCBD\nbGFzc01hcHBpbmcgcmVsLCBib29sZWFuIGludmVyc2FibGUsIGJvb2xlYW4g\nYWRhcHQpIHsKICAgICAgICBhc3NlcnRUYWJsZShjb250ZXh0LCB0YWJsZSk7\nCiAgICAgICAgaWYgKHByZWZpeCA9PSBudWxsKQogICAgICAgICAgICBwcmVm\naXggPSAiZ2VuZXJpYyI7CgogICAgICAgIC8vIGNvbGxlY3QgdGhlIGZvcmVp\nZ24ga2V5IGNvbHVtbnMgYW5kIHRoZWlyIHRhcmdldHMKICAgICAgICBPYmpl\nY3RbXVtdIGpvaW5zID0gY3JlYXRlSm9pbnMoY29udGV4dCwgcHJlZml4LCB0\nYWJsZSwgY2xzLCByZWwsCiAgICAgICAgICAgIGdpdmVuLCBkZWYsIGludmVy\nc2FibGUsIGFkYXB0KTsKICAgICAgICBfam9pbiA9IEpPSU5fRk9SV0FSRDsK\nCiAgICAgICAgLy8gZXN0YWJsaXNoIGxvY2FsIHRhYmxlIHVzaW5nIGFueSBq\nb2luIGJldHdlZW4gdHdvIGNvbHVtbnM7IGlmIHdlIG9ubHkKICAgICAgICAv\nLyBmaW5kIGNvbnN0YW50IGpvaW5zLCB0aGVuIGtlZXAgZGVmYXVsdCBsb2Nh\nbCB0YWJsZSAoZGlyZWN0aW9ubGVzcykKICAgICAgICBUYWJsZSBsb2NhbCA9\nIHRhYmxlOwogICAgICAgIFRhYmxlIGZvcmVpZ24gPSByZWwuZ2V0VGFibGUo\nKTsKICAgICAgICBUYWJsZSB0bXA7CiAgICAgICAgYm9vbGVhbiBjb25zdGFu\ndCA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gbG9jYWxTZXQgPSBmYWxzZTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgIGlmIChqb2luc1tpXVsxXWluc3RhbmNlb2YgQ29s\ndW1uKSB7CiAgICAgICAgICAgICAgICB0bXAgPSAoKENvbHVtbikgam9pbnNb\naV1bMF0pLmdldFRhYmxlKCk7CiAgICAgICAgICAgICAgICBpZiAoIWxvY2Fs\nU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgPSB0bXA7CiAgICAg\nICAgICAgICAgICAgICAgbG9jYWxTZXQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgfSBlbHNlIGlmICh0bXAgIT0gbG9jYWwpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZp\neAogICAgICAgICAgICAgICAgICAgICAgICArICItbXVsdC1may10YWJsZXMi\nLCBjb250ZXh0LCBsb2NhbCwgdG1wKSk7CiAgICAgICAgICAgICAgICBmb3Jl\naWduID0gKChDb2x1bW4pIGpvaW5zW2ldWzFdKS5nZXRUYWJsZSgpOwoKICAg\nICAgICAgICAgICAgIGlmIChqb2luc1tpXVsyXSA9PSBCb29sZWFuLlRSVUUp\nCiAgICAgICAgICAgICAgICAgICAgX2pvaW4gPSBKT0lOX0lOVkVSU0U7CiAg\nICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgY29uc3RhbnQgPSB0\ncnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhpcyBpcyBub3QgYSBj\nb25zdGFudCBqb2luLCBsb29rIGZvciBleGlzdGluZyBmb3JlaWduIGtleQog\nICAgICAgIC8vIG9uIGxvY2FsIGNvbHVtbnMKICAgICAgICBGb3JlaWduS2V5\nIGV4aXN0ID0gbnVsbDsKICAgICAgICBpZiAoIWNvbnN0YW50ICYmIGxvY2Fs\nLmdldEZvcmVpZ25LZXlzKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gbmV3IENvbHVtbltqb2lucy5sZW5ndGhdOwogICAg\nICAgICAgICBDb2x1bW5bXSBwa3MgPSBuZXcgQ29sdW1uW2pvaW5zLmxlbmd0\naF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgam9pbnMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbHNbaV0gPSAoQ29sdW1u\nKSBqb2luc1tpXVswXTsKICAgICAgICAgICAgICAgIHBrc1tpXSA9IChDb2x1\nbW4pIGpvaW5zW2ldWzFdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBG\nb3JlaWduS2V5W10gZmtzID0gbG9jYWwuZ2V0Rm9yZWlnbktleXMoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBma3MubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChma3NbaV0uZ2V0Q29uc3RhbnRDb2x1\nbW5zKCkubGVuZ3RoID09IDAKICAgICAgICAgICAgICAgICAgICAmJiBma3Nb\naV0uZ2V0Q29uc3RhbnRQcmltYXJ5S2V5Q29sdW1ucygpLmxlbmd0aCA9PSAw\nCiAgICAgICAgICAgICAgICAgICAgJiYgZmtzW2ldLmNvbHVtbnNNYXRjaChj\nb2xzLCBwa3MpKSB7CiAgICAgICAgICAgICAgICAgICAgZXhpc3QgPSBma3Nb\naV07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIE1hcHBpbmdS\nZXBvc2l0b3J5IHJlcG9zID0gKE1hcHBpbmdSZXBvc2l0b3J5KSBjb250ZXh0\nLmdldFJlcG9zaXRvcnkoKTsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9\nIHJlcG9zLmdldERCRGljdGlvbmFyeSgpOwogICAgICAgIGlmIChleGlzdCAh\nPSBudWxsKSB7CiAgICAgICAgICAgIC8vIG1ha2UgZXhpc3Rpbmcga2V5IGxv\nZ2ljYWw/CiAgICAgICAgICAgIGlmICghX2NhbkZLKSB7CiAgICAgICAgICAg\nICAgICBpZiAoZXhpc3QuZ2V0RGVsZXRlQWN0aW9uKCkgIT0gZXhpc3QuQUNU\nSU9OX05PTkUgJiYgIWFkYXB0KQogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiLWZrLWV4aXN0cyIsIGNvbnRleHQpKTsK\nICAgICAgICAgICAgICAgIGV4aXN0LnNldERlbGV0ZUFjdGlvbihleGlzdC5B\nQ1RJT05fTk9ORSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChf\nZmsgIT0gbnVsbCAmJiBfZmsuaXNEZWZlcnJlZCgpICYmICFleGlzdC5pc0Rl\nZmVycmVkKCkpIHsKICAgICAgICAgICAgICAgIExvZyBsb2cgPSByZXBvcy5n\nZXRMb2coKTsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KHBy\nZWZpeCArICItZGVmZXItZmsiLCBjb250ZXh0KSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGFsbG93IHVzZXItZ2l2ZW4gaW5mbyB0byBvdmVy\ncmlkZSBleGlzdGluZyBrZXkgaWYgd2UncmUgYWRhcHRpbmc7CiAgICAgICAg\nICAgIC8vIHRlbXBsYXRlIGluZm8gY2Fubm90IG92ZXJyaWRlIGV4aXN0aW5n\nIGtleQogICAgICAgICAgICBpZiAoYWRhcHQgJiYgX2ZrICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChfZmsuZ2V0VXBkYXRlQWN0aW9uKCkgIT0g\nRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgICAgICAgICBl\neGlzdC5zZXRVcGRhdGVBY3Rpb24oX2ZrLmdldFVwZGF0ZUFjdGlvbigpKTsK\nICAgICAgICAgICAgICAgIGlmIChfZmsuZ2V0RGVsZXRlQWN0aW9uKCkgIT0g\nRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgICAgICAgICBl\neGlzdC5zZXREZWxldGVBY3Rpb24oX2ZrLmdldERlbGV0ZUFjdGlvbigpKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRJT0Zyb21Kb2lucyhleGlz\ndCwgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gZXhpc3Q7CiAgICAgICAg\nfQoKICAgICAgICBTdHJpbmcgbmFtZSA9IG51bGw7CiAgICAgICAgaW50IGRl\nbEFjdGlvbiA9IEZvcmVpZ25LZXkuQUNUSU9OX05PTkU7CiAgICAgICAgaW50\nIHVwQWN0aW9uID0gRm9yZWlnbktleS5BQ1RJT05fTk9ORTsKICAgICAgICBi\nb29sZWFuIGRlZmVycmVkID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBmaWxs\nID0gcmVwb3MuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuZGVmYXVsdE1pc3NpbmdJ\nbmZvKCk7CiAgICAgICAgRm9yZWlnbktleSB0bXBsYXRlID0gKGRlZiA9PSBu\ndWxsKSA/IG51bGwKICAgICAgICAgICAgOiBkZWYuZ2V0KGxvY2FsLCBmb3Jl\naWduLCBfam9pbiA9PSBKT0lOX0lOVkVSU0UpOwogICAgICAgIGlmIChfZmsg\nIT0gbnVsbCAmJiAodG1wbGF0ZSA9PSBudWxsIHx8ICghYWRhcHQgJiYgIWZp\nbGwpKSkgewogICAgICAgICAgICAvLyBpZiBub3QgYWRhcHRpbmcgb3Igbm8g\ndGVtcGxhdGUgaW5mbyB1c2UgZ2l2ZW4gZGF0YQogICAgICAgICAgICBuYW1l\nID0gX2ZrLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVsQWN0aW9uID0gX2Zr\nLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgICAgICB1cEFjdGlvbiA9IF9m\nay5nZXRVcGRhdGVBY3Rpb24oKTsKICAgICAgICAgICAgZGVmZXJyZWQgPSBf\nZmsuaXNEZWZlcnJlZCgpOwogICAgICAgIH0gZWxzZSBpZiAoX2NhbkZLICYm\nIChhZGFwdCB8fCBmaWxsKSkgewogICAgICAgICAgICBpZiAoX2ZrID09IG51\nbGwgJiYgdG1wbGF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBu\nbyB1c2VyIGdpdmVuIGluZm87IHVzZSB0ZW1wbGF0ZSBkYXRhCiAgICAgICAg\nICAgICAgICBuYW1lID0gdG1wbGF0ZS5nZXROYW1lKCk7CiAgICAgICAgICAg\nICAgICBkZWxBY3Rpb24gPSB0bXBsYXRlLmdldERlbGV0ZUFjdGlvbigpOwog\nICAgICAgICAgICAgICAgdXBBY3Rpb24gPSB0bXBsYXRlLmdldFVwZGF0ZUFj\ndGlvbigpOwogICAgICAgICAgICAgICAgZGVmZXJyZWQgPSB0bXBsYXRlLmlz\nRGVmZXJyZWQoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfZmsgIT0gbnVs\nbCAmJiB0bXBsYXRlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIG1l\ncmdlIHVzZXIgYW5kIHRlbXBsYXRlIGRhdGEsIGFsd2F5cyBsZXR0aW5nIHVz\nZXIgaW5mbyB3aW4KICAgICAgICAgICAgICAgIG5hbWUgPSBfZmsuZ2V0TmFt\nZSgpOwogICAgICAgICAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCAmJiB0bXBs\nYXRlLmdldE5hbWUoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG5h\nbWUgPSB0bXBsYXRlLmdldE5hbWUoKTsKICAgICAgICAgICAgICAgIGRlbEFj\ndGlvbiA9IF9may5nZXREZWxldGVBY3Rpb24oKTsKICAgICAgICAgICAgICAg\nIGlmIChkZWxBY3Rpb24gPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAg\nICAgICAgICAgICAgICAgICBkZWxBY3Rpb24gPSB0bXBsYXRlLmdldERlbGV0\nZUFjdGlvbigpOwogICAgICAgICAgICAgICAgdXBBY3Rpb24gPSBfZmsuZ2V0\nVXBkYXRlQWN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAodXBBY3Rpb24g\nPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgICAgICAg\nICB1cEFjdGlvbiA9IHRtcGxhdGUuZ2V0VXBkYXRlQWN0aW9uKCk7CiAgICAg\nICAgICAgICAgICBkZWZlcnJlZCA9IF9may5pc0RlZmVycmVkKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghZGljdC5zdXBwb3J0\nc0RlbGV0ZUFjdGlvbihkZWxBY3Rpb24pCiAgICAgICAgICAgIHx8ICFkaWN0\nLnN1cHBvcnRzVXBkYXRlQWN0aW9uKHVwQWN0aW9uKSkgewogICAgICAgICAg\nICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgICAgIGlmIChs\nb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLndhcm4o\nX2xvYy5nZXQocHJlZml4ICsgIi11bnN1cHBvcnRlZC1may1hY3Rpb24iLCBj\nb250ZXh0KSk7CiAgICAgICAgICAgIGRlbEFjdGlvbiA9IEZvcmVpZ25LZXku\nQUNUSU9OX05PTkU7CiAgICAgICAgICAgIHVwQWN0aW9uID0gRm9yZWlnbktl\neS5BQ1RJT05fTk9ORTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlZmVycmVk\nICYmICFkaWN0LnN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cykgewogICAg\nICAgICAgICBMb2cgbG9nID0gcmVwb3MuZ2V0TG9nKCk7CiAgICAgICAgICAg\nIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQocHJlZml4ICsgIi1jcmVhdGUtZGVmZXItZmsiLAog\nICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIGRpY3QucGxhdGZvcm0pKTsK\nICAgICAgICAgICAgZGVmZXJyZWQgPSBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIC8vIGNyZWF0ZSBmb3JlaWduIGtleSB3aXRoIG1lcmdlZCBpbmZvCiAg\nICAgICAgRm9yZWlnbktleSBmayA9IGxvY2FsLmFkZEZvcmVpZ25LZXkobmFt\nZSk7CiAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKGRlbEFjdGlvbik7CiAg\nICAgICAgZmsuc2V0VXBkYXRlQWN0aW9uKHVwQWN0aW9uKTsKICAgICAgICBm\nay5zZXREZWZlcnJlZChkZWZlcnJlZCk7CgogICAgICAgIC8vIGFkZCBqb2lu\ncyB0byBrZXkKICAgICAgICBDb2x1bW4gY29sOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nY29sID0gKENvbHVtbikgam9pbnNbaV1bMF07CiAgICAgICAgICAgIGlmIChq\nb2luc1tpXVsxXWluc3RhbmNlb2YgQ29sdW1uKQogICAgICAgICAgICAgICAg\nZmsuam9pbihjb2wsIChDb2x1bW4pIGpvaW5zW2ldWzFdKTsKICAgICAgICAg\nICAgZWxzZSBpZiAoKGpvaW5zW2ldWzJdID09IEJvb2xlYW4uVFJVRSkgIT0g\nKF9qb2luID09IEpPSU5fSU5WRVJTRSkpCiAgICAgICAgICAgICAgICBmay5q\nb2luQ29uc3RhbnQoam9pbnNbaV1bMV0sIGNvbCk7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGZrLmpvaW5Db25zdGFudChjb2wsIGpvaW5z\nW2ldWzFdKTsKICAgICAgICB9CiAgICAgICAgc2V0SU9Gcm9tSm9pbnMoZmss\nIGpvaW5zKTsKICAgICAgICByZXR1cm4gZms7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBVc2UgdGhlIGpvaW4gaW5mb3JtYXRpb24gdG8gcG9wdWxhdGUgb3Vy\nIGludGVybmFsIGNvbHVtbiBJL08gZGF0YS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNldElPRnJvbUpvaW5zKEZvcmVpZ25LZXkgZmssIE9iamVjdFtd\nW10gam9pbnMpIHsKICAgICAgICBMaXN0IGNvbHMgPSBnZXRDb2x1bW5zKCk7\nCiAgICAgICAgX2lvID0gbnVsbDsKICAgICAgICBpZiAoY29scy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaW50IGNvbnN0SWR4\nID0gMDsKICAgICAgICBpbnQgaWR4OwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgam9pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gY29u\nc3QgY29sdW1ucyBhcmUgaW5kZXhlZCBhZnRlciBzdGQgam9pbiBjb2x1bW5z\nIGluIGZrIElPCiAgICAgICAgICAgIGlmIChqb2luc1tpXVsxXWluc3RhbmNl\nb2YgQ29sdW1uKQogICAgICAgICAgICAgICAgaWR4ID0gaSAtIGNvbnN0SWR4\nOwogICAgICAgICAgICBlbHNlIGlmICgoam9pbnNbaV1bMl0gPT0gQm9vbGVh\nbi5UUlVFKSA9PSAoX2pvaW4gPT0gSk9JTl9JTlZFUlNFKSkKICAgICAgICAg\nICAgICAgIGlkeCA9IGZrLmdldENvbHVtbnMoKS5sZW5ndGggKyBjb25zdElk\neCsrOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKICAgICAgICAgICAgc2V0SU9Gcm9tQ29sdW1uRmxhZ3MoKENvbHVtbikg\nY29scy5nZXQoaSksIGlkeCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQ3JlYXRlIG9yIHJldHJpZXZlIHRoZSBmb3JlaWduIGtleSBqb2lu\ncy4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCB0aGUgbWFwcGluZyB3\nZSdyZSByZXRyaWV2aW5nIGEga2V5IGZvcgogICAgICogQHBhcmFtIHByZWZp\neCBsb2NhbGl6ZWQgZXJyb3IgbWVzc2FnZSBrZXkgcHJlZml4CiAgICAgKiBA\ncGFyYW0gdGFibGUgdGhlIHRhYmxlIGZvciB0aGUga2V5CiAgICAgKiBAcGFy\nYW0gY2xzIHR5cGUgd2UncmUgam9pbmluZyBmcm9tLCBpZiBhcHBsaWNhYmxl\nCiAgICAgKiBAcGFyYW0gcmVsIHRhcmdldCB0eXBlIHdlJ3JlIGpvaW5pbmcg\ndG8KICAgICAqIEBwYXJhbSBnaXZlbiB0aGUgY29sdW1ucyBnaXZlbiBieSB0\naGUgdXNlcgogICAgICogQHBhcmFtIGRlZiBmb3JlaWduIGtleSBkZWZhdWx0\ncyBwcm92aWRlcgogICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciB0\naGUgZm9yZWlnbiBrZXkgY2FuIGJlIGludmVyc2VkCiAgICAgKiBAcGFyYW0g\nYWRhcHQgd2hldGhlciB3ZSBjYW4gbW9kaWZ5IHRoZSBleGlzdGluZyBtYXBw\naW5nIG9yIHNjaGVtYQogICAgICogQHJldHVybiBhcnJheSBvZiB0dXBsZXMg\nd2hlcmUgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdGhlCiAgICAgKiBsb2NhbCBj\nb2x1bW4gKG9yIGluIHRoZSBjYXNlIG9mIGEgY29uc3RhbnQgam9pbiB0aGUK\nICAgICAqIHNvbGUgY29sdW1uKSwgdGhlIHNlY29uZCBpcyB0aGUgdGFyZ2V0\nIGNvbHVtbiAob3IKICAgICAqIGNvbnN0YW50KSwgYW5kIHRoZSB0aGlyZCBp\ncyB7QGxpbmsgQm9vbGVhbiNUUlVFfSBpZgogICAgICogdGhpcyBpcyBhbiBp\nbnZlcnNlIGpvaW4KICAgICAqLwogICAgcHJpdmF0ZSBPYmplY3RbXVtdIGNy\nZWF0ZUpvaW5zKE1ldGFEYXRhQ29udGV4dCBjb250ZXh0LAogICAgICAgIFN0\ncmluZyBwcmVmaXgsIFRhYmxlIHRhYmxlLCBDbGFzc01hcHBpbmcgY2xzLCBD\nbGFzc01hcHBpbmcgcmVsLAogICAgICAgIExpc3QgZ2l2ZW4sIEZvcmVpZ25L\nZXlEZWZhdWx0cyBkZWYsIGJvb2xlYW4gaW52ZXJzYWJsZSwgYm9vbGVhbiBh\nZGFwdCkgewogICAgICAgIE1hcHBpbmdSZXBvc2l0b3J5IHJlcG9zID0gKE1h\ncHBpbmdSZXBvc2l0b3J5KSBjb250ZXh0LmdldFJlcG9zaXRvcnkoKTsKICAg\nICAgICBib29sZWFuIGZpbGwgPSByZXBvcy5nZXRNYXBwaW5nRGVmYXVsdHMo\nKS5kZWZhdWx0TWlzc2luZ0luZm8oKTsKICAgICAgICBPYmplY3RbXVtdIGpv\naW5zOwoKICAgICAgICAvLyBpZiBubyBjb2x1bW5zIGdpdmVuLCBqdXN0IGNy\nZWF0ZSBtaXJyb3JzIG9mIHRhcmdldCBjb2x1bW5zCiAgICAgICAgaWYgKGdp\ndmVuLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAoIWFkYXB0ICYmICFm\naWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KHByZWZpeCArICItbm8tZmstY29scyIsCiAgICAgICAg\nICAgICAgICAgICAgY29udGV4dCkpOwoKICAgICAgICAgICAgQ29sdW1uW10g\ndGFyZ2V0cyA9IHJlbC5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAg\nICAgICBqb2lucyA9IG5ldyBPYmplY3RbdGFyZ2V0cy5sZW5ndGhdWzNdOwog\nICAgICAgICAgICBDb2x1bW4gdG1wbGF0ZTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICB0bXBsYXRlID0gbmV3IENvbHVtbigpOwogICAgICAgICAgICAg\nICAgdG1wbGF0ZS5zZXROYW1lKHRhcmdldHNbaV0uZ2V0TmFtZSgpKTsKICAg\nICAgICAgICAgICAgIHRtcGxhdGUuc2V0SmF2YVR5cGUodGFyZ2V0c1tpXS5n\nZXRKYXZhVHlwZSgpKTsKICAgICAgICAgICAgICAgIHRtcGxhdGUuc2V0VHlw\nZSh0YXJnZXRzW2ldLmdldFR5cGUoKSk7CiAgICAgICAgICAgICAgICB0bXBs\nYXRlLnNldFR5cGVOYW1lKHRhcmdldHNbaV0uZ2V0VHlwZU5hbWUoKSk7CiAg\nICAgICAgICAgICAgICB0bXBsYXRlLnNldFNpemUodGFyZ2V0c1tpXS5nZXRT\naXplKCkpOwogICAgICAgICAgICAgICAgdG1wbGF0ZS5zZXREZWNpbWFsRGln\naXRzKHRhcmdldHNbaV0uZ2V0RGVjaW1hbERpZ2l0cygpKTsKCiAgICAgICAg\nICAgICAgICBpZiAoZGVmICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nZGVmLnBvcHVsYXRlKHRhYmxlLCByZWwuZ2V0VGFibGUoKSwgdG1wbGF0ZSwg\ndGFyZ2V0c1tpXSwKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsIGks\nIHRhcmdldHMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGpvaW5zW2ldWzBd\nID0gbWVyZ2VDb2x1bW4oY29udGV4dCwgcHJlZml4LCB0bXBsYXRlLCB0cnVl\nLAogICAgICAgICAgICAgICAgICAgIG51bGwsIHRhYmxlLCBhZGFwdCwgZmls\nbCk7CiAgICAgICAgICAgICAgICBqb2luc1tpXVsxXSA9IHRhcmdldHNbaV07\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwogICAg\nICAgIH0KCiAgICAgICAgLy8gdXNlIGdpdmVuIGNvbHVtbnMgdG8gY3JlYXRl\nIGpvaW4uICB3ZSBkb24ndCB0cnkgdG8gdXNlIGFueSBvZiB0aGUKICAgICAg\nICAvLyB0ZW1wbGF0ZSBjb2x1bW5zLCBldmVuIGlmIHRoZSB1c2VyIGRvZXNu\nJ3QgZ2l2ZSBhIGNvbHVtbiBsaW5raW5nIHRvCiAgICAgICAgLy8gZXZlcnkg\ncHJpbWFyeSBrZXkgb2YgdGhlIHRhcmdldCB0eXBlIC0tIHVzZXJzIGFyZSBh\nbGxvd2VkIHRvIGNyZWF0ZQogICAgICAgIC8vIHBhcnRpYWwgam9pbnMuICB0\naGlzIG1lYW5zLCB0aG91Z2gsIHRoYXQgaWYgYSB1c2VyIHdhbnRzIHRvIHNw\nZWNpZnkKICAgICAgICAvLyBpbmZvIGZvciBvbmUgam9pbiBjb2x1bW4sIGhl\nIGhhcyB0byBhdCBsZWFzdCBjcmVhdGUgZWxlbWVudHMgZm9yCiAgICAgICAg\nLy8gYWxsIG9mIHRoZW0KCiAgICAgICAgam9pbnMgPSBuZXcgT2JqZWN0W2dp\ndmVuLnNpemUoKV1bM107CiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGpvaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGNvbCA9IChDb2x1bW4pIGdpdmVuLmdldChpKTsKICAgICAgICAg\nICAgbWVyZ2VKb2luQ29sdW1uKGNvbnRleHQsIHByZWZpeCwgY29sLCBqb2lu\ncywgaSwgdGFibGUsIGNscywgcmVsLAogICAgICAgICAgICAgICAgZGVmLCBp\nbnZlcnNhYmxlICYmICFjb2wuZ2V0RmxhZyhDb2x1bW4uRkxBR19QS19KT0lO\nKSwgYWRhcHQsCiAgICAgICAgICAgICAgICBmaWxsKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGpvaW5zOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIG9yIHJldHJpZXZlIGEgZm9yZWlnbiBrZXkgY29sdW1uIGZvciBhIGpv\naW4uCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRleHQgdGhlIG1hcHBpbmcg\nd2UncmUgcmV0cmlldmluZyBhIGtleSBmb3IKICAgICAqIEBwYXJhbSBwcmVm\naXggbG9jYWxpemVkIGVycm9yIG1lc3NhZ2Uga2V5IHByZWZpeAogICAgICog\nQHBhcmFtIGdpdmVuIHRoZSBnaXZlbiBsb2NhbCBmb3JlaWduIGtleSBjb2x1\nbW4KICAgICAqIEBwYXJhbSBqb2lucyBhcnJheSBvZiBqb2lucwogICAgICog\nQHBhcmFtIGlkeCBpbmRleCBvZiB0aGUgam9pbiBhcnJheSB0byBwb3B1bGF0\nZQogICAgICogQHBhcmFtIHRhYmxlIHRoZSB0YWJsZSBmb3IgdGhlIGtleQog\nICAgICogQHBhcmFtIGNscyB0aGUgdHlwZSB3ZSdyZSBqb2luaW5nIGZyb20K\nICAgICAqIEBwYXJhbSByZWwgdGFyZ2V0IHR5cGUgd2UncmUgam9pbmluZyB0\nbwogICAgICogQHBhcmFtIGRlZiBmb3JlaWduIGtleSBkZWZhdWx0cyBwcm92\naWRlcjsKICAgICAqIHVzZSBudWxsIHRvIG1pcnJvciB0YXJnZXQgY29sdW1u\nIG5hbWVzCiAgICAgKiBAcGFyYW0gaW52ZXJzYWJsZSB3aGV0aGVyIHRoZSBm\nb3JlaWduIGtleSBjYW4gYmUgaW52ZXJzZWQKICAgICAqIEBwYXJhbSBhZGFw\ndCB3aGV0aGVyIHdlIGNhbiBtb2RpZnkgdGhlIGV4aXN0aW5nIG1hcHBpbmcg\nb3Igc2NoZW1hCiAgICAgKiBAcGFyYW0gZmlsbCB3aGV0aGVyIHRvIGRlZmF1\nbHQgbWlzc2luZyBjb2x1bW4gaW5mb3JtYXRpb24KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIG1lcmdlSm9pbkNvbHVtbihNZXRhRGF0YUNvbnRleHQgY29u\ndGV4dCwgU3RyaW5nIHByZWZpeCwKICAgICAgICBDb2x1bW4gZ2l2ZW4sIE9i\namVjdFtdW10gam9pbnMsIGludCBpZHgsIFRhYmxlIHRhYmxlLCBDbGFzc01h\ncHBpbmcgY2xzLAogICAgICAgIENsYXNzTWFwcGluZyByZWwsIEZvcmVpZ25L\nZXlEZWZhdWx0cyBkZWYsIGJvb2xlYW4gaW52ZXJzYWJsZSwKICAgICAgICBi\nb29sZWFuIGFkYXB0LCBib29sZWFuIGZpbGwpIHsKICAgICAgICAvLyBkZWZh\ndWx0IHRvIHRoZSBwcmltYXJ5IGtleSBjb2x1bW4gbmFtZSBpZiB0aGlzIGlz\nIGEgcGsgam9pbgogICAgICAgIFN0cmluZyBuYW1lID0gZ2l2ZW4uZ2V0TmFt\nZSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwgJiYgZ2l2ZW4gIT0gbnVs\nbAogICAgICAgICAgICAmJiBnaXZlbi5nZXRGbGFnKENvbHVtbi5GTEFHX1BL\nX0pPSU4pICYmIGNscyAhPSBudWxsKSB7CiAgICAgICAgICAgIENvbHVtbltd\nIHBrcyA9IGNscy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgICAg\nICBpZiAocGtzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICAgICAgbmFtZSA9\nIHBrc1swXS5nZXROYW1lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB3\nZSBjYW4ndCBhZGFwdCwgdGhlbiB0aGUgdXNlciBtdXN0IGF0IGxlYXN0IGdp\ndmUgYSBjb2x1bW4gbmFtZQogICAgICAgIGlmIChuYW1lID09IG51bGwgJiYg\nIWFkYXB0ICYmICFmaWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1uby1ma2NvbC1uYW1l\nIiwKICAgICAgICAgICAgICAgIGNvbnRleHQpKTsKCiAgICAgICAgLy8gY2hl\nY2sgdG8gc2VlIGlmIHRoZSBjb2x1bW4gaXNuJ3QgaW4gdGhlIGV4cGVjdGVk\nIHRhYmxlOyBpdCBtaWdodAogICAgICAgIC8vIGJlIGFuIGludmVyc2Ugam9p\nbiBvciBhIGpvaW4gdG8gYSBiYXNlIGNsYXNzIG9mIHRoZSB0YXJnZXQgdHlw\nZQogICAgICAgIFRhYmxlIGxvY2FsID0gdGFibGU7CiAgICAgICAgVGFibGUg\nZm9yZWlnbiA9IHJlbC5nZXRUYWJsZSgpOwogICAgICAgIGJvb2xlYW4gZnVs\nbE5hbWUgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGludmVyc2UgPSBmYWxz\nZTsKICAgICAgICBpZiAobmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlu\ndCBkb3RJZHggPSBuYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgICAgICAg\nIGlmIChkb3RJZHggIT0gLTEpIHsKICAgICAgICAgICAgICAgIC8vIGFsbG93\nIHVzZSBvZiAnLicgd2l0aG91dCBwcmVmaXggdG8gbWVhbiAidXNlIGV4cGVj\ndGVkCiAgICAgICAgICAgICAgICAvLyBmb3JlaWduIHRhYmxlIgogICAgICAg\nICAgICAgICAgaWYgKGRvdElkeCA9PSAwKQogICAgICAgICAgICAgICAgICAg\nIGxvY2FsID0gZm9yZWlnbjsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgICAgICBsb2NhbCA9IGZpbmRUYWJsZShjb250ZXh0LCBuYW1l\nLnN1YnN0cmluZygwLCBkb3RJZHgpLAogICAgICAgICAgICAgICAgICAgICAg\nICBsb2NhbCwgZm9yZWlnbiwgbnVsbCk7CiAgICAgICAgICAgICAgICBmdWxs\nTmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJz\ndHJpbmcoZG90SWR4ICsgMSk7CgogICAgICAgICAgICAgICAgLy8gaWYgaW52\nZXJzZSBqb2luLCB0aGVuIHN3YXAgbG9jYWwgYW5kIGZvcmVpZ24gdGFibGVz\nCiAgICAgICAgICAgICAgICBpZiAobG9jYWwgIT0gdGFibGUpIHsKICAgICAg\nICAgICAgICAgICAgICBmb3JlaWduID0gdGFibGU7CiAgICAgICAgICAgICAg\nICAgICAgaW52ZXJzZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYm9vbGVhbiBmb3JjZUludmVy\nc2UgPSAhZnVsbE5hbWUgJiYgX2pvaW4gPT0gSk9JTl9JTlZFUlNFOwogICAg\nICAgIGlmIChmb3JjZUludmVyc2UpIHsKICAgICAgICAgICAgbG9jYWwgPSBm\nb3JlaWduOwogICAgICAgICAgICBmb3JlaWduID0gdGFibGU7CiAgICAgICAg\nICAgIGludmVyc2UgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gZGV0\nZXJtaW5lIHRhcmdldAogICAgICAgIFN0cmluZyB0YXJnZXROYW1lID0gZ2l2\nZW4uZ2V0VGFyZ2V0KCk7CiAgICAgICAgT2JqZWN0IHRhcmdldCA9IG51bGw7\nCiAgICAgICAgVGFibGUgdHRhYmxlID0gbnVsbDsKICAgICAgICBib29sZWFu\nIGNvbnN0YW50ID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBmdWxsVGFyZ2V0\nID0gZmFsc2U7CiAgICAgICAgaWYgKHRhcmdldE5hbWUgPT0gbnVsbCAmJiBn\naXZlbi5nZXRUYXJnZXRGaWVsZCgpICE9IG51bGwpIHsKICAgICAgICAgICAg\nQ2xhc3NNYXBwaW5nIHRjbHMgPSAoaW52ZXJzZSkgPyBjbHMgOiByZWw7CiAg\nICAgICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSBnaXZlbi5nZXRUYXJnZXRG\naWVsZCgpOwogICAgICAgICAgICBpbnQgZG90SWR4ID0gZmllbGROYW1lLmxh\nc3RJbmRleE9mKCcuJyk7CiAgICAgICAgICAgIGZ1bGxUYXJnZXQgPSBkb3RJ\nZHggIT0gLTE7CgogICAgICAgICAgICBpZiAoZG90SWR4ID09IDApIHsKICAg\nICAgICAgICAgICAgIC8vIGFsbG93IHVzZSBvZiAnLicgd2l0aG91dCBwcmVm\naXggdG8gbWVhbiAidXNlIGV4cGVjdGVkIGxvY2FsCiAgICAgICAgICAgICAg\nICAvLyBjbHMiOyBidXQgaWYgd2UgYWxyZWFkeSBpbnZlcnNlZCBubyBuZWVk\nIHRvIHN3aXRjaCBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCFpbnZlcnNl\nKQogICAgICAgICAgICAgICAgICAgIHRjbHMgPSBjbHM7CiAgICAgICAgICAg\nICAgICBmaWVsZE5hbWUgPSBmaWVsZE5hbWUuc3Vic3RyaW5nKDEpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGRvdElkeCA+IDApIHsKICAgICAgICAgICAg\nICAgIC8vIG11c3QgYmUgY2xhc3MgKyBmaWVsZCBuYW1lCiAgICAgICAgICAg\nICAgICB0Y2xzID0gZmluZENsYXNzTWFwcGluZyhjb250ZXh0LCBmaWVsZE5h\nbWUuc3Vic3RyaW5nCiAgICAgICAgICAgICAgICAgICAgKDAsIGRvdElkeCks\nIGNscywgcmVsKTsKICAgICAgICAgICAgICAgIGZpZWxkTmFtZSA9IGZpZWxk\nTmFtZS5zdWJzdHJpbmcoZG90SWR4ICsgMSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKHRjbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAg\nICAgICAgICAgICAgICAgICArICItYmFkLWZrdGFyZ2V0Y2xzIiwgY29udGV4\ndCwgZmllbGROYW1lLCBuYW1lKSk7CgogICAgICAgICAgICBGaWVsZE1hcHBp\nbmcgZmllbGQgPSB0Y2xzLmdldEZpZWxkTWFwcGluZyhmaWVsZE5hbWUpOwog\nICAgICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgK\nICAgICAgICAgICAgICAgICAgICArICItYmFkLWZrdGFyZ2V0ZmllbGQiLCBu\nZXcgT2JqZWN0W117IGNvbnRleHQsIGZpZWxkTmFtZSwKICAgICAgICAgICAg\nICAgICAgICBuYW1lLCB0Y2xzIH0pKTsKICAgICAgICAgICAgaWYgKGZpZWxk\nLmdldENvbHVtbnMoKS5sZW5ndGggIT0gMSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAg\nICAgICAgICAgICAgICAgICArICItZmt0YXJnZXRmaWVsZC1jb2xzIiwgY29u\ndGV4dCwgZmllbGROYW1lLCBuYW1lKSk7CiAgICAgICAgICAgIHR0YWJsZSA9\nIChmaWVsZC5nZXRKb2luRm9yZWlnbktleSgpICE9IG51bGwpID8gZmllbGQu\nZ2V0VGFibGUoKQogICAgICAgICAgICAgICAgOiBmaWVsZC5nZXREZWZpbmlu\nZ01hcHBpbmcoKS5nZXRUYWJsZSgpOwogICAgICAgICAgICB0YXJnZXROYW1l\nID0gZmllbGQuZ2V0Q29sdW1ucygpWzBdLmdldE5hbWUoKTsKICAgICAgICB9\nIGVsc2UgaWYgKHRhcmdldE5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAodGFyZ2V0TmFtZS5jaGFyQXQoMCkgPT0gJ1wnJykgewogICAgICAgICAg\nICAgICAgY29uc3RhbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGFyZ2V0\nID0gdGFyZ2V0TmFtZS5zdWJzdHJpbmcoMSwgdGFyZ2V0TmFtZS5sZW5ndGgo\nKSAtIDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldE5hbWUuY2hh\nckF0KDApID09ICctJwogICAgICAgICAgICAgICAgfHwgdGFyZ2V0TmFtZS5j\naGFyQXQoMCkgPT0gJy4nCiAgICAgICAgICAgICAgICB8fCBDaGFyYWN0ZXIu\naXNEaWdpdCh0YXJnZXROYW1lLmNoYXJBdCgwKSkpIHsKICAgICAgICAgICAg\nICAgIGNvbnN0YW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldE5hbWUuaW5kZXhPZignLicp\nID09IC0xKQogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBuZXcg\nSW50ZWdlcih0YXJnZXROYW1lKTsKICAgICAgICAgICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IG5ldyBEb3VibGUo\ndGFyZ2V0TmFtZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KHByZWZpeAogICAgICAgICAg\nICAgICAgICAgICAgICArICItYmFkLWZrY29uc3QiLCBjb250ZXh0LCB0YXJn\nZXROYW1lLCBuYW1lKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0gZWxzZSBpZiAoIm51bGwiLmVxdWFsc0lnbm9yZUNhc2UodGFyZ2V0TmFt\nZSkpCiAgICAgICAgICAgICAgICBjb25zdGFudCA9IHRydWU7CiAgICAgICAg\nICAgIGVsc2UgewogICAgICAgICAgICAgICAgaW50IGRvdElkeCA9IHRhcmdl\ndE5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgICAgICAgICAgIGZ1bGxU\nYXJnZXQgPSBkb3RJZHggIT0gLTE7CiAgICAgICAgICAgICAgICBpZiAoZG90\nSWR4ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBhbGxvdyB1c2Ug\nb2YgJy4nIHdpdGhvdXQgcHJlZml4IHRvIG1lYW4gInVzZSBleHBlY3RlZAog\nICAgICAgICAgICAgICAgICAgIC8vIGxvY2FsIHRhYmxlIiwgYnV0IGlnbm9y\nZSBpZiB3ZSdyZSBhbHJlYWR5IGludmVyc2VkCiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFpbnZlcnNlKQogICAgICAgICAgICAgICAgICAgICAgICB0dGFi\nbGUgPSBsb2NhbDsKICAgICAgICAgICAgICAgICAgICB0YXJnZXROYW1lID0g\ndGFyZ2V0TmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKGRvdElkeCAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIHR0\nYWJsZSA9IGZpbmRUYWJsZShjb250ZXh0LCB0YXJnZXROYW1lLnN1YnN0cmlu\nZygwLAogICAgICAgICAgICAgICAgICAgICAgICBkb3RJZHgpLCBmb3JlaWdu\nLCBsb2NhbCwgKGludmVyc2UpID8gY2xzIDogcmVsKTsKICAgICAgICAgICAg\nICAgICAgICB0YXJnZXROYW1lID0gdGFyZ2V0TmFtZS5zdWJzdHJpbmcoZG90\nSWR4ICsgMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIHVzZSBleHBsaWNpdCB0YXJnZXQgdGFibGUg\naWYgYXZhaWxhYmxlCiAgICAgICAgaWYgKHR0YWJsZSA9PSBsb2NhbCAmJiBs\nb2NhbCAhPSBmb3JlaWduKSB7CiAgICAgICAgICAgIC8vIHN3YXAsIHVubGVz\ncyB1c2VyIGdhdmUgaW5jb21wYXRpYmxlIHRhYmxlIGluIGNvbHVtbiBuYW1l\nCiAgICAgICAgICAgIGlmIChmdWxsTmFtZSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXgKICAg\nICAgICAgICAgICAgICAgICArICItYmFkLWZrdGFyZ2V0LWludmVyc2UiLCBu\nZXcgT2JqZWN0W117IGNvbnRleHQsIG5hbWUsCiAgICAgICAgICAgICAgICAg\nICAgZm9yZWlnbiwgdHRhYmxlIH0pKTsKICAgICAgICAgICAgbG9jYWwgPSBm\nb3JlaWduOwogICAgICAgICAgICBmb3JlaWduID0gdHRhYmxlOwogICAgICAg\nIH0gZWxzZSBpZiAodHRhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgLy8g\ndHRhYmxlIG1pZ2h0IGJlIGEgdGFibGUgb2YgYSBiYXNlIGNsYXNzIG9mIHRo\nZSB0YXJnZXQKICAgICAgICAgICAgZm9yZWlnbiA9IHR0YWJsZTsKICAgICAg\nICB9CgogICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB3ZSBpbnZlcnNlZDsg\naWYgdGhpcyBpcyBhIHNhbWUtdGFibGUgam9pbiwgdGhlbgogICAgICAgIC8v\nIGNvbnNpZGVyIGl0IGFuIGltcGxpY2l0IGludmVyc2UgaWYgdGhlIHVzZXIg\naW5jbHVkZXMgdGhlIHRhYmxlIG5hbWUKICAgICAgICAvLyBpbiB0aGUgY29s\ndW1uIG5hbWUsIGJ1dCBub3QgaW4gdGhlIGNvbHVtbiB0YXJnZXQsIG9yIGlm\nIHRoZSB1c2VyCiAgICAgICAgLy8gZ2l2ZXMgbm8gY29sdW1uIG5hbWUgYnV0\nIGEgZnVsbCB0YXJnZXQgbmFtZQogICAgICAgIGludmVyc2UgPSBpbnZlcnNl\nIHx8IGxvY2FsICE9IHRhYmxlIHx8IChsb2NhbCA9PSBmb3JlaWduCiAgICAg\nICAgICAgICYmICgoZnVsbE5hbWUgJiYgIWZ1bGxUYXJnZXQpIHx8IChuYW1l\nID09IG51bGwgJiYgZnVsbFRhcmdldCkpKTsKICAgICAgICBpZiAoIWludmVy\nc2FibGUgJiYgIWNvbnN0YW50ICYmIGludmVyc2UpIHsKICAgICAgICAgICAg\naWYgKGxvY2FsID09IGZvcmVpZ24pCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAg\nICAgICAgICAgICAgKyAiLWJhZC1may1zZWxmLWludmVyc2UiLCBjb250ZXh0\nLCBsb2NhbCkpOwogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQocHJlZml4ICsgIi1iYWQtZmstaW52ZXJzZSIsCiAg\nICAgICAgICAgICAgICBjb250ZXh0LCBsb2NhbCwgdGFibGUpKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCAmJiBjb25zdGFudCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKHByZWZpeAogICAgICAgICAgICAgICAgKyAiLW5vLWZrY29sLW5hbWUtYWRh\ncHQiLCBjb250ZXh0KSk7CgogICAgICAgIGlmIChuYW1lID09IG51bGwgJiYg\ndGFyZ2V0TmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIG5h\nbWUgb3IgdGFyZ2V0IGlzIHByb3ZpZGVkIGFuZCB0aGVyZSdzIG1vcmUgdGhh\nbiBvbmUgbGlrZWx5CiAgICAgICAgICAgIC8vIGpvaW4gcG9zc2liaWxpdHks\nIHRvbyBhbWJpZ3VvdXMKICAgICAgICAgICAgUHJpbWFyeUtleSBwayA9IGZv\ncmVpZ24uZ2V0UHJpbWFyeUtleSgpOwogICAgICAgICAgICBpZiAoam9pbnMu\nbGVuZ3RoICE9IDEgfHwgcGsgPT0gbnVsbCB8fCBway5nZXRDb2x1bW5zKCku\nbGVuZ3RoICE9IDEpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAg\nICAgKyAiLW5vLWZrY29sLW5hbWUtYWRhcHQiLCBjb250ZXh0KSk7CgogICAg\nICAgICAgICAvLyBhc3N1bWUgdGFyZ2V0IGlzIHBrIGNvbHVtbgogICAgICAg\nICAgICB0YXJnZXROYW1lID0gcGsuZ2V0Q29sdW1ucygpWzBdLmdldE5hbWUo\nKTsKICAgICAgICB9IGVsc2UgaWYgKG5hbWUgIT0gbnVsbCAmJiB0YXJnZXRO\nYW1lID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgb25lIHByaW1hcnkg\na2V5IGNvbHVtbiB1c2UgaXQgZm9yIHRhcmdldDsgaWYgbXVsdGlwbGUgam9p\nbnMKICAgICAgICAgICAgLy8gbG9vayBmb3IgYSBmb3JlaWduIGNvbHVtbiB3\naXRoIHNhbWUgbmFtZSBhcyBsb2NhbCBjb2x1bW4KICAgICAgICAgICAgUHJp\nbWFyeUtleSBwayA9IGZvcmVpZ24uZ2V0UHJpbWFyeUtleSgpOwogICAgICAg\nICAgICBpZiAoam9pbnMubGVuZ3RoID09IDEgJiYgcGsgIT0gbnVsbCAmJiBw\nay5nZXRDb2x1bW5zKCkubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICB0\nYXJnZXROYW1lID0gcGsuZ2V0Q29sdW1ucygpWzBdLmdldE5hbWUoKTsKICAg\nICAgICAgICAgZWxzZSBpZiAoZm9yZWlnbi5nZXRDb2x1bW4obmFtZSkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSBuYW1lOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURh\ndGFFeGNlcHRpb24oX2xvYy5nZXQocHJlZml4CiAgICAgICAgICAgICAgICAg\nICAgKyAiLW5vLWZrY29sLXRhcmdldC1hZGFwdCIsIGNvbnRleHQsIG5hbWUp\nKTsKICAgICAgICB9CgogICAgICAgIC8vIGZpbmQgdGhlIHRhcmdldCBjb2x1\nbW4sIGFuZCBjcmVhdGUgdGVtcGxhdGUgZm9yIGxvY2FsIGNvbHVtbiBiYXNl\nZAogICAgICAgIC8vIG9uIGl0CiAgICAgICAgQ29sdW1uIHRtcGxhdGUgPSBu\nZXcgQ29sdW1uKCk7CiAgICAgICAgdG1wbGF0ZS5zZXROYW1lKG5hbWUpOwog\nICAgICAgIGlmICghY29uc3RhbnQpIHsKICAgICAgICAgICAgQ29sdW1uIHRj\nb2wgPSBmb3JlaWduLmdldENvbHVtbih0YXJnZXROYW1lKTsKICAgICAgICAg\nICAgaWYgKHRjb2wgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldChwcmVmaXggKyAiLWJhZC1m\na3RhcmdldCIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBj\nb250ZXh0LCB0YXJnZXROYW1lLCBuYW1lLCBmb3JlaWduIH0pKTsKCiAgICAg\nICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICB0bXBs\nYXRlLnNldE5hbWUodGNvbC5nZXROYW1lKCkpOwogICAgICAgICAgICB0bXBs\nYXRlLnNldEphdmFUeXBlKHRjb2wuZ2V0SmF2YVR5cGUoKSk7CiAgICAgICAg\nICAgIHRtcGxhdGUuc2V0VHlwZSh0Y29sLmdldFR5cGUoKSk7CiAgICAgICAg\nICAgIHRtcGxhdGUuc2V0VHlwZU5hbWUodGNvbC5nZXRUeXBlTmFtZSgpKTsK\nICAgICAgICAgICAgdG1wbGF0ZS5zZXRTaXplKHRjb2wuZ2V0U2l6ZSgpKTsK\nICAgICAgICAgICAgdG1wbGF0ZS5zZXREZWNpbWFsRGlnaXRzKHRjb2wuZ2V0\nRGVjaW1hbERpZ2l0cygpKTsKICAgICAgICAgICAgdGFyZ2V0ID0gdGNvbDsK\nICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFN0cmluZykK\nICAgICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlwZXMuU1RS\nSU5HKTsKICAgICAgICBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJbnRl\nZ2VyKQogICAgICAgICAgICB0bXBsYXRlLnNldEphdmFUeXBlKEphdmFUeXBl\ncy5JTlQpOwogICAgICAgIGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIERv\ndWJsZSkKICAgICAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShKYXZhVHlw\nZXMuRE9VQkxFKTsKCiAgICAgICAgLy8gcG9wdWxhdGUgdGVtcGxhdGUsIGJ1\ndCBsZXQgdXNlci1naXZlbiBuYW1lIG92ZXJyaWRlIGRlZmF1bHQgbmFtZQog\nICAgICAgIGlmIChkZWYgIT0gbnVsbCkKICAgICAgICAgICAgZGVmLnBvcHVs\nYXRlKGxvY2FsLCBmb3JlaWduLCB0bXBsYXRlLCB0YXJnZXQsIGludmVyc2Us\nIGlkeCwKICAgICAgICAgICAgICAgIGpvaW5zLmxlbmd0aCk7CiAgICAgICAg\naWYgKG5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgdG1wbGF0ZS5zZXROYW1l\nKG5hbWUpOwoKICAgICAgICAvLyBjcmVhdGUgb3IgbWVyZ2UgbG9jYWwgY29s\ndW1uCiAgICAgICAgQ29sdW1uIGNvbCA9IG1lcmdlQ29sdW1uKGNvbnRleHQs\nIHByZWZpeCwgdG1wbGF0ZSwgdHJ1ZSwgZ2l2ZW4sIGxvY2FsLAogICAgICAg\nICAgICBhZGFwdCwgZmlsbCk7CgogICAgICAgIGpvaW5zW2lkeF1bMF0gPSBj\nb2w7CiAgICAgICAgam9pbnNbaWR4XVsxXSA9IHRhcmdldDsKICAgICAgICBp\nZiAoaW52ZXJzZSkKICAgICAgICAgICAgam9pbnNbaWR4XVsyXSA9IEJvb2xl\nYW4uVFJVRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgdGhlIHRhcmdl\ndCBjbGFzcyBtYXBwaW5nIGdpdmVuIHRoZSB1c2VyJ3MgY2xhc3MgbmFtZS4K\nICAgICAqCiAgICAgKiBAcGFyYW0gY29udGV4dCBmb3IgZXJyb3IgbWVzc2Fn\nZXMKICAgICAqIEBwYXJhbSBjbHNOYW1lIGNsYXNzIG5hbWUgZ2l2ZW4gYnkg\ndXNlcgogICAgICogQHBhcmFtIGNscyBvcmlnaW5hbCBzb3VyY2UgbWFwcGlu\nZwogICAgICogQHBhcmFtIHJlbCBvcmlnaW5hbCB0YXJnZXQgbWFwcGluZwog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzc01hcHBpbmcgZmluZENs\nYXNzTWFwcGluZyhNZXRhRGF0YUNvbnRleHQgY29udGV4dCwKICAgICAgICBT\ndHJpbmcgY2xzTmFtZSwgQ2xhc3NNYXBwaW5nIGNscywgQ2xhc3NNYXBwaW5n\nIHJlbCkgewogICAgICAgIGlmIChpc0NsYXNzTWFwcGluZ05hbWUoY2xzTmFt\nZSwgY2xzKSkKICAgICAgICAgICAgcmV0dXJuIGNsczsKICAgICAgICBpZiAo\naXNDbGFzc01hcHBpbmdOYW1lKGNsc05hbWUsIHJlbCkpCiAgICAgICAgICAg\nIHJldHVybiByZWw7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJ0YXJnZXQtd3JvbmctY2xzIiwgbmV3IE9iamVjdFtd\nCiAgICAgICAgICAgIHsgY29udGV4dCwgY2xzTmFtZSwgY2xzLCByZWwgfSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdp\ndmVuIG5hbWUgbWF0Y2hlcyB0aGUgZ2l2ZW4gbWFwcGluZy4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBpc0NsYXNzTWFwcGluZ05hbWUo\nU3RyaW5nIG5hbWUsIENsYXNzTWFwcGluZyBjbHMpIHsKICAgICAgICBpZiAo\nY2xzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBpZiAobmFtZS5lcXVhbHMoY2xzLmdldERlc2NyaWJlZFR5cGUoKS5nZXRO\nYW1lKCkpCiAgICAgICAgICAgIHx8IG5hbWUuZXF1YWxzKFN0cmluZ3MuZ2V0\nQ2xhc3NOYW1lKGNscy5nZXREZXNjcmliZWRUeXBlKCkpKSkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGlzQ2xhc3NNYXBwaW5n\nTmFtZShuYW1lLCBjbHMuZ2V0UENTdXBlcmNsYXNzTWFwcGluZygpKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldHMgaW50ZXJuYWwgY29sdW1uIGluZm9y\nbWF0aW9uIHRvIG1hdGNoIHRoZSBnaXZlbiBtYXBwZWQgY29sdW1ucy4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZm9yY2VKREJDVHlwZSB3aGV0aGVyIHRvIGZv\ncmNlIHRoZSBqZGJjLXR5cGUgb2YgdGhlIGNvbHVtbnMKICAgICAqIHRvIGJl\nIHNldCwgZXZlbiB3aGVuIGl0IG1hdGNoZXMgdGhlIGRlZmF1bHQgZm9yIHRo\nZSBjb2x1bW5zJyBqYXZhIHR5cGUKICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc3luY0NvbHVtbnMoTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIENvbHVt\nbltdIGNvbHMsCiAgICAgICAgYm9vbGVhbiBmb3JjZUpEQkNUeXBlKSB7CiAg\nICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICBfY29scyA9IG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgIF9jb2xzID0gbmV3IEFycmF5TGlzdChjb2xzLmxlbmd0aCk7CiAg\nICAgICAgICAgIENvbHVtbiBjb2w7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nY29sID0gc3luY0NvbHVtbihjb250ZXh0LCBjb2xzW2ldLCBjb2xzLmxlbmd0\naCwKICAgICAgICAgICAgICAgICAgICBmb3JjZUpEQkNUeXBlLCBjb2xzW2ld\nLmdldFRhYmxlKCksIG51bGwsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIHNldENvbHVtbkZsYWdzRnJvbUlPKGNvbCwgaSk7CiAgICAgICAgICAg\nICAgICBfY29scy5hZGQoY29sKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCBJL08gZmxhZ3Mgb24gdGhlIGNv\nbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNldENvbHVtbkZsYWdz\nRnJvbUlPKENvbHVtbiBjb2wsIGludCBpKSB7CiAgICAgICAgaWYgKF9pbyA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgY29sLnNldEZs\nYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUsICFfaW8uaXNVcGRhdGFibGUo\naSwgZmFsc2UpKTsKICAgICAgICBjb2wuc2V0RmxhZyhDb2x1bW4uRkxBR19V\nTklOU0VSVEFCTEUsICFfaW8uaXNJbnNlcnRhYmxlKGksIGZhbHNlKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXRzIGludGVybmFsIGluZGV4IGluZm9y\nbWF0aW9uIHRvIG1hdGNoIGdpdmVuIG1hcHBlZCBpbmRleC4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgc3luY0luZGV4KE1ldGFEYXRhQ29udGV4dCBj\nb250ZXh0LCBJbmRleCBpZHgpIHsKICAgICAgICBpZiAoaWR4ID09IG51bGwp\nIHsKICAgICAgICAgICAgX2lkeCA9IG51bGw7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIF9jYW5JZHggPSB0cnVlOwogICAgICAg\nIF9pZHggPSBuZXcgSW5kZXgoKTsKICAgICAgICBfaWR4LnNldE5hbWUoaWR4\nLmdldE5hbWUoKSk7CiAgICAgICAgX2lkeC5zZXRVbmlxdWUoaWR4LmlzVW5p\ncXVlKCkpOwogICAgICAgIGlmIChpZHguZ2V0Q29sdW1ucygpICE9IG51bGwg\nJiYgaWR4LmdldENvbHVtbnMoKS5sZW5ndGggPiAxKQogICAgICAgICAgICBf\naWR4LnNldENvbHVtbnMoaWR4LmdldENvbHVtbnMoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXRzIGludGVybmFsIGNvbnN0cmFpbnQgaW5mb3JtYXRp\nb24gdG8gbWF0Y2ggZ2l2ZW4gbWFwcGVkIGNvbnN0cmFpbnQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHN5bmNVbmlxdWUoTWV0YURhdGFDb250ZXh0\nIGNvbnRleHQsIFVuaXF1ZSB1bnEpIHsKICAgICAgICBpZiAodW5xID09IG51\nbGwpIHsKICAgICAgICAgICAgX3VucSA9IG51bGw7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIF9jYW5VbnEgPSB0cnVlOwogICAg\nICAgIF91bnEgPSBuZXcgVW5pcXVlKCk7CiAgICAgICAgX3VucS5zZXROYW1l\nKHVucS5nZXROYW1lKCkpOwogICAgICAgIF91bnEuc2V0RGVmZXJyZWQodW5x\nLmlzRGVmZXJyZWQoKSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogU2V0\ncyBpbnRlcm5hbCBjb25zdHJhaW50IGFuZCBjb2x1bW4gaW5mb3JtYXRpb24g\ndG8gbWF0Y2ggZ2l2ZW4gbWFwcGVkCiAgICAgKiBjb25zdHJhaW50LgogICAg\nICoKICAgICAqIEBwYXJhbSBsb2NhbCBkZWZhdWx0IGxvY2FsIHRhYmxlCiAg\nICAgKiBAcGFyYW0gdGFyZ2V0IGRlZmF1bHQgdGFyZ2V0IHRhYmxlCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIHN5bmNGb3JlaWduS2V5KE1ldGFEYXRh\nQ29udGV4dCBjb250ZXh0LCBGb3JlaWduS2V5IGZrLAogICAgICAgIFRhYmxl\nIGxvY2FsLCBUYWJsZSB0YXJnZXQpIHsKICAgICAgICBpZiAoZmsgPT0gbnVs\nbCkgewogICAgICAgICAgICBfZmsgPSBudWxsOwogICAgICAgICAgICBfY29s\ncyA9IG51bGw7CiAgICAgICAgICAgIF9qb2luID0gSk9JTl9OT05FOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChfam9pbiA9\nPSBKT0lOX05PTkUpCiAgICAgICAgICAgIF9qb2luID0gSk9JTl9GT1JXQVJE\nOwoKICAgICAgICBpZiAoZmsuaXNMb2dpY2FsKCkpCiAgICAgICAgICAgIF9m\nayA9IG51bGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF9jYW5GSyA9\nIHRydWU7CiAgICAgICAgICAgIF9mayA9IG5ldyBGb3JlaWduS2V5KCk7CiAg\nICAgICAgICAgIF9may5zZXROYW1lKGZrLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgIF9may5zZXREZWxldGVBY3Rpb24oZmsuZ2V0RGVsZXRlQWN0aW9uKCkp\nOwogICAgICAgICAgICBfZmsuc2V0VXBkYXRlQWN0aW9uKGZrLmdldFVwZGF0\nZUFjdGlvbigpKTsKICAgICAgICAgICAgX2ZrLnNldERlZmVycmVkKGZrLmlz\nRGVmZXJyZWQoKSk7CiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHBrQ29scyA9\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10g\nY2NvbHMgPSBmay5nZXRDb25zdGFudENvbHVtbnMoKTsKICAgICAgICBPYmpl\nY3RbXSBjcyA9IGZrLmdldENvbnN0YW50cygpOwogICAgICAgIENvbHVtbltd\nIGNwa0NvbHMgPSBmay5nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCk7\nCiAgICAgICAgT2JqZWN0W10gY3BrcyA9IGZrLmdldFByaW1hcnlLZXlDb25z\ndGFudHMoKTsKCiAgICAgICAgaW50IHNpemUgPSBjb2xzLmxlbmd0aCArIGNj\nb2xzLmxlbmd0aCArIGNwa0NvbHMubGVuZ3RoOwogICAgICAgIF9jb2xzID0g\nbmV3IEFycmF5TGlzdChzaXplKTsKICAgICAgICBDb2x1bW4gY29sOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBjb2wgPSBzeW5jQ29sdW1uKGNvbnRleHQsIGNvbHNbaV0s\nIHNpemUsIGZhbHNlLCBsb2NhbCwKICAgICAgICAgICAgICAgIHRhcmdldCwg\ncGtDb2xzW2ldLCBfam9pbiA9PSBKT0lOX0lOVkVSU0UpOwogICAgICAgICAg\nICBzZXRDb2x1bW5GbGFnc0Zyb21JTyhjb2wsIGkpOwogICAgICAgICAgICBf\nY29scy5hZGQoY29sKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0IGNvbnN0\nYW50OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2NvbHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgY29uc3RhbnQgPSAoY3NbaV0gPT0gbnVs\nbCkgPyBOVUxMIDogY3NbaV07CiAgICAgICAgICAgIGNvbCA9IHN5bmNDb2x1\nbW4oY29udGV4dCwgY2NvbHNbaV0sIHNpemUsIGZhbHNlLCBsb2NhbCwKICAg\nICAgICAgICAgICAgIHRhcmdldCwgY29uc3RhbnQsIF9qb2luID09IEpPSU5f\nSU5WRVJTRSk7CiAgICAgICAgICAgIHNldENvbHVtbkZsYWdzRnJvbUlPKGNv\nbCwgY29scy5sZW5ndGggKyBpKTsKICAgICAgICAgICAgX2NvbHMuYWRkKGNv\nbCk7CiAgICAgICAgfQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY3Br\nQ29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdGFudCA9IChj\ncGtzW2ldID09IG51bGwpID8gTlVMTCA6IGNwa3NbaV07CiAgICAgICAgICAg\nIF9jb2xzLmFkZChzeW5jQ29sdW1uKGNvbnRleHQsIGNwa0NvbHNbaV0sIHNp\nemUsIGZhbHNlLCB0YXJnZXQsCiAgICAgICAgICAgICAgICBsb2NhbCwgY29u\nc3RhbnQsIF9qb2luICE9IEpPSU5fSU5WRVJTRSkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIGNvcHkgb2YgdGhlIGdpdmVu\nIGNvbHVtbiB3aXRoIHRoZSByYXcgbWFwcGluZyBpbmZvcm1hdGlvbgogICAg\nICogc2V0IGNvcnJlY3RseSwgYW5kIHdpdGhvdXQgc2V0dGluZ3MgdGhhdCBt\nYXRjaCBkZWZhdWx0cy4KICAgICAqCiAgICAgKiBAcGFyYW0gbnVtIHRoZSBu\ndW1iZXIgb2YgY29sdW1ucyBmb3IgdGhpcyBtYXBwaW5nCiAgICAgKiBAcGFy\nYW0gZm9yY2VKREJDVHlwZSB3aGV0aGVyIHRoZSBqZGJjLXR5cGUgb2YgdGhl\nIGNyZWF0ZWQgY29sdW1uCiAgICAgKiBzaG91bGQgYmUgc2V0LCBldmVuIGlm\nIGl0IG1hdGNoZXMgdGhlIGRlZmF1bHQKICAgICAqIGZvciB0aGUgZ2l2ZW4g\nY29sdW1uJ3MgamF2YSB0eXBlCiAgICAgKiBAcGFyYW0gY29sVGFibGUgZXhw\nZWN0ZWQgdGFibGUgZm9yIHRoZSBjb2x1bW4KICAgICAqIEBwYXJhbSB0YXJn\nZXRUYWJsZSBleHBlY3RlZCB0YXJnZXQgdGFibGUgZm9yIGpvaW4gY29sdW1u\nCiAgICAgKiBAcGFyYW0gdGFyZ2V0IHRhcmdldCBjb2x1bW4gb3Igb2JqZWN0\nIGZvciBqb2luIGNvbHVtbjsgZm9yIGEKICAgICAqIGNvbnN0YW50IG51bGwg\ndGFyZ2V0LCB1c2Uge0BsaW5rICNOVUxMfQogICAgICogQHBhcmFtIGludmVy\nc2Ugd2hldGhlciBqb2luIGNvbHVtbiBpcyBmb3IgaW52ZXJzZSBqb2luCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgQ29sdW1uIHN5bmNDb2x1bW4o\nTWV0YURhdGFDb250ZXh0IGNvbnRleHQsIENvbHVtbiBjb2wsCiAgICAgICAg\naW50IG51bSwgYm9vbGVhbiBmb3JjZUpEQkNUeXBlLCBUYWJsZSBjb2xUYWJs\nZSwgVGFibGUgdGFyZ2V0VGFibGUsCiAgICAgICAgT2JqZWN0IHRhcmdldCwg\nYm9vbGVhbiBpbnZlcnNlKSB7CiAgICAgICAgLy8gdXNlIGZ1bGwgbmFtZSBm\nb3IgY29scyB0aGF0IGFyZW4ndCBpbiB0aGUgZXhwZWN0ZWQgdGFibGUsIG9y\nIHRoYXQKICAgICAgICAvLyBhcmUgaW52ZXJzZSBqb2lucwogICAgICAgIERC\nRGljdGlvbmFyeSBkaWN0ID0gKChNYXBwaW5nUmVwb3NpdG9yeSkgY29udGV4\ndC5nZXRSZXBvc2l0b3J5KCkpLgogICAgICAgICAgICBnZXREQkRpY3Rpb25h\ncnkoKTsKICAgICAgICBDb2x1bW4gY29weSA9IG5ldyBDb2x1bW4oKTsKICAg\nICAgICBpZiAoY29sLmdldFRhYmxlKCkgIT0gY29sVGFibGUgfHwgaW52ZXJz\nZSkKICAgICAgICAgICAgY29weS5zZXROYW1lKGRpY3QuZ2V0RnVsbE5hbWUo\nY29sLmdldFRhYmxlKCksIHRydWUpCiAgICAgICAgICAgICAgICArICIuIiAr\nIGNvbC5nZXROYW1lKCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29w\neS5zZXROYW1lKGNvbC5nZXROYW1lKCkpOwoKICAgICAgICAvLyBzZXQgdGFy\nZ2V0IGlmIG5vdCBkZWZhdWx0CiAgICAgICAgaWYgKHRhcmdldCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGlmICh0YXJnZXQgPT0gTlVMTCkKICAgICAgICAg\nICAgICAgIGNvcHkuc2V0VGFyZ2V0KCJudWxsIik7CiAgICAgICAgICAgIGVs\nc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIENvbHVtbikgewogICAgICAgICAg\nICAgICAgQ29sdW1uIHRjb2wgPSAoQ29sdW1uKSB0YXJnZXQ7CiAgICAgICAg\nICAgICAgICBpZiAoKCFpbnZlcnNlICYmIHRjb2wuZ2V0VGFibGUoKSAhPSB0\nYXJnZXRUYWJsZSkKICAgICAgICAgICAgICAgICAgICB8fCAoaW52ZXJzZSAm\nJiB0Y29sLmdldFRhYmxlKCkgIT0gY29sVGFibGUpKQogICAgICAgICAgICAg\nICAgICAgIGNvcHkuc2V0VGFyZ2V0KGRpY3QuZ2V0RnVsbE5hbWUodGNvbC5n\nZXRUYWJsZSgpLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICArICIu\nIiArIHRjb2wuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKCFkZWZhdWx0VGFyZ2V0KGNvbCwgdGNvbCwgbnVtKSkKICAgICAgICAgICAg\nICAgICAgICBjb3B5LnNldFRhcmdldCh0Y29sLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgTnVtYmVyKQog\nICAgICAgICAgICAgICAgY29weS5zZXRUYXJnZXQodGFyZ2V0LnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb3B5LnNl\ndFRhcmdldCgiJyIgKyB0YXJnZXQgKyAiJyIpOwogICAgICAgIH0gZWxzZSBp\nZiAobnVtID4gMSkKICAgICAgICAgICAgY29weS5zZXRUYXJnZXRGaWVsZChj\nb2wuZ2V0VGFyZ2V0RmllbGQoKSk7CgogICAgICAgIGlmIChjb2wuZ2V0U2l6\nZSgpICE9IDAgJiYgY29sLmdldFNpemUoKSAhPSBkaWN0LmNoYXJhY3RlckNv\nbHVtblNpemUKICAgICAgICAgICAgJiYgKGNvbC5nZXRTaXplKCkgIT0gLTEg\nfHwgIWNvbC5pc0xvYigpKSkKICAgICAgICAgICAgY29weS5zZXRTaXplKGNv\nbC5nZXRTaXplKCkpOwogICAgICAgIGlmIChjb2wuZ2V0RGVjaW1hbERpZ2l0\ncygpICE9IDApCiAgICAgICAgICAgIGNvcHkuc2V0RGVjaW1hbERpZ2l0cyhj\nb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAgICBpZiAoY29sLmdldERl\nZmF1bHRTdHJpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBjb3B5LnNldERl\nZmF1bHRTdHJpbmcoY29sLmdldERlZmF1bHRTdHJpbmcoKSk7CiAgICAgICAg\naWYgKGNvbC5pc05vdE51bGwoKSAmJiAhY29sLmlzUHJpbWFyeUtleSgpCiAg\nICAgICAgICAgICYmICghaXNQcmltaXRpdmUoY29sLmdldEphdmFUeXBlKCkp\nIHx8IGlzRm9yZWlnbktleShjb2wpKSkKICAgICAgICAgICAgY29weS5zZXRO\nb3ROdWxsKHRydWUpOwoKICAgICAgICAvLyBzZXQgdHlwZSBuYW1lIGlmIG5v\ndCBkZWZhdWx0CiAgICAgICAgU3RyaW5nIHR5cGVOYW1lID0gY29sLmdldFR5\ncGVOYW1lKCk7CiAgICAgICAgaWYgKHR5cGVOYW1lICE9IG51bGwgfHwgY29w\neS5nZXRTaXplKCkgIT0gMAogICAgICAgICAgICB8fCBjb3B5LmdldERlY2lt\nYWxEaWdpdHMoKSAhPSAwKSB7CiAgICAgICAgICAgIC8vIGlzIHRoaXMgdGhl\nIGRpY3QgZGVmYXVsdCB0eXBlPyBoYXZlIHRvIGVuc3VyZSBqZGJjLXR5cGUg\nc2V0CiAgICAgICAgICAgIC8vIHByaW9yIHRvIGZpbmRpbmcgZGljdCBkZWZh\ndWx0CiAgICAgICAgICAgIGNvcHkuc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsK\nICAgICAgICAgICAgU3RyaW5nIGRlZk5hbWUgPSBkaWN0LmdldFR5cGVOYW1l\nKGNvcHkpOwogICAgICAgICAgICBjb3B5LnNldFR5cGUoVHlwZXMuT1RIRVIp\nOwoKICAgICAgICAgICAgLy8gY29weSBzaG91bGQgbm90IGhhdmUgc2l6ZSBp\nbmZvIHNldCBpZiBpdCBpc24ndCB1c2VkIGluIHR5cGUgbmFtZQogICAgICAg\nICAgICBib29sZWFuIGRlZlNpemVkID0gZGVmTmFtZS5pbmRleE9mKCcoJykg\nIT0gLTE7CiAgICAgICAgICAgIGlmICghZGVmU2l6ZWQpIHsKICAgICAgICAg\nICAgICAgIGlmIChjb3B5LmdldFNpemUoKSA+IDApCiAgICAgICAgICAgICAg\nICAgICAgY29weS5zZXRTaXplKDApOwogICAgICAgICAgICAgICAgY29weS5z\nZXREZWNpbWFsRGlnaXRzKDApOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAodHlwZU5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8g\nbWFrZSBzdXJlIHRvIHN0cmlwIHNpemUgZm9yIGNvbXBhcmlzb24KICAgICAg\nICAgICAgICAgIGlmICh0eXBlTmFtZS5pbmRleE9mKCcoJykgPT0gLTEgJiYg\nZGVmU2l6ZWQpCiAgICAgICAgICAgICAgICAgICAgZGVmTmFtZSA9IGRlZk5h\nbWUuc3Vic3RyaW5nKDAsIGRlZk5hbWUuaW5kZXhPZignKCcpKTsKICAgICAg\nICAgICAgICAgIGlmICghdHlwZU5hbWUuZXF1YWxzSWdub3JlQ2FzZShkZWZO\nYW1lKSkKICAgICAgICAgICAgICAgICAgICBjb3B5LnNldFR5cGVOYW1lKHR5\ncGVOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nc2V0IGpkYmMtdHlwZSBpZiBub3QgZGVmYXVsdCBvciBpZiBmb3JjZWQKICAg\nICAgICBpZiAoZm9yY2VKREJDVHlwZQogICAgICAgICAgICB8fCAodGFyZ2V0\nICE9IG51bGwgJiYgISh0YXJnZXQgaW5zdGFuY2VvZiBDb2x1bW4pCiAgICAg\nICAgICAgICYmIGNvbC5nZXRUeXBlKCkgIT0gVHlwZXMuVkFSQ0hBUikKICAg\nICAgICAgICAgfHwgZGljdC5nZXRKREJDVHlwZShjb2wuZ2V0SmF2YVR5cGUo\nKSwgZmFsc2UpICE9IGNvbC5nZXRUeXBlKCkpCiAgICAgICAgICAgIGNvcHku\nc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsKCiAgICAgICAgcmV0dXJuIGNvcHk7\nCiAgICB9CgogICAgLyoqIAogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdp\ndmVuIGNvbHVtbiBiZWxvbmdzIHRvIGEgZm9yZWlnbiBrZXkuCiAgICAgKi8g\nCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlzRm9yZWlnbktleShDb2x1\nbW4gY29sKSAKICAgIHsgICAgICAgCiAgICAgICAgaWYgKGNvbC5nZXRUYWJs\nZSgpID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBGb3JlaWduS2V5W10gZmtzID0gY29sLmdldFRhYmxlKCkuZ2V0Rm9yZWln\nbktleXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZrcy5sZW5n\ndGg7IGkrKykgCiAgICAgICAgICAgIGlmIChma3NbaV0uY29udGFpbnNDb2x1\nbW4oY29sKSAKICAgICAgICAgICAgICAgIHx8IGZrc1tpXS5jb250YWluc0Nv\nbnN0YW50Q29sdW1uKGNvbCkpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdHlwZSBjb2RlIHJlcHJlc2Vu\ndHMgYSBwcmltaXRpdmUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGJv\nb2xlYW4gaXNQcmltaXRpdmUoaW50IHR5cGUpIHsKICAgICAgICBzd2l0Y2gg\nKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlm\nIHRoZSBnaXZlbiB0YXJnZXQgY29sdW1uIG1hdGNoZXMgdGhlIGRlZmF1bHQu\nCiAgICAgKiBJZiB0aGVyZSBpcyBvbmx5IG9uZSBjb2x1bW4gaW52b2x2ZWQg\naW4gdGhlIGpvaW4gYW5kIGl0IGxpbmtzIHRvIHRoZQogICAgICogc2luZ2xl\nIHRhcmdldCB0YWJsZSBwayBjb2x1bW4sIG9yIGlmIHRoZSBjb2x1bW4gbmFt\nZSBpcyB0aGUgc2FtZSBhcwogICAgICogdGhlIHRhcmdldCBjb2x1bW4gbmFt\nZSwgdGhlbiB0aGUgdGFyZ2V0IGlzIHRoZSBkZWZhdWx0LgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGRlZmF1bHRUYXJnZXQoQ29sdW1u\nIGNvbCwgQ29sdW1uIHRhcmdldENvbCwKICAgICAgICBpbnQgbnVtKSB7CiAg\nICAgICAgaWYgKGNvbC5nZXROYW1lKCkuZXF1YWxzKHRhcmdldENvbC5nZXRO\nYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAo\nbnVtID4gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBQ\ncmltYXJ5S2V5IHBrID0gdGFyZ2V0Q29sLmdldFRhYmxlKCkuZ2V0UHJpbWFy\neUtleSgpOwogICAgICAgIGlmIChwayA9PSBudWxsIHx8IHBrLmdldENvbHVt\nbnMoKS5sZW5ndGggIT0gMSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIHJldHVybiB0YXJnZXRDb2wgPT0gcGsuZ2V0Q29sdW1ucygpWzBd\nOwogICAgfQoKICAgIC8qKgogICAgICogU3VwcGxpZXMgZGVmYXVsdCB0YWJs\nZSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRl\ncmZhY2UgVGFibGVEZWZhdWx0cyB7CgogICAgICAgIC8qKgogICAgICAgICAq\nIFJldHVybiB0aGUgZGVmYXVsdCB0YWJsZSBuYW1lLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0KFNjaGVtYSBzY2hlbWEpOwogICAg\nfQoKICAgIC8qKgogICAgICogU3VwcGxpZXMgZGVmYXVsdCBmb3JlaWduIGtl\neSBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRl\ncmZhY2UgRm9yZWlnbktleURlZmF1bHRzIHsKCiAgICAgICAgLyoqCiAgICAg\nICAgICogUmV0dXJuIGEgZGVmYXVsdCBmb3JlaWduIGtleSBmb3IgdGhlIGdp\ndmVuIHRhYmxlcywgb3IgbnVsbCB0bwogICAgICAgICAqIGNyZWF0ZSBhIGxv\nZ2ljYWwgZm9yZWlnbiBrZXkgb25seS4gRG8gbm90IGZpbGwgaW4gdGhlIGNv\nbHVtbnMgb2YKICAgICAgICAgKiB0aGUgZm9yZWlnbiBrZXksIG9ubHkgYXR0\ncmlidXRlcyBsaWtlIGl0cyBuYW1lLCBkZWxldGUgYWN0aW9uLCBldGMuCiAg\nICAgICAgICogRG8gbm90IGFkZCB0aGUgZm9yZWlnbiBrZXkgdG8gdGhlIHRh\nYmxlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBGb3JlaWduS2V5IGdl\ndChUYWJsZSBsb2NhbCwgVGFibGUgZm9yZWlnbiwgYm9vbGVhbiBpbnZlcnNl\nKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogUG9wdWxhdGUgdGhlIGdpdmVu\nIGZvcmVpZ24ga2V5IGNvbHVtbiB3aXRoIGRlZmF1bHRzLgogICAgICAgICAq\nCiAgICAgICAgICogQHBhcmFtIHRhcmdldCB0aGUgdGFyZ2V0IGNvbHVtbiBv\nciBjb25zdGFudCB2YWx1ZQogICAgICAgICAqIEBwYXJhbSBwb3MgdGhlIGlu\nZGV4IG9mIHRoaXMgY29sdW1uIGluIHRoZSBmb3JlaWduIGtleQogICAgICAg\nICAqIEBwYXJhbSBjb2xzIHRoZSBudW1iZXIgb2YgY29sdW1ucyBpbiB0aGUg\nZm9yZWlnbiBrZXkKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBw\nb3B1bGF0ZShUYWJsZSBsb2NhbCwgVGFibGUgZm9yZWlnbiwgQ29sdW1uIGNv\nbCwKICAgICAgICAgICAgT2JqZWN0IHRhcmdldCwgYm9vbGVhbiBpbnZlcnNl\nLCBpbnQgcG9zLCBpbnQgY29scyk7Cgl9Cn0K\n","encoding":"base64"}

