{"sha":"b724ae6931b5e12565558230d3edffea87c258d2","node_id":"MDQ6QmxvYjIwNjM2NDpiNzI0YWU2OTMxYjVlMTI1NjU1NTgyMzBkM2VkZmZlYTg3YzI1OGQy","size":19449,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b724ae6931b5e12565558230d3edffea87c258d2","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5zOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRyYWNrZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwuQ29tbWVudGFibGU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1vZGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRp\nb247CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBNYXBwaW5n\nIG9mIGEgcXVlcnkgcmVzdWx0IHNldCB0byBzY2FsYXIgYW5kL29yIHBlcnNp\nc3RlbmNlLWNhcGFibGUKICogb2JqZWN0LWxldmVsIHZhbHVlcy4KICoKICog\nQGF1dGhvciBQaW5ha2kgUG9kZGFyCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpwdWJsaWMgY2xhc3MgUXVlcnlSZXN1bHRNYXBwaW5nCiAgICBpbXBsZW1l\nbnRzIE1ldGFEYXRhTW9kZXMsIFNvdXJjZVRyYWNrZXIsIENvbW1lbnRhYmxl\nIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9\nIExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFF1ZXJ5UmVzdWx0TWFw\ncGluZy5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX25hbWU7\nCiAgICBwcml2YXRlIGZpbmFsIE1hcHBpbmdSZXBvc2l0b3J5IF9yZXBvczsK\nICAgIHByaXZhdGUgRmlsZSBfZmlsZSA9IG51bGw7CiAgICBwcml2YXRlIE9i\namVjdCBfc2NvcGUgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX3NyY1R5cGUg\nPSBTUkNfT1RIRVI7CiAgICBwcml2YXRlIGludCBfbGluZU51bSA9IDA7ICAK\nICAgIHByaXZhdGUgaW50IF9jb2xOdW0gPSAwOyAgCiAgICBwcml2YXRlIGlu\ndCBfbW9kZSA9IE1PREVfUVVFUlk7CiAgICBwcml2YXRlIENsYXNzIF9jbGFz\ncyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfaWR4ID0gMDsKICAgIHByaXZh\ndGUgU3RyaW5nW10gX2NvbW1lbnRzID0gbnVsbDsKICAgIHByaXZhdGUgTGlz\ndCBfY29sTGlzdCA9IG51bGw7CiAgICBwcml2YXRlIExpc3QgX3BjTGlzdCA9\nIG51bGw7CgogICAgcHJpdmF0ZSBQQ1Jlc3VsdFtdIF9wY3MgPSBudWxsOwog\nICAgcHJpdmF0ZSBPYmplY3RbXSBfY29scyA9IG51bGw7CgogICAgLyoqCiAg\nICAgKiBDb25zdHJ1Y3Qgd2l0aCB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqLwog\nICAgUXVlcnlSZXN1bHRNYXBwaW5nKFN0cmluZyBuYW1lLCBNYXBwaW5nUmVw\nb3NpdG9yeSByZXBvcykgewogICAgICAgIF9uYW1lID0gbmFtZTsKICAgICAg\nICBfcmVwb3MgPSByZXBvczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgbmFtZSBmb3IgdGhpcyBxdWVyeSByZXN1bHQuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gX25h\nbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2xhc3MgdGhhdCBkZWZp\nbmVzIHRoaXMgcXVlcnkgcmVzdWx0LCBvciBudWxsIGlmIG5vbmUuCiAgICAg\nKi8KICAgIHB1YmxpYyBDbGFzcyBnZXREZWZpbmluZ1R5cGUoKSB7CiAgICAg\nICAgcmV0dXJuIF9jbGFzczsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBj\nbGFzcyB0aGF0IGRlZmluZXMgdGhpcyBxdWVyeSByZXN1bHQsIG9yIG51bGwg\naWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGVmaW5pbmdU\neXBlKENsYXNzIGNscykgewogICAgICAgIF9jbGFzcyA9IGNsczsKICAgIH0K\nCiAgICAvKioKICAgICAqIElkcyBvZiBtYXBwZWQgc2NhbGFyIGNvbHVtbnMg\naW4gdGhlIHJlc3VsdC4gVGhlc2Ugd2lsbCB0eXBpY2FsbHkgYmUKICAgICAq\nIGNvbHVtbiBuYW1lcy4KICAgICAqCiAgICAgKiBAc2VlIG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQKICAgICAqLwogICAgcHVibGljIE9i\namVjdFtdIGdldENvbHVtblJlc3VsdHMoKSB7CiAgICAgICAgaWYgKF9jb2xz\nID09IG51bGwpIHsKICAgICAgICAgICAgT2JqZWN0W10gY29sczsKICAgICAg\nICAgICAgaWYgKF9jb2xMaXN0ID09IG51bGwpCiAgICAgICAgICAgICAgICBj\nb2xzID0gbmV3IE9iamVjdFswXTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgY29scyA9IF9jb2xMaXN0LnRvQXJyYXkoKTsKICAgICAgICAg\nICAgX2NvbHMgPSBjb2xzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Nv\nbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGlkIG9mIGEgbWFw\ncGVkIGNvbHVtbiBpbiB0aGUgcXVlcnkgcmVzdWx0LiBUaGlzIHdpbGwgdHlw\naWNhbGx5CiAgICAgKiBiZSBhIGNvbHVtbiBuYW1lLgogICAgICoKICAgICAq\nIEBzZWUgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJlc3VsdAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhZGRDb2x1bW5SZXN1bHQoT2JqZWN0IGlk\nKSB7CiAgICAgICAgX2NvbHMgPSBudWxsOwogICAgICAgIGlmIChfY29sTGlz\ndCA9PSBudWxsKQogICAgICAgICAgICBfY29sTGlzdCA9IG5ldyBBcnJheUxp\nc3QoKTsKICAgICAgICBfY29sTGlzdC5hZGQoaWQpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBtYXBwZWQgcGVyc2lzdGVuY2UtY2FwYWJs\nZSB0eXBlcyBpbiB0aGUgcXVlcnkgcmVzdWx0LgogICAgICovCiAgICBwdWJs\naWMgUENSZXN1bHRbXSBnZXRQQ1Jlc3VsdHMoKSB7CiAgICAgICAgaWYgKF9w\nY3MgPT0gbnVsbCkgewogICAgICAgICAgICBQQ1Jlc3VsdFtdIHBjczsKICAg\nICAgICAgICAgaWYgKF9wY0xpc3QgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHBjcyA9IG5ldyBQQ1Jlc3VsdFswXTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgcGNzID0gKFBDUmVzdWx0W10pIF9wY0xpc3QudG9BcnJh\neQogICAgICAgICAgICAgICAgICAgIChuZXcgUENSZXN1bHRbX3BjTGlzdC5z\naXplKCldKTsKICAgICAgICAgICAgX3BjcyA9IHBjczsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9wY3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQg\nYSBtYXBwZWQgcGVyc2lzdGVuY2UtY2FwYWJsZSByZXN1bHQgd2l0aCB0aGUg\nZ2l2ZW4gY2FuZGlkYXRlIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBQQ1Jl\nc3VsdCBhZGRQQ1Jlc3VsdChDbGFzcyBjYW5kaWRhdGUpIHsKICAgICAgICBf\ncGNzID0gbnVsbDsKICAgICAgICBQQ1Jlc3VsdCBwYyA9IG5ldyBQQ1Jlc3Vs\ndChjYW5kaWRhdGUpOwogICAgICAgIGlmIChfcGNMaXN0ID09IG51bGwpCiAg\nICAgICAgICAgIF9wY0xpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAg\nX3BjTGlzdC5hZGQocGMpOwogICAgICAgIHJldHVybiBwYzsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSBvZiB0aGlzIHF1ZXJ5IHJl\nc3VsdC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRTb3VyY2VNb2RlKCkg\newogICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBzb3VyY2UgbW9kZSBvZiB0aGlzIHF1ZXJ5IHJlc3VsdC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSkgewog\nICAgICAgIF9tb2RlID0gbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbGF0aXZlIG9yZGVyIG9mIHJlc3VsdCBtYXBwaW5nIGluIG1ldGFkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgaW50IGdldExpc3RpbmdJbmRleCgpIHsKICAg\nICAgICByZXR1cm4gX2lkeDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbGF0\naXZlIG9yZGVyIG9mIHJlc3VsdCBtYXBwaW5nIGluIG1ldGFkYXRhLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRMaXN0aW5nSW5kZXgoaW50IGlkeCkg\newogICAgICAgIF9pZHggPSBpZHg7CiAgICB9CgogICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gX25hbWU7CiAgICB9Cgog\nICAgLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb21tZW50YWJsZQogICAgLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIFN0cmluZ1tdIGdldENvbW1lbnRz\nKCkgewogICAgICAgIHJldHVybiAoX2NvbW1lbnRzID09IG51bGwpID8gRU1Q\nVFlfQ09NTUVOVFMgOiBfY29tbWVudHM7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Q29tbWVudHMoU3RyaW5nW10gY29tbWVudHMpIHsKICAgICAgICBf\nY29tbWVudHMgPSBjb21tZW50czsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gU291cmNlVHJhY2tlciBpbXBs\nZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8KCiAgICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAgICAg\nIHJldHVybiBfZmlsZTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFNv\ndXJjZVNjb3BlKCkgewogICAgICAgIHJldHVybiBfc2NvcGU7CiAgICB9Cgog\nICAgcHVibGljIGludCBnZXRTb3VyY2VUeXBlKCkgewogICAgICAgIHJldHVy\nbiBfc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2Uo\nRmlsZSBmaWxlLCBPYmplY3Qgc2NvcGUsIGludCBzcmNUeXBlKSB7CiAgICAg\nICAgX2ZpbGUgPSBmaWxlOwogICAgICAgIF9zY29wZSA9IHNjb3BlOwogICAg\nICAgIF9zcmNUeXBlID0gc3JjVHlwZTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFJlc291cmNlTmFtZSgpIHsKICAgICAgICByZXR1cm4gKF9jbGFz\ncyA9PSBudWxsKSA/IF9uYW1lIDogX2NsYXNzLmdldE5hbWUoKSArICI6IiAr\nIF9uYW1lOwogICAgfQogICAgCiAgICBwdWJsaWMgaW50IGdldExpbmVOdW1i\nZXIoKSB7CiAgICAgICAgcmV0dXJuIF9saW5lTnVtOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldExpbmVOdW1iZXIoaW50IGxpbmVOdW0pIHsKICAgICAg\nICBfbGluZU51bSA9IGxpbmVOdW07CiAgICB9CgogICAgcHVibGljIGludCBn\nZXRDb2xOdW1iZXIoKSB7CiAgICAgICAgcmV0dXJuIF9jb2xOdW07CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0Q29sTnVtYmVyKGludCBjb2xOdW0pIHsK\nICAgICAgICBfY29sTnVtID0gY29sTnVtOwogICAgfQoKICAgIC8qKgogICAg\nICogQSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHJlc3VsdC4KICAgICAqLwogICAg\ncHVibGljIGNsYXNzIFBDUmVzdWx0IHsKCiAgICAgICAgLyoqCiAgICAgICAg\nICogUGF0aCB0b2tlbiB0byByZXByZXNlbnQgYSBkaXNjcmltaW5hdG9yLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5n\nIERJU0NSSU1JTkFUT1IgPSAiPGRpc2NyaW1pbmF0b3I+IjsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBDbGFzcyBfY2FuZGlkYXRlOwogICAgICAgIHByaXZh\ndGUgQ2xhc3NNYXBwaW5nIF9jYW5kaWRhdGVNYXAgPSBudWxsOwogICAgICAg\nIHByaXZhdGUgTWFwIF9yYXdNYXBwaW5ncyA9IG51bGw7IC8vIHN0cmluZy0+\nb2JqZWN0CiAgICAgICAgcHJpdmF0ZSBNYXAgX21hcHBpbmdzID0gbnVsbDsg\nLy8gbGlzdC0+Y29sdW1ubWFwCiAgICAgICAgcHJpdmF0ZSBNYXAgX2VhZ2Vy\nID0gbnVsbDsgLy8gbGlzdC0+ZmV0Y2hpbmZvCiAgICAgICAgcHJpdmF0ZSBG\nZXRjaEluZm8gX2ZldGNoSW5mbyA9IG51bGw7IC8vIGZvciB0b3AtbGV2ZWwK\nCiAgICAgICAgLyoqCiAgICAgICAgICogU3VwcGx5IGNhbmRpZGF0ZSB0eXBl\nIG9uIGNvbnN0cnVjdGlvbi4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRl\nIFBDUmVzdWx0KENsYXNzIGNhbmRpZGF0ZSkgewogICAgICAgICAgICBfY2Fu\nZGlkYXRlID0gY2FuZGlkYXRlOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogVGhlIHJlc3VsdCBjYW5kaWRhdGUgY2xhc3MuCiAgICAgICAg\nICovCiAgICAgICAgcHVibGljIENsYXNzIGdldENhbmRpZGF0ZVR5cGUoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfY2FuZGlkYXRlOwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogQ2FuZGlkYXRlIG1hcHBpbmcuCiAgICAg\nICAgICovCiAgICAgICAgcHVibGljIENsYXNzTWFwcGluZyBnZXRDYW5kaWRh\ndGVUeXBlTWFwcGluZygpIHsKICAgICAgICAgICAgaWYgKF9jYW5kaWRhdGVN\nYXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9jYW5kaWRhdGVNYXAgPSBf\ncmVwb3MuZ2V0TWFwcGluZyhfY2FuZGlkYXRlLCBudWxsLCB0cnVlKTsKICAg\nICAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGVNYXA7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIHJhdyBtYXBwaW5nIHBh\ndGhzIHN1cHBsaWVkIHdpdGgge0BsaW5rICNhZGRNYXBwaW5nfSwgb3IKICAg\nICAgICAgKiBlbXB0eSBhcnJheSBpZiBub25lLgogICAgICAgICAqLwogICAg\nICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRNYXBwaW5nUGF0aHMoKSB7CiAgICAg\nICAgICAgIGlmIChfcmF3TWFwcGluZ3MgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgICAgICBDb2xsZWN0\naW9uIGtleXMgPSBfcmF3TWFwcGluZ3Mua2V5U2V0KCk7CiAgICAgICAgICAg\nIHJldHVybiAoU3RyaW5nW10pIGtleXMudG9BcnJheShuZXcgU3RyaW5nW2tl\neXMuc2l6ZSgpXSk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBSZXR1cm4gdGhlIG1hcHBpbmcgaWQgZm9yIHRoZSBnaXZlbiBwYXRoIHN1\ncHBsaWVkIHdpdGgKICAgICAgICAgKiB7QGxpbmsgI2FkZE1hcHBpbmd9LCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIE9i\namVjdCBnZXRNYXBwaW5nKFN0cmluZyBwYXRoKSB7CiAgICAgICAgICAgIHJl\ndHVybiAoX3Jhd01hcHBpbmdzID09IG51bGwpID8gbnVsbCA6IF9yYXdNYXBw\naW5ncy5nZXQocGF0aCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBNYXAgdGhlIGdpdmVuIHBhdGggdG8gdGhlIGdpdmVuIHJlc3VsdCBp\nZC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBhZGRNYXBwaW5n\nKFN0cmluZyBwYXRoLCBPYmplY3QgaWQpIHsKICAgICAgICAgICAgaWYgKFN0\ncmluZ1V0aWxzLmlzRW1wdHkocGF0aCkpCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtcGF0aCIs\nCiAgICAgICAgICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nLnRoaXMs\nIF9jYW5kaWRhdGUpKTsKCiAgICAgICAgICAgIF9tYXBwaW5ncyA9IG51bGw7\nCiAgICAgICAgICAgIF9lYWdlciA9IG51bGw7CiAgICAgICAgICAgIF9mZXRj\naEluZm8gPSBudWxsOwogICAgICAgICAgICBpZiAoX3Jhd01hcHBpbmdzID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfcmF3TWFwcGluZ3MgPSBuZXcgSGFz\naE1hcCgpOwogICAgICAgICAgICBfcmF3TWFwcGluZ3MucHV0KHBhdGgsIGlk\nKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIE1hcCB0aGUg\nZ2l2ZW4gcmVxdWVzdCBvbnRvIGEgcmVzdWx0IGlkLgogICAgICAgICAqCiAg\nICAgICAgICogQHBhcmFtIHBhdGggc3RhY2sgb2YgZGF0YSByZXF1ZXN0cyAo\nc2VlCiAgICAgICAgICoge0BsaW5rIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC5SZXN1bHQjc3RhcnREYXRhUmVxdWVzdH0pCiAgICAgICAgICogQHBh\ncmFtIGlkIHJlcXVlc3RlZCBpZCBvciBjb2x1bW4gKHNlZQogICAgICAgICAq\nIHtAbGluayBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0fSBB\nUElzKQogICAgICAgICAqIEBwYXJhbSBqb2lucyByZXF1ZXN0ZWQgam9pbnMs\nIG9yIG51bGwKICAgICAgICAgKiBAcmV0dXJuIHRoZSBpZCBvciBjb2x1bW4g\ndG8gZmV0Y2ggZnJvbSB0aGUgcmVzdWx0CiAgICAgICAgICogKHR5cGljYWxs\neSBhIGNvbHVtbiBuYW1lKQogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBP\nYmplY3QgbWFwKExpc3QgcGF0aCwgT2JqZWN0IGlkLCBKb2lucyBqb2lucykg\newogICAgICAgICAgICBpZiAoX3Jhd01hcHBpbmdzID09IG51bGwgfHwgIShp\nZCBpbnN0YW5jZW9mIENvbHVtbikpCiAgICAgICAgICAgICAgICByZXR1cm4g\naWQ7CgogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIENvbHVt\nbk1hcCBjbSA9IChDb2x1bW5NYXApIF9tYXBwaW5ncy5nZXQocGF0aCk7CiAg\nICAgICAgICAgIHJldHVybiAoY20gPT0gbnVsbCkgPyBpZCA6IGNtLm1hcCgo\nQ29sdW1uKSBpZCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgbWFwcGVkIHJlc3VsdCBjb250YWlucyBl\nYWdlciBkYXRhIGZvciB0aGUgZ2l2ZW4KICAgICAgICAgKiBmaWVsZCBhdCB0\naGUgZ2l2ZW4gcGF0aC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBw\nYXRoIHN0YWNrIG9mIGRhdGEgcmVxdWVzdHMgKHNlZQogICAgICAgICAqIHtA\nbGluayBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0I3N0YXJ0\nRGF0YVJlcXVlc3R9KQogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBib29s\nZWFuIGhhc0VhZ2VyKExpc3QgcGF0aCwgRmllbGRNYXBwaW5nIGZpZWxkKSB7\nCiAgICAgICAgICAgIGlmIChfcmF3TWFwcGluZ3MgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIHJlc29sdmUo\nKTsKICAgICAgICAgICAgaWYgKHBhdGguaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIF9mZXRjaEluZm8uZWFnZXIuZ2V0KGZpZWxkLmdldElu\nZGV4KCkpOwogICAgICAgICAgICBpZiAoX2VhZ2VyID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIEZldGNoSW5m\nbyBpbmZvID0gKEZldGNoSW5mbykgX2VhZ2VyLmdldChwYXRoKTsKICAgICAg\nICAgICAgcmV0dXJuIGluZm8gIT0gbnVsbCAmJiBpbmZvLmVhZ2VyLmdldChm\naWVsZC5nZXRJbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJldHVybiB0aGUgZmllbGQgaW5kZXhlcyB0byBleGNsdWRlIHdo\nZW4gbG9hZGluZyBkYXRhIGZvciB0aGUKICAgICAgICAgKiBnaXZlbiBwYXRo\nLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBCaXRTZXQgZ2V0RXhjbHVk\nZXMoTGlzdCBwYXRoKSB7CiAgICAgICAgICAgIGlmIChfcmF3TWFwcGluZ3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAg\nICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICBpZiAocGF0aC5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gX2ZldGNoSW5mby5leGNsdWRl\nczsKICAgICAgICAgICAgaWYgKF9lYWdlciA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIEZldGNoSW5mbyBpbmZv\nID0gKEZldGNoSW5mbykgX2VhZ2VyLmdldChwYXRoKTsKICAgICAgICAgICAg\ncmV0dXJuIChpbmZvID09IG51bGwpID8gbnVsbCA6IGluZm8uZXhjbHVkZXM7\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXNvbHZlIGlu\ndGVybmFsIGRhdGFzdHJ1Y3R1cmVzIGZyb20gcmF3IG1hcHBpbmdzLgogICAg\nICAgICAqLwogICAgICAgIHByaXZhdGUgc3luY2hyb25pemVkIHZvaWQgcmVz\nb2x2ZSgpIHsKICAgICAgICAgICAgaWYgKF9yYXdNYXBwaW5ncyA9PSBudWxs\nIHx8IF9tYXBwaW5ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICAgICAgX21hcHBpbmdzID0gbmV3IEhhc2hNYXAoKTsKICAg\nICAgICAgICAgX2ZldGNoSW5mbyA9IG5ldyBGZXRjaEluZm8oZ2V0Q2FuZGlk\nYXRlVHlwZU1hcHBpbmcoKSk7CgogICAgICAgICAgICBNYXAuRW50cnkgZW50\ncnk7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3Jhd01hcHBp\nbmdzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgIGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBlbnRyeSA9IChNYXAu\nRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICByZXNvbHZlTWFw\ncGluZygoU3RyaW5nKSBlbnRyeS5nZXRLZXkoKSwgZW50cnkuZ2V0VmFsdWUo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJlc29sdmUgdGhlIGdpdmVuIG1hcHBpbmcgcGF0aC4KICAgICAg\nICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgcmVzb2x2ZU1hcHBpbmcoU3Ry\naW5nIHBhdGgsIE9iamVjdCBpZCkgewogICAgICAgICAgICAvLyBidWlsZCB1\ncCBwYXRoIHRvIHNlY29uZC10by1sYXN0IHRva2VuCiAgICAgICAgICAgIFN0\ncmluZ1tdIHRva2VucyA9IFN0cmluZ3Muc3BsaXQocGF0aCwgIi4iLCAwKTsK\nICAgICAgICAgICAgTGlzdCBycGF0aCA9IG5ldyBBcnJheUxpc3QodG9rZW5z\nLmxlbmd0aCk7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBjYW5kaWRhdGUg\nPSBnZXRDYW5kaWRhdGVUeXBlTWFwcGluZygpOwogICAgICAgICAgICBGaWVs\nZE1hcHBpbmcgZm0gPSBudWxsOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IHRva2Vucy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGZtID0gY2FuZGlkYXRlLmdldEZpZWxkTWFwcGluZyh0b2tlbnNbaV0p\nOwogICAgICAgICAgICAgICAgaWYgKGZtID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtcGF0aCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXJ5UmVz\ndWx0TWFwcGluZy50aGlzLCBfY2FuZGlkYXRlLCBwYXRoKSk7CgogICAgICAg\nICAgICAgICAgaWYgKGZtLmdldEVtYmVkZGVkTWFwcGluZygpICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmRJbmNsdWRlZChjYW5kaWRh\ndGUsIHJwYXRoLCBmbSk7CiAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRl\nID0gZm0uZ2V0RW1iZWRkZWRNYXBwaW5nKCk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgICAgICAgICBjYW5kaWRhdGUgPSBmbS5nZXRU\neXBlTWFwcGluZygpOwogICAgICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgidW50cmF2ZXJzYWJsZS1wYXRoIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgUXVlcnlSZXN1bHRNYXBwaW5nLnRoaXMs\nIF9jYW5kaWRhdGUsIHBhdGgpKTsKICAgICAgICAgICAgICAgIHJwYXRoLmFk\nZChmbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0cmluZyBsYXN0\nVG9rZW4gPSB0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdOwogICAgICAgICAg\nICBpZiAoRElTQ1JJTUlOQVRPUi5lcXVhbHMobGFzdFRva2VuKSkgewogICAg\nICAgICAgICAgICAgRGlzY3JpbWluYXRvciBkaXNjcmltID0gY2FuZGlkYXRl\nLmdldERpc2NyaW1pbmF0b3IoKTsKICAgICAgICAgICAgICAgIHJwYXRoLmFk\nZChkaXNjcmltKTsKICAgICAgICAgICAgICAgIGFzc2VydFNpbmdsZUNvbHVt\nbihkaXNjcmltLmdldENvbHVtbnMoKSwgcGF0aCk7CiAgICAgICAgICAgICAg\nICBfbWFwcGluZ3MucHV0KHJwYXRoLCBuZXcgU2luZ2xlQ29sdW1uTWFwKGlk\nKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBGaWVs\nZE1hcHBpbmcgbGFzdCA9IGNhbmRpZGF0ZS5nZXRGaWVsZE1hcHBpbmcobGFz\ndFRva2VuKTsKICAgICAgICAgICAgICAgIGlmIChsYXN0ID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ1bnRyYXZlcnNhYmxlLXBhdGgiLAogICAgICAgICAgICAg\nICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcudGhpcywgX2NhbmRpZGF0\nZSwgcGF0aCkpOwogICAgICAgICAgICAgICAgQ29sdW1uW10gY29scyA9IGxh\nc3QuZ2V0Q29sdW1ucygpOwogICAgICAgICAgICAgICAgYXNzZXJ0U2luZ2xl\nQ29sdW1uKGNvbHMsIHBhdGgpOwogICAgICAgICAgICAgICAgQ29sdW1uIGNv\nbCA9IGNvbHNbMF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAg\nIC8vIHNwZWNpYWwtY2FzZSBvaWQgZmllbGRzLCBzaW5jZSBwYXRoIGxpc3Rz\nIHN1cHBsaWVkIGZvcgogICAgICAgICAgICAgICAgLy8gdGhlbSBhdCBydW50\naW1lIGRvbid0IGluY2x1ZGUgdGhlIGVtYmVkZGVkIGZpZWxkcwogICAgICAg\nICAgICAgICAgaWYgKGZtICE9IG51bGwgJiYgZm0uZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAgICAgICAg\nICBhZGRDb21wbGV4Q29sdW1uTWFwcGluZyhmbSwgcnBhdGgsIGNvbCwgaWQp\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICBpZiAoZm0gIT0gbnVsbCAmJiBmbS5nZXRG\nb3JlaWduS2V5KCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIC8v\nIGlmIHRoZSBsYXN0IGZpZWxkIGlzIG9uZSBvZiB0aGUgam9pbmFibGVzIHVz\nZWQgaW4gdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gcmVsYXRpb24ncyBm\nb3JlaWduIGtleSwgbWFwIHRvIHJlbGF0aW9uIGZpZWxkIHBhdGguCiAgICAg\nICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCByZWNvcmQgdGhhdCB3ZSBo\nYXZlIGFuIGVhZ2VyIHJlc3VsdAogICAgICAgICAgICAgICAgICAgIENvbHVt\nbiBma0NvbCA9IGZtLmdldEZvcmVpZ25LZXkoKS5nZXRDb2x1bW4oY29sKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZmtDb2wgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgYWRkQ29tcGxleENvbHVtbk1hcHBpbmcoZm0s\nIG5ldyBBcnJheUxpc3QocnBhdGgpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmtDb2wsIGlkKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkRWFnZXIoY2FuZGlkYXRl\nLCBycGF0aCwgZm0pOwogICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRJ\nbmNsdWRlZChjYW5kaWRhdGUsIHJwYXRoLCBsYXN0KTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgICAgICByZWNvcmRJbmNsdWRlZChjYW5kaWRhdGUsIHJwYXRoLCBsYXN0\nKTsKCiAgICAgICAgICAgICAgICAvLyBtYXAgdG8gcmVsYXRlZCBmaWVsZCBw\nYXRoLiBiZWNhdXNlIHRoZSBTaW5nbGVDb2x1bW5NYXAKICAgICAgICAgICAg\nICAgIC8vIGRvZXNuJ3QgdGVzdCB0aGUgcmVxdWVzdGVkIGNvbHVtbiwgaXQg\nd2lsbCBhY2NlcHQKICAgICAgICAgICAgICAgIC8vIHJlcXVlc3RzIGZvciBi\nb3RoIHRoZSBmayBjb2wgb3IgdGhlIHJlbGF0ZWQgZmllbGQgY29sCiAgICAg\nICAgICAgICAgICBycGF0aC5hZGQobGFzdCk7CiAgICAgICAgICAgICAgICBf\nbWFwcGluZ3MucHV0KHJwYXRoLCBuZXcgU2luZ2xlQ29sdW1uTWFwKGlkKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIENyZWF0ZSBhbiBhcHByb3ByaWF0ZSBjb2x1bW4gbWFwcGluZyBmb3Ig\ndGhlIGdpdmVuIGZpZWxkLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUg\ndm9pZCBhZGRDb21wbGV4Q29sdW1uTWFwcGluZyhGaWVsZE1hcHBpbmcgZm0s\nIExpc3QgcnBhdGgsCiAgICAgICAgICAgIENvbHVtbiBjb2wsIE9iamVjdCBp\nZCkgewogICAgICAgICAgICBpZiAoZm0uZ2V0Q29sdW1ucygpLmxlbmd0aCA9\nPSAxKQogICAgICAgICAgICAgICAgX21hcHBpbmdzLnB1dChycGF0aCwgbmV3\nIFNpbmdsZUNvbHVtbk1hcChpZCkpOwogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIE11bHRpQ29sdW1uTWFwIG1jbSA9IChNdWx0aUNvbHVt\nbk1hcCkgX21hcHBpbmdzLmdldChycGF0aCk7CiAgICAgICAgICAgICAgICBp\nZiAobWNtID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBtY20gPSBu\nZXcgTXVsdGlDb2x1bW5NYXAoZm0uZ2V0Q29sdW1ucygpKTsKICAgICAgICAg\nICAgICAgICAgICBfbWFwcGluZ3MucHV0KHJwYXRoLCBtY20pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgbWNtLnNldChjb2wsIGlkKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogRm9yIG5vdywgd2Ugb25seSBhbGxvdyBtYXBwaW5ncyB3aXRoIGEgc2lu\nZ2xlIGNvbHVtbi4gSW4gdGhlCiAgICAgICAgICogZnV0dXJlIHdlIG1pZ2h0\nIGludHJvZHVjZSBhIHN5bnRheCB0byBtYXAgbXVsdGlwbGUgY29sdW1ucy4K\nICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgYXNzZXJ0U2luZ2xl\nQ29sdW1uKENvbHVtbltdIGNvbHMsIFN0cmluZyBwYXRoKSB7CiAgICAgICAg\nICAgIGlmIChjb2xzLmxlbmd0aCAhPSAxKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJudW0tY29scy1w\nYXRoIiwKICAgICAgICAgICAgICAgICAgICBRdWVyeVJlc3VsdE1hcHBpbmcu\ndGhpcywgX2NhbmRpZGF0ZSwgcGF0aCkpOwogICAgICAgIH0KCiAgICAgICAg\nLyoqCiAgICAgICAgICogUmVjb3JkIHRoYXQgdGhlcmUgbWF5IGJlIGVhZ2Vy\nIGRhdGEgZm9yIHRoZSBnaXZlbiBmaWVsZCBhdCB0aGUgZ2l2ZW4KICAgICAg\nICAgKiBwYXRoLgogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBy\nZWNvcmRFYWdlcihDbGFzc01hcHBpbmcgY2FuZGlkYXRlLCBMaXN0IHBhdGgs\nCiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSkgewogICAgICAgICAgICBp\nZiAocGF0aC5zaXplKCkgPT0gMSkgewogICAgICAgICAgICAgICAgX2ZldGNo\nSW5mby5lYWdlci5zZXQoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAg\nICBfZmV0Y2hJbmZvLmV4Y2x1ZGVzLmNsZWFyKGZtLmdldEluZGV4KCkpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcmVjb3Jk\nIGF0IHByZXZpb3VzIHBhdGgKICAgICAgICAgICAgICAgIExpc3QgY29weSA9\nIG5ldyBBcnJheUxpc3QocGF0aC5zaXplKCkgLSAxKTsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29weS5zaXplKCk7IGkrKykKICAg\nICAgICAgICAgICAgICAgICBjb3B5LmFkZChwYXRoLmdldChpKSk7CgogICAg\nICAgICAgICAgICAgaWYgKF9lYWdlciA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIF9lYWdlciA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAg\nICBGZXRjaEluZm8gaW5mbyA9IChGZXRjaEluZm8pIF9lYWdlci5nZXQoY29w\neSk7CiAgICAgICAgICAgICAgICBpZiAoaW5mbyA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgaW5mbyA9IG5ldyBGZXRjaEluZm8oY2FuZGlkYXRl\nKTsKICAgICAgICAgICAgICAgICAgICBfZWFnZXIucHV0KGNvcHksIGluZm8p\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5mby5lYWdl\nci5zZXQoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBpbmZvLmV4\nY2x1ZGVzLmNsZWFyKGZtLmdldEluZGV4KCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZWNvcmQgdGhhdCB0\naGUgZmllbGQgYXQgdGhlIGdpdmVuIHBhdGggaXMgaW5jbHVkZWQgaW4gdGhl\nIHJlc3VsdHMuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIHJl\nY29yZEluY2x1ZGVkKENsYXNzTWFwcGluZyBjYW5kaWRhdGUsIExpc3QgcGF0\naCwKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtKSB7CiAgICAgICAgICAg\nIGlmIChwYXRoLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIF9mZXRjaElu\nZm8uZXhjbHVkZXMuY2xlYXIoZm0uZ2V0SW5kZXgoKSk7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKF9lYWdlciA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9lYWdlciA9IG5ldyBIYXNoTWFwKCk7CiAg\nICAgICAgICAgICAgICBGZXRjaEluZm8gaW5mbyA9IChGZXRjaEluZm8pIF9l\nYWdlci5nZXQocGF0aCk7CiAgICAgICAgICAgICAgICBpZiAoaW5mbyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaW5mbyA9IG5ldyBGZXRjaElu\nZm8oY2FuZGlkYXRlKTsKICAgICAgICAgICAgICAgICAgICBfZWFnZXIucHV0\nKG5ldyBBcnJheUxpc3QocGF0aCksIGluZm8pOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgaW5mby5leGNsdWRlcy5jbGVhcihmbS5nZXRJ\nbmRleCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIEZldGNoIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBGZXRjaEluZm8gewoKICAgICAgICAvKioKICAg\nICAgICAgKiBJbmRleGVzIG9mIGZpZWxkcyB0byBleGNsdWRlIGZyb20gbG9h\nZGluZy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgZmluYWwgQml0U2V0\nIGV4Y2x1ZGVzOwoKICAgICAgICAvKioKICAgICAgICAgKiBJbmRleGVzIG9m\nIGVhZ2VyIGZpZWxkcy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgZmlu\nYWwgQml0U2V0IGVhZ2VyOwoKICAgICAgICBwdWJsaWMgRmV0Y2hJbmZvKENs\nYXNzTWFwcGluZyB0eXBlKSB7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZ1td\nIGZtcyA9IHR5cGUuZ2V0RmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBl\nYWdlciA9IG5ldyBCaXRTZXQoZm1zLmxlbmd0aCk7CiAgICAgICAgICAgIGV4\nY2x1ZGVzID0gbmV3IEJpdFNldChmbXMubGVuZ3RoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgICAgICBpZiAoIWZtc1tpXS5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAg\nICAgICAgICAgICBleGNsdWRlcy5zZXQoaSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTWFwcGluZyBvZiBjb2x1bW5zIHRvIHJlc3VsdCBp\nZHMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGludGVyZmFjZSBDb2x1\nbW5NYXAgewoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIHJl\nc3VsdCBpZCBmb3IgdGhlIGdpdmVuIGNvbHVtbiwgb3IgdGhlIGdpdmVuIGNv\nbHVtCiAgICAgICAgICogaWYgbm9uZS4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgT2JqZWN0IG1hcChDb2x1bW4gY29sKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIHtAbGluayBDb2x1bW5NYXB9IHNwZWNpYWxpemVkIGZvciBhIHNp\nbmdsZSBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNz\nIFNpbmdsZUNvbHVtbk1hcAogICAgICAgIGltcGxlbWVudHMgQ29sdW1uTWFw\nIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBPYmplY3QgX2lkOwoKICAgICAg\nICBwdWJsaWMgU2luZ2xlQ29sdW1uTWFwKE9iamVjdCBpZCkgewogICAgICAg\nICAgICBfaWQgPSBpZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmpl\nY3QgbWFwKENvbHVtbiBjb2wpIHsKICAgICAgICAgICAgcmV0dXJuIF9pZDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfaWQudG9TdHJpbmcoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiB7QGxpbmsgQ29sdW1uTWFwfSBzcGVj\naWFsaXplZCBmb3IgYSBtdWx0aXBsZSBjb2x1bW5zLgogICAgICogTWFwcyBj\nb2x1bW5zIGluIGxpbmVhciB0aW1lLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBjbGFzcyBNdWx0aUNvbHVtbk1hcAogICAgICAgIGltcGxlbWVudHMg\nQ29sdW1uTWFwIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBMaXN0IF9jb2xz\nOwogICAgICAgIHByaXZhdGUgZmluYWwgT2JqZWN0W10gX2lkczsKCiAgICAg\nICAgcHVibGljIE11bHRpQ29sdW1uTWFwKENvbHVtbltdIGNvbHMpIHsKICAg\nICAgICAgICAgX2NvbHMgPSBBcnJheXMuYXNMaXN0KGNvbHMpOwogICAgICAg\nICAgICBfaWRzID0gbmV3IE9iamVjdFtjb2xzLmxlbmd0aF07CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IG1hcChDb2x1bW4gY29sKSB7CiAg\nICAgICAgICAgIGludCBpZHggPSBfY29scy5pbmRleE9mKGNvbCk7CiAgICAg\nICAgICAgIHJldHVybiAoaWR4ID09IC0xKSA/IGNvbCA6IF9pZHNbaWR4XTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldChDb2x1bW4gY29s\nLCBPYmplY3QgaWQpIHsKICAgICAgICAgICAgaW50IGlkeCA9IF9jb2xzLmlu\nZGV4T2YoY29sKTsKICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkKICAgICAg\nICAgICAgICAgIF9pZHNbaWR4XSA9IGlkOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9jb2xzICsgIj0iICsgQXJyYXlzLmFzTGlzdChfaWRzKTsKICAgICAgICB9\nCiAgICB9Cn0K\n","encoding":"base64"}

