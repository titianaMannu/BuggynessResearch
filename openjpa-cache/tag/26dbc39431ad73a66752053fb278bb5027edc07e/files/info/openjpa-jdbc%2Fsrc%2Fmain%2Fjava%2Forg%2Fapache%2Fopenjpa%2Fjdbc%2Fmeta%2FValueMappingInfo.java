{"sha":"4807bb52f65f89185ce8b65e89d94188166deed6","node_id":"MDQ6QmxvYjIwNjM2NDo0ODA3YmI1MmY2NWY4OTE4NWNlOGI2NWU4OWQ5NDE4ODE2NmRlZWQ2","size":11903,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/4807bb52f65f89185ce8b65e89d94188166deed6","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhOwoKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWFHcm91cDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247CgovKioKICog\nSW5mb3JtYXRpb24gYWJvdXQgdGhlIG1hcHBpbmcgZnJvbSBhIGZpZWxkIHZh\nbHVlIHRvIHRoZSBzY2hlbWEsIGluCiAqIHJhdyBmb3JtLiBUaGUgY29sdW1u\ncyBhbmQgdGFibGVzIHVzZWQgaW4gbWFwcGluZyBpbmZvIHdpbGwgbm90IGJl\nIHBhcnQgb2YKICogdGhlIHtAbGluayBTY2hlbWFHcm91cH0gdXNlZCBhdCBy\ndW50aW1lLiBSYXRoZXIsIHRoZXkgd2lsbCBiZSBzdHJ1Y3RzCiAqIHdpdGgg\ndGhlIHJlbGV2YW50IHBpZWNlcyBvZiBpbmZvcm1hdGlvbiBmaWxsZWQgaW4u\nCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3MgVmFs\ndWVNYXBwaW5nSW5mbwogICAgZXh0ZW5kcyBNYXBwaW5nSW5mbyB7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6\nZXIuZm9yUGFja2FnZQogICAgICAgIChWYWx1ZU1hcHBpbmdJbmZvLmNsYXNz\nKTsKCiAgICBwcml2YXRlIGJvb2xlYW4gX2NyaXRlcmlhID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2Nhbk51bGwgPSB0cnVlOwoKICAgIC8qKgog\nICAgICogV2hldGhlciB0byB1c2UgY2xhc3MgY3JpdGVyaWEgd2hlbiBqb2lu\naW5nIHRvIHJlbGF0ZWQgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpIHsKICAgICAgICByZXR1cm4gX2Ny\naXRlcmlhOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byB1c2Ug\nY2xhc3MgY3JpdGVyaWEgd2hlbiBqb2luaW5nIHRvIHJlbGF0ZWQgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VXNlQ2xhc3NDcml0ZXJpYShi\nb29sZWFuIGNyaXRlcmlhKSB7CiAgICAgICAgX2NyaXRlcmlhID0gY3JpdGVy\naWE7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHVzZXIgaGFzIGV4\ncGxpY2l0bHkgdHVybmVkIG51bGwgaW5kaWNhdG9yIGNvbHVtbiBvZmYuCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNhbkluZGljYXRlTnVsbCgpIHsK\nICAgICAgICByZXR1cm4gX2Nhbk51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHVzZXIgaGFzIGV4cGxpY2l0bHkgdHVybmVkIG51bGwgaW5k\naWNhdG9yIGNvbHVtbiBvZmYuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndENhbkluZGljYXRlTnVsbChib29sZWFuIGluZCkgewogICAgICAgIF9jYW5O\ndWxsID0gaW5kOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBq\nb2luIGZyb20gdGhpcyB2YWx1ZSB0byBpdHMgcmVsYXRlZCB0eXBlLgogICAg\nICoKICAgICAqIEBwYXJhbSBuYW1lIGJhc2UgbmFtZSBmb3IgdmFsdWUgbWFw\ncGluZwogICAgICogQHBhcmFtIGludmVyc2FibGUgd2hldGhlciBhbiBpbnZl\ncnNlIGpvaW4gaXMgYWxsb3dlZAogICAgICovCiAgICBwdWJsaWMgRm9yZWln\nbktleSBnZXRUeXBlSm9pbihmaW5hbCBWYWx1ZU1hcHBpbmcgdmFsLCBmaW5h\nbCBTdHJpbmcgbmFtZSwKICAgICAgICBib29sZWFuIGludmVyc2FibGUsIGJv\nb2xlYW4gYWRhcHQpIHsKICAgICAgICBDbGFzc01hcHBpbmcgcmVsID0gdmFs\nLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAgaWYgKHJlbCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgRm9yZWlnbktleURl\nZmF1bHRzIGRlZiA9IG5ldyBGb3JlaWduS2V5RGVmYXVsdHMoKSB7CiAgICAg\nICAgICAgIHB1YmxpYyBGb3JlaWduS2V5IGdldChUYWJsZSBsb2NhbCwgVGFi\nbGUgZm9yZWlnbiwgYm9vbGVhbiBpbnZlcnNlKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdmFsLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGlu\nZ0RlZmF1bHRzKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0Rm9yZWlnbktl\neSh2YWwsIG5hbWUsIGxvY2FsLCBmb3JlaWduLCBpbnZlcnNlKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgcG9wdWxhdGUoVGFi\nbGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIENvbHVtbiBjb2wsCiAgICAgICAg\nICAgICAgICBPYmplY3QgdGFyZ2V0LCBib29sZWFuIGludmVyc2UsIGludCBw\nb3MsIGludCBjb2xzKSB7CiAgICAgICAgICAgICAgICB2YWwuZ2V0TWFwcGlu\nZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAg\nICAgICAgICAgICBwb3B1bGF0ZUZvcmVpZ25LZXlDb2x1bW4odmFsLCBuYW1l\nLCBsb2NhbCwgZm9yZWlnbiwgY29sLAogICAgICAgICAgICAgICAgICAgICAg\nICB0YXJnZXQsIGludmVyc2UsIHBvcywgY29scyk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9OwogICAgICAgIHJldHVybiBjcmVhdGVGb3JlaWduS2V5KHZh\nbCwgbnVsbCwgZ2V0Q29sdW1ucygpLCBkZWYsCiAgICAgICAgICAgIHZhbC5n\nZXRGaWVsZE1hcHBpbmcoKS5nZXRUYWJsZSgpLCB2YWwuZ2V0RmllbGRNYXBw\naW5nKCkuCiAgICAgICAgICAgIGdldERlZmluaW5nTWFwcGluZygpLCByZWws\nIGludmVyc2FibGUsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgam9pbiBmcm9tIHRoZSByZWxhdGVkIHR5cGUgdG8gdGhpcyB2\nYWx1ZS4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0SW52ZXJz\nZVR5cGVKb2luKGZpbmFsIFZhbHVlTWFwcGluZyB2YWwsCiAgICAgICAgZmlu\nYWwgU3RyaW5nIG5hbWUsIGJvb2xlYW4gYWRhcHQpIHsKICAgICAgICBDbGFz\nc01hcHBpbmcgcmVsID0gdmFsLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAg\naWYgKHJlbCA9PSBudWxsIHx8IHJlbC5nZXRUYWJsZSgpID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBGb3JlaWduS2V5RGVm\nYXVsdHMgZGVmID0gbmV3IEZvcmVpZ25LZXlEZWZhdWx0cygpIHsKICAgICAg\nICAgICAgcHVibGljIEZvcmVpZ25LZXkgZ2V0KFRhYmxlIGxvY2FsLCBUYWJs\nZSBmb3JlaWduLCBib29sZWFuIGludmVyc2UpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiB2YWwuZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5n\nRGVmYXVsdHMoKS4KICAgICAgICAgICAgICAgICAgICBnZXRGb3JlaWduS2V5\nKHZhbCwgbmFtZSwgbG9jYWwsIGZvcmVpZ24sICFpbnZlcnNlKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgcG9wdWxhdGUoVGFi\nbGUgbG9jYWwsIFRhYmxlIGZvcmVpZ24sIENvbHVtbiBjb2wsCiAgICAgICAg\nICAgICAgICBPYmplY3QgdGFyZ2V0LCBib29sZWFuIGludmVyc2UsIGludCBw\nb3MsIGludCBjb2xzKSB7CiAgICAgICAgICAgICAgICB2YWwuZ2V0TWFwcGlu\nZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4KICAgICAgICAg\nICAgICAgICAgICBwb3B1bGF0ZUZvcmVpZ25LZXlDb2x1bW4odmFsLCBuYW1l\nLCBsb2NhbCwgZm9yZWlnbiwgY29sLAogICAgICAgICAgICAgICAgICAgICAg\nICB0YXJnZXQsICFpbnZlcnNlLCBwb3MsIGNvbHMpOwogICAgICAgICAgICB9\nCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gY3JlYXRlRm9yZWlnbktleSh2\nYWwsIG51bGwsIGdldENvbHVtbnMoKSwgZGVmLCByZWwuZ2V0VGFibGUoKSwK\nICAgICAgICAgICAgcmVsLCB2YWwuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0RGVm\naW5pbmdNYXBwaW5nKCksIGZhbHNlLCBhZGFwdCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGNvbHVtbnMgZm9yIHRoaXMgdmFsdWUsIGJh\nc2VkIG9uIHRoZSBnaXZlbiB0ZW1wbGF0ZXMuCiAgICAgKi8KICAgIHB1Ymxp\nYyBDb2x1bW5bXSBnZXRDb2x1bW5zKFZhbHVlTWFwcGluZyB2YWwsIFN0cmlu\nZyBuYW1lLAogICAgICAgIENvbHVtbltdIHRtcGxhdGVzLCBUYWJsZSB0YWJs\nZSwgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIG9yZGVyQ29sdW1uc0J5VGFy\nZ2V0RmllbGQodmFsLCB0bXBsYXRlcywgYWRhcHQpOwogICAgICAgIHZhbC5n\nZXRNYXBwaW5nUmVwb3NpdG9yeSgpLmdldE1hcHBpbmdEZWZhdWx0cygpLnBv\ncHVsYXRlQ29sdW1ucwogICAgICAgICAgICAodmFsLCBuYW1lLCB0YWJsZSwg\ndG1wbGF0ZXMpOwogICAgICAgIHJldHVybiBjcmVhdGVDb2x1bW5zKHZhbCwg\nbnVsbCwgdG1wbGF0ZXMsIHRhYmxlLCBhZGFwdCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYWtlIGdpdmVuIGNvbHVtbnMgbWF0Y2ggdXAgd2l0aCB0aGUg\ndGFyZ2V0IGZpZWxkcyBzdXBwbGllZCBvbiB0aGUKICAgICAqIHRlbXBsYXRl\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG9yZGVyQ29sdW1uc0J5VGFy\nZ2V0RmllbGQoVmFsdWVNYXBwaW5nIHZhbCwgQ29sdW1uW10gdG1wbGF0ZXMs\nCiAgICAgICAgYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGlmICh0bXBsYXRl\ncy5sZW5ndGggPCAyIHx8IHRtcGxhdGVzWzBdLmdldFRhcmdldEZpZWxkKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIExpc3QgY29s\ncyA9IGdldENvbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5pc0VtcHR5KCkg\nfHwgY29scy5zaXplKCkgIT0gdG1wbGF0ZXMubGVuZ3RoKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGludCBwb3MgPSAwOwogICAgICAgIENvbHVt\nbiBjdXIgPSAoQ29sdW1uKSBjb2xzLmdldCgwKTsKICAgICAgICBDb2x1bW4g\nbmV4dDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMuc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgaWYgKGN1ci5nZXRUYXJnZXRGaWVsZCgp\nID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLXRhcmdldGZpZWxkIiwgdmFsKSk7Cgog\nICAgICAgICAgICBwb3MgPSBmaW5kVGFyZ2V0RmllbGQodG1wbGF0ZXMsIGN1\nci5nZXRUYXJnZXRGaWVsZCgpKTsKICAgICAgICAgICAgaWYgKHBvcyA9PSAt\nMSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLXRhcmdldGZpZWxkIiwKICAgICAgICAgICAgICAg\nICAgICB2YWwsIGN1ci5nZXRUYXJnZXRGaWVsZCgpKSk7CgogICAgICAgICAg\nICBuZXh0ID0gKENvbHVtbikgY29scy5nZXQocG9zKTsKICAgICAgICAgICAg\nY29scy5zZXQocG9zLCBjdXIpOwogICAgICAgICAgICBjdXIgPSBuZXh0Owog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcG9z\naXRpb24gb2YgdGhlIHRlbXBsYXRlIGNvbHVtbiB3aXRoIHRoZSBnaXZlbiB0\nYXJnZXQgZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZmluZFRhcmdl\ndEZpZWxkKENvbHVtbltdIHRtcGxhdGVzLCBTdHJpbmcgdGFyZ2V0KSB7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0bXBsYXRlcy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgaWYgKHRhcmdldC5lcXVhbHModG1wbGF0ZXNbaV0u\nZ2V0VGFyZ2V0RmllbGQoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gaTsK\nICAgICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSB1bmlxdWUgY29uc3RyYWludCBmb3IgdGhlIGdpdmVuIGNvbHVtbnMs\nIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFVuaXF1ZSBn\nZXRVbmlxdWUoVmFsdWVNYXBwaW5nIHZhbCwgU3RyaW5nIG5hbWUsIGJvb2xl\nYW4gYWRhcHQpIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdmFsLmdldENv\nbHVtbnMoKTsKICAgICAgICBpZiAoY29scy5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFVuaXF1ZSB1bnEgPSB2YWwu\nZ2V0TWFwcGluZ1JlcG9zaXRvcnkoKS5nZXRNYXBwaW5nRGVmYXVsdHMoKS4K\nICAgICAgICAgICAgZ2V0VW5pcXVlKHZhbCwgbmFtZSwgY29sc1swXS5nZXRU\nYWJsZSgpLCBjb2xzKTsKICAgICAgICByZXR1cm4gY3JlYXRlVW5pcXVlKHZh\nbCwgbnVsbCwgdW5xLCBjb2xzLCBhZGFwdCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYW4gaW5kZXggZm9yIHRoZSBnaXZlbiBjb2x1bW5zLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBnZXRJ\nbmRleChWYWx1ZU1hcHBpbmcgdmFsLCBTdHJpbmcgbmFtZSwgYm9vbGVhbiBh\nZGFwdCkgewogICAgICAgIENvbHVtbltdIGNvbHMgPSB2YWwuZ2V0Q29sdW1u\ncygpOwogICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAwKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgSW5kZXggaWR4ID0gdmFsLmdldE1h\ncHBpbmdSZXBvc2l0b3J5KCkuZ2V0TWFwcGluZ0RlZmF1bHRzKCkuCiAgICAg\nICAgICAgIGdldEluZGV4KHZhbCwgbmFtZSwgY29sc1swXS5nZXRUYWJsZSgp\nLCBjb2xzKTsKICAgICAgICByZXR1cm4gY3JlYXRlSW5kZXgodmFsLCBudWxs\nLCBpZHgsIGNvbHMsIGFkYXB0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgbnVsbCBpbmRpY2F0b3IgY29sdW1uIGZvciB0aGlzIHZhbHVl\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW4g\nZ2V0TnVsbEluZGljYXRvckNvbHVtbihWYWx1ZU1hcHBpbmcgdmFsLCBTdHJp\nbmcgbmFtZSwKICAgICAgICBUYWJsZSB0YWJsZSwgYm9vbGVhbiBhZGFwdCkg\newogICAgICAgIC8vIHJlc2V0IElPCiAgICAgICAgc2V0Q29sdW1uSU8obnVs\nbCk7CgogICAgICAgIC8vIGhhcyB0aGUgdXNlciBleHBsaWNpdGx5IHR1cm5l\nZCBudWxsIGluZGljYXRvciBvZmY/CiAgICAgICAgaWYgKCFfY2FuTnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIGV4dHJhY3Qg\nZ2l2ZW4gbnVsbC1pbmQgY29sdW1uCiAgICAgICAgTGlzdCBjb2xzID0gZ2V0\nQ29sdW1ucygpOwogICAgICAgIENvbHVtbiBnaXZlbiA9IChjb2xzLmlzRW1w\ndHkoKSkgPyBudWxsIDogKENvbHVtbikgY29scy5nZXQoMCk7CiAgICAgICAg\nTWFwcGluZ0RlZmF1bHRzIGRlZiA9IHZhbC5nZXRNYXBwaW5nUmVwb3NpdG9y\neSgpLmdldE1hcHBpbmdEZWZhdWx0cygpOwogICAgICAgIGlmIChnaXZlbiA9\nPSBudWxsICYmICghYWRhcHQgJiYgIWRlZi5kZWZhdWx0TWlzc2luZ0luZm8o\nKSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1bW4g\ndG1wbGF0ZSA9IG5ldyBDb2x1bW4oKTsKICAgICAgICB0bXBsYXRlLnNldE5h\nbWUobmFtZSArICJfbnVsbCIpOwogICAgICAgIHRtcGxhdGUuc2V0SmF2YVR5\ncGUoSmF2YVR5cGVzLklOVCk7CiAgICAgICAgaWYgKCFkZWYucG9wdWxhdGVO\ndWxsSW5kaWNhdG9yQ29sdW1ucyh2YWwsIG5hbWUsIHRhYmxlLCBuZXcgQ29s\ndW1uW10KICAgICAgICAgICAgeyB0bXBsYXRlIH0pICYmIGdpdmVuID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBpZiAoZ2l2\nZW4gIT0gbnVsbCAmJiAoZ2l2ZW4uZ2V0RmxhZyhDb2x1bW4uRkxBR19VTklO\nU0VSVEFCTEUpCiAgICAgICAgICAgIHx8IGdpdmVuLmdldEZsYWcoQ29sdW1u\nLkZMQUdfVU5VUERBVEFCTEUpKSkgewogICAgICAgICAgICBDb2x1bW5JTyBp\nbyA9IG5ldyBDb2x1bW5JTygpOwogICAgICAgICAgICBpby5zZXRJbnNlcnRh\nYmxlKDAsICFnaXZlbi5nZXRGbGFnKENvbHVtbi5GTEFHX1VOSU5TRVJUQUJM\nRSkpOwogICAgICAgICAgICBpby5zZXRVcGRhdGFibGUoMCwgIWdpdmVuLmdl\ndEZsYWcoQ29sdW1uLkZMQUdfVU5VUERBVEFCTEUpKTsKICAgICAgICAgICAg\nc2V0Q29sdW1uSU8oaW8pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGdpdmVu\nICE9IG51bGwgJiYgZ2l2ZW4uZ2V0TmFtZSgpICE9IG51bGwpIHsKICAgICAg\nICAgICAgLy8gdGVzdCBpZiBnaXZlbiBjb2x1bW4gbmFtZSBpcyBhY3R1YWxs\neSBhIGZpZWxkIG5hbWUsIGluIHdoaWNoCiAgICAgICAgICAgIC8vIGNhc2Ug\nd2UgdXNlIGl0cyBjb2x1bW4gYXMgdGhlIG51bGwgaW5kaWNhdG9yIGNvbHVt\nbgogICAgICAgICAgICBDbGFzc01hcHBpbmcgZW1iZWQgPSB2YWwuZ2V0RW1i\nZWRkZWRNYXBwaW5nKCk7CiAgICAgICAgICAgIEZpZWxkTWFwcGluZyBlZm0g\nPSAoZW1iZWQgPT0gbnVsbCkgPyBudWxsCiAgICAgICAgICAgICAgICA6IGVt\nYmVkLmdldEZpZWxkTWFwcGluZyhnaXZlbi5nZXROYW1lKCkpOwogICAgICAg\nICAgICBpZiAoZWZtICE9IG51bGwgJiYgZWZtLmdldENvbHVtbnMoKS5sZW5n\ndGggPiAwKQogICAgICAgICAgICAgICAgZ2l2ZW4uc2V0TmFtZShlZm0uZ2V0\nQ29sdW1ucygpWzBdLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgICAgIGJv\nb2xlYW4gY29tcGF0ID0gZ2l2ZW4gPT0gbnVsbCB8fCBnaXZlbi5nZXROYW1l\nKCkgPT0gbnVsbAogICAgICAgICAgICB8fCB0YWJsZSA9PSBudWxsIHx8ICF0\nYWJsZS5pc05hbWVUYWtlbihnaXZlbi5nZXROYW1lKCkpOwoKICAgICAgICBy\nZXR1cm4gbWVyZ2VDb2x1bW4odmFsLCAibnVsbC1pbmQiLCB0bXBsYXRlLCBj\nb21wYXQsIGdpdmVuLAogICAgICAgICAgICB0YWJsZSwgYWRhcHQsIGRlZi5k\nZWZhdWx0TWlzc2luZ0luZm8oKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\neW5jaHJvbml6ZSBpbnRlcm5hbCBpbmZvcm1hdGlvbiB3aXRoIHRoZSBtYXBw\naW5nIGRhdGEgZm9yIHRoZSBnaXZlbgogICAgICogdmFsdWUuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHN5bmNXaXRoKFZhbHVlTWFwcGluZyB2YWwpIHsK\nICAgICAgICBjbGVhcihmYWxzZSk7CgogICAgICAgIF9jcml0ZXJpYSA9IHZh\nbC5nZXRVc2VDbGFzc0NyaXRlcmlhKCk7CiAgICAgICAgc2V0Q29sdW1uSU8o\ndmFsLmdldENvbHVtbklPKCkpOwogICAgICAgIGlmICh2YWwuZ2V0Rm9yZWln\nbktleSgpICE9IG51bGwgJiYgdmFsLmdldFR5cGVNYXBwaW5nKCkgIT0gbnVs\nbAogICAgICAgICAgICAmJiB2YWwuZ2V0VHlwZU1hcHBpbmcoKS5nZXRUYWJs\nZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nIGZtID0g\ndmFsLmdldEZpZWxkTWFwcGluZygpOwogICAgICAgICAgICBUYWJsZSBsb2Nh\nbCA9IChmbS5nZXRKb2luRm9yZWlnbktleSgpICE9IG51bGwpID8gZm0uZ2V0\nVGFibGUoKQogICAgICAgICAgICAgICAgOiBmbS5nZXREZWZpbmluZ01hcHBp\nbmcoKS5nZXRUYWJsZSgpOwogICAgICAgICAgICBUYWJsZSBmb3JlaWduOwog\nICAgICAgICAgICBpZiAodmFsLmdldEpvaW5EaXJlY3Rpb24oKSA9PSBWYWx1\nZU1hcHBpbmcuSk9JTl9FWFBFQ1RFRF9JTlZFUlNFKSB7CiAgICAgICAgICAg\nICAgICBmb3JlaWduID0gbG9jYWw7CiAgICAgICAgICAgICAgICBsb2NhbCA9\nIHZhbC5nZXRUeXBlTWFwcGluZygpLmdldFRhYmxlKCk7CiAgICAgICAgICAg\nICAgICBzZXRKb2luRGlyZWN0aW9uKEpPSU5fRk9SV0FSRCk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3JlaWduID0gdmFsLmdl\ndFR5cGVNYXBwaW5nKCkuZ2V0VGFibGUoKTsKICAgICAgICAgICAgICAgIHNl\ndEpvaW5EaXJlY3Rpb24oKHZhbC5nZXRKb2luRGlyZWN0aW9uKCkgPT0gdmFs\nLkpPSU5fRk9SV0FSRCkKICAgICAgICAgICAgICAgICAgICA/IEpPSU5fRk9S\nV0FSRCA6IEpPSU5fSU5WRVJTRSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgc3luY0ZvcmVpZ25LZXkodmFsLCB2YWwuZ2V0Rm9yZWlnbktleSgpLCBs\nb2NhbCwgZm9yZWlnbik7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHN5\nbmNDb2x1bW5zKHZhbCwgdmFsLmdldENvbHVtbnMoKSwgZmFsc2UpOwoKICAg\nICAgICBzeW5jSW5kZXgodmFsLCB2YWwuZ2V0VmFsdWVJbmRleCgpKTsKICAg\nICAgICBzeW5jVW5pcXVlKHZhbCwgdmFsLmdldFZhbHVlVW5pcXVlKCkpOwoK\nICAgICAgICAvLyBleHBsaWNpdCBoYW5kbGVyIHN0cmF0ZWd5IGlmIHRoZSBo\nYW5kbGVyIGlzbid0IHRoZSBleHBlY3RlZCBkZWZhdWx0CiAgICAgICAgaWYg\nKHZhbC5nZXRIYW5kbGVyKCkgIT0gbnVsbCkgewogICAgICAgICAgICBWYWx1\nZUhhbmRsZXIgZGVmID0gdmFsLmdldEZpZWxkTWFwcGluZygpLmdldE1hcHBp\nbmdSZXBvc2l0b3J5KCkuCiAgICAgICAgICAgICAgICBkZWZhdWx0SGFuZGxl\ncih2YWwpOwogICAgICAgICAgICBpZiAoZGVmID09IG51bGwgfHwgdmFsLmdl\ndEhhbmRsZXIoKS5nZXRDbGFzcygpICE9IGRlZi5nZXRDbGFzcygpKQogICAg\nICAgICAgICAgICAgc2V0U3RyYXRlZ3kodmFsLmdldEhhbmRsZXIoKS5nZXRD\nbGFzcygpLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3Rl\nY3RlZCB2b2lkIGNsZWFyKGJvb2xlYW4gY2FuRmxhZ3MpIHsKICAgICAgICBz\ndXBlci5jbGVhcihjYW5GbGFncyk7CiAgICAgICAgaWYgKGNhbkZsYWdzKSB7\nCiAgICAgICAgICAgIF9jcml0ZXJpYSA9IGZhbHNlOwogICAgICAgICAgICBf\nY2FuTnVsbCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGNvcHkoTWFwcGluZ0luZm8gaW5mbykgewogICAgICAgIHN1cGVyLmNv\ncHkoaW5mbyk7CiAgICAgICAgaWYgKCEoaW5mbyBpbnN0YW5jZW9mIFZhbHVl\nTWFwcGluZ0luZm8pKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFZh\nbHVlTWFwcGluZ0luZm8gdmluZm8gPSAoVmFsdWVNYXBwaW5nSW5mbykgaW5m\nbzsKICAgICAgICBpZiAoIV9jcml0ZXJpYSkKICAgICAgICAgICAgX2NyaXRl\ncmlhID0gdmluZm8uZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpOwogICAgICAgIGlm\nIChfY2FuTnVsbCkKICAgICAgICAgICAgX2Nhbk51bGwgPSB2aW5mby5jYW5J\nbmRpY2F0ZU51bGwoKTsKICAgIH0KfQo=\n","encoding":"base64"}

