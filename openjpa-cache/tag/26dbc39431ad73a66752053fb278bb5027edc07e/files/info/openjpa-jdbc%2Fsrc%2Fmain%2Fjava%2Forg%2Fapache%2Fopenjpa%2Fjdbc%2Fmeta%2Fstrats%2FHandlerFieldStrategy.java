{"sha":"ef1aceeba0814aa5fd9a0fe8de9d5d4764f6c1c1","node_id":"MDQ6QmxvYjIwNjM2NDplZjFhY2VlYmEwODE0YWE1ZmQ5YTBmZThkZTlkNWQ0NzY0ZjZjMWMx","size":15181,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ef1aceeba0814aa5fd9a0fe8de9d5d4764f6c1c1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5F\nbWJlZGRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5GaWVsZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5WYWx1ZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Kb2luczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc3FsLlJvd01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlv\nbjsKCi8qKgogKiBNYXBwaW5nIGZvciBhIHNpbmdsZS12YWx1ZWQgZmllbGQg\ndGhhdCBkZWxlZ2F0ZXMgdG8gYSB7QGxpbmsgVmFsdWVIYW5kbGVyfS4KICoK\nICogQGF1dGhvciBBYmUgV2hpdGUKICogQHNpbmNlIDAuNC4wCiAqLwpwdWJs\naWMgY2xhc3MgSGFuZGxlckZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgQWJz\ndHJhY3RGaWVsZFN0cmF0ZWd5CiAgICBpbXBsZW1lbnRzIEpvaW5hYmxlLCBF\nbWJlZGRhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3Qg\nTlVMTCA9IG5ldyBPYmplY3QoKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAg\nICAgKEhhbmRsZXJGaWVsZFN0cmF0ZWd5LmNsYXNzKTsKCiAgICBwcml2YXRl\nIENvbHVtbltdIF9jb2xzID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uSU8g\nX2lvID0gbnVsbDsKICAgIHByaXZhdGUgT2JqZWN0W10gX2FyZ3MgPSBudWxs\nOwogICAgcHJpdmF0ZSBib29sZWFuIF9sb2FkID0gZmFsc2U7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX2xvYiA9IGZhbHNlOwoKICAgIHB1YmxpYyB2b2lkIG1h\ncChib29sZWFuIGFkYXB0KSB7CiAgICAgICAgaWYgKGZpZWxkLmdldEhhbmRs\nZXIoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWhhbmRsZXIiLCBmaWVsZCkpOwogICAg\nICAgIGFzc2VydE5vdE1hcHBlZEJ5KCk7CgogICAgICAgIC8vIG1hcCBqb2lu\nIGtleSAoaWYgYW55KQogICAgICAgIGZpZWxkLm1hcEpvaW4oYWRhcHQsIGZh\nbHNlKTsKICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJ\nbmZvKCkuYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAgIChm\naWVsZC5nZXRLZXkoKSwgIWFkYXB0KTsKICAgICAgICBmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpLmdldFZhbHVlSW5mbygpLmFzc2VydE5vU2NoZW1hQ29t\ncG9uZW50cwogICAgICAgICAgICAoZmllbGQuZ2V0RWxlbWVudCgpLCAhYWRh\ncHQpOwoKICAgICAgICBfaW8gPSBuZXcgQ29sdW1uSU8oKTsKICAgICAgICBf\nY29scyA9IEhhbmRsZXJTdHJhdGVnaWVzLm1hcChmaWVsZCwgZmllbGQuZ2V0\nTmFtZSgpLCBfaW8sIGFkYXB0KTsKICAgICAgICBpZiAoZmllbGQuZ2V0VmFs\ndWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5BVVRPQVNTSUdOKSB7\nCiAgICAgICAgICAgIC8vIGZpcnN0IHNlZSBpZiBhbnkgY29sdW1ucyBhbHJl\nYWR5IG1hcmtlZCBhdXRvYXNzaWduOyBpZiBub3QgbWFyawogICAgICAgICAg\nICAvLyB0aGVtIGFsbAogICAgICAgICAgICBib29sZWFuIG1hcmtlZCA9IGZh\nbHNlOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgIW1hcmtlZCAmJiBp\nIDwgX2NvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoX2Nv\nbHNbaV0uaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAgICAgICAgICAgICBt\nYXJrZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAoIW1hcmtlZCkKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICAgICAgX2NvbHNbaV0uc2V0QXV0b0Fzc2ln\nbmVkKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHByaW1hcnkg\na2V5IGNvbHVtbnMgdG8gdGFibGUgcGsgaWYgbG9naWNhbAogICAgICAgIGZp\nZWxkLm1hcFByaW1hcnlLZXkoYWRhcHQpOwogICAgICAgIFByaW1hcnlLZXkg\ncGsgPSBmaWVsZC5nZXRUYWJsZSgpLmdldFByaW1hcnlLZXkoKTsKICAgICAg\nICBpZiAoZmllbGQuaXNQcmltYXJ5S2V5KCkgJiYgcGsgIT0gbnVsbCAmJiAo\nYWRhcHQgfHwgcGsuaXNMb2dpY2FsKCkpKQogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgcGsuYWRkQ29sdW1uKF9jb2xzW2ldKTsKCiAgICAgICAgLy8gc2V0IGpv\naW5hYmxlCiAgICAgICAgaWYgKCFmaWVsZC5nZXRIYW5kbGVyKCkub2JqZWN0\nVmFsdWVSZXF1aXJlc0xvYWQoZmllbGQpKQogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IF9jb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuc2V0Sm9pbmFibGUoX2Nv\nbHNbaV0sIHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRpYWxp\nemUoKSB7CiAgICAgICAgX2xvYWQgPSBmaWVsZC5nZXRIYW5kbGVyKCkub2Jq\nZWN0VmFsdWVSZXF1aXJlc0xvYWQoZmllbGQpOwogICAgICAgIGlmIChfbG9h\nZCkKICAgICAgICAgICAgZmllbGQuc2V0VXNlc0ludGVybWVkaWF0ZSh0cnVl\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgIV9sb2IgJiYgaSA8IF9jb2xz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBfbG9iID0gX2NvbHNbaV0uaXNM\nb2IoKTsKCiAgICAgICAgT2JqZWN0IGFyZ3MgPSBmaWVsZC5nZXRIYW5kbGVy\nKCkuZ2V0UmVzdWx0QXJndW1lbnQoZmllbGQpOwogICAgICAgIGlmIChhcmdz\nID09IG51bGwpCiAgICAgICAgICAgIF9hcmdzID0gbnVsbDsKICAgICAgICBl\nbHNlIGlmIChfY29scy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgX2FyZ3Mg\nPSBuZXcgT2JqZWN0W117IGFyZ3MgfTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIF9hcmdzID0gKE9iamVjdFtdKSBhcmdzOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKGZpZWxkLmdldENvbHVtbklPKCkuaXNJ\nbnNlcnRhYmxlKDAsIGZhbHNlKSkgewogICAgICAgICAgICBSb3cgcm93ID0g\nZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJvdy5BQ1RJT05fSU5TRVJU\nKTsKICAgICAgICAgICAgaWYgKHJvdyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBPYmplY3QgdmFsdWUgPSBzbS5mZXRjaChmaWVsZC5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgICAgIGlmICghSGFuZGxlclN0cmF0ZWdpZXMuc2V0\nKGZpZWxkLCB2YWx1ZSwgc3RvcmUsIHJvdywgX2NvbHMsCiAgICAgICAgICAg\nICAgICAgICAgX2lvLCBmaWVsZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1h\ncHBpbmcuTlVMTF9OT05FKSkKICAgICAgICAgICAgICAgICAgICBpZiAoZmll\nbGQuZ2V0VmFsdWVTdHJhdGVneSgpICE9IFZhbHVlU3RyYXRlZ2llcy5BVVRP\nQVNTSUdOKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1zZXQtdmFsdWUiLCByb3cKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRGYWlsZWRPYmplY3QoKSwg\nZmllbGQsIHZhbHVlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgdXBkYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQuZ2V0Q29s\ndW1uSU8oKS5pc1VwZGF0YWJsZSgwLCBmYWxzZSkpIHsKICAgICAgICAgICAg\nUm93IHJvdyA9IGZpZWxkLmdldFJvdyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNU\nSU9OX1VQREFURSk7CiAgICAgICAgICAgIGlmIChyb3cgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgT2JqZWN0IHZhbHVlID0gc20uZmV0Y2goZmllbGQu\nZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAgICBpZiAoIUhhbmRsZXJTdHJh\ndGVnaWVzLnNldChmaWVsZCwgdmFsdWUsIHN0b3JlLCByb3csIF9jb2xzLAog\nICAgICAgICAgICAgICAgICAgIF9pbywgZmllbGQuZ2V0TnVsbFZhbHVlKCkg\nPT0gRmllbGRNYXBwaW5nLk5VTExfTk9ORSkpCiAgICAgICAgICAgICAgICAg\nICAgaWYgKGZpZWxkLmdldFZhbHVlU3RyYXRlZ3koKSAhPSBWYWx1ZVN0cmF0\nZWdpZXMuQVVUT0FTU0lHTikKICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImNhbnQtc2V0LXZhbHVl\nIiwgcm93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0RmFpbGVk\nT2JqZWN0KCksIGZpZWxkLCB2YWx1ZSkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGV0ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgZmllbGQu\nZGVsZXRlUm93KHNtLCBzdG9yZSwgcm0pOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgc3VwcG9ydHNTZWxlY3QoU2VsZWN0IHNlbCwgaW50IHR5cGUsIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKCh0\neXBlID09IFNlbGVjdC5UWVBFX0pPSU5MRVNTICYmIHNlbC5pc1NlbGVjdGVk\nKGZpZWxkLmdldFRhYmxlKCkpKQogICAgICAgICAgICB8fCAoX2xvYWQgJiYg\ndHlwZSA9PSBTZWxlY3QuVFlQRV9UV09fUEFSVCkpCiAgICAgICAgICAgIHJl\ndHVybiAxOwogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHB1YmxpYyBp\nbnQgc2VsZWN0KFNlbGVjdCBzZWwsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlKSB7CiAgICAgICAgaWYgKF9jb2xz\nLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAg\nIGlmIChzbSAhPSBudWxsICYmIHNtLmdldEludGVybWVkaWF0ZShmaWVsZC5n\nZXRJbmRleCgpKSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gLTE7CiAg\nICAgICAgaWYgKF9sb2IgJiYgIWZpZWxkLmlzUHJpbWFyeUtleSgpICYmIChz\nZWwuaXNEaXN0aW5jdCgpIHx8CiAgICAgICAgICAgICAgICBlYWdlck1vZGUg\nPT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FKSkKICAgICAg\nICAgICAgcmV0dXJuIC0xOwogICAgICAgIHNlbC5zZWxlY3QoX2NvbHMsIGZp\nZWxkLmpvaW4oc2VsKSk7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgbG9hZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgUmVzdWx0IHJlcykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoX2NvbHMubGVuZ3RoID09IDAgfHwgIXJlcy5jb250\nYWluc0FsbChfY29scykpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nT2JqZWN0IHZhbCA9IEhhbmRsZXJTdHJhdGVnaWVzLmxvYWREYXRhU3RvcmUo\nZmllbGQsIHJlcywgbnVsbCwgX2NvbHMpOwogICAgICAgIGlmICghX2xvYWQp\nCiAgICAgICAgICAgIHNtLnN0b3JlKGZpZWxkLmdldEluZGV4KCksIGZpZWxk\nLmdldEhhbmRsZXIoKS4KICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFsdWUo\nZmllbGQsIHZhbCkpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAo\ndmFsID09IG51bGwpCiAgICAgICAgICAgICAgICB2YWwgPSBOVUxMOwogICAg\nICAgICAgICBzbS5zZXRJbnRlcm1lZGlhdGUoZmllbGQuZ2V0SW5kZXgoKSwg\ndmFsKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZChP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBldmVuIGlmIG5vIGNvbHVt\nbnMsIGFsbG93IGEgaGFuZGxlciB0byBsb2FkIGEgZ2VuZXJhdGVkIHZhbHVl\nCiAgICAgICAgaWYgKF9jb2xzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAg\nIGlmIChfbG9hZCkKICAgICAgICAgICAgICAgIHNtLnN0b3JlKGZpZWxkLmdl\ndEluZGV4KCksIGZpZWxkLmdldEhhbmRsZXIoKS4KICAgICAgICAgICAgICAg\nICAgICB0b09iamVjdFZhbHVlKGZpZWxkLCBudWxsLCBzbSwgc3RvcmUsIGZl\ndGNoKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNtLnN0\nb3JlKGZpZWxkLmdldEluZGV4KCksIGZpZWxkLmdldEhhbmRsZXIoKS4KICAg\nICAgICAgICAgICAgICAgICB0b09iamVjdFZhbHVlKGZpZWxkLCBudWxsKSk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGxv\nYWQgY2FjaGVkIGludGVybWVkaWF0ZSB2YWx1ZT8KICAgICAgICBpZiAoX2xv\nYWQpIHsKICAgICAgICAgICAgT2JqZWN0IGRzID0gc20uZ2V0SW50ZXJtZWRp\nYXRlKGZpZWxkLmdldEluZGV4KCkpOwogICAgICAgICAgICBpZiAoZHMgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGRzID09IE5VTEwpCiAgICAg\nICAgICAgICAgICAgICAgZHMgPSBudWxsOwogICAgICAgICAgICAgICAgc20u\nc3RvcmUoZmllbGQuZ2V0SW5kZXgoKSwgZmllbGQuZ2V0SGFuZGxlcigpLgog\nICAgICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFsdWUoZmllbGQsIGRzLCBz\nbSwgc3RvcmUsIGZldGNoKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFNlbGVjdCBzZWwgPSBz\ndG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgc2Vs\nLnNlbGVjdChfY29scyk7CiAgICAgICAgZmllbGQud2hlcmVQcmltYXJ5S2V5\nKHNlbCwgc20sIHN0b3JlKTsKCiAgICAgICAgUmVzdWx0IHJlcyA9IHNlbC5l\neGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgT2JqZWN0IHZhbCA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcy5uZXh0KCkp\nCiAgICAgICAgICAgICAgICB2YWwgPSBIYW5kbGVyU3RyYXRlZ2llcy5sb2Fk\nRGF0YVN0b3JlKGZpZWxkLCByZXMsIG51bGwsIF9jb2xzKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICB9\nCgogICAgICAgIGxvYWRFbWJlZGRlZChzbSwgc3RvcmUsIGZldGNoLCB2YWwp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgdG9EYXRhU3RvcmVWYWx1ZShP\nYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICByZXR1cm4g\nSGFuZGxlclN0cmF0ZWdpZXMudG9EYXRhU3RvcmVWYWx1ZShmaWVsZCwgdmFs\nLCBfY29scywgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVu\nZElzTnVsbChTUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZmFsc2UpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKGkgPiAwKQogICAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0\nQ29sdW1uQWxpYXMoX2NvbHNbaV0sIGpvaW5zKSkuYXBwZW5kKCIgSVMgIiku\nCiAgICAgICAgICAgICAgICBhcHBlbmRWYWx1ZShudWxsLCBfY29sc1tpXSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90\nTnVsbChTUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucykg\newogICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZmFsc2UpOwogICAgICAg\nIGlmIChfY29scy5sZW5ndGggPiAxKQogICAgICAgICAgICBzcWwuYXBwZW5k\nKCIoIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAg\nICAgICBzcWwuYXBwZW5kKCIgT1IgIik7CiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoc2VsLmdldENvbHVtbkFsaWFzKF9jb2xzW2ldLCBqb2lucykpLgogICAg\nICAgICAgICAgICAgYXBwZW5kKCIgSVMgTk9UICIpLmFwcGVuZFZhbHVlKG51\nbGwsIF9jb2xzW2ldKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9jb2xzLmxl\nbmd0aCA+IDEpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIikiKTsKICAgIH0K\nCiAgICBwdWJsaWMgSm9pbnMgam9pbihKb2lucyBqb2lucywgYm9vbGVhbiBm\nb3JjZU91dGVyKSB7CiAgICAgICAgcmV0dXJuIGZpZWxkLmpvaW4oam9pbnMs\nIGZvcmNlT3V0ZXIsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nam9pblJlbGF0aW9uKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIs\nCiAgICAgICAgYm9vbGVhbiB0cmF2ZXJzZSkgewogICAgICAgIGlmICh0cmF2\nZXJzZSkKICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMuYXNzZXJ0Sm9p\nbmFibGUoZmllbGQpOwogICAgICAgIHJldHVybiBqb2luczsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGxvYWRQcm9qZWN0aW9uKEpEQkNTdG9yZSBzdG9y\nZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBSZXN1\nbHQgcmVzLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gSGFuZGxlclN0cmF0ZWdpZXMubG9hZE9i\namVjdChmaWVsZCwgbnVsbCwgc3RvcmUsIGZldGNoLCByZXMsCiAgICAgICAg\nICAgIGpvaW5zLCBfY29scywgX2xvYWQpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGlzVmVyc2lvbmFibGUoKSB7CiAgICAgICAgcmV0dXJuICFfbG9i\nICYmICFmaWVsZC5pc0pvaW5PdXRlcigpCiAgICAgICAgICAgICYmIGZpZWxk\nLmdldEhhbmRsZXIoKS5pc1ZlcnNpb25hYmxlKGZpZWxkKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB3aGVyZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBK\nREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0sCiAgICAgICAgT2JqZWN0\nIHByZXZWYWx1ZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBSb3cgcm93ID0gZmllbGQuZ2V0Um93KHNtLCBzdG9yZSwgcm0sIFJv\ndy5BQ1RJT05fVVBEQVRFKTsKICAgICAgICBpZiAocm93ICE9IG51bGwpCiAg\nICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLndoZXJlKGZpZWxkLCBwcmV2\nVmFsdWUsIHN0b3JlLCByb3csIF9jb2xzKTsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEpvaW5hYmxlIGltcGxlbWVu\ndGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgaW50IGdldEZpZWxkSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIGZp\nZWxkLmdldEluZGV4KCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRQ\ncmltYXJ5S2V5VmFsdWUoUmVzdWx0IHJlcywgQ29sdW1uW10gY29scywgRm9y\nZWlnbktleSBmaywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpvaW5zIGpv\naW5zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIENv\nbHVtbiBjb2w7CiAgICAgICAgT2JqZWN0IHZhbCA9IG51bGw7CiAgICAgICAg\naWYgKGNvbHMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgY29sID0gY29s\nc1swXTsKICAgICAgICAgICAgaWYgKGZrICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBjb2wgPSBmay5nZXRDb2x1bW4oY29sKTsKICAgICAgICAgICAgdmFs\nID0gcmVzLmdldE9iamVjdChjb2wsIGZpZWxkLmdldEhhbmRsZXIoKS4KICAg\nICAgICAgICAgICAgIGdldFJlc3VsdEFyZ3VtZW50KGZpZWxkKSwgam9pbnMp\nOwogICAgICAgIH0gZWxzZSBpZiAoY29scy5sZW5ndGggPiAxKSB7CiAgICAg\nICAgICAgIE9iamVjdFtdIHZhbHMgPSBuZXcgT2JqZWN0W2NvbHMubGVuZ3Ro\nXTsKICAgICAgICAgICAgT2JqZWN0W10gYXJncyA9IChPYmplY3RbXSkgZmll\nbGQuZ2V0SGFuZGxlcigpLgogICAgICAgICAgICAgICAgZ2V0UmVzdWx0QXJn\ndW1lbnQoZmllbGQpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHZhbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbCA9IGNv\nbHNbaV07CiAgICAgICAgICAgICAgICBpZiAoZmsgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBjb2wgPSBmay5nZXRDb2x1bW4oY29sKTsKICAgICAg\nICAgICAgICAgIHZhbHNbaV0gPSByZXMuZ2V0T2JqZWN0KGNvbCwgKGFyZ3Mg\nPT0gbnVsbCkgPyBudWxsIDogYXJnc1tpXSwKICAgICAgICAgICAgICAgICAg\nICBqb2lucyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFsID0gdmFs\nczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpZWxkLmdldEhhbmRsZXIo\nKS50b09iamVjdFZhbHVlKGZpZWxkLCB2YWwpOwogICAgfQoKICAgIHB1Ymxp\nYyBDb2x1bW5bXSBnZXRDb2x1bW5zKCkgewogICAgICAgIHJldHVybiBfY29s\nczsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZ2V0UmVzdWx0QXJndW1l\nbnRzKCkgewogICAgICAgIHJldHVybiBfYXJnczsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldEpvaW5WYWx1ZShPYmplY3QgZmllbGRWYWwsIENvbHVt\nbiBjb2wsIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIE9iamVjdCB2YWwg\nPSBIYW5kbGVyU3RyYXRlZ2llcy50b0RhdGFTdG9yZVZhbHVlKGZpZWxkLCBm\naWVsZFZhbCwKICAgICAgICAgICAgX2NvbHMsIHN0b3JlKTsKICAgICAgICBp\nZiAodmFsID09IG51bGwgfHwgX2NvbHMubGVuZ3RoIDwgMikKICAgICAgICAg\nICAgcmV0dXJuIHZhbDsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\nY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKF9jb2xzW2ldID09\nIGNvbCkKICAgICAgICAgICAgICAgIHJldHVybiAoKE9iamVjdFtdKSB2YWwp\nW2ldOwogICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Sm9pblZhbHVlKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIENvbHVtbiBjb2wsCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlKSB7CiAgICAgICAgcmV0dXJuIGdldEpvaW5WYWx1ZShzbS5mZXRj\naChmaWVsZC5nZXRJbmRleCgpKSwgY29sLCBzdG9yZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0QXV0b0Fzc2lnbmVkVmFsdWUoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIENvbHVtbiBj\nb2wsIE9iamVjdCBhdXRvSW5jKSB7CiAgICAgICAgT2JqZWN0IGRhdGE7CiAg\nICAgICAgaWYgKF9jb2xzLmxlbmd0aCA9PSAxKQogICAgICAgICAgICBkYXRh\nID0gSmF2YVR5cGVzLmNvbnZlcnQoYXV0b0luYywgY29sLmdldEphdmFUeXBl\nKCkpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBtdWx0aXBsZSBj\nb2x1bW5zOyBoYXZlIHRvIGdldCBjdXJyZW50IHZhbHVlLCByZXBsYWNlIHRo\naXMgY29sJ3MKICAgICAgICAgICAgLy8gdmFsdWUgd2l0aCB0aGUgZ2l2ZW4g\nb25lLCBhbmQgcmVzZXQKICAgICAgICAgICAgZGF0YSA9IGZpZWxkLmdldEhh\nbmRsZXIoKS50b0RhdGFTdG9yZVZhbHVlKGZpZWxkLAogICAgICAgICAgICAg\nICAgc20uZmV0Y2goZmllbGQuZ2V0SW5kZXgoKSksIHN0b3JlKTsKICAgICAg\nICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGRhdGEg\nPSBuZXcgT2JqZWN0W19jb2xzLmxlbmd0aF07CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgX2NvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChfY29sc1tpXSA9PSBjb2wpIHsKICAgICAgICAgICAgICAg\nICAgICAoKE9iamVjdFtdKSBkYXRhKVtpXSA9IEphdmFUeXBlcy5jb252ZXJ0\nKGF1dG9JbmMsIAogICAgICAgICAgICAgICAgICAgICAgICBjb2wuZ2V0SmF2\nYVR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIE9i\namVjdCB2YWwgPSBmaWVsZC5nZXRIYW5kbGVyKCkudG9PYmplY3RWYWx1ZShm\naWVsZCwgZGF0YSk7CiAgICAgICAgc20uc3RvcmUoZmllbGQuZ2V0SW5kZXgo\nKSwgdmFsKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gRW1iZWRkYWJsZSBpbXBsZW1lbnRhdGlvbgogICAgLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgQ29sdW1u\nSU8gZ2V0Q29sdW1uSU8oKSB7CiAgICAgICAgcmV0dXJuIF9pbzsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IHRvRW1iZWRkZWREYXRhU3RvcmVWYWx1ZShP\nYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICAvLyBkb24n\ndCB1c2UgSGFuZGxlclN0cmF0ZWdpZXMudG9EYXRhU3RvcmVWYWx1ZSBiL2Mg\nd2Ugd2FudCByZWxhdGlvbiBpZHMKICAgICAgICAvLyB0byBiZSByZXByZXNl\nbnRlZCBieSBzdGF0ZSBtYW5hZ2Vycywgbm90IHRoZSBzZXJpYWxpemVkIGlk\nIHZhbHVlCiAgICAgICAgdmFsID0gZmllbGQuZ2V0SGFuZGxlcigpLnRvRGF0\nYVN0b3JlVmFsdWUoZmllbGQsIHZhbCwgc3RvcmUpOwogICAgICAgIGlmICh2\nYWwgPT0gbnVsbCAmJiBfY29scy5sZW5ndGggPiAxKQogICAgICAgICAgICBy\nZXR1cm4gbmV3IE9iamVjdFtfY29scy5sZW5ndGhdOwogICAgICAgIHJldHVy\nbiB2YWw7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0b0VtYmVkZGVkT2Jq\nZWN0VmFsdWUoT2JqZWN0IHZhbCkgewogICAgICAgIGlmICghX2xvYWQpCiAg\nICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRIYW5kbGVyKCkudG9PYmplY3RW\nYWx1ZShmaWVsZCwgdmFsKTsKICAgICAgICByZXR1cm4gVU5TVVBQT1JURUQ7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZEVtYmVkZGVkKE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgdmFsKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2YWwgPT0gbnVs\nbCAmJiBfY29scy5sZW5ndGggPiAxKQogICAgICAgICAgICB2YWwgPSBuZXcg\nT2JqZWN0W19jb2xzLmxlbmd0aF07CiAgICAgICAgaWYgKF9sb2FkKQogICAg\nICAgICAgICBzbS5zdG9yZShmaWVsZC5nZXRJbmRleCgpLCBmaWVsZC5nZXRI\nYW5kbGVyKCkuCiAgICAgICAgICAgICAgICB0b09iamVjdFZhbHVlKGZpZWxk\nLCB2YWwsIHNtLCBzdG9yZSwgZmV0Y2gpKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHNtLnN0b3JlKGZpZWxkLmdldEluZGV4KCksIGZpZWxkLmdldEhh\nbmRsZXIoKS4KICAgICAgICAgICAgICAgIHRvT2JqZWN0VmFsdWUoZmllbGQs\nIHZhbCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

