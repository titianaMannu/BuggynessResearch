{"sha":"a931b4c0c85a92ea3551190ba2be7a1583c7670b","node_id":"MDQ6QmxvYjIwNjM2NDphOTMxYjRjMGM4NWE5MmVhMzU1MTE5MGJhMmJlN2ExNTgzYzc2NzBi","size":12718,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a931b4c0c85a92ea3551190ba2be7a1583c7670b","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzOw0KDQppbXBvcnQgamF2YS5zcWwuKjsNCmltcG9ydCBq\nYXZhLnV0aWwuKjsNCg0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLio7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC4qOw0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLio7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC4qOw0KDQovKioNCiAqIDxwPk1hcHBpbmcgZm9yIGEgbWFwIHdob3Nl\nIGtleXMgYXJlIGNvbnRyb2xsZWQgYnkgYSB7QGxpbmsgVmFsdWVIYW5kbGVy\nfQ0KICogYW5kIHdob3NlIHZhbHVlcyBhcmUgcmVsYXRpb25zIHRvIG90aGVy\nIHBlcnNpc3RlbnQgb2JqZWN0cy48L3A+DQogKg0KICogQGF1dGhvciBBYmUg\nV2hpdGUNCiAqIEBzaW5jZSAwLjQuMCwgMS4xLjANCiAqLw0KcHVibGljIGNs\nYXNzIEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmllbGRTdHJhdGVneQ0KICAg\nIGV4dGVuZHMgTWFwVGFibGVGaWVsZFN0cmF0ZWd5IHsNCg0KICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZv\nclBhY2thZ2UNCiAgICAgICAgKEhhbmRsZXJSZWxhdGlvbk1hcFRhYmxlRmll\nbGRTdHJhdGVneS5jbGFzcyk7DQoNCiAgICBwcml2YXRlIENvbHVtbltdIF9r\nY29scyA9IG51bGw7DQogICAgcHJpdmF0ZSBDb2x1bW5JTyBfa2lvID0gbnVs\nbDsNCiAgICBwcml2YXRlIGJvb2xlYW4gX2tsb2FkID0gZmFsc2U7DQoNCiAg\nICBwdWJsaWMgQ29sdW1uW10gZ2V0S2V5Q29sdW1ucyhDbGFzc01hcHBpbmcg\nY2xzKSB7DQogICAgICAgIHJldHVybiBfa2NvbHM7DQogICAgfQ0KDQogICAg\ncHVibGljIENvbHVtbltdIGdldFZhbHVlQ29sdW1ucyhDbGFzc01hcHBpbmcg\nY2xzKSB7DQogICAgICAgIHJldHVybiBmaWVsZC5nZXRFbGVtZW50TWFwcGlu\nZygpLmdldENvbHVtbnMoKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBz\nZWxlY3RLZXkoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIGtleSwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwNCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBKb2lucyBqb2lucykgew0K\nICAgICAgICBzZWwuc2VsZWN0KF9rY29scywgam9pbnMpOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyB2b2lkIHNlbGVjdFZhbHVlKFNlbGVjdCBzZWwsIENsYXNz\nTWFwcGluZyB2YWwsDQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgDQogICAgICAgIEpvaW5zIGpvaW5zKSB7DQogICAgICAgIHNlbC5zZWxl\nY3QodmFsLCBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwNCiAgICAgICAgICAgIHN0b3JlLCBmZXRjaCwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbi5FQUdFUl9OT05FLCBqb2lucyk7DQogICAgfQ0K\nDQogICAgcHVibGljIFJlc3VsdFtdIGdldFJlc3VsdHMoZmluYWwgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwNCiAgICAgICAgZmluYWwgSkRCQ1N0b3JlIHN0\nb3JlLCBmaW5hbCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLA0KICAg\nICAgICBmaW5hbCBpbnQgZWFnZXJNb2RlLCBmaW5hbCBKb2luc1tdIHJlc0pv\naW5zLCBib29sZWFuIGxycykNCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7DQogICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxl\nbWVudE1hcHBpbmcoKTsNCiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5nW10g\ndmFscyA9IGVsZW0uZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsNCiAg\nICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3\nVW5pb24odmFscy5sZW5ndGgpOw0KICAgICAgICBpZiAoZmV0Y2guZ2V0U3Vi\nY2xhc3NGZXRjaE1vZGUoZWxlbS5nZXRUeXBlTWFwcGluZygpKQ0KICAgICAg\nICAgICAgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOKQ0K\nICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOw0KICAgICAgICB1bmlv\nbi5zZXRMUlMobHJzKTsNCiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlv\nbi5TZWxlY3RvcigpIHsNCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7DQogICAgICAgICAgICAgICAgc2Vs\nLnNlbGVjdChfa2NvbHMpOw0KICAgICAgICAgICAgICAgIHNlbC53aGVyZUZv\ncmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwNCiAgICAgICAg\nICAgICAgICAgICAgc20uZ2V0T2JqZWN0SWQoKSwgZmllbGQuZ2V0RGVmaW5p\nbmdNYXBwaW5nKCksIHN0b3JlKTsNCg0KICAgICAgICAgICAgICAgIEpvaW5z\nIGpvaW5zID0gam9pblZhbHVlUmVsYXRpb24oc2VsLm5ld0pvaW5zKCksIHZh\nbHNbaWR4XSk7DQogICAgICAgICAgICAgICAgc2VsLnNlbGVjdCh2YWxzW2lk\neF0sIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuDQogICAgICAgICAgICAg\nICAgICAgIGdldFNlbGVjdFN1YmNsYXNzZXMoKSwgc3RvcmUsIGZldGNoLCBl\nYWdlck1vZGUsIGpvaW5zKTsNCg0KICAgICAgICAgICAgICAgIC8vIyMjIGNo\nZWF0OiByZXN1bHQgam9pbnMgb25seSBjYXJlIGFib3V0IHRoZSByZWxhdGlv\nbiBwYXRoOw0KICAgICAgICAgICAgICAgIC8vIyMjIHRodXMgd2UgY2FuIHVz\nZSBmaXJzdCBtYXBwaW5nIG9mIHVuaW9uIG9ubHkNCiAgICAgICAgICAgICAg\nICBpZiAoaWR4ID09IDApDQogICAgICAgICAgICAgICAgICAgIHJlc0pvaW5z\nWzFdID0gam9pbnM7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAg\nICAgICBSZXN1bHQgcmVzID0gdW5pb24uZXhlY3V0ZShzdG9yZSwgZmV0Y2gp\nOw0KICAgICAgICByZXR1cm4gbmV3IFJlc3VsdFtdeyByZXMsIHJlcyB9Ow0K\nICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgbG9hZEtleShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsDQogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEpvaW5zIGpv\naW5zKQ0KICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAgICAg\ncmV0dXJuIEhhbmRsZXJTdHJhdGVnaWVzLmxvYWRPYmplY3QoZmllbGQuZ2V0\nS2V5TWFwcGluZygpLA0KICAgICAgICAgICAgc20sIHN0b3JlLCBmZXRjaCwg\ncmVzLCBqb2lucywgX2tjb2xzLCBfa2xvYWQpOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBPYmplY3QgbG9hZFZhbHVlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwNCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpDQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAgICAgICBDbGFzc01hcHBpbmcg\ndmFsID0gcmVzLmdldEJhc2VNYXBwaW5nKCk7DQogICAgICAgIGlmICh2YWwg\nPT0gbnVsbCkNCiAgICAgICAgICAgIHZhbCA9IGZpZWxkLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKVswXTsNCiAg\nICAgICAgcmV0dXJuIHJlcy5sb2FkKHZhbCwgc3RvcmUsIGZldGNoLCBqb2lu\ncyk7DQogICAgfQ0KDQogICAgcHVibGljIEpvaW5zIGpvaW5WYWx1ZVJlbGF0\naW9uKEpvaW5zIGpvaW5zLCBDbGFzc01hcHBpbmcgdmFsKSB7DQogICAgICAg\nIFZhbHVlTWFwcGluZyB2bSA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7\nDQogICAgICAgIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0\nTmFtZSgpLCB2bS5nZXRGb3JlaWduS2V5KHZhbCksIHZhbCwNCiAgICAgICAg\nICAgIHZtLmdldFNlbGVjdFN1YmNsYXNzZXMoKSwgZmFsc2UsIGZhbHNlKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBtYXAoYm9vbGVhbiBhZGFwdCkg\new0KICAgICAgICBzdXBlci5tYXAoYWRhcHQpOw0KDQogICAgICAgIFZhbHVl\nTWFwcGluZyBrZXkgPSBmaWVsZC5nZXRLZXlNYXBwaW5nKCk7DQogICAgICAg\nIGlmIChrZXkuZ2V0SGFuZGxlcigpID09IG51bGwpDQogICAgICAgICAgICB0\naHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWhhbmRs\nZXIiLCBrZXkpKTsNCiAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxk\nLmdldEVsZW1lbnRNYXBwaW5nKCk7DQogICAgICAgIGlmICh2YWwuZ2V0VHlw\nZUNvZGUoKSAhPSBKYXZhVHlwZXMuUEMgfHwgdmFsLmlzRW1iZWRkZWRQQygp\nKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub3QtcmVsYXRpb24iLCB2YWwpKTsNCiAgICAgICAgYXNzZXJ0\nTm90TWFwcGVkQnkoKTsNCg0KICAgICAgICBmaWVsZC5tYXBKb2luKGFkYXB0\nLCB0cnVlKTsNCiAgICAgICAgX2tpbyA9IG5ldyBDb2x1bW5JTygpOw0KICAg\nICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IGZpZWxkLmdldE1hcHBpbmdSZXBv\nc2l0b3J5KCkuZ2V0REJEaWN0aW9uYXJ5KCk7DQogICAgICAgIF9rY29scyA9\nIEhhbmRsZXJTdHJhdGVnaWVzLm1hcChrZXksIA0KICAgICAgICAgICAgZGlj\ndC5nZXRWYWxpZENvbHVtbk5hbWUoImtleSIsIGZpZWxkLmdldFRhYmxlKCkp\nLCBfa2lvLCBhZGFwdCk7DQoNCiAgICAgICAgaWYgKHZhbC5nZXRUeXBlTWFw\ncGluZygpLmlzTWFwcGVkKCkpIHsNCiAgICAgICAgICAgIFZhbHVlTWFwcGlu\nZ0luZm8gdmluZm8gPSB2YWwuZ2V0VmFsdWVJbmZvKCk7DQogICAgICAgICAg\nICBGb3JlaWduS2V5IGZrID0gdmluZm8uZ2V0VHlwZUpvaW4odmFsLCAidmFs\ndWUiLCBmYWxzZSwgYWRhcHQpOw0KICAgICAgICAgICAgdmFsLnNldEZvcmVp\nZ25LZXkoZmspOw0KICAgICAgICAgICAgdmFsLnNldENvbHVtbklPKHZpbmZv\nLmdldENvbHVtbklPKCkpOw0KICAgICAgICB9IGVsc2UNCiAgICAgICAgICAg\nIFJlbGF0aW9uU3RyYXRlZ2llcy5tYXBSZWxhdGlvblRvVW5tYXBwZWRQQyh2\nYWwsICJ2YWx1ZSIsIGFkYXB0KTsNCg0KICAgICAgICB2YWwubWFwQ29uc3Ry\nYWludHMoInZhbHVlIiwgYWRhcHQpOw0KICAgICAgICBmaWVsZC5tYXBQcmlt\nYXJ5S2V5KGFkYXB0KTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBpbml0\naWFsaXplKCkgew0KICAgICAgICBfa2xvYWQgPSBmaWVsZC5nZXRLZXlNYXBw\naW5nKCkuZ2V0SGFuZGxlcigpLg0KICAgICAgICAgICAgb2JqZWN0VmFsdWVS\nZXF1aXJlc0xvYWQoZmllbGQuZ2V0S2V5TWFwcGluZygpKTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQ0KICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAgICAgaW5zZXJ0KHNtLCBzdG9y\nZSwgcm0sIChNYXApIHNtLmZldGNoT2JqZWN0KGZpZWxkLmdldEluZGV4KCkp\nKTsNCiAgICB9DQoNCiAgICBwcml2YXRlIHZvaWQgaW5zZXJ0KE9wZW5KUEFT\ndGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBy\nbSwNCiAgICAgICAgTWFwIG1hcCkNCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7DQogICAgICAgIGlmIChtYXAgPT0gbnVsbCB8fCBtYXAuaXNFbXB0\neSgpKQ0KICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgIFJvdyByb3cg\nPSBybS5nZXRTZWNvbmRhcnlSb3coZmllbGQuZ2V0VGFibGUoKSwgUm93LkFD\nVElPTl9JTlNFUlQpOw0KICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaWVs\nZC5nZXRKb2luRm9yZWlnbktleSgpLCBmaWVsZC5nZXRKb2luQ29sdW1uSU8o\nKSwNCiAgICAgICAgICAgIHNtKTsNCg0KICAgICAgICBWYWx1ZU1hcHBpbmcg\na2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOw0KICAgICAgICBWYWx1ZU1h\ncHBpbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsNCiAgICAg\nICAgU3RvcmVDb250ZXh0IGN0eCA9IHN0b3JlLmdldENvbnRleHQoKTsNCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciB2YWxzbTsNCiAgICAgICAgTWFw\nLkVudHJ5IGVudHJ5Ow0KICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1h\ncC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQog\nICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7DQog\nICAgICAgICAgICBIYW5kbGVyU3RyYXRlZ2llcy5zZXQoa2V5LCBlbnRyeS5n\nZXRLZXkoKSwgc3RvcmUsIHJvdywgX2tjb2xzLA0KICAgICAgICAgICAgICAg\nIF9raW8sIHRydWUpOw0KICAgICAgICAgICAgdmFsc20gPSBSZWxhdGlvblN0\ncmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGVudHJ5LmdldFZhbHVlKCksDQog\nICAgICAgICAgICAgICAgY3R4KTsNCiAgICAgICAgICAgIHZhbC5zZXRGb3Jl\naWduS2V5KHJvdywgdmFsc20pOw0KICAgICAgICAgICAgcm0uZmx1c2hTZWNv\nbmRhcnlSb3cocm93KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIHVwZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3Rv\ncmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pDQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gew0KICAgICAgICBNYXAgbWFwID0gKE1hcCkgc20uZmV0Y2hP\nYmplY3QoZmllbGQuZ2V0SW5kZXgoKSk7DQogICAgICAgIENoYW5nZVRyYWNr\nZXIgY3QgPSBudWxsOw0KICAgICAgICBpZiAobWFwIGluc3RhbmNlb2YgUHJv\neHkpIHsNCiAgICAgICAgICAgIFByb3h5IHByb3h5ID0gKFByb3h5KSBtYXA7\nDQogICAgICAgICAgICBpZiAoUHJveGllcy5pc093bmVyKHByb3h5LCBzbSwg\nZmllbGQuZ2V0SW5kZXgoKSkpDQogICAgICAgICAgICAgICAgY3QgPSBwcm94\neS5nZXRDaGFuZ2VUcmFja2VyKCk7DQogICAgICAgIH0NCg0KICAgICAgICAv\nLyBpZiBubyBmaW5lLWdyYWluZWQgY2hhbmdlIHRyYWNraW5nIHRoZW4ganVz\ndCBkZWxldGUgYW5kIHJlaW5zZXJ0DQogICAgICAgIGlmIChjdCA9PSBudWxs\nIHx8ICFjdC5pc1RyYWNraW5nKCkpIHsNCiAgICAgICAgICAgIGRlbGV0ZShz\nbSwgc3RvcmUsIHJtKTsNCiAgICAgICAgICAgIGluc2VydChzbSwgc3RvcmUs\nIHJtLCBtYXApOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoN\nCiAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9IGZpZWxkLmdldEtleU1hcHBp\nbmcoKTsNCiAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxkLmdldEVs\nZW1lbnRNYXBwaW5nKCk7DQogICAgICAgIFN0b3JlQ29udGV4dCBjdHggPSBz\ndG9yZS5nZXRDb250ZXh0KCk7DQogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgdmFsc207DQoNCiAgICAgICAgLy8gdXBkYXRlIHRoZSBjaGFuZ2VzOyBu\nb3RlIHRoYXQgd2UgaGF2ZSB0byBtb2RlbCBjaGFuZ2VzIGFzDQogICAgICAg\nIC8vIGRlbGV0ZS10aGVuLWluc2VydCBpZiB3ZSBoYXZlIGEgZm9yZWlnbiBr\nZXkgYWN0aW9uLCBiZWNhdXNlDQogICAgICAgIC8vIHNlY29uZGFyeSByb3cg\ndXBkYXRlcyBhcmVuJ3QgcGFydCBvZiB0aGUgY29uc3RyYWludCBncmFwaA0K\nICAgICAgICBDb2xsZWN0aW9uIGNoYW5nZSA9IGN0LmdldENoYW5nZWQoKTsN\nCiAgICAgICAgYm9vbGVhbiBjYW5DaGFuZ2UgPSB2YWwuZ2V0Rm9yZWlnbktl\neSgpLmlzTG9naWNhbCgpOw0KICAgICAgICBPYmplY3QgbWtleTsNCiAgICAg\nICAgaWYgKGNhbkNoYW5nZSAmJiAhY2hhbmdlLmlzRW1wdHkoKSkgew0KICAg\nICAgICAgICAgUm93IGNoYW5nZVJvdyA9IHJtLmdldFNlY29uZGFyeVJvdyhm\naWVsZC5nZXRUYWJsZSgpLA0KICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05f\nVVBEQVRFKTsNCiAgICAgICAgICAgIGNoYW5nZVJvdy53aGVyZUZvcmVpZ25L\nZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwgc20pOw0KDQogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGNoYW5nZS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIG1rZXkgPSBpdHIu\nbmV4dCgpOw0KICAgICAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLndo\nZXJlKGtleSwgbWtleSwgc3RvcmUsIGNoYW5nZVJvdywgX2tjb2xzKTsNCiAg\nICAgICAgICAgICAgICB2YWxzbSA9IFJlbGF0aW9uU3RyYXRlZ2llcy5nZXRT\ndGF0ZU1hbmFnZXIobWFwLmdldChta2V5KSwgY3R4KTsNCiAgICAgICAgICAg\nICAgICB2YWwuc2V0Rm9yZWlnbktleShjaGFuZ2VSb3csIHZhbHNtKTsNCiAg\nICAgICAgICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhjaGFuZ2VSb3cp\nOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gZGVs\nZXRlIHRoZSByZW1vdmVzDQogICAgICAgIENvbGxlY3Rpb24gcmVtID0gY3Qu\nZ2V0UmVtb3ZlZCgpOw0KICAgICAgICBpZiAoIXJlbS5pc0VtcHR5KCkgfHwg\nKCFjYW5DaGFuZ2UgJiYgIWNoYW5nZS5pc0VtcHR5KCkpKSB7DQogICAgICAg\nICAgICBSb3cgZGVsUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdl\ndFRhYmxlKCksDQogICAgICAgICAgICAgICAgUm93LkFDVElPTl9ERUxFVEUp\nOw0KICAgICAgICAgICAgZGVsUm93LndoZXJlRm9yZWlnbktleShmaWVsZC5n\nZXRKb2luRm9yZWlnbktleSgpLCBzbSk7DQoNCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gcmVtLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7DQogICAgICAgICAgICAgICAgSGFuZGxlclN0cmF0ZWdpZXMud2hlcmUo\na2V5LCBpdHIubmV4dCgpLCBzdG9yZSwgZGVsUm93LA0KICAgICAgICAgICAg\nICAgICAgICBfa2NvbHMpOw0KICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vj\nb25kYXJ5Um93KGRlbFJvdyk7DQogICAgICAgICAgICB9DQogICAgICAgICAg\nICBpZiAoIWNhbkNoYW5nZSAmJiAhY2hhbmdlLmlzRW1wdHkoKSkgew0KICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2hhbmdlLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAgICAgICAg\nIEhhbmRsZXJTdHJhdGVnaWVzLndoZXJlKGtleSwgaXRyLm5leHQoKSwgc3Rv\ncmUsIGRlbFJvdywNCiAgICAgICAgICAgICAgICAgICAgICAgIF9rY29scyk7\nDQogICAgICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vjb25kYXJ5Um93KGRl\nbFJvdyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAg\nICAgICB9DQoNCiAgICAgICAgLy8gaW5zZXJ0IHRoZSBhZGRzDQogICAgICAg\nIENvbGxlY3Rpb24gYWRkID0gY3QuZ2V0QWRkZWQoKTsNCiAgICAgICAgaWYg\nKCFhZGQuaXNFbXB0eSgpIHx8ICghY2FuQ2hhbmdlICYmICFjaGFuZ2UuaXNF\nbXB0eSgpKSkgew0KICAgICAgICAgICAgUm93IGFkZFJvdyA9IHJtLmdldFNl\nY29uZGFyeVJvdyhmaWVsZC5nZXRUYWJsZSgpLA0KICAgICAgICAgICAgICAg\nIFJvdy5BQ1RJT05fSU5TRVJUKTsNCiAgICAgICAgICAgIGFkZFJvdy5zZXRG\nb3JlaWduS2V5KGZpZWxkLmdldEpvaW5Gb3JlaWduS2V5KCksDQogICAgICAg\nICAgICAgICAgZmllbGQuZ2V0Sm9pbkNvbHVtbklPKCksIHNtKTsNCg0KICAg\nICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhZGQuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgICAgICBta2V5ID0gaXRy\nLm5leHQoKTsNCiAgICAgICAgICAgICAgICBIYW5kbGVyU3RyYXRlZ2llcy5z\nZXQoa2V5LCBta2V5LCBzdG9yZSwgYWRkUm93LCBfa2NvbHMsDQogICAgICAg\nICAgICAgICAgICAgIF9raW8sIHRydWUpOw0KICAgICAgICAgICAgICAgIHZh\nbHNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihtYXAu\nZ2V0KG1rZXkpLCBjdHgpOw0KICAgICAgICAgICAgICAgIHZhbC5zZXRGb3Jl\naWduS2V5KGFkZFJvdywgdmFsc20pOw0KICAgICAgICAgICAgICAgIHJtLmZs\ndXNoU2Vjb25kYXJ5Um93KGFkZFJvdyk7DQogICAgICAgICAgICB9DQogICAg\nICAgICAgICBpZiAoIWNhbkNoYW5nZSAmJiAhY2hhbmdlLmlzRW1wdHkoKSkg\new0KICAgICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gY2hhbmdl\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgICAgIG1rZXkgPSBpdHIubmV4dCgpOw0KICAgICAgICAgICAgICAgICAg\nICBIYW5kbGVyU3RyYXRlZ2llcy5zZXQoa2V5LCBta2V5LCBzdG9yZSwgYWRk\nUm93LCBfa2NvbHMsDQogICAgICAgICAgICAgICAgICAgICAgICBfa2lvLCB0\ncnVlKTsNCiAgICAgICAgICAgICAgICAgICAgdmFsc20gPSBSZWxhdGlvblN0\ncmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKG1hcC5nZXQobWtleSksDQogICAg\nICAgICAgICAgICAgICAgICAgICBjdHgpOw0KICAgICAgICAgICAgICAgICAg\nICB2YWwuc2V0Rm9yZWlnbktleShhZGRSb3csIHZhbHNtKTsNCiAgICAgICAg\nICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coYWRkUm93KTsNCiAg\nICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKEpvaW5zIGpv\naW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsDQogICAgICAgIGJvb2xlYW4gdHJh\ndmVyc2UpIHsNCiAgICAgICAgVmFsdWVNYXBwaW5nIHZhbCA9IGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCk7DQogICAgICAgIENsYXNzTWFwcGluZ1tdIGNs\nc3MgPSB2YWwuZ2V0SW5kZXBlbmRlbnRUeXBlTWFwcGluZ3MoKTsNCiAgICAg\nICAgaWYgKGNsc3MubGVuZ3RoICE9IDEpIHsNCiAgICAgICAgICAgIGlmICh0\ncmF2ZXJzZSkNCiAgICAgICAgICAgICAgICB0aHJvdyBSZWxhdGlvblN0cmF0\nZWdpZXMudW5qb2luYWJsZSh2YWwpOw0KICAgICAgICAgICAgcmV0dXJuIGpv\naW5zOw0KICAgICAgICB9DQogICAgICAgIGlmIChmb3JjZU91dGVyKQ0KICAg\nICAgICAgICAgcmV0dXJuIGpvaW5zLm91dGVySm9pblJlbGF0aW9uKGZpZWxk\nLmdldE5hbWUoKSwNCiAgICAgICAgICAgICAgICB2YWwuZ2V0Rm9yZWlnbktl\neShjbHNzWzBdKSwgY2xzc1swXSwgdmFsLmdldFNlbGVjdFN1YmNsYXNzZXMo\nKSwNCiAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UpOw0KICAgICAgICBy\nZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwNCiAg\nICAgICAgICAgIHZhbC5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLCBjbHNzWzBd\nLCB2YWwuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCANCiAgICAgICAgICAgIGZh\nbHNlLCBmYWxzZSk7DQogICAgfQ0KDQogICAgcHVibGljIEpvaW5zIGpvaW5L\nZXlSZWxhdGlvbihKb2lucyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyLA0K\nICAgICAgICBib29sZWFuIHRyYXZlcnNlKSB7DQogICAgICAgIGlmICh0cmF2\nZXJzZSkNCiAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLmFzc2VydEpv\naW5hYmxlKGZpZWxkLmdldEtleU1hcHBpbmcoKSk7DQogICAgICAgIHJldHVy\nbiBqb2luczsNCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0\nb3JlVmFsdWUoT2JqZWN0IHZhbCwgSkRCQ1N0b3JlIHN0b3JlKSB7DQogICAg\nICAgIHJldHVybiBSZWxhdGlvblN0cmF0ZWdpZXMudG9EYXRhU3RvcmVWYWx1\nZShmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLA0KICAgICAgICAgICAgdmFs\nLCBzdG9yZSk7DQogICAgfQ0KDQogICAgcHVibGljIE9iamVjdCB0b0tleURh\ndGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkgew0K\nICAgICAgICByZXR1cm4gSGFuZGxlclN0cmF0ZWdpZXMudG9EYXRhU3RvcmVW\nYWx1ZShmaWVsZC5nZXRLZXlNYXBwaW5nKCksIHZhbCwNCiAgICAgICAgICAg\nIF9rY29scywgc3RvcmUpOw0KICAgIH0NCn0NCg==\n","encoding":"base64"}

