{"sha":"d105060dd0197b49187204efa192ac67b30e4b5c","node_id":"MDQ6QmxvYjIwNjM2NDpkMTA1MDYwZGQwMTk3YjQ5MTg3MjA0ZWZhMTkyYWM2N2IzMGU0YjVj","size":6196,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d105060dd0197b49187204efa192ac67b30e4b5c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5EaXNjcmltaW5hdG9y\nTWFwcGluZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\nY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5S\nb3c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUm93TWFu\nYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxC\ndWZmZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2Vs\nZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBB\nU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRh\nLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1l\ndGFEYXRhRXhjZXB0aW9uOwoKLyoqCiAqIEJhc2UgZGlzY3JpbWluYXRvciBz\ndHJhdGVneSB0aGF0IGRldGVybWluZXMgdGhlIGNsYXNzIG9mIGRhdGFiYXNl\nCiAqIHJlY29yZHMgdXNpbmcgYSBjb2x1bW4gaG9sZGluZyBhIHZhbHVlIG1h\ncHBlZCB0byBhIGNsYXNzLCBhbmQgbGltaXRzCiAqIFNFTEVDVHMgdXNpbmcg\nYW4gSU4gKC4uLikgc3RhdGVtZW50LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0\nZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEluVmFsdWVEaXNjcmltaW5h\ndG9yU3RyYXRlZ3kKICAgIGV4dGVuZHMgQWJzdHJhY3REaXNjcmltaW5hdG9y\nU3RyYXRlZ3kgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXpl\nciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoSW5WYWx1\nZURpc2NyaW1pbmF0b3JTdHJhdGVneS5jbGFzcyk7CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIEphdmEgdHlwZSBjb2RlIGZyb20ge0BsaW5rIEphdmFU\neXBlc30gZm9yIHRoZSBkaXNjcmltaW5hdG9yCiAgICAgKiB2YWx1ZXMuIFRo\naXMgbWV0aG9kIGlzIG9ubHkgdXNlZCBkdXJpbmcgbWFwcGluZyBpbnN0YWxs\nYXRpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBpbnQgZ2V0\nSmF2YVR5cGUoKTsKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGlzY3Jp\nbWluYXRvciB2YWx1ZSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBhYnN0cmFjdCBPYmplY3QgZ2V0RGlzY3JpbWluYXRvclZh\nbHVlKENsYXNzTWFwcGluZyBjbHMpOwoKICAgIC8qKgogICAgICogQ29udmVy\ndCB0aGUgZ2l2ZW4gZGlzY3JpbWluYXRvciB2YWx1ZSB0byB0aGUgY29ycmVz\ncG9uZGluZyBjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0\nIENsYXNzIGdldENsYXNzKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkK\nICAgICAgICB0aHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbjsKCiAgICBw\ndWJsaWMgdm9pZCBtYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIENsYXNz\nTWFwcGluZyBjbHMgPSBkaXNjLmdldENsYXNzTWFwcGluZygpOwogICAgICAg\nIGlmIChjbHMuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0g\nbnVsbAogICAgICAgICAgICB8fCBjbHMuZ2V0RW1iZWRkaW5nTWV0YURhdGEo\nKSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1iYXNlLWRpc2MiLCBjbHMpKTsKCiAgICAg\nICAgRGlzY3JpbWluYXRvck1hcHBpbmdJbmZvIGluZm8gPSBkaXNjLmdldE1h\ncHBpbmdJbmZvKCk7CiAgICAgICAgaW5mby5hc3NlcnROb0pvaW4oZGlzYywg\ndHJ1ZSk7CiAgICAgICAgaW5mby5hc3NlcnROb0ZvcmVpZ25LZXkoZGlzYywg\nIWFkYXB0KTsKICAgICAgICBpbmZvLmFzc2VydE5vVW5pcXVlKGRpc2MsIGZh\nbHNlKTsKCiAgICAgICAgQ29sdW1uIHRtcGxhdGUgPSBuZXcgQ29sdW1uKCk7\nCiAgICAgICAgdG1wbGF0ZS5zZXRKYXZhVHlwZShnZXRKYXZhVHlwZSgpKTsK\nICAgICAgICB0bXBsYXRlLnNldE5hbWUoInR5cCIpOwoKICAgICAgICBDb2x1\nbW5bXSBjb2xzID0gaW5mby5nZXRDb2x1bW5zKGRpc2MsIG5ldyBDb2x1bW5b\nXXsgdG1wbGF0ZSB9LCBhZGFwdCk7CiAgICAgICAgZGlzYy5zZXRDb2x1bW5z\nKGNvbHMpOwogICAgICAgIGRpc2Muc2V0Q29sdW1uSU8oaW5mby5nZXRDb2x1\nbW5JTygpKTsKCiAgICAgICAgSW5kZXggaWR4ID0gaW5mby5nZXRJbmRleChk\naXNjLCBjb2xzLCBhZGFwdCk7CiAgICAgICAgZGlzYy5zZXRJbmRleChpZHgp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluc2VydChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIFJvd01hbmFnZXIgcm0pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUm93IHJvdyA9\nIHJtLmdldFJvdyhkaXNjLmdldENsYXNzTWFwcGluZygpLmdldFRhYmxlKCks\nCiAgICAgICAgICAgIFJvdy5BQ1RJT05fSU5TRVJULCBzbSwgdHJ1ZSk7CiAg\nICAgICAgT2JqZWN0IGNscyA9IGdldERpc2NyaW1pbmF0b3JWYWx1ZSgoQ2xh\nc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpKTsKICAgICAgICBpZiAoZGlz\nYy5nZXRDb2x1bW5JTygpLmlzSW5zZXJ0YWJsZSgwLCBjbHMgPT0gbnVsbCkp\nCiAgICAgICAgICAgIHJvdy5zZXRPYmplY3QoZGlzYy5nZXRDb2x1bW5zKClb\nMF0sIGNscyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2VsZWN0KFNl\nbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAgaWYg\nKGlzRmluYWwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBz\nZWwuc2VsZWN0KGRpc2MuZ2V0Q29sdW1ucygpKTsKICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0Q2xhc3MoSkRCQ1N0\nb3JlIHN0b3JlLCBDbGFzc01hcHBpbmcgYmFzZSwgUmVzdWx0IHJlcykKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uLCBDbGFzc05vdEZvdW5kRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoaXNGaW5hbCB8fCAhcmVzLmNvbnRhaW5zKGRp\nc2MuZ2V0Q29sdW1ucygpWzBdKQogICAgICAgICAgICB8fCAoYmFzZS5nZXRQ\nQ1N1cGVyY2xhc3MoKSA9PSBudWxsCiAgICAgICAgICAgICYmIGJhc2UuZ2V0\nSm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKS5sZW5ndGggPT0gMCkpCiAg\nICAgICAgICAgIHJldHVybiBiYXNlLmdldERlc2NyaWJlZFR5cGUoKTsKCiAg\nICAgICAgT2JqZWN0IGNscyA9CiAgICAgICAgICAgICAgICByZXMuZ2V0T2Jq\nZWN0KGRpc2MuZ2V0Q29sdW1ucygpWzBdLCBkaXNjLmdldEphdmFUeXBlKCks\nIG51bGwpOwogICAgICAgIHJldHVybiBnZXRDbGFzcyhjbHMsIHN0b3JlKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNDbGFzc0NvbmRpdGlvbnMo\nQ2xhc3NNYXBwaW5nIGJhc2UsIGJvb2xlYW4gc3ViY2xhc3NlcykgewogICAg\nICAgIC8vIGlmIHNlbGVjdGluZyB0aGUgZmlyc3QgbWFwcGVkIGNsYXNzIGFu\nZCBhbGwgc3ViY2xhc3Nlcywgbm8gbmVlZAogICAgICAgIC8vIHRvIGxpbWl0\nIHRoZSBxdWVyeQogICAgICAgIGlmIChpc0ZpbmFsIHx8IChiYXNlLmdldEpv\naW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpID09IG51bGwKICAgICAgICAg\nICAgJiYgc3ViY2xhc3NlcykpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgLy8gaWYgbm8gc3ViY2xhc3NlcyBvciBzdXBlcmNsYXNzLCBu\nbyBuZWVkIGZvciBjb25kaXRpb25zCiAgICAgICAgQ2xhc3NNYXBwaW5nW10g\nc3VicyA9IGJhc2UuZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsK\nICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT0gMCAmJiBiYXNlLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgcHVibGljIFNRTEJ1ZmZlciBnZXRDbGFzc0NvbmRpdGlvbnMoU2VsZWN0\nIHNlbCwgSm9pbnMgam9pbnMsIAogICAgICAgIENsYXNzTWFwcGluZyBiYXNl\nLCBib29sZWFuIHN1YmNsYXNzZXMpIHsKICAgICAgICBDb2x1bW4gY29sID0g\nZGlzYy5nZXRDb2x1bW5zKClbMF07CiAgICAgICAgU1FMQnVmZmVyIHNxbCA9\nIG5ldyBTUUxCdWZmZXIoc2VsLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAg\nICAgICAgZ2V0REJEaWN0aW9uYXJ5SW5zdGFuY2UoKSk7CiAgICAgICAgYm9v\nbGVhbiBvdXRlciA9IGpvaW5zICE9IG51bGwgJiYgam9pbnMuaXNPdXRlcigp\nOwogICAgICAgIGlmIChvdXRlcikKICAgICAgICAgICAgc3FsLmFwcGVuZCgi\nKCIpOwogICAgICAgIFN0cmluZyBhbGlhcyA9IHNlbC5nZXRDb2x1bW5BbGlh\ncyhjb2wsIGpvaW5zKTsKICAgICAgICBzcWwuYXBwZW5kKGFsaWFzKTsKCiAg\nICAgICAgLy8gaWYgbm90IHNlbGVjdGluZyBzdWJjbGFzc2VzLCBsaW1pdCB0\nbyBqdXN0IHRoZSBnaXZlbiBjbGFzcwogICAgICAgIENsYXNzTWFwcGluZ1td\nIHN1YnMgPSBiYXNlLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7\nCiAgICAgICAgaWYgKCFvdXRlciAmJiAoIXN1YmNsYXNzZXMgfHwgc3Vicy5s\nZW5ndGggPT0gMCkpCiAgICAgICAgICAgIHJldHVybiBzcWwuYXBwZW5kKCIg\nPSAiKS5hcHBlbmRWYWx1ZShnZXREaXNjcmltaW5hdG9yVmFsdWUoYmFzZSks\nCiAgICAgICAgICAgICAgICBjb2wpOwoKICAgICAgICBpZiAob3V0ZXIpCiAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIiBJUyAiKS5hcHBlbmRWYWx1ZShudWxs\nKS5hcHBlbmQoIiBPUiAiKS5hcHBlbmQoYWxpYXMpOwogICAgICAgIHNxbC5h\ncHBlbmQoIiBJTiAoIik7CiAgICAgICAgc3FsLmFwcGVuZFZhbHVlKGdldERp\nc2NyaW1pbmF0b3JWYWx1ZShiYXNlKSwgY29sKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHN1YnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHNx\nbC5hcHBlbmQoIiwgIikuYXBwZW5kVmFsdWUoZ2V0RGlzY3JpbWluYXRvclZh\nbHVlKHN1YnNbaV0pLCBjb2wpOwogICAgICAgIHNxbC5hcHBlbmQoIikiKTsK\nICAgICAgICBpZiAob3V0ZXIpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiki\nKTsKICAgICAgICByZXR1cm4gc3FsOwogICAgfQp9Cg==\n","encoding":"base64"}

