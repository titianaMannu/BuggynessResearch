{"sha":"67dcc15753be22610c54bf6ed162ac8b3a1f691a","node_id":"MDQ6QmxvYjIwNjM2NDo2N2RjYzE1NzUzYmUyMjYxMGM1NGJmNmVkMTYyYWM4YjNhMWY2OTFh","size":16127,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/67dcc15753be22610c54bf6ed162ac8b3a1f691a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwu\nSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51\ndGlsLk5vU3VjaEVsZW1lbnRFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0\nb3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFz\nc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hl\nbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLkpvaW5zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJl\nc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5TUUxC\ndWZmZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FM\nRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNx\nbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwu\nVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5K\nUEFTdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuQ2xvc2VhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkFic3RyYWN0TFJTUHJveHlNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogTGFy\nZ2UgcmVzdWx0IHNldCBtYXAuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpjbGFzcyBMUlNQcm94eU1hcAogICAgZXh0ZW5kcyBBYnN0cmFjdExSU1By\nb3h5TWFwIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKExSU1Byb3h5\nTWFwLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIExSU01hcEZpZWxkU3Ry\nYXRlZ3kgX3N0cmF0OwoKICAgIHB1YmxpYyBMUlNQcm94eU1hcChMUlNNYXBG\naWVsZFN0cmF0ZWd5IHN0cmF0KSB7CiAgICAgICAgc3VwZXIoc3RyYXQuZ2V0\nRmllbGRNYXBwaW5nKCkuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAg\nICAgICAgICAgIHN0cmF0LmdldEZpZWxkTWFwcGluZygpLmdldEVsZW1lbnQo\nKS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgX3N0cmF0ID0gc3RyYXQ7\nCiAgICB9CgogICAgcHJvdGVjdGVkIHN5bmNocm9uaXplZCBpbnQgY291bnQo\nKSB7CiAgICAgICAgYm9vbGVhbiBkZXJpdmVkVmFsID0gX3N0cmF0LmdldEZp\nZWxkTWFwcGluZygpLmdldEVsZW1lbnQoKS4KICAgICAgICAgICAgZ2V0VmFs\ndWVNYXBwZWRCeSgpICE9IG51bGw7CiAgICAgICAgZmluYWwgQ2xhc3NNYXBw\naW5nW10gY2xzcyA9IChkZXJpdmVkVmFsKQogICAgICAgICAgICA/IF9zdHJh\ndC5nZXRJbmRlcGVuZGVudEtleU1hcHBpbmdzKGZhbHNlKQogICAgICAgICAg\nICA6IF9zdHJhdC5nZXRJbmRlcGVuZGVudFZhbHVlTWFwcGluZ3MoZmFsc2Up\nOwogICAgICAgIGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBhc3Nl\ncnRPd25lcigpOwogICAgICAgIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSA9IGdl\ndFN0b3JlKCk7CiAgICAgICAgVW5pb24gdW5pb24gPSBzdG9yZS5nZXRTUUxG\nYWN0b3J5KCkubmV3VW5pb24KICAgICAgICAgICAgKE1hdGgubWF4KDEsIGNs\nc3MubGVuZ3RoKSk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5T\nZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNl\nbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBjbHMgPSAoY2xzcy5sZW5ndGggPT0gMCkgPyBudWxsIDogY2xzc1tp\nZHhdOwogICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWlnbktleShfc3Ry\nYXQuZ2V0Sm9pbkZvcmVpZ25LZXkoY2xzKSwKICAgICAgICAgICAgICAgICAg\nICBzbS5nZXRPYmplY3RJZCgpLCBfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCku\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVmaW5pbmdNYXBwaW5nKCksIHN0\nb3JlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gdW5pb24uZ2V0Q291bnQoc3RvcmUpOwog\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBzdG9yZS5nZXRE\nQkRpY3Rpb25hcnkoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3Rl\nZCBib29sZWFuIGhhc0tleShPYmplY3Qga2V5KSB7CiAgICAgICAgcmV0dXJu\nIGhhcyhrZXksIHRydWUpOwogICAgfQoKICAgIHByb3RlY3RlZCBib29sZWFu\nIGhhc1ZhbHVlKE9iamVjdCB2YWx1ZSkgewogICAgICAgIHJldHVybiBoYXMo\ndmFsdWUsIGZhbHNlKTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaGFz\nKGZpbmFsIE9iamVjdCBvYmosIGZpbmFsIGJvb2xlYW4ga2V5KSB7CiAgICAg\nICAgZmluYWwgYm9vbGVhbiBkZXJpdmVkS2V5ID0ga2V5ICYmIF9zdHJhdC5n\nZXRGaWVsZE1hcHBpbmcoKS4KICAgICAgICAgICAgZ2V0S2V5KCkuZ2V0VmFs\ndWVNYXBwZWRCeSgpICE9IG51bGw7CiAgICAgICAgZmluYWwgYm9vbGVhbiBk\nZXJpdmVkVmFsID0gIWtleSAmJiBfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCku\nCiAgICAgICAgICAgIGdldEVsZW1lbnQoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkg\nIT0gbnVsbDsKCiAgICAgICAgZmluYWwgQ2xhc3NNYXBwaW5nW10gY2xzcyA9\nICgoa2V5ICYmICFkZXJpdmVkS2V5KSB8fCBkZXJpdmVkVmFsKQogICAgICAg\nICAgICA/IF9zdHJhdC5nZXRJbmRlcGVuZGVudEtleU1hcHBpbmdzKGRlcml2\nZWRWYWwpCiAgICAgICAgICAgIDogX3N0cmF0LmdldEluZGVwZW5kZW50VmFs\ndWVNYXBwaW5ncyhkZXJpdmVkS2V5KTsKICAgICAgICBmaW5hbCBPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtID0gYXNzZXJ0T3duZXIoKTsKICAgICAgICBmaW5h\nbCBKREJDU3RvcmUgc3RvcmUgPSBnZXRTdG9yZSgpOwoKICAgICAgICBVbmlv\nbiB1bmlvbiA9IHN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdVbmlvbgogICAg\nICAgICAgICAoTWF0aC5tYXgoMSwgY2xzcy5sZW5ndGgpKTsKICAgICAgICB1\nbmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGlkeCkgewog\nICAgICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGNscyA9IChjbHNzLmxlbmd0\naCA9PSAwKSA/IG51bGwgOiBjbHNzW2lkeF07CiAgICAgICAgICAgICAgICBz\nZWwud2hlcmVGb3JlaWduS2V5KF9zdHJhdC5nZXRKb2luRm9yZWlnbktleShj\nbHMpLAogICAgICAgICAgICAgICAgICAgIHNtLmdldE9iamVjdElkKCksIF9z\ndHJhdC5nZXRGaWVsZE1hcHBpbmcoKS4KICAgICAgICAgICAgICAgICAgICBn\nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUpOwoKICAgICAgICAgICAgICAg\nIEpvaW5zIGpvaW5zID0gbnVsbDsKICAgICAgICAgICAgICAgIENvbHVtbltd\nIGNvbHM7CiAgICAgICAgICAgICAgICBPYmplY3QgdmFsOwogICAgICAgICAg\nICAgICAgaWYgKGtleSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkZXJp\ndmVkS2V5KQogICAgICAgICAgICAgICAgICAgICAgICBqb2lucyA9IF9zdHJh\ndC5qb2luVmFsdWVSZWxhdGlvbihzZWwubmV3Sm9pbnMoKSwgY2xzKTsKICAg\nICAgICAgICAgICAgICAgICB2YWwgPSBfc3RyYXQudG9LZXlEYXRhU3RvcmVW\nYWx1ZShvYmosIHN0b3JlKTsKICAgICAgICAgICAgICAgICAgICBjb2xzID0g\nX3N0cmF0LmdldEtleUNvbHVtbnMoY2xzKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlcml2ZWRWYWwpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGpvaW5zID0gX3N0cmF0LmpvaW5LZXlS\nZWxhdGlvbihzZWwubmV3Sm9pbnMoKSwgY2xzKTsKICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBfc3RyYXQudG9EYXRhU3RvcmVWYWx1ZShvYmosIHN0b3Jl\nKTsKICAgICAgICAgICAgICAgICAgICBjb2xzID0gX3N0cmF0LmdldFZhbHVl\nQ29sdW1ucyhjbHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgT2JqZWN0W10gdmFscyA9IChjb2xzLmxlbmd0aCA9PSAxKSA/IG51bGwg\nOiAoT2JqZWN0W10pIHZhbDsKICAgICAgICAgICAgICAgIFNRTEJ1ZmZlciBz\ncWwgPSBuZXcgU1FMQnVmZmVyKHN0b3JlLmdldERCRGljdGlvbmFyeSgpKTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiIEFORCAiKTsKCiAg\nICAgICAgICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxp\nYXMoY29sc1tpXSwgam9pbnMpKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\ndmFscyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBzcWwuYXBw\nZW5kKCh2YWwgPT0gbnVsbCkgPyAiIElTICIgOiAiID0gIikuCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBhcHBlbmRWYWx1ZSh2YWwsIGNvbHNbaV0p\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgc3FsLmFwcGVuZCgodmFsc1tpXSA9PSBudWxsKSA/ICIgSVMgIiA6\nICIgPSAiKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFZh\nbHVlKHZhbHNbaV0sIGNvbHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgc2VsLndoZXJlKHNxbCwgam9pbnMpOwogICAgICAgICAg\nICB9CiAgICAgICAgfSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiB1bmlvbi5nZXRDb3VudChzdG9yZSkgPiAwOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBzdG9yZS5nZXREQkRpY3Rpb25hcnko\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBDb2xsZWN0aW9u\nIGtleXMoZmluYWwgT2JqZWN0IG9iaikgewogICAgICAgIGZpbmFsIE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20gPSBhc3NlcnRPd25lcigpOwogICAgICAgIGZp\nbmFsIEpEQkNTdG9yZSBzdG9yZSA9IGdldFN0b3JlKCk7CiAgICAgICAgaWYg\nKF9zdHJhdC5nZXRGaWVsZE1hcHBpbmcoKS5nZXRLZXkoKS5nZXRWYWx1ZU1h\ncHBlZEJ5KCkgIT0gbnVsbCkgewogICAgICAgICAgICBPYmplY3Qga2V5ID0g\nX3N0cmF0LmRlcml2ZUtleShzdG9yZSwgb2JqKTsKICAgICAgICAgICAgaWYg\nKGhhc0tleShrZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rp\nb25zLnNpbmdsZXRvbihrZXkpOwogICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuRU1QVFlfTElTVDsKICAgICAgICB9CgogICAgICAgIGZpbmFsIENs\nYXNzTWFwcGluZ1tdIGNsc3MgPSBfc3RyYXQuZ2V0SW5kZXBlbmRlbnRLZXlN\nYXBwaW5ncyh0cnVlKTsKICAgICAgICBmaW5hbCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoID0gc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgZmluYWwgSm9pbnNbXSByZXNKb2lucyA9IG5ldyBKb2luc1tN\nYXRoLm1heCgxLCBjbHNzLmxlbmd0aCldOwoKICAgICAgICBVbmlvbiB1bmlv\nbiA9IHN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdVbmlvbgogICAgICAgICAg\nICAoTWF0aC5tYXgoMSwgY2xzcy5sZW5ndGgpKTsKICAgICAgICBpZiAoZmV0\nY2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUoX3N0cmF0LmdldEZpZWxkTWFwcGlu\nZygpLgogICAgICAgICAgICBnZXRLZXlNYXBwaW5nKCkuZ2V0VHlwZU1hcHBp\nbmcoKSkgIT0gZmV0Y2guRUFHRVJfSk9JTikKICAgICAgICAgICAgdW5pb24u\nYWJvcnRVbmlvbigpOwogICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24u\nU2VsZWN0b3IoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChT\nZWxlY3Qgc2VsLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICBDbGFzc01h\ncHBpbmcgY2xzID0gKGNsc3MubGVuZ3RoID09IDApID8gbnVsbCA6IGNsc3Nb\naWR4XTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZUZvcmVpZ25LZXkoX3N0\ncmF0LmdldEpvaW5Gb3JlaWduS2V5KGNscyksCiAgICAgICAgICAgICAgICAg\nICAgc20uZ2V0T2JqZWN0SWQoKSwgX3N0cmF0LmdldEZpZWxkTWFwcGluZygp\nLgogICAgICAgICAgICAgICAgICAgIGdldERlZmluaW5nTWFwcGluZygpLCBz\ndG9yZSk7CiAgICAgICAgICAgICAgICBpZiAoX3N0cmF0LmdldEZpZWxkTWFw\ncGluZygpLmdldEVsZW1lbnQoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkKICAgICAg\nICAgICAgICAgICAgICAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJl\nc0pvaW5zW2lkeF0gPSBfc3RyYXQuam9pbktleVJlbGF0aW9uKHNlbC5uZXdK\nb2lucygpLAogICAgICAgICAgICAgICAgICAgICAgICBjbHMpOwoKICAgICAg\nICAgICAgICAgIE9iamVjdCB2YWwgPSBfc3RyYXQudG9EYXRhU3RvcmVWYWx1\nZShvYmosIHN0b3JlKTsKICAgICAgICAgICAgICAgIENvbHVtbltdIGNvbHMg\nPSBfc3RyYXQuZ2V0VmFsdWVDb2x1bW5zKGNscyk7CiAgICAgICAgICAgICAg\nICBPYmplY3RbXSB2YWxzID0gKGNvbHMubGVuZ3RoID09IDEpID8gbnVsbCA6\nIChPYmplY3RbXSkgdmFsOwogICAgICAgICAgICAgICAgU1FMQnVmZmVyIHNx\nbCA9IG5ldyBTUUxCdWZmZXIoc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwKQogICAg\nICAgICAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIgQU5EICIpOwoKICAg\nICAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlh\ncyhjb2xzW2ldKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHMgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgodmFs\nID09IG51bGwpID8gIiBJUyAiIDogIiA9ICIpLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYXBwZW5kVmFsdWUodmFsLCBjb2xzW2ldKTsKICAgICAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHNx\nbC5hcHBlbmQoKHZhbHNbaV0gPT0gbnVsbCkgPyAiIElTICIgOiAiID0gIiku\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRWYWx1ZSh2YWxz\nW2ldLCBjb2xzW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHNlbC53aGVyZShzcWwpOwoKICAgICAgICAgICAgICAgIGlmIChyZXNK\nb2luc1tpZHhdID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmVzSm9p\nbnNbaWR4XSA9IF9zdHJhdC5qb2luS2V5UmVsYXRpb24oc2VsLm5ld0pvaW5z\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGNscyk7CiAgICAgICAgICAg\nICAgICBfc3RyYXQuc2VsZWN0S2V5KHNlbCwgY2xzLCBzbSwgc3RvcmUsIGZl\ndGNoLCByZXNKb2luc1tpZHhdKTsKICAgICAgICAgICAgfQogICAgICAgIH0p\nOwoKICAgICAgICBSZXN1bHQgcmVzID0gbnVsbDsKICAgICAgICBDb2xsZWN0\naW9uIGtleXMgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHJlcyA9IHVuaW9uLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsK\nICAgICAgICAgICAgd2hpbGUgKHJlcy5uZXh0KCkpCiAgICAgICAgICAgICAg\nICBrZXlzLmFkZChfc3RyYXQubG9hZEtleShzbSwgc3RvcmUsIGZldGNoLCBy\nZXMsCiAgICAgICAgICAgICAgICAgICAgcmVzSm9pbnNbcmVzLmluZGV4T2Yo\nKV0pKTsKICAgICAgICAgICAgcmV0dXJuIGtleXM7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIHN0b3JlLmdldERCRGljdGlvbmFyeSgp\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocmVzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJvdGVjdGVkIE9iamVjdCB2YWx1ZShmaW5hbCBPYmpl\nY3Qgb2JqKSB7CiAgICAgICAgZmluYWwgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSA9IGFzc2VydE93bmVyKCk7CiAgICAgICAgZmluYWwgSkRCQ1N0b3JlIHN0\nb3JlID0gZ2V0U3RvcmUoKTsKICAgICAgICBpZiAoX3N0cmF0LmdldEZpZWxk\nTWFwcGluZygpLmdldEVsZW1lbnQoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0g\nbnVsbCkgewogICAgICAgICAgICBPYmplY3QgdmFsID0gX3N0cmF0LmRlcml2\nZVZhbHVlKHN0b3JlLCBvYmopOwogICAgICAgICAgICBpZiAoaGFzVmFsdWUo\ndmFsKSkKICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgZmluYWwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IHN0b3JlLmdldEZldGNoQ29uZmln\ndXJhdGlvbigpOwogICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIGNsc3Mg\nPSBfc3RyYXQuZ2V0SW5kZXBlbmRlbnRWYWx1ZU1hcHBpbmdzKHRydWUpOwog\nICAgICAgIGZpbmFsIEpvaW5zW10gcmVzSm9pbnMgPSBuZXcgSm9pbnNbTWF0\naC5tYXgoMSwgY2xzcy5sZW5ndGgpXTsKICAgICAgICBVbmlvbiB1bmlvbiA9\nIHN0b3JlLmdldFNRTEZhY3RvcnkoKS5uZXdVbmlvbihNYXRoLm1heCgxLCBj\nbHNzLmxlbmd0aCkpOwogICAgICAgIHVuaW9uLnNldEV4cGVjdGVkUmVzdWx0\nQ291bnQoMSwgZmFsc2UpOwogICAgICAgIGlmIChmZXRjaC5nZXRTdWJjbGFz\nc0ZldGNoTW9kZShfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCkuCiAgICAgICAg\nICAgIGdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKSkKICAg\nICAgICAgICAgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lO\nKQogICAgICAgICAgICB1bmlvbi5hYm9ydFVuaW9uKCk7CiAgICAgICAgdW5p\nb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3RvcigpIHsKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIGludCBpZHgpIHsKICAg\nICAgICAgICAgICAgIENsYXNzTWFwcGluZyBjbHMgPSAoY2xzcy5sZW5ndGgg\nPT0gMCkgPyBudWxsIDogY2xzc1tpZHhdOwogICAgICAgICAgICAgICAgc2Vs\nLndoZXJlRm9yZWlnbktleShfc3RyYXQuZ2V0Sm9pbkZvcmVpZ25LZXkoY2xz\nKSwKICAgICAgICAgICAgICAgICAgICBzbS5nZXRPYmplY3RJZCgpLCBfc3Ry\nYXQuZ2V0RmllbGRNYXBwaW5nKCkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGVmaW5pbmdNYXBwaW5nKCksIHN0b3JlKTsKICAgICAgICAgICAgICAgIGlm\nIChfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0S2V5KCkuZ2V0VmFsdWVN\nYXBwZWRCeSgpCiAgICAgICAgICAgICAgICAgICAgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICByZXNKb2luc1tpZHhdID0gX3N0cmF0LmpvaW5WYWx1\nZVJlbGF0aW9uKHNlbC5uZXdKb2lucygpLAogICAgICAgICAgICAgICAgICAg\nICAgICBjbHMpOwoKICAgICAgICAgICAgICAgIE9iamVjdCBrZXkgPSBfc3Ry\nYXQudG9LZXlEYXRhU3RvcmVWYWx1ZShvYmosIHN0b3JlKTsKICAgICAgICAg\nICAgICAgIENvbHVtbltdIGNvbHMgPSBfc3RyYXQuZ2V0S2V5Q29sdW1ucyhj\nbHMpOwogICAgICAgICAgICAgICAgT2JqZWN0W10gdmFscyA9IChjb2xzLmxl\nbmd0aCA9PSAxKSA/IG51bGwgOiAoT2JqZWN0W10pIGtleTsKICAgICAgICAg\nICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBuZXcgU1FMQnVmZmVyKHN0b3JlLmdl\ndERCRGljdGlvbmFyeSgpKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAg\nICAgIGlmIChpID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCgiIEFORCAiKTsKCiAgICAgICAgICAgICAgICAgICAgc3FsLmFwcGVu\nZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sc1tpXSwgcmVzSm9pbnNbaWR4XSkp\nOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWxzID09IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoKGtleSA9PSBudWxsKSA/\nICIgSVMgIiA6ICIgPSAiKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGFwcGVuZFZhbHVlKGtleSwgY29sc1tpXSk7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCh2\nYWxzW2ldID09IG51bGwpID8gIiBJUyAiIDogIiA9ICIpLgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYXBwZW5kVmFsdWUodmFsc1tpXSwgY29sc1tp\nXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWwud2hl\ncmUoc3FsLCByZXNKb2luc1tpZHhdKTsKCiAgICAgICAgICAgICAgICBpZiAo\ncmVzSm9pbnNbaWR4XSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJl\nc0pvaW5zW2lkeF0gPSBfc3RyYXQuam9pblZhbHVlUmVsYXRpb24oc2VsLm5l\nd0pvaW5zKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGNscyk7CiAgICAg\nICAgICAgICAgICBfc3RyYXQuc2VsZWN0VmFsdWUoc2VsLCBjbHMsIHNtLCBz\ndG9yZSwgZmV0Y2gsIHJlc0pvaW5zW2lkeF0pOwogICAgICAgICAgICB9CiAg\nICAgICAgfSk7CgogICAgICAgIFJlc3VsdCByZXMgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJlcyA9IHVuaW9uLmV4ZWN1dGUoc3RvcmUs\nIGZldGNoKTsKICAgICAgICAgICAgaWYgKHJlcy5uZXh0KCkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gX3N0cmF0LmxvYWRWYWx1ZShzbSwgc3RvcmUsIGZl\ndGNoLCByZXMsCiAgICAgICAgICAgICAgICAgICAgcmVzSm9pbnNbcmVzLmlu\nZGV4T2YoKV0pOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9\nIGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cg\nU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgc3RvcmUuZ2V0REJEaWN0aW9u\nYXJ5KCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChy\nZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJlcy5jbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgSXRlcmF0b3IgaXRyKCkgewog\nICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBhc3NlcnRPd25lcigp\nOwogICAgICAgIEpEQkNTdG9yZSBzdG9yZSA9IGdldFN0b3JlKCk7CiAgICAg\nICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIEpvaW5zW10gam9pbnMgPSBuZXcgSm9pbnNbMl07CiAgICAgICAgICAgIFJl\nc3VsdFtdIHJlcyA9IF9zdHJhdC5nZXRSZXN1bHRzKHNtLCBzdG9yZSwgZmV0\nY2gsIGZldGNoLkVBR0VSX0pPSU4sCiAgICAgICAgICAgICAgICBqb2lucywg\ndHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzdWx0SXRlcmF0b3Io\nc20sIHN0b3JlLCBmZXRjaCwgcmVzLCBqb2lucyk7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4\nY2VwdGlvbnMuZ2V0U3RvcmUoc2UsIHN0b3JlLmdldERCRGljdGlvbmFyeSgp\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIGFzc2VydE93bmVyKCkgewogICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20gPSBnZXRPd25lcigpOwogICAgICAgIGlmIChzbSA9PSBudWxs\nKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJscnMtbm8tb3duZXIiLAogICAgICAgICAgICAgICAgX3N0\ncmF0LmdldEZpZWxkTWFwcGluZygpKSk7CiAgICAgICAgcmV0dXJuIHNtOwog\nICAgfQoKICAgIHByaXZhdGUgSkRCQ1N0b3JlIGdldFN0b3JlKCkgewogICAg\nICAgIHJldHVybiAoSkRCQ1N0b3JlKSBnZXRPd25lcigpLmdldENvbnRleHQo\nKS5nZXRTdG9yZU1hbmFnZXIoKS4KICAgICAgICAgICAgZ2V0SW5uZXJtb3N0\nRGVsZWdhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlYWJsZSBp\ndGVyYXRvciBidWlsdCBhcm91bmQga2V5IGFuZCB2YWx1ZSBKREJDIHJlc3Vs\ndHMuCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3MgUmVzdWx0SXRlcmF0b3IK\nICAgICAgICBpbXBsZW1lbnRzIEl0ZXJhdG9yLCBDbG9zZWFibGUgewoKICAg\nICAgICBwcml2YXRlIGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgX3NtOwog\nICAgICAgIHByaXZhdGUgZmluYWwgSkRCQ1N0b3JlIF9zdG9yZTsKICAgICAg\nICBwcml2YXRlIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gX2ZldGNo\nOwogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0W10gX3JlczsKICAgICAg\nICBwcml2YXRlIGZpbmFsIEpvaW5zW10gX2pvaW5zOwogICAgICAgIHByaXZh\ndGUgQm9vbGVhbiBfbmV4dCA9IG51bGw7CgogICAgICAgIHB1YmxpYyBSZXN1\nbHRJdGVyYXRvcihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUg\nc3RvcmUsCiAgICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIFJlc3VsdFtdIHJlcywgSm9pbnNbXSBqb2lucykgewogICAgICAgICAg\nICBfc20gPSBzbTsKICAgICAgICAgICAgX3N0b3JlID0gc3RvcmU7CiAgICAg\nICAgICAgIF9mZXRjaCA9IGZldGNoOwogICAgICAgICAgICBfcmVzID0gcmVz\nOwogICAgICAgICAgICBfam9pbnMgPSBqb2luczsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgIGlm\nIChfbmV4dCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIF9uZXh0ID0gKF9yZXNbMF0ubmV4dCgpKSA/IEJv\nb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKF9uZXh0LmJvb2xlYW5WYWx1ZSgpICYmIF9yZXNbMV0gIT0gX3Jl\nc1swXSkKICAgICAgICAgICAgICAgICAgICAgICAgX3Jlc1sxXS5uZXh0KCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0\nb3JlKHNlLCBfc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfbmV4\ndC5ib29sZWFuVmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBP\nYmplY3QgbmV4dCgpIHsKICAgICAgICAgICAgaWYgKCFoYXNOZXh0KCkpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9TdWNoRWxlbWVudEV4Y2VwdGlv\nbigpOwogICAgICAgICAgICBfbmV4dCA9IG51bGw7CgogICAgICAgICAgICBi\nb29sZWFuIGtleURlcml2ZWQgPSBfc3RyYXQuZ2V0RmllbGRNYXBwaW5nKCku\nZ2V0S2V5KCkuCiAgICAgICAgICAgICAgICBnZXRWYWx1ZU1hcHBlZEJ5KCkg\nIT0gbnVsbDsKICAgICAgICAgICAgYm9vbGVhbiB2YWxEZXJpdmVkID0gX3N0\ncmF0LmdldEZpZWxkTWFwcGluZygpLmdldEVsZW1lbnQoKS4KICAgICAgICAg\nICAgICAgIGdldFZhbHVlTWFwcGVkQnkoKSAhPSBudWxsOwogICAgICAgICAg\nICBFbnRyeSBlbnRyeSA9IG5ldyBFbnRyeSgpOwogICAgICAgICAgICB0cnkg\newoKICAgICAgICAgICAgICAgIGlmICgha2V5RGVyaXZlZCkKICAgICAgICAg\nICAgICAgICAgICBlbnRyeS5rZXkgPSBfc3RyYXQubG9hZEtleShfc20sIF9z\ndG9yZSwgX2ZldGNoLCBfcmVzWzBdLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgX2pvaW5zWzBdKTsKICAgICAgICAgICAgICAgIGlmICghdmFsRGVyaXZl\nZCkKICAgICAgICAgICAgICAgICAgICBlbnRyeS52YWwgPSBfc3RyYXQubG9h\nZFZhbHVlKF9zbSwgX3N0b3JlLCBfZmV0Y2gsIF9yZXNbMV0sIAogICAgICAg\nICAgICAgICAgICAgICAgICBfam9pbnNbMV0pOwogICAgICAgICAgICAgICAg\naWYgKGtleURlcml2ZWQpCiAgICAgICAgICAgICAgICAgICAgZW50cnkua2V5\nID0gX3N0cmF0LmRlcml2ZUtleShfc3RvcmUsIGVudHJ5LnZhbCk7CiAgICAg\nICAgICAgICAgICBpZiAodmFsRGVyaXZlZCkKICAgICAgICAgICAgICAgICAg\nICBlbnRyeS52YWwgPSBfc3RyYXQuZGVyaXZlVmFsdWUoX3N0b3JlLCBlbnRy\neS5rZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGVudHJ5OwogICAgICAg\nICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAg\nICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9zdG9yZS5n\nZXREQkRpY3Rpb25hcnkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICAg\nICAgX25leHQgPSBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBfcmVzWzBd\nLmNsb3NlKCk7CiAgICAgICAgICAgIGlmIChfcmVzWzFdICE9IF9yZXNbMF0p\nCiAgICAgICAgICAgICAgICBfcmVzWzFdLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogTWFwLkVudHJ5IHN0cnVjdC4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRW50cnkKICAgICAgICBpbXBs\nZW1lbnRzIE1hcC5FbnRyeSB7CgogICAgICAgIHB1YmxpYyBPYmplY3Qga2V5\nOwogICAgICAgIHB1YmxpYyBPYmplY3QgdmFsOwoKICAgICAgICBwdWJsaWMg\nT2JqZWN0IGdldEtleSgpIHsKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0VmFsdWUoKSB7CiAg\nICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgT2JqZWN0IHNldFZhbHVlKE9iamVjdCB2YWwpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgfQp9Cgo=\n","encoding":"base64"}

