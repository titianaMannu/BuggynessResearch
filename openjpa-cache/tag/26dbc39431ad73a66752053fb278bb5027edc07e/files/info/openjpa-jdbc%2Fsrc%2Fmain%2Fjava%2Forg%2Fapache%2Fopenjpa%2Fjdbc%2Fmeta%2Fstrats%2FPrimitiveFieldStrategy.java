{"sha":"f2e8ec6f17b50616056d867e3c8a684c834f78d8","node_id":"MDQ6QmxvYjIwNjM2NDpmMmU4ZWM2ZjE3YjUwNjE2MDU2ZDg2N2UzYzhhNjg0YzgzNGY3OGQ4","size":14482,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f2e8ec6f17b50616056d867e3c8a684c834f78d8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRC\nQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5F\nbWJlZGRhYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5Kb2luYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuVmFsdWVNYXBwaW5nSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuQ29sdW1uSU87CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkpvaW5zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJlc3VsdDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5Sb3c7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zcWwuUm93TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLnNxbC5TUUxCdWZmZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWV0YURhdGFFeGNlcHRpb247\nCgovKioKICogRGlyZWN0IG1hcHBpbmcgZnJvbSBhIHByaW1pdGl2ZSB2YWx1\nZSB0byBhIGNvbHVtbi4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQHNp\nbmNlIDAuNC4wCiAqLwpwdWJsaWMgY2xhc3MgUHJpbWl0aXZlRmllbGRTdHJh\ndGVneQogICAgZXh0ZW5kcyBBYnN0cmFjdEZpZWxkU3RyYXRlZ3kKICAgIGlt\ncGxlbWVudHMgSm9pbmFibGUsIEVtYmVkZGFibGUgewoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE9iamVjdCBOVUxMID0gbmV3IE9iamVjdCgpOwoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UKICAgICAgICAoUHJpbWl0aXZlRmllbGRTdHJhdGVn\neS5jbGFzcyk7CgogICAgcHJpdmF0ZSBib29sZWFuIF9zdGF0ZUltYWdlID0g\nZmFsc2U7CgogICAgcHVibGljIHZvaWQgbWFwKGJvb2xlYW4gYWRhcHQpIHsK\nICAgICAgICBpZiAoZmllbGQuaXNTZXJpYWxpemVkKCkgfHwgIWZpZWxkLmdl\ndFR5cGUoKS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1wcmltaXRpdmUiLCBm\naWVsZCkpOwogICAgICAgIGFzc2VydE5vdE1hcHBlZEJ5KCk7CgogICAgICAg\nIC8vIG1hcCBqb2luIGtleSwgaWYgYW55CiAgICAgICAgZmllbGQubWFwSm9p\nbihhZGFwdCwgZmFsc2UpOwogICAgICAgIGZpZWxkLmdldEtleU1hcHBpbmco\nKS5nZXRWYWx1ZUluZm8oKS5hc3NlcnROb1NjaGVtYUNvbXBvbmVudHMKICAg\nICAgICAgICAgKGZpZWxkLmdldEtleSgpLCAhYWRhcHQpOwogICAgICAgIGZp\nZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCkuYXNzZXJ0\nTm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAgIChmaWVsZC5nZXRFbGVt\nZW50KCksICFhZGFwdCk7CgogICAgICAgIFZhbHVlTWFwcGluZ0luZm8gdmlu\nZm8gPSBmaWVsZC5nZXRWYWx1ZUluZm8oKTsKICAgICAgICB2aW5mby5hc3Nl\ncnROb0pvaW4oZmllbGQsIHRydWUpOwogICAgICAgIHZpbmZvLmFzc2VydE5v\nRm9yZWlnbktleShmaWVsZCwgIWFkYXB0KTsKCiAgICAgICAgLy8gZ2V0IHZh\nbHVlIGNvbHVtbnMKICAgICAgICBDb2x1bW4gdG1wQ29sID0gbmV3IENvbHVt\nbigpOwogICAgICAgIHRtcENvbC5zZXROYW1lKGZpZWxkLmdldE5hbWUoKSk7\nCiAgICAgICAgdG1wQ29sLnNldEphdmFUeXBlKGZpZWxkLmdldFR5cGVDb2Rl\nKCkpOwoKICAgICAgICBDb2x1bW5bXSBjb2xzID0gdmluZm8uZ2V0Q29sdW1u\ncyhmaWVsZCwgZmllbGQuZ2V0TmFtZSgpLAogICAgICAgICAgICBuZXcgQ29s\ndW1uW117IHRtcENvbCB9LCBmaWVsZC5nZXRUYWJsZSgpLCBhZGFwdCk7CiAg\nICAgICAgaWYgKGZpZWxkLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0\ncmF0ZWdpZXMuQVVUT0FTU0lHTikKICAgICAgICAgICAgY29sc1swXS5zZXRB\ndXRvQXNzaWduZWQodHJ1ZSk7CgogICAgICAgIGZpZWxkLnNldENvbHVtbnMo\nY29scyk7CiAgICAgICAgZmllbGQuc2V0Q29sdW1uSU8odmluZm8uZ2V0Q29s\ndW1uSU8oKSk7CiAgICAgICAgZmllbGQubWFwQ29uc3RyYWludHMoZmllbGQu\nZ2V0TmFtZSgpLCBhZGFwdCk7CgogICAgICAgIC8vIGFkZCBwcmltYXJ5IGtl\neSBjb2x1bW5zIHRvIHRhYmxlIHBrIGlmIGxvZ2ljYWwKICAgICAgICBmaWVs\nZC5tYXBQcmltYXJ5S2V5KGFkYXB0KTsKICAgICAgICBQcmltYXJ5S2V5IHBr\nID0gZmllbGQuZ2V0VGFibGUoKS5nZXRQcmltYXJ5S2V5KCk7CiAgICAgICAg\naWYgKGZpZWxkLmlzUHJpbWFyeUtleSgpICYmIHBrICE9IG51bGwgJiYgKGFk\nYXB0IHx8IHBrLmlzTG9naWNhbCgpKSkKICAgICAgICAgICAgcGsuYWRkQ29s\ndW1uKGNvbHNbMF0pOwoKICAgICAgICAvLyBzZXQgam9pbmFibGUKICAgICAg\nICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKS5zZXRKb2luYWJsZShmaWVs\nZC5nZXRDb2x1bW5zKClbMF0sIHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGluaXRpYWxpemUoKSB7CiAgICAgICAgLy8gcmVjb3JkIHdoZXRoZXIg\nd2UncmUgdXNpbmcgYSBzdGF0ZSBpbWFnZSBpbmRpY2F0b3IsIHdoaWNoIHJl\ncXVpcmVzCiAgICAgICAgLy8gdGhhdCB3ZSBkbyBzcGVjaWFsIG51bGwgY2hl\nY2tzIHdoZW4gbG9hZGluZyBwcmltaXRpdmVzCiAgICAgICAgX3N0YXRlSW1h\nZ2UgPSBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKS5nZXRWZXJzaW9uKCku\nZ2V0U3RyYXRlZ3koKS4KICAgICAgICAgICAgZ2V0QWxpYXMoKS5lcXVhbHMo\nU3RhdGVDb21wYXJpc29uVmVyc2lvblN0cmF0ZWd5LkFMSUFTKTsKICAgICAg\nICBpZiAoX3N0YXRlSW1hZ2UpCiAgICAgICAgICAgIGZpZWxkLnNldFVzZXNJ\nbXBsRGF0YShudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dN\nYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICghZmllbGQuZ2V0Q29sdW1uSU8oKS5pc0luc2VydGFibGUoMCwg\nZmFsc2UpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgUm93IHJvdyA9\nIGZpZWxkLmdldFJvdyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNUSU9OX0lOU0VS\nVCk7CiAgICAgICAgaWYgKHJvdyAhPSBudWxsKQogICAgICAgICAgICB1cGRh\ndGUoc20sIHJvdyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdXBkYXRlKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFu\nYWdlciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoIWZpZWxkLmdldENvbHVtbklPKCkuaXNVcGRhdGFibGUoMCwgZmFs\nc2UpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgUm93IHJvdyA9IGZp\nZWxkLmdldFJvdyhzbSwgc3RvcmUsIHJtLCBSb3cuQUNUSU9OX1VQREFURSk7\nCiAgICAgICAgaWYgKHJvdyAhPSBudWxsKQogICAgICAgICAgICB1cGRhdGUo\nc20sIHJvdyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9wZW5K\nUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdl\nciBybSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBm\naWVsZC5kZWxldGVSb3coc20sIHN0b3JlLCBybSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBvd25pbmcgZmllbGQgaW50\nbyB0aGUgZ2l2ZW4gcm93LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdXBk\nYXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFJvdyByb3cpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29sdW1uIGNvbCA9IGZp\nZWxkLmdldENvbHVtbnMoKVswXTsKICAgICAgICBzd2l0Y2ggKGZpZWxkLmdl\ndFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgICAgIHJvdy5zZXRCb29sZWFuKGNvbCwgc20u\nZmV0Y2hCb29sZWFuKGZpZWxkLmdldEluZGV4KCkpKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICAgICAgcm93LnNldEJ5dGUoY29sLCBzbS5mZXRjaEJ5dGUo\nZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAg\nICByb3cuc2V0Q2hhcihjb2wsIHNtLmZldGNoQ2hhcihmaWVsZC5nZXRJbmRl\neCgpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcm93LnNldERv\ndWJsZShjb2wsIHNtLmZldGNoRG91YmxlKGZpZWxkLmdldEluZGV4KCkpKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJvdy5zZXRGbG9hdChjb2ws\nIHNtLmZldGNoRmxvYXQoZmllbGQuZ2V0SW5kZXgoKSkpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgICAgIHJvdy5zZXRJbnQoY29sLCBzbS5mZXRjaEludChm\naWVsZC5nZXRJbmRleCgpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAg\nIHJvdy5zZXRMb25nKGNvbCwgc20uZmV0Y2hMb25nKGZpZWxkLmdldEluZGV4\nKCkpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJvdy5zZXRTaG9y\ndChjb2wsIHNtLmZldGNoU2hvcnQoZmllbGQuZ2V0SW5kZXgoKSkpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBzdXBwb3J0c1NlbGVjdChT\nZWxlY3Qgc2VsLCBpbnQgdHlwZSwgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBpZiAodHlwZSA9PSBTZWxlY3QuVFlQRV9K\nT0lOTEVTUyAmJiBzZWwuaXNTZWxlY3RlZChmaWVsZC5nZXRUYWJsZSgpKSkK\nICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9\nCgogICAgcHVibGljIGludCBzZWxlY3QoU2VsZWN0IHNlbCwgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlck1vZGUpIHsKICAg\nICAgICBzZWwuc2VsZWN0KGZpZWxkLmdldENvbHVtbnMoKVswXSwgZmllbGQu\nam9pbihzZWwpKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBsb2FkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNTdG9y\nZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIENvbHVtbiBjb2wgPSBmaWVsZC5nZXRDb2x1bW5zKClbMF07CiAg\nICAgICAgaWYgKCFyZXMuY29udGFpbnMoY29sKSkKICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICBpbnQgaWR4ID0gZmllbGQuZ2V0SW5kZXgoKTsKICAg\nICAgICBib29sZWFuIGNoZWNrTnVsbCA9IF9zdGF0ZUltYWdlICYmICFmaWVs\nZC5pc0pvaW5PdXRlcigpOwogICAgICAgIHN3aXRjaCAoZmllbGQuZ2V0VHlw\nZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFO\nOgogICAgICAgICAgICAgICAgc20uc3RvcmVCb29sZWFuKGlkeCwgcmVzLmdl\ndEJvb2xlYW4oY29sKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIHNt\nLnN0b3JlQnl0ZShpZHgsIHJlcy5nZXRCeXRlKGNvbCkpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6\nCiAgICAgICAgICAgICAgICBzbS5zdG9yZUNoYXIoaWR4LCByZXMuZ2V0Q2hh\ncihjb2wpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBzbS5zdG9y\nZURvdWJsZShpZHgsIHJlcy5nZXREb3VibGUoY29sKSk7CiAgICAgICAgICAg\nICAgICBjaGVja051bGwgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgICAgIHNtLnN0b3JlRmxvYXQoaWR4LCByZXMuZ2V0RmxvYXQoY29sKSk7\nCiAgICAgICAgICAgICAgICBjaGVja051bGwgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6\nCiAgICAgICAgICAgICAgICBzbS5zdG9yZUludChpZHgsIHJlcy5nZXRJbnQo\nY29sKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIHNtLnN0b3JlTG9u\nZyhpZHgsIHJlcy5nZXRMb25nKGNvbCkpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAg\nICAgICAgICAgc20uc3RvcmVTaG9ydChpZHgsIHJlcy5nZXRTaG9ydChjb2wp\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyB3ZSdyZSB1c2luZyBzdGF0ZSBp\nbWFnZSB2ZXJzaW9uaW5nLCBzbyByZWNvcmQgdGhhdCB0aGUgYWN0dWFsIGRi\nCiAgICAgICAgLy8gdmFsdWUgd2FzIG51bGwgc28gd2UgYWRkIHRoZSBjb3Jy\nZWN0IE9MIGNoZWNrIG9uIHVwZGF0ZQogICAgICAgIGlmIChjaGVja051bGwg\nJiYgcmVzLndhc051bGwoKSkKICAgICAgICAgICAgc20uc2V0SW1wbERhdGEo\nZmllbGQuZ2V0SW5kZXgoKSwgTlVMTCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgYXBwZW5kSXNOdWxsKFNRTEJ1ZmZlciBzcWwsIFNlbGVjdCBzZWwsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgam9pbnMgPSBqb2luKGpvaW5zLCBmYWxz\nZSk7CiAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoZmll\nbGQuZ2V0Q29sdW1ucygpWzBdLCBqb2lucykpLgogICAgICAgICAgICBhcHBl\nbmQoIiBJUyAiKS5hcHBlbmRWYWx1ZShudWxsLCBmaWVsZC5nZXRDb2x1bW5z\nKClbMF0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90TnVs\nbChTUUxCdWZmZXIgc3FsLCBTZWxlY3Qgc2VsLCBKb2lucyBqb2lucykgewog\nICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZmFsc2UpOwogICAgICAgIHNx\nbC5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGZpZWxkLmdldENvbHVtbnMo\nKVswXSwgam9pbnMpKS4KICAgICAgICAgICAgYXBwZW5kKCIgSVMgTk9UICIp\nLmFwcGVuZFZhbHVlKG51bGwsIGZpZWxkLmdldENvbHVtbnMoKVswXSk7CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIGpvaW4oSm9pbnMgam9pbnMsIGJvb2xl\nYW4gZm9yY2VPdXRlcikgewogICAgICAgIHJldHVybiBmaWVsZC5qb2luKGpv\naW5zLCBmb3JjZU91dGVyLCBmYWxzZSk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBsb2FkUHJvamVjdGlvbihKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgUmVzdWx0IHJlcywgSm9p\nbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIHJlcy5nZXRPYmplY3QoZmllbGQuZ2V0Q29sdW1ucygpWzBd\nLCBudWxsLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNW\nZXJzaW9uYWJsZSgpIHsKICAgICAgICBpZiAoZmllbGQuaXNKb2luT3V0ZXIo\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHN3aXRjaCAo\nZmllbGQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRF\nOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSwKICAgICAg\nICBPYmplY3QgcHJldlZhbHVlKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIFJvdyByb3cgPSBmaWVsZC5nZXRSb3coc20sIHN0b3Jl\nLCBybSwgUm93LkFDVElPTl9VUERBVEUpOwogICAgICAgIGlmIChyb3cgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBmb3IgcHJp\nbWl0aXZlcyBsb2FkZWQgYXMgZGVmYXVsdCB2YWxzLCBjaGVjayB0byBzZWUg\naWYgd2FzIG51bGwgaW4KICAgICAgICAvLyB0aGUgZGF0YWJhc2Ugd2hlbiBs\nb2FkZWQgPT0gcmVtb3ZlIHRoZSBpbXBsIGRhdGEgYXQgdGhlIHNhbWUgdGlt\nZQogICAgICAgIC8vIHRvIGJlIHN1cmUgd2UgZG9uJ3QgdGhpbmsgdGhlIHZh\nbHVlIGlzIG51bGwgYWZ0ZXIgdGhlIGNvbW1pdAogICAgICAgIENvbHVtbiBj\nb2wgPSBmaWVsZC5nZXRDb2x1bW5zKClbMF07CiAgICAgICAgaWYgKHNtLnNl\ndEltcGxEYXRhKGZpZWxkLmdldEluZGV4KCksIG51bGwpID09IE5VTEwpCiAg\nICAgICAgICAgIHJvdy53aGVyZU51bGwoY29sKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJvdy53aGVyZU9iamVjdChjb2wsIHByZXZWYWx1ZSk7CiAg\nICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBK\nb2luYWJsZSBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vCgogICAgcHVibGljIGludCBnZXRGaWVsZEluZGV4KCkgewog\nICAgICAgIHJldHVybiBmaWVsZC5nZXRJbmRleCgpOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZ2V0UHJpbWFyeUtleVZhbHVlKFJlc3VsdCByZXMsIENv\nbHVtbltdIGNvbHMsIEZvcmVpZ25LZXkgZmssCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBDb2x1bW4gY29sID0gY29sc1swXTsKICAgICAgICBp\nZiAoZmsgIT0gbnVsbCkKICAgICAgICAgICAgY29sID0gZmsuZ2V0Q29sdW1u\nKGNvbCk7CiAgICAgICAgcmV0dXJuIEphdmFUeXBlcy5jb252ZXJ0KHJlcy5n\nZXRPYmplY3QoY29sLCBudWxsLCBqb2lucyksCiAgICAgICAgICAgIGZpZWxk\nLmdldFR5cGVDb2RlKCkpOwogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5bXSBn\nZXRDb2x1bW5zKCkgewogICAgICAgIHJldHVybiBmaWVsZC5nZXRDb2x1bW5z\nKCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRKb2luVmFsdWUoT2Jq\nZWN0IGZpZWxkVmFsLCBDb2x1bW4gY29sLCBKREJDU3RvcmUgc3RvcmUpIHsK\nICAgICAgICByZXR1cm4gZmllbGRWYWw7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBnZXRKb2luVmFsdWUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQ29s\ndW1uIGNvbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBy\nZXR1cm4gc20uZmV0Y2goZmllbGQuZ2V0SW5kZXgoKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0QXV0b0Fzc2lnbmVkVmFsdWUoT3BlbkpQQVN0YXRl\nTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIENvbHVtbiBj\nb2wsIE9iamVjdCBhdXRvSW5jKSB7CiAgICAgICAgaW50IGlkeCA9IGZpZWxk\nLmdldEluZGV4KCk7CiAgICAgICAgc3dpdGNoIChmaWVsZC5nZXRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAg\nICAgICAgICAgICAgICBpZiAoYXV0b0luYyA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgIHNtLnN0b3JlQm9vbGVhbihpZHgsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGVsc2UgaWYgKGF1dG9JbmMgaW5zdGFuY2VvZiBCb29sZWFu\nKQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlQm9vbGVhbihpZHgsICgo\nQm9vbGVhbikgYXV0b0luYykuYm9vbGVhblZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlQm9vbGVh\nbihpZHgsICgoTnVtYmVyKSBhdXRvSW5jKS5pbnRWYWx1ZSgpICE9IDApOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJZVEU6CiAgICAgICAgICAgICAgICBpZiAoYXV0b0luYyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlQnl0ZShpZHgsIChieXRl\nKSAwKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICBzbS5zdG9yZUJ5dGUoaWR4LCAoKE51bWJlcikgYXV0b0luYykuYnl0ZVZh\nbHVlKCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBpZiAoYXV0b0lu\nYyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlQ2hhcihp\nZHgsIChjaGFyKSAwKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF1dG9J\nbmMgaW5zdGFuY2VvZiBDaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICAgICAg\nc20uc3RvcmVDaGFyKGlkeCwgKChDaGFyYWN0ZXIpIGF1dG9JbmMpLmNoYXJW\nYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF1dG9JbmMgaW5z\ndGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVD\naGFyKGlkeCwgKChTdHJpbmcpIGF1dG9JbmMpLmNoYXJBdCgwKSk7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc20uc3RvcmVD\naGFyKGlkeCwgKGNoYXIpICgoTnVtYmVyKSBhdXRvSW5jKS5pbnRWYWx1ZSgp\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBpZiAoYXV0b0luYyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlRG91YmxlKGlk\neCwgMEQpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNtLnN0b3JlRG91YmxlKGlkeCwgKChOdW1iZXIpIGF1dG9JbmMpLmRv\ndWJsZVZhbHVlKCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgaWYg\nKGF1dG9JbmMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzbS5zdG9y\nZUZsb2F0KGlkeCwgMEYpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgICAgIHNtLnN0b3JlRmxvYXQoaWR4LCAoKE51bWJlcikgYXV0\nb0luYykuZmxvYXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAg\nICBpZiAoYXV0b0luYyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNt\nLnN0b3JlSW50KGlkeCwgMCk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc20uc3RvcmVJbnQoaWR4LCAoKE51bWJlcikgYXV0\nb0luYykuaW50VmFsdWUoKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAg\nIGlmIChhdXRvSW5jID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgc20u\nc3RvcmVMb25nKGlkeCwgMEwpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHNtLnN0b3JlTG9uZyhpZHgsICgoTnVtYmVyKSBh\ndXRvSW5jKS5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nICAgICBpZiAoYXV0b0luYyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHNtLnN0b3JlU2hvcnQoaWR4LCAoc2hvcnQpIDApOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNtLnN0b3JlU2hvcnQoaWR4\nLCAoKE51bWJlcikgYXV0b0luYykuc2hvcnRWYWx1ZSgpKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBFbWJlZGRhYmxlIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBDb2x1bW5JTyBnZXRD\nb2x1bW5JTygpIHsKICAgICAgICByZXR1cm4gZmllbGQuZ2V0Q29sdW1uSU8o\nKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZ2V0UmVzdWx0QXJndW1l\nbnRzKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgdG9FbWJlZGRlZE9iamVjdFZhbHVlKE9iamVjdCB2YWwpIHsK\nICAgICAgICByZXR1cm4gdmFsOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3Qg\ndG9FbWJlZGRlZERhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9y\nZSBzdG9yZSkgewogICAgICAgIHJldHVybiB0b0RhdGFTdG9yZVZhbHVlKHZh\nbCwgc3RvcmUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWRFbWJlZGRl\nZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IHZh\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzbS5z\ndG9yZShmaWVsZC5nZXRJbmRleCgpLCB2YWwpOwogICAgfQp9Cg==\n","encoding":"base64"}

