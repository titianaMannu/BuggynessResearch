{"sha":"cc2c1eb5834beda96e35fb9a77cf0431b4710493","node_id":"MDQ6QmxvYjIwNjM2NDpjYzJjMWViNTgzNGJlZGE5NmUzNWZiOWE3N2NmMDQzMWI0NzEwNDkz","size":11436,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/cc2c1eb5834beda96e35fb9a77cf0431b4710493","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzOw0KDQppbXBvcnQgamF2YS5zcWwuKjsNCmltcG9ydCBq\nYXZhLnV0aWwuKjsNCg0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLio7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC4qOw0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLio7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC4qOw0KDQovKioNCiAqIDxwPk1hcHBpbmcgZm9yIGEgbWFwIHdob3Nl\nIGtleXMgYXJlIHJlbGF0aW9ucyB0byBvdGhlciBwZXJzaXN0ZW50IG9iamVj\ndHMNCiAqIGFuZCB3aG9zZSB2YWx1ZXMgYXJlIGNvbnRyb2xsZWQgYnkgYSB7\nQGxpbmsgVmFsdWVIYW5kbGVyfS48L3A+DQogKg0KICogQGF1dGhvciBBYmUg\nV2hpdGUNCiAqIEBzaW5jZSAwLjQuMCwgMS4xLjANCiAqLw0KcHVibGljIGNs\nYXNzIFJlbGF0aW9uSGFuZGxlck1hcFRhYmxlRmllbGRTdHJhdGVneQ0KICAg\nIGV4dGVuZHMgTWFwVGFibGVGaWVsZFN0cmF0ZWd5IHsNCg0KICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZv\nclBhY2thZ2UNCiAgICAgICAgKFJlbGF0aW9uSGFuZGxlck1hcFRhYmxlRmll\nbGRTdHJhdGVneS5jbGFzcyk7DQoNCiAgICBwcml2YXRlIENvbHVtbltdIF92\nY29scyA9IG51bGw7DQogICAgcHJpdmF0ZSBDb2x1bW5JTyBfdmlvID0gbnVs\nbDsNCiAgICBwcml2YXRlIGJvb2xlYW4gX3Zsb2FkID0gZmFsc2U7DQoNCiAg\nICBwdWJsaWMgQ29sdW1uW10gZ2V0S2V5Q29sdW1ucyhDbGFzc01hcHBpbmcg\nY2xzKSB7DQogICAgICAgIHJldHVybiBmaWVsZC5nZXRLZXlNYXBwaW5nKCku\nZ2V0Q29sdW1ucygpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBDb2x1bW5bXSBn\nZXRWYWx1ZUNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNscykgew0KICAgICAgICBy\nZXR1cm4gX3Zjb2xzOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNlbGVj\ndEtleShTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcga2V5LCBPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLA0KICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEpvaW5zIGpvaW5zKSB7DQogICAg\nICAgIHNlbC5zZWxlY3Qoa2V5LCBmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0\nU2VsZWN0U3ViY2xhc3NlcygpLA0KICAgICAgICAgICAgc3RvcmUsIGZldGNo\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX05PTkUsIGpvaW5zKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RWYWx1ZShTZWxlY3Qg\nc2VsLCBDbGFzc01hcHBpbmcgdmFsLA0KICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIA0KICAgICAgICBKb2lucyBqb2lucykgew0KICAgICAg\nICBzZWwuc2VsZWN0KF92Y29scywgam9pbnMpOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBSZXN1bHRbXSBnZXRSZXN1bHRzKGZpbmFsIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sDQogICAgICAgIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSwgZmlu\nYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwNCiAgICAgICAgZmlu\nYWwgaW50IGVhZ2VyTW9kZSwgZmluYWwgSm9pbnNbXSByZXNKb2lucywgYm9v\nbGVhbiBscnMpDQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAg\nICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygp\nOw0KICAgICAgICBmaW5hbCBDbGFzc01hcHBpbmdbXSBrZXlzID0ga2V5Lmdl\ndEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCk7DQogICAgICAgIFVuaW9uIHVu\naW9uID0gc3RvcmUuZ2V0U1FMRmFjdG9yeSgpLm5ld1VuaW9uKGtleXMubGVu\nZ3RoKTsNCiAgICAgICAgaWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2Rl\nKGtleS5nZXRUeXBlTWFwcGluZygpKSANCiAgICAgICAgICAgICE9IEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfSk9JTikNCiAgICAgICAgICAgIHVu\naW9uLmFib3J0VW5pb24oKTsNCiAgICAgICAgdW5pb24uc2V0TFJTKGxycyk7\nDQogICAgICAgIHVuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7\nDQogICAgICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwg\naW50IGlkeCkgew0KICAgICAgICAgICAgICAgIHNlbC5zZWxlY3QoX3Zjb2xz\nKTsNCiAgICAgICAgICAgICAgICBzZWwud2hlcmVGb3JlaWduS2V5KGZpZWxk\nLmdldEpvaW5Gb3JlaWduS2V5KCksDQogICAgICAgICAgICAgICAgICAgIHNt\nLmdldE9iamVjdElkKCksIGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpLCBz\ndG9yZSk7DQoNCiAgICAgICAgICAgICAgICBKb2lucyBqb2lucyA9IGpvaW5L\nZXlSZWxhdGlvbihzZWwubmV3Sm9pbnMoKSwga2V5c1tpZHhdKTsNCiAgICAg\nICAgICAgICAgICBzZWwuc2VsZWN0KGtleXNbaWR4XSwgZmllbGQuZ2V0S2V5\nTWFwcGluZygpLg0KICAgICAgICAgICAgICAgICAgICBnZXRTZWxlY3RTdWJj\nbGFzc2VzKCksIHN0b3JlLCBmZXRjaCwgZWFnZXJNb2RlLCBqb2lucyk7DQoN\nCiAgICAgICAgICAgICAgICAvLyMjIyBjaGVhdDogcmVzdWx0IGpvaW5zIG9u\nbHkgY2FyZSBhYm91dCB0aGUgcmVsYXRpb24gcGF0aDsNCiAgICAgICAgICAg\nICAgICAvLyMjIyB0aHVzIHdlIGNhbiB1c2UgZmlyc3QgbWFwcGluZyBvZiB1\nbmlvbiBvbmx5DQogICAgICAgICAgICAgICAgaWYgKGlkeCA9PSAwKQ0KICAg\nICAgICAgICAgICAgICAgICByZXNKb2luc1swXSA9IGpvaW5zOw0KICAgICAg\nICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgUmVzdWx0IHJlcyA9IHVu\naW9uLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsNCiAgICAgICAgcmV0dXJuIG5l\ndyBSZXN1bHRbXXsgcmVzLCByZXMgfTsNCiAgICB9DQoNCiAgICBwdWJsaWMg\nT2JqZWN0IGxvYWRLZXkoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0\nb3JlIHN0b3JlLA0KICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLCBSZXN1bHQgcmVzLCBKb2lucyBqb2lucykNCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7DQogICAgICAgIENsYXNzTWFwcGluZyBrZXkgPSBy\nZXMuZ2V0QmFzZU1hcHBpbmcoKTsNCiAgICAgICAgaWYgKGtleSA9PSBudWxs\nKQ0KICAgICAgICAgICAga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdl\ndEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKClbMF07DQogICAgICAgIHJldHVy\nbiByZXMubG9hZChrZXksIHN0b3JlLCBmZXRjaCwgam9pbnMpOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBPYmplY3QgbG9hZFZhbHVlKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwNCiAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMp\nDQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAgICAgICByZXR1\ncm4gSGFuZGxlclN0cmF0ZWdpZXMubG9hZE9iamVjdChmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpLA0KICAgICAgICAgICAgc20sIHN0b3JlLCBmZXRjaCwg\ncmVzLCBqb2lucywgX3Zjb2xzLCBfdmxvYWQpOw0KICAgIH0NCg0KICAgIHB1\nYmxpYyBKb2lucyBqb2luS2V5UmVsYXRpb24oSm9pbnMgam9pbnMsIENsYXNz\nTWFwcGluZyBrZXkpIHsNCiAgICAgICAgVmFsdWVNYXBwaW5nIHZtID0gZmll\nbGQuZ2V0S2V5TWFwcGluZygpOw0KICAgICAgICByZXR1cm4gam9pbnMuam9p\nblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgdm0uZ2V0Rm9yZWlnbktleShr\nZXkpLCBrZXksDQogICAgICAgICAgICB2bS5nZXRTZWxlY3RTdWJjbGFzc2Vz\nKCksIGZhbHNlLCBmYWxzZSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQg\nbWFwKGJvb2xlYW4gYWRhcHQpIHsNCiAgICAgICAgc3VwZXIubWFwKGFkYXB0\nKTsNCg0KICAgICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5\nTWFwcGluZygpOw0KICAgICAgICBpZiAoa2V5LmdldFR5cGVDb2RlKCkgIT0g\nSmF2YVR5cGVzLlBDIHx8IGtleS5pc0VtYmVkZGVkUEMoKSkNCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLXJlbGF0aW9uIiwga2V5KSk7DQogICAgICAgIFZhbHVlTWFwcGluZyB2YWwg\nPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOw0KICAgICAgICBpZiAodmFs\nLmdldEhhbmRsZXIoKSA9PSBudWxsKQ0KICAgICAgICAgICAgdGhyb3cgbmV3\nIE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1oYW5kbGVyIiwgdmFs\nKSk7DQogICAgICAgIGFzc2VydE5vdE1hcHBlZEJ5KCk7DQoNCiAgICAgICAg\nZmllbGQubWFwSm9pbihhZGFwdCwgdHJ1ZSk7DQogICAgICAgIF92aW8gPSBu\nZXcgQ29sdW1uSU8oKTsNCiAgICAgICAgX3Zjb2xzID0gSGFuZGxlclN0cmF0\nZWdpZXMubWFwKHZhbCwgInZhbHVlIiwgX3ZpbywgYWRhcHQpOw0KDQogICAg\nICAgIGlmIChrZXkuZ2V0VHlwZU1hcHBpbmcoKS5pc01hcHBlZCgpKSB7DQog\nICAgICAgICAgICBWYWx1ZU1hcHBpbmdJbmZvIHZpbmZvID0ga2V5LmdldFZh\nbHVlSW5mbygpOw0KICAgICAgICAgICAgRm9yZWlnbktleSBmayA9IHZpbmZv\nLmdldFR5cGVKb2luKGtleSwgImtleSIsIGZhbHNlLCBhZGFwdCk7DQogICAg\nICAgICAgICBrZXkuc2V0Rm9yZWlnbktleShmayk7DQogICAgICAgICAgICBr\nZXkuc2V0Q29sdW1uSU8odmluZm8uZ2V0Q29sdW1uSU8oKSk7DQogICAgICAg\nIH0gZWxzZQ0KICAgICAgICAgICAgUmVsYXRpb25TdHJhdGVnaWVzLm1hcFJl\nbGF0aW9uVG9Vbm1hcHBlZFBDKGtleSwgImtleSIsIGFkYXB0KTsNCg0KICAg\nICAgICBrZXkubWFwQ29uc3RyYWludHMoImtleSIsIGFkYXB0KTsNCiAgICAg\nICAgZmllbGQubWFwUHJpbWFyeUtleShhZGFwdCk7DQogICAgfQ0KDQogICAg\ncHVibGljIHZvaWQgaW5pdGlhbGl6ZSgpIHsNCiAgICAgICAgX3Zsb2FkID0g\nZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRIYW5kbGVyKCkuDQogICAg\nICAgICAgICBvYmplY3RWYWx1ZVJlcXVpcmVzTG9hZChmaWVsZC5nZXRFbGVt\nZW50TWFwcGluZygpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBpbnNl\ncnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBS\nb3dNYW5hZ2VyIHJtKQ0KICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsN\nCiAgICAgICAgaW5zZXJ0KHNtLCBzdG9yZSwgcm0sIChNYXApIHNtLmZldGNo\nT2JqZWN0KGZpZWxkLmdldEluZGV4KCkpKTsNCiAgICB9DQoNCiAgICBwcml2\nYXRlIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEpEQkNT\ndG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSwNCiAgICAgICAgTWFwIG1hcCkN\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7DQogICAgICAgIGlmICht\nYXAgPT0gbnVsbCB8fCBtYXAuaXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0\ndXJuOw0KDQogICAgICAgIFJvdyByb3cgPSBybS5nZXRTZWNvbmRhcnlSb3co\nZmllbGQuZ2V0VGFibGUoKSwgUm93LkFDVElPTl9JTlNFUlQpOw0KICAgICAg\nICByb3cuc2V0Rm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktleSgp\nLCBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwNCiAgICAgICAgICAgIHNtKTsN\nCg0KICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKTsNCiAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9IGZpZWxk\nLmdldEtleU1hcHBpbmcoKTsNCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9\nIHN0b3JlLmdldENvbnRleHQoKTsNCiAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBrZXlzbTsNCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5Ow0KICAgICAg\nICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICBrZXlzbSA9IFJl\nbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIoZW50cnkuZ2V0S2V5\nKCksIGN0eCk7DQogICAgICAgICAgICBrZXkuc2V0Rm9yZWlnbktleShyb3cs\nIGtleXNtKTsNCiAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLnNldCh2\nYWwsIGVudHJ5LmdldFZhbHVlKCksIHN0b3JlLCByb3csIF92Y29scywNCiAg\nICAgICAgICAgICAgICBfdmlvLCB0cnVlKTsNCiAgICAgICAgICAgIHJtLmZs\ndXNoU2Vjb25kYXJ5Um93KHJvdyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAg\nICBwdWJsaWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQ0KICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAgICAgTWFwIG1hcCA9IChNYXApIHNt\nLmZldGNoT2JqZWN0KGZpZWxkLmdldEluZGV4KCkpOw0KICAgICAgICBDaGFu\nZ2VUcmFja2VyIGN0ID0gbnVsbDsNCiAgICAgICAgaWYgKG1hcCBpbnN0YW5j\nZW9mIFByb3h5KSB7DQogICAgICAgICAgICBQcm94eSBwcm94eSA9IChQcm94\neSkgbWFwOw0KICAgICAgICAgICAgaWYgKFByb3hpZXMuaXNPd25lcihwcm94\neSwgc20sIGZpZWxkLmdldEluZGV4KCkpKQ0KICAgICAgICAgICAgICAgIGN0\nID0gcHJveHkuZ2V0Q2hhbmdlVHJhY2tlcigpOw0KICAgICAgICB9DQoNCiAg\nICAgICAgLy8gaWYgbm8gZmluZS1ncmFpbmVkIGNoYW5nZSB0cmFja2luZyB0\naGVuIGp1c3QgZGVsZXRlIGFuZCByZWluc2VydA0KICAgICAgICBpZiAoY3Qg\nPT0gbnVsbCB8fCAhY3QuaXNUcmFja2luZygpKSB7DQogICAgICAgICAgICBk\nZWxldGUoc20sIHN0b3JlLCBybSk7DQogICAgICAgICAgICBpbnNlcnQoc20s\nIHN0b3JlLCBybSwgbWFwKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAg\nICAgfQ0KDQogICAgICAgIC8vIGRlbGV0ZSB0aGUgcmVtb3Zlcw0KICAgICAg\nICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOw0K\nICAgICAgICBTdG9yZUNvbnRleHQgY3R4ID0gc3RvcmUuZ2V0Q29udGV4dCgp\nOw0KICAgICAgICBDb2xsZWN0aW9uIHJlbSA9IGN0LmdldFJlbW92ZWQoKTsN\nCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBrZXlzbTsNCiAgICAgICAg\naWYgKCFyZW0uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBSb3cgZGVsUm93\nID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksDQogICAg\nICAgICAgICAgICAgUm93LkFDVElPTl9ERUxFVEUpOw0KICAgICAgICAgICAg\nZGVsUm93LndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9yZWlnbktl\neSgpLCBzbSk7DQogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHJl\nbS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAg\nICAgIGtleXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdl\ncihpdHIubmV4dCgpLCBjdHgpOw0KICAgICAgICAgICAgICAgIGtleS53aGVy\nZUZvcmVpZ25LZXkoZGVsUm93LCBrZXlzbSk7DQogICAgICAgICAgICAgICAg\ncm0uZmx1c2hTZWNvbmRhcnlSb3coZGVsUm93KTsNCiAgICAgICAgICAgIH0N\nCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGluc2VydCB0aGUgYWRkcw0KICAg\nICAgICBWYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKTsNCiAgICAgICAgQ29sbGVjdGlvbiBhZGQgPSBjdC5nZXRBZGRlZCgp\nOw0KICAgICAgICBPYmplY3QgbWtleTsNCiAgICAgICAgaWYgKCFhZGQuaXNF\nbXB0eSgpKSB7DQogICAgICAgICAgICBSb3cgYWRkUm93ID0gcm0uZ2V0U2Vj\nb25kYXJ5Um93KGZpZWxkLmdldFRhYmxlKCksDQogICAgICAgICAgICAgICAg\nUm93LkFDVElPTl9JTlNFUlQpOw0KICAgICAgICAgICAgYWRkUm93LnNldEZv\ncmVpZ25LZXkoZmllbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwNCiAgICAgICAg\nICAgICAgICBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwgc20pOw0KDQogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFkZC5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgew0KICAgICAgICAgICAgICAgIG1rZXkgPSBpdHIu\nbmV4dCgpOw0KICAgICAgICAgICAgICAgIGtleXNtID0gUmVsYXRpb25TdHJh\ndGVnaWVzLmdldFN0YXRlTWFuYWdlcihta2V5LCBjdHgpOw0KICAgICAgICAg\nICAgICAgIGtleS5zZXRGb3JlaWduS2V5KGFkZFJvdywga2V5c20pOw0KICAg\nICAgICAgICAgICAgIEhhbmRsZXJTdHJhdGVnaWVzLnNldCh2YWwsIG1hcC5n\nZXQobWtleSksIHN0b3JlLCBhZGRSb3csDQogICAgICAgICAgICAgICAgICAg\nIF92Y29scywgX3ZpbywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgcm0uZmx1\nc2hTZWNvbmRhcnlSb3coYWRkUm93KTsNCiAgICAgICAgICAgIH0NCiAgICAg\nICAgfQ0KDQogICAgICAgIC8vIHVwZGF0ZSB0aGUgY2hhbmdlcw0KICAgICAg\nICBDb2xsZWN0aW9uIGNoYW5nZSA9IGN0LmdldENoYW5nZWQoKTsNCiAgICAg\nICAgaWYgKCFjaGFuZ2UuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBSb3cg\nY2hhbmdlUm93ID0gcm0uZ2V0U2Vjb25kYXJ5Um93KGZpZWxkLmdldFRhYmxl\nKCksDQogICAgICAgICAgICAgICAgUm93LkFDVElPTl9VUERBVEUpOw0KICAg\nICAgICAgICAgY2hhbmdlUm93LndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRK\nb2luRm9yZWlnbktleSgpLCBzbSk7DQoNCiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gY2hhbmdlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7DQogICAgICAgICAgICAgICAgbWtleSA9IGl0ci5uZXh0KCk7DQogICAg\nICAgICAgICAgICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3Rh\ndGVNYW5hZ2VyKG1rZXksIGN0eCk7DQogICAgICAgICAgICAgICAga2V5Lndo\nZXJlRm9yZWlnbktleShjaGFuZ2VSb3csIGtleXNtKTsNCiAgICAgICAgICAg\nICAgICBIYW5kbGVyU3RyYXRlZ2llcy5zZXQodmFsLCBtYXAuZ2V0KG1rZXkp\nLCBzdG9yZSwgY2hhbmdlUm93LA0KICAgICAgICAgICAgICAgICAgICBfdmNv\nbHMsIF92aW8sIHRydWUpOw0KICAgICAgICAgICAgICAgIHJtLmZsdXNoU2Vj\nb25kYXJ5Um93KGNoYW5nZVJvdyk7DQogICAgICAgICAgICB9DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgSm9pbnMgam9pblJlbGF0aW9uKEpv\naW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsDQogICAgICAgIGJvb2xl\nYW4gdHJhdmVyc2UpIHsNCiAgICAgICAgaWYgKHRyYXZlcnNlKQ0KICAgICAg\nICAgICAgSGFuZGxlclN0cmF0ZWdpZXMuYXNzZXJ0Sm9pbmFibGUoZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKSk7DQogICAgICAgIHJldHVybiBqb2luczsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgSm9pbnMgam9pbktleVJlbGF0aW9uKEpv\naW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsDQogICAgICAgIGJvb2xl\nYW4gdHJhdmVyc2UpIHsNCiAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9IGZp\nZWxkLmdldEtleU1hcHBpbmcoKTsNCiAgICAgICAgQ2xhc3NNYXBwaW5nW10g\nY2xzcyA9IGtleS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOw0KICAg\nICAgICBpZiAoY2xzcy5sZW5ndGggIT0gMSkgew0KICAgICAgICAgICAgaWYg\nKHRyYXZlcnNlKQ0KICAgICAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3Ry\nYXRlZ2llcy51bmpvaW5hYmxlKGZpZWxkLmdldEtleU1hcHBpbmcoKSk7DQog\nICAgICAgICAgICByZXR1cm4gam9pbnM7DQogICAgICAgIH0NCiAgICAgICAg\naWYgKGZvcmNlT3V0ZXIpDQogICAgICAgICAgICByZXR1cm4gam9pbnMub3V0\nZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLA0KICAgICAgICAgICAg\nICAgIGtleS5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLCBjbHNzWzBdLCBrZXku\nZ2V0U2VsZWN0U3ViY2xhc3NlcygpLA0KICAgICAgICAgICAgICAgIGZhbHNl\nLCBmYWxzZSk7DQogICAgICAgIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24o\nZmllbGQuZ2V0TmFtZSgpLA0KICAgICAgICAgICAga2V5LmdldEZvcmVpZ25L\nZXkoY2xzc1swXSksIGNsc3NbMF0sIGtleS5nZXRTZWxlY3RTdWJjbGFzc2Vz\nKCksDQogICAgICAgICAgICBmYWxzZSwgZmFsc2UpOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyBPYmplY3QgdG9EYXRhU3RvcmVWYWx1ZShPYmplY3QgdmFsLCBK\nREJDU3RvcmUgc3RvcmUpIHsNCiAgICAgICAgcmV0dXJuIEhhbmRsZXJTdHJh\ndGVnaWVzLnRvRGF0YVN0b3JlVmFsdWUoZmllbGQuZ2V0RWxlbWVudE1hcHBp\nbmcoKSwNCiAgICAgICAgICAgIHZhbCwgX3Zjb2xzLCBzdG9yZSk7DQogICAg\nfQ0KDQogICAgcHVibGljIE9iamVjdCB0b0tleURhdGFTdG9yZVZhbHVlKE9i\namVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkgew0KICAgICAgICByZXR1cm4g\nUmVsYXRpb25TdHJhdGVnaWVzLnRvRGF0YVN0b3JlVmFsdWUoZmllbGQuZ2V0\nS2V5TWFwcGluZygpLCB2YWwsDQogICAgICAgICAgICBzdG9yZSk7DQogICAg\nfQ0KfQ0K\n","encoding":"base64"}

