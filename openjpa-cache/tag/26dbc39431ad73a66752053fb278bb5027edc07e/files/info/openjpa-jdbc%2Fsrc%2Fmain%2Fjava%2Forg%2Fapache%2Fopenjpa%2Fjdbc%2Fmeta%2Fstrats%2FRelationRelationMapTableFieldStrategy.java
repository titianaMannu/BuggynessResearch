{"sha":"60770b6cfeb3ecb2f617e29636c7aa95c7ba0261","node_id":"MDQ6QmxvYjIwNjM2NDo2MDc3MGI2Y2ZlYjNlY2IyZjYxN2UyOTYzNmM3YWE5NWM3YmEwMjYx","size":15493,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/60770b6cfeb3ecb2f617e29636c7aa95c7ba0261","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLg0KICovDQpwYWNrYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzOw0KDQppbXBvcnQgamF2YS5zcWwuKjsNCmltcG9ydCBq\nYXZhLnV0aWwuKjsNCg0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIu\ndXRpbC4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLio7DQpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC4qOw0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLio7DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNjaGVtYS4qOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNxbC4qOw0KDQovKioNCiAqIDxwPk1hcHBpbmcgZm9yIGEgbWFwIHdob3Nl\nIGtleXMgYW5kIHZhbHVlcyBhcmUgYm90aCByZWxhdGlvbnMgdG8gb3RoZXIN\nCiAqIHBlcnNpc3RlbnQgb2JqZWN0cy48L3A+DQogKg0KICogQGF1dGhvciBB\nYmUgV2hpdGUNCiAqIEBzaW5jZSAwLjQuMCwgMS4xLjANCiAqLw0KcHVibGlj\nIGNsYXNzIFJlbGF0aW9uUmVsYXRpb25NYXBUYWJsZUZpZWxkU3RyYXRlZ3kN\nCiAgICBleHRlbmRzIE1hcFRhYmxlRmllbGRTdHJhdGVneSB7DQoNCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXpl\nci5mb3JQYWNrYWdlDQogICAgICAgIChSZWxhdGlvblJlbGF0aW9uTWFwVGFi\nbGVGaWVsZFN0cmF0ZWd5LmNsYXNzKTsNCg0KICAgIHByaXZhdGUgU3RyaW5n\nIF9rZXlSZWxhdGlvbk5hbWUgPSBudWxsOw0KDQogICAgcHVibGljIENvbHVt\nbltdIGdldEtleUNvbHVtbnMoQ2xhc3NNYXBwaW5nIGNscykgew0KICAgICAg\nICByZXR1cm4gZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldENvbHVtbnMoKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0VmFsdWVDb2x1bW5z\nKENsYXNzTWFwcGluZyBjbHMpIHsNCiAgICAgICAgcmV0dXJuIGZpZWxkLmdl\ndEVsZW1lbnRNYXBwaW5nKCkuZ2V0Q29sdW1ucygpOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdEtleShTZWxlY3Qgc2VsLCBDbGFzc01hcHBp\nbmcga2V5LCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLA0KICAgICAgICBKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIEpv\naW5zIGpvaW5zKSB7DQogICAgICAgIHNlbC5zZWxlY3Qoa2V5LCBmaWVsZC5n\nZXRLZXlNYXBwaW5nKCkuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLA0KICAgICAg\nICAgICAgc3RvcmUsIGZldGNoLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVB\nR0VSX05PTkUsIGpvaW5zKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBz\nZWxlY3RWYWx1ZShTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgdmFsLA0KICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIA0KICAgICAgICBKb2lu\ncyBqb2lucykgew0KICAgICAgICBzZWwuc2VsZWN0KHZhbCwgZmllbGQuZ2V0\nRWxlbWVudE1hcHBpbmcoKS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksDQogICAg\nICAgICAgICBzdG9yZSwgZmV0Y2gsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24u\nRUFHRVJfTk9ORSwgam9pbnMpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBSZXN1\nbHRbXSBnZXRSZXN1bHRzKGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nDQogICAgICAgIGZpbmFsIEpEQkNTdG9yZSBzdG9yZSwgZmluYWwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwNCiAgICAgICAgZmluYWwgaW50IGVh\nZ2VyTW9kZSwgZmluYWwgSm9pbnNbXSByZXNKb2lucywgYm9vbGVhbiBscnMp\nDQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAgICAgICBWYWx1\nZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOw0KICAgICAg\nICBmaW5hbCBDbGFzc01hcHBpbmdbXSBrZXlzID0ga2V5LmdldEluZGVwZW5k\nZW50VHlwZU1hcHBpbmdzKCk7DQogICAgICAgIFVuaW9uIGt1bmlvbiA9IHN0\nb3JlLmdldFNRTEZhY3RvcnkoKS5uZXdVbmlvbihrZXlzLmxlbmd0aCk7DQog\nICAgICAgIGlmIChmZXRjaC5nZXRTdWJjbGFzc0ZldGNoTW9kZShrZXkuZ2V0\nVHlwZU1hcHBpbmcoKSkNCiAgICAgICAgICAgICE9IEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24uRUFHRVJfSk9JTikNCiAgICAgICAgICAgIGt1bmlvbi5hYm9y\ndFVuaW9uKCk7DQogICAgICAgIGt1bmlvbi5zZXRMUlMobHJzKTsNCiAgICAg\nICAga3VuaW9uLnNlbGVjdChuZXcgVW5pb24uU2VsZWN0b3IoKSB7DQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGlk\neCkgew0KICAgICAgICAgICAgICAgIHNlbC53aGVyZUZvcmVpZ25LZXkoZmll\nbGQuZ2V0Sm9pbkZvcmVpZ25LZXkoKSwNCiAgICAgICAgICAgICAgICAgICAg\nc20uZ2V0T2JqZWN0SWQoKSwgZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCks\nIHN0b3JlKTsNCg0KICAgICAgICAgICAgICAgIC8vIG9yZGVyIGJlZm9yZSBz\nZWxlY3QgaW4gY2FzZSB3ZSdyZSBmYWtpbmcgdW5pb24gd2l0aA0KICAgICAg\nICAgICAgICAgIC8vIG11bHRpcGxlIHNlbGVjdHM7IG9yZGVyIHZhbHMgdXNl\nZCB0byBtZXJnZSByZXN1bHRzDQogICAgICAgICAgICAgICAgSm9pbnMgam9p\nbnMgPSBqb2luS2V5UmVsYXRpb24oc2VsLm5ld0pvaW5zKCksIGtleXNbaWR4\nXSk7DQogICAgICAgICAgICAgICAgc2VsLm9yZGVyQnkoZmllbGQuZ2V0S2V5\nTWFwcGluZygpLmdldENvbHVtbnMoKSwgdHJ1ZSwgdHJ1ZSk7DQogICAgICAg\nICAgICAgICAgc2VsLnNlbGVjdChrZXlzW2lkeF0sIGZpZWxkLmdldEtleU1h\ncHBpbmcoKS4NCiAgICAgICAgICAgICAgICAgICAgZ2V0U2VsZWN0U3ViY2xh\nc3NlcygpLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwgam9pbnMpOw0KDQog\nICAgICAgICAgICAgICAgLy8jIyMgY2hlYXQ6IHJlc3VsdCBqb2lucyBvbmx5\nIGNhcmUgYWJvdXQgdGhlIHJlbGF0aW9uIHBhdGg7DQogICAgICAgICAgICAg\nICAgLy8jIyMgdGh1cyB3ZSBjYW4gdXNlIGZpcnN0IG1hcHBpbmcgb2YgdW5p\nb24gb25seQ0KICAgICAgICAgICAgICAgIGlmIChpZHggPT0gMCkNCiAgICAg\nICAgICAgICAgICAgICAgcmVzSm9pbnNbMF0gPSBqb2luczsNCiAgICAgICAg\nICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgVmFsdWVNYXBwaW5nIHZh\nbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7DQogICAgICAgIGZpbmFs\nIENsYXNzTWFwcGluZ1tdIHZhbHMgPSB2YWwuZ2V0SW5kZXBlbmRlbnRUeXBl\nTWFwcGluZ3MoKTsNCiAgICAgICAgVW5pb24gdnVuaW9uID0gc3RvcmUuZ2V0\nU1FMRmFjdG9yeSgpLm5ld1VuaW9uKHZhbHMubGVuZ3RoKTsNCiAgICAgICAg\naWYgKGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2RlKHZhbC5nZXRUeXBlTWFw\ncGluZygpKQ0KICAgICAgICAgICAgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbi5FQUdFUl9KT0lOKQ0KICAgICAgICAgICAgdnVuaW9uLmFib3J0VW5pb24o\nKTsNCiAgICAgICAgdnVuaW9uLnNldExSUyhscnMpOw0KICAgICAgICB2dW5p\nb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3RvcigpIHsNCiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2VsLCBpbnQgaWR4KSB7DQog\nICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWlnbktleShmaWVsZC5nZXRK\nb2luRm9yZWlnbktleSgpLA0KICAgICAgICAgICAgICAgICAgICBzbS5nZXRP\nYmplY3RJZCgpLCBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgc3RvcmUp\nOw0KDQogICAgICAgICAgICAgICAgLy8gb3JkZXIgYmVmb3JlIHNlbGVjdCBp\nbiBjYXNlIHdlJ3JlIGZha2luZyB1bmlvbiB3aXRoDQogICAgICAgICAgICAg\nICAgLy8gbXVsdGlwbGUgc2VsZWN0czsgb3JkZXIgdmFscyB1c2VkIHRvIG1l\ncmdlIHJlc3VsdHMNCiAgICAgICAgICAgICAgICBKb2lucyBqb2lucyA9IGpv\naW5WYWx1ZVJlbGF0aW9uKHNlbC5uZXdKb2lucygpLCB2YWxzW2lkeF0pOw0K\nICAgICAgICAgICAgICAgIHNlbC5vcmRlckJ5KGZpZWxkLmdldEtleU1hcHBp\nbmcoKS5nZXRDb2x1bW5zKCksIHRydWUsIHRydWUpOw0KICAgICAgICAgICAg\nICAgIHNlbC5zZWxlY3QodmFsc1tpZHhdLCBmaWVsZC5nZXRFbGVtZW50TWFw\ncGluZygpLg0KICAgICAgICAgICAgICAgICAgICBnZXRTZWxlY3RTdWJjbGFz\nc2VzKCksIHN0b3JlLCBmZXRjaCwgZWFnZXJNb2RlLCBqb2lucyk7DQoNCiAg\nICAgICAgICAgICAgICAvLyMjIyBjaGVhdDogcmVzdWx0IGpvaW5zIG9ubHkg\nY2FyZSBhYm91dCB0aGUgcmVsYXRpb24gcGF0aDsNCiAgICAgICAgICAgICAg\nICAvLyMjIyB0aHVzIHdlIGNhbiB1c2UgZmlyc3QgbWFwcGluZyBvZiB1bmlv\nbiBvbmx5DQogICAgICAgICAgICAgICAgaWYgKGlkeCA9PSAwKQ0KICAgICAg\nICAgICAgICAgICAgICByZXNKb2luc1sxXSA9IGpvaW5zOw0KICAgICAgICAg\nICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICBSZXN1bHQga3JlcyA9IG51\nbGw7DQogICAgICAgIFJlc3VsdCB2cmVzID0gbnVsbDsNCiAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgIGtyZXMgPSBrdW5pb24uZXhlY3V0ZShzdG9yZSwg\nZmV0Y2gpOw0KICAgICAgICAgICAgdnJlcyA9IHZ1bmlvbi5leGVjdXRlKHN0\nb3JlLCBmZXRjaCk7DQogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3VsdFtd\neyBrcmVzLCB2cmVzIH07DQogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgew0KICAgICAgICAgICAgaWYgKGtyZXMgIT0gbnVsbCkNCiAgICAg\nICAgICAgICAgICBrcmVzLmNsb3NlKCk7DQogICAgICAgICAgICBpZiAodnJl\ncyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHZyZXMuY2xvc2UoKTsNCiAg\nICAgICAgICAgIHRocm93IHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\ncHVibGljIE9iamVjdCBsb2FkS2V5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwNCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpDQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gew0KICAgICAgICBDbGFzc01hcHBpbmcg\na2V5ID0gcmVzLmdldEJhc2VNYXBwaW5nKCk7DQogICAgICAgIGlmIChrZXkg\nPT0gbnVsbCkNCiAgICAgICAgICAgIGtleSA9IGZpZWxkLmdldEtleU1hcHBp\nbmcoKS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpWzBdOw0KICAgICAg\nICByZXR1cm4gcmVzLmxvYWQoa2V5LCBzdG9yZSwgZmV0Y2gsIGpvaW5zKTsN\nCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRWYWx1ZShPcGVuSlBB\nU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUsDQogICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMsIEpvaW5z\nIGpvaW5zKQ0KICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIHZhbCA9IHJlcy5nZXRCYXNlTWFwcGluZygpOw0K\nICAgICAgICBpZiAodmFsID09IG51bGwpDQogICAgICAgICAgICB2YWwgPSBm\naWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldEluZGVwZW5kZW50VHlwZU1h\ncHBpbmdzKClbMF07DQogICAgICAgIHJldHVybiByZXMubG9hZCh2YWwsIHN0\nb3JlLCBmZXRjaCwgam9pbnMpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBKb2lu\ncyBqb2luS2V5UmVsYXRpb24oSm9pbnMgam9pbnMsIENsYXNzTWFwcGluZyBr\nZXkpIHsNCiAgICAgICAgVmFsdWVNYXBwaW5nIHZtID0gZmllbGQuZ2V0S2V5\nTWFwcGluZygpOw0KICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9u\nKF9rZXlSZWxhdGlvbk5hbWUsIHZtLmdldEZvcmVpZ25LZXkoa2V5KSwga2V5\nLA0KICAgICAgICAgICAgdm0uZ2V0U2VsZWN0U3ViY2xhc3NlcygpLCBmYWxz\nZSwgZmFsc2UpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBKb2lucyBqb2luVmFs\ndWVSZWxhdGlvbihKb2lucyBqb2lucywgQ2xhc3NNYXBwaW5nIHZhbCkgew0K\nICAgICAgICBWYWx1ZU1hcHBpbmcgdm0gPSBmaWVsZC5nZXRFbGVtZW50TWFw\ncGluZygpOw0KICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZp\nZWxkLmdldE5hbWUoKSwgdm0uZ2V0Rm9yZWlnbktleSh2YWwpLCB2YWwsDQog\nICAgICAgICAgICB2bS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksIGZhbHNlLCBm\nYWxzZSk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgbWFwKGJvb2xlYW4g\nYWRhcHQpIHsNCiAgICAgICAgc3VwZXIubWFwKGFkYXB0KTsNCg0KICAgICAg\nICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOw0K\nICAgICAgICBpZiAoa2V5LmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBD\nIHx8IGtleS5pc0VtYmVkZGVkUEMoKSkNCiAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LXJlbGF0aW9uIiwg\na2V5KSk7DQogICAgICAgIFZhbHVlTWFwcGluZyB2YWwgPSBmaWVsZC5nZXRF\nbGVtZW50TWFwcGluZygpOw0KICAgICAgICBpZiAodmFsLmdldFR5cGVDb2Rl\nKCkgIT0gSmF2YVR5cGVzLlBDIHx8IHZhbC5pc0VtYmVkZGVkUEMoKSkNCiAg\nICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdl\ndCgibm90LXJlbGF0aW9uIiwgdmFsKSk7DQogICAgICAgIGFzc2VydE5vdE1h\ncHBlZEJ5KCk7DQoNCiAgICAgICAgZmllbGQubWFwSm9pbihhZGFwdCwgdHJ1\nZSk7DQogICAgICAgIG1hcFR5cGVKb2luKGtleSwgImtleSIsIGFkYXB0KTsN\nCiAgICAgICAgbWFwVHlwZUpvaW4odmFsLCAidmFsdWUiLCBhZGFwdCk7DQoN\nCiAgICAgICAgZmllbGQubWFwUHJpbWFyeUtleShhZGFwdCk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogTWFwIHRoZSBnaXZlbiB2YWx1ZSdzIGpvaW4g\ndG8gaXRzIHBlcnNpc3RlbnQgdHlwZS4NCiAgICAgKi8NCiAgICBwcml2YXRl\nIHZvaWQgbWFwVHlwZUpvaW4oVmFsdWVNYXBwaW5nIHZtLCBTdHJpbmcgbmFt\nZSwgYm9vbGVhbiBhZGFwdCkgew0KICAgICAgICBpZiAodm0uZ2V0VHlwZU1h\ncHBpbmcoKS5pc01hcHBlZCgpKSB7DQogICAgICAgICAgICBWYWx1ZU1hcHBp\nbmdJbmZvIHZpbmZvID0gdm0uZ2V0VmFsdWVJbmZvKCk7DQogICAgICAgICAg\nICBGb3JlaWduS2V5IGZrID0gdmluZm8uZ2V0VHlwZUpvaW4odm0sIG5hbWUs\nIGZhbHNlLCBhZGFwdCk7DQogICAgICAgICAgICB2bS5zZXRGb3JlaWduS2V5\nKGZrKTsNCiAgICAgICAgICAgIHZtLnNldENvbHVtbklPKHZpbmZvLmdldENv\nbHVtbklPKCkpOw0KICAgICAgICB9IGVsc2UNCiAgICAgICAgICAgIFJlbGF0\naW9uU3RyYXRlZ2llcy5tYXBSZWxhdGlvblRvVW5tYXBwZWRQQyh2bSwgbmFt\nZSwgYWRhcHQpOw0KICAgICAgICB2bS5tYXBDb25zdHJhaW50cyhuYW1lLCBh\nZGFwdCk7DQogICAgfQ0KDQogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6ZSgp\nIHsNCiAgICAgICAgX2tleVJlbGF0aW9uTmFtZSA9IGZpZWxkLmdldE5hbWUo\nKSArICI6a2V5IjsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBpbnNlcnQo\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dN\nYW5hZ2VyIHJtKQ0KICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsNCiAg\nICAgICAgaW5zZXJ0KHNtLCBybSwgKE1hcCkgc20uZmV0Y2hPYmplY3QoZmll\nbGQuZ2V0SW5kZXgoKSkpOw0KICAgIH0NCg0KICAgIHByaXZhdGUgdm9pZCBp\nbnNlcnQoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgUm93TWFuYWdlciBybSwg\nTWFwIG1hcCkNCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7DQogICAg\nICAgIGlmIChtYXAgPT0gbnVsbCB8fCBtYXAuaXNFbXB0eSgpKQ0KICAgICAg\nICAgICAgcmV0dXJuOw0KDQogICAgICAgIFJvdyByb3cgPSBybS5nZXRTZWNv\nbmRhcnlSb3coZmllbGQuZ2V0VGFibGUoKSwgUm93LkFDVElPTl9JTlNFUlQp\nOw0KICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaWVsZC5nZXRKb2luRm9y\nZWlnbktleSgpLCBmaWVsZC5nZXRKb2luQ29sdW1uSU8oKSwNCiAgICAgICAg\nICAgIHNtKTsNCg0KICAgICAgICBWYWx1ZU1hcHBpbmcga2V5ID0gZmllbGQu\nZ2V0S2V5TWFwcGluZygpOw0KICAgICAgICBWYWx1ZU1hcHBpbmcgdmFsID0g\nZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsNCiAgICAgICAgU3RvcmVDb250\nZXh0IGN0eCA9IHNtLmdldENvbnRleHQoKTsNCiAgICAgICAgT3BlbkpQQVN0\nYXRlTWFuYWdlciBrZXlzbSwgdmFsc207DQogICAgICAgIE1hcC5FbnRyeSBl\nbnRyeTsNCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBtYXAuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0KICAgICAgICAg\nICAgZW50cnkgPSAoTWFwLkVudHJ5KSBpdHIubmV4dCgpOw0KICAgICAgICAg\nICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2Vy\nKGVudHJ5LmdldEtleSgpLCBjdHgpOw0KICAgICAgICAgICAgdmFsc20gPSBS\nZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGVudHJ5LmdldFZh\nbHVlKCksIGN0eCk7DQogICAgICAgICAgICBrZXkuc2V0Rm9yZWlnbktleShy\nb3csIGtleXNtKTsNCiAgICAgICAgICAgIHZhbC5zZXRGb3JlaWduS2V5KHJv\ndywgdmFsc20pOw0KICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3co\ncm93KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHVw\nZGF0ZShPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDU3RvcmUgc3RvcmUs\nIFJvd01hbmFnZXIgcm0pDQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\new0KICAgICAgICBNYXAgbWFwID0gKE1hcCkgc20uZmV0Y2hPYmplY3QoZmll\nbGQuZ2V0SW5kZXgoKSk7DQogICAgICAgIENoYW5nZVRyYWNrZXIgY3QgPSBu\ndWxsOw0KICAgICAgICBpZiAobWFwIGluc3RhbmNlb2YgUHJveHkpIHsNCiAg\nICAgICAgICAgIFByb3h5IHByb3h5ID0gKFByb3h5KSBtYXA7DQogICAgICAg\nICAgICBpZiAoUHJveGllcy5pc093bmVyKHByb3h5LCBzbSwgZmllbGQuZ2V0\nSW5kZXgoKSkpDQogICAgICAgICAgICAgICAgY3QgPSBwcm94eS5nZXRDaGFu\nZ2VUcmFja2VyKCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBpZiBubyBm\naW5lLWdyYWluZWQgY2hhbmdlIHRyYWNraW5nIHRoZW4ganVzdCBkZWxldGUg\nYW5kIHJlaW5zZXJ0DQogICAgICAgIGlmIChjdCA9PSBudWxsIHx8ICFjdC5p\nc1RyYWNraW5nKCkpIHsNCiAgICAgICAgICAgIGRlbGV0ZShzbSwgc3RvcmUs\nIHJtKTsNCiAgICAgICAgICAgIGluc2VydChzbSwgcm0sIG1hcCk7DQogICAg\nICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBWYWx1ZU1h\ncHBpbmcga2V5ID0gZmllbGQuZ2V0S2V5TWFwcGluZygpOw0KICAgICAgICBW\nYWx1ZU1hcHBpbmcgdmFsID0gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsN\nCiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHN0b3JlLmdldENvbnRleHQo\nKTsNCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBrZXlzbSwgdmFsc207\nDQoNCiAgICAgICAgLy8gdXBkYXRlIHRoZSBjaGFuZ2VzOyBub3RlIHRoYXQg\nd2UgaGF2ZSB0byBtb2RlbCBjaGFuZ2VzIGFzDQogICAgICAgIC8vIGRlbGV0\nZS10aGVuLWluc2VydCBpZiB3ZSBoYXZlIGEgZm9yZWlnbiBrZXkgYWN0aW9u\nLCBiZWNhdXNlDQogICAgICAgIC8vIHNlY29uZGFyeSByb3cgdXBkYXRlcyBh\ncmVuJ3QgcGFydCBvZiB0aGUgY29uc3RyYWludCBncmFwaA0KICAgICAgICBD\nb2xsZWN0aW9uIGNoYW5nZSA9IGN0LmdldENoYW5nZWQoKTsNCiAgICAgICAg\nYm9vbGVhbiBjYW5DaGFuZ2UgPSB2YWwuZ2V0Rm9yZWlnbktleSgpLmlzTG9n\naWNhbCgpOw0KICAgICAgICBPYmplY3QgbWtleTsNCiAgICAgICAgaWYgKGNh\nbkNoYW5nZSAmJiAhY2hhbmdlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAg\nUm93IGNoYW5nZVJvdyA9IHJtLmdldFNlY29uZGFyeVJvdyhmaWVsZC5nZXRU\nYWJsZSgpLA0KICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05fVVBEQVRFKTsN\nCiAgICAgICAgICAgIGNoYW5nZVJvdy53aGVyZUZvcmVpZ25LZXkoZmllbGQu\nZ2V0Sm9pbkZvcmVpZ25LZXkoKSwgc20pOw0KDQogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IGNoYW5nZS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4\ndCgpOykgew0KICAgICAgICAgICAgICAgIG1rZXkgPSBpdHIubmV4dCgpOw0K\nICAgICAgICAgICAgICAgIGtleXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdl\ndFN0YXRlTWFuYWdlcihta2V5LCBjdHgpOw0KICAgICAgICAgICAgICAgIHZh\nbHNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdlcihtYXAu\nZ2V0KG1rZXkpLCBjdHgpOw0KICAgICAgICAgICAgICAgIGtleS53aGVyZUZv\ncmVpZ25LZXkoY2hhbmdlUm93LCBrZXlzbSk7DQogICAgICAgICAgICAgICAg\ndmFsLnNldEZvcmVpZ25LZXkoY2hhbmdlUm93LCB2YWxzbSk7DQogICAgICAg\nICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coY2hhbmdlUm93KTsNCiAg\nICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGRlbGV0ZSB0\naGUgcmVtb3Zlcw0KICAgICAgICBDb2xsZWN0aW9uIHJlbSA9IGN0LmdldFJl\nbW92ZWQoKTsNCiAgICAgICAgaWYgKCFyZW0uaXNFbXB0eSgpIHx8ICghY2Fu\nQ2hhbmdlICYmICFjaGFuZ2UuaXNFbXB0eSgpKSkgew0KICAgICAgICAgICAg\nUm93IGRlbFJvdyA9IHJtLmdldFNlY29uZGFyeVJvdyhmaWVsZC5nZXRUYWJs\nZSgpLA0KICAgICAgICAgICAgICAgIFJvdy5BQ1RJT05fREVMRVRFKTsNCiAg\nICAgICAgICAgIGRlbFJvdy53aGVyZUZvcmVpZ25LZXkoZmllbGQuZ2V0Sm9p\nbkZvcmVpZ25LZXkoKSwgc20pOw0KDQogICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHJlbS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgew0K\nICAgICAgICAgICAgICAgIGtleXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdl\ndFN0YXRlTWFuYWdlcihpdHIubmV4dCgpLCBjdHgpOw0KICAgICAgICAgICAg\nICAgIGtleS53aGVyZUZvcmVpZ25LZXkoZGVsUm93LCBrZXlzbSk7DQogICAg\nICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRhcnlSb3coZGVsUm93KTsNCiAg\nICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghY2FuQ2hhbmdlICYmICFj\naGFuZ2UuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgZm9yIChJdGVy\nYXRvciBpdHIgPSBjaGFuZ2UuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsNCiAgICAgICAgICAgICAgICAgICAga2V5c20gPSBSZWxhdGlvblN0cmF0\nZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGl0ci5uZXh0KCksDQogICAgICAgICAg\nICAgICAgICAgICAgICBjdHgpOw0KICAgICAgICAgICAgICAgICAgICBrZXku\nd2hlcmVGb3JlaWduS2V5KGRlbFJvdywga2V5c20pOw0KICAgICAgICAgICAg\nICAgICAgICBybS5mbHVzaFNlY29uZGFyeVJvdyhkZWxSb3cpOw0KICAgICAg\nICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAg\nICAgIC8vIGluc2VydCB0aGUgYWRkcw0KICAgICAgICBDb2xsZWN0aW9uIGFk\nZCA9IGN0LmdldEFkZGVkKCk7DQogICAgICAgIGlmICghYWRkLmlzRW1wdHko\nKSB8fCAoIWNhbkNoYW5nZSAmJiAhY2hhbmdlLmlzRW1wdHkoKSkpIHsNCiAg\nICAgICAgICAgIFJvdyBhZGRSb3cgPSBybS5nZXRTZWNvbmRhcnlSb3coZmll\nbGQuZ2V0VGFibGUoKSwNCiAgICAgICAgICAgICAgICBSb3cuQUNUSU9OX0lO\nU0VSVCk7DQogICAgICAgICAgICBhZGRSb3cuc2V0Rm9yZWlnbktleShmaWVs\nZC5nZXRKb2luRm9yZWlnbktleSgpLA0KICAgICAgICAgICAgICAgIGZpZWxk\nLmdldEpvaW5Db2x1bW5JTygpLCBzbSk7DQoNCiAgICAgICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gYWRkLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7DQogICAgICAgICAgICAgICAgbWtleSA9IGl0ci5uZXh0KCk7DQogICAg\nICAgICAgICAgICAga2V5c20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3Rh\ndGVNYW5hZ2VyKG1rZXksIGN0eCk7DQogICAgICAgICAgICAgICAgdmFsc20g\nPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKG1hcC5nZXQo\nbWtleSksIGN0eCk7DQogICAgICAgICAgICAgICAga2V5LnNldEZvcmVpZ25L\nZXkoYWRkUm93LCBrZXlzbSk7DQogICAgICAgICAgICAgICAgdmFsLnNldEZv\ncmVpZ25LZXkoYWRkUm93LCB2YWxzbSk7DQogICAgICAgICAgICAgICAgcm0u\nZmx1c2hTZWNvbmRhcnlSb3coYWRkUm93KTsNCiAgICAgICAgICAgIH0NCiAg\nICAgICAgICAgIGlmICghY2FuQ2hhbmdlICYmICFjaGFuZ2UuaXNFbXB0eSgp\nKSB7DQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjaGFu\nZ2UuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAg\nICAgICAgICAgbWtleSA9IGl0ci5uZXh0KCk7DQogICAgICAgICAgICAgICAg\nICAgIGtleXNtID0gUmVsYXRpb25TdHJhdGVnaWVzLmdldFN0YXRlTWFuYWdl\ncihta2V5LCBjdHgpOw0KICAgICAgICAgICAgICAgICAgICB2YWxzbSA9IFJl\nbGF0aW9uU3RyYXRlZ2llcy5nZXRTdGF0ZU1hbmFnZXIobWFwLmdldChta2V5\nKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eCk7DQogICAgICAgICAg\nICAgICAgICAgIGtleS5zZXRGb3JlaWduS2V5KGFkZFJvdywga2V5c20pOw0K\nICAgICAgICAgICAgICAgICAgICB2YWwuc2V0Rm9yZWlnbktleShhZGRSb3cs\nIHZhbHNtKTsNCiAgICAgICAgICAgICAgICAgICAgcm0uZmx1c2hTZWNvbmRh\ncnlSb3coYWRkUm93KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAg\nICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgSm9pbnMgam9p\nblJlbGF0aW9uKEpvaW5zIGpvaW5zLCBib29sZWFuIGZvcmNlT3V0ZXIsDQog\nICAgICAgIGJvb2xlYW4gdHJhdmVyc2UpIHsNCiAgICAgICAgVmFsdWVNYXBw\naW5nIHZhbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCk7DQogICAgICAg\nIENsYXNzTWFwcGluZ1tdIGNsc3MgPSB2YWwuZ2V0SW5kZXBlbmRlbnRUeXBl\nTWFwcGluZ3MoKTsNCiAgICAgICAgaWYgKGNsc3MubGVuZ3RoICE9IDEpIHsN\nCiAgICAgICAgICAgIGlmICh0cmF2ZXJzZSkNCiAgICAgICAgICAgICAgICB0\naHJvdyBSZWxhdGlvblN0cmF0ZWdpZXMudW5qb2luYWJsZSh2YWwpOw0KICAg\nICAgICAgICAgcmV0dXJuIGpvaW5zOw0KICAgICAgICB9DQogICAgICAgIGlm\nIChmb3JjZU91dGVyKQ0KICAgICAgICAgICAgcmV0dXJuIGpvaW5zLm91dGVy\nSm9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwNCiAgICAgICAgICAgICAg\nICB2YWwuZ2V0Rm9yZWlnbktleShjbHNzWzBdKSwgY2xzc1swXSwgdmFsLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwNCiAgICAgICAgICAgICAgICBmYWxzZSwg\nZmFsc2UpOw0KICAgICAgICByZXR1cm4gam9pbnMuam9pblJlbGF0aW9uKGZp\nZWxkLmdldE5hbWUoKSwNCiAgICAgICAgICAgIHZhbC5nZXRGb3JlaWduS2V5\nKGNsc3NbMF0pLCBjbHNzWzBdLCB2YWwuZ2V0U2VsZWN0U3ViY2xhc3Nlcygp\nLA0KICAgICAgICAgICAgZmFsc2UsIGZhbHNlKTsNCiAgICB9DQoNCiAgICBw\ndWJsaWMgSm9pbnMgam9pbktleVJlbGF0aW9uKEpvaW5zIGpvaW5zLCBib29s\nZWFuIGZvcmNlT3V0ZXIsDQogICAgICAgIGJvb2xlYW4gdHJhdmVyc2UpIHsN\nCiAgICAgICAgVmFsdWVNYXBwaW5nIGtleSA9IGZpZWxkLmdldEtleU1hcHBp\nbmcoKTsNCiAgICAgICAgQ2xhc3NNYXBwaW5nW10gY2xzcyA9IGtleS5nZXRJ\nbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpOw0KICAgICAgICBpZiAoY2xzcy5s\nZW5ndGggIT0gMSkgew0KICAgICAgICAgICAgaWYgKHRyYXZlcnNlKQ0KICAg\nICAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmpvaW5h\nYmxlKGtleSk7DQogICAgICAgICAgICByZXR1cm4gam9pbnM7DQogICAgICAg\nIH0NCiAgICAgICAgaWYgKGZvcmNlT3V0ZXIpDQogICAgICAgICAgICByZXR1\ncm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFtZSgpLA0K\nICAgICAgICAgICAgICAgIGtleS5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLCBj\nbHNzWzBdLCBrZXkuZ2V0U2VsZWN0U3ViY2xhc3NlcygpLA0KICAgICAgICAg\nICAgICAgIGZhbHNlLCBmYWxzZSk7DQogICAgICAgIHJldHVybiBqb2lucy5q\nb2luUmVsYXRpb24oX2tleVJlbGF0aW9uTmFtZSwNCiAgICAgICAgICAgIGtl\neS5nZXRGb3JlaWduS2V5KGNsc3NbMF0pLCBjbHNzWzBdLCBrZXkuZ2V0U2Vs\nZWN0U3ViY2xhc3NlcygpLCANCiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSk7\nDQogICAgfQ0KDQogICAgcHVibGljIE9iamVjdCB0b0RhdGFTdG9yZVZhbHVl\nKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkgew0KICAgICAgICByZXR1\ncm4gUmVsYXRpb25TdHJhdGVnaWVzLnRvRGF0YVN0b3JlVmFsdWUoZmllbGQu\nZ2V0RWxlbWVudE1hcHBpbmcoKSwNCiAgICAgICAgICAgIHZhbCwgc3RvcmUp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgdG9LZXlEYXRhU3RvcmVW\nYWx1ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpIHsNCiAgICAgICAg\ncmV0dXJuIFJlbGF0aW9uU3RyYXRlZ2llcy50b0RhdGFTdG9yZVZhbHVlKGZp\nZWxkLmdldEtleU1hcHBpbmcoKSwNCiAgICAgICAgICAgIHZhbCwgc3RvcmUp\nOw0KICAgIH0NCn0NCg==\n","encoding":"base64"}

