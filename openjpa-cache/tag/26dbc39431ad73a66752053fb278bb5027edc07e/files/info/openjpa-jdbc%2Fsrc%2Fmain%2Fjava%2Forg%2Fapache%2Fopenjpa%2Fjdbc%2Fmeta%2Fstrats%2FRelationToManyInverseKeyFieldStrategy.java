{"sha":"7a3bec02fece2146ec986ca18ab01c0eb8880fe9","node_id":"MDQ6QmxvYjIwNjM2NDo3YTNiZWMwMmZlY2UyMTQ2ZWM5ODZjYTE4YWIwMWMwZWI4ODgwZmU5","size":14073,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/7a3bec02fece2146ec986ca18ab01c0eb8880fe9","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmdJbmZvOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLlZhbHVlTWFwcGlu\nZ0luZm87CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEu\nQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1h\nLkNvbHVtbklPOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5z\ncWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3Fs\nLlJvdzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5Sb3dN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNl\nbGVjdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQ\nQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJu\nZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGls\nLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkph\ndmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkNoYW5n\nZVRyYWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRl\ncm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuUHJveGllczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlByb3h5OwoKLyoqCiAqIE1hcHMgYSByZWxhdGlvbiB0byBhIHNldCBvZiBv\ndGhlciBvYmplY3RzIHVzaW5nIGFuIGludmVyc2UKICogZm9yZWlnbiBrZXkg\naW4gdGhlIHJlbGF0ZWQgb2JqZWN0IHRhYmxlLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIFJlbGF0aW9uVG9N\nYW55SW52ZXJzZUtleUZpZWxkU3RyYXRlZ3kKICAgIGV4dGVuZHMgU3RvcmVD\nb2xsZWN0aW9uRmllbGRTdHJhdGVneSB7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChSZWxhdGlvblRvTWFueUludmVyc2VLZXlGaWVsZFN0cmF0ZWd5\nLmNsYXNzKTsKCiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVySW5zZXJ0ID0g\nZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX29yZGVyVXBkYXRlID0gZmFs\nc2U7CgogICAgcHJvdGVjdGVkIENsYXNzTWFwcGluZ1tdIGdldEluZGVwZW5k\nZW50RWxlbWVudE1hcHBpbmdzKGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAg\nICByZXR1cm4gZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKS5nZXRJbmRlcGVu\nZGVudFR5cGVNYXBwaW5ncygpOwogICAgfQoKICAgIHByb3RlY3RlZCBGb3Jl\naWduS2V5IGdldEpvaW5Gb3JlaWduS2V5KENsYXNzTWFwcGluZyBlbGVtKSB7\nCiAgICAgICAgcmV0dXJuIGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0\nRm9yZWlnbktleShlbGVtKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBz\nZWxlY3RFbGVtZW50KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBlbGVtLAog\nICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgaW50IGVhZ2VyTW9kZSwKICAgICAgICBKb2lucyBqb2lucykg\newogICAgICAgIHNlbC5zZWxlY3QoZWxlbSwgZmllbGQuZ2V0RWxlbWVudE1h\ncHBpbmcoKS5nZXRTZWxlY3RTdWJjbGFzc2VzKCksCiAgICAgICAgICAgIHN0\nb3JlLCBmZXRjaCwgZWFnZXJNb2RlLCBqb2lucyk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIE9iamVjdCBsb2FkRWxlbWVudChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIGVsZW0gPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICBpZiAoZWxl\nbSA9PSBudWxsKQogICAgICAgICAgICBlbGVtID0gZmllbGQuZ2V0RWxlbWVu\ndE1hcHBpbmcoKS5nZXRJbmRlcGVuZGVudFR5cGVNYXBwaW5ncygpWzBdOwog\nICAgICAgIHJldHVybiByZXMubG9hZChlbGVtLCBzdG9yZSwgZmV0Y2gsIGpv\naW5zKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgSm9pbnMgam9pbihKb2lucyBq\nb2lucywgQ2xhc3NNYXBwaW5nIGVsZW0pIHsKICAgICAgICBWYWx1ZU1hcHBp\nbmcgdm0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIEZv\ncmVpZ25LZXkgZmsgPSB2bS5nZXRGb3JlaWduS2V5KGVsZW0pOwogICAgICAg\nIENsYXNzTWFwcGluZyBvd25lciA9IGZpZWxkLmdldERlZmluaW5nTWFwcGlu\nZygpOwogICAgICAgIHdoaWxlIChmay5nZXRQcmltYXJ5S2V5VGFibGUoKSAh\nPSBvd25lci5nZXRUYWJsZSgpKSB7CiAgICAgICAgICAgIGpvaW5zID0gb3du\nZXIuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAg\nb3duZXIgPSBvd25lci5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmco\nKTsgCiAgICAgICAgICAgIGlmIChvd25lciA9PSBudWxsKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBqb2lucy5qb2luUmVsYXRpb24oZmllbGQuZ2V0\nTmFtZSgpLCBmaywgZWxlbSwgCiAgICAgICAgICAgIHZtLmdldFNlbGVjdFN1\nYmNsYXNzZXMoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJvdGVjdGVk\nIEpvaW5zIGpvaW5FbGVtZW50UmVsYXRpb24oSm9pbnMgam9pbnMsIENsYXNz\nTWFwcGluZyBlbGVtKSB7CiAgICAgICAgcmV0dXJuIGpvaW5SZWxhdGlvbihq\nb2lucywgZmFsc2UsIGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBt\nYXAoYm9vbGVhbiBhZGFwdCkgewogICAgICAgIGZpZWxkLmdldFZhbHVlSW5m\nbygpLmFzc2VydE5vU2NoZW1hQ29tcG9uZW50cyhmaWVsZCwgIWFkYXB0KTsK\nICAgICAgICBmaWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VmFsdWVJbmZvKCku\nYXNzZXJ0Tm9TY2hlbWFDb21wb25lbnRzCiAgICAgICAgICAgIChmaWVsZC5n\nZXRLZXkoKSwgIWFkYXB0KTsKCiAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0g\nPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIGlmIChlbGVt\nLmdldFR5cGVDb2RlKCkgIT0gSmF2YVR5cGVzLlBDIHx8IGVsZW0uaXNFbWJl\nZGRlZFBDKCkKICAgICAgICAgICAgfHwgIWVsZW0uZ2V0VHlwZU1hcHBpbmco\nKS5pc01hcHBlZCgpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFF\neGNlcHRpb24oX2xvYy5nZXQoIm5vdC1lbGVtLXJlbGF0aW9uIiwgZmllbGQp\nKTsKCiAgICAgICAgLy8gY2hlY2sgZm9yIG5hbWVkIGludmVyc2UKICAgICAg\nICBGaWVsZE1hcHBpbmcgbWFwcGVkID0gZmllbGQuZ2V0TWFwcGVkQnlNYXBw\naW5nKCk7CiAgICAgICAgRmllbGRNYXBwaW5nSW5mbyBmaW5mbyA9IGZpZWxk\nLmdldE1hcHBpbmdJbmZvKCk7CiAgICAgICAgVmFsdWVNYXBwaW5nSW5mbyB2\naW5mbyA9IGVsZW0uZ2V0VmFsdWVJbmZvKCk7CiAgICAgICAgYm9vbGVhbiBj\ncml0ZXJpYSA9IHZpbmZvLmdldFVzZUNsYXNzQ3JpdGVyaWEoKTsKICAgICAg\nICBpZiAobWFwcGVkICE9IG51bGwpIHsKICAgICAgICAgICAgbWFwcGVkLnJl\nc29sdmUobWFwcGVkLk1PREVfTUVUQSB8IG1hcHBlZC5NT0RFX01BUFBJTkcp\nOwogICAgICAgICAgICBpZiAoIShtYXBwZWQuZ2V0U3RyYXRlZ3koKSBpbnN0\nYW5jZW9mIFJlbGF0aW9uRmllbGRTdHJhdGVneSkpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1p\nbnYtcmVsYXRpb24iLAogICAgICAgICAgICAgICAgICAgIGZpZWxkLCBtYXBw\nZWQpKTsKICAgICAgICAgICAgdmluZm8uYXNzZXJ0Tm9TY2hlbWFDb21wb25l\nbnRzKGVsZW0sICFhZGFwdCk7CiAgICAgICAgICAgIGVsZW0uc2V0Rm9yZWln\nbktleShtYXBwZWQuZ2V0Rm9yZWlnbktleQogICAgICAgICAgICAgICAgKGZp\nZWxkLmdldERlZmluaW5nTWFwcGluZygpKSk7CiAgICAgICAgICAgIGVsZW0u\nc2V0Q29sdW1ucyhtYXBwZWQuZ2V0RGVmaW5pbmdNYXBwaW5nKCkuCiAgICAg\nICAgICAgICAgICBnZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICAg\nICAgZWxlbS5zZXRKb2luRGlyZWN0aW9uKFZhbHVlTWFwcGluZy5KT0lOX0VY\nUEVDVEVEX0lOVkVSU0UpOwogICAgICAgICAgICBlbGVtLnNldFVzZUNsYXNz\nQ3JpdGVyaWEoY3JpdGVyaWEpOwoKICAgICAgICAgICAgRm9yZWlnbktleSBm\nayA9IG1hcHBlZC5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgICAgIC8qKiBG\nb3JlaWduIGtleSBtYXkgYmUgbnVsbCBpZiBkZWNsYXJlZCB0eXBlIG9mIHRo\nZSBtYXBwZWQgZmllbGQgaXMgCiAgICAgICAgICAgICAqIGFic3RyYWN0IGFu\nZCB1bmRlciB0YWJsZS1wZXItY2xhc3MgaW5oZXJpdGFuY2Ugc3RyYXRlZ3kg\nd2lsbCBoYXZlCiAgICAgICAgICAgICAqIG5vIG1hcHBlZCB0YWJsZS4gIAog\nICAgICAgICAgICAgKi8KICAgICAgICAgICAgaWYgKGZrICE9IG51bGwpIHsK\nICAgICAgICAgICAgCWZpZWxkLnNldE9yZGVyQ29sdW1uKGZpbmZvLmdldE9y\nZGVyQ29sdW1uKGZpZWxkLAogICAgICAgICAgICAJCQlmay5nZXRUYWJsZSgp\nLCBhZGFwdCkpOwogICAgICAgICAgICAJZmllbGQuc2V0T3JkZXJDb2x1bW5J\nTyhmaW5mby5nZXRDb2x1bW5JTygpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBtYXAgaW52ZXJz\nZSBmb3JlaWduIGtleSBpbiByZWxhdGVkIHRhYmxlCiAgICAgICAgRm9yZWln\nbktleSBmayA9IHZpbmZvLmdldEludmVyc2VUeXBlSm9pbihlbGVtLCBmaWVs\nZC5nZXROYW1lKCksIGFkYXB0KTsKICAgICAgICBlbGVtLnNldEZvcmVpZ25L\nZXkoZmspOwogICAgICAgIGVsZW0uc2V0Q29sdW1uSU8odmluZm8uZ2V0Q29s\ndW1uSU8oKSk7CiAgICAgICAgZWxlbS5zZXRDb2x1bW5zKGVsZW0uZ2V0VHlw\nZU1hcHBpbmcoKS5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAgICAgICBl\nbGVtLnNldEpvaW5EaXJlY3Rpb24oVmFsdWVNYXBwaW5nLkpPSU5fRVhQRUNU\nRURfSU5WRVJTRSk7CiAgICAgICAgZWxlbS5zZXRVc2VDbGFzc0NyaXRlcmlh\nKGNyaXRlcmlhKTsKICAgICAgICBlbGVtLm1hcENvbnN0cmFpbnRzKGZpZWxk\nLmdldE5hbWUoKSwgYWRhcHQpOwoKICAgICAgICBmaWVsZC5zZXRPcmRlckNv\nbHVtbihmaW5mby5nZXRPcmRlckNvbHVtbihmaWVsZCwgZmsuZ2V0VGFibGUo\nKSwKICAgICAgICAgICAgYWRhcHQpKTsKICAgICAgICBmaWVsZC5zZXRPcmRl\nckNvbHVtbklPKGZpbmZvLmdldENvbHVtbklPKCkpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGluaXRpYWxpemUoKSB7CiAgICAgICAgQ29sdW1uIG9yZGVy\nID0gZmllbGQuZ2V0T3JkZXJDb2x1bW4oKTsKICAgICAgICBfb3JkZXJJbnNl\ncnQgPSBmaWVsZC5nZXRPcmRlckNvbHVtbklPKCkuaXNJbnNlcnRhYmxlKG9y\nZGVyLCBmYWxzZSk7CiAgICAgICAgX29yZGVyVXBkYXRlID0gZmllbGQuZ2V0\nT3JkZXJDb2x1bW5JTygpLmlzVXBkYXRhYmxlKG9yZGVyLCBmYWxzZSk7Cgog\nICAgICAgIFZhbHVlTWFwcGluZyBlbGVtID0gZmllbGQuZ2V0RWxlbWVudE1h\ncHBpbmcoKTsKICAgICAgICBMb2cgbG9nID0gZmllbGQuZ2V0UmVwb3NpdG9y\neSgpLmdldExvZygpOwogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgp\nID09IG51bGwKICAgICAgICAgICAgJiYgZWxlbS5nZXRVc2VDbGFzc0NyaXRl\ncmlhKCkgJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAgICBG\nb3JlaWduS2V5IGZrID0gZWxlbS5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAg\nICAgIGlmIChlbGVtLmdldENvbHVtbklPKCkuaXNBbnlVcGRhdGFibGUoZmss\nIGZhbHNlKSkKICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJj\nbGFzcy1jcml0LW93bmVyIiwgZmllbGQpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgaW5zZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIEpEQkNTdG9yZSBzdG9yZSwgUm93TWFuYWdlciBybSkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGVk\nQnkoKSA9PSBudWxsIHx8IF9vcmRlckluc2VydCB8fCBfb3JkZXJVcGRhdGUp\nCiAgICAgICAgICAgIGluc2VydChzbSwgcm0sIHNtLmZldGNoT2JqZWN0KGZp\nZWxkLmdldEluZGV4KCkpKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5z\nZXJ0KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIFJvd01hbmFnZXIgcm0sIE9i\namVjdCB2YWxzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpICE9IG51bGwgJiYgIV9vcmRl\nckluc2VydCAmJiAhX29yZGVyVXBkYXRlKQogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gdG9Db2xsZWN0aW9uKHZhbHMp\nOwogICAgICAgIGlmIChjb2xsID09IG51bGwgfHwgY29sbC5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgQ2xhc3NNYXBwaW5nIHJl\nbCA9IGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmco\nKTsKICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IGNvbGwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsgaWR4Kysp\nCiAgICAgICAgICAgIHVwZGF0ZUludmVyc2Uoc20uZ2V0Q29udGV4dCgpLCBp\ndHIubmV4dCgpLCByZWwsIHJtLCBzbSwgaWR4KTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB1cGRhdGUoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgSkRCQ1N0\nb3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBwZWRCeSgpICE9\nIG51bGwgJiYgIV9vcmRlckluc2VydCAmJiAhX29yZGVyVXBkYXRlKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIE9iamVjdCBvYmogPSBzbS5mZXRj\naE9iamVjdChmaWVsZC5nZXRJbmRleCgpKTsKICAgICAgICBDaGFuZ2VUcmFj\na2VyIGN0ID0gbnVsbDsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgUHJv\neHkpIHsKICAgICAgICAgICAgUHJveHkgcHJveHkgPSAoUHJveHkpIG9iajsK\nICAgICAgICAgICAgaWYgKFByb3hpZXMuaXNPd25lcihwcm94eSwgc20sIGZp\nZWxkLmdldEluZGV4KCkpKQogICAgICAgICAgICAgICAgY3QgPSBwcm94eS5n\nZXRDaGFuZ2VUcmFja2VyKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBu\nbyBmaW5lLWdyYWluZWQgY2hhbmdlIHRyYWNraW5nIHRoZW4ganVzdCBkZWxl\ndGUgYW5kIHJlaW5zZXJ0CiAgICAgICAgaWYgKGN0ID09IG51bGwgfHwgIWN0\nLmlzVHJhY2tpbmcoKSkgewogICAgICAgICAgICBkZWxldGUoc20sIHN0b3Jl\nLCBybSk7CiAgICAgICAgICAgIGluc2VydChzbSwgcm0sIG9iaik7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG51bGwgaW52\nZXJzZSBjb2x1bW5zIGZvciBkZWxldGVzIGFuZCB1cGRhdGUgdGhlbSB3aXRo\nIG91ciBvaWQgZm9yCiAgICAgICAgLy8gaW5zZXJ0cwogICAgICAgIENsYXNz\nTWFwcGluZyByZWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5\ncGVNYXBwaW5nKCk7CiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHN0b3Jl\nLmdldENvbnRleHQoKTsKICAgICAgICBpZiAoZmllbGQuZ2V0TWFwcGVkQnko\nKSA9PSBudWxsKSB7CiAgICAgICAgICAgIENvbGxlY3Rpb24gcmVtID0gY3Qu\nZ2V0UmVtb3ZlZCgpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9\nIHJlbS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAg\nICAgIHVwZGF0ZUludmVyc2UoY3R4LCBpdHIubmV4dCgpLCByZWwsIHJtLCBu\ndWxsLCAwKTsKICAgICAgICB9CgogICAgICAgIENvbGxlY3Rpb24gYWRkID0g\nY3QuZ2V0QWRkZWQoKTsKICAgICAgICBpbnQgc2VxID0gY3QuZ2V0TmV4dFNl\ncXVlbmNlKCk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhZGQuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTsgc2VxKyspCiAgICAgICAgICAgIHVw\nZGF0ZUludmVyc2UoY3R4LCBpdHIubmV4dCgpLCByZWwsIHJtLCBzbSwgc2Vx\nKTsKICAgICAgICBpZiAoZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxs\nKQogICAgICAgICAgICBjdC5zZXROZXh0U2VxdWVuY2Uoc2VxKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBSb3dNYW5hZ2VyIHJtKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChmaWVsZC5nZXRNYXBw\nZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nLy8gaWYgbnVsbGFibGUsIG51bGwgYW55IGV4aXN0aW5nIGludmVyc2UgY29s\ndW1ucyB0aGF0IHJlZmVyIHRvIHRoaXMgb2JqCiAgICAgICAgVmFsdWVNYXBw\naW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAg\nIENvbHVtbklPIGlvID0gZWxlbS5nZXRDb2x1bW5JTygpOwogICAgICAgIEZv\ncmVpZ25LZXkgZmsgPSBlbGVtLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBp\nZiAoIWVsZW0uZ2V0VXNlQ2xhc3NDcml0ZXJpYSgpICYmIGlvLmlzQW55VXBk\nYXRhYmxlKGZrLCB0cnVlKSkgeyAKICAgICAgICAgICAgYXNzZXJ0SW52ZXJz\nYWJsZSgpOwogICAgICAgICAgICBSb3cgcm93ID0gcm0uZ2V0QWxsUm93cyhm\nay5nZXRUYWJsZSgpLCBSb3cuQUNUSU9OX1VQREFURSk7CiAgICAgICAgICAg\nIHJvdy5zZXRGb3JlaWduS2V5KGZrLCBpbywgbnVsbCk7CiAgICAgICAgICAg\nIHJvdy53aGVyZUZvcmVpZ25LZXkoZmssIHNtKTsKICAgICAgICAgICAgcm0u\nZmx1c2hBbGxSb3dzKHJvdyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIGlmICghc20uZ2V0TG9hZGVkKCkuZ2V0KGZpZWxkLmdl\ndEluZGV4KCkpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHVw\nZGF0ZSBmayBvbiBlYWNoIGZpZWxkIHZhbHVlIHJvdwogICAgICAgIENsYXNz\nTWFwcGluZyByZWwgPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdldFR5\ncGVNYXBwaW5nKCk7CiAgICAgICAgU3RvcmVDb250ZXh0IGN0eCA9IHN0b3Jl\nLmdldENvbnRleHQoKTsKICAgICAgICBDb2xsZWN0aW9uIG9ianMgPSB0b0Nv\nbGxlY3Rpb24oc20uZmV0Y2hPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSkpOwog\nICAgICAgIGlmIChvYmpzICE9IG51bGwgJiYgIW9ianMuaXNFbXB0eSgpKQog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICB1cGRhdGVJbnZl\ncnNlIChjdHgsIGl0ci5uZXh0KCksIHJlbCwgcm0sIHNtLCAwKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIHVwZGF0ZXMgdGhlIGludmVy\nc2UgY29sdW1ucyBvZiBhIDEtTSByZWxhdGVkIG9iamVjdAogICAgICogd2l0\naCB0aGUgZ2l2ZW4gb2lkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdXBk\nYXRlSW52ZXJzZShTdG9yZUNvbnRleHQgY3R4LCBPYmplY3QgaW52ZXJzZSwK\nICAgICAgICBDbGFzc01hcHBpbmcgcmVsLCBSb3dNYW5hZ2VyIHJtLCBPcGVu\nSlBBU3RhdGVNYW5hZ2VyIHNtLCBpbnQgaWR4KQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgaW52\nc20gPSBSZWxhdGlvblN0cmF0ZWdpZXMuZ2V0U3RhdGVNYW5hZ2VyKGludmVy\nc2UsCiAgICAgICAgICAgIGN0eCk7CiAgICAgICAgaWYgKGludnNtID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWVNYXBwaW5n\nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAgICAgIEZv\ncmVpZ25LZXkgZmsgPSBlbGVtLmdldEZvcmVpZ25LZXkoKTsKICAgICAgICBD\nb2x1bW5JTyBpbyA9IGVsZW0uZ2V0Q29sdW1uSU8oKTsKICAgICAgICBDb2x1\nbW4gb3JkZXIgPSBmaWVsZC5nZXRPcmRlckNvbHVtbigpOwoKICAgICAgICBp\nbnQgYWN0aW9uOwogICAgICAgIGJvb2xlYW4gd3JpdGVhYmxlOwogICAgICAg\nIGJvb2xlYW4gb3JkZXJXcml0ZWFibGU7CiAgICAgICAgaWYgKGludnNtLmlz\nTmV3KCkgJiYgIWludnNtLmlzRmx1c2hlZCgpKSB7CiAgICAgICAgICAgIC8v\nIG5vIG5lZWQgdG8gbnVsbCBpbnZlcnNlIGNvbHVtbnMgb2YgbmV3IGluc3Rh\nbmNlCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsIHx8IHNtLmlzRGVsZXRl\nZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB3cml0\nZWFibGUgPSBpby5pc0FueUluc2VydGFibGUoZmssIGZhbHNlKTsKICAgICAg\nICAgICAgb3JkZXJXcml0ZWFibGUgPSBfb3JkZXJJbnNlcnQ7CiAgICAgICAg\nICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05fSU5TRVJUOwogICAgICAgIH0gZWxz\nZSBpZiAoaW52c20uaXNEZWxldGVkKCkpIHsKICAgICAgICAgICAgLy8gbm8g\nbmVlZCB0byBudWxsIGludmVyc2UgY29sdW1ucyBvZiBkZWxldGVkIGluc3Rh\nbmNlCiAgICAgICAgICAgIGlmIChpbnZzbS5pc0ZsdXNoZWQoKSB8fCBzbSA9\nPSBudWxsIHx8ICFzbS5pc0RlbGV0ZWQoKSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgd3JpdGVhYmxlID0gdHJ1ZTsKICAgICAgICAg\nICAgb3JkZXJXcml0ZWFibGUgPSBmYWxzZTsKICAgICAgICAgICAgYWN0aW9u\nID0gUm93LkFDVElPTl9ERUxFVEU7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uaXNEZWxldGVkKCkpCiAgICAg\nICAgICAgICAgICBzbSA9IG51bGw7CiAgICAgICAgICAgIHdyaXRlYWJsZSA9\nIGlvLmlzQW55VXBkYXRhYmxlKGZrLCBzbSA9PSBudWxsKTsKICAgICAgICAg\nICAgb3JkZXJXcml0ZWFibGUgPSBmaWVsZC5nZXRPcmRlckNvbHVtbklPKCku\naXNVcGRhdGFibGUKICAgICAgICAgICAgICAgIChvcmRlciwgc20gPT0gbnVs\nbCk7CiAgICAgICAgICAgIGFjdGlvbiA9IFJvdy5BQ1RJT05fVVBEQVRFOwog\nICAgICAgIH0KICAgICAgICBpZiAoIXdyaXRlYWJsZSAmJiAhb3JkZXJXcml0\nZWFibGUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYXNzZXJ0SW52\nZXJzYWJsZSgpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGFuIHVwZGF0ZSwg\ndGhpcyBtaWdodCBiZSB0aGUgb25seSBtb2QgdG8gdGhlIHJvdywgc28KICAg\nICAgICAvLyBtYWtlIHN1cmUgdGhlIHdoZXJlIGNvbmRpdGlvbiBpcyBzZXQK\nICAgICAgICBSb3cgcm93ID0gcm0uZ2V0Um93KGZrLmdldFRhYmxlKCksIGFj\ndGlvbiwgaW52c20sIHRydWUpOwogICAgICAgIGlmIChhY3Rpb24gPT0gUm93\nLkFDVElPTl9VUERBVEUpCiAgICAgICAgICAgIHJvdy53aGVyZVByaW1hcnlL\nZXkoaW52c20pOwoKICAgICAgICAvLyB1cGRhdGUgdGhlIGludmVyc2UgcG9p\nbnRlciB3aXRoIG91ciBvaWQgdmFsdWUKICAgICAgICBpZiAod3JpdGVhYmxl\nKQogICAgICAgICAgICByb3cuc2V0Rm9yZWlnbktleShmaywgaW8sIHNtKTsK\nICAgICAgICBpZiAob3JkZXJXcml0ZWFibGUpCiAgICAgICAgICAgIHJvdy5z\nZXRJbnQob3JkZXIsIGlkeCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB0\nb0RhdGFTdG9yZVZhbHVlKE9iamVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkg\newogICAgICAgIENsYXNzTWFwcGluZyBjbSA9IGZpZWxkLmdldEVsZW1lbnRN\nYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICByZXR1cm4gY20u\ndG9EYXRhU3RvcmVWYWx1ZSh2YWwsIGNtLmdldFByaW1hcnlLZXlDb2x1bW5z\nKCksIHN0b3JlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbihKb2lu\ncyBqb2lucywgYm9vbGVhbiBmb3JjZU91dGVyKSB7CiAgICAgICAgVmFsdWVN\nYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwogICAg\nICAgIENsYXNzTWFwcGluZ1tdIGNsc3MgPSBlbGVtLmdldEluZGVwZW5kZW50\nVHlwZU1hcHBpbmdzKCk7CiAgICAgICAgaWYgKGNsc3MubGVuZ3RoICE9IDEp\nCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRlZ2llcy51bmpvaW5h\nYmxlKGVsZW0pOwogICAgICAgIGlmIChmb3JjZU91dGVyKQogICAgICAgICAg\nICByZXR1cm4gam9pbnMub3V0ZXJKb2luUmVsYXRpb24oZmllbGQuZ2V0TmFt\nZSgpLCAKICAgICAgICAgICAgICAgIGVsZW0uZ2V0Rm9yZWlnbktleShjbHNz\nWzBdKSwgY2xzc1swXSwKICAgICAgICAgICAgICAgIGVsZW0uZ2V0U2VsZWN0\nU3ViY2xhc3NlcygpLCB0cnVlLCB0cnVlKTsKICAgICAgICByZXR1cm4gam9p\nbnMuam9pblJlbGF0aW9uKGZpZWxkLmdldE5hbWUoKSwgZWxlbS5nZXRGb3Jl\naWduS2V5KGNsc3NbMF0pLAogICAgICAgICAgICBjbHNzWzBdLCBlbGVtLmdl\ndFNlbGVjdFN1YmNsYXNzZXMoKSwgdHJ1ZSwgdHJ1ZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGFzc2VydEludmVyc2FibGUoKSB7CiAgICAgICAgVmFs\ndWVNYXBwaW5nIGVsZW0gPSBmaWVsZC5nZXRFbGVtZW50TWFwcGluZygpOwog\nICAgICAgIGlmIChlbGVtLmdldEluZGVwZW5kZW50VHlwZU1hcHBpbmdzKCku\nbGVuZ3RoICE9IDEpCiAgICAgICAgICAgIHRocm93IFJlbGF0aW9uU3RyYXRl\nZ2llcy51bmludmVyc2FibGUoZWxlbSk7CiAgICB9Cn0K\n","encoding":"base64"}

