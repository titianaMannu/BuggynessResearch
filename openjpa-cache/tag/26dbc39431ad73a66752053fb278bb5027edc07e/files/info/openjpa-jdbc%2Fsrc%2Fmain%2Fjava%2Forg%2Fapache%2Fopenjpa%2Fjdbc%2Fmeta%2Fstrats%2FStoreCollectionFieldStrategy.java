{"sha":"52a72d33dd1edb81eaf76f7164deafe7fad7021b","node_id":"MDQ6QmxvYjIwNjM2NDo1MmE3MmQzM2RkMWVkYjgxZWFmNzZmNzE2NGRlYWZlN2ZhZDcwMjFi","size":23929,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/52a72d33dd1edb81eaf76f7164deafe7fad7021b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0czsK\nCmltcG9ydCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuZW5oYW5jZS5QZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5K\nREJDU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5GaWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMubWV0YS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLnNxbC5TZWxlY3RFeGVjdXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5VbmlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2hhbmdlVHJhY2tlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuUHJveHk7CgovKioKICogQmFzZSBjbGFzcyBm\nb3Igc3RyYXRlZ2llcyB0aGF0IGFyZSBzdG9yZWQgYXMgYSBjb2xsZWN0aW9u\nLCBldmVuIGlmCiAqIHRoZWlyIGZpZWxkIHZhbHVlIGlzIHNvbWV0aGluZyBl\nbHNlLiBIYW5kbGVzIGRhdGEgbG9hZGluZyBhbmQgYmFzaWMgcXVlcnkKICog\nZnVuY3Rpb25hbGl0eS4gU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudCBhYnN0\ncmFjdCBtZXRob2RzIGFuZAogKiBpbnNlcnQvdXBkYXRlL2RlbGV0ZSBiZWhh\ndmlvciBhcyB3ZWxsIGFzIG92ZXJyaWRpbmcKICoge0BsaW5rIEZpZWxkU3Ry\nYXRlZ3kjdG9EYXRhU3RvcmVWYWx1ZX0sIHtAbGluayBGaWVsZFN0cmF0ZWd5\nI2pvaW59LCBhbmQKICoge0BsaW5rIEZpZWxkU3RyYXRlZ3kjam9pblJlbGF0\naW9ufSBpZiBuZWNlc3NhcnkuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAq\nLwpwdWJsaWMgYWJzdHJhY3QgY2xhc3MgU3RvcmVDb2xsZWN0aW9uRmllbGRT\ndHJhdGVneQogICAgZXh0ZW5kcyBDb250YWluZXJGaWVsZFN0cmF0ZWd5IHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExv\nY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFN0b3JlQ29sbGVjdGlvbkZp\nZWxkU3RyYXRlZ3kuY2xhc3MpOwogICAgCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZm9yZWlnbiBrZXkgdXNlZCB0byBqb2luIHRvIHRoZSBvd25pbmcg\nZmllbGQgZm9yIHRoZSBnaXZlbgogICAgICogZWxlbWVudCBtYXBwaW5nIGZy\nb20ge0BsaW5rICNnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5nc30gKG9y\nIG51bGwpLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgRm9yZWln\nbktleSBnZXRKb2luRm9yZWlnbktleShDbGFzc01hcHBpbmcgZWxlbSk7Cgog\nICAgLyoqCiAgICAgKiBJbXBsZW1lbnQgdGhpcyBtZXRob2QgdG8gc2VsZWN0\nIHRoZSBlbGVtZW50cyBvZiB0aGlzIGZpZWxkIGZvciB0aGUKICAgICAqIGdp\ndmVuIGVsZW1lbnQgbWFwcGluZyBmcm9tIHtAbGluayAjZ2V0SW5kZXBlbmRl\nbnRFbGVtZW50TWFwcGluZ3N9CiAgICAgKiAob3IgbnVsbCkuIEVsZW1lbnRz\nIG9mIHRoZSByZXN1bHQgd2lsbCBiZSBsb2FkZWQgd2l0aAogICAgICoge0Bs\naW5rICNsb2FkRWxlbWVudH0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0\ncmFjdCB2b2lkIHNlbGVjdEVsZW1lbnQoU2VsZWN0IHNlbCwgQ2xhc3NNYXBw\naW5nIGVsZW0sCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXJNb2RlLAogICAgICAgIEpv\naW5zIGpvaW5zKTsKCiAgICAvKioKICAgICAqIExvYWQgYW4gZWxlbWVudCBv\nZiB0aGUgY29sbGVjdGlvbi4gVGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgbWln\naHQgYmUKICAgICAqIG51bGwgaWYgdGhlIGxvYWQgaXMgZm9yIGEgcHJvamVj\ndGlvbiBvciBmb3IgcHJvY2Vzc2luZyBlYWdlciBwYXJhbGxlbAogICAgICog\ncmVzdWx0cy4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3RyYWN0IE9iamVj\ndCBsb2FkRWxlbWVudChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgUmVzdWx0IHJlcywgSm9pbnMgam9pbnMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbjsKCiAgICAvKioKICAgICAqIEpvaW4gdGhpcyB2YWx1ZSdz\nIHRhYmxlIHRvIHRoZSB0YWJsZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbWFw\ncGluZwogICAgICogZnJvbSB7QGxpbmsgI2dldEluZGVwZW5kZW50RWxlbWVu\ndE1hcHBpbmdzfSAob3IgbnVsbCkuCiAgICAgKgogICAgICogQHNlZSBGaWVs\nZE1hcHBpbmcjam9pblJlbGF0aW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCBh\nYnN0cmFjdCBKb2lucyBqb2luRWxlbWVudFJlbGF0aW9uKEpvaW5zIGpvaW5z\nLAogICAgICAgIENsYXNzTWFwcGluZyBlbGVtKTsKCiAgICAvKioKICAgICAq\nIEpvaW4gdG8gdGhlIG93bmluZyBmaWVsZCB0YWJsZSBmb3IgdGhlIGdpdmVu\nIGVsZW1lbnQgbWFwcGluZyBmcm9tCiAgICAgKiB7QGxpbmsgI2dldEluZGVw\nZW5kZW50RWxlbWVudE1hcHBpbmdzfSAob3IgbnVsbCkuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBhYnN0cmFjdCBKb2lucyBqb2luKEpvaW5zIGpvaW5zLCBD\nbGFzc01hcHBpbmcgZWxlbSk7CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBs\nYXJnZSByZXN1bHQgc2V0IHByb3h5IGZvciB0aGlzIGZpZWxkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgUHJveHkgbmV3TFJTUHJveHkoKTsK\nCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGZpZWxkIHZhbHVlIHRvIGEg\nY29sbGVjdGlvbi4gSGFuZGxlcyBjb2xsZWN0aW9ucyBhbmQKICAgICAqIGFy\ncmF5cyBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ29sbGVj\ndGlvbiB0b0NvbGxlY3Rpb24oT2JqZWN0IHZhbCkgewogICAgICAgIGlmIChm\naWVsZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5DT0xMRUNUSU9OKQog\nICAgICAgICAgICByZXR1cm4gKENvbGxlY3Rpb24pIHZhbDsKICAgICAgICBy\nZXR1cm4gSmF2YVR5cGVzLnRvTGlzdCh2YWwsIGZpZWxkLmdldEVsZW1lbnQo\nKS5nZXRUeXBlKCksIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCBhbiBpdGVtIHRvIHRoZSBkYXRhIHN0cnVjdHVyZSByZXByZXNlbnRpbmcg\nYSBmaWVsZCB2YWx1ZS4KICAgICAqIEJ5IGRlZmF1bHQsIGFzc3VtZXMgdGhl\nIHN0cnVjdHVyZSBpcyBhIGNvbGxlY3Rpb24uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGFkZChKREJDU3RvcmUgc3RvcmUsIE9iamVjdCBjb2xsLCBP\nYmplY3Qgb2JqKSB7CiAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsKS5hZGQo\nb2JqKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZpcnN0\nIGluZGVwZW5kZW50IGVsZW1lbnQgbWFwcGluZywgb3IgbnVsbC4KICAgICAq\nLwogICAgcHJpdmF0ZSBDbGFzc01hcHBpbmcgZ2V0RGVmYXVsdEVsZW1lbnRN\nYXBwaW5nKGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICBDbGFzc01hcHBp\nbmdbXSBlbGVtcyA9IGdldEluZGVwZW5kZW50RWxlbWVudE1hcHBpbmdzKHRy\nYXZlcnNlKTsKICAgICAgICByZXR1cm4gKGVsZW1zLmxlbmd0aCA9PSAwKSA/\nIG51bGwgOiBlbGVtc1swXTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHN1cHBv\ncnRzU2VsZWN0KFNlbGVjdCBzZWwsIGludCB0eXBlLCBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmaWVsZC5pc0xS\nUygpKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAodHlwZSA9\nPSBTZWxlY3QuRUFHRVJfUEFSQUxMRUwpCiAgICAgICAgICAgIHJldHVybiBN\nYXRoLm1heCgxLCBnZXRJbmRlcGVuZGVudEVsZW1lbnRNYXBwaW5ncyh0cnVl\nKS5sZW5ndGgpOwogICAgICAgIGlmICh0eXBlICE9IFNlbGVjdC5FQUdFUl9J\nTk5FUiAmJiB0eXBlICE9IFNlbGVjdC5FQUdFUl9PVVRFUikKICAgICAgICAg\nICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKGdldEluZGVwZW5kZW50RWxlbWVu\ndE1hcHBpbmdzKHRydWUpLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIHJldHVy\nbiAwOwogICAgICAgIHJldHVybiAodHlwZSA9PSBTZWxlY3QuRUFHRVJfSU5O\nRVIgfHwgc3RvcmUuZ2V0REJEaWN0aW9uYXJ5KCkuCiAgICAgICAgICAgIGNh\nbk91dGVySm9pbihzZWwuZ2V0Sm9pblN5bnRheCgpLCBnZXRKb2luRm9yZWln\nbktleQogICAgICAgICAgICAgICAgKGdldERlZmF1bHRFbGVtZW50TWFwcGlu\nZyhmYWxzZSkpKSkgPyAxIDogMDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZWxlY3RFYWdlclBhcmFsbGVsKFNlbGVjdEV4ZWN1dG9yIHNlbCwKICAgICAg\nICBmaW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJDU3Rv\ncmUgc3RvcmUsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgZmluYWwgaW50IGVhZ2VyTW9kZSkgewogICAgICAgIGlmICgh\nKHNlbCBpbnN0YW5jZW9mIFVuaW9uKSkKICAgICAgICAgICAgc2VsZWN0RWFn\nZXIoKFNlbGVjdCkgc2VsLCBnZXREZWZhdWx0RWxlbWVudE1hcHBpbmcodHJ1\nZSksIHNtLAogICAgICAgICAgICAgICAgc3RvcmUsIGZldGNoLCBlYWdlck1v\nZGUsIHRydWUsIGZhbHNlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nZmluYWwgQ2xhc3NNYXBwaW5nW10gZWxlbXMgPSBnZXRJbmRlcGVuZGVudEVs\nZW1lbnRNYXBwaW5ncyh0cnVlKTsKICAgICAgICAgICAgVW5pb24gdW5pb24g\nPSAoVW5pb24pIHNlbDsKICAgICAgICAgICAgaWYgKGZldGNoLmdldFN1YmNs\nYXNzRmV0Y2hNb2RlKGZpZWxkLmdldEVsZW1lbnRNYXBwaW5nKCkuCiAgICAg\nICAgICAgICAgICBnZXRUeXBlTWFwcGluZygpKSAhPSBmZXRjaC5FQUdFUl9K\nT0lOKQogICAgICAgICAgICAgICAgdW5pb24uYWJvcnRVbmlvbigpOwogICAg\nICAgICAgICB1bmlvbi5zZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWws\nIGludCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RFYWdlcihz\nZWwsIGVsZW1zW2lkeF0sIHNtLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyTW9kZSwg\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNlbGVjdEVhZ2VySm9pbihTZWxlY3Qgc2VsLCBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyTW9k\nZSkgewogICAgICAgIC8vIHdlIGxpbWl0IGZ1cnRoZXIgZWFnZXIgZmV0Y2hl\ncyB0byBqb2lucywgYmVjYXVzZSBhZnRlciB0aGlzIHBvaW50CiAgICAgICAg\nLy8gdGhlIHNlbGVjdCBoYXMgYmVlbiBtb2RpZmllZCBzdWNoIHRoYXQgcGFy\nYWxsZWwgY2xvbmVzIG1heSBwcm9kdWNlCiAgICAgICAgLy8gaW52YWxpZCBz\ncWwKICAgICAgICBib29sZWFuIG91dGVyID0gZmllbGQuZ2V0TnVsbFZhbHVl\nKCkgIT0gRmllbGRNYXBwaW5nLk5VTExfRVhDRVBUSU9OOwogICAgICAgIC8v\nIGZvcmNlIGlubmVyIGpvaW4gZm9yIGlubmVyIGpvaW4gZmV0Y2ggCiAgICAg\nICAgaWYgKGZldGNoLmhhc0ZldGNoSW5uZXJKb2luKGZpZWxkLmdldEZ1bGxO\nYW1lKGZhbHNlKSkpCiAgICAgICAgICAgIG91dGVyID0gZmFsc2U7CiAgICAg\nICAgc2VsZWN0RWFnZXIoc2VsLCBnZXREZWZhdWx0RWxlbWVudE1hcHBpbmco\ndHJ1ZSksIHNtLCBzdG9yZSwgZmV0Y2gsIAogICAgICAgICAgICBKREJDRmV0\nY2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIGZhbHNlLAogICAgICAgICAg\nICBvdXRlcik7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNFYWdlclNl\nbGVjdFRvTWFueSgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNlbGVjdCBvdXIgZGF0YSBlYWdlcmx5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0RWFnZXIoU2VsZWN0IHNlbCwgQ2xh\nc3NNYXBwaW5nIGVsZW0sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSwgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIGludCBlYWdlck1vZGUsIGJvb2xlYW4gc2VsZWN0T2lk\nLCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgLy8gZm9yY2UgZGlzdGluY3Qg\naWYgdGhlcmUgd2FzIGEgdG8tbWFueSBqb2luIHRvIGF2b2lkIGR1cHMsIGJ1\ndAogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBwYXJhbGxlbCBzZWxlY3QgZG9u\nJ3QgbWFrZSBkaXN0aW5jdCBiYXNlZCBvbiB0aGUKICAgICAgICAvLyBlYWdl\nciBqb2lucyBhbG9uZSBpZiB0aGUgb3JpZ2luYWwgd2Fzbid0IGRpc3RpbmN0\nCiAgICAgICAgaWYgKGVhZ2VyTW9kZSA9PSBKREJDRmV0Y2hDb25maWd1cmF0\naW9uLkVBR0VSX1BBUkFMTEVMKSB7CiAgICAgICAgICAgIGlmIChzZWwuaGFz\nSm9pbih0cnVlKSkKICAgICAgICAgICAgICAgIHNlbC5zZXREaXN0aW5jdCh0\ncnVlKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXNlbC5pc0Rpc3RpbmN0KCkp\nCiAgICAgICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFsc2UpOyAvLyBz\nZXQgZXhwbGljaXRseSBzbyByZW1lbWJlcmVkCiAgICAgICAgfQoKICAgICAg\nICAvLyBzZXQgYSB2YXJpYWJsZSBuYW1lIHRoYXQgZG9lcyBub3QgY29uZmxp\nY3Qgd2l0aCBhbnkgaW4gdGhlIHF1ZXJ5OwogICAgICAgIC8vIHVzaW5nIGEg\ndmFyaWFibGUgZ3VhcmFudGVlcyB0aGF0IHRoZSBzZWxlY3RlZCBkYXRhIHdp\nbGwgdXNlIGRpZmZlcmVudAogICAgICAgIC8vIGFsaWFzZXMgYW5kIGpvaW5z\nIHRoYW4gYW55IGV4aXN0aW5nIFdIRVJFIGNvbmRpdGlvbnMgb24gdGhpcyBm\naWVsZAogICAgICAgIC8vIHRoYXQgbWlnaHQgb3RoZXJ3aXNlIGxpbWl0IHRo\nZSBlbGVtZW50cyBvZiB0aGUgZmllbGQgdGhhdCBtYXRjaAogICAgICAgIGlm\nIChzZWxlY3RPaWQpCiAgICAgICAgICAgIHNlbC5vcmRlckJ5UHJpbWFyeUtl\neShmaWVsZC5nZXREZWZpbmluZ01hcHBpbmcoKSwgdHJ1ZSwgdHJ1ZSk7CiAg\nICAgICAgSm9pbnMgam9pbnMgPSBzZWwubmV3Sm9pbnMoKS5zZXRWYXJpYWJs\nZSgiKiIpOwogICAgICAgIGpvaW5zID0gam9pbihqb2lucywgZWxlbSk7Cgog\nICAgICAgIC8vIG9yZGVyLCByZWYgY29scwogICAgICAgIGlmIChmaWVsZC5n\nZXRPcmRlckNvbHVtbigpICE9IG51bGwgfHwgZmllbGQuZ2V0T3JkZXJzKCku\nbGVuZ3RoID4gMAogICAgICAgICAgICB8fCAhc2VsZWN0T2lkKSB7CiAgICAg\nICAgICAgIGlmIChvdXRlcikKICAgICAgICAgICAgICAgIGpvaW5zID0gc2Vs\nLm91dGVyKGpvaW5zKTsKICAgICAgICAgICAgaWYgKCFzZWxlY3RPaWQpIHsK\nICAgICAgICAgICAgICAgIENvbHVtbltdIHJlZnMgPSBnZXRKb2luRm9yZWln\nbktleShlbGVtKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBpZiAo\ncmVxdWlyZXNPcmRlckJ5KCkpIHsKICAgICAgICAgICAgICAgICAgICBzZWwu\nb3JkZXJCeShyZWZzLCB0cnVlLCBqb2lucywgdHJ1ZSk7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbC5zZWxlY3Qo\ncmVmcywgam9pbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGZpZWxkLm9yZGVyTG9jYWwoc2VsLCBlbGVtLCBqb2lu\ncyk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZWxlY3QgZGF0YQogICAgICAg\nIGpvaW5zID0gam9pbkVsZW1lbnRSZWxhdGlvbihqb2lucywgZWxlbSk7CiAg\nICAgICAgaWYgKG91dGVyKQogICAgICAgICAgICBqb2lucyA9IHNlbC5vdXRl\ncihqb2lucyk7CiAgICAgICAgZmllbGQub3JkZXJSZWxhdGlvbihzZWwsIGVs\nZW0sIGpvaW5zKTsKICAgICAgICBzZWxlY3RFbGVtZW50KHNlbCwgZWxlbSwg\nc3RvcmUsIGZldGNoLCBlYWdlck1vZGUsIGpvaW5zKTsKICAgIH0KCiAgICBw\ndWJsaWMgT2JqZWN0IGxvYWRFYWdlclBhcmFsbGVsKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20sIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBPYmplY3QgcmVzKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIHByb2Nlc3MgYmF0Y2hlZCBy\nZXN1bHRzIGlmIHdlIGhhdmVuJ3QgYWxyZWFkeQogICAgICAgIE1hcCByZWxz\nOwogICAgICAgIGlmIChyZXMgaW5zdGFuY2VvZiBSZXN1bHQpCiAgICAgICAg\nICAgIHJlbHMgPSBwcm9jZXNzRWFnZXJQYXJhbGxlbFJlc3VsdChzbSwgc3Rv\ncmUsIGZldGNoLCAoUmVzdWx0KSByZXMpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgcmVscyA9IChNYXApIHJlczsKCiAgICAgICAgLy8gbG9vayB1cCB0\naGUgY29sbGVjdGlvbiBmb3IgdGhpcyBvaWQsIGFuZCBzdG9yZSBpbiBpbnN0\nYW5jZQogICAgICAgIE9iamVjdCBjb2xsID0gcmVscy5yZW1vdmUoc20uZ2V0\nT2JqZWN0SWQoKSk7CiAgICAgICAgaWYgKGZpZWxkLmdldFR5cGVDb2RlKCkg\nPT0gSmF2YVR5cGVzLkFSUkFZKQogICAgICAgICAgICBzbS5zdG9yZU9iamVj\ndChmaWVsZC5nZXRJbmRleCgpLCBKYXZhVHlwZXMudG9BcnJheQogICAgICAg\nICAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsLCBmaWVsZC5nZXRFbGVtZW50\nKCkuZ2V0VHlwZSgpKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlm\nIChjb2xsID09IG51bGwpCiAgICAgICAgICAgICAgICBjb2xsID0gc20ubmV3\nUHJveHkoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgIHNtLnN0b3Jl\nT2JqZWN0KGZpZWxkLmdldEluZGV4KCksIGNvbGwpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcmVsczsKICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nl\nc3MgdGhlIGdpdmVuIGJhdGNoZWQgcmVzdWx0LgogICAgICovCiAgICBwcml2\nYXRlIE1hcCBwcm9jZXNzRWFnZXJQYXJhbGxlbFJlc3VsdChPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgUmVzdWx0IHJlcykKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAvLyBkbyBzYW1lIGpvaW5z\nIGFzIGZvciBsb2FkCiAgICAgICAgLy8jIyMgY2hlYXQ6IHdlIGtub3cgdHlw\naWNhbCByZXN1bHQgam9pbnMgb25seSBjYXJlIGFib3V0IHRoZSByZWxhdGlv\nbgogICAgICAgIC8vIyMjIHBhdGg7IHRodXMgd2UgY2FuIGlnbm9yZSBkaWZm\nZXJlbnQgbWFwcGluZ3MKICAgICAgICBDbGFzc01hcHBpbmcgZWxlbSA9IGdl\ndERlZmF1bHRFbGVtZW50TWFwcGluZyh0cnVlKTsKICAgICAgICBKb2lucyBk\nYXRhSm9pbnMgPSByZXMubmV3Sm9pbnMoKS5zZXRWYXJpYWJsZSgiKiIpOwog\nICAgICAgIGRhdGFKb2lucyA9IGpvaW4oZGF0YUpvaW5zLCBlbGVtKTsKICAg\nICAgICBkYXRhSm9pbnMgPSBqb2luRWxlbWVudFJlbGF0aW9uKGRhdGFKb2lu\ncywgZWxlbSk7CiAgICAgICAgSm9pbnMgb3JkZXJKb2lucyA9IG51bGw7CiAg\nICAgICAgaWYgKGZpZWxkLmdldE9yZGVyQ29sdW1uKCkgIT0gbnVsbCkgewog\nICAgICAgICAgICBvcmRlckpvaW5zID0gcmVzLm5ld0pvaW5zKCkuc2V0VmFy\naWFibGUoIioiKTsKICAgICAgICAgICAgb3JkZXJKb2lucyA9IGpvaW4ob3Jk\nZXJKb2lucywgZWxlbSk7CiAgICAgICAgfQoKICAgICAgICBNYXAgcmVscyA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgQ2xhc3NNYXBwaW5nIG93bmVyTWFw\ncGluZyA9IGZpZWxkLmdldERlZmluaW5nTWFwcGluZygpOwogICAgICAgIE9i\namVjdCBuZXh0T2lkLCBvaWQgPSBudWxsOwogICAgICAgIE9iamVjdCBjb2xs\nID0gbnVsbDsKICAgICAgICBpbnQgc2VxID0gMDsKICAgICAgICB3aGlsZSAo\ncmVzLm5leHQoKSkgewogICAgICAgICAgICAvLyBleHRyYWN0IHRoZSBvd25l\nciBpZCB2YWx1ZQogICAgICAgICAgICBuZXh0T2lkID0gZ2V0TmV4dE9iamVj\ndElkKG93bmVyTWFwcGluZywgc3RvcmUsIHJlcywgb2lkKTsKICAgICAgICAg\nICAgaWYgKG5leHRPaWQgIT0gb2lkKSB7CiAgICAgICAgICAgICAgICAvLyBp\nZiB0aGUgb2xkIGNvbGwgd2FzIGFuIG9yZGVyZWQgdHJhY2tpbmcgcHJveHks\nIHNldAogICAgICAgICAgICAgICAgLy8gaXRzIHNlcSB2YWx1ZSB0byB0aGUg\nbGFzdCBvcmRlciB2YWwgd2UgcmVhZAogICAgICAgICAgICAgICAgaWYgKHNl\ncSAhPSAwICYmIGNvbGwgaW5zdGFuY2VvZiBQcm94eSkKICAgICAgICAgICAg\nICAgICAgICAoKFByb3h5KSBjb2xsKS5nZXRDaGFuZ2VUcmFja2VyKCkuc2V0\nTmV4dFNlcXVlbmNlKHNlcSk7CgogICAgICAgICAgICAgICAgLy8gc3RhcnQg\nYSBuZXcgY29sbGVjdGlvbgogICAgICAgICAgICAgICAgb2lkID0gbmV4dE9p\nZDsKICAgICAgICAgICAgICAgIHNlcSA9IDA7CiAgICAgICAgICAgICAgICBp\nZiAoZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuQVJSQVkpCiAg\nICAgICAgICAgICAgICAgICAgY29sbCA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjb2xsID0g\nc20ubmV3UHJveHkoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAgICAg\nICByZWxzLnB1dChvaWQsIGNvbGwpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAoZmllbGQuZ2V0T3JkZXJDb2x1bW4oKSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgc2VxID0gcmVzLmdldEludChmaWVsZC5nZXRPcmRlckNv\nbHVtbigpLCBvcmRlckpvaW5zKSArIDE7CgogICAgICAgICAgICAvLyBmb3Ig\naW52ZXJzZSByZWxhdGlvbiBmaWVsZAogICAgICAgICAgICBzZXRNYXBwZWRC\neShvaWQuZXF1YWxzKHNtLmdldE9iamVjdElkKCkpID8gCiAgICAgICAgICAg\nICAgICBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSA6IG9pZCwgcmVzKTsK\nICAgICAgICAgICAgT2JqZWN0IHZhbCA9IGxvYWRFbGVtZW50KG51bGwsIHN0\nb3JlLCBmZXRjaCwgcmVzLCBkYXRhSm9pbnMpOwogICAgICAgICAgICBhZGQo\nc3RvcmUsIGNvbGwsIHZhbCk7CiAgICAgICAgfQogICAgICAgIHJlcy5jbG9z\nZSgpOwoKICAgICAgICByZXR1cm4gcmVsczsKICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgc2V0TWFwcGVkQnkoT2JqZWN0IG9pZCwgUmVzdWx0IHJlcykgewog\nICAgICAgIC8vICBmb3IgaW52ZXJzZSB0b09uZSByZWxhdGlvbiBmaWVsZAog\nICAgICAgIEZpZWxkTWFwcGluZyBtYXBwZWRCeUZpZWxkTWFwcGluZyA9IGZp\nZWxkLmdldE1hcHBlZEJ5TWFwcGluZygpOwogICAgICAgIAogICAgICAgIGlm\nIChtYXBwZWRCeUZpZWxkTWFwcGluZyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIFZhbHVlTWFwcGluZyB2YWwgPSBtYXBwZWRCeUZpZWxkTWFwcGluZy5nZXRW\nYWx1ZU1hcHBpbmcoKTsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBkZWNN\nZXRhID0gdmFsLmdldFR5cGVNZXRhRGF0YSgpOwogICAgICAgICAgICAvLyB0\naGlzIGludmVyc2UgZmllbGQgZG9lcyBub3QgaGF2ZSBjb3JyZXNwb25kaW5n\nIGNsYXNzTWFwcGluZwogICAgICAgICAgICAvLyBpdHMgdmFsdWUgbWF5IGJl\nIGEgY29sbGVjdGlvbi9tYXAgZXRjLgogICAgICAgICAgICBpZiAoZGVjTWV0\nYSA9PSBudWxsKSAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgCiAgICAgICAgICAgIHJlcy5zZXRNYXBwZWRCeUZpZWxkTWFwcGluZyht\nYXBwZWRCeUZpZWxkTWFwcGluZyk7CiAgICAgICAgICAgIHJlcy5zZXRNYXBw\nZWRCeVZhbHVlKG9pZCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBzZXRNYXBwZWRCeShPYmplY3Qgb2lkLCBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBPYmplY3QgY29sbCwKICAgICAgICBSZXN1bHQgcmVzKSB7CiAg\nICAgICAgLy8gZm9yIGludmVyc2VFYWdlciBmaWVsZAogICAgICAgIEZpZWxk\nTWFwcGluZyBtYXBwZWRCeUZpZWxkTWFwcGluZyA9IGZpZWxkLmdldE1hcHBl\nZEJ5TWFwcGluZygpOwogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBtYXBw\nZWRCeVZhbHVlID0gbnVsbDsKICAgICAgICAKICAgICAgICBpZiAobWFwcGVk\nQnlGaWVsZE1hcHBpbmcgIT0gbnVsbCkgewogICAgICAgICAgICBWYWx1ZU1h\ncHBpbmcgdmFsID0gbWFwcGVkQnlGaWVsZE1hcHBpbmcuZ2V0VmFsdWVNYXBw\naW5nKCk7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgZGVjTWV0YSA9IHZh\nbC5nZXRUeXBlTWV0YURhdGEoKTsKICAgICAgICAgICAgLy8gdGhpcyBpbnZl\ncnNlIGZpZWxkIGRvZXMgbm90IGhhdmUgY29ycmVzcG9uZGluZyBjbGFzc01h\ncHBpbmcKICAgICAgICAgICAgLy8gaXRzIHZhbHVlIG1heSBiZSBhIGNvbGxl\nY3Rpb24vbWFwIGV0Yy4KICAgICAgICAgICAgaWYgKGRlY01ldGEgPT0gbnVs\nbCkgCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgCQogICAgICAg\nICAgICBpZiAob2lkLmVxdWFscyhzbS5nZXRPYmplY3RJZCgpKSkgewogICAg\nICAgICAgICAgICAgbWFwcGVkQnlWYWx1ZSA9IHNtLmdldFBlcnNpc3RlbmNl\nQ2FwYWJsZSgpOwogICAgICAgICAgICAgICAgcmVzLnNldE1hcHBlZEJ5Rmll\nbGRNYXBwaW5nKG1hcHBlZEJ5RmllbGRNYXBwaW5nKTsKICAgICAgICAgICAg\nICAgIHJlcy5zZXRNYXBwZWRCeVZhbHVlKG1hcHBlZEJ5VmFsdWUpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGNvbGwgaW5zdGFuY2VvZiBDb2xsZWN0aW9u\nICYmIAogICAgICAgICAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsKS5zaXpl\nKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBDdXN0b21lciAoMSkgPC0t\nPiBPcmRlcnMobikKICAgICAgICAgICAgICAgIC8vIGNvbGwgY29udGFpbnMg\ndGhlIHZhbHVlcyBvZiB0aGUgdG9NYW55IGZpZWxkIChPcmRlcnMpCiAgICAg\nICAgICAgICAgICAvLyBnZXQgdGhlIFN0YXRlTWFuYWdlciBvZiB0aGlzIHRv\nTWFueSB2YWx1ZQogICAgICAgICAgICAgICAgLy8gYW5kIGZpbmQgdGhlIHZh\nbHVlIG9mIHRoZSBpbnZlcnNlIG1hcHBlZEJ5IGZpZWxkIChDdXN0b21lcikK\nICAgICAgICAgICAgICAgIC8vIGZvciB0aGlzIHRvTWFjZG55IGZpZWxkCiAg\nICAgICAgICAgICAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcGMgPSAoUGVyc2lz\ndGVuY2VDYXBhYmxlKQogICAgICAgICAgICAgICAgICAgICgoQ29sbGVjdGlv\nbikgY29sbCkuaXRlcmF0b3IoKS5uZXh0KCk7CiAgICAgICAgICAgICAgICBP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtMSA9IChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nKSBwYy4KICAgICAgICAgICAgICAgICAgICBwY0dldFN0YXRlTWFuYWdlcigp\nOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBDbGFzc01hcHBp\nbmcgY2xtID0gKChDbGFzc01hcHBpbmcpIHNtMS5nZXRNZXRhRGF0YSgpKTsK\nICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVsZE1hcHBp\nbmcpIGNsbS5nZXRGaWVsZCgKICAgICAgICAgICAgICAgICAgICBtYXBwZWRC\neUZpZWxkTWFwcGluZy5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAgaWYg\nKGZtID09IG1hcHBlZEJ5RmllbGRNYXBwaW5nKQogICAgICAgICAgICAgICAg\nICAgIHJlcy5zZXRNYXBwZWRCeVZhbHVlKHNtMS5mZXRjaE9iamVjdChmbS5n\nZXRJbmRleCgpKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICByZXMuc2V0TWFwcGVkQnlWYWx1ZShudWxsKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gICAgICAgIAogICAgfQoKICAgIC8qKgogICAgICogRXh0\ncmFjdCB0aGUgb2lkIHZhbHVlIGZyb20gdGhlIGdpdmVuIHJlc3VsdC4gSWYg\ndGhlIG5leHQgb2lkIGlzIHRoZQogICAgICogc2FtZSBhcyB0aGUgZ2l2ZW4g\nb25lLCByZXR1cm5zIHRoZSBnaXZlbiBKVk0gaW5zdGFuY2UuCiAgICAgKi8K\nICAgIHByaXZhdGUgT2JqZWN0IGdldE5leHRPYmplY3RJZChDbGFzc01hcHBp\nbmcgb3duZXIsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBSZXN1bHQgcmVz\nLCBPYmplY3Qgb2lkKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBkYXRhc3RvcmUgaWQgY2xhc3Mgd2Ug\nY2FuIGF2b2lkIGNyZWF0aW5nIGEgbmV3IG9pZAogICAgICAgIC8vIG9iamVj\ndCBmb3IgdGhlIGNvbW1vbiBjYXNlCiAgICAgICAgaWYgKG9pZCAhPSBudWxs\nICYmIG93bmVyLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWFwcGluZy5J\nRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYgb3duZXIuaXNQcmltYXJ5S2V5\nT2JqZWN0SWQodHJ1ZSkpIHsKICAgICAgICAgICAgbG9uZyBuaWQgPSByZXMu\nZ2V0TG9uZyhvd25lci5nZXRQcmltYXJ5S2V5Q29sdW1ucygpWzBdKTsKICAg\nICAgICAgICAgbG9uZyBpZCA9ICgoSWQpIG9pZCkuZ2V0SWQoKTsKICAgICAg\nICAgICAgcmV0dXJuIChuaWQgPT0gaWQpID8gb2lkIDogc3RvcmUubmV3RGF0\nYVN0b3JlSWQobmlkLCBvd25lciwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAg\nICBPYmplY3Qgbm9pZCA9IG93bmVyLmdldE9iamVjdElkKHN0b3JlLCByZXMs\nIG51bGwsIHRydWUsIG51bGwpOwogICAgICAgIGlmIChub2lkID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAobm9p\nZC5lcXVhbHMob2lkKSkgPyBvaWQgOiBub2lkOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGxvYWRFYWdlckpvaW4oT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIFJlc3VsdCByZXMpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gaW5pdGlhbGl6ZSBmaWVsZCB2YWx1ZQogICAg\nICAgIE9iamVjdCBjb2xsOwogICAgICAgIGlmIChmaWVsZC5nZXRUeXBlQ29k\nZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAgICAgICAgICAgY29sbCA9IG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvbGwg\nPSBzbS5uZXdQcm94eShmaWVsZC5nZXRJbmRleCgpKTsKCiAgICAgICAgSm9p\nbnMgZGF0YUpvaW5zID0gbnVsbDsKICAgICAgICBKb2lucyByZWZKb2lucyA9\nIHJlcy5uZXdKb2lucygpLnNldFZhcmlhYmxlKCIqIik7CiAgICAgICAgam9p\nbihyZWZKb2lucywgZmFsc2UpOwoKICAgICAgICBDbGFzc01hcHBpbmcgb3du\nZXJNYXBwaW5nID0gZmllbGQuZ2V0RGVmaW5pbmdNYXBwaW5nKCk7CiAgICAg\nICAgT2JqZWN0IHJlZiA9IG51bGw7CiAgICAgICAgaW50IHNlcSA9IDA7CiAg\nICAgICAgaW50IHR5cGVJZHggPSByZXMuaW5kZXhPZigpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyB0cnVlOyBpKyspIHsKICAgICAgICAgICAgLy8gZXh0\ncmFjdCB0aGUgb3duZXIgaWQgdmFsdWUKICAgICAgICAgICAgcmVmID0gZ2V0\nTmV4dFJlZihvd25lck1hcHBpbmcsIHN0b3JlLCByZXMsIHJlZiwgcmVmSm9p\nbnMpOwogICAgICAgICAgICBpZiAocmVmID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIGlmIHRoZSBvbGQgY29sbCB3YXMgYW4gb3JkZXJlZCB0cmFj\na2luZyBwcm94eSwgc2V0CiAgICAgICAgICAgICAgICAvLyBpdHMgc2VxIHZh\nbHVlIHRvIHRoZSBsYXN0IG9yZGVyIHZhbCB3ZSByZWFkCiAgICAgICAgICAg\nICAgICBpZiAoc2VxICE9IDAgJiYgY29sbCBpbnN0YW5jZW9mIFByb3h5KQog\nICAgICAgICAgICAgICAgICAgICgoUHJveHkpIGNvbGwpLmdldENoYW5nZVRy\nYWNrZXIoKS5zZXROZXh0U2VxdWVuY2Uoc2VxKTsKICAgICAgICAgICAgICAg\nIGlmIChpICE9IDApCiAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2hCYWNr\nKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gZG8gc2FtZSBqb2lucyBhcyBmb3IgbG9hZAogICAgICAg\nICAgICBpZiAoZGF0YUpvaW5zID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGRhdGFKb2lucyA9IHJlcy5uZXdKb2lucygpLnNldFZhcmlhYmxlKCIqIik7\nCiAgICAgICAgICAgICAgICBkYXRhSm9pbnMgPSBqb2luKGRhdGFKb2lucywg\nZmFsc2UpOwogICAgICAgICAgICAgICAgZGF0YUpvaW5zID0gam9pblJlbGF0\naW9uKGRhdGFKb2lucywgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaWYgKGZpZWxkLmdldE9yZGVyQ29sdW1uKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNlcSA9IHJlcy5nZXRJbnQoZmllbGQuZ2V0\nT3JkZXJDb2x1bW4oKSwgcmVmSm9pbnMpICsgMTsKICAgICAgICAgICAgcmVz\nLnNldEJhc2VNYXBwaW5nKG51bGwpOwogICAgICAgICAgICBhZGQoc3RvcmUs\nIGNvbGwsIGxvYWRFbGVtZW50KHNtLCBzdG9yZSwgZmV0Y2gsIHJlcywgZGF0\nYUpvaW5zKSk7CiAgICAgICAgICAgIGlmICghcmVzLm5leHQoKSB8fCByZXMu\naW5kZXhPZigpICE9IHR5cGVJZHgpIHsKICAgICAgICAgICAgICAgIHJlcy5w\ndXNoQmFjaygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIGxvYWQgdGhlIGNvbGxlY3Rpb24g\naW50byB0aGUgb2JqZWN0CiAgICAgICAgaWYgKGZpZWxkLmdldFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLkFSUkFZKQogICAgICAgICAgICBzbS5zdG9yZU9i\namVjdChmaWVsZC5nZXRJbmRleCgpLCBKYXZhVHlwZXMudG9BcnJheQogICAg\nICAgICAgICAgICAgKChDb2xsZWN0aW9uKSBjb2xsLCBmaWVsZC5nZXRFbGVt\nZW50KCkuZ2V0VHlwZSgpKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\nbS5zdG9yZU9iamVjdChmaWVsZC5nZXRJbmRleCgpLCBjb2xsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEV4dHJhY3QgdGhlIHJlZmVyZW5jZSBjb2x1bW4g\ndmFsdWUocykgZnJvbSB0aGUgZ2l2ZW4gcmVzdWx0LiBJZiB0aGUKICAgICAq\nIGV4dHJhY3RlZCByZXN1bHQgaXMgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQg\nb25lIG9yIHRoZSBjdXJyZW50CiAgICAgKiBvbmUgaXMgbnVsbCwgcmV0dXJu\ncyB0aGUgZXh0cmFjdGVkIHJlc3VsdC4gRWxzZSByZXR1cm5zIG51bGwuCiAg\nICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IGdldE5leHRSZWYoQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBSZXN1bHQg\ncmVzLCBPYmplY3QgcmVmLCBKb2lucyByZWZKb2lucykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZ2V0\nSm9pbkZvcmVpZ25LZXkoZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5nKGZhbHNl\nKSkuCiAgICAgICAgICAgIGdldENvbHVtbnMoKTsKICAgICAgICBPYmplY3Qg\ndmFsOwogICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAg\nICAgIHZhbCA9IHJlcy5nZXRPYmplY3QoY29sc1swXSwgbnVsbCwgcmVmSm9p\nbnMpOwogICAgICAgICAgICBpZiAodmFsID09IG51bGwgfHwgKHJlZiAhPSBu\ndWxsICYmICF2YWwuZXF1YWxzKHJlZikpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgfQoK\nICAgICAgICBPYmplY3RbXSByZWZzID0gKE9iamVjdFtdKSByZWY7CiAgICAg\nICAgaWYgKHJlZnMgPT0gbnVsbCkKICAgICAgICAgICAgcmVmcyA9IG5ldyBP\nYmplY3RbY29scy5sZW5ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YWwgPSByZXMu\nZ2V0T2JqZWN0KGNvbHNbaV0sIG51bGwsIHJlZkpvaW5zKTsKICAgICAgICAg\nICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIGlmIChyZWZzW2ldICE9IG51bGwgJiYgIXZhbC5l\ncXVhbHMocmVmc1tpXSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgcmVmc1tpXSA9IHZhbDsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJlZnM7CiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZChmaW5h\nbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBmaW5hbCBKREJDU3RvcmUgc3Rv\ncmUsCiAgICAgICAgZmluYWwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nZmllbGQuaXNMUlMoKSkgewogICAgICAgICAgICBQcm94eSBjb2xsID0gbmV3\nTFJTUHJveHkoKTsKCiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgb3JkZXJl\nZCB3ZSBuZWVkIHRvIGtub3cgdGhlIG5leHQgc2VxIHRvIHVzZSBpbiBjYXNl\nCiAgICAgICAgICAgIC8vIG9iamVjdHMgYXJlIGFkZGVkIHRvIHRoZSBjb2xs\nZWN0aW9uCiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRPcmRlckNvbHVtbigp\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHdlIGRvbid0IGFsbG93\nIG9yZGVyaW5nIHRhYmxlIHBlciBjbGFzcyBvbmUtbWFueSdzLCBzbwogICAg\nICAgICAgICAgICAgLy8gd2Uga25vdyB3ZSBkb24ndCBuZWVkIGEgdW5pb24K\nICAgICAgICAgICAgICAgIFNlbGVjdCBzZWwgPSBzdG9yZS5nZXRTUUxGYWN0\nb3J5KCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAgICAgICBzZWwuc2V0QWdn\ncmVnYXRlKHRydWUpOwogICAgICAgICAgICAgICAgU3RyaW5nQnVmZmVyIHNx\nbCA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICAgICAgICAgIHNxbC5h\ncHBlbmQoIk1BWCgiKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoc2Vs\nLmdldENvbHVtbkFsaWFzKGZpZWxkLmdldE9yZGVyQ29sdW1uKCkpKS4KICAg\nICAgICAgICAgICAgICAgICBhcHBlbmQoIikiKTsKICAgICAgICAgICAgICAg\nIHNlbC5zZWxlY3Qoc3FsLnRvU3RyaW5nKCksIGZpZWxkKTsKICAgICAgICAg\nICAgICAgIENsYXNzTWFwcGluZyByZWwgPSBnZXREZWZhdWx0RWxlbWVudE1h\ncHBpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgc2VsLndoZXJlRm9yZWln\nbktleShnZXRKb2luRm9yZWlnbktleShyZWwpLAogICAgICAgICAgICAgICAg\nICAgIHNtLmdldE9iamVjdElkKCksIGZpZWxkLmdldERlZmluaW5nTWFwcGlu\nZygpLCBzdG9yZSk7CgogICAgICAgICAgICAgICAgUmVzdWx0IHJlcyA9IHNl\nbC5leGVjdXRlKHN0b3JlLCBmZXRjaCk7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIHJlcy5uZXh0KCk7CiAgICAgICAgICAg\nICAgICAgICAgY29sbC5nZXRDaGFuZ2VUcmFja2VyKCkuc2V0TmV4dFNlcXVl\nbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIChyZXMuZ2V0SW50KGZpZWxk\nKSArIDEpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgICAgICByZXMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBzbS5zdG9yZU9iamVjdEZpZWxkKGZp\nZWxkLmdldEluZGV4KCksIGNvbGwpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICAvLyBzZWxlY3QgZGF0YSBmb3IgdGhpcyBzbQog\nICAgICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIGVsZW1zID0gZ2V0SW5kZXBl\nbmRlbnRFbGVtZW50TWFwcGluZ3ModHJ1ZSk7CiAgICAgICAgZmluYWwgSm9p\nbnNbXSByZXNKb2lucyA9IG5ldyBKb2luc1tNYXRoLm1heCgxLCBlbGVtcy5s\nZW5ndGgpXTsKICAgICAgICBVbmlvbiB1bmlvbiA9IHN0b3JlLmdldFNRTEZh\nY3RvcnkoKS5uZXdVbmlvbgogICAgICAgICAgICAoTWF0aC5tYXgoMSwgZWxl\nbXMubGVuZ3RoKSk7CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5T\nZWxlY3RvcigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNl\nbGVjdCBzZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIENsYXNzTWFw\ncGluZyBlbGVtID0gKGVsZW1zLmxlbmd0aCA9PSAwKSA/IG51bGwgOiBlbGVt\nc1tpZHhdOwogICAgICAgICAgICAgICAgcmVzSm9pbnNbaWR4XSA9IHNlbGVj\ndEFsbChzZWwsIGVsZW0sIHNtLCBzdG9yZSwgZmV0Y2gsCiAgICAgICAgICAg\nICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9QQVJBTExF\nTCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gY3Jl\nYXRlIHByb3h5CiAgICAgICAgT2JqZWN0IGNvbGw7CiAgICAgICAgQ2hhbmdl\nVHJhY2tlciBjdCA9IG51bGw7CiAgICAgICAgaWYgKGZpZWxkLmdldFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLkFSUkFZKQogICAgICAgICAgICBjb2xsID0g\nbmV3IEFycmF5TGlzdCgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBj\nb2xsID0gc20ubmV3UHJveHkoZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nICAgIGlmIChjb2xsIGluc3RhbmNlb2YgUHJveHkpCiAgICAgICAgICAgICAg\nICBjdCA9ICgoUHJveHkpIGNvbGwpLmdldENoYW5nZVRyYWNrZXIoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGxvYWQgdmFsdWVzCiAgICAgICAgUmVzdWx0\nIHJlcyA9IHVuaW9uLmV4ZWN1dGUoc3RvcmUsIGZldGNoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpbnQgc2VxID0gLTE7CiAgICAgICAgICAgIHdo\naWxlIChyZXMubmV4dCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCAmJiBmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgc2VxID0gcmVzLmdldEludChmaWVsZC5nZXRPcmRl\nckNvbHVtbigpKTsKICAgICAgICAgICAgICAgIHNldE1hcHBlZEJ5KHNtLmdl\ndE9iamVjdElkKCksIHNtLCBjb2xsLCByZXMpOwogICAgICAgICAgICAgICAJ\nYWRkKHN0b3JlLCBjb2xsLCBsb2FkRWxlbWVudChzbSwgc3RvcmUsIGZldGNo\nLCByZXMsCiAgICAgICAgICAgCSAgICAgICAgcmVzSm9pbnNbcmVzLmluZGV4\nT2YoKV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3QgIT0g\nbnVsbCAmJiBmaWVsZC5nZXRPcmRlckNvbHVtbigpICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBjdC5zZXROZXh0U2VxdWVuY2Uoc2VxICsgMSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBzZXQgaW50byBzbQogICAgICAgIGlmIChmaWVs\nZC5nZXRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWSkKICAgICAgICAg\nICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwgSmF2YVR5cGVz\nLnRvQXJyYXkKICAgICAgICAgICAgICAgICgoQ29sbGVjdGlvbikgY29sbCwg\nZmllbGQuZ2V0RWxlbWVudCgpLmdldFR5cGUoKSkpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZmllbGQuZ2V0SW5kZXgoKSwg\nY29sbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZGF0YSBmb3Ig\nbG9hZGluZywgc3RhcnRpbmcgaW4gZmllbGQgdGFibGUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBKb2lucyBzZWxlY3RBbGwoU2VsZWN0IHNlbCwgQ2xhc3NN\nYXBwaW5nIGVsZW0sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwg\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLAogICAgICAgIGludCBlYWdlck1vZGUpIHsKICAgICAgICBzZWwud2hlcmVG\nb3JlaWduS2V5KGdldEpvaW5Gb3JlaWduS2V5KGVsZW0pLCBzbS5nZXRPYmpl\nY3RJZCgpLAogICAgICAgICAgICBmaWVsZC5nZXREZWZpbmluZ01hcHBpbmco\nKSwgc3RvcmUpOwoKICAgICAgICAvLyBvcmRlciBmaXJzdCwgdGhlbiBzZWxl\nY3Qgc28gdGhhdCBpZiB0aGUgcHJvamVjdGlvbiBpbnRyb2R1Y2VzCiAgICAg\nICAgLy8gYWRkaXRpb25hbCBvcmRlcmluZywgaXQgd2lsbCBiZSBhZnRlciBv\ndXIgcmVxdWlyZWQgb3JkZXJpbmcKICAgICAgICBmaWVsZC5vcmRlckxvY2Fs\nKHNlbCwgZWxlbSwgbnVsbCk7CiAgICAgICAgSm9pbnMgam9pbnMgPSBqb2lu\nRWxlbWVudFJlbGF0aW9uKHNlbC5uZXdKb2lucygpLCBlbGVtKTsKICAgICAg\nICBmaWVsZC5vcmRlclJlbGF0aW9uKHNlbCwgZWxlbSwgam9pbnMpOwogICAg\nICAgIHNlbGVjdEVsZW1lbnQoc2VsLCBlbGVtLCBzdG9yZSwgZmV0Y2gsIGVh\nZ2VyTW9kZSwgam9pbnMpOwogICAgICAgIHJldHVybiBqb2luczsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IGxvYWRQcm9qZWN0aW9uKEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBS\nZXN1bHQgcmVzLCBKb2lucyBqb2lucykKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gbG9hZEVsZW1lbnQobnVsbCwgc3Rv\ncmUsIGZldGNoLCByZXMsIGpvaW5zKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQg\nRm9yZWlnbktleSBnZXRKb2luRm9yZWlnbktleSgpIHsKICAgICAgICByZXR1\ncm4gZ2V0Sm9pbkZvcmVpZ25LZXkoZ2V0RGVmYXVsdEVsZW1lbnRNYXBwaW5n\nKGZhbHNlKSk7CiAgICB9CiAgICAKICAgIGJvb2xlYW4gcmVxdWlyZXNPcmRl\nckJ5KCkgewogICAgCXJldHVybiBMaXN0LmNsYXNzLmlzQXNzaWduYWJsZUZy\nb20oZmllbGQuZ2V0UHJveHlUeXBlKCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

