{"sha":"90f5ae93be1031d13b5840e7a1c76e0eec0a043b","node_id":"MDQ6QmxvYjIwNjM2NDo5MGY1YWU5M2JlMTAzMWQxM2I1ODQwZTdhMWM3NmUwZWVjMGEwNDNi","size":12425,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/90f5ae93be1031d13b5840e7a1c76e0eec0a043b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOwppbXBvcnQgamF2\nYS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRyaXZlcjsKaW1w\nb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBv\ncnQgamF2YXguc3FsLkRhdGFTb3VyY2U7CgppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5Db25maWd1cmlu\nZ0Nvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmpkYmMuQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWNvcmF0aW5nRGF0YVNvdXJjZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5n\nRGF0YVNvdXJjZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRi\nYy5KREJDRXZlbnRDb25uZWN0aW9uRGVjb3JhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5qZGJjLkpEQkNMaXN0ZW5lcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5Mb2dnaW5nQ29ubmVjdGlvbkRl\nY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxv\nZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJp\ndkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxI\nZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBB\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNl\nckV4Y2VwdGlvbjsKCi8qKgogKiBGYWN0b3J5IGZvciB7QGxpbmsgRGF0YVNv\ndXJjZX0gb2JqZWN0cy4gVGhlIGZhY3RvcnkgdXNlcyB0aGUgc3VwcGxpZWQK\nICogY29uZmlndXJhdGlvbiB0byBvYnRhaW4gYSAzcmQtcGFydHkgZGF0YXNv\ndXJjZSBvciB0byBjcmVhdGUgb25lLCBhbmQKICogdG8gc2V0dXAgcHJlcGFy\nZWQgc3RhdGVtZW50IGNhY2hpbmcuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRl\nCiAqIEBub2phdmFkb2MKICovCnB1YmxpYyBjbGFzcyBEYXRhU291cmNlRmFj\ndG9yeSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9s\nb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgCSAoRGF0YVNvdXJjZUZh\nY3RvcnkuY2xhc3MpOwogICAgcHJvdGVjdGVkIHN0YXRpYyBMb2NhbGl6ZXIg\nX2Vsb2MgPSAKICAgIAlMb2NhbGl6ZXIuZm9yUGFja2FnZShEZWxlZ2F0aW5n\nRGF0YVNvdXJjZS5jbGFzcyk7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBk\nYXRhc291cmNlIHVzaW5nIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIERhdGFTb3VyY2UgbmV3RGF0YVNvdXJj\nZShKREJDQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgIGJvb2xlYW4gZmFj\ndG9yeTIpIHsKICAgICAgICBTdHJpbmcgZHJpdmVyID0gKGZhY3RvcnkyKSA/\nIGNvbmYuZ2V0Q29ubmVjdGlvbjJEcml2ZXJOYW1lKCkKICAgICAgICAgICAg\nOiBjb25mLmdldENvbm5lY3Rpb25Ecml2ZXJOYW1lKCk7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkoZHJpdmVyKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWRyaXZlciIsIGRy\naXZlcikpLgogICAgICAgICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7CgogICAg\nICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IGNvbmYuZ2V0Q2xhc3NSZXNvbHZl\nckluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKERhdGFT\nb3VyY2VGYWN0b3J5LmNsYXNzLCBudWxsKTsKICAgICAgICBTdHJpbmcgcHJv\ncHMgPSAoZmFjdG9yeTIpID8gY29uZi5nZXRDb25uZWN0aW9uMlByb3BlcnRp\nZXMoKQogICAgICAgICAgICA6IGNvbmYuZ2V0Q29ubmVjdGlvblByb3BlcnRp\nZXMoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzcyBkcml2ZXJD\nbGFzczsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRyaXZl\nckNsYXNzID0gQ2xhc3MuZm9yTmFtZShkcml2ZXIsIHRydWUsIGxvYWRlcik7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91bmRFeGNlcHRpb24g\nY25mZSkgewogICAgICAgICAgICAgICAgLy8gdHJ5IHdpdGggdGhlIGNvcmUg\nY2xhc3MgbG9hZGVyCiAgICAgICAgICAgICAgICBkcml2ZXJDbGFzcyA9IENs\nYXNzLmZvck5hbWUoZHJpdmVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgaWYgKERyaXZlci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGRyaXZlckNs\nYXNzKSkgewogICAgICAgICAgICAgICAgRHJpdmVyRGF0YVNvdXJjZSBkcyA9\nIGNvbmYubmV3RHJpdmVyRGF0YVNvdXJjZUluc3RhbmNlKCk7CiAgICAgICAg\nICAgICAgICBkcy5zZXRDbGFzc0xvYWRlcihsb2FkZXIpOwogICAgICAgICAg\nICAgICAgZHMuc2V0Q29ubmVjdGlvbkRyaXZlck5hbWUoZHJpdmVyKTsKICAg\nICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25Qcm9wZXJ0aWVzKENvbmZp\nZ3VyYXRpb25zLgogICAgICAgICAgICAgICAgICAgIHBhcnNlUHJvcGVydGll\ncyhwcm9wcykpOwoKICAgICAgICAgICAgICAgIGlmICghZmFjdG9yeTIpIHsK\nICAgICAgICAgICAgICAgICAgICBkcy5zZXRDb25uZWN0aW9uRmFjdG9yeVBy\nb3BlcnRpZXMoQ29uZmlndXJhdGlvbnMuCiAgICAgICAgICAgICAgICAgICAg\nICAgIHBhcnNlUHJvcGVydGllcyhjb25mLmdldENvbm5lY3Rpb25GYWN0b3J5\nUHJvcGVydGllcygpKSk7CiAgICAgICAgICAgICAgICAgICAgZHMuc2V0Q29u\nbmVjdGlvblVSTChjb25mLmdldENvbm5lY3Rpb25VUkwoKSk7CiAgICAgICAg\nICAgICAgICAgICAgZHMuc2V0Q29ubmVjdGlvblVzZXJOYW1lKGNvbmYuZ2V0\nQ29ubmVjdGlvblVzZXJOYW1lKCkpOwogICAgICAgICAgICAgICAgICAgIGRz\nLnNldENvbm5lY3Rpb25QYXNzd29yZChjb25mLmdldENvbm5lY3Rpb25QYXNz\nd29yZCgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgZHMuc2V0Q29ubmVjdGlvbkZhY3RvcnlQcm9wZXJ0aWVzCiAg\nICAgICAgICAgICAgICAgICAgICAgIChDb25maWd1cmF0aW9ucy5wYXJzZVBy\nb3BlcnRpZXMoY29uZi4KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q29u\nbmVjdGlvbkZhY3RvcnkyUHJvcGVydGllcygpKSk7CiAgICAgICAgICAgICAg\nICAgICAgZHMuc2V0Q29ubmVjdGlvblVSTChjb25mLmdldENvbm5lY3Rpb24y\nVVJMKCkpOwogICAgICAgICAgICAgICAgICAgIGRzLnNldENvbm5lY3Rpb25V\nc2VyTmFtZShjb25mLmdldENvbm5lY3Rpb24yVXNlck5hbWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgZHMuc2V0Q29ubmVjdGlvblBhc3N3b3JkKGNvbmYu\nZ2V0Q29ubmVjdGlvbjJQYXNzd29yZCgpKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHJldHVybiBkczsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gc2VlIGlmIHRoZWlyIGRyaXZlciBuYW1lIGlzIGFjdHVh\nbGx5IGEgZGF0YSBzb3VyY2UKICAgICAgICAgICAgaWYgKERhdGFTb3VyY2Uu\nY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShkcml2ZXJDbGFzcykpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiAoRGF0YVNvdXJjZSkgQ29uZmlndXJhdGlvbnMu\nbmV3SW5zdGFuY2UoZHJpdmVyLAogICAgICAgICAgICAgICAgICAgIGNvbmYs\nIHByb3BzLCAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5nZXRDbGFzc0xvYWRlckFjdGlvbigKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIERhdGFTb3VyY2UuY2xhc3MpKSk7IAogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ld0Nvbm5lY3RFeGNlcHRp\nb24oY29uZiwgZmFjdG9yeTIsIGUpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nbm90IGEgZHJpdmVyIG9yIGEgZGF0YSBzb3VyY2U7IGRpZQogICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZHJpdmVyIiwg\nZHJpdmVyKSkuc2V0RmF0YWwodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbnN0YWxsIGxpc3RlbmVycyBhbmQgYmFzZSBkZWNvcmF0b3JzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIERlY29yYXRpbmdEYXRhU291cmNlIGRl\nY29yYXRlRGF0YVNvdXJjZShEYXRhU291cmNlIGRzLAogICAgICAgIEpEQkND\nb25maWd1cmF0aW9uIGNvbmYsIGJvb2xlYW4gZmFjdG9yeTIpIHsKICAgICAg\nICBPcHRpb25zIG9wdHMgPSBDb25maWd1cmF0aW9ucy5wYXJzZVByb3BlcnRp\nZXMoKGZhY3RvcnkyKQogICAgICAgICAgICA/IGNvbmYuZ2V0Q29ubmVjdGlv\nbkZhY3RvcnkyUHJvcGVydGllcygpCiAgICAgICAgICAgIDogY29uZi5nZXRD\nb25uZWN0aW9uRmFjdG9yeVByb3BlcnRpZXMoKSk7CiAgICAgICAgTG9nIGpk\nYmNMb2cgPSBjb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRC\nQyk7CiAgICAgICAgTG9nIHNxbExvZyA9IGNvbmYuZ2V0TG9nKEpEQkNDb25m\naWd1cmF0aW9uLkxPR19TUUwpOwoKICAgICAgICBEZWNvcmF0aW5nRGF0YVNv\ndXJjZSBkZHMgPSBuZXcgRGVjb3JhdGluZ0RhdGFTb3VyY2UoZHMpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGFkZCB1c2VyLWRlZmluZWQgZGVj\nb3JhdG9ycwogICAgICAgICAgICBMaXN0IGRlY29yYXRvcnMgPSBuZXcgQXJy\nYXlMaXN0KCk7CiAgICAgICAgICAgIGRlY29yYXRvcnMuYWRkQWxsKEFycmF5\ncy5hc0xpc3QoY29uZi4KICAgICAgICAgICAgICAgIGdldENvbm5lY3Rpb25E\nZWNvcmF0b3JJbnN0YW5jZXMoKSkpOwoKICAgICAgICAgICAgLy8gYWRkIGpk\nYmMgZXZlbnRzIGRlY29yYXRvcgogICAgICAgICAgICBKREJDRXZlbnRDb25u\nZWN0aW9uRGVjb3JhdG9yIGVjZCA9CiAgICAgICAgICAgICAgICBuZXcgSkRC\nQ0V2ZW50Q29ubmVjdGlvbkRlY29yYXRvcigpOwogICAgICAgICAgICBDb25m\naWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShlY2QsIGNvbmYsIG9wdHMp\nOwogICAgICAgICAgICBKREJDTGlzdGVuZXJbXSBsaXN0ZW5lcnMgPSBjb25m\nLmdldEpEQkNMaXN0ZW5lckluc3RhbmNlcygpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgICAgIGVjZC5hZGRMaXN0ZW5lcihsaXN0ZW5lcnNbaV0pOwogICAg\nICAgICAgICBkZWNvcmF0b3JzLmFkZChlY2QpOwoKICAgICAgICAgICAgLy8g\nYXNrIHRoZSBEcml2ZXJEYXRhU291cmNlIHRvIHByb3ZpZGUgYW55IGFkZGl0\naW9uYWwgZGVjb3JhdG9ycwogICAgICAgICAgICBpZiAoZHMgaW5zdGFuY2Vv\nZiBEcml2ZXJEYXRhU291cmNlKSB7CiAgICAgICAgICAgICAgICBMaXN0IGRl\nY3MgPSAoKERyaXZlckRhdGFTb3VyY2UpIGRzKS4KICAgICAgICAgICAgICAg\nICAgICBjcmVhdGVDb25uZWN0aW9uRGVjb3JhdG9ycygpOwogICAgICAgICAg\nICAgICAgaWYgKGRlY3MgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBk\nZWNvcmF0b3JzLmFkZEFsbChkZWNzKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gbG9nZ2luZyBkZWNvcmF0b3IKICAgICAgICAgICAgTG9nZ2lu\nZ0Nvbm5lY3Rpb25EZWNvcmF0b3IgbGNkID0KICAgICAgICAgICAgICAgIG5l\ndyBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcigpOwogICAgICAgICAgICBD\nb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5jZShsY2QsIGNvbmYsIG9w\ndHMpOwogICAgICAgICAgICBsY2QuZ2V0TG9ncygpLnNldEpEQkNMb2coamRi\nY0xvZyk7CiAgICAgICAgICAgIGxjZC5nZXRMb2dzKCkuc2V0U1FMTG9nKHNx\nbExvZyk7CiAgICAgICAgICAgIGRlY29yYXRvcnMuYWRkKGxjZCk7CgogICAg\nICAgICAgICBkZHMuYWRkRGVjb3JhdG9ycyhkZWNvcmF0b3JzKTsKICAgICAg\nICAgICAgcmV0dXJuIGRkczsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ld0Nv\nbm5lY3RFeGNlcHRpb24oY29uZiwgZmFjdG9yeTIsIGUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEluc3RhbGwgdGhpbmdzIGRlZmVycmVk\nIHVudGlsIHRoZSBEQkRpY3Rpb25hcnkgaW5zdGFuY2UgaXMgYXZhaWxhYmxl\nLgogICAgICoKICAgICAqIEBhdXRob3IgU3RldmUgS2ltCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgRGVjb3JhdGluZ0RhdGFTb3VyY2UgaW5zdGFsbERC\nRGljdGlvbmFyeShEQkRpY3Rpb25hcnkgZGljdCwKICAgICAgICBEZWNvcmF0\naW5nRGF0YVNvdXJjZSBkcywgZmluYWwgSkRCQ0NvbmZpZ3VyYXRpb24gY29u\nZiwKICAgICAgICBib29sZWFuIGZhY3RvcnkyKSB7CiAgICAgICAgRGF0YVNv\ndXJjZSBpbm5lciA9IGRzLmdldElubmVybW9zdERlbGVnYXRlKCk7CiAgICAg\nICAgaWYgKGlubmVyIGluc3RhbmNlb2YgRHJpdmVyRGF0YVNvdXJjZSkKICAg\nICAgICAgICAgKChEcml2ZXJEYXRhU291cmNlKSBpbm5lcikuaW5pdERCRGlj\ndGlvbmFyeShkaWN0KTsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBudWxs\nOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBhZGQgdGhlIGRpY3Rp\nb25hcnkgYXMgYSB3YXJuaW5nIGhhbmRsZXIgb24gdGhlIGxvZ2dpbmcKICAg\nICAgICAgICAgLy8gZGVjb3JhdG9yCiAgICAgICAgICAgIENvbm5lY3Rpb25E\nZWNvcmF0b3IgY2Q7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nZHMuZ2V0RGVjb3JhdG9ycygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICBjZCA9IChDb25uZWN0aW9uRGVjb3JhdG9y\nKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGNkIGluc3RhbmNl\nb2YgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IpCiAgICAgICAgICAgICAg\nICAgICAgKChMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcikgY2QpLnNldFdh\ncm5pbmdIYW5kbGVyKGRpY3QpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBtaXNjIGNvbmZpZ3VyYXRpb24gY29ubmVjdGlvbiBkZWNvcmF0b3Ig\nKHN0YXRlbWVudCB0aW1lb3V0cywKICAgICAgICAgICAgLy8gdHJhbnNhY3Rp\nb24gaXNvbGF0aW9uLCBldGMpCiAgICAgICAgICAgIENvbmZpZ3VyaW5nQ29u\nbmVjdGlvbkRlY29yYXRvciBjY2QgPQogICAgICAgICAgICAgICAgbmV3IENv\nbmZpZ3VyaW5nQ29ubmVjdGlvbkRlY29yYXRvcigpOwogICAgICAgICAgICBj\nY2Quc2V0VHJhbnNhY3Rpb25Jc29sYXRpb24oY29uZi5nZXRUcmFuc2FjdGlv\nbklzb2xhdGlvbkNvbnN0YW50KCkpOwogICAgICAgICAgICBMb2cgbG9nID0g\nY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwogICAg\nICAgICAgICBpZiAoZmFjdG9yeTIgfHwgIWNvbmYuaXNDb25uZWN0aW9uRmFj\ndG9yeU1vZGVNYW5hZ2VkKCkpIHsKICAgICAgICAgICAgICAgIGlmICghZGlj\ndC5zdXBwb3J0c011bHRpcGxlTm9udHJhbnNhY3Rpb25hbFJlc3VsdFNldHMp\nCiAgICAgICAgICAgICAgICAgICAgY2NkLnNldEF1dG9Db21taXQoQm9vbGVh\nbi5GQUxTRSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgY2NkLnNldEF1dG9Db21taXQoQm9vbGVhbi5UUlVFKTsKICAgICAg\nICAgICAgICAgIC8vIGFkZCB0cmFjZSBpbmZvIGZvciBhdXRvQ29tbWl0IHNl\ndHRpbmcKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoInNl\ndC1hdXRvLWNvbW1pdCIsIG5ldyBPYmplY3RbXSB7CiAgICAgICAgICAgICAg\nICAgICAgZGljdC5zdXBwb3J0c011bHRpcGxlTm9udHJhbnNhY3Rpb25hbFJl\nc3VsdFNldHN9KSk7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAg\nICAgICAgICAgIE9wdGlvbnMgb3B0cyA9IENvbmZpZ3VyYXRpb25zLnBhcnNl\nUHJvcGVydGllcygoZmFjdG9yeTIpCiAgICAgICAgICAgICAgICA/IGNvbmYu\nZ2V0Q29ubmVjdGlvbkZhY3RvcnkyUHJvcGVydGllcygpCiAgICAgICAgICAg\nICAgICA6IGNvbmYuZ2V0Q29ubmVjdGlvbkZhY3RvcnlQcm9wZXJ0aWVzKCkp\nOwogICAgICAgICAgICBDb25maWd1cmF0aW9ucy5jb25maWd1cmVJbnN0YW5j\nZShjY2QsIGNvbmYsIG9wdHMpOwogICAgICAgICAgICBkcy5hZGREZWNvcmF0\nb3IoY2NkKTsKCiAgICAgICAgICAgIC8vIGFsbG93IHRoZSBkYmRpY3Rpb25h\ncnkgdG8gZGVjb3JhdGUgdGhlIGNvbm5lY3Rpb24gZnVydGhlcgogICAgICAg\nICAgICBkcy5hZGREZWNvcmF0b3IoZGljdCk7CiAgICAgICAgICAgIAogICAg\nICAgICAgICAvLyBlbnN1cmUgZGJkaWN0aW9uYXJ5IHRvIHByb2Nlc3MgY29u\nbmVjdGVkQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIGlmICghZmFjdG9y\neTIpCiAgICAgICAgICAgICAgICBjb25uID0gZHMuZ2V0Q29ubmVjdGlvbihj\nb25mLmdldENvbm5lY3Rpb25Vc2VyTmFtZSgpLCBjb25mCiAgICAgICAgICAg\nICAgICAgICAgICAgIC5nZXRDb25uZWN0aW9uUGFzc3dvcmQoKSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvbm4gPSBkcy5nZXRDb25u\nZWN0aW9uKGNvbmYuZ2V0Q29ubmVjdGlvbjJVc2VyTmFtZSgpLCBjb25mCiAg\nICAgICAgICAgICAgICAgICAgICAgIC5nZXRDb25uZWN0aW9uMlBhc3N3b3Jk\nKCkpOwoKICAgICAgICAgICAgcmV0dXJuIGRzOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgCXRocm93IG5ld0Nvbm5lY3RFeGNl\ncHRpb24oY29uZiwgZmFjdG9yeTIsIGUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBhbnkgZXhjZXB0aW9uIHNpbmNl\nIHRoZSBjb25uZWN0aW9uIGlzIG5vdCBnb2luZwogICAgICAgICAgICAgICAg\nICAgIC8vIHRvIGJlIHVzZWQgYW55d2F5CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQogICAgCiAgICBzdGF0aWMgT3BlbkpQQUV4Y2VwdGlv\nbiBuZXdDb25uZWN0RXhjZXB0aW9uKEpEQkNDb25maWd1cmF0aW9uIGNvbmYs\nIAogICAgCQlib29sZWFuIGZhY3RvcnkyLCBFeGNlcHRpb24gY2F1c2UpIHsK\nICAgIAlyZXR1cm4gbmV3IFVzZXJFeGNlcHRpb24oX2Vsb2MuZ2V0KCJwb29s\nZHMtbnVsbCIsIGZhY3RvcnkyIAogICAgICAgICAgCSAgPyBuZXcgT2JqZWN0\nW117Y29uZi5nZXRDb25uZWN0aW9uMkRyaXZlck5hbWUoKSwgCiAgICAgICAg\nICAJCQkgICAgICAgICBjb25mLmdldENvbm5lY3Rpb24yVVJMKCl9CiAgICAg\nICAgICAJICA6IG5ldyBPYmplY3RbXXtjb25mLmdldENvbm5lY3Rpb25Ecml2\nZXJOYW1lKCksCiAgICAgICAgICAJCSAgICAgICAgICAgICBjb25mLmdldENv\nbm5lY3Rpb25VUkwoKX0pLAogICAgICAgICAgCQkgICAgICAgICAgICAgY2F1\nc2UpLnNldEZhdGFsKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgZGF0YSBzb3VyY2Ugd2l0aCB0aGUgZ2l2ZW4gdXNlciBuYW1lIGFu\nZCBwYXNzd29yZAogICAgICogcHJlLWNvbmZpZ3VyZWQgYXMgdGhlIGRlZmF1\nbHRzIHdoZW4ge0BsaW5rIERhdGFTb3VyY2UjZ2V0Q29ubmVjdGlvbn0KICAg\nICAqIGlzIGNhbGxlZC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBEYXRh\nU291cmNlIGRlZmF1bHRzRGF0YVNvdXJjZShEYXRhU291cmNlIGRzLAogICAg\nICAgIFN0cmluZyB1c2VyLCBTdHJpbmcgcGFzcykgewogICAgICAgIGlmICh1\nc2VyID09IG51bGwgJiYgcGFzcyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZHM7CiAgICAgICAgLy8gYWxzbyBjaGVjayBpZiB0aGV5IGFyZSBib3Ro\nIGJsYW5rIHN0cmluZ3MKICAgICAgICBpZiAoIiIuZXF1YWxzKHVzZXIpICYm\nICIiLmVxdWFscyhwYXNzKSkKICAgICAgICAgICAgcmV0dXJuIGRzOwogICAg\nICAgIHJldHVybiBuZXcgRGVmYXVsdHNEYXRhU291cmNlKGRzLCB1c2VyLCBw\nYXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBnaXZlbiBk\nYXRhIHNvdXJjZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIGNs\nb3NlRGF0YVNvdXJjZShEYXRhU291cmNlIGRzKSB7CiAgICAgICAgaWYgKGRz\nIGluc3RhbmNlb2YgRGVsZWdhdGluZ0RhdGFTb3VyY2UpCiAgICAgICAgICAg\nIGRzID0gKChEZWxlZ2F0aW5nRGF0YVNvdXJjZSkgZHMpLmdldElubmVybW9z\ndERlbGVnYXRlKCk7CiAgICAgICAgSW1wbEhlbHBlci5jbG9zZShkcyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBIGRhdGEgc291cmNlIHdpdGggcHJlLWNv\nbmZpZ3VyZWQgZGVmYXVsdCB1c2VyIG5hbWUgYW5kIHBhc3N3b3JkLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBEZWZhdWx0c0RhdGFTb3Vy\nY2UKICAgICAgICBleHRlbmRzIERlbGVnYXRpbmdEYXRhU291cmNlIHsKCiAg\nICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgX3VzZXI7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBTdHJpbmcgX3Bhc3M7CgogICAgICAgIHB1YmxpYyBEZWZh\ndWx0c0RhdGFTb3VyY2UoRGF0YVNvdXJjZSBkcywgU3RyaW5nIHVzZXIsIFN0\ncmluZyBwYXNzKSB7CiAgICAgICAgICAgIHN1cGVyKGRzKTsKICAgICAgICAg\nICAgX3VzZXIgPSB1c2VyOwogICAgICAgICAgICBfcGFzcyA9IHBhc3M7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgQ29ubmVjdGlvbiBnZXRDb25uZWN0\naW9uKCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHJldHVybiBzdXBlci5nZXRDb25uZWN0aW9uKF91c2VyLCBfcGFz\ncyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ29ubmVjdGlvbiBnZXRD\nb25uZWN0aW9uKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFzcykKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBz\ndXBlci5nZXRDb25uZWN0aW9uKHVzZXIsIHBhc3MpOwogICAgICAgIH0KICAg\nIH0KfQo=\n","encoding":"base64"}

