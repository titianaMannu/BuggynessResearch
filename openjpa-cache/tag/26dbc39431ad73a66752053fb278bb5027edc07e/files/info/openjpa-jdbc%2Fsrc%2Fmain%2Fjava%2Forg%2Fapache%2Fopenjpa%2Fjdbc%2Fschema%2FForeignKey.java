{"sha":"40df305eadc2f9951ba53d02b66afaed44acc9cc","node_id":"MDQ6QmxvYjIwNjM2NDo0MGRmMzA1ZWFkYzJmOTk1MWJhNTNkMDJiNjZhZmFlZDQ0YWNjOWNj","size":22810,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/40df305eadc2f9951ba53d02b66afaed44acc9cc","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFzaE1h\ncDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGls\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuU3RyaW5n\nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZh\nbGlkU3RhdGVFeGNlcHRpb247CgovKioKICogUmVwcmVzZW50cyBhIGRhdGFi\nYXNlIGZvcmVpZ24ga2V5OyBtYXkgYmUgYSBsb2dpY2FsIGtleSB3aXRoIG5v\nCiAqIGRhdGFiYXNlIHJlcHJlc2VudGF0aW9uLiBUaGlzIGNsYXNzIGNhbiBh\nbHNvIHJlcHJlc2VudCBhIHBhcnRpYWwga2V5LAogKiBhbGlnbmluZyB3aXRo\nIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICoKICogQGF1dGhvciBBYmUg\nV2hpdGUKICovCnB1YmxpYyBjbGFzcyBGb3JlaWduS2V5CiAgICBleHRlbmRz\nIENvbnN0cmFpbnQgewoKICAgIC8qKgogICAgICogTG9naWNhbCBmb3JlaWdu\nIGtleTsgbGlua3MgY29sdW1ucywgYnV0IGRvZXMgbm90IHBlcmZvcm0gYW55\nIGFjdGlvbgogICAgICogd2hlbiB0aGUgam9pbmVkIHByaW1hcnkga2V5IGNv\nbHVtbnMgYXJlIG1vZGlmaWVkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBBQ1RJT05fTk9ORSA9IDE7CgogICAgLyoqCiAgICAgKiBU\naHJvdyBhbiBleGNlcHRpb24gaWYgam9pbmVkIHByaW1hcnkga2V5IGNvbHVt\nbnMgYXJlIG1vZGlmaWVkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBBQ1RJT05fUkVTVFJJQ1QgPSAyOwoKICAgIC8qKgogICAgICog\nQ2FzY2FkZSBhbnkgbW9kaWZpY2F0aW9uIG9mIHRoZSBqb2luZWQgcHJpbWFy\neSBrZXkgY29sdW1ucyB0bwogICAgICogdGhpcyB0YWJsZS4gSWYgdGhlIGpv\naW5lZCBwcmltYXJ5IGtleSByb3cgaXMgZGVsZXRlZCwgdGhlIHJvdyBpbiB0\naGlzCiAgICAgKiB0YWJsZSB3aWxsIGFsc28gYmUgZGVsZXRlZC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQUNUSU9OX0NBU0NBREUg\nPSAzOwoKICAgIC8qKgogICAgICogTnVsbCB0aGUgbG9jYWwgY29sdW1ucyBp\nZiB0aGUgam9pbmVkIHByaW1hcnkga2V5IGNvbHVtbnMgYXJlIG1vZGlmaWVk\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBQ1RJT05f\nTlVMTCA9IDQ7CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGxvY2FsIGNvbHVt\nbnMgdG8gdGhlaXIgZGVmYXVsdCB2YWx1ZXMgaWYgdGhlIHByaW1hcnkga2V5\nCiAgICAgKiBjb2x1bW5zIGFyZSBtb2RpZmllZC4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgQUNUSU9OX0RFRkFVTFQgPSA1OwoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gCiAgICAg\nICAgTG9jYWxpemVyLmZvclBhY2thZ2UoRm9yZWlnbktleS5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBTdHJpbmcgX3BrVGFibGVOYW1lID0gbnVsbDsKICAgIHBy\naXZhdGUgU3RyaW5nIF9wa1NjaGVtYU5hbWUgPSBudWxsOwogICAgcHJpdmF0\nZSBTdHJpbmcgX3BrQ29sdW1uTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIGlu\ndCBfc2VxID0gMDsKCiAgICBwcml2YXRlIExpbmtlZEhhc2hNYXAgX2pvaW5z\nID0gbnVsbDsKICAgIHByaXZhdGUgTGlua2VkSGFzaE1hcCBfam9pbnNQSyA9\nIG51bGw7CiAgICBwcml2YXRlIExpbmtlZEhhc2hNYXAgX2NvbnN0cyA9IG51\nbGw7CiAgICBwcml2YXRlIExpbmtlZEhhc2hNYXAgX2NvbnN0c1BLID0gbnVs\nbDsKICAgIHByaXZhdGUgaW50IF9kZWxBY3Rpb24gPSBBQ1RJT05fTk9ORTsK\nICAgIHByaXZhdGUgaW50IF91cEFjdGlvbiA9IEFDVElPTl9OT05FOwogICAg\ncHJpdmF0ZSBpbnQgX2luZGV4ID0gMDsKCiAgICAvLyBjYWNoZWQgaXRlbXMK\nICAgIHByaXZhdGUgQ29sdW1uW10gX2xvY2FscyA9IG51bGw7CiAgICBwcml2\nYXRlIENvbHVtbltdIF9wa3MgPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3Rb\nXSBfY29uc3RWYWxzID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uW10gX2Nv\nbnN0Q29scyA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdFtdIF9jb25zdFZh\nbHNQSyA9IG51bGw7CiAgICBwcml2YXRlIENvbHVtbltdIF9jb25zdENvbHNQ\nSyA9IG51bGw7CiAgICBwcml2YXRlIFRhYmxlIF9wa1RhYmxlID0gbnVsbDsK\nICAgIHByaXZhdGUgQm9vbGVhbiBfYXV0b0Fzc2lnbiA9IG51bGw7CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZvcmVpZ24ga2V5IGFjdGlvbiBjb25z\ndGFudCBmb3IgdGhlIGdpdmVuIGFjdGlvbiBuYW1lLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIGludCBnZXRBY3Rpb24oU3RyaW5nIG5hbWUpIHsKICAg\nICAgICBpZiAobmFtZSA9PSBudWxsIHx8ICJub25lIi5lcXVhbHNJZ25vcmVD\nYXNlKG5hbWUpKQogICAgICAgICAgICByZXR1cm4gQUNUSU9OX05PTkU7CiAg\nICAgICAgaWYgKCJjYXNjYWRlIi5lcXVhbHNJZ25vcmVDYXNlKG5hbWUpKQog\nICAgICAgICAgICByZXR1cm4gQUNUSU9OX0NBU0NBREU7CiAgICAgICAgaWYg\nKCJkZWZhdWx0Ii5lcXVhbHNJZ25vcmVDYXNlKG5hbWUpKQogICAgICAgICAg\nICByZXR1cm4gQUNUSU9OX0RFRkFVTFQ7CiAgICAgICAgaWYgKCJyZXN0cmlj\ndCIuZXF1YWxzSWdub3JlQ2FzZShuYW1lKQogICAgICAgICAgICB8fCAiZXhj\nZXB0aW9uIi5lcXVhbHNJZ25vcmVDYXNlKG5hbWUpKQogICAgICAgICAgICBy\nZXR1cm4gQUNUSU9OX1JFU1RSSUNUOwogICAgICAgIGlmICgibnVsbCIuZXF1\nYWxzSWdub3JlQ2FzZShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIEFDVElP\nTl9OVUxMOwoKICAgICAgICAvLyBub3QgYSByZWNvZ25pemVkIGFjdGlvbjsg\nY2hlY2sgZm9yIHR5cG8KICAgICAgICBMaXN0IHJlY29nbml6ZWQgPSBBcnJh\neXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsgIm5vbmUiLCAiZXhjZXB0aW9uIiwK\nICAgICAgICAgICAgInJlc3RyaWN0IiwgImNhc2NhZGUiLCAibnVsbCIsICJk\nZWZhdWx0IiwgfSk7CiAgICAgICAgU3RyaW5nIGNsb3Nlc3QgPSBTdHJpbmdE\naXN0YW5jZS5nZXRDbG9zZXN0TGV2ZW5zaHRlaW5EaXN0YW5jZShuYW1lLAog\nICAgICAgICAgICByZWNvZ25pemVkLCAuNUYpOwoKICAgICAgICBTdHJpbmcg\nbXNnOwogICAgICAgIGlmIChjbG9zZXN0ICE9IG51bGwpCiAgICAgICAgICAg\nIG1zZyA9IF9sb2MuZ2V0KCJiYWQtZmstYWN0aW9uLWhpbnQiLCBuYW1lLCBj\nbG9zZXN0LCByZWNvZ25pemVkKQogICAgICAgICAgICAgICAgLmdldE1lc3Nh\nZ2UoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIG1zZyA9IF9sb2MuZ2V0\nKCJiYWQtZmstYWN0aW9uIiwgbmFtZSwgcmVjb2duaXplZCkuZ2V0TWVzc2Fn\nZSgpOwogICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24obXNnKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZm9y\nZWlnbiBrZXkgYWN0aW9uIG5hbWUgZm9yIHRoZSBnaXZlbiBhY3Rpb24gY29u\nc3RhbnQuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldEFj\ndGlvbk5hbWUoaW50IGFjdGlvbikgewogICAgICAgIHN3aXRjaCAoYWN0aW9u\nKSB7CiAgICAgICAgICAgIGNhc2UgQUNUSU9OX05PTkU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gIm5vbmUiOwogICAgICAgICAgICBjYXNlIEFDVElPTl9S\nRVNUUklDVDoKICAgICAgICAgICAgICAgIHJldHVybiAicmVzdHJpY3QiOwog\nICAgICAgICAgICBjYXNlIEFDVElPTl9DQVNDQURFOgogICAgICAgICAgICAg\nICAgcmV0dXJuICJjYXNjYWRlIjsKICAgICAgICAgICAgY2FzZSBBQ1RJT05f\nREVGQVVMVDoKICAgICAgICAgICAgICAgIHJldHVybiAiZGVmYXVsdCI7CiAg\nICAgICAgICAgIGNhc2UgQUNUSU9OX05VTEw6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gIm51bGwiOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihTdHJp\nbmcudmFsdWVPZihhY3Rpb24pKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBEZWZhdWx0IGNvbnN0cnVjdG9yLgogICAgICovCiAgICBwdWJs\naWMgRm9yZWlnbktleSgpIHsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0\ncnVjdG9yLgogICAgICoKICAgICAqIEBwYXJhbSBuYW1lIHRoZSBmb3JlaWdu\nIGtleSBuYW1lLCBpZiBhbnkKICAgICAqIEBwYXJhbSB0YWJsZSB0aGUgbG9j\nYWwgdGFibGUgb2YgdGhlIGZvcmVpZ24ga2V5CiAgICAgKi8KICAgIHB1Ymxp\nYyBGb3JlaWduS2V5KFN0cmluZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAg\nICAgIHN1cGVyKG5hbWUsIHRhYmxlKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0xvZ2ljYWwoKSB7CiAgICAgICAgcmV0dXJuIF9kZWxBY3Rpb24g\nPT0gQUNUSU9OX05PTkU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIHRoZSBwcmltYXJ5IGtleSBjb2x1bW5zIG9mIHRoaXMga2V5IGFyZSBhdXRv\nLWluY3JlbWVudGluZywgb3IKICAgICAqIHdoZXRoZXIgdGhleSB0aGVtc2Vs\ndmVzIGFyZSBtZW1iZXJzIG9mIGEgZm9yZWlnbiBrZXkgd2hvJ3MgcHJpbWFy\neSBrZXkKICAgICAqIGlzIGF1dG8taW5jcmVtZW50aW5nIChyZWN1cnNpbmcg\ndG8gYXJiaXRyYXJ5IGRlcHRoKS4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNQcmltYXJ5S2V5QXV0b0Fzc2lnbmVkKCkgewogICAgICAgIGlmIChf\nYXV0b0Fzc2lnbiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX2F1dG9B\nc3NpZ24uYm9vbGVhblZhbHVlKCk7CiAgICAgICAgcmV0dXJuIGlzUHJpbWFy\neUtleUF1dG9Bc3NpZ25lZChuZXcgQXJyYXlMaXN0KDMpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciB0byBjYWxjdWxhdGUgd2hldGhlciB0aGlz\nIGZvcmVpZ24ga2V5IGRlcGVuZHMgb24gYXV0by1hc3NpZ25lZCAKICAgICAq\nIGNvbHVtbnMuICBSZWN1cnNlcyBhcHByb3ByaWF0ZWx5IGlmIHRoZSBwcmlt\nYXJ5IGtleSBjb2x1bW5zIHRoaXMga2V5CiAgICAgKiBqb2lucyB0byBhcmUg\ndGhlbXNlbHZlcyBtZW1iZXJzIG9mIGEgZm9yZWlnbiBrZXkgdGhhdCBpcyBk\nZXBlbmRlbnQgb24KICAgICAqIGF1dG8tYXNzaWduZWQgY29sdW1ucy4gIENh\nY2hlcyBjYWxjdWxhdGVkIGF1dG8tYXNzaWduIHZhbHVlIGFzIGEgc2lkZSAK\nICAgICAqIGVmZmVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VlbiB0cmFj\nayBzZWVuIGZvcmVpZ24ga2V5cyB0byBwcmV2ZW50IGluZmluaXRlIHJlY3Vy\nc2lvbiBpbgogICAgICogdGhlIGNhc2Ugb2YgZm9yZWlnbiBrZXkgY3ljbGVz\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc1ByaW1hcnlLZXlBdXRv\nQXNzaWduZWQoTGlzdCBzZWVuKSB7CiAgICAgICAgaWYgKF9hdXRvQXNzaWdu\nICE9IG51bGwpIAogICAgICAgICAgICByZXR1cm4gX2F1dG9Bc3NpZ24uYm9v\nbGVhblZhbHVlKCk7CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBnZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGlmIChjb2xzLmxlbmd0aCA9PSAw\nKSB7CiAgICAgICAgICAgIF9hdXRvQXNzaWduID0gQm9vbGVhbi5GQUxTRTsK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmIChjb2xzW2ldLmlzQXV0b0Fzc2lnbmVkKCkpIHsKICAgICAg\nICAgICAgICAgIF9hdXRvQXNzaWduID0gQm9vbGVhbi5UUlVFOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIEZvcmVpZ25LZXlbXSBma3MgPSBfcGtUYWJsZS5nZXRGb3Jl\naWduS2V5cygpOwogICAgICAgIHNlZW4uYWRkKHRoaXMpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBmb3IgKGludCBqID0gMDsgaiA8IGZrcy5sZW5ndGg7IGorKykgewog\nICAgICAgICAgICAgICAgaWYgKCFma3Nbal0uY29udGFpbnNDb2x1bW4oY29s\nc1tpXSkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgICAgICBpZiAoIXNlZW4uY29udGFpbnMoZmtzW2pdKQogICAgICAgICAg\nICAgICAgICAgICYmIGZrc1tqXS5pc1ByaW1hcnlLZXlBdXRvQXNzaWduZWQo\nc2VlbikpIHsKICAgICAgICAgICAgICAgICAgICBfYXV0b0Fzc2lnbiA9IEJv\nb2xlYW4uVFJVRTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgX2F1dG9Bc3NpZ24gPSBCb29sZWFuLkZBTFNFOwogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9m\nIHRoZSBwcmltYXJ5IGtleSB0YWJsZS4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZyBnZXRQcmltYXJ5S2V5VGFibGVOYW1lKCkgewogICAgICAgIFRhYmxl\nIHRhYmxlID0gZ2V0UHJpbWFyeUtleVRhYmxlKCk7CiAgICAgICAgaWYgKHRh\nYmxlICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiB0YWJsZS5nZXROYW1l\nKCk7CiAgICAgICAgcmV0dXJuIF9wa1RhYmxlTmFtZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBwcmltYXJ5IGtleSB0YWJsZS4g\nWW91IGNhbiBvbmx5IHNldCB0aGUgcHJpbWFyeQogICAgICoga2V5IHRhYmxl\nIG5hbWUgb24gZm9yZWlnbiBrZXlzIHRoYXQgaGF2ZSBub3QgYWxyZWFkeSBi\nZWVuIGpvaW5lZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJpbWFy\neUtleVRhYmxlTmFtZShTdHJpbmcgcGtUYWJsZU5hbWUpIHsKICAgICAgICBp\nZiAoZ2V0UHJpbWFyeUtleVRhYmxlKCkgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwogICAgICAgIF9w\na1RhYmxlTmFtZSA9IHBrVGFibGVOYW1lOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIG5hbWUgb2YgdGhlIHByaW1hcnkga2V5IHRhYmxlJ3Mgc2NoZW1h\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFByaW1hcnlLZXlTY2hl\nbWFOYW1lKCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gZ2V0UHJpbWFyeUtl\neVRhYmxlKCk7CiAgICAgICAgaWYgKHRhYmxlICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiB0YWJsZS5nZXRTY2hlbWFOYW1lKCk7CiAgICAgICAgcmV0\ndXJuIF9wa1NjaGVtYU5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUg\nbmFtZSBvZiB0aGUgcHJpbWFyeSBrZXkgdGFibGUncyBzY2hlbWEuIFlvdSBj\nYW4gb25seSBzZXQgdGhlCiAgICAgKiBwcmltYXJ5IGtleSBzY2hlbWEgbmFt\nZSBvbiBmb3JlaWduIGtleXMgdGhhdCBoYXZlIG5vdCBhbHJlYWR5IGJlZW4K\nICAgICAqIGpvaW5lZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJp\nbWFyeUtleVNjaGVtYU5hbWUoU3RyaW5nIHBrU2NoZW1hTmFtZSkgewogICAg\nICAgIGlmIChnZXRQcmltYXJ5S2V5VGFibGUoKSAhPSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCk7CiAgICAg\nICAgX3BrU2NoZW1hTmFtZSA9IHBrU2NoZW1hTmFtZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBwcmltYXJ5IGtleSBjb2x1bW4u\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0UHJpbWFyeUtleUNvbHVt\nbk5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF9wa0NvbHVtbk5hbWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgcHJpbWFyeSBrZXkg\nY29sdW1uLiBZb3UgY2FuIG9ubHkgc2V0IHRoZQogICAgICogcHJpbWFyeSBr\nZXkgY29sdW1uIG5hbWUgb24gZm9yZWlnbiBrZXlzIHRoYXQgaGF2ZSBub3Qg\nYWxyZWFkeSBiZWVuCiAgICAgKiBqb2luZWQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFByaW1hcnlLZXlDb2x1bW5OYW1lKFN0cmluZyBwa0NvbHVt\nbk5hbWUpIHsKICAgICAgICBpZiAoZ2V0UHJpbWFyeUtleVRhYmxlKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2Vw\ndGlvbigpOwogICAgICAgIF9wa0NvbHVtbk5hbWUgPSBwa0NvbHVtbk5hbWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgc2VxdWVuY2Ugb2YgdGhpcyBq\nb2luIGluIHRoZSBmb3JlaWduIGtleS4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRLZXlTZXF1ZW5jZSgpIHsKICAgICAgICByZXR1cm4gX3NlcTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBzZXF1ZW5jZSBvZiB0aGlzIGpvaW4g\naW4gdGhlIGZvcmVpZ24ga2V5LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRLZXlTZXF1ZW5jZShpbnQgc2VxKSB7CiAgICAgICAgX3NlcSA9IHNlcTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZGVsZXRlIGFjdGlv\nbiBmb3IgdGhlIGtleS4gV2lsbCBiZSBvbmUgb2Y6CiAgICAgKiB7QGxpbmsg\nI0FDVElPTl9OT05FfSwge0BsaW5rICNBQ1RJT05fUkVTVFJJQ1R9LAogICAg\nICoge0BsaW5rICNBQ1RJT05fQ0FTQ0FERX0sIHtAbGluayAjQUNUSU9OX05V\nTEx9LCB7QGxpbmsgI0FDVElPTl9ERUZBVUxUfS4KICAgICAqLwogICAgcHVi\nbGljIGludCBnZXREZWxldGVBY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF9k\nZWxBY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGRlbGV0\nZSBhY3Rpb24gZm9yIHRoZSBrZXkuIE11c3QgYmUgb25lIG9mOgogICAgICog\ne0BsaW5rICNBQ1RJT05fTk9ORX0sIHtAbGluayAjQUNUSU9OX1JFU1RSSUNU\nfSwKICAgICAqIHtAbGluayAjQUNUSU9OX0NBU0NBREV9LCB7QGxpbmsgI0FD\nVElPTl9OVUxMfSwge0BsaW5rICNBQ1RJT05fREVGQVVMVH0uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldERlbGV0ZUFjdGlvbihpbnQgYWN0aW9uKSB7\nCiAgICAgICAgX2RlbEFjdGlvbiA9IGFjdGlvbjsKICAgICAgICBpZiAoYWN0\naW9uID09IEFDVElPTl9OT05FKQogICAgICAgICAgICBfdXBBY3Rpb24gPSBB\nQ1RJT05fTk9ORTsKICAgICAgICBlbHNlIGlmIChfdXBBY3Rpb24gPT0gQUNU\nSU9OX05PTkUpCiAgICAgICAgICAgIF91cEFjdGlvbiA9IEFDVElPTl9SRVNU\nUklDVDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdXBkYXRl\nIGFjdGlvbiBmb3IgdGhlIGtleS4gV2lsbCBiZSBvbmUgb2Y6CiAgICAgKiB7\nQGxpbmsgI0FDVElPTl9OT05FfSwge0BsaW5rICNBQ1RJT05fUkVTVFJJQ1R9\nLAogICAgICoge0BsaW5rICNBQ1RJT05fQ0FTQ0FERX0sIHtAbGluayAjQUNU\nSU9OX05VTEx9LCB7QGxpbmsgI0FDVElPTl9ERUZBVUxUfS4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRVcGRhdGVBY3Rpb24oKSB7CiAgICAgICAgcmV0\ndXJuIF91cEFjdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\ndXBkYXRlIGFjdGlvbiBmb3IgdGhlIGtleS4gTXVzdCBiZSBvbmUgb2Y6CiAg\nICAgKiB7QGxpbmsgI0FDVElPTl9OT05FfSwge0BsaW5rICNBQ1RJT05fUkVT\nVFJJQ1R9LAogICAgICoge0BsaW5rICNBQ1RJT05fQ0FTQ0FERX0sIHtAbGlu\nayAjQUNUSU9OX05VTEx9LCB7QGxpbmsgI0FDVElPTl9ERUZBVUxUfS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0VXBkYXRlQWN0aW9uKGludCBhY3Rp\nb24pIHsKICAgICAgICBfdXBBY3Rpb24gPSBhY3Rpb247CiAgICAgICAgaWYg\nKGFjdGlvbiA9PSBBQ1RJT05fTk9ORSkKICAgICAgICAgICAgX2RlbEFjdGlv\nbiA9IEFDVElPTl9OT05FOwogICAgICAgIGVsc2UgaWYgKF9kZWxBY3Rpb24g\nPT0gQUNUSU9OX05PTkUpCiAgICAgICAgICAgIF9kZWxBY3Rpb24gPSBBQ1RJ\nT05fUkVTVFJJQ1Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGZvcmVpZ24ga2V5J3MgMC1iYXNlZCBpbmRleCBpbiB0aGUgb3duaW5nIHRh\nYmxlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldEluZGV4KCkgewogICAg\nICAgIFRhYmxlIHRhYmxlID0gZ2V0VGFibGUoKTsKICAgICAgICBpZiAodGFi\nbGUgIT0gbnVsbCkKICAgICAgICAgICAgdGFibGUuaW5kZXhGb3JlaWduS2V5\ncygpOwogICAgICAgIHJldHVybiBfaW5kZXg7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgdGhlIGZvcmVpZ24ga2V5J3MgMC1iYXNlZCBpbmRleCBpbiB0\naGUgb3duaW5nIHRhYmxlLgogICAgICovCiAgICB2b2lkIHNldEluZGV4KGlu\ndCBpbmRleCkgewogICAgICAgIF9pbmRleCA9IGluZGV4OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmltYXJ5IGtleSBjb2x1bW4gam9p\nbmVkIHRvIHRoZSBnaXZlbiBsb2NhbCBjb2x1bW4uCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2x1bW4gZ2V0UHJpbWFyeUtleUNvbHVtbihDb2x1bW4gbG9jYWwp\nIHsKICAgICAgICByZXR1cm4gKF9qb2lucyA9PSBudWxsKSA/IG51bGwgOiAo\nQ29sdW1uKSBfam9pbnMuZ2V0KGxvY2FsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgbG9jYWwgY29sdW1uIGpvaW5lZCB0byB0aGUgZ2l2\nZW4gcHJpbWFyeSBrZXkgY29sdW1uLgogICAgICovCiAgICBwdWJsaWMgQ29s\ndW1uIGdldENvbHVtbihDb2x1bW4gcGspIHsKICAgICAgICByZXR1cm4gKF9q\nb2luc1BLID09IG51bGwpID8gbnVsbCA6IChDb2x1bW4pIF9qb2luc1BLLmdl\ndChwayk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbnN0\nYW50IHZhbHVlIGFzc2lnbmVkIHRvIHRoZSBnaXZlbiBsb2NhbCBjb2x1bW4u\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0Q29uc3RhbnQoQ29sdW1u\nIGxvY2FsKSB7CiAgICAgICAgcmV0dXJuIChfY29uc3RzID09IG51bGwpID8g\nbnVsbCA6IF9jb25zdHMuZ2V0KGxvY2FsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgY29uc3RhbnQgdmFsdWUgYXNzaWduZWQgdG8gdGhl\nIGdpdmVuIHByaW1hcnkga2V5IGNvbHVtbi4KICAgICAqLwogICAgcHVibGlj\nIE9iamVjdCBnZXRQcmltYXJ5S2V5Q29uc3RhbnQoQ29sdW1uIHBrKSB7CiAg\nICAgICAgcmV0dXJuIChfY29uc3RzUEsgPT0gbnVsbCkgPyBudWxsIDogX2Nv\nbnN0c1BLLmdldChwayk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGxvY2FsIGNvbHVtbnMgaW4gdGhlIGZvcmVpZ24ga2V5IGxvY2FsIHRh\nYmxlIG9yZGVyLgogICAgICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29s\ndW1ucygpIHsKICAgICAgICBpZiAoX2xvY2FscyA9PSBudWxsKQogICAgICAg\nICAgICBfbG9jYWxzID0gKF9qb2lucyA9PSBudWxsKSA/IFNjaGVtYXMuRU1Q\nVFlfQ09MVU1OUyA6IChDb2x1bW5bXSkKICAgICAgICAgICAgICAgIF9qb2lu\ncy5rZXlTZXQoKS50b0FycmF5KG5ldyBDb2x1bW5bX2pvaW5zLnNpemUoKV0p\nOwogICAgICAgIHJldHVybiBfbG9jYWxzOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBjb25zdGFudCB2YWx1ZXMgYXNzaWduZWQgdG8gdGhl\nIGxvY2FsIGNvbHVtbnMKICAgICAqIHJldHVybmVkIGJ5IHtAbGluayAjZ2V0\nQ29uc3RhbnRDb2x1bW5zfS4KICAgICAqLwogICAgcHVibGljIE9iamVjdFtd\nIGdldENvbnN0YW50cygpIHsKICAgICAgICBpZiAoX2NvbnN0VmFscyA9PSBu\ndWxsKQogICAgICAgICAgICBfY29uc3RWYWxzID0gKF9jb25zdHMgPT0gbnVs\nbCkgPyBTY2hlbWFzLkVNUFRZX1ZBTFVFUwogICAgICAgICAgICAgICAgOiBf\nY29uc3RzLnZhbHVlcygpLnRvQXJyYXkoKTsKICAgICAgICByZXR1cm4gX2Nv\nbnN0VmFsczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29u\nc3RhbnQgdmFsdWVzIGFzc2lnbmVkIHRvIHRoZSBwcmltYXJ5IGtleSBjb2x1\nbW5zCiAgICAgKiByZXR1cm5lZCBieSB7QGxpbmsgI2dldENvbnN0YW50UHJp\nbWFyeUtleUNvbHVtbnN9LgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10g\nZ2V0UHJpbWFyeUtleUNvbnN0YW50cygpIHsKICAgICAgICBpZiAoX2NvbnN0\nVmFsc1BLID09IG51bGwpCiAgICAgICAgICAgIF9jb25zdFZhbHNQSyA9IChf\nY29uc3RzUEsgPT0gbnVsbCkgPyBTY2hlbWFzLkVNUFRZX1ZBTFVFUwogICAg\nICAgICAgICAgICAgOiBfY29uc3RzUEsudmFsdWVzKCkudG9BcnJheSgpOwog\nICAgICAgIHJldHVybiBfY29uc3RWYWxzUEs7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZmsgaW5jbHVkZXMgdGhlIGdpdmVu\nIGxvY2FsIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gY29u\ndGFpbnNDb2x1bW4oQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBfam9p\nbnMgIT0gbnVsbCAmJiBfam9pbnMuY29udGFpbnNLZXkoY29sKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBmayBpbmNsdWRl\ncyB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgY29sdW1uLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBjb250YWluc1ByaW1hcnlLZXlDb2x1bW4oQ29sdW1u\nIGNvbCkgewogICAgICAgIHJldHVybiBfam9pbnNQSyAhPSBudWxsICYmIF9q\nb2luc1BLLmNvbnRhaW5zS2V5KGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZmsgaW5jbHVkZXMgdGhlIGdpdmVuIGxv\nY2FsIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gY29udGFp\nbnNDb25zdGFudENvbHVtbihDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJu\nIF9jb25zdHMgIT0gbnVsbCAmJiBfY29uc3RzLmNvbnRhaW5zS2V5KGNvbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZmsg\naW5jbHVkZXMgdGhlIGdpdmVuIHByaW1hcnkga2V5IGNvbHVtbi4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNDb25zdGFudFByaW1hcnlL\nZXlDb2x1bW4oQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBfY29uc3Rz\nUEsgIT0gbnVsbCAmJiBfY29uc3RzUEsuY29udGFpbnNLZXkoY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZm9yZWlnbiBjb2x1bW5z\nIGluIHRoZSBmb3JlaWduIGtleSwgaW4gam9pbi1vcmRlciB3aXRoCiAgICAg\nKiB0aGUgcmVzdWx0IG9mIHtAbGluayAjZ2V0Q29sdW1uc30uCiAgICAgKi8K\nICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRQcmltYXJ5S2V5Q29sdW1ucygpIHsK\nICAgICAgICBpZiAoX3BrcyA9PSBudWxsKQogICAgICAgICAgICBfcGtzID0g\nKF9qb2lucyA9PSBudWxsKSA/IFNjaGVtYXMuRU1QVFlfQ09MVU1OUyA6IChD\nb2x1bW5bXSkKICAgICAgICAgICAgICAgIF9qb2lucy52YWx1ZXMoKS50b0Fy\ncmF5KG5ldyBDb2x1bW5bX2pvaW5zLnNpemUoKV0pOwogICAgICAgIHJldHVy\nbiBfcGtzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsb2Nh\nbCBjb2x1bW5zIHRoYXQgd2UgbGluayB0byB1c2luZyBjb25zdGFudCB2YWx1\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb25zdGFudENv\nbHVtbnMoKSB7CiAgICAgICAgaWYgKF9jb25zdENvbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgX2NvbnN0Q29scyA9IChfY29uc3RzID09IG51bGwpID8gU2No\nZW1hcy5FTVBUWV9DT0xVTU5TIDogKENvbHVtbltdKQogICAgICAgICAgICAg\nICAgX2NvbnN0cy5rZXlTZXQoKS50b0FycmF5KG5ldyBDb2x1bW5bX2NvbnN0\ncy5zaXplKCldKTsKICAgICAgICByZXR1cm4gX2NvbnN0Q29sczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJpbWFyeSBrZXkgY29sdW1u\ncyB0aGF0IHdlIGxpbmsgdG8gdXNpbmcgY29uc3RhbnQgdmFsdWVzLgogICAg\nICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29uc3RhbnRQcmltYXJ5S2V5\nQ29sdW1ucygpIHsKICAgICAgICBpZiAoX2NvbnN0Q29sc1BLID09IG51bGwp\nCiAgICAgICAgICAgIF9jb25zdENvbHNQSyA9IChfY29uc3RzUEsgPT0gbnVs\nbCkgPyBTY2hlbWFzLkVNUFRZX0NPTFVNTlMgOgogICAgICAgICAgICAgICAg\nKENvbHVtbltdKSBfY29uc3RzUEsua2V5U2V0KCkudG9BcnJheQogICAgICAg\nICAgICAgICAgICAgIChuZXcgQ29sdW1uW19jb25zdHNQSy5zaXplKCldKTsK\nICAgICAgICByZXR1cm4gX2NvbnN0Q29sc1BLOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBmb3JlaWduIGtleSdzIGpvaW5zLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRKb2lucyhDb2x1bW5bXSBjb2xzLCBDb2x1bW5b\nXSBwa0NvbHMpIHsKICAgICAgICBDb2x1bW5bXSBjdXIgPSBnZXRDb2x1bW5z\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjdXIubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIHJlbW92ZUpvaW4oY3VyW2ldKTsKCiAgICAgICAg\naWYgKGNvbHMgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgam9pbihj\nb2xzW2ldLCBwa0NvbHNbaV0pOwogICAgfQoKICAgIC8qKgogICAgICogU2V0\nIHRoZSBmb3JlaWduIGtleSdzIGNvbnN0YW50IGpvaW5zLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRDb25zdGFudEpvaW5zKE9iamVjdFtdIGNvbnN0\ncywgQ29sdW1uW10gcGtDb2xzKSB7CiAgICAgICAgQ29sdW1uW10gY3VyID0g\nZ2V0Q29uc3RhbnRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY3VyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBy\nZW1vdmVKb2luKGN1cltpXSk7CgogICAgICAgIGlmIChjb25zdHMgIT0gbnVs\nbCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zdHMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBqb2luQ29uc3RhbnQoY29uc3Rz\nW2ldLCBwa0NvbHNbaV0pOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBmb3JlaWduIGtleSdzIGNvbnN0YW50IGpvaW5zLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRDb25zdGFudEpvaW5zKENvbHVtbltdIGNvbHMsIE9i\namVjdFtdIGNvbnN0cykgewogICAgICAgIENvbHVtbltdIGN1ciA9IGdldENv\nbnN0YW50Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY3VyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVKb2luKGN1cltp\nXSk7CgogICAgICAgIGlmIChjb25zdHMgIT0gbnVsbCkKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjb25zdHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgICAgICBqb2luQ29uc3RhbnQoY29sc1tpXSwgY29uc3RzW2ldKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEpvaW4gYSBsb2NhbCBjb2x1bW4gdG8g\nYSBwcmltYXJ5IGtleSBjb2x1bW4gb2YgYW5vdGhlciB0YWJsZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgam9pbihDb2x1bW4gbG9jYWwsIENvbHVtbiB0\nb1BLKSB7CiAgICAgICAgaWYgKCFPYmplY3RVdGlscy5lcXVhbHMobG9jYWwu\nZ2V0VGFibGUoKSwgZ2V0VGFibGUoKSkpCiAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInRhYmxlLW1pc21h\ndGNoIiwKICAgICAgICAgICAgICAgIGxvY2FsLmdldFRhYmxlKCksIGdldFRh\nYmxlKCkpKTsKCiAgICAgICAgVGFibGUgcGtUYWJsZSA9IHRvUEsuZ2V0VGFi\nbGUoKTsKICAgICAgICBpZiAoX3BrVGFibGUgIT0gbnVsbCAmJiAhX3BrVGFi\nbGUuZXF1YWxzKHBrVGFibGUpKQogICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJmay1taXNtYXRjaCIsCiAg\nICAgICAgICAgICAgICBwa1RhYmxlLCBfcGtUYWJsZSkpOwoKICAgICAgICBf\ncGtUYWJsZSA9IHBrVGFibGU7CiAgICAgICAgaWYgKF9qb2lucyA9PSBudWxs\nKQogICAgICAgICAgICBfam9pbnMgPSBuZXcgTGlua2VkSGFzaE1hcCgpOwog\nICAgICAgIF9qb2lucy5wdXQobG9jYWwsIHRvUEspOwogICAgICAgIGlmIChf\nam9pbnNQSyA9PSBudWxsKQogICAgICAgICAgICBfam9pbnNQSyA9IG5ldyBM\naW5rZWRIYXNoTWFwKCk7CiAgICAgICAgX2pvaW5zUEsucHV0KHRvUEssIGxv\nY2FsKTsKCiAgICAgICAgLy8gZm9yY2UgcmUtY2FjaGUKICAgICAgICBfbG9j\nYWxzID0gbnVsbDsKICAgICAgICBfcGtzID0gbnVsbDsKICAgICAgICBpZiAo\nX2F1dG9Bc3NpZ24gPT0gQm9vbGVhbi5GQUxTRSkKICAgICAgICAgICAgX2F1\ndG9Bc3NpZ24gPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogSm9pbiBh\nIGNvbnN0YW50IHZhbHVlIHRvIGEgcHJpbWFyeSBrZXkgY29sdW1uIG9mIGFu\nb3RoZXIgdGFibGUuIFRoZQogICAgICogY29uc3RhbnQgbXVzdCBiZSBlaXRo\nZXIgYSBzdHJpbmcgb3IgYSBudW1iZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGpvaW5Db25zdGFudChPYmplY3QgdmFsLCBDb2x1bW4gdG9QSykgewog\nICAgICAgIFRhYmxlIHBrVGFibGUgPSB0b1BLLmdldFRhYmxlKCk7CiAgICAg\nICAgaWYgKF9wa1RhYmxlICE9IG51bGwgJiYgIV9wa1RhYmxlLmVxdWFscyhw\na1RhYmxlKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgiZmstbWlzbWF0Y2giLAogICAgICAgICAgICAg\nICAgcGtUYWJsZSwgX3BrVGFibGUpKTsKCiAgICAgICAgX3BrVGFibGUgPSBw\na1RhYmxlOwogICAgICAgIGlmIChfY29uc3RzUEsgPT0gbnVsbCkKICAgICAg\nICAgICAgX2NvbnN0c1BLID0gbmV3IExpbmtlZEhhc2hNYXAoKTsKICAgICAg\nICBfY29uc3RzUEsucHV0KHRvUEssIHZhbCk7CgogICAgICAgIC8vIGZvcmNl\nIHJlLWNhY2hlCiAgICAgICAgX2NvbnN0VmFsc1BLID0gbnVsbDsKICAgICAg\nICBfY29uc3RDb2xzUEsgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nSm9pbiBhIGNvbnN0YW50IHZhbHVlIHRvIGEgbG9jYWwgY29sdW1uIG9mIHRo\naXMgdGFibGUuIFRoZQogICAgICogY29uc3RhbnQgbXVzdCBiZSBlaXRoZXIg\nYSBzdHJpbmcgb3IgYSBudW1iZXIuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGpvaW5Db25zdGFudChDb2x1bW4gY29sLCBPYmplY3QgdmFsKSB7CiAgICAg\nICAgaWYgKF9jb25zdHMgPT0gbnVsbCkKICAgICAgICAgICAgX2NvbnN0cyA9\nIG5ldyBMaW5rZWRIYXNoTWFwKCk7CiAgICAgICAgX2NvbnN0cy5wdXQoY29s\nLCB2YWwpOwoKICAgICAgICAvLyBmb3JjZSByZS1jYWNoZQogICAgICAgIF9j\nb25zdFZhbHMgPSBudWxsOwogICAgICAgIF9jb25zdENvbHMgPSBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGFueSBqb2lucyBpbm9sdmlu\nZyB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiB0aGUgam9pbiB3YXMgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IHBhcnQg\nb2YgdGhlIGtleQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVK\nb2luKENvbHVtbiBjb2wpIHsKICAgICAgICBib29sZWFuIHJlbWQgPSBmYWxz\nZTsKICAgICAgICBPYmplY3QgcmVtOwoKICAgICAgICBpZiAoX2pvaW5zICE9\nIG51bGwpIHsKICAgICAgICAgICAgcmVtID0gX2pvaW5zLnJlbW92ZShjb2wp\nOwogICAgICAgICAgICBpZiAocmVtICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIF9sb2NhbHMgPSBudWxsOwogICAgICAgICAgICAgICAgX3BrcyA9IG51\nbGw7CiAgICAgICAgICAgICAgICBfam9pbnNQSy5yZW1vdmUocmVtKTsKICAg\nICAgICAgICAgICAgIHJlbWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpZiAoX2pvaW5zUEsgIT0gbnVsbCkgewogICAgICAg\nICAgICByZW0gPSBfam9pbnNQSy5yZW1vdmUoY29sKTsKICAgICAgICAgICAg\naWYgKHJlbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfbG9jYWxzID0g\nbnVsbDsKICAgICAgICAgICAgICAgIF9wa3MgPSBudWxsOwogICAgICAgICAg\nICAgICAgX2pvaW5zLnJlbW92ZShyZW0pOwogICAgICAgICAgICAgICAgcmVt\nZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChfY29uc3RzICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9jb25zdHMu\ncmVtb3ZlKGNvbCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2NvbnN0\nVmFscyA9IG51bGw7CiAgICAgICAgICAgICAgICBfY29uc3RDb2xzID0gbnVs\nbDsKICAgICAgICAgICAgICAgIHJlbWQgPSB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoX2NvbnN0c1BLICE9IG51bGwpIHsK\nICAgICAgICAgICAgaWYgKF9jb25zdHNQSy5jb250YWluc0tleShjb2wpKSB7\nCiAgICAgICAgICAgICAgICBfY29uc3RzUEsucmVtb3ZlKGNvbCk7CiAgICAg\nICAgICAgICAgICBfY29uc3RWYWxzUEsgPSBudWxsOwogICAgICAgICAgICAg\nICAgX2NvbnN0Q29sc1BLID0gbnVsbDsKICAgICAgICAgICAgICAgIHJlbWQg\nPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\nKF9qb2lucyA9PSBudWxsIHx8IF9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICYmIChfY29uc3RzUEsgPT0gbnVsbCB8fCBfY29uc3RzUEsuaXNFbXB0\neSgpKSkKICAgICAgICAgICAgX3BrVGFibGUgPSBudWxsOwogICAgICAgIGlm\nIChyZW1kICYmIF9hdXRvQXNzaWduID09IEJvb2xlYW4uVFJVRSkKICAgICAg\nICAgICAgX2F1dG9Bc3NpZ24gPSBudWxsOwogICAgICAgIHJldHVybiByZW1k\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdGFibGUgdGhp\ncyBmb3JlaWduIGtleSBpcyBsaW5raW5nIHRvLCBpZiBpdCBpcyBrbm93biB5\nZXQuCiAgICAgKi8KICAgIHB1YmxpYyBUYWJsZSBnZXRQcmltYXJ5S2V5VGFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIF9wa1RhYmxlOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVmIGFsbCBjb2x1bW5zIGluIHRoaXMga2V5LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCByZWZDb2x1bW5zKCkgewogICAgICAgIENvbHVt\nbltdIGNvbHMgPSBnZXRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjb2xzW2ld\nLnJlZigpOwogICAgICAgIGNvbHMgPSBnZXRDb25zdGFudENvbHVtbnMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKysp\nCiAgICAgICAgICAgIGNvbHNbaV0ucmVmKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBEZXJlZiBhbGwgY29sdW1ucyBpbiB0aGlzIGtleS4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgZGVyZWZDb2x1bW5zKCkgewogICAgICAgIENvbHVt\nbltdIGNvbHMgPSBnZXRDb2x1bW5zKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBjb2xzW2ld\nLmRlcmVmKCk7CiAgICAgICAgY29scyA9IGdldENvbnN0YW50Q29sdW1ucygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgY29sc1tpXS5kZXJlZigpOwogICAgfQoKICAgIC8q\nKgogICAgICogRm9yZWlnbiBrZXlzIGFyZSBlcXVhbCBpZiB0aGUgc2F0aXNm\neSB0aGUgZXF1YWxpdHkgY29uc3RyYWludHMgb2YKICAgICAqIHtAbGluayBD\nb25zdHJhaW50fSBhbmQgdGhleSBoYXZlIHRoZSBzYW1lIGxvY2FsIGFuZCBw\ncmltYXJ5IGtleQogICAgICogY29sdW1ucyBhbmQgYWN0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHNGb3JlaWduS2V5KEZvcmVpZ25L\nZXkgZmspIHsKICAgICAgICBpZiAoZmsgPT0gdGhpcykKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKGdldERlbGV0ZUFjdGlv\nbigpICE9IGZrLmdldERlbGV0ZUFjdGlvbigpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKGlzRGVmZXJyZWQoKSAhPSBmay5pc0Rl\nZmVycmVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAg\naWYgKCFjb2x1bW5zTWF0Y2goZmsuZ2V0Q29sdW1ucygpLCBmay5nZXRQcmlt\nYXJ5S2V5Q29sdW1ucygpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmICghbWF0Y2goZ2V0Q29uc3RhbnRDb2x1bW5zKCksIGZrLmdl\ndENvbnN0YW50Q29sdW1ucygpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIGlmICghbWF0Y2goZ2V0Q29uc3RhbnRzKCksIGZrLmdldENv\nbnN0YW50cygpKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmICghbWF0Y2goZ2V0Q29uc3RhbnRQcmltYXJ5S2V5Q29sdW1ucygpLAog\nICAgICAgICAgICBmay5nZXRDb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFtYXRj\naChnZXRQcmltYXJ5S2V5Q29uc3RhbnRzKCksIGZrLmdldFByaW1hcnlLZXlD\nb25zdGFudHMoKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\ncnVlIGlmIHRoZSBnaXZlbiBsb2NhbCBhbmQgZm9yZWlnbiBjb2x1bW5zIG1h\ndGNoIHRob3NlCiAgICAgKiBvbiB0aGlzIGtleS4gVGhpcyBjYW4gYmUgdXNl\nZCB0byBmaW5kIGZvcmVpZ24ga2V5cyBnaXZlbiBvbmx5CiAgICAgKiBjb2x1\nbW4gbGlua2luZyBpbmZvcm1hdGlvbi4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gY29sdW1uc01hdGNoKENvbHVtbltdIGZrQ29scywgQ29sdW1uW10g\nZmtQS0NvbHMpIHsKICAgICAgICByZXR1cm4gbWF0Y2goZ2V0Q29sdW1ucygp\nLCBma0NvbHMpCiAgICAgICAgICAgICYmIG1hdGNoKGdldFByaW1hcnlLZXlD\nb2x1bW5zKCksIGZrUEtDb2xzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENo\nZWNrcyBmb3Igbm9uLW51bGxhYmxlIGxvY2FsIGNvbHVtbnMuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGhhc05vdE51bGxDb2x1bW5zKCkgewogICAg\nICBDb2x1bW5bXSBjb2x1bW5zID0gZ2V0Q29sdW1ucygpOwogICAgICBmb3Ig\nKGludCBqID0gMDsgaiA8IGNvbHVtbnMubGVuZ3RoOyBqKyspIHsKICAgICAg\nICAgIGlmIChjb2x1bW5zW2pdLmlzTm90TnVsbCgpKSB7CiAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBib29s\nZWFuIG1hdGNoKENvbHVtbltdIGNvbHMsIENvbHVtbltdIGZrQ29scykgewog\nICAgICAgIGlmIChjb2xzLmxlbmd0aCAhPSBma0NvbHMubGVuZ3RoKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBma0NvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmICghaGFz\nQ29sdW1uKGNvbHMsIGZrQ29sc1tpXSkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiBoYXNDb2x1bW4oQ29sdW1uW10gY29scywg\nQ29sdW1uIGNvbCkgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29s\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbHNbaV0uZ2V0RnVs\nbE5hbWUoKS5lcXVhbHNJZ25vcmVDYXNlKGNvbC5nZXRGdWxsTmFtZSgpKSkK\nICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIG1hdGNo\nKE9iamVjdFtdIHZhbHMsIE9iamVjdFtdIGZrVmFscykgewogICAgICAgIGlm\nICh2YWxzLmxlbmd0aCAhPSBma1ZhbHMubGVuZ3RoKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB2YWxz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoIU9iamVjdFV0aWxzLmVx\ndWFscyh2YWxzW2ldLCBma1ZhbHNbaV0pKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9Cg==\n","encoding":"base64"}

