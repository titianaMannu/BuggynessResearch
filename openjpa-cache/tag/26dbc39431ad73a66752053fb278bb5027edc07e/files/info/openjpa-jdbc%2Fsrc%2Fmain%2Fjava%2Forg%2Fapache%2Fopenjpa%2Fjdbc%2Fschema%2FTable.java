{"sha":"1f834b9600d9bd0269bbf183a61ff23e75545b69","node_id":"MDQ6QmxvYjIwNjM2NDoxZjgzNGI5NjAwZDliZDAyNjliYmYxODNhNjFmZjIzZTc1NTQ1YjY5","size":21333,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1f834b9600d9bd0269bbf183a61ff23e75545b69","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWE7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5UcmVlTWFwOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZEhhc2hNYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJh\nY2tlcjsKCi8qKgogKiBSZXByZXNlbnRzIGEgZGF0YWJhc2UgdGFibGUuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgU3RlcGhlbiBLaW0K\nICovCnB1YmxpYyBjbGFzcyBUYWJsZQogICAgZXh0ZW5kcyBOYW1lU2V0CiAg\nICBpbXBsZW1lbnRzIENvbXBhcmFibGUsIFNvdXJjZVRyYWNrZXIgewoKICAg\nIHByaXZhdGUgU3RyaW5nIF9uYW1lID0gbnVsbDsKICAgIHByaXZhdGUgU3Ry\naW5nIF9zY2hlbWFOYW1lID0gbnVsbDsKICAgIHByaXZhdGUgTWFwIF9jb2xN\nYXAgPSBudWxsOwogICAgcHJpdmF0ZSBNYXAgX2lkeE1hcCA9IG51bGw7CiAg\nICBwcml2YXRlIENvbGxlY3Rpb24gX2ZrTGlzdCA9IG51bGw7CiAgICBwcml2\nYXRlIENvbGxlY3Rpb24gX3VucUxpc3QgPSBudWxsOwogICAgcHJpdmF0ZSBT\nY2hlbWEgX3NjaGVtYSA9IG51bGw7CiAgICBwcml2YXRlIFByaW1hcnlLZXkg\nX3BrID0gbnVsbDsKCiAgICAvLyBrZWVwIHRyYWNrIG9mIHNvdXJjZQogICAg\ncHJpdmF0ZSBGaWxlIF9zb3VyY2UgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQg\nX3NyY1R5cGUgPSBTUkNfT1RIRVI7CgogICAgLy8gY2FjaGUKICAgIHByaXZh\ndGUgU3RyaW5nIF9mdWxsTmFtZSA9IG51bGw7CiAgICBwcml2YXRlIENvbHVt\nbltdIF9jb2xzID0gbnVsbDsKICAgIHByaXZhdGUgQ29sdW1uW10gX2F1dG9B\nc3NpZ24gPSBudWxsOwogICAgcHJpdmF0ZSBDb2x1bW5bXSBfcmVscyA9IG51\nbGw7CiAgICBwcml2YXRlIEZvcmVpZ25LZXlbXSBfZmtzID0gbnVsbDsKICAg\nIHByaXZhdGUgSW5kZXhbXSBfaWR4cyA9IG51bGw7CiAgICBwcml2YXRlIFVu\naXF1ZVtdIF91bnFzID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9jb21t\nZW50ID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9saW5lTnVtID0gMDsgIAog\nICAgcHJpdmF0ZSBpbnQgX2NvbE51bSA9IDA7ICAKCiAgICAvKioKICAgICAq\nIERlZmF1bHQgY29uc3RydWN0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBUYWJs\nZSgpIHsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLgogICAg\nICoKICAgICAqIEBwYXJhbSBuYW1lIHRoZSB0YWJsZSBuYW1lCiAgICAgKiBA\ncGFyYW0gc2NoZW1hIHRoZSB0YWJsZSBzY2hlbWEKICAgICAqLwogICAgcHVi\nbGljIFRhYmxlKFN0cmluZyBuYW1lLCBTY2hlbWEgc2NoZW1hKSB7CiAgICAg\nICAgc2V0TmFtZShuYW1lKTsKICAgICAgICBhZGROYW1lKG5hbWUsIHRydWUp\nOwogICAgICAgIGlmIChzY2hlbWEgIT0gbnVsbCkKICAgICAgICAgICAgc2V0\nU2NoZW1hTmFtZShzY2hlbWEuZ2V0TmFtZSgpKTsKICAgICAgICBfc2NoZW1h\nID0gc2NoZW1hOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGVkIHdoZW4g\ndGhlIHRhYmxlIGlzIHJlbW92ZWQgZnJvbSBpdHMgc2NoZW1hLiBSZW1vdmVz\nIGFsbCB0YWJsZQogICAgICogbWVtYmVycywgYW5kIGludmFsaWRhdGVzIHRo\nZSB0YWJsZS4KICAgICAqLwogICAgdm9pZCByZW1vdmUoKSB7CiAgICAgICAg\nRm9yZWlnbktleVtdIGZrcyA9IGdldEZvcmVpZ25LZXlzKCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBma3MubGVuZ3RoOyBpKyspCiAgICAgICAg\nICAgIHJlbW92ZUZvcmVpZ25LZXkoZmtzW2ldKTsKICAgICAgICBJbmRleFtd\nIGlkeHMgPSBnZXRJbmRleGVzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBpZHhzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVJbmRl\neChpZHhzW2ldKTsKICAgICAgICBVbmlxdWVbXSB1bnFzID0gZ2V0VW5pcXVl\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5xcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgcmVtb3ZlVW5pcXVlKHVucXNbaV0pOwogICAg\nICAgIHJlbW92ZVByaW1hcnlLZXkoKTsKICAgICAgICBDb2x1bW5bXSBjb2xz\nID0gZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgcmVtb3ZlQ29sdW1uKGNv\nbHNbaV0pOwogICAgICAgIF9zY2hlbWEgPSBudWxsOwogICAgICAgIF9zY2hl\nbWFOYW1lID0gbnVsbDsKICAgICAgICBfZnVsbE5hbWUgPSBudWxsOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzY2hlbWEgZm9yIHRoZSB0\nYWJsZS4KICAgICAqLwogICAgcHVibGljIFNjaGVtYSBnZXRTY2hlbWEoKSB7\nCiAgICAgICAgcmV0dXJuIF9zY2hlbWE7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgdGFibGUncyBzY2hlbWEgbmFtZS4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZyBnZXRTY2hlbWFOYW1lKCkgewogICAgICAgIHJldHVybiBfc2No\nZW1hTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSB0YWJsZSdzIHNj\naGVtYSBuYW1lLiBZb3UgY2FuIG9ubHkgY2FsbCB0aGlzIG1ldGhvZCBvbiB0\nYWJsZXMKICAgICAqIHdob3NlIHNjaGVtYSBvYmplY3QgaXMgbm90IHNldC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U2NoZW1hTmFtZShTdHJpbmcg\nbmFtZSkgewogICAgICAgIGlmIChnZXRTY2hlbWEoKSAhPSBudWxsKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCk7CiAg\nICAgICAgX3NjaGVtYU5hbWUgPSBuYW1lOwogICAgICAgIF9mdWxsTmFtZSA9\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUg\nb2YgdGhlIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldE5h\nbWUoKSB7CiAgICAgICAgcmV0dXJuIF9uYW1lOwogICAgfQoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBuYW1lIG9mIHRoZSB0YWJsZS4gVGhpcyBtZXRob2Qg\nY2FuIG9ubHkgYmUgY2FsbGVkIG9uIHRhYmxlcwogICAgICogdGhhdCBhcmUg\nbm90IHBhcnQgb2YgYSBzY2hlbWEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoZ2V0U2NoZW1h\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0\nZUV4Y2VwdGlvbigpOwogICAgICAgIF9uYW1lID0gbmFtZTsKICAgICAgICBf\nZnVsbE5hbWUgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSB0YWJsZSBuYW1lLCBpbmNsdWRpbmcgc2NoZW1hLCB1c2luZyAnLicg\nYXMgdGhlCiAgICAgKiBjYXRhbG9nIHNlcGFyYXRvci4KICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXRGdWxsTmFtZSgpIHsKICAgICAgICBpZiAoX2Z1\nbGxOYW1lID09IG51bGwpIHsKICAgICAgICAgICAgU2NoZW1hIHNjaGVtYSA9\nIGdldFNjaGVtYSgpOwogICAgICAgICAgICBpZiAoc2NoZW1hID09IG51bGwg\nfHwgc2NoZW1hLmdldE5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICAgICAg\nX2Z1bGxOYW1lID0gZ2V0TmFtZSgpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBfZnVsbE5hbWUgPSBzY2hlbWEuZ2V0TmFtZSgpICsgIi4i\nICsgZ2V0TmFtZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Z1bGxO\nYW1lOwogICAgfQoKICAgIHB1YmxpYyBGaWxlIGdldFNvdXJjZUZpbGUoKSB7\nCiAgICAgICAgcmV0dXJuIF9zb3VyY2U7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBnZXRTb3VyY2VTY29wZSgpIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFNvdXJjZVR5cGUoKSB7CiAgICAg\nICAgcmV0dXJuIF9zcmNUeXBlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndFNvdXJjZShGaWxlIHNvdXJjZSwgaW50IHNyY1R5cGUpIHsKICAgICAgICBf\nc291cmNlID0gc291cmNlOwogICAgICAgIF9zcmNUeXBlID0gc3JjVHlwZTsK\nICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFJlc291cmNlTmFtZSgpIHsK\nICAgICAgICByZXR1cm4gZ2V0RnVsbE5hbWUoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgdGFibGUncyBjb2x1bW5zLCBpbiBhbHBoYWJl\ndGljYWwgb3JkZXIuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRD\nb2x1bW5zKCkgewogICAgICAgIGlmIChfY29scyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChfY29sTWFwID09IG51bGwpCiAgICAgICAgICAgICAgICBf\nY29scyA9IFNjaGVtYXMuRU1QVFlfQ09MVU1OUzsKICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gbmV3IENvbHVt\nbltfY29sTWFwLnNpemUoKV07CiAgICAgICAgICAgICAgICBJdGVyYXRvciBp\ndHIgPSBfY29sTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7CiAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaXRyLmhhc05leHQoKTsgaSsrKSB7CiAg\nICAgICAgICAgICAgICAgICAgY29sc1tpXSA9IChDb2x1bW4pIGl0ci5uZXh0\nKCk7CiAgICAgICAgICAgICAgICAgICAgY29sc1tpXS5zZXRJbmRleChpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9jb2xzID0gY29s\nczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Nv\nbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhpcyB0YWJsZSdz\nIGF1dG8tYXNzaWduZWQgY29sdW1ucy4KICAgICAqLwogICAgcHVibGljIENv\nbHVtbltdIGdldEF1dG9Bc3NpZ25lZENvbHVtbnMoKSB7CiAgICAgICAgaWYg\nKF9hdXRvQXNzaWduID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9jb2xN\nYXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9hdXRvQXNzaWduID0gU2No\nZW1hcy5FTVBUWV9DT0xVTU5TOwogICAgICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgICAgIENvbGxlY3Rpb24gYXV0b3MgPSBudWxsOwogICAgICAgICAg\nICAgICAgQ29sdW1uW10gY29scyA9IGdldENvbHVtbnMoKTsKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgICAgIGlmIChjb2xzW2ldLmlzQXV0b0Fzc2ln\nbmVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9zID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvcyA9IG5l\ndyBBcnJheUxpc3QoMyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9z\nLmFkZChjb2xzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBfYXV0b0Fzc2lnbiA9IChhdXRv\ncyA9PSBudWxsKSA/IFNjaGVtYXMuRU1QVFlfQ09MVU1OUwogICAgICAgICAg\nICAgICAgICAgIDogKENvbHVtbltdKSBhdXRvcy50b0FycmF5KG5ldyBDb2x1\nbW5bYXV0b3Muc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9hdXRvQXNzaWduOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoaXMgdGFibGUncyByZWxhdGlvbiBpZCBjb2x1bW5zLgog\nICAgICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0UmVsYXRpb25JZENvbHVt\nbnMoKSB7CiAgICAgICAgaWYgKF9yZWxzID09IG51bGwpIHsKICAgICAgICAg\nICAgaWYgKF9jb2xNYXAgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9yZWxz\nID0gU2NoZW1hcy5FTVBUWV9DT0xVTU5TOwogICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgIENvbGxlY3Rpb24gcmVscyA9IG51bGw7CiAgICAg\nICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gZ2V0Q29sdW1ucygpOwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHNbaV0uaXNSZWxh\ndGlvbklkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbHMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbHMgPSBu\nZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICAgICAgICAgICAgICByZWxz\nLmFkZChjb2xzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBfcmVscyA9IChyZWxzID09IG51\nbGwpID8gU2NoZW1hcy5FTVBUWV9DT0xVTU5TCiAgICAgICAgICAgICAgICAg\nICAgOiAoQ29sdW1uW10pIHJlbHMudG9BcnJheShuZXcgQ29sdW1uW3JlbHMu\nc2l6ZSgpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIF9yZWxzOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDb2x1\nbW5OYW1lcygpIHsKICAgIAlyZXR1cm4gX2NvbE1hcCA9PSBudWxsID8gbmV3\nIFN0cmluZ1swXSA6IAogICAgCQkoU3RyaW5nW10pX2NvbE1hcC5rZXlTZXQo\nKS50b0FycmF5KG5ldyBTdHJpbmdbX2NvbE1hcC5zaXplKCldKTsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbHVtbiB3aXRoIHRo\nZSBnaXZlbiBuYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2x1bW4gZ2V0Q29sdW1uKFN0cmluZyBuYW1lKSB7CiAgICAgICAg\naWYgKG5hbWUgPT0gbnVsbCB8fCBfY29sTWFwID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAoQ29sdW1uKSBfY29s\nTWFwLmdldChuYW1lLnRvVXBwZXJDYXNlKCkpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEFmZmlybXMgaWYgdGhpcyB0YWJsZSBjb250YWlucyB0aGUg\nY29sdW1uIG9mIHRoZSBnaXZlbiBuYW1lIHdpdGhvdXQgYW55IAogICAgICog\nc2lkZS1lZmZlY3QuIAogICAgICogQHNlZSBUYWJsZSNnZXRDb2x1bW4oU3Ry\naW5nKSBjYW4gaGF2ZSBzaWRlLWVmZmVjdCBvZiBjcmVhdGluZyBhIGNvbHVt\nbgogICAgICogZm9yIGR5bmFtaWMgdGFibGUgaW1wbGVtZW50YXRpb24uCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQ29sdW1uKFN0cmlu\nZyBuYW1lKSB7CiAgICAJcmV0dXJuIG5hbWUgIT0gbnVsbCAmJiBfY29sTWFw\nICE9IG51bGwgCiAgICAJCSYmIF9jb2xNYXAuY29udGFpbnNLZXkobmFtZS50\nb1VwcGVyQ2FzZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIGNv\nbHVtbiB0byB0aGUgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBDb2x1bW4g\nYWRkQ29sdW1uKFN0cmluZyBuYW1lKSB7CiAgICAgICAgYWRkTmFtZShuYW1l\nLCB0cnVlKTsKICAgICAgICBTY2hlbWEgc2NoZW1hID0gZ2V0U2NoZW1hKCk7\nCiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBpZiAoc2NoZW1hICE9IG51\nbGwgJiYgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkKICAgICAg\nICAgICAgY29sID0gc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkubmV3Q29sdW1u\nKG5hbWUsIHRoaXMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29sID0g\nbmV3IENvbHVtbihuYW1lLCB0aGlzKTsKICAgICAgICBpZiAoX2NvbE1hcCA9\nPSBudWxsKQogICAgICAgICAgICBfY29sTWFwID0gbmV3IExpbmtlZEhhc2hN\nYXAoKTsKICAgICAgICBfY29sTWFwLnB1dChuYW1lLnRvVXBwZXJDYXNlKCks\nIGNvbCk7CiAgICAgICAgX2NvbHMgPSBudWxsOwogICAgICAgIHJldHVybiBj\nb2w7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIGNv\nbHVtbiBmcm9tIHRoZSB0YWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgdGhlIGNvbHVtbiB3YXMgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGlu\nIHRoZSB0YWJsZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVD\nb2x1bW4oQ29sdW1uIGNvbCkgewogICAgICAgIGlmIChjb2wgPT0gbnVsbCB8\nfCBfY29sTWFwID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgQ29sdW1uIGN1ciA9IChDb2x1bW4pIF9jb2xNYXAuZ2V0KGNv\nbC5nZXROYW1lKCkudG9VcHBlckNhc2UoKSk7CiAgICAgICAgaWYgKCFjb2wu\nZXF1YWxzKGN1cikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgcmVtb3ZlTmFtZShjb2wuZ2V0TmFtZSgpKTsKICAgICAgICBfY29sTWFw\nLnJlbW92ZShjb2wuZ2V0TmFtZSgpLnRvVXBwZXJDYXNlKCkpOwogICAgICAg\nIF9jb2xzID0gbnVsbDsKICAgICAgICBpZiAoY29sLmlzQXV0b0Fzc2lnbmVk\nKCkpCiAgICAgICAgICAgIF9hdXRvQXNzaWduID0gbnVsbDsKICAgICAgICBp\nZiAoY29sLmlzUmVsYXRpb25JZCgpKQogICAgICAgICAgICBfcmVscyA9IG51\nbGw7CiAgICAgICAgY29sLnJlbW92ZSgpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogSW1wb3J0IGEgY29sdW1uIGZyb20g\nYW5vdGhlciB0YWJsZS4KICAgICAqLwogICAgcHVibGljIENvbHVtbiBpbXBv\ncnRDb2x1bW4oQ29sdW1uIGNvbCkgewogICAgICAgIGlmIChjb2wgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbHVtbiBj\nb3B5ID0gYWRkQ29sdW1uKGNvbC5nZXROYW1lKCkpOwogICAgICAgIGNvcHku\nc2V0VHlwZShjb2wuZ2V0VHlwZSgpKTsKICAgICAgICBjb3B5LnNldFR5cGVO\nYW1lKGNvbC5nZXRUeXBlTmFtZSgpKTsKICAgICAgICBjb3B5LnNldEphdmFU\neXBlKGNvbC5nZXRKYXZhVHlwZSgpKTsKICAgICAgICBjb3B5LnNldE5vdE51\nbGwoY29sLmlzTm90TnVsbCgpKTsKICAgICAgICBjb3B5LnNldERlZmF1bHRT\ndHJpbmcoY29sLmdldERlZmF1bHRTdHJpbmcoKSk7CiAgICAgICAgY29weS5z\nZXRTaXplKGNvbC5nZXRTaXplKCkpOwogICAgICAgIGNvcHkuc2V0RGVjaW1h\nbERpZ2l0cyhjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAgICBjb3B5\nLnNldEF1dG9Bc3NpZ25lZChjb2wuaXNBdXRvQXNzaWduZWQoKSk7CiAgICAg\nICAgcmV0dXJuIGNvcHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHByaW1hcnkga2V5IGZvciB0aGUgdGFibGUsIGlmIGFueS4KICAgICAq\nLwogICAgcHVibGljIFByaW1hcnlLZXkgZ2V0UHJpbWFyeUtleSgpIHsKICAg\nICAgICByZXR1cm4gX3BrOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRo\nZSBwcmltYXJ5IGtleSBmb3IgdGhlIHRhYmxlLgogICAgICovCiAgICBwdWJs\naWMgUHJpbWFyeUtleSBhZGRQcmltYXJ5S2V5KCkgewogICAgICAgIHJldHVy\nbiBhZGRQcmltYXJ5S2V5KG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBwcmltYXJ5IGtleSBmb3IgdGhlIHRhYmxlLgogICAgICovCiAg\nICBwdWJsaWMgUHJpbWFyeUtleSBhZGRQcmltYXJ5S2V5KFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVtYSgpOwogICAg\nICAgIGlmIChzY2hlbWEgIT0gbnVsbCAmJiBzY2hlbWEuZ2V0U2NoZW1hR3Jv\ndXAoKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHNjaGVtYS5nZXRTY2hlbWFH\ncm91cCgpLmFkZE5hbWUobmFtZSwgZmFsc2UpOwogICAgICAgICAgICBfcGsg\nPSBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5uZXdQcmltYXJ5S2V5KG5hbWUs\nIHRoaXMpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfcGsgPSBuZXcg\nUHJpbWFyeUtleShuYW1lLCB0aGlzKTsKICAgICAgICByZXR1cm4gX3BrOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBwcmltYXJ5IGtleSBm\ncm9tIHRoaXMgdGFibGUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlm\nIHRoZXJlIHdhcyBhIHBrIHRvIHJlbW92ZSwgZmFsc2Ugb3RoZXJ3aXNlCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVByaW1hcnlLZXkoKSB7\nCiAgICAgICAgYm9vbGVhbiByZW0gPSBfcGsgIT0gbnVsbDsKICAgICAgICBp\nZiAocmVtKSB7CiAgICAgICAgICAgIFNjaGVtYSBzY2hlbWEgPSBnZXRTY2hl\nbWEoKTsKICAgICAgICAgICAgaWYgKHNjaGVtYSAhPSBudWxsICYmIHNjaGVt\nYS5nZXRTY2hlbWFHcm91cCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5yZW1vdmVOYW1lKF9way5nZXROYW1l\nKCkpOwogICAgICAgICAgICBfcGsucmVtb3ZlKCk7CiAgICAgICAgfQogICAg\nICAgIF9wayA9IG51bGw7CiAgICAgICAgcmV0dXJuIHJlbTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEltcG9ydCBhIHByaW1hcnkga2V5OyBjb2x1bW4gbmFt\nZXMgbXVzdCBtYXRjaCBjb2x1bW5zIG9mIHRoaXMgdGFibGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBQcmltYXJ5S2V5IGltcG9ydFByaW1hcnlLZXkoUHJpbWFy\neUtleSBwaykgewogICAgICAgIGlmIChwayA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgUHJpbWFyeUtleSBjb3B5ID0gYWRk\nUHJpbWFyeUtleShway5nZXROYW1lKCkpOwogICAgICAgIGNvcHkuc2V0TG9n\naWNhbChway5pc0xvZ2ljYWwoKSk7CiAgICAgICAgQ29sdW1uW10gY29scyA9\nIHBrLmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNvcHkuYWRkQ29sdW1u\nKGdldENvbHVtbihjb2xzW2ldLmdldE5hbWUoKSkpOwogICAgICAgIHJldHVy\nbiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBmb3Jl\naWduIGtleSB3aXRoIHRoZSBnaXZlbiBuYW1lLiBJZiBtdWx0aXBsZSBmb3Jl\naWduIGtleXMKICAgICAqIGhhdmUgdGhlIG5hbWUsIHRoZSBmaXJzdCBtYXRj\naCBpcyByZXR1cm5lZC4KICAgICAqLwogICAgcHVibGljIEZvcmVpZ25LZXkg\nZ2V0Rm9yZWlnbktleShTdHJpbmcgbmFtZSkgewogICAgICAgIEZvcmVpZ25L\nZXlbXSBma3MgPSBnZXRGb3JlaWduS2V5cygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuZXF1YWxzSWdub3JlQ2FzZShuYW1lLCBma3NbaV0uZ2V0\nTmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBma3NbaV07CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYWxsIGZvcmVpZ24ga2V5cyBmb3IgdGhlIHRhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgRm9yZWlnbktleVtdIGdldEZvcmVpZ25LZXlzKCkgewogICAgICAg\nIGlmIChfZmtzID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9ma0xpc3Qg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9ma3MgPSBTY2hlbWFzLkVNUFRZ\nX0ZPUkVJR05fS0VZUzsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nICAgICBGb3JlaWduS2V5W10gZmtzID0gbmV3IEZvcmVpZ25LZXlbX2ZrTGlz\ndC5zaXplKCldOwogICAgICAgICAgICAgICAgSXRlcmF0b3IgaXRyID0gX2Zr\nTGlzdC5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGl0ci5oYXNOZXh0KCk7IGkrKykgewogICAgICAgICAgICAgICAgICAg\nIGZrc1tpXSA9IChGb3JlaWduS2V5KSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgICAgIGZrc1tpXS5zZXRJbmRleChpKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIF9ma3MgPSBma3M7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9ma3M7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgYSBmb3JlaWduIGtleSB0byB0aGUgdGFibGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBGb3JlaWduS2V5IGFkZEZvcmVpZ25LZXkoKSB7CiAg\nICAgICAgcmV0dXJuIGFkZEZvcmVpZ25LZXkobnVsbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgYSBmb3JlaWduIGtleSB0byB0aGUgdGFibGUuIER1\ncGxpY2F0ZSBrZXkgbmFtZXMgYXJlIG5vdCBhbGxvd2VkLgogICAgICovCiAg\nICBwdWJsaWMgRm9yZWlnbktleSBhZGRGb3JlaWduS2V5KFN0cmluZyBuYW1l\nKSB7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdldFNjaGVtYSgpOwogICAg\nICAgIEZvcmVpZ25LZXkgZms7CiAgICAgICAgaWYgKHNjaGVtYSAhPSBudWxs\nICYmIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpICE9IG51bGwpIHsKICAgICAg\nICAgICAgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkuYWRkTmFtZShuYW1lLCBm\nYWxzZSk7CiAgICAgICAgICAgIGZrID0gc2NoZW1hLmdldFNjaGVtYUdyb3Vw\nKCkubmV3Rm9yZWlnbktleShuYW1lLCB0aGlzKTsKICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgZmsgPSBuZXcgRm9yZWlnbktleShuYW1lLCB0aGlzKTsK\nICAgICAgICBpZiAoX2ZrTGlzdCA9PSBudWxsKQogICAgICAgICAgICBfZmtM\naXN0ID0gbmV3IEFycmF5TGlzdCgzKTsKICAgICAgICBfZmtMaXN0LmFkZChm\nayk7CiAgICAgICAgX2ZrcyA9IG51bGw7CiAgICAgICAgcmV0dXJuIGZrOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBnaXZlbiBmb3JlaWdu\nIGtleSBmcm9tIHRoZSB0YWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUgaWYgdGhlIGtleSB3YXMgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHRo\nZSB0YWJsZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVGb3Jl\naWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsgPT0gbnVs\nbCB8fCBfZmtMaXN0ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgaWYgKCFfZmtMaXN0LnJlbW92ZShmaykpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdl\ndFNjaGVtYSgpOwogICAgICAgIGlmIChzY2hlbWEgIT0gbnVsbCAmJiBzY2hl\nbWEuZ2V0U2NoZW1hR3JvdXAoKSAhPSBudWxsKQogICAgICAgICAgICBzY2hl\nbWEuZ2V0U2NoZW1hR3JvdXAoKS5yZW1vdmVOYW1lKGZrLmdldE5hbWUoKSk7\nCiAgICAgICAgX2ZrcyA9IG51bGw7CiAgICAgICAgZmsucmVtb3ZlKCk7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBv\ncnQgYSBmb3JlaWduIGtleTsgY29sdW1uIG5hbWVzIG11c3QgbWF0Y2ggY29s\ndW1ucyBvZiB0aGlzIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgRm9yZWln\nbktleSBpbXBvcnRGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmspIHsKICAgICAg\nICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIEZvcmVpZ25LZXkgY29weSA9IGFkZEZvcmVpZ25LZXkoZmsuZ2V0\nTmFtZSgpKTsKICAgICAgICBjb3B5LnNldERlbGV0ZUFjdGlvbihmay5nZXRE\nZWxldGVBY3Rpb24oKSk7CgogICAgICAgIFNjaGVtYSBzY2hlbWEgPSBnZXRT\nY2hlbWEoKTsKICAgICAgICBpZiAoc2NoZW1hICE9IG51bGwgJiYgc2NoZW1h\nLmdldFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkgewogICAgICAgICAgICBDb2x1\nbW5bXSBwa3MgPSBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAg\nICAgICBUYWJsZSBqb2luZWQgPSBudWxsOwogICAgICAgICAgICBpZiAocGtz\nLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICBqb2luZWQgPSBzY2hlbWEu\nZ2V0U2NoZW1hR3JvdXAoKS5maW5kVGFibGUocGtzWzBdLmdldFRhYmxlKCkp\nOwoKICAgICAgICAgICAgQ29sdW1uW10gY29scyA9IGZrLmdldENvbHVtbnMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgY29weS5qb2luKGdldENvbHVtbihj\nb2xzW2ldLmdldE5hbWUoKSksCiAgICAgICAgICAgICAgICAgICAgam9pbmVk\nLmdldENvbHVtbihwa3NbaV0uZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICBj\nb2xzID0gZmsuZ2V0Q29uc3RhbnRDb2x1bW5zKCk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgIGNvcHkuam9pbkNvbnN0YW50KGdldENvbHVtbihjb2xzW2ldLmdl\ndE5hbWUoKSksCiAgICAgICAgICAgICAgICAgICAgZmsuZ2V0UHJpbWFyeUtl\neUNvbnN0YW50KGNvbHNbaV0pKTsKCiAgICAgICAgICAgIHBrcyA9IGZrLmdl\ndENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICAgICAgaWYg\nKGpvaW5lZCA9PSBudWxsICYmIHBrcy5sZW5ndGggPiAwKQogICAgICAgICAg\nICAgICAgam9pbmVkID0gc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkuZmluZFRh\nYmxlKHBrc1swXS5nZXRUYWJsZSgpKTsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBj\nb3B5LmpvaW5Db25zdGFudChmay5nZXRDb25zdGFudChwa3NbaV0pLAogICAg\nICAgICAgICAgICAgICAgIGpvaW5lZC5nZXRDb2x1bW4ocGtzW2ldLmdldE5h\nbWUoKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29weTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdGFibGUncyBpbmRleGVzLgog\nICAgICovCiAgICBwdWJsaWMgSW5kZXhbXSBnZXRJbmRleGVzKCkgewogICAg\nICAgIGlmIChfaWR4cyA9PSBudWxsIHx8IF9pZHhzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICBfaWR4cyA9IChfaWR4TWFwID09IG51bGwpID8gU2NoZW1h\ncy5FTVBUWV9JTkRFWEVTIDogKEluZGV4W10pCiAgICAgICAgICAgICAgICBf\naWR4TWFwLnZhbHVlcygpLnRvQXJyYXkobmV3IEluZGV4W19pZHhNYXAuc2l6\nZSgpXSk7CiAgICAgICAgcmV0dXJuIF9pZHhzOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBpbmRleCB3aXRoIHRoZSBnaXZlbiBuYW1lLCBv\nciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBnZXRJ\nbmRleChTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChuYW1lID09IG51bGwg\nfHwgX2lkeE1hcCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICByZXR1cm4gKEluZGV4KSBfaWR4TWFwLmdldChuYW1lLnRvVXBw\nZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGluZGV4\nIHRvIHRoZSB0YWJsZS4KICAgICAqLwogICAgcHVibGljIEluZGV4IGFkZElu\nZGV4KFN0cmluZyBuYW1lKSB7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdl\ndFNjaGVtYSgpOwogICAgICAgIEluZGV4IGlkeDsKICAgICAgICBpZiAoc2No\nZW1hICE9IG51bGwgJiYgc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkgIT0gbnVs\nbCkgewogICAgICAgICAgICBzY2hlbWEuZ2V0U2NoZW1hR3JvdXAoKS5hZGRO\nYW1lKG5hbWUsIHRydWUpOwogICAgICAgICAgICBpZHggPSBzY2hlbWEuZ2V0\nU2NoZW1hR3JvdXAoKS5uZXdJbmRleChuYW1lLCB0aGlzKTsKICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgaWR4ID0gbmV3IEluZGV4KG5hbWUsIHRoaXMp\nOwogICAgICAgIGlmIChfaWR4TWFwID09IG51bGwpCiAgICAgICAgICAgIF9p\nZHhNYXAgPSBuZXcgVHJlZU1hcCgpOwogICAgICAgIF9pZHhNYXAucHV0KG5h\nbWUudG9VcHBlckNhc2UoKSwgaWR4KTsKICAgICAgICBfaWR4cyA9IG51bGw7\nCiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nbW92ZSB0aGUgZ2l2ZW4gaW5kZXggZnJvbSB0aGUgdGFibGUuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBpbmRleCB3YXMgcmVtb3ZlZCwg\nZmFsc2UgaWYgbm90IGluIHRoZSB0YWJsZQogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZW1vdmVJbmRleChJbmRleCBpZHgpIHsKICAgICAgICBpZiAo\naWR4ID09IG51bGwgfHwgX2lkeE1hcCA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CgogICAgICAgIEluZGV4IGN1ciA9IChJbmRleCkgX2lk\neE1hcC5nZXQoaWR4LmdldE5hbWUoKS50b1VwcGVyQ2FzZSgpKTsKICAgICAg\nICBpZiAoIWlkeC5lcXVhbHMoY3VyKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwoKICAgICAgICBfaWR4TWFwLnJlbW92ZShpZHguZ2V0TmFtZSgpLnRv\nVXBwZXJDYXNlKCkpOwogICAgICAgIFNjaGVtYSBzY2hlbWEgPSBnZXRTY2hl\nbWEoKTsKICAgICAgICBpZiAoc2NoZW1hICE9IG51bGwgJiYgc2NoZW1hLmdl\ndFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkKICAgICAgICAgICAgc2NoZW1hLmdl\ndFNjaGVtYUdyb3VwKCkucmVtb3ZlTmFtZShpZHguZ2V0TmFtZSgpKTsKICAg\nICAgICBpZHgucmVtb3ZlKCk7CiAgICAgICAgX2lkeHMgPSBudWxsOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW1wb3J0\nIGFuIGluZGV4OyBjb2x1bW4gbmFtZXMgbXVzdCBtYXRjaCBjb2x1bW5zIG9m\nIHRoaXMgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleCBpbXBvcnRJ\nbmRleChJbmRleCBpZHgpIHsKICAgICAgICBpZiAoaWR4ID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBJbmRleCBjb3B5ID0g\nYWRkSW5kZXgoaWR4LmdldE5hbWUoKSk7CiAgICAgICAgY29weS5zZXRVbmlx\ndWUoaWR4LmlzVW5pcXVlKCkpOwoKICAgICAgICBDb2x1bW5bXSBjb2xzID0g\naWR4LmdldENvbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGNvcHkuYWRkQ29sdW1u\nKGdldENvbHVtbihjb2xzW2ldLmdldE5hbWUoKSkpOwogICAgICAgIHJldHVy\nbiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB0YWJs\nZSdzIHVuaXF1ZSBjb25zdHJhaW50cy4KICAgICAqLwogICAgcHVibGljIFVu\naXF1ZVtdIGdldFVuaXF1ZXMoKSB7CiAgICAgICAgaWYgKF91bnFzID09IG51\nbGwpCiAgICAgICAgICAgIF91bnFzID0gKF91bnFMaXN0ID09IG51bGwpID8g\nU2NoZW1hcy5FTVBUWV9VTklRVUVTIDogKFVuaXF1ZVtdKQogICAgICAgICAg\nICAgICAgX3VucUxpc3QudG9BcnJheShuZXcgVW5pcXVlW191bnFMaXN0LnNp\nemUoKV0pOwogICAgICAgIHJldHVybiBfdW5xczsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgdW5pcXVlIGNvbnN0cmFpbnQgd2l0aCB0aGUg\nZ2l2ZW4gbmFtZSwgb3IgbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJs\naWMgVW5pcXVlIGdldFVuaXF1ZShTdHJpbmcgbmFtZSkgewogICAgICAgIFVu\naXF1ZVtdIHVucXMgPSBnZXRVbmlxdWVzKCk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAo\nU3RyaW5nVXRpbHMuZXF1YWxzSWdub3JlQ2FzZShuYW1lLCB1bnFzW2ldLmdl\ndE5hbWUoKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gdW5xc1tpXTsKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBh\nIHVuaXF1ZSBjb25zdHJhaW50IHRvIHRoZSB0YWJsZS4KICAgICAqLwogICAg\ncHVibGljIFVuaXF1ZSBhZGRVbmlxdWUoU3RyaW5nIG5hbWUpIHsKICAgICAg\nICBTY2hlbWEgc2NoZW1hID0gZ2V0U2NoZW1hKCk7CiAgICAgICAgVW5pcXVl\nIHVucTsKICAgICAgICBpZiAoc2NoZW1hICE9IG51bGwgJiYgc2NoZW1hLmdl\ndFNjaGVtYUdyb3VwKCkgIT0gbnVsbCkgewogICAgICAgICAgICBzY2hlbWEu\nZ2V0U2NoZW1hR3JvdXAoKS5hZGROYW1lKG5hbWUsIGZhbHNlKTsKICAgICAg\nICAgICAgdW5xID0gc2NoZW1hLmdldFNjaGVtYUdyb3VwKCkubmV3VW5pcXVl\nKG5hbWUsIHRoaXMpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICB1bnEg\nPSBuZXcgVW5pcXVlKG5hbWUsIHRoaXMpOwogICAgICAgIGlmIChfdW5xTGlz\ndCA9PSBudWxsKQogICAgICAgICAgICBfdW5xTGlzdCA9IG5ldyBBcnJheUxp\nc3QoMyk7CiAgICAgICAgX3VucUxpc3QuYWRkKHVucSk7CiAgICAgICAgX3Vu\ncXMgPSBudWxsOwogICAgICAgIHJldHVybiB1bnE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZW1vdmUgdGhlIGdpdmVuIHVuaXF1ZSBjb25zdHJhaW50IGZy\nb20gdGhlIHRhYmxlLgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0\naGUgY29uc3RyYWludCB3YXMgcmVtb3ZlZCwgZmFsc2UgaWYgbm90IGluIHRo\nZSB0YWJsZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVVbmlx\ndWUoVW5pcXVlIHVucSkgewogICAgICAgIGlmICh1bnEgPT0gbnVsbCB8fCBf\ndW5xTGlzdCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIGlmICghX3VucUxpc3QucmVtb3ZlKHVucSkpCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKCiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdldFNj\naGVtYSgpOwogICAgICAgIGlmIChzY2hlbWEgIT0gbnVsbCAmJiBzY2hlbWEu\nZ2V0U2NoZW1hR3JvdXAoKSAhPSBudWxsKQogICAgICAgICAgICBzY2hlbWEu\nZ2V0U2NoZW1hR3JvdXAoKS5yZW1vdmVOYW1lKHVucS5nZXROYW1lKCkpOwog\nICAgICAgIF91bnFzID0gbnVsbDsKICAgICAgICB1bnEucmVtb3ZlKCk7CiAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbXBv\ncnQgYSBjb25zdHJhaW50OyBjb2x1bW4gbmFtZXMgbXVzdCBtYXRjaCBjb2x1\nbW5zIG9mIHRoaXMgdGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBVbmlxdWUg\naW1wb3J0VW5pcXVlKFVuaXF1ZSB1bnEpIHsKICAgICAgICBpZiAodW5xID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBVbmlx\ndWUgY29weSA9IGFkZFVuaXF1ZSh1bnEuZ2V0TmFtZSgpKTsKICAgICAgICBj\nb3B5LnNldERlZmVycmVkKHVucS5pc0RlZmVycmVkKCkpOwoKICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gdW5xLmdldENvbHVtbnMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIGNvcHkuYWRkQ29sdW1uKGdldENvbHVtbihjb2xzW2ldLmdldE5hbWUoKSkp\nOwogICAgICAgIHJldHVybiBjb3B5OwogICAgfQoKICAgIC8qKgogICAgICog\nQ2FsbGVkIGJ5IGNvbHVtbnMgdG8gZW5zdXJlIHRoYXQgYWxsIGNvbHVtbnMg\nYXJlIHByb3Blcmx5IGluZGV4ZWQKICAgICAqIGJlZm9yZSByZXR1cm5pbmcg\ndGhhdCBpbmZvcm1hdGlvbiB0byB0aGUgdXNlci4KICAgICAqLwogICAgdm9p\nZCBpbmRleENvbHVtbnMoKSB7CiAgICAgICAgZ2V0Q29sdW1ucygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IGZvcmVpZ24ga2V5cyB0byBl\nbnN1cmUgdGhhdCBhbGwgZmtzIGFyZSBwcm9wZXJseSBpbmRleGVkCiAgICAg\nKiBiZWZvcmUgcmV0dXJuaW5nIHRoYXQgaW5mb3JtYXRpb24gdG8gdGhlIHVz\nZXIuCiAgICAgKi8KICAgIHZvaWQgaW5kZXhGb3JlaWduS2V5cygpIHsKICAg\nICAgICBnZXRGb3JlaWduS2V5cygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2FsbGVkIGJ5IGNvbHVtbnMgd2hlbiB0aGVpciBhdXRvIGluY3JlbWVudCBz\ndGF0dXMgY2hhbmdlcy4KICAgICAqLwogICAgdm9pZCBjaGFuZ2VBdXRvQXNz\naWduZWQoQ29sdW1uIGNvbCkgewogICAgICAgIF9hdXRvQXNzaWduID0gbnVs\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGxlZCBieSBjb2x1bW5zIHdo\nZW4gdGhlaXIgcmVsYXRpb24gaWQgc3RhdHVzIGNoYW5nZXMuCiAgICAgKi8K\nICAgIHZvaWQgY2hhbmdlUmVsYXRpb25JZChDb2x1bW4gY29sKSB7CiAgICAg\nICAgX3JlbHMgPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgY29tcGFy\nZVRvKE9iamVjdCBvdGhlcikgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0\nRnVsbE5hbWUoKTsKICAgICAgICBTdHJpbmcgb3RoZXJOYW1lID0gKChUYWJs\nZSkgb3RoZXIpLmdldEZ1bGxOYW1lKCk7CiAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCAmJiBvdGhlck5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIDA7CiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIDE7CiAgICAgICAgaWYgKG90aGVyTmFtZSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gLTE7CiAgICAgICAgcmV0dXJuIG5hbWUuY29tcGFyZVRv\nKG90aGVyTmFtZSk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyB0b1N0cmlu\nZygpIHsKICAgICAgICByZXR1cm4gZ2V0RnVsbE5hbWUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNDb21tZW50KCkgewogICAgICAgIHJldHVy\nbiBfY29tbWVudCAhPSBudWxsICYmICFfY29tbWVudC5lcXVhbHNJZ25vcmVD\nYXNlKF9uYW1lKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbW1l\nbnQoKSB7CiAgICAgICAgcmV0dXJuIF9jb21tZW50OwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldENvbW1lbnQoU3RyaW5nIGNvbW1lbnQpIHsKICAgICAg\nICBfY29tbWVudCA9IGNvbW1lbnQ7CiAgICB9CiAgICAKICAgIHB1YmxpYyBp\nbnQgZ2V0TGluZU51bWJlcigpIHsKICAgICAgICByZXR1cm4gX2xpbmVOdW07\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TGluZU51bWJlcihpbnQgbGlu\nZU51bSkgewogICAgICAgIF9saW5lTnVtID0gbGluZU51bTsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldENvbE51bWJlcigpIHsKICAgICAgICByZXR1cm4g\nX2NvbE51bTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb2xOdW1iZXIo\naW50IGNvbE51bSkgewogICAgICAgIF9jb2xOdW0gPSBjb2xOdW07CiAgICB9\nCn0K\n","encoding":"base64"}

