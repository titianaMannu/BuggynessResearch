{"sha":"ce8f050a6d11685101ebca2d8b0c64b11c03b337","node_id":"MDQ6QmxvYjIwNjM2NDpjZThmMDUwYTZkMTE2ODUxMDFlYmNhMmQ4YjBjNjRiMTFjMDNiMzM3","size":164425,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/ce8f050a6d11685101ebca2d8b0c64b11c03b337","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuSW52\nb2NhdGlvblRhcmdldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBv\ncnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBqYXZhLnNxbC5BcnJh\neTsKaW1wb3J0IGphdmEuc3FsLkJsb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9i\nOwppbXBvcnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3Fs\nLkRhdGFiYXNlTWV0YURhdGE7CmltcG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0\nYXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlJlZjsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuc3FsLlNRTFdhcm5pbmc7CmltcG9ydCBqYXZhLnNxbC5TdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5UaW1lOwppbXBvcnQgamF2YS5zcWwu\nVGltZXN0YW1wOwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZh\nLnRleHQuTWVzc2FnZUZvcm1hdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGls\nLkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRGF0\nZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGls\nLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IGphdmF4LnNxbC5E\nYXRhU291cmNlOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0\ncmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29u\nZi5KREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkV4cENv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5FeHBTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5leHBzLkZpbHRlclZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuTnVsbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlZhbDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVsZE1hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkphdmFTUUxUeXBl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1\nbW47CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRGF0\nYVNvdXJjZUZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLnNjaGVtYS5OYW1lU2V0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlVuaXF1ZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRmlsdGVyczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3BlbkpQQVN0YXRlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBhdGg7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYuQ29uZmlndXJhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmpkYmMuQ29ubmVjdGlv\nbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRi\nYy5Mb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTG9ja0V4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVj\ndEV4aXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT3BlbkpQQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLk9wdGltaXN0aWNFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5SZWZlcmVudGlhbEludGVncml0\neUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlNl\ncmlhbGl6YXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5T\ndG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCmltcG9ydCBzZXJwLnV0aWwuTnVt\nYmVyczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIENsYXNz\nIHdoaWNoIGFsbG93cyB0aGUgY3JlYXRpb24gb2YgU1FMIGR5bmFtaWNhbGx5\nLCBpbiBhCiAqIGRhdGFiYXNlIGFnbm9zdGljIGZhc2hpb24uIFN1YmNsYXNz\nIGZvciB0aGUgbnVhbmNlcyBvZiBkaWZmZXJlbnQgZGF0YSBzdG9yZXMuCiAq\nLwpwdWJsaWMgY2xhc3MgREJEaWN0aW9uYXJ5CiAgICBpbXBsZW1lbnRzIENv\nbmZpZ3VyYWJsZSwgQ29ubmVjdGlvbkRlY29yYXRvciwgSm9pblN5bnRheGVz\nLAogICAgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FMV2FybmluZ0hh\nbmRsZXIgewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFZFTkRP\nUl9PVEhFUiA9ICJvdGhlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBWRU5ET1JfREFUQURJUkVDVCA9ICJkYXRhZGlyZWN0IjsKCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9VUFBFUiA9\nICJ1cHBlciI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hF\nTUFfQ0FTRV9MT1dFUiA9ICJsb3dlciI7CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9QUkVTRVJWRSA9ICJwcmVzZXJ2ZSI7\nCgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX0JF\nRk9SRSA9ICJiZWZvcmUiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgQ09OU19OQU1FX01JRCA9ICJtaWQiOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBTdHJpbmcgQ09OU19OQU1FX0FGVEVSID0gImFmdGVyIjsKICAgIAog\nICAgcHVibGljIGludCBibG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwogICAgcHVi\nbGljIGludCBjbG9iQnVmZmVyU2l6ZSA9IDUwMDAwOwoKICAgIHByb3RlY3Rl\nZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BPU1RfU0VMRUNUID0gMDsKICAg\nIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BSRV9ESVNUSU5D\nVCA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBSQU5HRV9Q\nT1NUX0RJU1RJTkNUID0gMjsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BPU1RfTE9DSyA9IDM7CgogICAgcHJvdGVjdGVkIHN0YXRp\nYyBmaW5hbCBpbnQgTkFOTyA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZp\nbmFsIGludCBNSUNSTyA9IE5BTk8gKiAxMDAwOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgTUlMTEkgPSBNSUNSTyAqIDEwMDA7CiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBDRU5USSA9IE1JTExJICogMTA7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBERUNJID0gTUlMTEkgKiAx\nMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBTRUMgPSBNSUxM\nSSAqIDEwMDA7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFN\nRV9BTlkgPSAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFN\nRV9UQUJMRSA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBO\nQU1FX1NFUVVFTkNFID0gMjsKICAgIAogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBpbnQgVU5MSU1JVEVEID0gLTE7CiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBOT19CQVRDSCA9IDA7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIFpFUk9fREFURV9TVFIgPQogICAgICAgICInIiArIG5l\ndyBqYXZhLnNxbC5EYXRlKDApICsgIiciOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIFpFUk9fVElNRV9TVFIgPSAiJyIgKyBuZXcgVGltZSgw\nKSArICInIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBaRVJP\nX1RJTUVTVEFNUF9TVFIgPQogICAgICAgICInIiArIG5ldyBUaW1lc3RhbXAo\nMCkgKyAiJyI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVy\nIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChEQkRpY3Rp\nb25hcnkuY2xhc3MpOwoKICAgIC8vIHNjaGVtYSBkYXRhCiAgICBwdWJsaWMg\nU3RyaW5nIHBsYXRmb3JtID0gIkdlbmVyaWMiOwogICAgcHVibGljIFN0cmlu\nZyBkcml2ZXJWZW5kb3IgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjYXRh\nbG9nU2VwYXJhdG9yID0gIi4iOwogICAgcHVibGljIGJvb2xlYW4gY3JlYXRl\nUHJpbWFyeUtleXMgPSB0cnVlOwogICAgcHVibGljIFN0cmluZyBjb25zdHJh\naW50TmFtZU1vZGUgPSBDT05TX05BTUVfQkVGT1JFOwogICAgcHVibGljIGlu\ndCBtYXhUYWJsZU5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1h\neENvbHVtbk5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heENv\nbnN0cmFpbnROYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJ\nbmRleE5hbWVMZW5ndGggPSAxMjg7CiAgICBwdWJsaWMgaW50IG1heEluZGV4\nZXNQZXJUYWJsZSA9IEludGVnZXIuTUFYX1ZBTFVFOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNGb3JlaWduS2V5cyA9IHRydWU7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c1VuaXF1ZUNvbnN0cmFpbnRzID0gdHJ1ZTsKICAg\nIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jlc3RyaWN0RGVs\nZXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nQ2FzY2FkZURlbGV0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c051bGxEZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rp\nb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRl\nVXBkYXRlQWN0aW9uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTnVsbFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNBbHRlclRhYmxlV2l0aEFkZENvbHVtbiA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFibGVX\naXRoRHJvcENvbHVtbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0NvbW1lbnRzID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5nIHJlc2Vy\ndmVkV29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzeXN0ZW1TY2hl\nbWFzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc3lzdGVtVGFibGVzID0g\nbnVsbDsKICAgIHB1YmxpYyBTdHJpbmcgc2VsZWN0V29yZHMgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBmaXhlZFNpemVUeXBlTmFtZXMgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1BX0NBU0VfVVBQ\nRVI7CiAgICBwdWJsaWMgYm9vbGVhbiBzZXRTdHJpbmdSaWdodFRydW5jYXRp\nb25PbiA9IHRydWU7CgogICAgLy8gc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZh\nbGlkYXRpb25TUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBjbG9zZVBv\nb2xTUUwgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBpbml0aWFsaXphdGlv\nblNRTCA9IG51bGw7CiAgICBwdWJsaWMgaW50IGpvaW5TeW50YXggPSBTWU5U\nQVhfU1FMOTI7CiAgICBwdWJsaWMgU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9\nICJMRUZUIE9VVEVSIEpPSU4iOwogICAgcHVibGljIFN0cmluZyBpbm5lckpv\naW5DbGF1c2UgPSAiSU5ORVIgSk9JTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNy\nb3NzSm9pbkNsYXVzZSA9ICJDUk9TUyBKT0lOIjsKICAgIHB1YmxpYyBib29s\nZWFuIHJlcXVpcmVzQ29uZGl0aW9uRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAg\nICBwdWJsaWMgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRF\nIjsKICAgIHB1YmxpYyBTdHJpbmcgdGFibGVGb3JVcGRhdGVDbGF1c2UgPSBu\ndWxsOwogICAgcHVibGljIFN0cmluZyBkaXN0aW5jdENvdW50Q29sdW1uU2Vw\nYXJhdG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzU2Vs\nZWN0Rm9yVXBkYXRlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMg\nPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0\naE9yZGVyQ2xhdXNlID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbiA9IHRydWU7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFu\nZ2UgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRp\nbWVvdXQgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc2ltdWxhdGVMb2Nr\naW5nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNl\nbGVjdCA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJl\nbGF0ZWRTdWJzZWxlY3QgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNIYXZpbmcgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNTZWxlY3RTdGFydEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMg\naW50IHJhbmdlUG9zaXRpb24gPSBSQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1\nYmxpYyBib29sZWFuIHJlcXVpcmVzQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxz\nZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzVGFyZ2V0Rm9yRGVsZXRl\nID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBhbGxvd3NBbGlhc0luQnVs\na0NsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c011\nbHRpcGxlTm9udHJhbnNhY3Rpb25hbFJlc3VsdFNldHMgPSB0cnVlOwogICAg\ncHVibGljIFN0cmluZyBzZWFyY2hTdHJpbmdFc2NhcGUgPSAiXFwiOwogICAg\ncHVibGljIGJvb2xlYW4gcmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyA9\nIGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNDYXN0Rm9yQ29t\ncGFyaXNvbnMgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRz\nTW9kT3BlcmF0b3IgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBv\ncnRzWE1MQ29sdW1uID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiByZXBv\ncnRzU3VjY2Vzc05vSW5mb09uQmF0Y2hVcGRhdGVzID0gZmFsc2U7CiAgICAK\nICAgIC8qKgogICAgICogU29tZSBEYXRhYmFzZXMgYXBwZW5kIHdoaXRlc3Bh\nY2UgYWZ0ZXIgdGhlIHNjaGVtYSBuYW1lIAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiB0cmltU2NoZW1hTmFtZSA9IGZhbHNlOwoKICAgIC8vIGZ1bmN0\naW9ucwogICAgcHVibGljIFN0cmluZyBjYXN0RnVuY3Rpb24gPSAiQ0FTVCh7\nMH0gQVMgezF9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvTG93ZXJDYXNlRnVu\nY3Rpb24gPSAiTE9XRVIoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvVXBw\nZXJDYXNlRnVuY3Rpb24gPSAiVVBQRVIoezB9KSI7CiAgICBwdWJsaWMgU3Ry\naW5nIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkNIQVJfTEVOR1RIKHswfSki\nOwogICAgcHVibGljIFN0cmluZyBiaXRMZW5ndGhGdW5jdGlvbiA9ICIoT0NU\nRVRfTEVOR1RIKHswfSkgKiA4KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRyaW1M\nZWFkaW5nRnVuY3Rpb24gPSAiVFJJTShMRUFESU5HIHsxfSBGUk9NIHswfSki\nOwogICAgcHVibGljIFN0cmluZyB0cmltVHJhaWxpbmdGdW5jdGlvbiA9ICJU\nUklNKFRSQUlMSU5HIHsxfSBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmlu\nZyB0cmltQm90aEZ1bmN0aW9uID0gIlRSSU0oQk9USCB7MX0gRlJPTSB7MH0p\nIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVGdW5jdGlvbiA9ICIo\nezB9fHx7MX0pIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVEZWxp\nbWl0ZXIgPSAiJ09QRU5KUEFUT0tFTiciOwogICAgcHVibGljIFN0cmluZyBz\ndWJzdHJpbmdGdW5jdGlvbk5hbWUgPSAiU1VCU1RSSU5HIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgY3VycmVudERhdGVGdW5jdGlvbiA9ICJDVVJSRU5UX0RBVEUi\nOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50VGltZUZ1bmN0aW9uID0gIkNV\nUlJFTlRfVElNRSI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnRUaW1lc3Rh\nbXBGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUVTVEFNUCI7CiAgICBwdWJsaWMg\nU3RyaW5nIGRyb3BUYWJsZVNRTCA9ICJEUk9QIFRBQkxFIHswfSI7CgogICAg\nLy8gdHlwZXMKICAgIHB1YmxpYyBib29sZWFuIHN0b3JhZ2VMaW1pdGF0aW9u\nc0ZhdGFsID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yZUxhcmdl\nTnVtYmVyc0FzU3RyaW5ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\nc3RvcmVDaGFyc0FzTnVtYmVycyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VHZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9v\nbGVhbiB1c2VTZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiB1c2VHZXRPYmplY3RGb3JCbG9icyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gdXNlR2V0U3RyaW5nRm9yQ2xvYnMgPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHVzZVNldFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7\nCiAgICBwdWJsaWMgaW50IG1heEVtYmVkZGVkQmxvYlNpemUgPSAtMTsKICAg\nIHB1YmxpYyBpbnQgbWF4RW1iZWRkZWRDbG9iU2l6ZSA9IC0xOwogICAgcHVi\nbGljIGludCBpbkNsYXVzZUxpbWl0ID0gLTE7CiAgICBwdWJsaWMgaW50IGRh\ndGVQcmVjaXNpb24gPSBNSUxMSTsKICAgIHB1YmxpYyBpbnQgY2hhcmFjdGVy\nQ29sdW1uU2l6ZSA9IDI1NTsKICAgIHB1YmxpYyBTdHJpbmcgYXJyYXlUeXBl\nTmFtZSA9ICJBUlJBWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpZ2ludFR5cGVO\nYW1lID0gIkJJR0lOVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJpbmFyeVR5cGVO\nYW1lID0gIkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpdFR5cGVOYW1l\nID0gIkJJVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJsb2JUeXBlTmFtZSA9ICJC\nTE9CIjsKICAgIHB1YmxpYyBTdHJpbmcgYm9vbGVhblR5cGVOYW1lID0gIkJP\nT0xFQU4iOwogICAgcHVibGljIFN0cmluZyBjaGFyVHlwZU5hbWUgPSAiQ0hB\nUiI7CiAgICBwdWJsaWMgU3RyaW5nIGNsb2JUeXBlTmFtZSA9ICJDTE9CIjsK\nICAgIHB1YmxpYyBTdHJpbmcgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOwogICAg\ncHVibGljIFN0cmluZyBkZWNpbWFsVHlwZU5hbWUgPSAiREVDSU1BTCI7CiAg\nICBwdWJsaWMgU3RyaW5nIGRpc3RpbmN0VHlwZU5hbWUgPSAiRElTVElOQ1Qi\nOwogICAgcHVibGljIFN0cmluZyBkb3VibGVUeXBlTmFtZSA9ICJET1VCTEUi\nOwogICAgcHVibGljIFN0cmluZyBmbG9hdFR5cGVOYW1lID0gIkZMT0FUIjsK\nICAgIHB1YmxpYyBTdHJpbmcgaW50ZWdlclR5cGVOYW1lID0gIklOVEVHRVIi\nOwogICAgcHVibGljIFN0cmluZyBqYXZhT2JqZWN0VHlwZU5hbWUgPSAiSkFW\nQV9PQkpFQ1QiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyYmluYXJ5VHlw\nZU5hbWUgPSAiTE9OR1ZBUkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGxv\nbmdWYXJjaGFyVHlwZU5hbWUgPSAiTE9OR1ZBUkNIQVIiOwogICAgcHVibGlj\nIFN0cmluZyBudWxsVHlwZU5hbWUgPSAiTlVMTCI7CiAgICBwdWJsaWMgU3Ry\naW5nIG51bWVyaWNUeXBlTmFtZSA9ICJOVU1FUklDIjsKICAgIHB1YmxpYyBT\ndHJpbmcgb3RoZXJUeXBlTmFtZSA9ICJPVEhFUiI7CiAgICBwdWJsaWMgU3Ry\naW5nIHJlYWxUeXBlTmFtZSA9ICJSRUFMIjsKICAgIHB1YmxpYyBTdHJpbmcg\ncmVmVHlwZU5hbWUgPSAiUkVGIjsKICAgIHB1YmxpYyBTdHJpbmcgc21hbGxp\nbnRUeXBlTmFtZSA9ICJTTUFMTElOVCI7CiAgICBwdWJsaWMgU3RyaW5nIHN0\ncnVjdFR5cGVOYW1lID0gIlNUUlVDVCI7CiAgICBwdWJsaWMgU3RyaW5nIHRp\nbWVUeXBlTmFtZSA9ICJUSU1FIjsKICAgIHB1YmxpYyBTdHJpbmcgdGltZXN0\nYW1wVHlwZU5hbWUgPSAiVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcg\ndGlueWludFR5cGVOYW1lID0gIlRJTllJTlQiOwogICAgcHVibGljIFN0cmlu\nZyB2YXJiaW5hcnlUeXBlTmFtZSA9ICJWQVJCSU5BUlkiOwogICAgcHVibGlj\nIFN0cmluZyB2YXJjaGFyVHlwZU5hbWUgPSAiVkFSQ0hBUiI7CiAgICBwdWJs\naWMgU3RyaW5nIHhtbFR5cGVOYW1lID0gIlhNTCI7CiAgICBwdWJsaWMgU3Ry\naW5nIGdldFN0cmluZ1ZhbCA9ICIiOwoKICAgIC8vIHNjaGVtYSBtZXRhZGF0\nYQogICAgcHVibGljIGJvb2xlYW4gdXNlU2NoZW1hTmFtZSA9IHRydWU7CiAg\nICBwdWJsaWMgU3RyaW5nIHRhYmxlVHlwZXMgPSAiVEFCTEUiOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRUYWJsZXMgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRDb2x1\nbW5zID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRh\nYmxlRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c051bGxUYWJsZUZvckdldFByaW1hcnlLZXlzID0gZmFsc2U7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4\nSW5mbyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxs\nVGFibGVGb3JHZXRJbXBvcnRlZEtleXMgPSBmYWxzZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHVzZUdldEJlc3RSb3dJZGVudGlmaWVyRm9yUHJpbWFyeUtleXMg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQXV0b0NvbW1p\ndEZvck1ldGFEYXRhID0gZmFsc2U7CgogICAgLy8gYXV0by1pbmNyZW1lbnQK\nICAgIHB1YmxpYyBpbnQgbWF4QXV0b0Fzc2lnbk5hbWVMZW5ndGggPSAzMTsK\nICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fzc2lnbkNsYXVzZSA9IG51bGw7CiAg\nICBwdWJsaWMgU3RyaW5nIGF1dG9Bc3NpZ25UeXBlTmFtZSA9IG51bGw7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0F1dG9Bc3NpZ24gPSBmYWxzZTsK\nICAgIHB1YmxpYyBTdHJpbmcgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgbmV4dFNlcXVlbmNlUXVlcnkgPSBudWxs\nOwogICAgcHVibGljIFN0cmluZyBzZXF1ZW5jZVNRTCA9IG51bGw7CiAgICBw\ndWJsaWMgU3RyaW5nIHNlcXVlbmNlU2NoZW1hU1FMID0gbnVsbDsKICAgIHB1\nYmxpYyBTdHJpbmcgc2VxdWVuY2VOYW1lU1FMID0gbnVsbDsKICAgIC8vIG1v\nc3QgbmF0aXZlIHNlcXVlbmNlcyBjYW4gYmUgcnVuIGluc2lkZSB0aGUgYnVz\naW5lc3MgdHJhbnNhY3Rpb24KICAgIHB1YmxpYyBpbnQgbmF0aXZlU2VxdWVu\nY2VUeXBlPSBTZXEuVFlQRV9UUkFOU0FDVElPTkFMOwoKICAgIHByb3RlY3Rl\nZCBKREJDQ29uZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAgIHByb3RlY3Rl\nZCBMb2cgbG9nID0gbnVsbDsKICAgIHByb3RlY3RlZCBib29sZWFuIGNvbm5l\nY3RlZCA9IGZhbHNlOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNKREJDMyA9\nIGZhbHNlOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCByZXNlcnZlZFdvcmRT\nZXQgPSBuZXcgSGFzaFNldCgpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldCBz\neXN0ZW1TY2hlbWFTZXQgPSBuZXcgSGFzaFNldCgpOwogICAgcHJvdGVjdGVk\nIGZpbmFsIFNldCBzeXN0ZW1UYWJsZVNldCA9IG5ldyBIYXNoU2V0KCk7CiAg\nICBwcm90ZWN0ZWQgZmluYWwgU2V0IGZpeGVkU2l6ZVR5cGVOYW1lU2V0ID0g\nbmV3IEhhc2hTZXQoKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQgdHlwZU1v\nZGlmaWVyU2V0ID0gbmV3IEhhc2hTZXQoKTsKCiAgICAvKioKICAgICAqIElm\nIGEgbmF0aXZlIHF1ZXJ5IGJlZ2lucyB3aXRoIGFueSBvZiB0aGUgdmFsdWVz\nIGZvdW5kIGhlcmUgdGhlbiBpdCB3aWxsCiAgICAgKiBiZSB0cmVhdGVkIGFz\nIGEgc2VsZWN0IHN0YXRlbWVudC4gIAogICAgICovCiAgICBwcm90ZWN0ZWQg\nZmluYWwgU2V0IHNlbGVjdFdvcmRTZXQgPSBuZXcgSGFzaFNldCgpOwoKICAg\nIC8vIHdoZW4gd2Ugc3RvcmUgdmFsdWVzIHRoYXQgbG9zZSBwcmVjaW9uLCB0\ncmFjayB0aGUgdHlwZXMgc28gdGhhdCB0aGUKICAgIC8vIGZpcnN0IHRpbWUg\naXQgaGFwcGVucyB3ZSBjYW4gd2FybiB0aGUgdXNlcgogICAgcHJpdmF0ZSBT\nZXQgX3ByZWNpc2lvbldhcm5lZFR5cGVzID0gbnVsbDsKCiAgICAvLyBjYWNo\nZSBsb2IgbWV0aG9kcwogICAgcHJpdmF0ZSBNZXRob2QgX3NldEJ5dGVzID0g\nbnVsbDsKICAgIHByaXZhdGUgTWV0aG9kIF9zZXRTdHJpbmcgPSBudWxsOwog\nICAgcHJpdmF0ZSBNZXRob2QgX3NldENoYXJTdHJlYW0gPSBudWxsOwoKICAg\nIC8vIGJhdGNoTGltaXQgdmFsdWU6CiAgICAvLyAtMSA9IHVubGltaXRlZAog\nICAgLy8gMCAgPSBubyBiYXRjaAogICAgLy8gYW55IHBvc2l0aXZlIG51bWJl\nciA9IGJhdGNoIGxpbWl0CiAgICBwdWJsaWMgaW50IGJhdGNoTGltaXQgPSBO\nT19CQVRDSDsKICAgIAogICAgcHVibGljIGZpbmFsIE1hcDxJbnRlZ2VyLFNl\ndDxTdHJpbmc+PiBzcWxTdGF0ZUNvZGVzID0gCiAgICAJbmV3IEhhc2hNYXA8\nSW50ZWdlciwgU2V0PFN0cmluZz4+KCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIHB1YmxpYyBEQkRpY3Rp\nb25hcnkoKSB7CiAgICAgICAgZml4ZWRTaXplVHlwZU5hbWVTZXQuYWRkQWxs\nKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewogICAgICAgICAgICAiQklH\nSU5UIiwgIkJJVCIsICJCTE9CIiwgIkNMT0IiLCAiREFURSIsICJERUNJTUFM\nIiwgIkRJU1RJTkNUIiwKICAgICAgICAgICAgIkRPVUJMRSIsICJGTE9BVCIs\nICJJTlRFR0VSIiwgIkpBVkFfT0JKRUNUIiwgIk5VTEwiLCAiTlVNRVJJQyIs\nCiAgICAgICAgICAgICJPVEhFUiIsICJSRUFMIiwgIlJFRiIsICJTTUFMTElO\nVCIsICJTVFJVQ1QiLCAiVElNRSIsICJUSU1FU1RBTVAiLAogICAgICAgICAg\nICAiVElOWUlOVCIsCiAgICAgICAgfSkpOwogICAgICAgIAogICAgICAgIHNl\nbGVjdFdvcmRTZXQuYWRkKCJTRUxFQ1QiKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aGVuIHRoZSBkaWN0aW9uYXJ5\nIGZpcnN0IHNlZXMgYW55IGNvbm5lY3Rpb24uCiAgICAgKiBJdCBpcyB1c2Vk\nIHRvIGluaXRpYWxpemUgZGljdGlvbmFyeSBtZXRhZGF0YSBpZiBuZWVkZWQu\nIElmIHlvdQogICAgICogb3ZlcnJpZGUgdGhpcyBtZXRob2QsIGJlIHN1cmUg\ndG8gY2FsbAogICAgICogPGNvZGU+c3VwZXIuY29ubmVjdGVkQ29uZmlndXJh\ndGlvbjwvY29kZT4uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvbm5lY3Rl\nZENvbmZpZ3VyYXRpb24oQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghY29ubmVjdGVkKSB7CiAg\nICAgICAgICAgIERhdGFiYXNlTWV0YURhdGEgbWV0YURhdGEgPSBudWxsOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbWV0YURhdGEgPSBj\nb25uLmdldE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIC8vIEpEQkMzLW9ubHkgbWV0aG9kLCBzbyBpdCBt\naWdodCB0aHJvdyBhIAogICAgICAgICAgICAgICAgICAgIC8vIEFic3RyYWN0\nTWV0aG9kRXJyb3IKICAgICAgICAgICAgICAgICAgICBpc0pEQkMzID0gbWV0\nYURhdGEuZ2V0SkRCQ01ham9yVmVyc2lvbigpID49IDM7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAg\nICAgIC8vIGlnbm9yZSBpZiBub3QgSkRCQzMKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoZS50b1N0cmluZygpLCBlKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvZy50cmFj\nZShEQkRpY3Rpb25hcnlGYWN0b3J5LnRvU3RyaW5nKG1ldGFEYXRhKSk7Cgog\nICAgICAgICAgICAgICAgaWYgKGlzSkRCQzMpCiAgICAgICAgICAgICAgICAg\nICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJjb25uZWN0aW9uLWRlZmF1bHRzIiwg\nbmV3IE9iamVjdFtdewogICAgICAgICAgICAgICAgICAgICAgICBjb25uLmdl\ndEF1dG9Db21taXQoKSwgY29ubi5nZXRIb2xkYWJpbGl0eSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICBjb25uLmdldFRyYW5zYWN0aW9uSXNvbGF0aW9u\nKCl9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29ubmVj\ndGVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBSZXN1bHRTZXQgd3JhcHBlcnMKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgQXJyYXkgZ2V0\nQXJyYXkoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRBcnJheShj\nb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3Bl\nY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJv\ncGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBJbnB1\ndFN0cmVhbSBnZXRBc2NpaVN0cmVhbShSZXN1bHRTZXQgcnMsIGludCBjb2x1\nbW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHJzLmdldEFzY2lpU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBT\nUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4K\nICAgICAqLwogICAgcHVibGljIEJpZ0RlY2ltYWwgZ2V0QmlnRGVjaW1hbChS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJp\nbmdzKSB7CiAgICAgICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmcocnMs\nIGNvbHVtbik7CiAgICAgICAgICAgIHJldHVybiAoc3RyID09IG51bGwpID8g\nbnVsbCA6IG5ldyBCaWdEZWNpbWFsKHN0cik7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBycy5nZXRCaWdEZWNpbWFsKGNvbHVtbik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBzcGVjaWZpZWQgY29sdW1uIHZhbHVl\nIGFzIGFuIHVua25vd24gbnVtZXJpYyB0eXBlOwogICAgICogd2UgdHJ5IGZy\nb20gdGhlIG1vc3QgZ2VuZXJpYyB0byB0aGUgbGVhc3QgZ2VuZXJpYy4KICAg\nICAqLwogICAgcHVibGljIE51bWJlciBnZXROdW1iZXIoUmVzdWx0U2V0IHJz\nLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIC8vIHRyeSBmcm9tIHRoZSBtb3N0IGdlbmVyaWMsIGFuZCBpZiBl\ncnJvcnMgb2NjdXIsIHRyeQogICAgICAgIC8vIGxlc3MgZ2VuZXJpYyB0eXBl\nczsgdGhpcyBlbmFibGVzIHVzIHRvIGhhbmRsZSB2YWx1ZXMKICAgICAgICAv\nLyBsaWtlIERvdWJsZS5OYU4gd2l0aG91dCBoYXZpbmcgdG8gaW50cm9zcGVj\ndCBvbiB0aGUKICAgICAgICAvLyBSZXN1bHRTZXRNZXRhRGF0YSAoYnVnICMx\nMDUzKS4gbm90ZSB0aGF0IHdlIGhhbmRsZQogICAgICAgIC8vIGdlbmVyaWMg\nZXhjZXB0aW9ucywgc2luY2Ugc29tZSBkcml2ZXJzIG1heSB0aHJvdwogICAg\nICAgIC8vIE51bWJlckZvcm1hdEV4Y2VwdGlvbnMsIHdoZXJlYXMgb3RoZXJz\nIG1heSB0aHJvdyBTUUxFeGNlcHRpb25zCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmV0dXJuIGdldEJpZ0RlY2ltYWwocnMsIGNvbHVtbik7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUxKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERvdWJsZShnZXREb3VibGUo\ncnMsIGNvbHVtbikpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZTIpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG5ldyBGbG9hdChnZXRGbG9hdChycywgY29sdW1uKSk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZTMpIHsKICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gTnVtYmVycy52YWx1ZU9mKGdldExvbmcocnMsIGNvbHVtbikpOwog\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlNCkgewog\nICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihnZXRJbnQocnMs\nIGNvbHVtbikpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZTUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKGUxIGluc3RhbmNlb2YgUnVudGltZUV4\nY2VwdGlvbikKICAgICAgICAgICAgICAgIHRocm93KFJ1bnRpbWVFeGNlcHRp\nb24pIGUxOwogICAgICAgICAgICBpZiAoZTEgaW5zdGFuY2VvZiBTUUxFeGNl\ncHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyhTUUxFeGNlcHRpb24pIGUx\nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIEJpZ0ludGVnZXIgZ2V0QmlnSW50ZWdl\ncihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNT\ndHJpbmdzKSB7CiAgICAgICAgICAgIFN0cmluZyBzdHIgPSBnZXRTdHJpbmco\ncnMsIGNvbHVtbik7CiAgICAgICAgICAgIHJldHVybiAoc3RyID09IG51bGwp\nID8gbnVsbCA6IG5ldyBCaWdEZWNpbWFsKHN0cikudG9CaWdJbnRlZ2VyKCk7\nCiAgICAgICAgfQogICAgICAgIEJpZ0RlY2ltYWwgYmQgPSBnZXRCaWdEZWNp\nbWFsKHJzLCBjb2x1bW4pOwogICAgICAgIHJldHVybiAoYmQgPT0gbnVsbCkg\nPyBudWxsIDogYmQudG9CaWdJbnRlZ2VyKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwg\nUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAg\nICAqLwogICAgcHVibGljIElucHV0U3RyZWFtIGdldEJpbmFyeVN0cmVhbShS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJpbmFyeVN0cmVhbShj\nb2x1bW4pOwogICAgfQoKICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRMT0JT\ndHJlYW0oSkRCQ1N0b3JlIHN0b3JlLCBSZXN1bHRTZXQgcnMsCiAgICAgICAg\naW50IGNvbHVtbikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHJzLmdldEJpbmFyeVN0cmVhbShjb2x1bW4pOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgQmxvYiBnZXRCbG9iKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QmxvYihjb2x1bW4pOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0QmxvYk9iamVj\ndChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIEpEQkNTdG9yZSBzdG9yZSkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBJbnB1dFN0\ncmVhbSBpbiA9IG51bGw7CiAgICAgICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxv\nYnMgfHwgdXNlR2V0T2JqZWN0Rm9yQmxvYnMpIHsKICAgICAgICAgICAgYnl0\nZVtdIGJ5dGVzID0gZ2V0Qnl0ZXMocnMsIGNvbHVtbik7CiAgICAgICAgICAg\nIGlmIChieXRlcyAhPSBudWxsICYmIGJ5dGVzLmxlbmd0aCA+IDApCiAgICAg\nICAgICAgICAgICBpbiA9IG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbShieXRl\ncyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgQmxvYiBibG9iID0g\nZ2V0QmxvYihycywgY29sdW1uKTsKICAgICAgICAgICAgaWYgKGJsb2IgIT0g\nbnVsbCAmJiBibG9iLmxlbmd0aCgpID4gMCkKICAgICAgICAgICAgICAgIGlu\nID0gYmxvYi5nZXRCaW5hcnlTdHJlYW0oKTsKICAgICAgICB9CiAgICAgICAg\naWYgKGluID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoc3RvcmUgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRlc2VyaWFsaXpl\nKGluLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRpb24u\nZGVzZXJpYWxpemUoaW4sIHN0b3JlLmdldENvbnRleHQoKSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGluLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGlvZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUg\nU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldEJvb2xlYW4oUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBycy5nZXRCb29sZWFuKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJ5dGUgZ2V0Qnl0ZShS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEJ5dGUoY29sdW1uKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBj\nb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAg\nICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIGdldEJ5\ndGVzKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodXNlR2V0Qnl0ZXNGb3JCbG9i\ncykKICAgICAgICAgICAgcmV0dXJuIHJzLmdldEJ5dGVzKGNvbHVtbik7CiAg\nICAgICAgaWYgKHVzZUdldE9iamVjdEZvckJsb2JzKQogICAgICAgICAgICBy\nZXR1cm4gKGJ5dGVbXSkgcnMuZ2V0T2JqZWN0KGNvbHVtbik7CgogICAgICAg\nIEJsb2IgYmxvYiA9IGdldEJsb2IocnMsIGNvbHVtbik7CiAgICAgICAgaWYg\nKGJsb2IgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaW50IGxlbmd0aCA9IChpbnQpIGJsb2IubGVuZ3RoKCk7CiAgICAgICAg\naWYgKGxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICByZXR1cm4gYmxvYi5nZXRCeXRlcygxLCBsZW5ndGgpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuIENvbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7QGxpbmsgVGltZXN0\nYW1wfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgQ2FsZW5kYXIg\nZ2V0Q2FsZW5kYXIoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIERhdGUgZCA9IGdldERh\ndGUocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGQgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENhbGVuZGFyIGNhbCA9IENh\nbGVuZGFyLmdldEluc3RhbmNlKCk7CiAgICAgICAgY2FsLnNldFRpbWUoZCk7\nCiAgICAgICAgcmV0dXJuIGNhbDsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRT\nZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgY2hhciBnZXRDaGFyKFJlc3VsdFNldCBycywgaW50IGNvbHVt\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nc3RvcmVDaGFyc0FzTnVtYmVycykKICAgICAgICAgICAgcmV0dXJuIChjaGFy\nKSBnZXRJbnQocnMsIGNvbHVtbik7CgogICAgICAgIFN0cmluZyBzdHIgPSBn\nZXRTdHJpbmcocnMsIGNvbHVtbik7CiAgICAgICAgcmV0dXJuIChTdHJpbmdV\ndGlscy5pc0VtcHR5KHN0cikpID8gMCA6IHN0ci5jaGFyQXQoMCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFJlYWRlciBnZXRDaGFyYWN0\nZXJTdHJlYW0oUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRDaGFy\nYWN0ZXJTdHJlYW0oY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRT\nZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgQ2xvYiBnZXRDbG9iKFJlc3VsdFNldCBycywgaW50IGNvbHVt\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gcnMuZ2V0Q2xvYihjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3Vs\ndFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q2xvYlN0cmluZyhSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHVzZUdldFN0cmluZ0ZvckNsb2JzKQogICAgICAgICAgICBy\nZXR1cm4gcnMuZ2V0U3RyaW5nKGNvbHVtbik7CgogICAgICAgIENsb2IgY2xv\nYiA9IGdldENsb2IocnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGNsb2IgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGNs\nb2IubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwoKICAg\nICAgICAvLyB1bmxpa2VseSB0aGF0IHdlJ2xsIGhhdmUgc3RyaW5ncyBvdmVy\nIEludGVnZXIuTUFYX1ZBTFVFIGNoYXJzCiAgICAgICAgcmV0dXJuIGNsb2Iu\nZ2V0U3ViU3RyaW5nKDEsIChpbnQpIGNsb2IubGVuZ3RoKCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuIENvbnZlcnRzIHRoZSBkYXRlIGZyb20gYSB7QGxpbmsgVGltZXN0\nYW1wfSBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgRGF0ZSBnZXRE\nYXRlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBUaW1lc3RhbXAgdHN0YW1wID0gZ2V0\nVGltZXN0YW1wKHJzLCBjb2x1bW4sIG51bGwpOwogICAgICAgIGlmICh0c3Rh\nbXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIC8vIGdldCB0aGUgZnJhY3Rpb25hbCBzZWNvbmRzIGNvbXBvbmVudCwgcm91\nbmRpbmcgYXdheSBhbnl0aGluZyBiZXlvbmQKICAgICAgICAvLyBtaWxsaXNl\nY29uZHMKICAgICAgICBpbnQgZnJhY3Rpb25hbCA9IChpbnQpIE1hdGgucm91\nbmQodHN0YW1wLmdldE5hbm9zKCkgLyAoZG91YmxlKSBNSUxMSSk7CgogICAg\nICAgIC8vIGdldCB0aGUgbWlsbGlzIGNvbXBvbmVudDsgc29tZSBKREJDIGRy\naXZlcnMgcm91bmQgdGhpcyB0byB0aGUKICAgICAgICAvLyBuZWFyZXN0IHNl\nY29uZCwgd2hpbGUgb3RoZXJzIGRvIG5vdAogICAgICAgIGxvbmcgbWlsbGlz\nID0gKHRzdGFtcC5nZXRUaW1lKCkgLyAxMDAwTCkgKiAxMDAwTDsKICAgICAg\nICByZXR1cm4gbmV3IERhdGUobWlsbGlzICsgZnJhY3Rpb25hbCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGphdmEuc3FsLkRhdGUgZ2V0\nRGF0ZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENhbGVuZGFyIGNhbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY2Fs\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5nZXREYXRlKGNvbHVt\nbik7CiAgICAgICAgcmV0dXJuIHJzLmdldERhdGUoY29sdW1uLCBjYWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNv\nbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAg\nKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBkb3VibGUgZ2V0RG91\nYmxlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0RG91YmxlKGNv\nbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVj\naWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9w\nZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGZsb2F0\nIGdldEZsb2F0KFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Rmxv\nYXQoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhl\nIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhl\nIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMg\naW50IGdldEludChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldElu\ndChjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUg\ncHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBM\nb2NhbGUgZ2V0TG9jYWxlKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgc3Ry\nID0gZ2V0U3RyaW5nKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChTdHJpbmdV\ndGlscy5pc0VtcHR5KHN0cikpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoK\nICAgICAgICBTdHJpbmdbXSBwYXJhbXMgPSBTdHJpbmdzLnNwbGl0KHN0ciwg\nIl8iLCAzKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA8IDMpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBuZXcgTG9jYWxl\nKHBhcmFtc1swXSwgcGFyYW1zWzFdLCBwYXJhbXNbMl0pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBsb25nIGdldExvbmcoUmVzdWx0U2V0\nIHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBycy5nZXRMb25nKGNvbHVtbik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9m\nIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEg\ndHlwZS4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3QoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uLCBNYXAgbWFwKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIHJzLmdldE9iamVjdChjb2x1bW4pOwogICAgICAg\nIHJldHVybiBycy5nZXRPYmplY3QoY29sdW1uLCBtYXApOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBSZWYgZ2V0UmVmKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0UmVmKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIHNob3J0IGdldFNob3J0\nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0U2hvcnQoY29sdW1u\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmll\nZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Blcgog\nICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndFN0cmluZyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFN0cmlu\nZyhjb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUg\nc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUg\ncHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBU\naW1lIGdldFRpbWUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRh\nciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0VGlt\nZShjb2x1bW4pOwogICAgICAgIHJldHVybiBycy5nZXRUaW1lKGNvbHVtbiwg\nY2FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNp\nZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3Bl\ncgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgVGltZXN0\nYW1wIGdldFRpbWVzdGFtcChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIENh\nbGVuZGFyIGNhbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBycy5n\nZXRUaW1lc3RhbXAoY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0VGlt\nZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFByZXBhcmVkU3RhdGVtZW50IHdy\nYXBwZXJzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0QXJyYXkoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEFy\ncmF5IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldEFycmF5KGlkeCwgdmFs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0QXNjaWlTdHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsCiAgICAgICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQg\nbGVuZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHN0bW50LnNldEFzY2lpU3RyZWFtKGlkeCwgdmFsLCBs\nZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdEZWNpbWFsKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBCaWdEZWNpbWFsIHZhbCwKICAgICAgICBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBl\ncy5WQVJDSEFSLCBudWxsLCAwLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9\nPSBudWxsICYmIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSkKICAgICAg\nICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmluZygpLCBj\nb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RtbnQuc2V0QmlnRGVj\naW1hbChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhl\nIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJpZ0ludGVnZXIoUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIEJpZ0ludGVnZXIgdmFsLAog\nICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKChjb2wgIT0gbnVsbCAmJiBjb2wuaXNDb21wYXRp\nYmxlKFR5cGVzLlZBUkNIQVIsIG51bGwsIDAsIDApKQogICAgICAgICAgICB8\nfCAoY29sID09IG51bGwgJiYgc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3Mp\nKQogICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3Ry\naW5nKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRCaWdE\nZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKHZhbCksIGNvbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEJpbmFyeVN0cmVhbShQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwKICAgICAgICBJbnB1dFN0cmVhbSB2YWwsIGludCBs\nZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0QmluYXJ5U3RyZWFtKGlkeCwgdmFsLCBs\nZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2\nYWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRCbG9iKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LCBCbG9iIHZhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRCbG9iKGlk\neCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ndmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4gVXNlcyB0\naGUKICAgICAqIHtAbGluayAjc2VyaWFsaXplfSBtZXRob2QgdG8gc2VyaWFs\naXplIHRoZSB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qmxv\nYk9iamVjdChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2Jq\nZWN0IHZhbCwKICAgICAgICBDb2x1bW4gY29sLCBKREJDU3RvcmUgc3RvcmUp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc2V0Qnl0\nZXMoc3RtbnQsIGlkeCwgc2VyaWFsaXplKHZhbCwgc3RvcmUpLCBjb2wpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRCb29sZWFuKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBib29sZWFuIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldElu\ndChpZHgsICh2YWwpID8gMSA6IDApOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCeXRlKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBieXRlIHZhbCwgQ29sdW1u\nIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBz\ndG1udC5zZXRCeXRlKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZXMoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGJ5dGVbXSB2YWwsCiAg\nICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAodXNlU2V0Qnl0ZXNGb3JCbG9icykKICAgICAgICAg\nICAgc3RtbnQuc2V0Qnl0ZXMoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgc2V0QmluYXJ5U3RyZWFtKHN0bW50LCBpZHgsIG5ldyBCeXRl\nQXJyYXlJbnB1dFN0cmVhbSh2YWwpLAogICAgICAgICAgICAgICAgdmFsLmxl\nbmd0aCwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2hhcihQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgY2hhciB2YWwsIENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKChjb2wgIT0g\nbnVsbCAmJiBjb2wuaXNDb21wYXRpYmxlKFR5cGVzLklOVEVHRVIsIG51bGws\nIDAsIDApKQogICAgICAgICAgICB8fCAoY29sID09IG51bGwgJiYgc3RvcmVD\naGFyc0FzTnVtYmVycykpCiAgICAgICAgICAgIHNldEludChzdG1udCwgaWR4\nLCAoaW50KSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBz\nZXRTdHJpbmcoc3RtbnQsIGlkeCwgU3RyaW5nLnZhbHVlT2YodmFsKSwgY29s\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0Q2hhcmFjdGVyU3RyZWFtKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LAogICAgICAgIFJlYWRlciB2YWwsIGludCBs\nZW5ndGgsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3RtbnQuc2V0Q2hhcmFjdGVyU3RyZWFtKGlkeCwgdmFs\nLCBsZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZl\nbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRDbG9iKFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50LCBpbnQgaWR4LCBDbG9iIHZhbCwgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRDbG9i\nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0Q2xvYlN0cmluZyhQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBD\nb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICh1c2VTZXRTdHJpbmdGb3JDbG9icykKICAgICAgICAgICAgc3Rt\nbnQuc2V0U3RyaW5nKGlkeCwgdmFsKTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgLy8gc2V0IHJlYWRlciBmcm9tIHN0cmluZwogICAgICAgICAgICBT\ndHJpbmdSZWFkZXIgaW4gPSBuZXcgU3RyaW5nUmVhZGVyKHZhbCk7CiAgICAg\nICAgICAgIHNldENoYXJhY3RlclN0cmVhbShzdG1udCwgaWR4LCBpbiwgdmFs\nLmxlbmd0aCgpLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0ZShQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgRGF0ZSB2YWwsIENv\nbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMu\nREFURSkKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCBuZXcgamF2\nYS5zcWwuRGF0ZSh2YWwuZ2V0VGltZSgpKSwgbnVsbCwgY29sKTsKICAgICAg\nICBlbHNlIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlwZSgpID09IFR5\ncGVzLlRJTUUpCiAgICAgICAgICAgIHNldFRpbWUoc3RtbnQsIGlkeCwgbmV3\nIFRpbWUodmFsLmdldFRpbWUoKSksIG51bGwsIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgVGltZXN0YW1wKQogICAgICAgICAgICBz\nZXRUaW1lc3RhbXAoc3RtbnQsIGlkeCwoVGltZXN0YW1wKSB2YWwsIG51bGws\nIGNvbCk7ICAgCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRUaW1lc3Rh\nbXAoc3RtbnQsIGlkeCwgbmV3IFRpbWVzdGFtcCh2YWwuZ2V0VGltZSgpKSwg\nbnVsbCwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RGF0ZShQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgamF2YS5zcWwuRGF0ZSB2YWwsCiAgICAgICAg\nQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkKICAgICAgICAg\nICAgc3RtbnQuc2V0RGF0ZShpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzdG1udC5zZXREYXRlKGlkeCwgdmFsLCBjYWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFt\nZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRDYWxlbmRhcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgQ2FsZW5kYXIgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gYnkgZGVmYXVsdCB3\nZSBtZXJlbHkgZGVsZWdhdGUgdGhlIHRoZSBEYXRlIHBhcmFtZXRlcgogICAg\nICAgIHNldERhdGUoc3RtbnQsIGlkeCwgdmFsLmdldFRpbWUoKSwgY29sKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMg\nYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0RG91YmxlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBkb3VibGUgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0RG91\nYmxlKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0RmxvYXQoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIGZsb2F0IHZhbCwKICAgICAgICBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHN0bW50LnNldEZsb2F0KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhl\nIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50KFBy\nZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQgdmFsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHN0bW50LnNldEludChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExvbmcoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGxvbmcgdmFsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIHN0bW50LnNldExvbmcoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUg\nc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUo\nUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIExvY2FsZSB2YWws\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLmdldExh\nbmd1YWdlKCkgKyAiXyIgKyB2YWwuZ2V0Q291bnRyeSgpCiAgICAgICAgICAg\nICsgIl8iICsgdmFsLmdldFZhcmlhbnQoKSwgY29sKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXJz\nIHRvIHRoZSBzdGF0ZW1lbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2ls\nbCBjb21lIGZyb20ge0BsaW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgaW50IGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXROdWxsKGlk\neCwgY29sVHlwZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdp\ndmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE51bWJlcihQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgaW50IGlkeCwgTnVtYmVyIG51bSwKICAgICAgICBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIC8vIGNoZWNrIGZvciBrbm93biBmbG9hdGluZyBwb2ludCB0eXBlcyB0byBn\naXZlIGRyaXZlciBhIGNoYW5jZSB0bwogICAgICAgIC8vIGhhbmRsZSBzcGVj\naWFsIG51bWJlcnMgbGlrZSBOYU4gYW5kIGluZmluaXR5OyBidWcgIzEwNTMK\nICAgICAgICBpZiAobnVtIGluc3RhbmNlb2YgRG91YmxlKQogICAgICAgICAg\nICBzZXREb3VibGUoc3RtbnQsIGlkeCwgKChEb3VibGUpIG51bSkuZG91Ymxl\nVmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmIChudW0gaW5zdGFuY2Vv\nZiBGbG9hdCkKICAgICAgICAgICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChG\nbG9hdCkgbnVtKS5mbG9hdFZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdE\nZWNpbWFsKG51bS50b1N0cmluZygpKSwgY29sKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXJzIHRv\nIHRoZSBzdGF0ZW1lbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBj\nb21lIGZyb20ge0BsaW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0T2JqZWN0KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4\nLCBPYmplY3QgdmFsLAogICAgICAgIGludCBjb2xUeXBlLCBDb2x1bW4gY29s\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChj\nb2xUeXBlID09IC0xIHx8IGNvbFR5cGUgPT0gVHlwZXMuT1RIRVIpCiAgICAg\nICAgICAgIHN0bW50LnNldE9iamVjdChpZHgsIHZhbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdG1udC5zZXRPYmplY3QoaWR4LCB2YWwsIGNvbFR5\ncGUpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1\nZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRSZWYoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIGludCBpZHgsIFJlZiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0UmVmKGlkeCwgdmFs\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUg\nYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0U2hvcnQoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQs\nIGludCBpZHgsIHNob3J0IHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0bW50LnNldFNo\nb3J0KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3RyaW5nKFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCBpbnQgaWR4LCBTdHJpbmcgdmFsLAogICAgICAgIENv\nbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgc3RtbnQuc2V0U3RyaW5nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8g\ndGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VGlt\nZShQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgVGltZSB2YWws\nCiAgICAgICAgQ2FsZW5kYXIgY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkK\nICAgICAgICAgICAgc3RtbnQuc2V0VGltZShpZHgsIHZhbCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzdG1udC5zZXRUaW1lKGlkeCwgdmFsLCBjYWwp\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBh\ncyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRUaW1lc3RhbXAoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsCiAgICAgICAgVGltZXN0YW1wIHZhbCwgQ2FsZW5kYXIg\nY2FsLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIC8vIGVuc3VyZSB0aGF0IHdlIGRvIG5vdCBpbnNlcnQgZGF0\nZXMgYXQgYSBncmVhdGVyIHByZWNpc2lvbiB0aGFuCiAgICAgICAgLy8gdGhh\ndCBhdCB3aGljaCB0aGV5IHdpbGwgYmUgcmV0dXJuZWQgYnkgYSBTRUxFQ1QK\nICAgICAgICBpbnQgcm91bmRlZCA9IChpbnQpIE1hdGgucm91bmQodmFsLmdl\ndE5hbm9zKCkgLwogICAgICAgICAgICAoZG91YmxlKSBkYXRlUHJlY2lzaW9u\nKTsKICAgICAgICBpbnQgbmFub3MgPSByb3VuZGVkICogZGF0ZVByZWNpc2lv\nbjsKICAgICAgICBpZiAobmFub3MgPiA5OTk5OTk5OTkpIHsKICAgICAgICAg\nICAgLy8gcm9sbG92ZXIgdG8gbmV4dCBzZWNvbmQKICAgICAgICAgICAgdmFs\nLnNldFRpbWUodmFsLmdldFRpbWUoKSArIDEwMDApOwogICAgICAgICAgICBu\nYW5vcyA9IDA7CiAgICAgICAgfQoKICAgICAgICB2YWwuc2V0TmFub3MobmFu\nb3MpOwoKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAgIHN0\nbW50LnNldFRpbWVzdGFtcChpZHgsIHZhbCk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBzdG1udC5zZXRUaW1lc3RhbXAoaWR4LCB2YWwsIGNhbCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgYSBjb2x1bW4gdmFsdWUgaW50byBh\nIHByZXBhcmVkIHN0YXRlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3Rt\nbnQgdGhlIHByZXBhcmVkIHN0YXRlbWVudCB0byBwYXJhbWV0ZXJpemUKICAg\nICAqIEBwYXJhbSBpZHggdGhlIGluZGV4IG9mIHRoZSBwYXJhbWV0ZXIgaW4g\ndGhlIHByZXBhcmVkIHN0YXRlbWVudAogICAgICogQHBhcmFtIHZhbCB0aGUg\ndmFsdWUgb2YgdGhlIGNvbHVtbgogICAgICogQHBhcmFtIGNvbCB0aGUgY29s\ndW1uIGJlaW5nIHNldAogICAgICogQHBhcmFtIHR5cGUgdGhlIGZpZWxkIG1h\ncHBpbmcgdHlwZSBjb2RlIGZvciB0aGUgdmFsdWUKICAgICAqIEBwYXJhbSBz\ndG9yZSB0aGUgc3RvcmUgbWFuYWdlciBmb3IgdGhlIGN1cnJlbnQgY29udGV4\ndAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUeXBlZChQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAgICBD\nb2x1bW4gY29sLCBpbnQgdHlwZSwgSkRCQ1N0b3JlIHN0b3JlKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh2YWwgPT0gbnVs\nbCkgewogICAgICAgICAgICBzZXROdWxsKHN0bW50LCBpZHgsIChjb2wgPT0g\nbnVsbCkgPyBUeXBlcy5PVEhFUiA6IGNvbC5nZXRUeXBlKCksCiAgICAgICAg\nICAgICAgICBjb2wpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBTaXplZCBzOwogICAgICAgIENhbGVuZGFyZCBjOwogICAgICAg\nIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOX09C\nSjoKICAgICAgICAgICAgICAgIHNldEJvb2xlYW4oc3RtbnQsIGlkeCwgKChC\nb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgogICAgICAg\nICAgICAgICAgc2V0Qnl0ZShzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5i\neXRlVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIHNldENoYXIo\nc3RtbnQsIGlkeCwgKChDaGFyYWN0ZXIpIHZhbCkuY2hhclZhbHVlKCksIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5E\nT1VCTEVfT0JKOgogICAgICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBp\nZHgsICgoTnVtYmVyKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoK\nICAgICAgICAgICAgICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoTnVtYmVy\nKSB2YWwpLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICBz\nZXRJbnQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwg\nY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT05HX09CSjoKICAgICAgICAgICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwg\nKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAg\nICAgICAgICAgIHNldFNob3J0KHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwp\nLnNob3J0VmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAg\nICAgICBpZiAoY29sICE9IG51bGwgJiYgKGNvbC5nZXRUeXBlKCkgPT0gVHlw\nZXMuQ0xPQgogICAgICAgICAgICAgICAgICAgIHx8IGNvbC5nZXRUeXBlKCkg\nPT0gVHlwZXMuTE9OR1ZBUkNIQVIpKQogICAgICAgICAgICAgICAgICAgIHNl\ndENsb2JTdHJpbmcoc3RtbnQsIGlkeCwgKFN0cmluZykgdmFsLCBjb2wpOwog\nICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFN0\ncmluZyhzdG1udCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JK\nRUNUOgogICAgICAgICAgICAgICAgc2V0QmxvYk9iamVjdChzdG1udCwgaWR4\nLCB2YWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAg\nICBzZXREYXRlKHN0bW50LCBpZHgsIChEYXRlKSB2YWwsIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ0FMRU5EQVI6CiAgICAgICAgICAgICAgICBzZXRDYWxlbmRhcihzdG1udCwg\naWR4LCAoQ2FsZW5kYXIpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgog\nICAgICAgICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmln\nRGVjaW1hbCkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAg\nICAgICAgICBzZXRCaWdJbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2Vy\nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgc2V0\nTnVtYmVyKHN0bW50LCBpZHgsIChOdW1iZXIpIHZhbCwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT0NBTEU6CiAgICAgICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwg\nKExvY2FsZSkgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAg\nICAgICAgICAgIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgICAgIHMg\nPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldEFzY2lpU3RyZWFt\nKHN0bW50LCBpZHgsIChJbnB1dFN0cmVhbSkgcy52YWx1ZSwgcy5zaXplLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVNRTFR5cGVzLkJJTkFSWV9TVFJFQU06CiAgICAgICAgICAgICAgICBz\nID0gKFNpemVkKSB2YWw7CiAgICAgICAgICAgICAgICBzZXRCaW5hcnlTdHJl\nYW0oc3RtbnQsIGlkeCwgKElucHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUs\nIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQkxPQjoKICAgICAgICAgICAgICAgIHNldEJsb2Io\nc3RtbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoK\nICAgICAgICAgICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10p\nIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFTUUxUeXBlcy5DSEFSX1NUUkVBTToKICAgICAgICAgICAg\nICAgIHMgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgICAgIHNldENoYXJh\nY3RlclN0cmVhbShzdG1udCwgaWR4LCAoUmVhZGVyKSBzLnZhbHVlLCBzLnNp\nemUsIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHNldENs\nb2Ioc3RtbnQsIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5TUUxf\nREFURToKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxl\nbmRhcmQpIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkg\ndmFsOwogICAgICAgICAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwg\nKGphdmEuc3FsLkRhdGUpIGMudmFsdWUsIGMuY2FsZW5kYXIsCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgICAgICBzZXREYXRlKHN0bW50LCBpZHgsIChqYXZh\nLnNxbC5EYXRlKSB2YWwsIG51bGwsIGNvbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuUkVGOgogICAg\nICAgICAgICAgICAgc2V0UmVmKHN0bW50LCBpZHgsIChSZWYpIHZhbCwgY29s\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFTUUxUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgaWYgKHZhbCBpbnN0\nYW5jZW9mIENhbGVuZGFyZCkgewogICAgICAgICAgICAgICAgICAgIGMgPSAo\nQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShz\ndG1udCwgaWR4LCAoVGltZSkgYy52YWx1ZSwgYy5jYWxlbmRhciwgY29sKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNl\ndFRpbWUoc3RtbnQsIGlkeCwgKFRpbWUpIHZhbCwgbnVsbCwgY29sKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxU\neXBlcy5USU1FU1RBTVA6CiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3Rh\nbmNlb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChD\nYWxlbmRhcmQpIHZhbDsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lc3Rh\nbXAoc3RtbnQsIGlkeCwgKFRpbWVzdGFtcCkgYy52YWx1ZSwgYy5jYWxlbmRh\nciwKICAgICAgICAgICAgICAgICAgICAgICAgY29sKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChz\ndG1udCwgaWR4LCAoVGltZXN0YW1wKSB2YWwsIG51bGwsIGNvbCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgIGlmIChjb2wgIT0gbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9\nPSBUeXBlcy5CTE9CCiAgICAgICAgICAgICAgICAgICAgfHwgY29sLmdldFR5\ncGUoKSA9PSBUeXBlcy5WQVJCSU5BUlkpKQogICAgICAgICAgICAgICAgICAg\nIHNldEJsb2JPYmplY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wsIHN0b3JlKTsK\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRP\nYmplY3Qoc3RtbnQsIGlkeCwgdmFsLCBjb2wuZ2V0VHlwZSgpLCBjb2wpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNvbXBsZXRl\nbHkgdW5rbm93biBwYXJhbWV0ZXIgaW50byBhIHByZXBhcmVkIHN0YXRlbWVu\ndC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0VW5rbm93bihQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgT2JqZWN0IHZhbCwKICAgICAg\nICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIFNpemVkIHNpemVkID0gbnVsbDsKICAgICAgICBDYWxlbmRhcmQg\nY2FsZCA9IG51bGw7CiAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFNpemVk\nKSB7CiAgICAgICAgICAgIHNpemVkID0gKFNpemVkKSB2YWw7CiAgICAgICAg\nICAgIHZhbCA9IHNpemVkLnZhbHVlOwogICAgICAgIH0gZWxzZSBpZiAodmFs\nIGluc3RhbmNlb2YgQ2FsZW5kYXJkKSB7CiAgICAgICAgICAgIGNhbGQgPSAo\nQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAgIHZhbCA9IGNhbGQudmFsdWU7\nCiAgICAgICAgfQoKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgIHNldE51bGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVz\nLk9USEVSIDogY29sLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgU3RyaW5nKQogICAg\nICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLnRvU3RyaW5nKCks\nIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgSW50ZWdl\ncikKICAgICAgICAgICAgc2V0SW50KHN0bW50LCBpZHgsICgoSW50ZWdlcikg\ndmFsKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIEJvb2xlYW4pCiAgICAgICAgICAgIHNldEJvb2xlYW4oc3Rt\nbnQsIGlkeCwgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIExvbmcpCiAgICAg\nICAgICAgIHNldExvbmcoc3RtbnQsIGlkeCwgKChMb25nKSB2YWwpLmxvbmdW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIEZsb2F0KQogICAgICAgICAgICBzZXRGbG9hdChzdG1udCwgaWR4LCAoKEZs\nb2F0KSB2YWwpLmZsb2F0VmFsdWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBEb3VibGUpCiAgICAgICAgICAgIHNldERvdWJs\nZShzdG1udCwgaWR4LCAoKERvdWJsZSkgdmFsKS5kb3VibGVWYWx1ZSgpLCBj\nb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJ5dGUpCiAg\nICAgICAgICAgIHNldEJ5dGUoc3RtbnQsIGlkeCwgKChCeXRlKSB2YWwpLmJ5\ndGVWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIENoYXJhY3RlcikKICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4\nLCAoKENoYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBTaG9ydCkKICAgICAgICAgICAg\nc2V0U2hvcnQoc3RtbnQsIGlkeCwgKChTaG9ydCkgdmFsKS5zaG9ydFZhbHVl\nKCksIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgTG9j\nYWxlKQogICAgICAgICAgICBzZXRMb2NhbGUoc3RtbnQsIGlkeCwgKExvY2Fs\nZSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIEJpZ0RlY2ltYWwpCiAgICAgICAgICAgIHNldEJpZ0RlY2ltYWwoc3RtbnQs\nIGlkeCwgKEJpZ0RlY2ltYWwpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBCaWdJbnRlZ2VyKQogICAgICAgICAgICBzZXRC\naWdJbnRlZ2VyKHN0bW50LCBpZHgsIChCaWdJbnRlZ2VyKSB2YWwsIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpCiAgICAg\nICAgICAgIHNldEFycmF5KHN0bW50LCBpZHgsIChBcnJheSkgdmFsLCBjb2wp\nOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIEJsb2IpCiAgICAg\nICAgICAgIHNldEJsb2Ioc3RtbnQsIGlkeCwgKEJsb2IpIHZhbCwgY29sKTsK\nICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBieXRlW10pCiAgICAg\nICAgICAgIHNldEJ5dGVzKHN0bW50LCBpZHgsIChieXRlW10pIHZhbCwgY29s\nKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDbG9iKQogICAg\nICAgICAgICBzZXRDbG9iKHN0bW50LCBpZHgsIChDbG9iKSB2YWwsIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgUmVmKQogICAgICAg\nICAgICBzZXRSZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAg\nICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIGphdmEuc3FsLkRhdGUpCiAg\nICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUp\nIHZhbCwKICAgICAgICAgICAgICAgIChjYWxkID09IG51bGwpID8gbnVsbCA6\nIGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGlu\nc3RhbmNlb2YgVGltZXN0YW1wKQogICAgICAgICAgICBzZXRUaW1lc3RhbXAo\nc3RtbnQsIGlkeCwgKFRpbWVzdGFtcCkgdmFsLAogICAgICAgICAgICAgICAg\nKGNhbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwgY29sKTsK\nICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lKQogICAgICAg\nICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIChUaW1lKSB2YWwsCiAgICAgICAg\nICAgICAgICAoY2FsZCA9PSBudWxsKSA/IG51bGwgOiBjYWxkLmNhbGVuZGFy\nLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUp\nCiAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKERhdGUpIHZhbCwg\nY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRh\ncikKICAgICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoKENhbGVuZGFy\nKSB2YWwpLmdldFRpbWUoKSwgY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwg\naW5zdGFuY2VvZiBSZWFkZXIpCiAgICAgICAgICAgIHNldENoYXJhY3RlclN0\ncmVhbShzdG1udCwgaWR4LCAoUmVhZGVyKSB2YWwsCiAgICAgICAgICAgICAg\nICAoc2l6ZWQgPT0gbnVsbCkgPyAwIDogc2l6ZWQuc2l6ZSwgY29sKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtcGFyYW0iLCB2YWwuZ2V0Q2xhc3MoKSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXJpYWxpemVkIGJ5dGVz\nIGZvciB0aGUgZ2l2ZW4gb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgYnl0\nZVtdIHNlcmlhbGl6ZShPYmplY3QgdmFsLCBKREJDU3RvcmUgc3RvcmUpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHZhbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAo\ndmFsIGluc3RhbmNlb2YgU2VyaWFsaXplZERhdGEpCiAgICAgICAgICAgIHJl\ndHVybiAoKFNlcmlhbGl6ZWREYXRhKSB2YWwpLmJ5dGVzOwogICAgICAgIHJl\ndHVybiBTZXJpYWxpemF0aW9uLnNlcmlhbGl6ZSh2YWwsIHN0b3JlLmdldENv\nbnRleHQoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2UgdGhlIEpE\nSyAxLjQgPGNvZGU+c2V0Qnl0ZXM8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2\nZW4gQkxPQiBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHB1dEJ5\ndGVzKE9iamVjdCBibG9iLCBieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX3NldEJ5dGVzID09IG51bGwp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRCeXRl\ncyA9IGJsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInNldEJ5dGVzIiwKICAg\nICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0\nZVtdLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1\ndExvYk1ldGhvZChfc2V0Qnl0ZXMsIGJsb2IsCiAgICAgICAgICAgIG5ldyBP\nYmplY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRT\ndHJpbmc8L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICog\nb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRTdHJpbmcoT2Jq\nZWN0IGNsb2IsIFN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChfc2V0U3RyaW5nID09IG51bGwpIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRTdHJpbmcgPSBj\nbG9iLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRTdHJpbmciLAogICAgICAg\nICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBTdHJpbmcu\nY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9i\nTWV0aG9kKF9zZXRTdHJpbmcsIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmpl\nY3RbXXsgTnVtYmVycy52YWx1ZU9mKDFMKSwgZGF0YSB9KTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRDaGFy\nYWN0ZXJTdHJlYW08L2NvZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4KICAgICAq\nIENMT0Igb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRDaGFy\ncyhPYmplY3QgY2xvYiwgY2hhcltdIGRhdGEpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9zZXRDaGFyU3RyZWFtID09IG51\nbGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9zZXRD\naGFyU3RyZWFtID0gY2xvYi5nZXRDbGFzcygpLmdldE1ldGhvZAogICAgICAg\nICAgICAgICAgICAgICgic2V0Q2hhcmFjdGVyU3RyZWFtIiwgbmV3IENsYXNz\nW117IGxvbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFdy\naXRlciB3cml0ZXIgPSAoV3JpdGVyKSBpbnZva2VQdXRMb2JNZXRob2QoX3Nl\ndENoYXJTdHJlYW0sIGNsb2IsCiAgICAgICAgICAgIG5ldyBPYmplY3RbXXsg\nTnVtYmVycy52YWx1ZU9mKDFMKSB9KTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICB3cml0ZXIud3JpdGUoZGF0YSk7CiAgICAgICAgICAgIHdyaXRlci5m\nbHVzaCgpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGlvZS50b1N0cmlu\nZygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnZva2Ug\ndGhlIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRhcmdldCB3aXRo\nIHRoZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBP\nYmplY3QgaW52b2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRob2QsIE9iamVj\ndCB0YXJnZXQsCiAgICAgICAgT2JqZWN0W10gYXJncykKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gbWV0aG9kLmludm9rZSh0YXJnZXQsIGFyZ3MpOwogICAgICAgIH0g\nY2F0Y2ggKEludm9jYXRpb25UYXJnZXRFeGNlcHRpb24gaXRlKSB7CiAgICAg\nICAgICAgIFRocm93YWJsZSB0ID0gaXRlLmdldFRhcmdldEV4Y2VwdGlvbigp\nOwogICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIFNRTEV4Y2VwdGlvbikK\nICAgICAgICAgICAgICAgIHRocm93KFNRTEV4Y2VwdGlvbikgdDsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKHQpOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBT\ndG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBXYXJuIHRoYXQgYSBwYXJ0aWN1bGFyIHZhbHVlIGNvdWxkIG5vdCBi\nZSBzdG9yZWQgcHJlY2lzZWx5LgogICAgICogQWZ0ZXIgdGhlIGZpcnN0IHdh\ncm5pbmcgZm9yIGEgcGFydGljdWxhciB0eXBlLCBtZXNzYWdlcwogICAgICog\nd2lsbCBiZSB0dXJuZWQgaW50byB0cmFjZSBtZXNzYWdlcy4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgc3RvcmFnZVdhcm5pbmcoT2JqZWN0IG9yaWcs\nIE9iamVjdCBjb252ZXJ0ZWQpIHsKICAgICAgICBib29sZWFuIHdhcm47CiAg\nICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChf\ncHJlY2lzaW9uV2FybmVkVHlwZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9wcmVjaXNpb25XYXJuZWRUeXBlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAg\nICAgICAgIHdhcm4gPSBfcHJlY2lzaW9uV2FybmVkVHlwZXMuYWRkKG9yaWcu\nZ2V0Q2xhc3MoKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RvcmFnZUxp\nbWl0YXRpb25zRmF0YWwgfHwgKHdhcm4gJiYgbG9nLmlzV2FybkVuYWJsZWQo\nKSkKICAgICAgICAgICAgfHwgKCF3YXJuICYmIGxvZy5pc1RyYWNlRW5hYmxl\nZCgpKSkgewogICAgICAgICAgICBNZXNzYWdlIG1zZyA9IF9sb2MuZ2V0KCJz\ndG9yYWdlLXJlc3RyaWN0aW9uIiwgbmV3IE9iamVjdFtdewogICAgICAgICAg\nICAgICAgcGxhdGZvcm0sCiAgICAgICAgICAgICAgICBvcmlnLAogICAgICAg\nICAgICAgICAgb3JpZy5nZXRDbGFzcygpLmdldE5hbWUoKSwKICAgICAgICAg\nICAgICAgIGNvbnZlcnRlZCwKICAgICAgICAgICAgfSk7CgogICAgICAgICAg\nICBpZiAoc3RvcmFnZUxpbWl0YXRpb25zRmF0YWwpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24obXNnKTsKCiAgICAgICAgICAg\nIGlmICh3YXJuKQogICAgICAgICAgICAgICAgbG9nLndhcm4obXNnKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKG1zZyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLwogICAgLy8gVHlwZXMK\nICAgIC8vLy8vLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVm\nZXJyZWQge0BsaW5rIFR5cGVzfSBjb25zdGFudCBmb3IgdGhlIGdpdmVuCiAg\nICAgKiB7QGxpbmsgSmF2YVR5cGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVz\nfSBjb25zdGFudC4KICAgICAqLwogICAgcHVibGljIGludCBnZXRKREJDVHlw\nZShpbnQgbWV0YVR5cGVDb2RlLCBib29sZWFuIGxvYikgewogICAgICAgIGlm\nIChsb2IpIHsKICAgICAgICAgICAgc3dpdGNoIChtZXRhVHlwZUNvZGUpIHsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNIQVJfU1RSRUFNOgog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5\ncGVzLkNMT0IpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CTE9C\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICht\nZXRhVHlwZUNvZGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5CSVQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTllJTlQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgIGlmIChz\ndG9yZUNoYXJzQXNOdW1iZXJzKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLklOVEVHRVIpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0hBUik7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5SRUFMKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuSU5UOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRf\nT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUo\nVHlwZXMuSU5URUdFUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxP\nTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQklH\nSU5UKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlNNQUxMSU5UKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVNRTFR5cGVzLkFTQ0lJX1NUUkVBTToKICAgICAgICAgICAgY2FzZSBKYXZh\nU1FMVHlwZXMuQ0hBUl9TVFJFQU06CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIGlm\nIChzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsK\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVz\nLkJJR0lOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lN\nQUw6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0\ncmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJl\nZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5OVU1FUklDKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTlVNQkVSOgogICAgICAgICAgICAgICAgaWYgKHN0\nb3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuTlVN\nRVJJQyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRVNUQU1QKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgogICAg\nICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQVJS\nQVkpOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CSU5BUllfU1RS\nRUFNOgogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CTE9COgogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5CWVRFUzoKICAgICAgICAgICAg\nICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAg\nICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5DTE9COgogICAgICAgICAgICAg\nICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuREFURSk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5USU1FKTsKICAg\nICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuVElNRVNUQU1QOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRVNU\nQU1QKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJMT0IpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcHJlZmVycmVkIHtA\nbGluayBUeXBlc30gdHlwZSBmb3IgdGhlIGdpdmVuIG9uZS4gUmV0dXJucwog\nICAgICogdGhlIGdpdmVuIHR5cGUgYnkgZGVmYXVsdC4KICAgICAqLwogICAg\ncHVibGljIGludCBnZXRQcmVmZXJyZWRUeXBlKGludCB0eXBlKSB7CiAgICAg\nICAgcmV0dXJuIHR5cGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHByZWZlcnJlZCBkYXRhYmFzZSB0eXBlIG5hbWUgZm9yIHRoZSBnaXZl\nbiBjb2x1bW4ncyB0eXBlCiAgICAgKiBmcm9tIHtAbGluayBUeXBlc30uCiAg\nICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZU5hbWUoQ29sdW1uIGNv\nbCkgewogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShjb2wuZ2V0\nVHlwZU5hbWUoKSkpCiAgICAgICAgICAgIHJldHVybiBhcHBlbmRTaXplKGNv\nbCwgY29sLmdldFR5cGVOYW1lKCkpOwoKICAgICAgICBpZiAoY29sLmlzQXV0\nb0Fzc2lnbmVkKCkgJiYgYXV0b0Fzc2lnblR5cGVOYW1lICE9IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBhcHBlbmRTaXplKGNvbCwgYXV0b0Fzc2lnblR5\ncGVOYW1lKTsKCiAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCBnZXRU\neXBlTmFtZShjb2wuZ2V0VHlwZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm5zIHRoZSB0eXBlIG5hbWUgZm9yIHRoZSBzcGVjaWZpYyBjb25z\ndGFudCBhcyBkZWZpbmVkCiAgICAgKiBieSB7QGxpbmsgamF2YS5zcWwuVHlw\nZXN9LgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBlCiAgICAg\nKiBAcmV0dXJuIHRoZSBuYW1lIGZvciB0aGUgdHlwZQogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nIGdldFR5cGVOYW1lKGludCB0eXBlKSB7CiAgICAgICAg\nc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXlUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5CSUdJTlQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gYmlnaW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklO\nQVJZOgogICAgICAgICAgICAgICAgcmV0dXJuIGJpbmFyeVR5cGVOYW1lOwog\nICAgICAgICAgICBjYXNlIFR5cGVzLkJJVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBiaXRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CTE9C\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGJvb2xlYW5UeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5D\nSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXJUeXBlTmFtZTsKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAgICAgICAgICAgcmV0\ndXJuIGNsb2JUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5EQVRF\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5ERUNJTUFMOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGRlY2ltYWxUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5E\nSVNUSU5DVDoKICAgICAgICAgICAgICAgIHJldHVybiBkaXN0aW5jdFR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRPVUJMRToKICAgICAgICAg\nICAgICAgIHJldHVybiBkb3VibGVUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJldHVybiBmbG9hdFR5\ncGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLklOVEVHRVI6CiAgICAg\nICAgICAgICAgICByZXR1cm4gaW50ZWdlclR5cGVOYW1lOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkpBVkFfT0JKRUNUOgogICAgICAgICAgICAgICAgcmV0\ndXJuIGphdmFPYmplY3RUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBl\ncy5MT05HVkFSQklOQVJZOgogICAgICAgICAgICAgICAgcmV0dXJuIGxvbmdW\nYXJiaW5hcnlUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05H\nVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBsb25nVmFyY2hhclR5\ncGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk5VTEw6CiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbFR5cGVOYW1lOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLk5VTUVSSUM6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVtZXJp\nY1R5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk9USEVSOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG90aGVyVHlwZU5hbWU7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuUkVBTDoKICAgICAgICAgICAgICAgIHJldHVybiByZWFs\nVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVGOgogICAgICAg\nICAgICAgICAgcmV0dXJuIHJlZlR5cGVOYW1lOwogICAgICAgICAgICBjYXNl\nIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICAgICAgcmV0dXJuIHNtYWxs\naW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuU1RSVUNUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHN0cnVjdFR5cGVOYW1lOwogICAgICAg\nICAgICBjYXNlIFR5cGVzLlRJTUU6CiAgICAgICAgICAgICAgICByZXR1cm4g\ndGltZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFN\nUDoKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lc3RhbXBUeXBlTmFtZTsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5USU5ZSU5UOgogICAgICAgICAgICAg\nICAgcmV0dXJuIHRpbnlpbnRUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBU\neXBlcy5WQVJCSU5BUlk6CiAgICAgICAgICAgICAgICByZXR1cm4gdmFyYmlu\nYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVkFSQ0hBUjoK\nICAgICAgICAgICAgICAgIHJldHVybiB2YXJjaGFyVHlwZU5hbWU7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gb3RoZXJU\neXBlTmFtZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIGFkZCBzaXplIHByb3BlcnRpZXMgdG8gdGhlIHNwZWNp\nZmllZCB0eXBlLgogICAgICogSWYgcHJlc2VudCwgdGhlIHN0cmluZyAiezB9\nIiB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIHNpemUgZGVmaW5pdGlvbjsK\nICAgICAqIG90aGVyd2lzZSB0aGUgc2l6ZSBkZWZpbml0aW9uIHdpbGwgYmUg\nYXBwZW5kZWQgdG8gdGhlIHR5cGUgbmFtZS4KICAgICAqIElmIHlvdXIgZGF0\nYWJhc2UgaGFzIGNvbHVtbiB0eXBlcyB0aGF0IGRvbid0IGFsbG93IHNpemUg\nZGVmaW5pdGlvbnMsCiAgICAgKiBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBy\nZXR1cm4gdGhlIHVuYWx0ZXJlZCB0eXBlIG5hbWUgZm9yIGNvbHVtbnMgb2YK\nICAgICAqIHRob3NlIHR5cGVzIChvciBhZGQgdGhlIHR5cGUgbmFtZXMgdG8g\ndGhlCiAgICAgKiA8Y29kZT5maXhlZFNpemVUeXBlTmFtZVNldDwvY29kZT4p\nLgogICAgICogCiAgICAgKiA8UD5Tb21lIGRhdGFiYXNlcyBzdXBwb3J0ICJ0\neXBlIG1vZGlmaWVycyIgZm9yIGV4YW1wbGUgdGhlIHVuc2lnbmVkCiAgICAg\nKiAibW9kaWZpZXIiIGluIE15U1FMLiBJbiB0aGVzZSBjYXNlcyB0aGUgc2l6\nZSBzaG91bGQgZ28gYmV0d2VlbiB0aGUgdHlwZSAKICAgICAqIGFuZCB0aGUg\nIm1vZGlmaWVyIiwgaW5zdGVhZCBvZiBhZnRlciB0aGUgbW9kaWZpZXIuIEZv\nciBleGFtcGxlIAogICAgICogQ1JFQVRFIHRhYmxlIEZPTyAoIG15aW50IElO\nVCAoMTApIFVOU0lHTkVEIC4gLiAuKSBpbnN0ZWFkIG9mIAogICAgICogQ1JF\nQVRFIHRhYmxlIEZPTyAoIG15aW50IElOVCBVTlNJR05FRCAoMTApIC4gLiAu\nKS4KICAgICAqIFR5cGUgbW9kaWZpZXJzIHNob3VsZCBiZSBhZGRlZCB0byA8\nY29kZT50eXBlTW9kaWZpZXJTZXQ8L2NvZGU+IGluIAogICAgICogc3ViY2xh\nc3Nlcy4gCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgYXBwZW5kU2l6\nZShDb2x1bW4gY29sLCBTdHJpbmcgdHlwZU5hbWUpIHsKICAgICAgICBpZiAo\nZml4ZWRTaXplVHlwZU5hbWVTZXQuY29udGFpbnModHlwZU5hbWUudG9VcHBl\nckNhc2UoKSkpCiAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZTsKICAgICAg\nICBpZiAodHlwZU5hbWUuaW5kZXhPZignKCcpICE9IC0xKQogICAgICAgICAg\nICByZXR1cm4gdHlwZU5hbWU7CgogICAgICAgIFN0cmluZyBzaXplID0gbnVs\nbDsKICAgICAgICBpZiAoY29sLmdldFNpemUoKSA+IDApIHsKICAgICAgICAg\nICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoMTApOwog\nICAgICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKGNvbC5nZXRTaXpl\nKCkpOwogICAgICAgICAgICBpZiAoY29sLmdldERlY2ltYWxEaWdpdHMoKSA+\nIDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpLmFwcGVuZChj\nb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiKSIpOwogICAgICAgICAgICBzaXplID0gYnVmLnRvU3RyaW5nKCk7CiAg\nICAgICAgfQoKICAgICAgICByZXR1cm4gaW5zZXJ0U2l6ZSh0eXBlTmFtZSwg\nc2l6ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRo\nYXQgaW5zZXJ0cyBhIHNpemUgY2xhdXNlIGZvciBhIGdpdmVuIFNRTCB0eXBl\nLiAKICAgICAqIAogICAgICogQHNlZSBhcHBlbmRTaXplCiAgICAgKiAKICAg\nICAqIEBwYXJhbSB0eXBlTmFtZSAgVGhlIFNRTCB0eXBlIGllIElOVAogICAg\nICogQHBhcmFtIHNpemUgICAgICBUaGUgc2l6ZSBjbGF1c2UgaWUgKDEwKQog\nICAgICogQHJldHVybiAgICAgICAgICBUaGUgdHlwZU5hbWUgKyBzaXplIGNs\nYXVzZS4gVXN1YWxseSB0aGUgc2l6ZSBjbGF1c2Ugd2lsbCAKICAgICAqICAg\nICAgICAgICAgICAgICAgYmUgYXBwZW5kZWQgdG8gdHlwZU5hbWUuIElmIHRo\nZSB0eXBlTmFtZSBjb250YWlucyBhIAogICAgICogICAgICAgICAgICAgICAg\nICBtYXJrZXIgOiB7MH0gb3IgaWYgdHlwZU5hbWUgY29udGFpbnMgYSBtb2Rp\nZmllciB0aGUgCiAgICAgKiAgICAgICAgICAgICAgICAgIHNpemUgY2xhdXNl\nIHdpbGwgYmUgaW5zZXJ0ZWQgYXBwcm9wcmlhdGVseS4gICAKICAgICAqLwog\nICAgcHJvdGVjdGVkIFN0cmluZyBpbnNlcnRTaXplKFN0cmluZyB0eXBlTmFt\nZSwgU3RyaW5nIHNpemUpIHsKICAgIAlpZiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShzaXplKSkgewogICAgICAgICAgICBpbnQgaWR4ID0gdHlwZU5hbWUuaW5k\nZXhPZigiezB9Iik7CiAgICAgICAgICAgIGlmIChpZHggIT0gLTEpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHlwZU5hbWU7\nCiAgICAgICAgfQogICAgCQogICAgICAgIGludCBpZHggPSB0eXBlTmFtZS5p\nbmRleE9mKCJ7MH0iKTsKICAgICAgICBpZiAoaWR4ICE9IC0xKSB7CiAgICAg\nICAgICAgIC8vIHJlcGxhY2UgJ3swfScgd2l0aCBzaXplCiAgICAgICAgICAg\nIFN0cmluZyByZXQgPSB0eXBlTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAg\nICAgICAgICAgaWYgKHNpemUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndCA9IHJldCArIHNpemU7CiAgICAgICAgICAgIGlmICh0eXBlTmFtZS5sZW5n\ndGgoKSA+IGlkeCArIDMpCiAgICAgICAgICAgICAgICByZXQgPSByZXQgKyB0\neXBlTmFtZS5zdWJzdHJpbmcoaWR4ICsgMyk7CiAgICAgICAgICAgIHJldHVy\nbiByZXQ7CiAgICAgICAgfQogICAgICAgIGlmICghdHlwZU1vZGlmaWVyU2V0\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBTdHJpbmcgczsKICAgICAgICAg\nICAgaWR4ID0gdHlwZU5hbWUubGVuZ3RoKCk7CiAgICAgICAgICAgIGludCBj\ndXJJZHggPSAtMTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpID0gdHlw\nZU1vZGlmaWVyU2V0Lml0ZXJhdG9yKCk7IGkuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICAgICAgcyA9IChTdHJpbmcpIGkubmV4dCgpOwogICAgICAgICAg\nICAgICAgaWYgKHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihzKSAh\nPSAtMSkgewogICAgICAgICAgICAgICAgICAgIGN1cklkeCA9IHR5cGVOYW1l\nLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihzKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoY3VySWR4ICE9IC0xICYmIGN1cklkeCA8IGlkeCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZHggPSBjdXJJZHg7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmKGlkeCAhPSB0eXBlTmFtZS5sZW5ndGgoKSkgewogICAgICAg\nICAgICAgICAgU3RyaW5nIHJldCA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCBp\nZHgpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0ICsgc2l6ZTsKICAgICAg\nICAgICAgICAgIHJldCA9IHJldCArICcgJyArIHR5cGVOYW1lLnN1YnN0cmlu\nZyhpZHgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHlwZU5hbWUgKyBzaXpl\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RzCiAgICAv\nLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogU2V0IHRoZSBuYW1lIG9mIHRo\nZSBqb2luIHN5bnRheCB0byB1c2U6IHNxbDkyLCB0cmFkaXRpb25hbCwgZGF0\nYWJhc2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Sm9pblN5bnRheChT\ndHJpbmcgc3ludGF4KSB7CiAgICAgICAgaWYgKCJzcWw5MiIuZXF1YWxzKHN5\nbnRheCkpCiAgICAgICAgICAgIGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7\nCiAgICAgICAgZWxzZSBpZiAoInRyYWRpdGlvbmFsIi5lcXVhbHMoc3ludGF4\nKSkKICAgICAgICAgICAgam9pblN5bnRheCA9IFNZTlRBWF9UUkFESVRJT05B\nTDsKICAgICAgICBlbHNlIGlmICgiZGF0YWJhc2UiLmVxdWFscyhzeW50YXgp\nKQogICAgICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwog\nICAgICAgIGVsc2UgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHN5bnRheCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24oc3ludGF4KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIFNR\nTCBzdHJpbmcgdG8gYWN0IGFzIGEgcGxhY2Vob2xkZXIgZm9yIHRoZSBnaXZl\nbiBjb2x1bW4uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0UGxhY2Vo\nb2xkZXJWYWx1ZVN0cmluZyhDb2x1bW4gY29sKSB7CiAgICAgICAgc3dpdGNo\nIChjb2wuZ2V0VHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQklH\nSU5UOgogICAgICAgICAgICBjYXNlIFR5cGVzLkJJVDoKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5JTlRFR0VSOgogICAgICAgICAgICBjYXNlIFR5cGVzLk5V\nTUVSSUM6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuU01BTExJTlQ6CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuVElOWUlOVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiAiMCI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiAoc3RvcmVDaGFyc0FzTnVtYmVycykgPyAiMCIg\nOiAiJyAnIjsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAg\nICAgICBjYXNlIFR5cGVzLkxPTkdWQVJDSEFSOgogICAgICAgICAgICBjYXNl\nIFR5cGVzLlZBUkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gIicnIjsK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAg\ncmV0dXJuIFpFUk9fREFURV9TVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nREVDSU1BTDoKICAgICAgICAgICAgY2FzZSBUeXBlcy5ET1VCTEU6CiAgICAg\nICAgICAgIGNhc2UgVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuUkVBTDoKICAgICAgICAgICAgICAgIHJldHVybiAiMC4wIjsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJu\nIFpFUk9fVElNRV9TVFI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElNRVNU\nQU1QOgogICAgICAgICAgICAgICAgcmV0dXJuIFpFUk9fVElNRVNUQU1QX1NU\nUjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVy\nbiAiTlVMTCI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGEgU0VMRUNUIENPVU5UIHN0YXRlbWVudCBpbiB0aGUgcHJvcGVyIGpv\naW4gc3ludGF4IGZvciB0aGUKICAgICAqIGdpdmVuIGluc3RhbmNlLgogICAg\nICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0Q291bnQoU2VsZWN0\nIHNlbCkgewogICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FM\nQnVmZmVyKHRoaXMpOwogICAgICAgIFNRTEJ1ZmZlciBmcm9tOwogICAgICAg\nIHNlbC5hZGRKb2luQ2xhc3NDb25kaXRpb25zKCk7CiAgICAgICAgaWYgKHNl\nbC5nZXRGcm9tU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9\nIGdldEZyb21TZWxlY3Qoc2VsLCBmYWxzZSk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBmcm9tID0gZ2V0RnJvbShzZWwsIGZhbHNlKTsKICAgICAgICBT\nUUxCdWZmZXIgd2hlcmUgPSBnZXRXaGVyZShzZWwsIGZhbHNlKTsKCiAgICAg\nICAgLy8gaWYgbm8gZ3JvdXBpbmcgYW5kIG5vIHJhbmdlLCB3ZSBtaWdodCBi\nZSBhYmxlIHRvIGdldCBieSB3aXRob3V0CiAgICAgICAgLy8gYSBzdWJzZWxl\nY3QKICAgICAgICBpZiAoc2VsLmdldEdyb3VwaW5nKCkgPT0gbnVsbCAmJiBz\nZWwuZ2V0U3RhcnRJbmRleCgpID09IDAKICAgICAgICAgICAgJiYgc2VsLmdl\ndEVuZEluZGV4KCkgPT0gTG9uZy5NQVhfVkFMVUUpIHsKICAgICAgICAgICAg\nLy8gaWYgdGhlIHNlbGVjdCBoYXMgbm8gaWRlbnRpZmllciBjb2xzLCB1c2Ug\nQ09VTlQoKikKICAgICAgICAgICAgTGlzdCBhbGlhc2VzID0gKCFzZWwuaXNE\naXN0aW5jdCgpKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QKICAgICAgICAg\nICAgICAgIDogc2VsLmdldElkZW50aWZpZXJBbGlhc2VzKCk7CiAgICAgICAg\nICAgIGlmIChhbGlhc2VzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAg\nc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoKikiKTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdoZXJl\nLCBudWxsLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZhbHNl\nLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIHNpbmdsZSBkaXN0aW5jdCBj\nb2wsIHVzZSBDT1VOVChESVNUSU5DVCBjb2wpCiAgICAgICAgICAgIGlmIChh\nbGlhc2VzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RT\nUUwuYXBwZW5kKCJDT1VOVChESVNUSU5DVCAiKS4KICAgICAgICAgICAgICAg\nICAgICBhcHBlbmQoYWxpYXNlcy5nZXQoMCkudG9TdHJpbmcoKSkuYXBwZW5k\nKCIpIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0\nU1FMLCBudWxsLCBmcm9tLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAg\nICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZB\nTFVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2FuIHdlIGNv\nbWJpbmUgZGlzdGluY3QgY29scz8KICAgICAgICAgICAgaWYgKGRpc3RpbmN0\nQ291bnRDb2x1bW5TZXBhcmF0b3IgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoRElTVElOQ1QgIik7CiAgICAg\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiICIpOwog\nICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGRpc3Rp\nbmN0Q291bnRDb2x1bW5TZXBhcmF0b3IpOwogICAgICAgICAgICAgICAgICAg\nICAgICBzZWxlY3RTUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoYWxp\nYXNlcy5nZXQoaSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIpIik7CiAgICAgICAg\nICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBmcm9t\nLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAg\nICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2luY2Ugd2UgY2FuJ3QgY29t\nYmluZSBkaXN0aW5jdCBjb2xzLCB3ZSBoYXZlIHRvIHBlcmZvcm0gYW4gb3V0\nZXIKICAgICAgICAvLyBDT1VOVCgqKSBzZWxlY3QgdXNpbmcgdGhlIG9yaWdp\nbmFsIHNlbGVjdCBhcyBhIHN1YnNlbGVjdCBpbiB0aGUKICAgICAgICAvLyBG\nUk9NIGNsYXVzZQogICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNTdWJz\nZWxlY3QsICJTdXBwb3J0c1N1YnNlbGVjdCIpOwoKICAgICAgICBTUUxCdWZm\nZXIgc3ViU2VsZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIHRydWUsIGZhbHNlKTsK\nICAgICAgICBTUUxCdWZmZXIgc3ViRnJvbSA9IGZyb207CiAgICAgICAgZnJv\nbSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgZnJvbS5hcHBlbmQo\nIigiKTsKICAgICAgICBmcm9tLmFwcGVuZCh0b1NlbGVjdChzdWJTZWxlY3Qs\nIG51bGwsIHN1YkZyb20sIHdoZXJlLAogICAgICAgICAgICBzZWwuZ2V0R3Jv\ndXBpbmcoKSwgc2VsLmdldEhhdmluZygpLCBudWxsLCBzZWwuaXNEaXN0aW5j\ndCgpLAogICAgICAgICAgICBmYWxzZSwgc2VsLmdldFN0YXJ0SW5kZXgoKSwg\nc2VsLmdldEVuZEluZGV4KCksIHRydWUpKTsKICAgICAgICBmcm9tLmFwcGVu\nZCgiKSIpOwogICAgICAgIGlmIChyZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0\nKQogICAgICAgICAgICBmcm9tLmFwcGVuZCgiICIpLmFwcGVuZChTZWxlY3Qu\nRlJPTV9TRUxFQ1RfQUxJQVMpOwoKICAgICAgICBzZWxlY3RTUUwuYXBwZW5k\nKCJDT1VOVCgqKSIpOwogICAgICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3RT\nUUwsIG51bGwsIGZyb20sIG51bGwsIG51bGwsIG51bGwsIG51bGwsCiAgICAg\nICAgICAgIGZhbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgREVMRVRFIHN0YXRlbWVudCBm\nb3IgdGhlIHNwZWNpZmllZCBTZWxlY3QuIElmIHRoZQogICAgICogZGF0YWJh\nc2UgZG9lcyBub3Qgc3VwcG9ydCB0aGUgYnVsayBkZWxldGUgc3RhdGVtZW50\nIChzdWNoIGFzCiAgICAgKiBjYXNlcyB3aGVyZSBhIHN1YnNlbGVjdCBpcyBy\nZXF1aXJlZCBhbmQgdGhlIGRhdGFiYXNlIGRvZXNuJ3Qgc3VwcG9ydAogICAg\nICogc3Vic2VsZWN0cyksIHRoaXMgbWV0aG9kIHNob3VsZCByZXR1cm4gbnVs\nbC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b0RlbGV0ZShDbGFz\nc01hcHBpbmcgbWFwcGluZywgU2VsZWN0IHNlbCwgCiAgICAgICAgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIHRvQnVsa09wZXJhdGlvbiht\nYXBwaW5nLCBzZWwsIG51bGwsIHBhcmFtcywgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIFNRTEJ1ZmZlciB0b1VwZGF0ZShDbGFzc01hcHBpbmcgbWFwcGlu\nZywgU2VsZWN0IHNlbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIE9iamVj\ndFtdIHBhcmFtcywgTWFwIHVwZGF0ZXMpIHsKICAgICAgICByZXR1cm4gdG9C\ndWxrT3BlcmF0aW9uKG1hcHBpbmcsIHNlbCwgc3RvcmUsIHBhcmFtcywgdXBk\nYXRlcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBTUUwg\nZm9yIGEgYnVsayBvcGVyYXRpb24sIGVpdGhlciBhIERFTEVURSBvciBhbiBV\nUERBVEUuCiAgICAgKgogICAgICogQHBhcmFtIG1hcHBpbmcgdGhlIG1hcHBu\nZyBhZ2FpbnN0IHdoaWNoIHdlIGFyZSBvcGVyYXRpbmcKICAgICAqIEBwYXJh\nbSBzZWwgdGhlIFNlbGVjdCB0aGF0IHdpbGwgY29uc3RpdHV0ZSB0aGUgV0hF\nUkUgY2xhdXNlCiAgICAgKiBAcGFyYW0gc3RvcmUgdGhlIGN1cnJlbnQgc3Rv\ncmUKICAgICAqIEBwYXJhbSB1cGRhdGVQYXJhbXMgdGhlIE1hcCB0aGF0IGhv\nbGRzIHRoZSB1cGRhdGUgcGFyYW1ldGVyczsgYSBudWxsCiAgICAgKiB2YWx1\nZSBpbmRpY2F0ZXMgdGhhdCB0aGlzIGlzIGEgZGVsZXRlIG9wZXJhdGlvbgog\nICAgICogQHJldHVybiB0aGUgU1FMQnVmZmVyIGZvciB0aGUgdXBkYXRlLCBv\nciA8ZW0+bnVsbDwvZW0+IGlmIGl0IGlzIG5vdAogICAgICogcG9zc2libGUg\ndG8gcGVyZm9ybSB0aGUgYnVsayB1cGRhdGUKICAgICAqLwogICAgcHJvdGVj\ndGVkIFNRTEJ1ZmZlciB0b0J1bGtPcGVyYXRpb24oQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIFNlbGVjdCBzZWwsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBP\nYmplY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVQYXJhbXMpIHsKICAgICAgICBT\nUUxCdWZmZXIgc3FsID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBp\nZiAodXBkYXRlUGFyYW1zID09IG51bGwpIHsKICAgICAgICAgIGlmIChyZXF1\naXJlc1RhcmdldEZvckRlbGV0ZSkgewogICAgICAgICAgICBzcWwuYXBwZW5k\nKCJERUxFVEUgIik7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBkZWxldGVUYXJn\nZXRzID0gZ2V0RGVsZXRlVGFyZ2V0cyhzZWwpOwogICAgICAgICAgICBzcWwu\nYXBwZW5kKGRlbGV0ZVRhcmdldHMpOwogICAgICAgICAgICBzcWwuYXBwZW5k\nKCIgRlJPTSAiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNx\nbC5hcHBlbmQoIkRFTEVURSBGUk9NICIpOwogICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIlVQREFU\nRSAiKTsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpOwoK\nICAgICAgICAvLyBpZiB0aGVyZSBpcyBvbmx5IGEgc2luZ2xlIHRhYmxlIGlu\nIHRoZSBzZWxlY3QsIHRoZW4gd2UgY2FuCiAgICAgICAgLy8ganVzdCBpc3N1\nZSBhIHNpbmdsZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSA8Y29uZGl0aW9u\ncz4KICAgICAgICAvLyBzdGF0ZW1lbnQ7IG90aGVyd2lzZSwgc2luY2UgU1FM\nIGRvZXNuJ3QgYWxsb3cgZGVsZXRpbmcKICAgICAgICAvLyBmcm9tIG9uZSBv\nZiBhIG11bHRpLXRhYmxlIHNlbGVjdCwgd2UgbmVlZCB0byBpc3N1ZSBhIHN1\nYnNlbGVjdAogICAgICAgIC8vIGxpa2UgREVMRVRFIEZST00gVEFCTEUgV0hF\nUkUgRVhJU1RTCiAgICAgICAgLy8gKFNFTEVDVCAxIEZST00gVEFCTEUgdDAg\nV0hFUkUgdDAuSUQgPSBUQUJMRS5JRCk7IGFsc28sIHNvbWUKICAgICAgICAv\nLyBkYXRhYmFzZXMgZG8gbm90IGFsbG93IGFsaWFzZXMgaW4gZGVsZXRlIHN0\nYXRlbWVudHMsIHdoaWNoCiAgICAgICAgLy8gYWxzbyBjYXVzZXMgdXMgdG8g\ndXNlIGEgc3Vic2VsZWN0CiAgICAgICAgaWYgKHNlbC5nZXRUYWJsZUFsaWFz\nZXMoKS5zaXplKCkgPT0gMSAmJiBzdXBwb3J0c1N1YnNlbGVjdAogICAgICAg\nICAgICAmJiBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSkgewogICAgICAgICAg\nICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICAgICAgaWYgKHNlbC5nZXRGcm9t\nU2VsZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGZyb20gPSBnZXRG\ncm9tU2VsZWN0KHNlbCwgZmFsc2UpOwogICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICBmcm9tID0gZ2V0RnJvbShzZWwsIGZhbHNlKTsKCiAgICAg\nICAgICAgIHNxbC5hcHBlbmQoZnJvbSk7CiAgICAgICAgICAgIGFwcGVuZFVw\nZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywK\nICAgICAgICAgICAgICAgIGFsbG93c0FsaWFzSW5CdWxrQ2xhdXNlKTsKCiAg\nICAgICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IHNlbC5nZXRXaGVyZSgpOwog\nICAgICAgICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIik7\nCiAgICAgICAgICAgICAgICBzcWwuYXBwZW5kKHdoZXJlKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gc3FsOwogICAgICAgIH0KCiAgICAg\nICAgVGFibGUgdGFibGUgPSBtYXBwaW5nLmdldFRhYmxlKCk7CiAgICAgICAg\nU3RyaW5nIHRhYmxlTmFtZSA9IGdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSk7\nCgogICAgICAgIC8vIG9ubHkgdXNlIGEgIHN1YnNlbGVjdCBpZiB0aGUgd2hl\ncmUgaXMgbm90IGVtcHR5OyBvdGhlcndpc2UKICAgICAgICAvLyBhbiB1bnF1\nYWxpZmllZCBkZWxldGUgb3IgdXBkYXRlIHdpbGwgd29yawogICAgICAgIGlm\nIChzZWwuZ2V0V2hlcmUoKSA9PSBudWxsIHx8IHNlbC5nZXRXaGVyZSgpLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7\nCiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBw\nYXJhbXMsIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwogICAgICAgICAgICByZXR1\ncm4gc3FsOwogICAgICAgIH0KCiAgICAgICAgLy8gd2UgbmVlZCB0byB1c2Ug\nYSBzdWJzZWxlY3QgaWYgd2UgYXJlIHRvIGJ1bGsgZGVsZXRlIHdoZXJlCiAg\nICAgICAgLy8gdGhlIHNlbGVjdCBpbmNsdWRlcyBtdWx0aXBsZSB0YWJsZXM7\nIGlmIHRoZSBkYXRhYmFzZQogICAgICAgIC8vIGRvZXNuJ3Qgc3VwcG9ydCBp\ndCwgdGhlbiB3ZSBuZWVkIHRvIHNpZ2FsIHRoaXMgYnkgcmV0dXJuaW5nIG51\nbGwKICAgICAgICBpZiAoIXN1cHBvcnRzU3Vic2VsZWN0IHx8ICFzdXBwb3J0\nc0NvcnJlbGF0ZWRTdWJzZWxlY3QpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwoKICAgICAgICBDb2x1bW5bXSBwa3MgPSBtYXBwaW5nLmdldFByaW1hcnlL\nZXlDb2x1bW5zKCk7CiAgICAgICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAg\nICAgIHNlbC5zZXREaXN0aW5jdCh0cnVlKTsKCiAgICAgICAgLy8gaWYgd2Ug\naGF2ZSBvbmx5IGEgc2luZ2xlIFBLLCB3ZSBjYW4gdXNlIGEgbm9uLWNvcnJl\nbGF0ZWQKICAgICAgICAvLyBzdWJxdWVyeSAodXNpbmcgYW4gSU4gc3RhdGVt\nZW50KSwgd2hpY2ggaXMgbXVjaCBmYXN0ZXIgdGhhbgogICAgICAgIC8vIGEg\nY29ycmVsYXRlZCBzdWJxdWVyeSAoc2luY2UgYSBjb3JyZWxhdGVkIHN1YnF1\nZXJ5IG5lZWRzCiAgICAgICAgLy8gdG8gYmUgZXhlY3V0ZWQgb25jZSBmb3Ig\nZWFjaCByb3cgaW4gdGhlIHRhYmxlKQogICAgICAgIGlmIChwa3MubGVuZ3Ro\nID09IDEpIHsKICAgICAgICAgICAgc2VsLnNlbGVjdChwa3NbMF0pOwogICAg\nICAgICAgICBzcWwuYXBwZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFw\ncGVuZFVwZGF0ZXMoc2VsLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBh\ncmFtcywgZmFsc2UpOwogICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUg\nIikuCiAgICAgICAgICAgICAgICBhcHBlbmQocGtzWzBdKS5hcHBlbmQoIiBJ\nTiAoIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZh\nbHNlLCBudWxsKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAgICAgICBzZWwu\nc2V0RGlzdGluY3QoZmFsc2UpOwoKICAgICAgICAgICAgLy8gc2luY2UgdGhl\nIHNlbGVjdCBpcyB1c2luZyBhIGNvcnJlbGF0ZWQgc3VicXVlcnksIHdlCiAg\nICAgICAgICAgIC8vIG9ubHkgbmVlZCB0byBzZWxlY3QgYSBib2d1cyB2aXJ0\ndWFsIGNvbHVtbgogICAgICAgICAgICBzZWwuc2VsZWN0KCIxIiwgbnVsbCk7\nCgogICAgICAgICAgICAvLyBhZGQgaW4gdGhlIGpvaW5zIHRvIHRoZSB0YWJs\nZQogICAgICAgICAgICBDb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0UHJpbWFy\neUtleSgpLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgU1FMQnVmZmVyIGJ1\nZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIigiKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDApCiAg\nICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKCiAgICAg\nICAgICAgICAgICAvLyBhZGQgaW4gInQwLlBLID0gTVlUQUJMRS5QSyIKICAg\nICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNv\nbHNbaV0sIG51bGwpKS5hcHBlbmQoIiA9ICIpLgogICAgICAgICAgICAgICAg\nICAgIGFwcGVuZCh0YWJsZSkuYXBwZW5kKGNhdGFsb2dTZXBhcmF0b3IpLmFw\ncGVuZChjb2xzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIpIik7CiAgICAgICAgICAgIHNlbC53aGVyZShidWYsIG51bGwp\nOwoKICAgICAgICAgICAgc3FsLmFwcGVuZCh0YWJsZU5hbWUpOwogICAgICAg\nICAgICBhcHBlbmRVcGRhdGVzKHNlbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1\ncGRhdGVQYXJhbXMsIGZhbHNlKTsKICAgICAgICAgICAgc3FsLmFwcGVuZCgi\nIFdIRVJFIEVYSVNUUyAoIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoc2Vs\nLnRvU2VsZWN0KGZhbHNlLCBudWxsKSkuYXBwZW5kKCIpIik7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzcWw7CiAgICB9CgogICAgcHJvdGVjdGVkIFNR\nTEJ1ZmZlciBnZXREZWxldGVUYXJnZXRzKFNlbGVjdCBzZWwpIHsKICAgICAg\nU1FMQnVmZmVyIGRlbGV0ZVRhcmdldHMgPSBuZXcgU1FMQnVmZmVyKHRoaXMp\nOwogICAgICBDb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0VGFibGVBbGlh\nc2VzKCk7CiAgICAgIC8vIEFzc3VtZXMgYWxpYXNlcyBhcmUgb2YgdGhlIGZv\ncm0gIlRBQkxFTkFNRSB0MCIKICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBh\nbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nU3RyaW5nIHRhYmxlQWxpYXMgPSBpdHIubmV4dCgpLnRvU3RyaW5nKCk7CiAg\nICAgICAgaW50IHNwYWNlSW5kZXggPSB0YWJsZUFsaWFzLmluZGV4T2YoJyAn\nKTsKICAgICAgICBpZiAoc3BhY2VJbmRleCA+IDAgJiYgc3BhY2VJbmRleCA8\nIHRhYmxlQWxpYXMubGVuZ3RoKCkgLSAxKSB7CiAgICAgICAgICBpZiAoYWxs\nb3dzQWxpYXNJbkJ1bGtDbGF1c2UpIHsKICAgICAgICAgICAgZGVsZXRlVGFy\nZ2V0cy5hcHBlbmQodGFibGVBbGlhcy5zdWJzdHJpbmcoc3BhY2VJbmRleCAr\nIDEpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlbGV0ZVRh\ncmdldHMuYXBwZW5kKHRhYmxlQWxpYXMuc3Vic3RyaW5nKDAsIHNwYWNlSW5k\nZXgpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nZGVsZXRlVGFyZ2V0cy5hcHBlbmQodGFibGVBbGlhcyk7CiAgICAgICAgfQog\nICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgZGVsZXRlVGFy\nZ2V0cy5hcHBlbmQoIiwgIik7CiAgICAgIH0gICAgICAKICAgICAgcmV0dXJu\nIGRlbGV0ZVRhcmdldHM7ICAgICAgCiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgYXBwZW5kVXBkYXRlcyhTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUs\nIFNRTEJ1ZmZlciBzcWwsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBNYXAg\ndXBkYXRlUGFyYW1zLCBib29sZWFuIGFsbG93QWxpYXMpIHsKICAgICAgICBp\nZiAodXBkYXRlUGFyYW1zID09IG51bGwgfHwgdXBkYXRlUGFyYW1zLnNpemUo\nKSA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1hbnVh\nbGx5IGJ1aWxkIHVwIHRoZSBTRVQgY2xhdXNlIGZvciB0aGUgVVBEQVRFIHN0\nYXRlbWVudAogICAgICAgIHNxbC5hcHBlbmQoIiBTRVQgIik7CiAgICAgICAg\nRXhwQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChzdG9yZSwgcGFyYW1z\nLCAKICAgICAgICAgICAgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkp\nOwoKICAgICAgICAvLyBJZiB0aGUgdXBkYXRlcyBtYXAgY29udGFpbnMgYW55\nIHZlcnNpb24gZmllbGRzLCBhc3N1bWUgdGhhdCB0aGUKICAgICAgICAvLyBv\ncHRpbWlzdGljIGxvY2sgdmVyc2lvbiBkYXRhIGlzIGJlaW5nIGhhbmRsZWQg\ncHJvcGVybHkgYnkgdGhlCiAgICAgICAgLy8gY2FsbGVyLiBPdGhlcndpc2Us\nIGdpdmUgdGhlIHZlcnNpb24gaW5kaWNhdG9yIGFuIG9wcG9ydHVuaXR5IHRv\nCiAgICAgICAgLy8gYWRkIG1vcmUgdXBkYXRlIGNsYXVzZXMgYXMgbmVlZGVk\nLgogICAgICAgIGJvb2xlYW4gYXVnbWVudFVwZGF0ZXMgPSB0cnVlOwoKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB1cGRhdGVQYXJhbXMuZW50cnlTZXQo\nKS5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAgTWFw\nLkVudHJ5IG5leHQgPSAoTWFwLkVudHJ5KSBpLm5leHQoKTsKICAgICAgICAg\nICAgUGF0aCBwYXRoID0gKFBhdGgpIG5leHQuZ2V0S2V5KCk7CiAgICAgICAg\nICAgIEZpZWxkTWFwcGluZyBmbWQgPSAoRmllbGRNYXBwaW5nKSBwYXRoLmxh\nc3QoKTsKCiAgICAgICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAgICAg\nICAgICAgICAgICBhdWdtZW50VXBkYXRlcyA9IGZhbHNlOwoKICAgICAgICAg\nICAgVmFsIHZhbCA9IChWYWwpIG5leHQuZ2V0VmFsdWUoKTsKICAgICAgICAg\nICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAJdmFsID0gbmV3IE51\nbGwoKTsKICAgICAgICAgICAgQ29sdW1uIGNvbCA9IGZtZC5nZXRDb2x1bW5z\nKClbMF07CiAgICAgICAgICAgIGlmIChhbGxvd0FsaWFzKSB7CiAgICAgICAg\nICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29sKSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3FsLmFwcGVuZChj\nb2wuZ2V0TmFtZSgpKTsgIAogICAgICAgICAgICB9ICAgICAgICAgICAgCiAg\nICAgICAgICAgIHNxbC5hcHBlbmQoIiA9ICIpOwoKICAgICAgICAgICAgRXhw\nU3RhdGUgc3RhdGUgPSB2YWwuaW5pdGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAg\nICAgICAgICAgIC8vIEpEQkMgUGF0aHMgYXJlIGFsd2F5cyBQQ1BhdGhzOyBQ\nQ1BhdGggaW1wbGVtZW50cyBWYWwKICAgICAgICAgICAgRXhwU3RhdGUgcGF0\naFN0YXRlID0gKChWYWwpIHBhdGgpLmluaXRpYWxpemUoc2VsLCBjdHgsIDAp\nOwogICAgICAgICAgICBjYWxjdWxhdGVWYWx1ZSh2YWwsIHNlbCwgY3R4LCBz\ndGF0ZSwgcGF0aCwgcGF0aFN0YXRlKTsKCiAgICAgICAgICAgIC8vIGFwcGVu\nZCB0aGUgdmFsdWUgd2l0aCBhIG51bGwgZm9yIHRoZSBTZWxlY3Q7IGkKICAg\nICAgICAgICAgLy8gaW5kaWNhdGVzIHRoYXQgdGhlCiAgICAgICAgICAgIGlu\ndCBsZW5ndGggPSB2YWwubGVuZ3RoKHNlbCwgY3R4LCBzdGF0ZSk7CiAgICAg\nICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgbGVuZ3RoOyBqKyspCiAgICAg\nICAgICAgICAgICB2YWwuYXBwZW5kVG8oKGFsbG93QWxpYXMpID8gc2VsIDog\nbnVsbCwgY3R4LCBzdGF0ZSwgc3FsLCBqKTsKCiAgICAgICAgICAgIGlmIChp\nLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIik7\nCiAgICAgICAgfQoKICAgICAgICBpZiAoYXVnbWVudFVwZGF0ZXMpIHsKICAg\nICAgICAgICAgUGF0aCBwYXRoID0gKFBhdGgpIHVwZGF0ZVBhcmFtcy5rZXlT\nZXQoKS5pdGVyYXRvcigpLm5leHQoKTsKICAgICAgICAgICAgRmllbGRNYXBw\naW5nIGZtID0gKEZpZWxkTWFwcGluZykgcGF0aC5sYXN0KCk7CiAgICAgICAg\nICAgIENsYXNzTWFwcGluZyBtZXRhID0gZm0uZ2V0RGVjbGFyaW5nTWFwcGlu\nZygpOwogICAgICAgICAgICBNYXAgdXBkYXRlcyA9IG1ldGEuZ2V0VmVyc2lv\nbigpLmdldEJ1bGtVcGRhdGVWYWx1ZXMoKTsKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdGVyID0gdXBkYXRlcy5lbnRyeVNldCgpLml0ZXJhdG9yKCk7\nCiAgICAgICAgICAgICAgICBpdGVyLmhhc05leHQoKTsgKSB7CiAgICAgICAg\nICAgICAgICBNYXAuRW50cnkgZSA9IChNYXAuRW50cnkpIGl0ZXIubmV4dCgp\nOwogICAgICAgICAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1bW4pIGUuZ2V0\nS2V5KCk7CiAgICAgICAgICAgICAgICBTdHJpbmcgdmFsID0gKFN0cmluZykg\nZS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgc3FsLmFwcGVuZCgiLCAi\nKS5hcHBlbmQoY29sLmdldE5hbWUoKSkKICAgICAgICAgICAgICAgICAgICAu\nYXBwZW5kKCIgPSAiKS5hcHBlbmQodmFsKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgU1FMIHRv\nIGRlbGV0ZSB0aGUgY29udGVudHMgb2YgdGhlIHNwZWNpZmllZCB0YWJsZXMu\nIAogICAgICogVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZHJvcHMgYWxs\nIG5vbi1kZWZlcnJlZCBSRVNUUklDVCBmb3JlaWduIGtleSAKICAgICAqIGNv\nbnN0cmFpbnRzIGludm9sdmluZyB0aGUgc3BlY2lmaWVkIHRhYmxlcywgaXNz\ndWVzIERFTEVURSBzdGF0ZW1lbnRzIAogICAgICogYWdhaW5zdCB0aGUgdGFi\nbGVzLCBhbmQgdGhlbiBhZGRzIHRoZSBkcm9wcGVkIGNvbnN0cmFpbnRzIGJh\nY2sgaW4uIAogICAgICogRGF0YWJhc2VzIHdpdGggbW9yZSBvcHRpbWFsIHdh\neXMgb2YgZGVsZXRpbmcgdGhlIGNvbnRlbnRzIG9mIHNldmVyYWwgCiAgICAg\nKiB0YWJsZXMgc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kLgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGVsZXRlVGFibGVDb250ZW50c1NR\nTChUYWJsZVtdIHRhYmxlcykgewogICAgICAgIENvbGxlY3Rpb24gc3FsID0g\nbmV3IEFycmF5TGlzdCgpOwogICAgICAgIAogICAgICAgIC8vIGNvbGxlY3Qg\nYW5kIGRyb3Agbm9uLWRlZmVycmVkIHBoeXNpY2FsIHJlc3RyaWN0IGNvbnN0\ncmFpbnRzLCBhbmQKICAgICAgICAvLyBjb2xsZWN0IHRoZSBERUxFVEUgRlJP\nTSBzdGF0ZW1lbnRzCiAgICAgICAgQ29sbGVjdGlvbiBkZWxldGVTUUwgPSBu\nZXcgQXJyYXlMaXN0KHRhYmxlcy5sZW5ndGgpOwogICAgICAgIENvbGxlY3Rp\nb24gcmVzdHJpY3RDb25zdHJhaW50cyA9IG5ldyBMaW5rZWRIYXNoU2V0KCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0YWJsZXMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlc1tp\nXS5nZXRGb3JlaWduS2V5cygpOwogICAgICAgICAgICBmb3IgKGludCBqID0g\nMDsgaiA8IGZrcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYg\nKCFma3Nbal0uaXNMb2dpY2FsKCkgJiYgIWZrc1tqXS5pc0RlZmVycmVkKCkg\nCiAgICAgICAgICAgICAgICAgICAgJiYgZmtzW2pdLmdldERlbGV0ZUFjdGlv\nbigpID09IEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUKQogICAgICAgICAg\nICAgICAgcmVzdHJpY3RDb25zdHJhaW50cy5hZGQoZmtzW2pdKTsKICAgICAg\nICAgICAgICAgIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSBnZXREcm9wRm9y\nZWlnbktleVNRTChma3Nbal0pOwogICAgICAgICAgICAgICAgc3FsLmFkZEFs\nbChBcnJheXMuYXNMaXN0KGNvbnN0cmFpbnRTUUwpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICAKICAgICAgICAgICAgZGVsZXRlU1FMLmFkZCgiREVM\nRVRFIEZST00gIiArIHRhYmxlc1tpXS5nZXRGdWxsTmFtZSgpKTsKICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxldGUgc3RhdGVt\nZW50cyBhZnRlciBhbGwgdGhlIGNvbnN0cmFpbnQgbXV0YXRpb25zCiAgICAg\nICAgc3FsLmFkZEFsbChkZWxldGVTUUwpOwogICAgICAgIAogICAgICAgIC8v\nIGFkZCB0aGUgZGVsZXRlZCBjb25zdHJhaW50cyBiYWNrIHRvIHRoZSBzY2hl\nbWEKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ZXIgPSByZXN0cmljdENvbnN0\ncmFpbnRzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4dCgpOyApIHsKICAgICAg\nICAgICAgU3RyaW5nW10gY29uc3RyYWludFNRTCA9IAogICAgICAgICAgICAg\nICAgZ2V0QWRkRm9yZWlnbktleVNRTCgoRm9yZWlnbktleSkgaXRlci5uZXh0\nKCkpOwogICAgICAgICAgICBzcWwuYWRkQWxsKEFycmF5cy5hc0xpc3QoY29u\nc3RyYWludFNRTCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1\ncm4gKFN0cmluZ1tdKSBzcWwudG9BcnJheShuZXcgU3RyaW5nW3NxbC5zaXpl\nKCldKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBz\ndGF0ZW1lbnQgaW4gdGhlIHByb3BlciBqb2luIHN5bnRheCBmb3IgdGhlIGdp\ndmVuCiAgICAgKiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b1NlbGVjdChTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSwK\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAg\nICAgc2VsLmFkZEpvaW5DbGFzc0NvbmRpdGlvbnMoKTsKICAgICAgICBib29s\nZWFuIHVwZGF0ZSA9IGZvclVwZGF0ZSAmJiBzZWwuZ2V0RnJvbVNlbGVjdCgp\nID09IG51bGw7CiAgICAgICAgU1FMQnVmZmVyIHNlbGVjdCA9IGdldFNlbGVj\ndHMoc2VsLCBmYWxzZSwgdXBkYXRlKTsKICAgICAgICBTUUxCdWZmZXIgb3Jk\nZXJpbmcgPSBudWxsOwogICAgICAgIGlmICghc2VsLmlzQWdncmVnYXRlKCkg\nfHwgc2VsLmdldEdyb3VwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgb3Jk\nZXJpbmcgPSBzZWwuZ2V0T3JkZXJpbmcoKTsKICAgICAgICBTUUxCdWZmZXIg\nZnJvbTsKICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxs\nKQogICAgICAgICAgICBmcm9tID0gZ2V0RnJvbVNlbGVjdChzZWwsIGZvclVw\nZGF0ZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmcm9tID0gZ2V0RnJv\nbShzZWwsIHVwZGF0ZSk7CiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0\nV2hlcmUoc2VsLCB1cGRhdGUpOwogICAgICAgIHJldHVybiB0b1NlbGVjdChz\nZWxlY3QsIGZldGNoLCBmcm9tLCB3aGVyZSwgc2VsLmdldEdyb3VwaW5nKCks\nCiAgICAgICAgICAgIHNlbC5nZXRIYXZpbmcoKSwgb3JkZXJpbmcsIHNlbC5p\nc0Rpc3RpbmN0KCksIGZvclVwZGF0ZSwKICAgICAgICAgICAgc2VsLmdldFN0\nYXJ0SW5kZXgoKSwgc2VsLmdldEVuZEluZGV4KCksIHNlbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVj\ndCBzdGF0ZW1lbnQgYmV0d2VlbiB0aGUgRlJPTSBrZXl3b3JkCiAgICAgKiBh\nbmQgdGhlIFdIRVJFIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\nUUxCdWZmZXIgZ2V0RnJvbShTZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0\nZSkgewogICAgICAgIFNRTEJ1ZmZlciBmcm9tU1FMID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgICBDb2xsZWN0aW9uIGFsaWFzZXMgPSBzZWwuZ2V0\nVGFibGVBbGlhc2VzKCk7CiAgICAgICAgaWYgKGFsaWFzZXMuc2l6ZSgpIDwg\nMiB8fCBzZWwuZ2V0Sm9pblN5bnRheCgpICE9IFNZTlRBWF9TUUw5Mikgewog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGFsaWFzZXMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIGZyb21T\nUUwuYXBwZW5kKGl0ci5uZXh0KCkudG9TdHJpbmcoKSk7CiAgICAgICAgICAg\nICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxlRm9yVXBkYXRlQ2xhdXNlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAi\nKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAgICAgICAgICAg\nICAgaWYgKGl0ci5oYXNOZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgZnJv\nbVNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBJdGVyYXRvciBpdHIgPSBzZWwuZ2V0Sm9pbkl0\nZXJhdG9yKCk7CiAgICAgICAgICAgIGJvb2xlYW4gZmlyc3QgPSB0cnVlOwog\nICAgICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewogICAgICAgICAg\nICAgICAgZnJvbVNRTC5hcHBlbmQodG9TUUw5MkpvaW4oKEpvaW4pIGl0ci5u\nZXh0KCksIGZvclVwZGF0ZSwKICAgICAgICAgICAgICAgICAgICBmaXJzdCkp\nOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgRlJPTSBjbGF1c2UgZm9yIGEgc2Vs\nZWN0IHRoYXQgc2VsZWN0cyBmcm9tIGEgdG1wIHRhYmxlCiAgICAgKiBjcmVh\ndGVkIGJ5IGFuIGlubmVyIHNlbGVjdC4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFNRTEJ1ZmZlciBnZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWwsIGJvb2xlYW4g\nZm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVmZmVyIGZyb21TUUwgPSBuZXcg\nU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGZyb21TUUwuYXBwZW5kKCIoIik7\nCiAgICAgICAgZnJvbVNRTC5hcHBlbmQodG9TZWxlY3Qoc2VsLmdldEZyb21T\nZWxlY3QoKSwgZm9yVXBkYXRlLCBudWxsKSk7CiAgICAgICAgZnJvbVNRTC5h\ncHBlbmQoIikiKTsKICAgICAgICBpZiAocmVxdWlyZXNBbGlhc0ZvclN1YnNl\nbGVjdCkKICAgICAgICAgICAgZnJvbVNRTC5hcHBlbmQoIiAiKS5hcHBlbmQo\nU2VsZWN0LkZST01fU0VMRUNUX0FMSUFTKTsKICAgICAgICByZXR1cm4gZnJv\nbVNRTDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgV0hFUkUg\ncG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0YXRlbWVudCwgb3IgbnVsbCBpZiBu\nbyB3aGVyZQogICAgICogY29uZGl0aW9ucy4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFNRTEJ1ZmZlciBnZXRXaGVyZShTZWxlY3Qgc2VsLCBib29sZWFuIGZv\nclVwZGF0ZSkgewogICAgICAgIEpvaW5zIGpvaW5zID0gc2VsLmdldEpvaW5z\nKCk7CiAgICAgICAgaWYgKHNlbC5nZXRKb2luU3ludGF4KCkgPT0gU1lOVEFY\nX1NRTDkyCiAgICAgICAgICAgIHx8IGpvaW5zID09IG51bGwgfHwgam9pbnMu\naXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gc2VsLmdldFdoZXJlKCk7\nCgogICAgICAgIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxCdWZmZXIodGhp\ncyk7CiAgICAgICAgaWYgKHNlbC5nZXRXaGVyZSgpICE9IG51bGwpCiAgICAg\nICAgICAgIHdoZXJlLmFwcGVuZChzZWwuZ2V0V2hlcmUoKSk7CiAgICAgICAg\naWYgKGpvaW5zICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5hcHBlbmQod2hl\ncmUsIGpvaW5zKTsKICAgICAgICByZXR1cm4gd2hlcmU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3Jl\nYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSB0cmFk\naXRpb25hbCBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0\nb1RyYWRpdGlvbmFsSm9pbihKb2luIGpvaW4pIHsKICAgICAgICBGb3JlaWdu\nS2V5IGZrID0gam9pbi5nZXRGb3JlaWduS2V5KCk7CiAgICAgICAgaWYgKGZr\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBi\nb29sZWFuIGludmVyc2UgPSBqb2luLmlzRm9yZWlnbktleUludmVyc2VkKCk7\nCiAgICAgICAgQ29sdW1uW10gZnJvbSA9IChpbnZlcnNlKSA/IGZrLmdldFBy\naW1hcnlLZXlDb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRDb2x1bW5z\nKCk7CiAgICAgICAgQ29sdW1uW10gdG8gPSAoaW52ZXJzZSkgPyBmay5nZXRD\nb2x1bW5zKCkKICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5Q29sdW1u\ncygpOwoKICAgICAgICAvLyBkbyBjb2x1bW4gam9pbnMKICAgICAgICBTUUxC\ndWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAgICBpbnQg\nY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZnJvbS5s\nZW5ndGg7IGkrKywgY291bnQrKykgewogICAgICAgICAgICBpZiAoY291bnQg\nPiAwKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMSgpKS5hcHBlbmQo\nIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiA9ICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMy\nKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0b1tpXSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBkbyBjb25zdGFudCBqb2lucwogICAgICAgIENvbHVtbltdIGNv\nbnN0Q29scyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY29uc3RDb2xzLmxlbmd0aDsgaSsrLCBjb3Vu\ndCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBpZiAoaW52\nZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmRWYWx1ZShmay5nZXRD\nb25zdGFudChjb25zdENvbHNbaV0pLCBjb25zdENvbHNbaV0pOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0\nQWxpYXMxKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgIGFw\ncGVuZChjb25zdENvbHNbaV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZChqb2luLmdldEFsaWFzMigpKS5hcHBlbmQoIi4iKS4K\nICAgICAgICAgICAgICAgICAgICBhcHBlbmQoY29uc3RDb2xzW2ldKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVl\nKGZrLmdldENvbnN0YW50KGNvbnN0Q29sc1tpXSksIGNvbnN0Q29sc1tpXSk7\nCiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBjb25zdENvbHNQSyA9IGZr\nLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGNvbnN0Q29sc1BLLmxlbmd0aDsgaSsrLCBjb3Vu\ndCsrKSB7CiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAgICBpZiAoaW52\nZXJzZSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRBbGlh\nczEoKSkuYXBwZW5kKCIuIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5k\nKGNvbnN0Q29sc1BLW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlLZXlDb25zdGFu\ndChjb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAgICAgY29uc3RD\nb2xzUEtbaV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAg\nICAgICAgICAgIGlmIChpbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZFZhbHVlKGZrLmdldFByaW1hcnlLZXlDb25zdGFudChjb25zdENvbHNQ\nS1tpXSksCiAgICAgICAgICAgICAgICAgICAgY29uc3RDb2xzUEtbaV0pOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGpv\naW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAgICAg\nICAgIGFwcGVuZChjb25zdENvbHNQS1tpXSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdp\ndmVuIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0\nYWJsZXMgaW4KICAgICAqIHRoZSBTUUw5MiBzdHlsZS4KICAgICAqLwogICAg\ncHVibGljIFNRTEJ1ZmZlciB0b1NRTDkySm9pbihKb2luIGpvaW4sIGJvb2xl\nYW4gZm9yVXBkYXRlLCBib29sZWFuIGZpcnN0KSB7CiAgICAgICAgU1FMQnVm\nZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKGZp\ncnN0KSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTEo\nKSkuYXBwZW5kKCIgIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoam9pbi5n\nZXRBbGlhczEoKSk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFi\nbGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwog\nICAgICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgIGlm\nIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQob3V0ZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNl\nIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoaW5uZXJKb2luQ2xhdXNlKTsKICAgICAgICBl\nbHNlIC8vIGNyb3NzCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoY3Jvc3NKb2lu\nQ2xhdXNlKTsKICAgICAgICBidWYuYXBwZW5kKCIgIik7CgogICAgICAgIGJ1\nZi5hcHBlbmQoam9pbi5nZXRUYWJsZTIoKSkuYXBwZW5kKCIgIikuYXBwZW5k\nKGpvaW4uZ2V0QWxpYXMyKCkpOwogICAgICAgIGlmIChmb3JVcGRhdGUgJiYg\ndGFibGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7Cgog\nICAgICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKHRvVHJhZGl0aW9u\nYWxKb2luKGpvaW4pKTsKICAgICAgICBlbHNlIGlmIChyZXF1aXJlc0NvbmRp\ndGlvbkZvckNyb3NzSm9pbiAmJgogICAgICAgICAgICBqb2luLmdldFR5cGUo\nKSA9PSBKb2luLlRZUEVfQ1JPU1MpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBPTiAoMSA9IDEpIik7CgogICAgICAgIHJldHVybiBidWY7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8g\nY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBk\nYXRhYmFzZSdzIG5hdGl2ZSBzeW50YXguIFRocm93cyBhbiBleGNlcHRpb24g\nYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b05h\ndGl2ZUpvaW4oSm9pbiBqb2luKSB7CiAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIGlmIHRoZSBnaXZlbiBmb3JlaWduIGtleSBjYW4gYmUgZWFnZXJseSBs\nb2FkZWQgdXNpbmcgb3RoZXIgam9pbnMuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGNhbk91dGVySm9pbihpbnQgc3ludGF4LCBGb3JlaWduS2V5IGZr\nKSB7CiAgICAgICAgcmV0dXJuIHN5bnRheCAhPSBTWU5UQVhfVFJBRElUSU9O\nQUw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBj\nb21wb25lbnRzIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50LgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3Rz\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1\nZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwK\nICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAg\nICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxv\nbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0\naW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20s\nIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRlciwgZGlz\ndGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVwZGF0ZUNs\nYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxsKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjb21wb25lbnRzIGludG8gYSBT\nRUxFQ1Qgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVy\nIHRvU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RzLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZm\nZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwKICAgICAgICBTUUxCdWZmZXIg\naGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0\naW5jdCwgYm9vbGVhbiBmb3JVcGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5k\nLAogICAgICAgIGJvb2xlYW4gc3Vic2VsZWN0KSB7CiAgICAgICAgcmV0dXJu\nIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVj\ndHMsIGZyb20sIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBv\ncmRlciwgZGlzdGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZv\nclVwZGF0ZUNsYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBudWxsKSwgc3Vic2Vs\nZWN0KTsKICAgIH0KICAgIAogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVj\ndChTUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwKICAgICAgICAgICAgU1FMQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3\naGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgICAgICBTUUxCdWZmZXIg\naGF2aW5nLCBTUUxCdWZmZXIgb3JkZXIsCiAgICAgICAgICAgIGJvb2xlYW4g\nZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25n\nIGVuZCwKICAgICAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QsIGJvb2xlYW4g\nY2hlY2tUYWJsZUZvclVwZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gdG9P\ncGVyYXRpb24oZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywg\nZnJvbSwgd2hlcmUsCiAgICAgICAgICAgICAgICBncm91cCwgaGF2aW5nLCBv\ncmRlciwgZGlzdGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgICAgICBn\nZXRGb3JVcGRhdGVDbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCksIHN1\nYnNlbGVjdCwgY2hlY2tUYWJsZUZvclVwZGF0ZSk7CiAgICAgICAgfQoKICAg\nIC8qKgogICAgICogQ29tYmluZSB0aGUgZ2l2ZW4gY29tcG9uZW50cyBpbnRv\nIGEgU0VMRUNUIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0cywgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FM\nQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAgICAgU1FMQnVm\nZmVyIGhhdmluZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAgIGJvb2xlYW4g\nZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0YXJ0LCBsb25n\nIGVuZCwKICAgICAgICBTZWxlY3Qgc2VsKSB7CiAgICAgICAgcmV0dXJuIHRv\nT3BlcmF0aW9uKGdldFNlbGVjdE9wZXJhdGlvbihmZXRjaCksIHNlbGVjdHMs\nIGZyb20sIHdoZXJlLAogICAgICAgICAgICBncm91cCwgaGF2aW5nLCBvcmRl\nciwgZGlzdGluY3QsIHN0YXJ0LCBlbmQsCiAgICAgICAgICAgIGdldEZvclVw\nZGF0ZUNsYXVzZShmZXRjaCwgZm9yVXBkYXRlLCBzZWwpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEdldCB0aGUgdXBkYXRlIGNsYXVzZSBmb3IgdGhlIHF1\nZXJ5IGJhc2VkIG9uIHRoZQogICAgICogdXBkYXRlQ2xhdXNlIGFuZCBpc29s\nYXRpb25MZXZlbCBoaW50cwogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5n\nIGdldEZvclVwZGF0ZUNsYXVzZShKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoLAogICAgICAgIGJvb2xlYW4gaXNGb3JVcGRhdGUsIFNlbGVjdCBzZWwp\nIHsKICAgICAgICBpZiAoZmV0Y2ggIT0gbnVsbCAmJiBmZXRjaC5nZXRJc29s\nYXRpb24oKSAhPSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgImlz\nb2xhdGlvbi1sZXZlbC1jb25maWctbm90LXN1cHBvcnRlZCIsIGdldENsYXNz\nKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0ZvclVwZGF0\nZSAmJiAhc2ltdWxhdGVMb2NraW5nKSB7CiAgICAgICAgICAgIGFzc2VydFN1\ncHBvcnQoc3VwcG9ydHNTZWxlY3RGb3JVcGRhdGUsICJTdXBwb3J0c1NlbGVj\ndEZvclVwZGF0ZSIpOwogICAgICAgICAgICByZXR1cm4gZm9yVXBkYXRlQ2xh\ndXNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nIlNFTEVDVCIgb3BlcmF0aW9uIGNsYXVzZSwgYWRkaW5nIGFueSBhdmFpbGFi\nbGUgaGludHMsIGV0Yy4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRT\nZWxlY3RPcGVyYXRpb24oSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkg\newogICAgICAgIHJldHVybiAiU0VMRUNUIjsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9w\nZXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b09wZXJh\ndGlvbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAgICAgIFNR\nTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91\ncCwgU1FMQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIgb3JkZXIs\nIGJvb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAg\nICAgIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UpIHsKICAgICAgICByZXR1cm4g\ndG9PcGVyYXRpb24ob3AsIHNlbGVjdHMsIGZyb20sIHdoZXJlLCBncm91cCwg\naGF2aW5nLCBvcmRlciwKICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0LCBl\nbmQsIGZvclVwZGF0ZUNsYXVzZSwgZmFsc2UpOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0\naW5nIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0\nb09wZXJhdGlvbihTdHJpbmcgb3AsIFNRTEJ1ZmZlciBzZWxlY3RzLAogICAg\nICAgIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZl\nciBncm91cCwgU1FMQnVmZmVyIGhhdmluZywKICAgICAgICBTUUxCdWZmZXIg\nb3JkZXIsIGJvb2xlYW4gZGlzdGluY3QsIGxvbmcgc3RhcnQsIGxvbmcgZW5k\nLAogICAgICAgIFN0cmluZyBmb3JVcGRhdGVDbGF1c2UsIGJvb2xlYW4gc3Vi\nc2VsZWN0KSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxl\nY3RzLCBmcm9tLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAg\nICAgICAgICAgICBkaXN0aW5jdCwgc3RhcnQsIGVuZCwgZm9yVXBkYXRlQ2xh\ndXNlLCBzdWJzZWxlY3QsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgU1FMIGZvciB0aGUgZ2l2ZW4gc2VsZWN0aW5nIG9wZXJh\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9PcGVyYXRp\nb24oU3RyaW5nIG9wLCBTUUxCdWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxC\ndWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAs\nIFNRTEJ1ZmZlciBoYXZpbmcsCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBi\nb29sZWFuIGRpc3RpbmN0LCBsb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAg\nICBTdHJpbmcgZm9yVXBkYXRlQ2xhdXNlLCBib29sZWFuIHN1YnNlbGVjdCwg\nYm9vbGVhbiBjaGVja1RhYmxlRm9yVXBkYXRlKSB7CiAgICAgICAgU1FMQnVm\nZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgYnVmLmFw\ncGVuZChvcCk7CgogICAgICAgIGJvb2xlYW4gcmFuZ2UgPSBzdGFydCAhPSAw\nIHx8IGVuZCAhPSBMb25nLk1BWF9WQUxVRTsKICAgICAgICBpZiAocmFuZ2Ug\nJiYgcmFuZ2VQb3NpdGlvbiA9PSBSQU5HRV9QUkVfRElTVElOQ1QpCiAgICAg\nICAgICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vi\nc2VsZWN0KTsKICAgICAgICBpZiAoZGlzdGluY3QpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBESVNUSU5DVCIpOwogICAgICAgIGlmIChyYW5nZSAmJiBy\nYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfRElTVElOQ1QpCiAgICAgICAg\nICAgIGFwcGVuZFNlbGVjdFJhbmdlKGJ1Ziwgc3RhcnQsIGVuZCwgc3Vic2Vs\nZWN0KTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChzZWxlY3Rz\nKS5hcHBlbmQoIiBGUk9NICIpLmFwcGVuZChmcm9tKTsKCiAgICAgICAgaWYg\nKGNoZWNrVGFibGVGb3JVcGRhdGUKICAgICAgICAgICAgICAgICYmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KGZvclVwZGF0ZUNsYXVzZSkgJiYgIVN0cmluZ1V0\naWxzCiAgICAgICAgICAgICAgICAgICAgICAgIC5pc0VtcHR5KHRhYmxlRm9y\nVXBkYXRlQ2xhdXNlKSkpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAod2hlcmUgIT0gbnVsbCAmJiAhd2hlcmUuaXNFbXB0eSgpKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgV0hFUkUgIikuYXBwZW5kKHdoZXJl\nKTsKICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCAmJiAhZ3JvdXAuaXNFbXB0\neSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgR1JPVVAgQlkgIikuYXBw\nZW5kKGdyb3VwKTsKICAgICAgICBpZiAoaGF2aW5nICE9IG51bGwgJiYgIWhh\ndmluZy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChz\ndXBwb3J0c0hhdmluZywgIlN1cHBvcnRzSGF2aW5nIik7CiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBIQVZJTkcgIikuYXBwZW5kKGhhdmluZyk7CiAgICAg\nICAgfQogICAgICAgIGlmIChvcmRlciAhPSBudWxsICYmICFvcmRlci5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBPUkRFUiBCWSAiKS5h\ncHBlbmQob3JkZXIpOwogICAgICAgIGlmIChyYW5nZSAmJiByYW5nZVBvc2l0\naW9uID09IFJBTkdFX1BPU1RfU0VMRUNUKQogICAgICAgICAgICBhcHBlbmRT\nZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAg\nICAgaWYgKGZvclVwZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgIikuYXBwZW5kKGZvclVwZGF0ZUNsYXVzZSk7CiAgICAg\nICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRpb24gPT0gUkFOR0VfUE9TVF9M\nT0NLKQogICAgICAgICAgICBhcHBlbmRTZWxlY3RSYW5nZShidWYsIHN0YXJ0\nLCBlbmQsIHN1YnNlbGVjdCk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0K\nCiAgICAvKioKICAgICAqIElmIHRoaXMgZGljdGlvbmFyeSBjYW4gc2VsZWN0\nIHJhbmdlcywKICAgICAqIHVzZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgdGhl\nIHJhbmdlIFNRTC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYXBwZW5k\nU2VsZWN0UmFuZ2UoU1FMQnVmZmVyIGJ1ZiwgbG9uZyBzdGFydCwgbG9uZyBl\nbmQsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QpIHsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0\nYXRlbWVudCBiZXR3ZWVuIHRoZSBTRUxFQ1Qga2V5d29yZAogICAgICogYW5k\nIHRoZSBGUk9NIGtleXdvcmQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgZ2V0U2VsZWN0cyhTZWxlY3Qgc2VsLCBib29sZWFuIGRpc3RpbmN0\nSWRlbnRpZmllcnMsCiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAg\nICAgICAvLyBhcHBlbmQgdGhlIGFsaWFzZXMgZm9yIGFsbCB0aGUgY29sdW1u\ncwogICAgICAgIFNRTEJ1ZmZlciBzZWxlY3RTUUwgPSBuZXcgU1FMQnVmZmVy\nKHRoaXMpOwogICAgICAgIExpc3QgYWxpYXNlczsKICAgICAgICBpZiAoZGlz\ndGluY3RJZGVudGlmaWVycykKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5n\nZXRJZGVudGlmaWVyQWxpYXNlcygpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgYWxpYXNlcyA9IHNlbC5nZXRTZWxlY3RBbGlhc2VzKCk7CgogICAgICAg\nIE9iamVjdCBhbGlhczsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFs\naWFzZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgYWxpYXMgPSBhbGlh\nc2VzLmdldChpKTsKICAgICAgICAgICAgYXBwZW5kU2VsZWN0KHNlbGVjdFNR\nTCwgYWxpYXMsIHNlbCwgaSk7CiAgICAgICAgICAgIGlmIChpIDwgYWxpYXNl\ncy5zaXplKCkgLSAxKQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVu\nZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVjdFNRTDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCA8Y29kZT5lbGVtPC9jb2Rl\nPiB0byA8Y29kZT5zZWxlY3RTUUw8L2NvZGU+LgogICAgICogQHBhcmFtIHNl\nbGVjdFNRTCBUaGUgU1FMQnVmZmVyIHRvIGFwcGVuZCB0by4KICAgICAqIEBw\nYXJhbSBhbGlhcyBBIHtAbGluayBTUUxCdWZmZXJ9IG9yIGEge0BsaW5rIFN0\ncmluZ30gdG8gYXBwZW5kLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmRTZWxlY3QoU1FMQnVm\nZmVyIHNlbGVjdFNRTCwgT2JqZWN0IGVsZW0sIFNlbGVjdCBzZWwsCiAgICAg\nICAgaW50IGlkeCkgewogICAgICAgIGlmIChlbGVtIGluc3RhbmNlb2YgU1FM\nQnVmZmVyKQogICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKChTUUxCdWZm\nZXIpIGVsZW0pOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VsZWN0U1FM\nLmFwcGVuZChlbGVtLnRvU3RyaW5nKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJucyB0cnVlIGlmIGEgIkZPUiBVUERBVEUiIGNsYXVzZSBjYW4g\nYmUgdXNlZCBmb3IgdGhlIHNwZWNpZmllZAogICAgICogU2VsZWN0IG9iamVj\ndC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nKFNlbGVjdCBzZWwpIHsKICAgICAgICBpZiAoc2VsLmlzQWdncmVnYXRlKCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBv\ncnRzU2VsZWN0Rm9yVXBkYXRlKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2Ug\nJiYgKHNlbC5nZXRTdGFydEluZGV4KCkgIT0gMAogICAgICAgICAgICB8fCBz\nZWwuZ2V0RW5kSW5kZXgoKSAhPSBMb25nLk1BWF9WQUxVRSkpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gb25seSBpbm5lciBzZWxl\nY3QgaXMgbG9ja2VkCiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2VsZWN0KCkg\nIT0gbnVsbCkKICAgICAgICAgICAgc2VsID0gc2VsLmdldEZyb21TZWxlY3Qo\nKTsKCiAgICAgICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoRGlzdGluY3RD\nbGF1c2UgJiYgc2VsLmlzRGlzdGluY3QoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE11bHRp\ncGxlVGFibGVzCiAgICAgICAgICAgICYmIHNlbC5nZXRUYWJsZUFsaWFzZXMo\nKS5zaXplKCkgPiAxKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgaWYgKCFzdXBwb3J0c0xvY2tpbmdXaXRoT3JkZXJDbGF1c2UgJiYgc2Vs\nLmdldE9yZGVyaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE91dGVySm9p\nbiB8fCAhc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbikgewogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIEpvaW4gam9p\nbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKCFz\ndXBwb3J0c0xvY2tpbmdXaXRoT3V0ZXJKb2luCiAgICAgICAgICAgICAgICAg\nICAgJiYgam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVSKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAg\nIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aElubmVySm9pbgogICAgICAgICAg\nICAgICAgICAgICYmIGpvaW4uZ2V0VHlwZSgpID09IEpvaW4uVFlQRV9JTk5F\nUikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gZmFsc2UgaWYgdGhlIGdpdmVuIHNlbGVj\ndCByZXF1aXJlcyBhIGZvcndhcmQtb25seSByZXN1bHQgc2V0LgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1JhbmRvbUFjY2Vzc1Jlc3Vs\ndFNldChTZWxlY3Qgc2VsLAogICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7\nCiAgICAgICAgcmV0dXJuICFzZWwuaXNBZ2dyZWdhdGUoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFzc2VydCB0aGF0IHRoZSBnaXZlbiBkaWN0aW9uYXJ5\nIGZsYWcgaXMgdHJ1ZS4gSWYgaXQgaXMgbm90IHRydWUsCiAgICAgKiB0aHJv\ndyBhbiBlcnJvciBzYXlpbmcgdGhhdCB0aGUgZ2l2ZW4gc2V0dGluZyBuZWVk\ncyB0byByZXR1cm4gdHJ1ZSBmb3IKICAgICAqIHRoZSBjdXJyZW50IG9wZXJh\ndGlvbiB0byB3b3JrLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRT\ndXBwb3J0KGJvb2xlYW4gZmVhdHVyZSwgU3RyaW5nIHByb3BlcnR5KSB7CiAg\nICAgICAgaWYgKCFmZWF0dXJlKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImZlYXR1cmUtbm90LXN1cHBv\ncnRlZCIsCiAgICAgICAgICAgICAgICBnZXRDbGFzcygpLCBwcm9wZXJ0eSkp\nOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBRdWVy\neSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBJbnZva2UgdGhpcyBkYXRhYmFzZSdzIHN1YnN0cmluZyBmdW5j\ndGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVy\nIHRvIHdyaXRlIHRoZSBzdWJzdHJpbmcgaW52b2NhdGlvbiB0bwogICAgICog\nQHBhcmFtIHN0ciBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFy\nZ2V0IHN0cmluZwogICAgICogQHBhcmFtIHN0YXJ0IGEgcXVlcnkgdmFsdWUg\ncmVwcmVzZW50aW5nIHRoZSBzdGFydCBpbmRleAogICAgICogQHBhcmFtIGVu\nZCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgZW5kIGluZGV4LCBv\nciBudWxsIGZvciBub25lCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN1YnN0\ncmluZyhTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIsIEZpbHRlclZh\nbHVlIHN0YXJ0LAogICAgICAgIEZpbHRlclZhbHVlIGVuZCkgewogICAgICAg\nIGJ1Zi5hcHBlbmQoc3Vic3RyaW5nRnVuY3Rpb25OYW1lKS5hcHBlbmQoIigi\nKTsKICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAgICBidWYuYXBw\nZW5kKCIsICIpOwogICAgICAgIGlmIChzdGFydC5nZXRWYWx1ZSgpIGluc3Rh\nbmNlb2YgTnVtYmVyKSB7CiAgICAgICAgICAgIGxvbmcgc3RhcnRMb25nID0g\ndG9Mb25nKHN0YXJ0KTsKICAgICAgICAgICAgYnVmLmFwcGVuZChMb25nLnRv\nU3RyaW5nKHN0YXJ0TG9uZyArIDEpKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBidWYuYXBwZW5kKCIoIik7CiAgICAgICAgICAgIHN0YXJ0LmFw\ncGVuZFRvKGJ1Zik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiArIDEpIik7\nCiAgICAgICAgfQogICAgICAgIGlmIChlbmQgIT0gbnVsbCkgewogICAgICAg\nICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBpZiAoc3RhcnQu\nZ2V0VmFsdWUoKSBpbnN0YW5jZW9mIE51bWJlcgogICAgICAgICAgICAgICAg\nJiYgZW5kLmdldFZhbHVlKCkgaW5zdGFuY2VvZiBOdW1iZXIpIHsKICAgICAg\nICAgICAgICAgIGxvbmcgc3RhcnRMb25nID0gdG9Mb25nKHN0YXJ0KTsKICAg\nICAgICAgICAgICAgIGxvbmcgZW5kTG9uZyA9IHRvTG9uZyhlbmQpOwogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChMb25nLnRvU3RyaW5nKGVuZExvbmcg\nLSBzdGFydExvbmcpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIGVuZC5hcHBlbmRUbyhidWYpOwogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIC0gKCIpOwogICAgICAgICAgICAgICAgc3RhcnQuYXBwZW5k\nVG8oYnVmKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIikiKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBidWYuYXBwZW5kKCIpIik7\nCiAgICB9CgogICAgbG9uZyB0b0xvbmcoRmlsdGVyVmFsdWUgbGl0VmFsdWUp\nIHsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGxpdFZhbHVlLmdldFZhbHVl\nKCkpLmxvbmdWYWx1ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tl\nIHRoaXMgZGF0YWJhc2UncyBpbmRleE9mIGZ1bmN0aW9uLgogICAgICoKICAg\nICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGlu\nZGV4T2YgaW52b2NhdGlvbiB0bwogICAgICogQHBhcmFtIHN0ciBhIHF1ZXJ5\nIHZhbHVlIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHN0cmluZwogICAgICog\nQHBhcmFtIGZpbmQgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHNl\nYXJjaCBzdHJpbmcKICAgICAqIEBwYXJhbSBzdGFydCBhIHF1ZXJ5IHZhbHVl\nIHJlcHJlc2VudGluZyB0aGUgc3RhcnQgaW5kZXgsIG9yIG51bGwKICAgICAq\nIHRvIHN0YXJ0IGF0IHRoZSBiZWdpbm5pbmcKICAgICAqLwogICAgcHVibGlj\nIHZvaWQgaW5kZXhPZihTUUxCdWZmZXIgYnVmLCBGaWx0ZXJWYWx1ZSBzdHIs\nIEZpbHRlclZhbHVlIGZpbmQsCiAgICAgICAgRmlsdGVyVmFsdWUgc3RhcnQp\nIHsKICAgICAgICBidWYuYXBwZW5kKCIoSU5TVFIoKCIpOwogICAgICAgIGlm\nIChzdGFydCAhPSBudWxsKQogICAgICAgICAgICBzdWJzdHJpbmcoYnVmLCBz\ndHIsIHN0YXJ0LCBudWxsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0\nci5hcHBlbmRUbyhidWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiksICgiKTsK\nICAgICAgICBmaW5kLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiKSkgLSAxIik7CiAgICAgICAgaWYgKHN0YXJ0ICE9IG51bGwpIHsKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiICsgIik7CiAgICAgICAgICAgIHN0YXJ0\nLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgfQogICAgICAgIGJ1Zi5hcHBlbmQo\nIikiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCB0aGUgbnVtZXJp\nYyBwYXJ0cyBvZiBhIG1hdGhlbWF0aWNhbCBmdW5jdGlvbi4KICAgICAqCiAg\nICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBt\nYXRoIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gb3AgdGhlIG1hdGhlbWF0aWNh\nbCBvcGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUg\nbGVmdCBoYW5kIHNpZGUgb2YgdGhlIG1hdGggZnVuY3Rpb24KICAgICAqIEBw\nYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgbWF0aCBmdW5j\ndGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBtYXRoRnVuY3Rpb24oU1FM\nQnVmZmVyIGJ1ZiwgU3RyaW5nIG9wLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAg\nICAgRmlsdGVyVmFsdWUgcmhzKSB7CiAgICAgICAgYm9vbGVhbiBjYXN0bGhz\nID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBjYXN0cmhzID0gZmFsc2U7CiAg\nICAgICAgQ2xhc3MgbGMgPSBGaWx0ZXJzLndyYXAobGhzLmdldFR5cGUoKSk7\nCiAgICAgICAgQ2xhc3MgcmMgPSBGaWx0ZXJzLndyYXAocmhzLmdldFR5cGUo\nKSk7CiAgICAgICAgaW50IHR5cGUgPSAwOwogICAgICAgIGlmIChyZXF1aXJl\nc0Nhc3RGb3JNYXRoRnVuY3Rpb25zICYmIChsYyAhPSByYwogICAgICAgICAg\nICB8fCAobGhzLmlzQ29uc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSkp\nIHsKICAgICAgICAgICAgQ2xhc3MgYyA9IEZpbHRlcnMucHJvbW90ZShsYywg\ncmMpOwogICAgICAgICAgICB0eXBlID0gZ2V0SkRCQ1R5cGUoSmF2YVR5cGVz\nLmdldFR5cGVDb2RlKGMpLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICh0eXBl\nICE9IFR5cGVzLlZBUkJJTkFSWSAmJiB0eXBlICE9IFR5cGVzLkJMT0IpIHsK\nICAgICAgICAgICAgICAgIGNhc3RsaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAm\nJiByaHMuaXNDb25zdGFudCgpKSB8fCBsYyAhPSBjOwogICAgICAgICAgICAg\nICAgY2FzdHJocyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0\nYW50KCkpIHx8IHJjICE9IGM7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGJvb2xlYW4gbW9kID0gIk1PRCIuZXF1YWxzKG9wKTsKICAgICAg\nICBpZiAobW9kKSB7CiAgICAgICAgICAgIGlmIChzdXBwb3J0c01vZE9wZXJh\ndG9yKQogICAgICAgICAgICAgICAgb3AgPSAiJSI7CiAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQob3ApOwogICAgICAgIH0K\nICAgICAgICBidWYuYXBwZW5kKCIoIik7CgogICAgICAgIGlmIChjYXN0bGhz\nKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgbGhzLCB0eXBlKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGxocy5hcHBlbmRUbyhidWYpOwoKICAg\nICAgICBpZiAobW9kICYmICFzdXBwb3J0c01vZE9wZXJhdG9yKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5kKCIgIik7Cgog\nICAgICAgIGlmIChjYXN0cmhzKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1\nZiwgcmhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJocy5h\ncHBlbmRUbyhidWYpOwoKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBjb21wYXJpc29uLgogICAgICoK\nICAgICAqIEBwYXJhbSBidWYgdGhlIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhl\nIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBv\ncGVyYXRpb24gdG8gcGVyZm9ybQogICAgICogQHBhcmFtIGxocyB0aGUgbGVm\ndCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlzb24KICAgICAqIEBwYXJhbSBy\naHMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNvbgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBjb21wYXJpc29uKFNRTEJ1ZmZlciBidWYs\nIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZh\nbHVlIHJocykgewogICAgICAgIGJvb2xlYW4gbGhzeG1sID0gbGhzLmdldFhQ\nYXRoKCkgIT0gbnVsbDsKICAgICAgICBib29sZWFuIHJoc3htbCA9IHJocy5n\nZXRYUGF0aCgpICE9IG51bGw7CiAgICAgICAgaWYgKGxoc3htbCB8fCByaHN4\nbWwpIHsKICAgICAgICAgICAgYXBwZW5kWG1sQ29tcGFyaXNvbihidWYsIG9w\nLCBsaHMsIHJocywgbGhzeG1sLCByaHN4bWwpOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQogICAgICAgIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNl\nOwogICAgICAgIGJvb2xlYW4gY2FzdHJocyA9IGZhbHNlOwogICAgICAgIENs\nYXNzIGxjID0gRmlsdGVycy53cmFwKGxocy5nZXRUeXBlKCkpOwogICAgICAg\nIENsYXNzIHJjID0gRmlsdGVycy53cmFwKHJocy5nZXRUeXBlKCkpOwogICAg\nICAgIGludCB0eXBlID0gMDsKICAgICAgICBpZiAocmVxdWlyZXNDYXN0Rm9y\nQ29tcGFyaXNvbnMgJiYgKGxjICE9IHJjCiAgICAgICAgICAgIHx8IChsaHMu\naXNDb25zdGFudCgpICYmIHJocy5pc0NvbnN0YW50KCkpKSkgewogICAgICAg\nICAgICBDbGFzcyBjID0gRmlsdGVycy5wcm9tb3RlKGxjLCByYyk7CiAgICAg\nICAgICAgIHR5cGUgPSBnZXRKREJDVHlwZShKYXZhVHlwZXMuZ2V0VHlwZUNv\nZGUoYyksIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0gVHlwZXMu\nVkFSQklOQVJZICYmIHR5cGUgIT0gVHlwZXMuQkxPQikgewogICAgICAgICAg\nICAgICAgY2FzdGxocyA9IChsaHMuaXNDb25zdGFudCgpICYmIHJocy5pc0Nv\nbnN0YW50KCkpIHx8IGxjICE9IGM7CiAgICAgICAgICAgICAgICBjYXN0cmhz\nID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwg\ncmMgIT0gYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKGNhc3RsaHMpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCBsaHMsIHR5\ncGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbGhzLmFwcGVuZFRvKGJ1\nZik7CgogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVu\nZCgiICIpOwoKICAgICAgICBpZiAoY2FzdHJocykKICAgICAgICAgICAgYXBw\nZW5kQ2FzdChidWYsIHJocywgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICByaHMuYXBwZW5kVG8oYnVmKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIElmIHRoaXMgZGljdGlvbmFyeSBzdXBwb3J0cyBYTUwgdHlwZSwKICAgICAq\nIHVzZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgeG1sIHByZWRpY2F0ZS4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNvbihTUUxC\ndWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywKICAgICAg\nICBGaWx0ZXJWYWx1ZSByaHMsIGJvb2xlYW4gbGhzeG1sLCBib29sZWFuIHJo\nc3htbCkgewogICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNYTUxDb2x1\nbW4sICJTdXBwb3J0c1hNTENvbHVtbiIpOwogICAgfQoKICAgIC8qKgogICAg\nICogQXBwZW5kIFNRTCBmb3IgdGhlIGdpdmVuIG51bWVyaWMgdmFsdWUgdG8g\ndGhlIGJ1ZmZlciwgY2FzdGluZyBhcyBuZWVkZWQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGFwcGVuZE51bWVyaWNDYXN0KFNRTEJ1ZmZlciBidWYs\nIEZpbHRlclZhbHVlIHZhbCkgewogICAgICAgIGlmICh2YWwuaXNDb25zdGFu\ndCgpKQogICAgICAgICAgICBhcHBlbmRDYXN0KGJ1ZiwgdmFsLCBUeXBlcy5O\nVU1FUklDKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHZhbC5hcHBlbmRU\nbyhidWYpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FzdCB0aGUgc3BlY2lm\naWVkIHZhbHVlIHRvIHRoZSBzcGVjaWZpZWQgdHlwZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gYnVmIHRoZSBidWZmZXIgdG8gYXBwZW5kIHRoZSBjYXN0IHRv\nCiAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBjYXN0CiAgICAgKiBA\ncGFyYW0gdHlwZSB0aGUgdHlwZSBvZiB0aGUgY2FzZSwgZS5nLiB7QGxpbmsg\nVHlwZXMjTlVNRVJJQ30KICAgICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5k\nQ2FzdChTUUxCdWZmZXIgYnVmLCBPYmplY3QgdmFsLCBpbnQgdHlwZSkgewog\nICAgICAgIC8vIENvbnZlcnQgdGhlIGNhc3QgZnVuY3Rpb246ICJDQVNUKHsw\nfSBBUyB7MX0pIgogICAgICAgIGludCBmaXJzdFBhcmFtID0gY2FzdEZ1bmN0\naW9uLmluZGV4T2YoInswfSIpOwogICAgICAgIFN0cmluZyBwcmUgPSBjYXN0\nRnVuY3Rpb24uc3Vic3RyaW5nKDAsIGZpcnN0UGFyYW0pOyAvLyAiQ0FTVCgi\nCiAgICAgICAgU3RyaW5nIG1pZCA9IGNhc3RGdW5jdGlvbi5zdWJzdHJpbmco\nZmlyc3RQYXJhbSArIDMpOwogICAgICAgIGludCBzZWNvbmRQYXJhbSA9IG1p\nZC5pbmRleE9mKCJ7MX0iKTsKICAgICAgICBTdHJpbmcgcG9zdDsKICAgICAg\nICBpZiAoc2Vjb25kUGFyYW0gPiAtMSkgewogICAgICAgICAgICBwb3N0ID0g\nbWlkLnN1YnN0cmluZyhzZWNvbmRQYXJhbSArIDMpOyAvLyAiKSIKICAgICAg\nICAgICAgbWlkID0gbWlkLnN1YnN0cmluZygwLCBzZWNvbmRQYXJhbSk7IC8v\nICIgQVMgIgogICAgICAgIH0gZWxzZQogICAgICAgICAgICBwb3N0ID0gIiI7\nCgogICAgICAgIGJ1Zi5hcHBlbmQocHJlKTsKICAgICAgICBpZiAodmFsIGlu\nc3RhbmNlb2YgRmlsdGVyVmFsdWUpCiAgICAgICAgICAgICgoRmlsdGVyVmFs\ndWUpIHZhbCkuYXBwZW5kVG8oYnVmKTsKICAgICAgICBlbHNlIGlmICh2YWwg\naW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nKChTUUxCdWZmZXIpIHZhbCkpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nYnVmLmFwcGVuZCh2YWwudG9TdHJpbmcoKSk7CiAgICAgICAgYnVmLmFwcGVu\nZChtaWQpOwogICAgICAgIGJ1Zi5hcHBlbmQoZ2V0VHlwZU5hbWUodHlwZSkp\nOwogICAgICAgIGFwcGVuZExlbmd0aChidWYsIHR5cGUpOwogICAgICAgIGJ1\nZi5hcHBlbmQocG9zdCk7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCB2b2lk\nIGFwcGVuZExlbmd0aChTUUxCdWZmZXIgYnVmLCBpbnQgdHlwZSkgeyAgICAg\nICAgCiAgICB9CgogICAgCiAgICAvKioKICAgICAqIGFkZCBDQVNUIGZvciBh\nIGZ1bmN0aW9uIG9wZXJhdG9yIHdoZXJlIG9wZXJhbmQgaXMgYSBwYXJhbQog\nICAgICogQHBhcmFtIGZ1bmMgIGZ1bmN0aW9uIG5hbWUKICAgICAqIEBwYXJh\nbSB2YWwgCiAgICAgKiBAcmV0dXJuIHVwZGF0ZWQgZnVuYwogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGFkZENhc3RBc1R5cGUoU3RyaW5nIGZ1bmMsIFZh\nbCB2YWwpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0gICAgCgoKICAg\nIC8vLy8vLy8vLy8vCiAgICAvLyBEREwgU1FMCiAgICAvLy8vLy8vLy8vLwoK\nICAgIC8qKgogICAgICogSW5jcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQg\nb2YgYW55IHRhYmxlIGNvbXBvbmVudHMgdGhhdCB0aGlzCiAgICAgKiBkaWN0\naW9uYXJ5IGFkZHMgdGhhdCBhcmUgbm90IHVzZWQgYnkgbWFwcGluZ3MuIERv\nZXMgbm90aGluZyBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCByZWZTY2hlbWFDb21wb25lbnRzKFRhYmxlIHRhYmxlKSB7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRh\nYmxlLCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBi\neSB7QGxpbmsgI2NhdGFsb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXRGdWxsTmFtZShUYWJsZSB0YWJsZSwgYm9vbGVhbiBs\nb2dpY2FsKSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IHRhYmxl\nLmdldFNjaGVtYU5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGlmIChsb2dpY2FsIHx8ICIuIi5l\ncXVhbHMoY2F0YWxvZ1NlcGFyYXRvcikpCiAgICAgICAgICAgIHJldHVybiB0\nYWJsZS5nZXRGdWxsTmFtZSgpOwogICAgICAgIHJldHVybiB0YWJsZS5nZXRT\nY2hlbWFOYW1lKCkgKyBjYXRhbG9nU2VwYXJhdG9yICsgdGFibGUuZ2V0TmFt\nZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgZnVsbCBu\nYW1lIG9mIHRoZSBpbmRleCwgaW5jbHVkaW5nIHRoZSBzY2hlbWEgKGRlbGlt\naXRlZAogICAgICogYnkgdGhlIHJlc3VsdCBvZiB7QGxpbmsgI2NhdGFsb2dT\nZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRGdWxs\nTmFtZShJbmRleCBpbmRleCkgewogICAgICAgIGlmICghdXNlU2NoZW1hTmFt\nZSB8fCBpbmRleC5nZXRTY2hlbWFOYW1lKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGluZGV4LmdldE5hbWUoKTsKICAgICAgICBpZiAoIi4iLmVx\ndWFscyhjYXRhbG9nU2VwYXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIGlu\nZGV4LmdldEZ1bGxOYW1lKCk7CiAgICAgICAgcmV0dXJuIGluZGV4LmdldFNj\naGVtYU5hbWUoKSArIGNhdGFsb2dTZXBhcmF0b3IgKyBpbmRleC5nZXROYW1l\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5h\nbWUgb2YgdGhlIHNlcXVlbmNlLCBpbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVs\naW1pdGVkCiAgICAgKiBieSB0aGUgcmVzdWx0IG9mIHtAbGluayAjY2F0YWxv\nZ1NlcGFyYXRvcn0pLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldEZ1\nbGxOYW1lKFNlcXVlbmNlIHNlcSkgewogICAgICAgIGlmICghdXNlU2NoZW1h\nTmFtZSB8fCBzZXEuZ2V0U2NoZW1hTmFtZSgpID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBzZXEuZ2V0TmFtZSgpOwogICAgICAgIGlmICgiLiIuZXF1\nYWxzKGNhdGFsb2dTZXBhcmF0b3IpKQogICAgICAgICAgICByZXR1cm4gc2Vx\nLmdldEZ1bGxOYW1lKCk7CiAgICAgICAgcmV0dXJuIHNlcS5nZXRTY2hlbWFO\nYW1lKCkgKyBjYXRhbG9nU2VwYXJhdG9yICsgc2VxLmdldE5hbWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2Vz\nIHRvIHRoZSBnaXZlbiB0YWJsZSBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAg\nICAqIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0\ncmluZyBnZXRWYWxpZFRhYmxlTmFtZShTdHJpbmcgbmFtZSwgU2NoZW1hIHNj\naGVtYSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkK\nICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAg\nIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHNjaGVtYS5nZXRTY2hlbWFH\ncm91cCgpLAogICAgICAgICAgICBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVf\nVEFCTEUpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNz\nYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIHNlcXVlbmNlIG5hbWUgdG8gbWFr\nZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkU2VxdWVuY2VOYW1lKFN0cmlu\nZyBuYW1lLCBTY2hlbWEgc2NoZW1hKSB7CiAgICAgICAgd2hpbGUgKG5hbWUu\nc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJz\ndHJpbmcoMSk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQoIlNfIiAr\nIG5hbWUsIHNjaGVtYS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBt\nYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfU0VRVUVOQ0UpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhl\nIGdpdmVuIGNvbHVtbiBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZv\nciB0aGUgY3VycmVudCBEQi4gIFRoZSBjb2x1bW4gbmFtZSB3aWxsIGJlIG1h\nZGUgdW5pcXVlIGZvciB0aGUKICAgICAqIHNwZWNpZmllZCB0YWJsZS4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZENvbHVtbk5hbWUoU3Ry\naW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIGdldFZh\nbGlkQ29sdW1uTmFtZShuYW1lLCB0YWJsZSwgdHJ1ZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUg\nZ2l2ZW4gY29sdW1uIG5hbWUgdG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9y\nIHRoZSBjdXJyZW50IERCLiAgSWYgY2hlY2tGb3JVbmlxdWVuZXNzIGlzIHRy\ndWUsIHRoZSBjb2x1bW4gbmFtZSB3aWxsIAogICAgICogYmUgbWFkZSB1bmlx\ndWUgZm9yIHRoZSBzcGVjaWZpZWQgdGFibGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0VmFsaWRDb2x1bW5OYW1lKFN0cmluZyBuYW1lLCBUYWJs\nZSB0YWJsZSwKICAgICAgICBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVzcykg\newogICAgICAgIHdoaWxlIChuYW1lLnN0YXJ0c1dpdGgoIl8iKSkKICAgICAg\nICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgIHJldHVy\nbiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLCBtYXhDb2x1bW5OYW1lTGVu\nZ3RoLCBOQU1FX0FOWSwKICAgICAgICAgICAgY2hlY2tGb3JVbmlxdWVuZXNz\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBj\naGFuZ2VzIHRvIHRoZSBnaXZlbiBwcmltYXJ5IGtleSBuYW1lIHRvIG1ha2Ug\naXQKICAgICAqIHZhbGlkIGZvciB0aGUgY3VycmVudCBEQi4KICAgICAqLwog\nICAgcHVibGljIFN0cmluZyBnZXRWYWxpZFByaW1hcnlLZXlOYW1lKFN0cmlu\nZyBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAgIHdoaWxlIChuYW1lLnN0\nYXJ0c1dpdGgoIl8iKSkKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3Ry\naW5nKDEpOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKCJQXyIgKyBu\nYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAg\nICAgICAgICBtYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIGZvcmVpZ24ga2V5IG5hbWUgdG8gbWFrZSBpdAog\nICAgICogdmFsaWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nIGdldFZhbGlkRm9yZWlnbktleU5hbWUoU3RyaW5nIG5h\nbWUsIFRhYmxlIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsKICAg\nICAgICB3aGlsZSAobmFtZS5zdGFydHNXaXRoKCJfIikpCiAgICAgICAgICAg\nIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTsKICAgICAgICBTdHJpbmcgdGFi\nbGVOYW1lID0gdGFibGUuZ2V0TmFtZSgpOwogICAgICAgIGludCBsZW4gPSBN\nYXRoLm1pbih0YWJsZU5hbWUubGVuZ3RoKCksIDcpOwogICAgICAgIG5hbWUg\nPSAiRl8iICsgc2hvcnRlbih0YWJsZU5hbWUsIGxlbikgKyAiXyIgKyBuYW1l\nOwogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUsIHRhYmxlLmdl\ndFNjaGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heENv\nbnN0cmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2\nZW4gaW5kZXggbmFtZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhl\nIGN1cnJlbnQgREIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VmFs\naWRJbmRleE5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAg\nICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAgICAgICBu\nYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5nIHRhYmxl\nTmFtZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVuID0gTWF0\naC5taW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBuYW1lID0g\nIklfIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsgbmFtZTsK\nICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJsZS5nZXRT\nY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBtYXhJbmRl\neE5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB1bmlx\ndWUgY29uc3RyYWludCBuYW1lIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkIGZv\nciB0aGUgY3VycmVudCBEQi4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBn\nZXRWYWxpZFVuaXF1ZU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7\nCiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQogICAgICAg\nICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgU3RyaW5n\nIHRhYmxlTmFtZSA9IHRhYmxlLmdldE5hbWUoKTsKICAgICAgICBpbnQgbGVu\nID0gTWF0aC5taW4odGFibGVOYW1lLmxlbmd0aCgpLCA3KTsKICAgICAgICBu\nYW1lID0gIlVfIiArIHNob3J0ZW4odGFibGVOYW1lLCBsZW4pICsgIl8iICsg\nbmFtZTsKICAgICAgICByZXR1cm4gbWFrZU5hbWVWYWxpZChuYW1lLCB0YWJs\nZS5nZXRTY2hlbWEoKS5nZXRTY2hlbWFHcm91cCgpLAogICAgICAgICAgICBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCwgTkFNRV9BTlkpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2hvcnRlbiB0aGUgc3BlY2lmaWVkIG5hbWUgdG8gdGhl\nIHNwZWNpZmllZCB0YXJnZXQgbmFtZS4gVGhpcyB3aWxsCiAgICAgKiBiZSBk\nb25lIGJ5IGZpcnN0IHN0cmlwcGluZyBvdXQgdGhlIHZvd2VscywgYW5kIHRo\nZW4gcmVtb3ZpbmcKICAgICAqIGNoYXJhY3RlcnMgZnJvbSB0aGUgbWlkZGxl\nIG9mIHRoZSB3b3JkIHVudGlsIGl0IHJlYWNoZXMgdGhlIHRhcmdldAogICAg\nICogbGVuZ3RoLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIFN0cmlu\nZyBzaG9ydGVuKFN0cmluZyBuYW1lLCBpbnQgdGFyZ2V0TGVuZ3RoKSB7CiAg\nICAgICAgaWYgKG5hbWUgPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpIDw9IHRh\ncmdldExlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG5hbWU7CgogICAgICAg\nIFN0cmluZ0J1ZmZlciBubSA9IG5ldyBTdHJpbmdCdWZmZXIobmFtZSk7CiAg\nICAgICAgd2hpbGUgKG5tLmxlbmd0aCgpID4gdGFyZ2V0TGVuZ3RoKSB7CiAg\nICAgICAgICAgIGlmICghc3RyaXBWb3dlbChubSkpIHsKICAgICAgICAgICAg\nICAgIC8vIGN1dCBvdXQgdGhlIG1pZGRsZSBjaGFyCiAgICAgICAgICAgICAg\nICBubS5yZXBsYWNlKG5tLmxlbmd0aCgpIC8gMiwgKG5tLmxlbmd0aCgpIC8g\nMikgKyAxLCAiIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG5tLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgdm93ZWxzIGZyb20gdGhlIHNwZWNpZmllZCBTdHJpbmdCdWZmZXIu\nCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIGFueSB2b3dlbHMgaGF2\nZSBiZWVuIHJlbW92ZWQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9v\nbGVhbiBzdHJpcFZvd2VsKFN0cmluZ0J1ZmZlciBuYW1lKSB7CiAgICAgICAg\naWYgKG5hbWUgPT0gbnVsbCB8fCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9\nIHsgJ0EnLCAnRScsICdJJywgJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCB2b3dlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgaW50IGluZGV4ID0gbmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCku\naW5kZXhPZih2b3dlbHNbaV0pOwogICAgICAgICAgICBpZiAoaW5kZXggIT0g\nLTEpIHsKICAgICAgICAgICAgICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5k\nZXggKyAxLCAiIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0\nbyB0aGUgZ2l2ZW4gbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQK\nICAgICAqIGl0IGlzIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJl\nc2VydmVkLCBhcHBlbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29u\nZmxpY3RzIHdpdGggYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhl\nIGxhc3QKICAgICAqIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0\naGVuICcxJywgZXRjLgogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXgg\nbGVuIG1heSBiZSAwIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAg\nICogaW5jb21wbGV0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBt\nYWtlTmFtZVZhbGlkKFN0cmluZyBuYW1lLCBOYW1lU2V0IHNldCwgaW50IG1h\neExlbiwKICAgICAgICBpbnQgbmFtZVR5cGUpIHsKICAgICAgICByZXR1cm4g\nbWFrZU5hbWVWYWxpZChuYW1lLCBzZXQsIG1heExlbiwgbmFtZVR5cGUsIHRy\ndWUpOwogICAgfQoKICAgIC8qKgogICAgICogU2hvcnRlbnMgdGhlIGdpdmVu\nIG5hbWUgdG8gdGhlIGdpdmVuIG1heGltdW0gbGVuZ3RoLCB0aGVuIGNoZWNr\ncyB0aGF0CiAgICAgKiBpdCBpcyBub3QgYSByZXNlcnZlZCB3b3JkLiBJZiBp\ndCBpcyByZXNlcnZlZCwgYXBwZW5kcyBhICIwIi4gSWYKICAgICAqIHRoZSBu\nYW1lIGNvbmZsaWN0cyB3aXRoIGFuIGV4aXN0aW5nIHNjaGVtYSBjb21wb25l\nbnQgYW5kIHVuaXF1ZW5lc3MKICAgICAqIGNoZWNraW5nIGlzIGVuYWJsZWQs\nIHRoZSBsYXN0IGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVu\nIAogICAgICogJzEnLCBldGMuIAogICAgICogTm90ZSB0aGF0IHRoZSBnaXZl\nbiBtYXggbGVuIG1heSBiZSAwIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBp\ncyAKICAgICAqIGluY29tcGxldGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQs\nIGludCBtYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlLCBib29sZWFuIGNo\nZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAgIGlmIChtYXhMZW4gPCAxKQog\nICAgICAgICAgICBtYXhMZW4gPSAyNTU7CiAgICAgICAgaWYgKG5hbWUubGVu\nZ3RoKCkgPiBtYXhMZW4pCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0\ncmluZygwLCBtYXhMZW4pOwogICAgICAgIGlmIChyZXNlcnZlZFdvcmRTZXQu\nY29udGFpbnMobmFtZS50b1VwcGVyQ2FzZSgpKSkgewogICAgICAgICAgICBp\nZiAobmFtZS5sZW5ndGgoKSA9PSBtYXhMZW4pCiAgICAgICAgICAgICAgICBu\nYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGgoKSAtIDEpOwog\nICAgICAgICAgICBuYW1lICs9ICIwIjsKICAgICAgICB9CgogICAgICAgIC8v\nIG5vdyBtYWtlIHN1cmUgdGhlIG5hbWUgaXMgdW5pcXVlCiAgICAgICAgaWYg\nKHNldCAhPSBudWxsICYmIGNoZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAg\nICAgICBvdXRlcjoKICAgICAgICAgICAgZm9yIChpbnQgdmVyc2lvbiA9IDEs\nIGNoYXJzID0gMTsgdHJ1ZTsgdmVyc2lvbisrKSB7CiAgICAgICAgICAgICAg\nICAvLyBmb3IgdGFibGUgbmFtZXMsIHdlIGNoZWNrIGZvciB0aGUgdGFibGUg\naXRzZWxmIGluIGNhc2UgdGhlCiAgICAgICAgICAgICAgICAvLyBuYW1lIHNl\ndCBpcyBsYXp5IGFib3V0IHNjaGVtYSByZWZsZWN0aW9uCiAgICAgICAgICAg\nICAgICBzd2l0Y2ggKG5hbWVUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nY2FzZSBOQU1FX1RBQkxFOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nISgoU2NoZW1hR3JvdXApIHNldCkuaXNLbm93blRhYmxlKG5hbWUpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNh\nc2UgTkFNRV9TRVFVRU5DRToKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKCEoKFNjaGVtYUdyb3VwKSBzZXQpLmlzS25vd25TZXF1ZW5jZShuYW1lKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyOwogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNldC5p\nc05hbWVUYWtlbihuYW1lKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrIG91dGVyOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIC8vIGEgc2luZ2xlIGNoYXIgZm9yIHRoZSB2ZXJzaW9uIGlzIHByb2Jh\nYmx5IGVub3VnaCwgYnV0IG1pZ2h0CiAgICAgICAgICAgICAgICAvLyBhcyB3\nZWxsIGJlIGdlbmVyYWwgYWJvdXQgaXQuLi4KICAgICAgICAgICAgICAgIGlm\nICh2ZXJzaW9uID4gMSkKICAgICAgICAgICAgICAgICAgICBuYW1lID0gbmFt\nZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGgoKSAtIGNoYXJzKTsKICAgICAg\nICAgICAgICAgIGlmICh2ZXJzaW9uID49IE1hdGgucG93KDEwLCBjaGFycykp\nCiAgICAgICAgICAgICAgICAgICAgY2hhcnMrKzsKICAgICAgICAgICAgICAg\nIGlmIChuYW1lLmxlbmd0aCgpICsgY2hhcnMgPiBtYXhMZW4pCiAgICAgICAg\nICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG1heExlbiAt\nIGNoYXJzKTsKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgdmVyc2lv\nbjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmFt\nZS50b1VwcGVyQ2FzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGNyZWF0ZSB0aGUgZ2l2\nZW4gdGFibGUsIGNvbXBsZXRlCiAgICAgKiB3aXRoIGNvbHVtbnMuIEluZGV4\nZXMgYW5kIGNvbnN0cmFpbnRzIHdpbGwgYmUgY3JlYXRlZCBzZXBhcmF0ZWx5\nLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVT\nUUwoVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0g\nbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkNSRUFU\nRSBUQUJMRSAiKS5hcHBlbmQoZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKSk7\nCiAgICAgICAgaWYgKHN1cHBvcnRzQ29tbWVudHMgJiYgdGFibGUuaGFzQ29t\nbWVudCgpKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKTsKICAgICAg\nICAgICAgY29tbWVudChidWYsIHRhYmxlLmdldENvbW1lbnQoKSk7CiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAgICgiKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBidWYuYXBwZW5kKCIgKCIpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gZG8gdGhpcyBiZWZvcmUgZ2V0dGluZyB0aGUgY29sdW1ucyBz\nbyB3ZSBrbm93IGhvdyB0byBoYW5kbGUKICAgICAgICAvLyB0aGUgbGFzdCBj\nb21tYQogICAgICAgIFN0cmluZ0J1ZmZlciBlbmRCdWYgPSBuZXcgU3RyaW5n\nQnVmZmVyKCk7CiAgICAgICAgUHJpbWFyeUtleSBwayA9IHRhYmxlLmdldFBy\naW1hcnlLZXkoKTsKICAgICAgICBTdHJpbmcgcGtTdHI7CiAgICAgICAgaWYg\nKHBrICE9IG51bGwpIHsKICAgICAgICAgICAgcGtTdHIgPSBnZXRQcmltYXJ5\nS2V5Q29uc3RyYWludFNRTChwayk7CiAgICAgICAgICAgIGlmIChwa1N0ciAh\nPSBudWxsKQogICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVuZChwa1N0cik7\nCiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1bnFzID0gdGFibGUuZ2V0\nVW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFTdHI7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwodW5xc1tpXSk7\nCiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgaWYgKGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAg\nICAgICAgZW5kQnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAgICAgICAgIGVu\nZEJ1Zi5hcHBlbmQodW5xU3RyKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldENvbHVtbnMoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXREZWNsYXJlQ29sdW1uU1FM\nKGNvbHNbaV0sIGZhbHNlKSk7CiAgICAgICAgICAgIGlmIChpIDwgY29scy5s\nZW5ndGggLSAxIHx8IGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBpZiAoc3VwcG9y\ndHNDb21tZW50cyAmJiBjb2xzW2ldLmhhc0NvbW1lbnQoKSkgewogICAgICAg\nICAgICAgICAgY29tbWVudChidWYsIGNvbHNbaV0uZ2V0Q29tbWVudCgpKTsK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAgICIpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5kKGVuZEJ1Zi50\nb1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgU3RyaW5nQnVmZmVyIGNvbW1lbnQoU3RyaW5nQnVm\nZmVyIGJ1ZiwgU3RyaW5nIGNvbW1lbnQpIHsKICAgICAgICByZXR1cm4gYnVm\nLmFwcGVuZCgiLS0gIikuYXBwZW5kKGNvbW1lbnQpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRv\nIGRyb3AgdGhlIGdpdmVuIHRhYmxlLiBJbmRleGVzCiAgICAgKiB3aWxsIGJl\nIGRyb3BwZWQgc2VwYXJhdGVseS4gUmV0dXJucwogICAgICogPGNvZGU+RFJP\nUCBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDs8L2NvZGU+IGJ5IGRlZmF1bHQu\nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9wVGFibGVTUUwo\nVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJpbmcgZHJvcCA9IE1lc3NhZ2VG\nb3JtYXQuZm9ybWF0KGRyb3BUYWJsZVNRTCwgbmV3IE9iamVjdFtdewogICAg\nICAgICAgICBnZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpIH0pOwogICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nW117IGRyb3AgfTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBj\ncmVhdGUgdGhlIGdpdmVuIHNlcXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29k\nZT5DUkVBVEUgU0VRVUVOQ0UgJmx0O3NlcXVlbmNlIG5hbWUmZ3Q7WyBTVEFS\nVCBXSVRIICZsdDtzdGFydCZndDtdCiAgICAgKiBbIElOQ1JFTUVOVCBCWSAm\nbHQ7aW5jcmVtZW50Jmd0O108L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVTZXF1ZW5jZVNRTChTZXF1\nZW5jZSBzZXEpIHsKICAgICAgICBpZiAobmV4dFNlcXVlbmNlUXVlcnkgPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIFN0cmlu\nZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgYnVm\nLmFwcGVuZCgiQ1JFQVRFIFNFUVVFTkNFICIpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoZ2V0RnVsbE5hbWUoc2VxKSk7CiAgICAgICAgaWYgKHNlcS5nZXRJbml0\naWFsVmFsdWUoKSAhPSAwKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgU1RB\nUlQgV0lUSCAiKS5hcHBlbmQoc2VxLmdldEluaXRpYWxWYWx1ZSgpKTsKICAg\nICAgICBpZiAoc2VxLmdldEluY3JlbWVudCgpID4gMSkKICAgICAgICAgICAg\nYnVmLmFwcGVuZCgiIElOQ1JFTUVOVCBCWSAiKS5hcHBlbmQoc2VxLmdldElu\nY3JlbWVudCgpKTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBidWYu\ndG9TdHJpbmcoKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEg\nc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHNl\ncXVlbmNlLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5EUk9QIFNFUVVFTkNFICZs\ndDtzZXF1ZW5jZSBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BTZXF1ZW5jZVNRTChTZXF1\nZW5jZSBzZXEpIHsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiRFJP\nUCBTRVFVRU5DRSAiICsgZ2V0RnVsbE5hbWUoc2VxKSB9OwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRz\nIHRvIGNyZWF0ZSB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMKICAgICAqIDxj\nb2RlPkNSRUFURSBbVU5JUVVFXSBJTkRFWCAmbHQ7aW5kZXggbmFtZSZndDsg\nT04gJmx0O3RhYmxlIG5hbWUmZ3Q7CiAgICAgKiAoJmx0O2NvbCBsaXN0Jmd0\nOyk8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmdbXSBnZXRDcmVhdGVJbmRleFNRTChJbmRleCBpbmRleCkgewogICAgICAg\nIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAg\nICAgYnVmLmFwcGVuZCgiQ1JFQVRFICIpOwogICAgICAgIGlmIChpbmRleC5p\nc1VuaXF1ZSgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJVTklRVUUgIik7\nCiAgICAgICAgYnVmLmFwcGVuZCgiSU5ERVggIikuYXBwZW5kKGluZGV4Lmdl\ndE5hbWUoKSk7CgogICAgICAgIGJ1Zi5hcHBlbmQoIiBPTiAiKS5hcHBlbmQo\nZ2V0RnVsbE5hbWUoaW5kZXguZ2V0VGFibGUoKSwgZmFsc2UpKTsKICAgICAg\nICBidWYuYXBwZW5kKCIgKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4oaW5kZXgu\nZ2V0Q29sdW1ucygpLCAiLCAiKSkuCiAgICAgICAgICAgIGFwcGVuZCgiKSIp\nOwoKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyBidWYudG9TdHJpbmco\nKSB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGluZGV4LiBSZXR1\ncm5zCiAgICAgKiA8Y29kZT5EUk9QIElOREVYICZsdDtpbmRleCBuYW1lJmd0\nOzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmlu\nZ1tdIGdldERyb3BJbmRleFNRTChJbmRleCBpbmRleCkgewogICAgICAgIHJl\ndHVybiBuZXcgU3RyaW5nW117ICJEUk9QIElOREVYICIgKyBnZXRGdWxsTmFt\nZShpbmRleCkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNl\ncmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBhZGQgdGhlIGdpdmVuIGNvbHVt\nbiB0bwogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkg\naWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuIFJldHVybnMKICAgICAqIDxj\nb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBBREQgKCZsdDtj\nb2wgZGVjJmd0Oyk8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAgICov\nCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkQ29sdW1uU1FMKENvbHVtbiBj\nb2x1bW4pIHsKICAgICAgICBpZiAoIXN1cHBvcnRzQWx0ZXJUYWJsZVdpdGhB\nZGRDb2x1bW4pCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwoK\nICAgICAgICBTdHJpbmcgZGVjID0gZ2V0RGVjbGFyZUNvbHVtblNRTChjb2x1\nbW4sIHRydWUpOwogICAgICAgIGlmIChkZWMgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBnZXRGdWxs\nTmFtZShjb2x1bW4uZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiArIGRl\nYyB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIGNvbHVtbiBmcm9t\nCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBpZiBv\ncGVyYXRpb24gbm90IHN1cHBvcnRlZC4gUmV0dXJucwogICAgICogPGNvZGU+\nQUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IERST1AgQ09MVU1OICZs\ndDtjb2wgbmFtZSZndDs8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcENvbHVtblNRTChDb2x1\nbW4gY29sdW1uKSB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0FsdGVyVGFibGVX\naXRoRHJvcENvbHVtbikKICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdb\nMF07CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxF\nICIKICAgICAgICAgICAgKyBnZXRGdWxsTmFtZShjb2x1bW4uZ2V0VGFibGUo\nKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTFVNTiAiICsgY29s\ndW1uIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMg\nb2YgU1FMIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZlbiBwcmltYXJ5IGtl\neSB0bwogICAgICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkg\naWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxj\nb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBBREQKICAgICAq\nICZsdDtwayBjb25zIHNxbCAmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0QWRkUHJpbWFyeUtleVNRTChQ\ncmltYXJ5S2V5IHBrKSB7CiAgICAgICAgU3RyaW5nIHBrc3FsID0gZ2V0UHJp\nbWFyeUtleUNvbnN0cmFpbnRTUUwocGspOwogICAgICAgIGlmIChwa3NxbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKICAg\nICAgICByZXR1cm4gbmV3IFN0cmluZ1tdeyAiQUxURVIgVEFCTEUgIgogICAg\nICAgICAgICArIGdldEZ1bGxOYW1lKHBrLmdldFRhYmxlKCksIGZhbHNlKSAr\nICIgQUREICIgKyBwa3NxbCB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdp\ndmVuIHByaW1hcnkga2V5IGZyb20KICAgICAqIGl0cyB0YWJsZS4gUmV0dXJu\nIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlvbiBub3Qgc3VwcG9ydGVkLgog\nICAgICogUmV0dXJucyA8Y29kZT5BTFRFUiBUQUJMRSAmbHQ7dGFibGUgbmFt\nZSZndDsgRFJPUCBDT05TVFJBSU5UCiAgICAgKiAmbHQ7cGsgbmFtZSZndDs8\nL2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXREcm9wUHJpbWFyeUtleVNRTChQcmltYXJ5S2V5IHBrKSB7CiAgICAg\nICAgaWYgKHBrLmdldE5hbWUoKSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbmV3IFN0cmluZ1swXTsKICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1td\neyAiQUxURVIgVEFCTEUgIgogICAgICAgICAgICArIGdldEZ1bGxOYW1lKHBr\nLmdldFRhYmxlKCksIGZhbHNlKQogICAgICAgICAgICArICIgRFJPUCBDT05T\nVFJBSU5UICIgKyBway5nZXROYW1lKCkgfTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVtZW50cyB0byBhZGQg\ndGhlIGdpdmVuIGZvcmVpZ24ga2V5IHRvCiAgICAgKiBpdHMgdGFibGUuIFJl\ndHVybiBhbiBlbXB0eSBhcnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRl\nZC4KICAgICAqIFJldHVybnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxl\nIG5hbWUmZ3Q7IEFERAogICAgICogJmx0O2ZrIGNvbnMgc3FsICZndDs8L2Nv\nZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBn\nZXRBZGRGb3JlaWduS2V5U1FMKEZvcmVpZ25LZXkgZmspIHsKICAgICAgICBT\ndHJpbmcgZmtTUUwgPSBnZXRGb3JlaWduS2V5Q29uc3RyYWludFNRTChmayk7\nCiAgICAgICAgaWYgKGZrU1FMID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117\nICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoZmsu\nZ2V0VGFibGUoKSwgZmFsc2UpICsgIiBBREQgIiArIGZrU1FMIH07CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRl\nbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgZnJvbQogICAg\nICogaXRzIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0\naW9uIG5vdCBzdXBwb3J0ZWQuCiAgICAgKiBSZXR1cm5zIDxjb2RlPkFMVEVS\nIFRBQkxFICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTlNUUkFJTlQKICAg\nICAqICZsdDtmayBuYW1lJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAq\nLwogICAgcHVibGljIFN0cmluZ1tdIGdldERyb3BGb3JlaWduS2V5U1FMKEZv\ncmVpZ25LZXkgZmspIHsKICAgICAgICBpZiAoZmsuZ2V0TmFtZSgpID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAg\nICAgICsgZ2V0RnVsbE5hbWUoZmsuZ2V0VGFibGUoKSwgZmFsc2UpCiAgICAg\nICAgICAgICsgIiBEUk9QIENPTlNUUkFJTlQgIiArIGZrLmdldE5hbWUoKSB9\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBkZWNsYXJhdGlv\nbiBTUUwgZm9yIHRoZSBnaXZlbiBjb2x1bW4uIFRoaXMgbWV0aG9kIGlzIHVz\nZWQKICAgICAqIGZvciBlYWNoIGNvbHVtbiBmcm9tIHdpdGhpbiB7QGxpbmsg\nI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQKICAgICAqIHtAbGluayAjZ2V0QWRk\nQ29sdW1uU1FMfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRE\nZWNsYXJlQ29sdW1uU1FMKENvbHVtbiBjb2wsIGJvb2xlYW4gYWx0ZXIpIHsK\nICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoY29sKS5hcHBlbmQoIiAiKTsKICAgICAg\nICBidWYuYXBwZW5kKGdldFR5cGVOYW1lKGNvbCkpOwoKICAgICAgICAvLyBj\nYW4ndCBhZGQgY29uc3RyYWludHMgdG8gYSBjb2x1bW4gd2UncmUgYWRkaW5n\nIGFmdGVyIHRhYmxlCiAgICAgICAgLy8gY3JlYXRpb24sIGNhdXNlIHNvbWUg\nZGF0YSBtaWdodCBhbHJlYWR5IGJlIGluc2VydGVkCiAgICAgICAgaWYgKCFh\nbHRlcikgewogICAgICAgICAgICBpZiAoY29sLmdldERlZmF1bHRTdHJpbmco\nKSAhPSBudWxsICYmICFjb2wuaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBERUZBVUxUICIpLmFwcGVuZChjb2wuZ2V0\nRGVmYXVsdFN0cmluZygpKTsKICAgICAgICAgICAgaWYgKGNvbC5pc05vdE51\nbGwoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBOT1QgTlVMTCIp\nOwogICAgICAgIH0KICAgICAgICBpZiAoY29sLmlzQXV0b0Fzc2lnbmVkKCkp\nIHsKICAgICAgICAgICAgaWYgKCFzdXBwb3J0c0F1dG9Bc3NpZ24pCiAgICAg\nICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC1hdXRvYXNz\naWduIiwgcGxhdGZvcm0sIGNvbCkpOwogICAgICAgICAgICBlbHNlIGlmIChh\ndXRvQXNzaWduQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCIgIikuYXBwZW5kKGF1dG9Bc3NpZ25DbGF1c2UpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhl\nIGdpdmVuIHByaW1hcnkga2V5LiBUaGlzIG1ldGhvZCBpcwogICAgICogdXNl\nZCBmcm9tIHdpdGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQK\nICAgICAqIHtAbGluayAjZ2V0QWRkUHJpbWFyeUtleVNRTH0uIFJldHVybnMK\nICAgICAqIDxjb2RlPkNPTlNUUkFJTlQgJmx0O3BrIG5hbWUmZ3Q7IFBSSU1B\nUlkgS0VZICgmbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4KICAgICAqIGJ5IGRl\nZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0UHJpbWFy\neUtleUNvbnN0cmFpbnRTUUwoUHJpbWFyeUtleSBwaykgewogICAgICAgIC8v\nIGlmIHdlIGhhdmUgZGlzYWJsZWQgdGhlIGNyZWF0aW9uIG9mIHByaW1hcnkg\na2V5cywgYWJvcnQgaGVyZQogICAgICAgIGlmICghY3JlYXRlUHJpbWFyeUtl\neXMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcg\nbmFtZSA9IHBrLmdldE5hbWUoKTsKICAgICAgICBpZiAobmFtZSAhPSBudWxs\nICYmIHJlc2VydmVkV29yZFNldC5jb250YWlucyhuYW1lLnRvVXBwZXJDYXNl\nKCkpKQogICAgICAgICAgICBuYW1lID0gbnVsbDsKCiAgICAgICAgU3RyaW5n\nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAo\nbmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9CRUZPUkUuZXF1YWxzKGNvbnN0\ncmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNPTlNU\nUkFJTlQgIikuYXBwZW5kKG5hbWUpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1\nZi5hcHBlbmQoIlBSSU1BUlkgS0VZICIpOwogICAgICAgIGlmIChuYW1lICE9\nIG51bGwgJiYgQ09OU19OQU1FX01JRC5lcXVhbHMoY29uc3RyYWludE5hbWVN\nb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZChuYW1lKS5hcHBlbmQoIiAi\nKTsKICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBwZW5kKFN0cmluZ3Muam9p\nbihway5nZXRDb2x1bW5zKCksICIsICIpKS4KICAgICAgICAgICAgYXBwZW5k\nKCIpIik7CiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBDT05TX05BTUVf\nQUZURVIuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5UICIpLmFwcGVuZChuYW1lKTsKICAg\nICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdpdmVu\nIGZvcmVpZ24ga2V5LCBvciBudWxsIGlmIGl0IGlzCiAgICAgKiBub3Qgc3Vw\ncG9ydGVkLiBUaGlzIG1ldGhvZCBpcyB1c2VkIGZyb20gd2l0aGluCiAgICAg\nKiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQge0BsaW5rICNnZXRB\nZGRGb3JlaWduS2V5U1FMfS4gUmV0dXJucwogICAgICogPGNvZGU+Q09OU1RS\nQUlOVCAmbHQ7Y29ucyBuYW1lJmd0OyBGT1JFSUdOIEtFWSAoJmx0O2NvbCBs\naXN0Jmd0OykKICAgICAqIFJFRkVSRU5DRVMgJmx0O2ZvcmVpZ24gdGFibGUm\nZ3Q7ICgmbHQ7Y29sIGxpc3QmZ3Q7KQogICAgICogW09OIERFTEVURSAmbHQ7\nYWN0aW9uJmd0O10gW09OIFVQREFURSAmbHQ7YWN0aW9uJmd0O108L2NvZGU+\nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nRm9yZWlnbktleUNvbnN0cmFpbnRTUUwoRm9yZWlnbktleSBmaykgewogICAg\nICAgIGlmICghc3VwcG9ydHNGb3JlaWduS2V5cykKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgaWYgKGZrLmdldERlbGV0ZUFjdGlvbigpID09\nIEZvcmVpZ25LZXkuQUNUSU9OX05PTkUpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgIGlmIChmay5pc0RlZmVycmVkKCkgJiYgIXN1cHBvcnRz\nRGVmZXJyZWRGb3JlaWduS2V5Q29uc3RyYWludHMoKSkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFzdXBwb3J0c0RlbGV0ZUFjdGlv\nbihmay5nZXREZWxldGVBY3Rpb24oKSkKICAgICAgICAgICAgfHwgIXN1cHBv\ncnRzVXBkYXRlQWN0aW9uKGZrLmdldFVwZGF0ZUFjdGlvbigpKSkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENvbHVtbltdIGxvY2FscyA9\nIGZrLmdldENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBmb3JlaWducyA9\nIGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CgogICAgICAgIGludCBkZWxB\nY3Rpb25JZCA9IGZrLmdldERlbGV0ZUFjdGlvbigpOwogICAgICAgIGlmIChk\nZWxBY3Rpb25JZCA9PSBGb3JlaWduS2V5LkFDVElPTl9OVUxMKSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbG9jYWxzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAobG9jYWxzW2ldLmlzTm90TnVsbCgp\nKQogICAgICAgICAgICAgICAgICAgIGRlbEFjdGlvbklkID0gRm9yZWlnbktl\neS5BQ1RJT05fTk9ORTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgU3RyaW5nIGRlbEFjdGlvbiA9IGdldEFjdGlvbk5hbWUoZGVsQWN0aW9u\nSWQpOwogICAgICAgIFN0cmluZyB1cEFjdGlvbiA9IGdldEFjdGlvbk5hbWUo\nZmsuZ2V0VXBkYXRlQWN0aW9uKCkpOwoKICAgICAgICBTdHJpbmdCdWZmZXIg\nYnVmID0gbmV3IFN0cmluZ0J1ZmZlcigpOwogICAgICAgIGlmIChmay5nZXRO\nYW1lKCkgIT0gbnVsbAogICAgICAgICAgICAmJiBDT05TX05BTUVfQkVGT1JF\nLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZChmay5nZXROYW1lKCkpLmFw\ncGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIkZPUkVJR04gS0VZICIp\nOwogICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbCAmJiBDT05TX05B\nTUVfTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKGZrLmdldE5hbWUoKSkuYXBwZW5kKCIgIik7CiAgICAg\nICAgYnVmLmFwcGVuZCgiKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4obG9jYWxz\nLCAiLCAiKSkuYXBwZW5kKCIpIik7CiAgICAgICAgYnVmLmFwcGVuZCgiIFJF\nRkVSRU5DRVMgIik7CiAgICAgICAgYnVmLmFwcGVuZChnZXRGdWxsTmFtZShm\nb3JlaWduc1swXS5nZXRUYWJsZSgpLCBmYWxzZSkpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIiAoIikuYXBwZW5kKFN0cmluZ3Muam9pbihmb3JlaWducywgIiwg\nIikpLmFwcGVuZCgiKSIpOwogICAgICAgIGlmIChkZWxBY3Rpb24gIT0gbnVs\nbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9OIERFTEVURSAiKS5hcHBl\nbmQoZGVsQWN0aW9uKTsKICAgICAgICBpZiAodXBBY3Rpb24gIT0gbnVsbCkK\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIE9OIFVQREFURSAiKS5hcHBlbmQo\ndXBBY3Rpb24pOwogICAgICAgIGlmIChmay5pc0RlZmVycmVkKCkpCiAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQoIiBJTklUSUFMTFkgREVGRVJSRUQiKTsKICAg\nICAgICBpZiAoc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25LZXlDb25zdHJhaW50\ncygpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgREVGRVJSQUJMRSIpOwog\nICAgICAgIGlmIChmay5nZXROYW1lKCkgIT0gbnVsbAogICAgICAgICAgICAm\nJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5UICIpLmFwcGVu\nZChmay5nZXROYW1lKCkpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Igbm90IHRoaXMg\nZGljdGlvbmFyeSBzdXBwb3J0cyBkZWZlcnJlZCBmb3JlaWduIGtleSBjb25z\ndHJhaW50cy4KICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB7\nQGxpbmsgI3N1cHBvcnRzVW5pcXVlQ29uc3RyYWludHN9LgogICAgICoKICAg\nICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVh\nbiBzdXBwb3J0c0RlZmVycmVkRm9yZWlnbktleUNvbnN0cmFpbnRzKCkgewog\nICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIGdp\ndmVuIGZvcmVpZ24ga2V5IGFjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBT\ndHJpbmcgZ2V0QWN0aW9uTmFtZShpbnQgYWN0aW9uKSB7CiAgICAgICAgc3dp\ndGNoIChhY3Rpb24pIHsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFD\nVElPTl9DQVNDQURFOgogICAgICAgICAgICAgICAgcmV0dXJuICJDQVNDQURF\nIjsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9OVUxMOgog\nICAgICAgICAgICAgICAgcmV0dXJuICJTRVQgTlVMTCI7CiAgICAgICAgICAg\nIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAg\nICAgIHJldHVybiAiU0VUIERFRkFVTFQiOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIGRhdGFiYXNlIHN1cHBv\ncnRzIHRoZSBnaXZlbiBmb3JlaWduIGtleSBkZWxldGUgYWN0aW9uLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RlbGV0ZUFjdGlvbihp\nbnQgYWN0aW9uKSB7CiAgICAgICAgaWYgKGFjdGlvbiA9PSBGb3JlaWduS2V5\nLkFDVElPTl9OT05FKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICBpZiAoIXN1cHBvcnRzRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAg\nICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX1JFU1RSSUNUOgogICAgICAgICAg\nICAgICAgcmV0dXJuIHN1cHBvcnRzUmVzdHJpY3REZWxldGVBY3Rpb247CiAg\nICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAg\nICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0Nhc2NhZGVEZWxldGVBY3Rp\nb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoK\nICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c051bGxEZWxldGVBY3Rp\nb247CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVM\nVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmF1bHREZWxl\ndGVBY3Rpb247CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0aGlzIGRhdGFiYXNlIHN1cHBvcnRzIHRoZSBnaXZlbiBm\nb3JlaWduIGtleSB1cGRhdGUgYWN0aW9uLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c1VwZGF0ZUFjdGlvbihpbnQgYWN0aW9uKSB7CiAg\nICAgICAgaWYgKGFjdGlvbiA9PSBGb3JlaWduS2V5LkFDVElPTl9OT05FKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIXN1cHBvcnRz\nRm9yZWlnbktleXMpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgICBjYXNlIEZvcmVpZ25L\nZXkuQUNUSU9OX1JFU1RSSUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN1\ncHBvcnRzUmVzdHJpY3RVcGRhdGVBY3Rpb247CiAgICAgICAgICAgIGNhc2Ug\nRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAgIHJl\ndHVybiBzdXBwb3J0c0Nhc2NhZGVVcGRhdGVBY3Rpb247CiAgICAgICAgICAg\nIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAg\nIHJldHVybiBzdXBwb3J0c051bGxVcGRhdGVBY3Rpb247CiAgICAgICAgICAg\nIGNhc2UgRm9yZWlnbktleS5BQ1RJT05fREVGQVVMVDoKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBwb3J0c0RlZmF1bHRVcGRhdGVBY3Rpb247CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBk\nZWNsYXJhdGlvbiBTUUwgZm9yIHRoZSBnaXZlbiB1bmlxdWUgY29uc3RyYWlu\ndC4gVGhpcwogICAgICogbWV0aG9kIGlzIHVzZWQgZnJvbSB3aXRoaW4ge0Bs\naW5rICNnZXRDcmVhdGVUYWJsZVNRTH0uCiAgICAgKiBSZXR1cm5zCTxjb2Rl\nPkNPTlNUUkFJTlQgJmx0O25hbWUmZ3Q7IFVOSVFVRSAoJmx0O2NvbCBsaXN0\nJmd0Oyk8L2NvZGU+CiAgICAgKiBieSBkZWZhdWx0LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nIGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwoVW5pcXVl\nIHVucSkgewogICAgICAgIGlmICghc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50\ncwogICAgICAgICAgICB8fCAodW5xLmlzRGVmZXJyZWQoKSAmJiAhc3VwcG9y\ndHNEZWZlcnJlZFVuaXF1ZUNvbnN0cmFpbnRzKCkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBT\ndHJpbmdCdWZmZXIoKTsKICAgICAgICBpZiAodW5xLmdldE5hbWUoKSAhPSBu\ndWxsCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9CRUZPUkUuZXF1YWxzKGNv\nbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIkNP\nTlNUUkFJTlQgIikuYXBwZW5kKHVucS5nZXROYW1lKCkpLmFwcGVuZCgiICIp\nOwogICAgICAgIGJ1Zi5hcHBlbmQoIlVOSVFVRSAiKTsKICAgICAgICBpZiAo\ndW5xLmdldE5hbWUoKSAhPSBudWxsICYmIENPTlNfTkFNRV9NSUQuZXF1YWxz\nKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\ndW5xLmdldE5hbWUoKSkuYXBwZW5kKCIgIik7CiAgICAgICAgYnVmLmFwcGVu\nZCgiKCIpLmFwcGVuZChTdHJpbmdzLmpvaW4odW5xLmdldENvbHVtbnMoKSwg\nIiwgIikpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsKICAgICAgICBpZiAo\ndW5xLmlzRGVmZXJyZWQoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElO\nSVRJQUxMWSBERUZFUlJFRCIpOwogICAgICAgIGlmIChzdXBwb3J0c0RlZmVy\ncmVkVW5pcXVlQ29uc3RyYWludHMoKSkKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAodW5xLmdldE5hbWUoKSAh\nPSBudWxsCiAgICAgICAgICAgICYmIENPTlNfTkFNRV9BRlRFUi5lcXVhbHMo\nY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nIENPTlNUUkFJTlQgIikuYXBwZW5kKHVucS5nZXROYW1lKCkpOwogICAgICAg\nIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgb3Igbm90IHRoaXMgZGljdGlvbmFyeSBzdXBwb3J0cyBkZWZl\ncnJlZCB1bmlxdWUgY29uc3RyYWludHMuCiAgICAgKiBUaGlzIGltcGxlbWVu\ndGF0aW9uIHJldHVybnMge0BsaW5rICNzdXBwb3J0c1VuaXF1ZUNvbnN0cmFp\nbnRzfS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZFVuaXF1ZUNvbnN0\ncmFpbnRzKCkgewogICAgICAgIHJldHVybiBzdXBwb3J0c0RlZmVycmVkQ29u\nc3RyYWludHM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBEYXRhYmFzZSBtZXRhZGF0YQogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGZp\nbHRlciBzeXN0ZW0gdGFibGVzIGZyb20gZGF0YWJhc2UgbWV0YWRhdGEuCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gdGFibGUgbmFtZSByZXBy\nZXNlbnRzIGEgc3lzdGVtIHRhYmxlIHRoYXQKICAgICAqIHNob3VsZCBub3Qg\nYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gQnkgZGVmYXVsdCwg\ncmV0dXJucwogICAgICogdHJ1ZSBvbmx5IGlmIHRoZSBnaXZlbiB0YWJsZSBp\ncyBpbiB0aGUgaW50ZXJuYWwgbGlzdCBvZiBzeXN0ZW0gdGFibGVzLAogICAg\nICogb3IgaWYgdGhlIGdpdmVuIHNjaGVtYSBpcyBpbiB0aGUgbGlzdCBvZiBz\neXN0ZW0gc2NoZW1hcyBhbmQgaXMgbm90CiAgICAgKiB0aGUgdGFyZ2V0IHNj\naGVtYS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUgbmFt\nZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2NoZW1hOyBtYXkg\nYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBpZiB0cnVlLCB0\naGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQogICAgICogdGhl\nIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGlzU3lzdGVtVGFibGUoU3RyaW5nIG5hbWUsIFN0cmluZyBz\nY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAgICAg\nICBpZiAoc3lzdGVtVGFibGVTZXQuY29udGFpbnMobmFtZS50b1VwcGVyQ2Fz\nZSgpKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJu\nICF0YXJnZXRTY2hlbWEgJiYgc2NoZW1hICE9IG51bGwKICAgICAgICAgICAg\nJiYgc3lzdGVtU2NoZW1hU2V0LmNvbnRhaW5zKHNjaGVtYS50b1VwcGVyQ2Fz\nZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHVz\nZWQgdG8gZmlsdGVyIHN5c3RlbSBpbmRleGVzIGZyb20gZGF0YWJhc2UgbWV0\nYWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gaW5kZXgg\nbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIGluZGV4IHRoYXQKICAgICAqIHNo\nb3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4gUmV0\ndXJucyBmYWxzZSBieSBkZWZhdWx0LgogICAgICoKICAgICAqIEBwYXJhbSBu\nYW1lIHRoZSBpbmRleCBuYW1lCiAgICAgKiBAcGFyYW0gdGFibGUgdGhlIGlu\nZGV4IHRhYmxlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVt\nSW5kZXgoU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2Qg\naXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHNlcXVlbmNlcyBmcm9tIGRhdGFi\nYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVu\nIHNlcXVlbmNlIHJlcHJlc2VudHMgYSBzeXN0ZW0gc2VxdWVuY2UgdGhhdAog\nICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBkZWZpbml0\naW9uLiBSZXR1cm5zIHRydWUgaWYgc3lzdGVtCiAgICAgKiBzY2hlbWEgYnkg\nZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUgdGFibGUg\nbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2NoZW1hOyBt\nYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBpZiB0cnVl\nLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQogICAgICog\ndGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3RyaW5nIG5hbWUsIFN0\ncmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsK\nICAgICAgICByZXR1cm4gIXRhcmdldFNjaGVtYSAmJiBzY2hlbWEgIT0gbnVs\nbAogICAgICAgICAgICAmJiBzeXN0ZW1TY2hlbWFTZXQuY29udGFpbnMoc2No\nZW1hLnRvVXBwZXJDYXNlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmVm\nbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgdGFibGVzIG1hdGNoaW5nIHRo\nZSBnaXZlbiBuYW1lIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBUYWJs\nZVtdIGdldFRhYmxlcyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBj\nYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFi\nbGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NjaGVtYUZvckdldFRh\nYmxlcykKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzY2hlbWFOYW1lID0gZ2V0U2NoZW1hTmFtZUZv\nck1ldGFkYXRhKHNjaGVtYU5hbWUpOwoKICAgICAgICBTdHJpbmdbXSB0eXBl\ncyA9IFN0cmluZ3Muc3BsaXQodGFibGVUeXBlcywgIiwiLCAwKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICB0eXBlc1tpXSA9IHR5cGVzW2ldLnRyaW0oKTsKCiAgICAgICAg\nYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0\nU2V0IHRhYmxlcyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ndGFibGVzID0gbWV0YS5nZXRUYWJsZXMoZ2V0Q2F0YWxvZ05hbWVGb3JNZXRh\nZGF0YShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUsIGdl\ndFRhYmxlTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSksIHR5cGVzKTsKICAg\nICAgICAgICAgTGlzdCB0YWJsZUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAg\nICAgICAgICAgIHdoaWxlICh0YWJsZXMgIT0gbnVsbCAmJiB0YWJsZXMubmV4\ndCgpKQogICAgICAgICAgICAgICAgdGFibGVMaXN0LmFkZChuZXdUYWJsZSh0\nYWJsZXMpKTsKICAgICAgICAgICAgcmV0dXJuIChUYWJsZVtdKSB0YWJsZUxp\nc3QudG9BcnJheShuZXcgVGFibGVbdGFibGVMaXN0LnNpemUoKV0pOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmICh0YWJsZXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\ndGFibGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB0YWJsZSBmcm9tIHRoZSBp\nbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgVGFibGUgbmV3VGFibGUoUmVzdWx0U2V0IHRhYmxlTWV0\nYSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBUYWJs\nZSB0ID0gbmV3IFRhYmxlKCk7CiAgICAgICAgdC5zZXROYW1lKHRhYmxlTWV0\nYS5nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSk7CiAgICAgICAgcmV0dXJuIHQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEg\ndG8gZmluZCBzZXF1ZW5jZXMgbWF0Y2hpbmcgdGhlIGdpdmVuIG5hbWUgcGF0\ndGVybi4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgYXJyYXkgYnkgZGVmYXVs\ndCwgYXMgdGhlcmUgaXMgbm8gc3RhbmRhcmQgd2F5IHRvCiAgICAgKiByZXRy\naWV2ZSBhIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAgICovCiAgICBwdWJsaWMg\nU2VxdWVuY2VbXSBnZXRTZXF1ZW5jZXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwg\nU3RyaW5nIHNlcXVlbmNlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBzdHIgPSBn\nZXRTZXF1ZW5jZXNTUUwoc2NoZW1hTmFtZSwgc2VxdWVuY2VOYW1lKTsKICAg\nICAgICBpZiAoc3RyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcg\nU2VxdWVuY2VbMF07CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBzdHIpOyAgICAgICAgCiAgICAg\nICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHN0bW50LnNldFN0cmluZyhpZHgr\nKywgc2NoZW1hTmFtZS50b1VwcGVyQ2FzZSgpKTsKICAgICAgICAgICAgaWYg\nKHNlcXVlbmNlTmFtZSAhPSBudWxsKQogICAgICAgICAgICAgICAgc3RtbnQu\nc2V0U3RyaW5nKGlkeCsrLCBzZXF1ZW5jZU5hbWUpOwoKICAgICAgICAgICAg\ncnMgPSBleGVjdXRlUXVlcnkoY29ubiwgc3RtbnQsIHN0cik7CiAgICAgICAg\nICAgIHJldHVybiBnZXRTZXF1ZW5jZShycyk7ICAgICAgICAgICAgCiAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5j\nbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdG1u\ndCAhPSBudWxsKSAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBz\nZXF1ZW5jZSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1l\ndGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgU2VxdWVuY2UgbmV3U2Vx\ndWVuY2UoUmVzdWx0U2V0IHNlcXVlbmNlTWV0YSkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBTZXF1ZW5jZSBzZXEgPSBuZXcgU2Vx\ndWVuY2UoKTsKICAgICAgICBzZXEuc2V0U2NoZW1hTmFtZShzZXF1ZW5jZU1l\ndGEuZ2V0U3RyaW5nKCJTRVFVRU5DRV9TQ0hFTUEiKSk7CiAgICAgICAgc2Vx\nLnNldE5hbWUoc2VxdWVuY2VNZXRhLmdldFN0cmluZygiU0VRVUVOQ0VfTkFN\nRSIpKTsKICAgICAgICByZXR1cm4gc2VxOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBTUUwgbmVlZGVkIHRvIHNlbGVjdCB0aGUgbGlzdCBv\nZiBzZXF1ZW5jZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nU2VxdWVuY2VzU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVu\nY2VOYW1lKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBjb2x1bW5z\nIG1hdGNoaW5nIHRoZSBnaXZlbiB0YWJsZSBhbmQKICAgICAqIGNvbHVtbiBw\nYXR0ZXJucy4KICAgICAqLwogICAgcHVibGljIENvbHVtbltdIGdldENvbHVt\nbnMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAg\nICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3Ry\naW5nIGNvbHVtbk5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51\nbGwgJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0Q29sdW1ucykKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGlmICghc3VwcG9ydHNTY2hl\nbWFGb3JHZXRDb2x1bW5zKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gbnVs\nbDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBnZXRT\nY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSk7CgogICAgICAgIGJl\nZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNl\ndCBjb2xzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb2xz\nID0gbWV0YS5nZXRDb2x1bW5zKGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEo\nY2F0YWxvZyksCiAgICAgICAgICAgICAgICBzY2hlbWFOYW1lLCBnZXRUYWJs\nZU5hbWVGb3JNZXRhZGF0YSh0YWJsZU5hbWUpLAogICAgICAgICAgICAgICAg\nZ2V0Q29sdW1uTmFtZUZvck1ldGFkYXRhKGNvbHVtbk5hbWUpKTsKCiAgICAg\nICAgICAgIExpc3QgY29sdW1uTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICAgICAgd2hpbGUgKGNvbHMgIT0gbnVsbCAmJiBjb2xzLm5leHQoKSkK\nICAgICAgICAgICAgICAgIGNvbHVtbkxpc3QuYWRkKG5ld0NvbHVtbihjb2xz\nKSk7CiAgICAgICAgICAgIHJldHVybiAoQ29sdW1uW10pIGNvbHVtbkxpc3Qu\ndG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBDb2x1bW5bY29sdW1uTGlz\ndC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAoY29scyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBjb2xzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb2x1\nbW4gZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbHVtbiBuZXdDb2x1bW4oUmVz\ndWx0U2V0IGNvbE1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgQ29sdW1uIGMgPSBuZXcgQ29sdW1uKCk7CiAgICAgICAgYy5z\nZXRTY2hlbWFOYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJUQUJMRV9TQ0hFTSIp\nKTsKICAgICAgICBjLnNldFRhYmxlTmFtZShjb2xNZXRhLmdldFN0cmluZygi\nVEFCTEVfTkFNRSIpKTsKICAgICAgICBjLnNldE5hbWUoY29sTWV0YS5nZXRT\ndHJpbmcoIkNPTFVNTl9OQU1FIikpOwogICAgICAgIGMuc2V0VHlwZShjb2xN\nZXRhLmdldEludCgiREFUQV9UWVBFIikpOwogICAgICAgIGMuc2V0VHlwZU5h\nbWUoY29sTWV0YS5nZXRTdHJpbmcoIlRZUEVfTkFNRSIpKTsKICAgICAgICBj\nLnNldFNpemUoY29sTWV0YS5nZXRJbnQoIkNPTFVNTl9TSVpFIikpOwogICAg\nICAgIGMuc2V0RGVjaW1hbERpZ2l0cyhjb2xNZXRhLmdldEludCgiREVDSU1B\nTF9ESUdJVFMiKSk7CiAgICAgICAgYy5zZXROb3ROdWxsKGNvbE1ldGEuZ2V0\nSW50KCJOVUxMQUJMRSIpCiAgICAgICAgICAgID09IERhdGFiYXNlTWV0YURh\ndGEuY29sdW1uTm9OdWxscyk7CgogICAgICAgIFN0cmluZyBkZWYgPSBjb2xN\nZXRhLmdldFN0cmluZygiQ09MVU1OX0RFRiIpOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShkZWYpICYmICEibnVsbCIuZXF1YWxzSWdub3Jl\nQ2FzZShkZWYpKQogICAgICAgICAgICBjLnNldERlZmF1bHRTdHJpbmcoZGVm\nKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3Ig\ndGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBQ\ncmltYXJ5S2V5W10gZ2V0UHJpbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBt\nZXRhLAogICAgICAgIFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFt\nZSwgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICh1c2VHZXRCZXN0\nUm93SWRlbnRpZmllckZvclByaW1hcnlLZXlzKQogICAgICAgICAgICByZXR1\ncm4gZ2V0UHJpbWFyeUtleXNGcm9tQmVzdFJvd0lkZW50aWZpZXIobWV0YSwg\nY2F0YWxvZywKICAgICAgICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFt\nZSwgY29ubik7CiAgICAgICAgcmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUdl\ndFByaW1hcnlLZXlzKG1ldGEsIGNhdGFsb2csCiAgICAgICAgICAgIHNjaGVt\nYU5hbWUsIHRhYmxlTmFtZSwgY29ubik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBwcmltYXJ5IGtleXMg\nZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwcm90\nZWN0ZWQgUHJpbWFyeUtleVtdIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1h\ncnlLZXlzCiAgICAgICAgKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgU3RyaW5n\nIGNhdGFsb2csIFN0cmluZyBzY2hlbWFOYW1lLAogICAgICAgICAgICBTdHJp\nbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxs\nICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldFByaW1hcnlLZXlzKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFP\ncGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcGtzID0gbWV0YS5nZXRQcmlt\nYXJ5S2V5cyhnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cpLAog\nICAgICAgICAgICAgICAgZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNjaGVt\nYU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0YWRh\ndGEodGFibGVOYW1lKSk7CgogICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5l\ndyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxs\nICYmIHBrcy5uZXh0KCkpCiAgICAgICAgICAgICAgICBwa0xpc3QuYWRkKG5l\nd1ByaW1hcnlLZXkocGtzKSk7CiAgICAgICAgICAgIHJldHVybiAoUHJpbWFy\neUtleVtdKSBwa0xpc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBQ\ncmltYXJ5S2V5W3BrTGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAocGtzICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHBrcy5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBuZXcgcHJpbWFyeSBrZXkgZnJvbSB0aGUgaW5mb3JtYXRpb24gaW4g\ndGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIFBy\naW1hcnlLZXkgbmV3UHJpbWFyeUtleShSZXN1bHRTZXQgcGtNZXRhKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFByaW1hcnlLZXkg\ncGsgPSBuZXcgUHJpbWFyeUtleSgpOwogICAgICAgIHBrLnNldFNjaGVtYU5h\nbWUocGtNZXRhLmdldFN0cmluZygiVEFCTEVfU0NIRU0iKSk7CiAgICAgICAg\ncGsuc2V0VGFibGVOYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlRBQkxFX05BTUUi\nKSk7CiAgICAgICAgcGsuc2V0Q29sdW1uTmFtZShwa01ldGEuZ2V0U3RyaW5n\nKCJDT0xVTU5fTkFNRSIpKTsKICAgICAgICBway5zZXROYW1lKHBrTWV0YS5n\nZXRTdHJpbmcoIlBLX05BTUUiKSk7CiAgICAgICAgcmV0dXJuIHBrOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZp\nbmQgcHJpbWFyeSBrZXlzIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5\nS2V5c0Zyb21CZXN0Um93SWRlbnRpZmllcgogICAgICAgIChEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLCBTdHJpbmcgc2NoZW1hTmFt\nZSwKICAgICAgICAgICAgU3RyaW5nIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBj\nb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nICh0YWJsZU5hbWUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAg\nICAgIFJlc3VsdFNldCBwa3MgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHBrcyA9IG1ldGEuZ2V0QmVzdFJvd0lkZW50aWZpZXIoY2F0YWxv\nZywgc2NoZW1hTmFtZSwKICAgICAgICAgICAgICAgIHRhYmxlTmFtZSwgMCwg\nZmFsc2UpOwoKICAgICAgICAgICAgTGlzdCBwa0xpc3QgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgIHdoaWxlIChwa3MgIT0gbnVsbCAmJiBwa3Mu\nbmV4dCgpKSB7CiAgICAgICAgICAgICAgICBQcmltYXJ5S2V5IHBrID0gbmV3\nIFByaW1hcnlLZXkoKTsKICAgICAgICAgICAgICAgIHBrLnNldFNjaGVtYU5h\nbWUoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgICAgICBway5zZXRUYWJsZU5h\nbWUodGFibGVOYW1lKTsKICAgICAgICAgICAgICAgIHBrLnNldENvbHVtbk5h\nbWUocGtzLmdldFN0cmluZygiQ09MVU1OX05BTUUiKSk7CiAgICAgICAgICAg\nICAgICBwa0xpc3QuYWRkKHBrKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gKFByaW1hcnlLZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChuZXcgUHJpbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHBrcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBw\na3MuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgaW5k\nZXhlcyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAq\nLwogICAgcHVibGljIEluZGV4W10gZ2V0SW5kZXhJbmZvKERhdGFiYXNlTWV0\nYURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5nIHNj\naGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLAog\nICAgICAgIGJvb2xlYW4gYXBwcm94LCBDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFt\nZSA9PSBudWxsICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4SW5m\nbykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1l\ndGFkYXRhT3BlcmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBpbmRl\neGVzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbmRleGVz\nID0gbWV0YS5nZXRJbmRleEluZm8oZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0\nYShjYXRhbG9nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JN\nZXRhZGF0YShzY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxl\nTmFtZUZvck1ldGFkYXRhKHRhYmxlTmFtZSksIHVuaXF1ZSwgYXBwcm94KTsK\nCiAgICAgICAgICAgIExpc3QgaW5kZXhMaXN0ID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICB3aGlsZSAoaW5kZXhlcyAhPSBudWxsICYmIGluZGV4\nZXMubmV4dCgpKQogICAgICAgICAgICAgICAgaW5kZXhMaXN0LmFkZChuZXdJ\nbmRleChpbmRleGVzKSk7CiAgICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkg\naW5kZXhMaXN0LnRvQXJyYXkobmV3IEluZGV4W2luZGV4TGlzdC5zaXplKCld\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoaW5kZXhl\ncyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBpbmRleGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpbmRleCBm\ncm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgSW5kZXggbmV3SW5kZXgoUmVzdWx0U2V0\nIGlkeE1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgSW5kZXggaWR4ID0gbmV3IEluZGV4KCk7CiAgICAgICAgaWR4LnNldFNj\naGVtYU5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIikpOwog\nICAgICAgIGlkeC5zZXRUYWJsZU5hbWUoaWR4TWV0YS5nZXRTdHJpbmcoIlRB\nQkxFX05BTUUiKSk7CiAgICAgICAgaWR4LnNldENvbHVtbk5hbWUoaWR4TWV0\nYS5nZXRTdHJpbmcoIkNPTFVNTl9OQU1FIikpOwogICAgICAgIGlkeC5zZXRO\nYW1lKGlkeE1ldGEuZ2V0U3RyaW5nKCJJTkRFWF9OQU1FIikpOwogICAgICAg\nIGlkeC5zZXRVbmlxdWUoIWlkeE1ldGEuZ2V0Qm9vbGVhbigiTk9OX1VOSVFV\nRSIpKTsKICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8qKgogICAg\nICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIHJldHVybiBmb3JlaWduIGtl\neXMgaW1wb3J0ZWQgYnkgdGhlIGdpdmVuCiAgICAgKiB0YWJsZSBwYXR0ZXJu\nLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVk\nS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAog\nICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwg\nJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW1wb3J0ZWRLZXlzKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFP\ncGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0U2V0IGtleXMgPSBudWxs\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGtleXMgPSBtZXRhLmdldElt\ncG9ydGVkS2V5cyhnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cp\nLAogICAgICAgICAgICAgICAgZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKHNj\naGVtYU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0VGFibGVOYW1lRm9yTWV0\nYWRhdGEodGFibGVOYW1lKSk7CgogICAgICAgICAgICBMaXN0IGltcG9ydGVk\nS2V5TGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUg\nKGtleXMgIT0gbnVsbCAmJiBrZXlzLm5leHQoKSkKICAgICAgICAgICAgICAg\nIGltcG9ydGVkS2V5TGlzdC5hZGQobmV3Rm9yZWlnbktleShrZXlzKSk7CiAg\nICAgICAgICAgIHJldHVybiAoRm9yZWlnbktleVtdKSBpbXBvcnRlZEtleUxp\nc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2lt\ncG9ydGVkS2V5TGlzdC5zaXplKCldKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBpZiAoa2V5cyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBrZXlzLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhIG5ldyBmb3JlaWduIGtleSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0\naGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgRm9y\nZWlnbktleSBuZXdGb3JlaWduS2V5KFJlc3VsdFNldCBma01ldGEpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgRm9yZWlnbktleSBm\nayA9IG5ldyBGb3JlaWduS2V5KCk7CiAgICAgICAgZmsuc2V0U2NoZW1hTmFt\nZShma01ldGEuZ2V0U3RyaW5nKCJGS1RBQkxFX1NDSEVNIikpOwogICAgICAg\nIGZrLnNldFRhYmxlTmFtZShma01ldGEuZ2V0U3RyaW5nKCJGS1RBQkxFX05B\nTUUiKSk7CiAgICAgICAgZmsuc2V0Q29sdW1uTmFtZShma01ldGEuZ2V0U3Ry\naW5nKCJGS0NPTFVNTl9OQU1FIikpOwogICAgICAgIGZrLnNldE5hbWUoZmtN\nZXRhLmdldFN0cmluZygiRktfTkFNRSIpKTsKICAgICAgICBmay5zZXRQcmlt\nYXJ5S2V5U2NoZW1hTmFtZShma01ldGEuZ2V0U3RyaW5nKCJQS1RBQkxFX1ND\nSEVNIikpOwogICAgICAgIGZrLnNldFByaW1hcnlLZXlUYWJsZU5hbWUoZmtN\nZXRhLmdldFN0cmluZygiUEtUQUJMRV9OQU1FIikpOwogICAgICAgIGZrLnNl\ndFByaW1hcnlLZXlDb2x1bW5OYW1lKGZrTWV0YS5nZXRTdHJpbmcoIlBLQ09M\nVU1OX05BTUUiKSk7CiAgICAgICAgZmsuc2V0S2V5U2VxdWVuY2UoZmtNZXRh\nLmdldFNob3J0KCJLRVlfU0VRIikpOwogICAgICAgIGZrLnNldERlZmVycmVk\nKGZrTWV0YS5nZXRTaG9ydCgiREVGRVJSQUJJTElUWSIpCiAgICAgICAgICAg\nID09IERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZl\ncnJlZCk7CgogICAgICAgIGludCBkZWwgPSBma01ldGEuZ2V0U2hvcnQoIkRF\nTEVURV9SVUxFIik7CiAgICAgICAgc3dpdGNoIChkZWwpIHsKICAgICAgICAg\nICAgY2FzZSBEYXRhYmFzZU1ldGFEYXRhLmltcG9ydGVkS2V5U2V0TnVsbDoK\nICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5\nLkFDVElPTl9OVUxMKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBjYXNlIERhdGFiYXNlTWV0YURhdGEuaW1wb3J0ZWRLZXlTZXREZWZh\ndWx0OgogICAgICAgICAgICAgICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVp\nZ25LZXkuQUNUSU9OX0RFRkFVTFQpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtl\neUNhc2NhZGU6CiAgICAgICAgICAgICAgICBmay5zZXREZWxldGVBY3Rpb24o\nRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERSk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGZr\nLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGZrOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdGFi\nbGUgbmFtZSB0aGF0IHdpbGwgYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9y\nbWF0aW9uCiAgICAgKiBmcm9tIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRUYWJsZU5hbWVGb3JN\nZXRhZGF0YShTdHJpbmcgdGFibGVOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNv\nbnZlcnRTY2hlbWFDYXNlKHRhYmxlTmFtZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm5zIHRoZSBzY2hlbWEgbmFtZSB0aGF0IHdpbGwgYmUgdXNl\nZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtAbGlu\nayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0\ncmluZyBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoU3RyaW5nIHNjaGVtYU5h\nbWUpIHsKICAgICAgICBpZiAoc2NoZW1hTmFtZSA9PSBudWxsKQogICAgICAg\nICAgICBzY2hlbWFOYW1lID0gY29uZi5nZXRTY2hlbWEoKTsKICAgICAgICBy\nZXR1cm4gY29udmVydFNjaGVtYUNhc2Uoc2NoZW1hTmFtZSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjYXRhbG9nIG5hbWUgdGhhdCB3\naWxsIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICog\nZnJvbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBTdHJpbmcgZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShTdHJp\nbmcgY2F0YWxvZ05hbWUpIHsKICAgICAgICByZXR1cm4gY29udmVydFNjaGVt\nYUNhc2UoY2F0YWxvZ05hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJucyB0aGUgY29sdW1uIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIG9i\ndGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0YWJh\nc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0\nQ29sdW1uTmFtZUZvck1ldGFkYXRhKFN0cmluZyBjb2x1bW5OYW1lKSB7CiAg\nICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKGNvbHVtbk5hbWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIHNj\naGVtYSBuYW1lIHRvIGEgbmFtZSB0aGF0IHRoZSBkYXRhYmFzZSB3aWxsCiAg\nICAgKiBiZSBhYmxlIHRvIHVuZGVyc3RhbmQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBTdHJpbmcgY29udmVydFNjaGVtYUNhc2UoU3RyaW5nIG9iamVjdE5h\nbWUpIHsKICAgICAgICBpZiAob2JqZWN0TmFtZSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5nIHNjYXNlID0gZ2V0\nU2NoZW1hQ2FzZSgpOwogICAgICAgIGlmIChTQ0hFTUFfQ0FTRV9MT1dFUi5l\ncXVhbHMoc2Nhc2UpKQogICAgICAgICAgICByZXR1cm4gb2JqZWN0TmFtZS50\nb0xvd2VyQ2FzZSgpOwogICAgICAgIGlmIChTQ0hFTUFfQ0FTRV9QUkVTRVJW\nRS5lcXVhbHMoc2Nhc2UpKQogICAgICAgICAgICByZXR1cm4gb2JqZWN0TmFt\nZTsKICAgICAgICByZXR1cm4gb2JqZWN0TmFtZS50b1VwcGVyQ2FzZSgpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiBEQiBzcGVjaWZpYyBz\nY2hlbWFDYXNlIAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNjaGVt\nYUNhc2UoKXsKICAgICAgICByZXR1cm4gc2NoZW1hQ2FzZTsKICAgIH0KICAg\nICAgICAKICAgIC8qKgogICAgICogUHJlcGFyZWQgdGhlIGNvbm5lY3Rpb24g\nZm9yIG1ldGFkYXRhIG9wZXJhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihDb25uZWN0aW9uIGMpIHsK\nICAgICAgICBpZiAocmVxdWlyZXNBdXRvQ29tbWl0Rm9yTWV0YURhdGEpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGMucm9sbGJhY2so\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNxbGUpIHsK\nICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgaWYgKCFjLmdldEF1dG9Db21taXQoKSkKICAgICAgICAgICAgICAgICAg\nICBjLnNldEF1dG9Db21taXQodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIFNlcXVlbmNlcyBhbmQgQXV0by1Bc3NpZ24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGxhc3QgZ2VuZXJhdGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgog\nICAgICogVGhyb3dzIGFuIGV4Y2VwdGlvbiBieSBkZWZhdWx0IGlmIHtAbGlu\nayAjbGFzdEdlbmVyYXRlZEtleVF1ZXJ5fSBpcyBudWxsLgogICAgICovCiAg\nICBwdWJsaWMgT2JqZWN0IGdldEdlbmVyYXRlZEtleShDb2x1bW4gY29sLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKGxhc3RHZW5lcmF0ZWRLZXlRdWVyeSA9PSBudWxsKQog\nICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLWF1dG8tYXNzaWduIikpOwoKICAgICAgICAvLyByZXBsYWNlIHRoaW5n\ncyBsaWtlICJTRUxFQ1QgTUFYKHswfSkgRlJPTSB7MX0iCiAgICAgICAgU3Ry\naW5nIHF1ZXJ5ID0gbGFzdEdlbmVyYXRlZEtleVF1ZXJ5OwogICAgICAgIGlm\nIChxdWVyeS5pbmRleE9mKCd7JykgIT0gLTEpIC8vIG9ubHkgaWYgdGhlIHRv\na2VuIGlzIGluIHRoZSBzdHJpbmcKICAgICAgICB7CiAgICAgICAgICAgIHF1\nZXJ5ID0gTWVzc2FnZUZvcm1hdC5mb3JtYXQocXVlcnksIG5ldyBPYmplY3Rb\nXXsKICAgICAgICAgICAgICAgIGNvbC5nZXROYW1lKCksIGdldEZ1bGxOYW1l\nKGNvbC5nZXRUYWJsZSgpLCBmYWxzZSksCiAgICAgICAgICAgICAgICBnZXRH\nZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKSwKICAgICAgICAgICAgfSk7\nCiAgICAgICAgfQoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9\nIHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgcXVlcnkpOwogICAgICAgIFJlc3Vs\ndFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcnMg\nPSBleGVjdXRlUXVlcnkoY29ubiwgc3RtbnQsIHF1ZXJ5KTsKICAgICAgICAg\nICAgcmV0dXJuIGdldEtleShycywgY29sKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7IHJzLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\ne30KICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpICAgIAogICAgICAg\nICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhj\nZXB0aW9uIHNlKSB7fSAKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHNlcXVlbmNlIG5hbWUgdXNlZCBieSBkYXRhYmFzZXMg\nZm9yIHRoZSBnaXZlbiBhdXRvYXNzaWduZWQKICAgICAqIGNvbHVtbi4gVGhp\ncyBpcyBvbmx5IHVzZWQgYnkgZGF0YWJhc2VzIHRoYXQgcmVxdWlyZSBhbiBl\neHBsaWNpdCBuYW1lCiAgICAgKiB0byBiZSB1c2VkIGZvciBhdXRvLWFzc2ln\nbiBzdXBwb3J0LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldEdl\nbmVyYXRlZEtleVNlcXVlbmNlTmFtZShDb2x1bW4gY29sKSB7CiAgICAgICAg\nU3RyaW5nIHRuYW1lID0gY29sLmdldFRhYmxlTmFtZSgpOwogICAgICAgIFN0\ncmluZyBjbmFtZSA9IGNvbC5nZXROYW1lKCk7CiAgICAgICAgaW50IG1heCA9\nIG1heEF1dG9Bc3NpZ25OYW1lTGVuZ3RoOwogICAgICAgIGludCBleHRyYUNo\nYXJzID0gLW1heCArIHRuYW1lLmxlbmd0aCgpICsgMSAvLyA8dG5hbWU+ICsg\nJ18nCiAgICAgICAgICAgICsgY25hbWUubGVuZ3RoKCkgKyA0OyAvLyA8Y25h\nbWU+ICsgJ19TRVEnCiAgICAgICAgaWYgKGV4dHJhQ2hhcnMgPiAwKSB7CiAg\nICAgICAgICAgIC8vIHRoaXMgYXNzdW1lcyB0aGF0IHRuYW1lIGlzIGxvbmdl\nciB0aGFuIGV4dHJhQ2hhcnMKICAgICAgICAgICAgdG5hbWUgPSB0bmFtZS5z\ndWJzdHJpbmcoMCwgdG5hbWUubGVuZ3RoKCkgLSBleHRyYUNoYXJzKTsKICAg\nICAgICB9CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdC\ndWZmZXIobWF4KTsKICAgICAgICBidWYuYXBwZW5kKHRuYW1lKS5hcHBlbmQo\nIl8iKS5hcHBlbmQoY25hbWUpLmFwcGVuZCgiX1NFUSIpOwogICAgICAgIHJl\ndHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25maWd1cmFibGUgaW1wbGVt\nZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nCiAgICBwdWJsaWMgdm9pZCBzZXRDb25maWd1cmF0aW9uKENvbmZpZ3VyYXRp\nb24gY29uZikgewogICAgICAgIHRoaXMuY29uZiA9IChKREJDQ29uZmlndXJh\ndGlvbikgY29uZjsKICAgICAgICB0aGlzLmxvZyA9IHRoaXMuY29uZi5nZXRM\nb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pEQkMpOwoKICAgICAgICAvLyB3\nYXJuIGFib3V0IHVuc3VwcG9ydGVkIGRpY3RzCiAgICAgICAgaWYgKGxvZy5p\nc1dhcm5FbmFibGVkKCkgJiYgIWlzU3VwcG9ydGVkKCkpCiAgICAgICAgICAg\nIGxvZy53YXJuKF9sb2MuZ2V0KCJkaWN0LW5vdC1zdXBwb3J0ZWQiLCBnZXRD\nbGFzcygpKSk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzU3VwcG9y\ndGVkKCkgewogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBjdXN0b20gZGljdCwg\ndHJhdmVyc2UgdG8gd2hhdGV2ZXIgb3BlbmpwYSBkaWN0IGl0IGV4dGVuZHMK\nICAgICAgICBDbGFzcyBjID0gZ2V0Q2xhc3MoKTsKICAgICAgICB3aGlsZSAo\nIWMuZ2V0TmFtZSgpLnN0YXJ0c1dpdGgoIm9yZy5hcGFjaGUub3BlbmpwYS4i\nKSkKICAgICAgICAgICAgYyA9IGMuZ2V0U3VwZXJjbGFzcygpOwoKICAgICAg\nICAvLyB0aGUgZ2VuZXJpYyBkYmRpY3Rpb25hcnkgaXMgbm90IGNvbnNpZGVy\nZWQgYSBzdXBwb3J0ZWQgZGljdDsgYWxsCiAgICAgICAgLy8gb3RoZXIgY29u\nY3JldGUgZGljdGlvbmFyaWVzIGFyZQogICAgICAgIGlmIChjID09IERCRGlj\ndGlvbmFyeS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0\nQ29uZmlndXJhdGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHNl\ndCBvZiByZXNlcnZlZCBTUUw5MiB3b3JkcyBmcm9tIHJlc291cmNlCiAgICAg\nICAgSW5wdXRTdHJlYW0gaW4gPSBEQkRpY3Rpb25hcnkuY2xhc3MuZ2V0UmVz\nb3VyY2VBc1N0cmVhbQogICAgICAgICAgICAoInNxbC1rZXl3b3Jkcy5yc3Jj\nIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5nIGtleXdvcmRz\nID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBJbnB1dFN0cmVhbVJlYWRlcihp\nbikpLgogICAgICAgICAgICAgICAgcmVhZExpbmUoKTsKICAgICAgICAgICAg\naW4uY2xvc2UoKTsKICAgICAgICAgICAgcmVzZXJ2ZWRXb3JkU2V0LmFkZEFs\nbChBcnJheXMuYXNMaXN0KFN0cmluZ3Muc3BsaXQKICAgICAgICAgICAgICAg\nIChrZXl3b3JkcywgIiwiLCAwKSkpOwogICAgICAgIH0gY2F0Y2ggKElPRXhj\nZXB0aW9uIGlvZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4\nY2VwdGlvbihpb2UpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHRyeSB7IGluLmNsb3NlKCk7IH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHt9\nCiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgYWRkaXRpb25hbCByZXNlcnZl\nZCB3b3JkcyBzZXQgYnkgdXNlcgogICAgICAgIGlmIChyZXNlcnZlZFdvcmRz\nICE9IG51bGwpCiAgICAgICAgICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwo\nQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAo\ncmVzZXJ2ZWRXb3Jkcy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAg\nICAgIC8vIGFkZCBzeXN0ZW0gc2NoZW1hcyBzZXQgYnkgdXNlcgogICAgICAg\nIGlmIChzeXN0ZW1TY2hlbWFzICE9IG51bGwpCiAgICAgICAgICAgIHN5c3Rl\nbVNjaGVtYVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0\nCiAgICAgICAgICAgICAgICAoc3lzdGVtU2NoZW1hcy50b1VwcGVyQ2FzZSgp\nLCAiLCIsIDApKSk7CgogICAgICAgIC8vIGFkZCBzeXN0ZW0gdGFibGVzIHNl\ndCBieSB1c2VyCiAgICAgICAgaWYgKHN5c3RlbVRhYmxlcyAhPSBudWxsKQog\nICAgICAgICAgICBzeXN0ZW1UYWJsZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoc3lzdGVtVGFibGVz\nLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKCiAgICAgICAgLy8gYWRkIGZp\neGVkIHNpemUgdHlwZSBuYW1lcyBzZXQgYnkgdGhlIHVzZXIKICAgICAgICBp\nZiAoZml4ZWRTaXplVHlwZU5hbWVzICE9IG51bGwpCiAgICAgICAgICAgIGZp\neGVkU2l6ZVR5cGVOYW1lU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KFN0cmlu\nZ3Muc3BsaXQKICAgICAgICAgICAgICAgIChmaXhlZFNpemVUeXBlTmFtZXMu\ndG9VcHBlckNhc2UoKSwgIiwiLCAwKSkpOwogICAgICAgIAogICAgICAgIC8v\nIGlmIHVzZXIgaGFzIHVuc2V0IHNlcXVlbmNlIHNxbCwgbnVsbCBpdCBvdXQg\nc28gd2Uga25vdyBzZXF1ZW5jZXMKICAgICAgICAvLyBhcmVuJ3Qgc3VwcG9y\ndGVkCiAgICAgICAgbmV4dFNlcXVlbmNlUXVlcnkgPSBTdHJpbmdVdGlscy50\ncmltVG9OdWxsKG5leHRTZXF1ZW5jZVF1ZXJ5KTsKICAgICAgICAKICAgICAg\nICBpZiAoc2VsZWN0V29yZHMgIT0gbnVsbCkKICAgICAgICAgICAgc2VsZWN0\nV29yZFNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0KHNl\nbGVjdFdvcmRzCiAgICAgICAgICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCks\nICIsIiwgMCkpKTsKICAgICAgICAKICAgICAgICAvLyBpbml0aWFsaXplIHRo\nZSBlcnJvciBjb2RlcwogICAgICAgIFNRTEVycm9yQ29kZVJlYWRlciBjb2Rl\nUmVhZGVyID0gbmV3IFNRTEVycm9yQ29kZVJlYWRlcigpOwogICAgICAgIFN0\ncmluZyByc3JjID0gInNxbC1lcnJvci1zdGF0ZS1jb2Rlcy54bWwiOwogICAg\nICAgIElucHV0U3RyZWFtIHN0cmVhbSA9IGdldENsYXNzKCkuZ2V0UmVzb3Vy\nY2VBc1N0cmVhbShyc3JjKTsKICAgICAgICBTdHJpbmcgZGljdGlvbmFyeUNs\nYXNzTmFtZSA9IGdldENsYXNzKCkuZ2V0TmFtZSgpOwogICAgICAgIGlmIChz\ndHJlYW0gPT0gbnVsbCkgeyAvLyBVc2VyIHN1cHBsaWVkIGRpY3Rpb25hcnkg\nYnV0IG5vIGVycm9yIGNvZGVzIHhtbAogICAgICAgIAlzdHJlYW0gPSBEQkRp\nY3Rpb25hcnkuY2xhc3MuZ2V0UmVzb3VyY2VBc1N0cmVhbShyc3JjKTsgLy8g\ndXNlIGRlZmF1bHQKICAgICAgICAJZGljdGlvbmFyeUNsYXNzTmFtZSA9IGdl\ndENsYXNzKCkuZ2V0U3VwZXJjbGFzcygpLmdldE5hbWUoKTsKICAgICAgICB9\nCiAgICAgICAgY29kZVJlYWRlci5wYXJzZShzdHJlYW0sIGRpY3Rpb25hcnlD\nbGFzc05hbWUsIHRoaXMpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBh\nZGRFcnJvckNvZGUoaW50IGVycm9yVHlwZSwgU3RyaW5nIGVycm9yQ29kZSkg\newogICAgCWlmIChlcnJvckNvZGUgPT0gbnVsbCB8fCBlcnJvckNvZGUudHJp\nbSgpLmxlbmd0aCgpID09IDApCiAgICAJCXJldHVybjsKCQlTZXQ8U3RyaW5n\nPiBjb2RlcyA9IHNxbFN0YXRlQ29kZXMuZ2V0KGVycm9yVHlwZSk7CiAgICAJ\naWYgKGNvZGVzID09IG51bGwpIHsKICAgIAkJY29kZXMgPSBuZXcgSGFzaFNl\ndDxTdHJpbmc+KCk7CiAgICAJCWNvZGVzLmFkZChlcnJvckNvZGUudHJpbSgp\nKTsKICAgIAkJc3FsU3RhdGVDb2Rlcy5wdXQoZXJyb3JUeXBlLCBjb2Rlcyk7\nCiAgICAJfSBlbHNlIHsKICAgIAkJY29kZXMuYWRkKGVycm9yQ29kZS50cmlt\nKCkpOwogICAgCX0KICAgIH0KICAgIAogICAgLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbm5lY3Rpb25EZWNvcmF0\nb3IgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBEZWNvcmF0ZSB0aGUg\nZ2l2ZW4gY29ubmVjdGlvbiBpZiBuZWVkZWQuIFNvbWUgZGF0YWJhc2VzIHJl\ncXVpcmUgc3BlY2lhbAogICAgICogaGFuZGxpbmcgZm9yIEpEQkMgYnVncy4g\nVGhpcyBpbXBsZW1lbnRhdGlvbiBpc3N1ZXMgYW55CiAgICAgKiB7QGxpbmsg\nI2luaXRpYWxpemF0aW9uU1FMfSB0aGF0IGhhcyBiZWVuIHNldCBmb3IgdGhl\nIGRpY3Rpb25hcnkgYnV0CiAgICAgKiBkb2VzIG5vdCBkZWNvcmF0ZSB0aGUg\nY29ubmVjdGlvbi4KICAgICAqLwogICAgcHVibGljIENvbm5lY3Rpb24gZGVj\nb3JhdGUoQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmICghY29ubmVjdGVkKQogICAgICAgICAgICBj\nb25uZWN0ZWRDb25maWd1cmF0aW9uKGNvbm4pOwogICAgICAgIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShpbml0aWFsaXphdGlvblNRTCkpIHsKICAgICAg\nICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtbnQgPSBjb25uLnByZXBh\ncmVTdGF0ZW1lbnQoaW5pdGlhbGl6YXRpb25TUUwpOwogICAgICAgICAgICAg\nICAgc3RtbnQuZXhlY3V0ZSgpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShlLnRvU3Ry\naW5nKCksIGUpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsK\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGNvbm47CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUKICAgICAqIHtAbGluayBMb2dnaW5n\nQ29ubmVjdGlvbkRlY29yYXRvci5TUUxXYXJuaW5nSGFuZGxlcn0gaW50ZXJm\nYWNlCiAgICAgKiB0aGF0IGFsbG93cyBjdXN0b21pemF0aW9uIG9mIHRoZSBh\nY3Rpb25zIHRvIHBlcmZvcm0gd2hlbiBhCiAgICAgKiB7QGxpbmsgU1FMV2Fy\nbmluZ30gb2NjdXJzIGF0IGFueSBwb2ludCBvbiBhIHtAbGluayBDb25uZWN0\naW9ufSwKICAgICAqIHtAbGluayBTdGF0ZW1lbnR9LCBvciB7QGxpbmsgUmVz\ndWx0U2V0fS4gVGhpcyBtZXRob2QgbWF5CiAgICAgKiBiZSB1c2VkIGRldGVy\nbWluZSB0aG9zZSB3YXJuaW5ncyB0aGUgYXBwbGljYXRpb24gd2FudHMgdG8K\nICAgICAqIGNvbnNpZGVyIGNyaXRpY2FsIGZhaWx1cmVzLCBhbmQgdGhyb3cg\ndGhlIHdhcm5pbmcgaW4gdGhvc2UKICAgICAqIGNhc2VzLiBCeSBkZWZhdWx0\nLCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuCiAgICAgKgogICAgICogQHNl\nZSBMb2dnaW5nQ29ubmVjdGlvbkRlY29yYXRvciNzZXRXYXJuaW5nQWN0aW9u\nCiAgICAgKiBAc2VlIExvZ2dpbmdDb25uZWN0aW9uRGVjb3JhdG9yI3NldFdh\ncm5pbmdIYW5kbGVyCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGhhbmRsZVdh\ncm5pbmcoU1FMV2FybmluZyB3YXJuaW5nKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbmV3\nIGV4Y2VwdGlvbiB0aGF0IHdyYXBzIDxjb2RlPmNhdXNlczwvY29kZT4uCiAg\nICAgKiBIb3dldmVyLCB0aGUgZGV0YWlscyBvZiBleGFjdGx5IHdoYXQgdHlw\nZSBvZiBleGNlcHRpb24gaXMgcmV0dXJuZWQgY2FuCiAgICAgKiBiZSBkZXRl\ncm1pbmVkIGJ5IHRoZSBpbXBsZW1lbnRhdGlvbi4gVGhpcyBtYXkgdGFrZSBp\nbnRvIGFjY291bnQKICAgICAqIERCLXNwZWNpZmljIGV4Y2VwdGlvbiBpbmZv\ncm1hdGlvbiBpbiA8Y29kZT5jYXVzZXM8L2NvZGU+LgogICAgICovCiAgICBw\ndWJsaWMgT3BlbkpQQUV4Y2VwdGlvbiBuZXdTdG9yZUV4Y2VwdGlvbihTdHJp\nbmcgbXNnLCBTUUxFeGNlcHRpb25bXSBjYXVzZXMsCiAgICAgICAgT2JqZWN0\nIGZhaWxlZCkgewogICAgCWlmIChjYXVzZXMgIT0gbnVsbCAmJiBjYXVzZXMu\nbGVuZ3RoID4gMCkgewogICAgCQlPcGVuSlBBRXhjZXB0aW9uIHJldCA9IG5h\ncnJvdyhtc2csIGNhdXNlc1swXSk7CiAgICAJCXJldC5zZXRGYWlsZWRPYmpl\nY3QoZmFpbGVkKS5zZXROZXN0ZWRUaHJvd2FibGVzKGNhdXNlcyk7CiAgICAJ\nCXJldHVybiByZXQ7CiAgICAJfQogICAgICAgIHJldHVybiBuZXcgU3RvcmVF\neGNlcHRpb24obXNnKS5zZXRGYWlsZWRPYmplY3QoZmFpbGVkKS4KICAgICAg\nICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyhjYXVzZXMpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIEdldHMgdGhlIHN1YnR5cGUgb2YgU3RvcmVFeGNl\ncHRpb24gYnkgbWF0Y2hpbmcgdGhlIGdpdmVuIFNRTEV4Y2VwdGlvbidzCiAg\nICAgKiBlcnJvciBzdGF0ZSBjb2RlIHRvIHRoZSBsaXN0IG9mIGVycm9yIGNv\nZGVzIHN1cHBsaWVkIGJ5IHRoZSBkaWN0aW9uYXJ5LgogICAgICogUmV0dXJu\ncyAtMSBpZiBubyBtYXRjaGluZyBjb2RlIGNhbiBiZSBmb3VuZC4KICAgICAq\nLwogICAgT3BlbkpQQUV4Y2VwdGlvbiBuYXJyb3coU3RyaW5nIG1zZywgU1FM\nRXhjZXB0aW9uIGV4KSB7CiAgICAJU3RyaW5nIGVycm9yU3RhdGUgPSBleC5n\nZXRTUUxTdGF0ZSgpOwogICAgCWludCBlcnJvclR5cGUgPSBTdG9yZUV4Y2Vw\ndGlvbi5HRU5FUkFMOwogICAgCWZvciAoSW50ZWdlciB0eXBlIDogc3FsU3Rh\ndGVDb2Rlcy5rZXlTZXQoKSkgewogICAgCQlTZXQ8U3RyaW5nPiBlcnJvU3Rh\ndGVzID0gc3FsU3RhdGVDb2Rlcy5nZXQodHlwZSk7CiAgICAJCWlmIChlcnJv\nU3RhdGVzICE9IG51bGwgJiYgZXJyb1N0YXRlcy5jb250YWlucyhlcnJvclN0\nYXRlKSkgewogICAgCQkJZXJyb3JUeXBlID0gdHlwZTsKICAgIAkJCWJyZWFr\nOwogICAgCQl9CiAgICAJfQogICAgCXN3aXRjaCAoZXJyb3JUeXBlKSB7Cgkg\nICAgCWNhc2UgU3RvcmVFeGNlcHRpb24uTE9DSzogCgkgICAgICAgICAgICBy\nZXR1cm4gbmV3IExvY2tFeGNlcHRpb24obXNnKTsKCSAgICAJY2FzZSBTdG9y\nZUV4Y2VwdGlvbi5PQkpFQ1RfRVhJU1RTOgoJICAgICAgICAgICAgcmV0dXJu\nIG5ldyBPYmplY3RFeGlzdHNFeGNlcHRpb24obXNnKTsKCSAgICAJY2FzZSBT\ndG9yZUV4Y2VwdGlvbi5PQkpFQ1RfTk9UX0ZPVU5EOgoJICAgICAgICAgICAg\ncmV0dXJuIG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihtc2cpOwoJICAg\nIAljYXNlIFN0b3JlRXhjZXB0aW9uLk9QVElNSVNUSUM6CgkgICAgICAgICAg\nICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24obXNnKTsKCSAgICAJ\nY2FzZSBTdG9yZUV4Y2VwdGlvbi5SRUZFUkVOVElBTF9JTlRFR1JJVFk6IAoJ\nICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWZlcmVudGlhbEludGVncml0eUV4\nY2VwdGlvbihtc2cpOwoJICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTdG9yZUV4Y2VwdGlvbihtc2cpOwogICAgICAgIH0KICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBDbG9zZXMgdGhlIHNwZWNpZmllZCB7\nQGxpbmsgRGF0YVNvdXJjZX0gYW5kIHJlbGVhc2VzIGFueQogICAgICogcmVz\nb3VyY2VzIGFzc29jaWF0ZWQgd2l0aCBpdC4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZGF0YVNvdXJjZSB0aGUgRGF0YVNvdXJjZSB0byBjbG9zZQogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBjbG9zZURhdGFTb3VyY2UoRGF0YVNvdXJjZSBk\nYXRhU291cmNlKSB7CiAgICAgICAgRGF0YVNvdXJjZUZhY3RvcnkuY2xvc2VE\nYXRhU291cmNlKGRhdGFTb3VyY2UpOwogICAgfQoKICAgIC8qKgogICAgICog\nVXNlZCBieSBzb21lIG1hcHBpbmdzIHRvIHJlcHJlc2VudCBkYXRhIHRoYXQg\naGFzIGFscmVhZHkgYmVlbgogICAgICogc2VyaWFsaXplZCBzbyB0aGF0IHdl\nIGRvbid0IGhhdmUgdG8gc2VyaWFsaXplIG11bHRpcGxlIHRpbWVzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFNlcmlhbGl6ZWREYXRhIHsK\nCiAgICAgICAgcHVibGljIGZpbmFsIGJ5dGVbXSBieXRlczsKCiAgICAgICAg\ncHVibGljIFNlcmlhbGl6ZWREYXRhKGJ5dGVbXSBieXRlcykgewogICAgICAg\nICAgICB0aGlzLmJ5dGVzID0gYnl0ZXM7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFJldHVybiB2ZXJzaW9uIGNvbHVtbiBuYW1lCiAg\nICAgKiBAcGFyYW0gY29sdW1uCiAgICAgKiBAcGFyYW0gdGFibGVBbGlhcyA6\nIHRoaXMgaXMgbmVlZGVkIGZvciBwbGF0Zm9ybSBzcGVjaWZpYyB2ZXJzaW9u\nIGNvbHVtbgogICAgICogQHJldHVybgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFZlcnNpb25Db2x1bW4oQ29sdW1uIGNvbHVtbiwgU3RyaW5nIHRh\nYmxlQWxpYXMpIHsKICAgICAgICByZXR1cm4gY29sdW1uLnRvU3RyaW5nKCk7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGluc2VydEJsb2JGb3JTdHJl\nYW1pbmdMb2FkKFJvdyByb3csIENvbHVtbiBjb2wsIAogICAgICAgIEpEQkNT\ndG9yZSBzdG9yZSwgT2JqZWN0IG9iLCBTZWxlY3Qgc2VsKSB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAob2IgIT0gbnVsbCkgewogICAgICAg\nICAgICByb3cuc2V0QmluYXJ5U3RyZWFtKGNvbCwgCiAgICAgICAgICAgICAg\nICBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0obmV3IGJ5dGVbMF0pLCAwKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cuc2V0TnVsbChjb2wp\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgaW5zZXJ0\nQ2xvYkZvclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgT2Jq\nZWN0IG9iKQogICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKG9iICE9IG51bGwpIHsKICAgICAgICByb3cuc2V0Q2hhcmFjdGVyU3RyZWFt\nKGNvbCwKICAgICAgICAgICAgICAgIG5ldyBDaGFyQXJyYXlSZWFkZXIobmV3\nIGNoYXJbMF0pLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBy\nb3cuc2V0TnVsbChjb2wpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVi\nbGljIHZvaWQgdXBkYXRlQmxvYihTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3Rv\ncmUsIElucHV0U3RyZWFtIGlzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIFNRTEJ1ZmZlciBzcWwgPSBzZWwudG9TZWxlY3QodHJ1\nZSwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkpOwogICAgICAgIFJl\nc3VsdFNldCByZXMgPSBudWxsOwogICAgICAgIENvbm5lY3Rpb24gY29ubiA9\nIHN0b3JlLmdldENvbm5lY3Rpb24oKTsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nc3RtbnQgPSBzcWwucHJlcGFyZVN0YXRlbWVudChjb25uLCBzdG9yZS5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKSwKICAgICAgICAgICAgICAgIFJlc3VsdFNl\ndC5UWVBFX1NDUk9MTF9TRU5TSVRJVkUsCiAgICAgICAgICAgICAgICBSZXN1\nbHRTZXQuQ09OQ1VSX1VQREFUQUJMRSk7CiAgICAgICAgICAgIHJlcyA9IHN0\nbW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBpZiAoIXJlcy5uZXh0\nKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbihfbG9jLmdldCgic3RyZWFtLWV4Y2VwdGlvbiIpKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBCbG9iIGJsb2IgPSByZXMuZ2V0QmxvYigxKTsK\nICAgICAgICAgICAgT3V0cHV0U3RyZWFtIG9zID0gYmxvYi5zZXRCaW5hcnlT\ndHJlYW0oMSk7CiAgICAgICAgICAgIGNvcHkoaXMsIG9zKTsKICAgICAgICAg\nICAgb3MuY2xvc2UoKTsKICAgICAgICAgICAgcmVzLnVwZGF0ZUJsb2IoMSwg\nYmxvYik7CiAgICAgICAgICAgIHJlcy51cGRhdGVSb3coKTsKCiAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7IHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUp\nIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBlKSB7fQogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9zZSAoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCB1cGRhdGVDbG9iKFNlbGVjdCBzZWwsIEpEQkNTdG9yZSBzdG9y\nZSwgUmVhZGVyIHJlYWRlcikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBTUUxCdWZmZXIgc3FsID0gc2VsLnRvU2VsZWN0KHRydWUs\nIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpKTsKICAgICAgICBSZXN1\nbHRTZXQgcmVzID0gbnVsbDsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBz\ndG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0\nbW50ID0gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3RvcmUuZ2V0RmV0\nY2hDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQu\nVFlQRV9TQ1JPTExfU0VOU0lUSVZFLAogICAgICAgICAgICAgICAgUmVzdWx0\nU2V0LkNPTkNVUl9VUERBVEFCTEUpOwogICAgICAgICAgICByZXMgPSBzdG1u\ndC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAgICAgaWYgKCFyZXMubmV4dCgp\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oX2xvYy5nZXQoInN0cmVhbS1leGNlcHRpb24iKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgQ2xvYiBjbG9iID0gcmVzLmdldENsb2IoMSk7CiAg\nICAgICAgICAgIFdyaXRlciB3cml0ZXIgPSBjbG9iLnNldENoYXJhY3RlclN0\ncmVhbSgxKTsKICAgICAgICAgICAgY29weShyZWFkZXIsIHdyaXRlcik7CiAg\nICAgICAgICAgIHdyaXRlci5jbG9zZSgpOwogICAgICAgICAgICByZXMudXBk\nYXRlQ2xvYigxLCBjbG9iKTsKICAgICAgICAgICAgcmVzLnVwZGF0ZVJvdygp\nOwoKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSAKICAg\nICAgICAgICAgICAgIHRyeSB7IHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxs\nKSAKICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlICgpOyB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICAgICAgaWYgKGNvbm4g\nIT0gbnVsbCkgCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlICgp\nOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICB9ICAgIAog\nICAgfQogICAgCiAgICBwcm90ZWN0ZWQgbG9uZyBjb3B5KElucHV0U3RyZWFt\nIGluLCBPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGJ5dGVbXSBjb3B5QnVmZmVyID0gbmV3IGJ5dGVbYmxvYkJ1ZmZl\nclNpemVdOwogICAgICAgIGxvbmcgYnl0ZXNDb3BpZWQgPSAwOwogICAgICAg\nIGludCByZWFkID0gLTE7CgogICAgICAgIHdoaWxlICgocmVhZCA9IGluLnJl\nYWQoY29weUJ1ZmZlciwgMCwgY29weUJ1ZmZlci5sZW5ndGgpKSAhPSAtMSkg\newogICAgICAgICAgICBvdXQud3JpdGUoY29weUJ1ZmZlciwgMCwgcmVhZCk7\nCiAgICAgICAgICAgIGJ5dGVzQ29waWVkICs9IHJlYWQ7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBieXRlc0NvcGllZDsKICAgIH0KICAgIAogICAgcHJv\ndGVjdGVkIGxvbmcgY29weShSZWFkZXIgcmVhZGVyLCBXcml0ZXIgd3JpdGVy\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoYXJbXSBjb3B5QnVm\nZmVyID0gbmV3IGNoYXJbY2xvYkJ1ZmZlclNpemVdOwogICAgICAgIGxvbmcg\nYnl0ZXNDb3BpZWQgPSAwOwogICAgICAgIGludCByZWFkID0gLTE7CgogICAg\nICAgIHdoaWxlICgocmVhZCA9IHJlYWRlci5yZWFkKGNvcHlCdWZmZXIsIDAs\nIGNvcHlCdWZmZXIubGVuZ3RoKSkgIT0gLTEpIHsKICAgICAgICAgICAgd3Jp\ndGVyLndyaXRlKGNvcHlCdWZmZXIsIDAsIHJlYWQpOwogICAgICAgICAgICBi\neXRlc0NvcGllZCArPSByZWFkOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIGJ5dGVzQ29waWVkOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEF0dGFj\naCBDQVNUIHRvIHRoZSBjdXJyZW50IGZ1bmN0aW9uIGlmIG5lY2Vzc2FyeQog\nICAgICogCiAgICAgKiBAcGFyYW0gdmFsIG9wZXJhbmQgdmFsdWUKICAgICAq\nIEBwYXJtYSBmdW5jIHRoZSBzcWwgZnVuY3Rpb24gc3RhdGVtZW50CiAgICAg\nKiBAcmV0dXJuIGEgU3RyaW5nIHdpdGggdGhlIGNvcnJlY3QgQ0FTVCBmdW5j\ndGlvbiBzeW50YXgKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDYXN0\nRnVuY3Rpb24oVmFsIHZhbCwgU3RyaW5nIGZ1bmMpIHsKICAgICAgICByZXR1\ncm4gZnVuYzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4g\naW5kZXggaWYgbmVjZXNzYXJ5IGZvciBzb21lIGRhdGFiYXNlIHRhYmxlcwog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBjcmVhdGVJbmRleElmTmVjZXNzYXJ5\nKFNjaGVtYSBzY2hlbWEsIFN0cmluZyB0YWJsZSwKICAgICAgICAgICAgQ29s\ndW1uIHBrQ29sdW1uKSB7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBiYXRjaExpbWl0CiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nQmF0Y2hMaW1pdCgpewogICAgICAgIHJldHVybiBiYXRjaExpbWl0OwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFNldCB0aGUgYmF0Y2hMaW1pdCB2YWx1\nZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCYXRjaExpbWl0KGludCBs\naW1pdCl7CiAgICAgICAgYmF0Y2hMaW1pdCA9IGxpbWl0OwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoZSBiYXRjaCBwcm9jZXNzLiBJ\nbiBzb21lIGNhc2VzLCB3ZSBjYW4ndCBiYXRjaCB0aGUgc3RhdGVtZW50cwog\nICAgICogZHVlIHRvIHNvbWUgcmVzdHJpY3Rpb25zLiBGb3IgZXhhbXBsZSwg\naWYgdGhlIEdlbmVyYXRlZFR5cGU9SURFTlRJVFksCiAgICAgKiB3ZSBoYXZl\nIHRvIGRpc2FibGUgdGhlIGJhdGNoIHByb2Nlc3MgYmVjYXVzZSB3ZSBuZWVk\nIHRvIGdldCB0aGUgSUQgdmFsdWUKICAgICAqIHJpZ2h0IGF3YXkgZm9yIHRo\nZSBpbi1tZW1vcnkgZW50aXR5IHRvIHVzZS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gdmFsaWRhdGVCYXRjaFByb2Nlc3MoUm93SW1wbCByb3csIENv\nbHVtbltdIGF1dG9Bc3NpZ24sCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgIHNtLCBDbGFzc01hcHBpbmcgY21kICkgewogICAgICAgIGJvb2xl\nYW4gZGlzYWJsZUJhdGNoID0gZmFsc2U7CiAgICAgICAgaWYgKGdldEJhdGNo\nTGltaXQoKT09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoYXV0b0Fz\nc2lnbiAhPSBudWxsICYmIHNtICE9IG51bGwpIHsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZCA9IGNtZC5nZXRQcmltYXJ5S2V5RmllbGRzKCk7\nCiAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgd2hpbGUgKCFk\naXNhYmxlQmF0Y2ggJiYgaSA8IGZtZC5sZW5ndGgpIHsKICAgICAgICAgICAg\nICAgIGlmIChmbWRbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3Ry\nYXRlZ2llcy5BVVRPQVNTSUdOKQogICAgICAgICAgICAgICAgICAgIGRpc2Fi\nbGVCYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gZ28gdG8gZWFjaCBEaWN0aW9u\nYXJ5IHRvIHZhbGlkYXRlIHRoZSBiYXRjaCBjYXBhYmlsaXR5CiAgICAgICAg\naWYgKCFkaXNhYmxlQmF0Y2gpCiAgICAgICAgICAgIGRpc2FibGVCYXRjaCA9\nIHZhbGlkYXRlREJTcGVjaWZpY0JhdGNoUHJvY2VzcyhkaXNhYmxlQmF0Y2gs\nIHJvdywgCiAgICAgICAgICAgICAgICBhdXRvQXNzaWduLCBzbSwgY21kKTsK\nICAgICAgICByZXR1cm4gZGlzYWJsZUJhdGNoOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEFsbG93IGVhY2ggRGljdGlvbmFyeSB0byB2YWxpZGF0ZSBp\ndHMgb3duIGJhdGNoIHByb2Nlc3MuIAogICAgICovCiAgICBwdWJsaWMgYm9v\nbGVhbiB2YWxpZGF0ZURCU3BlY2lmaWNCYXRjaFByb2Nlc3MgKGJvb2xlYW4g\nZGlzYWJsZUJhdGNoLCAKICAgICAgICAgICAgUm93SW1wbCByb3csIENvbHVt\nbltdIGF1dG9Bc3NpZ24sIAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5h\nZ2VyICBzbSwgQ2xhc3NNYXBwaW5nIGNtZCApIHsKICAgICAgICByZXR1cm4g\nZGlzYWJsZUJhdGNoOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMg\nbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9y\nIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGlu\nZyBxdWVyeS4KICAgICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVj\ndXRlUXVlcnkoQ29ubmVjdGlvbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgU3RyaW5nIHNxbCAKICAgICAgICApIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAg\nIH0KICAgICAgICAgICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlz\nIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlr\nZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHByZXBhcmluZyBzdGF0ZW1l\nbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBw\ncmVwYXJlU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgU3RyaW5nIHNxbCkK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\nY29ubi5wcmVwYXJlU3RhdGVtZW50KHNxbCk7CiAgICB9ICAgIAogCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIGdldHRpbmcgc2VxdWVuY2UgZnJvbSB0aGUgcmVzdWx0IHNldC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFNlcXVlbmNlW10gZ2V0U2VxdWVuY2Uo\nUmVzdWx0U2V0IHJzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBM\naXN0IHNlcUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgd2hpbGUg\nKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICBzZXFMaXN0\nLmFkZChuZXdTZXF1ZW5jZShycykpOwogICAgICAgIHJldHVybiAoU2VxdWVu\nY2VbXSkgc2VxTGlzdC50b0FycmF5KG5ldyBTZXF1ZW5jZVtzZXFMaXN0LnNp\nemUoKV0pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMt\nbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcga2V5IGZy\nb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBPYmpl\nY3QgZ2V0S2V5IChSZXN1bHRTZXQgcnMsIENvbHVtbiBjb2wpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIGlmICghcnMubmV4dCgpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWdl\nbmtleSIpKTsKICAgICAgICBPYmplY3Qga2V5ID0gcnMuZ2V0T2JqZWN0KDEp\nOwogICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAgICAgbG9nLndh\ncm4oX2xvYy5nZXQoImludmFsaWQtZ2Vua2V5IiwgY29sKSk7CiAgICAgICAg\ncmV0dXJuIGtleTsgICAgICAgIAogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1K\nREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGNh\nbGN1bGF0aW5nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBj\nYWxjdWxhdGVWYWx1ZShWYWwgdmFsLCBTZWxlY3Qgc2VsLCBFeHBDb250ZXh0\nIGN0eCwgCiAgICAgICAgRXhwU3RhdGUgc3RhdGUsIFBhdGggcGF0aCwgRXhw\nU3RhdGUgcGF0aFN0YXRlKSB7CiAgICAgICAgdmFsLmNhbGN1bGF0ZVZhbHVl\nKHNlbCwgY3R4LCBzdGF0ZSwgKFZhbCkgcGF0aCwgcGF0aFN0YXRlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoZSBwcm92\naWRlZCA8Y29kZT5zcWw8L2NvZGU+IG1heSBiZSB0cmVhdGVkIGFzIGEgCiAg\nICAgKiBzZWxlY3Qgc3RhdGVtZW50IG9uIHRoaXMgZGF0YWJhc2UuCiAgICAg\nKiAgCiAgICAgKiBAcGFyYW0gc3FsICAgQSBzcWwgc3RhdGVtZW50LiAKICAg\nICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIDxjb2RlPnNxbDwvY29kZT4g\ncmVwcmVzZW50cyBhIHNlbGVjdCBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzU2VsZWN0KFN0cmluZyBzcWwpIHsKICAgICAgICBJ\ndGVyYXRvciBpID0gc2VsZWN0V29yZFNldC5pdGVyYXRvcigpOwogICAgICAg\nIFN0cmluZyBjdXI7CiAgICAgICAgd2hpbGUgKGkuaGFzTmV4dCgpKSB7CiAg\nICAgICAgICAgIGN1ciA9IChTdHJpbmcpIGkubmV4dCgpOwogICAgICAgICAg\nICBpZiAoc3FsLmxlbmd0aCgpID49IGN1ci5sZW5ndGgoKQogICAgICAgICAg\nICAgICAgICAgICYmIHNxbC5zdWJzdHJpbmcoMCwgY3VyLmxlbmd0aCgpKS5l\ncXVhbHNJZ25vcmVDYXNlKGN1cikpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBuZWVkc1RvQ3Jl\nYXRlSW5kZXgoSW5kZXggaWR4LCBUYWJsZSB0YWJsZSkgewogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGJhdGNo\nZWQgc3RhdGVtZW50cyB1cGRhdGUgc3VjY2VzIGNvdW50CiAgICAgKiBAcGFy\nYW0gcHMgQSBQcmVwYXJlZFN0YXRlbWVudAogICAgICogQHJldHVybiByZXR1\ncm4gdXBkYXRlIGNvdW50CiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0QmF0\nY2hVcGRhdGVDb3VudChQcmVwYXJlZFN0YXRlbWVudCBwcykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBib29sZWFuIGdldFRyaW1TY2hlbWFOYW1lKCkgeyAKICAgICAg\nICByZXR1cm4gdHJpbVNjaGVtYU5hbWU7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIHNldFRyaW1TY2hlbWFOYW1lKGJvb2xlYW4gdHJpbVNjaGVtYU5h\nbWUpIHsgCiAgICAgICAgdGhpcy50cmltU2NoZW1hTmFtZSA9IHRyaW1TY2hl\nbWFOYW1lOyAKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgZGVsZXRlU3Ry\nZWFtKEpEQkNTdG9yZSBzdG9yZSwgU2VsZWN0IHNlbCkgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gRG8gbm90aGluZwogICAgfQp9Cg==\n","encoding":"base64"}

