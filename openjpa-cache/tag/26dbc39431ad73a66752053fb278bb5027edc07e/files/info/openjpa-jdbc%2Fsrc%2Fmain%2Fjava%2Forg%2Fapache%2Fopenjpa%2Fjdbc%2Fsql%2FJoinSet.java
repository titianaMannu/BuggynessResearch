{"sha":"b10c47f8fb87816392725379e41ace8bd78d7c1c","node_id":"MDQ6QmxvYjIwNjM2NDpiMTBjNDdmOGZiODc4MTYzOTI3MjUzNzllNDFhY2U4YmQ3OGQ3YzFj","size":12080,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b10c47f8fb87816392725379e41ace8bd78d7c1c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5CaXRTZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk5vU3VjaEVsZW1lbnRFeGNlcHRpb247CgppbXBvcnQgb3JnLmFw\nYWNoZS5jb21tb25zLmxhbmcuT2JqZWN0VXRpbHM7CgovKioKICogU2V0IHR5\ncGUgdGhhdCByZWNvZ25pemVzIHRoYXQgaW5uZXIgam9pbnMgc2hvdWxkIHRh\na2UgcHJlY2VkZW5jZQogKiBvdmVyIG90aGVyd2lzZSBlcXVhbCBvdXRlciBq\nb2lucy4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCmNsYXNzIEpvaW5T\nZXQgewoKICAgIC8vIHRoZSBqb2lucyBhcmUgc3RvcmVkIGFzIGFuIGFkamFj\nZW5jeSBsaXN0IGdyYXBoLiAgaXQncyBhIHJlYXNvbmFibHkKICAgIC8vIGVm\nZmljaWVudCByZXByZXNlbnRhdGlvbiB3aXRoIE8oMSkgbG9va3VwLCBhZGQs\nIHJlbW92ZSBvcGVyYXRpb25zIGZvcgogICAgLy8gdHlwaWNhbCBzZXRzIG9m\nIGpvaW5zLCBhbmQgaXQgbWVhbnMgd2UnZCBoYXZlIHRvIGNyZWF0ZSBhIGdy\nYXBoIGFueXdheQogICAgLy8gd2hlbiBqb2luSXRlcmF0b3IoKSBpcyBjYWxs\nZWQKICAgIHByaXZhdGUgZmluYWwgTGlzdCBfZ3JhcGggPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICBwcml2YXRlIGludCBfc2l6ZSA9IDA7CiAgICBwcml2YXRl\nIExpc3QgX3NvcnRlZCA9IG51bGw7CgogICAgcHVibGljIEpvaW5TZXQoKSB7\nCiAgICB9CgogICAgcHVibGljIEpvaW5TZXQoSm9pblNldCBjb3B5KSB7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3B5Ll9ncmFwaC5zaXplKCk7\nIGkrKykgewogICAgICAgICAgICBpZiAoY29weS5fZ3JhcGguZ2V0KGkpID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfZ3JhcGguYWRkKG51bGwpOwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZ3JhcGguYWRkKCgoTm9k\nZSkgY29weS5fZ3JhcGguZ2V0KGkpKS5jbG9uZSgpKTsKICAgICAgICB9CiAg\nICAgICAgX3NpemUgPSBjb3B5Ll9zaXplOwogICAgICAgIF9zb3J0ZWQgPSBj\nb3B5Ll9zb3J0ZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHJlY29yZGVkIGpvaW4gbWF0Y2hpbmcgdGhlIGdpdmVuIGpvaW4ncyBhbGlh\nc2VzLgogICAgICovCiAgICBwdWJsaWMgSm9pbiBnZXRSZWNvcmRlZEpvaW4o\nSm9pbiBqb2luKSB7CiAgICAgICAgaWYgKGpvaW4gPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgTm9kZSBub2RlID0gZ2V0Tm9k\nZShqb2luLCBqb2luLmdldEluZGV4MSgpKTsKICAgICAgICByZXR1cm4gKG5v\nZGUgPT0gbnVsbCkgPyBudWxsIDogbm9kZS5qb2luOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBub2RlIGZvciB0aGUgc3BlY2lmaWVkIGpv\naW4gYW5kIGluZGV4LgogICAgICovCiAgICBwcml2YXRlIE5vZGUgZ2V0Tm9k\nZShKb2luIGpvaW4sIGludCBpZHgpIHsKICAgICAgICBpZiAoX2dyYXBoLnNp\nemUoKSA8PSBpZHgpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIE5vZGUgbm9kZSA9IChOb2RlKSBfZ3JhcGguZ2V0KGlkeCk7CiAgICAgICAg\nZm9yICg7IG5vZGUgIT0gbnVsbDsgbm9kZSA9IG5vZGUubmV4dCkKICAgICAg\nICAgICAgaWYgKG5vZGUuam9pbi5lcXVhbHMoam9pbikpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbm9kZTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbG9naWNhbCBsYXN0IGpvaW4u\nCiAgICAgKi8KICAgIHB1YmxpYyBKb2luIGxhc3QoKSB7CiAgICAgICAgaWYg\nKF9zaXplID09IDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIE5vZGUgbm9kZSA9IChOb2RlKSBfZ3JhcGguZ2V0KF9ncmFwaC5zaXplKCkg\nLSAxKTsKICAgICAgICB3aGlsZSAobm9kZS5uZXh0ICE9IG51bGwpCiAgICAg\nICAgICAgIG5vZGUgPSBub2RlLm5leHQ7CiAgICAgICAgcmV0dXJuIG5vZGUu\nam9pbjsKICAgIH0KCiAgICAvKioKICAgICAqIEl0ZXJhdG9yIG92ZXIgam9p\nbnMgdGhhdCBwcmVwYXJlcyB0aGVtIGZvciBTUUwgdHJhbnNsYXRpb24uCiAg\nICAgKi8KICAgIHB1YmxpYyBJdGVyYXRvciBqb2luSXRlcmF0b3IoKSB7CiAg\nICAgICAgaWYgKF9zaXplIDwgMikKICAgICAgICAgICAgcmV0dXJuIGl0ZXJh\ndG9yKCk7CiAgICAgICAgaWYgKF9zb3J0ZWQgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9zb3J0ZWQuaXRlcmF0b3IoKTsKCiAgICAgICAgTGlzdCBz\nb3J0ZWQgPSBuZXcgQXJyYXlMaXN0KF9zaXplKTsKICAgICAgICBMaW5rZWRM\naXN0IHF1ZXVlID0gbmV3IExpbmtlZExpc3QoKTsKICAgICAgICBCaXRTZXQg\nc2VlbiA9IG5ldyBCaXRTZXQoX2dyYXBoLnNpemUoKSAqIF9ncmFwaC5zaXpl\nKCkKICAgICAgICAgICAgKyBfZ3JhcGguc2l6ZSgpKTsKCiAgICAgICAgLy8g\ndHJhdmVyc2UgZ3JhcGgKICAgICAgICBOb2RlIG47CiAgICAgICAgaW50IGlk\neCwgc2lkeDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9ncmFwaC5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAvLyBzZWVkIHF1ZXVlIHdpdGgg\nbmV4dCBzZXQgb2YgZGlzY29ubmVjdGVkIGpvaW5zCiAgICAgICAgICAgIGZv\nciAobiA9IChOb2RlKSBfZ3JhcGguZ2V0KGkpOyBuICE9IG51bGw7IG4gPSBu\nLm5leHQpIHsKICAgICAgICAgICAgICAgIHNpZHggPSBnZXRTZWVuSW5kZXgo\nbi5qb2luKTsKICAgICAgICAgICAgICAgIGlmICghc2Vlbi5nZXQoc2lkeCkp\nIHsKICAgICAgICAgICAgICAgICAgICBzZWVuLnNldChzaWR4KTsKICAgICAg\nICAgICAgICAgICAgICBxdWV1ZS5hZGQobik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHF1ZXVlLmlzRW1wdHko\nKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8g\ndHJhdmVyc2UgZnJvbSB0aG9zZSBqb2lucyB0byByZWFjaGFibGVzCiAgICAg\nICAgICAgIHdoaWxlICghcXVldWUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nICAgICBuID0gKE5vZGUpIHF1ZXVlLnJlbW92ZUZpcnN0KCk7CgogICAgICAg\nICAgICAgICAgLy8gZG9uJ3QgcmVwZWF0IGEgam9pbiB0byBhIHRhYmxlIHdl\nJ3ZlIGFscmVhZHkgam9pbmVkLCBidXQKICAgICAgICAgICAgICAgIC8vIGRv\nIHRyYXZlcnNlIHRocm91Z2ggaXQgaW4gdGhlIGdyYXBoICh0aGUgZmlyc3Qg\naW5kZXhlcyBvZgogICAgICAgICAgICAgICAgLy8gdGhlIHNlZWVuIGJpdHNl\ndCBhcmUgcmVzZXJ2ZWQgZm9yIGpvaW5lZC10byB0YWJsZXMpCiAgICAgICAg\nICAgICAgICBpZHggPSAobi5mb3J3YXJkKSA/IG4uam9pbi5nZXRJbmRleDIo\nKSA6IG4uam9pbi5nZXRJbmRleDEoKTsKICAgICAgICAgICAgICAgIGlmICgh\nc2Vlbi5nZXQoaWR4KSkgewogICAgICAgICAgICAgICAgICAgIHNvcnRlZC5h\nZGQoKG4uZm9yd2FyZCkgPyBuLmpvaW4gOiBuLmpvaW4ucmV2ZXJzZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBzZWVuLnNldChpZHgpOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAobiA9IChOb2RlKSBfZ3Jh\ncGguZ2V0KGlkeCk7IG4gIT0gbnVsbDsgbiA9IG4ubmV4dCkgewogICAgICAg\nICAgICAgICAgICAgIHNpZHggPSBnZXRTZWVuSW5kZXgobi5qb2luKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoIXNlZW4uZ2V0KHNpZHgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHNlZW4uc2V0KHNpZHgpOwogICAgICAgICAg\nICAgICAgICAgICAgICBxdWV1ZS5hZGQobik7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIF9zb3J0ZWQgPSBzb3J0ZWQ7CiAgICAgICAgcmV0dXJuIF9z\nb3J0ZWQuaXRlcmF0b3IoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdlIGNy\nZWF0ZSBhIHVuaXF1ZSBpbmRleCBmb3IgcmVjb3JkaW5nIHNlZW4gbm9kZXMg\nYnkKICAgICAqIHRyZWF0aW5nIHRoZSBqb2luZWQgaW5kZXhlcyBhcyBhIGJh\nc2UgKG1heC1pbmRleCkgbnVtYmVyLgogICAgICovCiAgICBwcml2YXRlIGlu\ndCBnZXRTZWVuSW5kZXgoSm9pbiBqb2luKSB7CiAgICAgICAgLy8gd2UgcmVz\nZXJ2ZSBpbmRleGVzIDAuLi5fZ3JhcGguc2l6ZSgpIGZvciBqb2luZWQgdGFi\nbGVzCiAgICAgICAgcmV0dXJuIGpvaW4uZ2V0SW5kZXgxKCkgKiBfZ3JhcGgu\nc2l6ZSgpICsgam9pbi5nZXRJbmRleDIoKQogICAgICAgICAgICArIF9ncmFw\naC5zaXplKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYWRkKEpvaW4g\nam9pbikgewogICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZ\nUEVfT1VURVIpIHsKICAgICAgICAgICAgLy8gb3V0ZXIgc2hvdWxkbid0IG92\nZXJyaWRlIGFueSBvdGhlciBqb2luIHR5cGUKICAgICAgICAgICAgaWYgKCFj\nb250YWlucyhqb2luKSkgewogICAgICAgICAgICAgICAgYWRkTm9kZShqb2lu\nKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAg\nIC8vIHJlcGxhY2UgYW55IGV4aXN0aW5nIGpvaW4gd2l0aCB0aGlzIG9uZQog\nICAgICAgIE5vZGUgbm9kZSA9IGdldE5vZGUoam9pbiwgam9pbi5nZXRJbmRl\neDEoKSk7CiAgICAgICAgaWYgKG5vZGUgIT0gbnVsbCkgewogICAgICAgICAg\nICBub2RlLmpvaW4gPSBqb2luOwogICAgICAgICAgICBnZXROb2RlKGpvaW4s\nIGpvaW4uZ2V0SW5kZXgyKCkpLmpvaW4gPSBqb2luOwogICAgICAgICAgICBf\nc29ydGVkID0gbnVsbDsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgYWRk\nTm9kZShqb2luKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBhZGRBbGwoSm9pblNldCBqcykgewogICAgICAgIGlm\nIChqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgYm9vbGVhbiBhZGRlZCA9IGZhbHNlOwogICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0ganMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAg\nICAgICAgICAgIGFkZGVkID0gYWRkKChKb2luKSBpdHIubmV4dCgpKSB8fCBh\nZGRlZDsKICAgICAgICByZXR1cm4gYWRkZWQ7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgdGhlIGdpdmUgam9pbiB0byBvdXIgZ3JhcGguCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGROb2RlKEpvaW4gam9pbikgewogICAgICAg\nIF9zb3J0ZWQgPSBudWxsOwoKICAgICAgICBpbnQgc2l6ZSA9IE1hdGgubWF4\nKGpvaW4uZ2V0SW5kZXgxKCksIGpvaW4uZ2V0SW5kZXgyKCkpICsgMTsKICAg\nICAgICB3aGlsZSAoX2dyYXBoLnNpemUoKSA8IHNpemUpCiAgICAgICAgICAg\nIF9ncmFwaC5hZGQobnVsbCk7CgogICAgICAgIE5vZGUgbm9kZSA9IChOb2Rl\nKSBfZ3JhcGguZ2V0KGpvaW4uZ2V0SW5kZXgxKCkpOwogICAgICAgIGlmIChu\nb2RlID09IG51bGwpCiAgICAgICAgICAgIF9ncmFwaC5zZXQoam9pbi5nZXRJ\nbmRleDEoKSwgbmV3IE5vZGUoam9pbiwgdHJ1ZSkpOwogICAgICAgIGVsc2Ug\newogICAgICAgICAgICB3aGlsZSAobm9kZS5uZXh0ICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBub2RlID0gbm9kZS5uZXh0OwogICAgICAgICAgICBub2Rl\nLm5leHQgPSBuZXcgTm9kZShqb2luLCB0cnVlKTsKICAgICAgICB9CgogICAg\nICAgIG5vZGUgPSAoTm9kZSkgX2dyYXBoLmdldChqb2luLmdldEluZGV4Migp\nKTsKICAgICAgICBpZiAobm9kZSA9PSBudWxsKQogICAgICAgICAgICBfZ3Jh\ncGguc2V0KGpvaW4uZ2V0SW5kZXgyKCksIG5ldyBOb2RlKGpvaW4sIGZhbHNl\nKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHdoaWxlIChub2RlLm5l\neHQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHQ7\nCiAgICAgICAgICAgIG5vZGUubmV4dCA9IG5ldyBOb2RlKGpvaW4sIGZhbHNl\nKTsKICAgICAgICB9CiAgICAgICAgX3NpemUrKzsKICAgIH0KCiAgICBwdWJs\naWMgSXRlcmF0b3IgaXRlcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBJ\ndGVyYXRvcigpIHsKICAgICAgICAgICAgcHJpdmF0ZSBOb2RlIF9uZXh0ID0g\nbnVsbDsKICAgICAgICAgICAgcHJpdmF0ZSBpbnQgX2lkeCA9IC0xOwoKICAg\nICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzTmV4dCgpIHsKICAgICAgICAg\nICAgICAgIGlmIChfbmV4dCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwoKICAgICAgICAgICAgICAgIHdoaWxlICgrK19pZHgg\nPCBfZ3JhcGguc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgX25leHQg\nPSAoTm9kZSkgX2dyYXBoLmdldChfaWR4KTsKICAgICAgICAgICAgICAgICAg\nICB3aGlsZSAoX25leHQgIT0gbnVsbCAmJiAhX25leHQuZm9yd2FyZCkKICAg\nICAgICAgICAgICAgICAgICAgICAgX25leHQgPSBfbmV4dC5uZXh0OwogICAg\nICAgICAgICAgICAgICAgIGlmIChfbmV4dCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIE9iamVjdCBuZXh0KCkgewogICAgICAgICAg\nICAgICAgaWYgKCFoYXNOZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE5vU3VjaEVsZW1lbnRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nICAgIEpvaW4gaiA9IF9uZXh0LmpvaW47CiAgICAgICAgICAgICAgICBkbyB7\nCiAgICAgICAgICAgICAgICAgICAgX25leHQgPSBfbmV4dC5uZXh0OwogICAg\nICAgICAgICAgICAgfSB3aGlsZSAoX25leHQgIT0gbnVsbCAmJiAhX25leHQu\nZm9yd2FyZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gajsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhj\nZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIHJlbW92ZShKb2luIGpvaW4pIHsKICAgICAgICBp\nZiAoam9pbiA9PSBudWxsIHx8IF9ncmFwaC5zaXplKCkgPD0gam9pbi5nZXRJ\nbmRleDEoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlm\nIChyZW1vdmUoam9pbiwgam9pbi5nZXRJbmRleDEoKSkpIHsKICAgICAgICAg\nICAgX3NpemUtLTsKICAgICAgICAgICAgcmV0dXJuIHJlbW92ZShqb2luLCBq\nb2luLmdldEluZGV4MigpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRWFjaCBqb2luIGlzIHJlY29y\nZGVkIG9uZSBhdCBpdHMgZmlyc3QgaW5kZXggYW5kIG9uY2UgYXQgaXRzIHNl\nY29uZDsKICAgICAqIHJlbW92ZSB0aGUgam9pbiBhdCBvbmUgb2YgaXRzIGlu\nZGV4ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiByZW1vdmUoSm9p\nbiBqb2luLCBpbnQgaWR4KSB7CiAgICAgICAgTm9kZSBub2RlID0gKE5vZGUp\nIF9ncmFwaC5nZXQoaWR4KTsKICAgICAgICBmb3IgKE5vZGUgcHJldiA9IG51\nbGw7IG5vZGUgIT0gbnVsbDsgcHJldiA9IG5vZGUsIG5vZGUgPSBub2RlLm5l\neHQpIHsKICAgICAgICAgICAgaWYgKCFub2RlLmpvaW4uZXF1YWxzKGpvaW4p\nKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICBpZiAo\ncHJldiAhPSBudWxsKQogICAgICAgICAgICAgICAgcHJldi5uZXh0ID0gbm9k\nZS5uZXh0OwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIF9n\ncmFwaC5zZXQoaWR4LCBub2RlLm5leHQpOwogICAgICAgICAgICAgICAgLy8g\ndHJpbSB0byBzaXplCiAgICAgICAgICAgICAgICB3aGlsZSAoIV9ncmFwaC5p\nc0VtcHR5KCkgJiYgX2dyYXBoLmdldChpZHgpID09IG51bGwKICAgICAgICAg\nICAgICAgICAgICAmJiBpZHggPT0gX2dyYXBoLnNpemUoKSAtIDEpCiAgICAg\nICAgICAgICAgICAgICAgX2dyYXBoLnJlbW92ZShpZHgtLSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBy\nZW1vdmVBbGwoSm9pblNldCBqcykgewogICAgICAgIGJvb2xlYW4gcmVtZCA9\nIGZhbHNlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0ganMuaXRlcmF0\nb3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIHJlbWQgPSByZW1v\ndmUoKEpvaW4pIGl0ci5uZXh0KCkpIHx8IHJlbWQ7CiAgICAgICAgcmV0dXJu\nIHJlbWQ7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gcmV0YWluQWxsKEpv\naW5TZXQganMpIHsKICAgICAgICBib29sZWFuIHJlbWQgPSBmYWxzZTsKICAg\nICAgICBKb2luIGpvaW47CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBp\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2lu\nID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmICghanMuY29u\ndGFpbnMoam9pbikpCiAgICAgICAgICAgICAgICByZW1kID0gcmVtb3ZlKGpv\naW4pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVtZDsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBfZ3JhcGguY2xlYXIo\nKTsKICAgICAgICBfc29ydGVkID0gbnVsbDsKICAgICAgICBfc2l6ZSA9IDA7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gY29udGFpbnMoSm9pbiBqb2lu\nKSB7CiAgICAgICAgcmV0dXJuIGdldFJlY29yZGVkSm9pbihqb2luKSAhPSBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQWxsKEpv\naW5TZXQganMpIHsKICAgICAgICBpZiAoanMuX3NpemUgPiBfc2l6ZSB8fCBq\ncy5fZ3JhcGguc2l6ZSgpID4gX2dyYXBoLnNpemUoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0ganMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGlmICgh\nY29udGFpbnMoKEpvaW4pIGl0ci5uZXh0KCkpKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIF9z\naXplID09IDA7CiAgICB9CgogICAgcHVibGljIGludCBzaXplKCkgewogICAg\nICAgIHJldHVybiBfc2l6ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IHRo\naXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICghKG90\naGVyIGluc3RhbmNlb2YgSm9pblNldCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICByZXR1cm4gX2dyYXBoLmVxdWFscygoKEpvaW5TZXQp\nIG90aGVyKS5fZ3JhcGgpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgaGFzaENv\nZGUoKSB7CiAgICAgICAgcmV0dXJuIF9ncmFwaC5oYXNoQ29kZSgpOwogICAg\nfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgU3Ry\naW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBi\ndWYuYXBwZW5kKCJbIik7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBp\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYu\nYXBwZW5kKCI8IikuYXBwZW5kKGl0ci5uZXh0KCkpLmFwcGVuZCgiPiIpOwog\nICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIiwgIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBi\ndWYuYXBwZW5kKCJdIikudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEEgZ3JhcGggbm9kZS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nY2xhc3MgTm9kZQogICAgICAgIGltcGxlbWVudHMgQ2xvbmVhYmxlIHsKCiAg\nICAgICAgcHVibGljIEpvaW4gam9pbjsKICAgICAgICBwdWJsaWMgTm9kZSBu\nZXh0OwogICAgICAgIHB1YmxpYyBib29sZWFuIGZvcndhcmQ7CgogICAgICAg\nIHB1YmxpYyBOb2RlKEpvaW4gam9pbiwgYm9vbGVhbiBmb3J3YXJkKSB7CiAg\nICAgICAgICAgIHRoaXMuam9pbiA9IGpvaW47CiAgICAgICAgICAgIHRoaXMu\nZm9yd2FyZCA9IGZvcndhcmQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\naW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQgcnMgPSAxNzsKICAg\nICAgICAgICAgcnMgPSAzNyAqIHJzICsgam9pbi5oYXNoQ29kZSgpOwogICAg\nICAgICAgICBpZiAobmV4dCAhPSBudWxsKQogICAgICAgICAgICAgICAgcnMg\nPSAzNyAqIHJzICsgbmV4dC5oYXNoQ29kZSgpOwogICAgICAgICAgICByZXR1\ncm4gcnM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVh\nbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlmICghKG90aGVyIGlu\nc3RhbmNlb2YgTm9kZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgIE5vZGUgbm9kZSA9IChOb2RlKSBvdGhlcjsKICAgICAg\nICAgICAgcmV0dXJuIE9iamVjdFV0aWxzLmVxdWFscyhqb2luLCBub2RlLmpv\naW4pCiAgICAgICAgICAgICAgICAmJiBPYmplY3RVdGlscy5lcXVhbHMobmV4\ndCwgbm9kZS5uZXh0KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmpl\nY3QgY2xvbmUoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBOb2RlIG5vZGUgPSAoTm9kZSkgc3VwZXIuY2xvbmUoKTsKICAgICAgICAg\nICAgICAgIGlmIChub2RlLm5leHQgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBub2RlLm5leHQgPSAoTm9kZSkgbm9kZS5uZXh0LmNsb25lKCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICAgICAgfSBjYXRj\naCAoQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24gY25zZSkgewogICAgICAg\nICAgICAgICAgLy8gY2FuJ3QgaGFwcGVuCiAgICAgICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIGpv\naW4gKyAiKCIgKyAoKGZvcndhcmQpID8gImZvcndhcmQiIDogImJhY2t3YXJk\nIikgKyAiKSIKICAgICAgICAgICAgICAgICsgIjsgbmV4dDogIiArIG5leHQ7\nCiAgICAgICAgfQogICAgfQp9CQo=\n","encoding":"base64"}

