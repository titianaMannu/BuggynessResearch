{"sha":"2714a84482e17fc4b69d6b9b2f1be8a467bd6987","node_id":"MDQ6QmxvYjIwNjM2NDoyNzE0YTg0NDgyZTE3ZmM0YjY5ZDZiOWIyZjFiZThhNDY3YmQ2OTg3","size":43980,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2714a84482e17fc4b69d6b9b2f1be8a467bd6987","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0\nb3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkpE\nQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJWYWx1ZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5JbmRleDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5QcmltYXJ5S2V5Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRlbGVnYXRp\nbmdEYXRhYmFzZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5qZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRp\nb247CgppbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogRGljdGlv\nbmFyeSBmb3IgT3JhY2xlLgogKi8KcHVibGljIGNsYXNzIE9yYWNsZURpY3Rp\nb25hcnkKICAgIGV4dGVuZHMgREJEaWN0aW9uYXJ5IHsKCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIFN0cmluZyBTRUxFQ1RfSElOVCA9ICJvcGVuanBhLmhp\nbnQuT3JhY2xlU2VsZWN0SGludCI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIFN0cmluZyBWRU5ET1JfT1JBQ0xFID0gIm9yYWNsZSI7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEJFSEFWRV9PVEhFUiA9IDA7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX09SQUNMRSA9IDE7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX0RBVEFESVJFQ1QzMSA9\nIDI7CgogICAgcHJpdmF0ZSBzdGF0aWMgQmxvYiBFTVBUWV9CTE9CID0gbnVs\nbDsKICAgIHByaXZhdGUgc3RhdGljIENsb2IgRU1QVFlfQ0xPQiA9IG51bGw7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBM\nb2NhbGl6ZXIuZm9yUGFja2FnZQogICAgICAgIChPcmFjbGVEaWN0aW9uYXJ5\nLmNsYXNzKTsKCiAgICAvKioKICAgICAqIElmIHRydWUsIHRoZW4gc2ltdWxh\ndGUgYXV0by1hc3NpZ25lZCB2YWx1ZXMgaW4gT3JhY2xlIGJ5CiAgICAgKiB1\nc2luZyBhIHRyaWdnZXIgdGhhdCBpbnNlcnRzIGEgc2VxdWVuY2UgdmFsdWUg\naW50byB0aGUKICAgICAqIHByaW1hcnkga2V5IHZhbHVlIHdoZW4gYSByb3cg\naXMgaW5zZXJ0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHVzZVRy\naWdnZXJzRm9yQXV0b0Fzc2lnbiA9IGZhbHNlOwoKICAgIC8qKgogICAgICog\nVGhlIGdsb2JhbCBzZXF1ZW5jZSBuYW1lIHRvIHVzZSBmb3IgYXV0b2Fzc2ln\nbiBzaW11bGF0aW9uLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGF1dG9B\nc3NpZ25TZXF1ZW5jZU5hbWUgPSBudWxsOwoKICAgIC8qKgogICAgICogRmxh\nZyB0byB1c2UgT3BlbkpQQSAwLjMgc3R5bGUgbmFtaW5nIGZvciBhdXRvIGFz\nc2lnbiBzZXF1ZW5jZSBuYW1lIGFuZAogICAgICogdHJpZ2dlciBuYW1lIGZv\nciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gb3BlbmpwYTNHZW5lcmF0ZWRLZXlOYW1lcyA9IGZhbHNlOwoK\nICAgIC8qKgogICAgICogSWYgdHJ1ZSwgdGhlbiBPcGVuSlBBIHdpbGwgYXR0\nZW1wdCB0byB1c2UgdGhlIHNwZWNpYWwKICAgICAqIE9yYWNsZVByZXBhcmVk\nU3RhdGVtZW50LnNldEZvcm1PZlVzZSBtZXRob2QgdG8KICAgICAqIGNvbmZp\nZ3VyZSBzdGF0ZW1lbnRzIHRoYXQgaXQgZGV0ZWN0cyBhcmUgb3BlcmF0aW5n\nIG9uIHVuaWNvZGUgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VTZXRGb3JtT2ZVc2VGb3JVbmljb2RlID0gdHJ1ZTsKCiAgICAvLyBz\nb21lIG9yYWNsZSBkcml2ZXJzIGhhdmUgcHJvYmxlbXMgd2l0aCBzZWxlY3Qg\nZm9yIHVwZGF0ZTsgd2FybiB0aGUKICAgIC8vIGZpcnN0IHRpbWUgbG9ja2lu\nZyBpcyBhdHRlbXB0ZWQKICAgIHByaXZhdGUgYm9vbGVhbiBfY2hlY2tlZFVw\nZGF0ZUJ1ZyA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFuIF93YXJuZWRD\naGFyQ29sdW1uID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4gX3dhcm5l\nZE5jaGFyQ29sdW1uID0gZmFsc2U7CiAgICBwcml2YXRlIGludCBfZHJpdmVy\nQmVoYXZpb3IgPSAtMTsKCiAgICAvLyBjYWNoZSBsb2IgbWV0aG9kcwogICAg\ncHJpdmF0ZSBNZXRob2QgX3B1dEJ5dGVzID0gbnVsbDsKICAgIHByaXZhdGUg\nTWV0aG9kIF9wdXRTdHJpbmcgPSBudWxsOwogICAgcHJpdmF0ZSBNZXRob2Qg\nX3B1dENoYXJzID0gbnVsbDsKICAgIAogICAgLy8gYmF0Y2ggbGltaXQKICAg\nIHByaXZhdGUgaW50IGRlZmF1bHRCYXRjaExpbWl0ID0gMTAwOwoKICAgIHB1\nYmxpYyBPcmFjbGVEaWN0aW9uYXJ5KCkgewogICAgICAgIHBsYXRmb3JtID0g\nIk9yYWNsZSI7CiAgICAgICAgdmFsaWRhdGlvblNRTCA9ICJTRUxFQ1QgU1lT\nREFURSBGUk9NIERVQUwiOwogICAgICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0g\nIlNFTEVDVCB7MH0uTkVYVFZBTCBGUk9NIERVQUwiOwogICAgICAgIHN0cmlu\nZ0xlbmd0aEZ1bmN0aW9uID0gIkxFTkdUSCh7MH0pIjsKICAgICAgICBqb2lu\nU3ludGF4ID0gU1lOVEFYX0RBVEFCQVNFOwogICAgICAgIG1heFRhYmxlTmFt\nZUxlbmd0aCA9IDMwOwogICAgICAgIG1heENvbHVtbk5hbWVMZW5ndGggPSAz\nMDsKICAgICAgICBtYXhJbmRleE5hbWVMZW5ndGggPSAzMDsKICAgICAgICBt\nYXhDb25zdHJhaW50TmFtZUxlbmd0aCA9IDMwOwogICAgICAgIG1heEVtYmVk\nZGVkQmxvYlNpemUgPSA0MDAwOwogICAgICAgIG1heEVtYmVkZGVkQ2xvYlNp\nemUgPSA0MDAwOwogICAgICAgIGluQ2xhdXNlTGltaXQgPSAxMDAwOwoKICAg\nICAgICBzdXBwb3J0c0RlZmVycmVkQ29uc3RyYWludHMgPSB0cnVlOwogICAg\nICAgIHN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5jdENsYXVzZSA9IGZhbHNl\nOwogICAgICAgIHN1cHBvcnRzU2VsZWN0U3RhcnRJbmRleCA9IHRydWU7CiAg\nICAgICAgc3VwcG9ydHNTZWxlY3RFbmRJbmRleCA9IHRydWU7CgogICAgICAg\nIHN5c3RlbVNjaGVtYVNldC5hZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3Ry\naW5nW117CiAgICAgICAgICAgICJDVFhTWVMiLCAiTURTWVMiLCAiU1lTIiwg\nIlNZU1RFTSIsICJXS1NZUyIsICJXTVNZUyIsICJYREIiLAogICAgICAgIH0p\nKTsKCiAgICAgICAgc3VwcG9ydHNYTUxDb2x1bW4gPSB0cnVlOwogICAgICAg\nIHhtbFR5cGVOYW1lID0gIlhNTFR5cGUiOwogICAgICAgIGJpZ2ludFR5cGVO\nYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAgYml0VHlwZU5hbWUgPSAiTlVN\nQkVSezB9IjsKICAgICAgICBkZWNpbWFsVHlwZU5hbWUgPSAiTlVNQkVSezB9\nIjsKICAgICAgICBkb3VibGVUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAg\nICAgIGludGVnZXJUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIG51\nbWVyaWNUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIHNtYWxsaW50\nVHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICB0aW55aW50VHlwZU5h\nbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBsb25nVmFyY2hhclR5cGVOYW1l\nID0gIkxPTkciOwogICAgICAgIGJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwog\nICAgICAgIHZhcmJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwogICAgICAgIGxv\nbmdWYXJiaW5hcnlUeXBlTmFtZSA9ICJCTE9CIjsKICAgICAgICB0aW1lVHlw\nZU5hbWUgPSAiREFURSI7CiAgICAgICAgdmFyY2hhclR5cGVOYW1lID0gIlZB\nUkNIQVIyezB9IjsKICAgICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRB\nbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJM\nT05HIFJBVyIsICJSQVciLCAiTE9ORyIsICJSRUYiLAogICAgICAgIH0pKTsK\nICAgICAgICByZXNlcnZlZFdvcmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3Qo\nbmV3IFN0cmluZ1tdewogICAgICAgICAgICAiQUNDRVNTIiwgIkFVRElUIiwg\nIkNMVVNURVIiLCAiQ09NTUVOVCIsICJDT01QUkVTUyIsICJFWENMVVNJVkUi\nLAogICAgICAgICAgICAiRklMRSIsICJJREVOVElGSUVEIiwgIklOQ1JFTUVO\nVCIsICJJTkRFWCIsICJJTklUSUFMIiwgIkxPQ0siLAogICAgICAgICAgICAi\nTE9ORyIsICJNQVhFWFRFTlRTIiwgIk1JTlVTIiwgIk1PREUiLCAiTk9BVURJ\nVCIsICJOT0NPTVBSRVNTIiwKICAgICAgICAgICAgIk5PV0FJVCIsICJPRkZM\nSU5FIiwgIk9OTElORSIsICJQQ1RGUkVFIiwgIlJPVyIsCiAgICAgICAgfSkp\nOwoKICAgICAgICBzdWJzdHJpbmdGdW5jdGlvbk5hbWUgPSAiU1VCU1RSIjsK\nICAgICAgICBzdXBlci5zZXRCYXRjaExpbWl0KGRlZmF1bHRCYXRjaExpbWl0\nKTsKICAgICAgICBzZWxlY3RXb3JkU2V0LmFkZCgiV0lUSCIpOwogICAgICAg\nIHJlcG9ydHNTdWNjZXNzTm9JbmZvT25CYXRjaFVwZGF0ZXMgPSB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGVuZENvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgc3VwZXIuZW5kQ29uZmlndXJhdGlvbigpOwogICAgICAgIGlmICh1\nc2VUcmlnZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHN1cHBvcnRz\nQXV0b0Fzc2lnbiA9IHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29u\nbmVjdGVkQ29uZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuY29ubmVjdGVk\nQ29uZmlndXJhdGlvbihjb25uKTsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9y\nID09IG51bGwpIHsKICAgICAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBTdHJpbmcgdXJs\nID0gKG1ldGEuZ2V0VVJMKCkgPT0gbnVsbCkgPyAiIiA6IG1ldGEuZ2V0VVJM\nKCk7CiAgICAgICAgICAgIFN0cmluZyBkcml2ZXJOYW1lID0gbWV0YS5nZXRE\ncml2ZXJOYW1lKCk7CiAgICAgICAgICAgIFN0cmluZyBtZXRhZGF0YUNsYXNz\nTmFtZTsKICAgICAgICAgICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBEZWxlZ2F0\naW5nRGF0YWJhc2VNZXRhRGF0YSkKICAgICAgICAgICAgICAgIG1ldGFkYXRh\nQ2xhc3NOYW1lID0gKChEZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSkgbWV0\nYSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdhdGUo\nKS5nZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgbWV0YWRhdGFDbGFzc05hbWUgPSBtZXRhLmdldENsYXNz\nKCkuZ2V0TmFtZSgpOwoKICAgICAgICAgICAgLy8gY2hlY2sgYm90aCB0aGUg\nZHJpdmVyIGNsYXNzIG5hbWUgYW5kIHRoZSBVUkwgZm9yIGtub3duIHBhdHRl\ncm5zCiAgICAgICAgICAgIGlmIChtZXRhZGF0YUNsYXNzTmFtZS5zdGFydHNX\naXRoKCJvcmFjbGUuIikKICAgICAgICAgICAgICAgIHx8IHVybC5pbmRleE9m\nKCJqZGJjOm9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAgfHwgIk9y\nYWNsZSBKREJDIGRyaXZlciIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAg\nICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfT1JBQ0xFICsgbWV0\nYS5nZXREcml2ZXJNYWpvclZlcnNpb24oKQogICAgICAgICAgICAgICAgICAg\nICsgbWV0YS5nZXREcml2ZXJNaW5vclZlcnNpb24oKTsKCiAgICAgICAgICAg\nICAgICBTdHJpbmcgcHJvZHVjdFZlcnNpb24gPSBtZXRhLmdldERhdGFiYXNl\nUHJvZHVjdFZlcnNpb24oKQogICAgICAgICAgICAgICAgICAgIC5zcGxpdCgi\nUmVsZWFzZSAiLDApWzFdLnNwbGl0KCJcXC4iLDApWzBdOwogICAgICAgICAg\nICAgICAgaW50IHJlbGVhc2UgPSBJbnRlZ2VyLnBhcnNlSW50KHByb2R1Y3RW\nZXJzaW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8g\nd2FybiBzcWw5MgogICAgICAgICAgICAgICAgaWYgKHJlbGVhc2UgPD0gOCkg\newogICAgICAgICAgICAgICAgICAgIGlmIChqb2luU3ludGF4ID09IFNZTlRB\nWF9TUUw5MiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgib3JhY2xlLXN5bnRheCIp\nKTsKICAgICAgICAgICAgICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFYX0RB\nVEFCQVNFOwogICAgICAgICAgICAgICAgICAgIGRhdGVUeXBlTmFtZSA9ICJE\nQVRFIjsgLy8gYWRkZWQgb3JhY2xlIDkKICAgICAgICAgICAgICAgICAgICB0\naW1lc3RhbXBUeXBlTmFtZSA9ICJEQVRFIjsgLy8gYWRkZWQgb3JhY2xlIDkK\nICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c1hNTENvbHVtbiA9IGZhbHNl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHNl\nbGVjdCBvZiBhbiB4bWwgY29sdW1uIHJlcXVpcmVzICIuZ2V0U3RyaW5nVmFs\nKCkiCiAgICAgICAgICAgICAgICAgICAgLy8gc3VmZml4LiBlZy4gdDAueG1s\nY29sLmdldFN0cmluZ1ZhbCgpCiAgICAgICAgICAgICAgICAgICAgZ2V0U3Ry\naW5nVmFsID0gIi5nZXRTdHJpbmdWYWwoKSI7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3RhcnRzV2l0aCgiY29tLmRkdGVr\nLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5kZXhPZigiamRiYzpkYXRh\nZGlyZWN0Om9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAgfHwgIk9y\nYWNsZSIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAgICAgICAgICAgICBk\ncml2ZXJWZW5kb3IgPSBWRU5ET1JfREFUQURJUkVDVCArIG1ldGEuZ2V0RHJp\ndmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAgICAgICAgICArIG1ldGEu\nZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CiAgICAgICAgICAgIH0gZWxzZQog\nICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09USEVSOwog\nICAgICAgIH0KICAgICAgICBjYWNoZURyaXZlckJlaGF2aW9yKGRyaXZlclZl\nbmRvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBjb25zdGFudCBm\nb3IgZHJpdmVycyB3aXRoIGJlaGF2aW9ycyB3ZSBoYXZlIHRvIGRlYWwgd2l0\naC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRHJpdmVyQmVoYXZp\nb3IoU3RyaW5nIGRyaXZlclZlbmRvcikgewogICAgICAgIGlmIChfZHJpdmVy\nQmVoYXZpb3IgIT0gLTEpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nZHJpdmVyVmVuZG9yID0gZHJpdmVyVmVuZG9yLnRvTG93ZXJDYXNlKCk7CiAg\nICAgICAgaWYgKGRyaXZlclZlbmRvci5zdGFydHNXaXRoKFZFTkRPUl9PUkFD\nTEUpKQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3IgPSBCRUhBVkVfT1JB\nQ0xFOwogICAgICAgIGVsc2UgaWYgKGRyaXZlclZlbmRvci5lcXVhbHMoVkVO\nRE9SX0RBVEFESVJFQ1QgKyAiMzAiKQogICAgICAgICAgICB8fCBkcml2ZXJW\nZW5kb3IuZXF1YWxzKFZFTkRPUl9EQVRBRElSRUNUICsgIjMxIikpCiAgICAg\nICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9EQVRBRElSRUNUMzE7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3IgPSBC\nRUhBVkVfT1RIRVI7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbnN1cmUgdGhh\ndCB0aGUgZHJpdmVyIHZlbmRvciBoYXMgYmVlbiBzZXQsIGFuZCBpZiBub3Qs\nIHNldCBpdCBub3cuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGVuc3VyZURy\naXZlclZlbmRvcigpIHsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9yICE9IG51\nbGwpIHsKICAgICAgICAgICAgY2FjaGVEcml2ZXJCZWhhdmlvcihkcml2ZXJW\nZW5kb3IpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLmlu\nZm8oX2xvYy5nZXQoIm9yYWNsZS1jb25uZWN0aW5nLWZvci1kcml2ZXIiKSk7\nCiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBjb25uID0gY29uZi5nZXREYXRhU291cmNlMihudWxs\nKS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIGNvbm5lY3RlZENvbmZp\nZ3VyYXRpb24oY29ubik7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3Rv\ncmUoc2UsIHRoaXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0\nc0xvY2tpbmcoU2VsZWN0IHNlbCkgewogICAgICAgIGlmICghc3VwZXIuc3Vw\ncG9ydHNMb2NraW5nKHNlbCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICByZXR1cm4gIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc2Vs\nLmdldFN0YXJ0SW5kZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVuZEluZGV4\nKCksIHNlbC5pc0Rpc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygpKTsKICAg\nIH0KCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNlbGVjdHMoU2VsZWN0\nIHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJzLAogICAgICAgIGJv\nb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gaWYgcmFuZ2UgZG9lc24n\ndCByZXF1aXJlIGEgc3Vic2VsZWN0IGNhbiB1c2Ugc3VwZXIKICAgICAgICBp\nZiAoIXJlcXVpcmVzU3Vic2VsZWN0Rm9yUmFuZ2Uoc2VsLmdldFN0YXJ0SW5k\nZXgoKSwKICAgICAgICAgICAgc2VsLmdldEVuZEluZGV4KCksIHNlbC5pc0Rp\nc3RpbmN0KCksIHNlbC5nZXRPcmRlcmluZygpKSkKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmdldFNlbGVjdHMoc2VsLCBkaXN0aW5jdElkZW50aWZpZXJz\nLCBmb3JVcGRhdGUpOwoKICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbm8gam9p\nbnMgaW52b2x2ZWQgb3Igd2UncmUgdXNpbmcgYSBmcm9tIHNlbGVjdCBzbwog\nICAgICAgIC8vIHRoYXQgYWxsIGNvbHMgYWxyZWFkeSBoYXZlIHVuaXF1ZSBh\nbGlhc2VzLCBjYW4gdXNlIHN1cGVyCiAgICAgICAgaWYgKHNlbC5nZXRGcm9t\nU2VsZWN0KCkgIT0gbnVsbCB8fCBzZWwuZ2V0VGFibGVBbGlhc2VzKCkuc2l6\nZSgpIDwgMikKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNlbGVjdHMo\nc2VsLCBkaXN0aW5jdElkZW50aWZpZXJzLCBmb3JVcGRhdGUpOwoKICAgICAg\nICAvLyBzaW5jZSBub25lIG9mIHRoZSBjb25kaXRpb25zIGFib3ZlIHdlcmUg\nbWV0LCB3ZSdyZSBkZWFsaW5nIHdpdGgKICAgICAgICAvLyBhIHNlbGVjdCB0\naGF0IHVzZXMgam9pbnMgYW5kIHJlcXVpcmVzIHN1YnNlbGVjdHMgdG8gc2Vs\nZWN0IHRoZQogICAgICAgIC8vIHByb3BlciByYW5nZTsgYWxpYXMgYWxsIGNv\nbHVtbiB2YWx1ZXMgc28gdGhhdCB0aGV5IGFyZSB1bmlxdWUgd2l0aGluCiAg\nICAgICAgLy8gdGhlIHN1YnNlbGVjdAogICAgICAgIFNRTEJ1ZmZlciBzZWxl\nY3RTUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIExpc3QgYWxp\nYXNlczsKICAgICAgICBpZiAoZGlzdGluY3RJZGVudGlmaWVycykKICAgICAg\nICAgICAgYWxpYXNlcyA9IHNlbC5nZXRJZGVudGlmaWVyQWxpYXNlcygpOwog\nICAgICAgIGVsc2UKICAgICAgICAgICAgYWxpYXNlcyA9IHNlbC5nZXRTZWxl\nY3RBbGlhc2VzKCk7CgogICAgICAgIE9iamVjdCBhbGlhczsKICAgICAgICBp\nbnQgaSA9IDA7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBhbGlhc2Vz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGkrKykgewogICAgICAgICAg\nICBhbGlhcyA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChhbGlhcyBp\nbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgICAgIHNlbGVjdFNR\nTC5hcHBlbmQoKFNRTEJ1ZmZlcikgYWxpYXMpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGFsaWFzLnRvU3Ry\naW5nKCkpOwogICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIgQVMgYyIp\nLmFwcGVuZChTdHJpbmcudmFsdWVPZihpKSk7CiAgICAgICAgICAgIGlmIChp\ndHIuaGFzTmV4dCgpKQogICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVu\nZCgiLCAiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGVjdFNRTDsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5PdXRlckpvaW4oaW50IHN5\nbnRheCwgRm9yZWlnbktleSBmaykgewogICAgICAgIGlmICghc3VwZXIuY2Fu\nT3V0ZXJKb2luKHN5bnRheCwgZmspKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKGZrICE9IG51bGwgJiYgc3ludGF4ID09IFNZTlRB\nWF9EQVRBQkFTRSkgewogICAgICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRz\nKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb25zdGFudHMoKS5s\nZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMg\nU1FMQnVmZmVyIHRvTmF0aXZlSm9pbihKb2luIGpvaW4pIHsKICAgICAgICBp\nZiAoam9pbi5nZXRUeXBlKCkgIT0gSm9pbi5UWVBFX09VVEVSKQogICAgICAg\nICAgICByZXR1cm4gdG9UcmFkaXRpb25hbEpvaW4oam9pbik7CgogICAgICAg\nIEZvcmVpZ25LZXkgZmsgPSBqb2luLmdldEZvcmVpZ25LZXkoKTsKICAgICAg\nICBpZiAoZmsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIGJvb2xlYW4gaW52ZXJzZSA9IGpvaW4uaXNGb3JlaWduS2V5SW52\nZXJzZWQoKTsKICAgICAgICBDb2x1bW5bXSBmcm9tID0gKGludmVyc2UpID8g\nZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdl\ndENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0byA9IChpbnZlcnNlKSA/\nIGZrLmdldENvbHVtbnMoKQogICAgICAgICAgICA6IGZrLmdldFByaW1hcnlL\nZXlDb2x1bW5zKCk7CgogICAgICAgIC8vIGRvIGNvbHVtbiBqb2lucwogICAg\nICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAg\nICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmcm9tLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlm\nIChjb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5E\nICIpOwogICAgICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkp\nLmFwcGVuZCgiLiIpLmFwcGVuZChmcm9tW2ldKTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5n\nZXRBbGlhczIoKSkuYXBwZW5kKCIuIikuYXBwZW5kKHRvW2ldKTsKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiKCspIik7CiAgICAgICAgfQoKICAgICAgICAv\nLyBjaGVjayBjb25zdGFudCBqb2lucwogICAgICAgIGlmIChmay5nZXRDb25z\ndGFudENvbHVtbnMoKS5sZW5ndGggPiAwKQogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm9yYWNsZS1jb25zdGFudCIs\nCiAgICAgICAgICAgICAgICBqb2luLmdldFRhYmxlMSgpLCBqb2luLmdldFRh\nYmxlMigpKSkuc2V0RmF0YWwodHJ1ZSk7CgogICAgICAgIGlmIChmay5nZXRD\nb25zdGFudFByaW1hcnlLZXlDb2x1bW5zKCkubGVuZ3RoID4gMCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJvcmFj\nbGUtY29uc3RhbnQiLAogICAgICAgICAgICAgICAgam9pbi5nZXRUYWJsZTEo\nKSwgam9pbi5nZXRUYWJsZTIoKSkpLnNldEZhdGFsKHRydWUpOwogICAgICAg\nIHJldHVybiBidWY7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b1Nl\nbGVjdChTUUxCdWZmZXIgc2VsZWN0LCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLAogICAgICAgIFNRTEJ1ZmZlciB0YWJsZXMsIFNRTEJ1ZmZlciB3\naGVyZSwgU1FMQnVmZmVyIGdyb3VwLAogICAgICAgIFNRTEJ1ZmZlciBoYXZp\nbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAgICAgICBib29sZWFuIGRpc3RpbmN0\nLCBib29sZWFuIGZvclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAg\nICAgICAgU2VsZWN0IHNlbCkgewogICAgICAgIGlmICghX2NoZWNrZWRVcGRh\ndGVCdWcpIHsKICAgICAgICAgICAgZW5zdXJlRHJpdmVyVmVuZG9yKCk7CiAg\nICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgX2RyaXZlckJlaGF2aW9yID09\nIEJFSEFWRV9EQVRBRElSRUNUMzEpCiAgICAgICAgICAgICAgICBsb2cud2Fy\nbihfbG9jLmdldCgiZGQtbG9jay1idWciKSk7CiAgICAgICAgICAgIF9jaGVj\na2VkVXBkYXRlQnVnID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIG5vIHJhbmdlLCB1c2Ugc3RhbmRhcmQgc2VsZWN0CiAgICAgICAgaWYgKHN0\nYXJ0ID09IDAgJiYgZW5kID09IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAg\nICByZXR1cm4gc3VwZXIudG9TZWxlY3Qoc2VsZWN0LCBmZXRjaCwgdGFibGVz\nLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAgICAgIG9yZGVy\nLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSwgc2Vs\nKTsKCiAgICAgICAgLy8gaWYgbm8gc2tpcCwgb3JkZXJpbmcsIG9yIGRpc3Rp\nbmN0IGNhbiB1c2Ugcm93bnVtIGRpcmVjdGx5CiAgICAgICAgU1FMQnVmZmVy\nIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKCFyZXF1\naXJlc1N1YnNlbGVjdEZvclJhbmdlKHN0YXJ0LCBlbmQsIGRpc3RpbmN0LCBv\ncmRlcikpIHsKICAgICAgICAgICAgaWYgKHdoZXJlICE9IG51bGwgJiYgIXdo\nZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQod2hl\ncmUpLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZCgi\nUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAgICAgICAgICAgIHJl\ndHVybiBzdXBlci50b1NlbGVjdChzZWxlY3QsIGZldGNoLCB0YWJsZXMsIGJ1\nZiwgZ3JvdXAsIGhhdmluZywKICAgICAgICAgICAgICAgIG9yZGVyLCBkaXN0\naW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSwgc2VsKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHRoZXJlIGlzIG9yZGVyaW5nLCBza2lw\nLCBvciBkaXN0aW5jdCB3ZSBoYXZlIHRvIHVzZSBzdWJzZWxlY3RzCiAgICAg\nICAgU1FMQnVmZmVyIG5ld3NlbCA9IHN1cGVyLnRvU2VsZWN0KHNlbGVjdCwg\nZmV0Y2gsIHRhYmxlcywgd2hlcmUsCiAgICAgICAgICAgIGdyb3VwLCBoYXZp\nbmcsIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25nLk1BWF9W\nQUxVRSwKICAgICAgICAgICAgc2VsKTsKCiAgICAgICAgLy8gaWYgbm8gc2tp\ncCwgY2FuIHVzZSBzaW5nbGUgbmVzdGVkIHN1YnNlbGVjdAogICAgICAgIGlm\nIChzdGFydCA9PSAwKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoZ2V0U2Vs\nZWN0T3BlcmF0aW9uKGZldGNoKSArICIgKiBGUk9NICgiKTsKICAgICAgICAg\nICAgYnVmLmFwcGVuZChuZXdzZWwpOwogICAgICAgICAgICBidWYuYXBwZW5k\nKCIpIFdIRVJFIFJPV05VTSA8PSAiKS5hcHBlbmRWYWx1ZShlbmQpOwogICAg\nICAgICAgICByZXR1cm4gYnVmOwogICAgICAgIH0KCiAgICAgICAgLy8gd2l0\naCBhIHNraXAsIHdlIGhhdmUgdG8gdXNlIGEgZG91YmxlLW5lc3RlZCBzdWJz\nZWxlY3QgdG8gcHV0CiAgICAgICAgLy8gd2hlcmUgY29uZGl0aW9ucyBvbiB0\naGUgcm93bnVtCiAgICAgICAgYnVmLmFwcGVuZChnZXRTZWxlY3RPcGVyYXRp\nb24oZmV0Y2gpCiAgICAgICAgICAgICsgIiAqIEZST00gKFNFTEVDVCByLios\nIFJPV05VTSBSTlVNIEZST00gKCIpOwogICAgICAgIGJ1Zi5hcHBlbmQobmV3\nc2VsKTsKICAgICAgICBidWYuYXBwZW5kKCIpIHIiKTsKICAgICAgICBpZiAo\nZW5kICE9IExvbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgV0hFUkUgUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVlKGVuZCk7CiAgICAg\nICAgYnVmLmFwcGVuZCgiKSBXSEVSRSBSTlVNID4gIikuYXBwZW5kVmFsdWUo\nc3RhcnQpOwogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgc2VsZWN0IHdpdGggdGhlIGdpdmVu\nIHBhcmFtZXRlcnMgbmVlZHMgYQogICAgICogc3Vic2VsZWN0IHRvIGFwcGx5\nIGEgcmFuZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiByZXF1aXJl\nc1N1YnNlbGVjdEZvclJhbmdlKGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAg\nICAgIGJvb2xlYW4gZGlzdGluY3QsIFNRTEJ1ZmZlciBvcmRlcikgewogICAg\nICAgIGlmIChzdGFydCA9PSAwICYmIGVuZCA9PSBMb25nLk1BWF9WQUxVRSkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBzdGFy\ndCAhPSAwIHx8IGRpc3RpbmN0IHx8IChvcmRlciAhPSBudWxsICYmICFvcmRl\nci5pc0VtcHR5KCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdG8g\nc2VlIGlmIHdlIGhhdmUgc2V0IHRoZSB7QGxpbmsgI1NFTEVDVF9ISU5UfSBp\nbiB0aGUKICAgICAqIGZldGNoIGNvbmZpZ3VyYWl0b24sIGFuZCBpZiBzbywg\nYXBwZW5kIHRoZSBPcmFjaGUgaGludCBhZnRlciB0aGUKICAgICAqICJTRUxF\nQ1QiIHBhcnQgb2YgdGhlIHF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGdldFNlbGVjdE9wZXJhdGlvbihKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgT2JqZWN0IGhpbnQgPSBmZXRjaCA9PSBudWxs\nID8gbnVsbCA6IGZldGNoLmdldEhpbnQoU0VMRUNUX0hJTlQpOwogICAgICAg\nIFN0cmluZyBzZWxlY3QgPSAiU0VMRUNUIjsKICAgICAgICBpZiAoaGludCAh\nPSBudWxsKQogICAgICAgICAgICBzZWxlY3QgKz0gIiAiICsgaGludDsKICAg\nICAgICByZXR1cm4gc2VsZWN0OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\ndFN0cmluZyhQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgU3Ry\naW5nIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIC8vIG9yYWNsZSBOQ0hBUi9OVkFSQ0hB\nUi9OQ0xPQiB1bmljb2RlIGNvbHVtbnMgcmVxdWlyZSBzb21lCiAgICAgICAg\nLy8gc3BlY2lhbCBoYW5kbGluZyB0byBjb25maWd1cmUgdGhlbSBjb3JyZWN0\nbHk7IHNlZToKICAgICAgICAvLyBodHRwOi8vd3d3Lm9yYWNsZS5jb20vdGVj\naG5vbG9neS9zYW1wbGVfY29kZS90ZWNoL2phdmEvCiAgICAgICAgLy8gc3Fs\nal9qZGJjL2ZpbGVzLzlpX2pkYmMvTkNIQVJzdXBwb3J0NFVuaWNvZGVTYW1w\nbGUvUmVhZG1lLmh0bWwKICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSAoY29s\nID09IG51bGwpID8gbnVsbCA6IGNvbC5nZXRUeXBlTmFtZSgpOwogICAgICAg\nIGlmICh1c2VTZXRGb3JtT2ZVc2VGb3JVbmljb2RlICYmIHR5cGVOYW1lICE9\nIG51bGwgJiYKICAgICAgICAgICAgKHR5cGVOYW1lLnRvTG93ZXJDYXNlKCku\nc3RhcnRzV2l0aCgibnZhcmNoYXIiKSB8fAogICAgICAgICAgICAgICAgdHlw\nZU5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJuY2hhciIpIHx8CiAg\nICAgICAgICAgICAgICB0eXBlTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dp\ndGgoIm5jbG9iIikpKSB7CiAgICAgICAgICAgIFN0YXRlbWVudCBpbm5lciA9\nIHN0bW50OwogICAgICAgICAgICBpZiAoaW5uZXIgaW5zdGFuY2VvZiBEZWxl\nZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpCiAgICAgICAgICAgICAgICBpbm5l\nciA9ICgoRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KSBpbm5lcikuCiAg\nICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdhdGUoKTsKICAg\nICAgICAgICAgaWYgKGlzT3JhY2xlUHJlcGFyZWRTdGF0ZW1lbnQoaW5uZXIp\nKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIGlubmVyLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRGb3JtT2ZVc2UiLAog\nICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNz\nLCBzaG9ydC5jbGFzcyB9KS4KICAgICAgICAgICAgICAgICAgICAgICAgaW52\nb2tlKGlubmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJ\nbnRlZ2VyKGlkeCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nQ2xhc3MuZm9yTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAoIm9yYWNsZS5qZGJjLk9yYWNsZVByZXBhcmVkU3RhdGVtZW50Iiku\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpZWxk\nKCJGT1JNX05DSEFSIikuZ2V0KG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLndhcm4oZSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIV93YXJuZWRO\nY2hhckNvbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICBfd2FybmVkTmNoYXJDb2x1bW4gPSB0cnVlOwogICAgICAgICAg\nICAgICAgbG9nLndhcm4oX2xvYy5nZXQoInVuY29uZmlndXJlZC1uY2hhci1j\nb2xzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBj\nYWxsIHNldEZpeGVkQ0hBUiBmb3IgZml4ZWQgd2lkdGggY2hhcmFjdGVyIGNv\nbHVtbnMgdG8gZ2V0IHBhZGRpbmcKICAgICAgICAvLyBzZW1hbnRpY3MKICAg\nICAgICBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5cGUoKSA9PSBUeXBl\ncy5DSEFSCiAgICAgICAgICAgICYmIHZhbCAhPSBudWxsICYmIHZhbC5sZW5n\ndGgoKSAhPSBjb2wuZ2V0U2l6ZSgpKSB7CiAgICAgICAgICAgIFN0YXRlbWVu\ndCBpbm5lciA9IHN0bW50OwogICAgICAgICAgICBpZiAoaW5uZXIgaW5zdGFu\nY2VvZiBEZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQpCiAgICAgICAgICAg\nICAgICBpbm5lciA9ICgoRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KSBp\nbm5lcikuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdh\ndGUoKTsKICAgICAgICAgICAgaWYgKGlzT3JhY2xlUHJlcGFyZWRTdGF0ZW1l\nbnQoaW5uZXIpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIGlubmVyLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJzZXRGaXhl\nZENIQVIiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsg\naW50LmNsYXNzLCBTdHJpbmcuY2xhc3MgfSkuCiAgICAgICAgICAgICAgICAg\nICAgICAgIGludm9rZShpbm5lciwgbmV3IE9iamVjdFtdeyBuZXcgSW50ZWdl\ncihpZHgpLCB2YWwgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgICAgICBsb2cud2FybihlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFfd2FybmVkQ2hhckNv\nbHVtbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAg\nICBfd2FybmVkQ2hhckNvbHVtbiA9IHRydWU7CiAgICAgICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgidW5wYWRkZWQtY2hhci1jb2xzIikpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN1cGVyLnNldFN0cmluZyhz\ndG1udCwgaWR4LCB2YWwsIGNvbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50\nIGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoKGNvbFR5cGUgPT0gVHlwZXMu\nQ0xPQiB8fCBjb2xUeXBlID09IFR5cGVzLkJMT0IpICYmIGNvbC5pc05vdE51\nbGwoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm51bGwtYmxvYi1pbi1ub3QtbnVsbGFibGUiLCBjb2wKICAgICAg\nICAgICAgICAgIC5nZXRGdWxsTmFtZSgpKSk7CiAgICAgICAgaWYgKGNvbFR5\ncGUgPT0gVHlwZXMuQkxPQiAmJiBfZHJpdmVyQmVoYXZpb3IgPT0gQkVIQVZF\nX09SQUNMRSkKICAgICAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgsIGdldEVt\ncHR5QmxvYigpKTsKICAgICAgICBlbHNlIGlmIChjb2xUeXBlID09IFR5cGVz\nLkNMT0IgJiYgX2RyaXZlckJlaGF2aW9yID09IEJFSEFWRV9PUkFDTEUKICAg\nICAgICAgICAgJiYgIWNvbC5pc1hNTCgpKQogICAgICAgICAgICBzdG1udC5z\nZXRDbG9iKGlkeCwgZ2V0RW1wdHlDbG9iKCkpOwogICAgICAgIGVsc2UgaWYg\nKChjb2xUeXBlID09IFR5cGVzLlNUUlVDVCB8fCBjb2xUeXBlID09IFR5cGVz\nLk9USEVSKQogICAgICAgICAgICAmJiBjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0\nVHlwZU5hbWUoKSAhPSBudWxsKQogICAgICAgICAgICBzdG1udC5zZXROdWxs\nKGlkeCwgVHlwZXMuU1RSVUNULCBjb2wuZ2V0VHlwZU5hbWUoKSk7CiAgICAg\nICAgICAgIC8vIHNvbWUgdmVyc2lvbnMgb2YgdGhlIE9yYWNsZSBKREJDIGRy\naXZlciB3aWxsIGZhaWwgaWYgY2FsbGluZwogICAgICAgICAgICAvLyBzZXRO\ndWxsIHdpdGggREFURTsgc2VlIGJ1ZyAjMTE3MQogICAgICAgIGVsc2UgaWYg\nKGNvbFR5cGUgPT0gVHlwZXMuREFURSkKICAgICAgICAgICAgc3VwZXIuc2V0\nTnVsbChzdG1udCwgaWR4LCBUeXBlcy5USU1FU1RBTVAsIGNvbCk7CiAgICAg\nICAgLy8gdGhlIE9yYWNsZSBkcml2ZXIgZG9lcyBub3Qgc3VwcG9ydCBUeXBl\ncy5PVEhFUiB3aXRoIHNldE51bGwKICAgICAgICBlbHNlIGlmIChjb2xUeXBl\nID09IFR5cGVzLk9USEVSIHx8IGNvbC5pc1hNTCgpKQogICAgICAgICAgICBz\ndXBlci5zZXROdWxsKHN0bW50LCBpZHgsIFR5cGVzLk5VTEwsIGNvbCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBzdXBlci5zZXROdWxsKHN0bW50LCBp\nZHgsIGNvbFR5cGUsIGNvbCk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBn\nZXRDbG9iU3RyaW5nKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX2RyaXZlckJl\naGF2aW9yICE9IEJFSEFWRV9PUkFDTEUpCiAgICAgICAgICAgIHJldHVybiBz\ndXBlci5nZXRDbG9iU3RyaW5nKHJzLCBjb2x1bW4pOwoKICAgICAgICBDbG9i\nIGNsb2IgPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChjbG9i\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChjbG9iLmdldENsYXNzKCkuZ2V0TmFtZSgpLmVxdWFscygib3JhY2xlLnNx\nbC5DTE9CIikpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGlmICgoKEJvb2xlYW4pIENsYXNzLmZvck5hbWUoIm9yYWNsZS5zcWwuQ0xP\nQiIpLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGhvZCgiaXNFbXB0eUxv\nYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICAgICAgaW52b2tl\nKGNsb2IsIG5ldyBPYmplY3RbMF0pKS4KICAgICAgICAgICAgICAgICAgICBi\nb29sZWFuVmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIC8vIHBvc3NpYmx5IGRpZmZlcmVudCB2ZXJzaW9uIG9mIHRo\nZSBkcml2ZXIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAo\nY2xvYi5sZW5ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZlIHN0cmluZ3Mg\nb3ZlciA0IGJpbGxpb24gY2hhcnMKICAgICAgICByZXR1cm4gY2xvYi5nZXRT\ndWJTdHJpbmcoMSwgKGludCkgY2xvYi5sZW5ndGgoKSk7CiAgICB9CgogICAg\ncHVibGljIFRpbWVzdGFtcCBnZXRUaW1lc3RhbXAoUmVzdWx0U2V0IHJzLCBp\nbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0VGlt\nZXN0YW1wKHJzLCBjb2x1bW4sIGNhbCk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBhZSkgewogICAgICAg\nICAgICAgICAgLy8gQ1IyOTU2MDQ6IGlzc3VlIGEgd2FybmluZyB0aGlzIHRo\naXMgYnVnIGNhbiBiZSBnb3R0ZW4KICAgICAgICAgICAgICAgIC8vIGFyb3Vu\nZCB3aXRoIFN1cHBvcnRzVGltZXN0YW1wTmFub3M9ZmFsc2UKICAgICAgICAg\nICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJvcmFjbGUtdGltZXN0YW1wLWJ1\nZyIpLCBhZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBhZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIE9yYWNsZSBidWcg\nd2hlcmUgbmFub3Mgbm90IHJldHVybmVkIGZyb20gY2FsbCB3aXRoIENhbGVu\nZGFyCiAgICAgICAgLy8gcGFyYW1ldGVyCiAgICAgICAgVGltZXN0YW1wIHRz\nID0gcnMuZ2V0VGltZXN0YW1wKGNvbHVtbiwgY2FsKTsKICAgICAgICBpZiAo\ndHMgIT0gbnVsbCAmJiB0cy5nZXROYW5vcygpID09IDApCiAgICAgICAgICAg\nIHRzLnNldE5hbm9zKHJzLmdldFRpbWVzdGFtcChjb2x1bW4pLmdldE5hbm9z\nKCkpOwogICAgICAgIHJldHVybiB0czsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldE9iamVjdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4sIE1hcCBt\nYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\ncmVjZW50IG9yYWNsZSBkcml2ZXJzIHJldHVybiBvcmFjbGUtc3BlY2lmaWMg\ndHlwZXMgZm9yIHRpbWVzdGFtcHMKICAgICAgICAvLyBhbmQgZGF0ZXMKICAg\nICAgICBPYmplY3Qgb2JqID0gc3VwZXIuZ2V0T2JqZWN0KHJzLCBjb2x1bW4s\nIG1hcCk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICBpZiAoIm9yYWNsZS5zcWwuREFURSIuZXF1\nYWxzKG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAgICAgICAgICAgIG9i\naiA9IGNvbnZlcnRGcm9tT3JhY2xlVHlwZShvYmosICJkYXRlVmFsdWUiKTsK\nICAgICAgICBlbHNlIGlmICgib3JhY2xlLnNxbC5USU1FU1RBTVAiLmVxdWFs\ncyhvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAgICAgICAgICBvYmog\nPSBjb252ZXJ0RnJvbU9yYWNsZVR5cGUob2JqLCAidGltZXN0YW1wVmFsdWUi\nKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29udmVydCBhbiBvYmplY3QgZnJvbSBpdHMgcHJvcHJpZXRhcnkgT3JhY2xl\nIHR5cGUgdG8gdGhlIHN0YW5kYXJkCiAgICAgKiBKYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb252ZXJ0RnJvbU9yYWNs\nZVR5cGUoT2JqZWN0IG9iaiwKICAgICAgICBTdHJpbmcgY29udmVydE1ldGhv\nZCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICBNZXRob2QgbSA9IG9iai5nZXRDbGFzcygpLmdldE1l\ndGhvZChjb252ZXJ0TWV0aG9kLCAoQ2xhc3NbXSkgbnVsbCk7CiAgICAgICAg\nICAgIHJldHVybiBtLmludm9rZShvYmosIChPYmplY3RbXSkgbnVsbCk7CiAg\nICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgaWYg\nKHQgaW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uKQogICAg\nICAgICAgICAgICAgdCA9ICgoSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbikg\ndCkuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIGlmICh0IGlu\nc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAgICAgdGhyb3co\nU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhj\nZXB0aW9uKHQuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0YSBt\nZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFt\nZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVtbk5hbWUsIENvbm5l\nY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBDb2x1bW5bXSBjb2xzID0gc3VwZXIuZ2V0Q29sdW1ucyhtZXRhLCBj\nYXRhbG9nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsCiAgICAgICAgICAgIGNv\nbHVtbk5hbWUsIGNvbm4pOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgY29s\ncyAhPSBudWxsICYmIGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmIChjb2xzW2ldLmdldFR5cGVOYW1lKCkgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoY29sc1tpXS5n\nZXRUeXBlTmFtZSgpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgiVElNRVNU\nQU1QIikpCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMu\nVElNRVNUQU1QKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkJMT0IiLmVxdWFs\nc0lnbm9yZUNhc2UoY29sc1tpXS5nZXRUeXBlTmFtZSgpKSkKICAgICAgICAg\nICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAg\nICAgZWxzZSBpZiAoIkNMT0IiLmVxdWFsc0lnbm9yZUNhc2UoY29sc1tpXS5n\nZXRUeXBlTmFtZSgpKQogICAgICAgICAgICAgICAgfHwgIk5DTE9CIi5lcXVh\nbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkpCiAgICAgICAg\nICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAg\nICAgIGVsc2UgaWYgKCJGTE9BVCIuZXF1YWxzSWdub3JlQ2FzZShjb2xzW2ld\nLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAgY29sc1tpXS5zZXRU\neXBlKFR5cGVzLkZMT0FUKTsKICAgICAgICAgICAgZWxzZSBpZiAoIk5WQVJD\nSEFSIi5lcXVhbHNJZ25vcmVDYXNlKGNvbHNbaV0uZ2V0VHlwZU5hbWUoKSkp\nCiAgICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuVkFSQ0hB\nUik7CiAgICAgICAgICAgIGVsc2UgaWYgKCJOQ0hBUiIuZXF1YWxzSWdub3Jl\nQ2FzZShjb2xzW2ldLmdldFR5cGVOYW1lKCkpKQogICAgICAgICAgICAgICAg\nY29sc1tpXS5zZXRUeXBlKFR5cGVzLkNIQVIpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gY29sczsKICAgIH0KCiAgICBwdWJsaWMgUHJpbWFyeUtleVtd\nIGdldFByaW1hcnlLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwKICAgICAg\nICBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0\nYWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWZmZXIgYnVmID0gbmV3IFN0\ncmluZ0J1ZmZlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVDVCB0MC5P\nV05FUiBBUyBUQUJMRV9TQ0hFTSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\ndDAuVEFCTEVfTkFNRSBBUyBUQUJMRV9OQU1FLCAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFNRSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgidDAuQ09OU1RSQUlOVF9OQU1FIEFTIFBLX05B\nTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xV\nTU5TIHQwLCBBTExfQ09OU1RSQUlOVFMgdDEgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgiV0hFUkUgdDAuT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAg\nICAgYXBwZW5kKCJBTkQgdDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RS\nQUlOVF9OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05T\nVFJBSU5UX1RZUEUgPSAnUCciKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAh\nPSBudWxsKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVS\nID0gPyIpOwogICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwoK\nICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFy\nZVN0YXRlbWVudChidWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVzdWx0U2V0\nIHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4\nID0gMTsKICAgICAgICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNjaGVtYU5h\nbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICh0YWJs\nZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1u\ndCwgaWR4KyssIHRhYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKCiAg\nICAgICAgICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAg\nICAgIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAg\nICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpCiAgICAgICAgICAg\nICAgICBwa0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocnMpKTsKICAgICAgICAg\nICAgcmV0dXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAg\nICAgICAgICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBy\ncy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIEluZGV4W10gZ2V0SW5kZXhJbmZvKERhdGFiYXNl\nTWV0YURhdGEgbWV0YSwgU3RyaW5nIGNhdGFsb2csCiAgICAgICAgU3RyaW5n\nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVl\nLCBib29sZWFuIGFwcHJveCwKICAgICAgICBDb25uZWN0aW9uIGNvbm4pCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nQnVm\nZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoKTsKICAgICAgICBidWYuYXBw\nZW5kKCJTRUxFQ1QgdDAuSU5ERVhfT1dORVIgQVMgVEFCTEVfU0NIRU0sICIp\nLgogICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUgQVMgVEFCTEVf\nTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RFKHQxLlVOSVFV\nRU5FU1MsICdVTklRVUUnLCAwLCAnTk9OVU5JUVVFJywgMSkgIikuCiAgICAg\nICAgICAgIGFwcGVuZCgiQVMgTk9OX1VOSVFVRSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZCgidDAuSU5ERVhfTkFNRSBBUyBJTkRFWF9OQU1FLCAiKS4KICAg\nICAgICAgICAgYXBwZW5kKCJ0MC5DT0xVTU5fTkFNRSBBUyBDT0xVTU5fTkFN\nRSAiKS4KICAgICAgICAgICAgYXBwZW5kKCJGUk9NIEFMTF9JTkRfQ09MVU1O\nUyB0MCwgQUxMX0lOREVYRVMgdDEgIikuCiAgICAgICAgICAgIGFwcGVuZCgi\nV0hFUkUgdDAuSU5ERVhfT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAg\nICAgYXBwZW5kKCJBTkQgdDAuSU5ERVhfTkFNRSA9IHQxLklOREVYX05BTUUi\nKTsKICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxFX09XTkVSID0gPyIpOwogICAg\nICAgIGlmICh0YWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIEFORCB0MC5UQUJMRV9OQU1FID0gPyIpOwoKICAgICAgICBQcmVw\nYXJlZFN0YXRlbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudChi\ndWYudG9TdHJpbmcoKSk7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgaWR4ID0gMTsKICAgICAg\nICAgICAgaWYgKHNjaGVtYU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHNjaGVtYU5hbWUudG9VcHBlckNh\nc2UoKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICh0YWJsZU5hbWUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHNldFN0cmluZyhzdG1udCwgaWR4KyssIHRh\nYmxlTmFtZS50b1VwcGVyQ2FzZSgpLCBudWxsKTsKCiAgICAgICAgICAgIHJz\nID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3QgaWR4\nTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHJz\nICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICAgICAgaWR4TGlz\ndC5hZGQobmV3SW5kZXgocnMpKTsKICAgICAgICAgICAgcmV0dXJuIChJbmRl\neFtdKSBpZHhMaXN0LnRvQXJyYXkobmV3IEluZGV4W2lkeExpc3Quc2l6ZSgp\nXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIHJzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVk\nS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAog\nICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgU3RyaW5nQnVmZmVyIGRlbEFjdGlvbiA9IG5ldyBTdHJpbmdC\ndWZmZXIoIkRFQ09ERSh0MS5ERUxFVEVfUlVMRSIpLgogICAgICAgICAgICBh\ncHBlbmQoIiwgJ05PIEFDVElPTicsICIpLmFwcGVuZChtZXRhLmltcG9ydGVk\nS2V5Tm9BY3Rpb24pLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1JFU1RSSUNU\nJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlSZXN0cmljdCkuCiAgICAg\nICAgICAgIGFwcGVuZCgiLCAnQ0FTQ0FERScsICIpLmFwcGVuZChtZXRhLmlt\ncG9ydGVkS2V5Q2FzY2FkZSkuCiAgICAgICAgICAgIGFwcGVuZCgiLCAnU0VU\nIE5VTEwnLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtleVNldE51bGwpLgog\nICAgICAgICAgICBhcHBlbmQoIiwgJ1NFVCBERUZBVUxUJywgIikuYXBwZW5k\nKG1ldGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0KS4KICAgICAgICAgICAgYXBw\nZW5kKCIpIik7CgogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3Ry\naW5nQnVmZmVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIHQyLk9X\nTkVSIEFTIFBLVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQo\nInQyLlRBQkxFX05BTUUgQVMgUEtUQUJMRV9OQU1FLCAiKS4KICAgICAgICAg\nICAgYXBwZW5kKCJ0Mi5DT0xVTU5fTkFNRSBBUyBQS0NPTFVNTl9OQU1FLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5PV05FUiBBUyBGS1RBQkxFX1ND\nSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJMRV9OQU1FIEFT\nIEZLVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09M\nVU1OX05BTUUgQVMgRktDT0xVTU5fTkFNRSwgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgidDAuUE9TSVRJT04gQVMgS0VZX1NFUSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZChkZWxBY3Rpb24pLmFwcGVuZCgiIEFTIERFTEVURV9SVUxFLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT05TVFJBSU5UX05BTUUgQVMg\nRktfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RFKHQxLkRF\nRkVSUkVELCAnREVGRVJSRUQnLCAiKS4KICAgICAgICAgICAgYXBwZW5kKG1l\ndGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCkuCiAgICAgICAgICAg\nIGFwcGVuZCgiLCAnSU1NRURJQVRFJywgIikuCiAgICAgICAgICAgIGFwcGVu\nZChtZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5SW1tZWRpYXRlKS4KICAgICAg\nICAgICAgYXBwZW5kKCIpIEFTIERFRkVSUkFCSUxJVFkgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xVTU5TIHQwLCBBTExfQ09O\nU1RSQUlOVFMgdDEsICIpLgogICAgICAgICAgICBhcHBlbmQoIkFMTF9DT05T\nX0NPTFVNTlMgdDIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiV0hFUkUgdDAu\nT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQg\ndDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RSQUlOVF9OQU1FICIpLgog\nICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05TVFJBSU5UX1RZUEUgPSAn\nUicgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJfT1dORVIgPSB0\nMi5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEuUl9DT05T\nVFJBSU5UX05BTUUgPSB0Mi5DT05TVFJBSU5UX05BTUUgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiQU5EIHQwLlBPU0lUSU9OID0gdDIuUE9TSVRJT04iKTsK\nICAgICAgICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0gPyIpOwogICAgICAgIGlmICh0\nYWJsZU5hbWUgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFO\nRCB0MC5UQUJMRV9OQU1FID0gPyIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiBP\nUkRFUiBCWSB0Mi5PV05FUiwgdDIuVEFCTEVfTkFNRSwgdDAuUE9TSVRJT04i\nKTsKCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBjb25uLnBy\nZXBhcmVTdGF0ZW1lbnQoYnVmLnRvU3RyaW5nKCkpOwogICAgICAgIFJlc3Vs\ndFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50\nIGlkeCA9IDE7CiAgICAgICAgICAgIGlmIChzY2hlbWFOYW1lICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBzY2hl\nbWFOYW1lLnRvVXBwZXJDYXNlKCksIG51bGwpOwogICAgICAgICAgICBpZiAo\ndGFibGVOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmco\nc3RtbnQsIGlkeCsrLCB0YWJsZU5hbWUudG9VcHBlckNhc2UoKSwgbnVsbCk7\nCgogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAg\nICAgICAgICBMaXN0IGZrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAg\nICAgICAgd2hpbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAg\nICAgICAgICAgZmtMaXN0LmFkZChuZXdGb3JlaWduS2V5KHJzKSk7CiAgICAg\nICAgICAgIHJldHVybiAoRm9yZWlnbktleVtdKSBma0xpc3QudG9BcnJheQog\nICAgICAgICAgICAgICAgKG5ldyBGb3JlaWduS2V5W2ZrTGlzdC5zaXplKCld\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocnMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgcnMuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBzdG1udC5jbG9zZSgpOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVUYWJsZVNR\nTChUYWJsZSB0YWJsZSkgewogICAgICAgIC8vIG9ubHkgb3ZlcnJpZGUgaWYg\nd2UgYXJlIHNpbXVsYXRpbmcgYXV0by1pbmNyZW1lbmV0IHdpdGggdHJpZ2dl\ncnMKICAgICAgICBTdHJpbmdbXSBjcmVhdGUgPSBzdXBlci5nZXRDcmVhdGVU\nYWJsZVNRTCh0YWJsZSk7CiAgICAgICAgaWYgKCF1c2VUcmlnZ2Vyc0ZvckF1\ndG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBjcmVhdGU7CgogICAgICAg\nIENvbHVtbltdIGNvbHMgPSB0YWJsZS5nZXRDb2x1bW5zKCk7CiAgICAgICAg\nTGlzdCBzZXFzID0gbnVsbDsKICAgICAgICBTdHJpbmcgc2VxLCB0cmlnOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBjb2xzICE9IG51bGwgJiYgaSA8IGNv\nbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFjb2xzW2ldLmlz\nQXV0b0Fzc2lnbmVkKCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHNl\ncXMgPSBuZXcgQXJyYXlMaXN0KDQpOwoKICAgICAgICAgICAgc2VxID0gYXV0\nb0Fzc2lnblNlcXVlbmNlTmFtZTsKICAgICAgICAgICAgaWYgKHNlcSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBpZiAob3BlbmpwYTNHZW5lcmF0ZWRL\nZXlOYW1lcykKICAgICAgICAgICAgICAgICAgICBzZXEgPSBnZXRPcGVuSlBB\nM0dlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2xzW2ldKTsKICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXEgPSBnZXRHZW5l\ncmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAgICAgICAgICAg\nICBzZXFzLmFkZCgiQ1JFQVRFIFNFUVVFTkNFICIgKyBzZXEgKyAiIFNUQVJU\nIFdJVEggMSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcGVu\nanBhM0dlbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICAgICAgdHJpZyA9\nIGdldE9wZW5KUEEzR2VuZXJhdGVkS2V5VHJpZ2dlck5hbWUoY29sc1tpXSk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRyaWcgPSBnZXRH\nZW5lcmF0ZWRLZXlUcmlnZ2VyTmFtZShjb2xzW2ldKTsKCiAgICAgICAgICAg\nIC8vIGNyZWF0ZSB0aGUgdHJpZ2dlciB0aGF0IHdpbGwgaW5zZXJ0IG5ldyB2\nYWx1ZXMgaW50bwogICAgICAgICAgICAvLyB0aGUgdGFibGUgd2hlbmV2ZXIg\nYSByb3cgaXMgY3JlYXRlZAogICAgICAgICAgICBzZXFzLmFkZCgiQ1JFQVRF\nIE9SIFJFUExBQ0UgVFJJR0dFUiAiICsgdHJpZwogICAgICAgICAgICAgICAg\nKyAiIEJFRk9SRSBJTlNFUlQgT04gIiArIHRhYmxlLmdldE5hbWUoKQogICAg\nICAgICAgICAgICAgKyAiIEZPUiBFQUNIIFJPVyBCRUdJTiBTRUxFQ1QgIiAr\nIHNlcSArICIubmV4dHZhbCBJTlRPICIKICAgICAgICAgICAgICAgICsgIjpu\nZXcuIiArIGNvbHNbaV0uZ2V0TmFtZSgpICsgIiBGUk9NIERVQUw7ICIKICAg\nICAgICAgICAgICAgICsgIkVORCAiICsgdHJpZyArICI7Iik7CiAgICAgICAg\nfQogICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBjcmVhdGU7CgogICAgICAgIC8vIGNvbWJpbmUgY3JlYXRlIHRhYmxlIHNx\nbCBhbmQgY3JlYXRlIHNlcWVuY2VzIHNxbAogICAgICAgIFN0cmluZ1tdIHNx\nbCA9IG5ldyBTdHJpbmdbY3JlYXRlLmxlbmd0aCArIHNlcXMuc2l6ZSgpXTsK\nICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGNyZWF0ZSwgMCwgc3FsLCAwLCBj\ncmVhdGUubGVuZ3RoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNl\ncXMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgIHNxbFtjcmVhdGUubGVuZ3Ro\nICsgaV0gPSAoU3RyaW5nKSBzZXFzLmdldChpKTsKICAgICAgICByZXR1cm4g\nc3FsOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVTZXF1\nZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBTdHJpbmdbXSBzcWwg\nPSBzdXBlci5nZXRDcmVhdGVTZXF1ZW5jZVNRTChzZXEpOwogICAgICAgIGlm\nIChzZXEuZ2V0QWxsb2NhdGUoKSA+IDEpCiAgICAgICAgICAgIHNxbFswXSAr\nPSAiIENBQ0hFICIgKyBzZXEuZ2V0QWxsb2NhdGUoKTsKICAgICAgICByZXR1\ncm4gc3FsOwogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVu\nY2VzU1FMKFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgc2VxdWVuY2VOYW1l\nKSB7CiAgICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZm\nZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJTRUxFQ1QgU0VRVUVOQ0VfT1dO\nRVIgQVMgU0VRVUVOQ0VfU0NIRU1BLCAiKS4KICAgICAgICAgICAgYXBwZW5k\nKCJTRVFVRU5DRV9OQU1FIEZST00gQUxMX1NFUVVFTkNFUyIpOwogICAgICAg\nIGlmIChzY2hlbWFOYW1lICE9IG51bGwgfHwgc2VxdWVuY2VOYW1lICE9IG51\nbGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAiKTsKICAgICAg\nICBpZiAoc2NoZW1hTmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIlNFUVVFTkNFX09XTkVSID0gPyIpOwogICAgICAgICAgICBpZiAo\nc2VxdWVuY2VOYW1lICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIgQU5EICIpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VxdWVuY2VO\nYW1lICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNF\nX05BTUUgPSA/Iik7CiAgICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3Ry\naW5nIG5hbWUsIFN0cmluZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJn\nZXRTY2hlbWEpIHsKICAgICAgICBpZiAoc3VwZXIuaXNTeXN0ZW1TZXF1ZW5j\nZShuYW1lLCBzY2hlbWEsIHRhcmdldFNjaGVtYSkpCiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwoKICAgICAgICAvLyBmaWx0ZXIgb3V0IGdlbmVyYXRlZCBz\nZXF1ZW5jZXMgdXNlZCBmb3IgYXV0by1hc3NpZ24KICAgICAgICByZXR1cm4g\nKGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUgIT0gbnVsbAogICAgICAgICAgICAm\nJiBuYW1lLmVxdWFsc0lnbm9yZUNhc2UoYXV0b0Fzc2lnblNlcXVlbmNlTmFt\nZSkpCiAgICAgICAgICAgIHx8IChhdXRvQXNzaWduU2VxdWVuY2VOYW1lID09\nIG51bGwKICAgICAgICAgICAgJiYgbmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0\nc1dpdGgoIlNUXyIpKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEdl\nbmVyYXRlZEtleShDb2x1bW4gY29sLCBDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCF1c2VUcmln\nZ2Vyc0ZvckF1dG9Bc3NpZ24pCiAgICAgICAgICAgIHJldHVybiBOdW1iZXJz\nLnZhbHVlT2YoMEwpOwoKICAgICAgICAvLyBpZiB3ZSBzaW11bGF0ZSBhdXRv\nLWFzc2lnbmVkIGNvbHVtbnMgdXNpbmcgdHJpZ2dlcnMgYW5kCiAgICAgICAg\nLy8gc2VxdWVuY2VzLCB0aGVuIHJldHVybiB0aGUgY3VycmVudCB2YWx1ZSBv\nZiB0aGUgc2VxdWVuY2UKICAgICAgICAvLyBmcm9tIGF1dG9Bc3NpZ25TZXF1\nZW5jZU5hbWUKICAgICAgICBTdHJpbmcgc2VxID0gYXV0b0Fzc2lnblNlcXVl\nbmNlTmFtZTsKICAgICAgICBpZiAoc2VxID09IG51bGwgJiYgb3BlbmpwYTNH\nZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgc2VxID0gZ2V0T3BlbkpQ\nQTNHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAgICBlbHNl\nIGlmIChzZXEgPT0gbnVsbCkKICAgICAgICAgICAgc2VxID0gZ2V0R2VuZXJh\ndGVkS2V5U2VxdWVuY2VOYW1lKGNvbCk7CiAgICAgICAgUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoIlNFTEVDVCAi\nICsgc2VxCiAgICAgICAgICAgICsgIi5jdXJydmFsIEZST00gRFVBTCIpOwog\nICAgICAgIFJlc3VsdFNldCBycyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcnMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICAg\nICAgcnMubmV4dCgpOwogICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1\nZU9mKHJzLmdldExvbmcoMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsg\ncnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAg\nICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVHJpZ2dlciBuYW1lIGZvciBzaW11bGF0aW5nIGF1dG8tYXNzaWduIHZhbHVl\ncyBvbiB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RyaW5nIGdldEdlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wp\nIHsKICAgICAgICAvLyByZXBsYWNlIHRyYWlsaW5nIF9TRVEgd2l0aCBfVFJH\nCiAgICAgICAgU3RyaW5nIHNlcU5hbWUgPSBnZXRHZW5lcmF0ZWRLZXlTZXF1\nZW5jZU5hbWUoY29sKTsKICAgICAgICByZXR1cm4gc2VxTmFtZS5zdWJzdHJp\nbmcoMCwgc2VxTmFtZS5sZW5ndGgoKSAtIDMpICsgIlRSRyI7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUg\nbmFtZSBmb3IgYW4gYXV0by1hc3NpZ24gc2VxdWVuY2UuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlTZXF1\nZW5jZU5hbWUoQ29sdW1uIGNvbCkgewogICAgICAgIFRhYmxlIHRhYmxlID0g\nY29sLmdldFRhYmxlKCk7CiAgICAgICAgcmV0dXJuIG1ha2VOYW1lVmFsaWQo\nIlNFUV8iICsgdGFibGUuZ2V0TmFtZSgpLCB0YWJsZS5nZXRTY2hlbWEoKS4K\nICAgICAgICAgICAgZ2V0U2NoZW1hR3JvdXAoKSwgbWF4VGFibGVOYW1lTGVu\nZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0by1hc3Np\nZ24gdHJpZ2dlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRP\ncGVuSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsK\nICAgICAgICBUYWJsZSB0YWJsZSA9IGNvbC5nZXRUYWJsZSgpOwogICAgICAg\nIHJldHVybiBtYWtlTmFtZVZhbGlkKCJUUklHXyIgKyB0YWJsZS5nZXROYW1l\nKCksIHRhYmxlLmdldFNjaGVtYSgpLgogICAgICAgICAgICBnZXRTY2hlbWFH\ncm91cCgpLCBtYXhUYWJsZU5hbWVMZW5ndGgsIE5BTUVfQU5ZKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRCeXRl\nczwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVjdC4KICAg\nICAqIFVzZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBibG9iIGlzIHdyYXBw\nZWQgaW4gYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBm\nb3IgZXhhbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIK\nICAgICAqIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNh\nbWUgbWV0aG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Qnl0ZXMo\nT2JqZWN0IGJsb2IsIGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChibG9iID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoX3B1dEJ5dGVzID09IG51bGwpIHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9wdXRCeXRlcyA9\nIGJsb2IuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoInB1dEJ5dGVzIiwKICAgICAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgYnl0ZVtd\nLmNsYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExv\nYk1ldGhvZChfcHV0Qnl0ZXMsIGJsb2IsIGRhdGEpOwogICAgfQoKICAgIC8q\nKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1dFN0cmluZzwvY29k\nZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CIG9iamVjdC4KICAgICAqIFVz\nZXMgcmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQgaW4g\nYW5vdGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3IgZXhh\nbXBsZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAgICAq\nIGxvYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUgbWV0\naG9kcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0U3RyaW5nKE9iamVj\ndCBjbG9iLCBTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoX3B1dFN0cmluZyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfcHV0U3RyaW5nID0gY2xv\nYi5nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0U3RyaW5nIiwKICAgICAgICAg\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgbG9uZy5jbGFzcywgU3RyaW5nLmNs\nYXNzIH0pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGludm9rZVB1dExvYk1l\ndGhvZChfcHV0U3RyaW5nLCBjbG9iLCBkYXRhKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSBPcmFjbGUncyA8Y29kZT5wdXRDaGFyczwvY29kZT4g\nbWV0aG9kIG9uIHRoZSBnaXZlbiBDTE9CCiAgICAgKiBvYmplY3QuIFVzZXMg\ncmVmbGVjdGlvbiBpbiBjYXNlIHRoZSBjbG9iIGlzIHdyYXBwZWQgaW4gYW5v\ndGhlcgogICAgICogdmVuZG9yLXNwZWNpZmljIGNsYXNzOyBmb3IgZXhhbXBs\nZSBXZWJsb2dpYyB3cmFwcyBvcmFjbGUgdGhpbiBkcml2ZXIKICAgICAqIGxv\nYnMgaW4gaXRzIG93biBpbnRlcmZhY2VzIHdpdGggdGhlIHNhbWUgbWV0aG9k\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Q2hhcnMoT2JqZWN0IGNs\nb2IsIGNoYXJbXSBkYXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChfcHV0Q2hhcnMgPT0gbnVsbCkgewogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgX3B1dENoYXJzID0gY2xvYi5nZXRD\nbGFzcygpLmdldE1ldGhvZCgicHV0Q2hhcnMiLAogICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNzLCBjaGFyW10uY2xhc3MgfSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9w\ndXRDaGFycywgY2xvYiwgZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nbnZva2UgdGhlIGdpdmVuIExPQiBtZXRob2Qgb24gdGhlIGdpdmVuIHRhcmdl\ndCB3aXRoIHRoZSBnaXZlbiBkYXRhLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyB2b2lkIGludm9rZVB1dExvYk1ldGhvZChNZXRob2QgbWV0aG9kLCBP\nYmplY3QgdGFyZ2V0LAogICAgICAgIE9iamVjdCBkYXRhKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIG1ldGhvZC5pbnZva2UodGFyZ2V0LCBuZXcgT2JqZWN0W117IE51bWJlcnMu\ndmFsdWVPZigxTCksIGRhdGEgfSk7CiAgICAgICAgfSBjYXRjaCAoSW52b2Nh\ndGlvblRhcmdldEV4Y2VwdGlvbiBpdGUpIHsKICAgICAgICAgICAgVGhyb3dh\nYmxlIHQgPSBpdGUuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAgICAg\nIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAgICAg\nICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24odCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9u\nKGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIENsb2IgZ2V0RW1w\ndHlDbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoRU1QVFlfQ0xPQiAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nRU1QVFlfQ0xPQjsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nRU1QVFlfQ0xPQiA9IChDbG9iKSBDbGFzcy5mb3JOYW1lKCJvcmFjbGUuc3Fs\nLkNMT0IiLHRydWUsIAogICAgICAgICAgICAgICAgICAgIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0Q29udGV4dENsYXNzTG9hZGVyQWN0aW9u\nKCkpKS4KICAgICAgICAgICAgICAgIGdldE1ldGhvZCgiZW1wdHlfbG9iIiwg\nbmV3IENsYXNzWzBdKS4KICAgICAgICAgICAgICAgIGludm9rZShudWxsLCBu\nZXcgT2JqZWN0WzBdKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGUuZ2V0TWVz\nc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBCbG9iIGdl\ndEVtcHR5QmxvYigpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKEVNUFRZX0JMT0IgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIEVNUFRZX0JMT0I7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIEVNUFRZX0JMT0IgPSAoQmxvYikgQ2xhc3MuZm9yTmFtZSgib3JhY2xl\nLnNxbC5CTE9CIix0cnVlLCAKICAgICAgICAgICAgICAgICAgICBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlcgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLmdldENvbnRleHRDbGFzc0xvYWRlckFj\ndGlvbigpKSkuCiAgICAgICAgICAgICAgICBnZXRNZXRob2QoImVtcHR5X2xv\nYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAgICAgICBpbnZva2UobnVs\nbCwgbmV3IE9iamVjdFswXSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihlLmdl\ndE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3Rh\ndGljIGJvb2xlYW4gaXNPcmFjbGVQcmVwYXJlZFN0YXRlbWVudChTdGF0ZW1l\nbnQgc3RtbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nQ2xhc3MuZm9yTmFtZSgib3JhY2xlLmpkYmMuT3JhY2xlUHJlcGFyZWRTdGF0\nZW1lbnQiKS4KICAgICAgICAgICAgICAgIGlzSW5zdGFuY2Uoc3RtbnQpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogSWYgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIFhNTCB0eXBlLAogICAg\nICogdXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB4bWwgcHJlZGljYXRlLgog\nICAgICogCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdy\naXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFyYW0gb3AgdGhlIGNvbXBh\ncmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAgICAqIEBwYXJhbSBsaHMg\ndGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAgKiBA\ncGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNvbXBhcmlz\nb24KICAgICAqLwogICAgcHVibGljIHZvaWQgYXBwZW5kWG1sQ29tcGFyaXNv\nbihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVlIGxocywK\nICAgICAgICBGaWx0ZXJWYWx1ZSByaHMsIGJvb2xlYW4gbGhzeG1sLCBib29s\nZWFuIHJoc3htbCkgewogICAgICAgIHN1cGVyLmFwcGVuZFhtbENvbXBhcmlz\nb24oYnVmLCBvcCwgbGhzLCByaHMsIGxoc3htbCwgcmhzeG1sKTsKICAgICAg\nICBpZiAobGhzeG1sICYmIHJoc3htbCkKICAgICAgICAgICAgYXBwZW5kWG1s\nQ29tcGFyaXNvbjIoYnVmLCBvcCwgbGhzLCByaHMpOwogICAgICAgIGVsc2Ug\naWYgKGxoc3htbCkKICAgICAgICAgICAgYXBwZW5kWG1sQ29tcGFyaXNvbjEo\nYnVmLCBvcCwgbGhzLCByaHMpOwogICAgICAgIGVsc2UgCiAgICAgICAgICAg\nIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3AsIHJocywgbGhzKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBBcHBlbmQgYW4geG1sIGNvbXBhcmlz\nb24gcHJlZGljYXRlCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FM\nIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFt\nIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0byBwZXJmb3JtCiAgICAg\nKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFy\naXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAgICogQHBhcmFtIHJocyB0\naGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxDb21wYXJpc29uMShTUUxCdWZm\nZXIgYnVmLCBTdHJpbmcgb3AsCiAgICAgICAgRmlsdGVyVmFsdWUgbGhzLCBG\naWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBhcHBlbmRYbWxFeHRyYWN0VmFs\ndWUoYnVmLCBsaHMpOwogICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQo\nb3ApLmFwcGVuZCgiICIpOwogICAgICAgIHJocy5hcHBlbmRUbyhidWYpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIEFwcGVuZCBhbiB4bWwgY29tcGFy\naXNvbiBwcmVkaWNhdGUgKGJvdGggb3BlcmFuZHMgbWFwIHRvIHhtbCBjb2x1\nbW4pCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0\nbyB3cml0ZSB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIG9wIHRoZSBj\nb21wYXJpc29uIG9wZXJhdGlvbiB0byBwZXJmb3JtCiAgICAgKiBAcGFyYW0g\nbGhzIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUgY29tcGFyaXNvbiAobWFw\ncyB0byB4bWwgY29sdW1uKQogICAgICogQHBhcmFtIHJocyB0aGUgcmlnaHQg\naGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uIChtYXBzIHRvIHhtbCBjb2x1\nbW4pCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxDb21wYXJp\nc29uMihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIAogICAgICAgIEZpbHRl\nclZhbHVlIGxocywgRmlsdGVyVmFsdWUgcmhzKSB7CiAgICAgICAgYXBwZW5k\nWG1sRXh0cmFjdFZhbHVlKGJ1ZiwgbGhzKTsKICAgICAgICBidWYuYXBwZW5k\nKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAiKTsKICAgICAgICBhcHBlbmRY\nbWxFeHRyYWN0VmFsdWUoYnVmLCByaHMpOwogICAgfQogICAgCiAgICBwcml2\nYXRlIHZvaWQgYXBwZW5kWG1sRXh0cmFjdFZhbHVlKFNRTEJ1ZmZlciBidWYs\nIEZpbHRlclZhbHVlIHZhbCkgewogICAgICAgIGJ1Zi5hcHBlbmQoImV4dHJh\nY3RWYWx1ZSgiKS4KICAgICAgICAgICAgYXBwZW5kKHZhbC5nZXRDb2x1bW5B\nbGlhcygKICAgICAgICAgICAgdmFsLmdldEZpZWxkTWFwcGluZygpLmdldENv\nbHVtbnMoKVswXSkpLgogICAgICAgICAgICBhcHBlbmQoIiwnLyovIik7CiAg\nICAgICAgdmFsLmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgi\nJykiKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgaW5zZXJ0QmxvYkZv\nclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1uIGNvbCwgT2JqZWN0IG9i\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChv\nYiA9PSBudWxsKQogICAgICAgICAgICBjb2wuc2V0VHlwZShUeXBlcy5PVEhF\nUik7CiAgICAgICAgcm93LnNldE51bGwoY29sKTsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgaW5zZXJ0Q2xvYkZvclN0cmVhbWluZ0xvYWQoUm93IHJv\ndywgQ29sdW1uIGNvbCwgT2JqZWN0IG9iKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChvYiA9PSBudWxsKQogICAgICAgICAg\nICBjb2wuc2V0VHlwZShUeXBlcy5PVEhFUik7CiAgICAgICAgcm93LnNldE51\nbGwoY29sKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEJhdGNoVXBkYXRl\nQ291bnQoUHJlcGFyZWRTdGF0ZW1lbnQgcHMpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGludCB1cGRhdGVTdWNjZXNzQ250ID0gMDsKICAgICAg\nICBpZiAoYmF0Y2hMaW1pdCAhPSAwICYmIHBzICE9IG51bGwpIHsKICAgICAg\nICAgICAgdXBkYXRlU3VjY2Vzc0NudCA9IHBzLmdldFVwZGF0ZUNvdW50KCk7\nCiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiYmF0Y2gtdXBkYXRlLXN1\nY2Nlc3MtY291bnQiLAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN1Y2Nl\nc3NDbnQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVwZGF0ZVN1Y2Nl\nc3NDbnQ7CiAgICB9Cn0K\n","encoding":"base64"}

