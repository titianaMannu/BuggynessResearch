{"sha":"a4d4c22490edb4e7e791ac39b4941e0f9d64e6b8","node_id":"MDQ6QmxvYjIwNjM2NDphNGQ0YzIyNDkwZWRiNGU3ZTc5MWFjMzliNDk0MWUwZjlkNjRlNmI4","size":20724,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a4d4c22490edb4e7e791ac39b4941e0f9d64e6b8","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJs\nZVN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9y\ndCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmtlcm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVlbmNlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxlOwpp\nbXBvcnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogQnVmZmVyIGZvciBT\nUUwgc3RhdGVtZW50cyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZQogKiBq\nYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudHMuCiAqCiAqIEBhdXRob3IgTWFy\nYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBzaW5j\nZSAwLjIuNAogKi8KcHVibGljIGZpbmFsIGNsYXNzIFNRTEJ1ZmZlcgogICAg\naW1wbGVtZW50cyBTZXJpYWxpemFibGUsIENsb25lYWJsZSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFBBUkFNRVRFUl9UT0tFTiA9ICI/\nIjsKCiAgICBwcml2YXRlIGZpbmFsIERCRGljdGlvbmFyeSBfZGljdDsKICAg\nIHByaXZhdGUgZmluYWwgU3RyaW5nQnVmZmVyIF9zcWwgPSBuZXcgU3RyaW5n\nQnVmZmVyKCk7CiAgICBwcml2YXRlIExpc3QgX3N1YnNlbHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBMaXN0IF9wYXJhbXMgPSBudWxsOwogICAgcHJpdmF0ZSBM\naXN0IF9jb2xzID0gbnVsbDsKCiAgICAvKioKICAgICAqIERlZmF1bHQgY29u\nc3RydWN0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIoREJEaWN0\naW9uYXJ5IGRpY3QpIHsKICAgICAgICBfZGljdCA9IGRpY3Q7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb3B5IGNvbnN0cnVjdG9yLgogICAgICovCiAgICBw\ndWJsaWMgU1FMQnVmZmVyKFNRTEJ1ZmZlciBidWYpIHsKICAgICAgICBfZGlj\ndCA9IGJ1Zi5fZGljdDsKICAgICAgICBhcHBlbmQoYnVmKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBlcmZvcm0gYSBzaGFsbG93IGNsb25lIG9mIHRoaXMg\nU1FMIEJ1ZmZlci4KICAgICAqLwogICAgcHVibGljIE9iamVjdCBjbG9uZSgp\nIHsKICAgICAgICByZXR1cm4gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSBidWZmZXIgaXMg\nZW10cHkuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7\nCiAgICAgICAgcmV0dXJuIF9zcWwubGVuZ3RoKCkgPT0gMDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFwcGVuZCBhbGwgU1FMIGFuZCBwYXJhbWV0ZXJzIG9m\nIHRoZSBnaXZlbiBidWZmZXIuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZm\nZXIgYXBwZW5kKFNRTEJ1ZmZlciBidWYpIHsKICAgICAgICBhcHBlbmQoYnVm\nLCBfc3FsLmxlbmd0aCgpLCAoX3BhcmFtcyA9PSBudWxsKSA/IDAgOiBfcGFy\nYW1zLnNpemUoKSwKICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYWxsIFNRTCBh\nbmQgcGFyYW1ldGVycyBvZiB0aGUgZ2l2ZW4gYnVmZmVyIGF0IHRoZSBnaXZl\nbiBwb3NpdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmQo\nU1FMQnVmZmVyIGJ1ZiwgaW50IHNxbEluZGV4LCBpbnQgcGFyYW1JbmRleCwK\nICAgICAgICBib29sZWFuIHN1YnNlbHMpIHsKICAgICAgICBpZiAoc3Vic2Vs\ncykgewogICAgICAgICAgICAvLyBvbmx5IGFsbG93IGFwcGVuZGluZyBvZiBi\ndWZmZXJzIHdpdGggc3Vic2VsZWN0cywgbm90IGluc2VydGlvbgogICAgICAg\nICAgICBpZiAoX3N1YnNlbHMgIT0gbnVsbCAmJiAhX3N1YnNlbHMuaXNFbXB0\neSgpCiAgICAgICAgICAgICAgICAmJiBzcWxJbmRleCAhPSBfc3FsLmxlbmd0\naCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4\nY2VwdGlvbigpOwogICAgICAgICAgICBpZiAoYnVmLl9zdWJzZWxzICE9IG51\nbGwgJiYgIWJ1Zi5fc3Vic2Vscy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChzcWxJbmRleCAhPSBfc3FsLmxlbmd0aCgpKQogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKTsK\nICAgICAgICAgICAgICAgIGlmIChfc3Vic2VscyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgIF9zdWJzZWxzID0gbmV3IEFycmF5TGlzdChidWYuX3N1\nYnNlbHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgYnVmLl9zdWJzZWxzLnNpemUoKTsgaSsrKQogICAgICAgICAgICAg\nICAgICAgIF9zdWJzZWxzLmFkZCgoKFN1YnNlbGVjdCkgYnVmLl9zdWJzZWxz\nLmdldChpKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIGNsb25lKHNxbElu\nZGV4LCBwYXJhbUluZGV4KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGlmIChzcWxJbmRleCA9PSBfc3FsLmxlbmd0aCgpKQogICAgICAg\nICAgICBfc3FsLmFwcGVuZChidWYuX3NxbC50b1N0cmluZygpKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9zcWwuaW5zZXJ0KHNxbEluZGV4LCBidWYu\nX3NxbC50b1N0cmluZygpKTsKCiAgICAgICAgaWYgKGJ1Zi5fcGFyYW1zICE9\nIG51bGwpIHsKICAgICAgICAgICAgaWYgKF9wYXJhbXMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9wYXJhbXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAg\nICAgICAgIGlmIChfY29scyA9PSBudWxsICYmIGJ1Zi5fY29scyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBfY29scyA9IG5ldyBBcnJheUxpc3QoKTsK\nICAgICAgICAgICAgICAgIHdoaWxlIChfY29scy5zaXplKCkgPCBfcGFyYW1z\nLnNpemUoKSkKICAgICAgICAgICAgICAgICAgICBfY29scy5hZGQobnVsbCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4ID09\nIF9wYXJhbXMuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBfcGFyYW1zLmFk\nZEFsbChidWYuX3BhcmFtcyk7CiAgICAgICAgICAgICAgICBpZiAoYnVmLl9j\nb2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX2NvbHMuYWRkQWxs\nKGJ1Zi5fY29scyk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChfY29scyAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChfY29scy5zaXpl\nKCkgPCBfcGFyYW1zLnNpemUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nX2NvbHMuYWRkKG51bGwpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgX3BhcmFtcy5hZGRBbGwocGFyYW1JbmRleCwgYnVmLl9wYXJh\nbXMpOwogICAgICAgICAgICAgICAgaWYgKGJ1Zi5fY29scyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIF9jb2xzLmFkZEFsbChwYXJhbUluZGV4LCBi\ndWYuX2NvbHMpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoX2NvbHMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoX2NvbHMuc2l6ZSgp\nIDwgX3BhcmFtcy5zaXplKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIF9j\nb2xzLmFkZChwYXJhbUluZGV4LCBudWxsKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChUYWJs\nZSB0YWJsZSkgewogICAgICAgIF9zcWwuYXBwZW5kKF9kaWN0LmdldEZ1bGxO\nYW1lKHRhYmxlLCBmYWxzZSkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kKFNlcXVlbmNlIHNlcSkg\newogICAgICAgIF9zcWwuYXBwZW5kKF9kaWN0LmdldEZ1bGxOYW1lKHNlcSkp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBTUUxC\ndWZmZXIgYXBwZW5kKENvbHVtbiBjb2wpIHsKICAgICAgICBfc3FsLmFwcGVu\nZChjb2wuZ2V0TmFtZSgpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0K\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChTdHJpbmcgcykgewogICAg\nICAgIF9zcWwuYXBwZW5kKHMpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgc3Vic2VsZWN0LiBUaGlzIGRl\nbGF5cyByZXNvbHV0aW9uIG9mIHRoZSBzZWxlY3QgU1FMLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZChTZWxlY3Qgc2VsLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIGFwcGVu\nZChzZWwsIGZldGNoLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgYSBzdWJzZWxlY3QgY291bnQuIFRoaXMgZGVsYXlzIHJlc29sdXRp\nb24gb2YgdGhlIHNlbGVjdCBTUUwuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxC\ndWZmZXIgYXBwZW5kQ291bnQoU2VsZWN0IHNlbCwgSkRCQ0ZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCkgewogICAgICAgIHJldHVybiBhcHBlbmQoc2VsLCBm\nZXRjaCwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBz\ndWJzZWxlY3QuIFRoaXMgZGVsYXlzIHJlc29sdXRpb24gb2YgdGhlIHNlbGVj\ndCBTUUwuCiAgICAgKi8KICAgIHByaXZhdGUgU1FMQnVmZmVyIGFwcGVuZChT\nZWxlY3Qgc2VsLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAg\nICAgIGJvb2xlYW4gY291bnQpIHsKICAgICAgICBfc3FsLmFwcGVuZCgiKCIp\nOwogICAgICAgIFN1YnNlbGVjdCBzdWIgPSBuZXcgU3Vic2VsZWN0KCk7CiAg\nICAgICAgc3ViLnNlbGVjdCA9IHNlbDsKICAgICAgICBzdWIuZmV0Y2ggPSBm\nZXRjaDsKICAgICAgICBzdWIuY291bnQgPSBjb3VudDsKICAgICAgICBzdWIu\nc3FsSW5kZXggPSBfc3FsLmxlbmd0aCgpOwogICAgICAgIHN1Yi5wYXJhbUlu\nZGV4ID0gKF9wYXJhbXMgPT0gbnVsbCkgPyAwIDogX3BhcmFtcy5zaXplKCk7\nCiAgICAgICAgX3NxbC5hcHBlbmQoIikiKTsKCiAgICAgICAgaWYgKF9zdWJz\nZWxzID09IG51bGwpCiAgICAgICAgICAgIF9zdWJzZWxzID0gbmV3IEFycmF5\nTGlzdCgyKTsKICAgICAgICBfc3Vic2Vscy5hZGQoc3ViKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2UgYSBz\ndWJzZWxlY3QuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlcGxhY2Uo\nU2VsZWN0IG9sZCwgU2VsZWN0IHNlbCkgewogICAgICAgIGlmIChfc3Vic2Vs\ncyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nU3Vic2VsZWN0IHN1YjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9z\ndWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIHN1YiA9IChTdWJz\nZWxlY3QpIF9zdWJzZWxzLmdldChpKTsKICAgICAgICAgICAgaWYgKHN1Yi5z\nZWxlY3QgPT0gb2xkKSB7CiAgICAgICAgICAgICAgICBzdWIuc2VsZWN0ID0g\nc2VsOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICov\nCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKE9iamVjdCBvKSB7\nCiAgICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKG8sIG51bGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlIGZvciBh\nIHNwZWNpZmljIGNvbHVtbi4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZl\nciBhcHBlbmRWYWx1ZShPYmplY3QgbywgQ29sdW1uIGNvbCkgewogICAgICAg\nIGlmIChvID09IG51bGwpCiAgICAgICAgICAgIF9zcWwuYXBwZW5kKCJOVUxM\nIik7CiAgICAgICAgZWxzZSBpZiAobyBpbnN0YW5jZW9mIFJhdykKICAgICAg\nICAgICAgX3NxbC5hcHBlbmQoby50b1N0cmluZygpKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgX3NxbC5hcHBlbmQoUEFSQU1FVEVSX1RPS0VOKTsK\nCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgcGFyYW0gYW5kIGNvbCBsaXN0\nczsgd2UgaG9sZCBvZmYgb24gY29sIGxpc3QgdW50aWwKICAgICAgICAgICAg\nLy8gd2UgZ2V0IHRoZSBmaXJzdCBub24tbnVsbCBjb2wKICAgICAgICAgICAg\naWYgKF9wYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wYXJhbXMg\nPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgICAgIGlmIChjb2wgIT0gbnVs\nbCAmJiBfY29scyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBfY29scyA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIHdoaWxlIChfY29s\ncy5zaXplKCkgPCBfcGFyYW1zLnNpemUoKSkKICAgICAgICAgICAgICAgICAg\nICBfY29scy5hZGQobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIF9wYXJhbXMuYWRkKG8pOwogICAgICAgICAgICBpZiAoX2NvbHMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9jb2xzLmFkZChjb2wpOwogICAgICAgICAg\nICBpZiAoY29sID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICAgICAgYm9vbGVhbiBpc0ZLID0gZmFsc2U7CiAgICAgICAg\nICAgIEZvcmVpZ25LZXlbXSBma3MgPSBjb2wuZ2V0VGFibGUoKS5nZXRGb3Jl\naWduS2V5cygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZr\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgQ29sdW1uW10gY29s\ncyA9IGZrc1tpXS5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBqID0gMDsgaiA8IGNvbHMubGVuZ3RoOyBqKyspIHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoY29sc1tqXSA9PSBjb2wpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaXNGSyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc0ZLKQogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEg\ncGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVy\nIGFwcGVuZFZhbHVlKGJvb2xlYW4gYikgewogICAgICAgIHJldHVybiBhcHBl\nbmRWYWx1ZShiLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVu\nZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciBhcHBlbmRWYWx1ZShib29sZWFuIGIsIENvbHVtbiBjb2wpIHsKICAg\nICAgICByZXR1cm4gYXBwZW5kVmFsdWUoKGIpID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFw\ncGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciBhcHBlbmRWYWx1ZShieXRlIGIpIHsKICAgICAgICByZXR1cm4g\nYXBwZW5kVmFsdWUoYiwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBT\nUUxCdWZmZXIgYXBwZW5kVmFsdWUoYnl0ZSBiLCBDb2x1bW4gY29sKSB7CiAg\nICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKG5ldyBCeXRlKGIpLCBjb2wpOwog\nICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVl\nLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGNo\nYXIgYykgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShjLCBudWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1\nZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShj\naGFyIGMsIENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFs\ndWUobmV3IENoYXJhY3RlcihjKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVi\nbGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShkb3VibGUgZCkgewogICAgICAg\nIHJldHVybiBhcHBlbmRWYWx1ZShkLCBudWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAg\ncHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShkb3VibGUgZCwgQ29sdW1u\nIGNvbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShuZXcgRG91Ymxl\nKGQpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFy\nYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFw\ncGVuZFZhbHVlKGZsb2F0IGYpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFs\ndWUoZiwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBw\nYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIg\nYXBwZW5kVmFsdWUoZmxvYXQgZiwgQ29sdW1uIGNvbCkgewogICAgICAgIHJl\ndHVybiBhcHBlbmRWYWx1ZShuZXcgRmxvYXQoZiksIGNvbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoaW50IGkpIHsK\nICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUoaSwgbnVsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoaW50IGksIENv\nbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUoTnVtYmVy\ncy52YWx1ZU9mKGkpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogQXBw\nZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIGFwcGVuZFZhbHVlKGxvbmcgbCkgewogICAgICAgIHJldHVybiBh\ncHBlbmRWYWx1ZShsLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFw\ncGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciBhcHBlbmRWYWx1ZShsb25nIGwsIENvbHVtbiBjb2wpIHsKICAg\nICAgICByZXR1cm4gYXBwZW5kVmFsdWUoTnVtYmVycy52YWx1ZU9mKGwpLCBj\nb2wpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVy\nIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZh\nbHVlKHNob3J0IHMpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUocywg\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0\nZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5k\nVmFsdWUoc2hvcnQgcywgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBh\ncHBlbmRWYWx1ZShuZXcgU2hvcnQocyksIGNvbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2YgcGFyYW1ldGVyIHZhbHVlcy4K\nICAgICAqLwogICAgcHVibGljIExpc3QgZ2V0UGFyYW1ldGVycygpIHsKICAg\nICAgICByZXR1cm4gKF9wYXJhbXMgPT0gbnVsbCkgPyBDb2xsZWN0aW9ucy5F\nTVBUWV9MSVNUIDogX3BhcmFtczsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgU1FMIGZvciB0aGlzIGJ1ZmZlci4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXRTUUwoKSB7CiAgICAgICAgcmV0dXJuIGdldFNRTChm\nYWxzZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nU1FMIGZvciB0aGlzIGJ1ZmZlci4KICAgICAqCiAgICAgKiBAcGFyYW0gcmVw\nbGFjZVBhcmFtcyBpZiB0cnVlLCB0aGVuIHJlcGxhY2UgcGFyYW1ldGVycyB3\naXRoIHRoZQogICAgICogYWN0dWFsIHBhcmFtZXRlciB2YWx1ZXMKICAgICAq\nLwogICAgcHVibGljIFN0cmluZyBnZXRTUUwoYm9vbGVhbiByZXBsYWNlUGFy\nYW1zKSB7CiAgICAgICAgcmVzb2x2ZVN1YnNlbGVjdHMoKTsKICAgICAgICBT\ndHJpbmcgc3FsID0gX3NxbC50b1N0cmluZygpOwogICAgICAgIGlmICghcmVw\nbGFjZVBhcmFtcyB8fCBfcGFyYW1zID09IG51bGwgfHwgX3BhcmFtcy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgIHJldHVybiBzcWw7CgogICAgICAgIFN0cmlu\nZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVyKCk7CiAgICAgICAgSXRl\ncmF0b3IgcGkgPSBfcGFyYW1zLml0ZXJhdG9yKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBzcWwubGVuZ3RoKCk7IGkrKykgewogICAgICAgICAg\nICBpZiAoc3FsLmNoYXJBdChpKSAhPSAnPycpIHsKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoc3FsLmNoYXJBdChpKSk7CiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgT2JqZWN0IHBh\ncmFtID0gcGkuaGFzTmV4dCgpID8gcGkubmV4dCgpIDogbnVsbDsKICAgICAg\nICAgICAgaWYgKHBhcmFtID09IG51bGwpCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCJOVUxMIik7CiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtIGlu\nc3RhbmNlb2YgTnVtYmVyIHx8IHBhcmFtIGluc3RhbmNlb2YgQm9vbGVhbikK\nICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQocGFyYW0pOwogICAgICAgICAg\nICBlbHNlIGlmIChwYXJhbSBpbnN0YW5jZW9mIFN0cmluZyB8fCBwYXJhbSBp\nbnN0YW5jZW9mIENoYXJhY3RlcikKICAgICAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiciKS5hcHBlbmQocGFyYW0pLmFwcGVuZCgiJyIpOwogICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCI/Iik7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlc29sdmUgb3VyIGRlbGF5ZWQgc3Vic2VsZWN0cy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlc29sdmVTdWJzZWxlY3RzKCkg\newogICAgICAgIGlmIChfc3Vic2VscyA9PSBudWxsIHx8IF9zdWJzZWxzLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBhZGQg\nc3Vic2VscyBiYWNrd2FyZHMgc28gdGhhdCB0aGUgc3RvcmVkIGluc2VydGlv\nbiBwb2ludHMgb2YKICAgICAgICAvLyBsYXRlciBzdWJzZWxzIHJlbWFpbiB2\nYWxpZAogICAgICAgIFN1YnNlbGVjdCBzdWI7CiAgICAgICAgU1FMQnVmZmVy\nIGJ1ZjsKICAgICAgICBmb3IgKGludCBpID0gX3N1YnNlbHMuc2l6ZSgpIC0g\nMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgc3ViID0gKFN1YnNlbGVj\ndCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAgICBpZiAoc3ViLmNvdW50\nKQogICAgICAgICAgICAgICAgYnVmID0gc3ViLnNlbGVjdC50b1NlbGVjdENv\ndW50KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1ZiA9\nIHN1Yi5zZWxlY3QudG9TZWxlY3QoZmFsc2UsIHN1Yi5mZXRjaCk7CiAgICAg\nICAgICAgIGJ1Zi5yZXNvbHZlU3Vic2VsZWN0cygpOwogICAgICAgICAgICBh\ncHBlbmQoYnVmLCBzdWIuc3FsSW5kZXgsIHN1Yi5wYXJhbUluZGV4LCBmYWxz\nZSk7CiAgICAgICAgfQogICAgICAgIF9zdWJzZWxzLmNsZWFyKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRlIHRoZSBwYXJh\nbWV0ZXJzIG9mIGEgcHJlcGFyZWQgc3RhdGVtZW50IHVzaW5nCiAgICAgKiB0\naGUgU1FMIGluIHRoaXMgYnVmZmVyLgogICAgICovCiAgICBwdWJsaWMgUHJl\ncGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgUmVzdWx0U2V0LlRZUEVfRk9S\nV0FSRF9PTkxZLAogICAgICAgICAgICBSZXN1bHRTZXQuQ09OQ1VSX1JFQURf\nT05MWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVs\nYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGEgcHJlcGFyZWQgc3RhdGVtZW50IHVz\naW5nCiAgICAgKiB0aGUgU1FMIGluIHRoaXMgYnVmZmVyLgogICAgICovCiAg\nICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChD\nb25uZWN0aW9uIGNvbm4sIGludCByc1R5cGUsCiAgICAgICAgaW50IHJzQ29u\nY3VyLCBMaXN0IHBhcm1zKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIG51bGws\nIHJzVHlwZSwgcnNDb25jdXIsIHBhcm1zKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzIG9m\nIGEgcHJlcGFyZWQgc3RhdGVtZW50IHVzaW5nCiAgICAgKiB0aGUgU1FMIGlu\nIHRoaXMgYnVmZmVyLgogICAgICovCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0\nZW1lbnQgcHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4sIGludCBy\nc1R5cGUsCiAgICAgICAgaW50IHJzQ29uY3VyKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBwcmVwYXJlU3RhdGVtZW50\nKGNvbm4sIHJzVHlwZSwgcnNDb25jdXIsIG51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGFuZCBwb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBv\nZiBhIHByZXByZWQgc3RhdGVtZW50IHVzaW5nIHRoZQogICAgICogU1FMIGlu\nIHRoaXMgYnVmZmVyIGFuZCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBh\ncmVTdGF0ZW1lbnQoQ29ubmVjdGlvbiBjb25uLAogICAgICAgIEpEQkNGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5cGUsIGludCByc0NvbmN1\ncikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gcHJlcGFyZVN0YXRlbWVudChjb25uLCBmZXRjaCwgcnNUeXBlLCByc0Nv\nbmN1ciwgbnVsbCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRl\nIGFuZCBwb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXByZWQgc3Rh\ndGVtZW50IHVzaW5nIHRoZQogICAgICogU1FMIGluIHRoaXMgYnVmZmVyIGFu\nZCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbi4KICAgICAqLwogICAg\ncHVibGljIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVTdGF0ZW1lbnQoQ29u\nbmVjdGlvbiBjb25uLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24g\nZmV0Y2gsIGludCByc1R5cGUsIGludCByc0NvbmN1ciwgTGlzdCBwYXJtcykK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAocnNU\neXBlID09IC0xICYmIGZldGNoID09IG51bGwpCiAgICAgICAgICAgIHJzVHlw\nZSA9IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsKICAgICAgICBlbHNl\nIGlmIChyc1R5cGUgPT0gLTEpCiAgICAgICAgICAgIHJzVHlwZSA9IGZldGNo\nLmdldFJlc3VsdFNldFR5cGUoKTsKICAgICAgICBpZiAocnNDb25jdXIgPT0g\nLTEpCiAgICAgICAgICAgIHJzQ29uY3VyID0gUmVzdWx0U2V0LkNPTkNVUl9S\nRUFEX09OTFk7CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50Owog\nICAgICAgIGlmIChyc1R5cGUgPT0gUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9P\nTkxZCiAgICAgICAgICAgICYmIHJzQ29uY3VyID09IFJlc3VsdFNldC5DT05D\nVVJfUkVBRF9PTkxZKQogICAgICAgICAgICBzdG1udCA9IGNvbm4ucHJlcGFy\nZVN0YXRlbWVudChnZXRTUUwoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudChnZXRTUUwoKSwgcnNU\neXBlLCByc0NvbmN1cik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2V0\nUGFyYW1ldGVycyhzdG1udCwgcGFybXMpOwogICAgICAgICAgICBpZiAoZmV0\nY2ggIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGZldGNoLmdldEZl\ndGNoQmF0Y2hTaXplKCkgPiAwKQogICAgICAgICAgICAgICAgICAgIHN0bW50\nLnNldEZldGNoU2l6ZShmZXRjaC5nZXRGZXRjaEJhdGNoU2l6ZSgpKTsKICAg\nICAgICAgICAgICAgIGlmIChyc1R5cGUgIT0gUmVzdWx0U2V0LlRZUEVfRk9S\nV0FSRF9PTkxZCiAgICAgICAgICAgICAgICAgICAgJiYgZmV0Y2guZ2V0RmV0\nY2hEaXJlY3Rpb24oKSAhPSBSZXN1bHRTZXQuRkVUQ0hfRk9SV0FSRCkKICAg\nICAgICAgICAgICAgICAgICBzdG1udC5zZXRGZXRjaERpcmVjdGlvbihmZXRj\naC5nZXRGZXRjaERpcmVjdGlvbigpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gc3RtbnQ7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBz\ndG1udC5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRp\nb24gc2UyKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgc2U7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBw\nb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXBhcmVkIHN0YXRlbWVu\ndCB1c2luZwogICAgICogdGhlIFNRTCBpbiB0aGlzIGJ1ZmZlci4KICAgICAq\nLwogICAgcHVibGljIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVDYWxsKENv\nbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcHJlcGFyZUNhbGwoY29ubiwgUmVzdWx0U2V0LlRZ\nUEVfRk9SV0FSRF9PTkxZLAogICAgICAgICAgICBSZXN1bHRTZXQuQ09OQ1VS\nX1JFQURfT05MWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5k\nIHBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGEgcHJlcGFyZWQgc3RhdGVt\nZW50IHVzaW5nCiAgICAgKiB0aGUgU1FMIGluIHRoaXMgYnVmZmVyLgogICAg\nICovCiAgICBwdWJsaWMgQ2FsbGFibGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwo\nQ29ubmVjdGlvbiBjb25uLCBpbnQgcnNUeXBlLAogICAgICAgIGludCByc0Nv\nbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gcHJlcGFyZUNhbGwoY29ubiwgbnVsbCwgcnNUeXBlLCByc0NvbmN1\ncik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRl\nIHRoZSBwYXJhbWV0ZXJzIG9mIGEgcHJlcHJlZCBzdGF0ZW1lbnQgdXNpbmcg\ndGhlCiAgICAgKiBTUUwgaW4gdGhpcyBidWZmZXIgYW5kIHRoZSBnaXZlbiBm\nZXRjaCBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgQ2FsbGFi\nbGVTdGF0ZW1lbnQgcHJlcGFyZUNhbGwoQ29ubmVjdGlvbiBjb25uLAogICAg\nICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5cGUs\nIGludCByc0NvbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAocnNUeXBlID09IC0xICYmIGZldGNoID09IG51bGwpCiAg\nICAgICAgICAgIHJzVHlwZSA9IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05M\nWTsKICAgICAgICBlbHNlIGlmIChyc1R5cGUgPT0gLTEpCiAgICAgICAgICAg\nIHJzVHlwZSA9IGZldGNoLmdldFJlc3VsdFNldFR5cGUoKTsKICAgICAgICBp\nZiAocnNDb25jdXIgPT0gLTEpCiAgICAgICAgICAgIHJzQ29uY3VyID0gUmVz\ndWx0U2V0LkNPTkNVUl9SRUFEX09OTFk7CgogICAgICAgIENhbGxhYmxlU3Rh\ndGVtZW50IHN0bW50OwogICAgICAgIGlmIChyc1R5cGUgPT0gUmVzdWx0U2V0\nLlRZUEVfRk9SV0FSRF9PTkxZCiAgICAgICAgICAgICYmIHJzQ29uY3VyID09\nIFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZKQogICAgICAgICAgICBzdG1u\ndCA9IGNvbm4ucHJlcGFyZUNhbGwoZ2V0U1FMKCkpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc3RtbnQgPSBjb25uLnByZXBhcmVDYWxsKGdldFNRTCgp\nLCByc1R5cGUsIHJzQ29uY3VyKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBzZXRQYXJhbWV0ZXJzKHN0bW50KTsKICAgICAgICAgICAgaWYgKGZldGNo\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChmZXRjaC5nZXRGZXRj\naEJhdGNoU2l6ZSgpID4gMCkKICAgICAgICAgICAgICAgICAgICBzdG1udC5z\nZXRGZXRjaFNpemUoZmV0Y2guZ2V0RmV0Y2hCYXRjaFNpemUoKSk7CiAgICAg\nICAgICAgICAgICBpZiAocnNUeXBlICE9IFJlc3VsdFNldC5UWVBFX0ZPUldB\nUkRfT05MWQogICAgICAgICAgICAgICAgICAgICYmIGZldGNoLmdldEZldGNo\nRGlyZWN0aW9uKCkgIT0gUmVzdWx0U2V0LkZFVENIX0ZPUldBUkQpCiAgICAg\nICAgICAgICAgICAgICAgc3RtbnQuc2V0RmV0Y2hEaXJlY3Rpb24oZmV0Y2gu\nZ2V0RmV0Y2hEaXJlY3Rpb24oKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHN0bW50OwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlv\nbiBzZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3Rt\nbnQuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9u\nIHNlMikgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IHNlOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBvcHVsYXRlIHRoZSBw\nYXJhbWV0ZXJzIG9mIGFuIGV4aXN0aW5nIFByZXBhcmVkU3RhdGVtZW50CiAg\nICAgKiB3aXRoIHZhbHVlcyBmcm9tIHRoaXMgYnVmZmVyLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRQYXJhbWV0ZXJzKFByZXBhcmVkU3RhdGVtZW50\nIHBzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNl\ndFBhcmFtZXRlcnMocHMsIG51bGwpOwogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGFuIGV4aXN0aW5nIFBy\nZXBhcmVkU3RhdGVtZW50CiAgICAgKiB3aXRoIHZhbHVlcyBmcm9tIHRoaXMg\nYnVmZmVyLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQYXJhbWV0ZXJz\nKFByZXBhcmVkU3RhdGVtZW50IHBzLCBMaXN0IGNhY2hlUGFyYW1zKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIExpc3QgcGFyYW1z\nID0gKChjYWNoZVBhcmFtcyAhPSBudWxsICYmIGNhY2hlUGFyYW1zLnNpemUo\nKSA+IDApID8gCiAgICAgICAgICAgIGNhY2hlUGFyYW1zIDogX3BhcmFtcyk7\nICAgIAogICAgICAgIAogICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBDb2x1bW4gY29sOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1zLnNpemUoKTsgaSsrKSB7CiAg\nICAgICAgICAgIGNvbCA9IChfY29scyA9PSBudWxsKSA/IG51bGwgOiAoQ29s\ndW1uKSBfY29scy5nZXQoaSk7CiAgICAgICAgICAgIF9kaWN0LnNldFVua25v\nd24ocHMsIGkgKyAxLCBwYXJhbXMuZ2V0KGkpLCBjb2wpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgIGlu\ndCBoYXNoID0gX3NxbC5oYXNoQ29kZSgpOwogICAgICAgIHJldHVybiAoX3Bh\ncmFtcyA9PSBudWxsKSA/IGhhc2ggOiBoYXNoIF4gX3BhcmFtcy5oYXNoQ29k\nZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyZSBpbnRlcm5hbCBT\nUUwgd2l0aG91dCByZXNvbHZpbmcgc3Vic2VsZWN0cyBvciBzdHJpbmdpZnlp\nbmcKICAgICAqIHBhcmFtZXRlcnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIHNxbEVxdWFscyhTdHJpbmcgc3FsKSB7CiAgICAgICAgcmV0dXJuIF9z\ncWwudG9TdHJpbmcoKS5lcXVhbHMoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90\naGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGlmICghKG90aGVyIGluc3RhbmNlb2YgU1FMQnVmZmVyKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBTUUxCdWZmZXIgYnVmID0gKFNR\nTEJ1ZmZlcikgb3RoZXI7CiAgICAgICAgcmV0dXJuIF9zcWwuZXF1YWxzKGJ1\nZi5fc3FsKQogICAgICAgICAgICAmJiBPYmplY3RVdGlscy5lcXVhbHMoX3Bh\ncmFtcywgYnVmLl9wYXJhbXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVw\nbGFjZSBTUUwgJz8nIHdpdGggQ0FTVCBzdHJpbmcgaWYgcmVxdWlyZWQgYnkg\nREIgcGxhdGZvcm0KICAgICAqIEBwYXJhbSBvcGVyCiAgICAgKiBAcGFyYW0g\ndmFsCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFkZENhc3RGb3JQYXJhbShT\ndHJpbmcgb3BlciwgVmFsIHZhbCkgewogICAgICAgIGlmIChfc3FsLmNoYXJB\ndChfc3FsLmxlbmd0aCgpIC0gMSkgPT0gJz8nKSB7CiAgICAgICAgICAgIFN0\ncmluZyBjYXN0U3RyaW5nID0gX2RpY3QuYWRkQ2FzdEFzVHlwZShvcGVyLCB2\nYWwpOwogICAgICAgICAgICBpZiAoY2FzdFN0cmluZyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX3NxbC5yZXBsYWNlKF9zcWwubGVuZ3RoKCkgLSAxLCBf\nc3FsLmxlbmd0aCgpLCBjYXN0U3RyaW5nKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXBsYWNlIGN1cnJlbnQgYnVmZmVyIHN0cmluZyB3\naXRoIHRoZSBuZXcgc3RyaW5nCiAgICAgKiAKICAgICAqIEBwYXJhbSBzdGFy\ndCByZXBsYWNlIHN0YXJ0IHBvc2l0aW9uCiAgICAgKiBAcGFyYW0gZW5kIHJl\ncGxhY2UgZW5kIHBvc2l0aW9uCiAgICAgKiBAcGFyYW0gbmV3U3RyaW5nCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlcGxhY2VTcWxTdHJpbmcoaW50IHN0\nYXJ0LCBpbnQgZW5kLCBTdHJpbmcgbmV3U3RyaW5nKSB7CiAgICAgICAgX3Nx\nbC5yZXBsYWNlKHN0YXJ0LCBlbmQsIG5ld1N0cmluZyk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIHN1YnNlbGVjdC4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU3Vic2VsZWN0IHsKCiAgICAg\nICAgcHVibGljIFNlbGVjdCBzZWxlY3Q7CiAgICAgICAgcHVibGljIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2g7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gY291bnQ7CiAgICAgICAgcHVibGljIGludCBzcWxJbmRleDsKICAgICAg\nICBwdWJsaWMgaW50IHBhcmFtSW5kZXg7CgogICAgICAgIHB1YmxpYyBTdWJz\nZWxlY3QgY2xvbmUoaW50IHNxbEluZGV4LCBpbnQgcGFyYW1JbmRleCkgewog\nICAgICAgICAgICBpZiAoc3FsSW5kZXggPT0gMCAmJiBwYXJhbUluZGV4ID09\nIDApCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgICAg\nIFN1YnNlbGVjdCBzdWIgPSBuZXcgU3Vic2VsZWN0KCk7CiAgICAgICAgICAg\nIHN1Yi5zZWxlY3QgPSBzZWxlY3Q7CiAgICAgICAgICAgIHN1Yi5mZXRjaCA9\nIGZldGNoOwogICAgICAgICAgICBzdWIuY291bnQgPSBjb3VudDsKICAgICAg\nICAgICAgc3ViLnNxbEluZGV4ID0gdGhpcy5zcWxJbmRleCArIHNxbEluZGV4\nOwogICAgICAgICAgICBzdWIucGFyYW1JbmRleCA9IHRoaXMucGFyYW1JbmRl\neCArIHBhcmFtSW5kZXg7CiAgICAgICAgICAgIHJldHVybiBzdWI7CiAgICAg\nICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRQYXJhbWV0ZXJz\nKExpc3QgcGFyYW1zKSB7CiAgICAgICAgX3BhcmFtcyA9IHBhcmFtczsKICAg\nIH0KICAgIAogICAgcHVibGljIExpc3QgZ2V0Q29sdW1ucygpIHsKICAgICAg\nICByZXR1cm4gX2NvbHM7CiAgICB9Cn0K\n","encoding":"base64"}

