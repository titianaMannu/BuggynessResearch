{"sha":"3237a97a482d66ac1a390c879bab81dacbe31b94","node_id":"MDQ6QmxvYjIwNjM2NDozMjM3YTk3YTQ4MmQ2NmFjMWEzOTBjODc5YmFiODFkYWNiZTMxYjk0","size":101513,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3237a97a482d66ac1a390c879bab81dacbe31b94","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TdGFjazsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5pdGVyYXRvcnMuRW1wdHlJ\ndGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuY29uZi5K\nREJDQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5FYWdlckZldGNoTW9kZXM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDTG9j\na01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuSkRCQ1N0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\na2VybmVsLkpEQkNTdG9yZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5Kb2luYWJsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuVmFsdWVNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Gb3JlaWduS2V5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRhYmxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRpb25JZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVybmFsRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLk51bWJlcnM7CgovKioKICogU3RhbmRhcmQge0BsaW5r\nIFNlbGVjdH0gaW1wbGVtZW50YXRpb24uIFVzYWdlIG5vdGU6IHRob3VnaCB0\naGlzIGNsYXNzCiAqIGltcGxlbWVudHMge0BsaW5rIEpvaW5zfSwgaXQgc2hv\ndWxkIG5vdCBiZSB1c2VkIGZvciBqb2luaW5nIGRpcmVjdGx5LgogKiBJbnN0\nZWFkLCB1c2UgdGhlIHJldHVybiB2YWx1ZSBvZiB7QGxpbmsgI25ld0pvaW5z\nfS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8K\ncHVibGljIGNsYXNzIFNlbGVjdEltcGwKICAgIGltcGxlbWVudHMgU2VsZWN0\nLCBQYXRoSm9pbnMgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBO\nT05BVVRPX0RJU1RJTkNUID0gMiA8PCAwOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IERJU1RJTkNUID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE5PVF9ESVNUSU5DVCA9IDIgPDwgMjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBJTVBMSUNJVF9ESVNUSU5DVCA9IDIgPDwg\nMzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBUT19NQU5ZID0gMiA8\nPCA0OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFHR1JFR0FURSA9\nIDIgPDwgNTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMT0IgPSAy\nIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgT1VURVIgPSAy\nIDw8IDc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgTFJTID0gMiA8\nPCA4OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RPX09O\nRSA9IDIgPDwgOTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBFQUdF\nUl9UT19NQU5ZID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGludCBSRUNPUkRfT1JERVJFRCA9IDIgPDwgMTE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgR1JPVVBJTkcgPSAyIDw8IDEyOwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZPUkNFX0NPVU5UID0gMiA8PCAxMzsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmdbXSBUQUJMRV9BTElBU0VT\nID0gbmV3IFN0cmluZ1sxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndHJpbmdbXSBPUkRFUl9BTElBU0VTID0gbmV3IFN0cmluZ1sxNl07CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBOVUxMX0lEUyA9IG5ldyBP\nYmplY3RbMTZdOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nUExBQ0VIT0xERVJTID0gbmV3IE9iamVjdFs1MF07CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZShTZWxlY3QuY2xhc3MpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBUQUJMRV9BTElBU0VTLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBUQUJMRV9BTElBU0VTW2ldID0gInQiICsgaTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IE9SREVSX0FMSUFTRVMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE9SREVSX0FMSUFTRVNbaV0gPSAibyIgKyBpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgTlVMTF9JRFMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIE5VTExfSURTW2ldID0gbmV3IE51bGxJZCgpOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgUExBQ0VIT0xERVJTLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBQTEFDRUhPTERFUlNbaV0gPSBuZXcgUGxh\nY2Vob2xkZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIEpEQkNDb25m\naWd1cmF0aW9uIF9jb25mOwogICAgcHJpdmF0ZSBmaW5hbCBEQkRpY3Rpb25h\ncnkgX2RpY3Q7CgogICAgLy8gbWFwIG9mIHZhcmlhYmxlICsgcmVsYXRpb24g\ncGF0aCArIHRhYmxlIGtleXMgdG8gdGhlIGNvcnJlY3QgYWxpYXMgaW5kZXg6\nCiAgICAvLyBlYWNoIHJlbGF0aW9uIHBhdGgvdGFibGUgY29tYmluYXRpb24g\nc2hvdWxkIGhhdmUgYSB1bmlxdWUgYWxpYXMgYmVjYXVzZQogICAgLy8gaXQg\ncmVwcmVzZW50cyBhIHNlcGFyYXRlIG9iamVjdDsgZm9yIGV4YW1wbGUsIGlm\nIGEgUGVyc29uIGNsYXNzIGhhcyBhCiAgICAvLyAncGFyZW50JyBmaWVsZCBy\nZXByZXNlbnRpbmcgYW5vdGhlciBQZXJzb24gYW5kIGFsc28gaGFzIGFuICdh\nZGRyZXNzJwogICAgLy8gZmllbGQgb2YgdHlwZSBBZGRyZXNzOgogICAgLy8g\nJ2FkZHJlc3Muc3RyZWV0JyBzaG91bGQgbWFwIHRvIGEgZGlmZmVyZW50IHRh\nYmxlIGFsaWFzIHRoYW4KICAgIC8vICdwYXJlbnQuYWRkcmVzcy5zdHJlZXQn\nIGZvciB0aGUgcHVycG9zZXMgb2YgY29tcGFyaXNvbnMKICAgIHByaXZhdGUg\nTWFwIF9hbGlhc2VzID0gbnVsbDsKCiAgICAvLyB0byBjYWNoZSB0YWJsZSBh\nbGlhcyB1c2luZyBUYWJsZSBhcyB0aGUga2V5CiAgICBwcml2YXRlIE1hcCBf\ndGFibGVBbGlhc2VzID0gbnVsbDsKCiAgICAvLyBtYXAgb2YgaW5kZXhlcyB0\nbyB0YWJsZSBhbGlhc2VzIGxpa2UgJ1RBQkxFTkFNRSB0MCcKICAgIHByaXZh\ndGUgU29ydGVkTWFwIF90YWJsZXMgPSBudWxsOwoKICAgIC8vIGNvbWJpbmVk\nIGxpc3Qgb2Ygc2VsZWN0ZWQgaWRzIGFuZCBtYXAgb2YgZWFjaCBpZCB0byBp\ndHMgYWxpYXMKICAgIHByb3RlY3RlZCBmaW5hbCBTZWxlY3RzIF9zZWxlY3Rz\nID0gbmV3U2VsZWN0cygpOwogICAgcHJpdmF0ZSBMaXN0IF9vcmRlcmVkID0g\nbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfZ3JvdXBlZCA9IG51bGw7CgogICAg\nLy8gZmxhZ3MKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CiAgICBwcml2\nYXRlIGludCBfam9pblN5bnRheCA9IDA7CiAgICBwcml2YXRlIGxvbmcgX3N0\nYXJ0SWR4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfZW5kSWR4ID0gTG9uZy5N\nQVhfVkFMVUU7CiAgICBwcml2YXRlIGludCBfbnVsbElkcyA9IDA7CiAgICBw\ncml2YXRlIGludCBfb3JkZXJzID0gMDsKICAgIHByaXZhdGUgaW50IF9wbGFj\nZWhvbGRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX2V4cGVjdGVkUmVzdWx0\nQ291bnQgPSAwOwoKICAgIC8vIHF1ZXJ5IGNsYXVzZXMKICAgIHByaXZhdGUg\nU1FMQnVmZmVyIF9vcmRlcmluZyA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1\nZmZlciBfd2hlcmUgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2dy\nb3VwaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVyIF9oYXZpbmcg\nPSBudWxsOwoKICAgIC8vIGpvaW5zIHRvIGFkZCB0byB0aGUgZW5kIG9mIG91\nciB3aGVyZSBjbGF1c2UsIGFuZCBqb2lucyB0byBwcmVwZW5kIHRvCiAgICAv\nLyBhbGwgc2VsZWN0cyAoc2VlIHNlbGVjdChjbGFzc21hcHBpbmcpIG1ldGhv\nZCkKICAgIHByaXZhdGUgU2VsZWN0Sm9pbnMgX2pvaW5zID0gbnVsbDsKICAg\nIHByaXZhdGUgU3RhY2sgX3ByZUpvaW5zID0gbnVsbDsKCiAgICAvLyBtYXAg\nb2Ygam9pbnMra2V5cyB0byBlYWdlciBzZWxlY3RzIGFuZCBnbG9iYWwgc2V0\nIG9mIGVhZ2VyIGtleXM7IHRoZQogICAgLy8gc2FtZSBrZXkgY2FuJ3QgYmUg\ndXNlZCBtb3JlIHRoYW4gb25jZQogICAgcHJpdmF0ZSBNYXAgX2VhZ2VyID0g\nbnVsbDsKICAgIHByaXZhdGUgU2V0IF9lYWdlcktleXMgPSBudWxsOwoKICAg\nIC8vIHN1YnNlbGVjdCBzdXBwb3J0CiAgICBwcml2YXRlIExpc3QgX3N1YnNl\nbHMgPSBudWxsOwogICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9wYXJlbnQgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTdHJpbmcgX3N1YlBhdGggPSBudWxsOwoKICAg\nIC8vIGZyb20gc2VsZWN0IGlmIHRoaXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBh\nIHRtcCB0YWJsZSBjcmVhdGVkIGJ5IGFub3RoZXIKICAgIHByaXZhdGUgU2Vs\nZWN0SW1wbCBfZnJvbSA9IG51bGw7CiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1w\nbCBfb3V0ZXIgPSBudWxsOwogICAgCiAgICAvLyBiaXRTZXQgaW5kaWNhdGlu\nZyBpZiBhbiBhbGlhcyBpcyByZW1vdmVkIGZyb20gcGFyZW50IHNlbGVjdAog\nICAgLy8gYml0IDAgOiBjb3JyZXNwb25kIHRvIGFsaWFzIDAKICAgIC8vIGJp\ndCAxIDogY29ycmVzcG9uZCB0byBhbGlhcyAxLCBldGMuCiAgICAvLyBpZiB0\naGUgYml0IGlzIHNldCwgdGhlIGNvcnJlc3BvbmRpbmcgYWxpYXMgaGFzIGJl\nZW4gcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgLy8gYW5kIHJlY29yZGVkIHVu\nZGVyIHN1YnNlbGVjdC4KICAgIHByaXZhdGUgQml0U2V0IF9yZW1vdmVkQWxp\nYXNGcm9tUGFyZW50ID0gbmV3IEJpdFNldCgxNik7CgogICAgLy9jb250YWlu\ncyBmaW5hbCBzcWwgc3RhdGVtZW50IHRvIGJlIGV4ZWN1dGVkL2NhY2hlZAog\nICAgcHJpdmF0ZSBTUUxCdWZmZXIgX3NxbCA9IG51bGw7CiAgICAKICAgIC8q\nKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhlIHByb3BlciB0\nYWJsZSBhbGlhcyBmb3IgdGhlIGdpdmVuIGFsaWFzIGluZGV4LgogICAgICov\nCiAgICBzdGF0aWMgU3RyaW5nIHRvQWxpYXMoaW50IGluZGV4KSB7CiAgICAg\nICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoaW5kZXggPCBUQUJMRV9BTElBU0VTLmxlbmd0aCkKICAg\nICAgICAgICAgcmV0dXJuIFRBQkxFX0FMSUFTRVNbaW5kZXhdOwogICAgICAg\nIHJldHVybiAidCIgKyBpbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBwcm9wZXIgb3JkZXIgYWxpYXMg\nZm9yIHRoZSBnaXZlbiBvcmRlcgogICAgICogY29sdW1uIGluZGV4LgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyB0b09yZGVyQWxpYXMoaW50\nIGluZGV4KSB7CiAgICAgICAgaWYgKGluZGV4ID09IC0xKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoaW5kZXggPCBPUkRFUl9BTElB\nU0VTLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIE9SREVSX0FMSUFTRVNb\naW5kZXhdOwogICAgICAgIHJldHVybiAibyIgKyBpbmRleDsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlv\nbi4KICAgICAqLwogICAgcHVibGljIFNlbGVjdEltcGwoSkRCQ0NvbmZpZ3Vy\nYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29uZjsKICAgICAgICBf\nZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAg\nICAgX2pvaW5TeW50YXggPSBfZGljdC5qb2luU3ludGF4OwogICAgICAgIF9z\nZWxlY3RzLl9kaWN0ID0gX2RpY3Q7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RFeGVjdXRvciBp\nbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgcHVibGljIEpEQkNDb25maWd1cmF0aW9uIGdldENvbmZp\nZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25mOwogICAgfQoKICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoYm9vbGVhbiBmb3JVcGRhdGUs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1\ncm4gX2RpY3QudG9TZWxlY3QodGhpcywgZm9yVXBkYXRlLCBmZXRjaCk7CiAg\nICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NlbGVjdENvdW50KCkgewog\nICAgICAgIHJldHVybiBfZGljdC50b1NlbGVjdENvdW50KHRoaXMpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGdldEF1dG9EaXN0aW5jdCgpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIE5PTkFVVE9fRElTVElOQ1QpID09IDA7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0Rpc3RpbmN0KGJvb2xl\nYW4gdmFsKSB7CiAgICAgICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5OT05BVVRPX0RJU1RJTkNUOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2ZsYWdzIHw9IE5PTkFVVE9fRElTVElOQ1Q7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaXNEaXN0aW5jdCgpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIE5PVF9ESVNUSU5DVCkgPT0gMCAmJiAoKF9mbGFncyAmIERJU1RJ\nTkNUKSAhPSAwCiAgICAgICAgICAgIHx8ICgoX2ZsYWdzICYgTk9OQVVUT19E\nSVNUSU5DVCkgPT0gMAogICAgICAgICAgICAmJiAoX2ZsYWdzICYgSU1QTElD\nSVRfRElTVElOQ1QpICE9IDApKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXREaXN0aW5jdChib29sZWFuIGRpc3RpbmN0KSB7CiAgICAgICAgLy8gbmVl\nZCB0d28gZmxhZ3MgaW4gY2FzZSBzZXQgbm90X2Rpc3RpbmN0LCB0aGVuIGEg\ndG8tbWFueSBqb2luIGhhcHBlbnMKICAgICAgICAvLyBhbmQgZGlzdGluY3Qg\nZmxhZyBnZXRzIHNldCBhdXRvbWF0aWNhbGx5CiAgICAgICAgaWYgKGRpc3Rp\nbmN0KSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBESVNUSU5DVDsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5OT1RfRElTVElOQ1Q7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IE5PVF9ESVNUSU5DVDsKICAgICAg\nICAgICAgX2ZsYWdzICY9IH5ESVNUSU5DVDsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNMUlMoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBMUlMpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nTFJTKGJvb2xlYW4gbHJzKSB7CiAgICAgICAgaWYgKGxycykKICAgICAgICAg\nICAgX2ZsYWdzIHw9IExSUzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9m\nbGFncyAmPSB+TFJTOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RXhwZWN0\nZWRSZXN1bHRDb3VudCgpIHsKICAgICAgICAvLyBpZiB0aGUgY291bnQgaXNu\nJ3QgZm9yY2VkIGFuZCB3ZSBoYXZlIHRvLW1hbnkgZWFnZXIgam9pbnMgdGhh\ndCBjb3VsZAogICAgICAgIC8vIHRocm93IHRoZSBjb3VudCBvZmYsIGRvbid0\nIHBheSBhdHRlbnRpb24gdG8gaXQKICAgICAgICBpZiAoKF9mbGFncyAmIEZP\nUkNFX0NPVU5UKSA9PSAwICYmIGhhc0VhZ2VySm9pbih0cnVlKSkKICAgICAg\nICAgICAgcmV0dXJuIDA7CiAgICAgICAgcmV0dXJuIF9leHBlY3RlZFJlc3Vs\ndENvdW50OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEV4cGVjdGVkUmVz\ndWx0Q291bnQoaW50IGV4cGVjdGVkUmVzdWx0Q291bnQsIGJvb2xlYW4gZm9y\nY2UpIHsKICAgICAgICBfZXhwZWN0ZWRSZXN1bHRDb3VudCA9IGV4cGVjdGVk\nUmVzdWx0Q291bnQ7CiAgICAgICAgaWYgKGZvcmNlKQogICAgICAgICAgICBf\nZmxhZ3MgfD0gRk9SQ0VfQ09VTlQ7CiAgICAgICAgZWxzZSAKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GT1JDRV9DT1VOVDsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldEpvaW5TeW50YXgoKSB7CiAgICAgICAgcmV0dXJuIF9qb2luU3lu\ndGF4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEpvaW5TeW50YXgoaW50\nIGpvaW5TeW50YXgpIHsKICAgICAgICBfam9pblN5bnRheCA9IGpvaW5TeW50\nYXg7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21B\nY2Nlc3MoYm9vbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICByZXR1cm4gX2Rp\nY3Quc3VwcG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQodGhpcywgZm9yVXBk\nYXRlKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xvY2tp\nbmcoKSB7CiAgICAgICAgcmV0dXJuIF9kaWN0LnN1cHBvcnRzTG9ja2luZyh0\naGlzKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldENvdW50KEpEQkNTdG9y\nZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBDb25uZWN0aW9uIGNvbm4gPSBudWxsOwogICAgICAgIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50ID0gbnVsbDsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBzcWwg\nPSB0b1NlbGVjdENvdW50KCk7CiAgICAgICAgICAgIGNvbm4gPSBzdG9yZS5n\nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0\nYXRlbWVudChjb25uLCBzcWwsIG51bGwsIAogICAgICAgICAgICAgICAgUmVz\ndWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZLCAKICAgICAgICAgICAgICAgIFJl\nc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZLCBmYWxzZSk7CiAgICAgICAgICAg\nIHJzID0gZXhlY3V0ZVF1ZXJ5KGNvbm4sIHN0bW50LCBzcWwsIGZhbHNlLCBz\ndG9yZSwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBnZXRDb3VudChycyk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJzICE9IG51\nbGwpCiAgICAgICAgICAgICAgICB0cnkgeyBycy5jbG9zZSgpOyB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAh\nPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsg\nfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAo\nY29ubiAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9z\nZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3RvcmUgc3Rv\ncmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIAogICAgICAgIExp\nc3QgcGFybXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICBm\nZXRjaC5nZXRSZWFkTG9ja0xldmVsKCksIHBhcm1zKTsKICAgIH0KCiAgICBw\ndWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoKSAKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZSwgZmV0Y2gs\nIG51bGwpOwogICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0IGV4ZWN1dGUoSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIGludCBsb2NrTGV2ZWwsIExpc3QgcGFybXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChmZXRjaCA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGUoc3Rv\ncmUuZ2V0Q29udGV4dCgpLCBzdG9yZSwgZmV0Y2gsIGxvY2tMZXZlbCwgcGFy\nbXMpOwogICAgfQoKICAgIHB1YmxpYyBSZXN1bHQgZXhlY3V0ZShKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAg\nICAgaW50IGxvY2tMZXZlbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZSwgZmV0Y2gsIGxvY2tM\nZXZlbCwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeGVjdXRlIHRo\naXMgc2VsZWN0IGluIHRoZSBjb250ZXh0IG9mIHRoZSBnaXZlbiBzdG9yZSBt\nYW5hZ2VyLiBUaGUKICAgICAqIGNvbnRleHQgaXMgcGFzc2VkIGluIHNlcGFy\nYXRlbHkgZm9yIHByb2ZpbGluZyBwdXJwb3Nlcy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFJlc3VsdCBleGVjdXRlKFN0b3JlQ29udGV4dCBjdHgsIEpEQkNT\ndG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCwgaW50IGxvY2tMZXZlbCwgTGlzdCBwYXJhbXMpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiBmb3JVcGRhdGUg\nPSBpc0ZvclVwZGF0ZShzdG9yZSwgbG9ja0xldmVsKTsKICAgICAgICAKICAg\nICAgICAvLyBBIG5vbi1udWxsIF9zcWwgaW5kaWNhdGVzIHRoYXQgdGhpcyBT\nZWxlY3RJbXBsIG9iamVjdAogICAgICAgIC8vIGlzIG9idGFpbmVkIGZyb20g\nY2FjaGUuIFRoZSBfc3FsIGlzIGNvbnN0cnVjdGVkCiAgICAgICAgLy8gdW5k\nZXIgdGhlIGFzc3VtcHRpb24gdGhhdCBpc0FnZ3JlZ2F0ZSgpIGlzIGZhbHNl\nCiAgICAgICAgLy8gYW5kIF9ncm91cGluZyBpcyBudWxsLiBJZiBuZWl0aGVy\nIG9mIHRoZXNlIGhvbGRzLAogICAgICAgIC8vIHdlIG5lZWQgdG8gcmUtY29u\nc3RydWN0IHRoZSBfc3FsCiAgICAgICAgaWYgKF9zcWwgIT0gbnVsbCAmJiAo\naXNBZ2dyZWdhdGUoKSB8fCBfZ3JvdXBpbmcgIT0gbnVsbCkpIAogICAgICAg\nICAgICBfc3FsID0gbnVsbDsKICAgICAgICAKICAgICAgICBpZiAoX3NxbCA9\nPSBudWxsKSAKICAgICAgICAJX3NxbCA9IHRvU2VsZWN0KGZvclVwZGF0ZSwg\nZmV0Y2gpOwogICAgICAgIAogICAgICAgIGJvb2xlYW4gaXNMUlMgPSBpc0xS\nUygpOwogICAgICAgIGludCByc1R5cGUgPSAoaXNMUlMgJiYgc3VwcG9ydHNS\nYW5kb21BY2Nlc3MoZm9yVXBkYXRlKSkKICAgICAgICAgICAgPyAtMSA6IFJl\nc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsKICAgICAgICBDb25uZWN0aW9u\nIGNvbm4gPSBzdG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxsOwogICAgICAgIFJlc3VsdFNldCBy\ncyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzTFJT\nKSAKICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChj\nb25uLCBfc3FsLCBmZXRjaCwgcnNUeXBlLCAtMSwgdHJ1ZSwgCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcmFtcyk7IAogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwg\nX3NxbCwgbnVsbCwgcnNUeXBlLCAtMSwgZmFsc2UsIAogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJhbXMpOwogICAgICAgICAgICAKICAgICAgICAgICAg\nc2V0VGltZW91dChzdG1udCwgZm9yVXBkYXRlLCBmZXRjaCk7CiAgICAgICAg\nICAgIAogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1u\ndCwgX3NxbCwgaXNMUlMsIHN0b3JlLCBwYXJhbXMpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAvLyBjbGVhbiB1\ncCBzdGF0ZW1lbnQKICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UyKSB7fQogICAgICAgICAgICB0cnkgeyBjb25uLmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAg\nICAgIHRocm93IHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGdldEVh\nZ2VyUmVzdWx0KGNvbm4sIHN0bW50LCBycywgc3RvcmUsIGZldGNoLCBmb3JV\ncGRhdGUsIAogICAgICAgICAgICBfc3FsLmdldFNRTCgpLCBwYXJhbXMpOwog\nICAgfQogICAgCiAgICBwcml2YXRlIGJvb2xlYW4gaXNGb3JVcGRhdGUoSkRC\nQ1N0b3JlIHN0b3JlLCBpbnQgbG9ja0xldmVsKSB7CiAgICAJYm9vbGVhbiBm\nb3JVcGRhdGUgPSBmYWxzZTsKICAgICAgICBpZiAoIWlzQWdncmVnYXRlKCkg\nJiYgX2dyb3VwaW5nID09IG51bGwpIHsKICAgICAgICAgICAgSkRCQ0xvY2tN\nYW5hZ2VyIGxtID0gc3RvcmUuZ2V0TG9ja01hbmFnZXIoKTsKICAgICAgICAg\nICAgaWYgKGxtICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3JVcGRhdGUg\nPSBsbS5zZWxlY3RGb3JVcGRhdGUodGhpcywgbG9ja0xldmVsKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGZvclVwZGF0ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEV4ZWN1dGUgb3VyIGVhZ2VyIHNlbGVjdHMsIGFkZGluZyB0aGUg\ncmVzdWx0cyB1bmRlciB0aGUgc2FtZSBrZXlzCiAgICAgKiB0byB0aGUgZ2l2\nZW4gcmVzdWx0LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGFk\nZEVhZ2VyUmVzdWx0cyhTZWxlY3RSZXN1bHQgcmVzLCBTZWxlY3RJbXBsIHNl\nbCwKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gsIExpc3QgcGFyYW1zKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChzZWwuX2VhZ2VyID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZXhlY3V0ZSBlYWdlciBz\nZWxlY3RzCiAgICAgICAgTWFwLkVudHJ5IGVudHJ5OwogICAgICAgIFJlc3Vs\ndCBlcmVzOwogICAgICAgIE1hcCBlYWdlcjsKICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGl0ciA9IHNlbC5fZWFnZXIuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBlbnRyeSA9IChNYXAuRW50\ncnkpIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAvLyBzaW11bGF0ZWQgYmF0\nY2hlZCBzZWxlY3RzIGZvciBpbm5lci9vdXRlciBqb2luczsgZm9yIHNlcGFy\nYXRlCiAgICAgICAgICAgIC8vIHNlbGVjdHMsIGRvbid0IHBhc3Mgb24gbG9j\nayBsZXZlbCwgYmVjYXVzZSB0aGV5J3JlIHByb2JhYmx5CiAgICAgICAgICAg\nIC8vIGZvciByZWxhdGlvbnMgYW5kIHRoZXJlZm9yZSBzaG91bGQgdXNlIGRl\nZmF1bHQgbGV2ZWwKICAgICAgICAgICAgaWYgKGVudHJ5LmdldFZhbHVlKCkg\nPT0gc2VsKQogICAgICAgICAgICAgICAgZXJlcyA9IHJlczsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgZXJlcyA9ICgoU2VsZWN0RXhlY3V0\nb3IpIGVudHJ5LmdldFZhbHVlKCkpLmV4ZWN1dGUoc3RvcmUsCiAgICAgICAg\nICAgICAgICAgICAgZmV0Y2gsIHBhcmFtcyk7CgogICAgICAgICAgICBlYWdl\nciA9IHJlcy5nZXRFYWdlck1hcChmYWxzZSk7CiAgICAgICAgICAgIGlmIChl\nYWdlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBlYWdlciA9IG5ldyBI\nYXNoTWFwKCk7CiAgICAgICAgICAgICAgICByZXMuc2V0RWFnZXJNYXAoZWFn\nZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVhZ2VyLnB1dChlbnRy\neS5nZXRLZXkoKSwgZXJlcyk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioK\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9u\nIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rp\nb24gY29ubiwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgCiAgICAgICAgaW50IHJz\nQ29uY3VyLCBib29sZWFuIGlzTFJTKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBhZGQgY29tbWVudHMgd2h5IHdlIHBhc3MgaW4gbnVsbCBh\ncyB0aGUgbGFzdCBwYXJhbWV0ZXIKICAgICAgICByZXR1cm4gcHJlcGFyZVN0\nYXRlbWVudChjb25uLCBzcWwsIGZldGNoLCByc1R5cGUsIHJzQ29uY3VyLCBp\nc0xSUywgCiAgICAgICAgICAgICAgICBudWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9u\nIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rp\nb24gY29ubiwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgCiAgICAgICAgaW50IHJz\nQ29uY3VyLCBib29sZWFuIGlzTFJTLCBMaXN0IHBhcmFtcykgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBzcWwucHJlcGFyZVN0YXRlbWVudChjb25uLCByc1R5\ncGUsIHJzQ29uY3VyLCBwYXJhbXMpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgcmV0dXJuIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCBy\nc1R5cGUsIC0xLCBwYXJhbXMpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1K\nREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHNl\ndHRpbmcgcXVlcnkgdGltZW91dC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc2V0VGltZW91dChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgYm9vbGVh\nbiBmb3JVcGRhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gaWYgdGhp\ncyBpcyBhIGxvY2tpbmcgc2VsZWN0IGFuZCB0aGUgbG9jayB0aW1lb3V0IGlz\nIGdyZWF0ZXIgdGhhbgogICAgICAgIC8vIHRoZSBjb25maWd1cmVkIHF1ZXJ5\nIHRpbWVvdXQsIHVzZSB0aGUgbG9jayB0aW1lb3V0CiAgICAgICAgaWYgKGZv\nclVwZGF0ZSAmJiBfZGljdC5zdXBwb3J0c1F1ZXJ5VGltZW91dCAmJiBmZXRj\naCAhPSBudWxsIAogICAgICAgICAgICAmJiBmZXRjaC5nZXRMb2NrVGltZW91\ndCgpID4gc3RtbnQuZ2V0UXVlcnlUaW1lb3V0KCkgKiAxMDAwKSB7CiAgICAg\nICAgICAgIGludCB0aW1lb3V0ID0gZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKTsK\nICAgICAgICAgICAgaWYgKHRpbWVvdXQgPCAxMDAwKSB7CiAgICAgICAgICAg\nICAgICB0aW1lb3V0ID0gMTAwMDsgCiAgICAgICAgICAgICAgICBMb2cgbG9n\nID0gX2NvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19KREJDKTsK\nICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJtaWxsaXMtcXVl\ncnktdGltZW91dCIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdG1u\ndC5zZXRRdWVyeVRpbWVvdXQodGltZW91dCAvIDEwMDApOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3Zp\nZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAq\nIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyBxdWVyeS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoQ29ubmVjdGlv\nbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgCiAgICAgICAgU1FM\nQnVmZmVyIHNxbCwgYm9vbGVhbiBpc0xSUywgSkRCQ1N0b3JlIHN0b3JlLCBM\naXN0IHBhcmFtcykgCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3Zl\ncnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxl\nbWVudGF0aW9uIG9mIGdldHRpbmcgY291bnQgZnJvbSB0aGUgcmVzdWx0IHNl\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIGludCBnZXRDb3VudChSZXN1bHRT\nZXQgcnMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJzLm5leHQo\nKTsKICAgICAgICByZXR1cm4gcnMuZ2V0SW50KDEpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGV4ZWN1dGluZyBlYWdlciBzZWxlY3RzLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgUmVzdWx0IGdldEVhZ2VyUmVzdWx0KENvbm5lY3Rpb24g\nY29ubiwgCiAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIFJlc3Vs\ndFNldCBycywgSkRCQ1N0b3JlIHN0b3JlLCAKICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBib29sZWFuIGZvclVwZGF0ZSwgU3RyaW5n\nIHNxbFN0ciwKICAgICAgICBMaXN0IHBhcmFtcykgCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2VsZWN0UmVzdWx0IHJlcyA9IG5l\ndyBTZWxlY3RSZXN1bHQoY29ubiwgc3RtbnQsIHJzLCBfZGljdCk7CiAgICAg\nICAgcmVzLnNldFNlbGVjdCh0aGlzKTsKICAgICAgICByZXMuc2V0U3RvcmUo\nc3RvcmUpOwogICAgICAgIHJlcy5zZXRMb2NraW5nKGZvclVwZGF0ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYWRkRWFnZXJSZXN1bHRzKHJlcywg\ndGhpcywgc3RvcmUsIGZldGNoLCBwYXJhbXMpOwogICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICByZXMuY2xvc2UoKTsK\nICAgICAgICAgICAgdGhyb3cgc2U7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiByZXM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwog\nICAgLy8gU2VsZWN0IGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIGludCBpbmRleE9mKCkgewogICAg\nICAgIHJldHVybiAwOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFN1YnNl\nbGVjdHMoKSB7CiAgICAgICAgcmV0dXJuIChfc3Vic2VscyA9PSBudWxsKSA/\nIENvbGxlY3Rpb25zLkVNUFRZX0xJU1QgOiBfc3Vic2VsczsKICAgIH0KCiAg\nICBwdWJsaWMgU2VsZWN0IGdldFBhcmVudCgpIHsKICAgICAgICByZXR1cm4g\nX3BhcmVudDsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFN1YnNlbGVj\ndFBhdGgoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJQYXRoOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFBhcmVudChTZWxlY3QgcGFyZW50LCBTdHJpbmcg\ncGF0aCkgewogICAgICAgIGlmIChwYXRoICE9IG51bGwpCiAgICAgICAgICAg\nIF9zdWJQYXRoID0gcGF0aCArICc6JzsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIF9zdWJQYXRoID0gbnVsbDsKCiAgICAgICAgaWYgKHBhcmVudCA9PSBf\ncGFyZW50KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKF9wYXJl\nbnQgIT0gbnVsbCkKICAgICAgICAgICAgX3BhcmVudC5fc3Vic2Vscy5yZW1v\ndmUodGhpcyk7CgogICAgICAgIC8vIyMjIHJpZ2h0IG5vdyB3ZSBjYW4ndCB1\nc2Ugc3FsOTIgam9pbnMgd2l0aCBzdWJzZWxlY3RzLCBjYXVzZQogICAgICAg\nIC8vIyMjIEkgY2FuJ3QgZmlndXJlIG91dCB3aGF0IHRvIGRvIHdoZW4gdGhl\nIHN1YnNlbGVjdCBoYXMgYSBqb2luCiAgICAgICAgLy8jIyMgd2l0aCBhbiBh\nbGlhcyBhbHNvIHByZXNlbnQgaW4gdGhlIG91dGVyIHNlbGVjdC4uLiB5b3Ug\nZG9uJ3Qgd2FudAogICAgICAgIC8vIyMjIHRoZSBqb2luIHRvIGFwcGVhciBp\nbiB0aGUgRlJPTSBjbGF1c2Ugb2YgdGhlIHN1YnNlbGVjdCBjYXVzZQogICAg\nICAgIC8vIyMjIHRoZW4gaXQgcmUtYWxpYXNlcyBib3RoIHRhYmxlcyBpbiB0\naGUgc2NvcGUgb2YgdGhlIHN1YnNlbGVjdAogICAgICAgIC8vIyMjIGFuZCB0\naGUgY29ycmVsYXRpb24gd2l0aCB0aGUgb3V0ZXIgc2VsZWN0IGlzIGxvc3QK\nICAgICAgICBfcGFyZW50ID0gKFNlbGVjdEltcGwpIHBhcmVudDsKICAgICAg\nICBpZiAoX3BhcmVudCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfcGFy\nZW50Ll9zdWJzZWxzID09IG51bGwpCiAgICAgICAgICAgICAgICBfcGFyZW50\nLl9zdWJzZWxzID0gbmV3IEFycmF5TGlzdCgyKTsKICAgICAgICAgICAgX3Bh\ncmVudC5fc3Vic2Vscy5hZGQodGhpcyk7CiAgICAgICAgICAgIGlmIChfcGFy\nZW50Ll9qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhfU1FMOTIp\nCiAgICAgICAgICAgICAgICBfam9pblN5bnRheCA9IEpvaW5TeW50YXhlcy5T\nWU5UQVhfVFJBRElUSU9OQUw7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIF9qb2luU3ludGF4ID0gX3BhcmVudC5fam9pblN5bnRheDsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKF9wYXJlbnQuZ2V0QWxpYXNl\ncygpID09IG51bGwgfHwgX3N1YlBhdGggPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBpZiAoX3BhcmVudC5fYWxpYXNlcy5zaXplKCkg\nPD0gMSkKICAgICAgICAgICAgcmV0dXJuOwogCiAgICAgICAgLy8gRG8gbm90\nIHJlbW92ZSBhbGlhc2VzIGZvciBkYXRhYmFzZXMgdGhhdCB1c2UgU1lOVEFY\nX0RBVEFCQVNFIChvcmFjbGUpCiAgICAgICAgaWYoX3BhcmVudC5fam9pblN5\nbnRheCAhPSBKb2luU3ludGF4ZXMuU1lOVEFYX0RBVEFCQVNFKSB7CiAgICAg\nICAgICAgIC8vIHJlc29sdmUgYWxpYXNlcyBmb3Igc3Vic2VsZWN0IGZyb20g\ncGFyZW50CiAgICAgICAgICAgIFNldDxNYXAuRW50cnk+IGVudHJpZXMgPSBf\ncGFyZW50LmdldEFsaWFzZXMoKS5lbnRyeVNldCgpOwogICAgICAgICAgICBm\nb3IgKE1hcC5FbnRyeSBlbnRyeSA6IGVudHJpZXMpIHsKICAgICAgICAgICAg\nICAgIE9iamVjdCBrZXkgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAg\nICAgIEludGVnZXIgYWxpYXMgPSAoSW50ZWdlcikgZW50cnkuZ2V0VmFsdWUo\nKTsKICAgICAgICAgICAgICAgIGlmIChrZXkudG9TdHJpbmcoKS5pbmRleE9m\nKF9zdWJQYXRoKSAhPSAtMSB8fAogICAgICAgICAgICAgICAgICAgICAgICBf\ncGFyZW50LmZpbmRUYWJsZUFsaWFzKGFsaWFzKSA9PSBmYWxzZSkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAg\nICAgICAgICAgICAgICAgICAgX2FsaWFzZXMucHV0KGtleSwgYWxpYXMpOwoK\nICAgICAgICAgICAgICAgICAgICBPYmplY3QgdGFibGVTdHJpbmcgPSBfcGFy\nZW50LmdldFRhYmxlcygpLmdldChhbGlhcyk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKF90YWJsZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgX3RhYmxlcyA9IG5ldyBUcmVlTWFwKCk7CiAgICAgICAgICAgICAgICAg\nICAgX3RhYmxlcy5wdXQoYWxpYXMsIHRhYmxlU3RyaW5nKTsKCiAgICAgICAg\nICAgICAgICAgICAgX3JlbW92ZWRBbGlhc0Zyb21QYXJlbnQuc2V0KGFsaWFz\nLmludFZhbHVlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAoX2FsaWFzZXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgLy8gYWxpYXNlcyBtb3ZlZCBpbnRvIHN1YnNlbGVjdCBzaG91\nbGQgYmUgcmVtb3ZlZCBmcm9tIHBhcmVudAogICAgICAgICAgICAgICAgZW50\ncmllcyA9IF9hbGlhc2VzLmVudHJ5U2V0KCk7CiAgICAgICAgICAgICAgICBm\nb3IgKE1hcC5FbnRyeSBlbnRyeSA6IGVudHJpZXMpIHsKICAgICAgICAgICAg\nICAgICAgICBPYmplY3Qga2V5ID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAg\nICAgICAgICAgICAgSW50ZWdlciBhbGlhcyA9IChJbnRlZ2VyKSBlbnRyeS5n\nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChrZXkudG9TdHJp\nbmcoKS5pbmRleE9mKF9zdWJQYXRoKSAhPSAtMSB8fAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgX3BhcmVudC5maW5kVGFibGVBbGlhcyhhbGlhcykg\nPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3BhcmVudC5y\nZW1vdmVBbGlhcyhrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgT2Jq\nZWN0IHRhYmxlU3RyaW5nID0gX3BhcmVudC5nZXRUYWJsZXMoKS5nZXQoYWxp\nYXMpOwogICAgICAgICAgICAgICAgICAgICAgICBfcGFyZW50LnJlbW92ZVRh\nYmxlKGFsaWFzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgYm9vbGVhbiBmaW5kVGFibGVBbGlhcyhJbnRlZ2VyIGFsaWFz\nKSB7CiAgICAgICAgLy8gaWYgYWxpYXMgaXMgZGVmaW5lZCBhbmQgcmVmZXJl\nbmNlZCwgcmV0dXJuIHRydWUuCiAgICAgICAgU3RyaW5nIHZhbHVlID0gInQi\nICsgYWxpYXMudG9TdHJpbmcoKSArICIuIjsKICAgICAgICBpZiAoX3RhYmxl\nQWxpYXNlcyAhPSBudWxsKQogICAgICAgICAgICBpZiAoX3RhYmxlQWxpYXNl\ncy5jb250YWluc1ZhbHVlKHZhbHVlKSkKICAgICAgICAgICAgICAgcmV0dXJu\nIF90YWJsZXMuY29udGFpbnNLZXkoYWxpYXMpOwogICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgcmV0dXJuIF9qb2lucyAhPSBudWxsOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBNYXAgZ2V0QWxpYXNlcygpIHsKICAgICAgICByZXR1cm4gX2Fs\naWFzZXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHJlbW92ZUFsaWFz\nKE9iamVjdCBrZXkpIHsKICAgICAgICBfYWxpYXNlcy5yZW1vdmUoa2V5KTsK\nICAgIH0KICAgIAogICAgcHVibGljIE1hcCBnZXRUYWJsZXMoKSB7CiAgICAg\nICAgcmV0dXJuIF90YWJsZXM7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lk\nIHJlbW92ZVRhYmxlKE9iamVjdCBrZXkpIHsKICAgICAgICBfdGFibGVzLnJl\nbW92ZShrZXkpOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3QgZ2V0RnJvbVNl\nbGVjdCgpIHsKICAgICAgICByZXR1cm4gX2Zyb207CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0RnJvbVNlbGVjdChTZWxlY3Qgc2VsKSB7CiAgICAgICAg\nX2Zyb20gPSAoU2VsZWN0SW1wbCkgc2VsOwogICAgICAgIGlmIChfZnJvbSAh\nPSBudWxsKQogICAgICAgICAgICBfZnJvbS5fb3V0ZXIgPSB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc0VhZ2VySm9pbihib29sZWFuIHRv\nTWFueSkgewogICAgICAgIGlmICh0b01hbnkpCiAgICAgICAgICAgIHJldHVy\nbiAoX2ZsYWdzICYgRUFHRVJfVE9fTUFOWSkgIT0gMDsKICAgICAgICByZXR1\ncm4gKF9mbGFncyAmIEVBR0VSX1RPX09ORSkgIT0gMDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNKb2luKGJvb2xlYW4gdG9NYW55KSB7CiAgICAg\nICAgaWYgKHRvTWFueSkKICAgICAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBU\nT19NQU5ZKSAhPSAwOwogICAgICAgIHJldHVybiBfdGFibGVzICE9IG51bGwg\nJiYgX3RhYmxlcy5zaXplKCkgPiAxOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGlzU2VsZWN0ZWQoVGFibGUgdGFibGUpIHsKICAgICAgICBQYXRoSm9p\nbnMgcGogPSBnZXRKb2lucyhudWxsLCBmYWxzZSk7CiAgICAgICAgaWYgKF9m\ncm9tICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfZnJvbS5nZXRUYWJs\nZUluZGV4KHRhYmxlLCBwaiwgZmFsc2UpICE9IC0xOwogICAgICAgIHJldHVy\nbiBnZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgZmFsc2UpICE9IC0xOwogICAg\nfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldFRhYmxlQWxpYXNlcygpIHsK\nICAgICAgICByZXR1cm4gKF90YWJsZXMgPT0gbnVsbCkgPyBDb2xsZWN0aW9u\ncy5FTVBUWV9TRVQgOiBfdGFibGVzLnZhbHVlcygpOwogICAgfQoKICAgIHB1\nYmxpYyBMaXN0IGdldFNlbGVjdHMoKSB7CiAgICAgICAgcmV0dXJuIENvbGxl\nY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QoX3NlbGVjdHMpOwogICAgfQoKICAg\nIHB1YmxpYyBMaXN0IGdldFNlbGVjdEFsaWFzZXMoKSB7CiAgICAgICAgcmV0\ndXJuIF9zZWxlY3RzLmdldEFsaWFzZXMoZmFsc2UsIF9vdXRlciAhPSBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdCBnZXRJZGVudGlmaWVyQWxpYXNl\ncygpIHsKICAgICAgICByZXR1cm4gX3NlbGVjdHMuZ2V0QWxpYXNlcyh0cnVl\nLCBfb3V0ZXIgIT0gbnVsbCk7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciBnZXRPcmRlcmluZygpIHsKICAgICAgICByZXR1cm4gX29yZGVyaW5nOwog\nICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgZ2V0R3JvdXBpbmcoKSB7CiAg\nICAgICAgcmV0dXJuIF9ncm91cGluZzsKICAgIH0KCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIGdldFdoZXJlKCkgewogICAgICAgIHJldHVybiBfd2hlcmU7CiAg\nICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRIYXZpbmcoKSB7CiAgICAg\nICAgcmV0dXJuIF9oYXZpbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZl\nciBnZXRTUUwoKSB7CiAgICAgICAgcmV0dXJuIF9zcWw7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0U1FMKFNRTEJ1ZmZlciBzcWwpIHsKICAgICAgICBf\nc3FsID0gc3FsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFNRTChKREJD\nU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsK\nICAgICAgICBib29sZWFuIGZvclVwZGF0ZSA9IGlzRm9yVXBkYXRlKHN0b3Jl\nLCBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkpOwogICAgICAgIF9zcWwgPSB0\nb1NlbGVjdChmb3JVcGRhdGUsIGZldGNoKTsKICAgIH0KICAgIAogICAgcHVi\nbGljIHZvaWQgYWRkSm9pbkNsYXNzQ29uZGl0aW9ucygpIHsKICAgICAgICBp\nZiAoX2pvaW5zID09IG51bGwgfHwgX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBqb2luIHNldCBpdGVy\nYXRvciBhbGxvd3MgY29uY3VycmVudCBtb2RpZmljYXRpb24KICAgICAgICBK\nb2luIGo7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfam9pbnMuam9p\nbnMoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICBqID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChqLmdl\ndFJlbGF0aW9uVGFyZ2V0KCkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nai5nZXRSZWxhdGlvblRhcmdldCgpLmdldERpc2NyaW1pbmF0b3IoKS5hZGRD\nbGFzc0NvbmRpdGlvbnMKICAgICAgICAgICAgICAgICAgICAodGhpcywgai5n\nZXRTdWJjbGFzc2VzKCkgPT0gU1VCU19KT0lOQUJMRSwgCiAgICAgICAgICAg\nICAgICAgICAgai5nZXRSZWxhdGlvbkpvaW5zKCkpOwogICAgICAgICAgICAg\nICAgai5zZXRSZWxhdGlvbihudWxsLCAwLCBudWxsKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgZ2V0Sm9pbnMo\nKSB7CiAgICAgICAgcmV0dXJuIF9qb2luczsKICAgIH0KCiAgICBwdWJsaWMg\nSXRlcmF0b3IgZ2V0Sm9pbkl0ZXJhdG9yKCkgewogICAgICAgIGlmIChfam9p\nbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gRW1wdHlJdGVyYXRvci5JTlNUQU5DRTsKICAgICAgICByZXR1cm4g\nX2pvaW5zLmpvaW5zKCkuam9pbkl0ZXJhdG9yKCk7CiAgICB9CgogICAgcHVi\nbGljIGxvbmcgZ2V0U3RhcnRJbmRleCgpIHsKICAgICAgICByZXR1cm4gX3N0\nYXJ0SWR4OwogICAgfQoKICAgIHB1YmxpYyBsb25nIGdldEVuZEluZGV4KCkg\newogICAgICAgIHJldHVybiBfZW5kSWR4OwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldFJhbmdlKGxvbmcgc3RhcnQsIGxvbmcgZW5kKSB7CiAgICAgICAg\nX3N0YXJ0SWR4ID0gc3RhcnQ7CiAgICAgICAgX2VuZElkeCA9IGVuZDsKICAg\nIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVtbiBj\nb2wpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCAoSm9p\nbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1u\nQWxpYXMoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICByZXR1\ncm4gZ2V0Q29sdW1uQWxpYXMoY29sLCBnZXRKb2lucyhqb2lucywgZmFsc2Up\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9y\nIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5n\nIGdldENvbHVtbkFsaWFzKENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaikgewog\nICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wuZ2V0TmFtZSgpLCBj\nb2wuZ2V0VGFibGUoKSwgcGopOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFibGUgdGFibGUpIHsKICAg\nICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCB0YWJsZSwgKEpvaW5z\nKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFs\naWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBKb2lucyBqb2lucykgewog\nICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIHRhYmxlLCBnZXRK\nb2lucyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBjb2x1bW4uCiAgICAgKi8K\nICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFsaWFzKFN0cmluZyBjb2ws\nIFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBTdHJpbmcg\ndGFibGVBbGlhcyA9IG51bGw7CiAgICAgICAgaWYgKHBqID09IG51bGwgfHwg\ncGoucGF0aCgpID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKF90YWJsZUFs\naWFzZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF90YWJsZUFsaWFzZXMg\nPSBuZXcgSGFzaE1hcCgpOwogICAgICAgICAgICB0YWJsZUFsaWFzID0gKFN0\ncmluZykgX3RhYmxlQWxpYXNlcy5nZXQodGFibGUpOwogICAgICAgICAgICBp\nZiAodGFibGVBbGlhcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0YWJs\nZUFsaWFzID0gZ2V0VGFibGVBbGlhcyh0YWJsZSwgcGopLnRvU3RyaW5nKCk7\nCiAgICAgICAgICAgICAgICBfdGFibGVBbGlhc2VzLnB1dCh0YWJsZSwgdGFi\nbGVBbGlhcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5l\ndyBTdHJpbmdCdWlsZGVyKHRhYmxlQWxpYXMpLmFwcGVuZChjb2wpLnRvU3Ry\naW5nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBnZXRUYWJsZUFsaWFz\nKHRhYmxlLCBwaikuYXBwZW5kKGNvbCkudG9TdHJpbmcoKTsKICAgIH0KICAg\nIAogICAgcHJpdmF0ZSBTdHJpbmdCdWlsZGVyIGdldFRhYmxlQWxpYXMoVGFi\nbGUgdGFibGUsIFBhdGhKb2lucyBwaikgewogICAgICAgIFN0cmluZ0J1aWxk\nZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBpZiAoX2Zy\nb20gIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSB0b0Fs\naWFzKF9mcm9tLmdldFRhYmxlSW5kZXgodGFibGUsIHBqLCB0cnVlKSk7CiAg\nICAgICAgICAgIGlmIChfZGljdC5yZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQoRlJPTV9TRUxF\nQ1RfQUxJQVMpLmFwcGVuZCgiLiIpLmFwcGVuZChhbGlhcykuCiAgICAgICAg\nICAgICAgICAgICAgYXBwZW5kKCJfIik7CiAgICAgICAgICAgIHJldHVybiBi\ndWYuYXBwZW5kKGFsaWFzKS5hcHBlbmQoIl8iKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGJ1Zi5hcHBlbmQodG9BbGlhcyhnZXRUYWJsZUluZGV4KHRh\nYmxlLCBwaiwgdHJ1ZSkpKS5hcHBlbmQoIi4iKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgpIHsKICAgICAgICByZXR1cm4gKF9m\nbGFncyAmIEFHR1JFR0FURSkgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRBZ2dyZWdhdGUoYm9vbGVhbiBhZ2cpIHsKICAgICAgICBpZiAoYWdn\nKQogICAgICAgICAgICBfZmxhZ3MgfD0gQUdHUkVHQVRFOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5BR0dSRUdBVEU7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gaXNMb2IoKSB7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBMT0IpICE9IDA7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nTG9iKGJvb2xlYW4gbG9iKSB7CiAgICAgICAgaWYgKGxvYikKICAgICAgICAg\nICAgX2ZsYWdzIHw9IExPQjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9m\nbGFncyAmPSB+TE9COwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyU2Vs\nZWN0cygpIHsKICAgICAgICBfc2VsZWN0cy5jbGVhcigpOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIHNlbGVjdChTUUxCdWZmZXIgc3FsLCBPYmplY3Qg\naWQpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNxbCwgaWQsIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTUUxCdWZmZXIgc3Fs\nLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dy\nb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoKE9iamVjdCkg\nc3FsLCBpZCwgam9pbnMpOwogICAgICAgIGdyb3VwQnkoc3FsLCBqb2lucyk7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVjb3JkIHRoZSBzZWxlY3Qgb2YgdGhlIGdpdmVuIFNRTCBidWZmZXIgb3Ig\nc3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc2VsZWN0KE9i\namVjdCBzcWwsIE9iamVjdCBpZCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBn\nZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgYm9vbGVhbiBjb250YWlu\nczsKICAgICAgICBpZiAoaWQgPT0gbnVsbCkgewogICAgICAgICAgICBpbnQg\naWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFzKHNxbCk7CiAgICAgICAgICAg\nIGNvbnRhaW5zID0gaWR4ICE9IC0xOwogICAgICAgICAgICBpZiAoY29udGFp\nbnMpCiAgICAgICAgICAgICAgICBpZCA9IF9zZWxlY3RzLmdldChpZHgpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZCA9IG51bGxJZCgp\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBjb250YWlucyA9IF9zZWxl\nY3RzLmNvbnRhaW5zKGlkKTsKCiAgICAgICAgaWYgKGNvbnRhaW5zKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgX3NlbGVjdHMuc2V0QWxp\nYXMoaWQsIHNxbCwgZmFsc2UpOwogICAgICAgIHJldHVybiB0cnVlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHVuaXF1ZSBpZCBmb3IgYSBT\nUUwgc3RyaW5nIHdob3NlIGdpdmVuIGlkIGlzIG51bGwuCiAgICAgKi8KICAg\nIHByaXZhdGUgT2JqZWN0IG51bGxJZCgpIHsKICAgICAgICBpZiAoX251bGxJ\nZHMgPj0gTlVMTF9JRFMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gbmV3\nIE51bGxJZCgpOwogICAgICAgIHJldHVybiBOVUxMX0lEU1tfbnVsbElkcysr\nXTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU3RyaW5nIHNx\nbCwgT2JqZWN0IGlkKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdChzcWwsIGlk\nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoU3Ry\naW5nIHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lucykgewogICAgICAgIGlm\nICghaXNHcm91cGluZygpKQogICAgICAgICAgICByZXR1cm4gc2VsZWN0KChP\nYmplY3QpIHNxbCwgaWQsIGpvaW5zKTsKICAgICAgICBncm91cEJ5KHNxbCwg\nam9pbnMpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNlbGVjdFBsYWNlaG9sZGVyKFN0cmluZyBzcWwpIHsKICAgICAg\nICBPYmplY3QgaG9sZGVyID0gKF9wbGFjZWhvbGRlcnMgPj0gUExBQ0VIT0xE\nRVJTLmxlbmd0aCkKICAgICAgICAgICAgPyBuZXcgUGxhY2Vob2xkZXIoKSA6\nIFBMQUNFSE9MREVSU1tfcGxhY2Vob2xkZXJzKytdOwogICAgICAgIHNlbGVj\ndChzcWwsIGhvbGRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnNlcnQg\nYSBwbGFjZWhvbGRlciBhdCB0aGUgZ2l2ZW4gaW5kZXg7IHVzZSBhIG5lZ2F0\naXZlIGluZGV4CiAgICAgKiB0byBjb3VudCBmcm9tIHRoZSBiYWNrIG9mIHRo\nZSBzZWxlY3QgbGlzdC4KICAgICAqLwogICAgcHVibGljIHZvaWQgaW5zZXJ0\nUGxhY2Vob2xkZXIoU3RyaW5nIHNxbCwgaW50IHBvcykgewogICAgICAgIE9i\namVjdCBob2xkZXIgPSAoX3BsYWNlaG9sZGVycyA+PSBQTEFDRUhPTERFUlMu\nbGVuZ3RoKQogICAgICAgICAgICA/IG5ldyBQbGFjZWhvbGRlcigpIDogUExB\nQ0VIT0xERVJTW19wbGFjZWhvbGRlcnMrK107CiAgICAgICAgX3NlbGVjdHMu\naW5zZXJ0QWxpYXMocG9zLCBob2xkZXIsIHNxbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDbGVhciBzZWxlY3RlZCBwbGFjZWhvbGRlcnMsIGFuZCByZXR1\ncm4gcmVtb3ZlZCBzZWxlY3QgaW5kZXhlcy4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgY2xlYXJQbGFjZWhvbGRlclNlbGVjdHMoKSB7CiAgICAgICAgX3Nl\nbGVjdHMuY2xlYXJQbGFjZWhvbGRlcnMoKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBz\nZWxlY3QoY29sLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIHNlbGVjdChDb2x1bW4gY29sLCBKb2lucyBqb2lucykgewogICAg\nICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICByZXR1cm4gc2Vs\nZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUpLCBmYWxzZSk7CiAgICAg\nICAgZ3JvdXBCeShjb2wsIGpvaW5zKTsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoQ29sdW1uW10gY29scykg\newogICAgICAgIHJldHVybiBzZWxlY3QoY29scywgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIGludCBzZWxlY3QoQ29sdW1uW10gY29scywgSm9pbnMgam9p\nbnMpIHsKICAgICAgICBpZiAoY29scyA9PSBudWxsIHx8IGNvbHMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChpc0dy\nb3VwaW5nKCkpIHsKICAgICAgICAgICAgZ3JvdXBCeShjb2xzLCBqb2lucyk7\nCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBQYXRo\nSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgaW50\nIHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHNlbGVjdChjb2xzW2ldLCBw\naiwgZmFsc2UpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7CiAg\nICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxl\nY3QgdGhlIGdpdmVuIGNvbHVtbiBhZnRlciBtYWtpbmcgdGhlIGdpdmVuIGpv\naW5zLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gc2VsZWN0KENvbHVt\nbiBjb2wsIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBpZGVudCkgewogICAgICAg\nIC8vIHdlIGNhY2hlIG9uIGNvbHVtbiBvYmplY3QgaWYgdGhlcmUgYXJlIG5v\nIGpvaW5zIHNvIHRoYXQgd2hlbgogICAgICAgIC8vIGxvb2tpbmcgdXAgY29s\ndW1ucyBpbiB0aGUgcmVzdWx0IHdlIGRvbid0IGhhdmUgdG8gY3JlYXRlIGEg\nc3RyaW5nCiAgICAgICAgLy8gYnVmZmVyIGZvciB0aGUgdGFibGUgKyBjb2x1\nbW4gYWxpYXM7IGlmIHRoZXJlIGFyZSBqb2lucywgdGhlbgogICAgICAgIC8v\nIHdlIGtleSBvbiB0aGUgYWxpYXMKICAgICAgICBTdHJpbmcgYWxpYXMgPSBn\nZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAgICBPYmplY3QgaWQ7CiAg\nICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09IG51bGwpCiAg\nICAgICAgICAgIGlkID0gY29sOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\naWQgPSBhbGlhczsKICAgICAgICBpZiAoX3NlbGVjdHMuY29udGFpbnMoaWQp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChjb2wu\nZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IgfHwgY29sLmdldFR5cGUoKSA9PSBU\neXBlcy5DTE9CKQogICAgICAgICAgICBzZXRMb2IodHJ1ZSk7CiAgICAgICAg\nX3NlbGVjdHMuc2V0QWxpYXMoaWQsIGFsaWFzLCBpZGVudCk7CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0KENs\nYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xhc3NlcywKICAgICAgICBK\nREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gs\nIGludCBlYWdlcikgewogICAgICAgIHNlbGVjdChtYXBwaW5nLCBzdWJjbGFz\nc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBz\ndWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5z\nIGpvaW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMsIG1hcHBpbmcsIHN1YmNs\nYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpvaW5zLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVuIG1hcHBpbmcu\nCiAgICAgKi8KICAgIHZvaWQgc2VsZWN0KFNlbGVjdCB3cmFwcGVyLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAgICAgICAgSkRC\nQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBp\nbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMsIGJvb2xlYW4gaWRlbnQp\nIHsKICAgICAgICAvLyBub3RlIHRoYXQgdGhpcyBpcyBvbmUgY2FzZSB3aGVy\nZSB3ZSBkb24ndCB3YW50IHRvIHVzZSB0aGUgcmVzdWx0CiAgICAgICAgLy8g\nb2YgZ2V0Sm9pbnMoKTsganVzdCB1c2UgdGhlIGdpdmVuIGpvaW5zLCB3aGlj\naCB3aWxsIGVpdGhlciBiZSBjbGVhbgogICAgICAgIC8vIG9yIHRoZSByZXN1\nbHQgb2YgcHJldmlvdXMgcHJlLWpvaW5zLiB0aGlzIHdheSB3ZSBkb24ndCBw\ndXNoIGV4dHJhCiAgICAgICAgLy8gc3RhY2sgc3R1ZmYgd2hlbiBubyBhY3R1\nYWwgbmV3IGpvaW5zIGhhdmUgYmVlbiBtYWRlLCBhbmQgd2UgZG9uJ3QKICAg\nICAgICAvLyB0aGluayB0aGUgdXNlciB3YW50cyBvdXRlciBqb2lucyB3aGVu\nIGFjdHVhbGx5IG9ubHkgdGhlIHByZXZpb3VzCiAgICAgICAgLy8gam9pbnMg\nd2VyZSBvdXRlci4gIHdlIGRvIGludm9rZSBnZXRKb2lucygpLCB0aG91Z2gs\nIHRvIGFkZCB0aGVzZQogICAgICAgIC8vIGpvaW5zIChpZiBhbnkpIHRvIG91\nciB0b3AtbGV2ZWwgam9pbnM7IG90aGVyd2lzZSBpdCdkIGJlIHBvc3NpYmxl\nCiAgICAgICAgLy8gZm9yIHRoZSB1c2VyIHRvIGltbWVkaWF0ZWx5IGRvIGFu\nb3RoZXIgam9pbiBhbmQgc2VsZWN0IHNvbWV0aGluZywKICAgICAgICAvLyBh\nbmQgaWYgd2UncmUgaW4gb3V0ZXIgbW9kZSBhbGwgdGhlc2Ugam9pbnMgd2ls\nbCBnZXQgc3dpdGNoZWQgdG8gb3V0ZXIKICAgICAgICAvLyBqb2lucy4gIGNh\nY2hpbmcgdGhlbSBhcyB0aGVpciBvcmlnaW5hbCBqb2luIHR5cGUgcHJldmVu\ndHMgdGhhdAogICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKCiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9pbnM7CiAgICAgICAg\nYm9vbGVhbiBoYXNKb2lucyA9IHBqICE9IG51bGwgJiYgcGouaXNEaXJ0eSgp\nOwogICAgICAgIGlmIChoYXNKb2lucykgewogICAgICAgICAgICBpZiAoX3By\nZUpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBfcHJlSm9pbnMgPSBu\nZXcgU3RhY2soKTsKICAgICAgICAgICAgX3ByZUpvaW5zLnB1c2gocGopOwog\nICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhleSBhcmUgc2VsZWN0aW5nIHRo\naXMgbWFwcGluZyB3aXRoIG91dGVyIGpvaW5zLCB0aGVuIGFsbCBqb2lucwog\nICAgICAgIC8vIGZyb20gdGhpcyBtYXBwaW5nIHNob3VsZCBhbHNvIGJlIG91\ndGVyCiAgICAgICAgYm9vbGVhbiB3YXNPdXRlciA9IChfZmxhZ3MgJiBPVVRF\nUikgIT0gMDsKICAgICAgICBpZiAoaGFzSm9pbnMgJiYgIXdhc091dGVyICYm\nIHBqLmlzT3V0ZXIoKSkKICAgICAgICAgICAgX2ZsYWdzIHw9IE9VVEVSOwoK\nICAgICAgICAvLyBkZWxlZ2F0ZSB0byBzdG9yZSBtYW5hZ2VyIHRvIHNlbGVj\ndCBpbiBzYW1lIG9yZGVyIGl0IGxvYWRzIHJlc3VsdAogICAgICAgICgoSkRC\nQ1N0b3JlTWFuYWdlcikgc3RvcmUpLnNlbGVjdCh3cmFwcGVyLCBtYXBwaW5n\nLCBzdWJjbGFzc2VzLCBudWxsLAogICAgICAgICAgICBudWxsLCBmZXRjaCwg\nZWFnZXIsIGlkZW50LCAoX2ZsYWdzICYgT1VURVIpICE9IDApOwoKICAgICAg\nICAvLyByZXNldAogICAgICAgIGlmIChoYXNKb2lucykKICAgICAgICAgICAg\nX3ByZUpvaW5zLnBvcCgpOwogICAgICAgIGlmICghd2FzT3V0ZXIgJiYgKF9m\nbGFncyAmIE9VVEVSKSAhPSAwKQogICAgICAgICAgICBfZmxhZ3MgJj0gfk9V\nVEVSOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdElkZW50aWZp\nZXIoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBzZWxlY3RJZGVudGlm\naWVyKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBzZWxlY3RJZGVudGlmaWVyKENvbHVtbiBjb2wsIEpvaW5zIGpvaW5z\nKSB7CiAgICAgICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJl\ndHVybiBzZWxlY3QoY29sLCBnZXRKb2lucyhqb2lucywgdHJ1ZSksIHRydWUp\nOwogICAgICAgIGdyb3VwQnkoY29sLCBqb2lucyk7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2VsZWN0SWRlbnRpZmll\ncihDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAgcmV0dXJuIHNlbGVjdElkZW50\naWZpZXIoY29scywgbnVsbCk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxl\nY3RJZGVudGlmaWVyKENvbHVtbltdIGNvbHMsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiAoaXNHcm91cGluZygp\nKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywgam9pbnMpOwogICAgICAg\nICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgUGF0aEpvaW5zIHBq\nID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAgICAgIGludCBzZWxkID0g\nMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29sc1tpXSwgcGosIHRydWUp\nKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0\ndXJuIHNlbGQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2VsZWN0SWRlbnRp\nZmllcihDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNzZXMsCiAg\nICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLCBpbnQgZWFnZXIpIHsKICAgICAgICBzZWxlY3RJZGVudGlmaWVy\nKG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIG51\nbGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdElkZW50aWZpZXIo\nQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAg\nIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAg\nc2VsZWN0KHRoaXMsIG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRj\naCwgZWFnZXIsIGpvaW5zLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgaW50\nIHNlbGVjdFByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcpIHsKICAg\nICAgICByZXR1cm4gc2VsZWN0UHJpbWFyeUtleShtYXBwaW5nLCBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdFByaW1hcnlLZXkoQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgcmV0dXJu\nIHByaW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywgdHJ1ZSwgbnVsbCwgam9p\nbnMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE9wZXJhdGUgb24g\ncHJpbWFyeSBrZXkgZGF0YS4gUmV0dXJuIGEgYml0IG1hc2sgb2Ygc2VsZWN0\nZWQgY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBpbnQgcHJpbWFyeUtl\neU9wZXJhdGlvbihDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBzZWws\nCiAgICAgICAgQm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIGFs\naWFzT3JkZXIpIHsKICAgICAgICBpZiAoIXNlbCAmJiBhc2MgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIC8vIGlmIHRoaXMgbWFw\ncGluZyBjYW4ndCBzZWxlY3QgdGhlIGZ1bGwgcGsgdmFsdWVzLCB0aGVuIGpv\naW4gdG8KICAgICAgICAvLyBzdXBlciBhbmQgcmVjdXJzZQogICAgICAgIENs\nYXNzTWFwcGluZyBzdXA7CiAgICAgICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFy\neUtleU9iamVjdElkKHRydWUpKSB7CiAgICAgICAgICAgIHN1cCA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\nICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgam9pbnMg\nPSBuZXdKb2lucygpOwogICAgICAgICAgICBqb2lucyA9IG1hcHBpbmcuam9p\nblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJu\nIHByaW1hcnlLZXlPcGVyYXRpb24oc3VwLCBzZWwsIGFzYywgam9pbnMsIGFs\naWFzT3JkZXIpOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9\nIG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICBpZiAo\naXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywgam9p\nbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAg\nIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCBmYWxzZSk7CiAgICAg\nICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbHVtbk9wZXJh\ndGlvbihjb2xzW2ldLCBzZWwsIGFzYywgcGosIGFsaWFzT3JkZXIpKQogICAg\nICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7CgogICAgICAgIC8vIGlmIHRo\naXMgbWFwcGluZyBoYXMgbm90IGJlZW4gdXNlZCBpbiB0aGUgc2VsZWN0IHll\ndCAoYW5kIHRoZXJlZm9yZQogICAgICAgIC8vIGlzIG5vdCBqb2luZWQgdG8g\nYW55dGhpbmcpLCBidXQgaGFzIGFuIG90aGVyLXRhYmxlIHN1cGVyY2xhc3Mg\ndGhhdAogICAgICAgIC8vIGhhcyBiZWVuIHVzZWQsIG1ha2Ugc3VyZSB0byBq\nb2luIHRvIGl0CiAgICAgICAgYm9vbGVhbiBqb2luZWQgPSBmYWxzZTsKICAg\nICAgICBmb3IgKHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7IHN1cCAhPSBudWxsOwogICAgICAgICAgICBtYXBwaW5n\nID0gc3VwLCBzdXAgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNz\nTWFwcGluZygpKSB7CiAgICAgICAgICAgIGlmIChzdXAuZ2V0VGFibGUoKSA9\nPSBtYXBwaW5nLmdldFRhYmxlKCkpCiAgICAgICAgICAgICAgICBjb250aW51\nZTsKCiAgICAgICAgICAgIGlmIChtYXBwaW5nLmdldFRhYmxlKCkgIT0gc3Vw\nLmdldFRhYmxlKCkKICAgICAgICAgICAgICAgICYmIGdldFRhYmxlSW5kZXgo\nbWFwcGluZy5nZXRUYWJsZSgpLCBwaiwgZmFsc2UpID09IC0xCiAgICAgICAg\nICAgICAgICAmJiBnZXRUYWJsZUluZGV4KHN1cC5nZXRUYWJsZSgpLCBwaiwg\nZmFsc2UpICE9IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAocGogPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBwaiA9IChQYXRoSm9pbnMpIG5ld0pv\naW5zKCk7CiAgICAgICAgICAgICAgICBwaiA9IChQYXRoSm9pbnMpIG1hcHBp\nbmcuam9pblN1cGVyY2xhc3MocGosIGZhbHNlKTsKICAgICAgICAgICAgICAg\nIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChqb2luZWQpCiAg\nICAgICAgICAgIHdoZXJlKHBqKTsKCiAgICAgICAgcmV0dXJuIHNlbGQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGFuIG9wZXJhdGlvbiBvbiBh\nIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGNvbHVtbk9w\nZXJhdGlvbihDb2x1bW4gY29sLCBib29sZWFuIHNlbCwgQm9vbGVhbiBhc2Ms\nCiAgICAgICAgUGF0aEpvaW5zIHBqLCBib29sZWFuIGFsaWFzT3JkZXIpIHsK\nICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAgICAgIGlmIChhc2MgIT0g\nbnVsbCAmJiAoYWxpYXNPcmRlciB8fCAoX2ZsYWdzICYgUkVDT1JEX09SREVS\nRUQpICE9IDApKSB7CiAgICAgICAgICAgIE9iamVjdCBpZDsKICAgICAgICAg\nICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICBpZCA9IGNvbDsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgaWQgPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAg\nICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JERVJFRCkgIT0gMCkgewog\nICAgICAgICAgICAgICAgaWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgX29yZGVyZWQgPSBuZXcgQXJyYXlMaXN0KDUpOwogICAg\nICAgICAgICAgICAgX29yZGVyZWQuYWRkKGlkKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAoYWxpYXNPcmRlcikgewogICAgICAgICAgICAgICAg\nYXMgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsKICAgICAgICAgICAgICAg\nIF9zZWxlY3RzLnNldFNlbGVjdEFzKGlkLCBhcyk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gc2VsZCA9IHNlbCAmJiBzZWxl\nY3QoY29sLCBwaiwgZmFsc2UpOwogICAgICAgIGlmIChhc2MgIT0gbnVsbCkg\newogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSAoYXMgIT0gbnVsbCkgPyBh\ncyA6IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwogICAgICAgICAgICBhcHBl\nbmRPcmRlcmluZyhhbGlhcywgYXNjLmJvb2xlYW5WYWx1ZSgpKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBcHBlbmQgb3JkZXJpbmcgaW5mb3JtYXRpb24gdG8gb3VyIGludGVybmFs\nIGJ1ZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFwcGVuZE9yZGVy\naW5nKE9iamVjdCBvcmRlckJ5LCBib29sZWFuIGFzYykgewogICAgICAgIGlm\nIChfb3JkZXJpbmcgPT0gbnVsbCkKICAgICAgICAgICAgX29yZGVyaW5nID0g\nbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfb3JkZXJpbmcuYXBwZW5kKCIsICIpOwoKICAgICAgICBpZiAob3JkZXJC\neSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgX29yZGVyaW5n\nLmFwcGVuZCgoU1FMQnVmZmVyKSBvcmRlckJ5KTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoKFN0cmluZykgb3JkZXJCeSk7\nCiAgICAgICAgaWYgKGFzYykKICAgICAgICAgICAgX29yZGVyaW5nLmFwcGVu\nZCgiIEFTQyIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX29yZGVyaW5n\nLmFwcGVuZCgiIERFU0MiKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IG9yZGVy\nQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBib29sZWFuIGFz\nYywKICAgICAgICBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRl\nckJ5UHJpbWFyeUtleShtYXBwaW5nLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9\nCgogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFyeUtleShDbGFzc01hcHBp\nbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAgICAgSm9pbnMgam9pbnMs\nIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnlQcmltYXJ5\nS2V5KG1hcHBpbmcsIGFzYywgam9pbnMsIHNlbCwgZmFsc2UpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlhc2VzIG9u\nIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgb3JkZXJC\neVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGJvb2xlYW4gYXNj\nLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwgYm9vbGVhbiBh\nbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRp\nb24obWFwcGluZywgc2VsLAogICAgICAgICAgICAoYXNjKSA/IEJvb2xlYW4u\nVFJVRSA6IEJvb2xlYW4uRkFMU0UsIGpvaW5zLCBhbGlhc09yZGVyKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KENvbHVtbiBjb2wsIGJv\nb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRl\nckJ5KGNvbCwgYXNjLCBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9vbGVhbiBhc2MsIEpvaW5z\nIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5\nKGNvbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIg\nY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBvcmRlckJ5KENvbHVtbiBj\nb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsCiAg\nICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIGNv\nbHVtbk9wZXJhdGlvbihjb2wsIHNlbCwgKGFzYykgPyBCb29sZWFuLlRSVUUg\nOiBCb29sZWFuLkZBTFNFLAogICAgICAgICAgICBnZXRKb2lucyhqb2lucywg\ndHJ1ZSksIGFsaWFzT3JkZXIpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgb3Jk\nZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwp\nIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xzLCBhc2MsIG51bGwsIHNl\nbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5KENvbHVtbltdIGNv\nbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsK\nICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xzLCBhc2MsIGpvaW5zLCBzZWws\nIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0\nbyBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5zLgogICAgICovCiAgICBp\nbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFzYywgSm9pbnMg\nam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRl\ncikgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zLCB0\ncnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAo\nY29sdW1uT3BlcmF0aW9uKGNvbHNbaV0sIHNlbCwKICAgICAgICAgICAgICAg\nIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRSwgcGosIGFs\naWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7CiAg\nICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFuIGFzYywgYm9vbGVhbiBz\nZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgKEpvaW5z\nKSBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVy\nQnkoU1FMQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLAog\nICAgICAgIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyQnko\nc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBj\nb2x1bW5zLgogICAgICovCiAgICBib29sZWFuIG9yZGVyQnkoU1FMQnVmZmVy\nIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCwK\nICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICByZXR1cm4g\nb3JkZXJCeSgoT2JqZWN0KSBzcWwsIGFzYywgam9pbnMsIHNlbCwgYWxpYXNP\ncmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcmRlciBvbiBhIFNRTCBi\ndWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\nb3JkZXJCeShPYmplY3Qgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMs\nIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewog\nICAgICAgIE9iamVjdCBvcmRlciA9IHNxbDsKICAgICAgICBpZiAoYWxpYXNP\ncmRlcikgewogICAgICAgICAgICBvcmRlciA9IHRvT3JkZXJBbGlhcyhfb3Jk\nZXJzKyspOwogICAgICAgICAgICBfc2VsZWN0cy5zZXRTZWxlY3RBcyhzcWws\nIChTdHJpbmcpIG9yZGVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKChfZmxh\nZ3MgJiBSRUNPUkRfT1JERVJFRCkgIT0gMCkgewogICAgICAgICAgICBpZiAo\nX29yZGVyZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9vcmRlcmVkID0g\nbmV3IEFycmF5TGlzdCg1KTsKICAgICAgICAgICAgX29yZGVyZWQuYWRkKHNx\nbCk7CiAgICAgICAgfQoKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7\nCiAgICAgICAgYXBwZW5kT3JkZXJpbmcob3JkZXIsIGFzYyk7CiAgICAgICAg\naWYgKHNlbCkgewogICAgICAgICAgICBpbnQgaWR4ID0gX3NlbGVjdHMuaW5k\nZXhPZkFsaWFzKHNxbCk7CiAgICAgICAgICAgIGlmIChpZHggPT0gLTEpIHsK\nICAgICAgICAgICAgICAgIF9zZWxlY3RzLnNldEFsaWFzKG51bGxJZCgpLCBz\ncWwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJv\nb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRl\nckJ5KHNxbCwgYXNjLCBudWxsLCBzZWwpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIG9yZGVyQnkoU3RyaW5nIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5z\nIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAgIHJldHVybiBvcmRlckJ5\nKHNxbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFsaWFzZXMgb24gb3JkZXIg\nY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBz\ncWwsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwsCiAg\nICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIG9y\nZGVyQnkoKE9iamVjdCkgc3FsLCBhc2MsIGpvaW5zLCBzZWwsIGFsaWFzT3Jk\nZXIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyT3JkZXJpbmcoKSB7\nCiAgICAgICAgX29yZGVyaW5nID0gbnVsbDsKICAgICAgICBfb3JkZXJzID0g\nMDsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHVuaW9ucyB0byByZWNv\ncmQgdGhlIHNlbGVjdCBsaXN0IGluZGV4ZXMgb2YgaXRlbXMgd2Ugb3JkZXIg\nYnkuCiAgICAgKi8KICAgIHZvaWQgc2V0UmVjb3JkT3JkZXJlZEluZGV4ZXMo\nYm9vbGVhbiByZWNvcmQpIHsKICAgICAgICBpZiAocmVjb3JkKQogICAgICAg\nICAgICBfZmxhZ3MgfD0gUkVDT1JEX09SREVSRUQ7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIF9vcmRlcmVkID0gbnVsbDsKICAgICAgICAgICAgX2Zs\nYWdzICY9IH5SRUNPUkRfT1JERVJFRDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIGluZGV4ZXMgaW4gdGhlIHNlbGVjdCBs\naXN0IG9mIGFsbCBpdGVtcyB3ZSdyZSBvcmRlcmluZwogICAgICogYnksIG9y\nIG51bGwgaWYgbm9uZS4gRm9yIHVzZSB3aXRoIHVuaW9ucy4KICAgICAqLwog\nICAgTGlzdCBnZXRPcmRlcmVkSW5kZXhlcygpIHsKICAgICAgICBpZiAoX29y\nZGVyZWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgTGlzdCBpZHhzID0gbmV3IEFycmF5TGlzdChfb3JkZXJlZC5zaXplKCkp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgX29yZGVyZWQuc2l6ZSgp\nOyBpKyspCiAgICAgICAgICAgIGlkeHMuYWRkKE51bWJlcnMudmFsdWVPZihf\nc2VsZWN0cy5pbmRleE9mKF9vcmRlcmVkLmdldChpKSkpKTsKICAgICAgICBy\nZXR1cm4gaWR4czsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZVByaW1h\ncnlLZXkoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAg\nICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgd2hlcmVQcmltYXJ5S2V5\nKG9pZCwgbWFwcGluZywgbnVsbCwgc3RvcmUpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHdoZXJlIGNvbmRpdGlvbnMgc2V0dGluZyB0aGUgbWFwcGlu\nZydzIHByaW1hcnkga2V5IHRvIHRoZSBnaXZlbgogICAgICogb2lkIHZhbHVl\ncy4gSWYgdGhlIGdpdmVuIG1hcHBpbmcgZG9lcyBub3QgdXNlIG9pZCB2YWx1\nZXMgZm9yIGl0cwogICAgICogcHJpbWFyeSBrZXksIHdlIHdpbGwgcmVjdXJz\naXZlbHkgam9pbiB0byBpdHMgc3VwZXJjbGFzcyB1bnRpbCB3ZSBmaW5kCiAg\nICAgKiBhbiBhbmNlc3RvciB0aGF0IGRvZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB3aGVyZVByaW1hcnlLZXkoT2JqZWN0IG9pZCwgQ2xhc3NNYXBw\naW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSkgewogICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZydzIGlkZW50aWZp\nZXJzIGluY2x1ZGUgc29tZXRoaW5nIG90aGVyIHRoYW4KICAgICAgICAvLyB0\naGUgcGsgdmFsdWVzLCBqb2luIHRvIHN1cGVyIGFuZCByZWN1cnNlCiAgICAg\nICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKGZhbHNlKSkg\newogICAgICAgICAgICBDbGFzc01hcHBpbmcgc3VwID0gbWFwcGluZy5nZXRK\nb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAgICAgICAgICAgaWYg\nKGpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAgICBqb2lucyA9IG5ld0pv\naW5zKCk7CiAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2luU3VwZXJj\nbGFzcyhqb2lucywgZmFsc2UpOwogICAgICAgICAgICB3aGVyZVByaW1hcnlL\nZXkob2lkLCBzdXAsIGpvaW5zLCBzdG9yZSk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIENvbHVtbltdIGNvbHMgPSBtYXBwaW5n\nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAgICAgICAgd2hlcmUob2lkLCBt\nYXBwaW5nLCBjb2xzLCBjb2xzLCBudWxsLCBudWxsLCBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSksCiAgICAgICAgICAgIHN0b3JlKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCB3aGVyZUZvcmVpZ25LZXkoRm9yZWlnbktleSBmaywgT2JqZWN0\nIG9pZCwKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZywgSkRCQ1N0b3Jl\nIHN0b3JlKSB7CiAgICAgICAgd2hlcmVGb3JlaWduS2V5KGZrLCBvaWQsIG1h\ncHBpbmcsIG51bGwsIHN0b3JlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB3aGVyZSBjb25kaXRpb25zIHNldHRpbmcgdGhlIGdpdmVuIGZvcmVpZ24g\na2V5IHRvIHRoZSBnaXZlbgogICAgICogb2lkIHZhbHVlcy4KICAgICAqCiAg\nICAgKiBAc2VlICN3aGVyZVByaW1hcnlLZXkKICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBPYmplY3Qg\nb2lkLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKb2lucyBqb2lu\ncywgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBw\naW5nJ3MgaWRlbnRpZmllcnMgaW5jbHVkZSBzb21ldGhpbmcgb3RoZXIgdGhh\nbgogICAgICAgIC8vIHRoZSBwayB2YWx1ZXMsIG9yIGlmIHRoaXMgZm9yZWln\nbiBrZXkgZG9lc24ndCBsaW5rIHRvIG9ubHkKICAgICAgICAvLyBpZGVudGlm\naWVycywgam9pbiB0byB0YWJsZSBhbmQgZG8gYSBnZXRQcmltYXJ5S2V5CiAg\nICAgICAgaWYgKCFtYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKGZhbHNl\nKSB8fCAhY29udGFpbnNBbGwKICAgICAgICAgICAgKG1hcHBpbmcuZ2V0UHJp\nbWFyeUtleUNvbHVtbnMoKSwgZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSkp\nIHsKICAgICAgICAgICAgaWYgKGpvaW5zID09IG51bGwpCiAgICAgICAgICAg\nICAgICBqb2lucyA9IG5ld0pvaW5zKCk7CiAgICAgICAgICAgIC8vIHRyYXZl\ncnNlIHRvIGZvcmVpZ24ga2V5IHRhcmdldCBtYXBwaW5nCiAgICAgICAgICAg\nIHdoaWxlIChtYXBwaW5nLmdldFRhYmxlKCkgIT0gZmsuZ2V0UHJpbWFyeUtl\neVRhYmxlKCkpIHsKICAgICAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAg\nICAgICAgICAgICAgIGpvaW5zID0gbWFwcGluZy5qb2luU3VwZXJjbGFzcyhq\nb2lucywgZmFsc2UpOwogICAgICAgICAgICAgICAgbWFwcGluZyA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAg\nICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGpvaW5zID0gam9pbnMuam9pbihmaywgZmFsc2Us\nIGZhbHNlKTsKICAgICAgICAgICAgd2hlcmVQcmltYXJ5S2V5KG9pZCwgbWFw\ncGluZywgam9pbnMsIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgQ29sdW1uW10gZnJvbUNvbHMgPSBmay5nZXRDb2x1\nbW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG9Db2xzID0gZmsuZ2V0UHJpbWFy\neUtleUNvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSBjb25zdENvbHMgPSBm\nay5nZXRDb25zdGFudENvbHVtbnMoKTsKICAgICAgICBPYmplY3RbXSBjb25z\ndHMgPSBmay5nZXRDb25zdGFudHMoKTsKICAgICAgICB3aGVyZShvaWQsIG1h\ncHBpbmcsIHRvQ29scywgZnJvbUNvbHMsIGNvbnN0cywgY29uc3RDb2xzLAog\nICAgICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSksIHN0b3JlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIG1ldGhvZCB0byBmbHVzaCB0\naGUgb2lkIHZhbHVlcyBhcyB3aGVyZSBjb25kaXRpb25zIHRvIHRoZQogICAg\nICogZ2l2ZW4gY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdo\nZXJlKE9iamVjdCBvaWQsIENsYXNzTWFwcGluZyBtYXBwaW5nLCBDb2x1bW5b\nXSB0b0NvbHMsCiAgICAgICAgQ29sdW1uW10gZnJvbUNvbHMsIE9iamVjdFtd\nIHZhbHMsIENvbHVtbltdIGNvbnN0Q29scywgUGF0aEpvaW5zIHBqLAogICAg\nICAgIEpEQkNTdG9yZSBzdG9yZSkgewogICAgICAgIFZhbHVlTWFwcGluZyBl\nbWJlZCA9IG1hcHBpbmcuZ2V0RW1iZWRkaW5nTWFwcGluZygpOwogICAgICAg\nIGlmIChlbWJlZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHdoZXJlKG9pZCwg\nZW1iZWQuZ2V0RmllbGRNYXBwaW5nKCkuZ2V0RGVmaW5pbmdNYXBwaW5nKCks\nCiAgICAgICAgICAgICAgICB0b0NvbHMsIGZyb21Db2xzLCB2YWxzLCBjb25z\ndENvbHMsIHBqLCBzdG9yZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcgU1FMQnVmZmVyKF9k\naWN0KTsKCiAgICAgICAgLy8gb25seSBib3RoZXIgdG8gcGFjayBwayB2YWx1\nZXMgaW50byBhcnJheSBpZiBhcHAgaWQgICAgICAgIAogICAgICAgIGludCBj\nb3VudCA9IHdoZXJlUHJpbWFyeUtleShtYXBwaW5nLCB0b0NvbHMsIGZyb21D\nb2xzLCBvaWQsIHN0b3JlLCBwaiwgCiAgICAgICAgCWJ1ZiwgbnVsbCk7CiAg\nICAgICAgICAgIAkKICAgICAgICBpZiAoY29uc3RDb2xzICE9IG51bGwgJiYg\nY29uc3RDb2xzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb25zdENvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsK\nICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAgICAgICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoZ2V0Q29sdW1uQWxpYXMoY29uc3RDb2xzW2ldLCBwaikpOwoK\nICAgICAgICAgICAgICAgIGlmICh2YWxzW2ldID09IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCgiIElTICIpOwogICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIp\nOwogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKHZhbHNbaV0sIGNv\nbnN0Q29sc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIHdoZXJlKGJ1ZiwgcGopOwogICAgfQoKICAgIHB1YmxpYyBpbnQgd2hlcmVQ\ncmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nLCBDb2x1bW5bXSB0b0Nv\nbHMsIAogICAgCUNvbHVtbltdIGZyb21Db2xzLCBPYmplY3Qgb2lkLCBKREJD\nU3RvcmUgc3RvcmUsIFBhdGhKb2lucyBwaiwKICAgIAlTUUxCdWZmZXIgYnVm\nLCBMaXN0IHBhcm1MaXN0KSB7CiAgICAgICAgLy8gb25seSBib3RoZXIgdG8g\ncGFjayBwayB2YWx1ZXMgaW50byBhcnJheSBpZiBhcHAgaWQKICAgIAlib29s\nZWFuIGNvbGxlY3RQYXJtVmFsdWVPbmx5ID0gKHBhcm1MaXN0ICE9IG51bGwg\nPyB0cnVlIDogZmFsc2UpOwogICAgICAgIE9iamVjdFtdIHBrcyA9IG51bGw7\nCiAgICAgICAgaWYgKG1hcHBpbmcuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xh\nc3NNYXBwaW5nLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICBwa3MgPSBB\ncHBsaWNhdGlvbklkcy50b1BLVmFsdWVzKG9pZCwgbWFwcGluZyk7CgogICAg\nICAgIEpvaW5hYmxlIGpvaW47CiAgICAgICAgT2JqZWN0IHZhbDsKICAgICAg\nICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\ndG9Db2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlm\nIChwa3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHZhbCA9IChvaWQgPT0g\nbnVsbCkgPyBudWxsIDogTnVtYmVycy52YWx1ZU9mKCgoSWQpIG9pZCkuZ2V0\nSWQoKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8g\nbXVzdCBiZSBhcHAgaWRlbnRpdHk7IHVzZSBwayBpbmRleCB0byBnZXQgY29y\ncmVjdCBwayB2YWx1ZQogICAgICAgICAgICAgICAgam9pbiA9IG1hcHBpbmcu\nYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ldKTsKICAgICAgICAgICAgICAgIHZh\nbCA9IHBrc1ttYXBwaW5nLmdldEZpZWxkKGpvaW4uZ2V0RmllbGRJbmRleCgp\nKS4KICAgICAgICAgICAgICAgICAgICBnZXRQcmltYXJ5S2V5SW5kZXgoKV07\nCiAgICAgICAgICAgICAgICB2YWwgPSBqb2luLmdldEpvaW5WYWx1ZSh2YWws\nIHRvQ29sc1tpXSwgc3RvcmUpOwogICAgICAgICAgICAgICAgaWYgKHBhcm1M\naXN0ICE9IG51bGwpCiAgICAgICAgICAgICAgICAJcGFybUxpc3QuYWRkKHZh\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlm\nIChjb2xsZWN0UGFybVZhbHVlT25seSkgCiAgICAgICAgICAgIAljb250aW51\nZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjb3VudCA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKGdldENvbHVtbkFsaWFzKGZyb21Db2xzW2ldLCBwaikp\nOwogICAgICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIgSVMgIik7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICBidWYu\nYXBwZW5kVmFsdWUodmFsLCBmcm9tQ29sc1tpXSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBjb3VudDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBU\nZXN0IHRvIHNlZSBpZiB0aGUgZ2l2ZW4gc2V0IG9mIGNvbHVtbnMgY29udGFp\nbnMgYWxsIHRoZQogICAgICogY29sdW1ucyBpbiB0aGUgZ2l2ZW4gcG90ZW50\naWFsIHN1YnNldC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVh\nbiBjb250YWluc0FsbChDb2x1bW5bXSBzZXQsIENvbHVtbltdIHN1Yikgewog\nICAgICAgIGlmIChzdWIubGVuZ3RoID4gc2V0Lmxlbmd0aCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB0aGlzIGlzIG9idmlvdXNs\neSBuXjIsIGJ1dCB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgc2hvdWxkIGJlIGlu\nCiAgICAgICAgLy8gdGhlIDEtMiByYW5nZSwgc28gbm8gYmlnZ2llCiAgICAg\nICAgYm9vbGVhbiBmb3VuZCA9IHRydWU7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBzdWIubGVuZ3RoICYmIGZvdW5kOyBpKyspIHsKICAgICAgICAg\nICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7\nIGogPCBzZXQubGVuZ3RoICYmICFmb3VuZDsgaisrKQogICAgICAgICAgICAg\nICAgZm91bmQgPSBzdWJbaV0gPT0gc2V0W2pdOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZm91bmQ7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUo\nSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoam9pbnMgIT0gbnVsbCkKICAg\nICAgICAgICAgd2hlcmUoKFN0cmluZykgbnVsbCwgam9pbnMpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHdoZXJlKFNRTEJ1ZmZlciBzcWwpIHsKICAgICAg\nICB3aGVyZShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgd2hlcmUoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAg\nICAgICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlvbiB0byB0\naGUgV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd2hl\ncmUoU1FMQnVmZmVyIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8g\nbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoc3FsID09IG51\nbGwgfHwgc3FsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpZiAoX3doZXJlID09IG51bGwpCiAgICAgICAgICAgIF93aGVyZSA9\nIG5ldyBTUUxCdWZmZXIoX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfd2hl\ncmUuaXNFbXB0eSgpKQogICAgICAgICAgICBfd2hlcmUuYXBwZW5kKCIgQU5E\nICIpOwogICAgICAgIF93aGVyZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB3aGVyZShTdHJpbmcgc3FsKSB7CiAgICAgICAgd2hlcmUo\nc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdo\nZXJlKFN0cmluZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgd2hlcmUo\nc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhlIFdIRVJFIGNs\nYXVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdoZXJlKFN0cmluZyBz\ncWwsIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNl\nIGpvaW5zLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3Fs\nKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3doZXJlID09\nIG51bGwpCiAgICAgICAgICAgIF93aGVyZSA9IG5ldyBTUUxCdWZmZXIoX2Rp\nY3QpOwogICAgICAgIGVsc2UgaWYgKCFfd2hlcmUuaXNFbXB0eSgpKQogICAg\nICAgICAgICBfd2hlcmUuYXBwZW5kKCIgQU5EICIpOwogICAgICAgIF93aGVy\nZS5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYXZpbmco\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIGhhdmluZyhzcWwsIChKb2lucykg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFNRTEJ1ZmZl\nciBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaGF2aW5nKHNxbCwgZ2V0\nSm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5nKFNRTEJ1ZmZlciBzcWws\nIFBhdGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpv\naW5zLi4uCiAgICAgICAgaWYgKHNxbCA9PSBudWxsIHx8IHNxbC5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9oYXZpbmcg\nPT0gbnVsbCkKICAgICAgICAgICAgX2hhdmluZyA9IG5ldyBTUUxCdWZmZXIo\nX2RpY3QpOwogICAgICAgIGVsc2UgaWYgKCFfaGF2aW5nLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgX2hhdmluZy5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAg\nX2hhdmluZy5hcHBlbmQoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBo\nYXZpbmcoU3RyaW5nIHNxbCkgewogICAgICAgIGhhdmluZyhzcWwsIChKb2lu\ncykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaGF2aW5nKFN0cmlu\nZyBzcWwsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaGF2aW5nKHNxbCwgZ2V0\nSm9pbnMoam9pbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZCB0aGUgZ2l2ZW4gY29uZGl0aW9uIHRvIHRoZSBIQVZJTkcgY2xhdXNlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgaGF2aW5nKFN0cmluZyBzcWwsIFBh\ndGhKb2lucyBwaikgewogICAgICAgIC8vIG5vIG5lZWQgdG8gdXNlIGpvaW5z\nLi4uCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoc3FsKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2hhdmluZyA9PSBudWxs\nKQogICAgICAgICAgICBfaGF2aW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7\nCiAgICAgICAgZWxzZSBpZiAoIV9oYXZpbmcuaXNFbXB0eSgpKQogICAgICAg\nICAgICBfaGF2aW5nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICBfaGF2aW5n\nLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnko\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMp\nIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU1FMQnVm\nZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSk7CiAgICAgICAgZ3JvdXBCeUFwcGVuZChzcWwuZ2V0U1FMKCkp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNxbCkg\newogICAgICAgIGdyb3VwQnkoc3FsLCAoSm9pbnMpIG51bGwpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGdyb3VwQnkoU3RyaW5nIHNxbCwgSm9pbnMgam9p\nbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAg\nZ3JvdXBCeUFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdy\nb3VwQnkoQ29sdW1uIGNvbCkgewogICAgICAgIGdyb3VwQnkoY29sLCBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENvbHVtbiBjb2ws\nIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9p\nbnMoam9pbnMsIHRydWUpOwogICAgICAgIGdyb3VwQnlBcHBlbmQoZ2V0Q29s\ndW1uQWxpYXMoY29sLCBwaikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdy\nb3VwQnkoQ29sdW1uW10gY29scykgewogICAgICAgIGdyb3VwQnkoY29scywg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW5b\nXSBjb2xzLCBKb2lucyBqb2lucykgewogICAgICAgIFBhdGhKb2lucyBwaiA9\nIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGNvbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXBC\neUFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb2xzW2ldLCBwaikpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGdyb3VwQnlBcHBlbmQo\nU3RyaW5nIHNxbCkgewogICAgICAgIGlmIChfZ3JvdXBlZCA9PSBudWxsIHx8\nICFfZ3JvdXBlZC5jb250YWlucyhzcWwpKSB7CiAgICAgICAgICAgIGlmIChf\nZ3JvdXBpbmcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2dyb3VwaW5n\nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgICAgICAgICBfZ3Jv\ndXBlZCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgfSBlbHNlCiAg\nICAgICAgICAgICAgICBfZ3JvdXBpbmcuYXBwZW5kKCIsICIpOwoKICAgICAg\nICAgICAgX2dyb3VwaW5nLmFwcGVuZChzcWwpOwogICAgICAgICAgICBfZ3Jv\ndXBlZC5hZGQoc3FsKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgZ3JvdXBCeShDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNz\nZXMsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgZ3JvdXBCeShtYXBwaW5nLCBzdWJj\nbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIG51bGwpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGdyb3VwQnkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJj\nbGFzc2VzLCBKREJDU3RvcmUgc3RvcmUsCiAgICAgICAgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpIHsKICAgICAgICAvLyB3\nZSBpbXBsZW1lbnQgdGhpcyBieSBwdXR0aW5nIG91cnNlbHZlcyBpbnRvIGdy\nb3VwaW5nIG1vZGUsIHdoZXJlCiAgICAgICAgLy8gYWxsIHNlbGVjdCBpbnZv\nY2F0aW9ucyBhcmUgcmUtcm91dGVkIHRvIGdyb3VwLWJ5IGludm9jYXRpb25z\nIGluc3RlYWQuCiAgICAgICAgLy8gdGhpcyBhbGxvd3MgdXMgdG8gdXRpbGl6\nZSB0aGUgc2FtZSBzZWxlY3QgQVBJcyBvZiB0aGUgc3RvcmUgbWFuYWdlcgog\nICAgICAgIC8vIGFuZCBhbGwgdGhlIG1hcHBpbmcgc3RyYXRlZ2llcywgcmF0\naGVyIHRoYW4gaGF2aW5nIHRvIGNyZWF0ZSAKICAgICAgICAvLyBlcXVpdmFs\nZW50IEFQSXMgYW5kIGR1cGxpY2F0ZSBsb2dpYyBmb3IgZ3JvdXBpbmcKICAg\nICAgICBib29sZWFuIHdhc0dyb3VwaW5nID0gaXNHcm91cGluZygpOwogICAg\nICAgIF9mbGFncyB8PSBHUk9VUElORzsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzZWxlY3QobWFwcGluZywgc3ViY2xhc3Nlcywgc3RvcmUsIGZldGNo\nLCAKICAgICAgICAgICAgICAgIEVhZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9OT05F\nLCBqb2lucyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKCF3YXNHcm91cGluZykKICAgICAgICAgICAgICAgIF9mbGFncyAmPSB+R1JP\nVVBJTkc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB3ZSdyZSBpbiBncm91cCBtb2RlLCB3aGVyZSBhbnkgc2VsZWN0IGlzIGNo\nYW5nZWQgdG8gYSBncm91cC1ieQogICAgICogY2FsbC4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGlzR3JvdXBpbmcoKSB7CiAgICAgICAgcmV0dXJu\nIChfZmxhZ3MgJiBHUk9VUElORykgIT0gMDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgam9pbnMgdG8gdXNlIGZvciBjb2x1bW4gYWxpYXNl\ncywgZXRjLgogICAgICoKICAgICAqIEBwYXJhbSBqb2lucyBqb2lucyBnaXZl\nbiBieSB0aGUgdXNlcgogICAgICogQHJldHVybiB0aGUgam9pbnMgdG8gdXNl\nIGZvciBhbGlhc2VzLCBldGMKICAgICAqLwogICAgcHJpdmF0ZSBQYXRoSm9p\nbnMgZ2V0Sm9pbnMoSm9pbnMgam9pbnMsIGJvb2xlYW4gcmVjb3JkKSB7CiAg\nICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykgam9pbnM7CiAgICAg\nICAgYm9vbGVhbiBwcmUgPSAocGogPT0gbnVsbCB8fCAhcGouaXNEaXJ0eSgp\nKQogICAgICAgICAgICAmJiBfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpv\naW5zLmlzRW1wdHkoKTsKICAgICAgICBpZiAocHJlKQogICAgICAgICAgICBw\naiA9IChQYXRoSm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CgogICAgICAgIGlm\nIChwaiA9PSBudWxsIHx8ICFwai5pc0RpcnR5KCkpCiAgICAgICAgICAgIHBq\nID0gX2pvaW5zOwogICAgICAgIGVsc2UgaWYgKCFwcmUpIHsKICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBPVVRFUikgIT0gMCkKICAgICAgICAgICAgICAg\nIHBqID0gKFBhdGhKb2lucykgb3V0ZXIocGopOwogICAgICAgICAgICBpZiAo\ncmVjb3JkKSB7CiAgICAgICAgICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgICAgICByZW1vdmVQYXJlbnRKb2lucyhwaik7CiAg\nICAgICAgICAgICAgICBpZiAoIXBqLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgICAgIHJlbW92ZUpvaW5zRnJvbVN1YnNlbGVjdHMocGopOwogICAg\nICAgICAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChfam9pbnMuam9pbnMoKSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfam9pbnMuc2V0Sm9pbnMo\nbmV3IEpvaW5TZXQocGouam9pbnMoKSkpOwogICAgICAgICAgICAgICAgICAg\nIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX2pvaW5zLmpvaW5zKCku\nYWRkQWxsKHBqLmpvaW5zKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBwajsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlbW92ZSBhbnkgam9pbnMgYWxyZWFkeSBpbiBvdXIg\ncGFyZW50IHNlbGVjdCBmcm9tIHRoZSBnaXZlbiBub24tZW1wdHkKICAgICAq\nIGpvaW4gc2V0LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlUGFy\nZW50Sm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYgKF9wYXJlbnQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChfcGFy\nZW50Ll9qb2lucyAhPSBudWxsICYmICFfcGFyZW50Ll9qb2lucy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgYm9vbGVhbiByZW1vdmVkID0gZmFsc2U7CiAg\nICAgICAgICAgIGlmICghX3JlbW92ZWRBbGlhc0Zyb21QYXJlbnQuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBq\nLmpvaW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAg\nICAgICAgICAgICAgIEpvaW4gam4gPSAoSm9pbikgaXRyLm5leHQoKTsKICAg\nICAgICAgICAgICAgICAgIGlmIChfYWxpYXNlcy5jb250YWluc1ZhbHVlKGpu\nLmdldEluZGV4MSgpKSkKICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVk\nID0gX3BhcmVudC5fam9pbnMuam9pbnMoKS5yZW1vdmUoam4pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVt\nb3ZlZCkKICAgICAgICAgICAgICAgIHBqLmpvaW5zKCkucmVtb3ZlQWxsKF9w\nYXJlbnQuX2pvaW5zLmpvaW5zKCkpOwogICAgICAgIH0KICAgICAgICBpZiAo\nIXBqLmlzRW1wdHkoKSkKICAgICAgICAgICAgX3BhcmVudC5yZW1vdmVQYXJl\nbnRKb2lucyhwaik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhl\nIGdpdmVuIG5vbi1lbXB0eSBqb2lucyBmcm9tIHRoZSBqb2lucyBvZiBvdXIg\nc3Vic2VsZWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUpv\naW5zRnJvbVN1YnNlbGVjdHMoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgaWYg\nKF9zdWJzZWxzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICBTZWxlY3RJbXBsIHN1YjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIF9zdWJzZWxzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIHN1YiA9IChT\nZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAgICAgIGlmIChz\ndWIuX2pvaW5zICE9IG51bGwgJiYgIXN1Yi5fam9pbnMuaXNFbXB0eSgpKQog\nICAgICAgICAgICAgICAgc3ViLl9qb2lucy5qb2lucygpLnJlbW92ZUFsbChw\nai5qb2lucygpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFNlbGVj\ndEV4ZWN1dG9yIHdoZXJlQ2xvbmUoaW50IHNlbHMpIHsKICAgICAgICBpZiAo\nc2VscyA8IDEpCiAgICAgICAgICAgIHNlbHMgPSAxOwoKICAgICAgICBTZWxl\nY3RbXSBjbG9uZXMgPSBudWxsOwogICAgICAgIFNlbGVjdEltcGwgc2VsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VsczsgaSsrKSB7CiAgICAg\nICAgICAgIHNlbCA9IChTZWxlY3RJbXBsKSBfY29uZi5nZXRTUUxGYWN0b3J5\nSW5zdGFuY2UoKS5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgc2VsLl9mbGFn\ncyA9IF9mbGFnczsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+QUdHUkVH\nQVRFOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5PVVRFUjsKICAgICAg\nICAgICAgc2VsLl9mbGFncyAmPSB+TFJTOwogICAgICAgICAgICBzZWwuX2Zs\nYWdzICY9IH5FQUdFUl9UT19PTkU7CiAgICAgICAgICAgIHNlbC5fZmxhZ3Mg\nJj0gfkVBR0VSX1RPX01BTlk7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0g\nfkZPUkNFX0NPVU5UOwogICAgICAgICAgICBzZWwuX2pvaW5TeW50YXggPSBf\nam9pblN5bnRheDsKICAgICAgICAgICAgaWYgKF9hbGlhc2VzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBzZWwuX2FsaWFzZXMgPSBuZXcgSGFzaE1hcChf\nYWxpYXNlcyk7CiAgICAgICAgICAgIGlmIChfdGFibGVzICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBzZWwuX3RhYmxlcyA9IG5ldyBUcmVlTWFwKF90YWJs\nZXMpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBzZWwuX2pvaW5zID0gX2pvaW5zLmNsb25lKHNlbCk7CiAgICAg\nICAgICAgIGlmIChfd2hlcmUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNl\nbC5fd2hlcmUgPSBuZXcgU1FMQnVmZmVyKF93aGVyZSk7CiAgICAgICAgICAg\nIGlmIChfZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzZWwuX2Zy\nb20gPSAoU2VsZWN0SW1wbCkgX2Zyb20ud2hlcmVDbG9uZSgxKTsKICAgICAg\nICAgICAgICAgIHNlbC5fZnJvbS5fb3V0ZXIgPSBzZWw7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHNlbC5fc3Vic2VscyA9IG5ldyBBcnJheUxpc3QoX3N1YnNl\nbHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgIFNlbGVjdEltcGwgc3ViLCBz\nZWxTdWI7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IF9z\ndWJzZWxzLnNpemUoKTsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgc3Vi\nID0gKFNlbGVjdEltcGwpIF9zdWJzZWxzLmdldChqKTsKICAgICAgICAgICAg\nICAgICAgICBzZWxTdWIgPSAoU2VsZWN0SW1wbCkgc3ViLmZ1bGxDbG9uZSgx\nKTsKICAgICAgICAgICAgICAgICAgICBzZWxTdWIuX3BhcmVudCA9IHNlbDsK\nICAgICAgICAgICAgICAgICAgICBzZWxTdWIuX3N1YlBhdGggPSBzdWIuX3N1\nYlBhdGg7CiAgICAgICAgICAgICAgICAgICAgc2VsLl9zdWJzZWxzLmFkZChz\nZWxTdWIpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWwuX3doZXJlICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbC5fd2hlcmUucmVw\nbGFjZShzdWIsIHNlbFN1Yik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxzID09IDEpCiAgICAgICAgICAg\nICAgICByZXR1cm4gc2VsOwogICAgICAgICAgICBpZiAoY2xvbmVzID09IG51\nbGwpCiAgICAgICAgICAgICAgICBjbG9uZXMgPSBuZXcgU2VsZWN0W3NlbHNd\nOwogICAgICAgICAgICBjbG9uZXNbaV0gPSBzZWw7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfY29uZi5nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKS5uZXdV\nbmlvbihjbG9uZXMpOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRv\nciBmdWxsQ2xvbmUoaW50IHNlbHMpIHsKICAgICAgICBpZiAoc2VscyA8IDEp\nCiAgICAgICAgICAgIHNlbHMgPSAxOwoKICAgICAgICBTZWxlY3RbXSBjbG9u\nZXMgPSBudWxsOwogICAgICAgIFNlbGVjdEltcGwgc2VsOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgc2VsczsgaSsrKSB7CiAgICAgICAgICAgIHNl\nbCA9IChTZWxlY3RJbXBsKSB3aGVyZUNsb25lKDEpOwogICAgICAgICAgICBz\nZWwuX2ZsYWdzID0gX2ZsYWdzOwogICAgICAgICAgICBzZWwuX2V4cGVjdGVk\nUmVzdWx0Q291bnQgPSBfZXhwZWN0ZWRSZXN1bHRDb3VudDsKICAgICAgICAg\nICAgc2VsLl9zZWxlY3RzLmFkZEFsbChfc2VsZWN0cyk7CiAgICAgICAgICAg\nIGlmIChfb3JkZXJpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5f\nb3JkZXJpbmcgPSBuZXcgU1FMQnVmZmVyKF9vcmRlcmluZyk7CiAgICAgICAg\nICAgIHNlbC5fb3JkZXJzID0gX29yZGVyczsKICAgICAgICAgICAgaWYgKF9n\ncm91cGluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgc2VsLl9ncm91cGlu\nZyA9IG5ldyBTUUxCdWZmZXIoX2dyb3VwaW5nKTsKICAgICAgICAgICAgaWYg\nKF9oYXZpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5faGF2aW5n\nID0gbmV3IFNRTEJ1ZmZlcihfaGF2aW5nKTsKICAgICAgICAgICAgaWYgKF9m\ncm9tICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbC5fZnJvbSA9IChT\nZWxlY3RJbXBsKSBfZnJvbS5mdWxsQ2xvbmUoMSk7CiAgICAgICAgICAgICAg\nICBzZWwuX2Zyb20uX291dGVyID0gc2VsOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoc2VscyA9PSAxKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHNlbDsKICAgICAgICAgICAgaWYgKGNsb25lcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsKICAgICAgICAg\nICAgY2xvbmVzW2ldID0gc2VsOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3VW5pb24oY2xvbmVz\nKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3IgZWFnZXJDbG9u\nZShGaWVsZE1hcHBpbmcga2V5LCBpbnQgZWFnZXJUeXBlLAogICAgICAgIGJv\nb2xlYW4gdG9NYW55LCBpbnQgc2VscykgewogICAgICAgIGlmIChlYWdlclR5\ncGUgPT0gRUFHRVJfT1VURVIKICAgICAgICAgICAgJiYgX2pvaW5TeW50YXgg\nPT0gSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKF9lYWdlcktleXMgIT0gbnVs\nbCAmJiBfZWFnZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICAvLyBnbG9iYWwgc2V0IG9mIGVhZ2VyIGtl\neXMKICAgICAgICBpZiAoX2VhZ2VyS2V5cyA9PSBudWxsKQogICAgICAgICAg\nICBfZWFnZXJLZXlzID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICBfZWFnZXJL\nZXlzLmFkZChrZXkpOwoKICAgICAgICBTZWxlY3RFeGVjdXRvciBzZWw7CiAg\nICAgICAgaWYgKGVhZ2VyVHlwZSAhPSBFQUdFUl9QQVJBTExFTCkgewogICAg\nICAgICAgICBpZiAodG9NYW55KQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9\nIEVBR0VSX1RPX01BTlk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIF9mbGFncyB8PSBFQUdFUl9UT19PTkU7CiAgICAgICAgICAgIHNlbCA9\nIHRoaXM7CiAgICAgICAgfSBlbHNlIGlmIChzZWxzIDwgMikKICAgICAgICAg\nICAgc2VsID0gcGFyYWxsZWxDbG9uZSgpOwogICAgICAgIGVsc2UgewogICAg\nICAgICAgICBTZWxlY3RbXSBjbG9uZXMgPSBuZXcgU2VsZWN0W3NlbHNdOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsb25lcy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgIGNsb25lc1tpXSA9IHBhcmFsbGVsQ2xv\nbmUoKTsKICAgICAgICAgICAgc2VsID0gX2NvbmYuZ2V0U1FMRmFjdG9yeUlu\nc3RhbmNlKCkubmV3VW5pb24oY2xvbmVzKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChfZWFnZXIgPT0gbnVsbCkKICAgICAgICAgICAgX2VhZ2VyID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBfZWFnZXIucHV0KHRvRWFnZXJLZXkoa2V5\nLCBnZXRKb2lucyhudWxsLCBmYWxzZSkpLCBzZWwpOwogICAgICAgIHJldHVy\nbiBzZWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBjbG9uZSBv\nZiB0aGlzIHNlbGVjdCBmb3IgdXNlIGluIGVhZ2VyIHBhcmFsbGVsIHNlbGVj\ndHMuCiAgICAgKi8KICAgIHByaXZhdGUgU2VsZWN0SW1wbCBwYXJhbGxlbENs\nb25lKCkgewogICAgICAgIFNlbGVjdEltcGwgc2VsID0gKFNlbGVjdEltcGwp\nIHdoZXJlQ2xvbmUoMSk7CiAgICAgICAgc2VsLl9mbGFncyAmPSB+Tk9OQVVU\nT19ESVNUSU5DVDsKICAgICAgICBzZWwuX2VhZ2VyS2V5cyA9IF9lYWdlcktl\neXM7CiAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9p\nbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHNlbC5fcHJlSm9pbnMgPSBu\nZXcgU3RhY2soKTsKICAgICAgICAgICAgc2VsLl9wcmVKb2lucy5wdXNoKCgo\nU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5wZWVrKCkpLgogICAgICAgICAgICAg\nICAgY2xvbmUoc2VsKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWw7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdmlldyBvZiBlYWdlciBz\nZWxlY3RzLiBNYXkgYmUgbnVsbC4KICAgICAqLwogICAgcHVibGljIE1hcCBn\nZXRFYWdlck1hcCgpIHsKICAgICAgICByZXR1cm4gX2VhZ2VyOwogICAgfQoK\nICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRvciBnZXRFYWdlcihGaWVsZE1hcHBp\nbmcga2V5KSB7CiAgICAgICAgaWYgKF9lYWdlciA9PSBudWxsIHx8ICFfZWFn\nZXJLZXlzLmNvbnRhaW5zKGtleSkpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiAoU2VsZWN0RXhlY3V0b3IpIF9lYWdlci5nZXQo\ndG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwsCiAgICAgICAgICAgIGZh\nbHNlKSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBlYWdl\nciBrZXkgdG8gdXNlIGZvciB0aGUgdXNlci1naXZlbiBrZXkuCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCB0b0VhZ2VyS2V5KEZpZWxkTWFw\ncGluZyBrZXksIFBhdGhKb2lucyBwaikgewogICAgICAgIGlmIChwaiA9PSBu\ndWxsIHx8IHBqLnBhdGgoKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\na2V5OwogICAgICAgIHJldHVybiBuZXcgS2V5KHBqLnBhdGgoKS50b1N0cmlu\nZygpLCBrZXkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBuZXdKb2lucygp\nIHsKICAgICAgICBpZiAoX3ByZUpvaW5zICE9IG51bGwgJiYgIV9wcmVKb2lu\ncy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgU2VsZWN0Sm9pbnMgc2ogPSAo\nU2VsZWN0Sm9pbnMpIF9wcmVKb2lucy5wZWVrKCk7CiAgICAgICAgICAgIHJl\ndHVybiBzai5jbG9uZSh0aGlzKTsKICAgICAgICB9CiAgICAgICAgLy8gcmV0\ndXJuIHRoaXMgZm9yIGVmZmljaWVuY3kgaW4gY2FzZSBubyBqb2lucyBlbmQg\ndXAgYmVpbmcgbWFkZQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIHB1YmxpYyBKb2lucyBuZXdPdXRlckpvaW5zKCkgewogICAgICAgIHJldHVy\nbiAoKFBhdGhKb2lucykgbmV3Sm9pbnMoKSkuc2V0T3V0ZXIodHJ1ZSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kKFNRTEJ1ZmZlciBidWYsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGpvaW5zID09IG51bGwgfHwgam9p\nbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlm\nICghYnVmLmlzRW1wdHkoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFO\nRCAiKTsKICAgICAgICBKb2luIGpvaW4gPSBudWxsOwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gKChQYXRoSm9pbnMpIGpvaW5zKS5qb2lucygpLmpv\naW5JdGVyYXRvcigpOwogICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykgewog\nICAgICAgICAgICBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIHN3aXRjaCAoX2pvaW5TeW50YXgpIHsKICAgICAgICAgICAgICAgIGNh\nc2UgSm9pblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTDoKICAgICAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKF9kaWN0LnRvVHJhZGl0aW9uYWxKb2lu\nKGpvaW4pKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSm9pblN5bnRheGVzLlNZTlRBWF9EQVRBQkFTRToKICAg\nICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKF9kaWN0LnRvTmF0aXZlSm9p\nbihqb2luKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBBTkQgIik7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBK\nb2lucyBhbmQoSm9pbnMgam9pbnMxLCBKb2lucyBqb2luczIpIHsKICAgICAg\nICByZXR1cm4gYW5kKChQYXRoSm9pbnMpIGpvaW5zMSwgKFBhdGhKb2lucykg\nam9pbnMyLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbWJpbmUg\ndGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIFNlbGVjdEpv\naW5zIGFuZChQYXRoSm9pbnMgajEsIFBhdGhKb2lucyBqMiwgYm9vbGVhbiBu\ndWxsSm9pbnMpIHsKICAgICAgICBpZiAoKGoxID09IG51bGwgfHwgajEuaXNF\nbXB0eSgpKQogICAgICAgICAgICAmJiAoajIgPT0gbnVsbCB8fCBqMi5pc0Vt\ncHR5KCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU2Vs\nZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CiAgICAgICAg\naWYgKGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgpKSB7CiAgICAgICAgICAg\nIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAgICAgICBzai5zZXRKb2lucyhq\nMi5qb2lucygpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nc2ouc2V0Sm9pbnMobmV3IEpvaW5TZXQoajIuam9pbnMoKSkpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIEpvaW5TZXQgc2V0OwogICAgICAgICAg\nICBpZiAobnVsbEpvaW5zKQogICAgICAgICAgICAgICAgc2V0ID0gajEuam9p\nbnMoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2V0ID0g\nbmV3IEpvaW5TZXQoajEuam9pbnMoKSk7CgogICAgICAgICAgICBpZiAoajIg\nIT0gbnVsbCAmJiAhajIuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgc2V0\nLmFkZEFsbChqMi5qb2lucygpKTsKICAgICAgICAgICAgc2ouc2V0Sm9pbnMo\nc2V0KTsKICAgICAgICB9CgogICAgICAgIC8vIG51bGwgcHJldmlvdXMgam9p\nbnM7IGFsbCBhcmUgY29tYmluZWQgaW50byB0aGlzIG9uZQogICAgICAgIGlm\nIChudWxsSm9pbnMgJiYgajEgIT0gbnVsbCkKICAgICAgICAgICAgajEubnVs\nbEpvaW5zKCk7CiAgICAgICAgaWYgKG51bGxKb2lucyAmJiBqMiAhPSBudWxs\nKQogICAgICAgICAgICBqMi5udWxsSm9pbnMoKTsKCiAgICAgICAgcmV0dXJu\nIHNqOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBvcihKb2lucyBqb2luczEs\nIEpvaW5zIGpvaW5zMikgewogICAgICAgIFBhdGhKb2lucyBqMSA9IChQYXRo\nSm9pbnMpIGpvaW5zMTsKICAgICAgICBQYXRoSm9pbnMgajIgPSAoUGF0aEpv\naW5zKSBqb2luczI7CgogICAgICAgIC8vIGlmIG5vIGNvbW1vbiBqb2lucywg\ncmV0dXJuIG51bGw7IGlmIG9uZSBzaWRlIG9mIHRoZSBvciBjbGF1c2UgaGFz\nCiAgICAgICAgLy8gZGlmZmVyZW50IGpvaW5zIHRoYW4gdGhlIG90aGVyLCB0\naGVuIHdlIG5lZWQgdG8gdXNlIGRpc3RpbmN0CiAgICAgICAgYm9vbGVhbiBq\nMUVtcHR5ID0gajEgPT0gbnVsbCB8fCBqMS5pc0VtcHR5KCk7CiAgICAgICAg\nYm9vbGVhbiBqMkVtcHR5ID0gajIgPT0gbnVsbCB8fCBqMi5pc0VtcHR5KCk7\nCiAgICAgICAgaWYgKGoxRW1wdHkgfHwgajJFbXB0eSkgewogICAgICAgICAg\nICBpZiAoajFFbXB0eSAmJiAhajJFbXB0eSkgewogICAgICAgICAgICAgICAg\nY29sbGVjdE91dGVySm9pbnMoajIpOwogICAgICAgICAgICAgICAgaWYgKCFq\nMi5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElN\nUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAgICB9IGVsc2UgaWYgKGoyRW1w\ndHkgJiYgIWoxRW1wdHkpIHsKICAgICAgICAgICAgICAgIGNvbGxlY3RPdXRl\nckpvaW5zKGoxKTsKICAgICAgICAgICAgICAgIGlmICghajEuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBMSUNJVF9ESVNU\nSU5DVDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIC8vIGlmIGFsbCBjb21tb24gam9pbnMsIG1v\ndmUgYWxsIGpvaW5zIHRvIHJldHVybmVkIGluc3RhbmNlCiAgICAgICAgU2Vs\nZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CiAgICAgICAg\naWYgKGoxLmpvaW5zKCkuZXF1YWxzKGoyLmpvaW5zKCkpKSB7CiAgICAgICAg\nICAgIHNqLnNldEpvaW5zKGoxLmpvaW5zKCkpOwogICAgICAgICAgICBqMS5u\ndWxsSm9pbnMoKTsKICAgICAgICAgICAgajIubnVsbEpvaW5zKCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgSm9pblNldCBjb21tb25Kb2lucyA9\nIG5ldyBKb2luU2V0KGoxLmpvaW5zKCkpOwogICAgICAgICAgICBjb21tb25K\nb2lucy5yZXRhaW5BbGwoajIuam9pbnMoKSk7CiAgICAgICAgICAgIGlmICgh\nY29tbW9uSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAvLyBw\ndXQgY29tbW9uIGpvaW5zIGluIHJldHVybmVkIGluc3RhbmNlOyByZW1vdmUg\ndGhlbSBmcm9tCiAgICAgICAgICAgICAgICAvLyBlYWNoIGdpdmVuIGluc3Rh\nbmNlCiAgICAgICAgICAgICAgICBzai5zZXRKb2lucyhjb21tb25Kb2lucyk7\nCiAgICAgICAgICAgICAgICBqMS5qb2lucygpLnJlbW92ZUFsbChjb21tb25K\nb2lucyk7CiAgICAgICAgICAgICAgICBqMi5qb2lucygpLnJlbW92ZUFsbChj\nb21tb25Kb2lucyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29sbGVj\ndE91dGVySm9pbnMoajEpOwogICAgICAgICAgICBjb2xsZWN0T3V0ZXJKb2lu\ncyhqMik7CgogICAgICAgICAgICAvLyBpZiBvbmUgc2lkZSBvZiB0aGUgb3Ig\nY2xhdXNlIGhhcyBkaWZmZXJlbnQgam9pbnMgdGhhbiB0aGUgb3RoZXIsCiAg\nICAgICAgICAgIC8vIHRoZW4gd2UgbmVlZCB0byB1c2UgZGlzdGluY3QKICAg\nICAgICAgICAgaWYgKCFqMS5pc0VtcHR5KCkgfHwgIWoyLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgIF9mbGFncyB8PSBJTVBMSUNJVF9ESVNUSU5DVDsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNqOwogICAgfQoKICAgIHB1Ymxp\nYyBKb2lucyBvdXRlcihKb2lucyBqb2lucykgewogICAgICAgIGlmIChfam9p\nblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFYX1RSQURJVElPTkFMIHx8\nIGpvaW5zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBqb2luczsKCiAg\nICAgICAgLy8gcmVjb3JkIHRoYXQgdGhpcyBpcyBhbiBvdXRlciBqb2luIHNl\ndCwgZXZlbiBpZiBpdCdzIGVtcHR5CiAgICAgICAgUGF0aEpvaW5zIHBqID0g\nKChQYXRoSm9pbnMpIGpvaW5zKS5zZXRPdXRlcih0cnVlKTsKICAgICAgICBp\nZiAocGouaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gcGo7CgogICAg\nICAgIEpvaW4gam9pbjsKICAgICAgICBKb2luIHJlYzsKICAgICAgICBib29s\nZWFuIGhhc0pvaW5zID0gX2pvaW5zICE9IG51bGwgJiYgX2pvaW5zLmpvaW5z\nKCkgIT0gbnVsbDsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBqLmpv\naW5zKCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAo\nam9pbi5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVSKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIWhhc0pvaW5zKQogICAgICAgICAgICAgICAgICAgIGpv\naW4uc2V0VHlwZShKb2luLlRZUEVfT1VURVIpOwogICAgICAgICAgICAgICAg\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVjID0gX2pvaW5zLmpvaW5z\nKCkuZ2V0UmVjb3JkZWRKb2luKGpvaW4pOwogICAgICAgICAgICAgICAgICAg\nIGlmIChyZWMgPT0gbnVsbCB8fCByZWMuZ2V0VHlwZSgpID09IEpvaW4uVFlQ\nRV9PVVRFUikKICAgICAgICAgICAgICAgICAgICAgICAgam9pbi5zZXRUeXBl\nKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpvaW5zOwogICAgfQoK\nICAgIC8qKgogICAgICogTW92ZXMgdGhlIGpvaW5zIGZyb20gdGhlIGdpdmVu\nIGluc3RhbmNlIGludG8gb3VyIG91dGVyIGpvaW5zIHNldC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGNvbGxlY3RPdXRlckpvaW5zKFBhdGhKb2lucyBw\naikgewogICAgICAgIGlmIChfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMu\nU1lOVEFYX1RSQURJVElPTkFMIHx8IHBqID09IG51bGwKICAgICAgICAgICAg\nfHwgcGouaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2pvaW5zID0gbmV3\nIFNlbGVjdEpvaW5zKHRoaXMpOwoKICAgICAgICBib29sZWFuIGFkZCA9IHRy\ndWU7CiAgICAgICAgaWYgKF9qb2lucy5qb2lucygpID09IG51bGwpIHsKICAg\nICAgICAgICAgX2pvaW5zLnNldEpvaW5zKHBqLmpvaW5zKCkpOwogICAgICAg\nICAgICBhZGQgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIEpvaW4gam9p\nbjsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IHBqLmpvaW5zKCkuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgam9pbiA9\nIChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoam9pbi5nZXRU\neXBlKCkgPT0gSm9pbi5UWVBFX0lOTkVSKSB7CiAgICAgICAgICAgICAgICBp\nZiAoam9pbi5nZXRGb3JlaWduS2V5KCkgIT0gbnVsbAogICAgICAgICAgICAg\nICAgICAgICYmICFfZGljdC5jYW5PdXRlckpvaW4oX2pvaW5TeW50YXgsIGpv\naW4uZ2V0Rm9yZWlnbktleSgpKSkgewogICAgICAgICAgICAgICAgICAgIExv\nZyBsb2cgPSBfY29uZi5nZXRMb2coSkRCQ0NvbmZpZ3VyYXRpb24uTE9HX0pE\nQkMpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdl\ndCgiY2FudC1vdXRlci1mayIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBqb2luLmdldEZvcmVpZ25LZXkoKSkpOwogICAgICAgICAgICAgICAgfSBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgam9pbi5zZXRUeXBlKEpvaW4uVFlQ\nRV9PVVRFUik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFkZCkK\nICAgICAgICAgICAgICAgIF9qb2lucy5qb2lucygpLmFkZChqb2luKTsKICAg\nICAgICB9CiAgICAgICAgcGoubnVsbEpvaW5zKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIGZvciB0aGUgZ2l2ZW4gdGFibGUg\ndW5kZXIgdGhlIGdpdmVuIGpvaW5zLgogICAgICogTk9URTogV0UgUkVMWSBP\nTiBUSEVTRSBJTkRFWEVTIEJFSU5HIE1PTk9UT05JQ0FMTFkgSU5DUkVBU0lO\nRyBGUk9NIDAKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgZ2V0VGFibGVJbmRl\neChUYWJsZSB0YWJsZSwgUGF0aEpvaW5zIHBqLCBib29sZWFuIGNyZWF0ZSkg\newogICAgICAgIC8vIGlmIHdlIGhhdmUgYSBmcm9tIHNlbGVjdCwgdGhlbiB0\naGVyZSBhcmUgbm8gdGFibGUgYWxpYXNlcwogICAgICAgIGlmIChfZnJvbSAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAgIE9iamVj\ndCBrZXkgPSB0YWJsZS5nZXRGdWxsTmFtZSgpOwogICAgICAgIGlmIChwaiAh\nPSBudWxsICYmIHBqLnBhdGgoKSAhPSBudWxsKQogICAgICAgICAgICBrZXkg\nPSBuZXcgS2V5KHBqLnBhdGgoKS50b1N0cmluZygpLCBrZXkpOwoKICAgICAg\nICAvLyBjaGVjayBvdXQgZXhpc3RpbmcgYWxpYXNlcwogICAgICAgIEludGVn\nZXIgaSA9IGZpbmRBbGlhcyh0YWJsZSwga2V5LCBmYWxzZSwgbnVsbCk7CiAg\nICAgICAgaWYgKGkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGkuaW50\nVmFsdWUoKTsKICAgICAgICBpZiAoIWNyZWF0ZSkKICAgICAgICAgICAgcmV0\ndXJuIC0xOwoKICAgICAgICAvLyBub3QgZm91bmQ7IGNyZWF0ZSBhbGlhcwog\nICAgICAgIGkgPSBOdW1iZXJzLnZhbHVlT2YoYWxpYXNTaXplKCkpOwogICAg\nICAgIHJlY29yZFRhYmxlQWxpYXModGFibGUsIGtleSwgaSk7CiAgICAgICAg\ncmV0dXJuIGkuaW50VmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEF0\ndGVtcHQgdG8gZmluZCB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBrZXkuCiAg\nICAgKgogICAgICogQHBhcmFtIGZyb21QYXJlbnQgd2hldGhlciBhIHBhcmVu\ndCBpcyBjaGVja2luZyBpdHMgc3Vic2VsZWN0cwogICAgICogQHBhcmFtIGZy\nb21TdWIgdGhlIHN1YnNlbGVjdCBjaGVja2luZyBpdHMgcGFyZW50CiAgICAg\nKi8KICAgIHByaXZhdGUgSW50ZWdlciBmaW5kQWxpYXMoVGFibGUgdGFibGUs\nIE9iamVjdCBrZXksIGJvb2xlYW4gZnJvbVBhcmVudCwKICAgICAgICBTZWxl\nY3RJbXBsIGZyb21TdWIpIHsKICAgICAgICBJbnRlZ2VyIGFsaWFzID0gbnVs\nbDsKICAgICAgICBpZiAoX2FsaWFzZXMgIT0gbnVsbCkgewogICAgICAgICAg\nICBhbGlhcyA9IChJbnRlZ2VyKSAoKGZyb21QYXJlbnQpID8gX2FsaWFzZXMu\ncmVtb3ZlKGtleSkKICAgICAgICAgICAgICAgIDogX2FsaWFzZXMuZ2V0KGtl\neSkpOwogICAgICAgICAgICBpZiAoYWxpYXMgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaWYgKGZyb21QYXJlbnQpCiAgICAgICAgICAgICAgICAgICAg\nX3RhYmxlcy5yZW1vdmUoYWxpYXMpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGFsaWFzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgh\nZnJvbVBhcmVudCAmJiBfcGFyZW50ICE9IG51bGwpIHsKICAgICAgICAgICAg\nYm9vbGVhbiByZW1vdmVBbGlhc0Zyb21QYXJlbnQgPSBrZXkudG9TdHJpbmco\nKS5pbmRleE9mKCI6IikgIT0gLTE7CiAgICAgICAgICAgIGFsaWFzID0gX3Bh\ncmVudC5maW5kQWxpYXModGFibGUsIGtleSwgcmVtb3ZlQWxpYXNGcm9tUGFy\nZW50LCB0aGlzKTsKICAgICAgICAgICAgaWYgKGFsaWFzICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChyZW1vdmVBbGlhc0Zyb21QYXJlbnQpIHsK\nICAgICAgICAgICAgICAgICAgICByZWNvcmRUYWJsZUFsaWFzKHRhYmxlLCBr\nZXksIGFsaWFzKTsKICAgICAgICAgICAgICAgICAgICBfcmVtb3ZlZEFsaWFz\nRnJvbVBhcmVudC5zZXQoYWxpYXMuaW50VmFsdWUoKSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwp\nIHsKICAgICAgICAgICAgU2VsZWN0SW1wbCBzdWI7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHN1YiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQo\naSk7CiAgICAgICAgICAgICAgICBpZiAoc3ViID09IGZyb21TdWIpCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAo\nYWxpYXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChzdWIu\nX2FsaWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgc3Vi\nLl9hbGlhc2VzLnJlbW92ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChzdWIuX3RhYmxlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBzdWIuX3RhYmxlcy5yZW1vdmUoYWxpYXMpOwogICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5IGluc3RhbmNl\nb2YgU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFzID0g\nc3ViLmZpbmRBbGlhcyh0YWJsZSwga2V5LCB0cnVlLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKCFmcm9tUGFyZW50ICYmIGFsaWFzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRUYWJs\nZUFsaWFzKHRhYmxlLCBrZXksIGFsaWFzKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVjb3JkIHRoZSBtYXBwaW5nIG9mIHRoZSBnaXZlbiBrZXkgdG8gdGhlIGdp\ndmVuIGFsaWFzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVjb3JkVGFi\nbGVBbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtleSwgSW50ZWdlciBhbGlh\ncykgewogICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxsKQogICAgICAgICAg\nICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2FsaWFzZXMu\ncHV0KGtleSwgYWxpYXMpOwoKICAgICAgICBTdHJpbmcgdGFibGVTdHJpbmcg\nPSBfZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpICsgIiAiCiAgICAg\nICAgICAgICsgdG9BbGlhcyhhbGlhcy5pbnRWYWx1ZSgpKTsKICAgICAgICBp\nZiAoX3RhYmxlcyA9PSBudWxsKQogICAgICAgICAgICBfdGFibGVzID0gbmV3\nIFRyZWVNYXAoKTsKICAgICAgICBfdGFibGVzLnB1dChhbGlhcywgdGFibGVT\ndHJpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHRvdGFs\nIG51bWJlciBvZiBhbGlhc2VzLgogICAgICovCiAgICBwcml2YXRlIGludCBh\nbGlhc1NpemUoKSB7CiAgICAgICAgcmV0dXJuIGFsaWFzU2l6ZShmYWxzZSwg\nbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdG90YWwg\nbnVtYmVyIG9mIGFsaWFzZXMuCiAgICAgKgogICAgICogQHBhcmFtIGZyb21Q\nYXJlbnQgd2hldGhlciBhIHBhcmVudCBpcyBjaGVja2luZyBpdHMgc3Vic2Vs\nZWN0cwogICAgICogQHBhcmFtIGZyb21TdWIgdGhlIHN1YnNlbGVjdCBjaGVj\na2luZyBpdHMgcGFyZW50CiAgICAgKi8KICAgIHByaXZhdGUgaW50IGFsaWFz\nU2l6ZShib29sZWFuIGZyb21QYXJlbnQsIFNlbGVjdEltcGwgZnJvbVN1Yikg\newogICAgICAgIGludCBhbGlhc2VzID0gKGZyb21QYXJlbnQgfHwgX3BhcmVu\ndCA9PSBudWxsKSA/IDAKICAgICAgICAgICAgOiBfcGFyZW50LmFsaWFzU2l6\nZShmYWxzZSwgdGhpcyk7CiAgICAgICAgYWxpYXNlcyArPSAoX2FsaWFzZXMg\nPT0gbnVsbCkgPyAwIDogX2FsaWFzZXMuc2l6ZSgpOwogICAgICAgIGlmIChf\nc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAgIFNlbGVjdEltcGwgc3Vi\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9zdWJzZWxzLnNp\nemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdWIgPSAoU2VsZWN0SW1w\nbCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAgICAgICAgaWYgKHN1YiAh\nPSBmcm9tU3ViKQogICAgICAgICAgICAgICAgICAgIGFsaWFzZXMgKz0gc3Vi\nLmFsaWFzU2l6ZSh0cnVlLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gYWxpYXNlczsKICAgIH0KCiAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiB0b1NlbGVjdChm\nYWxzZSwgbnVsbCkuZ2V0U1FMKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUGF0aEpvaW5zIGltcGxlbWVudGF0\naW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVi\nbGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRlcihib29sZWFu\nIG91dGVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlz\nKS5zZXRPdXRlcih0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0RpcnR5KCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nQnVmZmVyIHBhdGgoKSB7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgcHVibGljIEpvaW5TZXQgam9pbnMoKSB7CiAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGludCBqb2luQ291\nbnQoKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcHVibGljIHZv\naWQgbnVsbEpvaW5zKCkgewogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVi\nbGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxlLCBUYWJsZSBm\nb3JlaWduVGFibGUpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5z\nKHRoaXMpLmNyb3NzSm9pbihsb2NhbFRhYmxlLCBmb3JlaWduVGFibGUpOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBqb2luKEZvcmVpZ25LZXkgZmssIGJv\nb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICByZXR1\ncm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW4oZmssIGludmVyc2UsIHRv\nTWFueSk7CiAgICB9CgogICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3Jl\naWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5vdXRlckpv\naW4oZmssIGludmVyc2UsIHRvTWFueSk7CiAgICB9CgogICAgcHVibGljIEpv\naW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywg\nQ2xhc3NNYXBwaW5nIHRhcmdldCwKICAgICAgICBpbnQgc3VicywgYm9vbGVh\nbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgIHJldHVybiBu\nZXcgU2VsZWN0Sm9pbnModGhpcykuam9pblJlbGF0aW9uKG5hbWUsIGZrLCB0\nYXJnZXQsIHN1YnMsIAogICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW5SZWxhdGlvbihTdHJp\nbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0\nb01hbnkpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMp\nLm91dGVySm9pblJlbGF0aW9uKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIAog\nICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1Ymxp\nYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgaWYg\nKHZhciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLnNldFZhcmlhYmxlKHZh\ncik7CiAgICB9CgogICAgcHVibGljIEpvaW5zIHNldFN1YnNlbGVjdChTdHJp\nbmcgYWxpYXMpIHsKICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RK\nb2lucyh0aGlzKS5zZXRTdWJzZWxlY3QoYWxpYXMpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVwcmVzZW50cyBhIFNRTCBzdHJpbmcgc2VsZWN0ZWQgd2l0\naCBudWxsIGlkLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBO\ndWxsSWQgewogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIHBs\nYWNlaG9sZGVyIFNRTCBzdHJpbmcuCiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIFBsYWNlaG9sZGVyIHsKICAgIH0KCiAgICAvKioKICAgICAq\nIEtleSB0eXBlIHVzZWQgZm9yIGFsaWFzZXMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIGNsYXNzIEtleSB7CgogICAgICAgIHByaXZhdGUgZmluYWwg\nU3RyaW5nIF9wYXRoOwogICAgICAgIHByaXZhdGUgZmluYWwgT2JqZWN0IF9r\nZXk7CgogICAgICAgIHB1YmxpYyBLZXkoU3RyaW5nIHBhdGgsIE9iamVjdCBr\nZXkpIHsKICAgICAgICAgICAgX3BhdGggPSBwYXRoOwogICAgICAgICAgICBf\na2V5ID0ga2V5OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNo\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9wYXRoLmhhc2hDb2RlKCkg\nXiBfa2V5Lmhhc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgICAgIGlm\nIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIGlmIChvdGhlci5nZXRDbGFzcygpICE9IGdldENsYXNz\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIEtleSBrID0gKEtleSkgb3RoZXI7CiAgICAgICAgICAgIHJldHVybiBrLl9w\nYXRoLmVxdWFscyhfcGF0aCkgJiYgay5fa2V5LmVxdWFscyhfa2V5KTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfcGF0aCArICJ8IiArIF9rZXk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQSB7QGxpbmsgUmVzdWx0fSBpbXBs\nZW1lbnRhdGlvbiB3cmFwcGVkIGFyb3VuZCB0aGlzIHNlbGVjdC4KICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBTZWxlY3RSZXN1bHQKICAgICAg\nICBleHRlbmRzIFJlc3VsdFNldFJlc3VsdAogICAgICAgIGltcGxlbWVudHMg\nUGF0aEpvaW5zIHsKCiAgICAgICAgcHJpdmF0ZSBTZWxlY3RJbXBsIF9zZWwg\nPSBudWxsOwoKICAgICAgICAvLyBwb3NpdGlvbiBpbiBzZWxlY3RlZCBjb2x1\nbW5zIGxpc3Qgd2hlcmUgd2UgZXhwZWN0IHRoZSBuZXh0IGxvYWQKICAgICAg\nICBwcml2YXRlIGludCBfcG9zID0gMDsKICAgICAgICBwcml2YXRlIFN0YWNr\nIF9wcmVKb2lucyA9IG51bGw7CgogICAgICAgIC8qKgogICAgICAgICAqIENv\nbnN0cnVjdG9yLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTZWxlY3RS\nZXN1bHQoQ29ubmVjdGlvbiBjb25uLCBTdGF0ZW1lbnQgc3RtbnQsIFJlc3Vs\ndFNldCBycywKICAgICAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QpIHsKICAg\nICAgICAgICAgc3VwZXIoY29ubiwgc3RtbnQsIHJzLCBkaWN0KTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCBmb3IgdGhpcyBy\nZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIFNlbGVjdEltcGwg\nZ2V0U2VsZWN0KCkgewogICAgICAgICAgICByZXR1cm4gX3NlbDsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCBmb3IgdGhpcyBy\nZXN1bHQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgc2V0U2Vs\nZWN0KFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIF9zZWwgPSBzZWw7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldEVhZ2VyKEZp\nZWxkTWFwcGluZyBrZXkpIHsKICAgICAgICAgICAgLy8gZG9uJ3QgYm90aGVy\nIGNyZWF0aW5nIGtleSBpZiB3ZSBrbm93IHdlIGRvbid0IGhhdmUgYW55CiAg\nICAgICAgICAgIC8vIGVhZ2VyIHJlc3VsdHMKICAgICAgICAgICAgaWYgKF9z\nZWwuX2VhZ2VyID09IG51bGwgfHwgIV9zZWwuX2VhZ2VyS2V5cy5jb250YWlu\ncyhrZXkpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nICAgIE1hcCBtYXAgPSBTZWxlY3RSZXN1bHQudGhpcy5nZXRFYWdlck1hcCh0\ncnVlKTsKICAgICAgICAgICAgaWYgKG1hcCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0\nKF9zZWwudG9FYWdlcktleShrZXksIGdldEpvaW5zKG51bGwpKSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBwdXRFYWdlcihGaWVsZE1hcHBp\nbmcga2V5LCBPYmplY3QgcmVzKSB7CiAgICAgICAgICAgIE1hcCBtYXAgPSBT\nZWxlY3RSZXN1bHQudGhpcy5nZXRFYWdlck1hcCh0cnVlKTsKICAgICAgICAg\nICAgaWYgKG1hcCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBtYXAgPSBu\nZXcgSGFzaE1hcCgpOwogICAgICAgICAgICAgICAgc2V0RWFnZXJNYXAobWFw\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXAucHV0KF9zZWwudG9F\nYWdlcktleShrZXksIGdldEpvaW5zKG51bGwpKSwgcmVzKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBPYmplY3QgbG9hZChDbGFzc01hcHBpbmcgbWFw\ncGluZywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgICAgICBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBKb2lucyBqb2lucykKICAgICAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJvb2xlYW4gaGFz\nSm9pbnMgPSBqb2lucyAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiAoKFBh\ndGhKb2lucykgam9pbnMpLnBhdGgoKSAhPSBudWxsOwogICAgICAgICAgICBp\nZiAoaGFzSm9pbnMpIHsKICAgICAgICAgICAgICAgIGlmIChfcHJlSm9pbnMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcHJlSm9pbnMgPSBuZXcg\nU3RhY2soKTsKICAgICAgICAgICAgICAgIF9wcmVKb2lucy5wdXNoKGpvaW5z\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgT2JqZWN0IG9iaiA9IHN1\ncGVyLmxvYWQobWFwcGluZywgc3RvcmUsIGZldGNoLCBqb2lucyk7CgogICAg\nICAgICAgICAvLyByZXNldAogICAgICAgICAgICBpZiAoaGFzSm9pbnMpCiAg\nICAgICAgICAgICAgICBfcHJlSm9pbnMucG9wKCk7CiAgICAgICAgICAgIHJl\ndHVybiBvYmo7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgbmV3\nSm9pbnMoKSB7CiAgICAgICAgICAgIFBhdGhKb2lucyBwcmUgPSBnZXRQcmVK\nb2lucygpOwogICAgICAgICAgICBpZiAocHJlID09IG51bGwgfHwgcHJlLnBh\ndGgoKSA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7Cgog\nICAgICAgICAgICBQYXRoSm9pbnNJbXBsIHBqID0gbmV3IFBhdGhKb2luc0lt\ncGwoKTsKICAgICAgICAgICAgcGoucGF0aCA9IG5ldyBTdHJpbmdCdWZmZXIo\ncHJlLnBhdGgoKS50b1N0cmluZygpKTsKICAgICAgICAgICAgcmV0dXJuIHBq\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gY29udGFp\nbnNJbnRlcm5hbChPYmplY3Qgb2JqLCBKb2lucyBqb2lucykgewogICAgICAg\nICAgICAvLyB3ZSBrZXkgZGlyZWN0bHkgb24gb2JqcyBhbmQgam9pbi1sZXNz\nIGNvbHMsIG9yIG9uIHRoZSBhbGlhcwogICAgICAgICAgICAvLyBmb3IgY29s\ncyB3aXRoIGpvaW5zCiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpv\naW5zKGpvaW5zKTsKICAgICAgICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGou\ncGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICBvYmogPSBnZXRDb2x1\nbW5BbGlhcygoQ29sdW1uKSBvYmosIHBqKTsKICAgICAgICAgICAgcmV0dXJu\nIG9iaiAhPSBudWxsICYmIF9zZWwuX3NlbGVjdHMuY29udGFpbnMob2JqKTsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIGNvbnRhaW5z\nQWxsSW50ZXJuYWwoT2JqZWN0W10gb2JqcywgSm9pbnMgam9pbnMpCiAgICAg\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBQYXRo\nSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucyk7CiAgICAgICAgICAgIE9iamVj\ndCBvYmo7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgb2Jqcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBqICE9IG51bGwg\nJiYgcGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgb2Jq\nID0gZ2V0Q29sdW1uQWxpYXMoKENvbHVtbikgb2Jqc1tpXSwgcGopOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIG9iaiA9IG9i\nanNbaV07CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51bGwgfHwgIV9z\nZWwuX3NlbGVjdHMuY29udGFpbnMob2JqKSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBwdXNo\nQmFjaygpCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgICAgICBfcG9zID0gMDsKICAgICAgICAgICAgc3VwZXIucHVzaEJhY2so\nKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBib29sZWFuIGFic29s\ndXRlSW50ZXJuYWwoaW50IHJvdykKICAgICAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIF9wb3MgPSAwOwogICAgICAgICAgICBy\nZXR1cm4gc3VwZXIuYWJzb2x1dGVJbnRlcm5hbChyb3cpOwogICAgICAgIH0K\nCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gbmV4dEludGVybmFsKCkKICAg\nICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9w\nb3MgPSAwOwogICAgICAgICAgICByZXR1cm4gc3VwZXIubmV4dEludGVybmFs\nKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgaW50IGZpbmRPYmpl\nY3QoT2JqZWN0IG9iaiwgSm9pbnMgam9pbnMpCiAgICAgICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoX3BvcyA9PSBfc2Vs\nLl9zZWxlY3RzLnNpemUoKSkKICAgICAgICAgICAgICAgIF9wb3MgPSAwOwoK\nICAgICAgICAgICAgLy8gd2Uga2V5IGRpcmVjdGx5IG9uIG9ianMgYW5kIGpv\naW4tbGVzcyBjb2xzLCBvciBvbiB0aGUgYWxpYXMKICAgICAgICAgICAgLy8g\nZm9yIGNvbHMgd2l0aCBqb2lucwogICAgICAgICAgICBQYXRoSm9pbnMgcGog\nPSBnZXRKb2lucyhqb2lucyk7CiAgICAgICAgICAgIEJvb2xlYW4gcGsgPSBu\ndWxsOwogICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29sdW1uIGNvbCA9IChDb2x1\nbW4pIG9iajsKICAgICAgICAgICAgICAgIHBrID0gKGNvbC5pc1ByaW1hcnlL\nZXkoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICAgICAgb2JqID0gZ2V0Q29sdW1uQWxpYXMoY29sLCBwaik7CiAgICAg\nICAgICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihjb2wuZ2V0VGFibGUoKSArICI6\nICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBwai5wYXRoKCkgKyAiICgi\nICsgX3NlbC5fYWxpYXNlcyArICIpIik7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHdlIGxvYWQgaW4gdGhlIHNhbWUgb3JkZXIgd2Ugc2VsZWN0\nLCBtb3JlIG9yIGxlc3MuLi4KICAgICAgICAgICAgaWYgKF9zZWwuX3NlbGVj\ndHMuZ2V0KF9wb3MpLmVxdWFscyhvYmopKQogICAgICAgICAgICAgICAgcmV0\ndXJuICsrX3BvczsKCiAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGxvb2tpbmcg\nZm9yIGEgcHJpbWFyeSBrZXksIHRyeSBiYWNrIGEgY291cGxlIHBsYWNlcywK\nICAgICAgICAgICAgLy8gc2luY2UgcGtzIG1pZ2h0IGJlIHNlbGVjdGVkIGlu\nIGEgc2xpZ2h0bHkgZGlmZmVyZW50IG9yZGVyIHRoYW4KICAgICAgICAgICAg\nLy8gdGhleSBhcmUgbG9hZGVkIGJhY2s7IGRvbid0IGNoYW5nZSB0aGUgbWFy\na2VyIHBvc2l0aW9uCiAgICAgICAgICAgIGlmIChwayA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcGsgPSAob2JqIGluc3RhbmNlb2YgQ29sdW1uICYmICgo\nQ29sdW1uKSBvYmopLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAg\nICAgID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgaWYgKHBrLmJvb2xlYW5WYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gX3BvcyAtIDE7IGkgPj0gMCAmJiBpID49IF9wb3MgLSAz\nOyBpLS0pCiAgICAgICAgICAgICAgICAgICAgaWYgKF9zZWwuX3NlbGVjdHMu\nZ2V0KGkpLmVxdWFscyhvYmopKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gaSArIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHNl\nYXJjaCBmb3J3YXJkIG9uIHRoZSBhc3N1bXB0aW9uIHRoYXQgd2UgbWlnaHQg\nYmUgc2tpcHBpbmcKICAgICAgICAgICAgLy8gc2VsZWN0cyBmb3Igc2libGlu\nZyBjbGFzc2VzOyBhZHZhbmNlIHRoZSBwb3NpdGlvbiBpZiB3ZSBmaW5kCiAg\nICAgICAgICAgIC8vIHNvbWV0aGluZyBmb3J3YXJkCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSBfcG9zICsgMTsgaSA8IF9zZWwuX3NlbGVjdHMuc2l6ZSgp\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdl\ndChpKS5lcXVhbHMob2JqKSkgewogICAgICAgICAgICAgICAgICAgIF9wb3Mg\nPSBpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiArK19wb3M7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1h\neWJlIHRoZSBjb2x1bW4gd2FzIHNlbGVjdGVkIGJ5IDIgZGlmZmVyZW50IG1h\ncHBpbmdzLCBzbyBpdCdzCiAgICAgICAgICAgIC8vIHNvbWV3aGVyZSBwcmlv\nciB0byB0aGUgY3VycmVudCBwb3NpdGlvbjsgaW4gdGhpcyBjYXNlIGxlYXZl\nIHRoZQogICAgICAgICAgICAvLyBwb3NpdGlvbiBtYXJrZXIgYXQgaXRzIGN1\ncnJlbnQgcGxhY2UgY2F1c2Ugc3Vic2VxdWVudCBsb2FkcyB3aWxsCiAgICAg\nICAgICAgIC8vIHN0aWxsIHByb2JhYmx5IHN0YXJ0IGZyb20gdGhlcmUKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfcG9zOyBpKyspCiAgICAg\nICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0cy5nZXQoaSkuZXF1YWxzKG9i\naikpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkgKyAxOwoKICAgICAg\nICAgICAgLy8gc29tZXRoaW5ncydzIHdyb25nLi4uCiAgICAgICAgICAgIHRo\ncm93IG5ldyBTUUxFeGNlcHRpb24ob2JqLnRvU3RyaW5nKCkpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIHRoZSBqb2lucyB0\nbyB1c2UgdG8gZmluZCBjb2x1bW4gZGF0YS4KICAgICAgICAgKi8KICAgICAg\nICBwcml2YXRlIFBhdGhKb2lucyBnZXRKb2lucyhKb2lucyBqb2lucykgewog\nICAgICAgICAgICBQYXRoSm9pbnMgcGogPSAoUGF0aEpvaW5zKSBqb2luczsK\nICAgICAgICAgICAgaWYgKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gcGo7CiAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVKb2lucygpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogUmV0dXJuIHRoZSBwcmUgam9pbnMgZm9yIHRoZSByZXN1bHQs\nIG9yIG51bGwgaWYgbm9uZS4gTm90ZSB0aGF0CiAgICAgICAgICogd2UgaGF2\nZSB0byB0YWtlIHRoZSBTZWxlY3QncyBwcmUgam9pbnMgaW50byBhY2NvdW50\nIHRvbywgc2luY2UKICAgICAgICAgKiBiYXRjaGVkIHNlbGVjdHMgY2FuIGhh\ndmUgYWRkaXRpb25hbCBwcmUgam9pbnMgb24gdGhlIHN0YWNrIGV2ZW4KICAg\nICAgICAgKiBvbiBleGVjdXRpb24uCiAgICAgICAgICovCiAgICAgICAgcHJp\ndmF0ZSBQYXRoSm9pbnMgZ2V0UHJlSm9pbnMoKSB7CiAgICAgICAgICAgIGlm\nIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiAoUGF0aEpvaW5zKSBfcHJlSm9pbnMu\ncGVlaygpOwogICAgICAgICAgICBpZiAoX3NlbC5fcHJlSm9pbnMgIT0gbnVs\nbCAmJiAhX3NlbC5fcHJlSm9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIChQYXRoSm9pbnMpIF9zZWwuX3ByZUpvaW5zLnBlZWsoKTsK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGFsaWFzIHVzZWQgdG8ga2V5IG9u\nIHRoZSBjb2x1bW4gZGF0YSwgY29uc2lkZXJpbmcgdGhlCiAgICAgICAgICog\nZ2l2ZW4gam9pbnMuCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBTdHJp\nbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCwgUGF0aEpvaW5zIHBqKSB7\nCiAgICAgICAgICAgIFN0cmluZyBhbGlhczsKICAgICAgICAgICAgaWYgKF9z\nZWwuX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgYWxpYXMgPSBf\nc2VsLnRvQWxpYXMoX3NlbC5fZnJvbS5nZXRUYWJsZUluZGV4CiAgICAgICAg\nICAgICAgICAgICAgKGNvbC5nZXRUYWJsZSgpLCBwaiwgZmFsc2UpKTsKICAg\nICAgICAgICAgICAgIGlmIChhbGlhcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgaWYgKF9zZWwu\nX2RpY3QucmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gRlJPTV9TRUxFQ1RfQUxJQVMgKyAiLiIgKyBhbGlh\ncyArICJfIiArIGNvbDsKICAgICAgICAgICAgICAgIHJldHVybiBhbGlhcyAr\nICJfIiArIGNvbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBhbGlhcyA9\nIF9zZWwudG9BbGlhcyhfc2VsLmdldFRhYmxlSW5kZXgoY29sLmdldFRhYmxl\nKCksIHBqLCBmYWxzZSkpOwogICAgICAgICAgICByZXR1cm4gKGFsaWFzID09\nIG51bGwpID8gbnVsbCA6IGFsaWFzICsgIi4iICsgY29sOwogICAgICAgIH0K\nCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAg\nIC8vIFBhdGhKb2lucyBpbXBsZW1lbnRhdGlvbgogICAgICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNPdXRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRlcihib29sZWFu\nIG91dGVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0eSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0\ncmluZ0J1ZmZlciBwYXRoKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkgewog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gMDsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHkoKSB7\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxlLCBUYWJs\nZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWduS2V5\nIGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVy\nc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW5SZWxhdGlv\nbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUGF0\naEpvaW5zSW1wbCgpLmpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0LCBz\ndWJzLCAKICAgICAgICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRpb24o\nU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAgICAgICAgIENsYXNz\nTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2UsIGJv\nb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUGF0aEpv\naW5zSW1wbCgpLm91dGVySm9pblJlbGF0aW9uKG5hbWUsIGZrLCB0YXJnZXQs\nIHN1YnMsCiAgICAgICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldFZhcmlhYmxlKFN0cmlu\nZyB2YXIpIHsKICAgICAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nUGF0aEpvaW5zSW1wbCgpLnNldFZhcmlhYmxlKHZhcik7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmluZyBhbGlh\ncykgewogICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICByZXR1cm4gbmV3IFBh\ndGhKb2luc0ltcGwoKS5zZXRTdWJzZWxlY3QoYWxpYXMpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEJhc2Ugam9pbnMgaW1wbGVtZW50YXRp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFBhdGhKb2lu\nc0ltcGwKICAgICAgICBpbXBsZW1lbnRzIFBhdGhKb2lucyB7CgogICAgICAg\nIHByb3RlY3RlZCBTdHJpbmdCdWZmZXIgcGF0aCA9IG51bGw7CiAgICAgICAg\ncHJvdGVjdGVkIFN0cmluZyB2YXIgPSBudWxsOwoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVy\nKGJvb2xlYW4gb3V0ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewog\nICAgICAgICAgICByZXR1cm4gdmFyICE9IG51bGwgfHwgcGF0aCAhPSBudWxs\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZ0J1ZmZlciBwYXRo\nKCkgewogICAgICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkgewogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgam9pbkNv\ndW50KCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBKb2lucyBzZXRWYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAg\nICAgICAgICAgIHRoaXMudmFyID0gdmFyOwogICAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBzZXRTdWJz\nZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgICAgIGlmICghYWxpYXMu\nZW5kc1dpdGgoIjoiKSkKICAgICAgICAgICAgICAgIGFsaWFzICs9ICc6JzsK\nICAgICAgICAgICAgYXBwZW5kKGFsaWFzKTsKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Vt\ncHR5KCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxUYWJs\nZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgICAgIGFwcGVuZCh2\nYXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBqb2lu\nKEZvcmVpZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01h\nbnkpIHsKICAgICAgICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZh\nciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZr\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2YXIgPSBudWxsOwogICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkg\nZmssIAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3Vi\ncywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAg\nICAgICBhcHBlbmQobmFtZSk7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwog\nICAgICAgICAgICB2YXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBvdXRlckpvaW5S\nZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywKICAgICAgICAg\nICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMsIGJvb2xlYW4gaW52\nZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAgICAgYXBwZW5kKG5h\nbWUpOwogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAgICAgICAgdmFy\nID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgdm9pZCBhcHBlbmQoU3RyaW5nIHN0cikgewog\nICAgICAgICAgICBpZiAoc3RyICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGlmIChwYXRoID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcGF0aCA9\nIG5ldyBTdHJpbmdCdWZmZXIoc3RyKTsKICAgICAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgICAgICBwYXRoLmFwcGVuZCgnLicpLmFwcGVuZChz\ndHIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gIlBhdGhK\nb2luc0ltcGw8IiArIGhhc2hDb2RlKCkgKyAiPjogIgogICAgICAgICAgICAg\nICAgKyBTdHJpbmcudmFsdWVPZihwYXRoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBKb2lucyBpbXBsZW1lbnRhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgU2VsZWN0Sm9pbnMKICAgICAgICBl\neHRlbmRzIFBhdGhKb2luc0ltcGwgCiAgICAgICAgaW1wbGVtZW50cyBDbG9u\nZWFibGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFNlbGVjdEltcGwgX3Nl\nbDsKICAgICAgICBwcml2YXRlIEpvaW5TZXQgX2pvaW5zID0gbnVsbDsKICAg\nICAgICBwcml2YXRlIGJvb2xlYW4gX291dGVyID0gZmFsc2U7CiAgICAgICAg\ncHJpdmF0ZSBpbnQgX2NvdW50ID0gMDsKCiAgICAgICAgcHVibGljIFNlbGVj\ndEpvaW5zKFNlbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIF9zZWwgPSBz\nZWw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091dGVy\nKCkgewogICAgICAgICAgICByZXR1cm4gX291dGVyOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIFBhdGhKb2lucyBzZXRPdXRlcihib29sZWFuIG91dGVy\nKSB7CiAgICAgICAgICAgIF9vdXRlciA9IG91dGVyOwogICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIGlzRGlydHkoKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5pc0RpcnR5\nKCkgfHwgIWlzRW1wdHkoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBK\nb2luU2V0IGpvaW5zKCkgewogICAgICAgICAgICByZXR1cm4gX2pvaW5zOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc2V0Sm9pbnMoSm9pblNl\ndCBqb2lucykgewogICAgICAgICAgICBfam9pbnMgPSBqb2luczsKICAgICAg\nICAgICAgX291dGVyID0gam9pbnMgIT0gbnVsbCAmJiBqb2lucy5sYXN0KCkg\nIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgam9pbnMubGFzdCgpLmdldFR5\ncGUoKSA9PSBKb2luLlRZUEVfT1VURVI7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAgICAgICAgICAgaWYgKF9qb2lu\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIF9jb3VudDsKICAg\nICAgICAgICAgcmV0dXJuIE1hdGgubWF4KF9jb3VudCwgX2pvaW5zLnNpemUo\nKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBudWxsSm9pbnMo\nKSB7CiAgICAgICAgICAgIGlmIChfam9pbnMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9jb3VudCA9IE1hdGgubWF4KF9jb3VudCwgX2pvaW5zLnNpemUo\nKSk7CiAgICAgICAgICAgIF9qb2lucyA9IG51bGw7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAgICBy\nZXR1cm4gX2pvaW5zID09IG51bGwgfHwgX2pvaW5zLmlzRW1wdHkoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUg\nbG9jYWxUYWJsZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgICAg\nIC8vIGNyb3NzIGpvaW5zIGFyZSBmb3IgdW5ib3VuZCB2YXJpYWJsZXM7IHVu\nZm9ydHVuYXRlbHkgd2UgaGF2ZQogICAgICAgICAgICAvLyB0byBhbHdheXMg\nZ28gRElTVElOQ1QgZm9yIHVuYm91bmQgdmFycyBiZWNhdXNlIHRoZXJlIGFy\nZSBjZXJ0YWluCiAgICAgICAgICAgIC8vIGNhc2VzIHRoYXQgcmVxdWlyZSBp\ndCwgYW5kIHdlIGNhbid0IGRpZmZlcmVudGlhdGUgdGhlbSBmcm9tIHRoZQog\nICAgICAgICAgICAvLyBjYXNlcyB0aGF0IGRvbid0CiAgICAgICAgICAgIF9z\nZWwuX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwoKICAgICAgICAgICAg\naWYgKF9zZWwuZ2V0Sm9pblN5bnRheCgpICE9IEpvaW5TeW50YXhlcy5TWU5U\nQVhfU1FMOTIKICAgICAgICAgICAgICAgIHx8IF9zZWwuX2Zyb20gIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgLy8gZG9uJ3QgbWFrZSBhbnkgam9pbnMs\nIGJ1dCB1cGRhdGUgdGhlIHBhdGggaWYgYSB2YXJpYWJsZQogICAgICAgICAg\nICAgICAgLy8gaGFzIGJlZW4gc2V0CiAgICAgICAgICAgICAgICB0aGlzLmFw\ncGVuZCh0aGlzLnZhcik7CiAgICAgICAgICAgICAgICB0aGlzLnZhciA9IG51\nbGw7CiAgICAgICAgICAgICAgICBfb3V0ZXIgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBkb24ndCBsZXQgdGhlIGdldCBhbGlhcyBtZXRob2RzIHNlZSB0aGF0\nIGEgdmFyIGhhcyBiZWVuIHNldAogICAgICAgICAgICAvLyB1bnRpbCB3ZSBn\nZXQgcGFzdCB0aGUgbG9jYWwgdGFibGUKICAgICAgICAgICAgU3RyaW5nIHZh\nciA9IHRoaXMudmFyOwogICAgICAgICAgICB0aGlzLnZhciA9IG51bGw7Cgog\nICAgICAgICAgICBpbnQgYWxpYXMxID0gX3NlbC5nZXRUYWJsZUluZGV4KGxv\nY2FsVGFibGUsIHRoaXMsIHRydWUpOwogICAgICAgICAgICB0aGlzLmFwcGVu\nZCh2YXIpOwogICAgICAgICAgICBpbnQgYWxpYXMyID0gX3NlbC5nZXRUYWJs\nZUluZGV4KGZvcmVpZ25UYWJsZSwgdGhpcywgdHJ1ZSk7CiAgICAgICAgICAg\nIEpvaW4gaiA9IG5ldyBKb2luKGxvY2FsVGFibGUsIGFsaWFzMSwgZm9yZWln\nblRhYmxlLCBhbGlhczIsCiAgICAgICAgICAgICAgICBudWxsLCBmYWxzZSk7\nCiAgICAgICAgICAgIGouc2V0VHlwZShKb2luLlRZUEVfQ1JPU1MpOwoKICAg\nICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nX2pvaW5zID0gbmV3IEpvaW5TZXQoKTsKICAgICAgICAgICAgX2pvaW5zLmFk\nZChqKTsKICAgICAgICAgICAgX291dGVyID0gZmFsc2U7CiAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5z\nIGpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFu\nIHRvTWFueSkgewogICAgICAgICAgICByZXR1cm4gam9pbihudWxsLCBmaywg\nbnVsbCwgLTEsIGludmVyc2UsIHRvTWFueSwgZmFsc2UpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZr\nLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAg\nICAgIHJldHVybiBqb2luKG51bGwsIGZrLCBudWxsLCAtMSwgaW52ZXJzZSwg\ndG9NYW55LCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAog\nICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9v\nbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBy\nZXR1cm4gam9pbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCBpbnZlcnNlLCB0\nb01hbnksIGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2lu\ncyBvdXRlckpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBm\naywKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIHRhcmdldCwgaW50IHN1YnMs\nIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAgICAg\nICAgcmV0dXJuIGpvaW4obmFtZSwgZmssIHRhcmdldCwgc3VicywgaW52ZXJz\nZSwgdG9NYW55LCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nSm9pbnMgam9pbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgQ2xhc3NN\nYXBwaW5nIHRhcmdldCwKICAgICAgICAgICAgaW50IHN1YnMsIGJvb2xlYW4g\naW52ZXJzZSwgYm9vbGVhbiB0b01hbnksIGJvb2xlYW4gb3V0ZXIpIHsKICAg\nICAgICAgICAgLy8gZG9uJ3QgbGV0IHRoZSBnZXQgYWxpYXMgbWV0aG9kcyBz\nZWUgdGhhdCBhIHZhciBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgLy8gdW50\naWwgd2UgZ2V0IHBhc3QgdGhlIGxvY2FsIHRhYmxlCiAgICAgICAgICAgIFN0\ncmluZyB2YXIgPSB0aGlzLnZhcjsKICAgICAgICAgICAgdGhpcy52YXIgPSBu\ndWxsOwoKICAgICAgICAgICAgLy8gZ2V0IGZpcnN0IHRhYmxlIGFsaWFzIGJl\nZm9yZSB1cGRhdGluZyBwYXRoOyBpZiB0aGVyZSBpcyBhIGZyb20KICAgICAg\nICAgICAgLy8gc2VsZWN0IHRoZW4gd2Ugc2hvdWxkbid0IGFjdHVhbGx5IGNy\nZWF0ZSBhIGpvaW4gb2JqZWN0LCBzaW5jZQogICAgICAgICAgICAvLyB0aGUg\nam9pbnMgd2lsbCBhbGwgYmUgZG9uZSBpbiB0aGUgZnJvbSBzZWxlY3QKICAg\nICAgICAgICAgYm9vbGVhbiBjcmVhdGVKb2luID0gX3NlbC5fZnJvbSA9PSBu\ndWxsOwogICAgICAgICAgICBUYWJsZSB0YWJsZTEgPSBudWxsOwogICAgICAg\nICAgICBpbnQgYWxpYXMxID0gLTE7CiAgICAgICAgICAgIGlmIChjcmVhdGVK\nb2luKSB7CiAgICAgICAgICAgICAgICB0YWJsZTEgPSAoaW52ZXJzZSkgPyBm\nay5nZXRQcmltYXJ5S2V5VGFibGUoKSA6IGZrLmdldFRhYmxlKCk7CiAgICAg\nICAgICAgICAgICBhbGlhczEgPSBfc2VsLmdldFRhYmxlSW5kZXgodGFibGUx\nLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\ndXBkYXRlIHRoZSBwYXRoIHdpdGggdGhlIHJlbGF0aW9uIG5hbWUgYmVmb3Jl\nIGdldHRpbmcgcGsgYWxpYXMKICAgICAgICAgICAgdGhpcy5hcHBlbmQobmFt\nZSk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kKHZhcik7CiAgICAgICAgICAg\nIGlmICh0b01hbnkpIHsKICAgICAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9\nIElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAgICAgICAgICAgX3NlbC5fZmxh\nZ3MgfD0gVE9fTUFOWTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfb3V0\nZXIgPSBvdXRlcjsKCiAgICAgICAgICAgIGlmIChjcmVhdGVKb2luKSB7CiAg\nICAgICAgICAgICAgICBUYWJsZSB0YWJsZTIgPSAoaW52ZXJzZSkgPyBmay5n\nZXRUYWJsZSgpIAogICAgICAgICAgICAgICAgICAgIDogZmsuZ2V0UHJpbWFy\neUtleVRhYmxlKCk7CiAgICAgICAgICAgICAgICBpbnQgYWxpYXMyID0gX3Nl\nbC5nZXRUYWJsZUluZGV4KHRhYmxlMiwgdGhpcywgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICBKb2luIGogPSBuZXcgSm9pbih0YWJsZTEsIGFsaWFzMSwgdGFi\nbGUyLCBhbGlhczIsIGZrLCBpbnZlcnNlKTsKICAgICAgICAgICAgICAgIGou\nc2V0VHlwZSgob3V0ZXIpID8gSm9pbi5UWVBFX09VVEVSIDogSm9pbi5UWVBF\nX0lOTkVSKTsKCiAgICAgICAgICAgICAgICBpZiAoX2pvaW5zID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgX2pvaW5zID0gbmV3IEpvaW5TZXQoKTsK\nICAgICAgICAgICAgICAgIGlmIChfam9pbnMuYWRkKGopICYmIChzdWJzID09\nIFNlbGVjdC5TVUJTX0pPSU5BQkxFIAogICAgICAgICAgICAgICAgICAgIHx8\nIHN1YnMgPT0gU2VsZWN0LlNVQlNfTk9ORSkpCiAgICAgICAgICAgICAgICAg\nICAgai5zZXRSZWxhdGlvbih0YXJnZXQsIHN1YnMsIGNsb25lKF9zZWwpKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBTZWxlY3RKb2lucyBjbG9uZShTZWxlY3RJ\nbXBsIHNlbCkgewogICAgICAgICAgICBTZWxlY3RKb2lucyBzaiA9IG5ldyBT\nZWxlY3RKb2lucyhzZWwpOwogICAgICAgICAgICBzai52YXIgPSB2YXI7CiAg\nICAgICAgICAgIGlmIChwYXRoICE9IG51bGwpCiAgICAgICAgICAgICAgICBz\nai5wYXRoID0gbmV3IFN0cmluZ0J1ZmZlcihwYXRoLnRvU3RyaW5nKCkpOwog\nICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwgJiYgIV9qb2lucy5pc0Vt\ncHR5KCkpCiAgICAgICAgICAgICAgICBzai5fam9pbnMgPSBuZXcgSm9pblNl\ndChfam9pbnMpOwogICAgICAgICAgICBzai5fb3V0ZXIgPSBfb3V0ZXI7CiAg\nICAgICAgICAgIHJldHVybiBzajsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBl\nci50b1N0cmluZygpICsgIiAoIiArIF9vdXRlciArICIpOiAiICsgX2pvaW5z\nOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJvdGVjdGVkIFNlbGVjdHMg\nbmV3U2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVjdHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBjbGFzcyB0byB0cmFjayBz\nZWxlY3RlZCBjb2x1bW5zLCB3aXRoIGZhc3QgY29udGFpbnMgbWV0aG9kLgog\nICAgICogQWN0cyBhcyBhIGxpc3Qgb2Ygc2VsZWN0IGlkcywgd2l0aCBhZGRp\ndGlvbmFsIG1ldGhvZHMgdG8gbWFuaXB1bGF0ZQogICAgICogdGhlIGFsaWFz\nIG9mIGVhY2ggc2VsZWN0ZWQgaWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBz\ndGF0aWMgY2xhc3MgU2VsZWN0cwogICAgICAgIGV4dGVuZHMgQWJzdHJhY3RM\naXN0IHsKCiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lkcyA9IG51bGw7CiAg\nICAgICAgcHJvdGVjdGVkIExpc3QgX2lkZW50cyA9IG51bGw7CiAgICAgICAg\ncHJvdGVjdGVkIE1hcCBfYWxpYXNlcyA9IG51bGw7CiAgICAgICAgcHJvdGVj\ndGVkIE1hcCBfc2VsZWN0QXMgPSBudWxsOwogICAgICAgIHByb3RlY3RlZCBE\nQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxsOwoKICAgICAgICAvKioKICAgICAg\nICAgKiBBZGQgYWxsIGFsaWFzZXMgZnJvbSBhbm90aGVyIGluc3RhbmNlLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZEFsbChTZWxlY3Rz\nIHNlbHMpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCAmJiBzZWxz\nLl9pZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9pZHMgPSBuZXcgQXJy\nYXlMaXN0KHNlbHMuX2lkcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbHMu\nX2lkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2lkcy5hZGRBbGwoc2Vs\ncy5faWRzKTsKCiAgICAgICAgICAgIGlmIChfaWRlbnRzID09IG51bGwgJiYg\nc2Vscy5faWRlbnRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfaWRlbnRz\nID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZGVudHMpOwogICAgICAgICAgICBl\nbHNlIGlmIChzZWxzLl9pZGVudHMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9pZGVudHMuYWRkQWxsKHNlbHMuX2lkZW50cyk7CgogICAgICAgICAgICBp\nZiAoX2FsaWFzZXMgPT0gbnVsbCAmJiBzZWxzLl9hbGlhc2VzICE9IG51bGwp\nCiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKHNlbHMu\nX2FsaWFzZXMpOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9hbGlhc2Vz\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNlcy5wdXRBbGwoc2Vs\ncy5fYWxpYXNlcyk7CgogICAgICAgICAgICBpZiAoX3NlbGVjdEFzID09IG51\nbGwgJiYgc2Vscy5fc2VsZWN0QXMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFwKHNlbHMuX3NlbGVjdEFzKTsKICAg\nICAgICAgICAgZWxzZSBpZiAoc2Vscy5fc2VsZWN0QXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zZWxlY3RBcy5wdXRBbGwoc2Vscy5fc2VsZWN0QXMp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJucyB0\naGUgYWxpYXMgb2YgYSBnaXZlbiBpZC4KICAgICAgICAgKi8KICAgICAgICBw\ndWJsaWMgT2JqZWN0IGdldEFsaWFzKE9iamVjdCBpZCkgewogICAgICAgICAg\nICByZXR1cm4gKF9hbGlhc2VzID09IG51bGwpID8gbnVsbCA6IF9hbGlhc2Vz\nLmdldChpZCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBT\nZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4gaWQuCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIGludCBzZXRBbGlhcyhPYmplY3QgaWQsIE9iamVjdCBhbGlh\ncywgYm9vbGVhbiBpZGVudCkgewogICAgICAgICAgICBpZiAoX2lkcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBfaWRzID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFzaE1hcCgpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpbnQgaWR4OwogICAgICAgICAg\nICBpZiAoX2FsaWFzZXMucHV0KGlkLCBhbGlhcykgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGlkeCA9IF9pZHMuaW5kZXhPZihpZCk7CiAgICAgICAgICAg\nIGVsc2UgewogICAgICAgICAgICAgICAgX2lkcy5hZGQoaWQpOwogICAgICAg\nICAgICAgICAgaWR4ID0gX2lkcy5zaXplKCkgLSAxOwoKICAgICAgICAgICAg\nICAgIGlmIChpZGVudCkgewogICAgICAgICAgICAgICAgICAgIGlmIChfaWRl\nbnRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIF9pZGVudHMg\nPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICAgICAgICAgIF9pZGVu\ndHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gaWR4OwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBhIGdpdmVuIGluZGV4Lgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldEFsaWFzKGludCBp\nZHgsIE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBPYmplY3QgaWQgPSBf\naWRzLmdldChpZHgpOwogICAgICAgICAgICBfYWxpYXNlcy5wdXQoaWQsIGFs\naWFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEluc2Vy\ndCBhbiBhbGlhcyBiZWZvcmUgdGhlIGdpdmVuIGluZGV4LCB1c2luZyBuZWdh\ndGl2ZSBpbmRleGVzCiAgICAgICAgICogdG8gY291bnQgYmFja3dhcmRzLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGluc2VydEFsaWFzKGlu\ndCBpZHgsIE9iamVjdCBpZCwgT2JqZWN0IGFsaWFzKSB7CiAgICAgICAgICAg\nIF9hbGlhc2VzLnB1dChpZCwgYWxpYXMpOwogICAgICAgICAgICBpZiAoaWR4\nID49IDApCiAgICAgICAgICAgICAgICBfaWRzLmFkZChpZHgsIGlkKTsKICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkcy5hZGQoX2lkcy5z\naXplKCkgKyBpZHgsIGlkKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIFJldHVybiB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIGFsaWFzLgog\nICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgaW5kZXhPZkFsaWFzKE9i\namVjdCBhbGlhcykgewogICAgICAgICAgICBpZiAoX2FsaWFzZXMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfaWRzLnNpemUoKTsgaSsrKQogICAgICAgICAg\nICAgICAgaWYgKGFsaWFzLmVxdWFscyhfYWxpYXNlcy5nZXQoX2lkcy5nZXQo\naSkpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAg\nICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogQSBsaXN0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBhbGlhc2VzLCBpbiBz\nZWxlY3Qgb3JkZXIsIHdpdGgKICAgICAgICAgKiBBUyBhbGlhc2VzIHByZXNl\nbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIExpc3QgZ2V0QWxpYXNl\ncyhmaW5hbCBib29sZWFuIGlkZW50LCBmaW5hbCBib29sZWFuIGlubmVyKSB7\nCiAgICAgICAgICAgIGlmIChfaWRzID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAgICAgICAg\nIHJldHVybiBuZXcgQWJzdHJhY3RMaXN0KCkgewogICAgICAgICAgICAgICAg\ncHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9pZGVudHMuc2l6ZSgp\nCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5zaXplKCk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVibGljIE9iamVjdCBn\nZXQoaW50IGkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3QgaWQgPSAo\naWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9pZGVudHMuZ2V0KGkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5nZXQoaSk7CiAgICAgICAg\nICAgICAgICAgICAgT2JqZWN0IGFsaWFzID0gX2FsaWFzZXMuZ2V0KGlkKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoaWQgaW5zdGFuY2VvZiBDb2x1bW4g\nJiYgKChDb2x1bW4pIGlkKS5pc1hNTCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBhbGlhcyA9IGFsaWFzICsgX2RpY3QuZ2V0U3RyaW5nVmFsOwogICAg\nICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBTdHJp\nbmcgYXMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChpbm5lcikK\nICAgICAgICAgICAgICAgICAgICAgICAgYXMgPSAoKFN0cmluZykgYWxpYXMp\nLnJlcGxhY2UoJy4nLCAnXycpOwogICAgICAgICAgICAgICAgICAgIGVsc2Ug\naWYgKF9zZWxlY3RBcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgICAg\nICBhcyA9IChTdHJpbmcpIF9zZWxlY3RBcy5nZXQoaWQpOwoKICAgICAgICAg\nICAgICAgICAgICBpZiAoYXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoYWxpYXMgaW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBhbGlhcyA9IG5ldyBTUUxCdWZm\nZXIoKFNRTEJ1ZmZlcikgYWxpYXMpLgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGFwcGVuZCgiIEFTICIpLmFwcGVuZChhcyk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGFsaWFzID0gYWxpYXMgKyAiIEFTICIgKyBhczsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogU2V0IHRoYXQgYSBnaXZlbiBpZCdzIGFs\naWFzIGhhcyBhbiBBUyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgdm9pZCBzZXRTZWxlY3RBcyhPYmplY3QgaWQsIFN0cmluZyBhcykgewog\nICAgICAgICAgICBpZiAoX3NlbGVjdEFzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfc2VsZWN0QXMgPSBuZXcgSGFzaE1hcCgoaW50KSAoNSAqIDEuMzMg\nKyAxKSk7CiAgICAgICAgICAgIF9zZWxlY3RBcy5wdXQoaWQsIGFzKTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENsZWFyIGFsbCBwbGFj\nZWhvbGRlcnMgYW5kIHNlbGVjdCBBUyBjbGF1c2VzLgogICAgICAgICAqLwog\nICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyUGxhY2Vob2xkZXJzKCkgewogICAg\nICAgICAgICBpZiAoX2lkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwoKICAgICAgICAgICAgT2JqZWN0IGlkOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yIGl0ciA9IF9pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgIGlkID0gaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGlmIChpZCBpbnN0YW5jZW9mIFBsYWNlaG9sZGVyKSB7CiAg\nICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICAg\nICAgICAgIF9hbGlhc2VzLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGNvbnRhaW5zKE9iamVjdCBpZCkgewogICAgICAgICAgICByZXR1cm4g\nX2FsaWFzZXMgIT0gbnVsbCAmJiBfYWxpYXNlcy5jb250YWluc0tleShpZCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaSkg\newogICAgICAgICAgICBpZiAoX2lkcyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbigp\nOwogICAgICAgICAgICByZXR1cm4gX2lkcy5nZXQoaSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiAoX2lkcyA9PSBudWxsKSA/IDAgOiBfaWRzLnNpemUoKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgICAgICBf\naWRzID0gbnVsbDsKICAgICAgICAgICAgX2FsaWFzZXMgPSBudWxsOwogICAg\nICAgICAgICBfc2VsZWN0QXMgPSBudWxsOwogICAgICAgICAgICBfaWRlbnRz\nID0gbnVsbDsKICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiBDb21tb24gam9p\nbnMgaW50ZXJmYWNlIHVzZWQgaW50ZXJuYWxseS4gQ2Fubm90IGJlIG1hZGUg\nYW4gaW5uZXIgY2xhc3MKICogYmVjYXVzZSB0aGUgb3V0ZXIgY2xhc3MgKFNl\nbGVjdCkgaGFzIHRvIGltcGxlbWVudCBpdC4KICovCmludGVyZmFjZSBQYXRo\nSm9pbnMKICAgIGV4dGVuZHMgSm9pbnMgewoKICAgIC8qKgogICAgICogTWFy\nayB0aGlzIGFzIGFuIG91dGVyIGpvaW5zIHNldC4KICAgICAqLwogICAgcHVi\nbGljIFBhdGhKb2lucyBzZXRPdXRlcihib29sZWFuIG91dGVyKTsKCiAgICAv\nKioKICAgICAqIFJldHVybiB0cnVlIGlmIHRoaXMgaW5zdGFuY2UgaGFzIGEg\ncGF0aCwgYW55IGpvaW5zLCBvciBhIHZhcmlhYmxlLgogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc0RpcnR5KCk7CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHJlbGF0aW9uIHBhdGggdHJhdmVyc2VkIGJ5IHRoZXNlIGpvaW5z\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdC\ndWZmZXIgcGF0aCgpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQg\nb2Yge0BsaW5rIEpvaW59IGVsZW1lbnRzLCBvciBudWxsIGlmIG5vbmUuCiAg\nICAgKi8KICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCk7CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG1heGltdW0gbnVtYmVyIG9mIGpvaW5zIGNvbnRh\naW5lZCBpbiB0aGlzIGluc3RhbmNlIGF0IGFueQogICAgICogdGltZS4KICAg\nICAqLwogICAgcHVibGljIGludCBqb2luQ291bnQoKTsKCiAgICAvKioKICAg\nICAqIE51bGwgdGhlIHNldCBvZiB7QGxpbmsgSm9pbn0gZWxlbWVudHMuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpOwp9Cgo=\n","encoding":"base64"}

