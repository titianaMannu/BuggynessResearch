{"sha":"793c03e9d86d40cfada2169a4d0e1dbb623ae1a0","node_id":"MDQ6QmxvYjIwNjM2NDo3OTNjMDNlOWQ4NmQ0MGNmYWRhMjE2OWE0ZDBlMWRiYjYyM2FlMWEw","size":179951,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/793c03e9d86d40cfada2169a4d0e1dbb623ae1a0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEuc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuUHJpdmlsZWdlZEFjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwpp\nbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwu\nRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5Mb2NhbGU7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNv\nbmZpZ3VyYXRpb25JbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5jb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi5tZXRhLkNsYXNzQXJnUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLkJ5dGVjb2RlV3JpdGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkZpbGVzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLlNlcnZpY2VzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YVJlcG9zaXRvcnk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdp\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJu\nYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdEZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdJbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\neXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLklkOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuSW50SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5GbG9hdElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nTG9uZ0lkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0\nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TaG9ydElkOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RyaW5nSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkJDRmllbGQ7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDTWV0aG9kOwpp\nbXBvcnQgc2VycC5ieXRlY29kZS5Db2RlOwppbXBvcnQgc2VycC5ieXRlY29k\nZS5Db25zdGFudHM7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkV4Y2VwdGlvbnM7\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkZpZWxkSW5zdHJ1Y3Rpb247CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLkdldEZpZWxkSW5zdHJ1Y3Rpb247CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLklmSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5KdW1wSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkxvYWRJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTWV0aG9kSW5zdHJ1Y3Rpb247Cmlt\ncG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLlRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkNsYXNzSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLnV0aWwuTnVtYmVy\nczsKaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOwoKLyoqCiAqIEJ5dGVjb2Rl\nIGVuaGFuY2VyIHVzZWQgdG8gZW5oYW5jZSBwZXJzaXN0ZW50IGNsYXNzZXMg\nZnJvbSBtZXRhZGF0YS4gVGhlCiAqIGVuaGFuY2VyIG11c3QgYmUgaW52b2tl\nZCBvbiBhbGwgcGVyc2lzdGVuY2UtY2FwYWJsZSBhbmQgcGVyc2lzdGVuY2Ug\nYXdhcmUKICogY2xhc3Nlcy4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICov\nCnB1YmxpYyBjbGFzcyBQQ0VuaGFuY2VyIHsKICAgIC8vIERlc2lnbmF0ZXMg\nYSB2ZXJzaW9uIGZvciBtYWludGFpbmluZyBjb21wYXRiaWxpdHkgd2hlbiBQ\nQ0VuaGFuY2VyCiAgICAvLyBtb2RpZmllcyBlbmhhbmNlbWVudCB0aGF0IGNh\nbiBicmVhayBzZXJpYWxpemF0aW9uIG9yIG90aGVyIGNvbnRyYWN0cwogICAg\nLy8gRWFjaCBlbmhhbmNlZCBjbGFzcyB3aWxsIHJldHVybiB0aGUgdmFsdWUg\nb2YgdGhpcyBmaWVsZCB2aWEKICAgIC8vIHB1YmxpYyBpbnQgZ2V0RW5oYW5j\nZW1lbnRDb250cmFjdFZlcnNpb24oKQogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRVJfVkVSU0lPTiA9IDI7CgogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgRU5IQU5DRV9OT05FID0gMDsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IEVOSEFOQ0VfQVdBUkUgPSAyIDw8IDA7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX0lOVEVSRkFDRSA9IDIgPDwg\nMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VfUEMgPSAy\nIDw8IDI7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgUFJFID0g\nInBjIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIElTREVUQUNI\nRURTVEFURURFRklOSVRJVkUgPSBQUkUgCiAgICAgICAgKyAiaXNEZXRhY2hl\nZFN0YXRlRGVmaW5pdGl2ZSI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nQ2xhc3MgUENUWVBFID0gUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNNID0gUFJFICsgIlN0YXRl\nTWFuYWdlciI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBTTVRZ\nUEUgPSBTdGF0ZU1hbmFnZXIuY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSU5IRVJJVCA9IFBSRSArICJJbmhlcml0ZWRGaWVsZENv\ndW50IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBDT05URVhU\nTkFNRSA9ICJHZW5lcmljQ29udGV4dCI7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBDbGFzcyBVU0VSRVhDRVAgPSBVc2VyRXhjZXB0aW9uLmNsYXNzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgSU5URVJORVhDRVAgPSBJ\nbnRlcm5hbEV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIENsYXNzIEhFTFBFUlRZUEUgPSBQQ1JlZ2lzdHJ5LmNsYXNzOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNVUEVSID0gUFJFICsgIlBD\nU3VwZXJjbGFzcyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBP\nSURGU1RZUEUgPSBGaWVsZFN1cHBsaWVyLmNsYXNzOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgQ2xhc3MgT0lERkNUWVBFID0gRmllbGRDb25zdW1lci5j\nbGFzczsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xv\nYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKFBDRW5oYW5jZXIu\nY2xhc3MpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFJFREVG\nSU5FRF9BVFRSSUJVVEUKICAgICAgICA9IFBDRW5oYW5jZXIuY2xhc3MuZ2V0\nTmFtZSgpICsgIiNyZWRlZmluZWQtdHlwZSI7CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIEF1eGlsaWFyeUVuaGFuY2VyW10gX2F1eEVuaGFuY2Vy\nczsKICAgIHN0YXRpYyB7CiAgICAgICAgQ2xhc3NbXSBjbGFzc2VzID0gU2Vy\ndmljZXMuZ2V0SW1wbGVtZW50b3JDbGFzc2VzKAogICAgICAgICAgICBBdXhp\nbGlhcnlFbmhhbmNlci5jbGFzcywKICAgICAgICAgICAgKENsYXNzTG9hZGVy\nKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKEF1eGls\naWFyeUVuaGFuY2VyLmNsYXNzKSkpOwogICAgICAgIExpc3QgYXV4RW5oYW5j\nZXJzID0gbmV3IEFycmF5TGlzdChjbGFzc2VzLmxlbmd0aCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBjbGFzc2VzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhdXhFbmhhbmNlcnMu\nYWRkKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0luc3RhbmNlQWN0aW9uKGNs\nYXNzZXNbaV0pKSk7CgkJICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7CiAg\nICAgICAgICAgICAgICAvLyBhdXggZW5oYW5jZXIgbWF5IHJlbHkgb24gbm9u\nLWV4aXN0YW50IHNwZWMgY2xhc3NlcywgZXRjCgkJICAgIH0KCQl9CiAgICAJ\nX2F1eEVuaGFuY2VycyA9IChBdXhpbGlhcnlFbmhhbmNlcltdKSBhdXhFbmhh\nbmNlcnMudG9BcnJheQogICAgICAgICAgICAobmV3IEF1eGlsaWFyeUVuaGFu\nY2VyW2F1eEVuaGFuY2Vycy5zaXplKCldKTsKICAgIH0KCiAgICBwcml2YXRl\nIEJDQ2xhc3MgX3BjOwogICAgcHJpdmF0ZSBmaW5hbCBCQ0NsYXNzIF9tYW5h\nZ2VkVHlwZTsKICAgIHByaXZhdGUgZmluYWwgTWV0YURhdGFSZXBvc2l0b3J5\nIF9yZXBvczsKICAgIHByaXZhdGUgZmluYWwgQ2xhc3NNZXRhRGF0YSBfbWV0\nYTsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAgICBwcml2YXRlIENv\nbGxlY3Rpb24gX29pZHMgPSBudWxsOwogICAgcHJpdmF0ZSBib29sZWFuIF9k\nZWZDb25zID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfcmVkZWZpbmUg\nPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfc3ViY2xhc3MgPSBmYWxz\nZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfZmFpbCA9IGZhbHNlOwogICAgcHJp\ndmF0ZSBTZXQgX3Zpb2xhdGlvbnMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWxl\nIF9kaXIgPSBudWxsOwogICAgcHJpdmF0ZSBCeXRlY29kZVdyaXRlciBfd3Jp\ndGVyID0gbnVsbDsKICAgIHByaXZhdGUgTWFwIF9iYWNraW5nRmllbGRzID0g\nbnVsbDsgLy8gbWFwIG9mIHNldCAvIGdldCBuYW1lcyA9PiBmaWVsZCBuYW1l\ncwogICAgcHJpdmF0ZSBNYXAgX2F0dHJzVG9GaWVsZHMgPSBudWxsOyAvLyBt\nYXAgb2YgYXR0ciBuYW1lcyA9PiBmaWVsZCBuYW1lcwogICAgcHJpdmF0ZSBN\nYXAgX2ZpZWxkc1RvQXR0cnMgPSBudWxsOyAvLyBtYXAgb2YgZmllbGQgbmFt\nZXMgPT4gYXR0ciBuYW1lcwogICAgcHJpdmF0ZSBib29sZWFuIF9pc0FscmVh\nZHlSZWRlZmluZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfaXNB\nbHJlYWR5U3ViY2xhc3NlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9iY3NDb25maWd1cmVkID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBDb25z\ndHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24gYW5kIHR5cGUgdG8gZW5o\nYW5jZS4gVGhpcyB3aWxsIGxvb2sKICAgICAqIHVwIHRoZSBtZXRhZGF0YSBm\nb3IgPGNvZGU+dHlwZTwvY29kZT4gZnJvbSA8Y29kZT5jb25mPC9jb2RlPidz\nCiAgICAgKiByZXBvc2l0b3J5LgogICAgICovCiAgICBwdWJsaWMgUENFbmhh\nbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBDbGFzcyB0eXBlKSB7\nCiAgICAgICAgdGhpcyhjb25mLCAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgLmxv\nYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3QoKSwgdHlwZSkpLAog\nICAgICAgICAgICAoTWV0YURhdGFSZXBvc2l0b3J5KSBudWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJh\ndGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLiBUaGlzIHdpbGwgbG9vawogICAg\nICogdXAgdGhlIG1ldGFkYXRhIGZvciA8Y29kZT5tZXRhPC9jb2RlPiBieSBj\nb252ZXJ0aW5nIGJhY2sgdG8gYSBjbGFzcwogICAgICogYW5kIHRoZW4gbG9h\nZGluZyBmcm9tIDxjb2RlPmNvbmY8L2NvZGU+J3MgcmVwb3NpdG9yeS4KICAg\nICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgdGhpcyhj\nb25mLCAoQkNDbGFzcykgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NB\nY3Rpb24obmV3IFByb2plY3QoKSwgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkp\nKSwKICAgICAgICAgICAgbWV0YS5nZXRSZXBvc2l0b3J5KCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0\naW9uLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSBy\nZXByZXNlbnRhdGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsg\ndGhpcyBjYW4gYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQog\nICAgICogQHBhcmFtIHJlcG9zIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1\nc2UgZm9yIG1ldGFkYXRhIGFjY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3Jl\nYXRlIGEgbmV3IHJlcG9yaXRvcnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBm\ncm9tIHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVm\nYXVsdAogICAgICogYmVjYXVzZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBi\nZSBhbgogICAgICogaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mg\nd2hvc2UgbWV0YWRhdGEKICAgICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0\nIGJhc2UgbWV0YWRhdGEgZmlsZXMKICAgICAqIEBkZXByZWNhdGVkIHVzZSB7\nQGxpbmsgI1BDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24sIEJDQ2xh\nc3MsCiAgICAgICAgTWV0YURhdGFSZXBvc2l0b3J5LCBDbGFzc0xvYWRlcil9\nIGluc3RlYWQuIAogICAgICovCiAgICBwdWJsaWMgUENFbmhhbmNlcihPcGVu\nSlBBQ29uZmlndXJhdGlvbiBjb25mLCBCQ0NsYXNzIHR5cGUsCiAgICAgICAg\nTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgdGhpcyhjb25m\nLCB0eXBlLCByZXBvcywgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRpb24uCiAgICAgKgogICAg\nICogQHBhcmFtIHR5cGUgdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0aW9uIGZv\nIHRoZSB0eXBlIHRvCiAgICAgKiBlbmhhbmNlOyB0aGlzIGNhbiBiZSBjcmVh\ndGVkIGZyb20gYW55IHN0cmVhbSBvciBmaWxlCiAgICAgKiBAcGFyYW0gcmVw\nb3MgYSBtZXRhZGF0YSByZXBvc2l0b3J5IHRvIHVzZSBmb3IgbWV0YWRhdGEg\nYWNjZXNzLAogICAgICogb3IgbnVsbCB0byBjcmVhdGUgYSBuZXcgcmVwb3Jp\ndG9yeTsgdGhlIHJlcG9zaXRvcnkKICAgICAqIGZyb20gdGhlIGdpdmVuIGNv\nbmZpZ3VyYXRpb24gaXNuJ3QgdXNlZCBieSBkZWZhdWx0CiAgICAgKiBiZWNh\ndXNlIHRoZSBjb25maWd1cmF0aW9uIG1pZ2h0IGJlIGFuCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbi1zcGVjaWZpYyBzdWJjbGFzcyB3aG9zZSBtZXRhZGF0YQog\nICAgICogcmVxdWlyZWQgbW9yZSB0aGFuIGp1c3QgYmFzZSBtZXRhZGF0YSBm\naWxlcwogICAgICogQHBhcmFtIGxvYWRlciB0aGUgZW52aXJvbm1lbnQgY2xh\nc3Nsb2FkZXIgdG8gdXNlIGZvciBsb2FkaW5nCiAgICAgKiBjbGFzc2VzIGFu\nZCByZXNvdXJjZXMuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9w\nZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAg\nICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MsIENsYXNzTG9hZGVyIGxvYWRl\ncikgewogICAgICAgIF9tYW5hZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAgX3Bj\nID0gdHlwZTsKCiAgICAgICAgX2xvZyA9IGNvbmYuZ2V0TG9nKE9wZW5KUEFD\nb25maWd1cmF0aW9uLkxPR19FTkhBTkNFKTsKCiAgICAgICAgaWYgKHJlcG9z\nID09IG51bGwpIHsKICAgICAgICAgICAgX3JlcG9zID0gY29uZi5uZXdNZXRh\nRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpOwogICAgICAgICAgICBfcmVwb3Mu\nc2V0U291cmNlTW9kZShNZXRhRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsK\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAg\nICAgICAgX21ldGEgPSBfcmVwb3MuZ2V0TWV0YURhdGEodHlwZS5nZXRUeXBl\nKCksIGxvYWRlciwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3IuIFN1cHBseSByZXBvc2l0b3J5LiBUaGUgcmVwb3NpdG9yeSdz\nIGNvbmZpZ3VyYXRpb24gd2lsbAogICAgICogYmUgdXNlZCwgYW5kIHRoZSBt\nZXRhZGF0YSBwYXNzZWQgaW4gd2lsbCBiZSB1c2VkIGFzLWlzIHdpdGhvdXQg\nZG9pbmcKICAgICAqIGFueSBhZGRpdGlvbmFsIGxvb2t1cHMuIFRoaXMgaXMg\ndXNlZnVsIHdoZW4gcnVubmluZyB0aGUgZW5oYW5jZXIKICAgICAqIGR1cmlu\nZyBtZXRhZGF0YSBsb2FkLgogICAgICoKICAgICAqIEBwYXJhbSByZXBvcyBh\nIG1ldGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0YSBhY2Nl\nc3MsCiAgICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBvcml0b3J5\nOyB0aGUgcmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4gY29uZmln\ndXJhdGlvbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJlY2F1c2Ug\ndGhlIGNvbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGltcGxlbWVu\ndGF0aW9uLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRhCiAgICAg\nKiByZXF1aXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRhIGZpbGVz\nCiAgICAgKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRp\nb24gZm8gdGhlIHR5cGUgdG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJl\nIGNyZWF0ZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJh\nbSBtZXRhIHRoZSBtZXRhZGF0YSB0byB1c2UgZm9yIHByb2Nlc3NpbmcgdGhp\ncyB0eXBlLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAg\nICBwdWJsaWMgUENFbmhhbmNlcihNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3Ms\nIEJDQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBfbWFuYWdlZFR5cGUgPSB0eXBlOwogICAgICAgIF9wYyA9IHR5\ncGU7CgogICAgICAgIF9sb2cgPSByZXBvcy5nZXRDb25maWd1cmF0aW9uKCkK\nICAgICAgICAgICAgLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0df\nRU5IQU5DRSk7CgogICAgICAgIF9yZXBvcyA9IHJlcG9zOwogICAgICAgIF9t\nZXRhID0gbWV0YTsKICAgIH0KCiAgICBzdGF0aWMgU3RyaW5nIHRvUENTdWJj\nbGFzc05hbWUoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZ3Mu\nZ2V0UGFja2FnZU5hbWUoUENFbmhhbmNlci5jbGFzcykgKyAiLiIKICAgICAg\nICAgICAgKyBjbHMuZ2V0TmFtZSgpLnJlcGxhY2UoJy4nLCAnJCcpICsgIiRw\nY3N1YmNsYXNzIjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgb3Ig\nbm90IDxjb2RlPmNsYXNzTmFtZTwvY29kZT4gaXMgdGhlIG5hbWUgZm9yIGEK\nICAgICAqIGR5bmFtaWNhbGx5LWNyZWF0ZWQgcGVyc2lzdGVuY2UtY2FwYWJs\nZSBzdWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzUENTdWJjbGFzc05hbWUo\nU3RyaW5nIGNsYXNzTmFtZSkgewogICAgICAgIHJldHVybiBjbGFzc05hbWUu\nc3RhcnRzV2l0aChTdHJpbmdzLmdldFBhY2thZ2VOYW1lKFBDRW5oYW5jZXIu\nY2xhc3MpKQogICAgICAgICAgICAmJiBjbGFzc05hbWUuZW5kc1dpdGgoIiRw\nY3N1YmNsYXNzIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiA8Y29kZT5j\nbGFzc05hbWU8L2NvZGU+IGlzIGEgZHluYW1pY2FsbHktY3JlYXRlZCBwZXJz\naXN0ZW5jZS1jYXBhYmxlCiAgICAgKiBzdWJjbGFzcyBuYW1lLCByZXR1cm5z\nIHRoZSBuYW1lIG9mIHRoZSBjbGFzcyB0aGF0IGl0IHN1YmNsYXNzZXMuCiAg\nICAgKiBPdGhlcndpc2UsIHJldHVybnMgPGNvZGU+Y2xhc3NOYW1lPC9jb2Rl\nPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBTdHJpbmcgdG9NYW5hZ2VkVHlwZU5hbWUoU3RyaW5nIGNs\nYXNzTmFtZSkgewogICAgICAgIGlmIChpc1BDU3ViY2xhc3NOYW1lKGNsYXNz\nTmFtZSkpIHsKICAgICAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnN1\nYnN0cmluZygKICAgICAgICAgICAgICAgIFN0cmluZ3MuZ2V0UGFja2FnZU5h\nbWUoUENFbmhhbmNlci5jbGFzcykubGVuZ3RoKCkgKyAxKTsKICAgICAgICAg\nICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnN1YnN0cmluZygwLCBjbGFzc05h\nbWUubGFzdEluZGV4T2YoIiQiKSk7CiAgICAgICAgICAgIC8vIHRoaXMgaXMg\nbm90IGNvcnJlY3QgZm9yIG5lc3RlZCBQQ3MKICAgICAgICAgICAgY2xhc3NO\nYW1lID0gY2xhc3NOYW1lLnJlcGxhY2UoJyQnLCAnLicpOwogICAgICAgIH0K\nICAgICAgICAKICAgICAgICByZXR1cm4gY2xhc3NOYW1lOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1cmF0aW9u\nLCB0eXBlLCBhbmQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBQQ0Vu\naGFuY2VyKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlw\nZSwKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICB0aGlz\nKGNvbmYsIHR5cGUsIG1ldGEuZ2V0UmVwb3NpdG9yeSgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRp\nb24gb2YgdGhlIHBlcnNpc3RlbmNlLWNhcGFibGUgY2xhc3MKICAgICAqIGJl\naW5nIG1hbmlwdWxhdGVkLgogICAgICovCiAgICBwdWJsaWMgQkNDbGFzcyBn\nZXRQQ0J5dGVjb2RlKCkgewogICAgICAgIHJldHVybiBfcGM7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGJ5dGVjb2RlIHJlcHJlc2VudGF0\naW9uIG9mIHRoZSBtYW5hZ2VkIGNsYXNzIGJlaW5nCiAgICAgKiBtYW5pcHVs\nYXRlZC4gVGhpcyBpcyB1c3VhbGx5IHRoZSBzYW1lIGFzIHtAbGluayAjZ2V0\nUENCeXRlY29kZX0sCiAgICAgKiBleGNlcHQgd2hlbiBydW5uaW5nIHRoZSBl\nbmhhbmNlciB0byByZWRlZmluZSBhbmQgc3ViY2xhc3MKICAgICAqIGV4aXN0\naW5nIHBlcnNpc3RlbnQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyBCQ0Ns\nYXNzIGdldE1hbmFnZWRUeXBlQnl0ZWNvZGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9tYW5hZ2VkVHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgbWV0YWRhdGEgZm9yIHRoZSBjbGFzcyBiZWluZyBtYW5pcHVsYXRlZCwg\nb3IgbnVsbCBpZiBub3QKICAgICAqIGEgcGVyc2lzdGVudCB0eXBlLgogICAg\nICovCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRhRGF0YSgpIHsK\nICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBlbmhhbmNlciBzaG91\nbGQgYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0b3IgaWYgb25lIGlz\nIG5vdCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNzLiBPcGVuSlBBCiAg\nICAgKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0cnVjdG9yICh3aGV0\naGVyIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAgKiBvciBieSB0aGUg\ndXNlcikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiBnZXRBZGREZWZhdWx0Q29uc3RydWN0b3IoKSB7CiAgICAgICAg\ncmV0dXJuIF9kZWZDb25zOwogICAgfQoKICAgIC8qKgogICAgICogQSBib29s\nZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIGFk\nZCBhIG5vLWFyZ3MKICAgICAqIGNvbnN0cnVjdG9yIGlmIG9uZSBpcyBub3Qg\nYWxyZWFkeSBwcmVzZW50IGluIHRoZSBjbGFzcy4gT3BlbkpQQQogICAgICog\ncmVxdWlyZXMgdGhhdCBhIG5vLWFyZyBjb25zdHJ1Y3RvciAod2hldGhlciBj\ncmVhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgICogb3IgYnkgdGhlIHVzZXIp\nIGJlIHByZXNlbnQgaW4gYSBQQy4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0QWRkRGVmYXVsdENvbnN0cnVjdG9yKGJvb2xlYW4gYWRkRGVmYXVsdENv\nbnN0cnVjdG9yKSB7CiAgICAgICAgX2RlZkNvbnMgPSBhZGREZWZhdWx0Q29u\nc3RydWN0b3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSBl\nbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0cyBhcmd1bWVudHMsIG9yIGp1c3Qg\ncnVuIHZhbGlkYXRpb24KICAgICAqIGFuZCBvcHRpb25hbCBzdWJjbGFzc2lu\nZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5IHVzZWQgaW4gY29uanVuY3Rpb24g\nd2l0aAogICAgICogPGNvZGU+c2V0Q3JlYXRlU3ViY2xhc3ModHJ1ZSk8L2Nv\nZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRSZWRlZmluZSgpIHsKICAgICAgICByZXR1cm4g\nX3JlZGVmaW5lOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\nZW5oYW5jZXIgc2hvdWxkIG11dGF0ZSBpdHMgYXJndW1lbnRzLCBvciBqdXN0\nIHJ1biB2YWxpZGF0aW9uCiAgICAgKiBhbmQgb3B0aW9uYWwgc3ViY2xhc3Np\nbmcgbG9naWMgb24gdGhlbS4gVXN1YWxseSB1c2VkIGluIGNvbmp1bmN0aW9u\nIHdpdGgKICAgICAqIDxjb2RlPnNldENyZWF0ZVN1YmNsYXNzKHRydWUpPC9j\nb2RlPi4KICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0UmVkZWZpbmUoYm9vbGVhbiByZWRlZmluZSkgewog\nICAgICAgIF9yZWRlZmluZSA9IHJlZGVmaW5lOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMgaW5zdGFuY2UgaXMg\nZW5oYW5jaW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHJlZGVmaW5lZC4K\nICAgICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gaXNBbHJlYWR5UmVkZWZpbmVkKCkgewogICAgICAgIHJldHVy\nbiBfaXNBbHJlYWR5UmVkZWZpbmVkOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0aGUgdHlwZSB0aGF0IHRoaXMgaW5zdGFuY2UgaXMgZW5oYW5j\naW5nIGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHN1YmNsYXNzZWQgaW4gdGhp\ncyBpbnN0YW5jZSdzIGVudmlyb25tZW50IGNsYXNzbG9hZGVyLgogICAgICoK\nICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0FscmVhZHlTdWJjbGFzc2VkKCkgewogICAgICAgIHJldHVybiBfaXNB\nbHJlYWR5U3ViY2xhc3NlZDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRo\nZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtYWtlIGl0cyBhcmd1bWVudHMgcGVy\nc2lzdGVuY2UtY2FwYWJsZSwKICAgICAqIG9yIGdlbmVyYXRlIGEgcGVyc2lz\ndGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAgICAqCiAgICAgKiBAc2luY2Ug\nMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gZ2V0Q3JlYXRlU3Vi\nY2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIF9zdWJjbGFzczsKICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGVuaGFuY2VyIHNob3VsZCBtYWtl\nIGl0cyBhcmd1bWVudHMgcGVyc2lzdGVuY2UtY2FwYWJsZSwKICAgICAqIG9y\nIGdlbmVyYXRlIGEgcGVyc2lzdGVuY2UtY2FwYWJsZSBzdWJjbGFzcy4KICAg\nICAqCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0Q3JlYXRlU3ViY2xhc3MoYm9vbGVhbiBzdWJjbGFzcykgewogICAg\nICAgIF9zdWJjbGFzcyA9IHN1YmNsYXNzOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNl\ncyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNp\ncyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHBy\nb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBnZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlv\nbnMoKSB7CiAgICAgICAgcmV0dXJuIF9mYWlsOwogICAgfQoKICAgIC8qKgog\nICAgICogV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUg\ndXNlcyBwcm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFs\neXNpcyBzaG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdz\nIHByb3BlcnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlv\nbnMoYm9vbGVhbiBmYWlsKSB7CiAgICAgICAgX2ZhaWwgPSBmYWlsOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRv\nIGdlbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICog\nc3RydWN0dXJlIHdpbGwgYmUgY3JlYXRlZCBiZW5lYXRoIHRoaXMgZGlyZWN0\nb3J5LiBEZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRpbmcgdGhlIGV4aXN0\naW5nIGNsYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwogICAgcHVibGljIEZp\nbGUgZ2V0RGlyZWN0b3J5KCkgewogICAgICAgIHJldHVybiBfZGlyOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRv\nIGdlbmVyYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICog\nc3RydWN0dXJlIHdpbGwgYmUgY3JlYWVkIGJlbmVhdGggdGhpcyBkaXJlY3Rv\ncnkuIERlZmF1bHRzIHRvCiAgICAgKiBvdmVyd3JpdGluZyB0aGUgZXhpc3Rp\nbmcgY2xhc3MgZmlsZSBpZiBudWxsLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXREaXJlY3RvcnkoRmlsZSBkaXIpIHsKICAgICAgICBfZGlyID0gZGly\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHtA\nbGluayBCeXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdG8gb3IgbnVsbCBpZiBu\nb25lLgogICAgICovCiAgICBwdWJsaWMgQnl0ZWNvZGVXcml0ZXIgZ2V0Qnl0\nZWNvZGVXcml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIF93cml0ZXI7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHtAbGluayBCeXRlY29kZVdyaXRl\ncn0gdG8gd3JpdGUgdGhlIGJ5dGVjb2RlIHRvIG9yIG51bGwgaWYgbm9uZS4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZWNvZGVXcml0ZXIoQnl0\nZWNvZGVXcml0ZXIgd3JpdGVyKSB7CiAgICAgICAgX3dyaXRlciA9IHdyaXRl\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gYnl0ZWNvZGUgZW5o\nYW5jZW1lbnRzLgogICAgICoKICAgICAqIEByZXR1cm4gPGNvZGU+RU5IQU5D\nRV8qPC9jb2RlPiBjb25zdGFudAogICAgICovCiAgICBwdWJsaWMgaW50IHJ1\nbigpIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLXN0YXJ0Iiwg\nX21hbmFnZWRUeXBlLmdldFR5cGUoKSkpOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBpZiBtYW5hZ2VkIGludGVyZmFjZSwgc2tpcAogICAgICAg\nICAgICBpZiAoX3BjLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gRU5IQU5DRV9JTlRFUkZBQ0U7CgogICAgICAgICAgICAvLyBjaGVj\nayBpZiBhbHJlYWR5IGVuaGFuY2VkCiAgICAgICAgICAgIENsYXNzW10gaW50\nZXJmYWNlcyA9IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZEludGVyZmFjZVR5\ncGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW50ZXJm\nYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGludGVy\nZmFjZXNbaV0uZ2V0TmFtZSgpLmVxdWFscyhQQ1RZUEUuZ2V0TmFtZSgpKSkg\newogICAgICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoInBjLXR5cGUiLCBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpKSk7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfTk9ORTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uZmlndXJl\nQkNzKCk7CgogICAgICAgICAgICAvLyB2YWxpZGF0ZSBwcm9wZXJ0aWVzIGJl\nZm9yZSByZXBsYWNpbmcgZmllbGQgYWNjZXNzIHNvIHRoYXQKICAgICAgICAg\nICAgLy8gd2UgYnVpbGQgdXAgYSByZWNvcmQgb2YgYmFja2luZyBmaWVsZHMs\nIGV0YwogICAgICAgICAgICBpZiAoX21ldGEgIT0gbnVsbAogICAgICAgICAg\nICAgICAgJiYgX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX1BST1BFUlRZKSB7CiAgICAgICAgICAgICAgICB2YWxpZGF0\nZVByb3BlcnRpZXMoKTsKICAgICAgICAgICAgICAgIGlmIChnZXRDcmVhdGVT\ndWJjbGFzcygpKQogICAgICAgICAgICAgICAgICAgIGFkZEF0dHJpYnV0ZVRy\nYW5zbGF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVwbGFj\nZUFuZFZhbGlkYXRlRmllbGRBY2Nlc3MoKTsKICAgICAgICAgICAgcHJvY2Vz\nc1Zpb2xhdGlvbnMoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBlbmhhbmNlQ2xhc3MoKTsKICAgICAgICAg\nICAgICAgIGFkZEZpZWxkcygpOwogICAgICAgICAgICAgICAgYWRkU3RhdGlj\nSW5pdGlhbGl6ZXIoKTsKICAgICAgICAgICAgICAgIGFkZFBDTWV0aG9kcygp\nOwogICAgICAgICAgICAgICAgYWRkQWNjZXNzb3JzKCk7CiAgICAgICAgICAg\nICAgICBhZGRBdHRhY2hEZXRhY2hDb2RlKCk7CiAgICAgICAgICAgICAgICBh\nZGRTZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAgICAgICAgYWRkQ2xv\nbmluZ0NvZGUoKTsKICAgICAgICAgICAgICAgIHJ1bkF1eGlsaWFyeUVuaGFu\nY2VycygpOwogICAgICAgICAgICAgICAgcmV0dXJuIEVOSEFOQ0VfUEM7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgicGVy\ncy1hd2FyZSIsIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsKICAgICAgICAg\nICAgcmV0dXJuIEVOSEFOQ0VfQVdBUkU7CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihfbG9jLmdldCgiZW5oYW5jZS1lcnJv\nciIsCiAgICAgICAgICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0VHlwZSgpLmdl\ndE5hbWUoKSwgZS5nZXRNZXNzYWdlKCkpLCBlKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIGNvbmZpZ3VyZUJDcygpIHsKICAgICAgICBp\nZiAoIV9iY3NDb25maWd1cmVkKSB7CiAgICAgICAgICAgIGlmIChnZXRSZWRl\nZmluZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoX21hbmFnZWRUeXBlLmdl\ndEF0dHJpYnV0ZShSRURFRklORURfQVRUUklCVVRFKSA9PSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5hZGRBdHRyaWJ1dGUoUkVE\nRUZJTkVEX0FUVFJJQlVURSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgX2lzQWxyZWFkeVJlZGVmaW5lZCA9IHRydWU7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFz\ncygpKSB7CiAgICAgICAgICAgICAgICBQQ1N1YmNsYXNzVmFsaWRhdG9yIHZh\nbCA9IG5ldyBQQ1N1YmNsYXNzVmFsaWRhdG9yKAogICAgICAgICAgICAgICAg\nICAgIF9tZXRhLCBfbWFuYWdlZFR5cGUsIF9sb2csIF9mYWlsKTsKICAgICAg\nICAgICAgICAgIHZhbC5hc3NlcnRDYW5TdWJjbGFzcygpOwoKICAgICAgICAg\nICAgICAgIF9wYyA9IF9tYW5hZ2VkVHlwZS5nZXRQcm9qZWN0KCkubG9hZENs\nYXNzKAogICAgICAgICAgICAgICAgICAgIHRvUENTdWJjbGFzc05hbWUoX21h\nbmFnZWRUeXBlLmdldFR5cGUoKSkpOwogICAgICAgICAgICAgICAgaWYgKF9w\nYy5nZXRTdXBlcmNsYXNzQkMoKSAhPSBfbWFuYWdlZFR5cGUpIHsKICAgICAg\nICAgICAgICAgICAgICBfcGMuc2V0U3VwZXJjbGFzcyhfbWFuYWdlZFR5cGUp\nOwogICAgICAgICAgICAgICAgICAgIF9wYy5zZXRBYnN0cmFjdChfbWFuYWdl\nZFR5cGUuaXNBYnN0cmFjdCgpKTsKICAgICAgICAgICAgICAgICAgICBfcGMu\nZGVjbGFyZUludGVyZmFjZShEeW5hbWljUGVyc2lzdGVuY2VDYXBhYmxlLmNs\nYXNzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgX2lzQWxyZWFkeVN1YmNsYXNzZWQgPSB0cnVlOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBfYmNzQ29uZmln\ndXJlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nV3JpdGUgdGhlIGdlbmVyYXRlZCBieXRlY29kZS4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgcmVjb3JkKCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIGlmIChfbWFuYWdlZFR5cGUgIT0gX3BjICYmIGdldFJlZGVm\naW5lKCkpCiAgICAgICAgICAgIHJlY29yZChfbWFuYWdlZFR5cGUpOwogICAg\nICAgIHJlY29yZChfcGMpOwogICAgICAgIGlmIChfb2lkcyAhPSBudWxsKQog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9vaWRzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgcmVjb3JkKChC\nQ0NsYXNzKSBpdHIubmV4dCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdy\naXRlIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHJlY29yZChCQ0NsYXNzIGJjKQogICAgICAgIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKF93cml0ZXIgIT0gbnVsbCkKICAgICAgICAgICAg\nX3dyaXRlci53cml0ZShiYyk7CiAgICAgICAgZWxzZSBpZiAoX2RpciA9PSBu\ndWxsKQogICAgICAgICAgICBiYy53cml0ZSgpOwogICAgICAgIGVsc2Ugewog\nICAgICAgICAgICBGaWxlIGRpciA9IEZpbGVzLmdldFBhY2thZ2VGaWxlKF9k\naXIsIGJjLmdldFBhY2thZ2VOYW1lKCksIHRydWUpOwogICAgICAgICAgICBi\nYy53cml0ZShuZXcgRmlsZShkaXIsIGJjLmdldENsYXNzTmFtZSgpICsgIi5j\nbGFzcyIpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWYWxp\nZGF0ZSB0aGF0IHRoZSBtZXRob2RzIGluIHRoaXMgcHJvcGVydHktYWNjZXNz\nIGluc3RhbmNlIGFyZQogICAgICogd3JpdHRlbiBjb3JyZWN0bHkuIFRoaXMg\nbWV0aG9kIGFsc28gZ2F0aGVycyBpbmZvcm1hdGlvbiBvbiBlYWNoCiAgICAg\nKiBwcm9wZXJ0eSdzIGJhY2tpbmcgZmllbGQuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB2YWxpZGF0ZVByb3BlcnRpZXMoKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHM7CiAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNz\nKCkpCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJl\nZEZpZWxkcygpOwogICAgICAgIE1ldGhvZCBtZXRoOwogICAgICAgIEJDTWV0\naG9kIGdldHRlciwgc2V0dGVyOwogICAgICAgIEJDRmllbGQgcmV0dXJuZWQs\nIGFzc2lnbmVkID0gbnVsbDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCEoZm1kc1tp\nXS5nZXRCYWNraW5nTWVtYmVyKCkgaW5zdGFuY2VvZiBNZXRob2QpKSB7CiAg\nICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LWJhZC1tZW1i\nZXIiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgZm1kc1tp\nXSwgZm1kc1tpXS5nZXRCYWNraW5nTWVtYmVyKCkgfSwKICAgICAgICAgICAg\nICAgICAgICB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBtZXRoID0gKE1ldGhvZCkgZm1kc1tp\nXS5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgICAgIC8vICMjIyMjIHRo\naXMgd2lsbCBmYWlsIGlmIHdlIG92ZXJyaWRlIGFuZCBkb24ndCBjYWxsIHN1\ncGVyLgogICAgICAgICAgICBCQ0NsYXNzIGRlY2xhcmluZ1R5cGUgPSBfbWFu\nYWdlZFR5cGUuZ2V0UHJvamVjdCgpCiAgICAgICAgICAgICAgICAubG9hZENs\nYXNzKGZtZHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAg\nZ2V0dGVyID0gZGVjbGFyaW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChtZXRo\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVy\nVHlwZXMoKSk7CiAgICAgICAgICAgIGlmIChnZXR0ZXIgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1nZXR0\nZXIiLCBuZXcgT2JqZWN0W117IGZtZHNbaV0gfSwKICAgICAgICAgICAgICAg\nICAgICB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybmVkID0gZ2V0UmV0dXJuZWRGaWVs\nZChnZXR0ZXIpOwogICAgICAgICAgICBpZiAocmV0dXJuZWQgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJlZ2lzdGVyQmFja2luZ0ZpZWxkSW5mbyhmbWRz\nW2ldLCBnZXR0ZXIsIHJldHVybmVkKTsKCiAgICAgICAgICAgIHNldHRlciA9\nIGRlY2xhcmluZ1R5cGUuZ2V0RGVjbGFyZWRNZXRob2QoZ2V0U2V0dGVyTmFt\nZShmbWRzW2ldKSwKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBmbWRz\nW2ldLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICBpZiAoc2V0\ndGVyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJw\ncm9wZXJ0eS1uby1zZXR0ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W117IGZtZHNbaV0gfSwgdHJ1ZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFn\nZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRl\nIHN5bnRoZXRpYyBzZXR0ZXIKICAgICAgICAgICAgICAgICAgICBzZXR0ZXIg\nPSBfbWFuYWdlZFR5cGUuZGVjbGFyZU1ldGhvZChnZXRTZXR0ZXJOYW1lKGZt\nZHNbaV0pLAogICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBu\nZXcgQ2xhc3NbXXsgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAg\nICAgICAgICAgICAgICAgICBzZXR0ZXIubWFrZVByaXZhdGUoKTsKICAgICAg\nICAgICAgICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0Rmll\nbGQocmV0dXJuZWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoc2V0dGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBh\nc3NpZ25lZCA9IGdldEFzc2lnbmVkRmllbGQoc2V0dGVyKTsKCiAgICAgICAg\nICAgIGlmIChhc3NpZ25lZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoc2V0dGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0\nZXJCYWNraW5nRmllbGRJbmZvKGZtZHNbaV0sIHNldHRlciwgYXNzaWduZWQp\nOwoKICAgICAgICAgICAgICAgIGlmIChhc3NpZ25lZCAhPSByZXR1cm5lZCkK\nICAgICAgICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LXNl\ndHRlci1nZXR0ZXItbWlzbWF0Y2giLCBuZXcgT2JqZWN0W10KICAgICAgICAg\nICAgICAgICAgICAgICAgeyBmbWRzW2ldLCBhc3NpZ25lZC5nZXROYW1lKCks\nIChyZXR1cm5lZCA9PSBudWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAg\nPyBudWxsIDogcmV0dXJuZWQuZ2V0TmFtZSgpIH0sIGZhbHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVn\naXN0ZXJCYWNraW5nRmllbGRJbmZvKEZpZWxkTWV0YURhdGEgZm1kLCBCQ01l\ndGhvZCBtZXRob2QsCiAgICAgICAgQkNGaWVsZCBmaWVsZCkgewogICAgICAg\nIGlmIChfYmFja2luZ0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYmFj\na2luZ0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2JhY2tpbmdG\naWVsZHMucHV0KG1ldGhvZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7\nCgogICAgICAgIGlmIChfYXR0cnNUb0ZpZWxkcyA9PSBudWxsKQogICAgICAg\nICAgICBfYXR0cnNUb0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAg\nX2F0dHJzVG9GaWVsZHMucHV0KGZtZC5nZXROYW1lKCksIGZpZWxkLmdldE5h\nbWUoKSk7CgogICAgICAgIGlmIChfZmllbGRzVG9BdHRycyA9PSBudWxsKQog\nICAgICAgICAgICBfZmllbGRzVG9BdHRycyA9IG5ldyBIYXNoTWFwKCk7CiAg\nICAgICAgX2ZpZWxkc1RvQXR0cnMucHV0KGZpZWxkLmdldE5hbWUoKSwgZm1k\nLmdldE5hbWUoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dHJp\nYnV0ZVRyYW5zbGF0aW9uKCkgewogICAgICAgIF9wYy5kZWNsYXJlSW50ZXJm\nYWNlKEF0dHJpYnV0ZVRyYW5zbGF0b3IuY2xhc3MpOwogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJBdHRyaWJ1\ndGVJbmRleFRvRmllbGROYW1lIiwKICAgICAgICAgICAgU3RyaW5nLmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7IGludC5jbGFzcyB9KTsKICAgICAgICBtZXRob2Qu\nbWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9t\nZXRhLmdldEZpZWxkcygpOwoKICAgICAgICAvLyBzd2l0Y2ggKHZhbCkKICAg\nICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgVGFibGVT\nd2l0Y2hJbnN0cnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7\nCiAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICB0YWJpbnMuc2V0\nSGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAvLyBjYXNlIGk6CiAg\nICAgICAgLy8gICAgIHJldHVybiA8X2F0dHJzVG9GaWVsZHMuZ2V0KGZtZHNb\naV0uZ2V0TmFtZSgpKT4KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\nZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdl\ndChjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoCiAgICAgICAgICAgICAgICBf\nYXR0cnNUb0ZpZWxkcy5nZXQoZm1kc1tpXS5nZXROYW1lKCkpKSk7CiAgICAg\nICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nZGVmYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAo\nKQogICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0\naW9uCiAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24uY2xhc3MpKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG5hbWUgb2YgdGhlIHNldHRlciBt\nZXRob2QgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgU3RyaW5nIGdldFNldHRlck5hbWUoRmllbGRNZXRhRGF0YSBm\nbWQpIHsKICAgICAgICByZXR1cm4gInNldCIgKyBTdHJpbmdVdGlscy5jYXBp\ndGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBmaWVsZCByZXR1cm5lZCBieSB0aGUgZ2l2ZW4gbWV0aG9k\nLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKiBQYWNrYWdlLXByb3RlY3RlZCBh\nbmQgc3RhdGljIGZvciB0ZXN0aW5nLgogICAgICovCiAgICBzdGF0aWMgQkNG\naWVsZCBnZXRSZXR1cm5lZEZpZWxkKEJDTWV0aG9kIG1ldGgpIHsKICAgICAg\nICByZXR1cm4gZmluZEZpZWxkKG1ldGgsICgoQ29kZSkgQWNjZXNzQ29udHJv\nbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLm5ld0NvZGVBY3Rpb24oKSkpLnhyZXR1cm4oKQogICAgICAgICAgICAuc2V0\nVHlwZShtZXRoLmdldFJldHVyblR5cGUoKSksIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQgYXNzaWduZWQgaW4gdGhl\nIGdpdmVuIG1ldGhvZCwgb3IgbnVsbCBpZiBub25lLgogICAgICogUGFja2Fn\nZS1wcm90ZWN0ZWQgYW5kIHN0YXRpYyBmb3IgdGVzdGluZy4KICAgICAqLwog\nICAgc3RhdGljIEJDRmllbGQgZ2V0QXNzaWduZWRGaWVsZChCQ01ldGhvZCBt\nZXRoKSB7CiAgICAgICAgcmV0dXJuIGZpbmRGaWVsZChtZXRoLCAoKENvZGUp\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS5wdXRmaWVsZCgpLCB0\ncnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZmllbGQg\ncmV0dXJuZWQgLyBhc3NpZ25lZCBieSA8Y29kZT5tZXRoPC9jb2RlPi4gUmV0\ndXJucwogICAgICogbnVsbCBpZiBub24tZmllbGRzIChtZXRob2RzLCBsaXRl\ncmFscywgcGFyYW1ldGVycywgdmFyaWFibGVzKSBhcmUKICAgICAqIHJldHVy\nbmVkLCBvciBpZiBub24tcGFyYW1ldGVycyBhcmUgYXNzaWduZWQgdG8gZmll\nbGRzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBCQ0ZpZWxkIGZpbmRG\naWVsZChCQ01ldGhvZCBtZXRoLCBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSwKICAg\nICAgICBib29sZWFuIGZpbmRBY2Nlc3NlZCkgewogICAgICAgIC8vIGlnbm9y\nZSBhbnkgc3RhdGljIG1ldGhvZHMuIE9wZW5KUEEgb25seSBjdXJyZW50bHkg\nc3VwcG9ydHMKICAgICAgICAvLyBub24tc3RhdGljIHNldHRlcnMgYW5kIGdl\ndHRlcnMKICAgICAgICBpZiAobWV0aC5pc1N0YXRpYygpKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRD\nb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7\nCgogICAgICAgIEJDRmllbGQgZmllbGQgPSBudWxsLCBjdXI7CiAgICAgICAg\nSW5zdHJ1Y3Rpb24gdGVtcGxhdGVJbnMsIHByZXZJbnMsIGVhcmxpZXJJbnM7\nCiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZSkp\nIHsKICAgICAgICAgICAgaW50IGJhY2t1cENvdW50ID0gMzsKICAgICAgICAg\nICAgdGVtcGxhdGVJbnMgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAg\nIGlmICghY29kZS5oYXNQcmV2aW91cygpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIHByZXZJbnMgPSBjb2RlLnByZXZpb3Vz\nKCk7CgogICAgICAgICAgICBpZiAocHJldklucyBpbnN0YW5jZW9mIENsYXNz\nSW5zdHJ1Y3Rpb24KICAgICAgICAgICAgICAgICYmIGNvZGUuaGFzUHJldmlv\ndXMoKSkgewogICAgICAgICAgICAgICAgcHJldklucyA9IGNvZGUucHJldmlv\ndXMoKTsKICAgICAgICAgICAgICAgIGJhY2t1cENvdW50Kys7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmICghY29kZS5oYXNQcmV2aW91cygpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGVhcmxp\nZXJJbnMgPSBjb2RlLnByZXZpb3VzKCk7CgogICAgICAgICAgICAvLyBpZiB0\naGUgb3Bjb2RlIHR3byBiZWZvcmUgdGhlIHRlbXBsYXRlIHdhcyBhbiBhbG9h\nZF8wLCBjaGVjawogICAgICAgICAgICAvLyBhZ2FpbnN0IHRoZSBtaWRkbGUg\naW5zdHJ1Y3Rpb24gYmFzZWQgb24gd2hhdCB0eXBlIG9mIGZpbmQKICAgICAg\nICAgICAgLy8gd2UncmUgZG9pbmcKICAgICAgICAgICAgaWYgKCEoZWFybGll\ncklucyBpbnN0YW5jZW9mIExvYWRJbnN0cnVjdGlvbikKICAgICAgICAgICAg\nICAgIHx8ICEoKExvYWRJbnN0cnVjdGlvbikgZWFybGllcklucykuaXNUaGlz\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAg\nIC8vIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGEgZ2V0ZmllbGQs\nIHRoZW4gaXQncyB0aGUKICAgICAgICAgICAgLy8gZmllbGQgdGhhdCdzIGJl\naW5nIGFjY2Vzc2VkCiAgICAgICAgICAgIGlmICghZmluZEFjY2Vzc2VkICYm\nIHByZXZJbnMgaW5zdGFuY2VvZiBHZXRGaWVsZEluc3RydWN0aW9uKSB7CiAg\nICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZQcmV2SW5z\nID0gKEZpZWxkSW5zdHJ1Y3Rpb24pIHByZXZJbnM7CiAgICAgICAgICAgICAg\nICBjdXIgPSAoQkNGaWVsZCkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVn\nZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Rmll\nbGRJbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZQcmV2SW5zKSk7CiAgICAgICAg\nICAgICAgICAvLyBpZiB0aGUgbWlkZGxlIGluc3RydWN0aW9uIHdhcyBhbiB4\nbG9hZF8xLCB0aGVuIHRoZQogICAgICAgICAgICAgICAgLy8gbWF0Y2hlZCBp\nbnN0cnVjdGlvbiBpcyB0aGUgZmllbGQgdGhhdCdzIGJlaW5nIHNldC4KICAg\nICAgICAgICAgfSBlbHNlIGlmIChmaW5kQWNjZXNzZWQgJiYgcHJldklucyBp\nbnN0YW5jZW9mIExvYWRJbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgJiYg\nKChMb2FkSW5zdHJ1Y3Rpb24pIHByZXZJbnMpLmdldFBhcmFtKCkgPT0gMCkg\newogICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0cnVjdGlvbiBmVGVt\ncGxhdGVJbnMgPQogICAgICAgICAgICAgICAgICAgIChGaWVsZEluc3RydWN0\naW9uKSB0ZW1wbGF0ZUluczsKICAgICAgICAgICAgICAgIGN1ciA9IChCQ0Zp\nZWxkKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAgICAgICAgIC5nZXRGaWVsZEluc3RydWN0aW9u\nRmllbGRBY3Rpb24oZlRlbXBsYXRlSW5zKSk7CiAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgICAgICBp\nZiAoZmllbGQgIT0gbnVsbCAmJiBjdXIgIT0gZmllbGQpCiAgICAgICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZmllbGQgPSBjdXI7Cgog\nICAgICAgICAgICAvLyByZWFkeSBmb3IgbmV4dCBzZWFyY2ggaXRlcmF0aW9u\nCiAgICAgICAgICAgIHdoaWxlIChiYWNrdXBDb3VudCA+IDApIHsKICAgICAg\nICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAgICAgICAgICAgYmFja3Vw\nQ291bnQtLTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZmllbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgYSB2aW9s\nYXRpb24gb2YgdGhlIHByb3BlcnR5IGFjY2VzcyByZXN0cmljdGlvbnMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRWaW9sYXRpb24oU3RyaW5nIGtl\neSwgT2JqZWN0W10gYXJncywgYm9vbGVhbiBmYXRhbCkgewogICAgICAgIGlm\nIChfdmlvbGF0aW9ucyA9PSBudWxsKQogICAgICAgICAgICBfdmlvbGF0aW9u\ncyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgX3Zpb2xhdGlvbnMuYWRkKF9s\nb2MuZ2V0KGtleSwgYXJncykpOwogICAgICAgIF9mYWlsIHw9IGZhdGFsOwog\nICAgfQoKICAgIC8qKgogICAgICogTG9nIC8gdGhyb3cgcmVjb3JkZWQgcHJv\ncGVydHkgYWNjZXNzIHZpb2xhdGlvbnMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBwcm9jZXNzVmlvbGF0aW9ucygpIHsKICAgICAgICBpZiAoX3Zpb2xh\ndGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBT\ndHJpbmcgc2VwID0gSjJEb1ByaXZIZWxwZXIuZ2V0TGluZVNlcGFyYXRvcigp\nOwogICAgICAgIFN0cmluZ0J1ZmZlciBidWYgPSBuZXcgU3RyaW5nQnVmZmVy\nKCk7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBfdmlvbGF0aW9ucy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYu\nYXBwZW5kKGl0ci5uZXh0KCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05l\neHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VwKTsKICAgICAg\nICB9CiAgICAgICAgTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgicHJvcGVydHkt\ndmlvbGF0aW9ucyIsIGJ1Zik7CgogICAgICAgIGlmIChfZmFpbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24obXNnKTsKICAgICAgICBp\nZiAoX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fy\nbihtc2cpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZWQgYWxsIGRp\ncmVjdCBhY2Nlc3MgdG8gbWFuYWdlZCBmaWVsZHMgd2l0aCB0aGUgYXBwcm9w\ncmlhdGUKICAgICAqIHBjR2V0L3BjU2V0IG1ldGhvZC4gTm90ZSB0aGF0IHRo\naXMgaW5jbHVkZXMgYWNjZXNzIHRvIGZpZWxkcwogICAgICogb3duZWQgYnkg\nUGVyc2lzdGVuY2VDYXBhYmxlIGNsYXNzZXMgb3RoZXIgdGhhbiB0aGlzIG9u\nZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0\nZUZpZWxkQWNjZXNzKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gY3JlYXRlIHRlbXBsYXRlIHB1dGZpZWxkL2dldGZpZWxk\nIGluc3RydWN0aW9ucyB0byBzZWFyY2ggZm9yCiAgICAgICAgQ29kZSB0ZW1w\nbGF0ZSA9IChDb2RlKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsK\nICAgICAgICBJbnN0cnVjdGlvbiBwdXQgPSB0ZW1wbGF0ZS5wdXRmaWVsZCgp\nOwogICAgICAgIEluc3RydWN0aW9uIGdldCA9IHRlbXBsYXRlLmdldGZpZWxk\nKCk7CiAgICAgICAgSW5zdHJ1Y3Rpb24gc3RhdCA9IHRlbXBsYXRlLmludm9r\nZXN0YXRpYygpOwoKICAgICAgICAvLyBsb29rIHRocm91Z2ggYWxsIG1ldGhv\nZHM7IHRoaXMgaXMgZG9uZSBiZWZvcmUgYW55IG1ldGhvZHMgYXJlIGFkZGVk\nCiAgICAgICAgLy8gc28gd2UgZG9uJ3QgbmVlZCB0byB3b3JyeSBhYm91dCBl\neGNsdWRpbmcgc3ludGhldGljIG1ldGhvZHMuCiAgICAgICAgQkNNZXRob2Rb\nXSBtZXRob2RzID0gX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kcygp\nOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG1ldGhvZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZSA9\nIG1ldGhvZHNbaV0uZ2V0Q29kZShmYWxzZSk7CgogICAgICAgICAgICAvLyBk\nb24ndCBtb2RpZnkgdGhlIG1ldGhvZHMgc3BlY2lmaWVkIGJ5IHRoZSBhdXhp\nbGlhcnkgZW5oYW5jZXJzCiAgICAgICAgICAgIGlmIChjb2RlICE9IG51bGwg\nJiYgIXNraXBFbmhhbmNlKG1ldGhvZHNbaV0pKSB7CiAgICAgICAgICAgICAg\nICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBnZXQsIHRy\ndWUsIHN0YXQpOwogICAgICAgICAgICAgICAgcmVwbGFjZUFuZFZhbGlkYXRl\nRmllbGRBY2Nlc3MoY29kZSwgcHV0LCBmYWxzZSwgc3RhdCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNl\ncyBhbGwgaW5zdHJ1Y3Rpb25zIG1hdGNoaW5nIHRoZSBnaXZlbiB0ZW1wbGF0\nZSBpbiB0aGUgZ2l2ZW4KICAgICAqIGNvZGUgYmxvY2sgd2l0aCBjYWxscyB0\nbyB0aGUgYXBwcm9wcmlhdGUgZ2VuZXJhdGVkIGdldHRlci9zZXR0ZXIuCiAg\nICAgKgogICAgICogQHBhcmFtIGNvZGUgdGhlIGNvZGUgYmxvY2sgdG8gbW9k\naWZ5OyB0aGUgY29kZSBpdGVyYXRvciB3aWxsCiAgICAgKiBiZSBwbGFjZWQg\nYmVmb3JlIHRoZSBmaXJzdCBpbnN0cnVjdGlvbiBvbiBtZXRob2Qgc3RhcnQs\nCiAgICAgKiBhbmQgd2lsbCBiZSBhZnRlciB0aGUgbGFzdCBpbnN0cnVjdGlv\nbiBvbiBtZXRob2QgY29tcGxldGlvbgogICAgICogQHBhcmFtIGlucyB0aGUg\ndGVtcGxhdGUgaW5zdHJ1Y3Rpb24gdG8gc2VhcmNoIGZvcjsgZWl0aGVyIGEK\nICAgICAqIGdldGZpZWxkIG9yIHB1dGZpZWxkIGluc3RydWN0aW9uCiAgICAg\nKiBAcGFyYW0gZ2V0IGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGlzIGlzIGEg\nZ2V0IGluc3RydWN0aW9uCiAgICAgKiBAcGFyYW0gc3RhdCB0ZW1wbGF0ZSBp\nbnZva2VzdGF0aWMgaW5zdHJ1Y3Rpb24gdG8gcmVwbGFjZSB3aXRoCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFj\nY2VzcyhDb2RlIGNvZGUsIEluc3RydWN0aW9uIGlucywKICAgICAgICBib29s\nZWFuIGdldCwgSW5zdHJ1Y3Rpb24gc3RhdCkgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAg\nICAgICBGaWVsZEluc3RydWN0aW9uIGZpOwogICAgICAgIE1ldGhvZEluc3Ry\ndWN0aW9uIG1pOwogICAgICAgIENsYXNzTWV0YURhdGEgb3duZXI7CiAgICAg\nICAgU3RyaW5nIG5hbWUsIHR5cGVOYW1lLCBtZXRob2ROYW1lOwogICAgICAg\nIHdoaWxlIChjb2RlLnNlYXJjaEZvcndhcmQoaW5zKSkgewogICAgICAgICAg\nICAvLyBiYWNrIHVwIHRvIHRoZSBtYXRjaGVkIGluc3RydWN0aW9uCiAgICAg\nICAgICAgIGZpID0gKEZpZWxkSW5zdHJ1Y3Rpb24pIGNvZGUucHJldmlvdXMo\nKTsKICAgICAgICAgICAgbmFtZSA9IGZpLmdldEZpZWxkTmFtZSgpOwogICAg\nICAgICAgICB0eXBlTmFtZSA9IGZpLmdldEZpZWxkVHlwZU5hbWUoKTsKICAg\nICAgICAgICAgb3duZXIgPSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihu\nYW1lLCBmaS5nZXRGaWVsZERlY2xhcmVyVHlwZSgpKTsKCiAgICAgICAgICAg\nIGlmIChvd25lciAhPSBudWxsCiAgICAgICAgICAgICAgICAmJiBvd25lci5n\nZXRBY2Nlc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVS\nVFkpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVjdGx5IGFj\nY2Vzc2luZyBhIGZpZWxkIGluIGFub3RoZXIgY2xhc3MKICAgICAgICAgICAg\nICAgIC8vIGhpZXJhcmNoeSB0aGF0IHVzZXMgcHJvcGVydHkgYWNjZXNzLCBz\nb21ldGhpbmcgaXMgd3JvbmcKICAgICAgICAgICAgICAgIGlmIChvd25lciAh\nPSBfbWV0YSAmJiBvd25lci5nZXREZWNsYXJlZEZpZWxkKG5hbWUpICE9IG51\nbGwgJiYKICAgICAgICAgICAgICAgICAgICBfbWV0YSAhPSBudWxsICYmICFv\nd25lci5nZXREZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgLmlzQXNzaWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgp\nKSkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgicHJvcGVydHktZmllbGQtYWNjZXNzIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBfbWV0YSwgb3duZXIsIG5h\nbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmdldE1ldGhv\nZCgpLmdldE5hbWUoKSB9KSk7CgogICAgICAgICAgICAgICAgLy8gaWYgd2Un\ncmUgZGlyZWN0bHkgYWNjZXNzaW5nIGEgcHJvcGVydHktYmFja2luZyBmaWVs\nZCBvdXRzaWRlCiAgICAgICAgICAgICAgICAvLyB0aGUgcHJvcGVydHkgaW4g\nb3VyIG93biBjbGFzcywgbm90aWZ5IHVzZXIKICAgICAgICAgICAgICAgIGlm\nIChpc0JhY2tpbmdGaWVsZE9mQW5vdGhlclByb3BlcnR5KG5hbWUsIGNvZGUp\nKQogICAgICAgICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHkt\nZmllbGQtYWNjZXNzIiwgbmV3IE9iamVjdFtdeyBfbWV0YSwKICAgICAgICAg\nICAgICAgICAgICAgICAgb3duZXIsIG5hbWUsIGNvZGUuZ2V0TWV0aG9kKCku\nZ2V0TmFtZSgpIH0sIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgaWYgKG93bmVyID09IG51bGwgfHwKICAgICAgICAgICAgICAgIG93bmVy\nLmdldERlY2xhcmVkRmllbGQoZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSkp\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBwZXJzaXN0ZW50\nIGZpZWxkPwogICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0\nUmVkZWZpbmUoKSAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKQogICAgICAgICAg\nICAgICAgJiYgb3duZXIuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURh\ndGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAgICAgICAvLyByZXBsYWNl\nIHRoZSBpbnN0cnVjdGlvbiB3aXRoIGEgY2FsbCB0byB0aGUgZ2VuZXJhdGVk\nIGFjY2VzcwogICAgICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAgICAg\nICAgICBtaSA9IChNZXRob2RJbnN0cnVjdGlvbikgY29kZS5zZXQoc3RhdCk7\nCgogICAgICAgICAgICAgICAgLy8gaW52b2tlIHRoZSBwcm9wZXIgYWNjZXNz\nIG1ldGhvZCwgd2hldGhlciBnZXR0ZXIgb3Igc2V0dGVyCiAgICAgICAgICAg\nICAgICBTdHJpbmcgcHJlZml4ID0gKGdldCkgPyBQUkUgKyAiR2V0IiA6IFBS\nRSArICJTZXQiOwogICAgICAgICAgICAgICAgbWV0aG9kTmFtZSA9IHByZWZp\neCArIG5hbWU7CiAgICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAgICAg\nICAgICAgICAgICAgbWkuc2V0TWV0aG9kKGdldFR5cGUob3duZXIpLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZSwgdHlw\nZU5hbWUsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAgICB7\nIGdldFR5cGUob3duZXIpLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWkuc2V0TWV0aG9kKGdl\ndFR5cGUob3duZXIpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgbWV0aG9kTmFtZSwgInZvaWQiLCBuZXcgU3RyaW5nW10KICAgICAgICAg\nICAgICAgICAgICAgICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1lKCksIHR5\ncGVOYW1lIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2V0UmVkZWZp\nbmUoKSkgewogICAgICAgICAgICAgICAgbmFtZSA9IGZyb21CYWNraW5nRmll\nbGROYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKGdldCkgewogICAg\nICAgICAgICAgICAgICAgIGFkZE5vdGlmeUFjY2Vzcyhjb2RlLCBvd25lci5n\nZXRGaWVsZChuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5uZXh0\nKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIC8vIGluc2VydCB0aGUgc2V0IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIGZp\nZWxkIG11dGF0aW9uLCBidXQKICAgICAgICAgICAgICAgICAgICAvLyBmaXJz\ndCBsb2FkIHRoZSBvbGQgdmFsdWUgZm9yIHVzZSBpbiB0aGUKICAgICAgICAg\nICAgICAgICAgICAvLyBTdGF0ZU1hbmFnZXIuc2V0dGluZ1hYWCBtZXRob2Qu\nCiAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgRmllbGRJbnN0\ncnVjdGlvbiBmRmkgPSBmaTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdl\ndGZpZWxkKCkuc2V0RmllbGQoCiAgICAgICAgICAgICAgICAgICAgICAgIChC\nQ0ZpZWxkKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJp\ndkhlbHBlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEZpZWxk\nSW5zdHJ1Y3Rpb25GaWVsZEFjdGlvbihmRmkpKSk7CiAgICAgICAgICAgICAg\nICAgICAgaW50IHZhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS54c3RvcmUoKS5zZXRMb2NhbCh2YWwp\nLnNldFR5cGUoZmkuZ2V0RmllbGRUeXBlKCkpOwoKICAgICAgICAgICAgICAg\nICAgICAvLyBtb3ZlIHBhc3QgdGhlIHB1dGZpZWxkCiAgICAgICAgICAgICAg\nICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYWRkTm90\naWZ5TXV0YXRpb24oY29kZSwgb3duZXIuZ2V0RmllbGQobmFtZSksIHZhbCwg\nLTEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgYWRkTm90aWZ5QWNjZXNzKENvZGUgY29kZSwg\nRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICAvLyBQQ0hlbHBlci5hY2Nl\nc3NpbmdGaWVsZCh0aGlzLCA8YWJzb2x1dGUtaW5kZXg+KTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgY29kZS5pbnZv\na2VzdGF0aWMoKS5zZXRNZXRob2QoUmVkZWZpbml0aW9uSGVscGVyLmNsYXNz\nLAogICAgICAgICAgICAiYWNjZXNzaW5nRmllbGQiLCB2b2lkLmNsYXNzLAog\nICAgICAgICAgICBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgaW50LmNs\nYXNzIH0pOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtdXN0IGJlIGNh\nbGxlZCBhZnRlciBzZXR0aW5nIHRoZSB2YWx1ZSBpbiB0aGUgb2JqZWN0Lgog\nICAgICogCiAgICAgKiBAcGFyYW0gY29kZQogICAgICogQHBhcmFtIHZhbCB0\naGUgcG9zaXRpb24gaW4gdGhlIGxvY2FsIHZhcmlhYmxlIHRhYmxlIHdoZXJl\nIHRoZQogICAgICogb2xkIHZhbHVlIGlzIHN0b3JlZAogICAgICogQHBhcmFt\nIHBhcmFtIHRoZSBwYXJhbWV0ZXIgcG9zaXRpb24gY29udGFpbmluZyB0aGUg\nbmV3IHZhbHVlLCBvcgogICAgICogLTEgaWYgdGhlIG5ldyB2YWx1ZSBpcyB1\nbmF2YWlsYWJsZSBhbmQgc2hvdWxkIHRoZXJlZm9yZSBiZSBsb29rZWQKICAg\nICAqIHVwLgogICAgICogQHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5vdGlmeU11dGF0aW9uKENv\nZGUgY29kZSwgRmllbGRNZXRhRGF0YSBmbWQsIGludCB2YWwsCiAgICAgICAg\naW50IHBhcmFtKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIC8vIFBDSGVscGVyLnNldHRpbmdGaWVsZCh0aGlzLCA8\nYWJzb2x1dGUtaW5kZXg+LCBvbGQsIG5ldyk7CiAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoZm1kLmdldEluZGV4KCkpOwogICAgICAgIENsYXNzIHR5cGUgPSBmbWQu\nZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgLy8gd2Ugb25seSBoYXZlIHNw\nZWNpYWwgc2lnbmF0dXJlcyBmb3IgcHJpbWl0aXZlcyBhbmQgU3RyaW5ncwog\nICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gU3Ry\naW5nLmNsYXNzKQogICAgICAgICAgICB0eXBlID0gT2JqZWN0LmNsYXNzOwog\nICAgICAgIGNvZGUueGxvYWQoKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUodHlw\nZSk7CiAgICAgICAgaWYgKHBhcmFtID09IC0xKSB7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBh\nZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKHBhcmFt\nKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIH0KICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3Ms\nICJzZXR0aW5nRmllbGQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXSB7CiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIGludC5j\nbGFzcywgdHlwZSwgdHlwZQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGdpdmVuIGluc3RydWN0aW9uIGFj\nY2Vzc2VzIGEgZmllbGQgdGhhdCBpcyBhIGJhY2tpbmcKICAgICAqIGZpZWxk\nIG9mIGFub3RoZXIgcHJvcGVydHkgaW4gdGhpcyBwcm9wZXJ0eS1hY2Nlc3Mg\nY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0JhY2tpbmdG\naWVsZE9mQW5vdGhlclByb3BlcnR5KFN0cmluZyBuYW1lLCBDb2RlIGNvZGUp\nIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWUgPSBjb2RlLmdldE1ldGhvZCgp\nLmdldE5hbWUoKTsKICAgICAgICByZXR1cm4gISI8aW5pdD4iLmVxdWFscyht\nZXRoTmFtZSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMgIT0gbnVs\nbAogICAgICAgICAgICAmJiAhbmFtZS5lcXVhbHMoX2JhY2tpbmdGaWVsZHMu\nZ2V0KG1ldGhOYW1lKSkKICAgICAgICAgICAgJiYgX2JhY2tpbmdGaWVsZHMu\nY29udGFpbnNWYWx1ZShuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhl\nbHBlciBtZXRob2QgdG8gcmV0dXJuIHRoZSBkZWNsYXJpbmcgUGVyc2lzdGVu\nY2VDYXBhYmxlIGNsYXNzIG9mCiAgICAgKiB0aGUgZ2l2ZW4gZmllbGQuCiAg\nICAgKgogICAgICogQHBhcmFtIGZpZWxkTmFtZSB0aGUgbmFtZSBvZiB0aGUg\nZmllbGQKICAgICAqIEBwYXJhbSBvd25lciB0aGUgbm9taW5hbCBvd25lciBv\nZiB0aGUgZmllbGQKICAgICAqIEByZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0\naGUgUGVyc2lzdGVuY2VDYXBhYmxlIHR5cGUgdGhhdAogICAgICogZGVjbGFy\nZXMgdGhlIGZpZWxkIChhbmQgdGhlcmVmb3JlIGhhcyB0aGUgc3RhdGljIG1l\ndGhvZCksIG9yIG51bGwgaWYgbm9uZQogICAgICovCiAgICBwcml2YXRlIENs\nYXNzTWV0YURhdGEgZ2V0UGVyc2lzdGVuY2VDYXBhYmxlT3duZXIoU3RyaW5n\nIGZpZWxkTmFtZSwKICAgICAgICBDbGFzcyBvd25lcikgewogICAgICAgIC8v\nIGZpbmQgdGhlIGFjdHVhbCBhbmNlc3RvciBjbGFzcyB0aGF0IGRlY2xhcmVz\nIHRoZSBmaWVsZCwgdGhlbgogICAgICAgIC8vIGNoZWNrIGlmIHRoZSBjbGFz\ncyBpcyBwZXJzaXN0ZW50LCBhbmQgaWYgdGhlIGZpZWxkIGlzIG1hbmFnZWQK\nICAgICAgICBGaWVsZCBmID0gUmVmbGVjdGlvbi5maW5kRmllbGQob3duZXIs\nIGZpZWxkTmFtZSwgZmFsc2UpOwogICAgICAgIGlmIChmID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBtYW5hZ2VkIGlu\ndGVyZmFjZQogICAgICAgIGlmIChfbWV0YSAhPSBudWxsICYmIF9tZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKS5pc0ludGVyZmFjZSgpKQogICAgICAgICAgICBy\nZXR1cm4gX21ldGE7CgogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0TWV0YURh\ndGEoZi5nZXREZWNsYXJpbmdDbGFzcygpLCBudWxsLCBmYWxzZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBZGRzIGFsbCBzeW50aGV0aWMgbWV0aG9kcyB0\nbyB0aGUgYnl0ZWNvZGUgYnkgZGVsZWdhdGluZyB0bwogICAgICogdGhlIHZh\ncmlvdXMgYWRkWFhYTWV0aG9kcyAoKSBmdW5jdGlvbnMgaW4gdGhpcyBjbGFz\ncy4gSW5jbHVkZXMKICAgICAqIGFsbCBzdGF0aWMgZmllbGQgYWNjZXNzIG1l\ndGhvZHMuCiAgICAgKiBOb3RlIHRoYXQgdGhlICdzdG9jaycgbWV0aG9kcyBs\naWtlIDxjb2RlPnBjSXNUcmFuc2FjdGlvbmFsPC9jb2RlPiwKICAgICAqIDxj\nb2RlPnBjRmV0Y2hPYmplY3RJZDwvY29kZT4sIGV0YyBhcmUgZGVmaW5lZCBv\nbmx5IGluIHRoZQogICAgICogbGVhc3QtZGVyaXZlZCBQZXJzaXN0ZW5jZUNh\ncGFibGUgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFBDTWV0\naG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgYWRkQ2xlYXJGaWVsZHNNZXRob2QoKTsKICAgICAgICBhZGRO\nZXdJbnN0YW5jZU1ldGhvZCh0cnVlKTsKICAgICAgICBhZGROZXdJbnN0YW5j\nZU1ldGhvZChmYWxzZSk7CiAgICAgICAgYWRkTWFuYWdlZEZpZWxkQ291bnRN\nZXRob2QoKTsKICAgICAgICBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpOwog\nICAgICAgIGFkZFByb3ZpZGVGaWVsZHNNZXRob2RzKCk7CiAgICAgICAgYWRk\nQ29weUZpZWxkc01ldGhvZCgpOwoKICAgICAgICBpZiAoX21ldGEuZ2V0UENT\ndXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKSB7\nCiAgICAgICAgICAgIGFkZFN0b2NrTWV0aG9kcygpOwogICAgICAgICAgICBh\nZGRHZXRWZXJzaW9uTWV0aG9kKCk7CiAgICAgICAgICAgIGFkZFJlcGxhY2VT\ndGF0ZU1hbmFnZXJNZXRob2QoKTsKCiAgICAgICAgICAgIGlmIChfbWV0YS5n\nZXRJZGVudGl0eVR5cGUoKSAhPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FU\nSU9OKQogICAgICAgICAgICAgICAgYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRp\ndHlNZXRob2RzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIGFw\ncCBpZCBtZXRob2RzIHRvIGVhY2ggc3ViY2xhc3MgcmF0aGVyCiAgICAgICAg\nLy8gdGhhbiBqdXN0IHRoZSBzdXBlcmNsYXNzLCBzaW5jZSBpdCBpcyBwb3Nz\naWJsZSB0byBoYXZlCiAgICAgICAgLy8gYSBzdWJjbGFzcyB3aXRoIGFuIGFw\ncCBpZCBoaWVyYXJjaHkgdGhhdCBtYXRjaGVzIHRoZQogICAgICAgIC8vIHBl\ncnNpc3RlbnQgY2xhc3MgaW5oZXJpdGFuY2UgaGllcmFyY2h5CiAgICAgICAg\naWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEu\nSURfQVBQTElDQVRJT04KICAgICAgICAgICAgJiYgKF9tZXRhLmdldFBDU3Vw\nZXJjbGFzcygpID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSB8fAog\nICAgICAgICAgICAgICAgX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgIT0KICAg\nICAgICAgICAgICAgICAgICBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpLmdldE9iamVjdElkVHlwZSgpKSkgewogICAgICAgICAgICBhZGRDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZCh0cnVlKTsKICAgICAgICAgICAg\nYWRkQ29weUtleUZpZWxkc1RvT2JqZWN0SWRNZXRob2QoZmFsc2UpOwogICAg\nICAgICAgICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKHRy\ndWUpOwogICAgICAgICAgICBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElk\nTWV0aG9kKGZhbHNlKTsKICAgICAgICAgICAgYWRkTmV3T2JqZWN0SWRJbnN0\nYW5jZU1ldGhvZCh0cnVlKTsKICAgICAgICAgICAgYWRkTmV3T2JqZWN0SWRJ\nbnN0YW5jZU1ldGhvZChmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIGEgbWV0aG9kIHRvIGNsZWFyIGFsbCBwZXJzaXN0ZW50\nIGZpZWxkczsgd2UnbGwgY2FsbCB0aGlzIGZyb20KICAgICAqIHRoZSBuZXcg\naW5zdGFuY2UgbWV0aG9kIHRvIGVuc3VyZSB0aGF0IHVubG9hZGVkIGZpZWxk\ncyBoYXZlCiAgICAgKiBkZWZhdWx0IHZhbHVlcy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZENsZWFyRmllbGRzTWV0aG9kKCkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwcm90ZWN0\nZWQgdm9pZCBwY0NsZWFyRmllbGRzICgpCiAgICAgICAgQkNNZXRob2QgbWV0\naG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNsZWFyRmllbGRzIiwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgbWV0aG9k\nLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIucGNDbGVhckZpZWxk\ncyAoKQogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBu\ndWxsICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAgICAg\nICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSksIFBSRSArICJDbGVh\nckZpZWxkcyIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBudWxsKTsK\nICAgICAgICB9CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21l\ndGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZt\nZHNbaV0uZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURhdGEuTUFOQUdF\nX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICBzd2l0Y2ggKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBEKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZSgwRik7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgZm1kc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgdGhlIDxjb2RlPnBjTmV3SW5zdGFuY2U8L2NvZGU+IG1ldGhv\nZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKiBUaGVzZSBtZXRob2RzIGFyZSB1\nc2VkIGJ5IHRoZSBpbXBsIGhlbHBlciB0byBjcmVhdGUgbmV3CiAgICAgKiBt\nYW5hZ2VkIGluc3RhbmNlcyBlZmZpY2llbnRseSB3aXRob3V0IHJlZmxlY3Rp\nb24uCiAgICAgKgogICAgICogQHBhcmFtIG9pZCBzZXQgdG8gdHJ1ZSB0byBt\naW1pYyB0aGUgbWV0aG9kIHZlcnNpb24gdGhhdCB0YWtlcwogICAgICogYW4g\nb2lkIHZhbHVlIGFzIHdlbGwgYXMgYSBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGROZXdJbnN0YW5jZU1ldGhvZChib29sZWFu\nIG9pZCkgewogICAgICAgIC8vIHB1YmxpYyBQZXJzaXN0ZW5jZUNhcGFibGUg\ncGNOZXdJbnN0YW5jZSAoLi4uKQogICAgICAgIENsYXNzW10gYXJncyA9CiAg\nICAgICAgICAgIChvaWQpID8gbmV3IENsYXNzW117IFNNVFlQRSwgT2JqZWN0\nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0KICAgICAgICAgICAgICAgIDogbmV3\nIENsYXNzW117IFNNVFlQRSwgYm9vbGVhbi5jbGFzcyB9OwogICAgICAgIEJD\nTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdJ\nbnN0YW5jZSIsIFBDVFlQRSwgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHRoZSB0eXBl\nIGlzIGFic3RyYWN0LCB0aHJvdyBhIFVzZXJFeGNlcHRpb24KICAgICAgICBp\nZiAoX3BjLmlzQWJzdHJhY3QoKSkgewogICAgICAgICAgICB0aHJvd0V4Y2Vw\ndGlvbihjb2RlLCBVU0VSRVhDRVApOwogICAgICAgICAgICBjb2RlLnZyZXR1\ncm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gWFhYIHBjID0g\nbmV3IFhYWCAoKTsKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7\nCiAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNp\nYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwog\nICAgICAgIGludCBpbnN0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKGluc3QpOwoKICAgICAg\nICAvLyBpZiAoY2xlYXIpCiAgICAgICAgLy8gICBwYy5wY0NsZWFyRmllbGRz\nICgpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgob2lkKSA/IDIg\nOiAxKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gbm9jbGVhciA9IGNvZGUu\naWZlcSgpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsK\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsg\nIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywgbnVsbCk7CgogICAgICAgIC8v\nIHBjLnBjU3RhdGVNYW5hZ2VyID0gc207CiAgICAgICAgbm9jbGVhci5zZXRU\nYXJnZXQoY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVs\nZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwoKICAgICAgICAvLyBjb3B5IGtl\neSBmaWVsZHMgZnJvbSBvaWQKICAgICAgICBpZiAob2lkKSB7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWQiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3\nIENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICB9CgogICAgICAg\nIC8vIHJldHVybiBwYzsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwo\naW5zdCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNv\nZGU+cHJvdGVjdGVkIHN0YXRpYyBpbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3Vu\ndCAoKTwvY29kZT4KICAgICAqIG1ldGhvZCB0byB0aGUgYnl0ZWNvZGUsIHJl\ndHVybmluZyB0aGUgaW5oZXJpdGVkIGZpZWxkIGNvdW50IGFkZGVkCiAgICAg\nKiB0byB0aGUgbnVtYmVyIG9mIG1hbmFnZWQgZmllbGRzIGluIHRoZSBjdXJy\nZW50IFBlcnNpc3RlbmNlQ2FwYWJsZSBjbGFzcy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZE1hbmFnZWRGaWVsZENvdW50TWV0aG9kKCkgewogICAg\nICAgIC8vIHByb3RlY3RlZCBzdGF0aWMgaW50IHBjR2V0TWFuYWdlZEZpZWxk\nQ291bnQgKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChQUkUgKyAiR2V0TWFuYWdlZEZpZWxkQ291bnQiLAogICAgICAg\nICAgICBpbnQuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0\naWModHJ1ZSk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAg\nICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgcGNJbmhlcml0ZWRGaWVsZENvdW50\nCiAgICAgICAgLy8gYXdoaXRlOiB0aGUgYWJvdmUgc2hvdWxkIHdvcmssIGJ1\ndCBJJ20gc2VlaW5nIGEgbWVzc2VkIHVwIHNpdHVhdGlvbgogICAgICAgIC8v\nIGFsbCBvZiBhIHN1ZGRlbiB3aGVyZSB3aGVuIGEgc3ViY2xhc3MgY2FsbHMg\ndGhpcyBtZXRob2QsIGl0IHNvbWVob3cKICAgICAgICAvLyBoYXBwZW5zIGJl\nZm9yZSA8Y2xpbml0PiBpcyBldmVyIGludm9rZWQsIGFuZCBzbyBvdXIKICAg\nICAgICAvLyBwY0luaGVyaXRlZEZpZWxkQ291bnQgZmllbGQgaXNuJ3QgaW5p\ndGlhbGl6ZWQhICBzbyBpbnN0ZWFkLAogICAgICAgIC8vIHJldHVybiA8Zmll\nbGRzPiArIDxzdXBlcmNsYXNzPi5wY0dldE1hbmFnZWRGaWVsZENvdW50ICgp\nCiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKF9tZXRhLmdldERl\nY2xhcmVkRmllbGRzKCkubGVuZ3RoKTsKICAgICAgICBpZiAoX21ldGEuZ2V0\nUENTdXBlcmNsYXNzKCkgIT0gbnVsbCkgewogICAgICAgICAgICBDbGFzcyBz\ndXBlckNsYXNzID0gZ2V0VHlwZShfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRh\nRGF0YSgpKTsKICAgICAgICAgICAgU3RyaW5nIHN1cGVyTmFtZSA9IGdldENy\nZWF0ZVN1YmNsYXNzKCkgPwogICAgICAgICAgICAgICAgUENFbmhhbmNlci50\nb1BDU3ViY2xhc3NOYW1lKHN1cGVyQ2xhc3MpIDoKICAgICAgICAgICAgICAg\nIHN1cGVyQ2xhc3MuZ2V0TmFtZSgpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXN0YXRpYygpLnNldE1ldGhvZChzdXBlck5hbWUsCiAgICAgICAgICAgICAg\nICBQUkUgKyAiR2V0TWFuYWdlZEZpZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0\nTmFtZSgpLCBudWxsKTsKICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUuaXJldHVybigpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMg\ndGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNQcm92aWRlRmllbGR9\nIGFuZAogICAgICoge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1Byb3Zp\nZGVGaWVsZHN9IG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkUHJvdmlkZUZpZWxkc01ldGhvZHMoKQogICAg\nICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8v\nIHB1YmxpYyB2b2lkIHBjUHJvdmlkZUZpZWxkIChpbnQgZmllbGROdW1iZXIp\nCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgIlByb3ZpZGVGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGFkZHMgZXZl\ncnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAgICAgICBpbnQgcmVs\nTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxk\nIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxkcyBpbiB0aGlzIGlu\nc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8gX21ldGEuZ2V0Rmll\nbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygp\nOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB0\naHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24u\nY2xhc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzd2l0Y2gg\nKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKHJlbExv\nY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0cnVjdGlvbiB0YWJp\nbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAgICAgIHRhYmlucy5z\nZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRIaWdoKGZtZHMubGVu\nZ3RoIC0gMSk7CgogICAgICAgICAgICAvLyA8ZmllbGQ+ID0gcGNTdGF0ZU1h\nbmFnZXIucHJvdmlkZWQ8dHlwZT5GaWVsZAogICAgICAgICAgICAvLyAgICAg\nKHRoaXMsIGZpZWxkTnVtYmVyKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB0\nYWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVs\nZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5pbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICAg\nICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0U3RhdGVN\nYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgICAgICAgICAgKGZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCksICJwcm92aWRlZCIsIGZhbHNlLCBmYWxzZSkpOwog\nICAgICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGRlZmF1bHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24gKCkKICAgICAgICAgICAgdGFiaW5zLnNldERlZmF1\nbHRUYXJnZXQodGhyb3dFeGNlcHRpb24KICAgICAgICAgICAgICAgIChjb2Rl\nLCBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpKTsKICAgICAgICB9\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICBhZGRNdWx0aXBs\nZUZpZWxkc01ldGhvZFZlcnNpb24obWV0aG9kKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNS\nZXBsYWNlRmllbGR9IGFuZAogICAgICoge0BsaW5rIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSNwY1JlcGxhY2VGaWVsZHN9IG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2Rl\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVwbGFjZUZpZWxkc01l\ndGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjUmVwbGFjZUZpZWxkIChpbnQg\nZmllbGROdW1iZXIpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIlJlcGxhY2VGaWVsZCIsIHZvaWQuY2xhc3Ms\nCiAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAg\nIC8vIGFkZHMgZXZlcnl0aGluZyB0aHJvdWdoIHRoZSBzd2l0Y2ggKCkKICAg\nICAgICBpbnQgcmVsTG9jYWwgPSBiZWdpblN3aXRjaE1ldGhvZChQUkUgKyAi\nUmVwbGFjZUZpZWxkIiwgY29kZSk7CgogICAgICAgIC8vIGlmIG5vIGZpZWxk\ncyBpbiB0aGlzIGluc3QsIGp1c3QgdGhyb3cgZXhjZXB0aW9uCiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8g\nX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNs\nYXJlZEZpZWxkcygpOwogICAgICAgIGlmIChmbWRzLmxlbmd0aCA9PSAwKQog\nICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGVsc2UgewogICAgICAgICAg\nICAvLyBzd2l0Y2ggKHZhbCkKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNl\ndExvY2FsKHJlbExvY2FsKTsKICAgICAgICAgICAgVGFibGVTd2l0Y2hJbnN0\ncnVjdGlvbiB0YWJpbnMgPSBjb2RlLnRhYmxlc3dpdGNoKCk7CiAgICAgICAg\nICAgIHRhYmlucy5zZXRMb3coMCk7CiAgICAgICAgICAgIHRhYmlucy5zZXRI\naWdoKGZtZHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAvLyA8ZmllbGQ+\nID0gcGNTdGF0ZU1hbmFnZXIucmVwbGFjZTx0eXBlPkZpZWxkCiAgICAgICAg\nICAgIC8vICAodGhpcywgZmllbGROdW1iZXIpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIC8vIGZvciB0aGUgYWRkU2V0TWFuYWdlZFZhbHVlQ29kZSBjYWxs\nIGJlbG93LgogICAgICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CgogICAgICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7\nCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKGdldFN0YXRlTWFuYWdlck1ldGhvZAogICAgICAgICAgICAgICAg\nICAgIChmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgpLCAicmVwbGFjZSIsIHRy\ndWUsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBpZiAoIWZtZHNbaV0uZ2V0\nRGVjbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUoKSkKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1kc1tpXS5nZXREZWNs\nYXJlZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgYWRkU2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICAgICAgICAgIGNvZGUu\ndnJldHVybigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkZWZh\ndWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uICgpCiAg\nICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93RXhjZXB0\naW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKCiAgICAgICAgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RWZXJzaW9u\nKG1ldGhvZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxp\nbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjQ29weUZpZWxkc30gbWV0aG9kIHRv\nIHRoZSBieXRlY29kZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENv\ncHlGaWVsZHNNZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RF\neGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUZpZWxk\nIChPYmplY3QgcGMsIGludCBmaWVsZCkKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUZpZWxkIiwKICAg\nICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCksCiAgICAgICAgICAgIG5l\ndyBTdHJpbmdbXXsgX21hbmFnZWRUeXBlLmdldE5hbWUoKSwgaW50LmNsYXNz\nLmdldE5hbWUoKSB9KTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgp\nOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoK\nICAgICAgICAvLyBhZGRzIGV2ZXJ5dGhpbmcgdGhyb3VnaCB0aGUgc3dpdGNo\nICgpCiAgICAgICAgaW50IHJlbExvY2FsID0gYmVnaW5Td2l0Y2hNZXRob2Qo\nUFJFICsgIkNvcHlGaWVsZCIsIGNvZGUpOwoKICAgICAgICAvLyBpZiBubyBm\naWVsZHMgaW4gdGhpcyBpbnN0LCBqdXN0IHRocm93IGV4Y2VwdGlvbgogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDogX21ldGEuZ2V0\nRGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoZm1kcy5sZW5ndGggPT0g\nMCkKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgLy8gc3dpdGNoICh2YWwpCiAgICAgICAgICAgIGNvZGUuaWxvYWQo\nKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAgIFRhYmxlU3dpdGNo\nSW5zdHJ1Y3Rpb24gdGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgpOwogICAg\nICAgICAgICB0YWJpbnMuc2V0TG93KDApOwogICAgICAgICAgICB0YWJpbnMu\nc2V0SGlnaChmbWRzLmxlbmd0aCAtIDEpOwoKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAvLyA8ZmllbGQ+ID0gb3RoZXIuPGZpZWxkPjsKICAgICAgICAgICAg\nICAgIC8vIG9yIHNldDxmaWVsZD4gKG90aGVyLmdldDxmaWVsZD4pOwogICAg\nICAgICAgICAgICAgdGFiaW5zLmFkZFRhcmdldChsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLmFsb2Fk\nKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0sIGZhbHNlKTsKICAgICAgICAgICAg\nICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7Cgog\nICAgICAgICAgICAgICAgLy8gYnJlYWs7CiAgICAgICAgICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVm\nYXVsdDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQog\nICAgICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2Vw\ndGlvbgogICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbi5jbGFzcykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CgogICAgICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lv\nbihtZXRob2QpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB0byBhZGQgdGhlIGNvZGUgY29tbW9uIHRvIHRoZSBiZWdpbm5pbmcgb2Yg\nYm90aCB0aGUKICAgICAqIHBjUmVwbGFjZUZpZWxkIG1ldGhvZCBhbmQgdGhl\nIHBjUHJvdmlkZUZpZWxkIG1ldGhvZC4gVGhpcyBpbmNsdWRlcwogICAgICog\nY2FsY3VsYXRpbmcgdGhlIHJlbGF0aXZlIGZpZWxkIG51bWJlciBvZiB0aGUg\nZGVzaXJlZCBmaWVsZCBhbmQgY2FsbGluZwogICAgICogdGhlIHN1cGVyY2xh\nc3MgaWYgbmVjZXNzYXJ5LgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGlu\nZGV4IGluIHdoaWNoIHRoZSBsb2NhbCB2YXJpYWJsZSBob2xkaW5nIHRoZSBy\nZWxhdGl2ZQogICAgICogZmllbGQgbnVtYmVyIGlzIHN0b3JlZAogICAgICov\nCiAgICBwcml2YXRlIGludCBiZWdpblN3aXRjaE1ldGhvZChTdHJpbmcgbmFt\nZSwgQ29kZSBjb2RlKSB7CiAgICAgICAgYm9vbGVhbiBjb3B5ID0gKFBSRSAr\nICJDb3B5RmllbGQiKS5lcXVhbHMobmFtZSk7CiAgICAgICAgaW50IGZpZWxk\nTnVtYmVyID0gKGNvcHkpID8gMSA6IDA7CgogICAgICAgIGludCByZWxMb2Nh\nbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgaWYgKGdl\ndENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgY29kZS5pbG9hZCgp\nLnNldFBhcmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICAgICAgY29kZS5pc3Rv\ncmUoKS5zZXRMb2NhbChyZWxMb2NhbCk7CiAgICAgICAgICAgIHJldHVybiBy\nZWxMb2NhbDsKICAgICAgICB9CgogICAgICAgIC8vIGludCByZWwgPSBmaWVs\nZE51bWJlciAtIHBjSW5oZXJpdGVkRmllbGRDb3VudAogICAgICAgIGNvZGUu\naWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAg\nICAgIGNvZGUuaXN1YigpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9j\nYWwocmVsTG9jYWwpOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChy\nZWxMb2NhbCk7CgogICAgICAgIC8vIHN1cGVyOiBpZiAocmVsIDwgMCkgc3Vw\nZXIucGNSZXBsYWNlRmllbGQgKGZpZWxkTnVtYmVyKTsgcmV0dXJuOwogICAg\nICAgIC8vIG5vIHN1cGVyOiBpZiAocmVsIDwgMCkgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbiAoKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gaWZpbnMgPSBjb2RlLmlmZ2UoKTsKICAgICAgICBpZiAoX21ldGEuZ2V0\nUENTdXBlcmNsYXNzKCkgIT0gbnVsbCkgewogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgU3RyaW5n\nW10gYXJnczsKICAgICAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAg\nICAgIGFyZ3MgPSBuZXcgU3RyaW5nW117IGdldFR5cGUoX21ldGEuZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0\nTmFtZSgpLCBpbnQuY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBTdHJpbmdbXXsgaW50LmNs\nYXNzLmdldE5hbWUoKSB9OwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0\nUGFyYW0oZmllbGROdW1iZXIpOwogICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAg\nICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5hbWUoKSwgbmFt\nZSwgCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJn\ncyk7CiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIH0gZWxz\nZQogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24uY2xhc3MpOwoKICAgICAgICBpZmlucy5zZXRUYXJn\nZXQoY29kZS5ub3AoKSk7CiAgICAgICAgcmV0dXJuIHJlbExvY2FsOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhpcyBoZWxwZXIgbWV0aG9kLCBnaXZlbiB0\naGUgcGNSZXBsYWNlRmllbGQgb3IgcGNQcm92aWRlRmllbGQKICAgICAqIG1l\ndGhvZCwgYWRkcyB0aGUgYnl0ZWNvZGUgZm9yIHRoZSBjb3JyZXNwb25kaW5n\nICdwbHVyYWwnIHZlcnNpb24KICAgICAqIG9mIHRoZSBtZXRob2QgLS0gdGhl\nIHZlcnNpb24gdGhhdCB0YWtlcyBhbiBpbnRbXSBvZiBmaWVsZHMgdG8KICAg\nICAqIHRvIGFjY2VzcyByYXRoZXIgdGhhbiBhIHNpbmdsZSBmaWVsZC4gVGhl\nIG11bHRpcGxlIGZpZWxkcyB2ZXJzaW9uCiAgICAgKiBzaW1wbHkgbG9vcHMg\ndGhyb3VnaCB0aGUgcHJvdmlkZWQgaW5kZXhlcyBhbmQgZGVsZWdhdGVzIHRv\nIHRoZQogICAgICogc2luZ3VsYXIgdmVyc2lvbiBmb3IgZWFjaCBvbmUuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRNdWx0aXBsZUZpZWxkc01ldGhv\nZFZlcnNpb24oQkNNZXRob2Qgc2luZ2xlKSB7CiAgICAgICAgYm9vbGVhbiBj\nb3B5ID0gKFBSRSArICJDb3B5RmllbGQiKS5lcXVhbHMoc2luZ2xlLmdldE5h\nbWUoKSk7CgogICAgICAgIC8vIHB1YmxpYyB2b2lkIDxtZXRob2Q+cyAoaW50\nW10gZmllbGRzKQogICAgICAgIENsYXNzW10gYXJncyA9IChjb3B5KSA/IG5l\ndyBDbGFzc1tdeyBPYmplY3QuY2xhc3MsIGludFtdLmNsYXNzIH0KICAgICAg\nICAgICAgOiBuZXcgQ2xhc3NbXXsgaW50W10uY2xhc3MgfTsKICAgICAgICBC\nQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChzaW5nbGUuZ2V0\nTmFtZSgpICsgInMiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBhcmdzKTsK\nICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAg\nICAgICAgaW50IGZpZWxkTnVtYmVycyA9IDA7CiAgICAgICAgaW50IGluc3Qg\nPSAwOwogICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgIGZpZWxkTnVt\nYmVycyA9IDE7CgogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSkgewogICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBtYW5hZ2VkIGluc3Rh\nbmNlIGludG8gdGhlIGxvY2FsIHZhcmlhYmxlIHRhYmxlCiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChJbXBsSGVscGVyLmNs\nYXNzLAogICAgICAgICAgICAgICAgICAgICJnZXRNYW5hZ2VkSW5zdGFuY2Ui\nLCBPYmplY3QuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgICAgICBjb2RlLmNo\nZWNrY2FzdCgpLnNldFR5cGUoX21hbmFnZWRUeXBlKTsKICAgICAgICAgICAg\nICAgIGluc3QgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAg\nICAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpbnN0KTsKCiAgICAg\nICAgICAgICAgICAvLyB0aGVyZSBtaWdodCBiZSBhIGRpZmZlcmVuY2UgYmV0\nd2VlbiB0aGUgY2xhc3NlcyBvZiAndGhpcycKICAgICAgICAgICAgICAgIC8v\nIHZzICdvdGhlcicgaW4gdGhpcyBjb250ZXh0OyB1c2UgdGhlIFBDIG1ldGhv\nZHMgdG8gZ2V0IHRoZSBTTQogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFRoaXMoKTsKICAgICAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRG\naWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3RhdGljKCkuc2V0TWV0aG9kKEltcGxIZWxwZXIuY2xhc3MsCiAgICAgICAg\nICAgICAgICAgICAgInRvUGVyc2lzdGVuY2VDYXBhYmxlIiwgUGVyc2lzdGVu\nY2VDYXBhYmxlLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFz\nc1tdIHsgT2JqZWN0LmNsYXNzLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChQZXJz\naXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgInBj\nR2V0U3RhdGVNYW5hZ2VyIiwgU3RhdGVNYW5hZ2VyLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFhYWCBv\ndGhlciA9IChYWFgpIHBjOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKF9wYyk7CiAgICAgICAgICAgICAgICBpbnN0ID0gY29kZS5n\nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgICAgIGNvZGUuYXN0\nb3JlKCkuc2V0TG9jYWwoaW5zdCk7CgogICAgICAgICAgICAgICAgLy8gYWNj\nZXNzIHRoZSBvdGhlcidzIHNtIGZpZWxkIGRpcmVjdGx5CiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIChvdGhlci5wY1N0YXRl\nTWFuYWdlciAhPSBwY1N0YXRlTWFuYWdlcikKICAgICAgICAgICAgLy8JdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbgoKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZmFjbXBlcSgp\nOwogICAgICAgICAgICB0aHJvd0V4Y2VwdGlvbihjb2RlLCBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBpZmlucy5zZXRU\nYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAgICAgICAvLyBpZiAocGNTdGF0\nZU1hbmFnZXIgPT0gbnVsbCkKICAgICAgICAgICAgLy8gIHRocm93IG5ldyBJ\nbGxlZ2FsU3RhdGVFeGNlcHRpb24KICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgaWZpbnMg\nPSBjb2RlLmlmbm9ubnVsbCgpOwogICAgICAgICAgICB0aHJvd0V4Y2VwdGlv\nbihjb2RlLCBJbGxlZ2FsU3RhdGVFeGNlcHRpb24uY2xhc3MpOwogICAgICAg\nICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBmb3IgKGludCBpID0gMDsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAgaW50IGlkeCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRM\nb2NhbChpZHgpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiB0ZXN0aW5zID0g\nY29kZS5nbzIoKTsKCiAgICAgICAgLy8gPG1ldGhvZD4gKGZpZWxkc1tpXSk7\nCiAgICAgICAgSW5zdHJ1Y3Rpb24gYm9keWlucyA9IGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGlmIChjb3B5KQogICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaW5zdCk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKGZpZWxkTnVtYmVycyk7CiAgICAgICAgY29k\nZS5pbG9hZCgpLnNldExvY2FsKGlkeCk7CiAgICAgICAgY29kZS5pYWxvYWQo\nKTsKICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qoc2lu\nZ2xlKTsKCiAgICAgICAgLy8gaSsrOwogICAgICAgIGNvZGUuaWluYygpLnNl\ndEluY3JlbWVudCgxKS5zZXRMb2NhbChpZHgpOwoKICAgICAgICAvLyBpIDwg\nZmllbGRzLmxlbmd0aAogICAgICAgIHRlc3RpbnMuc2V0VGFyZ2V0KGNvZGUu\naWxvYWQoKS5zZXRMb2NhbChpZHgpKTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oZmllbGROdW1iZXJzKTsKICAgICAgICBjb2RlLmFycmF5bGVu\nZ3RoKCk7CiAgICAgICAgY29kZS5pZmljbXBsdCgpLnNldFRhcmdldChib2R5\naW5zKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nTG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSAnc3Rv\nY2snIG1ldGhvZHMgdG8gdGhlIGJ5dGVjb2RlOyB0aGVzZSBpbmNsdWRlIG1l\ndGhvZHMKICAgICAqIGxpa2Uge0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNw\nY0ZldGNoT2JqZWN0SWR9CiAgICAgKiBhbmQge0BsaW5rIFBlcnNpc3RlbmNl\nQ2FwYWJsZSNwY0lzVHJhbnNhY3Rpb25hbH0uCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRTdG9ja01ldGhvZHMoKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIHBjR2V0R2VuZXJpY0NvbnRleHQKICAgICAgICAgICAgdHJhbnNsYXRl\nRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAgIChNZXRo\nb2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0\naW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJnZXQiICsg\nQ09OVEVYVE5BTUUsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAog\nICAgICAgICAgICAvLyBwY0ZldGNoT2JqZWN0SWQKICAgICAgICAgICAgdHJh\nbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAg\nIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0\naG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJm\nZXRjaE9iamVjdElkIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAg\nCiAgICAgICAgICAgIC8vIHBjSXNEZWxldGVkCiAgICAgICAgICAgIHRyYW5z\nbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICAo\nTWV0aG9kKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhv\nZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNE\nZWxldGVkIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAgCiAgICAg\nICAgICAgIC8vIHBjSXNEaXJ0eQogICAgICAgICAgICB0cmFuc2xhdGVGcm9t\nU3RhdGVNYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkg\nQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAg\nICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24o\nCiAgICAgICAgICAgICAgICAgICAgICAgIFNNVFlQRSwgImlzRGlydHkiLCAo\nQ2xhc3NbXSkgbnVsbCkpLCB0cnVlKTsKICAgIAogICAgICAgICAgICAvLyBw\nY0lzTmV3CiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJN\nZXRob2QoCiAgICAgICAgICAgICAgICAoTWV0aG9kKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgU01UWVBFLCAiaXNOZXciLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc1BlcnNpc3RlbnQK\nICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgK\nICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Q\ncml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVy\nLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAg\nICAgICBTTVRZUEUsICJpc1BlcnNpc3RlbnQiLCAoQ2xhc3NbXSkgbnVsbCkp\nLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNJc1RyYW5zYWN0aW9u\nYWwKICAgICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhv\nZCgKICAgICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICBTTVRZUEUsICJpc1RyYW5zYWN0aW9uYWwiLCAoQ2xhc3NbXSkg\nbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNTZXJpYWxp\nemluZwogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2VyTWV0\naG9kKAogICAgICAgICAgICAgICAgKE1ldGhvZCkgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIFNNVFlQRSwgInNlcmlhbGl6aW5nIiwgKENsYXNzW10pIG51\nbGwpKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjRGlydHkKICAg\nICAgICAgICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAg\nICAgICAgICAgICAgIChNZXRob2QpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2\naWxlZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdl\ndERlY2xhcmVkTWV0aG9kQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAg\nICBTTVRZUEUsICJkaXJ0eSIsIG5ldyBDbGFzc1tdeyBTdHJpbmcuY2xhc3Mg\nfSkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAgLy8gcGNHZXRTdGF0ZU1h\nbmFnZXIKICAgICAgICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArICJHZXRTdGF0ZU1hbmFnZXIiLAogICAgICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VyLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgQ29k\nZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTdGF0ZU1hbmFnZXIuY2xhc3Mp\nOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgICAgIH0gY2F0Y2ggKFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24gcGFlKSB7CiAgICAgICAgICAgICB0aHJvdyAoTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uKSBwYWUuZ2V0RXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBh\nZGQgYSBzdG9jayBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLiBFYWNoCiAgICAg\nKiBzdG9jayBtZXRob2Qgc2ltcGx5IGRlbGVnYXRlcyB0byBhIGNvcnJlc3Bv\nbmRpbmcgU3RhdGVNYW5hZ2VyIG1ldGhvZC4KICAgICAqIEdpdmVuIHRoZSBT\ndGF0ZU1hbmFnZXIgbWV0aG9kLCB0aGVuLCB0aGlzIGZ1bmN0aW9uIHRyYW5z\nbGF0ZXMgaXQgaW50bwogICAgICogdGhlIHdyYXBwZXIgbWV0aG9kIHRoYXQg\nc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSBieXRlY29kZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2Qo\nTWV0aG9kIG0sCiAgICAgICAgYm9vbGVhbiBpc0RpcnR5Q2hlY2tNZXRob2Qp\nIHsKICAgICAgICAvLyBmb3JtIHRoZSBuYW1lIG9mIHRoZSBtZXRob2QgYnkg\ncHJlcGVuZGluZyAncGMnIHRvIHRoZSBzbSBtZXRob2QKICAgICAgICBTdHJp\nbmcgbmFtZSA9IFBSRSArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUobS5nZXRO\nYW1lKCkpOwogICAgICAgIENsYXNzW10gcGFyYW1zID0gbS5nZXRQYXJhbWV0\nZXJUeXBlcygpOwogICAgICAgIENsYXNzIHJldHVyblR5cGUgPSBtLmdldFJl\ndHVyblR5cGUoKTsKCiAgICAgICAgLy8gYWRkIHRoZSBtZXRob2QgdG8gdGhl\nIHBjCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QobmFtZSwgcmV0dXJuVHlwZSwgcGFyYW1zKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYgKHBj\nU3RhdGVNYW5hZ2VyID09IG51bGwpIHJldHVybiA8ZGVmYXVsdD47CiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAg\nICAgICAgaWYgKHJldHVyblR5cGUuZXF1YWxzKGJvb2xlYW4uY2xhc3MpKQog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwog\nICAgICAgIGVsc2UgaWYgKCFyZXR1cm5UeXBlLmVxdWFscyh2b2lkLmNsYXNz\nKSkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAg\nICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKHJldHVyblR5cGUpOwoKICAg\nICAgICAvLyBpZiB0aGlzIGlzIHRoZSBkaXJ0eS1jaGVjayBtZXRob2QgYW5k\nIHdlJ3JlIHN1YmNsYXNzaW5nIGJ1dCBub3QKICAgICAgICAvLyByZWRlZmlu\naW5nLCBob29rIGludG8gUENIZWxwZXIgdG8gZG8gdGhlIGRpcnR5IGNoZWNr\nCiAgICAgICAgaWYgKGlzRGlydHlDaGVja01ldGhvZCAmJiAhZ2V0UmVkZWZp\nbmUoKSkgewogICAgICAgICAgICAvLyBSZWRlZmluaXRpb25IZWxwZXIuZGly\ndHlDaGVjayhzbSk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAg\nICAgY29kZS5kdXAoKTsgLy8gZm9yIHRoZSByZXR1cm4gc3RhdGVtZW50IGJl\nbG93CiAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywgCiAgICAgICAgICAgICAgICAi\nZGlydHlDaGVjayIsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgU01UWVBF\nIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmaW5zLnNldFRh\ncmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAg\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gcmV0dXJuIHBjU3RhdGVN\nYW5hZ2VyLjxtZXRob2Q+ICg8YXJncz4pOwogICAgICAgIC8vIG1hbmFnZWQg\naW5zdGFuY2UgbG9hZGVkIGFib3ZlIGluIGlmLWVsc2UgYmxvY2sKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAg\nICAgICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGkpOwogICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKG0pOwogICAgICAgIGNv\nZGUueHJldHVybigpLnNldFR5cGUocmV0dXJuVHlwZSk7CgogICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUg\ne0BsaW5rIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY0dldFZlcnNpb259IG1ldGhv\nZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRHZXRWZXJzaW9uTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0VmVyc2lvbiIsIE9iamVjdC5jbGFz\ncywKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFu\nYWdlciA9PSBudWxsKQogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChT\nTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBj\nb2RlLmlmbm9ubnVsbCgpOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmVyc2lv\nbkZpZWxkID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CgogICAgICAgIGlm\nICh2ZXJzaW9uRmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldE51bGwoKTsgLy8gcmV0dXJuIG51bGw7CiAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgIC8vIHJldHVybiA8dmVyc2lvbkZpZWxkPjsKICAg\nICAgICAgICAgQ2xhc3Mgd3JhcHBlciA9IHRvUHJpbWl0aXZlV3JhcHBlcih2\nZXJzaW9uRmllbGQpOwogICAgICAgICAgICBpZiAod3JhcHBlciAhPSB2ZXJz\naW9uRmllbGQuZ2V0RGVjbGFyZWRUeXBlKCkpIHsKICAgICAgICAgICAgICAg\nIGNvZGUuYW5ldygpLnNldFR5cGUod3JhcHBlcik7CiAgICAgICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHZlcnNpb25GaWVsZCk7CiAgICAg\nICAgICAgIGlmICh3cmFwcGVyICE9IHZlcnNpb25GaWVsZC5nZXREZWNsYXJl\nZFR5cGUoKSkKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgp\nLnNldE1ldGhvZCh3cmFwcGVyLCAiPGluaXQ+Iiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgdmVyc2lvbkZpZWxkLmdl\ndERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIH0KICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKCiAgICAgICAgLy8gcmV0dXJuIHBjU3RhdGVNYW5hZ2VyLmdl\ndFZlcnNpb24gKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbnZv\na2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBFLCAiZ2V0VmVyc2lvbiIs\nIE9iamVjdC5jbGFzcywKICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSB2ZXJzaW9uIGZpZWxkIHR5cGUg\nYXMgYSBwcmltaXRpdmUgd3JhcHBlciwgb3IgbnVsbCBpZgogICAgICogdGhl\nIHZlcnNpb24gZmllbGQgaXMgbm90IHByaW1pdGl2ZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBDbGFzcyB0b1ByaW1pdGl2ZVdyYXBwZXIoRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoK\nICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuLmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgcmV0\ndXJuIEJ5dGUuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNI\nQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gQ2hhcmFjdGVyLmNsYXNzOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gRG91YmxlLmNsYXNzOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJldHVybiBGbG9hdC5j\nbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAg\nICAgICAgICAgcmV0dXJuIEludGVnZXIuY2xhc3M7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gTG9u\nZy5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gU2hvcnQuY2xhc3M7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIHRoZSB7QGxpbmsgUGVyc2lzdGVuY2VDYXBh\nYmxlI3BjUmVwbGFjZVN0YXRlTWFuYWdlcn0KICAgICAqIG1ldGhvZCB0byB0\naGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRSZXBs\nYWNlU3RhdGVNYW5hZ2VyTWV0aG9kKCkgewogICAgICAgIC8vIHB1YmxpYyB2\nb2lkIHBjUmVwbGFjZVN0YXRlTWFuYWdlciAoU3RhdGVNYW5hZ2VyIHNtKQog\nICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJSZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAgdm9pZC5j\nbGFzcywgbmV3IENsYXNzW117IFNNVFlQRSB9KTsKICAgICAgICBtZXRob2Qu\nc2V0U3luY2hyb25pemVkKHRydWUpOwogICAgICAgIG1ldGhvZC5nZXRFeGNl\ncHRpb25zKHRydWUpLmFkZEV4Y2VwdGlvbihTZWN1cml0eUV4Y2VwdGlvbi5j\nbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIGlmIChwY1N0YXRlTWFuYWdlciAhPSBudWxsKQog\nICAgICAgIC8vCXBjU3RhdGVNYW5hZ2VyID0gcGNTdGF0ZU1hbmFnZXIucmVw\nbGFjZVN0YXRlTWFuYWdlcihzbSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNl\ndEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBp\nZmlucyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChTTVRZUEUsICJyZXBsYWNlU3RhdGVNYW5hZ2VyIiwKICAgICAgICAgICAg\nU01UWVBFLCBuZXcgQ2xhc3NbXXsgU01UWVBFIH0pOwogICAgICAgIGNvZGUu\ncHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2Rl\nLnZyZXR1cm4oKTsKCiAgICAgICAgLy8gU2VjdXJpdHlNYW5hZ2VyIHNlYyA9\nIFN5c3RlbS5nZXRTZWN1cml0eU1hbmFnZXIgKCk7CiAgICAgICAgLy8gaWYg\nKHNlYyAhPSBudWxsKQogICAgICAgIC8vCQlzZWMuY2hlY2tQZXJtaXNzaW9u\nIChQZXJtaXNzaW9uLlNFVF9TVEFURV9NQU5BR0VSKTsKICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQoY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoU3lz\ndGVtLmNsYXNzLAogICAgICAgICAgICAiZ2V0U2VjdXJpdHlNYW5hZ2VyIiwg\nU2VjdXJpdHlNYW5hZ2VyLmNsYXNzLCBudWxsKSk7CgogICAgICAgIC8vIHBj\nU3RhdGVNYW5hZ2VyID0gc207CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAgICAgICBjb2Rl\nLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5wdXRmaWVsZCgp\nLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUudnJldHVybigp\nOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZXMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBtZXRob2RzIGRl\nYWxpbmcgd2l0aCBhcHBsaWNhdGlvbgogICAgICogaWRlbnRpdHkgYW5kIGdp\ndmVzIHRoZW0gbm8tb3AgaW1wbGVtZW50YXRpb25zLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgYWRkTm9PcEFwcGxpY2F0aW9uSWRlbnRpdHlNZXRob2Rz\nKCkgewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc1Rv\nT2JqZWN0SWQgKE9iamVjdElkRmllbGRTdXBwbGllciBmcywKICAgICAgICAv\nLyAJT2JqZWN0IG9pZCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0SWQi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT0lERlNU\nWVBFLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8g\ncHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0\nIG9pZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUg\nKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lk\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAg\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNGcm9tT2Jq\nZWN0SWQgKE9iamVjdElkRmllbGRDb25zdW1lciBmYywKICAgICAgICAvLwlP\nYmplY3Qgb2lkKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9JREZDVFlQRSwgT2JqZWN0\nLmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0Nv\ncHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQgKE9iamVjdCBvaWQpCiAgICAgICAg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVs\nZHNGcm9tT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcg\nQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIGNvZGUgPSBtZXRo\nb2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwoKICAgICAgICAvLyBw\ndWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoKQogICAgICAg\nIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJOZXdPYmplY3RJ\nZEluc3RhbmNlIiwKICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsK\nICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVi\nbGljIE9iamVjdCBwY05ld09iamVjdElkSW5zdGFuY2UgKE9iamVjdCBvYmop\nCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIk5l\nd09iamVjdElkSW5zdGFuY2UiLAogICAgICAgICAgICBPYmplY3QuY2xhc3Ms\nIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRo\nZSA8Y29kZT5wY0NvcHlLZXlGaWVsZHNUb09iamVjdElkPC9jb2RlPiBtZXRo\nb2RzCiAgICAgKiB0byBjbGFzc2VzIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50\naXR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUtleUZpZWxk\nc1RvT2JqZWN0SWRNZXRob2QoYm9vbGVhbiBmaWVsZE1hbmFnZXIpCiAgICAg\nICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\ncHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZCAoT2JqZWN0\nSWRGaWVsZFN1cHBsaWVyIGZzLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAg\nICAgICAgU3RyaW5nW10gYXJncyA9IChmaWVsZE1hbmFnZXIpID8KICAgICAg\nICAgICAgbmV3IFN0cmluZ1tdeyBPSURGU1RZUEUuZ2V0TmFtZSgpLCBPYmpl\nY3QuY2xhc3MuZ2V0TmFtZSgpIH0KICAgICAgICAgICAgOiBuZXcgU3RyaW5n\nW117IE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICBCQ01ldGhv\nZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZp\nZWxkc1RvT2JqZWN0SWQiLAogICAgICAgICAgICB2b2lkLmNsYXNzLmdldE5h\nbWUoKSwgYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CgogICAgICAgIC8vIHNpbmdsZSBmaWVsZCBpZGVudGl0eSBh\nbHdheXMgdGhyb3dzIGV4Y2VwdGlvbgogICAgICAgIGlmIChfbWV0YS5pc09w\nZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIHRocm93RXhjZXB0aW9u\nKGNvZGUsIElOVEVSTkVYQ0VQKTsKICAgICAgICAgICAgY29kZS52cmV0dXJu\nKCk7CgogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGNhbGwgc3VwZXJj\nbGFzcyBtZXRob2QKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNz\nKCkgIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKGkpOwogICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoZ2V0VHlw\nZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgIFBSRSArICJDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZCIsIHZvaWQuY2xhc3MuZ2V0TmFtZSgpLCBh\ncmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIE9iamVjdCBpZCA9IG9pZDsK\nICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKQogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CgogICAgICAgIGlmIChfbWV0YS5p\nc09iamVjdElkVHlwZVNoYXJlZCgpKSB7CiAgICAgICAgICAgIC8vIG9pZCA9\nICgoT2JqZWN0SWQpIGlkKS5nZXRJZCAoKTsKICAgICAgICAgICAgY29kZS5j\naGVja2Nhc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAg\nICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNs\nYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBu\ndWxsKTsKICAgICAgICB9CgogICAgICAgIC8vIDxvaWQgdHlwZT4gaWQgPSAo\nPG9pZCB0eXBlPikgb2lkOwogICAgICAgIGludCBpZCA9IGNvZGUuZ2V0TmV4\ndExvY2Fsc0luZGV4KCk7CiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRh\nLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShvaWRUeXBlKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExv\nY2FsKGlkKTsKCiAgICAgICAgLy8gaW50IGluaGVyaXRlZCA9IHBjSW5oZXJp\ndGVkRmllbGRDb3VudDsKICAgICAgICBpbnQgaW5oZXJpdGVkID0gMDsKICAg\nICAgICBpZiAoZmllbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAg\nICAgICAgaW5oZXJpdGVkID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsK\nICAgICAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRMb2NhbChpbmhlcml0ZWQp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gaWQuPGZpZWxkPiA9IGZzLmZldGNo\nPHR5cGU+RmllbGQgKDxpbmRleD4pOyBvci4uLgogICAgICAgIC8vIGlkLjxm\naWVsZD4gPSBwYy48ZmllbGQ+OwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\nbWRzID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygp\nCiAgICAgICAgICAgIDogX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAg\nICAgICBDbGFzcyB0eXBlOwogICAgICAgIFN0cmluZyBuYW1lOwogICAgICAg\nIEZpZWxkIGZpZWxkOwogICAgICAgIE1ldGhvZCBzZXR0ZXI7CiAgICAgICAg\nYm9vbGVhbiByZWZsZWN0OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0u\naXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKCiAgICAgICAg\nICAgIG5hbWUgPSBmbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlw\nZSA9IGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAg\nICAgaWYgKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRh\nLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICAgICAgc2V0dGVyID0gbnVs\nbDsKICAgICAgICAgICAgICAgIGZpZWxkID0gUmVmbGVjdGlvbi5maW5kRmll\nbGQob2lkVHlwZSwgbmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZWZs\nZWN0ID0gIU1vZGlmaWVyLmlzUHVibGljKGZpZWxkLmdldE1vZGlmaWVycygp\nKTsKICAgICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlw\nZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAKICAg\nICAgICAgICAgICAgICAgICAgICAgImZpbmRGaWVsZCIsIEZpZWxkLmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7IENsYXNzLmNsYXNzLAogICAgICAgICAgICAgICAg\nICAgICAgICBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBmaWVsZCA9IG51bGw7CiAgICAgICAgICAgICAgICBzZXR0ZXIgPSBS\nZWZsZWN0aW9uLmZpbmRTZXR0ZXIob2lkVHlwZSwgbmFtZSwgdHlwZSwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICByZWZsZWN0ID0gIU1vZGlmaWVyLmlzUHVi\nbGljKHNldHRlci5nZXRNb2RpZmllcnMoKSk7CiAgICAgICAgICAgICAgICBp\nZiAocmVmbGVjdCkgewogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Nj\nb25zdGFudCgpLnNldENsYXNzKG9pZFR5cGUpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyh0eXBl\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywgCiAgICAgICAgICAg\nICAgICAgICAgICAgICJmaW5kU2V0dGVyIiwgTWV0aG9kLmNsYXNzLCBuZXcg\nQ2xhc3NbXSB7IENsYXNzLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcuY2xhc3MsIENsYXNzLmNsYXNzLCBib29sZWFuLmNsYXNzIH0p\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoZmllbGRNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgICAgICBjb2RlLmlsb2Fk\nKCkuc2V0TG9jYWwoaW5oZXJpdGVkKTsKICAgICAgICAgICAgICAgIGNvZGUu\naWFkZCgpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QKICAgICAgICAgICAgICAgICAgICAoZ2V0RmllbGRTdXBw\nbGllck1ldGhvZCh0eXBlKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1kc1tp\nXS5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuT0JK\nRUNUKSB7CiAgICAgICAgICAgICAgICAJY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgICAgIAljb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJ\nZCIsIAogICAgICAgICAgICAJCQlPYmplY3QuY2xhc3MsIG51bGwpOyAgICAg\nICAgICAgICAgICAJCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgLy8gaWYgdGhlIHR5cGUgb2YgdGhpcyBmaWVsZCBtZXRhIGRhdGEgaXMK\nICAgICAgICAgICAgICAgIC8vIG5vbi1wcmltaXRpdmUgYW5kIG5vbi1zdHJp\nbmcsIGJlIHN1cmUgdG8gY2FzdAogICAgICAgICAgICAgICAgLy8gdG8gdGhl\nIGFwcHJvcHJpYXRlIHR5cGUuCiAgICAgICAgICAgICAgICBpZiAoIXJlZmxl\nY3QgJiYgIXR5cGUuaXNQcmltaXRpdmUoKQogICAgICAgICAgICAgICAgICAg\nICYmICF0eXBlLmdldE5hbWUoKS5lcXVhbHMoU3RyaW5nLmNsYXNzLmdldE5h\nbWUoKSkpCiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5z\nZXRUeXBlKHR5cGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNb\naV0pOwoKICAgICAgICAgICAgICAgIC8vIGdldCBpZC9wayBmcm9tIHBjIGlu\nc3RhbmNlCiAgICAgICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAg\nICAgIGFkZEV4dHJhY3RPYmplY3RJZEZpZWxkVmFsdWVDb2RlKGNvZGUsIGZt\nZHNbaV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmVmbGVj\ndCAmJiBmaWVsZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLCAic2V0\nIiwgCiAgICAgICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nW10geyBPYmplY3QuY2xhc3MsIEZpZWxkLmNsYXNzLAogICAgICAgICAgICAg\nICAgICAgICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVjdC5j\nbGFzcyB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZWZsZWN0KSB7IAog\nICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2Qo\nUmVmbGVjdGlvbi5jbGFzcywgInNldCIsIAogICAgICAgICAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBNZXRo\nb2QuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgKHR5cGUuaXNQcmltaXRp\ndmUoKSkgPyB0eXBlIDogT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKGZpZWxkICE9IG51bGwpCiAgICAgICAgICAgICAgICBjb2Rl\nLnB1dGZpZWxkKCkuc2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2Qoc2V0dGVyKTsKICAgICAgICB9CiAgICAgICAgY29kZS52cmV0dXJuKCk7\nCgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIGNvZGUgdG8gZXh0cmFjdCB0aGUgaWQgb2YgdGhlIGdpdmVuIHBy\naW1hcnkga2V5IHJlbGF0aW9uIGZpZWxkIGZvcgogICAgICogc2V0dGluZyBp\nbnRvIGFuIG9iamVjdGlkIGluc3RhbmNlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkRXh0cmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUoQ29kZSBj\nb2RlLCBGaWVsZE1ldGFEYXRhIHBrKSB7CiAgICAgICAgLy8gaWYgKHZhbCAh\nPSBudWxsKSAKICAgICAgICAvLyAgdmFsID0gKChQZXJzaXN0ZW5jZUNhcGFi\nbGUpIHZhbCkucGNGZXRjaE9iamVjdElkKCk7CiAgICAgICAgaW50IHBjID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBjb2RlLmFzdG9y\nZSgpLnNldExvY2FsKHBjKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9j\nYWwocGMpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZm51bGwxID0gY29k\nZS5pZm51bGwoKTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwocGMp\nOwogICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShQZXJzaXN0ZW5j\nZUNhcGFibGUuY2xhc3MpOyAKICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MsCiAgICAg\nICAgICAgIFBSRSArICJGZXRjaE9iamVjdElkIiwgT2JqZWN0LmNsYXNzLCBu\ndWxsKTsKICAgICAgICBpbnQgb2lkID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICBjb2RlLmFzdG9yZSgpLnNldExvY2FsKG9pZCk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgSnVt\ncEluc3RydWN0aW9uIGlmbnVsbDIgPSBjb2RlLmlmbnVsbCgpOyAKCiAgICAg\nICAgLy8gZm9yIGRhdGFzdG9yZSAvIHNpbmdsZS1maWVsZCBpZGVudGl0eToK\nICAgICAgICAvLyBpZiAodmFsICE9IG51bGwpCiAgICAgICAgLy8gICB2YWwg\nPSAoKE9wZW5KUEFJZCkgdmFsKS5nZXRJZCgpOwogICAgICAgIENsYXNzTWV0\nYURhdGEgcGttZXRhID0gcGsuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsK\nICAgICAgICBpbnQgcGtjb2RlID0gcGsuZ2V0T2JqZWN0SWRGaWVsZFR5cGVD\nb2RlKCk7CiAgICAgICAgQ2xhc3MgcGt0eXBlID0gcGsuZ2V0T2JqZWN0SWRG\naWVsZFR5cGUoKTsKICAgICAgICBpZiAocGttZXRhLmdldElkZW50aXR5VHlw\nZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JFIAogICAgICAgICAg\nICAmJiBwa2NvZGUgPT0gSmF2YVR5cGVzLkxPTkcpIHsKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgIGNvZGUu\nY2hlY2tjYXN0KCkuc2V0VHlwZShJZC5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChJZC5jbGFzcywgImdldElk\nIiwgCiAgICAgICAgICAgICAgICBsb25nLmNsYXNzLCBudWxsKTsKICAgICAg\nICB9IGVsc2UgaWYgKHBrbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLklEX0RBVEFTVE9SRSkgewogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICB9IGVsc2UgaWYgKHBrbWV0\nYS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAgICAgICAgIHN3aXRjaCAo\ncGtjb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRF\nX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKEJ5dGUuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEJ5dGVJZC5jbGFzcyk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKEJ5dGVJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgYnl0ZS5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuQllURV9PQkopCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChC\neXRlLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHtieXRlLmNsYXNzfSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKENoYXJhY3Rlci5jbGFzcyk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgICAgICAgICAvLyBu\nbyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lk\nKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5\ncGUoQ2hhcklkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQ2hhcklkLmNsYXNzLCAiZ2V0SWQi\nLAogICAgICAgICAgICAgICAgICAgICAgICBjaGFyLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5D\nSEFSX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2Vz\ncGVjaWFsKCkuc2V0TWV0aG9kKENoYXJhY3Rlci5jbGFzcywgCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbmV3\nIENsYXNzW10ge2NoYXIuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9P\nQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShE\nb3VibGUuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoRG91YmxlSWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChEb3VibGVJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgZG91YmxlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAocGtjb2RlID09IEphdmFUeXBlcy5ET1VCTEVfT0JKKQog\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5z\nZXRNZXRob2QoRG91YmxlLmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtkb3Vi\nbGUuY2xhc3N9KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUX09CSjoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKEZsb2F0LmNsYXNzKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAg\nICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUoRmxvYXRJZC5jbGFzcyk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEZsb2F0SWQu\nY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0\nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtjb2Rl\nID09IEphdmFUeXBlcy5GTE9BVF9PQkopCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChGbG9hdC5jbGFz\ncywgIjxpbml0PiIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW117ZmxvYXQuY2xhc3N9KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLklOVF9PQko6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbmV3KCku\nc2V0VHlwZShJbnRlZ2VyLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEludElkLmNs\nYXNzKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoSW50SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuSU5UX09CSikKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0\naG9kKEludGVnZXIuY2xhc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10ge2ludC5jbGFz\nc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5hbmV3KCkuc2V0VHlwZShMb25nLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8v\nIG5vIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05H\nOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChv\naWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0\nVHlwZShMb25nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChMb25nSWQuY2xhc3MsICJnZXRJ\nZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVz\nLkxPTkdfT0JKKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9r\nZXNwZWNpYWwoKS5zZXRNZXRob2QoTG9uZy5jbGFzcywgIjxpbml0PiIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXSB7bG9uZy5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoU2hvcnQu\nY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShTaG9ydElkLmNsYXNzKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nU2hvcnRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgc2hvcnQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChwa2NvZGUgPT0gSmF2YVR5cGVzLlNIT1JUX09CSikKICAgICAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKFNo\nb3J0LmNsYXNzLCAiPGluaXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXtzaG9ydC5jbGFzc30pOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUoRGF0ZUlkLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRGF0\nZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBE\nYXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3Ry\naW5nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChTdHJpbmdJZC5jbGFzcywgImdldElkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEJpZ0RlY2ltYWxJZC5jbGFz\ncyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKEJpZ0RlY2ltYWxJZC5jbGFzcywgImdldElkIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgQmlnRGVjaW1hbElkLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKEJpZ0ludGVnZXJJZC5jbGFz\ncyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCku\nc2V0TWV0aG9kKEJpZ0ludGVnZXJJZC5jbGFzcywgImdldElkIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgQmlnSW50ZWdlcklkLmNsYXNzLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xh\nc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYg\nKHBrbWV0YS5nZXRPYmplY3RJZFR5cGUoKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICBp\nZiAocGtjb2RlID09IEphdmFUeXBlcy5PQkpFQ1QpIHsKICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7\nCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRo\nb2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsIAogICAgICAgICAgICAJCQlP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICB9IAogICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUocGt0eXBlKTsKICAgICAgICB9\nIGVsc2UKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGdvMiA9IGNvZGUuZ28yKCk7Cgog\nICAgICAgIC8vIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAvLyAgIHZhbCA9\nIDxkZWZhdWx0PjsKICAgICAgICBJbnN0cnVjdGlvbiBkZWY7CiAgICAgICAg\nc3dpdGNoIChwa2NvZGUpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQk9PTEVBTjoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAg\nIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgoYnl0ZSkgMCk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgoY2hhcikgMCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAg\nICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBEKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5GTE9BVDoKICAgICAgICAgICAgICAgIGRlZiA9IGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZSgwRik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAgZGVm\nID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDApOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAg\nICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMEwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKChzaG9ydCkgMCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIGRlZiA9IGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgfQog\nICAgICAgIGlmbnVsbDEuc2V0VGFyZ2V0KGRlZik7CiAgICAgICAgaWZudWxs\nMi5zZXRUYXJnZXQoZGVmKTsKICAgICAgICBnbzIuc2V0VGFyZ2V0KGNvZGUu\nbm9wKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+\ncGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkPC9jb2RlPiBtZXRob2RzCiAg\nICAgKiB0byBjbGFzc2VzIHVzaW5nIGFwcGxpY2F0aW9uIGlkZW50aXR5Lgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ29weUtleUZpZWxkc0Zyb21P\nYmplY3RJZE1ldGhvZChib29sZWFuIGZpZWxkTWFuYWdlcikKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBwdWJs\naWMgdm9pZCBwY0NvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWQgKE9iamVjdElk\nRmllbGRDb25zdW1lciBmYywKICAgICAgICAvLwlPYmplY3Qgb2lkKQogICAg\nICAgIFN0cmluZ1tdIGFyZ3MgPSAoZmllbGRNYW5hZ2VyKSAKICAgICAgICAg\nICAgPyAgbmV3IFN0cmluZ1tdeyBPSURGQ1RZUEUuZ2V0TmFtZSgpLCBPYmpl\nY3QuY2xhc3MuZ2V0TmFtZSgpIH0KICAgICAgICAgICAgOiBuZXcgU3RyaW5n\nW117IE9iamVjdC5jbGFzcy5nZXROYW1lKCkgfTsKICAgICAgICBCQ01ldGhv\nZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiQ29weUtleUZp\nZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MuZ2V0\nTmFtZSgpLCBhcmdzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gY2FsbCBzdXBlcmNsYXNzIG1ldGhv\nZAogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nICYmICFnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oaSk7CiAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgog\nICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkuZ2V0\nTmFtZSgpLAogICAgICAgICAgICAgICAgUFJFICsgIkNvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWQiLCB2b2lkLmNsYXNzLmdldE5hbWUoKSwgYXJncyk7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKQogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMSk7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CgogICAgICAgIGlm\nICghX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAmJiBfbWV0YS5pc09iamVj\ndElkVHlwZVNoYXJlZCgpKSB7CiAgICAgICAgICAgIC8vIG9pZCA9ICgoT2Jq\nZWN0SWQpIGlkKS5nZXRJZCAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAi\nZ2V0SWQiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsK\nICAgICAgICB9CgogICAgICAgIC8vIDxvaWQgdHlwZT4gY2FzdCA9ICg8b2lk\nIHR5cGU+KSBvaWQ7CiAgICAgICAgaW50IGlkID0gY29kZS5nZXROZXh0TG9j\nYWxzSW5kZXgoKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0\nT2JqZWN0SWRUeXBlKCk7CiAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRU\neXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwo\naWQpOwoKICAgICAgICAvLyBmcy5zdG9yZTx0eXBlPkZpZWxkICg8aW5kZXg+\nLCBpZC48ZmllbGQ+KTsgb3IuLi4KICAgICAgICAvLyB0aGlzLjxmaWVsZD4g\nPSBpZC48ZmllbGQ+CiAgICAgICAgLy8gb3IgZm9yIHNpbmdsZSBmaWVsZCBp\nZGVudGl0eTogaWQuZ2V0SWQgKCkKICAgICAgICBGaWVsZE1ldGFEYXRhW10g\nZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMo\nKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAg\nICAgICAgU3RyaW5nIG5hbWU7CiAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAg\nICBDbGFzcyB1bndyYXBwZWQ7CiAgICAgICAgRmllbGQgZmllbGQ7CiAgICAg\nICAgTWV0aG9kIGdldHRlcjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFmbWRzW2ld\nLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICBuYW1lID0gZm1kc1tpXS5nZXROYW1lKCk7CiAgICAgICAg\nICAgIHR5cGUgPSBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAg\nICAgICAgICAgIGlmICghZmllbGRNYW5hZ2VyIAogICAgICAgICAgICAgICAg\nJiYgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVz\nLlBDKSB7CiAgICAgICAgICAgICAgICAvLyBzbS5nZXRQQ1ByaW1hcnlLZXko\nb2lkLCBpICsgcGNJbmhlcml0ZWRGaWVsZENvdW50KTsgCiAgICAgICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGNvZGUuZHVwKCk7IC8vIGxlYXZlIG9yaWcgb24gc3RhY2sg\ndG8gc2V0IHZhbHVlIGludG8KICAgICAgICAgICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRMb2NhbChpZCk7CiAgICAgICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAg\nICAgICAgICAgICAgICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFN0YXRlTWFuYWdlci5j\nbGFzcywgCiAgICAgICAgICAgICAgICAgICAgImdldFBDUHJpbWFyeUtleSIs\nIE9iamVjdC5jbGFzcywgCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBPYmplY3QuY2xhc3MsIGludC5jbGFzcyB9KTsKICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAg\nICAgICB1bndyYXBwZWQgPSAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCkgPT0gSmF2YVR5cGVzLlBDKSAKICAgICAgICAgICAgICAgICAgICA/IHR5\ncGUgOiB1bndyYXBTaW5nbGVGaWVsZElkZW50aXR5KGZtZHNbaV0pOwogICAg\nICAgICAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikgewogICAgICAgICAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklU\nLCBpbnQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaWFkZCgp\nOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CgogICAgICAgICAg\nICAgICAgaWYgKHVud3JhcHBlZCAhPSB0eXBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGlkKTsKICAgICAgICAg\nICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKG9pZFR5cGUgPT0gT2JqZWN0SWQuY2xhc3Mp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIWZpZWxkTWFuYWdlciAmJiB0eXBlICE9IE9i\namVjdC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\nY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgp\nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9pZFR5cGUgPT0g\nRGF0ZUlkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0ZS5jbGFzcywgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmllbGRNYW5hZ2VyICYm\nIHR5cGUgIT0gRGF0ZS5jbGFzcykKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2Qob2lkVHlwZSwgImdldElkIiwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB1bndyYXBwZWQsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAodW53cmFwcGVkICE9IHR5cGUpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlw\nZSwgIjxpbml0PiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndm9pZC5jbGFzcywgbmV3IENsYXNzW117IHVud3JhcHBlZCB9KTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9t\nZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VTU19G\nSUVMRCl7CiAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBSZWZsZWN0aW9u\nLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBpZiAoTW9kaWZpZXIuaXNQdWJsaWMoZmllbGQuZ2V0TW9kaWZp\nZXJzKCkpKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxk\nKCkuc2V0RmllbGQoZmllbGQpOwogICAgICAgICAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWZsZWN0aW9uLmdldFhY\nWChvaWQsIFJlZmxlY3Rpb24uZmluZEZpZWxkKC4uLikpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhv\naWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxl\nY3Rpb24uY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmlu\nZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNz\nLCBib29sZWFuLmNsYXNzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwg\nRmllbGQuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0\neXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNl\ndFR5cGUodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBnZXR0ZXIgPSBS\nZWZsZWN0aW9uLmZpbmRHZXR0ZXIob2lkVHlwZSwgbmFtZSwgdHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKE1vZGlmaWVyLmlzUHVibGljKGdldHRl\nci5nZXRNb2RpZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChnZXR0ZXIpOwogICAgICAg\nICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBSZWZsZWN0aW9uLmdldFhYWChvaWQsIFJlZmxlY3Rpb24uZmluZEdldHRl\nciguLi4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2Nv\nbnN0YW50KCkuc2V0Q2xhc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgImZpbmRHZXR0ZXIiLCBNZXRob2QuY2xhc3MsIG5l\ndyBDbGFzc1tdIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNz\nLmNsYXNzLCBTdHJpbmcuY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlv\nbkdldHRlck1ldGhvZCh0eXBlLCBNZXRob2QuY2xhc3MpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlw\nZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoZmllbGRNYW5hZ2VyKQogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoZ2V0RmllbGRDb25z\ndW1lck1ldGhvZCh0eXBlKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7\nCiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBj\nb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBp\nZiB0aGUgY2xhc3MgdXNlcyB0aGUgQ2xhc3MvU3RyaW5nIGNvbnN0cnVjdG9y\nCiAgICAgKiBpbnN0ZWFkIG9mIGp1c3QgU3RyaW5nLgogICAgICovCiAgICBw\ncml2YXRlIEJvb2xlYW4gdXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3Rvcigp\nIHsKICAgICAgICBpZiAoX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gQ2xh\nc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElPTikKICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uRkFMU0U7CgogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJ\nZGVudGl0eSgpKSB7CiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRPYmplY3RJ\nZFR5cGUoKSA9PSBPYmplY3RJZC5jbGFzcykKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwog\nICAgICAgIH0KCiAgICAgICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9i\namVjdElkVHlwZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9pZFR5\ncGUuZ2V0Q29uc3RydWN0b3IobmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBT\ndHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRS\nVUU7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICB9\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1\nY3RvcihuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAg\nIH0KCiAgICAvKioKICAgICAqIElmIHRoZSBnaXZlbiBmaWVsZCBpcyBhIHdy\nYXBwZXItdHlwZSBzaW5nbGUgZmllbGQgaWRlbnRpdHkgcHJpbWFyeSBrZXks\nCiAgICAgKiByZXR1cm4gaXRzIGNvcnJlc3BvbmRpbmcgcHJpbWl0aXZlIGNs\nYXNzLiBFbHNlIHJldHVybiB0aGUgZmllbGQgdHlwZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBDbGFzcyB1bndyYXBTaW5nbGVGaWVsZElkZW50aXR5KEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaWYgKCFmbWQuZ2V0RGVmaW5pbmdN\nZXRhRGF0YSgpLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgIHJl\ndHVybiBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CgogICAgICAgIHN3aXRjaCAo\nZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBi\neXRlLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09C\nSjoKICAgICAgICAgICAgICAgIHJldHVybiBjaGFyLmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAg\nICAgcmV0dXJuIGRvdWJsZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGZsb2F0\nLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGludC5jbGFzczsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHNob3J0LmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT05HX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBsb25nLmNsYXNzOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZt\nZC5nZXREZWNsYXJlZFR5cGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBnZXR0ZXIgbWV0aG9kIG9mIHRo\nZSB7QGxpbmsgUmVmbGVjdGlvbn0gaGVscGVyIGZvcgogICAgICogYSBmaWVs\nZCBvciBnZXR0ZXIgbWV0aG9kIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICov\nCiAgICBwcml2YXRlIE1ldGhvZCBnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9k\nKENsYXNzIHR5cGUsIENsYXNzIGFyZ1R5cGUpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSAi\nZ2V0IjsKICAgICAgICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAg\nICAgICBuYW1lICs9IFN0cmluZ1V0aWxzLmNhcGl0YWxpemUodHlwZS5nZXRO\nYW1lKCkpOwogICAgICAgIHJldHVybiBSZWZsZWN0aW9uLmNsYXNzLmdldE1l\ndGhvZChuYW1lLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgCiAgICAg\nICAgICAgIGFyZ1R5cGUgfSk7IAogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBwcm9wZXIgZmV0Y2ggbWV0aG9kIG9mIHRoZSBPYmplY3RJZEZp\nZWxkU3VwcGxpZXIgZm9yCiAgICAgKiBhIGZpZWxkIG9mIHRoZSBnaXZlbiB0\neXBlLgogICAgICovCiAgICBwcml2YXRlIE1ldGhvZCBnZXRGaWVsZFN1cHBs\naWVyTWV0aG9kKENsYXNzIHR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChPSURG\nU1RZUEUsIHR5cGUsICJmZXRjaCIsIHRydWUsIGZhbHNlLCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBt\nZXRob2Qgb2YgdGhlIE9iamVjdElkRmllbGRDb25zdW1lciBmb3IKICAgICAq\nIGEgZmllbGQgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZh\ndGUgTWV0aG9kIGdldEZpZWxkQ29uc3VtZXJNZXRob2QoQ2xhc3MgdHlwZSkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZ2V0TWV0aG9kKE9JREZDVFlQRSwgdHlwZSwgInN0b3JlIiwg\nZmFsc2UsIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGRzIHRoZSBwY05ld09iamVjdElkSW5zdGFuY2UgbWV0aG9kIHRvIGNsYXNz\nZXMgdXNpbmcKICAgICAqIGFwcGxpY2F0aW9uIGlkZW50aXR5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkTmV3T2JqZWN0SWRJbnN0YW5jZU1ldGhv\nZChib29sZWFuIG9iaikKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0\nSWRJbnN0YW5jZSAoKQogICAgICAgIENsYXNzW10gYXJncyA9IChvYmopID8g\nbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9IDogbnVsbDsKICAgICAgICBC\nQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3\nT2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9iamVjdC5jbGFzcywg\nYXJncyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIEJvb2xlYW4gdXNlc0Nsc1N0cmluZyA9IHVzZXNDbGFz\nc1N0cmluZ0lkQ29uc3RydWN0b3IoKTsKICAgICAgICBDbGFzcyBvaWRUeXBl\nID0gX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7CiAgICAgICAgaWYgKG9iaiAm\nJiB1c2VzQ2xzU3RyaW5nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoLi4uKTsKICAgICAg\nICAgICAgU3RyaW5nIG1zZyA9IF9sb2MuZ2V0KCJzdHItY29ucyIsIG9pZFR5\ncGUsCiAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkp\nLmdldE1lc3NhZ2UoKTsKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlw\nZShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUobXNnKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcywKICAg\nICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAgICBjb2RlLmF0aHJvdygp\nOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNv\nZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYm\nIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAg\nLy8gbmV3IE9iamVjdElkIChjbHMsIG9pZCkKICAgICAgICAgICAgY29kZS5h\nbmV3KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAgICAgICAgICAgIGNv\nZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNl\ndENsYXNzKGdldFR5cGUoX21ldGEpKTsKICAgICAgICB9CgogICAgICAgIC8v\nIG5ldyA8b2lkIGNsYXNzPiAoKTsKICAgICAgICBjb2RlLmFuZXcoKS5zZXRU\neXBlKG9pZFR5cGUpOwogICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgaWYg\nKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkgfHwgKG9iaiAmJiB1c2VzQ2xz\nU3RyaW5nID09IEJvb2xlYW4uVFJVRSkpCiAgICAgICAgICAgIGNvZGUuY2xh\nc3Njb25zdGFudCgpLnNldENsYXNzKGdldFR5cGUoX21ldGEpKTsKICAgICAg\nICBpZiAob2JqKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJh\nbSgwKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFN0\ncmluZy5jbGFzcyk7CiAgICAgICAgICAgIGlmICh1c2VzQ2xzU3RyaW5nID09\nIEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xh\nc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcyB9OwogICAgICAgICAg\nICBlbHNlIGlmICh1c2VzQ2xzU3RyaW5nID09IEJvb2xlYW4uRkFMU0UpCiAg\nICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IFN0cmluZy5jbGFz\ncyB9OwogICAgICAgIH0gZWxzZSBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkgewogICAgICAgICAgICAvLyBuZXcgPHR5cGU+SWRlbnRpdHkgKFhY\nWC5jbGFzcywgPHBrPik7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFu\nY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIHBr\nID0gX21ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpWzBdOwogICAgICAgICAg\nICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBrKTsKICAgICAgICAg\nICAgaWYgKHBrLmdldERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMu\nUEMpCiAgICAgICAgICAgICAgICBhZGRFeHRyYWN0T2JqZWN0SWRGaWVsZFZh\nbHVlQ29kZShjb2RlLCBwayk7CiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRP\nYmplY3RJZFR5cGUoKSA9PSBPYmplY3RJZC5jbGFzcykKICAgICAgICAgICAg\nICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIE9iamVjdC5j\nbGFzcyB9OwogICAgICAgICAgICBlbHNlIGlmIChfbWV0YS5nZXRPYmplY3RJ\nZFR5cGUoKSA9PSBEYXRlLmNsYXNzKQogICAgICAgICAgICAgICAgYXJncyA9\nIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgRGF0ZS5jbGFzcyB9OwogICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNz\nW117IENsYXNzLmNsYXNzLCBway5nZXRPYmplY3RJZEZpZWxkVHlwZSgpIH07\nCiAgICAgICAgfQoKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2Qob2lkVHlwZSwgIjxpbml0PiIsIHZvaWQuY2xhc3MsIGFyZ3MpOwog\nICAgICAgIGlmICghX21ldGEuaXNPcGVuSlBBSWRlbnRpdHkoKSAmJiBfbWV0\nYS5pc09iamVjdElkVHlwZVNoYXJlZCgpKQogICAgICAgICAgICBjb2RlLmlu\ndm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICI8aW5p\ndD4iLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117\nIENsYXNzLmNsYXNzLCBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAg\nIC8qKgogICAgICogV2hlbiBjb21tdW5pY2F0aW5nIHdpdGggdGhlIFN0YXRl\nTWFuYWdlciwgbWFueSBtZXRob2RzIGFyZSB1c2VkCiAgICAgKiBkZXBlbmRp\nbmcgb24gdGhlIGNsYXNzIG9mIHN0YXRlIGJlaW5nIHBhc3NlZC4gVGhpcyBt\nZXRob2QsCiAgICAgKiBnaXZlbiB0aGUgdHlwZSBvZiBpbmZvcm1hdGlvbiBi\nZWluZyBwYXNzZWQgYW5kIHRoZSBwcmVmaXgKICAgICAqICgncHJvdmlkZWQn\nLCAncmVwbGFjZScsIGV0Yykgb2YgdGhlIG1ldGhvZCB0bwogICAgICogY2Fs\nbCwgcmV0dXJucyB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhvZCB0aGF0IHNob3Vs\nZCBiZSB1c2VkLgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRoZSB0eXBl\nIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAogICAgICogQHBhcmFtIHByZWZpeCB0\naGUgcHJlZml4IG9mIHRoZSBtZXRob2QgdG8gY2FsbDsgYWxsIG1ldGhvZHMK\nICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5cGVdRmllbGQnOyBvbmx5IHRoZSBw\ncmVmaXggdmFyaWVzCiAgICAgKiBAcGFyYW0gZ2V0IHRydWUgaWYgcmVjZWl2\naW5nIGluZm9ybWF0aW9uIGZyb20gdGhlCiAgICAgKiBTdGF0ZU1hbmFnZXIs\nIGZhbHNlIGlmIHBhc3NpbmcgaXQgdG8gdGhlIFNNCiAgICAgKiBAcGFyYW0g\nY3VyVmFsdWUgdHJ1ZSBpZiB0aGUgY3VycmVudCBzdGF0ZSB2YWx1ZSBpcyBw\nYXNzZWQgdG8KICAgICAqIHRoZSBTdGF0ZU1hbmFnZXIgYXMgYW4gZXh0cmEg\nYXJndW1lbnQKICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2QgZ2V0U3RhdGVN\nYW5hZ2VyTWV0aG9kKENsYXNzIHR5cGUsIFN0cmluZyBwcmVmaXgsCiAgICAg\nICAgYm9vbGVhbiBnZXQsIGJvb2xlYW4gY3VyVmFsdWUpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdl\ndE1ldGhvZChTTVRZUEUsIHR5cGUsIHByZWZpeCwgZ2V0LCB0cnVlLCBjdXJW\nYWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGhv\nZCBvZiB0aGUgZ2l2ZW4gb3duZXIgdHlwZSBtYXRjaGluZyB0aGUgZ2l2ZW4g\nY3JpdGVyaWEuCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIHR5cGUg\nb2Ygc3RhdGUgYmVpbmcgcGFzc2VkCiAgICAgKiBAcGFyYW0gcHJlZml4IHRo\nZSBwcmVmaXggb2YgdGhlIG1ldGhvZCB0byBjYWxsOyBhbGwgbWV0aG9kcwog\nICAgICogZW5kIGluICdbc3RhdGUgdHlwZV1GaWVsZCc7IG9ubHkgdGhlIHBy\nZWZpeCB2YXJpZXMKICAgICAqIEBwYXJhbSBnZXQgdHJ1ZSBpZiByZWNlaXZp\nbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUKICAgICAqIG93bmVyLCBmYWxzZSBp\nZiBwYXNzaW5nIGl0IHRvIHRoZSBvd25lcgogICAgICogQHBhcmFtIGhhc3Bj\nIHRydWUgaWYgdGhlIHBjIGlzIHBhc3NlZCBhcyBhbiBleHRyYSBhcmd1bWVu\ndAogICAgICogQHBhcmFtIGN1clZhbHVlIHRydWUgaWYgdGhlIGN1cnJlbnQg\nc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAgICAgKiB0aGUgb3duZXIgYXMg\nYW4gZXh0cmEgYXJndW1lbnQKICAgICAqLwogICAgcHJpdmF0ZSBNZXRob2Qg\nZ2V0TWV0aG9kKENsYXNzIG93bmVyLCBDbGFzcyB0eXBlLCBTdHJpbmcgcHJl\nZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBib29sZWFuIGhhc3BjLCBib29s\nZWFuIGN1clZhbHVlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNl\ncHRpb24gewogICAgICAgIC8vIGFsbCBtZXRob2RzIGVuZCBpbiBbZmllbGQg\ndHlwZV1GaWVsZCwgd2hlcmUgdGhlIGZpZWxkIHR5cGUKICAgICAgICAvLyBj\nYW4gYmUgYW55IG9mIHRoZSBwcmltaXR2ZSB0eXBlcyAoYnV0IGNhcGl0YWxp\nemVkKSwgJ1N0cmluZycsCiAgICAgICAgLy8gb3IgJ09iamVjdCc7IGZpZ3Vy\nZSBvdXQgd2hhdCB0eXBlIHRvIHVzZQogICAgICAgIFN0cmluZyB0eXBlTmFt\nZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0\naXZlKCkpCiAgICAgICAgICAgIHR5cGVOYW1lID0gdHlwZU5hbWUuc3Vic3Ry\naW5nKDAsIDEpLnRvVXBwZXJDYXNlKExvY2FsZS5FTkdMSVNIKQogICAgICAg\nICAgICAgICAgKyB0eXBlTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgZWxz\nZSBpZiAodHlwZS5lcXVhbHMoU3RyaW5nLmNsYXNzKSkKICAgICAgICAgICAg\ndHlwZU5hbWUgPSAiU3RyaW5nIjsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgdHlwZU5hbWUgPSAiT2JqZWN0IjsKICAgICAgICAgICAgdHlwZSA9IE9i\namVjdC5jbGFzczsKICAgICAgICB9CgogICAgICAgIC8vIHRoZSBmaWVsZCBp\nbmRleCBpcyBhbHdheXMgcGFzc2VkIGFzIGFuIGFyZzsgdGhlIHBjIGluc3Rh\nbmNlIGFuZAogICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlIG1heSBiZSBw\nYXNzZWQ7IGlmIHNldHRpbmcgdGhlIG5ldyB2YWx1ZSBpcwogICAgICAgIC8v\nIGFsc28gcGFzc2VkCiAgICAgICAgTGlzdCBwbGlzdCA9IG5ldyBBcnJheUxp\nc3QoNCk7CiAgICAgICAgaWYgKGhhc3BjKQogICAgICAgICAgICBwbGlzdC5h\nZGQoUENUWVBFKTsKICAgICAgICBwbGlzdC5hZGQoaW50LmNsYXNzKTsKICAg\nICAgICBpZiAoIWdldCB8fCBjdXJWYWx1ZSkKICAgICAgICAgICAgcGxpc3Qu\nYWRkKHR5cGUpOwogICAgICAgIGlmICghZ2V0ICYmIGN1clZhbHVlKSB7CiAg\nICAgICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICAgICAgcGxpc3Qu\nYWRkKGludC5jbGFzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyB1c2UgcmVm\nbGVjdGlvbiB0byByZXR1cm4gdGhlIHJpZ2h0IG1ldGhvZAogICAgICAgIFN0\ncmluZyBuYW1lID0gcHJlZml4ICsgdHlwZU5hbWUgKyAiRmllbGQiOwogICAg\nICAgIENsYXNzW10gcGFyYW1zID0gKENsYXNzW10pIHBsaXN0LnRvQXJyYXko\nbmV3IENsYXNzW3BsaXN0LnNpemUoKV0pOwogICAgICAgIAogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiAoTWV0aG9kKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVs\ncGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9uKG93bmVyLCBuYW1lLCBwYXJh\nbXMpKTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9uRXhjZXB0\naW9uIHBhZSkgewogICAgICAgICAgICAgdGhyb3cgKE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIHRoZSBjb2Rl\nIG5lY2Vzc2FyeSB0byB0aHJvdyB0aGUgZ2l2ZW4KICAgICAqIGV4Y2VwdGlv\nbiB0eXBlLCBzYW5zIG1lc3NhZ2UuCiAgICAgKi8KICAgIHByaXZhdGUgSW5z\ndHJ1Y3Rpb24gdGhyb3dFeGNlcHRpb24oQ29kZSBjb2RlLCBDbGFzcyB0eXBl\nKSB7CiAgICAgICAgSW5zdHJ1Y3Rpb24gaW5zID0gY29kZS5hbmV3KCkuc2V0\nVHlwZSh0eXBlKTsKICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGNvZGUu\naW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCh0eXBlLCAiPGluaXQ+Iiwgdm9p\nZC5jbGFzcywgbnVsbCk7CiAgICAgICAgY29kZS5hdGhyb3coKTsKICAgICAg\nICByZXR1cm4gaW5zOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUg\nUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZSB0byB0aGUgY2xhc3MgYmVp\nbmcKICAgICAqIGVuaGFuY2VkLCBhbmQgYWRkcyBhIGRlZmF1bHQgY29uc3Ry\ndWN0b3IgZm9yIHVzZSBieSBPcGVuSlBBCiAgICAgKiBpZiBpdCBpcyBub3Qg\nYWxyZWFkeSBwcmVzZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZW5o\nYW5jZUNsYXNzKCkgewogICAgICAgIC8vIG1ha2UgdGhlIGNsYXNzIGltcGxl\nbWVudCBQZXJzaXN0ZW5jZUNhcGFibGUKICAgICAgICBfcGMuZGVjbGFyZUlu\ndGVyZmFjZShQQ1RZUEUpOwoKICAgICAgICAvLyBhZGQgYSB2ZXJzaW9uIHN0\nYW1wCiAgICAgICAgYWRkR2V0RW5oYW5jZW1lbnRDb250cmFjdFZlcnNpb25N\nZXRob2QoKTsKCiAgICAgICAgLy8gZmluZCB0aGUgZGVmYXVsdCBjb25zdHJ1\nY3RvcgogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5nZXREZWNsYXJl\nZE1ldGhvZCgiPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKCiAgICAgICAg\nLy8gYSBkZWZhdWx0IGNvbnN0cnVjdG9yIGlzIHJlcXVpcmVkCiAgICAgICAg\naWYgKG1ldGhvZCA9PSBudWxsKSB7CiAgICAgICAgICAgIFN0cmluZyBuYW1l\nID0gX3BjLmdldE5hbWUoKTsKICAgICAgICAgICAgaWYgKCFfZGVmQ29ucykK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJlbmhhbmNlLWRlZmF1bHRjb25zdCIsIG5hbWUpKTsKCiAgICAgICAg\nICAgIG1ldGhvZCA9IF9wYy5hZGREZWZhdWx0Q29uc3RydWN0b3IoKTsKICAg\nICAgICAgICAgU3RyaW5nIGFjY2VzczsKICAgICAgICAgICAgaWYgKF9tZXRh\nLmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAvLyBleHRlcm5h\nbGl6YWJsZSByZXF1aXJlcyB0aGF0IHRoZSBjb25zdHJ1Y3RvcgogICAgICAg\nICAgICAgICAgLy8gYmUgcHVibGljLCBzbyBtYWtlIHRoZSBhZGRlZCBjb25z\ndHJ1Y3RvciBwdWJsaWMKICAgICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHVi\nbGljKCk7CiAgICAgICAgICAgICAgICBhY2Nlc3MgPSAicHVibGljIjsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChfcGMuaXNGaW5hbCgpKSB7CiAgICAgICAg\nICAgICAgICBtZXRob2QubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAgICAg\nIGFjY2VzcyA9ICJwcml2YXRlIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAg\nICAgICAgICBhY2Nlc3MgPSAicHJvdGVjdGVkIjsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAoIShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuaXNJ\nbnRlcmZhY2UoKSB8fCBnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAg\nICAgICAgJiYgX2xvZy5pc1dhcm5FbmFibGVkKCkpCiAgICAgICAgICAgICAg\nICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2UtYWRkZGVmYXVsdGNvbnN0\nIiwgbmFtZSwgYWNjZXNzKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyB0aGUgZm9sbG93aW5nIGZpZWxkcyB0byB0aGUgUGVyc2lz\ndGVuY2VDYXBhYmxlIGluc3RhbmNlOgogICAgICogPHVsPgogICAgICogPGxp\nPjxjb2RlPnByaXZhdGUgc3RhdGljIGludCBwY0luaGVyaXRlZEZpZWxkQ291\nbnQ8L2NvZGU+PC9saT4KICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRp\nYyBDbGFzcyBwY1BDU3VwZXJjbGFzczwvY29kZT4KICAgICAqIDwvbGk+CiAg\nICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgU3RyaW5nW10gcGNGaWVs\nZE5hbWVzPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBz\ndGF0aWMgQ2xhc3NbXSBwY0ZpZWxkVHlwZXM8L2NvZGU+PC9saT4KICAgICAq\nIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBieXRlW10gcGNGaWVsZEZsYWdz\nPC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJvdGVjdGVkIHRyYW5z\naWVudCBTdGF0ZU1hbmFnZXIgcGNTdGF0ZU1hbmFnZXI8L2NvZGU+CiAgICAg\nKiBpZiBubyBQZXJzaXN0ZW5jZUNhcGFibGUgc3VwZXJjbGFzcyBwcmVzZW50\nKTwvbGk+CiAgICAgKiA8L3VsPgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkRmllbGRzKCkgewogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoSU5IRVJJ\nVCwgaW50LmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRl\nY2xhcmVGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNz\nKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQ\nUkUgKyAiRmllbGRUeXBlcyIsIENsYXNzW10uY2xhc3MpLnNldFN0YXRpYyh0\ncnVlKTsKICAgICAgICBfcGMuZGVjbGFyZUZpZWxkKFBSRSArICJGaWVsZEZs\nYWdzIiwgYnl0ZVtdLmNsYXNzKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAg\nX3BjLmRlY2xhcmVGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpLnNldFN0YXRp\nYyh0cnVlKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3VwZXJjbGFzcygp\nID09IG51bGwgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAg\nICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xhcmVGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwogICAgICAg\nICAgICBmaWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogTW9kaWZpZXMgdGhlIGNsYXNzIGluaXRpYWxp\nemF0aW9uIG1ldGhvZCAoY3JlYXRpbmcgb25lIGlmIG5lY2Vzc2FyeSkKICAg\nICAqIHRvIGluaXRpYWxpemUgdGhlIHN0YXRpYyBmaWVsZHMgb2YgdGhlIFBl\ncnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZSBhbmQKICAgICAqIHRvIHJlZ2lz\ndGVyIGl0IHdpdGggdGhlIGltcGwgaGVscGVyLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkU3RhdGljSW5pdGlhbGl6ZXIoKSB7CiAgICAgICAgQ29k\nZSBjb2RlID0gZ2V0T3JDcmVhdGVDbGFzc0luaXRDb2RlKHRydWUpOwogICAg\nICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMCk7CiAgICAgICAg\nICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGlu\ndC5jbGFzcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAvLyBwY0luaGVyaXRlZEZpZWxkQ291bnQgPSA8c3VwZXJDbGFzcz4ucGNH\nZXRNYW5hZ2VkRmllbGRDb3VudCgpCiAgICAgICAgICAgICAgICBjb2RlLmlu\ndm9rZXN0YXRpYygpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAg\nICAgICAgICAgICAgIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgICAgICBQUkUgKyAiR2V0TWFuYWdlZEZp\nZWxkQ291bnQiLCBpbnQuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKICAgICAg\nICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwg\naW50LmNsYXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGNQ\nQ1N1cGVyY2xhc3MgPSA8c3VwZXJDbGFzcz47CiAgICAgICAgICAgIC8vIHRo\naXMgaW50ZW50aW9uYWxseSBjYWxscyBnZXREZXNjcmliZWRUeXBlKCkgZGly\nZWN0bHkKICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiBQQ0VuaGFuY2VyLmdl\ndFR5cGUoKQogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRD\nbGFzcygKICAgICAgICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJjbGFzc01l\ndGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29k\nZS5wdXRzdGF0aWMoKS5zZXRGaWVsZChTVVBFUiwgQ2xhc3MuY2xhc3MpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gcGNGaWVsZE5hbWVzID0gbmV3IFN0cmlu\nZ1tdIHsgIjxuYW1lMT4iLCAiPG5hbWUyPiIsIC4uLiB9OwogICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMo\nKTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5n\ndGgpOwogICAgICAgIGNvZGUuYW5ld2FycmF5KCkuc2V0VHlwZShTdHJpbmcu\nY2xhc3MpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaSk7CiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzW2ldLmdldE5hbWUoKSk7CiAg\nICAgICAgICAgIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBj\nb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5hbWVzIiwg\nU3RyaW5nW10uY2xhc3MpOwoKICAgICAgICAvLyBwY0ZpZWxkVHlwZXMgPSBu\nZXcgQ2xhc3NbXSB7IDx0eXBlMT4uY2xhc3MsIDx0eXBlMj4uY2xhc3MsIC4u\nLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxl\nbmd0aCk7CiAgICAgICAgY29kZS5hbmV3YXJyYXkoKS5zZXRUeXBlKENsYXNz\nLmNsYXNzKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhmbWRzW2ldLmdldERlY2xh\ncmVkVHlwZSgpKTsKICAgICAgICAgICAgY29kZS5hYXN0b3JlKCk7CiAgICAg\nICAgfQogICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0RmllbGQoUFJFICsg\nIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKTsKCiAgICAgICAgLy8gcGNG\naWVsZEZsYWdzID0gbmV3IGJ5dGVbXSB7IDxmbGFnMT4sIDxmbGFnMj4sIC4u\nLiB9OwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWRzLmxl\nbmd0aCk7CiAgICAgICAgY29kZS5uZXdhcnJheSgpLnNldFR5cGUoYnl0ZS5j\nbGFzcyk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGdldEZpZWxkRmxhZyhmbWRzW2ldKSk7\nCiAgICAgICAgICAgIGNvZGUuYmFzdG9yZSgpOwogICAgICAgIH0KICAgICAg\nICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZEZsYWdz\nIiwgYnl0ZVtdLmNsYXNzKTsKCiAgICAgICAgLy8gUENSZWdpc3RyeS5yZWdp\nc3RlciAoY2xzLAogICAgICAgIC8vCXBjRmllbGROYW1lcywgcGNGaWVsZFR5\ncGVzLCBwY0ZpZWxkRmxhZ3MsCiAgICAgICAgLy8gIHBjUENTdXBlcmNsYXNz\nLCBhbGlhcywgbmV3IFhYWCAoKSk7CiAgICAgICAgY29kZS5jbGFzc2NvbnN0\nYW50KCkuc2V0Q2xhc3MoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAg\nICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZE5h\nbWVzIiwgU3RyaW5nW10uY2xhc3MpOwogICAgICAgIGNvZGUuZ2V0c3RhdGlj\nKCkuc2V0RmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNz\nKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJG\naWVsZEZsYWdzIiwgYnl0ZVtdLmNsYXNzKTsKICAgICAgICBjb2RlLmdldHN0\nYXRpYygpLnNldEZpZWxkKFNVUEVSLCBDbGFzcy5jbGFzcyk7CiAgICAgICAg\nCiAgICAgICAgaWYgKF9tZXRhLmlzTWFwcGVkKCkpCiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShfbWV0YS5nZXRUeXBlQWxpYXMoKSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nTnVsbCgpOwoKICAgICAgICBpZiAoX3BjLmlzQWJzdHJhY3QoKSkKICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShfcGMpOwogICAg\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2QoIjxpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoSEVMUEVSVFlQRSwgInJlZ2lzdGVyIiwgdm9pZC5jbGFzcywKICAg\nICAgICAgICAgbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmdbXS5j\nbGFzcywgQ2xhc3NbXS5jbGFzcywKICAgICAgICAgICAgICAgIGJ5dGVbXS5j\nbGFzcywgQ2xhc3MuY2xhc3MsIFN0cmluZy5jbGFzcywgUENUWVBFIH0pOwoK\nICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0\nZU1heFN0YWNrKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIGZsYWcgZm9yIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgYnl0ZSBnZXRGaWVsZEZsYWcoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1l\ndGFEYXRhLk1BTkFHRV9OT05FKQogICAgICAgICAgICByZXR1cm4gLTE7Cgog\nICAgICAgIGJ5dGUgZmxhZ3MgPSAwOwogICAgICAgIGlmIChmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCkuaXNQcmltaXRpdmUoKQogICAgICAgICAgICB8fCBTZXJp\nYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShmbWQuZ2V0RGVjbGFy\nZWRUeXBlKCkpKQogICAgICAgICAgICBmbGFncyA9IFBlcnNpc3RlbmNlQ2Fw\nYWJsZS5TRVJJQUxJWkFCTEU7CgogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdl\nbWVudCgpID09IEZpZWxkTWV0YURhdGEuTUFOQUdFX1RSQU5TQUNUSU9OQUwp\nCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVD\nS19XUklURTsKICAgICAgICBlbHNlIGlmICghZm1kLmlzUHJpbWFyeUtleSgp\nICYmICFmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAg\nIGZsYWdzIHw9IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19XUklURQogICAg\nICAgICAgICAgICAgfCBQZXJzaXN0ZW5jZUNhcGFibGUuQ0hFQ0tfUkVBRDsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGZsYWdzIHw9IFBlcnNpc3RlbmNl\nQ2FwYWJsZS5NRURJQVRFX1dSSVRFCiAgICAgICAgICAgICAgICB8IFBlcnNp\nc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1JFQUQ7CiAgICAgICAgcmV0dXJuIGZs\nYWdzOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgY29kZSB0byBw\ncm9wZXJseSBoYW5kbGUgUGVyc2lzdGVuY2VDYXBhYmxlIHNlcmlhbGl6YXRp\nb24KICAgICAqIHRvIHRoZSBieXRlY29kZS4gVGhpcyBpbmNsdWRlcyBjcmVh\ndGluZyBhbmQgaW5pdGlhbGl6aW5nIHRoZQogICAgICogc3RhdGljIDxjb2Rl\nPnNlcmlhbFZlcnNpb25VSUQ8L2NvZGU+IGNvbnN0YW50IGlmIG5vdCBhbHJl\nYWR5IGRlZmluZWQsCiAgICAgKiBhcyB3ZWxsIGFzIGNyZWF0aW5nIGEgY3Vz\ndG9tIDxjb2RlPndyaXRlT2JqZWN0PC9jb2RlPiBtZXRob2QgaWYgdGhlCiAg\nICAgKiBjbGFzcyBpcyBTZXJpYWxpemFibGUgYW5kIGRvZXMgbm90IGRlZmlu\nZSB0aGVtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2VyaWFsaXph\ndGlvbkNvZGUoKSB7CiAgICAgICAgaWYgKGV4dGVybmFsaXplRGV0YWNoZWQo\nKQogICAgICAgICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWdu\nYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkg\newogICAgICAgICAgICAvLyAjIyMjIyB3aGF0IHNob3VsZCBoYXBwZW4gaWYg\nYSB0eXBlIGlzIEV4dGVybmFsaXphYmxlPyBJdCBsb29rcwogICAgICAgICAg\nICAvLyAjIyMjIyBsaWtlIEV4dGVybmFsaXphYmxlIGNsYXNzZXMgd2lsbCBu\nb3QgYmUgc2VyaWFsaXplZCBhcyBQQ3MKICAgICAgICAgICAgLy8gIyMjIyMg\nYmFzZWQgb24gdGhpcyBsb2dpYy4KICAgICAgICAgICAgaWYgKCFFeHRlcm5h\nbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKAogICAgICAgICAgICAg\nICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAgICAgICAgICAg\nIGFkZFN1YmNsYXNzU2VyaWFsaXphdGlvbkNvZGUoKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgbm90IGFscmVhZHkg\ncHJlc2VudCwgYWRkIGEgc2VyaWFsVmVyc2lvblVJRCBmaWVsZDsgaWYgdGhl\nIGluc3RhbmNlCiAgICAgICAgLy8gaXMgZGV0YWNoYWJsZSBhbmQgdXNlcyBk\nZXRhY2hlZCBzdGF0ZSB3aXRob3V0IGEgZGVjbGFyZWQgZmllbGQsCiAgICAg\nICAgLy8gY2FuJ3QgYWRkIGEgc2VyaWFsIHZlcnNpb24gVUlEIGJlY2F1c2Ug\nd2UnbGwgYmUgYWRkaW5nIGV4dHJhIGZpZWxkcwogICAgICAgIC8vIHRvIHRo\nZSBlbmhhbmNlZCB2ZXJzaW9uCiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9w\nYy5nZXREZWNsYXJlZEZpZWxkKCJzZXJpYWxWZXJzaW9uVUlEIik7CiAgICAg\nICAgaWYgKGZpZWxkID09IG51bGwpIHsKICAgICAgICAgICAgTG9uZyB1aWQg\nPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdWlk\nID0gTnVtYmVycy52YWx1ZU9mKE9iamVjdFN0cmVhbUNsYXNzLmxvb2t1cAog\nICAgICAgICAgICAgICAgICAgIChfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkp\nLmdldFNlcmlhbFZlcnNpb25VSUQoKSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0LWNoYW5j\nZSBjYXRjaCBmb3IgYnVnICMyODMgKHdoaWNoIGNhbiBoYXBwZW4KICAgICAg\nICAgICAgICAgIC8vIGluIGEgdmFyaWV0eSBvZiBDbGFzc0xvYWRpbmcgZW52\naXJvbm1lbnRzKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoImVuaGFuY2UtdWlkLWFjY2VzcyIsIF9tZXRhKSwgdCk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9s\nb2MuZ2V0KCJlbmhhbmNlLXVpZC1hY2Nlc3MiLCBfbWV0YSkpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBhY2Nlc3Mg\ndGhlIHNlcmlhbFZlcnNpb25VSUQsIHdlIHdpbGwgaGF2ZSB0bwogICAgICAg\nICAgICAvLyBza2lwIHRoZSBvdmVycmlkZSBvZiB0aGF0IGZpZWxkIGFuZCBu\nb3QgYmUgc2VyaWFsaXphdGlvbgogICAgICAgICAgICAvLyBjb21wYXRpYmxl\nIHdpdGggbm9uLWVuaGFuY2VkIGNsYXNzZXMKICAgICAgICAgICAgaWYgKHVp\nZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IF9wYy5kZWNs\nYXJlRmllbGQoInNlcmlhbFZlcnNpb25VSUQiLCBsb25nLmNsYXNzKTsKICAg\nICAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAg\nICAgICBmaWVsZC5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgICAgICBm\naWVsZC5zZXRGaW5hbCh0cnVlKTsKCiAgICAgICAgICAgICAgICBDb2RlIGNv\nZGUgPSBnZXRPckNyZWF0ZUNsYXNzSW5pdENvZGUoZmFsc2UpOwogICAgICAg\nICAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwogICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHVpZC5sb25nVmFsdWUoKSk7CiAg\nICAgICAgICAgICAgICBjb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKGZpZWxk\nKTsKCiAgICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFkZCB3cml0\nZSBvYmplY3QgbWV0aG9kCiAgICAgICAgQkNNZXRob2Qgd3JpdGUgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoIndyaXRlT2JqZWN0IiwKICAgICAgICAgICAg\nbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAg\nICAgICBib29sZWFuIGZ1bGwgPSB3cml0ZSA9PSBudWxsOwogICAgICAgIGlm\nIChmdWxsKSB7CiAgICAgICAgICAgIC8vIHByaXZhdGUgdm9pZCB3cml0ZU9i\namVjdCAoT2JqZWN0T3V0cHV0U3RyZWFtIG91dCkKICAgICAgICAgICAgd3Jp\ndGUgPSBfcGMuZGVjbGFyZU1ldGhvZCgid3JpdGVPYmplY3QiLCB2b2lkLmNs\nYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1\ndFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICAgICAgd3JpdGUuZ2V0RXhjZXB0\naW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwog\nICAgICAgICAgICB3cml0ZS5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAg\nICAgICBtb2RpZnlXcml0ZU9iamVjdE1ldGhvZCh3cml0ZSwgZnVsbCk7Cgog\nICAgICAgIC8vIGFuZCByZWFkIG9iamVjdAogICAgICAgIEJDTWV0aG9kIHJl\nYWQgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRPYmplY3QiLAogICAg\nICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3Mg\nfSk7CiAgICAgICAgZnVsbCA9IHJlYWQgPT0gbnVsbDsKICAgICAgICBpZiAo\nZnVsbCkgewogICAgICAgICAgICAvLyBwcml2YXRlIHZvaWQgcmVhZE9iamVj\ndCAoT2JqZWN0SW5wdXRTdHJlYW0gaW4pCiAgICAgICAgICAgIHJlYWQgPSBf\ncGMuZGVjbGFyZU1ldGhvZCgicmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsCiAg\nICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0u\nY2xhc3MgfSk7CiAgICAgICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVl\nKS5hZGRFeGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAg\nICByZWFkLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAg\nICAgICAgICAgICAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgICAgIHJlYWQubWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAg\nICAgbW9kaWZ5UmVhZE9iamVjdE1ldGhvZChyZWFkLCBmdWxsKTsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29k\nZSgpIHsKICAgICAgICAvLyBmb3IgZ2VuZXJhdGVkIHN1YmNsYXNzZXMsIHNl\ncmlhbGl6YXRpb24gbXVzdCB3cml0ZSBhbiBpbnN0YW5jZSBvZgogICAgICAg\nIC8vIHRoZSBzdXBlcmNsYXNzIGluc3RlYWQgb2YgdGhlIHN1YmNsYXNzLCBz\nbyB0aGF0IHRoZSBjbGllbnQgVk0gY2FuCiAgICAgICAgLy8gZGVzZXJpYWxp\nemUgc3VjY2Vzc2Z1bGx5LgoKICAgICAgICAvLyBwcml2YXRlIE9iamVjdCB3\ncml0ZVJlcGxhY2UoKSB0aHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0aW9uCiAg\nICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoIndy\naXRlUmVwbGFjZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0\naG9kLmdldEV4Y2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uKE9iamVjdFN0\ncmVhbUV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIE9iamVjdCBvID0gbmV3\nIDxtYW5hZ2VkLXR5cGU+KCkKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKF9tYW5hZ2VkVHlwZSk7IC8vIGZvciByZXR1cm4KICAgICAgICBjb2RlLmR1\ncCgpOyAvLyBmb3IgcG9zdC08aW5pdD4gd29yawogICAgICAgIGNvZGUuZHVw\nKCk7IC8vIGZvciA8aW5pdD4KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwgIjxpbml0PiIs\nCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG51bGwpOwoKICAgICAgICAvLyBj\nb3B5IGFsbCB0aGUgZmllbGRzLgogICAgICAgIC8vICMjIyMjIGxpbWl0aW5n\nIHRvIEpQQSBAVHJhbnNpZW50IGxpbWl0YXRpb25zCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgaWYgKGZtZHNbaV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAvLyBvLjxmaWVsZD4gPSB0aGlz\nLjxmaWVsZD4gKG9yIHJlZmxlY3RpdmUgYW5hbG9nKQogICAgICAgICAgICBj\nb2RlLmR1cCgpOyAvLyBmb3IgcHV0ZmllbGQKICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFRoaXMoKTsgLy8gZm9yIGdldGZpZWxkCiAgICAgICAgICAg\nIGdldGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5nZXROYW1l\nKCkpOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUs\nIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgZm1kc1tpXS5n\nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmFy\nZXR1cm4oKS5zZXRUeXBlKE9iamVjdC5jbGFzcyk7CgogICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVN\nYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUg\nY2xhc3MgYmVpbmcgZW5oYW5jZWQgc2hvdWxkIGV4dGVybmFsaXplIHRvIGEg\nZGV0YWNoZWQKICAgICAqIGluc3RhbmNlIHJhdGhlciB0aGFuIHNlcmlhbGl6\nZS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGV4dGVybmFsaXplRGV0\nYWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIENsYXNzTWV0YURhdGEuU1lOVEhF\nVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkpCiAgICAgICAg\nICAgICYmIFNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9t\nZXRhLmdldERlc2NyaWJlZFR5cGUoKSkKICAgICAgICAgICAgJiYgIV9yZXBv\ncy5nZXRDb25maWd1cmF0aW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgp\nLgogICAgICAgICAgICBpc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBjdXN0b20gd3JpdGVPYmplY3Qg\nbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9i\namVjdE91dHB1dFN0cmVhbSNkZWZhdWx0V3JpdGVPYmplY3R9IG1ldGhvZCwK\nICAgICAqIGJ1dCBvbmx5IGFmdGVyIGNhbGxpbmcgdGhlIGludGVybmFsIDxj\nb2RlPnBjU2VyaWFsaXppbmc8L2NvZGU+IG1ldGhvZC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIG1vZGlmeVdyaXRlT2JqZWN0TWV0aG9kKEJDTWV0aG9k\nIG1ldGhvZCwgYm9vbGVhbiBmdWxsKSB7CiAgICAgICAgQ29kZSBjb2RlID0g\nbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS5iZWZvcmVGaXJz\ndCgpOwoKICAgICAgICAvLyBib29sIGNsZWFyID0gcGNTZXJpYWxpemluZyAo\nKTsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsg\nIlNlcmlhbGl6aW5nIiwKICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbnVs\nbCk7CiAgICAgICAgaW50IGNsZWFyID0gY29kZS5nZXROZXh0TG9jYWxzSW5k\nZXgoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGNsZWFyKTsK\nCiAgICAgICAgaWYgKGZ1bGwpIHsKICAgICAgICAgICAgLy8gb3V0LmRlZmF1\nbHRXcml0ZU9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5z\nZXRNZXRob2QoT2JqZWN0T3V0cHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAg\nICAgICAgImRlZmF1bHRXcml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9CgogICAg\nICAgIEluc3RydWN0aW9uIHRtcGxhdGUgPSAoKENvZGUpIEFjY2Vzc0NvbnRy\nb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBl\nci5uZXdDb2RlQWN0aW9uKCkpKS52cmV0dXJuKCk7CiAgICAgICAgSnVtcElu\nc3RydWN0aW9uIHRvcmV0OwogICAgICAgIEluc3RydWN0aW9uIHJldDsKICAg\nICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CiAgICAgICAgd2hpbGUgKGNvZGUu\nc2VhcmNoRm9yd2FyZCh0bXBsYXRlKSkgewogICAgICAgICAgICByZXQgPSBj\nb2RlLnByZXZpb3VzKCk7CiAgICAgICAgICAgIC8vIGlmIChjbGVhcikgcGNT\nZXREZXRhY2hlZFN0YXRlIChudWxsKTsKICAgICAgICAgICAgY29kZS5pbG9h\nZCgpLnNldExvY2FsKGNsZWFyKTsKICAgICAgICAgICAgdG9yZXQgPSBjb2Rl\nLmlmZXEoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxs\nKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChQUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICB2\nb2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAg\nICAgICAgICB0b3JldC5zZXRUYXJnZXQocmV0KTsKICAgICAgICAgICAgY29k\nZS5uZXh0KCk7IC8vIGp1bXAgb3ZlciByZXR1cm4KICAgICAgICB9CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRz\nIGEgY3VzdG9tIHJlYWRPYmplY3QgbWV0aG9kIHRoYXQgZGVsZWdhdGVzIHRv\nIHRoZQogICAgICoge0BsaW5rIE9iamVjdElucHV0U3RyZWFtI3JlYWRPYmpl\nY3R9IG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1vZGlmeVJl\nYWRPYmplY3RNZXRob2QoQkNNZXRob2QgbWV0aG9kLCBib29sZWFuIGZ1bGwp\nIHsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nICAgICAgICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIC8vIGlmIHRo\naXMgaW5zdGFuY2UgdXNlcyBzeW50aGV0aWMgZGV0YWNoZWQgc3RhdGUsIG5v\ndGUgdGhhdCBpdCBoYXMKICAgICAgICAvLyBiZWVuIGRlc2VyaWFsaXplZAog\nICAgICAgIGlmIChDbGFzc01ldGFEYXRhLlNZTlRIRVRJQy5lcXVhbHMoX21l\ndGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKSkgewogICAgICAgICAgICBsb2FkTWFu\nYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJWkVEIiwgT2JqZWN0LmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKFBSRSArICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoZnVsbCkgewogICAgICAgICAgICAvLyBpbi5k\nZWZhdWx0UmVhZE9iamVjdCAoKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MsCiAgICAgICAg\nICAgICAgICAiZGVmYXVsdFJlYWRPYmplY3QiLCB2b2lkLmNsYXNzLCBudWxs\nKTsKICAgICAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgfQoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENy\nZWF0ZXMgdGhlIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUg\naWYgYW4gaW5zdGFuY2UKICAgICAqIGlzIGRldGFjaGVkLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkSXNEZXRhY2hlZE1ldGhvZCgpCiAgICAgICAg\ndGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVi\nbGljIGJvb2xlYW4gcGNJc0RldGFjaGVkKCkKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiSXNEZXRhY2hlZCIs\nCiAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MsIG51bGwpOwogICAgICAgIG1l\ndGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CiAgICAgICAgYm9vbGVhbiBuZWVkc0RlZmluaXRp\ndmVNZXRob2QgPSB3cml0ZUlzRGV0YWNoZWRNZXRob2QoY29kZSk7CiAgICAg\nICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgaWYgKCFuZWVkc0RlZmluaXRp\ndmVNZXRob2QpIAogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHBy\naXZhdGUgYm9vbGVhbiBwY0lzRGV0YWNoZWRTdGF0ZURlZmluaXRpdmUoKQog\nICAgICAgIC8vICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vIGF1eGlsbGlh\ncnkgZW5oYW5jZXJzIG1heSBjaGFuZ2UgdGhlIHJldHVybiB2YWx1ZSBvZiB0\naGlzIG1ldGhvZAogICAgICAgIC8vIGlmIHRoZWlyIHNwZWNzIGNvbnNpZGVy\nIGRldGFjaGVkIHN0YXRlIGRlZmluaXRpdmUKICAgICAgICBtZXRob2QgPSBf\ncGMuZGVjbGFyZU1ldGhvZChJU0RFVEFDSEVEU1RBVEVERUZJTklUSVZFLCBi\nb29sZWFuLmNsYXNzLAogICAgICAgICAgICBudWxsKTsKICAgICAgICBtZXRo\nb2QubWFrZVByaXZhdGUoKTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZh\nbHNlKTsKICAgICAgICBjb2RlLmlyZXR1cm4oKTsKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgdGhlIGJv\nZHkgb2YgdGhlIHBjSXNEZXRhY2hlZCgpIG1ldGhvZCB0byBkZXRlcm1pbmUg\naWYgYW4KICAgICAqIGluc3RhbmNlIGlzIGRldGFjaGVkLgogICAgICoKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiB3ZSBuZWVkIGEgcGNJc0RldGFjaGVkU3Rh\ndGVEZWZpbml0aXZlIG1ldGhvZCwgZmFsc2UKICAgICAqIG90aGVyd2lzZQog\nICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gd3JpdGVJc0RldGFjaGVkTWV0\naG9kKENvZGUgY29kZSkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBub3QgZGV0YWNoYWJsZTogcmV0dXJuIEJv\nb2xlYW4uRkFMU0UKICAgICAgICBpZiAoIV9tZXRhLmlzRGV0YWNoYWJsZSgp\nKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9v\nbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQoKICAgICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAg\nICAvLwkJcmV0dXJuIChzbS5pc0RldGFjaGVkICgpKSA/IEJvb2xlYW4uVFJV\nRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlu\ncyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNNVFlQRSwgImlzRGV0YWNoZWQiLAogICAgICAgICAg\nICBib29sZWFuLmNsYXNzLCBudWxsKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rp\nb24gaWZmYWxzZSA9IGNvZGUuaWZlcSgpOwogICAgICAgIGNvZGUuZ2V0c3Rh\ndGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFu\nLmNsYXNzKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBpZmZh\nbHNlLnNldFRhcmdldChjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xl\nYW4uY2xhc3MsICJGQUxTRSIsCiAgICAgICAgICAgIEJvb2xlYW4uY2xhc3Mp\nKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKCiAgICAgICAgLy8gaWYgd2Ug\ndXNlIGRldGFjaGVkIHN0YXRlOgogICAgICAgIC8vIGlmIChwY0dldERldGFj\naGVkU3RhdGUgKCkgIT0gbnVsbAogICAgICAgIC8vICAgICAmJiBwY0dldERl\ndGFjaGVkU3RhdGUgIT0gREVTRVJJQUxJWkVEKQogICAgICAgIC8vICAgICBy\nZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIEJvb2xlYW4gc3RhdGUgPSBf\nbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIEp1bXBJbnN0cnVj\ndGlvbiBub3RkZXNlciA9IG51bGw7CiAgICAgICAgSW5zdHJ1Y3Rpb24gdGFy\nZ2V0OwogICAgICAgIGlmIChzdGF0ZSAhPSBCb29sZWFuLkZBTFNFKSB7CiAg\nICAgICAgICAgIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAg\nICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBp\nZmlucyA9IGNvZGUuaWZudWxsKCk7CiAgICAgICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmludm9r\nZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUi\nLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAg\nICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUuY2xhc3MsCiAgICAgICAgICAgICAgICAiREVTRVJJQUxJWkVEIiwg\nT2JqZWN0LmNsYXNzKTsKICAgICAgICAgICAgbm90ZGVzZXIgPSBjb2RlLmlm\nYWNtcGVxKCk7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0Rmll\nbGQoQm9vbGVhbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAg\nICAgICAgICAgY29kZS5hcmV0dXJuKCk7CgogICAgICAgICAgICBpZiAoc3Rh\ndGUgPT0gQm9vbGVhbi5UUlVFKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB3\nZSBoYXZlIHRvIHVzZSBkZXRhY2hlZCBzdGF0ZToKICAgICAgICAgICAgICAg\nIC8vIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICAgICAgdGFy\nZ2V0ID0gY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNz\nLCAiRkFMU0UiLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3Mp\nOwogICAgICAgICAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAg\nICAgICAgICAgICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKICAg\nICAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvLyBjcmVhdGUgYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAg\nICAgICB0YXJnZXQgPSBjb2RlLm5vcCgpOwogICAgICAgIGlmaW5zLnNldFRh\ncmdldCh0YXJnZXQpOwogICAgICAgIGlmIChub3RkZXNlciAhPSBudWxsKQog\nICAgICAgICAgICBub3RkZXNlci5zZXRUYXJnZXQodGFyZ2V0KTsKCiAgICAg\nICAgLy8gYWxsb3cgdXNlcnMgd2l0aCB2ZXJzaW9uIG9yIGF1dG8tYXNzaWdu\nZWQgcGsgZmllbGRzIHRvIG1hbnVhbGx5IAogICAgICAgIC8vIGNvbnN0cnVj\ndCBhICJkZXRhY2hlZCIgaW5zdGFuY2UsIHNvIGNoZWNrIHRoZXNlIGJlZm9y\nZSB0YWtpbmcgaW50byAKICAgICAgICAvLyBhY2NvdW50IG5vbi1leGlzdGVu\ndCBkZXRhY2hlZCBzdGF0ZQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hl\nZCBpZiB2ZXJzaW9uIGlzIG5vbi1kZWZhdWx0CiAgICAgICAgRmllbGRNZXRh\nRGF0YSB2ZXJzaW9uID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAg\nICAgaWYgKHN0YXRlICE9IEJvb2xlYW4uVFJVRSAmJiB2ZXJzaW9uICE9IG51\nbGwpIHsKICAgICAgICAgICAgLy8gaWYgKDx2ZXJzaW9uPiAhPSA8ZGVmYXVs\ndD4pCiAgICAgICAgICAgIC8vCQlyZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgdmVyc2lvbik7CiAgICAg\nICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgdmVyc2lvbik7\nCiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVh\nbi5jbGFzcywgIlRSVUUiLCBCb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxT\nRSIsCiAgICAgICAgICAgICAgICBCb29sZWFuLmNsYXNzKSk7CiAgICAgICAg\nICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQoKICAgICAgICAvLyBjb25zaWRlciBkZXRhY2hlZCBpZiBh\ndXRvLWdlbm5lZCBwcmltYXJ5IGtleXMgYXJlIG5vbi1kZWZhdWx0CiAgICAg\nICAgaWZpbnMgPSBudWxsOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlu\nczIgPSBudWxsOwogICAgICAgIGJvb2xlYW4gaGFzQXV0b0Fzc2lnbmVkUEsg\nPSBmYWxzZTsKICAgICAgICBpZiAoc3RhdGUgIT0gQm9vbGVhbi5UUlVFCiAg\nICAgICAgICAgICYmIF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNz\nTWV0YURhdGEuSURfQVBQTElDQVRJT04pIHsKICAgICAgICAgICAgLy8gZm9y\nIGVhY2ggcGsgZmllbGQ6CiAgICAgICAgICAgIC8vIGlmICg8cGs+ICE9IDxk\nZWZhdWx0PiBbJiYgISIiLmVxdWFscyAoPHBrPildKQogICAgICAgICAgICAv\nLwkJcmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgRmllbGRNZXRh\nRGF0YVtdIHBrcyA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVsZHMoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3MubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0VmFsdWVTdHJhdGVn\neSgpID09IFZhbHVlU3RyYXRlZ2llcy5OT05FKQogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHRhcmdldCA9IGxvYWRN\nYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAg\naWYgKGlmaW5zICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAoaWZpbnMy\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdl\ndCh0YXJnZXQpOwogICAgICAgICAgICAgICAgaWZpbnMyID0gbnVsbDsKCiAg\nICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIHBr\nc1tpXSk7CiAgICAgICAgICAgICAgICBpZmlucyA9IGlmRGVmYXVsdFZhbHVl\nKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAocGtzW2ldLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuU1RSSU5HKSB7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKCIi\nKTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNv\nZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBhZGRHZXRNYW5hZ2Vk\nVmFsdWVDb2RlKGNvZGUsIHBrc1tpXSk7CiAgICAgICAgICAgICAgICAgICAg\nY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFN0cmluZy5jbGFzcywg\nImVxdWFscyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4uY2xh\nc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAg\nICAgICAgICAgaWZpbnMyID0gY29kZS5pZm5lKCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxk\nKEJvb2xlYW4uY2xhc3MsICJUUlVFIiwKICAgICAgICAgICAgICAgICAgICBC\nb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgICAgIGNvZGUuYXJldHVybigp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUg\nYXJ0aWZpY2lhbCB0YXJnZXQgdG8gc2ltcGxpZnkKICAgICAgICB0YXJnZXQg\nPSBjb2RlLm5vcCgpOwogICAgICAgIGlmIChpZmlucyAhPSBudWxsKQogICAg\nICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICBpZiAo\naWZpbnMyICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zMi5zZXRUYXJnZXQo\ndGFyZ2V0KTsKCiAgICAgICAgLy8gaWYgaGFzIGF1dG8tYXNzaWduZWQgcGsg\nYW5kIHdlIGdldCB0byB0aGlzIHBvaW50LCBtdXN0IGhhdmUgZGVmYXVsdAog\nICAgICAgIC8vIHZhbHVlLCBzbyBtdXN0IGJlIG5ldyBpbnN0YW5jZQogICAg\nICAgIGlmIChoYXNBdXRvQXNzaWduZWRQSykgewogICAgICAgICAgICBjb2Rl\nLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIs\nIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAg\nLy8gaWYgZGV0YWNoZWQgc3RhdGUgaXMgbm90IGRlZmluaXRpdmUsIGp1c3Qg\nZ2l2ZSB1cCBub3cgYW5kIHJldHVybgogICAgICAgIC8vIG51bGwgc28gdGhh\ndCB0aGUgcnVudGltZSB3aWxsIHBlcmZvcm0gYSBEQiBsb29rdXAgdG8gZGV0\nZXJtaW5lCiAgICAgICAgLy8gd2hldGhlciB3ZSdyZSBkZXRhY2hlZCBvciBu\nZXcKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAgICAgIGNv\nZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChJU0RFVEFDSEVEU1RBVEVE\nRUZJTklUSVZFLCBib29sZWFuLmNsYXNzLAogICAgICAgICAgICBudWxsKTsK\nICAgICAgICBpZmlucyA9IGNvZGUuaWZuZSgpOwogICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwoKICAgICAgICAv\nLyBubyBkZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFuY2UgdXNlcyBkZXRhY2hl\nZCBzdGF0ZSBhbmQgaXQncyBub3QKICAgICAgICAvLyBzeW50aGV0aWMgb3Ig\ndGhlIGluc3RhbmNlIGlzIG5vdCBzZXJpYWxpemFibGUgb3IgdGhlIHN0YXRl\nIGlzbid0CiAgICAgICAgLy8gdHJhbnNpZW50LCBtdXN0IG5vdCBiZSBkZXRh\nY2hlZAogICAgICAgIGlmIChzdGF0ZSA9PSBudWxsCiAgICAgICAgICAgICYm\nICghQ2xhc3NNZXRhRGF0YS5TWU5USEVUSUMuZXF1YWxzKF9tZXRhLmdldERl\ndGFjaGVkU3RhdGUoKSkKICAgICAgICAgICAgfHwgIVNlcmlhbGl6YWJsZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSkKICAgICAgICAgICAgfHwgIV9yZXBvcy5nZXRDb25maWd1cmF0aW9uKCku\nZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBpc0RldGFj\naGVkU3RhdGVUcmFuc2llbnQoKSkpIHsKICAgICAgICAgICAgLy8gcmV0dXJu\nIEJvb2xlYW4uRkFMU0UKICAgICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5z\nZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBCb29sZWFuLmNsYXNz\nKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gbm8gZGV0YWNoZWQg\nc3RhdGU6IGlmIGluc3RhbmNlIHVzZXMgZGV0YWNoZWQgc3RhdGUgKGFuZCBt\ndXN0IGJlCiAgICAgICAgLy8gc3ludGhldGljIGFuZCB0cmFuc2llbnQgaW4g\nc2VyaWFsaXphYmxlIGluc3RhbmNlIGF0IHRoaXMgcG9pbnQpLAogICAgICAg\nIC8vIG5vdCBkZXRhY2hlZCBpZiBzdGF0ZSBub3Qgc2V0IHRvIERFU0VSSUFM\nSVpFRAogICAgICAgIGlmIChzdGF0ZSA9PSBudWxsKSB7CiAgICAgICAgICAg\nIC8vIGlmIChwY0dldERldGFjaGVkU3RhdGUgKCkgPT0gbnVsbCkgLy8gaW5z\ndGVhZCBvZiBERVNFUklBTElaRUQKICAgICAgICAgICAgLy8gICAgIHJldHVy\nbiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAg\nICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAg\nIGlmaW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAgY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBC\nb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5vcCgpKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGdpdmUgdXA7IHdlIGp1c3QgZG9uJ3Qga25vdwog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDb21wYXJlIHRoZSBnaXZlbiBmaWVsZCB0byBpdHMgSmF2\nYSBkZWZhdWx0LCByZXR1cm5pbmcgdGhlCiAgICAgKiBjb21wYXJpc29uIGlu\nc3RydWN0aW9uLiBUaGUgZmllbGQgdmFsdWUgd2lsbCBhbHJlYWR5IGJlIG9u\nIHRoZSBzdGFjay4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgSnVtcElu\nc3RydWN0aW9uIGlmRGVmYXVsdFZhbHVlKENvZGUgY29kZSwKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUuaWZlcSgpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAg\nICAgICAgY29kZS5kY21wbCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNv\nZGUuaWZlcSgpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoK\nICAgICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwRik7\nCiAgICAgICAgICAgICAgICBjb2RlLmZjbXBsKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkxPTkc6CiAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoMEwpOwogICAgICAgICAgICAgICAgY29kZS5sY21wKCk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZm51bGwoKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9k\nIHRvIGdldCB0aGUgY29kZSBmb3IgdGhlIGNsYXNzIGluaXRpYWxpemVyIG1l\ndGhvZCwKICAgICAqIGNyZWF0aW5nIHRoZSBtZXRob2QgaWYgaXQgZG9lcyBu\nb3QgYWxyZWFkeSBleGlzdC4KICAgICAqLwogICAgcHJpdmF0ZSBDb2RlIGdl\ndE9yQ3JlYXRlQ2xhc3NJbml0Q29kZShib29sZWFuIHJlcGxhY2VMYXN0KSB7\nCiAgICAgICAgQkNNZXRob2QgY2xpbml0ID0gX3BjLmdldERlY2xhcmVkTWV0\naG9kKCI8Y2xpbml0PiIpOwogICAgICAgIENvZGUgY29kZTsKICAgICAgICBp\nZiAoY2xpbml0ICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZSA9IGNsaW5p\ndC5nZXRDb2RlKHRydWUpOwogICAgICAgICAgICBpZiAocmVwbGFjZUxhc3Qp\nIHsKICAgICAgICAgICAgICAgIENvZGUgdGVtcGxhdGUgPSAoQ29kZSkgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAg\nICAgSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKTsKICAgICAgICAg\nICAgICAgIGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1wbGF0ZS52cmV0dXJuKCkp\nOwogICAgICAgICAgICAgICAgY29kZS5wcmV2aW91cygpOwogICAgICAgICAg\nICAgICAgY29kZS5zZXQodGVtcGxhdGUubm9wKCkpOwogICAgICAgICAgICAg\nICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIGNvZGU7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgc3RhdGljIGlu\naXRpYWxpemVyIG1ldGhvZCBpZiBub24gZXhpc3RzCiAgICAgICAgY2xpbml0\nID0gX3BjLmRlY2xhcmVNZXRob2QoIjxjbGluaXQ+Iiwgdm9pZC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgY2xpbml0Lm1ha2VQYWNrYWdlKCk7CiAgICAgICAg\nY2xpbml0LnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBjbGluaXQuc2V0Rmlu\nYWwodHJ1ZSk7CgogICAgICAgIGNvZGUgPSBjbGluaXQuZ2V0Q29kZSh0cnVl\nKTsKICAgICAgICBpZiAoIXJlcGxhY2VMYXN0KSB7CiAgICAgICAgICAgIGNv\nZGUudnJldHVybigpOwogICAgICAgICAgICBjb2RlLnByZXZpb3VzKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBjb2RlOwogICAgfQoKICAgIC8qKgog\nICAgICogQWRkcyBieXRlY29kZSBtb2RpZnlpbmcgdGhlIGNsb25pbmcgYmVo\nYXZpb3Igb2YgdGhlIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCB0byBj\nb3JyZWN0bHkgcmVwbGFjZSB0aGUgPGNvZGU+cGNTdGF0ZU1hbmFnZXI8L2Nv\nZGU+IAogICAgICogaW5zdGFuY2UgZmllbGRzIG9mIGFueSBjbG9uZSBjcmVh\ndGVkIHdpdGggdGhlaXIgZGVmYXVsdCB2YWx1ZXMuIAogICAgICogQWxzbywg\naWYgdGhpcyBjbGFzcyBpcyB0aGUgYmFzZSBQQyB0eXBlIGFuZCBkb2VzIG5v\ndCBkZWNsYXJlZCAKICAgICAqIGEgY2xvbmUgbWV0aG9kLCBvbmUgd2lsbCBi\nZSBhZGRlZC4gQWxzbywgaWYgX3BjIGlzIGEgc3ludGhldGljCiAgICAgKiBz\ndWJjbGFzcywgY3JlYXRlIHRoZSBjbG9uZSgpIG1ldGhvZCB0aGF0IGNsZWFy\ncyB0aGUgc3RhdGUgbWFuYWdlcgogICAgICogdGhhdCBtYXkgaGF2ZSBiZWVu\nIGluaXRpYWxpemVkIGluIGEgc3VwZXIncyBjbG9uZSgpIG1ldGhvZC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENsb25pbmdDb2RlKCkgewogICAg\nICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxsICYmICFn\nZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIC8vIGFkZCB0aGUgY2xvbmUgbWV0aG9kIGlmIG5lY2Vzc2FyeQogICAg\nICAgIEJDTWV0aG9kIGNsb25lID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCJj\nbG9uZSIsIAogICAgICAgICAgICAoU3RyaW5nW10pIG51bGwpOwogICAgICAg\nIFN0cmluZyBzdXBlck5hbWUgPSBfbWFuYWdlZFR5cGUuZ2V0U3VwZXJjbGFz\nc05hbWUoKTsKICAgICAgICBDb2RlIGNvZGUgPSBudWxsOwogICAgICAgIGlm\nIChjbG9uZSA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGFkZCBjbG9uZSBz\ndXBwb3J0IGZvciBiYXNlIGNsYXNzZXMKICAgICAgICAgICAgLy8gd2hpY2gg\nYWxzbyBpbXBsZW1lbnQgY2xvbmVhYmxlCiAgICAgICAgICAgIGJvb2xlYW4g\naXNDbG9uZWFibGUgPSBDbG9uZWFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJv\nbSgKICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpOwog\nICAgICAgICAgICBib29sZWFuIGV4dGVuZHNPYmplY3QgPQogICAgICAgICAg\nICAgICAgc3VwZXJOYW1lLmVxdWFscyhPYmplY3QuY2xhc3MuZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgaWYgKCFpc0Nsb25lYWJsZSB8fCAoIWV4dGVuZHNP\nYmplY3QgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKCFnZXRDcmVhdGVTdWJjbGFz\ncygpKQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKAogICAgICAgICAg\nICAgICAgICAgICAgICBfbG9jLmdldCgiZW5oYW5jZS1jbG9uZWFibGUiLCBf\nbWFuYWdlZFR5cGUuZ2V0TmFtZSgpKSk7CgogICAgICAgICAgICAvLyBhZGQg\nY2xvbmUgbWV0aG9kCiAgICAgICAgICAgIC8vIHByb3RlY3RlZCBPYmplY3Qg\nY2xvbmUgKCkgdGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uCiAg\nICAgICAgICAgIGNsb25lID0gX3BjLmRlY2xhcmVNZXRob2QoImNsb25lIiwg\nT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFzZXRWaXNp\nYmlsaXR5VG9TdXBlck1ldGhvZChjbG9uZSkpCiAgICAgICAgICAgICAgICBj\nbG9uZS5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIGNsb25lLmdldEV4\nY2VwdGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAo\nQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAg\nICBjb2RlID0gY2xvbmUuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgICAgIC8v\nIHJldHVybiBzdXBlci5jbG9uZSAoKTsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXBlck5hbWUsICJjbG9uZSIsCiAg\nICAgICAgICAgICAgICBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsK\nICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgLy8gZ2V0IHRoZSBjbG9uZSBtZXRob2QgY29kZQogICAg\nICAgICAgICBjb2RlID0gY2xvbmUuZ2V0Q29kZShmYWxzZSk7CiAgICAgICAg\nICAgIGlmIChjb2RlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICAvLyBjcmVhdGUgdGVtcGxhdGUgc3VwZXIu\nY2xvbmUgKCkgaW5zdHJ1Y3Rpb24gdG8gbWF0Y2ggYWdhaW5zdAogICAgICAg\nIEluc3RydWN0aW9uIHRlbXBsYXRlID0gKChDb2RlKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3Q29kZUFjdGlvbigpKSkuaW52b2tlc3BlY2lhbCgpCiAgICAgICAgICAg\nIC5zZXRNZXRob2Qoc3VwZXJOYW1lLCAiY2xvbmUiLCBPYmplY3QuY2xhc3Mu\nZ2V0TmFtZSgpLCBudWxsKTsKCiAgICAgICAgLy8gZmluZCBjYWxscyB0byB0\naGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb247IG9uIG1hdGNoCiAgICAgICAgLy8g\nY2xvbmUgd2lsbCBiZSBvbiBzdGFjawogICAgICAgIGNvZGUuYmVmb3JlRmly\nc3QoKTsKICAgICAgICBpZiAoY29kZS5zZWFyY2hGb3J3YXJkKHRlbXBsYXRl\nKSkgewogICAgICAgICAgICAvLyAoKDx0eXBlPikgY2xvbmUpLnBjU3RhdGVN\nYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKF9wYyk7CiAgICAgICAg\nICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgICAgIGNv\nZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKCiAgICAgICAg\nICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBzdGFjawogICAgICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIGNvZGUu\nY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogR2V0cyB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyByZWdpc3Rl\ncmVkIGFzIHtAbGluayBTZXJ2aWNlcyBzZXJ2aWNlc30uCiAgICAgKi8KICAg\nIHB1YmxpYyBBdXhpbGlhcnlFbmhhbmNlcltdIGdldEF1eGlsaWFyeUVuaGFu\nY2VycygpIHsKCQlyZXR1cm4gX2F1eEVuaGFuY2VyczsKICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBBbGxvdyBhbnkgcmVnaXN0ZXJlZCBhdXhpbGlhcnkg\nY29kZSBnZW5lcmF0b3JzIHRvIHJ1bi4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpIHsKICAgIAlmb3IgKGludCBp\nID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCV9h\ndXhFbmhhbmNlcnNbaV0ucnVuKF9wYywgX21ldGEpOwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIG1ldGhvZCBiZSBz\na2lwcGVkLgogICAgICogCiAgICAgKiBAcGFyYW0gbWV0aG9kIG1ldGhvZCB0\nbyBiZSBza2lwcGVkIG9yIG5vdAogICAgICogQHJldHVybiB0cnVlIGlmIGFu\neSBvZiB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBza2lwcyB0aGUgZ2l2ZW4g\nbWV0aG9kLAogICAgICogb3IgaWYgdGhlIG1ldGhvZCBpcyBhIGNvbnN0cnVj\ndG9yCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBza2lwRW5oYW5jZShC\nQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBpZiAoIjxpbml0PiIuZXF1YWxz\nKG1ldGhvZC5nZXROYW1lKCkpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9hdXhFbmhh\nbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCWlmIChfYXV4RW5oYW5jZXJzW2ld\nLnNraXBFbmhhbmNlKG1ldGhvZCkpCiAgICAJCQlyZXR1cm4gdHJ1ZTsKICAg\nICAgICAKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGRzIHN5bnRoZXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcyB0aGF0\nIHdpbGwgcmVwbGFjZSBhbGwgZGlyZWN0CiAgICAgKiBmaWVsZCBhY2Nlc3Nl\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEFjY2Vzc29ycygpCiAg\nICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVhdGVTdWJjbGFzcygpID8g\nX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAgOiBfbWV0YS5nZXREZWNs\nYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1k\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZ2V0Q3JlYXRlU3Vi\nY2xhc3MoKSkgewogICAgICAgICAgICAgICAgaWYgKCFnZXRSZWRlZmluZSgp\nCiAgICAgICAgICAgICAgICAgICAgJiYgX21ldGEuZ2V0QWNjZXNzVHlwZSgp\nICE9IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEKSB7CiAgICAgICAgICAg\nICAgICAgICAgYWRkU3ViY2xhc3NTZXRNZXRob2QoZm1kc1tpXSk7CiAgICAg\nICAgICAgICAgICAgICAgYWRkU3ViY2xhc3NHZXRNZXRob2QoZm1kc1tpXSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBhZGRHZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAgICAg\nICAgICAgICBhZGRTZXRNZXRob2QoaSwgZm1kc1tpXSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIGEgbm9u\nLXN0YXRpYyBzZXR0ZXIgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1l\ndGhvZHMsIGFuZAogICAgICogcGVyZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVs\nZCB0cmFja2luZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNs\nYXNzU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzIHByb3BU\neXBlID0gZm1kLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgIFN0cmluZyBz\nZXR0ZXJOYW1lID0gZ2V0U2V0dGVyTmFtZShmbWQpOwogICAgICAgIEJDTWV0\naG9kIHNldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKHNldHRlck5hbWUsIHZv\naWQuY2xhc3MsCiAgICAgICAgICAgIG5ldyBDbGFzc1tdIHsgcHJvcFR5cGUg\nfSk7CiAgICAgICAgc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2Qoc2V0dGVy\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gbm90IG5lY2Vzc2FyeSBpZiB3ZSdyZSBhbHJlYWR5IHRy\nYWNraW5nIGFjY2VzcyB2aWEgcmVkZWZpbml0aW9uCiAgICAgICAgaWYgKCFn\nZXRSZWRlZmluZSgpKSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUgb3JpZyB2\nYWx1ZSBvbnRvIHN0YWNrCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRU\naGlzKCk7CiAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29k\nZSwgZm1kKTsKICAgICAgICAgICAgaW50IHZhbCA9IGNvZGUuZ2V0TmV4dExv\nY2Fsc0luZGV4KCk7CiAgICAgICAgICAgIGNvZGUueHN0b3JlKCkuc2V0TG9j\nYWwodmFsKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAg\nICAgICAgIGFkZE5vdGlmeU11dGF0aW9uKGNvZGUsIGZtZCwgdmFsLCAwKTsK\nICAgICAgICB9CgogICAgICAgIC8vICMjIyMjIHRlc3QgY2FzZTogQiBleHRl\nbmRzIEEuIE1ldGhvZHMgZGVmaW5lZCBpbiBBLiBXaGF0CiAgICAgICAgLy8g\nIyMjIyMgaGFwcGVucz8KICAgICAgICAvLyBzdXBlci5zZXRYWFgoLi4uKQog\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS54\nbG9hZCgpLnNldFBhcmFtKDApLnNldFR5cGUocHJvcFR5cGUpOwogICAgICAg\nIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5cGUu\nZ2V0VHlwZSgpLAogICAgICAgICAgICBzZXR0ZXJOYW1lLCB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXSB7IHByb3BUeXBlIH0pOwoKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICBw\ncml2YXRlIGJvb2xlYW4gc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2QoQkNN\nZXRob2QgbWV0aG9kKSB7CiAgICAgICAgQkNNZXRob2RbXSBtZXRob2RzID0g\nX21hbmFnZWRUeXBlLmdldE1ldGhvZHMobWV0aG9kLmdldE5hbWUoKSwKICAg\nICAgICAgICAgbWV0aG9kLmdldFBhcmFtVHlwZXMoKSk7CiAgICAgICAgaWYg\nKG1ldGhvZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBV\nc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hY2Nlc3NvciIsCiAgICAgICAg\nICAgICAgICBfbWFuYWdlZFR5cGUuZ2V0TmFtZSgpLCBtZXRob2QuZ2V0TmFt\nZSgpKSk7CiAgICAgICAgQkNNZXRob2Qgc3VwZXJNZXRoID0gbWV0aG9kc1sw\nXTsKICAgICAgICBpZiAoc3VwZXJNZXRoLmlzUHJpdmF0ZSgpKSB7CiAgICAg\nICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1BhY2th\nZ2UoKSkgewogICAgICAgICAgICBtZXRob2QubWFrZVBhY2thZ2UoKTsKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChzdXBl\nck1ldGguaXNQcm90ZWN0ZWQoKSkgewogICAgICAgICAgICBtZXRob2QubWFr\nZVByb3RlY3RlZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9IGVsc2UgaWYgKHN1cGVyTWV0aC5pc1B1YmxpYygpKSB7CiAgICAgICAg\nICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIGEgbm9uLXN0YXRpYyBnZXR0ZXIgdGhhdCBk\nZWxlZ2F0ZXMgdG8gdGhlIHN1cGVyIG1ldGhvZHMsIGFuZAogICAgICogcGVy\nZm9ybXMgYW55IG5lY2Vzc2FyeSBmaWVsZCB0cmFja2luZy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGFkZFN1YmNsYXNzR2V0TWV0aG9kKEZpZWxkTWV0\nYURhdGEgZm1kKSB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lID0gImdldCIg\nKyBTdHJpbmdVdGlscy5jYXBpdGFsaXplKGZtZC5nZXROYW1lKCkpOwogICAg\nICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRoTmFtZSwgbmV3\nIENsYXNzWzBdKS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgbWV0aE5hbWUg\nPSAiaXMiICsgU3RyaW5nVXRpbHMuY2FwaXRhbGl6ZShmbWQuZ2V0TmFtZSgp\nKTsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhv\nZChtZXRoTmFtZSwgZm1kLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAgICAg\nICBudWxsKTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBlck1ldGhvZChn\nZXR0ZXIpOwogICAgICAgIGdldHRlci5tYWtlUHVibGljKCk7CiAgICAgICAg\nQ29kZSBjb2RlID0gZ2V0dGVyLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8v\nIGlmIHdlJ3JlIG5vdCBhbHJlYWR5IHRyYWNraW5nIGZpZWxkIGFjY2VzcyB2\naWEgcmVmbGVjdGlvbiwgdGhlbiB3ZQogICAgICAgIC8vIG11c3QgbWFrZSB0\naGUgZ2V0dGVyIGhvb2sgaW4gbGF6eSBsb2FkaW5nIGJlZm9yZSBhY2Nlc3Np\nbmcgdGhlIHN1cGVyCiAgICAgICAgLy8gbWV0aG9kLgogICAgICAgIGlmICgh\nZ2V0UmVkZWZpbmUoKSkKICAgICAgICAgICAgYWRkTm90aWZ5QWNjZXNzKGNv\nZGUsIGZtZCk7CgogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRUaGlzKCk7CiAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKF9tYW5hZ2Vk\nVHlwZS5nZXRUeXBlKCksIG1ldGhOYW1lLAogICAgICAgICAgICBmbWQuZ2V0\nRGVjbGFyZWRUeXBlKCksIG51bGwpOwogICAgICAgIGNvZGUueHJldHVybigp\nLnNldFR5cGUoZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBzdGF0\naWMgZ2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICog\nVGhlIGdlbmVyYXRlZCBtZXRob2QgaW50ZXJhY3RzIHdpdGggdGhlIGluc3Rh\nbmNlIHN0YXRlIGFuZCB0aGUKICAgICAqIFN0YXRlTWFuYWdlciB0byBnZXQg\ndGhlIHZhbHVlIG9mIHRoZSBmaWVsZC4KICAgICAqCiAgICAgKiBAcGFyYW0g\naW5kZXggdGhlIHJlbGF0aXZlIG51bWJlciBvZiB0aGUgZmllbGQKICAgICAq\nIEBwYXJhbSBmbWQgbWV0YWRhdGEgYWJvdXQgdGhlIGZpZWxkIHRvIGdldAog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkR2V0TWV0aG9kKGludCBpbmRl\neCwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gY3Jl\nYXRlR2V0TWV0aG9kKGZtZCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9k\nLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIGlmIHJlYWRzIGFyZSBub3Qg\nY2hlY2tlZCwganVzdCByZXR1cm4gdGhlIHZhbHVlCiAgICAgICAgYnl0ZSBm\naWVsZEZsYWcgPSBnZXRGaWVsZEZsYWcoZm1kKTsKICAgICAgICBpZiAoKGZp\nZWxkRmxhZyAmIFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFEKSA9PSAw\nCiAgICAgICAgICAgICYmIChmaWVsZEZsYWcgJiBQZXJzaXN0ZW5jZUNhcGFi\nbGUuTUVESUFURV9SRUFEKSA9PSAwKSB7CiAgICAgICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgY29kZS54\ncmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAg\nICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRlTWFu\nYWdlciA9PSBudWxsKSByZXR1cm4gaW5zdC48ZmllbGQ+OwogICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAgICAgY29kZS5n\nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIEp1bXBJ\nbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7CiAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlKTsKICAgICAgICBhZGRH\nZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgY29kZS54\ncmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkpOwoKICAg\nICAgICAvLyBpbnQgZmllbGQgPSBwY0luaGVyaXRlZEZpZWxkQ291bnQgKyA8\nZmllbGRpbmRleD47CiAgICAgICAgaW50IGZpZWxkTG9jYWwgPSBjb2RlLmdl\ndE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcykp\nOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpbmRleCk7CiAg\nICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgY29kZS5pc3RvcmUoKS5zZXRM\nb2NhbChmaWVsZExvY2FsKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0YXRlTWFu\nYWdlci5hY2Nlc3NpbmdGaWVsZCAoZmllbGQpOwogICAgICAgIC8vIHJldHVy\nbiBpbnN0LjxmaWVsZD47CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCB0cnVlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgY29kZS5pbG9hZCgpLnNldExvY2FsKGZp\nZWxkTG9jYWwpOwogICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0\nTWV0aG9kKFNNVFlQRSwgImFjY2Vzc2luZ0ZpZWxkIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcyB9KTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGFk\nZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2Rl\nLnhyZXR1cm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7Cgog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyBhIHN0YXRpYyBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmll\nbGQuCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0\naCB0aGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5h\nZ2VyIHRvIHNldCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAg\nICAqIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBm\naWVsZAogICAgICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmll\nbGQgdG8gc2V0CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXRNZXRo\nb2QoaW50IGluZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBt\nZXRob2QgPSBjcmVhdGVTZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNv\nZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gUENFbmhh\nbmNlciB1c2VzIHN0YXRpYyBtZXRob2RzOyBQQ1N1YmNsYXNzZXIgZG9lcyBu\nb3QuCiAgICAgICAgaW50IGZpcnN0UGFyYW1PZmZzZXQgPSBnZXRBY2Nlc3Nv\nclBhcmFtZXRlck9mZnNldCgpOwoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0\nYXRlTWFuYWdlciA9PSBudWxsKSBpbnN0LjxmaWVsZD4gPSB2YWx1ZTsKICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAg\nICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVsbCgpOwog\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSk7CiAgICAg\nICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZpcnN0UGFyYW1PZmZzZXQpOwog\nICAgICAgIGFkZFNldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAg\nICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgLy8gaW5zdC5wY1N0YXRl\nTWFuYWdlci5zZXR0aW5nPGZpZWxkVHlwZT5GaWVsZCAoaW5zdCwKICAgICAg\nICAvLyAgICAgcGNJbmhlcml0ZWRGaWVsZENvdW50ICsgPGluZGV4PiwgaW5z\ndC48ZmllbGQ+LCB2YWx1ZSwgMCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSkpOwogICAgICAgIGNv\nZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAgIGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAg\nIGNvZGUuaWFkZCgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29k\nZSwgdHJ1ZSk7CiAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2Rl\nLCBmbWQpOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBh\ncmFtT2Zmc2V0KTsKICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nMCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2Qo\nZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAgIChmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCksICJzZXR0aW5nIiwgZmFsc2UsIHRydWUpKTsKICAgICAg\nICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhT\ndGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmVzIHdoaWNoIGF0dGFjaCAv\nIGRldGFjaCBtZXRob2RzIHRvIHVzZS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZEF0dGFjaERldGFjaENvZGUoKQogICAgICAgIHRocm93cyBOb1N1\nY2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIHNlZSBpZiBhbnkgc3Vw\nZXJjbGFzc2VzIGFyZSBkZXRhY2hhYmxlCiAgICAgICAgYm9vbGVhbiBwYXJl\nbnREZXRhY2hhYmxlID0gZmFsc2U7CiAgICAgICAgZm9yIChDbGFzc01ldGFE\nYXRhIHBhcmVudCA9IF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7\nCiAgICAgICAgICAgIHBhcmVudCAhPSBudWxsOyBwYXJlbnQgPSBwYXJlbnQu\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkgewogICAgICAgICAgICBpZiAo\ncGFyZW50LmlzRGV0YWNoYWJsZSgpKSB7CiAgICAgICAgICAgICAgICBwYXJl\nbnREZXRhY2hhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBwYXJlbnQg\nbm90IGRldGFjaGFibGUsIHdlIG5lZWQgdG8gYWRkIHRoZSBkZXRhY2ggc3Rh\ndGUgZmllbGRzIGFuZAogICAgICAgIC8vIGFjY2Vzc29yIG1ldGhvZHMKICAg\nICAgICBpZiAoX21ldGEuZ2V0UENTdXBlcmNsYXNzKCkgPT0gbnVsbCB8fCBn\nZXRDcmVhdGVTdWJjbGFzcygpCiAgICAgICAgICAgIHx8IHBhcmVudERldGFj\naGFibGUgIT0gX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAg\nYWRkSXNEZXRhY2hlZE1ldGhvZCgpOwogICAgICAgICAgICBhZGREZXRhY2hl\nZFN0YXRlTWV0aG9kcyhfbWV0YS51c2VzRGV0YWNoZWRTdGF0ZSgpCiAgICAg\nICAgICAgICAgICAhPSBCb29sZWFuLkZBTFNFKTsKICAgICAgICB9CgogICAg\nICAgIC8vIGlmIHdlIGRldGFjaCBvbiBzZXJpYWxpemUsIHdlIGFsc28gbmVl\nZCB0byBpbXBsZW1lbnQgdGhlCiAgICAgICAgLy8gZXh0ZXJuYWxpemFibGUg\naW50ZXJmYWNlIHRvIHdyaXRlIGp1c3QgdGhlIHN0YXRlIGZvciB0aGUgZmll\nbGRzCiAgICAgICAgLy8gYmVpbmcgZGV0YWNoZWQKICAgICAgICBpZiAoZXh0\nZXJuYWxpemVEZXRhY2hlZCgpKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBhZGREZXRhY2hFeHRlcm5hbGl6ZShwYXJlbnREZXRhY2hh\nYmxlLAogICAgICAgICAgICAgICAgICAgIF9tZXRhLnVzZXNEZXRhY2hlZFN0\nYXRlKCkgIT0gQm9vbGVhbi5GQUxTRSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBuc21lKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihuc21lKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUg\nZmllbGRzIHRvIGhvbGQgZGV0YWNoZWQgc3RhdGUgYW5kIHRoZWlyIGFjY2Vz\nc29yIG1ldGhvZHMuCiAgICAgKgogICAgICogQHBhcmFtIGltcGwgd2hldGhl\nciB0byBmdWxseSBpbXBsZW1lbnQgZGV0YWNoIHN0YXRlIGZ1bmN0aW9uYWxp\ndHkKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZERldGFjaGVkU3RhdGVN\nZXRob2RzKGJvb2xlYW4gaW1wbCkgewogICAgICAgIEZpZWxkIGRldGFjaEZp\nZWxkID0gX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCk7CiAgICAgICAg\nU3RyaW5nIG5hbWUgPSBudWxsOwogICAgICAgIFN0cmluZyBkZWNsYXJlciA9\nIG51bGw7CiAgICAgICAgaWYgKGltcGwgJiYgZGV0YWNoRmllbGQgPT0gbnVs\nbCkgewogICAgICAgICAgICBuYW1lID0gUFJFICsgIkRldGFjaGVkU3RhdGUi\nOwogICAgICAgICAgICBkZWNsYXJlciA9IF9wYy5nZXROYW1lKCk7CiAgICAg\nICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZGVjbGFyZUZpZWxkKG5hbWUs\nIE9iamVjdC5jbGFzcyk7CiAgICAgICAgICAgIGZpZWxkLm1ha2VQcml2YXRl\nKCk7CiAgICAgICAgICAgIGZpZWxkLnNldFRyYW5zaWVudCh0cnVlKTsKICAg\nICAgICB9IGVsc2UgaWYgKGltcGwpIHsKICAgICAgICAgICAgbmFtZSA9IGRl\ndGFjaEZpZWxkLmdldE5hbWUoKTsKICAgICAgICAgICAgZGVjbGFyZXIgPSBk\nZXRhY2hGaWVsZC5nZXREZWNsYXJpbmdDbGFzcygpLmdldE5hbWUoKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHB1YmxpYyBPYmplY3QgcGNHZXREZXRhY2hl\nZFN0YXRlICgpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xh\ncmVNZXRob2QoUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAg\nICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIG1ldGhvZC5zZXRTdGF0\naWMoZmFsc2UpOwogICAgICAgIG1ldGhvZC5tYWtlUHVibGljKCk7CiAgICAg\nICAgaW50IGFjY2VzcyA9IG1ldGhvZC5nZXRBY2Nlc3NGbGFncygpOwoKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBpZiAoaW1wbCkgewogICAgICAgICAgICAvLyByZXR1cm4gcGNEZXRhY2hl\nZFN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUs\nIGZhbHNlKTsKICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgX21hbmFnZWRU\neXBlLmdldFByb2plY3QoKS5sb2FkQ2xhc3MoZGVjbGFyZXIpLAogICAgICAg\nICAgICAgICAgbmFtZSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CgogICAgICAgIC8vIHB1Ymxp\nYyB2b2lkIHBjU2V0RGV0YWNoZWRTdGF0ZSAoT2JqZWN0IHN0YXRlKQogICAg\nICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJTZXREZXRh\nY2hlZFN0YXRlIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNz\nIFtdeyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgbWV0aG9kLnNldEFjY2Vz\nc0ZsYWdzKGFjY2Vzcyk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2Rl\nKHRydWUpOwogICAgICAgIGlmIChpbXBsKSB7CiAgICAgICAgICAgIC8vIHBj\nRGV0YWNoZWRTdGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBf\nbWFuYWdlZFR5cGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciks\nCiAgICAgICAgICAgICAgICBuYW1lLCBPYmplY3QuY2xhc3MpOwogICAgICAg\nIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgdG8gPGNvZGU+Y29k\nZTwvY29kZT4gdGhlIGluc3RydWN0aW9ucyB0byBnZXQgZmllbGQKICAgICAq\nIDxjb2RlPmF0dHJOYW1lPC9jb2RlPiBkZWNsYXJlZCBpbiB0eXBlIDxjb2Rl\nPmRlY2xhcmVyPC9jb2RlPgogICAgICogb250byB0aGUgdG9wIG9mIHRoZSBz\ndGFjay4KICAgICAqCiAgICAgKiBUaGUgaW5zdGFuY2UgdG8gYWNjZXNzIG11\nc3QgYWxyZWFkeSBiZSBvbiB0aGUgdG9wIG9mIHRoZQogICAgICogc3RhY2sg\nd2hlbiB0aGlzIGlzIGludm9rZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBnZXRmaWVsZChDb2RlIGNvZGUsIEJDQ2xhc3MgZGVjbGFyZXIsIFN0cmlu\nZyBhdHRyTmFtZSkgewogICAgICAgIGlmIChkZWNsYXJlciA9PSBudWxsKQog\nICAgICAgICAgICBkZWNsYXJlciA9IF9tYW5hZ2VkVHlwZTsKCiAgICAgICAg\nLy8gZmlyc3QsIHNlZSBpZiB3ZSBjYW4gY29udmVydCB0aGUgYXR0cmlidXRl\nIG5hbWUgdG8gYSBmaWVsZCBuYW1lCiAgICAgICAgU3RyaW5nIGZpZWxkTmFt\nZSA9IHRvQmFja2luZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAgIC8v\nIG5leHQsIGZpbmQgdGhlIGZpZWxkIGluIHRoZSBtYW5hZ2VkIHR5cGUgaGll\ncmFyY2h5CiAgICAgICAgQkNGaWVsZCBmaWVsZCA9IG51bGw7CiAgICAgICAg\nb3V0ZXI6IGZvciAoQkNDbGFzcyBiYyA9IF9wYzsgYmMgIT0gbnVsbDsgYmMg\nPSBiYy5nZXRTdXBlcmNsYXNzQkMoKSkgewogICAgICAgICAgICBCQ0ZpZWxk\nW10gZmllbGRzID0gKEJDRmllbGRbXSkgQWNjZXNzQ29udHJvbGxlcgogICAg\nICAgICAgICAgICAgLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhlbHBlci5nZXRC\nQ0NsYXNzRmllbGRzQWN0aW9uKGJjLAogICAgICAgICAgICAgICAgICAgIGZp\nZWxkTmFtZSkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZp\nZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZmllbGQgPSBm\naWVsZHNbaV07CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSByZWFjaCBhIGZp\nZWxkIGRlY2xhcmVkIGluIHRoaXMgdHlwZSwgdGhlbiB0aGlzIGlzIHRoZQog\nICAgICAgICAgICAgICAgLy8gbW9zdC1tYXNraW5nIGZpZWxkLCBhbmQgaXMg\ndGhlIG9uZSB0aGF0IHdlIHdhbnQuCiAgICAgICAgICAgICAgICBpZiAoZmll\nbGRzW2ldLmdldERlY2xhcmVyKCkgPT0gZGVjbGFyZXIpIHsKICAgICAgICAg\nICAgICAgICAgICBicmVhayBvdXRlcjsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGdldENyZWF0ZVN1\nYmNsYXNzKCkgJiYgY29kZS5nZXRNZXRob2QoKS5nZXREZWNsYXJlcigpID09\nIF9wYwogICAgICAgICAgICAmJiAoZmllbGQgPT0gbnVsbCB8fCAhZmllbGQu\naXNQdWJsaWMoKSkpIHsKICAgICAgICAgICAgLy8gd2UncmUgY3JlYXRpbmcg\ndGhlIHN1YmNsYXNzLCBub3QgcmVkZWZpbmluZyB0aGUgdXNlciB0eXBlLgoK\nICAgICAgICAgICAgLy8gUmVmbGVjdGlvbi5nZXRYWFgodGhpcywgUmVmbGVj\ndGlvbi5maW5kRmllbGQoLi4uKSk7CiAgICAgICAgICAgIGNvZGUuY2xhc3Nj\nb25zdGFudCgpLnNldENsYXNzKGRlY2xhcmVyKTsKICAgICAgICAgICAgY29k\nZS5jb25zdGFudCgpLnNldFZhbHVlKGZpZWxkTmFtZSk7CiAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFz\ncywKICAgICAgICAgICAgICAgICJmaW5kRmllbGQiLCBGaWVsZC5jbGFzcywg\nbmV3IENsYXNzW10gewogICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIFN0\ncmluZy5jbGFzcywgYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgQ2xh\nc3MgdHlwZSA9IF9tZXRhLmdldEZpZWxkKGF0dHJOYW1lKS5nZXREZWNsYXJl\nZFR5cGUoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNv\nZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKAogICAgICAgICAgICAgICAg\nICAgIGdldFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgRmllbGQuY2xh\nc3MpKTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0aG9kRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIHNob3VsZCBuZXZlciBoYXBw\nZW4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlv\nbihlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXR5cGUuaXNQ\ncmltaXRpdmUoKSAmJiB0eXBlICE9IE9iamVjdC5jbGFzcykKICAgICAgICAg\nICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoZGVjbGFyZXIuZ2V0TmFtZSgpLCBmaWVsZE5hbWUsCiAgICAgICAgICAg\nICAgICBmaWVsZC5nZXRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRvIDxjb2RlPmNvZGU8L2NvZGU+\nIHRoZSBpbnN0cnVjdGlvbnMgdG8gc2V0IGZpZWxkCiAgICAgKiA8Y29kZT5h\ndHRyTmFtZTwvY29kZT4gZGVjbGFyZWQgaW4gdHlwZSA8Y29kZT5kZWNsYXJl\ncjwvY29kZT4KICAgICAqIHRvIHRoZSB2YWx1ZSBvZiB0eXBlIDxjb2RlPmZp\nZWxkVHlwZTwvY29kZT4gb24gdGhlIHRvcCBvZiB0aGUgc3RhY2suCiAgICAg\nKgogICAgICogV2hlbiB0aGlzIG1ldGhvZCBpcyBpbnZva2VkLCB0aGUgdmFs\ndWUgdG8gbG9hZCBtdXN0CiAgICAgKiBhbHJlYWR5IGJlIG9uIHRoZSB0b3Ag\nb2YgdGhlIHN0YWNrIGluIDxjb2RlPmNvZGU8L2NvZGU+LAogICAgICogYW5k\nIHRoZSBpbnN0YW5jZSB0byBsb2FkIGludG8gbXVzdCBiZSBzZWNvbmQuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBwdXRmaWVsZChDb2RlIGNvZGUsIEJD\nQ2xhc3MgZGVjbGFyZXIsIFN0cmluZyBhdHRyTmFtZSwKICAgICAgICBDbGFz\ncyBmaWVsZFR5cGUpIHsKICAgICAgICBpZiAoZGVjbGFyZXIgPT0gbnVsbCkK\nICAgICAgICAgICAgZGVjbGFyZXIgPSBfbWFuYWdlZFR5cGU7CgogICAgICAg\nIFN0cmluZyBmaWVsZE5hbWUgPSB0b0JhY2tpbmdGaWVsZE5hbWUoYXR0ck5h\nbWUpOwoKICAgICAgICBpZiAoZ2V0UmVkZWZpbmUoKSB8fCBnZXRDcmVhdGVT\ndWJjbGFzcygpKSB7CiAgICAgICAgICAgIC8vIFJlZmxlY3Rpb24uc2V0KHRo\naXMsIFJlZmxlY3Rpb24uZmluZEZpZWxkKC4uLiksIHZhbHVlKTsKICAgICAg\nICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZGVjbGFyZXIp\nOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZmllbGRO\nYW1lKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRy\ndWUpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhv\nZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgImZpbmRGaWVs\nZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAgICAgICAg\nICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNsYXNzIH0p\nOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChS\nZWZsZWN0aW9uLmNsYXNzLCAic2V0IiwKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXSB7CiAgICAgICAg\nICAgICAgICAgICAgT2JqZWN0LmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nIGZpZWxkVHlwZS5pc1ByaW1pdGl2ZSgpID8gZmllbGRUeXBlIDogT2JqZWN0\nLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICBGaWVsZC5jbGFzcyB9KTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkK\nICAgICAgICAgICAgICAgIC5zZXRGaWVsZChkZWNsYXJlci5nZXROYW1lKCks\nIGZpZWxkTmFtZSwgZmllbGRUeXBlLmdldE5hbWUoKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogSWYgdXNpbmcgcHJvcGVydHkgYWNjZXNz\nLCBzZWUgaWYgdGhlcmUgaXMgYSBkaWZmZXJlbnQgYmFja2luZyBmaWVsZAog\nICAgICogbmFtZSBmb3IgdGhlIHBlcnNpc3RlbnQgYXR0cmlidXRlIDxjb2Rl\nPm5hbWU8L2NvZGU+LgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyB0b0Jh\nY2tpbmdGaWVsZE5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX21l\ndGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX1BS\nT1BFUlRZCiAgICAgICAgICAgICYmIF9hdHRyc1RvRmllbGRzICE9IG51bGwg\nJiYgX2F0dHJzVG9GaWVsZHMuY29udGFpbnNLZXkobmFtZSkpCiAgICAgICAg\nICAgIG5hbWUgPSAoU3RyaW5nKSBfYXR0cnNUb0ZpZWxkcy5nZXQobmFtZSk7\nCiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nZiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBpcyBhIGRp\nZmZlcmVudCBwZXJzaXN0ZW50CiAgICAgKiBhdHRyaWJ1dGUgbmFtZSBmb3Ig\ndGhlIGJhY2tpbmcgZmllbGQgPGNvZGU+bmFtZTwvY29kZT4uCiAgICAgKi8K\nICAgIHByaXZhdGUgU3RyaW5nIGZyb21CYWNraW5nRmllbGROYW1lKFN0cmlu\nZyBuYW1lKSB7CiAgICAgICAgLy8gbWV0YSBpcyBudWxsIHdoZW4gZG9pbmcg\ncGVyc2lzdGVuY2UtYXdhcmUgZW5oYW5jZW1lbnQKICAgICAgICBpZiAoX21l\ndGEgIT0gbnVsbAogICAgICAgICAgICAmJiBfbWV0YS5nZXRBY2Nlc3NUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfUFJPUEVSVFkKICAgICAgICAg\nICAgJiYgX2ZpZWxkc1RvQXR0cnMgIT0gbnVsbCAmJiBfZmllbGRzVG9BdHRy\ncy5jb250YWluc0tleShuYW1lKSkKICAgICAgICAgICAgcmV0dXJuIChTdHJp\nbmcpIF9maWVsZHNUb0F0dHJzLmdldChuYW1lKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIC8qKgogICAgICog\nSW1wbGVtZW50IHRoZSBleHRlcm5hbGl6YWJsZSBpbnRlcmZhY2UgdG8gZGV0\nYWNoIG9uIHNlcmlhbGl6ZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZERldGFjaEV4dGVybmFsaXplKGJvb2xlYW4gcGFyZW50RGV0YWNoYWJsZSwK\nICAgICAgICBib29sZWFuIGRldGFjaGVkU3RhdGUpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZW5zdXJlIHRo\nYXQgdGhlIGRlY2xhcmVkIGRlZmF1bHQgY29uc3RydWN0b3IgaXMgcHVibGlj\nIAogICAgICAgIC8vIGZvciBleHRlcm5hbGl6YXRpb24KICAgICAgICBCQ01l\ndGhvZCBtZXRoID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKCI8aW5pdD4iLCAo\nU3RyaW5nW10pIG51bGwpOwogICAgICAgIGlmICghbWV0aC5pc1B1YmxpYygp\nKSB7CiAgICAgICAgICAgIGlmIChfbG9nLmlzV2FybkVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdldCgiZW5oYW5jZS1kZWZj\nb25zLWV4dGVybiIsIAogICAgICAgICAgICAgICAgICBfbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCkpKTsKICAgICAgICAgICAgbWV0aC5tYWtlUHVibGljKCk7\nCiAgICAgICAgfQogICAgICAgIC8vIGRlY2xhcmUgZXh0ZXJuYWxpemFibGUg\naW50ZXJmYWNlCiAgICAgICAgaWYgKCFFeHRlcm5hbGl6YWJsZS5jbGFzcy5p\nc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAg\nICAgICAgICAgIF9wYy5kZWNsYXJlSW50ZXJmYWNlKEV4dGVybmFsaXphYmxl\nLmNsYXNzKTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSB1c2VyIGRvZXNu\nJ3QgYWxyZWFkeSBoYXZlIGN1c3RvbSBleHRlcm5hbGl6YXRpb24gb3IKICAg\nICAgICAvLyBzZXJpYWxpemF0aW9uIG1ldGhvZHMKICAgICAgICBDbGFzc1td\nIGlucHV0ID0gbmV3IENsYXNzW117IE9iamVjdElucHV0U3RyZWFtLmNsYXNz\nIH07CiAgICAgICAgQ2xhc3NbXSBvdXRwdXQgPSBuZXcgQ2xhc3NbXXsgT2Jq\nZWN0T3V0cHV0U3RyZWFtLmNsYXNzIH07CiAgICAgICAgaWYgKF9tYW5hZ2Vk\nVHlwZS5nZXREZWNsYXJlZE1ldGhvZCgicmVhZE9iamVjdCIsIGlucHV0KSAh\nPSBudWxsCiAgICAgICAgICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJl\nZE1ldGhvZCgid3JpdGVPYmplY3QiLCBvdXRwdXQpICE9IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJkZXRh\nY2gtY3VzdG9tLXNlciIsIF9tZXRhKSk7CiAgICAgICAgaW5wdXRbMF0gPSBP\nYmplY3RJbnB1dC5jbGFzczsKICAgICAgICBvdXRwdXRbMF0gPSBPYmplY3RP\ndXRwdXQuY2xhc3M7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXREZWNs\nYXJlZE1ldGhvZCgicmVhZEV4dGVybmFsIiwgaW5wdXQpICE9IG51bGwKICAg\nICAgICAgICAgfHwgX21hbmFnZWRUeXBlLmdldERlY2xhcmVkTWV0aG9kKCJ3\ncml0ZUV4dGVybmFsIiwgb3V0cHV0KSAhPSBudWxsKQogICAgICAgICAgICB0\naHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiZGV0YWNoLWN1c3Rv\nbS1leHRlcm4iLCBfbWV0YSkpOwoKICAgICAgICAvLyBjcmVhdGUgbGlzdCBv\nZiBhbGwgdW5tYW5hZ2VkIHNlcmlhbGl6YWJsZSBmaWVsZHMKICAgICAgICBC\nQ0ZpZWxkW10gZmllbGRzID0gX21hbmFnZWRUeXBlLmdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgQ29sbGVjdGlvbiB1bm1nZCA9IG5ldyBBcnJheUxp\nc3QoZmllbGRzLmxlbmd0aCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFmaWVs\nZHNbaV0uaXNUcmFuc2llbnQoKSAmJiAhZmllbGRzW2ldLmlzU3RhdGljKCkK\nICAgICAgICAgICAgICAgICYmICFmaWVsZHNbaV0uaXNGaW5hbCgpCiAgICAg\nICAgICAgICAgICAmJiAhZmllbGRzW2ldLmdldE5hbWUoKS5zdGFydHNXaXRo\nKFBSRSkKICAgICAgICAgICAgICAgICYmIF9tZXRhLmdldERlY2xhcmVkRmll\nbGQoZmllbGRzW2ldLmdldE5hbWUoKSkgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHVubWdkLmFkZChmaWVsZHNbaV0pOwogICAgICAgIH0KCiAgICAgICAg\nYWRkUmVhZEV4dGVybmFsKHBhcmVudERldGFjaGFibGUsIGRldGFjaGVkU3Rh\ndGUpOwogICAgICAgIGFkZFJlYWRVbm1hbmFnZWQodW5tZ2QsIHBhcmVudERl\ndGFjaGFibGUpOwogICAgICAgIGFkZFdyaXRlRXh0ZXJuYWwocGFyZW50RGV0\nYWNoYWJsZSwgZGV0YWNoZWRTdGF0ZSk7CiAgICAgICAgYWRkV3JpdGVVbm1h\nbmFnZWQodW5tZ2QsIHBhcmVudERldGFjaGFibGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIGN1c3RvbSByZWFkRXh0ZXJuYWwgbWV0aG9kLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkUmVhZEV4dGVybmFsKGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3Rh\ndGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0SW5w\ndXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0gX3BjLmRlY2xh\ncmVNZXRob2QoInJlYWRFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIGluYXJncyk7\nCiAgICAgICAgRXhjZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlv\nbnModHJ1ZSk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihDbGFz\nc05vdEZvdW5kRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUg\nPSBtZXRoLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLnJlYWRF\neHRlcm5hbCAoaW4pOwogICAgICAgIENsYXNzIHN1cCA9IF9tZXRhLmdldERl\nc2NyaWJlZFR5cGUoKS5nZXRTdXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKCFw\nYXJlbnREZXRhY2hhYmxlICYmIEV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNz\naWduYWJsZUZyb20oc3VwKSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2Qoc3VwLCAicmVhZEV4dGVybmFsIiwKICAgICAgICAgICAg\nICAgIHZvaWQuY2xhc3MsIGluYXJncyk7CiAgICAgICAgfQoKICAgICAgICAv\nLyByZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChnZXRUeXBlKF9tZXRhKSwKICAgICAgICAgICAgUFJFICsgIlJlYWRVbm1h\nbmFnZWQiLCB2b2lkLmNsYXNzLCBpbmFyZ3MpOwoKICAgICAgICBpZiAoZGV0\nYWNoZWRTdGF0ZSkgewogICAgICAgICAgICAvLyBwY1NldERldGFjaGVkU3Rh\ndGUgKGluLnJlYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVy\nZmFjZSgpLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmpl\nY3QiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSAr\nICJTZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xh\nc3MsIG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfSk7CgogICAgICAgICAg\nICAvLyBwY1JlcGxhY2VTdGF0ZU1hbmFnZXIgKChTdGF0ZU1hbmFnZXIpIGlu\nLnJlYWRPYmplY3QgKCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgp\nLnNldE1ldGhvZChPYmplY3RJbnB1dC5jbGFzcywgInJlYWRPYmplY3QiLAog\nICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAg\nICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKFN0YXRlTWFuYWdlci5jbGFz\ncyk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChQUkUgKyAiUmVwbGFjZVN0YXRlTWFuYWdlciIsCiAgICAgICAgICAgICAg\nICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU3RhdGVNYW5hZ2VyLmNsYXNz\nIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVhZCBtYW5hZ2VkIGZpZWxk\ncwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNUcmFuc2llbnQo\nKSkKICAgICAgICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmbWRzW2ld\nLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZSgpLCBmbWRzW2ldKTsKCiAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZWFkIHVubWFuYWdlZCBmaWVsZHMgZnJvbSB0aGUgc3RyZWFtIChw\nY1JlYWRVbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nUmVhZFVubWFuYWdlZChDb2xsZWN0aW9uIHVubWdkLCBib29sZWFuIHBhcmVu\ndERldGFjaGFibGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQ2xhc3NbXSBpbmFyZ3MgPSBuZXcgQ2xhc3NbXXsg\nT2JqZWN0SW5wdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhvZCBtZXRoID0g\nX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2b2lk\nLmNsYXNzLAogICAgICAgICAgICBpbmFyZ3MpOwogICAgICAgIG1ldGgubWFr\nZVByb3RlY3RlZCgpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0\naC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNl\ncHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4Y2Vwcy5hZGRF\neGNlcHRpb24oQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAg\nICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAv\nLyBzdXBlci5yZWFkVW5tYW5hZ2VkIChpbik7CiAgICAgICAgaWYgKHBhcmVu\ndERldGFjaGFibGUpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5j\nZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0\nTWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpKSwgUFJFICsgIlJlYWRVbm1hbmFnZWQiLCB2\nb2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIGluYXJncyk7CiAgICAgICAg\nfQoKICAgICAgICAvLyByZWFkIGRlY2xhcmVkIHVubWFuYWdlZCBzZXJpYWxp\nemFibGUgZmllbGRzCiAgICAgICAgQkNGaWVsZCBmaWVsZDsKICAgICAgICBm\nb3IgKEl0ZXJhdG9yIGl0ciA9IHVubWdkLml0ZXJhdG9yKCk7IGl0ci5oYXNO\nZXh0KCk7KSB7CiAgICAgICAgICAgIGZpZWxkID0gKEJDRmllbGQpIGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIHJlYWRFeHRlcm5hbChjb2RlLCBmaWVsZC5n\nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAgfQog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZWFk\nIGEgZmllbGQgZnJvbSBhbiBleHRlcm5hbGl6YXRpb24gaW5wdXQgc3RyZWFt\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVhZEV4dGVybmFsKENvZGUg\nY29kZSwgU3RyaW5nIGZpZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbWV0aE5hbWU7CiAgICAgICAg\naWYgKHR5cGUuaXNQcmltaXRpdmUoKSkgewogICAgICAgICAgICBtZXRoTmFt\nZSA9IHR5cGUuZ2V0TmFtZSgpOwogICAgICAgICAgICBtZXRoTmFtZSA9IG1l\ndGhOYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZShMb2NhbGUuRU5H\nTElTSCkKICAgICAgICAgICAgICAgICsgbWV0aE5hbWUuc3Vic3RyaW5nKDEp\nOwogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFkIiArIG1ldGhOYW1lOwog\nICAgICAgIH0gZWxzZQogICAgICAgICAgICBtZXRoTmFtZSA9ICJyZWFkT2Jq\nZWN0IjsKCiAgICAgICAgLy8gPGZpZWxkPiA9IGluLnJlYWQ8dHlwZT4gKCk7\nCiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIENsYXNz\nIHJldCA9ICh0eXBlLmlzUHJpbWl0aXZlKCkpID8gdHlwZSA6IE9iamVjdC5j\nbGFzczsKICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhv\nZChPYmplY3RJbnB1dC5jbGFzcywgbWV0aE5hbWUsCiAgICAgICAgICAgIHJl\ndCwgbnVsbCk7CiAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYg\ndHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZSh0eXBlKTsKICAgICAgICBpZiAoZm1kID09IG51bGwp\nCiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIG51bGwsIGZpZWxkTmFtZSwg\ndHlwZSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFkZFNldE1hbmFn\nZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5D\nT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQ\nOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAgICAg\nICAgICAgICAgICAgLy8gaWYgKHNtICE9IG51bGwpCiAgICAgICAgICAgICAg\nICAgICAgLy8gICBzbS5wcm94eURldGFjaGVkRGVzZXJpYWxpemVkICg8aW5k\nZXg+KTsKICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmdldGZp\nZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAgICAg\nICAgSWZJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZudWxsKCk7CiAgICAg\nICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZp\nZWxkKFNNLCBTTVRZUEUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01U\nWVBFLAogICAgICAgICAgICAgICAgICAgICAgICAicHJveHlEZXRhY2hlZERl\nc2VyaWFsaXplZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgICAgICAg\nICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGN1c3Rv\nbSB3cml0ZUV4dGVybmFsIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFkZFdyaXRlRXh0ZXJuYWwoYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxl\nLAogICAgICAgIGJvb2xlYW4gZGV0YWNoZWRTdGF0ZSkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBDbGFzc1tdIG91\ndGFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0T3V0cHV0LmNsYXNzIH07CiAg\nICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJ3cml0\nZUV4dGVybmFsIiwgdm9pZC5jbGFzcywgb3V0YXJncyk7CiAgICAgICAgRXhj\nZXB0aW9ucyBleGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAg\nICAgICAgZXhjZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7\nCiAgICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBzdXBlci53cml0ZUV4dGVybmFsIChvdXQpOwogICAgICAgIENs\nYXNzIHN1cCA9IGdldFR5cGUoX21ldGEpLmdldFN1cGVyY2xhc3MoKTsKICAg\nICAgICBpZiAoIXBhcmVudERldGFjaGFibGUgJiYgRXh0ZXJuYWxpemFibGUu\nY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShzdXApKSB7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChzdXAsICJ3cml0ZUV4dGVybmFsIiwK\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG91dGFyZ3MpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gd3JpdGVVbm1hbmFnZWQgKG91dCk7CiAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhKSwKICAgICAgICAgICAg\nUFJFICsgIldyaXRlVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgb3V0YXJncyk7\nCgogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBnbzIgPSBudWxsOwogICAgICAg\nIGlmIChkZXRhY2hlZFN0YXRlKSB7CiAgICAgICAgICAgIC8vIGlmIChzbSAh\nPSBudWxsKQogICAgICAgICAgICAvLyAgIGlmIChzbS53cml0ZURldGFjaGVk\nIChvdXQpKQogICAgICAgICAgICAvLyAgICAgIHJldHVybjsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgSWZJbnN0cnVjdGlvbiBpZm51bGwgPSBjb2RlLmlmbnVsbCgp\nOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBT\nTVRZUEUpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9k\nKFNNVFlQRSwgIndyaXRlRGV0YWNoZWQiLAogICAgICAgICAgICAgICAgYm9v\nbGVhbi5jbGFzcywgb3V0YXJncyk7CiAgICAgICAgICAgIGdvMiA9IGNvZGUu\naWZlcSgpOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKCiAgICAgICAg\nICAgIC8vIGVsc2UKICAgICAgICAgICAgLy8gICBvdXQud3JpdGVPYmplY3Qg\nKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSk7CiAgICAgICAgICAgIENsYXNzW10g\nb2JqYXJncyA9IG5ldyBDbGFzc1tdeyBPYmplY3QuY2xhc3MgfTsKICAgICAg\nICAgICAgaWZudWxsLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMCkpOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0\naG9kKFBSRSArICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAg\nIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\naW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5jbGFzcywKICAg\nICAgICAgICAgICAgICJ3cml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG9iamFy\nZ3MpOwogICAgICAgICAgICAvLyAgICBvdXQud3JpdGVPYmplY3QgKG51bGwp\nIC8vIFN0YXRlTWFuYWdlcgogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nUGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgoT2JqZWN0KSBudWxsKTsKICAgICAgICAgICAgY29kZS5pbnZva2VpbnRl\ncmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNzLAogICAgICAg\nICAgICAgICAgIndyaXRlT2JqZWN0Iiwgdm9pZC5jbGFzcywgb2JqYXJncyk7\nCiAgICAgICAgfQogICAgICAgIGlmIChnbzIgIT0gbnVsbCkKICAgICAgICAg\nICAgZ28yLnNldFRhcmdldChjb2RlLm5vcCgpKTsKCiAgICAgICAgLy8gd3Jp\ndGUgbWFuYWdlZCBmaWVsZHMKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFmbWRz\nW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICB3cml0ZUV4dGVy\nbmFsKGNvZGUsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAg\nICAgIGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksIGZtZHNbaV0pOwoKICAg\nICAgICAvLyByZXR1cm4KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRl\nIHVubWFuYWdlZCBmaWVsZHMgdG8gdGhlIHN0cmVhbSAocGNXcml0ZVVubWFu\nYWdlZCkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZVVubWFu\nYWdlZChDb2xsZWN0aW9uIHVubWdkLCBib29sZWFuIHBhcmVudERldGFjaGFi\nbGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ2xhc3NbXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVjdE91\ndHB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVj\nbGFyZU1ldGhvZChQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2b2lkLmNsYXNz\nLAogICAgICAgICAgICBvdXRhcmdzKTsKICAgICAgICBtZXRoLm1ha2VQcm90\nZWN0ZWQoKTsKICAgICAgICBFeGNlcHRpb25zIGV4Y2VwcyA9IG1ldGguZ2V0\nRXhjZXB0aW9ucyh0cnVlKTsKICAgICAgICBleGNlcHMuYWRkRXhjZXB0aW9u\nKElPRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRo\nLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8vIHN1cGVyLndyaXRlVW5tYW5h\nZ2VkIChvdXQpOwogICAgICAgIGlmIChwYXJlbnREZXRhY2hhYmxlKSB7CiAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9t\nZXRhLgogICAgICAgICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKSksIFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZvaWQuY2xhc3MsIAogICAg\nICAgICAgICAgICAgb3V0YXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyB3\ncml0ZSBkZWNsYXJlZCB1bm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxkcwog\nICAgICAgIEJDRmllbGQgZmllbGQ7CiAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSB1bm1nZC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAg\nICAgICAgICBmaWVsZCA9IChCQ0ZpZWxkKSBpdHIubmV4dCgpOwogICAgICAg\nICAgICB3cml0ZUV4dGVybmFsKGNvZGUsIGZpZWxkLmdldE5hbWUoKSwgZmll\nbGQuZ2V0VHlwZSgpLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHdyaXRlIGEgZmllbGQgdG8g\nYW4gZXh0ZXJuYWxpemF0aW9uIG91dHB1dCBzdHJlYW0uCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCB3cml0ZUV4dGVybmFsKENvZGUgY29kZSwgU3RyaW5n\nIGZpZWxkTmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICBTdHJpbmcgbWV0aE5hbWU7CiAgICAgICAgaWYgKHR5cGUuaXNQ\ncmltaXRpdmUoKSkgewogICAgICAgICAgICBtZXRoTmFtZSA9IHR5cGUuZ2V0\nTmFtZSgpOwogICAgICAgICAgICBtZXRoTmFtZSA9IG1ldGhOYW1lLnN1YnN0\ncmluZygwLCAxKS50b1VwcGVyQ2FzZShMb2NhbGUuRU5HTElTSCkKICAgICAg\nICAgICAgICAgICsgbWV0aE5hbWUuc3Vic3RyaW5nKDEpOwogICAgICAgICAg\nICBtZXRoTmFtZSA9ICJ3cml0ZSIgKyBtZXRoTmFtZTsKICAgICAgICB9IGVs\nc2UKICAgICAgICAgICAgbWV0aE5hbWUgPSAid3JpdGVPYmplY3QiOwoKICAg\nICAgICAvLyBvdXQud3JpdGU8dHlwZT4gKDxmaWVsZD4pOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBpZiAoZm1kID09IG51bGwp\nCiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGwsIGZpZWxkTmFtZSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVD\nb2RlKGNvZGUsIGZtZCk7CiAgICAgICAgQ2xhc3NbXSBhcmdzID0gbmV3IENs\nYXNzW117IHR5cGUgfTsKICAgICAgICBpZiAodHlwZSA9PSBieXRlLmNsYXNz\nIHx8IHR5cGUgPT0gY2hhci5jbGFzcyB8fCB0eXBlID09IHNob3J0LmNsYXNz\nKQogICAgICAgICAgICBhcmdzWzBdID0gaW50LmNsYXNzOwogICAgICAgIGVs\nc2UgaWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkpCiAgICAgICAgICAgIGFyZ3Nb\nMF0gPSBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZh\nY2UoKS5zZXRNZXRob2QoT2JqZWN0T3V0cHV0LmNsYXNzLCBtZXRoTmFtZSwK\nICAgICAgICAgICAgdm9pZC5jbGFzcywgYXJncyk7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoQ29kZSBjb2RlLCBG\naWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9k\nRXhjZXB0aW9uIHsKICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNv\nZGUsIGZtZCwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRo\nZSBmaWVsZCB2YWx1ZSBzcGVjaWZpZWQgYnkgPGNvZGU+Zm1kPC9jb2RlPiBv\nbnRvIHRoZSBzdGFjay4KICAgICAqIEJlZm9yZSB0aGlzIG1ldGhvZCBpcyBj\nYWxsZWQsIHRoZSBvYmplY3QgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgbG9h\nZGVkCiAgICAgKiBmcm9tIHdpbGwgYmUgb24gdGhlIHRvcCBvZiB0aGUgc3Rh\nY2suCiAgICAgKgogICAgICogQHBhcmFtIGZyb21TYW1lQ2xhc3MgaWYgPGNv\nZGU+dHJ1ZTwvY29kZT4sIHRoZW4gPGNvZGU+Zm1kPC9jb2RlPiBpcwogICAg\nICogYmVpbmcgbG9hZGVkIGZyb20gYW4gaW5zdGFuY2Ugb2YgdGhlIHNhbWUg\nY2xhc3MgYXMgdGhlIGN1cnJlbnQgZXhlY3V0aW9uCiAgICAgKiBjb250ZXh0\nLiBJZiA8Y29kZT5mYWxzZTwvY29kZT4sIHRoZW4gdGhlIGluc3RhbmNlIG9u\nIHRoZSB0b3Agb2YgdGhlIHN0YWNrCiAgICAgKiBtaWdodCBiZSBhIHN1cGVy\nY2xhc3Mgb2YgdGhlIGN1cnJlbnQgZXhlY3V0aW9uIGNvbnRleHQncyAndGhp\ncycgaW5zdGFuY2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRHZXRN\nYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBmbWQs\nCiAgICAgICAgYm9vbGVhbiBmcm9tU2FtZUNsYXNzKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGlmIHJlZGVm\naW5pbmcsIHRoZW4gd2UgbXVzdCBhbHdheXMgcmVmbGVjdCAob3IgYWNjZXNz\nIHRoZSBmaWVsZAogICAgICAgIC8vIGRpcmVjdGx5IGlmIGFjY2Vzc2libGUp\nLCBzaW5jZSB0aGUgcmVkZWZpbmVkIG1ldGhvZHMgd2lsbCBhbHdheXMKICAg\nICAgICAvLyB0cmlnZ2VyIG1ldGhvZCBjYWxscyB0byBTdGF0ZU1hbmFnZXIs\nIGV2ZW4gZnJvbSBpbnRlcm5hbCBkaXJlY3QtCiAgICAgICAgLy8gYWNjZXNz\nIHVzYWdlLiBXZSBjb3VsZCB3b3JrIGFyb3VuZCB0aGlzIGJ5IG5vdCByZWRl\nZmluaW5nLCBhbmQKICAgICAgICAvLyBqdXN0IGRvIGEgc3ViY2xhc3MgYXBw\ncm9hY2ggaW5zdGVhZC4gQnV0IHRoaXMgaXMgbm90IGEgZ29vZCBvcHRpb24s\nCiAgICAgICAgLy8gc2luY2UgaXQgd291bGQgc2FjcmlmaWNlIGxhenkgbG9h\nZGluZyBhbmQgZWZmaWNpZW50IGRpcnR5IHRyYWNraW5nLgoKICAgICAgICBp\nZiAoZ2V0UmVkZWZpbmUoKQogICAgICAgICAgICB8fCBfbWV0YS5nZXRBY2Nl\nc3NUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAg\nICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZm1kLmdldE5hbWUoKSk7\nCiAgICAgICAgfSBlbHNlIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKSB7CiAg\nICAgICAgICAgIC8vIHByb3BlcnR5IGFjY2VzcywgYW5kIHdlJ3JlIG5vdCBy\nZWRlZmluaW5nLiBJZiB3ZSdyZSBvcGVyYXRpbmcKICAgICAgICAgICAgLy8g\nb24gYW4gaW5zdGFuY2UgdGhhdCBpcyBkZWZpbml0ZWx5IHRoZSBzYW1lIHR5\ncGUgYXMgJ3RoaXMnLCB0aGVuCiAgICAgICAgICAgIC8vIGNhbGwgc3VwZXJj\nbGFzcyBtZXRob2QgdG8gYnlwYXNzIHRyYWNraW5nLiBPdGhlcndpc2UsIHJl\nZmxlY3QKICAgICAgICAgICAgLy8gdG8gYm90aCBieXBhc3MgdHJhY2tpbmcg\nYW5kIGF2b2lkIGNsYXNzIHZlcmlmaWNhdGlvbiBlcnJvcnMuCiAgICAgICAg\nICAgIGlmIChmcm9tU2FtZUNsYXNzKSB7CiAgICAgICAgICAgICAgICBNZXRo\nb2QgbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nbWV0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBn\nZXRmaWVsZChjb2RlLCBudWxsLCBmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHJlZ3VsYXIg\nZW5oYW5jZW1lbnQgKyBwcm9wZXJ0eSBhY2Nlc3MKICAgICAgICAgICAgTWV0\naG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0QmFja2luZ01lbWJlcigpOwog\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJF\nICsgbWV0aC5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBtZXRoLmdldFJl\ndHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSB0aGUgdmFsdWUgYXQg\ndGhlIHRvcCBvZiB0aGUgc3RhY2sgaW50byB0aGUgZmllbGQgdmFsdWUgc3Bl\nY2lmaWVkCiAgICAgKiBieSA8Y29kZT5mbWQ8L2NvZGU+LiBCZWZvcmUgdGhp\ncyBtZXRob2QgaXMgY2FsbGVkLCB0aGUgZGF0YSB0byBsb2FkIHdpbGwKICAg\nICAqIGJlIG9uIHRoZSB0b3Agb2YgdGhlIHN0YWNrIGFuZCB0aGUgb2JqZWN0\nIHRoYXQgdGhlIGRhdGEgc2hvdWxkIGJlIGxvYWRlZAogICAgICogaW50byB3\naWxsIGJlIHNlY29uZCBpbiB0aGUgc3RhY2suCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKENvZGUgY29kZSwgRmll\nbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gaWYgcmVkZWZpbmluZywgdGhlbiB3ZSBt\ndXN0IGFsd2F5cyByZWZsZWN0IChvciBhY2Nlc3MgdGhlIGZpZWxkCiAgICAg\nICAgLy8gZGlyZWN0bHkgaWYgYWNjZXNzaWJsZSksIHNpbmNlIHRoZSByZWRl\nZmluZWQgbWV0aG9kcyB3aWxsIGFsd2F5cwogICAgICAgIC8vIHRyaWdnZXIg\nbWV0aG9kIGNhbGxzIHRvIFN0YXRlTWFuYWdlciwgZXZlbiBmcm9tIGludGVy\nbmFsIGRpcmVjdC0KICAgICAgICAvLyBhY2Nlc3MgdXNhZ2UuIFdlIGNvdWxk\nIHdvcmsgYXJvdW5kIHRoaXMgYnkgbm90IHJlZGVmaW5pbmcsIGFuZAogICAg\nICAgIC8vIGp1c3QgZG8gYSBzdWJjbGFzcyBhcHByb2FjaCBpbnN0ZWFkLiBC\ndXQgdGhpcyBpcyBub3QgYSBnb29kIG9wdGlvbiwKICAgICAgICAvLyBzaW5j\nZSBpdCB3b3VsZCBzYWNyaWZpY2UgbGF6eSBsb2FkaW5nIGFuZCBlZmZpY2ll\nbnQgZGlydHkgdHJhY2tpbmcuCgogICAgICAgIGlmIChnZXRSZWRlZmluZSgp\nCiAgICAgICAgICAgIHx8IF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFz\nc01ldGFEYXRhLkFDQ0VTU19GSUVMRCkgewogICAgICAgICAgICBwdXRmaWVs\nZChjb2RlLCBudWxsLCBmbWQuZ2V0TmFtZSgpLCBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkpOwogICAgICAgIH0gZWxzZSBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3Mo\nKSkgewogICAgICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3MsIGFuZCB3ZSdy\nZSBub3QgcmVkZWZpbmluZy4gaW52b2tlIHRoZQogICAgICAgICAgICAvLyBz\ndXBlcmNsYXNzIG1ldGhvZCB0byBieXBhc3MgdHJhY2tpbmcuCiAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZChfbWFuYWdlZFR5\ncGUuZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgZ2V0U2V0dGVyTmFtZShm\nbWQpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNzW10g\neyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgLy8gcmVndWxhciBlbmhhbmNlbWVudCArIHByb3BlcnR5\nIGFjY2VzcwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRN\nZXRob2QoUFJFICsgZ2V0U2V0dGVyTmFtZShmbWQpLAogICAgICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW10geyBmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBvZmZzZXQgdGhhdCB0aGUgZmlyc3QgbWVhbmluZ2Z1bCBhY2Nl\nc3NvciBwYXJhbWV0ZXIgaXMgYXQuCiAgICAgKi8KICAgIHByaXZhdGUgaW50\nIGdldEFjY2Vzc29yUGFyYW1ldGVyT2Zmc2V0KCkgewogICAgICAgIHJldHVy\nbiAoX21ldGEuZ2V0QWNjZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUND\nRVNTX0ZJRUxEKSA/IDEgOiAwOwogICAgfQoKICAgIC8qKgogICAgICogQWRk\nIHRoZSB7QGxpbmsgSW5zdHJ1Y3Rpb259cyB0byBsb2FkIHRoZSBpbnN0YW5j\nZSB0byBtb2RpZnkgb250byB0aGUKICAgICAqIHN0YWNrLCBhbmQgcmV0dXJu\nIGl0LiBJZiA8Y29kZT5mb3JTdGF0aWM8L2NvZGU+IGlzIHNldCwgdGhlbgog\nICAgICogPGNvZGU+Y29kZTwvY29kZT4gaXMgaW4gYW4gYWNjZXNzb3IgbWV0\naG9kIG9yIGFub3RoZXIgc3RhdGljIG1ldGhvZDsKICAgICAqIG90aGVyd2lz\nZSwgaXQgaXMgaW4gb25lIG9mIHRoZSBQQy1zcGVjaWZpZWQgbWV0aG9kcy4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaXJzdCBpbnN0cnVjdGlvbiBh\nZGRlZCB0byA8Y29kZT5jb2RlPC9jb2RlPi4KICAgICAqLwogICAgcHJpdmF0\nZSBJbnN0cnVjdGlvbiBsb2FkTWFuYWdlZEluc3RhbmNlKENvZGUgY29kZSwg\nYm9vbGVhbiBmb3JTdGF0aWMpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0QWNj\nZXNzVHlwZSgpID09IENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxEICYmIGZv\nclN0YXRpYykKICAgICAgICAgICAgcmV0dXJuIGNvZGUuYWxvYWQoKS5zZXRQ\nYXJhbSgwKTsKICAgICAgICByZXR1cm4gY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgZ2VuZXJhdGVk\nIGdldHRlciB7QGxpbmsgQkNNZXRob2R9IGZvciA8Y29kZT5mbWQ8L2NvZGU+\nLiBUaGUKICAgICAqIGNhbGxpbmcgZW52aXJvbm1lbnQgd2lsbCB0aGVuIHBv\ncHVsYXRlIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9jay4KICAgICAqLwogICAg\ncHJpdmF0ZSBCQ01ldGhvZCBjcmVhdGVHZXRNZXRob2QoRmllbGRNZXRhRGF0\nYSBmbWQpIHsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXI7CiAgICAgICAgaWYg\nKF9tZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBDbGFzc01ldGFEYXRhLkFDQ0VT\nU19GSUVMRCkgewogICAgICAgICAgICAvLyBzdGF0aWMgPGZpZWxkdHlwZT4g\ncGNHZXQ8ZmllbGQ+IChYWFggaW5zdCkKICAgICAgICAgICAgQkNGaWVsZCBm\naWVsZCA9IF9wYy5nZXREZWNsYXJlZEZpZWxkKGZtZC5nZXROYW1lKCkpOwog\nICAgICAgICAgICBnZXR0ZXIgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAi\nR2V0IiArIGZtZC5nZXROYW1lKCksIGZtZC4KICAgICAgICAgICAgICAgIGdl\ndERlY2xhcmVkVHlwZSgpLmdldE5hbWUoKSwgbmV3IFN0cmluZ1tdeyBfcGMu\nZ2V0TmFtZSgpIH0pOwogICAgICAgICAgICBnZXR0ZXIuc2V0QWNjZXNzRmxh\nZ3MoZmllbGQuZ2V0QWNjZXNzRmxhZ3MoKQogICAgICAgICAgICAgICAgJiB+\nQ29uc3RhbnRzLkFDQ0VTU19UUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VT\nU19WT0xBVElMRSk7CiAgICAgICAgICAgIGdldHRlci5zZXRTdGF0aWModHJ1\nZSk7CiAgICAgICAgICAgIGdldHRlci5zZXRGaW5hbCh0cnVlKTsKICAgICAg\nICAgICAgcmV0dXJuIGdldHRlcjsKICAgICAgICB9CgogICAgICAgIC8vIHBy\nb3BlcnR5IGFjY2VzczoKICAgICAgICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0\ndGVyIG1ldGhvZCB0byBhIG5ldyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0\nCiAgICAgICAgLy8gdGhlIG5hbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28g\ncmVzZXQgYWxsIGNhbGxzIHRvIHRoZSBtZXRob2QKICAgICAgICBNZXRob2Qg\nbWV0aCA9IChNZXRob2QpIGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAg\nICAgZ2V0dGVyID0gX3BjLmdldERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFt\nZSgpLAogICAgICAgICAgICBtZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwog\nICAgICAgIEJDTWV0aG9kIG5ld2dldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9k\nKFBSRSArIG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICBtZXRoLmdldFJl\ndHVyblR5cGUoKSwgbWV0aC5nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAg\nICBuZXdnZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZ2V0dGVyLmdldEFjY2Vzc0Zs\nYWdzKCkpOwogICAgICAgIG5ld2dldHRlci5tYWtlUHJvdGVjdGVkKCk7IAog\nICAgICAgIHRyYW5zZmVyQ29kZUF0dHJpYnV0ZXMoZ2V0dGVyLCBuZXdnZXR0\nZXIpOwogICAgICAgIHJldHVybiBnZXR0ZXI7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGUgdGhlIGdlbmVyYXRlZCBzZXR0ZXIge0BsaW5rIEJDTWV0\naG9kfSBmb3IgPGNvZGU+Zm1kPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5n\nIGVudmlyb25tZW50IHdpbGwgdGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdz\nIGNvZGUgYmxvY2suCiAgICAgKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3Jl\nYXRlU2V0TWV0aG9kKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNN\nZXRob2Qgc2V0dGVyOwogICAgICAgIGlmIChfbWV0YS5nZXRBY2Nlc3NUeXBl\nKCkgPT0gQ2xhc3NNZXRhRGF0YS5BQ0NFU1NfRklFTEQpIHsKICAgICAgICAg\nICAgLy8gc3RhdGljIHZvaWQgcGNTZXQ8ZmllbGQ+IChYWFggaW5zdCwgPGZp\nZWxkdHlwZT4gdmFsdWUpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBf\ncGMuZ2V0RGVjbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgc2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNldCIgKyBm\nbWQuZ2V0TmFtZSgpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3\nIENsYXNzW117IGdldFR5cGUoX21ldGEpLCBmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCkgfSk7CiAgICAgICAgICAgIHNldHRlci5zZXRBY2Nlc3NGbGFncyhmaWVs\nZC5nZXRBY2Nlc3NGbGFncygpCiAgICAgICAgICAgICAgICAmIH5Db25zdGFu\ndHMuQUNDRVNTX1RSQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNTX1ZPTEFU\nSUxFKTsKICAgICAgICAgICAgc2V0dGVyLnNldFN0YXRpYyh0cnVlKTsKICAg\nICAgICAgICAgc2V0dGVyLnNldEZpbmFsKHRydWUpOwogICAgICAgICAgICBy\nZXR1cm4gc2V0dGVyOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvcGVydHkg\nYWNjZXNzOgogICAgICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0ZXIgbWV0\naG9kIHRvIGEgbmV3IG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQKICAgICAg\nICAvLyB0aGUgbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyByZXNldCBh\nbGwgY2FsbHMgdG8gdGhlIG1ldGhvZAogICAgICAgIHNldHRlciA9IF9wYy5n\nZXREZWNsYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAgICAg\nICAgIG5ldyBDbGFzc1tdeyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAg\nICAgICAgQkNNZXRob2QgbmV3c2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2Qo\nUFJFICsgc2V0dGVyLmdldE5hbWUoKSwKICAgICAgICAgICAgc2V0dGVyLmdl\ndFJldHVybk5hbWUoKSwgc2V0dGVyLmdldFBhcmFtTmFtZXMoKSk7CiAgICAg\nICAgbmV3c2V0dGVyLnNldEFjY2Vzc0ZsYWdzKHNldHRlci5nZXRBY2Nlc3NG\nbGFncygpKTsKICAgICAgICBuZXdzZXR0ZXIubWFrZVByb3RlY3RlZCgpOwog\nICAgICAgIHRyYW5zZmVyQ29kZUF0dHJpYnV0ZXMoc2V0dGVyLCBuZXdzZXR0\nZXIpOwogICAgICAgIHJldHVybiBzZXR0ZXI7CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIGFkZEdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9uTWV0aG9k\nKCkgewogICAgICAgIC8vIHB1YmxpYyBpbnQgZ2V0RW5oYW5jZW1lbnRDb250\ncmFjdFZlcnNpb24oKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKFBSRSArIAogICAgICAgICAgICAgICAgIkdldEVuaGFu\nY2VtZW50Q29udHJhY3RWZXJzaW9uIiwgaW50LmNsYXNzLCBudWxsKTsKICAg\nICAgICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQo\nKS5zZXRWYWx1ZShFTkhBTkNFUl9WRVJTSU9OKTsKICAgICAgICBjb2RlLmly\nZXR1cm4oKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgY29uY3JldGUgdHlwZSBmb3IgdGhlIGdp\ndmVuIGNsYXNzLCBpLmUuIGltcGwgZm9yIG1hbmFnZWQKICAgICAqIGludGVy\nZmFjZXMKICAgICAqLwogICAgcHVibGljIENsYXNzIGdldFR5cGUoQ2xhc3NN\nZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SW50ZXJmYWNl\nSW1wbCgpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtZXRhLmdldElu\ndGVyZmFjZUltcGwoKTsKICAgICAgICByZXR1cm4gbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNb3ZlIGNvZGUtcmVs\nYXRlZCBhdHRyaWJ1dGVzIGZyb20gb25lIG1ldGhvZCB0byBhbm90aGVyLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHRyYW5zZmVyQ29kZUF0\ndHJpYnV0ZXMoQkNNZXRob2QgZnJvbSwgQkNNZXRob2QgdG8pIHsKICAgICAg\nICBDb2RlIGNvZGUgPSBmcm9tLmdldENvZGUoZmFsc2UpOwogICAgICAgIGlm\nIChjb2RlICE9IG51bGwpIHsKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRl\nKGNvZGUpOwogICAgICAgICAgICBmcm9tLnJlbW92ZUNvZGUoKTsKICAgICAg\nICB9CgogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gZnJvbS5nZXRFeGNl\ncHRpb25zKGZhbHNlKTsKICAgICAgICBpZiAoZXhjZXBzICE9IG51bGwpCiAg\nICAgICAgICAgIHRvLmFkZEF0dHJpYnV0ZShleGNlcHMpOwogICAgfQoKICAg\nIC8qKgogICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuUENFbmhhbmNlciBbb3B0aW9uXSoKICAgICAqICZsdDtjbGFzcyBu\nYW1lIHwgLmphdmEgZmlsZSB8IC5jbGFzcyBmaWxlIHwgLmpkbyBmaWxlJmd0\nOysKICAgICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJl\nY29nbml6ZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3BlcnRp\nZXMvLXAgJmx0O3Byb3BlcnRpZXMgZmlsZSZndDs8L2k+OiBUaGUgcGF0aCB0\nbyBhIE9wZW5KUEEKICAgICAqIHByb3BlcnRpZXMgZmlsZSBjb250YWluaW5n\nIGluZm9ybWF0aW9uIGFzIG91dGxpbmVkIGluCiAgICAgKiB7QGxpbmsgQ29u\nZmlndXJhdGlvbn07IG9wdGlvbmFsLjwvbGk+CiAgICAgKiA8bGk+PGk+LSZs\ndDtwcm9wZXJ0eSBuYW1lJmd0OyAmbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7PC9p\nPjogQWxsIGJlYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIHN0YW5kYXJk\nIE9wZW5KUEEge0BsaW5rIE9wZW5KUEFDb25maWd1cmF0aW9ufSBjYW4gYmUK\nICAgICAqIHNldCBieSB1c2luZyB0aGVpciBuYW1lcyBhbmQgc3VwcGx5aW5n\nIGEgdmFsdWU7IGZvciBleGFtcGxlOgogICAgICogPGxpPjxpPi1kaXJlY3Rv\ncnkvLWQgJmx0O2J1aWxkIGRpcmVjdG9yeSZndDs8L2k+OiBUaGUgcGF0aCB0\nbyB0aGUgYmFzZQogICAgICogZGlyZWN0b3J5IHdoZXJlIGVuaGFuY2VkIGNs\nYXNzZXMgYXJlIHN0b3JlZC4gQnkgZGVmYXVsdCwgdGhlCiAgICAgKiBlbmhh\nbmNlciBvdmVyd3JpdGVzIHRoZSBvcmlnaW5hbCAuY2xhc3MgZmlsZSB3aXRo\nIHRoZSBlbmhhbmNlZAogICAgICogdmVyc2lvbi4gVXNlIHRoaXMgb3B0aW9u\nIHRvIHN0b3JlIHRoZSBnZW5lcmF0ZWQgLmNsYXNzIGZpbGUgaW4KICAgICAq\nIGFub3RoZXIgZGlyZWN0b3J5LiBUaGUgcGFja2FnZSBzdHJ1Y3R1cmUgd2ls\nbCBiZSBjcmVhdGVkIGJlbmVhdGgKICAgICAqIHRoZSBnaXZlbiBkaXJlY3Rv\ncnkuPC9saT4KICAgICAqIDxsaT48aT4tYWRkRGVmYXVsdENvbnN0cnVjdG9y\nLy1hZGMgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAg\nICogYWRkIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciB0byBwZXJzaXN0ZW50IGNs\nYXNzZXMgbWlzc2luZyBvbmUsIGFzCiAgICAgKiBvcHBvc2VkIHRvIHRocm93\naW5nIGFuIGV4Y2VwdGlvbi4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgogICAg\nICogPGxpPjxpPi10bXBDbGFzc0xvYWRlci8tdGNsIFt0cnVlL3QgfCBmYWxz\nZS9mXTwvaT46IFdoZXRoZXIgdG8KICAgICAqIGxvYWQgdGhlIHByZS1lbmhh\nbmNlZCBjbGFzc2VzIHVzaW5nIGEgdGVtcG9yYXJ5IGNsYXNzIGxvYWRlci4K\nICAgICAqIERlZmF1bHRzIHRvIHRydWUuIFNldCB0aGlzIHRvIGZhbHNlIHdo\nZW4gYXR0ZW1wdGluZyB0byBkZWJ1ZwogICAgICogY2xhc3MgbG9hZGluZyBl\ncnJvcnMuPC9saT4KICAgICAqIDxsaT48aT4tZW5mb3JjZVByb3BlcnR5UmVz\ndHJpY3Rpb25zLy1lcHIgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjoKICAgICAq\nIFdoZXRoZXIgdG8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgUFJPUEVSVFkg\nYWNjZXNzIGVudGl0eSBhcHBlYXJzCiAgICAgKiB0byBiZSB2aW9sYXRpbmcg\nc3RhbmRhcmQgcHJvcGVydHkgcmVzdHJpY3Rpb25zLiBEZWZhdWx0cyB0byBm\nYWxzZS48L2xpPgogICAgICogPC91bD4KICAgICAqICBFYWNoIGFkZGl0aW9u\nYWwgYXJndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgZnVsbCBjbGFzcyBuYW1l\nIG9mIHRoZQogICAgICogdHlwZSB0byBlbmhhbmNlLCB0aGUgcGF0aCB0byB0\naGUgLmphdmEgZmlsZSBmb3IgdGhlIHR5cGUsIHRoZSBwYXRoIHRvCiAgICAg\nKiB0aGUgLmNsYXNzIGZpbGUgZm9yIHRoZSB0eXBlLCBvciB0aGUgcGF0aCB0\nbyBhIC5qZG8gZmlsZSBsaXN0aW5nIG9uZQogICAgICogb3IgbW9yZSB0eXBl\ncyB0byBlbmhhbmNlLgogICAgICogSWYgdGhlIHR5cGUgYmVpbmcgZW5oYW5j\nZWQgaGFzIG1ldGFkYXRhLCBpdCB3aWxsIGJlIGVuaGFuY2VkIGFzIGEKICAg\nICAqIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3MuIElmIG5vdCwgaXQgd2ls\nbCBiZSBjb25zaWRlcmVkIGEgcGVyc2lzdGVuY2UKICAgICAqIGF3YXJlIGNs\nYXNzLCBhbmQgYWxsIGFjY2VzcyB0byBmaWVsZHMgb2YgcGVyc2lzdGVuY2Ug\nY2FwYWJsZSBjbGFzc2VzCiAgICAgKiB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRo\nZSBhcHByb3ByaWF0ZQlnZXQvc2V0IG1ldGhvZC4gSWYgdGhlIHR5cGUKICAg\nICAqIGV4cGxpY2l0bHkgZGVjbGFyZXMgdGhlIHBlcnNpc3RlbmNlLWNhcGFi\nbGUgaW50ZXJmYWNlLCBpdCB3aWxsCiAgICAgKiBub3QgYmUgZW5oYW5jZWQu\nIFRodXMsIGl0IGlzIHNhZmUgdG8gaW52b2tlIHRoZSBlbmhhbmNlciBvbiBj\nbGFzc2VzCiAgICAgKiB0aGF0IGFyZSBhbHJlYWR5IGVuaGFuY2VkLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdz\nKSB7CiAgICAgICAgT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAg\nICAgICBhcmdzID0gb3B0cy5zZXRGcm9tQ21kTGluZShhcmdzKTsKICAgICAg\nICBpZiAoIXJ1bihhcmdzLCBvcHRzKSkKICAgICAgICAgICAgU3lzdGVtLmVy\nci5wcmludGxuKF9sb2MuZ2V0KCJlbmhhbmNlLXVzYWdlIikpOwogICAgfQoK\nICAgIC8qKgogICAgICogUnVuIHRoZSB0b29sLiBSZXR1cm5zIGZhbHNlIGlm\nIGludmFsaWQgb3B0aW9ucyBnaXZlbi4gUnVucyBhZ2FpbnN0IGFsbAogICAg\nICogdGhlIHBlcnNpc3RlbmNlIHVuaXRzIGRlZmluZWQgaW4gdGhlIHJlc291\ncmNlIHRvIHBhcnNlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xl\nYW4gcnVuKGZpbmFsIFN0cmluZ1tdIGFyZ3MsIE9wdGlvbnMgb3B0cykgewog\nICAgICAgIHJldHVybiBDb25maWd1cmF0aW9ucy5ydW5BZ2FpbnN0QWxsQW5j\naG9ycyhvcHRzLAogICAgICAgICAgICBuZXcgQ29uZmlndXJhdGlvbnMuUnVu\nbmFibGUoKSB7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bihPcHRp\nb25zIG9wdHMpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IE9wZW5KUEFDb25m\naWd1cmF0aW9uSW1wbCgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gUENFbmhhbmNlci5ydW4oY29uZiwgYXJn\ncywgb3B0cyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAg\nICogUnVuIHRoZSB0b29sLiBSZXR1cm5zIGZhbHNlIGlmIGludmFsaWQgb3B0\naW9ucyBnaXZlbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFu\nIHJ1bihPcGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdz\nLAogICAgICAgIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIEZsYWdzIGZsYWdzID0gbmV3IEZsYWdzKCk7CiAg\nICAgICAgZmxhZ3MuZGlyZWN0b3J5ID0gRmlsZXMuZ2V0RmlsZShvcHRzLnJl\nbW92ZVByb3BlcnR5KCJkaXJlY3RvcnkiLCAiZCIsCiAgICAgICAgICAgIG51\nbGwpLCBudWxsKTsKICAgICAgICBmbGFncy5hZGREZWZhdWx0Q29uc3RydWN0\nb3IgPSBvcHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAo\nImFkZERlZmF1bHRDb25zdHJ1Y3RvciIsICJhZGMiLCBmbGFncy5hZGREZWZh\ndWx0Q29uc3RydWN0b3IpOwogICAgICAgIGZsYWdzLnRtcENsYXNzTG9hZGVy\nID0gb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJ0\nbXBDbGFzc0xvYWRlciIsICJ0Y2wiLCBmbGFncy50bXBDbGFzc0xvYWRlcik7\nCiAgICAgICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zID0g\nb3B0cy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJlbmZv\ncmNlUHJvcGVydHlSZXN0cmljdGlvbnMiLCAiZXByIiwKICAgICAgICAgICAg\nICAgIGZsYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyk7CgogICAg\nICAgIC8vIGZvciB1bml0IHRlc3RpbmcKICAgICAgICBCeXRlY29kZVdyaXRl\nciB3cml0ZXIgPSAoQnl0ZWNvZGVXcml0ZXIpIG9wdHMuZ2V0KAogICAgICAg\nICAgICBQQ0VuaGFuY2VyLmNsYXNzLmdldE5hbWUoKSArICIjYnl0ZWNvZGVX\ncml0ZXIiKTsKCiAgICAgICAgQ29uZmlndXJhdGlvbnMucG9wdWxhdGVDb25m\naWd1cmF0aW9uKGNvbmYsIG9wdHMpOwogICAgICAgIHJldHVybiBydW4oY29u\nZiwgYXJncywgZmxhZ3MsIG51bGwsIHdyaXRlciwgbnVsbCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBFbmhhbmNlIHRoZSBnaXZlbiBjbGFzc2VzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25m\naWd1cmF0aW9uIGNvbmYsIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgRmxhZ3Mg\nZmxhZ3MsIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcywgQnl0ZWNvZGVXcml0\nZXIgd3JpdGVyLAogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlcikKICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChsb2FkZXIgPT0g\nbnVsbCkKICAgICAgICAgICAgbG9hZGVyID0gY29uZi5nZXRDbGFzc1Jlc29s\ndmVySW5zdGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldENsYXNzTG9hZGVy\nKFBDRW5oYW5jZXIuY2xhc3MsIG51bGwpOwogICAgICAgIGlmIChmbGFncy50\nbXBDbGFzc0xvYWRlcikKICAgICAgICAgICAgbG9hZGVyID0gKENsYXNzTG9h\nZGVyKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdkhl\nbHBlcgogICAgICAgICAgICAgICAgLm5ld1RlbXBvcmFyeUNsYXNzTG9hZGVy\nQWN0aW9uKGxvYWRlcikpOwoKICAgICAgICBpZiAocmVwb3MgPT0gbnVsbCkg\newogICAgICAgICAgICByZXBvcyA9IGNvbmYubmV3TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmVwb3Muc2V0U291cmNlTW9k\nZShNZXRhRGF0YVJlcG9zaXRvcnkuTU9ERV9NRVRBKTsKICAgICAgICB9Cgog\nICAgICAgIExvZyBsb2cgPSBjb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJh\ndGlvbi5MT0dfVE9PTCk7CiAgICAgICAgQ29sbGVjdGlvbiBjbGFzc2VzOwog\nICAgICAgIGlmIChhcmdzID09IG51bGwgfHwgYXJncy5sZW5ndGggPT0gMCkg\newogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgicnVubmluZy1hbGwt\nY2xhc3NlcyIpKTsKICAgICAgICAgICAgY2xhc3NlcyA9IHJlcG9zLmdldFBl\ncnNpc3RlbnRUeXBlTmFtZXModHJ1ZSwgbG9hZGVyKTsKICAgICAgICAgICAg\naWYgKGNsYXNzZXMgPT0gbnVsbCkgewogICAgICAgICAgICAJbG9nLndhcm4o\nX2xvYy5nZXQoIm5vLWNsYXNzLXRvLWVuaGFuY2UiKSk7CiAgICAgICAgICAg\nIAlyZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBDbGFzc0FyZ1BhcnNlciBjYXAgPSBjb25mLmdldE1l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICBn\nZXRNZXRhRGF0YUZhY3RvcnkoKS5uZXdDbGFzc0FyZ1BhcnNlcigpOwogICAg\nICAgICAgICBjYXAuc2V0Q2xhc3NMb2FkZXIobG9hZGVyKTsKICAgICAgICAg\nICAgY2xhc3NlcyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\nICAgIGNsYXNzZXMuYWRkQWxsKEFycmF5cy5hc0xpc3QoY2FwLnBhcnNlVHlw\nZXMoYXJnc1tpXSkpKTsKICAgICAgICB9CgogICAgICAgIFByb2plY3QgcHJv\namVjdCA9IG5ldyBQcm9qZWN0KCk7CiAgICAgICAgQkNDbGFzcyBiYzsKICAg\nICAgICBQQ0VuaGFuY2VyIGVuaGFuY2VyOwogICAgICAgIGludCBzdGF0dXM7\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjbGFzc2VzLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE9iamVjdCBvID0g\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICAgICAgbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmhh\nbmNlLXJ1bm5pbmciLCBvKSk7CgogICAgICAgICAgICBpZiAobyBpbnN0YW5j\nZW9mIFN0cmluZykKICAgICAgICAgICAgICAgIGJjID0gcHJvamVjdC5sb2Fk\nQ2xhc3MoKFN0cmluZykgbywgbG9hZGVyKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgYmMgPSBwcm9qZWN0LmxvYWRDbGFzcygoQ2xhc3Mp\nIG8pOwogICAgICAgICAgICBlbmhhbmNlciA9IG5ldyBQQ0VuaGFuY2VyKGNv\nbmYsIGJjLCByZXBvcywgbG9hZGVyKTsKICAgICAgICAgICAgaWYgKHdyaXRl\nciAhPSBudWxsKQogICAgICAgICAgICAgICAgZW5oYW5jZXIuc2V0Qnl0ZWNv\nZGVXcml0ZXIod3JpdGVyKTsKICAgICAgICAgICAgZW5oYW5jZXIuc2V0RGly\nZWN0b3J5KGZsYWdzLmRpcmVjdG9yeSk7CiAgICAgICAgICAgIGVuaGFuY2Vy\nLnNldEFkZERlZmF1bHRDb25zdHJ1Y3RvcihmbGFncy5hZGREZWZhdWx0Q29u\nc3RydWN0b3IpOwogICAgICAgICAgICBzdGF0dXMgPSBlbmhhbmNlci5ydW4o\nKTsKICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX05PTkUpIHsK\nICAgICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoImVuaGFuY2Ut\nbm9ydW4iKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09IEVO\nSEFOQ0VfSU5URVJGQUNFKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJlbmhhbmNlLWludGVyZmFjZSIpKTsKICAgICAgICAgICAg\nfSBlbHNlIGlmIChzdGF0dXMgPT0gRU5IQU5DRV9BV0FSRSkgewogICAgICAg\nICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1hd2FyZSIp\nKTsKICAgICAgICAgICAgICAgIGVuaGFuY2VyLnJlY29yZCgpOwogICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGVuaGFuY2VyLnJlY29yZCgp\nOwogICAgICAgICAgICBwcm9qZWN0LmNsZWFyKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUnVuIGZs\nYWdzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEZsYWdzIHsK\nCiAgICAgICAgcHVibGljIEZpbGUgZGlyZWN0b3J5ID0gbnVsbDsKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBhZGREZWZhdWx0Q29uc3RydWN0b3IgPSB0cnVl\nOwogICAgICAgIHB1YmxpYyBib29sZWFuIHRtcENsYXNzTG9hZGVyID0gdHJ1\nZTsKCQlwdWJsaWMgYm9vbGVhbiBlbmZvcmNlUHJvcGVydHlSZXN0cmljdGlv\nbnMgPSBmYWxzZTsKCX0KCgkvKioKIAkgKiBQbHVnaW4gaW50ZXJmYWNlIGZv\nciBhZGRpdGlvbmFsIGVuaGFuY2VtZW50LgoJICovCglwdWJsaWMgc3RhdGlj\nIGludGVyZmFjZSBBdXhpbGlhcnlFbmhhbmNlcgoJewoJCXB1YmxpYyB2b2lk\nIHJ1biAoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRhKTsKCQlwdWJs\naWMgYm9vbGVhbiBza2lwRW5oYW5jZShCQ01ldGhvZCBtKTsKCX0KfQo=\n","encoding":"base64"}

