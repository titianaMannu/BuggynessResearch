{"sha":"b23f5b90bb923c46a1af6e0559ff852a0f120f46","node_id":"MDQ6QmxvYjIwNjM2NDpiMjNmNWI5MGJiOTIzYzQ2YTFhZjZlMDU1OWZmODUyYTBmMTIwZjQ2","size":72164,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b23f5b90bb923c46a1af6e0559ff852a0f120f46","content":"LyoNCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUNCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQ0KICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24NCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUNCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUNCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UNCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vd3d3\nLmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxl\nc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGlu\nIHdyaXRpbmcsDQogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUg\nTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KICogIkFTIElTIiBCQVNJ\nUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZDQog\nKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBM\naWNlbnNlIGZvciB0aGUNCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmlu\nZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMNCiAqIHVuZGVyIHRoZSBM\naWNlbnNlLiAgICANCiAqLw0KcGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsOw0KDQppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7DQppbXBv\ncnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250cm9sbGVyOw0KaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7DQppbXBvcnQgamF2YS51dGlsLkFycmF5czsN\nCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsNCmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7DQppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7DQpp\nbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOw0KaW1wb3J0IGphdmEudXRpbC5M\naXN0Ow0KaW1wb3J0IGphdmEudXRpbC5MaXN0SXRlcmF0b3I7DQppbXBvcnQg\namF2YS51dGlsLk1hcDsNCg0KaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb2xsZWN0aW9ucy5tYXAuTGlua2VkTWFwOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5sYW5nLk9iamVjdFV0aWxzOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOw0KaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOw0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsN\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuQWdncmVn\nYXRlTGlzdGVuZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5leHBzLkZpbHRlckxpc3RlbmVyOw0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5Db25zdGFudDsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuTGl0ZXJhbDsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUGF0aDsNCmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFsOw0KaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubG9nLkxvZzsNCmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnJvcC5FYWdlclJlc3VsdExpc3Q7DQppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5yb3AuTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlk\nZXI7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmFuZ2VS\nZXN1bHRPYmplY3RQcm92aWRlcjsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLnJvcC5SZXN1bHRMaXN0Ow0KaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3ZpZGVyOw0KaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsNCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOw0K\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VI\nYXNoU2V0Ow0KaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmxvY2tzLlJl\nZW50cmFudExvY2s7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nQ2xhc3NNZXRhRGF0YTsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GaWVsZE1ldGFEYXRhOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5t\nZXRhLkphdmFUeXBlczsNCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5NZXRhRGF0YVJlcG9zaXRvcnk7DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247DQppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTm9uVW5pcXVlUmVzdWx0RXhjZXB0\naW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vUmVzdWx0\nRXhjZXB0aW9uOw0KaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247DQppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsNCmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOw0KaW1wb3J0IHNlcnAudXRpbC5O\ndW1iZXJzOw0KaW1wb3J0IHNlcnAudXRpbC5TdHJpbmdzOw0KDQovKioNCiAq\nIEltcGxlbWVudGF0aW9uIG9mIHRoZSB7QGxpbmsgUXVlcnl9IGludGVyZmFj\nZS4NCiAqDQogKiBAYXV0aG9yIEFiZSBXaGl0ZQ0KICogQG5vamF2YWRvYw0K\nICovDQpwdWJsaWMgY2xhc3MgUXVlcnlJbXBsDQogICAgaW1wbGVtZW50cyBR\ndWVyeSB7DQoNCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlKFF1ZXJ5SW1wbC5jbGFzcyk7\nDQoNCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBfbGFuZ3VhZ2U7DQogICAg\ncHJpdmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5IF9zdG9yZVF1ZXJ5Ow0KICAgIHBy\naXZhdGUgdHJhbnNpZW50IGZpbmFsIEJyb2tlckltcGwgX2Jyb2tlcjsNCiAg\nICBwcml2YXRlIHRyYW5zaWVudCBmaW5hbCBMb2cgX2xvZzsNCiAgICBwcml2\nYXRlIHRyYW5zaWVudCBDbGFzc0xvYWRlciBfbG9hZGVyID0gbnVsbDsNCg0K\nICAgIC8vIHF1ZXJ5IGhhcyBpdHMgb3duIGludGVybmFsIGxvY2sNCiAgICBw\ncml2YXRlIGZpbmFsIFJlZW50cmFudExvY2sgX2xvY2s7DQoNCiAgICAvLyB1\nbnBhcnNlZCBzdGF0ZQ0KICAgIHByaXZhdGUgQ2xhc3MgX2NsYXNzID0gbnVs\nbDsNCiAgICBwcml2YXRlIGJvb2xlYW4gX3N1YmNsYXNzZXMgPSB0cnVlOw0K\nICAgIHByaXZhdGUgYm9vbGVhbiBfcmVhZE9ubHkgPSBmYWxzZTsNCiAgICBw\ncml2YXRlIFN0cmluZyBfcXVlcnkgPSBudWxsOw0KICAgIHByaXZhdGUgU3Ry\naW5nIF9wYXJhbXMgPSBudWxsOw0KDQogICAgLy8gcGFyc2VkIHN0YXRlDQog\nICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29tcGlsYXRpb24gX2NvbXBpbGVkID0g\nbnVsbDsNCiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9jb21waWxp\nbmcgPSBmYWxzZTsNCiAgICBwcml2YXRlIHRyYW5zaWVudCBSZXN1bHRQYWNr\nZXIgX3BhY2tlciA9IG51bGw7DQoNCiAgICAvLyBjYW5kaWRhdGVzDQogICAg\ncHJpdmF0ZSB0cmFuc2llbnQgQ29sbGVjdGlvbiBfY29sbGVjdGlvbiA9IG51\nbGw7DQogICAgcHJpdmF0ZSB0cmFuc2llbnQgRXh0ZW50IF9leHRlbnQgPSBu\ndWxsOw0KDQogICAgLy8gbGlzdGVuZXJzDQogICAgcHJpdmF0ZSBNYXAgX2Zp\nbHRMaXN0ZW5lcnMgPSBudWxsOw0KICAgIHByaXZhdGUgTWFwIF9hZ2dMaXN0\nZW5lcnMgPSBudWxsOw0KDQogICAgLy8gY29uZmlndXJhdGlvbiBmb3IgbG9h\nZGluZyBvYmplY3RzDQogICAgcHJpdmF0ZSBGZXRjaENvbmZpZ3VyYXRpb24g\nX2ZjID0gbnVsbDsNCiAgICBwcml2YXRlIGJvb2xlYW4gX2lnbm9yZUNoYW5n\nZXMgPSBmYWxzZTsNCiAgICBwcml2YXRlIENsYXNzIF9yZXN1bHRNYXBwaW5n\nU2NvcGUgPSBudWxsOw0KICAgIHByaXZhdGUgU3RyaW5nIF9yZXN1bHRNYXBw\naW5nTmFtZSA9IG51bGw7DQoNCiAgICAvLyB0aGVzZSBmaWVsZHMgc2hvdWxk\nIG9ubHkgYmUgdXNlZCBkaXJlY3RseSBhZnRlciB3ZSBoYXZlIGEgY29tcGls\nYXRpb24sDQogICAgLy8gYmVjYXVzZSB0aGVpciB2YWx1ZXMgbWF5IGJlIGVu\nY29kZWQgaW4gdGhlIHF1ZXJ5IHN0cmluZw0KICAgIHByaXZhdGUgQm9vbGVh\nbiBfdW5pcXVlID0gbnVsbDsNCiAgICBwcml2YXRlIENsYXNzIF9yZXN1bHRD\nbGFzcyA9IG51bGw7DQogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBfc3Rh\ncnRJZHggPSAwOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IGxvbmcgX2VuZElk\neCA9IExvbmcuTUFYX1ZBTFVFOw0KICAgIHByaXZhdGUgdHJhbnNpZW50IGJv\nb2xlYW4gX3JhbmdlU2V0ID0gZmFsc2U7DQoNCiAgICAvLyByZW1lbWJlciB0\naGUgbGlzdCBvZiBhbGwgdGhlIHJlc3VsdHMgd2UgaGF2ZSByZXR1cm5lZCBz\nbyB3ZQ0KICAgIC8vIGNhbiBmcmVlIHRoZWlyIHJlc291cmNlcyB3aGVuIGNs\nb3NlIG9yIGNsb3NlQWxsIGlzIGNhbGxlZA0KICAgIHByaXZhdGUgdHJhbnNp\nZW50IGZpbmFsIENvbGxlY3Rpb24gX3Jlc3VsdExpc3RzID0gbmV3IFJlZmVy\nZW5jZUhhc2hTZXQNCiAgICAgICAgKFJlZmVyZW5jZUhhc2hTZXQuV0VBSyk7\nDQoNCiAgICAvKioNCiAgICAgKiBDb25zdHJ1Y3QgYSBxdWVyeSBtYW5hZ2Vk\nIGJ5IHRoZSBnaXZlbiBicm9rZXIuDQogICAgICovDQogICAgcHVibGljIFF1\nZXJ5SW1wbChCcm9rZXIgYnJva2VyLCBTdHJpbmcgbGFuZ3VhZ2UsIFN0b3Jl\nUXVlcnkgc3RvcmVRdWVyeSkgew0KICAgICAgICBfYnJva2VyID0gKEJyb2tl\nckltcGwpIGJyb2tlcjsNCiAgICAgICAgX2xhbmd1YWdlID0gbGFuZ3VhZ2U7\nDQogICAgICAgIF9zdG9yZVF1ZXJ5ID0gc3RvcmVRdWVyeTsNCiAgICAgICAg\nX2ZjID0gKEZldGNoQ29uZmlndXJhdGlvbikgYnJva2VyLmdldEZldGNoQ29u\nZmlndXJhdGlvbigpLmNsb25lKCk7DQogICAgICAgIF9sb2cgPSBicm9rZXIu\nZ2V0Q29uZmlndXJhdGlvbigpLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlv\nbi5MT0dfUVVFUlkpOw0KICAgICAgICBfc3RvcmVRdWVyeS5zZXRDb250ZXh0\nKHRoaXMpOw0KDQogICAgICAgIGlmIChfYnJva2VyICE9IG51bGwgJiYgX2Jy\nb2tlci5nZXRNdWx0aXRocmVhZGVkKCkpDQogICAgICAgICAgICBfbG9jayA9\nIG5ldyBSZWVudHJhbnRMb2NrKCk7DQogICAgICAgIGVsc2UNCiAgICAgICAg\nICAgIF9sb2NrID0gbnVsbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJ\nbnRlcm5hbCBzdG9yZSBxdWVyeS4NCiAgICAgKi8NCiAgICBwdWJsaWMgU3Rv\ncmVRdWVyeSBnZXRTdG9yZVF1ZXJ5KCkgew0KICAgICAgICByZXR1cm4gX3N0\nb3JlUXVlcnk7DQogICAgfQ0KDQogICAgcHVibGljIEJyb2tlciBnZXRCcm9r\nZXIoKSB7DQogICAgICAgIHJldHVybiBfYnJva2VyOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyBRdWVyeSBnZXRRdWVyeSgpIHsNCiAgICAgICAgcmV0dXJuIHRo\naXM7DQogICAgfQ0KDQogICAgcHVibGljIFN0b3JlQ29udGV4dCBnZXRTdG9y\nZUNvbnRleHQoKSB7DQogICAgICAgIHJldHVybiBfYnJva2VyOw0KICAgIH0N\nCg0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0TGFuZ3VhZ2UoKSB7DQogICAgICAg\nIHJldHVybiBfbGFuZ3VhZ2U7DQogICAgfQ0KDQogICAgcHVibGljIEZldGNo\nQ29uZmlndXJhdGlvbiBnZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7DQogICAg\nICAgIHJldHVybiBfZmM7DQogICAgfQ0KDQogICAgcHVibGljIFN0cmluZyBn\nZXRRdWVyeVN0cmluZygpIHsNCiAgICAgICAgcmV0dXJuIF9xdWVyeTsNCiAg\nICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRJZ25vcmVDaGFuZ2VzKCkg\new0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIHJldHVybiBfaWdu\nb3JlQ2hhbmdlczsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRJZ25v\ncmVDaGFuZ2VzKGJvb2xlYW4gZmxhZykgew0KICAgICAgICBsb2NrKCk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAg\nICAgICAgICAvLyBhbGxvd2VkIG1vZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5\nIGNoZWNrDQogICAgICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IGZsYWc7DQog\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAg\nICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBib29sZWFuIGlzUmVhZE9u\nbHkoKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgcmV0dXJu\nIF9yZWFkT25seTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBzZXRSZWFk\nT25seShib29sZWFuIGZsYWcpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAg\nICAgX3JlYWRPbmx5ID0gZmxhZzsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\ncHVibGljIHZvaWQgYWRkRmlsdGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIg\nbGlzdGVuZXIpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0K\nICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgYXNzZXJ0\nTm90UmVhZE9ubHkoKTsNCiAgICAgICAgICAgIGlmIChfZmlsdExpc3RlbmVy\ncyA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIF9maWx0TGlzdGVuZXJzID0g\nbmV3IEhhc2hNYXAoNSk7DQogICAgICAgICAgICBfZmlsdExpc3RlbmVycy5w\ndXQobGlzdGVuZXIuZ2V0VGFnKCksIGxpc3RlbmVyKTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgcHVibGljIHZvaWQgcmVtb3ZlRmlsdGVyTGlzdGVuZXIo\nRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIpIHsNCiAgICAgICAgbG9jaygpOw0K\nICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAg\nICAgICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsNCiAgICAgICAgICAgIGlm\nIChfZmlsdExpc3RlbmVycyAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIF9m\naWx0TGlzdGVuZXJzLnJlbW92ZShsaXN0ZW5lci5nZXRUYWcoKSk7DQogICAg\nICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAg\nICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldEZpbHRl\nckxpc3RlbmVycygpIHsNCiAgICAgICAgcmV0dXJuIChfZmlsdExpc3RlbmVy\ncyA9PSBudWxsKSA/IENvbGxlY3Rpb25zLkVNUFRZX0xJU1QNCiAgICAgICAg\nICAgIDogX2ZpbHRMaXN0ZW5lcnMudmFsdWVzKCk7DQogICAgfQ0KDQogICAg\ncHVibGljIEZpbHRlckxpc3RlbmVyIGdldEZpbHRlckxpc3RlbmVyKFN0cmlu\nZyB0YWcpIHsNCiAgICAgICAgLy8gZmlyc3QgY2hlY2sgbGlzdGVuZXJzIGZv\nciB0aGlzIHF1ZXJ5DQogICAgICAgIGlmIChfZmlsdExpc3RlbmVycyAhPSBu\ndWxsKSB7DQogICAgICAgICAgICBGaWx0ZXJMaXN0ZW5lciBsaXN0ZW4gPSAo\nRmlsdGVyTGlzdGVuZXIpIF9maWx0TGlzdGVuZXJzLmdldCh0YWcpOw0KICAg\nICAgICAgICAgaWYgKGxpc3RlbiAhPSBudWxsKQ0KICAgICAgICAgICAgICAg\nIHJldHVybiBsaXN0ZW47DQogICAgICAgIH0NCg0KICAgICAgICAvLyBjaGVj\nayB1c2VyLWRlZmluZWQgbGlzdGVuZXJzIGZyb20gY29uZmlndXJhdGlvbg0K\nICAgICAgICBGaWx0ZXJMaXN0ZW5lcltdIGNvbmZMaXN0ZW5lcnMgPSBfYnJv\na2VyLmdldENvbmZpZ3VyYXRpb24oKS4NCiAgICAgICAgICAgIGdldEZpbHRl\nckxpc3RlbmVySW5zdGFuY2VzKCk7DQogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgY29uZkxpc3RlbmVycy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAg\nIGlmIChjb25mTGlzdGVuZXJzW2ldLmdldFRhZygpLmVxdWFscyh0YWcpKQ0K\nICAgICAgICAgICAgICAgIHJldHVybiBjb25mTGlzdGVuZXJzW2ldOw0KDQog\nICAgICAgIC8vIGNoZWNrIHN0b3JlIGxpc3RlbmVycw0KICAgICAgICByZXR1\ncm4gX3N0b3JlUXVlcnkuZ2V0RmlsdGVyTGlzdGVuZXIodGFnKTsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgdm9pZCBhZGRBZ2dyZWdhdGVMaXN0ZW5lcihBZ2dy\nZWdhdGVMaXN0ZW5lciBsaXN0ZW5lcikgew0KICAgICAgICBsb2NrKCk7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAg\nICAgICAgICBhc3NlcnROb3RSZWFkT25seSgpOw0KICAgICAgICAgICAgaWYg\nKF9hZ2dMaXN0ZW5lcnMgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICBfYWdn\nTGlzdGVuZXJzID0gbmV3IEhhc2hNYXAoNSk7DQogICAgICAgICAgICBfYWdn\nTGlzdGVuZXJzLnB1dChsaXN0ZW5lci5nZXRUYWcoKSwgbGlzdGVuZXIpOw0K\nICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCByZW1vdmVBZ2dy\nZWdhdGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0ZW5lcikgew0K\nICAgICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBh\nc3NlcnRPcGVuKCk7DQogICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgp\nOw0KICAgICAgICAgICAgaWYgKF9hZ2dMaXN0ZW5lcnMgIT0gbnVsbCkNCiAg\nICAgICAgICAgICAgICBfYWdnTGlzdGVuZXJzLnJlbW92ZShsaXN0ZW5lci5n\nZXRUYWcoKSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1\nbmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDb2xs\nZWN0aW9uIGdldEFnZ3JlZ2F0ZUxpc3RlbmVycygpIHsNCiAgICAgICAgcmV0\ndXJuIChfYWdnTGlzdGVuZXJzID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1Q\nVFlfTElTVA0KICAgICAgICAgICAgOiBfYWdnTGlzdGVuZXJzLnZhbHVlcygp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBBZ2dyZWdhdGVMaXN0ZW5lciBnZXRB\nZ2dyZWdhdGVMaXN0ZW5lcihTdHJpbmcgdGFnKSB7DQogICAgICAgIC8vIGZp\ncnN0IGNoZWNrIGxpc3RlbmVycyBmb3IgdGhpcyBxdWVyeQ0KICAgICAgICBp\nZiAoX2FnZ0xpc3RlbmVycyAhPSBudWxsKSB7DQogICAgICAgICAgICBBZ2dy\nZWdhdGVMaXN0ZW5lciBsaXN0ZW4gPSAoQWdncmVnYXRlTGlzdGVuZXIpIF9h\nZ2dMaXN0ZW5lcnMuDQogICAgICAgICAgICAgICAgZ2V0KHRhZyk7DQogICAg\nICAgICAgICBpZiAobGlzdGVuICE9IG51bGwpDQogICAgICAgICAgICAgICAg\ncmV0dXJuIGxpc3RlbjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGNoZWNr\nIHVzZXItZGVmaW5lZCBsaXN0ZW5lcnMgZnJvbSBjb25maWd1cmF0aW9uDQog\nICAgICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyW10gY29uZkxpc3RlbmVycyA9IF9i\ncm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLg0KICAgICAgICAgICAgZ2V0QWdn\ncmVnYXRlTGlzdGVuZXJJbnN0YW5jZXMoKTsNCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBjb25mTGlzdGVuZXJzLmxlbmd0aDsgaSsrKQ0KICAgICAg\nICAgICAgaWYgKGNvbmZMaXN0ZW5lcnNbaV0uZ2V0VGFnKCkuZXF1YWxzKHRh\nZykpDQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZMaXN0ZW5lcnNbaV07\nDQoNCiAgICAgICAgLy8gY2hlY2sgc3RvcmUgbGlzdGVuZXJzDQogICAgICAg\nIHJldHVybiBfc3RvcmVRdWVyeS5nZXRBZ2dyZWdhdGVMaXN0ZW5lcih0YWcp\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBFeHRlbnQgZ2V0Q2FuZGlkYXRlRXh0\nZW50KCkgew0KICAgICAgICAvLyBpZiBqdXN0IHRoZSBjbGFzcyBpcyBzZXQs\nIGZldGNoIHRoZSBjb3JyZXNwb25kaW5nIGV4dGVudDsgaWYgdGhlDQogICAg\nICAgIC8vIGV4dGVudCBpcyBhbHJlYWR5IHNldCBidXQgaXRzIGlnbm9yZSBj\nYWNoZSBzZXR0aW5nIGlzIHdyb25nLA0KICAgICAgICAvLyBnZXQgYSBuZXcg\nZXh0ZW50IHdpdGggdGhlIGNvcnJlY3Qgc2V0dGluZyAoZG9uJ3QgbW9kaWZ5\nIG9yaWcgZXh0ZW50DQogICAgICAgIC8vIGluIGNhc2UgdGhlIHVzZXIgaGFz\nIGEgcmVmZXJlbmNlIHRvIGl0IGFuZCBtaWdodCB1c2UgaXQpDQogICAgICAg\nIGxvY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIENsYXNzIGNs\ncyA9IGdldENhbmRpZGF0ZVR5cGUoKTsNCiAgICAgICAgICAgIGlmIChfZXh0\nZW50ID09IG51bGwgJiYgX2NvbGxlY3Rpb24gPT0gbnVsbCAmJiBfYnJva2Vy\nICE9IG51bGwNCiAgICAgICAgICAgICAgICAmJiBjbHMgIT0gbnVsbCkgew0K\nICAgICAgICAgICAgICAgIF9leHRlbnQgPSBfYnJva2VyLm5ld0V4dGVudChj\nbHMsIF9zdWJjbGFzc2VzKTsNCiAgICAgICAgICAgICAgICBfZXh0ZW50LnNl\ndElnbm9yZUNoYW5nZXMoX2lnbm9yZUNoYW5nZXMpOw0KICAgICAgICAgICAg\nfSBlbHNlIGlmIChfZXh0ZW50ICE9IG51bGwNCiAgICAgICAgICAgICAgICAm\nJiBfZXh0ZW50LmdldElnbm9yZUNoYW5nZXMoKSAhPSBfaWdub3JlQ2hhbmdl\ncyAmJiBjbHMgIT0gbnVsbCl7DQogICAgICAgICAgICAgICAgX2V4dGVudCA9\nIF9icm9rZXIubmV3RXh0ZW50KGNscywgX2V4dGVudC5oYXNTdWJjbGFzc2Vz\nKCkpOw0KICAgICAgICAgICAgICAgIF9leHRlbnQuc2V0SWdub3JlQ2hhbmdl\ncyhfaWdub3JlQ2hhbmdlcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAg\nICByZXR1cm4gX2V4dGVudDsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAg\nICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVi\nbGljIHZvaWQgc2V0Q2FuZGlkYXRlRXh0ZW50KEV4dGVudCBjYW5kaWRhdGVF\neHRlbnQpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgYXNzZXJ0Tm90\nUmVhZE9ubHkoKTsNCg0KICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZUV4dGVu\ndCA9PSBfZXh0ZW50KQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAg\nICAgICAgIGlmIChjYW5kaWRhdGVFeHRlbnQgPT0gbnVsbCkgew0KICAgICAg\nICAgICAgICAgIF9leHRlbnQgPSBudWxsOw0KICAgICAgICAgICAgICAgIHJl\ndHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gaWYgZXh0\nZW50IHRoZW4gbm90IGNvbGxlY3Rpb24NCiAgICAgICAgICAgIF9leHRlbnQg\nPSBjYW5kaWRhdGVFeHRlbnQ7DQogICAgICAgICAgICBfY29sbGVjdGlvbiA9\nIG51bGw7DQoNCiAgICAgICAgICAgIGJvb2xlYW4gaW52YWxpZGF0ZSA9IGZh\nbHNlOw0KICAgICAgICAgICAgaWYgKF9leHRlbnQuZ2V0RWxlbWVudFR5cGUo\nKSAhPSBfY2xhc3MpIHsNCiAgICAgICAgICAgICAgICBfY2xhc3MgPSBfZXh0\nZW50LmdldEVsZW1lbnRUeXBlKCk7DQogICAgICAgICAgICAgICAgX2xvYWRl\nciA9IG51bGw7DQogICAgICAgICAgICAgICAgaW52YWxpZGF0ZSA9IHRydWU7\nDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoX2V4dGVudC5oYXNT\ndWJjbGFzc2VzKCkgIT0gX3N1YmNsYXNzZXMpIHsNCiAgICAgICAgICAgICAg\nICBfc3ViY2xhc3NlcyA9IF9leHRlbnQuaGFzU3ViY2xhc3NlcygpOw0KICAg\nICAgICAgICAgICAgIGludmFsaWRhdGUgPSB0cnVlOw0KICAgICAgICAgICAg\nfQ0KICAgICAgICAgICAgaWYgKGludmFsaWRhdGUpDQogICAgICAgICAgICAg\nICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7DQogICAgICAgIH0gZmluYWxs\neSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHB1YmxpYyBDb2xsZWN0aW9uIGdldENhbmRpZGF0ZUNvbGxlY3Rp\nb24oKSB7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgcmV0dXJu\nIF9jb2xsZWN0aW9uOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldENh\nbmRpZGF0ZUNvbGxlY3Rpb24oQ29sbGVjdGlvbiBjYW5kaWRhdGVDb2xsZWN0\naW9uKSB7DQogICAgICAgIGlmICghX3N0b3JlUXVlcnkuc3VwcG9ydHNJbk1l\nbW9yeUV4ZWN1dGlvbigpKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJxdWVyeS1ub3N1cHBvcnQiLA0K\nICAgICAgICAgICAgICAgIF9sYW5ndWFnZSkpOw0KDQogICAgICAgIGxvY2so\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsN\nCg0KICAgICAgICAgICAgLy8gaWYgY29sbGVjdGlvbiB0aGVuIG5vdCBleHRl\nbnQNCiAgICAgICAgICAgIF9jb2xsZWN0aW9uID0gY2FuZGlkYXRlQ29sbGVj\ndGlvbjsNCiAgICAgICAgICAgIGlmIChfY29sbGVjdGlvbiAhPSBudWxsKQ0K\nICAgICAgICAgICAgICAgIF9leHRlbnQgPSBudWxsOw0KICAgICAgICB9IGZp\nbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgQ2xhc3MgZ2V0Q2FuZGlkYXRlVHlwZSgpIHsN\nCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgaWYgKF9jbGFzcyAhPSBudWxs\nIHx8IF9jb21waWxlZCAhPSBudWxsIHx8IF9xdWVyeSA9PSBudWxsDQogICAg\nICAgICAgICAgICAgfHwgX2Jyb2tlciA9PSBudWxsKQ0KICAgICAgICAgICAg\nICAgIHJldHVybiBfY2xhc3M7DQoNCiAgICAgICAgICAgIC8vIGNoZWNrIGFn\nYWluIGFmdGVyIGNvbXBpbGF0aW9uOyBtYXliZSBlbmNvZGVkIGluIHN0cmlu\nZw0KICAgICAgICAgICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7DQogICAg\nICAgICAgICByZXR1cm4gX2NsYXNzOw0KICAgICAgICB9IGZpbmFsbHkgew0K\nICAgICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAg\nICBwdWJsaWMgdm9pZCBzZXRDYW5kaWRhdGVUeXBlKENsYXNzIGNhbmRpZGF0\nZUNsYXNzLCBib29sZWFuIHN1YnMpIHsNCiAgICAgICAgbG9jaygpOw0KICAg\nICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAg\nICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsNCiAgICAgICAgICAgIF9jbGFz\ncyA9IGNhbmRpZGF0ZUNsYXNzOw0KICAgICAgICAgICAgX3N1YmNsYXNzZXMg\nPSBzdWJzOw0KICAgICAgICAgICAgX2xvYWRlciA9IG51bGw7DQogICAgICAg\nICAgICBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsNCiAgICAgICAgfSBmaW5h\nbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQogICAg\nfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaGFzU3ViY2xhc3NlcygpIHsNCiAg\nICAgICAgcmV0dXJuIF9zdWJjbGFzc2VzOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0UmVzdWx0TWFwcGluZ05hbWUoKSB7DQogICAgICAgIGFz\nc2VydE9wZW4oKTsNCiAgICAgICAgcmV0dXJuIF9yZXN1bHRNYXBwaW5nTmFt\nZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgQ2xhc3MgZ2V0UmVzdWx0TWFwcGlu\nZ1Njb3BlKCkgew0KICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIHJl\ndHVybiBfcmVzdWx0TWFwcGluZ1Njb3BlOw0KICAgIH0NCg0KICAgIHB1Ymxp\nYyB2b2lkIHNldFJlc3VsdE1hcHBpbmcoQ2xhc3Mgc2NvcGUsIFN0cmluZyBu\nYW1lKSB7DQogICAgICAgIGxvY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgICAgIF9yZXN1bHRNYXBw\naW5nU2NvcGUgPSBzY29wZTsNCiAgICAgICAgICAgIF9yZXN1bHRNYXBwaW5n\nTmFtZSA9IG5hbWU7DQogICAgICAgICAgICBfcGFja2VyID0gbnVsbDsNCiAg\nICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAg\nICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xlYW4gaXNVbmlxdWUo\nKSB7DQogICAgICAgIGxvY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgICAgIGlmIChfdW5pcXVlICE9\nIG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIF91bmlxdWUuYm9vbGVh\nblZhbHVlKCk7DQogICAgICAgICAgICBpZiAoX3F1ZXJ5ID09IG51bGwgfHwg\nX2NvbXBpbGluZyB8fCBfYnJva2VyID09IG51bGwpDQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICAvLyBjaGVjayBhZ2Fp\nbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcN\nCiAgICAgICAgICAgIGlmIChfY29tcGlsZWQgPT0gbnVsbCkgew0KICAgICAg\nICAgICAgICAgIGNvbXBpbGVGb3JDb21waWxhdGlvbigpOw0KICAgICAgICAg\nICAgICAgIGlmIChfdW5pcXVlICE9IG51bGwpDQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBfdW5pcXVlLmJvb2xlYW5WYWx1ZSgpOw0KICAgICAgICAg\nICAgfQ0KDQogICAgICAgICAgICAvLyBubyBleHBsaWNpdCBzZXR0aW5nOyBk\nZWZhdWx0DQogICAgICAgICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0g\nY29tcGlsZUZvckV4ZWN1dG9yKCk7DQogICAgICAgICAgICBpZiAoIWV4Lmlz\nQWdncmVnYXRlKF9zdG9yZVF1ZXJ5KSkNCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7DQogICAgICAgICAgICByZXR1cm4gIWV4Lmhhc0dyb3VwaW5n\nKF9zdG9yZVF1ZXJ5KTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAg\nICAgIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGlj\nIHZvaWQgc2V0VW5pcXVlKGJvb2xlYW4gdW5pcXVlKSB7DQogICAgICAgIGxv\nY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGFzc2VydE9wZW4o\nKTsNCiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7DQogICAgICAg\nICAgICBfdW5pcXVlID0gKHVuaXF1ZSkgPyBCb29sZWFuLlRSVUUgOiBCb29s\nZWFuLkZBTFNFOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAg\ndW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgQ2xh\nc3MgZ2V0UmVzdWx0VHlwZSgpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAg\nICAgaWYgKF9yZXN1bHRDbGFzcyAhPSBudWxsIHx8IF9jb21waWxlZCAhPSBu\ndWxsIHx8IF9xdWVyeSA9PSBudWxsDQogICAgICAgICAgICAgICAgfHwgX2Jy\nb2tlciA9PSBudWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBfcmVzdWx0\nQ2xhc3M7DQoNCiAgICAgICAgICAgIC8vIGNoZWNrIGFnYWluIGFmdGVyIGNv\nbXBpbGF0aW9uOyBtYXliZSBlbmNvZGVkIGluIHN0cmluZw0KICAgICAgICAg\nICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7DQogICAgICAgICAgICByZXR1\ncm4gX3Jlc3VsdENsYXNzOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAg\nICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJs\naWMgdm9pZCBzZXRSZXN1bHRUeXBlKENsYXNzIGNscykgew0KICAgICAgICBs\nb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRPcGVu\nKCk7DQogICAgICAgICAgICAvLyBhbGxvd2VkIG1vZGlmaWNhdGlvbjogbm8g\ncmVhZC1vbmx5IGNoZWNrDQogICAgICAgICAgICBfcmVzdWx0Q2xhc3MgPSBj\nbHM7DQogICAgICAgICAgICBfcGFja2VyID0gbnVsbDsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgcHVibGljIGxvbmcgZ2V0U3RhcnRSYW5nZSgpIHsNCiAg\nICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICByZXR1cm4gX3N0YXJ0SWR4\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyBsb25nIGdldEVuZFJhbmdlKCkgew0K\nICAgICAgICBhc3NlcnRPcGVuKCk7DQogICAgICAgIHJldHVybiBfZW5kSWR4\nOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIHNldFJhbmdlKGxvbmcgc3Rh\ncnQsIGxvbmcgZW5kKSB7DQogICAgICAgIGlmIChzdGFydCA8IDAgfHwgZW5k\nIDwgMCkNCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJpbnZhbGlkLXJhbmdlIiwNCiAgICAgICAgICAgICAgICBTdHJp\nbmcudmFsdWVPZihzdGFydCksIFN0cmluZy52YWx1ZU9mKGVuZCkpKTsNCg0K\nICAgICAgICBpZiAoZW5kIC0gc3RhcnQgPiBJbnRlZ2VyLk1BWF9WQUxVRSAm\nJiBlbmQgIT0gTG9uZy5NQVhfVkFMVUUpDQogICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgicmFuZ2UtdG9vLWJpZyIsDQog\nICAgICAgICAgICAgICAgU3RyaW5nLnZhbHVlT2Yoc3RhcnQpLCBTdHJpbmcu\ndmFsdWVPZihlbmQpKSk7DQoNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAg\nLy8gYWxsb3dlZCBtb2RpZmljYXRpb246IG5vIHJlYWQtb25seSBjaGVjaw0K\nICAgICAgICAgICAgX3N0YXJ0SWR4ID0gc3RhcnQ7DQogICAgICAgICAgICBf\nZW5kSWR4ID0gZW5kOw0KICAgICAgICAgICAgX3JhbmdlU2V0ID0gdHJ1ZTsN\nCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIHVubG9jaygpOw0K\nICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIFN0cmluZyBnZXRQYXJh\nbWV0ZXJEZWNsYXJhdGlvbigpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAg\nICAgaWYgKF9wYXJhbXMgIT0gbnVsbCB8fCBfY29tcGlsZWQgIT0gbnVsbCB8\nfCBfY29tcGlsaW5nDQogICAgICAgICAgICAgICAgfHwgX2Jyb2tlciA9PSBu\ndWxsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBfcGFyYW1zOw0KDQogICAg\nICAgICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsgbWF5\nYmUgZW5jb2RlZCBpbiBzdHJpbmcNCiAgICAgICAgICAgIGNvbXBpbGVGb3JD\nb21waWxhdGlvbigpOw0KICAgICAgICAgICAgcmV0dXJuIF9wYXJhbXM7DQog\nICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAg\nICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGRlY2xhcmVQYXJh\nbWV0ZXJzKFN0cmluZyBwYXJhbXMpIHsNCiAgICAgICAgaWYgKCFfc3RvcmVR\ndWVyeS5zdXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9ucygpKQ0KICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJxdWVyeS1ub3N1cHBvcnQiLA0KICAgICAgICAgICAgICAgIF9sYW5ndWFn\nZSkpOw0KDQogICAgICAgIGxvY2soKTsNCiAgICAgICAgdHJ5IHsNCiAgICAg\nICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgICAgIGFzc2VydE5vdFJl\nYWRPbmx5KCk7DQogICAgICAgICAgICBfcGFyYW1zID0gU3RyaW5nVXRpbHMu\ndHJpbVRvTnVsbChwYXJhbXMpOw0KICAgICAgICAgICAgaW52YWxpZGF0ZUNv\nbXBpbGF0aW9uKCk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAg\nICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyB2\nb2lkIGNvbXBpbGUoKSB7DQogICAgICAgIGxvY2soKTsNCiAgICAgICAgdHJ5\nIHsNCiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgICAgIFN0\nb3JlUXVlcnkuRXhlY3V0b3IgZXggPSBjb21waWxlRm9yRXhlY3V0b3IoKTsN\nCiAgICAgICAgICAgIGdldFJlc3VsdFBhY2tlcihfc3RvcmVRdWVyeSwgZXgp\nOw0KICAgICAgICAgICAgZXgudmFsaWRhdGUoX3N0b3JlUXVlcnkpOw0KICAg\nICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQogICAg\nICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgT2JqZWN0IGdldENvbXBpbGF0\naW9uKCkgew0KICAgICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAg\nICAgICAgICByZXR1cm4gY29tcGlsZUZvckNvbXBpbGF0aW9uKCkuc3RvcmVE\nYXRhOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2Nr\nKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb21w\naWxlIHF1ZXJ5IHByb3BlcnRpZXMuDQogICAgICovDQogICAgcHJpdmF0ZSBD\nb21waWxhdGlvbiBjb21waWxlRm9yQ29tcGlsYXRpb24oKSB7DQogICAgICAg\nIGlmIChfY29tcGlsZWQgIT0gbnVsbCB8fCBfY29tcGlsaW5nKQ0KICAgICAg\nICAgICAgcmV0dXJuIF9jb21waWxlZDsNCg0KICAgICAgICBhc3NlcnROb3RT\nZXJpYWxpemVkKCk7DQogICAgICAgIGFzc2VydE9wZW4oKTsNCg0KICAgICAg\nICBib29sZWFuIHJlYWRPbmx5ID0gX3JlYWRPbmx5Ow0KICAgICAgICBfcmVh\nZE9ubHkgPSBmYWxzZTsNCiAgICAgICAgX2NvbXBpbGluZyA9IHRydWU7DQog\nICAgICAgIHRyeSB7DQogICAgICAgICAgICBfY29tcGlsZWQgPSBjb21waWxh\ndGlvbkZyb21DYWNoZSgpOw0KICAgICAgICAgICAgcmV0dXJuIF9jb21waWxl\nZDsNCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgew0K\nICAgICAgICAgICAgdGhyb3cga2U7DQogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBHZW5l\ncmFsRXhjZXB0aW9uKHJlKTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAg\nICAgICAgIF9jb21waWxpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIF9yZWFk\nT25seSA9IHJlYWRPbmx5Ow0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoq\nDQogICAgICogRmluZCB0aGUgY2FjaGVkIGNvbXBpbGF0aW9uIGZvciB0aGUg\nY3VycmVudCBxdWVyeSwgY3JlYXRpbmcgb25lIGlmIGl0DQogICAgICogZG9l\ncyBub3QgZXhpc3QuDQogICAgICovDQogICAgcHJvdGVjdGVkIENvbXBpbGF0\naW9uIGNvbXBpbGF0aW9uRnJvbUNhY2hlKCkgew0KICAgICAgICBNYXAgY29t\ncENhY2hlID0NCiAgICAgICAgICAgIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlv\nbigpLmdldFF1ZXJ5Q29tcGlsYXRpb25DYWNoZUluc3RhbmNlKCk7DQogICAg\nICAgIGlmIChjb21wQ2FjaGUgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0\ndXJuIG5ld0NvbXBpbGF0aW9uKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAg\nICAgICAgICBDb21waWxhdGlvbktleSBrZXkgPSBuZXcgQ29tcGlsYXRpb25L\nZXkoKTsNCiAgICAgICAgICAgIGtleS5xdWVyeVR5cGUgPSBfc3RvcmVRdWVy\neS5nZXRDbGFzcygpOw0KICAgICAgICAgICAga2V5LmNhbmRpZGF0ZVR5cGUg\nPSBnZXRDYW5kaWRhdGVUeXBlKCk7DQogICAgICAgICAgICBrZXkuc3ViY2xh\nc3NlcyA9IGhhc1N1YmNsYXNzZXMoKTsNCiAgICAgICAgICAgIGtleS5xdWVy\neSA9IGdldFF1ZXJ5U3RyaW5nKCk7DQogICAgICAgICAgICBrZXkubGFuZ3Vh\nZ2UgPSBnZXRMYW5ndWFnZSgpOw0KICAgICAgICAgICAga2V5LnN0b3JlS2V5\nID0gX3N0b3JlUXVlcnkubmV3Q29tcGlsYXRpb25LZXkoKTsNCiAgICAgICAg\nICAgIENvbXBpbGF0aW9uIGNvbXAgPSAoQ29tcGlsYXRpb24pIGNvbXBDYWNo\nZS5nZXQoa2V5KTsNCg0KICAgICAgICAgICAgLy8gcGFyc2UgZGVjbGFyYXRp\nb25zIGlmIG5lZWRlZA0KICAgICAgICAgICAgYm9vbGVhbiBjYWNoZSA9IGZh\nbHNlOw0KICAgICAgICAgICAgaWYgKGNvbXAgPT0gbnVsbCkgew0KICAgICAg\nICAgICAgICAgIGNvbXAgPSBuZXdDb21waWxhdGlvbigpOw0KICAgICAgICAg\nICAgICAgIC8vIG9ubHkgY2FjaGUgdGhvc2UgcXVlcmllcyB0aGF0IGNhbiBi\nZSBjb21waWxlZA0KICAgICAgICAgICAgICAgIGNhY2hlID0gY29tcC5zdG9y\nZURhdGEgIT0gbnVsbDsNCiAgICAgICAgICAgIH0gZWxzZQ0KICAgICAgICAg\nICAgICAgIF9zdG9yZVF1ZXJ5LnBvcHVsYXRlRnJvbUNvbXBpbGF0aW9uKGNv\nbXAuc3RvcmVEYXRhKTsNCg0KICAgICAgICAgICAgLy8gY2FjaGUgcGFyc2Vk\nIHN0YXRlIGlmIG5lZWRlZA0KICAgICAgICAgICAgaWYgKGNhY2hlKQ0KICAg\nICAgICAgICAgICAgIGNvbXBDYWNoZS5wdXQoa2V5LCBjb21wKTsNCiAgICAg\nICAgICAgIHJldHVybiBjb21wOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0K\nICAgIC8qKg0KICAgICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUgYSBuZXcgY29t\ncGlsYXRpb24uDQogICAgICovDQogICAgcHJpdmF0ZSBDb21waWxhdGlvbiBu\nZXdDb21waWxhdGlvbigpIHsNCiAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9\nIG5ldyBDb21waWxhdGlvbigpOw0KICAgICAgICBjb21wLnN0b3JlRGF0YSA9\nIF9zdG9yZVF1ZXJ5Lm5ld0NvbXBpbGF0aW9uKCk7DQogICAgICAgIF9zdG9y\nZVF1ZXJ5LnBvcHVsYXRlRnJvbUNvbXBpbGF0aW9uKGNvbXAuc3RvcmVEYXRh\nKTsNCiAgICAgICAgcmV0dXJuIGNvbXA7DQogICAgfQ0KDQogICAgLyoqDQog\nICAgICogQ29tcGlsZSBmb3IgZXhlY3V0aW9uLCBjaG9vc2luZyBiZXR3ZWVu\nIGRhdGFzdG9yZSBhbmQgaW4tbWVtDQogICAgICogY29tcGlsYXRpb24gYmFz\nZWQgb24gd2hhdCB3ZSBzdXBwb3J0IGFuZCBvdXIgc2V0dGluZ3MuDQogICAg\nICovDQogICAgcHJpdmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGNvbXBpbGVG\nb3JFeGVjdXRvcigpIHsNCiAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9IGNv\nbXBpbGVGb3JDb21waWxhdGlvbigpOw0KICAgICAgICBpZiAoX2NvbGxlY3Rp\nb24gPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKGNvbXAuZGF0YXN0b3Jl\nICE9IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXAuZGF0YXN0\nb3JlOw0KICAgICAgICAgICAgaWYgKGNvbXAubWVtb3J5ICE9IG51bGwpDQog\nICAgICAgICAgICAgICAgcmV0dXJuIGNvbXAubWVtb3J5Ow0KICAgICAgICAg\nICAgaWYgKF9zdG9yZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9u\nKCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JEYXRhU3Rv\ncmUoY29tcCk7DQogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckluTWVt\nb3J5KGNvbXApOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGNvbXAubWVt\nb3J5ICE9IG51bGwpDQogICAgICAgICAgICByZXR1cm4gY29tcC5tZW1vcnk7\nDQogICAgICAgIGlmIChjb21wLmRhdGFzdG9yZSAhPSBudWxsKQ0KICAgICAg\nICAgICAgcmV0dXJuIGNvbXAuZGF0YXN0b3JlOw0KICAgICAgICBpZiAoX3N0\nb3JlUXVlcnkuc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigpKQ0KICAgICAg\nICAgICAgcmV0dXJuIGNvbXBpbGVGb3JJbk1lbW9yeShjb21wKTsNCiAgICAg\nICAgcmV0dXJuIGNvbXBpbGVGb3JEYXRhU3RvcmUoY29tcCk7DQogICAgfQ0K\nDQogICAgLyoqDQogICAgICogQ3JlYXRlIGFuIGV4cHJlc3Npb24gdHJlZSBm\nb3IgZGF0YXN0b3JlIGV4ZWN1dGlvbi4NCiAgICAgKi8NCiAgICBwcml2YXRl\nIFN0b3JlUXVlcnkuRXhlY3V0b3IgY29tcGlsZUZvckRhdGFTdG9yZShDb21w\naWxhdGlvbiBjb21wKSB7DQogICAgICAgIGlmIChjb21wLmRhdGFzdG9yZSA9\nPSBudWxsKQ0KICAgICAgICAgICAgY29tcC5kYXRhc3RvcmUgPSBjcmVhdGVF\neGVjdXRvcihmYWxzZSk7DQogICAgICAgIHJldHVybiBjb21wLmRhdGFzdG9y\nZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGUgYW4gZXhwcmVz\nc2lvbiB0cmVlIGZvciBpbi1tZW1vcnkgZXhlY3V0aW9uLg0KICAgICAqLw0K\nICAgIHByaXZhdGUgU3RvcmVRdWVyeS5FeGVjdXRvciBjb21waWxlRm9ySW5N\nZW1vcnkoQ29tcGlsYXRpb24gY29tcCkgew0KICAgICAgICBpZiAoY29tcC5t\nZW1vcnkgPT0gbnVsbCkNCiAgICAgICAgICAgIGNvbXAubWVtb3J5ID0gY3Jl\nYXRlRXhlY3V0b3IodHJ1ZSk7DQogICAgICAgIHJldHVybiBjb21wLm1lbW9y\neTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm4gYSBxdWVyeSBl\neGVjdXRvciBvZiB0aGUgcHJvcGVyIHR5cGUuDQogICAgICovDQogICAgcHJp\ndmF0ZSBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGNyZWF0ZUV4ZWN1dG9yKGJvb2xl\nYW4gaW5NZW0pIHsNCiAgICAgICAgYXNzZXJ0Q2FuZGlkYXRlVHlwZSgpOw0K\nDQogICAgICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcyA9IF9icm9rZXIu\nZ2V0Q29uZmlndXJhdGlvbigpLg0KICAgICAgICAgICAgZ2V0TWV0YURhdGFS\nZXBvc2l0b3J5SW5zdGFuY2UoKTsNCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoX2NsYXNzLA0KICAgICAgICAgICAg\nX2Jyb2tlci5nZXRDbGFzc0xvYWRlcigpLCBmYWxzZSk7DQoNCiAgICAgICAg\nQ2xhc3NNZXRhRGF0YVtdIG1ldGFzOw0KICAgICAgICBpZiAoX2NsYXNzID09\nIG51bGwgfHwgX3N0b3JlUXVlcnkuc3VwcG9ydHNBYnN0cmFjdEV4ZWN1dG9y\ncygpKQ0KICAgICAgICAgICAgbWV0YXMgPSBuZXcgQ2xhc3NNZXRhRGF0YVtd\neyBtZXRhIH07DQogICAgICAgIGVsc2UgaWYgKF9zdWJjbGFzc2VzICYmICht\nZXRhID09IG51bGwgfHwgbWV0YS5pc01hbmFnZWRJbnRlcmZhY2UoKSkpDQog\nICAgICAgICAgICBtZXRhcyA9IHJlcG9zLmdldEltcGxlbWVudG9yTWV0YURh\ndGFzKF9jbGFzcywNCiAgICAgICAgICAgICAgICBfYnJva2VyLmdldENsYXNz\nTG9hZGVyKCksIHRydWUpOw0KICAgICAgICBlbHNlIGlmIChtZXRhICE9IG51\nbGwgJiYgKF9zdWJjbGFzc2VzIHx8IG1ldGEuaXNNYXBwZWQoKSkpDQogICAg\nICAgICAgICBtZXRhcyA9IG5ldyBDbGFzc01ldGFEYXRhW117IG1ldGEgfTsN\nCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgbWV0YXMgPSBTdG9yZVF1ZXJ5\nLkVNUFRZX01FVEFTOw0KDQogICAgICAgIGlmIChtZXRhcy5sZW5ndGggPT0g\nMCkNCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJuby1pbXBscyIsIF9jbGFzcykpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgaWYgKG1ldGFzLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAg\nICAgICAgaWYgKGluTWVtKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nX3N0b3JlUXVlcnkubmV3SW5NZW1vcnlFeGVjdXRvcihtZXRhc1swXSwNCiAg\nICAgICAgICAgICAgICAgICAgICAgIF9zdWJjbGFzc2VzKTsNCiAgICAgICAg\nICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkubmV3RGF0YVN0b3JlRXhlY3V0\nb3IobWV0YXNbMF0sIF9zdWJjbGFzc2VzKTsNCiAgICAgICAgICAgIH0NCg0K\nICAgICAgICAgICAgLy8gbXVsdGlwbGUgaW1wbGVtZW50b3JzDQogICAgICAg\nICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yW10gZXMgPSBuZXcgU3RvcmVRdWVy\neS5FeGVjdXRvclttZXRhcy5sZW5ndGhdOw0KICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAg\nICAgIGlmIChpbk1lbSkNCiAgICAgICAgICAgICAgICAgICAgZXNbaV0gPSBf\nc3RvcmVRdWVyeS5uZXdJbk1lbW9yeUV4ZWN1dG9yKG1ldGFzW2ldLCB0cnVl\nKTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAg\nIGVzW2ldID0gX3N0b3JlUXVlcnkubmV3RGF0YVN0b3JlRXhlY3V0b3IobWV0\nYXNbaV0sIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0\ndXJuIG5ldyBNZXJnZWRFeGVjdXRvcihlcyk7DQogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtl\nOw0KICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7DQog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7DQog\nICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDbGVhciBhbnkg\nY29tcGlsYXRpb24sIGZvcmNpbmcgdGhpcyBxdWVyeSB0byBiZSByZWNvbXBp\nbGVkDQogICAgICogbmV4dCB0aW1lIGl0J3MgZXhlY3V0ZWQuIFRoaXMgc2hv\ndWxkIGJlIGludm9rZWQgd2hlbmV2ZXIgYW55DQogICAgICogc3RhdGUgY2hh\nbmdlcyB0aGF0IHdvdWxkIGNhdXNlIHRoZSB1bmRlcmx5aW5nIHF1ZXJ5DQog\nICAgICogcmVwcmVzZW50YXRpb24gdG8gY2hhbmdlLg0KICAgICAqDQogICAg\nICogQHNpbmNlIDAuMy4wDQogICAgICovDQogICAgcHJpdmF0ZSBib29sZWFu\nIGludmFsaWRhdGVDb21waWxhdGlvbigpIHsNCiAgICAgICAgaWYgKF9jb21w\naWxpbmcpDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIF9z\ndG9yZVF1ZXJ5LmludmFsaWRhdGVDb21waWxhdGlvbigpOw0KICAgICAgICBf\nY29tcGlsZWQgPSBudWxsOw0KICAgICAgICBfcGFja2VyID0gbnVsbDsNCiAg\nICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgcHVibGljIE9iamVj\ndCBleGVjdXRlKCkgew0KICAgICAgICByZXR1cm4gZXhlY3V0ZSgoT2JqZWN0\nW10pIG51bGwpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmplY3QgZXhlY3V0\nZShPYmplY3RbXSBwYXJhbXMpIHsNCiAgICAgICAgcmV0dXJuIGV4ZWN1dGUo\nT1BfU0VMRUNULCBwYXJhbXMpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBPYmpl\nY3QgZXhlY3V0ZShNYXAgcGFyYW1zKSB7DQogICAgICAgIHJldHVybiBleGVj\ndXRlKE9QX1NFTEVDVCwgcGFyYW1zKTsNCiAgICB9DQoNCiAgICBwcml2YXRl\nIE9iamVjdCBleGVjdXRlKGludCBvcGVyYXRpb24sIE9iamVjdFtdIHBhcmFt\ncykgew0KICAgICAgICBpZiAocGFyYW1zID09IG51bGwpDQogICAgICAgICAg\nICBwYXJhbXMgPSBTdG9yZVF1ZXJ5LkVNUFRZX09CSkVDVFM7DQoNCiAgICAg\nICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXNzZXJ0\nTm90U2VyaWFsaXplZCgpOw0KICAgICAgICAgICAgX2Jyb2tlci5iZWdpbk9w\nZXJhdGlvbih0cnVlKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAg\nICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgICAgIF9icm9rZXIu\nYXNzZXJ0Tm9udHJhbnNhY3Rpb25hbFJlYWQoKTsNCg0KICAgICAgICAgICAg\nICAgIC8vIGdldCBleGVjdXRvcg0KICAgICAgICAgICAgICAgIENvbXBpbGF0\naW9uIGNvbXAgPSBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsNCiAgICAgICAg\nICAgICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gKGlzSW5NZW1vcnko\nb3BlcmF0aW9uKSkNCiAgICAgICAgICAgICAgICAgICAgPyBjb21waWxlRm9y\nSW5NZW1vcnkoY29tcCkgOiBjb21waWxlRm9yRGF0YVN0b3JlKGNvbXApOw0K\nDQogICAgICAgICAgICAgICAgYXNzZXJ0UGFyYW1ldGVycyhfc3RvcmVRdWVy\neSwgZXgsIHBhcmFtcyk7DQogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkNCiAgICAgICAgICAgICAgICAgICAgbG9nRXhlY3V0\naW9uKG9wZXJhdGlvbiwgZXguZ2V0UGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVl\ncnkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zKTsNCg0KICAg\nICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT0gT1BfU0VMRUNUKQ0KICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gZXhlY3V0ZShfc3RvcmVRdWVyeSwg\nZXgsIHBhcmFtcyk7DQogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9\nPSBPUF9ERUxFVEUpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWxl\ndGUoX3N0b3JlUXVlcnksIGV4LCBwYXJhbXMpOw0KICAgICAgICAgICAgICAg\nIGlmIChvcGVyYXRpb24gPT0gT1BfVVBEQVRFKQ0KICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gdXBkYXRlKF9zdG9yZVF1ZXJ5LCBleCwgcGFyYW1zKTsN\nCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRp\nb24oKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBrZTsNCiAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7DQogICAgICAgICAgICB9IGZpbmFs\nbHkgew0KICAgICAgICAgICAgICAgIF9icm9rZXIuZW5kT3BlcmF0aW9uKCk7\nDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZmluYWxseSB7\nDQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0K\nICAgIHByaXZhdGUgT2JqZWN0IGV4ZWN1dGUoaW50IG9wZXJhdGlvbiwgTWFw\nIHBhcmFtcykgew0KICAgICAgICBpZiAocGFyYW1zID09IG51bGwpDQogICAg\nICAgICAgICBwYXJhbXMgPSBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7DQoNCiAg\nICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgX2Jy\nb2tlci5iZWdpbk9wZXJhdGlvbih0cnVlKTsNCiAgICAgICAgICAgIHRyeSB7\nDQogICAgICAgICAgICAgICAgYXNzZXJ0Tm90U2VyaWFsaXplZCgpOw0KICAg\nICAgICAgICAgICAgIGFzc2VydE9wZW4oKTsNCiAgICAgICAgICAgICAgICBf\nYnJva2VyLmFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7DQoNCiAgICAg\nICAgICAgICAgICAvLyBnZXQgZXhlY3V0b3INCiAgICAgICAgICAgICAgICBD\nb21waWxhdGlvbiBjb21wID0gY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7DQog\nICAgICAgICAgICAgICAgU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IChpc0lu\nTWVtb3J5KG9wZXJhdGlvbikpDQogICAgICAgICAgICAgICAgICAgID8gY29t\ncGlsZUZvckluTWVtb3J5KGNvbXApIDogY29tcGlsZUZvckRhdGFTdG9yZShj\nb21wKTsNCg0KICAgICAgICAgICAgICAgIE9iamVjdFtdIGFyciA9IChwYXJh\nbXMuaXNFbXB0eSgpKSA/IFN0b3JlUXVlcnkuRU1QVFlfT0JKRUNUUyA6DQog\nICAgICAgICAgICAgICAgICAgIHRvUGFyYW1ldGVyQXJyYXkoZXguZ2V0UGFy\nYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpLCBwYXJhbXMpOw0KICAgICAgICAg\nICAgICAgIGFzc2VydFBhcmFtZXRlcnMoX3N0b3JlUXVlcnksIGV4LCBhcnIp\nOw0KICAgICAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkp\nDQogICAgICAgICAgICAgICAgICAgIGxvZ0V4ZWN1dGlvbihvcGVyYXRpb24s\nIHBhcmFtcyk7DQoNCiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09\nIE9QX1NFTEVDVCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4ZWN1\ndGUoX3N0b3JlUXVlcnksIGV4LCBhcnIpOw0KICAgICAgICAgICAgICAgIGlm\nIChvcGVyYXRpb24gPT0gT1BfREVMRVRFKQ0KICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZGVsZXRlKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsNCiAgICAg\nICAgICAgICAgICBpZiAob3BlcmF0aW9uID09IE9QX1VQREFURSkNCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZShfc3RvcmVRdWVyeSwgZXgs\nIGFycik7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVk\nRXhjZXB0aW9uKCk7DQogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7DQogICAgICAgICAgICAgICAgdGhyb3cga2U7DQogICAg\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGUpOw0KICAgICAgICAgICAg\nfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICBfYnJva2VyLmVuZE9wZXJh\ndGlvbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZp\nbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICBwdWJsaWMgbG9uZyBkZWxldGVBbGwoKSB7DQogICAgICAg\nIHJldHVybiBkZWxldGVBbGwoKE9iamVjdFtdKSBudWxsKTsNCiAgICB9DQoN\nCiAgICBwdWJsaWMgbG9uZyBkZWxldGVBbGwoT2JqZWN0W10gcGFyYW1zKSB7\nDQogICAgICAgIHJldHVybiAoKE51bWJlcikgZXhlY3V0ZShPUF9ERUxFVEUs\nIHBhcmFtcykpLmxvbmdWYWx1ZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBs\nb25nIGRlbGV0ZUFsbChNYXAgcGFyYW1zKSB7DQogICAgICAgIHJldHVybiAo\nKE51bWJlcikgZXhlY3V0ZShPUF9ERUxFVEUsIHBhcmFtcykpLmxvbmdWYWx1\nZSgpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbCgpIHsN\nCiAgICAgICAgcmV0dXJuIHVwZGF0ZUFsbCgoT2JqZWN0W10pIG51bGwpOw0K\nICAgIH0NCg0KICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbChPYmplY3RbXSBw\nYXJhbXMpIHsNCiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBleGVjdXRlKE9Q\nX1VQREFURSwgcGFyYW1zKSkubG9uZ1ZhbHVlKCk7DQogICAgfQ0KDQogICAg\ncHVibGljIGxvbmcgdXBkYXRlQWxsKE1hcCBwYXJhbXMpIHsNCiAgICAgICAg\ncmV0dXJuICgoTnVtYmVyKSBleGVjdXRlKE9QX1VQREFURSwgcGFyYW1zKSku\nbG9uZ1ZhbHVlKCk7DQogICAgfQ0KDQogICAgcHJpdmF0ZSBPYmplY3RbXSB0\nb1BhcmFtZXRlckFycmF5KExpbmtlZE1hcCBwYXJhbVR5cGVzLCBNYXAgcGFy\nYW1zKSB7DQogICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCB8fCBwYXJhbXMu\naXNFbXB0eSgpKQ0KICAgICAgICAgICAgcmV0dXJuIFN0b3JlUXVlcnkuRU1Q\nVFlfT0JKRUNUUzsNCg0KICAgICAgICBPYmplY3RbXSBhcnIgPSBuZXcgT2Jq\nZWN0W3BhcmFtcy5zaXplKCldOw0KICAgICAgICBNYXAuRW50cnkgZW50cnk7\nDQogICAgICAgIE9iamVjdCBrZXk7DQogICAgICAgIGludCBpZHg7DQogICAg\nICAgIGludCBiYXNlID0gLTE7DQogICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gcGFyYW1zLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsNCiAgICAgICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5l\neHQoKTsNCiAgICAgICAgICAgIGtleSA9IGVudHJ5LmdldEtleSgpOw0KICAg\nICAgICAgICAgaWR4ID0gKHBhcmFtVHlwZXMgPT0gbnVsbCkgPyAtMSA6IHBh\ncmFtVHlwZXMuaW5kZXhPZihrZXkpOw0KDQogICAgICAgICAgICAvLyBhbGxv\ndyBwb3NpdGlvbmFsIHBhcmFtZXRlcnMgYW5kIG5hdHVyYWwgb3JkZXIgcGFy\nYW1ldGVycw0KICAgICAgICAgICAgaWYgKGlkeCAhPSAtMSkNCiAgICAgICAg\nICAgICAgICBhcnJbaWR4XSA9IGVudHJ5LmdldFZhbHVlKCk7DQogICAgICAg\nICAgICBlbHNlIGlmIChrZXkgaW5zdGFuY2VvZiBOdW1iZXIpIHsNCiAgICAg\nICAgICAgICAgICBpZiAoYmFzZSA9PSAtMSkNCiAgICAgICAgICAgICAgICAg\nICAgYmFzZSA9IHBvc2l0aW9uYWxQYXJhbWV0ZXJCYXNlKHBhcmFtcy5rZXlT\nZXQoKSk7DQogICAgICAgICAgICAgICAgYXJyWygoTnVtYmVyKSBrZXkpLmlu\ndFZhbHVlKCkgLSBiYXNlXSA9IGVudHJ5LmdldFZhbHVlKCk7DQogICAgICAg\nICAgICB9IGVsc2UNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiYmFkLXBhcmFtLW5hbWUiLCBrZXkpKTsNCiAg\nICAgICAgfQ0KICAgICAgICByZXR1cm4gYXJyOw0KICAgIH0NCg0KICAgIC8q\nKg0KICAgICAqIFJldHVybiB0aGUgYmFzZSAoZ2VuZXJhbGx5IDAgb3IgMSkg\ndG8gdXNlIGZvciBwb3NpdGlvbmFsIHBhcmFtZXRlcnMuDQogICAgICovDQog\nICAgcHJpdmF0ZSBzdGF0aWMgaW50IHBvc2l0aW9uYWxQYXJhbWV0ZXJCYXNl\nKENvbGxlY3Rpb24gcGFyYW1zKSB7DQogICAgICAgIGludCBsb3cgPSBJbnRl\nZ2VyLk1BWF9WQUxVRTsNCiAgICAgICAgT2JqZWN0IG9iajsNCiAgICAgICAg\naW50IHZhbDsNCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBwYXJhbXMu\naXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsNCiAgICAgICAgICAgIG9i\naiA9IGl0ci5uZXh0KCk7DQogICAgICAgICAgICBpZiAoIShvYmogaW5zdGFu\nY2VvZiBOdW1iZXIpKQ0KICAgICAgICAgICAgICAgIHJldHVybiAwOyAvLyB1\nc2UgMCBiYXNlIHdoZW4gcGFyYW1zIGFyZSBtaXhlZCB0eXBlcw0KDQogICAg\nICAgICAgICB2YWwgPSAoKE51bWJlcikgb2JqKS5pbnRWYWx1ZSgpOw0KICAg\nICAgICAgICAgaWYgKHZhbCA9PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVy\nbiB2YWw7DQogICAgICAgICAgICBpZiAodmFsIDwgbG93KQ0KICAgICAgICAg\nICAgICAgIGxvdyA9IHZhbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4g\nbG93Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybiB3aGV0aGVy\nIHdlIHNob3VsZCBleGVjdXRlIHRoaXMgcXVlcnkgaW4gbWVtb3J5Lg0KICAg\nICAqLw0KICAgIHByaXZhdGUgYm9vbGVhbiBpc0luTWVtb3J5KGludCBvcGVy\nYXRpb24pIHsNCiAgICAgICAgLy8gaWYgdGhlcmUgYXJlIGFueSBkaXJ0eSBp\nbnN0YW5jZXMgaW4gdGhlIGN1cnJlbnQgdHJhbnMgdGhhdCBhcmUNCiAgICAg\nICAgLy8gaW52b2x2ZWQgaW4gdGhpcyBxdWVyeSwgd2UgaGF2ZSB0byBleGVj\ndXRlIGluIG1lbW9yeSBvciBmbHVzaA0KICAgICAgICBib29sZWFuIGluTWVt\nID0gIV9zdG9yZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkN\nCiAgICAgICAgICAgIHx8IF9jb2xsZWN0aW9uICE9IG51bGw7DQogICAgICAg\nIGlmICghaW5NZW0gJiYgKCFfaWdub3JlQ2hhbmdlcyB8fCBvcGVyYXRpb24g\nIT0gT1BfU0VMRUNUKQ0KICAgICAgICAgICAgJiYgX2Jyb2tlci5pc0FjdGl2\nZSgpICYmIGlzQWNjZXNzUGF0aERpcnR5KCkpIHsNCiAgICAgICAgICAgIGlu\ndCBmbHVzaCA9IF9mYy5nZXRGbHVzaEJlZm9yZVF1ZXJpZXMoKTsNCiAgICAg\nICAgICAgIGlmICgoZmx1c2ggPT0gRkxVU0hfVFJVRQ0KICAgICAgICAgICAg\nICAgIHx8IChmbHVzaCA9PSBGTFVTSF9XSVRIX0NPTk5FQ1RJT04gJiYgX2Jy\nb2tlci5oYXNDb25uZWN0aW9uKCkpDQogICAgICAgICAgICAgICAgfHwgb3Bl\ncmF0aW9uICE9IE9QX1NFTEVDVA0KICAgICAgICAgICAgICAgIHx8ICFfc3Rv\ncmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhlY3V0aW9uKCkpDQogICAgICAg\nICAgICAgICAgJiYgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuc3VwcG9y\ndGVkT3B0aW9ucygpLg0KICAgICAgICAgICAgICAgIGNvbnRhaW5zKE9wZW5K\nUEFDb25maWd1cmF0aW9uLk9QVElPTl9JTkNfRkxVU0gpKSB7DQogICAgICAg\nICAgICAgICAgX2Jyb2tlci5mbHVzaCgpOw0KICAgICAgICAgICAgfSBlbHNl\nIHsNCiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc0luZm9FbmFibGVkKCkp\nDQogICAgICAgICAgICAgICAgICAgIF9sb2cuaW5mbyhfbG9jLmdldCgiZm9y\nY2UtaW4tbWVtIiwgX2NsYXNzKSk7DQogICAgICAgICAgICAgICAgaW5NZW0g\nPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAg\naWYgKGluTWVtICYmICFfc3RvcmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhl\nY3V0aW9uKCkpDQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYW50LWV4ZWMtaW5tZW0iLA0KICAgICAg\nICAgICAgICAgIF9sYW5ndWFnZSkpOw0KICAgICAgICByZXR1cm4gaW5NZW07\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogRXhlY3V0ZSB0aGUgcXVlcnkg\ndXNpbmcgdGhlIGdpdmVuIGNvbXBpbGF0aW9uLCBleGVjdXRvciwgYW5kIHBh\ncmFtZXRlcg0KICAgICAqIHZhbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0\naG9kcyBkZWxlZ2F0ZSB0byB0aGlzIG9uZSBvciB0bw0KICAgICAqIHtAbGlu\nayAjZXhlY3V0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZh\nbGlkYXRpb24gYW5kIGxvY2tpbmcuDQogICAgICovDQogICAgcHJpdmF0ZSBP\nYmplY3QgZXhlY3V0ZShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0\nb3IgZXgsIA0KICAgICAgICBPYmplY3RbXSBwYXJhbXMpDQogICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gew0KICAgICAgICAvLyBpZiB0aGlzIGlzIGFuIGlt\ncG9zc2libGUgcmVzdWx0IHJhbmdlLCByZXR1cm4gbnVsbCAvIGVtcHR5IGxp\nc3QNCiAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSA9IG5ldyBTdG9y\nZVF1ZXJ5LlJhbmdlKF9zdGFydElkeCwgX2VuZElkeCk7DQogICAgICAgIGlm\nICghX3JhbmdlU2V0KQ0KICAgICAgICAgICAgZXguZ2V0UmFuZ2UocSwgcGFy\nYW1zLCByYW5nZSk7DQogICAgICAgIGlmIChyYW5nZS5zdGFydCA+PSByYW5n\nZS5lbmQpDQogICAgICAgICAgICByZXR1cm4gZW1wdHlSZXN1bHQocSwgZXgp\nOw0KDQogICAgICAgIC8vIGV4ZWN1dGU7IGlmIHdlIGhhdmUgYSByZXN1bHQg\nY2xhc3Mgb3Igd2UgaGF2ZSBvbmx5IG9uZSByZXN1bHQNCiAgICAgICAgLy8g\nYW5kIHNvIG5lZWQgdG8gcmVtb3ZlIGl0IGZyb20gaXRzIGFycmF5LCB3cmFw\nIGluIGEgcGFja2luZyByb3ANCiAgICAgICAgcmFuZ2UubHJzID0gaXNMUlMo\ncmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7DQogICAgICAgIFJlc3VsdE9iamVj\ndFByb3ZpZGVyIHJvcCA9IGV4LmV4ZWN1dGVRdWVyeShxLCBwYXJhbXMsIHJh\nbmdlKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiB0b1Jl\nc3VsdChxLCBleCwgcm9wLCByYW5nZSk7DQogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7DQogICAgICAgICAgICBpZiAocm9wICE9IG51bGwpDQog\nICAgICAgICAgICAgICAgdHJ5IHsgcm9wLmNsb3NlKCk7IH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlMikge30NCiAgICAgICAgICAgIHRocm93IGU7DQogICAgICAg\nIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBEZWxldGUgdGhlIHF1ZXJ5\nIHVzaW5nIHRoZSBnaXZlbiBleGVjdXRvciwgYW5kIHBhcmFtZXRlcg0KICAg\nICAqIHZhbHVlcy4gQWxsIG90aGVyIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0\nZSB0byB0aGlzIG9uZSBvciB0bw0KICAgICAqIHtAbGluayAjZGVsZXRlKFN0\nb3JlUXVlcnkuRXhlY3V0b3IsTWFwKX0gYWZ0ZXIgdmFsaWRhdGlvbiBhbmQg\nbG9ja2luZy4NCiAgICAgKiBUaGUgcmV0dXJuIHZhbHVlIHdpbGwgYmUgYSBO\ndW1iZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mDQogICAgICogaW5zdGFu\nY2VzIGRlbGV0ZWQuDQogICAgICovDQogICAgcHJpdmF0ZSBOdW1iZXIgZGVs\nZXRlKFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgT2Jq\nZWN0W10gcGFyYW1zKQ0KICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsNCiAg\nICAgICAgYXNzZXJ0QnVsa01vZGlmeShxLCBleCwgcGFyYW1zKTsNCiAgICAg\nICAgcmV0dXJuIGV4LmV4ZWN1dGVEZWxldGUocSwgcGFyYW1zKTsNCiAgICB9\nDQoNCiAgICBwdWJsaWMgTnVtYmVyIGRlbGV0ZUluTWVtb3J5KFN0b3JlUXVl\ncnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleGVjdXRvciwNCiAgICAgICAg\nT2JqZWN0W10gcGFyYW1zKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAg\nICBPYmplY3QgbyA9IGV4ZWN1dGUocSwgZXhlY3V0b3IsIHBhcmFtcyk7DQog\nICAgICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ29sbGVjdGlvbikpDQog\nICAgICAgICAgICAgICAgbyA9IENvbGxlY3Rpb25zLnNpbmdsZXRvbihvKTsN\nCg0KICAgICAgICAgICAgaW50IHNpemUgPSAwOw0KICAgICAgICAgICAgZm9y\nIChJdGVyYXRvciBpID0gKChDb2xsZWN0aW9uKSBvKS5pdGVyYXRvcigpOyBp\nLmhhc05leHQoKTsgc2l6ZSsrKQ0KICAgICAgICAgICAgICAgIF9icm9rZXIu\nZGVsZXRlKGkubmV4dCgpLCBudWxsKTsNCiAgICAgICAgICAgIHJldHVybiBO\ndW1iZXJzLnZhbHVlT2Yoc2l6ZSk7DQogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtlOw0KICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7DQogICAgICAgIH0NCiAgICB9DQoN\nCiAgICAvKioNCiAgICAgKiBVcGRhdGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBn\naXZlbiBjb21waWxhdGlvbiwgZXhlY3V0b3IsIGFuZCBwYXJhbWV0ZXINCiAg\nICAgKiB2YWx1ZXMuIEFsbCBvdGhlciBleGVjdXRlIG1ldGhvZHMgZGVsZWdh\ndGUgdG8gdGhpcyBvbmUgb3IgdG8NCiAgICAgKiB7QGxpbmsgI3VwZGF0ZShT\ndG9yZVF1ZXJ5LkV4ZWN1dG9yLE1hcCl9IGFmdGVyIHZhbGlkYXRpb24gYW5k\nIGxvY2tpbmcuDQogICAgICogVGhlIHJldHVybiB2YWx1ZSB3aWxsIGJlIGEg\nTnVtYmVyIGluZGljYXRpbmcgdGhlIG51bWJlciBvZg0KICAgICAqIGluc3Rh\nbmNlcyB1cGRhdGVkLg0KICAgICAqLw0KICAgIHByaXZhdGUgTnVtYmVyIHVw\nZGF0ZShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXgsIE9i\namVjdFtdIHBhcmFtcykNCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7DQog\nICAgICAgIGFzc2VydEJ1bGtNb2RpZnkocSwgZXgsIHBhcmFtcyk7DQogICAg\nICAgIHJldHVybiBleC5leGVjdXRlVXBkYXRlKHEsIHBhcmFtcyk7DQogICAg\nfQ0KDQogICAgcHVibGljIE51bWJlciB1cGRhdGVJbk1lbW9yeShTdG9yZVF1\nZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXhlY3V0b3IsDQogICAgICAg\nIE9iamVjdFtdIHBhcmFtcykgew0KICAgICAgICB0cnkgew0KICAgICAgICAg\nICAgT2JqZWN0IG8gPSBleGVjdXRlKHEsIGV4ZWN1dG9yLCBwYXJhbXMpOw0K\nICAgICAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIENvbGxlY3Rpb24pKQ0K\nICAgICAgICAgICAgICAgIG8gPSBDb2xsZWN0aW9ucy5zaW5nbGV0b24obyk7\nDQoNCiAgICAgICAgICAgIGludCBzaXplID0gMDsNCiAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaSA9ICgoQ29sbGVjdGlvbikgbykuaXRlcmF0b3IoKTsg\naS5oYXNOZXh0KCk7IHNpemUrKykNCiAgICAgICAgICAgICAgICB1cGRhdGVJ\nbk1lbW9yeShpLm5leHQoKSwgcGFyYW1zLCBxKTsNCiAgICAgICAgICAgIHJl\ndHVybiBOdW1iZXJzLnZhbHVlT2Yoc2l6ZSk7DQogICAgICAgIH0gY2F0Y2gg\nKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsNCiAgICAgICAgICAgIHRocm93IGtl\nOw0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgew0KICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oZSk7DQogICAgICAgIH0NCiAg\nICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgdGhlIHZhbHVlcyBmb3IgdGhl\nIHVwZGF0ZXMgaW4gbWVtb3J5Lg0KICAgICAqDQogICAgICogQHBhcmFtIG9i\nIHRoZSBwZXJzaXN0ZW50IGluc3RhbmNlIHRvIGNoYW5nZQ0KICAgICAqIEBw\nYXJhbSBwYXJhbXMgdGhlIHBhcmFtZXRlcnMgcGFzc2VkIHRvIHRoZSBxdWVy\neQ0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCB1cGRhdGVJbk1lbW9yeShP\nYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywgU3RvcmVRdWVyeSBxKSB7DQog\nICAgICAgIGZvciAoSXRlcmF0b3IgaXQgPSBnZXRVcGRhdGVzKCkuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOw0KICAgICAgICAgICAgaXQuaGFzTmV4dCgpOykg\new0KICAgICAgICAgICAgTWFwLkVudHJ5IGUgPSAoTWFwLkVudHJ5KSBpdC5u\nZXh0KCk7DQogICAgICAgICAgICBQYXRoIHBhdGggPSAoUGF0aCkgZS5nZXRL\nZXkoKTsNCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gKEZpZWxk\nTWV0YURhdGEpIHBhdGgubGFzdCgpOw0KICAgICAgICAgICAgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSA9IF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VyKG9iKTsN\nCg0KICAgICAgICAgICAgT2JqZWN0IHZhbDsNCiAgICAgICAgICAgIE9iamVj\ndCB2YWx1ZSA9IGUuZ2V0VmFsdWUoKTsNCiAgICAgICAgICAgIGlmICh2YWx1\nZSBpbnN0YW5jZW9mIFZhbCkgew0KICAgICAgICAgICAgICAgIHZhbCA9ICgo\nVmFsKSB2YWx1ZSkuDQogICAgICAgICAgICAgICAgICAgIGV2YWx1YXRlKG9i\nLCBudWxsLCBnZXRTdG9yZUNvbnRleHQoKSwgcGFyYW1zKTsNCiAgICAgICAg\nICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXRlcmFsKSB7DQog\nICAgICAgICAgICAgICAgdmFsID0gKChMaXRlcmFsKSB2YWx1ZSkuZ2V0VmFs\ndWUoKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2Vv\nZiBDb25zdGFudCkgew0KICAgICAgICAgICAgICAgIHZhbCA9ICgoQ29uc3Rh\nbnQpIHZhbHVlKS5nZXRWYWx1ZShwYXJhbXMpOw0KICAgICAgICAgICAgfSBl\nbHNlIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBxLmV2YWx1YXRlKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7\nDQogICAgICAgICAgICAgICAgfSBjYXRjaCAoVW5zdXBwb3J0ZWRFeGNlcHRp\nb24gZTEpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImZhaWwtdG8tZ2V0LXVwZGF0ZS12YWx1ZSIp\nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAg\nICAgICAgIGludCBpID0gZm1kLmdldEluZGV4KCk7DQogICAgICAgICAgICBQ\nZXJzaXN0ZW5jZUNhcGFibGUgaW50byA9IEltcGxIZWxwZXIudG9QZXJzaXN0\nZW5jZUNhcGFibGUob2IsDQogICAgICAgICAgICAgICAgX2Jyb2tlci5nZXRD\nb25maWd1cmF0aW9uKCkpOw0KDQogICAgICAgICAgICAvLyBzZXQgdGhlIGFj\ndHVhbCBmaWVsZCBpbiB0aGUgaW5zdGFuY2UNCiAgICAgICAgICAgIGludCBz\nZXQgPSBPcGVuSlBBU3RhdGVNYW5hZ2VyLlNFVF9VU0VSOw0KICAgICAgICAg\nICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7DQogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTjoNCiAgICAgICAg\nICAgICAgICAgICAgc20uc2V0dGluZ0Jvb2xlYW5GaWVsZChpbnRvLCBpLCBz\nbS5mZXRjaEJvb2xlYW5GaWVsZChpKSwNCiAgICAgICAgICAgICAgICAgICAg\nICAgIHZhbCA9PSBudWxsID8gZmFsc2UgOiAoKEJvb2xlYW4pIHZhbCkuYm9v\nbGVhblZhbHVlKCksDQogICAgICAgICAgICAgICAgICAgICAgICBzZXQpOw0K\nICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5CWVRFOg0KICAgICAgICAgICAgICAgICAgICBzbS5z\nZXR0aW5nQnl0ZUZpZWxkKGludG8sIGksIHNtLmZldGNoQnl0ZUZpZWxkKGkp\nLA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDog\nKChOdW1iZXIpIHZhbCkuYnl0ZVZhbHVlKCksIHNldCk7DQogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNIQVI6DQogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdDaGFy\nRmllbGQoaW50bywgaSwgc20uZmV0Y2hDaGFyRmllbGQoaSksDQogICAgICAg\nICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiB2YWwudG9TdHJp\nbmcoKS5jaGFyQXQoMCksIHNldCk7DQogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToN\nCiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0RvdWJsZUZpZWxkKGlu\ndG8sIGksIHNtLmZldGNoRG91YmxlRmllbGQoaSksDQogICAgICAgICAgICAg\nICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikgdmFsKS5k\nb3VibGVWYWx1ZSgpLCBzZXQpOw0KICAgICAgICAgICAgICAgICAgICBicmVh\nazsNCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoNCiAg\nICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0Zsb2F0RmllbGQoaW50bywg\naSwgc20uZmV0Y2hGbG9hdEZpZWxkKGkpLA0KICAgICAgICAgICAgICAgICAg\nICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuZmxvYXRW\nYWx1ZSgpLCBzZXQpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAg\nICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6DQogICAgICAgICAg\nICAgICAgICAgIHNtLnNldHRpbmdJbnRGaWVsZChpbnRvLCBpLCBzbS5mZXRj\naEludEZpZWxkKGkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09\nIG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuaW50VmFsdWUoKSwgc2V0KTsN\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuTE9ORzoNCiAgICAgICAgICAgICAgICAgICAgc20u\nc2V0dGluZ0xvbmdGaWVsZChpbnRvLCBpLCBzbS5mZXRjaExvbmdGaWVsZChp\nKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6\nICgoTnVtYmVyKSB2YWwpLmxvbmdWYWx1ZSgpLCBzZXQpOw0KICAgICAgICAg\nICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVDoNCiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ1No\nb3J0RmllbGQoaW50bywgaSwgc20uZmV0Y2hTaG9ydEZpZWxkKGkpLA0KICAg\nICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1i\nZXIpIHZhbCkuc2hvcnRWYWx1ZSgpLCBzZXQpOw0KICAgICAgICAgICAgICAg\nICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5T\nVFJJTkc6DQogICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTdHJpbmdG\naWVsZChpbnRvLCBpLCBzbS5mZXRjaFN0cmluZ0ZpZWxkKGkpLA0KICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyBudWxsIDogdmFsLnRv\nU3RyaW5nKCksIHNldCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0K\nICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6DQogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTlVNQkVSOg0KICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOg0KICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOg0KICAgICAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOg0KICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6DQogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRkxPQVRfT0JKOg0KICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLklOVF9PQko6DQogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9OR19PQko6DQogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuU0hPUlRfT0JKOg0KICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJJR0RFQ0lNQUw6DQogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQklHSU5URUdFUjoNCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5M\nT0NBTEU6DQogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOg0KICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9JRDoNCiAgICAg\nICAgICAgICAgICAgICAgc20uc2V0dGluZ09iamVjdEZpZWxkKGludG8sIGks\nIHNtLmZldGNoT2JqZWN0RmllbGQoaSksIHZhbCwNCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNldCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0K\nICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJvbmx5LXVwZGF0\nZS1wcmltaXRpdmVzIikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQog\nICAgfQ0KDQogICAgLyoqDQogICAgICogVHJhY2UgbG9nIHRoYXQgdGhlIHF1\nZXJ5IGlzIGV4ZWN1dGluZy4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZvaWQg\nbG9nRXhlY3V0aW9uKGludCBvcCwgTGlua2VkTWFwIHR5cGVzLCBPYmplY3Rb\nXSBwYXJhbXMpIHsNCiAgICAgICAgTWFwIHBtYXAgPSBDb2xsZWN0aW9ucy5F\nTVBUWV9NQVA7DQogICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMCkgew0K\nICAgICAgICAgICAgcG1hcCA9IG5ldyBIYXNoTWFwKChpbnQpIChwYXJhbXMu\nbGVuZ3RoICogMS4zMyArIDEpKTsNCiAgICAgICAgICAgIGlmICh0eXBlcyAh\nPSBudWxsICYmIHR5cGVzLnNpemUoKSA9PSBwYXJhbXMubGVuZ3RoKSB7DQog\nICAgICAgICAgICAgICAgaW50IGkgPSAwOw0KICAgICAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3IgaXRyID0gdHlwZXMua2V5U2V0KCkuaXRlcmF0b3IoKTsg\naXRyLmhhc05leHQoKTspDQogICAgICAgICAgICAgICAgICAgIHBtYXAucHV0\nKGl0ci5uZXh0KCksIHBhcmFtc1tpKytdKTsNCiAgICAgICAgICAgIH0gZWxz\nZSB7DQogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJh\nbXMubGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgICAgIHBtYXAucHV0\nKFN0cmluZy52YWx1ZU9mKGkpLCBwYXJhbXNbaV0pOw0KICAgICAgICAgICAg\nfQ0KICAgICAgICB9DQogICAgICAgIGxvZ0V4ZWN1dGlvbihvcCwgcG1hcCk7\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogVHJhY2UgbG9nIHRoYXQgdGhl\nIHF1ZXJ5IGlzIGV4ZWN1dGluZy4NCiAgICAgKi8NCiAgICBwcml2YXRlIHZv\naWQgbG9nRXhlY3V0aW9uKGludCBvcCwgTWFwIHBhcmFtcykgew0KICAgICAg\nICBTdHJpbmcgcyA9IF9xdWVyeTsNCiAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkocykpDQogICAgICAgICAgICBzID0gdG9TdHJpbmcoKTsNCg0K\nICAgICAgICBTdHJpbmcgbXNnID0gImV4ZWN1dGluZy1xdWVyeSI7DQogICAg\nICAgIGlmICghcGFyYW1zLmlzRW1wdHkoKSkNCiAgICAgICAgICAgIG1zZyAr\nPSAiLXdpdGgtcGFyYW1zIjsNCg0KICAgICAgICBfbG9nLnRyYWNlKF9sb2Mu\nZ2V0KG1zZywgcywgcGFyYW1zKSk7DQogICAgfQ0KDQogICAgLyoqDQogICAg\nICogUmV0dXJuIHdoZXRoZXIgdGhpcyBzaG91bGQgYmUgdHJlYXRlZCBhcyBh\nIHBvdGVudGlhbCBsYXJnZSByZXN1bHQgc2V0Lg0KICAgICAqLw0KICAgIHBy\naXZhdGUgYm9vbGVhbiBpc0xSUyhsb25nIHN0YXJ0LCBsb25nIGVuZCkgew0K\nICAgICAgICBsb25nIHJhbmdlID0gZW5kIC0gc3RhcnQ7DQogICAgICAgIHJl\ndHVybiBfZmMuZ2V0RmV0Y2hCYXRjaFNpemUoKSA+PSAwDQogICAgICAgICAg\nICAmJiAhKHJhbmdlIDw9IF9mYy5nZXRGZXRjaEJhdGNoU2l6ZSgpDQogICAg\nICAgICAgICB8fCAoX2ZjLmdldEZldGNoQmF0Y2hTaXplKCkgPT0gMCAmJiBy\nYW5nZSA8PSA1MCkpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVy\nbiB0aGUgcXVlcnkgcmVzdWx0IGZvciB0aGUgZ2l2ZW4gcmVzdWx0IG9iamVj\ndCBwcm92aWRlci4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRv\nUmVzdWx0KFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwg\nDQogICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwgU3RvcmVRdWVy\neS5SYW5nZSByYW5nZSkNCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7DQog\nICAgICAgIC8vIHBhY2sgcHJvamVjdGlvbnMgaWYgbmVjZXNzYXJ5DQogICAg\nICAgIFN0cmluZ1tdIGFsaWFzZXMgPSBleC5nZXRQcm9qZWN0aW9uQWxpYXNl\ncyhxKTsNCiAgICAgICAgaWYgKCFleC5pc1BhY2tpbmcocSkpIHsNCiAgICAg\nICAgICAgIFJlc3VsdFBhY2tlciBwYWNrZXIgPSBnZXRSZXN1bHRQYWNrZXIo\ncSwgZXgpOw0KICAgICAgICAgICAgaWYgKHBhY2tlciAhPSBudWxsIHx8IGFs\naWFzZXMubGVuZ3RoID09IDEpDQogICAgICAgICAgICAgICAgcm9wID0gbmV3\nIFBhY2tpbmdSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIHBhY2tlciwNCiAg\nICAgICAgICAgICAgICAgICAgYWxpYXNlcy5sZW5ndGgpOw0KICAgICAgICB9\nDQoNCiAgICAgICAgLy8gaWYgc2luZ2xlIHJlc3VsdCwgZXh0cmFjdCBpdA0K\nICAgICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUgfHwgKGFsaWFz\nZXMubGVuZ3RoID4gMA0KICAgICAgICAgICAgJiYgIWV4Lmhhc0dyb3VwaW5n\nKHEpICYmIGV4LmlzQWdncmVnYXRlKHEpKSkNCiAgICAgICAgICAgIHJldHVy\nbiBzaW5nbGVSZXN1bHQocm9wLCByYW5nZSk7DQoNCiAgICAgICAgLy8gbm93\nIHRoYXQgd2UndmUgZXhlY3V0ZWQgdGhlIHF1ZXJ5LCB3ZSBjYW4gY2FsbCBp\nc0FnZ3JlZ2F0ZSBhbmQNCiAgICAgICAgLy8gaGFzR3JvdXBpbmcgZWZmaWNp\nZW50bHkNCiAgICAgICAgYm9vbGVhbiBkZXRhY2ggPSAoX2Jyb2tlci5nZXRB\ndXRvRGV0YWNoKCkgJg0KICAgICAgICAgICAgQXV0b0RldGFjaC5ERVRBQ0hf\nTk9OVFhSRUFEKSA+IDAgJiYgIV9icm9rZXIuaXNBY3RpdmUoKTsNCiAgICAg\nICAgYm9vbGVhbiBscnMgPSByYW5nZS5scnMgJiYgIWV4LmlzQWdncmVnYXRl\nKHEpICYmICFleC5oYXNHcm91cGluZyhxKTsNCiAgICAgICAgUmVzdWx0TGlz\ndCByZXMgPSAoIWRldGFjaCAmJiBscnMpID8gX2ZjLm5ld1Jlc3VsdExpc3Qo\ncm9wKQ0KICAgICAgICAgICAgOiBuZXcgRWFnZXJSZXN1bHRMaXN0KHJvcCk7\nDQoNCiAgICAgICAgX3Jlc3VsdExpc3RzLmFkZChkZWNvcmF0ZVJlc3VsdExp\nc3QocmVzKSk7DQogICAgICAgIHJldHVybiByZXM7DQogICAgfQ0KDQogICAg\nLyoqDQogICAgICogT3B0aW9uYWxseSBkZWNvcmF0ZSB0aGUgbmF0aXZlIHJl\nc3VsdC4NCiAgICAgKi8NCiAgICBwcm90ZWN0ZWQgUmVzdWx0TGlzdCBkZWNv\ncmF0ZVJlc3VsdExpc3QoUmVzdWx0TGlzdCByZXMpIHsNCiAgICAgICAgcmV0\ndXJuIG5ldyBSZW1vdmVPbkNsb3NlUmVzdWx0TGlzdChyZXMpOw0KICAgIH0N\nCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIHJlc3VsdCBwYWNrZXIgZm9y\nIHRoaXMgcHJvamVjdGlvbiwgb3IgbnVsbC4NCiAgICAgKi8NCiAgICBwcml2\nYXRlIFJlc3VsdFBhY2tlciBnZXRSZXN1bHRQYWNrZXIoU3RvcmVRdWVyeSBx\nLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4KSB7DQogICAgICAgIGlmIChfcGFj\na2VyICE9IG51bGwpDQogICAgICAgICAgICByZXR1cm4gX3BhY2tlcjsNCg0K\nICAgICAgICBDbGFzcyByZXN1bHRDbGFzcyA9IChfcmVzdWx0Q2xhc3MgIT0g\nbnVsbCkgPyBfcmVzdWx0Q2xhc3MNCiAgICAgICAgICAgIDogZXguZ2V0UmVz\ndWx0Q2xhc3MocSk7DQogICAgICAgIGlmIChyZXN1bHRDbGFzcyA9PSBudWxs\nKQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgU3RyaW5n\nW10gYWxpYXNlcyA9IGV4LmdldFByb2plY3Rpb25BbGlhc2VzKHEpOw0KICAg\nICAgICBpZiAoYWxpYXNlcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAg\nLy8gcmVzdWx0IGNsYXNzIGJ1dCBubyByZXN1bHQ7IG1lYW5zIGNhbmRpZGF0\nZSBpcyBiZWluZyBzZXQNCiAgICAgICAgICAgIC8vIGludG8gc29tZSByZXN1\nbHQgY2xhc3MNCiAgICAgICAgICAgIF9wYWNrZXIgPSBuZXcgUmVzdWx0UGFj\na2VyKF9jbGFzcywgZ2V0QWxpYXMoKSwgcmVzdWx0Q2xhc3MpOw0KICAgICAg\nICB9IGVsc2UgaWYgKHJlc3VsdENsYXNzICE9IG51bGwpIHsNCiAgICAgICAg\nICAgIC8vIHByb2plY3Rpb24NCiAgICAgICAgICAgIENsYXNzW10gdHlwZXMg\nPSBleC5nZXRQcm9qZWN0aW9uVHlwZXMocSk7DQogICAgICAgICAgICBfcGFj\na2VyID0gbmV3IFJlc3VsdFBhY2tlcih0eXBlcywgYWxpYXNlcywgcmVzdWx0\nQ2xhc3MpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBfcGFja2VyOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZSBhbiBlbXB0eSByZXN1\nbHQgZm9yIHRoaXMgcXVlcnkuDQogICAgICovDQogICAgcHJpdmF0ZSBPYmpl\nY3QgZW1wdHlSZXN1bHQoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1\ndG9yIGV4KSB7DQogICAgICAgIGlmIChfdW5pcXVlID09IEJvb2xlYW4uVFJV\nRSB8fCAoX3VuaXF1ZSA9PSBudWxsDQogICAgICAgICAgICAmJiAhZXguaGFz\nR3JvdXBpbmcocSkgJiYgZXguaXNBZ2dyZWdhdGUocSkpKQ0KICAgICAgICAg\nICAgcmV0dXJuIG51bGw7DQogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5F\nTVBUWV9MSVNUOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEV4dHJhY3Qg\nYW4gZXhwZWN0ZWQgc2luZ2xlIHJlc3VsdCBmcm9tIHRoZSBnaXZlbiBwcm92\naWRlci4gVXNlZCB3aGVuDQogICAgICogdGhlIHJlc3VsdCBpcyBhbiB1bmdy\nb3VwZWQgYWdncmVnYXRlIG9yIHRoZSB1bmlxdWUgZmxhZyBpcyBzZXQgdG8g\ndHJ1ZS4NCiAgICAgKi8NCiAgICBwcml2YXRlIE9iamVjdCBzaW5nbGVSZXN1\nbHQoUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wLCANCiAgICAgICAgU3RvcmVR\ndWVyeS5SYW5nZSByYW5nZSkNCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nDQogICAgICAgIHJvcC5vcGVuKCk7DQogICAgICAgIHRyeSB7DQogICAgICAg\nICAgICAvLyBtb3ZlIHRvIGV4cGVjdGVkIHJlc3VsdA0KICAgICAgICAgICAg\nYm9vbGVhbiBuZXh0ID0gcm9wLm5leHQoKTsNCg0KICAgICAgICAgICAgLy8g\nZXh0cmFjdCBzaW5nbGUgcmVzdWx0OyB0aHJvdyBhbiBleGNlcHRpb24gaWYg\nbXVsdGlwbGUgcmVzdWx0cw0KICAgICAgICAgICAgLy8gbWF0Y2ggYW5kIG5v\ndCBjb25zdHJhaW50ZWQgYnkgcmFuZ2UsIG9yIGlmIGEgdW5pcXVlIHF1ZXJ5\nIHdpdGgNCiAgICAgICAgICAgIC8vIG5vIHJlc3VsdHMNCiAgICAgICAgICAg\nIE9iamVjdCBzaW5nbGUgPSBudWxsOw0KICAgICAgICAgICAgaWYgKG5leHQp\nIHsNCiAgICAgICAgICAgICAgICBzaW5nbGUgPSByb3AuZ2V0UmVzdWx0T2Jq\nZWN0KCk7DQogICAgICAgICAgICAgICAgaWYgKHJhbmdlLmVuZCAhPSByYW5n\nZS5zdGFydCArIDEgJiYgcm9wLm5leHQoKSkNCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJlc3VsdEV4Y2VwdGlvbihfbG9jLmdl\ndCgibm90LXVuaXF1ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICBfY2xh\nc3MsIF9xdWVyeSkpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChfdW5pcXVl\nID09IEJvb2xlYW4uVFJVRSkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTm9SZXN1bHRFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXJlc3VsdCIsIA0KICAg\nICAgICAgICAgICAgICAgICBfY2xhc3MsIF9xdWVyeSkpOw0KDQogICAgICAg\nICAgICAvLyBpZiB1bmlxdWUgc2V0IHRvIGZhbHNlLCB1c2UgY29sbGVjdGlv\nbg0KICAgICAgICAgICAgaWYgKF91bmlxdWUgPT0gQm9vbGVhbi5GQUxTRSkg\new0KICAgICAgICAgICAgICAgIGlmICghbmV4dCkNCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7DQogICAgICAg\nICAgICAgICAgLy8gQ29sbGVjdGlvbnMuc2luZ2xldG9uTGlzdCBpcyBKREsg\nMS4zLCBzby4uLg0KICAgICAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNM\naXN0KG5ldyBPYmplY3RbXXsgc2luZ2xlIH0pOw0KICAgICAgICAgICAgfQ0K\nICAgICAgICAgICAgDQogICAgICAgICAgICAvLyByZXR1cm4gc2luZ2xlIHJl\nc3VsdA0KICAgICAgICAgICAgcmV0dXJuIHNpbmdsZTsNCiAgICAgICAgfSBm\naW5hbGx5IHsNCiAgICAgICAgICAgIHJvcC5jbG9zZSgpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2FsY3VsYXRlcyB3aGV0aGVy\nIHRoZSBhY2Nlc3MgcGF0aCBvZiB0aGlzIHF1ZXJ5IGludGVyc2VjdHMgd2l0\naA0KICAgICAqIGFueSBkaXJ0eSBvYmplY3RzIGluIHRoZSB0cmFuc2FjdGlv\nbi4NCiAgICAgKi8NCiAgICBwcml2YXRlIGJvb2xlYW4gaXNBY2Nlc3NQYXRo\nRGlydHkoKSB7DQogICAgICAgIHJldHVybiBpc0FjY2Vzc1BhdGhEaXJ0eShf\nYnJva2VyLCBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKCkpOw0KICAgIH0NCg0K\nICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0FjY2Vzc1BhdGhEaXJ0eShC\ncm9rZXIgYnJva2VyLA0KICAgICAgICBDbGFzc01ldGFEYXRhW10gYWNjZXNz\nTWV0YXMpIHsNCiAgICAgICAgQ29sbGVjdGlvbiBwZXJzaXN0ZWQgPSBicm9r\nZXIuZ2V0UGVyc2lzdGVkVHlwZXMoKTsNCiAgICAgICAgQ29sbGVjdGlvbiB1\ncGRhdGVkID0gYnJva2VyLmdldFVwZGF0ZWRUeXBlcygpOw0KICAgICAgICBD\nb2xsZWN0aW9uIGRlbGV0ZWQgPSBicm9rZXIuZ2V0RGVsZXRlZFR5cGVzKCk7\nDQogICAgICAgIGlmIChwZXJzaXN0ZWQuaXNFbXB0eSgpICYmIHVwZGF0ZWQu\naXNFbXB0eSgpICYmIGRlbGV0ZWQuaXNFbXB0eSgpKQ0KICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOw0KDQogICAgICAgIC8vIGlmIG5vIGFjY2VzcyBtZXRh\ncywgYXNzdW1lIGV2ZXJ5IGRpcnR5IG9iamVjdCBhZmZlY3RzIHBhdGgganVz\ndA0KICAgICAgICAvLyB0byBiZSBzYWZlDQogICAgICAgIGlmIChhY2Nlc3NN\nZXRhcy5sZW5ndGggPT0gMCkNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0K\nDQogICAgICAgIC8vIGNvbXBhcmUgZGlydHkgY2xhc3NlcyB0byB0aGUgYWNj\nZXNzIHBhdGggY2xhc3Nlcw0KICAgICAgICBDbGFzcyBhY2NDbGFzczsNCiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhY2Nlc3NNZXRhcy5sZW5ndGg7\nIGkrKykgew0KICAgICAgICAgICAgLy8gc2hvcnRjdXQgaWYgYWN0dWFsIGNs\nYXNzIGlzIGRpcnR5DQogICAgICAgICAgICBhY2NDbGFzcyA9IGFjY2Vzc01l\ndGFzW2ldLmdldERlc2NyaWJlZFR5cGUoKTsNCiAgICAgICAgICAgIGlmIChw\nZXJzaXN0ZWQuY29udGFpbnMoYWNjQ2xhc3MpIHx8IHVwZGF0ZWQuY29udGFp\nbnMoYWNjQ2xhc3MpDQogICAgICAgICAgICAgICAgfHwgZGVsZXRlZC5jb250\nYWlucyhhY2NDbGFzcykpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nDQoNCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBkaXJ0eSBzdWJjbGFzcw0K\nICAgICAgICAgICAgZm9yIChJdGVyYXRvciBkaXJ0eSA9IHBlcnNpc3RlZC5p\ndGVyYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQ0KICAgICAgICAgICAgICAg\nIGlmIChhY2NDbGFzcy5pc0Fzc2lnbmFibGVGcm9tKChDbGFzcykgZGlydHku\nbmV4dCgpKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gdXBkYXRlZC5pdGVy\nYXRvcigpOyBkaXJ0eS5oYXNOZXh0KCk7KQ0KICAgICAgICAgICAgICAgIGlm\nIChhY2NDbGFzcy5pc0Fzc2lnbmFibGVGcm9tKChDbGFzcykgZGlydHkubmV4\ndCgpKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAg\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGRpcnR5ID0gZGVsZXRlZC5pdGVyYXRv\ncigpOyBkaXJ0eS5oYXNOZXh0KCk7KQ0KICAgICAgICAgICAgICAgIGlmIChh\nY2NDbGFzcy5pc0Fzc2lnbmFibGVGcm9tKChDbGFzcykgZGlydHkubmV4dCgp\nKSkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAg\nIH0NCg0KICAgICAgICAvLyBubyBpbnRlcnNlY3Rpb24NCiAgICAgICAgcmV0\ndXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHB1YmxpYyB2b2lkIGNsb3NlQWxs\nKCkgew0KICAgICAgICBjbG9zZVJlc3VsdHModHJ1ZSk7DQogICAgfQ0KDQog\nICAgcHVibGljIHZvaWQgY2xvc2VSZXNvdXJjZXMoKSB7DQogICAgICAgIGNs\nb3NlUmVzdWx0cyhmYWxzZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nQ2xvc2Ugb3BlbiByZXN1bHRzLg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9p\nZCBjbG9zZVJlc3VsdHMoYm9vbGVhbiBmb3JjZSkgew0KICAgICAgICBsb2Nr\nKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnRPcGVuKCk7\nDQoNCiAgICAgICAgICAgIFJlbW92ZU9uQ2xvc2VSZXN1bHRMaXN0IHJlczsN\nCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX3Jlc3VsdExpc3Rz\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7DQogICAgICAgICAgICAg\nICAgcmVzID0gKFJlbW92ZU9uQ2xvc2VSZXN1bHRMaXN0KSBpdHIubmV4dCgp\nOw0KICAgICAgICAgICAgICAgIGlmIChmb3JjZSB8fCByZXMuaXNQcm92aWRl\nck9wZW4oKSkNCiAgICAgICAgICAgICAgICAgICAgcmVzLmNsb3NlKGZhbHNl\nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIF9yZXN1bHRMaXN0cy5j\nbGVhcigpOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5s\nb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgU3RyaW5n\nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhNYXAgcGFyYW1zKSB7DQogICAgICAg\nIGlmIChwYXJhbXMgPT0gbnVsbCkNCiAgICAgICAgICAgIHBhcmFtcyA9IENv\nbGxlY3Rpb25zLkVNUFRZX01BUDsNCg0KICAgICAgICBsb2NrKCk7DQogICAg\nICAgIHRyeSB7DQogICAgICAgICAgICBhc3NlcnROb3RTZXJpYWxpemVkKCk7\nDQogICAgICAgICAgICBhc3NlcnRPcGVuKCk7DQoNCiAgICAgICAgICAgIFN0\nb3JlUXVlcnkuRXhlY3V0b3IgZXggPSBjb21waWxlRm9yRXhlY3V0b3IoKTsN\nCiAgICAgICAgICAgIE9iamVjdFtdIGFyciA9IHRvUGFyYW1ldGVyQXJyYXko\nZXguZ2V0UGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpLA0KICAgICAgICAg\nICAgICAgIHBhcmFtcyk7DQogICAgICAgICAgICBhc3NlcnRQYXJhbWV0ZXJz\nKF9zdG9yZVF1ZXJ5LCBleCwgYXJyKTsNCiAgICAgICAgICAgIFN0b3JlUXVl\ncnkuUmFuZ2UgcmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZShfc3RhcnRJ\nZHgsIF9lbmRJZHgpOw0KICAgICAgICAgICAgaWYgKCFfcmFuZ2VTZXQpDQog\nICAgICAgICAgICAgICAgZXguZ2V0UmFuZ2UoX3N0b3JlUXVlcnksIGFyciwg\ncmFuZ2UpOw0KICAgICAgICAgICAgcmV0dXJuIGV4LmdldERhdGFTdG9yZUFj\ndGlvbnMoX3N0b3JlUXVlcnksIGFyciwgcmFuZ2UpOw0KICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7DQogICAgICAgICAgICB0aHJv\ndyBrZTsNCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsNCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGUpOw0KICAgICAgICB9\nIGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7DQogICAgICAgIH0N\nCiAgICB9DQoNCiAgICBwdWJsaWMgYm9vbGVhbiBzZXRRdWVyeShPYmplY3Qg\ncXVlcnkpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAg\nICAgICAgICAgYXNzZXJ0T3BlbigpOw0KICAgICAgICAgICAgYXNzZXJ0Tm90\nUmVhZE9ubHkoKTsNCg0KICAgICAgICAgICAgaWYgKHF1ZXJ5ID09IG51bGwg\nfHwgcXVlcnkgaW5zdGFuY2VvZiBTdHJpbmcpIHsNCiAgICAgICAgICAgICAg\nICBpbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsNCiAgICAgICAgICAgICAgICBf\ncXVlcnkgPSAoU3RyaW5nKSBxdWVyeTsNCiAgICAgICAgICAgICAgICBpZiAo\nX3F1ZXJ5ICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIF9xdWVyeSA9\nIF9xdWVyeS50cmltKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIShxdWVyeSBpbnN0\nYW5jZW9mIFF1ZXJ5SW1wbCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIF9z\ndG9yZVF1ZXJ5LnNldFF1ZXJ5KHF1ZXJ5KTsNCg0KICAgICAgICAgICAgLy8g\nY29weSBhbGwgbm9uLXRyYW5zaWVudCBzdGF0ZSBmcm9tIHRoZSBnaXZlbiBx\ndWVyeQ0KICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7DQog\nICAgICAgICAgICBRdWVyeUltcGwgcSA9IChRdWVyeUltcGwpIHF1ZXJ5Ow0K\nICAgICAgICAgICAgX2NsYXNzID0gcS5fY2xhc3M7DQogICAgICAgICAgICBf\nc3ViY2xhc3NlcyA9IHEuX3N1YmNsYXNzZXM7DQogICAgICAgICAgICBfcXVl\ncnkgPSBxLl9xdWVyeTsNCiAgICAgICAgICAgIF9pZ25vcmVDaGFuZ2VzID0g\ncS5faWdub3JlQ2hhbmdlczsNCiAgICAgICAgICAgIF91bmlxdWUgPSBxLl91\nbmlxdWU7DQogICAgICAgICAgICBfcmVzdWx0Q2xhc3MgPSBxLl9yZXN1bHRD\nbGFzczsNCiAgICAgICAgICAgIF9wYXJhbXMgPSBxLl9wYXJhbXM7DQogICAg\nICAgICAgICBfcmVzdWx0TWFwcGluZ1Njb3BlID0gcS5fcmVzdWx0TWFwcGlu\nZ1Njb3BlOw0KICAgICAgICAgICAgX3Jlc3VsdE1hcHBpbmdOYW1lID0gcS5f\ncmVzdWx0TWFwcGluZ05hbWU7DQogICAgICAgICAgICBfcmVhZE9ubHkgPSBx\nLl9yZWFkT25seTsNCg0KICAgICAgICAgICAgLy8gZG9uJ3Qgc2hhcmUgbXV0\nYWJsZSBvYmplY3RzDQogICAgICAgICAgICBfZmMuY29weShxLl9mYyk7DQog\nICAgICAgICAgICBpZiAocS5fZmlsdExpc3RlbmVycyAhPSBudWxsKQ0KICAg\nICAgICAgICAgICAgIF9maWx0TGlzdGVuZXJzID0gbmV3IEhhc2hNYXAocS5f\nZmlsdExpc3RlbmVycyk7DQogICAgICAgICAgICBpZiAocS5fYWdnTGlzdGVu\nZXJzICE9IG51bGwpDQogICAgICAgICAgICAgICAgX2FnZ0xpc3RlbmVycyA9\nIG5ldyBIYXNoTWFwKHEuX2FnZ0xpc3RlbmVycyk7DQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAg\nIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIFN0\ncmluZyBnZXRBbGlhcygpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAgICB0\ncnkgew0KICAgICAgICAgICAgU3RyaW5nIGFsaWFzID0gY29tcGlsZUZvckV4\nZWN1dG9yKCkuZ2V0QWxpYXMoX3N0b3JlUXVlcnkpOw0KICAgICAgICAgICAg\naWYgKGFsaWFzID09IG51bGwpDQogICAgICAgICAgICAgICAgYWxpYXMgPSBT\ndHJpbmdzLmdldENsYXNzTmFtZShfY2xhc3MpOw0KICAgICAgICAgICAgcmV0\ndXJuIGFsaWFzOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAg\ndW5sb2NrKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMoKSB7DQogICAgICAgIGxvY2so\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBjb21waWxl\nRm9yRXhlY3V0b3IoKS5nZXRQcm9qZWN0aW9uQWxpYXNlcyhfc3RvcmVRdWVy\neSk7DQogICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2so\nKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBDbGFzc1tdIGdl\ndFByb2plY3Rpb25UeXBlcygpIHsNCiAgICAgICAgbG9jaygpOw0KICAgICAg\nICB0cnkgew0KICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRv\ncigpLmdldFByb2plY3Rpb25UeXBlcyhfc3RvcmVRdWVyeSk7DQogICAgICAg\nIH0gZmluYWxseSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAg\nfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBpbnQgZ2V0T3BlcmF0aW9uKCkgew0K\nICAgICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBy\nZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0T3BlcmF0aW9uKF9zdG9y\nZVF1ZXJ5KTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIHVu\nbG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGJvb2xl\nYW4gaXNBZ2dyZWdhdGUoKSB7DQogICAgICAgIGxvY2soKTsNCiAgICAgICAg\ndHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3Io\nKS5pc0FnZ3JlZ2F0ZShfc3RvcmVRdWVyeSk7DQogICAgICAgIH0gZmluYWxs\neSB7DQogICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0N\nCg0KICAgIHB1YmxpYyBib29sZWFuIGhhc0dyb3VwaW5nKCkgew0KICAgICAg\nICBsb2NrKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4g\nY29tcGlsZUZvckV4ZWN1dG9yKCkuaGFzR3JvdXBpbmcoX3N0b3JlUXVlcnkp\nOw0KICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgdW5sb2NrKCk7\nDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0\nYVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoKSB7DQogICAgICAgIGxvY2so\nKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIENsYXNzTWV0YURhdGFb\nXSBtZXRhcyA9IGNvbXBpbGVGb3JFeGVjdXRvcigpLg0KICAgICAgICAgICAg\nICAgIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoX3N0b3JlUXVlcnkpOw0KICAg\nICAgICAgICAgcmV0dXJuIChtZXRhcyA9PSBudWxsKSA/IFN0b3JlUXVlcnku\nRU1QVFlfTUVUQVMgOiBtZXRhczsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAg\nICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAg\ncHVibGljIExpbmtlZE1hcCBnZXRQYXJhbWV0ZXJUeXBlcygpIHsNCiAgICAg\nICAgbG9jaygpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJu\nIGNvbXBpbGVGb3JFeGVjdXRvcigpLmdldFBhcmFtZXRlclR5cGVzKF9zdG9y\nZVF1ZXJ5KTsNCiAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgIHVu\nbG9jaygpOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIE1hcCBn\nZXRVcGRhdGVzKCkgew0KICAgICAgICBsb2NrKCk7DQogICAgICAgIHRyeSB7\nDQogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0\nVXBkYXRlcyhfc3RvcmVRdWVyeSk7DQogICAgICAgIH0gZmluYWxseSB7DQog\nICAgICAgICAgICB1bmxvY2soKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIHB1YmxpYyB2b2lkIGxvY2soKSB7DQogICAgICAgIGlmIChfbG9jayAhPSBu\ndWxsKQ0KICAgICAgICAgICAgX2xvY2subG9jaygpOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyB2b2lkIHVubG9jaygpIHsNCiAgICAgICAgaWYgKF9sb2NrICE9\nIG51bGwgJiYgX2xvY2suaXNMb2NrZWQoKSkNCiAgICAgICAgICAgIF9sb2Nr\nLnVubG9jaygpOw0KICAgIH0NCg0KICAgIC8vLy8vLy8vLw0KICAgIC8vIFV0\naWxzDQogICAgLy8vLy8vLy8vDQoNCiAgICBwdWJsaWMgQ2xhc3MgY2xhc3NG\nb3JOYW1lKFN0cmluZyBuYW1lLCBTdHJpbmdbXSBpbXBvcnRzKSB7DQogICAg\nICAgIC8vIGZ1bGwgY2xhc3MgbmFtZSBvciBwcmltaXRpdmUgdHlwZT8NCiAg\nICAgICAgQ2xhc3MgdHlwZSA9IHRvQ2xhc3MobmFtZSk7DQogICAgICAgIGlm\nICh0eXBlICE9IG51bGwpDQogICAgICAgICAgICByZXR1cm4gdHlwZTsNCg0K\nICAgICAgICAvLyBmaXJzdCBjaGVjayB0aGUgYWxpYXNlcyBtYXAgaW4gdGhl\nIE1ldGFEYXRhUmVwb3NpdG9yeQ0KICAgICAgICBDbGFzc0xvYWRlciBsb2Fk\nZXIgPSAoX2NsYXNzID09IG51bGwpID8gX2xvYWRlcg0KICAgICAgICAgICAg\nOiAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKA0KICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9h\nZGVyQWN0aW9uKF9jbGFzcykpOyANCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBt\nZXRhID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuDQogICAgICAgICAg\nICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdldE1ldGFEYXRh\nKG5hbWUsIGxvYWRlciwgZmFsc2UpOw0KICAgICAgICBpZiAobWV0YSAhPSBu\ndWxsKQ0KICAgICAgICAgICAgcmV0dXJuIG1ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpOw0KDQogICAgICAgIC8vIHRyeSB0aGUgbmFtZSBpbiB0aGUgcGFja2Fn\nZSBvZiB0aGUgY2FuZGlkYXRlIGNsYXNzDQogICAgICAgIGlmIChfY2xhc3Mg\nIT0gbnVsbCkgew0KICAgICAgICAgICAgU3RyaW5nIGZ1bGxOYW1lID0gX2Ns\nYXNzLmdldE5hbWUoKS5zdWJzdHJpbmcNCiAgICAgICAgICAgICAgICAoMCwg\nX2NsYXNzLmdldE5hbWUoKS5sYXN0SW5kZXhPZignLicpICsgMSkgKyBuYW1l\nOw0KICAgICAgICAgICAgdHlwZSA9IHRvQ2xhc3MoZnVsbE5hbWUpOw0KICAg\nICAgICAgICAgaWYgKHR5cGUgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHlwZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHRyeSBqYXZh\nLmxhbmcNCiAgICAgICAgdHlwZSA9IHRvQ2xhc3MoImphdmEubGFuZy4iICsg\nbmFtZSk7DQogICAgICAgIGlmICh0eXBlICE9IG51bGwpDQogICAgICAgICAg\nICByZXR1cm4gdHlwZTsNCg0KICAgICAgICAvLyB0cnkgZWFjaCBpbXBvcnQN\nCiAgICAgICAgaWYgKGltcG9ydHMgIT0gbnVsbCAmJiBpbXBvcnRzLmxlbmd0\naCA+IDApIHsNCiAgICAgICAgICAgIFN0cmluZyBkb3ROYW1lID0gIi4iICsg\nbmFtZTsNCiAgICAgICAgICAgIFN0cmluZyBpbXBvcnROYW1lOw0KICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpbXBvcnRzLmxlbmd0aDsgaSsr\nKSB7DQogICAgICAgICAgICAgICAgaW1wb3J0TmFtZSA9IGltcG9ydHNbaV07\nDQoNCiAgICAgICAgICAgICAgICAvLyBmdWxsIGNsYXNzIG5hbWUgaW1wb3J0\nDQogICAgICAgICAgICAgICAgaWYgKGltcG9ydE5hbWUuZW5kc1dpdGgoZG90\nTmFtZSkpDQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSB0b0NsYXNzKGlt\ncG9ydE5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAvLyB3aWxkY2FyZDsg\nc3RyaXAgdG8gcGFja2FnZQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlt\ncG9ydE5hbWUuZW5kc1dpdGgoIi4qIikpIHsNCiAgICAgICAgICAgICAgICAg\nICAgaW1wb3J0TmFtZSA9IGltcG9ydE5hbWUuc3Vic3RyaW5nDQogICAgICAg\nICAgICAgICAgICAgICAgICAoMCwgaW1wb3J0TmFtZS5sZW5ndGgoKSAtIDEp\nOw0KICAgICAgICAgICAgICAgICAgICB0eXBlID0gdG9DbGFzcyhpbXBvcnRO\nYW1lICsgbmFtZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAg\nICAgIGlmICh0eXBlICE9IG51bGwpDQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB0eXBlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAg\nIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVy\nbiB0aGUge0BsaW5rIENsYXNzfSBmb3IgdGhlIGdpdmVuIG5hbWUsIG9yIG51\nbGwgaWYgbmFtZSBub3QgdmFsaWQuDQogICAgICovDQogICAgcHJpdmF0ZSBD\nbGFzcyB0b0NsYXNzKFN0cmluZyBuYW1lKSB7DQogICAgICAgIGlmIChfbG9h\nZGVyID09IG51bGwpDQogICAgICAgICAgICBfbG9hZGVyID0gX2Jyb2tlci5n\nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q2xhc3NSZXNvbHZlckluc3RhbmNlKCku\nDQogICAgICAgICAgICAgICAgZ2V0Q2xhc3NMb2FkZXIoX2NsYXNzLCBfYnJv\na2VyLmdldENsYXNzTG9hZGVyKCkpOw0KICAgICAgICB0cnkgew0KICAgICAg\nICAgICAgcmV0dXJuIFN0cmluZ3MudG9DbGFzcyhuYW1lLCBfbG9hZGVyKTsN\nCiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgew0KICAg\nICAgICB9IGNhdGNoIChOb0NsYXNzRGVmRm91bmRFcnJvciBuY2RmZSkgew0K\nICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAg\nIHB1YmxpYyB2b2lkIGFzc2VydE9wZW4oKSB7DQogICAgICAgIGlmIChfYnJv\na2VyICE9IG51bGwpDQogICAgICAgICAgICBfYnJva2VyLmFzc2VydE9wZW4o\nKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb3RSZWFkT25s\neSgpIHsNCiAgICAgICAgaWYgKF9yZWFkT25seSkNCiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQoInJlYWQt\nb25seSIpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb3RT\nZXJpYWxpemVkKCkgew0KICAgICAgICBpZiAoX2Jyb2tlciA9PSBudWxsKQ0K\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgic2VyaWFsaXplZCIpKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBDaGVjayB0aGF0IGEgY2FuZGlkYXRlIGNsYXNzIGhhcyBiZWVuIHNl\ndCBmb3IgdGhlIHF1ZXJ5Lg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9pZCBh\nc3NlcnRDYW5kaWRhdGVUeXBlKCkgew0KICAgICAgICBpZiAoX2NsYXNzID09\nIG51bGwgJiYgX3N0b3JlUXVlcnkucmVxdWlyZXNDYW5kaWRhdGVUeXBlKCkp\nDQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1jbGFzcyIpKTsNCiAgICB9DQoNCiAgICAvKioNCiAg\nICAgKiBDaGVjayB0aGF0IHdlIGFyZSBpbiBhIHN0YXRlIHRvIGJlIGFibGUg\ndG8gcGVyZm9ybSBhIGJ1bGsgb3BlcmF0aW9uOw0KICAgICAqIGFsc28gZmx1\nc2ggdGhlIGN1cnJlbnQgbW9kZmljYXRpb25zIGlmIGFueSBlbGVtZW50cyBh\ncmUgY3VycmVudGx5IGRpcnR5Lg0KICAgICAqLw0KICAgIHByaXZhdGUgdm9p\nZCBhc3NlcnRCdWxrTW9kaWZ5KFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5F\neGVjdXRvciBleCwgDQogICAgICAgIE9iamVjdFtdIHBhcmFtcykgew0KICAg\nICAgICBfYnJva2VyLmFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7DQogICAg\nICAgIGlmIChfc3RhcnRJZHggIT0gMCB8fCBfZW5kSWR4ICE9IExvbmcuTUFY\nX1ZBTFVFKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vLW1vZGlmeS1yYW5nZSIpKTsNCiAgICAgICAgaWYgKF9y\nZXN1bHRDbGFzcyAhPSBudWxsKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLW1vZGlmeS1yZXN1bHRjbGFzcyIp\nKTsNCiAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByYW5nZSA9IG5ldyBTdG9y\nZVF1ZXJ5LlJhbmdlKCk7DQogICAgICAgIGV4LmdldFJhbmdlKHEsIHBhcmFt\ncywgcmFuZ2UpOw0KICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gMCB8fCBy\nYW5nZS5lbmQgIT0gTG9uZy5NQVhfVkFMVUUpDQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tbW9kaWZ5LXJhbmdl\nIikpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyB0aGF0IHRo\nZSBwYXNzZWQgcGFyYW1ldGVycyBtYXRjaCB0aGUgZGVjbGFyYXRpb25zLg0K\nICAgICAqLw0KICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydFBhcmFtZXRlcnMo\nU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4LCANCiAgICAg\nICAgT2JqZWN0W10gcGFyYW1zKSB7DQogICAgICAgIGlmICghcS5yZXF1aXJl\nc1BhcmFtZXRlckRlY2xhcmF0aW9ucygpKQ0KICAgICAgICAgICAgcmV0dXJu\nOw0KDQogICAgICAgIExpbmtlZE1hcCBwYXJhbVR5cGVzID0gZXguZ2V0UGFy\nYW1ldGVyVHlwZXMocSk7DQogICAgICAgIGludCB0eXBlQ291bnQgPSBwYXJh\nbVR5cGVzLnNpemUoKTsNCiAgICAgICAgaWYgKHR5cGVDb3VudCA+IHBhcmFt\ncy5sZW5ndGgpDQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgidW5ib3VuZC1wYXJhbXMiLA0KICAgICAgICAgICAgICAg\nIHBhcmFtVHlwZXMua2V5U2V0KCkpKTsNCg0KICAgICAgICBJdGVyYXRvciBp\ndHIgPSBwYXJhbVR5cGVzLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsNCiAgICAg\nICAgTWFwLkVudHJ5IGVudHJ5Ow0KICAgICAgICBmb3IgKGludCBpID0gMDsg\naXRyLmhhc05leHQoKTsgaSsrKSB7DQogICAgICAgICAgICBlbnRyeSA9IChN\nYXAuRW50cnkpIGl0ci5uZXh0KCk7DQogICAgICAgICAgICBpZiAoKChDbGFz\ncykgZW50cnkuZ2V0VmFsdWUoKSkuaXNQcmltaXRpdmUoKSAmJiBwYXJhbXNb\naV0gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibnVsbC1wcmltaXRpdmUtcGFyYW0iLA0KICAg\nICAgICAgICAgICAgICAgICBlbnRyeS5nZXRLZXkoKSkpOw0KICAgICAgICB9\nDQogICAgfQ0KDQogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsNCiAg\nICAgICAgU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIoNjQp\nOw0KICAgICAgICBidWYuYXBwZW5kKCJRdWVyeTogIikuYXBwZW5kKHN1cGVy\nLnRvU3RyaW5nKCkpOw0KICAgICAgICBidWYuYXBwZW5kKCI7IGNhbmRpZGF0\nZSBjbGFzczogIikuYXBwZW5kKF9jbGFzcyk7DQogICAgICAgIGJ1Zi5hcHBl\nbmQoIjsgcXVlcnk6ICIpLmFwcGVuZChfcXVlcnkpOw0KICAgICAgICByZXR1\ncm4gYnVmLnRvU3RyaW5nKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog\nU3RydWN0IG9mIGNvbXBpbGVkIHF1ZXJ5IHByb3BlcnRpZXMuDQogICAgICov\nDQogICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBDb21waWxhdGlvbg0KICAg\nICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7DQoNCiAgICAgICAgcHVi\nbGljIFN0b3JlUXVlcnkuRXhlY3V0b3IgbWVtb3J5ID0gbnVsbDsNCiAgICAg\nICAgcHVibGljIFN0b3JlUXVlcnkuRXhlY3V0b3IgZGF0YXN0b3JlID0gbnVs\nbDsNCiAgICAgICAgcHVibGljIE9iamVjdCBzdG9yZURhdGEgPSBudWxsOw0K\nICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFN0cnVjdCB0byBob2xkIHRoZSB1\nbnBhcnNlZCBwcm9wZXJ0aWVzIGFzc29jaWF0ZWQgd2l0aCBhIHF1ZXJ5Lg0K\nICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENvbXBpbGF0aW9u\nS2V5DQogICAgICAgIGltcGxlbWVudHMgU2VyaWFsaXphYmxlIHsNCg0KICAg\nICAgICBwdWJsaWMgQ2xhc3MgcXVlcnlUeXBlID0gbnVsbDsNCiAgICAgICAg\ncHVibGljIENsYXNzIGNhbmRpZGF0ZVR5cGUgPSBudWxsOw0KICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBzdWJjbGFzc2VzID0gdHJ1ZTsNCiAgICAgICAgcHVi\nbGljIFN0cmluZyBxdWVyeSA9IG51bGw7DQogICAgICAgIHB1YmxpYyBTdHJp\nbmcgbGFuZ3VhZ2UgPSBudWxsOw0KICAgICAgICBwdWJsaWMgT2JqZWN0IHN0\nb3JlS2V5ID0gbnVsbDsNCg0KICAgICAgICBwdWJsaWMgaW50IGhhc2hDb2Rl\nKCkgew0KICAgICAgICAgICAgaW50IHJzID0gMTc7DQogICAgICAgICAgICBy\ncyA9IDM3ICogcnMgKyAoKHF1ZXJ5VHlwZSA9PSBudWxsKSA/IDAgOiBxdWVy\neVR5cGUuaGFzaENvZGUoKSk7DQogICAgICAgICAgICBycyA9IDM3ICogcnMg\nKyAoKHF1ZXJ5ID09IG51bGwpID8gMCA6IHF1ZXJ5Lmhhc2hDb2RlKCkpOw0K\nICAgICAgICAgICAgcnMgPSAzNyAqIHJzICsgKChsYW5ndWFnZSA9PSBudWxs\nKSA/IDAgOiBsYW5ndWFnZS5oYXNoQ29kZSgpKTsNCiAgICAgICAgICAgIHJz\nID0gMzcgKiBycyArICgoc3RvcmVLZXkgPT0gbnVsbCkgPyAwIDogc3RvcmVL\nZXkuaGFzaENvZGUoKSk7DQogICAgICAgICAgICBpZiAoc3ViY2xhc3NlcykN\nCiAgICAgICAgICAgICAgcnMrKzsNCiAgICAgICAgICAgIHJldHVybiByczsN\nCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhP\nYmplY3Qgb3RoZXIpIHsNCiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlz\nKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAg\naWYgKG90aGVyID09IG51bGwgfHwgb3RoZXIuZ2V0Q2xhc3MoKSAhPSBnZXRD\nbGFzcygpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAg\nICAgICAgICAgQ29tcGlsYXRpb25LZXkga2V5ID0gKENvbXBpbGF0aW9uS2V5\nKSBvdGhlcjsNCiAgICAgICAgICAgIGlmIChrZXkucXVlcnlUeXBlICE9IHF1\nZXJ5VHlwZQ0KICAgICAgICAgICAgICAgIHx8ICFTdHJpbmdVdGlscy5lcXVh\nbHMoa2V5LnF1ZXJ5LCBxdWVyeSkNCiAgICAgICAgICAgICAgICB8fCAhU3Ry\naW5nVXRpbHMuZXF1YWxzKGtleS5sYW5ndWFnZSwgbGFuZ3VhZ2UpKQ0KICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIGlmIChr\nZXkuc3ViY2xhc3NlcyAhPSBzdWJjbGFzc2VzKQ0KICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIGlmICghT2JqZWN0VXRpbHMu\nZXF1YWxzKGtleS5zdG9yZUtleSwgc3RvcmVLZXkpKQ0KICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICAgICAgLy8gYWxsb3cgZWl0\naGVyIGNhbmRpZGF0ZSB0eXBlIHRvIGJlIG51bGwgYmVjYXVzZSBpdCBtaWdo\ndCBiZQ0KICAgICAgICAgICAgLy8gZW5jb2RlZCBpbiB0aGUgcXVlcnkgc3Ry\naW5nLCBidXQgaWYgYm90aCBhcmUgc2V0IHRoZW4gdGhleQ0KICAgICAgICAg\nICAgLy8gbXVzdCBiZSBlcXVhbA0KICAgICAgICAgICAgcmV0dXJuIGtleS5j\nYW5kaWRhdGVUeXBlID09IG51bGwgfHwgY2FuZGlkYXRlVHlwZSA9PSBudWxs\nDQogICAgICAgICAgICAgICAgfHwga2V5LmNhbmRpZGF0ZVR5cGUgPT0gY2Fu\nZGlkYXRlVHlwZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAg\nICAqIEEgbWVyZ2VkIGV4ZWN1dG9yIGV4ZWN1dGVzIG11bHRpcGxlIFF1ZXJp\nZXMgYW5kIHJldHVybnMNCiAgICAgKiBhIG1lcmdlZCByZXN1bHQgbGlzdCB3\naXRoIHRoZSBhcHByb3ByaWF0ZSBvcmRlcmluZyAoaWYgbW9yZSB0aGFuDQog\nICAgICogb25lIHF1ZXJ5IG5lZWRzIHRvIGJlIGV4ZWN1dGVkKS4gVGhpcyBl\neGVjdXRvciBoYXMgdGhlIGZvbGxvd2luZw0KICAgICAqIGxpbWl0YXRpb25z\nOg0KICAgICAqIDx1bD4NCiAgICAgKiA8bGk+SXQgY2Fubm90IGNvbWJpbmUg\nYWdncmVnYXRlcy4NCiAgICAgKiA8bGk+SXQgY2Fubm90IGNvbGxhdGUgdGhl\nIHJlc3VsdCBsaXN0cyBpZiBvcmRlcmluZyBpcyBzcGVjaWZpZWQgYW5kDQog\nICAgICogYSByZXN1bHQgc3RyaW5nIGlzIGdpdmVuLCBidXQgZG9lcyBub3Qg\naW5jbHVkZSB0aGUgb3JkZXJpbmcNCiAgICAgKiBjcml0ZXJpYS48L2xpPg0K\nICAgICAqIDxsaT5JdCBjYW5ub3QgZmlsdGVyIGR1cGxpY2F0ZSByZXN1bHRz\nIGZyb20gZGlmZmVyZW50IHJlc3VsdCBsaXN0cyBpZg0KICAgICAqIHRoZSBy\nZXN1bHQgaXMgbWFya2VkIGRpc3RpbmN0LiBUaGlzIHdvdWxkIHJlcXVpcmUg\ndHJhY2tpbmcgYWxsDQogICAgICogcHJldmlvdXMgcmVzdWx0cywgd2hpY2gg\nd291bGQgaW50ZXJmZXJlIHdpdGggbGFyZ2UgcmVzdWx0IHNldA0KICAgICAq\nIGhhbmRsaW5nLjwvbGk+DQogICAgICogPC91bD4NCiAgICAgKg0KICAgICAq\nIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4DQogICAgICogQG5vamF2YWRv\nYw0KICAgICAqLw0KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1lcmdlZEV4\nZWN1dG9yDQogICAgICAgIGltcGxlbWVudHMgU3RvcmVRdWVyeS5FeGVjdXRv\nciB7DQoNCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5LkV4ZWN1\ndG9yW10gX2V4ZWN1dG9yczsNCg0KICAgICAgICBwdWJsaWMgTWVyZ2VkRXhl\nY3V0b3IoU3RvcmVRdWVyeS5FeGVjdXRvcltdIGV4ZWN1dG9ycykgew0KICAg\nICAgICAgICAgX2V4ZWN1dG9ycyA9IGV4ZWN1dG9yczsNCiAgICAgICAgfQ0K\nDQogICAgICAgIHB1YmxpYyBSZXN1bHRPYmplY3RQcm92aWRlciBleGVjdXRl\nUXVlcnkoU3RvcmVRdWVyeSBxLA0KICAgICAgICAgICAgT2JqZWN0W10gcGFy\nYW1zLCBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlKSB7DQogICAgICAgICAgICBp\nZiAoX2V4ZWN1dG9ycy5sZW5ndGggPT0gMSkNCiAgICAgICAgICAgICAgICBy\nZXR1cm4gX2V4ZWN1dG9yc1swXS5leGVjdXRlUXVlcnkocSwgcGFyYW1zLCBy\nYW5nZSk7DQoNCiAgICAgICAgICAgIC8vIHVzZSBscnMgc2V0dGluZ3MgaWYg\nd2UgY291bGRuJ3QgdGFrZSBhZHZhbnRhZ2Ugb2YgdGhlIHN0YXJ0IGluZGV4\nDQogICAgICAgICAgICAvLyBzbyB0aGF0IGhvcGVmdWxseSB0aGUgc2tpcCB0\nbyB0aGUgc3RhcnQgd2lsbCBiZSBlZmZpY2llbnQNCiAgICAgICAgICAgIFN0\nb3JlUXVlcnkuUmFuZ2Ugcm9wUmFuZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5n\nZSgwLCByYW5nZS5lbmQpOw0KICAgICAgICAgICAgcm9wUmFuZ2UubHJzID0g\ncmFuZ2UubHJzIHx8IChyYW5nZS5zdGFydCA+IDAgJiYgcS5nZXRDb250ZXh0\nKCkuDQogICAgICAgICAgICAgICAgZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCku\nZ2V0RmV0Y2hCYXRjaFNpemUoKSA+PSAwKTsNCg0KICAgICAgICAgICAgLy8g\nZXhlY3V0ZSB0aGUgcXVlcnk7IHdlIGNhbm5vdCB1c2UgdGhlIGxvd2VyIGJv\ndW5kIG9mIHRoZSByZXN1bHQNCiAgICAgICAgICAgIC8vIHJhbmdlLCBidXQg\nd2UgY2FuIHRha2UgYWR2YW50YWdlIG9mIHRoZSB1cHBlciBib3VuZA0KICAg\nICAgICAgICAgUmVzdWx0T2JqZWN0UHJvdmlkZXJbXSByb3BzID0NCiAgICAg\nICAgICAgICAgICBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbX2V4ZWN1dG9y\ncy5sZW5ndGhdOw0KICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBf\nZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgICAgIHJvcHNb\naV0gPSBfZXhlY3V0b3JzW2ldLmV4ZWN1dGVRdWVyeShxLCBwYXJhbXMsIHJv\ncFJhbmdlKTsNCg0KICAgICAgICAgICAgYm9vbGVhbltdIGFzYyA9IF9leGVj\ndXRvcnNbMF0uZ2V0QXNjZW5kaW5nKHEpOw0KICAgICAgICAgICAgUmVzdWx0\nT2JqZWN0UHJvdmlkZXIgcm9wOw0KICAgICAgICAgICAgaWYgKGFzYy5sZW5n\ndGggPT0gMCkNCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgTWVyZ2VkUmVz\ndWx0T2JqZWN0UHJvdmlkZXIocm9wcyk7DQogICAgICAgICAgICBlbHNlDQog\nICAgICAgICAgICAgICAgcm9wID0gbmV3IE9yZGVyaW5nTWVyZ2VkUmVzdWx0\nT2JqZWN0UHJvdmlkZXIocm9wcywgYXNjLA0KICAgICAgICAgICAgICAgICAg\nICBfZXhlY3V0b3JzLCBxLCBwYXJhbXMpOw0KDQogICAgICAgICAgICAvLyBp\nZiB0aGVyZSBpcyBhIGxvd2VyIGJvdW5kLCB3cmFwIGluIHJhbmdlIHJvcA0K\nICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDApDQogICAgICAgICAg\nICAgICAgcm9wID0gbmV3IFJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9w\nLCByYW5nZS5zdGFydCwgDQogICAgICAgICAgICAgICAgICAgIHJhbmdlLmVu\nZCk7DQogICAgICAgICAgICByZXR1cm4gcm9wOw0KICAgICAgICB9DQoNCiAg\nICAgICAgcHVibGljIE51bWJlciBleGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkg\ncSwgT2JqZWN0W10gcGFyYW1zKSB7DQogICAgICAgICAgICBsb25nIG51bSA9\nIDA7DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leGVjdXRv\ncnMubGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgbnVtICs9IF9leGVj\ndXRvcnNbaV0uZXhlY3V0ZURlbGV0ZShxLCBwYXJhbXMpLmxvbmdWYWx1ZSgp\nOw0KICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVPZihudW0pOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIE51bWJlciBleGVjdXRlVXBk\nYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7DQogICAgICAg\nICAgICBsb25nIG51bSA9IDA7DQogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspDQogICAgICAgICAgICAg\nICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZVVwZGF0ZShxLCBwYXJh\nbXMpLmxvbmdWYWx1ZSgpOw0KICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMu\ndmFsdWVPZihudW0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIFN0\ncmluZ1tdIGdldERhdGFTdG9yZUFjdGlvbnMoU3RvcmVRdWVyeSBxLCBPYmpl\nY3RbXSBwYXJhbXMsDQogICAgICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJh\nbmdlKSB7DQogICAgICAgICAgICBpZiAoX2V4ZWN1dG9ycy5sZW5ndGggPT0g\nMSkNCiAgICAgICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRE\nYXRhU3RvcmVBY3Rpb25zKHEsIHBhcmFtcywgcmFuZ2UpOw0KDQogICAgICAg\nICAgICBMaXN0IHJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0KF9leGVjdXRvcnMu\nbGVuZ3RoKTsNCiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2Ugcm9wUmFu\nZ2UgPSBuZXcgU3RvcmVRdWVyeS5SYW5nZSgwTCwgcmFuZ2UuZW5kKTsNCiAg\nICAgICAgICAgIFN0cmluZ1tdIGFjdGlvbnM7DQogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspIHsNCiAg\nICAgICAgICAgICAgICBhY3Rpb25zID0gX2V4ZWN1dG9yc1tpXS5nZXREYXRh\nU3RvcmVBY3Rpb25zKHEsIHBhcmFtcyxyb3BSYW5nZSk7DQogICAgICAgICAg\nICAgICAgaWYgKGFjdGlvbnMgIT0gbnVsbCAmJiBhY3Rpb25zLmxlbmd0aCA+\nIDApDQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYWRkQWxsKEFycmF5\ncy5hc0xpc3QoYWN0aW9ucykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAg\nICAgcmV0dXJuIChTdHJpbmdbXSkgcmVzdWx0cy50b0FycmF5KG5ldyBTdHJp\nbmdbcmVzdWx0cy5zaXplKCldKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1\nYmxpYyB2b2lkIHZhbGlkYXRlKFN0b3JlUXVlcnkgcSkgew0KICAgICAgICAg\nICAgX2V4ZWN1dG9yc1swXS52YWxpZGF0ZShxKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0b3JlUXVlcnkgcSwgT2Jq\nZWN0W10gcGFyYW1zLCANCiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2Ug\ncmFuZ2UpIHsNCiAgICAgICAgICAgIF9leGVjdXRvcnNbMF0uZ2V0UmFuZ2Uo\ncSwgcGFyYW1zLCByYW5nZSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJs\naWMgT2JqZWN0IGdldE9yZGVyaW5nVmFsdWUoU3RvcmVRdWVyeSBxLCBPYmpl\nY3RbXSBwYXJhbXMsDQogICAgICAgICAgICBPYmplY3QgcmVzdWx0T2JqZWN0\nLCBpbnQgaWR4KSB7DQogICAgICAgICAgICAvLyB1bmZvcnR1bmF0ZWx5LCBh\ndCB0aGlzIHBvaW50IChtdXN0IGJlIGEgbWVyZ2VkIHJvcCBjb250YWluaW5n\nDQogICAgICAgICAgICAvLyBvdGhlciBtZXJnZWQgcm9wcykgd2UgaGF2ZSBu\nbyBpZGVhIHdoaWNoIGV4ZWN1dG9yIHRvIGV4dHJhY3QNCiAgICAgICAgICAg\nIC8vIHRoZSB2YWx1ZSBmcm9tDQogICAgICAgICAgICByZXR1cm4gX2V4ZWN1\ndG9yc1swXS5nZXRPcmRlcmluZ1ZhbHVlKHEsIHBhcmFtcywgcmVzdWx0T2Jq\nZWN0LCBpZHgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJvb2xl\nYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVRdWVyeSBxKSB7DQogICAgICAgICAg\nICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRBc2NlbmRpbmcocSk7DQogICAg\nICAgIH0NCg0KICAgICAgICBwdWJsaWMgU3RyaW5nIGdldEFsaWFzKFN0b3Jl\nUXVlcnkgcSkgew0KICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0u\nZ2V0QWxpYXMocSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgU3Ry\naW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMoU3RvcmVRdWVyeSBxKSB7DQog\nICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRQcm9qZWN0aW9u\nQWxpYXNlcyhxKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBDbGFz\ncyBnZXRSZXN1bHRDbGFzcyhTdG9yZVF1ZXJ5IHEpIHsNCiAgICAgICAgICAg\nIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFJlc3VsdENsYXNzKHEpOw0KICAg\nICAgICB9DQoNCiAgICAgICAgcHVibGljIENsYXNzW10gZ2V0UHJvamVjdGlv\nblR5cGVzKFN0b3JlUXVlcnkgcSkgew0KICAgICAgICAgICAgcmV0dXJuIF9l\neGVjdXRvcnNbMF0uZ2V0UHJvamVjdGlvblR5cGVzKHEpOw0KICAgICAgICB9\nDQoNCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQYWNraW5nKFN0b3JlUXVl\ncnkgcSkgew0KICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uaXNQ\nYWNraW5nKHEpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIENsYXNz\nTWV0YURhdGFbXSBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKFN0b3JlUXVlcnkg\ncSkgew0KICAgICAgICAgICAgaWYgKF9leGVjdXRvcnMubGVuZ3RoID09IDEp\nDQogICAgICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0QWNj\nZXNzUGF0aE1ldGFEYXRhcyhxKTsNCg0KICAgICAgICAgICAgLy8gY3JlYXRl\nIHNldCBvZiBiYXNlIGNsYXNzIG1ldGFkYXRhcyBpbiBhY2Nlc3MgcGF0aA0K\nICAgICAgICAgICAgTGlzdCBtZXRhcyA9IG51bGw7DQogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVuZ3RoOyBpKyspDQog\nICAgICAgICAgICAgICAgbWV0YXMgPSBGaWx0ZXJzLmFkZEFjY2Vzc1BhdGhN\nZXRhRGF0YXMobWV0YXMsIF9leGVjdXRvcnNbaV0uDQogICAgICAgICAgICAg\nICAgICAgIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMocSkpOw0KICAgICAgICAg\nICAgaWYgKG1ldGFzID09IG51bGwpDQogICAgICAgICAgICAgICAgcmV0dXJu\nIFN0b3JlUXVlcnkuRU1QVFlfTUVUQVM7DQogICAgICAgICAgICByZXR1cm4g\nKENsYXNzTWV0YURhdGFbXSkgbWV0YXMudG9BcnJheQ0KICAgICAgICAgICAg\nICAgIChuZXcgQ2xhc3NNZXRhRGF0YVttZXRhcy5zaXplKCldKTsNCiAgICAg\nICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sZWFuIGlzQWdncmVnYXRlKFN0\nb3JlUXVlcnkgcSkgew0KICAgICAgICAgICAgaWYgKCFfZXhlY3V0b3JzWzBd\nLmlzQWdncmVnYXRlKHEpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsNCg0KICAgICAgICAgICAgLy8gd2UgY2FuJ3QgbWVyZ2UgYWdncmVnYXRl\ncw0KICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJtZXJnZWQtYWdncmVnYXRlIiwNCiAgICAgICAgICAgICAg\nICBxLmdldENvbnRleHQoKS5nZXRDYW5kaWRhdGVUeXBlKCksDQogICAgICAg\nICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnlTdHJpbmcoKSkpOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBnZXRPcGVyYXRpb24o\nU3RvcmVRdWVyeSBxKSB7DQogICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9y\nc1swXS5nZXRPcGVyYXRpb24ocSk7DQogICAgICAgIH0NCg0KICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNHcm91cGluZyhTdG9yZVF1ZXJ5IHEpIHsNCiAg\nICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmhhc0dyb3VwaW5nKHEp\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIExpbmtlZE1hcCBnZXRQ\nYXJhbWV0ZXJUeXBlcyhTdG9yZVF1ZXJ5IHEpIHsNCiAgICAgICAgICAgIHJl\ndHVybiBfZXhlY3V0b3JzWzBdLmdldFBhcmFtZXRlclR5cGVzKHEpOw0KICAg\nICAgICB9DQoNCiAgICAgICAgcHVibGljIE1hcCBnZXRVcGRhdGVzKFN0b3Jl\nUXVlcnkgcSkgew0KICAgICAgICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0u\nZ2V0VXBkYXRlcyhxKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0K\nICAgICAqIFJlc3VsdCBvYmplY3QgcHJvdmlkZXIgdGhhdCBwYWNrcyByZXN1\nbHRzIGJlZm9yZSByZXR1cm5pbmcgdGhlbS4NCiAgICAgKi8NCiAgICBwcml2\nYXRlIHN0YXRpYyBjbGFzcyBQYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIN\nCiAgICAgICAgaW1wbGVtZW50cyBSZXN1bHRPYmplY3RQcm92aWRlciB7DQoN\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBSZXN1bHRPYmplY3RQcm92aWRlciBf\nZGVsZWdhdGU7DQogICAgICAgIHByaXZhdGUgZmluYWwgUmVzdWx0UGFja2Vy\nIF9wYWNrZXI7DQogICAgICAgIHByaXZhdGUgZmluYWwgaW50IF9sZW47DQoN\nCiAgICAgICAgcHVibGljIFBhY2tpbmdSZXN1bHRPYmplY3RQcm92aWRlcihS\nZXN1bHRPYmplY3RQcm92aWRlciBkZWxlZ2F0ZSwNCiAgICAgICAgICAgIFJl\nc3VsdFBhY2tlciBwYWNrZXIsIGludCByZXN1bHRMZW5ndGgpIHsNCiAgICAg\nICAgICAgIF9kZWxlZ2F0ZSA9IGRlbGVnYXRlOw0KICAgICAgICAgICAgX3Bh\nY2tlciA9IHBhY2tlcjsNCiAgICAgICAgICAgIF9sZW4gPSByZXN1bHRMZW5n\ndGg7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c1JhbmRvbUFjY2VzcygpIHsNCiAgICAgICAgICAgIHJldHVybiBfZGVs\nZWdhdGUuc3VwcG9ydHNSYW5kb21BY2Nlc3MoKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIHB1YmxpYyB2b2lkIG9wZW4oKQ0KICAgICAgICAgICAgdGhyb3dz\nIEV4Y2VwdGlvbiB7DQogICAgICAgICAgICBfZGVsZWdhdGUub3BlbigpOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRSZXN1bHRP\nYmplY3QoKQ0KICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAg\nICAgICAgICBPYmplY3Qgb2IgPSBfZGVsZWdhdGUuZ2V0UmVzdWx0T2JqZWN0\nKCk7DQogICAgICAgICAgICBpZiAoX3BhY2tlciA9PSBudWxsICYmIF9sZW4g\nPT0gMSkNCiAgICAgICAgICAgICAgICByZXR1cm4gKChPYmplY3RbXSkgb2Ip\nWzBdOw0KICAgICAgICAgICAgaWYgKF9wYWNrZXIgPT0gbnVsbCkNCiAgICAg\nICAgICAgICAgICByZXR1cm4gb2I7DQogICAgICAgICAgICBpZiAoX2xlbiA9\nPSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiBfcGFja2VyLnBhY2sob2Ip\nOw0KICAgICAgICAgICAgcmV0dXJuIF9wYWNrZXIucGFjaygoT2JqZWN0W10p\nIG9iKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sZWFuIG5l\neHQoKQ0KICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAgICAg\nICAgICByZXR1cm4gX2RlbGVnYXRlLm5leHQoKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIHB1YmxpYyBib29sZWFuIGFic29sdXRlKGludCBwb3MpDQogICAg\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsNCiAgICAgICAgICAgIHJldHVy\nbiBfZGVsZWdhdGUuYWJzb2x1dGUocG9zKTsNCiAgICAgICAgfQ0KDQogICAg\nICAgIHB1YmxpYyBpbnQgc2l6ZSgpDQogICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsNCiAgICAgICAgICAgIHJldHVybiBfZGVsZWdhdGUuc2l6ZSgp\nOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQgcmVzZXQoKQ0K\nICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7DQogICAgICAgICAgICBf\nZGVsZWdhdGUucmVzZXQoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlKCkNCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24g\new0KICAgICAgICAgICAgX2RlbGVnYXRlLmNsb3NlKCk7DQogICAgICAgIH0N\nCg0KICAgICAgICBwdWJsaWMgdm9pZCBoYW5kbGVDaGVja2VkRXhjZXB0aW9u\nKEV4Y2VwdGlvbiBlKSB7DQogICAgICAgICAgICBfZGVsZWdhdGUuaGFuZGxl\nQ2hlY2tlZEV4Y2VwdGlvbihlKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAg\nIC8qKg0KICAgICAqIFJlc3VsdCBsaXN0IHRoYXQgcmVtb3ZlcyBpdHNlbGYg\nZnJvbSB0aGUgcXVlcnkncyBvcGVuIHJlc3VsdCBsaXN0DQogICAgICogd2hl\nbiBpdCBpcyBjbG9zZWQuIFB1YmxpYyBmb3IgdGVzdGluZy4NCiAgICAgKi8N\nCiAgICBwdWJsaWMgY2xhc3MgUmVtb3ZlT25DbG9zZVJlc3VsdExpc3QNCiAg\nICAgICAgaW1wbGVtZW50cyBSZXN1bHRMaXN0IHsNCg0KICAgICAgICBwcml2\nYXRlIGZpbmFsIFJlc3VsdExpc3QgX3JlczsNCg0KICAgICAgICBwdWJsaWMg\nUmVtb3ZlT25DbG9zZVJlc3VsdExpc3QoUmVzdWx0TGlzdCByZXMpIHsNCiAg\nICAgICAgICAgIF9yZXMgPSByZXM7DQogICAgICAgIH0NCg0KICAgICAgICBw\ndWJsaWMgUmVzdWx0TGlzdCBnZXREZWxlZ2F0ZSgpIHsNCiAgICAgICAgICAg\nIHJldHVybiBfcmVzOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gaXNQcm92aWRlck9wZW4oKSB7DQogICAgICAgICAgICByZXR1cm4g\nX3Jlcy5pc1Byb3ZpZGVyT3BlbigpOw0KICAgICAgICB9DQoNCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNDbG9zZWQoKSB7DQogICAgICAgICAgICByZXR1\ncm4gX3Jlcy5pc0Nsb3NlZCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVi\nbGljIHZvaWQgY2xvc2UoKSB7DQogICAgICAgICAgICBjbG9zZSh0cnVlKTsN\nCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKGJvb2xl\nYW4gcmVtb3ZlKSB7DQogICAgICAgICAgICBpZiAoaXNDbG9zZWQoKSkNCiAg\nICAgICAgICAgICAgICByZXR1cm47DQoNCiAgICAgICAgICAgIF9yZXMuY2xv\nc2UoKTsNCiAgICAgICAgICAgIGlmICghcmVtb3ZlKQ0KICAgICAgICAgICAg\nICAgIHJldHVybjsNCg0KICAgICAgICAgICAgbG9jaygpOw0KICAgICAgICAg\nICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAvLyBkb24ndCB1c2Ugc3RhbmRh\ncmQgX3Jlc3VsdExpc3RzLnJlbW92ZSBtZXRob2QgYi9jIHJlbGllcyBvbg0K\nICAgICAgICAgICAgICAgIC8vIGNvbGxlY3Rpb24gZXF1YWxpdHksIHdoaWNo\nIHJlbGllcyBvbiBlbGVtZW50IGVxdWFsaXR5LCB3aGljaA0KICAgICAgICAg\nICAgICAgIC8vIG1lYW5zIHdlIGVuZCB1cCB0cmF2ZXJzaW5nIGVudGlyZSBy\nZXN1bHQgbGlzdHMhDQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvciBp\ndHIgPSBfcmVzdWx0TGlzdHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTsp\nIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ci5uZXh0KCkgPT0gdGhp\ncykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOw0K\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAg\nICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGZp\nbmFsbHkgew0KICAgICAgICAgICAgICAgIHVubG9jaygpOw0KICAgICAgICAg\nICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBzaXplKCkg\new0KICAgICAgICAgICAgcmV0dXJuIF9yZXMuc2l6ZSgpOw0KICAgICAgICB9\nDQoNCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsNCiAgICAg\nICAgICAgIHJldHVybiBfcmVzLmlzRW1wdHkoKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE9iamVjdCBvKSB7DQog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5jb250YWlucyhvKTsNCiAgICAgICAg\nfQ0KDQogICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRvcigpIHsNCiAg\nICAgICAgICAgIHJldHVybiBfcmVzLml0ZXJhdG9yKCk7DQogICAgICAgIH0N\nCg0KICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheSgpIHsNCiAgICAg\nICAgICAgIHJldHVybiBfcmVzLnRvQXJyYXkoKTsNCiAgICAgICAgfQ0KDQog\nICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KE9iamVjdFtdIGEpIHsN\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLnRvQXJyYXkoYSk7DQogICAgICAg\nIH0NCg0KICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0IG8pIHsN\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLmFkZChvKTsNCiAgICAgICAgfQ0K\nDQogICAgICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZShPYmplY3Qgbykgew0K\nICAgICAgICAgICAgcmV0dXJuIF9yZXMucmVtb3ZlKG8pOw0KICAgICAgICB9\nDQoNCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNBbGwoQ29sbGVj\ndGlvbiBjKSB7DQogICAgICAgICAgICByZXR1cm4gX3Jlcy5jb250YWluc0Fs\nbChjKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29sZWFuIGFk\nZEFsbChDb2xsZWN0aW9uIGMpIHsNCiAgICAgICAgICAgIHJldHVybiBfcmVz\nLmFkZEFsbChjKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29s\nZWFuIGFkZEFsbChpbnQgaWR4LCBDb2xsZWN0aW9uIGMpIHsNCiAgICAgICAg\nICAgIHJldHVybiBfcmVzLmFkZEFsbChpZHgsIGMpOw0KICAgICAgICB9DQoN\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENvbGxlY3Rpb24g\nYykgew0KICAgICAgICAgICAgcmV0dXJuIF9yZXMucmVtb3ZlQWxsKGMpOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmV0YWluQWxs\nKENvbGxlY3Rpb24gYykgew0KICAgICAgICAgICAgcmV0dXJuIF9yZXMucmV0\nYWluQWxsKGMpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHZvaWQg\nY2xlYXIoKSB7DQogICAgICAgICAgICBfcmVzLmNsZWFyKCk7DQogICAgICAg\nIH0NCg0KICAgICAgICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaWR4KSB7DQog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5nZXQoaWR4KTsNCiAgICAgICAgfQ0K\nDQogICAgICAgIHB1YmxpYyBPYmplY3Qgc2V0KGludCBpZHgsIE9iamVjdCBv\nKSB7DQogICAgICAgICAgICByZXR1cm4gX3Jlcy5zZXQoaWR4LCBvKTsNCiAg\nICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyB2b2lkIGFkZChpbnQgaWR4LCBP\nYmplY3Qgbykgew0KICAgICAgICAgICAgX3Jlcy5hZGQoaWR4LCBvKTsNCiAg\nICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBPYmplY3QgcmVtb3ZlKGludCBp\nZHgpIHsNCiAgICAgICAgICAgIHJldHVybiBfcmVzLnJlbW92ZShpZHgpOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBpbmRleE9mKE9iamVj\ndCBvKSB7DQogICAgICAgICAgICByZXR1cm4gX3Jlcy5pbmRleE9mKG8pOw0K\nICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGludCBsYXN0SW5kZXhPZihP\nYmplY3Qgbykgew0KICAgICAgICAgICAgcmV0dXJuIF9yZXMubGFzdEluZGV4\nT2Yobyk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgTGlzdEl0ZXJh\ndG9yIGxpc3RJdGVyYXRvcigpIHsNCiAgICAgICAgICAgIHJldHVybiBfcmVz\nLmxpc3RJdGVyYXRvcigpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGlj\nIExpc3RJdGVyYXRvciBsaXN0SXRlcmF0b3IoaW50IGlkeCkgew0KICAgICAg\nICAgICAgcmV0dXJuIF9yZXMubGlzdEl0ZXJhdG9yKGlkeCk7DQogICAgICAg\nIH0NCg0KICAgICAgICBwdWJsaWMgTGlzdCBzdWJMaXN0KGludCBzdGFydCwg\naW50IGVuZCkgew0KICAgICAgICAgICAgcmV0dXJuIF9yZXMuc3ViTGlzdChz\ndGFydCwgZW5kKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBib29s\nZWFuIGVxdWFscyhPYmplY3Qgbykgew0KICAgICAgICAgICAgcmV0dXJuIF9y\nZXMuZXF1YWxzKG8pOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIGlu\ndCBoYXNoQ29kZSgpIHsNCiAgICAgICAgICAgIHJldHVybiBfcmVzLmhhc2hD\nb2RlKCk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgU3RyaW5nIHRv\nU3RyaW5nICgpDQoJCXsNCgkJCXJldHVybiBfcmVzLnRvU3RyaW5nICgpOw0K\nCQl9DQoNCgkJcHVibGljIE9iamVjdCB3cml0ZVJlcGxhY2UgKCkNCgkJew0K\nCQkJcmV0dXJuIF9yZXM7DQoJCX0NCgl9DQp9DQo=\n","encoding":"base64"}

