{"sha":"5ea1fc677b10299319bc26cf0480946510a5a86b","node_id":"MDQ6QmxvYjIwNjM2NDo1ZWExZmM2NzdiMTAyOTkzMTliYzI2Y2YwNDgwOTQ2NTEwYTVhODZi","size":32268,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/5ea1fc677b10299319bc26cf0480946510a5a86b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1\ndDsKaW1wb3J0IGphdmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5z\ncWwuVGltZXN0YW1wOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0\nIGphdmEudXRpbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwu\nSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkNoYW5nZVRyYWNrZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNlcHRpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuTWFwQ2hhbmdlVHJhY2tlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUHJveGllczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlByb3h5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuUHJveHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBGaWVsZE1h\nbmFnZXIgdHlwZSB1c2VkIHRvIGhvbGQgb250byBhIHNpbmdsZSBmaWVsZCB2\nYWx1ZSBhbmQgdGhlbgogKiBkaXNwZW5zZSBpdCB2aWEgdGhlIGZldGNoIG1l\ndGhvZHMuIFRoZSBtYW5hZ2VyIGNhbiBhbHNvIHBlcmZvcm0gYWN0aW9ucwog\nKiBvbiB0aGUgaGVsZCBmaWVsZC4KICoKICogQGF1dGhvciBBYmUgV2hpdGUK\nICovCmNsYXNzIFNpbmdsZUZpZWxkTWFuYWdlcgogICAgZXh0ZW5kcyBUcmFu\nc2ZlckZpZWxkTWFuYWdlcgogICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUg\newoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0g\nTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoU2luZ2xlRmllbGRNYW5h\nZ2VyLmNsYXNzKTsKCiAgICBwcml2YXRlIGZpbmFsIFN0YXRlTWFuYWdlcklt\ncGwgX3NtOwogICAgcHJpdmF0ZSBmaW5hbCBCcm9rZXJJbXBsIF9icm9rZXI7\nCgogICAgcHVibGljIFNpbmdsZUZpZWxkTWFuYWdlcihTdGF0ZU1hbmFnZXJJ\nbXBsIHNtLCBCcm9rZXJJbXBsIGJyb2tlcikgewogICAgICAgIF9zbSA9IHNt\nOwogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcm94eSB0aGUgaGVsZCBmaWVsZCBpZiBuZWVkZWQuIFJldHVybiB0\ncnVlIGlmIHRoZSBmaWVsZCBuZWVkcyB0bwogICAgICogYmUgcmVwbGFjZWQg\nd2l0aCB0aGUgbm93LXByb3hpZWQgaW5zdGFuY2UuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIHByb3h5KGJvb2xlYW4gcmVzZXQsIGJvb2xlYW4gcmVw\nbGFjZU51bGwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9zbS5n\nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBQcm94eSBw\ncm94eSA9IG51bGw7CiAgICAgICAgYm9vbGVhbiByZXQgPSBmYWxzZTsKICAg\nICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAg\nIGlmIChvYmp2YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgICAgICBwcm94eSA9IGNoZWNrUHJveHko\nKTsKICAgICAgICAgICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgcHJveHkgPSAoUHJveHkpIF9zbS5uZXdGaWVsZFBy\nb3h5KGZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAoKERhdGUpIHByb3h5\nKS5zZXRUaW1lKCgoRGF0ZSkgb2JqdmFsKS5nZXRUaW1lKCkpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChwcm94eSBpbnN0YW5jZW9mIFRpbWVzdGFtcCAK\nICAgICAgICAgICAgICAgICAgICAgICAgJiYgb2JqdmFsIGluc3RhbmNlb2Yg\nVGltZXN0YW1wKQogICAgICAgICAgICAgICAgICAgICAgICAoKFRpbWVzdGFt\ncCkgcHJveHkpLnNldE5hbm9zKCgoVGltZXN0YW1wKSBvYmp2YWwpLgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TmFub3MoKSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgIGlmIChvYmp2YWwgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgICAgICBwcm94eSA9IGNoZWNrUHJveHkoKTsKICAgICAgICAgICAgICAg\nIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcHJv\neHkgPSAoUHJveHkpIF9zbS5uZXdGaWVsZFByb3h5KGZpZWxkKTsKICAgICAg\nICAgICAgICAgICAgICAoKENhbGVuZGFyKSBwcm94eSkuc2V0VGltZSgoKENh\nbGVuZGFyKSBvYmp2YWwpLmdldFRpbWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNU\nSU9OOgogICAgICAgICAgICAgICAgaWYgKG9ianZhbCA9PSBudWxsICYmICFy\nZXBsYWNlTnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgICAgICBwcm94eSA9IGNoZWNrUHJveHkoKTsKICAgICAg\nICAgICAgICAgIGlmIChwcm94eSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgcHJveHkgPSAoUHJveHkpIF9zbS5uZXdGaWVsZFByb3h5KGZpZWxk\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2JqdmFsICE9IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICgoQ29sbGVjdGlvbikgcHJveHkpLmFk\nZEFsbCgoQ29sbGVjdGlvbikgb2JqdmFsKTsKICAgICAgICAgICAgICAgICAg\nICByZXQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAg\nICAgICAgICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCAmJiAhcmVwbGFjZU51\nbGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICAgICAgcHJveHkgPSBjaGVja1Byb3h5KCk7CiAgICAgICAgICAgICAg\nICBpZiAocHJveHkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHBy\nb3h5ID0gKFByb3h5KSBfc20ubmV3RmllbGRQcm94eShmaWVsZCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKG9ianZhbCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICAoKE1hcCkgcHJveHkpLnB1dEFsbCgoTWFwKSBvYmp2\nYWwpOwogICAgICAgICAgICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgaWYgKG9i\nanZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgIHByb3h5ID0gY2hlY2tQcm94eSgpOwogICAg\nICAgICAgICAgICAgaWYgKHByb3h5ID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBwcm94eSA9IGdldFByb3h5TWFuYWdlcigpLm5ld0N1c3RvbVBy\nb3h5KG9ianZhbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcHJveHkg\nIT0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHByb3h5ICE9IG51bGwpIHsK\nICAgICAgICAgICAgcHJveHkuc2V0T3duZXIoX3NtLCBmaWVsZCk7CiAgICAg\nICAgICAgIENoYW5nZVRyYWNrZXIgdHJhY2tlciA9IHByb3h5LmdldENoYW5n\nZVRyYWNrZXIoKTsKICAgICAgICAgICAgaWYgKHJlc2V0ICYmIHRyYWNrZXIg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk1BUCkgewogICAgICAgICAgICAg\nICAgICAgIC8vIHRyYWNrIHZhbHVlcyBpZiBrZXkgaXMgZGVyaXZlZCBmcm9t\nIHZhbHVlLCBlbHNlIGtleXMKICAgICAgICAgICAgICAgICAgICBib29sZWFu\nIGtleXMgPSBmbWQuZ2V0S2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpID09IG51\nbGw7CiAgICAgICAgICAgICAgICAgICAgKChNYXBDaGFuZ2VUcmFja2VyKSB0\ncmFja2VyKS5zZXRUcmFja0tleXMoa2V5cyk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB0cmFja2VyLnN0YXJ0VHJhY2tpbmcoKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBvYmp2YWwgPSBwcm94eTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKioKICAgICAq\nIElmIHRoZSBjdXJyZW50IGZpZWxkIGlzIGEgdXNhYmxlIHByb3h5LCByZXR1\ncm4gaXQ7IGVsc2UgcmV0dXJuIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUg\nUHJveHkgY2hlY2tQcm94eSgpIHsKICAgICAgICBpZiAoIShvYmp2YWwgaW5z\ndGFuY2VvZiBQcm94eSkpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICBQcm94eSBwcm94eSA9IChQcm94eSkgb2JqdmFsOwogICAgICAgIGlm\nIChwcm94eS5nZXRPd25lcigpID09IG51bGwgfHwgUHJveGllcy5pc093bmVy\nKHByb3h5LCBfc20sIGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIHByb3h5\nOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICog\nVW5wcm94aWVzIHRoZSBjdXJyZW50IGZpZWxkIGlmIG5lZWRlZC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgdW5wcm94eSgpIHsKICAgICAgICBpZiAob2Jq\ndmFsID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChm\naWVsZCk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgaWYgKG9ianZhbCBpbnN0YW5j\nZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAgICAgUHJveHkgcHJveHkg\nPSAoUHJveHkpIG9ianZhbDsKICAgICAgICAgICAgICAgICAgICBwcm94eS5z\nZXRPd25lcihudWxsLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBy\nb3h5LmdldENoYW5nZVRyYWNrZXIoKSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBwcm94eS5nZXRDaGFuZ2VUcmFja2VyKCkuc3RvcFRyYWNr\naW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmVsZWFzZSB0aGUgY3VycmVudGx5IGVtYmVkZGVkIGZp\nZWxkIChtYWtlIGl0IHRyYW5zaWVudCkuCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHJlbGVhc2VFbWJlZGRlZCgpIHsKICAgICAgICBpZiAob2JqdmFsID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfc20uZ2V0TWV0YURhdGEoKS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAg\nICAgaWYgKGZtZC5pc0VtYmVkZGVkUEMoKSkKICAgICAgICAgICAgICAgICAg\nICByZWxlYXNlRW1iZWRkZWQoZm1kLCBvYmp2YWwpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgog\nICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuaXNFbWJlZGRl\nZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVkKGZt\nZC5nZXRFbGVtZW50KCksIChPYmplY3RbXSkgb2JqdmFsKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCku\naXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVt\nYmVkZGVkKGZtZC5nZXRFbGVtZW50KCksIChDb2xsZWN0aW9uKSBvYmp2YWwp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0S2V5KCku\naXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVt\nYmVkZGVkKGZtZC5nZXRLZXkoKSwgKChNYXApIG9ianZhbCkua2V5U2V0KCkp\nOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuaXNFbWJl\nZGRlZFBDKCkpCiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZUVtYmVkZGVk\nKGZtZC5nZXRFbGVtZW50KCksICgoTWFwKSBvYmp2YWwpLnZhbHVlcygpKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlbGVhc2UgdGhlIGdpdmVuIGVtYmVkZGVkIG9iamVjdHMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWxlYXNlRW1iZWRkZWQoVmFs\ndWVNZXRhRGF0YSB2bWQsIE9iamVjdFtdIG9ianMpIHsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG9ianMubGVuZ3RoOyBpKyspCiAgICAgICAgICAg\nIHJlbGVhc2VFbWJlZGRlZCh2bWQsIG9ianNbaV0pOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVsZWFzZSB0aGUgZ2l2ZW4gZW1iZWRkZWQgb2JqZWN0cy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlbGVhc2VFbWJlZGRlZChWYWx1\nZU1ldGFEYXRhIHZtZCwgQ29sbGVjdGlvbiBvYmpzKSB7CiAgICAgICAgZm9y\nIChJdGVyYXRvciBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0\nKCk7KQogICAgICAgICAgICByZWxlYXNlRW1iZWRkZWQodm1kLCBpdHIubmV4\ndCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgdGhlIGdpdmVu\nIGVtYmVkZCBvYmplY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWxl\nYXNlRW1iZWRkZWQoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBvYmopIHsK\nICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IF9icm9rZXIuZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAgICAgICBpZiAoc20gIT0g\nbnVsbCAmJiBzbS5nZXRPd25lcigpID09IF9zbQogICAgICAgICAgICAmJiBz\nbS5nZXRPd25lckluZGV4KCkgPT0gdm1kLmdldEZpZWxkTWV0YURhdGEoKS5n\nZXRJbmRleCgpKQogICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgc3RvcmVkIGZpZWxkIHNh\nZmVseSwgcHJldmVudGluZyBpbmZpbml0ZSByZWN1cnNpb24gdXNpbmcKICAg\nICAqIHRoZSBnaXZlbiBzZXQgb2YgYWxyZWFkeS1wZXJzaXN0ZWQgb2JqZWN0\ncy4gVGhpcyBtZXRob2QgaXMgb25seSBjYWxsZWQKICAgICAqIGZvciBmaWVs\nZHMgdGhhdCB3ZSBrbm93IGhhdmUgY2FzY2FkZS1pbW1lZGlhdGUgc2V0dGlu\nZ3MuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9z\nbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBzd2l0\nY2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBpZiAoIV9icm9rZXIuaXNE\nZXRhY2hlZE5ldygpICYmIF9icm9rZXIuaXNEZXRhY2hlZChvYmp2YWwpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gYWxsb3cgYnV0IGlnbm9y\nZQogICAgICAgICAgICAgICAgX2Jyb2tlci5wZXJzaXN0KG9ianZhbCwgdHJ1\nZSwgY2FsbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICBfYnJva2Vy\nLnBlcnNpc3RBbGwoQXJyYXlzLmFzTGlzdCgoT2JqZWN0W10pIG9ianZhbCks\nIHRydWUsIAogICAgICAgICAgICAgICAgICAgIGNhbGwpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICBfYnJva2VyLnBlcnNpc3RBbGwoKENv\nbGxlY3Rpb24pIG9ianZhbCwgdHJ1ZSwgY2FsbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAg\nICAgICAgICAgICAgaWYgKGZtZC5nZXRLZXkoKS5nZXRDYXNjYWRlUGVyc2lz\ndCgpCiAgICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0lNTUVESUFURSkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLnBl\ncnNpc3RBbGwoKChNYXApIG9ianZhbCkua2V5U2V0KCksIHRydWUsIGNhbGwp\nOwogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuZ2V0Q2Fz\nY2FkZVBlcnNpc3QoKQogICAgICAgICAgICAgICAgICAgID09IFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpCiAgICAgICAgICAgICAgICAgICAg\nX2Jyb2tlci5wZXJzaXN0QWxsKCgoTWFwKSBvYmp2YWwpLnZhbHVlcygpLCB0\ncnVlLCBjYWxsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhbmQvb3IgZGVyZWZlcmVu\nY2UgZmllbGQgdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBkZWxl\ndGUoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGRlbGV0ZSh0cnVlLCBj\nYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlcmVmZXJlbmNlIGZpZWxk\nIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHZvaWQgZGVyZWZlcmVuY2VE\nZXBlbmRlbnQoKSB7CiAgICAgICAgZGVsZXRlKGZhbHNlLCBudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBvciBkZXJlZmVyZW5jZSB0aGUg\nc3RvcmVkIGZpZWxkIGFzIG5lY2Vzc2FyeS4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGRlbGV0ZShib29sZWFuIGltbWVkaWF0ZSwgT3BDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9zbS5n\nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoZm1k\nLmdldENhc2NhZGVEZWxldGUoKSAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nTk9ORSkgewogICAgICAgICAgICAvLyBpbW1lZGlhdGUgY2FzY2FkZSB3b3Jr\ncyBvbiBmaWVsZCB2YWx1ZTsgZGVwZW5kZW50IGRlcmVmCiAgICAgICAgICAg\nIC8vIHdvcmtzIG9uIGV4dGVybmFsIHZhbHVlCiAgICAgICAgICAgIGlmICgo\naW1tZWRpYXRlIHx8IGZtZC5pc0VtYmVkZGVkUEMoKSkKICAgICAgICAgICAg\nICAgICYmIGZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0\nYS5DQVNDQURFX0lNTUVESUFURSkKICAgICAgICAgICAgICAgIGRlbGV0ZShm\nbWQsIG9ianZhbCwgY2FsbCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGZtZC5n\nZXRDYXNjYWRlRGVsZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FV\nVE8pCiAgICAgICAgICAgICAgICBkZXJlZmVyZW5jZURlcGVuZGVudChmbWQu\nZ2V0RXh0ZXJuYWxWYWx1ZShvYmp2YWwsIF9icm9rZXIpKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0IGV4dGVybmFs\nID0gbnVsbDsKICAgICAgICBWYWx1ZU1ldGFEYXRhIHZtZCA9IGZtZC5nZXRL\nZXkoKTsKICAgICAgICBpZiAoKGltbWVkaWF0ZSB8fCB2bWQuaXNFbWJlZGRl\nZFBDKCkpCiAgICAgICAgICAgICYmIHZtZC5nZXRDYXNjYWRlRGVsZXRlKCkg\nPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkKICAgICAgICAg\nICAgZGVsZXRlKHZtZCwgKChNYXApIG9ianZhbCkua2V5U2V0KCksIGNhbGwp\nOwogICAgICAgIGVsc2UgaWYgKHZtZC5nZXRDYXNjYWRlRGVsZXRlKCkgPT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pIHsKICAgICAgICAgICAgZXh0\nZXJuYWwgPSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZShvYmp2YWwsIF9icm9rZXIp\nOwogICAgICAgICAgICBpZiAoZXh0ZXJuYWwgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgZGVyZWZlcmVuY2VEZXBlbmRl\nbnQoKChNYXApIGV4dGVybmFsKS5rZXlTZXQoKSk7CiAgICAgICAgfQoKICAg\nICAgICB2bWQgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgIGlmICgoaW1t\nZWRpYXRlIHx8IHZtZC5pc0VtYmVkZGVkUEMoKSkKICAgICAgICAgICAgJiYg\ndm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBkZWxldGUo\ndm1kLCAoQ29sbGVjdGlvbikgb2JqdmFsLCBjYWxsKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkFSUkFZOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSh2bWQsIChPYmpl\nY3RbXSkgb2JqdmFsLCBjYWxsKTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAg\nICAgICAgICAgICAgICBkZWxldGUodm1kLCAoKE1hcCkgb2JqdmFsKS52YWx1\nZXMoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHZtZC5nZXRDYXNjYWRlRGVs\nZXRlKCkgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FVVE8pIHsKICAgICAg\nICAgICAgaWYgKGV4dGVybmFsID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGV4dGVybmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUob2JqdmFsLCBfYnJv\na2VyKTsKICAgICAgICAgICAgICAgIGlmIChleHRlcm5hbCA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgc3dpdGNoIChmbWQuZ2V0VHlwZUNvZGUoKSkgewogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAg\nICAgICAgICAgICBkZXJlZmVyZW5jZURlcGVuZGVudCgoQ29sbGVjdGlvbikg\nZXh0ZXJuYWwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAg\nICAgICAgZGVyZWZlcmVuY2VEZXBlbmRlbnQoKE9iamVjdFtdKSBleHRlcm5h\nbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgZGVy\nZWZlcmVuY2VEZXBlbmRlbnQoKChNYXApIGV4dGVybmFsKS52YWx1ZXMoKSk7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgdGhlIG9iamVj\ndHMgaW4gdGhlIGdpdmVuIHZhbHVlLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZGVsZXRlKFZhbHVlTWV0YURhdGEgdm1kLCBPYmplY3RbXSBvYmpzLCBP\ncENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBvYmpzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBkZWxldGUodm1kLCBv\nYmpzW2ldLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSB0\naGUgb2JqZWN0cyBlbWJlZGRlZCBpbiB0aGUgZ2l2ZW4gdmFsdWUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBkZWxldGUoVmFsdWVNZXRhRGF0YSB2bWQs\nIENvbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFz\nTmV4dCgpOykKICAgICAgICAgICAgZGVsZXRlKHZtZCwgaXRyLm5leHQoKSwg\nY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxldGUgYW4gb2JqZWN0\nIGVtYmVkZGVkIGluIHRoZSBnaXZlbiB2YWx1ZS4KICAgICAqLwogICAgdm9p\nZCBkZWxldGUoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdCBvYmosIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gZGVsZXRlIGlmIHVua25vd25l\nZCBvciB0aGlzIGlzbid0IGFuIGVtYmVkZGVkIGZpZWxkIG9yIGlmIG93bmVk\nIGJ5IHVzCiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IF9icm9rZXIu\nZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAgICAgICBpZiAo\nc20gIT0gbnVsbCAmJiAoc20uZ2V0T3duZXIoKSA9PSBudWxsIHx8ICF2bWQu\naXNFbWJlZGRlZFBDKCkKICAgICAgICAgICAgfHwgKHNtLmdldE93bmVyKCkg\nPT0gX3NtCiAgICAgICAgICAgICYmIHNtLmdldE93bmVySW5kZXgoKSA9PSB2\nbWQuZ2V0RmllbGRNZXRhRGF0YSgpLmdldEluZGV4KCkpKSkKICAgICAgICAg\nICAgX2Jyb2tlci5kZWxldGUoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCksIHNt\nLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlcmVmZXJlbmNlIGFs\nbCB2YWxpZCBwZXJzaXN0ZW50IG9iamVjdHMgaW4gdGhlIGdpdmVuIGNvbGxl\nY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkZXJlZmVyZW5jZURl\ncGVuZGVudChPYmplY3RbXSBvYmpzKSB7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBkZXJlZmVy\nZW5jZURlcGVuZGVudChvYmpzW2ldKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIERlcmVmZXJlbmNlIGFsbCB2YWxpZCBwZXJzaXN0ZW50IG9iamVjdHMgaW4g\ndGhlIGdpdmVuIGNvbGxlY3Rpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBkZXJlZmVyZW5jZURlcGVuZGVudChDb2xsZWN0aW9uIG9ianMpIHsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspCiAgICAgICAgICAgIGRlcmVmZXJlbmNlRGVwZW5kZW50\nKGl0ci5uZXh0KCkpOwogICAgfQoKICAgIC8qKgogICAgICogRGVyZWZlcmVu\nY2UgdGhlIGdpdmVuIG9iamVjdC4KICAgICAqLwogICAgdm9pZCBkZXJlZmVy\nZW5jZURlcGVuZGVudChPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYgKG9iaiA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgU3RhdGVNYW5h\nZ2VySW1wbCBzbSA9IF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmos\nIGZhbHNlKTsKICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAg\nc20uc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KHRydWUsIHRydWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVjdXJzaXZlbHkgaW52b2tlIHRoZSBicm9r\nZXIgdG8gZ2F0aGVyIGNhc2NhZGUtcmVmcmVzaCBvYmplY3RzIGluCiAgICAg\nKiB0aGUgY3VycmVudCBmaWVsZCBpbnRvIHRoZSBnaXZlbiBzZXQuIFRoaXMg\nbWV0aG9kIGlzIG9ubHkgY2FsbGVkCiAgICAgKiBmb3IgZmllbGRzIHRoYXQg\nd2Uga25vdyBoYXZlIGNhc2NhZGUtcmVmcmVzaCBzZXR0aW5ncy4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT3BDYWxs\nYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmp2YWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9zbS5nZXRNZXRhRGF0YSgpLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBz\nd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBfYnJva2VyLmdhdGhl\nckNhc2NhZGVSZWZyZXNoKG9ianZhbCwgY2FsbCk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAg\nICAgICAgICAgICAgICBnYXRoZXJDYXNjYWRlUmVmcmVzaCgoT2JqZWN0W10p\nIG9ianZhbCwgY2FsbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAg\nICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKChDb2xsZWN0aW9uKSBvYmp2YWws\nIGNhbGwpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0\nS2V5KCkuZ2V0Q2FzY2FkZVJlZnJlc2goKQogICAgICAgICAgICAgICAgICAg\nID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpCiAgICAgICAg\nICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goKChNYXApIG9ianZh\nbCkua2V5U2V0KCksIGNhbGwpOwogICAgICAgICAgICAgICAgaWYgKGZtZC5n\nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZVJlZnJlc2goKQogICAgICAgICAgICAg\nICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpCiAg\nICAgICAgICAgICAgICAgICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goKChNYXAp\nIG9ianZhbCkudmFsdWVzKCksIGNhbGwpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2F0aGVyIGVh\nY2ggZWxlbWVudC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGdhdGhlckNh\nc2NhZGVSZWZyZXNoKE9iamVjdFtdIGFyciwgT3BDYWxsYmFja3MgY2FsbCkg\newogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICBfYnJva2VyLmdhdGhlckNhc2NhZGVSZWZyZXNoKGFy\ncltpXSwgY2FsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHYXRoZXIgZWFj\naCBlbGVtZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgZ2F0aGVyQ2Fz\nY2FkZVJlZnJlc2goQ29sbGVjdGlvbiBjb2xsLCBPcENhbGxiYWNrcyBjYWxs\nKSB7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBjb2xsLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICBfYnJva2VyLmdhdGhl\nckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCksIGNhbGwpOwogICAgfQoKICAg\nIC8qKgogICAgICogUGVyZm9ybSBwcmUtZmx1c2ggdGFza3Mgb24gdGhlIGN1\ncnJlbnQgZmllbGQuIFRoaXMgaW5jbHVkZXMgY2hlY2tpbmcKICAgICAqIGZv\nciBudWxscywgcGVyc2lzdGluZyBwY3MsIGVtYmVkZGluZyBlbWJlZGRlZCBm\naWVsZHMsIGFuZCByZWYnaW5nCiAgICAgKiBwYyBmaWVsZHMuIFJldHVybiB0\ncnVlIGlmIHRoZSBmaWVsZCBuZWVkcyB0byBiZSByZXBsYWNlZCB3aXRoIHRo\nZQogICAgICogbmV3IHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBwcmVGbHVzaChib29sZWFuIGxvZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICAvLyBvbmx5IGNhcmUgYWJvdXQgb2JqZWN0IGZpZWxkcwog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3NtLmdldE1ldGFEYXRhKCku\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpIDwgSmF2YVR5cGVzLk9CSkVDVCkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICAvLyBwZXJmb3JtIHBlcnMtYnktcmVhY2gg\nYW5kIGRlcGVuZGVudCByZWZzCiAgICAgICAgYm9vbGVhbiByZXQgPSBwcmVG\nbHVzaChmbWQsIGxvZ2ljYWwsIGNhbGwpOwoKICAgICAgICAvLyBtYW5hZ2Ug\naW52ZXJzZXMKICAgICAgICBJbnZlcnNlTWFuYWdlciBtYW5hZ2VyID0gX2Jy\nb2tlci5nZXRJbnZlcnNlTWFuYWdlcigpOwogICAgICAgIGlmIChtYW5hZ2Vy\nICE9IG51bGwpCiAgICAgICAgICAgIG1hbmFnZXIuY29ycmVjdFJlbGF0aW9u\ncyhfc20sIGZtZCwgb2JqdmFsKTsKICAgICAgICByZXR1cm4gcmV0OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGxhc3QtcHJv\ndmlkZWQgZmllbGQgaGFzIGEgZGVmYXVsdCB2YWx1ZS4KICAgICAqLwogICAg\ncHVibGljIGJvb2xlYW4gaXNEZWZhdWx0VmFsdWUoKSB7CiAgICAgICAgcmV0\ndXJuIGRibHZhbCA9PSAwICYmIGxvbmd2YWwgPT0gMAogICAgICAgICAgICAm\nJiAob2JqdmFsID09IG51bGwgfHwgIiIuZXF1YWxzKG9ianZhbCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIHN0b3JlZCBmaWVsZCBvciBp\ndHMgZGVmYXVsdCB2YWx1ZSB0byB0aGUgZ2l2ZW4gc3RyZWFtLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXJpYWxpemUoT2JqZWN0T3V0cHV0IG91dCwg\nYm9vbGVhbiBkZWYpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9zbS5nZXRNZXRhRGF0YSgpLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9P\nTEVBTjoKICAgICAgICAgICAgICAgIG91dC53cml0ZUJvb2xlYW4oIWRlZiAm\nJiBsb25ndmFsID09IDEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBv\ndXQud3JpdGVCeXRlKChkZWYpID8gKGJ5dGUpIDAgOiAoYnl0ZSkgbG9uZ3Zh\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ0hBUjoKICAgICAgICAgICAgICAgIG91dC53cml0ZUNoYXIo\nKGRlZikgPyAoY2hhcikgMCA6IChjaGFyKSBsb25ndmFsKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VC\nTEU6CiAgICAgICAgICAgICAgICBvdXQud3JpdGVEb3VibGUoKGRlZikgPyAw\nRCA6IGRibHZhbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBvdXQu\nd3JpdGVGbG9hdCgoZGVmKSA/IDBGIDogKGZsb2F0KSBkYmx2YWwpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLklOVDoKICAgICAgICAgICAgICAgIG91dC53cml0ZUludCgoZGVmKSA/IDAg\nOiAoaW50KSBsb25ndmFsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAg\nb3V0LndyaXRlTG9uZygoZGVmKSA/IDBMIDogbG9uZ3ZhbCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hP\nUlQ6CiAgICAgICAgICAgICAgICBvdXQud3JpdGVTaG9ydCgoZGVmKSA/IChz\naG9ydCkgMCA6IChzaG9ydCkgbG9uZ3ZhbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIG91\ndC53cml0ZU9iamVjdCgoZGVmKSA/IG51bGwgOiBvYmp2YWwpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gcGVy\nZm9ybSBwcmUgZmx1c2ggYWN0aW9ucyBvbiB0aGUgY3VycmVudCBvYmplY3Qu\nCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBwcmVGbHVzaChGaWVsZE1l\ndGFEYXRhIGZtZCwgYm9vbGVhbiBsb2dpY2FsLCAKICAgICAgICBPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgLy8gY2hlY2sgZm9yIGlsbGVnYWwgbnVs\nbHMKICAgICAgICBpZiAob2JqdmFsID09IG51bGwpIHsKICAgICAgICAgICAg\naWYgKGZtZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1ldGFEYXRhLk5VTExf\nRVhDRVBUSU9OCiAgICAgICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxs\nLXZhbHVlIiwKICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0TmFtZSgpLCBf\nc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKS4KICAgICAgICAgICAgICAgICAg\nICBzZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KCiAgICAgICAgLy8gbm90aGluZyBlbHNlIHRvIGRvIGZvciBu\nb24tcGVyc2lzdGVudAogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgp\nICE9IEZpZWxkTWV0YURhdGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gZG9uJ3QgYWxsb3cgbWFu\nYWdlZCBvYmplY3RpZCBmaWVsZCB2YWx1ZQogICAgICAgIGlmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpIHsKICAgICAg\nICAgICAgX3NtLmFzc2VydE5vdE1hbmFnZWRPYmplY3RJZChvYmp2YWwpOwog\nICAgICAgICAgICBpZiAoX3NtLmdldE9iamVjdElkKCkgIT0gbnVsbAogICAg\nICAgICAgICAgICAgJiYgIW9ianZhbC5lcXVhbHMoKChPYmplY3RJZCkgX3Nt\nLmdldE9iamVjdElkKCkpLmdldElkKCkpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2hhbmdl\nZC1vaWQiLAogICAgICAgICAgICAgICAgICAgIF9zbS5nZXRPYmplY3RJZCgp\nLCBvYmp2YWwsCiAgICAgICAgICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0\ncmluZyhfc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAgICAgICAg\nICAgICAgICAgc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBjaGVjayBmb3IgcGNzIGluIGZpZWxkIHZhbHVlCiAgICAgICAgaWYgKHBy\nZUZsdXNoKGZtZCwgZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSwKICAgICAg\nICAgICAgZm1kLmdldEtleSgpLmdldERlY2xhcmVkVHlwZUNvZGUoKSwKICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVDb2Rl\nKCksIGZhbHNlLCBsb2dpY2FsLCBjYWxsKSkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CgogICAgICAgIC8vIGFsc28gY2hlY2sgZm9yIHBjcyBpbiBleHRl\ncm5hbGl6ZWQgdmFsdWVzCiAgICAgICAgaWYgKGZtZC5pc0V4dGVybmFsaXpl\nZCgpKQogICAgICAgICAgICBwcmVGbHVzaChmbWQsIGZtZC5nZXRUeXBlQ29k\nZSgpLCBmbWQuZ2V0S2V5KCkuZ2V0VHlwZUNvZGUoKSwKICAgICAgICAgICAg\nICAgIGZtZC5nZXRFbGVtZW50KCkuZ2V0VHlwZUNvZGUoKSwgdHJ1ZSwgbG9n\naWNhbCwgY2FsbCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBuZXcgb2JqZWN0cyBwZXJzaXN0ZW50IGFuZCBy\nZWYgb3RoZXIgb2JqZWN0cyBzbyByZWZlcmVuY2VkCiAgICAgKiBkZXBlbmRl\nbnQgb2JqZWN0cyB3b24ndCBiZSBkZWxldGVkLgogICAgICovCiAgICBwcml2\nYXRlIGJvb2xlYW4gcHJlRmx1c2goRmllbGRNZXRhRGF0YSBmbWQsIGludCB0\neXBlLCBpbnQga2V5VHlwZSwKICAgICAgICBpbnQgZWxlbVR5cGUsIGJvb2xl\nYW4gZXh0ZXJuYWwsIGJvb2xlYW4gbG9naWNhbCwgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIE9iamVjdCB2YWwgPSBvYmp2YWw7CiAgICAgICAgaWYg\nKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIGJvb2xlYW4gY29weSA9IGZhbHNlOwogICAgICAgIHN3aXRjaCAodHlw\nZSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAg\nICAgICAgIGlmIChmbWQuaXNFbWJlZGRlZFBDKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBvYmp2YWwgPSBlbWJlZChmbWQsIHZhbCk7CiAgICAgICAgICAg\nICAgICAgICAgY29weSA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIGlmIChleHRlcm5hbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUodmFs\nLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNoUEMoZm1kLCB2\nYWwsIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBD\nX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICBpZiAoZXh0ZXJuYWwpCiAgICAg\nICAgICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4dGVybmFsVmFsdWUodmFs\nLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgIGlmICh2YWwgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBDKGZtZCwgdmFsLCBsb2dp\nY2FsLCBjYWxsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGlmIChm\nbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQQygpKQogICAgICAgICAgICAg\nICAgICAgIGVtYmVkKGZtZC5nZXRFbGVtZW50KCksIChPYmplY3RbXSkgdmFs\nKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1UeXBlID09IEphdmFU\neXBlcy5QQwogICAgICAgICAgICAgICAgICAgIHx8IGVsZW1UeXBlID09IEph\ndmFUeXBlcy5QQ19VTlRZUEVEKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGV4dGVybmFsKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBmbWQu\nZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgICAgICAgICAg\nICAgICAgIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAg\nICAgcHJlRmx1c2hQQ3MoZm1kLmdldEVsZW1lbnQoKSwgKE9iamVjdFtdKSB2\nYWwsIGxvZ2ljYWwsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Fs\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQQygp\nKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqdmFsID0gZW1iZWQoZm1kLmdl\ndEVsZW1lbnQoKSwgKENvbGxlY3Rpb24pIHZhbCk7CiAgICAgICAgICAgICAg\nICAgICAgY29weSA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKGVsZW1UeXBlID09IEphdmFUeXBlcy5QQwogICAgICAgICAgICAgICAgICAg\nIHx8IGVsZW1UeXBlID09IEphdmFUeXBlcy5QQ19VTlRZUEVEKSB7CiAgICAg\nICAgICAgICAgICAgICAgYm9vbGVhbiBmbHVzaGVkID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGV4dGVybmFsKQogICAgICAgICAgICAgICAg\nICAgICAgICB2YWwgPSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9r\nZXIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5j\nZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3J0\nY3V0IGNoYW5nZSB0cmFja2VyczsgYWxzbyBlbnN1cmVzIHdlIGRvbid0IAog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIGxycyBmaWVsZHMK\nICAgICAgICAgICAgICAgICAgICAgICAgQ2hhbmdlVHJhY2tlciBjdCA9ICgo\nUHJveHkpIHZhbCkuZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoY3QgIT0gbnVsbCAmJiBjdC5pc1RyYWNraW5nKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNoUENzKGZt\nZC5nZXRFbGVtZW50KCksIGN0LmdldEFkZGVkKCksIAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcHJlRmx1c2hQQ3MoZm1kLmdldEVsZW1lbnQo\nKSwgY3QuZ2V0Q2hhbmdlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmx1c2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\naWYgKCFmbHVzaGVkICYmIHZhbCAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxlbWVudCgpLCAoQ29sbGVj\ndGlvbikgdmFsLCBsb2dpY2FsLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2FsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAg\nICAgICAgICAgYm9vbGVhbiBrZXlFbWJlZCA9IGZtZC5nZXRLZXkoKS5pc0Vt\nYmVkZGVkUEMoKTsKICAgICAgICAgICAgICAgIGJvb2xlYW4gdmFsRW1iZWQg\nPSBmbWQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWRQQygpOwogICAgICAgICAg\nICAgICAgaWYgKGtleUVtYmVkIHx8IHZhbEVtYmVkKSB7CiAgICAgICAgICAg\nICAgICAgICAgb2JqdmFsID0gZW1iZWQoZm1kLCAoTWFwKSB2YWwsIGtleUVt\nYmVkLCB2YWxFbWJlZCk7CiAgICAgICAgICAgICAgICAgICAgY29weSA9IGtl\neUVtYmVkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlm\nICgha2V5RW1iZWQgJiYgKGtleVR5cGUgPT0gSmF2YVR5cGVzLlBDCiAgICAg\nICAgICAgICAgICAgICAgfHwga2V5VHlwZSA9PSBKYXZhVHlwZXMuUENfVU5U\nWVBFRCkpIHsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGZsdXNoZWQg\nPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXh0ZXJuYWwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gZm1kLmdldEV4dGVybmFs\nVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nZXh0ZXJuYWwgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIFByb3h5KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHNob3J0Y3V0IGNoYW5nZSB0cmFja2VyczsgYWxzbyBlbnN1\ncmVzIHdlIGRvbid0IAogICAgICAgICAgICAgICAgICAgICAgICAvLyBpdGVy\nYXRlIGxycyBmaWVsZHMKICAgICAgICAgICAgICAgICAgICAgICAgTWFwQ2hh\nbmdlVHJhY2tlciBjdCA9IChNYXBDaGFuZ2VUcmFja2VyKSAoKFByb3h5KSB2\nYWwpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q2hhbmdlVHJh\nY2tlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3QgIT0gbnVs\nbCAmJiBjdC5pc1RyYWNraW5nKCkgJiYgY3QuZ2V0VHJhY2tLZXlzKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHByZUZsdXNoUENzKGZtZC5nZXRLZXkoKSwgY3QuZ2V0QWRkZWQo\nKSwgbG9naWNhbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nYWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNoUENz\nKGZtZC5nZXRLZXkoKSwgY3QuZ2V0Q2hhbmdlZCgpLCBsb2dpY2FsLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmx1c2hlZCA9IHRydWU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFmbHVzaGVkICYmIHZhbCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0S2V5KCks\nICgoTWFwKSB2YWwpLmtleVNldCgpLCBsb2dpY2FsLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY2FsbCk7CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgaWYgKCF2YWxFbWJlZCAmJiAoZWxlbVR5cGUgPT0gSmF2\nYVR5cGVzLlBDCiAgICAgICAgICAgICAgICAgICAgfHwgZWxlbVR5cGUgPT0g\nSmF2YVR5cGVzLlBDX1VOVFlQRUQpKSB7CiAgICAgICAgICAgICAgICAgICAg\nYm9vbGVhbiBmbHVzaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGV4dGVybmFsKQogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBm\nbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFByb3h5KSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3J0Y3V0IGNoYW5nZSB0cmFj\na2VyczsgYWxzbyBlbnN1cmVzIHdlIGRvbid0IAogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBpdGVyYXRlIGxycyBmaWVsZHMKICAgICAgICAgICAgICAg\nICAgICAgICAgTWFwQ2hhbmdlVHJhY2tlciBjdCA9IChNYXBDaGFuZ2VUcmFj\na2VyKSAoKFByb3h5KSB2YWwpLgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZ2V0Q2hhbmdlVHJhY2tlcigpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoY3QgIT0gbnVsbCAmJiBjdC5pc1RyYWNraW5nKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChjdC5nZXRUcmFja0tleXMoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZUZsdXNoUENz\nKGZtZC5nZXRFbGVtZW50KCksIGN0LmdldEFkZGVkKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIChNYXApIHZhbCwgbG9naWNhbCwg\nY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlRmx1\nc2hQQ3MoZm1kLmdldEVsZW1lbnQoKSwgY3QuZ2V0Q2hhbmdlZCgpLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoTWFwKSB2YWwsIGxv\nZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVGbHVz\naFBDcyhmbWQuZ2V0RWxlbWVudCgpLCBjdC5nZXRBZGRlZCgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpY2FsLCBjYWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVGbHVzaFBDcyhm\nbWQuZ2V0RWxlbWVudCgpLCBjdC5nZXRDaGFuZ2VkKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2ljYWwsIGNhbGwpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZmx1c2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFmbHVzaGVkICYmIHZhbCAhPSBudWxsKQogICAgICAgICAgICAg\nICAgICAgICAgICBwcmVGbHVzaFBDcyhmbWQuZ2V0RWxlbWVudCgpLCAoKE1h\ncCkgdmFsKS52YWx1ZXMoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZ2ljYWwsIGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3B5Owog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBuZXcgb2JqZWN0cyBwZXJzaXN0\nZW50IGFuZCByZWYgYWxsIHZhbGlkIHBlcnNpc3RlbnQgb2JqZWN0cyBmb3IK\nICAgICAqIHRoZSBnaXZlbiBrZXlzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcHJlRmx1c2hQQ3MoVmFsdWVNZXRhRGF0YSB2bWQsIENvbGxlY3Rpb24g\na2V5cywgTWFwIG1hcCwKICAgICAgICBib29sZWFuIGxvZ2ljYWwsIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IGtl\neXMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIHBy\nZUZsdXNoUEModm1kLCBtYXAuZ2V0KGl0ci5uZXh0KCkpLCBsb2dpY2FsLCBj\nYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgbmV3IG9iamVjdHMg\ncGVyc2lzdGVudCBhbmQgcmVmIGFsbCB2YWxpZCBwZXJzaXN0ZW50IG9iamVj\ndHMgaW4KICAgICAqIHRoZSBnaXZlbiBhcnJheS4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHByZUZsdXNoUENzKFZhbHVlTWV0YURhdGEgdm1kLCBPYmpl\nY3RbXSBvYmpzLAogICAgICAgIGJvb2xlYW4gbG9naWNhbCwgT3BDYWxsYmFj\na3MgY2FsbCkgewogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgb2Jqcy5s\nZW5ndGg7IGkrKykKICAgICAgICAgICAgcHJlRmx1c2hQQyh2bWQsIG9ianNb\naV0sIGxvZ2ljYWwsIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSBuZXcgb2JqZWN0cyBwZXJzaXN0ZW50IGFuZCByZWYgYWxsIHZhbGlkIHBl\ncnNpc3RlbnQgb2JqZWN0cyBpbgogICAgICogdGhlIGdpdmVuIGNvbGxlY3Rp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwcmVGbHVzaFBDcyhWYWx1\nZU1ldGFEYXRhIHZtZCwgQ29sbGVjdGlvbiBvYmpzLAogICAgICAgIGJvb2xl\nYW4gbG9naWNhbCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGZvciAo\nSXRlcmF0b3IgaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykKICAgICAgICAgICAgcHJlRmx1c2hQQyh2bWQsIGl0ci5uZXh0KCksIGxv\nZ2ljYWwsIGNhbGwpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBw\ncmUgZmx1c2ggb3BlcmF0aW9ucyBvbiB0aGUgZ2l2ZW4gb2JqZWN0LgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgcHJlRmx1c2hQQyhWYWx1ZU1ldGFEYXRh\nIHZtZCwgT2JqZWN0IG9iaiwgYm9vbGVhbiBsb2dpY2FsLAogICAgICAgIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdl\nciBzbTsKCiAgICAgICAgaWYgKHZtZC5nZXRDYXNjYWRlUGVyc2lzdCgpID09\nIFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9OT05FKSB7CiAgICAgICAgICAgIGlm\nICghX2Jyb2tlci5pc0RldGFjaGVkTmV3KCkgJiYgX2Jyb2tlci5pc0RldGFj\naGVkKG9iaikpCiAgICAgICAgICAgICAgICByZXR1cm47IC8vIGFsbG93IGJ1\ndCBpZ25vcmUKCiAgICAgICAgICAgIHNtID0gX2Jyb2tlci5nZXRTdGF0ZU1h\nbmFnZXIob2JqKTsKICAgICAgICAgICAgaWYgKHNtID09IG51bGwgfHwgIXNt\nLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICBfbG9j\nLmdldCgiY2FudC1jYXNjYWRlLXBlcnNpc3QiLCB2bWQpKQogICAgICAgICAg\nICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBpZiAodm1kLmdldENhc2NhZGVQZXJzaXN0KCkg\nPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0lNTUVESUFURSkgewogICAgICAg\nICAgICAgICAgaWYgKCFfYnJva2VyLmlzRGV0YWNoZWROZXcoKSAmJiBfYnJv\na2VyLmlzRGV0YWNoZWQob2JqKSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm47IC8vIGFsbG93IGJ1dCBpZ25vcmUKICAgICAgICAgICAgfSAgICAgICAg\nCQogICAgICAgICAgICBzbSA9IF9icm9rZXIuZ2V0U3RhdGVNYW5hZ2VyKG9i\naik7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsIHx8ICFzbS5pc1Byb3Zp\nc2lvbmFsKCkpIHsgCiAgICAgICAgICAgICAgICBzbSA9IF9icm9rZXIucGVy\nc2lzdChvYmosIG51bGwsIHRydWUsIGNhbGwpOwogICAgICAgICAgICAgICAg\nLy8gZW5zdXJlIGdlbmVyYXRlZCBJRHMgZ2V0IGFzc2lnbmVkIHByb3Blcmx5\nCiAgICAgICAgICAgICAgICBpZiAoIWxvZ2ljYWwpCiAgICAgICAgICAgICAg\nICAgICAgKChTdGF0ZU1hbmFnZXJJbXBsKXNtKS5hc3NpZ25PYmplY3RJZChm\nYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIGlmIGRlbGV0ZWQg\nYW5kIG5vdCBtYW5hZ2VkIGludmVyc2UsIGRpZQogICAgICAgICAgICBpZiAo\nc20uaXNEZWxldGVkKCkgJiYgKF9icm9rZXIuZ2V0SW52ZXJzZU1hbmFnZXIo\nKSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCB2bWQuZ2V0RmllbGRNZXRh\nRGF0YSgpLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0gMCkpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgicmVmLXRvLWRlbGV0ZWQiLAogICAgICAgICAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcob2JqKSwgdm1kLAogICAgICAgICAgICAgICAgICAg\nIEV4Y2VwdGlvbnMudG9TdHJpbmcoX3NtLmdldE1hbmFnZWRJbnN0YW5jZSgp\nKSkpLgogICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChvYmop\nOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbWltcGwgPSAoU3Rh\ndGVNYW5hZ2VySW1wbCkgc207CiAgICAgICAgICAgIHNtaW1wbC5ub25wcm92\naXNpb25hbChsb2dpY2FsLCBjYWxsKTsKICAgICAgICAgICAgc21pbXBsLnNl\ndERlcmVmZXJlbmNlZERlcGVuZGVudChmYWxzZSwgdHJ1ZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbGwgZWxlbWVudHMgb2Yg\ndGhlIGdpdmVuIGFycmF5IGVtYmVkZGVkLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZW1iZWQoVmFsdWVNZXRhRGF0YSB2bWQsIE9iamVjdFtdIGFycikg\newogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsr\nKQogICAgICAgICAgICBhcnJbaV0gPSBlbWJlZCh2bWQsIGFycltpXSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBjb3B5IG9mIHRoZSBnaXZl\nbiBjb2xsZWN0aW9uIGNvbnRhaW5pbmcgZW1iZWRkZWQgZWxlbWVudHMuCiAg\nICAgKi8KICAgIHByaXZhdGUgQ29sbGVjdGlvbiBlbWJlZChWYWx1ZU1ldGFE\nYXRhIHZtZCwgQ29sbGVjdGlvbiBvcmlnKSB7CiAgICAgICAgLy8gd2UgaGF2\nZSB0byBjb3B5IHRvIGdldCBhIGNvbGxlY3Rpb24gb2YgdGhlIHJpZ2h0IHR5\ncGUgYW5kIHNpemUsCiAgICAgICAgLy8gdGhvdWdoIHdlIGltbWVkaWF0ZWx5\nIGNsZWFyIGl0CiAgICAgICAgQ29sbGVjdGlvbiBjb2xsID0gZ2V0UHJveHlN\nYW5hZ2VyKCkuY29weUNvbGxlY3Rpb24ob3JpZyk7CiAgICAgICAgaWYgKGNv\nbGwgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vdC1jb3B5YWJsZSIsCiAgICAgICAgICAgICAgICB2\nbWQuZ2V0RmllbGRNZXRhRGF0YSgpKSk7CgogICAgICAgIGNvbGwuY2xlYXIo\nKTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG9yaWcuaXRlcmF0b3Io\nKTsgaXRyLmhhc05leHQoKTspCiAgICAgICAgICAgIGNvbGwuYWRkKGVtYmVk\nKHZtZCwgaXRyLm5leHQoKSkpOwogICAgICAgIHJldHVybiBjb2xsOwogICAg\nfQoKICAgIC8qKgogICAgICogRW1iZWQgdGhlIGVsZW1lbnRzIG9mIHRoZSBn\naXZlbiBtYXAuCiAgICAgKi8KICAgIHByaXZhdGUgTWFwIGVtYmVkKEZpZWxk\nTWV0YURhdGEgZm1kLCBNYXAgb3JpZywgYm9vbGVhbiBrZXlFbWJlZCwKICAg\nICAgICBib29sZWFuIHZhbEVtYmVkKSB7CiAgICAgICAgTWFwIG1hcDsKICAg\nICAgICBNYXAuRW50cnkgZW50cnk7CgogICAgICAgIC8vIGlmIHdlIGhhdmUg\ndG8gcmVwbGFjZSBrZXlzLCB3ZSBuZWVkIHRvIGNvcHkgdGhlIG1hcDsgb3Ro\nZXJ3aXNlCiAgICAgICAgLy8gd2UgY2FuIG11dGF0ZSB0aGUgdmFsdWVzIGRp\ncmVjdGx5CiAgICAgICAgaWYgKGtleUVtYmVkKSB7CiAgICAgICAgICAgIC8v\nIHdlIGhhdmUgdG8gY29weSB0byBnZXQgYSBjb2xsZWN0aW9uIG9mIHRoZSBy\naWdodCB0eXBlIGFuZCBzaXplLAogICAgICAgICAgICAvLyB0aG91Z2ggd2Ug\naW1tZWRpYXRlbHkgY2xlYXIgaXQKICAgICAgICAgICAgbWFwID0gZ2V0UHJv\neHlNYW5hZ2VyKCkuY29weU1hcChvcmlnKTsKICAgICAgICAgICAgaWYgKG1h\ncCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vdC1jb3B5YWJsZSIsIGZtZCkpOwoKICAgICAg\nICAgICAgbWFwLmNsZWFyKCk7CiAgICAgICAgICAgIE9iamVjdCBrZXksIHZh\nbDsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBvcmlnLmVudHJ5\nU2V0KCkuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAg\nICAgICAgIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGtleSA9IGVtYmVkKGZtZC5nZXRLZXkoKSwgZW50cnkuZ2V0\nS2V5KCkpOwogICAgICAgICAgICAgICAgdmFsID0gZW50cnkuZ2V0VmFsdWUo\nKTsKICAgICAgICAgICAgICAgIGlmICh2YWxFbWJlZCkKICAgICAgICAgICAg\nICAgICAgICB2YWwgPSBlbWJlZChmbWQuZ2V0RWxlbWVudCgpLCB2YWwpOwog\nICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIHZhbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXAgPSBvcmlnOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IG1hcC5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICBlbnRyeSA9IChNYXAuRW50cnkpIGl0ci5uZXh0KCk7CiAgICAgICAgICAg\nICAgICBlbnRyeS5zZXRWYWx1ZShlbWJlZChmbWQuZ2V0RWxlbWVudCgpLAog\nICAgICAgICAgICAgICAgICAgIGVudHJ5LmdldFZhbHVlKCkpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbWFwOwogICAgfQoK\nICAgIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gb2JqZWN0IGVtYmVkZGVk\nLgogICAgICovCiAgICBwcml2YXRlIE9iamVjdCBlbWJlZChWYWx1ZU1ldGFE\nYXRhIHZtZCwgT2JqZWN0IG9iaikgewogICAgICAgIGlmIChvYmogPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIF9i\ncm9rZXIuZW1iZWQob2JqLCBudWxsLCBfc20sIHZtZCkuZ2V0TWFuYWdlZElu\nc3RhbmNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBy\nb3h5IG1hbmFnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgUHJveHlNYW5hZ2Vy\nIGdldFByb3h5TWFuYWdlciAoKQoJewoJCXJldHVybiBfYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24gKCkuZ2V0UHJveHlNYW5hZ2VySW5zdGFuY2UgKCk7Cgl9\nCn0K\n","encoding":"base64"}

