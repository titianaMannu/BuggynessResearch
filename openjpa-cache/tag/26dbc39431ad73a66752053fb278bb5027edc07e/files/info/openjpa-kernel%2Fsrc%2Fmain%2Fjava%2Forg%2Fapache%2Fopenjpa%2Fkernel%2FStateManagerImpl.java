{"sha":"d78f9784589343b910fe0ecd5b36e35a4ca09e7f","node_id":"MDQ6QmxvYjIwNjM2NDpkNzhmOTc4NDU4OTM0M2I5MTBmZTBlY2Q1YjM2ZTM1YTRjYTA5ZTdm","size":109920,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d78f9784589343b910fe0ecd5b36e35a4ca09e7f","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk5vdFNlcmlhbGl6\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEu\naW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxp\nemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5U\naW1lWm9uZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJp\nbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25mLk9wZW5K\nUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVu\naGFuY2UuRHluYW1pY1BlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5lbmhhbmNlLkZpZWxkTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLk1hbmFnZWRJbnN0YW5jZVByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdp\nc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNp\nc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLlJlZGVmaW5pdGlvbkhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5lbmhhbmNlLlN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5ldmVudC5MaWZlY3ljbGVFdmVudE1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXA7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVXBkYXRlU3RyYXRlZ2llczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZVN0cmF0ZWdpZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5BcHBsaWNhdGlvbklk\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3Rh\ndGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5P\nYmplY3ROb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLk9wZW5KUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlByb3h5TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLlJ1bnRpbWVFeGNlcHRpb25UcmFuc2xhdG9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IHNl\ncnAudXRpbC5OdW1iZXJzOwoKLyoqCiAqIEltcGxlbWVudGF0aW9uIG9mIHRo\nZSB7QGxpbmsgT3BlbkpQQVN0YXRlTWFuYWdlcn0gaW50ZXJmYWNlIGZvciB1\nc2UKICogd2l0aCB0aGlzIHJ1bnRpbWUuIEVhY2ggc3RhdGUgbWFuYWdlciBt\nYW5hZ2VzIHRoZSBzdGF0ZSBvZiBhIHNpbmdsZQogKiBwZXJzaXN0ZW5jZSBj\nYXBhYmxlIGluc3RhbmNlLiBUaGUgc3RhdGUgbWFuYWdlciBpcyBhbHNvIHJl\nc3BvbnNpYmxlIGZvcgogKiBhbGwgY29tbXVuaWNhdGlvbnMgYWJvdXQgdGhl\nIGluc3RhbmNlIHRvIHRoZSB7QGxpbmsgU3RvcmVNYW5hZ2VyfS4KICogIFRo\nZSBzdGF0ZSBtYW5hZ2VyIHVzZXMgdGhlIFN0YXRlIHBhdHRlcm4gaW4gYm90\naCBpdHMgaW50ZXJhY3Rpb24gd2l0aAogKiB0aGUgZ292ZXJuZWQgaW5zdGFu\nY2UgYW5kIGl0cyBpbnRlcmFjdGlvbiB3aXRoIHRoZSBicm9rZXIuCiAqIElu\nIGl0cyBpbnRlcmFjdGlvbnMgd2l0aCB0aGUgcGVyc2lzdGVuY2UgY2FwYWJs\nZSBpbnN0YW5jZSwgaXQgdXNlcyB0aGUKICoge0BsaW5rIEZpZWxkTWFuYWdl\ncn0gaW50ZXJmYWNlLiBTaW1pbGFybHksIHdoZW4gaW50ZXJhY3Rpbmcgd2l0\naCB0aGUKICogYnJva2VyLCBpdCB1c2VzIHRoZSB7QGxpbmsgUENTdGF0ZX0g\nc2luZ2xldG9uIHRoYXQgcmVwcmVzZW50cwogKiB0aGUgY3VycmVudCBsaWZl\nY3ljbGUgc3RhdGUgb2YgdGhlIGluc3RhbmNlLgogKgogKiBAYXV0aG9yIEFi\nZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFN0YXRlTWFuYWdlckltcGwKICAg\nIGltcGxlbWVudHMgT3BlbkpQQVN0YXRlTWFuYWdlciwgU2VyaWFsaXphYmxl\nIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX0ZHUyA9IDA7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX0FMTCA9IDE7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0FEX1NFUklBTElaRSA9IDI7\nCgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfU0FWRSA9IDIg\nPDwgMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0RFUkVG\nID0gMiA8PCAxOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdf\nTE9BREVEID0gMiA8PCAyOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIEZMQUdfUkVBRF9MT0NLRUQgPSAyIDw8IDM7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19XUklURV9MT0NLRUQgPSAyIDw8IDQ7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19PSURfQVNTSUdORUQgPSAy\nIDw8IDU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19MT0FE\nSU5HID0gMiA8PCA2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfUFJFX0RFTEVUSU5HID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfRkxVU0hFRCA9IDIgPDwgODsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX1BSRV9GTFVTSEVEID0gMiA8PCA5Owog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hFRF9ESVJU\nWSA9IDIgPDwgMTA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19JTVBMX0NBQ0hFID0gMiA8PCAxMTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX0lOVkVSU0VTID0gMiA8PCAxMjsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX05PX1VOUFJPWFkgPSAyIDw8IDEzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfVkVSU0lPTl9DSEVD\nSyA9IDIgPDwgMTQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxB\nR19WRVJTSU9OX1VQREFURSA9IDIgPDwgMTU7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19ERVRBQ0hJTkcgPSAyIDw8IDE2OwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UKICAgICAgICAoU3RhdGVNYW5hZ2VySW1wbC5jbGFzcyk7\nCgogICAgLy8gaW5mb3JtYXRpb24gYWJvdXQgdGhlIGluc3RhbmNlCiAgICBw\ncml2YXRlIHRyYW5zaWVudCBQZXJzaXN0ZW5jZUNhcGFibGUgX3BjID0gbnVs\nbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTWV0YURhdGEgX21ldGEg\nPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51bGw7CiAg\nICBwcml2YXRlIEJpdFNldCBfZGlydHkgPSBudWxsOwogICAgcHJpdmF0ZSBC\naXRTZXQgX2ZsdXNoID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9mbGFncyA9\nIDA7CgogICAgLy8gaWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRlbnRpdHk7\nIG9pZCBpcyB0aGUgcGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAogICAgLy8g\nbWF5IGJlIG51bGwgZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQtdHJhbnNh\nY3Rpb25hbCBvYmplY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2VzIHRoYXQg\naGF2ZW4ndCBiZWVuIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJlYXNzaWdu\nZWQgdG8gb2lkCiAgICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3NpZ25tZW50\nIChvciBmbHVzaCBjb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMKICAgIC8v\nIGR1cmluZyBmbHVzaCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9IG51bGw7\nCiAgICBwcml2YXRlIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAvLyB0aGUg\nbWFuYWdpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5Y2xlIHN0\nYXRlCiAgICBwcml2YXRlIHRyYW5zaWVudCBCcm9rZXJJbXBsIF9icm9rZXI7\nIC8vIHRoaXMgaXMgc2VyaWFsaXplZCBzcGVjaWFsbHkKICAgIHByaXZhdGUg\nUENTdGF0ZSBfc3RhdGUgPSBQQ1N0YXRlLlRSQU5TSUVOVDsKCiAgICAvLyB0\naGUgY3VycmVudCBhbmQgbGFzdCBsb2FkZWQgdmVyc2lvbiBpbmRpY2F0b3Jz\nLCBhbmQgdGhlIGxvY2sgb2JqZWN0CiAgICBwcml2YXRlIE9iamVjdCBfdmVy\nc2lvbiA9IG51bGw7CiAgICBwcml2YXRlIE9iamVjdCBfbG9hZFZlcnNpb24g\nPSBudWxsOwogICAgcHJpdmF0ZSBPYmplY3QgX2xvY2sgPSBudWxsOwogICAg\ncHJpdmF0ZSBpbnQgX3JlYWRMb2NrTGV2ZWwgPSAtMTsKICAgIHByaXZhdGUg\naW50IF93cml0ZUxvY2tMZXZlbCA9IC0xOwoKICAgIC8vIGRlbGVnYXRlcyB3\naGVuIHByb3ZpZGluZy9yZXBsYWNpbmcgaW5zdGFuY2UgZGF0YQogICAgcHJp\ndmF0ZSBTaW5nbGVGaWVsZE1hbmFnZXIgX3NpbmdsZSA9IG51bGw7CiAgICBw\ncml2YXRlIFNhdmVGaWVsZE1hbmFnZXIgX3NhdmVkID0gbnVsbDsKICAgIHBy\naXZhdGUgRmllbGRNYW5hZ2VyIF9mbSA9IG51bGw7CgogICAgLy8gaW1wbGRh\ndGE7IGZpZWxkIGltcGxkYXRhIGFuZCBpbnRlcm1lZGlhdGUgZGF0YSBzaGFy\nZSB0aGUgc2FtZSBhcnJheQogICAgcHJpdmF0ZSBPYmplY3QgX2ltcGwgPSBu\ndWxsOwogICAgcHJpdmF0ZSBPYmplY3RbXSBfZmllbGRJbXBsID0gbnVsbDsK\nCiAgICAvLyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgb3duZXIgb2YgdGhpcyBp\nbnN0YW5jZSwgaWYgaXQgaXMgZW1iZWRkZWQKICAgIHByaXZhdGUgU3RhdGVN\nYW5hZ2VySW1wbCBfb3duZXIgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX293\nbmVySW5kZXggPSAtMTsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBz\ndXBwbHkgaWQsIHR5cGUgbWV0YWRhdGEsIGFuZCBvd25pbmcgcGVyc2lzdGVu\nY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0YXRlTWFuYWdl\nckltcGwoT2JqZWN0IGlkLCBDbGFzc01ldGFEYXRhIG1ldGEsIAogICAgICAg\nIEJyb2tlckltcGwgYnJva2VyKSB7CiAgICAgICAgX2lkID0gaWQ7CiAgICAg\nICAgX21ldGEgPSBtZXRhOwogICAgICAgIF9icm9rZXIgPSBicm9rZXI7CiAg\nICAgICAgX3NpbmdsZSA9IG5ldyBTaW5nbGVGaWVsZE1hbmFnZXIodGhpcywg\nYnJva2VyKTsKCiAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfVU5LTk9XTikKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93bmlk\nIiwgX21ldGEpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgb3du\naW5nIHN0YXRlIGFuZCBmaWVsZCBpZiB0aGlzIGlzIGFuIGVtYmVkZGVkIGlu\nc3RhbmNlLgogICAgICovCiAgICB2b2lkIHNldE93bmVyKFN0YXRlTWFuYWdl\nckltcGwgb3duZXIsIFZhbHVlTWV0YURhdGEgb3duZXJNZXRhKSB7CiAgICAg\nICAgX293bmVyID0gb3duZXI7CiAgICAgICAgX293bmVySW5kZXggPSBvd25l\nck1ldGEuZ2V0RmllbGRNZXRhRGF0YSgpLmdldEluZGV4KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgc3RhdGUgbWFuYWdlciBpcyBp\nbiB0aGUgbWlkZGxlIG9mIGEgbG9hZC4KICAgICAqLwogICAgYm9vbGVhbiBp\nc0xvYWRpbmcoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0xP\nQURJTkcpID4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhp\ncyBzdGF0ZSBtYW5hZ2VyIGlzIGluIHRoZSBtaWRkbGUgb2YgYSBsb2FkIGlu\naXRpYXRlZAogICAgICogYnkgb3V0c2lkZSBjb2RlOyBmb3IgYW55IGludGVy\nbmFsIG1ldGhvZHMgdGhhdCBjYXVzZSBsb2FkaW5nLCB0aGUKICAgICAqIGxv\nYWRpbmcgZmxhZyBpcyBzZXQgYXV0b21hdGljYWxseS4KICAgICAqLwogICAg\ndm9pZCBzZXRMb2FkaW5nKGJvb2xlYW4gbG9hZGluZykgewogICAgICAgIGlm\nIChsb2FkaW5nKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FESU5H\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0xP\nQURJTkc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb3IgcmVzZXQgdGhl\nIGxpZmVjeWNsZSBzdGF0ZSBvZiB0aGUgbWFuYWdlZCBpbnN0YW5jZS4gSWYg\ndGhlCiAgICAgKiB0cmFuc2FjdGlvbmFsIHN0YXRlIG9mIHRoZSBpbnN0YW5j\nZSBjaGFuZ2VzLCBpdCB3aWxsIGJlIGVubGlzdGVkLwogICAgICogZGVsaXN0\nZWQgZnJvbSB0aGUgY3VycmVudCB0cmFuc2FjdGlvbiBhcyBuZWNlc3Nhcnku\nIFRoZSBnaXZlbgogICAgICogc3RhdGUgd2lsbCBiZSBpbml0aWFsaXplZCBh\nZnRlciBiZWluZyBzZXQuIElmIHRoZSBnaXZlbiBzdGF0ZQogICAgICogaXMg\ndGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgc3RhdGUsIHRoaXMgbWV0aG9kIHdp\nbGwgaGF2ZSBubyBlZmZlY3QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\nZXRQQ1N0YXRlKFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAoX3N0YXRl\nID09IHN0YXRlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBub3RpZnkgdGhlIHN0\nb3JlIG1hbmFnZXIgdGhhdCB3ZSdyZSBjaGFuZ2luZyBzdGF0ZXM7IGNhbiB2\nZXRvCiAgICAgICAgICAgIF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkuYmVm\nb3JlU3RhdGVDaGFuZ2UodGhpcywgX3N0YXRlLCBzdGF0ZSk7CgogICAgICAg\nICAgICAvLyByZXBsYWNlIHN0YXRlCiAgICAgICAgICAgIGJvb2xlYW4gd2Fz\nRGVsZXRlZCA9IF9zdGF0ZS5pc0RlbGV0ZWQoKTsKICAgICAgICAgICAgYm9v\nbGVhbiB3YXNEaXJ0eSA9IF9zdGF0ZS5pc0RpcnR5KCk7CiAgICAgICAgICAg\nIGJvb2xlYW4gd2FzUGVuZGluZyA9IF9zdGF0ZS5pc1BlbmRpbmdUcmFuc2Fj\ndGlvbmFsKCk7CiAgICAgICAgICAgIF9zdGF0ZSA9IHN0YXRlOwoKICAgICAg\nICAgICAgLy8gZW5saXN0L2RlbGlzdCBmcm9tIHRyYW5zYWN0aW9uCiAgICAg\nICAgICAgIGlmIChfc3RhdGUuaXNUcmFuc2FjdGlvbmFsKCkpIHsKICAgICAg\nICAgICAgICAgIF9icm9rZXIuYWRkVG9UcmFuc2FjdGlvbih0aGlzKTsKICAg\nICAgICAgICAgICAgIGlmIChfc3RhdGUuaXNEZWxldGVkKCkgIT0gd2FzRGVs\nZXRlZCkKICAgICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRo\naXMsICF3YXNEaXJ0eSB8fCBpc0ZsdXNoZWQoKSk7CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChfc3RhdGUuaXNEaXJ0eSgpICYmICF3YXNEaXJ0eSkKICAg\nICAgICAgICAgICAgICAgICBfYnJva2VyLnNldERpcnR5KHRoaXMsIHRydWUp\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKCF3YXNQZW5kaW5nICYmIF9zdGF0\nZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCkpCiAgICAgICAgICAgICAgICBf\nYnJva2VyLmFkZFRvUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAg\nICAgICBlbHNlIGlmICh3YXNQZW5kaW5nICYmICFfc3RhdGUuaXNQZW5kaW5n\nVHJhbnNhY3Rpb25hbCgpKQogICAgICAgICAgICAgICAgX2Jyb2tlci5yZW1v\ndmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9uKHRoaXMpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZUZyb21UcmFuc2Fj\ndGlvbih0aGlzKTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUKICAgICAg\nICAgICAgX3N0YXRlLmluaXRpYWxpemUodGhpcyk7CiAgICAgICAgICAgIGlm\nIChfc3RhdGUuaXNEZWxldGVkKCkgJiYgIXdhc0RlbGV0ZWQpCiAgICAgICAg\nICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZU\nRVJfREVMRVRFKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIHZvaWQgaW5pdGlhbGl6\nZShDbGFzcyBjbHMsIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICAvLyBjaGVj\nayB0byBzZWUgaWYgb3VyIGN1cnJlbnQgb2JqZWN0IGlkIGluc3RhbmNlIGlz\nIHRoZQogICAgICAgIC8vIGNvcnJlY3QgaWQgdHlwZSBmb3IgdGhlIHNwZWNp\nZmllZCBjbGFzczsgdGhpcyBpcyBmb3IgY2FzZXMKICAgICAgICAvLyB3aGVu\nIHdlIGhhdmUgYW4gYXBwbGljYXRpb24gaWQgaGllcmFyY2h5IGFuZCB3ZSBo\nYWQgc2V0IHRoZQogICAgICAgIC8vIG1ldGFkYXRhIHRvIGEgc3VwZXJjbGFz\ncyBpZCAtLSB0aGUgc3ViY2xhc3MnIGlkIG1heSBiZSBhCiAgICAgICAgLy8g\nZGlmZmVyZW50IGNsYXNzLCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGl0CiAgICAg\nICAgaWYgKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSAhPSBjbHMpIHsKICAg\nICAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdWIgPSBfbWV0YS5nZXRSZXBvc2l0\nb3J5KCkuZ2V0TWV0YURhdGEKICAgICAgICAgICAgICAgIChjbHMsIF9icm9r\nZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChf\nb2lkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJ\nZGVudGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkK\nICAgICAgICAgICAgICAgICAgICBfb2lkID0gX2Jyb2tlci5nZXRTdG9yZU1h\nbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQoX29pZCwKICAgICAgICAgICAgICAg\nICAgICAgICAgc3ViKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9tZXRh\nLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgICAgICAgICAgX29p\nZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgc3ViKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKHN1Yi5nZXRPYmplY3RJZFR5cGUoKSAhPSBfbWV0\nYS5nZXRPYmplY3RJZFR5cGUoKSkgewogICAgICAgICAgICAgICAgICAgIE9i\namVjdFtdIHBrRmllbGRzID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhf\nb2lkLCBfbWV0YSk7CiAgICAgICAgICAgICAgICAgICAgX29pZCA9IEFwcGxp\nY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhwa0ZpZWxkcywgc3ViKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfbWV0YSA9\nIHN1YjsKICAgICAgICB9CgogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBp\nbnN0ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShjbHMsIHRoaXMsIF9vaWQs\nIHRydWUpOwogICAgICAgIGlmIChpbnN0ID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gdGhlIGluc3RhbmNlIHdhcyBudWxsOiBjaGVjayB0byBzZWUgaWYg\ndGhlIGluc3RhbmNlIGlzCiAgICAgICAgICAgIC8vIGFic3RyYWN0IChhcyBj\nYW4gc29tZXRpbWVzIGJlIHRoZSBjYXNlIHdoZW4gdGhlCiAgICAgICAgICAg\nIC8vIGNsYXNzIGRpc2NyaW1pbmF0b3Igc3RyYXRlZ3kgaXMgbm90IGNvbmZp\nZ3VyZWQgY29ycmVjdGx5KQogICAgICAgICAgICBpZiAoTW9kaWZpZXIuaXNB\nYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImluc3RhbnRpYXRl\nLWFic3RyYWN0IiwKICAgICAgICAgICAgICAgICAgICBjbHMuZ2V0TmFtZSgp\nLCBfb2lkKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaW5pdGlhbGl6ZShpbnN0LCBz\ndGF0ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHdpdGgg\ndGhlIGdpdmVuIGluc3RhbmNlIGFuZCBzdGF0ZS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgaW5pdGlhbGl6ZShQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBpZiAocGMgPT0gbnVsbCkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlu\naXQtbnVsbC1wYyIsIF9tZXRhKSk7CiAgICAgICAgaWYgKHBjLnBjR2V0U3Rh\ndGVNYW5hZ2VyKCkgIT0gbnVsbCAmJiBwYy5wY0dldFN0YXRlTWFuYWdlcigp\nICE9IHRoaXMpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJpbml0LXNtLXBjIiwKICAgICAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcocGMpKSkuc2V0RmFpbGVkT2JqZWN0KHBjKTsKICAg\nICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIodGhpcyk7CgogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CiAg\nICAgICAgX2xvYWRlZCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAg\nICAgIF9mbHVzaCA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAg\nIF9kaXJ0eSA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgLy8gbWFyayBwcmltYXJ5IGtleSBhbmQgbm9uLXBlcnNpc3RlbnQg\nZmllbGRzIGFzIGxvYWRlZAogICAgICAgICAgICBpZiAoZm1kc1tpXS5pc1By\naW1hcnlLZXkoKQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRNYW5h\nZ2VtZW50KCkgIT0gZm1kc1tpXS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAg\nICAgICAgICAgIF9sb2FkZWQuc2V0KGkpOwoKICAgICAgICAgICAgLy8gcmVj\nb3JkIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBtYW5hZ2VkIGludmVyc2UgZmll\nbGRzCiAgICAgICAgICAgIGlmIChfYnJva2VyLmdldEludmVyc2VNYW5hZ2Vy\nKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgZm1kc1tpXS5nZXRJbnZl\ncnNlTWV0YURhdGFzKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX0lOVkVSU0VTOwogICAgICAgIH0KCiAgICAgICAgcGMu\ncGNTZXREZXRhY2hlZFN0YXRlKG51bGwpOwogICAgICAgIF9wYyA9IHBjOwoK\nICAgICAgICBpZiAoX29pZCBpbnN0YW5jZW9mIE9wZW5KUEFJZCkKICAgICAg\nICAgICAgKChPcGVuSlBBSWQpIF9vaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5\ncGUoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgLy8gaW5p\ndGlhbGl6ZSBvdXIgc3RhdGUgYW5kIGFkZCBvdXJzZWx2ZXMgdG8gdGhlIGJy\nb2tlcidzIGNhY2hlCiAgICAgICAgc2V0UENTdGF0ZShzdGF0ZSk7CiAgICAg\nICAgaWYgKCBfb2lkID09IG51bGwgfHwgIAogICAgICAgICAgICBfYnJva2Vy\nLmdldFN0YXRlTWFuYWdlckltcGxCeUlkKF9vaWQsIGZhbHNlKSA9PSBudWxs\nKSB7CiAgICAgICAgCV9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKF9pZCwgdGhp\ncywgQnJva2VySW1wbC5TVEFUVVNfSU5JVCk7CiAgICAgICAgfQogICAgICAg\nIGlmIChzdGF0ZSA9PSBQQ1N0YXRlLlBORVcpCiAgICAgICAgICAgIGZpcmVM\naWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9QRVJTSVNUKTsK\nCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIG5vbi10cmFja2luZyBQQywgYWRk\nIGEgaGFyZCByZWYgdG8gdGhlIGFwcHJvcHJpYXRlIGRhdGEKICAgICAgICAv\nLyBzZXRzIGFuZCBnaXZlIGl0IGFuIG9wcG9ydHVuaXR5IHRvIG1ha2UgYSBz\ndGF0ZSBzbmFwc2hvdC4KICAgICAgICBpZiAoIWlzSW50ZXJjZXB0aW5nKCkp\nIHsKICAgICAgICAgICAgc2F2ZUZpZWxkcyh0cnVlKTsKICAgICAgICAgICAg\naWYgKCFpc05ldygpKQogICAgICAgICAgICAgICAgUmVkZWZpbml0aW9uSGVs\ncGVyLmFzc2lnbkxhenlMb2FkUHJveGllcyh0aGlzKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9yIG5vdCBkYXRhIGFjY2Vz\ncyBpbiB0aGlzIGluc3RhbmNlIGlzIGludGVyY2VwdGVkLiBUaGlzIGRpZmZl\ncnMKICAgICAqIGZyb20ge0BsaW5rIENsYXNzTWV0YURhdGEjaXNJbnRlcmNl\ncHRpbmcoKX0gaW4gdGhhdCBpdCBjaGVja3MgZm9yCiAgICAgKiBwcm9wZXJ0\neSBhY2Nlc3MgKyBzdWJjbGFzc2luZyBpbiBhZGRpdGlvbiB0byB0aGUgcmVk\nZWZpbml0aW9uIC8KICAgICAqIGVuaGFuY2VtZW50IGNoZWNrcy4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4wLjAKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNJbnRlcmNlcHRpbmcoKSB7CiAgICAgICAgaWYgKGdldE1ldGFEYXRh\nKCkuaXNJbnRlcmNlcHRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgaWYgKGdldE1ldGFEYXRhKCkuZ2V0QWNjZXNzVHlwZSgpICE9\nIENsYXNzTWV0YURhdGEuQUNDRVNTX0ZJRUxECiAgICAgICAgICAgICYmIF9w\nYyBpbnN0YW5jZW9mIER5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGUpCiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBGaXJlIHRoZSBnaXZlbiBsaWZlY3ljbGUg\nZXZlbnQgdG8gYWxsIGxpc3RlbmVycy4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGZpcmVMaWZlY3ljbGVFdmVudChpbnQgdHlwZSkgewogICAgICAg\nIHJldHVybiBfYnJva2VyLmZpcmVMaWZlY3ljbGVFdmVudChnZXRNYW5hZ2Vk\nSW5zdGFuY2UoKSwgbnVsbCwKICAgICAgICAgICAgX21ldGEsIHR5cGUpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGxvYWQoRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoKSB7CiAgICAgICAgbG9hZChmZXRjaCwgTE9BRF9GR1MsIG51bGws\nIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhl\nIHN0YXRlIG9mIHRoaXMgaW5zdGFuY2UgYmFzZWQgb24gdGhlIGdpdmVuIGZl\ndGNoIGNvbmZpZ3VyYXRpb24KICAgICAqIGFuZCBsb2FkIG1vZGUuIFJldHVy\nbiB0cnVlIGlmIGFueSBkYXRhIHdhcyBsb2FkZWQsIGZhbHNlIG90aGVyd2lz\nZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gbG9hZChGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIGludCBsb2FkTW9kZSwKICAgICAgICBCaXRT\nZXQgZXhjbHVkZSwgT2JqZWN0IHNkYXRhLCBib29sZWFuIGZvcldyaXRlKSB7\nCiAgICAgICAgaWYgKCFmb3JXcml0ZSAmJiAoIWlzUGVyc2lzdGVudCgpIHx8\nIGlzTmV3KCkgfHwgaXNEZWxldGVkKCkpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIC8vIGlmIGFueSBmaWVsZHMgYmVpbmcgbG9hZGVk\nLCBkbyBzdGF0ZSB0cmFuc2l0aW9ucyBmb3IgcmVhZAogICAgICAgIEJpdFNl\ndCBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBsb2FkTW9k\nZSwgZXhjbHVkZSk7CiAgICAgICAgYm9vbGVhbiBhY3RpdmUgPSBfYnJva2Vy\nLmlzQWN0aXZlKCk7CiAgICAgICAgaWYgKCFmb3JXcml0ZSAmJiBmaWVsZHMg\nIT0gbnVsbCkKICAgICAgICAgICAgYmVmb3JlUmVhZCgtMSk7CgogICAgICAg\nIC8vIGNhbGwgbG9hZCBldmVuIGlmIG5vIGZpZWxkcyBhcmUgYmVpbmcgbG9h\nZGVkLCBiZWNhdXNlIGl0IHRha2VzCiAgICAgICAgLy8gY2FyZSBvZiBjaGVj\na2luZyBpZiB0aGUgREZHIGlzIGxvYWRlZCwgbWFraW5nIHN1cmUgdmVyc2lv\nbiBpbmZvCiAgICAgICAgLy8gaXMgbG9hZGVkLCBldGMKICAgICAgICBpbnQg\nbG9ja0xldmVsID0gY2FsY3VsYXRlTG9ja0xldmVsKGFjdGl2ZSwgZm9yV3Jp\ndGUsIGZldGNoKTsKICAgICAgICBib29sZWFuIHJldCA9IGxvYWRGaWVsZHMo\nZmllbGRzLCBmZXRjaCwgbG9ja0xldmVsLCBzZGF0YSk7CiAgICAgICAgb2J0\nYWluTG9ja3MoYWN0aXZlLCBmb3JXcml0ZSwgbG9ja0xldmVsLCBmZXRjaCwg\nc2RhdGEpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRNYW5hZ2VkSW5zdGFuY2UoKSB7CiAgICAgICAgaWYgKF9w\nYyBpbnN0YW5jZW9mIE1hbmFnZWRJbnN0YW5jZVByb3ZpZGVyKQogICAgICAg\nICAgICByZXR1cm4gKChNYW5hZ2VkSW5zdGFuY2VQcm92aWRlcikgX3BjKS5n\nZXRNYW5hZ2VkSW5zdGFuY2UoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHJldHVybiBfcGM7CiAgICB9CgogICAgcHVibGljIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBnZXRQZXJzaXN0ZW5jZUNhcGFibGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9wYzsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0YSBnZXRNZXRh\nRGF0YSgpIHsKICAgICAgICByZXR1cm4gX21ldGE7CiAgICB9CgogICAgcHVi\nbGljIE9wZW5KUEFTdGF0ZU1hbmFnZXIgZ2V0T3duZXIoKSB7CiAgICAgICAg\ncmV0dXJuIF9vd25lcjsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldE93bmVy\nSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9vd25lckluZGV4OwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9vd25lciAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzRmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdf\nRkxVU0hFRCkgPiAwOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRmx1\nc2hlZERpcnR5KCkgewogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19G\nTFVTSEVEX0RJUlRZKSA+IDA7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBn\nZXRMb2FkZWQoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZWQ7CiAgICB9Cgog\nICAgcHVibGljIEJpdFNldCBnZXRGbHVzaGVkKCkgewogICAgICAgIHJldHVy\nbiBfZmx1c2g7CiAgICB9CgogICAgcHVibGljIEJpdFNldCBnZXREaXJ0eSgp\nIHsKICAgICAgICByZXR1cm4gX2RpcnR5OwogICAgfQoKICAgIHB1YmxpYyBC\naXRTZXQgZ2V0VW5sb2FkZWQoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7\nCiAgICAgICAgLy8gY29sbGVjdCBmaWVsZHMgdG8gbG9hZCBmcm9tIGRhdGEg\nc3RvcmUgYmFzZWQgb24gZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICAgIEJp\ndFNldCBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FE\nX0ZHUywgbnVsbCk7CiAgICAgICAgcmV0dXJuIChmaWVsZHMgPT0gbnVsbCkg\nPyBuZXcgQml0U2V0KDApIDogZmllbGRzOwogICAgfQoKICAgIC8qKgogICAg\nICogSW50ZXJuYWwgdmVyc2lvbiBvZiB7QGxpbmsgT3BlbkpQQVN0YXRlTWFu\nYWdlciNnZXRVbmxvYWRlZH0gdGhhdCBhdm9pZHMKICAgICAqIGNyZWF0aW5n\nIGFuIGVtcHR5IGJpdCBzZXQgYnkgcmV0dXJuaW5nIG51bGwgd2hlbiB0aGVy\nZSBhcmUgbm8gdW5sb2FkZWQKICAgICAqIGZpZWxkcy4KICAgICAqLwogICAg\ncHJpdmF0ZSBCaXRTZXQgZ2V0VW5sb2FkZWRJbnRlcm5hbChGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIGludCBtb2RlLAogICAgICAgIEJpdFNldCBleGNs\ndWRlKSB7CiAgICAgICAgaWYgKGV4Y2x1ZGUgPT0gU3RvcmVDb250ZXh0LkVY\nQ0xVREVfQUxMKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nQml0U2V0IGZpZWxkcyA9IG51bGw7CiAgICAgICAgRmllbGRNZXRhRGF0YVtd\nIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBib29sZWFuIGxv\nYWQ7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChpKSB8fCAoZXhj\nbHVkZSAhPSBudWxsICYmIGV4Y2x1ZGUuZ2V0KGkpKSkKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIExPQURfU0VSSUFMSVpFOgogICAgICAgICAg\nICAgICAgICAgIGxvYWQgPSAhZm1kc1tpXS5pc1RyYW5zaWVudCgpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBM\nT0FEX0ZHUzoKICAgICAgICAgICAgICAgICAgICBsb2FkID0gZmV0Y2ggPT0g\nbnVsbCB8fCBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtZHNbaV0pIAogICAgICAg\nICAgICAgICAgICAgICAgICAhPSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hf\nTk9ORTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGRlZmF1bHQ6IC8vIExPQURfQUxMCiAgICAgICAgICAgICAgICAgICAg\nbG9hZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChs\nb2FkKSB7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRzID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJpdFNldChmbWRzLmxl\nbmd0aCk7CiAgICAgICAgICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmaWVsZHM7CiAgICB9\nCgogICAgcHVibGljIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAg\nICAgIHJldHVybiBfYnJva2VyOwogICAgfQoKICAgIC8qKgogICAgICogTWFu\nYWdpbmcgYnJva2VyLgogICAgICovCiAgICBCcm9rZXJJbXBsIGdldEJyb2tl\ncigpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldElkKCkgewogICAgICAgIHJldHVybiBfaWQ7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBnZXRPYmplY3RJZCgpIHsKICAgICAgICBT\ndGF0ZU1hbmFnZXJJbXBsIHNtID0gdGhpczsKICAgICAgICB3aGlsZSAoc20u\nZ2V0T3duZXIoKSAhPSBudWxsKQogICAgICAgICAgICBzbSA9IChTdGF0ZU1h\nbmFnZXJJbXBsKSBzbS5nZXRPd25lcigpOwogICAgICAgIHJldHVybiBzbS5f\nb2lkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE9iamVjdElkKE9iamVj\ndCBvaWQpIHsKICAgICAgICBfb2lkID0gb2lkOwogICAgICAgIGlmIChfcGMg\nIT0gbnVsbCAmJiBvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQpCiAgICAgICAg\nICAgICgoT3BlbkpQQUlkKSBvaWQpLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUo\nX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBhc3NpZ25PYmplY3RJZChib29sZWFuIGZsdXNoKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBh\nc3NpZ25PYmplY3RJZChmbHVzaCwgZmFsc2UpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEFzayBzdG9yZSBtYW5hZ2VyIHRvIGFzc2lnbiBvdXIg\nb2lkLCBvcHRpb25hbGx5IGZsdXNoaW5nIGFuZAogICAgICogb3B0aW9uYWxs\neSByZWNhY2hpbmcgb24gdGhlIG5ldyBvaWQuCiAgICAgKi8KICAgIGJvb2xl\nYW4gYXNzaWduT2JqZWN0SWQoYm9vbGVhbiBmbHVzaCwgYm9vbGVhbiBwcmVG\nbHVzaGluZykgewogICAgICAgIGlmIChfb2lkICE9IG51bGwgfHwgaXNFbWJl\nZGRlZCgpIHx8ICFpc1BlcnNpc3RlbnQoKSkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CgogICAgICAgIGlmIChfYnJva2VyLmdldFN0b3JlTWFuYWdlcigp\nLmFzc2lnbk9iamVjdElkKHRoaXMsIHByZUZsdXNoaW5nKSkgewogICAgICAg\nICAgICBpZiAoIXByZUZsdXNoaW5nKQogICAgICAgICAgICAgICAgYXNzZXJ0\nT2JqZWN0SWRBc3NpZ25lZCh0cnVlKTsKICAgICAgICB9IGVsc2UgaWYgKGZs\ndXNoKQogICAgICAgICAgICBfYnJva2VyLmZsdXNoKCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIHN1cmUgd2Ugd2VyZSBh\nc3NpZ25lZCBhbiBvaWQsIGFuZCBwZXJmb3JtIGFjdGlvbnMgdG8gbWFrZSBp\ndAogICAgICogcGVybWFuZW50LgogICAgICoKICAgICAqIEBwYXJhbSByZWNh\nY2hlIHdoZXRoZXIgdG8gcmVjYWNoZSBvdXJzZWxmIG9uIHRoZSBuZXcgb2lk\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3NlcnRPYmplY3RJZEFzc2ln\nbmVkKGJvb2xlYW4gcmVjYWNoZSkgewogICAgICAgIGlmICghaXNOZXcoKSB8\nfCBpc0RlbGV0ZWQoKSB8fCBpc1Byb3Zpc2lvbmFsKCkgCiAgICAgICAgICAg\nIHx8IChfZmxhZ3MgJiBGTEFHX09JRF9BU1NJR05FRCkgIT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIGlmIChfb2lkID09IG51bGwpIHsKICAg\nICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNz\nTWV0YURhdGEuSURfREFUQVNUT1JFKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKEV4Y2VwdGlvbnMudG9TdHJpbmcKICAg\nICAgICAgICAgICAgICAgICAoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKTsKICAg\nICAgICAgICAgX29pZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShfcGMsIF9t\nZXRhKTsKICAgICAgICB9CgogICAgICAgIE9iamVjdCBvcmlnID0gX2lkOwog\nICAgICAgIF9pZCA9IF9vaWQ7CiAgICAgICAgaWYgKHJlY2FjaGUpIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIF9icm9rZXIuc2V0U3Rh\ndGVNYW5hZ2VyKG9yaWcsIHRoaXMsCiAgICAgICAgICAgICAgICAgICAgQnJv\na2VySW1wbC5TVEFUVVNfT0lEX0FTU0lHTik7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgICAgIF9p\nZCA9IG9yaWc7CiAgICAgICAgICAgICAgICBfb2lkID0gbnVsbDsKICAgICAg\nICAgICAgICAgIHRocm93IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIF9mbGFncyB8PSBGTEFHX09JRF9BU1NJR05FRDsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFzc2lnbiB0aGUgcHJvcGVyIGdlbmVyYXRlZCB2YWx1\nZSB0byB0aGUgZ2l2ZW4gZmllbGQgYmFzZWQgb24gaXRzCiAgICAgKiB2YWx1\nZS1zdHJhdGVneS4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGFzc2ln\nbkZpZWxkKGludCBmaWVsZCwgYm9vbGVhbiBwcmVGbHVzaGluZykgewogICAg\nICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSB0aGlzOwogICAgICAgIHdo\naWxlIChzbS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgIHNtID0gc20uZ2V0\nT3duZXIoKTsKICAgICAgICBpZiAoIXNtLmlzTmV3KCkgfHwgc20uaXNGbHVz\naGVkKCkgfHwgc20uaXNEZWxldGVkKCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgLy8gc3BlY2lhbC1jYXNlIG9pZCBmaWVsZHMsIHdo\naWNoIHJlcXVpcmUgdXMgdG8gbG9vayBpbnNpZGUgdGhlIG9pZAogICAgICAg\nIC8vIG9iamVjdAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpIHsKICAgICAgICAgICAgLy8g\ndHJ5IHRvIHNob3J0Y3V0IGlmIHBvc3NpYmxlCiAgICAgICAgICAgIGlmIChf\nb2lkICE9IG51bGwgfHwgaXNFbWJlZGRlZCgpIHx8ICFpc1BlcnNpc3RlbnQo\nKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAgICAg\nLy8gY2hlY2sgZW1iZWRkZWQgZmllbGRzIG9mIG9pZCBmb3IgdmFsdWUgc3Ry\nYXRlZ3kgKyBkZWZhdWx0IHZhbHVlCiAgICAgICAgICAgIEZpZWxkTWV0YURh\ndGFbXSBwa3MgPSBmbWQuZ2V0RW1iZWRkZWRNZXRhRGF0YSgpLmdldEZpZWxk\ncygpOwogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIG9pZHNtID0g\nbnVsbDsKICAgICAgICAgICAgYm9vbGVhbiBhc3NpZ24gPSBmYWxzZTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7ICFhc3NpZ24gJiYgaSA8IHBrcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHBrc1tpXS5nZXRW\nYWx1ZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJhdGVnaWVzLk5PTkUpCiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAo\nb2lkc20gPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBvaWRzbSA9IG5l\ndyBPYmplY3RJZFN0YXRlTWFuYWdlcihmZXRjaE9iamVjdEZpZWxkKGZpZWxk\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcywgZm1kKTsKICAgICAg\nICAgICAgICAgIGFzc2lnbiA9IG9pZHNtLmlzRGVmYXVsdFZhbHVlKGkpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhc3NpZ24gJiYgYXNz\naWduT2JqZWN0SWQoIXByZUZsdXNoaW5nLCBwcmVGbHVzaGluZyk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBKdXN0IHJldHVybiBpZiB0aGVyZSdzIG5vIHZh\nbHVlIGdlbmVyYXRpb24gc3RyYXRlZ3kKICAgICAgICBpZiAoZm1kLmdldFZh\nbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTk9ORSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIAogICAgICAgIC8vIFRocm93\nIGV4Y2VwdGlvbiBpZiBmaWVsZCBhbHJlYWR5IGhhcyBhIHZhbHVlIGFzc2ln\nbmVkLgogICAgICAgIC8vIEBHZW5lcmF0ZWRWYWx1ZSBvdmVycmlkZXMgUE9K\nTyBpbml0aWFsIHZhbHVlcyBhbmQgc2V0dGVyIG1ldGhvZHMKICAgICAgICBp\nZiAoIWZtZC5pc1ZhbHVlR2VuZXJhdGVkKCkgJiYgIWlzRGVmYXVsdFZhbHVl\nKGZpZWxkKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldCgKICAgICAgICAgICAgICAgICJleGlzdGluZy12\nYWx1ZS1vdmVycmlkZS1leGNlcCIsIGZtZC5nZXRGdWxsTmFtZShmYWxzZSkp\nKTsKCiAgICAgICAgLy8gZm9yIHByaW1hcnkga2V5IGZpZWxkcywgYXNzaWdu\nIHRoZSBvYmplY3QgaWQgYW5kIHJlY2FjaGUgc28gdGhhdAogICAgICAgIC8v\nIHRvIHRoZSB1c2VyLCBzbyBpdCBsb29rcyBsaWtlIHRoZSBvaWQgYWx3YXlz\nIG1hdGNoZXMgdGhlIHBrIGZpZWxkcwogICAgICAgIGlmIChmbWQuaXNQcmlt\nYXJ5S2V5KCkgJiYgIWlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIGFzc2lnbk9iamVjdElkKCFwcmVGbHVzaGluZywgcHJlRmx1c2hpbmcpOwoK\nICAgICAgICAvLyBmb3Igb3RoZXIgZmllbGRzIGp1c3QgYXNzaWduIHRoZSBm\naWVsZCBvciBmbHVzaCBpZiBuZWVkZWQKICAgICAgICBpZiAoX2Jyb2tlci5n\nZXRTdG9yZU1hbmFnZXIoKS5hc3NpZ25GaWVsZCh0aGlzLCBmaWVsZCwgcHJl\nRmx1c2hpbmcpKSB7CiAgICAgICAgICAgIGZtZC5zZXRWYWx1ZUdlbmVyYXRl\nZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQog\nICAgICAgIGlmICghcHJlRmx1c2hpbmcpCiAgICAgICAgICAgIF9icm9rZXIu\nZmx1c2goKTsKICAgICAgICByZXR1cm4gIXByZUZsdXNoaW5nOwogICAgfQoK\nICAgIHB1YmxpYyBPYmplY3QgZ2V0TG9jaygpIHsKICAgICAgICByZXR1cm4g\nX2xvY2s7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TG9jayhPYmplY3Qg\nbG9jaykgewogICAgICAgIF9sb2NrID0gbG9jazsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF92ZXJz\naW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb24oT2JqZWN0\nIHZlcnNpb24pIHsKICAgICAgICBfbG9hZFZlcnNpb24gPSB2ZXJzaW9uOwog\nICAgICAgIGFzc2lnblZlcnNpb25GaWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAg\nICBPYmplY3QgZ2V0TG9hZFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIF9s\nb2FkVmVyc2lvbjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXROZXh0VmVy\nc2lvbihPYmplY3QgdmVyc2lvbikgewogICAgICAgIGFzc2lnblZlcnNpb25G\naWVsZCh2ZXJzaW9uKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgYXNzaWdu\nVmVyc2lvbkZpZWxkKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAgICAgX3ZlcnNp\nb24gPSB2ZXJzaW9uOwogICAgICAgIEZpZWxkTWV0YURhdGEgdmZpZWxkID0g\nX21ldGEuZ2V0VmVyc2lvbkZpZWxkKCk7CiAgICAgICAgaWYgKHZmaWVsZCAh\nPSBudWxsKQogICAgICAgICAgICBzdG9yZSh2ZmllbGQuZ2V0SW5kZXgoKSwg\nSmF2YVR5cGVzLmNvbnZlcnQodmVyc2lvbiwKICAgICAgICAgICAgICAgIHZm\naWVsZC5nZXRUeXBlQ29kZSgpKSk7CiAgICB9CgogICAgcHVibGljIFBDU3Rh\ndGUgZ2V0UENTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlOwogICAg\nfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEltcGxEYXRh\nKCkgewogICAgICAgIHJldHVybiBfaW1wbDsKICAgIH0KCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIE9iamVjdCBzZXRJbXBsRGF0YShPYmplY3QgZGF0YSwg\nYm9vbGVhbiBjYWNoZWFibGUpIHsKICAgICAgICBPYmplY3Qgb2xkID0gX2lt\ncGw7CiAgICAgICAgX2ltcGwgPSBkYXRhOwogICAgICAgIGlmIChjYWNoZWFi\nbGUgJiYgZGF0YSAhPSBudWxsKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19JTVBMX0NBQ0hFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX0lNUExfQ0FDSEU7CiAgICAgICAgcmV0dXJuIG9sZDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ltcGxEYXRhQ2FjaGVhYmxlKCkg\newogICAgICAgIHJldHVybiAoX2ZsYWdzICYgRkxBR19JTVBMX0NBQ0hFKSAh\nPSAwOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0SW1wbERhdGEoaW50\nIGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZp\nZWxkLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHNldEltcGxE\nYXRhKGludCBmaWVsZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICByZXR1cm4g\nc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRhdGEsIHRydWUpOwogICAgfQoK\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgYm9vbGVhbiBpc0ltcGxEYXRhQ2Fj\naGVhYmxlKGludCBmaWVsZCkgewogICAgICAgIGlmIChfZmllbGRJbXBsID09\nIG51bGwgfHwgIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIGlmIChfbWV0YS5nZXRGaWVsZChmaWVsZCku\ndXNlc0ltcGxEYXRhKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxkRGF0\nYUluZGV4KGZpZWxkKTsKICAgICAgICByZXR1cm4gaWR4ICE9IC0xICYmIF9m\naWVsZEltcGxbaWR4XSAhPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0SW50ZXJtZWRpYXRlKGludCBmaWVsZCkgewogICAgICAgIHJldHVy\nbiBnZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldEludGVybWVkaWF0ZShpbnQgZmllbGQsIE9iamVj\ndCBkYXRhKSB7CiAgICAgICAgc2V0RXh0cmFGaWVsZERhdGEoZmllbGQsIGRh\ndGEsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZGF0YSBmcm9tIHRoZSBwcm9wZXIgaW5kZXggb2YgdGhlIGV4dHJhIGZpZWxk\nIGRhdGEgYXJyYXkuCiAgICAgKi8KICAgIHByaXZhdGUgc3luY2hyb25pemVk\nIE9iamVjdCBnZXRFeHRyYUZpZWxkRGF0YShpbnQgZmllbGQsIGJvb2xlYW4g\naXNMb2FkZWQpIHsKICAgICAgICAvLyBvbmx5IHJldHVybiB0aGUgZmllbGQg\nZGF0YSBpZiB0aGUgZmllbGQgaXMgaW4gdGhlIHJpZ2h0IGxvYWRlZAogICAg\nICAgIC8vIHN0YXRlOyBvdGhlcndpc2Ugd2UgbWlnaHQgcmV0dXJuIGludGVy\nbWVkaWF0ZSBmb3IgaW1wbCBkYXRhIG9yCiAgICAgICAgLy8gdmljZSB2ZXJz\nYQogICAgICAgIGlmIChfZmllbGRJbXBsID09IG51bGwgfHwgX2xvYWRlZC5n\nZXQoZmllbGQpICE9IGlzTG9hZGVkKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBpbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJ\nbmRleChmaWVsZCk7CiAgICAgICAgcmV0dXJuIChpZHggPT0gLTEpID8gbnVs\nbCA6IF9maWVsZEltcGxbaWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZGF0YSBmcm9tIHRvIHByb3BlciBpbmRleCBvZiB0aGUgZXh0cmEg\nZmllbGQgZGF0YSBhcnJheS4KICAgICAqLwogICAgcHJpdmF0ZSBzeW5jaHJv\nbml6ZWQgT2JqZWN0IHNldEV4dHJhRmllbGREYXRhKGludCBmaWVsZCwgT2Jq\nZWN0IGRhdGEsCiAgICAgICAgYm9vbGVhbiBsb2FkZWQpIHsKICAgICAgICBp\nbnQgaWR4ID0gX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFJbmRleChmaWVsZCk7\nCiAgICAgICAgaWYgKGlkeCA9PSAtMSkKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKFN0cmluZy52YWx1ZU9mKF9tZXRhLmdldEZp\nZWxkKGZpZWxkKSkpOwoKICAgICAgICBPYmplY3Qgb2xkID0gKF9maWVsZElt\ncGwgPT0gbnVsbCkgPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgICAg\nIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gY2Fubm90IHNl\ndCBpZiBmaWVsZCBpbiB3cm9uZyBsb2FkZWQgc3RhdGUKICAgICAgICAgICAg\naWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSAhPSBsb2FkZWQpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZhbHVl\nT2YoX21ldGEuZ2V0RmllbGQKICAgICAgICAgICAgICAgICAgICAoZmllbGQp\nKSk7CgogICAgICAgICAgICAvLyBzZXQgZGF0YQogICAgICAgICAgICBpZiAo\nX2ZpZWxkSW1wbCA9PSBudWxsKQogICAgICAgICAgICAgICAgX2ZpZWxkSW1w\nbCA9IG5ldyBPYmplY3RbX21ldGEuZ2V0RXh0cmFGaWVsZERhdGFMZW5ndGgo\nKV07CiAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IGRhdGE7CiAgICAg\nICAgfSBlbHNlIGlmIChfZmllbGRJbXBsICE9IG51bGwgJiYgX2xvYWRlZC5n\nZXQoZmllbGQpID09IGxvYWRlZCkKICAgICAgICAgICAgX2ZpZWxkSW1wbFtp\nZHhdID0gbnVsbDsKICAgICAgICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZmV0Y2goaW50IGZpZWxkKSB7CiAgICAgICAgT2JqZWN0\nIHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1\ncm4gX21ldGEuZ2V0RmllbGQoZmllbGQpLmdldEV4dGVybmFsVmFsdWUodmFs\nLCBfYnJva2VyKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGZldGNoRmll\nbGQoaW50IGZpZWxkLCBib29sZWFuIHRyYW5zaXRpb25zKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAg\nICAgICAgaWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tZmllbGQiLAogICAgICAgICAg\nICAgICAgU3RyaW5nLnZhbHVlT2YoZmllbGQpLCBnZXRNYW5hZ2VkSW5zdGFu\nY2UoKS5nZXRDbGFzcygpKSkuCiAgICAgICAgICAgICAgICBzZXRGYWlsZWRP\nYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwoKICAgICAgICAvLyBkbyBu\nb3JtYWwgc3RhdGUgdHJhbnNpdGlvbnMKICAgICAgICBpZiAoIWZtZC5pc1By\naW1hcnlLZXkoKSAmJiB0cmFuc2l0aW9ucykKICAgICAgICAgICAgYWNjZXNz\naW5nRmllbGQoZmllbGQpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU1RSSU5HOgogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoU3RyaW5nRmll\nbGQoZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVs\nZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgICAgICByZXR1cm4gKGZldGNoQm9vbGVhbkZpZWxkKGZpZWxkKSkg\nPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6IEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoZmV0Y2hCeXRlRmllbGQoZmll\nbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUjoKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFjdGVyKGZldGNoQ2hhckZpZWxk\nKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRToK\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRG91YmxlKGZldGNoRG91Ymxl\nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxP\nQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZldGNoRmxv\nYXRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5J\nTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVycy52YWx1ZU9mKGZl\ndGNoSW50RmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVl\nT2YoZmV0Y2hMb25nRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNo\nb3J0KGZldGNoU2hvcnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0RmllbGQo\nZmllbGQpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9y\nZShpbnQgZmllbGQsIE9iamVjdCB2YWwpIHsKICAgICAgICB2YWwgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCkuZ2V0RmllbGRWYWx1ZSh2YWwsIF9icm9rZXIp\nOwogICAgICAgIHN0b3JlRmllbGQoZmllbGQsIHZhbCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3RvcmVGaWVsZChpbnQgZmllbGQsIE9iamVjdCB2YWwp\nIHsKICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCB2YWwsIHRoaXMpOwogICAg\nfQoKICAgIC8qKgogICAgICogPHA+Q2hlY2tzIHdoZXRoZXIgb3Igbm90IDxj\nb2RlPl9wYzwvY29kZT4gaXMgZGlydHkuIEluIHRoZSBjYXNlcyB3aGVyZQog\nICAgICogZmllbGQgdHJhY2tpbmcgaXMgbm90IGhhcHBlbmluZyAoc2VlIGJl\nbG93KSwgdGhpcyBtZXRob2Qgd2lsbCBkbyBhCiAgICAgKiBzdGF0ZSBjb21w\nYXJpc29uIHRvIGZpbmQgd2hldGhlciA8Y29kZT5fcGM8L2NvZGU+IGlzIGRp\ncnR5LCBhbmQgd2lsbAogICAgICogdXBkYXRlIHRoaXMgaW5zdGFuY2Ugd2l0\naCB0aGlzIGluZm9ybWF0aW9uLiBJbiB0aGUgY2FzZXMgd2hlcmUgZmllbGQK\nICAgICAqIHRyYWNraW5nIGlzIGhhcHBlbmluZywgdGhpcyBtZXRob2QgaXMg\nYSBuby1vcC48L3A+CiAgICAgKgogICAgICogPHA+RmllbGRzIGFyZSB0cmFj\na2VkIGZvciBhbGwgY2xhc3NlcyB0aGF0IGFyZSBydW4gdGhyb3VnaCB0aGUg\nT3BlbkpQQQogICAgICogZW5oYW5jZXIgcHJpb3IgdG8gb3IgZHVyaW5nIGRl\ncGxveW1lbnQsIGFuZCBhbGwgY2xhc3NlcyAoZW5oYW5jZWQgb3IKICAgICAq\nIHVuZW5oYW5jZWQpIGluIGEgSmF2YSA2IGVudmlyb25tZW50IG9yIG5ld2Vy\nLjwvcD4KICAgICAqCiAgICAgKiA8cD5JbiBhIEphdmEgNSBWTSBvciBvbGRl\ncjoKICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2VkIGNsYXNz\nZXMgdGhhdCB1c2UKICAgICAqIHByb3BlcnR5IGFjY2VzcyBhbmQgb2JleSB0\naGUgcHJvcGVydHkgYWNjZXNzIGxpbWl0YXRpb25zIGFyZSB0cmFja2VkCiAg\nICAgKiB3aGVuIHRoZSBpbnN0YW5jZXMgYXJlIGxvYWRlZCBmcm9tIHRoZSBk\nYXRhYmFzZSBieSBPcGVuSlBBLCBhbmQgYXJlCiAgICAgKiBub3QgdHJhY2tl\nZCB3aGVuIHRoZSBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYnkgYXBwbGljYXRp\nb24gY29kZS4KICAgICAqIDxicj4tIGluc3RhbmNlcyBvZiB1bmVuaGFuY2Vk\nIGNsYXNzZXMgdGhhdCB1c2UgZmllbGQgYWNjZXNzIGFyZQogICAgICogbmV2\nZXIgdHJhY2tlZC48L3A+CiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGRpcnR5Q2hlY2soKSB7CiAgICAgICAg\naWYgKCFuZWVkc0RpcnR5Q2hlY2soKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBTYXZlRmllbGRNYW5hZ2VyIHNhdmVkID0gZ2V0U2F2ZUZpZWxk\nTWFuYWdlcigpOwogICAgICAgIGlmIChzYXZlZCA9PSBudWxsKQogICAgICAg\nICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXNhdmVkLWZpZWxkcyIsCiAgICAgICAgICAgICAgICBnZXRNZXRhRGF0YSgp\nLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpKTsKCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRNZXRhRGF0YSgpLmdldEZpZWxkcygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAvLyBwayBhbmQgdmVyc2lvbiBmaWVsZHMgY2Fu\nbm90IGJlIG11dGF0ZWQ7IGRvbid0IG1hcmsgdGhlbQogICAgICAgICAgICAv\nLyBhcyBzdWNoLiAjIyMjIyB2YWxpZGF0ZT8KICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmlzUHJpbWFyeUtleSgpICYmICFmbWRzW2ldLmlzVmVyc2lvbigp\nCiAgICAgICAgICAgICAgICAmJiBfbG9hZGVkLmdldChpKSkgewogICAgICAg\nICAgICAgICAgaWYgKCFzYXZlZC5pc0ZpZWxkRXF1YWwoaSwgZmV0Y2goaSkp\nKSB7CiAgICAgICAgICAgICAgICAgICAgZGlydHkoaSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSBib29sZWFuIG5lZWRzRGlydHlDaGVjaygpIHsKICAgICAgICBpZiAo\naXNJbnRlcmNlcHRpbmcoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIGlmIChpc0RlbGV0ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIGlmIChpc05ldygpICYmICFpc0ZsdXNoZWQoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hJbml0aWFsRmllbGQoaW50\nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9y\nZVN0YXRlKCkgPT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORQogICAgICAg\nICAgICAmJiAoKF9mbGFncyAmIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAg\nICAgICAgfHwgZm1kLmdldEludmVyc2VNZXRhRGF0YXMoKS5sZW5ndGggPT0g\nMCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoInJlc3RvcmUtdW5zZXQiKSk7CgogICAgICAgIHN3aXRj\naCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5EQVRFOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5DQUxFTkRBUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUg\nbm90IHNhdmluZyBtdXRhYmxlIHR5cGVzLCB0aHJvdyBhbiBleGNlcHRpb24K\nICAgICAgICAgICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgp\nICE9IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX0FMTAogICAgICAgICAgICAgICAg\nICAgICYmICgoX2ZsYWdzICYgRkxBR19JTlZFUlNFUykgPT0gMAogICAgICAg\nICAgICAgICAgICAgIHx8IGZtZC5nZXRJbnZlcnNlTWV0YURhdGFzKCkubGVu\nZ3RoID09IDApKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgKCJtdXRhYmxlLXJlc3RvcmUtdW5zZXQiKSk7CiAgICAgICAgfQoK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKF9zYXZlZCA9PSBudWxsIHx8ICFfbG9hZGVkLmdldChmaWVsZCkgfHwgIV9k\naXJ0eS5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZldGNo\nRmllbGQoZmllbGQsIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBm\naWVsZCBpcyBkaXJ0eSBidXQgd2UgbmV2ZXIgbG9hZGVkIGl0LCB3ZSBjYW4n\ndCByZXN0b3JlIGl0CiAgICAgICAgICAgIGlmIChfc2F2ZWQuZ2V0VW5sb2Fk\nZWQoKS5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiaW5pdGlhbC11bmxvYWRl\nZCIsCiAgICAgICAgICAgICAgICAgICAgZm1kKSk7CgogICAgICAgICAgICBw\ncm92aWRlRmllbGQoX3NhdmVkLmdldFN0YXRlKCksIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIGZldGNoRmllbGQoX3NpbmdsZSwgZm1k\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGZXRjaCB0aGUgc3Bl\nY2lmaWVkIGZpZWxkIGZyb20gdGhlIHNwZWNpZmllZCBmaWVsZCBtYW5hZ2Vy\nLCB3cmFwcGluZyBpdAogICAgICogaW4gYW4gb2JqZWN0IGlmIGl0J3MgYSBw\ncmltaXRpdmUuIEEgZmllbGQgc2hvdWxkIGJlIHByb3ZpZGVkIHRvIHRoZQog\nICAgICogZmllbGQgbWFuYWdlciBiZWZvcmUgdGhpcyBjYWxsIGlzIG1hZGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBmZXRjaEZpZWxk\nKEZpZWxkTWFuYWdlciBmbSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICBpbnQgZmllbGQgPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAo\nZm0uZmV0Y2hCb29sZWFuRmllbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQog\nICAgICAgICAgICAgICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgQnl0ZShmbS5mZXRjaEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBDaGFyYWN0ZXIoZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBEb3VibGUoZm0uZmV0Y2hEb3VibGVGaWVsZChm\naWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQoZm0uZmV0Y2hGbG9hdEZp\nZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXJzLnZhbHVlT2YoZm0uZmV0\nY2hJbnRGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5MT05HOgogICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcnMudmFsdWVP\nZihmbS5mZXRjaExvbmdGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nU2hvcnQoZm0uZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIHJldHVy\nbiBmbS5mZXRjaFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZp\nZWxkKGZpZWxkKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0UmVtb3RlKGludCBmaWVsZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAg\nbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3Rh\ndCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAg\nICAgICAgIHN0b3JlRmllbGQoZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAg\nICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9w\nZXJhdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91\ndCB0byBiZSBhY2Nlc3NlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQg\ndGhlIGZpZWxkIG51bWJlciBiZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBz\naW5nbGUKICAgICAqIGZpZWxkIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZv\ncmVSZWFkKGludCBmaWVsZCkgewogICAgICAgIC8vIGFsbG93IHVubWVkaWF0\nZWQgcmVhZHMgb2YgcHJpbWFyeSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZp\nZWxkICE9IC0xICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlL\nZXkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tl\nci5pc0FjdGl2ZSgpICYmICFfYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmco\nKSkgewogICAgICAgICAgICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkp\nCiAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRp\nbWlzdGljUmVhZCh0aGlzLCBmaWVsZCkpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRo\naXMsIGZpZWxkKSk7CiAgICAgICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5v\nbnRyYW5zYWN0aW9uYWxSZWFkKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUo\nX3N0YXRlLmJlZm9yZU5vbnRyYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxk\nKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxp\nZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4K\nICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5z\ndGFuY2UoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8g\ndGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRl\nI2JlZm9yZUZsdXNoCiAgICAgKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50\nIHJlYXNvbiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5i\nZWZvcmVGbHVzaCh0aGlzLCByZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9M\nT0dJQ0FMLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRl\ncyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBD\nU3RhdGUjZmx1c2gKICAgICAqLwogICAgdm9pZCBhZnRlckZsdXNoKGludCBy\nZWFzb24pIHsKICAgICAgICAvLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBm\nbHVzaCBub24tcGVyc2lzdGVudCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVy\nc2lzdGVudCgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChy\nZWFzb24gIT0gQnJva2VySW1wbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAg\nICAmJiByZWFzb24gIT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAg\nICAgICAgICAgIC8vIGFuYWx5emUgcHJldmlvdXMgc3RhdGUgZm9yIGxhdGVy\nCiAgICAgICAgICAgIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKTsKICAgICAg\nICAgICAgYm9vbGVhbiB3YXNGbHVzaGVkID0gaXNGbHVzaGVkKCk7CiAgICAg\nICAgICAgIGJvb2xlYW4gd2FzRGVsZXRlZCA9IGlzRGVsZXRlZCgpOwoKICAg\nICAgICAgICAgLy8gYWxsIGRpcnR5IGZpZWxkcyB3ZXJlIGZsdXNoZWQKICAg\nICAgICAgICAgX2ZsdXNoLm9yKF9kaXJ0eSk7CgogICAgICAgICAgICAvLyBp\nbXBvcnRhbnQgdG8gc2V0IGZsdXNoZWQgYml0IGFmdGVyIGNhbGxpbmcgX3N0\nYXRlLmZsdXNoIHNvCiAgICAgICAgICAgIC8vIHRoYXQgdGhlIHN0YXRlIGNh\nbiB0ZWxsIHdoZXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgZmx1c2gKICAgICAg\nICAgICAgc2V0UENTdGF0ZShfc3RhdGUuZmx1c2godGhpcykpOwogICAgICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgICAgIF9mbGFn\ncyAmPSB+RkxBR19WRVJTSU9OX0NIRUNLOwogICAgICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfVkVSU0lPTl9VUERBVEU7CgogICAgICAgICAgICAvLyBpZiB0\naGlzIHdhcyBhbiBpbmMgZmx1c2ggZHVyaW5nIHdoaWNoIHdlIGhhZCBvdXIg\naWRlbnRpdHkKICAgICAgICAgICAgLy8gYXNzaWduZWQsIHRlbGwgdGhlIGJy\nb2tlciB0byBjYWNoZSB1cyB1bmRlciBvdXIgZmluYWwgb2lkCiAgICAgICAg\nICAgIGlmIChyZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9JTkMpCiAgICAg\nICAgICAgICAgICBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKHRydWUpOwoKICAg\nICAgICAgICAgLy8gaWYgdGhpcyBvYmplY3Qgd2FzIHN0b3JlZCB3aXRoIHBy\nZUZsdXNoLCBkbyBwb3N0LXN0b3JlIGNhbGxiYWNrCiAgICAgICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19QUkVfRkxVU0hFRCkgPiAwKQogICAgICAgICAg\nICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVS\nX1NUT1JFKTsKCiAgICAgICAgICAgIC8vIGRvIHBvc3QtdXBkYXRlIGFzIG5l\nZWRlZAogICAgICAgICAgICBpZiAod2FzTmV3ICYmICF3YXNGbHVzaGVkKQog\nICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2\nZW50LkFGVEVSX1BFUlNJU1RfUEVSRk9STUVEKTsKICAgICAgICAgICAgZWxz\nZSBpZiAod2FzRGVsZXRlZCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3lj\nbGVFdmVudChMaWZlY3ljbGVFdmVudC5BRlRFUl9ERUxFVEVfUEVSRk9STUVE\nKTsKICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIC8vIHVwZGF0\nZXMgYW5kIG5ldy1mbHVzaGVkIHdpdGggY2hhbmdlcwogICAgICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1VQ\nREFURV9QRVJGT1JNRUQpOwogICAgICAgIH0gZWxzZSBpZiAocmVhc29uID09\nIEJyb2tlckltcGwuRkxVU0hfUk9MTEJBQ0spIHsKICAgICAgICAgICAgLy8g\ncmV2ZXJ0IHRvIGxhc3QgbG9hZGVkIHZlcnNpb24gYW5kIG9yaWdpbmFsIG9p\nZAogICAgICAgICAgICBhc3NpZ25WZXJzaW9uRmllbGQoX2xvYWRWZXJzaW9u\nKTsKICAgICAgICAgICAgaWYgKGlzTmV3KCkgJiYgKF9mbGFncyAmIEZMQUdf\nT0lEX0FTU0lHTkVEKSA9PSAwKQogICAgICAgICAgICAgICAgX29pZCA9IG51\nbGw7CiAgICAgICAgfQogICAgICAgIF9mbGFncyAmPSB+RkxBR19QUkVfRkxV\nU0hFRDsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUg\nY3VycmVudCBzdGF0ZSBhZnRlciBjaGVja2luZyB0aGUgdmFsdWUKICAgICAq\nIG9mIHRoZSBSZXRhaW5TdGF0ZSBmbGFnLgogICAgICoKICAgICAqIEBzZWUg\nUENTdGF0ZSNjb21taXQKICAgICAqIEBzZWUgUENTdGF0ZSNjb21taXRSZXRh\naW4KICAgICAqLwogICAgdm9pZCBjb21taXQoKSB7CiAgICAgICAgLy8gcmVs\nZWFzZSBsb2NrcyBiZWZvcmUgb2lkIHVwZGF0ZWQKICAgICAgICByZWxlYXNl\nTG9ja3MoKTsKCiAgICAgICAgLy8gdXBkYXRlIHZlcnNpb24gYW5kIG9pZCBp\nbmZvcm1hdGlvbgogICAgICAgIHNldFZlcnNpb24oX3ZlcnNpb24pOwogICAg\nICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEOwogICAgICAgIF9mbGFncyAm\nPSB+RkxBR19GTFVTSEVEX0RJUlRZOwoKICAgICAgICBPYmplY3Qgb3JpZyA9\nIF9pZDsKICAgICAgICBhc3NlcnRPYmplY3RJZEFzc2lnbmVkKGZhbHNlKTsK\nCiAgICAgICAgYm9vbGVhbiB3YXNOZXcgPSBpc05ldygpICYmICFpc0RlbGV0\nZWQoKSAmJiAhaXNQcm92aXNpb25hbCgpOwogICAgICAgIGlmIChfYnJva2Vy\nLmdldFJldGFpblN0YXRlKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0\nYXRlLmNvbW1pdFJldGFpbih0aGlzKSk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5jb21taXQodGhpcykpOwoKICAgICAg\nICAvLyBhc2sgdGhlIGJyb2tlciB0byByZS1jYWNoZSB1cyBpZiB3ZSB3ZXJl\nIG5ldyBwcmV2aW91c2x5CiAgICAgICAgaWYgKHdhc05ldykKICAgICAgICAg\nICAgX2Jyb2tlci5zZXRTdGF0ZU1hbmFnZXIob3JpZywgdGhpcywgQnJva2Vy\nSW1wbC5TVEFUVVNfQ09NTUlUX05FVyk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUgYWZ0ZXIgY2hlY2tp\nbmcgdGhlIHZhbHVlCiAgICAgKiBvZiB0aGUgUmV0YWluU3RhdGUgZmxhZy4K\nICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjcm9sbGJhY2sKICAgICAqIEBz\nZWUgUENTdGF0ZSNyb2xsYmFja1Jlc3RvcmUKICAgICAqLwogICAgdm9pZCBy\nb2xsYmFjaygpIHsKICAgICAgICAvLyByZWxlYXNlIGxvY2tzCiAgICAgICAg\ncmVsZWFzZUxvY2tzKCk7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNI\nRUQ7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIRURfRElSVFk7CiAg\nICAgICAgYWZ0ZXJGbHVzaChCcm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLKTsK\nCiAgICAgICAgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgIT0gUmVz\ndG9yZVN0YXRlLlJFU1RPUkVfTk9ORSkKICAgICAgICAgICAgc2V0UENTdGF0\nZShfc3RhdGUucm9sbGJhY2tSZXN0b3JlKHRoaXMpKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnJvbGxiYWNrKHRoaXMp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJvbGxiYWNrIHN0YXRlIG9mIHRo\nZSBtYW5hZ2VkIGluc3RhbmNlIHRvIHRoZSBnaXZlbiBzYXZlcG9pbnQuCiAg\nICAgKi8KICAgIHZvaWQgcm9sbGJhY2tUb1NhdmVwb2ludChTYXZlcG9pbnRG\naWVsZE1hbmFnZXIgc2F2ZXBvaW50KSB7CiAgICAgICAgX3N0YXRlID0gc2F2\nZXBvaW50LmdldFBDU3RhdGUoKTsKICAgICAgICBCaXRTZXQgbG9hZGVkID0g\nc2F2ZXBvaW50LmdldExvYWRlZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nLCBsZW4gPSBsb2FkZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAg\nICAgICAgICBpZiAobG9hZGVkLmdldChpKSAmJiBzYXZlcG9pbnQucmVzdG9y\nZUZpZWxkKGkpKSB7CiAgICAgICAgICAgICAgICBwcm92aWRlRmllbGQoc2F2\nZXBvaW50LmdldENvcHkoKSwgc2F2ZXBvaW50LCBpKTsKICAgICAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChfcGMsIHNhdmVwb2ludCwgaSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgX2xvYWRlZCA9IGxvYWRlZDsKICAg\nICAgICBfZGlydHkgPSBzYXZlcG9pbnQuZ2V0RGlydHkoKTsKICAgICAgICBf\nZmx1c2ggPSBzYXZlcG9pbnQuZ2V0Rmx1c2hlZCgpOwogICAgICAgIF92ZXJz\naW9uID0gc2F2ZXBvaW50LmdldFZlcnNpb24oKTsKICAgICAgICBfbG9hZFZl\ncnNpb24gPSBzYXZlcG9pbnQuZ2V0TG9hZFZlcnNpb24oKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4K\nICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjcGVyc2lzdAogICAgICogQHNl\nZSBCcm9rZXIjcGVyc2lzdAogICAgICovCiAgICB2b2lkIHBlcnNpc3QoKSB7\nCiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUucGVyc2lzdCh0aGlzKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQg\nc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2RlbGV0ZQogICAg\nICogQHNlZSBCcm9rZXIjZGVsZXRlCiAgICAgKi8KICAgIHZvaWQgZGVsZXRl\nKCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmRlbGV0ZSh0aGlzKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJl\nbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI25vbnRyYW5z\nYWN0aW9uYWwKICAgICAqIEBzZWUgQnJva2VyI25vbnRyYW5zYWN0aW9uYWwK\nICAgICAqLwogICAgdm9pZCBub250cmFuc2FjdGlvbmFsKCkgewogICAgICAg\nIHNldFBDU3RhdGUoX3N0YXRlLm5vbnRyYW5zYWN0aW9uYWwodGhpcykpOwog\nICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50\nIHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSN0cmFuc2FjdGlv\nbmFsCiAgICAgKiBAc2VlIEJyb2tlciN0cmFuc2FjdGlvbmFsCiAgICAgKi8K\nICAgIHZvaWQgdHJhbnNhY3Rpb25hbCgpIHsKICAgICAgICBzZXRQQ1N0YXRl\nKF9zdGF0ZS50cmFuc2FjdGlvbmFsKHRoaXMpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIERlbGVnYXRlcyB0byB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAq\nCiAgICAgKiBAc2VlIFBDU3RhdGUjbm9ucHJvdmlzaW9uYWwKICAgICAqLwog\nICAgdm9pZCBub25wcm92aXNpb25hbChib29sZWFuIGxvZ2ljYWwsIE9wQ2Fs\nbGJhY2tzIGNhbGwpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub25w\ncm92aXNpb25hbCh0aGlzLCBsb2dpY2FsLCBjYWxsKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAg\nICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3JlbGVhc2UKICAgICAqIEBzZWUg\nQnJva2VyI3JlbGVhc2UKICAgICAqLwogICAgdm9pZCByZWxlYXNlKGJvb2xl\nYW4gdW5wcm94eSkgewogICAgICAgIHJlbGVhc2UodW5wcm94eSwgZmFsc2Up\nOwogICAgfQoKICAgIHZvaWQgcmVsZWFzZShib29sZWFuIHVucHJveHksIGJv\nb2xlYW4gZm9yY2UpIHsKICAgICAgICAvLyBvcHRpbWl6YXRpb24gZm9yIGRl\ndGFjaC1pbi1wbGFjZSBzcGVjaWFsIGNhc2Ugd2hlbiBmaWVsZHMgYXJlCiAg\nICAgICAgLy8gYWxyZWFkeSAodW4pcHJveGllZCBjb3JyZWN0bHkKICAgICAg\nICBpZiAoIXVucHJveHkpCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX05P\nX1VOUFJPWFk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGZvcmNl\nKQogICAgICAgICAgICAgICAgc2V0UENTdGF0ZShQQ1N0YXRlLlRSQU5TSUVO\nVCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNldFBDU3Rh\ndGUoX3N0YXRlLnJlbGVhc2UodGhpcykpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19OT19VTlBST1hZOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUg\nY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjZXZp\nY3QKICAgICAqIEBzZWUgQnJva2VyI2V2aWN0CiAgICAgKi8KICAgIHZvaWQg\nZXZpY3QoKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuZXZpY3QodGhp\ncykpOwogICAgfQoKICAgIC8qKgogICAgICogR2F0aGVyIHJlbGF0aW9ucyBy\nZWFjaGFibGUgZnJvbSB2YWx1ZXMgdXNpbmcKICAgICAqIHtAbGluayBWYWx1\nZU1ldGFEYXRhI0NBU0NBREVfSU1NRURJQVRFfS4KICAgICAqLwogICAgdm9p\nZCBnYXRoZXJDYXNjYWRlUmVmcmVzaChPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChpKSkKICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgaWYgKGZtZHNbaV0u\nZ2V0Q2FzY2FkZVJlZnJlc2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFCiAgICAgICAgICAgICAgICB8fCBmbWRzW2ldLmdldEtleSgp\nLmdldENhc2NhZGVSZWZyZXNoKCkKICAgICAgICAgICAgICAgID09IFZhbHVl\nTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUKICAgICAgICAgICAgICAgIHx8\nIGZtZHNbaV0uZ2V0RWxlbWVudCgpLmdldENhc2NhZGVSZWZyZXNoKCkKICAg\nICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElB\nVEUpIHsKICAgICAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVs\nZChpLCBmZXRjaEZpZWxkKGksIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLmdhdGhlckNhc2NhZGVSZWZyZXNoKGNhbGwpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGJlZm9yZVJlZnJlc2goYm9v\nbGVhbiByZWZyZXNoQWxsKSB7CiAgICAgICAgLy8gbm90ZTogYWxsIGxvZ2lj\nIHBsYWNlZCBoZXJlIHJhdGhlciB0aGFuIGluIHRoZSBzdGF0ZXMgZm9yCiAg\nICAgICAgLy8gb3B0aW1pemF0aW9uOyB0aGlzIG1ldGhvZCBwdWJsaWMgYi9j\nIHVzZWQgYnkgcmVtb3RlIHBhY2thZ2UKCiAgICAgICAgLy8gbm90aGluZyB0\nbyBkbyBmb3Igbm9uIHBlcnNpc3RlbnQgb3IgbmV3IHVuZmx1c2hlZCBpbnN0\nYW5jZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVudCgpIHx8IChpc05ldygp\nICYmICFpc0ZsdXNoZWQoKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8v\nIGlmIGRpcnR5IG5lZWQgdG8gY2xlYXIgZmllbGRzCiAgICAgICAgICAgIGlm\nIChpc0RpcnR5KCkpIHsKICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaWYgc29tZSBmaWVsZHMgaGF2ZSBiZWVuIGxvYWRl\nZCBidXQgdGhlIGluc3RhbmNlIGlzIG91dCBvZgogICAgICAgICAgICAvLyBk\nYXRlIG9yIHRoaXMgaXMgcGFydCBvZiBhIHJlZnJlc2hBbGwoKSBhbmQgd2Ug\nZG9uJ3Qgd2FudCB0bwogICAgICAgICAgICAvLyB0YWtlIHRoZSBleHRyYSBo\naXQgdG8gc2VlIGlmIHRoZSBpbnN0YW5jZSBpcyBvdXQgb2YgZGF0ZSwgY2xl\nYXIKICAgICAgICAgICAgaWYgKF9sb2FkZWQubGVuZ3RoKCkgPiAwICYmIChy\nZWZyZXNoQWxsIHx8IGlzRW1iZWRkZWQoKQogICAgICAgICAgICAgICAgfHwg\nIXN5bmNWZXJzaW9uKG51bGwpKSkgewogICAgICAgICAgICAgICAgT2JqZWN0\nIHZlcnNpb24gPSBfdmVyc2lvbjsKICAgICAgICAgICAgICAgIGNsZWFyRmll\nbGRzKCk7CgogICAgICAgICAgICAgICAgLy8gaWYgc3luY1ZlcnNpb24ganVz\ndCByZXBsYWNlZCB0aGUgdmVyc2lvbiwgcmVzZXQgaXQKICAgICAgICAgICAg\nICAgIGlmICghcmVmcmVzaEFsbCAmJiAhaXNFbWJlZGRlZCgpKQogICAgICAg\nICAgICAgICAgICAgIHNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGVy\nZm9ybSBzdGF0ZSB0cmFuc2l0aW9ucyBhZnRlciByZWZyZXNoLiBUaGlzIG1l\ndGhvZCBpcyBvbmx5CiAgICAgKiBjYWxsZWQgaWYge0BsaW5rICNiZWZvcmVS\nZWZyZXNofSByZXR1cm5zIHRydWUuCiAgICAgKi8KICAgIHZvaWQgYWZ0ZXJS\nZWZyZXNoKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyB0cmFuc2l0aW9uIHRvIGNsZWFuIG9yIG5vbnRyYW5zYWN0\naW9uYWwgZGVwZW5kaW5nIG9uIHRyYW5zIHN0YXR1cwogICAgICAgICAgICBp\nZiAoIV9icm9rZXIuaXNBY3RpdmUoKSkKICAgICAgICAgICAgICAgIHNldFBD\nU3RhdGUoX3N0YXRlLmFmdGVyTm9udHJhbnNhY3Rpb25hbFJlZnJlc2goKSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKF9icm9rZXIuZ2V0T3B0aW1pc3RpYygp\nKQogICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYWZ0ZXJPcHRp\nbWlzdGljUmVmcmVzaCgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYWZ0ZXJSZWZyZXNoKCkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcmsgdGhpcyBvYmplY3QgYXMg\nYSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdC4KICAgICAqLwogICAg\ndm9pZCBzZXREZXJlZmVyZW5jZWREZXBlbmRlbnQoYm9vbGVhbiBkZXJlZiwg\nYm9vbGVhbiBub3RpZnkpIHsKICAgICAgICBpZiAoIWRlcmVmICYmIChfZmxh\nZ3MgJiBGTEFHX0RFUkVGKSA+IDApIHsKICAgICAgICAgICAgaWYgKG5vdGlm\neSkKICAgICAgICAgICAgICAgIF9icm9rZXIucmVtb3ZlRGVyZWZlcmVuY2Vk\nRGVwZW5kZW50KHRoaXMpOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nREVSRUY7CiAgICAgICAgfSBlbHNlIGlmIChkZXJlZiAmJiAoX2ZsYWdzICYg\nRkxBR19ERVJFRikgPT0gMCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19ERVJFRjsKICAgICAgICAgICAgaWYgKG5vdGlmeSkKICAgICAgICAgICAg\nICAgIF9icm9rZXIuYWRkRGVyZWZlcmVuY2VkRGVwZW5kZW50KHRoaXMpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gTG9ja2lu\nZwogICAgLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIE5vdGlmaWNhdGlv\nbiB0aGF0IHdlJ3ZlIGJlZW4gcmVhZC1sb2NrZWQuIFBhc3MgaW4gdGhlIGxl\ndmVsIGF0IHdoaWNoCiAgICAgKiB3ZSB3ZXJlIGxvY2tlZCBhbmQgdGhlIGxl\ndmVsIGF0IHdoaWNoIHdlIHNob3VsZCB3cml0ZSBsb2NrIG91cnNlbHZlcwog\nICAgICogb24gZGlydHkuCiAgICAgKi8KICAgIHZvaWQgcmVhZExvY2tlZChp\nbnQgcmVhZExvY2tMZXZlbCwgaW50IHdyaXRlTG9ja0xldmVsKSB7CiAgICAg\nICAgLy8gbWFrZSBzdXJlIG9iamVjdCBpcyBhZGRlZCB0byB0cmFuc2FjdGlv\nbiBzbyBsb2NrIHdpbGwgZ2V0CiAgICAgICAgLy8gY2xlYXJlZCBvbiBjb21t\naXQvcm9sbGJhY2sKICAgICAgICBpZiAocmVhZExvY2tMZXZlbCAhPSBMb2Nr\nTGV2ZWxzLkxPQ0tfTk9ORSkKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbCgp\nOwoKICAgICAgICBfcmVhZExvY2tMZXZlbCA9IHJlYWRMb2NrTGV2ZWw7CiAg\nICAgICAgX3dyaXRlTG9ja0xldmVsID0gd3JpdGVMb2NrTGV2ZWw7CiAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX1dSSVRFX0xPQ0tFRDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgbG9jayBsZXZlbCB0byB1c2Ugd2hlbiBsb2FkaW5nIHN0\nYXRlLgogICAgICovCiAgICBwcml2YXRlIGludCBjYWxjdWxhdGVMb2NrTGV2\nZWwoYm9vbGVhbiBhY3RpdmUsIGJvb2xlYW4gZm9yV3JpdGUsCiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKCFhY3Rp\ndmUpCiAgICAgICAgICAgIHJldHVybiBMb2NrTGV2ZWxzLkxPQ0tfTk9ORTsK\nICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgZmV0Y2gg\nPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwoKICAgICAgICBp\nZiAoX3JlYWRMb2NrTGV2ZWwgPT0gLTEpCiAgICAgICAgICAgIF9yZWFkTG9j\na0xldmVsID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAgIGlm\nIChfd3JpdGVMb2NrTGV2ZWwgPT0gLTEpCiAgICAgICAgICAgIF93cml0ZUxv\nY2tMZXZlbCA9IGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCk7CiAgICAgICAg\ncmV0dXJuIChmb3JXcml0ZSkgPyBfd3JpdGVMb2NrTGV2ZWwgOiBfcmVhZExv\nY2tMZXZlbDsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ugc3VyZSB3ZSdy\nZSBsb2NrZWQgYXQgdGhlIGdpdmVuIGxldmVsLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgb2J0YWluTG9ja3MoYm9vbGVhbiBhY3RpdmUsIGJvb2xlYW4g\nZm9yV3JpdGUsIGludCBsb2NrTGV2ZWwsCiAgICAgICAgRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBPYmplY3Qgc2RhdGEpIHsKICAgICAgICBpZiAoIWFj\ndGl2ZSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiB3ZSBo\nYXZlbid0IGJlZW4gbG9ja2VkIHlldCwgbG9jayBub3cgYXQgdGhlIGdpdmVu\nIGxldmVsCiAgICAgICAgaW50IGZsYWcgPSAoZm9yV3JpdGUpID8gRkxBR19X\nUklURV9MT0NLRUQgOiBGTEFHX1JFQURfTE9DS0VEOwogICAgICAgIGlmICgo\nX2ZsYWdzICYgZmxhZykgPT0gMCkgewogICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgb2JqZWN0IGlzIGFkZGVkIHRvIHRyYW5zYWN0aW9uIHNvIGxvY2sgd2ls\nbCBnZXQKICAgICAgICAgICAgLy8gY2xlYXJlZCBvbiBjb21taXQvcm9sbGJh\nY2sKICAgICAgICAgICAgaWYgKGxvY2tMZXZlbCAhPSBMb2NrTGV2ZWxzLkxP\nQ0tfTk9ORSkKICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uYWwoKTsKCiAg\nICAgICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAg\nZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAg\nICAgICAgICBfYnJva2VyLmdldExvY2tNYW5hZ2VyKCkubG9jayh0aGlzLCBs\nb2NrTGV2ZWwsCiAgICAgICAgICAgICAgICBmZXRjaC5nZXRMb2NrVGltZW91\ndCgpLCBzZGF0YSk7CiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1JFQURf\nTE9DS0VEOwogICAgICAgICAgICBfZmxhZ3MgfD0gZmxhZzsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGxvY2tzLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVsZWFzZUxvY2tzKCkgewogICAgICAgIGlm\nIChfbG9jayAhPSBudWxsKQogICAgICAgICAgICBfYnJva2VyLmdldExvY2tN\nYW5hZ2VyKCkucmVsZWFzZSh0aGlzKTsKICAgICAgICBfcmVhZExvY2tMZXZl\nbCA9IC0xOwogICAgICAgIF93cml0ZUxvY2tMZXZlbCA9IC0xOwogICAgICAg\nIF9mbGFncyAmPSB+RkxBR19SRUFEX0xPQ0tFRDsKICAgICAgICBfZmxhZ3Mg\nJj0gfkZMQUdfV1JJVEVfTE9DS0VEOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBs\nZW1lbnRhdGlvbiBvZiBTdGF0ZU1hbmFnZXIgaW50ZXJmYWNlCiAgICAvLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogQHJldHVybiB3aGV0aGVyIG9yIG5vdCB1bmxvYWRlZCBm\naWVsZHMgc2hvdWxkIGJlIGNsb3NlZC4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gc2VyaWFsaXppbmcoKSB7CiAgICAgICAgLy8gaWYgdGhlIGJyb2tl\nciBpcyBpbiB0aGUgbWlkc3Qgb2YgYSBzZXJpYWxpemF0aW9uLCB0aGVuIG5v\nIHNwZWNpYWwKICAgICAgICAvLyBoYW5kbGluZyBzaG91bGQgYmUgcGVyZm9y\nbWVkIG9uIHRoZSBpbnN0YW5jZSwgYW5kIG5vIHN1YnNlcXVlbnQKICAgICAg\nICAvLyBsb2FkIHNob3VsZCBoYXBwZW4KICAgICAgICBpZiAoX2Jyb2tlci5p\nc1NlcmlhbGl6aW5nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9tZXRhLmlzRGV0YWNoYWJs\nZSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIERldGFjaE1hbmFnZXIucHJl\nU2VyaWFsaXplKHRoaXMpOwoKICAgICAgICAgICAgbG9hZChfYnJva2VyLmdl\ndEZldGNoQ29uZmlndXJhdGlvbigpLCBMT0FEX1NFUklBTElaRSwgbnVsbCwg\nbnVsbCwgCiAgICAgICAgICAgICAgICBmYWxzZSk7CiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHdyaXRlRGV0YWNoZWQo\nT2JqZWN0T3V0cHV0IG91dCkKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIEJpdFNldCBpZHhzID0gbmV3IEJpdFNldChfbWV0YS5nZXRG\naWVsZHMoKS5sZW5ndGgpOwogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBib29sZWFuIGRldHNtID0gRGV0YWNoTWFuYWdlci53\ncml0ZURldGFjaGVkU3RhdGUodGhpcywgb3V0LCBpZHhzKTsKICAgICAgICAg\nICAgaWYgKGRldHNtKQogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nREVUQUNISU5HOwoKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBp\nZiAoZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywg\nX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnNlcmlhbGl6\nZShvdXQsICFpZHhzLmdldChpKSk7CiAgICAgICAgICAgICAgICBfc2luZ2xl\nLmNsZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19ERVRBQ0hJTkc7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBwcm94eURldGFjaGVkRGVzZXJpYWxpemVkKGludCBpZHgp\nIHsKICAgICAgICAvLyB3ZSBkb24ndCBzZXJpYWxpemUgc3RhdGUgbWFuYWdl\nciBpbXBscwogICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVHJhbnNhY3Rpb25hbCgp\nIHsKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIFRDTEVBTiwgd2hpY2gg\nd2Ugd2FudCB0byBhcHBlYXIgbm9uLXRyYW5zIHRvCiAgICAgICAgLy8gaW50\nZXJuYWwgY29kZSwgYnV0IHdoaWNoIHB1YmxpY2x5IHNob3VsZCBiZSB0cmFu\nc2FjdGlvbmFsCiAgICAgICAgcmV0dXJuIF9zdGF0ZSA9PSBQQ1N0YXRlLlRD\nTEVBTiB8fCBfc3RhdGUuaXNUcmFuc2FjdGlvbmFsKCk7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpIHsKICAg\nICAgICByZXR1cm4gX3N0YXRlLmlzUGVuZGluZ1RyYW5zYWN0aW9uYWwoKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1Byb3Zpc2lvbmFsKCkgewog\nICAgICAgIHJldHVybiBfc3RhdGUuaXNQcm92aXNpb25hbCgpOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzUGVyc2lzdGVudCgpIHsKICAgICAgICBy\nZXR1cm4gX3N0YXRlLmlzUGVyc2lzdGVudCgpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzTmV3KCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNO\nZXcoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0RlbGV0ZWQoKSB7\nCiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc0RlbGV0ZWQoKTsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgIHJldHVybiBf\nc3RhdGUuaXNEaXJ0eSgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRGV0YWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0RF\nVEFDSElORykgIT0gMDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldEdl\nbmVyaWNDb250ZXh0KCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwogICAg\nfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hPYmplY3RJZCgpIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NpZ25PYmplY3RJZCh0cnVlKTsKICAg\nICAgICAgICAgaWYgKF9vaWQgPT0gbnVsbCB8fCAhX2Jyb2tlci5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICBnZXRDb21wYXRpYmlsaXR5\nSW5zdGFuY2UoKS5nZXRDb3B5T2JqZWN0SWRzKCkpCiAgICAgICAgICAgICAg\nICByZXR1cm4gX29pZDsKCiAgICAgICAgICAgIGlmIChfbWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRSkKICAg\nICAgICAgICAgICAgIHJldHVybiBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigp\nLmNvcHlEYXRhU3RvcmVJZChfb2lkLCBfbWV0YSk7CiAgICAgICAgICAgIHJl\ndHVybiBBcHBsaWNhdGlvbklkcy5jb3B5KF9vaWQsIF9tZXRhKTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBPYmplY3QgZ2V0UENQcmltYXJ5S2V5KE9iamVjdCBvaWQsIGludCBm\naWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0\nRmllbGQoZmllbGQpOwogICAgICAgIE9iamVjdCBwayA9IEFwcGxpY2F0aW9u\nSWRzLmdldChvaWQsIGZtZCk7CiAgICAgICAgaWYgKHBrID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDbGFzc01ldGFEYXRh\nIHJlbG1ldGEgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKTsKICAg\nICAgICBwayA9IEFwcGxpY2F0aW9uSWRzLndyYXAocmVsbWV0YSwgcGspOwog\nICAgICAgIGlmIChyZWxtZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNz\nTWV0YURhdGEuSURfREFUQVNUT1JFCiAgICAgICAgICAgICYmIGZtZC5nZXRP\nYmplY3RJZEZpZWxkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuTE9ORykKICAg\nICAgICAgICAgcGsgPSBfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLm5ld0Rh\ndGFTdG9yZUlkKHBrLCByZWxtZXRhKTsKICAgICAgICBlbHNlIGlmIChyZWxt\nZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQ\nTElDQVRJT04gCiAgICAgICAgICAgICYmIGZtZC5nZXRPYmplY3RJZEZpZWxk\nVHlwZSgpICE9IHJlbG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCkpCiAgICAgICAg\nICAgIHBrID0gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKG5ldyBPYmpl\nY3RbXSB7IHBrIH0sIHJlbG1ldGEpOwogICAgICAgIHJldHVybiBfYnJva2Vy\nLmZpbmQocGssIGZhbHNlLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0\nZSByZXBsYWNlRmxhZ3MoKSB7CiAgICAgICAgLy8gd2UgYWx3YXlzIHVzZSBs\nb2FkIHJlcXVpcmVkIHNvIHRoYXQgd2UgY2FuIGRldGVjdCB3aGVuIG9iamVj\ndHMKICAgICAgICAvLyBhcmUgdG91Y2hlZCBmb3IgbG9ja2luZyBvciBtYWtp\nbmcgdHJhbnNhY3Rpb25hbAogICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZUNh\ncGFibGUuTE9BRF9SRVFVSVJFRDsKICAgIH0KCiAgICBwdWJsaWMgU3RhdGVN\nYW5hZ2VyIHJlcGxhY2VTdGF0ZU1hbmFnZXIoU3RhdGVNYW5hZ2VyIHNtKSB7\nCiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFj\nY2Vzc2luZ0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIC8vIHBvc3NpYmx5\nIGNoYW5nZSBzdGF0ZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJlZm9y\nZVJlYWQoZmllbGQpOwogICAgICAgICAgICBiZWZvcmVBY2Nlc3NGaWVsZChm\naWVsZCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\newogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkIGJl\nZm9yZSBhY2Nlc3MuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGJlZm9y\nZUFjY2Vzc0ZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9r\nZXIuaXNBY3RpdmUoKTsKICAgICAgICAgICAgaW50IGxvY2tMZXZlbCA9IGNh\nbGN1bGF0ZUxvY2tMZXZlbChhY3RpdmUsIGZhbHNlLCBudWxsKTsKICAgICAg\nICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAg\nICBsb2FkRmllbGQoZmllbGQsIGxvY2tMZXZlbCwgZmFsc2UsIHRydWUpOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhc3NpZ25GaWVsZChm\naWVsZCwgZmFsc2UpOwogICAgICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUs\nIGZhbHNlLCBsb2NrTGV2ZWwsIG51bGwsIG51bGwpOwogICAgICAgIH0gY2F0\nY2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cg\ndHJhbnNsYXRlKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZGlydHkoU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZtZCA9\nPSBudWxsKQogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUobmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoIm5vLWZpZWxkIiwgZmllbGQsCiAgICAgICAg\nICAgICAgICBJbXBsSGVscGVyLmdldE1hbmFnZWRJbnN0YW5jZShfcGMpLmdl\ndENsYXNzKCkpKQogICAgICAgICAgICAgICAgLnNldEZhaWxlZE9iamVjdChn\nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwoKICAgICAgICBkaXJ0eShmbWQuZ2V0\nSW5kZXgoKSwgbnVsbCwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nZGlydHkoaW50IGZpZWxkKSB7CiAgICAgICAgZGlydHkoZmllbGQsIG51bGws\nIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4g\nZmllbGQgZGlydHkuCiAgICAgKgogICAgICogQHBhcmFtIG11dGF0ZSBpZiBu\ndWxsLCBtYXkgYmUgYW4gU0NPIG11dGF0aW9uOyBpZiB0cnVlLCBpcyBjZXJ0\nYWlubHkKICAgICAqIGEgbXV0YXRpb24gKG9yIGF0IGxlYXN0IHRyZWF0IGFz\nIG9uZSkKICAgICAqIEByZXR1cm4ge0BsaW5rIEJvb2xlYW4jRkFMU0V9IGlm\nIHRoaXMgaW5zdGFuY2Ugd2FzIGFscmVhZHkgZGlydHksCiAgICAgKiA8Y29k\nZT5udWxsPC9jb2RlPiBpZiBpdCB3YXMgZGlydHkgYnV0IG5vdCBzaW5jZSBm\nbHVzaCwgYW5kCiAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBpZiBpdCB3\nYXMgbm90IGRpcnR5CiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiBkaXJ0\neShpbnQgZmllbGQsIEJvb2xlYW4gbXV0YXRlLCBib29sZWFuIGxvYWRGZXRj\naEdyb3VwKSB7CiAgICAgICAgYm9vbGVhbiBsb2NrZWQgPSBmYWxzZTsKICAg\nICAgICBib29sZWFuIG5ld0ZsdXNoID0gZmFsc2U7CiAgICAgICAgYm9vbGVh\nbiBjbGVhbiA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgICAgICBpZiAoIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRh\ndGVTdHJhdGVnaWVzLlJFU1RSSUNUKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAg\nICAgICAgICAgICAgICAgICAgKCJ1cGRhdGUtcmVzdHJpY3QiLCBmbWQpKTsK\nICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9\nPSBVcGRhdGVTdHJhdGVnaWVzLklHTk9SRSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKGlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgLy8g\nbm90aWZ5IG93bmVyIG9mIGNoYW5nZQogICAgICAgICAgICAgICAgX293bmVy\nLmRpcnR5KF9vd25lckluZGV4LCBCb29sZWFuLlRSVUUsIGxvYWRGZXRjaEdy\nb3VwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaXMgdGhpcyBh\nIGRpcmVjdCBtdXRhdGlvbiBvZiBhbiBzY28gZmllbGQ/CiAgICAgICAgICAg\nIGlmIChtdXRhdGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgc3dpdGNo\nIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICAgICAgICAgIG11\ndGF0ZSA9IEJvb2xlYW4uVFJVRTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6\nCiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZSA9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAoZm1kLmlzRW1iZWRkZWQoKSkgPyBCb29sZWFu\nLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgICAgICAgICBtdXRhdGUgPSBCb29sZWFuLkZBTFNFOyAvLyBu\nb3Qgc2NvCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHBvc3NpYmx5IGNoYW5nZSBzdGF0ZQogICAgICAgICAgICBi\nb29sZWFuIGFjdGl2ZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsKICAgICAgICAg\nICAgY2xlYW4gPSAhX3N0YXRlLmlzRGlydHkoKTsgLy8gaW50ZW50aW9uYWwg\nZGlyZWN0IGFjY2VzcwoKICAgICAgICAgICAgLy8gZmlyZSBldmVudCBmYXN0\nIGJlZm9yZSBzdGF0ZSBjaGFuZ2UuCiAgICAgICAgICAgIGlmIChjbGVhbikK\nICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVF\ndmVudC5CRUZPUkVfRElSVFkpOwogICAgICAgICAgICBpZiAoYWN0aXZlKSB7\nCiAgICAgICAgICAgICAgICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkp\nCiAgICAgICAgICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuYmVmb3Jl\nT3B0aW1pc3RpY1dyaXRlKHRoaXMsIGZpZWxkLAogICAgICAgICAgICAgICAg\nICAgICAgICBtdXRhdGUuYm9vbGVhblZhbHVlKCkpKTsKICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0\nZS5iZWZvcmVXcml0ZSh0aGlzLCBmaWVsZCwKICAgICAgICAgICAgICAgICAg\nICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgpKSk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRh\nLk1BTkFHRV9QRVJTSVNURU5UKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNQ\nZXJzaXN0ZW50KCkgJiYgIV9icm9rZXIuZ2V0Tm9udHJhbnNhY3Rpb25hbFdy\naXRlKCkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRT\ndGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAg\nICAoIm5vbi10cmFucy13cml0ZSIpKS5zZXRGYWlsZWRPYmplY3QKICAgICAg\nICAgICAgICAgICAgICAgICAgKGdldE1hbmFnZWRJbnN0YW5jZSgpKTsKCiAg\nICAgICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVOb250cmFu\nc2FjdGlvbmFsV3JpdGUodGhpcywgZmllbGQsCiAgICAgICAgICAgICAgICAg\nICAgbXV0YXRlLmJvb2xlYW5WYWx1ZSgpKSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19GTFVTSEVEKSAhPSAwKSB7\nCiAgICAgICAgICAgICAgICBuZXdGbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZM\nVVNIRURfRElSVFkpID09IDA7CiAgICAgICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19GTFVTSEVEX0RJUlRZOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBsb2NrKCk7CiAgICAgICAgICAgIGxvY2tlZCA9IHRydWU7CgogICAgICAg\nICAgICAvLyBub3RlIHRoYXQgdGhlIGZpZWxkIGlzIGluIG5lZWQgb2YgZmx1\nc2hpbmcgYWdhaW4sIGFuZCB0ZWxsIHRoZQogICAgICAgICAgICAvLyBicm9r\nZXIgdG9vCiAgICAgICAgICAgIF9mbHVzaC5jbGVhcihmaWVsZCk7CiAgICAg\nICAgICAgIF9icm9rZXIuc2V0RGlydHkodGhpcywgbmV3Rmx1c2ggJiYgIWNs\nZWFuKTsKCiAgICAgICAgICAgIC8vIHNhdmUgdGhlIGZpZWxkIGZvciByb2xs\nYmFjayBpZiBuZWVkZWQKICAgICAgICAgICAgc2F2ZUZpZWxkKGZpZWxkKTsK\nCiAgICAgICAgICAgIC8vIGRpcnR5IHRoZSBmaWVsZCBhbmQgbWFyayBsb2Fk\nZWQ7IGxvYWQgZmV0Y2ggZ3JvdXAgaWYgbmVlZGVkCiAgICAgICAgICAgIGlu\ndCBsb2NrTGV2ZWwgPSBjYWxjdWxhdGVMb2NrTGV2ZWwoYWN0aXZlLCB0cnVl\nLCBudWxsKTsKICAgICAgICAgICAgaWYgKCFfZGlydHkuZ2V0KGZpZWxkKSkg\newogICAgICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIF9kaXJ0eS5zZXQoZmllbGQpOwoKICAgICAgICAgICAg\nICAgIC8vIG1ha2Ugc3VyZSB0aGUgZmllbGQncyBmZXRjaCBncm91cCBpcyBs\nb2FkZWQKICAgICAgICAgICAgICAgIGlmIChsb2FkRmV0Y2hHcm91cCAmJiBp\nc1BlcnNpc3RlbnQoKQogICAgICAgICAgICAgICAgICAgICYmIGZtZC5nZXRN\nYW5hZ2VtZW50KCkgPT0gZm1kLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAg\nICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgbG9ja0xldmVsLCB0cnVl\nLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvYnRhaW5Mb2Nr\ncyhhY3RpdmUsIHRydWUsIGxvY2tMZXZlbCwgbnVsbCwgbnVsbCk7CiAgICAg\nICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICB0aHJvdyB0cmFuc2xhdGUocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIGlmIChsb2NrZWQpCiAgICAgICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChjbGVhbikKICAgICAgICAgICAg\ncmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICBpZiAobmV3Rmx1c2gpIHsK\nICAgICAgICAgICAgLy8gdGhpcyBldmVudCBjYW4gYmUgZmlyZWQgbGF0ZXIg\nY2F1c2Ugd2UncmUgYWxyZWFkeSBkaXJ0eS4KICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ESVJUWV9GTFVT\nSEVEKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAg\nICogRmlyZSBwb3N0LWRpcnR5IGV2ZW50cyBhZnRlciBmaWVsZCB2YWx1ZSBj\naGFuZ2VzLgogICAgICoKICAgICAqIEBwYXJhbSBzdGF0dXMgcmV0dXJuIHZh\nbHVlIGZyb20ge0BsaW5rICNkaXJ0eShpbnQsIEJvb2xlYW4sIGJvb2xlYW4p\nfQogICAgICovCiAgICBwcml2YXRlIHZvaWQgcG9zdERpcnR5KEJvb2xlYW4g\nc3RhdHVzKSB7CiAgICAgICAgaWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMoc3Rh\ndHVzKSkKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNs\nZUV2ZW50LkFGVEVSX0RJUlRZKTsKICAgICAgICBlbHNlIGlmIChzdGF0dXMg\nPT0gbnVsbCkKICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVj\neWNsZUV2ZW50LkFGVEVSX0RJUlRZX0ZMVVNIRUQpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHJlbW92ZWQoaW50IGZpZWxkLCBPYmplY3QgcmVtb3ZlZCwg\nYm9vbGVhbiBrZXkpIHsKICAgICAgICBpZiAocmVtb3ZlZCA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm47CgogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIGRlcmVmZXJlbmNlIGRlcGVuZGVudCBmaWVsZHMsIGRlbGV0ZSBlbWJl\nZGRlZAogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgVmFsdWVNZXRhRGF0YSB2bWQg\nPSAoa2V5KSA/IGZtZC5nZXRLZXkoKSA6IGZtZC5nZXRFbGVtZW50KCk7CiAg\nICAgICAgICAgIGlmICh2bWQuaXNFbWJlZGRlZFBDKCkpCiAgICAgICAgICAg\nICAgICBfc2luZ2xlLmRlbGV0ZSh2bWQsIHJlbW92ZWQsIG51bGwpOwogICAg\nICAgICAgICBlbHNlIGlmICh2bWQuZ2V0Q2FzY2FkZURlbGV0ZSgpID09IFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPKQogICAgICAgICAgICAgICAgX3Np\nbmdsZS5kZXJlZmVyZW5jZURlcGVuZGVudChyZW1vdmVkKTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgbmV3UHJveHkoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\naWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJu\nIG5ld0ZpZWxkUHJveHkoZmllbGQpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5n\nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRB\nVEU6CiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmVkVHlwZSgp\nID09IGphdmEuc3FsLkRhdGUuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBqYXZhLnNxbC5EYXRlKFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRU\neXBlKCkgPT0gamF2YS5zcWwuVGltZXN0YW1wLmNsYXNzKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgamF2YS5zcWwuVGltZXN0YW1wKFN5c3Rl\nbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAgICAgICAgICAgIGlmIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gamF2YS5zcWwuVGltZS5jbGFzcykK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGphdmEuc3FsLlRpbWUo\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNBTEVOREFSOgogICAgICAgICAgICAgICAgcmV0dXJuIENhbGVuZGFyLmdl\ndEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAg\nICAgICByZXR1cm4gbmV3IEhhc2hNYXAoKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdGaWVs\nZFByb3h5KGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIFByb3h5TWFuYWdl\nciBtZ3IgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAg\nICAgZ2V0UHJveHlNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBPYmplY3Qg\naW5pdCA9IGZtZC5nZXRJbml0aWFsaXplcigpOwoKICAgICAgICBzd2l0Y2gg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBtZ3Iu\nbmV3RGF0ZVByb3h5KGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAgICAgICAg\ncmV0dXJuIG1nci5uZXdDYWxlbmRhclByb3h5KGZtZC5nZXREZWNsYXJlZFR5\ncGUoKSwKICAgICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgVGlt\nZVpvbmUgPyAoVGltZVpvbmUpIGluaXQgOiBudWxsKTsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIHJl\ndHVybiBtZ3IubmV3Q29sbGVjdGlvblByb3h5KGZtZC5nZXRQcm94eVR5cGUo\nKSwKICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLmdldERl\nY2xhcmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGluaXQgaW5zdGFu\nY2VvZiBDb21wYXJhdG9yID8gKENvbXBhcmF0b3IpIGluaXQgOiBudWxsKTsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAg\nICAgcmV0dXJuIG1nci5uZXdNYXBQcm94eShmbWQuZ2V0UHJveHlUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgZm1kLmdldEtleSgpLmdldERlY2xhcmVk\nVHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCku\nZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgaW5pdCBp\nbnN0YW5jZW9mIENvbXBhcmF0b3IgPyAoQ29tcGFyYXRvcikgaW5pdCA6IG51\nbGwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0RlZmF1bHRWYWx1ZShpbnQgZmllbGQpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3Np\nbmdsZS5jbGVhcigpOwogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIGJvb2xlYW4gcmV0ID0gX3Np\nbmdsZS5pc0RlZmF1bHRWYWx1ZSgpOwogICAgICAgICAgICBfc2luZ2xlLmNs\nZWFyKCk7CiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUmVjb3JkIHRoYXQgdGhlIGZpZWxk\nIGlzIGRpcnR5ICh3aGljaCBtaWdodCBsb2FkIERGRykKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdCb29sZWFuRmllbGQoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgYm9vbGVh\nbiBjdXJWYWwsIGJvb2xlYW4gbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAg\naWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdW\nYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5\nQ2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShm\naWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAg\nICAgICAgX3NpbmdsZS5zdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgbmV3VmFs\nKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0dGluZ0J5dGVGaWVsZChQZXJzaXN0ZW5j\nZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBieXRlIGN1clZhbCwg\nYnl0ZSBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNF\nVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwg\nJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQp\nOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFu\nLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXR0aW5nQ2hhckZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkLAogICAgICAgIGNoYXIgY3VyVmFsLCBjaGFyIG5ld1ZhbCwgaW50\nIHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkgewogICAg\nICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVkLmdldChm\naWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFz\nc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgfQoKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9vbGVh\nbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBT\nRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVDaGFyRmllbGQo\nZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdEb3VibGVG\naWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAg\nICBkb3VibGUgY3VyVmFsLCBkb3VibGUgbmV3VmFsLCBpbnQgc2V0KSB7CiAg\nICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlm\nIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNzZXJ0Tm9Qcmlt\nYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBk\naXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsK\nICAgICAgICAgICAgX3NpbmdsZS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBu\nZXdWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUs\nIGZpZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nRmxvYXRGaWVsZChQZXJz\naXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBmbG9hdCBj\ndXJWYWwsIGZsb2F0IG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChz\nZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09\nIGN1clZhbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5n\nZShmaWVsZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQs\nIEJvb2xlYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAg\nIF9zaW5nbGUuc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAg\nICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXR0aW5nSW50RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjLCBpbnQgZmllbGQsCiAgICAgICAgaW50IGN1clZhbCwgaW50IG5ld1Zh\nbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JFTU9URSkg\newogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBfbG9hZGVk\nLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAg\nfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFMU0UsIHNl\ndCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVJbnRG\naWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxk\nKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShz\ndGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0xv\nbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAg\nICAgICBsb25nIGN1clZhbCwgbG9uZyBuZXdWYWwsIGludCBzZXQpIHsKICAg\nICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYg\nKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1h\ncnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRp\ncnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBuZXdW\nYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXR0aW5nT2JqZWN0RmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgT2JqZWN0IGN1\nclZhbCwgT2JqZWN0IG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChz\nZXQgIT0gU0VUX1JFTU9URSkgewogICAgICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgaWYg\nKF9sb2FkZWQuZ2V0KGZpZWxkKSkgewogICAgICAgICAgICAgICAgaWYgKG5l\nd1ZhbCA9PSBjdXJWYWwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgICAgIC8vIG9ubHkgY29tcGFyZSBuZXcgdG8gb2xkIHZh\nbHVlcyBpZiB0aGUgY29tcGFyaXNvbiBpcyBnb2luZyB0bwogICAgICAgICAg\nICAgICAgLy8gYmUgY2hlYXAgLS0gZG9uJ3QgY29tcGFyZSBjb2xsZWN0aW9u\ncywgbWFwcywgVURUcwogICAgICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nUENfVU5UWVBFRDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKG5ld1ZhbCAhPSBudWxsICYmIG5ld1ZhbC5lcXVhbHMoY3Vy\nVmFsKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIC8vIGlmIHRoaXMgaXMgYSBkZXBlbmRlbnQgdW5sb2FkZWQgZmll\nbGQsIG1ha2Ugc3VyZSB0byBsb2FkCiAgICAgICAgICAgICAgICAvLyBpdCBu\nb3cKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0Q2FzY2FkZURlbGV0ZSgp\nID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRPCiAgICAgICAgICAgICAg\nICAgICAgfHwgZm1kLmdldEtleSgpLmdldENhc2NhZGVEZWxldGUoKQogICAg\nICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9BVVRP\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldEVsZW1lbnQoKS5nZXRD\nYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfQVVUTykKICAgICAgICAgICAgICAgICAgICBjdXJW\nYWwgPSBmZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsK\nICAgICAgICAgICAgaWYgKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0g\nSmF2YVR5cGVzLk9JRCkKICAgICAgICAgICAgICAgIGFzc2VydE5vdE1hbmFn\nZWRPYmplY3RJZChuZXdWYWwpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRp\ncnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwog\nICAgICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAg\nICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFs\nKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUudW5wcm94eSgpOwogICAgICAg\nICAgICAgICAgX3NpbmdsZS5kZXJlZmVyZW5jZURlcGVuZGVudCgpOwogICAg\nICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgbmV3\nVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBm\naWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ1Nob3J0RmllbGQoUGVyc2lz\ndGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3Vy\nVmFsLCBzaG9ydCBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0\nICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBj\ndXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2Uo\nZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBC\nb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBf\nc2luZ2xlLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0dGluZ1N0cmluZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYywgaW50IGZpZWxkLAogICAgICAgIFN0cmluZyBjdXJWYWwsIFN0cmlu\nZyBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9S\nRU1PVEUpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmVxdWFscyhu\nZXdWYWwsIGN1clZhbCkgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlL\nZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5\nKGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIG5ld1Zh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogRGlzYWxsb3dzIGNoYW5naW5nIHByaW1hcnkg\na2V5IGZpZWxkcyBmb3IgaW5zdGFuY2VzLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGludCBmaWVsZCkgewog\nICAgICAgIGlmIChfb2lkICE9IG51bGwgJiYgX21ldGEuZ2V0RmllbGQoZmll\nbGQpLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICB0aHJvdyB0cmFuc2xh\ndGUobmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldAogICAgICAg\nICAgICAgICAgKCJjaGFuZ2UtaWRlbnRpdHkiKSkuc2V0RmFpbGVkT2JqZWN0\nKGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBEaXNhbGxvd3Mgc2V0dGluZyBhbiBvYmplY3QgaWQgZmllbGQgdG8gYSBt\nYW5hZ2VkIGluc3RhbmNlLgogICAgICovCiAgICB2b2lkIGFzc2VydE5vdE1h\nbmFnZWRPYmplY3RJZChPYmplY3QgdmFsKSB7CiAgICAgICAgaWYgKHZhbCAh\nPSBudWxsCiAgICAgICAgICAgICYmIChJbXBsSGVscGVyLnRvUGVyc2lzdGVu\nY2VDYXBhYmxlKHZhbCwKICAgICAgICAgICAgICAgICBnZXRDb250ZXh0KCku\nZ2V0Q29uZmlndXJhdGlvbigpKSkucGNHZXRHZW5lcmljQ29udGV4dCgpIT0g\nbnVsbCkKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlk\nU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgibWFu\nYWdlZC1vaWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKHZhbCksCiAgICAgICAg\nICAgICAgICAgICAgRXhjZXB0aW9ucy50b1N0cmluZyhnZXRNYW5hZ2VkSW5z\ndGFuY2UoKSkpKS4KICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChn\nZXRNYW5hZ2VkSW5zdGFuY2UoKSkpOwogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIERlbGVnYXRlIHRvIEZpZWxkTWFu\nYWdlcgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyB2b2lkIHByb3ZpZGVkQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gY3VyVmFsKSB7\nCiAgICAgICAgX2ZtLnN0b3JlQm9vbGVhbkZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkQnl0ZUZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGJ5dGUg\nY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlQnl0ZUZpZWxkKGZpZWxkLCBj\ndXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkQ2hhckZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAg\nIGNoYXIgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlQ2hhckZpZWxkKGZp\nZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVk\nRG91YmxlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQs\nCiAgICAgICAgZG91YmxlIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZURv\ndWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHByb3ZpZGVkRmxvYXRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMs\nIGludCBmaWVsZCwKICAgICAgICBmbG9hdCBjdXJWYWwpIHsKICAgICAgICBf\nZm0uc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHByb3ZpZGVkSW50RmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgaW50IGN1clZhbCkgewogICAg\nICAgIF9mbS5zdG9yZUludEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkTG9uZ0ZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGxvbmcgY3VyVmFsKSB7\nCiAgICAgICAgX2ZtLnN0b3JlTG9uZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkT2JqZWN0RmllbGQoUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgT2JqZWN0\nIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9yZU9iamVjdEZpZWxkKGZpZWxk\nLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3ZpZGVkU2hv\ncnRGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAg\nICAgICBzaG9ydCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVTaG9ydEZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHBy\nb3ZpZGVkU3RyaW5nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgU3RyaW5nIGN1clZhbCkgewogICAgICAgIF9mbS5z\ndG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIHJlcGxhY2VCb29sZWFuRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZl\ndGNoQm9vbGVhbkZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0\nZSByZXBsYWNlQnl0ZUZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50\nIGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEJ5dGVGaWVsZChm\naWVsZCk7CiAgICB9CgogICAgcHVibGljIGNoYXIgcmVwbGFjZUNoYXJGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAg\nIHJldHVybiBfZm0uZmV0Y2hDaGFyRmllbGQoZmllbGQpOwogICAgfQoKICAg\nIHB1YmxpYyBkb3VibGUgcmVwbGFjZURvdWJsZUZpZWxkKFBlcnNpc3RlbmNl\nQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5m\nZXRjaERvdWJsZUZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgZmxv\nYXQgcmVwbGFjZUZsb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBp\nbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNoRmxvYXRGaWVs\nZChmaWVsZCk7CiAgICB9CgogICAgcHVibGljIGludCByZXBsYWNlSW50Rmll\nbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAg\nICByZXR1cm4gX2ZtLmZldGNoSW50RmllbGQoZmllbGQpOwogICAgfQoKICAg\nIHB1YmxpYyBsb25nIHJlcGxhY2VMb25nRmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNo\nTG9uZ0ZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IHJl\ncGxhY2VPYmplY3RGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hPYmplY3RGaWVsZChm\naWVsZCk7CiAgICB9CgogICAgcHVibGljIHNob3J0IHJlcGxhY2VTaG9ydEZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAg\nICAgcmV0dXJuIF9mbS5mZXRjaFNob3J0RmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgcmVwbGFjZVN0cmluZ0ZpZWxkKFBlcnNpc3Rl\nbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9m\nbS5mZXRjaFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbXBsZW1lbnRh\ndGlvbiBvZiBGaWVsZE1hbmFnZXIKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xl\nYW4oaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBf\nbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRl\ncm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQm9vbGVhbkZp\nZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQo\nZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChCb29sZWFuKSBmbWQu\nZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5ib29sZWFuVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBmZXRjaEJvb2xlYW5GaWVs\nZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAg\nICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05F\nLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9w\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3Npbmds\nZS5mZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBieXRlIGZldGNoQnl0ZShpbnQgZmllbGQpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAg\nICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBy\nZXR1cm4gZmV0Y2hCeXRlRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3Qg\ndmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2Vy\nKSkuYnl0ZVZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgZmV0Y2hC\neXRlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpKQog\nICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxP\nQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHByb3ZpZGVG\naWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgcmV0dXJu\nIF9zaW5nbGUuZmV0Y2hCeXRlRmllbGQoZmllbGQpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgY2hhciBmZXRjaENoYXIoaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZldGNoQ2hhckZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2Jq\nZWN0IHZhbCA9IGZldGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICBy\nZXR1cm4gKChDaGFyYWN0ZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwg\nX2Jyb2tlcikpLmNoYXJWYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBjaGFy\nIGZldGNoQ2hhckZpZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZp\nZWxkKSkKICAgICAgICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xl\ndmVscy5MT0NLX05PTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBw\ncm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHJldHVybiBfc2luZ2xlLmZldGNoQ2hhckZpZWxkKGZpZWxkKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGRvdWJsZSBmZXRjaERvdWJsZShpbnQgZmll\nbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZp\nZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgp\nKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7\nCgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJuYWxW\nYWx1ZSh2YWwsIF9icm9rZXIpKS5kb3VibGVWYWx1ZSgpOwogICAgfQoKICAg\nIHB1YmxpYyBkb3VibGUgZmV0Y2hEb3VibGVGaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmll\nbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2Up\nOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaERvdWJsZUZp\nZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1\nbmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZsb2F0IGZl\ndGNoRmxvYXQoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBm\nbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQu\naXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoRmxv\nYXRGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZp\nZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBm\nbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5mbG9hdFZhbHVl\nKCk7CiAgICB9CgogICAgcHVibGljIGZsb2F0IGZldGNoRmxvYXRGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAg\nICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBm\nYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5m\nZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgaW50IGZldGNoSW50KGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlm\nICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBm\nZXRjaEludEZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZl\ndGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1i\nZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmludFZh\nbHVlKCk7CiAgICB9CgogICAgcHVibGljIGludCBmZXRjaEludEZpZWxkKGlu\ndCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAg\nICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZh\nbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZl\ndGNoSW50RmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nbG9uZyBmZXRjaExvbmcoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYg\nKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZl\ndGNoTG9uZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZl\ndGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1i\nZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmxvbmdW\nYWx1ZSgpOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGZldGNoTG9uZ0ZpZWxk\nKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAg\nICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUs\nIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3Bj\nLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xl\nLmZldGNoTG9uZ0ZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBmZXRjaE9iamVjdChpbnQgZmllbGQpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAg\nICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBy\nZXR1cm4gZmV0Y2hPYmplY3RGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVj\ndCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0\ndXJuIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcik7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBmZXRjaE9iamVjdEZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxv\nYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBm\nYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xl\nLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoT2Jq\nZWN0RmllbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc2hv\ncnQgZmV0Y2hTaG9ydChpbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0\nY2hTaG9ydEZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZl\ndGNoRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1i\nZXIpIGZtZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLnNob3J0\nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgc2hvcnQgZmV0Y2hTaG9ydEZp\nZWxkKGludCBmaWVsZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAg\nICAgICAgICAgIGxvYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05P\nTkUsIGZhbHNlLCBmYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQo\nX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2lu\nZ2xlLmZldGNoU2hvcnRGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBTdHJpbmcgZmV0Y2hTdHJpbmcoaW50IGZpZWxkKSB7CiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7\nCiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZldGNoU3RyaW5nRmllbGQoZmllbGQpOwoKICAgICAgICBP\nYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAg\nIHJldHVybiAoU3RyaW5nKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9i\ncm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZmV0Y2hTdHJpbmdG\naWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAg\nICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19O\nT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxk\nKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3Np\nbmdsZS5mZXRjaFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVCb29sZWFuKGludCBmaWVsZCwgYm9vbGVh\nbiBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0g\nX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0\nZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0b3JlQm9vbGVhbkZpZWxkKGZp\nZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAg\nIE9iamVjdCB2YWwgPSAoZXh0ZXJuYWxWYWwpID8gQm9vbGVhbi5UUlVFIDog\nQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgc3RvcmVGaWVsZChmaWVsZCwg\nZm1kLmdldEZpZWxkVmFsdWUodmFsLCBfYnJva2VyKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQm9vbGVhbkZpZWxkKGludCBm\naWVsZCwgYm9vbGVhbiBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJvb2xlYW5GaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9w\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmll\nbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQnl0ZShpbnQg\nZmllbGQsIGJ5dGUgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUJ5dGVG\naWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3\nIEJ5dGUoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQnl0ZUZpZWxkKGludCBm\naWVsZCwgYnl0ZSBjdXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRy\ndWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlQ2hhcihpbnQgZmllbGQs\nIGNoYXIgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZt\nZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5p\nc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUNoYXJGaWVsZChm\naWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IENoYXJh\nY3RlcihleHRlcm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVDaGFyRmllbGQoaW50IGZp\nZWxkLCBjaGFyIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlQ2hhckZpZWxkKGZpZWxk\nLCBjdXJWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2lu\nZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1\nZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVEb3VibGUoaW50IGZpZWxk\nLCBkb3VibGUgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZURvdWJsZUZp\nZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcg\nRG91YmxlKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9rZXIp\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZURvdWJsZUZpZWxkKGlu\ndCBmaWVsZCwgZG91YmxlIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBfc2luZ2xlLnN0b3JlRG91YmxlRmll\nbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChf\ncGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZp\nZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUZsb2F0KGlu\ndCBmaWVsZCwgZmxvYXQgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUZs\nb2F0RmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVl\nKG5ldyBGbG9hdChleHRlcm5hbFZhbCksCiAgICAgICAgICAgICAgICBfYnJv\na2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVGbG9hdEZpZWxk\nKGludCBmaWVsZCwgZmxvYXQgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVGbG9hdEZp\nZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBsYWNlRmllbGQo\nX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExvYWRlZChm\naWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxs\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVJbnQoaW50\nIGZpZWxkLCBpbnQgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFE\nYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAo\nIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUludEZp\nZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShOdW1i\nZXJzLnZhbHVlT2YoZXh0ZXJuYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jy\nb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50RmllbGQo\naW50IGZpZWxkLCBpbnQgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVJbnRGaWVsZChm\naWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQs\nIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlTG9uZyhpbnQgZmll\nbGQsIGxvbmcgZXh0ZXJuYWxWYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZUxvbmdGaWVs\nZChmaWVsZCwgZXh0ZXJuYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgc3RvcmVGaWVsZChmaWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoTnVtYmVy\ncy52YWx1ZU9mKGV4dGVybmFsVmFsKSwKICAgICAgICAgICAgICAgIF9icm9r\nZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUxvbmdGaWVsZChp\nbnQgZmllbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVMb25nRmllbGQo\nZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMs\nIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxk\nLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdChpbnQg\nZmllbGQsIE9iamVjdCBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGV4\ndGVybmFsVmFsID0gZm1kLm9yZGVyKGV4dGVybmFsVmFsKTsKICAgICAgICBp\nZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZU9i\namVjdEZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1\nZShleHRlcm5hbFZhbCwgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHN0b3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3VyVmFs\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAg\nICAgICAgICAgX3NpbmdsZS5wcm94eSh0cnVlLCBmYWxzZSk7CiAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAg\nICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9z\ndExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZVNob3J0KGludCBmaWVsZCwgc2hvcnQgZXh0ZXJuYWxWYWwp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQog\nICAgICAgICAgICBzdG9yZVNob3J0RmllbGQoZmllbGQsIGV4dGVybmFsVmFs\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQs\nIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBTaG9ydChleHRlcm5hbFZhbCksCiAg\nICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc3RvcmVTaG9ydEZpZWxkKGludCBmaWVsZCwgc2hvcnQgY3VyVmFsKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9z\naW5nbGUuc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAg\nICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAg\nICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBv\nc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc3RvcmVTdHJpbmcoaW50IGZpZWxkLCBTdHJpbmcgZXh0ZXJuYWxW\nYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZp\nZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgp\nKQogICAgICAgICAgICBzdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBleHRlcm5h\nbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZp\nZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShleHRlcm5hbFZhbCwgX2Jyb2tlcikp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nRmllbGQoaW50\nIGZpZWxkLCBTdHJpbmcgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTdHJpbmdGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9w\nYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmll\nbGQsIHRydWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIGdpdmVu\nIGZpZWxkIHZhbHVlIGludG8gdGhlIGdpdmVuIGZpZWxkIG1hbmFnZXIuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBzdG9yZUZpZWxkKGludCBmaWVsZCwg\nT2JqZWN0IHZhbCwgRmllbGRNYW5hZ2VyIGZtKSB7CiAgICAgICAgRmllbGRN\nZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAg\naWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgibm8tZmllbGQtaW5kZXgiLAogICAgICAgICAg\nICAgICAgU3RyaW5nLnZhbHVlT2YoZmllbGQpLCBfbWV0YS5nZXREZXNjcmli\nZWRUeXBlKCkpKS4KICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChn\nZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdl\ndERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5CT09MRUFOOgogICAgICAgICAgICAgICAgYm9vbGVhbiBib29sID0g\ndmFsICE9IG51bGwgJiYgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgp\nOwogICAgICAgICAgICAgICAgZm0uc3RvcmVCb29sZWFuRmllbGQoZmllbGQs\nIGJvb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBieXRlIGIgPSAo\ndmFsID09IG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgp\nOwogICAgICAgICAgICAgICAgZm0uc3RvcmVCeXRlRmllbGQoZmllbGQsIGIp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICBjaGFyIGMgPSAodmFsID09\nIG51bGwpID8gMCA6ICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1ZSgpOwog\nICAgICAgICAgICAgICAgZm0uc3RvcmVDaGFyRmllbGQoZmllbGQsIGMpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIGRvdWJsZSBkID0gKHZhbCA9\nPSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFsKS5kb3VibGVWYWx1ZSgpOwog\nICAgICAgICAgICAgICAgZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICBmbG9hdCBmID0gKHZhbCA9\nPSBudWxsKSA/IDAgOiAoKE51bWJlcikgdmFsKS5mbG9hdFZhbHVlKCk7CiAg\nICAgICAgICAgICAgICBmbS5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGYpOwog\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLklOVDoKICAgICAgICAgICAgICAgIGludCBpID0gKHZhbCA9PSBudWxs\nKSA/IDAgOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpOwogICAgICAgICAg\nICAgICAgZm0uc3RvcmVJbnRGaWVsZChmaWVsZCwgaSk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoK\nICAgICAgICAgICAgICAgIGxvbmcgbCA9ICh2YWwgPT0gbnVsbCkgPyAwIDog\nKChOdW1iZXIpIHZhbCkubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICBm\nbS5zdG9yZUxvbmdGaWVsZChmaWVsZCwgbCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAg\nICAgICAgICAgICBzaG9ydCBzID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51\nbWJlcikgdmFsKS5zaG9ydFZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5z\ndG9yZVNob3J0RmllbGQoZmllbGQsIHMpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAg\nICAgICAgICAgIGZtLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIChTdHJpbmcp\nIHZhbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgIGZtLnN0b3JlT2JqZWN0RmllbGQoZmll\nbGQsIHZhbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8K\nICAgIC8vIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogRXJhc2UgdGhlIGZhY3QgdGhhdCB0aGlzIGluc3RhbmNlIGhhcyBi\nZWVuIGZsdXNoZWQuCiAgICAgKi8KICAgIHZvaWQgZXJhc2VGbHVzaCgpIHsK\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgaW50IGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGg7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBmbWRzOyBpKyspCiAgICAgICAgICAgIF9mbHVzaC5jbGVh\ncihpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZHMgdGhhdCBhbGwg\naW5zdGFuY2UgZmllbGRzIGFyZS9hcmUgbm90IGxvYWRlZC4KICAgICAqIFBy\naW1hcnkga2V5IGFuZCBub24tcGVyc2lzdGVudCBmaWVsZHMgYXJlIG5vdCBh\nZmZlY3RlZC4KICAgICAqLwogICAgdm9pZCBzZXRMb2FkZWQoYm9vbGVhbiB2\nYWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdl\ndEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmlt\nYXJ5S2V5KCkKICAgICAgICAgICAgICAgICYmIGZtZHNbaV0uZ2V0TWFuYWdl\nbWVudCgpID09IGZtZHNbaV0uTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAg\nICAgICAgICBzZXRMb2FkZWQoaSwgdmFsKTsKICAgICAgICB9CiAgICAgICAg\naWYgKCF2YWwpIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0xPQURF\nRDsKICAgICAgICAgICAgc2V0RGlydHkoZmFsc2UpOwogICAgICAgIH0gZWxz\nZQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWNvcmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxk\ncyBhcmUvYXJlIG5vdCBkaXJ0eSwKICAgICAqIGFuZCBjaGFuZ2VzIHRoZSBm\nbGFncyBvZiB0aGUgaW5zdGFuY2UgYWNjb3JkaW5nbHkuCiAgICAgKi8KICAg\nIHZvaWQgc2V0RGlydHkoYm9vbGVhbiB2YWwpIHsKICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGJv\nb2xlYW4gdXBkYXRlID0gIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGlmICh2YWwgJiYgKCF1cGRhdGUKICAgICAgICAgICAgICAg\nIHx8IGZtZHNbaV0uZ2V0VXBkYXRlU3RyYXRlZ3koKSAhPSBVcGRhdGVTdHJh\ndGVnaWVzLklHTk9SRSkpCiAgICAgICAgICAgICAgICBfZGlydHkuc2V0KGkp\nOwogICAgICAgICAgICBlbHNlIGlmICghdmFsKSB7CiAgICAgICAgICAgICAg\nICAvLyB3ZSBuZXZlciBjb25zaWRlciBjbGVhbiBmaWVsZHMgZmx1c2hlZDsg\ndGhpcyBhbHNvIHRha2VzCiAgICAgICAgICAgICAgICAvLyBjYXJlIG9mIGNs\nZWFyaW5nIHRoZSBmbHVzaGVkIGZpZWxkcyBvbiBjb21taXQvcm9sbGJhY2sK\nICAgICAgICAgICAgICAgIF9mbHVzaC5jbGVhcihpKTsKICAgICAgICAgICAg\nICAgIF9kaXJ0eS5jbGVhcihpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nTE9BREVEOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZXMgcHJlLWNs\nZWFyIGNhbGxiYWNrcywgY2xlYXJzIGFsbCBtYW5hZ2VkIGZpZWxkcywgYW5k\nIGNhbGxzIHRoZQogICAgICoge0BsaW5rICNzZXRMb2FkZWR9IG1ldGhvZCB3\naXRoIGEgdmFsdWUgb2YgZmFsc2UuIFByaW1hcnkga2V5IGZpZWxkcwogICAg\nICogYXJlIG5vdCBjbGVhcmVkLgogICAgICovCiAgICB2b2lkIGNsZWFyRmll\nbGRzKCkgewogICAgICAgIGlmICghaXNJbnRlcmNlcHRpbmcoKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlm\nZWN5Y2xlRXZlbnQuQkVGT1JFX0NMRUFSKTsKCiAgICAgICAgLy8gdW5wcm94\neSBhbGwgZmllbGRzCiAgICAgICAgdW5wcm94eUZpZWxkcygpOwoKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY2xlYXIg\nbm9uLXBrIGZpZWxkcwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIGlmICghZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiBmbWRzW2ldLmdldE1h\nbmFnZW1lbnQoKQogICAgICAgICAgICAgICAgICAgID09IEZpZWxkTWV0YURh\ndGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICAgICAgcmVw\nbGFjZUZpZWxkKF9wYywgQ2xlYXJGaWVsZE1hbmFnZXIuZ2V0SW5zdGFuY2Uo\nKSwgaSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZvcmdldCB2\nZXJzaW9uIGluZm8gYW5kIGltcGwgZGF0YSBzbyB3ZSByZS1yZWFkIG5leHQg\ndGltZQogICAgICAgICAgICBzZXRMb2FkZWQoZmFsc2UpOwogICAgICAgICAg\nICBfdmVyc2lvbiA9IG51bGw7CiAgICAgICAgICAgIF9sb2FkVmVyc2lvbiA9\nIG51bGw7CiAgICAgICAgICAgIGlmIChfZmllbGRJbXBsICE9IG51bGwpCiAg\nICAgICAgICAgICAgICBBcnJheXMuZmlsbChfZmllbGRJbXBsLCBudWxsKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CgogICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVF\ndmVudC5BRlRFUl9DTEVBUik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNv\ncmQgdGhhdCB3ZSBzaG91bGQgc2F2ZSBhbnkgZmllbGRzIHRoYXQgY2hhbmdl\nIGZyb20gdGhpcyBwb2ludAogICAgICogZm9yd2FyZC4KICAgICAqLwogICAg\ndm9pZCBzYXZlRmllbGRzKGJvb2xlYW4gaW1tZWRpYXRlKSB7CiAgICAgICAg\naWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0gUmVzdG9yZVN0YXRl\nLlJFU1RPUkVfTk9ORQogICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19J\nTlZFUlNFUykgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBf\nZmxhZ3MgfD0gRkxBR19TQVZFOwogICAgICAgIGlmIChpbW1lZGlhdGUpIHsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVu\nZ3RoKCk7IGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAgIHNhdmVGaWVs\nZChpKTsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NBVkU7CiAgICAg\nICAgICAgIC8vIE9QRU5KUEEtNjU5CiAgICAgICAgICAgIC8vIHJlY29yZCBh\nIHNhdmVkIGZpZWxkIG1hbmFnZXIgZXZlbiBpZiBubyBmaWVsZCBpcyBjdXJy\nZW50bHkgbG9hZGVkCiAgICAgICAgICAgIC8vIGFzIGV4aXN0ZW5jZSBvZiBh\nIFNhdmVGaWVsZE1hbmFnZXIgaXMgY3JpdGljYWwgZm9yIGEgZGlydHkgY2hl\nY2sKICAgICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxsKQogICAgICAgICAg\nICAJX3NhdmVkID0gbmV3IFNhdmVGaWVsZE1hbmFnZXIodGhpcywgZ2V0UGVy\nc2lzdGVuY2VDYXBhYmxlKCksIAogICAgICAgICAgICAJCQkJX2RpcnR5KTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgZmllbGQg\naXNuJ3QgYWxyZWFkeSBzYXZlZCwgc2F2ZXMgdGhlIGN1cnJlbnRseSBsb2Fk\nZWQgZmllbGQKICAgICAqIHN0YXRlIG9mIHRoZSBpbnN0YW5jZS4gVGhlIHNh\ndmVkIHZhbHVlcyBjYW4gYWxsIGJlIHJlc3RvcmVkIHZpYQogICAgICoge0Bs\naW5rICNyZXN0b3JlRmllbGRzfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHNhdmVGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfU0FWRSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICAvLyBpZiB0aGlzIGlzIGEgbWFuYWdlZCBpbnZlcnNlIGZpZWxkLCBsb2Fk\nIGl0IHNvIHdlJ3JlIHN1cmUgdG8gaGF2ZQogICAgICAgIC8vIHRoZSBvcmln\naW5hbCB2YWx1ZQogICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpICYm\nICgoX2ZsYWdzICYgRkxBR19JTlZFUlNFUykgIT0gMAogICAgICAgICAgICAm\nJiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuZ2V0SW52ZXJzZU1ldGFEYXRhcygp\nLmxlbmd0aCA+IDApKQogICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExv\nY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAv\nLyBkb24ndCBib3RoZXIgY3JlYXRpbmcgdGhlIHNhdmUgZmllbGQgbWFuYWdl\nciBpZiB3ZSdyZSBub3QgZ29pbmcgdG8KICAgICAgICAvLyBzYXZlIHRoZSBv\nbGQgZmllbGQgdmFsdWUgYW55d2F5CiAgICAgICAgaWYgKF9zYXZlZCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkpCiAg\nICAgICAgICAgICAgICBfc2F2ZWQgPSBuZXcgU2F2ZUZpZWxkTWFuYWdlcih0\naGlzLCBudWxsLCBfZGlydHkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjb3B5IHRo\nZSBmaWVsZCB0byBzYXZlIGZpZWxkIG1hbmFnZXI7IGlmIHRoZSBmaWVsZCBp\ncyBub3QgZGlyZWN0bHkKICAgICAgICAvLyBjb3B5YWJsZSwgaW1tZWRpYXRl\nbHkgcHJvdmlkZSBhbmQgcmVwbGFjZSBpdCB2aWEgdGhlIHNhdmUgZmllbGQK\nICAgICAgICAvLyBtYW5hZ2VyLCB3aGljaCB3aWxsIGNvcHkgdGhlIG11dGFi\nbGUgdmFsdWUgdG8gcHJldmVudCBieS1yZWYgbW9kcwogICAgICAgIGlmIChf\nc2F2ZWQuc2F2ZUZpZWxkKGZpZWxkKSkgewogICAgICAgICAgICBwcm92aWRl\nRmllbGQoX3BjLCBfc2F2ZWQsIGZpZWxkKTsKICAgICAgICAgICAgcmVwbGFj\nZUZpZWxkKF9zYXZlZC5nZXRTdGF0ZSgpLCBfc2F2ZWQsIGZpZWxkKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhh\ndCB0aGUgc3RhdGUgd2lsbCBub3QgbmVlZCB0byBiZSByb2xsZWQgYmFjawog\nICAgICogdG8gdGhhdCBvZiB0aGUgbGFzdCBjYWxsIHRvIHtAbGluayAjc2F2\nZUZpZWxkc30uCiAgICAgKi8KICAgIHZvaWQgY2xlYXJTYXZlZEZpZWxkcygp\nIHsKICAgICAgICBpZiAoaXNJbnRlcmNlcHRpbmcoKSkgewogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfU0FWRTsKICAgICAgICAgICAgX3NhdmVkID0g\nbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFNhdmVGaWVsZE1h\nbmFnZXIgZ2V0U2F2ZUZpZWxkTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4g\nX3NhdmVkOwogICAgfQoKICAgIC8qKgogICAgICogUm9sbGJhY2sgdGhlIHN0\nYXRlIG9mIHRoZSBpbnN0YW5jZSB0byB0aGUgc2F2ZWQgc3RhdGUgZnJvbSB0\naGUKICAgICAqIGxhc3QgY2FsbCB0byB7QGxpbmsgI3NhdmVGaWVsZHN9LCBv\nciB0byBkZWZhdWx0IHZhbHVlcyBpZiBuZXZlciBzYXZlZC4KICAgICAqLwog\nICAgdm9pZCByZXN0b3JlRmllbGRzKCkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3NhdmVkID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TQVZFKSA9PSAw\nKQogICAgICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAg\nICAgICAgICBlbHNlIC8vIG9ubHkgdW5sb2FkZWQgZmllbGRzIHdlcmUgZGly\ndGllZAogICAgICAgICAgICAgICAgICAgIF9sb2FkZWQuYW5kTm90KF9sb2Fk\nZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHdlIGRpcmVjdCBz\ndGF0ZSB0cmFuc2l0aW9ucyBiYXNlZCBvbiBvdXIgb3duIGdldFJlc3RvcmVT\ndGF0ZQogICAgICAgICAgICAvLyBtZXRob2QsIGJ1dCB0byBkZWNpZGUgd2hl\ndGhlciB0byBhY3R1YWxseSByb2xsYmFjayBmaWVsZAogICAgICAgICAgICAv\nLyB2YWx1ZXMsIHdlIGNvbnN1bHQgdGhlIGJyb2tlciBmb3IgdGhlIHVzZXIn\ncyBzZXR0aW5nCiAgICAgICAgICAgIGVsc2UgaWYgKF9icm9rZXIuZ2V0UmVz\ndG9yZVN0YXRlKCkgIT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORSkgewog\nICAgICAgICAgICAgICAgLy8gcm9sbGJhY2sgYWxsIGN1cnJlbnRseS1sb2Fk\nZWQgZmllbGRzCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVu\nID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAg\nICAgICAgICAgIGlmIChfbG9hZGVkLmdldChpKSAmJiBfc2F2ZWQucmVzdG9y\nZUZpZWxkKGkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmll\nbGQoX3BjLCBfc2F2ZWQsIGkpOwoKICAgICAgICAgICAgICAgIC8vIHJvbGxi\nYWNrIGxvYWRlZCBzZXQKICAgICAgICAgICAgICAgIF9sb2FkZWQuYW5kTm90\nKF9zYXZlZC5nZXRVbmxvYWRlZCgpKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZXMgYWxsIHNl\nY29uZCBjbGFzcyBvYmplY3QgZmllbGRzIHdpdGggZnJlc2ggcHJveGllZCBp\nbnN0YW5jZXMKICAgICAqIGNvbnRhaW5pbmcgdGhlIHNhbWUgaW5mb3JtYXRp\nb24gYXMgdGhlIG9yaWdpbmFscy4KICAgICAqLwogICAgdm9pZCBwcm94eUZp\nZWxkcyhib29sZWFuIHJlc2V0LCBib29sZWFuIHJlcGxhY2VOdWxsKSB7CiAg\nICAgICAgLy8gd2Ugb25seSByZXBsYWNlIG51bGxzIGlmIHRoZSBydW50aW1l\nIGNhbid0IGRpZmZlcmVudGlhdGUgYmV0d2VlbgogICAgICAgIC8vIG51bGwg\nYW5kIGVtcHR5IGNvbnRhaW5lcnMuICB3ZSByZXBsYWNlIG51bGxzIGluIHRo\naXMgY2FzZSB0bwogICAgICAgIC8vIG1haW50YWluIGNvbnNpc3RlbmN5IHdo\nZXRoZXIgdmFsdWVzIGFyZSBiZWluZyByZXRhaW5lZCBvciBub3QKICAgICAg\nICBpZiAocmVwbGFjZU51bGwpCiAgICAgICAgICAgIHJlcGxhY2VOdWxsID0g\nIV9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRlZE9wdGlvbnMo\nKS4KICAgICAgICAgICAgICAgIGNvbnRhaW5zKE9wZW5KUEFDb25maWd1cmF0\naW9uLk9QVElPTl9OVUxMX0NPTlRBSU5FUik7CgogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVu\nID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBpZiAoX2xvYWRlZC5nZXQoaSkpIHsKICAgICAgICAgICAgICAg\nICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoX3NpbmdsZS5wcm94eShyZXNldCwgcmVwbGFjZU51\nbGwpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3Bj\nLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFVucHJveHkgYWxsIGZpZWxkcy4KICAgICAqLwogICAgdm9pZCB1\nbnByb3h5RmllbGRzKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19O\nT19VTlBST1hZKSAhPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKGludCBp\nID0gMCwgbGVuID0gX2xvYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xlLCBp\nKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUudW5wcm94eSgpOwogICAgICAg\nICAgICAgICAgX3NpbmdsZS5yZWxlYXNlRW1iZWRkZWQoKTsKICAgICAgICAg\nICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2V0IHJlYWR5IGZvciBh\nIGZsdXNoLiBQZXJzaXN0cyBhbGwgcGVyc2lzdGVuY2UtY2FwYWJsZSBvYmpl\nY3QgZmllbGRzLAogICAgICogYW5kIGNoZWNrcyBmb3IgaWxsZWdhbCBudWxs\nIHZhbHVlcy4gQWxzbyBhc3NpZ25zIG9pZHMgYW5kIGZpZWxkIHZhbHVlcwog\nICAgICogZm9yIGFsbCBzdHJhdGVnaWVzIHRoYXQgZG9uJ3QgcmVxdWlyZSBm\nbHVzaGluZy4KICAgICAqLwogICAgdm9pZCBwcmVGbHVzaChib29sZWFuIGxv\nZ2ljYWwsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfUFJFX0ZMVVNIRUQpICE9IDApCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgaWYgKGlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAg\nIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfU1RP\nUkUpOwogICAgICAgICAgICAvLyBCRUZPUkVfUEVSU0lTVCBpcyBoYW5kbGVk\nIGR1cmluZyBCcm9rZXIucGVyc2lzdCBhbmQgQnJva2VyLmF0dGFjaAogICAg\nICAgICAgICBpZiAoaXNEZWxldGVkKCkpCiAgICAgICAgICAgICAgICBmaXJl\nTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX0RFTEVURSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKCEoaXNOZXcoKSAmJiAhaXNGbHVzaGVk\nKCkpKQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVj\neWNsZUV2ZW50LkJFRk9SRV9VUERBVEUpOwogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19QUkVfRkxVU0hFRDsKICAgICAgICB9CgogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIWxvZ2ljYWwpCiAg\nICAgICAgICAgICAgICBhc3NpZ25PYmplY3RJZChmYWxzZSwgdHJ1ZSk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwLCBsZW4gPSBfbWV0YS5nZXRGaWVs\nZHMoKS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKChsb2dpY2FsIHx8ICFhc3NpZ25GaWVsZChpLCB0cnVlKSkgJiYgIV9m\nbHVzaC5nZXQoaSkKICAgICAgICAgICAgICAgICAgICAmJiBfZGlydHkuZ2V0\nKGkpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywg\nX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9zaW5nbGUu\ncHJlRmx1c2gobG9naWNhbCwgY2FsbCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgX3Npbmds\nZS5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBkaXJ0eUNoZWNrKCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBjYWxsYmFja3MgZm9yIGRlbGV0aW9uLgogICAgICov\nCiAgICB2b2lkIHByZURlbGV0ZSgpIHsKICAgICAgICAvLyBzZXQgYSBmbGFn\nIHdoaWxlIGNhbGwgcHJlIGRlbGV0ZSBjYWxsYmFjayBzbyB0aGF0IHVzZXIg\nY2FuJ3QKICAgICAgICAvLyBnZXQgaW50byBpbmZpbml0ZSByZWN1cnNpb24g\nYnkgY2FsbGluZyBkZWxldGUodGhpcykKICAgICAgICAvLyB3aXRoaW4gaGlz\nIGNhbGxiYWNrIG1ldGhvZAogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19Q\nUkVfREVMRVRJTkcpID09IDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfUFJFX0RFTEVUSU5HOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9S\nRV9ERUxFVEUpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgX2ZsYWdzICY9IH5GTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENhc2NhZGUg\nZGVsZXRlcyBhbmQgZGVyZWZlcmVuY2UgZGVwZW5kZW50IGZpZWxkcy4KICAg\nICAqLwogICAgdm9pZCBjYXNjYWRlRGVsZXRlKE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZp\nZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRl\nRGVsZXRlKCkgIT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAg\nICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZURlbGV0\nZSgpCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nTk9ORQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCku\nZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfTk9ORSkgewogICAgICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZU9iamVjdEZpZWxkKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsK\nICAgICAgICAgICAgICAgIF9zaW5nbGUuZGVsZXRlKGNhbGwpOwogICAgICAg\nICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGFmdGVyIGFuIGlu\nc3RhbmNlIGlzIHBlcnNpc3RlZCBieSBhIHVzZXIgdGhyb3VnaCB0aGUgYnJv\na2VyLgogICAgICogQ2FzY2FkZXMgdGhlIHBlcnNpc3Qgb3BlcmF0aW9uIHRv\nIGZpZWxkcyBtYXJrZWQKICAgICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NB\nU0NBREVfSU1NRURJQVRFfS4KICAgICAqLwogICAgdm9pZCBjYXNjYWRlUGVy\nc2lzdChPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\naWYgKCFfbG9hZGVkLmdldChpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwoKICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZVBlcnNpc3Qo\nKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAg\nICAgICAgICB8fCBmbWRzW2ldLmdldEtleSgpLmdldENhc2NhZGVQZXJzaXN0\nKCkKICAgICAgICAgICAgICAgID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9J\nTU1FRElBVEUKICAgICAgICAgICAgICAgIHx8IGZtZHNbaV0uZ2V0RWxlbWVu\ndCgpLmdldENhc2NhZGVQZXJzaXN0KCkKICAgICAgICAgICAgICAgID09IFZh\nbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUuc3RvcmVPYmplY3RGaWVsZChpLCBmZXRjaEZpZWxkKGks\nIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnBlcnNpc3QoY2Fs\nbCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNsZWFyKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBMb2FkIHRo\nZSBnaXZlbiBmaWVsZCBzZXQgZnJvbSB0aGUgZGF0YSBzdG9yZSBpbnRvIHRo\nZSBpbnN0YW5jZS4KICAgICAqIFJldHVybiB0cnVlIGlmIGFueSBkYXRhIGlz\nIGxvYWRlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBib29sZWFu\nIGxvYWRGaWVsZHMoQml0U2V0IGZpZWxkcywgRmV0Y2hDb25maWd1cmF0aW9u\nIGZldGNoLCBpbnQgbG9ja0xldmVsLAogICAgICAgIE9iamVjdCBzZGF0YSkg\newogICAgICAgIC8vIGNhbid0IGxvYWQgdmVyc2lvbiBmaWVsZCBmcm9tIHN0\nb3JlCiAgICAgICAgaWYgKGZpZWxkcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGEgdmZpZWxkID0gX21ldGEuZ2V0VmVyc2lvbkZpZWxk\nKCk7CiAgICAgICAgICAgIGlmICh2ZmllbGQgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGZpZWxkcy5jbGVhcih2ZmllbGQuZ2V0SW5kZXgoKSk7CiAgICAg\nICAgfQoKICAgICAgICBib29sZWFuIHJldCA9IGZhbHNlOwogICAgICAgIHNl\ndExvYWRpbmcodHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g\naWYgYW55IGZpZWxkcyBnaXZlbiwgbG9hZCB0aGVtCiAgICAgICAgICAgIGlu\ndCBsZW4gPSAoZmllbGRzID09IG51bGwpID8gMCA6IGZpZWxkcy5sZW5ndGgo\nKTsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgICAg\nIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZldGNo\nID0gX2Jyb2tlci5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAg\nICAgICAgIGlmICghX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5sb2FkKHRo\naXMsIGZpZWxkcywgZmV0Y2gsCiAgICAgICAgICAgICAgICAgICAgbG9ja0xl\ndmVsLCBzZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nT2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oX2xvYy5nZXQoImRlbC1pbnN0YW5j\nZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSwgX29pZCkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRG\nYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNlKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHZlcnNpb24gaW5mb3Jt\nYXRpb24gaGFzIGJlZW4gc2V0OyB2ZXJzaW9uIGluZm8gbXVzdAogICAgICAg\nICAgICAvLyBhbHdheXMgYmUgc2V0IGFmdGVyIHRoZSBmaXJzdCBzdGF0ZSBs\nb2FkIG9yIHNldCAod2hpY2ggaXMgd2h5CiAgICAgICAgICAgIC8vIHdlIGRv\nIHRoaXMgZXZlbiBpZiBubyBmaWVsZHMgd2VyZSBsb2FkZWQgLS0gY291bGQg\nYmUgdGhhdCB0aGlzCiAgICAgICAgICAgIC8vIG1ldGhvZCBpcyBiZWluZyBj\nYWxsZWQgYWZ0ZXIgYSBmaWVsZCBpcyBzZXQpLi4uIHNvbWUgaW5zdGFuY2Vz\nCiAgICAgICAgICAgIC8vIG1pZ2h0IG5vdCBoYXZlIHZlcnNpb24gaW5mbywg\naW4gd2hpY2ggY2FzZSB0aGlzIGdldHMgY2FsbGVkCiAgICAgICAgICAgIC8v\nIG11dGlwbGUgdGltZXM7IHRoYXQgc2hvdWxkIGJlIG9rIHRvbwogICAgICAg\nICAgICBpZiAoX2xvYWRWZXJzaW9uID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIHN5bmNWZXJzaW9uKHNkYXRhKTsKICAgICAgICAgICAgICAgIHJldCA9\nIHJldCB8fCBfbG9hZFZlcnNpb24gIT0gbnVsbDsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgc2V0TG9h\nZGluZyhmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZWUgaWYgdGhl\nIGRmZyBpcyBub3cgbG9hZGVkOyBkbyB0aGlzIHJlZ2FyZGxlc3Mgb2Ygd2hl\ndGhlciB3ZQogICAgICAgIC8vIGxvYWRlZCBhbnkgZmllbGRzLCBjYXVzZSBt\nYXkgYWxyZWFkeSBoYXZlIGJlZW4gbG9hZGVkIGJ5CiAgICAgICAgLy8gU3Rv\ncmVNYW5hZ2VyIGR1cmluZyBpbml0aWFsaXphdGlvbgogICAgICAgIHBvc3RM\nb2FkKC0xLCBmZXRjaCk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAg\nICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIGZpZWxkJ3MgZmV0Y2ggZ3Jv\ndXA7IHRoZSBmaWVsZCBpdHNlbGYgbWF5IGFscmVhZHkgYmUKICAgICAqIGxv\nYWRlZCBpZiBpdCBpcyBiZWluZyBzZXQgYnkgdGhlIHVzZXIuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGxvYWRGaWVsZChpbnQgZmllbGQsIGludCBs\nb2NrTGV2ZWwsIGJvb2xlYW4gZm9yV3JpdGUsCiAgICAgICAgYm9vbGVhbiBm\nZ3MpIHsKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBfYnJv\na2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIEJp\ndFNldCBmaWVsZHMgPSBudWxsOwoKICAgICAgICAvLyBpZiB0aGlzIGlzIGEg\nZGZnIGZpZWxkIG9yIHdlIG5lZWQgdG8gbG9hZCBvdXIgZGZnLCBkbyBzbwog\nICAgICAgIGlmIChmZ3MgJiYgKF9mbGFncyAmIEZMQUdfTE9BREVEKSA9PSAw\nKQogICAgICAgICAgICBmaWVsZHMgPSBnZXRVbmxvYWRlZEludGVybmFsKGZl\ndGNoLCBMT0FEX0ZHUywgbnVsbCk7CiAgICAgICAgCiAgICAgICAgLy8gY2hl\nY2sgZm9yIGxvYWQgZmV0Y2ggZ3JvdXAKICAgICAgICBTdHJpbmcgbGZnID0g\nZm1kLmdldExvYWRGZXRjaEdyb3VwKCk7CiAgICAgICAgYm9vbGVhbiBsZmdB\nZGRlZCA9IGZhbHNlOwogICAgICAgIGlmIChsZmcgIT0gbnVsbCkgeyAgCiAg\nICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0Rmll\nbGRzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdl\ndChpKSAmJiAoaSA9PSBmaWVsZAogICAgICAgICAgICAgICAgICAgIHx8IGZt\nZHNbaV0uaXNJbkZldGNoR3JvdXAobGZnKSkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoZmllbGRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZpZWxkcyA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgICAgIGZpZWxkcy5zZXQoaSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlbGF0aW9uIGZpZWxk\nIGlzIGxvYWRlZCB3aXRoIHRoZSBsb2FkLWZldGNoLWdyb3VwCiAgICAgICAg\nICAgIC8vIGJ1dCB0aGlzIGFkZGl0aW9uIG11c3QgYmUgcmV2ZXJ0ZWQgb25j\nZSB0aGUgbG9hZCBpcyBvdmVyCiAgICAgICAgICAgIGlmICghZmV0Y2guaGFz\nRmV0Y2hHcm91cChsZmcpKSB7CiAgICAgICAgICAgICAgICBmZXRjaC5hZGRG\nZXRjaEdyb3VwKGxmZyk7CiAgICAgICAgICAgICAgICBsZmdBZGRlZCA9IHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGZtZC5pc0lu\nRGVmYXVsdEZldGNoR3JvdXAoKSAmJiBmaWVsZHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBubyBsb2FkIGdyb3VwIGJ1dCBkZmc6IGFkZCBkZmcgZmll\nbGRzIGlmIHdlIGhhdmVuJ3QgYWxyZWFkeQogICAgICAgICAgICBmaWVsZHMg\nPSBnZXRVbmxvYWRlZEludGVybmFsKGZldGNoLCBMT0FEX0ZHUywgbnVsbCk7\nCiAgICAgICAgfSBlbHNlIGlmICghX2xvYWRlZC5nZXQoZm1kLmdldEluZGV4\nKCkpKSB7CiAgICAgICAgICAgIC8vIG5vIGxvYWQgZ3JvdXAgb3IgZGZnOiBs\nb2FkIGluZGl2aWR1YWwgZmllbGQKICAgICAgICAgICAgaWYgKGZpZWxkcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEJpdFNldCgp\nOwogICAgICAgICAgICBmaWVsZHMuc2V0KGZtZC5nZXRJbmRleCgpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGNhbGwgdGhpcyBtZXRob2QgZXZlbiBpZiB0\naGVyZSBhcmUgbm8gdW5sb2FkZWQgZmllbGRzOyBsb2FkRmllbGRzCiAgICAg\nICAgLy8gdGFrZXMgY2FyZSBvZiB0aGluZ3MgbGlrZSBsb2FkaW5nIHZlcnNp\nb24gaW5mbyBhbmQgc2V0dGluZyBQQyBmbGFncwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGxvYWRGaWVsZHMoZmllbGRzLCBmZXRjaCwgbG9ja0xldmVs\nLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nbGZnQWRkZWQpCiAgICAgICAgICAgICAgICBmZXRjaC5yZW1vdmVGZXRjaEdy\nb3VwKGxmZyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVs\ncGVyIG1ldGhvZCB0byBwcm92aWRlIHRoZSBnaXZlbiBmaWVsZCBudW1iZXIg\ndG8gdGhlIGdpdmVuCiAgICAgKiBmaWVsZCBtYW5hZ2VyLgogICAgICovCiAg\nICB2b2lkIHByb3ZpZGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIEZp\nZWxkTWFuYWdlciBzdG9yZSwgaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRN\nYW5hZ2VyIGJlZm9yZUZNID0gX2ZtOwogICAgICAgIF9mbSA9IHN0b3JlOwog\nICAgICAgIHBjLnBjUHJvdmlkZUZpZWxkKGZpZWxkKTsKICAgICAgICAvLyBS\nZXRhaW5pbmcgb3JpZ2luYWwgRk0gYmVjYXVzZSBvZiB0aGUgcG9zc2liaWxp\ndHkgb2YgcmVlbnRyYW50IGNhbGxzCiAgICAgICAgX2ZtID0gYmVmb3JlRk07\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHJlcGxh\nY2UgdGhlIGdpdmVuIGZpZWxkIG51bWJlciB0byB0aGUgZ2l2ZW4KICAgICAq\nIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8KICAgIHZvaWQgcmVwbGFjZUZpZWxk\nKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgRmllbGRNYW5hZ2VyIGxvYWQsIGlu\ndCBmaWVsZCkgewogICAgICAgIEZpZWxkTWFuYWdlciBiZWZvcmVGTSA9IF9m\nbTsKICAgICAgICBfZm0gPSBsb2FkOwogICAgICAgIHBjLnBjUmVwbGFjZUZp\nZWxkKGZpZWxkKTsKICAgICAgICAvLyBSZXRhaW5pbmcgb3JpZ2luYWwgRk0g\nYmVjYXVzZSBvZiB0aGUgcG9zc2liaWxpdHkgb2YgcmVlbnRyYW50IGNhbGxz\nCiAgICAgICAgX2ZtID0gYmVmb3JlRk07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYXJrIHRoZSBmaWVsZCBhcyBsb2FkZWQgb3IgdW5sb2FkZWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBzZXRMb2FkZWQoaW50IGZpZWxkLCBib29s\nZWFuIGlzTG9hZGVkKSB7CiAgICAgICAgLy8gZG9uJ3QgY29udGludWUgaWYg\nbG9hZGVkIHN0YXRlIGlzIGFscmVhZHkgY29ycmVjdDsgb3RoZXJ3aXNlIHdl\nCiAgICAgICAgLy8gY2FuIGVuZCB1cCBjbGVhcmluZyBfZmllbGRJbXBsIHdo\nZW4gd2Ugc2hvdWxkbid0CiAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGZpZWxk\nKSA9PSBpc0xvYWRlZCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAv\nLyBpZiBsb2FkaW5nLCBjbGVhciBpbnRlcm1lZGlhdGUgZGF0YTsgaWYgdW5s\nb2FkaW5nLCBjbGVhciBpbXBsIGRhdGEKICAgICAgICBpZiAoX2ZpZWxkSW1w\nbCAhPSBudWxsKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRF\neHRyYUZpZWxkRGF0YUluZGV4KGZpZWxkKTsKICAgICAgICAgICAgaWYgKGlk\neCAhPSAtMSkKICAgICAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IG51\nbGw7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNMb2FkZWQpCiAgICAgICAg\nICAgIF9sb2FkZWQuc2V0KGZpZWxkKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIF9sb2FkZWQuY2xlYXIoZmllbGQpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGVyZm9ybSBwb3N0LWxvYWQgc3RlcHMsIGluY2x1ZGluZyB0aGUgcG9z\ndCBsb2FkIGNhbGxiYWNrLgogICAgICogV2UgaGF2ZSB0byBjaGVjayB0aGUg\nZGZnIGFmdGVyIGFsbCBmaWVsZCBsb2FkcyBiZWNhdXNlIGl0IG1pZ2h0IGJl\nCiAgICAgKiBsb2FkZWQgaW4gbXVsdGlwbGUgc3RlcHMgd2hlbiBwYWdpbmcg\naXMgaW52b2x2ZWQ7IHRoZSBpbml0aWFsIGxvYWQKICAgICAqIG1pZ2h0IGV4\nY2x1ZGUgc29tZSBmaWVsZHMgd2hpY2ggYXJlIHRoZW4gaW1tZWRpYXRlbHkg\nbG9hZGVkIGluIGEKICAgICAqIHNlcGFyYXRlIHN0ZXAgYmVmb3JlIGJlaW5n\nIHJldHVybmVkIHRvIHRoZSB1c2VyLgogICAgICoKICAgICAqIEBwYXJhbSBm\naWVsZCB0aGUgZmllbGQgaW5kZXggdGhhdCB3YXMgbG9hZGVkLCBvciAtMSB0\nbyBpbmRpY2F0ZQogICAgICogdGhhdCBhIGdyb3VwIG9mIHBvc3NpYmx5IHVu\na25vd24gZmllbGRzIHdhcyBsb2FkZWQKICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHBvc3RMb2FkKGludCBmaWVsZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZl\ndGNoKSB7CiAgICAgICAgLy8gbm8gbmVlZCBmb3IgcG9zdExvYWQgY2FsbGJh\nY2s/CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0xPQURFRCkgIT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpbiB0aGUgbWlkZGxl\nIG9mIGEgZ3JvdXAgbG9hZCwgYWZ0ZXIgd2hpY2ggdGhpcyBtZXRob2Qgd2ls\nbCBiZQogICAgICAgIC8vIGNhbGxlZCBhZ2Fpbj8KICAgICAgICBpZiAoZmll\nbGQgIT0gLTEgJiYgaXNMb2FkaW5nKCkpCiAgICAgICAgICAgIHJldHVybjsK\nCiAgICAgICAgLy8gbm8gbGlzdGVuZXJzPwogICAgICAgIExpZmVjeWNsZUV2\nZW50TWFuYWdlciBtZ3IgPSBfYnJva2VyLmdldExpZmVjeWNsZUV2ZW50TWFu\nYWdlcigpOwogICAgICAgIGlmIChtZ3IgPT0gbnVsbCB8fCAhbWdyLmhhc0xv\nYWRMaXN0ZW5lcnMoZ2V0TWFuYWdlZEluc3RhbmNlKCksIF9tZXRhKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkK\nICAgICAgICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJh\ndGlvbigpOwogICAgICAgIC8vIGlzIHRoaXMgZmllbGQgYSBwb3N0LWxvYWQg\nZmllbGQ/CiAgICAgICAgaWYgKGZpZWxkICE9IC0xKSB7CiAgICAgICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAog\nICAgICAgICAgICAgICAgJiYgZmV0Y2guaGFzRmV0Y2hHcm91cChGZXRjaEdy\nb3VwLk5BTUVfREVGQVVMVCkKICAgICAgICAgICAgICAgICYmIHBvc3RMb2Fk\nKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxULCBmZXRjaCkpCiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIFN0cmluZ1tdIGZncyA9IGZtZC5n\nZXRDdXN0b21GZXRjaEdyb3VwcygpOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlm\nIChmZXRjaC5oYXNGZXRjaEdyb3VwKGZnc1tpXSkgJiYgcG9zdExvYWQoZmdz\nW2ldLCBmZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0g\nZmV0Y2guZ2V0RmV0Y2hHcm91cHMoKS5pdGVyYXRvcigpOyAKICAgICAgICAg\nICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBpZiAo\ncG9zdExvYWQoKFN0cmluZykgaXRyLm5leHQoKSwgZmV0Y2gpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gcG9zdC1sb2FkIGFjdGlv\nbnMgaWYgdGhlIGdpdmVuIGZldGNoIGdyb3VwIGlzIGEgcG9zdC1sb2FkIGdy\nb3VwCiAgICAgKiBhbmQgaXMgZnVsbHkgbG9hZGVkLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gcG9zdExvYWQoU3RyaW5nIGZnTmFtZSwgRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9\nIF9tZXRhLmdldEZldGNoR3JvdXAoZmdOYW1lKTsKICAgICAgICBpZiAoZmcg\nPT0gbnVsbCB8fCAhZmcuaXNQb3N0TG9hZCgpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21l\ndGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBm\nbWRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0\nKGkpICYmIGZtZHNbaV0uaXNJbkZldGNoR3JvdXAoZmdOYW1lKSkKICAgICAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfTE9BREVEOwogICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50\nKGdldE1hbmFnZWRJbnN0YW5jZSgpLCBmZXRjaCwgX21ldGEsIAogICAgICAg\nIAlMaWZlY3ljbGVFdmVudC5BRlRFUl9MT0FEKTsKICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIG91ciB2\nZXJzaW9uIG9iamVjdCB3aXRoIHRoZSBkYXRhc3RvcmUuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiBzeW5jVmVyc2lvbihPYmplY3Qgc2RhdGEpIHsK\nICAgICAgICByZXR1cm4gX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5zeW5j\nVmVyc2lvbih0aGlzLCBzZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSBuZWVkcyBhIHZlcnNpb24g\nY2hlY2suCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVmVyc2lvbkNo\nZWNrUmVxdWlyZWQoKSB7CiAgICAgICAgLy8gZXhwbGljaXQgZmxhZyBmb3Ig\ndmVyc2lvbiBjaGVjawogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19WRVJT\nSU9OX0NIRUNLKSAhPSAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAg\nICAgICAgaWYgKCFfYnJva2VyLmdldE9wdGltaXN0aWMoKSAmJiAhX2Jyb2tl\nci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldENvbXBhdGli\naWxpdHlJbnN0YW5jZSgpLmdldE5vbk9wdGltaXN0aWNWZXJzaW9uQ2hlY2so\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBf\nc3RhdGUuaXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCh0aGlzKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgcmVxdWly\nZXMgYSB2ZXJzaW9uIGNoZWNrIG9uIHRoZSBuZXh0IGZsdXNoLgogICAgICov\nCiAgICB2b2lkIHNldENoZWNrVmVyc2lvbihib29sZWFuIHZlcnNpb25DaGVj\naykgewogICAgICAgIGlmICh2ZXJzaW9uQ2hlY2spCiAgICAgICAgICAgIF9m\nbGFncyB8PSBGTEFHX1ZFUlNJT05fQ0hFQ0s7CiAgICAgICAgZWxzZQogICAg\nICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9DSEVDSzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGlzIGluc3RhbmNl\nIG5lZWRzIGEgdmVyc2lvbiB1cGRhdGUuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIGlzVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkgewogICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgRkxBR19WRVJTSU9OX1VQREFURSkgPiAwOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHdoZXRoZXIgdGhpcyBpbnN0YW5jZSBy\nZXF1aXJlcyBhIHZlcnNpb24gdXBkYXRlIG9uIHRoZSBuZXh0IGZsdXNoLgog\nICAgICovCiAgICB2b2lkIHNldFVwZGF0ZVZlcnNpb24oYm9vbGVhbiB2ZXJz\naW9uVXBkYXRlKSB7CiAgICAgICAgaWYgKHZlcnNpb25VcGRhdGUpCiAgICAg\nICAgICAgIF9mbGFncyB8PSBGTEFHX1ZFUlNJT05fVVBEQVRFOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05fVVBE\nQVRFOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNsYXRlIHRoZSBnaXZl\nbiBleGNlcHRpb24gYmFzZWQgb24gdGhlIGJyb2tlcidzIGltcGxpY2l0IGJl\naGF2aW9yLgogICAgICogVHJhbnNsYXRpb24gb25seSBvY2N1cnMgaWYgdGhl\nIGV4Y2VwdGlvbiBpcyBpbml0aWF0ZWQgYnkgYSB1c2VyIGFjdGlvbgogICAg\nICogb24gYW4gaW5zdGFuY2UsIGFuZCB0aGVyZWZvcmUgd2lsbCBub3QgYmUg\nY2F1Z2h0IGFuZCB0cmFuc2xhdGVkIGJ5IHRoZQogICAgICogYnJva2VyLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgUnVudGltZUV4Y2VwdGlvbiB0cmFuc2xh\ndGUoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIFJ1bnRpbWVFeGNl\ncHRpb25UcmFuc2xhdG9yIHRyYW5zID0gX2Jyb2tlci4KICAgICAgICAgICAg\nZ2V0SW5zdGFuY2VFeGNlcHRpb25UcmFuc2xhdG9yKCk7CiAgICAgICAgcmV0\ndXJuICh0cmFucyA9PSBudWxsKSA/IHJlIDogdHJhbnMudHJhbnNsYXRlKHJl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvY2sgdGhlIHN0YXRlIG1hbmFn\nZXIgaWYgdGhlIG11bHRpdGhyZWFkZWQgb3B0aW9uIGlzIHNldC4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgbG9jaygpIHsKICAgICAgICAvLyB1c2Ug\nYnJva2VyLWxldmVsIGxvY2sgdG8gYXZvaWQgZGVhZGxvY2sgc2l0dWF0aW9u\ncyB3aXRoIHRoZSBzdGF0ZQogICAgICAgIC8vIG1hbmFnZXIgbG9jayBhbmQg\nYnJva2VyIGxvY2sgYmVpbmcgb2J0YWluZWQgaW4gZGlmZmVyZW50IG9yZGVy\ncwogICAgICAgIF9icm9rZXIubG9jaygpOwogICAgfQoKICAgIC8qKgogICAg\nICogVW5sb2NrIHRoZSBzdGF0ZSBtYW5hZ2VyLgogICAgICovCglwcm90ZWN0\nZWQgdm9pZCB1bmxvY2sgKCkKCXsKCQkvLyB1c2UgYnJva2VyLWxldmVsIGxv\nY2sgdG8gYXZvaWQgZGVhZGxvY2sgc2l0dWF0aW9ucyB3aXRoIHRoZSBzdGF0\nZSAKCQkvLyBtYW5hZ2VyIGxvY2sgYW5kIGJyb2tlciBsb2NrIGJlaW5nIG9i\ndGFpbmVkIGluIGRpZmZlcmVudCBvcmRlcnMKCQlfYnJva2VyLnVubG9jayAo\nKTsKCX0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVPYmplY3QoT2JqZWN0T3V0\ncHV0U3RyZWFtIG9vcykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBv\nb3Mud3JpdGVPYmplY3QoX2Jyb2tlcik7CiAgICAgICAgb29zLmRlZmF1bHRX\ncml0ZU9iamVjdCgpOwogICAgICAgIG9vcy53cml0ZU9iamVjdChfbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgIHdyaXRlUEMob29zLCBfcGMp\nOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgPGNvZGU+cGM8L2NvZGU+\nIHRvIDxjb2RlPm9vczwvY29kZT4sIGhhbmRsaW5nIGludGVybmFsLWZvcm0K\nICAgICAqIHNlcmlhbGl6YXRpb24uIDxjb2RlPnBjPC9jb2RlPiBtdXN0IGJl\nIG9mIHRoZSBzYW1lIHR5cGUgdGhhdCB0aGlzCiAgICAgKiBzdGF0ZSBtYW5h\nZ2VyIG1hbmFnZXMuCiAgICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAg\nKi8KICAgIHZvaWQgd3JpdGVQQyhPYmplY3RPdXRwdXRTdHJlYW0gb29zLCBQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoIVNlcmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2ln\nbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBOb3RTZXJpYWxpemFibGVFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgp\nKTsKCiAgICAgICAgb29zLndyaXRlT2JqZWN0KHBjKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgcmVhZE9iamVjdChPYmplY3RJbnB1dFN0cmVhbSBpbikK\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIENsYXNzTm90Rm91bmRFeGNl\ncHRpb24gewogICAgICAgIF9icm9rZXIgPSAoQnJva2VySW1wbCkgaW4ucmVh\nZE9iamVjdCgpOwogICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7Cgog\nICAgICAgIC8vIHdlIG5lZWQgdG8gc3RvcmUgdGhlIGNsYXNzIGJlZm9yZSB0\naGUgcGMgaW5zdGFuY2Ugc28gdGhhdCB3ZSBjYW4KICAgICAgICAvLyBjcmVh\ndGUgX21ldGEgYmVmb3JlIGNhbGxpbmcgcmVhZFBDKCksIHdoaWNoIHJlbGll\ncyBvbiBfbWV0YSBiZWluZwogICAgICAgIC8vIG5vbi1udWxsIHdoZW4gcmVj\nb25zdGl0dXRpbmcgUmVmbGVjdGluZ1BDIGluc3RhbmNlcy4gU2FkbHksIHRo\naXMKICAgICAgICAvLyBwZW5hbGl6ZXMgdGhlIHNlcmlhbGl6YXRpb24gZm9v\ndHByaW50IG9mIG5vbi1SZWZsZWN0aW5nUEMgU01zIGFsc28uCiAgICAgICAg\nQ2xhc3MgbWFuYWdlZFR5cGUgPSAoQ2xhc3MpIGluLnJlYWRPYmplY3QoKTsK\nICAgICAgICBfbWV0YSA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkKICAgICAgICAgICAgLmdl\ndE1ldGFEYXRhKG1hbmFnZWRUeXBlLCBudWxsLCB0cnVlKTsKCiAgICAgICAg\nX3BjID0gcmVhZFBDKGluKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnRzIHRoZSBkZXNlcmlhbGl6ZWQgPGNvZGU+bzwvY29kZT4gdG8gYSB7QGxp\nbmsgUGVyc2lzdGVuY2VDYXBhYmxlfQogICAgICogaW5zdGFuY2UgYXBwcm9w\ncmlhdGUgZm9yIHN0b3JpbmcgaW4gPGNvZGU+X3BjPC9jb2RlPi4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgUGVyc2lzdGVuY2VD\nYXBhYmxlIHJlYWRQQyhPYmplY3RJbnB1dFN0cmVhbSBpbikKICAgICAgICB0\naHJvd3MgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewog\nICAgICAgIE9iamVjdCBvID0gaW4ucmVhZE9iamVjdCgpOwoKICAgICAgICBp\nZiAobyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjOwogICAgICAgIGlmICghKG8gaW5z\ndGFuY2VvZiBQZXJzaXN0ZW5jZUNhcGFibGUpKQogICAgICAgICAgICBwYyA9\nIEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUobywgdGhpcyk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBwYyA9IChQZXJzaXN0ZW5jZUNhcGFi\nbGUpIG87CgogICAgICAgIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcih0aGlz\nKTsKICAgICAgICByZXR1cm4gcGM7CiAgICB9Cn0K\n","encoding":"base64"}

