{"sha":"f3a415093b90dc38f3cd2bc67d550b34115f3d03","node_id":"MDQ6QmxvYjIwNjM2NDpmM2E0MTUwOTNiOTBkYzM4ZjNjZDJiYzY3ZDU1MGIzNDExNWYzZDAz","size":80409,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f3a415093b90dc38f3cd2bc67d550b34115f3d03","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLkZpbGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5GaWVsZDsKaW1w\nb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubGFu\nZy5yZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKCmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5jb25mLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmRhdGFjYWNoZS5EYXRhQ2FjaGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ1JlZ2lzdHJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUmVmbGVjdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJs\nZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5WYWx1ZUxpc3Rl\nbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5tZXRhLlNvdXJjZVRyYWNr\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1By\naXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi54bWwu\nQ29tbWVudGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdEZWNpbWFsSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\naWdJbnRlZ2VySWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5C\neXRlSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DaGFySWQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5EYXRlSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Eb3VibGVJZDsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50SWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkxvbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0SWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PcGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5TaG9ydElkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuU3RyaW5nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5n\nczsKCi8qKgogKiBDb250YWlucyBtZXRhZGF0YSBhYm91dCBhIHBlcnNpc3Rl\nbnQgdHlwZS4KICogVGhpcyBtZXRhZGF0YSBpcyBhdmFpbGFibGUgYm90aCBh\ndCBlbmhhbmNlbWVudCB0aW1lIGFuZCBydW50aW1lLgogKiAgTm90ZSB0aGF0\nIHRoaXMgY2xhc3MgZW1wbG95cyBhZ2dyZXNzaXZlIGNhY2hpbmcsIGFuZCB0\naGVyZWZvcmUgaXQgaXMKICogaW1wb3J0YW50IHRvIGZpbmFsaXplIHRoZSBj\nb25maWd1cmF0aW9uIG9mIGZpZWxkIG1ldGFkYXRhcyBiZWZvcmUgaW52b2tp\nbmcKICogbWV0aG9kcyB0aGF0IGRlcGVuZCBvbiB0aGF0IGNvbmZpZ3VyYXRp\nb24sIHN1Y2ggYXMKICoge0BsaW5rICNnZXRQcmltYXJ5S2V5RmllbGRzfS4K\nICoKICogQGF1dGhvciBBYmUgV2hpdGUKICovCnB1YmxpYyBjbGFzcyBDbGFz\nc01ldGFEYXRhCiAgICBleHRlbmRzIEV4dGVuc2lvbnMKICAgIGltcGxlbWVu\ndHMgQ29tcGFyYWJsZSwgU291cmNlVHJhY2tlciwgTWV0YURhdGFDb250ZXh0\nLCBNZXRhRGF0YU1vZGVzLAogICAgQ29tbWVudGFibGUsIFZhbHVlTGlzdGVu\nZXIgewoKICAgIC8qKgogICAgICogVW5rb253biBpZGVudGl0eSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9VTktOT1dO\nID0gMDsKCiAgICAvKioKICAgICAqIERhdGFzdG9yZSBpZGVudGl0eSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJRF9EQVRB\nU1RPUkUgPSAxOwoKICAgIC8qKgogICAgICogQXBwbGljYXRpb24gaWRlbnRp\ndHkgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nSURfQVBQTElDQVRJT04gPSAyOwoKICAgIC8qKgogICAgICogVW5rbm93biBh\nY2Nlc3MgdHlwZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQUNDRVNTX1VOS05PV04gPSAwOwoKICAgIC8qKgogICAgICogUGVyc2lz\ndGVudCBhdHRyaWJ1dGVzIGFyZSBhY2Nlc3NlZCB2aWEgZGlyZWN0IGZpZWxk\nIGFjY2Vzcy4gQml0IGZsYWcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IEFDQ0VTU19GSUVMRCA9IDIgPDwgMDsKCiAgICAvKioKICAg\nICAqIFBlcnNpc3RlbnQgYXR0cmlidXRlcyBhcmUgYWNjZXNzZWQgdmlhIHNl\ndHRlcnMgYW5kIGdldHRlcnMuIEJpdCBmbGFnLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBBQ0NFU1NfUFJPUEVSVFkgPSAyIDw8IDE7\nCgogICAgLyoqCiAgICAgKiBWYWx1ZSBmb3IgdXNpbmcgYSBzeW50aGV0aWMg\nZGV0YWNoZWQgc3RhdGUgZmllbGQsIHdoaWNoIGlzIHRoZSBkZWZhdWx0Lgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTWU5USEVU\nSUMgPSAiYHN5biI7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgREVGQVVMVF9TVFJJTkcgPSAiYCI7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChDbGFzc01ldGFEYXRhLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBGZXRjaEdyb3VwW10gRU1QVFlfRkVUQ0hfR1JPVVBfQVJS\nQVkKICAgICAgICA9IG5ldyBGZXRjaEdyb3VwWzBdOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgU3RyaW5nW10gRU1QVFlfU1RSSU5HX0FSUkFZID0gbmV3\nIFN0cmluZ1swXTsKCiAgICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBf\ncmVwb3M7CiAgICBwcml2YXRlIHRyYW5zaWVudCBDbGFzc0xvYWRlciBfbG9h\nZGVyID0gbnVsbDsKCiAgICBwcml2YXRlIGZpbmFsIFZhbHVlTWV0YURhdGEg\nX293bmVyOwogICAgcHJpdmF0ZSBmaW5hbCBMaWZlY3ljbGVNZXRhRGF0YSBf\nbGlmZU1ldGEgPSBuZXcgTGlmZWN5Y2xlTWV0YURhdGEodGhpcyk7CiAgICBw\ncml2YXRlIEZpbGUgX3NyY0ZpbGUgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQg\nX3NyY1R5cGUgPSBTUkNfT1RIRVI7CiAgICBwcml2YXRlIGludCBfbGluZU51\nbSA9IDA7ICAKICAgIHByaXZhdGUgaW50IF9jb2xOdW0gPSAwOyAgCiAgICBw\ncml2YXRlIFN0cmluZ1tdIF9jb21tZW50cyA9IG51bGw7CiAgICBwcml2YXRl\nIGludCBfbGlzdEluZGV4ID0gLTE7CiAgICBwcml2YXRlIGludCBfc3JjTW9k\nZSA9IE1PREVfTUVUQSB8IE1PREVfTUFQUElORzsKICAgIHByaXZhdGUgaW50\nIF9yZXNNb2RlID0gTU9ERV9OT05FOwoKICAgIHByaXZhdGUgQ2xhc3MgX3R5\ncGUgPSBPYmplY3QuY2xhc3M7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBfZmll\nbGRNYXAgPSBuZXcgVHJlZU1hcCgpOwogICAgcHJpdmF0ZSBNYXAgX3N1cEZp\nZWxkTWFwID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfZGVmU3VwRmll\nbGRzID0gZmFsc2U7CiAgICBwcml2YXRlIENvbGxlY3Rpb24gX3N0YXRpY0Zp\nZWxkcyA9IG51bGw7CiAgICBwcml2YXRlIGludFtdIF9maWVsZERhdGFUYWJs\nZSA9IG51bGw7CiAgICBwcml2YXRlIE1hcCBfZmdNYXAgPSBudWxsOwoKICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBOb3RlOiBpZiB5b3Ug\nYWRkIGFkZGl0aW9uYWwgc3RhdGUsIG1ha2Ugc3VyZSB0byBhZGQgaXQgdG8g\nY29weSgpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHByaXZh\ndGUgQ2xhc3MgX29iamVjdElkID0gbnVsbDsKICAgIHByaXZhdGUgQm9vbGVh\nbiBfb2JqZWN0SWRTaGFyZWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFu\nIF9vcGVuanBhSWQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9leHRl\nbnQgPSBudWxsOwogICAgcHJpdmF0ZSBCb29sZWFuIF9lbWJlZGRlZCA9IG51\nbGw7CiAgICBwcml2YXRlIEJvb2xlYW4gX2ludGVyZmFjZSA9IG51bGw7CiAg\nICBwcml2YXRlIENsYXNzIF9pbXBsID0gbnVsbDsKICAgIHByaXZhdGUgTGlz\ndCBfaW50ZXJmYWNlcyA9IG51bGw7CiAgICBwcml2YXRlIGZpbmFsIE1hcCBf\naWZhY2VNYXAgPSBuZXcgSGFzaE1hcCgpOwogICAgcHJpdmF0ZSBpbnQgX2lk\nZW50aXR5ID0gSURfVU5LTk9XTjsKICAgIHByaXZhdGUgaW50IF9pZFN0cmF0\nZWd5ID0gVmFsdWVTdHJhdGVnaWVzLk5PTkU7CiAgICBwcml2YXRlIGludCBf\nYWNjZXNzVHlwZSA9IEFDQ0VTU19VTktOT1dOOwoKICAgIHByaXZhdGUgU3Ry\naW5nIF9zZXFOYW1lID0gREVGQVVMVF9TVFJJTkc7CiAgICBwcml2YXRlIFNl\ncXVlbmNlTWV0YURhdGEgX3NlcU1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBT\ndHJpbmcgX2NhY2hlTmFtZSA9IERFRkFVTFRfU1RSSU5HOwogICAgcHJpdmF0\nZSBpbnQgX2NhY2hlVGltZW91dCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAg\ncHJpdmF0ZSBCb29sZWFuIF9kZXRhY2hhYmxlID0gbnVsbDsKICAgIHByaXZh\ndGUgU3RyaW5nIF9kZXRhY2hTdGF0ZSA9IERFRkFVTFRfU1RSSU5HOwogICAg\ncHJpdmF0ZSBTdHJpbmcgX2FsaWFzID0gbnVsbDsKICAgIHByaXZhdGUgaW50\nIF92ZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5fVkFMVUU7CgogICAgcHJpdmF0\nZSBDbGFzcyBfc3VwZXIgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc01ldGFE\nYXRhIF9zdXBlck1ldGEgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzc1tdIF9z\ndWJzID0gbnVsbDsKICAgIHByaXZhdGUgQ2xhc3NNZXRhRGF0YVtdIF9zdWJN\nZXRhcyA9IG51bGw7CiAgICBwcml2YXRlIENsYXNzTWV0YURhdGFbXSBfbWFw\nU3ViTWV0YXMgPSBudWxsOwoKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0YVtd\nIF9maWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10g\nX3VubWdkRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRNZXRhRGF0\nYVtdIF9hbGxGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBGaWVsZE1ldGFE\nYXRhW10gX2FsbFBLRmllbGRzID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRN\nZXRhRGF0YVtdIF9hbGxERkdGaWVsZHMgPSBudWxsOwogICAgcHJpdmF0ZSBG\naWVsZE1ldGFEYXRhW10gX2RlZmluZWRGaWVsZHMgPSBudWxsOwogICAgcHJp\ndmF0ZSBGaWVsZE1ldGFEYXRhW10gX2xpc3RpbmdGaWVsZHMgPSBudWxsOwog\nICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhW10gX2FsbExpc3RpbmdGaWVsZHMg\nPSBudWxsOwogICAgcHJpdmF0ZSBGZXRjaEdyb3VwW10gX2ZncyA9IG51bGw7\nCiAgICBwcml2YXRlIEZldGNoR3JvdXBbXSBfY3VzdG9tRkdzID0gbnVsbDsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfaW50ZXJjZXB0aW5nID0gZmFsc2U7Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGRlc2NyaWJlZCB0\neXBlIGFuZCByZXBvc2l0b3J5LgogICAgICovCiAgICBwcm90ZWN0ZWQgQ2xh\nc3NNZXRhRGF0YShDbGFzcyB0eXBlLCBNZXRhRGF0YVJlcG9zaXRvcnkgcmVw\nb3MpIHsKICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgICAgICBfb3duZXIg\nPSBudWxsOwogICAgICAgIHNldERlc2NyaWJlZFR5cGUodHlwZSk7CiAgICAg\nICAgcmVnaXN0ZXJGb3JWYWx1ZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIp\nOwogICAgfQoKICAgIC8qKgogICAgICogRW1iZWRkZWQgY29uc3RydWN0b3Iu\nIFN1cHBseSBlbWJlZGRpbmcgdmFsdWUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBDbGFzc01ldGFEYXRhKFZhbHVlTWV0YURhdGEgb3duZXIpIHsKICAgICAg\nICBfb3duZXIgPSBvd25lcjsKICAgICAgICBfcmVwb3MgPSBvd25lci5nZXRS\nZXBvc2l0b3J5KCk7CiAgICAgICAgc2V0RW52Q2xhc3NMb2FkZXIob3duZXIu\nZ2V0RmllbGRNZXRhRGF0YSgpLmdldERlZmluaW5nTWV0YURhdGEoKS4KICAg\nICAgICAgICAgZ2V0RW52Q2xhc3NMb2FkZXIoKSk7CiAgICAgICAgcmVnaXN0\nZXJGb3JWYWx1ZVVwZGF0ZSgiRGF0YUNhY2hlVGltZW91dCIpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBvd25pbmcgcmVwb3NpdG9yeS4K\nICAgICAqLwogICAgcHVibGljIE1ldGFEYXRhUmVwb3NpdG9yeSBnZXRSZXBv\nc2l0b3J5KCkgewogICAgICAgIHJldHVybiBfcmVwb3M7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBJZiB0aGlzIG1ldGFkYXRhIGlzIGZvciBhbiBlbWJlZGRl\nZCBvYmplY3QsIHJldHVybmluZyB0aGUgb3duaW5nIHZhbHVlLgogICAgICov\nCiAgICBwdWJsaWMgVmFsdWVNZXRhRGF0YSBnZXRFbWJlZGRpbmdNZXRhRGF0\nYSgpIHsKICAgICAgICByZXR1cm4gX293bmVyOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhlIHBlcnNpc3RlbmNlIGNhcGFibGUgY2xhc3MgZGVzY3JpYmVk\nIGJ5IHRoaXMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzcyBn\nZXREZXNjcmliZWRUeXBlKCkgewogICAgICAgIHJldHVybiBfdHlwZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY2xhc3MgZGVzY2liZWQgYnkg\ndGhpcyBtZXRhZGF0YS4gVGhlIHR5cGUgbWF5IGJlIHJlc2V0IHdoZW4KICAg\nICAqIGFuIGVtYmVkZGVkIHZhbHVlIGNoYW5nZXMgaXRzIGRlY2xhcmVkIHR5\ncGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldERlc2NyaWJlZFR5\ncGUoQ2xhc3MgdHlwZSkgewogICAgICAgIGlmICh0eXBlLmdldFN1cGVyY2xh\nc3MoKSAhPSBudWxsICYmICJqYXZhLmxhbmcuRW51bSIuZXF1YWxzCiAgICAg\nICAgICAgICh0eXBlLmdldFN1cGVyY2xhc3MoKS5nZXROYW1lKCkpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImVudW0iLCB0eXBlKSk7CiAgICAgICAgX3R5cGUgPSB0eXBlOwogICAgICAg\nIGlmIChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJv\nbSh0eXBlKSkKICAgICAgICAgICAgc2V0SW50ZXJjZXB0aW5nKHRydWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGhlIGVudmlyb25tZW50YWwgbG9hZGVy\nIHVzZWQgd2hlbiBsb2FkaW5nIHRoaXMgbWV0YWRhdGEuCiAgICAgKiBUaGUg\nY2xhc3MgbWV0YWRhdGEgc2hvdWxkIHVzZSB0aGlzIGxvYWRlciB3aGVuIGxv\nYWRpbmcgbWV0YWRhdGEgZm9yCiAgICAgKiBpdHMgc3VwZXJjbGFzcyBhbmQg\nZmllbGQgdHlwZXMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc0xvYWRlciBn\nZXRFbnZDbGFzc0xvYWRlcigpIHsKICAgICAgICByZXR1cm4gX2xvYWRlcjsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBjbGFzcyBlbnZpcm9ubWVudGFs\nIGxvYWRlciB1c2VkIHdoZW4gbG9hZGluZyB0aGlzIG1ldGFkYXRhLgogICAg\nICogVGhlIGNsYXNzIG1ldGFkYXRhIHNob3VsZCB1c2UgdGhpcyBsb2FkZXIg\nd2hlbiBsb2FkaW5nIG1ldGFkYXRhIGZvcgogICAgICogaXRzIHN1cGVyY2xh\nc3MgYW5kIGZpZWxkIHR5cGVzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRFbnZDbGFzc0xvYWRlcihDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAg\nICBfbG9hZGVyID0gbG9hZGVyOwogICAgfQoKICAgIC8qKgogICAgICogVGhl\nIHBlcnNpc3RlbmNlIGNhcGFibGUgc3VwZXJjbGFzcyBvZiB0aGUgZGVzY3Jp\nYmVkIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzcyBnZXRQQ1N1cGVy\nY2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIF9zdXBlcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBwZXJzaXN0ZW5jZSBjYXBhYmxlIHN1cGVyY2xhc3Mg\nb2YgdGhlIGRlc2NyaWJlZCB0eXBlLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRQQ1N1cGVyY2xhc3MoQ2xhc3MgcGMpIHsKICAgICAgICBjbGVhckFs\nbEZpZWxkQ2FjaGUoKTsKICAgICAgICBfc3VwZXIgPSBwYzsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBtZXRhZGF0YSBmb3IgdGhpcyBjbGFzcycgc3Vw\nZXJjbGFzcy4KICAgICAqLwogICAgcHVibGljIENsYXNzTWV0YURhdGEgZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKSB7CiAgICAgICAgaWYgKF9zdXBlck1l\ndGEgPT0gbnVsbCAmJiBfc3VwZXIgIT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoX293bmVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIF9zdXBlck1l\ndGEgPSBfcmVwb3MubmV3RW1iZWRkZWRDbGFzc01ldGFEYXRhKF9vd25lcik7\nCiAgICAgICAgICAgICAgICBfc3VwZXJNZXRhLnNldERlc2NyaWJlZFR5cGUo\nX3N1cGVyKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBf\nc3VwZXJNZXRhID0gX3JlcG9zLmdldE1ldGFEYXRhKF9zdXBlciwgX2xvYWRl\nciwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfc3VwZXJNZXRh\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1ldGFkYXRhIGZvciB0aGlz\nIGNsYXNzJyBzdXBlcmNsYXNzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YShDbGFzc01ldGFEYXRhIG1ldGEpIHsK\nICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBfc3VwZXJN\nZXRhID0gbWV0YTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAg\nICAgICBzZXRQQ1N1cGVyY2xhc3MobWV0YS5nZXREZXNjcmliZWRUeXBlKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIGNsYXNzIGlz\nIG1hcHBlZCB0byB0aGUgZGF0YXN0b3JlLiBCeSBkZWZhdWx0LCBvbmx5CiAg\nICAgKiByZXR1cm5zIGZhbHNlIGlmIGNsYXNzIGlzIGVtYmVkZGVkLW9ubHks\nIGJ1dCBzdWJjbGFzc2VzIG1pZ2h0IG92ZXJyaWRlCiAgICAgKiB0byBhbGxv\ndyB1bm1hcHBlZCBvdGhlciB0eXBlcy4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gaXNNYXBwZWQoKSB7CiAgICAgICAgcmV0dXJuIF9lbWJlZGRlZCAh\nPSBCb29sZWFuLlRSVUU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIGNsb3Nlc3QgbWFwcGVkIHN1cGVyY2xhc3MuCiAgICAgKi8KICAgIHB1\nYmxpYyBDbGFzc01ldGFEYXRhIGdldE1hcHBlZFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCkgewogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoc3VwID09IG51bGwgfHwg\nc3VwLmlzTWFwcGVkKCkpCiAgICAgICAgICAgIHJldHVybiBzdXA7CiAgICAg\nICAgcmV0dXJuIHN1cC5nZXRNYXBwZWRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBrbm93biBwZXJz\naXN0ZW5jZSBjYXBhYmxlIHN1YmNsYXNzZXMgb2YgdGhlIGRlc2NyaWJlZCB0\neXBlLAogICAgICogb3IgZW1wdHkgYXJyYXkgaWYgbm9uZSBvciBpZiB0aGlz\nIGlzIGVtYmVkZGVkIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgQ2xh\nc3NbXSBnZXRQQ1N1YmNsYXNzZXMoKSB7CiAgICAgICAgaWYgKF9vd25lciAh\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3JlcG9zLkVNUFRZX0NMQVNT\nRVM7CgogICAgICAgIF9yZXBvcy5wcm9jZXNzUmVnaXN0ZXJlZENsYXNzZXMo\nX2xvYWRlcik7CiAgICAgICAgaWYgKF9zdWJzID09IG51bGwpIHsKICAgICAg\nICAgICAgQ29sbGVjdGlvbiBzdWJzID0gX3JlcG9zLmdldFBDU3ViY2xhc3Nl\ncyhfdHlwZSk7CiAgICAgICAgICAgIF9zdWJzID0gKENsYXNzW10pIHN1YnMu\ndG9BcnJheShuZXcgQ2xhc3Nbc3Vicy5zaXplKCldKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIF9zdWJzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGtub3duIHBlcnNpc3RlbmNlIGNh\ncGFibGUgc3ViY2xhc3NlcyBvZgogICAgICogdGhlIGRlc2NyaWJlZCB0eXBl\nLCBvciBlbXB0eSBhcnJheSBpZiBub25lIG9yIGlmIHRoaXMgaXMgZW1iZWRk\nZWQKICAgICAqIG1ldGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgQ2xhc3NN\nZXRhRGF0YVtdIGdldFBDU3ViY2xhc3NNZXRhRGF0YXMoKSB7CiAgICAgICAg\naWYgKF9vd25lciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3JlcG9z\nLkVNUFRZX01FVEFTOwoKICAgICAgICBDbGFzc1tdIHN1YnMgPSBnZXRQQ1N1\nYmNsYXNzZXMoKTsgLy8gY2hlY2tzIGZvciBuZXcKICAgICAgICBpZiAoX3N1\nYk1ldGFzID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKHN1YnMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgICAgICBfc3ViTWV0YXMgPSBfcmVwb3MuRU1Q\nVFlfTUVUQVM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\nQ2xhc3NNZXRhRGF0YVtdIG1ldGFzID0gX3JlcG9zLm5ld0NsYXNzTWV0YURh\ndGFBcnJheQogICAgICAgICAgICAgICAgICAgIChzdWJzLmxlbmd0aCk7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1YnMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICAgICAgbWV0YXNbaV0gPSBfcmVwb3Mu\nZ2V0TWV0YURhdGEoc3Vic1tpXSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICBfc3ViTWV0YXMgPSBtZXRhczsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX3N1Yk1ldGFzOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGFsbCBtYXBwZWQgc3ViY2xhc3Nlcy4KICAgICAq\nLwogICAgcHVibGljIENsYXNzTWV0YURhdGFbXSBnZXRNYXBwZWRQQ1N1YmNs\nYXNzTWV0YURhdGFzKCkgewogICAgICAgIGlmIChfb3duZXIgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIF9yZXBvcy5FTVBUWV9NRVRBUzsKCiAgICAg\nICAgQ2xhc3NNZXRhRGF0YVtdIHN1YnMgPSBnZXRQQ1N1YmNsYXNzTWV0YURh\ndGFzKCk7IC8vIGNoZWNrcyBmb3IgbmV3CiAgICAgICAgaWYgKF9tYXBTdWJN\nZXRhcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChzdWJzLmxlbmd0aCA9\nPSAwKQogICAgICAgICAgICAgICAgX21hcFN1Yk1ldGFzID0gc3ViczsKICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBMaXN0IG1hcHBlZCA9\nIG5ldyBBcnJheUxpc3Qoc3Vicy5sZW5ndGgpOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBzdWJzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICAgICAgIGlmIChzdWJzW2ldLmlzTWFwcGVkKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIG1hcHBlZC5hZGQoc3Vic1tpXSk7CiAgICAgICAg\nICAgICAgICBfbWFwU3ViTWV0YXMgPSAoQ2xhc3NNZXRhRGF0YVtdKSBtYXBw\nZWQudG9BcnJheQogICAgICAgICAgICAgICAgICAgIChfcmVwb3MubmV3Q2xh\nc3NNZXRhRGF0YUFycmF5KG1hcHBlZC5zaXplKCkpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX21hcFN1Yk1ldGFzOwogICAg\nfQoKICAgIC8qKgogICAgICogVGhlIHR5cGUgb2YgaWRlbnRpdHkgYmVpbmcg\ndXNlZC4gVGhpcyB3aWxsIGJlIG9uZSBvZjoKICAgICAqIDx1bD4KICAgICAq\nIDxsaT57QGxpbmsgI0lEX1VOS05PV059OiB1bmtub3duIGlkZW50aXR5IHR5\ncGU8L2xpPgogICAgICogPGxpPntAbGluayAjSURfREFUQVNUT1JFfTogaWRl\nbnRpdHkgbWFuYWdlZCBieSB0aGUgZGF0YSBzdG9yZSBhbmQKICAgICAqIGlu\nZGVwZW5kZW50CW9mIHRoZSBmaWVsZHMgb2YgdGhlIGluc3RhbmNlPC9saT4K\nICAgICAqIDxsaT57QGxpbmsgI0lEX0FQUExJQ0FUSU9OfTogaWRlbnRpdHkg\nbWFuYWdlZCBieSB0aGUgYXBwbGljYXRpb24gYW5kCiAgICAgKiBkZWZpbmVk\nIGJ5IG9uZSBvciBtb3JlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgog\nICAgICogPC91bD4gSWYgdW5zcGVjaWZpZWQsIGRlZmF1bHRzIHRvIHtAbGlu\nayAjSURfREFUQVNUT1JFfSBpZiB0aGVyZSBhcmUgbm8KICAgICAqIHByaW1h\ncnkga2V5IGZpZWxkcywgYW5kIHtAbGluayAjSURfQVBQTElDQVRJT059IG90\naGVyd2lzZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRJZGVudGl0eVR5\ncGUoKSB7CiAgICAgICAgaWYgKF9pZGVudGl0eSA9PSBJRF9VTktOT1dOKSB7\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNs\nYXNzTWV0YURhdGEoKTsKICAgICAgICAgICAgaWYgKHN1cCAhPSBudWxsICYm\nIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dOKQogICAgICAg\nICAgICAgICAgX2lkZW50aXR5ID0gc3VwLmdldElkZW50aXR5VHlwZSgpOwog\nICAgICAgICAgICBlbHNlIGlmIChnZXRQcmltYXJ5S2V5RmllbGRzKCkubGVu\nZ3RoID4gMCkKICAgICAgICAgICAgICAgIF9pZGVudGl0eSA9IElEX0FQUExJ\nQ0FUSU9OOwogICAgICAgICAgICBlbHNlIGlmIChpc01hcHBlZCgpKQogICAg\nICAgICAgICAgICAgX2lkZW50aXR5ID0gSURfREFUQVNUT1JFOwogICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICBfaWRlbnRpdHkgPSBfcmVwb3Mu\nZ2V0TWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS4KICAgICAgICAg\nICAgICAgICAgICBnZXREZWZhdWx0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBfaWRlbnRpdHk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgdHlwZSBvZiBpZGVudGl0eSBiZWluZyB1c2VkLiBUaGlzIHdp\nbGwgYmUgb25lIG9mOgogICAgICogPHVsPgogICAgICogPGxpPntAbGluayAj\nSURfVU5LTk9XTn06IHVua25vd24gaWRlbnRpdHkgdHlwZTwvbGk+CiAgICAg\nKiA8bGk+e0BsaW5rICNJRF9EQVRBU1RPUkV9OiBpZGVudGl0eSBtYW5hZ2Vk\nIGJ5IHRoZSBkYXRhIHN0b3JlIGFuZAogICAgICogaW5kZXBlbmRlbnQJb2Yg\ndGhlIGZpZWxkcyBvZiB0aGUgaW5zdGFuY2U8L2xpPgogICAgICogPGxpPntA\nbGluayAjSURfQVBQTElDQVRJT059OiBpZGVudGl0eSBtYW5hZ2VkIGJ5IHRo\nZSBhcHBsaWNhdGlvbiBhbmQKICAgICAqIGRlZmluZWQgYnkgb25lIG9yIG1v\ncmUgZmllbGRzIG9mIHRoZSBpbnN0YW5jZTwvbGk+CiAgICAgKiA8L3VsPiBJ\nZiB1bnNwZWNpZmllZCwgZGVmYXVsdHMgdG8ge0BsaW5rICNJRF9EQVRBU1RP\nUkV9IGlmIHRoZXJlIGFyZSBubwogICAgICogcHJpbWFyeSBrZXkgZmllbGRz\nLCBhbmQge0BsaW5rICNJRF9BUFBMSUNBVElPTn0gb3RoZXJ3aXNlLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRJZGVudGl0eVR5cGUoaW50IHR5cGUp\nIHsKICAgICAgICBfaWRlbnRpdHkgPSB0eXBlOwogICAgICAgIGlmICh0eXBl\nICE9IElEX0FQUExJQ0FUSU9OKSB7CiAgICAgICAgICAgIF9vYmplY3RJZCA9\nIG51bGw7CiAgICAgICAgICAgIF9vcGVuanBhSWQgPSBudWxsOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YS1zcGVjaWZp\nZWQgY2xhc3MgdG8gdXNlIGZvciB0aGUgb2JqZWN0IElELgogICAgICovCiAg\nICBwdWJsaWMgQ2xhc3MgZ2V0T2JqZWN0SWRUeXBlKCkgewogICAgICAgIGlm\nIChfb2JqZWN0SWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9vYmpl\nY3RJZDsKICAgICAgICBpZiAoZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfQVBQ\nTElDQVRJT04pCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIENs\nYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsK\nICAgICAgICBpZiAoc3VwICE9IG51bGwgJiYgc3VwLmdldElkZW50aXR5VHlw\nZSgpICE9IElEX1VOS05PV04pIHsKICAgICAgICAgICAgX29iamVjdElkID0g\nc3VwLmdldE9iamVjdElkVHlwZSgpOwogICAgICAgICAgICByZXR1cm4gX29i\namVjdElkOwogICAgICAgIH0KCiAgICAgICAgLy8gZmlndXJlIG91dCBvcGVu\nanBhIGlkZW50aXR5IHR5cGUgYmFzZWQgb24gcHJpbWFyeSBrZXkgZmllbGQK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gZ2V0UHJpbWFyeUtleUZp\nZWxkcygpOwogICAgICAgIGlmIChwa3MubGVuZ3RoICE9IDEpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIHN3aXRjaCAocGtzWzBdLmdldE9i\namVjdElkRmllbGRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVf\nT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gQnl0ZUlkLmNsYXNz\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJf\nT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gQ2hhcklkLmNsYXNz\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9V\nQkxFX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IERvdWJsZUlk\nLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBGbG9h\ndElkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgIF9vYmplY3RJZCA9IEludElk\nLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkxPTkdfT0JKOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gTG9uZ0lk\nLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICBfb2JqZWN0SWQgPSBTaG9y\ndElkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIF9vYmpl\nY3RJZCA9IFN0cmluZ0lkLmNsYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAg\nICAgICBfb2JqZWN0SWQgPSBEYXRlSWQuY2xhc3M7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAg\nICBfb2JqZWN0SWQgPSBPYmplY3RJZC5jbGFzczsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFM\nOgogICAgICAgICAgICAgICAgX29iamVjdElkID0gQmlnRGVjaW1hbElkLmNs\nYXNzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBfb2JqZWN0\nSWQgPSBCaWdJbnRlZ2VySWQuY2xhc3M7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9vYmplY3RJZDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBtZXRhZGF0YS1zcGVjaWZpZWQgY2xhc3Mg\ndG8gdXNlIGZvciB0aGUgb2JqZWN0IElELgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRPYmplY3RJZFR5cGUoQ2xhc3MgY2xzLCBib29sZWFuIHNoYXJl\nZCkgewogICAgICAgIF9vYmplY3RJZCA9IG51bGw7CiAgICAgICAgX29wZW5q\ncGFJZCA9IG51bGw7CiAgICAgICAgX29iamVjdElkU2hhcmVkID0gbnVsbDsK\nICAgICAgICBpZiAoY2xzICE9IG51bGwpIHsKICAgICAgICAgICAgLy8gZG9u\nJ3QgbGV0IHBlb3BsZSBhc3NpZ24gT3BlbkpQQUlkIHR5cGVzOyBzYWZlciB0\nbyBjYWxjdWxhdGUgaXQKICAgICAgICAgICAgLy8gb3Vyc2VsdmVzCiAgICAg\nICAgICAgIHNldElkZW50aXR5VHlwZShJRF9BUFBMSUNBVElPTik7CiAgICAg\nICAgICAgIGlmICghT3BlbkpQQUlkLmNsYXNzLmlzQXNzaWduYWJsZUZyb20o\nY2xzKSkgewogICAgICAgICAgICAgICAgX29iamVjdElkID0gY2xzOwogICAg\nICAgICAgICAgICAgX29iamVjdElkU2hhcmVkID0gKHNoYXJlZCkgPyBCb29s\nZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIHR5cGUg\ndXNlcyBhbiBhcHBsaWNhdGlvbiBpZGVudGl0eSBjbGFzcyB0aGF0IGlzIHNo\nYXJlZAogICAgICogd2l0aCBvdGhlciBjbGFzc2VzLCBhbmQgaXMgdGhlcmVm\nb3JlIHdyYXBwZWQgaW4gYW4ge0BsaW5rIE9iamVjdElkfS4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNPYmplY3RJZFR5cGVTaGFyZWQoKSB7CiAg\nICAgICAgaWYgKF9vYmplY3RJZFNoYXJlZCAhPSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gX29iamVjdElkU2hhcmVkLmJvb2xlYW5WYWx1ZSgpOwogICAg\nICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNPYmplY3RJZFR5cGVTaGFyZWQo\nKTsKICAgICAgICByZXR1cm4gaXNPcGVuSlBBSWRlbnRpdHkoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyB0eXBlIHVzZXMgT3BlbkpQ\nQSBpZGVudGl0eS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNPcGVu\nSlBBSWRlbnRpdHkoKSB7CiAgICAgICAgaWYgKF9vcGVuanBhSWQgPT0gbnVs\nbCkgewogICAgICAgICAgICBDbGFzcyBjbHMgPSBnZXRPYmplY3RJZFR5cGUo\nKTsKICAgICAgICAgICAgaWYgKGNscyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBfb3BlbmpwYUlkID0gKE9w\nZW5KUEFJZC5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGNscykpID8gQm9vbGVh\nbi5UUlVFCiAgICAgICAgICAgICAgICA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBfb3BlbmpwYUlkLmJvb2xlYW5WYWx1ZSgp\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIHN0cmF0ZWd5IHRvIHVzZSBm\nb3IgZGF0YXN0b3JlIGlkZW50aXR5IGdlbmVyYXRpb24uCiAgICAgKiBPbmUg\nb2YgdGhlIGNvbnN0YW50cyBmcm9tIHtAbGluayBWYWx1ZVN0cmF0ZWdpZXN9\nLgogICAgICovCiAgICBwdWJsaWMgaW50IGdldElkZW50aXR5U3RyYXRlZ3ko\nKSB7CiAgICAgICAgaWYgKGdldElkZW50aXR5VHlwZSgpID09IElEX0RBVEFT\nVE9SRQogICAgICAgICAgICAmJiBfaWRTdHJhdGVneSA9PSBWYWx1ZVN0cmF0\nZWdpZXMuTk9ORSkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9\nIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChz\ndXAgIT0gbnVsbCAmJiBzdXAuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gSURfVU5L\nTk9XTikKICAgICAgICAgICAgICAgIF9pZFN0cmF0ZWd5ID0gc3VwLmdldElk\nZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgX2lkU3RyYXRlZ3kgPSBWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gX2lkU3RyYXRlZ3k7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUaGUgc3RyYXRlZ3kgdG8gdXNlIGZvciBkYXRhc3Rv\ncmUgaWRlbnRpdHkgZ2VuZXJhdGlvbi4KICAgICAqIE9uZSBvZiB0aGUgY29u\nc3RhbnRzIGZyb20ge0BsaW5rIFZhbHVlU3RyYXRlZ2llc30uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldElkZW50aXR5U3RyYXRlZ3koaW50IHN0cmF0\nZWd5KSB7CiAgICAgICAgX2lkU3RyYXRlZ3kgPSBzdHJhdGVneTsKICAgICAg\nICBpZiAoc3RyYXRlZ3kgIT0gVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFKQog\nICAgICAgICAgICBzZXRJZGVudGl0eVNlcXVlbmNlTmFtZShudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBkYXRhc3RvcmUgaWRlbnRpdHkgc2Vx\ndWVuY2UgbmFtZSwgb3IgbnVsbCBmb3Igbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXRJZGVudGl0eVNlcXVlbmNlTmFtZSgpIHsKICAgICAg\nICBpZiAoREVGQVVMVF9TVFJJTkcuZXF1YWxzKF9zZXFOYW1lKSkgewogICAg\nICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc2VxTmFtZSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0SWRlbnRp\ndHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgX3NlcU5hbWUgPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX3NlcU5hbWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGF0YXN0\nb3JlIGlkZW50aXR5IHNlcXVlbmNlIG5hbWUsIG9yIG51bGwgZm9yIG5vbmUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElkZW50aXR5U2VxdWVuY2VO\nYW1lKFN0cmluZyBzZXFOYW1lKSB7CiAgICAgICAgX3NlcU5hbWUgPSBzZXFO\nYW1lOwogICAgICAgIF9zZXFNZXRhID0gbnVsbDsKICAgICAgICBpZiAoc2Vx\nTmFtZSAhPSBudWxsKQogICAgICAgICAgICBzZXRJZGVudGl0eVN0cmF0ZWd5\nKFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNZXRhZGF0YSBmb3IgdGhlIGRhdGFzdG9yZSBpZGVudGl0eSBzZXF1\nZW5jZS4KICAgICAqLwogICAgcHVibGljIFNlcXVlbmNlTWV0YURhdGEgZ2V0\nSWRlbnRpdHlTZXF1ZW5jZU1ldGFEYXRhKCkgewogICAgICAgIGlmIChfc2Vx\nTWV0YSA9PSBudWxsICYmIGdldElkZW50aXR5U2VxdWVuY2VOYW1lKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgX3NlcU1ldGEgPSBfcmVwb3MuZ2V0U2VxdWVu\nY2VNZXRhRGF0YSh0aGlzLAogICAgICAgICAgICAgICAgZ2V0SWRlbnRpdHlT\nZXF1ZW5jZU5hbWUoKSwgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIF9zZXFNZXRh\nOwogICAgfQoKICAgIC8qKgogICAgICogSW5mb3JtYXRpb24gYWJvdXQgbGlm\nZWN5Y2xlIGNhbGxiYWNrcyBmb3IgdGhpcyBjbGFzcy4KICAgICAqLwogICAg\ncHVibGljIExpZmVjeWNsZU1ldGFEYXRhIGdldExpZmVjeWNsZU1ldGFEYXRh\nKCkgewogICAgICAgIHJldHVybiBfbGlmZU1ldGE7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRoZSBhbGlhcyBmb3IgdGhlIGRlc2NyaWJlZCB0\neXBlLCBvciA8Y29kZT5udWxsPC9jb2RlPiBpZiBub25lCiAgICAgKiBoYXMg\nYmVlbiBzZXQuCiAgICAgKiAKICAgICAqIEBzZWUgI3NldFR5cGVBbGlhcwog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5cGVBbGlhcygpIHsKICAg\nICAgICBpZiAoX2FsaWFzID09IG51bGwpCiAgICAgICAgICAgIF9hbGlhcyA9\nIFN0cmluZ3MuZ2V0Q2xhc3NOYW1lKF90eXBlKTsKICAgICAgICByZXR1cm4g\nX2FsaWFzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyB0aGUgYWxpYXMg\nZm9yIHRoZSBkZXNjcmliZWQgdHlwZS4gVGhlIGFsaWFzIGNhbiBiZQogICAg\nICogYW55IGFyYml0cmFyeSBzdHJpbmcgdGhhdCB0aGUgaW1wbGVtZW50YXRp\nb24gY2FuIGxhdGVyIHVzZSB0bwogICAgICogcmVmZXIgdG8gdGhlIGNsYXNz\nLiBOb3RlIHRoYXQgYXQgcnVudGltZSwgb25seSB0aGUgYWxpYXMKICAgICAq\nIGNvbXB1dGVkIHdoZW4gdGhlIHBlcnNpc3RlbnQgdHlwZSB3YXMgZW5oYW5j\nZWQgaXMgdXNlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gYWxpYXMgdGhlIGFs\naWFzIG5hbWUgdG8gYXBwbHkgdG8gdGhlIGRlc2NyaWJlZCB0eXBlCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldFR5cGVBbGlhcyhTdHJpbmcgYWxpYXMp\nIHsKICAgICAgICBfYWxpYXMgPSBhbGlhczsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBhY2Nlc3MgdHlwZSB1c2VkIGJ5IHRoaXMgY2xhc3MuIEVpdGhl\nciB7QGxpbmsgI0FDQ0VTU19GSUVMRH0KICAgICAqIG9yIHtAbGluayAjQUND\nRVNTX1BST1BFUlRZfS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRBY2Nl\nc3NUeXBlKCkgewogICAgICAgIGlmIChfYWNjZXNzVHlwZSA9PSBBQ0NFU1Nf\nVU5LTk9XTikgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBzdXAuZ2V0QWNjZXNz\nVHlwZSgpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRSZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGFGYWN0b3J5KCkuCiAg\nICAgICAgICAgICAgICAgICAgZ2V0RGVmYXVsdHMoKS5nZXREZWZhdWx0QWNj\nZXNzVHlwZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBfYWNjZXNzVHlwZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBh\nY2Nlc3MgdHlwZSB1c2VkIGJ5IHRoaXMgY2xhc3MuIE11c3QgYmUgZWl0aGVy\nCiAgICAgKiB7QGxpbmsgI0FDQ0VTU19GSUVMRH0gb3Ige0BsaW5rICNBQ0NF\nU1NfUFJPUEVSVFl9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRBY2Nl\nc3NUeXBlKGludCB0eXBlKSB7CiAgICAgICAgX2FjY2Vzc1R5cGUgPSB0eXBl\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlwZSByZXF1\naXJlcyBleHRlbnQgbWFuYWdlbWVudC4KICAgICAqLwogICAgcHVibGljIGJv\nb2xlYW4gZ2V0UmVxdWlyZXNFeHRlbnQoKSB7CiAgICAgICAgaWYgKF9vd25l\nciAhPSBudWxsIHx8IGlzRW1iZWRkZWRPbmx5KCkpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgaWYgKF9leHRlbnQgPT0gbnVsbCkgewog\nICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFz\nc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9leHRlbnQgPSAoc3VwLmdldFJlcXVpcmVzRXh0ZW50\nKCkpID8gQm9vbGVhbi5UUlVFCiAgICAgICAgICAgICAgICAgICAgOiBCb29s\nZWFuLkZBTFNFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBf\nZXh0ZW50ID0gQm9vbGVhbi5UUlVFOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2V4dGVudC5ib29sZWFuVmFsdWUoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdGhlIHR5cGUgcmVxdWlyZXMgZXh0ZW50IG1hbmFnZW1l\nbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlcXVpcmVzRXh0ZW50\nKGJvb2xlYW4gcmVxKSB7CiAgICAgICAgX2V4dGVudCA9IChyZXEpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgdGhlIHR5cGUgY2FuIG9ubHkgYmUgdXNlZCBhcyBhbiBl\nbWJlZGRlZCBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlz\nRW1iZWRkZWRPbmx5KCkgewogICAgICAgIGlmIChfZW1iZWRkZWQgPT0gbnVs\nbCkgewogICAgICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9lbWJlZGRlZCA9IChzdXAuaXNFbWJlZGRl\nZE9ubHkoKSkgPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAgICA6\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgIF9lbWJlZGRlZCA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBfZW1iZWRkZWQuYm9vbGVhblZhbHVlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGNhbiBvbmx5IGJlIHVz\nZWQgYXMgYW4gZW1iZWRkZWQgb2JqZWN0LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRFbWJlZGRlZE9ubHkoYm9vbGVhbiBlbWJlZCkgewogICAgICAg\nIF9lbWJlZGRlZCA9IChlbWJlZCkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFu\nLkZBTFNFOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgdHlw\nZSdzIGZpZWxkcyBhcmUgYWN0aXZlbHkgaW50ZXJjZXB0ZWQsIGVpdGhlciBi\neQogICAgICogcmVkZWZpbml0aW9uIG9yIGVuaGFuY2VtZW50LgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ludGVyY2VwdGluZygpIHsKICAgICAg\nICByZXR1cm4gX2ludGVyY2VwdGluZzsKICAgIH0KCiAgICAvKioKICAgICAq\nIFdoZXRoZXIgdGhlIHR5cGUncyBmaWVsZHMgYXJlIGFjdGl2ZWx5IGludGVy\nY2VwdGVkLCBlaXRoZXIgYnkKICAgICAqIHJlZGVmaW5pdGlvbiBvciBlbmhh\nbmNlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50ZXJjZXB0\naW5nKGJvb2xlYW4gaW50ZXJjZXB0aW5nKSB7CiAgICAgICAgX2ludGVyY2Vw\ndGluZyA9IGludGVyY2VwdGluZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdo\nZXRoZXIgdGhlIHR5cGUgaXMgYSBtYW5hZ2VkIGludGVyZmFjZS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNNYW5hZ2VkSW50ZXJmYWNlKCkgewog\nICAgICAgIGlmICghX3R5cGUuaXNJbnRlcmZhY2UoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfaW50ZXJmYWNlID09IG51\nbGwgPyBmYWxzZSA6IF9pbnRlcmZhY2UuYm9vbGVhblZhbHVlKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIGlzIGEgbWFuYWdl\nZCBpbnRlcmZhY2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TWFuYWdl\nZEludGVyZmFjZShib29sZWFuIG1hbmFnZWRJbnRlcmZhY2UpIHsKICAgICAg\nICBpZiAoIV90eXBlLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHRocm93\nIG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm90LWludGVyZmFj\nZSIsIF90eXBlKSk7CiAgICAgICAgX2ludGVyZmFjZSA9IG1hbmFnZWRJbnRl\ncmZhY2UgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwoKICAgICAg\nICAvLyBtYW5hZ2VkIGludGVyZmFjZXMgYWx3YXlzIGRvIHByb3BlciBpbnRl\ncmNlcHRpb247IE9wZW5KUEEgZ2VuZXJhdGVzCiAgICAgICAgLy8gdGhlIGlt\ncGxlbWVudGF0aW9ucy4KICAgICAgICBpZiAoaXNNYW5hZ2VkSW50ZXJmYWNl\nKCkpCiAgICAgICAgICAgIHNldEludGVyY2VwdGluZyh0cnVlKTsKCiAgICAg\nICAgLy8gbWFuYWdlZCBpbnRlcmZhY2VzIGFsd2F5cyB1c2UgcHJvcGVydHkg\nYWNjZXNzLgogICAgICAgIHNldEFjY2Vzc1R5cGUoQUNDRVNTX1BST1BFUlRZ\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWFuYWdlZCBp\nbnRlcmZhY2UgaW1wbGVtZW50b3IgaWYgYW55LgogICAgICovCiAgICBwdWJs\naWMgQ2xhc3MgZ2V0SW50ZXJmYWNlSW1wbCgpIHsKICAgICAgICByZXR1cm4g\nX2ltcGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG1hbmFnZWQg\naW50ZXJmYWNlIGltcGxlbWVudG9yIGNsYXNzLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRJbnRlcmZhY2VJbXBsKENsYXNzIGltcGwpIHsKICAgICAg\nICBfaW1wbCA9IGltcGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\nYWxsIGV4cGxpY2l0bHkgZGVjbGFyZWQgaW50ZXJmYWNlcyB0aGlzIGNsYXNz\nIGltcGxlbWVudHMuCiAgICAgKi8KICAgIHB1YmxpYyBDbGFzc1tdIGdldERl\nY2xhcmVkSW50ZXJmYWNlcygpIHsKICAgICAgICBpZiAoX2ludGVyZmFjZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIE1ldGFEYXRhUmVwb3NpdG9y\neS5FTVBUWV9DTEFTU0VTOwogICAgICAgIHJldHVybiAoQ2xhc3NbXSkgX2lu\ndGVyZmFjZXMudG9BcnJheShuZXcgQ2xhc3NbX2ludGVyZmFjZXMuc2l6ZSgp\nXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFeHBsaWNpdGx5IGRlY2xhcmUg\ndGhlIGdpdmVuIGludGVyZmFjZSBhbW9uZyB0aGUgb25lcyB0aGlzCiAgICAg\nKiBjbGFzcyBpbXBsZW1lbnRzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBh\nZGREZWNsYXJlZEludGVyZmFjZShDbGFzcyBpZmFjZSkgewogICAgICAgIGlm\nIChpZmFjZSA9PSBudWxsIHx8ICFpZmFjZS5pc0ludGVyZmFjZSgpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQo\nImRlY2xhcmUtbm9uLWludGVyZmFjZSIsCiAgICAgICAgICAgICAgICB0aGlz\nLCBpZmFjZSkpOwogICAgICAgIGlmIChfaW50ZXJmYWNlcyA9PSBudWxsKQog\nICAgICAgICAgICBfaW50ZXJmYWNlcyA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICBfaW50ZXJmYWNlcy5hZGQoaWZhY2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIHRoZSBnaXZlbiBpbnRlcmZhY2UgZnJvbSB0aGUgZGVj\nbGFyZWQgbGlzdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVtb3Zl\nRGVjbGFyZWRJbnRlcmZhY2UoQ2xhc3MgaWZhY2UpIHsKICAgICAgICBpZiAo\nX2ludGVyZmFjZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIHJldHVybiBfaW50ZXJmYWNlcy5yZW1vdmUoaWZhY2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWxpYXMgcHJvcGVydGllcyBmcm9tIHRo\nZSBnaXZlbiBpbnRlcmZhY2UgZHVyaW5nICBxdWVyaWVzIHRvCiAgICAgKiB0\naGUgbG9jYWwgZmllbGQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldElu\ndGVyZmFjZVByb3BlcnR5QWxpYXMoQ2xhc3MgaWZhY2UsIFN0cmluZyBvcmln\nLCAKICAgICAgICBTdHJpbmcgbG9jYWwpIHsKICAgICAgICBzeW5jaHJvbml6\nZWQgKF9pZmFjZU1hcCkgewogICAgICAgICAgICBNYXAgZmllbGRzID0gKE1h\ncCkgX2lmYWNlTWFwLmdldChpZmFjZSk7CiAgICAgICAgICAgIGlmIChmaWVs\nZHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmllbGRzID0gbmV3IEhh\nc2hNYXAoKTsKICAgICAgICAgICAgICAgIF9pZmFjZU1hcC5wdXQoaWZhY2Us\nIGZpZWxkcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpZWxk\ncy5jb250YWluc0tleShvcmlnKSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiZHVwbGljYXRlLWlmYWNl\nLWFsaWFzIiwgCiAgICAgICAgICAgICAgICAgICAgdGhpcywgb3JpZywgbG9j\nYWwpKTsKICAgICAgICAgICAgZmllbGRzLnB1dChvcmlnLCBsb2NhbCk7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEdldCBsb2NhbCBm\naWVsZCBhbGlhcyBmb3IgdGhlIGdpdmVuIGludGVyZmFjZSBwcm9wZXJ0eS4K\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRJbnRlcmZhY2VQcm9wZXJ0\neUFsaWFzKENsYXNzIGlmYWNlLCBTdHJpbmcgb3JpZykgewogICAgICAgIHN5\nbmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAgICAgICAgIE1hcCBmaWVs\nZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAgICAg\naWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIHJldHVybiAoU3RyaW5nKSBmaWVsZHMuZ2V0KG9y\naWcpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYWxsIGFsaWFzZXMgcHJvcGVydHkgbmFtZWQgZm9yIHRoZSBnaXZlbiBp\nbnRlcmZhY2UuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRJbnRl\ncmZhY2VBbGlhc2VkUHJvcGVydGllcyhDbGFzcyBpZmFjZSkgewogICAgICAg\nIHN5bmNocm9uaXplZCAoX2lmYWNlTWFwKSB7CiAgICAgICAgICAgIE1hcCBm\naWVsZHMgPSAoTWFwKSBfaWZhY2VNYXAuZ2V0KGlmYWNlKTsKICAgICAgICAg\nICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIEVNUFRZX1NUUklOR19BUlJBWTsKICAgICAgICAgICAgcmV0dXJuIChTdHJp\nbmdbXSkgZmllbGRzLmtleVNldCgpLnRvQXJyYXkoCiAgICAgICAgICAgICAg\nICBuZXcgU3RyaW5nW2ZpZWxkcy5zaXplKCldKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgZmll\nbGRzIHRoYXQgdXNlIGltcGwgb3IgaW50ZXJtZWRpYXRlIGRhdGEsIGluCiAg\nICAgKiBvcmRlciB0byBjcmVhdGUgYSBjb21wYWN0ZWQgYXJyYXkgZm9yIHN0\nb3JhZ2Ugb2Ygc2FpZCBkYXRhLgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEV4dHJhRmllbGREYXRhTGVuZ3RoKCkgewogICAgICAgIGludFtdIHRhYmxl\nID0gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpOwogICAgICAgIGZvciAoaW50\nIGkgPSB0YWJsZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICAg\nICAgaWYgKHRhYmxlW2ldICE9IC0xKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHRhYmxlW2ldICsgMTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgaW1wbCAvIGludGVybWVkaWF0ZSBmaWVs\nZCBkYXRhIGluZGV4IG9mIHRoZSBnaXZlbiBmaWVsZAogICAgICogaW4gdGhl\nIGNvbXBhY3RlZCBhcnJheSwgb3IgLTEgaWYgdGhlIGZpZWxkIGRvZXMgbm90\nIHVzZSBleHRyYSBkYXRhLgogICAgICoKICAgICAqIEBzZWUgI2dldEV4dHJh\nRmllbGREYXRhTGVuZ3RoCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RXh0\ncmFGaWVsZERhdGFJbmRleChpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4g\nZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpW2ZpZWxkXTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZXMgYSB0YWJsZSBtYXBwaW5nIGVhY2ggZmllbGQg\naW5kZXggdG8gaXRzIGV4dHJhIGRhdGEgaW5kZXguCiAgICAgKi8KICAgIHBy\naXZhdGUgaW50W10gZ2V0RXh0cmFGaWVsZERhdGFUYWJsZSgpIHsKICAgICAg\nICBpZiAoX2ZpZWxkRGF0YVRhYmxlID09IG51bGwpIHsKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAg\nICAgaW50W10gdGFibGUgPSBuZXcgaW50W2ZtZHMubGVuZ3RoXTsKICAgICAg\nICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYg\nKGZtZHNbaV0udXNlc0ludGVybWVkaWF0ZSgpCiAgICAgICAgICAgICAgICAg\nICAgfHwgZm1kc1tpXS51c2VzSW1wbERhdGEoKSAhPSBCb29sZWFuLkZBTFNF\nKQogICAgICAgICAgICAgICAgICAgIHRhYmxlW2ldID0gaWR4Kys7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGFibGVbaV0g\nPSAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfZmllbGREYXRhVGFi\nbGUgPSB0YWJsZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9maWVsZERh\ndGFUYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0aGVy\nIHRoZSBnaXZlbiBuYW1lIHJlcHJlc2VudHMgYSBtYW5hZ2VkIG9yIHN0YXRp\nYyBmaWVsZCBvZgogICAgICogdGhpcyBjbGFzcywgaW5jbHVkaW5nIHN1cGVy\nY2xhc3MgZmllbGRzLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Fj\nY2Vzc2libGVGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAgICBpZiAoZ2V0\nRGVjbGFyZWRGaWVsZChmaWVsZCkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgaWYgKF9zdGF0aWNGaWVsZHMgPT0gbnVsbCkg\newogICAgICAgICAgICBGaWVsZFtdIGZpZWxkcyA9IChGaWVsZFtdKSBBY2Nl\nc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoy\nRG9Qcml2SGVscGVyLmdldERlY2xhcmVkRmllbGRzQWN0aW9uKF90eXBlKSk7\nIAogICAgICAgICAgICBTZXQgbmFtZXMgPSBuZXcgSGFzaFNldCgoaW50KSAo\nZmllbGRzLmxlbmd0aCAqIDEuMzMgKyAxKSk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICAgICAgaWYgKE1vZGlmaWVyLmlzU3RhdGljKGZpZWxkc1tpXS5nZXRNb2Rp\nZmllcnMoKSkpCiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYWRkKGZpZWxk\nc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBfc3RhdGljRmllbGRzID0g\nbmFtZXM7CiAgICAgICAgfQogICAgICAgIGlmIChfc3RhdGljRmllbGRzLmNv\nbnRhaW5zKGZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKF9zdXBlciAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gZ2V0\nUENTdXBlcmNsYXNzTWV0YURhdGEoKS5pc0FjY2Vzc2libGVGaWVsZChmaWVs\nZCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIGFsbCBmaWVsZCBtZXRhZGF0YXMsIGluY2x1ZGluZyBzdXBl\ncmNsYXNzIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURh\ndGFbXSBnZXRGaWVsZHMoKSB7CiAgICAgICAgaWYgKF9hbGxGaWVsZHMgPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfYWxsRmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsK\nICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZmllbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBzdXBGaWVsZHMgPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAgICAgIGdldEZpZWxk\ncygpOwoKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBhbGxGaWVs\nZHMgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAg\nICAgICAgICAgKGZpZWxkcy5sZW5ndGggKyBzdXBGaWVsZHMubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoc3VwRmllbGRzLCAw\nLCBhbGxGaWVsZHMsIDAsIHN1cEZpZWxkcy5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgcmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKGFsbEZpZWxk\ncywgc3VwRmllbGRzLmxlbmd0aCk7CgogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBmaWVsZHNbaV0uc2V0SW5kZXgoc3VwRmllbGRzLmxlbmd0\naCArIGkpOwogICAgICAgICAgICAgICAgICAgIGFsbEZpZWxkc1tzdXBGaWVs\nZHMubGVuZ3RoICsgaV0gPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfYWxsRmllbGRzID0gYWxsRmllbGRzOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfYWxsRmllbGRz\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSBzdXBlcmNsYXNzIGZp\nZWxkcyB0aGF0IHdlIGRlZmluZSB3aXRoIG91ciB2ZXJzaW9uLgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmll\nbGRzKEZpZWxkTWV0YURhdGFbXSBmaWVsZHMsCiAgICAgICAgaW50IGxlbikg\newogICAgICAgIGlmIChfc3VwRmllbGRNYXAgPT0gbnVsbCB8fCAhX2RlZlN1\ncEZpZWxkcykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBkb24n\ndCBhc3N1bWUgZmllbGRzIGFyZSBpbiBvcmRlcjsgdGhpcyBtZXRob2QgaXMg\ndXNlZCBmb3IKICAgICAgICAvLyBsaXN0aW5nIG9yZGVyIGFzIHdlbGwKICAg\nICAgICBGaWVsZE1ldGFEYXRhIHN1cEZpZWxkOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgc3VwRmllbGQg\nPSAoRmllbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChmaWVsZHNbaV0u\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgaWYgKHN1cEZpZWxkICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZpZWxkc1tpXSA9IHN1cEZpZWxkOwogICAg\nICAgICAgICAgICAgc3VwRmllbGQuc2V0SW5kZXgoaSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhl\nIHN1cGVyY2xhc3MgY29weSBvZiB0aGUgZ2l2ZW4gZmllbGQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBGaWVsZE1ldGFEYXRhIGdldFN1cGVyY2xhc3NGaWVs\nZChGaWVsZE1ldGFEYXRhIHN1cEZpZWxkKSB7CiAgICAgICAgQ2xhc3NNZXRh\nRGF0YSBzbSA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmbWQgPSBzbSA9PSBudWxsID8gbnVsbCA6IHNtLmdl\ndEZpZWxkKHN1cEZpZWxkLmdldE5hbWUoKSk7CiAgICAgICAgaWYgKGZtZCA9\nPSBudWxsIHx8IGZtZC5nZXRNYW5hZ2VtZW50KCkgIT0gZm1kLk1BTkFHRV9Q\nRVJTSVNURU5UKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoInVubWFuYWdlZC1zdXAtZmllbGQiLAogICAgICAg\nICAgICAgICAgc3VwRmllbGQsIHRoaXMpKTsKICAgICAgICByZXR1cm4gZm1k\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIG9ubHkgdGhlIGZpZWxk\ncyBmb3IgdGhpcyBjbGFzcywgd2l0aG91dCBzdXBlcmNsYXNzIGZpZWxkcy4K\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWNsYXJl\nZEZpZWxkcygpIHsKICAgICAgICBpZiAoX2ZpZWxkcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgIExpc3QgZmllbGRzID0gbmV3IEFycmF5TGlzdChfZmllbGRN\nYXAuc2l6ZSgpKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7CiAg\nICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gX2ZpZWxkTWFwLnZhbHVl\ncygpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nICAgICBmbWQgPSAoRmllbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0\nYURhdGEuTUFOQUdFX05PTkUpIHsKICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0RGVjbGFyZWRJbmRleChmaWVsZHMuc2l6ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBmbWQuc2V0SW5kZXgoZm1kLmdldERlY2xhcmVkSW5kZXgoKSk7\nCiAgICAgICAgICAgICAgICAgICAgZmllbGRzLmFkZChmbWQpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9maWVsZHMg\nPSAoRmllbGRNZXRhRGF0YVtdKSBmaWVsZHMudG9BcnJheQogICAgICAgICAg\nICAgICAgKF9yZXBvcy5uZXdGaWVsZE1ldGFEYXRhQXJyYXkoZmllbGRzLnNp\nemUoKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2ZpZWxkczsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiBwcmltYXJ5IGtleSBmaWVsZHMs\nIG9yIGVtcHR5IGFycmF5IGlmIG5vbmUuIFRoZSBvcmRlcgogICAgICogaW4g\nd2hpY2ggdGhlIGtleXMgYXJlIHJldHVybmVkIHdpbGwgYmUgdGhlIG9yZGVy\nIGluIHdoaWNoCiAgICAgKiB0aGUgZmllbGRzIGFyZSBkZWNsYXJlZCwgc3Rh\ncnRpbmcgYXQgdGhlIGxlYXN0LWRlcml2ZWQgc3VwZXJjbGFzcwogICAgICog\nYW5kIGVuZGluZyB3aXRoIHRoZSBwcmltYXJ5IGtleSBmaWVsZHMgb2YgdGhl\nIG1vc3QtZGVyaXZlZCBzdWJjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZp\nZWxkTWV0YURhdGFbXSBnZXRQcmltYXJ5S2V5RmllbGRzKCkgewogICAgICAg\nIC8vIGNoZWNrIGZvciBwayBmaWVsZHMgZXZlbiBpZiBub3Qgc2V0IHRvIElE\nX0FQUExJQ0FUSU9OIHNvIHRoYXQKICAgICAgICAvLyBhcHAgaWQgdG9vbCBz\nZWVzIHRoZW0gZXZlbiB3aGVuIHVzZXIgZG9lc24ndCBkZWNsYXJlIGFwcCBp\nZAogICAgICAgIGlmIChfYWxsUEtGaWVsZHMgPT0gbnVsbCkgewogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZmllbGRzID0gZ2V0RmllbGRzKCk7CiAg\nICAgICAgICAgIGludCBudW0gPSAwOwogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAg\nIGlmIChmaWVsZHNbaV0uaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAg\nICAgICAgbnVtKys7CgogICAgICAgICAgICBpZiAobnVtID09IDApCiAgICAg\nICAgICAgICAgICBfYWxsUEtGaWVsZHMgPSBfcmVwb3MuRU1QVFlfRklFTERT\nOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGFbXSBwa3MgPSBfcmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KG51\nbSk7CiAgICAgICAgICAgICAgICBudW0gPSAwOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkc1tpXS5zZXRQcmlt\nYXJ5S2V5SW5kZXgobnVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGtz\nW251bV0gPSBmaWVsZHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIG51\nbSsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIF9hbGxQS0ZpZWxkcyA9IHBrczsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbFBLRmllbGRzOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsaXN0IG9mIGZpZWxk\ncyBpbiB0aGUgZGVmYXVsdCBmZXRjaCBncm91cCwKICAgICAqIGluY2x1ZGlu\nZyBzdXBlcmNsYXNzIGZpZWxkcywgb3IgYW4gZW1wdHkgYXJyYXkgaWYgbm9u\nZS4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGFbXSBnZXREZWZh\ndWx0RmV0Y2hHcm91cEZpZWxkcygpIHsKICAgICAgICBpZiAoX2FsbERGR0Zp\nZWxkcyA9PSBudWxsKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBm\naWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICAgICAgaW50IG51bSA9IDA7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpXS5pc0luRGVm\nYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAgICAgICAgICAgICBudW0rKzsK\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBkZmdzID0gX3JlcG9zLm5l\nd0ZpZWxkTWV0YURhdGFBcnJheShudW0pOwogICAgICAgICAgICBudW0gPSAw\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5n\ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uaXNJbkRl\nZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgICAgICAgICAgZGZnc1tu\ndW0rK10gPSBmaWVsZHNbaV07CiAgICAgICAgICAgIF9hbGxERkdGaWVsZHMg\nPSBkZmdzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbERGR0ZpZWxk\nczsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmVyc2lvbiBm\naWVsZCBmb3IgdGhpcyBjbGFzcywgaWYgYW55LgogICAgICovCiAgICBwdWJs\naWMgRmllbGRNZXRhRGF0YSBnZXRWZXJzaW9uRmllbGQoKSB7CiAgICAgICAg\naWYgKF92ZXJzaW9uSWR4ID09IEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAg\nICAgICAgIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsK\nICAgICAgICAgICAgaW50IGlkeCA9IC0xOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICAgICAgaWYgKGZpZWxkc1tpXS5pc1ZlcnNpb24oKSkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChpZHggIT0gLTEpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKCJtdWx0LXZlcnMtZmllbGRzIiwg\ndGhpcywgZmllbGRzW2lkeF0sIGZpZWxkc1tpXSkpOwogICAgICAgICAgICAg\nICAgICAgIGlkeCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgX3ZlcnNpb25JZHggPSBpZHg7CiAgICAgICAgfQog\nICAgICAgIGlmIChfdmVyc2lvbklkeCA9PSAtMSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGdldEZpZWxkcygpW192ZXJzaW9u\nSWR4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbWV0YWRh\ndGEgZm9yIHRoZSBwZXJzaXN0ZW50IG9yIHRyYW5zYWN0aW9uYWwgZmllbGQg\nd2l0aAogICAgICogdGhlIGdpdmVuIGFic29sdXRlIGluZGV4LgogICAgICoK\nICAgICAqIEByZXR1cm4gdGhlIGZpZWxkJ3MgbWV0YWRhdGEsIG9yIG51bGwg\naWYgbm90IGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRh\nIGdldEZpZWxkKGludCBpbmRleCkgewogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmaWVsZHMgPSBnZXRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXggPCAw\nIHx8IGluZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBl\ncnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAgKiB0\naGUgZ2l2ZW4gcmVsYXRpdmUgaW5kZXguCiAgICAgKgogICAgICogQHJldHVy\nbiB0aGUgZmllbGQncyBtZXRhZGF0YSwgb3IgbnVsbCBpZiBub3QgZm91bmQK\nICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0YURhdGEgZ2V0RGVjbGFyZWRG\naWVsZChpbnQgaW5kZXgpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZmll\nbGRzID0gZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBpZiAoaW5kZXgg\nPCAwIHx8IGluZGV4ID49IGZpZWxkcy5sZW5ndGgpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIHJldHVybiBmaWVsZHNbaW5kZXhdOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhl\nIHBlcnNpc3RlbnQgb3IgdHJhbnNhY3Rpb25hbCBmaWVsZCB3aXRoCiAgICAg\nKiB0aGUgZ2l2ZW4gbmFtZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBm\naWVsZCdzIG1ldGFkYXRhLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YSBnZXRGaWVsZChTdHJpbmcgbmFt\nZSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gZ2V0RGVjbGFyZWRG\naWVsZChuYW1lKTsKICAgICAgICBpZiAoZm1kICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBmbWQ7CiAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCAhPSBu\ndWxsICYmIF9kZWZTdXBGaWVsZHMpIHsKICAgICAgICAgICAgZm1kID0gKEZp\nZWxkTWV0YURhdGEpIF9zdXBGaWVsZE1hcC5nZXQobmFtZSk7CiAgICAgICAg\nICAgIGlmIChmbWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBm\nbWQ7CiAgICAgICAgfQogICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0\nRmllbGQobmFtZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIG1ldGFkYXRhIGZvciB0aGUgcGVyc2lz\ndGVudCBvciB0cmFuc2FjdGlvbmFsIGZpZWxkIHdpdGgKICAgICAqIHRoZSBn\naXZlbiBuYW1lLCB3aXRob3V0IGluY2x1ZGluZyBzdXBlcmNsYXNzIGZpZWxk\ncy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBmaWVsZCdzIG1ldGFkYXRh\nLCBvciBudWxsIGlmIG5vdCBmb3VuZAogICAgICovCiAgICBwdWJsaWMgRmll\nbGRNZXRhRGF0YSBnZXREZWNsYXJlZEZpZWxkKFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YSBmaWVsZCA9IChGaWVsZE1ldGFEYXRhKSBf\nZmllbGRNYXAuZ2V0KG5hbWUpOwogICAgICAgIGlmIChmaWVsZCA9PSBudWxs\nIHx8IGZpZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBmaWVsZC5NQU5BR0VfTk9O\nRSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgcmV0dXJuIGZp\nZWxkOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFueSBmaWVsZHMg\ndGhhdCB3ZXJlIGFkZGVkIGFzIG5vbi1tYW5hZ2VkLgogICAgICogQWxsIG90\naGVyIG1ldGhvZHMgdG8gZ2V0IGZpZWxkcyByZXR1cm4gb25seSB0aG9zZSB0\naGF0IGFyZSBtYW5hZ2VkLgogICAgICovCiAgICBwdWJsaWMgRmllbGRNZXRh\nRGF0YVtdIGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCkgewogICAgICAg\nIGlmIChfdW5tZ2RGaWVsZHMgPT0gbnVsbCkgewogICAgICAgICAgICBDb2xs\nZWN0aW9uIHVubWFuYWdlZCA9IG5ldyBBcnJheUxpc3QoMyk7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGEgZmllbGQ7CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3IgaXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBmaWVsZCA9IChGaWVs\nZE1ldGFEYXRhKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKGZp\nZWxkLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9O\nT05FKQogICAgICAgICAgICAgICAgICAgIHVubWFuYWdlZC5hZGQoZmllbGQp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF91bm1nZEZpZWxkcyA9IChG\naWVsZE1ldGFEYXRhW10pIHVubWFuYWdlZC50b0FycmF5CiAgICAgICAgICAg\nICAgICAoX3JlcG9zLm5ld0ZpZWxkTWV0YURhdGFBcnJheSh1bm1hbmFnZWQu\nc2l6ZSgpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfdW5tZ2RGaWVs\nZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgZmllbGQgbWV0\nYWRhdGEgdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAgcHVibGljIEZpZWxk\nTWV0YURhdGEgYWRkRGVjbGFyZWRGaWVsZChTdHJpbmcgbmFtZSwgQ2xhc3Mg\ndHlwZSkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX3JlcG9zLm5l\nd0ZpZWxkTWV0YURhdGEobmFtZSwgdHlwZSwgdGhpcyk7CiAgICAgICAgY2xl\nYXJGaWVsZENhY2hlKCk7CiAgICAgICAgX2ZpZWxkTWFwLnB1dChuYW1lLCBm\nbWQpOwogICAgICAgIHJldHVybiBmbWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZW1vdmUgdGhlIGdpdmVuIGZpZWxkIGZyb20gbWFuYWdlbWVudC4KICAg\nICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGZpZWxkIHdhcyByZW1v\ndmVkLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gcmVtb3ZlRGVjbGFyZWRGaWVsZChGaWVsZE1ldGFEYXRhIGZpZWxkKSB7\nCiAgICAgICAgaWYgKGZpZWxkICE9IG51bGwgJiYgX2ZpZWxkTWFwLnJlbW92\nZShmaWVsZC5nZXROYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgY2xl\nYXJGaWVsZENhY2hlKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIGRlZmluZWQgc3VwZXJjbGFzcyBmaWVsZCB3aXRo\nIHRoZSBnaXZlbiBuYW1lLCBvciBudWxsIGlmIG5vbmUuCiAgICAgKi8KICAg\nIHB1YmxpYyBGaWVsZE1ldGFEYXRhIGdldERlZmluZWRTdXBlcmNsYXNzRmll\nbGQoU3RyaW5nIG5hbWUpIHsKICAgICAgICBpZiAoX3N1cEZpZWxkTWFwID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVy\nbiAoRmllbGRNZXRhRGF0YSkgX3N1cEZpZWxkTWFwLmdldChuYW1lKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCBhIG5ldyBkZWZpbmVkIHN1cGVyY2xh\nc3MgZmllbGQgbWV0YWRhdGEgdG8gdGhpcyBjbGFzcy4KICAgICAqLwogICAg\ncHVibGljIEZpZWxkTWV0YURhdGEgYWRkRGVmaW5lZFN1cGVyY2xhc3NGaWVs\nZChTdHJpbmcgbmFtZSwgQ2xhc3MgdHlwZSwKICAgICAgICBDbGFzcyBzdXAp\nIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9yZXBvcy5uZXdGaWVs\nZE1ldGFEYXRhKG5hbWUsIHR5cGUsIHRoaXMpOwogICAgICAgIGZtZC5zZXRE\nZWNsYXJpbmdUeXBlKHN1cCk7CiAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hl\nKCk7CiAgICAgICAgX2RlZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgICAgIGlm\nIChfc3VwRmllbGRNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX3N1cEZpZWxk\nTWFwID0gbmV3IEhhc2hNYXAoKTsKICAgICAgICBfc3VwRmllbGRNYXAucHV0\nKG5hbWUsIGZtZCk7CiAgICAgICAgcmV0dXJuIGZtZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJlbW92ZSB0aGUgZ2l2ZW4gZmllbGQgZnJvbSBtYW5hZ2Vt\nZW50LgogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZmllbGQg\nd2FzIHJlbW92ZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiByZW1vdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKEZpZWxk\nTWV0YURhdGEgZmllbGQpIHsKICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCAm\nJiBfc3VwRmllbGRNYXAgIT0gbnVsbAogICAgICAgICAgICAmJiBfc3VwRmll\nbGRNYXAucmVtb3ZlKGZpZWxkLmdldE5hbWUoKSkgIT0gbnVsbCkgewogICAg\nICAgICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICAgICAgX2Rl\nZlN1cEZpZWxkcyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8q\nKgogICAgICogSW5jb3Jwb3JhdGUgc3VwZXJjbGFzcyBmaWVsZHMgcmVkZWZp\nbmVkIGluIHRoaXMgc3ViY2xhc3MgaW50byB0aGlzCiAgICAgKiBtZXRhZGF0\nYS4gVGhpcyBtZXRob2QgaXMgZ2VuZXJhbGx5IGNhbGxlZCBhZnRlciBtZXRh\nZGF0YSBpcyByZXNvbHZlZAogICAgICogYW5kIG1hcHBpbmcgaW5mb3JtYXRp\nb24gaXMgbG9hZGVkLCBidXQgYmVmb3JlIG1hcHBpbmcgcmVzb2x2ZS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZm9yY2Ugd2hldGhlciB0byBmb3JjZSByZS1t\nYXBwaW5nIG9mIGV2ZW4gbWFwcGVkIHN1cGVyY2xhc3MgZmllbGRzCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGRlZmluZVN1cGVyY2xhc3NGaWVsZHMoYm9v\nbGVhbiBmb3JjZSkgewogICAgICAgIGlmIChfZGVmU3VwRmllbGRzKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0g\nZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICBpZiAoaXNNYXBw\nZWQoKSAmJiBzdXAgIT0gbnVsbCkgewogICAgICAgICAgICAvLyByZWRlZmlu\nZSBhbGwgdW5tYXBwZWQgc3VwZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAg\nRmllbGRNZXRhRGF0YVtdIHN1cHMgPSBzdXAuZ2V0RmllbGRzKCk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vwcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAgICAgaWYgKChmb3JjZSB8fCAhc3Vwc1tpXS5nZXRE\nZWZpbmluZ01ldGFEYXRhKCkuaXNNYXBwZWQoKSkKICAgICAgICAgICAgICAg\nICAgICAmJiBnZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKHN1cHNbaV0uZ2V0\nTmFtZSgpKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkRGVm\naW5lZFN1cGVyY2xhc3NGaWVsZChzdXBzW2ldLmdldE5hbWUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgc3Vwc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwg\nc3Vwc1tpXS5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJlc29sdmVEZWZp\nbmVkU3VwZXJjbGFzc0ZpZWxkcygpOwoKICAgICAgICAvLyB0aGlzIGVuc3Vy\nZXMgdGhhdCBhbGwgZmllbGQgaW5kZXhlcyBnZXQgc2V0IHdoZW4gZmllbGRz\nIGFyZSBjYWNoZWQuCiAgICAgICAgLy8gSSBkb24ndCBsaWtlIGRvaW5nIHRo\naXMgdHdpY2UgKGl0J3MgYWxzbyBkb25lIGluIHJlc29sdmVNZXRhKSwgYnV0\nCiAgICAgICAgLy8gd2UgaGF2ZSB0byByZS1jYWNoZSBpbiBjYXNlIHRoaXMg\nY2xhc3Mgb3IgYW55IHN1cGVyY2xhc3MgcmVwbGFjZWQKICAgICAgICAvLyBz\nb21lIGZpZWxkcyB3aXRoIHJlZGVmaW5lZCB2ZXJzaW9ucywgYW5kIEkgZG9u\nJ3Qgd2FudCBvdXRzaWRlIGNvZGUKICAgICAgICAvLyB0byBoYXZlIHRvIGNh\nbGwgdGhpcyBtZXRob2QgYWZ0ZXIgcmVzb2x2ZSBqdXN0IHRvIGdldCBmaWVs\nZCBpbmRleGVzLAogICAgICAgIC8vIGV0YyBzZXQgY29ycmVjdGx5CiAgICAg\nICAgY2xlYXJBbGxGaWVsZENhY2hlKCk7CiAgICAgICAgY2FjaGVGaWVsZHMo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgc3VwZXJjbGFzcyBm\naWVsZHMgd2UndmUgcmVkZWZpbmVkLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgcmVzb2x2ZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKCkgewogICAgICAg\nIF9kZWZTdXBGaWVsZHMgPSB0cnVlOwogICAgICAgIGlmIChfc3VwRmllbGRN\nYXAgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZDsKICAgICAgICBGaWVsZE1ldGFEYXRhIHN1cDsKICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9zdXBGaWVsZE1hcC52YWx1ZXMo\nKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBm\nbWQgPSAoRmllbGRNZXRhRGF0YSkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\nc3VwID0gZ2V0U3VwZXJjbGFzc0ZpZWxkKGZtZCk7CgogICAgICAgICAgICAv\nLyBqcGEgbWV0YWRhdGEgZG9lc24ndCBxdWFsaWZ5IHN1cGVyY2xhc3MgZmll\nbGQgbmFtZXMsIHNvIHdlCiAgICAgICAgICAgIC8vIG1pZ2h0IG5vdCBrbm93\nIHRoZSBkZWNsYXJpbmcgdHlwZSB1bnRpbCBub3cKICAgICAgICAgICAgaWYg\nKGZtZC5nZXREZWNsYXJpbmdUeXBlKCkgPT0gT2JqZWN0LmNsYXNzKSB7CiAg\nICAgICAgICAgICAgICBmbWQuc2V0RGVjbGFyaW5nVHlwZShzdXAuZ2V0RGVj\nbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgICAgIGZtZC5iYWNraW5nTWVt\nYmVyKGdldFJlcG9zaXRvcnkoKS5nZXRNZXRhRGF0YUZhY3RvcnkoKS4KICAg\nICAgICAgICAgICAgICAgICBnZXREZWZhdWx0cygpLmdldEJhY2tpbmdNZW1i\nZXIoZm1kKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm1kLmNvcHko\nc3VwKTsKICAgICAgICAgICAgZm1kLnJlc29sdmUoTU9ERV9NRVRBKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFuIGFycmF5\nIG9mIGFsbCB0aGUgZmllbGRzIGRlZmluZWQgYnkgdGhpcyBjbGFzcy4KICAg\nICAqIFRoaXMgaW5jbHVkZXMgbWFwcGVkIGRlY2xhcmVkIGZpZWxkcyBhbmQg\nYW55IGNvbmNyZXRlIG1hcHBpbmcgb2YKICAgICAqIHVubWFwcGVkIHN1cGVy\nY2xhc3MgZmllbGRzIHBlcmZvcm1lZCBieSB0aGlzIGNsYXNzLgogICAgICov\nCiAgICBwdWJsaWMgRmllbGRNZXRhRGF0YVtdIGdldERlZmluZWRGaWVsZHMo\nKSB7CiAgICAgICAgaWYgKF9kZWZpbmVkRmllbGRzID09IG51bGwpIHsKICAg\nICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygp\nOwogICAgICAgICAgICBMaXN0IGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZp\nZWxkcy5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGZp\nZWxkc1tpXS5pc01hcHBlZCgpCiAgICAgICAgICAgICAgICAgICAgJiYgZmll\nbGRzW2ldLmdldERlZmluaW5nTWV0YURhdGEoKSA9PSB0aGlzKQogICAgICAg\nICAgICAgICAgICAgIGRlZmluZWQuYWRkKGZpZWxkc1tpXSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgX2RlZmluZWRGaWVsZHMgPSAoRmllbGRNZXRh\nRGF0YVtdKSBkZWZpbmVkLnRvQXJyYXkKICAgICAgICAgICAgICAgIChfcmVw\nb3MubmV3RmllbGRNZXRhRGF0YUFycmF5KGRlZmluZWQuc2l6ZSgpKSk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBfZGVmaW5lZEZpZWxkczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIGZpZWxkcyBpbiB0aGUgb3Jk\nZXIgdGhleSBhcmUgbGlzdGVkIGluIHRoZSBtZXRhZGF0YQogICAgICogZmls\nZS4gVW5saXN0ZWQgZmllbGRzIGFyZSBwbGFjZWQgYWZ0ZXIgbGlzdGVkIG9u\nZXMuCiAgICAgKi8KICAgIHB1YmxpYyBGaWVsZE1ldGFEYXRhW10gZ2V0Rmll\nbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAgICAgICAgaWYgKF9hbGxMaXN0aW5n\nRmllbGRzID09IG51bGwpIHsKICAgICAgICAgICAgLy8gY29tYmluZSBkZWNs\nYXJlZCBhbmQgdW5tYW5hZ2VkIGZpZWxkcyBpbnRvIGxpc3Rpbmcgb3JkZXIg\nYXJyYXkKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGRlYyA9IGdldERl\nY2xhcmVkRmllbGRzKCk7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSB1\nbm1nZCA9IGdldERlY2xhcmVkVW5tYW5hZ2VkRmllbGRzKCk7CiAgICAgICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBkZWNMaXN0aW5nID0gX3JlcG9zLm5ld0Zp\nZWxkTWV0YURhdGFBcnJheQogICAgICAgICAgICAgICAgKGRlYy5sZW5ndGgg\nKyB1bm1nZC5sZW5ndGgpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5\nKGRlYywgMCwgZGVjTGlzdGluZywgMCwgZGVjLmxlbmd0aCk7CiAgICAgICAg\nICAgIFN5c3RlbS5hcnJheWNvcHkodW5tZ2QsIDAsIGRlY0xpc3RpbmcsIGRl\nYy5sZW5ndGgsIHVubWdkLmxlbmd0aCk7CiAgICAgICAgICAgIEFycmF5cy5z\nb3J0KGRlY0xpc3RpbmcsIExpc3RpbmdPcmRlckNvbXBhcmF0b3IuZ2V0SW5z\ndGFuY2UoKSk7CgogICAgICAgICAgICBpZiAoX3N1cGVyID09IG51bGwpCiAg\nICAgICAgICAgICAgICBfYWxsTGlzdGluZ0ZpZWxkcyA9IGRlY0xpc3Rpbmc7\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gcGxhY2Ug\nc3VwZXJjbGFzcyBmaWVsZHMgaW4gbGlzdGluZyBvcmRlciBiZWZvcmUgb3Vy\nCiAgICAgICAgICAgICAgICAvLyBsaXN0aW5nLW9yZGVyIGRlY2xhcmVkIGZp\nZWxkcwogICAgICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIHN1cCA9IGdl\ndFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuCiAgICAgICAgICAgICAgICAgICAg\nZ2V0RmllbGRzSW5MaXN0aW5nT3JkZXIoKTsKICAgICAgICAgICAgICAgIEZp\nZWxkTWV0YURhdGFbXSBsaXN0aW5nID0gX3JlcG9zLm5ld0ZpZWxkTWV0YURh\ndGFBcnJheQogICAgICAgICAgICAgICAgICAgIChzdXAubGVuZ3RoICsgZGVj\nTGlzdGluZy5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5\nY29weShzdXAsIDAsIGxpc3RpbmcsIDAsIHN1cC5sZW5ndGgpOwogICAgICAg\nICAgICAgICAgcmVwbGFjZURlZmluZWRTdXBlcmNsYXNzRmllbGRzKGxpc3Rp\nbmcsIHN1cC5sZW5ndGgpOwogICAgICAgICAgICAgICAgU3lzdGVtLmFycmF5\nY29weShkZWNMaXN0aW5nLCAwLCBsaXN0aW5nLCBzdXAubGVuZ3RoLAogICAg\nICAgICAgICAgICAgICAgIGRlY0xpc3RpbmcubGVuZ3RoKTsKICAgICAgICAg\nICAgICAgIF9hbGxMaXN0aW5nRmllbGRzID0gbGlzdGluZzsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2FsbExpc3RpbmdGaWVs\nZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBmaWVsZHMg\nZGVmaW5lZCBieSB0aGlzIGNsYXNzIGluIHRoZSBvcmRlciB0aGV5IGFyZSBs\naXN0ZWQKICAgICAqIGluIHRoZSBtZXRhZGF0YSBmaWxlLiBVbmxpc3RlZCBm\naWVsZHMgYXJlIHBsYWNlZCBhZnRlciBsaXN0ZWQgb25lcy4KICAgICAqIFRo\naXMgYXJyYXkgaW5jbHVkZXMgZGVjbGFyZWQgdHJhbnNhY3Rpb25hbCBhbmQg\ndW5tYW5hZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHVibGljIEZpZWxkTWV0\nYURhdGFbXSBnZXREZWZpbmVkRmllbGRzSW5MaXN0aW5nT3JkZXIoKSB7CiAg\nICAgICAgaWYgKF9saXN0aW5nRmllbGRzID09IG51bGwpIHsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IGdldEZpZWxkcygpOwogICAg\nICAgICAgICBMaXN0IGRlZmluZWQgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5s\nZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxk\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0u\nZ2V0RGVmaW5pbmdNZXRhRGF0YSgpID09IHRoaXMpCiAgICAgICAgICAgICAg\nICAgICAgZGVmaW5lZC5hZGQoZmllbGRzW2ldKTsKICAgICAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIHVubWdkID0gZ2V0RGVjbGFyZWRVbm1hbmFnZWRGaWVs\nZHMoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YVtdIGxpc3RpbmcgPSBf\ncmVwb3MubmV3RmllbGRNZXRhRGF0YUFycmF5CiAgICAgICAgICAgICAgICAo\nZGVmaW5lZC5zaXplKCkgKyB1bm1nZC5sZW5ndGgpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGRlZmluZWQuc2l6ZSgpOyBpKyspCiAgICAg\nICAgICAgICAgICBsaXN0aW5nW2ldID0gKEZpZWxkTWV0YURhdGEpIGRlZmlu\nZWQuZ2V0KGkpOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KHVubWdk\nLCAwLCBsaXN0aW5nLCBkZWZpbmVkLnNpemUoKSwgdW5tZ2QubGVuZ3RoKTsK\nICAgICAgICAgICAgQXJyYXlzLnNvcnQobGlzdGluZywgTGlzdGluZ09yZGVy\nQ29tcGFyYXRvci5nZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgX2xpc3Rp\nbmdGaWVsZHMgPSBsaXN0aW5nOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nX2xpc3RpbmdGaWVsZHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbmFt\nZSBvZiB0aGUgZGF0YWNhY2hlIHRvIHVzZSBmb3IgdGhpcyBjbGFzcywgb3Ig\nbnVsbCBpZiBub25lLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldERh\ndGFDYWNoZU5hbWUoKSB7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVx\ndWFscyhfY2FjaGVOYW1lKSkgewogICAgICAgICAgICBpZiAoX3N1cGVyICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfY2FjaGVOYW1lID0gZ2V0UENTdXBl\ncmNsYXNzTWV0YURhdGEoKS5nZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBEYXRhQ2Fj\naGUuTkFNRV9ERUZBVUxUOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Nh\nY2hlTmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY2FjaGUg\nbmFtZSBmb3IgdGhpcyBjbGFzcy4gU2V0IHRvIG51bGwgdG8gZGlzYWJsZSBj\nYWNoaW5nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREYXRhQ2FjaGVO\nYW1lKFN0cmluZyBuYW1lKSB7CiAgICAgICAgX2NhY2hlTmFtZSA9IG5hbWU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2FjaGUgdGltZW91dCBmb3Ig\ndGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVzIG5vIHRpbWVvdXQuCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0RGF0YUNhY2hlVGltZW91dCgpIHsKICAgICAg\nICBpZiAoX2NhY2hlVGltZW91dCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSkgewog\nICAgICAgICAgICBpZiAoX3N1cGVyICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBfY2FjaGVUaW1lb3V0ID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKS4K\nICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ2FjaGVUaW1lb3V0KCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIF9jYWNoZVRpbWVvdXQg\nPSBfcmVwb3MuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICAgICAg\nICAgIGdldERhdGFDYWNoZVRpbWVvdXQoKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIF9jYWNoZVRpbWVvdXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgY2FjaGUgdGltZW91dCBmb3IgdGhpcyBjbGFzcy4gLTEgaW5kaWNhdGVz\nIG5vIHRpbWVvdXQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGFD\nYWNoZVRpbWVvdXQoaW50IHRpbWVvdXQpIHsKICAgICAgICBfY2FjaGVUaW1l\nb3V0ID0gdGltZW91dDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZGF0YSBjYWNoZSBmb3IgdGhpcyBjbGFzcywgb3IgbnVsbCBpZiBpdCBp\ncyBub3QgY2FjaGFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBEYXRhQ2FjaGUg\nZ2V0RGF0YUNhY2hlKCkgewogICAgICAgIFN0cmluZyBuYW1lID0gZ2V0RGF0\nYUNhY2hlTmFtZSgpOwogICAgICAgIGlmIChuYW1lID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiBfcmVwb3MuZ2V0\nQ29uZmlndXJhdGlvbigpLmdldERhdGFDYWNoZU1hbmFnZXJJbnN0YW5jZSgp\nLgogICAgICAgICAgICBnZXREYXRhQ2FjaGUobmFtZSwgdHJ1ZSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGluc3RhbmNlcyBhcmUgZGV0YWNo\nYWJsZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNEZXRhY2hhYmxl\nKCkgewogICAgICAgIGlmIChfZGV0YWNoYWJsZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChfc3VwZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9k\nZXRhY2hhYmxlID0gKGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuaXNEZXRh\nY2hhYmxlKCkpCiAgICAgICAgICAgICAgICAgICAgPyBCb29sZWFuLlRSVUUg\nOiBCb29sZWFuLkZBTFNFOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBfZGV0YWNoYWJsZSA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfZGV0YWNoYWJsZS5ib29sZWFuVmFsdWUoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgaW5zdGFuY2VzIGFyZSBkZXRh\nY2hhYmxlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXREZXRhY2hhYmxl\nKGJvb2xlYW4gZGV0YWNoYWJsZSkgewogICAgICAgIF9kZXRhY2hhYmxlID0g\nKGRldGFjaGFibGUpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2gg\nc3RhdGUgZmllbGQsIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZyBnZXREZXRhY2hlZFN0YXRlKCkgewogICAgICAgIGlmIChE\nRUZBVUxUX1NUUklORy5lcXVhbHMoX2RldGFjaFN0YXRlKSkgewogICAgICAg\nICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuaXNE\nZXRhY2hhYmxlKCkgPT0gaXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAg\nICBfZGV0YWNoU3RhdGUgPSBzdXAuZ2V0RGV0YWNoZWRTdGF0ZSgpOwogICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEJvb2xlYW4gdXNlID0g\ndXNlc0RldGFjaGVkU3RhdGUoU1lOVEhFVElDLCB0cnVlKTsKICAgICAgICAg\nICAgICAgIF9kZXRhY2hTdGF0ZSA9IChCb29sZWFuLkZBTFNFLmVxdWFscyh1\nc2UpKSA/IG51bGwgOiBTWU5USEVUSUM7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIF9kZXRhY2hTdGF0ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkZXRhY2ggc3RhdGUgZmllbGQs\nIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nRGV0YWNoZWRTdGF0ZShTdHJpbmcgZmllbGQpIHsKICAgICAgICBfZGV0YWNo\nU3RhdGUgPSBmaWVsZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZGV0YWNoIHN0YXRlIGZpZWxkLCBvciBudWxsIGlmIG5vbmUuCiAgICAg\nKi8KICAgIHB1YmxpYyBGaWVsZCBnZXREZXRhY2hlZFN0YXRlRmllbGQoKSB7\nCiAgICAgICAgLy8gbm8gY2FjaGluZzsgb25seSB1c2VkIGF0IGVuaGFuY2Vt\nZW50CiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IGdldERldGFjaGVkU3Rh\ndGUoKTsKICAgICAgICBpZiAoZmllbGROYW1lID09IG51bGwgfHwgU1lOVEhF\nVElDLmVxdWFscyhmaWVsZE5hbWUpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgRmllbGQgZiA9IFJlZmxlY3Rpb24uZmluZEZpZWxkKF90\neXBlLCBmaWVsZE5hbWUsIGZhbHNlKTsKICAgICAgICBpZiAoZiAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gZjsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgIF9sb2MuZ2V0KCJuby1kZXRhY2gtc3RhdGUiLCBmaWVsZE5hbWUsIF90\neXBlKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGFuIGluc3Rh\nbmNlIG9mIHRoaXMgdHlwZSBoYXMgZGV0YWNoZWQgc3RhdGUuCiAgICAgKgog\nICAgICogQHJldHVybiB0cnVlIGlmIGEgZGV0YWNoZWQgaW5zdGFuY2UgbXVz\ndCBoYXZlIGRldGFjaGVkIHN0YXRlLCBmYWxzZQogICAgICogaWYgaXQgZG9l\ncyBub3QsIGFuZCBudWxsIGlmIGl0IG1heSB1c2UgYQogICAgICogbWFudWFs\nbHktY29uc3RydWN0ZWQgaW5zdGFuY2Ugd2l0aG91dCBkZXRhY2hlZCBzdGF0\nZQogICAgICovCiAgICBwdWJsaWMgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0\nZSgpIHsKICAgICAgICAvLyBubyBuZWVkIHRvIGxldCBjb25mIGRpc2FsbG93\nIGJlY2F1c2UgaXQncyB0YWtlbiBpbnRvIGFjY291bnQgaW4KICAgICAgICAv\nLyBnZXREZXRhY2hlZFN0YXRlKCkgY2FsbAogICAgICAgIHJldHVybiB1c2Vz\nRGV0YWNoZWRTdGF0ZShnZXREZXRhY2hlZFN0YXRlKCksIGZhbHNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhp\ncyB0eXBlIGhhcyBkZXRhY2hlZCBzdGF0ZSwgYXNzdW1pbmcgdGhlIGdpdmVu\nCiAgICAgKiBkZXRhY2hlZCBzdGF0ZSBmaWVsZC4KICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgYSBkZXRhY2hlZCBpbnN0YW5jZSBtdXN0IGhhdmUg\nZGV0YWNoZWQgc3RhdGUsIGZhbHNlCiAgICAgKiBpZiBpdCBkb2VzIG5vdCwg\nYW5kIG51bGwgaWYgaXQgbWF5IHVzZSBhCiAgICAgKiBtYW51YWxseS1jb25z\ndHJ1Y3RlZCBpbnN0YW5jZSB3aXRob3V0IGRldGFjaGVkIHN0YXRlCiAgICAg\nKi8KICAgIHByaXZhdGUgQm9vbGVhbiB1c2VzRGV0YWNoZWRTdGF0ZShTdHJp\nbmcgZGV0YWNoZWRGaWVsZCwKICAgICAgICBib29sZWFuIGNvbmZEaXNhbGxv\nd3MpIHsKICAgICAgICBpZiAoIWlzRGV0YWNoYWJsZSgpKQogICAgICAgICAg\nICByZXR1cm4gQm9vbGVhbi5GQUxTRTsKCiAgICAgICAgLy8gaWYgd2UgZGVj\nbGFyZSBhIGRldGFjaGVkIHN0YXRlIGZpZWxkLCBoYXZlIHRvIHVzZSBpdAog\nICAgICAgIGlmIChkZXRhY2hlZEZpZWxkID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBCb29sZWFuLkZBTFNFOwogICAgICAgIGlmICghU1lOVEhFVElD\nLmVxdWFscyhkZXRhY2hlZEZpZWxkKSkKICAgICAgICAgICAgcmV0dXJuIEJv\nb2xlYW4uVFJVRTsKCiAgICAgICAgLy8gYWxsb3cgY29uZiB0byBkaXNhbGxv\ndwogICAgICAgIGlmIChjb25mRGlzYWxsb3dzICYmICFfcmVwb3MuZ2V0Q29u\nZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXREZXRhY2hTdGF0ZUluc3Rh\nbmNlKCkuZ2V0RGV0YWNoZWRTdGF0ZUZpZWxkKCkpCiAgICAgICAgICAgIHJl\ndHVybiBCb29sZWFuLkZBTFNFOwoKICAgICAgICAvLyBoYXZlIHRvIHVzZSBk\nZXRhY2hlZCBzdGF0ZSB0byBzdG9yZSBkYXRhc3RvcmUgaWQKICAgICAgICBp\nZiAoZ2V0SWRlbnRpdHlUeXBlKCkgPT0gSURfREFUQVNUT1JFKQogICAgICAg\nICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwoKICAgICAgICAvLyBhbGxvdyBk\nZXRhY2hlZCBzdGF0ZSB1c2UsIGJ1dCBkb24ndCByZXF1aXJlCiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBjYWNo\nZWQgZmllbGQgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xl\nYXJBbGxGaWVsZENhY2hlKCkgewogICAgICAgIF9hbGxGaWVsZHMgPSBudWxs\nOwogICAgICAgIF9hbGxERkdGaWVsZHMgPSBudWxsOwogICAgICAgIF9hbGxQ\nS0ZpZWxkcyA9IG51bGw7CiAgICAgICAgX2RlZmluZWRGaWVsZHMgPSBudWxs\nOwogICAgICAgIF9saXN0aW5nRmllbGRzID0gbnVsbDsKICAgICAgICBfYWxs\nTGlzdGluZ0ZpZWxkcyA9IG51bGw7CiAgICAgICAgX2ZpZWxkRGF0YVRhYmxl\nID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGRlZmluZWQg\nZmllbGQgZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJE\nZWZpbmVkRmllbGRDYWNoZSgpIHsKICAgICAgICBfZGVmaW5lZEZpZWxkcyA9\nIG51bGw7CiAgICAgICAgX2xpc3RpbmdGaWVsZHMgPSBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogQ2xlYXIgY2FjaGVkIGZpZWxkIGRhdGEuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGNsZWFyRmllbGRDYWNoZSgpIHsKICAg\nICAgICBjbGVhckFsbEZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRzID0g\nbnVsbDsKICAgICAgICBfdW5tZ2RGaWVsZHMgPSBudWxsOwogICAgICAgIF92\nZXJzaW9uSWR4ID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDbGVhciBjYWNoZWQgc3ViY2xhc3MgZGF0YS4KICAgICAqLwog\nICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJTdWJjbGFzc0NhY2hlKCkgewogICAg\nICAgIF9zdWJzID0gbnVsbDsKICAgICAgICBfc3ViTWV0YXMgPSBudWxsOwog\nICAgICAgIF9tYXBTdWJNZXRhcyA9IG51bGw7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDbGVhciBpbXBsIGRhdGEgYW5kIGludGVybWVkaWF0ZSBkYXRhIHRh\nYmxlLgogICAgICovCiAgICB2b2lkIGNsZWFyRXh0cmFGaWVsZERhdGFUYWJs\nZSgpIHsKICAgICAgICBfZmllbGREYXRhVGFibGUgPSBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogQ2FjaGUgZmllbGQgYXJyYXlzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgY2FjaGVGaWVsZHMoKSB7CiAgICAgICAgZ2V0Rmll\nbGRzKCk7CiAgICAgICAgZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIF90\neXBlLmdldE5hbWUoKS5oYXNoQ29kZSgpOwogICAgfQoKICAgIHB1YmxpYyBi\nb29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3Ro\nZXIgPT0gdGhpcykKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\naWYgKCEob3RoZXIgaW5zdGFuY2VvZiBDbGFzc01ldGFEYXRhKSkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfdHlwZSA9PSAo\nKENsYXNzTWV0YURhdGEpIG90aGVyKS5nZXREZXNjcmliZWRUeXBlKCk7CiAg\nICB9CgogICAgcHVibGljIGludCBjb21wYXJlVG8oT2JqZWN0IG90aGVyKSB7\nCiAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAgIHJldHVy\nbiAwOwogICAgICAgIHJldHVybiBfdHlwZS5nZXROYW1lKCkuY29tcGFyZVRv\nKCgoQ2xhc3NNZXRhRGF0YSkgb3RoZXIpLgogICAgICAgICAgICBnZXREZXNj\ncmliZWRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiBnZXREZXNjcmliZWRU\neXBlKCkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwogICAgLy8gUmVzb2x2ZSBhbmQgdmFsaWRhdGUKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogVGhlIHJlc29s\ndmUgbW9kZSBmb3IgdGhpcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRSZXNvbHZlKCkgewogICAgICAgIHJldHVybiBfcmVzTW9kZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSByZXNvbHZlIG1vZGUgZm9yIHRo\naXMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFJlc29s\ndmUoaW50IG1vZGUpIHsKICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGUgcmVzb2x2ZSBtb2RlIGZvciB0aGlzIG1l\ndGFkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRSZXNvbHZlKGlu\ndCBtb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9E\nRV9OT05FKQogICAgICAgICAgICBfcmVzTW9kZSA9IG1vZGU7CiAgICAgICAg\nZWxzZSBpZiAob24pCiAgICAgICAgICAgIF9yZXNNb2RlIHw9IG1vZGU7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBfcmVzTW9kZSAmPSB+bW9kZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc29sdmUgYW5kIHZhbGlkYXRlIG1ldGFk\nYXRhLiBSZXR1cm4gdHJ1ZSBpZiBhbHJlYWR5IHJlc29sdmVkLgogICAgICov\nCiAgICBwdWJsaWMgYm9vbGVhbiByZXNvbHZlKGludCBtb2RlKSB7CiAgICAg\nICAgaWYgKChfcmVzTW9kZSAmIG1vZGUpID09IG1vZGUpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIGludCBjdXIgPSBfcmVzTW9kZTsKICAg\nICAgICBfcmVzTW9kZSB8PSBtb2RlOwoKICAgICAgICBpbnQgdmFsID0gX3Jl\ncG9zLmdldFZhbGlkYXRlKCk7CiAgICAgICAgYm9vbGVhbiBydW50aW1lID0g\nKHZhbCAmIF9yZXBvcy5WQUxJREFURV9SVU5USU1FKSAhPSAwOwogICAgICAg\nIGJvb2xlYW4gdmFsaWRhdGUgPQogICAgICAgICAgICAhSW1wbEhlbHBlci5p\nc01hbmFnZWRUeXBlKGdldFJlcG9zaXRvcnkoKS5nZXRDb25maWd1cmF0aW9u\nKCksIF90eXBlKQogICAgICAgICAgICB8fCAodmFsICYgTWV0YURhdGFSZXBv\nc2l0b3J5LlZBTElEQVRFX1VORU5IQU5DRUQpID09IDA7CgogICAgICAgIC8v\nIHdlIG9ubHkgZG8gYW55IGFjdGlvbnMgZm9yIG1ldGFkYXRhIG1vZGUKICAg\nICAgICBpZiAoKG1vZGUgJiBNT0RFX01FVEEpICE9IDAgJiYgKGN1ciAmIE1P\nREVfTUVUQSkgPT0gMCkgewogICAgICAgICAgICByZXNvbHZlTWV0YShydW50\naW1lKTsKICAgICAgICAgICAgaWYgKHZhbGlkYXRlICYmICh2YWwgJiBfcmVw\nb3MuVkFMSURBVEVfTUVUQSkgIT0gMCkKICAgICAgICAgICAgICAgIHZhbGlk\nYXRlTWV0YShydW50aW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKChtb2Rl\nICYgTU9ERV9NQVBQSU5HKSAhPSAwICYmIChjdXIgJiBNT0RFX01BUFBJTkcp\nID09IDApIHsKICAgICAgICAgICAgcmVzb2x2ZU1hcHBpbmcocnVudGltZSk7\nCiAgICAgICAgICAgIGlmICh2YWxpZGF0ZSAmJiAodmFsICYgX3JlcG9zLlZB\nTElEQVRFX01BUFBJTkcpICE9IDApCiAgICAgICAgICAgICAgICB2YWxpZGF0\nZU1hcHBpbmcocnVudGltZSk7CiAgICAgICAgfQogICAgICAgIGlmICgobW9k\nZSAmIE1PREVfTUFQUElOR19JTklUKSAhPSAwICYmIChjdXIgJiBNT0RFX01B\nUFBJTkdfSU5JVCkgPT0gMCkKICAgICAgICAgICAgaW5pdGlhbGl6ZU1hcHBp\nbmcoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXNvbHZlIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCByZXNvbHZlTWV0YShib29sZWFuIHJ1bnRpbWUpIHsKICAgICAgICBi\nb29sZWFuIGVtYmVkID0gX293bmVyICE9IG51bGwgJiYgX293bmVyLmdldERl\nY2xhcmVkVHlwZSgpID09IF90eXBlOwogICAgICAgIExvZyBsb2cgPSBfcmVw\nb3MuZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICBsb2cudHJhY2UoX2xvYy5nZXQoKGVtYmVkKSA/ICJy\nZXNvbHZlLWVtYmVkLW1ldGEiIDogInJlc29sdmUtbWV0YSIsCiAgICAgICAg\nICAgICAgICB0aGlzICsgIkAiICsgU3lzdGVtLmlkZW50aXR5SGFzaENvZGUo\ndGhpcykpKTsKCiAgICAgICAgaWYgKHJ1bnRpbWUgJiYgIV90eXBlLmlzSW50\nZXJmYWNlKCkgJiYKICAgICAgICAgICAgIUltcGxIZWxwZXIuaXNNYW5hZ2Vk\nVHlwZShnZXRSZXBvc2l0b3J5KCkuZ2V0Q29uZmlndXJhdGlvbigpLF90eXBl\nKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJub3QtZW5oYW5jZWQiLCBfdHlwZSkpOwoKICAgICAgICAvLyBh\ncmUgd2UgdGhlIHRhcmdldCBvZiBhbiBlbWJlZGRlZCB2YWx1ZT8KICAgICAg\nICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgaWYgKF9vd25lci5nZXRGaWVs\nZE1ldGFEYXRhKCkuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAg\nICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpLmlzQXNzaWduYWJsZUZyb20oX3R5\ncGUpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJyZWN1cnNlLWVtYmVkIiwgX293bmVyKSk7CgogICAg\nICAgICAgICAvLyBjb3B5IGluZm8gZnJvbSB0aGUgInJlYWwiIG1ldGFkYXRh\nIGZvciB0aGlzIHR5cGUKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRh\nID0gX3JlcG9zLmdldE1ldGFEYXRhKF90eXBlLCBfbG9hZGVyLCB0cnVlKTsK\nICAgICAgICAgICAgbWV0YS5yZXNvbHZlKE1PREVfTUVUQSk7CiAgICAgICAg\nICAgIGNvcHkodGhpcywgbWV0YSk7CiAgICAgICAgICAgIF9lbWJlZGRlZCA9\nIEJvb2xlYW4uRkFMU0U7IC8vIGVtYmVkZGVkIGluc3RhbmNlIGlzbid0IGVt\nYmVkZGVkLW9ubHkKICAgICAgICB9CgogICAgICAgIC8vIG1ha2Ugc3VyZSBz\ndXBlcmNsYXNzIGlzIHJlc29sdmVkCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChz\ndXAgIT0gbnVsbCkgewogICAgICAgICAgICBzdXAucmVzb2x2ZShNT0RFX01F\nVEEpOwogICAgICAgICAgICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgICAg\nIC8vIGVtYmVkZGVkIGluc3RhbmNlIGFsd2F5cyByZWRlZmluZSBhbGwgc3Vw\nZXJjbGFzcyBmaWVsZHMKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBzdXBzID0gc3VwLmdldEZpZWxkcygpOwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBzdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKF9zdXBGaWVsZE1hcCA9PSBudWxsCiAgICAgICAg\nICAgICAgICAgICAgICAgIHx8ICFfc3VwRmllbGRNYXAuY29udGFpbnNLZXko\nc3Vwc1tpXS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGFkZERlZmluZWRTdXBlcmNsYXNzRmllbGQoc3Vwc1tpXS5nZXROYW1lKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBzW2ldLmdldERlY2xh\ncmVkVHlwZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vwc1tp\nXS5nZXREZWNsYXJpbmdUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gcmVzb2x2ZSBmaWVsZHMgYW5kIHJlbW92ZSBpbnZhbGlkcwog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gX2ZpZWxkTWFwLnZhbHVlcygpLml0ZXJhdG9yKCk7IGl0ci5o\nYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIC8vIG9ubHkgcGFzcyBvbiBtZXRh\nZGF0YSByZXNvbHZlIG1vZGUgc28gdGhhdCBtZXRhZGF0YSBpcyBhbHdheXMK\nICAgICAgICAgICAgLy8gcmVzb2x2ZWQgYmVmb3JlIGFueSBvdGhlciByZXNv\nbHZlIG1vZGVzIG91ciBzdWJjbGFzc2VzIHBhc3MgYWxvbmcKICAgICAgICAg\nICAgZm1kID0gKEZpZWxkTWV0YURhdGEpIGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGZtZC5yZXNvbHZlKE1PREVfTUVUQSk7CgogICAgICAgICAgICBpZiAo\nIWZtZC5pc0V4cGxpY2l0KCkKICAgICAgICAgICAgICAgICYmIChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PQkpFQ1QKICAgICAg\nICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2\nYVR5cGVzLlBDX1VOVFlQRUQKICAgICAgICAgICAgICAgIHx8IChmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5BUlJBWQogICAgICAg\nICAgICAgICAgJiYgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkKICAgICAgICAgICAgICAgID09IEphdmFUeXBlcy5PQkpFQ1QpKSkg\newogICAgICAgICAgICAgICAgX3JlcG9zLmdldExvZygpLndhcm4oX2xvYy5n\nZXQoInJtLWZpZWxkIiwgZm1kKSk7CiAgICAgICAgICAgICAgICBpZiAoZm1k\nLmdldExpc3RpbmdJbmRleCgpICE9IC0xKQogICAgICAgICAgICAgICAgICAg\nIGZtZC5zZXRNYW5hZ2VtZW50KGZtZC5NQU5BR0VfTk9ORSk7CiAgICAgICAg\nICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgp\nOwogICAgICAgICAgICAgICAgY2xlYXJGaWVsZENhY2hlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGVtYmVkZGVkIGluc3RhbmNl\ncyBtdXN0IGVtYmVkIGFsbCBzdXBlcmNsYXNzIGZpZWxkcyB0b28KICAgICAg\nICBpZiAoZW1iZWQpIHsKICAgICAgICAgICAgY2xlYXJBbGxGaWVsZENhY2hl\nKCk7CiAgICAgICAgICAgIHJlc29sdmVEZWZpbmVkU3VwZXJjbGFzc0ZpZWxk\ncygpOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhpcyBlbnN1cmVzIHRoYXQg\nYWxsIGZpZWxkIGluZGV4ZXMgZ2V0IHNldCB3aGVuIGZpZWxkcyBhcmUgY2Fj\naGVkCiAgICAgICAgY2FjaGVGaWVsZHMoKTsKCiAgICAgICAgLy8gcmVzb2x2\nZSBsaWZlY3ljbGUgbWV0YWRhdGEgbm93IHRvIHByZXZlbnQgbGF6eSB0aHJl\nYWRpbmcgcHJvYmxlbXMKICAgICAgICBfbGlmZU1ldGEucmVzb2x2ZSgpOwoK\nICAgICAgICAvLyByZWNvcmQgaW1wbGVtZW50cyBpbiB0aGUgcmVwb3NpdG9y\neQogICAgICAgIGlmIChfaW50ZXJmYWNlcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3IgaXQgPSBfaW50ZXJmYWNlcy5pdGVyYXRvcigp\nOyBpdC5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgX3JlcG9zLmFkZERl\nY2xhcmVkSW50ZXJmYWNlSW1wbCh0aGlzLCAoQ2xhc3MpIGl0Lm5leHQoKSk7\nCiAgICAgICAgfQoKICAgICAgICAvLyByZXNvbHZlIGZldGNoIGdyb3Vwcwog\nICAgICAgIGlmIChfZmdNYXAgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJ\ndGVyYXRvciBpdHIgPSBfZmdNYXAudmFsdWVzKCkuaXRlcmF0b3IoKTsgaXRy\nLmhhc05leHQoKTspCiAgICAgICAgICAgICAgICAoKEZldGNoR3JvdXApIGl0\nci5uZXh0KCkpLnJlc29sdmUoKTsKCiAgICAgICAgaWYgKCFlbWJlZCAmJiBf\ndHlwZS5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAgIGlmIChfaW50ZXJm\nYWNlICE9IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW50ZXJmYWNlIiwgX3R5\ncGUpKTsKCiAgICAgICAgICAgIGlmIChydW50aW1lKSB7CiAgICAgICAgICAg\nICAgICBfaW1wbCA9IF9yZXBvcy5nZXRJbXBsR2VuZXJhdG9yKCkuY3JlYXRl\nSW1wbCh0aGlzKTsKICAgICAgICAgICAgICAgIF9yZXBvcy5zZXRJbnRlcmZh\nY2VJbXBsKHRoaXMsIF9pbXBsKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gaWYgdGhpcyBpcyBydW50aW1lLCBjcmVhdGUgYSBwYyBp\nbnN0YW5jZSBhbmQgc2NhbiBpdCBmb3IgY29tcGFyYXRvcnMKICAgICAgICBp\nZiAocnVudGltZSAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChfdHlwZS5nZXRN\nb2RpZmllcnMoKSkpIHsKICAgICAgICAgICAgUHJveHlTZXR1cFN0YXRlTWFu\nYWdlciBzbSA9IG5ldyBQcm94eVNldHVwU3RhdGVNYW5hZ2VyKCk7CiAgICAg\nICAgICAgIHNtLnNldFByb3h5RGF0YShQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNl\nKF90eXBlLCBzbSwgZmFsc2UpLCB0aGlzKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBWYWxpZGF0ZSByZXNvbHZlZCBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNZXRhKGJvb2xlYW4g\ncnVudGltZSkgewogICAgICAgIHZhbGlkYXRlRGF0YUNhY2hlKCk7CiAgICAg\nICAgdmFsaWRhdGVEZXRhY2hhYmxlKCk7CiAgICAgICAgdmFsaWRhdGVFeHRl\nbnNpb25LZXlzKCk7CiAgICAgICAgdmFsaWRhdGVJZGVudGl0eSgpOwogICAg\nICAgIHZhbGlkYXRlQWNjZXNzVHlwZSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVzb2x2ZSBtYXBwaW5nIGRhdGEuIExvZ3MgcmVzb2x2ZSBtZXNzYWdl\nIGFuZCByZXNvbHZlcyBzdXBlciBieSBkZWZhdWx0LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCByZXNvbHZlTWFwcGluZyhib29sZWFuIHJ1bnRpbWUp\nIHsKICAgICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJyZXNvbHZlLW1hcHBpbmciLCB0aGlzICsgIkAiCiAg\nICAgICAgICAgICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMp\nKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSBzdXBlcmNsYXNzIGlzIHJlc29s\ndmVkIGZpcnN0CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpOwogICAgICAgIGlmIChzdXAgIT0gbnVsbCkK\nICAgICAgICAgICAgc3VwLnJlc29sdmUoTU9ERV9NQVBQSU5HKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFZhbGlkYXRlIG1hcHBpbmcgZGF0YS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIHZvaWQgdmFsaWRhdGVNYXBwaW5nKGJvb2xlYW4g\ncnVudGltZSkgewogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBt\nYXBwaW5nLiBMb2dzIGluaXQgbWVzc2FnZSBieSBkZWZhdWx0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXplTWFwcGluZygpIHsKICAg\nICAgICBMb2cgbG9nID0gX3JlcG9zLmdldExvZygpOwogICAgICAgIGlmIChs\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJpbml0LW1hcHBpbmciLCB0aGlzICsgIkAiCiAgICAgICAgICAg\nICAgICArIFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSBkYXRhIGNhY2hlIHNldHRpbmdz\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVEYXRhQ2FjaGUo\nKSB7CiAgICAgICAgaW50IHRpbWVvdXQgPSBnZXREYXRhQ2FjaGVUaW1lb3V0\nKCk7CiAgICAgICAgaWYgKHRpbWVvdXQgPCAtMSB8fCB0aW1lb3V0ID09IDAp\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiY2FjaGUtdGltZW91dC1pbnZhbGlkIiwKICAgICAgICAgICAgICAg\nIF90eXBlLCBTdHJpbmcudmFsdWVPZih0aW1lb3V0KSkpOwoKICAgICAgICBp\nZiAoX3N1cGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICBTdHJpbmcgY2FjaGUgPSBnZXREYXRhQ2FjaGVOYW1lKCk7CiAgICAgICAg\naWYgKGNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgU3RyaW5nIHN1cGVyQ2FjaGUgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpLmdldERhdGFDYWNoZU5hbWUoKTsKICAgICAgICBpZiAoIVN0cmluZ1V0\naWxzLmVxdWFscyhjYWNoZSwgc3VwZXJDYWNoZSkpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiY2FjaGUtbmFt\nZXMiLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAgICAgIHsgX3R5cGUsIGNh\nY2hlLCBfc3VwZXIsIHN1cGVyQ2FjaGUgfSkpOwogICAgfQoKICAgIC8qKgog\nICAgICogQXNzZXJ0IHRoYXQgdGhlIGlkZW50aXR5IGhhbmRsaW5nIGZvciB0\naGlzIGNsYXNzIGlzIHZhbGlkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ndmFsaWRhdGVJZGVudGl0eSgpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgaWRl\nbnRpdHkgdHlwZXMgYXJlIGNvbnNpc3RlbnQKICAgICAgICBDbGFzc01ldGFE\nYXRhIHN1cCA9IGdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAg\naW50IGlkID0gZ2V0SWRlbnRpdHlUeXBlKCk7CiAgICAgICAgaWYgKHN1cCAh\nPSBudWxsICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBJRF9VTktOT1dO\nCiAgICAgICAgICAgICYmIHN1cC5nZXRJZGVudGl0eVR5cGUoKSAhPSBpZCkK\nICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJpZC10eXBlcyIsIF90eXBlKSk7CgogICAgICAgIC8vIGNoZWNrIGZv\nciB0aGluZ3MgdGhlIGRhdGEgc3RvcmUgZG9lc24ndCBzdXBwb3J0CiAgICAg\nICAgQ29sbGVjdGlvbiBvcHRzID0gX3JlcG9zLmdldENvbmZpZ3VyYXRpb24o\nKS5zdXBwb3J0ZWRPcHRpb25zKCk7CiAgICAgICAgaWYgKGlkID09IElEX0FQ\nUExJQ0FUSU9OCiAgICAgICAgICAgICYmICFvcHRzLmNvbnRhaW5zKE9wZW5K\nUEFDb25maWd1cmF0aW9uLk9QVElPTl9JRF9BUFBMSUNBVElPTikpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJhcHBpZC1ub3Qtc3VwcG9ydGVkIiwKICAgICAgICAgICAgICAgIF90\neXBlKSk7CiAgICAgICAgfQogICAgICAgIGlmIChpZCA9PSBJRF9EQVRBU1RP\nUkUKICAgICAgICAgICAgJiYgIW9wdHMuY29udGFpbnMoT3BlbkpQQUNvbmZp\nZ3VyYXRpb24uT1BUSU9OX0lEX0RBVEFTVE9SRSkpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAg\nICAgICAgICAgICAoImRhdGFzdG9yZWlkLW5vdC1zdXBwb3J0ZWQiLCBfdHlw\nZSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlkID09IElEX0FQUExJQ0FU\nSU9OKSB7CiAgICAgICAgICAgIGlmIChfaWRTdHJhdGVneSAhPSBWYWx1ZVN0\ncmF0ZWdpZXMuTk9ORSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYXBwaWQtc3RyYXRlZ3kiLCBfdHlw\nZSkpOwogICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3MoKTsKICAgICAg\nICB9IGVsc2UgaWYgKGlkICE9IElEX1VOS05PV04pCiAgICAgICAgICAgIHZh\nbGlkYXRlTm9QS0ZpZWxkcygpOwoKICAgICAgICBpbnQgc3RyYXRlZ3kgPSBn\nZXRJZGVudGl0eVN0cmF0ZWd5KCk7CiAgICAgICAgaWYgKHN0cmF0ZWd5ID09\nIFZhbHVlU3RyYXRlZ2llcy5TRVFVRU5DRQogICAgICAgICAgICAmJiBnZXRJ\nZGVudGl0eVNlcXVlbmNlTmFtZSgpID09IG51bGwpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5h\nbWUiLCBfdHlwZSkpOwoKICAgICAgICBWYWx1ZVN0cmF0ZWdpZXMuYXNzZXJ0\nU3VwcG9ydGVkKHN0cmF0ZWd5LCB0aGlzLAogICAgICAgICAgICAiZGF0YXN0\nb3JlIGlkZW50aXR5IHN0cmF0ZWd5Iik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYWtlIHN1cmUgdGhlIGFwcGxpY2F0aW9uIGlkZW50aXR5IGNsYXNzIGlz\nIHZhbGlkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVBcHBJ\nZENsYXNzKCkgewogICAgICAgIC8vIGJhc2UgdHlwZXMgbXVzdCBkZWNsYXJl\nIGFuIG9pZCBjbGFzcyBpZiBub3Qgc2luZ2xlLWZpZWxkIGlkZW50aXR5CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGdldFByaW1hcnlLZXlGaWVs\nZHMoKTsKICAgICAgICBpZiAoZ2V0T2JqZWN0SWRUeXBlKCkgPT0gbnVsbCkg\newogICAgICAgICAgICBpZiAocGtzLmxlbmd0aCA9PSAxKQogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1\nbnN1cHBvcnRlZC1pZC10eXBlIiwKICAgICAgICAgICAgICAgICAgICBfdHlw\nZSwgcGtzWzBdLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBwa3Nb\nMF0uZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgibm8taWQt\nY2xhc3MiLCBfdHlwZSkpOwogICAgICAgIH0KICAgICAgICBpZiAoX29iamVj\ndElkID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYg\nKGlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgaWYgKHBrc1sw\nXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkgewog\nICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBlbWJlZCA9IHBrc1swXS5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0\nZUFwcElkQ2xhc3NNZXRob2RzKGVtYmVkLmdldERlc2NyaWJlZFR5cGUoKSk7\nCiAgICAgICAgICAgICAgICB2YWxpZGF0ZUFwcElkQ2xhc3NQS3MoZW1iZWQs\nIGVtYmVkLmdldEZpZWxkcygpLAogICAgICAgICAgICAgICAgICAgIGVtYmVk\nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9zdXBlciAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIC8vIGNvbmNyZXRlIHN1cGVyY2xhc3Mgb2lk\ncyBtdXN0IG1hdGNoIG9yIGJlIHBhcmVudCBvZiBvdXJzCiAgICAgICAgICAg\nIENsYXNzTWV0YURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEo\nKTsKICAgICAgICAgICAgaWYgKCFzdXAuZ2V0T2JqZWN0SWRUeXBlKCkuaXNB\nc3NpZ25hYmxlRnJvbShfb2JqZWN0SWQpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJpZC1jbGFzc2Vz\nIiwKICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117IF90eXBlLCBf\nb2JqZWN0SWQsIF9zdXBlciwKICAgICAgICAgICAgICAgICAgICAgICAgc3Vw\nLmdldE9iamVjdElkVHlwZSgpIH0pKTsKCiAgICAgICAgICAgIC8vIHZhbGlk\nYXRlIHRoYXQgbm8gb3RoZXIgcGtzIGFyZSBkZWNsYXJlZCBpZiB3ZSBoYXZl\nIGEKICAgICAgICAgICAgLy8gY29uY3JldGUgUEMgc3VwZXJjbGFzcwogICAg\nICAgICAgICBpZiAoaGFzQ29uY3JldGVQQ1N1cGVyY2xhc3MoKSkKICAgICAg\nICAgICAgICAgIHZhbGlkYXRlTm9QS0ZpZWxkcygpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaWYgdGhpcyBjbGFzcyBoYXMgaXRzIG93biBvaWQgY2xhc3Ms\nIGRvIHNvbWUgbW9yZSB2YWxpZGF0aW9uCiAgICAgICAgaWYgKF9zdXBlciA9\nPSBudWxsCiAgICAgICAgICAgIHx8IF9vYmplY3RJZCAhPSBnZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLmdldE9iamVjdElkVHlwZSgpKSB7CiAgICAgICAg\nICAgIC8vIG1ha2Ugc3VyZSBub24tYWJzdHJhY3Qgb2lkIGNsYXNzZXMgb3Zl\ncnJpZGUgdGhlIHByb3BlciBtZXRob2RzCiAgICAgICAgICAgIGlmICghTW9k\naWZpZXIuaXNBYnN0cmFjdChfb2JqZWN0SWQuZ2V0TW9kaWZpZXJzKCkpKQog\nICAgICAgICAgICAgICAgdmFsaWRhdGVBcHBJZENsYXNzTWV0aG9kcyhfb2Jq\nZWN0SWQpOwoKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBhcHAgaWQg\nY2xhc3MgaGFzIGFsbCBwayBmaWVsZHMKICAgICAgICAgICAgdmFsaWRhdGVB\ncHBJZENsYXNzUEtzKHRoaXMsIHBrcywgX29iamVjdElkKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGNs\nYXNzIGhhcyBhIGNvbmNyZXRlIHBlcnNpc3RlbnQgc3VwZXJjbGFzcy4KICAg\nICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGhhc0NvbmNyZXRlUENTdXBlcmNs\nYXNzKCkgewogICAgICAgIGlmIChfc3VwZXIgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghTW9kaWZpZXIuaXNBYnN0\ncmFjdChfc3VwZXIuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZ2V0UENTdXBlcmNsYXNzTWV0YURh\ndGEoKS5oYXNDb25jcmV0ZVBDU3VwZXJjbGFzcygpOwogICAgfQoKICAgIC8q\nKgogICAgICogRW5zdXJlIHRoYXQgdGhlIHVzZXIgaGFzIG92ZXJyaWRkZW4g\ndGhlIGVxdWFscyBhbmQgaGFzaENvZGUgbWV0aG9kcywKICAgICAqIGFuZCBo\nYXMgdGhlIHByb3BlciBjb25zdHJ1Y3RvcnMuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCB2YWxpZGF0ZUFwcElkQ2xhc3NNZXRob2RzKENsYXNzIG9pZCkg\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9pZC5nZXRDb25zdHJ1Y3Rv\ncigoQ2xhc3NbXSkgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJudWxsLWNvbnMiLCBfdHlwZSkpLgogICAgICAgICAgICAg\nICAgc2V0Q2F1c2UoZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBm\nb3IgZXF1YWxzIGFuZCBoYXNoY29kZSBvdmVycmlkZXM7IGRvbid0IGVuZm9y\nY2UgaXQKICAgICAgICAvLyBmb3IgYWJzdHJhY3QgYXBwIGlkIGNsYXNzZXMs\nIHNpbmNlIHRoZXkgbWF5IG5vdCBuZWNlc3NhcmlseQogICAgICAgIC8vIGRl\nY2xhcmUgcHJpbWFyeSBrZXkgZmllbGRzCiAgICAgICAgTWV0aG9kIG1ldGhv\nZDsKICAgICAgICB0cnkgewogICAgICAgICAgICBtZXRob2QgPSBvaWQuZ2V0\nTWV0aG9kKCJlcXVhbHMiLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0p\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpLnNldEZhdGFsKHRydWUp\nOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBhYnMgPSBNb2RpZmllci5p\nc0Fic3RyYWN0KF90eXBlLmdldE1vZGlmaWVycygpKTsKICAgICAgICBpZiAo\nIWFicyAmJiBtZXRob2QuZ2V0RGVjbGFyaW5nQ2xhc3MoKSA9PSBPYmplY3Qu\nY2xhc3MpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlv\nbihfbG9jLmdldCgiZXEtbWV0aG9kIiwgX3R5cGUpKTsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgbWV0aG9kID0gb2lkLmdldE1ldGhvZCgiaGFzaENv\nZGUiLCAoQ2xhc3NbXSkgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24oZSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmICgh\nYWJzICYmIG1ldGhvZC5nZXREZWNsYXJpbmdDbGFzcygpID09IE9iamVjdC5j\nbGFzcykKICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJoYy1tZXRob2QiLCBfdHlwZSkpOwogICAgfQoKICAgIC8q\nKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgcHJpbWFyeSBrZXkgY2xhc3Mg\naGFzIGFsbCBwayBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2\nYWxpZGF0ZUFwcElkQ2xhc3NQS3MoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAg\nICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzLCBDbGFzcyBvaWQpIHsKICAgICAg\nICBpZiAoZm1kcy5sZW5ndGggPT0gMCAmJiAhTW9kaWZpZXIuaXNBYnN0cmFj\ndChtZXRhLmdldERlc2NyaWJlZFR5cGUoKS4KICAgICAgICAgICAgZ2V0TW9k\naWZpZXJzKCkpKQogICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoIm5vLXBrIiwgX3R5cGUpKTsKCiAgICAgICAgLy8g\nY2hlY2sgdGhhdCB0aGUgb2lkIHR5cGUgY29udGFpbnMgYWxsIHBrIGZpZWxk\ncwogICAgICAgIEZpZWxkIGY7CiAgICAgICAgTWV0aG9kIG07CiAgICAgICAg\nQ2xhc3MgYzsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3dpdGNoIChmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICAgICAgYyA9IGZtZHNbaV0u\nZ2V0RGVjbGFyZWRUeXBlKCkuZ2V0Q29tcG9uZW50VHlwZSgpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChjID09IGJ5dGUuY2xhc3MgfHwgYyA9PSBCeXRl\nLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IGMgPT0gY2hhci5j\nbGFzcyB8fCBjID09IENoYXJhY3Rlci5jbGFzcykgewogICAgICAgICAgICAg\nICAgICAgICAgICBjID0gZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuT0lEOiAvLyB3ZSdyZSB2YWxpZGF0aW5nIGVtYmVk\nZGVkIGZpZWxkcwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXBrLXR5cGUiLAogICAgICAg\nICAgICAgICAgICAgICAgICBmbWRzW2ldKSk7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGMgPSBmbWRzW2ldLmdldE9i\namVjdElkRmllbGRUeXBlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGlmIChtZXRhLmdldEFjY2Vzc1R5cGUoKSA9PSBBQ0NFU1NfRklFTEQpIHsK\nICAgICAgICAgICAgICAgIGYgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWQs\nIGZtZHNbaV0uZ2V0TmFtZSgpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBp\nZiAoZiA9PSBudWxsIHx8ICFmLmdldFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9t\nKGMpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4\nY2VwdGlvbihfbG9jLmdldCgiaW52YWxpZC1pZCIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIF90eXBlLCBmbWRzW2ldLmdldE5hbWUoKSkpOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKG1ldGEuZ2V0QWNjZXNzVHlwZSgpID09IEFDQ0VT\nU19QUk9QRVJUWSkgewogICAgICAgICAgICAgICAgbSA9IFJlZmxlY3Rpb24u\nZmluZEdldHRlcihvaWQsIGZtZHNbaV0uZ2V0TmFtZSgpLCBmYWxzZSk7CiAg\nICAgICAgICAgICAgICBpZiAobSA9PSBudWxsIHx8ICFtLmdldFJldHVyblR5\ncGUoKS5pc0Fzc2lnbmFibGVGcm9tKGMpKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxp\nZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ld\nLmdldE5hbWUoKSkpOwogICAgICAgICAgICAgICAgbSA9IFJlZmxlY3Rpb24u\nZmluZFNldHRlcihvaWQsIGZtZHNbaV0uZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgICAgIGZtZHNbaV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKSwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgaWYgKG0gPT0gbnVsbCB8fCBtLmdldFJl\ndHVyblR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiaW52YWxp\nZC1pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIF90eXBlLCBmbWRzW2ld\nLmdldE5hbWUoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGlzIGNsYXNzIGRvZXNu\nJ3QgZGVjbGFyZSBhbnkgcHJpbWFyeSBrZXkgZmllbGRzLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgdmFsaWRhdGVOb1BLRmllbGRzKCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGFbXSBmaWVsZHMgPSBnZXREZWNsYXJlZEZpZWxkcygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICBpZiAoZmllbGRzW2ldLmlzUHJpbWFyeUtleSgp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJiYWQtcGsiLCBmaWVsZHNbaV0pKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFzc2VydCB0aGF0IHRoaXMgY2xhc3MnIGFjY2VzcyB0eXBl\nIGlzIGFsbG93ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0\nZUFjY2Vzc1R5cGUoKSB7CiAgICAgICAgaWYgKF9hY2Nlc3NUeXBlID09IEFD\nQ0VTU19VTktOT1dOKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBzdXAgPSBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpOwog\nICAgICAgIGlmIChzdXAgIT0gbnVsbCAmJiBzdXAuZ2V0QWNjZXNzVHlwZSgp\nICE9IEFDQ0VTU19VTktOT1dOCiAgICAgICAgICAgICYmIHN1cC5nZXRBY2Nl\nc3NUeXBlKCkgIT0gX2FjY2Vzc1R5cGUgJiYKICAgICAgICAgICAgZ2V0UENT\ndXBlcmNsYXNzTWV0YURhdGEoKS5nZXRGaWVsZHMoKS5sZW5ndGggPiAwKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9j\nLmdldCgiaW5jb25zaXN0ZW50LWFjY2VzcyIsCiAgICAgICAgICAgICAgICB0\naGlzLCBzdXApKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nc3NlcnQgdGhhdCBkZXRhY2htZW50IGNvbmZpZ3VyYXRpb24gaXMgdmFsaWQu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB2YWxpZGF0ZURldGFjaGFibGUo\nKSB7CiAgICAgICAgYm9vbGVhbiBmaXJzdCA9IHRydWU7CiAgICAgICAgZm9y\nIChDbGFzc01ldGFEYXRhIHBhcmVudCA9IGdldFBDU3VwZXJjbGFzc01ldGFE\nYXRhKCk7CiAgICAgICAgICAgIGZpcnN0ICYmIHBhcmVudCAhPSBudWxsOyBw\nYXJlbnQgPSBwYXJlbnQuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSkKICAg\nICAgICB7CiAgICAgICAgICAgIGlmIChwYXJlbnQuaXNEZXRhY2hhYmxlKCkp\nCiAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwogICAgICAgIH0KCiAg\nICAgICAgRmllbGQgZmllbGQgPSBnZXREZXRhY2hlZFN0YXRlRmllbGQoKTsK\nICAgICAgICBpZiAoZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAo\nIWZpcnN0KQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJwYXJlbnQtZGV0YWNoLXN0YXRlIiwKICAgICAg\nICAgICAgICAgICAgICBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZ2V0Rmll\nbGQoZmllbGQuZ2V0TmFtZSgpKSAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJtYW5hZ2Vk\nLWRldGFjaC1zdGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0\nTmFtZSgpLCBfdHlwZSkpOwogICAgICAgICAgICBpZiAoZmllbGQuZ2V0VHlw\nZSgpICE9IE9iamVjdC5jbGFzcykKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWRldGFjaC1zdGF0\nZSIsCiAgICAgICAgICAgICAgICAgICAgZmllbGQuZ2V0TmFtZSgpLCBfdHlw\nZSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAg\nIC8vIEZldGNoIEdyb3VwCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZmV0Y2ggZ3JvdXBzIGRlY2xhcmVkIGV4cGxp\nY2l0bHkgaW4gdGhpcyB0eXBlLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hH\ncm91cFtdIGdldERlY2xhcmVkRmV0Y2hHcm91cHMoKSB7CiAgICAgICAgaWYg\nKF9mZ3MgPT0gbnVsbCkKICAgICAgICAgICAgX2ZncyA9IChfZmdNYXAgPT0g\nbnVsbCkgPyBFTVBUWV9GRVRDSF9HUk9VUF9BUlJBWSA6IChGZXRjaEdyb3Vw\nW10pCiAgICAgICAgICAgICAgICBfZmdNYXAudmFsdWVzKCkudG9BcnJheShu\nZXcgRmV0Y2hHcm91cFtfZmdNYXAuc2l6ZSgpXSk7IAogICAgICAgIHJldHVy\nbiBfZmdzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFsbCBmZXRj\naCBncm91cHMgZm9yIHRoaXMgdHlwZSwgaW5jbHVkaW5nIHN1cGVyY2xhc3Mg\nZ3JvdXBzLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cFtdIGdldEN1\nc3RvbUZldGNoR3JvdXBzKCkgewogICAgICAgIGlmIChfY3VzdG9tRkdzID09\nIG51bGwpIHsKICAgICAgICAgICAgLy8gbWFwIGZncyB0byBuYW1lcywgYWxs\nb3dpbmcgb3VyIGZncyB0byBvdmVycmlkZSBzdXBlcnMKICAgICAgICAgICAg\nTWFwIGZncyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgc3VwID0gZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAg\nICAgICAgaWYgKHN1cCAhPSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAg\nICAgICAgICBGZXRjaEdyb3VwW10gc3VwRkdzID0gc3VwLmdldEN1c3RvbUZl\ndGNoR3JvdXBzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHN1cEZHcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICBm\nZ3MucHV0KHN1cEZHc1tpXS5nZXROYW1lKCksIHN1cEZHc1tpXSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgRmV0Y2hHcm91cFtdIGRlY3MgPSBnZXRE\nZWNsYXJlZEZldGNoR3JvdXBzKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZGVjcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGZn\ncy5wdXQoZGVjc1tpXS5nZXROYW1lKCksIGRlY3NbaV0pOwogICAgICAgICAg\nICAKICAgICAgICAgICAgLy8gcmVtb3ZlIHN0ZCBncm91cHMKICAgICAgICAg\nICAgZmdzLnJlbW92ZShGZXRjaEdyb3VwLk5BTUVfREVGQVVMVCk7CiAgICAg\nICAgICAgIGZncy5yZW1vdmUoRmV0Y2hHcm91cC5OQU1FX0FMTCk7CgogICAg\nICAgICAgICBfY3VzdG9tRkdzID0gKEZldGNoR3JvdXBbXSkgZmdzLnZhbHVl\ncygpLnRvQXJyYXkKICAgICAgICAgICAgICAgIChuZXcgRmV0Y2hHcm91cFtm\nZ3Muc2l6ZSgpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfY3VzdG9t\nRkdzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0cyBhIG5hbWVkIGZlY3Ro\nIGdyb3VwLiBJZiBub3QgYXZhaWxhYmxlIGluIHRoaXMgcmVjZWl2ZXIgdGhl\nbiBsb29rcwogICAgICogdXAgdGhlIGluaGVyaXRlbmNlIGhpZXJhcmNoeS4g\nCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgbmFtZSBvZiBhIGZldGNoIGdy\nb3VwLgogICAgICogQHJldHVybiBhbiBleGlzdGluZyBmZWN0aCBncm91cCBv\nZiB0aGUgZ2l2ZW4gbmFtZSBpZiBrbm93biB0byB0aGlzIAogICAgICogcmVj\nZWl2ZXIgb3IgYW55IG9mIGl0cyBzdXBlcmNsYXNzZXMuIE90aGVyd2lzZSBu\ndWxsLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBnZXRGZXRjaEdy\nb3VwKFN0cmluZyBuYW1lKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IChf\nZmdNYXAgPT0gbnVsbCkgPyBudWxsIDogKEZldGNoR3JvdXApIF9mZ01hcC5n\nZXQobmFtZSk7CiAgICAgICAgaWYgKGZnICE9IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBmZzsKICAgICAgICBDbGFzc01ldGFEYXRhIHN1cCA9IGdldFBD\nU3VwZXJjbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gc3VwLmdldEZldGNoR3JvdXAobmFtZSk7\nCiAgICAgICAgaWYgKEZldGNoR3JvdXAuTkFNRV9ERUZBVUxULmVxdWFscyhu\nYW1lKSkKICAgICAgICAgICAgcmV0dXJuIEZldGNoR3JvdXAuREVGQVVMVDsK\nICAgICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0FMTC5lcXVhbHMobmFtZSkp\nCiAgICAgICAgICAgIHJldHVybiBGZXRjaEdyb3VwLkFMTDsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgZmV0Y2gg\nZ3JvdXAgb2YgdGhlIGdpdmVuIG5hbWUsIG9yIHJldHVybnMgZXhpc3Rpbmcg\naW5zdGFuY2UuCiAgICAgKgogICAgICogQHBhcmFtIG5hbWUgYSBub24tbnVs\nbCwgbm9uLWVtcHR5IG5hbWUuIE11c3QgYmUgdW5pcXVlIHdpdGhpbiB0aGlz\nCiAgICAgKiByZWNlaXZlcidzIHNjb3BlLiBUaGUgc3VwZXIgY2xhc3MgPGVt\nPm1heTwvZW0+IGhhdmUgYSBncm91cCB3aXRoCiAgICAgKiB0aGUgc2FtZSBu\nYW1lLgogICAgICovCiAgICBwdWJsaWMgRmV0Y2hHcm91cCBhZGREZWNsYXJl\nZEZldGNoR3JvdXAoU3RyaW5nIG5hbWUpIHsKICAgIAlpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShuYW1lKSkKICAgIAkJdGhyb3cgbmV3IE1ldGFEYXRhRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJlbXB0eS1mZy1uYW1lIiwgdGhpcykpOwogICAg\nICAgIGlmIChfZmdNYXAgPT0gbnVsbCkKICAgICAgICAgICAgX2ZnTWFwID0g\nbmV3IEhhc2hNYXAoKTsKICAgICAgICBGZXRjaEdyb3VwIGZnID0gKEZldGNo\nR3JvdXApIF9mZ01hcC5nZXQobmFtZSk7CiAgICAgICAgaWYgKGZnID09IG51\nbGwpIHsKICAgICAgICAJZmcgPSBuZXcgRmV0Y2hHcm91cCh0aGlzLCBuYW1l\nKTsKICAgICAgICAJX2ZnTWFwLnB1dChuYW1lLCBmZyk7CiAgICAgICAgICAg\nIF9mZ3MgPSBudWxsOwogICAgICAgICAgICBfY3VzdG9tRkdzID0gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZnOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVtb3ZlIGEgZGVjbGFyZWQgZmV0Y2ggZ3JvdXAuCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZURlY2xhcmVkRmV0Y2hHcm91cChG\nZXRjaEdyb3VwIGZnKSB7CiAgICAgICAgaWYgKGZnID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2ZnTWFwLnJlbW92\nZShmZy5nZXROYW1lKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgX2ZncyA9\nIG51bGw7CiAgICAgICAgICAgIF9jdXN0b21GR3MgPSBudWxsOwogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTb3Vy\nY2VUcmFja2VyCiAgICAvLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBG\naWxlIGdldFNvdXJjZUZpbGUoKSB7CiAgICAgICAgcmV0dXJuIF9zcmNGaWxl\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0U291cmNlU2NvcGUoKSB7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGludCBn\nZXRTb3VyY2VUeXBlKCkgewogICAgICAgIHJldHVybiBfc3JjVHlwZTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRTb3VyY2UoRmlsZSBmaWxlLCBpbnQg\nc3JjVHlwZSkgewogICAgICAgIF9zcmNGaWxlID0gZmlsZTsKICAgICAgICBf\nc3JjVHlwZSA9IHNyY1R5cGU7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBn\nZXRSZXNvdXJjZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIF90eXBlLmdldE5h\nbWUoKTsKICAgIH0KICAgIAogICAgcHVibGljIGludCBnZXRMaW5lTnVtYmVy\nKCkgewogICAgICAgIHJldHVybiBfbGluZU51bTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRMaW5lTnVtYmVyKGludCBsaW5lTnVtKSB7CiAgICAgICAg\nX2xpbmVOdW0gPSBsaW5lTnVtOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0\nQ29sTnVtYmVyKCkgewogICAgICAgIHJldHVybiBfY29sTnVtOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldENvbE51bWJlcihpbnQgY29sTnVtKSB7CiAg\nICAgICAgX2NvbE51bSA9IGNvbE51bTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVuIGxvYWRl\nZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIGludCBnZXRTb3VyY2VNb2Rl\nKCkgewogICAgICAgIHJldHVybiBfc3JjTW9kZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1ldGFkYXRhIGhhcyBiZWVu\nIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U291\ncmNlTW9kZShpbnQgbW9kZSkgewogICAgICAgIF9zcmNNb2RlID0gbW9kZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9kZSB0aGlzIG1l\ndGFkYXRhIGhhcyBiZWVuIGxvYWRlZCB1bmRlci4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0U291cmNlTW9kZShpbnQgbW9kZSwgYm9vbGVhbiBvbikg\newogICAgICAgIGlmIChtb2RlID09IE1PREVfTk9ORSkKICAgICAgICAgICAg\nX3NyY01vZGUgPSBtb2RlOwogICAgICAgIGVsc2UgaWYgKG9uKQogICAgICAg\nICAgICBfc3JjTW9kZSB8PSBtb2RlOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX3NyY01vZGUgJj0gfm1vZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGUgaW5kZXggaW4gd2hpY2ggdGhpcyBjbGFzcyB3YXMgbGlzdGVkIGluIHRo\nZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPi0xPC9jb2Rl\nPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlzdGVkIGluIHRoZSBtZXRhZGF0\nYS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRMaXN0aW5nSW5kZXgoKSB7\nCiAgICAgICAgcmV0dXJuIF9saXN0SW5kZXg7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGUgaW5kZXggaW4gd2hpY2ggdGhpcyBmaWVsZCB3YXMgbGlzdGVk\nIGluIHRoZSBtZXRhZGF0YS4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPi0x\nPC9jb2RlPiBpZiB0aGlzIGNsYXNzIHdhcyBub3QgbGlzdGVkIGluIHRoZSBt\nZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TGlzdGluZ0lu\nZGV4KGludCBpbmRleCkgewogICAgICAgIF9saXN0SW5kZXggPSBpbmRleDsK\nICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbW1lbnRhYmxl\nCiAgICAvLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0\nQ29tbWVudHMoKSB7CiAgICAgICAgcmV0dXJuIChfY29tbWVudHMgPT0gbnVs\nbCkgPyBFTVBUWV9DT01NRU5UUyA6IF9jb21tZW50czsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRDb21tZW50cyhTdHJpbmdbXSBjb21tZW50cykgewog\nICAgICAgIF9jb21tZW50cyA9IGNvbW1lbnRzOwogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBjb3B5CiAgICAvLy8vLy8vLy8vLy8v\nLwoKICAgIC8qKgogICAgICogQ29weSB0aGUgbWV0YWRhdGEgZnJvbSB0aGUg\nZ2l2ZW4gaW5zdGFuY2UgdG8gdGhpcyBvbmUuIERvIG5vdAogICAgICogY29w\neSBtYXBwaW5nIGluZm9ybWF0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBjb3B5KENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSAhPSBfdHlwZSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgc3VwZXIuY29w\neShtZXRhKTsKCiAgICAgICAgLy8gY29weSBjbGFzcy1sZXZlbCBpbmZvOyB1\nc2UgZ2V0IG1ldGhvZHMgdG8gZm9yY2UgcmVzb2x1dGlvbiBvZgogICAgICAg\nIC8vIGxhenkgZGF0YQogICAgICAgIF9zdXBlciA9IG1ldGEuZ2V0UENTdXBl\ncmNsYXNzKCk7CiAgICAgICAgX29iamVjdElkID0gbWV0YS5nZXRPYmplY3RJ\nZFR5cGUoKTsKICAgICAgICBfZXh0ZW50ID0gKG1ldGEuZ2V0UmVxdWlyZXNF\neHRlbnQoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAg\nICAgIF9lbWJlZGRlZCA9IChtZXRhLmlzRW1iZWRkZWRPbmx5KCkpID8gQm9v\nbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBfaW50ZXJmYWNl\nID0gKG1ldGEuaXNNYW5hZ2VkSW50ZXJmYWNlKCkpID8gQm9vbGVhbi5UUlVF\nIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICBzZXRJbnRlcmNlcHRpbmcobWV0\nYS5pc0ludGVyY2VwdGluZygpKTsKICAgICAgICBfaW1wbCA9IG1ldGEuZ2V0\nSW50ZXJmYWNlSW1wbCgpOwogICAgICAgIF9pZGVudGl0eSA9IG1ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCk7CiAgICAgICAgX2lkU3RyYXRlZ3kgPSBtZXRhLmdl\ndElkZW50aXR5U3RyYXRlZ3koKTsKICAgICAgICBfc2VxTmFtZSA9IG1ldGEu\nZ2V0SWRlbnRpdHlTZXF1ZW5jZU5hbWUoKTsKICAgICAgICBfc2VxTWV0YSA9\nIG51bGw7CiAgICAgICAgX2FsaWFzID0gbWV0YS5nZXRUeXBlQWxpYXMoKTsK\nICAgICAgICBfYWNjZXNzVHlwZSA9IG1ldGEuZ2V0QWNjZXNzVHlwZSgpOwoK\nICAgICAgICAvLyBvbmx5IGNvcHkgdGhpcyBpbmZvcm1hdGlvbiBpZiBpdCB3\nYXNuJ3Qgc2V0IGV4cGxpY2l0bHkgZm9yIHRoaXMKICAgICAgICAvLyBpbnN0\nYW5jZQogICAgICAgIGlmIChERUZBVUxUX1NUUklORy5lcXVhbHMoX2NhY2hl\nTmFtZSkpCiAgICAgICAgICAgIF9jYWNoZU5hbWUgPSBtZXRhLmdldERhdGFD\nYWNoZU5hbWUoKTsKICAgICAgICBpZiAoX2NhY2hlVGltZW91dCA9PSBJbnRl\nZ2VyLk1JTl9WQUxVRSkKICAgICAgICAgICAgX2NhY2hlVGltZW91dCA9IG1l\ndGEuZ2V0RGF0YUNhY2hlVGltZW91dCgpOwogICAgICAgIGlmIChfZGV0YWNo\nYWJsZSA9PSBudWxsKQogICAgICAgICAgICBfZGV0YWNoYWJsZSA9IG1ldGEu\nX2RldGFjaGFibGU7CiAgICAgICAgaWYgKERFRkFVTFRfU1RSSU5HLmVxdWFs\ncyhfZGV0YWNoU3RhdGUpKQogICAgICAgICAgICBfZGV0YWNoU3RhdGUgPSBt\nZXRhLmdldERldGFjaGVkU3RhdGUoKTsKCiAgICAgICAgLy8gc3luY2ggZmll\nbGQgaW5mb3JtYXRpb247IGZpcnN0IHJlbW92ZSBleHRyYSBmaWVsZHMKICAg\nICAgICBjbGVhckZpZWxkQ2FjaGUoKTsKICAgICAgICBfZmllbGRNYXAua2V5\nU2V0KCkucmV0YWluQWxsKG1ldGEuX2ZpZWxkTWFwLmtleVNldCgpKTsKCiAg\nICAgICAgLy8gYWRkIGNvcGllcyBvZiBkZWNsYXJlZCBmaWVsZHM7IG90aGVy\nIGRlZmluZWQgZmllbGRzIGFscmVhZHkgY29waWVkCiAgICAgICAgRmllbGRN\nZXRhRGF0YVtdIGZpZWxkcyA9IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZpZWxkOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGZpZWxkID0gZ2V0RGVjbGFyZWRGaWVsZChmaWVsZHNbaV0uZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgaWYgKGZpZWxkID09IG51bGwpCiAgICAgICAgICAg\nICAgICBmaWVsZCA9IGFkZERlY2xhcmVkRmllbGQoZmllbGRzW2ldLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgICAgICBmaWVsZHNbaV0uZ2V0RGVjbGFy\nZWRUeXBlKCkpOwogICAgICAgICAgICBmaWVsZC5zZXREZWNsYXJlZEluZGV4\nKC0xKTsKICAgICAgICAgICAgZmllbGQuc2V0SW5kZXgoLTEpOwogICAgICAg\nICAgICBmaWVsZC5jb3B5KGZpZWxkc1tpXSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBjb3B5IGZldGNoIGdyb3VwcwogICAgICAgIEZldGNoR3JvdXBbXSBm\nZ3MgPSBtZXRhLmdldERlY2xhcmVkRmV0Y2hHcm91cHMoKTsKICAgICAgICBG\nZXRjaEdyb3VwIGZnOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZmdz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZnID0gYWRkRGVjbGFyZWRG\nZXRjaEdyb3VwKGZnc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBmZy5j\nb3B5KGZnc1tpXSk7IAogICAgICAgIH0KCiAgICAgICAgLy8gY29weSBpZmFj\nZSByZS1tYXBwaW5nCiAgICAgICAgX2lmYWNlTWFwLmNsZWFyKCk7CiAgICAg\nICAgX2lmYWNlTWFwLnB1dEFsbChtZXRhLl9pZmFjZU1hcCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWN1cnNpdmUgaGVscGVyIHRvIGNvcHkgZW1iZWRk\nZWQgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQg\nY29weShDbGFzc01ldGFEYXRhIGVtYmVkLCBDbGFzc01ldGFEYXRhIGRlYykg\newogICAgICAgIENsYXNzTWV0YURhdGEgc3VwID0gZGVjLmdldFBDU3VwZXJj\nbGFzc01ldGFEYXRhKCk7CiAgICAgICAgaWYgKHN1cCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGVtYmVkLnNldFBDU3VwZXJjbGFzcyhzdXAuZ2V0RGVzY3Jp\nYmVkVHlwZSgpKTsKICAgICAgICAgICAgY29weShlbWJlZC5nZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpLCBzdXApOwogICAgICAgIH0KICAgICAgICBlbWJl\nZC5jb3B5KGRlYyk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkRXh0\nZW5zaW9uS2V5cyhDb2xsZWN0aW9uIGV4dHMpIHsKICAgICAgICBfcmVwb3Mu\nZ2V0TWV0YURhdGFGYWN0b3J5KCkuYWRkQ2xhc3NFeHRlbnNpb25LZXlzKGV4\ndHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyYXRvciB1c2VkIHRv\nIHB1dCBmaWVsZCBtZXRhZGF0YXMgaW50byBsaXN0aW5nIG9yZGVyLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBMaXN0aW5nT3JkZXJDb21w\nYXJhdG9yCiAgICAgICAgaW1wbGVtZW50cyBDb21wYXJhdG9yIHsKCiAgICAg\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTGlzdGluZ09yZGVyQ29tcGFyYXRv\nciBfaW5zdGFuY2UKICAgICAgICAgICAgPSBuZXcgTGlzdGluZ09yZGVyQ29t\ncGFyYXRvcigpOwoKICAgICAgICAvKioKICAgICAgICAgKiBBY2Nlc3Mgc2lu\nZ2xldG9uIGluc3RhbmNlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBz\ndGF0aWMgTGlzdGluZ09yZGVyQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9iamVjdCBvMikg\newogICAgICAgICAgICBpZiAobzEgPT0gbzIpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gMDsKICAgICAgICAgICAgaWYgKG8xID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgaWYgKG8yID09IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CgogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIGYxID0gKEZpZWxkTWV0YURhdGEpIG8xOwogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhIGYyID0gKEZpZWxkTWV0YURhdGEpIG8yOwogICAg\nICAgICAgICBpZiAoZjEuZ2V0TGlzdGluZ0luZGV4KCkgPT0gZjIuZ2V0TGlz\ndGluZ0luZGV4KCkpIHsKICAgICAgICAgICAgICAgIGlmIChmMS5nZXRJbmRl\neCgpID09IGYyLmdldEluZGV4KCkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGYxLmdldEZ1bGxOYW1lKGZhbHNlKS5jb21wYXJlVG8KICAgICAgICAg\nICAgICAgICAgICAgICAgKGYyLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgkJCQlp\nZiAoZjEuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJuIDE7CgkJCQlp\nZiAoZjIuZ2V0SW5kZXggKCkgPT0gLTEpCgkJCQkJcmV0dXJuIC0xOwoJCQkJ\ncmV0dXJuIGYxLmdldEluZGV4ICgpIC0gZjIuZ2V0SW5kZXggKCk7CgkJCX0J\nCgkJCWlmIChmMS5nZXRMaXN0aW5nSW5kZXggKCkgPT0gLTEpCgkJCQlyZXR1\ncm4gMTsKCQkJaWYgKGYyLmdldExpc3RpbmdJbmRleCAoKSA9PSAtMSkKCQkJ\nCXJldHVybiAtMTsKCQkJcmV0dXJuIGYxLmdldExpc3RpbmdJbmRleCAoKSAt\nIGYyLmdldExpc3RpbmdJbmRleCAoKTsKCQl9Cgl9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIHJlZ2lzdGVyRm9yVmFsdWVVcGRhdGUoU3RyaW5nLi4udmFsdWVz\nKSB7CiAgICAJaWYgKHZhbHVlcyA9PSBudWxsKQogICAgCQlyZXR1cm47CiAg\nICAJZm9yIChTdHJpbmcga2V5IDogdmFsdWVzKSB7CiAgICAJCVZhbHVlIHZh\nbHVlID0gZ2V0UmVwb3NpdG9yeSgpLmdldENvbmZpZ3VyYXRpb24oKQogICAg\nCQkJLmdldFZhbHVlKGtleSk7CiAgICAJCWlmICh2YWx1ZSAhPSBudWxsKQog\nICAgCQkJdmFsdWUuYWRkTGlzdGVuZXIodGhpcyk7CiAgICAJfQogICAgfQog\nICAgCiAgICBwdWJsaWMgdm9pZCB2YWx1ZUNoYW5nZWQoVmFsdWUgdmFsKSB7\nCiAgICAJaWYgKHZhbCA9PSAgbnVsbCkKICAgIAkJcmV0dXJuOwogICAgCVN0\ncmluZyBrZXkgPSB2YWwuZ2V0UHJvcGVydHkoKTsKICAgIAlpZiAoIkRhdGFD\nYWNoZVRpbWVvdXQiLmVxdWFscyhrZXkpKSB7CiAgICAJCV9jYWNoZVRpbWVv\ndXQgPSBJbnRlZ2VyLk1JTl9WQUxVRTsKICAgIAl9CiAgICB9Cn0K\n","encoding":"base64"}

