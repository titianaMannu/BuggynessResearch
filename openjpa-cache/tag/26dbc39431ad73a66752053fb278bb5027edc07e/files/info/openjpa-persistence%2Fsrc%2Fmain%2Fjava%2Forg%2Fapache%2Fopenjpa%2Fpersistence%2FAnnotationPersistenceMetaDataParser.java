{"sha":"b310a3c740bc7a20c04914f3fa07af381b59b9fe","node_id":"MDQ6QmxvYjIwNjM2NDpiMzEwYTNjNzQwYmM3YTIwYzA0OTE0ZjNmYTA3YWYzODFiNTliOWZl","size":63719,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/b310a3c740bc7a20c04914f3fa07af381b59b9fe","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7\nCmltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5Bbm5vdGF0aW9uOwppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQW5ub3RhdGVkRWxlbWVudDsKaW1wb3J0\nIGphdmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWVtYmVyOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9k\nOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBq\nYXZhLm5ldC5VUklTeW50YXhFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5V\nUkw7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJl\nZVNldDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkJhc2ljOwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5w\nZXJzaXN0ZW5jZS5FbWJlZGRhYmxlOwppbXBvcnQgamF2YXgucGVyc2lzdGVu\nY2UuRW1iZWRkZWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbWJlZGRl\nZElkOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5OwppbXBvcnQg\namF2YXgucGVyc2lzdGVuY2UuRW50aXR5TGlzdGVuZXJzOwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuRXhjbHVkZURlZmF1bHRMaXN0ZW5lcnM7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5FeGNsdWRlU3VwZXJjbGFzc0xpc3RlbmVy\nczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZldGNoVHlwZTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5HZW5lcmF0ZWRWYWx1ZTsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlOwppbXBvcnQgc3RhdGljIGphdmF4\nLnBlcnNpc3RlbmNlLkdlbmVyYXRpb25UeXBlLkFVVE87CmltcG9ydCBqYXZh\neC5wZXJzaXN0ZW5jZS5JZDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLklk\nQ2xhc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5Mb2I7CmltcG9ydCBq\nYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9NYW55OwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2Uu\nTWFwS2V5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTWFwcGVkU3VwZXJj\nbGFzczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncmllczsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk5hbWVkTmF0aXZlUXVl\ncnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJpZXM7Cmlt\ncG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZFF1ZXJ5OwppbXBvcnQgamF2\nYXgucGVyc2lzdGVuY2UuT25lVG9NYW55OwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5PcmRl\nckJ5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUG9zdExvYWQ7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5Qb3N0UGVyc2lzdDsKaW1wb3J0IGphdmF4\nLnBlcnNpc3RlbmNlLlBvc3RSZW1vdmU7CmltcG9ydCBqYXZheC5wZXJzaXN0\nZW5jZS5Qb3N0VXBkYXRlOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuUHJl\nUGVyc2lzdDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVJlbW92ZTsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlByZVVwZGF0ZTsKaW1wb3J0IGph\ndmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuVmVyc2lvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5jb25m\nLk9wZW5KUEFDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmV2ZW50LkJlYW5MaWZlY3ljbGVDYWxsYmFja3M7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlQ2FsbGJhY2tzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkxpZmVjeWNsZUV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50Lk1ldGhvZExpZmVjeWNs\nZUNhbGxiYWNrczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nUXVlcnlMYW5ndWFnZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLmpwcWwuSlBRTFBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5KMkRvUHJpdjVIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLkRlbGVnYXRpbmdNZXRhRGF0YUZhY3Rvcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTGlmZWN5Y2xlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YUZhY3Rv\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0YU1v\nZGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuTWV0YURhdGFS\nZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuT3Jk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5RdWVyeU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuU2VxdWVuY2VN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlVwZGF0\nZVN0cmF0ZWdpZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5W\nYWx1ZU1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nVmFsdWVTdHJhdGVnaWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1l\ndGEuTWV0YURhdGFEZWZhdWx0czsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hl\nLm9wZW5qcGEucGVyc2lzdGVuY2UuTWV0YURhdGFUYWcuKjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk1ldGFEYXRhRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwoKaW1wb3J0IHNlcnAudXRpbC5OdW1iZXJzOwppbXBvcnQgc2Vy\ncC51dGlsLlN0cmluZ3M7CgovKioKICogUGVyc2lzdGVuY2UgYW5ub3RhdGlv\nbiBtZXRhZGF0YSBwYXJzZXIuIEN1cnJlbnRseSBkb2VzIG5vdCBwYXJzZQog\nKiBkZXBsb3ltZW50IGRlc2NyaXB0b3JzLgogKgogKiBAYXV0aG9yIEFiZSBX\naGl0ZQogKiBAYXV0aG9yIFN0ZXZlIEtpbQogKiBAbm9qYXZhZG9jCiAqLwpw\ndWJsaWMgY2xhc3MgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJz\nZXIKICAgIGltcGxlbWVudHMgTWV0YURhdGFNb2RlcyB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9y\nUGFja2FnZQogICAgICAgIChBbm5vdGF0aW9uUGVyc2lzdGVuY2VNZXRhRGF0\nYVBhcnNlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFw\nPENsYXNzLCBNZXRhRGF0YVRhZz4gX3RhZ3MgPQogICAgICAgIG5ldyBIYXNo\nTWFwPENsYXNzLCBNZXRhRGF0YVRhZz4oKTsKCiAgICBzdGF0aWMgewogICAg\nICAgIF90YWdzLnB1dChFbWJlZGRlZElkLmNsYXNzLCBFTUJFRERFRF9JRCk7\nCiAgICAgICAgX3RhZ3MucHV0KEVudGl0eUxpc3RlbmVycy5jbGFzcywgRU5U\nSVRZX0xJU1RFTkVSUyk7CiAgICAgICAgX3RhZ3MucHV0KEV4Y2x1ZGVEZWZh\ndWx0TGlzdGVuZXJzLmNsYXNzLCBFWENMVURFX0RFRkFVTFRfTElTVEVORVJT\nKTsKICAgICAgICBfdGFncy5wdXQoRXhjbHVkZVN1cGVyY2xhc3NMaXN0ZW5l\ncnMuY2xhc3MsCiAgICAgICAgICAgIEVYQ0xVREVfU1VQRVJDTEFTU19MSVNU\nRU5FUlMpOwogICAgICAgIF90YWdzLnB1dChGbHVzaE1vZGVUeXBlLmNsYXNz\nLCBGTFVTSF9NT0RFKTsKICAgICAgICBfdGFncy5wdXQoR2VuZXJhdGVkVmFs\ndWUuY2xhc3MsIEdFTkVSQVRFRF9WQUxVRSk7CiAgICAgICAgX3RhZ3MucHV0\nKElkLmNsYXNzLCBJRCk7CiAgICAgICAgX3RhZ3MucHV0KElkQ2xhc3MuY2xh\nc3MsIElEX0NMQVNTKTsKICAgICAgICBfdGFncy5wdXQoTWFwS2V5LmNsYXNz\nLCBNQVBfS0VZKTsKICAgICAgICBfdGFncy5wdXQoTmFtZWROYXRpdmVRdWVy\naWVzLmNsYXNzLCBOQVRJVkVfUVVFUklFUyk7CiAgICAgICAgX3RhZ3MucHV0\nKE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MsIE5BVElWRV9RVUVSWSk7CiAgICAg\nICAgX3RhZ3MucHV0KE5hbWVkUXVlcmllcy5jbGFzcywgUVVFUklFUyk7CiAg\nICAgICAgX3RhZ3MucHV0KE5hbWVkUXVlcnkuY2xhc3MsIFFVRVJZKTsKICAg\nICAgICBfdGFncy5wdXQoT3JkZXJCeS5jbGFzcywgT1JERVJfQlkpOwogICAg\nICAgIF90YWdzLnB1dChQb3N0TG9hZC5jbGFzcywgUE9TVF9MT0FEKTsKICAg\nICAgICBfdGFncy5wdXQoUG9zdFBlcnNpc3QuY2xhc3MsIFBPU1RfUEVSU0lT\nVCk7CiAgICAgICAgX3RhZ3MucHV0KFBvc3RSZW1vdmUuY2xhc3MsIFBPU1Rf\nUkVNT1ZFKTsKICAgICAgICBfdGFncy5wdXQoUG9zdFVwZGF0ZS5jbGFzcywg\nUE9TVF9VUERBVEUpOwogICAgICAgIF90YWdzLnB1dChQcmVQZXJzaXN0LmNs\nYXNzLCBQUkVfUEVSU0lTVCk7CiAgICAgICAgX3RhZ3MucHV0KFByZVJlbW92\nZS5jbGFzcywgUFJFX1JFTU9WRSk7CiAgICAgICAgX3RhZ3MucHV0KFByZVVw\nZGF0ZS5jbGFzcywgUFJFX1VQREFURSk7CiAgICAgICAgX3RhZ3MucHV0KFNl\ncXVlbmNlR2VuZXJhdG9yLmNsYXNzLCBTRVFfR0VORVJBVE9SKTsKICAgICAg\nICBfdGFncy5wdXQoVmVyc2lvbi5jbGFzcywgVkVSU0lPTik7CiAgICAgICAg\nX3RhZ3MucHV0KERhdGFDYWNoZS5jbGFzcywgREFUQV9DQUNIRSk7CiAgICAg\nICAgX3RhZ3MucHV0KERhdGFTdG9yZUlkLmNsYXNzLCBEQVRBU1RPUkVfSUQp\nOwogICAgICAgIF90YWdzLnB1dChEZXBlbmRlbnQuY2xhc3MsIERFUEVOREVO\nVCk7CiAgICAgICAgX3RhZ3MucHV0KERldGFjaGVkU3RhdGUuY2xhc3MsIERF\nVEFDSEVEX1NUQVRFKTsKICAgICAgICBfdGFncy5wdXQoRWxlbWVudERlcGVu\nZGVudC5jbGFzcywgRUxFTV9ERVBFTkRFTlQpOwogICAgICAgIF90YWdzLnB1\ndChFbGVtZW50VHlwZS5jbGFzcywgRUxFTV9UWVBFKTsKICAgICAgICBfdGFn\ncy5wdXQoRXh0ZXJuYWxWYWx1ZXMuY2xhc3MsIEVYVEVSTkFMX1ZBTFMpOwog\nICAgICAgIF90YWdzLnB1dChFeHRlcm5hbGl6ZXIuY2xhc3MsIEVYVEVSTkFM\nSVpFUik7CiAgICAgICAgX3RhZ3MucHV0KEZhY3RvcnkuY2xhc3MsIEZBQ1RP\nUlkpOwogICAgICAgIF90YWdzLnB1dChGZXRjaEdyb3VwLmNsYXNzLCBGRVRD\nSF9HUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KEZldGNoR3JvdXBzLmNsYXNz\nLCBGRVRDSF9HUk9VUFMpOwogICAgICAgIF90YWdzLnB1dChJbnZlcnNlTG9n\naWNhbC5jbGFzcywgSU5WRVJTRV9MT0dJQ0FMKTsKICAgICAgICBfdGFncy5w\ndXQoS2V5RGVwZW5kZW50LmNsYXNzLCBLRVlfREVQRU5ERU5UKTsKICAgICAg\nICBfdGFncy5wdXQoS2V5VHlwZS5jbGFzcywgS0VZX1RZUEUpOwogICAgICAg\nIF90YWdzLnB1dChMb2FkRmV0Y2hHcm91cC5jbGFzcywgTE9BRF9GRVRDSF9H\nUk9VUCk7CiAgICAgICAgX3RhZ3MucHV0KExSUy5jbGFzcywgTFJTKTsKICAg\nICAgICBfdGFncy5wdXQoTWFuYWdlZEludGVyZmFjZS5jbGFzcywgTUFOQUdF\nRF9JTlRFUkZBQ0UpOwogICAgICAgIF90YWdzLnB1dChSZWFkT25seS5jbGFz\ncywgUkVBRF9PTkxZKTsKICAgICAgICBfdGFncy5wdXQoVHlwZS5jbGFzcywg\nVFlQRSk7CiAgICB9CgogICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmln\ndXJhdGlvbiBfY29uZjsKICAgIHByaXZhdGUgZmluYWwgTG9nIF9sb2c7CiAg\nICBwcml2YXRlIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3MgPSBudWxsOwog\nICAgcHJpdmF0ZSBDbGFzc0xvYWRlciBfZW52TG9hZGVyID0gbnVsbDsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfb3ZlcnJpZGUgPSBmYWxzZTsKICAgIHByaXZh\ndGUgaW50IF9tb2RlID0gTU9ERV9OT05FOwoKICAgIC8vIHBhY2thZ2VzIGFu\nZCB0aGVpciBwYXJzZSBtb2RlcwogICAgcHJpdmF0ZSBmaW5hbCBNYXA8UGFj\na2FnZSwgSW50ZWdlcj4gX3BrZ3MgPSBuZXcgSGFzaE1hcDxQYWNrYWdlLCBJ\nbnRlZ2VyPigpOwoKICAgIC8vIHRoZSBjbGFzcyB3ZSB3ZXJlIGludm9rZWQg\ndG8gcGFyc2UKICAgIHByaXZhdGUgQ2xhc3MgX2NscyA9IG51bGw7CiAgICBw\ncml2YXRlIEZpbGUgX2ZpbGUgPSBudWxsOwoKICAgIC8qKgogICAgICogQ29u\nc3RydWN0b3I7IHN1cHBseSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBw\ndWJsaWMgQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFQYXJzZXIoT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIF9jb25mID0gY29u\nZjsKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3Vy\nYXRpb24uTE9HX01FVEFEQVRBKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbmZpZ3VyYXRpb24gc3VwcGxpZWQgb24gY29uc3RydWN0aW9uLgogICAgICov\nCiAgICBwdWJsaWMgT3BlbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJh\ndGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNZXRhZGF0YSBsb2cuCiAgICAgKi8KICAgIHB1YmxpYyBMb2cg\nZ2V0TG9nKCkgewogICAgICAgIHJldHVybiBfbG9nOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyB0aGUgcmVwb3NpdG9yeSBmb3IgdGhpcyBwYXJz\nZXIuIElmIG5vbmUgaGFzIGJlZW4gc2V0LAogICAgICogY3JlYXRlIGEgbmV3\nIHJlcG9zaXRvcnkgYW5kIHNldHMgaXQuCiAgICAgKi8KICAgIHB1YmxpYyBN\nZXRhRGF0YVJlcG9zaXRvcnkgZ2V0UmVwb3NpdG9yeSgpIHsKICAgICAgICBp\nZiAoX3JlcG9zID09IG51bGwpIHsKICAgICAgICAgICAgTWV0YURhdGFSZXBv\nc2l0b3J5IHJlcG9zID0gX2NvbmYubmV3TWV0YURhdGFSZXBvc2l0b3J5SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgTWV0YURhdGFGYWN0b3J5IG1kZiA9IHJl\ncG9zLmdldE1ldGFEYXRhRmFjdG9yeSgpOwogICAgICAgICAgICBpZiAobWRm\nIGluc3RhbmNlb2YgRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeSkKICAgICAg\nICAgICAgICAgIG1kZiA9ICgoRGVsZWdhdGluZ01ldGFEYXRhRmFjdG9yeSkg\nbWRmKS5nZXRJbm5lcm1vc3REZWxlZ2F0ZSgpOwogICAgICAgICAgICBpZiAo\nbWRmIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VNZXRhRGF0YUZhY3RvcnkpCiAg\nICAgICAgICAgICAgICAoKFBlcnNpc3RlbmNlTWV0YURhdGFGYWN0b3J5KSBt\nZGYpLnNldEFubm90YXRpb25QYXJzZXIodGhpcyk7CiAgICAgICAgICAgIF9y\nZXBvcyA9IHJlcG9zOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3JlcG9z\nOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtZXRhZGF0YSByZXBv\nc2l0b3J5IGZvciB0aGlzIHBhcnNlci4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0UmVwb3NpdG9yeShNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsK\nICAgICAgICBfcmVwb3MgPSByZXBvczsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgZW52aXJvbm1lbnRhbCBjbGFzcyBsb2FkZXIgdG8gcGFz\ncyBvbiB0byBwYXJzZWQKICAgICAqIG1ldGFkYXRhIGluc3RhbmNlcy4KICAg\nICAqLwogICAgcHVibGljIENsYXNzTG9hZGVyIGdldEVudkNsYXNzTG9hZGVy\nKCkgewogICAgICAgIHJldHVybiBfZW52TG9hZGVyOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBlbnZpcm9ubWVudGFsIGNsYXNzIGxvYWRlciB0\nbyBwYXNzIG9uIHRvIHBhcnNlZAogICAgICogbWV0YWRhdGEgaW5zdGFuY2Vz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRFbnZDbGFzc0xvYWRlcihD\nbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAgICBfZW52TG9hZGVyID0gbG9h\nZGVyOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBs\nYXRlciBwYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBvdmVycmlk\nZQogICAgICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNhbWUgY2xh\nc3MuIERlZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdoZW4gYSB0\nb29sIGlzIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0aW9uIHBh\ncnRpYWwgbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQg\nZXZlbiB3aGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhlcgogICAg\nICogbG9jYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldE1h\ncHBpbmdPdmVycmlkZSgpIHsKICAgICAgICByZXR1cm4gX292ZXJyaWRlOwog\nICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBsYXRlciBw\nYXJzZXMgb2YgbWFwcGluZyBpbmZvcm1hdGlvbiB0byBvdmVycmlkZQogICAg\nICogZWFybGllciBpbmZvcm1hdGlvbiBmb3IgdGhlIHNhbWUgY2xhc3MuIERl\nZmF1bHRzIHRvIGZhbHNlLiBVc2VmdWwKICAgICAqIHdoZW4gYSB0b29sIGlz\nIG1hcHBpbmcgYSBjbGFzcywgc28gdGhhdCBhbm5vdGF0aW9uIHBhcnRpYWwg\nbWFwcGluZwogICAgICogaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQgZXZlbiB3\naGVuIG1hcHBpbmdzIGFyZSBzdG9yZWQgaW4gYW5vdGhlcgogICAgICogbG9j\nYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldE1hcHBpbmdPdmVy\ncmlkZShib29sZWFuIG92ZXJyaWRlKSB7CiAgICAgICAgX292ZXJyaWRlID0g\nb3ZlcnJpZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgcGFyc2UgbW9k\nZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRNb2RlKCkgewogICAgICAg\nIHJldHVybiBfbW9kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBwYXJz\nZSBtb2RlLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRNb2RlKGludCBt\nb2RlLCBib29sZWFuIG9uKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gTU9ERV9O\nT05FKQogICAgICAgICAgICBfbW9kZSA9IE1PREVfTk9ORTsKICAgICAgICBl\nbHNlIGlmIChvbikKICAgICAgICAgICAgX21vZGUgfD0gbW9kZTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIF9tb2RlICY9IH5tb2RlOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHBhcnNlIG1vZGUuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldE1vZGUoaW50IG1vZGUpIHsKICAgICAgICBfbW9kZSA9IG1v\nZGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW5jZSBtZXRob2Qg\nZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9kZSgpIHsKICAgICAg\nICByZXR1cm4gKF9tb2RlICYgTU9ERV9NRVRBKSAhPSAwOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIGZvciBpbnRlcnByZXRp\nbmcge0BsaW5rICNnZXRNb2RlfS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaXNRdWVyeU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIChfbW9kZSAm\nIE1PREVfUVVFUlkpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZW5pZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1v\nZGV9LgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdN\nb2RlKCkgewogICAgICAgIHJldHVybiAoX21vZGUgJiBNT0RFX01BUFBJTkcp\nICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYg\nd2UncmUgaW4gbWFwcGluZyBtb2RlIG9yIGluIG1ldGFkYXRhIG1vZGUgd2l0\naAogICAgICogbWFwcGluZyBvdmVyaWRlIGVuYWJsZWQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBib29sZWFuIGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpIHsK\nICAgICAgICByZXR1cm4gaXNNYXBwaW5nTW9kZSgpIHx8IChfb3ZlcnJpZGUg\nJiYgaXNNZXRhRGF0YU1vZGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nbGVhciBjYWNoZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkg\newogICAgICAgIF9jbHMgPSBudWxsOwogICAgICAgIF9maWxlID0gbnVsbDsK\nICAgICAgICBfcGtncy5jbGVhcigpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGFyc2UgcGVyc2lzdGVuY2UgbWV0YWRhdGEgZm9yIHRoZSBnaXZlbiBjbGFz\ncy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcGFyc2UoQ2xhc3MgY2xzKSB7\nCiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgX2xvZy50cmFjZShfbG9jLmdldCgicGFyc2UtY2xhc3MiLCBjbHMuZ2V0\nTmFtZSgpKSk7CgogICAgICAgIF9jbHMgPSBjbHM7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcGFyc2VQYWNrYWdlQW5ub3RhdGlvbnMoKTsKICAgICAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcGFyc2VDbGFzc0Fubm90YXRp\nb25zKCk7CiAgICAgICAgICAgIHVwZGF0ZVNvdXJjZU1vZGUobWV0YSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2NscyA9IG51bGw7CiAg\nICAgICAgICAgIF9maWxlID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVcGRhdGUgdGhlIHNvdXJjZSBtb2RlIHRvIHRoZSBjbGFz\ncyBwYWNrYWdlIGFuZCBjbGFzcyB0byBpbmRpY2F0ZSB0aGF0CiAgICAgKiB3\nZSd2ZSBmdWxseSBwYXJzZWQgdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHVwZGF0ZVNvdXJjZU1vZGUoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKF9jbHMuZ2V0UGFja2FnZSgpICE9IG51bGwpCiAgICAgICAg\nICAgIGFkZFNvdXJjZU1vZGUoX2Nscy5nZXRQYWNrYWdlKCksIF9tb2RlKTsK\nICAgICAgICBpZiAobWV0YSAhPSBudWxsKQogICAgICAgICAgICBtZXRhLnNl\ndFNvdXJjZU1vZGUoX21vZGUsIHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgaW5mb3JtYXRpb24gaW4gcGFja2FnZS1sZXZlbCBjbGFzcyBh\nbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGFj\na2FnZUFubm90YXRpb25zKCkgewogICAgICAgIFBhY2thZ2UgcGtnID0gX2Ns\ncy5nZXRQYWNrYWdlKCk7CiAgICAgICAgaWYgKHBrZyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGludCBwa2dNb2RlID0gZ2V0U291\ncmNlTW9kZShwa2cpOwogICAgICAgIGlmIChwa2dNb2RlID09IDAgJiYgX2xv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLnRyYWNlKF9s\nb2MuZ2V0KCJwYXJzZS1wYWNrYWdlIiwgX2Nscy5nZXROYW1lKCkpKTsKICAg\nICAgICBpZiAoKHBrZ01vZGUgJiBfbW9kZSkgPT0gX21vZGUpIC8vIGFscmVh\nZHkgdmlzaXRlZAogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE1ldGFE\nYXRhVGFnIHRhZzsKICAgICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6IHBr\nZy5nZXREZWNsYXJlZEFubm90YXRpb25zKCkpIHsKICAgICAgICAgICAgdGFn\nID0gX3RhZ3MuZ2V0KGFubm8uYW5ub3RhdGlvblR5cGUoKSk7CiAgICAgICAg\nICAgIGlmICh0YWcgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaGFuZGxl\nVW5rbm93blBhY2thZ2VBbm5vdGF0aW9uKHBrZywgYW5ubyk7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2UgTkFUSVZFX1FV\nRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkg\nJiYgKHBrZ01vZGUgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhwa2csCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAoKE5hbWVkTmF0aXZlUXVlcmllcykg\nYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSWToKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVf\nUVVFUlkpID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTmFt\nZWROYXRpdmVRdWVyaWVzKHBrZywgKE5hbWVkTmF0aXZlUXVlcnkpIGFubm8p\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBRVUVSSUVTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5\nTW9kZSgpICYmIChwa2dNb2RlICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAg\nICAgICAgICAgICAgICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMocGtnLCAoKE5h\nbWVkUXVlcmllcykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJZOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChwa2dNb2RlICYg\nTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcGFy\nc2VOYW1lZFF1ZXJpZXMocGtnLCAoTmFtZWRRdWVyeSkgYW5ubyk7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNF\nUV9HRU5FUkFUT1I6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFwcGlu\nZ092ZXJyaWRlTW9kZSgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChw\na2dNb2RlICYgTU9ERV9NQVBQSU5HKSA9PSAwKQogICAgICAgICAgICAgICAg\nICAgICAgICBwYXJzZVNlcXVlbmNlR2VuZXJhdG9yKHBrZywgKFNlcXVlbmNl\nR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bnN1\ncHBvcnRlZCIsIHBrZywKICAgICAgICAgICAgICAgICAgICAgICAgYW5uby50\nb1N0cmluZygpKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIGFsd2F5cyBwYXJzZSBtYXBwaW5nIHN0dWZmIGFmdGVyIG1ldGFkYXRh\nIHN0dWZmLCBpbiBjYXNlIHRoZXJlIGFyZQogICAgICAgIC8vIGRlcGVuZGVu\nY2llcyBvbiBtZXRhZGF0YQogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlk\nZU1vZGUoKSAmJiAocGtnTW9kZSAmIE1PREVfTUFQUElORykgPT0gMCkKICAg\nICAgICAgICAgcGFyc2VQYWNrYWdlTWFwcGluZ0Fubm90YXRpb25zKHBrZyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBwYWNrYWdlIG1hcHBpbmcg\nYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHBhcnNl\nUGFja2FnZU1hcHBpbmdBbm5vdGF0aW9ucyhQYWNrYWdlIHBrZykgewogICAg\nfQoKICAgIC8qKgogICAgICogQWxsb3cgc3ViY2xhc3NlcyB0byBoYW5kbGUg\ndW5rbm93biBhbm5vdGF0aW9ucy4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaGFuZGxlVW5rbm93blBhY2thZ2VBbm5vdGF0aW9uKFBhY2thZ2Ug\ncGtnLAogICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzb3VyY2UgbW9k\nZSBmb3IgdGhlIGdpdmVuIHBhY2thZ2UuCiAgICAgKi8KICAgIHByaXZhdGUg\naW50IGdldFNvdXJjZU1vZGUoUGFja2FnZSBwa2cpIHsKICAgICAgICBOdW1i\nZXIgbnVtID0gX3BrZ3MuZ2V0KHBrZyk7CiAgICAgICAgcmV0dXJuIChudW0g\nPT0gbnVsbCkgPyAwIDogbnVtLmludFZhbHVlKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgdG8gdGhlIHNvdXJjZSBtb2RlIGZvciB0aGUgZ2l2ZW4g\ncGFja2FnZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFNvdXJjZU1v\nZGUoUGFja2FnZSBwa2csIGludCBtb2RlKSB7CiAgICAgICAgSW50ZWdlciBu\ndW0gPSBfcGtncy5nZXQocGtnKTsKICAgICAgICBpZiAobnVtID09IG51bGwp\nCiAgICAgICAgICAgIG51bSA9IE51bWJlcnMudmFsdWVPZihtb2RlKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIG51bSA9IE51bWJlcnMudmFsdWVPZihu\ndW0uaW50VmFsdWUoKSB8IG1vZGUpOwogICAgICAgIF9wa2dzLnB1dChwa2cs\nIG51bSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIGFubm90YXRpb25z\nIGZvciB0aGUgY3VycmVudCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIENs\nYXNzTWV0YURhdGEgcGFyc2VDbGFzc0Fubm90YXRpb25zKCkgewogICAgICAg\nIC8vIGNoZWNrIGltbWVkaWF0ZWx5IHdoZXRoZXIgdGhlIHVzZXIgaXMgdXNp\nbmcgYW55IGFubm90YXRpb25zLAogICAgICAgIC8vIHJlZ2FyZGxlc3Mgb2Yg\nbW9kZS4gIHRoaXMgcHJldmVudHMgYWRkaW5nIG5vbi1lbnRpdHkgY2xhc3Nl\ncyB0bwogICAgICAgIC8vIHJlcG9zaXRvcnkgaWYgd2UncmUgaWdub3Jpbmcg\ndGhlc2UgYW5ub3RhdGlvbnMgaW4gbWFwcGluZyBtb2RlCiAgICAgICAgaWYg\nKCEoKEJvb2xlYW4pIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoy\nRG9Qcml2NUhlbHBlcgogICAgICAgICAgICAuaXNBbm5vdGF0aW9uUHJlc2Vu\ndEFjdGlvbihfY2xzLCBFbnRpdHkuY2xhc3MpKSkuYm9vbGVhblZhbHVlKCkK\nICAgICAgICAgICAgJiYgISgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5k\nb1ByaXZpbGVnZWQoSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAu\naXNBbm5vdGF0aW9uUHJlc2VudEFjdGlvbihfY2xzLCBFbWJlZGRhYmxlLmNs\nYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkKICAgICAg\nICAgICAgJiYgISgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAuaXNBbm5v\ndGF0aW9uUHJlc2VudEFjdGlvbihfY2xzLCBNYXBwZWRTdXBlcmNsYXNzLmNs\nYXNzKSkpCiAgICAgICAgICAgICAgICAuYm9vbGVhblZhbHVlKCkpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyBmaW5kIC8gY3JlYXRl\nIG1ldGFkYXRhCiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0TWV0\nYURhdGEoKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgRW50aXR5IGVudGl0eSA9IChFbnRp\ndHkpIF9jbHMuZ2V0QW5ub3RhdGlvbihFbnRpdHkuY2xhc3MpOwogICAgICAg\nIGlmIChpc01ldGFEYXRhTW9kZSgpKSB7CiAgICAgICAgICAgIC8vIHdoaWxl\nIHRoZSBzcGVjIG9ubHkgcHJvdmlkZXMgZm9yIGVtYmVkZGVkIGV4Y2x1c2l2\nZSwgaXQgZG9lc24ndAogICAgICAgICAgICAvLyBzZWVtIGhhcmQgdG8gc3Vw\ncG9ydCBvdGhlcndpc2UKICAgICAgICAgICAgaWYgKGVudGl0eSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgbWV0YS5zZXRFbWJlZGRlZE9ubHkodHJ1ZSk7\nCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbWV0YS5zZXRF\nbWJlZGRlZE9ubHkoZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKCFTdHJp\nbmdVdGlscy5pc0VtcHR5KGVudGl0eS5uYW1lKCkpKQogICAgICAgICAgICAg\nICAgICAgIG1ldGEuc2V0VHlwZUFsaWFzKGVudGl0eS5uYW1lKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0cmFjayBmZXRjaCBn\ncm91cHMgdG8gcGFyc2UgdGhlbSBhZnRlciBmaWVsZHMsIHNpbmNlIHRoZXkK\nICAgICAgICAvLyByZWx5IG9uIGZpZWxkIG1ldGFkYXRhCiAgICAgICAgRmV0\nY2hHcm91cFtdIGZncyA9IG51bGw7CiAgICAgICAgRGV0YWNoZWRTdGF0ZSBk\nZXRhY2hlZCA9IG51bGw7CgogICAgICAgIC8vIHRyYWNrIGxpc3RlbmVycyBz\naW5jZSB3ZSBuZWVkIHRvIG1lcmdlIHRoZW0gd2l0aCBlbnRpdHkgY2FsbGJh\nY2tzCiAgICAgICAgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10g\nbGlzdGVuZXJzID0gbnVsbDsKICAgICAgICBNZXRhRGF0YVRhZyB0YWc7CiAg\nICAgICAgZm9yIChBbm5vdGF0aW9uIGFubm8gOiBfY2xzLmdldERlY2xhcmVk\nQW5ub3RhdGlvbnMoKSkgewogICAgICAgICAgICB0YWcgPSBfdGFncy5nZXQo\nYW5uby5hbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgaWYgKHRhZyA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVVbmtub3duQ2xhc3NB\nbm5vdGF0aW9uKG1ldGEsIGFubm8pOwogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7\nCiAgICAgICAgICAgICAgICBjYXNlIEVOVElUWV9MSVNURU5FUlM6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGxpc3RlbmVycyA9IHBhcnNlRW50aXR5TGlzdGVu\nZXJzKG1ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoRW50aXR5\nTGlzdGVuZXJzKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgICAgIGNhc2UgRVhDTFVERV9ERUZBVUxUX0xJU1RFTkVS\nUzoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRMaWZlY3ljbGVNZXRh\nRGF0YSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0SWdub3Jl\nU3lzdGVtTGlzdGVuZXJzKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFWENMVURFX1NVUEVSQ0xBU1Nf\nTElTVEVORVJTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBtZXRhLmdldExpZmVj\neWNsZU1ldGFEYXRhKCkuc2V0SWdub3JlU3VwZXJjbGFzc0NhbGxiYWNrcwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKExpZmVjeWNsZU1ldGFEYXRh\nLklHTk9SRV9ISUdIKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRkxVU0hfTU9ERToKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgd2FybkZsdXNoTW9kZShtZXRhKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSURfQ0xBU1M6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIG1ldGEuc2V0T2JqZWN0SWRUeXBlKCgoSWRDbGFz\ncykgYW5ubykudmFsdWUoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSSUVTOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpICYmIChtZXRh\nLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfUVVFUlkpID09IDApCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhcnNlTmFtZWROYXRpdmVRdWVyaWVzKF9jbHMs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKE5hbWVkTmF0aXZlUXVl\ncmllcykgYW5ubykudmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIE5BVElWRV9RVUVSWToKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAobWV0YS5nZXRT\nb3VyY2VNb2RlKCkgJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZU5hbWVkTmF0aXZlUXVlcmllcyhfY2xzLCAoTmFt\nZWROYXRpdmVRdWVyeSkgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFFVRVJJRVM6CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGlzUXVlcnlNb2RlKCkgJiYgKG1ldGEuZ2V0U291cmNl\nTW9kZSgpICYgTU9ERV9RVUVSWSkgPT0gMCkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGFyc2VOYW1lZFF1ZXJpZXMoX2NscywgKChOYW1lZFF1ZXJpZXMp\nIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBRVUVSWToKICAgICAgICAgICAgICAgICAg\nICBpZiAoaXNRdWVyeU1vZGUoKSAmJiAobWV0YS5nZXRTb3VyY2VNb2RlKCkg\nJiBNT0RFX1FVRVJZKSA9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBw\nYXJzZU5hbWVkUXVlcmllcyhfY2xzLCAoTmFtZWRRdWVyeSkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFNFUV9HRU5FUkFUT1I6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFw\ncGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBw\nYXJzZVNlcXVlbmNlR2VuZXJhdG9yKF9jbHMsIChTZXF1ZW5jZUdlbmVyYXRv\ncikgYW5ubyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIERBVEFfQ0FDSEU6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBhcnNlRGF0YUNhY2hlKG1ldGEsIChEYXRhQ2FjaGUpIGFubm8pOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBE\nQVRBU1RPUkVfSUQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURh\ndGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlRGF0YVN0\nb3JlSWQobWV0YSwgKERhdGFTdG9yZUlkKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgREVUQUNIRURf\nU1RBVEU6CiAgICAgICAgICAgICAgICAgICAgZGV0YWNoZWQgPSAoRGV0YWNo\nZWRTdGF0ZSkgYW5ubzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgRkVUQ0hfR1JPVVA6CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZncyA9IG5ldyBGZXRjaEdyb3VwW117IChGZXRjaEdyb3VwKSBh\nbm5vIH07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEZFVENIX0dST1VQUzoKICAgICAgICAgICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nZmdzID0gKChGZXRjaEdyb3VwcykgYW5ubykudmFsdWUoKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTUFOQUdF\nRF9JTlRFUkZBQ0U6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWV0YURh\ndGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlTWFuYWdl\nZEludGVyZmFjZShtZXRhLCAoTWFuYWdlZEludGVyZmFjZSkgYW5ubyk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBwb3J0ZWQiLCBfY2xzLAogICAg\nICAgICAgICAgICAgICAgICAgICBhbm5vLnRvU3RyaW5nKCkpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWV0YURhdGFNb2Rl\nKCkpIHsKICAgICAgICAgICAgcGFyc2VEZXRhY2hlZFN0YXRlKG1ldGEsIGRl\ndGFjaGVkKTsKCiAgICAgICAgICAgIC8vIG1lcmdlIGNhbGxiYWNrIG1ldGhv\nZHMgd2l0aCBkZWNsYXJlZCBsaXN0ZW5lcnMKICAgICAgICAgICAgaW50W10g\naGlnaHMgPSBudWxsOwogICAgICAgICAgICBpZiAobGlzdGVuZXJzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGhpZ2hzID0gbmV3IGludFtsaXN0ZW5l\ncnMubGVuZ3RoXTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAg\nIGlmIChsaXN0ZW5lcnNbaV0gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgaGlnaHNbaV0gPSBsaXN0ZW5lcnNbaV0uc2l6ZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJlY29yZENhbGxiYWNrcyhtZXRhLCBwYXJz\nZUNhbGxiYWNrTWV0aG9kcyhfY2xzLCBsaXN0ZW5lcnMsIGZhbHNlLAogICAg\nICAgICAgICAgICAgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIGhpZ2hzLCBm\nYWxzZSk7CgogICAgICAgICAgICAvLyBzY2FuIHBvc3NpYmx5IG5vbi1QQyBo\naWVyYXJjaHkgZm9yIGNhbGxiYWNrcy4KICAgICAgICAgICAgLy8gcmVkdW5k\nYW50IGZvciBQQyBzdXBlcmNsYXNzIGJ1dCB3ZSBkb24ndCBrbm93IHRoYXQg\neWV0CiAgICAgICAgICAgIC8vIHNvIGxldCBMaWZlY3ljbGVNZXRhRGF0YSBk\nZXRlcm1pbmUgdGhhdAogICAgICAgICAgICBpZiAoX2Nscy5nZXRTdXBlcmNs\nYXNzKCkgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgIU9iamVjdC5jbGFz\ncy5lcXVhbHMoX2Nscy5nZXRTdXBlcmNsYXNzKCkpKSB7CiAgICAgICAgICAg\nICAgICByZWNvcmRDYWxsYmFja3MobWV0YSwgcGFyc2VDYWxsYmFja01ldGhv\nZHMoX2Nscy5nZXRTdXBlcmNsYXNzKCksCiAgICAgICAgICAgICAgICAgICAg\nbnVsbCwgdHJ1ZSwgZmFsc2UsIGdldFJlcG9zaXRvcnkoKSksIG51bGwsIHRy\ndWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKEZp\nZWxkTWV0YURhdGEgZm1kIDogbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpKQog\nICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9PSBGaWVsZE1l\ndGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgcGFy\nc2VNZW1iZXJBbm5vdGF0aW9ucyhmbWQpOwogICAgICAgIC8vIHBhcnNlIGZl\ndGNoIGdyb3VwcyBhZnRlciBmaWVsZHMKICAgICAgICBpZiAoZmdzICE9IG51\nbGwpCiAgICAgICAgICAgIHBhcnNlRmV0Y2hHcm91cHMobWV0YSwgZmdzKTsK\nCiAgICAgICAgLy8gYWx3YXlzIHBhcnNlIG1hcHBpbmcgYWZ0ZXIgbWV0YWRh\ndGEgaW4gY2FzZSB0aGVyZSBhcmUgZGVwZW5kZW5jaWVzCiAgICAgICAgaWYg\nKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKSB7CiAgICAgICAgICAgIHBhcnNl\nQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMobWV0YSk7CiAgICAgICAgICAgIGZv\nciAoRmllbGRNZXRhRGF0YSBmbWQgOiBtZXRhLmdldERlY2xhcmVkRmllbGRz\nKCkpCiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1lbnQoKSA9\nPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAg\nICAgICAgICAgIHBhcnNlTWVtYmVyTWFwcGluZ0Fubm90YXRpb25zKGZtZCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8q\nKgogICAgICogUGFyc2UgY2xhc3MgbWFwcGluZyBhbm5vdGF0aW9ucy4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VDbGFzc01hcHBpbmdBbm5v\ndGF0aW9ucyhDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24gYW5u\nb3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhhbmRs\nZVVua25vd25DbGFzc0Fubm90YXRpb24oQ2xhc3NNZXRhRGF0YSBtZXRhLAog\nICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpbmQgb3IgY3JlYXRlIG1ldGFk\nYXRhIGZvciB0aGUgZ2l2ZW4gdHlwZS4gTWF5IHJldHVybiBudWxsIGlmCiAg\nICAgKiB0aGlzIGNsYXNzIGhhcyBhbHJlYWR5IGJlZW4gcGFyc2VkIGZ1bGx5\nLgogICAgICovCiAgICBwcml2YXRlIENsYXNzTWV0YURhdGEgZ2V0TWV0YURh\ndGEoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3Np\ndG9yeSgpLmdldENhY2hlZE1ldGFEYXRhKF9jbHMpOwogICAgICAgIGlmICht\nZXRhICE9IG51bGwgJiYKICAgICAgICAgICAgKChpc01ldGFEYXRhTW9kZSgp\nICYmIChtZXRhLmdldFNvdXJjZU1vZGUoKSAmIE1PREVfTUVUQSkgIT0gMCkg\nfHwKICAgICAgICAgICAgICAgIChpc01hcHBpbmdNb2RlKCkgJiYKICAgICAg\nICAgICAgICAgICAgICAobWV0YS5nZXRTb3VyY2VNb2RlKCkgJiBNT0RFX01B\nUFBJTkcpICE9IDApKSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1dhcm5F\nbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQo\nImR1cC1tZXRhZGF0YSIsIF9jbHMuZ2V0TmFtZSgpKSk7CiAgICAgICAgICAg\nIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1ldGEgPT0g\nbnVsbCkgewogICAgICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmFk\nZE1ldGFEYXRhKF9jbHMpOwogICAgICAgICAgICBtZXRhLnNldEVudkNsYXNz\nTG9hZGVyKF9lbnZMb2FkZXIpOwogICAgICAgICAgICBtZXRhLnNldFNvdXJj\nZU1vZGUoTU9ERV9OT05FKTsKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2Uo\nZ2V0U291cmNlRmlsZSgpLCBtZXRhLlNSQ19BTk5PVEFUSU9OUyk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBtZXRhOwogICAgfQoKICAgIC8qKgogICAg\nICogRGV0ZXJtaW5lIHRoZSBzb3VyY2UgZmlsZSB3ZSdyZSBwYXJzaW5nLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewog\nICAgICAgIGlmIChfZmlsZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nX2ZpbGU7CgogICAgICAgIENsYXNzIGNscyA9IF9jbHM7CiAgICAgICAgd2hp\nbGUgKGNscy5nZXRFbmNsb3NpbmdDbGFzcygpICE9IG51bGwpCiAgICAgICAg\nICAgIGNscyA9IGNscy5nZXRFbmNsb3NpbmdDbGFzcygpOwoKICAgICAgICBT\ndHJpbmcgcnNyYyA9IFN0cmluZ1V0aWxzLnJlcGxhY2UoY2xzLmdldE5hbWUo\nKSwgIi4iLCAiLyIpOwogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IChD\nbGFzc0xvYWRlcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgIEoyRG9Qcml2NUhlbHBlci5nZXRDbGFzc0xvYWRlckFjdGlv\nbihjbHMpKTsgCiAgICAgICAgaWYgKGxvYWRlciA9PSBudWxsKQogICAgICAg\nICAgICBsb2FkZXIgPSAoQ2xhc3NMb2FkZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJEb1ByaXY1SGVscGVy\nLmdldFN5c3RlbUNsYXNzTG9hZGVyQWN0aW9uKCkpOyAKICAgICAgICBpZiAo\nbG9hZGVyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIFVSTCB1cmwgPSAoVVJMKSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmls\nZWdlZCgKICAgICAgICAgICAgSjJEb1ByaXY1SGVscGVyLmdldFJlc291cmNl\nQWN0aW9uKGxvYWRlciwgcnNyYyArICIuamF2YSIpKTsgCiAgICAgICAgaWYg\nKHVybCA9PSBudWxsKSB7CiAgICAgICAgICAgIHVybCA9IChVUkwpIEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgSjJE\nb1ByaXY1SGVscGVyLmdldFJlc291cmNlQWN0aW9uKGxvYWRlciwgcnNyYyAr\nICIuY2xhc3MiKSk7IAogICAgICAgICAgICBpZiAodXJsID09IG51bGwpCiAg\nICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgX2ZpbGUgPSBuZXcgRmlsZSh1cmwudG9VUkko\nKSk7CiAgICAgICAgfSBjYXRjaCAoVVJJU3ludGF4RXhjZXB0aW9uIGUpIHsK\nICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWFl\nKSB7CiAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhyb3duIHdoZW4gdGhlIFVS\nSSBpcyBub24taGllcmFyY2hpY2FsIChha2EgSkJvc3MpCiAgICAgICAgfQog\nICAgICAgIHJldHVybiBfZmlsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBh\ncnNlIEBEYXRhU3RvcmVJZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlRGF0YVN0b3JlSWQoQ2xhc3NNZXRhRGF0YSBtZXRhLCBEYXRhU3RvcmVJ\nZCBpZCkgewogICAgICAgIG1ldGEuc2V0SWRlbnRpdHlUeXBlKENsYXNzTWV0\nYURhdGEuSURfREFUQVNUT1JFKTsKCiAgICAgICAgaW50IHN0cmF0ID0gZ2V0\nR2VuZXJhdGVkVmFsdWVTdHJhdGVneShtZXRhLCBpZC5zdHJhdGVneSgpLAog\nICAgICAgICAgICBpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgaWYgKHN0cmF0\nICE9IC0xKQogICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3ko\nc3RyYXQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBzd2l0Y2ggKGlk\nLnN0cmF0ZWd5KCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgVEFCTEU6CiAg\nICAgICAgICAgICAgICBjYXNlIFNFUVVFTkNFOgogICAgICAgICAgICAgICAg\nICAgIC8vIHRlY2huaWNhbGx5IHdlIHNob3VsZCBoYXZlIHNlcGFyYXRlIHN5\nc3RlbSB0YWJsZSBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5j\nZSBnZW5lcmF0b3JzLCBidXQgaXQncyBlYXNpZXIgdG8ganVzdCByZWx5IG9u\nCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHN5c3RlbSBvcmcuYXBhY2hl\nLm9wZW5qcGEuU2VxdWVuY2Ugc2V0dGluZyBmb3IgYm90aAogICAgICAgICAg\nICAgICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGlkLmdlbmVyYXRv\ncigpKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0\neVNlcXVlbmNlTmFtZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNl\ncXVlbmNlTWV0YURhdGEuTkFNRV9TWVNURU0pOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVu\ndGl0eVNlcXVlbmNlTmFtZShpZC5nZW5lcmF0b3IoKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEFVVE86CiAg\nICAgICAgICAgICAgICAgICAgbWV0YS5zZXRJZGVudGl0eVN0cmF0ZWd5KFZh\nbHVlU3RyYXRlZ2llcy5OQVRJVkUpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBJREVOVElUWToKICAgICAgICAg\nICAgICAgICAgICBtZXRhLnNldElkZW50aXR5U3RyYXRlZ3koVmFsdWVTdHJh\ndGVnaWVzLkFVVE9BU1NJR04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oaWQuc3RyYXRlZ3ko\nKS50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFdhcm4gdGhhdCBARmx1c2hNb2RlIGlzIG5vdCBz\ndXBwb3J0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3YXJuRmx1c2hN\nb2RlKE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoInVu\nc3VwcG9ydGVkIiwgIkZsdXNoTW9kZSIsIGNvbnRleHQpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFBhcnNlIEBEYXRhQ2FjaGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZURhdGFDYWNoZShDbGFzc01ldGFEYXRhIG1ldGEs\nIERhdGFDYWNoZSBjYWNoZSkgewogICAgICAgIGlmIChjYWNoZS50aW1lb3V0\nKCkgIT0gSW50ZWdlci5NSU5fVkFMVUUpCiAgICAgICAgICAgIG1ldGEuc2V0\nRGF0YUNhY2hlVGltZW91dChjYWNoZS50aW1lb3V0KCkpOwogICAgICAgIGlm\nICghU3RyaW5nVXRpbHMuaXNFbXB0eShjYWNoZS5uYW1lKCkpKQogICAgICAg\nICAgICBtZXRhLnNldERhdGFDYWNoZU5hbWUoY2FjaGUubmFtZSgpKTsKICAg\nICAgICBlbHNlIGlmIChjYWNoZS5lbmFibGVkKCkpCiAgICAgICAgICAgIG1l\ndGEuc2V0RGF0YUNhY2hlTmFtZSgKICAgICAgICAgICAgICAgIG9yZy5hcGFj\naGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlLk5BTUVfREVGQVVMVCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBtZXRhLnNldERhdGFDYWNoZU5h\nbWUobnVsbCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFuYWdl\nZEludGVyZmFjZShDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgTWFuYWdl\nZEludGVyZmFjZSBpZmFjZSkgewogICAgICAgIG1ldGEuc2V0TWFuYWdlZElu\ndGVyZmFjZSh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBE\nZXRhY2hlZFN0YXRlLiBUaGUgYW5ub3RhdGlvbiBtYXkgYmUgbnVsbC4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGV0YWNoZWRTdGF0ZShDbGFz\nc01ldGFEYXRhIG1ldGEsCiAgICAgICAgRGV0YWNoZWRTdGF0ZSBkZXRhY2hl\nZCkgewogICAgICAgIGlmIChkZXRhY2hlZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGlmICghZGV0YWNoZWQuZW5hYmxlZCgpKQogICAgICAgICAgICAgICAg\nbWV0YS5zZXREZXRhY2hlZFN0YXRlKG51bGwpOwogICAgICAgICAgICBlbHNl\nIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGRldGFjaGVkLmZpZWxkTmFtZSgp\nKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShDbGFz\nc01ldGFEYXRhLlNZTlRIRVRJQyk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShkZXRhY2hlZC5maWVs\nZE5hbWUoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgRmllbGRb\nXSBmaWVsZHMgPSAoRmllbGRbXSkgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZp\nbGVnZWQoCiAgICAgICAgICAgICAgICBKMkRvUHJpdjVIZWxwZXIuZ2V0RGVj\nbGFyZWRGaWVsZHNBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgbWV0YS5n\nZXREZXNjcmliZWRUeXBlKCkpKTsgCiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAg\naWYgKCgoQm9vbGVhbikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAgICAgLmlzQW5ub3Rh\ndGlvblByZXNlbnRBY3Rpb24oZmllbGRzW2ldLCBEZXRhY2hlZFN0YXRlLmNs\nYXNzKSkpCiAgICAgICAgICAgICAgICAgICAgLmJvb2xlYW5WYWx1ZSgpKQog\nICAgICAgICAgICAgICAgICAgIG1ldGEuc2V0RGV0YWNoZWRTdGF0ZShmaWVs\nZHNbaV0uZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQYXJzZSBARW50aXR5TGlzdGVuZXJzCiAgICAgKi8KICAgIHByaXZh\ndGUgQ29sbGVjdGlvbjxMaWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VFbnRp\ndHlMaXN0ZW5lcnMKICAgICAgICAoQ2xhc3NNZXRhRGF0YSBtZXRhLCBFbnRp\ndHlMaXN0ZW5lcnMgbGlzdGVuZXJzKSB7CiAgICAgICAgQ2xhc3NbXSBjbGFz\nc2VzID0gbGlzdGVuZXJzLnZhbHVlKCk7CiAgICAgICAgQ29sbGVjdGlvbjxM\naWZlY3ljbGVDYWxsYmFja3M+W10gcGFyc2VkID0gbnVsbDsKICAgICAgICBm\nb3IgKENsYXNzIGNscyA6IGNsYXNzZXMpCiAgICAgICAgICAgIHBhcnNlZCA9\nIHBhcnNlQ2FsbGJhY2tNZXRob2RzKGNscywgcGFyc2VkLCB0cnVlLCB0cnVl\nLCAKICAgICAgICAgICAgICAgIGdldFJlcG9zaXRvcnkoKSk7CiAgICAgICAg\ncmV0dXJuIHBhcnNlZDsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGNh\nbGxiYWNrIG1ldGhvZHMgaW50byB0aGUgZ2l2ZW4gYXJyYXksIGFuZCByZXR1\ncm4gdGhhdCBhcnJheSwKICAgICAqIGNyZWF0aW5nIG9uZSBpZiBudWxsLiBF\nYWNoIGluZGV4IGludG8gdGhlIGFycmF5IGlzIGEgY29sbGVjdGlvbiBvZgog\nICAgICogY2FsbGJhY2sgYWRhcHRlcnMgZm9yIHRoYXQgbnVtZXJpYyBldmVu\ndCB0eXBlLgogICAgICoKICAgICAqIEBwYXJhbSBzdXBzIHdoZXRoZXIgdG8g\nc2NhbiBzdXBlcmNsYXNzZXMKICAgICAqIEBwYXJhbSBsaXN0ZW5lciB3aGV0\naGVyIHRoaXMgaXMgYSBsaXN0ZW5lciBvciBub3QKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNrcz5bXSBw\nYXJzZUNhbGxiYWNrTWV0aG9kcwogICAgICAgIChDbGFzcyBjbHMsIENvbGxl\nY3Rpb248TGlmZWN5Y2xlQ2FsbGJhY2tzPltdIGNhbGxiYWNrcywgYm9vbGVh\nbiBzdXBzLAogICAgICAgIGJvb2xlYW4gbGlzdGVuZXIsIE1ldGFEYXRhUmVw\nb3NpdG9yeSByZXBvcykgewoKICAgICAgICBpZiAoY2xzID09IG51bGwpCiAg\nICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24o\nImNscyBjYW5ub3QgYmUgbnVsbCIpOwoKICAgICAgICAvLyBmaXJzdCBzb3J0\nIC8gZmlsdGVyIGJhc2VkIG9uIGluaGVyaXRhbmNlCiAgICAgICAgU2V0PE1l\ndGhvZD4gbWV0aG9kcyA9IG5ldyBUcmVlU2V0PE1ldGhvZD4oTWV0aG9kQ29t\ncGFyYXRvci4KICAgICAgICAgICAgZ2V0SW5zdGFuY2UoKSk7CgogICAgICAg\nIGludCBtb2RzOwogICAgICAgIENsYXNzIHN1cCA9IGNsczsKICAgICAgICBN\nZXRob2RLZXkga2V5OwogICAgICAgIFNldDxNZXRob2RLZXk+IHNlZW4gPSBu\nZXcgSGFzaFNldDxNZXRob2RLZXk+KCk7CiAgICAgICAgZG8gewogICAgICAg\nICAgICBmb3IgKE1ldGhvZCBtIDogKE1ldGhvZFtdKSBBY2Nlc3NDb250cm9s\nbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgIEoyRG9Qcml2NUhl\nbHBlci5nZXREZWNsYXJlZE1ldGhvZHNBY3Rpb24oc3VwKSkpIHsKICAgICAg\nICAgICAgICAgIG1vZHMgPSBtLmdldE1vZGlmaWVycygpOwogICAgICAgICAg\nICAgICAgaWYgKE1vZGlmaWVyLmlzU3RhdGljKG1vZHMpIHx8IE1vZGlmaWVy\nLmlzRmluYWwobW9kcykgfHwKICAgICAgICAgICAgICAgICAgICBPYmplY3Qu\nY2xhc3MuZXF1YWxzKG0uZ2V0RGVjbGFyaW5nQ2xhc3MoKSkpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAga2V5ID0g\nbmV3IE1ldGhvZEtleShtKTsKICAgICAgICAgICAgICAgIGlmICghc2Vlbi5j\nb250YWlucyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kcy5h\nZGQobSk7CiAgICAgICAgICAgICAgICAgICAgc2Vlbi5hZGQoa2V5KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzdXAg\nPSBzdXAuZ2V0U3VwZXJjbGFzcygpOwogICAgICAgIH0gd2hpbGUgKHN1cHMg\nJiYgIU9iamVjdC5jbGFzcy5lcXVhbHMoc3VwKSk7CgogICAgICAgIE1ldGFE\nYXRhRGVmYXVsdHMgZGVmID0gcmVwb3MuZ2V0TWV0YURhdGFGYWN0b3J5KCku\nZ2V0RGVmYXVsdHMoKTsKICAgICAgICBmb3IgKE1ldGhvZCBtIDogbWV0aG9k\ncykgewogICAgICAgICAgICBmb3IgKEFubm90YXRpb24gYW5ubyA6IChBbm5v\ndGF0aW9uW10pIEFjY2Vzc0NvbnRyb2xsZXIKICAgICAgICAgICAgICAgIC5k\nb1ByaXZpbGVnZWQoSjJEb1ByaXY1SGVscGVyCiAgICAgICAgICAgICAgICAg\nICAgLmdldERlY2xhcmVkQW5ub3RhdGlvbnNBY3Rpb24obSkpKSB7CiAgICAg\nICAgICAgICAgICBNZXRhRGF0YVRhZyB0YWcgPSBfdGFncy5nZXQoYW5uby5h\nbm5vdGF0aW9uVHlwZSgpKTsKICAgICAgICAgICAgICAgIGlmICh0YWcgPT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgIGludFtdIGV2ZW50cyA9IE1ldGFEYXRhUGFyc2Vycy5nZXRFdmVu\ndFR5cGVzKHRhZyk7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnRzID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgaWYgKGNhbGxiYWNrcyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nICAgIGNhbGxiYWNrcyA9IChDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxiYWNr\ncz5bXSkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IENvbGxlY3Rpb25b\nTGlmZWN5Y2xlRXZlbnQuQUxMX0VWRU5UUy5sZW5ndGhdOwoKICAgICAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IGUgPSBldmVudHNbaV07CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrc1tlXSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0gPSBuZXcgQXJy\nYXlMaXN0KDMpOwogICAgICAgICAgICAgICAgICAgIE1ldGFEYXRhUGFyc2Vy\ncy52YWxpZGF0ZU1ldGhvZHNGb3JTYW1lQ2FsbGJhY2soY2xzLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2VdLCBtLCB0YWcsIGRlZiwg\ncmVwb3MuZ2V0TG9nKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0\nZW5lcikgewogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbZV0u\nYWRkKG5ldyBCZWFuTGlmZWN5Y2xlQ2FsbGJhY2tzKGNscywgbSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKSk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJh\nY2tzW2VdLmFkZChuZXcgTWV0aG9kTGlmZWN5Y2xlQ2FsbGJhY2tzKG0sCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSkpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsbGJhY2tzOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFN0b3JlIGxpZmVjeWNsZSBtZXRhZGF0YS4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY29yZENhbGxiYWNrcyhDbGFzc01l\ndGFEYXRhIGNscywKICAgICAgICBDb2xsZWN0aW9uPExpZmVjeWNsZUNhbGxi\nYWNrcz5bXSBjYWxsYmFja3MsIGludFtdIGhpZ2hzLAogICAgICAgIGJvb2xl\nYW4gc3VwZXJDbGFzcykgewogICAgICAgIGlmIChjYWxsYmFja3MgPT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIExpZmVjeWNsZU1ldGFE\nYXRhIG1ldGEgPSBjbHMuZ2V0TGlmZWN5Y2xlTWV0YURhdGEoKTsKICAgICAg\nICBMaWZlY3ljbGVDYWxsYmFja3NbXSBhcnJheTsKICAgICAgICBmb3IgKGlu\ndCBldmVudCA6IExpZmVjeWNsZUV2ZW50LkFMTF9FVkVOVFMpIHsKICAgICAg\nICAgICAgaWYgKGNhbGxiYWNrc1tldmVudF0gPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBhcnJheSA9IGNhbGxiYWNr\nc1tldmVudF0udG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBMaWZlY3lj\nbGVDYWxsYmFja3NbY2FsbGJhY2tzW2V2ZW50XS5zaXplKCldKTsKCiAgICAg\nICAgICAgIGlmIChzdXBlckNsYXNzKSB7CiAgICAgICAgICAgICAgICBtZXRh\nLnNldE5vblBDU3VwZXJjbGFzc0NhbGxiYWNrcyhldmVudCwgYXJyYXksCiAg\nICAgICAgICAgICAgICAgICAgKGhpZ2hzID09IG51bGwpID8gMCA6IGhpZ2hz\nW2V2ZW50XSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBtZXRhLnNldERlY2xhcmVkQ2FsbGJhY2tzKGV2ZW50LCBhcnJheSwKICAg\nICAgICAgICAgICAgICAgICAoaGlnaHMgPT0gbnVsbCkgPyAwIDogaGlnaHNb\nZXZlbnRdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENyZWF0ZSBmZXRjaCBncm91cHMuCiAgICAgKiBJZiBGZXRj\naEdyb3VwIEEgaW5jbHVkZXMgRmV0Y2hHcm91cCBCLCB0aGVuIGEgYmktbGlu\nayBpcyBzZXQgYmV0d2VlbgogICAgICogQSBhbmQgQi4gQm90aCBBIGFuZCBC\nIG11c3QgYmUgZGVjbGFyZWQgaW4gdGhlIHNhbWUgQ2xhc3MuIAogICAgICog\nPGJyPgogICAgICogQ2FsbCB7QGxpbmsgI3BhcnNlRmV0Y2hBdHRyaWJ1dGUo\nQ2xhc3NNZXRhRGF0YSwgCiAgICAgKiBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS5GZXRjaEdyb3VwLCBGZXRjaEF0dHJpYnV0ZSkgb25seSBhZnRlciB0aGUK\nICAgICAqIGJpLWxpbmtzIGhhdmUgYmVlbiBlc3RhYmxpc2hlZCwgYmVjYXVz\nZSBhIGZpZWxkIGYgd2lsbCBub3Qgb25seSBhZGQgdGhlCiAgICAgKiBmZXRj\naCBncm91cCBBIHdoaWNoIGV4cGxpY3RseSBpbmNsdWRlcyBmIHRvIGl0cyBj\ndXN0b20gZmV0Y2ggZ3JvdXBzIGJ1dCAKICAgICAqIGFsc28gd2lsbCBhbHNv\nIGFkZCBhbnkgZmV0Y2ggZ3JvdXAgQiB0aGF0IGluY2x1ZGVzIEEuICAKICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlRmV0Y2hHcm91cHMoQ2xhc3NN\nZXRhRGF0YSBtZXRhLCBGZXRjaEdyb3VwLi4uIGdyb3VwcykgewogICAgICAg\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZldGNoR3JvdXAgZmc7CiAgICAg\nICAgZm9yIChGZXRjaEdyb3VwIGdyb3VwIDogZ3JvdXBzKSB7CiAgICAgICAg\nICAgIGlmIChTdHJpbmdVdGlscy5pc0VtcHR5KGdyb3VwLm5hbWUoKSkpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xv\nYy5nZXQoInVubmFtZWQtZmciLCBtZXRhKSk7CgogICAgICAgICAgICBmZyA9\nIG1ldGEuYWRkRGVjbGFyZWRGZXRjaEdyb3VwKGdyb3VwLm5hbWUoKSk7CiAg\nICAgICAgICAgIGlmIChncm91cC5wb3N0TG9hZCgpKQogICAgICAgICAgICAg\nICAgZmcuc2V0UG9zdExvYWQodHJ1ZSk7IAogICAgICAgICAgICBmb3IgKFN0\ncmluZyBzIDogZ3JvdXAuZmV0Y2hHcm91cHMoKSkgewogICAgICAgICAgICAg\nICAgZmcuYWRkRGVjbGFyZWRJbmNsdWRlKHMpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIC8vIEFkZCB0aGUgcGFyZW50LWNoaWxkIHN0eWxl\nIGJpLWxpbmtzIGJldHdlZW4gZmV0Y2ggZ3JvdXBzIGluIGEgCiAgICAgICAg\nLy8gc2VwYXJhdGUgcGFzcy4gCiAgICAgICAgZm9yIChGZXRjaEdyb3VwIGdy\nb3VwOmdyb3VwcykgewogICAgICAgIAlmZyA9IG1ldGEuZ2V0RmV0Y2hHcm91\ncChncm91cC5uYW1lKCkpOwogICAgICAgIAlTdHJpbmdbXSBpbmNsdWRlZEZl\ndGNoR3JvcE5hbWVzID0gZmcuZ2V0RGVjbGFyZWRJbmNsdWRlcygpOwogICAg\nICAgIAlmb3IgKFN0cmluZyBpbmNsdWRlZEZlY3RjaEdyb3VwTmFtZTppbmNs\ndWRlZEZldGNoR3JvcE5hbWVzKSB7CiAgICAgICAgCQlvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5GZXRjaEdyb3VwIGNoaWxkID0KICAgICAgICAJICAgIG1l\ndGEuZ2V0RmV0Y2hHcm91cChpbmNsdWRlZEZlY3RjaEdyb3VwTmFtZSk7CiAg\nICAgICAgCQlpZiAoY2hpbGQgPT0gbnVsbCkgCiAgICAgICAgCQkJdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1pc3NpbmctaW5jbHVkZWQt\nZmciLCAKICAgICAgICAJCQkJbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0\nTmFtZSgpLCBmZy5nZXROYW1lKCksCiAgICAgICAgCQkJCWluY2x1ZGVkRmVj\ndGNoR3JvdXBOYW1lKSk7CiAgICAgICAgCQljaGlsZC5hZGRDb250YWluZWRC\neShmZyk7CiAgICAgICAgCX0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\nZm9yIChGZXRjaEdyb3VwIGdyb3VwIDogZ3JvdXBzKSB7CiAgICAgICAgICAg\nIGZnID0gbWV0YS5nZXRGZXRjaEdyb3VwKGdyb3VwLm5hbWUoKSk7CiAgICAg\nICAgICAgIGZvciAoRmV0Y2hBdHRyaWJ1dGUgYXR0ciA6IGdyb3VwLmF0dHJp\nYnV0ZXMoKSkKICAgICAgICAgICAgICAgIHBhcnNlRmV0Y2hBdHRyaWJ1dGUo\nbWV0YSwgZmcsIGF0dHIpOwogICAgICAgIH0KICAgIH0KICAgIAoKICAgIC8q\nKgogICAgICogU2V0IGEgZmllbGQncyBmZXRjaCBncm91cC4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlRmV0Y2hBdHRyaWJ1dGUoQ2xhc3NNZXRh\nRGF0YSBtZXRhLCAKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5G\nZXRjaEdyb3VwIGZnLCBGZXRjaEF0dHJpYnV0ZSBhdHRyKSB7CiAgICAgICAg\nRmllbGRNZXRhRGF0YSBmaWVsZCA9IG1ldGEuZ2V0RGVjbGFyZWRGaWVsZChh\ndHRyLm5hbWUoKSk7CiAgICAgICAgaWYgKGZpZWxkID09IG51bGwKICAgICAg\nICAgICAgfHwgZmllbGQuZ2V0TWFuYWdlbWVudCgpICE9IEZpZWxkTWV0YURh\ndGEuTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgIHRocm93IG5ldyBN\nZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWZnLWZpZWxkIiwgZmcu\nZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgbWV0YSwgYXR0ci5uYW1lKCkp\nKTsKCiAgICAgICAgZmllbGQuc2V0SW5GZXRjaEdyb3VwKGZnLmdldE5hbWUo\nKSwgdHJ1ZSk7CiAgICAgICAgU2V0IHBhcmVudEZldGNoR3JvdXBzID0gZmcu\nZ2V0Q29udGFpbmVkQnkoKTsKICAgICAgICBmb3IgKE9iamVjdCBwYXJlbnRG\nZXRjaEdyb3VwOnBhcmVudEZldGNoR3JvdXBzKQogICAgICAgIAlmaWVsZC5z\nZXRJbkZldGNoR3JvdXAocGFyZW50RmV0Y2hHcm91cC50b1N0cmluZygpLCB0\ncnVlKTsKICAgICAgICBpZiAoYXR0ci5yZWN1cnNpb25EZXB0aCgpICE9IElu\ndGVnZXIuTUlOX1ZBTFVFKQogICAgICAgICAgICBmZy5zZXRSZWN1cnNpb25E\nZXB0aChmaWVsZCwgYXR0ci5yZWN1cnNpb25EZXB0aCgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlYWQgYW5ub3RhdGlvbnMgZm9yIHRoZSBnaXZlbiBt\nZW1iZXIuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1lbWJlckFu\nbm90YXRpb25zKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgLy8gbG9v\nayBmb3IgcGVyc2lzdGVuY2Ugc3RyYXRlZ3kgaW4gYW5ub3RhdGlvbiB0YWJs\nZQogICAgICAgIE1lbWJlciBtZW1iZXIgPSBnZXRSZXBvc2l0b3J5KCkuZ2V0\nTWV0YURhdGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS4KICAgICAgICAgICAg\nZ2V0QmFja2luZ01lbWJlcihmbWQpOwogICAgICAgIFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kgcHN0cmF0ID0gUGVyc2lzdGVuY2VNZXRhRGF0YURlZmF1bHRzLgog\nICAgICAgICAgICBnZXRQZXJzaXN0ZW5jZVN0cmF0ZWd5KGZtZCwgbWVtYmVy\nKTsKICAgICAgICBpZiAocHN0cmF0ID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBmbWQuc2V0RXhwbGljaXQodHJ1ZSk7CgogICAgICAg\nIEFubm90YXRlZEVsZW1lbnQgZWwgPSAoQW5ub3RhdGVkRWxlbWVudCkgbWVt\nYmVyOwogICAgICAgIGJvb2xlYW4gbG9iID0gKChCb29sZWFuKSBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJpdjVIZWxwZXIKICAgICAg\nICAgICAgLmlzQW5ub3RhdGlvblByZXNlbnRBY3Rpb24oZWwsIExvYi5jbGFz\ncykpKS5ib29sZWFuVmFsdWUoKTsKICAgICAgICBpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkgewogICAgICAgICAgICBzd2l0Y2ggKHBzdHJhdCkgewogICAgICAg\nICAgICAgICAgY2FzZSBCQVNJQzoKICAgICAgICAgICAgICAgICAgICBwYXJz\nZUJhc2ljKGZtZCwgKEJhc2ljKSBlbC5nZXRBbm5vdGF0aW9uKEJhc2ljLmNs\nYXNzKSwgbG9iKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgTUFOWV9PTkU6CiAgICAgICAgICAgICAgICAgICAg\ncGFyc2VNYW55VG9PbmUoZm1kLCAoTWFueVRvT25lKSBlbC5nZXRBbm5vdGF0\naW9uCiAgICAgICAgICAgICAgICAgICAgICAgIChNYW55VG9PbmUuY2xhc3Mp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgT05FX09ORToKICAgICAgICAgICAgICAgICAgICBwYXJzZU9uZVRv\nT25lKGZtZCwgKE9uZVRvT25lKSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAg\nICAgICAgICAgICAgICAgIChPbmVUb09uZS5jbGFzcykpOwogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBFTUJFRERF\nRDoKICAgICAgICAgICAgICAgICAgICBwYXJzZUVtYmVkZGVkKGZtZCwgKEVt\nYmVkZGVkKSBlbC5nZXRBbm5vdGF0aW9uCiAgICAgICAgICAgICAgICAgICAg\nICAgIChFbWJlZGRlZC5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPTkVfTUFOWToKICAgICAgICAg\nICAgICAgICAgICBwYXJzZU9uZVRvTWFueShmbWQsIChPbmVUb01hbnkpIGVs\nLmdldEFubm90YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgKE9uZVRv\nTWFueS5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBNQU5ZX01BTlk6CiAgICAgICAgICAgICAgICAg\nICAgcGFyc2VNYW55VG9NYW55KGZtZCwgKE1hbnlUb01hbnkpIGVsLmdldEFu\nbm90YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgKE1hbnlUb01hbnku\nY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgUEVSUzoKICAgICAgICAgICAgICAgICAgICBwYXJzZVBl\ncnNpc3RlbnQoZm1kLCAoUGVyc2lzdGVudCkgZWwuZ2V0QW5ub3RhdGlvbgog\nICAgICAgICAgICAgICAgICAgICAgICAoUGVyc2lzdGVudC5jbGFzcykpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBQRVJTX0NPTEw6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VQZXJzaXN0\nZW50Q29sbGVjdGlvbihmbWQsIChQZXJzaXN0ZW50Q29sbGVjdGlvbikKICAg\nICAgICAgICAgICAgICAgICAgICAgZWwuZ2V0QW5ub3RhdGlvbihQZXJzaXN0\nZW50Q29sbGVjdGlvbi5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQRVJTX01BUDoKICAgICAgICAg\nICAgICAgICAgICBwYXJzZVBlcnNpc3RlbnRNYXAoZm1kLCAoUGVyc2lzdGVu\ndE1hcCkKICAgICAgICAgICAgICAgICAgICAgICAgZWwuZ2V0QW5ub3RhdGlv\nbihQZXJzaXN0ZW50TWFwLmNsYXNzKSk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFRSQU5TSUVOVDoKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChp\nc01hcHBpbmdPdmVycmlkZU1vZGUoKSAmJiBsb2IpCiAgICAgICAgICAgIHBh\ncnNlTG9iTWFwcGluZyhmbWQpOwoKICAgICAgICAvLyBleHRlbnNpb25zCiAg\nICAgICAgTWV0YURhdGFUYWcgdGFnOwogICAgICAgIGZvciAoQW5ub3RhdGlv\nbiBhbm5vIDogZWwuZ2V0RGVjbGFyZWRBbm5vdGF0aW9ucygpKSB7CiAgICAg\nICAgICAgIHRhZyA9IF90YWdzLmdldChhbm5vLmFubm90YXRpb25UeXBlKCkp\nOwogICAgICAgICAgICBpZiAodGFnID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGhhbmRsZVVua25vd25NZW1iZXJBbm5vdGF0aW9uKGZtZCwgYW5ubyk7\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nRkxVU0hfTU9ERToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgd2FybkZsdXNoTW9k\nZShmbWQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBHRU5FUkFURURfVkFMVUU6CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGlzTWFwcGluZ092ZXJyaWRlTW9kZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJzZUdlbmVyYXRlZFZhbHVlKGZtZCwgKEdlbmVyYXRl\nZFZhbHVlKSBhbm5vKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIGNhc2UgSUQ6CiAgICAgICAgICAgICAgICBjYXNlIEVN\nQkVEREVEX0lEOgogICAgICAgICAgICAgICAgICAgIGZtZC5zZXRQcmltYXJ5\nS2V5KHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBNQVBfS0VZOgogICAgICAgICAgICAgICAgICAgIGlm\nIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgcGFyc2VNYXBLZXkoZm1kLCAoTWFwS2V5KSBhbm5vKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT1JE\nRVJfQlk6CiAgICAgICAgICAgICAgICAgICAgcGFyc2VPcmRlckJ5KGZtZCwK\nICAgICAgICAgICAgICAgICAgICAgICAgKE9yZGVyQnkpIGVsLmdldEFubm90\nYXRpb24oT3JkZXJCeS5jbGFzcykpOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTRVFfR0VORVJBVE9SOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlkZU1vZGUoKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VTZXF1ZW5jZUdlbmVyYXRv\ncihlbCwgKFNlcXVlbmNlR2VuZXJhdG9yKSBhbm5vKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVkVSU0lPTjoK\nICAgICAgICAgICAgICAgICAgICBmbWQuc2V0VmVyc2lvbih0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nREVQRU5ERU5UOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRh\nTW9kZSgpICYmICgoRGVwZW5kZW50KSBhbm5vKS52YWx1ZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0Q2FzY2FkZURlbGV0ZShWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfQVVUTyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEVMRU1fREVQRU5ERU5UOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpICYmICgoRWxl\nbWVudERlcGVuZGVudCkgYW5ubykudmFsdWUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRDYXNjYWRlRGVsZXRlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAoVmFsdWVNZXRhRGF0YS5DQVND\nQURFX0FVVE8pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBFTEVNX1RZUEU6CiAgICAgICAgICAgICAgICAgICAg\naWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZtZC5nZXRFbGVtZW50KCkuc2V0VHlwZU92ZXJyaWRlKHRvT3ZlcnJpZGVU\neXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKChFbGVtZW50VHlw\nZSkgYW5ubykudmFsdWUoKSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBFWFRFUk5BTF9WQUxTOgogICAgICAg\nICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBmbWQuc2V0RXh0ZXJuYWxWYWx1ZXMoU3RyaW5ncy5q\nb2luKCgoRXh0ZXJuYWxWYWx1ZXMpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBhbm5vKS52YWx1ZSgpLCAiLCIpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRVhURVJOQUxJWkVSOgog\nICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICBmbWQuc2V0RXh0ZXJuYWxpemVyKCgoRXh0\nZXJuYWxpemVyKSBhbm5vKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkFDVE9SWToKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgZm1kLnNldEZhY3RvcnkoKChGYWN0b3J5KSBhbm5v\nKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSU5WRVJTRV9MT0dJQ0FMOgogICAgICAgICAgICAg\nICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAg\nICAgICAgICBmbWQuc2V0SW52ZXJzZSgoKEludmVyc2VMb2dpY2FsKSBhbm5v\nKS52YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgS0VZX0RFUEVOREVOVDoKICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSAmJiAoKEtleURlcGVuZGVudCkg\nYW5ubykudmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLmdl\ndEtleSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0Q2FzY2Fk\nZURlbGV0ZShWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTyk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEtFWV9U\nWVBFOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgp\nKQogICAgICAgICAgICAgICAgICAgICAgICBmbWQuZ2V0S2V5KCkuc2V0VHlw\nZU92ZXJyaWRlKHRvT3ZlcnJpZGVUeXBlKCgoS2V5VHlwZSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGFubm8pLnZhbHVlKCkpKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTE9BRF9G\nRVRDSF9HUk9VUDoKICAgICAgICAgICAgICAgIAlpZiAoaXNNZXRhRGF0YU1v\nZGUoKSkKICAgICAgICAgICAgICAgIAkJZm1kLnNldExvYWRGZXRjaEdyb3Vw\nKCgoTG9hZEZldGNoR3JvdXApIGFubm8pLnZhbHVlKCkpOwogICAgICAgICAg\nICAgICAgCWJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBMUlM6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWV0YURhdGFNb2RlKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIGZtZC5zZXRMUlMoKChMUlMpIGFubm8pLnZhbHVl\nKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBSRUFEX09OTFk6CiAgICAgICAgICAgICAgICAgICAgaWYgKGlz\nTWV0YURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNl\nUmVhZE9ubHkoZm1kLCAoUmVhZE9ubHkpIGFubm8pOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFOgogICAg\nICAgICAgICAgICAgICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0VHlwZU92ZXJyaWRlKHRvT3ZlcnJp\nZGVUeXBlKCgoVHlwZSkgYW5ubykuCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB2YWx1ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldCgidW5zdXBw\nb3J0ZWQiLCBmbWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGFubm8udG9T\ndHJpbmcoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUGFyc2UgbWVtYmVyIG1hcHBpbmcgY29tcG9uZW50cy4K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcGFyc2VNZW1iZXJNYXBwaW5n\nQW5ub3RhdGlvbnMoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gaGFuZGxlIHVua25vd24g\nYW5ub3RhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGhh\nbmRsZVVua25vd25NZW1iZXJBbm5vdGF0aW9uKEZpZWxkTWV0YURhdGEgZm1k\nLAogICAgICAgIEFubm90YXRpb24gYW5ubykgewogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIGdpdmVu\nIGNsYXNzIHRvIGl0cyBPcGVuSlBBIHR5cGUgb3ZlcnJpZGUgZXF1aXZhbGVu\ndC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xhc3MgdG9PdmVycmlk\nZVR5cGUoQ2xhc3MgY2xzKSB7CiAgICAgICAgcmV0dXJuIChjbHMgPT0gRW50\naXR5LmNsYXNzKQogICAgICAgICAgICA/IG9yZy5hcGFjaGUub3BlbmpwYS5l\nbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyA6IGNsczsKICAgIH0K\nCiAgICAvKioKICAgICAqIFBhcnNlIEBSZWFkT25seS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlUmVhZE9ubHkoRmllbGRNZXRhRGF0YSBmbWQs\nIFJlYWRPbmx5IHJvKSB7CiAgICAgICAgaWYgKHJvLnZhbHVlKCkgPT0gVXBk\nYXRlQWN0aW9uLlJFU1RSSUNUKQogICAgICAgICAgICBmbWQuc2V0VXBkYXRl\nU3RyYXRlZ3koVXBkYXRlU3RyYXRlZ2llcy5SRVNUUklDVCk7CiAgICAgICAg\nZWxzZSBpZiAocm8udmFsdWUoKSA9PSBVcGRhdGVBY3Rpb24uSUdOT1JFKQog\nICAgICAgICAgICBmbWQuc2V0VXBkYXRlU3RyYXRlZ3koVXBkYXRlU3RyYXRl\nZ2llcy5JR05PUkUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cg\nbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXRzIHZhbHVlIGdlbmVyYXRpb24gaW5mb3JtYXRpb24gZm9yIHRoZSBn\naXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlR2Vu\nZXJhdGVkVmFsdWUoRmllbGRNZXRhRGF0YSBmbWQsIEdlbmVyYXRlZFZhbHVl\nIGdlbikgewogICAgICAgIEdlbmVyYXRpb25UeXBlIHN0cmF0ZWd5ID0gZ2Vu\nLnN0cmF0ZWd5KCk7CiAgICAgICAgU3RyaW5nIGdlbmVyYXRvciA9IGdlbi5n\nZW5lcmF0b3IoKTsKICAgICAgICBwYXJzZUdlbmVyYXRlZFZhbHVlKGZtZCwg\nc3RyYXRlZ3ksIGdlbmVyYXRvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXRzIHZhbHVlIGdlbmVyYXRpb24gaW5mb3JtYXRpb24gZm9yIHRoZSBnaXZl\nbiBmaWVsZC4KICAgICAqLwogICAgc3RhdGljIHZvaWQgcGFyc2VHZW5lcmF0\nZWRWYWx1ZShGaWVsZE1ldGFEYXRhIGZtZCwgR2VuZXJhdGlvblR5cGUgc3Ry\nYXRlZ3ksCiAgICAgICAgU3RyaW5nIGdlbmVyYXRvcikgewogICAgICAgIGlu\ndCBzdHJhdCA9IGdldEdlbmVyYXRlZFZhbHVlU3RyYXRlZ3koZm1kLCBzdHJh\ndGVneSwgZ2VuZXJhdG9yKTsKICAgICAgICBpZiAoc3RyYXQgIT0gLTEpCiAg\nICAgICAgICAgIGZtZC5zZXRWYWx1ZVN0cmF0ZWd5KHN0cmF0KTsKICAgICAg\nICBlbHNlIHsKICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkgewogICAg\nICAgICAgICAgICAgY2FzZSBUQUJMRToKICAgICAgICAgICAgICAgIGNhc2Ug\nU0VRVUVOQ0U6CiAgICAgICAgICAgICAgICAgICAgLy8gdGVjaG5pY2FsbHkg\nd2Ugc2hvdWxkIGhhdmUgc2VwYXJhdGUgc3lzdGVtIHRhYmxlIGFuZAogICAg\nICAgICAgICAgICAgICAgIC8vIHNlcXVlbmNlIGdlbmVyYXRvcnMsIGJ1dCBp\ndCdzIGVhc2llciB0byBqdXN0IHJlbHkgb24KICAgICAgICAgICAgICAgICAg\nICAvLyB0aGUgc3lzdGVtIG9yZy5hcGFjaGUub3BlbmpwYS5TZXF1ZW5jZSBz\nZXR0aW5nIGZvciBib3RoCiAgICAgICAgICAgICAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZm1kLnNldFZhbHVlU2VxdWVuY2VOYW1lKFNlcXVlbmNlTWV0YURh\ndGEuTkFNRV9TWVNURU0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAgICAgZm1kLnNldFZhbHVlU2VxdWVuY2VOYW1l\nKGdlbmVyYXRvcik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEFVVE86CiAgICAgICAgICAgICAgICAgICAgZm1k\nLnNldFZhbHVlU2VxdWVuY2VOYW1lKFNlcXVlbmNlTWV0YURhdGEuTkFNRV9T\nWVNURU0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgY2FzZSBJREVOVElUWToKICAgICAgICAgICAgICAgICAgICBmbWQu\nc2V0VmFsdWVTdHJhdGVneShWYWx1ZVN0cmF0ZWdpZXMuQVVUT0FTU0lHTik7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbihzdHJhdGVneS50b1N0cmluZygpKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgdmFsdWUgc3RyYXRlZ3kgZm9yIHRoZSBnaXZlbiBnZW5lcmF0b3IsIG9y\nIC0xIGlmIHRoZQogICAgICogc3RyYXRlZ3kgZGVwZW5kcyBvbiB0aGUgPGNv\nZGU+R2VuZXJhdGlvblR5cGU8L2NvZGU+IHJhdGhlciB0aGFuIHRoZQogICAg\nICogZ2VuZXJhdG9yIG5hbWUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIGludCBnZXRHZW5lcmF0ZWRWYWx1ZVN0cmF0ZWd5KE9iamVjdCBjb250ZXh0\nLAogICAgICAgIEdlbmVyYXRpb25UeXBlIHN0cmF0ZWd5LCBTdHJpbmcgZ2Vu\nZXJhdG9yKSB7CiAgICAgICAgaWYgKHN0cmF0ZWd5ICE9IEFVVE8gfHwgU3Ry\naW5nVXRpbHMuaXNFbXB0eShnZW5lcmF0b3IpKQogICAgICAgICAgICByZXR1\ncm4gLTE7CgogICAgICAgIGlmIChHZW5lcmF0b3IuVVVJRF9IRVguZXF1YWxz\nKGdlbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdp\nZXMuVVVJRF9IRVg7CiAgICAgICAgaWYgKEdlbmVyYXRvci5VVUlEX1NUUklO\nRy5lcXVhbHMoZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIFZhbHVl\nU3RyYXRlZ2llcy5VVUlEX1NUUklORzsKICAgICAgICBpZiAoR2VuZXJhdG9y\nLlVVSURfVFlQRTRfSEVYLmVxdWFscyhnZW5lcmF0b3IpKQogICAgICAgICAg\nICByZXR1cm4gVmFsdWVTdHJhdGVnaWVzLlVVSURfVFlQRTRfSEVYOwogICAg\nICAgIGlmIChHZW5lcmF0b3IuVVVJRF9UWVBFNF9TVFJJTkcuZXF1YWxzKGdl\nbmVyYXRvcikpCiAgICAgICAgICAgIHJldHVybiBWYWx1ZVN0cmF0ZWdpZXMu\nVVVJRF9UWVBFNF9TVFJJTkc7CiAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRh\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJnZW5lcmF0b3ItYmFkLXN0cmF0ZWd5IiwK\nICAgICAgICAgICAgY29udGV4dCwgZ2VuZXJhdG9yKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBQYXJzZSBAQmFzaWMuIEdpdmVuIGFubm90YXRpb24gbWF5\nIGJlIG51bGwuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZUJhc2lj\nKEZpZWxkTWV0YURhdGEgZm1kLCBCYXNpYyBhbm5vLCBib29sZWFuIGxvYikg\newogICAgICAgIENsYXNzIHR5cGUgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7\nCiAgICAgICAgaWYgKGxvYiAmJiB0eXBlICE9IFN0cmluZy5jbGFzcwogICAg\nICAgICAgICAmJiB0eXBlICE9IGNoYXJbXS5jbGFzcyAmJiB0eXBlICE9IENo\nYXJhY3RlcltdLmNsYXNzCiAgICAgICAgICAgICYmIHR5cGUgIT0gYnl0ZVtd\nLmNsYXNzICYmIHR5cGUgIT0gQnl0ZVtdLmNsYXNzKQogICAgICAgICAgICBm\nbWQuc2V0U2VyaWFsaXplZCh0cnVlKTsKICAgICAgICBlbHNlIGlmICghbG9i\nKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNv\nZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNU\nOgogICAgICAgICAgICAgICAgICAgIGlmIChFbnVtLmNsYXNzLmlzQXNzaWdu\nYWJsZUZyb20odHlwZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIC8vIGVsc2Ugbm8gYnJlYWsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5QQzoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLlBDX1VOVFlQRUQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKFNlcmlh\nbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpKQogICAgICAg\nICAgICAgICAgICAgICAgICBmbWQuc2V0U2VyaWFsaXplZCh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbWQsICJC\nYXNpYyIpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAg\nICAgIGlmICh0eXBlID09IGNoYXJbXS5jbGFzcyB8fCB0eXBlID09IENoYXJh\nY3RlcltdLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHR5cGUg\nPT0gYnl0ZVtdLmNsYXNzIHx8IHR5cGUgPT0gQnl0ZVtdLmNsYXNzKQogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICBpZiAoU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20KICAg\nICAgICAgICAgICAgICAgICAgICAgKHR5cGUuZ2V0Q29tcG9uZW50VHlwZSgp\nKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm1kLnNldFNlcmlhbGl6ZWQo\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZm1kLCAiQmFzaWMiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChhbm5vID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBmbWQuc2V0SW5E\nZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVB\nR0VSKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAg\nICAgZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBU\nSU9OKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBNYW55VG9PbmUu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU1hbnlUb09uZShGaWVs\nZE1ldGFEYXRhIGZtZCwgTWFueVRvT25lIGFubm8pIHsKICAgICAgICBpZiAo\nIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQt\nbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgIk1hbnlUb09uZSIp\nKTsKCiAgICAgICAgLy8gZG9uJ3Qgc3BlY2lmaWNhbGx5IGV4Y2x1ZGUgcmVs\nYXRpb24gZnJvbSBERkcgYi9jIHRoYXQgd2lsbCBwcmV2ZW50CiAgICAgICAg\nLy8gdXMgZnJvbSBldmVuIHJlYWRpbmcgdGhlIGZrIHdoZW4gcmVhZGluZyBm\ncm9tIHRoZSBwcmltYXJ5IHRhYmxlLAogICAgICAgIC8vIHdoaWNoIGlzIG5v\ndCB3aGF0IG1vc3QgdXNlcnMgd2lsbCB3YW50CiAgICAgICAgaWYgKGFubm8u\nZmV0Y2goKSA9PSBGZXRjaFR5cGUuRUFHRVIpCiAgICAgICAgICAgIGZtZC5z\nZXRJbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwogICAgICAgIGlmICghYW5u\nby5vcHRpb25hbCgpKQogICAgICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZp\nZWxkTWV0YURhdGEuTlVMTF9FWENFUFRJT04pOwogICAgICAgIGlmIChhbm5v\nLnRhcmdldEVudGl0eSgpICE9IHZvaWQuY2xhc3MpCiAgICAgICAgICAgIGZt\nZC5zZXRUeXBlT3ZlcnJpZGUoYW5uby50YXJnZXRFbnRpdHkoKSk7CiAgICAg\nICAgc2V0Q2FzY2FkZXMoZm1kLCBhbm5vLmNhc2NhZGUoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBQYXJzZSBAT25lVG9PbmUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBwYXJzZU9uZVRvT25lKEZpZWxkTWV0YURhdGEgZm1kLCBP\nbmVUb09uZSBhbm5vKSB7CiAgICAgICAgaWYgKCFKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0VmFsdWUoKSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRh\nRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwK\nICAgICAgICAgICAgICAgICJPbmVUb09uZSIpKTsKCiAgICAgICAgLy8gZG9u\nJ3Qgc3BlY2lmaWNhbGx5IGV4Y2x1ZGUgcmVsYXRpb24gZnJvbSBERkcgYi9j\nIHRoYXQgd2lsbCBwcmV2ZW50CiAgICAgICAgLy8gdXMgZnJvbSBldmVuIHJl\nYWRpbmcgdGhlIGZrIHdoZW4gcmVhZGluZyBmcm9tIHRoZSBwcmltYXJ5IHRh\nYmxlLAogICAgICAgIC8vIHdoaWNoIGlzIG5vdCB3aGF0IG1vc3QgdXNlcnMg\nd2lsbCB3YW50CiAgICAgICAgaWYgKGFubm8uZmV0Y2goKSA9PSBGZXRjaFR5\ncGUuRUFHRVIpCiAgICAgICAgICAgIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdy\nb3VwKHRydWUpOwogICAgICAgIGlmICghYW5uby5vcHRpb25hbCgpKQogICAg\nICAgICAgICBmbWQuc2V0TnVsbFZhbHVlKEZpZWxkTWV0YURhdGEuTlVMTF9F\nWENFUFRJT04pOwoKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2Rl\nKCkgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkK\nICAgICAgICAgICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7\nCiAgICAgICAgaWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFz\ncykKICAgICAgICAgICAgZm1kLnNldFR5cGVPdmVycmlkZShhbm5vLnRhcmdl\ndEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2Fz\nY2FkZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBFbWJlZGRl\nZC4gR2l2ZW4gYW5ub3RhdGlvbiBtYXkgYmUgbnVsbC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHBhcnNlRW1iZWRkZWQoRmllbGRNZXRhRGF0YSBmbWQs\nIEVtYmVkZGVkIGFubm8pIHsKICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXli\nZVBDKGZtZC5nZXRWYWx1ZSgpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IE1l\ndGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1k\nLAogICAgICAgICAgICAgICAgIkVtYmVkZGVkIikpOwoKICAgICAgICBmbWQu\nc2V0SW5EZWZhdWx0RmV0Y2hHcm91cCh0cnVlKTsKICAgICAgICBmbWQuc2V0\nRW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgaWYgKGZtZC5nZXRFbWJlZGRlZE1l\ndGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgZm1kLmFkZEVtYmVkZGVk\nTWV0YURhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIEBPbmVU\nb01hbnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU9uZVRvTWFu\neShGaWVsZE1ldGFEYXRhIGZtZCwgT25lVG9NYW55IGFubm8pIHsKICAgICAg\nICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk1BUDoKICAgICAgICAgICAgICAgIGlmIChKYXZhVHlwZXMubWF5YmVQ\nQyhmbWQuZ2V0RWxlbWVudCgpKSkKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFrCiAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAg\nICAgICAgICAgICAgIk9uZVRvTWFueSIpKTsKICAgICAgICB9CgogICAgICAg\nIGZtZC5zZXRJbkRlZmF1bHRGZXRjaEdyb3VwKGFubm8uZmV0Y2goKSA9PSBG\nZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGlmIChpc01hcHBpbmdPdmVycmlk\nZU1vZGUoKSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5\nKCkpKQogICAgICAgICAgICBmbWQuc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRC\neSgpKTsKICAgICAgICBpZiAoYW5uby50YXJnZXRFbnRpdHkoKSAhPSB2b2lk\nLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxlbWVudCgpLnNldERlY2xh\ncmVkVHlwZShhbm5vLnRhcmdldEVudGl0eSgpKTsKICAgICAgICBzZXRDYXNj\nYWRlcyhmbWQuZ2V0RWxlbWVudCgpLCBhbm5vLmNhc2NhZGUoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQYXJzZSBATWFueVRvTWFueS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHBhcnNlTWFueVRvTWFueShGaWVsZE1ldGFEYXRh\nIGZtZCwgTWFueVRvTWFueSBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChmbWQu\nZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DT0xM\nRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgICAgICAgICBpZiAoSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1l\nbnQoKSkpCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAvLyBubyBicmVhawogICAgICAgICAgICBkZWZhdWx0OgogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJP\nbmVUb01hbnkiKSk7CiAgICAgICAgfQoKICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VS\nKTsKICAgICAgICBpZiAoaXNNYXBwaW5nT3ZlcnJpZGVNb2RlKCkgJiYgIVN0\ncmluZ1V0aWxzLmlzRW1wdHkoYW5uby5tYXBwZWRCeSgpKSkKICAgICAgICAg\nICAgZm1kLnNldE1hcHBlZEJ5KGFubm8ubWFwcGVkQnkoKSk7CiAgICAgICAg\naWYgKGFubm8udGFyZ2V0RW50aXR5KCkgIT0gdm9pZC5jbGFzcykKICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXREZWNsYXJlZFR5cGUoYW5uby50\nYXJnZXRFbnRpdHkoKSk7CiAgICAgICAgc2V0Q2FzY2FkZXMoZm1kLmdldEVs\nZW1lbnQoKSwgYW5uby5jYXNjYWRlKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogUGFyc2UgQE1hcEtleS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBh\ncnNlTWFwS2V5KEZpZWxkTWV0YURhdGEgZm1kLCBNYXBLZXkgYW5ubykgewog\nICAgICAgIFN0cmluZyBuYW1lID0gYW5uby5uYW1lKCk7CiAgICAgICAgaWYg\nKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIGZtZC5n\nZXRLZXkoKS5zZXRWYWx1ZU1hcHBlZEJ5KFZhbHVlTWV0YURhdGEuTUFQUEVE\nX0JZX1BLKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZtZC5nZXRLZXko\nKS5zZXRWYWx1ZU1hcHBlZEJ5KG5hbWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogU2V0dXAgdGhlIGZpZWxkIGFzIGEgTE9CIG1hcHBpbmcuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHBhcnNlTG9iTWFwcGluZyhGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQE9yZGVy\nQnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZU9yZGVyQnkoRmll\nbGRNZXRhRGF0YSBmbWQsIE9yZGVyQnkgYW5ubykgewogICAgICAgIFN0cmlu\nZyBkZWMgPSBhbm5vLnZhbHVlKCk7CiAgICAgICAgaWYgKGRlYy5sZW5ndGgo\nKSA9PSAwKQogICAgICAgICAgICBkZWMgPSBPcmRlci5FTEVNRU5UICsgIiBh\nc2MiOwogICAgICAgIGZtZC5zZXRPcmRlckRlY2xhcmF0aW9uKGRlYyk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBAUGVyc2lzdGVudC4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudChGaWVsZE1ldGFE\nYXRhIGZtZCwgUGVyc2lzdGVudCBhbm5vKSB7CiAgICAgICAgc3dpdGNoIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSA9PSBieXRlW10uY2xhc3MKICAgICAgICAgICAgICAg\nICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0ZVtdLmNsYXNz\nCiAgICAgICAgICAgICAgICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgp\nID09IGNoYXJbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5n\nZXREZWNsYXJlZFR5cGUoKSA9PSBDaGFyYWN0ZXJbXS5jbGFzcykKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIG5vIGJy\nZWFrCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBNZXRhRGF0YUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1l\ndGEtYW5ubyIsIGZtZCwKICAgICAgICAgICAgICAgICAgICAiUGVyc2lzdGVu\ndCIpKTsKICAgICAgICB9CgogICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNF\nbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQuc2V0TWFw\ncGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0SW5EZWZh\ndWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBlLkVBR0VS\nKTsKICAgICAgICBpZiAoIWFubm8ub3B0aW9uYWwoKSkKICAgICAgICAgICAg\nZm1kLnNldE51bGxWYWx1ZShGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9O\nKTsKICAgICAgICBzZXRDYXNjYWRlcyhmbWQsIGFubm8uY2FzY2FkZSgpKTsK\nICAgICAgICBpZiAoYW5uby5lbWJlZGRlZCgpKSB7CiAgICAgICAgICAgIGlm\nICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldFZhbHVlKCkpKQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0\nKCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAgICAgICAgICAgICJQ\nZXJzaXN0ZW50KGVtYmVkZGVkPXRydWUpIikpOwogICAgICAgICAgICBmbWQu\nc2V0RW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBmbWQu\nYWRkRW1iZWRkZWRNZXRhRGF0YSgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFBhcnNlIEBQZXJzaXN0ZW50Q29sbGVjdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlUGVyc2lzdGVudENvbGxlY3Rpb24o\nRmllbGRNZXRhRGF0YSBmbWQsCiAgICAgICAgUGVyc2lzdGVudENvbGxlY3Rp\nb24gYW5ubykgewogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpICE9IEphdmFUeXBlcy5BUlJBWQogICAgICAgICAgICAmJiBmbWQuZ2V0\nRGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5DT0xMRUNUSU9OKQog\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAgICAgICAiUGVy\nc2lzdGVudENvbGxlY3Rpb24iKSk7CgogICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuaXNFbXB0eShhbm5vLm1hcHBlZEJ5KCkpKQogICAgICAgICAgICBmbWQu\nc2V0TWFwcGVkQnkoYW5uby5tYXBwZWRCeSgpKTsKICAgICAgICBmbWQuc2V0\nSW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hUeXBl\nLkVBR0VSKTsKICAgICAgICBpZiAoYW5uby5lbGVtZW50VHlwZSgpICE9IHZv\naWQuY2xhc3MpCiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0RGVj\nbGFyZWRUeXBlKGFubm8uZWxlbWVudFR5cGUoKSk7CiAgICAgICAgc2V0Q2Fz\nY2FkZXMoZm1kLmdldEVsZW1lbnQoKSwgYW5uby5lbGVtZW50Q2FzY2FkZSgp\nKTsKICAgICAgICBpZiAoYW5uby5lbGVtZW50RW1iZWRkZWQoKSkgewogICAg\nICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXliZVBDKGZtZC5nZXRFbGVtZW50\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0\naW9uKF9sb2MuZ2V0KCJiYWQtbWV0YS1hbm5vIiwgZm1kLAogICAgICAgICAg\nICAgICAgICAgICJQZXJzaXN0ZW50Q29sbGVjdGlvbihlbWJlZGRlZEVsZW1l\nbnQ9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5nZXRFbGVtZW50KCkuc2V0\nRW1iZWRkZWQodHJ1ZSk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0RWxlbWVu\ndCgpLmdldEVtYmVkZGVkTWV0YURhdGEoKSA9PSBudWxsKQogICAgICAgICAg\nICAgICAgZm1kLmdldEVsZW1lbnQoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgQFBlcnNp\nc3RlbnRNYXAuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJzZVBlcnNp\nc3RlbnRNYXAoRmllbGRNZXRhRGF0YSBmbWQsIFBlcnNpc3RlbnRNYXAgYW5u\nbykgewogICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9\nIEphdmFUeXBlcy5NQVApCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLW1ldGEtYW5ubyIsIGZtZCwKICAg\nICAgICAgICAgICAgICJQZXJzaXN0ZW50TWFwIikpOwoKICAgICAgICBmbWQu\nc2V0SW5EZWZhdWx0RmV0Y2hHcm91cChhbm5vLmZldGNoKCkgPT0gRmV0Y2hU\neXBlLkVBR0VSKTsKICAgICAgICBpZiAoYW5uby5rZXlUeXBlKCkgIT0gdm9p\nZC5jbGFzcykKICAgICAgICAgICAgZm1kLmdldEtleSgpLnNldERlY2xhcmVk\nVHlwZShhbm5vLmtleVR5cGUoKSk7CiAgICAgICAgaWYgKGFubm8uZWxlbWVu\ndFR5cGUoKSAhPSB2b2lkLmNsYXNzKQogICAgICAgICAgICBmbWQuZ2V0RWxl\nbWVudCgpLnNldERlY2xhcmVkVHlwZShhbm5vLmVsZW1lbnRUeXBlKCkpOwog\nICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRLZXkoKSwgYW5uby5rZXlDYXNj\nYWRlKCkpOwogICAgICAgIHNldENhc2NhZGVzKGZtZC5nZXRFbGVtZW50KCks\nIGFubm8uZWxlbWVudENhc2NhZGUoKSk7CiAgICAgICAgaWYgKGFubm8ua2V5\nRW1iZWRkZWQoKSkgewogICAgICAgICAgICBpZiAoIUphdmFUeXBlcy5tYXli\nZVBDKGZtZC5nZXRLZXkoKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTWV0YURhdGFFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBm\nbWQsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRk\nZWRLZXk9dHJ1ZSkiKSk7CiAgICAgICAgICAgIGZtZC5nZXRLZXkoKS5zZXRF\nbWJlZGRlZCh0cnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRLZXkoKS5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGZtZC5nZXRLZXkoKS5hZGRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAg\nfQogICAgICAgIGlmIChhbm5vLmVsZW1lbnRFbWJlZGRlZCgpKSB7CiAgICAg\nICAgICAgIGlmICghSmF2YVR5cGVzLm1heWJlUEMoZm1kLmdldEVsZW1lbnQo\nKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRp\nb24oX2xvYy5nZXQoImJhZC1tZXRhLWFubm8iLCBmbWQsCiAgICAgICAgICAg\nICAgICAgICAgIlBlcnNpc3RlbnRNYXAoZW1iZWRkZWRWYWx1ZT10cnVlKSIp\nKTsKICAgICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5zZXRFbWJlZGRlZCh0\ncnVlKTsKICAgICAgICAgICAgaWYgKGZtZC5nZXRFbGVtZW50KCkuZ2V0RW1i\nZWRkZWRNZXRhRGF0YSgpID09IG51bGwpCiAgICAgICAgICAgICAgICBmbWQu\nZ2V0RWxlbWVudCgpLmFkZEVtYmVkZGVkTWV0YURhdGEoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgY2FzY2FkZXMgb24gcmVsYXRp\nb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzZXRDYXNjYWRlcyhWYWx1\nZU1ldGFEYXRhIHZtZCwgQ2FzY2FkZVR5cGVbXSBjYXNjYWRlcykgewogICAg\nICAgIGZvciAoQ2FzY2FkZVR5cGUgY2FzY2FkZSA6IGNhc2NhZGVzKSB7CiAg\nICAgICAgICAgIGlmIChjYXNjYWRlID09IENhc2NhZGVUeXBlLkFMTCB8fCBj\nYXNjYWRlID09IENhc2NhZGVUeXBlLlJFTU9WRSkKICAgICAgICAgICAgICAg\nIHZtZC5zZXRDYXNjYWRlRGVsZXRlKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9J\nTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRl\nVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5QRVJTSVNUKQog\nICAgICAgICAgICAgICAgdm1kLnNldENhc2NhZGVQZXJzaXN0KFZhbHVlTWV0\nYURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAgICAgICBpZiAoY2Fz\nY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2FkZSA9PSBDYXNjYWRl\nVHlwZS5NRVJHRSkKICAgICAgICAgICAgICAgIHZtZC5zZXRDYXNjYWRlQXR0\nYWNoKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpOwogICAgICAg\nICAgICBpZiAoY2FzY2FkZSA9PSBDYXNjYWRlVHlwZS5BTEwgfHwgY2FzY2Fk\nZSA9PSBDYXNjYWRlVHlwZS5SRUZSRVNIKQogICAgICAgICAgICAgICAgdm1k\nLnNldENhc2NhZGVSZWZyZXNoKFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1F\nRElBVEUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNl\nIEBTZXF1ZW5jZUdlbmVyYXRvci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHBhcnNlU2VxdWVuY2VHZW5lcmF0b3IoQW5ub3RhdGVkRWxlbWVudCBlbCwK\nICAgICAgICBTZXF1ZW5jZUdlbmVyYXRvciBnZW4pIHsKICAgICAgICBTdHJp\nbmcgbmFtZSA9IGdlbi5uYW1lKCk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmlzRW1wdHkobmFtZSkpCiAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tc2VxLW5hbWUiLCBlbCkpOwoKICAg\nICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYXJzZS1zZXF1ZW5jZSIsIG5hbWUpKTsK\nCiAgICAgICAgU2VxdWVuY2VNZXRhRGF0YSBtZXRhID0gZ2V0UmVwb3NpdG9y\neSgpLmdldENhY2hlZFNlcXVlbmNlTWV0YURhdGEKICAgICAgICAgICAgKG5h\nbWUpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAgICAgICAgICAg\naWYgKF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xv\nZy53YXJuKF9sb2MuZ2V0KCJkdXAtc2VxdWVuY2UiLCBuYW1lLCBlbCkpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjcmVh\ndGUgbmV3IHNlcXVlbmNlCiAgICAgICAgbWV0YSA9IGdldFJlcG9zaXRvcnko\nKS5hZGRTZXF1ZW5jZU1ldGFEYXRhKG5hbWUpOwogICAgICAgIFN0cmluZyBz\nZXEgPSBnZW4uc2VxdWVuY2VOYW1lKCk7CiAgICAgICAgaW50IGluaXRpYWwg\nPSBnZW4uaW5pdGlhbFZhbHVlKCk7CiAgICAgICAgaW50IGFsbG9jYXRlID0g\nZ2VuLmFsbG9jYXRpb25TaXplKCk7CiAgICAgICAgLy8gZG9uJ3QgYWxsb3cg\naW5pdGlhbCBvZiAwIGIvYyBsb29rcyBsaWtlIGRlZiB2YWx1ZQogICAgICAg\nIGlmIChpbml0aWFsID09IDApCiAgICAgICAgICAgIGluaXRpYWwgPSAxOwoK\nICAgICAgICAvLyBjcmVhdGUgcGx1Z2luIHN0cmluZyBmcm9tIGluZm8KICAg\nICAgICBTdHJpbmcgY2xzTmFtZSwgcHJvcHM7CiAgICAgICAgaWYgKFN0cmlu\nZ1V0aWxzLmlzRW1wdHkoc2VxKSkgewogICAgICAgICAgICBjbHNOYW1lID0g\nU2VxdWVuY2VNZXRhRGF0YS5JTVBMX05BVElWRTsKICAgICAgICAgICAgcHJv\ncHMgPSBudWxsOwogICAgICAgIH0gZWxzZSBpZiAoc2VxLmluZGV4T2YoJygn\nKSAhPSAtMSkgLy8gcGx1Z2luCiAgICAgICAgewogICAgICAgICAgICBjbHNO\nYW1lID0gQ29uZmlndXJhdGlvbnMuZ2V0Q2xhc3NOYW1lKHNlcSk7CiAgICAg\nICAgICAgIHByb3BzID0gQ29uZmlndXJhdGlvbnMuZ2V0UHJvcGVydGllcyhz\nZXEpOwogICAgICAgICAgICBzZXEgPSBudWxsOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGNsc05hbWUgPSBTZXF1ZW5jZU1ldGFEYXRhLklNUExf\nTkFUSVZFOwogICAgICAgICAgICBwcm9wcyA9IG51bGw7CiAgICAgICAgfQoK\nICAgICAgICBtZXRhLnNldFNlcXVlbmNlUGx1Z2luKENvbmZpZ3VyYXRpb25z\nLmdldFBsdWdpbihjbHNOYW1lLCBwcm9wcykpOwogICAgICAgIG1ldGEuc2V0\nU2VxdWVuY2Uoc2VxKTsKICAgICAgICBtZXRhLnNldEluaXRpYWxWYWx1ZShp\nbml0aWFsKTsKICAgICAgICBtZXRhLnNldEFsbG9jYXRlKGFsbG9jYXRlKTsK\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgbWV0\nYS5TUkNfQU5OT1RBVElPTlMpOwogICAgfQoKICAgIC8qKgogICAgICogUGFy\nc2UgQE5hbWVkUXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBwYXJz\nZU5hbWVkUXVlcmllcyhBbm5vdGF0ZWRFbGVtZW50IGVsLCBOYW1lZFF1ZXJ5\nLi4uIHF1ZXJpZXMpIHsKICAgICAgICBRdWVyeU1ldGFEYXRhIG1ldGE7CiAg\nICAgICAgZm9yIChOYW1lZFF1ZXJ5IHF1ZXJ5IDogcXVlcmllcykgewogICAg\nICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShxdWVyeS5uYW1lKCkp\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1xdWVyeS1uYW1lIiwgZWwpKTsKICAgICAgICAgICAg\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVlcnkucXVlcnkoKSkpCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgTWV0YURhdGFFeGNlcHRpb24oX2xvYy5n\nZXQoIm5vLXF1ZXJ5LXN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgcXVl\ncnkubmFtZSgpLCBlbCkpOwoKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5n\nZXQoInBhcnNlLXF1ZXJ5IiwgcXVlcnkubmFtZSgpKSk7CgogICAgICAgICAg\nICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFF1ZXJ5TWV0YURh\ndGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgaWYgKG1ldGEg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJuRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2FybihfbG9jLmdl\ndCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCkpOwogICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1l\ndGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRhRGF0YShudWxsLCBx\ndWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNldFF1ZXJ5U3RyaW5n\nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRhLnNldExhbmd1YWdl\nKEpQUUxQYXJzZXIuTEFOR19KUFFMKTsKICAgICAgICAgICAgZm9yIChRdWVy\neUhpbnQgaGludCA6IHF1ZXJ5LmhpbnRzKCkpCiAgICAgICAgICAgICAgICBt\nZXRhLmFkZEhpbnQoaGludC5uYW1lKCksIGhpbnQudmFsdWUoKSk7CgogICAg\nICAgICAgICBtZXRhLnNldFNvdXJjZShnZXRTb3VyY2VGaWxlKCksIChlbCBp\nbnN0YW5jZW9mIENsYXNzKSA/IGVsIDogbnVsbCwKICAgICAgICAgICAgICAg\nIG1ldGEuU1JDX0FOTk9UQVRJT05TKTsKICAgICAgICAgICAgaWYgKGlzTWV0\nYURhdGFNb2RlKCkpCiAgICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1v\nZGUoTU9ERV9NRVRBKTsKICAgICAgICAgICAgZWxzZSBpZiAoaXNNYXBwaW5n\nTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2VNb2RlKE1P\nREVfTUFQUElORyk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIG1ldGEuc2V0U291cmNlTW9kZShNT0RFX1FVRVJZKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBATmFtZWROYXRpdmVRdWVyeS4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBhcnNlTmFtZWROYXRpdmVRdWVy\naWVzKEFubm90YXRlZEVsZW1lbnQgZWwsCiAgICAgICAgTmFtZWROYXRpdmVR\ndWVyeS4uLiBxdWVyaWVzKSB7CiAgICAgICAgUXVlcnlNZXRhRGF0YSBtZXRh\nOwogICAgICAgIGZvciAoTmFtZWROYXRpdmVRdWVyeSBxdWVyeSA6IHF1ZXJp\nZXMpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkocXVl\ncnkubmFtZSgpKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBNZXRhRGF0\nYUV4Y2VwdGlvbihfbG9jLmdldCgibm8tbmF0aXZlLXF1ZXJ5LW5hbWUiLAog\nICAgICAgICAgICAgICAgICAgIGVsKSk7CiAgICAgICAgICAgIGlmIChTdHJp\nbmdVdGlscy5pc0VtcHR5KHF1ZXJ5LnF1ZXJ5KCkpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1u\nYXRpdmUtcXVlcnktc3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICBxdWVy\neS5uYW1lKCksIGVsKSk7CgogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdl\ndCgicGFyc2UtbmF0aXZlLXF1ZXJ5IiwgcXVlcnkubmFtZSgpKSk7CgogICAg\nICAgICAgICBtZXRhID0gZ2V0UmVwb3NpdG9yeSgpLmdldENhY2hlZFF1ZXJ5\nTWV0YURhdGEobnVsbCwgcXVlcnkubmFtZSgpKTsKICAgICAgICAgICAgaWYg\nKG1ldGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKF9sb2cuaXNX\nYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIF9sb2cud2Fybihf\nbG9jLmdldCgiZHVwLXF1ZXJ5IiwgcXVlcnkubmFtZSgpLCBlbCkpOwogICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIG1ldGEgPSBnZXRSZXBvc2l0b3J5KCkuYWRkUXVlcnlNZXRhRGF0YShu\ndWxsLCBxdWVyeS5uYW1lKCkpOwogICAgICAgICAgICBtZXRhLnNldFF1ZXJ5\nU3RyaW5nKHF1ZXJ5LnF1ZXJ5KCkpOwogICAgICAgICAgICBtZXRhLnNldExh\nbmd1YWdlKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfU1FMKTsKICAgICAgICAgICAg\nQ2xhc3MgcmVzID0gcXVlcnkucmVzdWx0Q2xhc3MoKTsKICAgICAgICAgICAg\naWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VkVHlwZShnZXRDb25maWd1cmF0aW9u\nKCksIHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldENhbmRpZGF0ZVR5\ncGUocmVzKTsKICAgICAgICAgICAgZWxzZSBpZiAoIXZvaWQuY2xhc3MuZXF1\nYWxzKHJlcykpCiAgICAgICAgICAgICAgICBtZXRhLnNldFJlc3VsdFR5cGUo\ncmVzKTsKCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShx\ndWVyeS5yZXN1bHRTZXRNYXBwaW5nKCkpKQogICAgICAgICAgICAgICAgbWV0\nYS5zZXRSZXN1bHRTZXRNYXBwaW5nTmFtZShxdWVyeS5yZXN1bHRTZXRNYXBw\naW5nKCkpOwoKICAgICAgICAgICAgbWV0YS5zZXRTb3VyY2UoZ2V0U291cmNl\nRmlsZSgpLCAoZWwgaW5zdGFuY2VvZiBDbGFzcykgPyBlbCA6IG51bGwsCiAg\nICAgICAgICAgICAgICBtZXRhLlNSQ19BTk5PVEFUSU9OUyk7CiAgICAgICAg\nICAgIGlmIChpc01ldGFEYXRhTW9kZSgpKQogICAgICAgICAgICAgICAgbWV0\nYS5zZXRTb3VyY2VNb2RlKE1PREVfTUVUQSk7CiAgICAgICAgICAgIGVsc2Ug\naWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAgIG1ldGEuc2V0\nU291cmNlTW9kZShNT0RFX01BUFBJTkcpOwogICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICBtZXRhLnNldFNvdXJjZU1vZGUoTU9ERV9RVUVSWSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIE1l\ndGhvZEtleSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgTWV0aG9kIF9tZXRo\nb2Q7CgogICAgICAgIHB1YmxpYyBNZXRob2RLZXkoTWV0aG9kIG0pIHsKICAg\nICAgICAgICAgX21ldGhvZCA9IG07CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgICAgICBpbnQgY29kZSA9IDQ2\nICogMTIgKyBfbWV0aG9kLmdldE5hbWUoKS5oYXNoQ29kZSgpOwogICAgICAg\nICAgICBmb3IgKENsYXNzIHBhcmFtIDogX21ldGhvZC5nZXRQYXJhbWV0ZXJU\neXBlcygpKQogICAgICAgICAgICAgICAgY29kZSA9IDQ2ICogY29kZSArIHBh\ncmFtLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBjb2RlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBv\nKSB7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNZXRob2RLZXkp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBN\nZXRob2Qgb3RoZXIgPSAoKE1ldGhvZEtleSkgbykuX21ldGhvZDsKICAgICAg\nICAgICAgaWYgKCFfbWV0aG9kLmdldE5hbWUoKS5lcXVhbHMob3RoZXIuZ2V0\nTmFtZSgpKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgcmV0dXJuIEFycmF5cy5lcXVhbHMoX21ldGhvZC5nZXRQYXJhbWV0\nZXJUeXBlcygpLAogICAgICAgICAgICAgICAgb3RoZXIuZ2V0UGFyYW1ldGVy\nVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIE1ldGhvZENvbXBhcmF0b3IgaW1wbGVtZW50cyBDb21wYXJhdG9y\nIHsKCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgTWV0aG9kQ29tcGFyYXRvciBJ\nTlNUQU5DRSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBzdGF0aWMgTWV0aG9k\nQ29tcGFyYXRvciBnZXRJbnN0YW5jZSgpIHsKICAgICAgICAgICAgaWYgKElO\nU1RBTkNFID09IG51bGwpCiAgICAgICAgICAgICAgICBJTlNUQU5DRSA9IG5l\ndyBNZXRob2RDb21wYXJhdG9yKCk7CiAgICAgICAgICAgIHJldHVybiBJTlNU\nQU5DRTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShP\nYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAgICAgICBNZXRob2QgbTEg\nPSAoTWV0aG9kKSBvMTsKICAgICAgICAgICAgTWV0aG9kIG0yID0gKE1ldGhv\nZCkgbzI7CgogICAgICAgICAgICBDbGFzcyBjMSA9IG0xLmdldERlY2xhcmlu\nZ0NsYXNzKCk7CiAgICAgICAgICAgIENsYXNzIGMyID0gbTIuZ2V0RGVjbGFy\naW5nQ2xhc3MoKTsKICAgICAgICAgICAgaWYgKCFjMS5lcXVhbHMoYzIpKSB7\nCiAgICAgICAgICAgICAgICBpZiAoYzEuaXNBc3NpZ25hYmxlRnJvbShjMikp\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAg\nICAgZWxzZQoJCQkJCXJldHVybiAxOwoJCQl9CgkJCWludCBjb21wYXJlID0g\nbTEuZ2V0TmFtZSAoKS5jb21wYXJlVG8gKG0yLmdldE5hbWUgKCkpOwoJCQlp\nZiAoY29tcGFyZSA9PSAwKQoJCQkJcmV0dXJuIG0xLmhhc2hDb2RlICgpIC0g\nbTIuaGFzaENvZGUgKCk7CgkJCXJldHVybiBjb21wYXJlOwoJCX0KCX0KfQo=\n","encoding":"base64"}

