{"sha":"94e10c18bb66d0f29bcc87900a2c5f08c0cd9d8b","node_id":"MDQ6QmxvYjIwNjM2NDo5NGUxMGMxOGJiNjZkMGYyOWJjYzg3OTAwYTJjNWYwOGMwY2Q5ZDhi","size":50586,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/94e10c18bb66d0f29bcc87900a2c5f08c0cd9d8b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5wZXJzaXN0ZW5jZTsKCmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLm1ldGEuU291cmNlVHJhY2tlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSmF2YVZl\ncnNpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9n\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQ\nQUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0\nYS4qOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxh\nbmd1YWdlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludGVy\nbmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CgppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3NDb250\ncm9sbGVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5Qcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLio7CmltcG9ydCBqYXZhLmlv\nLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5pby5Xcml0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGVXcml0ZXI7CmltcG9y\ndCBqYXZhLmxhbmcucmVmbGVjdC5NZW1iZXI7CmltcG9ydCBqYXZhLmxhbmcu\ncmVmbGVjdC5GaWVsZDsKaW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhv\nZDsKaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkFubm90YXRpb247Cgpp\nbXBvcnQgc2VycC51dGlsLlN0cmluZ3M7CgppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuRW50aXR5OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRk\nYWJsZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLk1hcHBlZFN1cGVyY2xh\nc3M7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5OYW1lZE5hdGl2ZVF1ZXJ5\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuTmFtZWRRdWVyeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5SGludDsKaW1wb3J0IGphdmF4LnBl\ncnNpc3RlbmNlLlNlcXVlbmNlR2VuZXJhdG9yOwppbXBvcnQgamF2YXgucGVy\nc2lzdGVuY2UuSWQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5JZENsYXNz\nOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW1iZWRkZWRJZDsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLlZlcnNpb247CmltcG9ydCBqYXZheC5wZXJz\naXN0ZW5jZS5UcmFuc2llbnQ7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5C\nYXNpYzsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVtYmVkZGVkOwppbXBv\ncnQgamF2YXgucGVyc2lzdGVuY2UuTWFueVRvT25lOwppbXBvcnQgamF2YXgu\ncGVyc2lzdGVuY2UuT25lVG9PbmU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5j\nZS5PbmVUb01hbnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5NYW55VG9N\nYW55OwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuT3JkZXJCeTsKaW1wb3J0\nIGphdmF4LnBlcnNpc3RlbmNlLk1hcEtleTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLkF0dHJpYnV0ZU92ZXJyaWRlOwppbXBvcnQgamF2YXgucGVyc2lz\ndGVuY2UuQ2FzY2FkZVR5cGU7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5G\nZXRjaFR5cGU7CgovL0B0b2RvOiBqYXZhZG9jcwoKLyoqCiAqIFNlcmlhbGl6\nZXMgcGVyc2lzdGVuY2UgbWV0YWRhdGEgYXMgYW5ub3RhdGlvbnMuCiAqIFRo\naXMgY2xhc3MgcHJvY2Vzc2VzIGFsbCBvYmplY3QgbGV2ZWwgdGFncyB0aGF0\nIGFyZSBzdG9yZS1hZ25vc3RpYy4KICogSG93ZXZlciwgaXQgcHJvdmlkZXMg\naG9va3MgZm9yIHRoZSBzdWJjbGFzc2VzIHRvIGluY2x1ZGUgc3RvcmUtc3Bl\nY2lmaWMKICogdGFncyB0byBiZSBzZXJpYWxpemVkIGJvdGggYXQgJmx0O2Vu\ndGl0eS1tYXBwaW5ncyZndDsgYW5kCiAqICZsdDtlbnRpdHkmZ3Q7IGxldmVs\nLgogKgogKiBAc2luY2UgMS4wLjAKICogQGF1dGhvciBTdGV2ZSBLaW0KICog\nQGF1dGhvciBHb2toYW4gRXJndWwKICogQG5vamF2YWRvYwogKi8KcHVibGlj\nIGNsYXNzIEFubm90YXRpb25QZXJzaXN0ZW5jZU1ldGFEYXRhU2VyaWFsaXpl\ncgogICAgaW1wbGVtZW50cyBQZXJzaXN0ZW5jZU1ldGFEYXRhRmFjdG9yeS5T\nZXJpYWxpemVyIHsKCiAgICAvLyBOT1RFOiBvcmRlciBpcyBpbXBvcnRhbnQh\nIHRoZXNlIGNvbnN0YW50cyBtdXN0IGJlIG1haW50YWluZWQgaW4KICAgIC8v\nIHNlcmlhbGl6YXRpb24gb3JkZXIuIGNvbnN0YW50cyBhcmUgc3BhY2VkIHNv\nIHRoYXQgc3ViY2xhc3NlcyBjYW4KICAgIC8vIHNsaXAgdGFncyBpbi1iZXR3\nZWVuCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBFX1NFUSA9\nIDEwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9RVUVS\nWSA9IDIwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9N\nRVRBID0gMzA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBUWVBF\nX0NMQVNTX1NFUVMgPSA0MDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFRZUEVfQ0xBU1NfUVVFUklFUyA9IDUwOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoQW5ub3RhdGlvblBlcnNpc3RlbmNlTWV0YURhdGFTZXJp\nYWxpemVyLmNsYXNzKTsKCiAgICBwcml2YXRlIExvZyBfbG9nID0gbnVsbDsK\nICAgIAogICAgcHJpdmF0ZSBmaW5hbCBPcGVuSlBBQ29uZmlndXJhdGlvbiBf\nY29uZjsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgQ2xhc3NNZXRhRGF0YT4g\nX21ldGFzID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgTGlzdD4g\nX3F1ZXJpZXMgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBMaXN0\nPiBfc2VxcyA9IG51bGw7CiAgICBwcml2YXRlIGludCBfbW9kZSA9IE1ldGFE\nYXRhTW9kZXMuTU9ERV9OT05FOwogICAgcHJpdmF0ZSBTZXJpYWxpemF0aW9u\nQ29tcGFyYXRvciBfY29tcCA9IG51bGw7CgogICAgcHJpdmF0ZSBNYXA8Q2xh\nc3NNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+IF9jbHNBbm5v\ncyA9IG51bGw7CiAgICBwcml2YXRlIE1hcDxGaWVsZE1ldGFEYXRhLCBMaXN0\nPEFubm90YXRpb25CdWlsZGVyPj4gX2ZsZEFubm9zID0gbnVsbDsKICAgIHBy\naXZhdGUgTWFwPFNlcXVlbmNlTWV0YURhdGEsIExpc3Q8QW5ub3RhdGlvbkJ1\naWxkZXI+PiBfc2VxQW5ub3MgPSBudWxsOwogICAgcHJpdmF0ZSBNYXA8UXVl\ncnlNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+IF9xcnlBbm5v\ncyA9IG51bGw7IAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBs\neSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgQW5ub3RhdGlv\nblBlcnNpc3RlbmNlTWV0YURhdGFTZXJpYWxpemVyKE9wZW5KUEFDb25maWd1\ncmF0aW9uIGNvbmYpIHsKICAgICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAg\nc2V0TG9nKGNvbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19N\nRVRBREFUQSkpOwogICAgICAgIHNldE1vZGUoTWV0YURhdGFNb2Rlcy5NT0RF\nX01FVEEgfCBNZXRhRGF0YU1vZGVzLk1PREVfTUFQUElORyB8CiAgICAgICAg\nICAgIE1ldGFEYXRhTW9kZXMuTU9ERV9RVUVSWSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgT3Bl\nbkpQQUNvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbG9n\nIHRvIHdyaXRlIHRvLgogICAgICovCiAgICBwdWJsaWMgTG9nIGdldExvZygp\nIHsKICAgICAgICByZXR1cm4gX2xvZzsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoZSBsb2cgdG8gd3JpdGUgdG8uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldExvZyhMb2cgbG9nKSB7CiAgICAgICAgX2xvZyA9IGxvZzsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBUaGUgc2VyaWFsaXphdGlvbiBtb2RlIGFj\nY29yZGluZyB0byB0aGUgZXhwZWN0ZWQgZG9jdW1lbnQgdHlwZS4gVGhlCiAg\nICAgKiBtb2RlIGNvbnN0YW50cyBhY3QgYXMgYml0IGZsYWdzLCBhbmQgdGhl\ncmVmb3JlIGNhbiBiZSBjb21iaW5lZC4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRNb2RlKCkgewogICAgICAgIHJldHVybiBfbW9kZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBzZXJpYWxpemF0aW9uIG1vZGUgYWNjb3JkaW5n\nIHRvIHRoZSBleHBlY3RlZCBkb2N1bWVudCB0eXBlLiBUaGUKICAgICAqIG1v\nZGUgY29uc3RhbnRzIGFjdCBhcyBiaXQgZmxhZ3MsIGFuZCB0aGVyZWZvcmUg\nY2FuIGJlIGNvbWJpbmVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRN\nb2RlKGludCBtb2RlKSB7CiAgICAgICAgX21vZGUgPSBtb2RlOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhlIHNlcmlhbGl6YXRpb24gbW9kZSBhY2NvcmRp\nbmcgdG8gdGhlIGV4cGVjdGVkIGRvY3VtZW50IHR5cGUuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNldE1vZGUoaW50IG1vZGUsIGJvb2xlYW4gb24pIHsK\nICAgICAgICBpZiAobW9kZSA9PSBNZXRhRGF0YU1vZGVzLk1PREVfTk9ORSkK\nICAgICAgICAgICAgc2V0TW9kZShNZXRhRGF0YU1vZGVzLk1PREVfTk9ORSk7\nCiAgICAgICAgZWxzZSBpZiAob24pCiAgICAgICAgICAgIHNldE1vZGUoX21v\nZGUgfCBtb2RlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNldE1vZGUo\nX21vZGUgJiB+bW9kZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01ldGFEYXRhTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5N\nT0RFX01FVEEpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1F1ZXJ5TW9kZSgp\nIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5NT0RF\nX1FVRVJZKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVu\nY2UgbWV0aG9kIGZvciBpbnRlcnByZXRpbmcge0BsaW5rICNnZXRNb2RlfS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZSgp\nIHsKICAgICAgICByZXR1cm4gKF9tb2RlICYgTWV0YURhdGFNb2Rlcy5NT0RF\nX01BUFBJTkcpICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5p\nZW5jZSBtZXRob2QgZm9yIGludGVycHJldGluZyB7QGxpbmsgI2dldE1vZGV9\nLiBUYWtlcyBpbnRvCiAgICAgKiBhY2NvdW50IHdoZXRoZXIgbWFwcGluZyBp\nbmZvcm1hdGlvbiBpcyBsb2FkZWQgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNNYXBwaW5nTW9kZShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gaXNNYXBwaW5n\nTW9kZSgpICYmIChtZXRhLmdldFNvdXJjZU1vZGUoKQogICAgICAgICAgICAm\nIE1ldGFEYXRhTW9kZXMuTU9ERV9NQVBQSU5HKSAhPSAwCiAgICAgICAgICAg\nICYmIChtZXRhLmdldEVtYmVkZGluZ01ldGFEYXRhKCkgIT0gbnVsbAogICAg\nICAgICAgICB8fCAhbWV0YS5pc0VtYmVkZGVkT25seSgpKQogICAgICAgICAg\nICAmJiAobWV0YS5nZXRFbWJlZGRpbmdNZXRhRGF0YSgpID09IG51bGwKICAg\nICAgICAgICAgfHwgaXNNYXBwaW5nTW9kZShtZXRhLmdldEVtYmVkZGluZ01l\ndGFEYXRhKCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbmNl\nIG1ldGhvZCBmb3IgaW50ZXJwcmV0aW5nIHtAbGluayAjZ2V0TW9kZX0uIFRh\na2VzIGludG8KICAgICAqIGFjY291bnQgd2hldGhlciBtYXBwaW5nIGluZm9y\nbWF0aW9uIGlzIGxvYWRlZCBmb3IgdGhlIGdpdmVuIGluc3RhbmNlLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc01hcHBpbmdNb2RlKFZhbHVl\nTWV0YURhdGEgdm1kKSB7CiAgICAgICAgcmV0dXJuIGlzTWFwcGluZ01vZGUo\ndm1kLmdldEZpZWxkTWV0YURhdGEoKS5nZXREZWZpbmluZ01ldGFEYXRhKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgY2xhc3MgbWV0YSBkYXRh\nIHRvIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgYWRkTWV0YURhdGEoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgaWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBpZiAoX21ldGFzID09IG51bGwpCiAgICAgICAgICAgIF9tZXRh\ncyA9IG5ldyBIYXNoTWFwPFN0cmluZywgQ2xhc3NNZXRhRGF0YT4oKTsKICAg\nICAgICBfbWV0YXMucHV0KG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5h\nbWUoKSwgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBzZXF1\nZW5jZSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhKFNl\ncXVlbmNlTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdCBzZXFzID0g\nbnVsbDsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAgICAg\naWYgKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNzKQog\nICAgICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3VyY2VT\nY29wZSgpKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKF9zZXFzID09IG51bGwp\nCiAgICAgICAgICAgIF9zZXFzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBMaXN0\nPigpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VxcyA9IF9zZXFzLmdl\ndChkZWZOYW1lKTsKCiAgICAgICAgaWYgKHNlcXMgPT0gbnVsbCkgewogICAg\nICAgICAgICBzZXFzID0gbmV3IEFycmF5TGlzdCgzKTsgLy8gZG9uJ3QgZXhw\nZWN0IG1hbnkgc2VxcyAvIGNsYXNzCiAgICAgICAgICAgIHNlcXMuYWRkKG1l\ndGEpOwogICAgICAgICAgICBfc2Vxcy5wdXQoZGVmTmFtZSwgc2Vxcyk7CiAg\nICAgICAgfSBlbHNlIGlmICghc2Vxcy5jb250YWlucyhtZXRhKSkKICAgICAg\nICAgICAgc2Vxcy5hZGQobWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgYSBxdWVyeSBtZXRhIGRhdGEgdG8gdGhlIHNldCB0byBiZSBzZXJpYWxp\nemVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRRdWVyeU1ldGFEYXRh\nKFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTGlzdCBxdWVyaWVz\nID0gbnVsbDsKICAgICAgICBTdHJpbmcgZGVmTmFtZSA9IG51bGw7CiAgICAg\nICAgaWYgKG1ldGEuZ2V0U291cmNlU2NvcGUoKSBpbnN0YW5jZW9mIENsYXNz\nKQogICAgICAgICAgICBkZWZOYW1lID0gKChDbGFzcykgbWV0YS5nZXRTb3Vy\nY2VTY29wZSgpKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKF9xdWVyaWVzID09\nIG51bGwpCiAgICAgICAgICAgIF9xdWVyaWVzID0gbmV3IEhhc2hNYXA8U3Ry\naW5nLCBMaXN0PigpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcXVlcmll\ncyA9IF9xdWVyaWVzLmdldChkZWZOYW1lKTsKCiAgICAgICAgaWYgKHF1ZXJp\nZXMgPT0gbnVsbCkgewogICAgICAgICAgICBxdWVyaWVzID0gbmV3IEFycmF5\nTGlzdCgzKTsgLy8gZG9uJ3QgZXhwZWN0IG1hbnkgcXVlcmllcyAvIGNsYXNz\nCiAgICAgICAgICAgIHF1ZXJpZXMuYWRkKG1ldGEpOwogICAgICAgICAgICBf\ncXVlcmllcy5wdXQoZGVmTmFtZSwgcXVlcmllcyk7CiAgICAgICAgfSBlbHNl\nIGlmICghcXVlcmllcy5jb250YWlucyhtZXRhKSkKICAgICAgICAgICAgcXVl\ncmllcy5hZGQobWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYWxs\nIGNvbXBvbmVudHMgaW4gdGhlIGdpdmVuIHJlcG9zaXRvcnkgdG8gdGhlIHNl\ndCB0byBiZSBzZXJpYWxpemVkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBh\nZGRBbGwoTWV0YURhdGFSZXBvc2l0b3J5IHJlcG9zKSB7CiAgICAgICAgaWYg\nKHJlcG9zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nZm9yIChDbGFzc01ldGFEYXRhIG1ldGEgOiByZXBvcy5nZXRNZXRhRGF0YXMo\nKSkKICAgICAgICAgICAgYWRkTWV0YURhdGEobWV0YSk7CiAgICAgICAgZm9y\nIChTZXF1ZW5jZU1ldGFEYXRhIHNlcSA6IHJlcG9zLmdldFNlcXVlbmNlTWV0\nYURhdGFzKCkpCiAgICAgICAgICAgIGFkZFNlcXVlbmNlTWV0YURhdGEoc2Vx\nKTsKICAgICAgICBmb3IgKFF1ZXJ5TWV0YURhdGEgcXVlcnkgOiByZXBvcy5n\nZXRRdWVyeU1ldGFEYXRhcygpKQogICAgICAgICAgICBhZGRRdWVyeU1ldGFE\nYXRhKHF1ZXJ5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIG1l\ndGFkYXRhIGZyb20gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICoK\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3Qg\naW4gc2V0CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZU1ldGFE\nYXRhKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHJldHVybiBfbWV0\nYXMgIT0gbnVsbCAmJiBtZXRhICE9IG51bGwKICAgICAgICAgICAgJiYgX21l\ndGFzLnJlbW92ZShtZXRhLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkp\nICE9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzZXF1\nZW5jZSBtZXRhZGF0YSBmcm9tIHRoZSBzZXQgdG8gYmUgc2VyaWFsaXplZC4K\nICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVtb3ZlZCwgZmFsc2Ug\naWYgbm90IGluIHNldAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiByZW1v\ndmVTZXF1ZW5jZU1ldGFEYXRhKFNlcXVlbmNlTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIGlmIChfc2VxcyA9PSBudWxsIHx8IG1ldGEgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIFN0cmluZyBkZWZOYW1l\nID0gbnVsbDsKICAgICAgICBpZiAobWV0YS5nZXRTb3VyY2VTY29wZSgpIGlu\nc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAgIGRlZk5hbWUgPSAoKENsYXNz\nKSBtZXRhLmdldFNvdXJjZVNjb3BlKCkpLmdldE5hbWUoKTsKICAgICAgICBM\naXN0IHNlcXMgPSBfc2Vxcy5nZXQoZGVmTmFtZSk7CiAgICAgICAgaWYgKHNl\ncXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmICghc2Vxcy5yZW1vdmUobWV0YSkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICBpZiAoc2Vxcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIF9zZXFzLnJlbW92ZShkZWZOYW1lKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhIHF1ZXJ5IG1ldGFkYXRh\nIGZyb20gdGhlIHNldCB0byBiZSBzZXJpYWxpemVkLgogICAgICoKICAgICAq\nIEByZXR1cm4gdHJ1ZSBpZiByZW1vdmVkLCBmYWxzZSBpZiBub3QgaW4gc2V0\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZVF1ZXJ5TWV0YURh\ndGEoUXVlcnlNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9xdWVyaWVz\nID09IG51bGwgfHwgbWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgU3RyaW5nIGRlZk5hbWUgPSBudWxsOwogICAgICAg\nIGlmIChtZXRhLmdldFNvdXJjZVNjb3BlKCkgaW5zdGFuY2VvZiBDbGFzcykK\nICAgICAgICAgICAgZGVmTmFtZSA9ICgoQ2xhc3MpIG1ldGEuZ2V0U291cmNl\nU2NvcGUoKSkuZ2V0TmFtZSgpOwogICAgICAgIExpc3QgcXVlcmllcyA9IF9x\ndWVyaWVzLmdldChkZWZOYW1lKTsKICAgICAgICBpZiAocXVlcmllcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKCFx\ndWVyaWVzLnJlbW92ZShtZXRhKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIGlmIChxdWVyaWVzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\nX3F1ZXJpZXMucmVtb3ZlKGRlZk5hbWUpOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGFsbCB0aGUgY29tcG9u\nZW50cyBpbiB0aGUgZ2l2ZW4gcmVwb3NpdG9yeSBmcm9tIHRoZSBzZXQgdG8g\nYmUKICAgICAqIHNlcmlhbGl6ZWQuCiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIGFueSBjb21wb25lbnRzIHJlbW92ZWQsIGZhbHNlIGlmIG5vbmUg\naW4gc2V0CiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHJlbW92ZUFsbChN\nZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICBpZiAocmVwb3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBi\nb29sZWFuIHJlbW92ZWQgPSBmYWxzZTsKICAgICAgICBDbGFzc01ldGFEYXRh\nW10gbWV0YXMgPSByZXBvcy5nZXRNZXRhRGF0YXMoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG1ldGFzLmxlbmd0aDsgaSsrKQogICAgICAgICAg\nICByZW1vdmVkIHw9IHJlbW92ZU1ldGFEYXRhKG1ldGFzW2ldKTsKICAgICAg\nICBTZXF1ZW5jZU1ldGFEYXRhW10gc2VxcyA9IHJlcG9zLmdldFNlcXVlbmNl\nTWV0YURhdGFzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZXFz\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVkIHw9IHJlbW92ZVNl\ncXVlbmNlTWV0YURhdGEoc2Vxc1tpXSk7CiAgICAgICAgUXVlcnlNZXRhRGF0\nYVtdIHF1ZXJpZXMgPSByZXBvcy5nZXRRdWVyeU1ldGFEYXRhcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcXVlcmllcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgcmVtb3ZlZCB8PSByZW1vdmVRdWVyeU1ldGFEYXRhKHF1\nZXJpZXNbaV0pOwogICAgICAgIHJldHVybiByZW1vdmVkOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgdGhlIHNldCBvZiBtZXRhZGF0YXMgdG8gYmUg\nc2VyaWFsaXplZC4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2xlYXIoKSB7\nCiAgICAgICAgaWYgKF9tZXRhcyAhPSBudWxsKQogICAgICAgICAgICBfbWV0\nYXMuY2xlYXIoKTsKICAgICAgICBpZiAoX3NlcXMgIT0gbnVsbCkKICAgICAg\nICAgICAgX3NlcXMuY2xlYXIoKTsKICAgICAgICBpZiAoX3F1ZXJpZXMgIT0g\nbnVsbCkKICAgICAgICAgICAgX3F1ZXJpZXMuY2xlYXIoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCBzeXN0ZW0tbGV2ZWwgbWFwcGluZyBlbGVtZW50\ncyB0byBiZSBzZXJpYWxpemVkLiBEb2VzIG5vdGhpbmcKICAgICAqIGJ5IGRl\nZmF1bHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFkZFN5c3RlbU1h\ncHBpbmdFbGVtZW50cyhDb2xsZWN0aW9uIHRvU2VyaWFsaXplKSB7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTb3J0IHRoZSBnaXZlbiBjb2xsZWN0aW9uIG9m\nIG9iamVjdHMgdG8gYmUgc2VyaWFsaXplZC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNlcmlhbGl6YXRpb25Tb3J0KExpc3Qgb2JqcykgewogICAgICAg\nIGlmIChvYmpzID09IG51bGwgfHwgb2Jqcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoX2NvbXAgPT0gbnVsbCkKICAgICAg\nICAgICAgX2NvbXAgPSBuZXdTZXJpYWxpemF0aW9uQ29tcGFyYXRvcigpOwog\nICAgICAgIENvbGxlY3Rpb25zLnNvcnQob2JqcywgX2NvbXApOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNvbXBhcmF0b3IgZm9yIG9y\nZGVyaW5nIG9iamVjdHMgdGhhdCBhcmUgdG8gYmUgc2VyaWFsaXplZC4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yIG5l\nd1NlcmlhbGl6YXRpb25Db21wYXJhdG9yKCkgewogICAgICAgIHJldHVybiBf\nY29tcDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBzZXF1ZW5jZSBtZXRh\nZGF0YSB0byB0aGUgZ2l2ZW4gbWV0YWRhdGFzIGNvbGxlY3Rpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXF1ZW5jZU1ldGFEYXRhcyhDb2xs\nZWN0aW9uIGFsbCkgewogICAgICAgIGlmIChfc2VxcyA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIGZvciAoTWFwLkVudHJ5IGVudHJ5\nIDogX3NlcXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBpZiAoZW50cnku\nZ2V0S2V5KCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGFsbC5hZGRBbGwo\nKExpc3QpIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICBlbHNlIGlm\nIChfbWV0YXMgPT0gbnVsbCB8fCAhX21ldGFzLmNvbnRhaW5zS2V5KGVudHJ5\nLmdldEtleSgpKSkKICAgICAgICAgICAgICAgIGFsbC5hZGQobmV3IENsYXNz\nU2VxcygoTGlzdDxTZXF1ZW5jZU1ldGFEYXRhPikKICAgICAgICAgICAgICAg\nICAgICBlbnRyeS5nZXRWYWx1ZSgpKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQWRkIHF1ZXJ5IG1ldGFkYXRhIHRvIHRoZSBnaXZlbiBt\nZXRhZGF0YXMgY29sbGVjdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGFkZFF1ZXJ5TWV0YURhdGFzKENvbGxlY3Rpb24gYWxsKSB7CiAgICAgICAg\naWYgKF9xdWVyaWVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgZm9yIChNYXAuRW50cnkgZW50cnkgOiBfcXVlcmllcy5lbnRyeVNl\ndCgpKSB7CiAgICAgICAgICAgIGlmIChlbnRyeS5nZXRLZXkoKSA9PSBudWxs\nKQogICAgICAgICAgICAgICAgYWxsLmFkZEFsbCgoTGlzdCkgZW50cnkuZ2V0\nVmFsdWUoKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKF9tb2RlID09IE1ldGFE\nYXRhTW9kZXMuTU9ERV9RVUVSWSB8fCBfbWV0YXMgPT0gbnVsbAogICAgICAg\nICAgICAgICAgfHwgIV9tZXRhcy5jb250YWluc0tleShlbnRyeS5nZXRLZXko\nKSkpCiAgICAgICAgICAgICAgICBhbGwuYWRkKG5ldyBDbGFzc1F1ZXJpZXMo\nKExpc3Q8UXVlcnlNZXRhRGF0YT4pCiAgICAgICAgICAgICAgICAgICAgZW50\ncnkuZ2V0VmFsdWUoKSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENyZWF0ZXMgYSBuZXcgYW5ub3RhdGlvbiBidWlsZGVyIGZvciB0aGUg\nc3BlY2lmaWVkIGFubm90YXRpb24gdHlwZS4KICAgICAqIEByZXR1cm4KICAg\nICAqLwogICAgcHJvdGVjdGVkIEFubm90YXRpb25CdWlsZGVyIG5ld0Fubm90\nYXRpb25CdWlsZGVyKAogICAgICAgIENsYXNzPD8gZXh0ZW5kcyBBbm5vdGF0\naW9uPiBhbm5UeXBlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBbm5vdGF0aW9u\nQnVpbGRlcihhbm5UeXBlKTsgICAgICAgIAogICAgfQoKICAgIHByb3RlY3Rl\nZCB2b2lkIGFkZEFubm90YXRpb24oQW5ub3RhdGlvbkJ1aWxkZXIgYWIsIE9i\namVjdCBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBDbGFz\nc01ldGFEYXRhKQogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCAoQ2xh\nc3NNZXRhRGF0YSkgbWV0YSk7CiAgICAgICAgZWxzZSBpZiAobWV0YSBpbnN0\nYW5jZW9mIEZpZWxkTWV0YURhdGEpCiAgICAgICAgICAgIGFkZEFubm90YXRp\nb24oYWIsIChGaWVsZE1ldGFEYXRhKSBtZXRhKTsKICAgICAgICBlbHNlIGlm\nIChtZXRhIGluc3RhbmNlb2YgU2VxdWVuY2VNZXRhRGF0YSkKICAgICAgICAg\nICAgYWRkQW5ub3RhdGlvbihhYiwgKFNlcXVlbmNlTWV0YURhdGEpIG1ldGEp\nOwogICAgICAgIGVsc2UgaWYgKG1ldGEgaW5zdGFuY2VvZiBRdWVyeU1ldGFE\nYXRhKQogICAgICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCAoUXVlcnlNZXRh\nRGF0YSkgbWV0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYW5u\nb3RhdGlvbiBidWlsZGVyIHRvIGxpc3Qgb2YgYnVpbGRlcnMgZm9yIHRoZSBz\ncGVjaWZpZWQKICAgICAqIGNsYXNzIG1ldGFkYXRhLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhZGRBbm5vdGF0aW9uKEFubm90YXRpb25CdWlsZGVy\nIGFiLCBDbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoX2Nsc0Fu\nbm9zID09IG51bGwpCiAgICAgICAgICAgIF9jbHNBbm5vcyA9IG5ldyBIYXNo\nTWFwPENsYXNzTWV0YURhdGEsIExpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+Pigp\nOwogICAgICAgIExpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+IGxpc3QgPSBfY2xz\nQW5ub3MuZ2V0KG1ldGEpOwogICAgICAgIGlmIChsaXN0ID09IG51bGwpIHsK\nICAgICAgICAgICAgbGlzdCA9IG5ldyBBcnJheUxpc3Q8QW5ub3RhdGlvbkJ1\naWxkZXI+KCk7CiAgICAgICAgICAgIF9jbHNBbm5vcy5wdXQobWV0YSwgbGlz\ndCk7CiAgICAgICAgfQogICAgICAgIGxpc3QuYWRkKGFiKTsgICAgICAgIAog\nICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGFubm90YXRpb24gYnVpbGRl\nciB0byBsaXN0IG9mIGJ1aWxkZXJzIGZvciB0aGUgc3BlY2lmaWVkCiAgICAg\nKiBmaWVsZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nYWRkQW5ub3RhdGlvbihBbm5vdGF0aW9uQnVpbGRlciBhYiwgRmllbGRNZXRh\nRGF0YSBtZXRhKSB7CiAgICAgICAgaWYgKF9mbGRBbm5vcyA9PSBudWxsKQog\nICAgICAgICAgICBfZmxkQW5ub3MgPSBuZXcgSGFzaE1hcDxGaWVsZE1ldGFE\nYXRhLCBMaXN0PEFubm90YXRpb25CdWlsZGVyPj4oKTsKICAgICAgICBMaXN0\nPEFubm90YXRpb25CdWlsZGVyPiBsaXN0ID0gX2ZsZEFubm9zLmdldChtZXRh\nKTsKICAgICAgICBpZiAobGlzdCA9PSBudWxsKSB7CiAgICAgICAgICAgIGxp\nc3QgPSBuZXcgQXJyYXlMaXN0PEFubm90YXRpb25CdWlsZGVyPigpOwogICAg\nICAgICAgICBfZmxkQW5ub3MucHV0KG1ldGEsIGxpc3QpOwogICAgICAgIH0K\nICAgICAgICBsaXN0LmFkZChhYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgYW4gYW5ub3RhdGlvbiBidWlsZGVyIHRvIGxpc3Qgb2YgYnVpbGRlcnMg\nZm9yIHRoZSBzcGVjaWZpZWQKICAgICAqIHNlcXVlbmNlIG1ldGFkYXRhLgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRBbm5vdGF0aW9uKEFubm90\nYXRpb25CdWlsZGVyIGFiLCBTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAg\nICAgICBpZiAoX3NlcUFubm9zID09IG51bGwpCiAgICAgICAgICAgIF9zZXFB\nbm5vcyA9IG5ldyBIYXNoTWFwPFNlcXVlbmNlTWV0YURhdGEsIExpc3Q8QW5u\nb3RhdGlvbkJ1aWxkZXI+PigpOwogICAgICAgIExpc3Q8QW5ub3RhdGlvbkJ1\naWxkZXI+IGxpc3QgPSBfc2VxQW5ub3MuZ2V0KG1ldGEpOwogICAgICAgIGlm\nIChsaXN0ID09IG51bGwpIHsKICAgICAgICAgICAgbGlzdCA9IG5ldyBBcnJh\neUxpc3Q8QW5ub3RhdGlvbkJ1aWxkZXI+KCk7CiAgICAgICAgICAgIF9zZXFB\nbm5vcy5wdXQobWV0YSwgbGlzdCk7CiAgICAgICAgfQogICAgICAgIGxpc3Qu\nYWRkKGFiKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhbm5vdGF0\naW9uIGJ1aWxkZXIgdG8gbGlzdCBvZiBidWlsZGVycyBmb3IgdGhlIHNwZWNp\nZmllZAogICAgICogcXVlcnkgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCB2b2lkIGFkZEFubm90YXRpb24oQW5ub3RhdGlvbkJ1aWxkZXIgYWIs\nIFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChfcXJ5QW5ub3Mg\nPT0gbnVsbCkKICAgICAgICAgICAgX3FyeUFubm9zID0gbmV3IEhhc2hNYXA8\nUXVlcnlNZXRhRGF0YSwgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4+KCk7CiAg\nICAgICAgTGlzdDxBbm5vdGF0aW9uQnVpbGRlcj4gbGlzdCA9IF9xcnlBbm5v\ncy5nZXQobWV0YSk7CiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCkgewogICAg\nICAgICAgICBsaXN0ID0gbmV3IEFycmF5TGlzdDxBbm5vdGF0aW9uQnVpbGRl\ncj4oKTsKICAgICAgICAgICAgX3FyeUFubm9zLnB1dChtZXRhLCBsaXN0KTsK\nICAgICAgICB9CiAgICAgICAgbGlzdC5hZGQoYWIpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlcyBhbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIgZm9y\nIHRoZSBzcGVjaWZpZWQgY2xhc3MgbWV0YWRhdGEKICAgICAqIGFuZCBhZGRz\nIGl0IHRvIGxpc3Qgb2YgYnVpbGRlcnMuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBBbm5vdGF0aW9uQnVpbGRlciBhZGRBbm5vdGF0aW9uKAogICAgICAgIENs\nYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm5UeXBlLCBDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9IG5l\nd0Fubm90YXRpb25CdWlsZGVyKGFublR5cGUpOwogICAgICAgIGlmIChtZXRh\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBhYjsKICAgICAgICBhZGRB\nbm5vdGF0aW9uKGFiLCBtZXRhKTsKICAgICAgICByZXR1cm4gYWI7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGFuIGFuIGFubm90YXRpb24gYnVp\nbGRlciBmb3IgdGhlIHNwZWNpZmllZCBjbGFzcyBtZXRhZGF0YQogICAgICog\nYW5kIGFkZHMgaXQgdG8gbGlzdCBvZiBidWlsZGVycy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIEFubm90YXRpb25CdWlsZGVyIGFkZEFubm90YXRpb24oCiAg\nICAgICAgQ2xhc3M8PyBleHRlbmRzIEFubm90YXRpb24+IGFublR5cGUsIEZp\nZWxkTWV0YURhdGEgbWV0YSkgewogICAgICAgIEFubm90YXRpb25CdWlsZGVy\nIGFiID0gbmV3QW5ub3RhdGlvbkJ1aWxkZXIoYW5uVHlwZSk7CiAgICAgICAg\naWYgKG1ldGEgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGFiOwogICAg\nICAgIGFkZEFubm90YXRpb24oYWIsIG1ldGEpOwogICAgICAgIHJldHVybiBh\nYjsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW4gYW4gYW5ub3Rh\ndGlvbiBidWlsZGVyIGZvciB0aGUgc3BlY2lmaWVkIGNsYXNzIG1ldGFkYXRh\nCiAgICAgKiBhbmQgYWRkcyBpdCB0byBsaXN0IG9mIGJ1aWxkZXJzLgogICAg\nICovCiAgICBwcm90ZWN0ZWQgQW5ub3RhdGlvbkJ1aWxkZXIgYWRkQW5ub3Rh\ndGlvbigKICAgICAgICBDbGFzczw/IGV4dGVuZHMgQW5ub3RhdGlvbj4gYW5u\nVHlwZSwgU2VxdWVuY2VNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgQW5ub3Rh\ndGlvbkJ1aWxkZXIgYWIgPSBuZXdBbm5vdGF0aW9uQnVpbGRlcihhbm5UeXBl\nKTsKICAgICAgICBpZiAobWV0YSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gYWI7CiAgICAgICAgYWRkQW5ub3RhdGlvbihhYiwgbWV0YSk7CiAgICAg\nICAgcmV0dXJuIGFiOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBh\nbiBhbiBhbm5vdGF0aW9uIGJ1aWxkZXIgZm9yIHRoZSBzcGVjaWZpZWQgY2xh\nc3MgbWV0YWRhdGEKICAgICAqIGFuZCBhZGRzIGl0IHRvIGxpc3Qgb2YgYnVp\nbGRlcnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBBbm5vdGF0aW9uQnVpbGRl\nciBhZGRBbm5vdGF0aW9uKAogICAgICAgIENsYXNzPD8gZXh0ZW5kcyBBbm5v\ndGF0aW9uPiBhbm5UeXBlLCBRdWVyeU1ldGFEYXRhIG1ldGEpIHsKICAgICAg\nICBBbm5vdGF0aW9uQnVpbGRlciBhYiA9IG5ld0Fubm90YXRpb25CdWlsZGVy\nKGFublR5cGUpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBhYjsKICAgICAgICBhZGRBbm5vdGF0aW9uKGFiLCBtZXRh\nKTsKICAgICAgICByZXR1cm4gYWI7CiAgICB9CiAgICAKICAgIHByb3RlY3Rl\nZCB2b2lkIHNlcmlhbGl6ZShDb2xsZWN0aW9uIG9iamVjdHMpIHsKICAgICAg\nICBmb3IgKE9iamVjdCBvYmogOiBvYmplY3RzKSB7CiAgICAgICAgICAgIGlu\ndCB0eXBlID0gdHlwZShvYmopOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUp\nIHsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9NRVRBOgogICAgICAgICAg\nICAgICAgICAgIHNlcmlhbGl6ZUNsYXNzKChDbGFzc01ldGFEYXRhKSBvYmop\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSBUWVBFX1NFUToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXBw\naW5nTW9kZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVT\nZXF1ZW5jZSgoU2VxdWVuY2VNZXRhRGF0YSkgb2JqKTsKICAgICAgICAgICAg\nICAgIGNhc2UgVFlQRV9RVUVSWToKICAgICAgICAgICAgICAgICAgICBzZXJp\nYWxpemVRdWVyeSgoUXVlcnlNZXRhRGF0YSkgb2JqKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9DTEFT\nU19RVUVSSUVTOgogICAgICAgICAgICAgICAgICAgIGZvciAoUXVlcnlNZXRh\nRGF0YSBxdWVyeSA6ICgoQ2xhc3NRdWVyaWVzKSBvYmopCiAgICAgICAgICAg\nICAgICAgICAgICAgIC5nZXRRdWVyaWVzKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNlcmlhbGl6ZVF1ZXJ5KHF1ZXJ5KTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgVFlQRV9DTEFTU19T\nRVFTOgogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoU2VxdWVuY2VNZXRhRGF0\nYSBzZXEgOiAoKENsYXNzU2Vxcykgb2JqKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLmdldFNlcXVlbmNlcygpKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgc2VyaWFsaXplU2VxdWVuY2Uoc2VxKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgc2VyaWFsaXplU3lzdGVtTWFwcGluZ0VsZW1lbnQo\nb2JqKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ndHlwZSBjb25zdGFudCBmb3IgdGhlIGdpdmVuIG9iamVjdCBiYXNlZCBvbiBp\ndHMgcnVudGltZQogICAgICogY2xhc3MuIElmIHRoZSBydW50aW1lIGNsYXNz\nIGRvZXMgbm90IGNvcnJlc3BvbmQgdG8gYW55IG9mIHRoZSBrbm93bgogICAg\nICogdHlwZXMgdGhlbiByZXR1cm5zIC0xLiBUaGlzIGNhbiBoYXBwZW4gZm9y\nIHRhZ3MKICAgICAqIHRoYXQgYXJlIG5vdCBoYW5kbGVkIGF0IHRoaXMgc3Rv\ncmUtYWdub3N0aWMgbGV2ZWwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBpbnQg\ndHlwZShPYmplY3QgbykgewogICAgICAgIGlmIChvIGluc3RhbmNlb2YgQ2xh\nc3NNZXRhRGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRZUEVfTUVUQTsKICAg\nICAgICBpZiAobyBpbnN0YW5jZW9mIFF1ZXJ5TWV0YURhdGEpCiAgICAgICAg\nICAgIHJldHVybiBUWVBFX1FVRVJZOwogICAgICAgIGlmIChvIGluc3RhbmNl\nb2YgU2VxdWVuY2VNZXRhRGF0YSkKICAgICAgICAgICAgcmV0dXJuIFRZUEVf\nU0VROwogICAgICAgIGlmIChvIGluc3RhbmNlb2YgQ2xhc3NRdWVyaWVzKQog\nICAgICAgICAgICByZXR1cm4gVFlQRV9DTEFTU19RVUVSSUVTOwogICAgICAg\nIGlmIChvIGluc3RhbmNlb2YgQ2xhc3NTZXFzKQogICAgICAgICAgICByZXR1\ncm4gVFlQRV9DTEFTU19TRVFTOwogICAgICAgIHJldHVybiAtMTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSB1bmtub3duIG1hcHBpbmcgZWxl\nbWVudCBhdCBzeXN0ZW0gbGV2ZWwuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIHNlcmlhbGl6ZVN5c3RlbU1hcHBpbmdFbGVtZW50KE9iamVjdCBvYmop\nIHsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBxdWVyeSBtZXRh\nZGF0YS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5\nKFF1ZXJ5TWV0YURhdGEgbWV0YSkgewogICAgICAgIExvZyBsb2cgPSBnZXRM\nb2coKTsKICAgICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkgewogICAg\nICAgICAgICBpZiAobWV0YS5nZXRTb3VyY2VTY29wZSgpIGluc3RhbmNlb2Yg\nQ2xhc3MpCiAgICAgICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgic2Vy\nLWNscy1xdWVyeSIsCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXRTb3Vy\nY2VTY29wZSgpLCBtZXRhLmdldE5hbWUoKSkpOwogICAgICAgICAgICBlbHNl\nCiAgICAgICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgic2VyLXF1ZXJ5\nIiwgbWV0YS5nZXROYW1lKCkpKTsKICAgICAgICB9CgogICAgICAgIENsYXNz\nPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm4gPQogICAgICAgICAgICBRdWVy\neUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMobWV0YS5nZXRMYW5ndWFnZSgp\nKSA/CiAgICAgICAgICAgIE5hbWVkTmF0aXZlUXVlcnkuY2xhc3MgOiBOYW1l\nZFF1ZXJ5LmNsYXNzOwogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiUXJ5\nID0gYWRkQW5ub3RhdGlvbihhbm4sIG1ldGEpOwogICAgICAgIGFiUXJ5LmFk\nZCgibmFtZSIsIG1ldGEuZ2V0TmFtZSgpKTsKICAgICAgICBhYlFyeS5hZGQo\nInF1ZXJ5IiwgbWV0YS5nZXRRdWVyeVN0cmluZygpKTsKICAgICAgICBpZiAo\nUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKG1ldGEuZ2V0TGFuZ3Vh\nZ2UoKSkpIHsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0UmVzdWx0VHlwZSgp\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBhYlFyeS5hZGQoInJlc3VsdENs\nYXNzIiwgbWV0YS5nZXRSZXN1bHRUeXBlKCkpOwogICAgICAgIH0KICAgICAg\nICBzZXJpYWxpemVRdWVyeUhpbnRzKG1ldGEsIGFiUXJ5KTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNlcmlhbGl6ZSBxdWVyeSBoaW50cy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHNlcmlhbGl6ZVF1ZXJ5SGludHMoUXVlcnlNZXRh\nRGF0YSBtZXRhLCBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIFN0\ncmluZ1tdIGhpbnRzID0gbWV0YS5nZXRIaW50S2V5cygpOwogICAgICAgIE9i\namVjdFtdIHZhbHVlcyA9IG1ldGEuZ2V0SGludFZhbHVlcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgaGludHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgQW5ub3RhdGlvbkJ1aWxkZXIgYWJIaW50ID0gbmV3QW5ub3Rh\ndGlvbkJ1aWxkZXIoUXVlcnlIaW50LmNsYXNzKTsKICAgICAgICAgICAgYWJI\naW50LmFkZCgibmFtZSIsIGhpbnRzW2ldKTsKICAgICAgICAgICAgYWJIaW50\nLmFkZCgidmFsdWUiLCBTdHJpbmcudmFsdWVPZih2YWx1ZXNbaV0pKTsKICAg\nICAgICAgICAgYWIuYWRkKCJoaW50cyIsIGFiSGludCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIHNlcXVlbmNlIG1ldGFk\nYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVTZXF1\nZW5jZShTZXF1ZW5jZU1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBMb2cgbG9n\nID0gZ2V0TG9nKCk7CiAgICAgICAgaWYgKGxvZy5pc0luZm9FbmFibGVkKCkp\nCiAgICAgICAgICAgIGxvZy5pbmZvKF9sb2MuZ2V0KCJzZXItc2VxdWVuY2Ui\nLCBtZXRhLmdldE5hbWUoKSkpOwoKICAgICAgICBBbm5vdGF0aW9uQnVpbGRl\nciBhYiA9IGFkZEFubm90YXRpb24oU2VxdWVuY2VHZW5lcmF0b3IuY2xhc3Ms\nIG1ldGEpOwogICAgICAgIGFiLmFkZCgibmFtZSIsIG1ldGEuZ2V0TmFtZSgp\nKTsKCiAgICAgICAgLy8gcGFyc2Ugb3V0IHRoZSBkYXRhc3RvcmUgc2VxdWVu\nY2UgbmFtZSwgaWYgYW55CiAgICAgICAgU3RyaW5nIHBsdWdpbiA9IG1ldGEu\nZ2V0U2VxdWVuY2VQbHVnaW4oKTsKICAgICAgICBTdHJpbmcgY2xzTmFtZSA9\nIENvbmZpZ3VyYXRpb25zLmdldENsYXNzTmFtZShwbHVnaW4pOwogICAgICAg\nIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRpZXMo\ncGx1Z2luKTsKICAgICAgICBTdHJpbmcgZHMgPSBudWxsOwogICAgICAgIGlm\nIChwcm9wcyAhPSBudWxsKSB7CiAgICAgICAgICAgIFByb3BlcnRpZXMgbWFw\nID0gQ29uZmlndXJhdGlvbnMucGFyc2VQcm9wZXJ0aWVzKHByb3BzKTsKICAg\nICAgICAgICAgZHMgPSAoU3RyaW5nKSBtYXAucmVtb3ZlKCJTZXF1ZW5jZSIp\nOwogICAgICAgICAgICBpZiAoZHMgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgcHJvcHMgPSBDb25maWd1cmF0aW9ucy5zZXJpYWxpemVQcm9wZXJ0aWVz\nKG1hcCk7CiAgICAgICAgICAgICAgICBwbHVnaW4gPSBDb25maWd1cmF0aW9u\ncy5nZXRQbHVnaW4oY2xzTmFtZSwgcHJvcHMpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBpZiAoZHMgIT0gbnVsbCkKICAgICAgICAgICAg\nYWIuYWRkKCJzZXF1ZW5jZU5hbWUiLCBkcyk7CiAgICAgICAgZWxzZSBpZiAo\ncGx1Z2luICE9IG51bGwgJiYgIVNlcXVlbmNlTWV0YURhdGEuSU1QTF9OQVRJ\nVkUuZXF1YWxzCiAgICAgICAgICAgIChwbHVnaW4pKQogICAgICAgICAgICBh\nYi5hZGQoInNlcXVlbmNlTmFtZSIsIHBsdWdpbik7CiAgICAgICAgaWYgKG1l\ndGEuZ2V0SW5pdGlhbFZhbHVlKCkgIT0gMCAmJiBtZXRhLmdldEluaXRpYWxW\nYWx1ZSgpICE9IC0xKQogICAgICAgICAgICBhYi5hZGQoImluaXRpYWxWYWx1\nZSIsIG1ldGEuZ2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgIGlmIChtZXRh\nLmdldEFsbG9jYXRlKCkgIT0gNTAgJiYgbWV0YS5nZXRBbGxvY2F0ZSgpICE9\nIC0xKQogICAgICAgICAgICBhYi5hZGQoImFsbG9jYXRpb25TaXplIiwgbWV0\nYS5nZXRBbGxvY2F0ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlh\nbGl6ZSBjbGFzcyBtZXRhZGF0YS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc2VyaWFsaXplQ2xhc3MoQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAg\nICAgTG9nIGxvZyA9IGdldExvZygpOwogICAgICAgIGlmIChsb2cuaXNJbmZv\nRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgic2Vy\nLWNsYXNzIiwgbWV0YSkpOwoKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBh\nYkVudGl0eSA9IGFkZEFubm90YXRpb24oCiAgICAgICAgICAgIGdldEVudGl0\neUFubm90YXRpb25UeXBlKG1ldGEpLCBtZXRhKTsKICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKQogICAgICAgICAgICAmJiAhbWV0YS5nZXRUeXBlQWxp\nYXMoKS5lcXVhbHMoU3RyaW5ncy5nZXRDbGFzc05hbWUobWV0YS4KICAgICAg\nICAgICAgZ2V0RGVzY3JpYmVkVHlwZSgpKSkpCiAgICAgICAgICAgIGFiRW50\naXR5LmFkZCgibmFtZSIsIG1ldGEuZ2V0VHlwZUFsaWFzKCkpOwogICAgICAg\nIAogICAgICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgIGFk\nZENsYXNzTWFwcGluZ0Fubm90YXRpb25zKG1ldGEpOwoKICAgICAgICBpZiAo\naXNNYXBwaW5nTW9kZSgpKQogICAgICAgICAgICBzZXJpYWxpemVDbGFzc01h\ncHBpbmdDb250ZW50KG1ldGEpOwogICAgICAgIGlmIChpc01ldGFEYXRhTW9k\nZSgpKQogICAgICAgICAgICBzZXJpYWxpemVJZENsYXNzKG1ldGEpOwogICAg\nICAgIGlmIChpc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgIHNlcmlhbGl6\nZUluaGVyaXRhbmNlQ29udGVudChtZXRhKTsKCiAgICAgICAgaWYgKGlzTWFw\ncGluZ01vZGUoKSkgewogICAgICAgICAgICBMaXN0IHNlcXMgPSAoX3NlcXMg\nPT0gbnVsbCkgPyBudWxsIDogX3NlcXMuZ2V0CiAgICAgICAgICAgICAgICAo\nbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFtZSgpKTsKICAgICAgICAg\nICAgaWYgKHNlcXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VyaWFs\naXphdGlvblNvcnQoc2Vxcyk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHNlcXMuc2l6ZSgpOyBpKyspCiAgICAgICAgICAgICAgICAg\nICAgc2VyaWFsaXplU2VxdWVuY2UoKFNlcXVlbmNlTWV0YURhdGEpIHNlcXMu\nZ2V0KGkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKGlzUXVlcnlNb2RlKCkpIHsKICAgICAgICAgICAgTGlzdCBxdWVyaWVzID0g\nKF9xdWVyaWVzID09IG51bGwpID8gbnVsbCA6IF9xdWVyaWVzLmdldAogICAg\nICAgICAgICAgICAgKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIGlmIChxdWVyaWVzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIHNlcmlhbGl6YXRpb25Tb3J0KHF1ZXJpZXMpOwogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBxdWVyaWVzLnNpemUoKTsg\naSsrKQogICAgICAgICAgICAgICAgICAgIHNlcmlhbGl6ZVF1ZXJ5KChRdWVy\neU1ldGFEYXRhKSBxdWVyaWVzLmdldChpKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKGlzTWFwcGluZ01vZGUoKSkKICAgICAgICAgICAgICAg\nIHNlcmlhbGl6ZVF1ZXJ5TWFwcGluZ3MobWV0YSk7CiAgICAgICAgfQoKICAg\nICAgICBMaXN0PEZpZWxkTWV0YURhdGE+IGZpZWxkcyA9IG5ldyBBcnJheUxp\nc3QoQXJyYXlzLmFzTGlzdAogICAgICAgICAgICAobWV0YS5nZXREZWZpbmVk\nRmllbGRzSW5MaXN0aW5nT3JkZXIoKSkpOwogICAgICAgIENvbGxlY3Rpb25z\nLnNvcnQoZmllbGRzLCBuZXcgRmllbGRDb21wYXJhdG9yKCkpOwoKICAgICAg\nICAvLyBzZXJpYWxpemUgYXR0ci1vdmVycmlkZQogICAgICAgIGlmIChpc01h\ncHBpbmdNb2RlKCkpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQ7\nCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZzsKICAgICAgICAgICAg\nZm9yIChJdGVyYXRvcjxGaWVsZE1ldGFEYXRhPiBpdCA9IGZpZWxkcy5pdGVy\nYXRvcigpOyBpdC5oYXNOZXh0KCk7KQogICAgICAgICAgICB7CiAgICAgICAg\nICAgICAgICBmbWQgPSBpdC5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nbWV0YS5nZXREZWZpbmVkU3VwZXJjbGFzc0ZpZWxkKGZtZC5nZXROYW1lKCkp\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgICAgICBvcmlnID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0\nYSgpLmdldEZpZWxkKGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICAgICAg\naWYgKHNlcmlhbGl6ZUF0dHJpYnV0ZU92ZXJyaWRlKGZtZCwgb3JpZykpCiAg\nICAgICAgICAgICAgICAgICAgc2VyaWFsaXplQXR0cmlidXRlT3ZlcnJpZGVD\nb250ZW50KGZtZCwgb3JpZyk7CiAgICAgICAgICAgICAgICBpdC5yZW1vdmUo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZpZWxk\ncy5zaXplKCkgPiAwICYmIChpc01ldGFEYXRhTW9kZSgpIHx8IGlzTWFwcGlu\nZ01vZGUoKSkpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBvcmlnOwog\nICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDogZmllbGRzKSB7\nCiAgICAgICAgICAgICAgICBpZiAoZm1kLmdldERlY2xhcmluZ1R5cGUoKSAh\nPSBmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLgogICAgICAgICAgICAgICAg\nICAgIGdldERlc2NyaWJlZFR5cGUoKSkgewogICAgICAgICAgICAgICAgICAg\nIG9yaWcgPSBmbWQuZ2V0RGVjbGFyaW5nTWV0YURhdGEoKS5nZXREZWNsYXJl\nZEZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgIChmbWQuZ2V0TmFtZSgp\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAg\nIG9yaWcgPSBudWxsOwogICAgICAgICAgICAgICAgc2VyaWFsaXplRmllbGQo\nZm1kLCBvcmlnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiBlbnRpdHkgYW5ub3RhdGlvbiB0eXBlLgog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBDbGFzczw/IGV4dGVuZHMgQW5u\nb3RhdGlvbj4gZ2V0RW50aXR5QW5ub3RhdGlvblR5cGUoCiAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhKSB7CiAgICAgICAgc3dpdGNoIChnZXRFbnRpdHlU\nYWcobWV0YSkpIHsKICAgICAgICAgICAgY2FzZSBFTlRJVFk6CiAgICAgICAg\nICAgICAgICByZXR1cm4gRW50aXR5LmNsYXNzOwogICAgICAgICAgICBjYXNl\nIEVNQkVEREFCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gRW1iZWRkYWJs\nZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBNQVBQRURfU1VQRVJDTEFTUzoK\nICAgICAgICAgICAgICAgIHJldHVybiBNYXBwZWRTdXBlcmNsYXNzLmNsYXNz\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBmaWVsZCBhbm5vdGF0aW9uIHR5cGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIENsYXNzPD8gZXh0ZW5kcyBB\nbm5vdGF0aW9uPiBnZXRGaWVsZEFubm90YXRpb25UeXBlICgKICAgICAgICBG\naWVsZE1ldGFEYXRhIGZtZCwgUGVyc2lzdGVuY2VTdHJhdGVneSBzdHJhdCkg\newogICAgICAgIENsYXNzPD8gZXh0ZW5kcyBBbm5vdGF0aW9uPiBhbm4gPSBu\ndWxsOwogICAgICAgIGlmIChmbWQuaXNQcmltYXJ5S2V5KCkgJiYgc3RyYXQg\nPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5FTUJFRERFRCkKICAgICAgICAgICAg\nYW5uID0gRW1iZWRkZWRJZC5jbGFzczsKICAgICAgICBlbHNlIGlmIChmbWQu\naXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgIGFubiA9IElkLmNsYXNzOwog\nICAgICAgIGVsc2UgaWYgKGZtZC5pc1ZlcnNpb24oKSkKICAgICAgICAgICAg\nYW5uID0gVmVyc2lvbi5jbGFzczsKICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgc3dpdGNoIChzdHJhdCkgewogICAgICAgICAgICAgICAgY2FzZSBUUkFO\nU0lFTlQ6CiAgICAgICAgICAgICAgICAgICAgYW5uID0gVHJhbnNpZW50LmNs\nYXNzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBCQVNJQzoKICAgICAgICAgICAgICAgICAgICBhbm4gPSBCYXNp\nYy5jbGFzczsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIGNhc2UgRU1CRURERUQ6CiAgICAgICAgICAgICAgICAgICAgYW5u\nID0gRW1iZWRkZWQuY2xhc3M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICBjYXNlIE1BTllfT05FOgogICAgICAgICAgICAg\nICAgICAgIGFubiA9IE1hbnlUb09uZS5jbGFzczsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT05FX09ORToKICAg\nICAgICAgICAgICAgICAgICBhbm4gPSBPbmVUb09uZS5jbGFzczsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgT05F\nX01BTlk6CiAgICAgICAgICAgICAgICAgICAgYW5uID0gT25lVG9NYW55LmNs\nYXNzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBNQU5ZX01BTlk6CiAgICAgICAgICAgICAgICAgICAgYW5uID0g\nTWFueVRvTWFueS5jbGFzczsKICAgICAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYW5uOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBNZXRhRGF0YVRhZyBm\nb3IgdGhlIGdpdmVuIGNsYXNzIG1ldGEgZGF0YS4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgTWV0YURhdGFUYWcgZ2V0RW50aXR5VGFnKENsYXNzTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIC8vIEBFbWJlZGRhYmxlIGNsYXNzZXMg\nY2FuJ3QgZGVjbGFyZSBJZCBmaWVsZHMKICAgICAgICBpZiAobWV0YS5pc0Vt\nYmVkZGVkT25seSgpICYmIG1ldGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxl\nbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gTWV0YURhdGFUYWcuRU1C\nRUREQUJMRTsKICAgICAgICBpZiAobWV0YS5pc01hcHBlZCgpKQogICAgICAg\nICAgICByZXR1cm4gTWV0YURhdGFUYWcuRU5USVRZOwogICAgICAgIHJldHVy\nbiBNZXRhRGF0YVRhZy5NQVBQRURfU1VQRVJDTEFTUzsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBtYXBwaW5nIGF0dHJpYnV0ZXMgZm9yIHRoZSBnaXZl\nbiBjbGFzcy4gRG9lcyBub3RoaW5nIGJ5IGRlZmF1bHQKICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgYWRkQ2xhc3NNYXBwaW5nQW5ub3RhdGlvbnMoQ2xh\nc3NNZXRhRGF0YSBtYXBwaW5nKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXJpYWxpemUgaWQtY2xhc3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBz\nZXJpYWxpemVJZENsYXNzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAg\nIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgpICE9IENsYXNzTWV0YURhdGEu\nSURfQVBQTElDQVRJT04KICAgICAgICAgICAgfHwgbWV0YS5pc09wZW5KUEFJ\nZGVudGl0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIENsYXNz\nTWV0YURhdGEgc3VwID0gbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgp\nOwogICAgICAgIENsYXNzIG9pZCA9IG1ldGEuZ2V0T2JqZWN0SWRUeXBlKCk7\nCiAgICAgICAgaWYgKG9pZCAhPSBudWxsICYmIChzdXAgPT0gbnVsbCB8fCBv\naWQgIT0gc3VwLmdldE9iamVjdElkVHlwZSgpKSkgewogICAgICAgICAgICBB\nbm5vdGF0aW9uQnVpbGRlciBhYiA9IGFkZEFubm90YXRpb24oSWRDbGFzcy5j\nbGFzcywgbWV0YSk7CiAgICAgICAgICAgIGFiLmFkZChudWxsLCBvaWQpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlcmlhbGl6ZSBjbGFz\ncyBtYXBwaW5nIGNvbnRlbnQuIERvZXMgbm90aGluZyBieSBkZWZhdWx0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVDbGFzc01hcHBp\nbmdDb250ZW50KENsYXNzTWV0YURhdGEgbWFwcGluZykgewogICAgfQoKICAg\nIC8qKgogICAgICogU2VyaWFsaXplIGluaGVyaXRhbmNlIGNvbnRlbnQuIERv\nZXMgbm90aGluZyBieSBkZWZhdWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQg\ndm9pZCBzZXJpYWxpemVJbmhlcml0YW5jZUNvbnRlbnQoQ2xhc3NNZXRhRGF0\nYSBtYXBwaW5nKSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXJpYWxpemUg\ncXVlcnkgbWFwcGluZ3MuIERvZXMgbm90aGluZyBieSBkZWZhdWx0LgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVRdWVyeU1hcHBpbmdz\nKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgfQoKICAgIC8qKgogICAgICog\nU2VyaWFsaXplIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIHNlcmlhbGl6ZUZpZWxkKEZpZWxkTWV0YURhdGEgZm1kLCBGaWVs\nZE1ldGFEYXRhIG9yaWcpIHsKICAgICAgICBpZiAoZm1kLmdldE1hbmFnZW1l\nbnQoKSAhPSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UCiAgICAg\nICAgICAgICYmICFmbWQuaXNFeHBsaWNpdCgpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRlZ3kgc3RyYXQgPSBnZXRT\ndHJhdGVneShmbWQpOwogICAgICAgIFZhbHVlTWV0YURhdGEgY2FzY2FkZXMg\nPSBudWxsOwogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiID0gYWRkQW5u\nb3RhdGlvbigKICAgICAgICAgICAgZ2V0RmllbGRBbm5vdGF0aW9uVHlwZSAo\nZm1kLCBzdHJhdCksIGZtZCk7ICAgICAgICAKICAgICAgICBpZiAoZm1kLmlz\nUHJpbWFyeUtleSgpICYmIHN0cmF0ID09IFBlcnNpc3RlbmNlU3RyYXRlZ3ku\nRU1CRURERUQpCiAgICAgICAgICAgIDsgLy8gbm9vcAogICAgICAgIGVsc2Ug\naWYgKGZtZC5pc1ByaW1hcnlLZXkoKSkKICAgICAgICAgICAgOyAvLyBub29w\nCiAgICAgICAgZWxzZSBpZiAoZm1kLmlzVmVyc2lvbigpKQogICAgICAgICAg\nICA7IC8vIG5vb3AKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3dpdGNo\nIChzdHJhdCkgewogICAgICAgICAgICAgICAgY2FzZSBCQVNJQzoKICAgICAg\nICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgYWRkQmFzaWNBdHRyaWJ1dGVzKGZtZCwgYWIpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSBNQU5ZX09ORToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNZXRhRGF0\nYU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTWFueVRvT25l\nQXR0cmlidXRlcyhmbWQsIGFiKTsKICAgICAgICAgICAgICAgICAgICBjYXNj\nYWRlcyA9IGZtZDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgT05FX09ORToKICAgICAgICAgICAgICAgICAgICBp\nZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nYWRkT25lVG9PbmVBdHRyaWJ1dGVzKGZtZCwgYWIpOwogICAgICAgICAgICAg\nICAgICAgIGNhc2NhZGVzID0gZm1kOwogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgY2FzZSBPTkVfTUFOWToKICAgICAgICAg\nICAgICAgICAgICBpZiAoaXNNZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgYWRkT25lVG9NYW55QXR0cmlidXRlcyhmbWQsIGFiKTsK\nICAgICAgICAgICAgICAgICAgICBjYXNjYWRlcyA9IGZtZC5nZXRFbGVtZW50\nKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBjYXNlIE1BTllfTUFOWToKICAgICAgICAgICAgICAgICAgICBpZiAoaXNN\nZXRhRGF0YU1vZGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTWFu\neVRvTWFueUF0dHJpYnV0ZXMoZm1kLCBhYik7CiAgICAgICAgICAgICAgICAg\nICAgY2FzY2FkZXMgPSBmbWQuZ2V0RWxlbWVudCgpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChp\nc01hcHBpbmdNb2RlKCkpCiAgICAgICAgICAgICAgICBhZGRTdHJhdGVneU1h\ncHBpbmdBdHRyaWJ1dGVzKGZtZCwgYWIpOwogICAgICAgIH0KICAgICAgICBp\nZiAoaXNNYXBwaW5nTW9kZShmbWQpKQogICAgICAgICAgICBhZGRGaWVsZE1h\ncHBpbmdBdHRyaWJ1dGVzKGZtZCwgb3JpZywgYWIpOwoKICAgICAgICBpZiAo\nZm1kLmdldE9yZGVyRGVjbGFyYXRpb24oKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGlmICghKE9yZGVyLkVMRU1FTlQgKyAiIGFzYyIpLmVxdWFscyhmbWQu\nZ2V0T3JkZXJEZWNsYXJhdGlvbigpKSkKICAgICAgICAgICAgICAgIGFkZEFu\nbm90YXRpb24oT3JkZXJCeS5jbGFzcywgZm1kKS4KICAgICAgICAgICAgICAg\nICAgICBhZGQgKG51bGwsIGZtZC5nZXRPcmRlckRlY2xhcmF0aW9uKCkpOwog\nICAgICAgIH0KICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgpICYmIGZtZC5n\nZXRLZXkoKS5nZXRWYWx1ZU1hcHBlZEJ5KCkgIT0gbnVsbCkgewogICAgICAg\nICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYk1hcEtleSA9IGFkZEFubm90YXRp\nb24oTWFwS2V5LmNsYXNzLCBmbWQpOwogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhIG1hcEJ5ID0gZm1kLmdldEtleSgpLmdldFZhbHVlTWFwcGVkQnlNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAoIW1hcEJ5LmlzUHJpbWFyeUtleSgp\nIHx8CiAgICAgICAgICAgICAgICBtYXBCeS5nZXREZWZpbmluZ01ldGFEYXRh\nKCkuZ2V0UHJpbWFyeUtleUZpZWxkcygpLmxlbmd0aCAhPSAxKSB7CiAgICAg\nICAgICAgICAgICBhYk1hcEtleS5hZGQoIm5hbWUiLCBmbWQuZ2V0S2V5KCku\nZ2V0VmFsdWVNYXBwZWRCeSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZShmbWQpKQogICAgICAgICAgICBz\nZXJpYWxpemVGaWVsZE1hcHBpbmdDb250ZW50KGZtZCwgc3RyYXQsIGFiKTsK\nICAgICAgICBpZiAoY2FzY2FkZXMgIT0gbnVsbCAmJiBpc01ldGFEYXRhTW9k\nZSgpKQogICAgICAgICAgICBzZXJpYWxpemVDYXNjYWRlcyhjYXNjYWRlcywg\nYWIpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIG1hcHBpbmcgYXR0cmli\ndXRlcyBmb3IgdGhlIGdpdmVuIGZpZWxkLiBEb2VzIG5vdGhpbmcgYnkgZGVm\nYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYWRkRmllbGRNYXBw\naW5nQXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBGaWVs\nZE1ldGFEYXRhIG9yaWcsIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogQWx3YXlzIHJldHVybnMgZmFsc2UgYnkg\nZGVmYXVsdC4KICAgICAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gc2VyaWFs\naXplQXR0cmlidXRlT3ZlcnJpZGUoRmllbGRNZXRhRGF0YSBmbWQsCiAgICAg\nICAgRmllbGRNZXRhRGF0YSBvcmlnKSB7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGF0dHJpYnV0ZSBv\ndmVycmlkZSBjb250ZW50LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2Vy\naWFsaXplQXR0cmlidXRlT3ZlcnJpZGVDb250ZW50KEZpZWxkTWV0YURhdGEg\nZm1kLAogICAgICAgIEZpZWxkTWV0YURhdGEgb3JpZykgewogICAgICAgIEFu\nbm90YXRpb25CdWlsZGVyIGFiID0gYWRkQW5ub3RhdGlvbihBdHRyaWJ1dGVP\ndmVycmlkZS5jbGFzcywgZm1kKTsKICAgICAgICBhYi5hZGQoIm5hbWUiLCBm\nbWQuZ2V0TmFtZSgpKTsKICAgICAgICBzZXJpYWxpemVBdHRyaWJ1dGVPdmVy\ncmlkZU1hcHBpbmdDb250ZW50KGZtZCwgb3JpZywgYWIpOwogICAgfQoKICAg\nIC8qKgogICAgICogU2VyaWFsaXplIGF0dHJpYnV0ZSBvdmVycmlkZSBtYXBw\naW5nIGNvbnRlbnQuIERvZXMgbm90aGluZyBieSBkZWZhdWx0LAogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVBdHRyaWJ1dGVPdmVycmlk\nZU1hcHBpbmdDb250ZW50CiAgICAgICAgKEZpZWxkTWV0YURhdGEgZm1kLCBG\naWVsZE1ldGFEYXRhIG9yaWcsIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAg\nICB9CgoKICAgIC8qKgogICAgICogU2VyaWFsaXplIGNhc2NhZGVzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgc2VyaWFsaXplQ2FzY2FkZXMoVmFsdWVN\nZXRhRGF0YSB2bWQsIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICAgICAg\nRW51bVNldDxDYXNjYWRlVHlwZT4gY2FzY2FkZXMgPSBFbnVtU2V0Lm5vbmVP\nZihDYXNjYWRlVHlwZS5jbGFzcyk7CiAgICAgICAgaWYgKHZtZC5nZXRDYXNj\nYWRlUGVyc2lzdCgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElB\nVEUpIHsKICAgICAgICAgICAgY2FzY2FkZXMuYWRkKENhc2NhZGVUeXBlLlBF\nUlNJU1QpOwogICAgICAgIH0KICAgICAgICBpZiAodm1kLmdldENhc2NhZGVB\ndHRhY2goKSA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7\nCiAgICAgICAgICAgIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5NRVJHRSk7\nCiAgICAgICAgfQogICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZURlbGV0ZSgp\nID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9JTU1FRElBVEUpIHsKICAgICAg\nICAgICAgY2FzY2FkZXMuYWRkKENhc2NhZGVUeXBlLlJFTU9WRSk7CiAgICAg\nICAgfQogICAgICAgIGlmICh2bWQuZ2V0Q2FzY2FkZVJlZnJlc2goKSA9PSBW\nYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAg\nIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5SRUZSRVNIKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKGNhc2NhZGVzLnNpemUoKSA9PSA0KSAvLyBBTEwKICAg\nICAgICB7CiAgICAgICAgICAgIGNhc2NhZGVzLmNsZWFyKCk7CiAgICAgICAg\nICAgIGNhc2NhZGVzLmFkZChDYXNjYWRlVHlwZS5BTEwpOwogICAgICAgIH0K\nICAgICAgICBpZiAoIWNhc2NhZGVzLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICBhYi5hZGQoImNhc2NhZGUiLCBjYXNjYWRlcyk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXJpYWxpemVkIHN0cmF0\nZWd5IG5hbWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZVN0\ncmF0ZWd5IGdldFN0cmF0ZWd5KEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAg\nICAgaWYgKGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kLk1BTkFHRV9OT05F\nKQogICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5UUkFO\nU0lFTlQ7CgogICAgICAgIGlmIChmbWQuaXNTZXJpYWxpemVkKCkKICAgICAg\nICAgICAgfHwgZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGJ5dGVbXS5jbGFz\ncwogICAgICAgICAgICB8fCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0\nZVtdLmNsYXNzCiAgICAgICAgICAgIHx8IGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSA9PSBjaGFyW10uY2xhc3MKICAgICAgICAgICAgfHwgZm1kLmdldERlY2xh\ncmVkVHlwZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAgICBy\nZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVneS5CQVNJQzsKCiAgICAgICAgRmll\nbGRNZXRhRGF0YSBtYXBwZWRCeTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXRE\nZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuUEM6CiAgICAgICAgICAgICAgICBpZiAoZm1kLmlzRW1iZWRkZWQoKSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VTdHJhdGVn\neS5FTUJFRERFRDsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0TWFwcGVk\nQnkoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJz\naXN0ZW5jZVN0cmF0ZWd5Lk9ORV9PTkU7CiAgICAgICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhW10gaW52ZXJzZXMgPSBmbWQuZ2V0SW52ZXJzZU1ldGFEYXRh\ncygpOwogICAgICAgICAgICAgICAgaWYgKGludmVyc2VzLmxlbmd0aCA9PSAx\nICYmCiAgICAgICAgICAgICAgICAgICAgaW52ZXJzZXNbMF0uZ2V0VHlwZUNv\nZGUoKSA9PSBKYXZhVHlwZXMuUEMgJiYKICAgICAgICAgICAgICAgICAgICBp\nbnZlcnNlc1swXS5nZXRNYXBwZWRCeU1ldGFEYXRhKCkgPT0gZm1kKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3ku\nT05FX09ORTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBQZXJzaXN0ZW5jZVN0cmF0ZWd5Lk1BTllfT05FOwogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nTUFQOgogICAgICAgICAgICAgICAgbWFwcGVkQnkgPSBmbWQuZ2V0TWFwcGVk\nQnlNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5ID09\nIG51bGwgfHwgbWFwcGVkQnkuZ2V0VHlwZUNvZGUoKSAhPSBKYXZhVHlwZXMu\nUEMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3Ry\nYXRlZ3kuTUFOWV9NQU5ZOwogICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNp\nc3RlbmNlU3RyYXRlZ3kuT05FX01BTlk7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk9JRDoKICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5j\nZVN0cmF0ZWd5LkVNQkVEREVEOwogICAgICAgICAgICBkZWZhdWx0OgogICAg\nICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUM7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGJhc2ljIGF0\ndHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRCYXNpY0F0\ndHJpYnV0ZXMoRmllbGRNZXRhRGF0YSBmbWQsIEFubm90YXRpb25CdWlsZGVy\nIGFiKSB7CiAgICAgICAgaWYgKCFmbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3Vw\nKCkpCiAgICAgICAgICAgIGFiLmFkZCgiZmV0Y2giLCBGZXRjaFR5cGUuTEFa\nWSk7CiAgICAgICAgaWYgKGZtZC5nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1l\ndGFEYXRhLk5VTExfRVhDRVBUSU9OKQogICAgICAgICAgICBhYi5hZGQoIm9w\ndGlvbmFsIiwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIG1h\nbnktdG8tb25lIGF0dHJpYnV0ZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBhZGRNYW55VG9PbmVBdHRyaWJ1dGVzKEZpZWxkTWV0YURhdGEgZm1kLAog\nICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICAgICAgaWYgKCFm\nbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGFiLmFk\nZCgiZmV0Y2giLCBGZXRjaFR5cGUuTEFaWSk7CiAgICAgICAgaWYgKGZtZC5n\nZXROdWxsVmFsdWUoKSA9PSBGaWVsZE1ldGFEYXRhLk5VTExfRVhDRVBUSU9O\nKQogICAgICAgICAgICBhYi5hZGQoIm9wdGlvbmFsIiwgZmFsc2UpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkIG9uZS10by1vbmUgYXR0cmlidXRlcy4K\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE9uZVRvT25lQXR0cmlidXRl\ncyhGaWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uQnVpbGRl\nciBhYikgewogICAgICAgIGlmICghZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91\ncCgpKQogICAgICAgICAgICBhYi5hZGQoImZldGNoIiwgRmV0Y2hUeXBlLkxB\nWlkpOwogICAgICAgIGlmIChmbWQuZ2V0TnVsbFZhbHVlKCkgPT0gRmllbGRN\nZXRhRGF0YS5OVUxMX0VYQ0VQVElPTikKICAgICAgICAgICAgYWIuYWRkKCJv\ncHRpb25hbCIsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBv\nbmUtdG8tbWFueSBhdHRyaWJ1dGVzLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkT25lVG9NYW55QXR0cmlidXRlcyhGaWVsZE1ldGFEYXRhIGZtZCwK\nICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBhYikgewogICAgICAgIGlmIChm\nbWQuaXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkpCiAgICAgICAgICAgIGFiLmFk\nZCgiZmV0Y2giLCBGZXRjaFR5cGUuRUFHRVIpOwogICAgICAgIGFkZFRhcmdl\ndEVudGl0eUF0dHJpYnV0ZShmbWQsIGFiKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBtYW55LXRvLW1hbnkgYXR0cmlidXRlcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZE1hbnlUb01hbnlBdHRyaWJ1dGVzKEZpZWxkTWV0\nYURhdGEgZm1kLAogICAgICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAg\nICAgICAgaWYgKGZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAg\nICAgICAgYWIuYWRkKCJmZXRjaCIsIEZldGNoVHlwZS5FQUdFUik7CiAgICAg\nICAgYWRkVGFyZ2V0RW50aXR5QXR0cmlidXRlKGZtZCwgYWIpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIGEgdGFyZ2V0LWVudGl0eSBhdHRyaWJ1dGUg\ndG8gY29sbGVjdGlvbiBhbmQgbWFwIGZpZWxkcyB0aGF0IGRvCiAgICAgKiBu\nb3QgdXNlIGdlbmVyaWNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRk\nVGFyZ2V0RW50aXR5QXR0cmlidXRlKEZpZWxkTWV0YURhdGEgZm1kLAogICAg\nICAgIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICAgICAgTWVtYmVyIG1l\nbWJlciA9IGZtZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgQ2xhc3Nb\nXSB0eXBlczsKICAgICAgICBpZiAobWVtYmVyIGluc3RhbmNlb2YgRmllbGQp\nCiAgICAgICAgICAgIHR5cGVzID0gSmF2YVZlcnNpb25zLmdldFBhcmFtZXRl\ncml6ZWRUeXBlcygoRmllbGQpIG1lbWJlcik7CiAgICAgICAgZWxzZSBpZiAo\nbWVtYmVyIGluc3RhbmNlb2YgTWV0aG9kKQogICAgICAgICAgICB0eXBlcyA9\nIEphdmFWZXJzaW9ucy5nZXRQYXJhbWV0ZXJpemVkVHlwZXMoKE1ldGhvZCkg\nbWVtYmVyKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHR5cGVzID0gbmV3\nIENsYXNzWzBdOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIGlmICh0eXBlcy5sZW5ndGggIT0gMSkK\nICAgICAgICAgICAgICAgICAgICBhYi5hZGQoInRhcmdldEVudGl0eSIsIGZt\nZC5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk1BUDoK\nICAgICAgICAgICAgICAgIGlmICh0eXBlcy5sZW5ndGggIT0gMikKICAgICAg\nICAgICAgICAgICAgICBhYi5hZGQoInRhcmdldEVudGl0eSIsIGZtZC5nZXRF\nbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCkpOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2VyaWFs\naXplIGZpZWxkIG1hcHBpbmcgY29udGVudDsgdGhpcyB3aWxsIGJlIGNhbGxl\nZCBiZWZvcmUKICAgICAqIHtAbGluayAjc2VyaWFsaXplVmFsdWVNYXBwaW5n\nQ29udGVudH0uIERvZXMgbm90aGluZyBieSBkZWZhdWx0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBzZXJpYWxpemVGaWVsZE1hcHBpbmdDb250ZW50\nKEZpZWxkTWV0YURhdGEgZm1kLAogICAgICAgIFBlcnNpc3RlbmNlU3RyYXRl\nZ3kgc3RyYXRlZ3ksIEFubm90YXRpb25CdWlsZGVyIGFiKSB7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTZXQgbWFwcGluZyBhdHRyaWJ1dGVzIGZvciBzdHJh\ndGVneS4gU2V0cyBtYXBwZWQtYnkgYnkgZGVmYXVsdC4KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgYWRkU3RyYXRlZ3lNYXBwaW5nQXR0cmlidXRlcyhG\naWVsZE1ldGFEYXRhIGZtZCwKICAgICAgICBBbm5vdGF0aW9uQnVpbGRlciBh\nYikgewogICAgICAgIGlmIChmbWQuZ2V0TWFwcGVkQnkoKSAhPSBudWxsKQog\nICAgICAgICAgICBhYi5hZGQoIm1hcHBlZEJ5IiwgZm1kLmdldE1hcHBlZEJ5\nKCkpOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgQ29sbGVjdGlvbiBnZXRP\nYmplY3RzKCkgewogICAgICAgIExpc3QgYWxsID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgIGlmIChpc1F1ZXJ5TW9kZSgpKQogICAgICAgICAgICBhZGRR\ndWVyeU1ldGFEYXRhcyhhbGwpOwogICAgICAgIGlmIChpc01hcHBpbmdNb2Rl\nKCkpCiAgICAgICAgICAgIGFkZFNlcXVlbmNlTWV0YURhdGFzKGFsbCk7CiAg\nICAgICAgaWYgKChpc01ldGFEYXRhTW9kZSgpIHx8IGlzTWFwcGluZ01vZGUo\nKSkgJiYgX21ldGFzICE9IG51bGwpCiAgICAgICAgICAgIGFsbC5hZGRBbGwo\nX21ldGFzLnZhbHVlcygpKTsKICAgICAgICBpZiAoaXNNYXBwaW5nTW9kZSgp\nKQogICAgICAgICAgICBhZGRTeXN0ZW1NYXBwaW5nRWxlbWVudHMoYWxsKTsK\nICAgICAgICBzZXJpYWxpemF0aW9uU29ydChhbGwpOwogICAgICAgIHJldHVy\nbiBhbGw7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgd3JpdGVBbm5vdGF0\naW9ucyhPYmplY3QgbWV0YSwKICAgICAgICBMaXN0PEFubm90YXRpb25CdWls\nZGVyPiBidWlsZGVycywgTWFwIG91dHB1dCkgewogICAgICAgIExpc3Q8U3Ry\naW5nPiBhbm5vcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAg\nIGZvcihBbm5vdGF0aW9uQnVpbGRlciBhYjogYnVpbGRlcnMpCiAgICAgICAg\nICAgIGFubm9zLmFkZChhYi50b1N0cmluZygpKTsKICAgICAgICBvdXRwdXQu\ncHV0KG1ldGEsIGFubm9zKTsgICAgICAgIAogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNlcmlhbGl6ZShNYXAgb3V0cHV0LCBpbnQgZmxhZ3MpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgQ29sbGVjdGlvbiBhbGwgPSBnZXRPYmpl\nY3RzKCk7CiAgICAgICAgc2VyaWFsaXplKGFsbCk7CgogICAgICAgIGlmIChf\nY2xzQW5ub3MgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChDbGFzc01ldGFE\nYXRhIG1ldGEgOiBfY2xzQW5ub3Mua2V5U2V0KCkpCiAgICAgICAgICAgICAg\nICB3cml0ZUFubm90YXRpb25zKG1ldGEsIF9jbHNBbm5vcy5nZXQobWV0YSks\nIG91dHB1dCk7CiAgICAgICAgaWYgKF9mbGRBbm5vcyAhPSBudWxsKQogICAg\nICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgbWV0YSA6IF9mbGRBbm5vcy5r\nZXlTZXQoKSkKICAgICAgICAgICAgICAgIHdyaXRlQW5ub3RhdGlvbnMobWV0\nYSwgX2ZsZEFubm9zLmdldChtZXRhKSwgb3V0cHV0KTsKICAgICAgICBpZiAo\nX3NlcUFubm9zICE9IG51bGwpCiAgICAgICAgICAgIGZvciAoU2VxdWVuY2VN\nZXRhRGF0YSBtZXRhIDogX3NlcUFubm9zLmtleVNldCgpKQogICAgICAgICAg\nICAgICAgd3JpdGVBbm5vdGF0aW9ucyhtZXRhLCBfc2VxQW5ub3MuZ2V0KG1l\ndGEpLCBvdXRwdXQpOwogICAgICAgIGlmIChfcXJ5QW5ub3MgIT0gbnVsbCkK\nICAgICAgICAgICAgZm9yIChRdWVyeU1ldGFEYXRhIG1ldGEgOiBfcXJ5QW5u\nb3Mua2V5U2V0KCkpCiAgICAgICAgICAgICAgICB3cml0ZUFubm90YXRpb25z\nKG1ldGEsIF9xcnlBbm5vcy5nZXQobWV0YSksIG91dHB1dCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2VyaWFsaXplKEZpbGUgZmlsZSwgaW50IGZsYWdz\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEZpbGVXcml0ZXIgb3V0ID0gbmV3IEZpbGVXcml0ZXIoKFN0cmluZykg\nQWNjZXNzQ29udHJvbGxlcgogICAgICAgICAgICAgICAgLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdkhlbHBlci5nZXRDYW5vbmljYWxQYXRoQWN0aW9uKGZpbGUp\nKSwKICAgICAgICAgICAgICAgIChmbGFncyAmIEFQUEVORCkgPiAwKTsKICAg\nICAgICAgICAgc2VyaWFsaXplKG91dCwgZmxhZ3MpOwogICAgICAgICAgICBv\ndXQuY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChQcml2aWxlZ2VkQWN0aW9u\nRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICB0aHJvdyAoSU9FeGNlcHRp\nb24pIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2VyaWFsaXplKFdyaXRlciBvdXQsIGludCBmbGFncykg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBNYXAgb3V0cHV0ID0gbmV3\nIEhhc2hNYXAoKTsKICAgICAgICBzZXJpYWxpemUob3V0cHV0LCBmbGFncyk7\nCgogICAgICAgIGZvcihPYmplY3QgbWV0YTogb3V0cHV0LmtleVNldCgpKSB7\nCiAgICAgICAgICAgIG91dC53cml0ZSgiLS0iK21ldGEudG9TdHJpbmcoKSk7\nCiAgICAgICAgICAgIG91dC53cml0ZSgiXG4iKTsKICAgICAgICAgICAgTGlz\ndDxTdHJpbmc+IGFubm9zID0gKExpc3Q8U3RyaW5nPikgb3V0cHV0LmdldCht\nZXRhKTsKICAgICAgICAgICAgZm9yKFN0cmluZyBhbm46IGFubm9zKSB7CiAg\nICAgICAgICAgICAgICBvdXQud3JpdGUoIlx0Iik7CiAgICAgICAgICAgICAg\nICBvdXQud3JpdGUoYW5uKTsKICAgICAgICAgICAgICAgIG91dC53cml0ZSgi\nXG4iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXJpYWxpemUoaW50IGZsYWdzKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4\nY2VwdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBv\ncmRlcmVkIHNldCBvZiB7QGxpbmsgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEu\nU2VxdWVuY2VNZXRhRGF0YX1zIHdpdGggYQogICAgICogY29tbW9uIGNsYXNz\nIHNjb3BlLgogICAgICoKICAgICAqIEBhdXRob3IgU3RlcGhlbiBLaW0KICAg\nICAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBjbGFzcyBDbGFzc1NlcXMKICAgICAgICBpbXBsZW1lbnRzIFNv\ndXJjZVRyYWNrZXIsIENvbXBhcmFibGU8Q2xhc3NTZXFzPiwKICAgICAgICBD\nb21wYXJhdG9yPFNlcXVlbmNlTWV0YURhdGE+IHsKCiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBTZXF1ZW5jZU1ldGFEYXRhW10gX3NlcXM7CgogICAgICAgIHB1\nYmxpYyBDbGFzc1NlcXMoTGlzdDxTZXF1ZW5jZU1ldGFEYXRhPiBzZXFzKSB7\nCiAgICAgICAgICAgIGlmIChzZXFzID09IG51bGwgfHwgc2Vxcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRp\nb24oKTsKCiAgICAgICAgICAgIF9zZXFzID0gKFNlcXVlbmNlTWV0YURhdGFb\nXSkgc2Vxcy50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFNlcXVlbmNl\nTWV0YURhdGFbc2Vxcy5zaXplKCldKTsKICAgICAgICAgICAgQXJyYXlzLnNv\ncnQoX3NlcXMsIHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFNl\ncXVlbmNlTWV0YURhdGFbXSBnZXRTZXF1ZW5jZXMoKSB7CiAgICAgICAgICAg\nIHJldHVybiBfc2VxczsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIENvbXBhcmUgc2VxdWVuY2UgbWV0YWRhdGEgb24gbmFtZS4KICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoU2VxdWVuY2VNZXRh\nRGF0YSBvMSwgU2VxdWVuY2VNZXRhRGF0YSBvMikgewogICAgICAgICAgICBy\nZXR1cm4gbzEuZ2V0TmFtZSgpLmNvbXBhcmVUbyhvMi5nZXROYW1lKCkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEZpbGUgZ2V0U291cmNlRmlsZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIF9zZXFzWzBdLmdldFNvdXJjZUZpbGUo\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3QgZ2V0U291cmNl\nU2NvcGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2Vxc1swXS5nZXRTb3Vy\nY2VTY29wZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRT\nb3VyY2VUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gX3NlcXNbMF0uZ2V0\nU291cmNlVHlwZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmlu\nZyBnZXRSZXNvdXJjZU5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiBfc2Vx\nc1swXS5nZXRSZXNvdXJjZU5hbWUoKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBpbnQgZ2V0TGluZU51bWJlcigpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9zZXFzWzBdLmdldExpbmVOdW1iZXIoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgZ2V0Q29sTnVtYmVyKCkgewogICAgICAgICAgICByZXR1\ncm4gX3NlcXNbMF0uZ2V0Q29sTnVtYmVyKCk7CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZVRvKENsYXNzU2VxcyBvdGhl\ncikgewogICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAg\nICAgICAgIHJldHVybiAwOwogICAgICAgICAgICBpZiAob3RoZXIgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgQ2xh\nc3Mgc2NvcGUgPSAoQ2xhc3MpIGdldFNvdXJjZVNjb3BlKCk7CiAgICAgICAg\nICAgIENsYXNzIG9zY29wZSA9IChDbGFzcykgb3RoZXIuZ2V0U291cmNlU2Nv\ncGUoKTsKICAgICAgICAgICAgcmV0dXJuIHNjb3BlLmdldE5hbWUoKS5jb21w\nYXJlVG8ob3Njb3BlLmdldE5hbWUoKSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmVwcmVzZW50cyBvcmRlcmVkIHNldCBvZiB7QGxpbmsg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuUXVlcnlNZXRhRGF0YX1zIHdpdGgg\nYQogICAgICogY29tbW9uIGNsYXNzIHNjb3BlLgogICAgICoKICAgICAqIEBh\ndXRob3IgU3RlcGhlbiBLaW0KICAgICAqIEBhdXRob3IgUGluYWtpIFBvZGRh\ncgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBDbGFzc1F1ZXJp\nZXMKICAgICAgICBpbXBsZW1lbnRzIFNvdXJjZVRyYWNrZXIsIENvbXBhcmFi\nbGU8Q2xhc3NRdWVyaWVzPiwKICAgICAgICBDb21wYXJhdG9yPFF1ZXJ5TWV0\nYURhdGE+IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBRdWVyeU1ldGFEYXRh\nW10gX3F1ZXJpZXM7CgogICAgICAgIHB1YmxpYyBDbGFzc1F1ZXJpZXMoTGlz\ndDxRdWVyeU1ldGFEYXRhPiBxdWVyaWVzKSB7CiAgICAgICAgICAgIGlmIChx\ndWVyaWVzID09IG51bGwgfHwgcXVlcmllcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKCiAgICAg\nICAgICAgIF9xdWVyaWVzID0gKFF1ZXJ5TWV0YURhdGFbXSkgcXVlcmllcy50\nb0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFF1ZXJ5TWV0YURhdGFbcXVl\ncmllcy5zaXplKCldKTsKICAgICAgICAgICAgQXJyYXlzLnNvcnQoX3F1ZXJp\nZXMsIHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFF1ZXJ5TWV0\nYURhdGFbXSBnZXRRdWVyaWVzKCkgewogICAgICAgICAgICByZXR1cm4gX3F1\nZXJpZXM7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDb21w\nYXJlIHF1ZXJ5IG1ldGFkYXRhLiBOb3JtYWwgcXVlcmllcyBhcHBlYXIgYmVm\nb3JlIG5hdGl2ZSBxdWVyaWVzLgogICAgICAgICAqIElmIHRoZSBnaXZlbiBx\ndWVyaWVzIHVzZSBzYW1lIGxhbmd1YWdlLCB0aGVuIHRoZWlyIG5hbWVzIGFy\nZQogICAgICAgICAqIGNvbXBhcmVkLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyBpbnQgY29tcGFyZShRdWVyeU1ldGFEYXRhIG8xLCBRdWVyeU1ldGFE\nYXRhIG8yKSB7CiAgICAgICAgICAgIC8vIG5vcm1hbCBxdWVyaWVzIGJlZm9y\nZSBuYXRpdmUKICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5lcXVhbHMo\nbzEuZ2V0TGFuZ3VhZ2UoKSwgbzIuZ2V0TGFuZ3VhZ2UoKSkpIHsKICAgICAg\nICAgICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5HX1NRTC5lcXVhbHMo\nbzEuZ2V0TGFuZ3VhZ2UoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIDE7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBv\nMS5nZXROYW1lKCkuY29tcGFyZVRvKG8yLmdldE5hbWUoKSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgRmlsZSBnZXRTb3VyY2VGaWxlKCkgewogICAg\nICAgICAgICByZXR1cm4gX3F1ZXJpZXNbMF0uZ2V0U291cmNlRmlsZSgpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRTb3VyY2VTY29w\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9xdWVyaWVzWzBdLmdldFNvdXJj\nZVNjb3BlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldFNv\ndXJjZVR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcXVlcmllc1swXS5n\nZXRTb3VyY2VUeXBlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3Ry\naW5nIGdldFJlc291cmNlTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9x\ndWVyaWVzWzBdLmdldFJlc291cmNlTmFtZSgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBnZXRMaW5lTnVtYmVyKCkgewogICAgICAgICAgICBy\nZXR1cm4gX3F1ZXJpZXNbMF0uZ2V0TGluZU51bWJlcigpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGludCBnZXRDb2xOdW1iZXIoKSB7CiAgICAgICAg\nICAgIHJldHVybiBfcXVlcmllc1swXS5nZXRDb2xOdW1iZXIoKTsKICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIGludCBjb21wYXJlVG8oQ2xh\nc3NRdWVyaWVzIG90aGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0\naGlzKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGlm\nIChvdGhlciA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwog\nICAgICAgICAgICBDbGFzcyBzY29wZSA9IChDbGFzcykgZ2V0U291cmNlU2Nv\ncGUoKTsKICAgICAgICAgICAgQ2xhc3Mgb3Njb3BlID0gKENsYXNzKSBvdGhl\nci5nZXRTb3VyY2VTY29wZSgpOwogICAgICAgICAgICByZXR1cm4gc2NvcGUu\nZ2V0TmFtZSgpLmNvbXBhcmVUbyhvc2NvcGUuZ2V0TmFtZSgpKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJlcyBjbGFzZXMsIHNl\ncXVlbmNlcywgYW5kIHF1ZXJpZXMgdG8gb3JkZXIgdGhlbSBmb3Igc2VyaWFs\naXphdGlvbi4KICAgICAqIFBsYWNlcyBzZXF1ZW5jZXMgZmlyc3QsIHRoZW4g\nY2xhc3NlcywgdGhlbiBxdWVyaWVzLiBTZXF1ZW5jZXMgYW5kCiAgICAgKiBx\ndWVyaWVzIGFyZSBvcmRlcmVkIGFscGhhYmV0aWNhbGx5IGJ5IG5hbWUuIENs\nYXNzZXMgYXJlIHBsYWNlZCBpbgogICAgICogbGlzdGluZyBvcmRlciwgaW4g\naW5oZXJpdGFuY2Ugb3JkZXIgd2l0aGluIHRoYXQsIGFuZCBpbiBhbHBoYWJl\ndGljYWwKICAgICAqIG9yZGVyIHdpdGhpbiB0aGF0LgogICAgICoKICAgICAq\nIEBhdXRob3IgU3RlcGhlbiBLaW0KICAgICAqLwogICAgcHJvdGVjdGVkIGNs\nYXNzIFNlcmlhbGl6YXRpb25Db21wYXJhdG9yCiAgICAgICAgZXh0ZW5kcyBN\nZXRhRGF0YUluaGVyaXRhbmNlQ29tcGFyYXRvciB7CgogICAgICAgIHB1Ymxp\nYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9iamVjdCBvMikgewogICAgICAg\nICAgICBpZiAobzEgPT0gbzIpCiAgICAgICAgICAgICAgICByZXR1cm4gMDsK\nICAgICAgICAgICAgaWYgKG8xID09IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gMTsKICAgICAgICAgICAgaWYgKG8yID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gLTE7CgogICAgICAgICAgICBpbnQgdDEgPSB0eXBl\nKG8xKTsKICAgICAgICAgICAgaW50IHQyID0gdHlwZShvMik7CiAgICAgICAg\nICAgIGlmICh0MSAhPSB0MikKICAgICAgICAgICAgICAgIHJldHVybiB0MSAt\nIHQyOwoKICAgICAgICAgICAgc3dpdGNoICh0MSkgewogICAgICAgICAgICAg\nICAgY2FzZSBUWVBFX01FVEE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGNvbXBhcmUoKENsYXNzTWV0YURhdGEpIG8xLCAoQ2xhc3NNZXRhRGF0YSkg\nbzIpOwogICAgICAgICAgICAgICAgY2FzZSBUWVBFX1FVRVJZOgogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBjb21wYXJlKChRdWVyeU1ldGFEYXRhKSBv\nMSwgKFF1ZXJ5TWV0YURhdGEpIG8yKTsKICAgICAgICAgICAgICAgIGNhc2Ug\nVFlQRV9TRVE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUo\nKFNlcXVlbmNlTWV0YURhdGEpIG8xLAogICAgICAgICAgICAgICAgICAgICAg\nICAoU2VxdWVuY2VNZXRhRGF0YSkgbzIpOwogICAgICAgICAgICAgICAgY2Fz\nZSBUWVBFX0NMQVNTX1FVRVJJRVM6CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuICgoQ29tcGFyYWJsZSkgbzEpLmNvbXBhcmVUbyhvMik7CiAgICAgICAg\nICAgICAgICBjYXNlIFRZUEVfQ0xBU1NfU0VRUzoKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKChDb21wYXJhYmxlKSBvMSkuY29tcGFyZVRvKG8yKTsK\nICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGNvbXBhcmVVbmtub3duKG8xLCBvMik7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENvbXBhcmUgdHdv\nIHVucmVjb2duaXplZCBlbGVtZW50cyBvZiB0aGUgc2FtZSB0eXBlLiBUaHJv\nd3MKICAgICAgICAgKiBleGNlcHRpb24gYnkgZGVmYXVsdC4KICAgICAgICAg\nKi8KICAgICAgICBwcm90ZWN0ZWQgaW50IGNvbXBhcmVVbmtub3duKE9iamVj\ndCBvMSwgT2JqZWN0IG8yKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAg\nICAgICogQ29tcGFyZSBiZXR3ZWVuIHR3byBjbGFzcyBtZXRhZGF0YS4KICAg\nICAgICAgKi8KICAgICAgICBwcml2YXRlIGludCBjb21wYXJlKENsYXNzTWV0\nYURhdGEgbzEsIENsYXNzTWV0YURhdGEgbzIpIHsKICAgICAgICAgICAgaW50\nIGxpMSA9IG8xLmdldExpc3RpbmdJbmRleCgpOwogICAgICAgICAgICBpbnQg\nbGkyID0gbzIuZ2V0TGlzdGluZ0luZGV4KCk7CiAgICAgICAgICAgIGlmIChs\naTEgPT0gLTEgJiYgbGkyID09IC0xKSB7CiAgICAgICAgICAgICAgICBNZXRh\nRGF0YVRhZyB0MSA9IGdldEVudGl0eVRhZyhvMSk7CiAgICAgICAgICAgICAg\nICBNZXRhRGF0YVRhZyB0MiA9IGdldEVudGl0eVRhZyhvMik7CiAgICAgICAg\nICAgICAgICBpZiAodDEuY29tcGFyZVRvKHQyKSAhPSAwKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiB0MS5jb21wYXJlVG8odDIpOwogICAgICAgICAg\nICAgICAgaW50IGluaGVyID0gc3VwZXIuY29tcGFyZShvMSwgbzIpOwogICAg\nICAgICAgICAgICAgaWYgKGluaGVyICE9IDApCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGluaGVyOwogICAgICAgICAgICAgICAgcmV0dXJuIG8xLmdl\ndERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkuY29tcGFyZVRvCiAgICAgICAg\nICAgICAgICAgICAgKG8yLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobGkxID09IC0xKQog\nICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIGlmIChsaTIg\nPT0gLTEpCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAg\nIHJldHVybiBsaTEgLSBsaTI7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBDb21wYXJlIHF1ZXJ5IG1ldGFkYXRhLgogICAgICAgICAqLwog\nICAgICAgIHByaXZhdGUgaW50IGNvbXBhcmUoUXVlcnlNZXRhRGF0YSBvMSwg\nUXVlcnlNZXRhRGF0YSBvMikgewogICAgICAgICAgICAvLyBub3JtYWwgcXVl\ncmllcyBiZWZvcmUgbmF0aXZlCiAgICAgICAgICAgIGlmICghU3RyaW5nVXRp\nbHMuZXF1YWxzKG8xLmdldExhbmd1YWdlKCksIG8yLmdldExhbmd1YWdlKCkp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19T\nUUwuZXF1YWxzKG8xLmdldExhbmd1YWdlKCkpKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiAxOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gbzEuZ2V0TmFtZSgpLmNvbXBhcmVUbyhvMi5nZXROYW1lKCkp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29tcGFyZSBz\nZXF1ZW5jZSBtZXRhZGF0YS4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRl\nIGludCBjb21wYXJlKFNlcXVlbmNlTWV0YURhdGEgbzEsIFNlcXVlbmNlTWV0\nYURhdGEgbzIpIHsKICAgICAgICAgICAgcmV0dXJuIG8xLmdldE5hbWUoKS5j\nb21wYXJlVG8obzIuZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTb3J0cyBmaWVsZHMgYWNjb3JkaW5nIHRvIGxpc3Rpbmcg\nb3JkZXIsIHRoZW4gWFNEIHN0cmF0ZWd5IG9yZGVyLAogICAgICogdGhlbiBu\nYW1lIG9yZGVyLgogICAgICovCiAgICBwcml2YXRlIGNsYXNzIEZpZWxkQ29t\ncGFyYXRvcgogICAgICAgIGltcGxlbWVudHMgQ29tcGFyYXRvciB7CgogICAg\nICAgIHB1YmxpYyBpbnQgY29tcGFyZShPYmplY3QgbzEsIE9iamVjdCBvMikg\newogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZDEgPSAoRmllbGRNZXRh\nRGF0YSkgbzE7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1kMiA9IChG\naWVsZE1ldGFEYXRhKSBvMjsKICAgICAgICAgICAgaWYgKGZtZDEuaXNQcmlt\nYXJ5S2V5KCkpIHsKICAgICAgICAgICAgICAgIGlmIChmbWQyLmlzUHJpbWFy\neUtleSgpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmbWQxLmNvbXBh\ncmVUbyhmbWQyKTsKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoZm1kMi5pc1ByaW1hcnlLZXkoKSkK\nICAgICAgICAgICAgICAgIHJldHVybiAxOwoKICAgICAgICAgICAgaWYgKGZt\nZDEuaXNWZXJzaW9uKCkpIHsKICAgICAgICAgICAgICAgIGlmIChmbWQyLmlz\nVmVyc2lvbigpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wYXJl\nTGlzdGluZ09yZGVyKGZtZDEsIGZtZDIpOwoJCQkJcmV0dXJuIGdldFN0cmF0\nZWd5KGZtZDIpID09IFBlcnNpc3RlbmNlU3RyYXRlZ3kuQkFTSUMgPyAxIDog\nLTE7CgkJCX0KCQkJaWYgKGZtZDIuaXNWZXJzaW9uKCkpCgkJCQlyZXR1cm4g\nZ2V0U3RyYXRlZ3koZm1kMSkgPT0gUGVyc2lzdGVuY2VTdHJhdGVneS5CQVNJ\nQyA/IC0xIDogMTsKCgkJCWludCBzdGNtcCA9IGdldFN0cmF0ZWd5KGZtZDEp\nLmNvbXBhcmVUbyhnZXRTdHJhdGVneShmbWQyKSk7CiAgICAgICAgICAgIGlm\nIChzdGNtcCAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIHN0Y21wOwog\nICAgICAgICAgICByZXR1cm4gY29tcGFyZUxpc3RpbmdPcmRlcihmbWQxLCBm\nbWQyKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgaW50IGNvbXBhcmVM\naXN0aW5nT3JkZXIoRmllbGRNZXRhRGF0YSBmbWQxLCBGaWVsZE1ldGFEYXRh\nIGZtZDIpewogICAgICAgICAgICBpbnQgbGNtcCA9IGZtZDEuZ2V0TGlzdGlu\nZ0luZGV4KCkgLSBmbWQyLmdldExpc3RpbmdJbmRleCgpOwogICAgICAgICAg\nICBpZiAobGNtcCAhPSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGxjbXA7\nCiAgICAgICAgICAgIHJldHVybiBmbWQxLmNvbXBhcmVUbyhmbWQyKTsKCQl9\nCgl9Cn0K\n","encoding":"base64"}

