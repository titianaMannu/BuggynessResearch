{"sha":"3c1a68d306f2061f9763e46d692e763ca757681c","node_id":"MDQ6QmxvYjIwNjM2NDozYzFhNjhkMzA2ZjIwNjFmOTc2M2U0NmQ2OTJlNzYzY2E3NTc2ODFj","size":19749,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3c1a68d306f2061f9763e46d692e763ca757681c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2U7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVm\nbGVjdC5NZXRob2Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBv\ncnQgamF2YS51dGlsLkNhbGVuZGFyOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBq\nYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsK\naW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkZsdXNoTW9kZVR5cGU7CmltcG9y\ndCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsKaW1wb3J0IGphdmF4LnBlcnNp\nc3RlbmNlLlRlbXBvcmFsVHlwZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY29sbGVjdGlvbnMubWFwLkxpbmtlZE1hcDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLkRlbGVnYXRpbmdRdWVyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGVsZWdhdGluZ1Jlc3VsdExpc3Q7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2Vz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeU9wZXJh\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMu\nQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\na2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5SdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvcjsKCi8q\nKgogKiBJbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUXVlcnl9IGludGVyZmFj\nZS4KICoKICogQGF1dGhvciBNYXJjIFBydWQnaG9tbWVhdXgKICogQGF1dGhv\nciBBYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIFF1\nZXJ5SW1wbAogICAgaW1wbGVtZW50cyBPcGVuSlBBUXVlcnlTUEksIFNlcmlh\nbGl6YWJsZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10g\nRU1QVFlfQVJSQVkgPSBuZXcgT2JqZWN0WzBdOwoKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UKICAgICAgICAoUXVlcnlJbXBsLmNsYXNzKTsKCiAgICBwcml2YXRlIGZp\nbmFsIERlbGVnYXRpbmdRdWVyeSBfcXVlcnk7CiAgICBwcml2YXRlIHRyYW5z\naWVudCBFbnRpdHlNYW5hZ2VySW1wbCBfZW07CiAgICBwcml2YXRlIHRyYW5z\naWVudCBGZXRjaFBsYW4gX2ZldGNoOwoKICAgIHByaXZhdGUgTWFwIF9uYW1l\nZDsKICAgIHByaXZhdGUgTGlzdCBfcG9zaXRpb25hbDsKCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdG9yOyBzdXBwbHkgZmFjdG9yeSBleGNlcHRpb24gdHJh\nbnNsYXRvciBhbmQgZGVsZWdhdGUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBl\nbQogICAgICogICAgICAgICAgICBUaGUgRW50aXR5TWFuYWdlciB3aGljaCBj\ncmVhdGVkIHRoaXMgcXVlcnkKICAgICAqIEBwYXJhbSByZXQKICAgICAqICAg\nICAgICAgICAgRXhjZXB0aW9uIHRyYW5zbGF0ZXIgZm9yIHRoaXMgcXVlcnkK\nICAgICAqIEBwYXJhbSBxdWVyeQogICAgICogICAgICAgICAgICBUaGUgdW5k\nZXJseWluZyAia2VybmVsIiBxdWVyeS4KICAgICAqLwogICAgcHVibGljIFF1\nZXJ5SW1wbChFbnRpdHlNYW5hZ2VySW1wbCBlbSwgUnVudGltZUV4Y2VwdGlv\nblRyYW5zbGF0b3IgcmV0LAogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuUXVlcnkgcXVlcnkpIHsKICAgICAgICBfZW0gPSBlbTsKICAgICAg\nICBfcXVlcnkgPSBuZXcgRGVsZWdhdGluZ1F1ZXJ5KHF1ZXJ5LCByZXQpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yOyBzdXBwbHkg\nZmFjdG9yeSBhbmQgZGVsZWdhdGUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgUXVlcnlJbXBsKEVudGl0eU1hbmFnZXJJbXBsIGVt\nLCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5IHF1ZXJ5KSB7CiAg\nICAgICAgdGhpcyhlbSwgbnVsbCwgcXVlcnkpOwogICAgfQoKICAgIC8qKgoJ\nICogRGVsZWdhdGUuCgkgKi8KICAgIHB1YmxpYyBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlF1ZXJ5IGdldERlbGVnYXRlKCkgewogICAgICAgIHJldHVy\nbiBfcXVlcnkuZ2V0RGVsZWdhdGUoKTsKICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQUVudGl0eU1hbmFnZXIgZ2V0RW50aXR5TWFuYWdlcigpIHsKICAgICAg\nICByZXR1cm4gX2VtOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0TGFu\nZ3VhZ2UoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXRMYW5ndWFnZSgp\nOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeU9wZXJhdGlvblR5cGUgZ2V0T3Bl\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBRdWVyeU9wZXJhdGlvblR5cGUu\nZnJvbUtlcm5lbENvbnN0YW50KF9xdWVyeS5nZXRPcGVyYXRpb24oKSk7CiAg\nICB9CgogICAgcHVibGljIEZldGNoUGxhbiBnZXRGZXRjaFBsYW4oKSB7CiAg\nICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9x\ndWVyeS5hc3NlcnROb3RTZXJpYWxpemVkKCk7CiAgICAgICAgX3F1ZXJ5Lmxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX2ZldGNoID09\nIG51bGwpCiAgICAgICAgICAgICAgICBfZmV0Y2ggPSAoKEVudGl0eU1hbmFn\nZXJGYWN0b3J5SW1wbCkgX2VtLgogICAgICAgICAgICAgICAgICAgIGdldEVu\ndGl0eU1hbmFnZXJGYWN0b3J5KCkpLnRvRmV0Y2hQbGFuKF9xdWVyeS5nZXRC\ncm9rZXIoKSwKICAgICAgICAgICAgICAgICAgICBfcXVlcnkuZ2V0RmV0Y2hD\nb25maWd1cmF0aW9uKCkpOwogICAgICAgICAgICByZXR1cm4gX2ZldGNoOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRRdWVy\neVN0cmluZygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldFF1ZXJ5U3Ry\naW5nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hh\nbmdlcygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldElnbm9yZUNoYW5n\nZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldElnbm9y\nZUNoYW5nZXMoYm9vbGVhbiBpZ25vcmUpIHsKICAgICAgICBfZW0uYXNzZXJ0\nTm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LnNldElnbm9yZUNo\nYW5nZXMoaWdub3JlKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IGFkZEZpbHRlckxpc3RlbmVyKEZpbHRl\nckxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENs\nb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5hZGRGaWx0ZXJMaXN0ZW5l\ncihsaXN0ZW5lcik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAg\ncHVibGljIE9wZW5KUEFRdWVyeSByZW1vdmVGaWx0ZXJMaXN0ZW5lcihGaWx0\nZXJMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIF9lbS5hc3NlcnROb3RD\nbG9zZUludm9rZWQoKTsKICAgICAgICBfcXVlcnkucmVtb3ZlRmlsdGVyTGlz\ndGVuZXIobGlzdGVuZXIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgYWRkQWdncmVnYXRlTGlzdGVuZXIo\nQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBfZW0uYXNz\nZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmFkZEFnZ3Jl\nZ2F0ZUxpc3RlbmVyKGxpc3RlbmVyKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHJlbW92ZUFnZ3JlZ2F0\nZUxpc3RlbmVyKEFnZ3JlZ2F0ZUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAg\nICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVy\neS5yZW1vdmVBZ2dyZWdhdGVMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0\nQ2FuZGlkYXRlQ29sbGVjdGlvbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5\nLmdldENhbmRpZGF0ZUNvbGxlY3Rpb24oKTsKICAgIH0KCiAgICBwdWJsaWMg\nT3BlbkpQQVF1ZXJ5IHNldENhbmRpZGF0ZUNvbGxlY3Rpb24oQ29sbGVjdGlv\nbiBjb2xsKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgp\nOwogICAgICAgIF9xdWVyeS5zZXRDYW5kaWRhdGVDb2xsZWN0aW9uKGNvbGwp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBDbGFz\ncyBnZXRSZXN1bHRDbGFzcygpIHsKICAgICAgICBDbGFzcyByZXMgPSBfcXVl\ncnkuZ2V0UmVzdWx0VHlwZSgpOwogICAgICAgIGlmIChyZXMgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICByZXR1cm4gX3F1ZXJ5\nLmdldENhbmRpZGF0ZVR5cGUoKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQ\nQVF1ZXJ5IHNldFJlc3VsdENsYXNzKENsYXNzIGNscykgewogICAgICAgIF9l\nbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBpZiAoSW1wbEhl\nbHBlci5pc01hbmFnZWRUeXBlKF9lbS5nZXRDb25maWd1cmF0aW9uKCksIGNs\ncykpCiAgICAgICAgICAgIF9xdWVyeS5zZXRDYW5kaWRhdGVUeXBlKGNscywg\ndHJ1ZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfcXVlcnkuc2V0UmVz\ndWx0VHlwZShjbHMpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N1YmNsYXNzZXMoKSB7CiAgICAgICAgcmV0\ndXJuIF9xdWVyeS5oYXNTdWJjbGFzc2VzKCk7CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFRdWVyeSBzZXRTdWJjbGFzc2VzKGJvb2xlYW4gc3Vicykgewog\nICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBD\nbGFzcyBjbHMgPSBfcXVlcnkuZ2V0Q2FuZGlkYXRlVHlwZSgpOwogICAgICAg\nIF9xdWVyeS5zZXRDYW5kaWRhdGVFeHRlbnQoX3F1ZXJ5LmdldEJyb2tlcigp\nLm5ld0V4dGVudChjbHMsIHN1YnMpKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEZpcnN0UmVzdWx0KCkgewogICAg\nICAgIHJldHVybiBhc0ludChfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldEZpcnN0UmVzdWx0KGlu\ndCBzdGFydFBvc2l0aW9uKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3Nl\nSW52b2tlZCgpOwogICAgICAgIGxvbmcgZW5kOwogICAgICAgIGlmIChfcXVl\ncnkuZ2V0RW5kUmFuZ2UoKSA9PSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAg\nICAgZW5kID0gTG9uZy5NQVhfVkFMVUU7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBlbmQgPSBzdGFydFBvc2l0aW9uICsKICAgICAgICAgICAgICAgIChf\ncXVlcnkuZ2V0RW5kUmFuZ2UoKSAtIF9xdWVyeS5nZXRTdGFydFJhbmdlKCkp\nOwogICAgICAgIF9xdWVyeS5zZXRSYW5nZShzdGFydFBvc2l0aW9uLCBlbmQp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nZ2V0TWF4UmVzdWx0cygpIHsKICAgICAgICByZXR1cm4gYXNJbnQoX3F1ZXJ5\nLmdldEVuZFJhbmdlKCkgLSBfcXVlcnkuZ2V0U3RhcnRSYW5nZSgpKTsKICAg\nIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldE1heFJlc3VsdHMoaW50\nIG1heCkgewogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsK\nICAgICAgICBsb25nIHN0YXJ0ID0gX3F1ZXJ5LmdldFN0YXJ0UmFuZ2UoKTsK\nICAgICAgICBpZiAobWF4ID09IEludGVnZXIuTUFYX1ZBTFVFKQogICAgICAg\nICAgICBfcXVlcnkuc2V0UmFuZ2Uoc3RhcnQsIExvbmcuTUFYX1ZBTFVFKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9xdWVyeS5zZXRSYW5nZShzdGFy\ndCwgc3RhcnQgKyBtYXgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgY29tcGlsZSgpIHsKICAgICAgICBf\nZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmNv\nbXBpbGUoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwcml2\nYXRlIE9iamVjdCBleGVjdXRlKCkgewogICAgICAgIGlmICgoIWlzTmF0aXZl\nKCkpICYmCiAgICAgICAgICAgIF9xdWVyeS5nZXRPcGVyYXRpb24oKSAhPSBR\ndWVyeU9wZXJhdGlvbnMuT1BfU0VMRUNUKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3Qtc2VsZWN0\nLXF1ZXJ5IiwKICAgICAgICAgICAgICAgIF9xdWVyeS5nZXRRdWVyeVN0cmlu\nZygpKSwgbnVsbCwgbnVsbCwgZmFsc2UpOwoKICAgICAgICB2YWxpZGF0ZVBh\ncmFtZXRlcnMoKTsKCiAgICAgICAgLy8gaGFuZGxlIHdoaWNoIHR5cGVzIG9m\nIHBhcmFtZXRlcnMgd2UgYXJlIHVzaW5nLCBpZiBhbnkKICAgICAgICBpZiAo\nX3Bvc2l0aW9uYWwgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9xdWVy\neS5leGVjdXRlKF9wb3NpdGlvbmFsLnRvQXJyYXkoKSk7CiAgICAgICAgaWYg\nKF9uYW1lZCAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4gX3F1ZXJ5LmV4\nZWN1dGUoX25hbWVkKTsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmV4ZWN1dGUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIHR5\ncGVzIG9mIHRoZSBwYXJhbWV0ZXJzIGFyZSBjb3JyZWN0LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgdmFsaWRhdGVQYXJhbWV0ZXJzKCkgewogICAgICAg\nIGlmIChfcG9zaXRpb25hbCAhPSBudWxsKSB7CiAgICAgICAgICAgIExpbmtl\nZE1hcCB0eXBlcyA9IF9xdWVyeS5nZXRQYXJhbWV0ZXJUeXBlcygpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMCwKICAgICAgICAgICAgICAgIHNpemUg\nPSBNYXRoLm1pbihfcG9zaXRpb25hbC5zaXplKCksIHR5cGVzLnNpemUoKSk7\nCiAgICAgICAgICAgICAgICBpIDwgc2l6ZTsgaSsrKQogICAgICAgICAgICAg\nICAgdmFsaWRhdGVQYXJhbWV0ZXIoU3RyaW5nLnZhbHVlT2YoaSksCiAgICAg\nICAgICAgICAgICAgICAgKENsYXNzKSB0eXBlcy5nZXRWYWx1ZShpKSwgX3Bv\nc2l0aW9uYWwuZ2V0KGkpKTsKICAgICAgICB9IGVsc2UgaWYgKF9uYW1lZCAh\nPSBudWxsKSB7CiAgICAgICAgICAgIE1hcCB0eXBlcyA9IF9xdWVyeS5nZXRQ\nYXJhbWV0ZXJUeXBlcygpOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGkg\nPSBfbmFtZWQuZW50cnlTZXQoKS5pdGVyYXRvcigpOyBpLmhhc05leHQoKTsp\nIHsKICAgICAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeSA9IChNYXAuRW50\ncnkpIGkubmV4dCgpOwogICAgICAgICAgICAgICAgU3RyaW5nIG5hbWUgPSAo\nU3RyaW5nKSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIHZhbGlk\nYXRlUGFyYW1ldGVyKG5hbWUsIChDbGFzcykgdHlwZXMuZ2V0KG5hbWUpLAog\nICAgICAgICAgICAgICAgICAgIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCB2YWxp\nZGF0ZVBhcmFtZXRlcihTdHJpbmcgcGFyYW1EZXNjLCBDbGFzcyB0eXBlLCBP\nYmplY3QgcGFyYW0pIHsKICAgICAgICAvLyBudWxsIHBhcmFtZXRlcnMgYXJl\nIGFsbG93ZWQsIHNvIGFyZSBub3QgdmFsaWRhdGVkCiAgICAgICAgaWYgKHBh\ncmFtID09IG51bGwgfHwgdHlwZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIGNoZWNrIHRoZSBwYXJhbWV0ZXIgYWdhaW5zdCB0\naGUgd3JhcHBlZCB0eXBlCiAgICAgICAgaWYgKCFGaWx0ZXJzLndyYXAodHlw\nZSkuaXNJbnN0YW5jZShwYXJhbSkpCiAgICAgICAgICAgIHRocm93IG5ldyBB\ncmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXBhcmFtLXR5cGUiLAog\nICAgICAgICAgICAgICAgcGFyYW1EZXNjLCBwYXJhbS5nZXRDbGFzcygpLmdl\ndE5hbWUoKSwgdHlwZS5nZXROYW1lKCkpLAogICAgICAgICAgICAgICAgbnVs\nbCwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldFJl\nc3VsdExpc3QoKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tl\nZCgpOwogICAgICAgIE9iamVjdCBvYiA9IGV4ZWN1dGUoKTsKICAgICAgICBp\nZiAob2IgaW5zdGFuY2VvZiBMaXN0KSB7CiAgICAgICAgICAgIExpc3QgcmV0\nID0gKExpc3QpIG9iOwogICAgICAgICAgICBpZiAocmV0IGluc3RhbmNlb2Yg\nUmVzdWx0TGlzdCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGVsZWdh\ndGluZ1Jlc3VsdExpc3QoKFJlc3VsdExpc3QpIHJldCwKICAgICAgICAgICAg\nICAgICAgICBQZXJzaXN0ZW5jZUV4Y2VwdGlvbnMuZ2V0Um9sbGJhY2tUcmFu\nc2xhdG9yKF9lbSkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICByZXR1cm4gcmV0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIENvbGxl\nY3Rpb25zLnNpbmdsZXRvbkxpc3Qob2IpOwogICAgfQoKICAgIC8qKgogICAg\nICogRXhlY3V0ZSBhIHF1ZXJ5IHRoYXQgcmV0dXJucyBhIHNpbmdsZSByZXN1\nbHQuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0U2luZ2xlUmVzdWx0\nKCkgewogICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAg\nICAgICAvLyB0ZW1wb3JhcmlseSBzZXQgcXVlcnkgdG8gdW5pcXVlIHNvIHRo\nYXQgYSBzaW5nbGUgcmVzdWx0IGlzIHZhbGlkYXRlZAogICAgICAgIC8vIGFu\nZCByZXR1cm5lZDsgdW5zZXQgYWdhaW4gaW4gY2FzZSB0aGUgdXNlciBleGVj\ndXRlcyBxdWVyeSBhZ2FpbgogICAgICAgIC8vIHZpYSBnZXRSZXN1bHRMaXN0\nCiAgICAgICAgX3F1ZXJ5LnNldFVuaXF1ZSh0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gZXhlY3V0ZSgpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS5zZXRVbmlxdWUoZmFsc2UpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgaW50IGV4ZWN1dGVVcGRhdGUo\nKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAg\nICAgIGlmIChfcXVlcnkuZ2V0T3BlcmF0aW9uKCkgPT0gUXVlcnlPcGVyYXRp\nb25zLk9QX0RFTEVURSkgewogICAgICAgICAgICAvLyBoYW5kbGUgd2hpY2gg\ndHlwZXMgb2YgcGFyYW1ldGVycyB3ZSBhcmUgdXNpbmcsIGlmIGFueQogICAg\nICAgICAgICBpZiAoX3Bvc2l0aW9uYWwgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBhc0ludChfcXVlcnkuZGVsZXRlQWxsKF9wb3NpdGlvbmFs\nLnRvQXJyYXkoKSkpOwogICAgICAgICAgICBpZiAoX25hbWVkICE9IG51bGwp\nCiAgICAgICAgICAgICAgICByZXR1cm4gYXNJbnQoX3F1ZXJ5LmRlbGV0ZUFs\nbChfbmFtZWQpKTsKICAgICAgICAgICAgcmV0dXJuIGFzSW50KF9xdWVyeS5k\nZWxldGVBbGwoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChfcXVlcnkuZ2V0\nT3BlcmF0aW9uKCkgPT0gUXVlcnlPcGVyYXRpb25zLk9QX1VQREFURSkgewog\nICAgICAgICAgICAvLyBoYW5kbGUgd2hpY2ggdHlwZXMgb2YgcGFyYW1ldGVy\ncyB3ZSBhcmUgdXNpbmcsIGlmIGFueQogICAgICAgICAgICBpZiAoX3Bvc2l0\naW9uYWwgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBhc0ludChf\ncXVlcnkudXBkYXRlQWxsKF9wb3NpdGlvbmFsLnRvQXJyYXkoKSkpOwogICAg\nICAgICAgICBpZiAoX25hbWVkICE9IG51bGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gYXNJbnQoX3F1ZXJ5LnVwZGF0ZUFsbChfbmFtZWQpKTsKICAgICAg\nICAgICAgcmV0dXJuIGFzSW50KF9xdWVyeS51cGRhdGVBbGwoKSk7CiAgICAg\nICAgfQogICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoIm5vdC11cGRhdGUtZGVsZXRlLXF1ZXJ5IiwKICAgICAgICAg\nICAgX3F1ZXJ5LmdldFF1ZXJ5U3RyaW5nKCkpLCBudWxsLCBudWxsLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYXN0IHRoZSBzcGVjaWZpZWQg\nbG9uZyBkb3duIHRvIGFuIGludCwgZmlyc3QgY2hlY2tpbmcgZm9yIG92ZXJm\nbG93LgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBpbnQgYXNJbnQobG9u\nZyBsKSB7CiAgICAgICAgaWYgKGwgPiBJbnRlZ2VyLk1BWF9WQUxVRSkKICAg\nICAgICAgICAgcmV0dXJuIEludGVnZXIuTUFYX1ZBTFVFOwogICAgICAgIGlm\nIChsIDwgSW50ZWdlci5NSU5fVkFMVUUpIC8vIHVubGlrZWx5LCBidXQgd2Ug\nbWlnaHQgYXMgd2VsbCBjaGVjawogICAgICAgICAgICByZXR1cm4gSW50ZWdl\nci5NSU5fVkFMVUU7CiAgICAgICAgcmV0dXJuIChpbnQpIGw7CiAgICB9Cgog\nICAgcHVibGljIEZsdXNoTW9kZVR5cGUgZ2V0Rmx1c2hNb2RlKCkgewogICAg\nICAgIHJldHVybiBFbnRpdHlNYW5hZ2VySW1wbC5mcm9tRmx1c2hCZWZvcmVR\ndWVyaWVzKF9xdWVyeS4KICAgICAgICAgICAgZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCkuZ2V0Rmx1c2hCZWZvcmVRdWVyaWVzKCkpOwogICAgfQoKICAgIHB1\nYmxpYyBPcGVuSlBBUXVlcnkgc2V0Rmx1c2hNb2RlKEZsdXNoTW9kZVR5cGUg\nZmx1c2hNb2RlKSB7CiAgICAgICAgX2VtLmFzc2VydE5vdENsb3NlSW52b2tl\nZCgpOwogICAgICAgIF9xdWVyeS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKS5z\nZXRGbHVzaEJlZm9yZVF1ZXJpZXMKICAgICAgICAgICAgKEVudGl0eU1hbmFn\nZXJJbXBsLnRvRmx1c2hCZWZvcmVRdWVyaWVzKGZsdXNoTW9kZSkpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVl\ncnkgc2V0SGludChTdHJpbmcga2V5LCBPYmplY3QgdmFsdWUpIHsKICAgICAg\nICBfZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgaWYgKGtl\neSA9PSBudWxsIHx8ICFrZXkuc3RhcnRzV2l0aCgib3BlbmpwYS4iKSkKICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgU3RyaW5nIGsgPSBrZXku\nc3Vic3RyaW5nKCJvcGVuanBhLiIubGVuZ3RoKCkpOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICBpZiAoIlN1YmNsYXNzZXMiLmVxdWFscyhrKSkgewog\nICAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKQog\nICAgICAgICAgICAgICAgICAgIHZhbHVlID0gQm9vbGVhbi52YWx1ZU9mKChT\ndHJpbmcpIHZhbHVlKTsKICAgICAgICAgICAgICAgIHNldFN1YmNsYXNzZXMo\nKChCb29sZWFuKSB2YWx1ZSkuYm9vbGVhblZhbHVlKCkpOwogICAgICAgICAg\nICB9IGVsc2UgaWYgKCJGaWx0ZXJMaXN0ZW5lciIuZXF1YWxzKGspKQogICAg\nICAgICAgICAgICAgYWRkRmlsdGVyTGlzdGVuZXIoRmlsdGVycy5oaW50VG9G\naWx0ZXJMaXN0ZW5lcih2YWx1ZSwKICAgICAgICAgICAgICAgICAgICBfcXVl\ncnkuZ2V0QnJva2VyKCkuZ2V0Q2xhc3NMb2FkZXIoKSkpOwogICAgICAgICAg\nICBlbHNlIGlmICgiRmlsdGVyTGlzdGVuZXJzIi5lcXVhbHMoaykpIHsKICAg\nICAgICAgICAgICAgIEZpbHRlckxpc3RlbmVyW10gYXJyID0gRmlsdGVycy5o\naW50VG9GaWx0ZXJMaXN0ZW5lcnModmFsdWUsCiAgICAgICAgICAgICAgICAg\nICAgX3F1ZXJ5LmdldEJyb2tlcigpLmdldENsYXNzTG9hZGVyKCkpOwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgICAgICAgICAgYWRkRmlsdGVyTGlzdGVuZXIoYXJy\nW2ldKTsKICAgICAgICAgICAgfSBlbHNlIGlmICgiQWdncmVnYXRlTGlzdGVu\nZXIiLmVxdWFscyhrKSkKICAgICAgICAgICAgICAgIGFkZEFnZ3JlZ2F0ZUxp\nc3RlbmVyKEZpbHRlcnMuaGludFRvQWdncmVnYXRlTGlzdGVuZXIodmFsdWUs\nCiAgICAgICAgICAgICAgICAgICAgX3F1ZXJ5LmdldEJyb2tlcigpLmdldENs\nYXNzTG9hZGVyKCkpKTsKICAgICAgICAgICAgZWxzZSBpZiAoIkZpbHRlckxp\nc3RlbmVycyIuZXF1YWxzKGspKSB7CiAgICAgICAgICAgICAgICBBZ2dyZWdh\ndGVMaXN0ZW5lcltdIGFyciA9IEZpbHRlcnMuaGludFRvQWdncmVnYXRlTGlz\ndGVuZXJzCiAgICAgICAgICAgICAgICAgICAgKHZhbHVlLCBfcXVlcnkuZ2V0\nQnJva2VyKCkuZ2V0Q2xhc3NMb2FkZXIoKSk7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgICAgICBhZGRBZ2dyZWdhdGVMaXN0ZW5lcihhcnJbaV0pOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGsuc3RhcnRzV2l0aCgiRmV0Y2hQbGFuLiIp\nKSB7CiAgICAgICAgICAgICAgICBrID0gay5zdWJzdHJpbmcoIkZldGNoUGxh\nbi4iLmxlbmd0aCgpKTsKICAgICAgICAgICAgICAgIGhpbnRUb1NldHRlcihn\nZXRGZXRjaFBsYW4oKSwgaywgdmFsdWUpOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKGsuc3RhcnRzV2l0aCgiaGludC4iKSkgewogICAgICAgICAgICAgICAg\naWYgKCJoaW50Lk9wdGltaXplUmVzdWx0Q291bnQiLmVxdWFscyhrKSkgewog\nICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmlu\nZykgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsdWUgPSBuZXcgSW50ZWdlcigoU3RyaW5n\nKSB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE51\nbWJlckZvcm1hdEV4Y2VwdGlvbiBuZmUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIE51bWJlcikgCiAgICAgICAg\nICAgICAgICAgICAgICAgIHx8ICgoTnVtYmVyKSB2YWx1ZSkuaW50VmFsdWUo\nKSA8IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1\nbWVudEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKCJiYWQtcXVlcnktaGludC12YWx1ZSIsIGtleSwgdmFsdWUpLCBu\ndWxsLCBudWxsLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9xdWVyeS5n\nZXRGZXRjaENvbmZpZ3VyYXRpb24oKS5zZXRIaW50KGtleSwgdmFsdWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLXF1\nZXJ5LWhpbnQiLCBrZXkpLAogICAgICAgICAgICAgICAgICAgIG51bGwsIG51\nbGwsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgUGVy\nc2lzdGVuY2VFeGNlcHRpb25zLnRvUGVyc2lzdGVuY2VFeGNlcHRpb24oZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBoaW50VG9TZXR0\nZXIoRmV0Y2hQbGFuIGZldGNoUGxhbiwgU3RyaW5nIGssIE9iamVjdCB2YWx1\nZSkgewogICAgICAgIGlmIChmZXRjaFBsYW4gPT0gbnVsbCB8fCBrID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWV0aG9kIHNldHRl\nciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihmZXRjaFBsYW4uZ2V0Q2xhc3Mo\nKSwgaywgdHJ1ZSk7CiAgICAgICAgQ2xhc3MgcGFyYW1UeXBlID0gc2V0dGVy\nLmdldFBhcmFtZXRlclR5cGVzKClbMF07CiAgICAgICAgaWYgKEVudW0uY2xh\nc3MuaXNBc3NpZ25hYmxlRnJvbShwYXJhbVR5cGUpICYmIHZhbHVlIGluc3Rh\nbmNlb2YgU3RyaW5nKQogICAgICAgICAgICB2YWx1ZSA9IEVudW0udmFsdWVP\nZihwYXJhbVR5cGUsIChTdHJpbmcpIHZhbHVlKTsKICAgICAgICAKICAgICAg\nICBGaWx0ZXJzLmhpbnRUb1NldHRlcihmZXRjaFBsYW4sIGssIHZhbHVlKTsK\nICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVF1ZXJ5IHNldFBhcmFtZXRlcihp\nbnQgcG9zaXRpb24sIENhbGVuZGFyIHZhbHVlLAogICAgICAgIFRlbXBvcmFs\nVHlwZSB0KSB7CiAgICAgICAgcmV0dXJuIHNldFBhcmFtZXRlcihwb3NpdGlv\nbiwgdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkgc2V0\nUGFyYW1ldGVyKGludCBwb3NpdGlvbiwgRGF0ZSB2YWx1ZSwKICAgICAgICBU\nZW1wb3JhbFR5cGUgdHlwZSkgewogICAgICAgIHJldHVybiBzZXRQYXJhbWV0\nZXIocG9zaXRpb24sIHZhbHVlKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQ\nQVF1ZXJ5IHNldFBhcmFtZXRlcihpbnQgcG9zaXRpb24sIE9iamVjdCB2YWx1\nZSkgewogICAgICAgIF9xdWVyeS5hc3NlcnRPcGVuKCk7CiAgICAgICAgX2Vt\nLmFzc2VydE5vdENsb3NlSW52b2tlZCgpOwogICAgICAgIF9xdWVyeS5sb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAJaWYgKGlzTmF0aXZlKCkgJiYg\ncG9zaXRpb24gPCAxKSB7CiAgICAgICAgCQl0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtcG9zLXBhcmFtcyIsIAog\nICAgICAgIAkJICAgICAgcG9zaXRpb24sIF9xdWVyeS5nZXRRdWVyeVN0cmlu\nZygpKS50b1N0cmluZygpKTsKICAgICAgICAJfQogICAgICAgICAgICAvLyBu\nb3QgYWxsb3dlZCB0byBtaXggcG9zaXRpb25hbCBhbmQgbmFtZWQgcGFyYW1l\ndGVycyAoRURSMiAzLjYuNCkKICAgICAgICAgICAgaWYgKF9uYW1lZCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4\nY2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICgibm8tcG9z\nLW5hbWVkLXBhcmFtcy1taXgiLCBfcXVlcnkuZ2V0UXVlcnlTdHJpbmcoKSks\nCiAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCwgZmFsc2UpOwoKICAg\nICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMSkKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAg\nICAgICAgICAgICAgICAoImlsbGVnYWwtaW5kZXgiLCBwb3NpdGlvbiksIG51\nbGwsIG51bGwsIGZhbHNlKTsKCiAgICAgICAgICAgIGlmIChfcG9zaXRpb25h\nbCA9PSBudWxsKQogICAgICAgICAgICAgICAgX3Bvc2l0aW9uYWwgPSBuZXcg\nQXJyYXlMaXN0KCk7CgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgaXQgaXMg\nYXQgbGVhc3QgdGhlIHJlcXVlc3RlZCBzaXplCiAgICAgICAgICAgIHdoaWxl\nIChfcG9zaXRpb25hbC5zaXplKCkgPCBwb3NpdGlvbikKICAgICAgICAgICAg\nICAgIF9wb3NpdGlvbmFsLmFkZChudWxsKTsKCiAgICAgICAgICAgIC8vIG5v\ndGUgdGhhdCB3ZSBhZGQgaXQgdG8gcG9zaXRpb24gLSAxLCBzaW5jZSBzZXRQ\nb3NpdGlvbgogICAgICAgICAgICAvLyBzdGFydHMgYXQgMSwgd2hpbGUgTGlz\ndCBzdGFydHMgYXQgMAogICAgICAgICAgICBfcG9zaXRpb25hbC5zZXQocG9z\naXRpb24gLSAxLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBz\nZXRQYXJhbWV0ZXIoU3RyaW5nIG5hbWUsIENhbGVuZGFyIHZhbHVlLAogICAg\nICAgIFRlbXBvcmFsVHlwZSB0KSB7CiAgICAgICAgcmV0dXJuIHNldFBhcmFt\nZXRlcihuYW1lLCB2YWx1ZSk7CiAgICB9CgogICAgcHVibGljIE9wZW5KUEFR\ndWVyeSBzZXRQYXJhbWV0ZXIoU3RyaW5nIG5hbWUsIERhdGUgdmFsdWUsCiAg\nICAgICAgVGVtcG9yYWxUeXBlIHR5cGUpIHsKICAgICAgICByZXR1cm4gc2V0\nUGFyYW1ldGVyKG5hbWUsIHZhbHVlKTsKICAgIH0KCiAgICBwdWJsaWMgT3Bl\nbkpQQVF1ZXJ5IHNldFBhcmFtZXRlcihTdHJpbmcgbmFtZSwgT2JqZWN0IHZh\nbHVlKSB7CiAgICAgICAgX3F1ZXJ5LmFzc2VydE9wZW4oKTsKICAgICAgICBf\nZW0uYXNzZXJ0Tm90Q2xvc2VJbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5Lmxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgIAlpZiAoaXNOYXRpdmUoKSkg\newogICAgICAgIAkJdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tbmFtZWQtcGFyYW1zIiwgCiAgICAgICAgCQkgICAg\nbmFtZSwgX3F1ZXJ5LmdldFF1ZXJ5U3RyaW5nKCkpLnRvU3RyaW5nKCkpOwog\nICAgICAgIAl9CiAgICAgICAgICAgIC8vIG5vdCBhbGxvd2VkIHRvIG1peCBw\nb3NpdGlvbmFsIGFuZCBuYW1lZCBwYXJhbWV0ZXJzIChFRFIyIDMuNi40KQog\nICAgICAgICAgICBpZiAoX3Bvc2l0aW9uYWwgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5n\nZXQKICAgICAgICAgICAgICAgICAgICAoIm5vLXBvcy1uYW1lZC1wYXJhbXMt\nbWl4IiwgX3F1ZXJ5LmdldFF1ZXJ5U3RyaW5nKCkpLAogICAgICAgICAgICAg\nICAgICAgIG51bGwsIG51bGwsIGZhbHNlKTsKCiAgICAgICAgICAgIGlmIChf\nbmFtZWQgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9uYW1lZCA9IG5ldyBI\nYXNoTWFwKCk7CiAgICAgICAgICAgIF9uYW1lZC5wdXQobmFtZSwgdmFsdWUp\nOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBfcXVlcnkudW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBpc05hdGl2ZSgpIHsKICAgIAly\nZXR1cm4gUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1YWxzKGdldExhbmd1\nYWdlKCkpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc1Bvc2l0aW9u\nYWxQYXJhbWV0ZXJzKCkgewogICAgICAgIHJldHVybiBfcG9zaXRpb25hbCAh\nPSBudWxsOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBnZXRQb3NpdGlv\nbmFsUGFyYW1ldGVycygpIHsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX3Bvc2l0aW9uYWwgPT0g\nbnVsbCkgPyBFTVBUWV9BUlJBWSA6IF9wb3NpdGlvbmFsLnRvQXJyYXkoKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfcXVlcnkudW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBUXVlcnkg\nc2V0UGFyYW1ldGVycyhPYmplY3QuLi4gcGFyYW1zKSB7CiAgICAgICAgX3F1\nZXJ5LmFzc2VydE9wZW4oKTsKICAgICAgICBfZW0uYXNzZXJ0Tm90Q2xvc2VJ\nbnZva2VkKCk7CiAgICAgICAgX3F1ZXJ5LmxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBfcG9zaXRpb25hbCA9IG51bGw7CiAgICAgICAgICAg\nIF9uYW1lZCA9IG51bGw7CiAgICAgICAgICAgIGlmIChwYXJhbXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFyYW1z\nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIHNldFBhcmFtZXRl\ncihpICsgMSwgcGFyYW1zW2ldKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX3F1ZXJ5LnVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgTWFwIGdldE5hbWVk\nUGFyYW1ldGVycygpIHsKICAgICAgICBfcXVlcnkubG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoX25hbWVkID09IG51bGwpID8g\nQ29sbGVjdGlvbnMuRU1QVFlfTUFQCiAgICAgICAgICAgICAgICA6IENvbGxl\nY3Rpb25zLnVubW9kaWZpYWJsZU1hcChfbmFtZWQpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIE9wZW5KUEFRdWVyeSBzZXRQYXJhbWV0ZXJz\nKE1hcCBwYXJhbXMpIHsKICAgICAgICBfcXVlcnkuYXNzZXJ0T3BlbigpOwog\nICAgICAgIF9lbS5hc3NlcnROb3RDbG9zZUludm9rZWQoKTsKICAgICAgICBf\ncXVlcnkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9wb3Np\ndGlvbmFsID0gbnVsbDsKICAgICAgICAgICAgX25hbWVkID0gbnVsbDsKICAg\nICAgICAgICAgaWYgKHBhcmFtcyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nZm9yIChNYXAuRW50cnkgZSA6IChTZXQ8TWFwLkVudHJ5PikgcGFyYW1zLmVu\ndHJ5U2V0KCkpCiAgICAgICAgICAgICAgICAgICAgc2V0UGFyYW1ldGVyKChT\ndHJpbmcpIGUuZ2V0S2V5KCksIGUuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9xdWVyeS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIE9wZW5KUEFRdWVyeSBjbG9zZUFsbCgpIHsKICAgICAgICBfcXVlcnkuY2xv\nc2VBbGwoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhNYXAgcGFyYW1zKSB7\nCiAgICAgICAgcmV0dXJuIF9xdWVyeS5nZXREYXRhU3RvcmVBY3Rpb25zKHBh\ncmFtcyk7CiAgICB9CgogICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICByZXR1cm4gX3F1ZXJ5Lmhhc2hDb2RlKCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciA9PSB0aGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFF1ZXJ5SW1wbCkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmVx\ndWFscygoKFF1ZXJ5SW1wbCkgb3RoZXIpLl9xdWVyeSk7Cgl9Cn0K\n","encoding":"base64"}

