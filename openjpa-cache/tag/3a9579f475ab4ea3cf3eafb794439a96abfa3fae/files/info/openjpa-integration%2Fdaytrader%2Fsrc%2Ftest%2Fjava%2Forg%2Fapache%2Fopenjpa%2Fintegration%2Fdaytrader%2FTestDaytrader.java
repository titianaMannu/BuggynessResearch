{"sha":"d7b047827a29b37dc9620f123ea3a08040030d01","node_id":"MDQ6QmxvYjIwNjM2NDpkN2IwNDc4MjdhMjliMzdkYzk2MjBmMTIzZWEzYTA4MDQwMDMwZDAx","size":18103,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d7b047827a29b37dc9620f123ea3a08040030d01","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuaW50ZWdyYXRpb24uZGF5dHJh\nZGVyOwoKaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2\nYS5zcWwuVGltZXN0YW1wOwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLkVu\ndGl0eU1hbmFnZXI7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5RdWVyeTsK\nCi8vIGltcG9ydCBvcmcuYXBhY2hlLmdlcm9uaW1vLnNhbXBsZXMuZGF5dHJh\nZGVyLmJlYW5zLkFjY291bnREYXRhQmVhbjsKLy8gaW1wb3J0IG9yZy5hcGFj\naGUuZ2Vyb25pbW8uc2FtcGxlcy5kYXl0cmFkZXIuYmVhbnMuQWNjb3VudFBy\nb2ZpbGVEYXRhQmVhbjsKLy8gaW1wb3J0IG9yZy5hcGFjaGUuZ2Vyb25pbW8u\nc2FtcGxlcy5kYXl0cmFkZXIuYmVhbnMuSG9sZGluZ0RhdGFCZWFuOwovLyBp\nbXBvcnQgb3JnLmFwYWNoZS5nZXJvbmltby5zYW1wbGVzLmRheXRyYWRlci5i\nZWFucy5PcmRlckRhdGFCZWFuOwovLyBpbXBvcnQgb3JnLmFwYWNoZS5nZXJv\nbmltby5zYW1wbGVzLmRheXRyYWRlci5iZWFucy5RdW90ZURhdGFCZWFuOwov\nLyBpbXBvcnQgb3JnLmFwYWNoZS5nZXJvbmltby5zYW1wbGVzLmRheXRyYWRl\nci5jb3JlLkZpbmFuY2lhbFV0aWxzOwovLyBpbXBvcnQgb3JnLmFwYWNoZS5n\nZXJvbmltby5zYW1wbGVzLmRheXRyYWRlci51dGlsLlRyYWRlQ29uZmlnOwov\nLyBpbXBvcnQgb3JnLmFwYWNoZS5nZXJvbmltby5zYW1wbGVzLmRheXRyYWRl\nci53ZWIuVHJhZGVCdWlsZERCOwoKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5wZXJzaXN0ZW5jZS5PcGVuSlBBRW50aXR5TWFuYWdlckZhY3RvcnlTUEk7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEucGVyc2lzdGVuY2UuT3BlbkpQ\nQVBlcnNpc3RlbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnBlcnNp\nc3RlbmNlLnRlc3QuU2luZ2xlRU1GVGVzdENhc2U7CgovKioKICogVXNlcyBE\nYXl0cmFkZXIgdG8gc3RyZXNzIHRlc3QgT3BlbkpQQS4KICoKICogQHZlcnNp\nb24gJFJldiQgJERhdGUkCiAqLwpwdWJsaWMgY2xhc3MgVGVzdERheXRyYWRl\nciBleHRlbmRzIFNpbmdsZUVNRlRlc3RDYXNlIHsKCiAgICBPcGVuSlBBRW50\naXR5TWFuYWdlckZhY3RvcnlTUEkgZW1mID0gbnVsbDsKICAgIC8vcHJpdmF0\nZSBUcmFkZUpQQURpcmVjdCB0cmFkZSA9IG51bGw7CiAgICAKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB7CiAgICAgICAgc3VwZXIu\nc2V0VXAoRFJPUF9UQUJMRVMsIEFjY291bnREYXRhQmVhbi5jbGFzcywKICAg\nICAgICAgICAgQWNjb3VudFByb2ZpbGVEYXRhQmVhbi5jbGFzcywgSG9sZGlu\nZ0RhdGFCZWFuLmNsYXNzLAogICAgICAgICAgICBPcmRlckRhdGFCZWFuLmNs\nYXNzLCBRdW90ZURhdGFCZWFuLmNsYXNzKTsKICAgICAgICBpZiAoZW1mID09\nIG51bGwpIHsKICAgICAgICAgICAgZW1mID0gKE9wZW5KUEFFbnRpdHlNYW5h\nZ2VyRmFjdG9yeVNQSSlPcGVuSlBBUGVyc2lzdGVuY2UuY3JlYXRlRW50aXR5\nTWFuYWdlckZhY3RvcnkoCiAgICAgICAgICAgICAgICAiZGF5dHJhZGVyIiwg\nInBlcnNpc3RlbmNlLnhtbCIpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxs\nKGVtZik7CiAgICAgICAgfQogICAgICAgIC8vdHJhZGUgPSBuZXcgVHJhZGVK\nUEFEaXJlY3QoKEVudGl0eU1hbmFnZXJGYWN0b3J5KWVtZik7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogU2NlbmFyaW8gYmVpbmcgdGVzdGVkOgogICAg\nICogQHRocm93cyBFeGNlcHRpb24gCiAgICAgKiAgIAogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBuZXd0ZXN0VHJhZGVCdWlsZERCKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgZ2V0TG9nKCkuaW5mbygidGVzdFRyYWRlQnVpbGRE\nQigpIHN0YXJ0ZWQiKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGVtZik7CiAg\nICAgICAgVHJhZGVCdWlsZERCIHRyYWRlREIgPSBuZXcgVHJhZGVCdWlsZERC\nKGdldExvZygpLCBlbWYpOwogICAgICAgIGdldExvZygpLmluZm8oInRlc3RU\ncmFkZUJ1aWxkREIoKSBjb21wbGV0ZWQiKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0VHJhZGVCdWlsZERCKCkgewogICAgICAgIGdldExvZygpLmlu\nZm8oInRlc3RUcmFkZUJ1aWxkREIoKSBzdGFydGVkIik7CiAgICAgICAgZ2V0\nTG9nKCkuaW5mbygidGVzdFRyYWRlQnVpbGREQigpIGNyZWF0ZVF1b3Rlcygi\nICsgVHJhZGVDb25maWcuZ2V0TUFYX1FVT1RFUygpICsgIikiKTsKICAgICAg\nICBjcmVhdGVRdW90ZXMoVHJhZGVDb25maWcuZ2V0TUFYX1FVT1RFUygpKTsK\nICAgICAgICBnZXRMb2coKS5pbmZvKCJ0ZXN0VHJhZGVCdWlsZERCKCkgY3Jl\nYXRlQWNjb3VudHMoIiArIFRyYWRlQ29uZmlnLmdldE1BWF9VU0VSUygpICsg\nIikiKTsKICAgICAgICBjcmVhdGVBY2NvdW50cyhUcmFkZUNvbmZpZy5nZXRN\nQVhfVVNFUlMoKSk7IC8vIHdpdGggMTAgaG9sZGluZ3MgZWFjaAogICAgICAg\nIGdldExvZygpLmluZm8oInRlc3RUcmFkZUJ1aWxkREIoKSBjb21wbGV0ZWQi\nKTsKICAgIH0KCiAgICAvLyBmcm9tIFRyYWRlQnVpbGREQi5UcmFkZUJ1aWxk\nREIoKQogICAgcHJpdmF0ZSB2b2lkIGNyZWF0ZVF1b3RlcyhpbnQgbnVtKSB7\nCiAgICAgICAgaW50IGVycm9yQ291bnQgPSAwOwogICAgICAgIFN0cmluZyBz\neW1ib2wsIGNvbXBhbnlOYW1lOwogICAgICAgIFRyYWRlQ29uZmlnLnNldE1B\nWF9RVU9URVMobnVtKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51\nbTsgaSsrKSB7CiAgICAgICAgICAgIHN5bWJvbCA9ICJzOiIgKyBpOwogICAg\nICAgICAgICBjb21wYW55TmFtZSA9ICJTIiArIGkgKyAiIEluY29ycG9yYXRl\nZCI7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBRdW90ZURh\ndGFCZWFuIHF1b3RlRGF0YSA9IGNyZWF0ZVF1b3RlKHN5bWJvbCwgY29tcGFu\neU5hbWUsCiAgICAgICAgICAgICAgICAgICAgbmV3IGphdmEubWF0aC5CaWdE\nZWNpbWFsKFRyYWRlQ29uZmlnLnJuZFByaWNlKCkpKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChl\ncnJvckNvdW50KysgPj0gMTApIHsKICAgICAgICAgICAgICAgICAgICBnZXRM\nb2coKS5lcnJvcigiY3JlYXRlUXVvdGVzIC0gYWJvcnRpbmcgYWZ0ZXIgMTAg\nY3JlYXRlIHF1b3RlIGVycm9ycyIsIGUpOwogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKGUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KICAgIAogICAg\nLy8gZnJvbSBUcmFkZUpQQURpcmVjdC5jcmVhdGVRdW90ZSgpCiAgICBwcml2\nYXRlIFF1b3RlRGF0YUJlYW4gY3JlYXRlUXVvdGUoU3RyaW5nIHN5bWJvbCwg\nU3RyaW5nIGNvbXBhbnlOYW1lLCBCaWdEZWNpbWFsIHByaWNlKSB7CiAgICAg\nICAgRW50aXR5TWFuYWdlciBlbnRpdHlNYW5hZ2VyID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKICAgICAgICBRdW90ZURhdGFCZWFuIHF1b3RlID0g\nbmV3IFF1b3RlRGF0YUJlYW4oc3ltYm9sLCBjb21wYW55TmFtZSwgMCwgcHJp\nY2UsIHByaWNlLCBwcmljZSwgcHJpY2UsIDApOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5iZWdp\nbigpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLnBlcnNpc3QocXVvdGUp\nOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCku\nY29tbWl0KCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBnZXRMb2coKS5lcnJvcigiY3JlYXRlUXVvdGUg\nLSByb2xsYmFjayAtIGV4Y2VwdGlvbiBjcmVhdGluZyBRdW90ZSIsIGUpOwog\nICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCkucm9s\nbGJhY2soKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRp\nb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW50aXR5\nTWFuYWdlci5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0TG9n\nKCkuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgZ2V0TG9nKCkudHJh\nY2UoImNyZWF0ZVF1b3RlLS0+IiArIHF1b3RlKTsKICAgICAgICByZXR1cm4g\ncXVvdGU7CiAgICB9CgogICAgLy8gZnJvbSBUcmFkZUJ1aWxkREIuVHJhZGVC\ndWlsZERCKCkKICAgIHByaXZhdGUgdm9pZCBjcmVhdGVBY2NvdW50cyhpbnQg\nbnVtKSB7CiAgICAgICAgVHJhZGVDb25maWcuc2V0TUFYX1VTRVJTKG51bSk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW07IGkrKykgewogICAg\nICAgICAgICBTdHJpbmcgdXNlcklEID0gInVpZDoiICsgaTsKICAgICAgICAg\nICAgU3RyaW5nIGZ1bGxuYW1lID0gVHJhZGVDb25maWcucm5kRnVsbE5hbWUo\nKTsKICAgICAgICAgICAgU3RyaW5nIGVtYWlsID0gVHJhZGVDb25maWcucm5k\nRW1haWwodXNlcklEKTsKICAgICAgICAgICAgU3RyaW5nIGFkZHJlc3MgPSBU\ncmFkZUNvbmZpZy5ybmRBZGRyZXNzKCk7CiAgICAgICAgICAgIFN0cmluZyBj\ncmVkaXRjYXJkID0gVHJhZGVDb25maWcucm5kQ3JlZGl0Q2FyZCgpOwogICAg\nICAgICAgICBkb3VibGUgaW5pdGlhbEJhbGFuY2UgPSAoZG91YmxlKSAoVHJh\nZGVDb25maWcucm5kSW50KDEwMDAwMCkpICsgMjAwMDAwOwogICAgICAgICAg\nICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgICAgICBpbml0aWFsQmFsYW5j\nZSA9IDEwMDAwMDA7IC8vIHVpZDowIHN0YXJ0cyB3aXRoIGEgY29vbCBtaWxs\naW9uLgogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBB\nY2NvdW50RGF0YUJlYW4gYWNjb3VudERhdGEgPSByZWdpc3Rlcih1c2VySUQs\nICJ4eHgiLCBmdWxsbmFtZSwgYWRkcmVzcywKICAgICAgICAgICAgICAgIGVt\nYWlsLCBjcmVkaXRjYXJkLCBuZXcgQmlnRGVjaW1hbChpbml0aWFsQmFsYW5j\nZSkpOwoKICAgICAgICAgICAgU3RyaW5nIHJlc3VsdHMsIHN5bWJvbDsKICAg\nICAgICAgICAgaWYgKGFjY291bnREYXRhICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIC8vIDAtTUFYX0hPTERJTkcgKGluY2x1c2l2ZSksIGF2ZyBob2xk\naW5ncyBwZXIgdXNlciA9IChNQVgtMCkvMgogICAgICAgICAgICAgICAgLy8g\naW50IGhvbGRpbmdzID0gVHJhZGVDb25maWcucm5kSW50KFRyYWRlQ29uZmln\nLmdldE1BWF9IT0xESU5HUygpICsgMSk7CiAgICAgICAgICAgICAgICBpbnQg\naG9sZGluZ3MgPSBUcmFkZUNvbmZpZy5nZXRNQVhfSE9MRElOR1MoKTsKICAg\nICAgICAgICAgICAgIGRvdWJsZSBxdWFudGl0eSA9IDA7CiAgICAgICAgICAg\nICAgICBPcmRlckRhdGFCZWFuIG9yZGVyRGF0YTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgaG9sZGluZ3M7IGorKykgewogICAgICAg\nICAgICAgICAgICAgIHN5bWJvbCA9IFRyYWRlQ29uZmlnLnJuZFN5bWJvbCgp\nOwogICAgICAgICAgICAgICAgICAgIHF1YW50aXR5ID0gVHJhZGVDb25maWcu\ncm5kUXVhbnRpdHkoKTsKICAgICAgICAgICAgICAgICAgICBvcmRlckRhdGEg\nPSBidXkodXNlcklELCBzeW1ib2wsIHF1YW50aXR5LCBUcmFkZUNvbmZpZy5v\ncmRlclByb2Nlc3NpbmdNb2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGlmIChnZXRMb2coKS5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgIGdldExvZygpLnRyYWNlKCJjcmVhdGVBY2NvdW50\ncyAtIGNyZWF0ZWQgIiArIGhvbGRpbmdzICsgIiBmb3IgdXNlcklEPSIgKyB1\nc2VySUQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oImNyZWF0ZUFjY291bnRzIC0g\ndXNlcklEPSIgKyB1c2VySUQgKyAiIGFscmVhZHkgcmVnaXN0ZXJlZC4iKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gZnJv\nbSBUcmFkZUpQQURpcmVjdC5yZWdpc3RlcigpCiAgICBwcml2YXRlIEFjY291\nbnREYXRhQmVhbiByZWdpc3RlcihTdHJpbmcgdXNlcklELCBTdHJpbmcgcGFz\nc3dvcmQsIFN0cmluZyBmdWxsbmFtZSwgCiAgICAgICAgU3RyaW5nIGFkZHJl\nc3MsIFN0cmluZyBlbWFpbCwgU3RyaW5nIGNyZWRpdGNhcmQsIEJpZ0RlY2lt\nYWwgb3BlbkJhbGFuY2UpIHsKICAgICAgICBBY2NvdW50RGF0YUJlYW4gYWNj\nb3VudCA9IG51bGw7CiAgICAgICAgQWNjb3VudFByb2ZpbGVEYXRhQmVhbiBw\ncm9maWxlID0gbnVsbDsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVudGl0eU1h\nbmFnZXIgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwoKICAgICAgICAv\nLyBhc3N1bWUgdGhhdCBwcm9maWxlIHdpdGggdGhlIGRlc2lyZWQgdXNlcklE\nIGRvZWVzbid0IGFscmVhZHkgZXhpc3QKICAgICAgICBwcm9maWxlID0gbmV3\nIEFjY291bnRQcm9maWxlRGF0YUJlYW4odXNlcklELCBwYXNzd29yZCwgZnVs\nbG5hbWUsIGFkZHJlc3MsIGVtYWlsLCBjcmVkaXRjYXJkKTsKICAgICAgICBh\nY2NvdW50ID0gbmV3IEFjY291bnREYXRhQmVhbigwLCAwLCBudWxsLCBuZXcg\nVGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKSwgb3BlbkJh\nbGFuY2UsIG9wZW5CYWxhbmNlLCB1c2VySUQpOwogICAgICAgIHByb2ZpbGUu\nc2V0QWNjb3VudChhY2NvdW50KTsKICAgICAgICBhY2NvdW50LnNldFByb2Zp\nbGUocHJvZmlsZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZW50aXR5\nTWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAg\nIGVudGl0eU1hbmFnZXIucGVyc2lzdChwcm9maWxlKTsKICAgICAgICAgICAg\nZW50aXR5TWFuYWdlci5wZXJzaXN0KGFjY291bnQpOwogICAgICAgICAgICBl\nbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZ2V0TG9n\nKCkuZXJyb3IoImNyZWF0ZVF1b3RlIC0gcm9sbGJhY2sgLSBleGNlcHRpb24g\nY3JlYXRpbmcgUXVvdGUiLCBlKTsKICAgICAgICAgICAgZW50aXR5TWFuYWdl\nci5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKGdldExvZygpLmlzVHJhY2VFbmFibGVkKCkpCiAg\nICAgICAgICAgIGdldExvZygpLnRyYWNlKCJyZWdpc3Rlci0tPiIgKyBhY2Nv\ndW50KTsKICAgICAgICByZXR1cm4gYWNjb3VudDsKICAgIH0KCiAgICBwcml2\nYXRlIE9yZGVyRGF0YUJlYW4gYnV5KFN0cmluZyB1c2VySUQsIFN0cmluZyBz\neW1ib2wsIGRvdWJsZSBxdWFudGl0eSwgaW50IG9yZGVyUHJvY2Vzc2luZ01v\nZGUpIHsKICAgICAgICBPcmRlckRhdGFCZWFuIG9yZGVyID0gbnVsbDsKICAg\nICAgICBCaWdEZWNpbWFsIHRvdGFsOwogICAgICAgIEVudGl0eU1hbmFnZXIg\nZW50aXR5TWFuYWdlciA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CiAg\nICAgICAgYXNzZXJ0Tm90TnVsbChlbnRpdHlNYW5hZ2VyKTsKCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKGdldExvZygpLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICBnZXRMb2coKS50cmFjZSgiYnV5LS0+dXNl\ncklEPSIgKyB1c2VySUQpOwoKICAgICAgICAgICAgZW50aXR5TWFuYWdlci5n\nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CgogICAgICAgICAgICBBY2NvdW50\nUHJvZmlsZURhdGFCZWFuIHByb2ZpbGUgPSBlbnRpdHlNYW5hZ2VyLmZpbmQo\nQWNjb3VudFByb2ZpbGVEYXRhQmVhbi5jbGFzcywgdXNlcklEKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChwcm9maWxlKTsKICAgICAgICAgICAgQWNj\nb3VudERhdGFCZWFuIGFjY291bnQgPSBwcm9maWxlLmdldEFjY291bnQoKTsK\nICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChhY2NvdW50KTsKCiAgICAgICAg\nICAgIFF1b3RlRGF0YUJlYW4gcXVvdGUgPSBlbnRpdHlNYW5hZ2VyLmZpbmQo\nUXVvdGVEYXRhQmVhbi5jbGFzcywgc3ltYm9sKTsKICAgICAgICAgICAgYXNz\nZXJ0Tm90TnVsbChxdW90ZSk7CgogICAgICAgICAgICBIb2xkaW5nRGF0YUJl\nYW4gaG9sZGluZyA9IG51bGw7IC8vIFRoZSBob2xkaW5nIHdpbGwgYmUgY3Jl\nYXRlZCBieSB0aGlzIGJ1eSBvcmRlcgoKICAgICAgICAgICAgb3JkZXIgPSBj\ncmVhdGVPcmRlcihhY2NvdW50LCBxdW90ZSwgaG9sZGluZywgImJ1eSIsIHF1\nYW50aXR5LCBlbnRpdHlNYW5hZ2VyKTsKICAgICAgICAgICAgYXNzZXJ0Tm90\nTnVsbChvcmRlcik7CgogICAgICAgICAgICAvLyBvcmRlciA9IGNyZWF0ZU9y\nZGVyKGFjY291bnQsIHF1b3RlLCBob2xkaW5nLCAiYnV5IiwgcXVhbnRpdHkp\nOwogICAgICAgICAgICAvLyBVUERBVEUgLSBhY2NvdW50IHNob3VsZCBiZSBj\ncmVkaXRlZCBkdXJpbmcgY29tcGxldGVPcmRlcgoKICAgICAgICAgICAgQmln\nRGVjaW1hbCBwcmljZSA9IHF1b3RlLmdldFByaWNlKCk7CiAgICAgICAgICAg\nIEJpZ0RlY2ltYWwgb3JkZXJGZWUgPSBvcmRlci5nZXRPcmRlckZlZSgpOwog\nICAgICAgICAgICBCaWdEZWNpbWFsIGJhbGFuY2UgPSBhY2NvdW50LmdldEJh\nbGFuY2UoKTsKICAgICAgICAgICAgdG90YWwgPSAobmV3IEJpZ0RlY2ltYWwo\ncXVhbnRpdHkpLm11bHRpcGx5KHByaWNlKSkuYWRkKG9yZGVyRmVlKTsKICAg\nICAgICAgICAgYWNjb3VudC5zZXRCYWxhbmNlKGJhbGFuY2Uuc3VidHJhY3Qo\ndG90YWwpKTsKCiAgICAgICAgICAgIC8vIGNvbW1pdCB0aGUgdHJhbnNhY3Rp\nb24gYmVmb3JlIGNhbGxpbmcgY29tcGxldGVPcmRlcgogICAgICAgICAgICBl\nbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CgogICAg\nICAgICAgICAvLyBpZiAob3JkZXJQcm9jZXNzaW5nTW9kZSA9PSBUcmFkZUNv\nbmZpZy5TWU5DSCkKICAgICAgICAgICAgY29tcGxldGVPcmRlcihvcmRlci5n\nZXRPcmRlcklEKCksIGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBnZXRMb2coKS5lcnJvcigiYnV5KCIgKyB1\nc2VySUQgKyAiLCIgKyBzeW1ib2wgKyAiLCIgKyBxdWFudGl0eSArICIpIC0t\nPiBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgLy8gT24gZXhjZXB0aW9uIC0g\nY2FuY2VsIHRoZSBvcmRlcgogICAgICAgICAgICAvLyBUT0RPIGZpZ3VyZSBv\ndXQgaG93IHRvIGRvIHRoaXMgd2l0aCBKUEEKICAgICAgICAgICAgaWYgKG9y\nZGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBvcmRlci5jYW5jZWwoKTsK\nCiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5y\nb2xsYmFjaygpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7\nCiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIgPSBudWxsOwoKICAgICAgICAg\nICAgLy8gdGhyb3cgbmV3IEVKQkV4Y2VwdGlvbihlKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAg\nICAgIGlmIChlbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAg\nZW50aXR5TWFuYWdlci5jbG9zZSgpOwogICAgICAgICAgICBlbnRpdHlNYW5h\nZ2VyID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIGFmdGVyIHRoZSBw\ndXJjaGFzZSBvciBzZWxsIG9mIGEgc3RvY2ssIHVwZGF0ZSB0aGUgc3RvY2tz\nIHZvbHVtZSBhbmQgcHJpY2UKICAgICAgICB1cGRhdGVRdW90ZVByaWNlVm9s\ndW1lKHN5bWJvbCwgVHJhZGVDb25maWcuZ2V0UmFuZG9tUHJpY2VDaGFuZ2VG\nYWN0b3IoKSwgcXVhbnRpdHkpOwoKICAgICAgICByZXR1cm4gb3JkZXI7CiAg\nICB9CgogICAgcHJpdmF0ZSBPcmRlckRhdGFCZWFuIGNyZWF0ZU9yZGVyKEFj\nY291bnREYXRhQmVhbiBhY2NvdW50LAogICAgICAgICAgICBRdW90ZURhdGFC\nZWFuIHF1b3RlLCBIb2xkaW5nRGF0YUJlYW4gaG9sZGluZywgU3RyaW5nIG9y\nZGVyVHlwZSwKICAgICAgICAgICAgZG91YmxlIHF1YW50aXR5LCBFbnRpdHlN\nYW5hZ2VyIGVudGl0eU1hbmFnZXIpIHsKICAgICAgICBPcmRlckRhdGFCZWFu\nIG9yZGVyOwogICAgICAgIGlmIChnZXRMb2coKS5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgiY3JlYXRlT3JkZXIob3Jk\nZXJJRD0iICsgIiBhY2NvdW50PSIKICAgICAgICAgICAgICAgICsgKChhY2Nv\ndW50ID09IG51bGwpID8gbnVsbCA6IGFjY291bnQuZ2V0QWNjb3VudElEKCkp\nCiAgICAgICAgICAgICAgICArICIgcXVvdGU9IiArICgocXVvdGUgPT0gbnVs\nbCkgPyBudWxsIDogcXVvdGUuZ2V0U3ltYm9sKCkpCiAgICAgICAgICAgICAg\nICArICIgb3JkZXJUeXBlPSIgKyBvcmRlclR5cGUgKyAiIHF1YW50aXR5PSIg\nKyBxdWFudGl0eSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgb3JkZXIg\nPSBuZXcgT3JkZXJEYXRhQmVhbihvcmRlclR5cGUsIAogICAgICAgICAgICAg\nICAgIm9wZW4iLCAKICAgICAgICAgICAgICAgIG5ldyBUaW1lc3RhbXAoU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpLCAKICAgICAgICAgICAgICAgIG51\nbGwsIAogICAgICAgICAgICAgICAgcXVhbnRpdHksIAogICAgICAgICAgICAg\nICAgLy8gcXVvdGUuZ2V0UHJpY2UoKS5zZXRTY2FsZShGaW5hbmNpYWxVdGls\ncy5TQ0FMRSwgRmluYW5jaWFsVXRpbHMuUk9VTkQpLAogICAgICAgICAgICAg\nICAgcXVvdGUuZ2V0UHJpY2UoKS5zZXRTY2FsZSgyLCBCaWdEZWNpbWFsLlJP\nVU5EX0hBTEZfVVApLAogICAgICAgICAgICAgICAgVHJhZGVDb25maWcuZ2V0\nT3JkZXJGZWUob3JkZXJUeXBlKSwgCiAgICAgICAgICAgICAgICBhY2NvdW50\nLCAKICAgICAgICAgICAgICAgIHF1b3RlLCAKICAgICAgICAgICAgICAgIGhv\nbGRpbmcpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLnBlcnNpc3Qob3Jk\nZXIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIGdldExvZygpLmVycm9yKCJjcmVhdGVPcmRlciAtIGZhaWxlZCB0byBj\ncmVhdGUgT3JkZXIiLCBlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRp\nbWVFeGNlcHRpb24oImNyZWF0ZU9yZGVyIC0gZmFpbGVkIHRvIGNyZWF0ZSBP\ncmRlciIsIGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb3JkZXI7CiAg\nICB9CgogICAgcHJpdmF0ZSBPcmRlckRhdGFCZWFuIGNvbXBsZXRlT3JkZXIo\nSW50ZWdlciBvcmRlcklELCBib29sZWFuIHR3b1BoYXNlKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIg\nPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIE9yZGVyRGF0\nYUJlYW4gb3JkZXIgPSBudWxsOwoKICAgICAgICBpZiAoZ2V0TG9nKCkuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgZ2V0TG9nKCkudHJhY2UoImNv\nbXBsZXRlT3JkZXIgLSBvcmRlcklEPSIgKyBvcmRlcklEICsgIiB0d29QaGFz\nZT0iICsgdHdvUGhhc2UpOwoKICAgICAgICBvcmRlciA9IGVudGl0eU1hbmFn\nZXIuZmluZChPcmRlckRhdGFCZWFuLmNsYXNzLCBvcmRlcklEKTsKICAgICAg\nICBhc3NlcnROb3ROdWxsKG9yZGVyKTsKICAgICAgICBvcmRlci5nZXRRdW90\nZSgpOwogICAgICAgIGlmIChvcmRlciA9PSBudWxsKSB7CiAgICAgICAgICAg\nIGdldExvZygpLmVycm9yKCJjb21wbGV0ZU9yZGVyIC0gVW5hYmxlIHRvIGZp\nbmQgT3JkZXIgIiArIG9yZGVySUQgKyAiIEZCUEsgcmV0dXJuZWQgIiArIG9y\nZGVyKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAg\nICAgIGlmIChvcmRlci5pc0NvbXBsZXRlZCgpKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJjb21wbGV0ZU9yZGVyIC0gYXR0\nZW1wdCB0byBjb21wbGV0ZSBPcmRlciB0aGF0IGlzIGFscmVhZHkgY29tcGxl\ndGVkXG4iICsgb3JkZXIpOwogICAgICAgIH0KICAgICAgICBBY2NvdW50RGF0\nYUJlYW4gYWNjb3VudCA9IG9yZGVyLmdldEFjY291bnQoKTsKICAgICAgICBh\nc3NlcnROb3ROdWxsKGFjY291bnQpOwogICAgICAgIFF1b3RlRGF0YUJlYW4g\ncXVvdGUgPSBvcmRlci5nZXRRdW90ZSgpOwogICAgICAgIGFzc2VydE5vdE51\nbGwocXVvdGUpOwogICAgICAgIEhvbGRpbmdEYXRhQmVhbiBob2xkaW5nID0g\nb3JkZXIuZ2V0SG9sZGluZygpOwogICAgICAgIEJpZ0RlY2ltYWwgcHJpY2Ug\nPSBvcmRlci5nZXRQcmljZSgpOwogICAgICAgIGRvdWJsZSBxdWFudGl0eSA9\nIG9yZGVyLmdldFF1YW50aXR5KCk7CgogICAgICAgIFN0cmluZyB1c2VySUQg\nPSBhY2NvdW50LmdldFByb2ZpbGUoKS5nZXRVc2VySUQoKTsKICAgICAgICBh\nc3NlcnROb3ROdWxsKHVzZXJJRCk7CgogICAgICAgIGlmIChnZXRMb2coKS5p\nc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBnZXRMb2coKS50cmFjZSgi\nY29tcGxldGVPcmRlci0tPiBDb21wbGV0aW5nIE9yZGVyICIKICAgICAgICAg\nICAgICAgICAgICAgICsgb3JkZXIuZ2V0T3JkZXJJRCgpICsgIlxuXHQgT3Jk\nZXIgaW5mbzogIiArIG9yZGVyCiAgICAgICAgICAgICAgICAgICAgICArICJc\nblx0IEFjY291bnQgaW5mbzogIiArIGFjY291bnQgKyAiXG5cdCBRdW90ZSBp\nbmZvOiAiCiAgICAgICAgICAgICAgICAgICAgICArIHF1b3RlICsgIlxuXHQg\nSG9sZGluZyBpbmZvOiAiICsgaG9sZGluZyk7CgogICAgICAgIEhvbGRpbmdE\nYXRhQmVhbiBuZXdIb2xkaW5nID0gbnVsbDsKICAgICAgICBpZiAob3JkZXIu\naXNCdXkoKSkgewogICAgICAgICAgICBuZXdIb2xkaW5nID0gY3JlYXRlSG9s\nZGluZyhhY2NvdW50LCBxdW90ZSwgcXVhbnRpdHksIHByaWNlLCBlbnRpdHlN\nYW5hZ2VyKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbChuZXdIb2xkaW5n\nKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZW50aXR5\nTWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAg\nIGlmIChuZXdIb2xkaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIG9y\nZGVyLnNldEhvbGRpbmcobmV3SG9sZGluZyk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKG9yZGVyLmlzU2VsbCgpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaG9sZGluZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nZ2V0TG9nKCkuZXJyb3IoImNvbXBsZXRlT3JkZXIgLSBlcnJvciAiICsgb3Jk\nZXIuZ2V0T3JkZXJJRCgpICsgIiBob2xkaW5nIGFscmVhZHkgc29sZCIpOwog\nICAgICAgICAgICAgICAgICAgIG9yZGVyLmNhbmNlbCgpOwogICAgICAgICAg\nICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5jb21t\naXQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JkZXI7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLnJlbW92ZShob2xkaW5nKTsKICAg\nICAgICAgICAgICAgICAgICBvcmRlci5zZXRIb2xkaW5nKG51bGwpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG9yZGVy\nLnNldE9yZGVyU3RhdHVzKCJjbG9zZWQiKTsKICAgICAgICAgICAgb3JkZXIu\nc2V0Q29tcGxldGlvbkRhdGUobmV3IGphdmEuc3FsLlRpbWVzdGFtcChTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKSkpOwogICAgICAgICAgICBpZiAoZ2V0\nTG9nKCkuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIGdldExv\nZygpLnRyYWNlKCJjb21wbGV0ZU9yZGVyLS0+IENvbXBsZXRlZCBPcmRlciAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyBvcmRlci5nZXRPcmRlcklE\nKCkgKyAiXG5cdCBPcmRlciBpbmZvOiAiICsgb3JkZXIKICAgICAgICAgICAg\nICAgICAgICAgICAgICArICJcblx0IEFjY291bnQgaW5mbzogIiArIGFjY291\nbnQgKyAiXG5cdCBRdW90ZSBpbmZvOiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyBxdW90ZSArICJcblx0IEhvbGRpbmcgaW5mbzogIiArIGhvbGRp\nbmcpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9u\nKCkuY29tbWl0KCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBnZXRMb2coKS5lcnJvcihlKTsKICAgICAg\nICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNr\nKCk7CiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAg\nICAgICAgZW50aXR5TWFuYWdlciA9IG51bGw7CiAgICAgICAgfQogICAgICAg\nIGlmIChlbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgZW50\naXR5TWFuYWdlci5jbG9zZSgpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2Vy\nID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9yZGVyOwogICAg\nfQoKICAgIHByaXZhdGUgSG9sZGluZ0RhdGFCZWFuIGNyZWF0ZUhvbGRpbmco\nQWNjb3VudERhdGFCZWFuIGFjY291bnQsCiAgICAgICAgICAgIFF1b3RlRGF0\nYUJlYW4gcXVvdGUsIGRvdWJsZSBxdWFudGl0eSwgQmlnRGVjaW1hbCBwdXJj\naGFzZVByaWNlLAogICAgICAgICAgICBFbnRpdHlNYW5hZ2VyIGVudGl0eU1h\nbmFnZXIpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBIb2xkaW5nRGF0\nYUJlYW4gbmV3SG9sZGluZyA9IG5ldyBIb2xkaW5nRGF0YUJlYW4ocXVhbnRp\ndHksCiAgICAgICAgICAgIHB1cmNoYXNlUHJpY2UsIG5ldyBUaW1lc3RhbXAo\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpLAogICAgICAgICAgICBhY2Nv\ndW50LCBxdW90ZSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChuZXdIb2xkaW5n\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdl\ndFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgZW50aXR5TWFu\nYWdlci5wZXJzaXN0KG5ld0hvbGRpbmcpOwogICAgICAgICAgICBlbnRpdHlN\nYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZW50aXR5TWFuYWdl\nci5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBuZXdIb2xkaW5nOwogICAgfQoKICAgIHB1YmxpYyBRdW90\nZURhdGFCZWFuIHVwZGF0ZVF1b3RlUHJpY2VWb2x1bWUoU3RyaW5nIHN5bWJv\nbCwgQmlnRGVjaW1hbCBjaGFuZ2VGYWN0b3IsIGRvdWJsZSBzaGFyZXNUcmFk\nZWQpIHsKICAgICAgICBpZiAoIVRyYWRlQ29uZmlnLmdldFVwZGF0ZVF1b3Rl\nUHJpY2VzKCkpCiAgICAgICAgICAgIHJldHVybiBuZXcgUXVvdGVEYXRhQmVh\nbigpOwogICAgICAgIGlmIChnZXRMb2coKS5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBnZXRMb2coKS50cmFjZSgidXBkYXRlUXVvdGUgLSBzeW1i\nb2w9IiArIHN5bWJvbCArICIgY2hhbmdlRmFjdG9yPSIgKyBjaGFuZ2VGYWN0\nb3IpOwoKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIgPSBl\nbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIFF1b3RlRGF0YUJl\nYW4gcXVvdGUgPSBudWxsOwogICAgICAgIGlmIChUcmFkZUNvbmZpZy5qcGFM\nYXllciA9PSBUcmFkZUNvbmZpZy5ISUJFUk5BVEUpIHsKICAgICAgICAgICAg\ncXVvdGUgPSBlbnRpdHlNYW5hZ2VyLmZpbmQoUXVvdGVEYXRhQmVhbi5jbGFz\ncywgc3ltYm9sKTsKICAgICAgICB9IGVsc2UgaWYgKFRyYWRlQ29uZmlnLmpw\nYUxheWVyID09IFRyYWRlQ29uZmlnLk9QRU5KUEEpIHsKICAgICAgICAgICAg\nUXVlcnkgcSA9IGVudGl0eU1hbmFnZXIuY3JlYXRlTmFtZWRRdWVyeSgicXVv\ndGVlamIucXVvdGVGb3JVcGRhdGUiKTsKICAgICAgICAgICAgcS5zZXRQYXJh\nbWV0ZXIoMSwgc3ltYm9sKTsKICAgICAgICAgICAgcXVvdGUgPSAoUXVvdGVE\nYXRhQmVhbikgcS5nZXRTaW5nbGVSZXN1bHQoKTsKICAgICAgICB9CiAgICAg\nICAgQmlnRGVjaW1hbCBvbGRQcmljZSA9IHF1b3RlLmdldFByaWNlKCk7CiAg\nICAgICAgaWYgKHF1b3RlLmdldFByaWNlKCkuZXF1YWxzKFRyYWRlQ29uZmln\nLlBFTk5ZX1NUT0NLX1BSSUNFKSkgewogICAgICAgICAgICBjaGFuZ2VGYWN0\nb3IgPSBUcmFkZUNvbmZpZy5QRU5OWV9TVE9DS19SRUNPVkVSWV9NSVJBQ0xF\nX01VTFRJUExJRVI7CiAgICAgICAgfQogICAgICAgIEJpZ0RlY2ltYWwgbmV3\nUHJpY2UgPSBjaGFuZ2VGYWN0b3IubXVsdGlwbHkob2xkUHJpY2UpLnNldFNj\nYWxlKDIsIEJpZ0RlY2ltYWwuUk9VTkRfSEFMRl9VUCk7CgogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHF1b3RlLnNldFByaWNlKG5ld1ByaWNlKTsKICAg\nICAgICAgICAgcXVvdGUuc2V0Vm9sdW1lKHF1b3RlLmdldFZvbHVtZSgpICsg\nc2hhcmVzVHJhZGVkKTsKICAgICAgICAgICAgcXVvdGUuc2V0Q2hhbmdlKChu\nZXdQcmljZS5zdWJ0cmFjdChxdW90ZS5nZXRPcGVuKCkpLmRvdWJsZVZhbHVl\nKCkpKTsKCiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLm1lcmdl\nKHF1b3RlKTsKICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2Fj\ndGlvbigpLmNvbW1pdCgpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24o\nKS5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChlbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIGVudGl0\neU1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHRoaXMucHVibGlzaFF1b3RlUHJpY2VDaGFuZ2UocXVvdGUsIG9sZFBy\naWNlLCBjaGFuZ2VGYWN0b3IsIHNoYXJlc1RyYWRlZCk7CiAgICAgICAgcmV0\ndXJuIHF1b3RlOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgcHVibGlz\naFF1b3RlUHJpY2VDaGFuZ2UoUXVvdGVEYXRhQmVhbiBxdW90ZSwgQmlnRGVj\naW1hbCBvbGRQcmljZSwgCiAgICAgICAgICAgIEJpZ0RlY2ltYWwgY2hhbmdl\nRmFjdG9yLCBkb3VibGUgc2hhcmVzVHJhZGVkKSB7CiAgICAgICAgaWYgKCFU\ncmFkZUNvbmZpZy5nZXRQdWJsaXNoUXVvdGVQcmljZUNoYW5nZSgpKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgZ2V0TG9nKCkuZXJyb3IoInB1Ymxp\nc2hRdW90ZVByaWNlQ2hhbmdlIC0gaXMgbm90IGltcGxlbWVudGVkIGZvciB0\naGlzIHJ1bnRpbWUgbW9kZSIpOwogICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigicHVibGlzaFF1b3RlUHJpY2VDaGFu\nZ2UgLSBpcyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgcnVudGltZSBtb2Rl\nIik7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

