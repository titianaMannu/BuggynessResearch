{"sha":"f6ddf0ad25b28270f68acd5c50cc032d40eda4c3","node_id":"MDQ6QmxvYjIwNjM2NDpmNmRkZjBhZDI1YjI4MjcwZjY4YWNkNWM1MGNjMDMyZDQwZWRhNGMz","size":40392,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/f6ddf0ad25b28270f68acd5c50cc032d40eda4c3","content":"LyoqCiAqICBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5k\nYXRpb24gKEFTRikgdW5kZXIgb25lIG9yIG1vcmUKICogIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUgZGlz\ndHJpYnV0ZWQgd2l0aAogKiAgdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8gWW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAKICogICh0aGUgIkxpY2Vuc2Ui\nKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxp\nYW5jZSB3aXRoCiAqICB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5h\ncGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqICBVbmxlc3Mg\ncmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdy\naXRpbmcsIHNvZnR3YXJlCiAqICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGlj\nZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiAg\nV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQs\nIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqICBTZWUgdGhlIExpY2Vu\nc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlz\nc2lvbnMgYW5kCiAqICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4K\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5vcGVuanBhLmludGVncmF0aW9uLmRh\neXRyYWRlcjsKCmltcG9ydCBqYXZhLm1hdGguQmlnRGVjaW1hbDsKaW1wb3J0\nIGphdmEuc3FsLlRpbWVzdGFtcDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKCmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5FbnRp\ndHlNYW5hZ2VyOwppbXBvcnQgamF2YXgucGVyc2lzdGVuY2UuRW50aXR5TWFu\nYWdlckZhY3Rvcnk7CmltcG9ydCBqYXZheC5wZXJzaXN0ZW5jZS5QZXJzaXN0\nZW5jZTsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlBlcnNpc3RlbmNlVW5p\ndDsKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLlF1ZXJ5OwoKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKCi8vIGltcG9ydCBvcmcu\nYXBhY2hlLmdlcm9uaW1vLnNhbXBsZXMuZGF5dHJhZGVyLmJlYW5zLkFjY291\nbnREYXRhQmVhbjsKLy8gaW1wb3J0IG9yZy5hcGFjaGUuZ2Vyb25pbW8uc2Ft\ncGxlcy5kYXl0cmFkZXIuYmVhbnMuQWNjb3VudFByb2ZpbGVEYXRhQmVhbjsK\nLy8gaW1wb3J0IG9yZy5hcGFjaGUuZ2Vyb25pbW8uc2FtcGxlcy5kYXl0cmFk\nZXIuYmVhbnMuSG9sZGluZ0RhdGFCZWFuOwovLyBpbXBvcnQgb3JnLmFwYWNo\nZS5nZXJvbmltby5zYW1wbGVzLmRheXRyYWRlci5iZWFucy5PcmRlckRhdGFC\nZWFuOwovLyBpbXBvcnQgb3JnLmFwYWNoZS5nZXJvbmltby5zYW1wbGVzLmRh\neXRyYWRlci5iZWFucy5RdW90ZURhdGFCZWFuOwovLyBpbXBvcnQgb3JnLmFw\nYWNoZS5nZXJvbmltby5zYW1wbGVzLmRheXRyYWRlci5jb3JlLkZpbmFuY2lh\nbFV0aWxzOwovLyBpbXBvcnQgb3JnLmFwYWNoZS5nZXJvbmltby5zYW1wbGVz\nLmRheXRyYWRlci5jb3JlLk1hcmtldFN1bW1hcnlEYXRhQmVhbjsKLy8gaW1w\nb3J0IG9yZy5hcGFjaGUuZ2Vyb25pbW8uc2FtcGxlcy5kYXl0cmFkZXIuY29y\nZS5SdW5TdGF0c0RhdGFCZWFuOwovLyBpbXBvcnQgb3JnLmFwYWNoZS5nZXJv\nbmltby5zYW1wbGVzLmRheXRyYWRlci5jb3JlLlRyYWRlREJTZXJ2aWNlczsK\nLy8gaW1wb3J0IG9yZy5hcGFjaGUuZ2Vyb25pbW8uc2FtcGxlcy5kYXl0cmFk\nZXIuY29yZS5UcmFkZVNlcnZpY2VzOwovLyBpbXBvcnQgb3JnLmFwYWNoZS5n\nZXJvbmltby5zYW1wbGVzLmRheXRyYWRlci51dGlsLkxvZzsKLy8gaW1wb3J0\nIG9yZy5hcGFjaGUuZ2Vyb25pbW8uc2FtcGxlcy5kYXl0cmFkZXIudXRpbC5U\ncmFkZUNvbmZpZzsKCi8qKgogKiBUcmFkZUpQQURpcmVjdCB1c2VzIEpQQSB0\nbyBpbXBsZW1lbnQgdGhlIGJ1c2luZXNzIG1ldGhvZHMgb2YgdGhlIFRyYWRl\nIG9ubGluZQogKiBicm9rZXIgYXBwbGljYXRpb24uIFRoZXNlIGJ1c2luZXNz\nIG1ldGhvZHMgcmVwcmVzZW50IHRoZSBmZWF0dXJlcyBhbmQKICogb3BlcmF0\naW9ucyB0aGF0IGNhbiBiZSBwZXJmb3JtZWQgYnkgY3VzdG9tZXJzIG9mIHRo\nZSBicm9rZXJhZ2Ugc3VjaCBhcyBsb2dpbiwKICogbG9nb3V0LCBnZXQgYSBz\ndG9jayBxdW90ZSwgYnV5IG9yIHNlbGwgYSBzdG9jaywgZXRjLiBhbmQgYXJl\nIHNwZWNpZmllZCBpbiB0aGUKICoge0BsaW5rIG9yZy5hcGFjaGUuZ2Vyb25p\nbW8uc2FtcGxlcy5kYXl0cmFkZXIuVHJhZGVTZXJ2aWNlc30gaW50ZXJmYWNl\nCiAqIAogKiBOb3RlOiBJbiBvcmRlciBmb3IgdGhpcyBjbGFzcyB0byBiZSB0\naHJlYWQtc2FmZSwgYSBuZXcgVHJhZGVKUEEgbXVzdCBiZQogKiBjcmVhdGVk\nIGZvciBlYWNoIGNhbGwgdG8gYSBtZXRob2QgZnJvbSB0aGUgVHJhZGVJbnRl\ncmZhY2UgaW50ZXJmYWNlLgogKiBPdGhlcndpc2UsIHBvb2xlZCBjb25uZWN0\naW9ucyBtYXkgbm90IGJlIHJlbGVhc2VkLgogKiAKICogQHNlZSBvcmcuYXBh\nY2hlLmdlcm9uaW1vLnNhbXBsZXMuZGF5dHJhZGVyLlRyYWRlU2VydmljZXMK\nICogCiAqLwoKLy8gcHVibGljIGNsYXNzIFRyYWRlSlBBRGlyZWN0IGltcGxl\nbWVudHMgVHJhZGVTZXJ2aWNlcywgVHJhZGVEQlNlcnZpY2VzIHsKcHVibGlj\nIGNsYXNzIFRyYWRlSlBBRGlyZWN0IHsKCiAgICBAUGVyc2lzdGVuY2VVbml0\nKHVuaXROYW1lPSJkYXl0cmFkZXIiKQogICAgcHJpdmF0ZSBzdGF0aWMgRW50\naXR5TWFuYWdlckZhY3RvcnkgZW1mOwoKICAgIHByaXZhdGUgc3RhdGljIEJp\nZ0RlY2ltYWwgWkVSTyA9IG5ldyBCaWdEZWNpbWFsKDAuMCk7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiBpbml0aWFsaXplZCA9IGZhbHNlOwoKICAg\nIHByaXZhdGUgc3RhdGljIExvZyBsb2cgPSBudWxsOwogICAgCgogICAgLy8g\nY29uc3RydWN0b3IgZm9yIE9wZW5KUEEganVuaXQgdGVzdHMKICAgIHB1Ymxp\nYyBUcmFkZUpQQURpcmVjdChMb2cgbG9nLCBFbnRpdHlNYW5hZ2VyRmFjdG9y\neSBlbWYpIHsKICAgICAgICB0aGlzLmxvZyA9IGxvZzsKICAgICAgICB0aGlz\nLmVtZiA9IGVtZjsKICAgICAgICBpZiAoaW5pdGlhbGl6ZWQgPT0gZmFsc2Up\nCiAgICAgICAgICAgIGluaXQoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0\nYXRpYyBzeW5jaHJvbml6ZWQgdm9pZCBpbml0KCkgewogICAgICAgIGlmIChp\nbml0aWFsaXplZCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vaWYg\nKExvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgIC8vICAgIExvZy50cmFj\nZSgiVHJhZGVKUEFEaXJlY3Q6aW5pdCAtLSAqKiogaW5pdGlhbGl6aW5nIik7\nCgogICAgICAgIFRyYWRlQ29uZmlnLnNldFB1Ymxpc2hRdW90ZVByaWNlQ2hh\nbmdlKGZhbHNlKTsKCiAgICAgICAgLy9pZiAoTG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgLy8gICAgTG9nLnRyYWNlKCJUcmFkZUpQQURpcmVjdDpp\nbml0IC0tICsrKyBpbml0aWFsaXplZCIpOwoKICAgICAgICBpbml0aWFsaXpl\nZCA9IHRydWU7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyB2b2lkIGRlc3Ry\nb3koKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFpbml0aWFs\naXplZCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgbG9n\nLnRyYWNlKCJUcmFkZUpQQURpcmVjdDpkZXN0cm95Iik7CiAgICAgICAgfQog\nICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2cu\nZXJyb3IoIlRyYWRlSlBBRGlyZWN0OmRlc3Ryb3kiLCBlKTsKICAgICAgICB9\nCgogICAgfQoKICAgIHB1YmxpYyBNYXJrZXRTdW1tYXJ5RGF0YUJlYW4gZ2V0\nTWFya2V0U3VtbWFyeSgpIHsKICAgICAgICBNYXJrZXRTdW1tYXJ5RGF0YUJl\nYW4gbWFya2V0U3VtbWFyeURhdGE7CgogICAgICAgIC8qCiAgICAgICAgICog\nQ3JlYXRpbmcgZW50aU1hbmFnZXIKICAgICAgICAgKi8KICAgICAgICBFbnRp\ndHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIgPSBlbWYuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobG9nLmlz\nVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2UoIlRy\nYWRlSlBBRGlyZWN0OmdldE1hcmtldFN1bW1hcnkgLS0gZ2V0dGluZyBtYXJr\nZXQgc3VtbWFyeSIpOwoKICAgICAgICAgICAgLy8gRmluZCBUcmFkZSBTdG9j\nayBJbmRleCBRdW90ZXMgKFRvcCAxMDAgcXVvdGVzKQogICAgICAgICAgICAv\nLyBvcmRlcmVkIGJ5IHRoZWlyIGNoYW5nZSBpbiB2YWx1ZQogICAgICAgICAg\nICBDb2xsZWN0aW9uPFF1b3RlRGF0YUJlYW4+IHF1b3RlczsKCiAgICAgICAg\nICAgIFF1ZXJ5IHF1ZXJ5ID0gZW50aXR5TWFuYWdlci5jcmVhdGVOYW1lZFF1\nZXJ5KCJxdW90ZWVqYi5xdW90ZXNCeUNoYW5nZSIpOwogICAgICAgICAgICBx\ndW90ZXMgPSBxdWVyeS5nZXRSZXN1bHRMaXN0KCk7CgogICAgICAgICAgICBR\ndW90ZURhdGFCZWFuW10gcXVvdGVBcnJheSA9IChRdW90ZURhdGFCZWFuW10p\nIHF1b3Rlcy50b0FycmF5KG5ldyBRdW90ZURhdGFCZWFuW3F1b3Rlcy5zaXpl\nKCldKTsKICAgICAgICAgICAgQXJyYXlMaXN0PFF1b3RlRGF0YUJlYW4+IHRv\ncEdhaW5lcnMgPSBuZXcgQXJyYXlMaXN0PFF1b3RlRGF0YUJlYW4+KAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICA1KTsKICAgICAgICAgICAg\nQXJyYXlMaXN0PFF1b3RlRGF0YUJlYW4+IHRvcExvc2VycyA9IG5ldyBBcnJh\neUxpc3Q8UXVvdGVEYXRhQmVhbj4oNSk7CiAgICAgICAgICAgIC8vIEJpZ0Rl\nY2ltYWwgVFNJQSA9IEZpbmFuY2lhbFV0aWxzLlpFUk87CiAgICAgICAgICAg\nIEJpZ0RlY2ltYWwgVFNJQSA9IChuZXcgQmlnRGVjaW1hbCgwLjAwKSkuc2V0\nU2NhbGUoMik7CiAgICAgICAgICAgIC8vIEJpZ0RlY2ltYWwgb3BlblRTSUEg\nPSBGaW5hbmNpYWxVdGlscy5aRVJPOwogICAgICAgICAgICBCaWdEZWNpbWFs\nIG9wZW5UU0lBID0gKG5ldyBCaWdEZWNpbWFsKDAuMDApKS5zZXRTY2FsZSgy\nKTsKICAgICAgICAgICAgZG91YmxlIHRvdGFsVm9sdW1lID0gMC4wOwoKICAg\nICAgICAgICAgaWYgKHF1b3RlQXJyYXkubGVuZ3RoID4gNSkgewogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCA1OyBpKyspCiAgICAgICAg\nICAgICAgICAgICAgdG9wR2FpbmVycy5hZGQocXVvdGVBcnJheVtpXSk7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gcXVvdGVBcnJheS5sZW5ndGgg\nLSAxOyBpID49IHF1b3RlQXJyYXkubGVuZ3RoIC0gNTsgaS0tKQogICAgICAg\nICAgICAgICAgICAgIHRvcExvc2Vycy5hZGQocXVvdGVBcnJheVtpXSk7Cgog\nICAgICAgICAgICAgICAgZm9yIChRdW90ZURhdGFCZWFuIHF1b3RlIDogcXVv\ndGVBcnJheSkgewogICAgICAgICAgICAgICAgICAgIEJpZ0RlY2ltYWwgcHJp\nY2UgPSBxdW90ZS5nZXRQcmljZSgpOwogICAgICAgICAgICAgICAgICAgIEJp\nZ0RlY2ltYWwgb3BlbiA9IHF1b3RlLmdldE9wZW4oKTsKICAgICAgICAgICAg\nICAgICAgICBkb3VibGUgdm9sdW1lID0gcXVvdGUuZ2V0Vm9sdW1lKCk7CiAg\nICAgICAgICAgICAgICAgICAgVFNJQSA9IFRTSUEuYWRkKHByaWNlKTsKICAg\nICAgICAgICAgICAgICAgICBvcGVuVFNJQSA9IG9wZW5UU0lBLmFkZChvcGVu\nKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFZvbHVtZSArPSB2b2x1bWU7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBUU0lBID0gVFNJ\nQS5kaXZpZGUobmV3IEJpZ0RlY2ltYWwocXVvdGVBcnJheS5sZW5ndGgpLAog\nICAgICAgICAgICAgICAgICAgIC8vIEZpbmFuY2lhbFV0aWxzLlJPVU5EKTsK\nICAgICAgICAgICAgICAgICAgICBCaWdEZWNpbWFsLlJPVU5EX0hBTEZfVVAp\nOwogICAgICAgICAgICAgICAgb3BlblRTSUEgPSBvcGVuVFNJQS5kaXZpZGUo\nbmV3IEJpZ0RlY2ltYWwocXVvdGVBcnJheS5sZW5ndGgpLAogICAgICAgICAg\nICAgICAgICAgIC8vIEZpbmFuY2lhbFV0aWxzLlJPVU5EKTsKICAgICAgICAg\nICAgICAgICAgICBCaWdEZWNpbWFsLlJPVU5EX0hBTEZfVVApOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBtYXJrZXRTdW1tYXJ5RGF0YSA9IG5ldyBN\nYXJrZXRTdW1tYXJ5RGF0YUJlYW4oVFNJQSwgb3BlblRTSUEsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0b3RhbFZvbHVtZSwgdG9wR2FpbmVycywgdG9wTG9zZXJzKTsKICAg\nICAgICB9CiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIGxvZy5lcnJvcigiVHJhZGVKUEFEaXJlY3Q6Z2V0TWFya2V0U3VtbWFy\neSIsIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlv\nbigiVHJhZGVKUEFEaXJlY3Q6Z2V0TWFya2V0U3VtbWFyeSAtLSBlcnJvciAi\nLCBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbnRpdHlN\nYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWFy\na2V0U3VtbWFyeURhdGE7CiAgICB9CgogICAgcHVibGljIE9yZGVyRGF0YUJl\nYW4gYnV5KFN0cmluZyB1c2VySUQsIFN0cmluZyBzeW1ib2wsIGRvdWJsZSBx\ndWFudGl0eSwgaW50IG9yZGVyUHJvY2Vzc2luZ01vZGUpIHsKICAgICAgICBP\ncmRlckRhdGFCZWFuIG9yZGVyID0gbnVsbDsKICAgICAgICBCaWdEZWNpbWFs\nIHRvdGFsOwogICAgICAgIC8qCiAgICAgICAgICogY3JlYXRpbmcgZW50aXR5\nbWFuYWdlcgogICAgICAgICAqLwogICAgICAgIEVudGl0eU1hbmFnZXIgZW50\naXR5TWFuYWdlciA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiVHJhZGVKUEFEaXJlY3Q6\nYnV5IC0gdXNlcklEPSIgKyB1c2VySUQgKyAiIHN5bWJvbD0iICsgc3ltYm9s\nICsgIiBxdWFudGl0eT0iICsgcXVhbnRpdHkpOwoKICAgICAgICAgICAgZW50\naXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CgogICAgICAg\nICAgICBBY2NvdW50UHJvZmlsZURhdGFCZWFuIHByb2ZpbGUgPSBlbnRpdHlN\nYW5hZ2VyLmZpbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjY291bnRQcm9maWxl\nRGF0YUJlYW4uY2xhc3MsIHVzZXJJRCk7CiAgICAgICAgICAgIEFjY291bnRE\nYXRhQmVhbiBhY2NvdW50ID0gcHJvZmlsZS5nZXRBY2NvdW50KCk7CgogICAg\nICAgICAgICBRdW90ZURhdGFCZWFuIHF1b3RlID0gZW50aXR5TWFuYWdlci5m\naW5kKFF1b3RlRGF0YUJlYW4uY2xhc3MsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sKTsKCiAg\nICAgICAgICAgIEhvbGRpbmdEYXRhQmVhbiBob2xkaW5nID0gbnVsbDsgLy8g\nVGhlIGhvbGRpbmcgd2lsbCBiZSBjcmVhdGVkIGJ5IHRoaXMgYnV5IG9yZGVy\nCgogICAgICAgICAgICBvcmRlciA9IGNyZWF0ZU9yZGVyKGFjY291bnQsIHF1\nb3RlLCBob2xkaW5nLCAiYnV5IiwgcXVhbnRpdHksIGVudGl0eU1hbmFnZXIp\nOwoKICAgICAgICAgICAgLy8gb3JkZXIgPSBjcmVhdGVPcmRlcihhY2NvdW50\nLCBxdW90ZSwgaG9sZGluZywgImJ1eSIsIHF1YW50aXR5KTsKICAgICAgICAg\nICAgLy8gVVBEQVRFIC0gYWNjb3VudCBzaG91bGQgYmUgY3JlZGl0ZWQgZHVy\naW5nIGNvbXBsZXRlT3JkZXIKCiAgICAgICAgICAgIEJpZ0RlY2ltYWwgcHJp\nY2UgPSBxdW90ZS5nZXRQcmljZSgpOwogICAgICAgICAgICBCaWdEZWNpbWFs\nIG9yZGVyRmVlID0gb3JkZXIuZ2V0T3JkZXJGZWUoKTsKICAgICAgICAgICAg\nQmlnRGVjaW1hbCBiYWxhbmNlID0gYWNjb3VudC5nZXRCYWxhbmNlKCk7CiAg\nICAgICAgICAgIHRvdGFsID0gKG5ldyBCaWdEZWNpbWFsKHF1YW50aXR5KS5t\ndWx0aXBseShwcmljZSkpLmFkZChvcmRlckZlZSk7CiAgICAgICAgICAgIGFj\nY291bnQuc2V0QmFsYW5jZShiYWxhbmNlLnN1YnRyYWN0KHRvdGFsKSk7Cgog\nICAgICAgICAgICAvLyBjb21taXQgdGhlIHRyYW5zYWN0aW9uIGJlZm9yZSBj\nYWxsaW5nIGNvbXBsZXRlT3JkZXIKICAgICAgICAgICAgZW50aXR5TWFuYWdl\nci5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwoKICAgICAgICAgICAgaWYg\nKG9yZGVyUHJvY2Vzc2luZ01vZGUgPT0gVHJhZGVDb25maWcuU1lOQ0gpCiAg\nICAgICAgICAgICAgICBjb21wbGV0ZU9yZGVyKG9yZGVyLmdldE9yZGVySUQo\nKSwgZmFsc2UpOwogICAgICAgICAgICBlbHNlIGlmIChvcmRlclByb2Nlc3Np\nbmdNb2RlID09IFRyYWRlQ29uZmlnLkFTWU5DSF8yUEhBU0UpCiAgICAgICAg\nICAgICAgICBxdWV1ZU9yZGVyKG9yZGVyLmdldE9yZGVySUQoKSwgdHJ1ZSk7\nCiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBsb2cuZXJyb3IoIlRyYWRlSlBBRGlyZWN0OmJ1eSgiICsgdXNl\ncklEICsgIiwiICsgc3ltYm9sICsgIiwiICsgcXVhbnRpdHkgKyAiKSAtLT4g\nZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIC8qIE9uIGV4Y2VwdGlvbiAtIGNh\nbmNlbCB0aGUgb3JkZXIgKi8KICAgICAgICAgICAgLy8gVE9ETyBmaWd1cmUg\nb3V0IGhvdyB0byBkbyB0aGlzIHdpdGggSlBBCiAgICAgICAgICAgIGlmIChv\ncmRlciAhPSBudWxsKQogICAgICAgICAgICAgICAgb3JkZXIuY2FuY2VsKCk7\nCgogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCku\ncm9sbGJhY2soKTsKCiAgICAgICAgICAgIC8vIHRocm93IG5ldyBFSkJFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0\naW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChl\nbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGVudGl0\neU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIGVudGl0eU1hbmFn\nZXIgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAg\nLy8gYWZ0ZXIgdGhlIHB1cmNoYXNlIG9yIHNlbGwgb2YgYSBzdG9jaywgdXBk\nYXRlIHRoZSBzdG9ja3Mgdm9sdW1lIGFuZAogICAgICAgIC8vIHByaWNlCiAg\nICAgICAgdXBkYXRlUXVvdGVQcmljZVZvbHVtZShzeW1ib2wsIFRyYWRlQ29u\nZmlnLmdldFJhbmRvbVByaWNlQ2hhbmdlRmFjdG9yKCksIHF1YW50aXR5KTsK\nCiAgICAgICAgcmV0dXJuIG9yZGVyOwogICAgfQoKICAgIHB1YmxpYyBPcmRl\nckRhdGFCZWFuIHNlbGwoU3RyaW5nIHVzZXJJRCwgSW50ZWdlciBob2xkaW5n\nSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBvcmRlclBy\nb2Nlc3NpbmdNb2RlKSB7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbnRpdHlN\nYW5hZ2VyID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKCiAgICAgICAg\nT3JkZXJEYXRhQmVhbiBvcmRlciA9IG51bGw7CiAgICAgICAgQmlnRGVjaW1h\nbCB0b3RhbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBlbnRpdHlNYW5h\nZ2VyLmdldFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nLnRy\nYWNlKCJUcmFkZUpQQURpcmVjdDpzZWxsIC0gdXNlcklEPSIgKyB1c2VySUQg\nKyAiIGhvbGRpbmc9IiArIGhvbGRpbmdJRCk7CgogICAgICAgICAgICBBY2Nv\ndW50UHJvZmlsZURhdGFCZWFuIHByb2ZpbGUgPSBlbnRpdHlNYW5hZ2VyLmZp\nbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIEFjY291bnRQcm9maWxlRGF0YUJlYW4u\nY2xhc3MsIHVzZXJJRCk7CgogICAgICAgICAgICBBY2NvdW50RGF0YUJlYW4g\nYWNjb3VudCA9IHByb2ZpbGUuZ2V0QWNjb3VudCgpOwogICAgICAgICAgICBI\nb2xkaW5nRGF0YUJlYW4gaG9sZGluZyA9IGVudGl0eU1hbmFnZXIuZmluZChI\nb2xkaW5nRGF0YUJlYW4uY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvbGRpbmdJRCk7\nCgogICAgICAgICAgICBpZiAoaG9sZGluZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBsb2cuZXJyb3IoIlRyYWRlSlBBRGlyZWN0OnNlbGwgVXNlciAi\nICsgdXNlcklECiAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGF0dGVt\ncHRlZCB0byBzZWxsIGhvbGRpbmcgIiArIGhvbGRpbmdJRAogICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiB3aGljaCBoYXMgYWxyZWFkeSBiZWVuIHNv\nbGQiKTsKCiAgICAgICAgICAgICAgICBPcmRlckRhdGFCZWFuIG9yZGVyRGF0\nYSA9IG5ldyBPcmRlckRhdGFCZWFuKCk7CiAgICAgICAgICAgICAgICBvcmRl\nckRhdGEuc2V0T3JkZXJTdGF0dXMoImNhbmNlbGxlZCIpOwoKICAgICAgICAg\nICAgICAgIGVudGl0eU1hbmFnZXIucGVyc2lzdChvcmRlckRhdGEpOwogICAg\nICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmNv\nbW1pdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIG9yZGVyRGF0YTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgUXVvdGVEYXRhQmVhbiBxdW90ZSA9\nIGhvbGRpbmcuZ2V0UXVvdGUoKTsKICAgICAgICAgICAgZG91YmxlIHF1YW50\naXR5ID0gaG9sZGluZy5nZXRRdWFudGl0eSgpOwoKICAgICAgICAgICAgb3Jk\nZXIgPSBjcmVhdGVPcmRlcihhY2NvdW50LCBxdW90ZSwgaG9sZGluZywgInNl\nbGwiLCBxdWFudGl0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBlbnRpdHlNYW5hZ2VyKTsKICAgICAgICAgICAgLy8gVVBEQVRFIHRoZSBo\nb2xkaW5nIHB1cmNoYXNlIGRhdGEgdG8gc2lnbmlmeSB0aGlzIGhvbGRpbmcg\naXMKICAgICAgICAgICAgLy8gImluZmxpZ2h0IiB0byBiZSBzb2xkCiAgICAg\nICAgICAgIC8vIC0tIGNvdWxkIGFkZCBhIG5ldyBob2xkaW5nU3RhdHVzIGF0\ndHJpYnV0ZSB0byBob2xkaW5nRUpCCiAgICAgICAgICAgIGhvbGRpbmcuc2V0\nUHVyY2hhc2VEYXRlKG5ldyBqYXZhLnNxbC5UaW1lc3RhbXAoMCkpOwoKICAg\nICAgICAgICAgLy8gVVBEQVRFIC0gYWNjb3VudCBzaG91bGQgYmUgY3JlZGl0\nZWQgZHVyaW5nIGNvbXBsZXRlT3JkZXIKICAgICAgICAgICAgQmlnRGVjaW1h\nbCBwcmljZSA9IHF1b3RlLmdldFByaWNlKCk7CiAgICAgICAgICAgIEJpZ0Rl\nY2ltYWwgb3JkZXJGZWUgPSBvcmRlci5nZXRPcmRlckZlZSgpOwogICAgICAg\nICAgICBCaWdEZWNpbWFsIGJhbGFuY2UgPSBhY2NvdW50LmdldEJhbGFuY2Uo\nKTsKICAgICAgICAgICAgdG90YWwgPSAobmV3IEJpZ0RlY2ltYWwocXVhbnRp\ndHkpLm11bHRpcGx5KHByaWNlKSkuc3VidHJhY3Qob3JkZXJGZWUpOwoKICAg\nICAgICAgICAgYWNjb3VudC5zZXRCYWxhbmNlKGJhbGFuY2UuYWRkKHRvdGFs\nKSk7CgogICAgICAgICAgICAvLyBjb21taXQgdGhlIHRyYW5zYWN0aW9uIGJl\nZm9yZSBjYWxsaW5nIGNvbXBsZXRlT3JkZXIKICAgICAgICAgICAgZW50aXR5\nTWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwoKICAgICAgICAg\nICAgaWYgKG9yZGVyUHJvY2Vzc2luZ01vZGUgPT0gVHJhZGVDb25maWcuU1lO\nQ0gpCiAgICAgICAgICAgICAgICBjb21wbGV0ZU9yZGVyKG9yZGVyLmdldE9y\nZGVySUQoKSwgZmFsc2UpOwogICAgICAgICAgICBlbHNlIGlmIChvcmRlclBy\nb2Nlc3NpbmdNb2RlID09IFRyYWRlQ29uZmlnLkFTWU5DSF8yUEhBU0UpCiAg\nICAgICAgICAgICAgICBxdWV1ZU9yZGVyKG9yZGVyLmdldE9yZGVySUQoKSwg\ndHJ1ZSk7CgogICAgICAgIH0KICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgbG9nLmVycm9yKCJUcmFkZUpQQURpcmVjdDpzZWxs\nKCIgKyB1c2VySUQgKyAiLCIgKyBob2xkaW5nSUQgKyAiKSAtLT4gZmFpbGVk\nIiwgZSk7CiAgICAgICAgICAgIC8vIFRPRE8gZmlndXJlIG91dCBKUEEgY2Fu\nY2VsCiAgICAgICAgICAgIGlmIChvcmRlciAhPSBudWxsKQogICAgICAgICAg\nICAgICAgb3JkZXIuY2FuY2VsKCk7CgogICAgICAgICAgICBlbnRpdHlNYW5h\nZ2VyLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKCiAgICAgICAgICAg\nIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJUcmFkZUpQQURpcmVjdDpz\nZWxsKCIgKyB1c2VySUQgKyAiLCIgKyBob2xkaW5nSUQgKyAiKSIsIGUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChlbnRpdHlNYW5h\nZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGVudGl0eU1hbmFnZXIu\nY2xvc2UoKTsKICAgICAgICAgICAgICAgIGVudGl0eU1hbmFnZXIgPSBudWxs\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIShvcmRl\nci5nZXRPcmRlclN0YXR1cygpLmVxdWFsc0lnbm9yZUNhc2UoImNhbmNlbGxl\nZCIpKSkKICAgICAgICAgICAgLy9hZnRlciB0aGUgcHVyY2hhc2Ugb3Igc2Vs\nbCBvZiBhIHN0b2NrLCB1cGRhdGUgdGhlIHN0b2NrcyB2b2x1bWUgYW5kIHBy\naWNlCiAgICAgICAgICAgIHVwZGF0ZVF1b3RlUHJpY2VWb2x1bWUob3JkZXIu\nZ2V0U3ltYm9sKCksIFRyYWRlQ29uZmlnLmdldFJhbmRvbVByaWNlQ2hhbmdl\nRmFjdG9yKCksIG9yZGVyLmdldFF1YW50aXR5KCkpOwoKICAgICAgICByZXR1\ncm4gb3JkZXI7CiAgICB9CgogICAgcHVibGljIHZvaWQgcXVldWVPcmRlcihJ\nbnRlZ2VyIG9yZGVySUQsIGJvb2xlYW4gdHdvUGhhc2UpIHsKICAgICAgICBs\nb2cKICAgICAgICAuZXJyb3IoIlRyYWRlSlBBRGlyZWN0OnF1ZXVlT3JkZXIo\nKSBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgcnVudGltZSBtb2RlIik7CiAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJUcmFkZUpQQURpcmVjdDpxdWV1ZU9yZGVyKCkgbm90IGltcGxlbWVu\ndGVkIGZvciB0aGlzIHJ1bnRpbWUgbW9kZSIpOwogICAgfQoKICAgIHB1Ymxp\nYyBPcmRlckRhdGFCZWFuIGNvbXBsZXRlT3JkZXIoSW50ZWdlciBvcmRlcklE\nLCBib29sZWFuIHR3b1BoYXNlKQogICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgRW50aXR5TWFuYWdlciBlbnRpdHlNYW5hZ2VyID0gZW1mLmNyZWF0\nZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBPcmRlckRhdGFCZWFuIG9yZGVy\nID0gbnVsbDsKCiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBsb2cudHJhY2UoIlRyYWRlSlBBRGlyZWN0OmNvbXBsZXRl\nT3JkZXIgLSBvcmRlcklkPSIgKyBvcmRlcklEICsgIiB0d29QaGFzZT0iICsg\ndHdvUGhhc2UpOwoKICAgICAgICBvcmRlciA9IGVudGl0eU1hbmFnZXIuZmlu\nZChPcmRlckRhdGFCZWFuLmNsYXNzLCBvcmRlcklEKTsKICAgICAgICBvcmRl\nci5nZXRRdW90ZSgpOwoKICAgICAgICBpZiAob3JkZXIgPT0gbnVsbCkgewog\nICAgICAgICAgICBsb2cuZXJyb3IoIlRyYWRlSlBBRGlyZWN0OmNvbXBsZXRl\nT3JkZXIgLS0gVW5hYmxlIHRvIGZpbmQgT3JkZXIgIiArIG9yZGVySUQgKyAi\nIEZCUEsgcmV0dXJuZWQgIiArIG9yZGVyKTsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAob3JkZXIuaXNDb21wbGV0\nZWQoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlv\nbigiRXJyb3I6IGF0dGVtcHQgdG8gY29tcGxldGUgT3JkZXIgdGhhdCBpcyBh\nbHJlYWR5IGNvbXBsZXRlZFxuIiArIG9yZGVyKTsKICAgICAgICB9CgogICAg\nICAgIEFjY291bnREYXRhQmVhbiBhY2NvdW50ID0gb3JkZXIuZ2V0QWNjb3Vu\ndCgpOwogICAgICAgIFF1b3RlRGF0YUJlYW4gcXVvdGUgPSBvcmRlci5nZXRR\ndW90ZSgpOwogICAgICAgIEhvbGRpbmdEYXRhQmVhbiBob2xkaW5nID0gb3Jk\nZXIuZ2V0SG9sZGluZygpOwogICAgICAgIEJpZ0RlY2ltYWwgcHJpY2UgPSBv\ncmRlci5nZXRQcmljZSgpOwogICAgICAgIGRvdWJsZSBxdWFudGl0eSA9IG9y\nZGVyLmdldFF1YW50aXR5KCk7CgogICAgICAgIFN0cmluZyB1c2VySUQgPSBh\nY2NvdW50LmdldFByb2ZpbGUoKS5nZXRVc2VySUQoKTsKCiAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uo\nIlRyYWRlSlBBRGlyZWN0OmNvbXBsZXRlT3JkZXItLT4gQ29tcGxldGluZyBP\ncmRlciAiCiAgICAgICAgICAgICAgICAgICAgICArIG9yZGVyLmdldE9yZGVy\nSUQoKSArICJcblx0IE9yZGVyIGluZm86ICIgKyBvcmRlcgogICAgICAgICAg\nICAgICAgICAgICAgKyAiXG5cdCBBY2NvdW50IGluZm86ICIgKyBhY2NvdW50\nICsgIlxuXHQgUXVvdGUgaW5mbzogIgogICAgICAgICAgICAgICAgICAgICAg\nKyBxdW90ZSArICJcblx0IEhvbGRpbmcgaW5mbzogIiArIGhvbGRpbmcpOwoK\nICAgICAgICBIb2xkaW5nRGF0YUJlYW4gbmV3SG9sZGluZyA9IG51bGw7CiAg\nICAgICAgaWYgKG9yZGVyLmlzQnV5KCkpIHsKICAgICAgICAgICAgLyoKICAg\nICAgICAgICAgICogQ29tcGxldGUgYSBCdXkgb3BlcmF0aW9uIC0gY3JlYXRl\nIGEgbmV3IEhvbGRpbmcgZm9yIHRoZSBBY2NvdW50IC0KICAgICAgICAgICAg\nICogZGVkdWN0IHRoZSBPcmRlciBjb3N0IGZyb20gdGhlIEFjY291bnQgYmFs\nYW5jZQogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIG5ld0hvbGRpbmcg\nPSBjcmVhdGVIb2xkaW5nKGFjY291bnQsIHF1b3RlLCBxdWFudGl0eSwgcHJp\nY2UsIGVudGl0eU1hbmFnZXIpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJl\nZ2luKCk7CgogICAgICAgICAgICBpZiAobmV3SG9sZGluZyAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBvcmRlci5zZXRIb2xkaW5nKG5ld0hvbGRpbmcp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3JkZXIuaXNTZWxs\nKCkpIHsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBD\nb21wbGV0ZSBhIFNlbGwgb3BlcmF0aW9uIC0gcmVtb3ZlIHRoZSBIb2xkaW5n\nIGZyb20gdGhlIEFjY291bnQgLQogICAgICAgICAgICAgICAgICogZGVwb3Np\ndCB0aGUgT3JkZXIgcHJvY2VlZHMgdG8gdGhlIEFjY291bnQgYmFsYW5jZQog\nICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBpZiAoaG9sZGlu\nZyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKCJU\ncmFkZUpQQURpcmVjdDpjb21wbGV0ZU9yZGVyIC0tIFVuYWJsZSB0byBzZWxs\nIG9yZGVyICIgKyBvcmRlci5nZXRPcmRlcklEKCkgKyAiIGhvbGRpbmcgYWxy\nZWFkeSBzb2xkIik7CiAgICAgICAgICAgICAgICAgICAgb3JkZXIuY2FuY2Vs\nKCk7CiAgICAgICAgICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFu\nc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBvcmRlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIGVudGl0eU1hbmFnZXIucmVtb3Zl\nKGhvbGRpbmcpOwogICAgICAgICAgICAgICAgICAgIG9yZGVyLnNldEhvbGRp\nbmcobnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIG9yZGVyLnNldE9yZGVyU3RhdHVzKCJjbG9zZWQiKTsKCiAg\nICAgICAgICAgIG9yZGVyLnNldENvbXBsZXRpb25EYXRlKG5ldyBqYXZhLnNx\nbC5UaW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpKTsKCiAg\nICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgIGxvZy50cmFjZSgiVHJhZGVKUEFEaXJlY3Q6Y29tcGxldGVPcmRl\nci0tPiBDb21wbGV0ZWQgT3JkZXIgIgogICAgICAgICAgICAgICAgICAgICAg\nICAgICsgb3JkZXIuZ2V0T3JkZXJJRCgpICsgIlxuXHQgT3JkZXIgaW5mbzog\nIiArIG9yZGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiXG5cdCBB\nY2NvdW50IGluZm86ICIgKyBhY2NvdW50ICsgIlxuXHQgUXVvdGUgaW5mbzog\nIgogICAgICAgICAgICAgICAgICAgICAgICAgICsgcXVvdGUgKyAiXG5cdCBI\nb2xkaW5nIGluZm86ICIgKyBob2xkaW5nKTsKCiAgICAgICAgICAgIGVudGl0\neU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICB9\nCiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGUu\ncHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIu\nZ2V0VHJhbnNhY3Rpb24oKS5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChlbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAg\nICAgICAgICAgIGVudGl0eU1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JkZXI7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgY2FuY2VsT3JkZXIoSW50ZWdlciBvcmRlcklELCBib29s\nZWFuIHR3b1BoYXNlKSB7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbnRpdHlN\nYW5hZ2VyID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKCiAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJh\nY2UoIlRyYWRlSlBBRGlyZWN0OmNhbmNlbE9yZGVyIC0gb3JkZXJJZD0iICsg\nb3JkZXJJRCArICIgdHdvUGhhc2U9IiArIHR3b1BoYXNlKTsKCiAgICAgICAg\nT3JkZXJEYXRhQmVhbiBvcmRlciA9IGVudGl0eU1hbmFnZXIuZmluZChPcmRl\nckRhdGFCZWFuLmNsYXNzLCBvcmRlcklEKTsKICAgICAgICAvKgogICAgICAg\nICAqIG1hbmFnZWQgdHJhbnNhY3Rpb24KICAgICAgICAgKi8KICAgICAgICB0\ncnkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9u\nKCkuYmVnaW4oKTsKICAgICAgICAgICAgb3JkZXIuY2FuY2VsKCk7CiAgICAg\nICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQo\nKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5yb2xs\nYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVudGl0\neU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgb3JkZXJDb21wbGV0ZWQoU3RyaW5nIHVzZXJJRCwgSW50ZWdlciBv\ncmRlcklEKSB7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBsb2cudHJhY2UoIlRyYWRlQWN0aW9uOm9yZGVyQ29tcGxl\ndGVkIC0gdXNlcklEPSIgKyB1c2VySUQgKyAiIG9yZGVySUQ9IiArIG9yZGVy\nSUQpOwogICAgfQoKICAgIHB1YmxpYyBDb2xsZWN0aW9uPE9yZGVyRGF0YUJl\nYW4+IGdldE9yZGVycyhTdHJpbmcgdXNlcklEKSB7CiAgICAgICAgaWYgKGxv\nZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2UoIlRy\nYWRlSlBBRGlyZWN0OmdldE9yZGVycyAtIHVzZXJJRD0iICsgdXNlcklEKTsK\nICAgICAgICBFbnRpdHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIgPSBlbWYuY3Jl\nYXRlRW50aXR5TWFuYWdlcigpOwogICAgICAgIEFjY291bnRQcm9maWxlRGF0\nYUJlYW4gcHJvZmlsZSA9IGVudGl0eU1hbmFnZXIuZmluZCgKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBBY2NvdW50UHJvZmlsZURhdGFCZWFuLmNsYXNzLCB1c2VySUQpOwog\nICAgICAgIEFjY291bnREYXRhQmVhbiBhY2NvdW50ID0gcHJvZmlsZS5nZXRB\nY2NvdW50KCk7CiAgICAgICAgZW50aXR5TWFuYWdlci5jbG9zZSgpOwogICAg\nICAgIHJldHVybiBhY2NvdW50LmdldE9yZGVycygpOwogICAgfQoKICAgIHB1\nYmxpYyBDb2xsZWN0aW9uPE9yZGVyRGF0YUJlYW4+IGdldENsb3NlZE9yZGVy\ncyhTdHJpbmcgdXNlcklEKSB7CgogICAgICAgIGlmIChsb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRyYWNlKCJUcmFkZUpQQURpcmVj\ndDpnZXRDbG9zZWRPcmRlcnMgLSB1c2VySUQ9IiArIHVzZXJJRCk7CiAgICAg\nICAgRW50aXR5TWFuYWdlciBlbnRpdHlNYW5hZ2VyID0gZW1mLmNyZWF0ZUVu\ndGl0eU1hbmFnZXIoKTsKCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIC8v\nIEdldCB0aGUgcHJpbWFyeSBrZXlzIGZvciBhbGwgdGhlIGNsb3NlZCBPcmRl\ncnMgZm9yIHRoaXMKICAgICAgICAgICAgLy8gYWNjb3VudC4KICAgICAgICAg\nICAgLyoKICAgICAgICAgICAgICogbWFuYWdlZCB0cmFuc2FjdGlvbgogICAg\nICAgICAgICAgKi8KICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFu\nc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIFF1ZXJ5IHF1ZXJ5ID0g\nZW50aXR5TWFuYWdlcgogICAgICAgICAgICAgICAgICAgICAgICAgIC5jcmVh\ndGVOYW1lZFF1ZXJ5KCJvcmRlcmVqYi5jbG9zZWRPcmRlcnMiKTsKICAgICAg\nICAgICAgcXVlcnkuc2V0UGFyYW1ldGVyKCJ1c2VySUQiLCB1c2VySUQpOwoK\nICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmNv\nbW1pdCgpOwogICAgICAgICAgICBDb2xsZWN0aW9uIHJlc3VsdHMgPSBxdWVy\neS5nZXRSZXN1bHRMaXN0KCk7CiAgICAgICAgICAgIEl0ZXJhdG9yIGl0ciA9\nIHJlc3VsdHMuaXRlcmF0b3IoKTsKICAgICAgICAgICAgLy8gZW50aXR5TWFu\nYWdlci5qb2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgLy8gU3BpbiB0\naHJvdWdoIHRoZSBvcmRlcnMgdG8gcG9wdWxhdGUgdGhlIGxhenkgcXVvdGUg\nZmllbGRzCiAgICAgICAgICAgIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAg\nICAgICAgICAgICAgICBPcmRlckRhdGFCZWFuIHRoaXNPcmRlciA9IChPcmRl\nckRhdGFCZWFuKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgdGhpc09y\nZGVyLmdldFF1b3RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlm\nIChUcmFkZUNvbmZpZy5qcGFMYXllciA9PSBUcmFkZUNvbmZpZy5PUEVOSlBB\nKSB7CiAgICAgICAgICAgICAgICBRdWVyeSB1cGRhdGVTdGF0dXMgPSBlbnRp\ndHlNYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAuY3JlYXRlTmFtZWRRdWVyeSgib3JkZXJlamIuY29tcGxldGVDbG9zZWRP\ncmRlcnMiKTsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAg\nKiBtYW5hZ2VkIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAgICAgKi8KICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZW50aXR5\nTWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAg\nICAgICAgICAgdXBkYXRlU3RhdHVzLnNldFBhcmFtZXRlcigidXNlcklEIiwg\ndXNlcklEKTsKCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdHVzLmV4\nZWN1dGVVcGRhdGUoKTsKICAgICAgICAgICAgICAgICAgICBlbnRpdHlNYW5h\nZ2VyLmdldFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9u\nKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICBlbnRpdHlNYW5h\nZ2VyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgZW50aXR5TWFuYWdl\nciA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZWxzZSBpZiAoVHJhZGVDb25maWcuanBhTGF5ZXIgPT0gVHJh\nZGVDb25maWcuSElCRVJOQVRFKSB7CiAgICAgICAgICAgICAgICAvKgogICAg\nICAgICAgICAgICAgICogQWRkIGxvZ2ljIHRvIGRvIHVwZGF0ZSBvcmRlcnMg\nb3BlcmF0aW9uLCBiZWNhdXNlIEpCb3NzNScKICAgICAgICAgICAgICAgICAq\nIEhpYmVybmF0ZSAzLjMuMUdBIERCMkRpYWxlY3QgYW5kIE15U1FMNURpYWxl\nY3QgZG8gbm90IHdvcmsKICAgICAgICAgICAgICAgICAqIHdpdGggYW5ub3Rh\ndGVkIHF1ZXJ5ICJvcmRlcmVqYi5jb21wbGV0ZUNsb3NlZE9yZGVycyIgZGVm\naW5lZAogICAgICAgICAgICAgICAgICogaW4gT3JkZXJEYXRhYmVhbgogICAg\nICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBRdWVyeSBmaW5kYWNj\nb3VudGlkID0gZW50aXR5TWFuYWdlcgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC5jcmVhdGVOYXRpdmVRdWVyeSgKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAic2VsZWN0ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArICJhLkFDQ09VTlRJRCwgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgImEuTE9HSU5DT1VOVCwgIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgImEuTE9H\nT1VUQ09VTlQsICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArICJhLkxBU1RMT0dJTiwgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgImEuQ1JFQVRJT05EQVRFLCAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiYS5C\nQUxBTkNFLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiYS5PUEVOQkFMQU5DRSwgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgImEuUFJPRklMRV9VU0VSSUQgIgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgImZy\nb20gYWNjb3VudGVqYiBhIHdoZXJlIGEucHJvZmlsZV91c2VyaWQgPSA/IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBvcmcuYXBhY2hlLmdlcm9uaW1vLnNhbXBsZXMuZGF5\ndHJhZGVyLmJlYW5zLkFjY291bnREYXRhQmVhbi5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5vcGVuanBhLmludGVncmF0aW9uLmRheXRyYWRlci5B\nY2NvdW50RGF0YUJlYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgZmluZGFj\nY291bnRpZC5zZXRQYXJhbWV0ZXIoMSwgdXNlcklEKTsKICAgICAgICAgICAg\nICAgIEFjY291bnREYXRhQmVhbiBhY2NvdW50ID0gKEFjY291bnREYXRhQmVh\nbikgZmluZGFjY291bnRpZC5nZXRTaW5nbGVSZXN1bHQoKTsKICAgICAgICAg\nICAgICAgIEludGVnZXIgYWNjb3VudGlkID0gYWNjb3VudC5nZXRBY2NvdW50\nSUQoKTsKICAgICAgICAgICAgICAgIFF1ZXJ5IHVwZGF0ZVN0YXR1cyA9IGVu\ndGl0eU1hbmFnZXIuY3JlYXRlTmF0aXZlUXVlcnkoIlVQREFURSBvcmRlcmVq\nYiBvIFNFVCBvLm9yZGVyU3RhdHVzID0gJ2NvbXBsZXRlZCcgV0hFUkUgIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArICJvLm9yZGVyU3RhdHVzID0gJ2Ns\nb3NlZCcgQU5EIG8uQUNDT1VOVF9BQ0NPVU5USUQgID0gPyIpOwogICAgICAg\nICAgICAgICAgdXBkYXRlU3RhdHVzLnNldFBhcmFtZXRlcigxLCBhY2NvdW50\naWQuaW50VmFsdWUoKSk7CiAgICAgICAgICAgICAgICB1cGRhdGVTdGF0dXMu\nZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChlbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGVu\ndGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIGVudGl0eU1h\nbmFnZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiByZXN1bHRzOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIGxvZy5lcnJvcigiVHJhZGVKUEFEaXJlY3QuZ2V0Q2xvc2Vk\nT3JkZXJzIiwgZSk7CiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuY2xvc2Uo\nKTsKICAgICAgICAgICAgZW50aXR5TWFuYWdlciA9IG51bGw7CiAgICAgICAg\nICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJUcmFkZUpQQURpcmVj\ndC5nZXRDbG9zZWRPcmRlcnMgLSBlcnJvciIsIGUpOwoKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAoZW50aXR5TWFuYWdlciAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICBlbnRpdHlNYW5hZ2VyID0gbnVsbDsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgUXVvdGVEYXRhQmVh\nbiBjcmVhdGVRdW90ZShTdHJpbmcgc3ltYm9sLCBTdHJpbmcgY29tcGFueU5h\nbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCaWdE\nZWNpbWFsIHByaWNlKSB7CiAgICAgICAgRW50aXR5TWFuYWdlciBlbnRpdHlN\nYW5hZ2VyID0gZW1mLmNyZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBRdW90ZURhdGFCZWFuIHF1b3RlID0gbmV3IFF1\nb3RlRGF0YUJlYW4oc3ltYm9sLCBjb21wYW55TmFtZSwgMCwgcHJpY2UsIHBy\naWNlLCBwcmljZSwgcHJpY2UsIDApOwogICAgICAgICAgICAvKgogICAgICAg\nICAgICAgKiBtYW5hZ2VkIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAqLwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdl\ndFRyYW5zYWN0aW9uKCkuYmVnaW4oKTsKICAgICAgICAgICAgZW50aXR5TWFu\nYWdlci5wZXJzaXN0KHF1b3RlKTsKICAgICAgICAgICAgZW50aXR5TWFuYWdl\nci5nZXRUcmFuc2FjdGlvbigpLmNvbW1pdCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLnJvbGxiYWNrKCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVu\nYWJsZWQoKSkKICAgICAgICAgICAgICAgIGxvZy50cmFjZSgiVHJhZGVKUEFE\naXJlY3Q6Y3JlYXRlUXVvdGUtLT4iICsgcXVvdGUpOwoKICAgICAgICAgICAg\naWYgKGVudGl0eU1hbmFnZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nZW50aXR5TWFuYWdlci5jbG9zZSgpOwogICAgICAgICAgICAgICAgZW50aXR5\nTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHF1b3RlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIGxvZy5lcnJvcigiVHJhZGVKUEFEaXJlY3Q6Y3JlYXRlUXVv\ndGUgLS0gZXhjZXB0aW9uIGNyZWF0aW5nIFF1b3RlIiwgZSk7CiAgICAgICAg\nICAgIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICAgICAgZW50aXR5\nTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1l\nRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChlbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIGVudGl0\neU1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nIH0KCiAgICBwdWJsaWMgUXVvdGVEYXRhQmVhbiBnZXRRdW90ZShTdHJpbmcg\nc3ltYm9sKSB7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQog\nICAgICAgICAgICBsb2cudHJhY2UoIlRyYWRlSlBBRGlyZWN0OmdldFF1b3Rl\nIC0gc3ltYm9sPSIgKyBzeW1ib2wpOwogICAgICAgIEVudGl0eU1hbmFnZXIg\nZW50aXR5TWFuYWdlciA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7Cgog\nICAgICAgIFF1b3RlRGF0YUJlYW4gcWRiID0gZW50aXR5TWFuYWdlci5maW5k\nKFF1b3RlRGF0YUJlYW4uY2xhc3MsIHN5bWJvbCk7CgogICAgICAgIGlmIChl\nbnRpdHlNYW5hZ2VyICE9IG51bGwpIHsKICAgICAgICAgICAgZW50aXR5TWFu\nYWdlci5jbG9zZSgpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyID0gbnVs\nbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHFkYjsKICAgIH0KCiAgICBw\ndWJsaWMgQ29sbGVjdGlvbjxRdW90ZURhdGFCZWFuPiBnZXRBbGxRdW90ZXMo\nKSB7CiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBsb2cudHJhY2UoIlRyYWRlSlBBRGlyZWN0OmdldEFsbFF1b3RlcyIp\nOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW50aXR5TWFuYWdlciA9IGVtZi5j\ncmVhdGVFbnRpdHlNYW5hZ2VyKCk7CgogICAgICAgIFF1ZXJ5IHF1ZXJ5ID0g\nZW50aXR5TWFuYWdlci5jcmVhdGVOYW1lZFF1ZXJ5KCJxdW90ZWVqYi5hbGxR\ndW90ZXMiKTsKCiAgICAgICAgaWYgKGVudGl0eU1hbmFnZXIgIT0gbnVsbCkg\newogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAg\nICAgIGVudGl0eU1hbmFnZXIgPSBudWxsOwoKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHF1ZXJ5LmdldFJlc3VsdExpc3QoKTsKICAgIH0KCiAgICBwdWJs\naWMgUXVvdGVEYXRhQmVhbiB1cGRhdGVRdW90ZVByaWNlVm9sdW1lKFN0cmlu\nZyBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEJpZ0RlY2ltYWwgY2hhbmdlRmFjdG9yLCBkb3VibGUg\nc2hhcmVzVHJhZGVkKSB7CiAgICAgICAgaWYgKCFUcmFkZUNvbmZpZy5nZXRV\ncGRhdGVRdW90ZVByaWNlcygpKQogICAgICAgICAgICByZXR1cm4gbmV3IFF1\nb3RlRGF0YUJlYW4oKTsKCiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxl\nZCgpKQogICAgICAgICAgICBsb2cudHJhY2UoIlRyYWRlSlBBRGlyZWN0OnVw\nZGF0ZVF1b3RlIC0gc3ltYm9sPSIgKyBzeW1ib2wgKyAiY2hhbmdlRmFjdG9y\nPSIgKyBjaGFuZ2VGYWN0b3IpOwoKICAgICAgICAvKgogICAgICAgICAqIEFk\nZCBsb2dpYyB0byBkZXRlcm1pbmUgSlBBIGxheWVyLCBiZWNhdXNlIEpCb3Nz\nNScgSGliZXJuYXRlIDMuMy4xR0EKICAgICAgICAgKiBEQjJEaWFsZWN0IGFu\nZCBNeVNRTDVEaWFsZWN0IGRvIG5vdCB3b3JrIHdpdGggYW5ub3RhdGVkIHF1\nZXJ5CiAgICAgICAgICogInF1b3RlZWpiLnF1b3RlRm9yVXBkYXRlIiBkZWZp\nbmVkIGluIFF1b3RlRGF0YWJlYW4KICAgICAgICAgKi8KICAgICAgICBFbnRp\ndHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIgPSBlbWYuY3JlYXRlRW50aXR5TWFu\nYWdlcigpOwogICAgICAgIFF1b3RlRGF0YUJlYW4gcXVvdGUgPSBudWxsOwog\nICAgICAgIGlmIChUcmFkZUNvbmZpZy5qcGFMYXllciA9PSBUcmFkZUNvbmZp\nZy5ISUJFUk5BVEUpIHsKICAgICAgICAgICAgcXVvdGUgPSBlbnRpdHlNYW5h\nZ2VyLmZpbmQoUXVvdGVEYXRhQmVhbi5jbGFzcywgc3ltYm9sKTsKICAgICAg\nICB9IGVsc2UgaWYgKFRyYWRlQ29uZmlnLmpwYUxheWVyID09IFRyYWRlQ29u\nZmlnLk9QRU5KUEEpIHsKICAKICAgICAgICAgICAgUXVlcnkgcSA9IGVudGl0\neU1hbmFnZXIuY3JlYXRlTmFtZWRRdWVyeSgicXVvdGVlamIucXVvdGVGb3JV\ncGRhdGUiKTsKICAgICAgICAgICAgcS5zZXRQYXJhbWV0ZXIoMSwgc3ltYm9s\nKTsKICAKICAgICAgICAgICAgcXVvdGUgPSAoUXVvdGVEYXRhQmVhbikgcS5n\nZXRTaW5nbGVSZXN1bHQoKTsKICAgICAgICB9CgogICAgICAgIEJpZ0RlY2lt\nYWwgb2xkUHJpY2UgPSBxdW90ZS5nZXRQcmljZSgpOwoKICAgICAgICBpZiAo\ncXVvdGUuZ2V0UHJpY2UoKS5lcXVhbHMoVHJhZGVDb25maWcuUEVOTllfU1RP\nQ0tfUFJJQ0UpKSB7CiAgICAgICAgICAgIGNoYW5nZUZhY3RvciA9IFRyYWRl\nQ29uZmlnLlBFTk5ZX1NUT0NLX1JFQ09WRVJZX01JUkFDTEVfTVVMVElQTElF\nUjsKICAgICAgICB9CgogICAgICAgIEJpZ0RlY2ltYWwgbmV3UHJpY2UgPSBj\naGFuZ2VGYWN0b3IubXVsdGlwbHkob2xkUHJpY2UpLnNldFNjYWxlKDIsIEJp\nZ0RlY2ltYWwuUk9VTkRfSEFMRl9VUCk7CgogICAgICAgIC8qCiAgICAgICAg\nICogbWFuYWdlZCB0cmFuc2FjdGlvbgogICAgICAgICAqLwoKICAgICAgICB0\ncnkgewoKICAgICAgICAgICAgcXVvdGUuc2V0UHJpY2UobmV3UHJpY2UpOwog\nICAgICAgICAgICBxdW90ZS5zZXRWb2x1bWUocXVvdGUuZ2V0Vm9sdW1lKCkg\nKyBzaGFyZXNUcmFkZWQpOwogICAgICAgICAgICBxdW90ZS5zZXRDaGFuZ2Uo\nKG5ld1ByaWNlLnN1YnRyYWN0KHF1b3RlLmdldE9wZW4oKSkuZG91YmxlVmFs\ndWUoKSkpOwoKICAgICAgICAgICAgZW50aXR5TWFuYWdlci5nZXRUcmFuc2Fj\ndGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIubWVy\nZ2UocXVvdGUpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5z\nYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRy\nYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBpZiAoZW50aXR5TWFuYWdlciAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICBlbnRpdHlNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgdGhpcy5wdWJsaXNoUXVvdGVQcmljZUNoYW5nZShx\ndW90ZSwgb2xkUHJpY2UsIGNoYW5nZUZhY3Rvciwgc2hhcmVzVHJhZGVkKTsK\nCiAgICAgICAgcmV0dXJuIHF1b3RlOwogICAgfQoKICAgIHB1YmxpYyBDb2xs\nZWN0aW9uPEhvbGRpbmdEYXRhQmVhbj4gZ2V0SG9sZGluZ3MoU3RyaW5nIHVz\nZXJJRCkgewogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAg\nICAgICAgICAgbG9nLnRyYWNlKCJUcmFkZUpQQURpcmVjdDpnZXRIb2xkaW5n\ncyAtIHVzZXJJRD0iICsgdXNlcklEKTsKICAgICAgICBFbnRpdHlNYW5hZ2Vy\nIGVudGl0eU1hbmFnZXIgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwog\nICAgICAgIC8qCiAgICAgICAgICogbWFuYWdlZCB0cmFuc2FjdGlvbgogICAg\nICAgICAqLwogICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24o\nKS5iZWdpbigpOwoKICAgICAgICBRdWVyeSBxdWVyeSA9IGVudGl0eU1hbmFn\nZXIuY3JlYXRlTmFtZWRRdWVyeSgiaG9sZGluZ2VqYi5ob2xkaW5nc0J5VXNl\ncklEIik7CiAgICAgICAgcXVlcnkuc2V0UGFyYW1ldGVyKCJ1c2VySUQiLCB1\nc2VySUQpOwoKICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9u\nKCkuY29tbWl0KCk7CiAgICAgICAgQ29sbGVjdGlvbjxIb2xkaW5nRGF0YUJl\nYW4+IGhvbGRpbmdzID0gcXVlcnkuZ2V0UmVzdWx0TGlzdCgpOwogICAgICAg\nIC8qCiAgICAgICAgICogSW5mbGF0ZSB0aGUgbGF6eSBkYXRhIG1lbWViZXJz\nCiAgICAgICAgICovCiAgICAgICAgSXRlcmF0b3IgaXRyID0gaG9sZGluZ3Mu\naXRlcmF0b3IoKTsKICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewog\nICAgICAgICAgICAoKEhvbGRpbmdEYXRhQmVhbikgaXRyLm5leHQoKSkuZ2V0\nUXVvdGUoKTsKICAgICAgICB9CgogICAgICAgIGVudGl0eU1hbmFnZXIuY2xv\nc2UoKTsKICAgICAgICBlbnRpdHlNYW5hZ2VyID0gbnVsbDsKICAgICAgICBy\nZXR1cm4gaG9sZGluZ3M7CiAgICB9CgogICAgcHVibGljIEhvbGRpbmdEYXRh\nQmVhbiBnZXRIb2xkaW5nKEludGVnZXIgaG9sZGluZ0lEKSB7CiAgICAgICAg\naWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJh\nY2UoIlRyYWRlSlBBRGlyZWN0OmdldEhvbGRpbmcgLSBob2xkaW5nSUQ9IiAr\nIGhvbGRpbmdJRCk7CiAgICAgICAgSG9sZGluZ0RhdGFCZWFuIGhvbGRpbmc7\nCiAgICAgICAgRW50aXR5TWFuYWdlciBlbnRpdHlNYW5hZ2VyID0gZW1mLmNy\nZWF0ZUVudGl0eU1hbmFnZXIoKTsKICAgICAgICBob2xkaW5nID0gZW50aXR5\nTWFuYWdlci5maW5kKEhvbGRpbmdEYXRhQmVhbi5jbGFzcywgaG9sZGluZ0lE\nKTsKICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgcmV0\ndXJuIGhvbGRpbmc7CiAgICB9CgogICAgcHVibGljIEFjY291bnREYXRhQmVh\nbiBnZXRBY2NvdW50RGF0YShTdHJpbmcgdXNlcklEKSB7CiAgICAgICAgaWYg\nKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2Uo\nIlRyYWRlSlBBRGlyZWN0OmdldEFjY291bnREYXRhIC0gdXNlcklEPSIgKyB1\nc2VySUQpOwoKICAgICAgICBFbnRpdHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIg\nPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwoKICAgICAgICBBY2NvdW50\nUHJvZmlsZURhdGFCZWFuIHByb2ZpbGUgPSBlbnRpdHlNYW5hZ2VyLmZpbmQo\nQWNjb3VudFByb2ZpbGVEYXRhQmVhbi5jbGFzcywgdXNlcklEKTsKICAgICAg\nICAvKgogICAgICAgICAqIEluZmxhdGUgdGhlIGxhenkgZGF0YSBtZW1lYmVy\ncwogICAgICAgICAqLwogICAgICAgIEFjY291bnREYXRhQmVhbiBhY2NvdW50\nID0gcHJvZmlsZS5nZXRBY2NvdW50KCk7CiAgICAgICAgYWNjb3VudC5nZXRQ\ncm9maWxlKCk7CgogICAgICAgIC8vIEFkZGVkIHRvIHBvcHVsYXRlIHRyYW5z\naWVudCBmaWVsZCBmb3IgYWNjb3VudAogICAgICAgIGFjY291bnQuc2V0UHJv\nZmlsZUlEKHByb2ZpbGUuZ2V0VXNlcklEKCkpOwogICAgICAgIGVudGl0eU1h\nbmFnZXIuY2xvc2UoKTsKICAgICAgICBlbnRpdHlNYW5hZ2VyID0gbnVsbDsK\nCiAgICAgICAgcmV0dXJuIGFjY291bnQ7CiAgICB9CgogICAgcHVibGljIEFj\nY291bnRQcm9maWxlRGF0YUJlYW4gZ2V0QWNjb3VudFByb2ZpbGVEYXRhKFN0\ncmluZyB1c2VySUQpIHsKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgIGxvZy50cmFjZSgiVHJhZGVKUEFEaXJlY3Q6Z2V0\nUHJvZmlsZURhdGEgLSB1c2VySUQ9IiArIHVzZXJJRCk7CiAgICAgICAgRW50\naXR5TWFuYWdlciBlbnRpdHlNYW5hZ2VyID0gZW1mLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKCiAgICAgICAgQWNjb3VudFByb2ZpbGVEYXRhQmVhbiBhcGIg\nPSBlbnRpdHlNYW5hZ2VyLmZpbmQoQWNjb3VudFByb2ZpbGVEYXRhQmVhbi5j\nbGFzcywgdXNlcklEKTsKICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7\nCiAgICAgICAgZW50aXR5TWFuYWdlciA9IG51bGw7CiAgICAgICAgcmV0dXJu\nIGFwYjsKICAgIH0KCiAgICBwdWJsaWMgQWNjb3VudFByb2ZpbGVEYXRhQmVh\nbiB1cGRhdGVBY2NvdW50UHJvZmlsZShBY2NvdW50UHJvZmlsZURhdGFCZWFu\nIHByb2ZpbGVEYXRhKSB7CgogICAgICAgIEVudGl0eU1hbmFnZXIgZW50aXR5\nTWFuYWdlciA9IGVtZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CgogICAgICAg\nIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgbG9nLnRy\nYWNlKCJUcmFkZUpQQURpcmVjdDp1cGRhdGVBY2NvdW50UHJvZmlsZURhdGEg\nLSBwcm9maWxlRGF0YT0iICsgcHJvZmlsZURhdGEpOwogICAgICAgIC8qCiAg\nICAgICAgICogLy8gUmV0cmlldmUgdGhlIHByZXZpb3VzIGFjY291bnQgcHJv\nZmlsZSBpbiBvcmRlciB0byBnZXQgYWNjb3VudAogICAgICAgICAqIGRhdGEu\nLi4gaG9vayBpdCBpbnRvIG5ldyBvYmplY3QgQWNjb3VudFByb2ZpbGVEYXRh\nQmVhbiB0ZW1wID0KICAgICAgICAgKiBlbnRpdHlNYW5hZ2VyLmZpbmQoQWNj\nb3VudFByb2ZpbGVEYXRhQmVhbi5jbGFzcywKICAgICAgICAgKiBwcm9maWxl\nRGF0YS5nZXRVc2VySUQoKSk7IC8vIEluIG9yZGVyIGZvciB0aGUgb2JqZWN0\nIHRvIG1lcmdlCiAgICAgICAgICogY29ycmVjdGx5LCB0aGUgYWNjb3VudCBo\nYXMgdG8gYmUgaG9va2VkIGludG8gdGhlIHRlbXAgb2JqZWN0Li4uIC8vIC0K\nICAgICAgICAgKiBtYXkgbmVlZCB0byByZXZlcnNlIHRoaXMgYW5kIG9idGFp\nbiB0aGUgZnVsbCBvYmplY3QgZmlyc3QKICAgICAgICAgKiAKICAgICAgICAg\nKiBwcm9maWxlRGF0YS5zZXRBY2NvdW50KHRlbXAuZ2V0QWNjb3VudCgpKTsK\nICAgICAgICAgKiAKICAgICAgICAgKiAvL1RPRE8gdGhpcyBtaWdodCBub3Qg\nYmUgY29ycmVjdCB0ZW1wID0KICAgICAgICAgKiBlbnRpdHlNYW5hZ2VyLm1l\ncmdlKHByb2ZpbGVEYXRhKTsgLy9TeXN0ZW0ub3V0LnByaW50bG4odGVtcCk7\nCiAgICAgICAgICovCgogICAgICAgIEFjY291bnRQcm9maWxlRGF0YUJlYW4g\ndGVtcCA9IGVudGl0eU1hbmFnZXIuZmluZChBY2NvdW50UHJvZmlsZURhdGFC\nZWFuLmNsYXNzLCBwcm9maWxlRGF0YS5nZXRVc2VySUQoKSk7CiAgICAgICAg\ndGVtcC5zZXRBZGRyZXNzKHByb2ZpbGVEYXRhLmdldEFkZHJlc3MoKSk7CiAg\nICAgICAgdGVtcC5zZXRQYXNzd29yZChwcm9maWxlRGF0YS5nZXRQYXNzd29y\nZCgpKTsKICAgICAgICB0ZW1wLnNldEZ1bGxOYW1lKHByb2ZpbGVEYXRhLmdl\ndEZ1bGxOYW1lKCkpOwogICAgICAgIHRlbXAuc2V0Q3JlZGl0Q2FyZChwcm9m\naWxlRGF0YS5nZXRDcmVkaXRDYXJkKCkpOwogICAgICAgIHRlbXAuc2V0RW1h\naWwocHJvZmlsZURhdGEuZ2V0RW1haWwoKSk7CiAgICAgICAgLyoKICAgICAg\nICAgKiBNYW5hZ2VkIFRyYW5zYWN0aW9uCiAgICAgICAgICovCiAgICAgICAg\ndHJ5IHsKCiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rp\nb24oKS5iZWdpbigpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLm1lcmdl\nKHRlbXApOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0\naW9uKCkuY29tbWl0KCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5z\nYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgfQoKICAg\nICAgICByZXR1cm4gdGVtcDsKICAgIH0KCiAgICBwdWJsaWMgQWNjb3VudERh\ndGFCZWFuIGxvZ2luKFN0cmluZyB1c2VySUQsIFN0cmluZyBwYXNzd29yZCkK\nICAgIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBFbnRpdHlNYW5hZ2Vy\nIGVudGl0eU1hbmFnZXIgPSBlbWYuY3JlYXRlRW50aXR5TWFuYWdlcigpOwoK\nICAgICAgICBBY2NvdW50UHJvZmlsZURhdGFCZWFuIHByb2ZpbGUgPSBlbnRp\ndHlNYW5hZ2VyLmZpbmQoQWNjb3VudFByb2ZpbGVEYXRhQmVhbi5jbGFzcywg\ndXNlcklEKTsKCiAgICAgICAgaWYgKHByb2ZpbGUgPT0gbnVsbCkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbigiTm8gc3VjaCB1\nc2VyOiAiICsgdXNlcklEKTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAg\nICAgKiBNYW5hZ2VkIFRyYW5zYWN0aW9uCiAgICAgICAgICovCiAgICAgICAg\nZW50aXR5TWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAg\nICAgZW50aXR5TWFuYWdlci5tZXJnZShwcm9maWxlKTsKCiAgICAgICAgQWNj\nb3VudERhdGFCZWFuIGFjY291bnQgPSBwcm9maWxlLmdldEFjY291bnQoKTsK\nCiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAgICAg\nICBsb2cudHJhY2UoIlRyYWRlSlBBRGlyZWN0OmxvZ2luIC0gdXNlcklEPSIg\nKyB1c2VySUQgKyAiIHBhc3N3b3JkPSIgKyBwYXNzd29yZCk7CgogICAgICAg\nIGFjY291bnQubG9naW4ocGFzc3dvcmQpOwogICAgICAgIGVudGl0eU1hbmFn\nZXIuZ2V0VHJhbnNhY3Rpb24oKS5jb21taXQoKTsKICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50cmFjZSgiVHJh\nZGVKUEFEaXJlY3Q6bG9naW4oIiArIHVzZXJJRCArICIsIiArIHBhc3N3b3Jk\nICsgIikgc3VjY2VzcyIgKyBhY2NvdW50KTsKICAgICAgICBlbnRpdHlNYW5h\nZ2VyLmNsb3NlKCk7CiAgICAgICAgcmV0dXJuIGFjY291bnQ7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgbG9nb3V0KFN0cmluZyB1c2VySUQpIHsKICAgICAg\nICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZy50\ncmFjZSgiVHJhZGVKUEFEaXJlY3Q6bG9nb3V0IC0gdXNlcklEPSIgKyB1c2Vy\nSUQpOwogICAgICAgIEVudGl0eU1hbmFnZXIgZW50aXR5TWFuYWdlciA9IGVt\nZi5jcmVhdGVFbnRpdHlNYW5hZ2VyKCk7CgogICAgICAgIEFjY291bnRQcm9m\naWxlRGF0YUJlYW4gcHJvZmlsZSA9IGVudGl0eU1hbmFnZXIuZmluZChBY2Nv\ndW50UHJvZmlsZURhdGFCZWFuLmNsYXNzLCB1c2VySUQpOwogICAgICAgIEFj\nY291bnREYXRhQmVhbiBhY2NvdW50ID0gcHJvZmlsZS5nZXRBY2NvdW50KCk7\nCgogICAgICAgIC8qCiAgICAgICAgICogTWFuYWdlZCBUcmFuc2FjdGlvbgog\nICAgICAgICAqLwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVudGl0eU1h\nbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAgICAgICAgICBh\nY2NvdW50LmxvZ291dCgpOwogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdl\ndFRyYW5zYWN0aW9uKCkuY29tbWl0KCk7CiAgICAgICAgfQogICAgICAgIGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2Vy\nLmdldFRyYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmNsb3NlKCk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgIGxvZy50cmFjZSgiVHJhZGVKUEFEaXJlY3Q6bG9nb3V0KCIgKyB1\nc2VySUQgKyAiKSBzdWNjZXNzIik7CiAgICB9CgogICAgcHVibGljIEFjY291\nbnREYXRhQmVhbiByZWdpc3RlcihTdHJpbmcgdXNlcklELCBTdHJpbmcgcGFz\nc3dvcmQsIFN0cmluZyBmdWxsbmFtZSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFN0cmluZyBhZGRyZXNzLCBTdHJpbmcgZW1haWws\nIFN0cmluZyBjcmVkaXRjYXJkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBCaWdEZWNpbWFsIG9wZW5CYWxhbmNlKSB7CiAgICAgICAg\nQWNjb3VudERhdGFCZWFuIGFjY291bnQgPSBudWxsOwogICAgICAgIEFjY291\nbnRQcm9maWxlRGF0YUJlYW4gcHJvZmlsZSA9IG51bGw7CiAgICAgICAgRW50\naXR5TWFuYWdlciBlbnRpdHlNYW5hZ2VyID0gZW1mLmNyZWF0ZUVudGl0eU1h\nbmFnZXIoKTsKCiAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKSB7\nCiAgICAgICAgICAgIC8vIExvZy50cmFjZSgiVHJhZGVKUEFEaXJlY3Q6cmVn\naXN0ZXIiLCB1c2VySUQsIHBhc3N3b3JkLCBmdWxsbmFtZSwgYWRkcmVzcywg\nZW1haWwsIGNyZWRpdGNhcmQsIG9wZW5CYWxhbmNlKTsKICAgICAgICAgICAg\nbG9nLnRyYWNlKCJUcmFkZUpQQURpcmVjdDpyZWdpc3RlciAtIHVzZXJJRD0i\nICsgdXNlcklEKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ2hl\nY2sgdG8gc2VlIGlmIGEgcHJvZmlsZSB3aXRoIHRoZSBkZXNpcmVkIHVzZXJJ\nRCBhbHJlYWR5IGV4aXN0cwoKICAgICAgICBwcm9maWxlID0gZW50aXR5TWFu\nYWdlci5maW5kKEFjY291bnRQcm9maWxlRGF0YUJlYW4uY2xhc3MsIHVzZXJJ\nRCk7CgogICAgICAgIGlmIChwcm9maWxlICE9IG51bGwpIHsKICAgICAgICAg\nICAgbG9nLmVycm9yKCJGYWlsZWQgdG8gcmVnaXN0ZXIgbmV3IEFjY291bnQg\nLSBBY2NvdW50UHJvZmlsZSB3aXRoIHVzZXJJRCgiICsgdXNlcklEICsgIikg\nYWxyZWFkeSBleGlzdHMiKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgIAlwcm9maWxlID0gbmV3\nIEFjY291bnRQcm9maWxlRGF0YUJlYW4odXNlcklELCBwYXNzd29yZCwgZnVs\nbG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBhZGRyZXNzLCBlbWFpbCwgY3JlZGl0Y2FyZCk7CiAgICAg\nICAgICAgIGFjY291bnQgPSBuZXcgQWNjb3VudERhdGFCZWFuKDAsIDAsIG51\nbGwsIG5ldyBUaW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkp\nLCBvcGVuQmFsYW5jZSwgb3BlbkJhbGFuY2UsIHVzZXJJRCk7CiAgICAgICAg\nICAgIHByb2ZpbGUuc2V0QWNjb3VudChhY2NvdW50KTsKICAgICAgICAgICAg\nYWNjb3VudC5zZXRQcm9maWxlKHByb2ZpbGUpOwogICAgICAgICAgICAvKgog\nICAgICAgICAgICAgKiBtYW5hZ2VkIFRyYW5zYWN0aW9uCiAgICAgICAgICAg\nICAqLwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZW50aXR5\nTWFuYWdlci5nZXRUcmFuc2FjdGlvbigpLmJlZ2luKCk7CiAgICAgICAgICAg\nICAgICBlbnRpdHlNYW5hZ2VyLnBlcnNpc3QocHJvZmlsZSk7CiAgICAgICAg\nICAgICAgICBlbnRpdHlNYW5hZ2VyLnBlcnNpc3QoYWNjb3VudCk7CiAgICAg\nICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRyYW5zYWN0aW9uKCkuY29t\nbWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICBlbnRpdHlNYW5hZ2VyLmdldFRy\nYW5zYWN0aW9uKCkucm9sbGJhY2soKTsKICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuY2xvc2UoKTsKICAg\nICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIHJldHVybiBhY2NvdW50\nOwogICAgfQoKICAgIC8vIEBUcmFuc2FjdGlvbkF0dHJpYnV0ZShUcmFuc2Fj\ndGlvbkF0dHJpYnV0ZVR5cGUuTk9UX1NVUFBPUlRFRCkKICAgIC8vcHVibGlj\nIFJ1blN0YXRzRGF0YUJlYW4gcmVzZXRUcmFkZShib29sZWFuIGRlbGV0ZUFs\nbCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICBwdWJsaWMgdm9pZCByZXNldFRy\nYWRlKGJvb2xlYW4gZGVsZXRlQWxsKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAvLyByZXR1cm4obmV3IFRyYWRlSkRCQ0RpcmVjdChmYWxzZSkpLnJl\nc2V0VHJhZGUoZGVsZXRlQWxsKTsKICAgICAgICBuZXcgUnVudGltZUV4Y2Vw\ndGlvbigiVHJhZGVKUEFEaXJlY3Q6cmVzZXRUcmFkZSAtIG5vdCBpbXBsZW1l\nbnRlZCBpbiBKUEEgbW9kZSIpOwogICAgfQoKICAgIC8qCiAgICAgKiBOTyBM\nT05HRVIgVVNFCiAgICAgKi8KCiAgICBwcml2YXRlIHZvaWQgcHVibGlzaFF1\nb3RlUHJpY2VDaGFuZ2UoUXVvdGVEYXRhQmVhbiBxdW90ZSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCaWdEZWNpbWFsIG9s\nZFByaWNlLCBCaWdEZWNpbWFsIGNoYW5nZUZhY3RvciwgZG91YmxlIHNoYXJl\nc1RyYWRlZCkgewogICAgICAgIGlmICghVHJhZGVDb25maWcuZ2V0UHVibGlz\naFF1b3RlUHJpY2VDaGFuZ2UoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGxvZy5lcnJvcigiVHJhZGVKUEFEaXJlY3Q6cHVibGlzaFF1b3RlUHJp\nY2VDaGFuZ2UgLSBpcyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgcnVudGlt\nZSBtb2RlIik7CiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0\naW9uRXhjZXB0aW9uKCJUcmFkZUpQQURpcmVjdDpwdWJsaXNoUXVvdGVQcmlj\nZUNoYW5nZSAtIGlzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBydW50aW1l\nIG1vZGUiKTsKICAgIH0KCiAgICAvKgogICAgICogbmV3IE1ldGhvZCgpIHRo\nYXQgdGFrZXMgRW50aXR5TWFuYWdlciBhcyBhIHBhcmFtZXRlcgogICAgICov\nCiAgICBwcml2YXRlIE9yZGVyRGF0YUJlYW4gY3JlYXRlT3JkZXIoQWNjb3Vu\ndERhdGFCZWFuIGFjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgUXVvdGVEYXRhQmVhbiBxdW90ZSwgSG9sZGluZ0RhdGFC\nZWFuIGhvbGRpbmcsIFN0cmluZyBvcmRlclR5cGUsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZG91YmxlIHF1YW50aXR5LCBFbnRp\ndHlNYW5hZ2VyIGVudGl0eU1hbmFnZXIpIHsKICAgICAgICBPcmRlckRhdGFC\nZWFuIG9yZGVyOwogICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkK\nICAgICAgICAgICAgbG9nLnRyYWNlKCJUcmFkZUpQQURpcmVjdDpjcmVhdGVP\ncmRlcihvcmRlcklEPSIgKyAiIGFjY291bnQ9IgogICAgICAgICAgICAgICAg\nICAgICAgKyAoKGFjY291bnQgPT0gbnVsbCkgPyBudWxsIDogYWNjb3VudC5n\nZXRBY2NvdW50SUQoKSkKICAgICAgICAgICAgICAgICAgICAgICsgIiBxdW90\nZT0iICsgKChxdW90ZSA9PSBudWxsKSA/IG51bGwgOiBxdW90ZS5nZXRTeW1i\nb2woKSkKICAgICAgICAgICAgICAgICAgICAgICsgIiBvcmRlclR5cGU9IiAr\nIG9yZGVyVHlwZSArICIgcXVhbnRpdHk9IiArIHF1YW50aXR5KTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBvcmRlciA9IG5ldyBPcmRlckRhdGFCZWFu\nKG9yZGVyVHlwZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIm9wZW4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBuZXcgVGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbnVsbCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncXVhbnRpdHksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHF1b3RlLmdldFByaWNlKCkuc2V0U2NhbGUoRmluYW5jaWFsVXRp\nbHMuU0NBTEUsIEZpbmFuY2lhbFV0aWxzLlJPVU5EKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBxdW90ZS5nZXRQcmljZSgpLnNl\ndFNjYWxlKDIsIEJpZ0RlY2ltYWwuUk9VTkRfSEFMRl9VUCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJhZGVDb25maWcuZ2V0\nT3JkZXJGZWUob3JkZXJUeXBlKSwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYWNjb3VudCwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcXVvdGUsIAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGhvbGRpbmcpOwogICAgICAgICAgICAgICAg\nZW50aXR5TWFuYWdlci5wZXJzaXN0KG9yZGVyKTsKICAgICAgICB9CiAgICAg\nICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGxvZy5lcnJv\ncigiVHJhZGVKUEFEaXJlY3Q6Y3JlYXRlT3JkZXIgLS0gZmFpbGVkIHRvIGNy\nZWF0ZSBPcmRlciIsIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgUnVudGlt\nZUV4Y2VwdGlvbigiVHJhZGVKUEFEaXJlY3Q6Y3JlYXRlT3JkZXIgLS0gZmFp\nbGVkIHRvIGNyZWF0ZSBPcmRlciIsIGUpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gb3JkZXI7CiAgICB9CgogICAgcHJpdmF0ZSBIb2xkaW5nRGF0YUJl\nYW4gY3JlYXRlSG9sZGluZyhBY2NvdW50RGF0YUJlYW4gYWNjb3VudCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVvdGVE\nYXRhQmVhbiBxdW90ZSwgZG91YmxlIHF1YW50aXR5LCBCaWdEZWNpbWFsIHB1\ncmNoYXNlUHJpY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEVudGl0eU1hbmFnZXIgZW50aXR5TWFuYWdlcikgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgSG9sZGluZ0RhdGFCZWFuIG5ld0hvbGRp\nbmcgPSBuZXcgSG9sZGluZ0RhdGFCZWFuKHF1YW50aXR5LAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBwdXJjaGFzZVByaWNlLCBuZXcgVGltZXN0YW1wKFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudCwgcXVvdGUpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIG1h\nbmFnZSB0cmFuc2FjdGlvbnMKICAgICAgICAgICAgICovCiAgICAgICAgICAg\nIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5iZWdpbigpOwogICAg\nICAgICAgICBlbnRpdHlNYW5hZ2VyLnBlcnNpc3QobmV3SG9sZGluZyk7CiAg\nICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5jb21t\naXQoKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIGVudGl0eU1hbmFnZXIuZ2V0VHJhbnNhY3Rpb24oKS5y\nb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\ndGl0eU1hbmFnZXIuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHJldHVy\nbiBuZXdIb2xkaW5nOwogICAgfQoKICAgIHB1YmxpYyBkb3VibGUgaW52ZXN0\nbWVudFJldHVybihkb3VibGUgaW52ZXN0bWVudCwgZG91YmxlIE5ldFZhbHVl\nKQogICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICBsb2cudHJhY2UoIlRyYWRlSlBB\nRGlyZWN0OmludmVzdG1lbnRSZXR1cm4iKTsKCiAgICAgICAgZG91YmxlIGRp\nZmYgPSBOZXRWYWx1ZSAtIGludmVzdG1lbnQ7CiAgICAgICAgZG91YmxlIGly\nID0gZGlmZiAvIGludmVzdG1lbnQ7CiAgICAgICAgcmV0dXJuIGlyOwogICAg\nfQoKICAgIHB1YmxpYyBRdW90ZURhdGFCZWFuIHBpbmdUd29QaGFzZShTdHJp\nbmcgc3ltYm9sKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb2cKICAg\nICAgICAuZXJyb3IoIlRyYWRlSlBBRGlyZWN0OnBpbmdUd29QaGFzZSAtIGlz\nIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBydW50aW1lIG1vZGUiKTsKICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24o\nIlRyYWRlSlBBRGlyZWN0OnBpbmdUd29QaGFzZSAtIGlzIG5vdCBpbXBsZW1l\nbnRlZCBmb3IgdGhpcyBydW50aW1lIG1vZGUiKTsKICAgIH0KCiAgICBjbGFz\ncyBxdW90ZVByaWNlQ29tcGFyYXRvciBpbXBsZW1lbnRzIGphdmEudXRpbC5D\nb21wYXJhdG9yIHsKICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoT2JqZWN0\nIHF1b3RlMSwgT2JqZWN0IHF1b3RlMikgewogICAgICAgICAgICBkb3VibGUg\nY2hhbmdlMSA9ICgoUXVvdGVEYXRhQmVhbikgcXVvdGUxKS5nZXRDaGFuZ2Uo\nKTsKICAgICAgICAgICAgZG91YmxlIGNoYW5nZTIgPSAoKFF1b3RlRGF0YUJl\nYW4pIHF1b3RlMikuZ2V0Q2hhbmdlKCk7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgRG91YmxlKGNoYW5nZTIpLmNvbXBhcmVUbyhjaGFuZ2UxKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFkZUJ1aWxkREIgbmVlZHMg\ndGhpcyBhYnN0cmFjdGVkIG1ldGhvZAogICAgICovCiAgICBwdWJsaWMgU3Ry\naW5nIGNoZWNrREJQcm9kdWN0TmFtZSgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIGxvZy5lcnJvcigiVHJhZGVKUEFEaXJlY3Q6Y2hlY2tEQlByb2R1\nY3ROYW1lIC0gaXMgbm90IGltcGxlbWVudGVkIGluIEpQQSBtb2RlIik7CiAg\nICAgICAgLy8gcmV0dXJuKG5ldyBUcmFkZUpEQkNEaXJlY3QoZmFsc2UpKS5j\naGVja0RCUHJvZHVjdE5hbWUoKTsKICAgICAgICBuZXcgUnVudGltZUV4Y2Vw\ndGlvbigiVHJhZGVKUEFEaXJlY3Q6Y2hlY2tEQlByb2R1Y3ROYW1lIC0gaXMg\nbm90IGltcGxlbWVudGVkIGluIEpQQSBtb2RlIik7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFkZUJ1aWxkREIgbmVl\nZHMgdGhpcyBhYnN0cmFjdGVkIG1ldGhvZAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiByZWNyZWF0ZURCVGFibGVzKE9iamVjdFtdIHNxbEJ1ZmZlciwg\namF2YS5pby5QcmludFdyaXRlciBvdXQpCiAgICB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBsb2cuZXJyb3IoIlRyYWRlSlBBRGlyZWN0OnJlY3JlYXRl\nREJUYWJsZXMgLSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gSlBBIG1vZGUiKTsK\nICAgICAgICAvL3JldHVybihuZXcgVHJhZGVKREJDRGlyZWN0KGZhbHNlKSku\ncmVjcmVhdGVEQlRhYmxlcyhzcWxCdWZmZXIsIG91dCk7CiAgICAgICAgbmV3\nIFJ1bnRpbWVFeGNlcHRpb24oIlRyYWRlSlBBRGlyZWN0OnJlY3JlYXRlREJU\nYWJsZXMgLSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gSlBBIG1vZGUiKTsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQg\nbW9kZSAtIHJldHVybnMgdGhlIHBlcnNpc3RlbmNlIG1vZGUgKFRyYWRlQ29u\nZmlnLkpQQSkKICAgICAqIAogICAgICogQHJldHVybiBpbnQgbW9kZQogICAg\nICovCiAgICBwdWJsaWMgaW50IGdldE1vZGUoKSB7CiAgICAgICAgcmV0dXJu\nIFRyYWRlQ29uZmlnLkpQQTsKICAgIH0KCn0K\n","encoding":"base64"}

