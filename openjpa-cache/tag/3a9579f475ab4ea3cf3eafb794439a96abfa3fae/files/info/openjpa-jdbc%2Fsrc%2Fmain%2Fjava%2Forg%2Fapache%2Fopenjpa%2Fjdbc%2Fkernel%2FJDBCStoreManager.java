{"sha":"c77f549ac6c6fe74c0a84a100c35c8f010bf5c28","node_id":"MDQ6QmxvYjIwNjM2NDpjNzdmNTQ5YWM2YzZmZTc0YzBhODRhMTAwYzM1YzhmMDEwYmY1YzI4","size":66771,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c77f549ac6c6fe74c0a84a100c35c8f010bf5c28","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5sYW5nLnJlZmxlY3QuQ29uc3RydWN0b3I7CmltcG9ydCBqYXZh\nLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkJpdFNldDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5z\ncWwuRGF0YVNvdXJjZTsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhh\nbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5ldmVudC5PcnBoYW5lZEtleUFjdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNsYXNzTWFwcGluZzsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRGlzY3JpbWlu\nYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuRmll\nbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5tZXRhLnN0cmF0cy5TdXBlcmNsYXNzRGlzY3JpbWluYXRvclN0cmF0ZWd5\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkRhdGFT\nb3VyY2VGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc3FsLkRCRGljdGlvbmFyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5Kb2luU3ludGF4ZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU1FMRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuU2VsZWN0RXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5zcWwuVW5pb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkJyb2tlckltcGw7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLkZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRmluZGVyQ2FjaGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5QQ1N0YXRlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU2VxOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRleHQ7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVRdWVyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5FeHByZXNzaW9u\nUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJjLkRl\nbGVnYXRpbmdDb25uZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5qZGJjLkRlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nU3RhdGVt\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nRmFjdG9yeUlt\ncGwuTG9nSW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9w\nLk1lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuQ29uY3JldGVDbGFzc0dl\nbmVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFz\nc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmll\nbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkph\ndmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVl\nU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFw\ncGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklk\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRTdGF0ZUV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5K\nUEFJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlN0b3JlRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKCi8qKgogKiBTdG9yZU1hbmFnZXIgcGx1Z2luIHRoYXQgdXNl\ncyBKREJDIHRvIHN0b3JlIHBlcnNpc3RlbnQgZGF0YSBpbiBhCiAqIHJlbGF0\naW9uYWwgZGF0YSBzdG9yZS4KICoKICogQGF1dGhvciBBYmUgV2hpdGUKICog\nQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIEpEQkNTdG9yZU1hbmFnZXIg\nCiAgICBpbXBsZW1lbnRzIFN0b3JlTWFuYWdlciwgSkRCQ1N0b3JlIHsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKEpEQkNTdG9yZU1hbmFnZXIuY2xh\nc3MpOwoKICAgIHByaXZhdGUgU3RvcmVDb250ZXh0IF9jdHggPSBudWxsOwog\nICAgcHJpdmF0ZSBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7CiAg\nICBwcml2YXRlIERCRGljdGlvbmFyeSBfZGljdCA9IG51bGw7CiAgICBwcml2\nYXRlIFNRTEZhY3RvcnkgX3NxbCA9IG51bGw7CiAgICBwcml2YXRlIEpEQkNM\nb2NrTWFuYWdlciBfbG0gPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhU291cmNl\nIF9kcyA9IG51bGw7CiAgICBwcml2YXRlIFJlZkNvdW50Q29ubmVjdGlvbiBf\nY29ubiA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2FjdGl2ZSA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBMb2cgX2xvZyA9IG51bGw7CgogICAgLy8gdHJh\nY2sgdGhlIHBlbmRpbmcgc3RhdGVtZW50cyBzbyB3ZSBjYW4gY2FuY2VsIHRo\nZW0KICAgIHByaXZhdGUgU2V0PFN0YXRlbWVudD4gX3N0bW50cyA9IENvbGxl\nY3Rpb25zLnN5bmNocm9uaXplZFNldChuZXcgSGFzaFNldDxTdGF0ZW1lbnQ+\nKCkpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENvbnN0cnVjdG9yPENs\naWVudENvbm5lY3Rpb24+IGNsaWVudENvbm5lY3Rpb25JbXBsOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgQ29uc3RydWN0b3I8UmVmQ291bnRDb25uZWN0\naW9uPiByZWZDb3VudENvbm5lY3Rpb25JbXBsOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgQ29uc3RydWN0b3I8Q2FuY2VsU3RhdGVtZW50PiBjYW5jZWxT\ndGF0ZW1lbnRJbXBsOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ29uc3Ry\ndWN0b3I8Q2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnQ+IGNhbmNlbFByZXBhcmVk\nU3RhdGVtZW50SW1wbDsKCiAgICBzdGF0aWMgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGNsaWVudENvbm5lY3Rpb25JbXBsID0gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENsaWVudENvbm5l\nY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgQ29ubmVjdGlvbi5jbGFz\ncyk7CiAgICAgICAgICAgIHJlZkNvdW50Q29ubmVjdGlvbkltcGwgPSBDb25j\ncmV0ZUNsYXNzR2VuZXJhdG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoUmVm\nQ291bnRDb25uZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0\nb3JlTWFuYWdlci5jbGFzcywgQ29ubmVjdGlvbi5jbGFzcyk7CiAgICAgICAg\nICAgIGNhbmNlbFN0YXRlbWVudEltcGwgPSBDb25jcmV0ZUNsYXNzR2VuZXJh\ndG9yLmdldENvbmNyZXRlQ29uc3RydWN0b3IoQ2FuY2VsU3RhdGVtZW50LmNs\nYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci5jbGFzcywg\nU3RhdGVtZW50LmNsYXNzLCBDb25uZWN0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsID0gQ29uY3JldGVDbGFz\nc0dlbmVyYXRvci5nZXRDb25jcmV0ZUNvbnN0cnVjdG9yKENhbmNlbFByZXBh\ncmVkU3RhdGVtZW50LmNsYXNzLAogICAgICAgICAgICAgICAgSkRCQ1N0b3Jl\nTWFuYWdlci5jbGFzcywgUHJlcGFyZWRTdGF0ZW1lbnQuY2xhc3MsIENvbm5l\nY3Rpb24uY2xhc3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb25JbkluaXRpYWxpemVy\nRXJyb3IoZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBTdG9yZUNv\nbnRleHQgZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2N0eDsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0KFN0b3JlQ29udGV4dCBj\ndHgpIHsKICAgICAgICBzZXRDb250ZXh0KGN0eCwgKEpEQkNDb25maWd1cmF0\naW9uKSBjdHguZ2V0Q29uZmlndXJhdGlvbigpKTsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgc2V0Q29udGV4dChTdG9yZUNvbnRleHQgY3R4LCBKREJD\nQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2N0eCA9IGN0eDsKICAg\nICAgICBfY29uZiA9IGNvbmY7CiAgICAgICAgX2RpY3QgPSBfY29uZi5nZXRE\nQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAgIF9zcWwgPSBfY29uZi5n\nZXRTUUxGYWN0b3J5SW5zdGFuY2UoKTsKICAgICAgICBfbG9nID0gX2NvbmYu\nZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9uLkxPR19ESUFHKTsKCiAgICAgICAg\nTG9ja01hbmFnZXIgbG0gPSBjdHguZ2V0TG9ja01hbmFnZXIoKTsKICAgICAg\nICBpZiAobG0gaW5zdGFuY2VvZiBKREJDTG9ja01hbmFnZXIpCiAgICAgICAg\nICAgIF9sbSA9IChKREJDTG9ja01hbmFnZXIpIGxtOwoKICAgICAgICBfZHMg\nPSBnZXREYXRhU291cmNlKGN0eCk7CgogICAgICAgIGlmIChfY29uZi5nZXRV\ncGRhdGVNYW5hZ2VySW5zdGFuY2UoKS5vcmRlckRpcnR5KCkpCiAgICAgICAg\nICAgIGN0eC5zZXRPcmRlckRpcnR5T2JqZWN0cyh0cnVlKTsKICAgIH0KICAg\nICAgICAKICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiB1c2VDb25uZWN0aW9u\nRmFjdG9yeTIoU3RvcmVDb250ZXh0IGN0eCkgeyAKICAgICAgICByZXR1cm4g\nKCFjdHguaXNNYW5hZ2VkKCkgJiYgX2NvbmYuaXNDb25uZWN0aW9uRmFjdG9y\neU1vZGVNYW5hZ2VkKCkpOyAgCiAgICB9CiAgICAgICAgCiAgICBwcml2YXRl\nIGZpbmFsIERhdGFTb3VyY2UgZ2V0RGF0YVNvdXJjZShTdG9yZUNvbnRleHQg\nY3R4KSB7CiAgICAgICAgRGF0YVNvdXJjZSBkczsKCiAgICAgICAgaWYgKHVz\nZUNvbm5lY3Rpb25GYWN0b3J5MihjdHgpKSB7CiAgICAgICAgICAgIGRzID0g\nKERhdGFTb3VyY2UpIGN0eC5nZXRDb25uZWN0aW9uRmFjdG9yeTIoKTsKICAg\nICAgICAgICAgaWYgKGRzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGRz\nID0gRGF0YVNvdXJjZUZhY3RvcnkuZGVjb3JhdGVEYXRhU291cmNlKGRzLCBf\nY29uZiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2Ug\newogICAgICAgICAgICAgICAgZHMgPSBfY29uZi5nZXREYXRhU291cmNlMihj\ndHgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgZHMgPSAoRGF0YVNvdXJjZSkgY3R4LmdldENvbm5lY3Rpb25GYWN0b3J5\nKCk7CiAgICAgICAgICAgIGlmIChkcyAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBkcyA9IERhdGFTb3VyY2VGYWN0b3J5LmRlY29yYXRlRGF0YVNvdXJj\nZShkcywgX2NvbmYsIGZhbHNlKTsgICAKICAgICAgICAgICAgfQogICAgICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGRzID0gX2NvbmYuZ2V0RGF0\nYVNvdXJjZShjdHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBkczsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBib29sZWFuIHVz\nZUNvbnRleHRUb0dldERhdGFTb3VyY2UoU3RvcmVDb250ZXh0IGN0eCkgeyAK\nICAgICAgICAvLyBjb25maWd1cmF0aW9uIGNoZWNrIHRvIGVuYWJsZSBnb2Vz\nIGhlcmUuIAogICAgICAgIGlmIChTdHJpbmdVdGlscy5pc0JsYW5rKGN0eC5n\nZXRDb25uZWN0aW9uRmFjdG9yeU5hbWUoKSkgCiAgICAgICAgICAgICAgICAm\nJiBTdHJpbmdVdGlscy5pc0JsYW5rKGN0eC5nZXRDb25uZWN0aW9uRmFjdG9y\neTJOYW1lKCkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIEpE\nQkNDb25maWd1cmF0aW9uIGdldENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAg\ncmV0dXJuIF9jb25mOwogICAgfQoKICAgIHB1YmxpYyBEQkRpY3Rpb25hcnkg\nZ2V0REJEaWN0aW9uYXJ5KCkgewogICAgICAgIHJldHVybiBfZGljdDsKICAg\nIH0KCiAgICBwdWJsaWMgU1FMRmFjdG9yeSBnZXRTUUxGYWN0b3J5KCkgewog\nICAgICAgIHJldHVybiBfc3FsOwogICAgfQoKICAgIHB1YmxpYyBKREJDTG9j\na01hbmFnZXIgZ2V0TG9ja01hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIF9s\nbTsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBn\nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIChKREJD\nRmV0Y2hDb25maWd1cmF0aW9uKSBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlv\nbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2luT3B0aW1pc3RpYygp\nIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFja09wdGltaXN0aWMo\nKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW4oKSB7CiAgICAgICAg\nX2FjdGl2ZSA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKCghX2N0eC5pc01hbmFnZWQoKSB8fCAhX2NvbmYuaXNDb25uZWN0aW9uRmFj\ndG9yeU1vZGVNYW5hZ2VkKCkpCiAgICAgICAgICAgICAgICAmJiBfY29ubi5n\nZXRBdXRvQ29tbWl0KCkpCiAgICAgICAgICAgICAgICBfY29ubi5zZXRBdXRv\nQ29tbWl0KGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgX2FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAg\nICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9jdHguaXNNYW5hZ2VkKCkg\nfHwgIV9jb25mLmlzQ29ubmVjdGlvbkZhY3RvcnlNb2RlTWFuYWdlZCgpKQog\nICAgICAgICAgICAgICAgX2Nvbm4uY29tbWl0KCk7CiAgICAgICAgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBfY29ubi5yb2xsYmFjaygpOwogICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UyKSB7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3Qp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9hY3RpdmUgPSBm\nYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJh\nY2soKSB7CiAgICAgICAgLy8gYWxyZWFkeSByb2xsZWQgYmFjayBvdXJzZWx2\nZXM/CiAgICAgICAgaWYgKCFfYWN0aXZlKQogICAgICAgICAgICByZXR1cm47\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfY29ubiAhPSBudWxs\nCiAgICAgICAgICAgICAgICAmJiAoIV9jdHguaXNNYW5hZ2VkKCkgfHwgIV9j\nb25mCiAgICAgICAgICAgICAgICAgICAgLmlzQ29ubmVjdGlvbkZhY3RvcnlN\nb2RlTWFuYWdlZCgpKSkKICAgICAgICAgICAgICAgIF9jb25uLnJvbGxiYWNr\nKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfYWN0aXZlID0g\nZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJldGFp\nbkNvbm5lY3Rpb24oKSB7CiAgICAgICAgY29ubmVjdChmYWxzZSk7CiAgICAg\nICAgX2Nvbm4uc2V0UmV0YWluKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHJlbGVhc2VDb25uZWN0aW9uKCkgewogICAgICAgIGlmIChfY29ubiAh\nPSBudWxsKQogICAgICAgICAgICBfY29ubi5zZXRSZXRhaW4oZmFsc2UpOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0Q2xpZW50Q29ubmVjdGlvbigp\nIHsKICAgICAgICByZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRvci5uZXdJ\nbnN0YW5jZShjbGllbnRDb25uZWN0aW9uSW1wbCwgZ2V0Q29ubmVjdGlvbigp\nKTsKICAgIH0KCiAgICBwdWJsaWMgQ29ubmVjdGlvbiBnZXRDb25uZWN0aW9u\nKCkgewogICAgICAgIGNvbm5lY3QodHJ1ZSk7CiAgICAgICAgcmV0dXJuIF9j\nb25uOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgRGF0YVNvdXJjZSBnZXRE\nYXRhU291cmNlKCkgewogICAgCXJldHVybiBfZHM7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZXhpc3RzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9i\namVjdCBjb250ZXh0KSB7CiAgICAgICAgLy8gYWRkIHdoZXJlIGNvbmRpdGlv\nbnMgb24gYmFzZSBjbGFzcyB0byBhdm9pZCBqb2lucyBpZiBzdWJjbGFzcwog\nICAgICAgIC8vIGRvZXNuJ3QgdXNlIG9pZCBhcyBpZGVudGlmaWVyCiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIHJldHVybiBleGlzdHMobWFwcGluZywg\nc20uZ2V0T2JqZWN0SWQoKSwgY29udGV4dCk7CiAgICB9CgogICAgcHJpdmF0\nZSBib29sZWFuIGV4aXN0cyhDbGFzc01hcHBpbmcgbWFwcGluZywgT2JqZWN0\nIG9pZCwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAvLyBhZGQgd2hlcmUg\nY29uZGl0aW9ucyBvbiBiYXNlIGNsYXNzIHRvIGF2b2lkIGpvaW5zIGlmIHN1\nYmNsYXNzCiAgICAgICAgLy8gZG9lc24ndCB1c2Ugb2lkIGFzIGlkZW50aWZp\nZXIKICAgICAgICBTZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAg\nICAgICB3aGlsZSAobWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01h\ncHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICBtYXBwaW5nID0gbWFwcGlu\nZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKCiAgICAgICAg\nc2VsLndoZXJlUHJpbWFyeUtleShvaWQsIG1hcHBpbmcsIHRoaXMpOwogICAg\nICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nX2xvZy50cmFjZSgiZXhpc3RzOiBvaWQ9IitvaWQrIiAiK21hcHBpbmcuZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIHNlbC5nZXRDb3VudCh0aGlzKSAhPSAwOwogICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0\naHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBfZGljdCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN5bmNWZXJzaW9uKE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20sIE9iamVjdCBjb250ZXh0KSB7CiAgICAg\nICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVy\nbiBtYXBwaW5nLmdldFZlcnNpb24oKS5jaGVja1ZlcnNpb24oc20sIHRoaXMs\nIHRydWUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewog\nICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBf\nZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBpbnQgY29tcGFy\nZVZlcnNpb24oT3BlbkpQQVN0YXRlTWFuYWdlciBzdGF0ZSwgT2JqZWN0IHYx\nLCBPYmplY3QgdjIpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9\nIChDbGFzc01hcHBpbmcpIHN0YXRlLmdldE1ldGFEYXRhKCk7CiAgICAgICAg\ncmV0dXJuIG1hcHBpbmcuZ2V0VmVyc2lvbigpLmNvbXBhcmVWZXJzaW9uKHYx\nLCB2Mik7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaW5pdGlhbGl6ZShP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLAogICAgICAg\nIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICBDb25uZWN0aW9uSW5mbyBpbmZvID0gKENvbm5lY3Rpb25JbmZv\nKSBjb250ZXh0OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBp\nbml0aWFsaXplU3RhdGUoc20sIHN0YXRlLCAoSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbikgZmV0Y2gsIAogICAgICAgICAgICAgICAgaW5mbyk7CiAgICAgICAg\nfSBjYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKGNuZmUpOwogICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0aHJv\ndyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNlLCBFeGNlcHRpb25zLnRvU3Ry\naW5nKHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpKSwgCiAgICAgICAgICAg\nICAgICAgICAgX2RpY3QsIGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhIG5l\nd2x5LWxvYWRlZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGJv\nb2xlYW4gaW5pdGlhbGl6ZVN0YXRlKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nIFBDU3RhdGUgc3RhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgQ29ubmVjdGlvbkluZm8gaW5mbykKICAgICAgICB0aHJvd3Mg\nQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiwgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBPYmplY3Qgb2lkID0gc20uZ2V0T2JqZWN0SWQoKTsKICAgICAgICBDbGFz\nc01hcHBpbmcgbWFwcGluZyA9IChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKGluZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3Vs\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXMgPSBpbmZvLnJlc3Vs\ndDsKICAgICAgICAgICAgICAgIGluZm8uc20gPSBzbTsKICAgICAgICAgICAg\nICAgIGlmIChpbmZvLm1hcHBpbmcgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICBpbmZvLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgICAgICAgICAg\nbWFwcGluZyA9IGluZm8ubWFwcGluZzsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChvaWQgaW5zdGFuY2VvZiBPcGVuSlBBSWQKICAgICAgICAgICAgICAgICYm\nICEoKE9wZW5KUEFJZCkgb2lkKS5oYXNTdWJjbGFzc2VzKCkpIHsKICAgICAg\nICAgICAgICAgIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFw\ncGluZywgc3RhdGUsIGZldGNoKTsKICAgICAgICAgICAgICAgIGlmIChjdXN0\nb20gIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VzdG9t\nLmJvb2xlYW5WYWx1ZSgpOwogICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5p\ndGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRjaCwKICAgICAg\nICAgICAgICAgICAgICBTZWxlY3QuU1VCU19FWEFDVCk7CiAgICAgICAgICAg\nICAgICBpZiAocmVzID09IG51bGwgJiYgIXNlbGVjdFByaW1hcnlLZXkoc20s\nIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoaXNFbXB0eVJlc3VsdChyZXMp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIENsYXNzTWFwcGluZ1tdIG1h\ncHBpbmdzID0gbWFwcGluZy4KICAgICAgICAgICAgICAgICAgICBnZXRJbmRl\ncGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgICAgICAgICAgICAg\naWYgKG1hcHBpbmdzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAg\nICAgbWFwcGluZyA9IG1hcHBpbmdzWzBdOwogICAgICAgICAgICAgICAgICAg\nIEJvb2xlYW4gY3VzdG9tID0gY3VzdG9tTG9hZChzbSwgbWFwcGluZywgc3Rh\ndGUsIGZldGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VzdG9tICE9\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXN0b20u\nYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0\nSW5pdGlhbGl6ZVN0YXRlUmVzdWx0KHNtLCBtYXBwaW5nLCBmZXRjaCwKICAg\nICAgICAgICAgICAgICAgICAgICAgU2VsZWN0LlNVQlNfQU5ZX0pPSU5BQkxF\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzID09IG51bGwgJiYgIXNl\nbGVjdFByaW1hcnlLZXkoc20sIG1hcHBpbmcsIGZldGNoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmVzID0gZ2V0SW5pdGlhbGl6\nZVN0YXRlVW5pb25SZXN1bHQoc20sIG1hcHBpbmcsIG1hcHBpbmdzLAogICAg\nICAgICAgICAgICAgICAgICAgICBmZXRjaCk7CiAgICAgICAgICAgICAgICBp\nZiAoaXNFbXB0eVJlc3VsdChyZXMpKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZmln\ndXJlIG91dCB3aGF0IHR5cGUgb2Ygb2JqZWN0IHRoaXMgaXM7IHRoZSBzdGF0\nZSBtYW5hZ2VyCiAgICAgICAgICAgIC8vIG9ubHkgZ3VhcmFudGVlcyB0byBw\ncm92aWRlIGEgYmFzZSBjbGFzcwogICAgICAgICAgICBDbGFzczw/PiB0eXBl\nOwogICAgICAgICAgICBpZiAoKHR5cGUgPSBnZXRUeXBlKHJlcywgbWFwcGlu\nZykpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXMuZ2V0QmFz\nZU1hcHBpbmcoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIG1hcHBp\nbmcgPSByZXMuZ2V0QmFzZU1hcHBpbmcoKTsKICAgICAgICAgICAgICAgIHJl\ncy5zdGFydERhdGFSZXF1ZXN0KG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigp\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\ndHlwZSA9IG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpLmdldENsYXNzKHRo\naXMsIG1hcHBpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyk7CiAg\nICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAg\nIHJlcy5lbmREYXRhUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzdGF0\nZSBtYW5hZ2VyOyB0aGlzIG1heSBjaGFuZ2UgdGhlIG1hcHBpbmcKICAgICAg\nICAgICAgLy8gYW5kIHRoZSBvYmplY3QgaWQgaW5zdGFuY2UgaWYgdGhlIHR5\ncGUgYXMgZGV0ZXJtaW5lZAogICAgICAgICAgICAvLyBmcm9tIHRoZSBpbmRp\nY2F0b3IgaXMgYSBzdWJjbGFzcyBvZiBleHBlY3RlZCB0eXBlCiAgICAgICAg\nICAgIHNtLmluaXRpYWxpemUodHlwZSwgc3RhdGUpOwoKICAgICAgICAgICAg\naWYgKGluZm8gIT0gbnVsbCAmJiBpbmZvLnJlc3VsdCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBGaWVsZE1hcHBpbmcgbWFwcGVkQnlGaWVsZE1hcHBp\nbmcgPSBpbmZvLnJlc3VsdC4KICAgICAgICAgICAgICAgICAgICBnZXRNYXBw\nZWRCeUZpZWxkTWFwcGluZygpOwogICAgICAgICAgICAgICAgT2JqZWN0IG1h\ncHBlZEJ5T2JqZWN0ID0gaW5mby5yZXN1bHQuZ2V0TWFwcGVkQnlWYWx1ZSgp\nOwogICAgICAgICAgICAgICAgaWYgKG1hcHBlZEJ5RmllbGRNYXBwaW5nICE9\nIG51bGwgJiYgbWFwcGVkQnlPYmplY3QgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBpZiAobWFwcGVkQnlPYmplY3QgaW5zdGFuY2VvZiBPcGVuSlBB\nSWQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZy5nZXRFeHRy\nYUZpZWxkRGF0YUluZGV4KG1hcHBlZEJ5RmllbGRNYXBwaW5nLmdldEluZGV4\nKCkpICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBp\nbnZlcnNlIHJlbGF0aW9uIGNhbiBub3QgYmUgc2V0IHNpbmNlCiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHdlIGFyZSBlYWdlcmx5IGxvYWRpbmcgdGhp\ncyBzbSBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYSBzbSBvd25l\nciB0aGF0IGlzIHN0aWxsIGluIHRoZSBwcm9jZXNzIG9mIAogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBpbml0aWFsaXppbmcgaXRzZWxmLgogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciBvd25lciBvaWQgYnkgc2V0\nSW50ZXJtZWRpYXRlKCkuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRo\nZSBpbnZlcnNlIHJlbGF0aW9uIGlzIHNldCBsYXRlciBieQogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBzZXRJbnZlcnNlUmVsYXRpb24oKSB3aGVuIHRo\nZSBzbSBvd25lciBpcyBmdWxseQogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBpbml0aWFsaXplZC4KICAgICAgICAgICAgICAgICAgICAgICAgaW50IGlu\nZGV4ID0gbWFwcGVkQnlGaWVsZE1hcHBpbmcuZ2V0SW5kZXgoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHNtLmdldExvYWRlZCgpLmdldChpbmRl\neCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNldEltcGxE\nYXRhKGluZGV4LCBtYXBwZWRCeU9iamVjdCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBz\nbS5zZXRJbnRlcm1lZGlhdGUoaW5kZXgsIG1hcHBlZEJ5T2JqZWN0KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldE1hcHBlZEJ5KHNt\nLCBtYXBwZWRCeUZpZWxkTWFwcGluZywgbWFwcGVkQnlPYmplY3QpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBsb2FkIHRoZSBzZWxlY3RlZCBtYXBwaW5ncyBpbnRvIHRoZSBnaXZlbiBz\ndGF0ZSBtYW5hZ2VyCiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgLy8gcmUtZ2V0IHRoZSBtYXBwaW5nIGluIGNhc2Ug\ndGhlIGluc3RhbmNlIHdhcyBhIHN1YmNsYXNzCiAgICAgICAgICAgICAgICBt\nYXBwaW5nID0gKENsYXNzTWFwcGluZykgc20uZ2V0TWV0YURhdGEoKTsKICAg\nICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMpOwog\nICAgICAgICAgICAgICAgZ2V0VmVyc2lvbihtYXBwaW5nLCBzbSwgcmVzKTsK\nICAgICAgICAgICAgICAgIHNldEludmVyc2VSZWxhdGlvbihzbSwgbWFwcGlu\nZywgcmVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAocmVzICE9\nIG51bGwgJiYgKGluZm8gPT0gbnVsbCB8fCByZXMgIT0gaW5mby5yZXN1bHQp\nKQogICAgICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBzZXRJbnZlcnNlUmVsYXRpb24oT3BlbkpQ\nQVN0YXRlTWFuYWdlciBvd25lciwKICAgICAgICBDbGFzc01hcHBpbmcgbWFw\ncGluZywgUmVzdWx0IHJlcykgewogICAgICAgIEZpZWxkTWFwcGluZ1tdIGZt\ncyA9IG1hcHBpbmcuZ2V0RmllbGRNYXBwaW5ncygpOwoKICAgICAgICAvLyBB\ndCB0aGlzIHBvaW50LCB0aGUgb3duZXIgaXMgZnVsbHkgaW5pdGlhbGl6ZWQu\nCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIG93bmVyIGhhcyBlYWdlcmx5IGxv\nYWRlZCBUb01hbnkgcmVsYXRpb25zLgogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChyZXMu\nZ2V0RWFnZXIoZm1zW2ldKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBp\nZiAoIWZtc1tpXS5nZXRFbGVtZW50KCkuaXNUeXBlUEMoKSkKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIE9iamVjdCBj\nb2xsID0gIG93bmVyLmZldGNoT2JqZWN0KGZtc1tpXS5nZXRJbmRleCgpKTsK\nICAgICAgICAgICAgICAgIGlmIChjb2xsIGluc3RhbmNlb2YgTWFwKQogICAg\nICAgICAgICAgICAgICAgIGNvbGwgPSAoKE1hcCljb2xsKS52YWx1ZXMoKTsK\nICAgICAgICAgICAgICAgIGlmIChjb2xsIGluc3RhbmNlb2YgQ29sbGVjdGlv\nbjw/PiAmJiAKICAgICAgICAgICAgICAgICAgICAoKENvbGxlY3Rpb248Pz4p\nIGNvbGwpLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBG\nb3VuZCBlYWdlcmx5IGxvYWRlZCBjb2xsZWN0aW9uLgogICAgICAgICAgICAg\nICAgICAgIC8vIFB1Ymxpc2hlciAoMSkgPD09PiAgKE0pIE1hZ2F6aW5lCiAg\nICAgICAgICAgICAgICAgICAgLy8gICAgcHVibGlzaGVyIGhhcyBhIEVBR0VS\nIE9uZVRvTWFueSByZWxhdGlvbgogICAgICAgICAgICAgICAgICAgIC8vICAg\nIG1hZ2F6aW5lIGhhcyBhIEVBR0VSIG9yIExBWlkgTWFueVRvT25lIHB1Ymxp\nc2hlcgogICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIG1lbWJlciAo\nTWFnYXppbmUpIGluIHRoZSBjb2xsZWN0aW9uLCAKICAgICAgICAgICAgICAg\nICAgICAvLyBzZXQgaXRzIGludmVyc2UgcmVsYXRpb24gKFB1Ymxpc2hlciku\nCiAgICAgICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSAo\nKENvbGxlY3Rpb248Pz4pIGNvbGwpLml0ZXJhdG9yKCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IChQZXJzaXN0ZW5j\nZUNhcGFibGUpIGl0ci5uZXh0KCk7CgogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbSA9IChPcGVuSlBBU3RhdGVNYW5hZ2VyKSBwYy4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHBjR2V0U3RhdGVNYW5hZ2VyKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtZCA9\nICgoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRhRGF0YSgpKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGdldEZpZWxkTWFwcGluZ3MoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbWQubGVu\nZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVj\ndCBvaWQgPSBzbS5nZXRJbnRlcm1lZGlhdGUoZm1kW2pdLmdldEluZGV4KCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgb2lkIHdhcyBz\nZXRJbnRlcm1lZGlhdGUoKSBwcmV2aW91c2x5CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBhbmQgaXQgaXMgdGhlIHNhbWUgYXMgdGhlIG93bmVy\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiBzZXQgdGhl\nIGludmVyc2UgcmVsYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChvaWQgIT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG9pZC5lcXVhbHMob3duZXIuZ2V0T2JqZWN0SWQoKSkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbS5zdG9yZU9iamVjdChm\nbWRbal0uZ2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgb3duZXIuZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIHNldE1hcHBlZEJ5KE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sCiAgICAgICAg\nRmllbGRNYXBwaW5nIG1hcHBlZEJ5RmllbGRNYXBwaW5nLCBPYmplY3QgbWFw\ncGVkQnlPYmplY3QpIHsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9\nIChDbGFzc01hcHBpbmcpIHNtLmdldE1ldGFEYXRhKCk7CiAgICAgICAgRmll\nbGRNYXBwaW5nW10gZm1zID0gbWFwcGluZy5nZXRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGZtc1tpXSA9PSBtYXBwZWRCeUZpZWxkTWFw\ncGluZykgewogICAgICAgICAgICAgICAgc20uc3RvcmVPYmplY3QoZm1zW2ld\nLmdldEluZGV4KCksIG1hcHBlZEJ5T2JqZWN0KTsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUg\nZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0\naW9uIG9mIGdldHRpbmcgdmVyc2lvbiBmcm9tIHRoZSByZXN1bHQgc2V0Lgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBnZXRWZXJzaW9uKENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAg\nIFJlc3VsdCByZXMpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIG1h\ncHBpbmcuZ2V0VmVyc2lvbigpLmFmdGVyTG9hZChzbSwgdGhpcyk7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlk\nZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICog\naW1wbGVtZW50YXRpb24gb2YgY2hlY2tpbmcgd2hldGhlciB0aGUgcmVzdWx0\nIHNldCBpcyBlbXB0eSBvciBub3QuCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIGlzRW1wdHlSZXN1bHQoUmVzdWx0IHJlcykgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKHJlcyAhPSBudWxsICYmICFyZXMubmV4\ndCgpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2Qg\naXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1s\naWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZ2V0dGluZyB0eXBlIGZy\nb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDbGFz\nczw/PiBnZXRUeXBlKFJlc3VsdCByZXMsIENsYXNzTWFwcGluZyBtYXBwaW5n\nKXsKICAgICAgICBpZiAocmVzID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBtYXBwaW5nLmdldERlc2NyaWJlZFR5cGUoKTsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93IHRoZSBtYXBwaW5n\nIHRvIGN1c3RvbSBsb2FkIGRhdGEuIFJldHVybiBudWxsIGlmIHRoZSBtYXBw\naW5nCiAgICAgKiBkb2VzIG5vdCB1c2UgY3VzdG9tIGxvYWRpbmcuCiAgICAg\nKi8KICAgIHByaXZhdGUgQm9vbGVhbiBjdXN0b21Mb2FkKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIENsYXNzTWFwcGluZyBtYXBwaW5nLAogICAgICAgIFBD\nU3RhdGUgc3RhdGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAg\nICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNlcHRpb24sIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSBtYXBwaW5n\nIHRha2VzIGNhcmUgb2YgaW5pdGlhbGl6YXRpb24KICAgICAgICBpZiAoIW1h\ncHBpbmcuY3VzdG9tTG9hZChzbSwgdGhpcywgc3RhdGUsIGZldGNoKSkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgbWFwcGluZy5n\nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNtLCB0aGlzKTsKICAgICAgICAgICAg\ncmV0dXJuIEJvb2xlYW4uVFJVRTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uRkFMU0U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3Qg\ndGhlIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBhbmQgcmV0dXJuIHRo\nZSByZXN1bHQuIFJldHVybgogICAgICogbnVsbCBpZiB0aGVyZSBpcyBubyBk\nYXRhIGluIHRoZSBjdXJyZW50IGZldGNoIGdyb3VwcyB0byBzZWxlY3QuCiAg\nICAgKi8KICAgIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxpemVTdGF0ZVJl\nc3VsdChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAgICAgIENsYXNzTWFw\ncGluZyBtYXBwaW5nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBp\nbnQgc3VicykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBGaW5kZXJRdWVyeUltcGwgZnEgPSBnZXRGaW5kZXIobWFwcGluZywgZmV0\nY2gpOwogICAgICAgIGlmIChmcSAhPSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gZnEuZXhlY3V0ZShzbSwgdGhpcywgZmV0Y2gpOwogICAgICAgIFNlbGVj\ndCBzZWwgPSBfc3FsLm5ld1NlbGVjdCgpOwogICAgICAgIGlmICghc2VsZWN0\nKHNlbCwgbWFwcGluZywgc3Vicywgc20sIG51bGwsIGZldGNoLAogICAgICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU4sIHRydWUs\nIGZhbHNlKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgc2Vs\nLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBtYXBwaW5nLCB0\naGlzKTsKICAgICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgxLCBm\nYWxzZSk7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewog\nICAgICAgICAgICBfbG9nLnRyYWNlKCJnZXRJbml0aWFsaXplU3RhdGVSZXN1\nbHQ6IG9pZD0iK3NtLmdldE9iamVjdElkKCkrIiAiK21hcHBpbmcuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgUmVzdWx0IHJlc3Vs\ndCA9IHNlbC5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICBjYWNoZUZp\nbmRlcihtYXBwaW5nLCBzZWwsIGZldGNoKTsKICAgICAgICByZXR1cm4gcmVz\ndWx0OwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0IGEgdW5pb24gb2Yg\ndGhlIGRhdGEgZm9yIHRoZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHBvc3NpYmxl\nIGNvbmNyZXRlCiAgICAgKiBtYXBwaW5ncyBhbmQgcmV0dXJuIHRoZSByZXN1\nbHQuCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0IGdldEluaXRpYWxpemVT\ndGF0ZVVuaW9uUmVzdWx0KGZpbmFsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20s\nCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGZpbmFsIENsYXNzTWFw\ncGluZ1tdIG1hcHBpbmdzLAogICAgICAgIGZpbmFsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIEZpbmRlclF1ZXJ5SW1wbCBmcSA9IGdldEZpbmRlcihtYXBwaW5nLCBmZXRj\naCk7CiAgICAgICAgaWYgKGZxICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmcS5leGVjdXRlKHNtLCB0aGlzLCBmZXRjaCk7CiAgICAgICAgZmluYWwg\nSkRCQ1N0b3JlTWFuYWdlciBzdG9yZSA9IHRoaXM7CiAgICAgICAgZmluYWwg\naW50IGVhZ2VyID0gTWF0aC5taW4oZmV0Y2guZ2V0RWFnZXJGZXRjaE1vZGUo\nKSwKICAgICAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9K\nT0lOKTsKCiAgICAgICAgVW5pb24gdW5pb24gPSBfc3FsLm5ld1VuaW9uKG1h\ncHBpbmdzLmxlbmd0aCk7CiAgICAgICAgdW5pb24uc2V0RXhwZWN0ZWRSZXN1\nbHRDb3VudCgxLCBmYWxzZSk7CiAgICAgICAgaWYgKGZldGNoLmdldFN1YmNs\nYXNzRmV0Y2hNb2RlKG1hcHBpbmcpICE9IGZldGNoLkVBR0VSX0pPSU4pCiAg\nICAgICAgICAgIHVuaW9uLmFib3J0VW5pb24oKTsKICAgICAgICB1bmlvbi5z\nZWxlY3QobmV3IFVuaW9uLlNlbGVjdG9yKCkgewogICAgICAgICAgICBwdWJs\naWMgdm9pZCBzZWxlY3QoU2VsZWN0IHNlbCwgaW50IGkpIHsKICAgICAgICAg\nICAgICAgIHNlbC5zZWxlY3QobWFwcGluZ3NbaV0sIFNlbGVjdC5TVUJTX0FO\nWV9KT0lOQUJMRSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICAgICAgICAg\nIGVhZ2VyKTsKICAgICAgICAgICAgICAgIHNlbC53aGVyZVByaW1hcnlLZXko\nc20uZ2V0T2JqZWN0SWQoKSwgbWFwcGluZ3NbaV0sIHN0b3JlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0pOwogICAgICAgIFJlc3VsdCByZXN1bHQgPSB1\nbmlvbi5leGVjdXRlKHRoaXMsIGZldGNoKTsKICAgICAgICBjYWNoZUZpbmRl\ncihtYXBwaW5nLCB1bmlvbiwgZmV0Y2gpOwogICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgcHJpbWFyeSBrZXkg\nZGF0YSB0byBtYWtlIHN1cmUgdGhlIGdpdmVuIGluc3RhbmNlIGV4aXN0cywg\nbG9ja2luZwogICAgICogaWYgbmVlZGVkLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gc2VsZWN0UHJpbWFyeUtleShPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJDRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIC8vIHNlbGVjdCBwa3MgZnJvbSBiYXNlIGNsYXNzIHJl\nY29yZCB0byBlbnN1cmUgaXQgZXhpc3RzIGFuZCBsb2NrCiAgICAgICAgLy8g\naXQgaWYgbmVlZGVkCiAgICAgICAgQ2xhc3NNYXBwaW5nIGJhc2UgPSBtYXBw\naW5nOwogICAgICAgIHdoaWxlIChiYXNlLmdldEpvaW5hYmxlUENTdXBlcmNs\nYXNzTWFwcGluZygpICE9IG51bGwpCiAgICAgICAgICAgIGJhc2UgPSBiYXNl\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwoKICAgICAgICBT\nZWxlY3Qgc2VsID0gX3NxbC5uZXdTZWxlY3QoKTsKICAgICAgICBzZWwuc2Vs\nZWN0KGJhc2UuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAgICAgICAgc2Vs\nLndoZXJlUHJpbWFyeUtleShzbS5nZXRPYmplY3RJZCgpLCBiYXNlLCB0aGlz\nKTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgIF9sb2cudHJhY2UoInNlbGVjdFByaW1hcnlLZXk6IG9pZD0iK3Nt\nLmdldE9iamVjdElkKCkrIiAiK21hcHBpbmcuZ2V0RGVzY3JpYmVkVHlwZSgp\nKTsKICAgICAgICB9CiAgICAgICAgUmVzdWx0IGV4aXN0cyA9IHNlbC5leGVj\ndXRlKHRoaXMsIGZldGNoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoaXNFbXB0eVJlc3VsdChleGlzdHMpKQogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwoKICAgICAgICAgICAgLy8gcmVjb3JkIGxvY2tlZD8KICAg\nICAgICAgICAgaWYgKF9hY3RpdmUgJiYgX2xtICE9IG51bGwgJiYgZXhpc3Rz\nLmlzTG9ja2luZygpKQogICAgICAgICAgICAgICAgX2xtLmxvYWRlZEZvclVw\nZGF0ZShzbSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGV4aXN0cy5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBsb2FkKE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMsCiAgICAgICAgRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoLCBpbnQgbG9ja0xldmVsLCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gamZldGNoID0g\nKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZldGNoOwoKICAgICAgICAvLyBn\nZXQgYSBjb25uZWN0aW9uLCBvciByZXVzZSBjdXJyZW50IG9uZQogICAgICAg\nIENvbm5lY3Rpb25JbmZvIGluZm8gPSAoQ29ubmVjdGlvbkluZm8pIGNvbnRl\neHQ7CiAgICAgICAgUmVzdWx0IHJlcyA9IG51bGw7CiAgICAgICAgaWYgKGlu\nZm8gIT0gbnVsbCkgewogICAgICAgICAgICAvLyBpZiBpbml0aWFsaXplKCkg\nZmFpbHMgdG8gbG9hZCByZXF1aXJlZCBmaWVsZHMsIHRoZW4gdGhpcyBtZXRo\nb2QKICAgICAgICAgICAgLy8gaXMgY2FsbGVkOyBtYWtlIHN1cmUgbm90IHRv\nIHRyeSB0byB1c2UgdGhlIGdpdmVuIHJlc3VsdCBpZiBpdCdzCiAgICAgICAg\nICAgIC8vIHRoZSBzYW1lIG9uZSB3ZSBqdXN0IGZhaWxlZCB0byBjb21wbGV0\nZWx5IGluaXRpYWxpemUoKSB3aXRoCiAgICAgICAgICAgIGlmIChpbmZvLnNt\nICE9IHNtKQogICAgICAgICAgICAgICAgcmVzID0gaW5mby5yZXN1bHQ7CiAg\nICAgICAgICAgIGluZm8uc20gPSBudWxsOwogICAgICAgIH0KICAgICAgICB0\ncnkgewogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGFuIGV4aXN0aW5nIHJl\nc3VsdCwgbG9hZCBhbGwgd2UgY2FuIGZyb20gaXQKICAgICAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBzbS5nZXRNZXRh\nRGF0YSgpOwogICAgICAgICAgICBpZiAocmVzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRjaCwgcmVzKTsKICAg\nICAgICAgICAgICAgIHJlbW92ZUxvYWRlZEZpZWxkcyhzbSwgZmllbGRzKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gaWYgdGhlIGluc3RhbmNl\nIGlzIGhvbGxvdyBhbmQgdGhlcmUncyBhIGN1c3RvbWl6ZWQKICAgICAgICAg\nICAgLy8gZ2V0IGJ5IGlkIG1ldGhvZCwgdXNlIGl0CiAgICAgICAgICAgIGlm\nIChzbS5nZXRMb2FkZWQoKS5sZW5ndGgoKSA9PSAwIAogICAgICAgICAgICAg\nICAgJiYgbWFwcGluZy5jdXN0b21Mb2FkKHNtLCB0aGlzLCBudWxsLCBqZmV0\nY2gpKQogICAgICAgICAgICAgICAgcmVtb3ZlTG9hZGVkRmllbGRzKHNtLCBm\naWVsZHMpOwoKICAgICAgICAgICAgLy8jIyMgc2VsZWN0IGlzIGtpbmQgb2Yg\nYSBiaWcgb2JqZWN0LCBhbmQgaW4gc29tZSBjYXNlcyB3ZSBkb24ndAogICAg\nICAgICAgICAvLyMjIyB1c2UgaXQuLi4gd291bGQgaXQgYmUgd29ydGggaXQg\ndG8gaGF2ZSBhIHNtYWxsIHNoZWxsIHNlbGVjdAogICAgICAgICAgICAvLyMj\nIyBvYmplY3QgdGhhdCBvbmx5IGNyZWF0ZXMgYSByZWFsIHNlbGVjdCB3aGVu\nIGFjdHVhbGx5IHVzZWQ/CgogICAgICAgICAgICBTZWxlY3Qgc2VsID0gX3Nx\nbC5uZXdTZWxlY3QoKTsKICAgICAgICAgICAgaWYgKHNlbGVjdChzZWwsIG1h\ncHBpbmcsIFNlbGVjdC5TVUJTX0VYQUNULCBzbSwgZmllbGRzLCBqZmV0Y2gs\nCiAgICAgICAgICAgICAgICBFYWdlckZldGNoTW9kZXMuRUFHRVJfSk9JTiwg\ndHJ1ZSwgZmFsc2UpKSB7CiAgICAgICAgICAgICAgICBzZWwud2hlcmVQcmlt\nYXJ5S2V5KHNtLmdldE9iamVjdElkKCksIG1hcHBpbmcsIHRoaXMpOwogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoImxvYWQ6ICIrbWFwcGluZy5n\nZXREZXNjcmliZWRUeXBlKCkrIiBvaWQ6ICIrc20uZ2V0T2JqZWN0SWQoKSk7\nIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzID0gc2Vs\nLmV4ZWN1dGUodGhpcywgamZldGNoLCBsb2NrTGV2ZWwpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAJaWYgKGlzRW1wdHlSZXN1\nbHQocmVzKSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgICAgIGxvYWQobWFwcGluZywgc20sIGpmZXRj\naCwgcmVzKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICAgICAgcmVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyBhbGxvdyB0aGUgZmll\nbGRzIHRvIGxvYWQgdGhlbXNlbHZlcyBpbmRpdmlkdWFsbHkgdG9vCiAgICAg\nICAgICAgIEZpZWxkTWFwcGluZ1tdIGZtcyA9IG1hcHBpbmcuZ2V0RmllbGRN\nYXBwaW5ncygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZt\ncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmaWVsZHMuZ2V0\nKGkpICYmICFzbS5nZXRMb2FkZWQoKS5nZXQoaSkpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoImxvYWQgZmllbGQ6ICciKyBm\nbXNbaV0uZ2V0TmFtZSgpICsgIicgZm9yIG9pZD0iK3NtLmdldE9iamVjdElk\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsiICIrbWFwcGluZy5n\nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBmbXNbaV0ubG9hZChzbSwgdGhpcywgamZldGNo\nLnRyYXZlcnNlSkRCQyhmbXNbaV0pKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgbWFwcGluZy5nZXRWZXJzaW9uKCkuYWZ0ZXJMb2FkKHNtLCB0\naGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRj\naCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBjbmZlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihjbmZlKTsKICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgdGhyb3cgU1FM\nRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3QsIGxvY2tMZXZlbCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgbGlzdCBm\nb3JtZWQgYnkgcmVtb3ZpbmcgYWxsIGxvYWRlZCBmaWVsZHMgZnJvbSB0aGUg\nZ2l2ZW4gb25lLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlTG9h\nZGVkRmllbGRzKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVs\nZHMpIHsKICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gZmllbGRzLmxl\nbmd0aCgpOyBpIDwgbGVuOyBpKyspCiAgICAgICAgICAgIGlmIChmaWVsZHMu\nZ2V0KGkpICYmIHNtLmdldExvYWRlZCgpLmdldChpKSkKICAgICAgICAgICAg\nICAgIGZpZWxkcy5jbGVhcihpKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVj\ndGlvbiBsb2FkQWxsKENvbGxlY3Rpb24gc21zLCBQQ1N0YXRlIHN0YXRlLCBp\nbnQgbG9hZCwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9i\namVjdCBjb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIEltcGxIZWxwZXIubG9h\nZEFsbChzbXMsIHRoaXMsIHN0YXRlLCBsb2FkLCBmZXRjaCwgY29udGV4dCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgYmVmb3JlU3RhdGVDaGFuZ2UoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSwgUENTdGF0ZSBmcm9tU3RhdGUsCiAgICAg\nICAgUENTdGF0ZSB0b1N0YXRlKSB7CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gZmx1c2goQ29sbGVjdGlvbiBzbXMpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAoX2Nvbm4gIT0gbnVsbCAmJiBfY29ubi5nZXRJbm5l\ncm1vc3REZWxlZ2F0ZSgpLmlzUmVhZE9ubHkoKSkKICAgICAgICAgICAgICAg\nIF9jb25uLnNldFJlYWRPbmx5KGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gZSkgewogICAgICAgIH0KICAgICAgICBpZiAoX2xvZy5p\nc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGZvciAoT3BlbkpQQVN0\nYXRlTWFuYWdlciBzbTogKENvbGxlY3Rpb248T3BlbkpQQVN0YXRlTWFuYWdl\ncj4pc21zKSB7CiAgICAgICAgICAgICAgICBfbG9nLnRyYWNlKCJmbHVzaDog\nIitzbS5nZXRQQ1N0YXRlKCkuZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAiIGZv\nciBvaWQ9IitzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gX2NvbmYuZ2V0VXBkYXRlTWFuYWdlcklu\nc3RhbmNlKCkuZmx1c2goc21zLCB0aGlzKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBjYW5jZWxBbGwoKSB7CiAgICAgICAgLy8gbm90ZSB0aGF0IHRo\naXMgbWV0aG9kIGRvZXMgbm90IGxvY2sgdGhlIGNvbnRleHQsIHNpbmNlCiAg\nICAgICAgLy8gd2Ugd2FudCB0byBhbGxvdyBhIGRpZmZlcmVudCB0aHJlYWQg\ndG8gYmUgYWJsZSB0byBjYW5jZWwgdGhlCiAgICAgICAgLy8gb3V0c3RhbmRp\nbmcgc3RhdGVtZW50IG9uIGEgZGlmZmVyZW50IGNvbnRleHQKCiAgICAgICAg\nQ29sbGVjdGlvbjxTdGF0ZW1lbnQ+IHN0bW50czsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKF9zdG1udHMpIHsKICAgICAgICAgICAgaWYgKF9zdG1udHMuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBzdG1udHMgPSBuZXcgQXJyYXlMaXN0PFN0YXRlbWVudD4oX3N0bW50\ncyk7CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yPFN0YXRlbWVudD4gaXRyID0gc3RtbnRzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgKChTdGF0ZW1lbnQp\nIGl0ci5uZXh0KCkpLmNhbmNlbCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAg\nICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2RpY3Qp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25P\nYmplY3RJZChPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBib29sZWFuIHByZUZs\ndXNoKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gc20uZ2V0TWV0\nYURhdGEoKTsKICAgICAgICBpZiAobWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9\nPSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAgICAgICAgICBy\nZXR1cm4gQXBwbGljYXRpb25JZHMuYXNzaWduKHNtLCB0aGlzLCBwcmVGbHVz\naCk7CgogICAgICAgIC8vIGRhdGFzdG9yZSBpZGVudGl0eQogICAgICAgIE9i\namVjdCB2YWwgPSBJbXBsSGVscGVyLmdlbmVyYXRlSWRlbnRpdHlWYWx1ZShf\nY3R4LCBtZXRhLAogICAgICAgICAgICBKYXZhVHlwZXMuTE9ORyk7CiAgICAg\nICAgaWYgKHZhbCA9PSBudWxsICYmIG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVn\neSgpICE9IFZhbHVlU3RyYXRlZ2llcy5OQVRJVkUpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgIHZhbCA9IGdldERhdGFTdG9yZUlkU2VxdWVuY2UobWV0YSkubmV4dChf\nY3R4LCBtZXRhKTsKICAgICAgICBzbS5zZXRPYmplY3RJZChuZXdEYXRhU3Rv\ncmVJZCh2YWwsIG1ldGEpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBhc3NpZ25GaWVsZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBpbnQgZmllbGQsCiAgICAgICAgYm9vbGVhbiBwcmVGbHVz\naCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gc20uZ2V0TWV0YURh\ndGEoKS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgT2JqZWN0IHZhbCA9IElt\ncGxIZWxwZXIuZ2VuZXJhdGVGaWVsZFZhbHVlKF9jdHgsIGZtZCk7CiAgICAg\nICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgc20uc3RvcmUoZmllbGQsIHZhbCk7CiAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICB9CgogICAgcHVibGljIENsYXNzPD8+IGdldE1hbmFnZWRU\neXBlKE9iamVjdCBvaWQpIHsKICAgICAgICBpZiAob2lkIGluc3RhbmNlb2Yg\nSWQpCiAgICAgICAgICAgIHJldHVybiAoKElkKSBvaWQpLmdldFR5cGUoKTsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3M8\nPz4gZ2V0RGF0YVN0b3JlSWRUeXBlKENsYXNzTWV0YURhdGEgbWV0YSkgewog\nICAgICAgIHJldHVybiBJZC5jbGFzczsKICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGNvcHlEYXRhU3RvcmVJZChPYmplY3Qgb2lkLCBDbGFzc01ldGFEYXRh\nIG1ldGEpIHsKICAgICAgICBJZCBpZCA9IChJZCkgb2lkOwogICAgICAgIHJl\ndHVybiBuZXcgSWQobWV0YS5nZXREZXNjcmliZWRUeXBlKCksIGlkLmdldElk\nKCksIGlkLmhhc1N1YmNsYXNzZXMoKSk7CiAgICB9CgogICAgcHVibGljIE9i\namVjdCBuZXdEYXRhU3RvcmVJZChPYmplY3QgdmFsLCBDbGFzc01ldGFEYXRh\nIG1ldGEpIHsKICAgICAgICByZXR1cm4gSWQubmV3SW5zdGFuY2UobWV0YS5n\nZXREZXNjcmliZWRUeXBlKCksIHZhbCk7CiAgICB9CgogICAgcHVibGljIElk\nIG5ld0RhdGFTdG9yZUlkKGxvbmcgaWQsIENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBib29sZWFuIHN1YnMpIHsKICAgICAgICByZXR1cm4gbmV3IElkKG1hcHBp\nbmcuZ2V0RGVzY3JpYmVkVHlwZSgpLCBpZCwgc3Vicyk7CiAgICB9CgogICAg\ncHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVFeHRlbnQoQ2xh\nc3NNZXRhRGF0YSBtZXRhLAogICAgICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xh\nc3NlcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcgPSAoQ2xhc3NNYXBwaW5nKSBtZXRhOwogICAg\nICAgIGZpbmFsIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzOwogICAgICAgIGlm\nIChzdWJjbGFzc2VzKQogICAgICAgICAgICBtYXBwaW5ncyA9IG1hcHBpbmcu\nZ2V0SW5kZXBlbmRlbnRBc3NpZ25hYmxlTWFwcGluZ3MoKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIG1hcHBpbmdzID0gbmV3IENsYXNzTWFwcGluZ1td\nIHsgbWFwcGluZyB9OwoKICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlcltd\nIHJvcHMgPSBudWxsOwogICAgICAgIGZpbmFsIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gamZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGZldGNo\nOwogICAgICAgIGlmIChqZmV0Y2guZ2V0U3ViY2xhc3NGZXRjaE1vZGUobWFw\ncGluZykgIT0gamZldGNoLkVBR0VSX0pPSU4pCiAgICAgICAgICAgIHJvcHMg\nPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbbWFwcGluZ3MubGVuZ3RoXTsK\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGN1c3Rv\nbSBsb2FkcwogICAgICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciByb3A7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHJvcCA9IG1hcHBpbmdzW2ld\nLmN1c3RvbUxvYWQodGhpcywgc3ViY2xhc3NlcywgamZldGNoLCAwLAogICAg\nICAgICAgICAgICAgICAgIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAg\nICAgIGlmIChyb3AgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChyb3BzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHJvcHMg\nPSBuZXcgUmVzdWx0T2JqZWN0UHJvdmlkZXJbbWFwcGluZ3MubGVuZ3RoXTsK\nICAgICAgICAgICAgICAgICAgICByb3BzW2ldID0gcm9wOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB3ZSdy\nZSBzZWxlY3RpbmcgaW5kZXBlbmRlbnQgbWFwcGluZ3Mgc2VwYXJhdGVseSBv\nciBoYXZlCiAgICAgICAgICAgIC8vIGN1c3RvbSBsb2FkcywgZG8gaW5kaXZp\nZHVhbCBzZWxlY3RzIGZvciBlYWNoIGNsYXNzCiAgICAgICAgICAgIHJvcCA9\nIG51bGw7CiAgICAgICAgICAgIGlmIChyb3BzICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAocm9wc1tpXSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAgICAgU2VsZWN0IHNlbCA9IF9zcWwubmV3U2VsZWN0KCk7\nCiAgICAgICAgICAgICAgICAgICAgc2VsLnNldExSUyh0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoImV4ZWN1dGVFeHRl\nbnQ6ICIrbWFwcGluZ3NbaV0uZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgc2VsLmxvZ0VhZ2VyUmVsYXRpb25zKCk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEJpdFNl\ndCBwYWdlZCA9IHNlbGVjdEV4dGVudChzZWwsIG1hcHBpbmdzW2ldLCBqZmV0\nY2gsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmNsYXNzZXMpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChwYWdlZCA9PSBudWxsKQogICAgICAgICAg\nICAgICAgICAgICAgICByb3BzW2ldID0gbmV3IEluc3RhbmNlUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIoc2VsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbWFwcGluZ3NbaV0sIHRoaXMsIGpmZXRjaCk7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByb3BzW2ldID0gbmV3\nIFBhZ2luZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKHNlbCwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG1hcHBpbmdzW2ldLCB0aGlzLCBqZmV0Y2gsIHBh\nZ2VkLCBMb25nLk1BWF9WQUxVRSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBpZiAocm9wcy5sZW5ndGggPT0gMSkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gcm9wc1swXTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wcyk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBlcmZvcm0gYSB1bmlvbiBvbiBh\nbGwgaW5kZXBlbmRlbnQgY2xhc3NlcwogICAgICAgICAgICBVbmlvbiB1bmlv\nbiA9IF9zcWwubmV3VW5pb24obWFwcGluZ3MubGVuZ3RoKTsKICAgICAgICAg\nICAgdW5pb24uc2V0TFJTKHRydWUpOwogICAgICAgICAgICBmaW5hbCBCaXRT\nZXRbXSBwYWdlZCA9IG5ldyBCaXRTZXRbbWFwcGluZ3MubGVuZ3RoXTsKICAg\nICAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3RvcigpIHsK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNlbGVjdChTZWxlY3Qgc2Vs\nLCBpbnQgaWR4KSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZWRbaWR4XSA9\nIHNlbGVjdEV4dGVudChzZWwsIG1hcHBpbmdzW2lkeF0sIGpmZXRjaCwKICAg\nICAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3Nlcyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gdXNpbmcg\ncGFnaW5nIHJvcCBpZiBhbnkgdW5pb24gZWxlbWVudCBoYXMgcGFnZWQgZmll\nbGRzCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcGFnZWQubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlZFtpXSAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUGFnaW5nUmVz\ndWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdzLAogICAgICAgICAg\nICAgICAgICAgICAgICBKREJDU3RvcmVNYW5hZ2VyLnRoaXMsIGpmZXRjaCwg\ncGFnZWQsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gbmV3IEluc3RhbmNlUmVzdWx0T2JqZWN0UHJvdmlkZXIo\ndW5pb24sIG1hcHBpbmdzWzBdLCB0aGlzLAogICAgICAgICAgICAgICAgamZl\ndGNoKTsKICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAg\nICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5nZXRTdG9yZShzZSwgX2Rp\nY3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCB0\naGUgZ2l2ZW4gbWFwcGluZyBmb3IgdXNlIGluIGFuIGV4dGVudCwgcmV0dXJu\naW5nIHBhZ2VkIGZpZWxkcy4KICAgICAqLwogICAgcHJpdmF0ZSBCaXRTZXQg\nc2VsZWN0RXh0ZW50KFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5n\nLAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGJvb2xl\nYW4gc3ViY2xhc3NlcykgewogICAgICAgIGludCBzdWJzID0gKHN1YmNsYXNz\nZXMpID8gU2VsZWN0LlNVQlNfSk9JTkFCTEUgOiBTZWxlY3QuU1VCU19OT05F\nOwogICAgICAgIC8vIGRlY2lkZSBiZXR3ZWVuIHBhZ2luZyBhbmQgc3RhbmRh\ncmQgaXRlcmF0aW9uCiAgICAgICAgQml0U2V0IHBhZ2VkID0gUGFnaW5nUmVz\ndWx0T2JqZWN0UHJvdmlkZXIuZ2V0UGFnZWRGaWVsZHMoc2VsLCBtYXBwaW5n\nLAogICAgICAgICAgICB0aGlzLCBmZXRjaCwgSkRCQ0ZldGNoQ29uZmlndXJh\ndGlvbi5FQUdFUl9QQVJBTExFTCwKICAgICAgICAgICAgTG9uZy5NQVhfVkFM\nVUUpOwogICAgICAgIGlmIChwYWdlZCA9PSBudWxsKQogICAgICAgICAgICBz\nZWwuc2VsZWN0SWRlbnRpZmllcihtYXBwaW5nLCBzdWJzLCB0aGlzLCBmZXRj\naCwKICAgICAgICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFH\nRVJfUEFSQUxMRUwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VsLnNl\nbGVjdElkZW50aWZpZXIobWFwcGluZywgc3VicywgdGhpcywgZmV0Y2gsCiAg\nICAgICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX0pP\nSU4pOwogICAgICAgIHJldHVybiBwYWdlZDsKICAgIH0KCiAgICBwdWJsaWMg\nU3RvcmVRdWVyeSBuZXdRdWVyeShTdHJpbmcgbGFuZ3VhZ2UpIHsKICAgICAg\nICBFeHByZXNzaW9uUGFyc2VyIGVwID0gUXVlcnlMYW5ndWFnZXMucGFyc2Vy\nRm9yTGFuZ3VhZ2UobGFuZ3VhZ2UpOwogICAgICAgIGlmIChlcCAhPSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbmV3IEpEQkNTdG9yZVF1ZXJ5KHRoaXMs\nIGVwKTsKICAgICAgICBpZiAoUXVlcnlMYW5ndWFnZXMuTEFOR19TUUwuZXF1\nYWxzKGxhbmd1YWdlKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTUUxTdG9y\nZVF1ZXJ5KHRoaXMpOwogICAgICAgIGlmIChRdWVyeUxhbmd1YWdlcy5MQU5H\nX1BSRVBBUkVEX1NRTC5lcXVhbHMobGFuZ3VhZ2UpKQogICAgICAgICAgICBy\nZXR1cm4gbmV3IFByZXBhcmVkU1FMU3RvcmVRdWVyeSh0aGlzKTsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1\ncmF0aW9uIG5ld0ZldGNoQ29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1\ncm4gbmV3IEpEQkNGZXRjaENvbmZpZ3VyYXRpb25JbXBsKCk7CiAgICB9Cgog\nICAgcHVibGljIFNlcSBnZXREYXRhU3RvcmVJZFNlcXVlbmNlKENsYXNzTWV0\nYURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5U3Ry\nYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMuTkFUSVZFCiAgICAgICAgICAg\nIHx8IG1ldGEuZ2V0SWRlbnRpdHlTdHJhdGVneSgpID09IFZhbHVlU3RyYXRl\nZ2llcy5OT05FKQogICAgICAgICAgICByZXR1cm4gX2NvbmYuZ2V0U2VxdWVu\nY2VJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAg\nIHB1YmxpYyBTZXEgZ2V0VmFsdWVTZXF1ZW5jZShGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGNsb3NlKCkgewogICAgICAgIGlmIChfY29ubiAhPSBudWxsKQogICAg\nICAgICAgICBfY29ubi5mcmVlKCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8v\nLwogICAgLy8gVXRpbGl0aWVzCiAgICAvLy8vLy8vLy8vLy8vCgogICAgLyoq\nCiAgICAgKiBDb25uZWN0IHRvIHRoZSBkYi4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGNvbm5lY3QoYm9vbGVhbiByZWYpIHsKICAgICAgICBfY3R4Lmxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBjb25uZWN0IGlm\nIHRoZSBjb25uZWN0aW9uIGlzIGN1cnJlbnRseSBudWxsLCBvciBpZgogICAg\nICAgICAgICAvLyB0aGUgY29ubmVjdGlvbiBoYXMgYmVlbiBjbG9zZWQgb3V0\nIGZyb20gdW5kZXIgdXMKICAgICAgICAgICAgaWYgKF9jb25uID09IG51bGwp\nCiAgICAgICAgICAgICAgICBfY29ubiA9IGNvbm5lY3RJbnRlcm5hbCgpOwog\nICAgICAgICAgICBpZiAocmVmKQogICAgICAgICAgICAgICAgX2Nvbm4ucmVm\nKCk7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAg\nICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIF9kaWN0\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfY3R4LnVubG9j\naygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbm5lY3Qg\ndG8gdGhlIGRhdGFiYXNlLiBUaGlzIG1ldGhvZCBpcyBzZXBhcmF0ZWQgb3V0\nIHNvIHRoYXQgaXQKICAgICAqIGNhbiBiZSBvdmVycmlkZGVuLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgUmVmQ291bnRDb25uZWN0aW9uIGNvbm5lY3RJbnRl\ncm5hbCgpIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBD\nb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKHJlZkNvdW50Q29u\nbmVjdGlvbkltcGwsIEpEQkNTdG9yZU1hbmFnZXIudGhpcywgX2RzLmdldENv\nbm5lY3Rpb24oKSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBDb25uZWN0aW9u\nIGdldE5ld0Nvbm5lY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgcmV0dXJuIGNvbm5lY3RJbnRlcm5hbCgpOwogICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2Vw\ndGlvbnMuZ2V0U3RvcmUoZSwgX2RpY3QpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEZpbmQgdGhlIG9iamVjdCB3aXRoIHRoZSBnaXZlbiBv\naWQuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lk\nLCBWYWx1ZU1hcHBpbmcgdm0sIAogICAgICAgIEpEQkNGZXRjaENvbmZpZ3Vy\nYXRpb24gZmV0Y2gpIHsKICAgICAgICBpZiAob2lkID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChfbG9nLmlzVHJhY2VF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgX2xvZy50cmFjZSgiZmluZDogb2lk\nPSIrb2lkKyIgIit2bS5nZXREZWNsYXJlZFR5cGVNYXBwaW5nKCkuZ2V0RGVz\nY3JpYmVkVHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0IHBjID0g\nX2N0eC5maW5kKG9pZCwgZmV0Y2gsIG51bGwsIG51bGwsIDApOwogICAgICAg\nIGlmIChwYyA9PSBudWxsICYmIHZtICE9IG51bGwpIHsKICAgICAgICAgICAg\nT3JwaGFuZWRLZXlBY3Rpb24gYWN0aW9uID0gX2NvbmYuZ2V0T3JwaGFuZWRL\nZXlBY3Rpb25JbnN0YW5jZSgpOwogICAgICAgICAgICBwYyA9IGFjdGlvbi5v\ncnBoYW4ob2lkLCBudWxsLCB2bSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBwYzsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIG9iamVjdCBp\nbiB0aGUgY3VycmVudCByb3cgb2YgdGhlIGdpdmVuIHJlc3VsdC4KICAgICAq\nLwogICAgcHVibGljIE9iamVjdCBsb2FkKENsYXNzTWFwcGluZyBtYXBwaW5n\nLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIEJpdFNl\ndCBleGNsdWRlLCBSZXN1bHQgcmVzdWx0KSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoIW1hcHBpbmcuaXNNYXBwZWQoKSkKICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgi\ndmlydHVhbC1tYXBwaW5nIiwgCiAgICAgICAgICAgICAgICBtYXBwaW5nKSk7\nCgogICAgICAgIC8vIGdldCB0aGUgb2JqZWN0IGlkIGZvciB0aGUgcm93OyBi\nYXNlIGNsYXNzIHNlbGVjdHMgcGsgY29sdW1ucwogICAgICAgIENsYXNzTWFw\ncGluZyBiYXNlID0gbWFwcGluZzsKICAgICAgICB3aGlsZSAoYmFzZS5nZXRK\nb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQogICAgICAg\nICAgICBiYXNlID0gYmFzZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBp\nbmcoKTsKICAgICAgICBPYmplY3Qgb2lkID0gYmFzZS5nZXRPYmplY3RJZCh0\naGlzLCByZXN1bHQsIG51bGwsIHRydWUsIG51bGwpOwogICAgICAgIGlmIChv\naWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIENvbm5lY3Rpb25JbmZvIGluZm8gPSBuZXcgQ29ubmVjdGlvbkluZm8oKTsK\nICAgICAgICBpbmZvLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICBpbmZvLm1h\ncHBpbmcgPSBtYXBwaW5nOwoKICAgICAgICAvLyBpZiBpbnZlcnNlIHJlbGF0\naW9uIGlzIGtub3duLCBleGNsdWRlIGxvYWRpbmcgZHVyaW5nIGZpbmQKICAg\nICAgICBleGNsdWRlID0gZXhjbHVkZUludmVyc2VSZWxhdGlvbihtYXBwaW5n\nLCBpbmZvLCBleGNsdWRlKTsKICAgICAgICByZXR1cm4gX2N0eC5maW5kKG9p\nZCwgZmV0Y2gsIGV4Y2x1ZGUsIGluZm8sIDApOwogICAgfQoKICAgIHByaXZh\ndGUgQml0U2V0IGV4Y2x1ZGVJbnZlcnNlUmVsYXRpb24oQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsCiAgICAgICAgQ29ubmVjdGlvbkluZm8gaW5mbywgQml0U2V0\nIGV4Y2x1ZGUpIHsKICAgICAgICBGaWVsZE1hcHBpbmcgaW52ZXJzZSA9IGlu\nZm8ucmVzdWx0LmdldE1hcHBlZEJ5RmllbGRNYXBwaW5nKCk7CiAgICAgICAg\naWYgKGludmVyc2UgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVsZE1hcHBp\nbmdbXSBmbXMgPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7\nCiAgICAgICAgICAgIGlmIChleGNsdWRlID09IG51bGwpCiAgICAgICAgICAg\nICAgICBleGNsdWRlID0gbmV3IEJpdFNldChmbXMubGVuZ3RoKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gaW52ZXJzZSkgewogICAg\nICAgICAgICAgICAgICAgIGV4Y2x1ZGUuc2V0KGZtc1tpXS5nZXRJbmRleCgp\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhj\nbHVkZTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWQgdGhlIGdpdmVuIHN0\nYXRlIG1hbmFnZXIgd2l0aCBkYXRhIGZyb20gdGhlIHJlc3VsdCBzZXQuIE9u\nbHkKICAgICAqIG1hcHBpbmdzIG9yaWdpbmFsbHkgc2VsZWN0ZWQgd2lsbCBi\nZSBsb2FkZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBsb2FkKENsYXNz\nTWFwcGluZyBtYXBwaW5nLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLAogICAg\nICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIFJlc3VsdCByZXMp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIEZpZWxkTWFwcGluZyBl\nYWdlclRvTWFueSA9IGxvYWQobWFwcGluZywgc20sIGZldGNoLCByZXMsIG51\nbGwpOwogICAgICAgIGlmIChlYWdlclRvTWFueSAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgICAgIF9sb2cudHJhY2UoIkxvYWRpbmcgZWFnZXIgdG9NYW55OiAiK2Vh\nZ2VyVG9NYW55LmdldE5hbWUoKSsiIGZvciAiK21hcHBpbmcpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGVhZ2VyVG9NYW55LmxvYWRFYWdlckpvaW4o\nc20sIHRoaXMsIGZldGNoLnRyYXZlcnNlSkRCQyhlYWdlclRvTWFueSksCiAg\nICAgICAgICAgICAgICByZXMpOwogICAgICAgIH0KICAgICAgICBpZiAoX2Fj\ndGl2ZSAmJiBfbG0gIT0gbnVsbCAmJiByZXMuaXNMb2NraW5nKCkpCiAgICAg\nICAgICAgIF9sbS5sb2FkZWRGb3JVcGRhdGUoc20pOwogICAgfQoKICAgIC8q\nKgogICAgICogTG9hZCB0aGUgZmllbGRzIG9mIHRoZSBnaXZlbiBtYXBwaW5n\nLiBSZXR1cm4gYW55IHRvLW1hbnkgZWFnZXIgZmllbGQKICAgICAqIHdpdGhv\ndXQgbG9hZGluZyBpdC4KICAgICAqLwogICAgcHJpdmF0ZSBGaWVsZE1hcHBp\nbmcgbG9hZChDbGFzc01hcHBpbmcgbWFwcGluZywgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nLCBSZXN1bHQgcmVzLCBGaWVsZE1hcHBpbmcgZWFnZXJUb01hbnkpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG1hcHBpbmcu\nY3VzdG9tTG9hZChzbSwgdGhpcywgZmV0Y2gsIHJlcykpCiAgICAgICAgICAg\nIHJldHVybiBlYWdlclRvTWFueTsKCiAgICAgICAgLy8gbG9hZCBzdXBlcmNs\nYXNzIGRhdGE7IGJhc2UgY2xhc3MgbG9hZHMgdmVyc2lvbgogICAgICAgIENs\nYXNzTWFwcGluZyBwYXJlbnQgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdXBl\ncmNsYXNzTWFwcGluZygpOwogICAgICAgIGlmIChwYXJlbnQgIT0gbnVsbCkK\nICAgICAgICAgICAgZWFnZXJUb01hbnkgPSBsb2FkKHBhcmVudCwgc20sIGZl\ndGNoLCByZXMsIGVhZ2VyVG9NYW55KTsKICAgICAgICBlbHNlIGlmIChzbS5n\nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgbWFwcGluZy5nZXRW\nZXJzaW9uKCkubG9hZChzbSwgdGhpcywgcmVzKTsKCiAgICAgICAgLy8gbG9h\nZCB1bmxvYWRlZCBmaWVsZHMKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMg\nPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAg\nT2JqZWN0IGVyZXMsIHByb2Nlc3NlZDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZm1z\nW2ldLmlzUHJpbWFyeUtleSgpIHx8IHNtLmdldExvYWRlZCgpLmdldChmbXNb\naV0uZ2V0SW5kZXgoKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBlYWdlciByZXN1\nbHQsIGFuZCBpZiBub3QgcHJlc2VudCBkbyBzdGFuZGFyZCBsb2FkCiAgICAg\nICAgICAgIGVyZXMgPSByZXMuZ2V0RWFnZXIoZm1zW2ldKTsKICAgICAgICAg\nICAgcmVzLnN0YXJ0RGF0YVJlcXVlc3QoZm1zW2ldKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgaWYgKGVyZXMgPT0gcmVzKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGVhZ2VyVG9NYW55ID09IG51bGwgJiYgZm1z\nW2ldLmlzRWFnZXJTZWxlY3RUb01hbnkoKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgZWFnZXJUb01hbnkgPSBmbXNbaV07CiAgICAgICAgICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmbXNbaV0ubG9hZEVh\nZ2VySm9pbihzbSwgdGhpcywgCiAgICAgICAgICAgICAgICAgICAgICAgIAlm\nZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgcmVzKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSBpZiAoZXJlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgcHJvY2Vzc2VkID0gZm1zW2ldLmxvYWRFYWdlclBhcmFsbGVsKHNt\nLCB0aGlzLCAKICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VK\nREJDKGZtc1tpXSksIGVyZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChw\ncm9jZXNzZWQgIT0gZXJlcykKICAgICAgICAgICAgICAgICAgICAgICAgcmVz\nLnB1dEVhZ2VyKGZtc1tpXSwgcHJvY2Vzc2VkKTsKICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBsYXp5RW1i\nZWRkYWJsZSA9IGZtc1tpXS5nZXRWYWx1ZU1hcHBpbmcoKS5pc0VtYmVkZGVk\nKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgZm1zW2ldLmdldEVtYmVk\nZGVkTWV0YURhdGEoKSAhPSBudWxsICYmIAogICAgICAgICAgICAgICAgICAg\nICAgICBmZXRjaC5yZXF1aXJlc0ZldGNoKGZtc1tpXSkgPT0gRmV0Y2hDb25m\naWd1cmF0aW9uLkZFVENIX05PTkU7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKCFsYXp5RW1iZWRkYWJsZSkgICAgCiAgICAgICAgICAgICAgICAgICAgICAg\nIGZtc1tpXS5sb2FkKHNtLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZm1z\nW2ldKSwgcmVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIHJlcy5lbmREYXRhUmVxdWVzdCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBlYWdl\nclRvTWFueTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvciBpbXBsZW1lbnRh\ndGlvbiB1c2Ugb25seS4KICAgICAqIFJldHVybiBhIHNlbGVjdCBmb3IgdGhl\nIHByb3BlciBtYXBwaW5ncy4gUmV0dXJuIG51bGwgaWYgbm8gc2VsZWN0IGlz\nCiAgICAgKiBuZWVkZWQuIFRoZSBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUg\nY29tcGxlbWVudGFyeSB0byB0aGUgbG9hZCBtZXRob2RzLgogICAgICoKICAg\nICAqIEBwYXJhbSBzZWwgc2VsZWN0IHRvIGJ1aWxkIG9uCiAgICAgKiBAcGFy\nYW0gbWFwcGluZyB0aGUgbWFwcGluZyBmb3IgdGhlIGJhc2UgdHlwZSB0byBz\nZWxlY3QgZm9yCiAgICAgKiBAcGFyYW0gc3VicyB3aGV0aGVyIHRoZSBzZWxl\nY3QgbWlnaHQgaW5jbHVkZSBzdWJjbGFzc2VzIG9mIHRoZQogICAgICogZ2l2\nZW4gbWFwcGluZwogICAgICogQHBhcmFtIHNtIHN0YXRlIG1hbmFnZXIgaWYg\nYW4gaW5zdGFuY2UgaXMgYmVpbmcgbG9hZGVkIG9yCiAgICAgKiBpbml0aWFs\naXplZCwgZWxzZSBudWxsCiAgICAgKiBAcGFyYW0gZmllbGRzIGlmIGEgc3Rh\ndGUgbWFuYWdlciBpcyBiZWluZyBsb2FkZWQsIHRoZSBzZXQgb2YKICAgICAq\nIGZpZWxkcyB0aGF0IG11c3QgYmUgbG9hZGVkIGluIG9yZGVyLCBlbHNlIG51\nbGwKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlv\nbjsgdXNlZCBpZiBubyBzcGVjaWZpYyBmaWVsZHMKICAgICAqIG11c3QgYmUg\nbG9hZGVkLCBhbmQgdXNlZCB3aGVuIHNlbGVjdGluZyByZWxhdGlvbnMKICAg\nICAqIEBwYXJhbSBlYWdlciBlYWdlciBmZXRjaCBtb2RlIHRvIHVzZQogICAg\nICogQHBhcmFtIGlkZW50IHdoZXRoZXIgdG8gc2VsZWN0IHByaW1hcnkga2V5\nIGNvbHVtbnMgYXMgZGlzdGluY3QKICAgICAqIGlkZW50aWZpZXJzCiAgICAg\nKiBAcGFyYW0gb3V0ZXIgd2hldGhlciB3ZSdyZSBvdXRlci1qb2luaW5nIHRv\nIHRoaXMgdHlwZQogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBzZWxlY3Qg\naXMgcmVxdWlyZWQsIGZhbHNlIG90aGVyd2lzZQogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBzZWxlY3QoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIGludCBzdWJzLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIg\nc20sIEJpdFNldCBmaWVsZHMsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsCiAgICAgICAgaW50IGVhZ2VyLCBib29sZWFuIGlkZW50LCBib29sZWFu\nIG91dGVyKSB7CiAgICAgICAgLy8gYWRkIGNsYXNzIGNvbmRpdGlvbnMgc28g\ndGhhdCB0aGV5J3JlIGNsb25lZCBmb3IgYW55IGJhdGNoZWQgc2VsZWN0cwog\nICAgICAgIGJvb2xlYW4gam9pbmVkU3VwZXJzID0gZmFsc2U7ICAgIAogICAg\nICAgIGlmKG5lZWRDbGFzc0NvbmRpdGlvbihtYXBwaW5nLCBzdWJzLCBzbSkp\nIHsKICAgICAgICAgICAgam9pbmVkU3VwZXJzID0gZ2V0Sm9pbmVkU3VwZXJz\nKHNlbCwgbWFwcGluZywgc3Vicywgb3V0ZXIpOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICAvLyBjcmVhdGUgYWxsIG91ciBlYWdlciBzZWxlY3RzIHNv\nIHRoYXQgdGhvc2UgZmllbGRzIGFyZSByZXNlcnZlZAogICAgICAgIC8vIGFu\nZCBjYW5ub3QgYmUgcmV1c2VkIGR1cmluZyB0aGUgYWN0dWFsIGVhZ2VyIHNl\nbGVjdCBwcm9jZXNzLAogICAgICAgIC8vIHByZXZlbnRpbmcgaW5maW5pdGUg\ncmVjdXJzaW9uCiAgICAgICAgZWFnZXIgPSBNYXRoLm1pbihlYWdlciwgZmV0\nY2guZ2V0RWFnZXJGZXRjaE1vZGUoKSk7CiAgICAgICAgRmllbGRNYXBwaW5n\nIGVhZ2VyVG9NYW55ID0gY3JlYXRlRWFnZXJTZWxlY3RzKHNlbCwgbWFwcGlu\nZywgc20sIGZpZWxkcywKICAgICAgICAgICAgZmV0Y2gsIGVhZ2VyKTsKCiAg\nICAgICAgLy8gc2VsZWN0IGFsbCBiYXNlIGNsYXNzIG1hcHBpbmdzOyBkbyB0\naGlzIGFmdGVyIGJhdGNoaW5nIHNvIHRoYXQKICAgICAgICAvLyB0aGUgam9p\nbnMgbmVlZGVkIGJ5IHRoZXNlIHNlbGVjdHMgZG9uJ3QgZ2V0IGluIHRoZSBX\nSEVSRSBjbGF1c2UKICAgICAgICAvLyBvZiB0aGUgYmF0Y2hlZCBzZWxlY3Rz\nCiAgICAgICAgaW50IHNlbGQgPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBt\nYXBwaW5nLCBtYXBwaW5nLCBzbSwgZmllbGRzLAogICAgICAgICAgICBmZXRj\naCwgZWFnZXIsIGVhZ2VyVG9NYW55LCBpZGVudCwgam9pbmVkU3VwZXJzKTsK\nCiAgICAgICAgLy8gc2VsZWN0IGVhZ2VyIHRvLW1hbnkgcmVsYXRpb25zIGxh\nc3QgYmVjYXVzZSBkdXJpbmcgbG9hZCB0aGV5CiAgICAgICAgLy8gYWR2YW5j\nZSB0aGUgcmVzdWx0IHNldCBhbmQgY291bGQgZXhoYXVzdCBpdCwgc28gbm8g\nb3RoZXIgbWFwcGluZ3MKICAgICAgICAvLyBjYW4gbG9hZCBhZnRlcndvcmRz\nCiAgICAgICAgaWYgKGVhZ2VyVG9NYW55ICE9IG51bGwpCiAgICAgICAgICAg\nIGVhZ2VyVG9NYW55LnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCB0aGlzLCAK\nICAgICAgICAgICAgICAgIGZldGNoLnRyYXZlcnNlSkRCQyhlYWdlclRvTWFu\neSksIGVhZ2VyKTsKCiAgICAgICAgLy8gb3B0aW9uYWxseSBzZWxlY3Qgc3Vi\nY2xhc3MgbWFwcGluZ3MKICAgICAgICBpZiAoc3VicyA9PSBTZWxlY3QuU1VC\nU19KT0lOQUJMRSB8fCBzdWJzID09IFNlbGVjdC5TVUJTX0FOWV9KT0lOQUJM\nRSkKICAgICAgICAgICAgc2VsZWN0U3ViY2xhc3NNYXBwaW5ncyhzZWwsIG1h\ncHBpbmcsIHNtLCBmZXRjaCk7CiAgICAgICAgaWYgKHNtICE9IG51bGwpCiAg\nICAgICAgICAgIHNlbC5zZXREaXN0aW5jdChmYWxzZSk7CiAgICAgICAgcmV0\ndXJuIHNlbGQgPiAwOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBnZXRK\nb2luZWRTdXBlcnMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcs\nIGludCBzdWJzLCBib29sZWFuIG91dGVyKSB7CiAgICAgICAgbG9hZFN1YmNs\nYXNzZXMobWFwcGluZyk7IAogICAgICAgIEpvaW5zIGpvaW5zID0gKG91dGVy\nKSA/IHNlbC5uZXdPdXRlckpvaW5zKCkgOiBudWxsOwogICAgICAgIHJldHVy\nbiBtYXBwaW5nLmdldERpc2NyaW1pbmF0b3IoKS5hZGRDbGFzc0NvbmRpdGlv\nbnMoc2VsLCBzdWJzID09IFNlbGVjdC5TVUJTX0pPSU5BQkxFLCBqb2lucyk7\nCiAgICB9CiAgICAKICAgIHByaXZhdGUgYm9vbGVhbiBuZWVkQ2xhc3NDb25k\naXRpb24oQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJzLAogICAgICAg\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBib29sZWFuIHJl\ndFZhbCA9IGZhbHNlOwogICAgICAgIGlmKHNtID09IG51bGwgfHwgc20uZ2V0\nUENTdGF0ZSgpID09IFBDU3RhdGUuVFJBTlNJRU5UKSB7CiAgICAgICAgICAg\nIGlmKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgfHwgc3VicyA9PSBT\nZWxlY3QuU1VCU19OT05FKSB7CiAgICAgICAgICAgICAgICByZXRWYWwgPSB0\ncnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgaWYgKG1hcHBpbmcuZ2V0RGlzY3JpbWluYXRvcigpICE9IG51\nbGwKICAgICAgICAgICAgICAgICAgICAmJiBTdXBlcmNsYXNzRGlzY3JpbWlu\nYXRvclN0cmF0ZWd5LmNsYXNzLmlzSW5zdGFuY2UobWFwcGluZy5nZXREaXNj\ncmltaW5hdG9yKCkuZ2V0U3RyYXRlZ3koKSkKICAgICAgICAgICAgICAgICAg\nICAmJiBtYXBwaW5nLmdldE1hcHBpbmdSZXBvc2l0b3J5KCkuZ2V0Q29uZmln\ndXJhdGlvbigpLmdldENvbXBhdGliaWxpdHlJbnN0YW5jZSgpCiAgICAgICAg\nICAgICAgICAgICAgICAgIC5nZXRTdXBlcmNsYXNzRGlzY3JpbWluYXRvclN0\ncmF0ZWd5QnlEZWZhdWx0KCkpIHsKICAgICAgICAgICAgICAgICAgICByZXRW\nYWwgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiByZXRWYWw7CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogTWFyayB0aGUgZmllbGRzIG9mIHRoaXMgbWFwcGluZyBh\ncyByZXNlcnZlZCBzbyB0aGF0IGVhZ2VyIGZldGNoZXMgY2FuJ3QKICAgICAq\nIGdldCBpbnRvIGluZmluaXRlIHJlY3Vyc2l2ZSBzaXR1YXRpb25zLgogICAg\nICovCiAgICBwcml2YXRlIEZpZWxkTWFwcGluZyBjcmVhdGVFYWdlclNlbGVj\ndHMoU2VsZWN0IHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBpbnQgZWFnZXIpIHsK\nICAgICAgICBpZiAobWFwcGluZyA9PSBudWxsIHx8IGVhZ2VyID09IEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgIEZpZWxkTWFwcGluZyBlYWdlclRvTWFueSA9\nIGNyZWF0ZUVhZ2VyU2VsZWN0cyhzZWwsIAogICAgICAgICAgICBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpLCBzbSwgZmllbGRz\nLCBmZXRjaCwgZWFnZXIpOwoKICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMg\nPSBtYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAg\nYm9vbGVhbiBpbkVhZ2VySm9pbiA9IHNlbC5oYXNFYWdlckpvaW4oZmFsc2Up\nOwogICAgICAgIGludCBzZWxzOwogICAgICAgIGludCBqdHlwZTsKICAgICAg\nICBpbnQgbW9kZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICBtb2RlID0gZm1zW2ldLmdldEVh\nZ2VyRmV0Y2hNb2RlKCk7CiAgICAgICAgICAgIGlmIChtb2RlID09IGZldGNo\nLkVBR0VSX05PTkUpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgaWYgKCFyZXF1aXJlc1NlbGVjdChmbXNbaV0sIHNtLCBmaWVsZHMs\nIGZldGNoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgLy8gdHJ5IHRvIHNlbGVjdCB3aXRoIGpvaW4gZmlyc3QKICAgICAgICAg\nICAganR5cGUgPSAoZm1zW2ldLmdldE51bGxWYWx1ZSgpID09IGZtc1tpXS5O\nVUxMX0VYQ0VQVElPTikgCiAgICAgICAgICAgICAgICA/IHNlbC5FQUdFUl9J\nTk5FUiA6IHNlbC5FQUdFUl9PVVRFUjsKICAgICAgICAgICAgaWYgKG1vZGUg\nIT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwgJiYgIWZtc1tpXS5pc0VhZ2VyU2Vs\nZWN0VG9NYW55KCkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5zdXBwb3J0\nc1NlbGVjdChzZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4gMAogICAg\nICAgICAgICAgICAgJiYgc2VsLmVhZ2VyQ2xvbmUoZm1zW2ldLCBqdHlwZSwg\nZmFsc2UsIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgIGJvb2xlYW4gaGFzSm9pbiA9IGZldGNoLmhhc0pvaW4o\nZm1zW2ldLmdldEZ1bGxOYW1lKGZhbHNlKSk7CgogICAgICAgICAgICAvLyBp\nZiB0aGUgZmllbGQgZGVjbGFyZXMgYSBwcmVmZXJyZWQgc2VsZWN0IG1vZGUg\nb2Ygam9pbiBvciBkb2VzIG5vdAogICAgICAgICAgICAvLyBoYXZlIGEgcHJl\nZmVycmVkIG1vZGUgYW5kIHdlJ3JlIGRvaW5nIGEgYnktaWQgbG9va3VwLCB0\ncnkKICAgICAgICAgICAgLy8gdG8gdXNlIGEgdG8tbWFueSBqb2luIGFsc28u\nICBjdXJyZW50bHkgd2UgbGltaXQgZWFnZXIKICAgICAgICAgICAgLy8gb3V0\nZXIgam9pbnMgdG8gbm9uLUxSUywgbm9uLXJhbmdlZCBzZWxlY3RzIHRoYXQg\nZG9uJ3QgYWxyZWFkeQogICAgICAgICAgICAvLyBoYXZlIGFuIGVhZ2VyIHRv\nLW1hbnkgam9pbgogICAgICAgICAgICBpZiAoKGhhc0pvaW4gfHwgbW9kZSA9\nPSBmZXRjaC5FQUdFUl9KT0lOIAogICAgICAgICAgICAgICAgfHwgKG1vZGUg\nPT0gZmV0Y2guREVGQVVMVCAmJiBzbSAhPSBudWxsKSkKICAgICAgICAgICAg\nICAgICYmIGZtc1tpXS5pc0VhZ2VyU2VsZWN0VG9NYW55KCkKICAgICAgICAg\nICAgICAgICYmICFpbkVhZ2VySm9pbgogICAgICAgICAgICAgICAgJiYgIXNl\nbC5oYXNFYWdlckpvaW4odHJ1ZSkKICAgICAgICAgICAgICAgICYmICghc2Vs\nLmdldEF1dG9EaXN0aW5jdCgpIHx8ICghc2VsLmlzTFJTKCkKICAgICAgICAg\nICAgICAgICYmIHNlbC5nZXRTdGFydEluZGV4KCkgPT0gMCAKICAgICAgICAg\nICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09IExvbmcuTUFYX1ZBTFVF\nKSkKICAgICAgICAgICAgICAgICYmIGZtc1tpXS5zdXBwb3J0c1NlbGVjdChz\nZWwsIGp0eXBlLCBzbSwgdGhpcywgZmV0Y2gpID4gMCkgewogICAgICAgICAg\nICAgICAgaWYgKHNlbC5lYWdlckNsb25lKGZtc1tpXSwganR5cGUsIHRydWUs\nIDEpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZWFnZXJUb01hbnkg\nPSBmbXNbaV07CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGZpbmFsbHksIHRyeSBwYXJhbGxlbAogICAgICAgICAgICBpZiAoZWFnZXIg\nPT0gZmV0Y2guRUFHRVJfUEFSQUxMRUwKICAgICAgICAgICAgICAgICYmIChz\nZWxzID0gZm1zW2ldLnN1cHBvcnRzU2VsZWN0KHNlbCwgc2VsLkVBR0VSX1BB\nUkFMTEVMLCBzbSwKICAgICAgICAgICAgICAgIHRoaXMsIGZldGNoKSkgIT0g\nMCkKICAgICAgICAgICAgICAgIHNlbC5lYWdlckNsb25lKGZtc1tpXSwgU2Vs\nZWN0LkVBR0VSX1BBUkFMTEVMLCAKICAgICAgICAgICAgICAgICAgICBmbXNb\naV0uaXNFYWdlclNlbGVjdFRvTWFueSgpLCBzZWxzKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGVhZ2VyVG9NYW55OwogICAgfQoKICAgIC8qKgogICAg\nICogRGV0ZXJtaW5lIGlmIHRoZSBnaXZlbiBmaWVsZCBuZWVkcyB0byBiZSBz\nZWxlY3RlZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBy\nZXF1aXJlc1NlbGVjdChGaWVsZE1hcHBpbmcgZm0sCiAgICAgICAgT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSwgQml0U2V0IGZpZWxkcywgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIGlmIChmaWVsZHMgIT0gbnVs\nbCkKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5nZXQoZm0uZ2V0SW5kZXgo\nKSk7CiAgICAgICAgaWYgKHNtICE9IG51bGwgJiYgc20uZ2V0UENTdGF0ZSgp\nICE9IFBDU3RhdGUuVFJBTlNJRU5UCiAgICAgICAgICAgICYmIHNtLmdldExv\nYWRlZCgpLmdldChmbS5nZXRJbmRleCgpKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIHJldHVybiBmZXRjaC5yZXF1aXJlc0ZldGNoKGZt\nKSA9PSBGZXRjaENvbmZpZ3VyYXRpb24uRkVUQ0hfTE9BRDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNlbGVjdCB0aGUgZmllbGQgbWFwcGluZ3Mgb2YgdGhl\nIGdpdmVuIGNsYXNzIGFuZCBhbGwgaXRzIHN1cGVyY2xhc3Nlcy4KICAgICAq\nCiAgICAgKiBAcGFyYW0gc2VsIHRoZSBzZWxlY3QgdG8gdXNlCiAgICAgKiBA\ncGFyYW0gbWFwcGluZyB0aGUgbW9zdC1kZXJpdmVkIHR5cGUgdG8gc2VsZWN0\nIGZvcgogICAgICogQHBhcmFtIG9yaWcgdGhlIG9yaWdpbmFsIG1hcHBpbmcg\ndHlwZSBzZWxlY3RlZAogICAgICogQHBhcmFtIHNtIHRoZSBpbnN0YW5jZSBi\nZWluZyBzZWxlY3RlZCBmb3IsIG9yIG51bGwgaWYgbm9uZQogICAgICogQHBh\ncmFtIGZpZWxkcyB0aGUgZmllbGRzIHRvIGxvYWQKICAgICAqIEBwYXJhbSBm\nZXRjaCBmZXRjaCBjb25maWd1cmF0aW9uIHRvIHVzZSBmb3IgbG9hZGluZyBy\nZWxhdGlvbnMKICAgICAqIEBwYXJhbSBlYWdlciB0aGUgZWFnZXIgZmV0Y2gg\nbW9kZSB0byB1c2UKICAgICAqIEBwYXJhbSBqb2luZWQgd2hldGhlciB0aGUg\nY2xhc3MgaGFzIGFscmVhZHkgYmVlbiBqb2luZWQgZG93biB0bwogICAgICog\naXRzIGJhc2UgY2xhc3MKICAgICAqIEByZXR1cm4gJmd0OyAwIGlmIHRoZSBz\nZWxlY3QgaXMgcmVxdWlyZWQsIDAgaWYgZGF0YSB3YXMKICAgICAqIHNlbGVj\ndGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQsIGFuZCAmbHQ7IDAgaWYgbm90aGlu\nZyB3YXMgc2VsZWN0ZWQKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgc2VsZWN0\nQmFzZU1hcHBpbmdzKFNlbGVjdCBzZWwsIENsYXNzTWFwcGluZyBtYXBwaW5n\nLAogICAgICAgIENsYXNzTWFwcGluZyBvcmlnLCBPcGVuSlBBU3RhdGVNYW5h\nZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlciwgRmllbGRNYXBwaW5nIGVhZ2Vy\nVG9NYW55LAogICAgICAgIGJvb2xlYW4gaWRlbnQsIGJvb2xlYW4gam9pbmVk\nKSB7CiAgICAgICAgQ2xhc3NNYXBwaW5nIHBhcmVudCA9IG1hcHBpbmcuZ2V0\nSm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7CiAgICAgICAgaWYgKHBh\ncmVudCA9PSBudWxsICYmICFtYXBwaW5nLmlzTWFwcGVkKCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nInZpcnR1YWwtbWFwcGluZyIsIG1hcHBpbmcuCiAgICAgICAgICAgICAgICBn\nZXREZXNjcmliZWRUeXBlKCkpKTsKCiAgICAgICAgaW50IHNlbGQgPSAtMTsK\nICAgICAgICBpbnQgcHNlbGQgPSAtMTsKCiAgICAgICAgLy8gYmFzZSBjbGFz\ncyBzZWxlY3RzIHBrcywgZXRjCiAgICAgICAgaWYgKHBhcmVudCA9PSBudWxs\nKSB7CiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlLCBzZWxlY3QgcGtz\nCiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBpZiAoaWRlbnQpCiAgICAgICAgICAgICAgICAgICAgc2VsLnNlbGVjdElk\nZW50aWZpZXIobWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpKTsKICAg\nICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZWwuc2Vs\nZWN0KG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKSk7CiAgICAgICAg\nICAgICAgICBzZWxkID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gaWYgbm8gaW5zdGFuY2Ugb3Igbm90IGluaXRpYWxpemVkIGFuZCBub3Qg\nZXhhY3Qgb2lkLCBzZWxlY3QgdHlwZQogICAgICAgICAgICBpZiAoKHNtID09\nIG51bGwgfHwgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRSQU5TSUVO\nVCAKICAgICAgICAgICAgICAgICYmICghKHNtLmdldE9iamVjdElkKCkgaW5z\ndGFuY2VvZiBPcGVuSlBBSWQpIAogICAgICAgICAgICAgICAgfHwgKChPcGVu\nSlBBSWQpIHNtLmdldE9iamVjdElkKCkpLmhhc1N1YmNsYXNzZXMoKSkpKQog\nICAgICAgICAgICAgICAgJiYgbWFwcGluZy5nZXREaXNjcmltaW5hdG9yKCku\nc2VsZWN0KHNlbCwgb3JpZykpCiAgICAgICAgICAgICAgICBzZWxkID0gMTsK\nCiAgICAgICAgICAgIC8vIGlmIG5vIGluc3RhbmNlIG9yIG5vIHZlcnNpb24s\nIHNlbGVjdCB2ZXJzaW9uCiAgICAgICAgICAgIGlmICgoc20gPT0gbnVsbCB8\nfCBzbS5nZXRWZXJzaW9uKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICYm\nIG1hcHBpbmcuZ2V0VmVyc2lvbigpLnNlbGVjdChzZWwsIG9yaWcpKQogICAg\nICAgICAgICAgICAgc2VsZCA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgLy8gcmVjdXJzZSBvbiBwYXJlbnQKICAgICAgICAgICAgcHNlbGQg\nPSBzZWxlY3RCYXNlTWFwcGluZ3Moc2VsLCBwYXJlbnQsIG9yaWcsIHNtLCBm\naWVsZHMsCiAgICAgICAgICAgICAgICBmZXRjaCwgZWFnZXIsIGVhZ2VyVG9N\nYW55LCBpZGVudCwgam9pbmVkKTsKICAgICAgICB9CgogICAgICAgIC8vIHNl\nbGVjdCB0aGUgbWFwcGluZ3MgaW4gdGhlIGdpdmVuIGZpZWxkcyBzZXQsIG9y\nIGJhc2VkIG9uIGZldGNoCiAgICAgICAgLy8gY29uZmlndXJhdGlvbiBpZiBu\nbyBmaWVsZHMgZ2l2ZW4KICAgICAgICBGaWVsZE1hcHBpbmdbXSBmbXMgPSBt\nYXBwaW5nLmdldERlZmluZWRGaWVsZE1hcHBpbmdzKCk7CiAgICAgICAgU2Vs\nZWN0RXhlY3V0b3IgZXNlbDsKICAgICAgICBpbnQgZnNlbGQ7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgLy8gc2tpcCBlYWdlciB0by1tYW55IHNlbGVjdDsgd2UgZG8gdGhh\ndCBzZXBhcmF0ZWx5IGluIGNhbGxpbmcKICAgICAgICAgICAgLy8gbWV0aG9k\nCiAgICAgICAgICAgIGlmIChmbXNbaV0gPT0gZWFnZXJUb01hbnkpCiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGZv\nciBlYWdlciBzZWxlY3QKICAgICAgICAgICAgZXNlbCA9IHNlbC5nZXRFYWdl\ncihmbXNbaV0pOwogICAgICAgICAgICBpZiAoZXNlbCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAoZXNlbCA9PSBzZWwpCiAgICAgICAgICAgICAg\nICAgICAgZm1zW2ldLnNlbGVjdEVhZ2VySm9pbihzZWwsIHNtLCB0aGlzLCAK\nICAgICAgICAgICAgICAgICAgICAJZmV0Y2gudHJhdmVyc2VKREJDKGZtc1tp\nXSksIGVhZ2VyKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBmbXNbaV0uc2VsZWN0RWFnZXJQYXJhbGxlbChlc2VsLCBzbSwg\ndGhpcywgCiAgICAgICAgICAgICAgICAgICAgCWZldGNoLnRyYXZlcnNlSkRC\nQyhmbXNbaV0pLCBlYWdlcik7CiAgICAgICAgICAgICAgICBzZWxkID0gTWF0\naC5tYXgoMCwgc2VsZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxdWly\nZXNTZWxlY3QoZm1zW2ldLCBzbSwgZmllbGRzLCBmZXRjaCkpIHsKICAgICAg\nICAgICAgICAgIGZzZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0aGlz\nLCAKICAgICAgICAgICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ld\nKSwgZWFnZXIpOwogICAgICAgICAgICAgICAgc2VsZCA9IE1hdGgubWF4KGZz\nZWxkLCBzZWxkKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRTZWxlY3Qo\nZm1zW2ldLCBzZWwsIHNtLCBmZXRjaCkpIHsKICAgICAgICAgICAgICAgIGZz\nZWxkID0gZm1zW2ldLnNlbGVjdChzZWwsIHNtLCB0aGlzLCAKICAgICAgICAg\nICAgICAgIAlmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2ldKSwgZmV0Y2guRUFH\nRVJfTk9ORSk7CgogICAgICAgICAgICAgICAgLy8gZG9uJ3QgdXBncmFkZSBz\nZWxkIHRvID4gMCBiYXNlZCBvbiB0aGVzZSBmaWVsZHMsIHNpbmNlCiAgICAg\nICAgICAgICAgICAvLyB0aGV5J3JlIG5vdCBpbiB0aGUgY2FsY3VsYXRlZCBm\naWVsZCBzZXQKICAgICAgICAgICAgICAgIGlmIChmc2VsZCA+PSAwICYmIHNl\nbGQgPCAwKQogICAgICAgICAgICAgICAgICAgIHNlbGQgPSAwOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBpbiBjZXJ0YWluIGNpcmN1\nbXN0YW5jZXMgZm9yY2Ugam9pbiB0byBzdXBlcmNsYXNzIHRhYmxlIHRvIGF2\nb2lkCiAgICAgICAgLy8gU1FMIGdlbmVyYXRpb24gZXJyb3IuCiAgICAgICAg\naWYgKCBlYWdlclRvTWFueSAhPSBudWxsICYmIHBzZWxkIDwgMCAmJiBzZWxk\nID4gMCAmJiAham9pbmVkCiAgICAgICAgICAgICAgICAmJiBwYXJlbnQgIT0g\nbnVsbCApIHsKICAgICAgICAgICAgRmllbGRNYXBwaW5nW10gcGZtcyA9IHBh\ncmVudC5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHBmbXMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChwZm1zW2ldID09IGVhZ2VyVG9NYW55ICkgewogICAg\nICAgICAgICAgICAgICAgIHBzZWxkID0gMDsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICAKICAgICAgICAvLyBqb2luIHRvIHBhcmVudCB0YWJs\nZSBpZiB0aGUgcGFyZW50IC8gYW55IGFuY2VzdG9ycyBoYXZlIHNlbGVjdGVk\nCiAgICAgICAgLy8gYW55dGhpbmcKICAgICAgICBpZiAoIWpvaW5lZCAmJiBw\nc2VsZCA+PSAwICYmIHBhcmVudC5nZXRUYWJsZSgpICE9IG1hcHBpbmcuZ2V0\nVGFibGUoKSkKICAgICAgICAgICAgc2VsLndoZXJlKG1hcHBpbmcuam9pblN1\ncGVyY2xhc3Moc2VsLm5ld0pvaW5zKCksIGZhbHNlKSk7CgogICAgICAgIC8v\nIHJldHVybiB0aGUgaGlnaGVzdCB2YWx1ZQogICAgICAgIHJldHVybiBNYXRo\nLm1heChwc2VsZCwgc2VsZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGVu\nIHNlbGVjdGluZyBmaWVsZGVzLCBhIHNwZWNpYWwgY2FzZSBpcyBtYWRlIGZv\nciBtYXBwaW5ncyB0aGF0IHVzZQogICAgICogMi1wYXJ0IHNlbGVjdHMgdGhh\ndCBhcmVuJ3QgZXhwbGljaXRseSAqbm90KiBpbiB0aGUgZGZnIHNvIHRoYXQg\ndGhleQogICAgICogY2FuIGdldCB0aGVpciBwcmltYXJ5IHRhYmxlIGRhdGEu\nIFRoaXMgbWV0aG9kIHRlc3RzIGZvciB0aGF0IHNwZWNpYWwKICAgICAqIGNh\nc2UgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gb3B0U2VsZWN0KEZpZWxkTWFwcGluZyBmbSwgU2VsZWN0IHNlbCwK\nICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuICFmbS5pc0luRGVm\nYXVsdEZldGNoR3JvdXAoKSAKICAgICAgICAgICAgJiYgIWZtLmlzRGVmYXVs\ndEZldGNoR3JvdXBFeHBsaWNpdCgpCiAgICAgICAgICAgICYmIChzbSA9PSBu\ndWxsIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRSQU5TSUVOVCAK\nICAgICAgICAgICAgfHwgIXNtLmdldExvYWRlZCgpLmdldChmbS5nZXRJbmRl\neCgpKSkKICAgICAgICAgICAgJiYgZm0uc3VwcG9ydHNTZWxlY3Qoc2VsLCBz\nZWwuVFlQRV9UV09fUEFSVCwgc20sIHRoaXMsIGZldGNoKSA+IDA7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTZWxlY3QgZmllbGQgbWFwcGluZ3MgdGhhdCBt\nYXRjaCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbiBmb3IKICAgICAq\nIHN1YmNsYXNzZXMgb2YgdGhlIGdpdmVuIHR5cGUuCiAgICAgKgogICAgICog\nQHBhcmFtIHNlbCB0aGUgc2VsZWN0IHRvIHVzZQogICAgICogQHBhcmFtIG1h\ncHBpbmcgdGhlIHR5cGUgd2hvc2Ugc3ViY2xhc3NlcyB0byBzZWxlY3QKICAg\nICAqIEBwYXJhbSBzbSB0aGUgaW5zdGFuY2UgYmVpbmcgc2VsZWN0ZWQgZm9y\nLCBvciBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJhbSBmZXRjaCB0aGUgZmV0\nY2ggY29uZmlndXJhdGlvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQgc2Vs\nZWN0U3ViY2xhc3NNYXBwaW5ncyhTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcg\nbWFwcGluZywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBKREJD\nRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgbG9hZFN1YmNs\nYXNzZXMobWFwcGluZyk7CiAgICAgICAgQ2xhc3NNYXBwaW5nW10gc3ViTWFw\ncGluZ3MgPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdz\nKCk7CiAgICAgICAgaWYgKHN1Yk1hcHBpbmdzLmxlbmd0aCA9PSAwKQogICAg\nICAgICAgICByZXR1cm47CgogICAgICAgIC8vIHNlbGVjdCBhbGwgc3ViY2xh\nc3MgbWFwcGluZ3MgdGhhdCBtYXRjaCB0aGUgZmV0Y2ggY29uZmlndXJhdGlv\nbgogICAgICAgIC8vIGFuZCB3aG9zZSB0YWJsZSBpcyBpbiB0aGUgbGlzdCBv\nZiB0aG9zZSBzZWxlY3RlZCBzbyBmYXI7IHRoaXMKICAgICAgICAvLyB3YXkg\nd2Ugc2VsZWN0IHRoZSBtYXggcG9zc2libGUgd2l0aG91dCBzZWxlY3Rpbmcg\nYW55IHRhYmxlcyB0aGF0CiAgICAgICAgLy8gYXJlbid0IHByZXNlbnQgaW4g\nYWxsIHBvc3NpYmxlIHF1ZXJ5IG1hdGNoZXM7IGEgc3BlY2lhbCBjYXNlCiAg\nICAgICAgLy8gaXMgbWFkZSBmb3IgbWFwcGluZ3MgdGhhdCB1c2UgMi1wYXJ0\nIHNlbGVjdHMgdGhhdCBhcmVuJ3QKICAgICAgICAvLyBleHBsaWNpdGx5ICpu\nb3QqIGluIHRoZSBkZWZhdWx0IHNvIHRoYXQgdGhleSBjYW4gZ2V0IHRoZWly\nCiAgICAgICAgLy8gcHJpbWFyeSB0YWJsZSBkYXRhCiAgICAgICAgRmllbGRN\nYXBwaW5nW10gZm1zOwogICAgICAgIGJvb2xlYW4gam9pbmVkOwogICAgICAg\nIGJvb2xlYW4gY2FuSm9pbiA9IF9kaWN0LmpvaW5TeW50YXggIT0gSm9pblN5\nbnRheGVzLlNZTlRBWF9UUkFESVRJT05BTAogICAgICAgICAgICAmJiBmZXRj\naC5nZXRTdWJjbGFzc0ZldGNoTW9kZShtYXBwaW5nKSAhPSBmZXRjaC5FQUdF\nUl9OT05FOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3ViTWFwcGlu\nZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFzdWJNYXBwaW5n\nc1tpXS5zdXBwb3J0c0VhZ2VyU2VsZWN0KHNlbCwgc20sIHRoaXMsIG1hcHBp\nbmcsCiAgICAgICAgICAgICAgICBmZXRjaCkpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgc28gdGhhdCBp\nZiB3ZSBjYW4ndCBqb2luLCB3ZSBwcmV0ZW5kIHdlIGFscmVhZHkgaGF2ZQog\nICAgICAgICAgICBqb2luZWQgPSAhY2FuSm9pbjsKICAgICAgICAgICAgZm1z\nID0gc3ViTWFwcGluZ3NbaV0uZ2V0RGVmaW5lZEZpZWxkTWFwcGluZ3MoKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBmbXMubGVuZ3RoOyBq\nKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBpbiBvbmUgb2Yg\nY29uZmlndXJlZCBmZXRjaCBncm91cHMKICAgICAgICAgICAgCWlmIChmZXRj\naC5yZXF1aXJlc0ZldGNoKGZtc1tqXSkgIT0gRmV0Y2hDb25maWd1cmF0aW9u\nLkZFVENIX0xPQUQKICAgICAgICAgICAgICAgICAgICAmJiAoKCFmbXNbal0u\naXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkgCiAgICAgICAgICAgICAgICAgICAg\nJiYgZm1zW2pdLmlzRGVmYXVsdEZldGNoR3JvdXBFeHBsaWNpdCgpKQogICAg\nICAgICAgICAgICAgICAgIHx8IGZtc1tqXS5zdXBwb3J0c1NlbGVjdChzZWws\nIHNlbC5UWVBFX1RXT19QQVJULCBzbSwgdGhpcywgCiAgICAgICAgICAgICAg\nICAgICAgZmV0Y2gpIDw9IDApKSAKICAgICAgICAgICAgCQljb250aW51ZTsK\nCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBjYW4gam9pbiB0byB0aGUgc3Vi\nY2xhc3MsIGRvIHNvOyBtdWNoIGJldHRlciBjaGFuY2UKICAgICAgICAgICAg\nICAgIC8vIHRoYXQgdGhlIGZpZWxkIHdpbGwgYmUgYWJsZSB0byBzZWxlY3Qg\naXRzZWxmIHdpdGhvdXQgam9pbnMKICAgICAgICAgICAgICAgIGlmICgham9p\nbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFyayBqb2luZWQgd2hl\ndGhlciBvciBub3Qgd2Ugam9pbiwgc28gd2UgZG9uJ3QgaGF2ZSB0bwogICAg\nICAgICAgICAgICAgICAgIC8vIHRlc3QgY29uZGl0aW9ucyBhZ2FpbiBmb3Ig\ndGhpcyBzdWJjbGFzcwogICAgICAgICAgICAgICAgICAgIGpvaW5lZCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgc2VsLndoZXJlKGpvaW5TdWJjbGFz\ncyhzZWwsIG1hcHBpbmcsIHN1Yk1hcHBpbmdzW2ldLCBudWxsKSk7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaWYgY2FuIHNlbGVj\ndCB3aXRoIHRhYmxlcyBhbHJlYWR5IHNlbGVjdGVkLCBkbyBpdAogICAgICAg\nICAgICAgICAgaWYgKGZtc1tqXS5zdXBwb3J0c1NlbGVjdChzZWwsIHNlbC5U\nWVBFX0pPSU5MRVNTLCBzbSwgdGhpcywKICAgICAgICAgICAgICAgICAgICBm\nZXRjaCkgPiAwKQogICAgICAgICAgICAgICAgICAgIGZtc1tqXS5zZWxlY3Qo\nc2VsLCBudWxsLCB0aGlzLCBmZXRjaC50cmF2ZXJzZUpEQkMoZm1zW2pdKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2guRUFHRVJfTk9ORSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRvIGpvaW4gZnJvbSBjbGFzcyB0byBpdHMgc3ViY2xh\nc3MuIFJlY3Vyc2l2ZSB0byBhbGxvdwogICAgICogZm9yIG11bHRpcGxlIGhv\ncHMsIHN0YXJ0aW5nIGZyb20gdGhlIGJhc2UgY2xhc3MuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIEpvaW5zIGpvaW5TdWJjbGFzcyhTZWxlY3Qgc2Vs\nLCBDbGFzc01hcHBpbmcgYmFzZSwKICAgICAgICBDbGFzc01hcHBpbmcgc3Vi\nLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChzdWIgPT0gYmFzZSB8fCBz\ndWIuZ2V0VGFibGUoKSA9PSBiYXNlLmdldFRhYmxlKCkKICAgICAgICAgICAg\nfHwgc2VsLmlzU2VsZWN0ZWQoc3ViLmdldFRhYmxlKCkpKQogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gcmVjdXJzZSBmaXJzdCBzbyB3\nZSBnbyBsZWFzdC0+bW9zdCBkZXJpdmVkCiAgICAgICAgQ2xhc3NNYXBwaW5n\nIHN1cCA9IHN1Yi5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsK\nICAgICAgICBqb2lucyA9IGpvaW5TdWJjbGFzcyhzZWwsIGJhc2UsIHN1cCwg\nam9pbnMpOwogICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAgICAg\nICBqb2lucyA9IHNlbC5uZXdKb2lucygpOwogICAgICAgIHJldHVybiBzdWIu\nam9pblN1cGVyY2xhc3Moam9pbnMsIHRydWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogTWFrZXMgc3VyZSBhbGwgc3ViY2xhc3NlcyBvZiB0aGUgZ2l2ZW4g\ndHlwZSBhcmUgbG9hZGVkIGluIHRoZSBKVk0uCiAgICAgKiBUaGlzIGlzIHVz\ndWFsbHkgZG9uZSBhdXRvbWF0aWNhbGx5LgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBsb2FkU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcgbWFwcGluZykgewog\nICAgICAgIERpc2NyaW1pbmF0b3IgZHNjID0gbWFwcGluZy5nZXREaXNjcmlt\naW5hdG9yKCk7CiAgICAgICAgaWYgKGRzYy5nZXRTdWJjbGFzc2VzTG9hZGVk\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhlIHN1\nYmNsYXNzIGxpc3QgaXMgc2V0LCBubyBuZWVkIHRvIGxvYWQgc3VicwogICAg\nICAgIGlmIChtYXBwaW5nLmdldFJlcG9zaXRvcnkoKS5nZXRQZXJzaXN0ZW50\nVHlwZU5hbWVzKGZhbHNlLAogICAgICAgICAgICBfY3R4LmdldENsYXNzTG9h\nZGVyKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgZHNjLnNldFN1YmNsYXNz\nZXNMb2FkZWQodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRzYy5sb2FkU3ViY2xhc3Nl\ncyh0aGlzKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0\naW9uIGNuZmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0\naW9uKGNuZmUpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkg\newogICAgICAgICAgICB0aHJvdyBTUUxFeGNlcHRpb25zLmdldFN0b3JlKHNl\nLCBfZGljdCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSB0aGUgc3RhdGVtZW50IGEgY2FuZGlkYXRlIGZvciBjYW5jZWxsYXRpb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBiZWZvcmVFeGVjdXRlU3RhdGVt\nZW50KFN0YXRlbWVudCBzdG1udCkgewogICAgICAgIF9zdG1udHMuYWRkKHN0\nbW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgc3RhdGVt\nZW50IGZyb20gdGhlIGNhbmNlbGxhYmxlIHNldC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFmdGVyRXhlY3V0ZVN0YXRlbWVudChTdGF0ZW1lbnQgc3Rt\nbnQpIHsKICAgICAgICBfc3RtbnRzLnJlbW92ZShzdG1udCk7CiAgICB9CiAg\nICAKICAgIEZpbmRlclF1ZXJ5SW1wbCBnZXRGaW5kZXIoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAg\nIEZpbmRlckNhY2hlIGNhY2hlID0gZ2V0RmluZGVyQ2FjaGUoKTsKICAgICAg\nICByZXR1cm4gY2FjaGUgPT0gbnVsbCAKICAgICAgICAgICAgID8gbnVsbCA6\nIChGaW5kZXJRdWVyeUltcGwpY2FjaGUuZ2V0KG1hcHBpbmcsIGZldGNoKTsK\nICAgIH0KICAgIAogICAgYm9vbGVhbiBjYWNoZUZpbmRlcihDbGFzc01hcHBp\nbmcgbWFwcGluZywgU2VsZWN0RXhlY3V0b3Igc2VsZWN0LCAKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBGaW5kZXJDYWNo\nZSBjYWNoZSA9IGdldEZpbmRlckNhY2hlKCk7CiAgICAgICAgcmV0dXJuIGNh\nY2hlICE9IG51bGwgJiYgY2FjaGUuY2FjaGUobWFwcGluZywgc2VsZWN0LCBm\nZXRjaCkgIT0gbnVsbDsKICAgIH0KICAgIAogICAgRmluZGVyQ2FjaGUgZ2V0\nRmluZGVyQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJuICgoKEJyb2tlckltcGwp\nZ2V0Q29udGV4dCgpKS5nZXRDYWNoZUZpbmRlclF1ZXJ5KCkpCiAgICAgICAg\nICAgICA/IGdldENvbmZpZ3VyYXRpb24oKS5nZXRGaW5kZXJDYWNoZUluc3Rh\nbmNlKCkgOiBudWxsOwogICAgfQoKCiAgICAvKioKICAgICAqIENvbm5lY3Rp\nb24gcmV0dXJuZWQgdG8gY2xpZW50IGNvZGUuIE1ha2VzIHN1cmUgaXRzIHdy\nYXBwZWQgY29ubmVjdGlvbgogICAgICogcmVmIGNvdW50IGlzIGRlY3JlbWVu\ndGVkIG9uIGZpbmFsaXplLgogICAgICovCiAgICBwdWJsaWMgYWJzdHJhY3Qg\nc3RhdGljIGNsYXNzIENsaWVudENvbm5lY3Rpb24gZXh0ZW5kcwogICAgICAg\nICAgICBEZWxlZ2F0aW5nQ29ubmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CgogICAgICAgIHB1YmxpYyBDbGll\nbnRDb25uZWN0aW9uKENvbm5lY3Rpb24gY29ubikgewogICAgICAgICAgICBz\ndXBlcihjb25uKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNs\nb3NlKCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9jbG9z\nZWQgPSB0cnVlOwogICAgICAgICAgICBzdXBlci5jbG9zZSgpOwogICAgICAg\nIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZmluYWxpemUoKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKCFfY2xvc2VkKQogICAg\nICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb25uZWN0aW9uIHdyYXBwZXIgdGhhdCBrZWVwcyBhbiBpbnRl\ncm5hbCByZWYgY291bnQgc28gdGhhdCBpdCBrbm93cwogICAgICogd2hlbiB0\nbyByZWFsbHkgY2xvc2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCBjbGFzcyBSZWZDb3VudENvbm5lY3Rpb24gZXh0ZW5kcyBEZWxlZ2F0aW5n\nQ29ubmVjdGlvbiB7CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfcmV0YWlu\nID0gZmFsc2U7CiAgICAgICAgcHJpdmF0ZSBpbnQgX3JlZnMgPSAwOwogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBfZnJlZWQgPSBmYWxzZTsKCiAgICAgICAg\ncHVibGljIFJlZkNvdW50Q29ubmVjdGlvbihDb25uZWN0aW9uIGNvbm4pIHsK\nICAgICAgICAgICAgc3VwZXIoY29ubik7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBnZXRSZXRhaW4oKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfcmV0YWluOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc2V0\nUmV0YWluKGJvb2xlYW4gcmV0YWluKSB7CiAgICAgICAgICAgIGlmIChfcmV0\nYWluICYmICFyZXRhaW4gJiYgX3JlZnMgPD0gMCkKICAgICAgICAgICAgICAg\nIGZyZWUoKTsKICAgICAgICAgICAgX3JldGFpbiA9IHJldGFpbjsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlZigpIHsKICAgICAgICAgICAg\nLy8gZG9uJ3QgaGF2ZSB0byBsb2NrOyBjYWxsZWQgZnJvbSBjb25uZWN0KCks\nIHdoaWNoIGlzIGxvY2tlZAogICAgICAgICAgICBfcmVmcysrOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgLy8gbG9jayBhdCBicm9rZXIgbGV2ZWwg\ndG8gYXZvaWQgZGVhZGxvY2tzCiAgICAgICAgICAgIF9jdHgubG9jaygpOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3JlZnMtLTsKICAg\nICAgICAgICAgICAgIGlmIChfcmVmcyA8PSAwICYmICFfcmV0YWluKQogICAg\nICAgICAgICAgICAgICAgIGZyZWUoKTsKICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIF9jdHgudW5sb2NrKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgICogTm9uLXRocmVh\nZC1zYWZlIG1ldGhvZC4gIEVuc3VyZSBwcm90ZWN0aW9uIGluIHRoZSBjYWxs\nIHBhdGguLi4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBmcmVl\nKCkgewogICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBkbyBub3QgY2xv\nc2UgdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvbgogICAgICAgICAgICAvLyBt\ndWx0aXBsZSB0aW1lczsgdGhpcyBjb3VsZCBoYXBwZW4gaWYgc29tZW9uZSAo\nZS5nLiwgYW4KICAgICAgICAgICAgLy8gRXh0ZW50KSBob2xkcyBhIFJlZkNv\nbm5lY3Rpb24sIGFuZCB0aGVuIGNsb3NlcyBpdCAoZS5nLiwgaW4KICAgICAg\nICAgICAgLy8gdGhlIGZpbmFsaXplcikgYWZ0ZXIgdGhlIFN0b3JlTWFuYWdl\nciBoYXMgYWxyZWFkeSBiZWVuIGNsb3NlZC4KICAgICAgICAgICAgaWYgKF9m\ncmVlZCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBnZXREZWxlZ2F0ZSgpLmNsb3NlKCk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF9mcmVlZCA9IHRydWU7CiAgICAgICAgICAg\nIF9jb25uID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBT\ndGF0ZW1lbnQgY3JlYXRlU3RhdGVtZW50KGJvb2xlYW4gd3JhcCkgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNs\nYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlKGNhbmNlbFN0YXRlbWVudEltcGws\nIEpEQkNTdG9yZU1hbmFnZXIudGhpcywKICAgICAgICAgICAgICAgICAgICBz\ndXBlci5jcmVhdGVTdGF0ZW1lbnQoZmFsc2UpLCBSZWZDb3VudENvbm5lY3Rp\nb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgU3RhdGVt\nZW50IGNyZWF0ZVN0YXRlbWVudChpbnQgcnNUeXBlLCBpbnQgcnNDb25jdXIs\nCiAgICAgICAgICAgIGJvb2xlYW4gd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHJldHVybiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9y\nLm5ld0luc3RhbmNlKGNhbmNlbFN0YXRlbWVudEltcGwsIEpEQkNTdG9yZU1h\nbmFnZXIudGhpcywKICAgICAgICAgICAgICAgICAgICBzdXBlci5jcmVhdGVT\ndGF0ZW1lbnQocnNUeXBlLCByc0NvbmN1ciwgZmFsc2UpLCBSZWZDb3VudENv\nbm5lY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQg\nUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3Fs\nLCBib29sZWFuIHdyYXApCiAgICAgICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgICAgICByZXR1cm4gQ29uY3JldGVDbGFzc0dlbmVyYXRv\nci5uZXdJbnN0YW5jZShjYW5jZWxQcmVwYXJlZFN0YXRlbWVudEltcGwsCiAg\nICAgICAgICAgICAgICAgICAgSkRCQ1N0b3JlTWFuYWdlci50aGlzLCBzdXBl\nci5wcmVwYXJlU3RhdGVtZW50KHNxbCwgZmFsc2UpLCBSZWZDb3VudENvbm5l\nY3Rpb24udGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgUHJl\ncGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChTdHJpbmcgc3FsLCBp\nbnQgcnNUeXBlLAogICAgICAgICAgICBpbnQgcnNDb25jdXIsIGJvb2xlYW4g\nd3JhcCkgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVy\nbiBDb25jcmV0ZUNsYXNzR2VuZXJhdG9yLm5ld0luc3RhbmNlCiAgICAgICAg\nICAgICAgICAoY2FuY2VsUHJlcGFyZWRTdGF0ZW1lbnRJbXBsLAogICAgICAg\nICAgICAgICAgICAgIEpEQkNTdG9yZU1hbmFnZXIudGhpcywgc3VwZXIucHJl\ncGFyZVN0YXRlbWVudChzcWwsIHJzVHlwZSwgcnNDb25jdXIsIGZhbHNlKSwK\nICAgICAgICAgICAgICAgICAgICBSZWZDb3VudENvbm5lY3Rpb24udGhpcyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RhdGVtZW50IHR5\ncGUgdGhhdCBhZGRzIGFuZCByZW1vdmVzIGl0c2VsZiBmcm9tIHRoZSBzZXQg\nb2YgYWN0aXZlCiAgICAgKiBzdGF0ZW1lbnRzIHNvIHRoYXQgaXQgY2FuIGJl\nIGNhbmNlbGVkLgogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgY2xh\nc3MgQ2FuY2VsU3RhdGVtZW50IGV4dGVuZHMgRGVsZWdhdGluZ1N0YXRlbWVu\ndCB7CgogICAgICAgIHB1YmxpYyBDYW5jZWxTdGF0ZW1lbnQoU3RhdGVtZW50\nIHN0bW50LCBDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICAgICAgc3VwZXIo\nc3RtbnQsIGNvbm4pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBl\neGVjdXRlVXBkYXRlKFN0cmluZyBzcWwpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50KHRoaXMpOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVy\nLmV4ZWN1dGVVcGRhdGUoc3FsKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIFJl\nc3VsdFNldCBleGVjdXRlUXVlcnkoU3RyaW5nIHNxbCwgYm9vbGVhbiB3cmFw\nKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5leGVjdXRlUXVl\ncnkoc3FsLCB3cmFwKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlzKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0YXRl\nbWVudCB0eXBlIHRoYXQgYWRkcyBhbmQgcmVtb3ZlcyBpdHNlbGYgZnJvbSB0\naGUgc2V0IG9mIGFjdGl2ZQogICAgICogc3RhdGVtZW50cyBzbyB0aGF0IGl0\nIGNhbiBiZSBjYW5jZWxlZC4KICAgICAqLwogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IGNsYXNzIENhbmNlbFByZXBhcmVkU3RhdGVtZW50IGV4dGVuZHMKICAg\nICAgICAgICAgRGVsZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50IHsKCiAgICAg\nICAgcHVibGljIENhbmNlbFByZXBhcmVkU3RhdGVtZW50KFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCAKICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25uKSB7\nCiAgICAgICAgICAgIHN1cGVyKHN0bW50LCBjb25uKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgZXhlY3V0ZVVwZGF0ZSgpIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgICAgICBiZWZvcmVFeGVjdXRlU3RhdGVtZW50\nKHRoaXMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmV4ZWN1dGVVcGRhdGUoKTsKICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0\naGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoYm9vbGVhbiB3cmFwKSB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0\nYXRlbWVudCh0aGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHJldHVybiBzdXBlci5leGVjdXRlUXVlcnkod3JhcCk7CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBhZnRlckV4ZWN1dGVT\ndGF0ZW1lbnQodGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBpbnRbXSBleGVjdXRlQmF0Y2goKSB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgYmVmb3JlRXhlY3V0ZVN0YXRlbWVudCh0\naGlzKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVy\nbiBzdXBlci5leGVjdXRlQmF0Y2goKTsKICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgIGFmdGVyRXhlY3V0ZVN0YXRlbWVudCh0aGlz\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoK\n","encoding":"base64"}

