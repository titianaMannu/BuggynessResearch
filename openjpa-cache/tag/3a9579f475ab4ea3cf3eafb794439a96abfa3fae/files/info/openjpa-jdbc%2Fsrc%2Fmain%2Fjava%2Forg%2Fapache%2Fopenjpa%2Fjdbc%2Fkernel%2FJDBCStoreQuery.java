{"sha":"34579a22fa38b2311fd36b14a500f1914c32ebc9","node_id":"MDQ6QmxvYjIwNjM2NDozNDU3OWEyMmZhMzhiMjMxMWZkMzZiMTRhNTAwZjE5MTRjMzJlYmM5","size":43188,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/34579a22fa38b2311fd36b14a500f1914c32ebc9","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuRXhwQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmtlcm5lbC5leHBzLkdldENvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNFeHByZXNzaW9uRmFjdG9y\neTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkpEQkNTdHJpbmdDb250YWluczsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5qZGJjLmtlcm5lbC5leHBzLkpEQkNXaWxkY2FyZE1hdGNoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUENQYXRoOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuUXVl\ncnlFeHByZXNzaW9uc1N0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLmV4cHMuU1FMRW1iZWQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TUUxFeHByZXNzaW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU1FMVmFs\ndWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhw\ncy5WYWw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkNs\nYXNzTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1l\ndGEuRmllbGRNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMubWV0YS5zdHJhdHMuVmVydGljYWxDbGFzc1N0cmF0ZWd5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5EQkRpY3Rpb25hcnk7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVmZmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNRTEV4Y2VwdGlv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU2VsZWN0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNlbGVjdElt\ncGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuVW5pb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkV4cHJlc3Npb25T\ndG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5G\naWx0ZXJzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVu\nSlBBU3RhdGVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtl\ncm5lbC5PcmRlcmluZ01lcmdlZFJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUhpbnRzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkNvbnN0YW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkNvbnRleHQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuRXhwcmVz\nc2lvbkZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLmV4cHMuRXhwcmVzc2lvblBhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5GaWx0ZXJMaXN0ZW5lcjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5MaXRlcmFsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lvbnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5NZXJnZWRSZXN1\nbHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5s\naWIucm9wLlJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRPYmplY3RQcm92aWRlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4\nY2VwdGlvbjsKCi8qKgogKiBKREJDIHF1ZXJ5IGltcGxlbWVudGF0aW9uLgog\nKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgSkRCQ1N0b3JlUXVlcnkgCiAgICBleHRlbmRzIEV4cHJlc3Np\nb25TdG9yZVF1ZXJ5IHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBUYWJs\nZSBJTlZBTElEID0gbmV3IFRhYmxlKCk7CgogICAgLy8gYWRkIGFsbCBzdGFu\nZGFyZCBmaWx0ZXIgYW5kIGFnZ3JlZ2F0ZSBsaXN0ZW5lcnMgdG8gdGhlc2Ug\nbWFwcwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTWFwIF9saXN0ZW5lcnMg\nPSBuZXcgSGFzaE1hcCgpOwoKICAgIHN0YXRpYyB7CiAgICAgICAgLy8gZGVw\ncmVjYXRlZCBleHRlbnNpb25zCiAgICAgICAgX2xpc3RlbmVycy5wdXQoSkRC\nQ1N0cmluZ0NvbnRhaW5zLlRBRywgbmV3IEpEQkNTdHJpbmdDb250YWlucygp\nKTsKICAgICAgICBfbGlzdGVuZXJzLnB1dChKREJDV2lsZGNhcmRNYXRjaC5U\nQUcsIG5ldyBKREJDV2lsZGNhcmRNYXRjaCgpKTsKICAgICAgICBfbGlzdGVu\nZXJzLnB1dChTUUxFeHByZXNzaW9uLlRBRywgbmV3IFNRTEV4cHJlc3Npb24o\nKSk7CiAgICAgICAgX2xpc3RlbmVycy5wdXQoU1FMVmFsdWUuVEFHLCBuZXcg\nU1FMVmFsdWUoKSk7CgogICAgICAgIC8vIGpkYmMtc3BlY2lmaWMgZXh0ZW5z\naW9ucwogICAgICAgIF9saXN0ZW5lcnMucHV0KEdldENvbHVtbi5UQUcsIG5l\ndyBHZXRDb2x1bW4oKSk7CiAgICAgICAgX2xpc3RlbmVycy5wdXQoU1FMRW1i\nZWQuVEFHLCBuZXcgU1FMRW1iZWQoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBm\naW5hbCB0cmFuc2llbnQgSkRCQ1N0b3JlIF9zdG9yZTsKICAgIHByaXZhdGUg\nc3RhdGljIFRocmVhZExvY2FsQ29udGV4dCBsb2NhbENvbnRleHQgPSBuZXcg\nVGhyZWFkTG9jYWxDb250ZXh0KCk7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1\nY3Rvci4gU3VwcGx5IHN0b3JlIG1hbmFnZXIuCiAgICAgKi8KICAgIHB1Ymxp\nYyBKREJDU3RvcmVRdWVyeShKREJDU3RvcmUgc3RvcmUsIEV4cHJlc3Npb25Q\nYXJzZXIgcGFyc2VyKSB7CiAgICAgICAgc3VwZXIocGFyc2VyKTsKICAgICAg\nICBfc3RvcmUgPSBzdG9yZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgc3RvcmUuCiAgICAgKi8KICAgIHB1YmxpYyBKREJDU3RvcmUgZ2V0\nU3RvcmUoKSB7CiAgICAgICAgcmV0dXJuIF9zdG9yZTsKICAgIH0KCiAgICBw\ndWJsaWMgRmlsdGVyTGlzdGVuZXIgZ2V0RmlsdGVyTGlzdGVuZXIoU3RyaW5n\nIHRhZykgewogICAgICAgIHJldHVybiAoRmlsdGVyTGlzdGVuZXIpIF9saXN0\nZW5lcnMuZ2V0KHRhZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdD\nb21waWxhdGlvbktleSgpIHsKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pIGN0eAogICAg\nICAgICAgICAuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgcmV0\ndXJuIGZldGNoLmdldEpvaW5TeW50YXgoKTsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpIHsKICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ2xhc3NNZXRh\nRGF0YVtdIGdldEluZGVwZW5kZW50RXhwcmVzc2lvbkNhbmRpZGF0ZXMoCiAg\nICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1YmNsYXNzZXMp\nIHsKICAgICAgICBpZiAoIXN1YmNsYXNzZXMpCiAgICAgICAgICAgIHJldHVy\nbiBuZXcgQ2xhc3NNYXBwaW5nW10geyAoQ2xhc3NNYXBwaW5nKSBtZXRhIH07\nCiAgICAgICAgcmV0dXJuICgoQ2xhc3NNYXBwaW5nKSBtZXRhKS5nZXRJbmRl\ncGVuZGVudEFzc2lnbmFibGVNYXBwaW5ncygpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBFeHByZXNzaW9uRmFjdG9yeSBnZXRFeHByZXNzaW9uRmFjdG9yeShD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbmV3IEpEQkNF\neHByZXNzaW9uRmFjdG9yeSgoQ2xhc3NNYXBwaW5nKSBtZXRhKTsKICAgIH0K\nICAgIAogICAgcHJvdGVjdGVkIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1\ndGVRdWVyeShFeGVjdXRvciBleCwKICAgICAgICBDbGFzc01ldGFEYXRhIGJh\nc2UsIENsYXNzTWV0YURhdGFbXSBtZXRhcywgYm9vbGVhbiBzdWJjbGFzc2Vz\nLAogICAgICAgIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMsIFF1ZXJ5RXhw\ncmVzc2lvbnNbXSBleHBzLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAgUmFu\nZ2UgcmFuZ2UpIHsKICAgICAgICBDb250ZXh0W10gY3R4cyA9IG5ldyBDb250\nZXh0W2V4cHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGV4cHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGN0eHNbaV0gPSBleHBz\nW2ldLmN0eCgpOwogICAgICAgIGxvY2FsQ29udGV4dC5zZXQoY2xvbmUoY3R4\ncywgbnVsbCkpOwogICAgICAgIGlmIChtZXRhcy5sZW5ndGggPiAxICYmIGV4\ncHNbMF0uaXNBZ2dyZWdhdGUoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oTG9jYWxpemVyLmZvclBhY2thZ2UoSkRCQ1N0b3JlUXVl\ncnkuY2xhc3MpLgogICAgICAgICAgICAgICAgZ2V0KCJtdWx0LW1hcHBpbmct\nYWdncmVnYXRlIiwgQXJyYXlzLmFzTGlzdChtZXRhcykpKTsKCiAgICAgICAg\nQ2xhc3NNYXBwaW5nW10gbWFwcGluZ3MgPSAoQ2xhc3NNYXBwaW5nW10pIG1l\ndGFzOwogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSAo\nSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgCiAgICAgICAgICAgIGN0eC5nZXRG\nZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBpZiAoZXhwc1swXS5mZXRj\naFBhdGhzICE9IG51bGwpIHsKICAgICAgICAgICAgZmV0Y2guYWRkRmllbGRz\nKEFycmF5cy5hc0xpc3QoZXhwc1swXS5mZXRjaFBhdGhzKSk7CiAgICAgICAg\nICAgIGZldGNoLmFkZEpvaW5zKEFycmF5cy5hc0xpc3QoZXhwc1swXS5mZXRj\naFBhdGhzKSk7CiAgICAgICAgfQogICAgICAgIGlmIChleHBzWzBdLmZldGNo\nSW5uZXJQYXRocyAhPSBudWxsKQogICAgICAgICAgICBmZXRjaC5hZGRGZXRj\naElubmVySm9pbnMoQXJyYXlzLmFzTGlzdChleHBzWzBdLmZldGNoSW5uZXJQ\nYXRocykpOwoKICAgICAgICBpbnQgZWFnZXIgPSBjYWxjdWxhdGVFYWdlck1v\nZGUoZXhwc1swXSwgcmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7CiAgICAgICAg\naW50IHN1YmNsYXNzTW9kZSA9IGZldGNoLmdldFN1YmNsYXNzRmV0Y2hNb2Rl\nKChDbGFzc01hcHBpbmcpIGJhc2UpOwogICAgICAgIERCRGljdGlvbmFyeSBk\naWN0ID0gX3N0b3JlLmdldERCRGljdGlvbmFyeSgpOwogICAgICAgIGxvbmcg\nc3RhcnQgPSAobWFwcGluZ3MubGVuZ3RoID09IDEgJiYgZGljdC5zdXBwb3J0\nc1NlbGVjdFN0YXJ0SW5kZXgpIAogICAgICAgICAgICA/IHJhbmdlLnN0YXJ0\nIDogMEw7CiAgICAgICAgbG9uZyBlbmQgPSAoZGljdC5zdXBwb3J0c1NlbGVj\ndEVuZEluZGV4KSA/IHJhbmdlLmVuZCA6IExvbmcuTUFYX1ZBTFVFOwoKICAg\nICAgICBRdWVyeUV4cHJlc3Npb25zU3RhdGVbXSBzdGF0ZXMgPSBuZXcgUXVl\ncnlFeHByZXNzaW9uc1N0YXRlW2V4cHMubGVuZ3RoXTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICBzdGF0ZXNbaV0gPSBuZXcgUXVlcnlFeHByZXNzaW9uc1N0YXRlKCk7\nCiAgICAgICAgICAgIGV4cHNbaV0uc3RhdGUgPSBzdGF0ZXNbaV07CiAgICAg\nICAgfQogICAgICAgIEV4cENvbnRleHQgY3R4ID0gbmV3IEV4cENvbnRleHQo\nX3N0b3JlLCBwYXJhbXMsIGZldGNoKTsKCiAgICAgICAgLy8gYWRkIHNlbGVj\ndHMgd2l0aCBwb3B1bGF0ZSBXSEVSRSBjb25kaXRpb25zIHRvIGxpc3QKICAg\nICAgICBMaXN0IHNlbHMgPSBuZXcgQXJyYXlMaXN0KG1hcHBpbmdzLmxlbmd0\naCk7CiAgICAgICAgTGlzdCBzZWxNYXBwaW5ncyA9IG5ldyBBcnJheUxpc3Qo\nbWFwcGluZ3MubGVuZ3RoKTsKICAgICAgICBCaXRTZXQgc3ViY2xhc3NCaXRz\nID0gbmV3IEJpdFNldCgpOwogICAgICAgIEJpdFNldCBuZXh0Qml0cyA9IG5l\ndyBCaXRTZXQoKTsKICAgICAgICBib29sZWFuIHVuaW9uYWJsZSA9IGNyZWF0\nZVdoZXJlU2VsZWN0cyhzZWxzLCBtYXBwaW5ncywgc2VsTWFwcGluZ3MsCiAg\nICAgICAgICAgIHN1YmNsYXNzZXMsIHN1YmNsYXNzQml0cywgbmV4dEJpdHMs\nIGZhY3RzLCBleHBzLCBzdGF0ZXMsIGN0eCwKICAgICAgICAgICAgc3ViY2xh\nc3NNb2RlKQogICAgICAgICAgICAmJiBzdWJjbGFzc01vZGUgPT0gSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbi5FQUdFUl9KT0lOCiAgICAgICAgICAgICYmIHN0\nYXJ0ID09IDAKICAgICAgICAgICAgJiYgZW5kID09IExvbmcuTUFYX1ZBTFVF\nOwoKICAgICAgICAvLyB3ZSBtaWdodCB3YW50IHRvIHVzZSBscnMgc2V0dGlu\nZ3MgaWYgd2UgY2FuJ3QgdXNlIHRoZSByYW5nZQogICAgICAgIGlmIChzZWxz\nLnNpemUoKSA+IDEpCiAgICAgICAgICAgIHN0YXJ0ID0gMEw7CiAgICAgICAg\nYm9vbGVhbiBscnMgPSByYW5nZS5scnMgfHwgKGZldGNoLmdldEZldGNoQmF0\nY2hTaXplKCkgPj0gMCAKICAgICAgICAgICAgJiYgKHN0YXJ0ICE9IHJhbmdl\nLnN0YXJ0IHx8IGVuZCAhPSByYW5nZS5lbmQpKTsKCiAgICAgICAgUmVzdWx0\nT2JqZWN0UHJvdmlkZXJbXSByb3BzID0gbnVsbDsKICAgICAgICBSZXN1bHRP\nYmplY3RQcm92aWRlciByb3AgPSBudWxsOwogICAgICAgIGlmICh1bmlvbmFi\nbGUpIHsKICAgICAgICAgICAgVW5pb24gdW5pb24gPSBfc3RvcmUuZ2V0U1FM\nRmFjdG9yeSgpLm5ld1VuaW9uKAogICAgICAgICAgICAgICAgKFNlbGVjdFtd\nKSBzZWxzLnRvQXJyYXkobmV3IFNlbGVjdFtzZWxzLnNpemUoKV0pKTsKICAg\nICAgICAgICAgQml0U2V0W10gcGFnZWQgPSBwb3B1bGF0ZVVuaW9uKHVuaW9u\nLCBtYXBwaW5ncywgc3ViY2xhc3NlcywgZmFjdHMsCiAgICAgICAgICAgICAg\nICBleHBzLCBzdGF0ZXMsIGN0eCwgbHJzLCBlYWdlciwgc3RhcnQsIGVuZCk7\nCiAgICAgICAgICAgIHVuaW9uLnNldExSUyhscnMpOwogICAgICAgICAgICBy\nb3AgPSBleGVjdXRlVW5pb24odW5pb24sIG1hcHBpbmdzLCBleHBzLCBzdGF0\nZXMsIGN0eCwgcGFnZWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGlmIChzZWxzLnNpemUoKSA+IDEpCiAgICAgICAgICAgICAgICByb3BzID0g\nbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVyW3NlbHMuc2l6ZSgpXTsKCiAgICAg\nICAgICAgIFNlbGVjdCBzZWw7CiAgICAgICAgICAgIEJpdFNldCBwYWdlZDsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGlkeCA9IDA7IGkgPCBzZWxz\nLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBzZWwgPSAoU2VsZWN0\nKSBzZWxzLmdldChpKTsKICAgICAgICAgICAgICAgIHBhZ2VkID0gcG9wdWxh\ndGVTZWxlY3Qoc2VsLCAoQ2xhc3NNYXBwaW5nKSBzZWxNYXBwaW5ncy5nZXQo\naSksCiAgICAgICAgICAgICAgICAgICAgc3ViY2xhc3NCaXRzLmdldChpKSwg\nKEpEQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFjdHNbaWR4XSwKICAgICAgICAg\nICAgICAgICAgICBleHBzW2lkeF0sIHN0YXRlc1tpZHhdLCBjdHgsIGxycywg\nZWFnZXIsIHN0YXJ0LCBlbmQpOwoKICAgICAgICAgICAgICAgIHJvcCA9IGV4\nZWN1dGVTZWxlY3Qoc2VsLCAoQ2xhc3NNYXBwaW5nKSBzZWxNYXBwaW5ncy5n\nZXQoaSksCiAgICAgICAgICAgICAgICAgICAgZXhwc1tpZHhdLCBzdGF0ZXNb\naWR4XSwgY3R4LCBwYWdlZCwgc3RhcnQsIGVuZCk7CiAgICAgICAgICAgICAg\nICBpZiAocm9wcyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJvcHNb\naV0gPSByb3A7CgogICAgICAgICAgICAgICAgaWYgKG5leHRCaXRzLmdldChp\nKSkKICAgICAgICAgICAgICAgICAgICBpZHgrKzsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgaWYgKHJvcHMgIT0gbnVsbCkgewogICAgICAg\nICAgICBpZiAoZXhwc1swXS5hc2NlbmRpbmcubGVuZ3RoID09IDApCiAgICAg\nICAgICAgICAgICByb3AgPSBuZXcgTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlk\nZXIocm9wcyk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAg\ncm9wID0gbmV3IE9yZGVyaW5nTWVyZ2VkUmVzdWx0T2JqZWN0UHJvdmlkZXIo\ncm9wcywKICAgICAgICAgICAgICAgICAgICBleHBzWzBdLmFzY2VuZGluZywg\nZXgsIHRoaXMsIHBhcmFtcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8vIG5lZWQgdG8gZmFrZSByZXN1bHQgcmFuZ2U/CiAgICAgICAg\naWYgKChyb3BzICE9IG51bGwgJiYgcmFuZ2UuZW5kICE9IExvbmcuTUFYX1ZB\nTFVFKSAKICAgICAgICAgICAgfHwgc3RhcnQgIT0gcmFuZ2Uuc3RhcnQgfHwg\nZW5kICE9IHJhbmdlLmVuZCkKICAgICAgICAgICAgcm9wID0gbmV3IFJhbmdl\nUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wLCByYW5nZS5zdGFydCwgcmFuZ2Uu\nZW5kKTsKCiAgICAgICAgbG9jYWxDb250ZXh0LnJlbW92ZSgpOwogICAgICAg\nIHJldHVybiByb3A7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgZGF0\nYSBmb3IgdGhlIGdpdmVuIHVuaW9uLCByZXR1cm5pbmcgcGFnZWQgZmllbGRz\nLgogICAgICovCiAgICBwcml2YXRlIEJpdFNldFtdIHBvcHVsYXRlVW5pb24o\nVW5pb24gdW5pb24sIGZpbmFsIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzLAog\nICAgICAgIGZpbmFsIGJvb2xlYW4gc3ViY2xhc3NlcywgZmluYWwgRXhwcmVz\nc2lvbkZhY3RvcnlbXSBmYWN0cywKICAgICAgICBmaW5hbCBRdWVyeUV4cHJl\nc3Npb25zW10gZXhwcywgZmluYWwgUXVlcnlFeHByZXNzaW9uc1N0YXRlW10g\nc3RhdGVzLAogICAgICAgIGZpbmFsIEV4cENvbnRleHQgY3R4LCBmaW5hbCBi\nb29sZWFuIGxycywgZmluYWwgaW50IGVhZ2VyLAogICAgICAgIGZpbmFsIGxv\nbmcgc3RhcnQsIGZpbmFsIGxvbmcgZW5kKSB7CiAgICAgICAgZmluYWwgQml0\nU2V0W10gcGFnZWQgPSAoZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5ndGggPiAw\nKSA/IG51bGwKICAgICAgICAgICAgOiBuZXcgQml0U2V0W21hcHBpbmdzLmxl\nbmd0aF07CiAgICAgICAgdW5pb24uc2VsZWN0KG5ldyBVbmlvbi5TZWxlY3Rv\ncigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBz\nZWwsIGludCBpZHgpIHsKICAgICAgICAgICAgICAgIEJpdFNldCBiaXRzID0g\ncG9wdWxhdGVTZWxlY3Qoc2VsLCBtYXBwaW5nc1tpZHhdLCBzdWJjbGFzc2Vz\nLAogICAgICAgICAgICAgICAgICAgIChKREJDRXhwcmVzc2lvbkZhY3Rvcnkp\nIGZhY3RzW2lkeF0sIGV4cHNbaWR4XSwgc3RhdGVzW2lkeF0sCiAgICAgICAg\nICAgICAgICAgICAgY3R4LCAgbHJzLCBlYWdlciwgc3RhcnQsIGVuZCk7CiAg\nICAgICAgICAgICAgICBpZiAocGFnZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICBwYWdlZFtpZHhdID0gYml0czsKICAgICAgICAgICAgfQogICAg\nICAgIH0pOwogICAgICAgIHJldHVybiBwYWdlZDsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNlbGVjdCBkYXRhIGZvciB0aGUgZ2l2ZW4gc2VsZWN0LCByZXR1\ncm5pbmcgcGFnZWQgZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIEJpdFNl\ndCBwb3B1bGF0ZVNlbGVjdChTZWxlY3Qgc2VsLCBDbGFzc01hcHBpbmcgbWFw\ncGluZywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMsIEpEQkNFeHByZXNz\naW9uRmFjdG9yeSBmYWN0LCBRdWVyeUV4cHJlc3Npb25zIGV4cHMsCiAgICAg\nICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlIHN0YXRlLCBFeHBDb250ZXh0IGN0\neCwgYm9vbGVhbiBscnMsIGludCBlYWdlciwKICAgICAgICBsb25nIHN0YXJ0\nLCBsb25nIGVuZCkgewogICAgICAgIHNlbC5zZXRMUlMobHJzKTsKICAgICAg\nICBzZWwuc2V0UmFuZ2Uoc3RhcnQsIGVuZCk7CgogICAgICAgIEJpdFNldCBw\nYWdlZCA9IG51bGw7CiAgICAgICAgaWYgKGV4cHMucHJvamVjdGlvbnMubGVu\nZ3RoID09IDApIHsKICAgICAgICAgICAgcGFnZWQgPSBQYWdpbmdSZXN1bHRP\nYmplY3RQcm92aWRlci5nZXRQYWdlZEZpZWxkcyhzZWwsIG1hcHBpbmcsCiAg\nICAgICAgICAgICAgICBfc3RvcmUsIGN0eC5mZXRjaCwgZWFnZXIsIGVuZCAt\nIHN0YXJ0KTsKICAgICAgICAgICAgaWYgKHBhZ2VkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICBlYWdlciA9IEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFH\nRVJfSk9JTjsKICAgICAgICB9CgogICAgICAgIGZhY3QuZ2V0U2VsZWN0Q29u\nc3RydWN0b3IoKS5zZWxlY3Qoc2VsLCBjdHgsIG1hcHBpbmcsIHN1YmNsYXNz\nZXMsIGV4cHMsCiAgICAgICAgICAgIHN0YXRlLCBlYWdlcik7CiAgICAgICAg\ncmV0dXJuIHBhZ2VkOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZSB0\naGUgZ2l2ZW4gdW5pb24uCiAgICAgKi8KICAgIHByaXZhdGUgUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgZXhlY3V0ZVVuaW9uKFVuaW9uIHVuaW9uLAogICAgICAg\nIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzLCBRdWVyeUV4cHJlc3Npb25zW10g\nZXhwcywgCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlW10gc3RhdGVz\nLCBFeHBDb250ZXh0IGN0eCwgQml0U2V0W10gcGFnZWQpIHsKICAgICAgICBp\nZiAoZXhwc1swXS5wcm9qZWN0aW9ucy5sZW5ndGggPiAwKQogICAgICAgICAg\nICByZXR1cm4gbmV3IFByb2plY3Rpb25SZXN1bHRPYmplY3RQcm92aWRlcih1\nbmlvbiwgZXhwcywgc3RhdGVzLCBjdHgpOwoKICAgICAgICBpZiAocGFnZWQg\nIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYWdl\nZC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChwYWdlZFtpXSAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUGFnaW5n\nUmVzdWx0T2JqZWN0UHJvdmlkZXIodW5pb24sIG1hcHBpbmdzLAogICAgICAg\nICAgICAgICAgICAgICAgICBfc3RvcmUsIGN0eC5mZXRjaCwgcGFnZWQsIExv\nbmcuTUFYX1ZBTFVFKTsKCiAgICAgICAgcmV0dXJuIG5ldyBJbnN0YW5jZVJl\nc3VsdE9iamVjdFByb3ZpZGVyKHVuaW9uLCBtYXBwaW5nc1swXSwgX3N0b3Jl\nLAogICAgICAgICAgICBjdHguZmV0Y2gpOwogICAgfQoKICAgIC8qKgogICAg\nICogRXhlY3V0ZSB0aGUgZ2l2ZW4gc2VsZWN0LgogICAgICovCiAgICBwcml2\nYXRlIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1dGVTZWxlY3QoU2VsZWN0\nIHNlbCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgUXVlcnlFeHBy\nZXNzaW9ucyBleHBzLCBRdWVyeUV4cHJlc3Npb25zU3RhdGUgc3RhdGUsIEV4\ncENvbnRleHQgY3R4LCAKICAgICAgICBCaXRTZXQgcGFnZWQsIGxvbmcgc3Rh\ncnQsIGxvbmcgZW5kKSB7CiAgICAgICAgaWYgKGV4cHMucHJvamVjdGlvbnMu\nbGVuZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9qZWN0aW9u\nUmVzdWx0T2JqZWN0UHJvdmlkZXIoc2VsLCBleHBzLCBzdGF0ZSwgY3R4KTsK\nICAgICAgICBpZiAocGFnZWQgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIG5ldyBQYWdpbmdSZXN1bHRPYmplY3RQcm92aWRlcihzZWwsIG1hcHBpbmcs\nIF9zdG9yZSwgCiAgICAgICAgICAgICAgICBjdHguZmV0Y2gsIHBhZ2VkLCBl\nbmQgLSBzdGFydCk7CiAgICAgICAgcmV0dXJuIG5ldyBJbnN0YW5jZVJlc3Vs\ndE9iamVjdFByb3ZpZGVyKHNlbCwgbWFwcGluZywgX3N0b3JlLCAKICAgICAg\nICAgICAgY3R4LmZldGNoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVy\nYXRlIHRoZSBzZWxlY3RzIHdpdGggV0hFUkUgY29uZGl0aW9ucyBuZWVkZWQg\ndG8gZXhlY3V0ZSB0aGUgcXVlcnkKICAgICAqIGZvciB0aGUgZ2l2ZW4gbWFw\ncGluZ3MuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBjcmVhdGVXaGVy\nZVNlbGVjdHMoTGlzdCBzZWxzLCBDbGFzc01hcHBpbmdbXSBtYXBwaW5ncywK\nICAgICAgICBMaXN0IHNlbE1hcHBpbmdzLCBib29sZWFuIHN1YmNsYXNzZXMs\nIEJpdFNldCBzdWJjbGFzc0JpdHMsCiAgICAgICAgQml0U2V0IG5leHRCaXRz\nLCBFeHByZXNzaW9uRmFjdG9yeVtdIGZhY3RzLCBRdWVyeUV4cHJlc3Npb25z\nW10gZXhwcywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zU3RhdGVbXSBzdGF0\nZXMsIEV4cENvbnRleHQgY3R4LCBpbnQgc3ViY2xhc3NNb2RlKSB7CiAgICAg\nICAgTnVtYmVyIG9wdEhpbnQgPSAoTnVtYmVyKSBjdHguZmV0Y2guZ2V0SGlu\ndAogICAgICAgICAgICAoUXVlcnlIaW50cy5ISU5UX1JFU1VMVF9DT1VOVCk7\nCiAgICAgICAgQ2xhc3NNYXBwaW5nW10gdmVydHM7CiAgICAgICAgYm9vbGVh\nbiB1bmlvbmFibGUgPSB0cnVlOwogICAgICAgIFNlbGVjdCBzZWw7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtYXBwaW5ncy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICAvLyBkZXRlcm1pbmUgdmVydGljYWwgbWFwcGluZ3Mg\ndG8gc2VsZWN0IHNlcGFyYXRlbHkKICAgICAgICAgICAgdmVydHMgPSBnZXRW\nZXJ0aWNhbE1hcHBpbmdzKG1hcHBpbmdzW2ldLCBzdWJjbGFzc2VzLCBleHBz\nW2ldLAogICAgICAgICAgICAgICAgc3ViY2xhc3NNb2RlKTsKICAgICAgICAg\nICAgaWYgKHZlcnRzLmxlbmd0aCA9PSAxICYmIHN1YmNsYXNzZXMpCiAgICAg\nICAgICAgICAgICBzdWJjbGFzc0JpdHMuc2V0KHNlbHMuc2l6ZSgpKTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBjcml0ZXJpYSBzZWxlY3QgYW5kIGNsb25l\nIGZvciBlYWNoIHZlcnQgbWFwcGluZwogICAgICAgICAgICBzZWwgPSAoKEpE\nQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFjdHNbaV0pLmdldFNlbGVjdENvbnN0\ncnVjdG9yKCkuCiAgICAgICAgICAgICAgICBldmFsdWF0ZShjdHgsIG51bGws\nIG51bGwsIGV4cHNbaV0sIHN0YXRlc1tpXSk7CiAgICAgICAgICAgIGlmIChv\ncHRIaW50ICE9IG51bGwpCiAgICAgICAgICAgICAgIHNlbC5zZXRFeHBlY3Rl\nZFJlc3VsdENvdW50KG9wdEhpbnQuaW50VmFsdWUoKSwgdHJ1ZSk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHRoaXMuY3R4LmlzVW5pcXVlKCkpCiAgICAgICAg\nICAgICAgICBzZWwuc2V0RXhwZWN0ZWRSZXN1bHRDb3VudCgxLCBmYWxzZSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgdmVydHMubGVuZ3Ro\nOyBqKyspIHsKICAgICAgICAgICAgICAgIHNlbE1hcHBpbmdzLmFkZCh2ZXJ0\nc1tqXSk7CiAgICAgICAgICAgICAgICBpZiAoaiA9PSB2ZXJ0cy5sZW5ndGgg\nLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEJpdHMuc2V0KHNlbHMu\nc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICBzZWxzLmFkZChzZWwpOwog\nICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2Vs\ncy5hZGQoc2VsLmZ1bGxDbG9uZSgxKSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHR1cm4gb2ZmIHVuaW9uaW5nIGlmIGEgZ2l2ZW4gaW5kZXBl\nbmRlbnQgbWFwcGluZyByZXF1aXJlcwogICAgICAgICAgICAvLyBtdWx0aXBs\nZSBzZWxlY3RzLCBvciBpZiB3ZSdyZSB1c2luZyBGUk9NIHNlbGVjdHMKICAg\nICAgICAgICAgaWYgKHZlcnRzLmxlbmd0aCA+IDEgfHwgc2VsLmdldEZyb21T\nZWxlY3QoKSAhPSBudWxsKQogICAgICAgICAgICAgICAgdW5pb25hYmxlID0g\nZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1bmlvbmFibGU7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYWxsIHRoZSB2ZXJ0aWNhbCBt\nYXBwaW5ncyB0byBzZWxlY3Qgc2VwYXJhdGVseS4gRGVwZW5kcyBvbgogICAg\nICogc3ViY2xhc3MgZmV0Y2ggbW9kZSBhbmQgdGhlIHR5cGUgb2YgcXVlcnku\nCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nW10gZ2V0VmVydGlj\nYWxNYXBwaW5ncyhDbGFzc01hcHBpbmcgbWFwcGluZywKICAgICAgICBib29s\nZWFuIHN1YmNsYXNzZXMsIFF1ZXJ5RXhwcmVzc2lvbnMgZXhwcywgaW50IHN1\nYmNsYXNzTW9kZSkgewogICAgICAgIGlmICghc3ViY2xhc3NlcyB8fCBleHBz\nLnByb2plY3Rpb25zLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiBu\nZXcgQ2xhc3NNYXBwaW5nW10geyBtYXBwaW5nIH07CgogICAgICAgIGlmIChz\ndWJjbGFzc01vZGUgIT0gSkRCQ0ZldGNoQ29uZmlndXJhdGlvbi5FQUdFUl9Q\nQVJBTExFTAogICAgICAgICAgICB8fCAhaGFzVmVydGljYWxTdWJjbGFzc2Vz\nKG1hcHBpbmcpKQogICAgICAgICAgICByZXR1cm4gbmV3IENsYXNzTWFwcGlu\nZ1tdIHsgbWFwcGluZyB9OwoKICAgICAgICBMaXN0IHN1YnMgPSBuZXcgQXJy\nYXlMaXN0KDQpOwogICAgICAgIGFkZFN1YmNsYXNzZXMobWFwcGluZywgc3Vi\ncyk7CiAgICAgICAgcmV0dXJuIChDbGFzc01hcHBpbmdbXSkgc3Vicy50b0Fy\ncmF5KG5ldyBDbGFzc01hcHBpbmdbc3Vicy5zaXplKCldKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgdG8gYWRkIG1hcHBpbmdz\nIGZvciBzdWJjbGFzc2VzIHRvIHRoZSBnaXZlbiBsaXN0LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NlcyhDbGFzc01hcHBpbmcgbWFw\ncGluZywgQ29sbGVjdGlvbiBzdWJzKSB7CiAgICAgICAgLy8gcG9zc2libGUg\nZnV0dXJlIG9wdGltaXphdGlvbnM6CiAgICAgICAgLy8gLSBpZiBubyBmaWVs\nZHMgaW4gbWV0YSBvciBpdHMgc3ViY2xhc3NlcyAoYW5kIG5vdCBpbiBhbgog\nICAgICAgIC8vICAgYWxyZWFkeS1zZWxlY3RlZCB0YWJsZSkgYXJlIGluIHRo\nZSBjdXJyZW50IGZldGNoCiAgICAgICAgLy8gICBjb25maWd1cmF0aW9uLCBz\ndG9wIGNyZWF0aW5nIG5ldyBleGVjdXRvcnMKICAgICAgICAvLyAtIGFsbG93\nIGFuIGV4ZWN1dG9yIHRvIHNlbGVjdCBhIHJhbmdlIG9mIHN1YmNsYXNzZXMs\nIHJhdGhlcgogICAgICAgIC8vICAgdGhhbiBqdXN0IGFsbCBzdWJjbGFzc2Vz\nIC8gbm8gc3ViY2xhc3NlczsgdGhpcyB3b3VsZAogICAgICAgIC8vICAgYWxs\nb3cgdXMgdG8gZG8ganVzdCBvbmUgcXVlcnkgcGVyIGFjdHVhbCB2ZXJ0aWNh\nbGx5LW1hcHBlZAogICAgICAgIC8vICAgc3ViY2xhc3MsIHJhdGhlciB0aGFu\nIG9uZSBwZXIgbWFwcGVkIHN1YmNsYXNzLCBhcyBpcyBoYXBwZW5pbmcgbm93\nCgogICAgICAgIHN1YnMuYWRkKG1hcHBpbmcpOwogICAgICAgIGlmICghaGFz\nVmVydGljYWxTdWJjbGFzc2VzKG1hcHBpbmcpKQogICAgICAgICAgICByZXR1\ncm47CgogICAgICAgIC8vIHJlY3Vyc2Ugb24gaW1tZWRpYXRlIHN1YmNsYXNz\nZXMKICAgICAgICBDbGFzc01hcHBpbmdbXSBzdWJNYXBwaW5ncyA9IG1hcHBp\nbmcuZ2V0Sm9pbmFibGVQQ1N1YmNsYXNzTWFwcGluZ3MoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHN1Yk1hcHBpbmdzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoc3ViTWFwcGluZ3NbaV0uZ2V0Sm9pbmFibGVQQ1N1\ncGVyY2xhc3NNYXBwaW5nKCkgPT0gbWFwcGluZykKICAgICAgICAgICAgICAg\nIGFkZFN1YmNsYXNzZXMoc3ViTWFwcGluZ3NbaV0sIHN1YnMpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIGdpdmVuIGNsYXNz\nIGhhcyBhbnkgdmVydGljYWwgc3ViY2xhc3Nlcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgYm9vbGVhbiBoYXNWZXJ0aWNhbFN1YmNsYXNzZXMoQ2xh\nc3NNYXBwaW5nIG1hcHBpbmcpIHsKICAgICAgICBDbGFzc01hcHBpbmdbXSBz\ndWJzID0gbWFwcGluZy5nZXRKb2luYWJsZVBDU3ViY2xhc3NNYXBwaW5ncygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3Vicy5sZW5ndGg7IGkr\nKykKICAgICAgICAgICAgaWYgKHN1YnNbaV0uZ2V0U3RyYXRlZ3koKSBpbnN0\nYW5jZW9mIFZlcnRpY2FsQ2xhc3NTdHJhdGVneSkKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoZSBlYWdlciBtb2RlIGRlcGVuZHMgb24gdGhlIHVu\naXF1ZSBzZXR0aW5nIGFuZCByYW5nZS4gSWYgdGhlIHJhbmdlCiAgICAgKiBw\ncm9kdWNlcyAwIHJlc3VsdHMsIHVzZSBlYWdlciBzZXR0aW5nIG9mIG5vbmUu\nIElmIGl0IHByb2R1Y2VzIDEgcmVzdWx0CiAgICAgKiBvciB0aGUgcXVlcnkg\naXMgdW5pcXVlLCB1c2UgYW4gZWFnZXIgc2V0dGluZyBvZiBzaW5nbGUuIE90\naGVyd2lzZSB1c2UKICAgICAqIGFuIGVhZ2VyIG1vZGUgb2YgbXVsdGlwbGUu\nCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGNhbGN1bGF0ZUVhZ2VyTW9kZShR\ndWVyeUV4cHJlc3Npb25zIGV4cHMsIGxvbmcgc3RhcnQsCiAgICAgICAgbG9u\nZyBlbmQpIHsKICAgICAgICBpZiAoZXhwcy5wcm9qZWN0aW9ucy5sZW5ndGgg\nPiAwIHx8IHN0YXJ0ID49IGVuZCkKICAgICAgICAgICAgcmV0dXJuIEVhZ2Vy\nRmV0Y2hNb2Rlcy5FQUdFUl9OT05FOwogICAgICAgIGlmIChlbmQgLSBzdGFy\ndCA9PSAxIHx8IGN0eC5pc1VuaXF1ZSgpKQogICAgICAgICAgICByZXR1cm4g\nRWFnZXJGZXRjaE1vZGVzLkVBR0VSX0pPSU47CiAgICAgICAgcmV0dXJuIEVh\nZ2VyRmV0Y2hNb2Rlcy5FQUdFUl9QQVJBTExFTDsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgTnVtYmVyIGV4ZWN1dGVEZWxldGUoRXhlY3V0b3IgZXgsIENsYXNz\nTWV0YURhdGEgYmFzZSwKICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMs\nIGJvb2xlYW4gc3ViY2xhc3NlcywgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0\ncywKICAgICAgICBRdWVyeUV4cHJlc3Npb25zW10gZXhwcywgT2JqZWN0W10g\ncGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1dGVCdWxrT3BlcmF0aW9u\nKG1ldGFzLCBzdWJjbGFzc2VzLCBmYWN0cywgZXhwcywKICAgICAgICAgICAg\ncGFyYW1zLCBudWxsKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgTnVtYmVyIGV4\nZWN1dGVVcGRhdGUoRXhlY3V0b3IgZXgsIENsYXNzTWV0YURhdGEgYmFzZSwK\nICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMsIGJvb2xlYW4gc3ViY2xh\nc3NlcywgRXhwcmVzc2lvbkZhY3RvcnlbXSBmYWN0cywKICAgICAgICBRdWVy\neUV4cHJlc3Npb25zW10gZXhwcywgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAg\nICAgcmV0dXJuIGV4ZWN1dGVCdWxrT3BlcmF0aW9uKG1ldGFzLCBzdWJjbGFz\nc2VzLCBmYWN0cywgZXhwcywKICAgICAgICAgICAgcGFyYW1zLCBleHBzWzBd\nLnVwZGF0ZXMpOwogICAgfQoKICAgIHByaXZhdGUgTnVtYmVyIGV4ZWN1dGVC\ndWxrT3BlcmF0aW9uKENsYXNzTWV0YURhdGFbXSBtZXRhcywKICAgICAgICBi\nb29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0b3J5W10gZmFjdHMs\nIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLAogICAgICAgIE9iamVjdFtdIHBh\ncmFtcywgTWFwIHVwZGF0ZXMpIHsKICAgICAgICBDb250ZXh0W10gY3R4cyA9\nIG5ldyBDb250ZXh0W2V4cHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGV4cHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGN0eHNb\naV0gPSBleHBzW2ldLmN0eCgpOwogICAgICAgIGxvY2FsQ29udGV4dC5zZXQo\nY2xvbmUoY3R4cywgbnVsbCkpOwogICAgICAgIAogICAgICAgIC8vIHdlIGNh\nbm5vdCBleGVjdXRlIGEgYnVsayBkZWxldGUgc3RhdGVtZW50IHdoZW4gaGF2\nZSBtYXBwaW5ncyBpbgogICAgICAgIC8vIG11bHRpcGxlIHRhYmxlcywgc28g\naW5kaWNhdGUgd2Ugd2FudCB0byB1c2UgaW4tbWVtb3J5IHdpdGggbnVsbAog\nICAgICAgIENsYXNzTWFwcGluZ1tdIG1hcHBpbmdzID0gKENsYXNzTWFwcGlu\nZ1tdKSBtZXRhczsKCiAgICAgICAgLy8gc3BlY2lmaWNhdGlvbiBvZiB0aGUg\nInVwZGF0ZXMiIG1hcCBpbmRpY2F0ZXMgdGhhdCB0aGlzIGlzCiAgICAgICAg\nLy8gYW4gdXBkYXRlIHF1ZXJ5OyBvdGhlcndpc2UsIHRoaXMgaXMgYSBkZWxl\ndGUgc3RhdGVtZW50CiAgICAgICAgYm9vbGVhbiBpc1VwZGF0ZSA9IHVwZGF0\nZXMgIT0gbnVsbCAmJiB1cGRhdGVzLnNpemUoKSA+IDA7CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKCFpc1NpbmdsZVRhYmxlTWFwcGluZyhtYXBwaW5nc1tp\nXSwgc3ViY2xhc3NlcykgJiYgIWlzVXBkYXRlKQogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CgogICAgICAgICAgICBpZiAoIWlzVXBkYXRlKSB7CiAg\nICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgYW55IGRlbGV0ZSBjYWxs\nYmFja3MsIHdlIG5lZWQgdG8KICAgICAgICAgICAgICAgIC8vIGV4ZWN1dGUg\naW4tbWVtb3J5IHNvIHRoZSBjYWxsYmFja3MgYXJlIGludm9rZWQKICAgICAg\nICAgICAgICAgIExpZmVjeWNsZUV2ZW50TWFuYWdlciBtZ3IgPSBjdHguZ2V0\nU3RvcmVDb250ZXh0KCkuZ2V0QnJva2VyKCkKICAgICAgICAgICAgICAgICAg\nICAuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VyKCk7CiAgICAgICAgICAgICAg\nICBpZiAobWdyLmhhc0RlbGV0ZUxpc3RlbmVycyhudWxsLCBtYXBwaW5nc1tp\nXSkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2ggPSAoSkRCQ0ZldGNoQ29uZmlndXJhdGlvbikgCiAgICAgICAg\nICAgIGN0eC5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBFeHBD\nb250ZXh0IGN0eCA9IG5ldyBFeHBDb250ZXh0KF9zdG9yZSwgcGFyYW1zLCBm\nZXRjaCk7CiAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBfc3RvcmUuZ2V0\nREJEaWN0aW9uYXJ5KCk7CiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRl\nW10gc3RhdGUgPSBuZXcgUXVlcnlFeHByZXNzaW9uc1N0YXRlW2V4cHMubGVu\nZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YXRlLmxlbmd0\naDsgaSsrKQogICAgICAgICAgICBzdGF0ZVtpXSA9IG5ldyBRdWVyeUV4cHJl\nc3Npb25zU3RhdGUoKTsKCiAgICAgICAgU1FMQnVmZmVyW10gc3FsID0gbmV3\nIFNRTEJ1ZmZlclttYXBwaW5ncy5sZW5ndGhdOwogICAgICAgIEpEQkNFeHBy\nZXNzaW9uRmFjdG9yeSBqZGJjRmFjdG9yeTsKICAgICAgICBTZWxlY3Qgc2Vs\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFwcGluZ3MubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgamRiY0ZhY3RvcnkgPSAoSkRCQ0V4cHJl\nc3Npb25GYWN0b3J5KSBmYWN0c1tpXTsKICAgICAgICAgICAgc2VsID0gamRi\nY0ZhY3RvcnkuZ2V0U2VsZWN0Q29uc3RydWN0b3IoKS5ldmFsdWF0ZShjdHgs\nIG51bGwsIG51bGwsCiAgICAgICAgICAgICAgICBleHBzW2ldLCBzdGF0ZVtp\nXSk7CiAgICAgICAgICAgIGpkYmNGYWN0b3J5LmdldFNlbGVjdENvbnN0cnVj\ndG9yKCkuc2VsZWN0KHNlbCwgY3R4LCBtYXBwaW5nc1tpXSwgCiAgICAgICAg\nICAgICAgICBzdWJjbGFzc2VzLCBleHBzW2ldLCBzdGF0ZVtpXSwgCiAgICAg\nICAgICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VSX05PTkUp\nOwoKICAgICAgICAgICAgLy8gVGhlIGJ1bGsgb3BlcmF0aW9uIHdpbGwgcmV0\ndXJuIG51bGwgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZGF0YWJhc2UKICAgICAg\nICAgICAgLy8gZG9lcyBub3Qgc3VwcG9ydCB0aGUgcmVxdWVzdCBidWxrIGRl\nbGV0ZSBvcGVyYXRpb247IGluCiAgICAgICAgICAgIC8vIHRoaXMgY2FzZSwg\nd2UgbmVlZCB0byBwZXJmb3JtIHRoZSBxdWVyeSBpbi1tZW1vcnkgYW5kCiAg\nICAgICAgICAgIC8vIG1hbnVhbGx5IGRlbGV0ZSB0aGUgaW5zdGFuY2VzCiAg\nICAgICAgICAgIGlmICghaXNVcGRhdGUpCiAgICAgICAgICAgICAgICBzcWxb\naV0gPSBkaWN0LnRvRGVsZXRlKG1hcHBpbmdzW2ldLCBzZWwsIHBhcmFtcyk7\nCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNxbFtpXSA9IGRp\nY3QudG9VcGRhdGUobWFwcGluZ3NbaV0sIHNlbCwgX3N0b3JlLCBwYXJhbXMs\nCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlcyk7CgogICAgICAgICAgICBp\nZiAoc3FsW2ldID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIC8vIHdlIG5lZWQgdG8gbWFrZSBzdXJl\nIHdlIGhhdmUgYW4gYWN0aXZlIHN0b3JlIGNvbm5lY3Rpb24KICAgICAgICBf\nc3RvcmUuZ2V0Q29udGV4dCgpLmJlZ2luU3RvcmUoKTsKCiAgICAgICAgQ29u\nbmVjdGlvbiBjb25uID0gX3N0b3JlLmdldENvbm5lY3Rpb24oKTsKICAgICAg\nICBsb25nIGNvdW50ID0gMDsKICAgICAgICB0cnkgewogICAgICAgICAgICBQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udDsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBzcWwubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAg\nIHN0bW50ID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgc3RtbnQgPSBwcmVwYXJlU3RhdGVtZW50KGNvbm4sIHNx\nbFtpXSk7CiAgICAgICAgICAgICAgICAgICAgZGljdC5zZXRUaW1lb3V0cyhz\ndG1udCwgZmV0Y2gsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvdW50\nICs9IGV4ZWN1dGVVcGRhdGUoY29ubiwgc3RtbnQsIHNxbFtpXSwgaXNVcGRh\ndGUpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgU1FMRXhjZXB0aW9ucy5n\nZXRTdG9yZShzZSwgc3FsW2ldLmdldFNRTCgpLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgX3N0b3JlLmdldERCRGljdGlvbmFyeSgpKTsKICAgICAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0\nbW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7IHN0\nbW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgIH0KCiAgICAgICAgbG9jYWxD\nb250ZXh0LnJlbW92ZSgpOwogICAgICAgIHJldHVybiBjb3VudDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGdpdmVuIG1hcHBpbmcgb2Nj\ndXBpZXMgb25seSBvbmUgdGFibGUuCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiBpc1NpbmdsZVRhYmxlTWFwcGluZyhDbGFzc01hcHBpbmcgbWFwcGlu\nZywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMpIHsKICAgICAgICBDbGFz\nc01hcHBpbmcgcm9vdCA9IG1hcHBpbmc7CiAgICAgICAgd2hpbGUgKHJvb3Qu\nZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAg\nICAgICAgICAgcm9vdCA9IHJvb3QuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NN\nYXBwaW5nKCk7CiAgICAgICAgaWYgKGhhc1ZlcnRpY2FsU3ViY2xhc3Nlcyhy\nb290KSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB3\nZSBjYW5ub3QgZXhlY3V0ZSBhIGJ1bGsgZGVsZXRlIGlmIGFueSBvZiB0aGUK\nICAgICAgICAvLyBmaWVsZCBtYXBwaW5ncyBmb3IgdGhlIGNhbmRpZGF0ZXMg\naGF2ZSBjb2x1bW5zCiAgICAgICAgLy8gaW4gYW55IG90aGVyIHRhYmxlLCBz\naW5jZSBidWxrIGRlbGV0aW5nIGp1c3QgZnJvbSB0aGUKICAgICAgICAvLyBj\nbGFzcyB3aWxsIGxlYXZlIGRhbmdsaW5nIHJlbGF0aW9uczsgd2UgbWlnaHQg\nYmUgYWJsZQogICAgICAgIC8vIHRvIGlzc3VlIGJ1bGsgZGVsZXRlcyBzZXBh\ncmF0ZWx5IGZvciB0aGUgam9pbnMgKHBvc3NpYmx5CiAgICAgICAgLy8gdXNp\nbmcgYSB0ZW1wb3JhcnkgdGFibGUgdG8gc2VsZWN0IHRoZSBwcmltYXJ5IGtl\neXMgZm9yCiAgICAgICAgLy8gYWxsIHRoZSByZWxhdGVkIHRhYmxlcyBhbmQg\ndGhlbiBpc3NpbmcgYSBkZWxldGUgYWdhaW5zdCB0aG9zZQogICAgICAgIC8v\nIGtleXMpLCBidXQgdGhhdCBsb2dpYyBpcyBub3QgY3VycmVudGx5IGltcGxl\nbWVudGVkCiAgICAgICAgVGFibGUgdGFibGUgPSBnZXRUYWJsZShtYXBwaW5n\nLmdldEZpZWxkTWFwcGluZ3MoKSwgbnVsbCk7CiAgICAgICAgaWYgKHRhYmxl\nID09IElOVkFMSUQpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgaWYgKHN1YmNsYXNzZXMpIHsKICAgICAgICAgICAgLy8gaWYgd2UgYXJl\nIGluY2x1ZGluZyBzdWJjbGFzc2VzLCB3ZSBhbHNvIG5lZWQgdG8gZ2F0aGVy\nCiAgICAgICAgICAgIC8vIGFsbCB0aGUgbWFwcGluZ3MgZm9yIGFsbCBrbm93\nbiBzdWJjbGFzc2VzCiAgICAgICAgICAgIENsYXNzTWFwcGluZ1tdIHN1YnMg\nPSBtYXBwaW5nLmdldEpvaW5hYmxlUENTdWJjbGFzc01hcHBpbmdzKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBzdWJzICE9IG51bGwgJiYgaSA8\nIHN1YnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRhYmxlID0g\nZ2V0VGFibGUoc3Vic1tpXS5nZXREZWZpbmVkRmllbGRNYXBwaW5ncygpLCB0\nYWJsZSk7CiAgICAgICAgICAgICAgICBpZiAodGFibGUgPT0gSU5WQUxJRCkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHNpbmdsZSB0YWJsZSBmb3IgdGhlIGdp\ndmVuIGZpZWxkcywgb3IgSU5WQUxJRCBpZiB0aGV5CiAgICAgKiB1c2UgbXVs\ndGlwbGUgdGFibGVzLgogICAgICovCiAgICBwcml2YXRlIFRhYmxlIGdldFRh\nYmxlKEZpZWxkTWFwcGluZ1tdIGZpZWxkcywgVGFibGUgdGFibGUpIHsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICB0YWJsZSA9IGdldFRhYmxlKGZpZWxkc1tpXSwgdGFi\nbGUpOwogICAgICAgICAgICBpZiAodGFibGUgPT0gSU5WQUxJRCkKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGFi\nbGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHRhYmxlIGZv\nciB0aGUgZmllbGQgaWYgdGhlIGdpdmVuIHRhYmxlIGhhc24ndCBiZWVuIHNl\ndAogICAgICogeWV0LCBvciBpZiB0aGUgdGFibGVzIG1hdGNoLiBJZiB0aGUg\nZmllbGQgdXNlcyBhIGRpZmZlcmVudCB0YWJsZSwKICAgICAqIHJldHVybnMg\nSU5WQUxJRC4gQWxzbyByZXR1cm5zIElOVkFMSUQgaWYgZmllbGQgaXMgZGVw\nZW5kZW50LgogICAgICovCiAgICBwcml2YXRlIFRhYmxlIGdldFRhYmxlKEZp\nZWxkTWFwcGluZyBmbSwgVGFibGUgdGFibGUpIHsKICAgICAgICBpZiAoZm0u\nZ2V0Q2FzY2FkZURlbGV0ZSgpICE9IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9O\nT05FIAogICAgICAgICAgICAmJiAhZm0uaXNFbWJlZGRlZFBDKCkpCiAgICAg\nICAgICAgIHJldHVybiBJTlZBTElEOwoKICAgICAgICBDb2x1bW5bXSBjb2x1\nbW5zID0gZm0uZ2V0Q29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBjb2x1bW5zICE9IG51bGwgJiYgaSA8IGNvbHVtbnMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKHRhYmxlID09IG51bGwpCiAgICAgICAgICAg\nICAgICB0YWJsZSA9IGNvbHVtbnNbaV0uZ2V0VGFibGUoKTsKICAgICAgICAg\nICAgZWxzZSBpZiAodGFibGUgIT0gY29sdW1uc1tpXS5nZXRUYWJsZSgpKQog\nICAgICAgICAgICAgICAgcmV0dXJuIElOVkFMSUQ7CiAgICAgICAgfQogICAg\nICAgIGlmIChmbS5pc0JpZGlyZWN0aW9uYWxKb2luVGFibGVNYXBwaW5nT3du\nZXIoKSkKICAgICAgICAJcmV0dXJuIElOVkFMSUQ7CiAgICAgICAgcmV0dXJu\nIHRhYmxlOwogICAgfQoKICAgIHByb3RlY3RlZCBOdW1iZXIgZXhlY3V0ZVVw\nZGF0ZShDbGFzc01ldGFEYXRhIGJhc2UsIENsYXNzTWV0YURhdGFbXSBtZXRh\ncywKICAgICAgICBib29sZWFuIHN1YmNsYXNzZXMsIEV4cHJlc3Npb25GYWN0\nb3J5W10gZmFjdHMsCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1tdIHBhcnNl\nZCwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHJvdGVjdGVkIFN0cmluZ1tdIGdldERhdGFTdG9yZUFjdGlv\nbnMoQ2xhc3NNZXRhRGF0YSBiYXNlLAogICAgICAgIENsYXNzTWV0YURhdGFb\nXSBtZXRhcywgYm9vbGVhbiBzdWJjbGFzc2VzLCBFeHByZXNzaW9uRmFjdG9y\neVtdIGZhY3RzLAogICAgICAgIFF1ZXJ5RXhwcmVzc2lvbnNbXSBleHBzLCBP\nYmplY3RbXSBwYXJhbXMsIFJhbmdlIHJhbmdlKSB7CiAgICAgICAgQ29udGV4\ndFtdIGN0eHMgPSBuZXcgQ29udGV4dFtleHBzLmxlbmd0aF07CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBleHBzLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICBjdHhzW2ldID0gZXhwc1tpXS5jdHgoKTsKICAgICAgICBsb2NhbENv\nbnRleHQuc2V0KGNsb25lKGN0eHMsIG51bGwpKTsKICAgICAgICBDbGFzc01h\ncHBpbmdbXSBtYXBwaW5ncyA9IChDbGFzc01hcHBpbmdbXSkgbWV0YXM7CiAg\nICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCA9IChKREJDRmV0\nY2hDb25maWd1cmF0aW9uKSBjdHguCiAgICAgICAgICAgIGdldEZldGNoQ29u\nZmlndXJhdGlvbigpOwogICAgICAgIGlmIChleHBzWzBdLmZldGNoUGF0aHMg\nIT0gbnVsbCkgewogICAgICAgICAgICBmZXRjaC5hZGRGaWVsZHMoQXJyYXlz\nLmFzTGlzdChleHBzWzBdLmZldGNoUGF0aHMpKTsKICAgICAgICAgICAgZmV0\nY2guYWRkSm9pbnMoQXJyYXlzLmFzTGlzdChleHBzWzBdLmZldGNoUGF0aHMp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKGV4cHNbMF0uZmV0Y2hJbm5lclBh\ndGhzICE9IG51bGwpCiAgICAgICAgICAgIGZldGNoLmFkZEZldGNoSW5uZXJK\nb2lucyhBcnJheXMuYXNMaXN0KGV4cHNbMF0uZmV0Y2hJbm5lclBhdGhzKSk7\nCgogICAgICAgIGludCBlYWdlciA9IGNhbGN1bGF0ZUVhZ2VyTW9kZShleHBz\nWzBdLCByYW5nZS5zdGFydCwgcmFuZ2UuZW5kKTsKICAgICAgICBlYWdlciA9\nIE1hdGgubWluKGVhZ2VyLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uLkVBR0VS\nX0pPSU4pOwogICAgICAgIGludCBzdWJjbGFzc01vZGUgPSBmZXRjaC5nZXRT\ndWJjbGFzc0ZldGNoTW9kZSgoQ2xhc3NNYXBwaW5nKSBiYXNlKTsKICAgICAg\nICBEQkRpY3Rpb25hcnkgZGljdCA9IF9zdG9yZS5nZXREQkRpY3Rpb25hcnko\nKTsKICAgICAgICBsb25nIHN0YXJ0ID0gKG1hcHBpbmdzLmxlbmd0aCA9PSAx\nICYmIGRpY3Quc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4KSAKICAgICAgICAg\nICAgPyByYW5nZS5zdGFydCA6IDBMOwogICAgICAgIGxvbmcgZW5kID0gKGRp\nY3Quc3VwcG9ydHNTZWxlY3RFbmRJbmRleCkgPyByYW5nZS5lbmQgOiBMb25n\nLk1BWF9WQUxVRTsKCiAgICAgICAgUXVlcnlFeHByZXNzaW9uc1N0YXRlW10g\nc3RhdGVzID0gbmV3IFF1ZXJ5RXhwcmVzc2lvbnNTdGF0ZVtleHBzLmxlbmd0\naF07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGF0ZXMubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgIHN0YXRlc1tpXSA9IG5ldyBRdWVyeUV4cHJl\nc3Npb25zU3RhdGUoKTsKICAgICAgICBFeHBDb250ZXh0IGN0eCA9IG5ldyBF\neHBDb250ZXh0KF9zdG9yZSwgcGFyYW1zLCBmZXRjaCk7CgogICAgICAgIC8v\nIGFkZCBzZWxlY3RzIHdpdGggcG9wdWxhdGUgV0hFUkUgY29uZGl0aW9ucyB0\nbyBsaXN0CiAgICAgICAgTGlzdCBzZWxzID0gbmV3IEFycmF5TGlzdChtYXBw\naW5ncy5sZW5ndGgpOwogICAgICAgIExpc3Qgc2VsTWFwcGluZ3MgPSBuZXcg\nQXJyYXlMaXN0KG1hcHBpbmdzLmxlbmd0aCk7CiAgICAgICAgQml0U2V0IHN1\nYmNsYXNzQml0cyA9IG5ldyBCaXRTZXQoKTsKICAgICAgICBCaXRTZXQgbmV4\ndEJpdHMgPSBuZXcgQml0U2V0KCk7CiAgICAgICAgYm9vbGVhbiB1bmlvbmFi\nbGUgPSBjcmVhdGVXaGVyZVNlbGVjdHMoc2VscywgbWFwcGluZ3MsIHNlbE1h\ncHBpbmdzLAogICAgICAgICAgICBzdWJjbGFzc2VzLCBzdWJjbGFzc0JpdHMs\nIG5leHRCaXRzLCBmYWN0cywgZXhwcywgc3RhdGVzLCBjdHgsIAogICAgICAg\nICAgICBzdWJjbGFzc01vZGUpICYmIHN1YmNsYXNzTW9kZSA9PSBKREJDRmV0\nY2hDb25maWd1cmF0aW9uLkVBR0VSX0pPSU47CiAgICAgICAgaWYgKHNlbHMu\nc2l6ZSgpID4gMSkKICAgICAgICAgICAgc3RhcnQgPSAwTDsKCiAgICAgICAg\naWYgKHVuaW9uYWJsZSkgewogICAgICAgICAgICBVbmlvbiB1bmlvbiA9IF9z\ndG9yZS5nZXRTUUxGYWN0b3J5KCkubmV3VW5pb24oCiAgICAgICAgICAgICAg\nICAoU2VsZWN0W10pIHNlbHMudG9BcnJheShuZXcgU2VsZWN0W3NlbHMuc2l6\nZSgpXSkpOwogICAgICAgICAgICBwb3B1bGF0ZVVuaW9uKHVuaW9uLCBtYXBw\naW5ncywgc3ViY2xhc3NlcywgZmFjdHMsIGV4cHMsIHN0YXRlcywgY3R4LAog\nICAgICAgICAgICAgICAgZmFsc2UsIGVhZ2VyLCBzdGFydCwgZW5kKTsKICAg\nICAgICAgICAgaWYgKHVuaW9uLmlzVW5pb24oKSkKICAgICAgICAgICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nW10ge3VuaW9uLnRvU2VsZWN0KGZhbHNlLCBm\nZXRjaCkuZ2V0U1FMKHRydWUpfTsKICAgICAgICAgICAgc2VscyA9IEFycmF5\ncy5hc0xpc3QodW5pb24uZ2V0U2VsZWN0cygpKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBTZWxlY3Qgc2VsOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMCwgaWR4ID0gMDsgaSA8IHNlbHMuc2l6ZSgpOyBpKyspIHsKICAg\nICAgICAgICAgICAgIHNlbCA9IChTZWxlY3QpIHNlbHMuZ2V0KGkpOwogICAg\nICAgICAgICAgICAgcG9wdWxhdGVTZWxlY3Qoc2VsLCAoQ2xhc3NNYXBwaW5n\nKSBzZWxNYXBwaW5ncy5nZXQoaSksCiAgICAgICAgICAgICAgICAgICAgc3Vi\nY2xhc3NCaXRzLmdldChpKSwgKEpEQkNFeHByZXNzaW9uRmFjdG9yeSkgZmFj\ndHNbaWR4XSwKICAgICAgICAgICAgICAgICAgICBleHBzW2lkeF0sIHN0YXRl\nc1tpZHhdLCBjdHgsIGZhbHNlLCBlYWdlciwgc3RhcnQsIGVuZCk7CiAgICAg\nICAgICAgICAgICBpZiAobmV4dEJpdHMuZ2V0KGkpKQogICAgICAgICAgICAg\nICAgICAgIGlkeCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBTdHJpbmdbXSBzcWwgPSBuZXcgU3RyaW5nW3NlbHMuc2l6ZSgpXTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlbHMuc2l6ZSgpOyBpKyspCiAg\nICAgICAgICAgIHNxbFtpXSA9ICgoU2VsZWN0KSBzZWxzLmdldChpKSkudG9T\nZWxlY3QoZmFsc2UsIGZldGNoKS5nZXRTUUwodHJ1ZSk7CgogICAgICAgIGxv\nY2FsQ29udGV4dC5yZW1vdmUoKTsKICAgICAgICByZXR1cm4gc3FsOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3Zp\nZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAq\nIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyB1cGRhdGUuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBpbnQgZXhlY3V0ZVVwZGF0ZShDb25uZWN0aW9uIGNv\nbm4sIFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCAKICAgICAgICBTUUxCdWZm\nZXIgc3FsQnVmLCBib29sZWFuIGlzVXBkYXRlKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gc3RtbnQuZXhlY3V0ZVVwZGF0ZSgpOwog\nICAgfQogICAgICAgICAgICAKICAgIC8qKgogICAgICogVGhpcyBtZXRob2Qg\naXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3IgSkRCQy1s\naWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgcHJlcGFyaW5nIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHJvdGVjdGVkIFByZXBhcmVkU3RhdGVtZW50\nIHByZXBhcmVTdGF0ZW1lbnQoQ29ubmVjdGlvbiBjb25uLCBTUUxCdWZmZXIg\nc3FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBzcWwucHJlcGFyZVN0YXRlbWVudChjb25uKTsKICAgIH0gICAgCgog\nICAgcHVibGljIE9iamVjdCBldmFsdWF0ZShPYmplY3QgdmFsdWUsIE9iamVj\ndCBvYiwgT2JqZWN0W10gcGFyYW1zLCAKICAgICAgICBPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtKSB7CiAgICAgICAgaW50IGlkID0gMDsKICAgICAgICBpZiAo\ndmFsdWUgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuZXhwcy5WYWwpCiAgICAgICAgICAgIGlkID0gKChvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWwpdmFsdWUpLmdldElkKCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRF\neGNlcHRpb24oKTsgCgogICAgICAgIHN3aXRjaChpZCkgewogICAgICAgIGNh\nc2UgVmFsLk1BVEhfVkFMOgogICAgICAgICAgICByZXR1cm4gaGFuZGxlTWF0\naFZhbCh2YWx1ZSwgb2IsIHBhcmFtcywgc20pOwogICAgICAgIGNhc2UgVmFs\nLkNPTkNBVF9WQUw6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVDb25jYXRW\nYWwodmFsdWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5T\nVUJTVFJJTkdfVkFMOgogICAgICAgICAgICByZXR1cm4gaGFuZGxlU3Vic3Ry\naW5nVmFsKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgY2FzZSBW\nYWwuQVJHU19WQUw6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVBcmdzVmFs\nKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAgICAgY2FzZSBWYWwuTE9X\nRVJfVkFMOgogICAgICAgICAgICByZXR1cm4gaGFuZGxlTG93ZXJWYWwodmFs\ndWUsIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5VUFBFUl9W\nQUw6CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVVcHBlclZhbCh2YWx1ZSwg\nb2IsIHBhcmFtcywgc20pOwogICAgICAgIGNhc2UgVmFsLkxFTkdUSF9WQUw6\nCiAgICAgICAgICAgIHJldHVybiBoYW5kbGVMZW5ndGhWYWwodmFsdWUsIG9i\nLCBwYXJhbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5UUklNX1ZBTDoKICAg\nICAgICAgICAgcmV0dXJuIGhhbmRsZVRyaW1WYWwodmFsdWUsIG9iLCBwYXJh\nbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5JTkRFWE9GX1ZBTDoKICAgICAg\nICAgICAgcmV0dXJuIGhhbmRsZUluZGV4T2ZWYWwodmFsdWUsIG9iLCBwYXJh\nbXMsIHNtKTsKICAgICAgICBjYXNlIFZhbC5BQlNfVkFMOgogICAgICAgICAg\nICByZXR1cm4gaGFuZGxlQWJzVmFsKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7\nCiAgICAgICAgY2FzZSBWYWwuU1FSVF9WQUw6CiAgICAgICAgICAgIHJldHVy\nbiBoYW5kbGVTcXJ0VmFsKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7CiAgICAg\nICAgZGVmYXVsdDogICAgCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIE9iamVjdCBoYW5kbGVNYXRoVmFsKE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9i\nLCBPYmplY3RbXSBwYXJhbXMsIAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFn\nZXIgc20pIHsKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuZXhwcy5NYXRoIG1hdGhWYWwgPQogICAgICAgICAgICAob3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuTWF0aCkgdmFsdWU7CiAgICAg\nICAgVmFsIHZhbHVlMSA9IG1hdGhWYWwuZ2V0VmFsMSgpOwogICAgICAgIE9i\namVjdCB2YWwxID0gZ2V0VmFsdWUodmFsdWUxLCBvYiwgcGFyYW1zLCBzbSk7\nCiAgICAgICAgQ2xhc3MgYzEgPSB2YWx1ZTEuZ2V0VHlwZSgpOwoKICAgICAg\nICBWYWwgdmFsdWUyID0gbWF0aFZhbC5nZXRWYWwyKCk7CiAgICAgICAgT2Jq\nZWN0IHZhbDIgPSBnZXRWYWx1ZSh2YWx1ZTIsIG9iLCBwYXJhbXMsIHNtKTsK\nICAgICAgICBDbGFzcyBjMiA9IHZhbHVlMi5nZXRUeXBlKCk7CgogICAgICAg\nIFN0cmluZyBvcCA9IG1hdGhWYWwuZ2V0T3BlcmF0aW9uKCk7CiAgICAgICAg\naWYgKG9wLmVxdWFscyhvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwu\nZXhwcy5NYXRoLkFERCkpIAogICAgICAgICAgICByZXR1cm4gRmlsdGVycy5h\nZGQodmFsMSwgYzEsIHZhbDIsIGMyKTsKICAgICAgICBlbHNlIGlmIChvcC5l\ncXVhbHMoCiAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5rZXJuZWwuZXhwcy5NYXRoLlNVQlRSQUNUKSkKICAgICAgICAgICAgcmV0\ndXJuIEZpbHRlcnMuc3VidHJhY3QodmFsMSwgYzEsIHZhbDIsIGMyKTsKICAg\nICAgICBlbHNlIGlmIChvcC5lcXVhbHMoCiAgICAgICAgICAgICAgICBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5NYXRoLk1VTFRJUExZ\nKSkgCiAgICAgICAgICAgIHJldHVybiBGaWx0ZXJzLm11bHRpcGx5KHZhbDEs\nIGMxLCB2YWwyLCBjMik7CiAgICAgICAgZWxzZSBpZiAob3AuZXF1YWxzKAog\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuTWF0aC5ESVZJREUpKSAKICAgICAgICAgICAgcmV0dXJuIEZpbHRl\ncnMuZGl2aWRlKHZhbDEsIGMxLCB2YWwyLCBjMik7CiAgICAgICAgZWxzZSBp\nZiAob3AuZXF1YWxzKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5l\neHBzLk1hdGguTU9EKSkgCiAgICAgICAgICAgIHJldHVybiBGaWx0ZXJzLm1v\nZCh2YWwxLCBjMSwgdmFsMiwgYzIpOwogICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0\nIGhhbmRsZUNvbmNhdFZhbChPYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2Jq\nZWN0W10gcGFyYW1zLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20p\nIHsKICAgICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhw\ncy5Db25jYXQgY29uY2F0VmFsID0KICAgICAgICAgICAgKG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkNvbmNhdCl2YWx1ZTsKICAgICAg\nICBWYWwgdmFsdWUxID0gY29uY2F0VmFsLmdldFZhbDEoKTsKICAgICAgICBP\nYmplY3QgdmFsMSA9IGdldFZhbHVlKHZhbHVlMSwgb2IsIHBhcmFtcywgc20p\nOwoKICAgICAgICBWYWwgdmFsdWUyID0gY29uY2F0VmFsLmdldFZhbDIoKTsK\nICAgICAgICBPYmplY3QgdmFsMiA9IGdldFZhbHVlKHZhbHVlMiwgb2IsIHBh\ncmFtcywgc20pOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nQnVpbGRlcigx\nMDApLmFwcGVuZCh2YWwxKS5hcHBlbmQodmFsMikudG9TdHJpbmcoKTsKICAg\nIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVTdWJzdHJpbmdWYWwoT2Jq\nZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywKICAgICAg\nICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuU3Vic3RyaW5nIHN1YnN0clZh\nbCA9CiAgICAgICAgICAgIChvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJu\nZWwuZXhwcy5TdWJzdHJpbmcpIHZhbHVlOwogICAgICAgIFZhbCB2YWx1ZTEg\nPSBzdWJzdHJWYWwuZ2V0VmFsMSgpOwogICAgICAgIFN0cmluZyB2YWwxID0g\nKFN0cmluZykgZ2V0VmFsdWUodmFsdWUxLCBvYiwgcGFyYW1zLCBzbSk7Cgog\nICAgICAgIFZhbCB2YWx1ZTIgPSBzdWJzdHJWYWwuZ2V0VmFsMigpOwogICAg\nICAgIE9iamVjdCB2YWwyID0gZ2V0VmFsdWUodmFsdWUyLCBvYiwgcGFyYW1z\nLCBzbSk7CgogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhw\ncy5WYWx1ZVtdIHZhbEFyeTIgPSAKICAgICAgICAgICAgKG9yZy5hcGFjaGUu\nb3BlbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZVtdKSB2YWwyOwogICAgICAgIE9i\namVjdCBhcmcxID0gZ2V0VmFsdWUodmFsQXJ5MlswXSwgb2IsIHBhcmFtcywg\nc20pOyAvL3N0YXJ0aW5nIHBvcwogICAgICAgIE9iamVjdCBhcmcyID0gZ2V0\nVmFsdWUodmFsQXJ5MlsxXSwgb2IsIHBhcmFtcywgc20pOyAvLyBsZW5ndGgK\nICAgICAgICBpbnQgc3RhcnRJZHggPSAoKExvbmcpIGFyZzEpLmludFZhbHVl\nKCk7CiAgICAgICAgaW50IGxlbmd0aCA9ICgoTG9uZykgYXJnMikuaW50VmFs\ndWUoKTsKICAgICAgICBpbnQgZW5kSWR4ID0gc3RhcnRJZHggKyBsZW5ndGg7\nCiAgICAgICAgcmV0dXJuIHZhbDEuc3Vic3RyaW5nKHN0YXJ0SWR4LCBlbmRJ\nZHgpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZUFyZ3NWYWwo\nT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFtcywgCiAg\nICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAgIG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkFyZ3MgYXJnc1ZhbCA9\nIAogICAgICAgICAgICAob3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuQXJncykgdmFsdWU7CiAgICAgICAgcmV0dXJuIGFyZ3NWYWwuZ2V0\nVmFsdWVzKCk7CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3QgaGFuZGxlTG93\nZXJWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9iamVjdFtdIHBhcmFt\ncywgCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBzbSkgewogICAgICAg\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlRvTG93ZXJD\nYXNlIGxvd2VyVmFsID0gCiAgICAgICAgICAgIChvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5Ub0xvd2VyQ2FzZSkgdmFsdWU7CiAgICAg\nICAgVmFsIHZhbCA9IGxvd2VyVmFsLmdldFZhbHVlKCk7CiAgICAgICAgcmV0\ndXJuICgoU3RyaW5nKSBnZXRWYWx1ZSh2YWwsIG9iLCBwYXJhbXMsIHNtKSku\ndG9Mb3dlckNhc2UoKTsKICAgIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5k\nbGVVcHBlclZhbChPYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0W10g\ncGFyYW1zLCAKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKXsKICAg\nICAgICBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5Ub1Vw\ncGVyQ2FzZSB1cHBlclZhbCA9IAogICAgICAgICAgICAob3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuVG9VcHBlckNhc2UpIHZhbHVlOwog\nICAgICAgIFZhbCB2YWwgPSB1cHBlclZhbC5nZXRWYWx1ZSgpOwogICAgICAg\nIHJldHVybiAoKFN0cmluZykgZ2V0VmFsdWUodmFsLCBvYiwgcGFyYW1zLCBz\nbSkpLnRvVXBwZXJDYXNlKCk7CiAgICB9CgogICAgcHJpdmF0ZSBPYmplY3Qg\naGFuZGxlTGVuZ3RoVmFsKE9iamVjdCB2YWx1ZSwgT2JqZWN0IG9iLCBPYmpl\nY3RbXSBwYXJhbXMsIAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20p\newogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLlN0cmluZ0xlbmd0aCBzdHJMZW5WYWwgPSAKICAgICAgICAgICAgKG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlN0cmluZ0xlbmd0aCkg\ndmFsdWU7CiAgICAgICAgVmFsIHZhbCA9IHN0ckxlblZhbC5nZXRWYWx1ZSgp\nOwogICAgICAgIHJldHVybiAoKFN0cmluZykgZ2V0VmFsdWUodmFsLCBvYiwg\ncGFyYW1zLCBzbSkpLmxlbmd0aCgpOwogICAgfQoKICAgIHByaXZhdGUgT2Jq\nZWN0IGhhbmRsZVRyaW1WYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9i\namVjdFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkgewogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5l\neHBzLlRyaW0gdHJpbVZhbCA9IAogICAgICAgICAgICAob3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuVHJpbSkgdmFsdWU7CiAgICAgICAg\nVmFsIHZhbCA9IHRyaW1WYWwuZ2V0VmFsKCk7CiAgICAgICAgU3RyaW5nIHZh\nbFN0ciA9IChTdHJpbmcpIGdldFZhbHVlKHZhbCwgb2IsIHBhcmFtcywgc20p\nOwogICAgICAgIFZhbCB0cmltQ2hhciA9IHRyaW1WYWwuZ2V0VHJpbUNoYXIo\nKTsKICAgICAgICBjaGFyIHRyaW1DaGFyT2JqID0gKChTdHJpbmcpIGdldFZh\nbHVlKHRyaW1DaGFyLCBvYiwgcGFyYW1zLCBzbSkpLgogICAgICAgICAgICBj\naGFyQXQoMCk7CiAgICAgICAgQm9vbGVhbiB3aGVyZSA9IHRyaW1WYWwuZ2V0\nV2hlcmUoKTsKICAgICAgICBpZiAod2hlcmUgPT0gbnVsbCkgeyAvL3RyaW0g\nYm90aAogICAgICAgICAgICByZXR1cm4gdHJpbUxlYWRpbmcodHJpbVRyYWls\naW5nKHZhbFN0ciwgdHJpbUNoYXJPYmopLCB0cmltQ2hhck9iaik7CiAgICAg\nICAgfSBlbHNlIGlmICh3aGVyZS5ib29sZWFuVmFsdWUoKSkgeyAvLyB0cmlt\nIGxlYWRpbmcKICAgICAgICAgICAgcmV0dXJuIHRyaW1MZWFkaW5nKHZhbFN0\nciwgdHJpbUNoYXJPYmopOwogICAgICAgIH0gZWxzZSB7IC8vIHRyaW0gdHJh\naWxpbmcKICAgICAgICAgICAgcmV0dXJuIHRyaW1UcmFpbGluZyh2YWxTdHIs\nIHRyaW1DaGFyT2JqKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBT\ndHJpbmcgdHJpbUxlYWRpbmcoU3RyaW5nIHZhbHVlLCBjaGFyIHRyaW1DaGFy\nKSB7CiAgICAgICAgaW50IHN0YXJ0SWR4ID0gMDsKICAgICAgICBpbnQgbGVu\nID0gdmFsdWUubGVuZ3RoKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAodmFsdWUuY2hhckF0KGkp\nICE9IHRyaW1DaGFyKSB7CiAgICAgICAgICAgICAgICBzdGFydElkeCA9IGk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdmFsdWUuc3Vic3RyaW5nKHN0YXJ0SWR4KTsK\nICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyB0cmltVHJhaWxpbmcoU3RyaW5n\nIHZhbHVlLCBjaGFyIHRyaW1DaGFyKSB7CiAgICAgICAgaW50IGVuZElkeCA9\nIDA7CiAgICAgICAgaW50IGxlbiA9IHZhbHVlLmxlbmd0aCgpOwogICAgICAg\nIGZvciAoaW50IGkgPSBsZW4tMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAg\nICAgaWYgKHZhbHVlLmNoYXJBdChpKSAhPSB0cmltQ2hhcikgewogICAgICAg\nICAgICAgICAgZW5kSWR4ID0gaTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZS5z\ndWJzdHJpbmcoMCwgZW5kSWR4KzEpOwogICAgfQoKICAgIHByaXZhdGUgT2Jq\nZWN0IGhhbmRsZUluZGV4T2ZWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2Is\nIE9iamVjdFtdIHBhcmFtcywKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2Vy\nIHNtKSB7CiAgICAgICAgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVs\nLmV4cHMuSW5kZXhPZiBsb2NhdGVWYWwgPSAKICAgICAgICAgICAgKG9yZy5h\ncGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLkluZGV4T2YpIHZhbHVl\nOwogICAgICAgIFN0cmluZyB2YWwxID0gKFN0cmluZykgZ2V0VmFsdWUobG9j\nYXRlVmFsLmdldFZhbDEoKSwgb2IsIHBhcmFtcywgc20pOwogICAgICAgIFZh\nbFtdIHZhbDIgPSAoVmFsW10pIGdldFZhbHVlKGxvY2F0ZVZhbC5nZXRWYWwy\nKCksIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBTdHJpbmcgc3RyVmFsID0g\nKFN0cmluZykgZ2V0VmFsdWUodmFsMlswXSwgb2IsIHBhcmFtcywgc20pOwog\nICAgICAgIGludCBpZHggPSAoKExvbmcpIGdldFZhbHVlKHZhbDJbMV0sIG9i\nLCBwYXJhbXMsIHNtKSkuaW50VmFsdWUoKTsKICAgICAgICByZXR1cm4gc3Ry\nVmFsLmluZGV4T2YodmFsMSwgaWR4KTsKICAgIH0KCiAgICBwcml2YXRlIE9i\namVjdCBoYW5kbGVBYnNWYWwoT2JqZWN0IHZhbHVlLCBPYmplY3Qgb2IsIE9i\namVjdFtdIHBhcmFtcywgCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbSkgewogICAgICAgIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5l\neHBzLkFicyBhYnNWYWwgPSAKICAgICAgICAgICAgKG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLmtlcm5lbC5leHBzLkFicykgdmFsdWU7CiAgICAgICAgT2Jq\nZWN0IHZhbCA9IGdldFZhbHVlKGFic1ZhbC5nZXRWYWx1ZSgpLCBvYiwgcGFy\nYW1zLCBzbSk7CiAgICAgICAgQ2xhc3MgYyA9IHZhbC5nZXRDbGFzcygpOwog\nICAgICAgIGlmIChjID09IEludGVnZXIuY2xhc3MpCiAgICAgICAgICAgIHJl\ndHVybiBuZXcgSW50ZWdlcihqYXZhLmxhbmcuTWF0aC5hYnMoKChJbnRlZ2Vy\nKSB2YWwpLmludFZhbHVlKCkpKTsKICAgICAgICBlbHNlIGlmIChjID09IEZs\nb2F0LmNsYXNzKQogICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGphdmEu\nbGFuZy5NYXRoLmFicygoKEZsb2F0KSB2YWwpLmZsb2F0VmFsdWUoKSkpOwog\nICAgICAgIGVsc2UgaWYgKGMgPT0gRG91YmxlLmNsYXNzKQogICAgICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZShqYXZhLmxhbmcuTWF0aC5hYnMoKChEb3Vi\nbGUpIHZhbCkuZG91YmxlVmFsdWUoKSkpOwogICAgICAgIGVsc2UgaWYgKGMg\nPT0gTG9uZy5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5ldyBMb25nKGph\ndmEubGFuZy5NYXRoLmFicygoKExvbmcpIHZhbCkubG9uZ1ZhbHVlKCkpKTsK\nICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAg\nIH0KCiAgICBwcml2YXRlIE9iamVjdCBoYW5kbGVTcXJ0VmFsKE9iamVjdCB2\nYWx1ZSwgT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMsIAogICAgICAgIE9w\nZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5TcXJ0IHNxcnRWYWwgPSAKICAgICAg\nICAgICAgKG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBzLlNx\ncnQpIHZhbHVlOwogICAgICAgIE9iamVjdCB2YWwgPSBnZXRWYWx1ZShzcXJ0\nVmFsLmdldFZhbHVlKCksIG9iLCBwYXJhbXMsIHNtKTsKICAgICAgICBDbGFz\ncyBjID0gdmFsLmdldENsYXNzKCk7CiAgICAgICAgaWYgKGMgPT0gSW50ZWdl\nci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoamF2YS5s\nYW5nLk1hdGguc3FydCgoKEludGVnZXIpIHZhbCkuCiAgICAgICAgICAgICAg\nICBkb3VibGVWYWx1ZSgpKSk7CiAgICAgICAgZWxzZSBpZiAoYyA9PSBGbG9h\ndC5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGUoamF2YS5s\nYW5nLk1hdGguc3FydCgoKEZsb2F0KSB2YWwpLmZsb2F0VmFsdWUoKSkpOwog\nICAgICAgIGVsc2UgaWYgKGMgPT0gRG91YmxlLmNsYXNzKQogICAgICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZShqYXZhLmxhbmcuTWF0aC5zcXJ0KCgoRG91\nYmxlKSB2YWwpLgogICAgICAgICAgICAgICAgZG91YmxlVmFsdWUoKSkpOwog\nICAgICAgIGVsc2UgaWYgKGMgPT0gTG9uZy5jbGFzcykKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBEb3VibGUoamF2YS5sYW5nLk1hdGguc3FydCgoKExvbmcp\nIHZhbCkuZG91YmxlVmFsdWUoKSkpOwogICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZEV4Y2VwdGlvbigpOwogICAgfSAgICAKCiAgICBwcml2YXRlIE9i\namVjdCBnZXRWYWx1ZShPYmplY3QgdmFsdWUsIE9iamVjdCBvYiwgT2JqZWN0\nW10gcGFyYW1zLAogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsK\nICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBQQ1BhdGgpIHsKICAgICAg\nICAgICAgRmllbGRNYXBwaW5nIGZtID0gKEZpZWxkTWFwcGluZykoKFBDUGF0\naCkgdmFsdWUpLmxhc3QoKTsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVl\nKG9iLCBmbSwgc20pOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFu\nY2VvZiBMaXRlcmFsKSB7CiAgICAgICAgICAgIHJldHVybiAoKExpdGVyYWwp\nIHZhbHVlKS5nZXRWYWx1ZSgpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUg\naW5zdGFuY2VvZiBDb25zdGFudCkgewogICAgICAgICAgICByZXR1cm4gKChD\nb25zdGFudCkgdmFsdWUpLmdldFZhbHVlKHBhcmFtcyk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGV2YWx1YXRlKHZhbHVlLCBvYiwg\ncGFyYW1zLCBzbSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgT2Jq\nZWN0IGdldFZhbHVlKE9iamVjdCBvYiwgRmllbGRNYXBwaW5nIGZtZCwKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtKSB7CiAgICAgICAgaW50IGkg\nPSBmbWQuZ2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNs\nYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09M\nRUFOOgogICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hCb29sZWFuRmllbGQo\naSk7CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\ncmV0dXJuIHNtLmZldGNoQnl0ZUZpZWxkKGkpOwogICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVI6CiAgICAgICAgICAgIHJldHVybiBzbS5mZXRjaENoYXJG\naWVsZChpKTsKICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6CiAgICAg\nICAgICAgIHJldHVybiBzbS5mZXRjaERvdWJsZUZpZWxkKGkpOwogICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICByZXR1cm4gc20u\nZmV0Y2hGbG9hdEZpZWxkKGkpOwogICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgcmV0dXJuIHNtLmZldGNoSW50RmllbGQoaSk7CiAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgcmV0dXJu\nIHNtLmZldGNoTG9uZ0ZpZWxkKGkpOwogICAgICAgIGNhc2UgSmF2YVR5cGVz\nLlNIT1JUOgogICAgICAgICAgICByZXR1cm4gc20uZmV0Y2hTaG9ydEZpZWxk\nKGkpOwogICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAg\nICAgcmV0dXJuIHNtLmZldGNoU3RyaW5nRmllbGQoaSk7CiAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuREFURToKICAgICAgICBjYXNlIEphdmFUeXBlcy5OVU1C\nRVI6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQk9PTEVBTl9PQko6CiAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxF\nX09CSjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVF9PQko6CiAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICBjYXNlIEphdmFU\neXBlcy5MT05HX09CSjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9P\nQko6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAg\nICBjYXNlIEphdmFUeXBlcy5CSUdJTlRFR0VSOgogICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkxPQ0FMRToKICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6\nCiAgICAgICAgY2FzZSBKYXZhVHlwZXMuT0lEOgogICAgICAgICAgICByZXR1\ncm4gc20uZmV0Y2hPYmplY3RGaWVsZChpKTsKICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgVGhy\nZWFkTG9jYWxDb250ZXh0IGV4dGVuZHMgVGhyZWFkTG9jYWw8Q29udGV4dFtd\nPiB7CiAgICAgICAgcHVibGljIENvbnRleHRbXSBpbml0aWFsVmFsdWUoKSB7\nCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHN0YXRpYyBDb250ZXh0W10gZ2V0VGhyZWFkTG9jYWxDb250ZXh0\nKCkgewogICAgICAgIHJldHVybiBsb2NhbENvbnRleHQuZ2V0KCk7CiAgICB9\nCgogICAgcHVibGljIHN0YXRpYyBDb250ZXh0IGdldFRocmVhZExvY2FsQ29u\ndGV4dChDb250ZXh0IG9yaWcpIHsKICAgICAgICBDb250ZXh0W10gcm9vdCA9\nIGxvY2FsQ29udGV4dC5nZXQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHJvb3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgQ29udGV4dCBs\nY3R4ID0gZ2V0VGhyZWFkTG9jYWxDb250ZXh0KHJvb3RbaV0sIG9yaWcpOwog\nICAgICAgICAgICBpZiAobGN0eCAhPSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIGxjdHg7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgU2VsZWN0IGdldFRocmVhZExvY2Fs\nU2VsZWN0KFNlbGVjdCBzZWxlY3QpIHsKICAgICAgICBpZiAoc2VsZWN0ID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIENvbnRl\neHRbXSBsY3R4ID0gSkRCQ1N0b3JlUXVlcnkuZ2V0VGhyZWFkTG9jYWxDb250\nZXh0KCk7CiAgICAgICAgQ29udGV4dCBjbG9uZUZyb20gPSBzZWxlY3QuY3R4\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsY3R4Lmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIENvbnRleHQgY2xvbmVUbyA9IGdldFRocmVh\nZExvY2FsQ29udGV4dChsY3R4W2ldLCBjbG9uZUZyb20pOwogICAgICAgICAg\nICBpZiAoY2xvbmVUbyAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJu\nIChTZWxlY3QpY2xvbmVUby5nZXRTZWxlY3QoKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHNlbGVjdDsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIENv\nbnRleHQgZ2V0VGhyZWFkTG9jYWxDb250ZXh0KENvbnRleHQgbGN0eCwgQ29u\ndGV4dCBjbG9uZUZyb20pIHsKICAgICAgICBpZiAobGN0eC5jbG9uZUZyb20g\nPT0gY2xvbmVGcm9tKQogICAgICAgICAgICByZXR1cm4gbGN0eDsKICAgICAg\nICBqYXZhLnV0aWwuTGlzdDxDb250ZXh0PiBzdWJzZWxDdHhzID0gbGN0eC5n\nZXRTdWJzZWxDb250ZXh0cygpOwogICAgICAgIGlmIChzdWJzZWxDdHhzICE9\nIG51bGwpIHsKICAgICAgICAgICAgZm9yIChDb250ZXh0IHN1YnNlbEN0eCA6\nIHN1YnNlbEN0eHMpIHsKICAgICAgICAgICAgICAgIENvbnRleHQgY3R4ID0g\nZ2V0VGhyZWFkTG9jYWxDb250ZXh0KHN1YnNlbEN0eCwgY2xvbmVGcm9tKTsK\nICAgICAgICAgICAgICAgIGlmIChjdHggIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gY3R4OwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIENvbnRleHRbXSBjbG9uZShDb250ZXh0W10gb3JpZywgQ29udGV4dCBwYXJl\nbnQpIHsKICAgICAgICBDb250ZXh0W10gbmV3Q3R4ID0gbmV3IENvbnRleHRb\nb3JpZy5sZW5ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgb3Jp\nZy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBuZXdDdHhbaV0gPSBjbG9u\nZShvcmlnW2ldLCBwYXJlbnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nbmV3Q3R4OwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIENvbnRleHQgY2xv\nbmUoQ29udGV4dCBvcmlnLCBDb250ZXh0IHBhcmVudCkgewogICAgICAgIENv\nbnRleHQgbXlQYXJlbnQgPSBudWxsOwogICAgICAgIGlmIChwYXJlbnQgPT0g\nbnVsbCkgewogICAgICAgICAgICBDb250ZXh0IG9yaWdQYXJlbnQgPSBvcmln\nLmdldFBhcmVudCgpOwogICAgICAgICAgICBpZiAob3JpZ1BhcmVudCAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgbXlQYXJlbnQgPSBjbG9uZShvcmlnLmdl\ndFBhcmVudCgpLCBudWxsKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nbXlQYXJlbnQgPSBwYXJlbnQ7CgogICAgICAgIENvbnRleHQgbmV3Q3R4ID0g\nbmV3IENvbnRleHQob3JpZy5wYXJzZWQsIG51bGwsIG15UGFyZW50KTsKICAg\nICAgICBuZXdDdHguZnJvbSA9IG9yaWcuZnJvbTsKICAgICAgICBuZXdDdHgu\nbWV0YSA9IG9yaWcubWV0YTsKICAgICAgICBuZXdDdHguc2NoZW1hQWxpYXMg\nPSBvcmlnLnNjaGVtYUFsaWFzOwogICAgICAgIG5ld0N0eC5zZXRTY2hlbWFz\nKG9yaWcuZ2V0U2NoZW1hcygpKTsKICAgICAgICBuZXdDdHguc2V0VmFyaWFi\nbGVzKG9yaWcuZ2V0VmFyaWFibGVzKCkpOwogICAgICAgIG5ld0N0eC5jbG9u\nZUZyb20gPSBvcmlnOwogICAgICAgIE9iamVjdCBzZWxlY3QgPSBvcmlnLmdl\ndFNlbGVjdCgpOwogICAgICAgIGlmIChzZWxlY3QgIT0gbnVsbCkKICAgICAg\nICAgICAgbmV3Q3R4LnNldFNlbGVjdCgoKFNlbGVjdEltcGwpc2VsZWN0KS5j\nbG9uZShuZXdDdHgpKTsKICAgICAgICBuZXdDdHguc3VicXVlcnkgPSBvcmln\nLnN1YnF1ZXJ5OwogICAgICAgIExpc3Q8Q29udGV4dD4gc3Vic2VscyA9IG9y\naWcuZ2V0U3Vic2VsQ29udGV4dHMoKTsKICAgICAgICBpZiAoc3Vic2VscyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGZvciAoQ29udGV4dCBzdWJzZWwgOiBz\ndWJzZWxzKSAKICAgICAgICAgICAgICAgIG5ld0N0eC5hZGRTdWJzZWxDb250\nZXh0KGNsb25lKHN1YnNlbCwgbmV3Q3R4KSk7CiAgICAgICAgfQoKICAgICAg\nICByZXR1cm4gbmV3Q3R4OyAgICAgICAgCiAgICB9Cn0K\n","encoding":"base64"}

