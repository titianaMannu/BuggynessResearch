{"sha":"3b918ffabf06c382f253e9bbcc6a3872a146314c","node_id":"MDQ6QmxvYjIwNjM2NDozYjkxOGZmYWJmMDZjMzgyZjI1M2U5YmJjYzZhMzg3MmExNDYzMTRj","size":12582,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3b918ffabf06c382f253e9bbcc6a3872a146314c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xs\nZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQg\namF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmxvY2tzLlJlZW50cmFudExv\nY2s7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3RyaW5nVXRp\nbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVuSlBBQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5QcmVwYXJlZFF1ZXJ5Q2FjaGU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeUhpbnRzOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5RdWVyeUxhbmd1YWdlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5rZXJuZWwuUXVlcnlTdGF0aXN0aWNzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwoKLyoqCiAqIEFu\nIGltcGxlbWVudGF0aW9uIG9mIHRoZSBjYWNoZSBvZiB7QGxpbmsgUHJlcGFy\nZWRRdWVyeSBwcmVwYXJlZCBxdWVyaWVzfS4gCiAqIAogKiBAYXV0aG9yIFBp\nbmFraSBQb2RkYXIKICoKICogQHNpbmNlIDIuMC4wCiAqIAogKiBAbm9qYXZh\nZG9jCiAqLwpwdWJsaWMgY2xhc3MgUHJlcGFyZWRRdWVyeUNhY2hlSW1wbCBp\nbXBsZW1lbnRzIFByZXBhcmVkUXVlcnlDYWNoZSB7Cglwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgUEFUVEVSTl9TRVBBUkFUT1IgPSAiXFw7IjsKCS8v\nIEtleTogUXVlcnkgaWRlbnRpZmllciAKCXByaXZhdGUgZmluYWwgTWFwPFN0\ncmluZywgUHJlcGFyZWRRdWVyeT4gX2RlbGVnYXRlOwoJLy8gS2V5OiBRdWVy\neSBpZGVudGlmaWVyIFZhbHVlOiBSZWFzb24gd2h5IGV4Y2x1ZGVkCglwcml2\nYXRlIGZpbmFsIE1hcDxTdHJpbmcsIEV4Y2x1c2lvbj4gX3VuY2FjaGFibGVz\nOwoJcHJpdmF0ZSBmaW5hbCBMaXN0PEV4Y2x1c2lvbj4gX2V4Y2x1c2lvblBh\ndHRlcm5zOwoJcHJpdmF0ZSBmaW5hbCBRdWVyeVN0YXRpc3RpY3M8U3RyaW5n\nPiBfc3RhdHM7Cglwcml2YXRlIFJlZW50cmFudExvY2sgX2xvY2sgPSBuZXcg\nUmVlbnRyYW50TG9jaygpOwoJcHJpdmF0ZSBMb2cgX2xvZzsKICAgIHByaXZh\ndGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2th\nZ2UoUHJlcGFyZWRRdWVyeUNhY2hlSW1wbC5jbGFzcyk7CiAgICAKCXB1Ymxp\nYyBQcmVwYXJlZFF1ZXJ5Q2FjaGVJbXBsKCkgewoJCV9kZWxlZ2F0ZSA9IG5l\ndyBIYXNoTWFwPFN0cmluZywgUHJlcGFyZWRRdWVyeT4oKTsKCQlfdW5jYWNo\nYWJsZXMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIEV4Y2x1c2lvbj4oKTsKCQlf\nc3RhdHMgPSBuZXcgUXVlcnlTdGF0aXN0aWNzLkRlZmF1bHQ8U3RyaW5nPigp\nOwoJCV9leGNsdXNpb25QYXR0ZXJucyA9IG5ldyBBcnJheUxpc3Q8RXhjbHVz\naW9uPigpOwoJfQoJCiAgICBwdWJsaWMgQm9vbGVhbiByZWdpc3RlcihTdHJp\nbmcgaWQsIFF1ZXJ5IHF1ZXJ5LCBGZXRjaENvbmZpZ3VyYXRpb24gaGludHMp\nIHsKICAgICAgICBpZiAoaWQgPT0gbnVsbCAKICAgICAgICAgICAgfHwgcXVl\ncnkgPT0gbnVsbCAKICAgICAgICAgICAgfHwgUXVlcnlMYW5ndWFnZXMuTEFO\nR19TUUwuZXF1YWxzKHF1ZXJ5LmdldExhbmd1YWdlKCkpIAogICAgICAgICAg\nICB8fCBRdWVyeUxhbmd1YWdlcy5MQU5HX01FVEhPRFFMLmVxdWFscyhxdWVy\neS5nZXRMYW5ndWFnZSgpKQogICAgICAgICAgICB8fCBpc0hpbnRlZChoaW50\ncywgUXVlcnlIaW50cy5ISU5UX0lHTk9SRV9QUkVQQVJFRF9RVUVSWSkKICAg\nICAgICAgICAgfHwgaXNIaW50ZWQoaGludHMsIFF1ZXJ5SGludHMuSElOVF9J\nTlZBTElEQVRFX1BSRVBBUkVEX1FVRVJZKSkKICAgICAgICAgICAgcmV0dXJu\nIEJvb2xlYW4uRkFMU0U7CiAgICAgICAgaWYgKGlzQ2FjaGFibGUoaWQpID09\nIEJvb2xlYW4uRkFMU0UpCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLkZB\nTFNFOwogICAgICAgIFByZXBhcmVkUXVlcnkgY2FjaGVkID0gZ2V0KGlkKTsK\nICAgICAgICBpZiAoY2FjaGVkICE9IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOyAvLyBpbXBsaWVzIHRoYXQgaXQgaXMgYWxyZWFkeSBjYWNoZWQK\nICAgICAgICAKICAgICAgICBQcmVwYXJlZFF1ZXJ5IG5ld0VudHJ5ID0gbmV3\nIFByZXBhcmVkUXVlcnlJbXBsKGlkLCBxdWVyeSk7IAogICAgICAgIHJldHVy\nbiBjYWNoZShuZXdFbnRyeSk7Cgl9CgkKCXB1YmxpYyBNYXA8U3RyaW5nLFN0\ncmluZz4gZ2V0TWFwVmlldygpIHsKCQlsb2NrKCk7CgkJdHJ5IHsKICAgICAg\nICAgICAgTWFwPFN0cmluZywgU3RyaW5nPiB2aWV3ID0gbmV3IFRyZWVNYXA8\nU3RyaW5nLCBTdHJpbmc+KCk7CiAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5\nPFN0cmluZywgUHJlcGFyZWRRdWVyeT4gZW50cnkgOiBfZGVsZWdhdGUuZW50\ncnlTZXQoKSkKICAgICAgICAgICAgICAgIHZpZXcucHV0KGVudHJ5LmdldEtl\neSgpLCBlbnRyeS5nZXRWYWx1ZSgpLmdldFRhcmdldFF1ZXJ5KCkpOwoJCQly\nZXR1cm4gdmlldzsKCQl9IGZpbmFsbHkgewoJCQl1bmxvY2soKTsKCQl9Cgl9\nCgkKCS8qKgoJICogQ2FjaGUgdGhlIGdpdmVuIHF1ZXJ5IGtleWVkIGJ5IGl0\ncyBpZGVudGlmaWVyLiBEb2VzIG5vdCBjYWNoZSBpZiB0aGUgCgkgKiBpZGVu\ndGlmaWVyIG1hdGNoZXMgYW55IGV4Y2x1c2lvbiBwYXR0ZXJuIG9yIGhhcyBi\nZWVuIG1hcmtlZCBhcyAKCSAqIG5vbi1jYWNoYWJsZS4gQWxzbyByZWdpc3Rl\nciB0aGUgaWRlbnRpZmllciBhcyBub3QgY2FjaGFibGUgYWdhaW5zdCAKCSAq\nIHRoZSBtYXRjaGVkIGV4Y2x1c2lvbiBwYXR0ZXJuLgoJICovCglwdWJsaWMg\nYm9vbGVhbiBjYWNoZShQcmVwYXJlZFF1ZXJ5IHEpIHsKCQlsb2NrKCk7CgkJ\ndHJ5IHsKCQkJU3RyaW5nIGlkID0gcS5nZXRJZGVudGlmaWVyKCk7CgkJCWlm\nIChpc0NhY2hhYmxlKGlkKSA9PSBCb29sZWFuLkZBTFNFKSB7CgkJCQlpZiAo\nX2xvZyAhPSBudWxsICYmIF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwcmVwYXJlZC1x\ndWVyeS1ub3QtY2FjaGFibGUiLCBpZCkpOwoJCQkJcmV0dXJuIGZhbHNlOwoJ\nCQl9CgkJCUV4Y2x1c2lvbiBleGNsdXNpb24gPSBnZXRNYXRjaGVkRXhjbHVz\naW9uUGF0dGVybihpZCk7CgkJCWlmIChleGNsdXNpb24gIT0gbnVsbCkgewoJ\nCQkJbWFya1VuY2FjaGFibGUoaWQsIGV4Y2x1c2lvbik7CgkJCQlyZXR1cm4g\nZmFsc2U7CgkJCX0KCQkJX2RlbGVnYXRlLnB1dChpZCwgcSk7CiAgICAgICAg\nICAgIGlmIChfbG9nICE9IG51bGwgJiYgX2xvZy5pc1RyYWNlRW5hYmxlZCgp\nKQogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicHJlcGFy\nZWQtcXVlcnktY2FjaGVkIiwgaWQpKTsKCQkJcmV0dXJuIHRydWU7CgkJfSBm\naW5hbGx5IHsKCQkJdW5sb2NrKCk7CgkJfQoJfQoJCiAgICBwdWJsaWMgUHJl\ncGFyZWRRdWVyeSBpbml0aWFsaXplKFN0cmluZyBrZXksIE9iamVjdCByZXN1\nbHQpIHsKICAgICAgICBQcmVwYXJlZFF1ZXJ5IHBxID0gZ2V0KGtleSk7CiAg\nICAgICAgaWYgKHBxID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIAogICAgICAgIEV4Y2x1c2lvbiBleGNsdXNpb24gPSBwcS5p\nbml0aWFsaXplKHJlc3VsdCk7CiAgICAgICAgaWYgKGV4Y2x1c2lvbiAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIG1hcmtVbmNhY2hhYmxlKGtleSwgZXhjbHVz\naW9uKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSAKICAg\nICAgICByZXR1cm4gcHE7CiAgICB9CgkKCXB1YmxpYyBib29sZWFuIGludmFs\naWRhdGUoU3RyaW5nIGlkKSB7CgkJbG9jaygpOwoJCXRyeSB7CgkJCWlmIChf\nbG9nICE9IG51bGwgJiYgX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicHJlcGFyZWQtcXVlcnkt\naW52YWxpZGF0ZSIsIGlkKSk7CgkJCXJldHVybiBfZGVsZWdhdGUucmVtb3Zl\nKGlkKSAhPSBudWxsOwoJCX0gZmluYWxseSB7CgkJCXVubG9jaygpOwoJCX0K\nCX0KCQogICAgcHVibGljIFByZXBhcmVkUXVlcnkgZ2V0KFN0cmluZyBpZCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gX2RlbGVnYXRlLmdldChpZCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCglw\ndWJsaWMgQm9vbGVhbiBpc0NhY2hhYmxlKFN0cmluZyBpZCkgewoJCWxvY2so\nKTsKCQl0cnkgewoJCQlpZiAoX3VuY2FjaGFibGVzLmNvbnRhaW5zS2V5KGlk\nKSkKCQkJCXJldHVybiBCb29sZWFuLkZBTFNFOwoJCQlpZiAoX2RlbGVnYXRl\nLmNvbnRhaW5zS2V5KGlkKSkKCQkJCXJldHVybiBCb29sZWFuLlRSVUU7CgkJ\nCXJldHVybiBudWxsOwoJCX0gZmluYWxseSB7CgkJCXVubG9jaygpOwoJCX0K\nCX0KCQoJcHVibGljIFByZXBhcmVkUXVlcnkgbWFya1VuY2FjaGFibGUoU3Ry\naW5nIGlkLCBFeGNsdXNpb24gZXhjbHVzaW9uKSB7CgkJbG9jaygpOwoJCXRy\neSB7CgkJCWlmIChfdW5jYWNoYWJsZXMucHV0KGlkLCBleGNsdXNpb24pID09\nIG51bGwpIHsKCQkJICAgIGlmIChfbG9nICE9IG51bGwgJiYgX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKSAKCQkJICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0\nKCJwcmVwYXJlZC1xdWVyeS11bmNhY2hlIiwgaWQsIGV4Y2x1c2lvbikpOwoJ\nCQl9CgkJCXJldHVybiBfZGVsZWdhdGUucmVtb3ZlKGlkKTsKCQl9IGZpbmFs\nbHkgewoJCQl1bmxvY2soKTsKCQl9Cgl9CgkKCXB1YmxpYyBFeGNsdXNpb24g\naXNFeGNsdWRlZChTdHJpbmcgaWQpIHsKCQlyZXR1cm4gZ2V0TWF0Y2hlZEV4\nY2x1c2lvblBhdHRlcm4oaWQpOwoJfQoJCglwdWJsaWMgdm9pZCBzZXRFeGNs\ndWRlcyhTdHJpbmcgZXhjbHVkZXMpIHsKCQlsb2NrKCk7CgkJdHJ5IHsKCQkJ\naWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkoZXhjbHVkZXMpKQoJCQkJcmV0dXJu\nOwoJCQlTdHJpbmdbXSBwYXR0ZXJucyA9IGV4Y2x1ZGVzLnNwbGl0KFBBVFRF\nUk5fU0VQQVJBVE9SKTsKCQkJZm9yIChTdHJpbmcgcGF0dGVybiA6IHBhdHRl\ncm5zKQoJCQkJYWRkRXhjbHVzaW9uUGF0dGVybihwYXR0ZXJuKTsKCQl9IGZp\nbmFsbHkgewoJCQl1bmxvY2soKTsKCQl9Cgl9CgoJcHVibGljIExpc3Q8RXhj\nbHVzaW9uPiBnZXRFeGNsdWRlcygpIHsKCQlyZXR1cm4gQ29sbGVjdGlvbnMu\ndW5tb2RpZmlhYmxlTGlzdChfZXhjbHVzaW9uUGF0dGVybnMpOwoJfQoJCgkv\nKioKICAgICAqIEFkZHMgYSBwYXR0ZXJuIGZvciBleGNsdXNpb24uIEFueSBx\ndWVyeSBjYWNoZWQgY3VycmVudGx5IHdob3NlIGlkZW50aWZpZXIKICAgICAq\nIG1hdGNoZXMgdGhlIGdpdmVuIHBhdHRlcm4gd2lsbCBiZSBtYXJrZWQgaW52\nYWxpZGF0ZWQgYXMgYSBzaWRlLWVmZmVjdC4KCSAqLwoJcHVibGljIHZvaWQg\nYWRkRXhjbHVzaW9uUGF0dGVybihTdHJpbmcgcGF0dGVybikgewoJCWxvY2so\nKTsKCQl0cnkgewoJCSAgICBTdHJpbmcgcmVhc29uID0gX2xvYy5nZXQoInBy\nZXBhcmVkLXF1ZXJ5LWV4Y2x1ZGVkLWJ5LXVzZXIiLCBwYXR0ZXJuKS5nZXRN\nZXNzYWdlKCk7CgkJCUV4Y2x1c2lvbiBleGNsdXNpb24gPSBuZXcgV2Vha0V4\nY2x1c2lvbihwYXR0ZXJuLCByZWFzb24pOwoJCQlfZXhjbHVzaW9uUGF0dGVy\nbnMuYWRkKGV4Y2x1c2lvbik7CiAgICAgICAgICAgIENvbGxlY3Rpb248U3Ry\naW5nPiBpbnZhbGlkS2V5cyA9IGdldE1hdGNoZWRLZXlzKHBhdHRlcm4sIF9k\nZWxlZ2F0ZS5rZXlTZXQoKSk7CgkJCWZvciAoU3RyaW5nIGludmFsaWRLZXkg\nOiBpbnZhbGlkS2V5cykgewoJCQkgICAgRXhjbHVzaW9uIGludmFsaWQgPSBu\nZXcgV2Vha0V4Y2x1c2lvbihpbnZhbGlkS2V5LCByZWFzb24pOwoJCQkJbWFy\na1VuY2FjaGFibGUoaW52YWxpZEtleSwgaW52YWxpZCk7CgkJCX0KCQl9IGZp\nbmFsbHkgewoJCQl1bmxvY2soKTsKCQl9Cgl9CgkKCS8qKgoJICogUmVtb3Zl\ncyBhIHBhdHRlcm4gZm9yIGV4Y2x1c2lvbi4gQW55IHF1ZXJ5IGlkZW50aWZp\nZXIgbWFya2VkIGFzIG5vdCAKICAgICAqIGNhY2hhYmxlIGR1ZSB0byB0aGUg\nZ2l2ZW4gcGF0dGVybiB3aWxsIG5vdyBiZSByZW1vdmVkIGZyb20gdGhlIGxp\nc3Qgb2YKCSAqIHVuY2FjaGFibGVzIGFzIGEgc2lkZS1lZmZlY3QuCgkgKi8K\nCXB1YmxpYyB2b2lkIHJlbW92ZUV4Y2x1c2lvblBhdHRlcm4oU3RyaW5nIHBh\ndHRlcm4pIHsKCQlsb2NrKCk7CgkJdHJ5IHsKICAgICAgICAgICAgRXhjbHVz\naW9uIGV4Y2x1c2lvbiA9IG5ldyBXZWFrRXhjbHVzaW9uKHBhdHRlcm4sIG51\nbGwpOwoJCQlfZXhjbHVzaW9uUGF0dGVybnMucmVtb3ZlKGV4Y2x1c2lvbik7\nCiAgICAgICAgICAgIENvbGxlY3Rpb248U3RyaW5nPiByZWJvcm5zID0gZ2V0\nTWF0Y2hlZEtleXMocGF0dGVybiwgX3VuY2FjaGFibGVzKTsKCQkJZm9yIChT\ndHJpbmcgcmVib3JuS2V5IDogcmVib3JucykgewogICAgICAgICAgICAgICAg\nX3VuY2FjaGFibGVzLnJlbW92ZShyZWJvcm5LZXkpOwoJICAgICAgICAgICAg\naWYgKF9sb2cgIT0gbnVsbCAmJiBfbG9nLmlzVHJhY2VFbmFibGVkKCkpCgkg\nICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgicHJlcGFyZWQt\ncXVlcnktcmVtb3ZlLXBhdHRlcm4iLCBwYXR0ZXJuLCByZWJvcm5LZXkpKTsK\nCQkJfQoJCX0gZmluYWxseSB7CgkJCXVubG9jaygpOwoJCX0KCX0KCQoJcHVi\nbGljIFF1ZXJ5U3RhdGlzdGljczxTdHJpbmc+IGdldFN0YXRpc3RpY3MoKSB7\nCgkJcmV0dXJuIF9zdGF0czsKCX0KCQoJLyoqCgkgKiBHZXRzIHRoZSBwYXR0\nZXJuIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gaWRlbnRpZmllci4KCSAqLwoJ\ncHJpdmF0ZSBFeGNsdXNpb24gZ2V0TWF0Y2hlZEV4Y2x1c2lvblBhdHRlcm4o\nU3RyaW5nIGlkKSB7CgkJZm9yIChFeGNsdXNpb24gcGF0dGVybiA6IF9leGNs\ndXNpb25QYXR0ZXJucykKCQkJaWYgKHBhdHRlcm4ubWF0Y2hlcyhpZCkpCgkJ\nCQlyZXR1cm4gcGF0dGVybjsKCQlyZXR1cm4gbnVsbDsKCX0KCQoJLyoqCgkg\nKiBHZXRzIHRoZSBrZXlzIG9mIHRoZSBnaXZlbiBtYXAgd2hvc2UgdmFsdWVz\nIG1hdGNoIHRoZSBnaXZlbiBwYXR0ZXJuLiAKCSAqLwoJcHJpdmF0ZSBDb2xs\nZWN0aW9uPFN0cmluZz4gZ2V0TWF0Y2hlZEtleXMoU3RyaW5nIHBhdHRlcm4s\nIE1hcDxTdHJpbmcsRXhjbHVzaW9uPiBtYXApIHsKICAgICAgICBMaXN0PFN0\ncmluZz4gcmVzdWx0ID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CgkJZm9y\nIChNYXAuRW50cnk8U3RyaW5nLCBFeGNsdXNpb24+IGVudHJ5IDogbWFwLmVu\ndHJ5U2V0KCkpIHsKCQkgICAgRXhjbHVzaW9uIGV4Y2x1c2lvbiA9IGVudHJ5\nLmdldFZhbHVlKCk7CgkJCWlmICghZXhjbHVzaW9uLmlzU3Ryb25nKCkgJiYg\nZXhjbHVzaW9uLm1hdGNoZXMocGF0dGVybikpIHsKCQkJCXJlc3VsdC5hZGQo\nZW50cnkuZ2V0S2V5KCkpOwoJCQl9CgkJfQoJCXJldHVybiByZXN1bHQ7Cgl9\nCgkKCS8qKgoJICogR2V0cyB0aGUgZWxlbWVudHMgb2YgdGhlIGdpdmVuIGxp\nc3Qgd2hpY2ggbWF0Y2ggdGhlIGdpdmVuIHBhdHRlcm4uIAoJICovCglwcml2\nYXRlIENvbGxlY3Rpb248U3RyaW5nPiBnZXRNYXRjaGVkS2V5cyhTdHJpbmcg\ncGF0dGVybiwgQ29sbGVjdGlvbjxTdHJpbmc+IGNvbGwpIHsKCQlMaXN0PFN0\ncmluZz4gcmVzdWx0ID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CgkJZm9y\nIChTdHJpbmcga2V5IDogY29sbCkgewoJCQlpZiAobWF0Y2hlcyhwYXR0ZXJu\nLCBrZXkpKSB7CgkJCQlyZXN1bHQuYWRkKGtleSk7CgkJCX0KCQl9CgkJcmV0\ndXJuIHJlc3VsdDsKCX0KCiAgICB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYg\nKF9sb2NrICE9IG51bGwpCiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAg\nIH0KCiAgICB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0g\nbnVsbCAmJiBfbG9jay5pc0xvY2tlZCgpKQogICAgICAgICAgICBfbG9jay51\nbmxvY2soKTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBtYXRjaGVzKFN0cmlu\nZyBwYXR0ZXJuLCBTdHJpbmcgdGFyZ2V0KSB7CiAgICAJcmV0dXJuIHRhcmdl\ndCAhPSBudWxsICYmICh0YXJnZXQuZXF1YWxzKHBhdHRlcm4pIAogICAgCSAg\nfHwgdGFyZ2V0Lm1hdGNoZXMocGF0dGVybikpOwogICAgfQogICAgCiAgICBi\nb29sZWFuIGlzSGludGVkKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgU3Ry\naW5nIGhpbnQpIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIE9iamVjdCByZXN1bHQgPSBm\nZXRjaC5nZXRIaW50KGhpbnQpOwogICAgICAgIHJldHVybiByZXN1bHQgIT0g\nbnVsbCAmJiAidHJ1ZSIuZXF1YWxzSWdub3JlQ2FzZShyZXN1bHQudG9TdHJp\nbmcoKSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGNsZWFyKCkgewog\nICAgICAgIF9kZWxlZ2F0ZS5jbGVhcigpOwogICAgICAgIF9zdGF0cy5jbGVh\ncigpOwogICAgfQogICAgICAgIAoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0t\nLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBDb25maWd1\ncmFibGUgY29udHJhY3QKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t\nLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIHZvaWQg\nc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgIAlf\nbG9nID0gY29uZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1JV\nTlRJTUUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0Q29uZmlndXJh\ndGlvbigpIHsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBlbmRDb25maWd1cmF0\naW9uKCkgewogICAgfQogICAgCiAgICAvKioKICAgICAqIEFuIGltbXV0YWJs\nZSBhYnN0cmFjdCBwYXR0ZXJuIGZvciBleGNsdXNpb24uCiAgICAgKgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBhYnN0cmFjdCBjbGFzcyBFeGNsdXNp\nb25QYXR0ZXJuIGltcGxlbWVudHMgUHJlcGFyZWRRdWVyeUNhY2hlLkV4Y2x1\nc2lvbiB7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9zdHJvbmc7\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgIF9wYXR0ZXJuOwogICAg\nICAgIHByaXZhdGUgZmluYWwgU3RyaW5nICBfcmVhc29uOwogICAgICAgIAog\nICAgICAgIHByaXZhdGUgc3RhdGljIExvY2FsaXplciBfbG9jID0gTG9jYWxp\nemVyLmZvclBhY2thZ2UoUHJlcGFyZWRRdWVyeUNhY2hlSW1wbC5jbGFzcyk7\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIFNUUk9ORyA9IF9sb2Mu\nZ2V0KCJzdHJvbmctZXhjbHVzaW9uIikuZ2V0TWVzc2FnZSgpOwogICAgICAg\nIHByaXZhdGUgc3RhdGljIFN0cmluZyBXRUFLICAgPSBfbG9jLmdldCgid2Vh\nay1leGNsdXNpb24iKS5nZXRNZXNzYWdlKCk7CiAgICAgICAgCiAgICAgICAg\ncHVibGljIEV4Y2x1c2lvblBhdHRlcm4oYm9vbGVhbiBzdHJvbmcsIFN0cmlu\nZyBwYXR0ZXJuLCBTdHJpbmcgcmVhc29uKSB7CiAgICAgICAgICAgIHN1cGVy\nKCk7CiAgICAgICAgICAgIHRoaXMuX3N0cm9uZyA9IHN0cm9uZzsKICAgICAg\nICAgICAgdGhpcy5fcGF0dGVybiA9IHBhdHRlcm47CiAgICAgICAgICAgIHRo\naXMuX3JlYXNvbiA9IHJlYXNvbjsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0UGF0dGVybigpIHsKICAgICAgICAgICAgcmV0dXJuIF9w\nYXR0ZXJuOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRS\nZWFzb24oKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhc29uOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNTdHJvbmcoKSB7CiAgICAg\nICAgICAgIHJldHVybiBfc3Ryb25nOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gbWF0Y2hlcyhTdHJpbmcgaWQpIHsKICAgICAgICAgICAg\ncmV0dXJuIF9wYXR0ZXJuICE9IG51bGwgJiYgKF9wYXR0ZXJuLmVxdWFscyhp\nZCkgfHwgX3BhdHRlcm4ubWF0Y2hlcyhpZCkpOwogICAgICAgIH0KICAgICAg\nICAKICAgICAgICAvKioKICAgICAgICAgKiBFcXVhbHMgYnkgc3RyZW5ndGgg\nYW5kIHBhdHRlcm4gKG5vdCBieSByZWFzb24pLgogICAgICAgICAqLwogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGVx\ndWFscyhPYmplY3Qgb3RoZXIpIHsKICAgICAgICAgICAgaWYgKG90aGVyID09\nIHRoaXMpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgaWYgKCEob3RoZXIgaW5zdGFuY2VvZiBFeGNsdXNpb24pKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBFeGNsdXNpb24g\ndGhhdCA9IChFeGNsdXNpb24pb3RoZXI7CiAgICAgICAgICAgIHJldHVybiB0\naGlzLl9zdHJvbmcgPT0gdGhhdC5pc1N0cm9uZygpIAogICAgICAgICAgICAg\nICAgJiYgU3RyaW5nVXRpbHMuZXF1YWxzKHRoaXMuX3BhdHRlcm4sIHRoYXQu\nZ2V0UGF0dGVybigpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIChfc3Ryb25nID8gMSA6IDApIAogICAgICAgICAgICAg\nICAgICsgKF9wYXR0ZXJuID09IG51bGwgPyAwIDogX3BhdHRlcm4uaGFzaENv\nZGUoKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgYnVm\nID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgYnVmLmFwcGVu\nZCgiICIpLmFwcGVuZChfc3Ryb25nID8gU1RST05HIDogV0VBSykuYXBwZW5k\nKCIuICIpOwogICAgICAgICAgICBpZiAoX3JlYXNvbiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZChfcmVhc29uKTsKICAgICAgICAgICAg\ncmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgLyoqCiAgICAgKiBTdHJvbmcgZXhjbHVzaW9uLgogICAgICoKICAgICAq\nLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBTdHJvbmdFeGNsdXNpb24gZXh0\nZW5kcyBFeGNsdXNpb25QYXR0ZXJuIHsKCiAgICAgICAgcHVibGljIFN0cm9u\nZ0V4Y2x1c2lvbihTdHJpbmcgcGF0dGVybiwgU3RyaW5nIHJlYXNvbikgewog\nICAgICAgICAgICBzdXBlcih0cnVlLCBwYXR0ZXJuLCByZWFzb24pOwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBXZWFrIGV4Y2x1c2lv\nbi4KICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgV2Vh\na0V4Y2x1c2lvbiBleHRlbmRzIEV4Y2x1c2lvblBhdHRlcm4gewoKICAgICAg\nICBwdWJsaWMgV2Vha0V4Y2x1c2lvbihTdHJpbmcgcGF0dGVybiwgU3RyaW5n\nIHJlYXNvbikgewogICAgICAgICAgICBzdXBlcihmYWxzZSwgcGF0dGVybiwg\ncmVhc29uKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

