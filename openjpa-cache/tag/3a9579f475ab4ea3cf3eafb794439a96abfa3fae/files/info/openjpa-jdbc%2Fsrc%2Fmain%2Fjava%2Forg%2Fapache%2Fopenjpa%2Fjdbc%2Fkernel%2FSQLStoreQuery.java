{"sha":"c19c6b4c30c1edc997c4efc3e23c5f887d1fb233","node_id":"MDQ6QmxvYjIwNjM2NDpjMTljNmI0YzMwYzFlZGM5OTdjNGVmYzNlMjNjNWY4ODdkMWZiMjMz","size":15702,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c19c6b4c30c1edc997c4efc3e23c5f887d1fb233","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uU3RyZWFt\nVG9rZW5pemVyOwppbXBvcnQgamF2YS5pby5TdHJpbmdSZWFkZXI7CmltcG9y\ndCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFy\nZWRTdGF0ZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9y\ndCBqYXZhLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQg\namF2YS51dGlsLk1hcDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuQ2xhc3NNYXBwaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5NYXBwaW5nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLm1ldGEuUXVlcnlSZXN1bHRNYXBwaW5nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLkRCRGljdGlvbmFyeTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNxbC5SZXN1bHRTZXRS\nZXN1bHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FM\nQnVmZmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlNR\nTEV4Y2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLkFic3RyYWN0U3RvcmVRdWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5rZXJuZWwuUXVlcnlDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmtlcm5lbC5TdG9yZVF1ZXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi5yb3AuUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLlJlc3VsdE9iamVjdFByb3Zp\nZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2Fs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhj\nZXB0aW9uOwoKCi8qKgogKiBBIFNRTCBxdWVyeS4KICoKICogQGF1dGhvciBB\nYmUgV2hpdGUKICogQG5vamF2YWRvYwogKi8KcHVibGljIGNsYXNzIFNRTFN0\nb3JlUXVlcnkKICAgIGV4dGVuZHMgQWJzdHJhY3RTdG9yZVF1ZXJ5IHsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2Fs\naXplci5mb3JQYWNrYWdlCiAgICAgICAgKFNRTFN0b3JlUXVlcnkuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgdHJhbnNpZW50IGZpbmFsIEpEQkNTdG9yZSBfc3Rv\ncmU7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSBxdWVyeSBtYW5hZ2Vk\nIGJ5IHRoZSBnaXZlbiBjb250ZXh0LgogICAgICovCiAgICBwdWJsaWMgU1FM\nU3RvcmVRdWVyeShKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICBfc3RvcmUg\nPSBzdG9yZTsKICAgIH0KCiAgICBwdWJsaWMgSkRCQ1N0b3JlIGdldFN0b3Jl\nKCkgewogICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSB7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkgewogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBFeGVjdXRvciBuZXdEYXRhU3Rv\ncmVFeGVjdXRvcihDbGFzc01ldGFEYXRhIG1ldGEsCiAgICAgICAgYm9vbGVh\nbiBzdWJjbGFzc2VzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTUUxFeGVjdXRv\ncih0aGlzLCBtZXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXF1\naXJlc0NhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzUGFyYW1ldGVyRGVj\nbGFyYXRpb25zKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEV4ZWN1dGVzIHRoZSBmaWx0ZXIgYXMgYSBTUUwgcXVl\ncnkuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU1FMRXhl\nY3V0b3IKICAgICAgICBleHRlbmRzIEFic3RyYWN0RXhlY3V0b3IgewoKICAg\nICAgICBwcml2YXRlIGZpbmFsIENsYXNzTWV0YURhdGEgX21ldGE7CiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9zZWxlY3Q7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBib29sZWFuIF9jYWxsOyAgIC8vIG5hdGl2ZSBjYWxsIHN0\nb3JlZCBwcm9jZWR1cmUKICAgICAgICBwcml2YXRlIGZpbmFsIFF1ZXJ5UmVz\ndWx0TWFwcGluZyBfcmVzdWx0TWFwcGluZzsKCiAgICAgICAgcHVibGljIFNR\nTEV4ZWN1dG9yKFNRTFN0b3JlUXVlcnkgcSwgQ2xhc3NNZXRhRGF0YSBjYW5k\naWRhdGUpIHsKICAgICAgICAgICAgUXVlcnlDb250ZXh0IGN0eCA9IHEuZ2V0\nQ29udGV4dCgpOwogICAgICAgICAgICBTdHJpbmcgcmVzdWx0TWFwcGluZyA9\nIGN0eC5nZXRSZXN1bHRNYXBwaW5nTmFtZSgpOwogICAgICAgICAgICBpZiAo\ncmVzdWx0TWFwcGluZyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3Jlc3Vs\ndE1hcHBpbmcgPSBudWxsOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAg\nICAgICAgIENsYXNzTG9hZGVyIGVudkxvYWRlciA9IGN0eC5nZXRTdG9yZUNv\nbnRleHQoKS5nZXRDbGFzc0xvYWRlcigpOwogICAgICAgICAgICAgICAgTWFw\ncGluZ1JlcG9zaXRvcnkgcmVwb3MgPSBxLmdldFN0b3JlKCkuZ2V0Q29uZmln\ndXJhdGlvbigpLgogICAgICAgICAgICAgICAgICAgIGdldE1hcHBpbmdSZXBv\nc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIF9yZXN1bHRNYXBw\naW5nID0gcmVwb3MuZ2V0UXVlcnlSZXN1bHRNYXBwaW5nCiAgICAgICAgICAg\nICAgICAgICAgKGN0eC5nZXRSZXN1bHRNYXBwaW5nU2NvcGUoKSwgcmVzdWx0\nTWFwcGluZywgZW52TG9hZGVyLAogICAgICAgICAgICAgICAgICAgICAgICB0\ncnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfbWV0YSA9IGNhbmRp\nZGF0ZTsKCiAgICAgICAgICAgIFN0cmluZyBzcWwgPSBTdHJpbmdVdGlscy50\ncmltVG9OdWxsKGN0eC5nZXRRdWVyeVN0cmluZygpKTsKICAgICAgICAgICAg\naWYgKHNxbCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVz\nZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLXNxbCIpKTsKICAgICAgICAgICAg\nX3NlbGVjdCA9IHEuZ2V0U3RvcmUoKS5nZXREQkRpY3Rpb25hcnkoKS5pc1Nl\nbGVjdChzcWwpOwogICAgICAgICAgICBfY2FsbCA9IHNxbC5sZW5ndGgoKSA+\nIDQKICAgICAgICAgICAgICAgICYmIHNxbC5zdWJzdHJpbmcoMCwgNCkuZXF1\nYWxzSWdub3JlQ2FzZSgiY2FsbCIpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIGludCBnZXRPcGVyYXRpb24oU3RvcmVRdWVyeSBxKSB7CiAgICAgICAg\nICAgcmV0dXJuIF9zZWxlY3QgPyBPUF9TRUxFQ1QgOiAKICAgICAgICAgICAg\nICAgIChxLmdldENvbnRleHQoKS5nZXRDYW5kaWRhdGVUeXBlKCkgIT0gbnVs\nbAogICAgICAgICAgICAgICAgICAgICAgICB8fCBxLmdldENvbnRleHQoKS5n\nZXRSZXN1bHRUeXBlKCkgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAg\nICB8fCBxLmdldENvbnRleHQoKS5nZXRSZXN1bHRNYXBwaW5nTmFtZSgpICE9\nIG51bGwgCiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHEuZ2V0Q29udGV4\ndCgpLmdldFJlc3VsdE1hcHBpbmdTY29wZSgpICE9IG51bGwpCiAgICAgICAg\nICAgICAgICAgICAgICAgID8gT1BfU0VMRUNUIDogT1BfVVBEQVRFOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE51bWJlciBleGVjdXRlVXBkYXRlKFN0\nb3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgICAgIEpE\nQkNTdG9yZSBzdG9yZSA9ICgoU1FMU3RvcmVRdWVyeSkgcSkuZ2V0U3RvcmUo\nKTsKICAgICAgICAgICAgREJEaWN0aW9uYXJ5IGRpY3QgPSBzdG9yZS5nZXRE\nQkRpY3Rpb25hcnkoKTsKICAgICAgICAgICAgU3RyaW5nIHNxbCA9IHEuZ2V0\nQ29udGV4dCgpLmdldFF1ZXJ5U3RyaW5nKCk7CgogICAgICAgICAgICBMaXN0\nIHBhcmFtTGlzdCA9IG5ldyBBcnJheUxpc3QoQXJyYXlzLmFzTGlzdChwYXJh\nbXMpKTsKICAgICAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZm\nZXIoZGljdCkuYXBwZW5kKHNxbCk7CiAgICAgICAgICAgIAogICAgICAgICAg\nICAvLyB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB3ZSBoYXZlIGFuIGFjdGl2ZSBz\ndG9yZSBjb25uZWN0aW9uCiAgICAgICAgICAgIHN0b3JlLmdldENvbnRleHQo\nKS5iZWdpblN0b3JlKCk7CiAgICAgICAgICAgIENvbm5lY3Rpb24gY29ubiA9\nIHN0b3JlLmdldENvbm5lY3Rpb24oKTsKICAgICAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCA9IChKREJDRmV0Y2hDb25maWd1cmF0aW9u\nKQogICAgICAgICAgICAgICAgcS5nZXRDb250ZXh0KCkuZ2V0RmV0Y2hDb25m\naWd1cmF0aW9uKCk7CgogICAgICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBpZiAoX2NhbGwpCiAgICAgICAgICAgICAgICAgICAgc3RtbnQgPSBwcmVw\nYXJlQ2FsbChjb25uLCBidWYpOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0YXRlbWVudChjb25u\nLCBidWYpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBidWYu\nc2V0UGFyYW1ldGVycyhwYXJhbUxpc3QpOwogICAgICAgICAgICAgICAgaWYg\nKHN0bW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgYnVmLnNldFBh\ncmFtZXRlcnMoc3RtbnQpOwoKICAgICAgICAgICAgICAgIGRpY3Quc2V0VGlt\nZW91dHMoc3RtbnQsIGZldGNoLCB0cnVlKTsKICAgICAgICAgICAgICAgIAog\nICAgICAgICAgICAgICAgaW50IGNvdW50ID0gZXhlY3V0ZVVwZGF0ZShzdG9y\nZSwgY29ubiwgc3RtbnQsIGJ1Zik7ICAKICAgICAgICAgICAgICAKICAgICAg\nICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBTUUxF\neGNlcHRpb25zLmdldFN0b3JlKHNlLCBkaWN0KTsKICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gc2UpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gc2FmZSB0byBpZ25vcmUKICAgICAgICAgICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBzdG1udCA9IG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBjb25uLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc2UpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1\ndGVRdWVyeShTdG9yZVF1ZXJ5IHEsCiAgICAgICAgICAgIE9iamVjdFtdIHBh\ncmFtcywgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgSkRCQ1N0b3JlIHN0\nb3JlID0gKChTUUxTdG9yZVF1ZXJ5KSBxKS5nZXRTdG9yZSgpOwogICAgICAg\nICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IHN0b3JlLmdldERCRGljdGlvbmFy\neSgpOwogICAgICAgICAgICBTdHJpbmcgc3FsID0gcS5nZXRDb250ZXh0KCku\nZ2V0UXVlcnlTdHJpbmcoKTsKCiAgICAgICAgICAgIExpc3QgcGFyYW1MaXN0\nID0gbmV3IEFycmF5TGlzdChBcnJheXMuYXNMaXN0KHBhcmFtcykpOwogICAg\nICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcihkaWN0KS5h\ncHBlbmQoc3FsKTsKICAgICAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gc3Rv\ncmUuZ2V0Q29ubmVjdGlvbigpOwogICAgICAgICAgICBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoID0gKEpEQkNGZXRjaENvbmZpZ3VyYXRpb24pCiAg\nICAgICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRGZXRjaENvbmZpZ3Vy\nYXRpb24oKTsKCiAgICAgICAgICAgIFJlc3VsdE9iamVjdFByb3ZpZGVyIHJv\ncDsKICAgICAgICAgICAgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQgPSBudWxs\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gdXNlIHRo\nZSByaWdodCBtZXRob2QgZGVwZW5kaW5nIG9uIHNlbCB2cy4gcHJvYywgbHJz\nIHNldHRpbmcKICAgICAgICAgICAgICAgIGlmIChfc2VsZWN0ICYmICFyYW5n\nZS5scnMpCiAgICAgICAgICAgICAgICAgICAgc3RtbnQgPSBwcmVwYXJlU3Rh\ndGVtZW50KGNvbm4sIGJ1Zik7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChf\nc2VsZWN0KQogICAgICAgICAgICAgICAgICAgIHN0bW50ID0gcHJlcGFyZVN0\nYXRlbWVudChjb25uLCBidWYsIGZldGNoLCAtMSwgLTEpOwogICAgICAgICAg\nICAgICAgZWxzZSBpZiAoIXJhbmdlLmxycykKICAgICAgICAgICAgICAgICAg\nICBzdG1udCA9IHByZXBhcmVDYWxsKGNvbm4sIGJ1Zik7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc3RtbnQgPSBwcmVwYXJl\nQ2FsbChjb25uLCBidWYsIGZldGNoLCAtMSwgLTEpOwoKICAgICAgICAgICAg\nICAgIGludCBpbmRleCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJh\ndG9yIGkgPSBwYXJhbUxpc3QuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCkgJiYg\nCiAgICAgICAgICAgICAgICAgICAgc3RtbnQgIT0gbnVsbDspCiAgICAgICAg\nICAgICAgICAgICAgZGljdC5zZXRVbmtub3duKHN0bW50LCArK2luZGV4LCBp\nLm5leHQoKSwgbnVsbCk7CgogICAgICAgICAgICAgICAgZGljdC5zZXRUaW1l\nb3V0cyhzdG1udCwgZmV0Y2gsIGZhbHNlKTsKICAgICAgICAgICAgICAgIFJl\nc3VsdFNldCBycyA9IGV4ZWN1dGVRdWVyeShzdG9yZSwgY29ubiwgc3RtbnQs\nIGJ1ZiwgcGFyYW1MaXN0KTsKICAgICAgICAgICAgICAgIFJlc3VsdFNldFJl\nc3VsdCByZXMgPSBzdG1udCAhPSBudWxsID8gCiAgICAgICAgICAgICAgICAg\nICAgbmV3IFJlc3VsdFNldFJlc3VsdChjb25uLCBzdG1udCwgcnMsIHN0b3Jl\nKSA6CiAgICAgICAgICAgICAgICAgICAgbmV3IFJlc3VsdFNldFJlc3VsdChj\nb25uLCBycywgZGljdCk7CiAgICAgICAgICAgICAgICBpZiAoX3Jlc3VsdE1h\ncHBpbmcgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByb3AgPSBuZXcg\nTWFwcGVkUXVlcnlSZXN1bHRPYmplY3RQcm92aWRlcihfcmVzdWx0TWFwcGlu\nZywKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUsIGZldGNoLCByZXMp\nOwogICAgICAgICAgICAgICAgZWxzZSBpZiAocS5nZXRDb250ZXh0KCkuZ2V0\nQ2FuZGlkYXRlVHlwZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\ncm9wID0gbmV3IEdlbmVyaWNSZXN1bHRPYmplY3RQcm92aWRlcigoQ2xhc3NN\nYXBwaW5nKSBfbWV0YSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUs\nIGZldGNoLCByZXMpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIHJvcCA9IG5ldyBTUUxQcm9qZWN0aW9uUmVzdWx0T2JqZWN0\nUHJvdmlkZXIoc3RvcmUsIGZldGNoLAogICAgICAgICAgICAgICAgICAgICAg\nICByZXMsIHEuZ2V0Q29udGV4dCgpLmdldFJlc3VsdFR5cGUoKSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAg\nICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nMikge30KICAgICAgICAgICAgICAgIHRyeSB7IGNvbm4uY2xvc2UoKTsgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlMikge30KICAgICAgICAgICAgICAgIHRo\ncm93IFNRTEV4Y2VwdGlvbnMuZ2V0U3RvcmUoc2UsIGRpY3QpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gMCB8fCBy\nYW5nZS5lbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAgICAgICBy\nb3AgPSBuZXcgUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIHJhbmdl\nLnN0YXJ0LHJhbmdlLmVuZCk7CiAgICAgICAgICAgIHJldHVybiByb3A7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3Jl\nQWN0aW9ucyhTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAg\nICAgICAgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBT\ndHJpbmdbXXsgcS5nZXRDb250ZXh0KCkuZ2V0UXVlcnlTdHJpbmcoKSB9Owog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQYWNraW5nKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gcS5nZXRDb250ZXh0\nKCkuZ2V0Q2FuZGlkYXRlVHlwZSgpID09IG51bGw7CiAgICAgICAgfQogICAg\nICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHRv\nIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAK\nICAgICAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgY2FsbCBz\ndGF0ZW1lbnQuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVkIFByZXBh\ncmVkU3RhdGVtZW50IHByZXBhcmVDYWxsKENvbm5lY3Rpb24gY29ubiwgU1FM\nQnVmZmVyIGJ1ZikKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHJldHVybiBidWYucHJlcGFyZUNhbGwoY29ubik7ICAg\nICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qKgogICAg\nICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9y\nIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAgICAgKiBpbXBsZW1lbnRh\ndGlvbiBvZiBleGVjdXRpbmcgdXBkYXRlLgogICAgICAgICAqLwogICAgICAg\nIHByb3RlY3RlZCBpbnQgZXhlY3V0ZVVwZGF0ZShKREJDU3RvcmUgc3RvcmUs\nIENvbm5lY3Rpb24gY29ubiwgCiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBTUUxCdWZmZXIgYnVmKSAKICAgICAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGludCBjb3VudCA9IDA7CiAg\nICAgICAgICAgIGlmIChfY2FsbCAmJiBzdG1udC5leGVjdXRlKCkgPT0gZmFs\nc2UpIHsKICAgICAgICAgICAgICAgIGNvdW50ID0gc3RtbnQuZ2V0VXBkYXRl\nQ291bnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAg\nICAgICAgICAgICAgIC8vIG5hdGl2ZSBpbnNlcnQsIHVwZGF0ZSwgZGVsZXRl\nCiAgICAgICAgICAgICAgICBjb3VudCA9IHN0bW50LmV4ZWN1dGVVcGRhdGUo\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY291bnQ7CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFRoaXMg\nbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9y\nIEpEQkMtbGlrZSAKICAgICAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVw\nYXJpbmcgY2FsbCBzdGF0ZW1lbnQuCiAgICAgICAgICovCiAgICAgICAgcHJv\ndGVjdGVkIFByZXBhcmVkU3RhdGVtZW50IHByZXBhcmVDYWxsKENvbm5lY3Rp\nb24gY29ubiwgU1FMQnVmZmVyIGJ1ZiwKICAgICAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgaW50IHJzQ29uY3Vy\nKQogICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIGJ1Zi5wcmVwYXJlQ2FsbChjb25uLCBmZXRjaCwgcnNUeXBl\nLCByc0NvbmN1cik7ICAKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5v\nbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAgICAgKiBpbXBsZW1lbnRhdGlv\nbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50LgogICAgICAgICAqLwogICAgICAg\nIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50\nKENvbm5lY3Rpb24gY29ubiwgCiAgICAgICAgICAgIFNRTEJ1ZmZlciBidWYp\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gYnVm\nLnByZXBhcmVTdGF0ZW1lbnQoY29ubik7CiAgICAgICAgfQogICAgICAgIAog\nICAgICAgIC8qKgogICAgICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3Zp\nZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAg\nICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50Lgog\nICAgICAgICAqLwogICAgICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVu\ndCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgCiAgICAgICAg\nICAgIFNRTEJ1ZmZlciBidWYsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0\nY2gsIGludCByc1R5cGUsCiAgICAgICAgICAgIGludCByc0NvbmN1cikgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBidWYucHJl\ncGFyZVN0YXRlbWVudChjb25uLCBmZXRjaCwgcnNUeXBlLCByc0NvbmN1cik7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFRo\naXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJD\nIG9yIEpEQkMtbGlrZSAKICAgICAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBl\neGVjdXRpbmcgcXVlcnkuCiAgICAgICAgICovCiAgICAgICAgcHJvdGVjdGVk\nIFJlc3VsdFNldCBleGVjdXRlUXVlcnkoSkRCQ1N0b3JlIHN0b3JlLCBDb25u\nZWN0aW9uIGNvbm4sCiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBTUUxCdWZmZXIgYnVmLCBMaXN0IHBhcmFtTGlzdCkKICAgICAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBz\ndG1udC5leGVjdXRlUXVlcnkoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgLyoqCiAgICAgICAgICogVGhlIGdpdmVuIHF1ZXJ5IGlzIHBhcnNlZCB0\nbyBmaW5kIHRoZSBwYXJhbWV0ZXIgdG9rZW5zIG9mIHRoZSBmb3JtCiAgICAg\nICAgICogPGNvZGU+P248L2NvZGU+IHdoaWNoIGlzIGRpZmZlcmVudCB0aGFu\nIDxjb2RlPj88L2NvZGU+IHRva2VucyBpbgogICAgICAgICAqIGFjdHVhbCBT\nUUwgcGFyYW1ldGVyIHRva2Vucy4gVGhlc2UgPGNvZGU+P248L2NvZGU+IHN0\neWxlIHRva2VucwogICAgICAgICAqIGFyZSByZXBsYWNlZCBpbiB0aGUgcXVl\ncnkgc3RyaW5nIGJ5IDxjb2RlPj88L2NvZGU+IHRva2Vucy4gCiAgICAgICAg\nICogCiAgICAgICAgICogRHVyaW5nIHRoZSB0b2tlbiBwYXJzaW5nLCB0aGUg\nb3JkZXJpbmcgb2YgdGhlIHRva2VucyBpcyByZWNvcmRlZC4gCiAgICAgICAg\nICogVGhlIGdpdmVuIHVzZXJQYXJhbSBtdXN0IGNvbnRhaW4gcGFyYW1ldGVy\nIGtleXMgYXMgSW50ZWdlciBhbmQKICAgICAgICAgKiB0aGUgc2FtZSBJbnRl\nZ2VycyBtdXN0IGFwcGVhciBpbiB0aGUgdG9rZW5zLiAKICAgICAgICAgKiAK\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9QYXJhbWV0\nZXJBcnJheShTdG9yZVF1ZXJ5IHEsIE1hcCB1c2VyUGFyYW1zKSB7CiAgICAg\nICAgICAgIGlmICh1c2VyUGFyYW1zID09IG51bGwgfHwgdXNlclBhcmFtcy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgICAgICByZXR1cm4gU3RvcmVRdWVyeS5F\nTVBUWV9PQkpFQ1RTOwogICAgICAgICAgICBTdHJpbmcgc3FsID0gcS5nZXRD\nb250ZXh0KCkuZ2V0UXVlcnlTdHJpbmcoKTsKICAgICAgICAgICAgTGlzdDxJ\nbnRlZ2VyPiBwYXJhbU9yZGVyID0gbmV3IEFycmF5TGlzdDxJbnRlZ2VyPigp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3FsID0gc3Vi\nc3RpdHV0ZVBhcmFtcyhzcWwsIHBhcmFtT3JkZXIpOwogICAgICAgICAgICB9\nIGNhdGNoIChJT0V4Y2VwdGlvbiBleCkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oZXguZ2V0TG9jYWxpemVkTWVzc2FnZSgp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgT2Jq\nZWN0W10gcmVzdWx0ID0gbmV3IE9iamVjdFtwYXJhbU9yZGVyLnNpemUoKV07\nCiAgICAgICAgICAgIGludCBpZHggPSAwOwogICAgICAgICAgICBmb3IgKElu\ndGVnZXIga2V5IDogcGFyYW1PcmRlcikgewogICAgICAgICAgICAgICAgaWYg\nKCF1c2VyUGFyYW1zLmNvbnRhaW5zS2V5KGtleSkpIAogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1cGFy\nYW0tbWlzc2luZyIsIAogICAgICAgICAgICAgICAgICAgICAgICBrZXksIHNx\nbCwgdXNlclBhcmFtcykpOwogICAgICAgICAgICAgICAgcmVzdWx0W2lkeCsr\nXSA9IHVzZXJQYXJhbXMuZ2V0KGtleSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgLy8gbW9kaWZ5IG9yaWdpbmFsIEpQQS1zdHlsZSBTUUwgdG8gcHJv\ncGVyIFNRTAogICAgICAgICAgICBxLmdldENvbnRleHQoKS5nZXRRdWVyeSgp\nLnNldFF1ZXJ5KHNxbCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAg\nICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIFV0aWxpdHkgbWV0\naG9kIHRvIHN1YnN0aXR1dGUgJz9udW0nIGZvciBwYXJhbWV0ZXJzIGluIHRo\nZSBnaXZlbiBTUUwKICAgICAqIHN0YXRlbWVudCwgYW5kIGZpbGwtaW4gdGhl\nIG9yZGVyIG9mIHRoZSBwYXJhbWV0ZXIgdG9rZW5zCiAgICAgKi8KICAgIHB1\nYmxpYyBzdGF0aWMgU3RyaW5nIHN1YnN0aXR1dGVQYXJhbXMoU3RyaW5nIHNx\nbCwgTGlzdDxJbnRlZ2VyPiBwYXJhbU9yZGVyKQogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG5v\nICI/IiBwYXJhbWV0ZXIgbWFya2VyLCB0aGVuIHdlIGRvbid0IG5lZWQgdG8K\nICAgICAgICAgICAgLy8gcGVyZm9ybSB0aGUgcGFyc2luZyBwcm9jZXNzCiAg\nICAgICAgICAgIGlmIChzcWwuaW5kZXhPZigiPyIpID09IC0xKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHNxbDsKCiAgICAgICAgICAgIHBhcmFtT3JkZXIu\nY2xlYXIoKTsKICAgICAgICAgICAgU3RyZWFtVG9rZW5pemVyIHRvayA9IG5l\ndyBTdHJlYW1Ub2tlbml6ZXIobmV3IFN0cmluZ1JlYWRlcihzcWwpKTsKICAg\nICAgICAgICAgdG9rLnJlc2V0U3ludGF4KCk7CiAgICAgICAgICAgIHRvay5x\ndW90ZUNoYXIoJ1wnJyk7CiAgICAgICAgICAgIHRvay53b3JkQ2hhcnMoJzAn\nLCAnOScpOwogICAgICAgICAgICB0b2sud29yZENoYXJzKCc/JywgJz8nKTsK\nCiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1\naWxkZXIoc3FsLmxlbmd0aCgpKTsKICAgICAgICAgICAgZm9yIChpbnQgdHR5\ncGU7ICh0dHlwZSA9IHRvay5uZXh0VG9rZW4oKSkgIT0KICAgICAgICAgICAg\nICAgICAgICBTdHJlYW1Ub2tlbml6ZXIuVFRfRU9GOykgewogICAgICAgICAg\nICAgICAgc3dpdGNoICh0dHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNh\nc2UgU3RyZWFtVG9rZW5pemVyLlRUX1dPUkQ6CiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIGEgdG9rZW4gaXMgYSBwb3NpdGlvbmFsIHBhcmFtZXRlciBp\nZiBpdCBzdGFydHMgd2l0aAogICAgICAgICAgICAgICAgICAgICAgICAvLyBh\nICI/IiBhbmQgdGhlIHJlc3Qgb2YgdGhlIHRva2VuIGFyZSBhbGwgbnVtYmVy\ncwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rLnN2YWwuc3RhcnRz\nV2l0aCgiPyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKCI/Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJp\nbmcgcEluZGV4ID0gdG9rLnN2YWwuc3Vic3RyaW5nKDEpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHBJbmRleC5sZW5ndGgoKSA+IDApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbU9yZGVyLmFk\nZChJbnRlZ2VyLnZhbHVlT2YocEluZGV4KSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgeyAvLyBvciBub3RoaW5nCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcGFyYW1PcmRlci5hZGQocGFyYW1PcmRl\nci5zaXplKCkrMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYnVmLmFwcGVuZCh0b2suc3ZhbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Un\nXCcnOgogICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCdcJycp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rLnN2YWwgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLmFwcGVuZCh0\nb2suc3ZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCdcJycpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoKGNo\nYXIpIHR0eXBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9Cn0K\n","encoding":"base64"}

