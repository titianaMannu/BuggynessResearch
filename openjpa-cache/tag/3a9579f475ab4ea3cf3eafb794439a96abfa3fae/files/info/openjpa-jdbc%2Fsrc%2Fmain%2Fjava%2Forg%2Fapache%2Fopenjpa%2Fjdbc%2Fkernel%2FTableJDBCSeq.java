{"sha":"a48a6ca9bb5e754175e6dae74e89ef3cb5ba1871","node_id":"MDQ6QmxvYjIwNjM2NDphNDhhNmNhOWJiNWU3NTQxNzVlNmRhZTc0ZTg5ZWYzY2I1YmExODcx","size":34988,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/a48a6ca9bb5e754175e6dae74e89ef3cb5ba1871","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWw7CgppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5Db25u\nZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0ZW1lbnQ7Cmlt\ncG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZhLnNxbC5TUUxF\neGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0IGphdmEu\ndXRpbC5IYXNoTWFwOwoKaW1wb3J0IGphdmF4LnRyYW5zYWN0aW9uLk5vdFN1\ncHBvcnRlZEV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nbGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLmNvbmYuSkRCQ0NvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uSW1wbDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZpZXIuTm9ybWFs\naXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmlkZW50aWZp\nZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuaWRlbnRpZmllci5RdWFsaWZpZWREQklkZW50aWZpZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmll\nci5EQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYUdyb3VwOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNjaGVtYVRvb2w7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5UYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5VbmlxdWU7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuREJEaWN0aW9u\nYXJ5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc3FsLlJvd0lt\ncGw7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWwuU1FMQnVm\nZmVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZp\nZ3VyYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5D\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5j\nb25mLkNvbmZpZ3VyYXRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi5pZGVudGlmaWVyLklkZW50aWZpZXJVdGlsOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKCgovLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8KLy8gTk9URTogRG8gbm90IGNoYW5nZSBwcm9wZXJ0eSBuYW1lczsg\nc2VlIFNlcXVlbmNlTWV0YURhdGEKLy8gYW5kIFNlcXVlbmNlTWFwcGluZyBm\nb3Igc3RhbmRhcmQgcHJvcGVydHkgbmFtZXMuCi8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoK\nLyoqCiAqIHtAbGluayBKREJDU2VxfSBpbXBsZW1lbnRhdGlvbiB0aGF0IHVz\nZXMgYSBkYXRhYmFzZSB0YWJsZQogKiBmb3Igc2VxdWVuY2UgbnVtYmVyIGdl\nbmVyYXRpb24uIFRoaXMgYmFzZSBpbXBsZW1lbnRhdGlvbiB1c2VzIGEgc2lu\nZ2xlCiAqIHJvdyBmb3IgYSBnbG9iYWwgc2VxdWVuY2UgbnVtYmVyLgogKgog\nKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNzIFRhYmxlSkRC\nQ1NlcQogICAgZXh0ZW5kcyBBYnN0cmFjdEpEQkNTZXEKICAgIGltcGxlbWVu\ndHMgQ29uZmlndXJhYmxlIHsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBBQ1RJT05fRFJPUCA9ICJkcm9wIjsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgU3RyaW5nIEFDVElPTl9BREQgPSAiYWRkIjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9HRVQgPSAiZ2V0IjsKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFDVElPTl9TRVQgPSAic2V0IjsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIERFRkFVTFRfVEFCTEUg\nPSAiT1BFTkpQQV9TRVFVRU5DRV9UQUJMRSI7CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBh\nY2thZ2UKICAgICAgICAoVGFibGVKREJDU2VxLmNsYXNzKTsKCiAgICBwcml2\nYXRlIHRyYW5zaWVudCBKREJDQ29uZmlndXJhdGlvbiBfY29uZiA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBMb2cgX2xvZyA9IG51bGw7CiAgICBw\ncml2YXRlIGludCBfYWxsb2MgPSA1MDsKICAgIHByaXZhdGUgaW50IF9pbnRW\nYWx1ZSA9IDE7CiAgICBwcml2YXRlIGZpbmFsIEhhc2hNYXA8Q2xhc3NNYXBw\naW5nLCBTdGF0dXM+IF9zdGF0ID0KICAgICAgICBuZXcgSGFzaE1hcDxDbGFz\nc01hcHBpbmcsIFN0YXR1cz4oKTsKCiAgICBwcml2YXRlIERCSWRlbnRpZmll\nciBfdGFibGUgPSBEQklkZW50aWZpZXIubmV3VGFibGUoREVGQVVMVF9UQUJM\nRSk7CiAgICBwcml2YXRlIERCSWRlbnRpZmllciBfc2VxQ29sdW1uTmFtZSA9\nIERCSWRlbnRpZmllci5uZXdDb2x1bW4oIlNFUVVFTkNFX1ZBTFVFIik7CiAg\nICBwcml2YXRlIERCSWRlbnRpZmllciBfcGtDb2x1bW5OYW1lID0gREJJZGVu\ndGlmaWVyLm5ld0NvbHVtbigiSUQiKTsKICAgIHByaXZhdGUgREJJZGVudGlm\naWVyW10gX3VuaXF1ZUNvbHVtbk5hbWVzOwogICAgcHJpdmF0ZSBEQklkZW50\naWZpZXIgX3VuaXF1ZUNvbnN0cmFpbnROYW1lID0gREJJZGVudGlmaWVyLk5V\nTEw7CgogICAgcHJpdmF0ZSBDb2x1bW4gX3NlcUNvbHVtbiA9IG51bGw7CiAg\nICBwcml2YXRlIENvbHVtbiBfcGtDb2x1bW4gPSBudWxsOwogICAgCiAgICAv\nKioKICAgICAqIFRoZSBzZXF1ZW5jZSB0YWJsZSBuYW1lLiBEZWZhdWx0cyB0\nbyA8Y29kZT5PUEVOSlBBX1NFUVVFTkNFX1RBQkxFPC9jb2RlPi4KICAgICAq\nIEJ5IGRlZmF1bHQsIHRoZSB0YWJsZSB3aWxsIGJlIHBsYWNlZCBpbiB0aGUg\nZmlyc3Qgc2NoZW1hIGxpc3RlZCBpbiB5b3VyCiAgICAgKiA8Y29kZT5vcGVu\nanBhLmpkYmMuU2NoZW1hczwvY29kZT4gcHJvcGVydHksIG9yIGluIHRoZSBk\nZWZhdWx0IHNjaGVtYSBpZgogICAgICogdGhlIHByb3BlcnR5IGlzIG5vdCBn\naXZlbi4gSWYgeW91IHNwZWNpZnkgYSB0YWJsZSBuYW1lIGluIHRoZSBmb3Jt\nCiAgICAgKiA8Y29kZT4mbHQ7c2NoZW1hJmd0Oy4mbHQ7dGFibGUmZ3Q7PC9j\nb2RlPiwgdGhlbiB0aGUgZ2l2ZW4gc2NoZW1hCiAgICAgKiB3aWxsIGJlIHVz\nZWQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0VGFibGUoKSB7CiAg\nICAgICAgcmV0dXJuIF90YWJsZS5nZXROYW1lKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGUgc2VxdWVuY2UgdGFibGUgbmFtZS4gRGVmYXVsdHMgdG8g\nPGNvZGU+T1BFTkpQQV9TRVFVRU5DRV9UQUJMRTwvY29kZT4uCiAgICAgKiBC\neSBkZWZhdWx0LCB0aGUgdGFibGUgd2lsbCBiZSBwbGFjZWQgaW4gdGhlIGZp\ncnN0IHNjaGVtYSBsaXN0ZWQgaW4geW91cgogICAgICogPGNvZGU+b3Blbmpw\nYS5qZGJjLlNjaGVtYXM8L2NvZGU+IHByb3BlcnR5LCBvciBpbiB0aGUgZGVm\nYXVsdCBzY2hlbWEgaWYKICAgICAqIHRoZSBwcm9wZXJ0eSBpcyBub3QgZ2l2\nZW4uIElmIHlvdSBzcGVjaWZ5IGEgdGFibGUgbmFtZSBpbiB0aGUgZm9ybQog\nICAgICogPGNvZGU+Jmx0O3NjaGVtYSZndDsuJmx0O3RhYmxlJmd0OzwvY29k\nZT4sIHRoZW4gdGhlIGdpdmVuIHNjaGVtYQogICAgICogd2lsbCBiZSB1c2Vk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUYWJsZShTdHJpbmcgbmFt\nZSkgewogICAgICAgIC8vIFNwbGl0IHRoZSBuYW1lIGludG8gaXRzIGluZGl2\naWR1YWwgcGFydHMKICAgICAgICBTdHJpbmdbXSBuYW1lcyA9IE5vcm1hbGl6\nZXIuc3BsaXROYW1lKG5hbWUpOwogICAgICAgIC8vIEpvaW4gdGhlIG5hbWUg\nYmFjayB0b2dldGhlci4gIFRoaXMgd2lsbCBkZWxpbWl0IGFzIGFwcHJvcHJp\nYXRlLgogICAgICAgIF90YWJsZSA9IERCSWRlbnRpZmllci5uZXdUYWJsZShO\nb3JtYWxpemVyLmpvaW5OYW1lcyhuYW1lcykpOwogICAgfQoKICAgIC8qKgog\nICAgICogQGRlcHJlY2F0ZWQgVXNlIHtAbGluayAjc2V0VGFibGV9LiBSZXRh\naW5lZCBmb3IKICAgICAqIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5CXdpdGgg\nYXV0by1jb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRUYWJsZU5hbWUoU3RyaW5nIG5hbWUpIHsKICAgICAgICBzZXRUYWJsZShu\nYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBj\nb2x1bW4gdGhhdCBob2xkcyB0aGUgc2VxdWVuY2UgdmFsdWUuIERlZmF1bHRz\nCiAgICAgKiB0byA8Y29kZT5TRVFVRU5DRV9WQUxVRTwvY29kZT4uCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U2VxdWVuY2VDb2x1bW4oKSB7CiAg\nICAgICAgcmV0dXJuIF9zZXFDb2x1bW5OYW1lLmdldE5hbWUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSBjb2x1bW4gdGhhdCBo\nb2xkcyB0aGUgc2VxdWVuY2UgdmFsdWUuIERlZmF1bHRzCiAgICAgKiB0byA8\nY29kZT5TRVFVRU5DRV9WQUxVRTwvY29kZT4uCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldFNlcXVlbmNlQ29sdW1uKFN0cmluZyBzZXF1ZW5jZUNvbHVt\nbikgewogICAgICAgIF9zZXFDb2x1bW5OYW1lID0gREJJZGVudGlmaWVyLm5l\nd0NvbHVtbihzZXF1ZW5jZUNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGUgbmFtZSBvZiB0aGUgdGFibGUncyBwcmltYXJ5IGtleSBjb2x1bW4u\nIERlZmF1bHRzIHRvCiAgICAgKiA8Y29kZT5JRDwvY29kZT4uCiAgICAgKi8K\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0UHJpbWFyeUtleUNvbHVtbigpIHsKICAg\nICAgICByZXR1cm4gX3BrQ29sdW1uTmFtZS5nZXROYW1lKCk7CiAgICB9Cgog\nICAgcHVibGljIERCSWRlbnRpZmllciBnZXRQcmltYXJ5S2V5Q29sdW1uSWRl\nbnRpZmllcigpIHsKICAgICAgICByZXR1cm4gX3BrQ29sdW1uTmFtZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRoZSBuYW1lIG9mIHRoZSB0YWJsZSdzIHBy\naW1hcnkga2V5IGNvbHVtbi4gRGVmYXVsdHMgdG8KICAgICAqIDxjb2RlPklE\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0UHJpbWFyeUtl\neUNvbHVtbihTdHJpbmcgcHJpbWFyeUtleUNvbHVtbikgewogICAgICAgIF9w\na0NvbHVtbk5hbWUgPSBEQklkZW50aWZpZXIubmV3Q29sdW1uKHByaW1hcnlL\nZXlDb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBu\ndW1iZXIgb2Ygc2VxdWVuY2VzIHRvIGFsbG9jYXRlIGZvciBlYWNoIHVwZGF0\nZSBvZiB0aGUKICAgICAqIHNlcXVlbmNlIHRhYmxlLiBTZXF1ZW5jZSBudW1i\nZXJzIHdpbGwgYmUgZ3JhYmJlZCBpbiBibG9ja3Mgb2YgdGhpcwogICAgICog\ndmFsdWUgdG8gcmVkdWNlIHRoZSBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIHRo\nYXQgbXVzdCBiZSBwZXJmb3JtZWQgb24KICAgICAqIHRoZSBzZXF1ZW5jZSB0\nYWJsZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRBbGxvY2F0ZSgpIHsK\nICAgICAgICByZXR1cm4gX2FsbG9jOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRoZSBudW1iZXIgb2Ygc2VxdWVuY2VzIHRvIGFsbG9jYXRlIGZv\nciBlYWNoIHVwZGF0ZSBvZiB0aGUKICAgICAqIHNlcXVlbmNlIHRhYmxlLiBT\nZXF1ZW5jZSBudW1iZXJzIHdpbGwgYmUgZ3JhYmJlZCBpbiBibG9ja3Mgb2Yg\ndGhpcwogICAgICogdmFsdWUgdG8gcmVkdWNlIHRoZSBudW1iZXIgb2YgdHJh\nbnNhY3Rpb25zIHRoYXQgbXVzdCBiZSBwZXJmb3JtZWQgb24KICAgICAqIHRo\nZSBzZXF1ZW5jZSB0YWJsZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0\nQWxsb2NhdGUoaW50IGFsbG9jKSB7CiAgICAgICAgX2FsbG9jID0gYWxsb2M7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBudW1iZXIg\nYXMgdGhlIGluaXRpYWwgbnVtYmVyIGZvciB0aGUgCiAgICAgKiBHZW5lcmF0\nZWRWYWx1ZS5UQUJMRSBzdHJhdGVneSB0byBzdGFydCB3aXRoLiAKICAgICAq\nIEByZXR1cm4gYW4gaW5pdGlhbCBudW1iZXIKICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRJbml0aWFsVmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIF9pbnRW\nYWx1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgaW5pdGlhbCBu\ndW1iZXIgaW4gdGhlIHRhYmxlIGZvciB0aGUgR2VuZXJhdGVkVmFsdWUuVEFC\nTEUKICAgICAqIHN0cmF0ZWd5IHRvIHVzZSBhcyBpbml0aWFsIG51bWJlci4g\nCiAgICAgKiBAcGFyYW0gaW50VmFsdWUuIFRoZSBpbml0aWFsIG51bWJlcgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRJbml0aWFsVmFsdWUoaW50IGlu\ndFZhbHVlKSB7CiAgICAgICAgX2ludFZhbHVlID0gaW50VmFsdWU7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogU2V0cyB0aGUgbmFtZXMgb2YgdGhlIGNv\nbHVtbnMgb24gd2hpY2ggYSB1bmlxdWUgY29uc3RyYWludCBpcyBzZXQuCiAg\nICAgKiBAcGFyYW0gY29sdW1uc05hbWVzIGFyZSBwYXNzZWQgYXMgYSBzaW5n\nbGUgU3RyaW5nIGNvbmNhdGVuYXRlZCB3aXRoCiAgICAgKiBhICd8JyBjaGFy\nYWN0ZXIuIFRoaXMgbWV0aG9kIHBhcnNlcyBpdCBiYWNrIHRvIGFycmF5IG9m\nIFN0cmluZ3MuIAogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRVbmlxdWVD\nb2x1bW5zKFN0cmluZyBjb2x1bW5OYW1lcykgewogICAgCV91bmlxdWVDb2x1\nbW5OYW1lcyA9IChTdHJpbmdVdGlscy5pc0VtcHR5KGNvbHVtbk5hbWVzKSkg\nCiAgICAJCT8gbnVsbCA6IERCSWRlbnRpZmllci5zcGxpdChjb2x1bW5OYW1l\ncywgREJJZGVudGlmaWVyVHlwZS5DT0xVTU4sIElkZW50aWZpZXJVdGlsLkJB\nUik7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0VW5pcXVlQ29s\ndW1ucygpIHsKICAgIAlyZXR1cm4gTm9ybWFsaXplci5qb2luTmFtZXMoREJJ\nZGVudGlmaWVyLnRvU3RyaW5nQXJyYXkoX3VuaXF1ZUNvbHVtbk5hbWVzKSwg\nSWRlbnRpZmllclV0aWwuQkFSKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBk\nZXByZWNhdGVkIFVzZSB7QGxpbmsgI3NldEFsbG9jYXRlfS4gUmV0YWluZWQg\nZm9yIGJhY2t3YXJkcwogICAgICogY29tcGF0aWJpbGl0eSBvZiBhdXRvLWNv\nbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEluY3Jl\nbWVudChpbnQgaW5jKSB7CiAgICAgICAgc2V0QWxsb2NhdGUoaW5jKTsKICAg\nIH0KCiAgICBwdWJsaWMgSkRCQ0NvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJh\ndGlvbigpIHsKICAgICAgICByZXR1cm4gX2NvbmY7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc2V0Q29uZmlndXJhdGlvbihDb25maWd1cmF0aW9uIGNvbmYp\nIHsKICAgICAgICBfY29uZiA9IChKREJDQ29uZmlndXJhdGlvbikgY29uZjsK\nICAgICAgICBfbG9nID0gX2NvbmYuZ2V0TG9nKEpEQkNDb25maWd1cmF0aW9u\nLkxPR19SVU5USU1FKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydENv\nbmZpZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgZW5kQ29u\nZmlndXJhdGlvbigpIHsKICAgICAgICBidWlsZFRhYmxlKCk7CiAgICB9CiAg\nICAKCiAgICBwdWJsaWMgdm9pZCBhZGRTY2hlbWEoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIFNjaGVtYUdyb3VwIGdyb3VwKSB7CiAgICAgICAgLy8gU2luY2Ug\ndGhlIHRhYmxlIGlzIGNyZWF0ZWQgYnkgb3BlbmpwYSBpbnRlcm5hbGx5CiAg\nICAgICAgLy8gd2UgY2FuIGNyZWF0ZSB0aGUgdGFibGUgZm9yIGVhY2ggc2No\nZW1hIHdpdGhpbiB0aGUgUFUKICAgICAgICAvLyBpbiBoZXJlLgogICAgICAg\nIAogICAgICAgIFNjaGVtYVtdIHNjaGVtYXMgPSBncm91cC5nZXRTY2hlbWFz\nKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgIFF1YWxpZmllZERCSWRlbnRpZmllciBw\nYXRoID0gUXVhbGlmaWVkREJJZGVudGlmaWVyLmdldFBhdGgoX3RhYmxlKTsK\nICAgICAgICAgICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUgPSBwYXRoLmdl\ndFNjaGVtYU5hbWUoKTsKICAgICAgICAgICAgaWYgKERCSWRlbnRpZmllci5p\nc0VtcHR5KHNjaGVtYU5hbWUpKSB7CiAgICAgICAgICAgICAgICBzY2hlbWFO\nYW1lID0gU2NoZW1hcy5nZXROZXdUYWJsZVNjaGVtYUlkZW50aWZpZXIoX2Nv\nbmYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChEQklkZW50aWZp\nZXIuaXNOdWxsKHNjaGVtYU5hbWUpKSB7CiAgICAgICAgICAgICAgICBzY2hl\nbWFOYW1lID0gc2NoZW1hc1tpXS5nZXRJZGVudGlmaWVyKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGNyZWF0ZSB0YWJsZSBpbiB0aGlzIGdy\nb3VwCiAgICAgICAgICAgIFNjaGVtYSBzY2hlbWEgPSBncm91cC5nZXRTY2hl\nbWEoc2NoZW1hTmFtZSk7CiAgICAgICAgICAgIGlmIChzY2hlbWEgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgc2NoZW1hID0gZ3JvdXAuYWRkU2NoZW1h\nKHNjaGVtYU5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAg\nICAgICAgICBUYWJsZSBjb3B5ID0gc2NoZW1hLmltcG9ydFRhYmxlKF9wa0Nv\nbHVtbi5nZXRUYWJsZSgpKTsKICAgICAgICAgICAgLy8gaW1wb3J0VGFibGUo\nKSBkb2VzIG5vdCBpbXBvcnQgdW5pcXVlIGNvbnN0cmFpbnRzCiAgICAgICAg\nICAgIFVuaXF1ZVtdIHVuaXF1ZXMgPSBfcGtDb2x1bW4uZ2V0VGFibGUoKS5n\nZXRVbmlxdWVzKCk7CiAgICAgICAgICAgIGZvciAoVW5pcXVlIHUgOiB1bmlx\ndWVzKSB7CiAgICAgICAgICAgIAljb3B5LmltcG9ydFVuaXF1ZSh1KTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHJlc2V0IHRo\nZSB0YWJsZSBuYW1lIGluIHRoZSBjb2x1bW4gd2l0aCB0aGUKICAgICAgICAg\nICAgLy8gZnVsbHkgcXVhbGlmaWVkIG5hbWUgZm9yIG1hdGNoaW5nIHRoZSB0\nYWJsZSBuYW1lIGZyb20gdGhlCiAgICAgICAgICAgIC8vIENvbHVtbi4KICAg\nICAgICAgICAgX3BrQ29sdW1uLnJlc2V0VGFibGVJZGVudGlmaWVyKFF1YWxp\nZmllZERCSWRlbnRpZmllci5uZXdQYXRoKHNjaGVtYU5hbWUsIF9wa0NvbHVt\nbi5nZXRUYWJsZUlkZW50aWZpZXIoKSkpOwogICAgICAgICAgICAvLyBzb21l\nIGRhdGFiYXNlcyByZXF1aXJlIHRvIGNyZWF0ZSBhbiBpbmRleCBmb3IgdGhl\nIHNlcXVlbmNlIHRhYmxlCiAgICAgICAgICAgIF9jb25mLmdldERCRGljdGlv\nbmFyeUluc3RhbmNlKCkuY3JlYXRlSW5kZXhJZk5lY2Vzc2FyeShzY2hlbWEs\nCiAgICAgICAgICAgICAgICAgICAgX3RhYmxlLCBfcGtDb2x1bW4pOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgT2JqZWN0IG5leHRJbnRlcm5h\nbChKREJDU3RvcmUgc3RvcmUsIENsYXNzTWFwcGluZyBtYXBwaW5nKQogICAg\nICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIGlmIG5lZWRlZCwg\nZ3JhYiB0aGUgbmV4dCBoYW5kZnVsIG9mIGlkcwogICAgICAgIFN0YXR1cyBz\ndGF0ID0gZ2V0U3RhdHVzKG1hcHBpbmcpOwogICAgICAgIGlmIChzdGF0ID09\nIG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1zZXEtdHlwZSIsCiAgICAgICAgICAgICAg\nICBnZXRDbGFzcygpLCBtYXBwaW5nKSk7CgogICAgICAgIHdoaWxlICh0cnVl\nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3RhdCkgewogICAgICAg\nICAgICAgICAgLy8gbWFrZSBzdXJlIHNlcSBpcyBhdCBsZWFzdCAxLCBzaW5j\nZSBhdXRvYXNzaWduZWQgaWRzIG9mIDAgY2FuCiAgICAgICAgICAgICAgICAv\nLyBjb25mbGljdCB3aXRoIHVuaW5pdGlhbGl6ZWQgdmFsdWVzCiAgICAgICAg\nICAgICAgICBzdGF0LnNlcSA9IE1hdGgubWF4KHN0YXQuc2VxLCAxKTsKICAg\nICAgICAgICAgICAgIGlmIChzdGF0LnNlcSA8IHN0YXQubWF4KQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBzdGF0LnNlcSsrOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGFsbG9jYXRlU2VxdWVuY2Uoc3RvcmUsIG1hcHBpbmcs\nIHN0YXQsIF9hbGxvYywgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIHBy\nb3RlY3RlZCBPYmplY3QgY3VycmVudEludGVybmFsKEpEQkNTdG9yZSBzdG9y\nZSwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcpCiAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKGN1cnJlbnQgPT0gbnVsbCkgewogICAgICAg\nICAgICBDdXJyZW50U2VxdWVuY2VSdW5uYWJsZSBydW5uYWJsZSA9CiAgICAg\nICAgICAgICAgICBuZXcgQ3VycmVudFNlcXVlbmNlUnVubmFibGUoc3RvcmUs\nIG1hcHBpbmcpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\naWYgKHN1c3BlbmRJbkpUQSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g\nTm90U3VwcG9ydGVkRXhjZXB0aW9uIGlzIHdyYXBwZWQgaW4gYSBTdG9yZUV4\nY2VwdGlvbiBieQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBjYWxsZXIu\nCiAgICAgICAgICAgICAgICAgICAgX2NvbmYuZ2V0TWFuYWdlZFJ1bnRpbWVJ\nbnN0YW5jZSgpLmRvTm9uVHJhbnNhY3Rpb25hbFdvcmsoCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBydW5uYWJsZSk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJ1bm5hYmxlLnJ1bigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAoRXhjZXB0\naW9uKSAocmUuZ2V0Q2F1c2UoKSA9PSBudWxsID8gcmUgOiByZS5nZXRDYXVz\nZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nc3VwZXIuY3VycmVudEludGVybmFsKHN0b3JlLCBtYXBwaW5nKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgdm9pZCBhbGxvY2F0ZUludGVybmFsKGludCBjb3Vu\ndCwgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBw\naW5nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0\nYXR1cyBzdGF0ID0gZ2V0U3RhdHVzKG1hcHBpbmcpOwogICAgICAgIGlmIChz\ndGF0ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgd2hp\nbGUgKHRydWUpIHsKICAgICAgICAgICAgaW50IGF2YWlsYWJsZTsKICAgICAg\nICAgICAgc3luY2hyb25pemVkIChzdGF0KSB7CiAgICAgICAgICAgICAgICBh\ndmFpbGFibGUgPSAoaW50KSAoc3RhdC5tYXggLSBzdGF0LnNlcSk7CiAgICAg\nICAgICAgICAgICBpZiAoYXZhaWxhYmxlID49IGNvdW50KQogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBh\nbGxvY2F0ZVNlcXVlbmNlKHN0b3JlLCBtYXBwaW5nLCBzdGF0LCBjb3VudCAt\nIGF2YWlsYWJsZSwgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgYXBwcm9wcmlhdGUgc3RhdHVzIG9iamVjdCBm\nb3IgdGhlIGdpdmVuIGNsYXNzLCBvciBudWxsCiAgICAgKiBpZiBjYW5ub3Qg\naGFuZGxlIHRoZSBnaXZlbiBjbGFzcy4gVGhlIG1hcHBpbmcgbWF5IGJlIG51\nbGwuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0dXMgZ2V0U3RhdHVzKENs\nYXNzTWFwcGluZyBtYXBwaW5nKSB7ICAKICAgICAgICBTdGF0dXMgc3RhdHVz\nID0gKFN0YXR1cylfc3RhdC5nZXQobWFwcGluZyk7ICAgICAgICAKICAgICAg\nICBpZiAoc3RhdHVzID09IG51bGwpeyAKICAgICAgICAgICAgc3RhdHVzID0g\nbmV3IFN0YXR1cygpOwogICAgICAgICAgICBfc3RhdC5wdXQobWFwcGluZywg\nc3RhdHVzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0YXR1czsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgcHJpbWFyeSBrZXkgY29sdW1u\nIHRvIHRoZSBnaXZlbiB0YWJsZSBhbmQgcmV0dXJuIGl0LgogICAgICovCiAg\nICBwcm90ZWN0ZWQgQ29sdW1uIGFkZFByaW1hcnlLZXlDb2x1bW4oVGFibGUg\ndGFibGUpIHsKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25mLmdl\ndERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgQ29sdW1uIHBrQ29s\ndW1uID0gdGFibGUuYWRkQ29sdW1uKGRpY3QuZ2V0VmFsaWRDb2x1bW5OYW1l\nCiAgICAgICAgICAgIChnZXRQcmltYXJ5S2V5Q29sdW1uSWRlbnRpZmllcigp\nLCB0YWJsZSkpOwogICAgICAgIHBrQ29sdW1uLnNldFR5cGUoZGljdC5nZXRQ\ncmVmZXJyZWRUeXBlKFR5cGVzLlRJTllJTlQpKTsKICAgICAgICBwa0NvbHVt\nbi5zZXRKYXZhVHlwZShKYXZhVHlwZXMuSU5UKTsKICAgICAgICByZXR1cm4g\ncGtDb2x1bW47CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBy\naW1hcnkga2V5IHZhbHVlIGZvciB0aGUgc2VxdWVuY2UgdGFibGUgZm9yIHRo\nZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIE9iamVjdCBn\nZXRQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBwaW5nKSB7CiAgICAgICAg\ncmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBv\nYmplY3QtbGV2ZWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIHNlcXVlbmNlIHRh\nYmxlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYnVpbGRUYWJsZSgpIHsK\nICAgICAgICBEQklkZW50aWZpZXIgdGFibGVOYW1lID0gREJJZGVudGlmaWVy\nLk5VTEw7CiAgICAgICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUgPSBEQklk\nZW50aWZpZXIuTlVMTDsKICAgICAgICBRdWFsaWZpZWREQklkZW50aWZpZXIg\ncGF0aCA9IFF1YWxpZmllZERCSWRlbnRpZmllci5nZXRQYXRoKF90YWJsZSk7\nCiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNFbXB0eShwYXRoLmdldFNj\naGVtYU5hbWUoKSkpIHsKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IHBhdGgu\nZ2V0U2NoZW1hTmFtZSgpOwogICAgICAgICAgICB0YWJsZU5hbWUgPSBwYXRo\nLmdldFVucXVhbGlmaWVkTmFtZSgpOwogICAgICAgIH0KICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgdGFibGVOYW1lID0gX3RhYmxlOwogICAgICAgIH0K\nICAgICAgICAKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzRW1wdHkoc2No\nZW1hTmFtZSkpIHsKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IFNjaGVtYXMu\nZ2V0TmV3VGFibGVTY2hlbWFJZGVudGlmaWVyKF9jb25mKTsKICAgICAgICB9\nCgogICAgICAgIFNjaGVtYUdyb3VwIGdyb3VwID0gbmV3IFNjaGVtYUdyb3Vw\nKCk7CiAgICAgICAgU2NoZW1hIHNjaGVtYSA9IGdyb3VwLmFkZFNjaGVtYShz\nY2hlbWFOYW1lKTsKCiAgICAgICAgVGFibGUgdGFibGUgPSBzY2hlbWEuYWRk\nVGFibGUodGFibGVOYW1lKTsKICAgICAgICBfcGtDb2x1bW4gPSBhZGRQcmlt\nYXJ5S2V5Q29sdW1uKHRhYmxlKTsKICAgICAgICBQcmltYXJ5S2V5IHBrID0g\ndGFibGUuYWRkUHJpbWFyeUtleSgpOwogICAgICAgIHBrLmFkZENvbHVtbihf\ncGtDb2x1bW4pOwoKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25m\nLmdldERCRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgX3NlcUNvbHVt\nbiA9IHRhYmxlLmFkZENvbHVtbihkaWN0LmdldFZhbGlkQ29sdW1uTmFtZQog\nICAgICAgICAgICAoX3NlcUNvbHVtbk5hbWUsIHRhYmxlKSk7CiAgICAgICAg\nX3NlcUNvbHVtbi5zZXRUeXBlKGRpY3QuZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5CSUdJTlQpKTsKICAgICAgICBfc2VxQ29sdW1uLnNldEphdmFUeXBlKEph\ndmFUeXBlcy5MT05HKTsKICAgICAgICAKICAgICAgICBpZiAoX3VuaXF1ZUNv\nbHVtbk5hbWVzICE9IG51bGwpIHsKICAgICAgICAgICAgREJJZGVudGlmaWVy\nIHVuaXF1ZU5hbWUgPSBfdW5pcXVlQ29uc3RyYWludE5hbWU7CiAgICAgICAg\nICAgIGlmIChEQklkZW50aWZpZXIuaXNFbXB0eSh1bmlxdWVOYW1lKSkgewog\nICAgICAgICAgICAgICAgdW5pcXVlTmFtZSA9IGRpY3QuZ2V0VmFsaWRVbmlx\ndWVOYW1lKERCSWRlbnRpZmllci5uZXdDb25zdHJhaW50KCJVTlEiKSwgdGFi\nbGUpOwogICAgICAgICAgICB9CiAgICAJCVVuaXF1ZSB1ID0gdGFibGUuYWRk\nVW5pcXVlKHVuaXF1ZU5hbWUpOwogICAgCQlmb3IgKERCSWRlbnRpZmllciBj\nb2x1bW5OYW1lIDogX3VuaXF1ZUNvbHVtbk5hbWVzKSB7CiAgICAJCQlpZiAo\nIXRhYmxlLmNvbnRhaW5zQ29sdW1uKGNvbHVtbk5hbWUsIF9jb25mLmdldERC\nRGljdGlvbmFyeUluc3RhbmNlKCkpKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bmlxdWUtbWlzc2lu\nZy1jb2x1bW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1u\nTmFtZSwgdGFibGUuZ2V0SWRlbnRpZmllcigpLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdGFibGUuZ2V0Q29sdW1uTmFtZXMoKSkpOwogICAgCQkJ\nQ29sdW1uIGNvbCA9IHRhYmxlLmdldENvbHVtbihjb2x1bW5OYW1lKTsKICAg\nIAkJCXUuYWRkQ29sdW1uKGNvbCk7CiAgICAJCX0KICAgICAgICB9CiAgICAg\nICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBtYXggYXZh\naWxhYmxlIHNlcXVlbmNlIHZhbHVlLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWxsb2NhdGVTZXF1ZW5jZShKREJDU3RvcmUgc3RvcmUsIENsYXNzTWFw\ncGluZyBtYXBwaW5nLAogICAgICAgICAgICBTdGF0dXMgc3RhdCwgaW50IGFs\nbG9jLCBib29sZWFuIHVwZGF0ZVN0YXRTZXEpIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIFJ1bm5hYmxlIHJ1bm5hYmxlID0KICAgICAgICAgICAg\nbmV3IEFsbG9jYXRlU2VxdWVuY2VSdW5uYWJsZSgKICAgICAgICAgICAgICAg\nICAgICBzdG9yZSwgbWFwcGluZywgc3RhdCwgYWxsb2MsIHVwZGF0ZVN0YXRT\nZXEpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzdXNwZW5kSW5K\nVEEoKSkgewogICAgICAgICAgICAgICAgLy8gTm90U3VwcG9ydGVkRXhjZXB0\naW9uIGlzIHdyYXBwZWQgaW4gYSBTdG9yZUV4Y2VwdGlvbiBieQogICAgICAg\nICAgICAgICAgLy8gdGhlIGNhbGxlci4KICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBfY29uZi5nZXRNYW5hZ2VkUnVudGltZUluc3Rh\nbmNlKCkuZG9Ob25UcmFuc2FjdGlvbmFsV29yaygKICAgICAgICAgICAgICAg\nICAgICAgICAgcnVubmFibGUpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgY2F0Y2goTm90U3VwcG9ydGVkRXhjZXB0aW9uIG5zZSkgeyAK\nICAgICAgICAgICAgICAgICAgICBTUUxFeGNlcHRpb24gc3FsRXggPSBuZXcg\nU1FMRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnNl\nLmdldExvY2FsaXplZE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAg\nc3FsRXguaW5pdENhdXNlKG5zZSk7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgc3FsRXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBydW5uYWJsZS5ydW4oKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgVGhyb3dhYmxlIGUgPSByZS5nZXRDYXVzZSgpOwogICAg\nICAgICAgICBpZihlIGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uICkgCiAgICAg\nICAgICAgICAgICB0aHJvdyAoU1FMRXhjZXB0aW9uKSBlOwogICAgICAgICAg\nICBlbHNlIAogICAgICAgICAgICAgICAgdGhyb3cgcmU7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0cyB0aGUgaW5pdGlhbCBzZXF1\nZW5jZSBjb2x1bW4gaW50byB0aGUgZGF0YWJhc2UuCiAgICAgKiAKICAgICAq\nIEBwYXJhbSBtYXBwaW5nCiAgICAgKiAgICAgICAgICAgIENsYXNzTWFwcGlu\nZyBmb3IgdGhlIGNsYXNzIHdob3NlIHNlcXVlbmNlIGNvbHVtbiB3aWxsIGJl\nCiAgICAgKiAgICAgICAgICAgIHVwZGF0ZWQKICAgICAqIEBwYXJhbSBjb25u\nCiAgICAgKiAgICAgICAgICAgIENvbm5lY3Rpb24gdXNlZCBpc3N1ZSBTUUwg\nc3RhdGVtZW50cy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGluc2VydFNl\ncXVlbmNlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy50cmFjZShf\nbG9jLmdldCgiaW5zZXJ0LXNlcSIpKTsKCiAgICAgICAgT2JqZWN0IHBrID0g\nZ2V0UHJpbWFyeUtleShtYXBwaW5nKTsKICAgICAgICBpZiAocGsgPT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlv\nbihfbG9jLmdldCgiYmFkLXNlcS10eXBlIiwKICAgICAgICAgICAgICAgIGdl\ndENsYXNzKCksIG1hcHBpbmcpKTsKCiAgICAgICAgREJEaWN0aW9uYXJ5IGRp\nY3QgPSBfY29uZi5nZXREQkRpY3Rpb25hcnlJbnN0YW5jZSgpOwogICAgICAg\nIERCSWRlbnRpZmllciB0YWJsZU5hbWUgPSByZXNvbHZlVGFibGVJZGVudGlm\naWVyKG1hcHBpbmcsIF9wa0NvbHVtbi5nZXRUYWJsZSgpKTsKICAgICAgICBT\nUUxCdWZmZXIgaW5zZXJ0ID0gbmV3IFNRTEJ1ZmZlcihkaWN0KS5hcHBlbmQo\nIklOU0VSVCBJTlRPICIpLgogICAgICAgICAgICBhcHBlbmQodGFibGVOYW1l\nKS5hcHBlbmQoIiAoIikuCiAgICAgICAgICAgIGFwcGVuZChfcGtDb2x1bW4p\nLmFwcGVuZCgiLCAiKS5hcHBlbmQoX3NlcUNvbHVtbikuCiAgICAgICAgICAg\nIGFwcGVuZCgiKSBWQUxVRVMgKCIpLgogICAgICAgICAgICBhcHBlbmRWYWx1\nZShwaywgX3BrQ29sdW1uKS5hcHBlbmQoIiwgIikuCiAgICAgICAgICAgIGFw\ncGVuZFZhbHVlKF9pbnRWYWx1ZSwgX3NlcUNvbHVtbikuYXBwZW5kKCIpIik7\nCiAgICAgICAgCiAgICAgICAgYm9vbGVhbiB3YXNBdXRvID0gY29ubi5nZXRB\ndXRvQ29tbWl0KCk7CiAgICAgICAgaWYgKCF3YXNBdXRvICYmICFzdXNwZW5k\nSW5KVEEoKSkKICAgICAgICAgICAgY29ubi5zZXRBdXRvQ29tbWl0KHRydWUp\nOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RtbnQgPSBwcmVwYXJlU3RhdGVt\nZW50KGNvbm4sIGluc2VydCk7CiAgICAgICAgICAgIGRpY3Quc2V0VGltZW91\ndHMoc3RtbnQsIF9jb25mLCB0cnVlKTsKICAgICAgICAgICAgZXhlY3V0ZVVw\nZGF0ZShfY29uZiwgY29ubiwgc3RtbnQsIGluc2VydCwgUm93SW1wbC5BQ1RJ\nT05fSU5TRVJUKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50\nLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAgICAg\nICAgICAgaWYgKCF3YXNBdXRvICYmICFzdXNwZW5kSW5KVEEoKSkKICAgICAg\nICAgICAgICAgIGNvbm4uc2V0QXV0b0NvbW1pdChmYWxzZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHNlcXVl\nbmNlIHZhbHVlLgogICAgICogCiAgICAgKiBAcGFyYW0gbWFwcGluZwogICAg\nICogICAgICAgICAgICBDbGFzc01hcHBpbmcgb2YgdGhlIGVudGl0eSB3aG9z\nZSBzZXF1ZW5jZSB2YWx1ZSB3aWxsIGJlCiAgICAgKiAgICAgICAgICAgIG9i\ndGFpbmVkLgogICAgICogQHBhcmFtIGNvbm4KICAgICAqICAgICAgICAgICAg\nQ29ubmVjdGlvbiB1c2VkIGlzc3VlIFNRTCBzdGF0ZW1lbnRzLgogICAgICog\nCiAgICAgKiBAcmV0dXJuIFRoZSBjdXJyZW50IHNlcXVlbmNlIHZhbHVlLCBv\nciA8Y29kZT5TRVFVRU5DRV9OT1RfRk9VTkQ8L2NvZGU+CiAgICAgKiAgICAg\nICAgIGlmIHRoZSBzZXF1ZW5jZSBjb3VsZCBub3QgYmUgZm91bmQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBsb25nIGdldFNlcXVlbmNlKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZ2V0LXNlcSIp\nKTsKCiAgICAgICAgT2JqZWN0IHBrID0gZ2V0UHJpbWFyeUtleShtYXBwaW5n\nKTsKICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIC0xOwoKICAgICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25mLmdldERC\nRGljdGlvbmFyeUluc3RhbmNlKCk7CiAgICAgICAgU1FMQnVmZmVyIHNlbCA9\nIG5ldyBTUUxCdWZmZXIoZGljdCkuYXBwZW5kKF9zZXFDb2x1bW4pOwogICAg\nICAgIFNRTEJ1ZmZlciB3aGVyZSA9IG5ldyBTUUxCdWZmZXIoZGljdCkuYXBw\nZW5kKF9wa0NvbHVtbikuYXBwZW5kKCIgPSAiKS4KICAgICAgICAgICAgYXBw\nZW5kVmFsdWUocGssIF9wa0NvbHVtbik7CiAgICAgICAgREJJZGVudGlmaWVy\nIHRhYmxlTmFtZSA9IHJlc29sdmVUYWJsZUlkZW50aWZpZXIobWFwcGluZywg\nX3NlcUNvbHVtbi5nZXRUYWJsZSgpKTsKICAgICAgICBTUUxCdWZmZXIgdGFi\nbGVzID0gbmV3IFNRTEJ1ZmZlcihkaWN0KS5hcHBlbmQodGFibGVOYW1lKTsK\nCiAgICAgICAgU1FMQnVmZmVyIHNlbGVjdCA9IGRpY3QudG9TZWxlY3Qoc2Vs\nLCBudWxsLCB0YWJsZXMsIHdoZXJlLCBudWxsLCBudWxsLAogICAgICAgICAg\nICAgICAgbnVsbCwgZmFsc2UsIGRpY3Quc3VwcG9ydHNTZWxlY3RGb3JVcGRh\ndGUsIDAsIExvbmcuTUFYX1ZBTFVFLAogICAgICAgICAgICAgICAgZmFsc2Us\nIHRydWUpOwoKICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51\nbGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwg\nc2VsZWN0KTsKICAgICAgICAgICAgZGljdC5zZXRUaW1lb3V0cyhzdG1udCwg\nX2NvbmYsIGZhbHNlKTsKICAgICAgICAgICAgcnMgPSBleGVjdXRlUXVlcnko\nX2NvbmYsIGNvbm4sIHN0bW50LCBzZWxlY3QpOwogICAgICAgICAgICByZXR1\ncm4gZ2V0U2VxdWVuY2UocnMsIGRpY3QpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nfQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkgICAgCiAgICAgICAg\nICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNl\ncHRpb24gc2UpIHt9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nR3JhYnMgdGhlIG5leHQgaGFuZGZ1bCBvZiBzZXF1ZW5jZSBudW1iZXJzLgog\nICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgc2VxdWVuY2Ugd2Fz\nIHVwZGF0ZWQsIGZhbHNlIGlmIG5vIHNlcXVlbmNlCiAgICAgKiByb3cgZXhp\nc3RlZCBmb3IgdGhpcyBtYXBwaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIHNldFNlcXVlbmNlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBTdGF0\ndXMgc3RhdCwgaW50IGluYywKICAgICAgICBib29sZWFuIHVwZGF0ZVN0YXRT\nZXEsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJ1cGRhdGUtc2VxIikpOwoK\nICAgICAgICBPYmplY3QgcGsgPSBnZXRQcmltYXJ5S2V5KG1hcHBpbmcpOwog\nICAgICAgIGlmIChwayA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtc2VxLXR5cGUi\nLAogICAgICAgICAgICAgICAgZ2V0Q2xhc3MoKSwgbWFwcGluZykpOwoKICAg\nICAgICBEQkRpY3Rpb25hcnkgZGljdCA9IF9jb25mLmdldERCRGljdGlvbmFy\neUluc3RhbmNlKCk7ICAgICAgICAKICAgICAgICBTUUxCdWZmZXIgd2hlcmUg\nPSBuZXcgU1FMQnVmZmVyKGRpY3QpLmFwcGVuZChfcGtDb2x1bW4pLmFwcGVu\nZCgiID0gIikuCiAgICAgICAgICAgIGFwcGVuZFZhbHVlKHBrLCBfcGtDb2x1\nbW4pOwoKICAgICAgICAvLyBsb29wIHVudGlsIHdlIGhhdmUgYSBzdWNjZXNz\nZnVsIGF0b21pYyBzZWxlY3QvdXBkYXRlIHNlcXVlbmNlCiAgICAgICAgbG9u\nZyBjdXIgPSAwOwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50Owog\nICAgICAgIFJlc3VsdFNldCByczsKICAgICAgICBTUUxCdWZmZXIgdXBkOwog\nICAgICAgIGZvciAoaW50IHVwZGF0ZXMgPSAwOyB1cGRhdGVzID09IDA7KSB7\nCiAgICAgICAgICAgIHN0bW50ID0gbnVsbDsKICAgICAgICAgICAgcnMgPSBu\ndWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY3VyID0g\nZ2V0U2VxdWVuY2UobWFwcGluZywgY29ubik7CiAgICAgICAgICAgICAgICBp\nZiAoY3VyID09IC0xKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdGhlIHZhbHVlCiAgICAg\nICAgICAgICAgICB1cGQgPSBuZXcgU1FMQnVmZmVyKGRpY3QpOwogICAgICAg\nICAgICAgICAgREJJZGVudGlmaWVyIHRhYmxlTmFtZSA9IHJlc29sdmVUYWJs\nZUlkZW50aWZpZXIobWFwcGluZywKICAgICAgICAgICAgICAgICAgICAgICAg\nX3NlcUNvbHVtbi5nZXRUYWJsZSgpKTsKICAgICAgICAgICAgICAgIHVwZC5h\ncHBlbmQoIlVQREFURSAiKS5hcHBlbmQodGFibGVOYW1lKS4KICAgICAgICAg\nICAgICAgICAgICBhcHBlbmQoIiBTRVQgIikuYXBwZW5kKF9zZXFDb2x1bW4p\nLmFwcGVuZCgiID0gIikuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kVmFs\ndWUoY3VyICsgaW5jLCBfc2VxQ29sdW1uKS4KICAgICAgICAgICAgICAgICAg\nICBhcHBlbmQoIiBXSEVSRSAiKS5hcHBlbmQod2hlcmUpLmFwcGVuZCgiIEFO\nRCAiKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmQoX3NlcUNvbHVtbiku\nYXBwZW5kKCIgPSAiKS4KICAgICAgICAgICAgICAgICAgICBhcHBlbmRWYWx1\nZShjdXIsIF9zZXFDb2x1bW4pOwoKICAgICAgICAgICAgICAgIHN0bW50ID0g\ncHJlcGFyZVN0YXRlbWVudChjb25uLCB1cGQpOwogICAgICAgICAgICAgICAg\nZGljdC5zZXRUaW1lb3V0cyhzdG1udCwgX2NvbmYsIHRydWUpOwogICAgICAg\nICAgICAgICAgdXBkYXRlcyA9IGV4ZWN1dGVVcGRhdGUoX2NvbmYsIGNvbm4s\nIHN0bW50LCB1cGQsCiAgICAgICAgICAgICAgICAgICAgICAgIFJvd0ltcGwu\nQUNUSU9OX1VQREFURSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICBpZiAocnMgIT0gbnVsbCkgCiAgICAgICAgICAgICAgICAg\nICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNl\nKSB7fQogICAgICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UoKTsgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBzZXR1cCBuZXcgc2VxdWVuY2UgcmFuZ2UgICAgICAgIAog\nICAgICAgIHN5bmNocm9uaXplZCAoc3RhdCkgewogICAgICAgICAgICBpZiAo\ndXBkYXRlU3RhdFNlcSAmJiBzdGF0LnNlcSA8IGN1cikKICAgICAgICAgICAg\nICAgIHN0YXQuc2VxID0gY3VyOwogICAgICAgICAgICBpZiAoc3RhdC5tYXgg\nPCBjdXIgKyBpbmMpCiAgICAgICAgICAgICAgICBzdGF0Lm1heCA9IGN1ciAr\nIGluYzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAg\nICAvKioKICAgICAqIFJlc29sdmUgYSBmdWxseSBxdWFsaWZpZWQgdGFibGUg\nbmFtZQogICAgICogCiAgICAgKiBAcGFyYW0gY2xhc3MKICAgICAqICAgICAg\nICAgICAgbWFwcGluZyB0byBnZXQgdGhlIHNjaGVtYSBuYW1lCiAgICAgKiBA\nZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIHJlc29sdmVU\nYWJsZU5hbWUoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIFRhYmxlIHRhYmxlKSB7\nCiAgICAgICAgcmV0dXJuIHJlc29sdmVUYWJsZUlkZW50aWZpZXIobWFwcGlu\nZywgdGFibGUpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nc29sdmUgYSBmdWxseSBxdWFsaWZpZWQgdGFibGUgbmFtZQogICAgICogCiAg\nICAgKiBAcGFyYW0gY2xhc3MKICAgICAqICAgICAgICAgICAgbWFwcGluZyB0\nbyBnZXQgdGhlIHNjaGVtYSBuYW1lCiAgICAgKi8KICAgIHB1YmxpYyBEQklk\nZW50aWZpZXIgcmVzb2x2ZVRhYmxlSWRlbnRpZmllcihDbGFzc01hcHBpbmcg\nbWFwcGluZywgVGFibGUgdGFibGUpIHsKICAgICAgICBEQklkZW50aWZpZXIg\nc05hbWUgPSBtYXBwaW5nLmdldFRhYmxlKCkuZ2V0U2NoZW1hSWRlbnRpZmll\ncigpOwogICAgICAgIERCSWRlbnRpZmllciB0YWJsZU5hbWUgPSBEQklkZW50\naWZpZXIuTlVMTDsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlzTnVsbChz\nTmFtZSkpIHsKICAgICAgICAgICAgdGFibGVOYW1lID0gdGFibGUuZ2V0RnVs\nbElkZW50aWZpZXIoKTsKICAgICAgICB9IGVsc2UgaWYgKCFEQklkZW50aWZp\nZXIuaXNOdWxsKHRhYmxlLmdldFNjaGVtYUlkZW50aWZpZXIoKSkpIHsKICAg\nICAgICAgICAgdGFibGVOYW1lID0gdGFibGUuZ2V0RnVsbElkZW50aWZpZXIo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YWJsZU5hbWUgPSBR\ndWFsaWZpZWREQklkZW50aWZpZXIubmV3UGF0aChzTmFtZSwgdGFibGUuZ2V0\nSWRlbnRpZmllcigpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhYmxl\nTmFtZTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUg\nc2VxdWVuY2UgdGFibGUgaW4gdGhlIERCLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCByZWZyZXNoVGFibGUoKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAg\nICAgICAgX2xvZy5pbmZvKF9sb2MuZ2V0KCJtYWtlLXNlcS10YWJsZSIpKTsK\nCiAgICAgICAgLy8gY3JlYXRlIHRoZSB0YWJsZQogICAgICAgIFNjaGVtYVRv\nb2wgdG9vbCA9IG5ldyBTY2hlbWFUb29sKF9jb25mKTsKICAgICAgICB0b29s\nLnNldElnbm9yZUVycm9ycyh0cnVlKTsKICAgICAgICB0b29sLmNyZWF0ZVRh\nYmxlKF9wa0NvbHVtbi5nZXRUYWJsZSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIERyb3BzIHRoZSBzZXF1ZW5jZSB0YWJsZSBpbiB0aGUgREIuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGRyb3BUYWJsZSgpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKF9sb2cuaXNJbmZvRW5hYmxl\nZCgpKQogICAgICAgICAgICBfbG9nLmluZm8oX2xvYy5nZXQoImRyb3Atc2Vx\nLXRhYmxlIikpOwoKICAgICAgICAvLyBkcm9wIHRoZSB0YWJsZQogICAgICAg\nIFNjaGVtYVRvb2wgdG9vbCA9IG5ldyBTY2hlbWFUb29sKF9jb25mKTsKICAg\nICAgICB0b29sLnNldElnbm9yZUVycm9ycyh0cnVlKTsKICAgICAgICB0b29s\nLmRyb3BUYWJsZShfcGtDb2x1bW4uZ2V0VGFibGUoKSk7CiAgICB9CgogICAg\nLy8vLy8vLy8vCiAgICAvLyBNYWluCiAgICAvLy8vLy8vLy8KCiAgICAvKioK\nICAgICAqIFVzYWdlOiBqYXZhIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5UYWJsZUpEQkNTZXF1ZW5jZSBbb3B0aW9uXSoKICAgICAqIC1hY3Rp\nb24vLWEgJmx0O2FkZCB8IGRyb3AgfCBnZXQgfCBzZXQmZ3Q7IFt2YWx1ZV0K\nICAgICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJlY29n\nbml6ZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3BlcnRpZXMv\nLXAgJmx0O3Byb3BlcnRpZXMgZmlsZSBvciByZXNvdXJjZSZndDs8L2k+OiBU\naGUKICAgICAqIHBhdGggb3IgcmVzb3VyY2UgbmFtZSBvZiBhIE9wZW5KUEEg\ncHJvcGVydGllcyBmaWxlIGNvbnRhaW5pbmcKICAgICAqIGluZm9ybWF0aW9u\nIHN1Y2ggYXMgdGhlIGxpY2Vuc2Uga2V5CWFuZCBjb25uZWN0aW9uIGRhdGEg\nYXMKICAgICAqIG91dGxpbmVkIGluIHtAbGluayBKREJDQ29uZmlndXJhdGlv\nbn0uIE9wdGlvbmFsLjwvbGk+CiAgICAgKiA8bGk+PGk+LSZsdDtwcm9wZXJ0\neSBuYW1lJmd0OyAmbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7PC9pPjogQWxsIGJl\nYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIE9wZW5KUEEge0BsaW5rIEpE\nQkNDb25maWd1cmF0aW9ufSBjYW4gYmUgc2V0IGJ5CiAgICAgKiB1c2luZyB0\naGVpcgluYW1lcyBhbmQgc3VwcGx5aW5nIGEgdmFsdWUuIEZvciBleGFtcGxl\nOgogICAgICogPGNvZGU+LWxpY2Vuc2VLZXkgYWRzbGZqYTgzcjNsa2FkZjwv\nY29kZT48L2xpPgogICAgICogPC91bD4KICAgICAqICBUaGUgdmFyaW91cyBh\nY3Rpb25zIGFyZSBhcyBmb2xsb3dzLgogICAgICogPHVsPgogICAgICogPGxp\nPjxpPmFkZDwvaT46IENyZWF0ZSB0aGUgc2VxdWVuY2UgdGFibGUuPC9saT4K\nICAgICAqIDxsaT48aT5kcm9wPC9pPjogRHJvcCB0aGUgc2VxdWVuY2UgdGFi\nbGUuPC9saT4KICAgICAqIDxsaT48aT5nZXQ8L2k+OiBQcmludCB0aGUgY3Vy\ncmVudCBzZXF1ZW5jZSB2YWx1ZS48L2xpPgogICAgICogPGxpPjxpPnNldDwv\naT46IFNldCB0aGUgc2VxdWVuY2UgdmFsdWUuPC9saT4KICAgICAqIDwvdWw+\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1td\nIGFyZ3MpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgT3B0\naW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBmaW5hbCBTdHJp\nbmdbXSBhcmd1bWVudHMgPSBvcHRzLnNldEZyb21DbWRMaW5lKGFyZ3MpOwog\nICAgICAgIGJvb2xlYW4gcmV0ID0gQ29uZmlndXJhdGlvbnMucnVuQWdhaW5z\ndEFsbEFuY2hvcnMob3B0cywKICAgICAgICAgICAgbmV3IENvbmZpZ3VyYXRp\nb25zLlJ1bm5hYmxlKCkgewogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBy\ndW4oT3B0aW9ucyBvcHRzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIEpEQkNDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgSkRCQ0NvbmZp\nZ3VyYXRpb25JbXBsKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBUYWJsZUpEQkNTZXEucnVuKGNvbmYsIGFy\nZ3VtZW50cywgb3B0cyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICgh\ncmV0KQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oX2xvYy5nZXQo\nInNlcS11c2FnZSIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biB0aGUg\ndG9vbC4gUmV0dXJucyBmYWxzZSBpZiBpbnZhbGlkIG9wdGlvbnMgd2VyZSBn\naXZlbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihK\nREJDQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAgICAg\nIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBTdHJpbmcgYWN0aW9uID0gb3B0cy5yZW1vdmVQcm9wZXJ0eSgiYWN0\naW9uIiwgImEiLCBudWxsKTsKICAgICAgICBDb25maWd1cmF0aW9ucy5wb3B1\nbGF0ZUNvbmZpZ3VyYXRpb24oY29uZiwgb3B0cyk7CiAgICAgICAgcmV0dXJu\nIHJ1bihjb25mLCBhcmdzLCBhY3Rpb24pOwogICAgfQoKICAgIC8qKgogICAg\nICogUnVuIHRoZSB0b29sLiBSZXR1cm4gZmFsc2UgaWYgYW4gaW52YWxpZCBv\ncHRpb24gd2FzIGdpdmVuLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJv\nb2xlYW4gcnVuKEpEQkNDb25maWd1cmF0aW9uIGNvbmYsIFN0cmluZ1tdIGFy\nZ3MsCiAgICAgICAgU3RyaW5nIGFjdGlvbikKICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxIHx8IChhcmdz\nLmxlbmd0aCAhPSAwCiAgICAgICAgICAgICYmICFBQ1RJT05fU0VULmVxdWFs\ncyhhY3Rpb24pKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAg\nICBUYWJsZUpEQkNTZXEgc2VxID0gbmV3IFRhYmxlSkRCQ1NlcSgpOwogICAg\nICAgIFN0cmluZyBwcm9wcyA9IENvbmZpZ3VyYXRpb25zLmdldFByb3BlcnRp\nZXMoY29uZi5nZXRTZXF1ZW5jZSgpKTsKICAgICAgICBDb25maWd1cmF0aW9u\ncy5jb25maWd1cmVJbnN0YW5jZShzZXEsIGNvbmYsIHByb3BzKTsKCiAgICAg\nICAgaWYgKEFDVElPTl9EUk9QLmVxdWFscyhhY3Rpb24pKQogICAgICAgICAg\nICBzZXEuZHJvcFRhYmxlKCk7CiAgICAgICAgZWxzZSBpZiAoQUNUSU9OX0FE\nRC5lcXVhbHMoYWN0aW9uKSkKICAgICAgICAgICAgc2VxLnJlZnJlc2hUYWJs\nZSgpOwogICAgICAgIGVsc2UgaWYgKEFDVElPTl9HRVQuZXF1YWxzKGFjdGlv\nbikgfHwgQUNUSU9OX1NFVC5lcXVhbHMoYWN0aW9uKSkgewogICAgICAgICAg\nICBDb25uZWN0aW9uIGNvbm4gPSBjb25mLmdldERhdGFTb3VyY2UyKG51bGwp\nLmdldENvbm5lY3Rpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGxvbmcgY3VyID0gc2VxLmdldFNlcXVlbmNlKG51bGwsIGNvbm4p\nOwogICAgICAgICAgICAgICAgaWYgKEFDVElPTl9HRVQuZXF1YWxzKGFjdGlv\nbikpCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKGN1\ncik7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICBsb25nIHNldDsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPiAwKQogICAgICAgICAgICAgICAgICAgICAgICBzZXQgPSBMb25nLnBh\ncnNlTG9uZyhhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNldCA9IGN1ciArIHNlcS5nZXRBbGxv\nY2F0ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZXQgPCBjdXIpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHNldCA9IGN1cjsKICAgICAgICAgICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RhdHVz\nIHN0YXQgPSBzZXEuZ2V0U3RhdHVzKG51bGwpOwogICAgICAgICAgICAgICAg\nICAgICAgICBzZXEuc2V0U2VxdWVuY2UobnVsbCwgc3RhdCwgKGludCkgKHNl\ndCAtIGN1ciksIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nb25uKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0ID0gc3RhdC5zZXE7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIFN5\nc3RlbS5lcnIucHJpbnRsbihzZXQpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChOdW1iZXJGb3JtYXRFeGNl\ncHRpb24gbmZlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0cnkgeyBj\nb25uLmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBIZWxwZXIgc3RydWN0IHRvIGhvbGQgc3RhdHVzIGluZm9ybWF0aW9u\nLgogICAgICovCiAgICBAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKICAg\nIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgU3RhdHVzCiAgICAgICAgaW1wbGVt\nZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBwdWJsaWMgbG9uZyBzZXEg\nPSAxTDsKICAgICAgICBwdWJsaWMgbG9uZyBtYXggPSAwTDsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENv\nbm5lY3Rpb24gY29ubiwgU1FMQnVmZmVyIGJ1ZikKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gYnVmLnByZXBhcmVTdGF0\nZW1lbnQoY29ubik7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMgb3Ig\nSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2YgZXhlY3V0aW5n\nIHVwZGF0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIGludCBleGVjdXRlVXBk\nYXRlKEpEQkNDb25maWd1cmF0aW9uIGNvbmYsIENvbm5lY3Rpb24gY29ubiwg\nIAogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBTUUxCdWZmZXIg\nYnVmLCBpbnQgb3Bjb2RlKSB0aHJvd3MgU1FMRXhjZXB0aW9uCiAgICB7CiAg\nICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1dGVVcGRhdGUoKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92\nZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBs\nZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcgcXVlcnkuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KEpEQkNDb25maWd1cmF0\naW9uIGNvbmYsIENvbm5lY3Rpb24gY29ubiwKICAgICAgICBQcmVwYXJlZFN0\nYXRlbWVudCBzdG1udCwgU1FMQnVmZmVyIGJ1ZikgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHN0bW50LmV4ZWN1dGVRdWVyeSgpOwog\nICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHBy\nb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAg\nICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcgc2VxdWVuY2UgZnJvbSB0\naGUgcmVzdWx0IHNldC4KICAgICAqLwogICAgcHJvdGVjdGVkIGxvbmcgZ2V0\nU2VxdWVuY2UoUmVzdWx0U2V0IHJzLCBEQkRpY3Rpb25hcnkgZGljdCkKICAg\nICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHJz\nID09IG51bGwgfHwgIXJzLm5leHQoKSkKICAgICAgICAgICAgcmV0dXJuIC0x\nOwogICAgICAgIHJldHVybiBkaWN0LmdldExvbmcocnMsIDEpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFVuaXF1ZUNvbnN0cmFpbnROYW1lKFN0cmlu\nZyB1bmlxdWVDb25zdHJhaW50TmFtZSkgewogICAgICAgIF91bmlxdWVDb25z\ndHJhaW50TmFtZSA9IERCSWRlbnRpZmllci5uZXdDb25zdHJhaW50KHVuaXF1\nZUNvbnN0cmFpbnROYW1lKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRV\nbmlxdWVDb25zdHJhaW50TmFtZShEQklkZW50aWZpZXIgdW5pcXVlQ29uc3Ry\nYWludE5hbWUpIHsKICAgICAgICBfdW5pcXVlQ29uc3RyYWludE5hbWUgPSB1\nbmlxdWVDb25zdHJhaW50TmFtZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFVuaXF1ZUNvbnN0cmFpbnROYW1lKCkgewogICAgICAgIHJldHVybiBf\ndW5pcXVlQ29uc3RyYWludE5hbWUuZ2V0TmFtZSgpOwogICAgfQoKICAgIHB1\nYmxpYyBEQklkZW50aWZpZXIgZ2V0VW5pcXVlQ29uc3RyYWludElkZW50aWZp\nZXIoKSB7CiAgICAgICAgcmV0dXJuIF91bmlxdWVDb25zdHJhaW50TmFtZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEFsbG9jYXRlU2VxdWVuY2VSdW5uYWJs\nZSBpcyBhIHJ1bm5hYmxlIHdyYXBwZXIgdGhhdCB3aWxsIGluc2VydHMgdGhl\nCiAgICAgKiBpbml0aWFsIHNlcXVlbmNlIHZhbHVlIGludG8gdGhlIGRhdGFi\nYXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgY2xhc3MgQWxsb2NhdGVTZXF1\nZW5jZVJ1bm5hYmxlIGltcGxlbWVudHMgUnVubmFibGUgewoKICAgICAgICBK\nREJDU3RvcmUgc3RvcmUgPSBudWxsOwogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nID0gbnVsbDsKICAgICAgICBTdGF0dXMgc3RhdCA9IG51bGw7CiAg\nICAgICAgaW50IGFsbG9jOwogICAgICAgIGJvb2xlYW4gdXBkYXRlU3RhdFNl\ncTsKCiAgICAgICAgQWxsb2NhdGVTZXF1ZW5jZVJ1bm5hYmxlKEpEQkNTdG9y\nZSBzdG9yZSwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsCiAgICAgICAgICAgICAg\nICBTdGF0dXMgc3RhdCwgaW50IGFsbG9jLCBib29sZWFuIHVwZGF0ZVN0YXRT\nZXEpIHsKICAgICAgICAgICAgdGhpcy5zdG9yZSA9IHN0b3JlOwogICAgICAg\nICAgICB0aGlzLm1hcHBpbmcgPSBtYXBwaW5nOwogICAgICAgICAgICB0aGlz\nLnN0YXQgPSBzdGF0OwogICAgICAgICAgICB0aGlzLmFsbG9jID0gYWxsb2M7\nCiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdFNlcSA9IHVwZGF0ZVN0YXRT\nZXE7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBUaGlzIG1l\ndGhvZCBhY3R1YWxseSBvYnRhaW5zIHRoZSBjdXJyZW50IHNlcXVlbmNlIHZh\nbHVlLgogICAgICAgICAqIAogICAgICAgICAqIEB0aHJvd3MgUnVudGltZUV4\nY2VwdGlvbgogICAgICAgICAqICAgICAgICAgICAgIGFueSBTUUxFeGNlcHRp\nb25zIHRoYXQgb2NjdXIgd2hlbiBvYnRhaW5pbmcgdGhlIHNlcXVlbmNlCiAg\nICAgICAgICogICAgICAgICAgICAgdmFsdWUgYXJlIHdyYXBwZWQgaW4gYSBy\ndW50aW1lIGV4Y2VwdGlvbiB0byBhdm9pZAogICAgICAgICAqICAgICAgICAg\nICAgIGJyZWFraW5nIHRoZSBSdW5uYWJsZSBtZXRob2Qgc2lnbmF0dXJlLiBU\naGUgY2FsbGVyIGNhbgogICAgICAgICAqICAgICAgICAgICAgIG9idGFpbiB0\naGUgInJlYWwiIGV4Y2VwdGlvbiBieSBjYWxsaW5nIGdldENhdXNlKCkuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgdGhyb3dzIFJ1\nbnRpbWVFeGNlcHRpb24gewogICAgICAgICAgICBDb25uZWN0aW9uIGNvbm4g\nPSBudWxsOwogICAgICAgICAgICBTUUxFeGNlcHRpb24gZXJyID0gbnVsbDsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFRyeSB0byB1\nc2UgdGhlIHN0b3JlJ3MgY29ubmVjdGlvbi4KICAgICAgICAgICAgICAgIAog\nICAgICAgICAgICAgICAgY29ubiA9IGdldENvbm5lY3Rpb24oc3RvcmUpOyAg\nCiAgICAgICAgICAgICAgICBib29sZWFuIHNlcXVlbmNlU2V0ID0KICAgICAg\nICAgICAgICAgICAgICBzZXRTZXF1ZW5jZShtYXBwaW5nLCBzdGF0LCBhbGxv\nYywgdXBkYXRlU3RhdFNlcSwgY29ubik7CiAgICAgICAgICAgICAgICBjbG9z\nZUNvbm5lY3Rpb24oY29ubik7CgogICAgICAgICAgICAgICAgaWYgKCFzZXF1\nZW5jZVNldCkgewogICAgICAgICAgICAgICAgICAgIC8vIGluc2VydCBhIG5l\ndyBzZXF1ZW5jZSBjb2x1bW4uIAogICAgICAgICAgICAgICAgICAgIC8vIFBy\nZWZlciBjb25uZWN0aW9uMiAvIG5vbi1qdGEtZGF0YS1zb3VyY2Ugd2hlbiBp\nbnNlcnRpbmcgCiAgICAgICAgICAgICAgICAgICAgLy8gYSBzZXF1ZW5jZSBj\nb2x1bW4gcmVnYXJkbGVzcyBvZiBTZXEudHlwZS4KICAgICAgICAgICAgICAg\nICAgICBjb25uID0gX2NvbmYuZ2V0RGF0YVNvdXJjZTIoc3RvcmUuZ2V0Q29u\ndGV4dCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRD\nb25uZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0U2VxdWVu\nY2UobWFwcGluZywgY29ubik7CiAgICAgICAgICAgICAgICAgICAgY29ubi5j\nbG9zZSgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBub3cgd2Ugc2hvdWxk\nIGJlIGFibGUgdG8gdXBkYXRlIHVzaW5nIHRoZSBjb25uZWN0aW9uIHBlcgog\nICAgICAgICAgICAgICAgICAgIC8vIG9uIHRoZSBzZXEgdHlwZS4KICAgICAg\nICAgICAgICAgICAgICBjb25uID0gZ2V0Q29ubmVjdGlvbihzdG9yZSk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFzZXRTZXF1ZW5jZShtYXBwaW5nLCBz\ndGF0LCBhbGxvYywgdXBkYXRlU3RhdFNlcSwgY29ubikpCiAgICAgICAgICAg\nICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyAoZXJy\nICE9IG51bGwpID8gZXJyIDogbmV3IFNRTEV4Y2VwdGlvbihfbG9jLmdldCgK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm8tc2VxLXJvdyIs\nIG1hcHBpbmcsIF90YWJsZSkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2xvc2VDb25uZWN0aW9u\nKGNvbm4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNo\nIChTUUxFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgaWYgKGNvbm4g\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNsb3NlQ29ubmVjdGlv\nbihjb25uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFJ1\nbnRpbWVFeGNlcHRpb24gcmUgPSBuZXcgUnVudGltZUV4Y2VwdGlvbihlLmdl\ndE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICByZS5pbml0Q2F1c2UoZSk7\nCiAgICAgICAgICAgICAgICB0aHJvdyByZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEN1cmVudFNlcXVlbmNlUnVu\nbmFibGUgaXMgYSBydW5uYWJsZSB3cmFwcGVyIHdoaWNoIG9idGFpbnMgdGhl\nIGN1cnJlbnQKICAgICAqIHNlcXVlbmNlIHZhbHVlIGZyb20gdGhlIGRhdGFi\nYXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgY2xhc3MgQ3VycmVudFNlcXVl\nbmNlUnVubmFibGUgaW1wbGVtZW50cyBSdW5uYWJsZSB7CiAgICAgICAgcHJp\ndmF0ZSBKREJDU3RvcmUgX3N0b3JlOwogICAgICAgIHByaXZhdGUgQ2xhc3NN\nYXBwaW5nIF9tYXBwaW5nOwoKICAgICAgICBDdXJyZW50U2VxdWVuY2VSdW5u\nYWJsZShKREJDU3RvcmUgc3RvcmUsIENsYXNzTWFwcGluZyBtYXBwaW5nKSB7\nCiAgICAgICAgICAgIF9zdG9yZSA9IHN0b3JlOwogICAgICAgICAgICBfbWFw\ncGluZyA9IG1hcHBpbmc7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBUaGlzIG1ldGhvZCBhY3R1YWxseSBvYnRhaW5zIHRoZSBjdXJyZW50\nIHNlcXVlbmNlIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIEB0aHJv\nd3MgUnVudGltZUV4Y2VwdGlvbgogICAgICAgICAqICAgICAgICAgICAgIGFu\neSBTUUxFeGNlcHRpb25zIHRoYXQgb2NjdXIgd2hlbiBvYnRhaW5pbmcgdGhl\nIHNlcXVlbmNlCiAgICAgICAgICogICAgICAgICAgICAgdmFsdWUgYXJlIHdy\nYXBwZWQgaW4gYSBydW50aW1lIGV4Y2VwdGlvbiB0byBhdm9pZAogICAgICAg\nICAqICAgICAgICAgICAgIGJyZWFraW5nIHRoZSBSdW5uYWJsZSBtZXRob2Qg\nc2lnbmF0dXJlLiBUaGUgY2FsbGVyIGNhbgogICAgICAgICAqICAgICAgICAg\nICAgIG9idGFpbiB0aGUgInJlYWwiIGV4Y2VwdGlvbiBieSBjYWxsaW5nIGdl\ndENhdXNlKCkuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgcnVu\nKCkgdGhyb3dzIFJ1bnRpbWVFeGNlcHRpb24gewogICAgICAgICAgICBDb25u\nZWN0aW9uIGNvbm4gPSBudWxsOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgY29ubiA9IGdldENvbm5lY3Rpb24oX3N0b3JlKTsKICAgICAg\nICAgICAgICAgIGxvbmcgY3VyID0gZ2V0U2VxdWVuY2UoX21hcHBpbmcsIGNv\nbm4pOwogICAgICAgICAgICAgICAgaWYgKGN1ciAhPSAtMSApIC8vIFVTRSB0\naGUgY29uc3RhbnQKICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3Vy\nOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FsZSkgewog\nICAgICAgICAgICAgICAgUnVudGltZUV4Y2VwdGlvbiByZSA9IG5ldyBSdW50\naW1lRXhjZXB0aW9uKHNxbGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAg\nICAgIHJlLmluaXRDYXVzZShzcWxlKTsKICAgICAgICAgICAgICAgIHRocm93\nIHJlOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\naWYgKGNvbm4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNsb3Nl\nQ29ubmVjdGlvbihjb25uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

