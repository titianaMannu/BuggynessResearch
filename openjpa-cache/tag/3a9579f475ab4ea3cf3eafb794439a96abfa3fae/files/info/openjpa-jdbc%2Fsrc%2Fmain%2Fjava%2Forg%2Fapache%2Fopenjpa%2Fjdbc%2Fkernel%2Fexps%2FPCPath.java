{"sha":"2cfe5ab650ad0c7d331a220e4350407657a22991","node_id":"MDQ6QmxvYjIwNjM2NDoyY2ZlNWFiNjUwYWQwYzdkMzMxYTIyMGU0MzUwNDA3NjU3YTIyOTkx","size":42412,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/2cfe5ab650ad0c7d331a220e4350407657a22991","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwczsK\nCmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxp\nc3RJdGVyYXRvcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5P\nYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtl\ncm5lbC5KREJDRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMua2VybmVsLkpEQkNTdG9yZVF1ZXJ5OwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkRpc2NyaW1pbmF0\nb3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxk\nTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEu\nU3RyYXRlZ3k7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLlZhbHVlTWFwcGluZzsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLm1ldGEuc3RyYXRzLkhhbmRsZXJDb2xsZWN0aW9uVGFibGVGaWVsZFN0cmF0\nZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5zdHJh\ndHMuSGFuZGxlckhhbmRsZXJNYXBUYWJsZUZpZWxkU3RyYXRlZ3k7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLnN0cmF0cy5MUlNNYXBG\naWVsZFN0cmF0ZWd5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMu\nc2NoZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLnNjaGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMuc2NoZW1hLlNjaGVtYXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zcWwuSm9pbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zcWwuUmVzdWx0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc3FsLlNRTEJ1ZmZlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5q\nZGJjLnNxbC5TZWxlY3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2Vy\nbmVsLkJyb2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuT3Bl\nbkpQQVN0YXRlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5r\nZXJuZWwuU3RvcmVDb250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkNhbmRpZGF0ZVBhdGg7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5tZXRhLlhNTE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgovKioKICogQSBwYXRoIHJl\ncHJlc2VudHMgYSB0cmF2ZXJzYWwgaW50byBmaWVsZHMgb2YgYSBjYW5kaWRh\ndGUgb2JqZWN0LgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGlj\nIGNsYXNzIFBDUGF0aAogICAgZXh0ZW5kcyBDYW5kaWRhdGVQYXRoCiAgICBp\nbXBsZW1lbnRzIEpEQkNQYXRoIHsKCQogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBTdHJpbmcgVFJVRSA9ICIxID0gMSI7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIFN0cmluZyBGQUxTRSA9ICIxIDw+IDEiOwoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBQQVRIID0gMDsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBCT1VORF9WQVIgPSAxOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IFVOQk9VTkRfVkFSID0gMjsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBVTkFDQ0VTU0VEX1ZBUiA9IDM7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgWFBBVEggPSA0OwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IE9CSkVDVF9QQVRIID0gNTsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlKFBDUGF0aC5jbGFzcyk7CgogICAgcHJpdmF0ZSBmaW5hbCBDbGFzc01h\ncHBpbmcgX2NhbmRpZGF0ZTsKICAgIHByaXZhdGUgQ2xhc3NNYXBwaW5nIF9j\nbGFzcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2tleSA9IGZhbHNl\nOwogICAgcHJpdmF0ZSBpbnQgX3R5cGUgPSBQQVRIOwogICAgcHJpdmF0ZSBT\ndHJpbmcgX3Zhck5hbWUgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzcyBfY2Fz\ndCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX2NpZCA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBGaWVsZE1ldGFEYXRhIF94bWxmaWVsZCA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2tleVBhdGggPSBmYWxzZTsKICAgIHByaXZh\ndGUgU3RyaW5nIF9zY2hlbWFBbGlhcyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBwYXRoIHN0YXJ0aW5nIHdpdGggdGhlICd0aGlzJyBwdHIu\nCiAgICAgKi8KICAgIHB1YmxpYyBQQ1BhdGgoQ2xhc3NNYXBwaW5nIHR5cGUp\nIHsKICAgICAgICBfY2FuZGlkYXRlID0gdHlwZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhIHBhdGggc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4g\ndmFyaWFibGUuCiAgICAgKi8KICAgIHB1YmxpYyBQQ1BhdGgoQ2xhc3NNYXBw\naW5nIGNhbmRpZGF0ZSwgVmFyaWFibGUgdmFyKSB7CiAgICAgICAgX2NhbmRp\nZGF0ZSA9IGNhbmRpZGF0ZTsKICAgICAgICBfYWN0aW9ucyA9IG5ldyBMaW5r\nZWRMaXN0KCk7CgogICAgICAgIFBDUGF0aCBvdGhlciA9IHZhci5nZXRQQ1Bh\ndGgoKTsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwog\nICAgICAgIGFjdGlvbi52YXIgPSB2YXIuZ2V0TmFtZSgpOwogICAgICAgIGlm\nIChvdGhlciA9PSBudWxsKSB7CiAgICAgICAgICAgIF90eXBlID0gVU5CT1VO\nRF9WQVI7CiAgICAgICAgICAgIGFjdGlvbi5vcCA9IEFjdGlvbi5VTkJPVU5E\nX1ZBUjsKICAgICAgICAgICAgYWN0aW9uLmRhdGEgPSB2YXI7CiAgICAgICAg\nICAgIF9zY2hlbWFBbGlhcyA9IHZhci5nZXROYW1lKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgLy8gYm91bmQgdmFyaWFibGU7IGNvcHkgcGF0\naAogICAgICAgICAgICBfdHlwZSA9IFVOQUNDRVNTRURfVkFSOwogICAgICAg\nICAgICBfYWN0aW9ucy5hZGRBbGwob3RoZXIuX2FjdGlvbnMpOwogICAgICAg\nICAgICBfa2V5ID0gb3RoZXIuX2tleTsKCiAgICAgICAgICAgIGFjdGlvbi5v\ncCA9IEFjdGlvbi5WQVI7CiAgICAgICAgICAgIGFjdGlvbi5kYXRhID0gdmFy\nLmdldE5hbWUoKTsKICAgICAgICAgICAgX3NjaGVtYUFsaWFzID0gb3RoZXIu\nX3NjaGVtYUFsaWFzOwogICAgICAgICAgICBfY29ycmVsYXRpb25WYXIgPSBv\ndGhlci5fY29ycmVsYXRpb25WYXI7CiAgICAgICAgfQogICAgICAgIF9hY3Rp\nb25zLmFkZChhY3Rpb24pOwogICAgICAgIF9jYXN0ID0gdmFyLmdldFR5cGUo\nKTsgLy8gaW5pdGlhbCB0eXBlIGlzIHZhciB0eXBlCiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYSBwYXRoIHN0YXJ0aW5nIGZyb20gdGhlIGdpdmVu\nIHN1YnF1ZXJ5LgogICAgICovCiAgICBwdWJsaWMgUENQYXRoKFN1YlEgc3Vi\nKSB7CiAgICAgICAgX2NhbmRpZGF0ZSA9IHN1Yi5nZXRDYW5kaWRhdGUoKTsK\nICAgICAgICBfYWN0aW9ucyA9IG5ldyBMaW5rZWRMaXN0KCk7CgogICAgICAg\nIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9uKCk7CiAgICAgICAgYWN0aW9u\nLm9wID0gQWN0aW9uLlNVQlFVRVJZOwogICAgICAgIGFjdGlvbi5kYXRhID0g\nc3ViLmdldENhbmRpZGF0ZUFsaWFzKCk7CiAgICAgICAgX2FjdGlvbnMuYWRk\nKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSBzdWIuZ2V0VHlwZSgpOyAvLyBp\nbml0aWFsIHR5cGUgaXMgc3VicXVlcnkgdHlwZQogICAgICAgIF92YXJOYW1l\nID0gc3ViLmdldENhbmRpZGF0ZUFsaWFzKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0U2NoZW1hQWxpYXMoU3RyaW5nIHNjaGVtYUFsaWFzKSB7CiAg\nICAgICAgaWYgKF9zY2hlbWFBbGlhcyA9PSBudWxsKSAKICAgICAgICAgICAg\nX3NjaGVtYUFsaWFzID0gc2NoZW1hQWxpYXM7CiAgICB9CgogICAgcHVibGlj\nIFN0cmluZyBnZXRTY2hlbWFBbGlhcygpIHsKICAgICAgICByZXR1cm4gX3Nj\naGVtYUFsaWFzOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRTdWJx\ndWVyeUNvbnRleHQoQ29udGV4dCBjb250ZXh0LCBTdHJpbmcgY29ycmVsYXRp\nb25WYXIpIHsKICAgICAgICBBY3Rpb24gYWN0aW9uID0gbGFzdEZpZWxkQWN0\naW9uKCk7CiAgICAgICAgaWYgKGFjdGlvbiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgYWN0aW9uLmNvbnRleHQgPSBjb250ZXh0Owog\nICAgICAgIF9jb3JyZWxhdGlvblZhciA9IGNvcnJlbGF0aW9uVmFyOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIFNldCB0aGUgcGF0aCBhcyBhIGJpbmRp\nbmcgb2YgdGhlIGdpdmVuIHZhcmlhYmxlLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBhZGRWYXJpYWJsZUFjdGlvbihWYXJpYWJsZSB2YXIpIHsKICAgICAg\nICBfdmFyTmFtZSA9IHZhci5nZXROYW1lKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGlzIGlzIGEgYm91bmQgdmFyaWFibGUg\ndGhhdCBoYXMgbm90IGJlZW4gYWNjZXNzZWQKICAgICAqIGFmdGVyIGJpbmRp\nbmcuIFVzZWZ1bCBmb3IgZmlsdGVycyBsaWtlCiAgICAgKiAiY29sbC5jb250\nYWlucyAodmFyKSAmYW1wOyZhbXA7IHZhciA9PSBudWxsIiwgd2hpY2ggc2hv\ndWxkIHJlYWxseQogICAgICoganVzdCBhY3QgbGlrZSAiY29sbC5jb250YWlu\ncyAobnVsbCkiLgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1VuYWNj\nZXNzZWRWYXJpYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3R5cGUgPT0gVU5B\nQ0NFU1NFRF9WQVI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hl\ndGhlciB0aGlzIGlzIGEgcGF0aCBpbnZvbHZpbmcgYSB2YXJpYWJsZS4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNWYXJpYWJsZVBhdGgoKSB7CiAg\nICAgICAgcmV0dXJuIF90eXBlICE9IFBBVEg7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0aGlzIHBhdGggaXMgcGFydCBvZiBhIGNvbnRhaW5zIGNsYXVz\nZSwgdGhlbiBhbGlhcyBpdCB0byB0aGUKICAgICAqIHByb3BlciBjb250YWlu\ncyBpZCBiZWZvcmUgaW5pdGlhbGl6YXRpb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgdm9pZCBzZXRDb250YWluc0lkKFN0cmluZyBpZCkg\newogICAgICAgIGlmIChfY2lkKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIEFjdGlvbiBsYXN0ID0gX2FjdGlvbnMgPT0gbnVsbCA/IG51bGwgOiAo\nQWN0aW9uKSBfYWN0aW9ucy5nZXRMYXN0KCk7CiAgICAgICAgaWYgKGxhc3Qg\nIT0gbnVsbCAmJiBsYXN0Lm9wID09IEFjdGlvbi5WQVIgJiYgKChTdHJpbmcp\nbGFzdC5kYXRhKS5lcXVhbHMobGFzdC52YXIpKSB7CiAgICAgICAgICAgIF9j\naWQgPSB0cnVlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAgICAg\nICAgICAgIAogICAgICAgICAgICAKICAgICAgICAvLyB0cmVhdCBpdCBqdXN0\nIGxpa2UgYSB1bmlxdWUgdmFyaWFibGUKICAgICAgICBBY3Rpb24gYWN0aW9u\nID0gbmV3IEFjdGlvbigpOwogICAgICAgIGFjdGlvbi5vcCA9IEFjdGlvbi5W\nQVI7CiAgICAgICAgYWN0aW9uLmRhdGEgPSBpZDsKICAgICAgICBpZiAoX2Fj\ndGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlu\na2VkTGlzdCgpOwogICAgICAgIF9hY3Rpb25zLmFkZChhY3Rpb24pOwogICAg\nICAgIF9jaWQgPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyBDbGFzc01ldGFE\nYXRhIGdldE1ldGFEYXRhKCkgewogICAgICAgIHJldHVybiBfY2xhc3M7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0TWV0YURhdGEoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgX2NsYXNzID0gKENsYXNzTWFwcGluZykgbWV0\nYTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0tleSgpIHsKICAgICAg\nICByZXR1cm4gX2tleTsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4g\naXNYUGF0aCgpIHsKICAgICAgICByZXR1cm4gX3R5cGUgPT0gWFBBVEg7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0WFBhdGgoKSB7CiAgICAg\nICAgU3RyaW5nQnVpbGRlciB4cGF0aCA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7\nCiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAgICBJdGVyYXRvciBpdHIg\nPSBfYWN0aW9ucy5pdGVyYXRvcigpOwogICAgICAgIAogICAgICAgIC8vIFNr\naXAgdmFyaWFibGUgYWN0aW9ucyBzaW5jZSB0aGV5IGFyZSBub3QgcGFydCBv\nZiB0aGUgeHBhdGgKICAgICAgICAvLyB1bnRpbCB3ZSByZWFjaCB0aGUgZmly\nc3QgeHBhdGggYWN0aW9uLgogICAgICAgIC8vIFRoZSBmaXJzdCB4cGF0aCBh\nY3Rpb24gbWFwcyB0byB0aGUgcm9vdCBvZiBhbiB4bWwgZG9jdW1lbnQuCiAg\nICAgICAgZG8gCiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rpb24pIGl0ci5u\nZXh0KCk7IAogICAgICAgIHdoaWxlIChhY3Rpb24ub3AgIT0gQWN0aW9uLkdF\nVF9YUEFUSCk7CiAgICAgICAgCiAgICAgICAgLy8gU2tpcCBYbWxSb290RWxl\nbWVudDoKICAgICAgICAvLyBXZSBjYW4ndCByZWx5IG9uIHRoZSBhY2N1cmFj\neSBvZiB0aGUgbmFtZSBvZiB0aGUgcm9vdCBlbGVtZW50LAogICAgICAgIC8v\nIGJlY2F1c2UgaXQgY291bGQgYmUgc2V0IHRvIHNvbWUgZGVmYXVsdCBieSBK\nQVhCIFhNTCBCaW5kaW5nLgogICAgICAgIC8vIFRoZSBjYWxsZXIoREJEaWN0\naW9uYXJ5KSBzaG91bGQgc3RhcnQgd2l0aCAiLyoiIG9yICIvKi8iLAogICAg\nICAgIC8vIHdlIGJ1aWxkIHRoZSByZW1haW5pbmcgeHBhdGggdGhhdCBmb2xs\nb3dzIHRoZSByb290IGVsZW1lbnQuCiAgICAgICAgd2hpbGUgKGl0ci5oYXNO\nZXh0KCkpIHsKICAgICAgICAgICAgYWN0aW9uID0gKEFjdGlvbikgaXRyLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKCgoWE1MTWV0YURhdGEpIGFjdGlvbi5k\nYXRhKS5nZXRYbWxuYW1lKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHhw\nYXRoLmFwcGVuZCgoKFhNTE1ldGFEYXRhKSBhY3Rpb24uZGF0YSkuZ2V0WG1s\nbmFtZSgpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgeHBh\ndGguYXBwZW5kKCIqIik7CiAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgp\nKQogICAgICAgICAgICAgICAgeHBhdGguYXBwZW5kKCIvIik7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB4cGF0aC50b1N0cmluZygpOwogICAgfQogICAg\nCiAgICBwdWJsaWMgU3RyaW5nIGdldFBDUGF0aFN0cmluZygpIHsKICAgICAg\nICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChf\ndmFyTmFtZSA9PSBudWxsKSA/ICIiIDogX3Zhck5hbWUgKyAiLiI7CgogICAg\nICAgIFN0cmluZ0J1aWxkZXIgcGF0aCA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7\nCiAgICAgICAgQWN0aW9uIGFjdGlvbjsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rpb24pIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlZBUiB8fCBhY3Rp\nb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKQogICAgICAgICAgICAgICAgcGF0\naC5hcHBlbmQoYWN0aW9uLmRhdGEpOwogICAgICAgICAgICBlbHNlIGlmIChh\nY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRfVkFSKQogICAgICAgICAgICAg\nICAgcGF0aC5hcHBlbmQoKChWYXJpYWJsZSkgYWN0aW9uLmRhdGEpLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICBwYXRo\nLmFwcGVuZCgoKEZpZWxkTWFwcGluZykgYWN0aW9uLmRhdGEpLmdldE5hbWUo\nKSk7CiAgICAgICAgICAgIHBhdGguYXBwZW5kKCcuJyk7CiAgICAgICAgfQog\nICAgICAgIGlmIChfdmFyTmFtZSAhPSBudWxsKQogICAgICAgICAgICBwYXRo\nLmFwcGVuZChfdmFyTmFtZSkuYXBwZW5kKCcuJyk7CiAgICAgICAgcmV0dXJu\nIHBhdGgudG9TdHJpbmcoKTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NNYXBw\naW5nIGdldENsYXNzTWFwcGluZyhFeHBTdGF0ZSBzdGF0ZSkgewogICAgICAg\nIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsK\nICAgICAgICBpZiAocHN0YXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAg\nIHJldHVybiBfY2xhc3M7CiAgICAgICAgaWYgKF9rZXkpIHsKICAgICAgICAg\nICAgaWYgKHBzdGF0ZS5maWVsZC5nZXRLZXkoKS5nZXRUeXBlQ29kZSgpID09\nIEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUu\nZmllbGQuZ2V0S2V5TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7CiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAocHN0\nYXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29kZSgpID09IEphdmFU\neXBlcy5QQykgewogICAgICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmlzRWxl\nbWVudENvbGxlY3Rpb24oKSAmJgogICAgICAgICAgICAgICAgcHN0YXRlLmZp\nZWxkLmdldEVsZW1lbnQoKS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAgICAg\nICBwc3RhdGUuaXNFbWJlZEVsZW1lbnRDb2xsID0gdHJ1ZTsKICAgICAgICAg\nICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRFbGVtZW50TWFwcGluZygpLmdl\ndFR5cGVNYXBwaW5nKCk7CiAgICAgICAgfQogICAgICAgIGlmIChwc3RhdGUu\nZmllbGQuZ2V0VHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAg\nICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0VHlwZU1hcHBpbmcoKTsKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgRmllbGRNYXBw\naW5nIGdldEZpZWxkTWFwcGluZyhFeHBTdGF0ZSBzdGF0ZSkgewogICAgICAg\nIHJldHVybiAoKFBhdGhFeHBTdGF0ZSkgc3RhdGUpLmZpZWxkOwogICAgfQoK\nICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRDb2x1bW5zKEV4cFN0YXRlIHN0YXRl\nKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQYXRoRXhwU3Rh\ndGUpIHN0YXRlOwogICAgICAgIGlmIChwc3RhdGUuY29scyA9PSBudWxsKQog\nICAgICAgICAgICBwc3RhdGUuY29scyA9IGNhbGN1bGF0ZUNvbHVtbnMocHN0\nYXRlKTsKICAgICAgICByZXR1cm4gcHN0YXRlLmNvbHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGUgY29sdW1ucyB1c2VkIGJ5IHRoaXMgcGF0aC4KICAg\nICAqLwogICAgcHJpdmF0ZSBDb2x1bW5bXSBjYWxjdWxhdGVDb2x1bW5zKFBh\ndGhFeHBTdGF0ZSBwc3RhdGUpIHsKICAgICAgICBpZiAoX2tleSB8fAogICAg\nICAgICAgICAoX2tleVBhdGggJiYgcHN0YXRlLmZpZWxkLmdldEtleSgpICE9\nIG51bGwgJiYKICAgICAgICAgICAgICAgICFwc3RhdGUuZmllbGQuZ2V0S2V5\nKCkuaXNFbWJlZGRlZCgpKSkgewogICAgICAgICAgICBpZiAoIXBzdGF0ZS5q\nb2luZWRSZWwgCiAgICAgICAgICAgICAgICAmJiBwc3RhdGUuZmllbGQuZ2V0\nS2V5KCkuZ2V0VmFsdWVNYXBwZWRCeSgpICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBqb2luUmVsYXRpb24ocHN0YXRlLCBfa2V5LCBmYWxzZSwgZmFsc2Up\nOwogICAgICAgICAgICBlbHNlIGlmIChwc3RhdGUuam9pbmVkUmVsIAogICAg\nICAgICAgICAgICAgJiYgcHN0YXRlLmZpZWxkLmdldEtleSgpLmdldFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgcmV0dXJu\nIHBzdGF0ZS5maWVsZC5nZXRLZXlNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmco\nKS4KICAgICAgICAgICAgICAgICAgICBnZXRQcmltYXJ5S2V5Q29sdW1ucygp\nOwogICAgICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldEtleU1hcHBp\nbmcoKS5nZXRDb2x1bW5zKCk7CiAgICAgICAgfQogICAgICAgIGlmIChwc3Rh\ndGUuZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICBzd2l0Y2ggKHBzdGF0\nZS5maWVsZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExF\nQ1RJT046CiAgICAgICAgICAgICAgICAgICAgVmFsdWVNYXBwaW5nIGVsZW0g\nPSBwc3RhdGUuZmllbGQuZ2V0RWxlbWVudE1hcHBpbmcoKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAocHN0YXRlLmZpZWxkLmlzRWxlbWVudENvbGxlY3Rp\nb24oKSAmJiBwc3RhdGUuZmllbGQuZ2V0RWxlbWVudCgpLmlzRW1iZWRkZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBTdHJhdGVneSBzdHJhdGVn\neSA9IHBzdGF0ZS5maWVsZC5nZXRTdHJhdGVneSgpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoc3RyYXRlZ3kgaW5zdGFuY2VvZiBIYW5kbGVyQ29s\nbGVjdGlvblRhYmxlRmllbGRTdHJhdGVneSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuICgoSGFuZGxlckNvbGxlY3Rpb25UYWJsZUZp\nZWxkU3RyYXRlZ3kpIHN0cmF0ZWd5KS4KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBnZXRFbGVtZW50Q29sdW1ucyhlbGVtLmdldFR5cGVNYXBw\naW5nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0\ncmF0ZWd5IGluc3RhbmNlb2YgSGFuZGxlckhhbmRsZXJNYXBUYWJsZUZpZWxk\nU3RyYXRlZ3kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbiAoKEhhbmRsZXJIYW5kbGVyTWFwVGFibGVGaWVsZFN0cmF0ZWd5KSBzdHJh\ndGVneSkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRWYWx1ZUNv\nbHVtbnMoZWxlbS5nZXRUeXBlTWFwcGluZygpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBpZiAocHN0YXRlLmpvaW5lZFJlbCAmJiBlbGVtLmdldFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gZWxlbS5nZXRUeXBlTWFwcGluZygpLmdldFByaW1hcnlLZXlD\nb2x1bW5zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uZ2V0Q29s\ndW1ucygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBlbGVtLmdldENvbHVtbnMoKTsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gcHN0YXRlLmZpZWxkLmdldENvbHVtbnMoKTsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAgICAgICAgICAgICAgIGlm\nIChwc3RhdGUuam9pbmVkUmVsKQogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gcHN0YXRlLmZpZWxkLmdldFR5cGVNYXBwaW5nKCkuCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBnZXRQcmltYXJ5S2V5Q29sdW1ucygpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3RhdGUuZmllbGQuZ2V0Q29s\ndW1ucygpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gcHN0YXRlLmZpZWxkLmdldENvbHVtbnMoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gKF9jbGFzcyA9\nPSBudWxsKSA/IFNjaGVtYXMuRU1QVFlfQ09MVU1OUwogICAgICAgICAgICA6\nIF9jbGFzcy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzVmFyaWFibGUoKSB7CiAgICAgICAgaWYgKF9hY3Rp\nb25zID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBBY3Rpb24gYWN0aW9uID0gKEFjdGlvbikgX2FjdGlvbnMuZ2V0TGFzdCgp\nOwogICAgICAgIHJldHVybiBhY3Rpb24ub3AgPT0gQWN0aW9uLlVOQk9VTkRf\nVkFSIHx8IGFjdGlvbi5vcCA9PSBBY3Rpb24uVkFSOyAKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBnZXQoRmllbGRNZXRhRGF0YSBmaWVsZCwgYm9vbGVhbiBu\ndWxsVHJhdmVyc2FsKSB7CiAgICAgICAgaWYgKF9hY3Rpb25zID09IG51bGwp\nCiAgICAgICAgICAgIF9hY3Rpb25zID0gbmV3IExpbmtlZExpc3QoKTsKICAg\nICAgICBBY3Rpb24gYWN0aW9uID0gbmV3IEFjdGlvbigpOwogICAgICAgIGFj\ndGlvbi5vcCA9IChudWxsVHJhdmVyc2FsKSA/IEFjdGlvbi5HRVRfT1VURVIg\nOiBBY3Rpb24uR0VUOwogICAgICAgIGFjdGlvbi5kYXRhID0gZmllbGQ7CiAg\nICAgICAgX2FjdGlvbnMuYWRkKGFjdGlvbik7CiAgICAgICAgaWYgKF90eXBl\nID09IFVOQUNDRVNTRURfVkFSKQogICAgICAgICAgICBfdHlwZSA9IEJPVU5E\nX1ZBUjsKICAgICAgICBfY2FzdCA9IG51bGw7CiAgICAgICAgX2tleSA9IGZh\nbHNlOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBnZXQoRmllbGRNZXRh\nRGF0YSBmbWQsIFhNTE1ldGFEYXRhIG1ldGEpIHsKICAgICAgICBpZiAoX2Fj\ndGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgX2FjdGlvbnMgPSBuZXcgTGlu\na2VkTGlzdCgpOwogICAgICAgIEFjdGlvbiBhY3Rpb24gPSBuZXcgQWN0aW9u\nKCk7CiAgICAgICAgYWN0aW9uLm9wID0gQWN0aW9uLkdFVF9YUEFUSDsKICAg\nICAgICBhY3Rpb24uZGF0YSA9IG1ldGE7CiAgICAgICAgX2FjdGlvbnMuYWRk\nKGFjdGlvbik7CiAgICAgICAgX2Nhc3QgPSBudWxsOwogICAgICAgIF9rZXkg\nPSBmYWxzZTsKICAgICAgICBfdHlwZSA9IFhQQVRIOwogICAgICAgIF94bWxm\naWVsZCA9IGZtZDsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgZ2V0KFhN\nTE1ldGFEYXRhIG1ldGEsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgQWN0aW9u\nIGFjdGlvbiA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBhY3Rpb24ub3AgPSBB\nY3Rpb24uR0VUX1hQQVRIOwogICAgICAgIGFjdGlvbi5kYXRhID0gbWV0YS5n\nZXRGaWVsZE1hcHBpbmcobmFtZSk7CiAgICAgICAgX2FjdGlvbnMuYWRkKGFj\ndGlvbik7CiAgICAgICAgX2Nhc3QgPSBudWxsOwogICAgICAgIF9rZXkgPSBm\nYWxzZTsKICAgICAgICBfdHlwZSA9IFhQQVRIOwogICAgfQogICAgCiAgICBw\ndWJsaWMgWE1MTWV0YURhdGEgZ2V0WG1sTWFwcGluZygpIHsKICAgICAgICBB\nY3Rpb24gYWN0ID0gKEFjdGlvbikgX2FjdGlvbnMuZ2V0TGFzdCgpOwogICAg\nICAgIGlmIChhY3QgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIChYTUxN\nZXRhRGF0YSkgYWN0LmRhdGE7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9\nCgogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGdldEtleSgpIHsKICAg\nICAgICBpZiAoX2NpZCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAv\nLyByZXBsYWNlIHRoZSBsYXN0IGZpZWxkIGFjdGlvbiB0byBhIGdldCBrZXkK\nICAgICAgICBBY3Rpb24gYWN0aW9uID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAg\nICAgICAgQWN0aW9uIGtleSA9IG5ldyBBY3Rpb24oKTsKICAgICAgICBrZXku\nb3AgPSBBY3Rpb24uR0VUX0tFWTsKICAgICAgICBrZXkuZGF0YSA9IGFjdGlv\nbi5kYXRhOwogICAgICAgIGludCBwb3MgPSBfYWN0aW9ucy5pbmRleE9mKGFj\ndGlvbik7CiAgICAgICAgX2FjdGlvbnMucmVtb3ZlKGFjdGlvbik7CiAgICAg\nICAgX2FjdGlvbnMuYWRkKHBvcywga2V5KTsKICAgICAgICBfY2FzdCA9IG51\nbGw7CiAgICAgICAgX2tleSA9IHRydWU7CiAgICAgICAgX3R5cGUgPSBQQVRI\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBjaGVja09iamVjdFBhdGhJbmhl\ncml0YW5jZVR5cGVKb2luZWQoUGF0aEV4cFN0YXRlIHBzdGF0ZSkgewogICAg\nICAgIC8vIGlmIHRoaXMgbWFwcGluZyBpcyBpbiBJbmhlcml0YW5jZVR5cGUu\nSk9JTkVELAogICAgICAgIC8vIHRoZW4gYWRkIGpvaW5zCiAgICAgICAgIENs\nYXNzTWFwcGluZyBiYXNlID0gX2NsYXNzOwogICAgICAgICB3aGlsZSAoYmFz\nZS5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKSAhPSBudWxsKQog\nICAgICAgICAgICAgYmFzZSA9IGJhc2UuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xh\nc3NNYXBwaW5nKCk7CiAgICAgICAgIGlmIChiYXNlICE9IF9jbGFzcykgewog\nICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIGZyb20gPSBfY2xhc3M7CiAgICAg\nICAgICAgICBDbGFzc01hcHBpbmcgdG8gPSBiYXNlOwogICAgICAgICAgICAg\nX3R5cGUgPSBPQkpFQ1RfUEFUSDsKICAgICAgICAgICAgIGZvciAoOyBmcm9t\nICE9IG51bGwgJiYgZnJvbSAhPSB0bzsgZnJvbSA9IGZyb20uZ2V0Sm9pbmFi\nbGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCkpIHsKICAgICAgICAgICAgICAgICBw\nc3RhdGUuam9pbnMgPSBmcm9tLmpvaW5TdXBlcmNsYXNzKHBzdGF0ZS5qb2lu\ncywgZmFsc2UpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIEZpZWxkTWV0YURhdGEgbGFzdCgpIHsKICAgICAgICBBY3Rp\nb24gYWN0ID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAgcmV0dXJuIChh\nY3QgPT0gbnVsbCkgPyBudWxsIDogaXNYUGF0aCgpID8KICAgICAgICAgICAg\nX3htbGZpZWxkIDogKEZpZWxkTWV0YURhdGEpIGFjdC5kYXRhOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsYXN0IGFjdGlvbiB0aGF0IGdl\ndHMgYSBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBBY3Rpb24gbGFzdEZp\nZWxkQWN0aW9uKCkgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKGlzWFBhdGgo\nKSkKICAgICAgICAgICAgcmV0dXJuIChBY3Rpb24pIF9hY3Rpb25zLmdldExh\nc3QoKTsKICAgICAgICAKICAgICAgICBMaXN0SXRlcmF0b3IgaXRyID0gX2Fj\ndGlvbnMubGlzdEl0ZXJhdG9yKF9hY3Rpb25zLnNpemUoKSk7CiAgICAgICAg\nQWN0aW9uIHByZXY7CiAgICAgICAgd2hpbGUgKGl0ci5oYXNQcmV2aW91cygp\nKSB7CiAgICAgICAgICAgIHByZXYgPSAoQWN0aW9uKSBpdHIucHJldmlvdXMo\nKTsKICAgICAgICAgICAgaWYgKHByZXYub3AgPT0gQWN0aW9uLkdFVCB8fCBw\ncmV2Lm9wID09IEFjdGlvbi5HRVRfT1VURVIKICAgICAgICAgICAgICAgIHx8\nIHByZXYub3AgPT0gQWN0aW9uLkdFVF9LRVkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gcHJldjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIENsYXNzIGdldFR5cGUoKSB7CiAgICAgICAgaWYg\nKF9jYXN0ICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FzdDsKICAg\nICAgICBBY3Rpb24gYWN0ID0gbGFzdEZpZWxkQWN0aW9uKCk7CiAgICAgICAg\naWYgKGFjdCAhPSBudWxsICYmIGFjdC5vcCA9PSBBY3Rpb24uR0VUX1hQQVRI\nKQogICAgICAgICAgICByZXR1cm4gKChYTUxNZXRhRGF0YSkgYWN0LmRhdGEp\nLmdldFR5cGUoKTsKCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbGQgPSAoYWN0\nID09IG51bGwpID8gbnVsbCA6IChGaWVsZE1ldGFEYXRhKSBhY3QuZGF0YTsK\nICAgICAgICBib29sZWFuIGtleSA9IGFjdCAhPSBudWxsICYmIGFjdC5vcCA9\nPSBBY3Rpb24uR0VUX0tFWTsKICAgICAgICBpZiAoZmxkICE9IG51bGwpIHsK\nICAgICAgICAgICAgc3dpdGNoIChmbGQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5BUlJBWToKICAg\nICAgICAgICAgICAgICAgICBpZiAoZmxkLmdldERlY2xhcmVkVHlwZSgpID09\nIGJ5dGVbXS5jbGFzcwogICAgICAgICAgICAgICAgICAgICAgICB8fCBmbGQu\nZ2V0RGVjbGFyZWRUeXBlKCkgPT0gQnl0ZVtdLmNsYXNzCiAgICAgICAgICAg\nICAgICAgICAgICAgIHx8IGZsZC5nZXREZWNsYXJlZFR5cGUoKSA9PSBjaGFy\nW10uY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAgfHwgZmxkLmdldERl\nY2xhcmVkVHlwZSgpID09IENoYXJhY3RlcltdLmNsYXNzKQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmxkLmdldERlY2xhcmVkVHlwZSgpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmbGQuZ2V0RWxlbWVudCgpLmdl\ndERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTUFQOgogICAgICAgICAgICAgICAgICAgIGlmIChrZXkpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiBmbGQuZ2V0S2V5KCkuZ2V0RGVjbGFy\nZWRUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZsZC5nZXRF\nbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlKCk7CiAgICAgICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmbGQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpOwog\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmxkLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGlmIChfY2xhc3MgIT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIF9jbGFzcy5nZXREZXNjcmliZWRUeXBlKCk7CiAgICAgICAg\ncmV0dXJuIE9iamVjdC5jbGFzczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRJbXBsaWNpdFR5cGUoQ2xhc3MgdHlwZSkgewogICAgICAgIF9jYXN0ID0g\ndHlwZTsKICAgIH0KCiAgICBwdWJsaWMgRXhwU3RhdGUgaW5pdGlhbGl6ZShT\nZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgaW50IGZsYWdzKSB7CiAgICAg\nICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IG5ldyBQYXRoRXhwU3RhdGUoc2Vs\nLm5ld0pvaW5zKCkpOwogICAgICAgIGJvb2xlYW4ga2V5ID0gZmFsc2U7CiAg\nICAgICAgYm9vbGVhbiBmb3JjZU91dGVyID0gZmFsc2U7CiAgICAgICAgQ2xh\nc3NNYXBwaW5nIHJlbCA9IF9jYW5kaWRhdGU7CgogICAgICAgIHNlbC5zZXRT\nY2hlbWFBbGlhcyhfc2NoZW1hQWxpYXMpOwoKICAgICAgICAvLyBpdGVyYXRl\nIHRvIHRoZSBmaW5hbCBmaWVsZAogICAgICAgIENsYXNzTWFwcGluZyBvd25l\ncjsKICAgICAgICBDbGFzc01hcHBpbmcgZnJvbSwgdG87CiAgICAgICAgQWN0\naW9uIGFjdGlvbjsKICAgICAgICBWYXJpYWJsZSB2YXI7CiAgICAgICAgSXRl\ncmF0b3IgaXRyID0gKF9hY3Rpb25zID09IG51bGwpID8gbnVsbCA6IF9hY3Rp\nb25zLml0ZXJhdG9yKCk7CiAgICAgICAgRmllbGRNYXBwaW5nIGZpZWxkID0g\nbnVsbDsKICAgICAgICBBY3Rpb24gcHJldmFjdGlvbiA9IG51bGw7CiAgICAg\nICAgYm9vbGVhbiBpc0NvcnJlbGF0ZWRQYXRoID0gZmFsc2U7CiAgICAgICAg\nYm9vbGVhbiBmcm9tUGFyZW50Um9vdEluU3Vic2VsZWN0ID0gbmF2aWdhdGVG\ncm9tUGFyZW50Um9vdEluU3Vic2VsZWN0KHNlbCk7CiAgICAgICAgICAgICAg\nICAKICAgICAgICB3aGlsZSAoaXRyICE9IG51bGwgJiYgaXRyLmhhc05leHQo\nKSkgewogICAgICAgICAgICBhY3Rpb24gPSAoQWN0aW9uKSBpdHIubmV4dCgp\nOwoKICAgICAgICAgICAgLy8gdHJlYXQgc3VicXVlcmllcyBsaWtlIHZhcmlh\nYmxlcyBmb3IgYWxpYXMgZ2VuZXJhdGlvbiBwdXJwb3NlcwogICAgICAgICAg\nICBpZiAoYWN0aW9uLm9wID09IEFjdGlvbi5WQVIpIHsKICAgICAgICAgICAg\nICAgIGlmIChzZWwuZ2V0UGFyZW50KCkgIT0gbnVsbCAmJiBhY3Rpb24udmFy\nICE9IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICBwcmV2YWN0aW9uICE9\nIG51bGwgJiYgcHJldmFjdGlvbi5kYXRhICE9IG51bGwgJiYKICAgICAgICAg\nICAgICAgICAgICBzZWwuY3R4KCkuZ2V0VmFyaWFibGUoYWN0aW9uLnZhcikg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlzQ29ycmVsYXRlZFBh\ndGggPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9\nIHBzdGF0ZS5qb2lucy5zZXRDb3JyZWxhdGVkVmFyaWFibGUoYWN0aW9uLnZh\ncik7CiAgICAgICAgICAgICAgICB9IGVsc2UgCiAgICAgICAgICAgICAgICAg\nICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNldFZhcmlhYmxlKChT\ndHJpbmcpIGFjdGlvbi5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlNVQlFVRVJZKSB7CiAg\nICAgICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0\nU3Vic2VsZWN0KChTdHJpbmcpIGFjdGlvbi5kYXRhKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24ub3AgPT0gQWN0aW9uLlVO\nQk9VTkRfVkFSKSB7CiAgICAgICAgICAgICAgICAvLyB1bmJvdW5kIHZhcnMg\nYXJlIGNyb3NzLWpvaW5lZCB0byB0aGUgY2FuZGlkYXRlIHRhYmxlCiAgICAg\nICAgICAgICAgICB2YXIgPSAoVmFyaWFibGUpIGFjdGlvbi5kYXRhOwogICAg\nICAgICAgICAgICAgcmVsID0gKENsYXNzTWFwcGluZykgdmFyLmdldE1ldGFE\nYXRhKCk7CiAgICAgICAgICAgICAgICBpZiAocmVsID09IG51bGwpCiAgICAg\nICAgICAgICAgICAJdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbihfbG9jLmdldCgKICAgICAgICAgICAgICAgIAkgICAgImludmFsaWQtdW5i\nb3VuZC12YXIiLCB2YXIuZ2V0TmFtZSgpKS50b1N0cmluZygpKTsKICAgICAg\nICAgICAgICAgIAkgICAgCiAgICAgICAgICAgICAgICBpZiAoc2VsLmdldFBh\ncmVudCgpICE9IG51bGwgJiYgYWN0aW9uLnZhciAhPSBudWxsICYmCiAgICAg\nICAgICAgICAgICAgICAgc2VsLmN0eCgpLmdldFZhcmlhYmxlKGFjdGlvbi52\nYXIpID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvL1N5c3RlbS5v\ndXQucHJpbnRsbigiQ29ycmVsYXRlZCBhY3Rpb24gdmFyPSIrYWN0aW9uLnZh\ncik7CiAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWxhdGVkUGF0aCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRl\nLmpvaW5zLnNldENvcnJlbGF0ZWRWYXJpYWJsZSh2YXIuZ2V0TmFtZSgpKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSAgICAgICAgICAgICAgICAgCiAgICAg\nICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zID0gcHN0YXRlLmpvaW5zLnNl\ndFZhcmlhYmxlKHZhci5nZXROYW1lKCkpOwoKICAgICAgICAgICAgICAgIHBz\ndGF0ZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5jcm9zc0pvaW4oX2NhbmRpZGF0\nZS5nZXRUYWJsZSgpLAogICAgICAgICAgICAgICAgICAgIHJlbC5nZXRUYWJs\nZSgpKTsKICAgICAgICAgICAgICAgIGlmICghaXRyLmhhc05leHQoKSAmJiBp\nc1ZhcmlhYmxlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjaGVja09iamVj\ndFBhdGhJbmhlcml0YW5jZVR5cGVKb2luZWQocHN0YXRlKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIC8vIG1vdmUgcGFzdCB0aGUgcHJldmlvdXMgZmllbGQsIGlmIGFueQogICAg\nICAgICAgICAgICAgZmllbGQgPSAoRmllbGRNYXBwaW5nKSAoKGFjdGlvbi5v\ncCA9PSBBY3Rpb24uR0VUX1hQQVRIKSA/CiAgICAgICAgICAgICAgICAgICAg\nX3htbGZpZWxkIDogYWN0aW9uLmRhdGEpOwoKICAgICAgICAgICAgICAgIGlm\nIChwc3RhdGUuZmllbGQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIC8vIGlmIHRoaXMgaXMgdGhlIHNlY29uZC10by1sYXN0IGZpZWxkIGFuZCB0\naGUgbGFzdCBpcwogICAgICAgICAgICAgICAgICAgIC8vIHRoZSByZWxhdGVk\nIGZpZWxkIHRoaXMgZmllbGQgam9pbnMgdG8sIG5vIG5lZWQgdG8KICAgICAg\nICAgICAgICAgICAgICAvLyB0cmF2ZXJzZToganVzdCB1c2UgdGhpcyBmaWVs\nZCdzIGZrIGNvbHVtbnMKICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ci5o\nYXNOZXh0KCkgJiYgKGZsYWdzICYgSk9JTl9SRUwpID09IDAKICAgICAgICAg\nICAgICAgICAgICAgICAgJiYgaXNKb2luZWRGaWVsZChwc3RhdGUuZmllbGQs\nIGtleSwgZmllbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0\nZS5jbXBmaWVsZCA9IGZpZWxkOwogICAgICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyb21QYXJlbnRSb290SW5T\ndWJzZWxlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWxh\ndGVkUGF0aCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHBzdGF0\nZS5qb2lucyA9IHBzdGF0ZS5qb2lucy5zZXRDb3JyZWxhdGVkVmFyaWFibGUo\nX3NjaGVtYUFsaWFzKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHN0YXRl\nLmpvaW5zLnNldEpvaW5Db250ZXh0KG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAg\nICByZWwgPSB0cmF2ZXJzZUZpZWxkKHBzdGF0ZSwga2V5LCBmb3JjZU91dGVy\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nLy8gbWFyayBpZiB0aGUgbmV4dCB0cmF2ZXJzYWwgc2hvdWxkIGdvIHRocm91\nZ2gKICAgICAgICAgICAgICAgIC8vIHRoZSBrZXkgcmF0aGVyIHRoYW4gdmFs\ndWUKICAgICAgICAgICAgICAgIGtleSA9IGFjdGlvbi5vcCA9PSBBY3Rpb24u\nR0VUX0tFWTsKICAgICAgICAgICAgICAgIGZvcmNlT3V0ZXIgfD0gYWN0aW9u\nLm9wID09IEFjdGlvbi5HRVRfT1VURVI7CiAgICAgICAgICAgICAgICAKICAg\nICAgICAgICAgICAgIGlmIChrZXkgJiYgaXRyLmhhc05leHQoKSkKICAgICAg\nICAgICAgICAgICAgICBfa2V5UGF0aCA9IHRydWU7CgogICAgICAgICAgICAg\nICAgLy8gZ2V0IG1hcHBpbmcgZm9yIHRoZSBjdXJyZW50IGZpZWxkCiAgICAg\nICAgICAgICAgICBwc3RhdGUuZmllbGQgPSBmaWVsZDsKCiAgICAgICAgICAg\nICAgICBvd25lciA9IHBzdGF0ZS5maWVsZC5nZXREZWZpbmluZ01hcHBpbmco\nKTsKICAgICAgICAgICAgICAgIGlmIChwc3RhdGUuZmllbGQuZ2V0TWFuYWdl\nbWVudCgpIAogICAgICAgICAgICAgICAgICAgICE9IEZpZWxkTWFwcGluZy5N\nQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm9uLXBlcnMtZmllbGQiLCAK\nICAgICAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmZpZWxkKSk7CgogICAg\nICAgICAgICAgICAgLy8gZmluZCB0aGUgbW9zdC1kZXJpdmVkIHR5cGUgYmV0\nd2VlbiB0aGUgZGVjbGFyZWQgcmVsYXRpb24KICAgICAgICAgICAgICAgIC8v\nIHR5cGUgYW5kIHRoZSBmaWVsZCdzIG93bmVyLCBhbmQgam9pbiBmcm9tIHRo\nYXQgdHlwZSB0bwogICAgICAgICAgICAgICAgLy8gdGhlIGxlc3NlciBkZXJp\ndmVkIHR5cGUKICAgICAgICAgICAgICAgIGlmIChyZWwgIT0gb3duZXIgJiYg\ncmVsICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVsLmdl\ndERlc2NyaWJlZFR5cGUoKS5pc0Fzc2lnbmFibGVGcm9tCiAgICAgICAgICAg\nICAgICAgICAgICAgIChvd25lci5nZXREZXNjcmliZWRUeXBlKCkpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBvd25lcjsKICAgICAgICAg\nICAgICAgICAgICAgICAgdG8gPSByZWw7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHJlbDsK\nICAgICAgICAgICAgICAgICAgICAgICAgdG8gPSBvd25lcjsKICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZvciAoOyBmcm9t\nICE9IG51bGwgJiYgZnJvbSAhPSB0bzsKICAgICAgICAgICAgICAgICAgICAg\nICAgZnJvbSA9IGZyb20uZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5n\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAJRmllbGRNYXBwaW5nIGNhc3Qg\nPSBmcm9tLmdldEZpZWxkTWFwcGluZyhwc3RhdGUuZmllbGQKICAgICAgICAg\nICAgICAgICAgICAJCQkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAg\nICAJaWYgKGNhc3QgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAJCXBz\ndGF0ZS5maWVsZCA9IGNhc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIHBz\ndGF0ZS5qb2lucyA9IGZyb20uam9pblN1cGVyY2xhc3MocHN0YXRlLmpvaW5z\nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgLy8gbm90aGluZyBtb3JlIHRvIGRvIGZy\nb20gaGVyZSBvbiBhcyB3ZSBlbmNvdW50ZXJlZCBhbiB4cGF0aAogICAgICAg\nICAgICAgICAgLy8gYWN0aW9uCiAgICAgICAgICAgICAgICBpZiAoYWN0aW9u\nLm9wID09IEFjdGlvbi5HRVRfWFBBVEgpCiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJldmFjdGlvbiA9\nIGFjdGlvbjsKICAgICAgICAgICAgaWYgKHByZXZhY3Rpb24gIT0gbnVsbCAm\nJiBwcmV2YWN0aW9uLmNvbnRleHQgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgQ29udGV4dCBqQ3R4ID0gSkRCQ1N0b3JlUXVlcnkuZ2V0VGhyZWFkTG9j\nYWxDb250ZXh0KHByZXZhY3Rpb24uY29udGV4dCk7CiAgICAgICAgICAgICAg\nICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0Sm9pbkNvbnRleHQo\nakN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKF92\nYXJOYW1lICE9IG51bGwpCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyA9IHBz\ndGF0ZS5qb2lucy5zZXRWYXJpYWJsZShfdmFyTmFtZSk7CgogICAgICAgIC8v\nIGlmIHdlJ3JlIG5vdCBjb21wYXJpbmcgdG8gbnVsbCBvciBkb2luZyBhbiBp\nc0VtcHR5LCB0aGVuCiAgICAgICAgLy8gam9pbiBpbnRvIHRoZSBkYXRhIG9u\nIHRoZSBmaW5hbCBmaWVsZDsgb2J2aW91c2x5IHdlIGNhbid0IGRvIHRoZXNl\nCiAgICAgICAgLy8gam9pbnMgd2hlbiBjb21wYXJpbmcgdG8gbnVsbCBiL2Mg\ndGhlIHdob2xlIHB1cnBvc2UgaXMgdG8gc2VlCiAgICAgICAgLy8gd2hldGhl\nciB0aGUgam9pbnMgZXZlbiBleGlzdAogICAgICAgIGlmICgoZmxhZ3MgJiBO\nVUxMX0NNUCkgPT0gMCkKICAgICAgICAgICAgdHJhdmVyc2VGaWVsZChwc3Rh\ndGUsIGtleSwgZm9yY2VPdXRlciwgdHJ1ZSk7CiAgICAgICAgcHN0YXRlLmpv\naW5lZFJlbCA9IGZhbHNlOwogICAgICAgIGlmICgoZmxhZ3MgJiBKT0lOX1JF\nTCkgIT0gMCkKICAgICAgICAgICAgam9pblJlbGF0aW9uKHBzdGF0ZSwga2V5\nLCBmb3JjZU91dGVyIHx8IChmbGFncyAmIEZPUkNFX09VVEVSKSAhPSAwLAog\nICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgIGlmIChpc0NvcnJlbGF0\nZWRQYXRoKSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBq\nb2lucyB0aGF0IGJlbG9uZyB0byBwYXJlbnQKICAgICAgICAgICAgcHN0YXRl\nLmpvaW5zLm1vdmVKb2luc1RvUGFyZW50KCk7CiAgICAgICAgfQogICAgICAg\nIHBzdGF0ZS5qb2lucy5zZXRKb2luQ29udGV4dChudWxsKTsKICAgICAgICAK\nICAgICAgICBpZiAoX2FjdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICBT\ndHJpbmcgc3VicUFsaWFzID0gZmluZFN1YnFBbGlhcyhzZWwpOwogICAgICAg\nICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuam9pbnMuc2V0U3Vic2VsZWN0\nKHN1YnFBbGlhcyk7CiAgICAgICAgICAgIHBzdGF0ZS5qb2lucy5zZXRDb3Jy\nZWxhdGVkVmFyaWFibGUoX3NjaGVtYUFsaWFzKTsKICAgICAgICAgICAgY2hl\nY2tPYmplY3RQYXRoSW5oZXJpdGFuY2VUeXBlSm9pbmVkKHBzdGF0ZSk7CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBwc3RhdGU7CiAgICB9\nCiAgICAKICAgIHByaXZhdGUgU3RyaW5nIGZpbmRTdWJxQWxpYXMoU2VsZWN0\nIHNlbCkgewogICAgICAgIFNlbGVjdCBwU2VsID0gc2VsLmdldFBhcmVudCgp\nOwogICAgICAgIGlmIChwU2VsID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIENvbnRleHQgcEN0eCA9IHBTZWwuY3R4KCk7CiAg\nICAgICAgaWYgKHBDdHguc3VicXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgaWYgKHBDdHguZ2V0U2NoZW1hKF9zY2hl\nbWFBbGlhcykgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuICgoU3ViUSlw\nQ3R4LnN1YnF1ZXJ5KS5nZXRDYW5kaWRhdGVBbGlhcygpOwogICAgICAgIHJl\ndHVybiBmaW5kU3VicUFsaWFzKHBTZWwpOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hlbiBhIFBDUGF0aCBpcyBpbiBzdWJzZWxlY3QsIGFuZCBpdCBpcyBz\naW1wbHkgYSBuYXZpZ2F0aW9uCiAgICAgKiBmcm9tIHRoZSBwYXJlbnQgcm9v\ndCwgdGhlIGpvaW5zIGludm9sdmVkIGluIHRoaXMgUENQYXRoCiAgICAgKiBt\ndXN0IGhhcHBlbiBpbiB0aGUgbWFpbiBzZWxlY3QuICAKICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIG5hdmlnYXRlRnJvbVBhcmVudFJvb3RJblN1YnNl\nbGVjdChTZWxlY3Qgc2VsKSB7CiAgICAgICAgaWYgKHNlbC5nZXRQYXJlbnQo\nKSA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nSXRlcmF0b3IgaXRyID0gKF9hY3Rpb25zID09IG51bGwpID8gbnVsbCA6IF9h\nY3Rpb25zLml0ZXJhdG9yKCk7CgogICAgICAgIGJvb2xlYW4gaGFzVmFyID0g\nZmFsc2U7CiAgICAgICAgYm9vbGVhbiBzdGFydHNXaXRoU3VicXVlcnkgPSBm\nYWxzZTsKICAgICAgICB3aGlsZSAoaXRyICE9IG51bGwgJiYgaXRyLmhhc05l\neHQoKSkgewogICAgICAgICAgICBBY3Rpb24gYWN0aW9uID0gKEFjdGlvbikg\naXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGFjdGlvbi5vcCA9PSBBY3Rp\nb24uVkFSKSAKICAgICAgICAgICAgICAgIGhhc1ZhciA9IHRydWU7CiAgICAg\nICAgICAgIGVsc2UgaWYgKGFjdGlvbi5vcCA9PSBBY3Rpb24uU1VCUVVFUlkp\nCiAgICAgICAgICAgICAgICBzdGFydHNXaXRoU3VicXVlcnkgPSB0cnVlOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gIWhhc1ZhciAmJiAhc3RhcnRzV2l0\naFN1YnF1ZXJ5ICYmIHNlbC5jdHgoKS5nZXRTY2hlbWEoX3NjaGVtYUFsaWFz\nKSA9PSBudWxsOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFJldHVybiB3\naGV0aGVyIHRoZSBnaXZlbiBzb3VyY2UgZmllbGQgam9pbnMgdG8gdGhlIGdp\ndmVuIHRhcmdldCBmaWVsZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiBpc0pvaW5lZEZpZWxkKEZpZWxkTWFwcGluZyBzcmMsIGJvb2xl\nYW4ga2V5LCAKICAgICAgICBGaWVsZE1hcHBpbmcgdGFyZ2V0KSB7CiAgICAg\nICAgVmFsdWVNYXBwaW5nIHZtOwogICAgICAgIHN3aXRjaCAoc3JjLmdldFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJSQVk6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAg\nICAgICAgICAgICB2bSA9IHNyYy5nZXRFbGVtZW50TWFwcGluZygpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLk1BUDoKICAgICAgICAgICAgICAgIHZtID0gKGtleSkgPyBzcmMuZ2V0S2V5\nTWFwcGluZygpIDogc3JjLmdldEVsZW1lbnRNYXBwaW5nKCk7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHZtID0gc3JjOwogICAgICAgIH0KICAgICAgICBpZiAodm0uZ2V0\nSm9pbkRpcmVjdGlvbigpICE9IFZhbHVlTWFwcGluZy5KT0lOX0ZPUldBUkQp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBGb3JlaWduS2V5\nIGZrID0gdm0uZ2V0Rm9yZWlnbktleSgpOwogICAgICAgIGlmIChmayA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7IAogICAgICAgIAogICAg\nICAgIC8vIGZvcmVpZ24ga2V5IG11c3Qgam9pbiB0byB0YXJnZXQgY29sdW1u\ncwogICAgICAgIENvbHVtbltdIHJlbHMgPSBmay5nZXRDb2x1bW5zKCk7CiAg\nICAgICAgQ29sdW1uW10gcGtzID0gdGFyZ2V0LmdldENvbHVtbnMoKTsgCiAg\nICAgICAgaWYgKHJlbHMubGVuZ3RoICE9IHBrcy5sZW5ndGgpCiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHJlbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChmay5nZXRQcmlt\nYXJ5S2V5Q29sdW1uKHJlbHNbaV0pICE9IHBrc1tpXSkKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nICAgIAogICAgcHJvdGVjdGVkIE9iamVjdCBldmFsKE9iamVjdCBjYW5kaWRh\ndGUsIE9iamVjdCBvcmlnLAogICAgICAgIFN0b3JlQ29udGV4dCBjdHgsIE9i\namVjdFtdIHBhcmFtcykgewogICAgICAgIGlmIChfYWN0aW9ucyA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlOwoKICAgICAgICBBY3Rp\nb24gYWN0aW9uOwogICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc207CiAg\nICAgICAgQnJva2VyIHRtcEJyb2tlcjsKICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9hY3Rpb25zLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7\nCiAgICAgICAgICAgIGFjdGlvbiA9IChBY3Rpb24paXRyLm5leHQoKTsKICAg\nICAgICAgICAgc20gPSBudWxsOwogICAgICAgICAgICB0bXBCcm9rZXIgPSBu\ndWxsOwogICAgICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFibGUo\nY2FuZGlkYXRlKSkKICAgICAgICAgICAgICAgIHNtID0gKE9wZW5KUEFTdGF0\nZU1hbmFnZXIpIChJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKAog\nICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZSwgY3R4LmdldENvbmZpZ3Vy\nYXRpb24oKSkpLgogICAgICAgICAgICAgICAgICAgIHBjR2V0U3RhdGVNYW5h\nZ2VyKCk7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICB0bXBCcm9rZXIgPSBjdHguZ2V0QnJva2VyKCk7CiAgICAgICAg\nICAgICAgICB0bXBCcm9rZXIudHJhbnNhY3Rpb25hbChjYW5kaWRhdGUsIGZh\nbHNlLCBudWxsKTsKICAgICAgICAgICAgICAgIHNtID0gdG1wQnJva2VyLmdl\ndFN0YXRlTWFuYWdlcihjYW5kaWRhdGUpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChhY3Rpb24ub3AgIT0gQWN0aW9uLkdFVCAmJiBhY3Rpb24u\nb3AgIT0gQWN0aW9uLkdFVF9PVVRFUikKICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY2FuZGlk\nYXRlID0gc20uZmV0Y2hGaWVsZCgKICAgICAgICAgICAgICAgICAgICAgICAg\nKChGaWVsZE1hcHBpbmcpYWN0aW9uLmRhdGEpLmdldEluZGV4KCksIHRydWUp\nOwogICAgICAgICAgICB9IGNhdGNoIChDbGFzc0Nhc3RFeGNlcHRpb24gY2Nl\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlv\nbihhY3Rpb24uZGF0YSArICIgbm90IGEgZmllbGQgcGF0aCIpOwogICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgLy8gdHJhbnNhY3Rp\nb25hbCBkb2VzIG5vdCBjbGVhciB0aGUgc3RhdGUsIHdoaWNoIGlzCiAgICAg\nICAgICAgICAgICAvLyBpbXBvcnRhbnQgc2luY2UgdG1wQ2FuZGlkYXRlIG1p\nZ2h0IGJlIGFsc28gbWFuYWdlZCBieQogICAgICAgICAgICAgICAgLy8gYW5v\ndGhlciBicm9rZXIgaWYgaXQncyBhIHByb3hpZWQgbm9uLXBjIGluc3RhbmNl\nCiAgICAgICAgICAgICAgICBpZiAodG1wQnJva2VyICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgdG1wQnJva2VyLm5vbnRyYW5zYWN0aW9uYWwoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBjYW5kaWRhdGU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBFeHByZXNzaW9uIHN0YXRlLgogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGNsYXNzIFBhdGhFeHBTdGF0ZQogICAgICAgIGV4dGVuZHMg\nRXhwU3RhdGUgewoKICAgICAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGZpZWxk\nID0gbnVsbDsKICAgICAgICBwdWJsaWMgRmllbGRNYXBwaW5nIGNtcGZpZWxk\nID0gbnVsbDsKICAgICAgICBwdWJsaWMgQ29sdW1uW10gY29scyA9IG51bGw7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gam9pbmVkUmVsID0gZmFsc2U7CiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaXNFbWJlZEVsZW1lbnRDb2xsID0gZmFs\nc2U7CiAgICAgICAgCiAgICAgICAgcHVibGljIFBhdGhFeHBTdGF0ZShKb2lu\ncyBqb2lucykgewogICAgICAgICAgICBzdXBlcihqb2lucyk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVHJhdmVyc2UgaW50byB0aGUgcHJl\ndmlvdXMgZmllbGQgb2YgYSByZWxhdGlvbiBwYXRoLgogICAgICoKICAgICAq\nIEBwYXJhbSBsYXN0IHdoZXRoZXIgdGhpcyBpcyB0aGUgbGFzdCBmaWVsZCBp\nbiB0aGUgcGF0aAogICAgICogQHJldHVybiB0aGUgbWFwcGluZyBvZiB0aGUg\ncmVsYXRlZCB0eXBlLCBvciBudWxsCiAgICAgKi8KICAgIHByaXZhdGUgQ2xh\nc3NNYXBwaW5nIHRyYXZlcnNlRmllbGQoUGF0aEV4cFN0YXRlIHBzdGF0ZSwg\nYm9vbGVhbiBrZXksIAogICAgICAgIGJvb2xlYW4gZm9yY2VPdXRlciwgYm9v\nbGVhbiBsYXN0KSB7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxs\nKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgLy8gdHJhdmVy\nc2UgaW50byBmaWVsZCB2YWx1ZQogICAgICAgIGlmIChrZXkpCiAgICAgICAg\nICAgIHBzdGF0ZS5qb2lucyA9IHBzdGF0ZS5maWVsZC5qb2luS2V5KHBzdGF0\nZS5qb2lucywgZm9yY2VPdXRlcik7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pbihwc3RhdGUuam9p\nbnMsIGZvcmNlT3V0ZXIpOwoKICAgICAgICAvLyBpZiB0aGlzIGlzbid0IHRo\nZSBsYXN0IGZpZWxkLCB0cmF2ZXJzZSBpbnRvIHRoZSByZWxhdGlvbgogICAg\nICAgIGlmICghbGFzdCkKICAgICAgICAgICAgam9pblJlbGF0aW9uKHBzdGF0\nZSwga2V5LCBmb3JjZU91dGVyLCB0cnVlKTsKCiAgICAgICAgLy8gcmV0dXJu\nIHRoZSBtYXBpbmcgb2YgdGhlIHJlbGF0ZWQgdHlwZSwgaWYgYW55CiAgICAg\nICAgaWYgKGtleSkKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5n\nZXRLZXlNYXBwaW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBpZiAo\ncHN0YXRlLmZpZWxkLmdldEVsZW1lbnQoKS5nZXRUeXBlQ29kZSgpID09IEph\ndmFUeXBlcy5QQykKICAgICAgICAgICAgcmV0dXJuIHBzdGF0ZS5maWVsZC5n\nZXRFbGVtZW50TWFwcGluZygpLmdldFR5cGVNYXBwaW5nKCk7CiAgICAgICAg\ncmV0dXJuIHBzdGF0ZS5maWVsZC5nZXRUeXBlTWFwcGluZygpOwogICAgfQoK\nICAgIC8qKgogICAgICogSm9pbiBpbnRvIHRoZSByZWxhdGlvbiByZXByZXNl\nbnRlZCBieSB0aGUgY3VycmVudCBmaWVsZCwgaWYgYW55LgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgam9pblJlbGF0aW9uKFBhdGhFeHBTdGF0ZSBwc3Rh\ndGUsIGJvb2xlYW4ga2V5LCAKICAgICAgICBib29sZWFuIGZvcmNlT3V0ZXIs\nIGJvb2xlYW4gdHJhdmVyc2UpIHsKICAgICAgICBpZiAocHN0YXRlLmZpZWxk\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoa2V5\nKQogICAgICAgICAgICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9p\nbktleVJlbGF0aW9uKHBzdGF0ZS5qb2lucywgCiAgICAgICAgICAgICAgICBm\nb3JjZU91dGVyLCB0cmF2ZXJzZSk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBwc3RhdGUuam9pbnMgPSBwc3RhdGUuZmllbGQuam9pblJlbGF0aW9uKHBz\ndGF0ZS5qb2lucywgZm9yY2VPdXRlciwKICAgICAgICAgICAgICAgIHRyYXZl\ncnNlKTsKICAgICAgICBwc3RhdGUuam9pbmVkUmVsID0gdHJ1ZTsKICAgIH0K\nCiAgICBwdWJsaWMgT2JqZWN0IHRvRGF0YVN0b3JlVmFsdWUoU2VsZWN0IHNl\nbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBP\nYmplY3QgdmFsKSB7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBzdGF0ZSA9IChQ\nYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIEZpZWxkTWFwcGluZyBmaWVs\nZCA9IChwc3RhdGUuY21wZmllbGQgIT0gbnVsbCkgPyBwc3RhdGUuY21wZmll\nbGQgCiAgICAgICAgICAgIDogcHN0YXRlLmZpZWxkOwogICAgICAgIGlmIChp\nc1hQYXRoKCkpCiAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgaWYg\nKGZpZWxkICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9rZXkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gZmllbGQudG9LZXlEYXRhU3RvcmVWYWx1ZSh2\nYWwsIGN0eC5zdG9yZSk7CiAgICAgICAgICAgIGlmIChmaWVsZC5nZXRFbGVt\nZW50KCkuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpICE9IEphdmFUeXBlcy5PQkpF\nQ1QpCiAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQudG9EYXRhU3RvcmVW\nYWx1ZSh2YWwsIGN0eC5zdG9yZSk7CgogICAgICAgICAgICB2YWwgPSBmaWVs\nZC5nZXRFeHRlcm5hbFZhbHVlKHZhbCwgY3R4LnN0b3JlLmdldENvbnRleHQo\nKSk7CiAgICAgICAgICAgIHJldHVybiBmaWVsZC50b0RhdGFTdG9yZVZhbHVl\nKHZhbCwgY3R4LnN0b3JlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9j\nbGFzcy50b0RhdGFTdG9yZVZhbHVlKHZhbCwgX2NsYXNzLmdldFByaW1hcnlL\nZXlDb2x1bW5zKCksCiAgICAgICAgICAgIGN0eC5zdG9yZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc2VsZWN0KFNlbGVjdCBzZWwsIEV4cENvbnRleHQg\nY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAgYm9vbGVhbiBwa3MpIHsK\nICAgICAgICBzZWxlY3RDb2x1bW5zKHNlbCwgY3R4LCBzdGF0ZSwgcGtzKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3RDb2x1bW5zKFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nYm9vbGVhbiBwa3MpIHsKICAgICAgICBzZWwuc2V0U2NoZW1hQWxpYXMoX3Nj\naGVtYUFsaWFzKTsKICAgICAgICBDbGFzc01hcHBpbmcgbWFwcGluZyA9IGdl\ndENsYXNzTWFwcGluZyhzdGF0ZSk7CiAgICAgICAgUGF0aEV4cFN0YXRlIHBz\ndGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlmIChfdHlw\nZSAhPSBPQkpFQ1RfUEFUSCAmJiAobWFwcGluZyA9PSBudWxsIHx8ICFwc3Rh\ndGUuam9pbmVkUmVsIHx8CiAgICAgICAgICAgIHBzdGF0ZS5pc0VtYmVkRWxl\nbWVudENvbGwpKQogICAgICAgICAgICBzZWwuc2VsZWN0KGdldENvbHVtbnMo\nc3RhdGUpLCBwc3RhdGUuam9pbnMpOwogICAgICAgIGVsc2UgaWYgKF9rZXkg\nJiYgcHN0YXRlLmZpZWxkLmdldEtleSgpLmlzRW1iZWRkZWQoKSkKICAgICAg\nICAgICAgc2VsZWN0RW1iZWRkZWRNYXBLZXkoc2VsLCBjdHgsIHN0YXRlKTsK\nICAgICAgICBlbHNlIGlmIChwa3MpCiAgICAgICAgICAgIHNlbC5zZWxlY3Qo\nbWFwcGluZy5nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBwc3RhdGUuam9pbnMp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBzZWxlY3QgdGhlIG1h\ncHBpbmc7IGFsbG93IGFueSBzdWJzIGJlY2F1c2Ugd2Uga25vdyB0aGlzIG11\nc3QKICAgICAgICAgICAgLy8gYmUgZWl0aGVyIGEgcmVsYXRpb24sIGluIHdo\naWNoIGNhc2UgaXQgd2lsbCBhbHJlYWR5IGJlCiAgICAgICAgICAgIC8vIGNv\nbnN0cmFpbmVkIGJ5IHRoZSBqb2lucywgb3IgJ3RoaXMnLCBpbiB3aGljaCBj\nYXNlIHRoZQogICAgICAgICAgICAvLyBKREJDRXhwcmVzc2lvbkZhY3Rvcnkg\ndGFrZXMgY2FyZSBvZiBhZGRpbmcgY2xhc3MgY29uZGl0aW9ucyBmb3IKICAg\nICAgICAgICAgLy8gdGhlIGNhbmRpZGF0ZSBjbGFzcyBvbiB0aGUgc2VsZWN0\nCiAgICAgICAgICAgIGludCBzdWJzID0gKF90eXBlID09IFVOQk9VTkRfVkFS\nKSA/IFNlbGVjdC5TVUJTX0pPSU5BQkxFCiAgICAgICAgICAgICAgICA6IFNl\nbGVjdC5TVUJTX0FOWV9KT0lOQUJMRTsKICAgICAgICAgICAgc2VsLnNlbGVj\ndChtYXBwaW5nLCBzdWJzLCBjdHguc3RvcmUsIGN0eC5mZXRjaCwKICAgICAg\nICAgICAgICAgIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24uRUFHRVJfTk9ORSwg\nc2VsLm91dGVyKHBzdGF0ZS5qb2lucykpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBncm91cEJ5KFNlbGVjdCBzZWwsIEV4cENvbnRleHQg\nY3R4LCBFeHBTdGF0ZSBzdGF0ZSkgewogICAgICAgIENsYXNzTWFwcGluZyBt\nYXBwaW5nID0gZ2V0Q2xhc3NNYXBwaW5nKHN0YXRlKTsKICAgICAgICBQYXRo\nRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAg\nICAgaWYgKG1hcHBpbmcgPT0gbnVsbCB8fCAhcHN0YXRlLmpvaW5lZFJlbCkK\nICAgICAgICAgICAgc2VsLmdyb3VwQnkoZ2V0Q29sdW1ucyhzdGF0ZSksIHNl\nbC5vdXRlcihwc3RhdGUuam9pbnMpKTsKICAgICAgICBlbHNlIHsKICAgICAg\nICAgICAgaW50IHN1YnMgPSAoX3R5cGUgPT0gVU5CT1VORF9WQVIpID8gU2Vs\nZWN0LlNVQlNfSk9JTkFCTEUKICAgICAgICAgICAgICAgIDogU2VsZWN0LlNV\nQlNfQU5ZX0pPSU5BQkxFOwogICAgICAgICAgICBzZWwuZ3JvdXBCeShtYXBw\naW5nLCBzdWJzLCBjdHguc3RvcmUsIGN0eC5mZXRjaCwgCiAgICAgICAgICAg\nICAgICBzZWwub3V0ZXIocHN0YXRlLmpvaW5zKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIG9yZGVyQnkoU2VsZWN0IHNlbCwgRXhwQ29u\ndGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAgICBib29sZWFuIGFz\nYykgewogICAgICAgIHNlbC5vcmRlckJ5KGdldENvbHVtbnMoc3RhdGUpLCBh\nc2MsIHNlbC5vdXRlcihzdGF0ZS5qb2lucyksIGZhbHNlKTsKICAgIH0KCiAg\nICBwdWJsaWMgT2JqZWN0IGxvYWQoRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRl\nIHN0YXRlLCBSZXN1bHQgcmVzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBsb2FkKGN0eCwgc3RhdGUsIHJlcywgZmFs\nc2UpOwogICAgfQoKICAgIE9iamVjdCBsb2FkKEV4cENvbnRleHQgY3R4LCBF\neHBTdGF0ZSBzdGF0ZSwgUmVzdWx0IHJlcywgYm9vbGVhbiBwa3MpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcgPSBnZXRDbGFzc01hcHBpbmcoc3RhdGUpOwogICAgICAgIFBh\ndGhFeHBTdGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAg\nICAgICBpZiAobWFwcGluZyAhPSBudWxsICYmIChwc3RhdGUuZmllbGQgPT0g\nbnVsbCAKICAgICAgICAgICAgfHwgIXBzdGF0ZS5maWVsZC5pc0VtYmVkZGVk\nKCkpKSB7CiAgICAgICAgICAgIGlmIChwa3MpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gbWFwcGluZy5nZXRPYmplY3RJZChjdHguc3RvcmUsIHJlcywgbnVs\nbCwgdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zKTsK\nICAgICAgICAgICAgaWYgKF9rZXkgJiYgcHN0YXRlLmZpZWxkLmdldEtleSgp\nLmlzRW1iZWRkZWQoKSkKICAgICAgICAgICAgICAgIHJldHVybiBsb2FkRW1i\nZWRkZWRNYXBLZXkoY3R4LCBzdGF0ZSwgcmVzKTsKICAgICAgICAgICAgaWYg\nKHBzdGF0ZS5pc0VtYmVkRWxlbWVudENvbGwpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gcHN0YXRlLmZpZWxkLmxvYWRQcm9qZWN0aW9uKGN0eC5zdG9yZSwg\nY3R4LmZldGNoLCByZXMsCiAgICAgICAgICAgICAgICAgICAgcHN0YXRlLmpv\naW5zKTsKICAgICAgICAgICAgcmV0dXJuIHJlcy5sb2FkKG1hcHBpbmcsIGN0\neC5zdG9yZSwgY3R4LmZldGNoLCBwc3RhdGUuam9pbnMpOwogICAgICAgIH0K\nCiAgICAgICAgT2JqZWN0IHJldDsKICAgICAgICBpZiAoX2tleSkKICAgICAg\nICAgICAgLy8gTWFwIGtleSBpcyBhIGphdmEgcHJpbWl0aXZlIHR5cGUKICAg\nICAgICAgICAgLy8gICAgZXhhbXBsZTogTWFwPEludGVnZXIsIEVtcGxveWVl\nPiBlbXBzCiAgICAgICAgICAgIHJldCA9IHJlcy5nZXRPYmplY3QocHN0YXRl\nLmNvbHNbMF0sCiAgICAgICAgICAgICAgICBudWxsLCBwc3RhdGUuam9pbnMp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0ID0gcHN0YXRlLmZpZWxk\nLmxvYWRQcm9qZWN0aW9uKGN0eC5zdG9yZSwgY3R4LmZldGNoLCByZXMsIAog\nICAgICAgICAgICAgICAgcHN0YXRlLmpvaW5zKTsKICAgICAgICBpZiAoX2Nh\nc3QgIT0gbnVsbCkKICAgICAgICAgICAgcmV0ID0gRmlsdGVycy5jb252ZXJ0\nKHJldCwgX2Nhc3QpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIHZhbGlkYXRlTWFwU3RyYXRlZ3koU3RyYXRlZ3kgc3Ry\nYXRlZ3kpIHsKICAgICAgICBpZiAoc3RyYXRlZ3kgPT0gbnVsbCB8fAogICAg\nICAgICAgICAhKHN0cmF0ZWd5IGluc3RhbmNlb2YgTFJTTWFwRmllbGRTdHJh\ndGVneSkpCiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9u\nKCJJbnZhbGlkIG1hcCBmaWVsZCBzdHJhdGVneToiK3N0cmF0ZWd5KTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgc2VsZWN0RW1iZWRkZWRNYXBLZXkoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsCiAgICAgICAgRXhwU3RhdGUgc3Rh\ndGUpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBT\ndGF0ZSkgc3RhdGU7CiAgICAgICAgdmFsaWRhdGVNYXBTdHJhdGVneShwc3Rh\ndGUuZmllbGQuZ2V0U3RyYXRlZ3koKSk7CiAgICAgICAgTFJTTWFwRmllbGRT\ndHJhdGVneSBzdHJhdGVneSA9IChMUlNNYXBGaWVsZFN0cmF0ZWd5KQogICAg\nICAgICAgICBwc3RhdGUuZmllbGQuZ2V0U3RyYXRlZ3koKTsKICAgICAgICBD\nbGFzc01hcHBpbmcgbWFwcGluZyA9IHBzdGF0ZS5maWVsZC5nZXRLZXlNYXBw\naW5nKCkuZ2V0VHlwZU1hcHBpbmcoKTsKICAgICAgICBzdHJhdGVneS5zZWxl\nY3RLZXkoc2VsLCBtYXBwaW5nLCBudWxsLCBjdHguc3RvcmUsIGN0eC5mZXRj\naCwKICAgICAgICAgICAgcHN0YXRlLmpvaW5zKTsKICAgIH0KCiAgICBwcml2\nYXRlIE9iamVjdCBsb2FkRW1iZWRkZWRNYXBLZXkoRXhwQ29udGV4dCBjdHgs\nIEV4cFN0YXRlIHN0YXRlLAogICAgICAgIFJlc3VsdCByZXMpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUgPSAo\nUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICB2YWxpZGF0ZU1hcFN0cmF0\nZWd5KHBzdGF0ZS5maWVsZC5nZXRTdHJhdGVneSgpKTsKICAgICAgICBMUlNN\nYXBGaWVsZFN0cmF0ZWd5IHN0cmF0ZWd5ID0KICAgICAgICAgICAgKExSU01h\ncEZpZWxkU3RyYXRlZ3kpIHBzdGF0ZS5maWVsZC5nZXRTdHJhdGVneSgpOwog\nICAgICAgIHJldHVybiBzdHJhdGVneS5sb2FkS2V5KG51bGwsIGN0eC5zdG9y\nZSwgY3R4LmZldGNoLCByZXMsCiAgICAgICAgICAgIHBzdGF0ZS5qb2lucyk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY2FsY3VsYXRlVmFsdWUoU2VsZWN0\nIHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlLCAKICAgICAg\nICBWYWwgb3RoZXIsIEV4cFN0YXRlIG90aGVyU3RhdGUpIHsKICAgICAgICAv\nLyB3ZSBkb24ndCBjcmVhdGUgdGhlIFNRTCBiL2MgaXQgZm9yY2VzIHRoZSBT\nZWxlY3QgdG8gY2FjaGUgYWxpYXNlcwogICAgICAgIC8vIGZvciB0aGUgdGFi\nbGVzIHdlIHVzZSwgYW5kIHRoZXNlIGFsaWFzZXMgbWlnaHQgbm90IGV2ZXIg\nYmUgdXNlZCBpZgogICAgICAgIC8vIHdlIGV2ZW50dWFsbHkgY2FsbCBhcHBl\nbmRJc0VtcHR5IG9yIGFwcGVuZElzTnVsbCByYXRoZXIgdGhhbiBhcHBlbmRU\nbwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHZlcmlmeUluZGV4ZWRGaWVsZCgp\nIHsKICAgICAgICBBY3Rpb24gbGFzdEFjdGlvbiA9IChBY3Rpb24pIGxhc3RG\naWVsZEFjdGlvbigpOwogICAgICAgIEZpZWxkTWFwcGluZyBmbSA9IChGaWVs\nZE1hcHBpbmcpIGxhc3RBY3Rpb24uZGF0YTsKICAgICAgICBpZiAoZm0uZ2V0\nT3JkZXJDb2x1bW4oKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibm8tb3JkZXItY29sdW1uIiwgZm0u\nZ2V0TmFtZSgpKSk7CiAgICB9CgogICAgcHVibGljIGludCBsZW5ndGgoU2Vs\nZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRlKSB7CiAg\nICAgICAgcmV0dXJuIGdldENvbHVtbnMoc3RhdGUpLmxlbmd0aDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRUbyhTZWxlY3Qgc2VsLCBFeHBDb250\nZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBz\ncWwpIHsKICAgICAgICBDb2x1bW5bXSBjb2xzID0gZ2V0Q29sdW1ucyhzdGF0\nZSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGFwcGVuZFRvKHNlbCwgc3RhdGUsIHNxbCwg\nY29sc1tpXSk7CiAgICAgICAgICAgIGlmIChpIDwgY29scy5sZW5ndGggLTEp\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIiwgIik7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRUbyhTZWxlY3Qgc2VsLCBF\neHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1\nZmZlciBzcWwsIGludCBpbmRleCkgewogICAgICAgIENvbHVtbiBjb2wgPSBn\nZXRDb2x1bW5zKHN0YXRlKVtpbmRleF07CiAgICAgICAgYXBwZW5kVG8oc2Vs\nLCBzdGF0ZSwgc3FsLCBjb2wpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9p\nZCBhcHBlbmRUbyhTZWxlY3Qgc2VsLCBFeHBTdGF0ZSBzdGF0ZSwgU1FMQnVm\nZmVyIHNxbCwgQ29sdW1uIGNvbCkgewogICAgICAgIGlmIChzZWwgIT0gbnVs\nbCkKICAgICAgICAgICAgc2VsLnNldFNjaGVtYUFsaWFzKF9zY2hlbWFBbGlh\ncyk7CgogICAgICAgIC8vIGlmIHNlbGVjdCBpcyBudWxsLCBpdCBtZWFucyB3\nZSBhcmUgbm90IGFsaWFzaW5nIGNvbHVtbnMKICAgICAgICAvLyAoZS5nLiwg\nZHVyaW5nIGEgYnVsayB1cGRhdGUpCiAgICAgICAgaWYgKHNlbCA9PSBudWxs\nKQogICAgICAgICAgICBzcWwuYXBwZW5kKGNvbC5nZXRJZGVudGlmaWVyKCkp\nOwogICAgICAgIGVsc2UgaWYgKF90eXBlID09IFhQQVRIKQogICAgICAgICAg\nICAvLyBpZiB0aGlzIGlzIGFuIHhwYXRoLCBhcHBlbmQgeHBhdGggc3RyaW5n\nCiAgICAgICAgICAgIHNxbC5hcHBlbmQoZ2V0WFBhdGgoKSk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5nZXRDb2x1bW5BbGlh\ncyhjb2wsIHN0YXRlLmpvaW5zKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nYXBwZW5kSXNFbXB0eShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhw\nU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAgICAg\nICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3RhdGU7\nCiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAgICAg\nICBzcWwuYXBwZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHBzdGF0ZS5maWVsZC5hcHBlbmRJc0VtcHR5KHNxbCwgc2VsLCBwc3RhdGUu\nam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZElzTm90RW1w\ndHkoU2VsZWN0IHNlbCwgRXhwQ29udGV4dCBjdHgsIEV4cFN0YXRlIHN0YXRl\nLCAKICAgICAgICBTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgUGF0aEV4cFN0\nYXRlIHBzdGF0ZSA9IChQYXRoRXhwU3RhdGUpIHN0YXRlOwogICAgICAgIGlm\nIChwc3RhdGUuZmllbGQgPT0gbnVsbCkKICAgICAgICAgICAgc3FsLmFwcGVu\nZChGQUxTRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmll\nbGQuYXBwZW5kSXNOb3RFbXB0eShzcWwsIHNlbCwgcHN0YXRlLmpvaW5zKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRJbmRleChTZWxlY3Qgc2Vs\nLCBFeHBDb250ZXh0IGN0eCwgRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNR\nTEJ1ZmZlciBzcWwpIHsKICAgICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0g\nKFBhdGhFeHBTdGF0ZSkgc3RhdGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVs\nZCA9PSBudWxsKQogICAgICAgICAgICBzcWwuYXBwZW5kKCIxIik7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmllbGQuYXBwZW5kSW5kZXgo\nc3FsLCBzZWwsIHBzdGF0ZS5qb2lucyk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgYXBwZW5kVHlwZShTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwgRXhw\nU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAgICAg\nICBEaXNjcmltaW5hdG9yIGRpc2MgPSBudWxsOwogICAgICAgIENsYXNzTWFw\ncGluZyBzdXAgPSBfY2xhc3M7CiAgICAgICAgd2hpbGUgKHN1cC5nZXRNYXBw\nZWRQQ1N1cGVyY2xhc3NNYXBwaW5nKCkgIT0gbnVsbCkKICAgICAgICAgICAg\nc3VwID0gc3VwLmdldE1hcHBlZFBDU3VwZXJjbGFzc01hcHBpbmcoKTsKCiAg\nICAgICAgZGlzYyA9IHN1cC5nZXREaXNjcmltaW5hdG9yKCk7CgogICAgICAg\nIENvbHVtbltdIGNvbHMgPSBudWxsOwogICAgICAgIGlmIChkaXNjICE9IG51\nbGwpCiAgICAgICAgICAgIGNvbHMgPSBkaXNjLmdldENvbHVtbnMoKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIGNvbHMgPSBnZXRDb2x1bW5zKHN0YXRl\nKTsKCiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCkgewogICAgICAgICAgICBz\ncWwuYXBwZW5kKCIxIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICBz\ncWwuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBzcWwuYXBwZW5kKHNlbC5n\nZXRDb2x1bW5BbGlhcyhjb2xzW2ldLCBzdGF0ZS5qb2lucykpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRTaXplKFNlbGVjdCBz\nZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0ZSwgCiAgICAgICAg\nU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBTdGF0ZSBwc3RhdGUg\nPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBpZiAocHN0YXRlLmZp\nZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBlbmQoIjEiKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRTaXpl\nKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGFwcGVuZElzTnVsbChTZWxlY3Qgc2VsLCBFeHBDb250ZXh0IGN0eCwg\nRXhwU3RhdGUgc3RhdGUsIAogICAgICAgIFNRTEJ1ZmZlciBzcWwpIHsKICAg\nICAgICBQYXRoRXhwU3RhdGUgcHN0YXRlID0gKFBhdGhFeHBTdGF0ZSkgc3Rh\ndGU7CiAgICAgICAgaWYgKHBzdGF0ZS5maWVsZCA9PSBudWxsKQogICAgICAg\nICAgICBzcWwuYXBwZW5kKEZBTFNFKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHBzdGF0ZS5maWVsZC5hcHBlbmRJc051bGwoc3FsLCBzZWwsIHBzdGF0\nZS5qb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgYXBwZW5kSXNOb3RO\ndWxsKFNlbGVjdCBzZWwsIEV4cENvbnRleHQgY3R4LCBFeHBTdGF0ZSBzdGF0\nZSwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCkgewogICAgICAgIFBhdGhFeHBT\ndGF0ZSBwc3RhdGUgPSAoUGF0aEV4cFN0YXRlKSBzdGF0ZTsKICAgICAgICBp\nZiAocHN0YXRlLmZpZWxkID09IG51bGwpCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoVFJVRSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwc3RhdGUuZmll\nbGQuYXBwZW5kSXNOb3ROdWxsKHNxbCwgc2VsLCBwc3RhdGUuam9pbnMpOwog\nICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N1YnF1ZXJ5UGF0aCgp\nIHsKICAgICAgICBpZiAoX2FjdGlvbnMgIT0gbnVsbCAmJiBfYWN0aW9ucy5z\naXplKCkgPT0gMSAmJiAKICAgICAgICAgICAoKEFjdGlvbilfYWN0aW9ucy5n\nZXQoMCkpLm9wID09IEFjdGlvbi5TVUJRVUVSWSkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1\nYmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgaWYgKF9hY3Rpb25zID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FuZGlkYXRlLmhhc2hDb2Rl\nKCk7CiAgICAgICAgcmV0dXJuIF9jYW5kaWRhdGUuaGFzaENvZGUoKSBeIF9h\nY3Rpb25zLmhhc2hDb2RlKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSB0\naGlzKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIShv\ndGhlciBpbnN0YW5jZW9mIFBDUGF0aCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICBQQ1BhdGggcGF0aCA9IChQQ1BhdGgpIG90aGVyOwog\nICAgICAgIHJldHVybiBPYmplY3RVdGlscy5lcXVhbHMoX2NhbmRpZGF0ZSwg\ncGF0aC5fY2FuZGlkYXRlKQogICAgICAgICAgICAmJiBPYmplY3RVdGlscy5l\ncXVhbHMoX2FjdGlvbnMsIHBhdGguX2FjdGlvbnMpOwogICAgfQogICAgCiAg\nICBwdWJsaWMgaW50IGdldElkKCkgewogICAgICAgIHJldHVybiBWYWwuVkFM\nOwogICAgfQoKCiAgICAvKioKICAgICAqIEhlbHBlciBjbGFzcyByZXByZXNl\nbnRpbmcgYW4gYWN0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBj\nbGFzcyBBY3Rpb24KICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZSB7\nCgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEdFVCA9IDA7CiAg\nICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgR0VUX09VVEVSID0gMTsK\nICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBHRVRfS0VZID0gMjsK\nICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBWQVIgPSAzOwogICAg\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNVQlFVRVJZID0gNDsKICAg\nICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBVTkJPVU5EX1ZBUiA9IDU7\nCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ0FTVCA9IDY7CiAg\nICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgR0VUX1hQQVRIID0gNzsK\nCiAgICAgICAgcHVibGljIGludCBvcCA9IC0xOwogICAgICAgIHB1YmxpYyBP\nYmplY3QgZGF0YSA9IG51bGw7CiAgICAgICAgcHVibGljIFN0cmluZyB2YXIg\nPSBudWxsOwogICAgICAgIHB1YmxpYyBDb250ZXh0IGNvbnRleHQgPSBudWxs\nOwoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAg\nICAgICByZXR1cm4gb3AgKyAifCIgKyBkYXRhOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgaWYgKGRh\ndGEgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBvcDsKICAgICAg\nICAgICAgcmV0dXJuIG9wIF4gZGF0YS5oYXNoQ29kZSgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gZXF1YWxzKE9iamVjdCBvdGhlcikg\newogICAgICAgICAgICBpZiAob3RoZXIgPT0gdGhpcykKICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBBY3Rpb24gYSA9IChBY3Rp\nb24pIG90aGVyOwogICAgICAgICAgICByZXR1cm4gb3AgPT0gYS5vcAogICAg\nICAgICAgICAgICAgJiYgT2JqZWN0VXRpbHMuZXF1YWxzKGRhdGEsIGEuZGF0\nYSk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

