{"sha":"d4303b3776d8179510edd95cefd24596c161d21c","node_id":"MDQ6QmxvYjIwNjM2NDpkNDMwM2IzNzc2ZDgxNzk1MTBlZGQ5NWNlZmQyNDU5NmMxNjFkMjFj","size":198867,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d4303b3776d8179510edd95cefd24596c161d21c","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uQnl0ZUFy\ncmF5SW5wdXRTdHJlYW07CmltcG9ydCBqYXZhLmlvLkNoYXJBcnJheVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlv\nLklucHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5SZWFkZXI7CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0\nIGphdmEuaW8uV3JpdGVyOwppbXBvcnQgamF2YS5tYXRoLkJpZ0RlY2ltYWw7\nCmltcG9ydCBqYXZhLm1hdGguQmlnSW50ZWdlcjsKaW1wb3J0IGphdmEuc3Fs\nLkFycmF5OwppbXBvcnQgamF2YS5zcWwuQmxvYjsKaW1wb3J0IGphdmEuc3Fs\nLkNsb2I7CmltcG9ydCBqYXZhLnNxbC5Db25uZWN0aW9uOwppbXBvcnQgamF2\nYS5zcWwuRGF0YWJhc2VNZXRhRGF0YTsKaW1wb3J0IGphdmEuc3FsLlByZXBh\ncmVkU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVmOwppbXBvcnQgamF2\nYS5zcWwuUmVzdWx0U2V0OwppbXBvcnQgamF2YS5zcWwuU1FMRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5zcWwuU1FMV2FybmluZzsKaW1wb3J0IGphdmEuc3Fs\nLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRpbWU7CmltcG9ydCBqYXZh\nLnNxbC5UaW1lc3RhbXA7CmltcG9ydCBqYXZhLnNxbC5UeXBlczsKaW1wb3J0\nIGphdmEudGV4dC5NZXNzYWdlRm9ybWF0OwppbXBvcnQgamF2YS51dGlsLkFy\ncmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5EYXRlOwppbXBvcnQgamF2YS51dGlsLkVudW1TZXQ7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtl\nZEhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5Mb2NhbGU7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKCmltcG9ydCBqYXZheC5zcWwuRGF0YVNvdXJjZTsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmNvbmYuSkRCQ0NvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlm\naWVyLkNvbHVtbkRlZklkZW50aWZpZXJSdWxlOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5Ob3JtYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRpZmllci5EQklkZW50aWZp\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVy\nLkRCSWRlbnRpZmllclJ1bGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllclV0aWw7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllci5E\nQklkZW50aWZpZXJUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLmV4cHMuRXhwQ29udGV4\ndDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5leHBz\nLkV4cFN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2Vy\nbmVsLmV4cHMuRmlsdGVyVmFsdWU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5rZXJuZWwuZXhwcy5OdWxsOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLmV4cHMuVmFsOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmpkYmMubWV0YS5DbGFzc01hcHBpbmc7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRhLkZpZWxkTWFwcGluZzsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2YVNRTFR5cGVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkNvbHVtbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5EYXRhU291\ncmNlRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLk5hbWVTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5zY2hlbWEuUHJpbWFyeUtleTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5qZGJjLnNjaGVtYS5TY2hlbWE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuU2NoZW1hR3JvdXA7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuVW5pcXVlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLkZvcmVpZ25LZXkuRktNYXBL\nZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0\nZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlNl\ncTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRo\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5jb25mLkNvbmZpZ3Vy\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuY29uZi5Db25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5pZGVu\ndGlmaWVyLklkZW50aWZpZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi5pZGVudGlmaWVyLklkZW50aWZpZXJSdWxlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5pZGVudGlmaWVyLklkZW50\naWZpZXJVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5qZGJj\nLkNvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEubGliLmpkYmMuTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmxvZy5Mb2c7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2llczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4Y2VwdGlvbkluZm87\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5lcmFsRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnZh\nbGlkU3RhdGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Mb2NrRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuT2JqZWN0RXhpc3RzRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3B0aW1pc3RpY0V4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlF1ZXJ5RXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUmVmZXJl\nbnRpYWxJbnRlZ3JpdHlFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5TZXJpYWxpemF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgppbXBvcnQg\nc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQ2xhc3Mgd2hpY2ggYWxsb3dz\nIHRoZSBjcmVhdGlvbiBvZiBTUUwgZHluYW1pY2FsbHksIGluIGEKICogZGF0\nYWJhc2UgYWdub3N0aWMgZmFzaGlvbi4gU3ViY2xhc3MgZm9yIHRoZSBudWFu\nY2VzIG9mIGRpZmZlcmVudCBkYXRhIHN0b3Jlcy4KICovCnB1YmxpYyBjbGFz\ncyBEQkRpY3Rpb25hcnkKICAgIGltcGxlbWVudHMgQ29uZmlndXJhYmxlLCBD\nb25uZWN0aW9uRGVjb3JhdG9yLCBKb2luU3ludGF4ZXMsCiAgICBMb2dnaW5n\nQ29ubmVjdGlvbkRlY29yYXRvci5TUUxXYXJuaW5nSGFuZGxlciwgSWRlbnRp\nZmllckNvbmZpZ3VyYXRpb24gewoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nU3RyaW5nIFZFTkRPUl9PVEhFUiA9ICJvdGhlciI7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIFN0cmluZyBWRU5ET1JfREFUQURJUkVDVCA9ICJkYXRhZGly\nZWN0IjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFf\nQ0FTRV9VUFBFUiA9IElkZW50aWZpZXJVdGlsLkNBU0VfVVBQRVI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9MT1dFUiA9\nIElkZW50aWZpZXJVdGlsLkNBU0VfTE9XRVI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTQ0hFTUFfQ0FTRV9QUkVTRVJWRSA9IElkZW50aWZp\nZXJVdGlsLkNBU0VfUFJFU0VSVkU7CgogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgQ09OU19OQU1FX0JFRk9SRSA9ICJiZWZvcmUiOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX01JRCA9ICJtaWQi\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OU19OQU1FX0FG\nVEVSID0gImFmdGVyIjsKICAgIAogICAgcHVibGljIGludCBibG9iQnVmZmVy\nU2l6ZSA9IDUwMDAwOwogICAgcHVibGljIGludCBjbG9iQnVmZmVyU2l6ZSA9\nIDUwMDAwOwoKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdF\nX1BPU1RfU0VMRUNUID0gMDsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFJBTkdFX1BSRV9ESVNUSU5DVCA9IDE7CiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIGludCBSQU5HRV9QT1NUX0RJU1RJTkNUID0gMjsKICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IFJBTkdFX1BPU1RfTE9DSyA9IDM7\nCgogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTkFOTyA9IDE7CiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBNSUNSTyA9IE5BTk8gKiAx\nMDAwOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgTUlMTEkgPSBN\nSUNSTyAqIDEwMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBD\nRU5USSA9IE1JTExJICogMTA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFs\nIGludCBERUNJID0gTUlMTEkgKiAxMDA7CiAgICBwcm90ZWN0ZWQgc3RhdGlj\nIGZpbmFsIGludCBTRUMgPSBNSUxMSSAqIDEwMDA7CgogICAgcHJvdGVjdGVk\nIHN0YXRpYyBmaW5hbCBpbnQgTkFNRV9BTlkgPSBEQklkZW50aWZpZXJVdGls\nLkFOWTsKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IE5BTUVfVEFC\nTEUgPSBEQklkZW50aWZpZXJVdGlsLlRBQkxFOwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgTkFNRV9TRVFVRU5DRSA9IERCSWRlbnRpZmllclV0\naWwuU0VRVUVOQ0U7CiAgICAKICAgIHByb3RlY3RlZCBzdGF0aWMgZmluYWwg\naW50IFVOTElNSVRFRCA9IC0xOwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5h\nbCBpbnQgTk9fQkFUQ0ggPSAwOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0cmluZyBaRVJPX0RBVEVfU1RSID0KICAgICAgICAiJyIgKyBuZXcgamF2\nYS5zcWwuRGF0ZSgwKSArICInIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0cmluZyBaRVJPX1RJTUVfU1RSID0gIiciICsgbmV3IFRpbWUoMCkgKyAi\nJyI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgWkVST19USU1F\nU1RBTVBfU1RSID0KICAgICAgICAiJyIgKyBuZXcgVGltZXN0YW1wKDApICsg\nIiciOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9j\nID0gTG9jYWxpemVyLmZvclBhY2thZ2UKICAgICAgICAoREJEaWN0aW9uYXJ5\nLmNsYXNzKTsKCiAgICAvLyBzY2hlbWEgZGF0YQogICAgcHVibGljIFN0cmlu\nZyBwbGF0Zm9ybSA9ICJHZW5lcmljIjsKICAgIHB1YmxpYyBTdHJpbmcgZHJp\ndmVyVmVuZG9yID0gbnVsbDsKICAgIHB1YmxpYyBib29sZWFuIGNyZWF0ZVBy\naW1hcnlLZXlzID0gdHJ1ZTsKICAgIHB1YmxpYyBTdHJpbmcgY29uc3RyYWlu\ndE5hbWVNb2RlID0gQ09OU19OQU1FX0JFRk9SRTsKICAgIHB1YmxpYyBpbnQg\nbWF4VGFibGVOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhD\nb2x1bW5OYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhDb25z\ndHJhaW50TmFtZUxlbmd0aCA9IDEyODsKICAgIHB1YmxpYyBpbnQgbWF4SW5k\nZXhOYW1lTGVuZ3RoID0gMTI4OwogICAgcHVibGljIGludCBtYXhJbmRleGVz\nUGVyVGFibGUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgIHB1YmxpYyBib29s\nZWFuIHN1cHBvcnRzRm9yZWlnbktleXMgPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNQYXJhbWV0ZXJJblNlbGVjdCA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c0ZvcmVpZ25LZXlzQ29tcG9zaXRlID0g\ndHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzVW5pcXVlQ29uc3Ry\nYWludHMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNEZWZl\ncnJlZENvbnN0cmFpbnRzID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzUmVzdHJpY3REZWxldGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNDYXNjYWRlRGVsZXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbERlbGV0ZUFjdGlvbiA9\nIHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0RlZmF1bHREZWxl\ndGVBY3Rpb24gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNS\nZXN0cmljdFVwZGF0ZUFjdGlvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzdXBwb3J0c0Nhc2NhZGVVcGRhdGVBY3Rpb24gPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNOdWxsVXBkYXRlQWN0aW9uID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzRGVmYXVsdFVwZGF0ZUFjdGlv\nbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0FsdGVyVGFi\nbGVXaXRoQWRkQ29sdW1uID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1\ncHBvcnRzQWx0ZXJUYWJsZVdpdGhEcm9wQ29sdW1uID0gdHJ1ZTsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzQ29tbWVudHMgPSBmYWxzZTsKICAgIHB1\nYmxpYyBCb29sZWFuIHN1cHBvcnRzR2V0R2VuZXJhdGVkS2V5cyA9IG51bGw7\nCiAgICBwdWJsaWMgU3RyaW5nIHJlc2VydmVkV29yZHMgPSBudWxsOwogICAg\ncHVibGljIFN0cmluZyBzeXN0ZW1TY2hlbWFzID0gbnVsbDsKICAgIHB1Ymxp\nYyBTdHJpbmcgc3lzdGVtVGFibGVzID0gbnVsbDsKICAgIHB1YmxpYyBTdHJp\nbmcgc2VsZWN0V29yZHMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBmaXhl\nZFNpemVUeXBlTmFtZXMgPSBudWxsOwogICAgcHVibGljIFN0cmluZyBzY2hl\nbWFDYXNlID0gU0NIRU1BX0NBU0VfVVBQRVI7CiAgICBwdWJsaWMgYm9vbGVh\nbiBzZXRTdHJpbmdSaWdodFRydW5jYXRpb25PbiA9IHRydWU7CgogICAgLy8g\nc3FsCiAgICBwdWJsaWMgU3RyaW5nIHZhbGlkYXRpb25TUUwgPSBudWxsOwog\nICAgcHVibGljIFN0cmluZyBjbG9zZVBvb2xTUUwgPSBudWxsOwogICAgcHVi\nbGljIFN0cmluZyBpbml0aWFsaXphdGlvblNRTCA9IG51bGw7CiAgICBwdWJs\naWMgaW50IGpvaW5TeW50YXggPSBTWU5UQVhfU1FMOTI7CiAgICBwdWJsaWMg\nU3RyaW5nIG91dGVySm9pbkNsYXVzZSA9ICJMRUZUIE9VVEVSIEpPSU4iOwog\nICAgcHVibGljIFN0cmluZyBpbm5lckpvaW5DbGF1c2UgPSAiSU5ORVIgSk9J\nTiI7CiAgICBwdWJsaWMgU3RyaW5nIGNyb3NzSm9pbkNsYXVzZSA9ICJDUk9T\nUyBKT0lOIjsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ29uZGl0aW9u\nRm9yQ3Jvc3NKb2luID0gZmFsc2U7CiAgICBwdWJsaWMgU3RyaW5nIGZvclVw\nZGF0ZUNsYXVzZSA9ICJGT1IgVVBEQVRFIjsKICAgIHB1YmxpYyBTdHJpbmcg\ndGFibGVGb3JVcGRhdGVDbGF1c2UgPSBudWxsOwogICAgcHVibGljIFN0cmlu\nZyBkaXN0aW5jdENvdW50Q29sdW1uU2VwYXJhdG9yID0gbnVsbDsKICAgIHB1\nYmxpYyBib29sZWFuIHN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhEaXN0aW5j\ndENsYXVzZSA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0xv\nY2tpbmdXaXRoTXVsdGlwbGVUYWJsZXMgPSB0cnVlOwogICAgcHVibGljIGJv\nb2xlYW4gc3VwcG9ydHNMb2NraW5nV2l0aE9yZGVyQ2xhdXNlID0gdHJ1ZTsK\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZ1dpdGhPdXRlckpv\naW4gPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNMb2NraW5n\nV2l0aElubmVySm9pbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBw\nb3J0c0xvY2tpbmdXaXRoU2VsZWN0UmFuZ2UgPSB0cnVlOwogICAgcHVibGlj\nIGJvb2xlYW4gc3VwcG9ydHNRdWVyeVRpbWVvdXQgPSB0cnVlOwogICAgcHVi\nbGljIGJvb2xlYW4gc2ltdWxhdGVMb2NraW5nID0gZmFsc2U7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c1N1YnNlbGVjdCA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiBzdXBwb3J0c0NvcnJlbGF0ZWRTdWJzZWxlY3QgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNIYXZpbmcgPSB0cnVlOwog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0g\nZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1NlbGVjdEVuZElu\nZGV4ID0gZmFsc2U7CiAgICBwdWJsaWMgaW50IHJhbmdlUG9zaXRpb24gPSBS\nQU5HRV9QT1NUX1NFTEVDVDsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVz\nQWxpYXNGb3JTdWJzZWxlY3QgPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFu\nIHJlcXVpcmVzVGFyZ2V0Rm9yRGVsZXRlID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBhbGxvd3NBbGlhc0luQnVsa0NsYXVzZSA9IHRydWU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBzdXBwb3J0c011bHRpcGxlTm9udHJhbnNhY3Rpb25h\nbFJlc3VsdFNldHMgPSB0cnVlOwogICAgcHVibGljIGJvb2xlYW4gcmVxdWly\nZXNTZWFyY2hTdHJpbmdFc2NhcGVGb3JMaWtlID0gdHJ1ZTsKICAgIHB1Ymxp\nYyBTdHJpbmcgc2VhcmNoU3RyaW5nRXNjYXBlID0gIlxcIjsKICAgIHB1Ymxp\nYyBib29sZWFuIHJlcXVpcmVzQ2FzdEZvck1hdGhGdW5jdGlvbnMgPSBmYWxz\nZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQ2FzdEZvckNvbXBhcmlz\nb25zID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c01vZE9w\nZXJhdG9yID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1hN\nTENvbHVtbiA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHND\nYXNlQ29udmVyc2lvbkZvckxvYiA9IGZhbHNlOwogICAgcHVibGljIGJvb2xl\nYW4gcmVwb3J0c1N1Y2Nlc3NOb0luZm9PbkJhdGNoVXBkYXRlcyA9IGZhbHNl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTZWxlY3RGcm9tRmluYWxU\nYWJsZSA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTaW1w\nbGVDYXNlRXhwcmVzc2lvbiA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0dlbmVyYWxDYXNlRXhwcmVzc2lvbiA9IHRydWU7CiAgICBwdWJs\naWMgYm9vbGVhbiB1c2VXaWxkQ2FyZEZvckNvdW50ID0gZmFsc2U7CiAgICAK\nICAgIC8qKgogICAgICogU29tZSBEYXRhYmFzZXMgYXBwZW5kIHdoaXRlc3Bh\nY2UgYWZ0ZXIgdGhlIHNjaGVtYSBuYW1lIAogICAgICovCiAgICBwdWJsaWMg\nYm9vbGVhbiB0cmltU2NoZW1hTmFtZSA9IGZhbHNlOwoKICAgIC8vIGZ1bmN0\naW9ucwogICAgcHVibGljIFN0cmluZyBjYXN0RnVuY3Rpb24gPSAiQ0FTVCh7\nMH0gQVMgezF9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvTG93ZXJDYXNlRnVu\nY3Rpb24gPSAiTE9XRVIoezB9KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRvVXBw\nZXJDYXNlRnVuY3Rpb24gPSAiVVBQRVIoezB9KSI7CiAgICBwdWJsaWMgU3Ry\naW5nIHN0cmluZ0xlbmd0aEZ1bmN0aW9uID0gIkNIQVJfTEVOR1RIKHswfSki\nOwogICAgcHVibGljIFN0cmluZyBiaXRMZW5ndGhGdW5jdGlvbiA9ICIoT0NU\nRVRfTEVOR1RIKHswfSkgKiA4KSI7CiAgICBwdWJsaWMgU3RyaW5nIHRyaW1M\nZWFkaW5nRnVuY3Rpb24gPSAiVFJJTShMRUFESU5HIHsxfSBGUk9NIHswfSki\nOwogICAgcHVibGljIFN0cmluZyB0cmltVHJhaWxpbmdGdW5jdGlvbiA9ICJU\nUklNKFRSQUlMSU5HIHsxfSBGUk9NIHswfSkiOwogICAgcHVibGljIFN0cmlu\nZyB0cmltQm90aEZ1bmN0aW9uID0gIlRSSU0oQk9USCB7MX0gRlJPTSB7MH0p\nIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVGdW5jdGlvbiA9ICIo\nezB9fHx7MX0pIjsKICAgIHB1YmxpYyBTdHJpbmcgY29uY2F0ZW5hdGVEZWxp\nbWl0ZXIgPSAiJ09QRU5KUEFUT0tFTiciOwogICAgcHVibGljIFN0cmluZyBz\ndWJzdHJpbmdGdW5jdGlvbk5hbWUgPSAiU1VCU1RSSU5HIjsKICAgIHB1Ymxp\nYyBTdHJpbmcgY3VycmVudERhdGVGdW5jdGlvbiA9ICJDVVJSRU5UX0RBVEUi\nOwogICAgcHVibGljIFN0cmluZyBjdXJyZW50VGltZUZ1bmN0aW9uID0gIkNV\nUlJFTlRfVElNRSI7CiAgICBwdWJsaWMgU3RyaW5nIGN1cnJlbnRUaW1lc3Rh\nbXBGdW5jdGlvbiA9ICJDVVJSRU5UX1RJTUVTVEFNUCI7CiAgICBwdWJsaWMg\nU3RyaW5nIGRyb3BUYWJsZVNRTCA9ICJEUk9QIFRBQkxFIHswfSI7CgogICAg\nLy8gdHlwZXMKICAgIHB1YmxpYyBib29sZWFuIHN0b3JhZ2VMaW1pdGF0aW9u\nc0ZhdGFsID0gZmFsc2U7CiAgICBwdWJsaWMgYm9vbGVhbiBzdG9yZUxhcmdl\nTnVtYmVyc0FzU3RyaW5ncyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4g\nc3RvcmVDaGFyc0FzTnVtYmVycyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVh\nbiB1c2VHZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMgYm9v\nbGVhbiB1c2VTZXRCeXRlc0ZvckJsb2JzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiB1c2VHZXRPYmplY3RGb3JCbG9icyA9IGZhbHNlOwogICAgcHVi\nbGljIGJvb2xlYW4gdXNlR2V0U3RyaW5nRm9yQ2xvYnMgPSBmYWxzZTsKICAg\nIHB1YmxpYyBib29sZWFuIHVzZVNldFN0cmluZ0ZvckNsb2JzID0gZmFsc2U7\nCiAgICBwdWJsaWMgaW50IG1heEVtYmVkZGVkQmxvYlNpemUgPSAtMTsKICAg\nIHB1YmxpYyBpbnQgbWF4RW1iZWRkZWRDbG9iU2l6ZSA9IC0xOwogICAgcHVi\nbGljIGludCBpbkNsYXVzZUxpbWl0ID0gLTE7CiAgICBwdWJsaWMgaW50IGRh\ndGVQcmVjaXNpb24gPSBNSUxMSTsKICAgIHB1YmxpYyBpbnQgY2hhcmFjdGVy\nQ29sdW1uU2l6ZSA9IDI1NTsKICAgIHB1YmxpYyBTdHJpbmcgYXJyYXlUeXBl\nTmFtZSA9ICJBUlJBWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpZ2ludFR5cGVO\nYW1lID0gIkJJR0lOVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJpbmFyeVR5cGVO\nYW1lID0gIkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGJpdFR5cGVOYW1l\nID0gIkJJVCI7CiAgICBwdWJsaWMgU3RyaW5nIGJsb2JUeXBlTmFtZSA9ICJC\nTE9CIjsKICAgIHB1YmxpYyBTdHJpbmcgYm9vbGVhblR5cGVOYW1lID0gIkJP\nT0xFQU4iOwogICAgcHVibGljIFN0cmluZyBjaGFyVHlwZU5hbWUgPSAiQ0hB\nUiI7CiAgICBwdWJsaWMgU3RyaW5nIGNsb2JUeXBlTmFtZSA9ICJDTE9CIjsK\nICAgIHB1YmxpYyBTdHJpbmcgZGF0ZVR5cGVOYW1lID0gIkRBVEUiOwogICAg\ncHVibGljIFN0cmluZyBkZWNpbWFsVHlwZU5hbWUgPSAiREVDSU1BTCI7CiAg\nICBwdWJsaWMgU3RyaW5nIGRpc3RpbmN0VHlwZU5hbWUgPSAiRElTVElOQ1Qi\nOwogICAgcHVibGljIFN0cmluZyBkb3VibGVUeXBlTmFtZSA9ICJET1VCTEUi\nOwogICAgcHVibGljIFN0cmluZyBmbG9hdFR5cGVOYW1lID0gIkZMT0FUIjsK\nICAgIHB1YmxpYyBTdHJpbmcgaW50ZWdlclR5cGVOYW1lID0gIklOVEVHRVIi\nOwogICAgcHVibGljIFN0cmluZyBqYXZhT2JqZWN0VHlwZU5hbWUgPSAiSkFW\nQV9PQkpFQ1QiOwogICAgcHVibGljIFN0cmluZyBsb25nVmFyYmluYXJ5VHlw\nZU5hbWUgPSAiTE9OR1ZBUkJJTkFSWSI7CiAgICBwdWJsaWMgU3RyaW5nIGxv\nbmdWYXJjaGFyVHlwZU5hbWUgPSAiTE9OR1ZBUkNIQVIiOwogICAgcHVibGlj\nIFN0cmluZyBudWxsVHlwZU5hbWUgPSAiTlVMTCI7CiAgICBwdWJsaWMgU3Ry\naW5nIG51bWVyaWNUeXBlTmFtZSA9ICJOVU1FUklDIjsKICAgIHB1YmxpYyBT\ndHJpbmcgb3RoZXJUeXBlTmFtZSA9ICJPVEhFUiI7CiAgICBwdWJsaWMgU3Ry\naW5nIHJlYWxUeXBlTmFtZSA9ICJSRUFMIjsKICAgIHB1YmxpYyBTdHJpbmcg\ncmVmVHlwZU5hbWUgPSAiUkVGIjsKICAgIHB1YmxpYyBTdHJpbmcgc21hbGxp\nbnRUeXBlTmFtZSA9ICJTTUFMTElOVCI7CiAgICBwdWJsaWMgU3RyaW5nIHN0\ncnVjdFR5cGVOYW1lID0gIlNUUlVDVCI7CiAgICBwdWJsaWMgU3RyaW5nIHRp\nbWVUeXBlTmFtZSA9ICJUSU1FIjsKICAgIHB1YmxpYyBTdHJpbmcgdGltZXN0\nYW1wVHlwZU5hbWUgPSAiVElNRVNUQU1QIjsKICAgIHB1YmxpYyBTdHJpbmcg\ndGlueWludFR5cGVOYW1lID0gIlRJTllJTlQiOwogICAgcHVibGljIFN0cmlu\nZyB2YXJiaW5hcnlUeXBlTmFtZSA9ICJWQVJCSU5BUlkiOwogICAgcHVibGlj\nIFN0cmluZyB2YXJjaGFyVHlwZU5hbWUgPSAiVkFSQ0hBUiI7CiAgICBwdWJs\naWMgU3RyaW5nIHhtbFR5cGVOYW1lID0gIlhNTCI7CiAgICBwdWJsaWMgU3Ry\naW5nIHhtbFR5cGVFbmNvZGluZyA9ICJVVEYtOCI7CiAgICBwdWJsaWMgU3Ry\naW5nIGdldFN0cmluZ1ZhbCA9ICIiOwoKICAgIC8vIHNjaGVtYSBtZXRhZGF0\nYQogICAgcHVibGljIGJvb2xlYW4gdXNlU2NoZW1hTmFtZSA9IHRydWU7CiAg\nICBwdWJsaWMgU3RyaW5nIHRhYmxlVHlwZXMgPSAiVEFCTEUiOwogICAgcHVi\nbGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRUYWJsZXMgPSB0cnVl\nOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNTY2hlbWFGb3JHZXRDb2x1\nbW5zID0gdHJ1ZTsKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzTnVsbFRh\nYmxlRm9yR2V0Q29sdW1ucyA9IHRydWU7CiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c051bGxUYWJsZUZvckdldFByaW1hcnlLZXlzID0gZmFsc2U7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4\nSW5mbyA9IGZhbHNlOwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNOdWxs\nVGFibGVGb3JHZXRJbXBvcnRlZEtleXMgPSBmYWxzZTsKICAgIHB1YmxpYyBi\nb29sZWFuIHVzZUdldEJlc3RSb3dJZGVudGlmaWVyRm9yUHJpbWFyeUtleXMg\nPSBmYWxzZTsKICAgIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzQXV0b0NvbW1p\ndEZvck1ldGFEYXRhID0gZmFsc2U7CgogICAgLy8gYXV0by1pbmNyZW1lbnQK\nICAgIHB1YmxpYyBpbnQgbWF4QXV0b0Fzc2lnbk5hbWVMZW5ndGggPSAzMTsK\nICAgIHB1YmxpYyBTdHJpbmcgYXV0b0Fzc2lnbkNsYXVzZSA9IG51bGw7CiAg\nICBwdWJsaWMgU3RyaW5nIGF1dG9Bc3NpZ25UeXBlTmFtZSA9IG51bGw7CiAg\nICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c0F1dG9Bc3NpZ24gPSBmYWxzZTsK\nICAgIHB1YmxpYyBTdHJpbmcgbGFzdEdlbmVyYXRlZEtleVF1ZXJ5ID0gbnVs\nbDsKICAgIHB1YmxpYyBTdHJpbmcgbmV4dFNlcXVlbmNlUXVlcnkgPSBudWxs\nOwogICAgcHVibGljIFN0cmluZyBzZXF1ZW5jZVNRTCA9IG51bGw7CiAgICBw\ndWJsaWMgU3RyaW5nIHNlcXVlbmNlU2NoZW1hU1FMID0gbnVsbDsKICAgIHB1\nYmxpYyBTdHJpbmcgc2VxdWVuY2VOYW1lU1FMID0gbnVsbDsKICAgIC8vIG1v\nc3QgbmF0aXZlIHNlcXVlbmNlcyBjYW4gYmUgcnVuIGluc2lkZSB0aGUgYnVz\naW5lc3MgdHJhbnNhY3Rpb24KICAgIHB1YmxpYyBpbnQgbmF0aXZlU2VxdWVu\nY2VUeXBlPSBTZXEuVFlQRV9DT05USUdVT1VTOwoKICAgIHByb3RlY3RlZCBK\nREJDQ29uZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAgIHByb3RlY3RlZCBM\nb2cgbG9nID0gbnVsbDsKICAgIHByb3RlY3RlZCBib29sZWFuIGNvbm5lY3Rl\nZCA9IGZhbHNlOwogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNKREJDMyA9IGZh\nbHNlOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldDxTdHJpbmc+IHJlc2VydmVk\nV29yZFNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIC8vIHJlc2Vy\ndmVkV29yZFNldCBzdWJzZXQgdGhhdCBDQU5OT1QgYmUgdXNlZCBhcyB2YWxp\nZCBjb2x1bW4gbmFtZXMKICAgIC8vIChpLmUuLCB3aXRob3V0IHN1cnJvdW5k\naW5nIHRoZW0gd2l0aCBkb3VibGUtcXVvdGVzKQogICAgcHJvdGVjdGVkIFNl\ndDxTdHJpbmc+IGludmFsaWRDb2x1bW5Xb3JkU2V0ID0gbmV3IEhhc2hTZXQ8\nU3RyaW5nPigpOwogICAgcHJvdGVjdGVkIGZpbmFsIFNldDxTdHJpbmc+IHN5\nc3RlbVNjaGVtYVNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIHBy\nb3RlY3RlZCBmaW5hbCBTZXQ8U3RyaW5nPiBzeXN0ZW1UYWJsZVNldCA9IG5l\ndyBIYXNoU2V0PFN0cmluZz4oKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQ8\nU3RyaW5nPiBmaXhlZFNpemVUeXBlTmFtZVNldCA9IG5ldyBIYXNoU2V0PFN0\ncmluZz4oKTsKICAgIHByb3RlY3RlZCBmaW5hbCBTZXQ8U3RyaW5nPiB0eXBl\nTW9kaWZpZXJTZXQgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CgogICAgLy8g\nTmFtaW5nQ29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzCiAgICBwcml2YXRlIGJv\nb2xlYW4gZGVsaW1pdElkZW50aWZpZXJzID0gZmFsc2U7CiAgICBwdWJsaWMg\nYm9vbGVhbiBzdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzID0gdHJ1ZTsK\nICAgIHB1YmxpYyBTdHJpbmcgbGVhZGluZ0RlbGltaXRlciA9ICJcIiI7CiAg\nICBwdWJsaWMgU3RyaW5nIHRyYWlsaW5nRGVsaW1pdGVyID0gIlwiIjsKICAg\nIHB1YmxpYyBTdHJpbmcgbmFtZUNvbmNhdGVuYXRvciA9ICJfIjsKICAgIHB1\nYmxpYyBTdHJpbmcgZGVsaW1pdGVkQ2FzZSA9IFNDSEVNQV9DQVNFX1BSRVNF\nUlZFOwogICAgcHVibGljIFN0cmluZyBjYXRhbG9nU2VwYXJhdG9yID0gIi4i\nOwogICAgcHJpdmF0ZSBTdHJpbmcgZGVmYXVsdFNjaGVtYU5hbWUgPSBudWxs\nOwogICAgcHJpdmF0ZSBTdHJpbmcgY29udmVyc2lvbktleSA9IG51bGw7CiAg\nICAgICAKICAgIC8vIE5hbWluZyB1dGlsaXR5IGFuZCBuYW1pbmcgcnVsZXMK\nICAgIHByaXZhdGUgREJJZGVudGlmaWVyVXRpbCBuYW1pbmdVdGlsID0gbnVs\nbDsKICAgIHByaXZhdGUgTWFwPFN0cmluZywgSWRlbnRpZmllclJ1bGU+IG5h\nbWluZ1J1bGVzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBJZGVudGlmaWVyUnVs\nZT4oKTsKICAgIHByaXZhdGUgSWRlbnRpZmllclJ1bGUgZGVmYXVsdE5hbWlu\nZ1J1bGUgPSBudWxsOyAgLy8gY2FjaGVkIGZvciBwZXJmb3JtYW5jZQogICAg\nCiAgICAvKioKICAgICAqIElmIGEgbmF0aXZlIHF1ZXJ5IGJlZ2lucyB3aXRo\nIGFueSBvZiB0aGUgdmFsdWVzIGZvdW5kIGhlcmUgdGhlbiBpdCB3aWxsCiAg\nICAgKiBiZSB0cmVhdGVkIGFzIGEgc2VsZWN0IHN0YXRlbWVudC4gIAogICAg\nICovCiAgICBwcm90ZWN0ZWQgZmluYWwgU2V0IHNlbGVjdFdvcmRTZXQgPSBu\nZXcgSGFzaFNldCgpOwoKICAgIC8vIHdoZW4gd2Ugc3RvcmUgdmFsdWVzIHRo\nYXQgbG9zZSBwcmVjaXNpb24sIHRyYWNrIHRoZSB0eXBlcyBzbyB0aGF0IHRo\nZQogICAgLy8gZmlyc3QgdGltZSBpdCBoYXBwZW5zIHdlIGNhbiB3YXJuIHRo\nZSB1c2VyCiAgICBwcml2YXRlIFNldCBfcHJlY2lzaW9uV2FybmVkVHlwZXMg\nPSBudWxsOwoKICAgIC8vIGJhdGNoTGltaXQgdmFsdWU6CiAgICAvLyAtMSA9\nIHVubGltaXRlZAogICAgLy8gMCAgPSBubyBiYXRjaAogICAgLy8gYW55IHBv\nc2l0aXZlIG51bWJlciA9IGJhdGNoIGxpbWl0CiAgICBwdWJsaWMgaW50IGJh\ndGNoTGltaXQgPSBOT19CQVRDSDsKICAgIAogICAgcHVibGljIGZpbmFsIE1h\ncDxJbnRlZ2VyLFNldDxTdHJpbmc+PiBzcWxTdGF0ZUNvZGVzID0gCiAgICAg\nICAgbmV3IEhhc2hNYXA8SW50ZWdlciwgU2V0PFN0cmluZz4+KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAg\nIHB1YmxpYyBEQkRpY3Rpb25hcnkoKSB7CiAgICAgICAgZml4ZWRTaXplVHlw\nZU5hbWVTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QobmV3IFN0cmluZ1tdewog\nICAgICAgICAgICAiQklHSU5UIiwgIkJJVCIsICJCTE9CIiwgIkNMT0IiLCAi\nREFURSIsICJERUNJTUFMIiwgIkRJU1RJTkNUIiwKICAgICAgICAgICAgIkRP\nVUJMRSIsICJGTE9BVCIsICJJTlRFR0VSIiwgIkpBVkFfT0JKRUNUIiwgIk5V\nTEwiLCAiTlVNRVJJQyIsIAogICAgICAgICAgICAiT1RIRVIiLCAiUkVBTCIs\nICJSRUYiLCAiU01BTExJTlQiLCAiU1RSVUNUIiwgIlRJTUUiLCAiVElNRVNU\nQU1QIiwKICAgICAgICAgICAgIlRJTllJTlQiLAogICAgICAgIH0pKTsKICAg\nICAgICAKICAgICAgICBzZWxlY3RXb3JkU2V0LmFkZCgiU0VMRUNUIik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hl\nbiB0aGUgZGljdGlvbmFyeSBmaXJzdCBzZWVzIGFueSBjb25uZWN0aW9uLgog\nICAgICogSXQgaXMgdXNlZCB0byBpbml0aWFsaXplIGRpY3Rpb25hcnkgbWV0\nYWRhdGEgaWYgbmVlZGVkLiBJZiB5b3UKICAgICAqIG92ZXJyaWRlIHRoaXMg\nbWV0aG9kLCBiZSBzdXJlIHRvIGNhbGwKICAgICAqIDxjb2RlPnN1cGVyLmNv\nbm5lY3RlZENvbmZpZ3VyYXRpb248L2NvZGU+LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBjb25uZWN0ZWRDb25maWd1cmF0aW9uKENvbm5lY3Rpb24gY29u\nbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nIWNvbm5lY3RlZCkgewogICAgICAgICAgICBEYXRhYmFzZU1ldGFEYXRhIG1l\ndGFEYXRhID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIG1ldGFEYXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBKREJDMy1vbmx5\nIG1ldGhvZCwgc28gaXQgbWlnaHQgdGhyb3cgYSAKICAgICAgICAgICAgICAg\nICAgICAvLyBBYnN0cmFjdE1ldGhvZEVycm9yCiAgICAgICAgICAgICAgICAg\nICAgaXNKREJDMyA9IG1ldGFEYXRhLmdldEpEQkNNYWpvclZlcnNpb24oKSA+\nPSAzOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgaWYgbm90IEpEQkMzCiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAobG9nLmlzVHJhY2VFbmFibGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgbG9nLnRyYWNlKGUudG9TdHJpbmco\nKSwgZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkgeyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAg\nICAgICAgICBsb2cudHJhY2UoREJEaWN0aW9uYXJ5RmFjdG9yeS50b1N0cmlu\nZyhtZXRhRGF0YSkpOwoKICAgICAgICAgICAgICAgIGlmIChpc0pEQkMzKQog\nICAgICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiY29ubmVj\ndGlvbi1kZWZhdWx0cyIsIG5ldyBPYmplY3RbXXsKICAgICAgICAgICAgICAg\nICAgICAgICAgY29ubi5nZXRBdXRvQ29tbWl0KCksIGNvbm4uZ2V0SG9sZGFi\naWxpdHkoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29ubi5nZXRUcmFu\nc2FjdGlvbklzb2xhdGlvbigpfSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIAogICAgICAgICAgICAvLyBDb25maWd1cmUgdGhlIG5hbWluZyB1dGls\naXR5CiAgICAgICAgICAgIGNvbmZpZ3VyZU5hbWluZ1V0aWwobWV0YURhdGEp\nOwoKICAgICAgICAgICAgLy8gQXV0by1kZXRlY3QgZ2VuZXJhdGVkIGtleXMg\ncmV0cmlldmFsIHN1cHBvcnQKICAgICAgICAgICAgLy8gdW5sZXNzIHVzZXIg\nc3BlY2lmaWVkIGl0LgogICAgICAgICAgICBpZiAoc3VwcG9ydHNHZXRHZW5l\ncmF0ZWRLZXlzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChpc0pE\nQkMzKSB7CiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydHNHZXRHZW5lcmF0\nZWRLZXlzID0KICAgICAgICAgICAgICAgICAgICAgICAgbWV0YURhdGEuc3Vw\ncG9ydHNHZXRHZW5lcmF0ZWRLZXlzKCk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIHN1cHBvcnRzR2V0R2VuZXJhdGVk\nS2V5cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIGNvbm5lY3RlZCA9IHRydWU7CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgdm9pZCBjb25maWd1cmVOYW1pbmdVdGlsKERhdGFi\nYXNlTWV0YURhdGEgbWV0YURhdGEpIHsKICAgICAgICAvLyBHZXQgdGhlIG5h\nbWluZyB1dGlsaXR5IGZyb20gdGhlIGNvbmZpZ3VyYXRpb24KICAgICAgICBz\nZXRTdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzKG1ldGFEYXRhKTsKICAg\nICAgICBzZXREZWxpbWl0ZWRDYXNlKG1ldGFEYXRhKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbmZpZ3VyZXMgdGhlIG5hbWluZyBydWxlcyBmb3IgdGhp\ncyBkaWN0aW9uYXJ5LiAgU3ViY2xhc3NlcyBzaG91bGQgCiAgICAgKiBvdmVy\ncmlkZSB0aGlzIG1ldGhvZCwgcHJvdmlkaW5nIHRoZWlyIG93biBuYW1pbmcg\ncnVsZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNvbmZpZ3VyZU5h\nbWluZ1J1bGVzKCkgewogICAgICAgIC8vIEFkZCB0aGUgZGVmYXVsdCBuYW1p\nbmcgcnVsZQogICAgICAgIERCSWRlbnRpZmllclJ1bGUgZGVmUnVsZSA9IG5l\ndyBEQklkZW50aWZpZXJSdWxlKERCSWRlbnRpZmllclR5cGUuREVGQVVMVCwg\ncmVzZXJ2ZWRXb3JkU2V0KTsKICAgICAgICBuYW1pbmdSdWxlcy5wdXQoZGVm\nUnVsZS5nZXROYW1lKCksIGRlZlJ1bGUpOwogICAgICAgIC8vIERpc2FibGUg\nZGVsaW1pdGluZyBvZiBjb2x1bW4gZGVmaW5pdGlvbi4gIERCIHBsYXRmb3Jt\ncyBhcmUgdmVyeQogICAgICAgIC8vIHBpY2t5IGFib3V0IGRlbGltaXRlcnMg\naW4gY29sdW1uIGRlZmluaXRpb25zLiBCYXNlIGNvbHVtbiB0eXBlcwogICAg\nICAgIC8vIGRvIG5vdCByZXF1aXJlIGRlbGltaXRlcnMgYW5kIHdpbGwgY2F1\nc2UgZmFpbHVyZXMgaWYgZGVsaW1pdGVkLgogICAgICAgIERCSWRlbnRpZmll\nclJ1bGUgY2RSdWxlID0gbmV3IENvbHVtbkRlZklkZW50aWZpZXJSdWxlKCk7\nCiAgICAgICAgY2RSdWxlLnNldENhbkRlbGltaXQoZmFsc2UpOwogICAgICAg\nIG5hbWluZ1J1bGVzLnB1dChjZFJ1bGUuZ2V0TmFtZSgpLCBjZFJ1bGUpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFJlc3Vs\ndFNldCB3cmFwcGVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBBcnJheSBnZXRBcnJheShSZXN1bHRT\nZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEFycmF5KGNvbHVtbik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1u\nIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGph\ndmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIElucHV0U3RyZWFtIGdldEFz\nY2lpU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0QXNj\naWlTdHJlYW0oY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZl\ncnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQg\ndG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBw\ndWJsaWMgQmlnRGVjaW1hbCBnZXRCaWdEZWNpbWFsKFJlc3VsdFNldCBycywg\naW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoc3RvcmVMYXJnZU51bWJlcnNBc1N0cmluZ3MpIHsKICAgICAg\nICAgICAgU3RyaW5nIHN0ciA9IGdldFN0cmluZyhycywgY29sdW1uKTsKICAg\nICAgICAgICAgcmV0dXJuIChzdHIgPT0gbnVsbCkgPyBudWxsIDogbmV3IEJp\nZ0RlY2ltYWwoc3RyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJzLmdl\ndEJpZ0RlY2ltYWwoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdGhlIHNwZWNpZmllZCBjb2x1bW4gdmFsdWUgYXMgYW4gdW5rbm93\nbiBudW1lcmljIHR5cGU7CiAgICAgKiB3ZSB0cnkgZnJvbSB0aGUgbW9zdCBn\nZW5lcmljIHRvIHRoZSBsZWFzdCBnZW5lcmljLgogICAgICovCiAgICBwdWJs\naWMgTnVtYmVyIGdldE51bWJlcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gdHJ5\nIGZyb20gdGhlIG1vc3QgZ2VuZXJpYywgYW5kIGlmIGVycm9ycyBvY2N1ciwg\ndHJ5CiAgICAgICAgLy8gbGVzcyBnZW5lcmljIHR5cGVzOyB0aGlzIGVuYWJs\nZXMgdXMgdG8gaGFuZGxlIHZhbHVlcwogICAgICAgIC8vIGxpa2UgRG91Ymxl\nLk5hTiB3aXRob3V0IGhhdmluZyB0byBpbnRyb3NwZWN0IG9uIHRoZQogICAg\nICAgIC8vIFJlc3VsdFNldE1ldGFEYXRhIChidWcgIzEwNTMpLiBOb3RlIHRo\nYXQgd2UgaGFuZGxlCiAgICAgICAgLy8gZ2VuZXJpYyBleGNlcHRpb25zLCBz\naW5jZSBzb21lIGRyaXZlcnMgbWF5IHRocm93CiAgICAgICAgLy8gTnVtYmVy\nRm9ybWF0RXhjZXB0aW9ucywgd2hlcmVhcyBvdGhlcnMgbWF5IHRocm93IFNR\nTEV4Y2VwdGlvbnMKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4g\nZ2V0QmlnRGVjaW1hbChycywgY29sdW1uKTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZTEpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHJldHVybiBuZXcgRG91YmxlKGdldERvdWJsZShycywgY29sdW1uKSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMikgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIEZsb2F0KGdldEZsb2F0KHJzLCBjb2x1bW4pKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlMykgewogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRMb25n\nKHJzLCBjb2x1bW4pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlNCkgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEludChycywg\nY29sdW1uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGU1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChlMSBpbnN0YW5jZW9mIFJ1bnRpbWVFeGNl\ncHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyhSdW50aW1lRXhjZXB0aW9u\nKSBlMTsKICAgICAgICAgICAgaWYgKGUxIGluc3RhbmNlb2YgU1FMRXhjZXB0\naW9uKQogICAgICAgICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSBlMTsK\nICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUg\nU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUu\nCiAgICAgKi8KICAgIHB1YmxpYyBCaWdJbnRlZ2VyIGdldEJpZ0ludGVnZXIo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxF\neGNlcHRpb24gewogICAgICAgIGlmIChzdG9yZUxhcmdlTnVtYmVyc0FzU3Ry\naW5ncykgewogICAgICAgICAgICBTdHJpbmcgc3RyID0gZ2V0U3RyaW5nKHJz\nLCBjb2x1bW4pOwogICAgICAgICAgICByZXR1cm4gKHN0ciA9PSBudWxsKSA/\nIG51bGwgOiBuZXcgQmlnRGVjaW1hbChzdHIpLnRvQmlnSW50ZWdlcigpOwog\nICAgICAgIH0KICAgICAgICBCaWdEZWNpbWFsIGJkID0gZ2V0QmlnRGVjaW1h\nbChycywgY29sdW1uKTsKICAgICAgICByZXR1cm4gKGJkID09IG51bGwpID8g\nbnVsbCA6IGJkLnRvQmlnSW50ZWdlcigpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJl\nc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5cGUuCiAgICAg\nKi8KICAgIHB1YmxpYyBJbnB1dFN0cmVhbSBnZXRCaW5hcnlTdHJlYW0oUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCaW5hcnlTdHJlYW0oY29s\ndW1uKTsKICAgIH0KCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0gZ2V0TE9CU3Ry\nZWFtKEpEQkNTdG9yZSBzdG9yZSwgUmVzdWx0U2V0IHJzLAogICAgICAgIGlu\ndCBjb2x1bW4pIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBycy5nZXRCaW5hcnlTdHJlYW0oY29sdW1uKTsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRo\nZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlw\nZS4KICAgICAqLwogICAgcHVibGljIEJsb2IgZ2V0QmxvYihSZXN1bHRTZXQg\ncnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHJzLmdldEJsb2IoY29sdW1uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0IGdldEJsb2JPYmplY3Qo\nUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBKREJDU3RvcmUgc3RvcmUpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5wdXRTdHJl\nYW0gaW4gPSBudWxsOwogICAgICAgIGlmICh1c2VHZXRCeXRlc0ZvckJsb2Jz\nIHx8IHVzZUdldE9iamVjdEZvckJsb2JzKSB7CiAgICAgICAgICAgIGJ5dGVb\nXSBieXRlcyA9IGdldEJ5dGVzKHJzLCBjb2x1bW4pOwogICAgICAgICAgICBp\nZiAoYnl0ZXMgIT0gbnVsbCAmJiBieXRlcy5sZW5ndGggPiAwKQogICAgICAg\nICAgICAgICAgaW4gPSBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0oYnl0ZXMp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEJsb2IgYmxvYiA9IGdl\ndEJsb2IocnMsIGNvbHVtbik7CiAgICAgICAgICAgIGlmIChibG9iICE9IG51\nbGwgJiYgYmxvYi5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICBpbiA9\nIGJsb2IuZ2V0QmluYXJ5U3RyZWFtKCk7CiAgICAgICAgfQogICAgICAgIGlm\nIChpbiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHN0b3JlID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gU2VyaWFsaXphdGlvbi5kZXNlcmlhbGl6ZShp\nbiwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBTZXJpYWxpemF0aW9uLmRl\nc2VyaWFsaXplKGluLCBzdG9yZS5nZXRDb250ZXh0KCkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nbi5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBp\nb2UpIHsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNR\nTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgog\nICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRCb29sZWFuKFJlc3VsdFNl\ndCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Qm9vbGVhbihjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlIGdldEJ5dGUoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRCeXRlKGNvbHVtbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQgY29s\ndW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAgICAq\nIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGJ5dGVbXSBnZXRCeXRl\ncyhSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHVzZUdldEJ5dGVzRm9yQmxvYnMp\nCiAgICAgICAgICAgIHJldHVybiBycy5nZXRCeXRlcyhjb2x1bW4pOwogICAg\nICAgIGlmICh1c2VHZXRPYmplY3RGb3JCbG9icykKICAgICAgICAgICAgcmV0\ndXJuIChieXRlW10pIHJzLmdldE9iamVjdChjb2x1bW4pOwoKICAgICAgICBC\nbG9iIGJsb2IgPSBnZXRCbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChi\nbG9iID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIGludCBsZW5ndGggPSAoaW50KSBibG9iLmxlbmd0aCgpOwogICAgICAgIGlm\nIChsZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgcmV0dXJuIGJsb2IuZ2V0Qnl0ZXMoMSwgbGVuZ3RoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLiBDb252ZXJ0cyB0aGUgZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFt\ncH0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIENhbGVuZGFyIGdl\ndENhbGVuZGFyKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBEYXRlIGQgPSBnZXREYXRl\nKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICBDYWxlbmRhciBjYWwgPSBDYWxl\nbmRhci5nZXRJbnN0YW5jZSgpOwogICAgICAgIGNhbC5zZXRUaW1lKGQpOwog\nICAgICAgIHJldHVybiBjYWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIGNoYXIgZ2V0Q2hhcihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHN0\nb3JlQ2hhcnNBc051bWJlcnMpCiAgICAgICAgICAgIHJldHVybiAoY2hhcikg\nZ2V0SW50KHJzLCBjb2x1bW4pOwoKICAgICAgICBTdHJpbmcgc3RyID0gZ2V0\nU3RyaW5nKHJzLCBjb2x1bW4pOwogICAgICAgIHJldHVybiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShzdHIpKSA/IDAgOiBzdHIuY2hhckF0KDApOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBSZWFkZXIgZ2V0Q2hhcmFjdGVy\nU3RyZWFtKFJlc3VsdFNldCBycywgaW50IGNvbHVtbikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcnMuZ2V0Q2hhcmFj\ndGVyU3RyZWFtKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252\nZXJ0IHRoZSBzcGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0\nIHRvIHRoZSBwcm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAg\ncHVibGljIENsb2IgZ2V0Q2xvYihSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIHJzLmdldENsb2IoY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENv\nbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRT\nZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENsb2JTdHJpbmcoUmVzdWx0U2V0IHJzLCBp\nbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICh1c2VHZXRTdHJpbmdGb3JDbG9icykKICAgICAgICAgICAgcmV0\ndXJuIHJzLmdldFN0cmluZyhjb2x1bW4pOwoKICAgICAgICBDbG9iIGNsb2Ig\nPSBnZXRDbG9iKHJzLCBjb2x1bW4pOwogICAgICAgIGlmIChjbG9iID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChjbG9i\nLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAg\nICAgLy8gdW5saWtlbHkgdGhhdCB3ZSdsbCBoYXZlIHN0cmluZ3Mgb3ZlciBJ\nbnRlZ2VyLk1BWF9WQUxVRSBjaGFycwogICAgICAgIHJldHVybiBjbG9iLmdl\ndFN1YlN0cmluZygxLCAoaW50KSBjbG9iLmxlbmd0aCgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2Yg\ndGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0\neXBlLiBDb252ZXJ0cyB0aGUgZGF0ZSBmcm9tIGEge0BsaW5rIFRpbWVzdGFt\ncH0gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIERhdGUgZ2V0RGF0\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgVGltZXN0YW1wIHRzdGFtcCA9IGdldFRp\nbWVzdGFtcChycywgY29sdW1uLCBudWxsKTsKICAgICAgICBpZiAodHN0YW1w\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAv\nLyBnZXQgdGhlIGZyYWN0aW9uYWwgc2Vjb25kcyBjb21wb25lbnQsIHJvdW5k\naW5nIGF3YXkgYW55dGhpbmcgYmV5b25kCiAgICAgICAgLy8gbWlsbGlzZWNv\nbmRzCiAgICAgICAgaW50IGZyYWN0aW9uYWwgPSAoaW50KSBNYXRoLnJvdW5k\nKHRzdGFtcC5nZXROYW5vcygpIC8gKGRvdWJsZSkgTUlMTEkpOwoKICAgICAg\nICAvLyBnZXQgdGhlIG1pbGxpcyBjb21wb25lbnQ7IHNvbWUgSkRCQyBkcml2\nZXJzIHJvdW5kIHRoaXMgdG8gdGhlCiAgICAgICAgLy8gbmVhcmVzdCBzZWNv\nbmQsIHdoaWxlIG90aGVycyBkbyBub3QKICAgICAgICBsb25nIG1pbGxpcyA9\nICh0c3RhbXAuZ2V0VGltZSgpIC8gMTAwMEwpICogMTAwMEw7CiAgICAgICAg\ncmV0dXJuIG5ldyBEYXRlKG1pbGxpcyArIGZyYWN0aW9uYWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBv\nZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBqYXZhLnNxbC5EYXRlIGdldERh\ndGUoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxlbmRhciBjYWwpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNhbCA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0RGF0ZShjb2x1bW4p\nOwogICAgICAgIHJldHVybiBycy5nZXREYXRlKGNvbHVtbiwgY2FsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1\nbW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICog\namF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgZG91YmxlIGdldERvdWJs\nZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldERvdWJsZShjb2x1\nbW4pOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lm\naWVkIGNvbHVtbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVy\nCiAgICAgKiBqYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCBn\nZXRGbG9hdChSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldEZsb2F0\nKGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBz\ncGVjaWZpZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBw\ncm9wZXIKICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRJbnQoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRJbnQo\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgTG9j\nYWxlIGdldExvY2FsZShSZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIHN0ciA9\nIGdldFN0cmluZyhycywgY29sdW1uKTsKICAgICAgICBpZiAoU3RyaW5nVXRp\nbHMuaXNFbXB0eShzdHIpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgU3RyaW5nW10gcGFyYW1zID0gU3RyaW5ncy5zcGxpdChzdHIsICJf\nIiwgMyk7CiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPCAzKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gbmV3IExvY2FsZShw\nYXJhbXNbMF0sIHBhcmFtc1sxXSwgcGFyYW1zWzJdKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgbG9uZyBnZXRMb25nKFJlc3VsdFNldCBy\ncywgaW50IGNvbHVtbikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gcnMuZ2V0TG9uZyhjb2x1bW4pOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVtbiBvZiB0\naGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBqYXZhIHR5\ncGUuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgZ2V0T2JqZWN0KFJlc3Vs\ndFNldCBycywgaW50IGNvbHVtbiwgTWFwIG1hcCkKICAgICAgICB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAobWFwID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybiBycy5nZXRPYmplY3QoY29sdW1uKTsKICAgICAgICBy\nZXR1cm4gcnMuZ2V0T2JqZWN0KGNvbHVtbiwgbWFwKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBjb2x1bW4gb2YgdGhl\nIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHByb3BlcgogICAgICogamF2YSB0eXBl\nLgogICAgICovCiAgICBwdWJsaWMgUmVmIGdldFJlZihSZXN1bHRTZXQgcnMs\nIGludCBjb2x1bW4sIE1hcCBtYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFJlZihjb2x1bW4pOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29udmVydCB0aGUgc3BlY2lmaWVkIGNvbHVt\nbiBvZiB0aGUgU1FMIFJlc3VsdFNldCB0byB0aGUgcHJvcGVyCiAgICAgKiBq\nYXZhIHR5cGUuCiAgICAgKi8KICAgIHB1YmxpYyBzaG9ydCBnZXRTaG9ydChS\nZXN1bHRTZXQgcnMsIGludCBjb2x1bW4pCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHJzLmdldFNob3J0KGNvbHVtbik7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZpZWQg\nY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIKICAg\nICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRT\ndHJpbmcoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBycy5nZXRTdHJpbmco\nY29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNw\nZWNpZmllZCBjb2x1bW4gb2YgdGhlIFNRTCBSZXN1bHRTZXQgdG8gdGhlIHBy\nb3BlcgogICAgICogamF2YSB0eXBlLgogICAgICovCiAgICBwdWJsaWMgVGlt\nZSBnZXRUaW1lKFJlc3VsdFNldCBycywgaW50IGNvbHVtbiwgQ2FsZW5kYXIg\nY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlm\nIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJzLmdldFRpbWUo\nY29sdW1uKTsKICAgICAgICByZXR1cm4gcnMuZ2V0VGltZShjb2x1bW4sIGNh\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBzcGVjaWZp\nZWQgY29sdW1uIG9mIHRoZSBTUUwgUmVzdWx0U2V0IHRvIHRoZSBwcm9wZXIK\nICAgICAqIGphdmEgdHlwZS4KICAgICAqLwogICAgcHVibGljIFRpbWVzdGFt\ncCBnZXRUaW1lc3RhbXAoUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uLCBDYWxl\nbmRhciBjYWwpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gcnMuZ2V0\nVGltZXN0YW1wKGNvbHVtbik7CiAgICAgICAgcmV0dXJuIHJzLmdldFRpbWVz\ndGFtcChjb2x1bW4sIGNhbCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcmVwYXJlZFN0YXRlbWVudCB3cmFw\ncGVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEFycmF5KFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBBcnJh\neSB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRBcnJheShpZHgsIHZhbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEFzY2lpU3RyZWFtKFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50LCBpbnQgaWR4LAogICAgICAgIElucHV0U3RyZWFtIHZhbCwgaW50IGxl\nbmd0aCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzdG1udC5zZXRBc2NpaVN0cmVhbShpZHgsIHZhbCwgbGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QmlnRGVjaW1hbChQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgQmlnRGVjaW1hbCB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoKGNvbCAhPSBudWxsICYmIGNvbC5pc0NvbXBhdGlibGUoVHlwZXMu\nVkFSQ0hBUiwgbnVsbCwgMCwgMCkpCiAgICAgICAgICAgIHx8IChjb2wgPT0g\nbnVsbCAmJiBzdG9yZUxhcmdlTnVtYmVyc0FzU3RyaW5ncykpCiAgICAgICAg\nICAgIHNldFN0cmluZyhzdG1udCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29s\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNldEJpZ0RlY2lt\nYWwoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRCaWdJbnRlZ2VyKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBCaWdJbnRlZ2VyIHZhbCwKICAg\nICAgICBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmICgoY29sICE9IG51bGwgJiYgY29sLmlzQ29tcGF0aWJs\nZShUeXBlcy5WQVJDSEFSLCBudWxsLCAwLCAwKSkKICAgICAgICAgICAgfHwg\nKGNvbCA9PSBudWxsICYmIHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKSkK\nICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgsIHZhbC50b1N0cmlu\nZygpLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0QmlnRGVj\naW1hbChzdG1udCwgaWR4LCBuZXcgQmlnRGVjaW1hbCh2YWwpLCBjb2wpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRCaW5hcnlTdHJlYW0oUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIGludCBpZHgsCiAgICAgICAgSW5wdXRTdHJlYW0gdmFsLCBpbnQgbGVu\nZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldEJpbmFyeVN0cmVhbShpZHgsIHZhbCwgbGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFs\ndWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2V0QmxvYihQcmVwYXJlZFN0YXRlbWVudCBzdG1u\ndCwgaW50IGlkeCwgQmxvYiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0QmxvYihpZHgs\nIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZh\nbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuIFVzZXMgdGhl\nCiAgICAgKiB7QGxpbmsgI3NlcmlhbGl6ZX0gbWV0aG9kIHRvIHNlcmlhbGl6\nZSB0aGUgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJsb2JP\nYmplY3QoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVj\ndCB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCwgSkRCQ1N0b3JlIHN0b3JlKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHNldEJ5dGVz\nKHN0bW50LCBpZHgsIHNlcmlhbGl6ZSh2YWwsIHN0b3JlKSwgY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0Qm9vbGVhbihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgYm9vbGVhbiB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRJbnQo\naWR4LCAodmFsKSA/IDEgOiAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNl\ndCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRl\nbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZShQcmVwYXJl\nZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgYnl0ZSB2YWwsIENvbHVtbiBj\nb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3Rt\nbnQuc2V0Qnl0ZShpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEJ5dGVzKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBieXRlW10gdmFsLAogICAg\nICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKHVzZVNldEJ5dGVzRm9yQmxvYnMpCiAgICAgICAgICAg\nIHN0bW50LnNldEJ5dGVzKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHNldEJpbmFyeVN0cmVhbShzdG1udCwgaWR4LCBuZXcgQnl0ZUFy\ncmF5SW5wdXRTdHJlYW0odmFsKSwKICAgICAgICAgICAgICAgIHZhbC5sZW5n\ndGgsIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldENoYXIoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIGNoYXIgdmFsLCBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICgoY29sICE9IG51\nbGwgJiYgY29sLmlzQ29tcGF0aWJsZShUeXBlcy5JTlRFR0VSLCBudWxsLCAw\nLCAwKSkKICAgICAgICAgICAgfHwgKGNvbCA9PSBudWxsICYmIHN0b3JlQ2hh\ncnNBc051bWJlcnMpKQogICAgICAgICAgICBzZXRJbnQoc3RtbnQsIGlkeCwg\nKGludCkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0\nU3RyaW5nKHN0bW50LCBpZHgsIFN0cmluZy52YWx1ZU9mKHZhbCksIGNvbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFz\nIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldENoYXJhY3RlclN0cmVhbShQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwKICAgICAgICBSZWFkZXIgdmFsLCBpbnQgbGVu\nZ3RoLCBDb2x1bW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHN0bW50LnNldENoYXJhY3RlclN0cmVhbShpZHgsIHZhbCwg\nbGVuZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4g\ndmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0Q2xvYihQcmVwYXJlZFN0YXRlbWVudCBz\ndG1udCwgaW50IGlkeCwgQ2xvYiB2YWwsIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0Q2xvYihp\nZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldENsb2JTdHJpbmcoUHJlcGFyZWRTdGF0\nZW1lbnQgc3RtbnQsIGludCBpZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29s\ndW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAodXNlU2V0U3RyaW5nRm9yQ2xvYnMpCiAgICAgICAgICAgIHN0bW50\nLnNldFN0cmluZyhpZHgsIHZhbCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAg\nICAgIC8vIHNldCByZWFkZXIgZnJvbSBzdHJpbmcKICAgICAgICAgICAgU3Ry\naW5nUmVhZGVyIGluID0gbmV3IFN0cmluZ1JlYWRlcih2YWwpOwogICAgICAg\nICAgICBzZXRDaGFyYWN0ZXJTdHJlYW0oc3RtbnQsIGlkeCwgaW4sIHZhbC5s\nZW5ndGgoKSwgY29sKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBz\ndGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGUoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIERhdGUgdmFsLCBDb2x1\nbW4gY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmIChjb2wgIT0gbnVsbCAmJiBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkRB\nVEUpCiAgICAgICAgICAgIHNldERhdGUoc3RtbnQsIGlkeCwgbmV3IGphdmEu\nc3FsLkRhdGUodmFsLmdldFRpbWUoKSksIG51bGwsIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAoY29sICE9IG51bGwgJiYgY29sLmdldFR5cGUoKSA9PSBUeXBl\ncy5USU1FKQogICAgICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIG5ldyBU\naW1lKHZhbC5nZXRUaW1lKCkpLCBudWxsLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIFRpbWVzdGFtcCkKICAgICAgICAgICAgc2V0\nVGltZXN0YW1wKHN0bW50LCBpZHgsKFRpbWVzdGFtcCkgdmFsLCBudWxsLCBj\nb2wpOyAgIAogICAgICAgIGVsc2UKICAgICAgICAgICAgc2V0VGltZXN0YW1w\nKHN0bW50LCBpZHgsIG5ldyBUaW1lc3RhbXAodmFsLmdldFRpbWUoKSksIG51\nbGwsIGNvbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVu\nIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHNldERhdGUoUHJlcGFyZWRTdGF0ZW1lbnQg\nc3RtbnQsIGludCBpZHgsIGphdmEuc3FsLkRhdGUgdmFsLAogICAgICAgIENh\nbGVuZGFyIGNhbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoY2FsID09IG51bGwpCiAgICAgICAgICAg\nIHN0bW50LnNldERhdGUoaWR4LCB2YWwpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgc3RtbnQuc2V0RGF0ZShpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0\nZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQg\nc2V0Q2FsZW5kYXIoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgs\nIENhbGVuZGFyIHZhbCwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGJ5IGRlZmF1bHQgd2Ug\nbWVyZWx5IGRlbGVnYXRlIHRvIHRoZSBEYXRlIHBhcmFtZXRlcgogICAgICAg\nIHNldERhdGUoc3RtbnQsIGlkeCwgdmFsLmdldFRpbWUoKSwgY29sKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBw\nYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgc2V0RG91YmxlKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBpbnQg\naWR4LCBkb3VibGUgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAg\ndGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0RG91Ymxl\nKGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgZ2l2\nZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc2V0RmxvYXQoUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQsIGludCBpZHgsIGZsb2F0IHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldEZsb2F0KGlkeCwgdmFsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNldCB0aGUgZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0\nYXRlbWVudC4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0SW50KFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBpbnQgaWR4LCBpbnQgdmFsLCBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldEludChpZHgsIHZhbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBT\nZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldExvbmcoUHJlcGFy\nZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIGxvbmcgdmFsLCBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHN0\nbW50LnNldExvbmcoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICog\nU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3Rh\ndGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRMb2NhbGUoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIExvY2FsZSB2YWwsCiAg\nICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCwgdmFsLmdldExhbmd1\nYWdlKCkgKyAiXyIgKyB2YWwuZ2V0Q291bnRyeSgpCiAgICAgICAgICAgICsg\nIl8iICsgdmFsLmdldFZhcmlhbnQoKSwgY29sKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCBudWxsIGFzIGEgcGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1l\nbnQuIFRoZSBjb2x1bW4KICAgICAqIHR5cGUgd2lsbCBjb21lIGZyb20ge0Bs\naW5rIFR5cGVzfS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0TnVsbChQ\ncmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgaW50IGNvbFR5cGUs\nCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBzdG1udC5zZXROdWxsKGlkeCwgY29sVHlwZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEg\ncGFyYW1ldGVyIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNldE51bWJlcihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50\nIGlkeCwgTnVtYmVyIG51bSwKICAgICAgICBDb2x1bW4gY29sKQogICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8vIGNoZWNrIGZvciBr\nbm93biBmbG9hdGluZyBwb2ludCB0eXBlcyB0byBnaXZlIGRyaXZlciBhIGNo\nYW5jZSB0bwogICAgICAgIC8vIGhhbmRsZSBzcGVjaWFsIG51bWJlcnMgbGlr\nZSBOYU4gYW5kIGluZmluaXR5OyBidWcgIzEwNTMKICAgICAgICBpZiAobnVt\nIGluc3RhbmNlb2YgRG91YmxlKQogICAgICAgICAgICBzZXREb3VibGUoc3Rt\nbnQsIGlkeCwgKChEb3VibGUpIG51bSkuZG91YmxlVmFsdWUoKSwgY29sKTsK\nICAgICAgICBlbHNlIGlmIChudW0gaW5zdGFuY2VvZiBGbG9hdCkKICAgICAg\nICAgICAgc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChGbG9hdCkgbnVtKS5mbG9h\ndFZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzZXRC\naWdEZWNpbWFsKHN0bW50LCBpZHgsIG5ldyBCaWdEZWNpbWFsKG51bS50b1N0\ncmluZygpKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUg\nZ2l2ZW4gdmFsdWUgYXMgYSBwYXJhbWV0ZXIgdG8gdGhlIHN0YXRlbWVudC4g\nVGhlIGNvbHVtbgogICAgICogdHlwZSB3aWxsIGNvbWUgZnJvbSB7QGxpbmsg\nVHlwZXN9LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRPYmplY3QoUHJl\ncGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGludCBpZHgsIE9iamVjdCB2YWwsCiAg\nICAgICAgaW50IGNvbFR5cGUsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNvbFR5cGUgPT0gLTEgfHwg\nY29sVHlwZSA9PSBUeXBlcy5PVEhFUikKICAgICAgICAgICAgc3RtbnQuc2V0\nT2JqZWN0KGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0\nbW50LnNldE9iamVjdChpZHgsIHZhbCwgY29sVHlwZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVy\nIHRvIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndFJlZihQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgUmVmIHZh\nbCwgQ29sdW1uIGNvbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICBzdG1udC5zZXRSZWYoaWR4LCB2YWwpOwogICAgfQoKICAgIC8q\nKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0\nbyB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRT\naG9ydChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwgc2hvcnQg\ndmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgc3RtbnQuc2V0U2hvcnQoaWR4LCB2YWwpOwog\nICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBnaXZlbiB2YWx1ZSBhcyBh\nIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRTdHJpbmcoUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIGlu\ndCBpZHgsIFN0cmluZyB2YWwsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdG1udC5zZXRTdHJp\nbmcoaWR4LCB2YWwpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBn\naXZlbiB2YWx1ZSBhcyBhIHBhcmFtZXRlciB0byB0aGUgc3RhdGVtZW50Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRUaW1lKFByZXBhcmVkU3RhdGVt\nZW50IHN0bW50LCBpbnQgaWR4LCBUaW1lIHZhbCwKICAgICAgICBDYWxlbmRh\nciBjYWwsIENvbHVtbiBjb2wpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGNhbCA9PSBudWxsKQogICAgICAgICAgICBzdG1u\ndC5zZXRUaW1lKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAg\nIHN0bW50LnNldFRpbWUoaWR4LCB2YWwsIGNhbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTZXQgdGhlIGdpdmVuIHZhbHVlIGFzIGEgcGFyYW1ldGVyIHRv\nIHRoZSBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRp\nbWVzdGFtcChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlkeCwKICAg\nICAgICBUaW1lc3RhbXAgdmFsLCBDYWxlbmRhciBjYWwsIENvbHVtbiBjb2wp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gZW5z\ndXJlIHRoYXQgd2UgZG8gbm90IGluc2VydCBkYXRlcyBhdCBhIGdyZWF0ZXIg\ncHJlY2lzaW9uIHRoYW4KICAgICAgICAvLyB0aGF0IGF0IHdoaWNoIHRoZXkg\nd2lsbCBiZSByZXR1cm5lZCBieSBhIFNFTEVDVAogICAgICAgIGludCByb3Vu\nZGVkID0gKGludCkgTWF0aC5yb3VuZCh2YWwuZ2V0TmFub3MoKSAvCiAgICAg\nICAgICAgIChkb3VibGUpIGRhdGVQcmVjaXNpb24pOwogICAgICAgIGludCBu\nYW5vcyA9IHJvdW5kZWQgKiBkYXRlUHJlY2lzaW9uOwogICAgICAgIGlmIChu\nYW5vcyA+IDk5OTk5OTk5OSkgewogICAgICAgICAgICAvLyByb2xsb3ZlciB0\nbyBuZXh0IHNlY29uZAogICAgICAgICAgICB2YWwuc2V0VGltZSh2YWwuZ2V0\nVGltZSgpICsgMTAwMCk7CiAgICAgICAgICAgIG5hbm9zID0gMDsKICAgICAg\nICB9CgogICAgICAgIHZhbC5zZXROYW5vcyhuYW5vcyk7CgogICAgICAgIGlm\nIChjYWwgPT0gbnVsbCkKICAgICAgICAgICAgc3RtbnQuc2V0VGltZXN0YW1w\nKGlkeCwgdmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0bW50LnNl\ndFRpbWVzdGFtcChpZHgsIHZhbCwgY2FsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCBhIGNvbHVtbiB2YWx1ZSBpbnRvIGEgcHJlcGFyZWQgc3RhdGVt\nZW50LgogICAgICoKICAgICAqIEBwYXJhbSBzdG1udCB0aGUgcHJlcGFyZWQg\nc3RhdGVtZW50IHRvIHBhcmFtZXRlcml6ZQogICAgICogQHBhcmFtIGlkeCB0\naGUgaW5kZXggb2YgdGhlIHBhcmFtZXRlciBpbiB0aGUgcHJlcGFyZWQgc3Rh\ndGVtZW50CiAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSBvZiB0aGUgY29s\ndW1uCiAgICAgKiBAcGFyYW0gY29sIHRoZSBjb2x1bW4gYmVpbmcgc2V0CiAg\nICAgKiBAcGFyYW0gdHlwZSB0aGUgZmllbGQgbWFwcGluZyB0eXBlIGNvZGUg\nZm9yIHRoZSB2YWx1ZQogICAgICogQHBhcmFtIHN0b3JlIHRoZSBzdG9yZSBt\nYW5hZ2VyIGZvciB0aGUgY3VycmVudCBjb250ZXh0CiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldFR5cGVkKFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBp\nbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wsIGludCB0\neXBlLCBKREJDU3RvcmUgc3RvcmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAg\nIHNldE51bGwoc3RtbnQsIGlkeCwgKGNvbCA9PSBudWxsKSA/IFR5cGVzLk9U\nSEVSIDogY29sLmdldFR5cGUoKSwKICAgICAgICAgICAgICAgIGNvbCk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFNpemVkIHM7\nCiAgICAgICAgQ2FsZW5kYXJkIGM7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAgICAgICAgICAg\nICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJvb2xlYW4pIHZhbCkuYm9v\nbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURV9PQko6CiAgICAgICAgICAgICAgICBzZXRCeXRl\nKHN0bW50LCBpZHgsICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpLCBjb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJf\nT0JKOgogICAgICAgICAgICAgICAgc2V0Q2hhcihzdG1udCwgaWR4LCAoKENo\nYXJhY3RlcikgdmFsKS5jaGFyVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEU6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJMRV9PQko6CiAgICAg\nICAgICAgICAgICBzZXREb3VibGUoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZh\nbCkuZG91YmxlVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAg\nc2V0RmxvYXQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1\nZSgpLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuSU5UX09CSjoKICAgICAgICAgICAgICAgIHNldEludChzdG1udCwgaWR4\nLCAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpLCBjb2wpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAg\nICAgICAgICAgc2V0TG9uZyhzdG1udCwgaWR4LCAoKE51bWJlcikgdmFsKS5s\nb25nVmFsdWUoKSwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVDoKICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgc2V0U2hv\ncnQoc3RtbnQsIGlkeCwgKChOdW1iZXIpIHZhbCkuc2hvcnRWYWx1ZSgpLCBj\nb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIGlmIChjb2wgIT0g\nbnVsbCAmJiAoY29sLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CCiAgICAgICAg\nICAgICAgICAgICAgfHwgY29sLmdldFR5cGUoKSA9PSBUeXBlcy5MT05HVkFS\nQ0hBUikpCiAgICAgICAgICAgICAgICAgICAgc2V0Q2xvYlN0cmluZyhzdG1u\ndCwgaWR4LCAoU3RyaW5nKSB2YWwsIGNvbCk7CiAgICAgICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgs\nIChTdHJpbmcpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAgICAgICAgICAg\nICAgICBzZXRCbG9iT2JqZWN0KHN0bW50LCBpZHgsIHZhbCwgY29sLCBzdG9y\nZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHNldERhdGUoc3RtbnQs\nIGlkeCwgKERhdGUpIHZhbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAg\nICAgICAgICAgIHNldENhbGVuZGFyKHN0bW50LCBpZHgsIChDYWxlbmRhcikg\ndmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICBz\nZXRCaWdEZWNpbWFsKHN0bW50LCBpZHgsIChCaWdEZWNpbWFsKSB2YWwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgICAgIHNldEJpZ0lu\ndGVnZXIoc3RtbnQsIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5OVU1CRVI6CiAgICAgICAgICAgICAgICBzZXROdW1iZXIoc3RtbnQsIGlk\neCwgKE51bWJlcikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPQ0FMRToKICAgICAgICAg\nICAgICAgIHNldExvY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNv\nbCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBK\nYXZhU1FMVHlwZXMuU1FMX0FSUkFZOgogICAgICAgICAgICAgICAgc2V0QXJy\nYXkoc3RtbnQsIGlkeCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVND\nSUlfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXplZCkgdmFsOwog\nICAgICAgICAgICAgICAgc2V0QXNjaWlTdHJlYW0oc3RtbnQsIGlkeCwgKElu\ncHV0U3RyZWFtKSBzLnZhbHVlLCBzLnNpemUsIGNvbCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQklO\nQVJZX1NUUkVBTToKICAgICAgICAgICAgICAgIHMgPSAoU2l6ZWQpIHZhbDsK\nICAgICAgICAgICAgICAgIHNldEJpbmFyeVN0cmVhbShzdG1udCwgaWR4LCAo\nSW5wdXRTdHJlYW0pIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5C\nTE9COgogICAgICAgICAgICAgICAgc2V0QmxvYihzdG1udCwgaWR4LCAoQmxv\nYikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVNRTFR5cGVzLkJZVEVTOgogICAgICAgICAgICAgICAg\nc2V0Qnl0ZXMoc3RtbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5\ncGVzLkNIQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgcyA9IChTaXplZCkg\ndmFsOwogICAgICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50\nLCBpZHgsIChSZWFkZXIpIHMudmFsdWUsIHMuc2l6ZSwgY29sKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBl\ncy5DTE9COgogICAgICAgICAgICAgICAgc2V0Q2xvYihzdG1udCwgaWR4LCAo\nQ2xvYikgdmFsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9EQVRFOgogICAgICAgICAg\nICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyZCkgewogICAgICAg\nICAgICAgICAgICAgIGMgPSAoQ2FsZW5kYXJkKSB2YWw7CiAgICAgICAgICAg\nICAgICAgICAgc2V0RGF0ZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0ZSkg\nYy52YWx1ZSwgYy5jYWxlbmRhciwKICAgICAgICAgICAgICAgICAgICAgICAg\nY29sKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAg\nICAgIHNldERhdGUoc3RtbnQsIGlkeCwgKGphdmEuc3FsLkRhdGUpIHZhbCwg\nbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICBjYXNlIEphdmFTUUxUeXBlcy5SRUY6CiAgICAgICAgICAgICAgICBzZXRS\nZWYoc3RtbnQsIGlkeCwgKFJlZikgdmFsLCBjb2wpOwogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUU6\nCiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQ2FsZW5kYXJk\nKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IChDYWxlbmRhcmQpIHZhbDsK\nICAgICAgICAgICAgICAgICAgICBzZXRUaW1lKHN0bW50LCBpZHgsIChUaW1l\nKSBjLnZhbHVlLCBjLmNhbGVuZGFyLCBjb2wpOwogICAgICAgICAgICAgICAg\nfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZShzdG1udCwgaWR4\nLCAoVGltZSkgdmFsLCBudWxsLCBjb2wpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLlRJTUVTVEFNUDoK\nICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxlbmRhcmQp\nIHsKICAgICAgICAgICAgICAgICAgICBjID0gKENhbGVuZGFyZCkgdmFsOwog\nICAgICAgICAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAo\nVGltZXN0YW1wKSBjLnZhbHVlLCBjLmNhbGVuZGFyLAogICAgICAgICAgICAg\nICAgICAgICAgICBjb2wpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgc2V0VGltZXN0YW1wKHN0bW50LCBpZHgsIChUaW1l\nc3RhbXApIHZhbCwgbnVsbCwgY29sKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYgKGNv\nbCAhPSBudWxsICYmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IKICAg\nICAgICAgICAgICAgICAgICB8fCBjb2wuZ2V0VHlwZSgpID09IFR5cGVzLlZB\nUkJJTkFSWSkpCiAgICAgICAgICAgICAgICAgICAgc2V0QmxvYk9iamVjdChz\ndG1udCwgaWR4LCB2YWwsIGNvbCwgc3RvcmUpOwogICAgICAgICAgICAgICAg\nZWxzZQogICAgICAgICAgICAgICAgICAgIHNldE9iamVjdChzdG1udCwgaWR4\nLCB2YWwsIGNvbC5nZXRUeXBlKCksIGNvbCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IGEgY29tcGxldGVseSB1bmtub3duIHBhcmFt\nZXRlciBpbnRvIGEgcHJlcGFyZWQgc3RhdGVtZW50LgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRVbmtub3duKFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nLCBpbnQgaWR4LCBPYmplY3QgdmFsLAogICAgICAgIENvbHVtbiBjb2wpCiAg\nICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgU2l6ZWQgc2l6\nZWQgPSBudWxsOwogICAgICAgIENhbGVuZGFyZCBjYWxkID0gbnVsbDsKICAg\nICAgICBpZiAodmFsIGluc3RhbmNlb2YgU2l6ZWQpIHsKICAgICAgICAgICAg\nc2l6ZWQgPSAoU2l6ZWQpIHZhbDsKICAgICAgICAgICAgdmFsID0gc2l6ZWQu\ndmFsdWU7CiAgICAgICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBDYWxl\nbmRhcmQpIHsKICAgICAgICAgICAgY2FsZCA9IChDYWxlbmRhcmQpIHZhbDsK\nICAgICAgICAgICAgdmFsID0gY2FsZC52YWx1ZTsKICAgICAgICB9CgogICAg\nICAgIGlmICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgc2V0TnVsbChzdG1u\ndCwgaWR4LCAoY29sID09IG51bGwpID8gVHlwZXMuT1RIRVIgOiBjb2wuZ2V0\nVHlwZSgpLAogICAgICAgICAgICAgICAgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgIHNldFN0cmlu\nZyhzdG1udCwgaWR4LCB2YWwudG9TdHJpbmcoKSwgY29sKTsKICAgICAgICBl\nbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBJbnRlZ2VyKQogICAgICAgICAgICBz\nZXRJbnQoc3RtbnQsIGlkeCwgKChJbnRlZ2VyKSB2YWwpLmludFZhbHVlKCks\nIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQm9vbGVh\nbikKICAgICAgICAgICAgc2V0Qm9vbGVhbihzdG1udCwgaWR4LCAoKEJvb2xl\nYW4pIHZhbCkuYm9vbGVhblZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgTG9uZykKICAgICAgICAgICAgc2V0TG9uZyhz\ndG1udCwgaWR4LCAoKExvbmcpIHZhbCkubG9uZ1ZhbHVlKCksIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRmxvYXQpCiAgICAgICAg\nICAgIHNldEZsb2F0KHN0bW50LCBpZHgsICgoRmxvYXQpIHZhbCkuZmxvYXRW\nYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIERvdWJsZSkKICAgICAgICAgICAgc2V0RG91YmxlKHN0bW50LCBpZHgsICgo\nRG91YmxlKSB2YWwpLmRvdWJsZVZhbHVlKCksIGNvbCk7CiAgICAgICAgZWxz\nZSBpZiAodmFsIGluc3RhbmNlb2YgQnl0ZSkKICAgICAgICAgICAgc2V0Qnl0\nZShzdG1udCwgaWR4LCAoKEJ5dGUpIHZhbCkuYnl0ZVZhbHVlKCksIGNvbCk7\nCiAgICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQ2hhcmFjdGVyKQog\nICAgICAgICAgICBzZXRDaGFyKHN0bW50LCBpZHgsICgoQ2hhcmFjdGVyKSB2\nYWwpLmNoYXJWYWx1ZSgpLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIFNob3J0KQogICAgICAgICAgICBzZXRTaG9ydChzdG1udCwg\naWR4LCAoKFNob3J0KSB2YWwpLnNob3J0VmFsdWUoKSwgY29sKTsKICAgICAg\nICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBMb2NhbGUpCiAgICAgICAgICAg\nIHNldExvY2FsZShzdG1udCwgaWR4LCAoTG9jYWxlKSB2YWwsIGNvbCk7CiAg\nICAgICAgZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgQmlnRGVjaW1hbCkKICAg\nICAgICAgICAgc2V0QmlnRGVjaW1hbChzdG1udCwgaWR4LCAoQmlnRGVjaW1h\nbCkgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9m\nIEJpZ0ludGVnZXIpCiAgICAgICAgICAgIHNldEJpZ0ludGVnZXIoc3RtbnQs\nIGlkeCwgKEJpZ0ludGVnZXIpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICAgICAgc2V0QXJyYXko\nc3RtbnQsIGlkeCwgKEFycmF5KSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBp\nZiAodmFsIGluc3RhbmNlb2YgQmxvYikKICAgICAgICAgICAgc2V0QmxvYihz\ndG1udCwgaWR4LCAoQmxvYikgdmFsLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIGJ5dGVbXSkKICAgICAgICAgICAgc2V0Qnl0ZXMo\nc3RtbnQsIGlkeCwgKGJ5dGVbXSkgdmFsLCBjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHZhbCBpbnN0YW5jZW9mIENsb2IpCiAgICAgICAgICAgIHNldENsb2Io\nc3RtbnQsIGlkeCwgKENsb2IpIHZhbCwgY29sKTsKICAgICAgICBlbHNlIGlm\nICh2YWwgaW5zdGFuY2VvZiBSZWYpCiAgICAgICAgICAgIHNldFJlZihzdG1u\ndCwgaWR4LCAoUmVmKSB2YWwsIGNvbCk7CiAgICAgICAgZWxzZSBpZiAodmFs\nIGluc3RhbmNlb2YgamF2YS5zcWwuRGF0ZSkKICAgICAgICAgICAgc2V0RGF0\nZShzdG1udCwgaWR4LCAoamF2YS5zcWwuRGF0ZSkgdmFsLAogICAgICAgICAg\nICAgICAgKGNhbGQgPT0gbnVsbCkgPyBudWxsIDogY2FsZC5jYWxlbmRhciwg\nY29sKTsKICAgICAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBUaW1lc3Rh\nbXApCiAgICAgICAgICAgIHNldFRpbWVzdGFtcChzdG1udCwgaWR4LCAoVGlt\nZXN0YW1wKSB2YWwsCiAgICAgICAgICAgICAgICAoY2FsZCA9PSBudWxsKSA/\nIG51bGwgOiBjYWxkLmNhbGVuZGFyLCBjb2wpOwogICAgICAgIGVsc2UgaWYg\nKHZhbCBpbnN0YW5jZW9mIFRpbWUpCiAgICAgICAgICAgIHNldFRpbWUoc3Rt\nbnQsIGlkeCwgKFRpbWUpIHZhbCwKICAgICAgICAgICAgICAgIChjYWxkID09\nIG51bGwpID8gbnVsbCA6IGNhbGQuY2FsZW5kYXIsIGNvbCk7CiAgICAgICAg\nZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICAgICAgc2V0\nRGF0ZShzdG1udCwgaWR4LCAoRGF0ZSkgdmFsLCBjb2wpOwogICAgICAgIGVs\nc2UgaWYgKHZhbCBpbnN0YW5jZW9mIENhbGVuZGFyKQogICAgICAgICAgICBz\nZXREYXRlKHN0bW50LCBpZHgsICgoQ2FsZW5kYXIpIHZhbCkuZ2V0VGltZSgp\nLCBjb2wpOwogICAgICAgIGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJlYWRl\ncikKICAgICAgICAgICAgc2V0Q2hhcmFjdGVyU3RyZWFtKHN0bW50LCBpZHgs\nIChSZWFkZXIpIHZhbCwKICAgICAgICAgICAgICAgIChzaXplZCA9PSBudWxs\nKSA/IDAgOiBzaXplZC5zaXplLCBjb2wpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJhZC1w\nYXJhbSIsIHZhbC5nZXRDbGFzcygpKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHNlcmlhbGl6ZWQgYnl0ZXMgZm9yIHRoZSBnaXZlbiBv\nYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBieXRlW10gc2VyaWFsaXplKE9i\namVjdCB2YWwsIEpEQkNTdG9yZSBzdG9yZSkKICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAodmFsID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBT\nZXJpYWxpemVkRGF0YSkKICAgICAgICAgICAgcmV0dXJuICgoU2VyaWFsaXpl\nZERhdGEpIHZhbCkuYnl0ZXM7CiAgICAgICAgcmV0dXJuIFNlcmlhbGl6YXRp\nb24uc2VyaWFsaXplKHZhbCwgc3RvcmUuZ2V0Q29udGV4dCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRC\neXRlczwvY29kZT4gbWV0aG9kIG9uIHRoZSBnaXZlbiBCTE9CIG9iamVjdC4K\nICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Qnl0ZXMoQmxvYiBibG9iLCBi\neXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBibG9iLnNldEJ5dGVzKDFMLCBkYXRhKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEludm9rZSB0aGUgSkRLIDEuNCA8Y29kZT5zZXRTdHJpbmc8L2Nv\nZGU+IG1ldGhvZCBvbiB0aGUgZ2l2ZW4gQ0xPQgogICAgICogb2JqZWN0Lgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBwdXRTdHJpbmcoQ2xvYiBjbG9iLCBT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBjbG9iLnNldFN0cmluZygxTCwgZGF0YSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbnZva2UgdGhlIEpESyAxLjQgPGNvZGU+c2V0Q2hhcmFjdGVy\nU3RyZWFtPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuCiAgICAgKiBDTE9C\nIG9iamVjdC4KICAgICAqLwogICAgcHVibGljIHZvaWQgcHV0Q2hhcnMoQ2xv\nYiBjbG9iLCBjaGFyW10gZGF0YSkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBXcml0ZXIgd3JpdGVyID0gY2xvYi5zZXRDaGFyYWN0\nZXJTdHJlYW0oMUwpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdyaXRl\nci53cml0ZShkYXRhKTsKICAgICAgICAgICAgd3JpdGVyLmZsdXNoKCk7CiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBTUUxFeGNlcHRpb24oaW9lLnRvU3RyaW5nKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdhcm4gdGhhdCBhIHBhcnRp\nY3VsYXIgdmFsdWUgY291bGQgbm90IGJlIHN0b3JlZCBwcmVjaXNlbHkuCiAg\nICAgKiBBZnRlciB0aGUgZmlyc3Qgd2FybmluZyBmb3IgYSBwYXJ0aWN1bGFy\nIHR5cGUsIG1lc3NhZ2VzCiAgICAgKiB3aWxsIGJlIHR1cm5lZCBpbnRvIHRy\nYWNlIG1lc3NhZ2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9y\nYWdlV2FybmluZyhPYmplY3Qgb3JpZywgT2JqZWN0IGNvbnZlcnRlZCkgewog\nICAgICAgIGJvb2xlYW4gd2FybjsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgaWYgKF9wcmVjaXNpb25XYXJuZWRUeXBlcyA9\nPSBudWxsKQogICAgICAgICAgICAgICAgX3ByZWNpc2lvbldhcm5lZFR5cGVz\nID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICAgICAgd2FybiA9IF9wcmVjaXNp\nb25XYXJuZWRUeXBlcy5hZGQob3JpZy5nZXRDbGFzcygpKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChzdG9yYWdlTGltaXRhdGlvbnNGYXRhbCB8fCAod2Fy\nbiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICB8fCAoIXdh\ncm4gJiYgbG9nLmlzVHJhY2VFbmFibGVkKCkpKSB7CiAgICAgICAgICAgIE1l\nc3NhZ2UgbXNnID0gX2xvYy5nZXQoInN0b3JhZ2UtcmVzdHJpY3Rpb24iLCBu\nZXcgT2JqZWN0W117CiAgICAgICAgICAgICAgICBwbGF0Zm9ybSwKICAgICAg\nICAgICAgICAgIG9yaWcsCiAgICAgICAgICAgICAgICBvcmlnLmdldENsYXNz\nKCkuZ2V0TmFtZSgpLAogICAgICAgICAgICAgICAgY29udmVydGVkLAogICAg\nICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChzdG9yYWdlTGltaXRhdGlv\nbnNGYXRhbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2Vw\ndGlvbihtc2cpOwoKICAgICAgICAgICAgaWYgKHdhcm4pCiAgICAgICAgICAg\nICAgICBsb2cud2Fybihtc2cpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBsb2cudHJhY2UobXNnKTsKICAgICAgICB9CiAgICB9CgogICAg\nLy8vLy8vLy8vCiAgICAvLyBUeXBlcwogICAgLy8vLy8vLy8vCiAgICAKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVz\nfSBjb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5\ncGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAq\nLwogICAgcHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2Rl\nLCBib29sZWFuIGxvYikgewogICAgICAgIHJldHVybiBnZXRKREJDVHlwZSht\nZXRhVHlwZUNvZGUsIGxvYiwgMCwgMCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9IGNvbnN0YW50\nIGZvciB0aGUgZ2l2ZW4KICAgICAqIHtAbGluayBKYXZhVHlwZXN9IG9yIHtA\nbGluayBKYXZhU1FMVHlwZXN9IGNvbnN0YW50LgogICAgICovCiAgICBwdWJs\naWMgaW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4g\nbG9iLCBpbnQgcHJlY2lzLCAKICAgICAgICBpbnQgc2NhbGUsIGJvb2xlYW4g\neG1sKSB7CiAgICAgICAgcmV0dXJuIGdldEpEQkNUeXBlKG1ldGFUeXBlQ29k\nZSwgbG9iLCBwcmVjaXMsIHNjYWxlKTsgICAgICAgIAogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJyZWQge0BsaW5rIFR5cGVzfSBj\nb25zdGFudCBmb3IgdGhlIGdpdmVuCiAgICAgKiB7QGxpbmsgSmF2YVR5cGVz\nfSBvciB7QGxpbmsgSmF2YVNRTFR5cGVzfSBjb25zdGFudC4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRKREJDVHlwZShpbnQgbWV0YVR5cGVDb2RlLCBi\nb29sZWFuIGxvYiwgaW50IHByZWNpcywgCiAgICAgICAgaW50IHNjYWxlKSB7\nCiAgICAgICAgaWYgKGxvYikgewogICAgICAgICAgICBzd2l0Y2ggKG1ldGFU\neXBlQ29kZSkgewogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RS\nSU5HOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQVNDSUlf\nU1RSRUFNOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQ0hB\nUl9TVFJFQU06CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZl\ncnJlZFR5cGUoVHlwZXMuQ0xPQik7CiAgICAgICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBl\nKFR5cGVzLkJMT0IpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBzd2l0Y2ggKG1ldGFUeXBlQ29kZSkgewogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CT09MRUFOOgogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJy\nZWRUeXBlKFR5cGVzLkJJVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMu\nVElOWUlOVCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVI6CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNIQVJfT0JKOgogICAgICAgICAg\nICAgICAgaWYgKHN0b3JlQ2hhcnNBc051bWJlcnMpCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuSU5URUdFUik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBl\ncy5DSEFSKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgogICAgICAg\nICAgICAgICAgaWYocHJlY2lzID4gMCB8fCBzY2FsZSA+IDApIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5O\nVU1FUklDKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRU\neXBlKFR5cGVzLkRPVUJMRSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5GTE9BVF9PQko6CiAgICAgICAgICAgICAgICBpZihwcmVjaXMg\nPiAwIHx8IHNjYWxlID4gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuUkVBTCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLklOVEVH\nRVIpOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkJJR0lOVCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5TTUFMTElOVCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9DQUxFOgogICAgICAgICAgICBjYXNlIEphdmFTUUxUeXBlcy5B\nU0NJSV9TVFJFQU06CiAgICAgICAgICAgIGNhc2UgSmF2YVNRTFR5cGVzLkNI\nQVJfU1RSRUFNOgogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJl\nZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBpZiAoc3RvcmVMYXJn\nZU51bWJlcnNBc1N0cmluZ3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CSUdJTlQpOwog\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CSUdERUNJTUFMOgogICAgICAg\nICAgICAgICAgaWYgKHN0b3JlTGFyZ2VOdW1iZXJzQXNTdHJpbmdzKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVz\nLlZBUkNIQVIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGdldFByZWZlcnJl\nZFR5cGUoVHlwZXMuTlVNRVJJQyk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk5VTUJFUjoKICAgICAgICAgICAgICAgIGlmIChzdG9yZUxhcmdlTnVt\nYmVyc0FzU3RyaW5ncykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0\nUHJlZmVycmVkVHlwZShUeXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLk5VTUVSSUMpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVNRTFR5cGVzLlNRTF9BUlJBWToKICAgICAgICAgICAgICAg\nIHJldHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkFSUkFZKTsKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQklOQVJZX1NUUkVBTToKICAgICAg\nICAgICAgY2FzZSBKYXZhU1FMVHlwZXMuQkxPQjoKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQllURVM6CiAgICAgICAgICAgICAgICByZXR1cm4g\nZ2V0UHJlZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICAgICAgY2Fz\nZSBKYXZhU1FMVHlwZXMuQ0xPQjoKICAgICAgICAgICAgICAgIHJldHVybiBn\nZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgICAgICBjYXNl\nIEphdmFTUUxUeXBlcy5TUUxfREFURToKICAgICAgICAgICAgICAgIHJldHVy\nbiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLkRBVEUpOwogICAgICAgICAgICBj\nYXNlIEphdmFTUUxUeXBlcy5USU1FOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGdldFByZWZlcnJlZFR5cGUoVHlwZXMuVElNRSk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVNRTFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJyZWRUeXBlKFR5cGVzLlRJTUVTVEFNUCk7CiAgICAg\nICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJl\nZmVycmVkVHlwZShUeXBlcy5CTE9CKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXR1cm4gdGhlIHByZWZlcnJlZCB7QGxpbmsgVHlwZXN9\nIHR5cGUgZm9yIHRoZSBnaXZlbiBvbmUuIFJldHVybnMKICAgICAqIHRoZSBn\naXZlbiB0eXBlIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0UHJlZmVycmVkVHlwZShpbnQgdHlwZSkgewogICAgICAgIHJldHVybiB0\neXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcmVmZXJy\nZWQgZGF0YWJhc2UgdHlwZSBuYW1lIGZvciB0aGUgZ2l2ZW4gY29sdW1uJ3Mg\ndHlwZQogICAgICogZnJvbSB7QGxpbmsgVHlwZXN9LgogICAgICovCiAgICBw\ndWJsaWMgU3RyaW5nIGdldFR5cGVOYW1lKENvbHVtbiBjb2wpIHsKICAgICAg\nICBpZiAoIURCSWRlbnRpZmllci5pc0VtcHR5KGNvbC5nZXRUeXBlSWRlbnRp\nZmllcigpKSkKICAgICAgICAgICAgcmV0dXJuIGFwcGVuZFNpemUoY29sLCB0\nb0RCTmFtZShjb2wuZ2V0VHlwZUlkZW50aWZpZXIoKSkpOwoKICAgICAgICBp\nZiAoY29sLmlzQXV0b0Fzc2lnbmVkKCkgJiYgYXV0b0Fzc2lnblR5cGVOYW1l\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBhcHBlbmRTaXplKGNvbCwg\nYXV0b0Fzc2lnblR5cGVOYW1lKTsKCiAgICAgICAgcmV0dXJuIGFwcGVuZFNp\nemUoY29sLCBnZXRUeXBlTmFtZShjb2wuZ2V0VHlwZSgpKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB0eXBlIG5hbWUgZm9yIHRoZSBz\ncGVjaWZpYyBjb25zdGFudCBhcyBkZWZpbmVkCiAgICAgKiBieSB7QGxpbmsg\namF2YS5zcWwuVHlwZXN9LgogICAgICoKICAgICAqIEBwYXJhbSB0eXBlIHRo\nZSB0eXBlCiAgICAgKiBAcmV0dXJuIHRoZSBuYW1lIGZvciB0aGUgdHlwZQog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFR5cGVOYW1lKGludCB0eXBl\nKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2Ug\nVHlwZXMuQVJSQVk6CiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXlUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CSUdJTlQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gYmlnaW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNh\nc2UgVHlwZXMuQklOQVJZOgogICAgICAgICAgICAgICAgcmV0dXJuIGJpbmFy\neVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkJJVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBiaXRUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CTE9COgogICAgICAgICAgICAgICAgcmV0dXJuIGJsb2JUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGJvb2xlYW5UeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXJU\neXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5DTE9COgogICAgICAg\nICAgICAgICAgcmV0dXJuIGNsb2JUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5EQVRFOgogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVUeXBl\nTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5ERUNJTUFMOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGRlY2ltYWxUeXBlTmFtZTsKICAgICAgICAgICAg\nY2FzZSBUeXBlcy5ESVNUSU5DVDoKICAgICAgICAgICAgICAgIHJldHVybiBk\naXN0aW5jdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgIHJldHVybiBkb3VibGVUeXBlTmFtZTsKICAg\nICAgICAgICAgY2FzZSBUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJl\ndHVybiBmbG9hdFR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLklO\nVEVHRVI6CiAgICAgICAgICAgICAgICByZXR1cm4gaW50ZWdlclR5cGVOYW1l\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkpBVkFfT0JKRUNUOgogICAgICAg\nICAgICAgICAgcmV0dXJuIGphdmFPYmplY3RUeXBlTmFtZTsKICAgICAgICAg\nICAgY2FzZSBUeXBlcy5MT05HVkFSQklOQVJZOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGxvbmdWYXJiaW5hcnlUeXBlTmFtZTsKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5MT05HVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBs\nb25nVmFyY2hhclR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLk5V\nTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbFR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLk5VTUVSSUM6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVtZXJpY1R5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVz\nLk9USEVSOgogICAgICAgICAgICAgICAgcmV0dXJuIG90aGVyVHlwZU5hbWU7\nCiAgICAgICAgICAgIGNhc2UgVHlwZXMuUkVBTDoKICAgICAgICAgICAgICAg\nIHJldHVybiByZWFsVHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlwZXMu\nUkVGOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlZlR5cGVOYW1lOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICAgICAg\ncmV0dXJuIHNtYWxsaW50VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuU1RSVUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIHN0cnVjdFR5cGVO\nYW1lOwogICAgICAgICAgICBjYXNlIFR5cGVzLlRJTUU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGltZVR5cGVOYW1lOwogICAgICAgICAgICBjYXNlIFR5\ncGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lc3Rh\nbXBUeXBlTmFtZTsKICAgICAgICAgICAgY2FzZSBUeXBlcy5USU5ZSU5UOgog\nICAgICAgICAgICAgICAgcmV0dXJuIHRpbnlpbnRUeXBlTmFtZTsKICAgICAg\nICAgICAgY2FzZSBUeXBlcy5WQVJCSU5BUlk6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdmFyYmluYXJ5VHlwZU5hbWU7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuVkFSQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiB2YXJjaGFyVHlw\nZU5hbWU7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gb3RoZXJUeXBlTmFtZTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFkZCBzaXplIHByb3BlcnRpZXMg\ndG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICogSWYgcHJlc2VudCwgdGhl\nIHN0cmluZyAiezB9IiB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIHNpemUg\nZGVmaW5pdGlvbjsKICAgICAqIG90aGVyd2lzZSB0aGUgc2l6ZSBkZWZpbml0\naW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIHR5cGUgbmFtZS4KICAgICAq\nIElmIHlvdXIgZGF0YWJhc2UgaGFzIGNvbHVtbiB0eXBlcyB0aGF0IGRvbid0\nIGFsbG93IHNpemUgZGVmaW5pdGlvbnMsCiAgICAgKiBvdmVycmlkZSB0aGlz\nIG1ldGhvZCB0byByZXR1cm4gdGhlIHVuYWx0ZXJlZCB0eXBlIG5hbWUgZm9y\nIGNvbHVtbnMgb2YKICAgICAqIHRob3NlIHR5cGVzIChvciBhZGQgdGhlIHR5\ncGUgbmFtZXMgdG8gdGhlCiAgICAgKiA8Y29kZT5maXhlZFNpemVUeXBlTmFt\nZVNldDwvY29kZT4pLgogICAgICogCiAgICAgKiA8UD5Tb21lIGRhdGFiYXNl\ncyBzdXBwb3J0ICJ0eXBlIG1vZGlmaWVycyIsIGZvciBleGFtcGxlIHRoZSB1\nbnNpZ25lZAogICAgICogIm1vZGlmaWVyIiBpbiBNeVNRTC4gSW4gdGhlc2Ug\nY2FzZXMgdGhlIHNpemUgc2hvdWxkIGdvIGJldHdlZW4gdGhlIHR5cGUgCiAg\nICAgKiBhbmQgdGhlICJtb2RpZmllciIsIGluc3RlYWQgb2YgYWZ0ZXIgdGhl\nIG1vZGlmaWVyLiBGb3IgZXhhbXBsZSAKICAgICAqIENSRUFURSB0YWJsZSBG\nT08gKCBteWludCBJTlQgKDEwKSBVTlNJR05FRCAuIC4gLikgaW5zdGVhZCBv\nZiAKICAgICAqIENSRUFURSB0YWJsZSBGT08gKCBteWludCBJTlQgVU5TSUdO\nRUQgKDEwKSAuIC4gLikuCiAgICAgKiBUeXBlIG1vZGlmaWVycyBzaG91bGQg\nYmUgYWRkZWQgdG8gPGNvZGU+dHlwZU1vZGlmaWVyU2V0PC9jb2RlPiBpbiAK\nICAgICAqIHN1YmNsYXNzZXMuIAogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGFwcGVuZFNpemUoQ29sdW1uIGNvbCwgU3RyaW5nIHR5cGVOYW1lKSB7\nCiAgICAgICAgaWYgKGZpeGVkU2l6ZVR5cGVOYW1lU2V0LmNvbnRhaW5zKHR5\ncGVOYW1lLnRvVXBwZXJDYXNlKCkpKQogICAgICAgICAgICByZXR1cm4gdHlw\nZU5hbWU7CiAgICAgICAgaWYgKHR5cGVOYW1lLmluZGV4T2YoJygnKSAhPSAt\nMSkKICAgICAgICAgICAgcmV0dXJuIHR5cGVOYW1lOwoKICAgICAgICBTdHJp\nbmcgc2l6ZSA9IG51bGw7CiAgICAgICAgaWYgKGNvbC5nZXRTaXplKCkgPiAw\nKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1aWxkZXIoMTApOwogICAgICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBw\nZW5kKGNvbC5nZXRTaXplKCkpOwogICAgICAgICAgICBpZiAoY29sLmdldERl\nY2ltYWxEaWdpdHMoKSA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5k\nKCIsICIpLmFwcGVuZChjb2wuZ2V0RGVjaW1hbERpZ2l0cygpKTsKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgICAgICAgICBzaXplID0gYnVm\nLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaW5zZXJ0\nU2l6ZSh0eXBlTmFtZSwgc2l6ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBI\nZWxwZXIgbWV0aG9kIHRoYXQgaW5zZXJ0cyBhIHNpemUgY2xhdXNlIGZvciBh\nIGdpdmVuIFNRTCB0eXBlLiAKICAgICAqIAogICAgICogQHNlZSBhcHBlbmRT\naXplCiAgICAgKiAKICAgICAqIEBwYXJhbSB0eXBlTmFtZSAgVGhlIFNRTCB0\neXBlIGUuZy4gSU5UCiAgICAgKiBAcGFyYW0gc2l6ZSAgICAgIFRoZSBzaXpl\nIGNsYXVzZSBlLmcuICgxMCkKICAgICAqIEByZXR1cm4gICAgICAgICAgVGhl\nIHR5cGVOYW1lICsgc2l6ZSBjbGF1c2UuIFVzdWFsbHkgdGhlIHNpemUgY2xh\ndXNlIHdpbGwKICAgICAqICAgICAgICAgICAgICAgICAgYmUgYXBwZW5kZWQg\ndG8gdHlwZU5hbWUuIElmIHRoZSB0eXBlTmFtZSBjb250YWlucyBhIAogICAg\nICogICAgICAgICAgICAgICAgICBtYXJrZXIgOiB7MH0gb3IgaWYgdHlwZU5h\nbWUgY29udGFpbnMgYSBtb2RpZmllciB0aGUgCiAgICAgKiAgICAgICAgICAg\nICAgICAgIHNpemUgY2xhdXNlIHdpbGwgYmUgaW5zZXJ0ZWQgYXBwcm9wcmlh\ndGVseS4gICAKICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBpbnNlcnRT\naXplKFN0cmluZyB0eXBlTmFtZSwgU3RyaW5nIHNpemUpIHsKICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzaXplKSkgewogICAgICAgICAgICBp\nbnQgaWR4ID0gdHlwZU5hbWUuaW5kZXhPZigiezB9Iik7CiAgICAgICAgICAg\nIGlmIChpZHggIT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBl\nTmFtZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gdHlwZU5hbWU7CiAgICAgICAgfQogICAgICAgIAogICAg\nICAgIGludCBpZHggPSB0eXBlTmFtZS5pbmRleE9mKCJ7MH0iKTsKICAgICAg\nICBpZiAoaWR4ICE9IC0xKSB7CiAgICAgICAgICAgIC8vIHJlcGxhY2UgJ3sw\nfScgd2l0aCBzaXplCiAgICAgICAgICAgIFN0cmluZyByZXQgPSB0eXBlTmFt\nZS5zdWJzdHJpbmcoMCwgaWR4KTsKICAgICAgICAgICAgaWYgKHNpemUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldCA9IHJldCArIHNpemU7CiAgICAg\nICAgICAgIGlmICh0eXBlTmFtZS5sZW5ndGgoKSA+IGlkeCArIDMpCiAgICAg\nICAgICAgICAgICByZXQgPSByZXQgKyB0eXBlTmFtZS5zdWJzdHJpbmcoaWR4\nICsgMyk7CiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQogICAg\nICAgIGlmICghdHlwZU1vZGlmaWVyU2V0LmlzRW1wdHkoKSkgewogICAgICAg\nICAgICBTdHJpbmcgczsKICAgICAgICAgICAgaWR4ID0gdHlwZU5hbWUubGVu\nZ3RoKCk7CiAgICAgICAgICAgIGludCBjdXJJZHggPSAtMTsKICAgICAgICAg\nICAgZm9yIChJdGVyYXRvciBpID0gdHlwZU1vZGlmaWVyU2V0Lml0ZXJhdG9y\nKCk7IGkuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgcyA9IChTdHJp\nbmcpIGkubmV4dCgpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVOYW1lLnRv\nVXBwZXJDYXNlKCkuaW5kZXhPZihzKSAhPSAtMSkgewogICAgICAgICAgICAg\nICAgICAgIGN1cklkeCA9IHR5cGVOYW1lLnRvVXBwZXJDYXNlKCkuaW5kZXhP\nZihzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VySWR4ICE9IC0xICYm\nIGN1cklkeCA8IGlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZHgg\nPSBjdXJJZHg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGlkeCAhPSB0eXBl\nTmFtZS5sZW5ndGgoKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIHJldCA9\nIHR5cGVOYW1lLnN1YnN0cmluZygwLCBpZHgpOwogICAgICAgICAgICAgICAg\ncmV0ID0gcmV0ICsgc2l6ZTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCAr\nICcgJyArIHR5cGVOYW1lLnN1YnN0cmluZyhpZHgpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdHlwZU5hbWUgKyBzaXplOwogICAgfQoKICAgIC8vLy8vLy8v\nLy8vCiAgICAvLyBTZWxlY3RzCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgog\nICAgICogU2V0IHRoZSBuYW1lIG9mIHRoZSBqb2luIHN5bnRheCB0byB1c2U6\nIHNxbDkyLCB0cmFkaXRpb25hbCwgZGF0YWJhc2UuCiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIHNldEpvaW5TeW50YXgoU3RyaW5nIHN5bnRheCkgewogICAg\nICAgIGlmICgic3FsOTIiLmVxdWFscyhzeW50YXgpKQogICAgICAgICAgICBq\nb2luU3ludGF4ID0gU1lOVEFYX1NRTDkyOwogICAgICAgIGVsc2UgaWYgKCJ0\ncmFkaXRpb25hbCIuZXF1YWxzKHN5bnRheCkpCiAgICAgICAgICAgIGpvaW5T\neW50YXggPSBTWU5UQVhfVFJBRElUSU9OQUw7CiAgICAgICAgZWxzZSBpZiAo\nImRhdGFiYXNlIi5lcXVhbHMoc3ludGF4KSkKICAgICAgICAgICAgam9pblN5\nbnRheCA9IFNZTlRBWF9EQVRBQkFTRTsKICAgICAgICBlbHNlIGlmICghU3Ry\naW5nVXRpbHMuaXNFbXB0eShzeW50YXgpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHN5bnRheCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gYSBTUUwgc3RyaW5nIHRvIGFjdCBhcyBh\nIHBsYWNlaG9sZGVyIGZvciB0aGUgZ2l2ZW4gY29sdW1uLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFBsYWNlaG9sZGVyVmFsdWVTdHJpbmcoQ29s\ndW1uIGNvbCkgewogICAgICAgIHN3aXRjaCAoY29sLmdldFR5cGUoKSkgewog\nICAgICAgICAgICBjYXNlIFR5cGVzLkJJR0lOVDoKICAgICAgICAgICAgY2Fz\nZSBUeXBlcy5CSVQ6CiAgICAgICAgICAgIGNhc2UgVHlwZXMuSU5URUdFUjoK\nICAgICAgICAgICAgY2FzZSBUeXBlcy5OVU1FUklDOgogICAgICAgICAgICBj\nYXNlIFR5cGVzLlNNQUxMSU5UOgogICAgICAgICAgICBjYXNlIFR5cGVzLlRJ\nTllJTlQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIjAiOwogICAgICAgICAg\nICBjYXNlIFR5cGVzLkNIQVI6CiAgICAgICAgICAgICAgICByZXR1cm4gKHN0\nb3JlQ2hhcnNBc051bWJlcnMpID8gIjAiIDogIicgJyI7CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuQ0xPQjoKICAgICAgICAgICAgY2FzZSBUeXBlcy5MT05H\nVkFSQ0hBUjoKICAgICAgICAgICAgY2FzZSBUeXBlcy5WQVJDSEFSOgogICAg\nICAgICAgICAgICAgcmV0dXJuICInJyI7CiAgICAgICAgICAgIGNhc2UgVHlw\nZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX0RBVEVfU1RS\nOwogICAgICAgICAgICBjYXNlIFR5cGVzLkRFQ0lNQUw6CiAgICAgICAgICAg\nIGNhc2UgVHlwZXMuRE9VQkxFOgogICAgICAgICAgICBjYXNlIFR5cGVzLkZM\nT0FUOgogICAgICAgICAgICBjYXNlIFR5cGVzLlJFQUw6CiAgICAgICAgICAg\nICAgICByZXR1cm4gIjAuMCI7CiAgICAgICAgICAgIGNhc2UgVHlwZXMuVElN\nRToKICAgICAgICAgICAgICAgIHJldHVybiBaRVJPX1RJTUVfU1RSOwogICAg\nICAgICAgICBjYXNlIFR5cGVzLlRJTUVTVEFNUDoKICAgICAgICAgICAgICAg\nIHJldHVybiBaRVJPX1RJTUVTVEFNUF9TVFI7CiAgICAgICAgICAgIGRlZmF1\nbHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIk5VTEwiOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIFNFTEVDVCBDT1VOVCBz\ndGF0ZW1lbnQgaW4gdGhlIHByb3BlciBqb2luIHN5bnRheCBmb3IgdGhlCiAg\nICAgKiBnaXZlbiBpbnN0YW5jZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciB0b1NlbGVjdENvdW50KFNlbGVjdCBzZWwpIHsKICAgICAgICBTUUxC\ndWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAg\nICBTUUxCdWZmZXIgZnJvbTsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29u\nZGl0aW9ucygpOwogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9\nIG51bGwpCiAgICAgICAgICAgIGZyb20gPSBnZXRGcm9tU2VsZWN0KHNlbCwg\nZmFsc2UpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZnJvbSA9IGdldEZy\nb20oc2VsLCBmYWxzZSk7CiAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gZ2V0\nV2hlcmUoc2VsLCBmYWxzZSk7CgogICAgICAgIC8vIGlmIG5vIGdyb3VwaW5n\nIGFuZCBubyByYW5nZSwgd2UgbWlnaHQgYmUgYWJsZSB0byBnZXQgYnkgd2l0\naG91dAogICAgICAgIC8vIGEgc3Vic2VsZWN0CiAgICAgICAgaWYgKHNlbC5n\nZXRHcm91cGluZygpID09IG51bGwgJiYgc2VsLmdldFN0YXJ0SW5kZXgoKSA9\nPSAwCiAgICAgICAgICAgICYmIHNlbC5nZXRFbmRJbmRleCgpID09IExvbmcu\nTUFYX1ZBTFVFKSB7CiAgICAgICAgICAgIC8vIGlmIHRoZSBzZWxlY3QgaGFz\nIG5vIGlkZW50aWZpZXIgY29scywgdXNlIENPVU5UKCopCiAgICAgICAgICAg\nIExpc3QgYWxpYXNlcyA9ICghc2VsLmlzRGlzdGluY3QoKSkgPyBDb2xsZWN0\naW9ucy5FTVBUWV9MSVNUCiAgICAgICAgICAgICAgICA6IHNlbC5nZXRJZGVu\ndGlmaWVyQWxpYXNlcygpOwogICAgICAgICAgICBpZiAodXNlV2lsZENhcmRG\nb3JDb3VudCB8fCBhbGlhc2VzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAg\nICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoKikiKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0b1NlbGVjdChzZWxlY3RTUUwsIG51bGwsIGZyb20sIHdo\nZXJlLCBudWxsLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgIGZh\nbHNlLCBmYWxzZSwgMCwgTG9uZy5NQVhfVkFMVUUpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhIHNpbmdsZSBkaXN0aW5j\ndCBjb2wsIHVzZSBDT1VOVChESVNUSU5DVCBjb2wpCiAgICAgICAgICAgIGlm\nIChhbGlhc2VzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgICAgICBzZWxl\nY3RTUUwuYXBwZW5kKCJDT1VOVChESVNUSU5DVCAiKS4KICAgICAgICAgICAg\nICAgICAgICBhcHBlbmQoYWxpYXNlcy5nZXQoMCkudG9TdHJpbmcoKSkuYXBw\nZW5kKCIpIik7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2Vs\nZWN0U1FMLCBudWxsLCBmcm9tLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwK\nICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFY\nX1ZBTFVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2FuIHdl\nIGNvbWJpbmUgZGlzdGluY3QgY29scz8KICAgICAgICAgICAgaWYgKGRpc3Rp\nbmN0Q291bnRDb2x1bW5TZXBhcmF0b3IgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiQ09VTlQoRElTVElOQ1QgIik7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFsaWFzZXMuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiICIp\nOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKGRp\nc3RpbmN0Q291bnRDb2x1bW5TZXBhcmF0b3IpOwogICAgICAgICAgICAgICAg\nICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIgIik7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQo\nYWxpYXNlcy5nZXQoaSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKCIpIik7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdG9TZWxlY3Qoc2VsZWN0U1FMLCBudWxsLCBm\ncm9tLCB3aGVyZSwgbnVsbCwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAg\nICAgICBmYWxzZSwgZmFsc2UsIDAsIExvbmcuTUFYX1ZBTFVFKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2luY2Ugd2UgY2FuJ3Qg\nY29tYmluZSBkaXN0aW5jdCBjb2xzLCB3ZSBoYXZlIHRvIHBlcmZvcm0gYW4g\nb3V0ZXIKICAgICAgICAvLyBDT1VOVCgqKSBzZWxlY3QgdXNpbmcgdGhlIG9y\naWdpbmFsIHNlbGVjdCBhcyBhIHN1YnNlbGVjdCBpbiB0aGUKICAgICAgICAv\nLyBGUk9NIGNsYXVzZQogICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNT\ndWJzZWxlY3QsICJTdXBwb3J0c1N1YnNlbGVjdCIpOwoKICAgICAgICBTUUxC\ndWZmZXIgc3ViU2VsZWN0ID0gZ2V0U2VsZWN0cyhzZWwsIHRydWUsIGZhbHNl\nKTsKICAgICAgICBTUUxCdWZmZXIgc3ViRnJvbSA9IGZyb207CiAgICAgICAg\nZnJvbSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgZnJvbS5hcHBl\nbmQoIigiKTsKICAgICAgICBmcm9tLmFwcGVuZCh0b1NlbGVjdChzdWJTZWxl\nY3QsIG51bGwsIHN1YkZyb20sIHdoZXJlLAogICAgICAgICAgICBzZWwuZ2V0\nR3JvdXBpbmcoKSwgc2VsLmdldEhhdmluZygpLCBudWxsLCBzZWwuaXNEaXN0\naW5jdCgpLAogICAgICAgICAgICBmYWxzZSwgc2VsLmdldFN0YXJ0SW5kZXgo\nKSwgc2VsLmdldEVuZEluZGV4KCksIHRydWUsIHNlbCkpOwogICAgICAgIGZy\nb20uYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKHJlcXVpcmVzQWxpYXNGb3JT\ndWJzZWxlY3QpCiAgICAgICAgICAgIGZyb20uYXBwZW5kKCIgIikuYXBwZW5k\nKFNlbGVjdC5GUk9NX1NFTEVDVF9BTElBUyk7CgogICAgICAgIHNlbGVjdFNR\nTC5hcHBlbmQoIkNPVU5UKCopIik7CiAgICAgICAgcmV0dXJuIHRvU2VsZWN0\nKHNlbGVjdFNRTCwgbnVsbCwgZnJvbSwgbnVsbCwgbnVsbCwgbnVsbCwgbnVs\nbCwKICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCAwLCBMb25nLk1BWF9WQUxV\nRSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBERUxFVEUgc3Rh\ndGVtZW50IGZvciB0aGUgc3BlY2lmaWVkIFNlbGVjdC4gSWYgdGhlCiAgICAg\nKiBkYXRhYmFzZSBkb2VzIG5vdCBzdXBwb3J0IHRoZSBidWxrIGRlbGV0ZSBz\ndGF0ZW1lbnQgKHN1Y2ggYXMKICAgICAqIGNhc2VzIHdoZXJlIGEgc3Vic2Vs\nZWN0IGlzIHJlcXVpcmVkIGFuZCB0aGUgZGF0YWJhc2UgZG9lc24ndCBzdXBw\nb3J0CiAgICAgKiBzdWJzZWxlY3RzKSwgdGhpcyBtZXRob2Qgc2hvdWxkIHJl\ndHVybiBudWxsLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvRGVs\nZXRlKENsYXNzTWFwcGluZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLCAKICAgICAg\nICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gdG9CdWxrT3Bl\ncmF0aW9uKG1hcHBpbmcsIHNlbCwgbnVsbCwgcGFyYW1zLCBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRvVXBkYXRlKENsYXNzTWFwcGlu\nZyBtYXBwaW5nLCBTZWxlY3Qgc2VsLAogICAgICAgIEpEQkNTdG9yZSBzdG9y\nZSwgT2JqZWN0W10gcGFyYW1zLCBNYXAgdXBkYXRlcykgewogICAgICAgIHJl\ndHVybiB0b0J1bGtPcGVyYXRpb24obWFwcGluZywgc2VsLCBzdG9yZSwgcGFy\nYW1zLCB1cGRhdGVzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMg\ndGhlIFNRTCBmb3IgYSBidWxrIG9wZXJhdGlvbiwgZWl0aGVyIGEgREVMRVRF\nIG9yIGFuIFVQREFURS4KICAgICAqCiAgICAgKiBAcGFyYW0gbWFwcGluZyB0\naGUgbWFwcGluZyBhZ2FpbnN0IHdoaWNoIHdlIGFyZSBvcGVyYXRpbmcKICAg\nICAqIEBwYXJhbSBzZWwgdGhlIFNlbGVjdCB0aGF0IHdpbGwgY29uc3RpdHV0\nZSB0aGUgV0hFUkUgY2xhdXNlCiAgICAgKiBAcGFyYW0gc3RvcmUgdGhlIGN1\ncnJlbnQgc3RvcmUKICAgICAqIEBwYXJhbSB1cGRhdGVQYXJhbXMgdGhlIE1h\ncCB0aGF0IGhvbGRzIHRoZSB1cGRhdGUgcGFyYW1ldGVyczsgYSBudWxsCiAg\nICAgKiB2YWx1ZSBpbmRpY2F0ZXMgdGhhdCB0aGlzIGlzIGEgZGVsZXRlIG9w\nZXJhdGlvbgogICAgICogQHJldHVybiB0aGUgU1FMQnVmZmVyIGZvciB0aGUg\ndXBkYXRlLCBvciA8ZW0+bnVsbDwvZW0+IGlmIGl0IGlzIG5vdAogICAgICog\ncG9zc2libGUgdG8gcGVyZm9ybSB0aGUgYnVsayB1cGRhdGUKICAgICAqLwog\nICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciB0b0J1bGtPcGVyYXRpb24oQ2xhc3NN\nYXBwaW5nIG1hcHBpbmcsIFNlbGVjdCBzZWwsCiAgICAgICAgSkRCQ1N0b3Jl\nIHN0b3JlLCBPYmplY3RbXSBwYXJhbXMsIE1hcCB1cGRhdGVQYXJhbXMpIHsK\nICAgICAgICBTUUxCdWZmZXIgc3FsID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsK\nICAgICAgICBpZiAodXBkYXRlUGFyYW1zID09IG51bGwpIHsKICAgICAgICAg\nIGlmIChyZXF1aXJlc1RhcmdldEZvckRlbGV0ZSkgewogICAgICAgICAgICBz\ncWwuYXBwZW5kKCJERUxFVEUgIik7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBk\nZWxldGVUYXJnZXRzID0gZ2V0RGVsZXRlVGFyZ2V0cyhzZWwpOwogICAgICAg\nICAgICBzcWwuYXBwZW5kKGRlbGV0ZVRhcmdldHMpOwogICAgICAgICAgICBz\ncWwuYXBwZW5kKCIgRlJPTSAiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHNxbC5hcHBlbmQoIkRFTEVURSBGUk9NICIpOwogICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgICAgIHNxbC5hcHBl\nbmQoIlVQREFURSAiKTsKICAgICAgICBzZWwuYWRkSm9pbkNsYXNzQ29uZGl0\naW9ucygpOwoKICAgICAgICAvLyBpZiB0aGVyZSBpcyBvbmx5IGEgc2luZ2xl\nIHRhYmxlIGluIHRoZSBzZWxlY3QsIHRoZW4gd2UgY2FuCiAgICAgICAgLy8g\nanVzdCBpc3N1ZSBhIHNpbmdsZSBERUxFVEUgRlJPTSBUQUJMRSBXSEVSRSA8\nY29uZGl0aW9ucz4KICAgICAgICAvLyBzdGF0ZW1lbnQ7IG90aGVyd2lzZSwg\nc2luY2UgU1FMIGRvZXNuJ3QgYWxsb3cgZGVsZXRpbmcKICAgICAgICAvLyBm\ncm9tIG9uZSBvZiBhIG11bHRpLXRhYmxlIHNlbGVjdCwgd2UgbmVlZCB0byBp\nc3N1ZSBhIHN1YnNlbGVjdAogICAgICAgIC8vIGxpa2UgREVMRVRFIEZST00g\nVEFCTEUgV0hFUkUgRVhJU1RTCiAgICAgICAgLy8gKFNFTEVDVCAxIEZST00g\nVEFCTEUgdDAgV0hFUkUgdDAuSUQgPSBUQUJMRS5JRCk7IGFsc28sIHNvbWUK\nICAgICAgICAvLyBkYXRhYmFzZXMgZG8gbm90IGFsbG93IGFsaWFzZXMgaW4g\nZGVsZXRlIHN0YXRlbWVudHMsIHdoaWNoCiAgICAgICAgLy8gYWxzbyBjYXVz\nZXMgdXMgdG8gdXNlIGEgc3Vic2VsZWN0CiAgICAgICAgQ29sbGVjdGlvbjxT\ndHJpbmc+IHNlbGVjdGVkVGFibGVzID0gZ2V0U2VsZWN0VGFibGVBbGlhc2Vz\nKHNlbCk7CiAgICAgICAgaWYgKHNlbGVjdGVkVGFibGVzLnNpemUoKSA9PSAx\nICYmIHN1cHBvcnRzU3Vic2VsZWN0CiAgICAgICAgICAgICYmIGFsbG93c0Fs\naWFzSW5CdWxrQ2xhdXNlKSB7CiAgICAgICAgICAgIFNRTEJ1ZmZlciBmcm9t\nOwogICAgICAgICAgICBpZiAoc2VsLmdldEZyb21TZWxlY3QoKSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxlY3Qoc2VsLCBm\nYWxzZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZyb20g\nPSBnZXRGcm9tKHNlbCwgZmFsc2UpOwoKICAgICAgICAgICAgc3FsLmFwcGVu\nZChmcm9tKTsKICAgICAgICAgICAgYXBwZW5kVXBkYXRlcyhzZWwsIHN0b3Jl\nLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFyYW1zLAogICAgICAgICAgICAgICAg\nYWxsb3dzQWxpYXNJbkJ1bGtDbGF1c2UpOwoKICAgICAgICAgICAgU1FMQnVm\nZmVyIHdoZXJlID0gc2VsLmdldFdoZXJlKCk7CiAgICAgICAgICAgIGlmICh3\naGVyZSAhPSBudWxsICYmICF3aGVyZS5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgICAgIHNxbC5hcHBlbmQoIiBXSEVSRSAiKTsKICAgICAgICAgICAgICAg\nIHNxbC5hcHBlbmQod2hlcmUpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBzcWw7CiAgICAgICAgfQoKICAgICAgICBUYWJsZSB0YWJsZSA9\nIG1hcHBpbmcuZ2V0VGFibGUoKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1l\nID0gZ2V0RnVsbE5hbWUodGFibGUsIGZhbHNlKTsKCiAgICAgICAgLy8gb25s\neSB1c2UgYSAgc3Vic2VsZWN0IGlmIHRoZSB3aGVyZSBpcyBub3QgZW1wdHk7\nIG90aGVyd2lzZQogICAgICAgIC8vIGFuIHVucXVhbGlmaWVkIGRlbGV0ZSBv\nciB1cGRhdGUgd2lsbCB3b3JrCiAgICAgICAgaWYgKHNlbC5nZXRXaGVyZSgp\nID09IG51bGwgfHwgc2VsLmdldFdoZXJlKCkuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgIHNxbC5hcHBlbmQodGFibGVOYW1lKTsKICAgICAgICAgICAgYXBw\nZW5kVXBkYXRlcyhzZWwsIHN0b3JlLCBzcWwsIHBhcmFtcywgdXBkYXRlUGFy\nYW1zLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybiBzcWw7CiAgICAgICAg\nfQoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHVzZSBhIHN1YnNlbGVjdCBpZiB3\nZSBhcmUgdG8gYnVsayBkZWxldGUgd2hlcmUKICAgICAgICAvLyB0aGUgc2Vs\nZWN0IGluY2x1ZGVzIG11bHRpcGxlIHRhYmxlczsgaWYgdGhlIGRhdGFiYXNl\nCiAgICAgICAgLy8gZG9lc24ndCBzdXBwb3J0IGl0LCB0aGVuIHdlIG5lZWQg\ndG8gc2lnbmFsIHRoaXMgYnkgcmV0dXJuaW5nIG51bGwKICAgICAgICBpZiAo\nIXN1cHBvcnRzU3Vic2VsZWN0IHx8ICFzdXBwb3J0c0NvcnJlbGF0ZWRTdWJz\nZWxlY3QpCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBDb2x1\nbW5bXSBwa3MgPSBtYXBwaW5nLmdldFByaW1hcnlLZXlDb2x1bW5zKCk7CiAg\nICAgICAgc2VsLmNsZWFyU2VsZWN0cygpOwogICAgICAgIHNlbC5zZXREaXN0\naW5jdCh0cnVlKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBvbmx5IGEgc2lu\nZ2xlIFBLLCB3ZSBjYW4gdXNlIGEgbm9uLWNvcnJlbGF0ZWQKICAgICAgICAv\nLyBzdWJxdWVyeSAodXNpbmcgYW4gSU4gc3RhdGVtZW50KSwgd2hpY2ggaXMg\nbXVjaCBmYXN0ZXIgdGhhbgogICAgICAgIC8vIGEgY29ycmVsYXRlZCBzdWJx\ndWVyeSAoc2luY2UgYSBjb3JyZWxhdGVkIHN1YnF1ZXJ5IG5lZWRzCiAgICAg\nICAgLy8gdG8gYmUgZXhlY3V0ZWQgb25jZSBmb3IgZWFjaCByb3cgaW4gdGhl\nIHRhYmxlKQogICAgICAgIGlmIChwa3MubGVuZ3RoID09IDEpIHsKICAgICAg\nICAgICAgc2VsLnNlbGVjdChwa3NbMF0pOwogICAgICAgICAgICBzcWwuYXBw\nZW5kKHRhYmxlTmFtZSk7CiAgICAgICAgICAgIGFwcGVuZFVwZGF0ZXMoc2Vs\nLCBzdG9yZSwgc3FsLCBwYXJhbXMsIHVwZGF0ZVBhcmFtcywgZmFsc2UpOwog\nICAgICAgICAgICBzcWwuYXBwZW5kKCIgV0hFUkUgIikuCiAgICAgICAgICAg\nICAgICBhcHBlbmQocGtzWzBdKS5hcHBlbmQoIiBJTiAoIikuCiAgICAgICAg\nICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxsKSkuYXBw\nZW5kKCIpIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsLmNs\nZWFyU2VsZWN0cygpOwogICAgICAgICAgICBzZWwuc2V0RGlzdGluY3QoZmFs\nc2UpOwoKICAgICAgICAgICAgLy8gc2luY2UgdGhlIHNlbGVjdCBpcyB1c2lu\nZyBhIGNvcnJlbGF0ZWQgc3VicXVlcnksIHdlCiAgICAgICAgICAgIC8vIG9u\nbHkgbmVlZCB0byBzZWxlY3QgYSBib2d1cyB2aXJ0dWFsIGNvbHVtbgogICAg\nICAgICAgICBzZWwuc2VsZWN0KCIxIiwgbnVsbCk7CgogICAgICAgICAgICAv\nLyBhZGQgaW4gdGhlIGpvaW5zIHRvIHRoZSB0YWJsZQogICAgICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0UHJpbWFyeUtleSgpLmdldENvbHVt\nbnMoKTsKICAgICAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZm\nZXIodGhpcyk7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIigiKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaSA+IDApCiAgICAgICAgICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKCiAgICAgICAgICAgICAgICAvLyBh\nZGQgaW4gInQwLlBLID0gTVlUQUJMRS5QSyIKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoc2VsLmdldENvbHVtbkFsaWFzKGNvbHNbaV0pKS5hcHBlbmQo\nIiA9ICIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZCh0YWJsZSkuYXBw\nZW5kKGNhdGFsb2dTZXBhcmF0b3IpLmFwcGVuZChjb2xzW2ldKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAg\nICAgIHNlbC53aGVyZShidWYsIG51bGwpOwoKICAgICAgICAgICAgc3FsLmFw\ncGVuZCh0YWJsZU5hbWUpOwogICAgICAgICAgICBhcHBlbmRVcGRhdGVzKHNl\nbCwgc3RvcmUsIHNxbCwgcGFyYW1zLCB1cGRhdGVQYXJhbXMsIGZhbHNlKTsK\nICAgICAgICAgICAgc3FsLmFwcGVuZCgiIFdIRVJFIEVYSVNUUyAoIikuCiAg\nICAgICAgICAgICAgICBhcHBlbmQoc2VsLnRvU2VsZWN0KGZhbHNlLCBudWxs\nKSkuYXBwZW5kKCIpIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzcWw7\nCiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uPFN0cmluZz4g\nZ2V0U2VsZWN0VGFibGVBbGlhc2VzKFNlbGVjdCBzZWwpIHsKICAgICAgICBy\nZXR1cm4gc2VsLmdldFRhYmxlQWxpYXNlcygpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCBTUUxCdWZmZXIgZ2V0RGVsZXRlVGFyZ2V0cyhTZWxlY3Qgc2VsKSB7\nCiAgICAgIFNRTEJ1ZmZlciBkZWxldGVUYXJnZXRzID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IGFsaWFzZXMgPSBz\nZWwuZ2V0VGFibGVBbGlhc2VzKCk7CiAgICAgIC8vIEFzc3VtZXMgYWxpYXNl\ncyBhcmUgb2YgdGhlIGZvcm0gIlRBQkxFTkFNRSB0MCIKICAgICAgLy8gb3Ig\nIlwiVEFCTEUgTkFNRVwiIHQwIgogICAgICBmb3IgKEl0ZXJhdG9yPFN0cmlu\nZz4gaXRyID0gYWxpYXNlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgIFN0cmluZyB0YWJsZUFsaWFzID0gaXRyLm5leHQoKTsKICAg\nICAgICBTdHJpbmdbXSBuYW1lcyA9IE5vcm1hbGl6ZXIuc3BsaXROYW1lKHRh\nYmxlQWxpYXMsIElkZW50aWZpZXJVdGlsLlNQQUNFKTsKICAgICAgICBpZiAo\nbmFtZXMubGVuZ3RoID4gMSkgewogICAgICAgICAgaWYgKGFsbG93c0FsaWFz\nSW5CdWxrQ2xhdXNlKSB7CiAgICAgICAgICAgIGRlbGV0ZVRhcmdldHMuYXBw\nZW5kKG5hbWVzWzFdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGRlbGV0ZVRhcmdldHMuYXBwZW5kKHRvREJOYW1lKERCSWRlbnRpZmllci5u\nZXdUYWJsZShuYW1lc1swXSkpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgZGVsZXRlVGFyZ2V0cy5hcHBlbmQodG9EQk5hbWUo\nREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlQWxpYXMpKSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAgZGVsZXRl\nVGFyZ2V0cy5hcHBlbmQoIiwgIik7CiAgICAgIH0gICAgICAKICAgICAgcmV0\ndXJuIGRlbGV0ZVRhcmdldHM7ICAgICAgCiAgICB9CgogICAgcHJvdGVjdGVk\nIHZvaWQgYXBwZW5kVXBkYXRlcyhTZWxlY3Qgc2VsLCBKREJDU3RvcmUgc3Rv\ncmUsIFNRTEJ1ZmZlciBzcWwsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zLCBN\nYXAgdXBkYXRlUGFyYW1zLCBib29sZWFuIGFsbG93QWxpYXMpIHsKICAgICAg\nICBpZiAodXBkYXRlUGFyYW1zID09IG51bGwgfHwgdXBkYXRlUGFyYW1zLnNp\nemUoKSA9PSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIG1h\nbnVhbGx5IGJ1aWxkIHVwIHRoZSBTRVQgY2xhdXNlIGZvciB0aGUgVVBEQVRF\nIHN0YXRlbWVudAogICAgICAgIHNxbC5hcHBlbmQoIiBTRVQgIik7CiAgICAg\nICAgRXhwQ29udGV4dCBjdHggPSBuZXcgRXhwQ29udGV4dChzdG9yZSwgcGFy\nYW1zLCAKICAgICAgICAgICAgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9u\nKCkpOwoKICAgICAgICAvLyBJZiB0aGUgdXBkYXRlcyBtYXAgY29udGFpbnMg\nYW55IHZlcnNpb24gZmllbGRzLCBhc3N1bWUgdGhhdCB0aGUKICAgICAgICAv\nLyBvcHRpbWlzdGljIGxvY2sgdmVyc2lvbiBkYXRhIGlzIGJlaW5nIGhhbmRs\nZWQgcHJvcGVybHkgYnkgdGhlCiAgICAgICAgLy8gY2FsbGVyLiBPdGhlcndp\nc2UsIGdpdmUgdGhlIHZlcnNpb24gaW5kaWNhdG9yIGFuIG9wcG9ydHVuaXR5\nIHRvCiAgICAgICAgLy8gYWRkIG1vcmUgdXBkYXRlIGNsYXVzZXMgYXMgbmVl\nZGVkLgogICAgICAgIGJvb2xlYW4gYXVnbWVudFVwZGF0ZXMgPSB0cnVlOwoK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGkgPSB1cGRhdGVQYXJhbXMuZW50cnlT\nZXQoKS5pdGVyYXRvcigpOyBpLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nTWFwLkVudHJ5IG5leHQgPSAoTWFwLkVudHJ5KSBpLm5leHQoKTsKICAgICAg\nICAgICAgUGF0aCBwYXRoID0gKFBhdGgpIG5leHQuZ2V0S2V5KCk7CiAgICAg\nICAgICAgIEZpZWxkTWFwcGluZyBmbWQgPSAoRmllbGRNYXBwaW5nKSBwYXRo\nLmxhc3QoKTsKCiAgICAgICAgICAgIGlmIChmbWQuaXNWZXJzaW9uKCkpCiAg\nICAgICAgICAgICAgICBhdWdtZW50VXBkYXRlcyA9IGZhbHNlOwoKICAgICAg\nICAgICAgVmFsIHZhbCA9IChWYWwpIG5leHQuZ2V0VmFsdWUoKTsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgdmFsID0g\nbmV3IE51bGwoKTsKICAgICAgICAgICAgQ29sdW1uIGNvbCA9IGZtZC5nZXRD\nb2x1bW5zKClbMF07CiAgICAgICAgICAgIGlmIChhbGxvd0FsaWFzKSB7CiAg\nICAgICAgICAgICAgc3FsLmFwcGVuZChzZWwuZ2V0Q29sdW1uQWxpYXMoY29s\nKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCh0b0RCTmFtZShjb2wuZ2V0SWRlbnRpZmllcigpKSk7CiAgICAgICAg\nICAgIH0gICAgICAgICAgICAKICAgICAgICAgICAgc3FsLmFwcGVuZCgiID0g\nIik7CgogICAgICAgICAgICBFeHBTdGF0ZSBzdGF0ZSA9IHZhbC5pbml0aWFs\naXplKHNlbCwgY3R4LCAwKTsKICAgICAgICAgICAgLy8gSkRCQyBQYXRocyBh\ncmUgYWx3YXlzIFBDUGF0aHM7IFBDUGF0aCBpbXBsZW1lbnRzIFZhbAogICAg\nICAgICAgICBFeHBTdGF0ZSBwYXRoU3RhdGUgPSAoKFZhbCkgcGF0aCkuaW5p\ndGlhbGl6ZShzZWwsIGN0eCwgMCk7CiAgICAgICAgICAgIGNhbGN1bGF0ZVZh\nbHVlKHZhbCwgc2VsLCBjdHgsIHN0YXRlLCBwYXRoLCBwYXRoU3RhdGUpOwoK\nICAgICAgICAgICAgLy8gYXBwZW5kIHRoZSB2YWx1ZSB3aXRoIGEgbnVsbCBm\nb3IgdGhlIFNlbGVjdDsgaQogICAgICAgICAgICAvLyBpbmRpY2F0ZXMgdGhh\ndCB0aGUKICAgICAgICAgICAgaW50IGxlbmd0aCA9IHZhbC5sZW5ndGgoc2Vs\nLCBjdHgsIHN0YXRlKTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCBsZW5ndGg7IGorKykKICAgICAgICAgICAgICAgIHZhbC5hcHBlbmRUbygo\nYWxsb3dBbGlhcykgPyBzZWwgOiBudWxsLCBjdHgsIHN0YXRlLCBzcWwsIGop\nOwoKICAgICAgICAgICAgaWYgKGkuaGFzTmV4dCgpKQogICAgICAgICAgICAg\nICAgc3FsLmFwcGVuZCgiLCAiKTsKICAgICAgICB9CgogICAgICAgIGlmIChh\ndWdtZW50VXBkYXRlcykgewogICAgICAgICAgICBQYXRoIHBhdGggPSAoUGF0\naCkgdXBkYXRlUGFyYW1zLmtleVNldCgpLml0ZXJhdG9yKCkubmV4dCgpOwog\nICAgICAgICAgICBGaWVsZE1hcHBpbmcgZm0gPSAoRmllbGRNYXBwaW5nKSBw\nYXRoLmxhc3QoKTsKICAgICAgICAgICAgQ2xhc3NNYXBwaW5nIG1ldGEgPSBm\nbS5nZXREZWNsYXJpbmdNYXBwaW5nKCk7CiAgICAgICAgICAgIE1hcDxDb2x1\nbW4sPz4gdXBkYXRlcyA9IG1ldGEuZ2V0VmVyc2lvbigpLmdldEJ1bGtVcGRh\ndGVWYWx1ZXMoKTsKICAgICAgICAgICAgZm9yIChNYXAuRW50cnkgZSA6IHVw\nZGF0ZXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICAgICAgQ29sdW1uIGNv\nbCA9IChDb2x1bW4pIGUuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICBPYmpl\nY3QgdmFsID0gZS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgc3FsLmFw\ncGVuZCgiLCAiKS5hcHBlbmQodG9EQk5hbWUoY29sLmdldElkZW50aWZpZXIo\nKSkpLmFwcGVuZCgiID0gIik7CiAgICAgICAgICAgICAgICAvLyBWZXJzaW9u\nIHVwZGF0ZSB2YWx1ZSBmb3IgTnVtZXJpYyB2ZXJzaW9uIGlzIGVuY29kZWQg\naW4gYSBTdHJpbmcKICAgICAgICAgICAgICAgIC8vIHRvIG1ha2UgU1FMIHN1\nY2ggYXMgdmVyc2lvbiA9IHZlcnNpb24rMSB3aGlsZSBUaW1lIHN0YW1wIHZl\ncnNpb24gaXMgcGFyYW1ldGVyaXplZAogICAgICAgICAgICAgICAgaWYgKHZh\nbCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICAgICAgICAgIHNx\nbC5hcHBlbmQoKFN0cmluZyl2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICBzcWwuYXBwZW5kVmFsdWUodmFsKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBDcmVhdGUgU1FMIHRvIGRlbGV0ZSB0\naGUgY29udGVudHMgb2YgdGhlIHNwZWNpZmllZCB0YWJsZXMuIAogICAgICog\nVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZHJvcHMgYWxsIG5vbi1kZWZl\ncnJlZCBSRVNUUklDVCBmb3JlaWduIGtleSAKICAgICAqIGNvbnN0cmFpbnRz\nIGludm9sdmluZyB0aGUgc3BlY2lmaWVkIHRhYmxlcywgaXNzdWVzIERFTEVU\nRSBzdGF0ZW1lbnRzIAogICAgICogYWdhaW5zdCB0aGUgdGFibGVzLCBhbmQg\ndGhlbiBhZGRzIHRoZSBkcm9wcGVkIGNvbnN0cmFpbnRzIGJhY2sgaW4uIAog\nICAgICogRGF0YWJhc2VzIHdpdGggbW9yZSBvcHRpbWFsIHdheXMgb2YgZGVs\nZXRpbmcgdGhlIGNvbnRlbnRzIG9mIHNldmVyYWwgCiAgICAgKiB0YWJsZXMg\nc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RGVsZXRlVGFibGVDb250ZW50c1NRTChUYWJsZVtd\nIHRhYmxlcyxDb25uZWN0aW9uIGNvbm4pIHsKICAgICAgICBDb2xsZWN0aW9u\nPFN0cmluZz4gc3FsID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAg\nICAgCiAgICAgICAgLy8gY29sbGVjdCBhbmQgZHJvcCBub24tZGVmZXJyZWQg\ncGh5c2ljYWwgcmVzdHJpY3QgY29uc3RyYWludHMsIGFuZAogICAgICAgIC8v\nIGNvbGxlY3QgdGhlIERFTEVURSBGUk9NIHN0YXRlbWVudHMKICAgICAgICBD\nb2xsZWN0aW9uPFN0cmluZz4gZGVsZXRlU1FMID0gbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KHRhYmxlcy5sZW5ndGgpOwogICAgICAgIENvbGxlY3Rpb248Rm9y\nZWlnbktleT4gcmVzdHJpY3RDb25zdHJhaW50cyA9CiAgICAgICAgICAgIG5l\ndyBMaW5rZWRIYXNoU2V0PEZvcmVpZ25LZXk+KCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCB0YWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgRm9yZWlnbktleVtdIGZrcyA9IHRhYmxlc1tpXS5nZXRGb3JlaWduS2V5\ncygpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGZrcy5sZW5n\ndGg7IGorKykgewogICAgICAgICAgICAgICAgaWYgKCFma3Nbal0uaXNMb2dp\nY2FsKCkgJiYgIWZrc1tqXS5pc0RlZmVycmVkKCkgCiAgICAgICAgICAgICAg\nICAgICAgJiYgZmtzW2pdLmdldERlbGV0ZUFjdGlvbigpID09IEZvcmVpZ25L\nZXkuQUNUSU9OX1JFU1RSSUNUKQogICAgICAgICAgICAgICAgcmVzdHJpY3RD\nb25zdHJhaW50cy5hZGQoZmtzW2pdKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAKICAgICAgICAgICAgZGVsZXRlU1FMLmFkZCgiREVMRVRFIEZST00g\nIiArIAogICAgICAgICAgICAgICAgdG9EQk5hbWUodGFibGVzW2ldLmdldEZ1\nbGxJZGVudGlmaWVyKCkpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\nZm9yKEZvcmVpZ25LZXkgZmsgOiByZXN0cmljdENvbnN0cmFpbnRzKSB7CiAg\nICAgICAgICAgIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSBnZXREcm9wRm9y\nZWlnbktleVNRTChmayxjb25uKTsKICAgICAgICAgICAgc3FsLmFkZEFsbChB\ncnJheXMuYXNMaXN0KGNvbnN0cmFpbnRTUUwpKTsKICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgLy8gYWRkIHRoZSBkZWxldGUgc3RhdGVtZW50cyBhZnRl\nciBhbGwgdGhlIGNvbnN0cmFpbnQgbXV0YXRpb25zCiAgICAgICAgc3FsLmFk\nZEFsbChkZWxldGVTUUwpOwogICAgICAgIAogICAgICAgIC8vIGFkZCB0aGUg\nZGVsZXRlZCBjb25zdHJhaW50cyBiYWNrIHRvIHRoZSBzY2hlbWEKICAgICAg\nICBmb3IgKEZvcmVpZ25LZXkgZmsgOiByZXN0cmljdENvbnN0cmFpbnRzKSB7\nCiAgICAgICAgICAgIFN0cmluZ1tdIGNvbnN0cmFpbnRTUUwgPSBnZXRBZGRG\nb3JlaWduS2V5U1FMKGZrKTsKICAgICAgICAgICAgc3FsLmFkZEFsbChBcnJh\neXMuYXNMaXN0KGNvbnN0cmFpbnRTUUwpKTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcmV0dXJuIChTdHJpbmdbXSkgc3FsLnRvQXJyYXkobmV3IFN0\ncmluZ1tzcWwuc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBTRUxFQ1Qgc3RhdGVtZW50IGluIHRoZSBwcm9wZXIgam9pbiBzeW50\nYXggZm9yIHRoZSBnaXZlbgogICAgICogaW5zdGFuY2UuCiAgICAgKi8KICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU2VsZWN0IHNlbCwgYm9vbGVh\nbiBmb3JVcGRhdGUsCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIHNlbC5hZGRKb2luQ2xhc3NDb25kaXRpb25zKCk7\nCiAgICAgICAgYm9vbGVhbiB1cGRhdGUgPSBmb3JVcGRhdGUgJiYgc2VsLmdl\ndEZyb21TZWxlY3QoKSA9PSBudWxsOwogICAgICAgIFNRTEJ1ZmZlciBzZWxl\nY3QgPSBnZXRTZWxlY3RzKHNlbCwgZmFsc2UsIHVwZGF0ZSk7CiAgICAgICAg\nU1FMQnVmZmVyIG9yZGVyaW5nID0gbnVsbDsKICAgICAgICBpZiAoIXNlbC5p\nc0FnZ3JlZ2F0ZSgpIHx8IHNlbC5nZXRHcm91cGluZygpICE9IG51bGwpCiAg\nICAgICAgICAgIG9yZGVyaW5nID0gc2VsLmdldE9yZGVyaW5nKCk7CiAgICAg\nICAgU1FMQnVmZmVyIGZyb207CiAgICAgICAgaWYgKHNlbC5nZXRGcm9tU2Vs\nZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgZnJvbSA9IGdldEZyb21TZWxl\nY3Qoc2VsLCBmb3JVcGRhdGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAg\nZnJvbSA9IGdldEZyb20oc2VsLCB1cGRhdGUpOwogICAgICAgIFNRTEJ1ZmZl\nciB3aGVyZSA9IGdldFdoZXJlKHNlbCwgdXBkYXRlKTsKICAgICAgICByZXR1\ncm4gdG9TZWxlY3Qoc2VsZWN0LCBmZXRjaCwgZnJvbSwgd2hlcmUsIHNlbC5n\nZXRHcm91cGluZygpLAogICAgICAgICAgICBzZWwuZ2V0SGF2aW5nKCksIG9y\nZGVyaW5nLCBzZWwuaXNEaXN0aW5jdCgpLCBmb3JVcGRhdGUsCiAgICAgICAg\nICAgIHNlbC5nZXRTdGFydEluZGV4KCksIHNlbC5nZXRFbmRJbmRleCgpLCBz\nZWwpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwb3J0aW9u\nIG9mIHRoZSBzZWxlY3Qgc3RhdGVtZW50IGJldHdlZW4gdGhlIEZST00ga2V5\nd29yZAogICAgICogYW5kIHRoZSBXSEVSRSBrZXl3b3JkLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldEZyb20oU2VsZWN0IHNlbCwgYm9v\nbGVhbiBmb3JVcGRhdGUpIHsKICAgICAgICBTUUxCdWZmZXIgZnJvbVNRTCA9\nIG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgQ29sbGVjdGlvbiBhbGlh\nc2VzID0gc2VsLmdldFRhYmxlQWxpYXNlcygpOwogICAgICAgIGlmIChhbGlh\nc2VzLnNpemUoKSA8IDIgfHwgc2VsLmdldEpvaW5TeW50YXgoKSAhPSBTWU5U\nQVhfU1FMOTIpIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSBh\nbGlhc2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICBmcm9tU1FMLmFwcGVuZChpdHIubmV4dCgpLnRvU3RyaW5nKCkp\nOwogICAgICAgICAgICAgICAgaWYgKGZvclVwZGF0ZSAmJiB0YWJsZUZvclVw\nZGF0ZUNsYXVzZSAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGZyb21T\nUUwuYXBwZW5kKCIgIikuYXBwZW5kKHRhYmxlRm9yVXBkYXRlQ2xhdXNlKTsK\nICAgICAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpKQogICAgICAgICAg\nICAgICAgICAgIGZyb21TUUwuYXBwZW5kKCIsICIpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChhbGlhc2VzLnNpemUoKSA8IDIgJiYgc2VsLmdl\ndFBhcmVudCgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIHN1YnF1\nZXJ5IG1heSBjb250YWluIGNvcnJlbGF0ZWQgam9pbnMKICAgICAgICAgICAg\nICAgIEl0ZXJhdG9yIGl0ciA9IHNlbC5nZXRKb2luSXRlcmF0b3IoKTsKICAg\nICAgICAgICAgICAgIHdoaWxlIChpdHIuaGFzTmV4dCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgSm9pbiBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgLy8gYXBwZW5kIHdoZXJlIGNsYXVzZQogICAg\nICAgICAgICAgICAgICAgIGlmIChqb2luLmlzQ29ycmVsYXRlZCgpICYmIGpv\naW4uZ2V0Rm9yZWlnbktleSgpICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgU1FMQnVmZmVyIHdoZXJlID0gbmV3IFNRTEJ1ZmZlcih0aGlz\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUuYXBwZW5kKCIoIiku\nYXBwZW5kKHRvVHJhZGl0aW9uYWxKb2luKGpvaW4pKS5hcHBlbmQoIikiKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgc2VsLndoZXJlKHdoZXJlLmdldFNR\nTCgpKTsKICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIAog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgSXRlcmF0b3IgaXRyID0gc2VsLmdldEpvaW5JdGVy\nYXRvcigpOwogICAgICAgICAgICBib29sZWFuIGZpcnN0ID0gdHJ1ZTsKICAg\nICAgICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAg\nICAgIEpvaW4gam9pbiA9IChKb2luKSBpdHIubmV4dCgpOwogICAgICAgICAg\nICAgICAgaWYgKGNvcnJlbGF0ZWRKb2luQ29uZGl0aW9uKGpvaW4sIHNlbCkp\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAg\nICAgaWYgKGpvaW4uaXNDb3JyZWxhdGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgdG9Db3JyZWxhdGVkSm9pbihzZWwsIGpvaW4sIGZvclVwZGF0ZSwgZmly\nc3QpOyAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNl\nICAgIAogICAgICAgICAgICAgICAgICAgIGZyb21TUUwuYXBwZW5kKHRvU1FM\nOTJKb2luKHNlbCwgam9pbiwgZm9yVXBkYXRlLAogICAgICAgICAgICAgICAg\nICAgICAgICBmaXJzdCkpOwogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxz\nZTsKICAgICAgICAgICAgICAgIGlmIChpdHIuaGFzTmV4dCgpICYmIGpvaW4u\naXNDb3JyZWxhdGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZnJv\nbVNRTC5nZXRTUUwoKS5sZW5ndGgoKSA+IDApCiAgICAgICAgICAgICAgICAg\nICAgICAgIGZyb21TUUwuYXBwZW5kKCIsICIpOwogICAgICAgICAgICAgICAg\nICAgIGZpcnN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIyID0gYWxpYXNl\ncy5pdGVyYXRvcigpOyBpdHIyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIFN0cmluZyB0YWJsZUFsaWFzID0gaXRyMi5uZXh0KCkudG9TdHJpbmco\nKTsKICAgICAgICAgICAgICAgIGlmIChmcm9tU1FMLmdldFNRTCgpLmluZGV4\nT2YodGFibGVBbGlhcykgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoIWZpcnN0ICYmIGZyb21TUUwuZ2V0U1FMKCkubGVuZ3RoKCkgPiAwKQog\nICAgICAgICAgICAgICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCgiLCAiKTsK\nICAgICAgICAgICAgICAgICAgICBmcm9tU1FMLmFwcGVuZCh0YWJsZUFsaWFz\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZm9yVXBkYXRlICYmIHRhYmxl\nRm9yVXBkYXRlQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZyb21TUUwuYXBwZW5kKCIgIikuYXBwZW5kKHRhYmxlRm9yVXBkYXRl\nQ2xhdXNlKTsKICAgICAgICAgICAgICAgICAgICBmaXJzdCA9IGZhbHNlOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBmcm9tU1FMOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVh\nbiBjb3JyZWxhdGVkSm9pbkNvbmRpdGlvbihKb2luIGpvaW4sIFNlbGVjdCBz\nZWwpIHsKICAgICAgICBpZiAoIWpvaW4uaXNDb3JyZWxhdGVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBJdGVyYXRvciBpdHIgPSBz\nZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7CiAgICAgICAgYm9vbGVhbiBza2lwID0g\nZmFsc2U7CiAgICAgICAgLy9pZiB0YWJsZTEgaW4gam9pbiBpcyBpbiB0aGUg\nbWFpbiBxdWVyeSwgdGFibGUyIGlzIGluCiAgICAgICAgLy9zdWJxdWVyeSwg\nYW5kIHRhYmxlMiBwYXJ0aWNpcGF0ZXMgaW4gb3RoZXIgam9pbnMKICAgICAg\nICAvL2luIHN1YnF1ZXJ5LCB0aGUgam9pbiBjb25kaXRpb24gY2FuIG9ubHkg\nYmUgcGxhY2VkIGluIAogICAgICAgIC8vdGhlIHdoZXJlIGNsYXVzZSBpbiB0\naGUgc3VicXVlcnkKICAgICAgICB3aGlsZSAoaXRyLmhhc05leHQoKSkgewog\nICAgICAgICAgICBKb2luIGpvaW4xID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAg\nICAgICAgICAgIGlmIChqb2luID09IGpvaW4xICYmICFqb2luLmlzRm9yZWln\nbktleUludmVyc2VkKCkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChqb2luLmdldEluZGV4Migp\nID09IGpvaW4xLmdldEluZGV4MSgpIHx8CiAgICAgICAgICAgICAgICBqb2lu\nLmdldEluZGV4MigpID09IGpvaW4xLmdldEluZGV4MigpKSB7CiAgICAgICAg\nICAgICAgICBza2lwID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChqb2lu\nLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKXsKICAgICAgICAgICAgICAgICAg\nICBTUUxCdWZmZXIgd2hlcmUgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAg\nICAgICAgICAgICAgICAgIHdoZXJlLmFwcGVuZCgiKCIpLmFwcGVuZCh0b1Ry\nYWRpdGlvbmFsSm9pbihqb2luKSkuYXBwZW5kKCIpIik7CiAgICAgICAgICAg\nICAgICAgICAgc2VsLndoZXJlKHdoZXJlLmdldFNRTCgpKTsKICAgICAgICAg\nICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2tp\ncDsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nRlJPTSBjbGF1c2UgZm9yIGEgc2VsZWN0IHRoYXQgc2VsZWN0cyBmcm9tIGEg\ndG1wIHRhYmxlCiAgICAgKiBjcmVhdGVkIGJ5IGFuIGlubmVyIHNlbGVjdC4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRGcm9tU2VsZWN0\nKFNlbGVjdCBzZWwsIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgU1FM\nQnVmZmVyIGZyb21TUUwgPSBuZXcgU1FMQnVmZmVyKHRoaXMpOwogICAgICAg\nIGZyb21TUUwuYXBwZW5kKCIoIik7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQo\ndG9TZWxlY3Qoc2VsLmdldEZyb21TZWxlY3QoKSwgZm9yVXBkYXRlLCBudWxs\nKSk7CiAgICAgICAgZnJvbVNRTC5hcHBlbmQoIikiKTsKICAgICAgICBpZiAo\ncmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCkKICAgICAgICAgICAgZnJvbVNR\nTC5hcHBlbmQoIiAiKS5hcHBlbmQoU2VsZWN0LkZST01fU0VMRUNUX0FMSUFT\nKTsKICAgICAgICByZXR1cm4gZnJvbVNRTDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgV0hFUkUgcG9ydGlvbiBvZiB0aGUgc2VsZWN0IHN0\nYXRlbWVudCwgb3IgbnVsbCBpZiBubyB3aGVyZQogICAgICogY29uZGl0aW9u\ncy4KICAgICAqLwogICAgcHJvdGVjdGVkIFNRTEJ1ZmZlciBnZXRXaGVyZShT\nZWxlY3Qgc2VsLCBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIEpvaW5z\nIGpvaW5zID0gc2VsLmdldEpvaW5zKCk7CiAgICAgICAgaWYgKHNlbC5nZXRK\nb2luU3ludGF4KCkgPT0gU1lOVEFYX1NRTDkyCiAgICAgICAgICAgIHx8IGpv\naW5zID09IG51bGwgfHwgam9pbnMuaXNFbXB0eSgpKQogICAgICAgICAgICBy\nZXR1cm4gc2VsLmdldFdoZXJlKCk7CgogICAgICAgIFNRTEJ1ZmZlciB3aGVy\nZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgaWYgKHNlbC5nZXRX\naGVyZSgpICE9IG51bGwpCiAgICAgICAgICAgIHdoZXJlLmFwcGVuZChzZWwu\nZ2V0V2hlcmUoKSk7CiAgICAgICAgaWYgKGpvaW5zICE9IG51bGwpCiAgICAg\nICAgICAgIHNlbC5hcHBlbmQod2hlcmUsIGpvaW5zKTsKICAgICAgICByZXR1\ncm4gd2hlcmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVu\nIGpvaW4gaW5zdGFuY2UgdG8gY3JlYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJs\nZXMgaW4KICAgICAqIHRoZSB0cmFkaXRpb25hbCBzdHlsZS4KICAgICAqLwog\nICAgcHVibGljIFNRTEJ1ZmZlciB0b1RyYWRpdGlvbmFsSm9pbihKb2luIGpv\naW4pIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0gam9pbi5nZXRGb3JlaWdu\nS2V5KCk7CiAgICAgICAgaWYgKGZrID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBib29sZWFuIGludmVyc2UgPSBqb2luLmlz\nRm9yZWlnbktleUludmVyc2VkKCk7CiAgICAgICAgQ29sdW1uW10gZnJvbSA9\nIChpbnZlcnNlKSA/IGZrLmdldFByaW1hcnlLZXlDb2x1bW5zKCkKICAgICAg\nICAgICAgOiBmay5nZXRDb2x1bW5zKCk7CiAgICAgICAgQ29sdW1uW10gdG8g\nPSAoaW52ZXJzZSkgPyBmay5nZXRDb2x1bW5zKCkKICAgICAgICAgICAgOiBm\nay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpOwoKICAgICAgICAvLyBkbyBjb2x1\nbW4gam9pbnMKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZl\ncih0aGlzKTsKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZnJvbS5sZW5ndGg7IGkrKywgY291bnQrKykgewog\nICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChqb2lu\nLmdldEFsaWFzMSgpKS5hcHBlbmQoIi4iKS5hcHBlbmQoZnJvbVtpXSk7CiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIiA9ICIpOwogICAgICAgICAgICBidWYu\nYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgiLiIpLmFwcGVuZCh0\nb1tpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBkbyBjb25zdGFudCBqb2lu\ncwogICAgICAgIENvbHVtbltdIGNvbnN0Q29scyA9IGZrLmdldENvbnN0YW50\nQ29sdW1ucygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RD\nb2xzLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChj\nb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmRWYWx1ZShmay5nZXRDb25zdGFudChjb25zdENvbHNbaV0pLCBj\nb25zdENvbHNbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMxKCkpLmFwcGVuZCgiLiIpLgog\nICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNbaV0pOwogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChp\nbnZlcnNlKQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZChqb2luLmdldEFs\naWFzMigpKS5hcHBlbmQoIi4iKS4KICAgICAgICAgICAgICAgICAgICBhcHBl\nbmQoY29uc3RDb2xzW2ldKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldENvbnN0YW50KGNvbnN0Q29s\nc1tpXSksIGNvbnN0Q29sc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBDb2x1\nbW5bXSBjb25zdENvbHNQSyA9IGZrLmdldENvbnN0YW50UHJpbWFyeUtleUNv\nbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbnN0Q29s\nc1BLLmxlbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgIGlmIChj\nb3VudCA+IDApCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgICAgICBpZiAoaW52ZXJzZSkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoam9pbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIikuCiAgICAg\nICAgICAgICAgICAgICAgYXBwZW5kKGNvbnN0Q29sc1BLW2ldKTsKICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZr\nLmdldFByaW1hcnlLZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAg\nICAgICAgICAgICAgICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBi\ndWYuYXBwZW5kKCIgPSAiKTsKCiAgICAgICAgICAgIGlmIChpbnZlcnNlKQog\nICAgICAgICAgICAgICAgYnVmLmFwcGVuZFZhbHVlKGZrLmdldFByaW1hcnlL\nZXlDb25zdGFudChjb25zdENvbHNQS1tpXSksCiAgICAgICAgICAgICAgICAg\nICAgY29uc3RDb2xzUEtbaV0pOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKGpvaW4uZ2V0QWxpYXMyKCkpLmFwcGVuZCgi\nLiIpLgogICAgICAgICAgICAgICAgICAgIGFwcGVuZChjb25zdENvbHNQS1tp\nXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBVc2UgdGhlIGdpdmVuIGpvaW4gaW5zdGFuY2UgdG8gY3Jl\nYXRlIFNRTCBqb2luaW5nIGl0cyB0YWJsZXMgaW4KICAgICAqIHRoZSBTUUw5\nMiBzdHlsZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciB0b1NRTDky\nSm9pbihTZWxlY3Qgc2VsLCBKb2luIGpvaW4sIGJvb2xlYW4gZm9yVXBkYXRl\nLAogICAgICAgIGJvb2xlYW4gZmlyc3QpIHsKICAgICAgICBTUUxCdWZmZXIg\nYnVmID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKCiAgICAgICAgaWYgKGZpcnN0\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9pbi5nZXRUYWJsZTEoKSku\nYXBwZW5kKCIgIikuCiAgICAgICAgICAgICAgICBhcHBlbmQoam9pbi5nZXRB\nbGlhczEoKSk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFibGVG\nb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiAiKS5hcHBlbmQodGFibGVGb3JVcGRhdGVDbGF1c2UpOwogICAg\nICAgIH0KCiAgICAgICAgYnVmLmFwcGVuZCgiICIpOwogICAgICAgIGlmIChq\nb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfT1VURVIpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQob3V0ZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNlIGlm\nIChqb2luLmdldFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoaW5uZXJKb2luQ2xhdXNlKTsKICAgICAgICBlbHNl\nIC8vIGNyb3NzCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoY3Jvc3NKb2luQ2xh\ndXNlKTsKICAgICAgICBidWYuYXBwZW5kKCIgIik7CgogICAgICAgIGJ1Zi5h\ncHBlbmQoam9pbi5nZXRUYWJsZTIoKSkuYXBwZW5kKCIgIikuYXBwZW5kKGpv\naW4uZ2V0QWxpYXMyKCkpOwogICAgICAgIGlmIChmb3JVcGRhdGUgJiYgdGFi\nbGVGb3JVcGRhdGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiICIpLmFwcGVuZCh0YWJsZUZvclVwZGF0ZUNsYXVzZSk7CgogICAg\nICAgIGlmIChqb2luLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKHRvVHJhZGl0aW9uYWxK\nb2luKGpvaW4pKTsKICAgICAgICBlbHNlIGlmIChyZXF1aXJlc0NvbmRpdGlv\nbkZvckNyb3NzSm9pbiAmJgogICAgICAgICAgICAgICAgam9pbi5nZXRUeXBl\nKCkgPT0gSm9pbi5UWVBFX0NST1NTKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgT04gKDEgPSAxKSIpOwogICAgICAgIAogICAgICAgIHJldHVybiBidWY7\nCiAgICB9CgogICAgcHJpdmF0ZSBTUUxCdWZmZXIgdG9Db3JyZWxhdGVkSm9p\nbihTZWxlY3Qgc2VsLCBKb2luIGpvaW4sIGJvb2xlYW4gZm9yVXBkYXRlLAog\nICAgICAgIGJvb2xlYW4gZmlyc3QpIHsKICAgICAgICBpZiAoam9pbi5nZXRG\nb3JlaWduS2V5KCkgIT0gbnVsbCl7CiAgICAgICAgICAgIFNRTEJ1ZmZlciB3\naGVyZSA9IG5ldyBTUUxCdWZmZXIodGhpcyk7CiAgICAgICAgICAgIHdoZXJl\nLmFwcGVuZCgiKCIpLmFwcGVuZCh0b1RyYWRpdGlvbmFsSm9pbihqb2luKSku\nYXBwZW5kKCIpIik7CiAgICAgICAgICAgIHNlbC53aGVyZSh3aGVyZS5nZXRT\nUUwoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFVzZSB0aGUgZ2l2ZW4gam9pbiBpbnN0YW5jZSB0\nbyBjcmVhdGUgU1FMIGpvaW5pbmcgaXRzIHRhYmxlcyBpbgogICAgICogdGhl\nIGRhdGFiYXNlJ3MgbmF0aXZlIHN5bnRheC4gVGhyb3dzIGFuIGV4Y2VwdGlv\nbiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIHRv\nTmF0aXZlSm9pbihKb2luIGpvaW4pIHsKICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgaWYgdGhlIGdpdmVuIGZvcmVpZ24ga2V5IGNhbiBiZSBlYWdlcmx5\nIGxvYWRlZCB1c2luZyBvdGhlciBqb2lucy4KICAgICAqLwogICAgcHVibGlj\nIGJvb2xlYW4gY2FuT3V0ZXJKb2luKGludCBzeW50YXgsIEZvcmVpZ25LZXkg\nZmspIHsKICAgICAgICByZXR1cm4gc3ludGF4ICE9IFNZTlRBWF9UUkFESVRJ\nT05BTDsKICAgIH0KCiAgICAvKioKICAgICAqIENvbWJpbmUgdGhlIGdpdmVu\nIGNvbXBvbmVudHMgaW50byBhIFNFTEVDVCBzdGF0ZW1lbnQuCiAgICAgKi8K\nICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVj\ndHMsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgU1FM\nQnVmZmVyIGZyb20sIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3Vw\nLAogICAgICAgIFNRTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwK\nICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwg\nbG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICByZXR1cm4gdG9PcGVy\nYXRpb24oZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSwgc2VsZWN0cywgZnJv\nbSwgd2hlcmUsCiAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBk\naXN0aW5jdCwgc3RhcnQsIGVuZCwKICAgICAgICAgICAgZ2V0Rm9yVXBkYXRl\nQ2xhdXNlKGZldGNoLCBmb3JVcGRhdGUsIG51bGwpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbWJpbmUgdGhlIGdpdmVuIGNvbXBvbmVudHMgaW50byBh\nIFNFTEVDVCBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTUUxC\ndWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMsCiAgICAgICAgSkRC\nQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAgICBTUUxCdWZmZXIg\nZnJvbSwgU1FMQnVmZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsCiAgICAg\nICAgU1FMQnVmZmVyIGhhdmluZywgU1FMQnVmZmVyIG9yZGVyLAogICAgICAg\nIGJvb2xlYW4gZGlzdGluY3QsIGJvb2xlYW4gZm9yVXBkYXRlLCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICBib29sZWFuIHN1YnNlbGVjdCwgU2Vs\nZWN0IHNlbCkgewogICAgICAgIHJldHVybiB0b09wZXJhdGlvbihnZXRTZWxl\nY3RPcGVyYXRpb24oZmV0Y2gpLCBzZWxlY3RzLCBmcm9tLCB3aGVyZSwKICAg\nICAgICAgICAgZ3JvdXAsIGhhdmluZywgb3JkZXIsIGRpc3RpbmN0LCBzdGFy\ndCwgZW5kLAogICAgICAgICAgICBnZXRGb3JVcGRhdGVDbGF1c2UoZmV0Y2gs\nIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCk7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVyIHNlbGVjdHMs\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgICAgIFNR\nTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBncm91\ncCwKICAgICAgICAgICAgU1FMQnVmZmVyIGhhdmluZywgU1FMQnVmZmVyIG9y\nZGVyLAogICAgICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBib29sZWFuIGZv\nclVwZGF0ZSwgbG9uZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgICAgIGJv\nb2xlYW4gc3Vic2VsZWN0LCBib29sZWFuIGNoZWNrVGFibGVGb3JVcGRhdGUp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKGdldFNlbGVjdE9w\nZXJhdGlvbihmZXRjaCksIHNlbGVjdHMsIGZyb20sIHdoZXJlLAogICAgICAg\nICAgICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwg\nc3RhcnQsIGVuZCwKICAgICAgICAgICAgICAgICAgICBnZXRGb3JVcGRhdGVD\nbGF1c2UoZmV0Y2gsIGZvclVwZGF0ZSwgbnVsbCksIHN1YnNlbGVjdCwKICAg\nICAgICAgICAgICAgICAgICBjaGVja1RhYmxlRm9yVXBkYXRlKTsKICAgICAg\nICB9CgogICAgLyoqCiAgICAgKiBDb21iaW5lIHRoZSBnaXZlbiBjb21wb25l\nbnRzIGludG8gYSBTRUxFQ1Qgc3RhdGVtZW50LgogICAgICovCiAgICBwcm90\nZWN0ZWQgU1FMQnVmZmVyIHRvU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RzLCAK\nICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAg\nIFNRTEJ1ZmZlciBmcm9tLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZlciBn\ncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIgb3Jk\nZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JVcGRh\ndGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIFNlbGVjdCBzZWwp\nIHsKICAgICAgICByZXR1cm4gdG9PcGVyYXRpb24oZ2V0U2VsZWN0T3BlcmF0\naW9uKGZldGNoKSwgc2VsZWN0cywgZnJvbSwgd2hlcmUsCiAgICAgICAgICAg\nIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwgc3RhcnQsIGVuZCwK\nICAgICAgICAgICAgZ2V0Rm9yVXBkYXRlQ2xhdXNlKGZldGNoLCBmb3JVcGRh\ndGUsIHNlbCkpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSB1cGRh\ndGUgY2xhdXNlIGZvciB0aGUgcXVlcnkgYmFzZWQgb24gdGhlCiAgICAgKiB1\ncGRhdGVDbGF1c2UgYW5kIGlzb2xhdGlvbkxldmVsIGhpbnRzCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0Rm9yVXBkYXRlQ2xhdXNlKEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgYm9vbGVhbiBpc0Zv\nclVwZGF0ZSwgU2VsZWN0IHNlbCkgewogICAgICAgIGlmIChmZXRjaCAhPSBu\ndWxsICYmIGZldGNoLmdldElzb2xhdGlvbigpICE9IC0xKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQo\nCiAgICAgICAgICAgICAgICAiaXNvbGF0aW9uLWxldmVsLWNvbmZpZy1ub3Qt\nc3VwcG9ydGVkIiwgZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKTsKICAgICAgICB9\nIGVsc2UgaWYgKGlzRm9yVXBkYXRlICYmICFzaW11bGF0ZUxvY2tpbmcpIHsK\nICAgICAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1NlbGVjdEZvclVw\nZGF0ZSwgIlN1cHBvcnRzU2VsZWN0Rm9yVXBkYXRlIik7CiAgICAgICAgICAg\nIHJldHVybiBmb3JVcGRhdGVDbGF1c2U7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIGRpY3Rpb25hcnkgdXNlcyBp\nc29sYXRpb24gbGV2ZWwgdG8gY29tcHV0ZSB0aGUgCiAgICAgKiByZXR1cm5l\nZCBnZXRGb3JVcGRhdGVDbGF1c2UoKSBTUUwgY2xhdXNlLiAgCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzSXNvbGF0aW9uRm9yVXBkYXRl\nKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlICJTRUxFQ1QiIG9wZXJhdGlvbiBjbGF1c2Us\nIGFkZGluZyBhbnkgYXZhaWxhYmxlIGhpbnRzLCBldGMuCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0U2VsZWN0T3BlcmF0aW9uKEpEQkNGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gIlNFTEVDVCI7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgdGhl\nIGdpdmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8KICAgIHB1Ymxp\nYyBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9wLCBTUUxCdWZmZXIg\nc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVmZmVyIHdo\nZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBoYXZpbmcsCiAgICAg\nICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3RpbmN0LCBsb25nIHN0\nYXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9yVXBkYXRlQ2xhdXNl\nKSB7CiAgICAgICAgcmV0dXJuIHRvT3BlcmF0aW9uKG9wLCBzZWxlY3RzLCBm\ncm9tLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywgb3JkZXIsCiAgICAgICAgICAg\nIGRpc3RpbmN0LCBzdGFydCwgZW5kLCBmb3JVcGRhdGVDbGF1c2UsIGZhbHNl\nKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBm\nb3IgdGhlIGdpdmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyBTUUxCdWZmZXIgdG9PcGVyYXRpb24oU3RyaW5nIG9wLCBTUUxC\ndWZmZXIgc2VsZWN0cywKICAgICAgICBTUUxCdWZmZXIgZnJvbSwgU1FMQnVm\nZmVyIHdoZXJlLCBTUUxCdWZmZXIgZ3JvdXAsIFNRTEJ1ZmZlciBoYXZpbmcs\nCiAgICAgICAgU1FMQnVmZmVyIG9yZGVyLCBib29sZWFuIGRpc3RpbmN0LCBs\nb25nIHN0YXJ0LCBsb25nIGVuZCwKICAgICAgICBTdHJpbmcgZm9yVXBkYXRl\nQ2xhdXNlLCBib29sZWFuIHN1YnNlbGVjdCkgewogICAgICAgIHJldHVybiB0\nb09wZXJhdGlvbihvcCwgc2VsZWN0cywgZnJvbSwgd2hlcmUsIGdyb3VwLCBo\nYXZpbmcsIG9yZGVyLAogICAgICAgICAgICAgICAgZGlzdGluY3QsIHN0YXJ0\nLCBlbmQsIGZvclVwZGF0ZUNsYXVzZSwgc3Vic2VsZWN0LCBmYWxzZSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3IgdGhlIGdp\ndmVuIHNlbGVjdGluZyBvcGVyYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUg\nU1FMQnVmZmVyIHRvT3BlcmF0aW9uKFN0cmluZyBvcCwgU1FMQnVmZmVyIHNl\nbGVjdHMsIFNRTEJ1ZmZlciBmcm9tLAogICAgICAgICAgICBTUUxCdWZmZXIg\nd2hlcmUsIFNRTEJ1ZmZlciBncm91cCwgU1FMQnVmZmVyIGhhdmluZywgU1FM\nQnVmZmVyIG9yZGVyLAogICAgICAgICAgICBib29sZWFuIGRpc3RpbmN0LCBs\nb25nIHN0YXJ0LCBsb25nIGVuZCwgU3RyaW5nIGZvclVwZGF0ZUNsYXVzZSwK\nICAgICAgICAgICAgYm9vbGVhbiBzdWJzZWxlY3QsIGJvb2xlYW4gY2hlY2tU\nYWJsZUZvclVwZGF0ZSkgewogICAgICAgIFNRTEJ1ZmZlciBidWYgPSBuZXcg\nU1FMQnVmZmVyKHRoaXMpOwogICAgICAgIGJ1Zi5hcHBlbmQob3ApOwoKICAg\nICAgICBib29sZWFuIHJhbmdlID0gc3RhcnQgIT0gMCB8fCBlbmQgIT0gTG9u\nZy5NQVhfVkFMVUU7CiAgICAgICAgaWYgKHJhbmdlICYmIHJhbmdlUG9zaXRp\nb24gPT0gUkFOR0VfUFJFX0RJU1RJTkNUKQogICAgICAgICAgICBhcHBlbmRT\nZWxlY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CiAgICAg\nICAgaWYgKGRpc3RpbmN0KQogICAgICAgICAgICBidWYuYXBwZW5kKCIgRElT\nVElOQ1QiKTsKICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9\nPSBSQU5HRV9QT1NUX0RJU1RJTkNUKQogICAgICAgICAgICBhcHBlbmRTZWxl\nY3RSYW5nZShidWYsIHN0YXJ0LCBlbmQsIHN1YnNlbGVjdCk7CgogICAgICAg\nIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQoc2VsZWN0cykuYXBwZW5kKCIgRlJP\nTSAiKS5hcHBlbmQoZnJvbSk7CgogICAgICAgIGlmIChjaGVja1RhYmxlRm9y\nVXBkYXRlCiAgICAgICAgICAgICAgICAmJiAoU3RyaW5nVXRpbHMuaXNFbXB0\neShmb3JVcGRhdGVDbGF1c2UpICYmICFTdHJpbmdVdGlscwogICAgICAgICAg\nICAgICAgICAgICAgICAuaXNFbXB0eSh0YWJsZUZvclVwZGF0ZUNsYXVzZSkp\nKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBlbmQodGFibGVG\nb3JVcGRhdGVDbGF1c2UpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZXJl\nICE9IG51bGwgJiYgIXdoZXJlLmlzRW1wdHkoKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIFdIRVJFICIpLmFwcGVuZCh3aGVyZSk7CiAgICAgICAgaWYg\nKGdyb3VwICE9IG51bGwgJiYgIWdyb3VwLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgYnVmLmFwcGVuZCgiIEdST1VQIEJZICIpLmFwcGVuZChncm91cCk7CiAg\nICAgICAgaWYgKGhhdmluZyAhPSBudWxsICYmICFoYXZpbmcuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIGFzc2VydFN1cHBvcnQoc3VwcG9ydHNIYXZpbmcs\nICJTdXBwb3J0c0hhdmluZyIpOwogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nSEFWSU5HICIpLmFwcGVuZChoYXZpbmcpOwogICAgICAgIH0KICAgICAgICBp\nZiAob3JkZXIgIT0gbnVsbCAmJiAhb3JkZXIuaXNFbXB0eSgpKQogICAgICAg\nICAgICBidWYuYXBwZW5kKCIgT1JERVIgQlkgIikuYXBwZW5kKG9yZGVyKTsK\nICAgICAgICBpZiAocmFuZ2UgJiYgcmFuZ2VQb3NpdGlvbiA9PSBSQU5HRV9Q\nT1NUX1NFTEVDVCkKICAgICAgICAgICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVm\nLCBzdGFydCwgZW5kLCBzdWJzZWxlY3QpOwogICAgICAgIGlmIChmb3JVcGRh\ndGVDbGF1c2UgIT0gbnVsbCkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICIp\nLmFwcGVuZChmb3JVcGRhdGVDbGF1c2UpOwogICAgICAgIGlmIChyYW5nZSAm\nJiByYW5nZVBvc2l0aW9uID09IFJBTkdFX1BPU1RfTE9DSykKICAgICAgICAg\nICAgYXBwZW5kU2VsZWN0UmFuZ2UoYnVmLCBzdGFydCwgZW5kLCBzdWJzZWxl\nY3QpOwogICAgICAgIHJldHVybiBidWY7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBJZiB0aGlzIGRpY3Rpb25hcnkgY2FuIHNlbGVjdCByYW5nZXMsCiAgICAg\nKiB1c2UgdGhpcyBtZXRob2QgdG8gYXBwZW5kIHRoZSByYW5nZSBTUUwuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZFNlbGVjdFJhbmdlKFNR\nTEJ1ZmZlciBidWYsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIGJv\nb2xlYW4gc3Vic2VsZWN0KSB7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIHBvcnRpb24gb2YgdGhlIHNlbGVjdCBzdGF0ZW1lbnQgYmV0d2Vl\nbiB0aGUgU0VMRUNUIGtleXdvcmQKICAgICAqIGFuZCB0aGUgRlJPTSBrZXl3\nb3JkLgogICAgICovCiAgICBwcm90ZWN0ZWQgU1FMQnVmZmVyIGdldFNlbGVj\ndHMoU2VsZWN0IHNlbCwgYm9vbGVhbiBkaXN0aW5jdElkZW50aWZpZXJzLAog\nICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgLy8gYXBwZW5k\nIHRoZSBhbGlhc2VzIGZvciBhbGwgdGhlIGNvbHVtbnMKICAgICAgICBTUUxC\ndWZmZXIgc2VsZWN0U1FMID0gbmV3IFNRTEJ1ZmZlcih0aGlzKTsKICAgICAg\nICBMaXN0IGFsaWFzZXM7CiAgICAgICAgaWYgKGRpc3RpbmN0SWRlbnRpZmll\ncnMpCiAgICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0SWRlbnRpZmllckFs\naWFzZXMoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFsaWFzZXMgPSBz\nZWwuZ2V0U2VsZWN0QWxpYXNlcygpOwoKICAgICAgICBPYmplY3QgYWxpYXM7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhbGlhc2VzLnNpemUoKTsg\naSsrKSB7CiAgICAgICAgICAgIGFsaWFzID0gYWxpYXNlcy5nZXQoaSk7CiAg\nICAgICAgICAgIGlmIChhbGlhcyBpbnN0YW5jZW9mIFN0cmluZykgewogICAg\nICAgICAgICAgICAgYWxpYXMgPSBnZXROYW1pbmdVdGlsKCkuY29udmVydEFs\naWFzKChTdHJpbmcpYWxpYXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGFwcGVuZFNlbGVjdChzZWxlY3RTUUwsIGFsaWFzLCBzZWwsIGkpOwogICAg\nICAgICAgICBpZiAoaSA8IGFsaWFzZXMuc2l6ZSgpIC0gMSkKICAgICAgICAg\nICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiwgIik7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBzZWxlY3RTUUw7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\ncHBlbmQgPGNvZGU+ZWxlbTwvY29kZT4gdG8gPGNvZGU+c2VsZWN0U1FMPC9j\nb2RlPi4KICAgICAqIEBwYXJhbSBzZWxlY3RTUUwgVGhlIFNRTEJ1ZmZlciB0\nbyBhcHBlbmQgdG8uCiAgICAgKiBAcGFyYW0gYWxpYXMgQSB7QGxpbmsgU1FM\nQnVmZmVyfSBvciBhIHtAbGluayBTdHJpbmd9IHRvIGFwcGVuZC4KICAgICAq\nCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgYXBwZW5kU2VsZWN0KFNRTEJ1ZmZlciBzZWxlY3RTUUwsIE9iamVjdCBl\nbGVtLCBTZWxlY3Qgc2VsLAogICAgICAgIGludCBpZHgpIHsKICAgICAgICBp\nZiAoZWxlbSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgc2Vs\nZWN0U1FMLmFwcGVuZCgoU1FMQnVmZmVyKSBlbGVtKTsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoZWxlbS50b1N0cmluZygp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBhICJG\nT1IgVVBEQVRFIiBjbGF1c2UgY2FuIGJlIHVzZWQgZm9yIHRoZSBzcGVjaWZp\nZWQKICAgICAqIFNlbGVjdCBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBi\nb29sZWFuIHN1cHBvcnRzTG9ja2luZyhTZWxlY3Qgc2VsKSB7CiAgICAgICAg\naWYgKHNlbC5pc0FnZ3JlZ2F0ZSgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKCFzdXBwb3J0c1NlbGVjdEZvclVwZGF0ZSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNM\nb2NraW5nV2l0aFNlbGVjdFJhbmdlICYmIChzZWwuZ2V0U3RhcnRJbmRleCgp\nICE9IDAKICAgICAgICAgICAgfHwgc2VsLmdldEVuZEluZGV4KCkgIT0gTG9u\nZy5NQVhfVkFMVUUpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAg\nICAgIC8vIG9ubHkgaW5uZXIgc2VsZWN0IGlzIGxvY2tlZAogICAgICAgIGlm\nIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51bGwpCiAgICAgICAgICAgIHNl\nbCA9IHNlbC5nZXRGcm9tU2VsZWN0KCk7CgogICAgICAgIGlmICghc3VwcG9y\ndHNMb2NraW5nV2l0aERpc3RpbmN0Q2xhdXNlICYmIHNlbC5pc0Rpc3RpbmN0\nKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1\ncHBvcnRzTG9ja2luZ1dpdGhNdWx0aXBsZVRhYmxlcwogICAgICAgICAgICAm\nJiBzZWwuZ2V0VGFibGVBbGlhc2VzKCkuc2l6ZSgpID4gMSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5n\nV2l0aE9yZGVyQ2xhdXNlICYmIHNlbC5nZXRPcmRlcmluZygpICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXN1cHBv\ncnRzTG9ja2luZ1dpdGhPdXRlckpvaW4gfHwgIXN1cHBvcnRzTG9ja2luZ1dp\ndGhJbm5lckpvaW4pIHsKICAgICAgICAgICAgZm9yIChJdGVyYXRvciBpdHIg\nPSBzZWwuZ2V0Sm9pbkl0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAg\nICAgICAgICAgICAgICBKb2luIGpvaW4gPSAoSm9pbikgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgIGlmICghc3VwcG9ydHNMb2NraW5nV2l0aE91dGVy\nSm9pbgogICAgICAgICAgICAgICAgICAgICYmIGpvaW4uZ2V0VHlwZSgpID09\nIEpvaW4uVFlQRV9PVVRFUikKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIXN1cHBvcnRzTG9ja2luZ1dp\ndGhJbm5lckpvaW4KICAgICAgICAgICAgICAgICAgICAmJiBqb2luLmdldFR5\ncGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGZh\nbHNlIGlmIHRoZSBnaXZlbiBzZWxlY3QgcmVxdWlyZXMgYSBmb3J3YXJkLW9u\nbHkgcmVzdWx0IHNldC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3Vw\ncG9ydHNSYW5kb21BY2Nlc3NSZXN1bHRTZXQoU2VsZWN0IHNlbCwKICAgICAg\nICBib29sZWFuIGZvclVwZGF0ZSkgewogICAgICAgIHJldHVybiAhc2VsLmlz\nQWdncmVnYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnQgdGhh\ndCB0aGUgZ2l2ZW4gZGljdGlvbmFyeSBmbGFnIGlzIHRydWUuIElmIGl0IGlz\nIG5vdCB0cnVlLAogICAgICogdGhyb3cgYW4gZXJyb3Igc2F5aW5nIHRoYXQg\ndGhlIGdpdmVuIHNldHRpbmcgbmVlZHMgdG8gcmV0dXJuIHRydWUgZm9yCiAg\nICAgKiB0aGUgY3VycmVudCBvcGVyYXRpb24gdG8gd29yay4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgYXNzZXJ0U3VwcG9ydChib29sZWFuIGZlYXR1cmUs\nIFN0cmluZyBwcm9wZXJ0eSkgewogICAgICAgIGlmICghZmVhdHVyZSkKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJmZWF0dXJlLW5vdC1zdXBwb3J0ZWQiLAogICAgICAgICAgICAgICAg\nZ2V0Q2xhc3MoKSwgcHJvcGVydHkpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gUXVlcnkgZnVuY3Rpb25zCiAgICAvLy8vLy8v\nLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogSW52b2tlIHRoaXMgZGF0\nYWJhc2UncyBzdWJzdHJpbmcgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBh\ncmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgc3Vic3RyaW5n\nIGludm9jYXRpb24gdG8KICAgICAqIEBwYXJhbSBzdHIgYSBxdWVyeSB2YWx1\nZSByZXByZXNlbnRpbmcgdGhlIHRhcmdldCBzdHJpbmcKICAgICAqIEBwYXJh\nbSBzdGFydCBhIHF1ZXJ5IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgc3RhcnQg\naW5kZXgKICAgICAqIEBwYXJhbSBlbmQgYSBxdWVyeSB2YWx1ZSByZXByZXNl\nbnRpbmcgdGhlIGVuZCBpbmRleCwgb3IgbnVsbCBmb3Igbm9uZQogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzdWJzdHJpbmcoU1FMQnVmZmVyIGJ1ZiwgRmls\ndGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBzdGFydCwKICAgICAgICBGaWx0\nZXJWYWx1ZSBlbmQpIHsKICAgICAgICBidWYuYXBwZW5kKHN1YnN0cmluZ0Z1\nbmN0aW9uTmFtZSkuYXBwZW5kKCIoIik7CiAgICAgICAgc3RyLmFwcGVuZFRv\nKGJ1Zik7CiAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICBpZiAo\nc3RhcnQuZ2V0VmFsdWUoKSBpbnN0YW5jZW9mIE51bWJlcikgewogICAgICAg\nICAgICBsb25nIHN0YXJ0TG9uZyA9IHRvTG9uZyhzdGFydCk7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoTG9uZy50b1N0cmluZyhzdGFydExvbmcgKyAxKSk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAgICAg\nICBidWYuYXBwZW5kKCIgKyAxKSIpOwogICAgICAgIH0KICAgICAgICBpZiAo\nZW5kICE9IG51bGwpIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsK\nICAgICAgICAgICAgaWYgKHN0YXJ0LmdldFZhbHVlKCkgaW5zdGFuY2VvZiBO\ndW1iZXIKICAgICAgICAgICAgICAgICYmIGVuZC5nZXRWYWx1ZSgpIGluc3Rh\nbmNlb2YgTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBsb25nIHN0YXJ0TG9u\nZyA9IHRvTG9uZyhzdGFydCk7CiAgICAgICAgICAgICAgICBsb25nIGVuZExv\nbmcgPSB0b0xvbmcoZW5kKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nTG9uZy50b1N0cmluZyhlbmRMb25nIC0gc3RhcnRMb25nKSk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbmQuYXBwZW5kVG8oYnVm\nKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAtICgiKTsKICAgICAg\nICAgICAgICAgIHN0YXJ0LmFwcGVuZFRvKGJ1Zik7CiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIpIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgYnVmLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIGxvbmcgdG9Mb25n\nKEZpbHRlclZhbHVlIGxpdFZhbHVlKSB7CiAgICAgICAgcmV0dXJuICgoTnVt\nYmVyKSBsaXRWYWx1ZS5nZXRWYWx1ZSgpKS5sb25nVmFsdWUoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEludm9rZSB0aGlzIGRhdGFiYXNlJ3MgaW5kZXhP\nZiBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBTUUwg\nYnVmZmVyIHRvIHdyaXRlIHRoZSBpbmRleE9mIGludm9jYXRpb24gdG8KICAg\nICAqIEBwYXJhbSBzdHIgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhl\nIHRhcmdldCBzdHJpbmcKICAgICAqIEBwYXJhbSBmaW5kIGEgcXVlcnkgdmFs\ndWUgcmVwcmVzZW50aW5nIHRoZSBzZWFyY2ggc3RyaW5nCiAgICAgKiBAcGFy\nYW0gc3RhcnQgYSBxdWVyeSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIHN0YXJ0\nIGluZGV4LCBvciBudWxsCiAgICAgKiB0byBzdGFydCBhdCB0aGUgYmVnaW5u\naW5nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGluZGV4T2YoU1FMQnVmZmVy\nIGJ1ZiwgRmlsdGVyVmFsdWUgc3RyLCBGaWx0ZXJWYWx1ZSBmaW5kLAogICAg\nICAgIEZpbHRlclZhbHVlIHN0YXJ0KSB7CiAgICAgICAgYnVmLmFwcGVuZCgi\nKElOU1RSKCgiKTsKICAgICAgICBpZiAoc3RhcnQgIT0gbnVsbCkKICAgICAg\nICAgICAgc3Vic3RyaW5nKGJ1Ziwgc3RyLCBzdGFydCwgbnVsbCk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzdHIuYXBwZW5kVG8oYnVmKTsKICAgICAg\nICBidWYuYXBwZW5kKCIpLCAoIik7CiAgICAgICAgZmluZC5hcHBlbmRUbyhi\ndWYpOwogICAgICAgIGJ1Zi5hcHBlbmQoIikpIC0gMSIpOwogICAgICAgIGlm\nIChzdGFydCAhPSBudWxsKSB7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAr\nICIpOwogICAgICAgICAgICBzdGFydC5hcHBlbmRUbyhidWYpOwogICAgICAg\nIH0KICAgICAgICBidWYuYXBwZW5kKCIpIik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBcHBlbmQgdGhlIG51bWVyaWMgcGFydHMgb2YgYSBtYXRoZW1hdGlj\nYWwgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0aGUgU1FM\nIGJ1ZmZlciB0byB3cml0ZSB0aGUgbWF0aCBmdW5jdGlvbgogICAgICogQHBh\ncmFtIG9wIHRoZSBtYXRoZW1hdGljYWwgb3BlcmF0aW9uIHRvIHBlcmZvcm0K\nICAgICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBt\nYXRoIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5k\nIHNpZGUgb2YgdGhlIG1hdGggZnVuY3Rpb24KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgbWF0aEZ1bmN0aW9uKFNRTEJ1ZmZlciBidWYsIFN0cmluZyBvcCwg\nRmlsdGVyVmFsdWUgbGhzLAogICAgICAgIEZpbHRlclZhbHVlIHJocykgewog\nICAgICAgIGJvb2xlYW4gY2FzdGxocyA9IGZhbHNlOwogICAgICAgIGJvb2xl\nYW4gY2FzdHJocyA9IGZhbHNlOwogICAgICAgIENsYXNzIGxjID0gRmlsdGVy\ncy53cmFwKGxocy5nZXRUeXBlKCkpOwogICAgICAgIENsYXNzIHJjID0gRmls\ndGVycy53cmFwKHJocy5nZXRUeXBlKCkpOwogICAgICAgIGludCB0eXBlID0g\nMDsKICAgICAgICBpZiAocmVxdWlyZXNDYXN0Rm9yTWF0aEZ1bmN0aW9ucyAm\nJiAobGMgIT0gcmMKICAgICAgICAgICAgfHwgKGxocy5pc0NvbnN0YW50KCkg\nfHwgcmhzLmlzQ29uc3RhbnQoKSkpKSB7CiAgICAgICAgICAgIENsYXNzIGMg\nPSBGaWx0ZXJzLnByb21vdGUobGMsIHJjKTsKICAgICAgICAgICAgdHlwZSA9\nIGdldEpEQkNUeXBlKEphdmFUeXBlcy5nZXRUeXBlQ29kZShjKSwgZmFsc2Up\nOwogICAgICAgICAgICBpZiAodHlwZSAhPSBUeXBlcy5WQVJCSU5BUlkgJiYg\ndHlwZSAhPSBUeXBlcy5CTE9CKSB7CiAgICAgICAgICAgICAgICBjYXN0bGhz\nID0gKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwg\nbGMgIT0gYzsKICAgICAgICAgICAgICAgIGNhc3RyaHMgPSAobGhzLmlzQ29u\nc3RhbnQoKSAmJiByaHMuaXNDb25zdGFudCgpKSB8fCByYyAhPSBjOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIG1vZCA9ICJN\nT0QiLmVxdWFscyhvcCk7CiAgICAgICAgaWYgKG1vZCkgewogICAgICAgICAg\nICBpZiAoc3VwcG9ydHNNb2RPcGVyYXRvcikKICAgICAgICAgICAgICAgIG9w\nID0gIiUiOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBidWYu\nYXBwZW5kKG9wKTsKICAgICAgICB9CiAgICAgICAgYnVmLmFwcGVuZCgiKCIp\nOwoKICAgICAgICBpZiAoY2FzdGxocykKICAgICAgICAgICAgYXBwZW5kQ2Fz\ndChidWYsIGxocywgdHlwZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBs\naHMuYXBwZW5kVG8oYnVmKTsKCiAgICAgICAgaWYgKG1vZCAmJiAhc3VwcG9y\ndHNNb2RPcGVyYXRvcikKICAgICAgICAgICAgYnVmLmFwcGVuZCgiLCAiKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiAiKS5hcHBl\nbmQob3ApLmFwcGVuZCgiICIpOwoKICAgICAgICBpZiAoY2FzdHJocykKICAg\nICAgICAgICAgYXBwZW5kQ2FzdChidWYsIHJocywgdHlwZSk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICByaHMuYXBwZW5kVG8oYnVmKTsKCiAgICAgICAg\nYnVmLmFwcGVuZCgiKSIpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5k\nIGEgY29tcGFyaXNvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBT\nUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFy\nYW0gb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAg\nICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21w\nYXJpc29uCiAgICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUg\nb2YgdGhlIGNvbXBhcmlzb24KICAgICAqLwogICAgcHVibGljIHZvaWQgY29t\ncGFyaXNvbihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZpbHRlclZhbHVl\nIGxocywKICAgICAgICBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBib29s\nZWFuIGxoc3htbCA9IGxocy5nZXRYUGF0aCgpICE9IG51bGw7CiAgICAgICAg\nYm9vbGVhbiByaHN4bWwgPSByaHMuZ2V0WFBhdGgoKSAhPSBudWxsOwogICAg\nICAgIGlmIChsaHN4bWwgfHwgcmhzeG1sKSB7CiAgICAgICAgICAgIGFwcGVu\nZFhtbENvbXBhcmlzb24oYnVmLCBvcCwgbGhzLCByaHMsIGxoc3htbCwgcmhz\neG1sKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBi\nb29sZWFuIGNhc3RsaHMgPSBmYWxzZTsKICAgICAgICBib29sZWFuIGNhc3Ry\naHMgPSBmYWxzZTsKICAgICAgICBDbGFzcyBsYyA9IEZpbHRlcnMud3JhcChs\naHMuZ2V0VHlwZSgpKTsKICAgICAgICBDbGFzcyByYyA9IEZpbHRlcnMud3Jh\ncChyaHMuZ2V0VHlwZSgpKTsKICAgICAgICAKICAgICAgICAvLyBzcGVjaWFs\nIGNhc2Ugb2YgY29tcGFyaXNvbiBvZiB0d28gYm9vbGVhbiBjb25zdGFudHMK\nICAgICAgICAvLyBiZWNhdXNlIHNvbWUgZGF0YWJhc2VzIGRvIG5vdCBsaWtl\nIGZhbHNlID0gZmFsc2Ugb3IgZmFsc2UgPSB0cnVlCiAgICAgICAgLy8gYnV0\nIGFsbCBkYXRhYmFzZXMgdW5kZXJzdGFuZCAxID0gMCBvciAwIDw+IDEgZXRj\nLgogICAgICAgIGlmIChsYyA9PSByYyAmJiBsYyA9PSBCb29sZWFuLmNsYXNz\nICYmIGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgewog\nICAgICAgICAgICBTdHJpbmcgbHZhbHVlID0gQm9vbGVhbi5UUlVFLmVxdWFs\ncyhsaHMuZ2V0VmFsdWUoKSkgPyAiMSIgOiAiMCI7CiAgICAgICAgICAgIFN0\ncmluZyBydmFsdWUgPSBCb29sZWFuLlRSVUUuZXF1YWxzKHJocy5nZXRWYWx1\nZSgpKSA/ICIxIiA6ICIwIjsKICAgICAgICAgICAgYnVmLmFwcGVuZChsdmFs\ndWUpLmFwcGVuZChvcCkuYXBwZW5kKHJ2YWx1ZSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgaW50IHR5cGUgPSAwOwogICAgICAg\nIGlmIChyZXF1aXJlc0Nhc3RGb3JDb21wYXJpc29ucyAmJiAobGMgIT0gcmMK\nICAgICAgICAgICAgfHwgKGxocy5pc0NvbnN0YW50KCkgJiYgcmhzLmlzQ29u\nc3RhbnQoKSkpKSB7CiAgICAgICAgICAgIENsYXNzIGMgPSBGaWx0ZXJzLnBy\nb21vdGUobGMsIHJjKTsKICAgICAgICAgICAgdHlwZSA9IGdldEpEQkNUeXBl\nKEphdmFUeXBlcy5nZXRUeXBlQ29kZShjKSwgZmFsc2UpOwogICAgICAgICAg\nICBpZiAodHlwZSAhPSBUeXBlcy5WQVJCSU5BUlkgJiYgdHlwZSAhPSBUeXBl\ncy5CTE9CKSB7CiAgICAgICAgICAgICAgICBjYXN0bGhzID0gKGxocy5pc0Nv\nbnN0YW50KCkgJiYgcmhzLmlzQ29uc3RhbnQoKSkgfHwgbGMgIT0gYzsKICAg\nICAgICAgICAgICAgIGNhc3RyaHMgPSAobGhzLmlzQ29uc3RhbnQoKSAmJiBy\naHMuaXNDb25zdGFudCgpKSB8fCByYyAhPSBjOwogICAgICAgICAgICAgICAg\nY2FzdGxocyA9IGNhc3RsaHMgJiYgbGhzLnJlcXVpcmVzQ2FzdCgpOwogICAg\nICAgICAgICAgICAgY2FzdHJocyA9IGNhc3RyaHMgJiYgcmhzLnJlcXVpcmVz\nQ2FzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\nY2FzdGxocykKICAgICAgICAgICAgYXBwZW5kQ2FzdChidWYsIGxocywgdHlw\nZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBsaHMuYXBwZW5kVG8oYnVm\nKTsKCiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBwZW5k\nKCIgIik7CgogICAgICAgIGlmIChjYXN0cmhzKQogICAgICAgICAgICBhcHBl\nbmRDYXN0KGJ1ZiwgcmhzLCB0eXBlKTsKICAgICAgICBlbHNlCiAgICAgICAg\nICAgIHJocy5hcHBlbmRUbyhidWYpOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRzIFhNTCB0eXBlLAogICAgICog\ndXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB4bWwgcHJlZGljYXRlLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRYbWxDb21wYXJpc29uKFNRTEJ1\nZmZlciBidWYsIFN0cmluZyBvcCwgRmlsdGVyVmFsdWUgbGhzLAogICAgICAg\nIEZpbHRlclZhbHVlIHJocywgYm9vbGVhbiBsaHN4bWwsIGJvb2xlYW4gcmhz\neG1sKSB7CiAgICAgICAgYXNzZXJ0U3VwcG9ydChzdXBwb3J0c1hNTENvbHVt\nbiwgIlN1cHBvcnRzWE1MQ29sdW1uIik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBcHBlbmQgU1FMIGZvciB0aGUgZ2l2ZW4gbnVtZXJpYyB2YWx1ZSB0byB0\naGUgYnVmZmVyLCBjYXN0aW5nIGFzIG5lZWRlZC4KICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgYXBwZW5kTnVtZXJpY0Nhc3QoU1FMQnVmZmVyIGJ1Ziwg\nRmlsdGVyVmFsdWUgdmFsKSB7CiAgICAgICAgaWYgKHZhbC5pc0NvbnN0YW50\nKCkpCiAgICAgICAgICAgIGFwcGVuZENhc3QoYnVmLCB2YWwsIFR5cGVzLk5V\nTUVSSUMpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFsLmFwcGVuZFRv\nKGJ1Zik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYXN0IHRoZSBzcGVjaWZp\nZWQgdmFsdWUgdG8gdGhlIHNwZWNpZmllZCB0eXBlLgogICAgICoKICAgICAq\nIEBwYXJhbSBidWYgdGhlIGJ1ZmZlciB0byBhcHBlbmQgdGhlIGNhc3QgdG8K\nICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGNhc3QKICAgICAqIEBw\nYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHRoZSBjYXNlLCBlLmcuIHtAbGluayBU\neXBlcyNOVU1FUklDfQogICAgICovCiAgICBwdWJsaWMgdm9pZCBhcHBlbmRD\nYXN0KFNRTEJ1ZmZlciBidWYsIE9iamVjdCB2YWwsIGludCB0eXBlKSB7CiAg\nICAgICAgLy8gQ29udmVydCB0aGUgY2FzdCBmdW5jdGlvbjogIkNBU1QoezB9\nIEFTIHsxfSkiCiAgICAgICAgaW50IGZpcnN0UGFyYW0gPSBjYXN0RnVuY3Rp\nb24uaW5kZXhPZigiezB9Iik7CiAgICAgICAgU3RyaW5nIHByZSA9IGNhc3RG\ndW5jdGlvbi5zdWJzdHJpbmcoMCwgZmlyc3RQYXJhbSk7IC8vICJDQVNUKCIK\nICAgICAgICBTdHJpbmcgbWlkID0gY2FzdEZ1bmN0aW9uLnN1YnN0cmluZyhm\naXJzdFBhcmFtICsgMyk7CiAgICAgICAgaW50IHNlY29uZFBhcmFtID0gbWlk\nLmluZGV4T2YoInsxfSIpOwogICAgICAgIFN0cmluZyBwb3N0OwogICAgICAg\nIGlmIChzZWNvbmRQYXJhbSA+IC0xKSB7CiAgICAgICAgICAgIHBvc3QgPSBt\naWQuc3Vic3RyaW5nKHNlY29uZFBhcmFtICsgMyk7IC8vICIpIgogICAgICAg\nICAgICBtaWQgPSBtaWQuc3Vic3RyaW5nKDAsIHNlY29uZFBhcmFtKTsgLy8g\nIiBBUyAiCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHBvc3QgPSAiIjsK\nCiAgICAgICAgYnVmLmFwcGVuZChwcmUpOwogICAgICAgIGlmICh2YWwgaW5z\ndGFuY2VvZiBGaWx0ZXJWYWx1ZSkKICAgICAgICAgICAgKChGaWx0ZXJWYWx1\nZSkgdmFsKS5hcHBlbmRUbyhidWYpOwogICAgICAgIGVsc2UgaWYgKHZhbCBp\nbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAgICAgICAgYnVmLmFwcGVuZCgo\nKFNRTEJ1ZmZlcikgdmFsKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBi\ndWYuYXBwZW5kKHZhbC50b1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5k\nKG1pZCk7CiAgICAgICAgYnVmLmFwcGVuZChnZXRUeXBlTmFtZSh0eXBlKSk7\nCiAgICAgICAgYXBwZW5kTGVuZ3RoKGJ1ZiwgdHlwZSk7CiAgICAgICAgYnVm\nLmFwcGVuZChwb3N0KTsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIHZvaWQg\nYXBwZW5kTGVuZ3RoKFNRTEJ1ZmZlciBidWYsIGludCB0eXBlKSB7ICAgICAg\nICAKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogYWRkIENBU1QgZm9yIGEg\nZnVuY3Rpb24gb3BlcmF0b3Igd2hlcmUgb3BlcmFuZCBpcyBhIHBhcmFtCiAg\nICAgKiBAcGFyYW0gZnVuYyAgZnVuY3Rpb24gbmFtZQogICAgICogQHBhcmFt\nIHZhbCAKICAgICAqIEByZXR1cm4gdXBkYXRlZCBmdW5jCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgYWRkQ2FzdEFzVHlwZShTdHJpbmcgZnVuYywgVmFs\nIHZhbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfSAgICAKCgogICAg\nLy8vLy8vLy8vLy8KICAgIC8vIERETCBTUUwKICAgIC8vLy8vLy8vLy8vCgog\nICAgLyoqCiAgICAgKiBJbmNyZW1lbnQgdGhlIHJlZmVyZW5jZSBjb3VudCBv\nZiBhbnkgdGFibGUgY29tcG9uZW50cyB0aGF0IHRoaXMKICAgICAqIGRpY3Rp\nb25hcnkgYWRkcyB0aGF0IGFyZSBub3QgdXNlZCBieSBtYXBwaW5ncy4gRG9l\ncyBub3RoaW5nIGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHJlZlNjaGVtYUNvbXBvbmVudHMoVGFibGUgdGFibGUpIHsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybnMgdGhlIG5hbWUgb2YgdGhlIGNvbHVtbiB1\nc2luZyBkYXRhYmFzZSBzcGVjaWZpYyBkZWxpbWl0ZXJzLgogICAgICovCiAg\nICBwdWJsaWMgREJJZGVudGlmaWVyIGdldENvbHVtbklkZW50aWZpZXIoQ29s\ndW1uIGNvbHVtbikgewogICAgICAgIGlmIChjb2x1bW4gPT0gbnVsbCkgewog\nICAgICAgICAgICByZXR1cm4gREJJZGVudGlmaWVyLk5VTEw7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBjb2x1bW4uZ2V0SWRlbnRpZmllcigpOwogICAg\nfQogICAgCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkRCTmFtZShDb2x1\nbW4gY29sdW1uKSB7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKGdldENvbHVt\nbklkZW50aWZpZXIoY29sdW1uKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIHRhYmxlLCBpbmNsdWRpbmcg\ndGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB7QGxpbmsgI2NhdGFs\nb2dTZXBhcmF0b3J9KS4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmll\nciBnZXRGdWxsSWRlbnRpZmllcihUYWJsZSB0YWJsZSwgYm9vbGVhbiBsb2dp\nY2FsKSB7CiAgICAgICAgaWYgKCF1c2VTY2hlbWFOYW1lIHx8IERCSWRlbnRp\nZmllci5pc051bGwodGFibGUuZ2V0U2NoZW1hSWRlbnRpZmllcigpKSkKICAg\nICAgICAgICAgcmV0dXJuIHRhYmxlLmdldElkZW50aWZpZXIoKTsKICAgICAg\nICByZXR1cm4gdGFibGUuZ2V0RnVsbElkZW50aWZpZXIoKTsKICAgIH0KICAg\nICAgICAKICAgIHB1YmxpYyBTdHJpbmcgZ2V0RnVsbE5hbWUoVGFibGUgdGFi\nbGUsIGJvb2xlYW4gbG9naWNhbCkgewogICAgICAgIGlmICghdXNlU2NoZW1h\nTmFtZSB8fCBEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlLmdldFNjaGVtYUlk\nZW50aWZpZXIoKSkpCiAgICAgICAgICAgIHJldHVybiB0b0RCTmFtZSh0YWJs\nZS5nZXRJZGVudGlmaWVyKCkpOwogICAgICAgIHJldHVybiB0b0RCTmFtZSh0\nYWJsZS5nZXRGdWxsSWRlbnRpZmllcigpKTsKICAgIH0KICAgIAogICAgLyoq\nCiAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIG5hbWUgb2YgdGhlIGluZGV4LCBp\nbmNsdWRpbmcgdGhlIHNjaGVtYSAoZGVsaW1pdGVkCiAgICAgKiBieSB0aGUg\ncmVzdWx0IG9mIHtAbGluayAjY2F0YWxvZ1NlcGFyYXRvcn0pLgogICAgICov\nCgogICAgcHVibGljIFN0cmluZyBnZXRGdWxsTmFtZShJbmRleCBpbmRleCkg\newogICAgICAgIGlmICghdXNlU2NoZW1hTmFtZSB8fCBEQklkZW50aWZpZXIu\naXNOdWxsKGluZGV4LmdldFNjaGVtYUlkZW50aWZpZXIoKSkpCiAgICAgICAg\nICAgIHJldHVybiB0b0RCTmFtZShpbmRleC5nZXRJZGVudGlmaWVyKCkpOwog\nICAgICAgIHJldHVybiB0b0RCTmFtZShpbmRleC5nZXRGdWxsSWRlbnRpZmll\ncigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGZ1bGwg\nbmFtZSBvZiB0aGUgc2VxdWVuY2UsIGluY2x1ZGluZyB0aGUgc2NoZW1hIChk\nZWxpbWl0ZWQKICAgICAqIGJ5IHRoZSByZXN1bHQgb2Yge0BsaW5rICNjYXRh\nbG9nU2VwYXJhdG9yfSkuCiAgICAgKi8KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndEZ1bGxOYW1lKFNlcXVlbmNlIHNlcSkgewogICAgICAgIGlmICghdXNlU2No\nZW1hTmFtZSB8fCBEQklkZW50aWZpZXIuaXNOdWxsKHNlcS5nZXRTY2hlbWFJ\nZGVudGlmaWVyKCkpKQogICAgICAgICAgICByZXR1cm4gdG9EQk5hbWUoc2Vx\nLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgcmV0dXJuIHRvREJOYW1lKHNl\ncS5nZXRGdWxsSWRlbnRpZmllcigpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgc3Vic2V0IG9mIHRoZSB3b3JkcyBpbiByZXNlcnZlZFdv\ncmRTZXQgdGhhdCBjYW5ub3QgYmUgdXNlZCBhcwogICAgICogdmFsaWQgY29s\ndW1uIG5hbWVzIGZvciB0aGUgY3VycmVudCBEQi4gSWYgdGhlIGNvbHVtbiBu\nYW1lIGlzIGludmFsaWQgdGhlCiAgICAgKiBnZXRWYWxpZENvbHVtbk5hbWUg\nbWV0aG9kIG9mIHRoZSBEQiBkaWN0aW9uYXJ5IHNob3VsZCBiZSBpbnZva2Vk\nIHRvIG1ha2UKICAgICAqIGl0IHZhbGlkLgogICAgICogCiAgICAgKiBAc2Vl\nIGdldFZhbGlkQ29sdW1uTmFtZQogICAgICovCiAgICBwdWJsaWMgZmluYWwg\nU2V0PFN0cmluZz4gZ2V0SW52YWxpZENvbHVtbldvcmRTZXQoKSB7CiAgICAg\nICAgcmV0dXJuIGludmFsaWRDb2x1bW5Xb3JkU2V0OwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIHRhYmxlIG5hbWUgdG8gbWFrZSBpdCB2YWxpZCBmb3IKICAgICAqIHRo\nZSBjdXJyZW50IERCLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXRWYWxpZFRhYmxlTmFtZShTdHJpbmcgbmFtZSwg\nU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHJldHVybiBnZXRWYWxpZFRhYmxl\nTmFtZShEQklkZW50aWZpZXIubmV3VGFibGUobmFtZSksIHNjaGVtYSkuZ2V0\nTmFtZSgpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5l\nY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiB0YWJsZSBuYW1lIHRvIG1h\na2UgaXQgdmFsaWQgZm9yCiAgICAgKiB0aGUgY3VycmVudCBEQi4KICAgICAq\nLwogICAgcHVibGljIERCSWRlbnRpZmllciBnZXRWYWxpZFRhYmxlTmFtZShE\nQklkZW50aWZpZXIgbmFtZSwgU2NoZW1hIHNjaGVtYSkgewogICAgICAgIHJl\ndHVybiBuYW1pbmdVdGlsLmdldFZhbGlkVGFibGVJZGVudGlmaWVyKG5hbWUs\nIHNjaGVtYSwgbWF4VGFibGVOYW1lTGVuZ3RoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZl\nbiBzZXF1ZW5jZSBuYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0\naGUgY3VycmVudCBEQi4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0VmFsaWRTZXF1ZW5jZU5hbWUoU3RyaW5nIG5h\nbWUsIFNjaGVtYSBzY2hlbWEpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsaWRT\nZXF1ZW5jZU5hbWUoREJJZGVudGlmaWVyLm5ld1NlcXVlbmNlKG5hbWUpLCBz\nY2hlbWEpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBzZXF1ZW5jZSBu\nYW1lIHRvIG1ha2UgaXQgdmFsaWQKICAgICAqIGZvciB0aGUgY3VycmVudCBE\nQi4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmllciBnZXRWYWxpZFNl\ncXVlbmNlTmFtZShEQklkZW50aWZpZXIgbmFtZSwgU2NoZW1hIHNjaGVtYSkg\newogICAgICAgIHJldHVybiBuYW1pbmdVdGlsLmdldFZhbGlkU2VxdWVuY2VJ\nZGVudGlmaWVyKG5hbWUsIHNjaGVtYSwgbWF4VGFibGVOYW1lTGVuZ3RoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYW55IG5lY2Vzc2FyeSBjaGFu\nZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4gbmFtZSB0byBtYWtlIGl0IHZhbGlk\nCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIuICBUaGUgY29sdW1uIG5hbWUg\nd2lsbCBiZSBtYWRlIHVuaXF1ZSBmb3IgdGhlCiAgICAgKiBzcGVjaWZpZWQg\ndGFibGUuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMg\nU3RyaW5nIGdldFZhbGlkQ29sdW1uTmFtZShTdHJpbmcgbmFtZSwgVGFibGUg\ndGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW5OYW1lKERC\nSWRlbnRpZmllci5uZXdDb2x1bW4obmFtZSksIHRhYmxlLCB0cnVlKS5nZXRO\nYW1lKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3Nh\ncnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4gY29sdW1uIG5hbWUgdG8gbWFrZSBp\ndCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLiAgVGhlIGNvbHVt\nbiBuYW1lIHdpbGwgYmUgbWFkZSB1bmlxdWUgZm9yIHRoZQogICAgICogc3Bl\nY2lmaWVkIHRhYmxlLgogICAgICovCiAgICBwdWJsaWMgREJJZGVudGlmaWVy\nIGdldFZhbGlkQ29sdW1uTmFtZShEQklkZW50aWZpZXIgbmFtZSwgVGFibGUg\ndGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW5OYW1lKG5h\nbWUsIHRhYmxlLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4gbmFt\nZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIu\nICBJZiBjaGVja0ZvclVuaXF1ZW5lc3MgaXMgdHJ1ZSwgdGhlIGNvbHVtbiBu\nYW1lIHdpbGwgCiAgICAgKiBiZSBtYWRlIHVuaXF1ZSBmb3IgdGhlIHNwZWNp\nZmllZCB0YWJsZS4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0VmFsaWRDb2x1bW5OYW1lKFN0cmluZyBuYW1lLCBU\nYWJsZSB0YWJsZSwKICAgICAgICBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVz\ncykgewogICAgICAgIHJldHVybiBnZXRWYWxpZENvbHVtbk5hbWUoREJJZGVu\ndGlmaWVyLm5ld0NvbHVtbihuYW1lKSwgdGFibGUsIGNoZWNrRm9yVW5pcXVl\nbmVzcykudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2Ug\nYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBjb2x1bW4gbmFt\nZSB0byBtYWtlIGl0IHZhbGlkCiAgICAgKiBmb3IgdGhlIGN1cnJlbnQgREIu\nICBJZiBjaGVja0ZvclVuaXF1ZW5lc3MgaXMgdHJ1ZSwgdGhlIGNvbHVtbiBu\nYW1lIHdpbGwgCiAgICAgKiBiZSBtYWRlIHVuaXF1ZSBmb3IgdGhlIHNwZWNp\nZmllZCB0YWJsZS4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmllciBn\nZXRWYWxpZENvbHVtbk5hbWUoREJJZGVudGlmaWVyIG5hbWUsIFRhYmxlIHRh\nYmxlLAogICAgICAgIGJvb2xlYW4gY2hlY2tGb3JVbmlxdWVuZXNzKSB7CiAg\nICAgICAgcmV0dXJuIGdldE5hbWluZ1V0aWwoKS5nZXRWYWxpZENvbHVtbklk\nZW50aWZpZXIobmFtZSwgdGFibGUsIG1heENvbHVtbk5hbWVMZW5ndGgsIAog\nICAgICAgICAgICBjaGVja0ZvclVuaXF1ZW5lc3MpOwogICAgfQoKICAgIC8q\nKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdp\ndmVuIHByaW1hcnkga2V5IG5hbWUgdG8gbWFrZSBpdAogICAgICogdmFsaWQg\nZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGdldFZhbGlkUHJpbWFyeUtleU5hbWUoU3RyaW5nIG5hbWUsIFRhYmxlIHRh\nYmxlKSB7CiAgICAgICAgd2hpbGUgKG5hbWUuc3RhcnRzV2l0aCgiXyIpKQog\nICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAg\ncmV0dXJuIG1ha2VOYW1lVmFsaWQoIlBfIiArIG5hbWUsIHRhYmxlLmdldFNj\naGVtYSgpLmdldFNjaGVtYUdyb3VwKCksCiAgICAgICAgICAgIG1heENvbnN0\ncmFpbnROYW1lTGVuZ3RoLCBOQU1FX0FOWSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0aGUgZ2l2ZW4g\nZm9yZWlnbiBrZXkgbmFtZSB0byBtYWtlIGl0CiAgICAgKiB2YWxpZCBmb3Ig\ndGhlIGN1cnJlbnQgREIuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkRm9yZWlnbktleU5hbWUoU3RyaW5n\nIG5hbWUsIFRhYmxlIHRhYmxlLAogICAgICAgIFRhYmxlIHRvVGFibGUpIHsK\nICAgICAgICByZXR1cm4gZ2V0VmFsaWRGb3JlaWduS2V5TmFtZShEQklkZW50\naWZpZXIubmV3Rm9yZWlnbktleShuYW1lKSwgdGFibGUsCiAgICAgICAgICAg\nIHRvVGFibGUpLmdldE5hbWUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1h\na2UgYW55IG5lY2Vzc2FyeSBjaGFuZ2VzIHRvIHRoZSBnaXZlbiBmb3JlaWdu\nIGtleSBuYW1lIHRvIG1ha2UgaXQKICAgICAqIHZhbGlkIGZvciB0aGUgY3Vy\ncmVudCBEQi4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRpZmllciBnZXRW\nYWxpZEZvcmVpZ25LZXlOYW1lKERCSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0\nYWJsZSwKICAgICAgICBUYWJsZSB0b1RhYmxlKSB7CiAgICAgICAgcmV0dXJu\nIG5hbWluZ1V0aWwuZ2V0VmFsaWRGb3JlaWduS2V5SWRlbnRpZmllcihuYW1l\nLCB0YWJsZSwgdG9UYWJsZSwgbWF4Q29uc3RyYWludE5hbWVMZW5ndGgpOwog\nICAgfQoKICAgIC8qKgogICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5n\nZXMgdG8gdGhlIGdpdmVuIGluZGV4IG5hbWUgdG8gbWFrZSBpdCB2YWxpZAog\nICAgICogZm9yIHRoZSBjdXJyZW50IERCLgogICAgICogQGRlcHJlY2F0ZWQK\nICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWYWxpZEluZGV4TmFtZShT\ndHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gZ2V0\nVmFsaWRJbmRleE5hbWUoREJJZGVudGlmaWVyLm5ld0luZGV4KG5hbWUpLCB0\nYWJsZSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBh\nbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVuIGluZGV4IG5hbWUg\ndG8gbWFrZSBpdCB2YWxpZAogICAgICogZm9yIHRoZSBjdXJyZW50IERCLgog\nICAgICovCiAgICBwdWJsaWMgREJJZGVudGlmaWVyIGdldFZhbGlkSW5kZXhO\nYW1lKERCSWRlbnRpZmllciBuYW1lLCBUYWJsZSB0YWJsZSkgewogICAgICAg\nIHJldHVybiBnZXROYW1pbmdVdGlsKCkuZ2V0VmFsaWRJbmRleElkZW50aWZp\nZXIobmFtZSwgdGFibGUsIG1heEluZGV4TmFtZUxlbmd0aCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBNYWtlIGFueSBuZWNlc3NhcnkgY2hhbmdlcyB0byB0\naGUgZ2l2ZW4gdW5pcXVlIGNvbnN0cmFpbnQgbmFtZSB0byBtYWtlCiAgICAg\nKiBpdCB2YWxpZCBmb3IgdGhlIGN1cnJlbnQgREIuCiAgICAgKiBAZGVwcmVj\nYXRlZAogICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFZhbGlkVW5pcXVl\nTmFtZShTdHJpbmcgbmFtZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1\ncm4gZ2V0VmFsaWRVbmlxdWVOYW1lKERCSWRlbnRpZmllci5uZXdDb25zdHJh\naW50KG5hbWUpLCB0YWJsZSkuZ2V0TmFtZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogTWFrZSBhbnkgbmVjZXNzYXJ5IGNoYW5nZXMgdG8gdGhlIGdpdmVu\nIHVuaXF1ZSBjb25zdHJhaW50IG5hbWUgdG8gbWFrZQogICAgICogaXQgdmFs\naWQgZm9yIHRoZSBjdXJyZW50IERCLgogICAgICovCiAgICBwdWJsaWMgREJJ\nZGVudGlmaWVyIGdldFZhbGlkVW5pcXVlTmFtZShEQklkZW50aWZpZXIgbmFt\nZSwgVGFibGUgdGFibGUpIHsKICAgICAgICByZXR1cm4gbmFtaW5nVXRpbC5n\nZXRWYWxpZFVuaXF1ZUlkZW50aWZpZXIobmFtZSwgdGFibGUsIG1heENvbnN0\ncmFpbnROYW1lTGVuZ3RoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBT\naG9ydGVuIHRoZSBzcGVjaWZpZWQgbmFtZSB0byB0aGUgc3BlY2lmaWVkIHRh\ncmdldCBuYW1lLiBUaGlzIHdpbGwKICAgICAqIGJlIGRvbmUgYnkgZmlyc3Qg\nc3RyaXBwaW5nIG91dCB0aGUgdm93ZWxzLCBhbmQgdGhlbiByZW1vdmluZwog\nICAgICogY2hhcmFjdGVycyBmcm9tIHRoZSBtaWRkbGUgb2YgdGhlIHdvcmQg\ndW50aWwgaXQgcmVhY2hlcyB0aGUgdGFyZ2V0CiAgICAgKiBsZW5ndGguCiAg\nICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5nIHNob3J0ZW4oU3RyaW5n\nIG5hbWUsIGludCB0YXJnZXRMZW5ndGgpIHsKICAgICAgICBpZiAobmFtZSA9\nPSBudWxsIHx8IG5hbWUubGVuZ3RoKCkgPD0gdGFyZ2V0TGVuZ3RoKQogICAg\nICAgICAgICByZXR1cm4gbmFtZTsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBu\nbSA9IG5ldyBTdHJpbmdCdWlsZGVyKG5hbWUpOwogICAgICAgIHdoaWxlIChu\nbS5sZW5ndGgoKSA+IHRhcmdldExlbmd0aCkgewogICAgICAgICAgICBpZiAo\nIXN0cmlwVm93ZWwobm0pKSB7CiAgICAgICAgICAgICAgICAvLyBjdXQgb3V0\nIHRoZSBtaWRkbGUgY2hhcgogICAgICAgICAgICAgICAgbm0ucmVwbGFjZShu\nbS5sZW5ndGgoKSAvIDIsIChubS5sZW5ndGgoKSAvIDIpICsgMSwgIiIpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBubS50b1N0\ncmluZygpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHZvd2VscyBm\ncm9tIHRoZSBzcGVjaWZpZWQgU3RyaW5nQnVpbGRlci4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIHRydWUgaWYgYW55IHZvd2VscyBoYXZlIGJlZW4gcmVtb3Zl\nZAogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIHN0cmlwVm93\nZWwoU3RyaW5nQnVpbGRlciBuYW1lKSB7CiAgICAgICAgaWYgKG5hbWUgPT0g\nbnVsbCB8fCBuYW1lLmxlbmd0aCgpID09IDApCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgY2hhcltdIHZvd2VscyA9IHsgJ0EnLCAnRScs\nICdJJywgJ08nLCAnVScsIH07CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCB2b3dlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaW50IGluZGV4\nID0gbmFtZS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5kZXhPZih2b3dl\nbHNbaV0pOwogICAgICAgICAgICBpZiAoaW5kZXggIT0gLTEpIHsKICAgICAg\nICAgICAgICAgIG5hbWUucmVwbGFjZShpbmRleCwgaW5kZXggKyAxLCAiIik7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4g\nbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0IGlz\nIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBhcHBl\nbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdpdGgg\nYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCwgdGhlIGxhc3QKICAgICAq\nIGNoYXJhY3RlciBpcyByZXBsYWNlIHdpdGggJzAnLCB0aGVuICcxJywgZXRj\nLgogICAgICogTm90ZSB0aGF0IHRoZSBnaXZlbiBtYXggbGVuIG1heSBiZSAw\nIGlmIHRoZSBkYXRhYmFzZSBtZXRhZGF0YSBpcwogICAgICogaW5jb21wbGV0\nZS4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBT\ndHJpbmcgbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQs\nIGludCBtYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlKSB7CiAgICAgICAg\ncmV0dXJuIG1ha2VOYW1lVmFsaWQobmFtZSwgc2V0LCBtYXhMZW4sIG5hbWVU\neXBlLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNob3J0ZW5zIHRo\nZSBnaXZlbiBuYW1lIHRvIHRoZSBnaXZlbiBtYXhpbXVtIGxlbmd0aCwgdGhl\nbiBjaGVja3MgdGhhdAogICAgICogaXQgaXMgbm90IGEgcmVzZXJ2ZWQgd29y\nZC4gSWYgaXQgaXMgcmVzZXJ2ZWQsIGFwcGVuZHMgYSAiMCIuIElmCiAgICAg\nKiB0aGUgbmFtZSBjb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBzY2hlbWEg\nY29tcG9uZW50LCB0aGUgbGFzdAogICAgICogY2hhcmFjdGVyIGlzIHJlcGxh\nY2Ugd2l0aCAnMCcsIHRoZW4gJzEnLCBldGMuCiAgICAgKiBOb3RlIHRoYXQg\ndGhlIGdpdmVuIG1heCBsZW4gbWF5IGJlIDAgaWYgdGhlIGRhdGFiYXNlIG1l\ndGFkYXRhIGlzCiAgICAgKiBpbmNvbXBsZXRlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgREJJZGVudGlmaWVyIG1ha2VOYW1lVmFsaWQoREJJZGVudGlmaWVy\nIG5hbWUsIE5hbWVTZXQgc2V0LCBpbnQgbWF4TGVuLAogICAgICAgIGludCBu\nYW1lVHlwZSkgewogICAgICAgIHJldHVybiBtYWtlTmFtZVZhbGlkKG5hbWUs\nIHNldCwgbWF4TGVuLCBuYW1lVHlwZSwgdHJ1ZSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0aGUgZ2l2ZW4g\nbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAgICAqIGl0IGlz\nIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2VydmVkLCBhcHBl\nbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxpY3RzIHdpdGgg\nYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCBhbmQgdW5pcXVlbmVzcwog\nICAgICogY2hlY2tpbmcgaXMgZW5hYmxlZCwgdGhlIGxhc3QgY2hhcmFjdGVy\nIGlzIHJlcGxhY2Ugd2l0aCAnMCcsIHRoZW4gCiAgICAgKiAnMScsIGV0Yy4g\nCiAgICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBsZW4gbWF5IGJlIDAg\naWYgdGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzIAogICAgICogaW5jb21wbGV0\nZS4KICAgICAqIAogICAgICogTm90ZTogSWYgdGhlIG5hbWUgaXMgZGVsaW1p\ndGVkLCBtYWtlIHN1cmUgdGhlIGVuZGluZyBkZWxpbWl0ZXIgaXMKICAgICAq\nIG5vdCBzdHJpcHBlZCBvZmYuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJp\nbmcgbWFrZU5hbWVWYWxpZChTdHJpbmcgbmFtZSwgTmFtZVNldCBzZXQsIGlu\ndCBtYXhMZW4sCiAgICAgICAgaW50IG5hbWVUeXBlLCBib29sZWFuIGNoZWNr\nRm9yVW5pcXVlbmVzcykgewogICAgICAgIHJldHVybiBuYW1pbmdVdGlsLm1h\na2VOYW1lVmFsaWQobmFtZSwgc2V0LAogICAgICAgICAgICBtYXhMZW4sIG5h\nbWVUeXBlLCBjaGVja0ZvclVuaXF1ZW5lc3MpLnRvU3RyaW5nKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTaG9ydGVucyB0aGUgZ2l2ZW4gbmFtZSB0byB0\naGUgZ2l2ZW4gbWF4aW11bSBsZW5ndGgsIHRoZW4gY2hlY2tzIHRoYXQKICAg\nICAqIGl0IGlzIG5vdCBhIHJlc2VydmVkIHdvcmQuIElmIGl0IGlzIHJlc2Vy\ndmVkLCBhcHBlbmRzIGEgIjAiLiBJZgogICAgICogdGhlIG5hbWUgY29uZmxp\nY3RzIHdpdGggYW4gZXhpc3Rpbmcgc2NoZW1hIGNvbXBvbmVudCBhbmQgdW5p\ncXVlbmVzcwogICAgICogY2hlY2tpbmcgaXMgZW5hYmxlZCwgdGhlIGxhc3Qg\nY2hhcmFjdGVyIGlzIHJlcGxhY2Ugd2l0aCAnMCcsIHRoZW4gCiAgICAgKiAn\nMScsIGV0Yy4gCiAgICAgKiBOb3RlIHRoYXQgdGhlIGdpdmVuIG1heCBsZW4g\nbWF5IGJlIDAgaWYgdGhlIGRhdGFiYXNlIG1ldGFkYXRhIGlzIAogICAgICog\naW5jb21wbGV0ZS4KICAgICAqIAogICAgICogTm90ZTogSWYgdGhlIG5hbWUg\naXMgZGVsaW1pdGVkLCBtYWtlIHN1cmUgdGhlIGVuZGluZyBkZWxpbWl0ZXIg\naXMKICAgICAqIG5vdCBzdHJpcHBlZCBvZmYuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBEQklkZW50aWZpZXIgbWFrZU5hbWVWYWxpZChEQklkZW50aWZpZXIg\nbmFtZSwgTmFtZVNldCBzZXQsIGludCBtYXhMZW4sCiAgICAgICAgaW50IG5h\nbWVUeXBlLCBib29sZWFuIGNoZWNrRm9yVW5pcXVlbmVzcykgewogICAgICAg\nIHJldHVybiBuYW1pbmdVdGlsLm1ha2VJZGVudGlmaWVyVmFsaWQobmFtZSwg\nc2V0LAogICAgICAgICAgICBtYXhMZW4sIGNoZWNrRm9yVW5pcXVlbmVzcyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FM\nIHN0YXRlbWVudHMgdG8gY3JlYXRlIHRoZSBnaXZlbiB0YWJsZSwgY29tcGxl\ndGUKICAgICAqIHdpdGggY29sdW1ucy4gSW5kZXhlcyBhbmQgY29uc3RyYWlu\ndHMgd2lsbCBiZSBjcmVhdGVkIHNlcGFyYXRlbHkuCiAgICAgKi8KICAgIHB1\nYmxpYyBTdHJpbmdbXSBnZXRDcmVhdGVUYWJsZVNRTChUYWJsZSB0YWJsZSkg\newogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICBTdHJpbmcgdGFibGVOYW1lID0gY2hlY2tOYW1lTGVu\nZ3RoKGdldEZ1bGxOYW1lKHRhYmxlLCBmYWxzZSksIAogICAgICAgICAgICAg\nICAgbWF4VGFibGVOYW1lTGVuZ3RoLCAibG9uZy10YWJsZS1uYW1lIik7CiAg\nICAgICAgYnVmLmFwcGVuZCgiQ1JFQVRFIFRBQkxFICIpLmFwcGVuZCh0YWJs\nZU5hbWUpOwogICAgICAgIGlmIChzdXBwb3J0c0NvbW1lbnRzICYmIHRhYmxl\nLmhhc0NvbW1lbnQoKSkgewogICAgICAgICAgICBidWYuYXBwZW5kKCIgIik7\nCiAgICAgICAgICAgIGNvbW1lbnQoYnVmLCB0YWJsZS5nZXRDb21tZW50KCkp\nOwogICAgICAgICAgICBidWYuYXBwZW5kKCJcbiAgICAoIik7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgYnVmLmFwcGVuZCgiICgiKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGRvIHRoaXMgYmVmb3JlIGdldHRpbmcgdGhlIGNv\nbHVtbnMgc28gd2Uga25vdyBob3cgdG8gaGFuZGxlCiAgICAgICAgLy8gdGhl\nIGxhc3QgY29tbWEKICAgICAgICBTdHJpbmdCdWlsZGVyIGVuZEJ1ZiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgUHJpbWFyeUtleSBwayA9IHRh\nYmxlLmdldFByaW1hcnlLZXkoKTsKICAgICAgICBTdHJpbmcgcGtTdHI7CiAg\nICAgICAgaWYgKHBrICE9IG51bGwpIHsKICAgICAgICAgICAgcGtTdHIgPSBn\nZXRQcmltYXJ5S2V5Q29uc3RyYWludFNRTChwayk7CiAgICAgICAgICAgIGlm\nIChwa1N0ciAhPSBudWxsKQogICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVu\nZChwa1N0cik7CiAgICAgICAgfQoKICAgICAgICBVbmlxdWVbXSB1bnFzID0g\ndGFibGUuZ2V0VW5pcXVlcygpOwogICAgICAgIFN0cmluZyB1bnFTdHI7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB1bnFzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHVucVN0ciA9IGdldFVuaXF1ZUNvbnN0cmFpbnRTUUwo\ndW5xc1tpXSk7CiAgICAgICAgICAgIGlmICh1bnFTdHIgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgaWYgKGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAgICAg\nICAgICAgICAgICAgICAgZW5kQnVmLmFwcGVuZCgiLCAiKTsKICAgICAgICAg\nICAgICAgIGVuZEJ1Zi5hcHBlbmQodW5xU3RyKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9IHRhYmxlLmdldENv\nbHVtbnMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbHMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgYnVmLmFwcGVuZChnZXREZWNsYXJl\nQ29sdW1uU1FMKGNvbHNbaV0sIGZhbHNlKSk7CiAgICAgICAgICAgIGlmIChp\nIDwgY29scy5sZW5ndGggLSAxIHx8IGVuZEJ1Zi5sZW5ndGgoKSA+IDApCiAg\nICAgICAgICAgICAgICBidWYuYXBwZW5kKCIsICIpOwogICAgICAgICAgICBp\nZiAoc3VwcG9ydHNDb21tZW50cyAmJiBjb2xzW2ldLmhhc0NvbW1lbnQoKSkg\newogICAgICAgICAgICAgICAgY29tbWVudChidWYsIGNvbHNbaV0uZ2V0Q29t\nbWVudCgpKTsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIlxuICAgICIp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBidWYuYXBwZW5k\nKGVuZEJ1Zi50b1N0cmluZygpKTsKICAgICAgICBidWYuYXBwZW5kKCIpIik7\nCiAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkg\nfTsKICAgIH0KICAgIAogICAgcHVibGljIGludCBnZXRCYXRjaEZldGNoU2l6\nZShpbnQgYmF0Y2hGZXRjaFNpemUpIHsKICAgICAgICByZXR1cm4gYmF0Y2hG\nZXRjaFNpemU7CiAgICB9CgogICAgcHJvdGVjdGVkIFN0cmluZ0J1aWxkZXIg\nY29tbWVudChTdHJpbmdCdWlsZGVyIGJ1ZiwgU3RyaW5nIGNvbW1lbnQpIHsK\nICAgICAgICByZXR1cm4gYnVmLmFwcGVuZCgiLS0gIikuYXBwZW5kKGNvbW1l\nbnQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9m\nIFNRTCBzdGF0ZW1lbnRzIHRvIGRyb3AgdGhlIGdpdmVuIHRhYmxlLiBJbmRl\neGVzCiAgICAgKiB3aWxsIGJlIGRyb3BwZWQgc2VwYXJhdGVseS4gUmV0dXJu\ncwogICAgICogPGNvZGU+RFJPUCBUQUJMRSAmbHQ7dGFibGUgbmFtZSZndDs8\nL2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdb\nXSBnZXREcm9wVGFibGVTUUwoVGFibGUgdGFibGUpIHsKICAgICAgICBTdHJp\nbmcgZHJvcCA9IE1lc3NhZ2VGb3JtYXQuZm9ybWF0KGRyb3BUYWJsZVNRTCwg\nbmV3IE9iamVjdFtdewogICAgICAgICAgICBnZXRGdWxsTmFtZSh0YWJsZSwg\nZmFsc2UpIH0pOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGRyb3Ag\nfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBT\nUUwgc3RhdGVtZW50cyB0byBjcmVhdGUgdGhlIGdpdmVuIHNlcXVlbmNlLiBS\nZXR1cm5zCiAgICAgKiA8Y29kZT5DUkVBVEUgU0VRVUVOQ0UgJmx0O3NlcXVl\nbmNlIG5hbWUmZ3Q7WyBTVEFSVCBXSVRIICZsdDtzdGFydCZndDtdCiAgICAg\nKiBbIElOQ1JFTUVOVCBCWSAmbHQ7aW5jcmVtZW50Jmd0O108L2NvZGU+IGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRDcmVh\ndGVTZXF1ZW5jZVNRTChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBpZiAobmV4\ndFNlcXVlbmNlUXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1\naWxkZXIoKTsKICAgICAgICBidWYuYXBwZW5kKCJDUkVBVEUgU0VRVUVOQ0Ug\nIik7CiAgICAgICAgU3RyaW5nIHNlcU5hbWUgPSBjaGVja05hbWVMZW5ndGgo\nZ2V0RnVsbE5hbWUoc2VxKSwgbWF4VGFibGVOYW1lTGVuZ3RoLCAKICAgICAg\nICAgICAgICAgICJsb25nLXNlcS1uYW1lIik7CiAgICAgICAgYnVmLmFwcGVu\nZChzZXFOYW1lKTsKICAgICAgICBpZiAoc2VxLmdldEluaXRpYWxWYWx1ZSgp\nICE9IDApCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBTVEFSVCBXSVRIICIp\nLmFwcGVuZChzZXEuZ2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgIGlmIChz\nZXEuZ2V0SW5jcmVtZW50KCkgPiAxKQogICAgICAgICAgICBidWYuYXBwZW5k\nKCIgSU5DUkVNRU5UIEJZICIpLmFwcGVuZChzZXEuZ2V0SW5jcmVtZW50KCkp\nOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117IGJ1Zi50b1N0cmluZygp\nIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2Yg\nU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2ZW4gc2VxdWVuY2UuIFJl\ndHVybnMKICAgICAqIDxjb2RlPkRST1AgU0VRVUVOQ0UgJmx0O3NlcXVlbmNl\nIG5hbWUmZ3Q7PC9jb2RlPiBieSBkZWZhdWx0LgogICAgICovCiAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RHJvcFNlcXVlbmNlU1FMKFNlcXVlbmNlIHNlcSkg\newogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJEUk9QIFNFUVVFTkNF\nICIgKyBnZXRGdWxsTmFtZShzZXEpIH07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gY3JlYXRl\nIHRoZSBnaXZlbiBpbmRleC4gUmV0dXJucwogICAgICogPGNvZGU+Q1JFQVRF\nIFtVTklRVUVdIElOREVYICZsdDtpbmRleCBuYW1lJmd0OyBPTiAmbHQ7dGFi\nbGUgbmFtZSZndDsKICAgICAqICgmbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4g\nYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1tdIGdldENy\nZWF0ZUluZGV4U1FMKEluZGV4IGluZGV4KSB7CiAgICAgICAgU3RyaW5nQnVp\nbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIkNSRUFURSAiKTsKICAgICAgICBpZiAoaW5kZXguaXNVbmlxdWUo\nKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiVU5JUVVFICIpOwogICAgICAg\nIFN0cmluZyBpbmRleE5hbWUgPSBjaGVja05hbWVMZW5ndGgodG9EQk5hbWUo\naW5kZXguZ2V0SWRlbnRpZmllcigpKSwgbWF4SW5kZXhOYW1lTGVuZ3RoLCAK\nICAgICAgICAgICAgICAgICJsb25nLWluZGV4LW5hbWUiKTsKICAgICAgICBi\ndWYuYXBwZW5kKCJJTkRFWCAiKS5hcHBlbmQoaW5kZXhOYW1lKTsKICAgICAg\nICBidWYuYXBwZW5kKCIgT04gIikuYXBwZW5kKGdldEZ1bGxOYW1lKGluZGV4\nLmdldFRhYmxlKCksIGZhbHNlKSk7CiAgICAgICAgYnVmLmFwcGVuZCgiICgi\nKS5hcHBlbmQobmFtaW5nVXRpbC5hcHBlbmRDb2x1bW5zKGluZGV4LmdldENv\nbHVtbnMoKSkpLgogICAgICAgICAgICBhcHBlbmQoIikiKTsKCiAgICAgICAg\ncmV0dXJuIG5ldyBTdHJpbmdbXXsgYnVmLnRvU3RyaW5nKCkgfTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVt\nZW50cyB0byBkcm9wIHRoZSBnaXZlbiBpbmRleC4gUmV0dXJucwogICAgICog\nPGNvZGU+RFJPUCBJTkRFWCAmbHQ7aW5kZXggbmFtZSZndDs8L2NvZGU+IGJ5\nIGRlZmF1bHQuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXREcm9w\nSW5kZXhTUUwoSW5kZXggaW5kZXgpIHsKICAgICAgICByZXR1cm4gbmV3IFN0\ncmluZ1tdeyAiRFJPUCBJTkRFWCAiICsgZ2V0RnVsbE5hbWUoaW5kZXgpIH07\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBzZXJpZXMgb2YgU1FM\nIHN0YXRlbWVudHMgdG8gYWRkIHRoZSBnaXZlbiBjb2x1bW4gdG8KICAgICAq\nIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlv\nbiBub3Qgc3VwcG9ydGVkLiBSZXR1cm5zCiAgICAgKiA8Y29kZT5BTFRFUiBU\nQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQUREICgmbHQ7Y29sIGRlYyZndDsp\nPC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGlj\nIFN0cmluZ1tdIGdldEFkZENvbHVtblNRTChDb2x1bW4gY29sdW1uKSB7CiAg\nICAgICAgaWYgKCFzdXBwb3J0c0FsdGVyVGFibGVXaXRoQWRkQ29sdW1uKQog\nICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZ1swXTsKCiAgICAgICAgU3Ry\naW5nIGRlYyA9IGdldERlY2xhcmVDb2x1bW5TUUwoY29sdW1uLCB0cnVlKTsK\nICAgICAgICBpZiAoZGVjID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\nZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJB\nTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoY29sdW1u\nLmdldFRhYmxlKCksIGZhbHNlKSArICIgQUREICIgKyBkZWMgfTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBvZiBTUUwgc3RhdGVt\nZW50cyB0byBkcm9wIHRoZSBnaXZlbiBjb2x1bW4gZnJvbQogICAgICogaXRz\nIHRhYmxlLiBSZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5v\ndCBzdXBwb3J0ZWQuIFJldHVybnMKICAgICAqIDxjb2RlPkFMVEVSIFRBQkxF\nICZsdDt0YWJsZSBuYW1lJmd0OyBEUk9QIENPTFVNTiAmbHQ7Y29sIG5hbWUm\nZ3Q7PC9jb2RlPgogICAgICogYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZ1tdIGdldERyb3BDb2x1bW5TUUwoQ29sdW1uIGNvbHVtbikg\newogICAgICAgIGlmICghc3VwcG9ydHNBbHRlclRhYmxlV2l0aERyb3BDb2x1\nbW4pCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAg\nICAgICsgZ2V0RnVsbE5hbWUoY29sdW1uLmdldFRhYmxlKCksIGZhbHNlKQog\nICAgICAgICAgICArICIgRFJPUCBDT0xVTU4gIiArIGNvbHVtbiB9OwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgc2VyaWVzIG9mIFNRTCBzdGF0\nZW1lbnRzIHRvIGFkZCB0aGUgZ2l2ZW4gcHJpbWFyeSBrZXkgdG8KICAgICAq\nIGl0cyB0YWJsZS4gUmV0dXJuIGFuIGVtcHR5IGFycmF5IGlmIG9wZXJhdGlv\nbiBub3Qgc3VwcG9ydGVkLgogICAgICogUmV0dXJucyA8Y29kZT5BTFRFUiBU\nQUJMRSAmbHQ7dGFibGUgbmFtZSZndDsgQURECiAgICAgKiAmbHQ7cGsgY29u\ncyBzcWwgJmd0OzwvY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVi\nbGljIFN0cmluZ1tdIGdldEFkZFByaW1hcnlLZXlTUUwoUHJpbWFyeUtleSBw\naykgewogICAgICAgIFN0cmluZyBwa3NxbCA9IGdldFByaW1hcnlLZXlDb25z\ndHJhaW50U1FMKHBrKTsKICAgICAgICBpZiAocGtzcWwgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdbMF07CiAgICAgICAgcmV0dXJu\nIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAgICAgICAgICAgKyBn\nZXRGdWxsTmFtZShway5nZXRUYWJsZSgpLCBmYWxzZSkgKyAiIEFERCAiICsg\ncGtzcWwgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmll\ncyBvZiBTUUwgc3RhdGVtZW50cyB0byBkcm9wIHRoZSBnaXZlbiBwcmltYXJ5\nIGtleSBmcm9tCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBh\ncnJheSBpZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4KICAgICAqIFJldHVy\nbnMgPGNvZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IERST1Ag\nQ09OU1RSQUlOVAogICAgICogJmx0O3BrIG5hbWUmZ3Q7PC9jb2RlPiBieSBk\nZWZhdWx0LgogICAgICovCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RHJvcFBy\naW1hcnlLZXlTUUwoUHJpbWFyeUtleSBwaykgewogICAgICAgIGlmIChEQklk\nZW50aWZpZXIuaXNOdWxsKHBrLmdldElkZW50aWZpZXIoKSkpCiAgICAgICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgIHJldHVybiBuZXcg\nU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVs\nbE5hbWUocGsuZ2V0VGFibGUoKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBE\nUk9QIENPTlNUUkFJTlQgIiArIHRvREJOYW1lKHBrLmdldElkZW50aWZpZXIo\nKSkgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIHNlcmllcyBv\nZiBTUUwgc3RhdGVtZW50cyB0byBhZGQgdGhlIGdpdmVuIGZvcmVpZ24ga2V5\nIHRvCiAgICAgKiBpdHMgdGFibGUuIFJldHVybiBhbiBlbXB0eSBhcnJheSBp\nZiBvcGVyYXRpb24gbm90IHN1cHBvcnRlZC4KICAgICAqIFJldHVybnMgPGNv\nZGU+QUxURVIgVEFCTEUgJmx0O3RhYmxlIG5hbWUmZ3Q7IEFERAogICAgICog\nJmx0O2ZrIGNvbnMgc3FsICZndDs8L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAg\nKi8KICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRBZGRGb3JlaWduS2V5U1FMKEZv\ncmVpZ25LZXkgZmspIHsKICAgICAgICBTdHJpbmcgZmtTUUwgPSBnZXRGb3Jl\naWduS2V5Q29uc3RyYWludFNRTChmayk7CiAgICAgICAgaWYgKGZrU1FMID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAg\nICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRFUiBUQUJMRSAiCiAgICAg\nICAgICAgICsgZ2V0RnVsbE5hbWUoZmsuZ2V0VGFibGUoKSwgZmFsc2UpICsg\nIiBBREQgIiArIGZrU1FMIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gYSBzZXJpZXMgb2YgU1FMIHN0YXRlbWVudHMgdG8gZHJvcCB0aGUgZ2l2\nZW4gZm9yZWlnbiBrZXkgZnJvbQogICAgICogaXRzIHRhYmxlLiBSZXR1cm4g\nYW4gZW1wdHkgYXJyYXkgaWYgb3BlcmF0aW9uIG5vdCBzdXBwb3J0ZWQuCiAg\nICAgKiBSZXR1cm5zIDxjb2RlPkFMVEVSIFRBQkxFICZsdDt0YWJsZSBuYW1l\nJmd0OyBEUk9QIENPTlNUUkFJTlQKICAgICAqICZsdDtmayBuYW1lJmd0Ozwv\nY29kZT4gYnkgZGVmYXVsdC4KICAgICAqLwogICAgcHVibGljIFN0cmluZ1td\nIGdldERyb3BGb3JlaWduS2V5U1FMKEZvcmVpZ25LZXkgZmssIENvbm5lY3Rp\nb24gY29ubikgewogICAgICAgIGlmIChEQklkZW50aWZpZXIuaXNOdWxsKGZr\nLmdldElkZW50aWZpZXIoKSkpIHsKICAgICAgICAgICAgU3RyaW5nW10gcmV0\nVmFsOwogICAgICAgICAgICBEQklkZW50aWZpZXIgZmtOYW1lID0gZmsubG9h\nZElkZW50aWZpZXJGcm9tREIodGhpcyxjb25uKTsKICAgICAgICAgICAgcmV0\nVmFsID0gKGZrTmFtZSA9PSBudWxsKSA/ICBuZXcgU3RyaW5nWzBdIDoKICAg\nICAgICAgICAgICAgIG5ldyBTdHJpbmdbXXsgIkFMVEVSIFRBQkxFICIKICAg\nICAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoZmsuZ2V0VGFibGUoKSwgZmFs\nc2UpCiAgICAgICAgICAgICAgICArICIgRFJPUCBDT05TVFJBSU5UICIgKyB0\nb0RCTmFtZShma05hbWUpIH07CiAgICAgICAgICAgIHJldHVybiByZXRWYWw7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU3RyaW5nW117ICJBTFRF\nUiBUQUJMRSAiCiAgICAgICAgICAgICsgZ2V0RnVsbE5hbWUoZmsuZ2V0VGFi\nbGUoKSwgZmFsc2UpCiAgICAgICAgICAgICsgIiBEUk9QIENPTlNUUkFJTlQg\nIiArIHRvREJOYW1lKGZrLmdldElkZW50aWZpZXIoKSkgfTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgZGVjbGFyYXRpb24gU1FMIGZvciB0\naGUgZ2l2ZW4gY29sdW1uLiBUaGlzIG1ldGhvZCBpcyB1c2VkCiAgICAgKiBm\nb3IgZWFjaCBjb2x1bW4gZnJvbSB3aXRoaW4ge0BsaW5rICNnZXRDcmVhdGVU\nYWJsZVNRTH0gYW5kCiAgICAgKiB7QGxpbmsgI2dldEFkZENvbHVtblNRTH0u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0RGVjbGFyZUNvbHVt\nblNRTChDb2x1bW4gY29sLCBib29sZWFuIGFsdGVyKSB7CiAgICAgICAgU3Ry\naW5nQnVpbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAg\nIFN0cmluZyBjb2x1bW5OYW1lID0gY2hlY2tOYW1lTGVuZ3RoKHRvREJOYW1l\nKGNvbC5nZXRJZGVudGlmaWVyKCkpLCBtYXhDb2x1bW5OYW1lTGVuZ3RoLCAK\nICAgICAgICAgICAgICAgICJsb25nLWNvbHVtbi1uYW1lIik7CiAgICAgICAg\nYnVmLmFwcGVuZChjb2x1bW5OYW1lKS5hcHBlbmQoIiAiKTsKICAgICAgICBi\ndWYuYXBwZW5kKGdldFR5cGVOYW1lKGNvbCkpOwoKICAgICAgICAvLyBjYW4n\ndCBhZGQgY29uc3RyYWludHMgdG8gYSBjb2x1bW4gd2UncmUgYWRkaW5nIGFm\ndGVyIHRhYmxlCiAgICAgICAgLy8gY3JlYXRpb24sIGNhdXNlIHNvbWUgZGF0\nYSBtaWdodCBhbHJlYWR5IGJlIGluc2VydGVkCiAgICAgICAgaWYgKCFhbHRl\ncikgewogICAgICAgICAgICBpZiAoY29sLmdldERlZmF1bHRTdHJpbmcoKSAh\nPSBudWxsICYmICFjb2wuaXNBdXRvQXNzaWduZWQoKSkKICAgICAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBERUZBVUxUICIpLmFwcGVuZChjb2wuZ2V0RGVm\nYXVsdFN0cmluZygpKTsKICAgICAgICAgICAgaWYgKGNvbC5pc05vdE51bGwo\nKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBOT1QgTlVMTCIpOwog\nICAgICAgIH0KICAgICAgICBpZiAoY29sLmlzQXV0b0Fzc2lnbmVkKCkpIHsK\nICAgICAgICAgICAgaWYgKCFzdXBwb3J0c0F1dG9Bc3NpZ24pCiAgICAgICAg\nICAgICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC1hdXRvYXNzaWdu\nIiwgcGxhdGZvcm0sIGNvbCkpOwogICAgICAgICAgICBlbHNlIGlmIChhdXRv\nQXNzaWduQ2xhdXNlICE9IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBw\nZW5kKCIgIikuYXBwZW5kKGF1dG9Bc3NpZ25DbGF1c2UpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0aW9uIFNRTCBmb3IgdGhlIGdp\ndmVuIHByaW1hcnkga2V5LiBUaGlzIG1ldGhvZCBpcwogICAgICogdXNlZCBm\ncm9tIHdpdGhpbiB7QGxpbmsgI2dldENyZWF0ZVRhYmxlU1FMfSBhbmQKICAg\nICAqIHtAbGluayAjZ2V0QWRkUHJpbWFyeUtleVNRTH0uIFJldHVybnMKICAg\nICAqIDxjb2RlPkNPTlNUUkFJTlQgJmx0O3BrIG5hbWUmZ3Q7IFBSSU1BUlkg\nS0VZICgmbHQ7Y29sIGxpc3QmZ3Q7KTwvY29kZT4KICAgICAqIGJ5IGRlZmF1\nbHQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0UHJpbWFyeUtl\neUNvbnN0cmFpbnRTUUwoUHJpbWFyeUtleSBwaykgewogICAgICAgIC8vIGlm\nIHdlIGhhdmUgZGlzYWJsZWQgdGhlIGNyZWF0aW9uIG9mIHByaW1hcnkga2V5\ncywgYWJvcnQgaGVyZQogICAgICAgIGlmICghY3JlYXRlUHJpbWFyeUtleXMp\nCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBTdHJpbmcgbmFt\nZSA9IHRvREJOYW1lKHBrLmdldElkZW50aWZpZXIoKSk7CiAgICAgICAgaWYg\nKG5hbWUgIT0gbnVsbCAmJiByZXNlcnZlZFdvcmRTZXQuY29udGFpbnMobmFt\nZS50b1VwcGVyQ2FzZSgpKSkKICAgICAgICAgICAgbmFtZSA9IG51bGw7Cgog\nICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIo\nKTsKICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIENPTlNfTkFNRV9CRUZP\nUkUuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIkNPTlNUUkFJTlQgIikuYXBwZW5kKG5hbWUpLmFwcGVuZCgi\nICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlBSSU1BUlkgS0VZICIpOwogICAg\nICAgIGlmIChuYW1lICE9IG51bGwgJiYgQ09OU19OQU1FX01JRC5lcXVhbHMo\nY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAgICAgICAgYnVmLmFwcGVuZChu\nYW1lKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYuYXBwZW5kKCIoIikuYXBw\nZW5kKG5hbWluZ1V0aWwuYXBwZW5kQ29sdW1ucyhway5nZXRDb2x1bW5zKCkp\nKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKG5hbWUg\nIT0gbnVsbCAmJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFpbnRO\nYW1lTW9kZSkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5U\nICIpLmFwcGVuZChuYW1lKTsKICAgICAgICByZXR1cm4gYnVmLnRvU3RyaW5n\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGRlY2xhcmF0\naW9uIFNRTCBmb3IgdGhlIGdpdmVuIGZvcmVpZ24ga2V5LCBvciBudWxsIGlm\nIGl0IGlzCiAgICAgKiBub3Qgc3VwcG9ydGVkLiBUaGlzIG1ldGhvZCBpcyB1\nc2VkIGZyb20gd2l0aGluCiAgICAgKiB7QGxpbmsgI2dldENyZWF0ZVRhYmxl\nU1FMfSBhbmQge0BsaW5rICNnZXRBZGRGb3JlaWduS2V5U1FMfS4gUmV0dXJu\ncwogICAgICogPGNvZGU+Q09OU1RSQUlOVCAmbHQ7Y29ucyBuYW1lJmd0OyBG\nT1JFSUdOIEtFWSAoJmx0O2NvbCBsaXN0Jmd0OykKICAgICAqIFJFRkVSRU5D\nRVMgJmx0O2ZvcmVpZ24gdGFibGUmZ3Q7ICgmbHQ7Y29sIGxpc3QmZ3Q7KQog\nICAgICogW09OIERFTEVURSAmbHQ7YWN0aW9uJmd0O10gW09OIFVQREFURSAm\nbHQ7YWN0aW9uJmd0O108L2NvZGU+IGJ5IGRlZmF1bHQuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0Rm9yZWlnbktleUNvbnN0cmFpbnRTUUwo\nRm9yZWlnbktleSBmaykgewogICAgICAgIGlmICghc3VwcG9ydHNGb3JlaWdu\nS2V5cykKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGZr\nLmdldENvbHVtbnMoKS5sZW5ndGggPiAwICYmICFzdXBwb3J0c0ZvcmVpZ25L\nZXlzQ29tcG9zaXRlKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nICBpZiAoZmsuZ2V0RGVsZXRlQWN0aW9uKCkgPT0gRm9yZWlnbktleS5BQ1RJ\nT05fTk9ORSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKGZrLmlzRGVmZXJyZWQoKSAmJiAhc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25L\nZXlDb25zdHJhaW50cygpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAoIXN1cHBvcnRzRGVsZXRlQWN0aW9uKGZrLmdldERlbGV0ZUFj\ndGlvbigpKQogICAgICAgICAgICB8fCAhc3VwcG9ydHNVcGRhdGVBY3Rpb24o\nZmsuZ2V0VXBkYXRlQWN0aW9uKCkpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgQ29sdW1uW10gbG9jYWxzID0gZmsuZ2V0Q29sdW1ucygp\nOwogICAgICAgIENvbHVtbltdIGZvcmVpZ25zID0gZmsuZ2V0UHJpbWFyeUtl\neUNvbHVtbnMoKTsKCiAgICAgICAgaW50IGRlbEFjdGlvbklkID0gZmsuZ2V0\nRGVsZXRlQWN0aW9uKCk7CiAgICAgICAgaWYgKGRlbEFjdGlvbklkID09IEZv\ncmVpZ25LZXkuQUNUSU9OX05VTEwpIHsKICAgICAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBsb2NhbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGlmIChsb2NhbHNbaV0uaXNOb3ROdWxsKCkpCiAgICAgICAgICAgICAg\nICAgICAgZGVsQWN0aW9uSWQgPSBGb3JlaWduS2V5LkFDVElPTl9OT05FOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgZGVsQWN0\naW9uID0gZ2V0QWN0aW9uTmFtZShkZWxBY3Rpb25JZCk7CiAgICAgICAgU3Ry\naW5nIHVwQWN0aW9uID0gZ2V0QWN0aW9uTmFtZShmay5nZXRVcGRhdGVBY3Rp\nb24oKSk7CgogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmlu\nZ0J1aWxkZXIoKTsKICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwo\nZmsuZ2V0SWRlbnRpZmllcigpKQogICAgICAgICAgICAmJiBDT05TX05BTUVf\nQkVGT1JFLmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAg\nICBidWYuYXBwZW5kKCJDT05TVFJBSU5UICIpLmFwcGVuZCh0b0RCTmFtZShm\nay5nZXRJZGVudGlmaWVyKCkpKS5hcHBlbmQoIiAiKTsKICAgICAgICBidWYu\nYXBwZW5kKCJGT1JFSUdOIEtFWSAiKTsKICAgICAgICBpZiAoIURCSWRlbnRp\nZmllci5pc051bGwoZmsuZ2V0SWRlbnRpZmllcigpKSAmJiBDT05TX05BTUVf\nTUlELmVxdWFscyhjb25zdHJhaW50TmFtZU1vZGUpKQogICAgICAgICAgICBi\ndWYuYXBwZW5kKHRvREJOYW1lKGZrLmdldElkZW50aWZpZXIoKSkpLmFwcGVu\nZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5hcHBlbmQobmFtaW5n\nVXRpbC5hcHBlbmRDb2x1bW5zKGxvY2FscykpLmFwcGVuZCgiKSIpOwogICAg\nICAgIGJ1Zi5hcHBlbmQoIiBSRUZFUkVOQ0VTICIpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoZ2V0RnVsbE5hbWUoZm9yZWlnbnNbMF0uZ2V0VGFibGUoKSwgZmFs\nc2UpKTsKICAgICAgICBidWYuYXBwZW5kKCIgKCIpLmFwcGVuZChuYW1pbmdV\ndGlsLmFwcGVuZENvbHVtbnMoZm9yZWlnbnMpKS5hcHBlbmQoIikiKTsKICAg\nICAgICBpZiAoZGVsQWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5h\ncHBlbmQoIiBPTiBERUxFVEUgIikuYXBwZW5kKGRlbEFjdGlvbik7CiAgICAg\nICAgaWYgKHVwQWN0aW9uICE9IG51bGwpCiAgICAgICAgICAgIGJ1Zi5hcHBl\nbmQoIiBPTiBVUERBVEUgIikuYXBwZW5kKHVwQWN0aW9uKTsKICAgICAgICBp\nZiAoZmsuaXNEZWZlcnJlZCgpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIg\nSU5JVElBTExZIERFRkVSUkVEIik7CiAgICAgICAgaWYgKHN1cHBvcnRzRGVm\nZXJyZWRGb3JlaWduS2V5Q29uc3RyYWludHMoKSkKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiIERFRkVSUkFCTEUiKTsKICAgICAgICBpZiAoIURCSWRlbnRp\nZmllci5pc051bGwoZmsuZ2V0SWRlbnRpZmllcigpKQogICAgICAgICAgICAm\nJiBDT05TX05BTUVfQUZURVIuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBDT05TVFJBSU5UICIpLmFwcGVu\nZCh0b0RCTmFtZShmay5nZXRJZGVudGlmaWVyKCkpKTsKICAgICAgICByZXR1\ncm4gYnVmLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0\naGVyIG9yIG5vdCB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgZGVmZXJyZWQg\nZm9yZWlnbiBrZXkgY29uc3RyYWludHMuCiAgICAgKiBUaGlzIGltcGxlbWVu\ndGF0aW9uIHJldHVybnMge0BsaW5rICNzdXBwb3J0c1VuaXF1ZUNvbnN0cmFp\nbnRzfS4KICAgICAqCiAgICAgKiBAc2luY2UgMS4xLjAKICAgICAqLwogICAg\ncHJvdGVjdGVkIGJvb2xlYW4gc3VwcG9ydHNEZWZlcnJlZEZvcmVpZ25LZXlD\nb25zdHJhaW50cygpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZlcnJl\nZENvbnN0cmFpbnRzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSBuYW1lIG9mIHRoZSBnaXZlbiBmb3JlaWduIGtleSBhY3Rpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldEFjdGlvbk5hbWUoaW50IGFjdGlv\nbikgewogICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgICAgIGNh\nc2UgRm9yZWlnbktleS5BQ1RJT05fQ0FTQ0FERToKICAgICAgICAgICAgICAg\nIHJldHVybiAiQ0FTQ0FERSI7CiAgICAgICAgICAgIGNhc2UgRm9yZWlnbktl\neS5BQ1RJT05fTlVMTDoKICAgICAgICAgICAgICAgIHJldHVybiAiU0VUIE5V\nTEwiOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFV\nTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNFVCBERUZBVUxUIjsKICAg\nICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhp\ncyBkYXRhYmFzZSBzdXBwb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgZGVs\nZXRlIGFjdGlvbi4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9y\ndHNEZWxldGVBY3Rpb24oaW50IGFjdGlvbikgewogICAgICAgIGlmIChhY3Rp\nb24gPT0gRm9yZWlnbktleS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChhY3Rp\nb24pIHsKICAgICAgICAgICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9SRVNU\nUklDVDoKICAgICAgICAgICAgICAgIHJldHVybiBzdXBwb3J0c1Jlc3RyaWN0\nRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNU\nSU9OX0NBU0NBREU6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHND\nYXNjYWRlRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25L\nZXkuQUNUSU9OX05VTEw6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9y\ndHNOdWxsRGVsZXRlQWN0aW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25L\nZXkuQUNUSU9OX0RFRkFVTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3Vw\ncG9ydHNEZWZhdWx0RGVsZXRlQWN0aW9uOwogICAgICAgICAgICBkZWZhdWx0\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhpcyBkYXRhYmFzZSBzdXBw\nb3J0cyB0aGUgZ2l2ZW4gZm9yZWlnbiBrZXkgdXBkYXRlIGFjdGlvbi4KICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNVcGRhdGVBY3Rpb24o\naW50IGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gRm9yZWlnbktl\neS5BQ1RJT05fTk9ORSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25LZXlzKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAg\nICAgY2FzZSBGb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVDoKICAgICAgICAg\nICAgICAgIHJldHVybiBzdXBwb3J0c1Jlc3RyaWN0VXBkYXRlQWN0aW9uOwog\nICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0NBU0NBREU6CiAg\nICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNDYXNjYWRlVXBkYXRlQWN0\naW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX05VTEw6\nCiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNOdWxsVXBkYXRlQWN0\naW9uOwogICAgICAgICAgICBjYXNlIEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFV\nTFQ6CiAgICAgICAgICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZhdWx0VXBk\nYXRlQWN0aW9uOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgZGVjbGFyYXRpb24gU1FMIGZvciB0aGUgZ2l2ZW4g\ndW5pcXVlIGNvbnN0cmFpbnQuIFRoaXMKICAgICAqIG1ldGhvZCBpcyB1c2Vk\nIGZyb20gd2l0aGluIHtAbGluayAjZ2V0Q3JlYXRlVGFibGVTUUx9LgogICAg\nICogUmV0dXJucyA8Y29kZT5DT05TVFJBSU5UICZsdDtuYW1lJmd0OyBVTklR\nVUUgKCZsdDtjb2wgbGlzdCZndDspPC9jb2RlPgogICAgICogYnkgZGVmYXVs\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRVbmlxdWVDb25z\ndHJhaW50U1FMKFVuaXF1ZSB1bnEpIHsKICAgICAgICBpZiAoIXN1cHBvcnRz\nVW5pcXVlQ29uc3RyYWludHMKICAgICAgICAgICAgfHwgKHVucS5pc0RlZmVy\ncmVkKCkgJiYgIXN1cHBvcnRzRGVmZXJyZWRVbmlxdWVDb25zdHJhaW50cygp\nKSkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgU3RyaW5nQnVp\nbGRlciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGlmICgh\nREJJZGVudGlmaWVyLmlzTnVsbCh1bnEuZ2V0SWRlbnRpZmllcigpKQogICAg\nICAgICAgICAmJiBDT05TX05BTUVfQkVGT1JFLmVxdWFscyhjb25zdHJhaW50\nTmFtZU1vZGUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCJDT05TVFJBSU5U\nICIpLmFwcGVuZChjaGVja05hbWVMZW5ndGgodG9EQk5hbWUodW5xLmdldElk\nZW50aWZpZXIoKSksIAogICAgICAgICAgICAgICAgbWF4Q29uc3RyYWludE5h\nbWVMZW5ndGgsICJsb25nLWNvbnN0cmFpbnQtbmFtZSIpKS5hcHBlbmQoIiAi\nKTsKICAgICAgICBidWYuYXBwZW5kKCJVTklRVUUgIik7CiAgICAgICAgaWYg\nKCFEQklkZW50aWZpZXIuaXNOdWxsKHVucS5nZXRJZGVudGlmaWVyKCkpICYm\nIENPTlNfTkFNRV9NSUQuZXF1YWxzKGNvbnN0cmFpbnROYW1lTW9kZSkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQodG9EQk5hbWUodW5xLmdldElkZW50aWZp\nZXIoKSkpLmFwcGVuZCgiICIpOwogICAgICAgIGJ1Zi5hcHBlbmQoIigiKS5h\ncHBlbmQobmFtaW5nVXRpbC5hcHBlbmRDb2x1bW5zKHVucS5nZXRDb2x1bW5z\nKCkpKS4KICAgICAgICAgICAgYXBwZW5kKCIpIik7CiAgICAgICAgaWYgKHVu\ncS5pc0RlZmVycmVkKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBJTklU\nSUFMTFkgREVGRVJSRUQiKTsKICAgICAgICBpZiAoc3VwcG9ydHNEZWZlcnJl\nZFVuaXF1ZUNvbnN0cmFpbnRzKCkpCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBERUZFUlJBQkxFIik7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNO\ndWxsKHVucS5nZXRJZGVudGlmaWVyKCkpCiAgICAgICAgICAgICYmIENPTlNf\nTkFNRV9BRlRFUi5lcXVhbHMoY29uc3RyYWludE5hbWVNb2RlKSkKICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIENPTlNUUkFJTlQgIikuYXBwZW5kKHRvREJO\nYW1lKHVucS5nZXRJZGVudGlmaWVyKCkpKTsKICAgICAgICByZXR1cm4gYnVm\nLnRvU3RyaW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG9y\nIG5vdCB0aGlzIGRpY3Rpb25hcnkgc3VwcG9ydHMgZGVmZXJyZWQgdW5pcXVl\nIGNvbnN0cmFpbnRzLgogICAgICogVGhpcyBpbXBsZW1lbnRhdGlvbiByZXR1\ncm5zIHtAbGluayAjc3VwcG9ydHNVbmlxdWVDb25zdHJhaW50c30uCiAgICAg\nKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8KICAgIHByb3RlY3RlZCBi\nb29sZWFuIHN1cHBvcnRzRGVmZXJyZWRVbmlxdWVDb25zdHJhaW50cygpIHsK\nICAgICAgICByZXR1cm4gc3VwcG9ydHNEZWZlcnJlZENvbnN0cmFpbnRzOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGF0YWJh\nc2UgbWV0YWRhdGEKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVt\nIHRhYmxlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJu\nIHRydWUgaWYgdGhlIGdpdmVuIHRhYmxlIG5hbWUgcmVwcmVzZW50cyBhIHN5\nc3RlbSB0YWJsZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVhciBpbiB0\naGUgc2NoZW1hIGRlZmluaXRpb24uIEJ5IGRlZmF1bHQsIHJldHVybnMKICAg\nICAqIHRydWUgb25seSBpZiB0aGUgZ2l2ZW4gdGFibGUgaXMgaW4gdGhlIGlu\ndGVybmFsIGxpc3Qgb2Ygc3lzdGVtIHRhYmxlcywKICAgICAqIG9yIGlmIHRo\nZSBnaXZlbiBzY2hlbWEgaXMgaW4gdGhlIGxpc3Qgb2Ygc3lzdGVtIHNjaGVt\nYXMgYW5kIGlzIG5vdAogICAgICogdGhlIHRhcmdldCBzY2hlbWEuCiAgICAg\nKgogICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxlIG5hbWUKICAgICAqIEBw\nYXJhbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsgbWF5IGJlIG51bGwKICAg\nICAqIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1ZSwgdGhlbiB0aGUgZ2l2\nZW4gc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAqIHRoZSB1c2VyIGFzIG9u\nZSBvZiBoaXMgc2NoZW1hcwogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gaXNTeXN0ZW1UYWJsZShTdHJpbmcgbmFtZSwg\nU3RyaW5nIHNjaGVtYSwKICAgICAgICBib29sZWFuIHRhcmdldFNjaGVtYSkg\newogICAgICAgIHJldHVybiBpc1N5c3RlbVRhYmxlKERCSWRlbnRpZmllci5u\nZXdUYWJsZShuYW1lKSwKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld1Nj\naGVtYShzY2hlbWEpLCB0YXJnZXRTY2hlbWEpOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHRh\nYmxlcyBmcm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRy\ndWUgaWYgdGhlIGdpdmVuIHRhYmxlIG5hbWUgcmVwcmVzZW50cyBhIHN5c3Rl\nbSB0YWJsZSB0aGF0CiAgICAgKiBzaG91bGQgbm90IGFwcGVhciBpbiB0aGUg\nc2NoZW1hIGRlZmluaXRpb24uIEJ5IGRlZmF1bHQsIHJldHVybnMKICAgICAq\nIHRydWUgb25seSBpZiB0aGUgZ2l2ZW4gdGFibGUgaXMgaW4gdGhlIGludGVy\nbmFsIGxpc3Qgb2Ygc3lzdGVtIHRhYmxlcywKICAgICAqIG9yIGlmIHRoZSBn\naXZlbiBzY2hlbWEgaXMgaW4gdGhlIGxpc3Qgb2Ygc3lzdGVtIHNjaGVtYXMg\nYW5kIGlzIG5vdAogICAgICogdGhlIHRhcmdldCBzY2hlbWEuCiAgICAgKgog\nICAgICogQHBhcmFtIG5hbWUgdGhlIHRhYmxlIG5hbWUKICAgICAqIEBwYXJh\nbSBzY2hlbWEgdGhlIHRhYmxlIHNjaGVtYTsgbWF5IGJlIG51bGwKICAgICAq\nIEBwYXJhbSB0YXJnZXRTY2hlbWEgaWYgdHJ1ZSwgdGhlbiB0aGUgZ2l2ZW4g\nc2NoZW1hIHdhcyBsaXN0ZWQgYnkKICAgICAqIHRoZSB1c2VyIGFzIG9uZSBv\nZiBoaXMgc2NoZW1hcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5\nc3RlbVRhYmxlKERCSWRlbnRpZmllciBuYW1lLCBEQklkZW50aWZpZXIgc2No\nZW1hLAogICAgICAgIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7CiAgICAgICAg\nREJJZGVudGlmaWVyIHNOYW1lID0gREJJZGVudGlmaWVyLnRvVXBwZXIobmFt\nZSk7CiAgICAgICAgaWYgKHN5c3RlbVRhYmxlU2V0LmNvbnRhaW5zKHNOYW1l\nLmdldE5hbWUoKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIERCSWRlbnRpZmllciBzY2hOYW1lID0gREJJZGVudGlmaWVyLnRvVXBwZXIo\nc2NoZW1hKTsKICAgICAgICByZXR1cm4gIXRhcmdldFNjaGVtYSAmJiBzY2hl\nbWEgIT0gbnVsbAogICAgICAgICAgICAmJiBzeXN0ZW1TY2hlbWFTZXQuY29u\ndGFpbnMoc2NoTmFtZS5nZXROYW1lKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIGluZGV4\nZXMgZnJvbSBkYXRhYmFzZSBtZXRhZGF0YS4KICAgICAqIFJldHVybiB0cnVl\nIGlmIHRoZSBnaXZlbiBpbmRleCBuYW1lIHJlcHJlc2VudHMgYSBzeXN0ZW0g\naW5kZXggdGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNj\naGVtYSBkZWZpbml0aW9uLiBSZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQuCiAg\nICAgKgogICAgICogQHBhcmFtIG5hbWUgdGhlIGluZGV4IG5hbWUKICAgICAq\nIEBwYXJhbSB0YWJsZSB0aGUgaW5kZXggdGFibGUKICAgICAqIEBkZXByZWNh\ndGVkCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtSW5kZXgo\nU3RyaW5nIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlz\nIHVzZWQgdG8gZmlsdGVyIHN5c3RlbSBpbmRleGVzIGZyb20gZGF0YWJhc2Ug\nbWV0YWRhdGEuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gaW5k\nZXggbmFtZSByZXByZXNlbnRzIGEgc3lzdGVtIGluZGV4IHRoYXQKICAgICAq\nIHNob3VsZCBub3QgYXBwZWFyIGluIHRoZSBzY2hlbWEgZGVmaW5pdGlvbi4g\nUmV0dXJucyBmYWxzZSBieSBkZWZhdWx0LgogICAgICoKICAgICAqIEBwYXJh\nbSBuYW1lIHRoZSBpbmRleCBuYW1lCiAgICAgKiBAcGFyYW0gdGFibGUgdGhl\nIGluZGV4IHRhYmxlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzU3lz\ndGVtSW5kZXgoREJJZGVudGlmaWVyIG5hbWUsIFRhYmxlIHRhYmxlKSB7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHNlcXVlbmNlcyBm\ncm9tIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYg\ndGhlIGdpdmVuIHNlcXVlbmNlIHJlcHJlc2VudHMgYSBzeXN0ZW0gc2VxdWVu\nY2UgdGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVt\nYSBkZWZpbml0aW9uLiBSZXR1cm5zIHRydWUgaWYgc3lzdGVtCiAgICAgKiBz\nY2hlbWEgYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0\naGUgdGFibGUgbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUg\nc2NoZW1hOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVt\nYSBpZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBi\neQogICAgICogdGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAg\nKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1N5\nc3RlbVNlcXVlbmNlKFN0cmluZyBuYW1lLCBTdHJpbmcgc2NoZW1hLAogICAg\nICAgIGJvb2xlYW4gdGFyZ2V0U2NoZW1hKSB7CiAgICAgICAgcmV0dXJuIGlz\nU3lzdGVtU2VxdWVuY2UoREJJZGVudGlmaWVyLm5ld1NlcXVlbmNlKG5hbWUp\nLCAKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWEp\nLCB0YXJnZXRTY2hlbWEpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgaXMgdXNlZCB0byBmaWx0ZXIgc3lzdGVtIHNlcXVlbmNlcyBmcm9t\nIGRhdGFiYXNlIG1ldGFkYXRhLgogICAgICogUmV0dXJuIHRydWUgaWYgdGhl\nIGdpdmVuIHNlcXVlbmNlIHJlcHJlc2VudHMgYSBzeXN0ZW0gc2VxdWVuY2Ug\ndGhhdAogICAgICogc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIHNjaGVtYSBk\nZWZpbml0aW9uLiBSZXR1cm5zIHRydWUgaWYgc3lzdGVtCiAgICAgKiBzY2hl\nbWEgYnkgZGVmYXVsdC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmFtZSB0aGUg\ndGFibGUgbmFtZQogICAgICogQHBhcmFtIHNjaGVtYSB0aGUgdGFibGUgc2No\nZW1hOyBtYXkgYmUgbnVsbAogICAgICogQHBhcmFtIHRhcmdldFNjaGVtYSBp\nZiB0cnVlLCB0aGVuIHRoZSBnaXZlbiBzY2hlbWEgd2FzIGxpc3RlZCBieQog\nICAgICogdGhlIHVzZXIgYXMgb25lIG9mIGhpcyBzY2hlbWFzCiAgICAgKi8K\nICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoREJJZGVudGlm\naWVyIG5hbWUsIERCSWRlbnRpZmllciBzY2hlbWEsCiAgICAgICAgYm9vbGVh\nbiB0YXJnZXRTY2hlbWEpIHsKICAgICAgICByZXR1cm4gIXRhcmdldFNjaGVt\nYSAmJiAhREJJZGVudGlmaWVyLmlzTnVsbChzY2hlbWEpCiAgICAgICAgICAg\nICYmIHN5c3RlbVNjaGVtYVNldC5jb250YWlucyhEQklkZW50aWZpZXIudG9V\ncHBlcihzY2hlbWEpLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCB0YWJsZXMgbWF0Y2hp\nbmcgdGhlIGdpdmVuIG5hbWUgcGF0dGVybi4KICAgICAqIEBkZXByZWNhdGVk\nCiAgICAgKi8KICAgIHB1YmxpYyBUYWJsZVtdIGdldFRhYmxlcyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNv\nbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGdldFRhYmxlcyhtZXRhLCBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhj\nYXRhbG9nKSwgREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwK\nICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlTmFtZSks\nIGNvbm4pOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9u\nIHRoZSBzY2hlbWEgdG8gZmluZCB0YWJsZXMgbWF0Y2hpbmcgdGhlIGdpdmVu\nIG5hbWUgcGF0dGVybi4KICAgICAqLwogICAgcHVibGljIFRhYmxlW10gZ2V0\nVGFibGVzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgREJJZGVudGlmaWVyIHNx\nbENhdGFsb2csCiAgICAgICAgREJJZGVudGlmaWVyIHNxbFNjaGVtYU5hbWUs\nIERCSWRlbnRpZmllciBzcWxUYWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lID0gREJJZGVudGlmaWVyLmlz\nTnVsbChzcWxTY2hlbWFOYW1lKSA/IG51bGwgOiBzcWxTY2hlbWFOYW1lLmdl\ndE5hbWUoKTsKICAgICAgICBpZiAoIXN1cHBvcnRzU2NoZW1hRm9yR2V0VGFi\nbGVzKQogICAgICAgICAgICBzY2hlbWFOYW1lID0gbnVsbDsKICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGdldFNjaGVtYU5hbWVG\nb3JNZXRhZGF0YShzcWxTY2hlbWFOYW1lKTsKICAgICAgICB9CgogICAgICAg\nIFN0cmluZ1tdIHR5cGVzID0gU3RyaW5ncy5zcGxpdCh0YWJsZVR5cGVzLCAi\nLCIsIDApOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHlwZXMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgIHR5cGVzW2ldID0gdHlwZXNbaV0udHJp\nbSgpOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihjb25uKTsK\nICAgICAgICBSZXN1bHRTZXQgdGFibGVzID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICB0YWJsZXMgPSBtZXRhLmdldFRhYmxlcyhnZXRDYXRh\nbG9nTmFtZUZvck1ldGFkYXRhKHNxbENhdGFsb2cpLAogICAgICAgICAgICAg\nICAgc2NoZW1hTmFtZSwgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEoc3FsVGFi\nbGVOYW1lKSwgdHlwZXMpOwogICAgICAgICAgICBMaXN0IHRhYmxlTGlzdCA9\nIG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgd2hpbGUgKHRhYmxlcyAh\nPSBudWxsICYmIHRhYmxlcy5uZXh0KCkpCiAgICAgICAgICAgICAgICB0YWJs\nZUxpc3QuYWRkKG5ld1RhYmxlKHRhYmxlcykpOwogICAgICAgICAgICByZXR1\ncm4gKFRhYmxlW10pIHRhYmxlTGlzdC50b0FycmF5KG5ldyBUYWJsZVt0YWJs\nZUxpc3Quc2l6ZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgaWYgKHRhYmxlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICB0YWJsZXMuY2xvc2UoKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEg\nbmV3IHRhYmxlIGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBUYWJsZSBuZXdUYWJs\nZShSZXN1bHRTZXQgdGFibGVNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIFRhYmxlIHQgPSBuZXcgVGFibGUoKTsKICAgICAg\nICB0LnNldElkZW50aWZpZXIoZnJvbURCTmFtZSh0YWJsZU1ldGEuZ2V0U3Ry\naW5nKCJUQUJMRV9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuVEFCTEUpKTsK\nICAgICAgICByZXR1cm4gdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxl\nY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHNlcXVlbmNlcyBtYXRjaGluZyB0\naGUgZ2l2ZW4gbmFtZSBwYXR0ZXJuLgogICAgICogUmV0dXJucyBhbiBlbXB0\neSBhcnJheSBieSBkZWZhdWx0LCBhcyB0aGVyZSBpcyBubyBzdGFuZGFyZCB3\nYXkgdG8KICAgICAqIHJldHJpZXZlIGEgbGlzdCBvZiBzZXF1ZW5jZXMuCiAg\nICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgU2VxdWVuY2Vb\nXSBnZXRTZXF1ZW5jZXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcg\nY2F0YWxvZywKICAgICAgICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHNl\ncXVlbmNlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZXMobWV0\nYSwgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY2F0YWxvZyksIERCSWRlbnRp\nZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksCiAgICAgICAgICAgIERCSWRl\nbnRpZmllci5uZXdTZXF1ZW5jZShzZXF1ZW5jZU5hbWUpLCBjb25uKTsKICAg\nICAgICAKICAgIH0KCiAgICBwdWJsaWMgU2VxdWVuY2VbXSBnZXRTZXF1ZW5j\nZXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBEQklkZW50aWZpZXIgY2F0YWxv\nZywKICAgICAgICBEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlm\naWVyIHNlcXVlbmNlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBzdHIgPSBnZXRT\nZXF1ZW5jZXNTUUwoc2NoZW1hTmFtZSwgc2VxdWVuY2VOYW1lKTsKICAgICAg\nICBpZiAoc3RyID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2Vx\ndWVuY2VbMF07CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0g\ncHJlcGFyZVN0YXRlbWVudChjb25uLCBzdHIpOyAgICAgICAgCiAgICAgICAg\nUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpbnQgaWR4ID0gMTsKICAgICAgICAgICAgaWYgKCFEQklkZW50aWZpZXIu\naXNOdWxsKHNjaGVtYU5hbWUpKQogICAgICAgICAgICAgICAgc3RtbnQuc2V0\nU3RyaW5nKGlkeCsrLCBEQklkZW50aWZpZXIudG9VcHBlcihzY2hlbWFOYW1l\nKS5nZXROYW1lKCkpOwogICAgICAgICAgICBpZiAoIURCSWRlbnRpZmllci5p\nc051bGwoc2VxdWVuY2VOYW1lKSkKICAgICAgICAgICAgICAgIHN0bW50LnNl\ndFN0cmluZyhpZHgrKywgc2VxdWVuY2VOYW1lLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIHNldFF1ZXJ5VGltZW91dChzdG1udCwgY29uZi5nZXRRdWVyeVRp\nbWVvdXQoKSk7CiAgICAgICAgICAgIHJzID0gZXhlY3V0ZVF1ZXJ5KGNvbm4s\nIHN0bW50LCBzdHIpOwogICAgICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2Uo\ncnMpOyAgICAgICAgICAgIAogICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBpZiAocnMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgcnMuY2xvc2UoKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoc3RtbnQgIT0gbnVsbCkgICAgCiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHN0bW50LmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2Up\nIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgc2VxdWVuY2UgZnJvbSB0aGUgaW5mb3Jt\nYXRpb24gaW4gdGhlIHNjaGVtYSBtZXRhZGF0YS4KICAgICAqLwogICAgcHJv\ndGVjdGVkIFNlcXVlbmNlIG5ld1NlcXVlbmNlKFJlc3VsdFNldCBzZXF1ZW5j\nZU1ldGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAg\nU2VxdWVuY2Ugc2VxID0gbmV3IFNlcXVlbmNlKCk7CiAgICAgICAgc2VxLnNl\ndFNjaGVtYUlkZW50aWZpZXIoZnJvbURCTmFtZShTdHJpbmdVdGlscy5zdHJp\ncEVuZChzZXF1ZW5jZU1ldGEuZ2V0U3RyaW5nKCJTRVFVRU5DRV9TQ0hFTUEi\nKSwgbnVsbCksCiAgICAgICAgICAgIERCSWRlbnRpZmllclR5cGUuU0NIRU1B\nKSk7CiAgICAgICAgc2VxLnNldElkZW50aWZpZXIoZnJvbURCTmFtZShTdHJp\nbmdVdGlscy5zdHJpcEVuZChzZXF1ZW5jZU1ldGEuZ2V0U3RyaW5nKCJTRVFV\nRU5DRV9OQU1FIiksIG51bGwpLAogICAgICAgICAgICBEQklkZW50aWZpZXJU\neXBlLlNFUVVFTkNFKSk7CiAgICAgICAgcmV0dXJuIHNlcTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgU1FMIG5lZWRlZCB0byBzZWxlY3Qg\ndGhlIGxpc3Qgb2Ygc2VxdWVuY2VzLgogICAgICogQGRlcHJlY2F0ZWQKICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRTZXF1ZW5jZXNTUUwoU3Ry\naW5nIHNjaGVtYU5hbWUsIFN0cmluZyBzZXF1ZW5jZU5hbWUpIHsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdl\ndFNlcXVlbmNlc1NRTChEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJZGVu\ndGlmaWVyIHNlcXVlbmNlTmFtZSkgewogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRv\nIGZpbmQgY29sdW1ucyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGFibGUgYW5kCiAg\nICAgKiBjb2x1bW4gcGF0dGVybnMuCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1ucyhEYXRhYmFzZU1l\ndGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBz\nY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBTdHJpbmcgY29sdW1uTmFt\nZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBnZXRDb2x1bW5zKG1ldGEsIERCSWRlbnRp\nZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLAogICAgICAgICAgICBEQklkZW50\naWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLAogICAgICAgICAgICBEQklk\nZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSwKICAgICAgICAgICAgREJJ\nZGVudGlmaWVyLm5ld0NvbHVtbihjb2x1bW5OYW1lKSwKICAgICAgICAgICAg\nY29ubik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gZmluZCBjb2x1bW5zIG1hdGNoaW5nIHRoZSBnaXZlbiB0YWJs\nZSBhbmQKICAgICAqIGNvbHVtbiBwYXR0ZXJucy4KICAgICAqLwogICAgcHVi\nbGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nLCBEQklkZW50aWZpZXIgY2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIg\nc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgREJJZGVudGlm\naWVyIGNvbHVtbk5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoREJJZGVudGlmaWVyLmlz\nTnVsbCh0YWJsZU5hbWUpICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldENv\nbHVtbnMpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIAogICAg\nICAgIFN0cmluZyBzcWxTY2hlbWFOYW1lID0gbnVsbDsKICAgICAgICBpZiAo\nIURCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpIHsKICAgICAgICAg\nICAgc3FsU2NoZW1hTmFtZSA9IHNjaGVtYU5hbWUuZ2V0TmFtZSgpOwogICAg\nICAgIH0KICAgICAgICBpZiAoIXN1cHBvcnRzU2NoZW1hRm9yR2V0Q29sdW1u\ncykKICAgICAgICAgICAgc3FsU2NoZW1hTmFtZSA9IG51bGw7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBzcWxTY2hlbWFOYW1lID0gZ2V0U2NoZW1hTmFt\nZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpOwoKICAgICAgICBiZWZvcmVNZXRh\nZGF0YU9wZXJhdGlvbihjb25uKTsKICAgICAgICBSZXN1bHRTZXQgY29scyA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29scyA9IG1ldGEu\nZ2V0Q29sdW1ucyhnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKGNhdGFsb2cp\nLAogICAgICAgICAgICAgICAgc3FsU2NoZW1hTmFtZSwgZ2V0VGFibGVOYW1l\nRm9yTWV0YWRhdGEodGFibGVOYW1lKSwKICAgICAgICAgICAgICAgIGdldENv\nbHVtbk5hbWVGb3JNZXRhZGF0YShjb2x1bW5OYW1lKSk7CgogICAgICAgICAg\nICBMaXN0IGNvbHVtbkxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAg\nICAgIHdoaWxlIChjb2xzICE9IG51bGwgJiYgY29scy5uZXh0KCkpCiAgICAg\nICAgICAgICAgICBjb2x1bW5MaXN0LmFkZChuZXdDb2x1bW4oY29scykpOwog\nICAgICAgICAgICByZXR1cm4gKENvbHVtbltdKSBjb2x1bW5MaXN0LnRvQXJy\nYXkKICAgICAgICAgICAgICAgIChuZXcgQ29sdW1uW2NvbHVtbkxpc3Quc2l6\nZSgpXSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGNv\nbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgY29scy5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY29sdW1uIGZy\nb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hlbWEgbWV0YWRhdGEuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBDb2x1bW4gbmV3Q29sdW1uKFJlc3VsdFNl\ndCBjb2xNZXRhKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIENvbHVtbiBjID0gbmV3IENvbHVtbigpOwogICAgICAgIGMuc2V0U2No\nZW1hSWRlbnRpZmllcihmcm9tREJOYW1lKGNvbE1ldGEuZ2V0U3RyaW5nKCJU\nQUJMRV9TQ0hFTSIpLCBEQklkZW50aWZpZXJUeXBlLlNDSEVNQSkpOwogICAg\nICAgIGMuc2V0VGFibGVJZGVudGlmaWVyKGZyb21EQk5hbWUoY29sTWV0YS5n\nZXRTdHJpbmcoIlRBQkxFX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5UQUJM\nRSkpOwogICAgICAgIGMuc2V0SWRlbnRpZmllcihmcm9tREJOYW1lKGNvbE1l\ndGEuZ2V0U3RyaW5nKCJDT0xVTU5fTkFNRSIpLCBEQklkZW50aWZpZXJUeXBl\nLkNPTFVNTikpOwogICAgICAgIGMuc2V0VHlwZShjb2xNZXRhLmdldEludCgi\nREFUQV9UWVBFIikpOwogICAgICAgIGMuc2V0VHlwZUlkZW50aWZpZXIoZnJv\nbURCTmFtZShjb2xNZXRhLmdldFN0cmluZygiVFlQRV9OQU1FIiksIERCSWRl\nbnRpZmllclR5cGUuQ09MVU1OX0RFRklOSVRJT04pKTsKICAgICAgICBjLnNl\ndFNpemUoY29sTWV0YS5nZXRJbnQoIkNPTFVNTl9TSVpFIikpOwogICAgICAg\nIGMuc2V0RGVjaW1hbERpZ2l0cyhjb2xNZXRhLmdldEludCgiREVDSU1BTF9E\nSUdJVFMiKSk7CiAgICAgICAgYy5zZXROb3ROdWxsKGNvbE1ldGEuZ2V0SW50\nKCJOVUxMQUJMRSIpCiAgICAgICAgICAgID09IERhdGFiYXNlTWV0YURhdGEu\nY29sdW1uTm9OdWxscyk7CgogICAgICAgIFN0cmluZyBkZWYgPSBjb2xNZXRh\nLmdldFN0cmluZygiQ09MVU1OX0RFRiIpOwogICAgICAgIGlmICghU3RyaW5n\nVXRpbHMuaXNFbXB0eShkZWYpICYmICEibnVsbCIuZXF1YWxzSWdub3JlQ2Fz\nZShkZWYpKQogICAgICAgICAgICBjLnNldERlZmF1bHRTdHJpbmcoZGVmKTsK\nICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxl\nY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhl\nIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKiBAZGVwcmVjYXRlZAogICAg\nICovCiAgICBwdWJsaWMgUHJpbWFyeUtleVtdIGdldFByaW1hcnlLZXlzKERh\ndGFiYXNlTWV0YURhdGEgbWV0YSwKICAgICAgICBTdHJpbmcgY2F0YWxvZywg\nU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rp\nb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gZ2V0UHJpbWFyeUtleXMobWV0YSwgREJJZGVudGlmaWVyLm5l\nd0NhdGFsb2coY2F0YWxvZyksIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2No\nZW1hTmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdUYWJsZSh0\nYWJsZU5hbWUpLCBjb25uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZmxl\nY3Qgb24gdGhlIHNjaGVtYSB0byBmaW5kIHByaW1hcnkga2V5cyBmb3IgdGhl\nIGdpdmVuIHRhYmxlIHBhdHRlcm4uCiAgICAgKi8KICAgIHB1YmxpYyBQcmlt\nYXJ5S2V5W10gZ2V0UHJpbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRh\nLAogICAgICAgIERCSWRlbnRpZmllciBjYXRhbG9nLCBEQklkZW50aWZpZXIg\nc2NoZW1hTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgQ29ubmVjdGlv\nbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAg\nIGlmICh1c2VHZXRCZXN0Um93SWRlbnRpZmllckZvclByaW1hcnlLZXlzKQog\nICAgICAgICAgICByZXR1cm4gZ2V0UHJpbWFyeUtleXNGcm9tQmVzdFJvd0lk\nZW50aWZpZXIobWV0YSwgY2F0YWxvZywKICAgICAgICAgICAgICAgIHNjaGVt\nYU5hbWUsIHRhYmxlTmFtZSwgY29ubik7CiAgICAgICAgcmV0dXJuIGdldFBy\naW1hcnlLZXlzRnJvbUdldFByaW1hcnlLZXlzKG1ldGEsIGNhdGFsb2csCiAg\nICAgICAgICAgIHNjaGVtYU5hbWUsIHRhYmxlTmFtZSwgY29ubik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmlu\nZCBwcmltYXJ5IGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgog\nICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkIFByaW1h\ncnlLZXlbXSBnZXRQcmltYXJ5S2V5c0Zyb21HZXRQcmltYXJ5S2V5cwogICAg\nICAgIChEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLCBT\ndHJpbmcgc2NoZW1hTmFtZSwKICAgICAgICAgICAgU3RyaW5nIHRhYmxlTmFt\nZSwgQ29ubmVjdGlvbiBjb25uKQogICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGdldFByaW1hcnlLZXlzRnJvbUdldFByaW1hcnlL\nZXlzKG1ldGEsIERCSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLAog\nICAgICAgICAgICBEQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUp\nLCBEQklkZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSwgY29ubik7CiAg\nICB9CiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBm\naW5kIHByaW1hcnkga2V5cyBmb3IgdGhlIGdpdmVuIHRhYmxlIHBhdHRlcm4u\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5W10gZ2V0UHJpbWFy\neUtleXNGcm9tR2V0UHJpbWFyeUtleXMKICAgICAgICAoRGF0YWJhc2VNZXRh\nRGF0YSBtZXRhLCBEQklkZW50aWZpZXIgY2F0YWxvZywgREJJZGVudGlmaWVy\nIHNjaGVtYU5hbWUsCiAgICAgICAgICAgIERCSWRlbnRpZmllciB0YWJsZU5h\nbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAodGFibGVOYW1lID09IG51bGwgJiYgIXN1cHBv\ncnRzTnVsbFRhYmxlRm9yR2V0UHJpbWFyeUtleXMpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBiZWZvcmVNZXRhZGF0YU9wZXJhdGlvbihj\nb25uKTsKICAgICAgICBSZXN1bHRTZXQgcGtzID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBwa3MgPSBtZXRhLmdldFByaW1hcnlLZXlzKGdl\ndENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoY2F0YWxvZyksCiAgICAgICAgICAg\nICAgICBnZXRTY2hlbWFOYW1lRm9yTWV0YWRhdGEoc2NoZW1hTmFtZSksCiAg\nICAgICAgICAgICAgICBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YSh0YWJsZU5h\nbWUpKTsKCiAgICAgICAgICAgIExpc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlz\ndCgpOwogICAgICAgICAgICB3aGlsZSAocGtzICE9IG51bGwgJiYgcGtzLm5l\neHQoKSkKICAgICAgICAgICAgICAgIHBrTGlzdC5hZGQobmV3UHJpbWFyeUtl\neShwa3MpKTsKICAgICAgICAgICAgcmV0dXJuIChQcmltYXJ5S2V5W10pIHBr\nTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAobmV3IFByaW1hcnlLZXlb\ncGtMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmIChwa3MgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgcGtzLmNsb3NlKCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBw\ncmltYXJ5IGtleSBmcm9tIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1h\nIG1ldGFkYXRhLgogICAgICovCiAgICBwcm90ZWN0ZWQgUHJpbWFyeUtleSBu\nZXdQcmltYXJ5S2V5KFJlc3VsdFNldCBwa01ldGEpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgUHJpbWFyeUtleSBwayA9IG5ldyBQ\ncmltYXJ5S2V5KCk7CiAgICAgICAgcGsuc2V0U2NoZW1hSWRlbnRpZmllcihm\ncm9tREJOYW1lKHBrTWV0YS5nZXRTdHJpbmcoIlRBQkxFX1NDSEVNIiksIERC\nSWRlbnRpZmllclR5cGUuU0NIRU1BKSk7CiAgICAgICAgcGsuc2V0VGFibGVJ\nZGVudGlmaWVyKGZyb21EQk5hbWUocGtNZXRhLmdldFN0cmluZygiVEFCTEVf\nTkFNRSIpLCBEQklkZW50aWZpZXJUeXBlLlRBQkxFKSk7CiAgICAgICAgcGsu\nc2V0Q29sdW1uSWRlbnRpZmllcihmcm9tREJOYW1lKHBrTWV0YS5nZXRTdHJp\nbmcoIkNPTFVNTl9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuQ09MVU1OKSk7\nCiAgICAgICAgcGsuc2V0SWRlbnRpZmllcihmcm9tREJOYW1lKHBrTWV0YS5n\nZXRTdHJpbmcoIlBLX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5DT05TVFJB\nSU5UKSk7CiAgICAgICAgcmV0dXJuIHBrOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQgcHJpbWFyeSBrZXlz\nIGZvciB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAgICAqIEBkZXByZWNh\ndGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmltYXJ5S2V5W10gZ2V0UHJp\nbWFyeUtleXNGcm9tQmVzdFJvd0lkZW50aWZpZXIKICAgICAgICAoRGF0YWJh\nc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywgU3RyaW5nIHNjaGVt\nYU5hbWUsCiAgICAgICAgICAgIFN0cmluZyB0YWJsZU5hbWUsIENvbm5lY3Rp\nb24gY29ubikgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIGdldFByaW1hcnlLZXlzRnJvbUJlc3RSb3dJZGVudGlmaWVyKG1ldGEsIERC\nSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLAogICAgICAgICAgICBE\nQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLCBEQklkZW50aWZp\nZXIubmV3VGFibGUodGFibGVOYW1lKSwgY29ubik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBzY2hlbWEgdG8gZmluZCBwcmltYXJ5\nIGtleXMgZm9yIHRoZSBnaXZlbiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgUHJpbWFyeUtleVtdIGdldFByaW1hcnlLZXlzRnJvbUJl\nc3RSb3dJZGVudGlmaWVyCiAgICAgICAgKERhdGFiYXNlTWV0YURhdGEgbWV0\nYSwgREJJZGVudGlmaWVyIGNhdGFsb2csIERCSWRlbnRpZmllciBzY2hlbWFO\nYW1lLAogICAgICAgICAgICBEQklkZW50aWZpZXIgdGFibGVOYW1lLCBDb25u\nZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKCiAgICAgICAgYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29u\nbik7CiAgICAgICAgUmVzdWx0U2V0IHBrcyA9IG51bGw7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcGtzID0gbWV0YS5nZXRCZXN0Um93SWRlbnRpZmll\ncih0b0RCTmFtZShjYXRhbG9nKSwgdG9EQk5hbWUoc2NoZW1hTmFtZSksCiAg\nICAgICAgICAgICAgICB0b0RCTmFtZSh0YWJsZU5hbWUpLCAwLCBmYWxzZSk7\nCgogICAgICAgICAgICBMaXN0IHBrTGlzdCA9IG5ldyBBcnJheUxpc3QoKTsK\nICAgICAgICAgICAgd2hpbGUgKHBrcyAhPSBudWxsICYmIHBrcy5uZXh0KCkp\nIHsKICAgICAgICAgICAgICAgIFByaW1hcnlLZXkgcGsgPSBuZXcgUHJpbWFy\neUtleSgpOwogICAgICAgICAgICAgICAgcGsuc2V0U2NoZW1hSWRlbnRpZmll\ncihzY2hlbWFOYW1lKTsKICAgICAgICAgICAgICAgIHBrLnNldFRhYmxlSWRl\nbnRpZmllcih0YWJsZU5hbWUpOwogICAgICAgICAgICAgICAgcGsuc2V0Q29s\ndW1uSWRlbnRpZmllcihmcm9tREJOYW1lKHBrcy5nZXRTdHJpbmcoIkNPTFVN\nTl9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuQ09MVU1OKSk7CiAgICAgICAg\nICAgICAgICBwa0xpc3QuYWRkKHBrKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gKFByaW1hcnlLZXlbXSkgcGtMaXN0LnRvQXJyYXkKICAg\nICAgICAgICAgICAgIChuZXcgUHJpbWFyeUtleVtwa0xpc3Quc2l6ZSgpXSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHBrcyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBwa3MuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIGZpbmQg\naW5kZXhlcyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGFibGUgcGF0dGVybi4KICAg\nICAqIEBkZXByZWNhdGVkCiAgICAgKi8KICAgIHB1YmxpYyBJbmRleFtdIGdl\ndEluZGV4SW5mbyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRh\nbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVO\nYW1lLCBib29sZWFuIHVuaXF1ZSwKICAgICAgICBib29sZWFuIGFwcHJveCwg\nQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBnZXRJbmRleEluZm8obWV0YSwgREJJZGVudGlm\naWVyLm5ld0NhdGFsb2coY2F0YWxvZyksIAogICAgICAgICAgICBEQklkZW50\naWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLCBEQklkZW50aWZpZXIubmV3\nVGFibGUodGFibGVOYW1lKSwgdW5pcXVlLAogICAgICAgICAgICBhcHByb3gs\nIGNvbm4pOwogICAgfQoKICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUg\nc2NoZW1hIHRvIGZpbmQgaW5kZXhlcyBtYXRjaGluZyB0aGUgZ2l2ZW4gdGFi\nbGUgcGF0dGVybi4KICAgICAqLwogICAgcHVibGljIEluZGV4W10gZ2V0SW5k\nZXhJbmZvKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgREJJZGVudGlmaWVyIGNh\ndGFsb2csCiAgICAgICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRl\nbnRpZmllciB0YWJsZU5hbWUsIGJvb2xlYW4gdW5pcXVlLAogICAgICAgIGJv\nb2xlYW4gYXBwcm94LCBDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRhYmxlTmFtZSA9PSBudWxs\nICYmICFzdXBwb3J0c051bGxUYWJsZUZvckdldEluZGV4SW5mbykKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZm9yZU1ldGFkYXRhT3Bl\ncmF0aW9uKGNvbm4pOwogICAgICAgIFJlc3VsdFNldCBpbmRleGVzID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbmRleGVzID0gbWV0YS5n\nZXRJbmRleEluZm8oZ2V0Q2F0YWxvZ05hbWVGb3JNZXRhZGF0YShjYXRhbG9n\nKSwKICAgICAgICAgICAgICAgIGdldFNjaGVtYU5hbWVGb3JNZXRhZGF0YShz\nY2hlbWFOYW1lKSwKICAgICAgICAgICAgICAgIGdldFRhYmxlTmFtZUZvck1l\ndGFkYXRhKHRhYmxlTmFtZSksIHVuaXF1ZSwgYXBwcm94KTsKCiAgICAgICAg\nICAgIExpc3QgaW5kZXhMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAg\nICAgICB3aGlsZSAoaW5kZXhlcyAhPSBudWxsICYmIGluZGV4ZXMubmV4dCgp\nKQogICAgICAgICAgICAgICAgaW5kZXhMaXN0LmFkZChuZXdJbmRleChpbmRl\neGVzKSk7CiAgICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkgaW5kZXhMaXN0\nLnRvQXJyYXkobmV3IEluZGV4W2luZGV4TGlzdC5zaXplKCldKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoaW5kZXhlcyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBp\nbmRleGVzLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpbmRleCBmcm9tIHRoZSBp\nbmZvcm1hdGlvbiBpbiB0aGUgc2NoZW1hIG1ldGFkYXRhLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgSW5kZXggbmV3SW5kZXgoUmVzdWx0U2V0IGlkeE1ldGEp\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgSW5kZXgg\naWR4ID0gbmV3IEluZGV4KCk7CiAgICAgICAgaWR4LnNldFNjaGVtYUlkZW50\naWZpZXIoZnJvbURCTmFtZShpZHhNZXRhLmdldFN0cmluZygiVEFCTEVfU0NI\nRU0iKSwgREJJZGVudGlmaWVyVHlwZS5TQ0hFTUEpKTsKICAgICAgICBpZHgu\nc2V0VGFibGVJZGVudGlmaWVyKGZyb21EQk5hbWUoaWR4TWV0YS5nZXRTdHJp\nbmcoIlRBQkxFX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5UQUJMRSkpOwog\nICAgICAgIGlkeC5zZXRDb2x1bW5JZGVudGlmaWVyKGZyb21EQk5hbWUoaWR4\nTWV0YS5nZXRTdHJpbmcoIkNPTFVNTl9OQU1FIiksIERCSWRlbnRpZmllclR5\ncGUuQ09MVU1OKSk7CiAgICAgICAgaWR4LnNldElkZW50aWZpZXIoZnJvbURC\nTmFtZShpZHhNZXRhLmdldFN0cmluZygiSU5ERVhfTkFNRSIpLCBEQklkZW50\naWZpZXJUeXBlLklOREVYKSk7CiAgICAgICAgaWR4LnNldFVuaXF1ZSghaWR4\nTWV0YS5nZXRCb29sZWFuKCJOT05fVU5JUVVFIikpOwogICAgICAgIHJldHVy\nbiBpZHg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWZsZWN0IG9uIHRoZSBz\nY2hlbWEgdG8gcmV0dXJuIGZvcmVpZ24ga2V5cyBpbXBvcnRlZCBieSB0aGUg\nZ2l2ZW4KICAgICAqIHRhYmxlIHBhdHRlcm4uCiAgICAgKiBAZGVwcmVjYXRl\nZAogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVk\nS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAog\nICAgICAgIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGdldEltcG9ydGVkS2V5cyhtZXRhLCBjYXRhbG9n\nLCBzY2hlbWFOYW1lLCB0YWJsZU5hbWUsIGNvbm4sIHRydWUpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIHJldHVy\nbiBmb3JlaWduIGtleXMgaW1wb3J0ZWQgYnkgdGhlIGdpdmVuCiAgICAgKiB0\nYWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMgRm9yZWlnbktleVtd\nIGdldEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1ldGEsIERCSWRl\nbnRpZmllciBjYXRhbG9nLAogICAgICAgIERCSWRlbnRpZmllciBzY2hlbWFO\nYW1lLCBEQklkZW50aWZpZXIgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4p\nCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIGdldEltcG9ydGVkS2V5cyhtZXRhLCBjYXRhbG9nLCBzY2hlbWFOYW1lLCB0\nYWJsZU5hbWUsIGNvbm4sIHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVmbGVjdCBvbiB0aGUgc2NoZW1hIHRvIHJldHVybiBmdWxsIGZvcmVpZ24g\na2V5cyBpbXBvcnRlZCBieSB0aGUgZ2l2ZW4KICAgICAqIHRhYmxlIHBhdHRl\ncm4uCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgRm9y\nZWlnbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1l\ndGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmluZyBzY2hlbWFOYW1l\nLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9uIGNvbm4sIGJvb2xlYW4g\ncGFydGlhbEtleXMpIAogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBnZXRJbXBvcnRlZEtleXMobWV0YSwgREJJZGVudGlm\naWVyLm5ld0NhdGFsb2coY2F0YWxvZyksIAogICAgICAgICAgICBEQklkZW50\naWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLCBEQklkZW50aWZpZXIubmV3\nVGFibGUodGFibGVOYW1lKSwgY29ubiwgcGFydGlhbEtleXMpOwogICAgfQog\nICAgCiAgICAvKioKICAgICAqIFJlZmxlY3Qgb24gdGhlIHNjaGVtYSB0byBy\nZXR1cm4gZnVsbCBmb3JlaWduIGtleXMgaW1wb3J0ZWQgYnkgdGhlIGdpdmVu\nCiAgICAgKiB0YWJsZSBwYXR0ZXJuLgogICAgICovCiAgICBwdWJsaWMgRm9y\nZWlnbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRhYmFzZU1ldGFEYXRhIG1l\ndGEsIERCSWRlbnRpZmllciBjYXRhbG9nLAogICAgICAgIERCSWRlbnRpZmll\nciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIgdGFibGVOYW1lLCBDb25uZWN0\naW9uIGNvbm4sIGJvb2xlYW4gcGFydGlhbEtleXMpCiAgICAgICAgdGhyb3dz\nIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFzdXBwb3J0c0ZvcmVpZ25L\nZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAodGFi\nbGVOYW1lID09IG51bGwgJiYgIXN1cHBvcnRzTnVsbFRhYmxlRm9yR2V0SW1w\nb3J0ZWRLZXlzKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAg\nYmVmb3JlTWV0YWRhdGFPcGVyYXRpb24oY29ubik7CiAgICAgICAgUmVzdWx0\nU2V0IGtleXMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGtl\neXMgPSBtZXRhLmdldEltcG9ydGVkS2V5cyhnZXRDYXRhbG9nTmFtZUZvck1l\ndGFkYXRhKGNhdGFsb2cpLAogICAgICAgICAgICAgICAgZ2V0U2NoZW1hTmFt\nZUZvck1ldGFkYXRhKHNjaGVtYU5hbWUpLAogICAgICAgICAgICAgICAgZ2V0\nVGFibGVOYW1lRm9yTWV0YWRhdGEodGFibGVOYW1lKSk7CgogICAgICAgICAg\nICBMaXN0PEZvcmVpZ25LZXk+IGltcG9ydGVkS2V5TGlzdCA9IG5ldyBBcnJh\neUxpc3Q8Rm9yZWlnbktleT4oKTsKICAgICAgICAgICAgTWFwPEZLTWFwS2V5\nLCBGb3JlaWduS2V5PiBma01hcCA9IG5ldyBIYXNoTWFwPEZLTWFwS2V5LCBG\nb3JlaWduS2V5PigpOwoKICAgICAgICAgICAgd2hpbGUgKGtleXMgIT0gbnVs\nbCAmJiBrZXlzLm5leHQoKSkgewogICAgICAgICAgICAgICAgRm9yZWlnbktl\neSBuZmsgPSBuZXdGb3JlaWduS2V5KGtleXMpOwogICAgICAgICAgICAgICAg\naWYgKCFwYXJ0aWFsS2V5cykgewogICAgICAgICAgICAgICAgICAgIEZvcmVp\nZ25LZXkgZmsgPSBjb21iaW5lRm9yZWlnbktleShma01hcCwgbmZrKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBJZiB0aGUga2V5IHJldHVybmVkICE9IG5l\ndyBrZXksIGZrIGNvbCB3YXMgY29tYmluZWQKICAgICAgICAgICAgICAgICAg\nICAvLyB3aXRoIGV4aXN0aW5nIGZrLgogICAgICAgICAgICAgICAgICAgIGlm\nIChmayAhPSBuZmspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgaW1wb3J0ZWRLZXlMaXN0LmFkZChuZmspOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoRm9yZWlnbktleVtdKSBp\nbXBvcnRlZEtleUxpc3QudG9BcnJheQogICAgICAgICAgICAgICAgKG5ldyBG\nb3JlaWduS2V5W2ltcG9ydGVkS2V5TGlzdC5zaXplKCldKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoa2V5cyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGtleXMu\nY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CiAgICAKICAgIC8qCiAgICAgKiBDb21iaW5lcyBwYXJ0aWFsIGZv\ncmVpZ24ga2V5cyBpbnRvIHNpbmd1bGFyIGtleQogICAgICovCiAgICBwcm90\nZWN0ZWQgRm9yZWlnbktleSBjb21iaW5lRm9yZWlnbktleShNYXA8RktNYXBL\nZXksIEZvcmVpZ25LZXk+IGZrTWFwLAogICAgICAgIEZvcmVpZ25LZXkgZmsp\nIHsKICAgICAgICAKICAgICAgICBGS01hcEtleSBma21rID0gbmV3IEZLTWFw\nS2V5KGZrKTsKICAgICAgICBGb3JlaWduS2V5IGJhc2VLZXkgPSBma01hcC5n\nZXQoZmttayk7CiAgICAgICAgLy8gRm91bmQgdGhlIEZLLCBhZGQgdGhlIGFk\nZGl0aW9uYWwgY29sdW1uCiAgICAgICAgaWYgKGJhc2VLZXkgIT0gbnVsbCkg\newogICAgICAgICAgICBiYXNlS2V5LmFkZENvbHVtbihmayk7CiAgICAgICAg\nICAgIHJldHVybiBiYXNlS2V5OwogICAgICAgIH0KICAgICAgICAvLyBma2V5\nIGlzIG5ldwogICAgICAgIGZrTWFwLnB1dChma21rLCBmayk7CiAgICAgICAg\ncmV0dXJuIGZrOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3\nIGZvcmVpZ24ga2V5IGZyb20gdGhlIGluZm9ybWF0aW9uIGluIHRoZSBzY2hl\nbWEgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBGb3JlaWduS2V5\nIG5ld0ZvcmVpZ25LZXkoUmVzdWx0U2V0IGZrTWV0YSkKICAgICAgICB0aHJv\nd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBGb3JlaWduS2V5IGZrID0gbmV3\nIEZvcmVpZ25LZXkoKTsKICAgICAgICBmay5zZXRTY2hlbWFJZGVudGlmaWVy\nKGZyb21EQk5hbWUoZmtNZXRhLmdldFN0cmluZygiRktUQUJMRV9TQ0hFTSIp\nLCBEQklkZW50aWZpZXJUeXBlLlNDSEVNQSkpOwogICAgICAgIGZrLnNldFRh\nYmxlSWRlbnRpZmllcihmcm9tREJOYW1lKGZrTWV0YS5nZXRTdHJpbmcoIkZL\nVEFCTEVfTkFNRSIpLCBEQklkZW50aWZpZXJUeXBlLlRBQkxFKSk7CiAgICAg\nICAgZmsuc2V0Q29sdW1uSWRlbnRpZmllcihmcm9tREJOYW1lKGZrTWV0YS5n\nZXRTdHJpbmcoIkZLQ09MVU1OX05BTUUiKSwgREJJZGVudGlmaWVyVHlwZS5D\nT0xVTU4pKTsKICAgICAgICBmay5zZXRJZGVudGlmaWVyKGZyb21EQk5hbWUo\nZmtNZXRhLmdldFN0cmluZygiRktfTkFNRSIpLCBEQklkZW50aWZpZXJUeXBl\nLkZPUkVJR05fS0VZKSk7CiAgICAgICAgZmsuc2V0UHJpbWFyeUtleVNjaGVt\nYUlkZW50aWZpZXIoZnJvbURCTmFtZShma01ldGEuZ2V0U3RyaW5nKCJQS1RB\nQkxFX1NDSEVNIiksIERCSWRlbnRpZmllclR5cGUuU0NIRU1BKSk7CiAgICAg\nICAgZmsuc2V0UHJpbWFyeUtleVRhYmxlSWRlbnRpZmllcihmcm9tREJOYW1l\nKGZrTWV0YS5nZXRTdHJpbmcoIlBLVEFCTEVfTkFNRSIpLCBEQklkZW50aWZp\nZXJUeXBlLlRBQkxFKSk7CiAgICAgICAgZmsuc2V0UHJpbWFyeUtleUNvbHVt\nbklkZW50aWZpZXIoZnJvbURCTmFtZShma01ldGEuZ2V0U3RyaW5nKCJQS0NP\nTFVNTl9OQU1FIiksIERCSWRlbnRpZmllclR5cGUuQ09MVU1OKSk7CiAgICAg\nICAgZmsuc2V0S2V5U2VxdWVuY2UoZmtNZXRhLmdldFNob3J0KCJLRVlfU0VR\nIikpOwogICAgICAgIGZrLnNldERlZmVycmVkKGZrTWV0YS5nZXRTaG9ydCgi\nREVGRVJSQUJJTElUWSIpCiAgICAgICAgICAgID09IERhdGFiYXNlTWV0YURh\ndGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCk7CgogICAgICAgIGlu\ndCBkZWwgPSBma01ldGEuZ2V0U2hvcnQoIkRFTEVURV9SVUxFIik7CiAgICAg\nICAgc3dpdGNoIChkZWwpIHsKICAgICAgICAgICAgY2FzZSBEYXRhYmFzZU1l\ndGFEYXRhLmltcG9ydGVkS2V5U2V0TnVsbDoKICAgICAgICAgICAgICAgIGZr\nLnNldERlbGV0ZUFjdGlvbihGb3JlaWduS2V5LkFDVElPTl9OVUxMKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIERhdGFiYXNl\nTWV0YURhdGEuaW1wb3J0ZWRLZXlTZXREZWZhdWx0OgogICAgICAgICAgICAg\nICAgZmsuc2V0RGVsZXRlQWN0aW9uKEZvcmVpZ25LZXkuQUNUSU9OX0RFRkFV\nTFQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug\nRGF0YWJhc2VNZXRhRGF0YS5pbXBvcnRlZEtleUNhc2NhZGU6CiAgICAgICAg\nICAgICAgICBmay5zZXREZWxldGVBY3Rpb24oRm9yZWlnbktleS5BQ1RJT05f\nQ0FTQ0FERSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgIGZrLnNldERlbGV0ZUFjdGlvbihG\nb3JlaWduS2V5LkFDVElPTl9SRVNUUklDVCk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZrOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0aGUgdGFibGUgbmFtZSB0aGF0IHdpbGwg\nYmUgdXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9t\nIHtAbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIFN0cmluZyBnZXRUYWJsZU5hbWVGb3JNZXRhZGF0YShTdHJpbmcgdGFi\nbGVOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKERC\nSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgdGhlIHRhYmxlIG5hbWUgdGhhdCB3aWxsIGJl\nIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7\nQGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBTdHJpbmcgZ2V0VGFibGVOYW1lRm9yTWV0YWRhdGEoREJJZGVudGlmaWVy\nIHRhYmxlTmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2Fz\nZSh0YWJsZU5hbWUuZ2V0VW5xdWFsaWZpZWROYW1lKCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0aGUgc2NoZW1hIG5hbWUgdGhhdCB3aWxs\nIGJlIHVzZWQgZm9yIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJv\nbSB7QGxpbmsgRGF0YWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBTdHJpbmcgZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKFN0cmluZyBz\nY2hlbWFOYW1lKSB7CiAgICAgICAgaWYgKHNjaGVtYU5hbWUgPT0gbnVsbCkK\nICAgICAgICAgICAgc2NoZW1hTmFtZSA9IGNvbmYuZ2V0U2NoZW1hKCk7CiAg\nICAgICAgcmV0dXJuIGNvbnZlcnRTY2hlbWFDYXNlKERCSWRlbnRpZmllci5u\nZXdTY2hlbWEoc2NoZW1hTmFtZSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJucyB0aGUgc2NoZW1hIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgZm9y\nIG9idGFpbmluZyBpbmZvcm1hdGlvbgogICAgICogZnJvbSB7QGxpbmsgRGF0\nYWJhc2VNZXRhRGF0YX0uCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcg\nZ2V0U2NoZW1hTmFtZUZvck1ldGFkYXRhKERCSWRlbnRpZmllciBzY2hlbWFO\nYW1lKSB7CiAgICAgICAgaWYgKERCSWRlbnRpZmllci5pc051bGwoc2NoZW1h\nTmFtZSkpCiAgICAgICAgICAgIHNjaGVtYU5hbWUgPSBEQklkZW50aWZpZXIu\nbmV3U2NoZW1hKGNvbmYuZ2V0U2NoZW1hKCkpOwogICAgICAgIHJldHVybiBj\nb252ZXJ0U2NoZW1hQ2FzZShzY2hlbWFOYW1lKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIGNhdGFsb2cgbmFtZSB0aGF0IHdpbGwgYmUg\ndXNlZCBmb3Igb2J0YWluaW5nIGluZm9ybWF0aW9uCiAgICAgKiBmcm9tIHtA\nbGluayBEYXRhYmFzZU1ldGFEYXRhfS4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFN0cmluZyBnZXRDYXRhbG9nTmFtZUZvck1ldGFkYXRhKFN0cmluZyBjYXRh\nbG9nTmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZShE\nQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRhbG9nTmFtZSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgY2F0YWxvZyBuYW1lIHRoYXQg\nd2lsbCBiZSB1c2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAq\nIGZyb20ge0BsaW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU3RyaW5nIGdldENhdGFsb2dOYW1lRm9yTWV0YWRhdGEoREJJ\nZGVudGlmaWVyIGNhdGFsb2dOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZl\ncnRTY2hlbWFDYXNlKGNhdGFsb2dOYW1lKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIGNvbHVtbiBuYW1lIHRoYXQgd2lsbCBiZSB1c2Vk\nIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0BsaW5r\nIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQgU3Ry\naW5nIGdldENvbHVtbk5hbWVGb3JNZXRhZGF0YShTdHJpbmcgY29sdW1uTmFt\nZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2FzZShEQklkZW50\naWZpZXIubmV3Q29sdW1uKGNvbHVtbk5hbWUpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybnMgdGhlIGNvbHVtbiBuYW1lIHRoYXQgd2lsbCBiZSB1\nc2VkIGZvciBvYnRhaW5pbmcgaW5mb3JtYXRpb24KICAgICAqIGZyb20ge0Bs\naW5rIERhdGFiYXNlTWV0YURhdGF9LgogICAgICovCiAgICBwcm90ZWN0ZWQg\nU3RyaW5nIGdldENvbHVtbk5hbWVGb3JNZXRhZGF0YShEQklkZW50aWZpZXIg\nY29sdW1uTmFtZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0U2NoZW1hQ2Fz\nZShjb2x1bW5OYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQg\ndGhlIHNwZWNpZmllZCBzY2hlbWEgbmFtZSB0byBhIG5hbWUgdGhhdCB0aGUg\nZGF0YWJhc2Ugd2lsbAogICAgICogYmUgYWJsZSB0byB1bmRlcnN0YW5kLgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGNvbnZlcnRTY2hlbWFDYXNlKFN0\ncmluZyBvYmplY3ROYW1lKSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRTY2hl\nbWFDYXNlKERCSWRlbnRpZmllci5uZXdJZGVudGlmaWVyKG9iamVjdE5hbWUs\nIERCSWRlbnRpZmllclR5cGUuREVGQVVMVCwgZmFsc2UpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIENvbnZlcnQgdGhlIHNwZWNpZmllZCBzY2hlbWEgbmFt\nZSB0byBhIG5hbWUgdGhhdCB0aGUgZGF0YWJhc2Ugd2lsbAogICAgICogYmUg\nYWJsZSB0byB1bmRlcnN0YW5kLgogICAgICovCiAgICBwdWJsaWMgU3RyaW5n\nIGNvbnZlcnRTY2hlbWFDYXNlKERCSWRlbnRpZmllciBvYmplY3ROYW1lKSB7\nCiAgICAgICAgcmV0dXJuIHRvREJOYW1lKG5hbWluZ1V0aWwuY29udmVydFNj\naGVtYUNhc2Uob2JqZWN0TmFtZSksIGZhbHNlKTsKICAgIH0KICAgIAogICAg\nLyoqCiAgICAgKiBSZXR1cm4gREIgc3BlY2lmaWMgc2NoZW1hQ2FzZSAKICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTY2hlbWFDYXNlKCl7CiAgICAg\nICAgcmV0dXJuIHNjaGVtYUNhc2U7CiAgICB9CiAgICAgICAgCiAgICAvKioK\nICAgICAqIFByZXBhcmVkIHRoZSBjb25uZWN0aW9uIGZvciBtZXRhZGF0YSBv\ncGVyYXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVmb3JlTWV0\nYWRhdGFPcGVyYXRpb24oQ29ubmVjdGlvbiBjKSB7CiAgICAgICAgaWYgKHJl\ncXVpcmVzQXV0b0NvbW1pdEZvck1ldGFEYXRhKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBjLnJvbGxiYWNrKCk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzcWxlKSB7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghYy5nZXRB\ndXRvQ29tbWl0KCkpCiAgICAgICAgICAgICAgICAgICAgYy5zZXRBdXRvQ29t\nbWl0KHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc3FsZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZXF1ZW5jZXMg\nYW5kIEF1dG8tQXNzaWduCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBsYXN0IGdlbmVyYXRl\nZCB2YWx1ZSBmb3IgdGhlIGdpdmVuIGNvbHVtbi4KICAgICAqIFRocm93cyBh\nbiBleGNlcHRpb24gYnkgZGVmYXVsdCBpZiB7QGxpbmsgI2xhc3RHZW5lcmF0\nZWRLZXlRdWVyeX0gaXMgbnVsbC4KICAgICAqLwogICAgcHVibGljIE9iamVj\ndCBnZXRHZW5lcmF0ZWRLZXkoQ29sdW1uIGNvbCwgQ29ubmVjdGlvbiBjb25u\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChs\nYXN0R2VuZXJhdGVkS2V5UXVlcnkgPT0gbnVsbCkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1hdXRvLWFzc2ln\nbiIpKTsKCiAgICAgICAgLy8gcmVwbGFjZSB0aGluZ3MgbGlrZSAiU0VMRUNU\nIE1BWCh7MH0pIEZST00gezF9IgogICAgICAgIFN0cmluZyBxdWVyeSA9IGxh\nc3RHZW5lcmF0ZWRLZXlRdWVyeTsKICAgICAgICBpZiAocXVlcnkuaW5kZXhP\nZigneycpICE9IC0xKSAvLyBvbmx5IGlmIHRoZSB0b2tlbiBpcyBpbiB0aGUg\nc3RyaW5nCiAgICAgICAgewogICAgICAgICAgICBxdWVyeSA9IE1lc3NhZ2VG\nb3JtYXQuZm9ybWF0KHF1ZXJ5LCBuZXcgT2JqZWN0W117CiAgICAgICAgICAg\nICAgICB0b0RCTmFtZShjb2wuZ2V0SWRlbnRpZmllcigpKSwgZ2V0RnVsbE5h\nbWUoY29sLmdldFRhYmxlKCksIGZhbHNlKSwKICAgICAgICAgICAgICAgIGdl\ndEdlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2wpLAogICAgICAgICAgICB9\nKTsKICAgICAgICB9CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50\nID0gcHJlcGFyZVN0YXRlbWVudChjb25uLCBxdWVyeSk7CiAgICAgICAgUmVz\ndWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBz\nZXRRdWVyeVRpbWVvdXQoc3RtbnQsIGNvbmYuZ2V0UXVlcnlUaW1lb3V0KCkp\nOwogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBzdG1udCwg\ncXVlcnkpOwogICAgICAgICAgICByZXR1cm4gZ2V0S2V5KHJzLCBjb2wpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxs\nKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICBpZiAoc3RtbnQgIT0g\nbnVsbCkgICAgCiAgICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgp\nOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9IAogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgc2VxdWVuY2UgbmFtZSB1\nc2VkIGJ5IGRhdGFiYXNlcyBmb3IgdGhlIGdpdmVuIGF1dG9hc3NpZ25lZAog\nICAgICogY29sdW1uLiBUaGlzIGlzIG9ubHkgdXNlZCBieSBkYXRhYmFzZXMg\ndGhhdCByZXF1aXJlIGFuIGV4cGxpY2l0IG5hbWUKICAgICAqIHRvIGJlIHVz\nZWQgZm9yIGF1dG8tYXNzaWduIHN1cHBvcnQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBTdHJpbmcgZ2V0R2VuZXJhdGVkS2V5U2VxdWVuY2VOYW1lKENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gdG9EQk5hbWUobmFtaW5nVXRpbC5n\nZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sLCBtYXhBdXRvQXNzaWdu\nTmFtZUxlbmd0aCkpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIENvbmZpZ3VyYWJsZSBpbXBsZW1lbnRhdGlv\nbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1\nYmxpYyB2b2lkIHNldENvbmZpZ3VyYXRpb24oQ29uZmlndXJhdGlvbiBjb25m\nKSB7CiAgICAgICAgdGhpcy5jb25mID0gKEpEQkNDb25maWd1cmF0aW9uKSBj\nb25mOwogICAgICAgIHRoaXMubG9nID0gdGhpcy5jb25mLmdldExvZyhKREJD\nQ29uZmlndXJhdGlvbi5MT0dfSkRCQyk7CgogICAgICAgIC8vIENyZWF0ZSB0\naGUgbmFtaW5nIHV0aWxpdHkKICAgICAgICBuYW1pbmdVdGlsID0gdGhpcy5j\nb25mLmdldElkZW50aWZpZXJVdGlsSW5zdGFuY2UoKTsKICAgICAgICBuYW1p\nbmdVdGlsLnNldElkZW50aWZpZXJDb25maWd1cmF0aW9uKHRoaXMpOwogICAg\nICAgIGNvbmZpZ3VyZU5hbWluZ1J1bGVzKCk7CgogICAgICAgIC8vIHdhcm4g\nYWJvdXQgdW5zdXBwb3J0ZWQgZGljdHMKICAgICAgICBpZiAobG9nLmlzV2Fy\nbkVuYWJsZWQoKSAmJiAhaXNTdXBwb3J0ZWQoKSkKICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoImRpY3Qtbm90LXN1cHBvcnRlZCIsIGdldENsYXNz\nKCkpKTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaXNTdXBwb3J0ZWQo\nKSB7CiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGN1c3RvbSBkaWN0LCB0cmF2\nZXJzZSB0byB3aGF0ZXZlciBvcGVuanBhIGRpY3QgaXQKICAgICAgICAvLyBl\neHRlbmRzCiAgICAgICAgQ2xhc3MgYyA9IGdldENsYXNzKCk7CiAgICAgICAg\nd2hpbGUgKCFjLmdldE5hbWUoKS5zdGFydHNXaXRoKCJvcmcuYXBhY2hlLm9w\nZW5qcGEuIikpCiAgICAgICAgICAgIGMgPSBjLmdldFN1cGVyY2xhc3MoKTsK\nCiAgICAgICAgLy8gdGhlIGdlbmVyaWMgZGJkaWN0aW9uYXJ5IGlzIG5vdCBj\nb25zaWRlcmVkIGEgc3VwcG9ydGVkIGRpY3Q7IGFsbAogICAgICAgIC8vIG90\naGVyIGNvbmNyZXRlIGRpY3Rpb25hcmllcyBhcmUKICAgICAgICBpZiAoYyA9\nPSBEQkRpY3Rpb25hcnkuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzdGFydENvbmZpZ3VyYXRpb24oKSB7CiAgICB9CgogICAgcHVibGljIHZv\naWQgZW5kQ29uZmlndXJhdGlvbigpIHsKICAgICAgICAvLyBpbml0aWFsaXpl\nIHRoZSBzZXQgb2YgcmVzZXJ2ZWQgU1FMOTIgd29yZHMgZnJvbSByZXNvdXJj\nZQogICAgICAgIElucHV0U3RyZWFtIGluID0gREJEaWN0aW9uYXJ5LmNsYXNz\nLmdldFJlc291cmNlQXNTdHJlYW0KICAgICAgICAgICAgKCJzcWwta2V5d29y\nZHMucnNyYyIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0cmluZyBr\nZXl3b3JkcyA9IG5ldyBCdWZmZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1S\nZWFkZXIoaW4pKS4KICAgICAgICAgICAgICAgIHJlYWRMaW5lKCk7CiAgICAg\nICAgICAgIGluLmNsb3NlKCk7CiAgICAgICAgICAgIHJlc2VydmVkV29yZFNl\ndC5hZGRBbGwoQXJyYXlzLmFzTGlzdChTdHJpbmdzLnNwbGl0CiAgICAgICAg\nICAgICAgICAoa2V5d29yZHMsICIsIiwgMCkpKTsKICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdl\nbmVyYWxFeGNlcHRpb24oaW9lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB0cnkgeyBpbi5jbG9zZSgpOyB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBlKSB7fQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIGFkZGl0aW9uYWwg\ncmVzZXJ2ZWQgd29yZHMgc2V0IGJ5IHVzZXIKICAgICAgICBpZiAocmVzZXJ2\nZWRXb3JkcyAhPSBudWxsKQogICAgICAgICAgICByZXNlcnZlZFdvcmRTZXQu\nYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAg\nICAgICAgKHJlc2VydmVkV29yZHMudG9VcHBlckNhc2UoKSwgIiwiLCAwKSkp\nOwoKICAgICAgICAvLyBhZGQgc3lzdGVtIHNjaGVtYXMgc2V0IGJ5IHVzZXIK\nICAgICAgICBpZiAoc3lzdGVtU2NoZW1hcyAhPSBudWxsKQogICAgICAgICAg\nICBzeXN0ZW1TY2hlbWFTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5n\ncy5zcGxpdAogICAgICAgICAgICAgICAgKHN5c3RlbVNjaGVtYXMudG9VcHBl\nckNhc2UoKSwgIiwiLCAwKSkpOwoKICAgICAgICAvLyBhZGQgc3lzdGVtIHRh\nYmxlcyBzZXQgYnkgdXNlcgogICAgICAgIGlmIChzeXN0ZW1UYWJsZXMgIT0g\nbnVsbCkKICAgICAgICAgICAgc3lzdGVtVGFibGVTZXQuYWRkQWxsKEFycmF5\ncy5hc0xpc3QoU3RyaW5ncy5zcGxpdAogICAgICAgICAgICAgICAgKHN5c3Rl\nbVRhYmxlcy50b1VwcGVyQ2FzZSgpLCAiLCIsIDApKSk7CgogICAgICAgIC8v\nIGFkZCBmaXhlZCBzaXplIHR5cGUgbmFtZXMgc2V0IGJ5IHRoZSB1c2VyCiAg\nICAgICAgaWYgKGZpeGVkU2l6ZVR5cGVOYW1lcyAhPSBudWxsKQogICAgICAg\nICAgICBmaXhlZFNpemVUeXBlTmFtZVNldC5hZGRBbGwoQXJyYXlzLmFzTGlz\ndChTdHJpbmdzLnNwbGl0CiAgICAgICAgICAgICAgICAoZml4ZWRTaXplVHlw\nZU5hbWVzLnRvVXBwZXJDYXNlKCksICIsIiwgMCkpKTsKICAgICAgICAKICAg\nICAgICAvLyBpZiB1c2VyIGhhcyB1bnNldCBzZXF1ZW5jZSBzcWwsIG51bGwg\naXQgb3V0IHNvIHdlIGtub3cgc2VxdWVuY2VzCiAgICAgICAgLy8gYXJlbid0\nIHN1cHBvcnRlZAogICAgICAgIG5leHRTZXF1ZW5jZVF1ZXJ5ID0gU3RyaW5n\nVXRpbHMudHJpbVRvTnVsbChuZXh0U2VxdWVuY2VRdWVyeSk7CiAgICAgICAg\nCiAgICAgICAgaWYgKHNlbGVjdFdvcmRzICE9IG51bGwpCiAgICAgICAgICAg\nIHNlbGVjdFdvcmRTZXQuYWRkQWxsKEFycmF5cy5hc0xpc3QoU3RyaW5ncy5z\ncGxpdChzZWxlY3RXb3JkcwogICAgICAgICAgICAgICAgICAgIC50b1VwcGVy\nQ2FzZSgpLCAiLCIsIDApKSk7CiAgICAgICAgCiAgICAgICAgLy8gaW5pdGlh\nbGl6ZSB0aGUgZXJyb3IgY29kZXMKICAgICAgICBTUUxFcnJvckNvZGVSZWFk\nZXIgY29kZVJlYWRlciA9IG5ldyBTUUxFcnJvckNvZGVSZWFkZXIoKTsKICAg\nICAgICBTdHJpbmcgcnNyYyA9ICJzcWwtZXJyb3Itc3RhdGUtY29kZXMueG1s\nIjsKICAgICAgICBJbnB1dFN0cmVhbSBzdHJlYW0gPSBnZXRDbGFzcygpLmdl\ndFJlc291cmNlQXNTdHJlYW0ocnNyYyk7CiAgICAgICAgU3RyaW5nIGRpY3Rp\nb25hcnlDbGFzc05hbWUgPSBnZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAg\nICBpZiAoc3RyZWFtID09IG51bGwpIHsgLy8gVXNlciBzdXBwbGllZCBkaWN0\naW9uYXJ5IGJ1dCBubyBlcnJvciBjb2RlcyB4bWwKICAgICAgICAgICAgLy8g\ndXNlIGRlZmF1bHQKICAgICAgICAgICAgc3RyZWFtID0gREJEaWN0aW9uYXJ5\nLmNsYXNzLmdldFJlc291cmNlQXNTdHJlYW0ocnNyYyk7CiAgICAgICAgICAg\nIGRpY3Rpb25hcnlDbGFzc05hbWUgPSBnZXRDbGFzcygpLmdldFN1cGVyY2xh\nc3MoKS5nZXROYW1lKCk7CiAgICAgICAgfQogICAgICAgIGNvZGVSZWFkZXIu\ncGFyc2Uoc3RyZWFtLCBkaWN0aW9uYXJ5Q2xhc3NOYW1lLCB0aGlzKTsKICAg\nIH0KICAgIAogICAgcHVibGljIHZvaWQgYWRkRXJyb3JDb2RlKGludCBlcnJv\nclR5cGUsIFN0cmluZyBlcnJvckNvZGUpIHsKICAgICAgICBpZiAoZXJyb3JD\nb2RlID09IG51bGwgfHwgZXJyb3JDb2RlLnRyaW0oKS5sZW5ndGgoKSA9PSAw\nKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgU2V0PFN0cmluZz4gY29k\nZXMgPSBzcWxTdGF0ZUNvZGVzLmdldChlcnJvclR5cGUpOwogICAgICAgIGlm\nIChjb2RlcyA9PSBudWxsKSB7CiAgICAgICAgICAgIGNvZGVzID0gbmV3IEhh\nc2hTZXQ8U3RyaW5nPigpOwogICAgICAgICAgICBjb2Rlcy5hZGQoZXJyb3JD\nb2RlLnRyaW0oKSk7CiAgICAgICAgICAgIHNxbFN0YXRlQ29kZXMucHV0KGVy\ncm9yVHlwZSwgY29kZXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGNvZGVzLmFkZChlcnJvckNvZGUudHJpbSgpKTsKICAgICAgICB9CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogRklYTUUgLSBPUEVOSlBBLTk1NyAtIGxv\nY2tUaW1lb3V0IGlzIGEgc2VydmVyLXNpZGUgZnVuY3Rpb24gYW5kCiAgICAg\nKiBzaG91bGRuJ3QgYmUgdXNpbmcgY2xpZW50LXNpZGUgc2V0UXVlcnlUaW1l\nb3V0IGZvciBsb2NrIHRpbWVvdXRzLgogICAgICogCiAgICAgKiBUaGlzIG1l\ndGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBK\nREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBvZiBzZXR0aW5nIHF1\nZXJ5IGFuZCBsb2NrIHRpbWVvdXRzLgogICAgICogCiAgICAgKiBAcGFyYW0g\nc3RtbnQKICAgICAqIEBwYXJhbSBmZXRjaCAtIG9wdGlvbmFsIGxvY2sgYW5k\nIHF1ZXJ5IHRpbWVvdXRzIGluIG1pbGxpc2Vjb25kcwogICAgICogQHBhcmFt\nIGZvclVwZGF0ZSAtIHRydWUgaWYgd2Ugc2hvdWxkIGFsc28gdHJ5IHNldHRp\nbmcgYSBsb2NrIHRpbWVvdXQKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0aW9u\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRpbWVvdXRzKFByZXBhcmVk\nU3RhdGVtZW50IHN0bW50LCAKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0\naW9uIGZldGNoLCBib29sZWFuIGZvclVwZGF0ZSkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHN1cHBvcnRzUXVlcnlUaW1lb3V0KSB7CiAg\nICAgICAgICAgIGludCB0aW1lb3V0ID0gZmV0Y2guZ2V0UXVlcnlUaW1lb3V0\nKCk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUpIHsKICAgICAgICAgICAg\nICAgIC8vIGlmIHRoaXMgaXMgYSBsb2NraW5nIHNlbGVjdCBhbmQgdGhlIGxv\nY2sgdGltZW91dCBpcyBncmVhdGVyIAogICAgICAgICAgICAgICAgLy8gdGhh\nbiB0aGUgY29uZmlndXJlZCBxdWVyeSB0aW1lb3V0LCB1c2UgdGhlIGxvY2sg\ndGltZW91dAogICAgICAgICAgICAgICAgdGltZW91dCA9IE1hdGgubWF4KGZl\ndGNoLmdldFF1ZXJ5VGltZW91dCgpLCAKICAgICAgICAgICAgICAgICAgICBm\nZXRjaC5nZXRMb2NrVGltZW91dCgpKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBzZXRRdWVyeVRpbWVvdXQoc3RtbnQsIHRpbWVvdXQpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZJWE1FIC0gT1BFTkpQQS05NTcg\nLSBsb2NrVGltZW91dCBpcyBhIHNlcnZlci1zaWRlIGZ1bmN0aW9uIGFuZAog\nICAgICogc2hvdWxkbid0IGJlIHVzaW5nIGNsaWVudC1zaWRlIHNldFF1ZXJ5\nVGltZW91dCBmb3IgbG9jayB0aW1lb3V0cy4KICAgICAqIAogICAgICogVGhp\ncyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9uLUpEQkMg\nb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2Ygc2V0dGlu\nZyBxdWVyeSBhbmQgbG9jayB0aW1lb3V0cy4KICAgICAqIAogICAgICogQHBh\ncmFtIHN0bW50CiAgICAgKiBAcGFyYW0gY29uZiAtIG9wdGlvbmFsIGxvY2sg\nYW5kIHF1ZXJ5IHRpbWVvdXRzIGluIG1pbGxpc2Vjb25kcwogICAgICogQHBh\ncmFtIGZvclVwZGF0ZSAtIHRydWUgaWYgd2Ugc2hvdWxkIGFsc28gdHJ5IHNl\ndHRpbmcgYSBsb2NrIHRpbWVvdXQKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0\naW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldFRpbWVvdXRzKFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50LCBKREJDQ29uZmlndXJhdGlvbiBjb25mLAog\nICAgICAgIGJvb2xlYW4gZm9yVXBkYXRlKSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoc3VwcG9ydHNRdWVyeVRpbWVvdXQpIHsKICAgICAg\nICAgICAgaW50IHRpbWVvdXQgPSBjb25mLmdldFF1ZXJ5VGltZW91dCgpOwog\nICAgICAgICAgICBpZiAoZm9yVXBkYXRlKSB7CiAgICAgICAgICAgICAgICAv\nLyBpZiB0aGlzIGlzIGEgbG9ja2luZyBzZWxlY3QgYW5kIHRoZSBsb2NrIHRp\nbWVvdXQgaXMgZ3JlYXRlcgogICAgICAgICAgICAgICAgLy8gdGhhbiB0aGUg\nY29uZmlndXJlZCBxdWVyeSB0aW1lb3V0LCB1c2UgdGhlIGxvY2sgdGltZW91\ndAogICAgICAgICAgICAgICAgdGltZW91dCA9IE1hdGgubWF4KGNvbmYuZ2V0\nUXVlcnlUaW1lb3V0KCksIAogICAgICAgICAgICAgICAgICAgIGNvbmYuZ2V0\nTG9ja1RpbWVvdXQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0\nUXVlcnlUaW1lb3V0KHN0bW50LCB0aW1lb3V0KTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBQcm92aWRlcyB0aGUgZGVmYXVsdCB2YWxpZGF0\naW9uIGhhbmRsaW5nIG9mIHNldHRpbmcgYSBxdWVyeSB0aW1lb3V0LgogICAg\nICogQHBhcmFtIHN0bW50CiAgICAgKiBAcGFyYW0gdGltZW91dCBpbiBtaWxs\naXNlY29uZHMKICAgICAqIEB0aHJvd3MgU1FMRXhjZXB0aW9uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFF1ZXJ5VGltZW91dChQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCwgaW50IHRpbWVvdXQpCiAgICAgICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKHN1cHBvcnRzUXVlcnlUaW1lb3V0KSB7\nCiAgICAgICAgICAgIGlmICh0aW1lb3V0ID09IC0xKSB7CiAgICAgICAgICAg\nICAgICAvLyBzcGVjaWFsIE9wZW5KUEEgYWxsb3dlZCBjYXNlIGRlbm90aW5n\nIG5vIHRpbWVvdXQKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSAwOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKHRpbWVvdXQgPCAwKSB7CiAgICAgICAgICAg\nICAgICBpZiAobG9nLmlzV2FybkVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgiaW52YWxpZC10aW1lb3V0IiwgbmV3\nIEludGVnZXIodGltZW91dCkpKTsKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgfSBlbHNlIGlmICh0aW1lb3V0ID4gMCAmJiB0aW1lb3V0\nIDwgMTAwMCkgewogICAgICAgICAgICAgICAgLy8gcm91bmQgdXAgdG8gMSBz\nZWMKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSAxMDAwOyAKICAgICAgICAg\nICAgICAgIGlmIChsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJtaWxsaXMtcXVlcnktdGltZW91\ndCIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRTdGF0ZW1lbnRR\ndWVyeVRpbWVvdXQoc3RtbnQsIHRpbWVvdXQpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFsbG93IHN1YmNsYXNzZXMgdG8gcHJvdmlkZSBE\nQiB1bmlxdWUgb3ZlcnJpZGUgaW1wbGVtZW50YXRpb25zIG9mCiAgICAgKiBz\nZXR0aW5nIHF1ZXJ5IHRpbWVvdXRzLCB3aGlsZSBwcmVzZXJ2aW5nIHRoZSBk\nZWZhdWx0IHRpbWVvdXQgbG9naWMKICAgICAqIGluIHRoZSBwdWJsaWMgc2V0\nUXVlcnlUaW1lb3V0IG1ldGhvZC4KICAgICAqIEBwYXJhbSBzdG1udAogICAg\nICogQHBhcmFtIHRpbWVvdXQgaW4gbWlsbGlzZWNvbmRzCiAgICAgKiBAdGhy\nb3dzIFNRTEV4Y2VwdGlvbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBz\nZXRTdGF0ZW1lbnRRdWVyeVRpbWVvdXQoUHJlcGFyZWRTdGF0ZW1lbnQgc3Rt\nbnQsIAogICAgICAgIGludCB0aW1lb3V0KSB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICAvLyBKREJDIHVzZXMgc2Vjb25kcywgc28gd2UnbGwgZG8g\nYSBzaW1wbGUgcm91bmQtZG93biBjb252ZXJzaW9uIGhlcmUKICAgICAgICBz\ndG1udC5zZXRRdWVyeVRpbWVvdXQodGltZW91dCAvIDEwMDApOwogICAgfQoK\nICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBDb25uZWN0aW9uRGVjb3JhdG9yIGltcGxlbWVudGF0aW9uCiAgICAv\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8q\nKgogICAgICogRGVjb3JhdGUgdGhlIGdpdmVuIGNvbm5lY3Rpb24gaWYgbmVl\nZGVkLiBTb21lIGRhdGFiYXNlcyByZXF1aXJlIHNwZWNpYWwKICAgICAqIGhh\nbmRsaW5nIGZvciBKREJDIGJ1Z3MuIFRoaXMgaW1wbGVtZW50YXRpb24gaXNz\ndWVzIGFueQogICAgICoge0BsaW5rICNpbml0aWFsaXphdGlvblNRTH0gdGhh\ndCBoYXMgYmVlbiBzZXQgZm9yIHRoZSBkaWN0aW9uYXJ5IGJ1dAogICAgICog\nZG9lcyBub3QgZGVjb3JhdGUgdGhlIGNvbm5lY3Rpb24uCiAgICAgKi8KICAg\nIHB1YmxpYyBDb25uZWN0aW9uIGRlY29yYXRlKENvbm5lY3Rpb24gY29ubikK\nICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWNv\nbm5lY3RlZCkKICAgICAgICAgICAgY29ubmVjdGVkQ29uZmlndXJhdGlvbihj\nb25uKTsKICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoaW5pdGlh\nbGl6YXRpb25TUUwpKSB7CiAgICAgICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50ID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KGluaXRpYWxpemF0\naW9uU1FMKTsKICAgICAgICAgICAgICAgIHN0bW50LmV4ZWN1dGUoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nICAgICBsb2cudHJhY2UoZS50b1N0cmluZygpLCBlKTsKICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb25u\nOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50YXRpb24gb2YgdGhl\nCiAgICAgKiB7QGxpbmsgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNvcmF0b3IuU1FM\nV2FybmluZ0hhbmRsZXJ9IGludGVyZmFjZQogICAgICogdGhhdCBhbGxvd3Mg\nY3VzdG9taXphdGlvbiBvZiB0aGUgYWN0aW9ucyB0byBwZXJmb3JtIHdoZW4g\nYQogICAgICoge0BsaW5rIFNRTFdhcm5pbmd9IG9jY3VycyBhdCBhbnkgcG9p\nbnQgb24gYSB7QGxpbmsgQ29ubmVjdGlvbn0sCiAgICAgKiB7QGxpbmsgU3Rh\ndGVtZW50fSwgb3Ige0BsaW5rIFJlc3VsdFNldH0uIFRoaXMgbWV0aG9kIG1h\neQogICAgICogYmUgdXNlZCBkZXRlcm1pbmUgdGhvc2Ugd2FybmluZ3MgdGhl\nIGFwcGxpY2F0aW9uIHdhbnRzIHRvCiAgICAgKiBjb25zaWRlciBjcml0aWNh\nbCBmYWlsdXJlcywgYW5kIHRocm93IHRoZSB3YXJuaW5nIGluIHRob3NlCiAg\nICAgKiBjYXNlcy4gQnkgZGVmYXVsdCwgdGhpcyBtZXRob2QgZG9lcyBub3Ro\naW5nLgogICAgICoKICAgICAqIEBzZWUgTG9nZ2luZ0Nvbm5lY3Rpb25EZWNv\ncmF0b3Ijc2V0V2FybmluZ0FjdGlvbgogICAgICogQHNlZSBMb2dnaW5nQ29u\nbmVjdGlvbkRlY29yYXRvciNzZXRXYXJuaW5nSGFuZGxlcgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBoYW5kbGVXYXJuaW5nKFNRTFdhcm5pbmcgd2Fybmlu\nZykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiBhIG5ldyBleGNlcHRpb24gdGhhdCB3cmFwcyA8\nY29kZT5jYXVzZXM8L2NvZGU+LgogICAgICogSG93ZXZlciwgdGhlIGRldGFp\nbHMgb2YgZXhhY3RseSB3aGF0IHR5cGUgb2YgZXhjZXB0aW9uIGlzIHJldHVy\nbmVkIGNhbgogICAgICogYmUgZGV0ZXJtaW5lZCBieSB0aGUgaW1wbGVtZW50\nYXRpb24uIFRoaXMgbWF5IHRha2UgaW50byBhY2NvdW50CiAgICAgKiBEQi1z\ncGVjaWZpYyBleGNlcHRpb24gaW5mb3JtYXRpb24gaW4gPGNvZGU+Y2F1c2Vz\nPC9jb2RlPi4KICAgICAqLwogICAgcHVibGljIE9wZW5KUEFFeGNlcHRpb24g\nbmV3U3RvcmVFeGNlcHRpb24oU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uW10g\nY2F1c2VzLCBPYmplY3QgZmFpbGVkKSB7CiAgICAgICAgaWYgKGNhdXNlcyAh\nPSBudWxsICYmIGNhdXNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIE9w\nZW5KUEFFeGNlcHRpb24gcmV0ID0gbmFycm93KG1zZywgY2F1c2VzWzBdLCBm\nYWlsZWQpOwogICAgICAgICAgICByZXQuc2V0RmFpbGVkT2JqZWN0KGZhaWxl\nZCkuc2V0TmVzdGVkVGhyb3dhYmxlcyhjYXVzZXMpOwogICAgICAgICAgICBy\nZXR1cm4gcmV0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFN0b3Jl\nRXhjZXB0aW9uKG1zZykuc2V0RmFpbGVkT2JqZWN0KGZhaWxlZCkuCiAgICAg\nICAgICAgIHNldE5lc3RlZFRocm93YWJsZXMoY2F1c2VzKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBjYXRlZ29yeSBvZiBTdG9yZUV4\nY2VwdGlvbiBieSBtYXRjaGluZyB0aGUgZ2l2ZW4gU1FMRXhjZXB0aW9uJ3MK\nICAgICAqIGVycm9yIHN0YXRlIGNvZGUgdG8gdGhlIGxpc3Qgb2YgZXJyb3Ig\nY29kZXMgc3VwcGxpZWQgYnkgdGhlIGRpY3Rpb25hcnkuCiAgICAgKiAKICAg\nICAqIEByZXR1cm4gYSBTdG9yZUV4Y2VwdGlvbiBvZiB7QGxpbmsgRXhjZXB0\naW9uSW5mbyNHRU5FUkFMIGdlbmVyYWx9IGNhdGVnb3J5CiAgICAgKiBpZiB0\naGUgZ2l2ZW4gU1FMIEV4Y2VwdGlvbiBjYW4gbm90IGJlIGZ1cnRoZXIgY2F0\nZWdvcml6ZWQuCiAgICAgKiAKICAgICAqIEBzZWUgI21hdGNoRXJyb3JTdGF0\nZShNYXAsIFNRTEV4Y2VwdGlvbikKICAgICAqLwogICAgT3BlbkpQQUV4Y2Vw\ndGlvbiBuYXJyb3coU3RyaW5nIG1zZywgU1FMRXhjZXB0aW9uIGV4LCBPYmpl\nY3QgZmFpbGVkKSB7CiAgICAgICAgaW50IGVycm9yVHlwZSA9IG1hdGNoRXJy\nb3JTdGF0ZShzcWxTdGF0ZUNvZGVzLCBleCk7CiAgICAgICAgU3RvcmVFeGNl\ncHRpb24gc3RvcmVFeDsKICAgICAgICBzd2l0Y2ggKGVycm9yVHlwZSkgewog\nICAgICAgIGNhc2UgU3RvcmVFeGNlcHRpb24uTE9DSzoKICAgICAgICAgICAg\nc3RvcmVFeCA9IG5ldyBMb2NrRXhjZXB0aW9uKGZhaWxlZCk7CiAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgIGNhc2UgU3RvcmVFeGNlcHRpb24uT0JKRUNU\nX0VYSVNUUzoKICAgICAgICAgICAgc3RvcmVFeCA9IG5ldyBPYmplY3RFeGlz\ndHNFeGNlcHRpb24obXNnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nY2FzZSBTdG9yZUV4Y2VwdGlvbi5PQkpFQ1RfTk9UX0ZPVU5EOgogICAgICAg\nICAgICBzdG9yZUV4ID0gbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZh\naWxlZCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgU3RvcmVF\neGNlcHRpb24uT1BUSU1JU1RJQzoKICAgICAgICAgICAgc3RvcmVFeCA9IG5l\ndyBPcHRpbWlzdGljRXhjZXB0aW9uKGZhaWxlZCk7CiAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgIGNhc2UgU3RvcmVFeGNlcHRpb24uUkVGRVJFTlRJQUxf\nSU5URUdSSVRZOgogICAgICAgICAgICBzdG9yZUV4ID0gbmV3IFJlZmVyZW50\naWFsSW50ZWdyaXR5RXhjZXB0aW9uKG1zZyk7CiAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgIGNhc2UgU3RvcmVFeGNlcHRpb24uUVVFUlk6CiAgICAgICAg\nICAgIHN0b3JlRXggPSBuZXcgUXVlcnlFeGNlcHRpb24obXNnKTsKICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgc3Rv\ncmVFeCA9IG5ldyBTdG9yZUV4Y2VwdGlvbihtc2cpOwogICAgICAgIH0KICAg\nICAgICBzdG9yZUV4LnNldEZhdGFsKGlzRmF0YWxFeGNlcHRpb24oZXJyb3JU\neXBlLCBleCkpOwogICAgICAgIHJldHVybiBzdG9yZUV4OwogICAgfQoKICAg\nIC8qKgogICAgICogRGV0ZXJtaW5lIHRoZSBtb3JlIGFwcHJvcHJpYXRlIHR5\ncGUgb2Ygc3RvcmUgZXhjZXB0aW9uIGJ5IG1hdGNoaW5nIHRoZSBTUUwgRXJy\nb3IgU3RhdGUgb2YgdGhlCiAgICAgKiB0aGUgZ2l2ZW4gU1FMRXhjZXB0aW9u\nIHRvIHRoZSBnaXZlbiBFcnJvciBTdGF0ZXMgY2F0ZWdvcml6ZWQgYnkgZXJy\nb3IgdHlwZXMuCiAgICAgKiBEaWN0aW9uYXJ5IHN1YmNsYXNzIGNhbiBvdmVy\ncmlkZSB0aGlzIG1ldGhvZCBhbmQgZXh0cmFjdAogICAgICogU1FMRXhjZXB0\naW9uIGRhdGEgdG8gZmlndXJlIG91dCBpZiB0aGUgZXhjZXB0aW9uIGlzIHJl\nY292ZXJhYmxlLgogICAgICogCiAgICAgKiBAcGFyYW0gZXJyb3JTdGF0ZXMg\nY2xhc3NpZmljYXRpb24gb2YgU1FMIGVycm9yIHN0YXRlcyBieSB0aGVpciBz\ncGVjaWZpYyBuYXR1cmUuIFRoZSBrZXlzIG9mIHRoZQogICAgICogbWFwIHJl\ncHJlc2VudCBvbmUgb2YgdGhlIGNvbnN0YW50cyBkZWZpbmVkIGluIHtAbGlu\nayBTdG9yZUV4Y2VwdGlvbn0uIFRoZSB2YWx1ZSBjb3JyZXNwb25kaW5nIHRv\nCiAgICAgKiBhIGtleSByZXByZXNlbnQgdGhlIHNldCBvZiBTUUwgRXJyb3Ig\nU3RhdGVzIHJlcHJlc2VudGluZyBzcGVjaWZpYyBjYXRlZ29yeSBvZiBkYXRh\nYmFzZSBlcnJvci4gCiAgICAgKiBUaGlzIHN1cHBsaWVkIG1hcCBpcyBzb3Vy\nY2VkIGZyb20gPGNvZGU+c3FsLWVycm9yLXN0YXRlLWNvZGVzLnhtbDwveG1s\nPiBhbmQgZmlsdGVyZWQgdGhlCiAgICAgKiBlcnJvciBzdGF0ZXMgZm9yIHRo\nZSBjdXJyZW50IGRhdGFiYXNlLgogICAgICogCiAgICAgKiBAcGFyYW0gZXgg\nb3JpZ2luYWwgU1FMIEV4Y2VwdGlvbiBhcyByYWlzZWQgYnkgdGhlIGRhdGFi\nYXNlIGRyaXZlci4KICAgICAqIAogICAgICogQHJldHVybiBBIGNvbnN0YW50\nIGluZGljYXRpbmcgdGhlIGNhdGVnb3J5IG9mIGVycm9yIGFzIGRlZmluZWQg\naW4ge0BsaW5rIFN0b3JlRXhjZXB0aW9ufS4KICAgICAqLwogICAgcHJvdGVj\ndGVkIGludCBtYXRjaEVycm9yU3RhdGUoTWFwPEludGVnZXIsU2V0PFN0cmlu\nZz4+IGVycm9yU3RhdGVzLCBTUUxFeGNlcHRpb24gZXgpIHsKICAgICAgICBT\ndHJpbmcgZXJyb3JTdGF0ZSA9IGV4LmdldFNRTFN0YXRlKCk7CiAgICAgICAg\nZm9yIChNYXAuRW50cnk8SW50ZWdlcixTZXQ8U3RyaW5nPj4gc3RhdGVzIDog\nZXJyb3JTdGF0ZXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBpZiAoc3Rh\ndGVzLmdldFZhbHVlKCkuY29udGFpbnMoZXJyb3JTdGF0ZSkpCiAgICAgICAg\nICAgICAgICByZXR1cm4gc3RhdGVzLmdldEtleSgpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gU3RvcmVFeGNlcHRpb24uR0VORVJBTDsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGdpdmVuIFNRTCBF\neGNlcHRpb24gaXMgZmF0YWwgb3IgcmVjb3ZlcmFibGUgKHN1Y2ggYXMgYSB0\naW1lb3V0KS4KICAgICAqIFRoaXMgaW1wbGVtZW50YXRpb24gYWx3YXlzIHJl\ndHVybnMgdHJ1ZSAoaS5lLiBhbGwgZXhjZXB0aW9ucyBhcmUgZmF0YWwpLgog\nICAgICogVGhlIGN1cnJlbnQgZGljdGlvbmFyeSBpbXBsZW1lbnRhdGlvbiBj\nYW4gb3ZlcndyaXRlIHRoaXMgbWV0aG9kIHRvIG1hcmsgY2VydGFpbgogICAg\nICogZXhjZXB0aW9uIGNvbmRpdGlvbnMgYXMgcmVjb3ZlcmFibGUgZXJyb3Iu\nCgogICAgICogQHBhcmFtIHN1YnR5cGUgQSBjb25zdGFudCBpbmRpY2F0aW5n\nIHRoZSBjYXRlZ29yeSBvZiBlcnJvciBhcyBkZWZpbmVkIGluIHtAbGluayBT\ndG9yZUV4Y2VwdGlvbn0uIAogICAgICogQHBhcmFtIGV4IG9yaWdpbmFsIFNR\nTCBFeGNlcHRpb24gYXMgcmFpc2VkIGJ5IHRoZSBkYXRhYmFzZSBkcml2ZXIu\nCiAgICAgKiAKICAgICAqIEByZXR1cm4gZmFsc2UgaWYgdGhlIGVycm9yIGlz\nIGZhdGFsLiAKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNGYXRhbEV4\nY2VwdGlvbihpbnQgc3VidHlwZSwgU1FMRXhjZXB0aW9uIGV4KSB7CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ2xv\nc2VzIHRoZSBzcGVjaWZpZWQge0BsaW5rIERhdGFTb3VyY2V9IGFuZCByZWxl\nYXNlcyBhbnkKICAgICAqIHJlc291cmNlcyBhc3NvY2lhdGVkIHdpdGggaXQu\nCiAgICAgKgogICAgICogQHBhcmFtIGRhdGFTb3VyY2UgdGhlIERhdGFTb3Vy\nY2UgdG8gY2xvc2UKICAgICAqLwogICAgcHVibGljIHZvaWQgY2xvc2VEYXRh\nU291cmNlKERhdGFTb3VyY2UgZGF0YVNvdXJjZSkgewogICAgICAgIERhdGFT\nb3VyY2VGYWN0b3J5LmNsb3NlRGF0YVNvdXJjZShkYXRhU291cmNlKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFVzZWQgYnkgc29tZSBtYXBwaW5ncyB0byBy\nZXByZXNlbnQgZGF0YSB0aGF0IGhhcyBhbHJlYWR5IGJlZW4KICAgICAqIHNl\ncmlhbGl6ZWQgc28gdGhhdCB3ZSBkb24ndCBoYXZlIHRvIHNlcmlhbGl6ZSBt\ndWx0aXBsZSB0aW1lcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFz\ncyBTZXJpYWxpemVkRGF0YSB7CgogICAgICAgIHB1YmxpYyBmaW5hbCBieXRl\nW10gYnl0ZXM7CgogICAgICAgIHB1YmxpYyBTZXJpYWxpemVkRGF0YShieXRl\nW10gYnl0ZXMpIHsKICAgICAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwog\nICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm4gdmVy\nc2lvbiBjb2x1bW4gbmFtZQogICAgICogQHBhcmFtIGNvbHVtbgogICAgICog\nQHBhcmFtIHRhYmxlQWxpYXMgOiB0aGlzIGlzIG5lZWRlZCBmb3IgcGxhdGZv\ncm0gc3BlY2lmaWMgdmVyc2lvbiBjb2x1bW4KICAgICAqIEByZXR1cm4KICAg\nICAqLwogICAgcHVibGljIFN0cmluZyBnZXRWZXJzaW9uQ29sdW1uKENvbHVt\nbiBjb2x1bW4sIFN0cmluZyB0YWJsZUFsaWFzKSB7CiAgICAgICAgcmV0dXJu\nIGdldFZlcnNpb25Db2x1bW4oY29sdW1uLCBEQklkZW50aWZpZXIubmV3VGFi\nbGUodGFibGVBbGlhcykpLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHVibGlj\nIERCSWRlbnRpZmllciBnZXRWZXJzaW9uQ29sdW1uKENvbHVtbiBjb2x1bW4s\nIERCSWRlbnRpZmllciB0YWJsZUFsaWFzKSB7CiAgICAgICAgcmV0dXJuIGNv\nbHVtbi5nZXRJZGVudGlmaWVyKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2\nb2lkIGluc2VydEJsb2JGb3JTdHJlYW1pbmdMb2FkKFJvdyByb3csIENvbHVt\nbiBjb2wsIAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0IG9iLCBT\nZWxlY3Qgc2VsKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nb2IgIT0gbnVsbCkgewogICAgICAgICAgICByb3cuc2V0QmluYXJ5U3RyZWFt\nKGNvbCwgCiAgICAgICAgICAgICAgICBuZXcgQnl0ZUFycmF5SW5wdXRTdHJl\nYW0obmV3IGJ5dGVbMF0pLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICByb3cuc2V0TnVsbChjb2wpOwogICAgICAgIH0KICAgIH0KICAgIAog\nICAgcHVibGljIHZvaWQgaW5zZXJ0Q2xvYkZvclN0cmVhbWluZ0xvYWQoUm93\nIHJvdywgQ29sdW1uIGNvbCwgT2JqZWN0IG9iKQogICAgdGhyb3dzIFNRTEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKG9iICE9IG51bGwpIHsKICAgICAgICBy\nb3cuc2V0Q2hhcmFjdGVyU3RyZWFtKGNvbCwKICAgICAgICAgICAgICAgIG5l\ndyBDaGFyQXJyYXlSZWFkZXIobmV3IGNoYXJbMF0pLCAwKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICByb3cuc2V0TnVsbChjb2wpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgdXBkYXRlQmxvYihTZWxl\nY3Qgc2VsLCBKREJDU3RvcmUgc3RvcmUsIElucHV0U3RyZWFtIGlzKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNRTEJ1ZmZlciBz\ncWwgPSBzZWwudG9TZWxlY3QodHJ1ZSwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1\ncmF0aW9uKCkpOwogICAgICAgIFJlc3VsdFNldCByZXMgPSBudWxsOwogICAg\nICAgIENvbm5lY3Rpb24gY29ubiA9IHN0b3JlLmdldENvbm5lY3Rpb24oKTsK\nICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgc3RtbnQgPSBzcWwucHJlcGFyZVN0YXRl\nbWVudChjb25uLCBzdG9yZS5nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSwKICAg\nICAgICAgICAgICAgIFJlc3VsdFNldC5UWVBFX1NDUk9MTF9TRU5TSVRJVkUs\nCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQuQ09OQ1VSX1VQREFUQUJMRSk7\nCiAgICAgICAgICAgIHNldFRpbWVvdXRzKHN0bW50LCBzdG9yZS5nZXRGZXRj\naENvbmZpZ3VyYXRpb24oKSwgdHJ1ZSk7CiAgICAgICAgICAgIHJlcyA9IHN0\nbW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAgICBpZiAoIXJlcy5uZXh0\nKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbihfbG9jLmdldCgic3RyZWFtLWV4Y2VwdGlvbiIpKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBCbG9iIGJsb2IgPSByZXMuZ2V0QmxvYigxKTsK\nICAgICAgICAgICAgT3V0cHV0U3RyZWFtIG9zID0gYmxvYi5zZXRCaW5hcnlT\ndHJlYW0oMSk7CiAgICAgICAgICAgIGNvcHkoaXMsIG9zKTsKICAgICAgICAg\nICAgb3MuY2xvc2UoKTsKICAgICAgICAgICAgcmVzLnVwZGF0ZUJsb2IoMSwg\nYmxvYik7CiAgICAgICAgICAgIHJlcy51cGRhdGVSb3coKTsKCiAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihpb2UpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChyZXMgIT0gbnVsbCkKICAgICAgICAgICAgICAg\nIHRyeSB7IHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUp\nIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgc3RtbnQuY2xvc2UgKCk7IH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBlKSB7fQogICAgICAgICAgICBpZiAoY29ubiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdHJ5IHsgY29ubi5jbG9zZSAoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCB1cGRhdGVDbG9iKFNlbGVjdCBzZWwsIEpEQkNTdG9yZSBzdG9y\nZSwgUmVhZGVyIHJlYWRlcikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9u\nIHsKICAgICAgICBTUUxCdWZmZXIgc3FsID0gc2VsLnRvU2VsZWN0KHRydWUs\nIHN0b3JlLmdldEZldGNoQ29uZmlndXJhdGlvbigpKTsKICAgICAgICBSZXN1\nbHRTZXQgcmVzID0gbnVsbDsKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSBz\ndG9yZS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgUHJlcGFyZWRTdGF0ZW1l\nbnQgc3RtbnQgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0\nbW50ID0gc3FsLnByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3RvcmUuZ2V0RmV0\nY2hDb25maWd1cmF0aW9uKCksCiAgICAgICAgICAgICAgICBSZXN1bHRTZXQu\nVFlQRV9TQ1JPTExfU0VOU0lUSVZFLAogICAgICAgICAgICAgICAgUmVzdWx0\nU2V0LkNPTkNVUl9VUERBVEFCTEUpOwogICAgICAgICAgICBzZXRUaW1lb3V0\ncyhzdG1udCwgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksIHRydWUp\nOwogICAgICAgICAgICByZXMgPSBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAg\nICAgICAgICAgaWYgKCFyZXMubmV4dCgpKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oX2xvYy5nZXQoInN0cmVhbS1l\neGNlcHRpb24iKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ2xvYiBj\nbG9iID0gcmVzLmdldENsb2IoMSk7CiAgICAgICAgICAgIGlmIChjbG9iICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIFdyaXRlciB3cml0ZXIgPSBjbG9i\nLnNldENoYXJhY3RlclN0cmVhbSgxKTsKICAgICAgICAgICAgICAgIGNvcHko\ncmVhZGVyLCB3cml0ZXIpOwogICAgICAgICAgICAgICAgd3JpdGVyLmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICByZXMudXBkYXRlQ2xvYigxLCBjbG9iKTsK\nICAgICAgICAgICAgICAgIHJlcy51cGRhdGVSb3coKTsKICAgICAgICAgICAg\nfQoKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHJlcyAhPSBudWxsKSAKICAg\nICAgICAgICAgICAgIHRyeSB7IHJlcy5jbG9zZSAoKTsgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIGUpIHt9CiAgICAgICAgICAgIGlmIChzdG1udCAhPSBudWxs\nKSAKICAgICAgICAgICAgICAgIHRyeSB7IHN0bW50LmNsb3NlICgpOyB9IGNh\ndGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICAgICAgaWYgKGNvbm4g\nIT0gbnVsbCkgCiAgICAgICAgICAgICAgICB0cnkgeyBjb25uLmNsb3NlICgp\nOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gZSkge30KICAgICAgICB9ICAgIAog\nICAgfQogICAgCiAgICBwcm90ZWN0ZWQgbG9uZyBjb3B5KElucHV0U3RyZWFt\nIGluLCBPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGJ5dGVbXSBjb3B5QnVmZmVyID0gbmV3IGJ5dGVbYmxvYkJ1ZmZl\nclNpemVdOwogICAgICAgIGxvbmcgYnl0ZXNDb3BpZWQgPSAwOwogICAgICAg\nIGludCByZWFkID0gLTE7CgogICAgICAgIHdoaWxlICgocmVhZCA9IGluLnJl\nYWQoY29weUJ1ZmZlciwgMCwgY29weUJ1ZmZlci5sZW5ndGgpKSAhPSAtMSkg\newogICAgICAgICAgICBvdXQud3JpdGUoY29weUJ1ZmZlciwgMCwgcmVhZCk7\nCiAgICAgICAgICAgIGJ5dGVzQ29waWVkICs9IHJlYWQ7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBieXRlc0NvcGllZDsKICAgIH0KICAgIAogICAgcHJv\ndGVjdGVkIGxvbmcgY29weShSZWFkZXIgcmVhZGVyLCBXcml0ZXIgd3JpdGVy\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoYXJbXSBjb3B5QnVm\nZmVyID0gbmV3IGNoYXJbY2xvYkJ1ZmZlclNpemVdOwogICAgICAgIGxvbmcg\nYnl0ZXNDb3BpZWQgPSAwOwogICAgICAgIGludCByZWFkID0gLTE7CgogICAg\nICAgIHdoaWxlICgocmVhZCA9IHJlYWRlci5yZWFkKGNvcHlCdWZmZXIsIDAs\nIGNvcHlCdWZmZXIubGVuZ3RoKSkgIT0gLTEpIHsKICAgICAgICAgICAgd3Jp\ndGVyLndyaXRlKGNvcHlCdWZmZXIsIDAsIHJlYWQpOwogICAgICAgICAgICBi\neXRlc0NvcGllZCArPSByZWFkOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIGJ5dGVzQ29waWVkOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEF0dGFj\naCBDQVNUIHRvIHRoZSBjdXJyZW50IGZ1bmN0aW9uIGlmIG5lY2Vzc2FyeQog\nICAgICogCiAgICAgKiBAcGFyYW0gdmFsIG9wZXJhbmQgdmFsdWUKICAgICAq\nIEBwYXJtYSBmdW5jIHRoZSBzcWwgZnVuY3Rpb24gc3RhdGVtZW50CiAgICAg\nKiBAcmV0dXJuIGEgU3RyaW5nIHdpdGggdGhlIGNvcnJlY3QgQ0FTVCBmdW5j\ndGlvbiBzeW50YXgKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRDYXN0\nRnVuY3Rpb24oVmFsIHZhbCwgU3RyaW5nIGZ1bmMpIHsKICAgICAgICByZXR1\ncm4gZnVuYzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29y\ncmVjdCBDQVNUIGZ1bmN0aW9uIHN5bnRheC4gIFRoaXMgc2hvdWxkIGJlIG92\nZXJyaWRlbiBieSBzdWJjbGFzc2VzCiAgICAgKiB0aGF0IG5lZWQgYWNjZXNz\nIHRvIHRoZSBDb2x1bW4gaW5mb3JtYXRpb24uCiAgICAgKiAKICAgICAqIEBw\nYXJhbSB2YWwgb3BlcmFuZCBvZiBjYXN0CiAgICAgKiBAcGFyYW0gZnVuYyBv\ncmlnaW5hbCBzdHJpbmcKICAgICAqIEBwYXJhbSBjb2wgZGF0YWJhc2UgY29s\ndW1uCiAgICAgKiBAcmV0dXJuIGEgU3RyaW5nIHdpdGggdGhlIGNvcnJlY3Qg\nQ0FTVCBmdW5jdGlvbiBzeW50YXgKICAgICAqLwogICAgcHVibGljIFN0cmlu\nZyBnZXRDYXN0RnVuY3Rpb24oVmFsIHZhbCwgU3RyaW5nIGZ1bmMsIENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gZ2V0Q2FzdEZ1bmN0aW9uICh2YWws\nIGZ1bmMpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiBp\nbmRleCBpZiBuZWNlc3NhcnkgZm9yIHNvbWUgZGF0YWJhc2UgdGFibGVzCiAg\nICAgKiBAZGVwcmVjYXRlZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBjcmVh\ndGVJbmRleElmTmVjZXNzYXJ5KFNjaGVtYSBzY2hlbWEsIFN0cmluZyB0YWJs\nZSwKICAgICAgICAgICAgQ29sdW1uIHBrQ29sdW1uKSB7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgY3JlYXRlSW5kZXhJZk5lY2Vzc2FyeShTY2hlbWEgc2No\nZW1hLCBEQklkZW50aWZpZXIgdGFibGUsCiAgICAgICAgQ29sdW1uIHBrQ29s\ndW1uKSB7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBi\nYXRjaExpbWl0CiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0QmF0Y2hMaW1p\ndCgpewogICAgICAgIHJldHVybiBiYXRjaExpbWl0OwogICAgfQogICAgCiAg\nICAvKioKICAgICAqIFNldCB0aGUgYmF0Y2hMaW1pdCB2YWx1ZQogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBzZXRCYXRjaExpbWl0KGludCBsaW1pdCl7CiAg\nICAgICAgYmF0Y2hMaW1pdCA9IGxpbWl0OwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFZhbGlkYXRlIHRoZSBiYXRjaCBwcm9jZXNzLiBJbiBzb21lIGNh\nc2VzLCB3ZSBjYW4ndCBiYXRjaCB0aGUgc3RhdGVtZW50cwogICAgICogZHVl\nIHRvIHNvbWUgcmVzdHJpY3Rpb25zLiBGb3IgZXhhbXBsZSwgaWYgdGhlIEdl\nbmVyYXRlZFR5cGU9SURFTlRJVFksCiAgICAgKiB3ZSBoYXZlIHRvIGRpc2Fi\nbGUgdGhlIGJhdGNoIHByb2Nlc3MgYmVjYXVzZSB3ZSBuZWVkIHRvIGdldCB0\naGUgSUQgdmFsdWUKICAgICAqIHJpZ2h0IGF3YXkgZm9yIHRoZSBpbi1tZW1v\ncnkgZW50aXR5IHRvIHVzZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\ndmFsaWRhdGVCYXRjaFByb2Nlc3MoUm93SW1wbCByb3csIENvbHVtbltdIGF1\ndG9Bc3NpZ24sCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgIHNt\nLCBDbGFzc01hcHBpbmcgY21kICkgewogICAgICAgIGJvb2xlYW4gZGlzYWJs\nZUJhdGNoID0gZmFsc2U7CiAgICAgICAgaWYgKGdldEJhdGNoTGltaXQoKT09\nIDApIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoYXV0b0Fzc2lnbiAhPSBu\ndWxsICYmIHNtICE9IG51bGwpIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYVtdIGZtZCA9IGNtZC5nZXRQcmltYXJ5S2V5RmllbGRzKCk7CiAgICAgICAg\nICAgIGludCBpID0gMDsKICAgICAgICAgICAgd2hpbGUgKCFkaXNhYmxlQmF0\nY2ggJiYgaSA8IGZtZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmIChm\nbWRbaV0uZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRlZ2llcy5B\nVVRPQVNTSUdOKQogICAgICAgICAgICAgICAgICAgIGRpc2FibGVCYXRjaCA9\nIHRydWU7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgLy8gZ28gdG8gZWFjaCBEaWN0aW9uYXJ5IHRvIHZh\nbGlkYXRlIHRoZSBiYXRjaCBjYXBhYmlsaXR5CiAgICAgICAgaWYgKCFkaXNh\nYmxlQmF0Y2gpCiAgICAgICAgICAgIGRpc2FibGVCYXRjaCA9IHZhbGlkYXRl\nREJTcGVjaWZpY0JhdGNoUHJvY2VzcyhkaXNhYmxlQmF0Y2gsIHJvdywgCiAg\nICAgICAgICAgICAgICBhdXRvQXNzaWduLCBzbSwgY21kKTsKICAgICAgICBy\nZXR1cm4gZGlzYWJsZUJhdGNoOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIEFsbG93IGVhY2ggRGljdGlvbmFyeSB0byB2YWxpZGF0ZSBpdHMgb3duIGJh\ndGNoIHByb2Nlc3MuIAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiB2YWxp\nZGF0ZURCU3BlY2lmaWNCYXRjaFByb2Nlc3MgKGJvb2xlYW4gZGlzYWJsZUJh\ndGNoLCAKICAgICAgICAgICAgUm93SW1wbCByb3csIENvbHVtbltdIGF1dG9B\nc3NpZ24sIAogICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyICBzbSwg\nQ2xhc3NNYXBwaW5nIGNtZCApIHsKICAgICAgICByZXR1cm4gZGlzYWJsZUJh\ndGNoOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlz\nIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlr\nZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGV4ZWN1dGluZyBxdWVyeS4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFJlc3VsdFNldCBleGVjdXRlUXVlcnko\nQ29ubmVjdGlvbiBjb25uLCBQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwKICAg\nICAgICAgICAgU3RyaW5nIHNxbCAKICAgICAgICApIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnkoKTsK\nICAgIH0KICAgICAgICAgICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9k\nIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMt\nbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIHByZXBhcmluZyBzdGF0\nZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVu\ndCBwcmVwYXJlU3RhdGVtZW50KENvbm5lY3Rpb24gY29ubiwgU3RyaW5nIHNx\nbCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gY29ubi5wcmVwYXJlU3RhdGVtZW50KHNxbCk7CiAgICB9ICAgIAogCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIGdldHRpbmcgc2VxdWVuY2UgZnJvbSB0aGUgcmVzdWx0IHNl\ndC4KICAgICAqLwogICAgcHJvdGVjdGVkIFNlcXVlbmNlW10gZ2V0U2VxdWVu\nY2UoUmVzdWx0U2V0IHJzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBMaXN0IHNlcUxpc3QgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAgd2hp\nbGUgKHJzICE9IG51bGwgJiYgcnMubmV4dCgpKQogICAgICAgICAgICBzZXFM\naXN0LmFkZChuZXdTZXF1ZW5jZShycykpOwogICAgICAgIHJldHVybiAoU2Vx\ndWVuY2VbXSkgc2VxTGlzdC50b0FycmF5KG5ldyBTZXF1ZW5jZVtzZXFMaXN0\nLnNpemUoKV0pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIFRoaXMgbWV0\naG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5vbi1KREJDIG9yIEpE\nQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9mIGdldHRpbmcga2V5\nIGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBP\nYmplY3QgZ2V0S2V5IChSZXN1bHRTZXQgcnMsIENvbHVtbiBjb2wpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmICghcnMubmV4dCgpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLWdlbmtleSIpKTsKICAgICAgICBPYmplY3Qga2V5ID0gcnMuZ2V0T2JqZWN0\nKDEpOwogICAgICAgIGlmIChrZXkgPT0gbnVsbCkKICAgICAgICAgICAgbG9n\nLndhcm4oX2xvYy5nZXQoImludmFsaWQtZ2Vua2V5IiwgY29sKSk7CiAgICAg\nICAgcmV0dXJuIGtleTsgICAgICAgIAogICAgfQogICAgCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJpZGUgZm9yIG5v\nbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVudGF0aW9uIG9m\nIGNhbGN1bGF0aW5nIHZhbHVlLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBjYWxjdWxhdGVWYWx1ZShWYWwgdmFsLCBTZWxlY3Qgc2VsLCBFeHBDb250\nZXh0IGN0eCwgCiAgICAgICAgRXhwU3RhdGUgc3RhdGUsIFBhdGggcGF0aCwg\nRXhwU3RhdGUgcGF0aFN0YXRlKSB7CiAgICAgICAgdmFsLmNhbGN1bGF0ZVZh\nbHVlKHNlbCwgY3R4LCBzdGF0ZSwgKFZhbCkgcGF0aCwgcGF0aFN0YXRlKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZSB3aGV0aGVyIHRoZSBw\ncm92aWRlZCA8Y29kZT5zcWw8L2NvZGU+IG1heSBiZSB0cmVhdGVkIGFzIGEg\nCiAgICAgKiBzZWxlY3Qgc3RhdGVtZW50IG9uIHRoaXMgZGF0YWJhc2UuCiAg\nICAgKiAgCiAgICAgKiBAcGFyYW0gc3FsICAgQSBzcWwgc3RhdGVtZW50LiAK\nICAgICAqIAogICAgICogQHJldHVybiB0cnVlIGlmIDxjb2RlPnNxbDwvY29k\nZT4gcmVwcmVzZW50cyBhIHNlbGVjdCBzdGF0ZW1lbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzU2VsZWN0KFN0cmluZyBzcWwpIHsKICAgICAg\nICBJdGVyYXRvciBpID0gc2VsZWN0V29yZFNldC5pdGVyYXRvcigpOwogICAg\nICAgIFN0cmluZyBjdXI7CiAgICAgICAgd2hpbGUgKGkuaGFzTmV4dCgpKSB7\nCiAgICAgICAgICAgIGN1ciA9IChTdHJpbmcpIGkubmV4dCgpOwogICAgICAg\nICAgICBpZiAoc3FsLmxlbmd0aCgpID49IGN1ci5sZW5ndGgoKQogICAgICAg\nICAgICAgICAgICAgICYmIHNxbC5zdWJzdHJpbmcoMCwgY3VyLmxlbmd0aCgp\nKS5lcXVhbHNJZ25vcmVDYXNlKGN1cikpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBuZWVkc1Rv\nQ3JlYXRlSW5kZXgoSW5kZXggaWR4LCBUYWJsZSB0YWJsZSkgewogICAgICAg\nIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGJh\ndGNoZWQgc3RhdGVtZW50cyB1cGRhdGUgc3VjY2VzcyBjb3VudAogICAgICog\nQHBhcmFtIHBzIEEgUHJlcGFyZWRTdGF0ZW1lbnQKICAgICAqIEByZXR1cm4g\ncmV0dXJuIHVwZGF0ZSBjb3VudAogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEJhdGNoVXBkYXRlQ291bnQoUHJlcGFyZWRTdGF0ZW1lbnQgcHMpIHRocm93\ncyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiAwOwogICAgfQogICAg\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRUcmltU2NoZW1hTmFtZSgpIHsgCiAg\nICAgICAgcmV0dXJuIHRyaW1TY2hlbWFOYW1lOwogICAgfQogICAgCiAgICBw\ndWJsaWMgdm9pZCBzZXRUcmltU2NoZW1hTmFtZShib29sZWFuIHRyaW1TY2hl\nbWFOYW1lKSB7IAogICAgICAgIHRoaXMudHJpbVNjaGVtYU5hbWUgPSB0cmlt\nU2NoZW1hTmFtZTsgCiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIGRlbGV0\nZVN0cmVhbShKREJDU3RvcmUgc3RvcmUsIFNlbGVjdCBzZWwpIHRocm93cyBT\nUUxFeGNlcHRpb24gewogICAgICAgIC8vIERvIG5vdGhpbmcKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBWYWxpZGF0ZSB0aGF0IHRoZSBnaXZlbiBuYW1l\nIGlzIG5vIGxvbmdlciB0aGFuIGdpdmVuIG1heGltdW0gbGVuZ3RoLgogICAg\nICogSWYgdGhlIGdpdmVuIG5hbWUgaXMgaW5kZWVkIGxvbmdlciB0aGVuIHJh\naXNlcyBhbiBVc2VyRXhjZXB0aW9uIHdpdGggdGhlIAogICAgICogZ2l2ZW4g\nbWVzc2FnZSBrZXkgb3RoZXJ3aXNlIHJldHVybnMgdGhlIHNhbWUgbmFtZS4K\nICAgICAqLwogICAgZmluYWwgU3RyaW5nIGNoZWNrTmFtZUxlbmd0aChTdHJp\nbmcgbmFtZSwgaW50IGxlbmd0aCwgU3RyaW5nIG1zZ0tleSkgewogICAgICAg\nIGlmIChuYW1lLmxlbmd0aCgpID4gbGVuZ3RoKQogICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldChtc2dLZXksIG5hbWUsIG5h\nbWUubGVuZ3RoKCksIAogICAgICAgICAgICAgICAgICAgIGxlbmd0aCkpOwog\nICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIHNldERlbGltaXRlZENhc2UoRGF0YWJhc2VNZXRhRGF0YSBtZXRhRGF0YSkg\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChtZXRhRGF0YS5zdG9y\nZXNNaXhlZENhc2VRdW90ZWRJZGVudGlmaWVycygpKSB7CiAgICAgICAgICAg\nICAgICBkZWxpbWl0ZWRDYXNlID0gU0NIRU1BX0NBU0VfUFJFU0VSVkU7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobWV0YURhdGEuc3Rv\ncmVzVXBwZXJDYXNlUXVvdGVkSWRlbnRpZmllcnMoKSkgewogICAgICAgICAg\nICAgICAgZGVsaW1pdGVkQ2FzZSA9IFNDSEVNQV9DQVNFX1VQUEVSOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKG1ldGFEYXRhLnN0b3Jl\nc0xvd2VyQ2FzZVF1b3RlZElkZW50aWZpZXJzKCkpIHsKICAgICAgICAgICAg\nICAgIGRlbGltaXRlZENhc2UgPSBTQ0hFTUFfQ0FTRV9MT1dFUjsKICAgICAg\nICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIGdldExvZygpLndhcm4oImNhbm5vdC1kZXRlcm1pbmUtaWRl\nbnRpZmllci1jYXNlIik7CiAgICAgICAgICAgIGlmIChnZXRMb2coKS5pc1Ry\nYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBnZXRMb2coKS50cmFj\nZShlLnRvU3RyaW5nKCksIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQogICAgCiAgICAvKioKICAgICAqIEByZXR1cm4gdGhlIHN1cHBvcnRz\nRGVsaW1pdGVkSWRzCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdldFN1\ncHBvcnRzRGVsaW1pdGVkSWRlbnRpZmllcnMoKSB7CiAgICAgICAgcmV0dXJu\nIHN1cHBvcnRzRGVsaW1pdGVkSWRlbnRpZmllcnM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBAcGFyYW0gc3VwcG9ydHNEZWxpbWl0ZWRJZHMgdGhlIHN1cHBv\ncnRzRGVsaW1pdGVkSWRzIHRvIHNldAogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRTdXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzKERhdGFiYXNlTWV0\nYURhdGEgbWV0YURhdGEpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBz\ndXBwb3J0c0RlbGltaXRlZElkZW50aWZpZXJzID0gCiAgICAgICAgICAgICAg\nICBtZXRhRGF0YS5zdXBwb3J0c01peGVkQ2FzZVF1b3RlZElkZW50aWZpZXJz\nKCkgfHwKICAgICAgICAgICAgICAgIG1ldGFEYXRhLnN0b3Jlc0xvd2VyQ2Fz\nZVF1b3RlZElkZW50aWZpZXJzKCkgfHwKICAgICAgICAgICAgICAgIG1ldGFE\nYXRhLnN0b3Jlc1VwcGVyQ2FzZVF1b3RlZElkZW50aWZpZXJzKCk7CiAgICAg\nICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgc3Vw\ncG9ydHNEZWxpbWl0ZWRJZGVudGlmaWVycyA9IGZhbHNlOwogICAgICAgICAg\nICBnZXRMb2coKS53YXJuKF9sb2MuZ2V0KCJ1bmtub3duLWRlbGltLXN1cHBv\ncnQiLCBlKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHJl\ndHVybiB0aGUgZGVsaW1pdElkcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBnZXREZWxpbWl0SWRlbnRpZmllcnMoKSB7CiAgICAgICAgcmV0dXJuIGRl\nbGltaXRJZGVudGlmaWVyczsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJh\nbSBkZWxpbWl0SWRzIHRoZSBkZWxpbWl0SWRzIHRvIHNldAogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXREZWxpbWl0SWRlbnRpZmllcnMoYm9vbGVhbiBk\nZWxpbWl0SWRzKSB7CiAgICAgICAgZGVsaW1pdElkZW50aWZpZXJzID0gZGVs\naW1pdElkczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAcmV0dXJuIHN1\ncHBvcnRzWE1MQ29sdW1uCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGdl\ndFN1cHBvcnRzWE1MQ29sdW1uKCkgewogICAgICAgIHJldHVybiBzdXBwb3J0\nc1hNTENvbHVtbjsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSBiIGJv\nb2xlYW4gcmVwcmVzZW50aW5nIGlmIFhNTCBjb2x1bW5zIGFyZSBzdXBwb3J0\nZWQKICAgICAqLwogICAgcHVibGljIHZvaWQgc2V0U3VwcG9ydHNYTUxDb2x1\nbW4oYm9vbGVhbiBiKSB7CiAgICAgICAgc3VwcG9ydHNYTUxDb2x1bW4gPSBi\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEByZXR1cm4geG1sVHlwZUVu\nY29kaW5nCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0WE1MVHlwZUVu\nY29kaW5nKCkgewogICAgICAgIHJldHVybiB4bWxUeXBlRW5jb2Rpbmc7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0gZW5jb2RpbmcgZGF0YWJhc2Ug\ncmVxdWlyZWQgSkFYQiBlbmNvZGluZyBmb3IgdGhlIFhNTCB2YWx1ZQogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBzZXRYTUxUeXBlRW5jb2RpbmcoU3RyaW5n\nIGVuY29kaW5nKSB7CiAgICAgICAgeG1sVHlwZUVuY29kaW5nID0gZW5jb2Rp\nbmc7CiAgICB9CgogICAgcHVibGljIExvZyBnZXRMb2coKSB7IAogICAgICAg\nIHJldHVybiBsb2c7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZGVsaW1p\ndEFsbCgpIHsKICAgICAgICByZXR1cm4gZGVsaW1pdElkZW50aWZpZXJzOwog\nICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0TGVhZGluZ0RlbGltaXRlcigp\nIHsKICAgICAgICByZXR1cm4gbGVhZGluZ0RlbGltaXRlcjsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRMZWFkaW5nRGVsaW1pdGVyKFN0cmluZyBkZWxp\nbSkgewogICAgICAgIGxlYWRpbmdEZWxpbWl0ZXIgPSBkZWxpbTsKICAgIH0K\nCiAgICBwdWJsaWMgU3RyaW5nIGdldElkZW50aWZpZXJEZWxpbWl0ZXIoKSB7\nCiAgICAgICAgcmV0dXJuIGNhdGFsb2dTZXBhcmF0b3I7CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyBnZXRJZGVudGlmaWVyQ29uY2F0ZW5hdG9yKCkgewog\nICAgICAgIHJldHVybiBuYW1lQ29uY2F0ZW5hdG9yOwogICAgfQogICAgCiAg\nICBwdWJsaWMgU3RyaW5nIGdldFRyYWlsaW5nRGVsaW1pdGVyKCkgewogICAg\nICAgIHJldHVybiB0cmFpbGluZ0RlbGltaXRlcjsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzZXRUcmFpbGluZ0RlbGltaXRlcihTdHJpbmcgZGVsaW0pIHsK\nICAgICAgICB0cmFpbGluZ0RlbGltaXRlciA9IGRlbGltOwogICAgfQoKICAg\nIHB1YmxpYyBJZGVudGlmaWVyUnVsZSBnZXREZWZhdWx0SWRlbnRpZmllclJ1\nbGUoKSB7CiAgICAgICAgaWYgKGRlZmF1bHROYW1pbmdSdWxlID09IG51bGwp\nIHsKICAgICAgICAgICAgZGVmYXVsdE5hbWluZ1J1bGUgPSBuYW1pbmdSdWxl\ncy5nZXQoREJJZGVudGlmaWVyVHlwZS5ERUZBVUxULm5hbWUoKSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBkZWZhdWx0TmFtaW5nUnVsZTsKICAgIH0K\nCiAgICBwdWJsaWMgPFQ+IElkZW50aWZpZXJSdWxlIGdldElkZW50aWZpZXJS\ndWxlKFQgdCkgewogICAgICAgIGlmICh0LmVxdWFscyhEQklkZW50aWZpZXJU\neXBlLkRFRkFVTFQubmFtZSgpKSkgewogICAgICAgICAgICByZXR1cm4gZ2V0\nRGVmYXVsdElkZW50aWZpZXJSdWxlKCk7CiAgICAgICAgfQogICAgICAgIElk\nZW50aWZpZXJSdWxlIG5ydWxlID0gbmFtaW5nUnVsZXMuZ2V0KHQpOwogICAg\nICAgIGlmIChucnVsZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBn\nZXREZWZhdWx0SWRlbnRpZmllclJ1bGUoKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIG5ydWxlOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1\nbmNoZWNrZWQiKQogICAgcHVibGljIE1hcDxTdHJpbmcsIElkZW50aWZpZXJS\ndWxlPiBnZXRJZGVudGlmaWVyUnVsZXMoKSB7CiAgICAgICAgcmV0dXJuIG5h\nbWluZ1J1bGVzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\nbmFtaW5nIHV0aWxpdHkgdXNlZCBieSB0aGlzIGRpY3Rpb25hcnkgaW5zdGFu\nY2UKICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHVibGljIERCSWRlbnRp\nZmllclV0aWwgZ2V0TmFtaW5nVXRpbCgpIHsKICAgICAgICByZXR1cm4gbmFt\naW5nVXRpbDsKICAgIH0KICAgIAogICAgcHVibGljIFN0cmluZyBnZXREZWxp\nbWl0ZWRDYXNlKCkgewogICAgICAgIHJldHVybiBkZWxpbWl0ZWRDYXNlOwog\nICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9EQk5hbWUoREJJZGVudGlmaWVy\nIG5hbWUpIHsKICAgICAgICByZXR1cm4gZ2V0TmFtaW5nVXRpbCgpLnRvREJO\nYW1lKG5hbWUpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgdG9EQk5hbWUo\nREJJZGVudGlmaWVyIG5hbWUsIGJvb2xlYW4gZGVsaW1pdCkgewogICAgICAg\nIHJldHVybiBnZXROYW1pbmdVdGlsKCkudG9EQk5hbWUobmFtZSwgZGVsaW1p\ndCk7CiAgICB9CgogICAgcHVibGljIERCSWRlbnRpZmllciBmcm9tREJOYW1l\nKFN0cmluZyBuYW1lLCBEQklkZW50aWZpZXJUeXBlIGlkKSB7CiAgICAgICAg\ncmV0dXJuIGdldE5hbWluZ1V0aWwoKS5mcm9tREJOYW1lKG5hbWUsIGlkKTsK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0RGVmYXVsdFNjaGVtYU5h\nbWUoU3RyaW5nIGRlZmF1bHRTY2hlbWFOYW1lKSB7CiAgICAgICAgdGhpcy5k\nZWZhdWx0U2NoZW1hTmFtZSA9IGRlZmF1bHRTY2hlbWFOYW1lOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0RGVmYXVsdFNjaGVtYU5hbWUoKSB7CiAg\nICAgICAgcmV0dXJuIGRlZmF1bHRTY2hlbWFOYW1lOwogICAgfQogICAgCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENvbnZlcnNpb25LZXkoKSB7CiAgICAgICAg\naWYgKGNvbnZlcnNpb25LZXkgPT0gbnVsbCkgewogICAgICAgICAgICBjb252\nZXJzaW9uS2V5ID0gZ2V0TGVhZGluZ0RlbGltaXRlcigpICsgZ2V0SWRlbnRp\nZmllckRlbGltaXRlcigpICsKICAgICAgICAgICAgZ2V0VHJhaWxpbmdEZWxp\nbWl0ZXIoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbnZlcnNpb25L\nZXk7CiAgICB9Cn0K\n","encoding":"base64"}

