{"sha":"53ab8bbecc0577cfdd15a1297e7a488a47d6c4e1","node_id":"MDQ6QmxvYjIwNjM2NDo1M2FiOGJiZWNjMDU3N2NmZGQxNWExMjk3ZTdhNDg4YTQ3ZDZjNGUx","size":50942,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/53ab8bbecc0577cfdd15a1297e7a488a47d6c4e1","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5sYW5nLnJlZmxlY3QuSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuQWNjZXNzQ29udHJvbGxlcjsKaW1wb3J0IGphdmEuc3FsLkJs\nb2I7CmltcG9ydCBqYXZhLnNxbC5DbG9iOwppbXBvcnQgamF2YS5zcWwuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLkRhdGFiYXNlTWV0YURhdGE7Cmlt\ncG9ydCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEu\nc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsK\naW1wb3J0IGphdmEuc3FsLlN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLlRp\nbWVzdGFtcDsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9y\ndCBqYXZhLnV0aWwuQ2FsZW5kYXI7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuaWRlbnRp\nZmllci5EQklkZW50aWZpZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\namRiYy5rZXJuZWwuSkRCQ0ZldGNoQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJW\nYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuSmF2\nYVNRTFR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2No\nZW1hLkNvbHVtbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNj\naGVtYS5Gb3JlaWduS2V5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkluZGV4OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLlByaW1hcnlLZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuU2VxdWVuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuamRiYy5zY2hlbWEuRm9yZWlnbktleS5GS01hcEtleTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRiYy5EZWxlZ2F0aW5nRGF0YWJh\nc2VNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIuamRi\nYy5EZWxlZ2F0aW5nUHJlcGFyZWRTdGF0ZW1lbnQ7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKCi8qKgog\nKiBEaWN0aW9uYXJ5IGZvciBPcmFjbGUuCiAqLwpwdWJsaWMgY2xhc3MgT3Jh\nY2xlRGljdGlvbmFyeQogICAgZXh0ZW5kcyBEQkRpY3Rpb25hcnkgewoKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFNFTEVDVF9ISU5UID0gIm9w\nZW5qcGEuaGludC5PcmFjbGVTZWxlY3RIaW50IjsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgU3RyaW5nIFZFTkRPUl9PUkFDTEUgPSAib3JhY2xlIjsKCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgQkVIQVZFX09USEVSID0gMDsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBCRUhBVkVfT1JBQ0xFID0g\nMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBCRUhBVkVfREFUQURJ\nUkVDVDMxID0gMjsKCiAgICBwcml2YXRlIHN0YXRpYyBCbG9iIEVNUFRZX0JM\nT0IgPSBudWxsOwogICAgcHJpdmF0ZSBzdGF0aWMgQ2xvYiBFTVBUWV9DTE9C\nID0gbnVsbDsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2NhbGl6ZXIg\nX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdlCiAgICAgICAgKE9yYWNsZURp\nY3Rpb25hcnkuY2xhc3MpOwoKICAgIC8qKgogICAgICogSWYgdHJ1ZSwgdGhl\nbiBzaW11bGF0ZSBhdXRvLWFzc2lnbmVkIHZhbHVlcyBpbiBPcmFjbGUgYnkK\nICAgICAqIHVzaW5nIGEgdHJpZ2dlciB0aGF0IGluc2VydHMgYSBzZXF1ZW5j\nZSB2YWx1ZSBpbnRvIHRoZQogICAgICogcHJpbWFyeSBrZXkgdmFsdWUgd2hl\nbiBhIHJvdyBpcyBpbnNlcnRlZC4KICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gdXNlVHJpZ2dlcnNGb3JBdXRvQXNzaWduID0gZmFsc2U7CgogICAgLyoq\nCiAgICAgKiBUaGUgZ2xvYmFsIHNlcXVlbmNlIG5hbWUgdG8gdXNlIGZvciBh\ndXRvYXNzaWduIHNpbXVsYXRpb24uCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgYXV0b0Fzc2lnblNlcXVlbmNlTmFtZSA9IG51bGw7CgogICAgLyoqCiAg\nICAgKiBGbGFnIHRvIHVzZSBPcGVuSlBBIDAuMyBzdHlsZSBuYW1pbmcgZm9y\nIGF1dG8gYXNzaWduIHNlcXVlbmNlIG5hbWUgYW5kCiAgICAgKiB0cmlnZ2Vy\nIG5hbWUgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBvcGVuanBhM0dlbmVyYXRlZEtleU5hbWVzID0g\nZmFsc2U7CgogICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0aGVuIE9wZW5KUEEg\nd2lsbCBhdHRlbXB0IHRvIHVzZSB0aGUgc3BlY2lhbAogICAgICogT3JhY2xl\nUHJlcGFyZWRTdGF0ZW1lbnQuc2V0Rm9ybU9mVXNlIG1ldGhvZCB0bwogICAg\nICogY29uZmlndXJlIHN0YXRlbWVudHMgdGhhdCBpdCBkZXRlY3RzIGFyZSBv\ncGVyYXRpbmcgb24gdW5pY29kZSBmaWVsZHMuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIHVzZVNldEZvcm1PZlVzZUZvclVuaWNvZGUgPSB0cnVlOwoK\nICAgIC8vIHNvbWUgb3JhY2xlIGRyaXZlcnMgaGF2ZSBwcm9ibGVtcyB3aXRo\nIHNlbGVjdCBmb3IgdXBkYXRlOyB3YXJuIHRoZQogICAgLy8gZmlyc3QgdGlt\nZSBsb2NraW5nIGlzIGF0dGVtcHRlZAogICAgcHJpdmF0ZSBib29sZWFuIF9j\naGVja2VkVXBkYXRlQnVnID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX3dhcm5lZENoYXJDb2x1bW4gPSBmYWxzZTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBfd2FybmVkTmNoYXJDb2x1bW4gPSBmYWxzZTsKICAgIHByaXZhdGUgaW50\nIF9kcml2ZXJCZWhhdmlvciA9IC0xOwoKICAgIC8vIGNhY2hlIGxvYiBtZXRo\nb2RzCiAgICBwcml2YXRlIE1ldGhvZCBfcHV0Qnl0ZXMgPSBudWxsOwogICAg\ncHJpdmF0ZSBNZXRob2QgX3B1dFN0cmluZyA9IG51bGw7CiAgICBwcml2YXRl\nIE1ldGhvZCBfcHV0Q2hhcnMgPSBudWxsOwogICAgCiAgICAvLyBiYXRjaCBs\naW1pdAogICAgcHJpdmF0ZSBpbnQgZGVmYXVsdEJhdGNoTGltaXQgPSAxMDA7\nCgogICAgcHVibGljIE9yYWNsZURpY3Rpb25hcnkoKSB7CiAgICAgICAgcGxh\ndGZvcm0gPSAiT3JhY2xlIjsKICAgICAgICB2YWxpZGF0aW9uU1FMID0gIlNF\nTEVDVCBTWVNEQVRFIEZST00gRFVBTCI7CiAgICAgICAgbmV4dFNlcXVlbmNl\nUXVlcnkgPSAiU0VMRUNUIHswfS5ORVhUVkFMIEZST00gRFVBTCI7CiAgICAg\nICAgc3RyaW5nTGVuZ3RoRnVuY3Rpb24gPSAiTEVOR1RIKHswfSkiOwogICAg\nICAgIGpvaW5TeW50YXggPSBTWU5UQVhfREFUQUJBU0U7CiAgICAgICAgbWF4\nVGFibGVOYW1lTGVuZ3RoID0gMzA7CiAgICAgICAgbWF4Q29sdW1uTmFtZUxl\nbmd0aCA9IDMwOwogICAgICAgIG1heEluZGV4TmFtZUxlbmd0aCA9IDMwOwog\nICAgICAgIG1heENvbnN0cmFpbnROYW1lTGVuZ3RoID0gMzA7CiAgICAgICAg\nbWF4RW1iZWRkZWRCbG9iU2l6ZSA9IDQwMDA7CiAgICAgICAgbWF4RW1iZWRk\nZWRDbG9iU2l6ZSA9IDQwMDA7CiAgICAgICAgaW5DbGF1c2VMaW1pdCA9IDEw\nMDA7CgogICAgICAgIHN1cHBvcnRzRGVmZXJyZWRDb25zdHJhaW50cyA9IHRy\ndWU7CiAgICAgICAgc3VwcG9ydHNMb2NraW5nV2l0aERpc3RpbmN0Q2xhdXNl\nID0gZmFsc2U7CiAgICAgICAgc3VwcG9ydHNTZWxlY3RTdGFydEluZGV4ID0g\ndHJ1ZTsKICAgICAgICBzdXBwb3J0c1NlbGVjdEVuZEluZGV4ID0gdHJ1ZTsK\nCiAgICAgICAgc3lzdGVtU2NoZW1hU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0\nKG5ldyBTdHJpbmdbXXsKICAgICAgICAgICAgIkNUWFNZUyIsICJNRFNZUyIs\nICJTWVMiLCAiU1lTVEVNIiwgIldLU1lTIiwgIldNU1lTIiwgIlhEQiIsCiAg\nICAgICAgfSkpOwoKICAgICAgICBzdXBwb3J0c1hNTENvbHVtbiA9IHRydWU7\nCiAgICAgICAgeG1sVHlwZU5hbWUgPSAiWE1MVHlwZSI7CiAgICAgICAgYmln\naW50VHlwZU5hbWUgPSAiTlVNQkVSezB9IjsKICAgICAgICBiaXRUeXBlTmFt\nZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIGRlY2ltYWxUeXBlTmFtZSA9ICJO\nVU1CRVJ7MH0iOwogICAgICAgIGRvdWJsZVR5cGVOYW1lID0gIk5VTUJFUnsw\nfSI7CiAgICAgICAgaW50ZWdlclR5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAg\nICAgICAgbnVtZXJpY1R5cGVOYW1lID0gIk5VTUJFUnswfSI7CiAgICAgICAg\nc21hbGxpbnRUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIHRpbnlp\nbnRUeXBlTmFtZSA9ICJOVU1CRVJ7MH0iOwogICAgICAgIGxvbmdWYXJjaGFy\nVHlwZU5hbWUgPSAiTE9ORyI7CiAgICAgICAgYmluYXJ5VHlwZU5hbWUgPSAi\nQkxPQiI7CiAgICAgICAgdmFyYmluYXJ5VHlwZU5hbWUgPSAiQkxPQiI7CiAg\nICAgICAgbG9uZ1ZhcmJpbmFyeVR5cGVOYW1lID0gIkJMT0IiOwogICAgICAg\nIHRpbWVUeXBlTmFtZSA9ICJEQVRFIjsKICAgICAgICB2YXJjaGFyVHlwZU5h\nbWUgPSAiVkFSQ0hBUjJ7MH0iOwogICAgICAgIGZpeGVkU2l6ZVR5cGVOYW1l\nU2V0LmFkZEFsbChBcnJheXMuYXNMaXN0KG5ldyBTdHJpbmdbXXsKICAgICAg\nICAgICAgIkxPTkcgUkFXIiwgIlJBVyIsICJMT05HIiwgIlJFRiIsCiAgICAg\nICAgfSkpOwogICAgICAgIHJlc2VydmVkV29yZFNldC5hZGRBbGwoQXJyYXlz\nLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAgICJBQ0NFU1MiLCAi\nQVVESVQiLCAiQ0xVU1RFUiIsICJDT01NRU5UIiwgIkNPTVBSRVNTIiwgIkVY\nQ0xVU0lWRSIsCiAgICAgICAgICAgICJGSUxFIiwgIklERU5USUZJRUQiLCAi\nSU5DUkVNRU5UIiwgIklOREVYIiwgIklOSVRJQUwiLCAiTE9DSyIsCiAgICAg\nICAgICAgICJMT05HIiwgIk1BWEVYVEVOVFMiLCAiTUlOVVMiLCAiTU9ERSIs\nICJOT0FVRElUIiwgIk5PQ09NUFJFU1MiLAogICAgICAgICAgICAiTk9XQUlU\nIiwgIk9GRkxJTkUiLCAiT05MSU5FIiwgIlBDVEZSRUUiLCAiUk9XIiwKICAg\nICAgICB9KSk7CgogICAgICAgIC8vIHJlc2VydmVkV29yZFNldCBzdWJzZXQg\ndGhhdCBDQU5OT1QgYmUgdXNlZCBhcyB2YWxpZCBjb2x1bW4gbmFtZXMKICAg\nICAgICAvLyAoaS5lLiwgd2l0aG91dCBzdXJyb3VuZGluZyB0aGVtIHdpdGgg\nZG91YmxlLXF1b3RlcykKICAgICAgICBpbnZhbGlkQ29sdW1uV29yZFNldC5h\nZGRBbGwoQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW117CiAgICAgICAgICAg\nICJBQ0NFU1MiLCAiQUREIiwgIkFMTCIsICJBTFRFUiIsICJBTkQiLCAiQU5Z\nIiwgIkFTIiwgIkFTQyIsICJBVURJVCIsCiAgICAgICAgICAgICJCRVRXRUVO\nIiwgIkJZIiwgIkNIQVIiLCAiQ0hFQ0siLCAiQ0xVU1RFUiIsICJDT0xVTU4i\nLCAiQ09NTUVOVCIsCiAgICAgICAgICAgICJDT01QUkVTUyIsICJDT05ORUNU\nIiwgIkNSRUFURSIsICJDVVJSRU5UIiwgIkRBVEUiLCAiREVDSU1BTCIsCiAg\nICAgICAgICAgICJERUZBVUxUIiwgIkRFTEVURSIsICJERVNDIiwgIkRJU1RJ\nTkNUIiwgIkRST1AiLCAiRUxTRSIsICJFTkQtRVhFQyIsCiAgICAgICAgICAg\nICJFWENMVVNJVkUiLCAiRVhJU1RTIiwgIkZJTEUiLCAiRkxPQVQiLCAiRk9S\nIiwgIkZST00iLCAiR1JBTlQiLAogICAgICAgICAgICAiR1JPVVAiLCAiSEFW\nSU5HIiwgIklERU5USUZJRUQiLCAiSU1NRURJQVRFIiwgIklOIiwgIklOQ1JF\nTUVOVCIsCiAgICAgICAgICAgICJJTkRFWCIsICJJTklUSUFMIiwgIklOU0VS\nVCIsICJJTlRFR0VSIiwgIklOVEVSU0VDVCIsICJJTlRPIiwKICAgICAgICAg\nICAgIklTIiwgIkxFVkVMIiwgIkxJS0UiLCAiTE9DSyIsICJMT05HIiwgIk1B\nWEVYVEVOVFMiLCAiTUlOVVMiLAogICAgICAgICAgICAiTU9ERSIsICJOT0FV\nRElUIiwgIk5PQ09NUFJFU1MiLCAiTk9UIiwgIk5PV0FJVCIsICJOVUxMIiwg\nIk5VTUJFUiIsCiAgICAgICAgICAgICJPRiIsICJPRkZMSU5FIiwgIk9OIiwg\nIk9OTElORSIsICJPUFRJT04iLCAiT1IiLCAiT1JERVIiLCAiUENURlJFRSIs\nCiAgICAgICAgICAgICJQUklPUiIsICJQUklWSUxFR0VTIiwgIlBVQkxJQyIs\nICJSRVZPS0UiLCAiUk9XIiwgIlJPV1MiLCAiU0VMRUNUIiwKICAgICAgICAg\nICAgIlNFU1NJT04iLCAiU0VUIiwgIlNJWkUiLCAiU01BTExJTlQiLCAiVEFC\nTEUiLCAiVEhFTiIsICJUTyIsCiAgICAgICAgICAgICJVTklPTiIsICJVTklR\nVUUiLCAiVVBEQVRFIiwgIlVTRVIiLCAiVkFMVUVTIiwgIlZBUkNIQVIiLCAi\nVklFVyIsCiAgICAgICAgICAgICJXSEVORVZFUiIsICJXSEVSRSIsICJXSVRI\nIiwKICAgICAgICB9KSk7CgogICAgICAgIHN1YnN0cmluZ0Z1bmN0aW9uTmFt\nZSA9ICJTVUJTVFIiOwogICAgICAgIHN1cGVyLnNldEJhdGNoTGltaXQoZGVm\nYXVsdEJhdGNoTGltaXQpOwogICAgICAgIHNlbGVjdFdvcmRTZXQuYWRkKCJX\nSVRIIik7CiAgICAgICAgcmVwb3J0c1N1Y2Nlc3NOb0luZm9PbkJhdGNoVXBk\nYXRlcyA9IHRydWU7CiAgICAgICAgcmVxdWlyZXNTZWFyY2hTdHJpbmdFc2Nh\ncGVGb3JMaWtlID0gZmFsc2U7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBlbmRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHN1cGVy\nLmVuZENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBpZiAodXNlVHJpZ2dlcnNG\nb3JBdXRvQXNzaWduKQogICAgICAgICAgICBzdXBwb3J0c0F1dG9Bc3NpZ24g\nPSB0cnVlOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\nY29ubmVjdGVkQ29uZmlndXJhdGlvbihDb25uZWN0aW9uIGNvbm4pCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuY29ubmVj\ndGVkQ29uZmlndXJhdGlvbihjb25uKTsKICAgICAgICBpZiAoZHJpdmVyVmVu\nZG9yID09IG51bGwpIHsKICAgICAgICAgICAgRGF0YWJhc2VNZXRhRGF0YSBt\nZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgICAgICBTdHJpbmcg\ndXJsID0gKG1ldGEuZ2V0VVJMKCkgPT0gbnVsbCkgPyAiIiA6IG1ldGEuZ2V0\nVVJMKCk7CiAgICAgICAgICAgIFN0cmluZyBkcml2ZXJOYW1lID0gbWV0YS5n\nZXREcml2ZXJOYW1lKCk7CiAgICAgICAgICAgIFN0cmluZyBtZXRhZGF0YUNs\nYXNzTmFtZTsKICAgICAgICAgICAgaWYgKG1ldGEgaW5zdGFuY2VvZiBEZWxl\nZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSkKICAgICAgICAgICAgICAgIG1ldGFk\nYXRhQ2xhc3NOYW1lID0gKChEZWxlZ2F0aW5nRGF0YWJhc2VNZXRhRGF0YSkg\nbWV0YSkuCiAgICAgICAgICAgICAgICAgICAgZ2V0SW5uZXJtb3N0RGVsZWdh\ndGUoKS5nZXRDbGFzcygpLmdldE5hbWUoKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgbWV0YWRhdGFDbGFzc05hbWUgPSBtZXRhLmdldENs\nYXNzKCkuZ2V0TmFtZSgpOwoKICAgICAgICAgICAgLy8gY2hlY2sgYm90aCB0\naGUgZHJpdmVyIGNsYXNzIG5hbWUgYW5kIHRoZSBVUkwgZm9yIGtub3duIHBh\ndHRlcm5zCiAgICAgICAgICAgIGlmIChtZXRhZGF0YUNsYXNzTmFtZS5zdGFy\ndHNXaXRoKCJvcmFjbGUuIikKICAgICAgICAgICAgICAgIHx8IHVybC5pbmRl\neE9mKCJqZGJjOm9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAgfHwg\nIk9yYWNsZSBKREJDIGRyaXZlciIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAg\nICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfT1JBQ0xFICsg\nbWV0YS5nZXREcml2ZXJNYWpvclZlcnNpb24oKQogICAgICAgICAgICAgICAg\nICAgICsgbWV0YS5nZXREcml2ZXJNaW5vclZlcnNpb24oKTsKCiAgICAgICAg\nICAgICAgICBTdHJpbmcgcHJvZHVjdFZlcnNpb24gPSBtZXRhLmdldERhdGFi\nYXNlUHJvZHVjdFZlcnNpb24oKQogICAgICAgICAgICAgICAgICAgIC5zcGxp\ndCgiUmVsZWFzZSAiLDApWzFdLnNwbGl0KCJcXC4iLDApWzBdOwogICAgICAg\nICAgICAgICAgaW50IHJlbGVhc2UgPSBJbnRlZ2VyLnBhcnNlSW50KHByb2R1\nY3RWZXJzaW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAg\nLy8gd2FybiBzcWw5MgogICAgICAgICAgICAgICAgaWYgKHJlbGVhc2UgPD0g\nOCkgewogICAgICAgICAgICAgICAgICAgIGlmIChqb2luU3ludGF4ID09IFNZ\nTlRBWF9TUUw5MiAmJiBsb2cuaXNXYXJuRW5hYmxlZCgpKQogICAgICAgICAg\nICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgib3JhY2xlLXN5bnRh\neCIpKTsKICAgICAgICAgICAgICAgICAgICBqb2luU3ludGF4ID0gU1lOVEFY\nX0RBVEFCQVNFOwogICAgICAgICAgICAgICAgICAgIGRhdGVUeXBlTmFtZSA9\nICJEQVRFIjsgLy8gYWRkZWQgb3JhY2xlIDkKICAgICAgICAgICAgICAgICAg\nICB0aW1lc3RhbXBUeXBlTmFtZSA9ICJEQVRFIjsgLy8gYWRkZWQgb3JhY2xl\nIDkKICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c1hNTENvbHVtbiA9IGZh\nbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8v\nIHNlbGVjdCBvZiBhbiB4bWwgY29sdW1uIHJlcXVpcmVzICIuZ2V0U3RyaW5n\nVmFsKCkiCiAgICAgICAgICAgICAgICAgICAgLy8gc3VmZml4LiBlZy4gdDAu\neG1sY29sLmdldFN0cmluZ1ZhbCgpCiAgICAgICAgICAgICAgICAgICAgZ2V0\nU3RyaW5nVmFsID0gIi5nZXRTdHJpbmdWYWwoKSI7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAobWV0YWRhdGFDbGFzc05hbWUuc3RhcnRzV2l0aCgiY29tLmRk\ndGVrLiIpCiAgICAgICAgICAgICAgICB8fCB1cmwuaW5kZXhPZigiamRiYzpk\nYXRhZGlyZWN0Om9yYWNsZToiKSAhPSAtMQogICAgICAgICAgICAgICAgfHwg\nIk9yYWNsZSIuZXF1YWxzKGRyaXZlck5hbWUpKSB7CiAgICAgICAgICAgICAg\nICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfREFUQURJUkVDVCArIG1ldGEuZ2V0\nRHJpdmVyTWFqb3JWZXJzaW9uKCkKICAgICAgICAgICAgICAgICAgICArIG1l\ndGEuZ2V0RHJpdmVyTWlub3JWZXJzaW9uKCk7CiAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09USEVS\nOwogICAgICAgIH0KICAgICAgICBjYWNoZURyaXZlckJlaGF2aW9yKGRyaXZl\nclZlbmRvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWNoZSBjb25zdGFu\ndCBmb3IgZHJpdmVycyB3aXRoIGJlaGF2aW9ycyB3ZSBoYXZlIHRvIGRlYWwg\nd2l0aC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNhY2hlRHJpdmVyQmVo\nYXZpb3IoU3RyaW5nIGRyaXZlclZlbmRvcikgewogICAgICAgIGlmIChfZHJp\ndmVyQmVoYXZpb3IgIT0gLTEpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgZHJpdmVyVmVuZG9yID0gZHJpdmVyVmVuZG9yLnRvTG93ZXJDYXNlKCk7\nCiAgICAgICAgaWYgKGRyaXZlclZlbmRvci5zdGFydHNXaXRoKFZFTkRPUl9P\nUkFDTEUpKQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3IgPSBCRUhBVkVf\nT1JBQ0xFOwogICAgICAgIGVsc2UgaWYgKGRyaXZlclZlbmRvci5lcXVhbHMo\nVkVORE9SX0RBVEFESVJFQ1QgKyAiMzAiKQogICAgICAgICAgICB8fCBkcml2\nZXJWZW5kb3IuZXF1YWxzKFZFTkRPUl9EQVRBRElSRUNUICsgIjMxIikpCiAg\nICAgICAgICAgIF9kcml2ZXJCZWhhdmlvciA9IEJFSEFWRV9EQVRBRElSRUNU\nMzE7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfZHJpdmVyQmVoYXZpb3Ig\nPSBCRUhBVkVfT1RIRVI7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbnN1cmUg\ndGhhdCB0aGUgZHJpdmVyIHZlbmRvciBoYXMgYmVlbiBzZXQsIGFuZCBpZiBu\nb3QsIHNldCBpdCBub3cuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGVuc3Vy\nZURyaXZlclZlbmRvcigpIHsKICAgICAgICBpZiAoZHJpdmVyVmVuZG9yICE9\nIG51bGwpIHsKICAgICAgICAgICAgY2FjaGVEcml2ZXJCZWhhdmlvcihkcml2\nZXJWZW5kb3IpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBpZiAobG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nLmluZm8oX2xvYy5nZXQoIm9yYWNsZS1jb25uZWN0aW5nLWZvci1kcml2ZXIi\nKSk7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBjb25uID0gY29uZi5nZXREYXRhU291cmNlMihu\ndWxsKS5nZXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIGNvbm5lY3RlZENv\nbmZpZ3VyYXRpb24oY29ubik7CiAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0\naW9uIHNlKSB7CiAgICAgICAgICAgIHRocm93IFNRTEV4Y2VwdGlvbnMuZ2V0\nU3RvcmUoc2UsIHRoaXMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmIChjb25uICE9IG51bGwpCiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyBib29sZWFuIHN1cHBvcnRzTG9ja2luZyhTZWxlY3Qgc2VsKSB7CiAgICAg\nICAgaWYgKCFzdXBlci5zdXBwb3J0c0xvY2tpbmcoc2VsKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiAhcmVxdWlyZXNTdWJz\nZWxlY3RGb3JSYW5nZShzZWwuZ2V0U3RhcnRJbmRleCgpLAogICAgICAgICAg\nICBzZWwuZ2V0RW5kSW5kZXgoKSwgc2VsLmlzRGlzdGluY3QoKSwgc2VsLmdl\ndE9yZGVyaW5nKCkpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVj\ndGVkIFNRTEJ1ZmZlciBnZXRTZWxlY3RzKFNlbGVjdCBzZWwsIGJvb2xlYW4g\nZGlzdGluY3RJZGVudGlmaWVycywKICAgICAgICBib29sZWFuIGZvclVwZGF0\nZSkgewogICAgICAgIC8vIGlmIHJhbmdlIGRvZXNuJ3QgcmVxdWlyZSBhIHN1\nYnNlbGVjdCBjYW4gdXNlIHN1cGVyCiAgICAgICAgaWYgKCFyZXF1aXJlc1N1\nYnNlbGVjdEZvclJhbmdlKHNlbC5nZXRTdGFydEluZGV4KCksCiAgICAgICAg\nICAgIHNlbC5nZXRFbmRJbmRleCgpLCBzZWwuaXNEaXN0aW5jdCgpLCBzZWwu\nZ2V0T3JkZXJpbmcoKSkpCiAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRT\nZWxlY3RzKHNlbCwgZGlzdGluY3RJZGVudGlmaWVycywgZm9yVXBkYXRlKTsK\nCiAgICAgICAgLy8gaWYgdGhlcmUgYXJlIG5vIGpvaW5zIGludm9sdmVkIG9y\nIHdlJ3JlIHVzaW5nIGEgZnJvbSBzZWxlY3Qgc28KICAgICAgICAvLyB0aGF0\nIGFsbCBjb2xzIGFscmVhZHkgaGF2ZSB1bmlxdWUgYWxpYXNlcywgY2FuIHVz\nZSBzdXBlcgogICAgICAgIGlmIChzZWwuZ2V0RnJvbVNlbGVjdCgpICE9IG51\nbGwgfHwgc2VsLmdldFRhYmxlQWxpYXNlcygpLnNpemUoKSA8IDIpCiAgICAg\nICAgICAgIHJldHVybiBzdXBlci5nZXRTZWxlY3RzKHNlbCwgZGlzdGluY3RJ\nZGVudGlmaWVycywgZm9yVXBkYXRlKTsKCiAgICAgICAgLy8gc2luY2Ugbm9u\nZSBvZiB0aGUgY29uZGl0aW9ucyBhYm92ZSB3ZXJlIG1ldCwgd2UncmUgZGVh\nbGluZyB3aXRoCiAgICAgICAgLy8gYSBzZWxlY3QgdGhhdCB1c2VzIGpvaW5z\nIGFuZCByZXF1aXJlcyBzdWJzZWxlY3RzIHRvIHNlbGVjdCB0aGUKICAgICAg\nICAvLyBwcm9wZXIgcmFuZ2U7IGFsaWFzIGFsbCBjb2x1bW4gdmFsdWVzIHNv\nIHRoYXQgdGhleSBhcmUgdW5pcXVlIHdpdGhpbgogICAgICAgIC8vIHRoZSBz\ndWJzZWxlY3QKICAgICAgICBTUUxCdWZmZXIgc2VsZWN0U1FMID0gbmV3IFNR\nTEJ1ZmZlcih0aGlzKTsKICAgICAgICBMaXN0IGFsaWFzZXM7CiAgICAgICAg\naWYgKGRpc3RpbmN0SWRlbnRpZmllcnMpCiAgICAgICAgICAgIGFsaWFzZXMg\nPSBzZWwuZ2V0SWRlbnRpZmllckFsaWFzZXMoKTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGFsaWFzZXMgPSBzZWwuZ2V0U2VsZWN0QWxpYXNlcygpOwoK\nICAgICAgICBPYmplY3QgYWxpYXM7CiAgICAgICAgaW50IGkgPSAwOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gYWxpYXNlcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOyBpKyspIHsKICAgICAgICAgICAgYWxpYXMgPSBpdHIu\nbmV4dCgpOwogICAgICAgICAgICBpZiAoYWxpYXMgaW5zdGFuY2VvZiBTUUxC\ndWZmZXIpCiAgICAgICAgICAgICAgICBzZWxlY3RTUUwuYXBwZW5kKChTUUxC\ndWZmZXIpIGFsaWFzKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgc2VsZWN0U1FMLmFwcGVuZChhbGlhcy50b1N0cmluZygpKTsKICAgICAg\nICAgICAgc2VsZWN0U1FMLmFwcGVuZCgiIEFTIGMiKS5hcHBlbmQoU3RyaW5n\nLnZhbHVlT2YoaSkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkK\nICAgICAgICAgICAgICAgIHNlbGVjdFNRTC5hcHBlbmQoIiwgIik7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBzZWxlY3RTUUw7CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBjYW5PdXRlckpvaW4oaW50IHN5\nbnRheCwgRm9yZWlnbktleSBmaykgewogICAgICAgIGlmICghc3VwZXIuY2Fu\nT3V0ZXJKb2luKHN5bnRheCwgZmspKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgaWYgKGZrICE9IG51bGwgJiYgc3ludGF4ID09IFNZTlRB\nWF9EQVRBQkFTRSkgewogICAgICAgICAgICBpZiAoZmsuZ2V0Q29uc3RhbnRz\nKCkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgaWYgKGZrLmdldFByaW1hcnlLZXlDb25zdGFudHMoKS5s\nZW5ndGggPiAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9OYXRpdmVKb2luKEpvaW4gam9p\nbikgewogICAgICAgIGlmIChqb2luLmdldFR5cGUoKSAhPSBKb2luLlRZUEVf\nT1VURVIpCiAgICAgICAgICAgIHJldHVybiB0b1RyYWRpdGlvbmFsSm9pbihq\nb2luKTsKCiAgICAgICAgRm9yZWlnbktleSBmayA9IGpvaW4uZ2V0Rm9yZWln\nbktleSgpOwogICAgICAgIGlmIChmayA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYm9vbGVhbiBpbnZlcnNlID0gam9pbi5p\nc0ZvcmVpZ25LZXlJbnZlcnNlZCgpOwogICAgICAgIENvbHVtbltdIGZyb20g\nPSAoaW52ZXJzZSkgPyBmay5nZXRQcmltYXJ5S2V5Q29sdW1ucygpCiAgICAg\nICAgICAgIDogZmsuZ2V0Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIHRv\nID0gKGludmVyc2UpID8gZmsuZ2V0Q29sdW1ucygpCiAgICAgICAgICAgIDog\nZmsuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKCiAgICAgICAgLy8gZG8gY29s\ndW1uIGpvaW5zCiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZm\nZXIodGhpcyk7CiAgICAgICAgaW50IGNvdW50ID0gMDsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZyb20ubGVuZ3RoOyBpKyssIGNvdW50KyspIHsK\nICAgICAgICAgICAgaWYgKGNvdW50ID4gMCkKICAgICAgICAgICAgICAgIGJ1\nZi5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoam9p\nbi5nZXRBbGlhczEoKSkuYXBwZW5kKCIuIikuYXBwZW5kKGZyb21baV0pOwog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAgYnVm\nLmFwcGVuZChqb2luLmdldEFsaWFzMigpKS5hcHBlbmQoIi4iKS5hcHBlbmQo\ndG9baV0pOwogICAgICAgICAgICBidWYuYXBwZW5kKCIoKykiKTsKICAgICAg\nICB9CgogICAgICAgIC8vIGNoZWNrIGNvbnN0YW50IGpvaW5zCiAgICAgICAg\naWYgKGZrLmdldENvbnN0YW50Q29sdW1ucygpLmxlbmd0aCA+IDApCiAgICAg\nICAgICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihfbG9jLmdldCgib3Jh\nY2xlLWNvbnN0YW50IiwKICAgICAgICAgICAgICAgIGpvaW4uZ2V0VGFibGUx\nKCksIGpvaW4uZ2V0VGFibGUyKCkpKS5zZXRGYXRhbCh0cnVlKTsKCiAgICAg\nICAgaWYgKGZrLmdldENvbnN0YW50UHJpbWFyeUtleUNvbHVtbnMoKS5sZW5n\ndGggPiAwKQogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\nX2xvYy5nZXQoIm9yYWNsZS1jb25zdGFudCIsCiAgICAgICAgICAgICAgICBq\nb2luLmdldFRhYmxlMSgpLCBqb2luLmdldFRhYmxlMigpKSkuc2V0RmF0YWwo\ndHJ1ZSk7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCBTUUxCdWZmZXIgdG9TZWxlY3QoU1FMQnVmZmVy\nIHNlbGVjdCwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwKICAgICAg\nICBTUUxCdWZmZXIgdGFibGVzLCBTUUxCdWZmZXIgd2hlcmUsIFNRTEJ1ZmZl\nciBncm91cCwKICAgICAgICBTUUxCdWZmZXIgaGF2aW5nLCBTUUxCdWZmZXIg\nb3JkZXIsCiAgICAgICAgYm9vbGVhbiBkaXN0aW5jdCwgYm9vbGVhbiBmb3JV\ncGRhdGUsIGxvbmcgc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIGJvb2xlYW4g\nc3Vic2VsZWN0LCBTZWxlY3Qgc2VsKSB7CiAgICAgICAgcmV0dXJuIHRvU2Vs\nZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hlcmUsIGdyb3VwLCBoYXZp\nbmcsIG9yZGVyLAogICAgICAgICAgICBkaXN0aW5jdCwgZm9yVXBkYXRlLCBz\ndGFydCwgZW5kLCBzZWwpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJv\ndGVjdGVkIFNRTEJ1ZmZlciB0b1NlbGVjdChTUUxCdWZmZXIgc2VsZWN0LCBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAogICAgICAgIFNRTEJ1ZmZl\nciB0YWJsZXMsIFNRTEJ1ZmZlciB3aGVyZSwgU1FMQnVmZmVyIGdyb3VwLAog\nICAgICAgIFNRTEJ1ZmZlciBoYXZpbmcsIFNRTEJ1ZmZlciBvcmRlciwKICAg\nICAgICBib29sZWFuIGRpc3RpbmN0LCBib29sZWFuIGZvclVwZGF0ZSwgbG9u\nZyBzdGFydCwgbG9uZyBlbmQsCiAgICAgICAgU2VsZWN0IHNlbCkgewogICAg\nICAgIGlmICghX2NoZWNrZWRVcGRhdGVCdWcpIHsKICAgICAgICAgICAgZW5z\ndXJlRHJpdmVyVmVuZG9yKCk7CiAgICAgICAgICAgIGlmIChmb3JVcGRhdGUg\nJiYgX2RyaXZlckJlaGF2aW9yID09IEJFSEFWRV9EQVRBRElSRUNUMzEpCiAg\nICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgiZGQtbG9jay1idWci\nKSk7CiAgICAgICAgICAgIF9jaGVja2VkVXBkYXRlQnVnID0gdHJ1ZTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIG5vIHJhbmdlLCB1c2Ugc3RhbmRhcmQg\nc2VsZWN0CiAgICAgICAgaWYgKHN0YXJ0ID09IDAgJiYgZW5kID09IExvbmcu\nTUFYX1ZBTFVFKQogICAgICAgICAgICByZXR1cm4gc3VwZXIudG9TZWxlY3Qo\nc2VsZWN0LCBmZXRjaCwgdGFibGVzLCB3aGVyZSwgZ3JvdXAsIGhhdmluZywK\nICAgICAgICAgICAgICAgIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAw\nLCBMb25nLk1BWF9WQUxVRSwgc2VsKTsKCiAgICAgICAgLy8gaWYgbm8gc2tp\ncCwgb3JkZXJpbmcsIG9yIGRpc3RpbmN0IGNhbiB1c2Ugcm93bnVtIGRpcmVj\ndGx5CiAgICAgICAgU1FMQnVmZmVyIGJ1ZiA9IG5ldyBTUUxCdWZmZXIodGhp\ncyk7CiAgICAgICAgaWYgKCFyZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKHN0\nYXJ0LCBlbmQsIGRpc3RpbmN0LCBvcmRlcikpIHsKICAgICAgICAgICAgaWYg\nKHdoZXJlICE9IG51bGwgJiYgIXdoZXJlLmlzRW1wdHkoKSkKICAgICAgICAg\nICAgICAgIGJ1Zi5hcHBlbmQod2hlcmUpLmFwcGVuZCgiIEFORCAiKTsKICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiUk9XTlVNIDw9ICIpLmFwcGVuZFZhbHVl\nKGVuZCk7CiAgICAgICAgICAgIHJldHVybiBzdXBlci50b1NlbGVjdChzZWxl\nY3QsIGZldGNoLCB0YWJsZXMsIGJ1ZiwgZ3JvdXAsIGhhdmluZywKICAgICAg\nICAgICAgICAgIG9yZGVyLCBkaXN0aW5jdCwgZm9yVXBkYXRlLCAwLCBMb25n\nLk1BWF9WQUxVRSwgc2VsKTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRo\nZXJlIGlzIG9yZGVyaW5nLCBza2lwLCBvciBkaXN0aW5jdCB3ZSBoYXZlIHRv\nIHVzZSBzdWJzZWxlY3RzCiAgICAgICAgU1FMQnVmZmVyIG5ld3NlbCA9IHN1\ncGVyLnRvU2VsZWN0KHNlbGVjdCwgZmV0Y2gsIHRhYmxlcywgd2hlcmUsCiAg\nICAgICAgICAgIGdyb3VwLCBoYXZpbmcsIG9yZGVyLCBkaXN0aW5jdCwgZm9y\nVXBkYXRlLCAwLCBMb25nLk1BWF9WQUxVRSwKICAgICAgICAgICAgc2VsKTsK\nCiAgICAgICAgLy8gaWYgbm8gc2tpcCwgY2FuIHVzZSBzaW5nbGUgbmVzdGVk\nIHN1YnNlbGVjdAogICAgICAgIGlmIChzdGFydCA9PSAwKSB7CiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoZ2V0U2VsZWN0T3BlcmF0aW9uKGZldGNoKSArICIg\nKiBGUk9NICgiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZChuZXdzZWwpOwog\nICAgICAgICAgICBidWYuYXBwZW5kKCIpIFdIRVJFIFJPV05VTSA8PSAiKS5h\ncHBlbmRWYWx1ZShlbmQpOwogICAgICAgICAgICByZXR1cm4gYnVmOwogICAg\nICAgIH0KCiAgICAgICAgLy8gd2l0aCBhIHNraXAsIHdlIGhhdmUgdG8gdXNl\nIGEgZG91YmxlLW5lc3RlZCBzdWJzZWxlY3QgdG8gcHV0CiAgICAgICAgLy8g\nd2hlcmUgY29uZGl0aW9ucyBvbiB0aGUgcm93bnVtCiAgICAgICAgYnVmLmFw\ncGVuZChnZXRTZWxlY3RPcGVyYXRpb24oZmV0Y2gpCiAgICAgICAgICAgICsg\nIiAqIEZST00gKFNFTEVDVCByLiosIFJPV05VTSBSTlVNIEZST00gKCIpOwog\nICAgICAgIGJ1Zi5hcHBlbmQobmV3c2VsKTsKICAgICAgICBidWYuYXBwZW5k\nKCIpIHIiKTsKICAgICAgICBpZiAoZW5kICE9IExvbmcuTUFYX1ZBTFVFKQog\nICAgICAgICAgICBidWYuYXBwZW5kKCIgV0hFUkUgUk9XTlVNIDw9ICIpLmFw\ncGVuZFZhbHVlKGVuZCk7CiAgICAgICAgYnVmLmFwcGVuZCgiKSBXSEVSRSBS\nTlVNID4gIikuYXBwZW5kVmFsdWUoc3RhcnQpOwogICAgICAgIHJldHVybiBi\ndWY7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUg\nc2VsZWN0IHdpdGggdGhlIGdpdmVuIHBhcmFtZXRlcnMgbmVlZHMgYQogICAg\nICogc3Vic2VsZWN0IHRvIGFwcGx5IGEgcmFuZ2UuCiAgICAgKi8KICAgIHBy\naXZhdGUgYm9vbGVhbiByZXF1aXJlc1N1YnNlbGVjdEZvclJhbmdlKGxvbmcg\nc3RhcnQsIGxvbmcgZW5kLAogICAgICAgIGJvb2xlYW4gZGlzdGluY3QsIFNR\nTEJ1ZmZlciBvcmRlcikgewogICAgICAgIGlmIChzdGFydCA9PSAwICYmIGVu\nZCA9PSBMb25nLk1BWF9WQUxVRSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIHJldHVybiBzdGFydCAhPSAwIHx8IGRpc3RpbmN0IHx8IChv\ncmRlciAhPSBudWxsICYmICFvcmRlci5pc0VtcHR5KCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2hlY2sgdG8gc2VlIGlmIHdlIGhhdmUgc2V0IHRoZSB7\nQGxpbmsgI1NFTEVDVF9ISU5UfSBpbiB0aGUKICAgICAqIGZldGNoIGNvbmZp\nZ3VyYWl0b24sIGFuZCBpZiBzbywgYXBwZW5kIHRoZSBPcmFjaGUgaGludCBh\nZnRlciB0aGUKICAgICAqICJTRUxFQ1QiIHBhcnQgb2YgdGhlIHF1ZXJ5Lgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldFNlbGVjdE9wZXJhdGlvbihK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgT2JqZWN0\nIGhpbnQgPSBmZXRjaCA9PSBudWxsID8gbnVsbCA6IGZldGNoLmdldEhpbnQo\nU0VMRUNUX0hJTlQpOwogICAgICAgIFN0cmluZyBzZWxlY3QgPSAiU0VMRUNU\nIjsKICAgICAgICBpZiAoaGludCAhPSBudWxsKQogICAgICAgICAgICBzZWxl\nY3QgKz0gIiAiICsgaGludDsKICAgICAgICByZXR1cm4gc2VsZWN0OwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldFN0cmluZyhQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCwgaW50IGlkeCwgU3RyaW5nIHZhbCwKICAgICAgICBDb2x1bW4g\nY29sKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIC8v\nIG9yYWNsZSBOQ0hBUi9OVkFSQ0hBUi9OQ0xPQiB1bmljb2RlIGNvbHVtbnMg\ncmVxdWlyZSBzb21lCiAgICAgICAgLy8gc3BlY2lhbCBoYW5kbGluZyB0byBj\nb25maWd1cmUgdGhlbSBjb3JyZWN0bHk7IHNlZToKICAgICAgICAvLyBodHRw\nOi8vd3d3Lm9yYWNsZS5jb20vdGVjaG5vbG9neS9zYW1wbGVfY29kZS90ZWNo\nL2phdmEvCiAgICAgICAgLy8gc3Fsal9qZGJjL2ZpbGVzLzlpX2pkYmMvTkNI\nQVJzdXBwb3J0NFVuaWNvZGVTYW1wbGUvUmVhZG1lLmh0bWwKICAgICAgICBT\ndHJpbmcgdHlwZU5hbWUgPSAoY29sID09IG51bGwpID8gbnVsbCA6IGNvbC5n\nZXRUeXBlSWRlbnRpZmllcigpLmdldE5hbWUoKTsKICAgICAgICBpZiAodXNl\nU2V0Rm9ybU9mVXNlRm9yVW5pY29kZSAmJiB0eXBlTmFtZSAhPSBudWxsICYm\nCiAgICAgICAgICAgICh0eXBlTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dp\ndGgoIm52YXJjaGFyIikgfHwKICAgICAgICAgICAgICAgIHR5cGVOYW1lLnRv\nTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgibmNoYXIiKSB8fAogICAgICAgICAg\nICAgICAgdHlwZU5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCJuY2xv\nYiIpKSkgewogICAgICAgICAgICBTdGF0ZW1lbnQgaW5uZXIgPSBzdG1udDsK\nICAgICAgICAgICAgaWYgKGlubmVyIGluc3RhbmNlb2YgRGVsZWdhdGluZ1By\nZXBhcmVkU3RhdGVtZW50KQogICAgICAgICAgICAgICAgaW5uZXIgPSAoKERl\nbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCkgaW5uZXIpLgogICAgICAgICAg\nICAgICAgICAgIGdldElubmVybW9zdERlbGVnYXRlKCk7CiAgICAgICAgICAg\nIGlmIChpc09yYWNsZVByZXBhcmVkU3RhdGVtZW50KGlubmVyKSkgewogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpbm5lci5n\nZXRDbGFzcygpLmdldE1ldGhvZCgic2V0Rm9ybU9mVXNlIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFzcywgc2hvcnQu\nY2xhc3MgfSkuCiAgICAgICAgICAgICAgICAgICAgICAgIGludm9rZShpbm5l\nciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSW50ZWdlcihp\nZHgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmZv\nck5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJv\ncmFjbGUuamRiYy5PcmFjbGVQcmVwYXJlZFN0YXRlbWVudCIpLgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZCgiRk9STV9O\nQ0hBUiIpLmdldChudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKGUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCFfd2FybmVkTmNoYXJDb2x1\nbW4gJiYgbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nX3dhcm5lZE5jaGFyQ29sdW1uID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxv\nZy53YXJuKF9sb2MuZ2V0KCJ1bmNvbmZpZ3VyZWQtbmNoYXItY29scyIpKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY2FsbCBzZXRG\naXhlZENIQVIgZm9yIGZpeGVkIHdpZHRoIGNoYXJhY3RlciBjb2x1bW5zIHRv\nIGdldCBwYWRkaW5nCiAgICAgICAgLy8gc2VtYW50aWNzCiAgICAgICAgaWYg\nKGNvbCAhPSBudWxsICYmIGNvbC5nZXRUeXBlKCkgPT0gVHlwZXMuQ0hBUgog\nICAgICAgICAgICAmJiB2YWwgIT0gbnVsbCAmJiB2YWwubGVuZ3RoKCkgIT0g\nY29sLmdldFNpemUoKSkgewogICAgICAgICAgICBTdGF0ZW1lbnQgaW5uZXIg\nPSBzdG1udDsKICAgICAgICAgICAgaWYgKGlubmVyIGluc3RhbmNlb2YgRGVs\nZWdhdGluZ1ByZXBhcmVkU3RhdGVtZW50KQogICAgICAgICAgICAgICAgaW5u\nZXIgPSAoKERlbGVnYXRpbmdQcmVwYXJlZFN0YXRlbWVudCkgaW5uZXIpLgog\nICAgICAgICAgICAgICAgICAgIGdldElubmVybW9zdERlbGVnYXRlKCk7CiAg\nICAgICAgICAgIGlmIChpc09yYWNsZVByZXBhcmVkU3RhdGVtZW50KGlubmVy\nKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBpbm5lci5nZXRDbGFzcygpLmdldE1ldGhvZCgic2V0Rml4ZWRDSEFSIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFz\ncywgU3RyaW5nLmNsYXNzIH0pLgogICAgICAgICAgICAgICAgICAgICAgICBp\nbnZva2UoaW5uZXIsIG5ldyBPYmplY3RbXXsgbmV3IEludGVnZXIoaWR4KSwg\ndmFsIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nLndhcm4oZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmICghX3dhcm5lZENoYXJDb2x1bW4gJiYg\nbG9nLmlzV2FybkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgX3dhcm5l\nZENoYXJDb2x1bW4gPSB0cnVlOwogICAgICAgICAgICAgICAgbG9nLndhcm4o\nX2xvYy5nZXQoInVucGFkZGVkLWNoYXItY29scyIpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBzdXBlci5zZXRTdHJpbmcoc3RtbnQsIGlk\neCwgdmFsLCBjb2wpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgc2V0TnVsbChQcmVwYXJlZFN0YXRlbWVudCBzdG1udCwgaW50IGlk\neCwgaW50IGNvbFR5cGUsCiAgICAgICAgQ29sdW1uIGNvbCkKICAgICAgICB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoKGNvbFR5cGUgPT0g\nVHlwZXMuQ0xPQiB8fCBjb2xUeXBlID09IFR5cGVzLkJMT0IpICYmIGNvbC5p\nc05vdE51bGwoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24oX2xvYy5nZXQoIm51bGwtYmxvYi1pbi1ub3QtbnVsbGFibGUiLCB0b0RC\nTmFtZShjb2wKICAgICAgICAgICAgICAgIC5nZXRGdWxsREJJZGVudGlmaWVy\nKCkpKSk7CiAgICAgICAgaWYgKGNvbFR5cGUgPT0gVHlwZXMuQkxPQiAmJiBf\nZHJpdmVyQmVoYXZpb3IgPT0gQkVIQVZFX09SQUNMRSkKICAgICAgICAgICAg\nc3RtbnQuc2V0QmxvYihpZHgsIGdldEVtcHR5QmxvYigpKTsKICAgICAgICBl\nbHNlIGlmIChjb2xUeXBlID09IFR5cGVzLkNMT0IgJiYgX2RyaXZlckJlaGF2\naW9yID09IEJFSEFWRV9PUkFDTEUKICAgICAgICAgICAgJiYgIWNvbC5pc1hN\nTCgpKQogICAgICAgICAgICBzdG1udC5zZXRDbG9iKGlkeCwgZ2V0RW1wdHlD\nbG9iKCkpOwogICAgICAgIGVsc2UgaWYgKChjb2xUeXBlID09IFR5cGVzLlNU\nUlVDVCB8fCBjb2xUeXBlID09IFR5cGVzLk9USEVSKQogICAgICAgICAgICAm\nJiBjb2wgIT0gbnVsbCAmJiAhREJJZGVudGlmaWVyLmlzTnVsbChjb2wuZ2V0\nVHlwZUlkZW50aWZpZXIoKSkpCiAgICAgICAgICAgIHN0bW50LnNldE51bGwo\naWR4LCBUeXBlcy5TVFJVQ1QsIGNvbC5nZXRUeXBlSWRlbnRpZmllcigpLmdl\ndE5hbWUoKSk7CiAgICAgICAgICAgIC8vIHNvbWUgdmVyc2lvbnMgb2YgdGhl\nIE9yYWNsZSBKREJDIGRyaXZlciB3aWxsIGZhaWwgaWYgY2FsbGluZwogICAg\nICAgICAgICAvLyBzZXROdWxsIHdpdGggREFURTsgc2VlIGJ1ZyAjMTE3MQog\nICAgICAgIGVsc2UgaWYgKGNvbFR5cGUgPT0gVHlwZXMuREFURSkKICAgICAg\nICAgICAgc3VwZXIuc2V0TnVsbChzdG1udCwgaWR4LCBUeXBlcy5USU1FU1RB\nTVAsIGNvbCk7CiAgICAgICAgLy8gdGhlIE9yYWNsZSBkcml2ZXIgZG9lcyBu\nb3Qgc3VwcG9ydCBUeXBlcy5PVEhFUiB3aXRoIHNldE51bGwKICAgICAgICBl\nbHNlIGlmIChjb2xUeXBlID09IFR5cGVzLk9USEVSIHx8IGNvbC5pc1hNTCgp\nKQogICAgICAgICAgICBzdXBlci5zZXROdWxsKHN0bW50LCBpZHgsIFR5cGVz\nLk5VTEwsIGNvbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdXBlci5z\nZXROdWxsKHN0bW50LCBpZHgsIGNvbFR5cGUsIGNvbCk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgU3RyaW5nIGdldENsb2JTdHJpbmcoUmVz\ndWx0U2V0IHJzLCBpbnQgY29sdW1uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChfZHJpdmVyQmVoYXZpb3IgIT0gQkVIQVZF\nX09SQUNMRSkKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENsb2JTdHJp\nbmcocnMsIGNvbHVtbik7CgogICAgICAgIENsb2IgY2xvYiA9IGdldENsb2Io\ncnMsIGNvbHVtbik7CiAgICAgICAgaWYgKGNsb2IgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGNsb2IuZ2V0Q2xhc3Mo\nKS5nZXROYW1lKCkuZXF1YWxzKCJvcmFjbGUuc3FsLkNMT0IiKSkgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKCgoQm9vbGVhbikg\nQ2xhc3MuZm9yTmFtZSgib3JhY2xlLnNxbC5DTE9CIikuCiAgICAgICAgICAg\nICAgICAgICAgZ2V0TWV0aG9kKCJpc0VtcHR5TG9iIiwgbmV3IENsYXNzWzBd\nKS4KICAgICAgICAgICAgICAgICAgICBpbnZva2UoY2xvYiwgbmV3IE9iamVj\ndFswXSkpLgogICAgICAgICAgICAgICAgICAgIGJvb2xlYW5WYWx1ZSgpKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgLy8gcG9z\nc2libHkgZGlmZmVyZW50IHZlcnNpb24gb2YgdGhlIGRyaXZlcgogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjbG9iLmxlbmd0aCgpID09\nIDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAvLyB1bmxp\na2VseSB0aGF0IHdlJ2xsIGhhdmUgc3RyaW5ncyBvdmVyIDQgYmlsbGlvbiBj\naGFycwogICAgICAgIHJldHVybiBjbG9iLmdldFN1YlN0cmluZygxLCAoaW50\nKSBjbG9iLmxlbmd0aCgpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyBUaW1lc3RhbXAgZ2V0VGltZXN0YW1wKFJlc3VsdFNldCBycywgaW50\nIGNvbHVtbiwgQ2FsZW5kYXIgY2FsKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIGlmIChjYWwgPT0gbnVsbCkgewogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFRpbWVz\ndGFtcChycywgY29sdW1uLCBjYWwpOwogICAgICAgICAgICB9IGNhdGNoIChB\ncnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gYWUpIHsKICAgICAgICAg\nICAgICAgIC8vIENSMjk1NjA0OiBpc3N1ZSBhIHdhcm5pbmcgdGhpcyB0aGlz\nIGJ1ZyBjYW4gYmUgZ290dGVuCiAgICAgICAgICAgICAgICAvLyBhcm91bmQg\nd2l0aCBTdXBwb3J0c1RpbWVzdGFtcE5hbm9zPWZhbHNlCiAgICAgICAgICAg\nICAgICBsb2cud2FybihfbG9jLmdldCgib3JhY2xlLXRpbWVzdGFtcC1idWci\nKSwgYWUpOwogICAgICAgICAgICAgICAgdGhyb3cgYWU7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIGhhbmRsZSBPcmFjbGUgYnVnIHdo\nZXJlIG5hbm9zIG5vdCByZXR1cm5lZCBmcm9tIGNhbGwgd2l0aCBDYWxlbmRh\ncgogICAgICAgIC8vIHBhcmFtZXRlcgogICAgICAgIFRpbWVzdGFtcCB0cyA9\nIHJzLmdldFRpbWVzdGFtcChjb2x1bW4sIGNhbCk7CiAgICAgICAgaWYgKHRz\nICE9IG51bGwgJiYgdHMuZ2V0TmFub3MoKSA9PSAwKQogICAgICAgICAgICB0\ncy5zZXROYW5vcyhycy5nZXRUaW1lc3RhbXAoY29sdW1uKS5nZXROYW5vcygp\nKTsKICAgICAgICByZXR1cm4gdHM7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgT2JqZWN0IGdldE9iamVjdChSZXN1bHRTZXQgcnMsIGludCBj\nb2x1bW4sIE1hcCBtYXApCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gcmVjZW50IG9yYWNsZSBkcml2ZXJzIHJldHVybiBvcmFj\nbGUtc3BlY2lmaWMgdHlwZXMgZm9yIHRpbWVzdGFtcHMKICAgICAgICAvLyBh\nbmQgZGF0ZXMKICAgICAgICBPYmplY3Qgb2JqID0gc3VwZXIuZ2V0T2JqZWN0\nKHJzLCBjb2x1bW4sIG1hcCk7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoIm9yYWNsZS5z\ncWwuREFURSIuZXF1YWxzKG9iai5nZXRDbGFzcygpLmdldE5hbWUoKSkpCiAg\nICAgICAgICAgIG9iaiA9IGNvbnZlcnRGcm9tT3JhY2xlVHlwZShvYmosICJk\nYXRlVmFsdWUiKTsKICAgICAgICBlbHNlIGlmICgib3JhY2xlLnNxbC5USU1F\nU1RBTVAiLmVxdWFscyhvYmouZ2V0Q2xhc3MoKS5nZXROYW1lKCkpKQogICAg\nICAgICAgICBvYmogPSBjb252ZXJ0RnJvbU9yYWNsZVR5cGUob2JqLCAidGlt\nZXN0YW1wVmFsdWUiKTsKICAgICAgICByZXR1cm4gb2JqOwogICAgfQoKICAg\nIC8qKgogICAgICogQ29udmVydCBhbiBvYmplY3QgZnJvbSBpdHMgcHJvcHJp\nZXRhcnkgT3JhY2xlIHR5cGUgdG8gdGhlIHN0YW5kYXJkCiAgICAgKiBKYXZh\nIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBjb252\nZXJ0RnJvbU9yYWNsZVR5cGUoT2JqZWN0IG9iaiwKICAgICAgICBTdHJpbmcg\nY29udmVydE1ldGhvZCkKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBNZXRob2QgbSA9IG9iai5nZXRD\nbGFzcygpLmdldE1ldGhvZChjb252ZXJ0TWV0aG9kLCAoQ2xhc3NbXSkgbnVs\nbCk7CiAgICAgICAgICAgIHJldHVybiBtLmludm9rZShvYmosIChPYmplY3Rb\nXSkgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAg\nICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBJbnZvY2F0aW9uVGFyZ2V0RXhj\nZXB0aW9uKQogICAgICAgICAgICAgICAgdCA9ICgoSW52b2NhdGlvblRhcmdl\ndEV4Y2VwdGlvbikgdCkuZ2V0VGFyZ2V0RXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9uKQogICAgICAgICAg\nICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAgICAgICAgICB0aHJv\ndyBuZXcgU1FMRXhjZXB0aW9uKHQuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVtbnMoRGF0YWJh\nc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAgICBTdHJp\nbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgU3RyaW5nIGNvbHVt\nbk5hbWUsIENvbm5lY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1ucyhtZXRhLCAKICAg\nICAgICAgICAgREJJZGVudGlmaWVyLm5ld0NhdGFsb2coY2F0YWxvZyksIAog\nICAgICAgICAgICBEQklkZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUp\nLCAKICAgICAgICAgICAgREJJZGVudGlmaWVyLm5ld1RhYmxlKHRhYmxlTmFt\nZSksIAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3Q29sdW1uKGNvbHVt\nbk5hbWUpLGNvbm4pOwogICAgfQoKICAgIHB1YmxpYyBDb2x1bW5bXSBnZXRD\nb2x1bW5zKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgREJJZGVudGlmaWVyIGNh\ndGFsb2csCiAgICAgICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRl\nbnRpZmllciB0YWJsZU5hbWUsIERCSWRlbnRpZmllciBjb2x1bW5OYW1lLCBD\nb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7\nCiAgICAgICAgQ29sdW1uW10gY29scyA9IHN1cGVyLmdldENvbHVtbnMobWV0\nYSwgY2F0YWxvZywgc2NoZW1hTmFtZSwgdGFibGVOYW1lLAogICAgICAgICAg\nICBjb2x1bW5OYW1lLCBjb25uKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGNvbHMgIT0gbnVsbCAmJiBpIDwgY29scy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBTdHJpbmcgdHlwZU5hbWUgPSBjb2xzW2ldLmdldFR5cGVJZGVu\ndGlmaWVyKCkuZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAodHlwZU5hbWUg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICBpZiAodHlwZU5hbWUudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCJUSU1F\nU1RBTVAiKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBl\ncy5USU1FU1RBTVApOwogICAgICAgICAgICBlbHNlIGlmICgiQkxPQiIuZXF1\nYWxzSWdub3JlQ2FzZSh0eXBlTmFtZSkpCiAgICAgICAgICAgICAgICBjb2xz\nW2ldLnNldFR5cGUoVHlwZXMuQkxPQik7CiAgICAgICAgICAgIGVsc2UgaWYg\nKCJDTE9CIi5lcXVhbHNJZ25vcmVDYXNlKHR5cGVOYW1lKQogICAgICAgICAg\nICAgICAgfHwgIk5DTE9CIi5lcXVhbHNJZ25vcmVDYXNlKHR5cGVOYW1lKSkK\nICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5DTE9CKTsK\nICAgICAgICAgICAgZWxzZSBpZiAoIkZMT0FUIi5lcXVhbHNJZ25vcmVDYXNl\nKHR5cGVOYW1lKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShU\neXBlcy5GTE9BVCk7CiAgICAgICAgICAgIGVsc2UgaWYgKCJOVkFSQ0hBUiIu\nZXF1YWxzSWdub3JlQ2FzZSh0eXBlTmFtZSkpCiAgICAgICAgICAgICAgICBj\nb2xzW2ldLnNldFR5cGUoVHlwZXMuVkFSQ0hBUik7CiAgICAgICAgICAgIGVs\nc2UgaWYgKCJOQ0hBUiIuZXF1YWxzSWdub3JlQ2FzZSh0eXBlTmFtZSkpCiAg\nICAgICAgICAgICAgICBjb2xzW2ldLnNldFR5cGUoVHlwZXMuQ0hBUik7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBjb2xzOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIFByaW1hcnlLZXlbXSBnZXRQcmltYXJ5S2V5cyhE\nYXRhYmFzZU1ldGFEYXRhIG1ldGEsCiAgICAgICAgU3RyaW5nIGNhdGFsb2cs\nIFN0cmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0\naW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIGdldFByaW1hcnlLZXlzKG1ldGEsCiAgICAgICAgICAgIERC\nSWRlbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLCAKICAgICAgICAgICAg\nREJJZGVudGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgCiAgICAgICAg\nICAgIERCSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCBjb25uKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBQcmltYXJ5S2V5W10g\nZ2V0UHJpbWFyeUtleXMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLAogICAgICAg\nIERCSWRlbnRpZmllciBjYXRhbG9nLCBEQklkZW50aWZpZXIgc2NoZW1hTmFt\nZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgQ29ubmVjdGlvbiBjb25uKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFN0cmluZ0J1\naWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBidWYu\nYXBwZW5kKCJTRUxFQ1QgdDAuT1dORVIgQVMgVEFCTEVfU0NIRU0sICIpLgog\nICAgICAgICAgICBhcHBlbmQoInQwLlRBQkxFX05BTUUgQVMgVEFCTEVfTkFN\nRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09MVU1OX05BTUUgQVMg\nQ09MVU1OX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoInQwLkNPTlNU\nUkFJTlRfTkFNRSBBUyBQS19OQU1FICIpLgogICAgICAgICAgICBhcHBlbmQo\nIkZST00gQUxMX0NPTlNfQ09MVU1OUyB0MCwgQUxMX0NPTlNUUkFJTlRTIHQx\nICIpLgogICAgICAgICAgICBhcHBlbmQoIldIRVJFIHQwLk9XTkVSID0gdDEu\nT1dORVIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQwLkNPTlNUUkFJ\nTlRfTkFNRSA9IHQxLkNPTlNUUkFJTlRfTkFNRSAiKS4KICAgICAgICAgICAg\nYXBwZW5kKCJBTkQgdDEuQ09OU1RSQUlOVF9UWVBFID0gJ1AnIik7CiAgICAg\nICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHNjaGVtYU5hbWUpKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLk9XTkVSID0gPyIpOwogICAg\nICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbCh0YWJsZU5hbWUpKQogICAg\nICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxFX05BTUUgPSA/Iik7\nCgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0gY29ubi5wcmVw\nYXJlU3RhdGVtZW50KGJ1Zi50b1N0cmluZygpKTsKICAgICAgICBSZXN1bHRT\nZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBp\nZHggPSAxOwogICAgICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwo\nc2NoZW1hTmFtZSkpCiAgICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQs\nIGlkeCsrLCBjb252ZXJ0U2NoZW1hQ2FzZShzY2hlbWFOYW1lKSwgbnVsbCk7\nCiAgICAgICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbCh0YWJsZU5h\nbWUpKQogICAgICAgICAgICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgrKywg\nY29udmVydFNjaGVtYUNhc2UodGFibGVOYW1lKSwgbnVsbCk7CiAgICAgICAg\nICAgIHNldFRpbWVvdXRzKHN0bW50LCBjb25mLCBmYWxzZSk7CiAgICAgICAg\nICAgIHJzID0gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExp\nc3QgcGtMaXN0ID0gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICB3aGls\nZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpCiAgICAgICAgICAgICAgICBw\na0xpc3QuYWRkKG5ld1ByaW1hcnlLZXkocnMpKTsKICAgICAgICAgICAgcmV0\ndXJuIChQcmltYXJ5S2V5W10pIHBrTGlzdC50b0FycmF5CiAgICAgICAgICAg\nICAgICAobmV3IFByaW1hcnlLZXlbcGtMaXN0LnNpemUoKV0pOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgSW5kZXhbXSBnZXRJbmRleEluZm8o\nRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBTdHJpbmcgY2F0YWxvZywKICAgICAg\nICBTdHJpbmcgc2NoZW1hTmFtZSwgU3RyaW5nIHRhYmxlTmFtZSwgYm9vbGVh\nbiB1bmlxdWUsIGJvb2xlYW4gYXBwcm94LAogICAgICAgIENvbm5lY3Rpb24g\nY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gZ2V0SW5kZXhJbmZvKG1ldGEsCiAgICAgICAgICAgIERCSWRlbnRp\nZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLCAKICAgICAgICAgICAgREJJZGVu\ndGlmaWVyLm5ld1NjaGVtYShzY2hlbWFOYW1lKSwgCiAgICAgICAgICAgIERC\nSWRlbnRpZmllci5uZXdUYWJsZSh0YWJsZU5hbWUpLCB1bmlxdWUsIGFwcHJv\neCwgY29ubik7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgSW5k\nZXhbXSBnZXRJbmRleEluZm8oRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBEQklk\nZW50aWZpZXIgY2F0YWxvZywKICAgICAgICBEQklkZW50aWZpZXIgc2NoZW1h\nTmFtZSwgREJJZGVudGlmaWVyIHRhYmxlTmFtZSwgYm9vbGVhbiB1bmlxdWUs\nIGJvb2xlYW4gYXBwcm94LAogICAgICAgIENvbm5lY3Rpb24gY29ubikKICAg\nICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdCdWls\nZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgYnVmLmFw\ncGVuZCgiU0VMRUNUIHQwLklOREVYX09XTkVSIEFTIFRBQkxFX1NDSEVNLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJMRV9OQU1FIEFTIFRBQkxF\nX05BTUUsICIpLgogICAgICAgICAgICBhcHBlbmQoIkRFQ09ERSh0MS5VTklR\nVUVORVNTLCAnVU5JUVVFJywgMCwgJ05PTlVOSVFVRScsIDEpICIpLgogICAg\nICAgICAgICBhcHBlbmQoIkFTIE5PTl9VTklRVUUsICIpLgogICAgICAgICAg\nICBhcHBlbmQoInQwLklOREVYX05BTUUgQVMgSU5ERVhfTkFNRSwgIikuCiAg\nICAgICAgICAgIGFwcGVuZCgidDAuQ09MVU1OX05BTUUgQVMgQ09MVU1OX05B\nTUUgIikuCiAgICAgICAgICAgIGFwcGVuZCgiRlJPTSBBTExfSU5EX0NPTFVN\nTlMgdDAsIEFMTF9JTkRFWEVTIHQxICIpLgogICAgICAgICAgICBhcHBlbmQo\nIldIRVJFIHQwLklOREVYX09XTkVSID0gdDEuT1dORVIgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiQU5EIHQwLklOREVYX05BTUUgPSB0MS5JTkRFWF9OQU1F\nIik7CiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHNjaGVtYU5h\nbWUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLlRBQkxFX09X\nTkVSID0gPyIpOwogICAgICAgIGlmICghREJJZGVudGlmaWVyLmlzTnVsbCh0\nYWJsZU5hbWUpKQogICAgICAgICAgICBidWYuYXBwZW5kKCIgQU5EIHQwLlRB\nQkxFX05BTUUgPSA/Iik7CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0\nbW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KGJ1Zi50b1N0cmluZygpKTsK\nICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGludCBpZHggPSAxOwogICAgICAgICAgICBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpCiAgICAgICAgICAgICAgICBz\nZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBjb252ZXJ0U2NoZW1hQ2FzZShzY2hl\nbWFOYW1lKSwgbnVsbCk7CiAgICAgICAgICAgIGlmICghREJJZGVudGlmaWVy\nLmlzTnVsbCh0YWJsZU5hbWUpKQogICAgICAgICAgICAgICAgc2V0U3RyaW5n\nKHN0bW50LCBpZHgrKywgY29udmVydFNjaGVtYUNhc2UodGFibGVOYW1lKSwg\nbnVsbCk7CgogICAgICAgICAgICBzZXRUaW1lb3V0cyhzdG1udCwgY29uZiwg\nZmFsc2UpOwogICAgICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgp\nOwogICAgICAgICAgICBMaXN0IGlkeExpc3QgPSBuZXcgQXJyYXlMaXN0KCk7\nCiAgICAgICAgICAgIHdoaWxlIChycyAhPSBudWxsICYmIHJzLm5leHQoKSkK\nICAgICAgICAgICAgICAgIGlkeExpc3QuYWRkKG5ld0luZGV4KHJzKSk7CiAg\nICAgICAgICAgIHJldHVybiAoSW5kZXhbXSkgaWR4TGlzdC50b0FycmF5KG5l\ndyBJbmRleFtpZHhMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0bW50\nLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgRm9yZWlnbktleVtdIGdldEltcG9ydGVkS2V5cyhEYXRh\nYmFzZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0\ncmluZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBDb25uZWN0aW9u\nIGNvbm4sIGJvb2xlYW4gcGFydGlhbEtleXMpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldEltcG9ydGVkS2V5cyht\nZXRhLAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3Q2F0YWxvZyhjYXRh\nbG9nKSwgCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdTY2hlbWEoc2No\nZW1hTmFtZSksIAogICAgICAgICAgICBEQklkZW50aWZpZXIubmV3VGFibGUo\ndGFibGVOYW1lKSwgY29ubiwgcGFydGlhbEtleXMpOwogICAgfQogICAgCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBGb3JlaWduS2V5W10gZ2V0SW1wb3J0\nZWRLZXlzKERhdGFiYXNlTWV0YURhdGEgbWV0YSwgREJJZGVudGlmaWVyIGNh\ndGFsb2csCiAgICAgICAgREJJZGVudGlmaWVyIHNjaGVtYU5hbWUsIERCSWRl\nbnRpZmllciB0YWJsZU5hbWUsIENvbm5lY3Rpb24gY29ubiwgYm9vbGVhbiBw\nYXJ0aWFsS2V5cykKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBTdHJpbmdCdWlsZGVyIGRlbEFjdGlvbiA9IG5ldyBTdHJpbmdCdWls\nZGVyKCJERUNPREUodDEuREVMRVRFX1JVTEUiKS4KICAgICAgICAgICAgYXBw\nZW5kKCIsICdOTyBBQ1RJT04nLCAiKS5hcHBlbmQobWV0YS5pbXBvcnRlZEtl\neU5vQWN0aW9uKS4KICAgICAgICAgICAgYXBwZW5kKCIsICdSRVNUUklDVCcs\nICIpLmFwcGVuZChtZXRhLmltcG9ydGVkS2V5UmVzdHJpY3QpLgogICAgICAg\nICAgICBhcHBlbmQoIiwgJ0NBU0NBREUnLCAiKS5hcHBlbmQobWV0YS5pbXBv\ncnRlZEtleUNhc2NhZGUpLgogICAgICAgICAgICBhcHBlbmQoIiwgJ1NFVCBO\nVUxMJywgIikuYXBwZW5kKG1ldGEuaW1wb3J0ZWRLZXlTZXROdWxsKS4KICAg\nICAgICAgICAgYXBwZW5kKCIsICdTRVQgREVGQVVMVCcsICIpLmFwcGVuZCht\nZXRhLmltcG9ydGVkS2V5U2V0RGVmYXVsdCkuCiAgICAgICAgICAgIGFwcGVu\nZCgiKSIpOwoKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJp\nbmdCdWlsZGVyKCk7CiAgICAgICAgYnVmLmFwcGVuZCgiU0VMRUNUIHQyLk9X\nTkVSIEFTIFBLVEFCTEVfU0NIRU0sICIpLgogICAgICAgICAgICBhcHBlbmQo\nInQyLlRBQkxFX05BTUUgQVMgUEtUQUJMRV9OQU1FLCAiKS4KICAgICAgICAg\nICAgYXBwZW5kKCJ0Mi5DT0xVTU5fTkFNRSBBUyBQS0NPTFVNTl9OQU1FLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5PV05FUiBBUyBGS1RBQkxFX1ND\nSEVNLCAiKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5UQUJMRV9OQU1FIEFT\nIEZLVEFCTEVfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgidDAuQ09M\nVU1OX05BTUUgQVMgRktDT0xVTU5fTkFNRSwgIikuCiAgICAgICAgICAgIGFw\ncGVuZCgidDAuUE9TSVRJT04gQVMgS0VZX1NFUSwgIikuCiAgICAgICAgICAg\nIGFwcGVuZChkZWxBY3Rpb24pLmFwcGVuZCgiIEFTIERFTEVURV9SVUxFLCAi\nKS4KICAgICAgICAgICAgYXBwZW5kKCJ0MC5DT05TVFJBSU5UX05BTUUgQVMg\nRktfTkFNRSwgIikuCiAgICAgICAgICAgIGFwcGVuZCgiREVDT0RFKHQxLkRF\nRkVSUkVELCAnREVGRVJSRUQnLCAiKS4KICAgICAgICAgICAgYXBwZW5kKG1l\ndGEuaW1wb3J0ZWRLZXlJbml0aWFsbHlEZWZlcnJlZCkuCiAgICAgICAgICAg\nIGFwcGVuZCgiLCAnSU1NRURJQVRFJywgIikuCiAgICAgICAgICAgIGFwcGVu\nZChtZXRhLmltcG9ydGVkS2V5SW5pdGlhbGx5SW1tZWRpYXRlKS4KICAgICAg\nICAgICAgYXBwZW5kKCIpIEFTIERFRkVSUkFCSUxJVFkgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiRlJPTSBBTExfQ09OU19DT0xVTU5TIHQwLCBBTExfQ09O\nU1RSQUlOVFMgdDEsICIpLgogICAgICAgICAgICBhcHBlbmQoIkFMTF9DT05T\nX0NPTFVNTlMgdDIgIikuCiAgICAgICAgICAgIGFwcGVuZCgiV0hFUkUgdDAu\nT1dORVIgPSB0MS5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQg\ndDAuQ09OU1RSQUlOVF9OQU1FID0gdDEuQ09OU1RSQUlOVF9OQU1FICIpLgog\nICAgICAgICAgICBhcHBlbmQoIkFORCB0MS5DT05TVFJBSU5UX1RZUEUgPSAn\nUicgIikuCiAgICAgICAgICAgIGFwcGVuZCgiQU5EIHQxLlJfT1dORVIgPSB0\nMi5PV05FUiAiKS4KICAgICAgICAgICAgYXBwZW5kKCJBTkQgdDEuUl9DT05T\nVFJBSU5UX05BTUUgPSB0Mi5DT05TVFJBSU5UX05BTUUgIikuCiAgICAgICAg\nICAgIGFwcGVuZCgiQU5EIHQwLlBPU0lUSU9OID0gdDIuUE9TSVRJT04iKTsK\nICAgICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAuT1dORVIgPSA/Iik7\nCiAgICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHRhYmxlTmFtZSkp\nCiAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQgdDAuVEFCTEVfTkFNRSA9\nID8iKTsKICAgICAgICBidWYuYXBwZW5kKCIgT1JERVIgQlkgdDIuT1dORVIs\nIHQyLlRBQkxFX05BTUUsIHQwLlBPU0lUSU9OIik7CgogICAgICAgIFByZXBh\ncmVkU3RhdGVtZW50IHN0bW50ID0gY29ubi5wcmVwYXJlU3RhdGVtZW50KGJ1\nZi50b1N0cmluZygpKTsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBpZHggPSAxOwogICAgICAg\nICAgICBpZiAoIURCSWRlbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpCiAg\nICAgICAgICAgICAgICBzZXRTdHJpbmcoc3RtbnQsIGlkeCsrLCBjb252ZXJ0\nU2NoZW1hQ2FzZShzY2hlbWFOYW1lKSwgbnVsbCk7CiAgICAgICAgICAgIGlm\nICghREJJZGVudGlmaWVyLmlzTnVsbCh0YWJsZU5hbWUpKQogICAgICAgICAg\nICAgICAgc2V0U3RyaW5nKHN0bW50LCBpZHgrKywgY29udmVydFNjaGVtYUNh\nc2UodGFibGVOYW1lKSwgbnVsbCk7CiAgICAgICAgICAgIHNldFRpbWVvdXRz\nKHN0bW50LCBjb25mLCBmYWxzZSk7CiAgICAgICAgICAgIHJzID0gc3RtbnQu\nZXhlY3V0ZVF1ZXJ5KCk7CiAgICAgICAgICAgIExpc3Q8Rm9yZWlnbktleT4g\nZmtMaXN0ID0gbmV3IEFycmF5TGlzdDxGb3JlaWduS2V5PigpOyAgICAgICAg\nICAgIAogICAgICAgICAgICBNYXA8RktNYXBLZXksIEZvcmVpZ25LZXk+IGZr\nTWFwID0gbmV3IEhhc2hNYXA8RktNYXBLZXksIEZvcmVpZ25LZXk+KCk7Cgog\nICAgICAgICAgICB3aGlsZSAocnMgIT0gbnVsbCAmJiBycy5uZXh0KCkpIHsK\nICAgICAgICAgICAgICAgIEZvcmVpZ25LZXkgbmZrID0gbmV3Rm9yZWlnbktl\neShycyk7CiAgICAgICAgICAgICAgICBpZiAoIXBhcnRpYWxLZXlzKSB7CiAg\nICAgICAgICAgICAgICAgICAgRm9yZWlnbktleSBmayA9IGNvbWJpbmVGb3Jl\naWduS2V5KGZrTWFwLCBuZmspOwogICAgICAgICAgICAgICAgICAgIC8vIE9u\nbHkgYWRkIHRoZSBmayB0byB0aGUgaW1wb3J0IGxpc3QgaWYgaXQgaXMgbmV3\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGZrICE9IG5maykgewogICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBma0xpc3Qu\nYWRkKG5mayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChG\nb3JlaWduS2V5W10pIGZrTGlzdC50b0FycmF5CiAgICAgICAgICAgICAgICAo\nbmV3IEZvcmVpZ25LZXlbZmtMaXN0LnNpemUoKV0pOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBycy5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHN0bW50LmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0Q3JlYXRlVGFibGVTUUwo\nVGFibGUgdGFibGUpIHsKICAgICAgICAvLyBvbmx5IG92ZXJyaWRlIGlmIHdl\nIGFyZSBzaW11bGF0aW5nIGF1dG8taW5jcmVtZW5ldCB3aXRoIHRyaWdnZXJz\nCiAgICAgICAgU3RyaW5nW10gY3JlYXRlID0gc3VwZXIuZ2V0Q3JlYXRlVGFi\nbGVTUUwodGFibGUpOwogICAgICAgIGlmICghdXNlVHJpZ2dlcnNGb3JBdXRv\nQXNzaWduKQogICAgICAgICAgICByZXR1cm4gY3JlYXRlOwoKICAgICAgICBD\nb2x1bW5bXSBjb2xzID0gdGFibGUuZ2V0Q29sdW1ucygpOwogICAgICAgIExp\nc3Qgc2VxcyA9IG51bGw7CiAgICAgICAgU3RyaW5nIHNlcSwgdHJpZzsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgY29scyAhPSBudWxsICYmIGkgPCBjb2xz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghY29sc1tpXS5pc0F1\ndG9Bc3NpZ25lZCgpKQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIGlmIChzZXFzID09IG51bGwpCiAgICAgICAgICAgICAgICBzZXFz\nID0gbmV3IEFycmF5TGlzdCg0KTsKCiAgICAgICAgICAgIHNlcSA9IGF1dG9B\nc3NpZ25TZXF1ZW5jZU5hbWU7CiAgICAgICAgICAgIGlmIChzZXEgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgaWYgKG9wZW5qcGEzR2VuZXJhdGVkS2V5\nTmFtZXMpCiAgICAgICAgICAgICAgICAgICAgc2VxID0gZ2V0T3BlbkpQQTNH\nZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sc1tpXSk7CiAgICAgICAgICAg\nICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2VxID0gZ2V0R2VuZXJh\ndGVkS2V5U2VxdWVuY2VOYW1lKGNvbHNbaV0pOwogICAgICAgICAgICAgICAg\nc2Vxcy5hZGQoIkNSRUFURSBTRVFVRU5DRSAiICsgc2VxICsgIiBTVEFSVCBX\nSVRIIDEiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3Blbmpw\nYTNHZW5lcmF0ZWRLZXlOYW1lcykKICAgICAgICAgICAgICAgIHRyaWcgPSBn\nZXRPcGVuSlBBM0dlbmVyYXRlZEtleVRyaWdnZXJOYW1lKGNvbHNbaV0pOwog\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB0cmlnID0gZ2V0R2Vu\nZXJhdGVkS2V5VHJpZ2dlck5hbWUoY29sc1tpXSk7CgogICAgICAgICAgICAv\nLyBjcmVhdGUgdGhlIHRyaWdnZXIgdGhhdCB3aWxsIGluc2VydCBuZXcgdmFs\ndWVzIGludG8KICAgICAgICAgICAgLy8gdGhlIHRhYmxlIHdoZW5ldmVyIGEg\ncm93IGlzIGNyZWF0ZWQKICAgICAgICAgICAgc2Vxcy5hZGQoIkNSRUFURSBP\nUiBSRVBMQUNFIFRSSUdHRVIgIiArIHRyaWcKICAgICAgICAgICAgICAgICsg\nIiBCRUZPUkUgSU5TRVJUIE9OICIgKyB0b0RCTmFtZSh0YWJsZS5nZXRJZGVu\ndGlmaWVyKCkpCiAgICAgICAgICAgICAgICArICIgRk9SIEVBQ0ggUk9XIEJF\nR0lOIFNFTEVDVCAiICsgc2VxICsgIi5uZXh0dmFsIElOVE8gIgogICAgICAg\nICAgICAgICAgKyAiOm5ldy4iICsgdG9EQk5hbWUoY29sc1tpXS5nZXRJZGVu\ndGlmaWVyKCkpICsgIiBGUk9NIERVQUw7ICIKICAgICAgICAgICAgICAgICsg\nIkVORCAiICsgdHJpZyArICI7Iik7CiAgICAgICAgfQogICAgICAgIGlmIChz\nZXFzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjcmVhdGU7CgogICAg\nICAgIC8vIGNvbWJpbmUgY3JlYXRlIHRhYmxlIHNxbCBhbmQgY3JlYXRlIHNl\ncWVuY2VzIHNxbAogICAgICAgIFN0cmluZ1tdIHNxbCA9IG5ldyBTdHJpbmdb\nY3JlYXRlLmxlbmd0aCArIHNlcXMuc2l6ZSgpXTsKICAgICAgICBTeXN0ZW0u\nYXJyYXljb3B5KGNyZWF0ZSwgMCwgc3FsLCAwLCBjcmVhdGUubGVuZ3RoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHNlcXMuc2l6ZSgpOyBpKysp\nCiAgICAgICAgICAgIHNxbFtjcmVhdGUubGVuZ3RoICsgaV0gPSAoU3RyaW5n\nKSBzZXFzLmdldChpKTsKICAgICAgICByZXR1cm4gc3FsOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIFN0cmluZ1tdIGdldENyZWF0ZVNlcXVl\nbmNlU1FMKFNlcXVlbmNlIHNlcSkgewogICAgICAgIFN0cmluZ1tdIHNxbCA9\nIHN1cGVyLmdldENyZWF0ZVNlcXVlbmNlU1FMKHNlcSk7CiAgICAgICAgaWYg\nKHNlcS5nZXRBbGxvY2F0ZSgpID4gMSkKICAgICAgICAgICAgc3FsWzBdICs9\nICIgQ0FDSEUgIiArIHNlcS5nZXRBbGxvY2F0ZSgpOwogICAgICAgIHJldHVy\nbiBzcWw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBw\ncmVmZXJyZWQge0BsaW5rIFR5cGVzfSBjb25zdGFudCBmb3IgdGhlIGdpdmVu\nCiAgICAgKiB7QGxpbmsgSmF2YVR5cGVzfSBvciB7QGxpbmsgSmF2YVNRTFR5\ncGVzfSBjb25zdGFudC4KICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgaW50IGdldEpEQkNUeXBlKGludCBtZXRhVHlwZUNvZGUsIGJvb2xlYW4g\nbG9iLCBpbnQgcHJlY2lzLCAKICAgICAgICBpbnQgc2NhbGUsIGJvb2xlYW4g\neG1sKSB7ICAgICAgICAKICAgICAgICByZXR1cm4gZ2V0SkRCQ1R5cGUobWV0\nYVR5cGVDb2RlLCBsb2IgfHwgeG1sLCBwcmVjaXMsIHNjYWxlKTsgICAgICAg\nIAogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIFN0cmluZyBn\nZXRTZXF1ZW5jZXNTUUwoU3RyaW5nIHNjaGVtYU5hbWUsIFN0cmluZyBzZXF1\nZW5jZU5hbWUpIHsKICAgICAgICByZXR1cm4gZ2V0U2VxdWVuY2VzU1FMKERC\nSWRlbnRpZmllci5uZXdTY2hlbWEoc2NoZW1hTmFtZSksIERCSWRlbnRpZmll\nci5uZXdTZXF1ZW5jZShzZXF1ZW5jZU5hbWUpKTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0U2VxdWVuY2VzU1FMKERC\nSWRlbnRpZmllciBzY2hlbWFOYW1lLCBEQklkZW50aWZpZXIgc2VxdWVuY2VO\nYW1lKSB7CiAgICAgICAgU3RyaW5nQnVpbGRlciBidWYgPSBuZXcgU3RyaW5n\nQnVpbGRlcigpOwogICAgICAgIGJ1Zi5hcHBlbmQoIlNFTEVDVCBTRVFVRU5D\nRV9PV05FUiBBUyBTRVFVRU5DRV9TQ0hFTUEsICIpLgogICAgICAgICAgICBh\ncHBlbmQoIlNFUVVFTkNFX05BTUUgRlJPTSBBTExfU0VRVUVOQ0VTIik7CiAg\nICAgICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHNjaGVtYU5hbWUpIHx8\nICFEQklkZW50aWZpZXIuaXNOdWxsKHNlcXVlbmNlTmFtZSkpCiAgICAgICAg\nICAgIGJ1Zi5hcHBlbmQoIiBXSEVSRSAiKTsKICAgICAgICBpZiAoIURCSWRl\nbnRpZmllci5pc051bGwoc2NoZW1hTmFtZSkpIHsKICAgICAgICAgICAgYnVm\nLmFwcGVuZCgiU0VRVUVOQ0VfT1dORVIgPSA/Iik7CiAgICAgICAgICAgIGlm\nICghREJJZGVudGlmaWVyLmlzTnVsbChzZXF1ZW5jZU5hbWUpKQogICAgICAg\nICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKCFEQklkZW50aWZpZXIuaXNOdWxsKHNlcXVlbmNlTmFtZSkpCiAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoIlNFUVVFTkNFX05BTUUgPSA/Iik7CiAg\nICAgICAgcmV0dXJuIGJ1Zi50b1N0cmluZygpOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoU3RyaW5nIG5hbWUsIFN0cmlu\nZyBzY2hlbWEsCiAgICAgICAgYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAg\nICAgICByZXR1cm4gaXNTeXN0ZW1TZXF1ZW5jZShEQklkZW50aWZpZXIubmV3\nU2VxdWVuY2UobmFtZSksCiAgICAgICAgICAgIERCSWRlbnRpZmllci5uZXdT\nY2hlbWEoc2NoZW1hKSwgdGFyZ2V0U2NoZW1hKTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyBib29sZWFuIGlzU3lzdGVtU2VxdWVuY2UoREJJ\nZGVudGlmaWVyIG5hbWUsIERCSWRlbnRpZmllciBzY2hlbWEsCiAgICAgICAg\nYm9vbGVhbiB0YXJnZXRTY2hlbWEpIHsKICAgICAgICBpZiAoc3VwZXIuaXNT\neXN0ZW1TZXF1ZW5jZShuYW1lLCBzY2hlbWEsIHRhcmdldFNjaGVtYSkpCiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBmaWx0ZXIgb3V0\nIGdlbmVyYXRlZCBzZXF1ZW5jZXMgdXNlZCBmb3IgYXV0by1hc3NpZ24KICAg\nICAgICBTdHJpbmcgc3RyTmFtZSA9IERCSWRlbnRpZmllci5pc051bGwobmFt\nZSkgPyAiIiA6IG5hbWUuZ2V0TmFtZSgpOwogICAgICAgIHJldHVybiAoYXV0\nb0Fzc2lnblNlcXVlbmNlTmFtZSAhPSBudWxsCiAgICAgICAgICAgICYmIHN0\nck5hbWUuZXF1YWxzSWdub3JlQ2FzZShhdXRvQXNzaWduU2VxdWVuY2VOYW1l\nKSkKICAgICAgICAgICAgfHwgKGF1dG9Bc3NpZ25TZXF1ZW5jZU5hbWUgPT0g\nbnVsbAogICAgICAgICAgICAmJiBzdHJOYW1lLnRvVXBwZXJDYXNlKCkuc3Rh\ncnRzV2l0aCgiU1RfIikpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIE9iamVjdCBnZXRHZW5lcmF0ZWRLZXkoQ29sdW1uIGNvbCwgQ29ubmVj\ndGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAg\nICAgIGlmICghdXNlVHJpZ2dlcnNGb3JBdXRvQXNzaWduKQogICAgICAgICAg\nICByZXR1cm4gMEw7CgogICAgICAgIC8vIGlmIHdlIHNpbXVsYXRlIGF1dG8t\nYXNzaWduZWQgY29sdW1ucyB1c2luZyB0cmlnZ2VycyBhbmQKICAgICAgICAv\nLyBzZXF1ZW5jZXMsIHRoZW4gcmV0dXJuIHRoZSBjdXJyZW50IHZhbHVlIG9m\nIHRoZSBzZXF1ZW5jZQogICAgICAgIC8vIGZyb20gYXV0b0Fzc2lnblNlcXVl\nbmNlTmFtZQogICAgICAgIFN0cmluZyBzZXEgPSBhdXRvQXNzaWduU2VxdWVu\nY2VOYW1lOwogICAgICAgIGlmIChzZXEgPT0gbnVsbCAmJiBvcGVuanBhM0dl\nbmVyYXRlZEtleU5hbWVzKQogICAgICAgICAgICBzZXEgPSBnZXRPcGVuSlBB\nM0dlbmVyYXRlZEtleVNlcXVlbmNlTmFtZShjb2wpOwogICAgICAgIGVsc2Ug\naWYgKHNlcSA9PSBudWxsKQogICAgICAgICAgICBzZXEgPSBnZXRHZW5lcmF0\nZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAgICAgICBQcmVwYXJlZFN0YXRl\nbWVudCBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudCgiU0VMRUNUICIg\nKyBzZXEKICAgICAgICAgICAgKyAiLmN1cnJ2YWwgRlJPTSBEVUFMIik7CiAg\nICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzZXRUaW1lb3V0cyhzdG1udCwgY29uZiwgZmFsc2UpOwogICAg\nICAgICAgICBycyA9IHN0bW50LmV4ZWN1dGVRdWVyeSgpOwogICAgICAgICAg\nICBycy5uZXh0KCk7CiAgICAgICAgICAgIHJldHVybiBycy5nZXRMb25nKDEp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChycyAhPSBu\ndWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMuY2xvc2UoKTsgfSBjYXRj\naCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAgICB0cnkgeyBzdG1u\ndC5jbG9zZSgpOyB9IGNhdGNoIChTUUxFeGNlcHRpb24gc2UpIHt9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJpZ2dlciBuYW1lIGZvciBz\naW11bGF0aW5nIGF1dG8tYXNzaWduIHZhbHVlcyBvbiB0aGUgZ2l2ZW4gY29s\ndW1uLgogICAgICovCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldEdlbmVyYXRl\nZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsKICAgICAgICAvLyByZXBs\nYWNlIHRyYWlsaW5nIF9TRVEgd2l0aCBfVFJHCiAgICAgICAgU3RyaW5nIHNl\ncU5hbWUgPSBnZXRHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoY29sKTsKICAg\nICAgICByZXR1cm4gc2VxTmFtZS5zdWJzdHJpbmcoMCwgc2VxTmFtZS5sZW5n\ndGgoKSAtIDMpICsgIlRSRyI7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm5zIGEgT3BlbkpQQSAzLWNvbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0by1h\nc3NpZ24gc2VxdWVuY2UuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdHJpbmcg\nZ2V0T3BlbkpQQTNHZW5lcmF0ZWRLZXlTZXF1ZW5jZU5hbWUoQ29sdW1uIGNv\nbCkgewogICAgICAgIFRhYmxlIHRhYmxlID0gY29sLmdldFRhYmxlKCk7CiAg\nICAgICAgREJJZGVudGlmaWVyIHNOYW1lID0gREJJZGVudGlmaWVyLnByZUNv\nbWJpbmUodGFibGUuZ2V0SWRlbnRpZmllcigpLCAiU0VRIik7CiAgICAgICAg\ncmV0dXJuIHRvREJOYW1lKGdldE5hbWluZ1V0aWwoKS5tYWtlSWRlbnRpZmll\nclZhbGlkKHNOYW1lLCB0YWJsZS5nZXRTY2hlbWEoKS4KICAgICAgICAgICAg\nZ2V0U2NoZW1hR3JvdXAoKSwgbWF4VGFibGVOYW1lTGVuZ3RoLCB0cnVlKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgT3BlbkpQQSAzLWNv\nbXBhdGlibGUgbmFtZSBmb3IgYW4gYXV0by1hc3NpZ24gdHJpZ2dlci4KICAg\nICAqLwogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRPcGVuSlBBM0dlbmVyYXRl\nZEtleVRyaWdnZXJOYW1lKENvbHVtbiBjb2wpIHsKICAgICAgICBUYWJsZSB0\nYWJsZSA9IGNvbC5nZXRUYWJsZSgpOyAgICAgICAgCiAgICAgICAgREJJZGVu\ndGlmaWVyIHNOYW1lID0gREJJZGVudGlmaWVyLnByZUNvbWJpbmUodGFibGUu\nZ2V0SWRlbnRpZmllcigpLCAiVFJJRyIpOwogICAgICAgIHJldHVybiB0b0RC\nTmFtZShnZXROYW1pbmdVdGlsKCkubWFrZUlkZW50aWZpZXJWYWxpZChzTmFt\nZSwgdGFibGUuZ2V0U2NoZW1hKCkuCiAgICAgICAgICAgIGdldFNjaGVtYUdy\nb3VwKCksIG1heFRhYmxlTmFtZUxlbmd0aCwgdHJ1ZSkpOwogICAgfQoKICAg\nIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxjb2RlPnB1dEJ5dGVzPC9j\nb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIEJMT0Igb2JqZWN0LgogICAgICog\nVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGJsb2IgaXMgd3JhcHBlZCBp\nbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lmaWMgY2xhc3M7IGZvciBl\neGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0aGluIGRyaXZlcgogICAg\nICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMgd2l0aCB0aGUgc2FtZSBt\nZXRob2RzLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lk\nIHB1dEJ5dGVzKEJsb2IgYmxvYiwgYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGJsb2IgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChfcHV0Qnl0ZXMgPT0g\nbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgX3B1\ndEJ5dGVzID0gYmxvYi5nZXRDbGFzcygpLmdldE1ldGhvZCgicHV0Qnl0ZXMi\nLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBsb25nLmNsYXNz\nLCBieXRlW10uY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW52\nb2tlUHV0TG9iTWV0aG9kKF9wdXRCeXRlcywgYmxvYiwgZGF0YSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBJbnZva2UgT3JhY2xlJ3MgPGNvZGU+cHV0U3Ry\naW5nPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIENMT0Igb2JqZWN0Lgog\nICAgICogVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGNsb2IgaXMgd3Jh\ncHBlZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lmaWMgY2xhc3M7\nIGZvciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0aGluIGRyaXZl\ncgogICAgICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMgd2l0aCB0aGUg\nc2FtZSBtZXRob2RzLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIHB1dFN0cmluZyhDbG9iIGNsb2IsIFN0cmluZyBkYXRhKQogICAg\nICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChfcHV0U3Ry\naW5nID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIF9wdXRTdHJpbmcgPSBjbG9iLmdldENsYXNzKCkuZ2V0TWV0aG9kKCJw\ndXRTdHJpbmciLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBs\nb25nLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nU3RvcmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaW52b2tlUHV0TG9iTWV0aG9kKF9wdXRTdHJpbmcsIGNsb2IsIGRh\ndGEpOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIE9yYWNsZSdzIDxj\nb2RlPnB1dENoYXJzPC9jb2RlPiBtZXRob2Qgb24gdGhlIGdpdmVuIENMT0IK\nICAgICAqIG9iamVjdC4gVXNlcyByZWZsZWN0aW9uIGluIGNhc2UgdGhlIGNs\nb2IgaXMgd3JhcHBlZCBpbiBhbm90aGVyCiAgICAgKiB2ZW5kb3Itc3BlY2lm\naWMgY2xhc3M7IGZvciBleGFtcGxlIFdlYmxvZ2ljIHdyYXBzIG9yYWNsZSB0\naGluIGRyaXZlcgogICAgICogbG9icyBpbiBpdHMgb3duIGludGVyZmFjZXMg\nd2l0aCB0aGUgc2FtZSBtZXRob2RzLgogICAgICovCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIHB1dENoYXJzKENsb2IgY2xvYiwgY2hhcltdIGRh\ndGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKF9wdXRDaGFycyA9PSBudWxsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBfcHV0Q2hhcnMgPSBjbG9iLmdldENsYXNzKCkuZ2V0TWV0\naG9kKCJwdXRDaGFycyIsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNz\nW117IGxvbmcuY2xhc3MsIGNoYXJbXS5jbGFzcyB9KTsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBTdG9yZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBpbnZva2VQdXRMb2JNZXRob2QoX3B1dENoYXJzLCBjbG9i\nLCBkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIEludm9rZSB0aGUgZ2l2\nZW4gTE9CIG1ldGhvZCBvbiB0aGUgZ2l2ZW4gdGFyZ2V0IHdpdGggdGhlIGdp\ndmVuIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgaW52\nb2tlUHV0TG9iTWV0aG9kKE1ldGhvZCBtZXRob2QsIE9iamVjdCB0YXJnZXQs\nCiAgICAgICAgT2JqZWN0IGRhdGEpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0aG9kLmludm9r\nZSh0YXJnZXQsIG5ldyBPYmplY3RbXXsgMUwsIGRhdGEgfSk7CiAgICAgICAg\nfSBjYXRjaCAoSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbiBpdGUpIHsKICAg\nICAgICAgICAgVGhyb3dhYmxlIHQgPSBpdGUuZ2V0VGFyZ2V0RXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgU1FMRXhjZXB0aW9u\nKQogICAgICAgICAgICAgICAgdGhyb3coU1FMRXhjZXB0aW9uKSB0OwogICAg\nICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24odCk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2\nYXRlIENsb2IgZ2V0RW1wdHlDbG9iKCkKICAgICAgICB0aHJvd3MgU1FMRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoRU1QVFlfQ0xPQiAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gRU1QVFlfQ0xPQjsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gRU1QVFlfQ0xPQiA9IChDbG9iKSBDbGFzcy5mb3JO\nYW1lKCJvcmFjbGUuc3FsLkNMT0IiLHRydWUsIAogICAgICAgICAgICAgICAg\nICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVs\ncGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q29udGV4dENs\nYXNzTG9hZGVyQWN0aW9uKCkpKS4KICAgICAgICAgICAgICAgIGdldE1ldGhv\nZCgiZW1wdHlfbG9iIiwgbmV3IENsYXNzWzBdKS4KICAgICAgICAgICAgICAg\nIGludm9rZShudWxsLCBuZXcgT2JqZWN0WzBdKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU1FMRXhj\nZXB0aW9uKGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBCbG9iIGdldEVtcHR5QmxvYigpCiAgICAgICAgdGhyb3dzIFNR\nTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKEVNUFRZX0JMT0IgIT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0JMT0I7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0JMT0IgPSAoQmxvYikgQ2xhc3Mu\nZm9yTmFtZSgib3JhY2xlLnNxbC5CTE9CIix0cnVlLCAKICAgICAgICAgICAg\nICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZChKMkRvUHJp\ndkhlbHBlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldENvbnRl\neHRDbGFzc0xvYWRlckFjdGlvbigpKSkuCiAgICAgICAgICAgICAgICBnZXRN\nZXRob2QoImVtcHR5X2xvYiIsIG5ldyBDbGFzc1swXSkuCiAgICAgICAgICAg\nICAgICBpbnZva2UobnVsbCwgbmV3IE9iamVjdFswXSk7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFNR\nTEV4Y2VwdGlvbihlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaXNPcmFjbGVQcmVwYXJlZFN0\nYXRlbWVudChTdGF0ZW1lbnQgc3RtbnQpIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gQ2xhc3MuZm9yTmFtZSgib3JhY2xlLmpkYmMuT3Jh\nY2xlUHJlcGFyZWRTdGF0ZW1lbnQiKS4KICAgICAgICAgICAgICAgIGlzSW5z\ndGFuY2Uoc3RtbnQpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogSWYgdGhpcyBkaWN0aW9uYXJ5IHN1cHBvcnRz\nIFhNTCB0eXBlLAogICAgICogdXNlIHRoaXMgbWV0aG9kIHRvIGFwcGVuZCB4\nbWwgcHJlZGljYXRlLgogICAgICogCiAgICAgKiBAcGFyYW0gYnVmIHRoZSBT\nUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJpc29uCiAgICAgKiBAcGFy\nYW0gb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9uIHRvIHBlcmZvcm0KICAg\nICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBjb21w\nYXJpc29uCiAgICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUg\nb2YgdGhlIGNvbXBhcmlzb24KICAgICAqLwogICAgcHVibGljIHZvaWQgYXBw\nZW5kWG1sQ29tcGFyaXNvbihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsIEZp\nbHRlclZhbHVlIGxocywKICAgICAgICBGaWx0ZXJWYWx1ZSByaHMsIGJvb2xl\nYW4gbGhzeG1sLCBib29sZWFuIHJoc3htbCkgewogICAgICAgIHN1cGVyLmFw\ncGVuZFhtbENvbXBhcmlzb24oYnVmLCBvcCwgbGhzLCByaHMsIGxoc3htbCwg\ncmhzeG1sKTsKICAgICAgICBpZiAobGhzeG1sICYmIHJoc3htbCkKICAgICAg\nICAgICAgYXBwZW5kWG1sQ29tcGFyaXNvbjIoYnVmLCBvcCwgbGhzLCByaHMp\nOwogICAgICAgIGVsc2UgaWYgKGxoc3htbCkKICAgICAgICAgICAgYXBwZW5k\nWG1sQ29tcGFyaXNvbjEoYnVmLCBvcCwgbGhzLCByaHMpOwogICAgICAgIGVs\nc2UgCiAgICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3As\nIHJocywgbGhzKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBcHBlbmQg\nYW4geG1sIGNvbXBhcmlzb24gcHJlZGljYXRlCiAgICAgKgogICAgICogQHBh\ncmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNv\nbgogICAgICogQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0\nbyBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lk\nZSBvZiB0aGUgY29tcGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAg\nICogQHBhcmFtIHJocyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21w\nYXJpc29uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxDb21w\nYXJpc29uMShTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsCiAgICAgICAgRmls\ndGVyVmFsdWUgbGhzLCBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBhcHBl\nbmRYbWxFeHRyYWN0VmFsdWUoYnVmLCBsaHMpOwogICAgICAgIGJ1Zi5hcHBl\nbmQoIiAiKS5hcHBlbmQob3ApLmFwcGVuZCgiICIpOwogICAgICAgIHJocy5h\ncHBlbmRUbyhidWYpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFwcGVu\nZCBhbiB4bWwgY29tcGFyaXNvbiBwcmVkaWNhdGUgKGJvdGggb3BlcmFuZHMg\nbWFwIHRvIHhtbCBjb2x1bW4pCiAgICAgKgogICAgICogQHBhcmFtIGJ1ZiB0\naGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNvbgogICAgICog\nQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0byBwZXJmb3Jt\nCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUg\nY29tcGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAgICogQHBhcmFt\nIHJocyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21wYXJpc29uICht\nYXBzIHRvIHhtbCBjb2x1bW4pCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\ncHBlbmRYbWxDb21wYXJpc29uMihTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3As\nIAogICAgICAgIEZpbHRlclZhbHVlIGxocywgRmlsdGVyVmFsdWUgcmhzKSB7\nCiAgICAgICAgYXBwZW5kWG1sRXh0cmFjdFZhbHVlKGJ1ZiwgbGhzKTsKICAg\nICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAiKTsK\nICAgICAgICBhcHBlbmRYbWxFeHRyYWN0VmFsdWUoYnVmLCByaHMpOwogICAg\nfQogICAgCiAgICBwcml2YXRlIHZvaWQgYXBwZW5kWG1sRXh0cmFjdFZhbHVl\nKFNRTEJ1ZmZlciBidWYsIEZpbHRlclZhbHVlIHZhbCkgewogICAgICAgIGJ1\nZi5hcHBlbmQoImV4dHJhY3RWYWx1ZSgiKS4KICAgICAgICAgICAgYXBwZW5k\nKHZhbC5nZXRDb2x1bW5BbGlhcygKICAgICAgICAgICAgdmFsLmdldEZpZWxk\nTWFwcGluZygpLmdldENvbHVtbnMoKVswXSkpLgogICAgICAgICAgICBhcHBl\nbmQoIiwnLyovIik7CiAgICAgICAgdmFsLmFwcGVuZFRvKGJ1Zik7CiAgICAg\nICAgYnVmLmFwcGVuZCgiJykiKTsKICAgIH0KICAgIAogICAgcHVibGljIHZv\naWQgaW5zZXJ0Q2xvYkZvclN0cmVhbWluZ0xvYWQoUm93IHJvdywgQ29sdW1u\nIGNvbCwgT2JqZWN0IG9iKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChvYiA9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbC5z\nZXRUeXBlKFR5cGVzLk9USEVSKTsKICAgICAgICAgICAgcm93LnNldE51bGwo\nY29sKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cuc2V0Q2xv\nYihjb2wsIGdldEVtcHR5Q2xvYigpKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGludCBnZXRCYXRjaFVwZGF0ZUNvdW50KFByZXBhcmVkU3RhdGVt\nZW50IHBzKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpbnQgdXBk\nYXRlU3VjY2Vzc0NudCA9IDA7CiAgICAgICAgaWYgKGJhdGNoTGltaXQgIT0g\nMCAmJiBwcyAhPSBudWxsKSB7CiAgICAgICAgICAgIHVwZGF0ZVN1Y2Nlc3ND\nbnQgPSBwcy5nZXRVcGRhdGVDb3VudCgpOwogICAgICAgICAgICBpZiAobG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nX2xvYy5nZXQoImJhdGNoLXVwZGF0ZS1zdWNjZXNzLWNvdW50IiwKICAgICAg\nICAgICAgICAgICAgICB1cGRhdGVTdWNjZXNzQ250KSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB1cGRhdGVTdWNjZXNzQ250OwogICAgfQogICAgCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBib29sZWFuIGlzRmF0YWxFeGNlcHRp\nb24oaW50IHN1YnR5cGUsIFNRTEV4Y2VwdGlvbiBleCkgewogICAgICAgIFN0\ncmluZyBlcnJvclN0YXRlID0gZXguZ2V0U1FMU3RhdGUoKTsKICAgICAgICBp\nbnQgZXJyb3JDb2RlID0gZXguZ2V0RXJyb3JDb2RlKCk7CiAgICAgICAgaWYg\nKChzdWJ0eXBlID09IFN0b3JlRXhjZXB0aW9uLkxPQ0spCiAgICAgICAgICAg\nICYmICgoIjYxMDAwIi5lcXVhbHMoZXJyb3JTdGF0ZSkgJiYgKGVycm9yQ29k\nZSA9PSA1NCB8fAogICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9PSA2MCB8\nfCBlcnJvckNvZGUgPT0gNDAyMCB8fAogICAgICAgICAgICAgICAgIGVycm9y\nQ29kZSA9PSA0MDIxIHx8IGVycm9yQ29kZSA9PSA0MDIyKSkKICAgICAgICAg\nICAgICAgIHx8ICgiNDIwMDAiLmVxdWFscyhlcnJvclN0YXRlKSAmJiBlcnJv\nckNvZGUgPT0gMjA0OSkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICB9IAogICAgICAgIGlmICgiNzIwMDAiLmVxdWFscyhlcnJvclN0\nYXRlKSAmJiBlcnJvckNvZGUgPT0gMTAxMykgewogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdXBlci5pc0Zh\ndGFsRXhjZXB0aW9uKHN1YnR5cGUsIGV4KTsKICAgIH0KICAgIAogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBpbnNlcnRCbG9iRm9yU3RyZWFtaW5n\nTG9hZChSb3cgcm93LCBDb2x1bW4gY29sLCAKICAgICAgICBKREJDU3RvcmUg\nc3RvcmUsIE9iamVjdCBvYiwgU2VsZWN0IHNlbCkgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKG9iID09IG51bGwpIHsKICAgICAgICAgICAg\nY29sLnNldFR5cGUoVHlwZXMuT1RIRVIpOwogICAgICAgICAgICByb3cuc2V0\nTnVsbChjb2wpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvdy5z\nZXRCbG9iKGNvbCwgZ2V0RW1wdHlCbG9iKCkpOwogICAgICAgIH0KICAgIH0K\nfQo=\n","encoding":"base64"}

