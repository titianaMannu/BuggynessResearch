{"sha":"1b3a99b329ec3ffe3d7061c316d4b4a5b8e7f508","node_id":"MDQ6QmxvYjIwNjM2NDoxYjNhOTliMzI5ZWMzZmZlM2Q3MDYxYzMxNmQ0YjRhNWI4ZTdmNTA4","size":22425,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/1b3a99b329ec3ffe3d7061c316d4b4a5b8e7f508","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnNxbC5DYWxsYWJs\nZVN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9y\ndCBqYXZhLnNxbC5QcmVwYXJlZFN0YXRlbWVudDsKaW1wb3J0IGphdmEuc3Fs\nLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3FsLlNRTEV4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFu\nZy5PYmplY3RVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJj\nLmlkZW50aWZpZXIuREJJZGVudGlmaWVyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmpkYmMua2VybmVsLkpEQkNGZXRjaENvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5WYWw7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zY2hlbWEuQ29sdW1u\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlNlcXVl\nbmNlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMuc2NoZW1hLlRh\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlBh\ncmFtZXRlcjsKCgovKioKICogQnVmZmVyIGZvciBTUUwgc3RhdGVtZW50cyB0\naGF0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZQogKiBqYXZhLnNxbC5QcmVwYXJl\nZFN0YXRlbWVudHMuCiAqIFRoaXMgYnVmZmVyIGhvbGRzIHRoZSBTUUwgc3Rh\ndGVtZW50IHBhcmFtZXRlcnMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgCiAq\nIGNvbHVtbnMuIFRoZSBwYXJhbWV0ZXJzIGludHJvZHVjZWQgYnkgdGhlIHJ1\nbnRpbWUgc3lzdGVtIGFyZSBkaXN0aW5ndWlzaGVkCiAqIGZyb20gdGhlIHBh\ncmFtZXRlcnMgc2V0IGJ5IHRoZSB1c2VyLiAgCiAqCiAqIEBhdXRob3IgTWFy\nYyBQcnVkJ2hvbW1lYXV4CiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRo\nb3IgUGluYWtpIFBvZGRhcgogKiAKICogQHNpbmNlIDAuMi40CiAqLwpwdWJs\naWMgZmluYWwgY2xhc3MgU1FMQnVmZmVyCiAgICBpbXBsZW1lbnRzIFNlcmlh\nbGl6YWJsZSwgQ2xvbmVhYmxlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBTdHJpbmcgUEFSQU1FVEVSX1RPS0VOID0gIj8iOwoKICAgIHByaXZhdGUg\nZmluYWwgREJEaWN0aW9uYXJ5IF9kaWN0OwogICAgcHJpdmF0ZSBmaW5hbCBT\ndHJpbmdCdWlsZGVyIF9zcWwgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAg\ncHJpdmF0ZSBMaXN0IF9zdWJzZWxzID0gbnVsbDsKICAgIHByaXZhdGUgTGlz\ndCBfcGFyYW1zID0gbnVsbDsKICAgIHByaXZhdGUgTGlzdCBfY29scyA9IG51\nbGw7CiAgICAKICAgIC8vIEV2ZW4gZWxlbWVudCByZWZlcnMgdG8gYW4gaW5k\nZXggb2YgdGhlIF9wYXJhbXMgbGlzdAogICAgLy8gT2RkIGVsZW1lbnQgcmVm\nZXJzIHRvIHRoZSB1c2VyIHBhcmFtZXRlciBrZXkKICAgIHByaXZhdGUgTGlz\ndCBfdXNlckluZGV4ID0gbnVsbDsKICAgIAogICAgLyoqCiAgICAgKiBEZWZh\ndWx0IGNvbnN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVy\nKERCRGljdGlvbmFyeSBkaWN0KSB7CiAgICAgICAgX2RpY3QgPSBkaWN0Owog\nICAgfQoKICAgIC8qKgogICAgICogQ29weSBjb25zdHJ1Y3Rvci4KICAgICAq\nLwogICAgcHVibGljIFNRTEJ1ZmZlcihTUUxCdWZmZXIgYnVmKSB7CiAgICAg\nICAgX2RpY3QgPSBidWYuX2RpY3Q7CiAgICAgICAgYXBwZW5kKGJ1Zik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGEgc2hhbGxvdyBjbG9uZSBv\nZiB0aGlzIFNRTCBCdWZmZXIuCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3Qg\nY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTUUxCdWZmZXIodGhpcyk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgYnVm\nZmVyIGlzIGVtdHB5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Vt\ncHR5KCkgewogICAgICAgIHJldHVybiBfc3FsLmxlbmd0aCgpID09IDA7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYWxsIFNRTCBhbmQgcGFyYW1l\ndGVycyBvZiB0aGUgZ2l2ZW4gYnVmZmVyLgogICAgICovCiAgICBwdWJsaWMg\nU1FMQnVmZmVyIGFwcGVuZChTUUxCdWZmZXIgYnVmKSB7CiAgICAgICAgYXBw\nZW5kKGJ1ZiwgX3NxbC5sZW5ndGgoKSwgKF9wYXJhbXMgPT0gbnVsbCkgPyAw\nIDogX3BhcmFtcy5zaXplKCksCiAgICAgICAgICAgIHRydWUpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGFs\nbCBTUUwgYW5kIHBhcmFtZXRlcnMgb2YgdGhlIGdpdmVuIGJ1ZmZlciBhdCB0\naGUgZ2l2ZW4gcG9zaXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYXBwZW5kKFNRTEJ1ZmZlciBidWYsIGludCBzcWxJbmRleCwgaW50IHBhcmFt\nSW5kZXgsCiAgICAgICAgYm9vbGVhbiBzdWJzZWxzKSB7CiAgICAgICAgaWYg\nKHN1YnNlbHMpIHsKICAgICAgICAgICAgLy8gb25seSBhbGxvdyBhcHBlbmRp\nbmcgb2YgYnVmZmVycyB3aXRoIHN1YnNlbGVjdHMsIG5vdCBpbnNlcnRpb24K\nICAgICAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwgJiYgIV9zdWJzZWxz\nLmlzRW1wdHkoKQogICAgICAgICAgICAgICAgJiYgc3FsSW5kZXggIT0gX3Nx\nbC5sZW5ndGgoKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nU3RhdGVFeGNlcHRpb24oKTsKICAgICAgICAgICAgaWYgKGJ1Zi5fc3Vic2Vs\ncyAhPSBudWxsICYmICFidWYuX3N1YnNlbHMuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgICAgICBpZiAoc3FsSW5kZXggIT0gX3NxbC5sZW5ndGgoKSkKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoX3N1YnNlbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICBfc3Vic2VscyA9IG5ldyBBcnJheUxpc3Qo\nYnVmLl9zdWJzZWxzLnNpemUoKSk7CiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGJ1Zi5fc3Vic2Vscy5zaXplKCk7IGkrKykKICAgICAg\nICAgICAgICAgICAgICBfc3Vic2Vscy5hZGQoKChTdWJzZWxlY3QpIGJ1Zi5f\nc3Vic2Vscy5nZXQoaSkpLgogICAgICAgICAgICAgICAgICAgICAgICBjbG9u\nZShzcWxJbmRleCwgcGFyYW1JbmRleCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpZiAoc3FsSW5kZXggPT0gX3NxbC5sZW5ndGgoKSkK\nICAgICAgICAgICAgX3NxbC5hcHBlbmQoYnVmLl9zcWwudG9TdHJpbmcoKSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBfc3FsLmluc2VydChzcWxJbmRl\neCwgYnVmLl9zcWwudG9TdHJpbmcoKSk7CgogICAgICAgIGlmIChidWYuX3Bh\ncmFtcyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChfcGFyYW1zID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfcGFyYW1zID0gbmV3IEFycmF5TGlzdCgp\nOwogICAgICAgICAgICBpZiAoX2NvbHMgPT0gbnVsbCAmJiBidWYuX2NvbHMg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgX2NvbHMgPSBuZXcgQXJyYXlM\naXN0KCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoX2NvbHMuc2l6ZSgpIDwg\nX3BhcmFtcy5zaXplKCkpCiAgICAgICAgICAgICAgICAgICAgX2NvbHMuYWRk\nKG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGFyYW1J\nbmRleCA9PSBfcGFyYW1zLnNpemUoKSkgewogICAgICAgICAgICAgICAgX3Bh\ncmFtcy5hZGRBbGwoYnVmLl9wYXJhbXMpOwogICAgICAgICAgICAgICAgaWYg\nKGJ1Zi5fY29scyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9jb2xz\nLmFkZEFsbChidWYuX2NvbHMpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAo\nX2NvbHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoX2Nv\nbHMuc2l6ZSgpIDwgX3BhcmFtcy5zaXplKCkpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9jb2xzLmFkZChudWxsKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIF9wYXJhbXMuYWRkQWxsKHBhcmFtSW5kZXgsIGJ1\nZi5fcGFyYW1zKTsKICAgICAgICAgICAgICAgIGlmIChidWYuX2NvbHMgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgICAgICBfY29scy5hZGRBbGwocGFyYW1J\nbmRleCwgYnVmLl9jb2xzKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKF9j\nb2xzICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKF9jb2xz\nLnNpemUoKSA8IF9wYXJhbXMuc2l6ZSgpKQogICAgICAgICAgICAgICAgICAg\nICAgICBfY29scy5hZGQocGFyYW1JbmRleCwgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gYWRkaW5nIHVzZXIg\ncGFyYW1ldGVycyBmcm9tIGFub3RoZXIgYnVmZmVyIHRvIHRoaXMgYnVmZmVy\nCiAgICAgICAgLy8gdGhpcyBidWZmZXIncyB1c2VyIHBhcmFtZXRlciBpbmRl\neCBnZXRzIG1vZGlmaWVkCiAgICAgICAgaWYgKGJ1Zi5fdXNlckluZGV4ID09\nIG51bGwgJiYgdGhpcy5fdXNlckluZGV4ID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gZG8gbm90aGluZwogICAgICAgIH0gZWxzZSBpZiAoYnVmLl91c2Vy\nSW5kZXggIT0gbnVsbCAmJiB0aGlzLl91c2VySW5kZXggPT0gbnVsbCkgewog\nICAgICAgICAgICAvLyBjb3B5IHRoZSBvdGhlciBidWZmZXJzIGRhdGEKICAg\nICAgICAgICAgdGhpcy5fdXNlckluZGV4ID0gbmV3IEFycmF5TGlzdChidWYu\nX3VzZXJJbmRleCk7CiAgICAgICAgfSBlbHNlIGlmIChidWYuX3VzZXJJbmRl\neCA9PSBudWxsICYmIHRoaXMuX3VzZXJJbmRleCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIC8vIG5vdGhpbmcgdG8gYWRkIGZyb20gdGhlIG90aGVyIGJ1ZmZl\ncgogICAgICAgIH0gZWxzZSB7IC8vIGJvdGggaGFzIGRhdGEuIAogICAgICAg\nICAgICAvLyBtb2RpZnkgdGhpcyBidWZmZXIncyB1c2VyIHBhcmFtZXRlciBp\nbmRleAogICAgICAgICAgICBpbnQgb3RoZXJTaXplID0gYnVmLl91c2VySW5k\nZXguc2l6ZSgpLzI7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX3VzZXJJbmRleC5zaXplKCk7IGkrPTIpIHsKICAgICAgICAgICAgICAgIGlu\ndCBuZXdJbmRleCA9ICgoSW50ZWdlcilfdXNlckluZGV4LmdldChpKSkuaW50\nVmFsdWUoKSArIG90aGVyU2l6ZTsKICAgICAgICAgICAgICAgIF91c2VySW5k\nZXguc2V0KGksIG5ld0luZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICAvLyBhcHBlbmQgdGhlIG90aGVyIGJ1ZmZlcidzIHVzZXIgcGFyYW1ldGVy\ncyB0byB0aGlzIG9uZQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGJ1Zi5fdXNlckluZGV4LnNpemUoKTsgaSs9MikgewogICAgICAgICAgICAg\nICAgT2JqZWN0IG90aGVySW5kZXggPSBidWYuX3VzZXJJbmRleC5nZXQoaSk7\nCiAgICAgICAgICAgICAgICBPYmplY3Qgb3RoZXJQYXJhbSA9IGJ1Zi5fdXNl\nckluZGV4LmdldChpKzEpOwogICAgICAgICAgICAgICAgX3VzZXJJbmRleC5h\nZGQob3RoZXJJbmRleCk7CiAgICAgICAgICAgICAgICBfdXNlckluZGV4LmFk\nZChvdGhlclBhcmFtKTsKICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAg\nICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmQo\nREJJZGVudGlmaWVyIG5hbWUpIHsKICAgICAgICBfc3FsLmFwcGVuZChfZGlj\ndC50b0RCTmFtZShuYW1lKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9\nCgogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmQoVGFibGUgdGFibGUpIHsK\nICAgICAgICBfc3FsLmFwcGVuZChfZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwg\nZmFsc2UpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJs\naWMgU1FMQnVmZmVyIGFwcGVuZChTZXF1ZW5jZSBzZXEpIHsKICAgICAgICBf\nc3FsLmFwcGVuZChfZGljdC5nZXRGdWxsTmFtZShzZXEpKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVu\nZChDb2x1bW4gY29sKSB7CiAgICAgICAgX3NxbC5hcHBlbmQoX2RpY3QuZ2V0\nQ29sdW1uREJOYW1lKGNvbCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kKFN0cmluZyBzKSB7CiAg\nICAgICAgX3NxbC5hcHBlbmQocyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBzdWJzZWxlY3QuIFRoaXMg\nZGVsYXlzIHJlc29sdXRpb24gb2YgdGhlIHNlbGVjdCBTUUwuCiAgICAgKi8K\nICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kKFNlbGVjdCBzZWwsIEpEQkNG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gYXBw\nZW5kKHNlbCwgZmV0Y2gsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFwcGVuZCBhIHN1YnNlbGVjdCBjb3VudC4gVGhpcyBkZWxheXMgcmVzb2x1\ndGlvbiBvZiB0aGUgc2VsZWN0IFNRTC4KICAgICAqLwogICAgcHVibGljIFNR\nTEJ1ZmZlciBhcHBlbmRDb3VudChTZWxlY3Qgc2VsLCBKREJDRmV0Y2hDb25m\naWd1cmF0aW9uIGZldGNoKSB7CiAgICAgICAgcmV0dXJuIGFwcGVuZChzZWws\nIGZldGNoLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBh\nIHN1YnNlbGVjdC4gVGhpcyBkZWxheXMgcmVzb2x1dGlvbiBvZiB0aGUgc2Vs\nZWN0IFNRTC4KICAgICAqLwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgYXBwZW5k\nKFNlbGVjdCBzZWwsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsCiAg\nICAgICAgYm9vbGVhbiBjb3VudCkgewogICAgICAgIF9zcWwuYXBwZW5kKCIo\nIik7CiAgICAgICAgU3Vic2VsZWN0IHN1YiA9IG5ldyBTdWJzZWxlY3QoKTsK\nICAgICAgICBzdWIuc2VsZWN0ID0gc2VsOwogICAgICAgIHN1Yi5mZXRjaCA9\nIGZldGNoOwogICAgICAgIHN1Yi5jb3VudCA9IGNvdW50OwogICAgICAgIHN1\nYi5zcWxJbmRleCA9IF9zcWwubGVuZ3RoKCk7CiAgICAgICAgc3ViLnBhcmFt\nSW5kZXggPSAoX3BhcmFtcyA9PSBudWxsKSA/IDAgOiBfcGFyYW1zLnNpemUo\nKTsKICAgICAgICBfc3FsLmFwcGVuZCgiKSIpOwoKICAgICAgICBpZiAoX3N1\nYnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgX3N1YnNlbHMgPSBuZXcgQXJy\nYXlMaXN0KDIpOwogICAgICAgIF9zdWJzZWxzLmFkZChzdWIpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSBh\nIHN1YnNlbGVjdC4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gcmVwbGFj\nZShTZWxlY3Qgb2xkLCBTZWxlY3Qgc2VsKSB7CiAgICAgICAgaWYgKF9zdWJz\nZWxzID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICBTdWJzZWxlY3Qgc3ViOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgc3ViID0gKFN1\nYnNlbGVjdCkgX3N1YnNlbHMuZ2V0KGkpOwogICAgICAgICAgICBpZiAoc3Vi\nLnNlbGVjdCA9PSBvbGQpIHsKICAgICAgICAgICAgICAgIHN1Yi5zZWxlY3Qg\nPSBzZWw7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAg\nKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoT2JqZWN0IG8p\nIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUobywgbnVsbCk7CiAgICB9\nCiAgICAKICAgIC8qKgogICAgICogQXBwZW5kIGEgc3lzdGVtIGluc2VydGVk\nIHBhcmFtZXRlciB2YWx1ZSBmb3IgYSBzcGVjaWZpYyBjb2x1bW4uCiAgICAg\nKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoT2JqZWN0IG8s\nIENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUobywg\nY29sLCBudWxsKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBcHBlbmQg\nYSB1c2VyIHBhcmFtZXRlciB2YWx1ZSBmb3IgYSBzcGVjaWZpYyBjb2x1bW4u\nIFVzZXIgcGFyYW1ldGVycwogICAgICogYXJlIG1hcmtlZCBhcyBvcHBvc2Vk\nIHRvIHRoZSBwYXJhbWV0ZXJzIGluc2VydGVkIGJ5IHRoZSBpbnRlcm5hbCBy\ndW50aW1lCiAgICAgKiBzeXN0ZW0uIFRoaXMgaGVscHMgdG8gcmV1c2UgdGhl\nIGJ1ZmZlciBieSByZXBhcm1ldGVyaXppbmcgaXQgd2l0aCBuZXcKICAgICAq\nIHNldCBvZiB1c2VyIHBhcmFtZXRlcnMgd2hpbGUgdGhlICdpbnRlcm5hbCcg\ncGFyYW1ldGVycyByZW1haW4gdW5jaGFuZ2VkLgogICAgICogCiAgICAgKiBA\ncGFyYW0gdXNlclBhcmFtIGlmIG5vbi1udWxsLCBkZXNpZ25hdGVzIGEgJ3Vz\nZXInIHBhcmFtZXRlci4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBh\ncHBlbmRWYWx1ZShPYmplY3QgbywgQ29sdW1uIGNvbCwgUGFyYW1ldGVyIHVz\nZXJQYXJhbSkgewogICAgICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAg\nIF9zcWwuYXBwZW5kKCJOVUxMIik7CiAgICAgICAgZWxzZSBpZiAobyBpbnN0\nYW5jZW9mIFJhdykKICAgICAgICAgICAgX3NxbC5hcHBlbmQoby50b1N0cmlu\nZygpKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgX3NxbC5hcHBlbmQo\nUEFSQU1FVEVSX1RPS0VOKTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUg\ncGFyYW0gYW5kIGNvbCBsaXN0czsgd2UgaG9sZCBvZmYgb24gY29sIGxpc3Qg\ndW50aWwKICAgICAgICAgICAgLy8gd2UgZ2V0IHRoZSBmaXJzdCBub24tbnVs\nbCBjb2wKICAgICAgICAgICAgaWYgKF9wYXJhbXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIF9wYXJhbXMgPSBuZXcgQXJyYXlMaXN0KCk7CiAgICAgICAg\nICAgIGlmIChjb2wgIT0gbnVsbCAmJiBfY29scyA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBfY29scyA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAg\nICAgICAgIHdoaWxlIChfY29scy5zaXplKCkgPCBfcGFyYW1zLnNpemUoKSkK\nICAgICAgICAgICAgICAgICAgICBfY29scy5hZGQobnVsbCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIF9wYXJhbXMuYWRkKG8pOwogICAgICAgICAg\nICBpZiAodXNlclBhcmFtICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlm\nIChfdXNlckluZGV4ID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3Vz\nZXJJbmRleCA9IG5ldyBBcnJheUxpc3QoKTsKICAgICAgICAgICAgICAgIGlu\ndCBpbmRleCA9IF9wYXJhbXMuc2l6ZSgpLTE7CiAgICAgICAgICAgICAgICBf\ndXNlckluZGV4LmFkZChpbmRleCk7CiAgICAgICAgICAgICAgICBfdXNlcklu\nZGV4LmFkZCh1c2VyUGFyYW0uZ2V0UGFyYW1ldGVyS2V5KCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChfY29scyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgX2NvbHMuYWRkKGNvbCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFy\nYW1ldGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFw\ncGVuZFZhbHVlKGJvb2xlYW4gYikgewogICAgICAgIHJldHVybiBhcHBlbmRW\nYWx1ZShiLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBh\nIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZl\nciBhcHBlbmRWYWx1ZShib29sZWFuIGIsIENvbHVtbiBjb2wpIHsKICAgICAg\nICByZXR1cm4gYXBwZW5kVmFsdWUoKGIpID8gQm9vbGVhbi5UUlVFIDogQm9v\nbGVhbi5GQUxTRSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVu\nZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1\nZmZlciBhcHBlbmRWYWx1ZShieXRlIGIpIHsKICAgICAgICByZXR1cm4gYXBw\nZW5kVmFsdWUoYiwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBl\nbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxC\ndWZmZXIgYXBwZW5kVmFsdWUoYnl0ZSBiLCBDb2x1bW4gY29sKSB7CiAgICAg\nICAgcmV0dXJuIGFwcGVuZFZhbHVlKG5ldyBCeXRlKGIpLCBjb2wpOwogICAg\nfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgog\nICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKGNoYXIg\nYykgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShjLCBudWxsKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4K\nICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShjaGFy\nIGMsIENvbHVtbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUo\nbmV3IENoYXJhY3RlcihjKSwgY29sKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVibGlj\nIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShkb3VibGUgZCkgewogICAgICAgIHJl\ndHVybiBhcHBlbmRWYWx1ZShkLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAgcHVi\nbGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShkb3VibGUgZCwgQ29sdW1uIGNv\nbCkgewogICAgICAgIHJldHVybiBhcHBlbmRWYWx1ZShuZXcgRG91YmxlKGQp\nLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogQXBwZW5kIGEgcGFyYW1l\ndGVyIHZhbHVlLgogICAgICovCiAgICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVu\nZFZhbHVlKGZsb2F0IGYpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUo\nZiwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJh\nbWV0ZXIgdmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBw\nZW5kVmFsdWUoZmxvYXQgZiwgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVy\nbiBhcHBlbmRWYWx1ZShuZXcgRmxvYXQoZiksIGNvbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUoaW50IGkpIHsKICAg\nICAgICByZXR1cm4gYXBwZW5kVmFsdWUoSW50ZWdlci52YWx1ZU9mKGkpLCBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBhIHBhcmFtZXRl\nciB2YWx1ZS4KICAgICAqLwogICAgcHVibGljIFNRTEJ1ZmZlciBhcHBlbmRW\nYWx1ZShpbnQgaSwgQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVybiBhcHBl\nbmRWYWx1ZShJbnRlZ2VyLnZhbHVlT2YoaSksIGNvbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIgdmFsdWUuCiAgICAgKi8K\nICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFsdWUobG9uZyBsKSB7CiAg\nICAgICAgcmV0dXJuIGFwcGVuZFZhbHVlKExvbmcudmFsdWVPZihsKSwgbnVs\nbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBcHBlbmQgYSBwYXJhbWV0ZXIg\ndmFsdWUuCiAgICAgKi8KICAgIHB1YmxpYyBTUUxCdWZmZXIgYXBwZW5kVmFs\ndWUobG9uZyBsLCBDb2x1bW4gY29sKSB7CiAgICAgICAgcmV0dXJuIGFwcGVu\nZFZhbHVlKExvbmcudmFsdWVPZihsKSwgY29sKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEFwcGVuZCBhIHBhcmFtZXRlciB2YWx1ZS4KICAgICAqLwogICAg\ncHVibGljIFNRTEJ1ZmZlciBhcHBlbmRWYWx1ZShzaG9ydCBzKSB7CiAgICAg\nICAgcmV0dXJuIGFwcGVuZFZhbHVlKHMsIG51bGwpOwogICAgfQoKICAgIC8q\nKgogICAgICogQXBwZW5kIGEgcGFyYW1ldGVyIHZhbHVlLgogICAgICovCiAg\nICBwdWJsaWMgU1FMQnVmZmVyIGFwcGVuZFZhbHVlKHNob3J0IHMsIENvbHVt\nbiBjb2wpIHsKICAgICAgICByZXR1cm4gYXBwZW5kVmFsdWUobmV3IFNob3J0\nKHMpLCBjb2wpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBs\naXN0IG9mIHBhcmFtZXRlciB2YWx1ZXMuCiAgICAgKi8KICAgIHB1YmxpYyBM\naXN0IGdldFBhcmFtZXRlcnMoKSB7CiAgICAgICAgcmV0dXJuIChfcGFyYW1z\nID09IG51bGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IF9wYXJhbXM7\nCiAgICB9CiAgICAKICAgIC8qKgogICAgICogR2V0IHRoZSB1c2VyIHBhcmFt\nZXRlciBwb3NpdGlvbnMgaW4gdGhlIGxpc3Qgb2YgcGFyYW1ldGVycy4gVGhl\nIG9kZCAKICAgICAqIGVsZW1lbnQgb2YgdGhlIHJldHVybmVkIGxpc3QgY29u\ndGFpbnMgYW4gaW50ZWdlciBpbmRleCB0aGF0IHJlZmVycwogICAgICogdG8g\ndGhlIHBvc2l0aW9uIGluIHRoZSB7QGxpbmsgI2dldFBhcmFtZXRlcnMoKX0g\nbGlzdC4gVGhlIGV2ZW4gZWxlbWVudAogICAgICogb2YgdGhlIHJldHVybmVk\nIGxpc3QgcmVmZXJzIHRvIHRoZSB1c2VyIHBhcmFtZXRlciBrZXkuIAogICAg\nICogVGhpcyBzdHJ1Y3R1cmUgaXMgcHJlZmVycmVkIG92ZXIgYSBub3JtYWwg\nbWFwIGJlY2F1c2UgYSB1c2VyIHBhcmFtZXRlciAKICAgICAqIG1heSBvY2N1\nciBtb3JlIHRoYW4gb25lIGluIHRoZSBwYXJhbWV0ZXJzLiAKICAgICAqLwog\nICAgcHVibGljIExpc3QgZ2V0VXNlclBhcmFtZXRlcnMoKSB7CiAgICAgICAg\naWYgKF91c2VySW5kZXggPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIENv\nbGxlY3Rpb25zLkVNUFRZX0xJU1Q7CiAgICAgICAgcmV0dXJuIF91c2VySW5k\nZXg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIFNRTCBmb3Ig\ndGhpcyBidWZmZXIuCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0U1FM\nKCkgewogICAgICAgIHJldHVybiBnZXRTUUwoZmFsc2UpOwogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIFNRTCBmb3IgdGhpcyBidWZm\nZXIuCiAgICAgKgogICAgICogQHBhcmFtIHJlcGxhY2VQYXJhbXMgaWYgdHJ1\nZSwgdGhlbiByZXBsYWNlIHBhcmFtZXRlcnMgd2l0aCB0aGUKICAgICAqIGFj\ndHVhbCBwYXJhbWV0ZXIgdmFsdWVzCiAgICAgKi8KICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0U1FMKGJvb2xlYW4gcmVwbGFjZVBhcmFtcykgewogICAgICAgIHJl\nc29sdmVTdWJzZWxlY3RzKCk7CiAgICAgICAgU3RyaW5nIHNxbCA9IF9zcWwu\ndG9TdHJpbmcoKTsKICAgICAgICBpZiAoIXJlcGxhY2VQYXJhbXMgfHwgX3Bh\ncmFtcyA9PSBudWxsIHx8IF9wYXJhbXMuaXNFbXB0eSgpKQogICAgICAgICAg\nICByZXR1cm4gc3FsOwoKICAgICAgICBTdHJpbmdCdWlsZGVyIGJ1ZiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgSXRlcmF0b3IgcGkgPSBfcGFy\nYW1zLml0ZXJhdG9yKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ncWwubGVuZ3RoKCk7IGkrKykgewogICAgICAgICAgICBpZiAoc3FsLmNoYXJB\ndChpKSAhPSAnPycpIHsKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoc3Fs\nLmNoYXJBdChpKSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgT2JqZWN0IHBhcmFtID0gcGkuaGFzTmV4\ndCgpID8gcGkubmV4dCgpIDogbnVsbDsKICAgICAgICAgICAgaWYgKHBhcmFt\nID09IG51bGwpCiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKCJOVUxMIik7\nCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcmFtIGluc3RhbmNlb2YgTnVtYmVy\nIHx8IHBhcmFtIGluc3RhbmNlb2YgQm9vbGVhbikKICAgICAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQocGFyYW0pOwogICAgICAgICAgICBlbHNlIGlmIChwYXJh\nbSBpbnN0YW5jZW9mIFN0cmluZyB8fCBwYXJhbSBpbnN0YW5jZW9mIENoYXJh\nY3RlcikKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiciKS5hcHBlbmQo\ncGFyYW0pLmFwcGVuZCgiJyIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBidWYuYXBwZW5kKCI/Iik7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBidWYudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nc29sdmUgb3VyIGRlbGF5ZWQgc3Vic2VsZWN0cy4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIHJlc29sdmVTdWJzZWxlY3RzKCkgewogICAgICAgIGlmIChf\nc3Vic2VscyA9PSBudWxsIHx8IF9zdWJzZWxzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBhZGQgc3Vic2VscyBiYWNrd2Fy\nZHMgc28gdGhhdCB0aGUgc3RvcmVkIGluc2VydGlvbiBwb2ludHMgb2YKICAg\nICAgICAvLyBsYXRlciBzdWJzZWxzIHJlbWFpbiB2YWxpZAogICAgICAgIFN1\nYnNlbGVjdCBzdWI7CiAgICAgICAgU1FMQnVmZmVyIGJ1ZjsKICAgICAgICBm\nb3IgKGludCBpID0gX3N1YnNlbHMuc2l6ZSgpIC0gMTsgaSA+PSAwOyBpLS0p\nIHsKICAgICAgICAgICAgc3ViID0gKFN1YnNlbGVjdCkgX3N1YnNlbHMuZ2V0\nKGkpOwogICAgICAgICAgICBpZiAoc3ViLmNvdW50KQogICAgICAgICAgICAg\nICAgYnVmID0gc3ViLnNlbGVjdC50b1NlbGVjdENvdW50KCk7CiAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgIGJ1ZiA9IHN1Yi5zZWxlY3QudG9T\nZWxlY3QoZmFsc2UsIHN1Yi5mZXRjaCk7CiAgICAgICAgICAgIGJ1Zi5yZXNv\nbHZlU3Vic2VsZWN0cygpOwogICAgICAgICAgICBhcHBlbmQoYnVmLCBzdWIu\nc3FsSW5kZXgsIHN1Yi5wYXJhbUluZGV4LCBmYWxzZSk7CiAgICAgICAgfQog\nICAgICAgIF9zdWJzZWxzLmNsZWFyKCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYW5kIHBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGEgcHJl\ncGFyZWQgc3RhdGVtZW50IHVzaW5nCiAgICAgKiB0aGUgU1FMIGluIHRoaXMg\nYnVmZmVyLgogICAgICovCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQg\ncHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVTdGF0\nZW1lbnQoY29ubiwgUmVzdWx0U2V0LlRZUEVfRk9SV0FSRF9PTkxZLAogICAg\nICAgICAgICBSZXN1bHRTZXQuQ09OQ1VSX1JFQURfT05MWSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYW5kIHBvcHVsYXRlIHRoZSBwYXJhbWV0\nZXJzIG9mIGEgcHJlcGFyZWQgc3RhdGVtZW50IHVzaW5nCiAgICAgKiB0aGUg\nU1FMIGluIHRoaXMgYnVmZmVyLgogICAgICovCiAgICBwdWJsaWMgUHJlcGFy\nZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRlbWVudChDb25uZWN0aW9uIGNvbm4s\nIGludCByc1R5cGUsCiAgICAgICAgaW50IHJzQ29uY3VyKQogICAgICAgIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBwcmVwYXJlU3Rh\ndGVtZW50KGNvbm4sIG51bGwsIHJzVHlwZSwgcnNDb25jdXIpOwogICAgfQoK\nICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBwb3B1bGF0ZSB0aGUgcGFyYW1l\ndGVycyBvZiBhIHByZXByZWQgc3RhdGVtZW50IHVzaW5nIHRoZQogICAgICog\nU1FMIGluIHRoaXMgYnVmZmVyIGFuZCB0aGUgZ2l2ZW4gZmV0Y2ggY29uZmln\ndXJhdGlvbi4KICAgICAqLwogICAgcHVibGljIFByZXBhcmVkU3RhdGVtZW50\nIHByZXBhcmVTdGF0ZW1lbnQoQ29ubmVjdGlvbiBjb25uLAogICAgICAgIEpE\nQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIGludCByc1R5cGUsIGludCBy\nc0NvbmN1cikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAocnNUeXBlID09IC0xICYmIGZldGNoID09IG51bGwpCiAgICAgICAg\nICAgIHJzVHlwZSA9IFJlc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWTsKICAg\nICAgICBlbHNlIGlmIChyc1R5cGUgPT0gLTEpCiAgICAgICAgICAgIHJzVHlw\nZSA9IGZldGNoLmdldFJlc3VsdFNldFR5cGUoKTsKICAgICAgICBpZiAocnND\nb25jdXIgPT0gLTEpCiAgICAgICAgICAgIHJzQ29uY3VyID0gUmVzdWx0U2V0\nLkNPTkNVUl9SRUFEX09OTFk7CgogICAgICAgIFByZXBhcmVkU3RhdGVtZW50\nIHN0bW50OwogICAgICAgIGlmIChyc1R5cGUgPT0gUmVzdWx0U2V0LlRZUEVf\nRk9SV0FSRF9PTkxZCiAgICAgICAgICAgICYmIHJzQ29uY3VyID09IFJlc3Vs\ndFNldC5DT05DVVJfUkVBRF9PTkxZKQogICAgICAgICAgICBzdG1udCA9IGNv\nbm4ucHJlcGFyZVN0YXRlbWVudChnZXRTUUwoKSk7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBzdG1udCA9IGNvbm4ucHJlcGFyZVN0YXRlbWVudChnZXRT\nUUwoKSwgcnNUeXBlLCByc0NvbmN1cik7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgc2V0UGFyYW1ldGVycyhzdG1udCk7CiAgICAgICAgICAgIGlmIChm\nZXRjaCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2guZ2V0\nRmV0Y2hCYXRjaFNpemUoKSA+IDApCiAgICAgICAgICAgICAgICAgICAgc3Rt\nbnQuc2V0RmV0Y2hTaXplKAogICAgICAgICAgICAgICAgICAgICAgICBfZGlj\ndC5nZXRCYXRjaEZldGNoU2l6ZShmZXRjaC5nZXRGZXRjaEJhdGNoU2l6ZSgp\nKSk7CiAgICAgICAgICAgICAgICBpZiAocnNUeXBlICE9IFJlc3VsdFNldC5U\nWVBFX0ZPUldBUkRfT05MWQogICAgICAgICAgICAgICAgICAgICYmIGZldGNo\nLmdldEZldGNoRGlyZWN0aW9uKCkgIT0gUmVzdWx0U2V0LkZFVENIX0ZPUldB\nUkQpCiAgICAgICAgICAgICAgICAgICAgc3RtbnQuc2V0RmV0Y2hEaXJlY3Rp\nb24oZmV0Y2guZ2V0RmV0Y2hEaXJlY3Rpb24oKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIHN0bW50OwogICAgICAgIH0gY2F0Y2ggKFNR\nTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FM\nRXhjZXB0aW9uIHNlMikgewogICAgICAgICAgICB9CiAgICAgICAgICAgIHRo\ncm93IHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSBhbmQgcG9wdWxhdGUgdGhlIHBhcmFtZXRlcnMgb2YgYSBwcmVwYXJlZCBz\ndGF0ZW1lbnQgdXNpbmcKICAgICAqIHRoZSBTUUwgaW4gdGhpcyBidWZmZXIu\nCiAgICAgKi8KICAgIHB1YmxpYyBDYWxsYWJsZVN0YXRlbWVudCBwcmVwYXJl\nQ2FsbChDb25uZWN0aW9uIGNvbm4pCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHByZXBhcmVDYWxsKGNvbm4sIFJlc3Vs\ndFNldC5UWVBFX0ZPUldBUkRfT05MWSwKICAgICAgICAgICAgUmVzdWx0U2V0\nLkNPTkNVUl9SRUFEX09OTFkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3Jl\nYXRlIGFuZCBwb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXBhcmVk\nIHN0YXRlbWVudCB1c2luZwogICAgICogdGhlIFNRTCBpbiB0aGlzIGJ1ZmZl\nci4KICAgICAqLwogICAgcHVibGljIENhbGxhYmxlU3RhdGVtZW50IHByZXBh\ncmVDYWxsKENvbm5lY3Rpb24gY29ubiwgaW50IHJzVHlwZSwKICAgICAgICBp\nbnQgcnNDb25jdXIpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIHByZXBhcmVDYWxsKGNvbm4sIG51bGwsIHJzVHlwZSwg\ncnNDb25jdXIpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuZCBw\nb3B1bGF0ZSB0aGUgcGFyYW1ldGVycyBvZiBhIHByZXByZWQgc3RhdGVtZW50\nIHVzaW5nIHRoZQogICAgICogU1FMIGluIHRoaXMgYnVmZmVyIGFuZCB0aGUg\nZ2l2ZW4gZmV0Y2ggY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgcHVibGlj\nIENhbGxhYmxlU3RhdGVtZW50IHByZXBhcmVDYWxsKENvbm5lY3Rpb24gY29u\nbiwKICAgICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQg\ncnNUeXBlLCBpbnQgcnNDb25jdXIpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHJzVHlwZSA9PSAtMSAmJiBmZXRjaCA9PSBu\ndWxsKQogICAgICAgICAgICByc1R5cGUgPSBSZXN1bHRTZXQuVFlQRV9GT1JX\nQVJEX09OTFk7CiAgICAgICAgZWxzZSBpZiAocnNUeXBlID09IC0xKQogICAg\nICAgICAgICByc1R5cGUgPSBmZXRjaC5nZXRSZXN1bHRTZXRUeXBlKCk7CiAg\nICAgICAgaWYgKHJzQ29uY3VyID09IC0xKQogICAgICAgICAgICByc0NvbmN1\nciA9IFJlc3VsdFNldC5DT05DVVJfUkVBRF9PTkxZOwoKICAgICAgICBDYWxs\nYWJsZVN0YXRlbWVudCBzdG1udDsKICAgICAgICBpZiAocnNUeXBlID09IFJl\nc3VsdFNldC5UWVBFX0ZPUldBUkRfT05MWQogICAgICAgICAgICAmJiByc0Nv\nbmN1ciA9PSBSZXN1bHRTZXQuQ09OQ1VSX1JFQURfT05MWSkKICAgICAgICAg\nICAgc3RtbnQgPSBjb25uLnByZXBhcmVDYWxsKGdldFNRTCgpKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIHN0bW50ID0gY29ubi5wcmVwYXJlQ2FsbChn\nZXRTUUwoKSwgcnNUeXBlLCByc0NvbmN1cik7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgc2V0UGFyYW1ldGVycyhzdG1udCk7CiAgICAgICAgICAgIGlm\nIChmZXRjaCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2gu\nZ2V0RmV0Y2hCYXRjaFNpemUoKSA+IDApCiAgICAgICAgICAgICAgICAgICAg\nc3RtbnQuc2V0RmV0Y2hTaXplKAogICAgICAgICAgICAgICAgICAgICAgICBf\nZGljdC5nZXRCYXRjaEZldGNoU2l6ZShmZXRjaC5nZXRGZXRjaEJhdGNoU2l6\nZSgpKSk7CiAgICAgICAgICAgICAgICBpZiAocnNUeXBlICE9IFJlc3VsdFNl\ndC5UWVBFX0ZPUldBUkRfT05MWQogICAgICAgICAgICAgICAgICAgICYmIGZl\ndGNoLmdldEZldGNoRGlyZWN0aW9uKCkgIT0gUmVzdWx0U2V0LkZFVENIX0ZP\nUldBUkQpCiAgICAgICAgICAgICAgICAgICAgc3RtbnQuc2V0RmV0Y2hEaXJl\nY3Rpb24oZmV0Y2guZ2V0RmV0Y2hEaXJlY3Rpb24oKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIHN0bW50OwogICAgICAgIH0gY2F0Y2gg\nKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgc3RtbnQuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nU1FMRXhjZXB0aW9uIHNlMikgewogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRocm93IHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFBv\ncHVsYXRlIHRoZSBwYXJhbWV0ZXJzIG9mIGFuIGV4aXN0aW5nIFByZXBhcmVk\nU3RhdGVtZW50CiAgICAgKiB3aXRoIHZhbHVlcyBmcm9tIHRoaXMgYnVmZmVy\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRQYXJhbWV0ZXJzKFByZXBh\ncmVkU3RhdGVtZW50IHBzKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIGlmIChfcGFyYW1zID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgQ29sdW1uIGNvbDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IF9wYXJhbXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAg\nY29sID0gKF9jb2xzID09IG51bGwpID8gbnVsbCA6IChDb2x1bW4pIF9jb2xz\nLmdldChpKTsKICAgICAgICAgICAgX2RpY3Quc2V0VW5rbm93bihwcywgaSAr\nIDEsIF9wYXJhbXMuZ2V0KGkpLCBjb2wpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgaW50IGhhc2hDb2RlKCkgewogICAgICAgIGludCBoYXNoID0g\nX3NxbC5oYXNoQ29kZSgpOwogICAgICAgIHJldHVybiAoX3BhcmFtcyA9PSBu\ndWxsKSA/IGhhc2ggOiBoYXNoIF4gX3BhcmFtcy5oYXNoQ29kZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ29tcGFyZSBpbnRlcm5hbCBTUUwgd2l0aG91\ndCByZXNvbHZpbmcgc3Vic2VsZWN0cyBvciBzdHJpbmdpZnlpbmcKICAgICAq\nIHBhcmFtZXRlcnMuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIHNxbEVx\ndWFscyhTdHJpbmcgc3FsKSB7CiAgICAgICAgcmV0dXJuIF9zcWwudG9TdHJp\nbmcoKS5lcXVhbHMoc3FsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IHRo\naXMpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGlmICghKG90\naGVyIGluc3RhbmNlb2YgU1FMQnVmZmVyKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICBTUUxCdWZmZXIgYnVmID0gKFNRTEJ1ZmZlcikg\nb3RoZXI7CiAgICAgICAgcmV0dXJuIF9zcWwuZXF1YWxzKGJ1Zi5fc3FsKQog\nICAgICAgICAgICAmJiBPYmplY3RVdGlscy5lcXVhbHMoX3BhcmFtcywgYnVm\nLl9wYXJhbXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZSBTUUwg\nJz8nIHdpdGggQ0FTVCBzdHJpbmcgaWYgcmVxdWlyZWQgYnkgREIgcGxhdGZv\ncm0KICAgICAqIEBwYXJhbSBvcGVyCiAgICAgKiBAcGFyYW0gdmFsCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGFkZENhc3RGb3JQYXJhbShTdHJpbmcgb3Bl\nciwgVmFsIHZhbCkgewogICAgICAgIGlmIChfc3FsLmNoYXJBdChfc3FsLmxl\nbmd0aCgpIC0gMSkgPT0gJz8nKSB7CiAgICAgICAgICAgIFN0cmluZyBjYXN0\nU3RyaW5nID0gX2RpY3QuYWRkQ2FzdEFzVHlwZShvcGVyLCB2YWwpOwogICAg\nICAgICAgICBpZiAoY2FzdFN0cmluZyAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX3NxbC5yZXBsYWNlKF9zcWwubGVuZ3RoKCkgLSAxLCBfc3FsLmxlbmd0\naCgpLCBjYXN0U3RyaW5nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXBsYWNlIGN1cnJlbnQgYnVmZmVyIHN0cmluZyB3aXRoIHRoZSBu\nZXcgc3RyaW5nCiAgICAgKiAKICAgICAqIEBwYXJhbSBzdGFydCByZXBsYWNl\nIHN0YXJ0IHBvc2l0aW9uCiAgICAgKiBAcGFyYW0gZW5kIHJlcGxhY2UgZW5k\nIHBvc2l0aW9uCiAgICAgKiBAcGFyYW0gbmV3U3RyaW5nCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHJlcGxhY2VTcWxTdHJpbmcoaW50IHN0YXJ0LCBpbnQg\nZW5kLCBTdHJpbmcgbmV3U3RyaW5nKSB7CiAgICAgICAgX3NxbC5yZXBsYWNl\nKHN0YXJ0LCBlbmQsIG5ld1N0cmluZyk7CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUmVwcmVzZW50cyBhIHN1YnNlbGVjdC4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgU3Vic2VsZWN0IHsKCiAgICAgICAgcHVibGlj\nIFNlbGVjdCBzZWxlY3Q7CiAgICAgICAgcHVibGljIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2g7CiAgICAgICAgcHVibGljIGJvb2xlYW4gY291bnQ7\nCiAgICAgICAgcHVibGljIGludCBzcWxJbmRleDsKICAgICAgICBwdWJsaWMg\naW50IHBhcmFtSW5kZXg7CgogICAgICAgIHB1YmxpYyBTdWJzZWxlY3QgY2xv\nbmUoaW50IHNxbEluZGV4LCBpbnQgcGFyYW1JbmRleCkgewogICAgICAgICAg\nICBpZiAoc3FsSW5kZXggPT0gMCAmJiBwYXJhbUluZGV4ID09IDApCiAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgICAgIFN1YnNlbGVj\ndCBzdWIgPSBuZXcgU3Vic2VsZWN0KCk7CiAgICAgICAgICAgIHN1Yi5zZWxl\nY3QgPSBzZWxlY3Q7CiAgICAgICAgICAgIHN1Yi5mZXRjaCA9IGZldGNoOwog\nICAgICAgICAgICBzdWIuY291bnQgPSBjb3VudDsKICAgICAgICAgICAgc3Vi\nLnNxbEluZGV4ID0gdGhpcy5zcWxJbmRleCArIHNxbEluZGV4OwogICAgICAg\nICAgICBzdWIucGFyYW1JbmRleCA9IHRoaXMucGFyYW1JbmRleCArIHBhcmFt\nSW5kZXg7CiAgICAgICAgICAgIHJldHVybiBzdWI7CiAgICAgICAgfQogICAg\nfQogICAgCiAgICBwdWJsaWMgdm9pZCBzZXRQYXJhbWV0ZXJzKExpc3QgcGFy\nYW1zKSB7CiAgICAgICAgX3BhcmFtcyA9IHBhcmFtczsKICAgIH0KICAgIAog\nICAgcHVibGljIExpc3QgZ2V0Q29sdW1ucygpIHsKICAgICAgICByZXR1cm4g\nX2NvbHM7CiAgICB9Cn0K\n","encoding":"base64"}

