{"sha":"0adfc04de0e0fd8fd2e585e7c01b3422b7ebceab","node_id":"MDQ6QmxvYjIwNjM2NDowYWRmYzA0ZGUwZTBmZDhmZDJlNTg1ZTdjMDFiMzQyMmI3ZWJjZWFi","size":13071,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/0adfc04de0e0fd8fd2e585e7c01b3422b7ebceab","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZSBvciBtb3JlCiAqIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gU2VlIHRoZSBOT1RJQ0UgZmlsZSBkaXN0cmli\ndXRlZCB3aXRoIHRoaXMKICogd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1h\ndGlvbiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gVGhlIEFTRgog\nKiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdp\ndGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0\naGUgTGljZW5zZSBhdAogKiAKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xp\nY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqIAogKiBVbmxlc3MgcmVxdWlyZWQgYnkg\nYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3\nYXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3Ry\naWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQKICogV0FSUkFO\nVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVz\ncyBvciBpbXBsaWVkLiBTZWUgdGhlCiAqIExpY2Vuc2UgZm9yIHRoZSBzcGVj\naWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0\nYXRpb25zIHVuZGVyCiAqIHRoZSBMaWNlbnNlLgogKi8KcGFja2FnZSBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQgamF2YS5pby5JbnB1\ndFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uUmVhZGVyOwppbXBvcnQgamF2YS5z\ncWwuQmxvYjsKaW1wb3J0IGphdmEuc3FsLkNsb2I7CmltcG9ydCBqYXZhLnNx\nbC5Db25uZWN0aW9uOwppbXBvcnQgamF2YS5zcWwuRGF0YWJhc2VNZXRhRGF0\nYTsKaW1wb3J0IGphdmEuc3FsLlJlc3VsdFNldDsKaW1wb3J0IGphdmEuc3Fs\nLlNRTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuc3FsLlR5cGVzOwppbXBvcnQg\namF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5pZGVudGlmaWVyLkRCSWRlbnRpZmllcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuZXhwcy5GaWx0ZXJWYWx1ZTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLnNjaGVtYS5Db2x1bW47Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbHRlcnM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuU3RvcmVFeGNlcHRpb247CgoKLyoq\nCiAqIERpY3Rpb25hcnkgZm9yIE1pY3Jvc29mdCBTUUwgU2VydmVyLgogKi8K\ncHVibGljIGNsYXNzIFNRTFNlcnZlckRpY3Rpb25hcnkgZXh0ZW5kcyBBYnN0\ncmFjdFNRTFNlcnZlckRpY3Rpb25hcnkgewoKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgU3RyaW5nIFZFTkRPUl9NSUNST1NPRlQgPSAibWljcm9zb2Z0IjsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFZFTkRPUl9ORVRESVJF\nQ1QgPSAibmV0ZGlyZWN0IjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry\naW5nIFZFTkRPUl9KVERTID0gImp0ZHMiOwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0KICAgICAgICBMb2NhbGl6ZXIuZm9y\nUGFja2FnZShTUUxTZXJ2ZXJEaWN0aW9uYXJ5LmNsYXNzKTsKCiAgICBwcml2\nYXRlIFN0cmluZyBzY2hlbWFDYXNlID0gU0NIRU1BX0NBU0VfUFJFU0VSVkU7\nCiAgICAvKioKICAgICAqIEZsYWcgd2hldGhlciB0byB0cmVhdCBVTklRVUVJ\nREVOVElGSUVSIGFzIFZBUkJJTkFSWSBvciBWQVJDSEFSCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIHVuaXF1ZUlkZW50aWZpZXJBc1ZhcmJpbmFyeSA9\nIHRydWU7CgogICAgcHVibGljIFNRTFNlcnZlckRpY3Rpb25hcnkoKSB7CiAg\nICAgICAgcGxhdGZvcm0gPSAiTWljcm9zb2Z0IFNRTCBTZXJ2ZXIiOwogICAg\nICAgIC8vIFNRTFNlcnZlciBsb2NrcyBvbiBhIHRhYmxlLWJ5LXRhYmxlIGJh\nc2lzCiAgICAgICAgZm9yVXBkYXRlQ2xhdXNlID0gbnVsbDsKICAgICAgICB0\nYWJsZUZvclVwZGF0ZUNsYXVzZSA9ICJXSVRIIChVUERMT0NLKSI7CiAgICAg\nICAgc3VwcG9ydHNOdWxsVGFibGVGb3JHZXRDb2x1bW5zID0gZmFsc2U7CiAg\nICAgICAgcmVxdWlyZXNBbGlhc0ZvclN1YnNlbGVjdCA9IHRydWU7CiAgICAg\nICAgc3RyaW5nTGVuZ3RoRnVuY3Rpb24gPSAiTEVOKHswfSkiOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGNvbm5lY3RlZENvbmZpZ3VyYXRpb24oQ29ubmVj\ndGlvbiBjb25uKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBzdXBl\nci5jb25uZWN0ZWRDb25maWd1cmF0aW9uKGNvbm4pOwogICAgICAgIGJvb2xl\nYW4gcmVxdWlyZXNXYXJuaW5ncyA9IHRydWU7CiAgICAgICAgRGF0YWJhc2VN\nZXRhRGF0YSBtZXRhID0gY29ubi5nZXRNZXRhRGF0YSgpOwogICAgICAgIFN0\ncmluZyBkcml2ZXJOYW1lID0gbWV0YS5nZXREcml2ZXJOYW1lKCk7CiAgICAg\nICAgU3RyaW5nIHVybCA9IG1ldGEuZ2V0VVJMKCk7CiAgICAgICAgaWYgKGRy\naXZlclZlbmRvciA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChkcml2ZXJO\nYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChkcml2ZXJOYW1l\nLnN0YXJ0c1dpdGgoIk1pY3Jvc29mdCBTUUwgU2VydmVyIikpIHsKICAgICAg\nICAgICAgICAgICAgICAvLyB2MS4xLCAxLjIgb3IgMi4wIGRyaXZlcgogICAg\nICAgICAgICAgICAgICAgIGRyaXZlclZlbmRvciA9IFZFTkRPUl9NSUNST1NP\nRlQ7CiAgICAgICAgICAgICAgICAgICAgLy8gc2VydmVyTWFqb3JWZXJzaW9u\nIG9mIDg9PTIwMDAsIDk9PTIwMDUsIDEwPT0yMDA4CiAgICAgICAgICAgICAg\nICAgICAgaWYgKG1ldGEuZ2V0RGF0YWJhc2VNYWpvclZlcnNpb24oKSA+PSA5\nKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRTdXBwb3J0c1hNTENvbHVt\nbih0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWV0YS5nZXREcml2\nZXJNYWpvclZlcnNpb24oKSA+PSAyKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHNlZSBodHRwOi8vYmxvZ3MubXNkbi5jb20vamRiY3RlYW0vYXJj\naGl2ZS8yMDA3LzA1L1wKICAgICAgICAgICAgICAgICAgICAgICAgLy8gMDIv\nd2hhdC1pcy1hZGFwdGl2ZS1yZXNwb25zZS1idWZmZXJpbmctYW5kLXdoeS1c\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3VsZC1pLXVzZS1pdC5h\nc3B4CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIuMCBkcml2ZXIgY29u\nbmVjdFVSTCBhdXRvbWF0aWNhbGx5IGluY2x1ZGVzCiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIHJlc3BvbnNlQnVmZmVyaW5nPWFkYXB0aXZlCiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIGFuZCBkaXNhYmxlU3RhdGVtZW50UG9v\nbGluZz10cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVzV2Fy\nbmluZ3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgiTmV0\nRGlyZWN0IEpTUUxDb25uZWN0Ii5lcXVhbHMoZHJpdmVyTmFtZSkpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGRyaXZlclZlbmRvciA9IFZFTkRPUl9ORVRE\nSVJFQ1Q7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZHJpdmVyTmFt\nZS5zdGFydHNXaXRoKCJqVERTIikpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGRyaXZlclZlbmRvciA9IFZFTkRPUl9KVERTOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UgaWYgKCJTUUxTZXJ2ZXIiLmVxdWFscyhkcml2ZXJOYW1lKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXJsICE9IG51bGwgJiYK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5zdGFydHNXaXRoKCJq\nZGJjOm1pY3Jvc29mdDpzcWxzZXJ2ZXI6IikpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfTUlDUk9TT0ZUOwog\nICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh1cmwgIT0gbnVsbCAm\nJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLnN0YXJ0c1dpdGgo\nImpkYmM6ZGF0YWRpcmVjdDpzcWxzZXJ2ZXI6IikpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBWRU5ET1JfREFUQURJUkVD\nVDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZHJpdmVyVmVuZG9yID0gVkVORE9SX09USEVSOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBv\nbGQgd2F5IG9mIGRldGVybWluaW5nIHhtbCBzdXBwb3J0CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGRyaXZlck5hbWUuaW5kZXhPZihwbGF0Zm9ybSkgIT0g\nLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHZlcnNpb25T\ndHJpbmcgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJpdmVyTmFt\nZS5zdWJzdHJpbmcocGxhdGZvcm0ubGVuZ3RoKCkgKyAxKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHZlcnNpb25TdHJpbmcuaW5kZXhPZigiICIp\nICE9IC0xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvblN0\ncmluZyA9IHZlcnNpb25TdHJpbmcuc3Vic3RyaW5nKDAsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdmVyc2lvblN0cmluZy5pbmRleE9mKCIg\nIikpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnQgdmVyc2lvbiA9IElu\ndGVnZXIucGFyc2VJbnQodmVyc2lvblN0cmluZyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICh2ZXJzaW9uID49IDIwMDUpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBzZXRTdXBwb3J0c1hNTENvbHVtbih0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkcml2ZXJWZW5kb3IgPSBW\nRU5ET1JfT1RIRVI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIHdhcm4gYWJvdXQgbm90IHVzaW5nIGN1cnNvcnMgZm9yIHByZS0yLjAg\nTVMgZHJpdmVyCiAgICAgICAgLy8gYXMgY29ubmVjdFVSTCBpbmNsdWRlcyBz\nZWxlY3RNZXRob2Q9ZGlyZWN0CiAgICAgICAgaWYgKCgoVkVORE9SX01JQ1JP\nU09GVC5lcXVhbHNJZ25vcmVDYXNlKGRyaXZlclZlbmRvcikgJiYKICAgICAg\nICAgICAgcmVxdWlyZXNXYXJuaW5ncykgfHwgCiAgICAgICAgICAgIFZFTkRP\nUl9EQVRBRElSRUNULmVxdWFsc0lnbm9yZUNhc2UoZHJpdmVyVmVuZG9yKSkg\nJiYKICAgICAgICAgICAgKHVybC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoInNl\nbGVjdG1ldGhvZD1jdXJzb3IiKSA9PSAtMSkpCiAgICAgICAgICAgIGxvZy53\nYXJuKF9sb2MuZ2V0KCJzcWxzZXJ2ZXItY3Vyc29yIiwgdXJsKSk7CgogICAg\nICAgIC8vIHdhcm4gYWJvdXQgcHJlcGFyZWQgc3RhdGVtZW50IGNhY2hpbmcg\naWYgdXNpbmcgcHJlLTIuMCBNUyBkcml2ZXJzCiAgICAgICAgLy8gYXMgY29u\nbmVjdFVSTCBpbmNsdWRlcyByZXNwb25zZUJ1ZmZlcmluZz1mdWxsCiAgICAg\nICAgU3RyaW5nIHByb3BzID0gY29uZi5nZXRDb25uZWN0aW9uRmFjdG9yeVBy\nb3BlcnRpZXMoKTsKICAgICAgICBpZiAoKHByb3BzICE9IG51bGwpICYmCiAg\nICAgICAgICAgIFZFTkRPUl9NSUNST1NPRlQuZXF1YWxzSWdub3JlQ2FzZShk\ncml2ZXJWZW5kb3IpICYmCiAgICAgICAgICAgIHJlcXVpcmVzV2FybmluZ3Mg\nJiYKICAgICAgICAgICAgKHByb3BzLnRvTG93ZXJDYXNlKCkuaW5kZXhPZigi\nbWF4Y2FjaGVkc3RhdGVtZW50cz0wIikgPT0gLTEpKQogICAgICAgICAgICBs\nb2cud2FybihfbG9jLmdldCgic3Fsc2VydmVyLWNhY2hlZHN0bW50cyIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgQ29sdW1uW10gZ2V0Q29sdW1ucyhEYXRhYmFz\nZU1ldGFEYXRhIG1ldGEsIFN0cmluZyBjYXRhbG9nLAogICAgICAgIFN0cmlu\nZyBzY2hlbWFOYW1lLCBTdHJpbmcgdGFibGVOYW1lLCBTdHJpbmcgY29sdW1u\nTmFtZSwgQ29ubmVjdGlvbiBjb25uKQogICAgICAgIHRocm93cyBTUUxFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBnZXRDb2x1bW5zKG1ldGEsIERCSWRl\nbnRpZmllci5uZXdDYXRhbG9nKGNhdGFsb2cpLAogICAgICAgICAgICBEQklk\nZW50aWZpZXIubmV3U2NoZW1hKHNjaGVtYU5hbWUpLAogICAgICAgICAgICBE\nQklkZW50aWZpZXIubmV3VGFibGUodGFibGVOYW1lKSwKICAgICAgICAgICAg\nREJJZGVudGlmaWVyLm5ld0NvbHVtbihjb2x1bW5OYW1lKSwKICAgICAgICAg\nICAgY29ubik7CiAgICB9CgogICAgcHVibGljIENvbHVtbltdIGdldENvbHVt\nbnMoRGF0YWJhc2VNZXRhRGF0YSBtZXRhLCBEQklkZW50aWZpZXIgY2F0YWxv\nZywKICAgICAgICBEQklkZW50aWZpZXIgc2NoZW1hTmFtZSwgREJJZGVudGlm\naWVyIHRhYmxlTmFtZSwgREJJZGVudGlmaWVyIGNvbHVtbk5hbWUsIENvbm5l\nY3Rpb24gY29ubikKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKCiAg\nICAgICAgQ29sdW1uW10gY29scyA9IHN1cGVyLmdldENvbHVtbnMobWV0YSwg\nY2F0YWxvZywgc2NoZW1hTmFtZSwgdGFibGVOYW1lLAogICAgICAgICAgICBj\nb2x1bW5OYW1lLCBjb25uKTsKCiAgICAgICAgLy8gZm9yIG9wdGEgZHJpdmVy\nLCB3aGljaCByZXBvcnRzIG52YXJjaGFyIGFzIHVua25vd24gdHlwZQogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBjb2xzICE9IG51bGwgJiYgaSA8IGNvbHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgU3RyaW5nIHR5cGVOYW1lID0g\nY29sc1tpXS5nZXRUeXBlSWRlbnRpZmllcigpLmdldE5hbWUoKTsKICAgICAg\nICAgICAgaWYgKHR5cGVOYW1lID09IG51bGwpCiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgIHR5cGVOYW1lID0gdHlwZU5hbWUudG9V\ncHBlckNhc2UoKTsKICAgICAgICAgICAgaWYgKCJOVkFSQ0hBUiIuZXF1YWxz\nKHR5cGVOYW1lKSkKICAgICAgICAgICAgICAgIGNvbHNbaV0uc2V0VHlwZShU\neXBlcy5WQVJDSEFSKTsKICAgICAgICAgICAgZWxzZSBpZiAoIlVOSVFVRUlE\nRU5USUZJRVIiLmVxdWFscyh0eXBlTmFtZSkpIHsKICAgICAgICAgICAgICAg\nIGlmICh1bmlxdWVJZGVudGlmaWVyQXNWYXJiaW5hcnkpCiAgICAgICAgICAg\nICAgICAgICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLlZBUkJJTkFSWSk7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY29sc1tp\nXS5zZXRUeXBlKFR5cGVzLlZBUkNIQVIpOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKCJOQ0hBUiIuZXF1YWxzKHR5cGVOYW1lKSkKICAgICAgICAgICAgICAg\nIGNvbHNbaV0uc2V0VHlwZShUeXBlcy5DSEFSKTsKICAgICAgICAgICAgZWxz\nZSBpZiAoIk5URVhUIi5lcXVhbHModHlwZU5hbWUpKQogICAgICAgICAgICAg\nICAgY29sc1tpXS5zZXRUeXBlKFR5cGVzLkNMT0IpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gY29sczsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBh\ncHBlbmRMZW5ndGgoU1FMQnVmZmVyIGJ1ZiwgaW50IHR5cGUpIHsKICAgICAg\nICBpZiAodHlwZSA9PSBUeXBlcy5WQVJDSEFSKQogICAgICAgICAgICBidWYu\nYXBwZW5kKCIoIikuYXBwZW5kKEludGVnZXIudG9TdHJpbmcoY2hhcmFjdGVy\nQ29sdW1uU2l6ZSkpCiAgICAgICAgICAgICAgICAuYXBwZW5kKCIpIik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGlzIGRpY3Rpb25hcnkgc3VwcG9y\ndHMgWE1MIHR5cGUsIHVzZSB0aGlzIG1ldGhvZCB0byBhcHBlbmQgeG1sCiAg\nICAgKiBwcmVkaWNhdGUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBidWYgdGhl\nIFNRTCBidWZmZXIgdG8gd3JpdGUgdGhlIGNvbXBhcmlzb24KICAgICAqIEBw\nYXJhbSBvcCB0aGUgY29tcGFyaXNvbiBvcGVyYXRpb24gdG8gcGVyZm9ybQog\nICAgICogQHBhcmFtIGxocyB0aGUgbGVmdCBoYW5kIHNpZGUgb2YgdGhlIGNv\nbXBhcmlzb24KICAgICAqIEBwYXJhbSByaHMgdGhlIHJpZ2h0IGhhbmQgc2lk\nZSBvZiB0aGUgY29tcGFyaXNvbgogICAgICogQHBhcmFtIGxoc3htbCBpbmRp\nY2F0ZXMgd2hldGhlciB0aGUgbGVmdCBvcGVyYW5kIG1hcHMgdG8geG1sCiAg\nICAgKiBAcGFyYW0gcmhzeG1sIGluZGljYXRlcyB3aGV0aGVyIHRoZSByaWdo\ndCBvcGVyYW5kIG1hcHMgdG8geG1sCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFwcGVuZFhtbENvbXBhcmlzb24oU1FMQnVmZmVyIGJ1ZiwgU3RyaW5nIG9w\nLCBGaWx0ZXJWYWx1ZSBsaHMsCiAgICAgICAgRmlsdGVyVmFsdWUgcmhzLCBi\nb29sZWFuIGxoc3htbCwgYm9vbGVhbiByaHN4bWwpIHsKICAgICAgICBzdXBl\nci5hcHBlbmRYbWxDb21wYXJpc29uKGJ1Ziwgb3AsIGxocywgcmhzLCBsaHN4\nbWwsIHJoc3htbCk7CiAgICAgICAgaWYgKGxoc3htbCAmJiByaHN4bWwpCiAg\nICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24yKGJ1Ziwgb3AsIGxocywg\ncmhzKTsKICAgICAgICBlbHNlIGlmIChsaHN4bWwpCiAgICAgICAgICAgIGFw\ncGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwgb3AsIGxocywgcmhzKTsKICAgICAg\nICBlbHNlCiAgICAgICAgICAgIGFwcGVuZFhtbENvbXBhcmlzb24xKGJ1Ziwg\nb3AsIHJocywgbGhzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGVuZCBh\nbiB4bWwgY29tcGFyaXNvbiBwcmVkaWNhdGUKICAgICAqIAogICAgICogQHBh\ncmFtIGJ1ZiB0aGUgU1FMIGJ1ZmZlciB0byB3cml0ZSB0aGUgY29tcGFyaXNv\nbgogICAgICogQHBhcmFtIG9wIHRoZSBjb21wYXJpc29uIG9wZXJhdGlvbiB0\nbyBwZXJmb3JtCiAgICAgKiBAcGFyYW0gbGhzIHRoZSBsZWZ0IGhhbmQgc2lk\nZSBvZiB0aGUgY29tcGFyaXNvbiAobWFwcyB0byB4bWwgY29sdW1uKQogICAg\nICogQHBhcmFtIHJocyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBjb21w\nYXJpc29uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhcHBlbmRYbWxDb21w\nYXJpc29uMShTUUxCdWZmZXIgYnVmLCBTdHJpbmcgb3AsCiAgICAgICAgRmls\ndGVyVmFsdWUgbGhzLCBGaWx0ZXJWYWx1ZSByaHMpIHsKICAgICAgICBib29s\nZWFuIGNhc3RyaHMgPSByaHMuaXNDb25zdGFudCgpOwogICAgICAgIGlmIChj\nYXN0cmhzKQogICAgICAgICAgICBhcHBlbmRYbWxWYWx1ZShidWYsIGxocyk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBhcHBlbmRYbWxFeGlzdChidWYs\nIGxocyk7CiAgICAgICAgYnVmLmFwcGVuZCgiICIpLmFwcGVuZChvcCkuYXBw\nZW5kKCIgIik7CiAgICAgICAgaWYgKGNhc3RyaHMpCiAgICAgICAgICAgIHJo\ncy5hcHBlbmRUbyhidWYpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBi\ndWYuYXBwZW5kKCJzcWw6Y29sdW1uKFwiIik7CiAgICAgICAgICAgIHJocy5h\ncHBlbmRUbyhidWYpOwogICAgICAgICAgICBidWYuYXBwZW5kKCJcIikiKS5h\ncHBlbmQoIl0nKSA9IDEiKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIGFwcGVuZFhtbEV4aXN0KFNRTEJ1ZmZlciBidWYsIEZpbHRlclZh\nbHVlIGxocykgewogICAgICAgIGJ1Zi5hcHBlbmQobGhzLmdldENvbHVtbkFs\naWFzKGxocy5nZXRGaWVsZE1hcHBpbmcoKS5nZXRDb2x1bW5zKClbMF0pKQog\nICAgICAgICAgICAuYXBwZW5kKCIuZXhpc3QoJyIpLmFwcGVuZCgiLypbIik7\nCiAgICAgICAgbGhzLmFwcGVuZFRvKGJ1Zik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBcHBlbmQgYW4geG1sIGNvbXBhcmlzb24gcHJlZGljYXRlIChib3Ro\nIG9wZXJhbmRzIG1hcCB0byB4bWwgY29sdW1uKQogICAgICogCiAgICAgKiBA\ncGFyYW0gYnVmIHRoZSBTUUwgYnVmZmVyIHRvIHdyaXRlIHRoZSBjb21wYXJp\nc29uCiAgICAgKiBAcGFyYW0gb3AgdGhlIGNvbXBhcmlzb24gb3BlcmF0aW9u\nIHRvIHBlcmZvcm0KICAgICAqIEBwYXJhbSBsaHMgdGhlIGxlZnQgaGFuZCBz\naWRlIG9mIHRoZSBjb21wYXJpc29uIChtYXBzIHRvIHhtbCBjb2x1bW4pCiAg\nICAgKiBAcGFyYW0gcmhzIHRoZSByaWdodCBoYW5kIHNpZGUgb2YgdGhlIGNv\nbXBhcmlzb24gKG1hcHMgdG8geG1sIGNvbHVtbikKICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFwcGVuZFhtbENvbXBhcmlzb24yKFNRTEJ1ZmZlciBidWYs\nIFN0cmluZyBvcCwKICAgICAgICBGaWx0ZXJWYWx1ZSBsaHMsIEZpbHRlclZh\nbHVlIHJocykgewogICAgICAgIGFwcGVuZFhtbFZhbHVlKGJ1ZiwgbGhzKTsK\nICAgICAgICBidWYuYXBwZW5kKCIgIikuYXBwZW5kKG9wKS5hcHBlbmQoIiAi\nKTsKICAgICAgICBhcHBlbmRYbWxWYWx1ZShidWYsIHJocyk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGFwcGVuZFhtbFZhbHVlKFNRTEJ1ZmZlciBidWYs\nIEZpbHRlclZhbHVlIHZhbCkgewogICAgICAgIENsYXNzIHJjID0gRmlsdGVy\ncy53cmFwKHZhbC5nZXRUeXBlKCkpOwogICAgICAgIGludCB0eXBlID0gZ2V0\nSkRCQ1R5cGUoSmF2YVR5cGVzLmdldFR5cGVDb2RlKHJjKSwgZmFsc2UpOwog\nICAgICAgIGJvb2xlYW4gaXNYbWxBdHRyaWJ1dGUgPSAodmFsLmdldFhtbE1h\ncHBpbmcoKSA9PSBudWxsKQogICAgICAgICAgICA/IGZhbHNlIDogdmFsLmdl\ndFhtbE1hcHBpbmcoKS5pc1htbEF0dHJpYnV0ZSgpOwogICAgICAgIGJ1Zi5h\ncHBlbmQodmFsLmdldENvbHVtbkFsaWFzKHZhbC5nZXRGaWVsZE1hcHBpbmco\nKS5nZXRDb2x1bW5zKClbMF0pKQogICAgICAgICAgICAuYXBwZW5kKCIudmFs\ndWUoIikuYXBwZW5kKCInKC8qLyIpOwogICAgICAgIHZhbC5hcHBlbmRUbyhi\ndWYpOwogICAgICAgIGlmICghaXNYbWxBdHRyaWJ1dGUpCiAgICAgICAgICAg\nIGJ1Zi5hcHBlbmQoIi90ZXh0KCkiKTsKICAgICAgICBidWYuYXBwZW5kKCIp\nWzFdJywnIikuYXBwZW5kKGdldFR5cGVOYW1lKHR5cGUpKTsKICAgICAgICBh\ncHBlbmRMZW5ndGgoYnVmLCB0eXBlKTsKICAgICAgICBidWYuYXBwZW5kKCIn\nKSIpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIERCIHNwZWNpZmlj\nIHNjaGVtYUNhc2UKICAgICAqLwogICAgcHVibGljIFN0cmluZyBnZXRTY2hl\nbWFDYXNlKCkgewogICAgICAgIHJldHVybiBzY2hlbWFDYXNlOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0U3VwcG9ydHNYTUxD\nb2x1bW4oYm9vbGVhbiBiKSB7CiAgICAgICAgc3VwZXIuc2V0U3VwcG9ydHNY\nTUxDb2x1bW4oYik7CiAgICAgICAgLy8gTVMgU1FMIFNlcnZlciByZXF1aXJl\ncyBYTUwgZGF0YSBpbiBVVEYtMTYgb3IgVUNTLTIgaW5zdGVhZCBvZiBKQVhC\nIGRlZmF1bHQgb2YgVVRGLTgKICAgICAgICBzdXBlci5zZXRYTUxUeXBlRW5j\nb2RpbmcoIlVURi0xNiIpOwogICAgfQogICAgCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBib29sZWFuIGlzRmF0YWxFeGNlcHRpb24oaW50IHN1YnR5cGUs\nICBTUUxFeGNlcHRpb24gZXgpIHsKICAgICAgICBTdHJpbmcgZXJyb3JTdGF0\nZSA9IGV4LmdldFNRTFN0YXRlKCk7CiAgICAgICAgaWYgKChzdWJ0eXBlID09\nIFN0b3JlRXhjZXB0aW9uLkxPQ0sgIHx8IHN1YnR5cGUgPT0gU3RvcmVFeGNl\ncHRpb24uUVVFUlkpCiAgICAgICAgICAmJigiMTIyMiIuZXF1YWxzKGVycm9y\nU3RhdGUpIHx8ICJIWTAwOCIuZXF1YWxzKGVycm9yU3RhdGUpKSkKICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBzdXBlci5pc0ZhdGFs\nRXhjZXB0aW9uKHN1YnR5cGUsIGV4KTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE9idGFpbiBhbiB7QGxpbmsgSW5wdXRTdHJlYW19IGJ5IHVzaW5nIHtAbGlu\nayBSZXN1bHRTZXQjZ2V0QmxvYihpbnQpfSBhbmQKICAgICAqIHtAbGluayBC\nbG9iI2dldEJpbmFyeVN0cmVhbSgpfS4KICAgICAqIFVuZm9ydHVuYXRlbHkg\ndGhpcyB3aWxsIGxvYWQgZW50aXJlIEJMT0IgaW50byBtZW1vcnkuCiAgICAg\nKiBUaGUgYWx0ZXJuYXRpdmUge0BsaW5rIFJlc3VsdFNldCNnZXRCaW5hcnlT\ndHJlYW0oaW50KX0gcHJvdmlkZXMgdHJ1ZSBzdHJlYW1pbmcgYnV0CiAgICAg\nKiB0aGUgc3RyZWFtIGNhbiBiZSBjb25zdW1lZCBvbmx5IGFzIGxvbmcgYXMg\ne0BsaW5rIFJlc3VsdFNldH0gaXMgb3Blbi4KICAgICAqLwogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgSW5wdXRTdHJlYW0gZ2V0TE9CU3RyZWFtKEpEQkNT\ndG9yZSBzdG9yZSwgUmVzdWx0U2V0IHJzLCBpbnQgY29sdW1uKSB0aHJvd3Mg\nU1FMRXhjZXB0aW9uIHsKICAgICAgICBCbG9iIGJsb2IgPSBycy5nZXRCbG9i\nKGNvbHVtbik7CiAgICAgICAgaWYgKGJsb2IgPT0gbnVsbCkgewogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJs\nb2IuZ2V0QmluYXJ5U3RyZWFtKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBP\nYnRhaW4gYSB7QGxpbmsgUmVhZGVyfSBieSB1c2luZyB7QGxpbmsgUmVzdWx0\nU2V0I2dldENsb2IoaW50KX0gYW5kCiAgICAgKiB7QGxpbmsgQ2xvYiNnZXRD\naGFyYWN0ZXJTdHJlYW0oKX0uCiAgICAgKiBVbmZvcnR1bmF0ZWx5IHRoaXMg\nd2lsbCBsb2FkIGVudGlyZSBDTE9CIGludG8gbWVtb3J5LgogICAgICogVGhl\nIGFsdGVybmF0aXZlIHtAbGluayBSZXN1bHRTZXQjZ2V0Q2hhcmFjdGVyU3Ry\nZWFtKGludCl9IHByb3ZpZGVzIHRydWUgc3RyZWFtaW5nIGJ1dAogICAgICog\ndGhlIHN0cmVhbSBjYW4gYmUgY29uc3VtZWQgb25seSBhcyBsb25nIGFzIHtA\nbGluayBSZXN1bHRTZXR9IGlzIG9wZW4uCiAgICAgKi8KICAgIEBPdmVycmlk\nZQogICAgcHVibGljIFJlYWRlciBnZXRDaGFyYWN0ZXJTdHJlYW0oUmVzdWx0\nU2V0IHJzLCBpbnQgY29sdW1uKSB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAg\nICAgICBDbG9iIGNsb2IgPSBycy5nZXRDbG9iKGNvbHVtbik7CiAgICAgICAg\naWYgKGNsb2IgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNsb2IuZ2V0Q2hhcmFjdGVyU3Ry\nZWFtKCk7CiAgICB9CgogICAgCn0K\n","encoding":"base64"}

