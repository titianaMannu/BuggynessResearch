{"sha":"d4e67a17c90d535617f7cdd83ce3e89ac9bfeef0","node_id":"MDQ6QmxvYjIwNjM2NDpkNGU2N2ExN2M5MGQ1MzU2MTdmN2NkZDgzY2UzZTg5YWM5YmZlZWYw","size":103998,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/d4e67a17c90d535617f7cdd83ce3e89ac9bfeef0","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5zcWw7CgppbXBvcnQg\namF2YS5zcWwuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmEuc3FsLlByZXBhcmVk\nU3RhdGVtZW50OwppbXBvcnQgamF2YS5zcWwuUmVzdWx0U2V0OwppbXBvcnQg\namF2YS5zcWwuU1FMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5zcWwuU3RhdGVt\nZW50OwppbXBvcnQgamF2YS5zcWwuVHlwZXM7CmltcG9ydCBqYXZhLnV0aWwu\nQWJzdHJhY3RMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLlN0YWNrOwppbXBvcnQgamF2YS51dGls\nLlRyZWVNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rp\nb25zLml0ZXJhdG9ycy5FbXB0eUl0ZXJhdG9yOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuamRiYy5jb25mLkpEQkNDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMua2VybmVsLkVhZ2VyRmV0Y2hNb2Rl\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJD\nRmV0Y2hDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmpkYmMua2VybmVsLkpEQkNMb2NrTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5qZGJjLmtlcm5lbC5KREJDU3RvcmU7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuamRiYy5rZXJuZWwuSkRCQ1N0b3JlTWFuYWdlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5qZGJjLm1ldGEuQ2xhc3NNYXBw\naW5nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0YS5GaWVs\nZE1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRiYy5tZXRh\nLkpvaW5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpkYmMubWV0\nYS5WYWx1ZU1hcHBpbmc7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuamRi\nYy5zY2hlbWEuQ29sdW1uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmpk\nYmMuc2NoZW1hLkZvcmVpZ25LZXk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEuamRiYy5zY2hlbWEuVGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLlN0b3JlQ29udGV4dDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5rZXJuZWwuZXhwcy5Db250ZXh0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5sb2cuTG9nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmxpYi51dGlsLkxvY2FsaXplcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS51dGlsLkFwcGxpY2F0aW9uSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5J\nbnRlcm5hbEV4Y2VwdGlvbjsKCi8qKgogKiBTdGFuZGFyZCB7QGxpbmsgU2Vs\nZWN0fSBpbXBsZW1lbnRhdGlvbi4gVXNhZ2Ugbm90ZTogdGhvdWdoIHRoaXMg\nY2xhc3MKICogaW1wbGVtZW50cyB7QGxpbmsgSm9pbnN9LCBpdCBzaG91bGQg\nbm90IGJlIHVzZWQgZm9yIGpvaW5pbmcgZGlyZWN0bHkuCiAqIEluc3RlYWQs\nIHVzZSB0aGUgcmV0dXJuIHZhbHVlIG9mIHtAbGluayAjbmV3Sm9pbnN9Lgog\nKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBAbm9qYXZhZG9jCiAqLwpwdWJs\naWMgY2xhc3MgU2VsZWN0SW1wbAogICAgaW1wbGVtZW50cyBTZWxlY3QsIFBh\ndGhKb2lucyB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE5PTkFV\nVE9fRElTVElOQ1QgPSAyIDw8IDA7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBpbnQgRElTVElOQ1QgPSAyIDw8IDE7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgTk9UX0RJU1RJTkNUID0gMiA8PCAyOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IElNUExJQ0lUX0RJU1RJTkNUID0gMiA8PCAzOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFRPX01BTlkgPSAyIDw8IDQ7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgQUdHUkVHQVRFID0gMiA8\nPCA1OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IExPQiA9IDIgPDwg\nNjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPVVRFUiA9IDIgPDwg\nNzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBMUlMgPSAyIDw8IDg7\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRUFHRVJfVE9fT05FID0g\nMiA8PCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEVBR0VSX1RP\nX01BTlkgPSAyIDw8IDEwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIFJFQ09SRF9PUkRFUkVEID0gMiA8PCAxMTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBHUk9VUElORyA9IDIgPDwgMTI7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgRk9SQ0VfQ09VTlQgPSAyIDw8IDEzOwoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZ1tdIFRBQkxFX0FMSUFTRVMgPSBu\nZXcgU3RyaW5nWzE2XTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmlu\nZ1tdIE9SREVSX0FMSUFTRVMgPSBuZXcgU3RyaW5nWzE2XTsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIE9iamVjdFtdIE5VTExfSURTID0gbmV3IE9iamVj\ndFsxNl07CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPYmplY3RbXSBQTEFD\nRUhPTERFUlMgPSBuZXcgT2JqZWN0WzUwXTsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nKFNlbGVjdC5jbGFzcyk7CgogICAgc3RhdGljIHsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IFRBQkxFX0FMSUFTRVMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgIFRBQkxFX0FMSUFTRVNbaV0gPSAidCIgKyBpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgT1JERVJfQUxJQVNFUy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgT1JERVJfQUxJQVNFU1tpXSA9ICJvIiArIGk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBOVUxMX0lEUy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgTlVMTF9JRFNbaV0gPSBuZXcgTnVsbElkKCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBQTEFDRUhPTERFUlMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIFBMQUNFSE9MREVSU1tpXSA9IG5ldyBQbGFjZWhv\nbGRlcigpOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgSkRCQ0NvbmZpZ3Vy\nYXRpb24gX2NvbmY7CiAgICBwcml2YXRlIGZpbmFsIERCRGljdGlvbmFyeSBf\nZGljdDsKCiAgICAvLyBtYXAgb2YgdmFyaWFibGUgKyByZWxhdGlvbiBwYXRo\nICsgdGFibGUga2V5cyB0byB0aGUgY29ycmVjdCBhbGlhcyBpbmRleDoKICAg\nIC8vIGVhY2ggcmVsYXRpb24gcGF0aC90YWJsZSBjb21iaW5hdGlvbiBzaG91\nbGQgaGF2ZSBhIHVuaXF1ZSBhbGlhcyBiZWNhdXNlCiAgICAvLyBpdCByZXBy\nZXNlbnRzIGEgc2VwYXJhdGUgb2JqZWN0OyBmb3IgZXhhbXBsZSwgaWYgYSBQ\nZXJzb24gY2xhc3MgaGFzIGEKICAgIC8vICdwYXJlbnQnIGZpZWxkIHJlcHJl\nc2VudGluZyBhbm90aGVyIFBlcnNvbiBhbmQgYWxzbyBoYXMgYW4gJ2FkZHJl\nc3MnCiAgICAvLyBmaWVsZCBvZiB0eXBlIEFkZHJlc3M6CiAgICAvLyAnYWRk\ncmVzcy5zdHJlZXQnIHNob3VsZCBtYXAgdG8gYSBkaWZmZXJlbnQgdGFibGUg\nYWxpYXMgdGhhbgogICAgLy8gJ3BhcmVudC5hZGRyZXNzLnN0cmVldCcgZm9y\nIHRoZSBwdXJwb3NlcyBvZiBjb21wYXJpc29ucwogICAgcHJpdmF0ZSBNYXAg\nX2FsaWFzZXMgPSBudWxsOwoKICAgIC8vIG1hcCBvZiBpbmRleGVzIHRvIHRh\nYmxlIGFsaWFzZXMgbGlrZSAnVEFCTEVOQU1FIHQwJwogICAgcHJpdmF0ZSBT\nb3J0ZWRNYXAgX3RhYmxlcyA9IG51bGw7CgogICAgLy8gY29tYmluZWQgbGlz\ndCBvZiBzZWxlY3RlZCBpZHMgYW5kIG1hcCBvZiBlYWNoIGlkIHRvIGl0cyBh\nbGlhcwogICAgcHJvdGVjdGVkIGZpbmFsIFNlbGVjdHMgX3NlbGVjdHMgPSBu\nZXdTZWxlY3RzKCk7CiAgICBwcml2YXRlIExpc3QgX29yZGVyZWQgPSBudWxs\nOwogICAgcHJpdmF0ZSBMaXN0IF9ncm91cGVkID0gbnVsbDsKCiAgICAvLyBm\nbGFncwogICAgcHJpdmF0ZSBpbnQgX2ZsYWdzID0gMDsKICAgIHByaXZhdGUg\naW50IF9qb2luU3ludGF4ID0gMDsKICAgIHByaXZhdGUgbG9uZyBfc3RhcnRJ\nZHggPSAwOwogICAgcHJpdmF0ZSBsb25nIF9lbmRJZHggPSBMb25nLk1BWF9W\nQUxVRTsKICAgIHByaXZhdGUgaW50IF9udWxsSWRzID0gMDsKICAgIHByaXZh\ndGUgaW50IF9vcmRlcnMgPSAwOwogICAgcHJpdmF0ZSBpbnQgX3BsYWNlaG9s\nZGVycyA9IDA7CiAgICBwcml2YXRlIGludCBfZXhwZWN0ZWRSZXN1bHRDb3Vu\ndCA9IDA7CgogICAgLy8gcXVlcnkgY2xhdXNlcwogICAgcHJpdmF0ZSBTUUxC\ndWZmZXIgX29yZGVyaW5nID0gbnVsbDsKICAgIHByaXZhdGUgU1FMQnVmZmVy\nIF93aGVyZSA9IG51bGw7CiAgICBwcml2YXRlIFNRTEJ1ZmZlciBfZ3JvdXBp\nbmcgPSBudWxsOwogICAgcHJpdmF0ZSBTUUxCdWZmZXIgX2hhdmluZyA9IG51\nbGw7CiAgICBwcml2YXRlIFNRTEJ1ZmZlciBfZnVsbCA9IG51bGw7CgogICAg\nLy8gam9pbnMgdG8gYWRkIHRvIHRoZSBlbmQgb2Ygb3VyIHdoZXJlIGNsYXVz\nZSwgYW5kIGpvaW5zIHRvIHByZXBlbmQgdG8KICAgIC8vIGFsbCBzZWxlY3Rz\nIChzZWUgc2VsZWN0KGNsYXNzbWFwcGluZykgbWV0aG9kKQogICAgcHJpdmF0\nZSBTZWxlY3RKb2lucyBfam9pbnMgPSBudWxsOwogICAgcHJpdmF0ZSBTdGFj\nayBfcHJlSm9pbnMgPSBudWxsOwoKICAgIC8vIG1hcCBvZiBqb2lucytrZXlz\nIHRvIGVhZ2VyIHNlbGVjdHMgYW5kIGdsb2JhbCBzZXQgb2YgZWFnZXIga2V5\nczsgdGhlCiAgICAvLyBzYW1lIGtleSBjYW4ndCBiZSB1c2VkIG1vcmUgdGhh\nbiBvbmNlCiAgICBwcml2YXRlIE1hcCBfZWFnZXIgPSBudWxsOwogICAgcHJp\ndmF0ZSBTZXQgX2VhZ2VyS2V5cyA9IG51bGw7CgogICAgLy8gc3Vic2VsZWN0\nIHN1cHBvcnQKICAgIHByaXZhdGUgTGlzdCBfc3Vic2VscyA9IG51bGw7CiAg\nICBwcml2YXRlIFNlbGVjdEltcGwgX3BhcmVudCA9IG51bGw7CiAgICBwcml2\nYXRlIFN0cmluZyBfc3ViUGF0aCA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xl\nYW4gX2hhc1N1YiA9IGZhbHNlOwoKICAgIC8vIGZyb20gc2VsZWN0IGlmIHRo\naXMgc2VsZWN0IHNlbGVjdHMgZnJvbSBhIHRtcCB0YWJsZSBjcmVhdGVkIGJ5\nIGFub3RoZXIKICAgIHByaXZhdGUgU2VsZWN0SW1wbCBfZnJvbSA9IG51bGw7\nCiAgICBwcm90ZWN0ZWQgU2VsZWN0SW1wbCBfb3V0ZXIgPSBudWxsOwoKICAg\nIC8vIEpQUUwgUXVlcnkgY29udGV4dCB0aGlzIHNlbGVjdCBpcyBhc3NvY2lh\ndGVkIHdpdGgKICAgIHByaXZhdGUgQ29udGV4dCBfY3R4ID0gbnVsbDsKCiAg\nICAvLyBBIHBhdGggbmF2aWdhdGlvbiBpcyBiZWdpbiB3aXRoIHRoaXMgc2No\nZW1hIGFsaWFzCiAgICBwcml2YXRlIFN0cmluZyBfc2NoZW1hQWxpYXMgPSBu\ndWxsOwogICAgIAogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHJl\ndHVybiB0aGUgcHJvcGVyIHRhYmxlIGFsaWFzIGZvciB0aGUgZ2l2ZW4gYWxp\nYXMgaW5kZXguCiAgICAgKi8KICAgIHN0YXRpYyBTdHJpbmcgdG9BbGlhcyhp\nbnQgaW5kZXgpIHsKICAgICAgICBpZiAoaW5kZXggPT0gLTEpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChpbmRleCA8IFRBQkxFX0FM\nSUFTRVMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gVEFCTEVfQUxJQVNF\nU1tpbmRleF07CiAgICAgICAgcmV0dXJuICJ0IiArIGluZGV4OwogICAgfQoK\nICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byByZXR1cm4gdGhlIHBy\nb3BlciBvcmRlciBhbGlhcyBmb3IgdGhlIGdpdmVuIG9yZGVyCiAgICAgKiBj\nb2x1bW4gaW5kZXguCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5n\nIHRvT3JkZXJBbGlhcyhpbnQgaW5kZXgpIHsKICAgICAgICBpZiAoaW5kZXgg\nPT0gLTEpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmIChp\nbmRleCA8IE9SREVSX0FMSUFTRVMubGVuZ3RoKQogICAgICAgICAgICByZXR1\ncm4gT1JERVJfQUxJQVNFU1tpbmRleF07CiAgICAgICAgcmV0dXJuICJvIiAr\nIGluZGV4OwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1\ncHBseSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBwdWJsaWMgU2VsZWN0\nSW1wbChKREJDQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAgX2NvbmYg\nPSBjb25mOwogICAgICAgIF9kaWN0ID0gX2NvbmYuZ2V0REJEaWN0aW9uYXJ5\nSW5zdGFuY2UoKTsKICAgICAgICBfam9pblN5bnRheCA9IF9kaWN0LmpvaW5T\neW50YXg7CiAgICAgICAgX3NlbGVjdHMuX2RpY3QgPSBfZGljdDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRDb250ZXh0KENvbnRleHQgY29udGV4dCkg\newogICAgICAgIGlmIChfY3R4ID09IG51bGwpIHsKICAgICAgICAgICAgX2N0\neCA9IGNvbnRleHQ7CiAgICAgICAgICAgIF9jdHguc2V0U2VsZWN0KHRoaXMp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ29udGV4dCBjdHgoKSB7\nCiAgICAgICAgcmV0dXJuIF9jdHg7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0U2NoZW1hQWxpYXMoU3RyaW5nIHNjaGVtYUFsaWFzKSB7CiAgICAgICAg\nX3NjaGVtYUFsaWFzID0gc2NoZW1hQWxpYXM7CiAgICB9CgogICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTZWxlY3RFeGVj\ndXRvciBpbXBsZW1lbnRhdGlvbgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vCgogICAgcHVibGljIEpEQkNDb25maWd1cmF0aW9uIGdl\ndENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9jb25mOwogICAg\nfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3QoYm9vbGVhbiBmb3JV\ncGRhdGUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAg\nICBfZnVsbCA9IF9kaWN0LnRvU2VsZWN0KHRoaXMsIGZvclVwZGF0ZSwgZmV0\nY2gpOwogICAgICAgIHJldHVybiBfZnVsbDsKICAgIH0KICAgIAogICAgcHVi\nbGljIFNRTEJ1ZmZlciBnZXRTUUwoKSB7CiAgICAgICAgcmV0dXJuIF9mdWxs\nOwogICAgfQoKICAgIHB1YmxpYyBTUUxCdWZmZXIgdG9TZWxlY3RDb3VudCgp\nIHsKICAgICAgICByZXR1cm4gX2RpY3QudG9TZWxlY3RDb3VudCh0aGlzKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRBdXRvRGlzdGluY3QoKSB7\nCiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBOT05BVVRPX0RJU1RJTkNUKSA9\nPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldEF1dG9EaXN0aW5jdChi\nb29sZWFuIHZhbCkgewogICAgICAgIGlmICh2YWwpCiAgICAgICAgICAgIF9m\nbGFncyAmPSB+Tk9OQVVUT19ESVNUSU5DVDsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIF9mbGFncyB8PSBOT05BVVRPX0RJU1RJTkNUOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGlzRGlzdGluY3QoKSB7CiAgICAgICAgcmV0dXJu\nIChfZmxhZ3MgJiBOT1RfRElTVElOQ1QpID09IDAgJiYgKChfZmxhZ3MgJiBE\nSVNUSU5DVCkgIT0gMAogICAgICAgICAgICB8fCAoKF9mbGFncyAmIE5PTkFV\nVE9fRElTVElOQ1QpID09IDAKICAgICAgICAgICAgJiYgKF9mbGFncyAmIElN\nUExJQ0lUX0RJU1RJTkNUKSAhPSAwKSk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0RGlzdGluY3QoYm9vbGVhbiBkaXN0aW5jdCkgewogICAgICAgIC8v\nIG5lZWQgdHdvIGZsYWdzIGluIGNhc2Ugc2V0IG5vdF9kaXN0aW5jdCwgdGhl\nbiBhIHRvLW1hbnkgam9pbiBoYXBwZW5zCiAgICAgICAgLy8gYW5kIGRpc3Rp\nbmN0IGZsYWcgZ2V0cyBzZXQgYXV0b21hdGljYWxseQogICAgICAgIGlmIChk\naXN0aW5jdCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRElTVElOQ1Q7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+Tk9UX0RJU1RJTkNUOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIF9mbGFncyB8PSBOT1RfRElTVElOQ1Q7CiAg\nICAgICAgICAgIF9mbGFncyAmPSB+RElTVElOQ1Q7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTFJTKCkgewogICAgICAgIHJldHVy\nbiAoX2ZsYWdzICYgTFJTKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldExSUyhib29sZWFuIGxycykgewogICAgICAgIGlmIChscnMpCiAgICAg\nICAgICAgIF9mbGFncyB8PSBMUlM7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkxSUzsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEV4\ncGVjdGVkUmVzdWx0Q291bnQoKSB7CiAgICAgICAgLy8gaWYgdGhlIGNvdW50\nIGlzbid0IGZvcmNlZCBhbmQgd2UgaGF2ZSB0by1tYW55IGVhZ2VyIGpvaW5z\nIHRoYXQgY291bGQKICAgICAgICAvLyB0aHJvdyB0aGUgY291bnQgb2ZmLCBk\nb24ndCBwYXkgYXR0ZW50aW9uIHRvIGl0CiAgICAgICAgaWYgKChfZmxhZ3Mg\nJiBGT1JDRV9DT1VOVCkgPT0gMCAmJiBoYXNFYWdlckpvaW4odHJ1ZSkpCiAg\nICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBfZXhwZWN0ZWRS\nZXN1bHRDb3VudDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRFeHBlY3Rl\nZFJlc3VsdENvdW50KGludCBleHBlY3RlZFJlc3VsdENvdW50LCBib29sZWFu\nIGZvcmNlKSB7CiAgICAgICAgX2V4cGVjdGVkUmVzdWx0Q291bnQgPSBleHBl\nY3RlZFJlc3VsdENvdW50OwogICAgICAgIGlmIChmb3JjZSkKICAgICAgICAg\nICAgX2ZsYWdzIHw9IEZPUkNFX0NPVU5UOwogICAgICAgIGVsc2UgCiAgICAg\nICAgICAgIF9mbGFncyAmPSB+Rk9SQ0VfQ09VTlQ7CiAgICB9CgogICAgcHVi\nbGljIGludCBnZXRKb2luU3ludGF4KCkgewogICAgICAgIHJldHVybiBfam9p\nblN5bnRheDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRKb2luU3ludGF4\nKGludCBqb2luU3ludGF4KSB7CiAgICAgICAgX2pvaW5TeW50YXggPSBqb2lu\nU3ludGF4OwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN1cHBvcnRzUmFu\nZG9tQWNjZXNzKGJvb2xlYW4gZm9yVXBkYXRlKSB7CiAgICAgICAgcmV0dXJu\nIF9kaWN0LnN1cHBvcnRzUmFuZG9tQWNjZXNzUmVzdWx0U2V0KHRoaXMsIGZv\nclVwZGF0ZSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNM\nb2NraW5nKCkgewogICAgICAgIHJldHVybiBfZGljdC5zdXBwb3J0c0xvY2tp\nbmcodGhpcyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzTXVsdGlw\nbGVTZWxlY3RzKCkgewogICAgICAgIGlmIChfZWFnZXIgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIE1hcC5FbnRyeSBlbnRy\neTsKICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9lYWdlci5lbnRyeVNl\ndCgpLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAg\nIGVudHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKICAgICAgICAgICAg\naWYgKGVudHJ5LmdldFZhbHVlKCkgIT0gdGhpcykKICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9CgogICAgcHVibGljIGludCBnZXRDb3VudChKREJDU3RvcmUgc3Rv\ncmUpCiAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgQ29u\nbmVjdGlvbiBjb25uID0gbnVsbDsKICAgICAgICBQcmVwYXJlZFN0YXRlbWVu\ndCBzdG1udCA9IG51bGw7CiAgICAgICAgUmVzdWx0U2V0IHJzID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBTUUxCdWZmZXIgc3FsID0gdG9T\nZWxlY3RDb3VudCgpOwogICAgICAgICAgICBjb25uID0gc3RvcmUuZ2V0TmV3\nQ29ubmVjdGlvbigpOwogICAgICAgICAgICBzdG1udCA9IHByZXBhcmVTdGF0\nZW1lbnQoY29ubiwgc3FsLCBudWxsLCAKICAgICAgICAgICAgICAgIFJlc3Vs\ndFNldC5UWVBFX0ZPUldBUkRfT05MWSwgCiAgICAgICAgICAgICAgICBSZXN1\nbHRTZXQuQ09OQ1VSX1JFQURfT05MWSwgZmFsc2UpOwogICAgICAgICAgICBf\nZGljdC5zZXRRdWVyeVRpbWVvdXQoc3RtbnQsCiAgICAgICAgICAgICAgICAg\nICAgc3RvcmUuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkuZ2V0UXVlcnlUaW1l\nb3V0KCkpOwogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShjb25uLCBz\ndG1udCwgc3FsLCBmYWxzZSwgc3RvcmUpOwogICAgICAgICAgICByZXR1cm4g\nZ2V0Q291bnQocnMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChycyAhPSBudWxsKQogICAgICAgICAgICAgICAgdHJ5IHsgcnMuY2xv\nc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7fQogICAgICAgICAg\nICBpZiAoc3RtbnQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRyeSB7IHN0\nbW50LmNsb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZSkge30KICAg\nICAgICAgICAgaWYgKGNvbm4gIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRy\neSB7IGNvbm4uY2xvc2UoKTsgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0IGV4ZWN1dGUo\nSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNo\nKQogICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGlmIChm\nZXRjaCA9PSBudWxsKQogICAgICAgICAgICBmZXRjaCA9IHN0b3JlLmdldEZl\ndGNoQ29uZmlndXJhdGlvbigpOwogICAgICAgIHJldHVybiBleGVjdXRlKHN0\nb3JlLmdldENvbnRleHQoKSwgc3RvcmUsIGZldGNoLAogICAgICAgICAgICBm\nZXRjaC5nZXRSZWFkTG9ja0xldmVsKCkpOwogICAgfQoKICAgIHB1YmxpYyBS\nZXN1bHQgZXhlY3V0ZShKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsCiAgICAgICAgaW50IGxvY2tMZXZlbCkKICAgICAg\nICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZmV0Y2ggPT0g\nbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBzdG9yZS5nZXRGZXRjaENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICByZXR1cm4gZXhlY3V0ZShzdG9yZS5nZXRD\nb250ZXh0KCksIHN0b3JlLCBmZXRjaCwgbG9ja0xldmVsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEV4ZWN1dGUgdGhpcyBzZWxlY3QgaW4gdGhlIGNvbnRl\neHQgb2YgdGhlIGdpdmVuIHN0b3JlIG1hbmFnZXIuIFRoZQogICAgICogY29u\ndGV4dCBpcyBwYXNzZWQgaW4gc2VwYXJhdGVseSBmb3IgcHJvZmlsaW5nIHB1\ncnBvc2VzLgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVzdWx0IGV4ZWN1dGUo\nU3RvcmVDb250ZXh0IGN0eCwgSkRCQ1N0b3JlIHN0b3JlLCAKICAgICAgICBK\nREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9ja0xldmVsKQog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIGJvb2xlYW4g\nZm9yVXBkYXRlID0gZmFsc2U7CiAgICAgICAgaWYgKCFpc0FnZ3JlZ2F0ZSgp\nICYmIF9ncm91cGluZyA9PSBudWxsKSB7CiAgICAgICAgICAgIEpEQkNMb2Nr\nTWFuYWdlciBsbSA9IHN0b3JlLmdldExvY2tNYW5hZ2VyKCk7CiAgICAgICAg\nICAgIGlmIChsbSAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yVXBkYXRl\nID0gbG0uc2VsZWN0Rm9yVXBkYXRlKHRoaXMsIGxvY2tMZXZlbCk7CiAgICAg\nICAgfQoKICAgICAgICBsb2dFYWdlclJlbGF0aW9ucygpOwogICAgICAgIFNR\nTEJ1ZmZlciBzcWwgPSB0b1NlbGVjdChmb3JVcGRhdGUsIGZldGNoKTsKICAg\nICAgICBib29sZWFuIGlzTFJTID0gaXNMUlMoKTsKICAgICAgICBpbnQgcnNU\neXBlID0gKGlzTFJTICYmIHN1cHBvcnRzUmFuZG9tQWNjZXNzKGZvclVwZGF0\nZSkpCiAgICAgICAgICAgID8gLTEgOiBSZXN1bHRTZXQuVFlQRV9GT1JXQVJE\nX09OTFk7CiAgICAgICAgQ29ubmVjdGlvbiBjb25uID0gc3RvcmUuZ2V0Q29u\nbmVjdGlvbigpOwogICAgICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50ID0g\nbnVsbDsKICAgICAgICBSZXN1bHRTZXQgcnMgPSBudWxsOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChpc0xSUykgCiAgICAgICAgICAgICAgICBz\ndG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3FsLCBmZXRjaCwgcnNU\neXBlLCAtMSwgdHJ1ZSk7IAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICBzdG1udCA9IHByZXBhcmVTdGF0ZW1lbnQoY29ubiwgc3FsLCBudWxs\nLCByc1R5cGUsIC0xLCBmYWxzZSk7CiAgICAgICAgICAgIAogICAgICAgICAg\nICBfZGljdC5zZXRUaW1lb3V0cyhzdG1udCwgZmV0Y2gsIGZvclVwZGF0ZSk7\nCiAgICAgICAgICAgIAogICAgICAgICAgICBycyA9IGV4ZWN1dGVRdWVyeShj\nb25uLCBzdG1udCwgc3FsLCBpc0xSUywgc3RvcmUpOwogICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAvLyBjbGVhbiB1\ncCBzdGF0ZW1lbnQKICAgICAgICAgICAgaWYgKHN0bW50ICE9IG51bGwpCiAg\nICAgICAgICAgICAgICB0cnkgeyBzdG1udC5jbG9zZSgpOyB9IGNhdGNoIChT\nUUxFeGNlcHRpb24gc2UyKSB7fQogICAgICAgICAgICB0cnkgeyBjb25uLmNs\nb3NlKCk7IH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBzZTIpIHt9CiAgICAgICAg\nICAgIHRocm93IHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0RWFn\nZXJSZXN1bHQoY29ubiwgc3RtbnQsIHJzLCBzdG9yZSwgZmV0Y2gsIGZvclVw\nZGF0ZSwgc3FsKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1dGUgb3Vy\nIGVhZ2VyIHNlbGVjdHMsIGFkZGluZyB0aGUgcmVzdWx0cyB1bmRlciB0aGUg\nc2FtZSBrZXlzCiAgICAgKiB0byB0aGUgZ2l2ZW4gcmVzdWx0LgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGFkZEVhZ2VyUmVzdWx0cyhTZWxl\nY3RSZXN1bHQgcmVzLCBTZWxlY3RJbXBsIHNlbCwKICAgICAgICBKREJDU3Rv\ncmUgc3RvcmUsIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpCiAgICAg\nICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHNlbC5fZWFn\nZXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBl\neGVjdXRlIGVhZ2VyIHNlbGVjdHMKICAgICAgICBNYXAuRW50cnkgZW50cnk7\nCiAgICAgICAgUmVzdWx0IGVyZXM7CiAgICAgICAgTWFwIGVhZ2VyOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gc2VsLl9lYWdlci5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGVu\ndHJ5ID0gKE1hcC5FbnRyeSkgaXRyLm5leHQoKTsKCiAgICAgICAgICAgIC8v\nIHNpbXVsYXRlZCBiYXRjaGVkIHNlbGVjdHMgZm9yIGlubmVyL291dGVyIGpv\naW5zOyBmb3Igc2VwYXJhdGUKICAgICAgICAgICAgLy8gc2VsZWN0cywgZG9u\nJ3QgcGFzcyBvbiBsb2NrIGxldmVsLCBiZWNhdXNlIHRoZXkncmUgcHJvYmFi\nbHkKICAgICAgICAgICAgLy8gZm9yIHJlbGF0aW9ucyBhbmQgdGhlcmVmb3Jl\nIHNob3VsZCB1c2UgZGVmYXVsdCBsZXZlbAogICAgICAgICAgICBpZiAoZW50\ncnkuZ2V0VmFsdWUoKSA9PSBzZWwpCiAgICAgICAgICAgICAgICBlcmVzID0g\ncmVzOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBlcmVzID0g\nKChTZWxlY3RFeGVjdXRvcikgZW50cnkuZ2V0VmFsdWUoKSkuZXhlY3V0ZShz\ndG9yZSwKICAgICAgICAgICAgICAgICAgICBmZXRjaCk7CgogICAgICAgICAg\nICBlYWdlciA9IHJlcy5nZXRFYWdlck1hcChmYWxzZSk7CiAgICAgICAgICAg\nIGlmIChlYWdlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBlYWdlciA9\nIG5ldyBIYXNoTWFwKCk7CiAgICAgICAgICAgICAgICByZXMuc2V0RWFnZXJN\nYXAoZWFnZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVhZ2VyLnB1\ndChlbnRyeS5nZXRLZXkoKSwgZXJlcyk7CiAgICAgICAgfQogICAgfQoKCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIHRvIHByb3ZpZGUgb3ZlcnJp\nZGUgZm9yIG5vbi1KREJDIG9yIEpEQkMtbGlrZSAKICAgICAqIGltcGxlbWVu\ndGF0aW9uIG9mIHByZXBhcmluZyBzdGF0ZW1lbnQuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBQcmVwYXJlZFN0YXRlbWVudCBwcmVwYXJlU3RhdGVtZW50KENv\nbm5lY3Rpb24gY29ubiwgCiAgICAgICAgU1FMQnVmZmVyIHNxbCwgSkRCQ0Zl\ndGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IHJzVHlwZSwgCiAgICAgICAg\naW50IHJzQ29uY3VyLCBib29sZWFuIGlzTFJTKSB0aHJvd3MgU1FMRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHNxbC5wcmVwYXJlU3RhdGVtZW50KGNvbm4sIHJzVHlwZSwgcnND\nb25jdXIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHNxbC5w\ncmVwYXJlU3RhdGVtZW50KGNvbm4sIGZldGNoLCByc1R5cGUsIC0xKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92\naWRlIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAg\nKiBpbXBsZW1lbnRhdGlvbiBvZiBwcmVwYXJpbmcgc3RhdGVtZW50LgogICAg\nICovCiAgICBwdWJsaWMgUHJlcGFyZWRTdGF0ZW1lbnQgcHJlcGFyZVN0YXRl\nbWVudChDb25uZWN0aW9uIGNvbm4sIAogICAgICAgIFN0cmluZyBzcWwpIHRo\ncm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIHJldHVybiBjb25uLnByZXBh\ncmVTdGF0ZW1lbnQoc3FsKTsKICAgIH0gICAgCiAgICAKICAgIC8qKgogICAg\nICogVGhpcyBtZXRob2QgaXMgdG8gcHJvdmlkZSBvdmVycmlkZSBmb3Igbm9u\nLUpEQkMgb3IgSkRCQy1saWtlIAogICAgICogaW1wbGVtZW50YXRpb24gb2Yg\nZXhlY3V0aW5nIHF1ZXJ5LgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVzdWx0\nU2V0IGV4ZWN1dGVRdWVyeShDb25uZWN0aW9uIGNvbm4sIFByZXBhcmVkU3Rh\ndGVtZW50IHN0bW50LCAKICAgICAgICBTUUxCdWZmZXIgc3FsLCBib29sZWFu\nIGlzTFJTLCBKREJDU3RvcmUgc3RvcmUpIHRocm93cyBTUUxFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBzdG1udC5leGVjdXRlUXVlcnkoKTsKICAgIH0K\nICAgIAogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRl\nIG92ZXJyaWRlIGZvciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBp\nbXBsZW1lbnRhdGlvbiBvZiBleGVjdXRpbmcgcXVlcnkuCiAgICAgKi8KICAg\nIHB1YmxpYyBSZXN1bHRTZXQgZXhlY3V0ZVF1ZXJ5KENvbm5lY3Rpb24gY29u\nbiwgUHJlcGFyZWRTdGF0ZW1lbnQgc3RtbnQsIAogICAgICAgIFN0cmluZyBz\ncWwsIEpEQkNTdG9yZSBzdG9yZSwgT2JqZWN0W10gcGFyYW1zLCBDb2x1bW5b\nXSBjb2xzKSAKICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gc3RtbnQuZXhlY3V0ZVF1ZXJ5KCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZv\nciBub24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlv\nbiBvZiBnZXR0aW5nIGNvdW50IGZyb20gdGhlIHJlc3VsdCBzZXQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBpbnQgZ2V0Q291bnQoUmVzdWx0U2V0IHJzKSB0\naHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICBycy5uZXh0KCk7CiAgICAg\nICAgcmV0dXJuIHJzLmdldEludCgxKTsKICAgIH0KICAgIAogICAgLyoqCiAg\nICAgKiBUaGlzIG1ldGhvZCBpcyB0byBwcm92aWRlIG92ZXJyaWRlIGZvciBu\nb24tSkRCQyBvciBKREJDLWxpa2UgCiAgICAgKiBpbXBsZW1lbnRhdGlvbiBv\nZiBleGVjdXRpbmcgZWFnZXIgc2VsZWN0cy4KICAgICAqLwogICAgcHVibGlj\nIFJlc3VsdCBnZXRFYWdlclJlc3VsdChDb25uZWN0aW9uIGNvbm4sIAogICAg\nICAgIFByZXBhcmVkU3RhdGVtZW50IHN0bW50LCBSZXN1bHRTZXQgcnMsIEpE\nQkNTdG9yZSBzdG9yZSwgCiAgICAgICAgSkRCQ0ZldGNoQ29uZmlndXJhdGlv\nbiBmZXRjaCwgYm9vbGVhbiBmb3JVcGRhdGUsIFNRTEJ1ZmZlciBzcWwpIAog\nICAgICAgIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgIFNlbGVjdFJl\nc3VsdCByZXMgPSBuZXcgU2VsZWN0UmVzdWx0KGNvbm4sIHN0bW50LCBycywg\nX2RpY3QpOwogICAgICAgIHJlcy5zZXRTZWxlY3QodGhpcyk7CiAgICAgICAg\ncmVzLnNldFN0b3JlKHN0b3JlKTsKICAgICAgICByZXMuc2V0TG9ja2luZyhm\nb3JVcGRhdGUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFkZEVhZ2Vy\nUmVzdWx0cyhyZXMsIHRoaXMsIHN0b3JlLCBmZXRjaCk7CiAgICAgICAgfSBj\nYXRjaCAoU1FMRXhjZXB0aW9uIHNlKSB7CiAgICAgICAgICAgIHJlcy5jbG9z\nZSgpOwogICAgICAgICAgICB0aHJvdyBzZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJlczsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBTZWxlY3QgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgaW50IGluZGV4T2YoKSB7\nCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcHVibGljIExpc3QgZ2V0\nU3Vic2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gKF9zdWJzZWxzID09IG51\nbGwpID8gQ29sbGVjdGlvbnMuRU1QVFlfTElTVCA6IF9zdWJzZWxzOwogICAg\nfQoKICAgIHB1YmxpYyBTZWxlY3QgZ2V0UGFyZW50KCkgewogICAgICAgIHJl\ndHVybiBfcGFyZW50OwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3Vi\nc2VsZWN0UGF0aCgpIHsKICAgICAgICByZXR1cm4gX3N1YlBhdGg7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgc2V0UGFyZW50KFNlbGVjdCBwYXJlbnQsIFN0\ncmluZyBwYXRoKSB7CiAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAg\nICAgICAgX3N1YlBhdGggPSBwYXRoOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX3N1YlBhdGggPSBudWxsOwoKICAgICAgICBpZiAocGFyZW50ID09IF9w\nYXJlbnQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoX3BhcmVu\ndCAhPSBudWxsKQogICAgICAgICAgICBfcGFyZW50Ll9zdWJzZWxzLnJlbW92\nZSh0aGlzKTsKCiAgICAgICAgLy8jIyMgcmlnaHQgbm93IHdlIGNhbid0IHVz\nZSBzcWw5MiBqb2lucyB3aXRoIHN1YnNlbGVjdHMsIGNhdXNlCiAgICAgICAg\nLy8jIyMgSSBjYW4ndCBmaWd1cmUgb3V0IHdoYXQgdG8gZG8gd2hlbiB0aGUg\nc3Vic2VsZWN0IGhhcyBhIGpvaW4KICAgICAgICAvLyMjIyB3aXRoIGFuIGFs\naWFzIGFsc28gcHJlc2VudCBpbiB0aGUgb3V0ZXIgc2VsZWN0Li4uIHlvdSBk\nb24ndCB3YW50CiAgICAgICAgLy8jIyMgdGhlIGpvaW4gdG8gYXBwZWFyIGlu\nIHRoZSBGUk9NIGNsYXVzZSBvZiB0aGUgc3Vic2VsZWN0IGNhdXNlCiAgICAg\nICAgLy8jIyMgdGhlbiBpdCByZS1hbGlhc2VzIGJvdGggdGFibGVzIGluIHRo\nZSBzY29wZSBvZiB0aGUgc3Vic2VsZWN0CiAgICAgICAgLy8jIyMgYW5kIHRo\nZSBjb3JyZWxhdGlvbiB3aXRoIHRoZSBvdXRlciBzZWxlY3QgaXMgbG9zdAog\nICAgICAgIF9wYXJlbnQgPSAoU2VsZWN0SW1wbCkgcGFyZW50OwogICAgICAg\nIGlmIChfcGFyZW50ICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKF9wYXJl\nbnQuX3N1YnNlbHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9wYXJlbnQu\nX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0KDIpOwogICAgICAgICAgICBfcGFy\nZW50Ll9zdWJzZWxzLmFkZCh0aGlzKTsKICAgICAgICAgICAgaWYgKF9wYXJl\nbnQuX2pvaW5TeW50YXggPT0gSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5MikK\nICAgICAgICAgICAgICAgIF9qb2luU3ludGF4ID0gSm9pblN5bnRheGVzLlNZ\nTlRBWF9UUkFESVRJT05BTDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgX2pvaW5TeW50YXggPSBfcGFyZW50Ll9qb2luU3ludGF4OwogICAg\nICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0SGFzU3Vic2Vs\nZWN0KGJvb2xlYW4gaGFzU3ViKSB7CiAgICAgICAgX2hhc1N1YiA9IGhhc1N1\nYjsKICAgIH0KICAgIAogICAgcHVibGljIGJvb2xlYW4gZ2V0SGFzU3Vic2Vs\nZWN0KCkgewogICAgICAgIHJldHVybiBfaGFzU3ViOyAgICAKICAgIH0KICAg\nIAogICAgcHVibGljIE1hcCBnZXRBbGlhc2VzKCkgewogICAgICAgIHJldHVy\nbiBfYWxpYXNlczsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgcmVtb3Zl\nQWxpYXMoT2JqZWN0IGtleSkgewogICAgICAgIF9hbGlhc2VzLnJlbW92ZShr\nZXkpOwogICAgfQogICAgCiAgICBwdWJsaWMgTWFwIGdldFRhYmxlcygpIHsK\nICAgICAgICByZXR1cm4gX3RhYmxlczsKICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgcmVtb3ZlVGFibGUoT2JqZWN0IGtleSkgewogICAgICAgIF90YWJs\nZXMucmVtb3ZlKGtleSk7CiAgICB9CgogICAgcHVibGljIFNlbGVjdCBnZXRG\ncm9tU2VsZWN0KCkgewogICAgICAgIHJldHVybiBfZnJvbTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXRGcm9tU2VsZWN0KFNlbGVjdCBzZWwpIHsKICAg\nICAgICBfZnJvbSA9IChTZWxlY3RJbXBsKSBzZWw7CiAgICAgICAgaWYgKF9m\ncm9tICE9IG51bGwpCiAgICAgICAgICAgIF9mcm9tLl9vdXRlciA9IHRoaXM7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzRWFnZXJKb2luKGJvb2xl\nYW4gdG9NYW55KSB7CiAgICAgICAgaWYgKHRvTWFueSkKICAgICAgICAgICAg\ncmV0dXJuIChfZmxhZ3MgJiBFQUdFUl9UT19NQU5ZKSAhPSAwOwogICAgICAg\nIHJldHVybiAoX2ZsYWdzICYgRUFHRVJfVE9fT05FKSAhPSAwOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGhhc0pvaW4oYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICBpZiAodG9NYW55KQogICAgICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIFRPX01BTlkpICE9IDA7CiAgICAgICAgcmV0dXJuIF90YWJsZXMgIT0g\nbnVsbCAmJiBfdGFibGVzLnNpemUoKSA+IDE7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNTZWxlY3RlZChUYWJsZSB0YWJsZSkgewogICAgICAgIFBh\ndGhKb2lucyBwaiA9IGdldEpvaW5zKG51bGwsIGZhbHNlKTsKICAgICAgICBp\nZiAoX2Zyb20gIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9mcm9tLmdl\ndFRhYmxlSW5kZXgodGFibGUsIHBqLCBmYWxzZSkgIT0gLTE7CiAgICAgICAg\ncmV0dXJuIGdldFRhYmxlSW5kZXgodGFibGUsIHBqLCBmYWxzZSkgIT0gLTE7\nCiAgICB9CgogICAgcHVibGljIENvbGxlY3Rpb24gZ2V0VGFibGVBbGlhc2Vz\nKCkgewogICAgICAgIHJldHVybiAoX3RhYmxlcyA9PSBudWxsKSA/IENvbGxl\nY3Rpb25zLkVNUFRZX1NFVCA6IF90YWJsZXMudmFsdWVzKCk7CiAgICB9Cgog\nICAgcHVibGljIExpc3QgZ2V0U2VsZWN0cygpIHsKICAgICAgICByZXR1cm4g\nQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChfc2VsZWN0cyk7CiAgICB9\nCgogICAgcHVibGljIExpc3QgZ2V0U2VsZWN0QWxpYXNlcygpIHsKICAgICAg\nICByZXR1cm4gX3NlbGVjdHMuZ2V0QWxpYXNlcyhmYWxzZSwgX291dGVyICE9\nIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBMaXN0IGdldElkZW50aWZpZXJB\nbGlhc2VzKCkgewogICAgICAgIHJldHVybiBfc2VsZWN0cy5nZXRBbGlhc2Vz\nKHRydWUsIF9vdXRlciAhPSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU1FM\nQnVmZmVyIGdldE9yZGVyaW5nKCkgewogICAgICAgIHJldHVybiBfb3JkZXJp\nbmc7CiAgICB9CgogICAgcHVibGljIFNRTEJ1ZmZlciBnZXRHcm91cGluZygp\nIHsKICAgICAgICByZXR1cm4gX2dyb3VwaW5nOwogICAgfQoKICAgIHB1Ymxp\nYyBTUUxCdWZmZXIgZ2V0V2hlcmUoKSB7CiAgICAgICAgcmV0dXJuIF93aGVy\nZTsKICAgIH0KCiAgICBwdWJsaWMgU1FMQnVmZmVyIGdldEhhdmluZygpIHsK\nICAgICAgICByZXR1cm4gX2hhdmluZzsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBhZGRKb2luQ2xhc3NDb25kaXRpb25zKCkgewogICAgICAgIGlmIChfam9p\nbnMgPT0gbnVsbCB8fCBfam9pbnMuam9pbnMoKSA9PSBudWxsKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIC8vIGpvaW4gc2V0IGl0ZXJhdG9yIGFs\nbG93cyBjb25jdXJyZW50IG1vZGlmaWNhdGlvbgogICAgICAgIEpvaW4gajsK\nICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9qb2lucy5qb2lucygpLml0\nZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIGogPSAo\nSm9pbikgaXRyLm5leHQoKTsKICAgICAgICAgICAgaWYgKGouZ2V0UmVsYXRp\nb25UYXJnZXQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBqLmdldFJl\nbGF0aW9uVGFyZ2V0KCkuZ2V0RGlzY3JpbWluYXRvcigpLmFkZENsYXNzQ29u\nZGl0aW9ucwogICAgICAgICAgICAgICAgICAgICh0aGlzLCBqLmdldFN1YmNs\nYXNzZXMoKSA9PSBTVUJTX0pPSU5BQkxFLCAKICAgICAgICAgICAgICAgICAg\nICBqLmdldFJlbGF0aW9uSm9pbnMoKSk7CiAgICAgICAgICAgICAgICBqLnNl\ndFJlbGF0aW9uKG51bGwsIDAsIG51bGwpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHB1YmxpYyBKb2lucyBnZXRKb2lucygpIHsKICAg\nICAgICByZXR1cm4gX2pvaW5zOwogICAgfQoKICAgIHB1YmxpYyBJdGVyYXRv\nciBnZXRKb2luSXRlcmF0b3IoKSB7CiAgICAgICAgaWYgKF9qb2lucyA9PSBu\ndWxsIHx8IF9qb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBF\nbXB0eUl0ZXJhdG9yLklOU1RBTkNFOwogICAgICAgIHJldHVybiBfam9pbnMu\nam9pbnMoKS5qb2luSXRlcmF0b3IoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9u\nZyBnZXRTdGFydEluZGV4KCkgewogICAgICAgIHJldHVybiBfc3RhcnRJZHg7\nCiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0RW5kSW5kZXgoKSB7CiAgICAg\nICAgcmV0dXJuIF9lbmRJZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nUmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBfc3RhcnRJ\nZHggPSBzdGFydDsKICAgICAgICBfZW5kSWR4ID0gZW5kOwogICAgfQoKICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoQ29sdW1uIGNvbCkgewog\nICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIChKb2lucykgbnVs\nbCk7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRDb2x1bW5BbGlhcyhD\nb2x1bW4gY29sLCBKb2lucyBqb2lucykgewogICAgICAgIHJldHVybiBnZXRD\nb2x1bW5BbGlhcyhjb2wsIGdldEpvaW5zKGpvaW5zLCBmYWxzZSkpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhlIGdp\ndmVuIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Q29s\ndW1uQWxpYXMoQ29sdW1uIGNvbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAg\ncmV0dXJuIGdldENvbHVtbkFsaWFzKGNvbC5nZXRJZGVudGlmaWVyKCkuZ2V0\nTmFtZSgpLCBjb2wuZ2V0VGFibGUoKSwgcGopOwogICAgfQoKICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0Q29sdW1uQWxpYXMoU3RyaW5nIGNvbCwgVGFibGUgdGFi\nbGUpIHsKICAgICAgICByZXR1cm4gZ2V0Q29sdW1uQWxpYXMoY29sLCB0YWJs\nZSwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdl\ndENvbHVtbkFsaWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBKb2lucyBq\nb2lucykgewogICAgICAgIHJldHVybiBnZXRDb2x1bW5BbGlhcyhjb2wsIHRh\nYmxlLCBnZXRKb2lucyhqb2lucywgZmFsc2UpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlIGNvbHVtbgog\nICAgICovCiAgICBwdWJsaWMgU3RyaW5nIGdldENvbHVtbkFsaWFzKENvbHVt\nbiBjb2wsIE9iamVjdCBwYXRoKSB7CiAgICAgICAgVGFibGUgdGFibGUgPSBj\nb2wuZ2V0VGFibGUoKTsKICAgICAgICBTdHJpbmcgdGFibGVBbGlhcyA9IG51\nbGw7CiAgICAgICAgSXRlcmF0b3IgaXRyID0gZ2V0Sm9pbkl0ZXJhdG9yKCk7\nCiAgICAgICAgd2hpbGUgKGl0ci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAg\nSm9pbiBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlm\nIChqb2luICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChqb2luLmdl\ndFRhYmxlMSgpID09IHRhYmxlKQogICAgICAgICAgICAgICAgICAgIHRhYmxl\nQWxpYXMgPSBqb2luLmdldEFsaWFzMSgpOwogICAgICAgICAgICAgICAgZWxz\nZSBpZiAoam9pbi5nZXRUYWJsZTIoKSA9PSB0YWJsZSkKICAgICAgICAgICAg\nICAgICAgICB0YWJsZUFsaWFzID0gam9pbi5nZXRBbGlhczIoKTsKICAgICAg\nICAgICAgICAgIGlmICh0YWJsZUFsaWFzICE9IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdCdWlsZGVyKHRhYmxlQWxpYXMp\nLmFwcGVuZCgiLiIpLgogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQo\nX2RpY3QuZ2V0TmFtaW5nVXRpbCgpLnRvREJOYW1lKGNvbC5nZXRJZGVudGlm\naWVyKCkpKS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigiQ2FuIG5vdCBy\nZXNvbHZlIGFsaWFzIGZvciBmaWVsZDogIiArCiAgICAgICAgICAgIHBhdGgu\ndG9TdHJpbmcoKSArICIgbWFwcGVkIHRvIGNvbHVtbjogIiArIGNvbC5nZXRJ\nZGVudGlmaWVyKCkuZ2V0TmFtZSgpICsKICAgICAgICAgICAgIiB0YWJsZTog\nIit0YWJsZS5nZXRJZGVudGlmaWVyKCkuZ2V0TmFtZSgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiBj\nb2x1bW4uCiAgICAgKi8KICAgIHByaXZhdGUgU3RyaW5nIGdldENvbHVtbkFs\naWFzKFN0cmluZyBjb2wsIFRhYmxlIHRhYmxlLCBQYXRoSm9pbnMgcGopIHsK\nICAgICAgICByZXR1cm4gZ2V0VGFibGVBbGlhcyh0YWJsZSwgcGopLmFwcGVu\nZChfZGljdC5nZXROYW1pbmdVdGlsKCkudG9EQk5hbWUoY29sKSkudG9TdHJp\nbmcoKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBTdHJpbmdCdWlsZGVyIGdl\ndFRhYmxlQWxpYXMoVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaikgewogICAg\nICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsK\nICAgICAgICBpZiAoX2Zyb20gIT0gbnVsbCkgewogICAgICAgICAgICBTdHJp\nbmcgYWxpYXMgPSB0b0FsaWFzKF9mcm9tLmdldFRhYmxlSW5kZXgodGFibGUs\nIHBqLCB0cnVlKSk7CiAgICAgICAgICAgIGlmIChfZGljdC5yZXF1aXJlc0Fs\naWFzRm9yU3Vic2VsZWN0KQogICAgICAgICAgICAgICAgcmV0dXJuIGJ1Zi5h\ncHBlbmQoRlJPTV9TRUxFQ1RfQUxJQVMpLmFwcGVuZCgiLiIpLmFwcGVuZChh\nbGlhcykuCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kKCJfIik7CiAgICAg\nICAgICAgIHJldHVybiBidWYuYXBwZW5kKGFsaWFzKS5hcHBlbmQoIl8iKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1Zi5hcHBlbmQodG9BbGlhcyhn\nZXRUYWJsZUluZGV4KHRhYmxlLCBwaiwgdHJ1ZSkpKS5hcHBlbmQoIi4iKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZSgpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIEFHR1JFR0FURSkgIT0gMDsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRBZ2dyZWdhdGUoYm9vbGVhbiBhZ2cpIHsK\nICAgICAgICBpZiAoYWdnKQogICAgICAgICAgICBfZmxhZ3MgfD0gQUdHUkVH\nQVRFOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2ZsYWdzICY9IH5BR0dS\nRUdBVEU7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNMb2IoKSB7CiAg\nICAgICAgcmV0dXJuIChfZmxhZ3MgJiBMT0IpICE9IDA7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc2V0TG9iKGJvb2xlYW4gbG9iKSB7CiAgICAgICAgaWYg\nKGxvYikKICAgICAgICAgICAgX2ZsYWdzIHw9IExPQjsKICAgICAgICBlbHNl\nCiAgICAgICAgICAgIF9mbGFncyAmPSB+TE9COwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsZWFyU2VsZWN0cygpIHsKICAgICAgICBfc2VsZWN0cy5jbGVh\ncigpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChTUUxCdWZm\nZXIgc3FsLCBPYmplY3QgaWQpIHsKICAgICAgICByZXR1cm4gc2VsZWN0KHNx\nbCwgaWQsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVj\ndChTUUxCdWZmZXIgc3FsLCBPYmplY3QgaWQsIEpvaW5zIGpvaW5zKSB7CiAg\nICAgICAgaWYgKCFpc0dyb3VwaW5nKCkpCiAgICAgICAgICAgIHJldHVybiBz\nZWxlY3QoKE9iamVjdCkgc3FsLCBpZCwgam9pbnMpOwogICAgICAgIGdyb3Vw\nQnkoc3FsLCBqb2lucyk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIC8qKgogICAgICogUmVjb3JkIHRoZSBzZWxlY3Qgb2YgdGhlIGdpdmVu\nIFNRTCBidWZmZXIgb3Igc3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gc2VsZWN0KE9iamVjdCBzcWwsIE9iamVjdCBpZCwgSm9pbnMgam9p\nbnMpIHsKICAgICAgICBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAg\nYm9vbGVhbiBjb250YWluczsKICAgICAgICBpZiAoaWQgPT0gbnVsbCkgewog\nICAgICAgICAgICBpbnQgaWR4ID0gX3NlbGVjdHMuaW5kZXhPZkFsaWFzKHNx\nbCk7CiAgICAgICAgICAgIGNvbnRhaW5zID0gaWR4ICE9IC0xOwogICAgICAg\nICAgICBpZiAoY29udGFpbnMpCiAgICAgICAgICAgICAgICBpZCA9IF9zZWxl\nY3RzLmdldChpZHgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBpZCA9IG51bGxJZCgpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBj\nb250YWlucyA9IF9zZWxlY3RzLmNvbnRhaW5zKGlkKTsKCiAgICAgICAgaWYg\nKGNvbnRhaW5zKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nX3NlbGVjdHMuc2V0QWxpYXMoaWQsIHNxbCwgZmFsc2UpOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHVu\naXF1ZSBpZCBmb3IgYSBTUUwgc3RyaW5nIHdob3NlIGdpdmVuIGlkIGlzIG51\nbGwuCiAgICAgKi8KICAgIHByaXZhdGUgT2JqZWN0IG51bGxJZCgpIHsKICAg\nICAgICBpZiAoX251bGxJZHMgPj0gTlVMTF9JRFMubGVuZ3RoKQogICAgICAg\nICAgICByZXR1cm4gbmV3IE51bGxJZCgpOwogICAgICAgIHJldHVybiBOVUxM\nX0lEU1tfbnVsbElkcysrXTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\nZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkKSB7CiAgICAgICAgcmV0dXJu\nIHNlbGVjdChzcWwsIGlkLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBzZWxlY3QoU3RyaW5nIHNxbCwgT2JqZWN0IGlkLCBKb2lucyBqb2lu\ncykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAgICAgICBy\nZXR1cm4gc2VsZWN0KChPYmplY3QpIHNxbCwgaWQsIGpvaW5zKTsKICAgICAg\nICBncm91cEJ5KHNxbCwgam9pbnMpOwogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNlbGVjdFBsYWNlaG9sZGVyKFN0cmlu\nZyBzcWwpIHsKICAgICAgICBPYmplY3QgaG9sZGVyID0gKF9wbGFjZWhvbGRl\ncnMgPj0gUExBQ0VIT0xERVJTLmxlbmd0aCkKICAgICAgICAgICAgPyBuZXcg\nUGxhY2Vob2xkZXIoKSA6IFBMQUNFSE9MREVSU1tfcGxhY2Vob2xkZXJzKytd\nOwogICAgICAgIHNlbGVjdChzcWwsIGhvbGRlcik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbnNlcnQgYSBwbGFjZWhvbGRlciBhdCB0aGUgZ2l2ZW4gaW5k\nZXg7IHVzZSBhIG5lZ2F0aXZlIGluZGV4CiAgICAgKiB0byBjb3VudCBmcm9t\nIHRoZSBiYWNrIG9mIHRoZSBzZWxlY3QgbGlzdC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgaW5zZXJ0UGxhY2Vob2xkZXIoU3RyaW5nIHNxbCwgaW50IHBv\ncykgewogICAgICAgIE9iamVjdCBob2xkZXIgPSAoX3BsYWNlaG9sZGVycyA+\nPSBQTEFDRUhPTERFUlMubGVuZ3RoKQogICAgICAgICAgICA/IG5ldyBQbGFj\nZWhvbGRlcigpIDogUExBQ0VIT0xERVJTW19wbGFjZWhvbGRlcnMrK107CiAg\nICAgICAgX3NlbGVjdHMuaW5zZXJ0QWxpYXMocG9zLCBob2xkZXIsIHNxbCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBzZWxlY3RlZCBwbGFjZWhv\nbGRlcnMsIGFuZCByZXR1cm4gcmVtb3ZlZCBzZWxlY3QgaW5kZXhlcy4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgY2xlYXJQbGFjZWhvbGRlclNlbGVjdHMo\nKSB7CiAgICAgICAgX3NlbGVjdHMuY2xlYXJQbGFjZWhvbGRlcnMoKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3QoQ29sdW1uIGNvbCkgewog\nICAgICAgIHJldHVybiBzZWxlY3QoY29sLCAoSm9pbnMpIG51bGwpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIHNlbGVjdChDb2x1bW4gY29sLCBKb2lu\ncyBqb2lucykgewogICAgICAgIGlmICghaXNHcm91cGluZygpKQogICAgICAg\nICAgICByZXR1cm4gc2VsZWN0KGNvbCwgZ2V0Sm9pbnMoam9pbnMsIHRydWUp\nLCBmYWxzZSk7CiAgICAgICAgZ3JvdXBCeShjb2wsIGpvaW5zKTsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3Qo\nQ29sdW1uW10gY29scykgewogICAgICAgIHJldHVybiBzZWxlY3QoY29scywg\nbnVsbCk7CiAgICB9CgogICAgcHVibGljIGludCBzZWxlY3QoQ29sdW1uW10g\nY29scywgSm9pbnMgam9pbnMpIHsKICAgICAgICBpZiAoY29scyA9PSBudWxs\nIHx8IGNvbHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwog\nICAgICAgIGlmIChpc0dyb3VwaW5nKCkpIHsKICAgICAgICAgICAgZ3JvdXBC\neShjb2xzLCBqb2lucyk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAg\nIH0KICAgICAgICBQYXRoSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1\nZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHNl\nbGVjdChjb2xzW2ldLCBwaiwgZmFsc2UpKQogICAgICAgICAgICAgICAgc2Vs\nZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZWxlY3QgdGhlIGdpdmVuIGNvbHVtbiBhZnRlciBtYWtp\nbmcgdGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRlIGJvb2xl\nYW4gc2VsZWN0KENvbHVtbiBjb2wsIFBhdGhKb2lucyBwaiwgYm9vbGVhbiBp\nZGVudCkgewogICAgICAgIC8vIHdlIGNhY2hlIG9uIGNvbHVtbiBvYmplY3Qg\naWYgdGhlcmUgYXJlIG5vIGpvaW5zIHNvIHRoYXQgd2hlbgogICAgICAgIC8v\nIGxvb2tpbmcgdXAgY29sdW1ucyBpbiB0aGUgcmVzdWx0IHdlIGRvbid0IGhh\ndmUgdG8gY3JlYXRlIGEgc3RyaW5nCiAgICAgICAgLy8gYnVmZmVyIGZvciB0\naGUgdGFibGUgKyBjb2x1bW4gYWxpYXM7IGlmIHRoZXJlIGFyZSBqb2lucywg\ndGhlbgogICAgICAgIC8vIHdlIGtleSBvbiB0aGUgYWxpYXMKICAgICAgICBT\ndHJpbmcgYWxpYXMgPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAgICAg\nICBPYmplY3QgaWQ7CiAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0\naCgpID09IG51bGwpCiAgICAgICAgICAgIGlkID0gY29sOwogICAgICAgIGVs\nc2UKICAgICAgICAgICAgaWQgPSBhbGlhczsKICAgICAgICBpZiAoX3NlbGVj\ndHMuY29udGFpbnMoaWQpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIGlmIChjb2wuZ2V0VHlwZSgpID09IFR5cGVzLkJMT0IgfHwgY29s\nLmdldFR5cGUoKSA9PSBUeXBlcy5DTE9CKQogICAgICAgICAgICBzZXRMb2Io\ndHJ1ZSk7CiAgICAgICAgX3NlbGVjdHMuc2V0QWxpYXMoaWQsIGFsaWFzLCBp\nZGVudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2VsZWN0KENsYXNzTWFwcGluZyBtYXBwaW5nLCBpbnQgc3ViY2xh\nc3NlcywKICAgICAgICBKREJDU3RvcmUgc3RvcmUsIEpEQkNGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gsIGludCBlYWdlcikgewogICAgICAgIHNlbGVjdCht\nYXBwaW5nLCBzdWJjbGFzc2VzLCBzdG9yZSwgZmV0Y2gsIGVhZ2VyLCBudWxs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZWxlY3QoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcsIGludCBzdWJjbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBz\ndG9yZSwgSkRCQ0ZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2Vy\nLAogICAgICAgIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMs\nIG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpv\naW5zLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgdGhl\nIGdpdmVuIG1hcHBpbmcuCiAgICAgKi8KICAgIHZvaWQgc2VsZWN0KFNlbGVj\ndCB3cmFwcGVyLCBDbGFzc01hcHBpbmcgbWFwcGluZywgaW50IHN1YmNsYXNz\nZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBpbnQgZWFnZXIsCiAgICAgICAgSm9pbnMgam9pbnMs\nIGJvb2xlYW4gaWRlbnQpIHsKICAgICAgICAvLyBub3RlIHRoYXQgdGhpcyBp\ncyBvbmUgY2FzZSB3aGVyZSB3ZSBkb24ndCB3YW50IHRvIHVzZSB0aGUgcmVz\ndWx0CiAgICAgICAgLy8gb2YgZ2V0Sm9pbnMoKTsganVzdCB1c2UgdGhlIGdp\ndmVuIGpvaW5zLCB3aGljaCB3aWxsIGVpdGhlciBiZSBjbGVhbgogICAgICAg\nIC8vIG9yIHRoZSByZXN1bHQgb2YgcHJldmlvdXMgcHJlLWpvaW5zLiB0aGlz\nIHdheSB3ZSBkb24ndCBwdXNoIGV4dHJhCiAgICAgICAgLy8gc3RhY2sgc3R1\nZmYgd2hlbiBubyBhY3R1YWwgbmV3IGpvaW5zIGhhdmUgYmVlbiBtYWRlLCBh\nbmQgd2UgZG9uJ3QKICAgICAgICAvLyB0aGluayB0aGUgdXNlciB3YW50cyBv\ndXRlciBqb2lucyB3aGVuIGFjdHVhbGx5IG9ubHkgdGhlIHByZXZpb3VzCiAg\nICAgICAgLy8gam9pbnMgd2VyZSBvdXRlci4gIHdlIGRvIGludm9rZSBnZXRK\nb2lucygpLCB0aG91Z2gsIHRvIGFkZCB0aGVzZQogICAgICAgIC8vIGpvaW5z\nIChpZiBhbnkpIHRvIG91ciB0b3AtbGV2ZWwgam9pbnM7IG90aGVyd2lzZSBp\ndCdkIGJlIHBvc3NpYmxlCiAgICAgICAgLy8gZm9yIHRoZSB1c2VyIHRvIGlt\nbWVkaWF0ZWx5IGRvIGFub3RoZXIgam9pbiBhbmQgc2VsZWN0IHNvbWV0aGlu\nZywKICAgICAgICAvLyBhbmQgaWYgd2UncmUgaW4gb3V0ZXIgbW9kZSBhbGwg\ndGhlc2Ugam9pbnMgd2lsbCBnZXQgc3dpdGNoZWQgdG8gb3V0ZXIKICAgICAg\nICAvLyBqb2lucy4gIGNhY2hpbmcgdGhlbSBhcyB0aGVpciBvcmlnaW5hbCBq\nb2luIHR5cGUgcHJldmVudHMgdGhhdAogICAgICAgIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKTsKCiAgICAgICAgUGF0aEpvaW5zIHBqID0gKFBhdGhKb2lucykg\nam9pbnM7CiAgICAgICAgYm9vbGVhbiBoYXNKb2lucyA9IHBqICE9IG51bGwg\nJiYgcGouaXNEaXJ0eSgpOwogICAgICAgIGlmIChoYXNKb2lucykgewogICAg\nICAgICAgICBpZiAoX3ByZUpvaW5zID09IG51bGwpCiAgICAgICAgICAgICAg\nICBfcHJlSm9pbnMgPSBuZXcgU3RhY2soKTsKICAgICAgICAgICAgX3ByZUpv\naW5zLnB1c2gocGopOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhleSBh\ncmUgc2VsZWN0aW5nIHRoaXMgbWFwcGluZyB3aXRoIG91dGVyIGpvaW5zLCB0\naGVuIGFsbCBqb2lucwogICAgICAgIC8vIGZyb20gdGhpcyBtYXBwaW5nIHNo\nb3VsZCBhbHNvIGJlIG91dGVyCiAgICAgICAgYm9vbGVhbiB3YXNPdXRlciA9\nIChfZmxhZ3MgJiBPVVRFUikgIT0gMDsKICAgICAgICBpZiAoaGFzSm9pbnMg\nJiYgIXdhc091dGVyICYmIHBqLmlzT3V0ZXIoKSkKICAgICAgICAgICAgX2Zs\nYWdzIHw9IE9VVEVSOwoKICAgICAgICAvLyBkZWxlZ2F0ZSB0byBzdG9yZSBt\nYW5hZ2VyIHRvIHNlbGVjdCBpbiBzYW1lIG9yZGVyIGl0IGxvYWRzIHJlc3Vs\ndAogICAgICAgICgoSkRCQ1N0b3JlTWFuYWdlcikgc3RvcmUpLnNlbGVjdCh3\ncmFwcGVyLCBtYXBwaW5nLCBzdWJjbGFzc2VzLCBudWxsLAogICAgICAgICAg\nICBudWxsLCBmZXRjaCwgZWFnZXIsIGlkZW50LCAoX2ZsYWdzICYgT1VURVIp\nICE9IDApOwoKICAgICAgICAvLyByZXNldAogICAgICAgIGlmIChoYXNKb2lu\ncykKICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAgIGlmICgh\nd2FzT3V0ZXIgJiYgKF9mbGFncyAmIE9VVEVSKSAhPSAwKQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfk9VVEVSOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIHNlbGVjdElkZW50aWZpZXIoQ29sdW1uIGNvbCkgewogICAgICAgIHJldHVy\nbiBzZWxlY3RJZGVudGlmaWVyKGNvbCwgKEpvaW5zKSBudWxsKTsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBzZWxlY3RJZGVudGlmaWVyKENvbHVtbiBj\nb2wsIEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKCFpc0dyb3VwaW5nKCkp\nCiAgICAgICAgICAgIHJldHVybiBzZWxlY3QoY29sLCBnZXRKb2lucyhqb2lu\ncywgdHJ1ZSksIHRydWUpOwogICAgICAgIGdyb3VwQnkoY29sLCBqb2lucyk7\nCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBpbnQg\nc2VsZWN0SWRlbnRpZmllcihDb2x1bW5bXSBjb2xzKSB7CiAgICAgICAgcmV0\ndXJuIHNlbGVjdElkZW50aWZpZXIoY29scywgbnVsbCk7CiAgICB9CgogICAg\ncHVibGljIGludCBzZWxlY3RJZGVudGlmaWVyKENvbHVtbltdIGNvbHMsIEpv\naW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKGNvbHMgPT0gbnVsbCB8fCBjb2xz\nLmxlbmd0aCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBp\nZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdyb3VwQnkoY29scywg\nam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAg\nICAgIGludCBzZWxkID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvbHMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChzZWxlY3QoY29s\nc1tpXSwgcGosIHRydWUpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8\nIGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2VsZWN0SWRlbnRpZmllcihDbGFzc01hcHBpbmcgbWFwcGluZywgaW50\nIHN1YmNsYXNzZXMsCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlLCBKREJDRmV0\nY2hDb25maWd1cmF0aW9uIGZldGNoLCBpbnQgZWFnZXIpIHsKICAgICAgICBz\nZWxlY3RJZGVudGlmaWVyKG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBm\nZXRjaCwgZWFnZXIsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNl\nbGVjdElkZW50aWZpZXIoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIGludCBzdWJj\nbGFzc2VzLAogICAgICAgIEpEQkNTdG9yZSBzdG9yZSwgSkRCQ0ZldGNoQ29u\nZmlndXJhdGlvbiBmZXRjaCwgaW50IGVhZ2VyLAogICAgICAgIEpvaW5zIGpv\naW5zKSB7CiAgICAgICAgc2VsZWN0KHRoaXMsIG1hcHBpbmcsIHN1YmNsYXNz\nZXMsIHN0b3JlLCBmZXRjaCwgZWFnZXIsIGpvaW5zLCB0cnVlKTsKICAgIH0K\nCiAgICBwdWJsaWMgaW50IHNlbGVjdFByaW1hcnlLZXkoQ2xhc3NNYXBwaW5n\nIG1hcHBpbmcpIHsKICAgICAgICByZXR1cm4gc2VsZWN0UHJpbWFyeUtleSht\nYXBwaW5nLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IHNlbGVjdFBy\naW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywg\ndHJ1ZSwgbnVsbCwgam9pbnMsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE9wZXJhdGUgb24gcHJpbWFyeSBrZXkgZGF0YS4gUmV0dXJuIGEgYml0\nIG1hc2sgb2Ygc2VsZWN0ZWQgY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0\nZSBpbnQgcHJpbWFyeUtleU9wZXJhdGlvbihDbGFzc01hcHBpbmcgbWFwcGlu\nZywgYm9vbGVhbiBzZWwsCiAgICAgICAgQm9vbGVhbiBhc2MsIEpvaW5zIGpv\naW5zLCBib29sZWFuIGFsaWFzT3JkZXIpIHsKICAgICAgICBpZiAoIXNlbCAm\nJiBhc2MgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAg\nIC8vIGlmIHRoaXMgbWFwcGluZyBjYW4ndCBzZWxlY3QgdGhlIGZ1bGwgcGsg\ndmFsdWVzLCB0aGVuIGpvaW4gdG8KICAgICAgICAvLyBzdXBlciBhbmQgcmVj\ndXJzZQogICAgICAgIENsYXNzTWFwcGluZyBzdXA7CiAgICAgICAgaWYgKCFt\nYXBwaW5nLmlzUHJpbWFyeUtleU9iamVjdElkKHRydWUpKSB7CiAgICAgICAg\nICAgIHN1cCA9IG1hcHBpbmcuZ2V0Sm9pbmFibGVQQ1N1cGVyY2xhc3NNYXBw\naW5nKCk7CiAgICAgICAgICAgIGlmIChqb2lucyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgam9pbnMgPSBuZXdKb2lucygpOwogICAgICAgICAgICBqb2lu\ncyA9IG1hcHBpbmcuam9pblN1cGVyY2xhc3Moam9pbnMsIGZhbHNlKTsKICAg\nICAgICAgICAgcmV0dXJuIHByaW1hcnlLZXlPcGVyYXRpb24oc3VwLCBzZWws\nIGFzYywgam9pbnMsIGFsaWFzT3JkZXIpOwogICAgICAgIH0KCiAgICAgICAg\nQ29sdW1uW10gY29scyA9IG1hcHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMo\nKTsKICAgICAgICBpZiAoaXNHcm91cGluZygpKSB7CiAgICAgICAgICAgIGdy\nb3VwQnkoY29scywgam9pbnMpOwogICAgICAgICAgICByZXR1cm4gMDsKICAg\nICAgICB9CgogICAgICAgIFBhdGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5z\nLCBmYWxzZSk7CiAgICAgICAgaW50IHNlbGQgPSAwOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykKICAgICAgICAgICAg\naWYgKGNvbHVtbk9wZXJhdGlvbihjb2xzW2ldLCBzZWwsIGFzYywgcGosIGFs\naWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2VsZCB8PSAyIDw8IGk7Cgog\nICAgICAgIC8vIGlmIHRoaXMgbWFwcGluZyBoYXMgbm90IGJlZW4gdXNlZCBp\nbiB0aGUgc2VsZWN0IHlldCAoYW5kIHRoZXJlZm9yZQogICAgICAgIC8vIGlz\nIG5vdCBqb2luZWQgdG8gYW55dGhpbmcpLCBidXQgaGFzIGFuIG90aGVyLXRh\nYmxlIHN1cGVyY2xhc3MgdGhhdAogICAgICAgIC8vIGhhcyBiZWVuIHVzZWQs\nIG1ha2Ugc3VyZSB0byBqb2luIHRvIGl0CiAgICAgICAgYm9vbGVhbiBqb2lu\nZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKHN1cCA9IG1hcHBpbmcuZ2V0Sm9p\nbmFibGVQQ1N1cGVyY2xhc3NNYXBwaW5nKCk7IHN1cCAhPSBudWxsOwogICAg\nICAgICAgICBtYXBwaW5nID0gc3VwLCBzdXAgPSBtYXBwaW5nLmdldEpvaW5h\nYmxlUENTdXBlcmNsYXNzTWFwcGluZygpKSB7CiAgICAgICAgICAgIGlmIChz\ndXAuZ2V0VGFibGUoKSA9PSBtYXBwaW5nLmdldFRhYmxlKCkpCiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChtYXBwaW5nLmdl\ndFRhYmxlKCkgIT0gc3VwLmdldFRhYmxlKCkKICAgICAgICAgICAgICAgICYm\nIGdldFRhYmxlSW5kZXgobWFwcGluZy5nZXRUYWJsZSgpLCBwaiwgZmFsc2Up\nID09IC0xCiAgICAgICAgICAgICAgICAmJiBnZXRUYWJsZUluZGV4KHN1cC5n\nZXRUYWJsZSgpLCBwaiwgZmFsc2UpICE9IC0xKSB7CiAgICAgICAgICAgICAg\nICBpZiAocGogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwaiA9IChQ\nYXRoSm9pbnMpIG5ld0pvaW5zKCk7CiAgICAgICAgICAgICAgICBwaiA9IChQ\nYXRoSm9pbnMpIG1hcHBpbmcuam9pblN1cGVyY2xhc3MocGosIGZhbHNlKTsK\nICAgICAgICAgICAgICAgIGpvaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0g\nZWxzZQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAg\nIGlmIChqb2luZWQpCiAgICAgICAgICAgIHdoZXJlKHBqKTsKCiAgICAgICAg\ncmV0dXJuIHNlbGQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGFu\nIG9wZXJhdGlvbiBvbiBhIGNvbHVtbi4KICAgICAqLwogICAgcHJpdmF0ZSBi\nb29sZWFuIGNvbHVtbk9wZXJhdGlvbihDb2x1bW4gY29sLCBib29sZWFuIHNl\nbCwgQm9vbGVhbiBhc2MsCiAgICAgICAgUGF0aEpvaW5zIHBqLCBib29sZWFu\nIGFsaWFzT3JkZXIpIHsKICAgICAgICBTdHJpbmcgYXMgPSBudWxsOwogICAg\nICAgIGlmIChhc2MgIT0gbnVsbCAmJiAoYWxpYXNPcmRlciB8fCAoX2ZsYWdz\nICYgUkVDT1JEX09SREVSRUQpICE9IDApKSB7CiAgICAgICAgICAgIE9iamVj\ndCBpZDsKICAgICAgICAgICAgaWYgKHBqID09IG51bGwgfHwgcGoucGF0aCgp\nID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9IGNvbDsKICAgICAgICAg\nICAgZWxzZQogICAgICAgICAgICAgICAgaWQgPSBnZXRDb2x1bW5BbGlhcyhj\nb2wsIHBqKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBSRUNPUkRfT1JE\nRVJFRCkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKF9vcmRlcmVkID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgX29yZGVyZWQgPSBuZXcgQXJy\nYXlMaXN0KDUpOwogICAgICAgICAgICAgICAgX29yZGVyZWQuYWRkKGlkKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWxpYXNPcmRlcikgewog\nICAgICAgICAgICAgICAgYXMgPSB0b09yZGVyQWxpYXMoX29yZGVycysrKTsK\nICAgICAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKGlkLCBhcyk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gc2Vs\nZCA9IHNlbCAmJiBzZWxlY3QoY29sLCBwaiwgZmFsc2UpOwogICAgICAgIGlm\nIChhc2MgIT0gbnVsbCkgewogICAgICAgICAgICBTdHJpbmcgYWxpYXMgPSAo\nYXMgIT0gbnVsbCkgPyBhcyA6IGdldENvbHVtbkFsaWFzKGNvbCwgcGopOwog\nICAgICAgICAgICBhcHBlbmRPcmRlcmluZyhhbGlhcywgYXNjLmJvb2xlYW5W\nYWx1ZSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBBcHBlbmQgb3JkZXJpbmcgaW5mb3JtYXRpb24g\ndG8gb3VyIGludGVybmFsIGJ1ZmZlci4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGFwcGVuZE9yZGVyaW5nKE9iamVjdCBvcmRlckJ5LCBib29sZWFuIGFz\nYykgewogICAgICAgIGlmIChfb3JkZXJpbmcgPT0gbnVsbCkKICAgICAgICAg\nICAgX29yZGVyaW5nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBfb3JkZXJpbmcuYXBwZW5kKCIsICIpOwoKICAg\nICAgICBpZiAob3JkZXJCeSBpbnN0YW5jZW9mIFNRTEJ1ZmZlcikKICAgICAg\nICAgICAgX29yZGVyaW5nLmFwcGVuZCgoU1FMQnVmZmVyKSBvcmRlckJ5KTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIF9vcmRlcmluZy5hcHBlbmQoKFN0\ncmluZykgb3JkZXJCeSk7CiAgICAgICAgaWYgKGFzYykKICAgICAgICAgICAg\nX29yZGVyaW5nLmFwcGVuZCgiIEFTQyIpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgX29yZGVyaW5nLmFwcGVuZCgiIERFU0MiKTsKICAgIH0KCiAgICBw\ndWJsaWMgaW50IG9yZGVyQnlQcmltYXJ5S2V5KENsYXNzTWFwcGluZyBtYXBw\naW5nLCBib29sZWFuIGFzYywKICAgICAgICBib29sZWFuIHNlbCkgewogICAg\nICAgIHJldHVybiBvcmRlckJ5UHJpbWFyeUtleShtYXBwaW5nLCBhc2MsIG51\nbGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRlckJ5UHJpbWFy\neUtleShDbGFzc01hcHBpbmcgbWFwcGluZywgYm9vbGVhbiBhc2MsCiAgICAg\nICAgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsKSB7CiAgICAgICAgcmV0dXJu\nIG9yZGVyQnlQcmltYXJ5S2V5KG1hcHBpbmcsIGFzYywgam9pbnMsIHNlbCwg\nZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRv\nIHNldCBhbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIHB1\nYmxpYyBpbnQgb3JkZXJCeVByaW1hcnlLZXkoQ2xhc3NNYXBwaW5nIG1hcHBp\nbmcsIGJvb2xlYW4gYXNjLAogICAgICAgIEpvaW5zIGpvaW5zLCBib29sZWFu\nIHNlbCwgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAgICAgICAgcmV0dXJuIHBy\naW1hcnlLZXlPcGVyYXRpb24obWFwcGluZywgc2VsLAogICAgICAgICAgICAo\nYXNjKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0UsIGpvaW5zLCBh\nbGlhc09yZGVyKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5\nKENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBib29sZWFuIHNlbCkgewogICAg\nICAgIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBudWxsLCBzZWwpOwogICAg\nfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoQ29sdW1uIGNvbCwgYm9v\nbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNlbCkgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KGNvbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyB1bmlvbnMgdG8gc2V0IGFs\naWFzZXMgb24gb3JkZXIgY29sdW1ucy4KICAgICAqLwogICAgYm9vbGVhbiBv\ncmRlckJ5KENvbHVtbiBjb2wsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwsCiAgICAgICAgYm9vbGVhbiBhbGlhc09yZGVyKSB7CiAg\nICAgICAgcmV0dXJuIGNvbHVtbk9wZXJhdGlvbihjb2wsIHNlbCwgKGFzYykg\nPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFLAogICAgICAgICAgICBn\nZXRKb2lucyhqb2lucywgdHJ1ZSksIGFsaWFzT3JkZXIpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29sZWFuIGFz\nYywgYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xz\nLCBhc2MsIG51bGwsIHNlbCk7CiAgICB9CgogICAgcHVibGljIGludCBvcmRl\nckJ5KENvbHVtbltdIGNvbHMsIGJvb2xlYW4gYXNjLCBKb2lucyBqb2lucywg\nYm9vbGVhbiBzZWwpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeShjb2xzLCBh\nc2MsIGpvaW5zLCBzZWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFsbG93IHVuaW9ucyB0byBzZXQgYWxpYXNlcyBvbiBvcmRlciBjb2x1bW5z\nLgogICAgICovCiAgICBpbnQgb3JkZXJCeShDb2x1bW5bXSBjb2xzLCBib29s\nZWFuIGFzYywgSm9pbnMgam9pbnMsIGJvb2xlYW4gc2VsLAogICAgICAgIGJv\nb2xlYW4gYWxpYXNPcmRlcikgewogICAgICAgIFBhdGhKb2lucyBwaiA9IGdl\ndEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBpbnQgc2VsZCA9IDA7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb2xzLmxlbmd0aDsgaSsrKQog\nICAgICAgICAgICBpZiAoY29sdW1uT3BlcmF0aW9uKGNvbHNbaV0sIHNlbCwK\nICAgICAgICAgICAgICAgIChhc2MpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVh\nbi5GQUxTRSwgcGosIGFsaWFzT3JkZXIpKQogICAgICAgICAgICAgICAgc2Vs\nZCB8PSAyIDw8IGk7CiAgICAgICAgcmV0dXJuIHNlbGQ7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gb3JkZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFu\nIGFzYywgYm9vbGVhbiBzZWwsIFZhbHVlIHNlbEFzKQogICAgewogICAgICAg\nIHJldHVybiBvcmRlckJ5KHNxbCwgYXNjLCAoSm9pbnMpIG51bGwsIHNlbCwg\nc2VsQXMpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIG9yZGVyQnkoU1FM\nQnVmZmVyIHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLAogICAgICAg\nIGJvb2xlYW4gc2VsLCBWYWx1ZSBzZWxBcykgewogICAgICAgIHJldHVybiBv\ncmRlckJ5KHNxbCwgYXNjLCBqb2lucywgc2VsLCBmYWxzZSwgc2VsQXMpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBhbGlh\nc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4gb3Jk\nZXJCeShTUUxCdWZmZXIgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMs\nIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlciwgVmFs\ndWUgc2VsQXMpIHsKICAgICAgICByZXR1cm4gb3JkZXJCeSgoT2JqZWN0KSBz\ncWwsIGFzYywgam9pbnMsIHNlbCwgYWxpYXNPcmRlciwgc2VsQXMpOwogICAg\nfQoKICAgIC8qKgogICAgICogT3JkZXIgb24gYSBTUUwgYnVmZmVyIG9yIHN0\ncmluZy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIG9yZGVyQnkoT2Jq\nZWN0IHNxbCwgYm9vbGVhbiBhc2MsIEpvaW5zIGpvaW5zLCBib29sZWFuIHNl\nbCwKICAgICAgICBib29sZWFuIGFsaWFzT3JkZXIsIFZhbHVlIHNlbEFzKSB7\nCiAgICAgICAgT2JqZWN0IG9yZGVyID0gc3FsOwogICAgICAgIGlmIChhbGlh\nc09yZGVyKSB7CiAgICAgICAgICAgIG9yZGVyID0gdG9PcmRlckFsaWFzKF9v\ncmRlcnMrKyk7CiAgICAgICAgICAgIF9zZWxlY3RzLnNldFNlbGVjdEFzKHNx\nbCwgKFN0cmluZykgb3JkZXIpOwogICAgICAgIH0KICAgICAgICBpZiAoKF9m\nbGFncyAmIFJFQ09SRF9PUkRFUkVEKSAhPSAwKSB7CiAgICAgICAgICAgIGlm\nIChfb3JkZXJlZCA9PSBudWxsKQogICAgICAgICAgICAgICAgX29yZGVyZWQg\nPSBuZXcgQXJyYXlMaXN0KDUpOwogICAgICAgICAgICBfb3JkZXJlZC5hZGQo\nc2VsQXMgPT0gbnVsbCA/IHNxbCA6IHNlbEFzKTsKICAgICAgICB9CgogICAg\nICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBhcHBlbmRPcmRl\ncmluZyhzZWxBcyAhPSBudWxsID8gc2VsQXMuZ2V0QWxpYXMoKSA6IG9yZGVy\nLCBhc2MpOwogICAgICAgIGlmIChzZWwpIHsKICAgICAgICAgICAgaW50IGlk\neCA9IF9zZWxlY3RzLmluZGV4T2ZBbGlhcyhzcWwpOwogICAgICAgICAgICBp\nZiAoaWR4ID09IC0xKSB7CiAgICAgICAgICAgICAgICBfc2VsZWN0cy5zZXRB\nbGlhcyhudWxsSWQoKSwgc3FsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gb3JkZXJC\neShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgYm9vbGVhbiBzZWwpIHsKICAg\nICAgICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgbnVsbCwgc2VsKTsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBvcmRlckJ5KFN0cmluZyBzcWwsIGJv\nb2xlYW4gYXNjLCBKb2lucyBqb2lucywgYm9vbGVhbiBzZWwpIHsKICAgICAg\nICByZXR1cm4gb3JkZXJCeShzcWwsIGFzYywgam9pbnMsIHNlbCwgZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3cgdW5pb25zIHRvIHNldCBh\nbGlhc2VzIG9uIG9yZGVyIGNvbHVtbnMuCiAgICAgKi8KICAgIGJvb2xlYW4g\nb3JkZXJCeShTdHJpbmcgc3FsLCBib29sZWFuIGFzYywgSm9pbnMgam9pbnMs\nIGJvb2xlYW4gc2VsLAogICAgICAgIGJvb2xlYW4gYWxpYXNPcmRlcikgewog\nICAgICAgIHJldHVybiBvcmRlckJ5KChPYmplY3QpIHNxbCwgYXNjLCBqb2lu\ncywgc2VsLCBhbGlhc09yZGVyLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjbGVhck9yZGVyaW5nKCkgewogICAgICAgIF9vcmRlcmluZyA9IG51\nbGw7CiAgICAgICAgX29yZGVycyA9IDA7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBBbGxvdyB1bmlvbnMgdG8gcmVjb3JkIHRoZSBzZWxlY3QgbGlzdCBpbmRl\neGVzIG9mIGl0ZW1zIHdlIG9yZGVyIGJ5LgogICAgICovCiAgICB2b2lkIHNl\ndFJlY29yZE9yZGVyZWRJbmRleGVzKGJvb2xlYW4gcmVjb3JkKSB7CiAgICAg\nICAgaWYgKHJlY29yZCkKICAgICAgICAgICAgX2ZsYWdzIHw9IFJFQ09SRF9P\nUkRFUkVEOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBfb3JkZXJlZCA9\nIG51bGw7CiAgICAgICAgICAgIF9mbGFncyAmPSB+UkVDT1JEX09SREVSRUQ7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBp\nbmRleGVzIGluIHRoZSBzZWxlY3QgbGlzdCBvZiBhbGwgaXRlbXMgd2UncmUg\nb3JkZXJpbmcKICAgICAqIGJ5LCBvciBudWxsIGlmIG5vbmUuIEZvciB1c2Ug\nd2l0aCB1bmlvbnMuCiAgICAgKi8KICAgIExpc3QgZ2V0T3JkZXJlZEluZGV4\nZXMoKSB7CiAgICAgICAgaWYgKF9vcmRlcmVkID09IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIExpc3QgaWR4cyA9IG5ldyBBcnJh\neUxpc3QoX29yZGVyZWQuc2l6ZSgpKTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9vcmRlcmVkLnNpemUoKTsgaSsrKQogICAgICAgICAgICBpZHhz\nLmFkZChfc2VsZWN0cy5pbmRleE9mKF9vcmRlcmVkLmdldChpKSkpOwogICAg\nICAgIHJldHVybiBpZHhzOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJl\nUHJpbWFyeUtleShPYmplY3Qgb2lkLCBDbGFzc01hcHBpbmcgbWFwcGluZywK\nICAgICAgICBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICB3aGVyZVByaW1h\ncnlLZXkob2lkLCBtYXBwaW5nLCBudWxsLCBzdG9yZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGQgd2hlcmUgY29uZGl0aW9ucyBzZXR0aW5nIHRoZSBt\nYXBwaW5nJ3MgcHJpbWFyeSBrZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQg\ndmFsdWVzLiBJZiB0aGUgZ2l2ZW4gbWFwcGluZyBkb2VzIG5vdCB1c2Ugb2lk\nIHZhbHVlcyBmb3IgaXRzCiAgICAgKiBwcmltYXJ5IGtleSwgd2Ugd2lsbCBy\nZWN1cnNpdmVseSBqb2luIHRvIGl0cyBzdXBlcmNsYXNzIHVudGlsIHdlIGZp\nbmQKICAgICAqIGFuIGFuY2VzdG9yIHRoYXQgZG9lcy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIHdoZXJlUHJpbWFyeUtleShPYmplY3Qgb2lkLCBDbGFz\nc01hcHBpbmcgbWFwcGluZywgSm9pbnMgam9pbnMsCiAgICAgICAgSkRCQ1N0\nb3JlIHN0b3JlKSB7CiAgICAgICAgLy8gaWYgdGhpcyBtYXBwaW5nJ3MgaWRl\nbnRpZmllcnMgaW5jbHVkZSBzb21ldGhpbmcgb3RoZXIgdGhhbgogICAgICAg\nIC8vIHRoZSBwayB2YWx1ZXMsIGpvaW4gdG8gc3VwZXIgYW5kIHJlY3Vyc2UK\nICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQoZmFs\nc2UpKSB7CiAgICAgICAgICAgIENsYXNzTWFwcGluZyBzdXAgPSBtYXBwaW5n\nLmdldEpvaW5hYmxlUENTdXBlcmNsYXNzTWFwcGluZygpOwogICAgICAgICAg\nICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIGpvaW5zID0g\nbmV3Sm9pbnMoKTsKICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5T\ndXBlcmNsYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgIHdoZXJlUHJp\nbWFyeUtleShvaWQsIHN1cCwgam9pbnMsIHN0b3JlKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgQ29sdW1uW10gY29scyA9IG1h\ncHBpbmcuZ2V0UHJpbWFyeUtleUNvbHVtbnMoKTsKICAgICAgICB3aGVyZShv\naWQsIG1hcHBpbmcsIGNvbHMsIGNvbHMsIG51bGwsIG51bGwsIGdldEpvaW5z\nKGpvaW5zLCB0cnVlKSwKICAgICAgICAgICAgc3RvcmUpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHdoZXJlRm9yZWlnbktleShGb3JlaWduS2V5IGZrLCBP\nYmplY3Qgb2lkLAogICAgICAgIENsYXNzTWFwcGluZyBtYXBwaW5nLCBKREJD\nU3RvcmUgc3RvcmUpIHsKICAgICAgICB3aGVyZUZvcmVpZ25LZXkoZmssIG9p\nZCwgbWFwcGluZywgbnVsbCwgc3RvcmUpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkIHdoZXJlIGNvbmRpdGlvbnMgc2V0dGluZyB0aGUgZ2l2ZW4gZm9y\nZWlnbiBrZXkgdG8gdGhlIGdpdmVuCiAgICAgKiBvaWQgdmFsdWVzLgogICAg\nICoKICAgICAqIEBzZWUgI3doZXJlUHJpbWFyeUtleQogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgd2hlcmVGb3JlaWduS2V5KEZvcmVpZ25LZXkgZmssIE9i\namVjdCBvaWQsCiAgICAgICAgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIEpvaW5z\nIGpvaW5zLCBKREJDU3RvcmUgc3RvcmUpIHsKICAgICAgICAvLyBpZiB0aGlz\nIG1hcHBpbmcncyBpZGVudGlmaWVycyBpbmNsdWRlIHNvbWV0aGluZyBvdGhl\nciB0aGFuCiAgICAgICAgLy8gdGhlIHBrIHZhbHVlcywgb3IgaWYgdGhpcyBm\nb3JlaWduIGtleSBkb2Vzbid0IGxpbmsgdG8gb25seQogICAgICAgIC8vIGlk\nZW50aWZpZXJzLCBqb2luIHRvIHRhYmxlIGFuZCBkbyBhIGdldFByaW1hcnlL\nZXkKICAgICAgICBpZiAoIW1hcHBpbmcuaXNQcmltYXJ5S2V5T2JqZWN0SWQo\nZmFsc2UpIHx8ICFjb250YWluc0FsbAogICAgICAgICAgICAobWFwcGluZy5n\nZXRQcmltYXJ5S2V5Q29sdW1ucygpLCBmay5nZXRQcmltYXJ5S2V5Q29sdW1u\ncygpKSkgewogICAgICAgICAgICBpZiAoam9pbnMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIGpvaW5zID0gbmV3Sm9pbnMoKTsKICAgICAgICAgICAgLy8g\ndHJhdmVyc2UgdG8gZm9yZWlnbiBrZXkgdGFyZ2V0IG1hcHBpbmcKICAgICAg\nICAgICAgd2hpbGUgKG1hcHBpbmcuZ2V0VGFibGUoKSAhPSBmay5nZXRQcmlt\nYXJ5S2V5VGFibGUoKSkgewogICAgICAgICAgICAgICAgaWYgKGpvaW5zID09\nIG51bGwpCiAgICAgICAgICAgICAgICAgICAgam9pbnMgPSBuZXdKb2lucygp\nOwogICAgICAgICAgICAgICAgam9pbnMgPSBtYXBwaW5nLmpvaW5TdXBlcmNs\nYXNzKGpvaW5zLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBtYXBwaW5nID0g\nbWFwcGluZy5nZXRKb2luYWJsZVBDU3VwZXJjbGFzc01hcHBpbmcoKTsKICAg\nICAgICAgICAgICAgIGlmIChtYXBwaW5nID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgam9pbnMgPSBqb2lucy5qb2luKGZrLCBm\nYWxzZSwgZmFsc2UpOwogICAgICAgICAgICB3aGVyZVByaW1hcnlLZXkob2lk\nLCBtYXBwaW5nLCBqb2lucywgc3RvcmUpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICBDb2x1bW5bXSBmcm9tQ29scyA9IGZrLmdl\ndENvbHVtbnMoKTsKICAgICAgICBDb2x1bW5bXSB0b0NvbHMgPSBmay5nZXRQ\ncmltYXJ5S2V5Q29sdW1ucygpOwogICAgICAgIENvbHVtbltdIGNvbnN0Q29s\ncyA9IGZrLmdldENvbnN0YW50Q29sdW1ucygpOwogICAgICAgIE9iamVjdFtd\nIGNvbnN0cyA9IGZrLmdldENvbnN0YW50cygpOwogICAgICAgIHdoZXJlKG9p\nZCwgbWFwcGluZywgdG9Db2xzLCBmcm9tQ29scywgY29uc3RzLCBjb25zdENv\nbHMsCiAgICAgICAgICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKSwgc3RvcmUp\nOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgbWV0aG9kIHRvIGZs\ndXNoIHRoZSBvaWQgdmFsdWVzIGFzIHdoZXJlIGNvbmRpdGlvbnMgdG8gdGhl\nCiAgICAgKiBnaXZlbiBjb2x1bW5zLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgd2hlcmUoT2JqZWN0IG9pZCwgQ2xhc3NNYXBwaW5nIG1hcHBpbmcsIENv\nbHVtbltdIHRvQ29scywKICAgICAgICBDb2x1bW5bXSBmcm9tQ29scywgT2Jq\nZWN0W10gdmFscywgQ29sdW1uW10gY29uc3RDb2xzLCBQYXRoSm9pbnMgcGos\nCiAgICAgICAgSkRCQ1N0b3JlIHN0b3JlKSB7CiAgICAgICAgVmFsdWVNYXBw\naW5nIGVtYmVkID0gbWFwcGluZy5nZXRFbWJlZGRpbmdNYXBwaW5nKCk7CiAg\nICAgICAgaWYgKGVtYmVkICE9IG51bGwpIHsKICAgICAgICAgICAgd2hlcmUo\nb2lkLCBlbWJlZC5nZXRGaWVsZE1hcHBpbmcoKS5nZXREZWZpbmluZ01hcHBp\nbmcoKSwKICAgICAgICAgICAgICAgIHRvQ29scywgZnJvbUNvbHMsIHZhbHMs\nIGNvbnN0Q29scywgcGosIHN0b3JlKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gb25seSBib3RoZXIgdG8gcGFjayBwayB2\nYWx1ZXMgaW50byBhcnJheSBpZiBhcHAgaWQKICAgICAgICBPYmplY3RbXSBw\na3MgPSBudWxsOwogICAgICAgIGlmIChtYXBwaW5nLmdldElkZW50aXR5VHlw\nZSgpID09IENsYXNzTWFwcGluZy5JRF9BUFBMSUNBVElPTikKICAgICAgICAg\nICAgcGtzID0gQXBwbGljYXRpb25JZHMudG9QS1ZhbHVlcyhvaWQsIG1hcHBp\nbmcpOwoKICAgICAgICBTUUxCdWZmZXIgYnVmID0gbmV3IFNRTEJ1ZmZlcihf\nZGljdCk7CiAgICAgICAgSm9pbmFibGUgam9pbjsKICAgICAgICBPYmplY3Qg\ndmFsOwogICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCB0b0NvbHMubGVuZ3RoOyBpKyssIGNvdW50KyspIHsKICAg\nICAgICAgICAgaWYgKHBrcyA9PSBudWxsKQogICAgICAgICAgICAgICAgdmFs\nID0gKG9pZCA9PSBudWxsKSA/IG51bGwgOgogICAgICAgICAgICAgICAgICAg\nICAgICAoKElkKSBvaWQpLmdldElkKCk7CiAgICAgICAgICAgIGVsc2Ugewog\nICAgICAgICAgICAgICAgLy8gbXVzdCBiZSBhcHAgaWRlbnRpdHk7IHVzZSBw\nayBpbmRleCB0byBnZXQgY29ycmVjdCBwayB2YWx1ZQogICAgICAgICAgICAg\nICAgam9pbiA9IG1hcHBpbmcuYXNzZXJ0Sm9pbmFibGUodG9Db2xzW2ldKTsK\nICAgICAgICAgICAgICAgIHZhbCA9IHBrc1ttYXBwaW5nLmdldEZpZWxkKGpv\naW4uZ2V0RmllbGRJbmRleCgpKS4KICAgICAgICAgICAgICAgICAgICBnZXRQ\ncmltYXJ5S2V5SW5kZXgoKV07CiAgICAgICAgICAgICAgICB2YWwgPSBqb2lu\nLmdldEpvaW5WYWx1ZSh2YWwsIHRvQ29sc1tpXSwgc3RvcmUpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBpZiAoY291bnQgPiAwKQogICAgICAgICAg\nICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsKICAgICAgICAgICAgYnVmLmFw\ncGVuZChnZXRDb2x1bW5BbGlhcyhmcm9tQ29sc1tpXSwgcGopKTsKICAgICAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICAgICAgYnVmLmFw\ncGVuZCgiIElTICIpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICBidWYuYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAgYnVmLmFwcGVuZFZh\nbHVlKHZhbCwgZnJvbUNvbHNbaV0pOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKGNvbnN0Q29scyAhPSBudWxsICYmIGNvbnN0Q29scy5sZW5ndGggPiAwKSB7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29uc3RDb2xzLmxl\nbmd0aDsgaSsrLCBjb3VudCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoY291\nbnQgPiAwKQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQoIiBBTkQg\nIik7CiAgICAgICAgICAgICAgICBidWYuYXBwZW5kKGdldENvbHVtbkFsaWFz\nKGNvbnN0Q29sc1tpXSwgcGopKTsKCiAgICAgICAgICAgICAgICBpZiAodmFs\nc1tpXSA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBJUyAiKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKCIgPSAiKTsKICAgICAgICAgICAgICAgIGJ1Zi5h\ncHBlbmRWYWx1ZSh2YWxzW2ldLCBjb25zdENvbHNbaV0pOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICB3aGVyZShidWYsIHBqKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRlc3QgdG8gc2VlIGlmIHRoZSBnaXZlbiBzZXQg\nb2YgY29sdW1ucyBjb250YWlucyBhbGwgdGhlCiAgICAgKiBjb2x1bW5zIGlu\nIHRoZSBnaXZlbiBwb3RlbnRpYWwgc3Vic2V0LgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbHVtbltdIHNldCwg\nQ29sdW1uW10gc3ViKSB7CiAgICAgICAgaWYgKHN1Yi5sZW5ndGggPiBzZXQu\nbGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8v\nIHRoaXMgaXMgb2J2aW91c2x5IG5eMiwgYnV0IHRoZSBudW1iZXIgb2YgY29s\ndW1ucyBzaG91bGQgYmUgaW4KICAgICAgICAvLyB0aGUgMS0yIHJhbmdlLCBz\nbyBubyBiaWdnaWUKICAgICAgICBib29sZWFuIGZvdW5kID0gdHJ1ZTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1Yi5sZW5ndGggJiYgZm91bmQ7\nIGkrKykgewogICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAg\nICBmb3IgKGludCBqID0gMDsgaiA8IHNldC5sZW5ndGggJiYgIWZvdW5kOyBq\nKyspCiAgICAgICAgICAgICAgICBmb3VuZCA9IHN1YltpXSA9PSBzZXRbal07\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB3aGVyZShKb2lucyBqb2lucykgewogICAgICAgIGlmIChq\nb2lucyAhPSBudWxsKQogICAgICAgICAgICB3aGVyZSgoU3RyaW5nKSBudWxs\nLCBqb2lucyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgd2hlcmUoU1FMQnVm\nZmVyIHNxbCkgewogICAgICAgIHdoZXJlKHNxbCwgKEpvaW5zKSBudWxsKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsLCBK\nb2lucyBqb2lucykgewogICAgICAgIHdoZXJlKHNxbCwgZ2V0Sm9pbnMoam9p\nbnMsIHRydWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCB0aGUgZ2l2\nZW4gY29uZGl0aW9uIHRvIHRoZSBXSEVSRSBjbGF1c2UuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCB3aGVyZShTUUxCdWZmZXIgc3FsLCBQYXRoSm9pbnMg\ncGopIHsKICAgICAgICAvLyBubyBuZWVkIHRvIHVzZSBqb2lucy4uLgogICAg\nICAgIGlmIChzcWwgPT0gbnVsbCB8fCBzcWwuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGlmIChfd2hlcmUgPT0gbnVsbCkKICAg\nICAgICAgICAgX3doZXJlID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAg\nICAgZWxzZSBpZiAoIV93aGVyZS5pc0VtcHR5KCkpCiAgICAgICAgICAgIF93\naGVyZS5hcHBlbmQoIiBBTkQgIik7CiAgICAgICAgX3doZXJlLmFwcGVuZChz\ncWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHdoZXJlKFN0cmluZyBzcWwp\nIHsKICAgICAgICB3aGVyZShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgd2hlcmUoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMp\nIHsKICAgICAgICB3aGVyZShzcWwsIGdldEpvaW5zKGpvaW5zLCB0cnVlKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVuIGNvbmRpdGlv\nbiB0byB0aGUgV0hFUkUgY2xhdXNlLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgd2hlcmUoU3RyaW5nIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAg\nLy8gbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoU3RyaW5n\nVXRpbHMuaXNFbXB0eShzcWwpKQogICAgICAgICAgICByZXR1cm47CgogICAg\nICAgIGlmIChfd2hlcmUgPT0gbnVsbCkKICAgICAgICAgICAgX3doZXJlID0g\nbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAoIV93aGVy\nZS5pc0VtcHR5KCkpCiAgICAgICAgICAgIF93aGVyZS5hcHBlbmQoIiBBTkQg\nIik7CiAgICAgICAgX3doZXJlLmFwcGVuZChzcWwpOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGhhdmluZyhTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgaGF2\naW5nKHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBoYXZpbmcoU1FMQnVmZmVyIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBoYXZpbmcoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhl\nIEhBVklORyBjbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYXZp\nbmcoU1FMQnVmZmVyIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8g\nbm8gbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoc3FsID09IG51\nbGwgfHwgc3FsLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICBpZiAoX2hhdmluZyA9PSBudWxsKQogICAgICAgICAgICBfaGF2aW5n\nID0gbmV3IFNRTEJ1ZmZlcihfZGljdCk7CiAgICAgICAgZWxzZSBpZiAoIV9o\nYXZpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICBfaGF2aW5nLmFwcGVuZCgi\nIEFORCAiKTsKICAgICAgICBfaGF2aW5nLmFwcGVuZChzcWwpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGhhdmluZyhTdHJpbmcgc3FsKSB7CiAgICAgICAg\naGF2aW5nKHNxbCwgKEpvaW5zKSBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBoYXZpbmcoU3RyaW5nIHNxbCwgSm9pbnMgam9pbnMpIHsKICAgICAg\nICBoYXZpbmcoc3FsLCBnZXRKb2lucyhqb2lucywgdHJ1ZSkpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIHRoZSBnaXZlbiBjb25kaXRpb24gdG8gdGhl\nIEhBVklORyBjbGF1c2UuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBoYXZp\nbmcoU3RyaW5nIHNxbCwgUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8gbm8g\nbmVlZCB0byB1c2Ugam9pbnMuLi4KICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNFbXB0eShzcWwpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlm\nIChfaGF2aW5nID09IG51bGwpCiAgICAgICAgICAgIF9oYXZpbmcgPSBuZXcg\nU1FMQnVmZmVyKF9kaWN0KTsKICAgICAgICBlbHNlIGlmICghX2hhdmluZy5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIF9oYXZpbmcuYXBwZW5kKCIgQU5EICIp\nOwogICAgICAgIF9oYXZpbmcuYXBwZW5kKHNxbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgZ3JvdXBCeShTUUxCdWZmZXIgc3FsKSB7CiAgICAgICAgZ3Jv\ndXBCeShzcWwsIChKb2lucykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgZ3JvdXBCeShTUUxCdWZmZXIgc3FsLCBKb2lucyBqb2lucykgewogICAg\nICAgIGdldEpvaW5zKGpvaW5zLCB0cnVlKTsKICAgICAgICBncm91cEJ5QXBw\nZW5kKHNxbC5nZXRTUUwoKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3Jv\ndXBCeShTdHJpbmcgc3FsKSB7CiAgICAgICAgZ3JvdXBCeShzcWwsIChKb2lu\ncykgbnVsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShTdHJp\nbmcgc3FsLCBKb2lucyBqb2lucykgewogICAgICAgIGdldEpvaW5zKGpvaW5z\nLCB0cnVlKTsKICAgICAgICBncm91cEJ5QXBwZW5kKHNxbCk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW4gY29sKSB7CiAgICAgICAg\nZ3JvdXBCeShjb2wsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGdy\nb3VwQnkoQ29sdW1uIGNvbCwgSm9pbnMgam9pbnMpIHsKICAgICAgICBQYXRo\nSm9pbnMgcGogPSBnZXRKb2lucyhqb2lucywgdHJ1ZSk7CiAgICAgICAgZ3Jv\ndXBCeUFwcGVuZChnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgZ3JvdXBCeShDb2x1bW5bXSBjb2xzKSB7CiAgICAg\nICAgZ3JvdXBCeShjb2xzLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBncm91cEJ5KENvbHVtbltdIGNvbHMsIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgUGF0aEpvaW5zIHBqID0gZ2V0Sm9pbnMoam9pbnMsIHRydWUpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29scy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBncm91cEJ5QXBwZW5kKGdldENvbHVtbkFsaWFzKGNvbHNb\naV0sIHBqKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIHZv\naWQgZ3JvdXBCeUFwcGVuZChTdHJpbmcgc3FsKSB7CiAgICAgICAgaWYgKF9n\ncm91cGVkID09IG51bGwgfHwgIV9ncm91cGVkLmNvbnRhaW5zKHNxbCkpIHsK\nICAgICAgICAgICAgaWYgKF9ncm91cGluZyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBfZ3JvdXBpbmcgPSBuZXcgU1FMQnVmZmVyKF9kaWN0KTsKICAg\nICAgICAgICAgICAgIF9ncm91cGVkID0gbmV3IEFycmF5TGlzdCgpOwogICAg\nICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIF9ncm91cGluZy5hcHBl\nbmQoIiwgIik7CgogICAgICAgICAgICBfZ3JvdXBpbmcuYXBwZW5kKHNxbCk7\nCiAgICAgICAgICAgIF9ncm91cGVkLmFkZChzcWwpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBncm91cEJ5KENsYXNzTWFwcGluZyBtYXBw\naW5nLCBpbnQgc3ViY2xhc3NlcywgSkRCQ1N0b3JlIHN0b3JlLAogICAgICAg\nIEpEQkNGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBncm91\ncEJ5KG1hcHBpbmcsIHN1YmNsYXNzZXMsIHN0b3JlLCBmZXRjaCwgbnVsbCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZ3JvdXBCeShDbGFzc01hcHBpbmcg\nbWFwcGluZywgaW50IHN1YmNsYXNzZXMsIEpEQkNTdG9yZSBzdG9yZSwKICAg\nICAgICBKREJDRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBKb2lucyBqb2lu\ncykgewogICAgICAgIC8vIHdlIGltcGxlbWVudCB0aGlzIGJ5IHB1dHRpbmcg\nb3Vyc2VsdmVzIGludG8gZ3JvdXBpbmcgbW9kZSwgd2hlcmUKICAgICAgICAv\nLyBhbGwgc2VsZWN0IGludm9jYXRpb25zIGFyZSByZS1yb3V0ZWQgdG8gZ3Jv\ndXAtYnkgaW52b2NhdGlvbnMgaW5zdGVhZC4KICAgICAgICAvLyB0aGlzIGFs\nbG93cyB1cyB0byB1dGlsaXplIHRoZSBzYW1lIHNlbGVjdCBBUElzIG9mIHRo\nZSBzdG9yZSBtYW5hZ2VyCiAgICAgICAgLy8gYW5kIGFsbCB0aGUgbWFwcGlu\nZyBzdHJhdGVnaWVzLCByYXRoZXIgdGhhbiBoYXZpbmcgdG8gY3JlYXRlIAog\nICAgICAgIC8vIGVxdWl2YWxlbnQgQVBJcyBhbmQgZHVwbGljYXRlIGxvZ2lj\nIGZvciBncm91cGluZwogICAgICAgIGJvb2xlYW4gd2FzR3JvdXBpbmcgPSBp\nc0dyb3VwaW5nKCk7CiAgICAgICAgX2ZsYWdzIHw9IEdST1VQSU5HOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHNlbGVjdChtYXBwaW5nLCBzdWJjbGFz\nc2VzLCBzdG9yZSwgZmV0Y2gsIAogICAgICAgICAgICAgICAgRWFnZXJGZXRj\naE1vZGVzLkVBR0VSX05PTkUsIGpvaW5zKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAoIXdhc0dyb3VwaW5nKQogICAgICAgICAgICAg\nICAgX2ZsYWdzICY9IH5HUk9VUElORzsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXaGV0aGVyIHdlJ3JlIGluIGdyb3VwIG1vZGUsIHdoZXJl\nIGFueSBzZWxlY3QgaXMgY2hhbmdlZCB0byBhIGdyb3VwLWJ5CiAgICAgKiBj\nYWxsLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4gaXNHcm91cGluZygp\nIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEdST1VQSU5HKSAhPSAwOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBqb2lucyB0byB1c2Ug\nZm9yIGNvbHVtbiBhbGlhc2VzLCBldGMuCiAgICAgKgogICAgICogQHBhcmFt\nIGpvaW5zIGpvaW5zIGdpdmVuIGJ5IHRoZSB1c2VyCiAgICAgKiBAcmV0dXJu\nIHRoZSBqb2lucyB0byB1c2UgZm9yIGFsaWFzZXMsIGV0YwogICAgICovCiAg\nICBwcml2YXRlIFBhdGhKb2lucyBnZXRKb2lucyhKb2lucyBqb2lucywgYm9v\nbGVhbiByZWNvcmQpIHsKICAgICAgICBQYXRoSm9pbnMgcGogPSAoUGF0aEpv\naW5zKSBqb2luczsKICAgICAgICBib29sZWFuIHByZSA9IChwaiA9PSBudWxs\nIHx8ICFwai5pc0RpcnR5KCkpCiAgICAgICAgICAgICYmIF9wcmVKb2lucyAh\nPSBudWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgpOwogICAgICAgIGlmIChw\ncmUpCiAgICAgICAgICAgIHBqID0gKFBhdGhKb2lucykgX3ByZUpvaW5zLnBl\nZWsoKTsKCiAgICAgICAgaWYgKHBqID09IG51bGwgfHwgIXBqLmlzRGlydHko\nKSkKICAgICAgICAgICAgcGogPSBfam9pbnM7CiAgICAgICAgZWxzZSBpZiAo\nIXByZSkgewogICAgICAgICAgICBpZiAoKF9mbGFncyAmIE9VVEVSKSAhPSAw\nKQogICAgICAgICAgICAgICAgcGogPSAoUGF0aEpvaW5zKSBvdXRlcihwaik7\nCiAgICAgICAgICAgIGlmIChyZWNvcmQpIHsKICAgICAgICAgICAgICAgIGlm\nICghcGouaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9q\nb2lucyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfam9pbnMg\nPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKF9qb2lucy5qb2lucygpID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgICAgIF9qb2lucy5zZXRKb2lucyhuZXcgSm9pblNldChwai5qb2lucygp\nKSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nICAgICAgICBfam9pbnMuam9pbnMoKS5hZGRBbGwocGouam9pbnMoKSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHBqOwogICAgfQoKICAgIHB1YmxpYyBTZWxlY3RFeGVjdXRv\nciB3aGVyZUNsb25lKGludCBzZWxzKSB7CiAgICAgICAgaWYgKHNlbHMgPCAx\nKQogICAgICAgICAgICBzZWxzID0gMTsKCiAgICAgICAgU2VsZWN0W10gY2xv\nbmVzID0gbnVsbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbDsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHNlbHM7IGkrKykgewogICAgICAgICAgICBz\nZWwgPSAoU2VsZWN0SW1wbCkgX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNl\nKCkubmV3U2VsZWN0KCk7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgPSBfZmxh\nZ3M7CiAgICAgICAgICAgIHNlbC5fZmxhZ3MgJj0gfkFHR1JFR0FURTsKICAg\nICAgICAgICAgc2VsLl9mbGFncyAmPSB+T1VURVI7CiAgICAgICAgICAgIHNl\nbC5fZmxhZ3MgJj0gfkxSUzsKICAgICAgICAgICAgc2VsLl9mbGFncyAmPSB+\nRUFHRVJfVE9fT05FOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5FQUdF\nUl9UT19NQU5ZOwogICAgICAgICAgICBzZWwuX2ZsYWdzICY9IH5GT1JDRV9D\nT1VOVDsKICAgICAgICAgICAgc2VsLl9qb2luU3ludGF4ID0gX2pvaW5TeW50\nYXg7CiAgICAgICAgICAgIHNlbC5fc2NoZW1hQWxpYXMgPSBfc2NoZW1hQWxp\nYXM7CiAgICAgICAgICAgIGlmIChfYWxpYXNlcyAhPSBudWxsKQogICAgICAg\nICAgICAgICAgc2VsLl9hbGlhc2VzID0gbmV3IEhhc2hNYXAoX2FsaWFzZXMp\nOwogICAgICAgICAgICBpZiAoX3RhYmxlcyAhPSBudWxsKQogICAgICAgICAg\nICAgICAgc2VsLl90YWJsZXMgPSBuZXcgVHJlZU1hcChfdGFibGVzKTsKICAg\nICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nc2VsLl9qb2lucyA9IF9qb2lucy5jbG9uZShzZWwpOwogICAgICAgICAgICBp\nZiAoX3doZXJlICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX3doZXJl\nID0gbmV3IFNRTEJ1ZmZlcihfd2hlcmUpOwogICAgICAgICAgICBpZiAoX2Zy\nb20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsLl9mcm9tID0gKFNl\nbGVjdEltcGwpIF9mcm9tLndoZXJlQ2xvbmUoMSk7CiAgICAgICAgICAgICAg\nICBzZWwuX2Zyb20uX291dGVyID0gc2VsOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChfc3Vic2VscyAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBzZWwuX3N1YnNlbHMgPSBuZXcgQXJyYXlMaXN0KF9zdWJzZWxzLnNpemUo\nKSk7CiAgICAgICAgICAgICAgICBTZWxlY3RJbXBsIHN1Yiwgc2VsU3ViOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBfc3Vic2Vscy5z\naXplKCk7IGorKykgewogICAgICAgICAgICAgICAgICAgIHN1YiA9IChTZWxl\nY3RJbXBsKSBfc3Vic2Vscy5nZXQoaik7CiAgICAgICAgICAgICAgICAgICAg\nc2VsU3ViID0gKFNlbGVjdEltcGwpIHN1Yi5mdWxsQ2xvbmUoMSk7CiAgICAg\nICAgICAgICAgICAgICAgc2VsU3ViLl9wYXJlbnQgPSBzZWw7CiAgICAgICAg\nICAgICAgICAgICAgc2VsU3ViLl9zdWJQYXRoID0gc3ViLl9zdWJQYXRoOwog\nICAgICAgICAgICAgICAgICAgIHNlbC5fc3Vic2Vscy5hZGQoc2VsU3ViKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoc2VsLl93aGVyZSAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBzZWwuX3doZXJlLnJlcGxhY2Uoc3Vi\nLCBzZWxTdWIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoc2VscyA9PSAxKQogICAgICAgICAgICAgICAgcmV0\ndXJuIHNlbDsKICAgICAgICAgICAgaWYgKGNsb25lcyA9PSBudWxsKQogICAg\nICAgICAgICAgICAgY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsKICAgICAg\nICAgICAgY2xvbmVzW2ldID0gc2VsOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gX2NvbmYuZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3VW5pb24oY2xv\nbmVzKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3IgZnVsbENs\nb25lKGludCBzZWxzKSB7CiAgICAgICAgaWYgKHNlbHMgPCAxKQogICAgICAg\nICAgICBzZWxzID0gMTsKCiAgICAgICAgU2VsZWN0W10gY2xvbmVzID0gbnVs\nbDsKICAgICAgICBTZWxlY3RJbXBsIHNlbDsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHNlbHM7IGkrKykgewogICAgICAgICAgICBzZWwgPSAoU2Vs\nZWN0SW1wbCkgd2hlcmVDbG9uZSgxKTsKICAgICAgICAgICAgc2VsLl9mbGFn\ncyA9IF9mbGFnczsKICAgICAgICAgICAgc2VsLl9leHBlY3RlZFJlc3VsdENv\ndW50ID0gX2V4cGVjdGVkUmVzdWx0Q291bnQ7CiAgICAgICAgICAgIHNlbC5f\nc2VsZWN0cy5hZGRBbGwoX3NlbGVjdHMpOwogICAgICAgICAgICBpZiAoX29y\nZGVyaW5nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX29yZGVyaW5n\nID0gbmV3IFNRTEJ1ZmZlcihfb3JkZXJpbmcpOwogICAgICAgICAgICBzZWwu\nX29yZGVycyA9IF9vcmRlcnM7CiAgICAgICAgICAgIGlmIChfZ3JvdXBpbmcg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNlbC5fZ3JvdXBpbmcgPSBuZXcg\nU1FMQnVmZmVyKF9ncm91cGluZyk7CiAgICAgICAgICAgIGlmIChfaGF2aW5n\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBzZWwuX2hhdmluZyA9IG5ldyBT\nUUxCdWZmZXIoX2hhdmluZyk7CiAgICAgICAgICAgIGlmIChfZnJvbSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBzZWwuX2Zyb20gPSAoU2VsZWN0SW1w\nbCkgX2Zyb20uZnVsbENsb25lKDEpOwogICAgICAgICAgICAgICAgc2VsLl9m\ncm9tLl9vdXRlciA9IHNlbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKHNlbHMgPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWw7CiAg\nICAgICAgICAgIGlmIChjbG9uZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nIGNsb25lcyA9IG5ldyBTZWxlY3Rbc2Vsc107CiAgICAgICAgICAgIGNsb25l\nc1tpXSA9IHNlbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9jb25mLmdl\ndFNRTEZhY3RvcnlJbnN0YW5jZSgpLm5ld1VuaW9uKGNsb25lcyk7CiAgICB9\nCgogICAgcHVibGljIFNlbGVjdEV4ZWN1dG9yIGVhZ2VyQ2xvbmUoRmllbGRN\nYXBwaW5nIGtleSwgaW50IGVhZ2VyVHlwZSwKICAgICAgICBib29sZWFuIHRv\nTWFueSwgaW50IHNlbHMpIHsKICAgICAgICBpZiAoZWFnZXJUeXBlID09IEVB\nR0VSX09VVEVSCiAgICAgICAgICAgICYmIF9qb2luU3ludGF4ID09IEpvaW5T\neW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIGlmIChfZWFnZXJLZXlzICE9IG51bGwgJiYgX2Vh\nZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgLy8gZ2xvYmFsIHNldCBvZiBlYWdlciBrZXlzCiAgICAg\nICAgaWYgKF9lYWdlcktleXMgPT0gbnVsbCkKICAgICAgICAgICAgX2VhZ2Vy\nS2V5cyA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgX2VhZ2VyS2V5cy5hZGQo\na2V5KTsKCiAgICAgICAgU2VsZWN0RXhlY3V0b3Igc2VsOwogICAgICAgIGlm\nIChlYWdlclR5cGUgIT0gRUFHRVJfUEFSQUxMRUwpIHsKICAgICAgICAgICAg\naWYgKHRvTWFueSkKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBFQUdFUl9U\nT19NQU5ZOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgfD0gRUFHRVJfVE9fT05FOwogICAgICAgICAgICBzZWwgPSB0aGlzOwog\nICAgICAgIH0gZWxzZSBpZiAoc2VscyA8IDIpCiAgICAgICAgICAgIHNlbCA9\nIHBhcmFsbGVsQ2xvbmUoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nU2VsZWN0W10gY2xvbmVzID0gbmV3IFNlbGVjdFtzZWxzXTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbG9uZXMubGVuZ3RoOyBpKyspCiAg\nICAgICAgICAgICAgICBjbG9uZXNbaV0gPSBwYXJhbGxlbENsb25lKCk7CiAg\nICAgICAgICAgIHNlbCA9IF9jb25mLmdldFNRTEZhY3RvcnlJbnN0YW5jZSgp\nLm5ld1VuaW9uKGNsb25lcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2Vh\nZ2VyID09IG51bGwpCiAgICAgICAgICAgIF9lYWdlciA9IG5ldyBIYXNoTWFw\nKCk7CiAgICAgICAgX2VhZ2VyLnB1dCh0b0VhZ2VyS2V5KGtleSwgZ2V0Sm9p\nbnMobnVsbCwgZmFsc2UpKSwgc2VsKTsKICAgICAgICByZXR1cm4gc2VsOwog\nICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY2xvbmUgb2YgdGhpcyBz\nZWxlY3QgZm9yIHVzZSBpbiBlYWdlciBwYXJhbGxlbCBzZWxlY3RzLgogICAg\nICovCiAgICBwcml2YXRlIFNlbGVjdEltcGwgcGFyYWxsZWxDbG9uZSgpIHsK\nICAgICAgICBTZWxlY3RJbXBsIHNlbCA9IChTZWxlY3RJbXBsKSB3aGVyZUNs\nb25lKDEpOwogICAgICAgIHNlbC5fZmxhZ3MgJj0gfk5PTkFVVE9fRElTVElO\nQ1Q7CiAgICAgICAgc2VsLl9lYWdlcktleXMgPSBfZWFnZXJLZXlzOwogICAg\nICAgIGlmIChfcHJlSm9pbnMgIT0gbnVsbCAmJiAhX3ByZUpvaW5zLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICBzZWwuX3ByZUpvaW5zID0gbmV3IFN0YWNr\nKCk7CiAgICAgICAgICAgIHNlbC5fcHJlSm9pbnMucHVzaCgoKFNlbGVjdEpv\naW5zKSBfcHJlSm9pbnMucGVlaygpKS4KICAgICAgICAgICAgICAgIGNsb25l\nKHNlbCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHZpZXcgb2YgZWFnZXIgc2VsZWN0cy4g\nTWF5IGJlIG51bGwuCiAgICAgKi8KICAgIHB1YmxpYyBNYXAgZ2V0RWFnZXJN\nYXAoKSB7CiAgICAgICAgcmV0dXJuIF9lYWdlcjsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBsb2dFYWdlclJlbGF0aW9ucygpIHsKICAgICAgICBpZiAoX2Vh\nZ2VyS2V5cyAhPSBudWxsKSB7CiAgICAgICAgICAgIF9jb25mLmdldExvZyhK\nREJDQ29uZmlndXJhdGlvbi5MT0dfRElBRykudHJhY2UoCiAgICAgICAgICAg\nICAgICAiRWFnZXIgcmVsYXRpb25zOiAiK19lYWdlcktleXMpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0RXhlY3V0b3IgZ2V0RWFnZXIo\nRmllbGRNYXBwaW5nIGtleSkgewogICAgICAgIGlmIChfZWFnZXIgPT0gbnVs\nbCB8fCAhX2VhZ2VyS2V5cy5jb250YWlucyhrZXkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gKFNlbGVjdEV4ZWN1dG9yKSBf\nZWFnZXIuZ2V0KHRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsLAogICAg\nICAgICAgICBmYWxzZSkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgZWFnZXIga2V5IHRvIHVzZSBmb3IgdGhlIHVzZXItZ2l2ZW4ga2V5\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3QgdG9FYWdlcktl\neShGaWVsZE1hcHBpbmcga2V5LCBQYXRoSm9pbnMgcGopIHsKICAgICAgICBp\nZiAocGogPT0gbnVsbCB8fCBwai5wYXRoKCkgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIGtleTsKICAgICAgICByZXR1cm4gbmV3IEtleShwai5wYXRo\nKCkudG9TdHJpbmcoKSwga2V5KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMg\nbmV3Sm9pbnMoKSB7CiAgICAgICAgaWYgKF9wcmVKb2lucyAhPSBudWxsICYm\nICFfcHJlSm9pbnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIFNlbGVjdEpv\naW5zIHNqID0gKFNlbGVjdEpvaW5zKSBfcHJlSm9pbnMucGVlaygpOwogICAg\nICAgICAgICByZXR1cm4gc2ouY2xvbmUodGhpcyk7CiAgICAgICAgfQogICAg\nICAgIC8vIHJldHVybiB0aGlzIGZvciBlZmZpY2llbmN5IGluIGNhc2Ugbm8g\nam9pbnMgZW5kIHVwIGJlaW5nIG1hZGUKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgbmV3T3V0ZXJKb2lucygpIHsKICAg\nICAgICByZXR1cm4gKChQYXRoSm9pbnMpIG5ld0pvaW5zKCkpLnNldE91dGVy\nKHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFwcGVuZChTUUxCdWZm\nZXIgYnVmLCBKb2lucyBqb2lucykgewogICAgICAgIGlmIChqb2lucyA9PSBu\ndWxsIHx8IGpvaW5zLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIGlmIChfam9pblN5bnRheCA9PSBKb2luU3ludGF4ZXMuU1lOVEFY\nX1NRTDkyKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmICghYnVm\nLmlzRW1wdHkoKSkKICAgICAgICAgICAgYnVmLmFwcGVuZCgiIEFORCAiKTsK\nICAgICAgICBKb2luIGpvaW4gPSBudWxsOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gKChQYXRoSm9pbnMpIGpvaW5zKS5qb2lucygpLmpvaW5JdGVy\nYXRvcigpOwogICAgICAgICAgICBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICBqb2luID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHN3\naXRjaCAoX2pvaW5TeW50YXgpIHsKICAgICAgICAgICAgICAgIGNhc2UgSm9p\nblN5bnRheGVzLlNZTlRBWF9UUkFESVRJT05BTDoKICAgICAgICAgICAgICAg\nICAgICBidWYuYXBwZW5kKF9kaWN0LnRvVHJhZGl0aW9uYWxKb2luKGpvaW4p\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgSm9pblN5bnRheGVzLlNZTlRBWF9EQVRBQkFTRToKICAgICAgICAg\nICAgICAgICAgICBidWYuYXBwZW5kKF9kaWN0LnRvTmF0aXZlSm9pbihqb2lu\nKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRl\ncm5hbEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIiBBTkQgIik7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBKb2lucyBh\nbmQoSm9pbnMgam9pbnMxLCBKb2lucyBqb2luczIpIHsKICAgICAgICByZXR1\ncm4gYW5kKChQYXRoSm9pbnMpIGpvaW5zMSwgKFBhdGhKb2lucykgam9pbnMy\nLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgU2VsZWN0IGdldFNlbGVjdCgp\nIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbWJpbmUgdGhlIGdpdmVuIGpvaW5zLgogICAgICovCiAgICBwcml2YXRl\nIFNlbGVjdEpvaW5zIGFuZChQYXRoSm9pbnMgajEsIFBhdGhKb2lucyBqMiwg\nYm9vbGVhbiBudWxsSm9pbnMpIHsKICAgICAgICBpZiAoKGoxID09IG51bGwg\nfHwgajEuaXNFbXB0eSgpKQogICAgICAgICAgICAmJiAoajIgPT0gbnVsbCB8\nfCBqMi5pc0VtcHR5KCkpKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAg\nICAgICAgU2VsZWN0Sm9pbnMgc2ogPSBuZXcgU2VsZWN0Sm9pbnModGhpcyk7\nCiAgICAgICAgaWYgKGoxID09IG51bGwgfHwgajEuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgIGlmIChqMi5nZXRTZWxlY3QoKSA9PSB0aGlzKSB7CiAgICAg\nICAgICAgICAgICBpZiAobnVsbEpvaW5zKQogICAgICAgICAgICAgICAgICAg\nIHNqLnNldEpvaW5zKGoyLmpvaW5zKCkpOwogICAgICAgICAgICAgICAgZWxz\nZQogICAgICAgICAgICAgICAgICAgIHNqLnNldEpvaW5zKG5ldyBKb2luU2V0\nKGoyLmpvaW5zKCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIEpvaW5TZXQgc2V0ID0gbnVsbDsKICAgICAgICAgICAg\naWYgKGoxLmdldFNlbGVjdCgpID09IHRoaXMpIHsKICAgICAgICAgICAgICAg\nIGlmIChudWxsSm9pbnMpCiAgICAgICAgICAgICAgICAgICAgc2V0ID0gajEu\nam9pbnMoKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICBzZXQgPSBuZXcgSm9pblNldChqMS5qb2lucygpKTsKCiAgICAgICAg\nICAgICAgICBpZiAoajIgIT0gbnVsbCAmJiAhajIuaXNFbXB0eSgpCiAgICAg\nICAgICAgICAgICAgICAgJiYgajIuZ2V0U2VsZWN0KCkgPT0gdGhpcykKICAg\nICAgICAgICAgICAgICAgICBzZXQuYWRkQWxsKGoyLmpvaW5zKCkpOwogICAg\nICAgICAgICAgICAgc2ouc2V0Sm9pbnMoc2V0KTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gbnVsbCBwcmV2aW91cyBqb2luczsgYWxs\nIGFyZSBjb21iaW5lZCBpbnRvIHRoaXMgb25lCiAgICAgICAgaWYgKG51bGxK\nb2lucyAmJiBqMSAhPSBudWxsKQogICAgICAgICAgICBqMS5udWxsSm9pbnMo\nKTsKICAgICAgICBpZiAobnVsbEpvaW5zICYmIGoyICE9IG51bGwpCiAgICAg\nICAgICAgIGoyLm51bGxKb2lucygpOwoKICAgICAgICByZXR1cm4gc2o7CiAg\nICB9CgogICAgcHVibGljIEpvaW5zIG9yKEpvaW5zIGpvaW5zMSwgSm9pbnMg\nam9pbnMyKSB7CiAgICAgICAgUGF0aEpvaW5zIGoxID0gKFBhdGhKb2lucykg\nam9pbnMxOwogICAgICAgIFBhdGhKb2lucyBqMiA9IChQYXRoSm9pbnMpIGpv\naW5zMjsKCiAgICAgICAgLy8gaWYgbm8gY29tbW9uIGpvaW5zLCByZXR1cm4g\nbnVsbDsgaWYgb25lIHNpZGUgb2YgdGhlIG9yIGNsYXVzZSBoYXMKICAgICAg\nICAvLyBkaWZmZXJlbnQgam9pbnMgdGhhbiB0aGUgb3RoZXIsIHRoZW4gd2Ug\nbmVlZCB0byB1c2UgZGlzdGluY3QKICAgICAgICBib29sZWFuIGoxRW1wdHkg\nPSBqMSA9PSBudWxsIHx8IGoxLmlzRW1wdHkoKTsKICAgICAgICBib29sZWFu\nIGoyRW1wdHkgPSBqMiA9PSBudWxsIHx8IGoyLmlzRW1wdHkoKTsKICAgICAg\nICBpZiAoajFFbXB0eSB8fCBqMkVtcHR5KSB7CiAgICAgICAgICAgIGlmIChq\nMUVtcHR5ICYmICFqMkVtcHR5KSB7CiAgICAgICAgICAgICAgICBjb2xsZWN0\nT3V0ZXJKb2lucyhqMik7CiAgICAgICAgICAgICAgICBpZiAoIWoyLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgICAgICAgICBfZmxhZ3MgfD0gSU1QTElDSVRf\nRElTVElOQ1Q7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoajJFbXB0eSAmJiAh\najFFbXB0eSkgewogICAgICAgICAgICAgICAgY29sbGVjdE91dGVySm9pbnMo\najEpOwogICAgICAgICAgICAgICAgaWYgKCFqMS5pc0VtcHR5KCkpCiAgICAg\nICAgICAgICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaWYgYWxsIGNvbW1vbiBqb2lucywgbW92ZSBhbGwg\nam9pbnMgdG8gcmV0dXJuZWQgaW5zdGFuY2UKICAgICAgICBTZWxlY3RKb2lu\ncyBzaiA9IG5ldyBTZWxlY3RKb2lucyh0aGlzKTsKICAgICAgICBpZiAoajEu\nam9pbnMoKS5lcXVhbHMoajIuam9pbnMoKSkpIHsKICAgICAgICAgICAgc2ou\nc2V0Sm9pbnMoajEuam9pbnMoKSk7CiAgICAgICAgICAgIGoxLm51bGxKb2lu\ncygpOwogICAgICAgICAgICBqMi5udWxsSm9pbnMoKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBKb2luU2V0IGNvbW1vbkpvaW5zID0gbmV3IEpv\naW5TZXQoajEuam9pbnMoKSk7CiAgICAgICAgICAgIGNvbW1vbkpvaW5zLnJl\ndGFpbkFsbChqMi5qb2lucygpKTsKICAgICAgICAgICAgaWYgKCFjb21tb25K\nb2lucy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIC8vIHB1dCBjb21t\nb24gam9pbnMgaW4gcmV0dXJuZWQgaW5zdGFuY2U7IHJlbW92ZSB0aGVtIGZy\nb20KICAgICAgICAgICAgICAgIC8vIGVhY2ggZ2l2ZW4gaW5zdGFuY2UKICAg\nICAgICAgICAgICAgIHNqLnNldEpvaW5zKGNvbW1vbkpvaW5zKTsKICAgICAg\nICAgICAgICAgIGoxLmpvaW5zKCkucmVtb3ZlQWxsKGNvbW1vbkpvaW5zKTsK\nICAgICAgICAgICAgICAgIGoyLmpvaW5zKCkucmVtb3ZlQWxsKGNvbW1vbkpv\naW5zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2xsZWN0T3V0ZXJK\nb2lucyhqMSk7CiAgICAgICAgICAgIGNvbGxlY3RPdXRlckpvaW5zKGoyKTsK\nCiAgICAgICAgICAgIC8vIGlmIG9uZSBzaWRlIG9mIHRoZSBvciBjbGF1c2Ug\naGFzIGRpZmZlcmVudCBqb2lucyB0aGFuIHRoZSBvdGhlciwKICAgICAgICAg\nICAgLy8gdGhlbiB3ZSBuZWVkIHRvIHVzZSBkaXN0aW5jdAogICAgICAgICAg\nICBpZiAoIWoxLmlzRW1wdHkoKSB8fCAhajIuaXNFbXB0eSgpKQogICAgICAg\nICAgICAgICAgX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJTkNUOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gc2o7CiAgICB9CgogICAgcHVibGljIEpvaW5z\nIG91dGVyKEpvaW5zIGpvaW5zKSB7CiAgICAgICAgaWYgKF9qb2luU3ludGF4\nID09IEpvaW5TeW50YXhlcy5TWU5UQVhfVFJBRElUSU9OQUwgfHwgam9pbnMg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGpvaW5zOwoKICAgICAgICAv\nLyByZWNvcmQgdGhhdCB0aGlzIGlzIGFuIG91dGVyIGpvaW4gc2V0LCBldmVu\nIGlmIGl0J3MgZW1wdHkKICAgICAgICBQYXRoSm9pbnMgcGogPSAoKFBhdGhK\nb2lucykgam9pbnMpLnNldE91dGVyKHRydWUpOwogICAgICAgIGlmIChwai5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBwajsKCiAgICAgICAgSm9p\nbiBqb2luOwogICAgICAgIEpvaW4gcmVjOwogICAgICAgIGJvb2xlYW4gaGFz\nSm9pbnMgPSBfam9pbnMgIT0gbnVsbCAmJiBfam9pbnMuam9pbnMoKSAhPSBu\ndWxsOwogICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGouam9pbnMoKS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2lu\nID0gKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChqb2luLmdl\ndFR5cGUoKSA9PSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAgICAgICAgICAg\nIGlmICghaGFzSm9pbnMpCiAgICAgICAgICAgICAgICAgICAgam9pbi5zZXRU\neXBlKEpvaW4uVFlQRV9PVVRFUik7CiAgICAgICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICByZWMgPSBfam9pbnMuam9pbnMoKS5nZXRS\nZWNvcmRlZEpvaW4oam9pbik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJl\nYyA9PSBudWxsIHx8IHJlYy5nZXRUeXBlKCkgPT0gSm9pbi5UWVBFX09VVEVS\nKQogICAgICAgICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5U\nWVBFX09VVEVSKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gam9pbnM7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNb3ZlcyB0aGUgam9pbnMgZnJvbSB0aGUgZ2l2ZW4gaW5zdGFu\nY2UgaW50byBvdXIgb3V0ZXIgam9pbnMgc2V0LgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgY29sbGVjdE91dGVySm9pbnMoUGF0aEpvaW5zIHBqKSB7CiAg\nICAgICAgaWYgKF9qb2luU3ludGF4ID09IEpvaW5TeW50YXhlcy5TWU5UQVhf\nVFJBRElUSU9OQUwgfHwgcGogPT0gbnVsbAogICAgICAgICAgICB8fCBwai5p\nc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKF9q\nb2lucyA9PSBudWxsKQogICAgICAgICAgICBfam9pbnMgPSBuZXcgU2VsZWN0\nSm9pbnModGhpcyk7CgogICAgICAgIGJvb2xlYW4gYWRkID0gdHJ1ZTsKICAg\nICAgICBpZiAoX2pvaW5zLmpvaW5zKCkgPT0gbnVsbCkgewogICAgICAgICAg\nICBfam9pbnMuc2V0Sm9pbnMocGouam9pbnMoKSk7CiAgICAgICAgICAgIGFk\nZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgSm9pbiBqb2luOwogICAg\nICAgIGZvciAoSXRlcmF0b3IgaXRyID0gcGouam9pbnMoKS5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBqb2luID0gKEpvaW4p\nIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChqb2luLmdldFR5cGUoKSA9\nPSBKb2luLlRZUEVfSU5ORVIpIHsKICAgICAgICAgICAgICAgIGlmIChqb2lu\nLmdldEZvcmVpZ25LZXkoKSAhPSBudWxsCiAgICAgICAgICAgICAgICAgICAg\nJiYgIV9kaWN0LmNhbk91dGVySm9pbihfam9pblN5bnRheCwgam9pbi5nZXRG\nb3JlaWduS2V5KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgTG9nIGxvZyA9\nIF9jb25mLmdldExvZyhKREJDQ29uZmlndXJhdGlvbi5MT0dfSkRCQyk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuKF9sb2MuZ2V0KCJjYW50\nLW91dGVyLWZrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW4u\nZ2V0Rm9yZWlnbktleSgpKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAg\nICAgICAgICAgICAgICAgICBqb2luLnNldFR5cGUoSm9pbi5UWVBFX09VVEVS\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWRkKQogICAgICAg\nICAgICAgICAgX2pvaW5zLmpvaW5zKCkuYWRkKGpvaW4pOwogICAgICAgIH0K\nICAgICAgICBwai5udWxsSm9pbnMoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiB0aGUgYWxpYXMgZm9yIHRoZSBnaXZlbiB0YWJsZSB1bmRlciB0\naGUgZ2l2ZW4gam9pbnMuCiAgICAgKiBOT1RFOiBXRSBSRUxZIE9OIFRIRVNF\nIElOREVYRVMgQkVJTkcgTU9OT1RPTklDQUxMWSBJTkNSRUFTSU5HIEZST00g\nMAogICAgICovCiAgICBwcml2YXRlIGludCBnZXRUYWJsZUluZGV4KFRhYmxl\nIHRhYmxlLCBQYXRoSm9pbnMgcGosIGJvb2xlYW4gY3JlYXRlKSB7CiAgICAg\nICAgLy8gaWYgd2UgaGF2ZSBhIGZyb20gc2VsZWN0LCB0aGVuIHRoZXJlIGFy\nZSBubyB0YWJsZSBhbGlhc2VzCiAgICAgICAgaWYgKF9mcm9tICE9IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiAtMTsKCiAgICAgICAgSW50ZWdlciBpID0g\nbnVsbDsKICAgICAgICBPYmplY3Qga2V5ID0gdGFibGUuZ2V0RnVsbElkZW50\naWZpZXIoKS5nZXROYW1lKCk7CiAgICAgICAgaWYgKHBqICE9IG51bGwgJiYg\ncGoucGF0aCgpICE9IG51bGwpCiAgICAgICAgICAgIGtleSA9IG5ldyBLZXko\ncGoucGF0aCgpLnRvU3RyaW5nKCksIGtleSk7CgogICAgICAgIGlmIChfY3R4\nICE9IG51bGwgJiYgKF9wYXJlbnQgIT0gbnVsbCB8fCBfc3Vic2VscyAhPSBu\ndWxsIHx8IF9oYXNTdWIpKSB7CiAgICAgICAgICAgIGkgPSBmaW5kQWxpYXNG\nb3JRdWVyeSh0YWJsZSwgcGosIGtleSwgY3JlYXRlKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChpICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBpLmlu\ndFZhbHVlKCk7CgogICAgICAgIC8vIGNoZWNrIG91dCBleGlzdGluZyBhbGlh\nc2VzCiAgICAgICAgaSA9IGZpbmRBbGlhcyh0YWJsZSwga2V5KTsKCiAgICAg\nICAgaWYgKGkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGkuaW50VmFs\ndWUoKTsKICAgICAgICBpZiAoIWNyZWF0ZSkKICAgICAgICAgICAgcmV0dXJu\nIC0xOwoKICAgICAgICAvLyBub3QgZm91bmQ7IGNyZWF0ZSBhbGlhcwogICAg\nICAgIGkgPSBhbGlhc1NpemUobnVsbCk7Ci8vICAgICAgICBTeXN0ZW0ub3V0\nLnByaW50bG4oIkdldFRhYmxlSW5kZXhcdCIrCi8vICAgICAgICAgICAgICAg\nICgoX3BhcmVudCAhPSBudWxsKSA/ICJTdWIiIDoiIikgKwovLyAgICAgICAg\nICAgICAgICAiIGNyZWF0ZWQgYWxpYXM6ICIrCi8vICAgICAgICAgICAgICAg\nIGkuaW50VmFsdWUoKSsgIiAiKyBrZXkpOwogICAgICAgIHJlY29yZFRhYmxl\nQWxpYXModGFibGUsIGtleSwgaSk7CiAgICAgICAgcmV0dXJuIGkuaW50VmFs\ndWUoKTsKICAgIH0KCiAgICBwcml2YXRlIEludGVnZXIgZmluZEFsaWFzRm9y\nUXVlcnkoVGFibGUgdGFibGUsIFBhdGhKb2lucyBwaiwgT2JqZWN0IGtleSwK\nICAgICAgICBib29sZWFuIGNyZWF0ZSkgewogICAgICAgIEludGVnZXIgaSA9\nIG51bGw7CiAgICAgICAgU2VsZWN0SW1wbCBzZWwgPSB0aGlzOwogICAgICAg\nIFN0cmluZyBhbGlhcyA9IF9zY2hlbWFBbGlhczsKICAgICAgICBpZiAoaXNQ\nYXRoSW5UaGlzQ29udGV4dChwaikgfHwgdGFibGUuaXNBc3NvY2lhdGlvbigp\nKSAgICAgICAgICAKICAgICAgICAgICAgYWxpYXMgPSBudWxsOwoKICAgICAg\nICAvLyBmaW5kIHRoZSBjb250ZXh0IHdoZXJlIHRoaXMgYWxpYXMgaXMgZGVm\naW5lZAogICAgICAgIENvbnRleHQgY3R4ID0gKGFsaWFzICE9IG51bGwpID8K\nICAgICAgICAgICAgX2N0eC5maW5kQ29udGV4dChhbGlhcykgOiBudWxsOwog\nICAgICAgIGlmIChjdHggIT0gbnVsbCkKICAgICAgICAgICAgc2VsID0gKFNl\nbGVjdEltcGwpIGN0eC5nZXRTZWxlY3QoKTsKCiAgICAgICAgaWYgKCFjcmVh\ndGUpIAogICAgICAgICAgICBpID0gc2VsLmZpbmRBbGlhcyh0YWJsZSwga2V5\nKTsgIC8vIGZpbmQgaW4gcGFyZW50IGFuZCBpbiBteXNlbGYKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIGkgPSBzZWwuZ2V0QWxpYXModGFibGUsIGtleSk7\nIC8vIGZpbmQgaW4gbXlzZWxmCiAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgCiAgICAgICAgaWYgKGNyZWF0\nZSkgeyAvLyBjcmVhdGUgaGVyZQogICAgICAgICAgICBpID0gc2VsLmNyZWF0\nZUFsaWFzKHRhYmxlLCBrZXkpOwogICAgICAgIH0gZWxzZSBpZiAoY3R4ICE9\nIG51bGwgJiYgY3R4ICE9IGN0eCgpKSB7IC8vIGNyZWF0ZSBpbiBvdGhlciBz\nZWxlY3QKICAgICAgICAgICAgaSA9ICgoU2VsZWN0SW1wbCljdHguZ2V0U2Vs\nZWN0KCkpLmNyZWF0ZUFsaWFzKHRhYmxlLCBrZXkpOwogICAgICAgIH0KCiAg\nICAgICAgcmV0dXJuIGk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlz\nUGF0aEluVGhpc0NvbnRleHQoUGF0aEpvaW5zIHBqKSB7CiAgICAgICAgLy8g\nY3VyckN0eCBpcyBzZXQgZnJvbSBBY3Rpb24sIGl0IGlzIHJlc2V0IHRvIG51\nbGwgYWZ0ZXIgdGhlIFBDUGF0aCBpbml0aWFsaXphdGlvbgogICAgICAgIENv\nbnRleHQgY3VyckN0eCA9IHBqID09IG51bGwgPyBudWxsIDogKChQYXRoSm9p\nbnNJbXBsKXBqKS5jb250ZXh0OwogICAgICAgIAogICAgICAgIC8vIGxhc3RD\ndHggaXMgc2V0IHRvIGN1cnJDdHggYWZ0ZXIgdGhlIFNlbGVjdEpvaW5zLmpv\naW4uIHBqLmxhc3RDdHggYW5kIHBqLnBhdGggc3RyaW5nIGFyZSAKICAgICAg\nICAvLyB0aGUgbGFzdCBzbmFwc2hvdCBvZiBwai4gVGhleSB3aWxsIGJlIHVz\nZWQgdG9nZXRoZXIgZm9yIGxhdGVyIHRhYmxlIGFsaWFzIHJlc29sdXRpb24g\naW4KICAgICAgICAvLyB0aGUgZ2V0Q29sdW1uQWxpYXMoKS4gCiAgICAgICAg\nQ29udGV4dCBsYXN0Q3R4ID0gcGogPT0gbnVsbCA/IG51bGwgOiAoKFBhdGhK\nb2luc0ltcGwpcGopLmxhc3RDb250ZXh0OwogICAgICAgIENvbnRleHQgdGhp\nc0N0eCA9IGN1cnJDdHggPT0gbnVsbCA/IGxhc3RDdHggOiBjdXJyQ3R4Owog\nICAgICAgIFN0cmluZyBjb3JyVmFyID0gcGogPT0gbnVsbCA/IG51bGwgOiBw\nai5nZXRDb3JyZWxhdGVkVmFyaWFibGUoKTsKICAgICAgICAKICAgICAgICBy\nZXR1cm4gKHBqICE9IG51bGwgJiYgcGoucGF0aCgpICE9IG51bGwgJiYgCiAg\nICAgICAgICAgIChjb3JyVmFyID09IG51bGwgfHwgKHRoaXNDdHggIT0gbnVs\nbCAmJiBjdHgoKSA9PSB0aGlzQ3R4KSkpOwogICAgfQogCiAgICBwcml2YXRl\nIEludGVnZXIgZ2V0QWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXkpIHsK\nICAgICAgICBJbnRlZ2VyIGFsaWFzID0gbnVsbDsKICAgICAgICBpZiAoX2Fs\naWFzZXMgIT0gbnVsbCkKICAgICAgICAgICAgYWxpYXMgPSAoSW50ZWdlcikg\nX2FsaWFzZXMuZ2V0KGtleSk7CiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAg\nfQoKICAgIHByaXZhdGUgaW50IGNyZWF0ZUFsaWFzKFRhYmxlIHRhYmxlLCBP\nYmplY3Qga2V5KSB7CiAgICAgICAgSW50ZWdlciBpID0gY3R4KCkubmV4dEFs\naWFzKCk7Ci8vICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlx0IisKLy8g\nICAgICAgICAgICAgICAgKChfcGFyZW50ICE9IG51bGwpID8gIlN1YiIgOiIi\nKSArCi8vICAgICAgICAgICAgICAgICJRdWVyeSBjcmVhdGVkIGFsaWFzOiAi\nKyAKLy8gICAgICAgICAgICAgICAgaS5pbnRWYWx1ZSgpKyAiICIrIGtleSk7\nCiAgICAgICAgcmVjb3JkVGFibGVBbGlhcyh0YWJsZSwga2V5LCBpKTsKICAg\nICAgICByZXR1cm4gaS5pbnRWYWx1ZSgpOwogICAgfQoKICAgIHByaXZhdGUg\nSW50ZWdlciBmaW5kQWxpYXMoVGFibGUgdGFibGUsIE9iamVjdCBrZXkpIHsK\nICAgICAgICBJbnRlZ2VyIGFsaWFzID0gbnVsbDsKICAgICAgICBpZiAoX2Fs\naWFzZXMgIT0gbnVsbCkgewogICAgICAgICAgICBhbGlhcyA9IChJbnRlZ2Vy\nKSBfYWxpYXNlcy5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKGFsaWFzICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhbGlhczsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX3BhcmVudCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGFsaWFzID0gX3BhcmVudC5maW5kQWxpYXModGFi\nbGUsIGtleSk7CiAgICAgICAgICAgIGlmIChhbGlhcyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gYWxpYXM7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgfQoKICAgIC8qKgog\nICAgICogUmVjb3JkIHRoZSBtYXBwaW5nIG9mIHRoZSBnaXZlbiBrZXkgdG8g\ndGhlIGdpdmVuIGFsaWFzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVj\nb3JkVGFibGVBbGlhcyhUYWJsZSB0YWJsZSwgT2JqZWN0IGtleSwgSW50ZWdl\nciBhbGlhcykgewogICAgICAgIGlmIChfYWxpYXNlcyA9PSBudWxsKQogICAg\nICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2Fs\naWFzZXMucHV0KGtleSwgYWxpYXMpOwoKICAgICAgICBTdHJpbmcgdGFibGVT\ndHJpbmcgPSBfZGljdC5nZXRGdWxsTmFtZSh0YWJsZSwgZmFsc2UpICsgIiAi\nCiAgICAgICAgICAgICsgdG9BbGlhcyhhbGlhcy5pbnRWYWx1ZSgpKTsKICAg\nICAgICBpZiAoX3RhYmxlcyA9PSBudWxsKQogICAgICAgICAgICBfdGFibGVz\nID0gbmV3IFRyZWVNYXAoKTsKICAgICAgICBfdGFibGVzLnB1dChhbGlhcywg\ndGFibGVTdHJpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRl\nIHRvdGFsIG51bWJlciBvZiBhbGlhc2VzLgogICAgICovCiAgICBwcml2YXRl\nIGludCBhbGlhc1NpemUoU2VsZWN0SW1wbCBmcm9tU3ViKSB7CiAgICAgICAg\naW50IGFsaWFzZXMgPSAoX3BhcmVudCA9PSBudWxsKSA/IDAKICAgICAgICAg\nICAgOiBfcGFyZW50LmFsaWFzU2l6ZSh0aGlzKTsKICAgICAgICBhbGlhc2Vz\nICs9IChfYWxpYXNlcyA9PSBudWxsKSA/IDAgOiBfYWxpYXNlcy5zaXplKCk7\nCiAgICAgICAgaWYgKF9zdWJzZWxzICE9IG51bGwpIHsKICAgICAgICAgICAg\nU2VsZWN0SW1wbCBzdWI7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgX3N1YnNlbHMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHN1\nYiA9IChTZWxlY3RJbXBsKSBfc3Vic2Vscy5nZXQoaSk7CiAgICAgICAgICAg\nICAgICBpZiAoc3ViICE9IGZyb21TdWIpCiAgICAgICAgICAgICAgICAgICAg\nYWxpYXNlcyArPSBzdWIuYWxpYXNTaXplKG51bGwpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBhbGlhc2VzOwogICAgfQogICAg\nCiAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVy\nbiB0b1NlbGVjdChmYWxzZSwgbnVsbCkuZ2V0U1FMKCk7CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUGF0aEpvaW5z\nIGltcGxlbWVudGF0aW9uCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vCgogICAgcHVibGljIGJvb2xlYW4gaXNPdXRlcigpIHsKICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIFBhdGhKb2lucyBzZXRP\ndXRlcihib29sZWFuIG91dGVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxl\nY3RKb2lucyh0aGlzKS5zZXRPdXRlcih0cnVlKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nQnVpbGRlciBwYXRoKCkgewogICAg\nICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBKb2luU2V0IGpv\naW5zKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgIHJldHVybiB0cnVlOwog\nICAgfQoKICAgIHB1YmxpYyBKb2lucyBjcm9zc0pvaW4oVGFibGUgbG9jYWxU\nYWJsZSwgVGFibGUgZm9yZWlnblRhYmxlKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBTZWxlY3RKb2lucyh0aGlzKS5jcm9zc0pvaW4obG9jYWxUYWJsZSwgZm9y\nZWlnblRhYmxlKTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgam9pbihGb3Jl\naWduS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5qb2luKGZr\nLCBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBv\ndXRlckpvaW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29s\nZWFuIHRvTWFueSkgewogICAgICAgIHJldHVybiBuZXcgU2VsZWN0Sm9pbnMo\ndGhpcykub3V0ZXJKb2luKGZrLCBpbnZlcnNlLCB0b01hbnkpOwogICAgfQoK\nICAgIHB1YmxpYyBKb2lucyBqb2luUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZv\ncmVpZ25LZXkgZmssIENsYXNzTWFwcGluZyB0YXJnZXQsCiAgICAgICAgaW50\nIHN1YnMsIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAg\nICAgICByZXR1cm4gbmV3IFNlbGVjdEpvaW5zKHRoaXMpLmpvaW5SZWxhdGlv\nbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJz\nZSwgdG9NYW55KTsKICAgIH0KCiAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2lu\nUmVsYXRpb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssIAogICAgICAg\nIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVy\nc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxl\nY3RKb2lucyh0aGlzKS5vdXRlckpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFy\nZ2V0LCBzdWJzLCAKICAgICAgICAgICAgaW52ZXJzZSwgdG9NYW55KTsKICAg\nIH0KCiAgICBwdWJsaWMgSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikg\newogICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RKb2lucyh0aGlzKS5z\nZXRWYXJpYWJsZSh2YXIpOwogICAgfQoKICAgIHB1YmxpYyBKb2lucyBzZXRT\ndWJzZWxlY3QoU3RyaW5nIGFsaWFzKSB7CiAgICAgICAgaWYgKGFsaWFzID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVy\nbiBuZXcgU2VsZWN0Sm9pbnModGhpcykuc2V0U3Vic2VsZWN0KGFsaWFzKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSBTUUwgc3RyaW5n\nIHNlbGVjdGVkIHdpdGggbnVsbCBpZC4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgTnVsbElkIHsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ncHJlc2VudHMgYSBwbGFjZWhvbGRlciBTUUwgc3RyaW5nLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBQbGFjZWhvbGRlciB7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBTZWxlY3RJbXBsIGNsb25lKENvbnRleHQgY3R4KSB7\nCiAgICAgICAgU2VsZWN0SW1wbCBzZWwgPSAoU2VsZWN0SW1wbCkgX2NvbmYu\nZ2V0U1FMRmFjdG9yeUluc3RhbmNlKCkubmV3U2VsZWN0KCk7CiAgICAgICAg\nc2VsLl9jdHggPSBjdHg7CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCAm\nJiBfcGFyZW50LmN0eCgpICE9IG51bGwpCiAgICAgICAgICAgIHNlbC5fcGFy\nZW50ID0gKFNlbGVjdEltcGwpX3BhcmVudC5jdHgoKS5nZXRTZWxlY3QoKTsK\nICAgICAgICBzZWwuX3NjaGVtYUFsaWFzID0gX3NjaGVtYUFsaWFzOwogICAg\nICAgIHNlbC5fZmxhZ3MgPSBfZmxhZ3M7CiAgICAgICAgcmV0dXJuIHNlbDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEtleSB0eXBlIHVzZWQgZm9yIGFsaWFz\nZXMuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEtleSB7Cgog\nICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIF9wYXRoOwogICAgICAgIHBy\naXZhdGUgZmluYWwgT2JqZWN0IF9rZXk7CgogICAgICAgIHB1YmxpYyBLZXko\nU3RyaW5nIHBhdGgsIE9iamVjdCBrZXkpIHsKICAgICAgICAgICAgX3BhdGgg\nPSBwYXRoOwogICAgICAgICAgICBfa2V5ID0ga2V5OwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9wYXRoLmhhc2hDb2RlKCkgXiBfa2V5Lmhhc2hDb2RlKCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90\naGVyKSB7CiAgICAgICAgICAgIGlmIChvdGhlciA9PSB0aGlzKQogICAgICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChvdGhlci5n\nZXRDbGFzcygpICE9IGdldENsYXNzKCkpCiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIEtleSBrID0gKEtleSkgb3RoZXI7CiAg\nICAgICAgICAgIHJldHVybiBrLl9wYXRoLmVxdWFscyhfcGF0aCkgJiYgay5f\na2V5LmVxdWFscyhfa2V5KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiBfcGF0aCAr\nICJ8IiArIF9rZXk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIE9iamVj\ndCBnZXRLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBfa2V5OwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEge0BsaW5rIFJlc3VsdH0gaW1w\nbGVtZW50YXRpb24gd3JhcHBlZCBhcm91bmQgdGhpcyBzZWxlY3QuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgU2VsZWN0UmVzdWx0CiAgICAg\nICAgZXh0ZW5kcyBSZXN1bHRTZXRSZXN1bHQKICAgICAgICBpbXBsZW1lbnRz\nIFBhdGhKb2lucyB7CgogICAgICAgIHByaXZhdGUgU2VsZWN0SW1wbCBfc2Vs\nID0gbnVsbDsKCiAgICAgICAgLy8gcG9zaXRpb24gaW4gc2VsZWN0ZWQgY29s\ndW1ucyBsaXN0IHdoZXJlIHdlIGV4cGVjdCB0aGUgbmV4dCBsb2FkCiAgICAg\nICAgcHJpdmF0ZSBpbnQgX3BvcyA9IDA7CiAgICAgICAgcHJpdmF0ZSBTdGFj\nayBfcHJlSm9pbnMgPSBudWxsOwoKICAgICAgICAvKioKICAgICAgICAgKiBD\nb25zdHJ1Y3Rvci4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgU2VsZWN0\nUmVzdWx0KENvbm5lY3Rpb24gY29ubiwgU3RhdGVtZW50IHN0bW50LCBSZXN1\nbHRTZXQgcnMsCiAgICAgICAgICAgIERCRGljdGlvbmFyeSBkaWN0KSB7CiAg\nICAgICAgICAgIHN1cGVyKGNvbm4sIHN0bW50LCBycywgZGljdCk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9yIHRoaXMg\ncmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBTZWxlY3RJbXBs\nIGdldFNlbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9zZWw7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZWxlY3QgZm9yIHRoaXMg\ncmVzdWx0LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldFNl\nbGVjdChTZWxlY3RJbXBsIHNlbCkgewogICAgICAgICAgICBfc2VsID0gc2Vs\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRFYWdlcihG\naWVsZE1hcHBpbmcga2V5KSB7CiAgICAgICAgICAgIC8vIGRvbid0IGJvdGhl\nciBjcmVhdGluZyBrZXkgaWYgd2Uga25vdyB3ZSBkb24ndCBoYXZlIGFueQog\nICAgICAgICAgICAvLyBlYWdlciByZXN1bHRzCiAgICAgICAgICAgIGlmIChf\nc2VsLl9lYWdlciA9PSBudWxsIHx8ICFfc2VsLl9lYWdlcktleXMuY29udGFp\nbnMoa2V5KSkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nICAgICBNYXAgbWFwID0gU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAo\ndHJ1ZSk7CiAgICAgICAgICAgIGlmIChtYXAgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gbWFwLmdl\ndChfc2VsLnRvRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSkpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcHV0RWFnZXIoRmllbGRNYXBw\naW5nIGtleSwgT2JqZWN0IHJlcykgewogICAgICAgICAgICBNYXAgbWFwID0g\nU2VsZWN0UmVzdWx0LnRoaXMuZ2V0RWFnZXJNYXAodHJ1ZSk7CiAgICAgICAg\nICAgIGlmIChtYXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbWFwID0g\nbmV3IEhhc2hNYXAoKTsKICAgICAgICAgICAgICAgIHNldEVhZ2VyTWFwKG1h\ncCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFwLnB1dChfc2VsLnRv\nRWFnZXJLZXkoa2V5LCBnZXRKb2lucyhudWxsKSksIHJlcyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGxvYWQoQ2xhc3NNYXBwaW5nIG1h\ncHBpbmcsIEpEQkNTdG9yZSBzdG9yZSwKICAgICAgICAgICAgSkRCQ0ZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgSm9pbnMgam9pbnMpCiAgICAgICAgICAg\nIHRocm93cyBTUUxFeGNlcHRpb24gewogICAgICAgICAgICBib29sZWFuIGhh\nc0pvaW5zID0gam9pbnMgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgKChQ\nYXRoSm9pbnMpIGpvaW5zKS5wYXRoKCkgIT0gbnVsbDsKICAgICAgICAgICAg\naWYgKGhhc0pvaW5zKSB7CiAgICAgICAgICAgICAgICBpZiAoX3ByZUpvaW5z\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgX3ByZUpvaW5zID0gbmV3\nIFN0YWNrKCk7CiAgICAgICAgICAgICAgICBfcHJlSm9pbnMucHVzaChqb2lu\ncyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9iamVjdCBvYmogPSBz\ndXBlci5sb2FkKG1hcHBpbmcsIHN0b3JlLCBmZXRjaCwgam9pbnMpOwoKICAg\nICAgICAgICAgLy8gcmVzZXQKICAgICAgICAgICAgaWYgKGhhc0pvaW5zKQog\nICAgICAgICAgICAgICAgX3ByZUpvaW5zLnBvcCgpOwogICAgICAgICAgICBy\nZXR1cm4gb2JqOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG5l\nd0pvaW5zKCkgewogICAgICAgICAgICBQYXRoSm9pbnMgcHJlID0gZ2V0UHJl\nSm9pbnMoKTsKICAgICAgICAgICAgaWYgKHByZSA9PSBudWxsIHx8IHByZS5w\nYXRoKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwoK\nICAgICAgICAgICAgUGF0aEpvaW5zSW1wbCBwaiA9IG5ldyBQYXRoSm9pbnNJ\nbXBsKCk7CiAgICAgICAgICAgIHBqLnBhdGggPSBuZXcgU3RyaW5nQnVpbGRl\ncihwcmUucGF0aCgpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICByZXR1cm4g\ncGo7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBjb250\nYWluc0ludGVybmFsKE9iamVjdCBvYmosIEpvaW5zIGpvaW5zKSB7CiAgICAg\nICAgICAgIC8vIHdlIGtleSBkaXJlY3RseSBvbiBvYmpzIGFuZCBqb2luLWxl\nc3MgY29scywgb3Igb24gdGhlIGFsaWFzCiAgICAgICAgICAgIC8vIGZvciBj\nb2xzIHdpdGggam9pbnMKICAgICAgICAgICAgUGF0aEpvaW5zIHBqID0gZ2V0\nSm9pbnMoam9pbnMpOwogICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBw\nai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIG9iaiA9IGdldENv\nbHVtbkFsaWFzKChDb2x1bW4pIG9iaiwgcGopOwogICAgICAgICAgICByZXR1\ncm4gb2JqICE9IG51bGwgJiYgX3NlbC5fc2VsZWN0cy5jb250YWlucyhvYmop\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gY29udGFp\nbnNBbGxJbnRlcm5hbChPYmplY3RbXSBvYmpzLCBKb2lucyBqb2lucykKICAg\nICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIFBh\ndGhKb2lucyBwaiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAgT2Jq\nZWN0IG9iajsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBvYmpz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocGogIT0gbnVs\nbCAmJiBwai5wYXRoKCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBv\nYmogPSBnZXRDb2x1bW5BbGlhcygoQ29sdW1uKSBvYmpzW2ldLCBwaik7CiAg\nICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgb2JqID0g\nb2Jqc1tpXTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCB8fCAh\nX3NlbC5fc2VsZWN0cy5jb250YWlucyhvYmopKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHB1\nc2hCYWNrKCkKICAgICAgICAgICAgdGhyb3dzIFNRTEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIF9wb3MgPSAwOwogICAgICAgICAgICBzdXBlci5wdXNoQmFj\naygpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gYWJz\nb2x1dGVJbnRlcm5hbChpbnQgcm93KQogICAgICAgICAgICB0aHJvd3MgU1FM\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IDA7CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5hYnNvbHV0ZUludGVybmFsKHJvdyk7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgYm9vbGVhbiBuZXh0SW50ZXJuYWwoKQog\nICAgICAgICAgICB0aHJvd3MgU1FMRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nX3BvcyA9IDA7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5uZXh0SW50ZXJu\nYWwoKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBpbnQgZmluZE9i\namVjdChPYmplY3Qgb2JqLCBKb2lucyBqb2lucykKICAgICAgICAgICAgdGhy\nb3dzIFNRTEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChfcG9zID09IF9z\nZWwuX3NlbGVjdHMuc2l6ZSgpKQogICAgICAgICAgICAgICAgX3BvcyA9IDA7\nCgogICAgICAgICAgICAvLyB3ZSBrZXkgZGlyZWN0bHkgb24gb2JqcyBhbmQg\nam9pbi1sZXNzIGNvbHMsIG9yIG9uIHRoZSBhbGlhcwogICAgICAgICAgICAv\nLyBmb3IgY29scyB3aXRoIGpvaW5zCiAgICAgICAgICAgIFBhdGhKb2lucyBw\naiA9IGdldEpvaW5zKGpvaW5zKTsKICAgICAgICAgICAgQm9vbGVhbiBwayA9\nIG51bGw7CiAgICAgICAgICAgIGlmIChwaiAhPSBudWxsICYmIHBqLnBhdGgo\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBDb2x1bW4gY29sID0gKENv\nbHVtbikgb2JqOwogICAgICAgICAgICAgICAgcGsgPSAoY29sLmlzUHJpbWFy\neUtleSgpKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAgICAg\nICAgICAgICAgICBvYmogPSBnZXRDb2x1bW5BbGlhcyhjb2wsIHBqKTsKICAg\nICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU1FMRXhjZXB0aW9uKGNvbC5nZXRUYWJsZSgpICsg\nIjogIgogICAgICAgICAgICAgICAgICAgICAgICArIHBqLnBhdGgoKSArICIg\nKCIgKyBfc2VsLl9hbGlhc2VzICsgIikiKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gd2UgbG9hZCBpbiB0aGUgc2FtZSBvcmRlciB3ZSBzZWxl\nY3QsIG1vcmUgb3IgbGVzcy4uLgogICAgICAgICAgICBpZiAoX3NlbC5fc2Vs\nZWN0cy5nZXQoX3BvcykuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gKytfcG9zOwoKICAgICAgICAgICAgLy8gaWYgd2UncmUgbG9va2lu\nZyBmb3IgYSBwcmltYXJ5IGtleSwgdHJ5IGJhY2sgYSBjb3VwbGUgcGxhY2Vz\nLAogICAgICAgICAgICAvLyBzaW5jZSBwa3MgbWlnaHQgYmUgc2VsZWN0ZWQg\naW4gYSBzbGlnaHRseSBkaWZmZXJlbnQgb3JkZXIgdGhhbgogICAgICAgICAg\nICAvLyB0aGV5IGFyZSBsb2FkZWQgYmFjazsgZG9uJ3QgY2hhbmdlIHRoZSBt\nYXJrZXIgcG9zaXRpb24KICAgICAgICAgICAgaWYgKHBrID09IG51bGwpCiAg\nICAgICAgICAgICAgICBwayA9IChvYmogaW5zdGFuY2VvZiBDb2x1bW4gJiYg\nKChDb2x1bW4pIG9iaikuaXNQcmltYXJ5S2V5KCkpCiAgICAgICAgICAgICAg\nICAgICAgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNFOwogICAgICAg\nICAgICBpZiAocGsuYm9vbGVhblZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSBfcG9zIC0gMTsgaSA+PSAwICYmIGkgPj0gX3BvcyAt\nIDM7IGktLSkKICAgICAgICAgICAgICAgICAgICBpZiAoX3NlbC5fc2VsZWN0\ncy5nZXQoaSkuZXF1YWxzKG9iaikpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBpICsgMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nc2VhcmNoIGZvcndhcmQgb24gdGhlIGFzc3VtcHRpb24gdGhhdCB3ZSBtaWdo\ndCBiZSBza2lwcGluZwogICAgICAgICAgICAvLyBzZWxlY3RzIGZvciBzaWJs\naW5nIGNsYXNzZXM7IGFkdmFuY2UgdGhlIHBvc2l0aW9uIGlmIHdlIGZpbmQK\nICAgICAgICAgICAgLy8gc29tZXRoaW5nIGZvcndhcmQKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IF9wb3MgKyAxOyBpIDwgX3NlbC5fc2VsZWN0cy5zaXpl\nKCk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9zZWwuX3NlbGVjdHMu\nZ2V0KGkpLmVxdWFscyhvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgX3Bv\ncyA9IGk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICsrX3BvczsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbWF5YmUgdGhlIGNvbHVtbiB3YXMgc2VsZWN0ZWQgYnkgMiBkaWZmZXJlbnQg\nbWFwcGluZ3MsIHNvIGl0J3MKICAgICAgICAgICAgLy8gc29tZXdoZXJlIHBy\naW9yIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uOyBpbiB0aGlzIGNhc2UgbGVh\ndmUgdGhlCiAgICAgICAgICAgIC8vIHBvc2l0aW9uIG1hcmtlciBhdCBpdHMg\nY3VycmVudCBwbGFjZSBjYXVzZSBzdWJzZXF1ZW50IGxvYWRzIHdpbGwKICAg\nICAgICAgICAgLy8gc3RpbGwgcHJvYmFibHkgc3RhcnQgZnJvbSB0aGVyZQog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9wb3M7IGkrKykKICAg\nICAgICAgICAgICAgIGlmIChfc2VsLl9zZWxlY3RzLmdldChpKS5lcXVhbHMo\nb2JqKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSArIDE7CgogICAg\nICAgICAgICAvLyBzb21ldGhpbmdzJ3Mgd3JvbmcuLi4KICAgICAgICAgICAg\ndGhyb3cgbmV3IFNRTEV4Y2VwdGlvbihvYmoudG9TdHJpbmcoKSk7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIGpvaW5z\nIHRvIHVzZSB0byBmaW5kIGNvbHVtbiBkYXRhLgogICAgICAgICAqLwogICAg\nICAgIHByaXZhdGUgUGF0aEpvaW5zIGdldEpvaW5zKEpvaW5zIGpvaW5zKSB7\nCiAgICAgICAgICAgIFBhdGhKb2lucyBwaiA9IChQYXRoSm9pbnMpIGpvaW5z\nOwogICAgICAgICAgICBpZiAocGogIT0gbnVsbCAmJiBwai5wYXRoKCkgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBwajsKICAgICAgICAgICAg\ncmV0dXJuIGdldFByZUpvaW5zKCk7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBSZXR1cm4gdGhlIHByZSBqb2lucyBmb3IgdGhlIHJlc3Vs\ndCwgb3IgbnVsbCBpZiBub25lLiBOb3RlIHRoYXQKICAgICAgICAgKiB3ZSBo\nYXZlIHRvIHRha2UgdGhlIFNlbGVjdCdzIHByZSBqb2lucyBpbnRvIGFjY291\nbnQgdG9vLCBzaW5jZQogICAgICAgICAqIGJhdGNoZWQgc2VsZWN0cyBjYW4g\naGF2ZSBhZGRpdGlvbmFsIHByZSBqb2lucyBvbiB0aGUgc3RhY2sgZXZlbgog\nICAgICAgICAqIG9uIGV4ZWN1dGlvbi4KICAgICAgICAgKi8KICAgICAgICBw\ncml2YXRlIFBhdGhKb2lucyBnZXRQcmVKb2lucygpIHsKICAgICAgICAgICAg\naWYgKF9wcmVKb2lucyAhPSBudWxsICYmICFfcHJlSm9pbnMuaXNFbXB0eSgp\nKQogICAgICAgICAgICAgICAgcmV0dXJuIChQYXRoSm9pbnMpIF9wcmVKb2lu\ncy5wZWVrKCk7CiAgICAgICAgICAgIGlmIChfc2VsLl9wcmVKb2lucyAhPSBu\ndWxsICYmICFfc2VsLl9wcmVKb2lucy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nICAgICByZXR1cm4gKFBhdGhKb2lucykgX3NlbC5fcHJlSm9pbnMucGVlaygp\nOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIC8qKgogICAgICAgICAqIFJldHVybiB0aGUgYWxpYXMgdXNlZCB0byBrZXkg\nb24gdGhlIGNvbHVtbiBkYXRhLCBjb25zaWRlcmluZyB0aGUKICAgICAgICAg\nKiBnaXZlbiBqb2lucy4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIFN0\ncmluZyBnZXRDb2x1bW5BbGlhcyhDb2x1bW4gY29sLCBQYXRoSm9pbnMgcGop\nIHsKICAgICAgICAgICAgU3RyaW5nIGFsaWFzOwogICAgICAgICAgICBpZiAo\nX3NlbC5fZnJvbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBhbGlhcyA9\nIF9zZWwudG9BbGlhcyhfc2VsLl9mcm9tLmdldFRhYmxlSW5kZXgKICAgICAg\nICAgICAgICAgICAgICAoY29sLmdldFRhYmxlKCksIHBqLCBmYWxzZSkpOwog\nICAgICAgICAgICAgICAgaWYgKGFsaWFzID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBpZiAoX3Nl\nbC5fZGljdC5yZXF1aXJlc0FsaWFzRm9yU3Vic2VsZWN0KQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBGUk9NX1NFTEVDVF9BTElBUyArICIuIiArIGFs\naWFzICsgIl8iICsgY29sOwogICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFz\nICsgIl8iICsgY29sOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsaWFz\nID0gX3NlbC50b0FsaWFzKF9zZWwuZ2V0VGFibGVJbmRleChjb2wuZ2V0VGFi\nbGUoKSwgcGosIGZhbHNlKSk7CiAgICAgICAgICAgIHJldHVybiAoYWxpYXMg\nPT0gbnVsbCkgPyBudWxsIDogYWxpYXMgKyAiLiIgKyBjb2w7CiAgICAgICAg\nfQoKICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAg\nICAgLy8gUGF0aEpvaW5zIGltcGxlbWVudGF0aW9uCiAgICAgICAgLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBpc091dGVyKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xl\nYW4gb3V0ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nQnVpbGRlciBwYXRoKCkgewogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCkg\newogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBpbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICByZXR1cm4g\nMDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygp\nIHsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRW1wdHko\nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRhYmxlLCBU\nYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgam9pbihGb3JlaWdu\nS2V5IGZrLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIG91dGVySm9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGlu\ndmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpvaW5SZWxh\ndGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktleSBmaywgCiAgICAgICAgICAg\nIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVy\nc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nUGF0aEpvaW5zSW1wbCgpLmpvaW5SZWxhdGlvbihuYW1lLCBmaywgdGFyZ2V0\nLCBzdWJzLCAKICAgICAgICAgICAgICAgIGludmVyc2UsIHRvTWFueSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luUmVsYXRp\nb24oU3RyaW5nIG5hbWUsIEZvcmVpZ25LZXkgZmssCiAgICAgICAgICAgIENs\nYXNzTWFwcGluZyB0YXJnZXQsIGludCBzdWJzLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUGF0\naEpvaW5zSW1wbCgpLm91dGVySm9pblJlbGF0aW9uKG5hbWUsIGZrLCB0YXJn\nZXQsIHN1YnMsCiAgICAgICAgICAgICAgICBpbnZlcnNlLCB0b01hbnkpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldFZhcmlhYmxlKFN0\ncmluZyB2YXIpIHsKICAgICAgICAgICAgaWYgKHZhciA9PSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgUGF0aEpvaW5zSW1wbCgpLnNldFZhcmlhYmxlKHZhcik7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmluZyBh\nbGlhcykgewogICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICByZXR1cm4gbmV3\nIFBhdGhKb2luc0ltcGwoKS5zZXRTdWJzZWxlY3QoYWxpYXMpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldENvcnJlbGF0ZWRWYXJpYWJs\nZShTdHJpbmcgdmFyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldEpvaW5Db250ZXh0KENv\nbnRleHQgY3R4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRDb3JyZWxhdGVkVmFyaWFi\nbGUoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgbW92ZUpvaW5zVG9QYXJlbnQoKSB7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQmFzZSBqb2lucyBpbXBsZW1l\nbnRhdGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUGF0\naEpvaW5zSW1wbAogICAgICAgIGltcGxlbWVudHMgUGF0aEpvaW5zIHsKCiAg\nICAgICAgcHJvdGVjdGVkIFN0cmluZ0J1aWxkZXIgcGF0aCA9IG51bGw7CiAg\nICAgICAgcHJvdGVjdGVkIFN0cmluZyB2YXIgPSBudWxsOwogICAgICAgIHBy\nb3RlY3RlZCBTdHJpbmcgY29ycmVsYXRlZFZhciA9IG51bGw7CiAgICAgICAg\ncHJvdGVjdGVkIENvbnRleHQgY29udGV4dCA9IG51bGw7CiAgICAgICAgcHJv\ndGVjdGVkIENvbnRleHQgbGFzdENvbnRleHQgPSBudWxsOwoKICAgICAgICBw\ndWJsaWMgU2VsZWN0IGdldFNlbGVjdCgpIHsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc091\ndGVyKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0\nZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBpc0RpcnR5KCkgewogICAgICAgICAgICBy\nZXR1cm4gdmFyICE9IG51bGwgfHwgcGF0aCAhPSBudWxsOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFN0cmluZ0J1aWxkZXIgcGF0aCgpIHsKICAgICAg\nICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pblNldCBqb2lucygpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGpvaW5Db3VudCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBudWxsSm9pbnMoKSB7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nSm9pbnMgc2V0VmFyaWFibGUoU3RyaW5nIHZhcikgewogICAgICAgICAgICB0\naGlzLnZhciA9IHZhcjsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFZhcmlhYmxlKCkgewog\nICAgICAgICAgICByZXR1cm4gdmFyOwogICAgICAgIH0KICAgICAgICAKICAg\nICAgICBwdWJsaWMgSm9pbnMgc2V0Q29ycmVsYXRlZFZhcmlhYmxlKFN0cmlu\nZyB2YXIpIHsKICAgICAgICAgICAgdGhpcy5jb3JyZWxhdGVkVmFyID0gdmFy\nOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRDb3JyZWxhdGVkVmFyaWFibGUo\nKSB7CiAgICAgICAgICAgIHJldHVybiBjb3JyZWxhdGVkVmFyOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEpvaW5zIHNldEpvaW5Db250ZXh0KENvbnRl\neHQgY29udGV4dCkgewogICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250\nZXh0OwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgSm9pbnMgc2V0U3Vic2VsZWN0KFN0cmluZyBhbGlhcykg\newogICAgICAgICAgICBhcHBlbmQoYWxpYXMpOwogICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRh\nYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgYXBwZW5k\nKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIGpv\naW4oRm9yZWlnbktleSBmaywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRv\nTWFueSkgewogICAgICAgICAgICBhcHBlbmQodmFyKTsKICAgICAgICAgICAg\ndmFyID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVpZ25LZXkg\nZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsKICAgICAg\nICAgICAgYXBwZW5kKHZhcik7CiAgICAgICAgICAgIHZhciA9IG51bGw7CiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktl\neSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBz\ndWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAg\nICAgICAgIGFwcGVuZChuYW1lKTsKICAgICAgICAgICAgYXBwZW5kKHZhcik7\nCiAgICAgICAgICAgIHZhciA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5zIG91dGVySm9p\nblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZrLAogICAgICAg\nICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBpbnQgc3VicywgYm9vbGVhbiBp\nbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewogICAgICAgICAgICBhcHBlbmQo\nbmFtZSk7CiAgICAgICAgICAgIGFwcGVuZCh2YXIpOwogICAgICAgICAgICB2\nYXIgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCB2b2lkIGFwcGVuZChTdHJpbmcgc3RyKSB7\nCiAgICAgICAgICAgIGlmIChzdHIgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKHBhdGggPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwYXRo\nID0gbmV3IFN0cmluZ0J1aWxkZXIoc3RyKTsKICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICBwYXRoLmFwcGVuZCgnLicpLmFwcGVu\nZChzdHIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gIlBh\ndGhKb2luc0ltcGw8IiArIGhhc2hDb2RlKCkgKyAiPjogIgogICAgICAgICAg\nICAgICAgKyBTdHJpbmcudmFsdWVPZihwYXRoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIG1vdmVKb2luc1RvUGFyZW50KCkgewogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEpvaW5zIGltcGxlbWVudGF0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTZWxlY3RKb2lu\ncwogICAgICAgIGV4dGVuZHMgUGF0aEpvaW5zSW1wbCAKICAgICAgICBpbXBs\nZW1lbnRzIENsb25lYWJsZSB7CgogICAgICAgIHByaXZhdGUgZmluYWwgU2Vs\nZWN0SW1wbCBfc2VsOwogICAgICAgIHByaXZhdGUgSm9pblNldCBfam9pbnMg\nPSBudWxsOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBfb3V0ZXIgPSBmYWxz\nZTsKICAgICAgICBwcml2YXRlIGludCBfY291bnQgPSAwOwoKICAgICAgICBw\ndWJsaWMgU2VsZWN0Sm9pbnMoU2VsZWN0SW1wbCBzZWwpIHsKICAgICAgICAg\nICAgX3NlbCA9IHNlbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTZWxl\nY3QgZ2V0U2VsZWN0KCkgewogICAgICAgICAgICByZXR1cm4gX3NlbDsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzT3V0ZXIoKSB7CiAg\nICAgICAgICAgIHJldHVybiBfb3V0ZXI7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpIHsKICAg\nICAgICAgICAgX291dGVyID0gb3V0ZXI7CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNEaXJ0\neSgpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmlzRGlydHkoKSB8fCAh\naXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEpvaW5TZXQg\nam9pbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBfam9pbnM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXRKb2lucyhKb2luU2V0IGpvaW5z\nKSB7CiAgICAgICAgICAgIF9qb2lucyA9IGpvaW5zOwogICAgICAgICAgICBf\nb3V0ZXIgPSBqb2lucyAhPSBudWxsICYmIGpvaW5zLmxhc3QoKSAhPSBudWxs\nCiAgICAgICAgICAgICAgICAmJiBqb2lucy5sYXN0KCkuZ2V0VHlwZSgpID09\nIEpvaW4uVFlQRV9PVVRFUjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBp\nbnQgam9pbkNvdW50KCkgewogICAgICAgICAgICBpZiAoX2pvaW5zID09IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvdW50OwogICAgICAgICAg\nICByZXR1cm4gTWF0aC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgpKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpIHsKICAg\nICAgICAgICAgaWYgKF9qb2lucyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nX2NvdW50ID0gTWF0aC5tYXgoX2NvdW50LCBfam9pbnMuc2l6ZSgpKTsKICAg\nICAgICAgICAgX2pvaW5zID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiBf\nam9pbnMgPT0gbnVsbCB8fCBfam9pbnMuaXNFbXB0eSgpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIEpvaW5zIGNyb3NzSm9pbihUYWJsZSBsb2NhbFRh\nYmxlLCBUYWJsZSBmb3JlaWduVGFibGUpIHsKICAgICAgICAgICAgLy8gY3Jv\nc3Mgam9pbnMgYXJlIGZvciB1bmJvdW5kIHZhcmlhYmxlczsgdW5mb3J0dW5h\ndGVseSB3ZSBoYXZlCiAgICAgICAgICAgIC8vIHRvIGFsd2F5cyBnbyBESVNU\nSU5DVCBmb3IgdW5ib3VuZCB2YXJzIGJlY2F1c2UgdGhlcmUgYXJlIGNlcnRh\naW4KICAgICAgICAgICAgLy8gY2FzZXMgdGhhdCByZXF1aXJlIGl0LCBhbmQg\nd2UgY2FuJ3QgZGlmZmVyZW50aWF0ZSB0aGVtIGZyb20gdGhlCiAgICAgICAg\nICAgIC8vIGNhc2VzIHRoYXQgZG9uJ3QKICAgICAgICAgICAgX3NlbC5fZmxh\nZ3MgfD0gSU1QTElDSVRfRElTVElOQ1Q7CgogICAgICAgICAgICBpZiAoX3Nl\nbC5nZXRKb2luU3ludGF4KCkgIT0gSm9pblN5bnRheGVzLlNZTlRBWF9TUUw5\nMgogICAgICAgICAgICAgICAgfHwgX3NlbC5fZnJvbSAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAvLyBkb24ndCBtYWtlIGFueSBqb2lucywgYnV0IHVw\nZGF0ZSB0aGUgcGF0aCBpZiBhIHZhcmlhYmxlCiAgICAgICAgICAgICAgICAv\nLyBoYXMgYmVlbiBzZXQKICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kKHRo\naXMudmFyKTsKICAgICAgICAgICAgICAgIHRoaXMudmFyID0gbnVsbDsKICAg\nICAgICAgICAgICAgIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRv\nbid0IGxldCB0aGUgZ2V0IGFsaWFzIG1ldGhvZHMgc2VlIHRoYXQgYSB2YXIg\naGFzIGJlZW4gc2V0CiAgICAgICAgICAgIC8vIHVudGlsIHdlIGdldCBwYXN0\nIHRoZSBsb2NhbCB0YWJsZQogICAgICAgICAgICBTdHJpbmcgdmFyID0gdGhp\ncy52YXI7CiAgICAgICAgICAgIHRoaXMudmFyID0gbnVsbDsKICAgICAgICAg\nICAgQ29udGV4dCBjdHggPSBjb250ZXh0OyAKICAgICAgICAgICAgY29udGV4\ndCA9IG51bGw7IAoKICAgICAgICAgICAgaW50IGFsaWFzMSA9IF9zZWwuZ2V0\nVGFibGVJbmRleChsb2NhbFRhYmxlLCB0aGlzLCB0cnVlKTsKICAgICAgICAg\nICAgdGhpcy5hcHBlbmQodmFyKTsKICAgICAgICAgICAgdGhpcy5hcHBlbmQo\nY29ycmVsYXRlZFZhcik7CiAgICAgICAgICAgIGNvbnRleHQgPSBjdHg7IAog\nICAgICAgICAgICAKICAgICAgICAgICAgaW50IGFsaWFzMiA9IF9zZWwuZ2V0\nVGFibGVJbmRleChmb3JlaWduVGFibGUsIHRoaXMsIHRydWUpOwogICAgICAg\nICAgICBKb2luIGogPSBuZXcgSm9pbihsb2NhbFRhYmxlLCBhbGlhczEsIGZv\ncmVpZ25UYWJsZSwgYWxpYXMyLAogICAgICAgICAgICAgICAgbnVsbCwgZmFs\nc2UpOwogICAgICAgICAgICBqLnNldFR5cGUoSm9pbi5UWVBFX0NST1NTKTsK\nCiAgICAgICAgICAgIGlmIChfam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9qb2lucyA9IG5ldyBKb2luU2V0KCk7CiAgICAgICAgICAgIF9qb2lu\ncy5hZGQoaik7CiAgICAgICAgICAgIHNldENvcnJlbGF0ZWQoaik7CiAgICAg\nICAgICAgIF9vdXRlciA9IGZhbHNlOwogICAgICAgICAgICBsYXN0Q29udGV4\ndCA9ICBjb250ZXh0OwogICAgICAgICAgICBjb250ZXh0ID0gbnVsbDsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgSm9pbnMgam9pbihGb3JlaWduS2V5IGZrLCBib29sZWFuIGludmVyc2Us\nIGJvb2xlYW4gdG9NYW55KSB7CiAgICAgICAgICAgIHJldHVybiBqb2luKG51\nbGwsIGZrLCBudWxsLCAtMSwgaW52ZXJzZSwgdG9NYW55LCBmYWxzZSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgSm9pbnMgb3V0ZXJKb2luKEZvcmVp\nZ25LZXkgZmssIGJvb2xlYW4gaW52ZXJzZSwgYm9vbGVhbiB0b01hbnkpIHsK\nICAgICAgICAgICAgcmV0dXJuIGpvaW4obnVsbCwgZmssIG51bGwsIC0xLCBp\nbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIGpvaW5SZWxhdGlvbihTdHJpbmcgbmFtZSwgRm9yZWlnbktl\neSBmaywgCiAgICAgICAgICAgIENsYXNzTWFwcGluZyB0YXJnZXQsIGludCBz\ndWJzLCBib29sZWFuIGludmVyc2UsIGJvb2xlYW4gdG9NYW55KSB7CiAgICAg\nICAgICAgIHJldHVybiBqb2luKG5hbWUsIGZrLCB0YXJnZXQsIHN1YnMsIGlu\ndmVyc2UsIHRvTWFueSwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIEpvaW5zIG91dGVySm9pblJlbGF0aW9uKFN0cmluZyBuYW1lLCBGb3Jl\naWduS2V5IGZrLAogICAgICAgICAgICBDbGFzc01hcHBpbmcgdGFyZ2V0LCBp\nbnQgc3VicywgYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSkgewog\nICAgICAgICAgICByZXR1cm4gam9pbihuYW1lLCBmaywgdGFyZ2V0LCBzdWJz\nLCBpbnZlcnNlLCB0b01hbnksIHRydWUpOwogICAgICAgIH0KCiAgICAgICAg\ncHJpdmF0ZSBKb2lucyBqb2luKFN0cmluZyBuYW1lLCBGb3JlaWduS2V5IGZr\nLCBDbGFzc01hcHBpbmcgdGFyZ2V0LAogICAgICAgICAgICBpbnQgc3Vicywg\nYm9vbGVhbiBpbnZlcnNlLCBib29sZWFuIHRvTWFueSwgYm9vbGVhbiBvdXRl\ncikgewogICAgICAgICAgICAvLyBkb24ndCBsZXQgdGhlIGdldCBhbGlhcyBt\nZXRob2RzIHNlZSB0aGF0IGEgdmFyIGhhcyBiZWVuIHNldAogICAgICAgICAg\nICAvLyB1bnRpbCB3ZSBnZXQgcGFzdCB0aGUgbG9jYWwgdGFibGUKICAgICAg\nICAgICAgU3RyaW5nIHZhciA9IHRoaXMudmFyOwogICAgICAgICAgICB0aGlz\nLnZhciA9IG51bGw7CiAgICAgICAgICAgIENvbnRleHQgY3R4ID0gY29udGV4\ndDsgCiAgICAgICAgICAgIGNvbnRleHQgPSBudWxsOyAKCiAgICAgICAgICAg\nIC8vIGdldCBmaXJzdCB0YWJsZSBhbGlhcyBiZWZvcmUgdXBkYXRpbmcgcGF0\naDsgaWYgdGhlcmUgaXMgYSBmcm9tCiAgICAgICAgICAgIC8vIHNlbGVjdCB0\naGVuIHdlIHNob3VsZG4ndCBhY3R1YWxseSBjcmVhdGUgYSBqb2luIG9iamVj\ndCwgc2luY2UKICAgICAgICAgICAgLy8gdGhlIGpvaW5zIHdpbGwgYWxsIGJl\nIGRvbmUgaW4gdGhlIGZyb20gc2VsZWN0CiAgICAgICAgICAgIGJvb2xlYW4g\nY3JlYXRlSm9pbiA9IF9zZWwuX2Zyb20gPT0gbnVsbDsKICAgICAgICAgICAg\nVGFibGUgdGFibGUxID0gbnVsbDsKICAgICAgICAgICAgaW50IGFsaWFzMSA9\nIC0xOwogICAgICAgICAgICBpZiAoY3JlYXRlSm9pbikgewogICAgICAgICAg\nICAgICAgYm9vbGVhbiBjcmVhdGVJbmRleCA9IHRydWU7CiAgICAgICAgICAg\nICAgICB0YWJsZTEgPSAoaW52ZXJzZSkgPyBmay5nZXRQcmltYXJ5S2V5VGFi\nbGUoKSA6IGZrLmdldFRhYmxlKCk7CiAgICAgICAgICAgICAgICBpZiAoY29y\ncmVsYXRlZFZhciAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNyZWF0\nZUluZGV4ID0gZmFsc2U7ICAvLyBub3QgdG8gY3JlYXRlIGhlcmUKICAgICAg\nICAgICAgICAgIGFsaWFzMSA9IF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTEs\nIHRoaXMsIGNyZWF0ZUluZGV4KTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gdXBkYXRlIHRoZSBwYXRoIHdpdGggdGhlIHJlbGF0aW9uIG5hbWUg\nYmVmb3JlIGdldHRpbmcgcGsgYWxpYXMKICAgICAgICAgICAgdGhpcy5hcHBl\nbmQobmFtZSk7CiAgICAgICAgICAgIHRoaXMuYXBwZW5kKHZhcik7CiAgICAg\nICAgICAgIGlmICh2YXIgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHRoaXMu\nYXBwZW5kKGNvcnJlbGF0ZWRWYXIpOwogICAgICAgICAgICBjb250ZXh0ID0g\nY3R4OyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0b01hbnkpIHsK\nICAgICAgICAgICAgICAgIF9zZWwuX2ZsYWdzIHw9IElNUExJQ0lUX0RJU1RJ\nTkNUOwogICAgICAgICAgICAgICAgX3NlbC5fZmxhZ3MgfD0gVE9fTUFOWTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBfb3V0ZXIgPSBvdXRlcjsKCiAg\nICAgICAgICAgIGlmIChjcmVhdGVKb2luKSB7CiAgICAgICAgICAgICAgICBi\nb29sZWFuIGNyZWF0ZUluZGV4ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIFRh\nYmxlIHRhYmxlMiA9IChpbnZlcnNlKSA/IGZrLmdldFRhYmxlKCkgCiAgICAg\nICAgICAgICAgICAgICAgOiBmay5nZXRQcmltYXJ5S2V5VGFibGUoKTsKICAg\nICAgICAgICAgICAgIGJvb2xlYW4gY3JlYXRlZCA9IGZhbHNlOwogICAgICAg\nICAgICAgICAgaW50IGFsaWFzMiA9IC0xOwogICAgICAgICAgICAgICAgaWYg\nKHRhYmxlMi5pc0Fzc29jaWF0aW9uKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBhbGlhczIgPSBfc2VsLmdldFRhYmxlSW5kZXgodGFibGUyLCB0aGlzLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFsaWFzMiA9PSAtMSkK\nICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlSW5kZXggPSB0cnVlOwog\nICAgICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAg\nICAgIGNyZWF0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgZWxzZSBpZiAoY29udGV4dCA9PSBfc2VsLmN0eCgpKSAKICAg\nICAgICAgICAgICAgICAgIGNyZWF0ZUluZGV4ID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKGNvcnJlbGF0ZWRWYXIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBjcmVhdGVJbmRleCA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgaWYgKCFjcmVhdGVkKQogICAgICAgICAgICAgICAgICAgIGFsaWFz\nMiA9IF9zZWwuZ2V0VGFibGVJbmRleCh0YWJsZTIsIHRoaXMsIGNyZWF0ZUlu\nZGV4KTsKICAgICAgICAgICAgICAgIEpvaW4gaiA9IG5ldyBKb2luKHRhYmxl\nMSwgYWxpYXMxLCB0YWJsZTIsIGFsaWFzMiwgZmssIGludmVyc2UpOwogICAg\nICAgICAgICAgICAgai5zZXRUeXBlKChvdXRlcikgPyBKb2luLlRZUEVfT1VU\nRVIgOiBKb2luLlRZUEVfSU5ORVIpOwoKICAgICAgICAgICAgICAgIGlmIChf\nam9pbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfam9pbnMgPSBu\nZXcgSm9pblNldCgpOwogICAgICAgICAgICAgICAgaWYgKF9qb2lucy5hZGQo\naikgJiYgKHN1YnMgPT0gU2VsZWN0LlNVQlNfSk9JTkFCTEUgCiAgICAgICAg\nICAgICAgICAgICAgfHwgc3VicyA9PSBTZWxlY3QuU1VCU19OT05FKSkKICAg\nICAgICAgICAgICAgICAgICBqLnNldFJlbGF0aW9uKHRhcmdldCwgc3Vicywg\nY2xvbmUoX3NlbCkpOwoKICAgICAgICAgICAgICAgIHNldENvcnJlbGF0ZWQo\naik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdENvbnRleHQgPSBj\nb250ZXh0OwogICAgICAgICAgICBjb250ZXh0ID0gbnVsbDsKICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZv\naWQgc2V0Q29ycmVsYXRlZChKb2luIGopIHsKICAgICAgICAgICAgaWYgKF9z\nZWwuX3BhcmVudCA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgaWYgKF9zZWwuX2FsaWFzZXMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgai5zZXRJc05vdE15Sm9pbigpOwogICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9iamVjdCBh\nbGlhc2VzW10gPSBfc2VsLl9hbGlhc2VzLnZhbHVlcygpLnRvQXJyYXkoKTsK\nICAgICAgICAgICAgYm9vbGVhbiBmb3VuZDEgPSBmYWxzZTsKICAgICAgICAg\nICAgYm9vbGVhbiBmb3VuZDIgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgYWxpYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgaW50IGFsaWFzID0gKChJbnRlZ2VyKWFsaWFzZXNbaV0pLmlu\ndFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAoYWxpYXMgPT0gai5nZXRJ\nbmRleDEoKSkKICAgICAgICAgICAgICAgICAgICBmb3VuZDEgPSB0cnVlOwog\nICAgICAgICAgICAgICAgaWYgKGFsaWFzID09IGouZ2V0SW5kZXgyKCkpCiAg\nICAgICAgICAgICAgICAgICAgZm91bmQyID0gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChmb3VuZDEgJiYg\nZm91bmQyKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBl\nbHNlIGlmICghZm91bmQxICYmICFmb3VuZDIpIHsKICAgICAgICAgICAgICAg\nIGouc2V0SXNOb3RNeUpvaW4oKTsKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgIGouc2V0Q29ycmVsYXRlZCgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBtb3ZlSm9pbnNUb1BhcmVudCgpIHsK\nICAgICAgICAgICAgaWYgKF9qb2lucyA9PSBudWxsKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgIEpvaW4gaiA9IG51bGw7CiAgICAgICAg\nICAgTGlzdDxKb2luPiByZW1vdmVkID0gbmV3IEFycmF5TGlzdDxKb2luPig1\nKTsKICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9qb2lucy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICBqID0g\nKEpvaW4pIGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgIGlmIChqLmlzTm90\nTXlKb2luKCkpIHsKICAgICAgICAgICAgICAgICAgIGFkZEpvaW5zVG9QYXJl\nbnQoX3NlbC5fcGFyZW50LCBqKTsKICAgICAgICAgICAgICAgICAgIHJlbW92\nZWQuYWRkKGopOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgfQogICAg\nICAgICAgIGZvciAoSm9pbiBqb2luIDogcmVtb3ZlZCkgewogICAgICAgICAg\nICAgICBfam9pbnMucmVtb3ZlKGpvaW4pOwogICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBhZGRKb2luc1RvUGFyZW50KFNl\nbGVjdEltcGwgcGFyZW50LCBKb2luIGpvaW4pIHsKICAgICAgICAgICAgaWYg\nKHBhcmVudC5fYWxpYXNlcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICBPYmplY3QgYWxpYXNlc1tdID0gcGFyZW50Ll9h\nbGlhc2VzLnZhbHVlcygpLnRvQXJyYXkoKTsKICAgICAgICAgICAgYm9vbGVh\nbiBmb3VuZDEgPSBmYWxzZTsKICAgICAgICAgICAgYm9vbGVhbiBmb3VuZDIg\nPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYWxp\nYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaW50IGFsaWFz\nID0gKChJbnRlZ2VyKWFsaWFzZXNbaV0pLmludFZhbHVlKCk7CiAgICAgICAg\nICAgICAgICBpZiAoYWxpYXMgPT0gam9pbi5nZXRJbmRleDEoKSkKICAgICAg\nICAgICAgICAgICAgICBmb3VuZDEgPSB0cnVlOwogICAgICAgICAgICAgICAg\naWYgKGFsaWFzID09IGpvaW4uZ2V0SW5kZXgyKCkpCiAgICAgICAgICAgICAg\nICAgICAgZm91bmQyID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgCiAgICAgICAgICAgIGlmIChmb3VuZDEgJiYgZm91bmQyKSB7CiAg\nICAgICAgICAgICAgICAvLyB0aGlzIGlzIG15IGpvaW4sIGFkZCBqb2luCiAg\nICAgICAgICAgICAgICBpZiAocGFyZW50Ll9qb2lucyA9PSBudWxsKSAKICAg\nICAgICAgICAgICAgICAgICBwYXJlbnQuX2pvaW5zID0gbmV3IFNlbGVjdEpv\naW5zKHBhcmVudCk7CiAgICAgICAgICAgICAgICBTZWxlY3RKb2lucyBwID0g\ncGFyZW50Ll9qb2luczsKICAgICAgICAgICAgICAgIGlmIChwLmpvaW5zKCkg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBwLnNldEpvaW5zKG5ldyBK\nb2luU2V0KCkpOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHAu\nam9pbnMoKS5hZGQoam9pbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZWxzZSBpZiAocGFyZW50Ll9wYXJlbnQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIGFkZEpvaW5zVG9QYXJlbnQocGFyZW50Ll9wYXJlbnQsIGpvaW4pOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFNlbGVjdEpvaW5zIGNsb25lKFNl\nbGVjdEltcGwgc2VsKSB7CiAgICAgICAgICAgIFNlbGVjdEpvaW5zIHNqID0g\nbmV3IFNlbGVjdEpvaW5zKHNlbCk7CiAgICAgICAgICAgIHNqLnZhciA9IHZh\ncjsKICAgICAgICAgICAgaWYgKHBhdGggIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHNqLnBhdGggPSBuZXcgU3RyaW5nQnVpbGRlcihwYXRoLnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICBpZiAoX2pvaW5zICE9IG51bGwgJiYgIV9qb2lu\ncy5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICBzai5fam9pbnMgPSBuZXcg\nSm9pblNldChfam9pbnMpOwogICAgICAgICAgICBzai5fb3V0ZXIgPSBfb3V0\nZXI7CiAgICAgICAgICAgIHJldHVybiBzajsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBzdXBlci50b1N0cmluZygpICsgIiAoIiArIF9vdXRlciArICIpOiAiICsg\nX2pvaW5zOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJvdGVjdGVkIFNl\nbGVjdHMgbmV3U2VsZWN0cygpIHsKICAgICAgICByZXR1cm4gbmV3IFNlbGVj\ndHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBjbGFzcyB0byB0\ncmFjayBzZWxlY3RlZCBjb2x1bW5zLCB3aXRoIGZhc3QgY29udGFpbnMgbWV0\naG9kLgogICAgICogQWN0cyBhcyBhIGxpc3Qgb2Ygc2VsZWN0IGlkcywgd2l0\naCBhZGRpdGlvbmFsIG1ldGhvZHMgdG8gbWFuaXB1bGF0ZQogICAgICogdGhl\nIGFsaWFzIG9mIGVhY2ggc2VsZWN0ZWQgaWQuCiAgICAgKi8KICAgIHByb3Rl\nY3RlZCBzdGF0aWMgY2xhc3MgU2VsZWN0cwogICAgICAgIGV4dGVuZHMgQWJz\ndHJhY3RMaXN0IHsKCiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lkcyA9IG51\nbGw7CiAgICAgICAgcHJvdGVjdGVkIExpc3QgX2lkZW50cyA9IG51bGw7CiAg\nICAgICAgcHJvdGVjdGVkIE1hcCBfYWxpYXNlcyA9IG51bGw7CiAgICAgICAg\ncHJvdGVjdGVkIE1hcCBfc2VsZWN0QXMgPSBudWxsOwogICAgICAgIHByb3Rl\nY3RlZCBEQkRpY3Rpb25hcnkgX2RpY3QgPSBudWxsOwoKICAgICAgICAvKioK\nICAgICAgICAgKiBBZGQgYWxsIGFsaWFzZXMgZnJvbSBhbm90aGVyIGluc3Rh\nbmNlLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGFkZEFsbChT\nZWxlY3RzIHNlbHMpIHsKICAgICAgICAgICAgaWYgKF9pZHMgPT0gbnVsbCAm\nJiBzZWxzLl9pZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9pZHMgPSBu\nZXcgQXJyYXlMaXN0KHNlbHMuX2lkcyk7CiAgICAgICAgICAgIGVsc2UgaWYg\nKHNlbHMuX2lkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2lkcy5hZGRB\nbGwoc2Vscy5faWRzKTsKCiAgICAgICAgICAgIGlmIChfaWRlbnRzID09IG51\nbGwgJiYgc2Vscy5faWRlbnRzICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\naWRlbnRzID0gbmV3IEFycmF5TGlzdChzZWxzLl9pZGVudHMpOwogICAgICAg\nICAgICBlbHNlIGlmIChzZWxzLl9pZGVudHMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9pZGVudHMuYWRkQWxsKHNlbHMuX2lkZW50cyk7CgogICAgICAg\nICAgICBpZiAoX2FsaWFzZXMgPT0gbnVsbCAmJiBzZWxzLl9hbGlhc2VzICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNlcyA9IG5ldyBIYXNoTWFw\nKHNlbHMuX2FsaWFzZXMpOwogICAgICAgICAgICBlbHNlIGlmIChzZWxzLl9h\nbGlhc2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWxpYXNlcy5wdXRB\nbGwoc2Vscy5fYWxpYXNlcyk7CgogICAgICAgICAgICBpZiAoX3NlbGVjdEFz\nID09IG51bGwgJiYgc2Vscy5fc2VsZWN0QXMgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF9zZWxlY3RBcyA9IG5ldyBIYXNoTWFwKHNlbHMuX3NlbGVjdEFz\nKTsKICAgICAgICAgICAgZWxzZSBpZiAoc2Vscy5fc2VsZWN0QXMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIF9zZWxlY3RBcy5wdXRBbGwoc2Vscy5fc2Vs\nZWN0QXMpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0\ndXJucyB0aGUgYWxpYXMgb2YgYSBnaXZlbiBpZC4KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgT2JqZWN0IGdldEFsaWFzKE9iamVjdCBpZCkgewogICAg\nICAgICAgICByZXR1cm4gKF9hbGlhc2VzID09IG51bGwpID8gbnVsbCA6IF9h\nbGlhc2VzLmdldChpZCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBTZXQgYW4gYWxpYXMgZm9yIGEgZ2l2ZW4gaWQuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIGludCBzZXRBbGlhcyhPYmplY3QgaWQsIE9iamVj\ndCBhbGlhcywgYm9vbGVhbiBpZGVudCkgewogICAgICAgICAgICBpZiAoX2lk\ncyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBfaWRzID0gbmV3IEFycmF5\nTGlzdCgpOwogICAgICAgICAgICAgICAgX2FsaWFzZXMgPSBuZXcgSGFzaE1h\ncCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbnQgaWR4OwogICAg\nICAgICAgICBpZiAoX2FsaWFzZXMucHV0KGlkLCBhbGlhcykgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgIGlkeCA9IF9pZHMuaW5kZXhPZihpZCk7CiAgICAg\nICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgX2lkcy5hZGQoaWQpOwog\nICAgICAgICAgICAgICAgaWR4ID0gX2lkcy5zaXplKCkgLSAxOwoKICAgICAg\nICAgICAgICAgIGlmIChpZGVudCkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChfaWRlbnRzID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIF9p\nZGVudHMgPSBuZXcgQXJyYXlMaXN0KDMpOwogICAgICAgICAgICAgICAgICAg\nIF9pZGVudHMuYWRkKGlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gaWR4OwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogU2V0IGFuIGFsaWFzIGZvciBhIGdpdmVuIGlu\nZGV4LgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHNldEFsaWFz\nKGludCBpZHgsIE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBPYmplY3Qg\naWQgPSBfaWRzLmdldChpZHgpOwogICAgICAgICAgICBfYWxpYXNlcy5wdXQo\naWQsIGFsaWFzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAq\nIEluc2VydCBhbiBhbGlhcyBiZWZvcmUgdGhlIGdpdmVuIGluZGV4LCB1c2lu\nZyBuZWdhdGl2ZSBpbmRleGVzCiAgICAgICAgICogdG8gY291bnQgYmFja3dh\ncmRzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGluc2VydEFs\naWFzKGludCBpZHgsIE9iamVjdCBpZCwgT2JqZWN0IGFsaWFzKSB7CiAgICAg\nICAgICAgIF9hbGlhc2VzLnB1dChpZCwgYWxpYXMpOwogICAgICAgICAgICBp\nZiAoaWR4ID49IDApCiAgICAgICAgICAgICAgICBfaWRzLmFkZChpZHgsIGlk\nKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgX2lkcy5hZGQo\nX2lkcy5zaXplKCkgKyBpZHgsIGlkKTsKICAgICAgICB9CgogICAgICAgIC8q\nKgogICAgICAgICAqIFJldHVybiB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIGFs\naWFzLgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgaW5kZXhPZkFs\naWFzKE9iamVjdCBhbGlhcykgewogICAgICAgICAgICBpZiAoX2FsaWFzZXMg\nPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfaWRzLnNpemUoKTsgaSsrKQogICAg\nICAgICAgICAgICAgaWYgKGFsaWFzLmVxdWFscyhfYWxpYXNlcy5nZXQoX2lk\ncy5nZXQoaSkpKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAg\nICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogQSBsaXN0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBhbGlhc2Vz\nLCBpbiBzZWxlY3Qgb3JkZXIsIHdpdGgKICAgICAgICAgKiBBUyBhbGlhc2Vz\nIHByZXNlbnQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIExpc3QgZ2V0\nQWxpYXNlcyhmaW5hbCBib29sZWFuIGlkZW50LCBmaW5hbCBib29sZWFuIGlu\nbmVyKSB7CiAgICAgICAgICAgIGlmIChfaWRzID09IG51bGwpCiAgICAgICAg\nICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfTElTVDsKCiAgICAg\nICAgICAgIHJldHVybiBuZXcgQWJzdHJhY3RMaXN0KCkgewogICAgICAgICAg\nICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9pZGVudHMu\nc2l6ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5zaXplKCk7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVibGljIE9i\namVjdCBnZXQoaW50IGkpIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qg\naWQgPSAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKSA/IF9pZGVudHMuZ2V0\nKGkpCiAgICAgICAgICAgICAgICAgICAgICAgIDogX2lkcy5nZXQoaSk7CiAg\nICAgICAgICAgICAgICAgICAgT2JqZWN0IGFsaWFzID0gX2FsaWFzZXMuZ2V0\nKGlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWQgaW5zdGFuY2VvZiBD\nb2x1bW4gJiYgKChDb2x1bW4pIGlkKS5pc1hNTCgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBhbGlhcyA9IGFsaWFzICsgX2RpY3QuZ2V0U3RyaW5nVmFs\nOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcgYXMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChp\nbm5lcikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxpYXMgaW5z\ndGFuY2VvZiBTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\ncyA9ICgoU3RyaW5nKSBhbGlhcykucmVwbGFjZSgnLicsICdfJyk7CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfc2VsZWN0QXMgIT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgYXMgPSAoU3RyaW5nKSBfc2VsZWN0\nQXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpZCBp\nbnN0YW5jZW9mIFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBhcyA9\nICgoVmFsdWUpIGlkKS5nZXRBbGlhcygpOwoKICAgICAgICAgICAgICAgICAg\nICBpZiAoYXMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoaWRlbnQgJiYgX2lkZW50cyAhPSBudWxsKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGFzOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoYWxpYXMgaW5zdGFuY2VvZiBTUUxCdWZmZXIpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBhbGlhcyA9IG5ldyBTUUxCdWZmZXIoKFNRTEJ1\nZmZlcikgYWxpYXMpLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGFwcGVuZCgiIEFTICIpLmFwcGVuZChhcyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFz\nID0gYWxpYXMgKyAiIEFTICIgKyBhczsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogU2V0IHRoYXQgYSBnaXZlbiBpZCdzIGFsaWFzIGhhcyBh\nbiBBUyB2YWx1ZS4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBz\nZXRTZWxlY3RBcyhPYmplY3QgaWQsIFN0cmluZyBhcykgewogICAgICAgICAg\nICBpZiAoX3NlbGVjdEFzID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2Vs\nZWN0QXMgPSBuZXcgSGFzaE1hcCgoaW50KSAoNSAqIDEuMzMgKyAxKSk7CiAg\nICAgICAgICAgIF9zZWxlY3RBcy5wdXQoaWQsIGFzKTsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIENsZWFyIGFsbCBwbGFjZWhvbGRlcnMg\nYW5kIHNlbGVjdCBBUyBjbGF1c2VzLgogICAgICAgICAqLwogICAgICAgIHB1\nYmxpYyB2b2lkIGNsZWFyUGxhY2Vob2xkZXJzKCkgewogICAgICAgICAgICBp\nZiAoX2lkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAg\nICAgICAgICAgT2JqZWN0IGlkOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IF9pZHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAg\nICAgICAgICAgICAgIGlkID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIGlmIChpZCBpbnN0YW5jZW9mIFBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAg\nICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIF9h\nbGlhc2VzLnJlbW92ZShpZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRh\naW5zKE9iamVjdCBpZCkgewogICAgICAgICAgICByZXR1cm4gX2FsaWFzZXMg\nIT0gbnVsbCAmJiBfYWxpYXNlcy5jb250YWluc0tleShpZCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IGdldChpbnQgaSkgewogICAgICAg\nICAgICBpZiAoX2lkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbigpOwogICAgICAg\nICAgICByZXR1cm4gX2lkcy5nZXQoaSk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgaW50IHNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiAoX2lkcyA9\nPSBudWxsKSA/IDAgOiBfaWRzLnNpemUoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGNsZWFyKCkgewogICAgICAgICAgICBfaWRzID0gbnVs\nbDsKICAgICAgICAgICAgX2FsaWFzZXMgPSBudWxsOwogICAgICAgICAgICBf\nc2VsZWN0QXMgPSBudWxsOwogICAgICAgICAgICBfaWRlbnRzID0gbnVsbDsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEpvaW5zIHNldENvcnJlbGF0\nZWRWYXJpYWJsZShTdHJpbmcgdmFyKSB7CiAgICAgICAgaWYgKHZhciA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICByZXR1cm4g\nbmV3IFNlbGVjdEpvaW5zKHRoaXMpLnNldENvcnJlbGF0ZWRWYXJpYWJsZSh2\nYXIpOwogICAgfQogICAgCiAgICBwdWJsaWMgSm9pbnMgc2V0Sm9pbkNvbnRl\neHQoQ29udGV4dCBjdHgpIHsKICAgICAgICBpZiAoY3R4ID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIHJldHVybiBuZXcgU2Vs\nZWN0Sm9pbnModGhpcykuc2V0Sm9pbkNvbnRleHQoY3R4KTsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENvcnJlbGF0ZWRWYXJpYWJsZSgpIHsKICAg\nICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBtb3Zl\nSm9pbnNUb1BhcmVudCgpIHsKICAgIH0KfQoKLyoqCiAqIENvbW1vbiBqb2lu\ncyBpbnRlcmZhY2UgdXNlZCBpbnRlcm5hbGx5LiBDYW5ub3QgYmUgbWFkZSBh\nbiBpbm5lciBjbGFzcwogKiBiZWNhdXNlIHRoZSBvdXRlciBjbGFzcyAoU2Vs\nZWN0KSBoYXMgdG8gaW1wbGVtZW50IGl0LgogKi8KaW50ZXJmYWNlIFBhdGhK\nb2lucwogICAgZXh0ZW5kcyBKb2lucyB7CgogICAgLyoqCiAgICAgKiBNYXJr\nIHRoaXMgYXMgYW4gb3V0ZXIgam9pbnMgc2V0LgogICAgICovCiAgICBwdWJs\naWMgUGF0aEpvaW5zIHNldE91dGVyKGJvb2xlYW4gb3V0ZXIpOwoKICAgIC8q\nKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhpcyBpbnN0YW5jZSBoYXMgYSBw\nYXRoLCBhbnkgam9pbnMsIG9yIGEgdmFyaWFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBib29sZWFuIGlzRGlydHkoKTsKCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgcmVsYXRpb24gcGF0aCB0cmF2ZXJzZWQgYnkgdGhlc2Ugam9pbnMs\nIG9yIG51bGwgaWYgbm9uZS4KICAgICAqLwogICAgcHVibGljIFN0cmluZ0J1\naWxkZXIgcGF0aCgpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzZXQg\nb2Yge0BsaW5rIEpvaW59IGVsZW1lbnRzLCBvciBudWxsIGlmIG5vbmUuCiAg\nICAgKi8KICAgIHB1YmxpYyBKb2luU2V0IGpvaW5zKCk7CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIG1heGltdW0gbnVtYmVyIG9mIGpvaW5zIGNvbnRh\naW5lZCBpbiB0aGlzIGluc3RhbmNlIGF0IGFueQogICAgICogdGltZS4KICAg\nICAqLwogICAgcHVibGljIGludCBqb2luQ291bnQoKTsKCiAgICAvKioKICAg\nICAqIE51bGwgdGhlIHNldCBvZiB7QGxpbmsgSm9pbn0gZWxlbWVudHMuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIG51bGxKb2lucygpOwoKICAgIC8qKgog\nICAgICogVGhlIHNlbGVjdCBvd25lciBvZiB0aGlzIGpvaW4KICAgICAqIEBy\nZXR1cm4KICAgICAqLwogICAgcHVibGljIFNlbGVjdCBnZXRTZWxlY3QoKTsK\nfQoK\n","encoding":"base64"}

