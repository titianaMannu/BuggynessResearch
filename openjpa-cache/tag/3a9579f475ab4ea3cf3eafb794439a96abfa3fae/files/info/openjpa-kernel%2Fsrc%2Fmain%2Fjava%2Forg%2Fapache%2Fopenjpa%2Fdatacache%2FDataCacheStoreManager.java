{"sha":"039b965df88d7eba5e83b7b3f8d59426a41f08cf","node_id":"MDQ6QmxvYjIwNjM2NDowMzliOTY1ZGY4OGQ3ZWJhNWU4M2I3YjNmOGQ1OTQyNmE0MWYwOGNm","size":28672,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/039b965df88d7eba5e83b7b3f8d59426a41f08cf","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0\nOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0ZXJh\ndG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKCmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QQ0RhdGFHZW5lcmF0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkRhdGFDYWNoZVJldHJpZXZl\nTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuRGF0YUNh\nY2hlU3RvcmVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5l\nbC5EZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmtlcm5lbC5GZXRjaENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEua2VybmVsLkZpbmRDYWxsYmFja3M7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLkxvY2tMZXZlbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLk9wZW5KUEFTdGF0ZU1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlBDU3RhdGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlF1ZXJ5TGFuZ3VhZ2Vz\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9yZUNvbnRl\neHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0b3JlTWFu\nYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuU3RvcmVR\ndWVyeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5NZXRhRGF0\nYVJlcG9zaXRvcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5P\ncGVuSlBBSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcHRp\nbWlzdGljRXhjZXB0aW9uOwoKLyoqCiAqIFN0b3JlTWFuYWdlciBwcm94eSB0\naGF0IGRlbGVnYXRlcyB0byBhIGRhdGEgY2FjaGUgd2hlbiBwb3NzaWJsZS4K\nICoKICogQGF1dGhvciBQYXRyaWNrIExpbnNrZXkKICogQG5vamF2YWRvYwog\nKi8KcHVibGljIGNsYXNzIERhdGFDYWNoZVN0b3JlTWFuYWdlcgogICAgZXh0\nZW5kcyBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIHsKCiAgICAvLyBhbGwgdGhl\nIHN0YXRlIG1hbmFnZXJzIGNoYW5nZWQgaW4gdGhpcyB0cmFuc2FjdGlvbgog\nICAgcHJpdmF0ZSBDb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IF9p\nbnNlcnRzID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPE9wZW5KUEFTdGF0ZU1h\nbmFnZXIsIEJpdFNldD4gX3VwZGF0ZXMgPSBudWxsOwogICAgcHJpdmF0ZSBD\nb2xsZWN0aW9uPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IF9kZWxldGVzID0gbnVs\nbDsKCiAgICAvLyB0aGUgb3duaW5nIGNvbnRleHQKICAgIHByaXZhdGUgU3Rv\ncmVDb250ZXh0IF9jdHggPSBudWxsOwogICAgcHJpdmF0ZSBEYXRhQ2FjaGVN\nYW5hZ2VyIF9tZ3IgPSBudWxsOwogICAgLy8gcGMgZGF0YSBnZW5lcmF0b3IK\nICAgIHByaXZhdGUgUENEYXRhR2VuZXJhdG9yIF9nZW4gPSBudWxsOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFt\nIHNtIHRoZSBzdG9yZSBtYW5hZ2VyIHRvIGRlbGVnYXRlIHRvCiAgICAgKi8K\nICAgIHB1YmxpYyBEYXRhQ2FjaGVTdG9yZU1hbmFnZXIoU3RvcmVNYW5hZ2Vy\nIHNtKSB7CiAgICAgICAgc3VwZXIoc20pOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldENvbnRleHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIF9j\ndHggPSBjdHg7CiAgICAgICAgX21nciA9IGN0eC5nZXRDb25maWd1cmF0aW9u\nKCkuZ2V0RGF0YUNhY2hlTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX2dl\nbiA9IF9tZ3IuZ2V0UENEYXRhR2VuZXJhdG9yKCk7CiAgICAgICAgc3VwZXIu\nc2V0Q29udGV4dChjdHgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGJlZ2lu\nKCkgewogICAgICAgIHN1cGVyLmJlZ2luKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgY29tbWl0KCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN1\ncGVyLmNvbW1pdCgpOwogICAgICAgICAgICB1cGRhdGVDYWNoZXMoKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaW5zZXJ0cyA9IG51bGw7\nCiAgICAgICAgICAgIF91cGRhdGVzID0gbnVsbDsKICAgICAgICAgICAgX2Rl\nbGV0ZXMgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCByb2xsYmFjaygpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdXBl\nci5yb2xsYmFjaygpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIF9pbnNlcnRzID0gbnVsbDsKICAgICAgICAgICAgX3VwZGF0ZXMgPSBudWxs\nOwogICAgICAgICAgICBfZGVsZXRlcyA9IG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogRXZpY3QgYWxsIG1lbWJlcnMgb2YgdGhlIGdp\ndmVuIGNsYXNzZXMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBldmljdFR5\ncGVzKENvbGxlY3Rpb248Q2xhc3M8Pz4+IGNsYXNzZXMpIHsKICAgICAgICBp\nZiAoY2xhc3Nlcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgTWV0YURhdGFSZXBvc2l0b3J5IG1kciA9IF9jdHguZ2V0Q29uZmln\ndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAg\nICAgICAgQ2xhc3NMb2FkZXIgbG9hZGVyID0gX2N0eC5nZXRDbGFzc0xvYWRl\ncigpOwoKICAgICAgICBEYXRhQ2FjaGUgY2FjaGU7CiAgICAgICAgZm9yIChD\nbGFzczw/PiBjbHMgOiBjbGFzc2VzKSB7CiAgICAgICAgICAgIGNhY2hlID0g\nbWRyLmdldE1ldGFEYXRhKGNscywgbG9hZGVyLCBmYWxzZSkuZ2V0RGF0YUNh\nY2hlKCk7CiAgICAgICAgICAgIGlmIChjYWNoZSAhPSBudWxsKQogICAgICAg\nICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKGNscywgZmFsc2UpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgY2FjaGVzIHdp\ndGggdGhlIGNvbW1pdHRlZCBpbnNlcnRzLCB1cGRhdGVzLCBhbmQgZGVsZXRl\ncy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHVwZGF0ZUNhY2hlcygpIHsK\nICAgICAgICBpZihfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpLmdldENh\nY2hlU3RvcmVNb2RlKCkgIT0gRGF0YUNhY2hlU3RvcmVNb2RlLkJZUEFTUyAp\nIHsgCiAgICAgICAgICAgIC8vIG1hcCBlYWNoIGRhdGEgY2FjaGUgdG8gdGhl\nIG1vZGlmaWNhdGlvbnMgd2UgbmVlZCB0byBwZXJmb3JtCiAgICAgICAgICAg\nIE1hcDxEYXRhQ2FjaGUsTW9kaWZpY2F0aW9ucz4gbW9kTWFwID0gbnVsbDsK\nICAgICAgICAgICAgaWYgKChfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCkg\nJiYgX2luc2VydHMgIT0gbnVsbCkgfHwgX3VwZGF0ZXMgIT0gbnVsbCB8fCBf\nZGVsZXRlcyAhPSBudWxsKQogICAgICAgICAgICAgICAgbW9kTWFwID0gbmV3\nIEhhc2hNYXA8RGF0YUNhY2hlLE1vZGlmaWNhdGlvbnM+KCk7CiAgICAgICAg\nICAgIE1vZGlmaWNhdGlvbnMgbW9kczsKICAgICAgICAgICAgRGF0YUNhY2hl\nUENEYXRhIGRhdGE7CiAgICAgICAgICAgIERhdGFDYWNoZSBjYWNoZTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBwYyBkYXRhcyBmb3IgaW5zZXJ0cwogICAg\nICAgICAgICBpZiAoX2N0eC5nZXRQb3B1bGF0ZURhdGFDYWNoZSgpICYmIF9p\nbnNlcnRzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvciAoT3BlbkpQ\nQVN0YXRlTWFuYWdlciBzbSA6IF9pbnNlcnRzKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2FjaGUgPSBfbWdyLnNlbGVjdENhY2hlKHNtKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIG1vZHMg\nPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwogICAgICAgICAg\nICAgICAgICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAgICAgICAgICAg\nICAgICAgIGRhdGEuc3RvcmUoc20pOwogICAgICAgICAgICAgICAgICAgIG1v\nZHMuYWRkaXRpb25zLmFkZChuZXcgUENEYXRhSG9sZGVyKGRhdGEsIHNtKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIHVwZGF0ZSBwY2RhdGFzIGZvciB1cGRhdGVzCiAgICAgICAgICAgIGlm\nIChfdXBkYXRlcyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBCaXRTZXQg\nZmllbGRzOwogICAgICAgICAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBz\nbTsKICAgICAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5PE9wZW5KUEFTdGF0\nZU1hbmFnZXIsIEJpdFNldD4gZW50cnkgOiBfdXBkYXRlcy5lbnRyeVNldCgp\nKSB7IAogICAgICAgICAgICAgICAgICAgIHNtID0gZW50cnkuZ2V0S2V5KCk7\nCiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gZW50cnkuZ2V0VmFsdWUo\nKTsKCiAgICAgICAgICAgICAgICAgICAgY2FjaGUgPSBfbWdyLnNlbGVjdENh\nY2hlKHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGl0J3Mg\nb2sgbm90IHRvIGNsb25lIHRoZSBvYmplY3QgdGhhdCB3ZSBnZXQgZnJvbSB0\naGUgY2FjaGUsCiAgICAgICAgICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUg\naW5zaWRlIHRoZSBjb21taXQoKSBtZXRob2QsIHNvIGFueSBtb2RpZmljYXRp\nb25zCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gdGhlIHVuZGVybHlpbmcg\nY2FjaGUgYXJlIHZhbGlkLiBJZiB0aGUgY29tbWl0IGhhZCBub3QKICAgICAg\nICAgICAgICAgICAgICAvLyBhbHJlYWR5IHN1Y2NlZWRlZCwgdGhlbiB3ZSdk\nIHdhbnQgdG8gY2xvbmUgdGhlIHJldHJpZXZlZAogICAgICAgICAgICAgICAg\nICAgIC8vIG9iamVjdC4KICAgICAgICAgICAgICAgICAgICBkYXRhID0gY2Fj\naGUuZ2V0KHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgICAg\nIG1vZHMgPSBnZXRNb2RpZmljYXRpb25zKG1vZE1hcCwgY2FjaGUpOwoKICAg\nICAgICAgICAgICAgICAgICAvLyBkYXRhIHNob3VsZCBhbHdheXMgYmUgbm9u\nLW51bGwsIHNpbmNlIHRoZSBvYmplY3QgaXMKICAgICAgICAgICAgICAgICAg\nICAvLyBkaXJ0eSwgYnV0IG1heWJlIGl0IGdvdCBkcm9wcGVkIGZyb20gdGhl\nIGNhY2hlIGluIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGludGVyaW0K\nICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGRhdGEgPSBuZXdQQ0RhdGEoc20pOwogICAg\nICAgICAgICAgICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbW9kcy5uZXdVcGRhdGVzLmFkZChuZXcgUENEYXRh\nSG9sZGVyKGRhdGEsIHNtKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdG9yZShzbSwgZmll\nbGRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kcy5leGlzdGluZ1Vw\nZGF0ZXMuYWRkKG5ldyBQQ0RhdGFIb2xkZXIoZGF0YSwgc20pKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHJlbW92ZSBwY2RhdGFzIGZvciBkZWxldGVz\nCiAgICAgICAgICAgIGlmIChfZGVsZXRlcyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBmb3IgKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gOiBfZGVsZXRl\ncykgeyAKICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IF9tZ3Iuc2VsZWN0\nQ2FjaGUoc20pOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWNoZSA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAgICAgbW9kcyA9IGdldE1vZGlmaWNhdGlvbnMobW9kTWFw\nLCBjYWNoZSk7CiAgICAgICAgICAgICAgICAgICAgbW9kcy5kZWxldGVzLmFk\nZChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbm90aWZ5IHRoZSBjYWNoZXMgb2Yg\ndGhlIGNoYW5nZXMKICAgICAgICAgICAgaWYgKG1vZE1hcCAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBmb3IgKE1hcC5FbnRyeTxEYXRhQ2FjaGUsTW9k\naWZpY2F0aW9ucz4gZW50cnkgOiBtb2RNYXAuZW50cnlTZXQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGNhY2hlID0gZW50cnkuZ2V0S2V5KCk7CiAgICAg\nICAgICAgICAgICAgICAgbW9kcyA9IGVudHJ5LmdldFZhbHVlKCk7CgogICAg\nICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSdyZSBub3QgY2FjaGlu\nZyBvbGQgdmVyc2lvbnMKICAgICAgICAgICAgICAgICAgICBjYWNoZS53cml0\nZUxvY2soKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICBjYWNoZS5jb21taXQoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMo\nY2FjaGUsIG1vZHMuYWRkaXRpb25zKSwgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdHJhbnNmb3JtVG9WZXJzaW9uU2FmZVBDRGF0YXMoY2Fj\naGUsIG1vZHMubmV3VXBkYXRlcyksIAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHRyYW5zZm9ybVRvVmVyc2lvblNhZmVQQ0RhdGFzKGNhY2hl\nLCBtb2RzLmV4aXN0aW5nVXBkYXRlcyksIAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG1vZHMuZGVsZXRlcyk7CiAgICAgICAgICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGUu\nd3JpdGVVbmxvY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHdl\nIHdlcmUgaW4gbGFyZ2VUcmFuc2FjdGlvbiBtb2RlLCB0aGVuIHdlIGhhdmUg\ncmVjb3JkZWQKICAgICAgICAgICAgLy8gdGhlIGNsYXNzZXMgb2YgdXBkYXRl\nZC9kZWxldGVkIG9iamVjdHMgYW5kIHRoZXNlIG5vdyBuZWVkIHRvIGJlCiAg\nICAgICAgICAgIC8vIGV2aWN0ZWQKICAgICAgICAgICAgaWYgKF9jdHguaXNU\ncmFja0NoYW5nZXNCeVR5cGUoKSkgewogICAgICAgICAgICAgICAgZXZpY3RU\neXBlcyhfY3R4LmdldERlbGV0ZWRUeXBlcygpKTsKICAgICAgICAgICAgICAg\nIGV2aWN0VHlwZXMoX2N0eC5nZXRVcGRhdGVkVHlwZXMoKSk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGFuZCBub3RpZnkgdGhlIHF1ZXJ5IGNh\nY2hlLiAgbm90aWZ5IGluIG9uZSBiYXRjaCB0byByZWR1Y2Ugc3luY2gKICAg\nICAgICAgICAgUXVlcnlDYWNoZSBxdWVyeUNhY2hlID0gX2N0eC5nZXRDb25m\naWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldERhdGFDYWNoZU1hbmFnZXJJ\nbnN0YW5jZSgpLmdldFN5c3RlbVF1ZXJ5Q2FjaGUoKTsKICAgICAgICAgICAg\naWYgKHF1ZXJ5Q2FjaGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQ29s\nbGVjdGlvbjxDbGFzczw/Pj4gcGVycyA9IF9jdHguZ2V0UGVyc2lzdGVkVHlw\nZXMoKTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IGRl\nbCA9IF9jdHguZ2V0RGVsZXRlZFR5cGVzKCk7CiAgICAgICAgICAgICAgICBD\nb2xsZWN0aW9uPENsYXNzPD8+PiB1cCA9IF9jdHguZ2V0VXBkYXRlZFR5cGVz\nKCk7CiAgICAgICAgICAgICAgICBpbnQgc2l6ZSA9IHBlcnMuc2l6ZSgpICsg\nZGVsLnNpemUoKSArIHVwLnNpemUoKTsKICAgICAgICAgICAgICAgIGlmIChz\naXplID4gMCkgewogICAgICAgICAgICAgICAgICAgIENvbGxlY3Rpb248Q2xh\nc3M8Pz4+IHR5cGVzID0gbmV3IEFycmF5TGlzdDxDbGFzczw/Pj4oc2l6ZSk7\nCiAgICAgICAgICAgICAgICAgICAgdHlwZXMuYWRkQWxsKHBlcnMpOwogICAg\nICAgICAgICAgICAgICAgIHR5cGVzLmFkZEFsbChkZWwpOwogICAgICAgICAg\nICAgICAgICAgIHR5cGVzLmFkZEFsbCh1cCk7CiAgICAgICAgICAgICAgICAg\nICAgcXVlcnlDYWNoZS5vblR5cGVzQ2hhbmdlZChuZXcgVHlwZXNDaGFuZ2Vk\nRXZlbnQodGhpcywgdHlwZXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSAKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFu\nc2Zvcm1zIGEgY29sbGVjdGlvbiBvZiB7QGxpbmsgUENEYXRhSG9sZGVyfXMg\ndGhhdCBtaWdodCBjb250YWluCiAgICAgKiBzdGFsZSBpbnN0YW5jZXMgaW50\nbyBhIGNvbGxlY3Rpb24gb2YgdXAtdG8tZGF0ZSB7QGxpbmsgRGF0YUNhY2hl\nUENEYXRhfXMuCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxEYXRhQ2FjaGVQ\nQ0RhdGE+IHRyYW5zZm9ybVRvVmVyc2lvblNhZmVQQ0RhdGFzKERhdGFDYWNo\nZSBjYWNoZSwgTGlzdDxQQ0RhdGFIb2xkZXI+IGhvbGRlcnMpIHsKICAgICAg\nICBMaXN0PERhdGFDYWNoZVBDRGF0YT4gdHJhbnNmb3JtZWQgPSBuZXcgQXJy\nYXlMaXN0PERhdGFDYWNoZVBDRGF0YT4oaG9sZGVycy5zaXplKCkpOwogICAg\nICAgIE1hcDxPYmplY3QsSW50ZWdlcj4gaWRzID0gbmV3IEhhc2hNYXA8T2Jq\nZWN0LEludGVnZXI+KGhvbGRlcnMuc2l6ZSgpKTsKICAgICAgICAvLyB0aGlz\nIGxpc3QgY291bGQgYmUgcmVtb3ZlZCBpZiBEYXRhQ2FjaGUuZ2V0QWxsKCkg\ndG9vayBhIENvbGxlY3Rpb24KICAgICAgICBMaXN0PE9iamVjdD4gaWRMaXN0\nID0gbmV3IEFycmF5TGlzdDxPYmplY3Q+KGhvbGRlcnMuc2l6ZSgpKTsKICAg\nICAgICBpbnQgaSA9IDA7CiAgICAgICAgZm9yIChQQ0RhdGFIb2xkZXIgaG9s\nZGVyIDogaG9sZGVycykgewogICAgICAgICAgICBpZHMucHV0KGhvbGRlci5z\nbS5nZXRPYmplY3RJZCgpLCBpKyspOwogICAgICAgICAgICBpZExpc3QuYWRk\nKGhvbGRlci5zbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICB9CgogICAgICAg\nIE1hcDxPYmplY3QsRGF0YUNhY2hlUENEYXRhPiBwY2RhdGFzID0gY2FjaGUu\nZ2V0QWxsKGlkTGlzdCk7CiAgICAgICAgZm9yIChFbnRyeTxPYmplY3QsRGF0\nYUNhY2hlUENEYXRhPiBlbnRyeSA6IHBjZGF0YXMuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICBJbnRlZ2VyIGluZGV4ID0gaWRzLmdldChlbnRyeS5nZXRL\nZXkoKSk7CiAgICAgICAgICAgIERhdGFDYWNoZVBDRGF0YSBvbGRwYyA9IGVu\ndHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgIFBDRGF0YUhvbGRlciBob2xk\nZXIgPSBob2xkZXJzLmdldChpbmRleCk7CiAgICAgICAgICAgIGlmIChvbGRw\nYyAhPSBudWxsICYmIGNvbXBhcmVWZXJzaW9uKGhvbGRlci5zbSwKICAgICAg\nICAgICAgICAgIGhvbGRlci5zbS5nZXRWZXJzaW9uKCksIG9sZHBjLmdldFZl\ncnNpb24oKSkgPT0gVkVSU0lPTl9FQVJMSUVSKQogICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRy\nYW5zZm9ybWVkLmFkZChob2xkZXIucGNkYXRhKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRyYW5zZm9ybWVkOwogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIGEge0BsaW5rIE1vZGlmaWNhdGlvbnN9IGluc3RhbmNlIHRvIHRy\nYWNrIG1vZGlmaWNhdGlvbnMKICAgICAqIHRvIHRoZSBnaXZlbiBjYWNoZSwg\nY3JlYXRpbmcgYW5kIGNhY2hpbmcgdGhlIGluc3RhbmNlIGlmIGl0IGRvZXMK\nICAgICAqIG5vdCBhbHJlYWR5IGV4aXN0IGluIHRoZSBnaXZlbiBtYXAuCiAg\nICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE1vZGlmaWNhdGlvbnMgZ2V0TW9k\naWZpY2F0aW9ucyhNYXA8RGF0YUNhY2hlLE1vZGlmaWNhdGlvbnM+IG1vZE1h\ncCwgRGF0YUNhY2hlIGNhY2hlKSB7CiAgICAgICAgTW9kaWZpY2F0aW9ucyBt\nb2RzID0gKE1vZGlmaWNhdGlvbnMpIG1vZE1hcC5nZXQoY2FjaGUpOwogICAg\nICAgIGlmIChtb2RzID09IG51bGwpIHsKICAgICAgICAgICAgbW9kcyA9IG5l\ndyBNb2RpZmljYXRpb25zKCk7CiAgICAgICAgICAgIG1vZE1hcC5wdXQoY2Fj\naGUsIG1vZHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kczsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBleGlzdHMoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgT2JqZWN0IGVkYXRhKSB7CiAgICAgICAgRGF0YUNhY2hlIGNh\nY2hlID0gX21nci5zZWxlY3RDYWNoZShzbSk7IAogICAgICAgIGlmIChjYWNo\nZSAhPSBudWxsICYmICFpc0xvY2tpbmcobnVsbCkKICAgICAgICAgICAgJiYg\nY2FjaGUuY29udGFpbnMoc20uZ2V0T2JqZWN0SWQoKSkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBzdXBlci5leGlzdHMoc20s\nIGVkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBzeW5jVmVyc2lv\nbihPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtLCBPYmplY3QgZWRhdGEpIHsKICAg\nICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLnNlbGVjdENhY2hlKHNtKTsK\nICAgICAgICBpZiAoY2FjaGUgPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBzdXBlci5zeW5jVmVyc2lvbihzbSwgZWRh\ndGEpOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YTsKICAgICAgICBP\nYmplY3QgdmVyc2lvbiA9IG51bGw7CiAgICAgICAgZGF0YSA9IGNhY2hlLmdl\ndChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAoIWlzTG9ja2luZyhu\ndWxsKSAmJiBkYXRhICE9IG51bGwpCiAgICAgICAgICAgIHZlcnNpb24gPSBk\nYXRhLmdldFZlcnNpb24oKTsKCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBhIGNh\nY2hlZCB2ZXJzaW9uIHVwZGF0ZSBmcm9tIHRoZXJlCiAgICAgICAgaWYgKHZl\ncnNpb24gIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIXZlcnNpb24uZXF1\nYWxzKHNtLmdldFZlcnNpb24oKSkpIHsKICAgICAgICAgICAgICAgIHNtLnNl\ndFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQoKICAgICAgICAvLyB1c2UgZGF0YSBzdG9yZSB2ZXJzaW9uCiAg\nICAgICAgcmV0dXJuIHN1cGVyLnN5bmNWZXJzaW9uKHNtLCBlZGF0YSk7CiAg\nICB9CgogICAgcHVibGljIGJvb2xlYW4gaW5pdGlhbGl6ZShPcGVuSlBBU3Rh\ndGVNYW5hZ2VyIHNtLCBQQ1N0YXRlIHN0YXRlLCBGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgICAgIGJvb2xlYW4gZnJv\nbURhdGFiYXNlOyAKICAgICAgICBEYXRhQ2FjaGUgY2FjaGUgPSBfbWdyLnNl\nbGVjdENhY2hlKHNtKTsKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9\nIG51bGw7CiAgICAgICAgYm9vbGVhbiB1cGRhdGVDYWNoZSA9IF9jdHguZ2V0\nRmV0Y2hDb25maWd1cmF0aW9uKCkuZ2V0Q2FjaGVSZXRyaWV2ZU1vZGUoKSAh\nPSBEYXRhQ2FjaGVSZXRyaWV2ZU1vZGUuQllQQVNTCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAmJiBfY3R4LmdldFBvcHVsYXRlRGF0YUNhY2hlKCk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRlZCgp\nIAogICAgICAgICAgICB8fCBfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigp\nLmdldENhY2hlUmV0cmlldmVNb2RlKCkgPT0gRGF0YUNhY2hlUmV0cmlldmVN\nb2RlLkJZUEFTUwogICAgICAgICAgICB8fCBfY3R4LmdldEZldGNoQ29uZmln\ndXJhdGlvbigpLmdldENhY2hlU3RvcmVNb2RlKCkgPT0gRGF0YUNhY2hlU3Rv\ncmVNb2RlLlJFRlJFU0gpIHsKICAgICAgICAgICAgZnJvbURhdGFiYXNlID0g\nc3VwZXIuaW5pdGlhbGl6ZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChz\nbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVs\nbCAmJiAhaXNMb2NraW5nKGZldGNoKSkgeyAgICAgICAgICAgICAgICAKICAg\nICAgICAgICAgICAgIC8vIyMjIHRoZSAnZGF0YS50eXBlJyBhY2Nlc3MgaGVy\nZSBwcm9iYWJseSBuZWVkcyB0byBiZQogICAgICAgICAgICAgICAgLy8jIyMg\nYWRkcmVzc2VkIGZvciBidWcgNTExCiAgICAgICAgICAgICAgICBzbS5pbml0\naWFsaXplKGRhdGEuZ2V0VHlwZSgpLCBzdGF0ZSk7CiAgICAgICAgICAgICAg\nICBkYXRhLmxvYWQoc20sIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgICAg\nICAvLyBubyBuZWVkIHRvIHVwZGF0ZSB0aGUgY2FjaGUuIAogICAgICAgICAg\nICAgICAgdXBkYXRlQ2FjaGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGZy\nb21EYXRhYmFzZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAvLyBpbml0aWFsaXplIGZyb20gc3RvcmUgbWFuYWdlcgog\nICAgICAgICAgICAgICAgZnJvbURhdGFiYXNlID0gc3VwZXIuaW5pdGlhbGl6\nZShzbSwgc3RhdGUsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGlmIChjYWNoZSAhPSBudWxsICYmIChmcm9tRGF0\nYWJhc2UgJiYgdXBkYXRlQ2FjaGUpKSB7CiAgICAgICAgICAgIC8vIHVwZGF0\nZSBjYWNoZSBpZiB0aGUgcmVzdWx0IGNhbWUgZnJvbSB0aGUgZGF0YWJhc2Ug\nYW5kIGNvbmZpZ3VyZWQgdG8gc3RvcmUgb3IgcmVmcmVzaCB0aGUgY2FjaGUu\nCiAgICAgICAgICAgIGNhY2hlU3RhdGVNYW5hZ2VyKGNhY2hlLCBzbSwgZGF0\nYSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmcm9tRGF0YWJhc2U7CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBjYWNoZVN0YXRlTWFuYWdlcihE\nYXRhQ2FjaGUgY2FjaGUsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIERhdGFD\nYWNoZVBDRGF0YSBkYXRhKSB7CiAgICAgICAgaWYgKHNtLmlzRmx1c2hlZCgp\nKSB7IAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8v\nIG1ha2Ugc3VyZSB0aGF0IHdlJ3JlIG5vdCB0cnlpbmcgdG8gY2FjaGUgYW4g\nb2xkIHZlcnNpb24KICAgICAgICBjYWNoZS53cml0ZUxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGNvbXBh\ncmVWZXJzaW9uKHNtLCBzbS5nZXRWZXJzaW9uKCksIGRhdGEuZ2V0VmVyc2lv\nbigpKSA9PSBWRVJTSU9OX0VBUkxJRVIpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2FjaGUgbmV3\nbHkgbG9hZGVkIGluZm8uIEl0IGlzIHNhZmUgdG8gY2FjaGUgZGF0YSBmcm9y\nbQogICAgICAgICAgICAvLyBpbml0aWFsaXplKCkgYmVjYXVzZSB0aGlzIG1l\ndGhvZCBpcyBvbmx5IGNhbGxlZCB1cG9uCiAgICAgICAgICAgIC8vIGluaXRp\nYWwgbG9hZCBvZiB0aGUgZGF0YS4KICAgICAgICAgICAgYm9vbGVhbiBpc05l\ndyA9IGRhdGEgPT0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzTmV3KSB7CiAg\nICAgICAgICAgICAgICBkYXRhID0gbmV3UENEYXRhKHNtKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBkYXRhLnN0b3JlKHNtKTsKICAgICAgICAgICAg\naWYgKGlzTmV3KSB7IAogICAgICAgICAgICAgICAgY2FjaGUucHV0KGRhdGEp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2FjaGUu\ndXBkYXRlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gbG9hZChPcGVuSlBBU3RhdGVN\nYW5hZ2VyIHNtLCBCaXRTZXQgZmllbGRzLAogICAgICAgIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgaW50IGxvY2tMZXZlbCwgT2JqZWN0IGVkYXRhKSB7\nCiAgICAgICAgRGF0YUNhY2hlIGNhY2hlID0gX21nci5zZWxlY3RDYWNoZShz\nbSk7CiAgICAgICAgaWYgKGNhY2hlID09IG51bGwgfHwgc20uaXNFbWJlZGRl\nZCgpIHx8IGJ5cGFzcyhfY3R4LmdldEZldGNoQ29uZmlndXJhdGlvbigpLCBT\ndG9yZU1hbmFnZXIuRk9SQ0VfTE9BRF9OT05FKSkKICAgICAgICAgICAgcmV0\ndXJuIHN1cGVyLmxvYWQoc20sIGZpZWxkcywgZmV0Y2gsIGxvY2tMZXZlbCwg\nZWRhdGEpOwoKICAgICAgICBEYXRhQ2FjaGVQQ0RhdGEgZGF0YSA9IGNhY2hl\nLmdldChzbS5nZXRPYmplY3RJZCgpKTsKICAgICAgICBpZiAobG9ja0xldmVs\nID09IExvY2tMZXZlbHMuTE9DS19OT05FICYmICFpc0xvY2tpbmcoZmV0Y2gp\nICYmIGRhdGEgIT0gbnVsbCkKICAgICAgICAgICAgZGF0YS5sb2FkKHNtLCBm\naWVsZHMsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgaWYgKGZpZWxkcy5sZW5n\ndGgoKSA9PSAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAg\nLy8gbG9hZCBmcm9tIHN0b3JlIG1hbmFnZXI7IGNsb25lIHRoZSBzZXQgb2Yg\nc3RpbGwtdW5sb2FkZWQgZmllbGRzCiAgICAgICAgLy8gc28gdGhhdCBpZiB0\naGUgc3RvcmUgbWFuYWdlciBkZWNpZGVzIHRvIG1vZGlmeSBpdCBpdCB3b24n\ndCBhZmZlY3QgdXMKICAgICAgICBpZiAoIXN1cGVyLmxvYWQoc20sIChCaXRT\nZXQpIGZpZWxkcy5jbG9uZSgpLCBmZXRjaCwgbG9ja0xldmVsLCBlZGF0YSkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoX2N0eC5n\nZXRQb3B1bGF0ZURhdGFDYWNoZSgpKSB7CiAgICAgICAgICAgIGNhY2hlU3Rh\ndGVNYW5hZ2VyKGNhY2hlLCBzbSwgZGF0YSk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxP\nYmplY3Q+IGxvYWRBbGwoQ29sbGVjdGlvbjxPcGVuSlBBU3RhdGVNYW5hZ2Vy\nPiBzbXMsIFBDU3RhdGUgc3RhdGUsIGludCBsb2FkLAogICAgCQlGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgCWlmIChi\neXBhc3MoZmV0Y2gsIGxvYWQpKSB7CiAgICAJICAgIHJldHVybiBzdXBlci5s\nb2FkQWxsKHNtcywgc3RhdGUsIGxvYWQsIGZldGNoLCBlZGF0YSk7CiAgICAJ\nfQoKICAgICAgICBNYXA8T3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0PiB1\nbmxvYWRlZCA9IG51bGw7CiAgICAgICAgTGlzdDxPcGVuSlBBU3RhdGVNYW5h\nZ2VyPiBzbUxpc3QgPSBudWxsOwogICAgICAgIE1hcDxEYXRhQ2FjaGUsTGlz\ndDxPcGVuSlBBU3RhdGVNYW5hZ2VyPj4gY2FjaGVzID0gbmV3IEhhc2hNYXA8\nRGF0YUNhY2hlLExpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4+KCk7CiAgICAg\nICAgRGF0YUNhY2hlIGNhY2hlOwogICAgICAgIERhdGFDYWNoZVBDRGF0YSBk\nYXRhOwogICAgICAgIEJpdFNldCBmaWVsZHM7CgogICAgICAgIGZvciAoT3Bl\nbkpQQVN0YXRlTWFuYWdlciBzbSA6IHNtcykgewogICAgICAgICAgICBjYWNo\nZSA9IF9tZ3Iuc2VsZWN0Q2FjaGUoc20pOwogICAgICAgICAgICBpZiAoY2Fj\naGUgPT0gbnVsbCB8fCBzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAg\nICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51bGwsIHVubG9hZGVk\nKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkgPT0gbnVs\nbAogICAgICAgICAgICAgICAgfHwgbG9hZCAhPSBGT1JDRV9MT0FEX05PTkUK\nICAgICAgICAgICAgICAgIHx8IHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRl\nLkhPTExPVykgewogICAgICAgICAgICAgICAgc21MaXN0ID0gY2FjaGVzLmdl\ndChjYWNoZSk7CiAgICAgICAgICAgICAgICBpZiAoc21MaXN0ID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBzbUxpc3QgPSBuZXcgQXJyYXlMaXN0\nPE9wZW5KUEFTdGF0ZU1hbmFnZXI+KCk7CiAgICAgICAgICAgICAgICAgICAg\nY2FjaGVzLnB1dChjYWNoZSwgc21MaXN0KTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHNtTGlzdC5hZGQoc20pOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKCFjYWNoZS5jb250YWlucyhzbS5nZXRPYmplY3RJZCgpKSkK\nICAgICAgICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20sIG51\nbGwsIHVubG9hZGVkKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZm9y\nIChJdGVyYXRvcjxEYXRhQ2FjaGU+IGl0ciA9IGNhY2hlcy5rZXlTZXQoKS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBjYWNo\nZSA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgIHNtTGlzdCA9IGNhY2hlcy5n\nZXQoY2FjaGUpOwogICAgICAgICAgICBMaXN0PE9iamVjdD4gb2lkTGlzdCA9\nIG5ldyBBcnJheUxpc3Q8T2JqZWN0PihzbUxpc3Quc2l6ZSgpKTsKCiAgICAg\nICAgICAgIGZvciAoT3BlbkpQQVN0YXRlTWFuYWdlciBzbSA6IHNtTGlzdCkg\newogICAgICAgICAgICAgICAgb2lkTGlzdC5hZGQoKE9wZW5KUEFJZCkgc20u\nZ2V0T2JqZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAg\nICAgICAgICAgIE1hcDxPYmplY3QsRGF0YUNhY2hlUENEYXRhPiBkYXRhTWFw\nID0gY2FjaGUuZ2V0QWxsKG9pZExpc3QpOwoKICAgICAgICAgICAgZm9yIChP\ncGVuSlBBU3RhdGVNYW5hZ2VyIHNtIDogc21MaXN0KSB7CiAgICAgICAgICAg\nICAgICBkYXRhID0gZGF0YU1hcC5nZXQoc20uZ2V0T2JqZWN0SWQoKSk7Cgog\nICAgICAgICAgICAgICAgaWYgKHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIyMjIHRoZSAnZGF0YS50\neXBlJyBhY2Nlc3MgaGVyZSBwcm9iYWJseSBuZWVkcwogICAgICAgICAgICAg\nICAgICAgICAgICAvLyMjIyB0byBiZSBhZGRyZXNzZWQgZm9yIGJ1ZyA1MTEK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uaW5pdGlhbGl6ZShkYXRhLmdl\ndFR5cGUoKSwgc3RhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBkYXRh\nLmxvYWQoc20sIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5sb2FkZWQgPSBh\nZGRVbmxvYWRlZChzbSwgbnVsbCwgdW5sb2FkZWQpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobG9hZCAhPSBG\nT1JDRV9MT0FEX05PTkUKICAgICAgICAgICAgICAgICAgICAgICAgfHwgc20u\nZ2V0UENTdGF0ZSgpID09IFBDU3RhdGUuSE9MTE9XKSB7CiAgICAgICAgICAg\nICAgICAgICAgZGF0YSA9IGNhY2hlLmdldChzbS5nZXRPYmplY3RJZCgpKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIGxvYWQgdW5sb2FkZWQgZmllbGRzCiAg\nICAgICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IHNtLmdldFVubG9hZGVk\nKGZldGNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5sb2FkKHNt\nLCBmaWVsZHMsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChmaWVsZHMubGVuZ3RoKCkgPiAwKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdW5sb2FkZWQgPSBhZGRVbmxvYWRlZChzbSwgZmllbGRz\nLCB1bmxvYWRlZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAg\nICAgICAgICAgICAgICAgICAgIHVubG9hZGVkID0gYWRkVW5sb2FkZWQoc20s\nIG51bGwsIHVubG9hZGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHVubG9hZGVkID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsK\nCiAgICAgICAgLy8gbG9hZCB3aXRoIGRlbGVnYXRlCiAgICAgICAgQ29sbGVj\ndGlvbjxPYmplY3Q+IGZhaWxlZCA9IHN1cGVyLmxvYWRBbGwodW5sb2FkZWQu\na2V5U2V0KCksIHN0YXRlLCBsb2FkLCBmZXRjaCwgZWRhdGEpOwogICAgICAg\nIGlmICghX2N0eC5nZXRQb3B1bGF0ZURhdGFDYWNoZSgpKQogICAgICAgICAg\nICByZXR1cm4gZmFpbGVkOwoKICAgICAgICAvLyBmb3IgZWFjaCBsb2FkZWQg\naW5zdGFuY2UsIG1lcmdlIGxvYWRlZCBzdGF0ZSBpbnRvIGNhY2hlZCBkYXRh\nCgogICAgICAgIGJvb2xlYW4gaXNOZXc7CgogICAgICAgIGZvcihNYXAuRW50\ncnk8T3BlbkpQQVN0YXRlTWFuYWdlciwgQml0U2V0PiBlbnRyeSA6IHVubG9h\nZGVkLmVudHJ5U2V0KCkpIHsgCiAgICAgICAgICAgIE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20gPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgZmllbGRz\nID0gZW50cnkuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAgIGNhY2hlID0gX21n\nci5zZWxlY3RDYWNoZShzbSk7CiAgICAgICAgICAgIGlmIChjYWNoZSA9PSBu\ndWxsIHx8IHNtLmlzRW1iZWRkZWQoKSB8fCAoZmFpbGVkICE9IG51bGwKICAg\nICAgICAgICAgICAgICYmIGZhaWxlZC5jb250YWlucyhzbS5nZXRJZCgpKSkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSB0aGF0IHdlJ3JlIG5vdCB0cnlpbmcgdG8gY2FjaGUgYW4gb2xk\nIHZlcnNpb24KICAgICAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkYXRhID0gY2FjaGUuZ2V0\nKHNtLmdldE9iamVjdElkKCkpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEg\nIT0gbnVsbCAmJiBjb21wYXJlVmVyc2lvbihzbSwgc20uZ2V0VmVyc2lvbigp\nLAogICAgICAgICAgICAgICAgICAgIGRhdGEuZ2V0VmVyc2lvbigpKSA9PSBW\nRVJTSU9OX0VBUkxJRVIpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCgogICAgICAgICAgICAgICAgaXNOZXcgPSBkYXRhID09IG51bGw7CiAgICAg\nICAgICAgICAgICBpZiAoaXNOZXcpCiAgICAgICAgICAgICAgICAgICAgZGF0\nYSA9IG5ld1BDRGF0YShzbSk7CiAgICAgICAgICAgICAgICBpZiAoZmllbGRz\nID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdG9yZShzbSk7\nCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZGF0\nYS5zdG9yZShzbSwgZmllbGRzKTsKICAgICAgICAgICAgICAgIGlmIChpc05l\ndykKICAgICAgICAgICAgICAgICAgICBjYWNoZS5wdXQoZGF0YSk7CiAgICAg\nICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2FjaGUudXBk\nYXRlKGRhdGEpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgY2FjaGUud3JpdGVVbmxvY2soKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFpbGVkOwogICAgfQogICAgCiAgICAv\nKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gYWRkIGFuIHVubG9hZGVkIGlu\nc3RhbmNlIHRvIHRoZSBnaXZlbiBtYXAuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIE1hcDxPcGVuSlBBU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+IGFkZFVu\nbG9hZGVkKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20sIEJpdFNldCBmaWVsZHMs\nCiAgICAgICAgTWFwPE9wZW5KUEFTdGF0ZU1hbmFnZXIsIEJpdFNldD4gdW5s\nb2FkZWQpIHsKICAgICAgICBpZiAodW5sb2FkZWQgPT0gbnVsbCkKICAgICAg\nICAgICAgdW5sb2FkZWQgPSBuZXcgSGFzaE1hcDxPcGVuSlBBU3RhdGVNYW5h\nZ2VyLCBCaXRTZXQ+KCk7CiAgICAgICAgdW5sb2FkZWQucHV0KHNtLCBmaWVs\nZHMpOwogICAgICAgIHJldHVybiB1bmxvYWRlZDsKICAgIH0KCiAgICBwdWJs\naWMgQ29sbGVjdGlvbjxFeGNlcHRpb24+IGZsdXNoKENvbGxlY3Rpb248T3Bl\nbkpQQVN0YXRlTWFuYWdlcj4gc3RhdGVzKSB7CiAgICAgICAgQ29sbGVjdGlv\nbjxFeGNlcHRpb24+IGV4Y2VwcyA9IHN1cGVyLmZsdXNoKHN0YXRlcyk7Cgog\nICAgICAgIC8vIGlmIHRoZXJlIHdlcmUgZXJyb3JzIGV2aWN0IGJhZCBpbnN0\nYW5jZXMgYW5kIGRvbid0IHJlY29yZCBjaGFuZ2VzCiAgICAgICAgaWYgKCFl\neGNlcHMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGZvciAoRXhjZXB0aW9u\nIGUgOiBleGNlcHMpIHsKICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNl\nb2YgT3B0aW1pc3RpY0V4Y2VwdGlvbikKICAgICAgICAgICAgICAgICAgICBu\nb3RpZnlPcHRpbWlzdGljTG9ja0ZhaWx1cmUoKE9wdGltaXN0aWNFeGNlcHRp\nb24pIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBleGNl\ncHM7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBsYXJnZSB0cmFuc2FjdGlv\nbiBtb2RlIGRvbid0IHJlY29yZCBpbmRpdmlkdWFsIGNoYW5nZXMKICAgICAg\nICBpZiAoX2N0eC5pc1RyYWNrQ2hhbmdlc0J5VHlwZSgpKQogICAgICAgICAg\nICByZXR1cm4gZXhjZXBzOwoKICAgICAgICBmb3IgKE9wZW5KUEFTdGF0ZU1h\nbmFnZXIgc20gOiBzdGF0ZXMpIHsKICAgICAgICAgICAgaWYgKHNtLmdldFBD\nU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVcgJiYgIXNtLmlzRmx1c2hlZCgpKSB7\nCiAgICAgICAgICAgICAgICBpZiAoX2luc2VydHMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIF9pbnNlcnRzID0gbmV3IEFycmF5TGlzdDxPcGVu\nSlBBU3RhdGVNYW5hZ2VyPigpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgX2luc2VydHMuYWRkKHNtKTsKCiAgICAgICAgICAgICAgICAv\nLyBtYXkgaGF2ZSBiZWVuIHJlLXBlcnNpc3RlZAogICAgICAgICAgICAgICAg\naWYgKF9kZWxldGVzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBf\nZGVsZXRlcy5yZW1vdmUoc20pOyAKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSBlbHNlIGlmIChfaW5zZXJ0cyAhPSBudWxsIAogICAgICAgICAg\nICAgICAgJiYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVdERUxF\nVEVEIAogICAgICAgICAgICAgICAgfHwgc20uZ2V0UENTdGF0ZSgpID09IFBD\nU3RhdGUuUE5FV0ZMVVNIRURERUxFVEVEKSkgewogICAgICAgICAgICAgICAg\nX2luc2VydHMucmVtb3ZlKHNtKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBlbHNlIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5QRElSVFkp\nIHsKICAgICAgICAgICAgICAgIGlmIChfdXBkYXRlcyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgX3VwZGF0ZXMgPSBuZXcgSGFzaE1hcDxPcGVu\nSlBBU3RhdGVNYW5hZ2VyLCBCaXRTZXQ+KCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBfdXBkYXRlcy5wdXQoc20sIHNtLmdldERpcnR5\nKCkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNtLmdldFBDU3RhdGUoKSA9\nPSBQQ1N0YXRlLlBERUxFVEVEKSB7CiAgICAgICAgICAgICAgICBpZiAoX2Rl\nbGV0ZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIF9kZWxldGVz\nID0gbmV3IEhhc2hTZXQ8T3BlbkpQQVN0YXRlTWFuYWdlcj4oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9kZWxldGVzLmFkZChzbSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIENvbGxl\nY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgfQoKICAgIC8qKgogICAgICogRmly\nZSBsb2NhbCBzdGFsZW5lc3MgZGV0ZWN0aW9uIGV2ZW50cyBmcm9tIHRoZSBj\nYWNoZSB0aGUgT0lEIChpZgogICAgICogYXZhaWxhYmxlKSB0aGF0IHJlc3Vs\ndGVkIGluIGFuIG9wdGltaXN0aWMgbG9jayBleGNlcHRpb24gaWZmIHRoZQog\nICAgICogdmVyc2lvbiBpbmZvcm1hdGlvbiBpbiB0aGUgY2FjaGUgbWF0Y2hl\ncyB0aGUgdmVyc2lvbiBpbmZvcm1hdGlvbgogICAgICogaW4gdGhlIHN0YXRl\nIG1hbmFnZXIgZm9yIHRoZSBmYWlsZWQgaW5zdGFuY2UuIFRoaXMgbWVhbnMg\ndGhhdCB3ZQogICAgICogd2lsbCBldmljdCBkYXRhIGZyb20gdGhlIGNhY2hl\nIGZvciByZWNvcmRzIHRoYXQgc2hvdWxkIGhhdmUKICAgICAqIHN1Y2Nlc3Nm\ndWxseSBjb21taXR0ZWQgYWNjb3JkaW5nIHRvIHRoZSBkYXRhIGNhY2hlIGJ1\ndAogICAgICogZGlkIG5vdC4gVGhlIG9ubHkgcHJlZGljdGFibGUgcmVhc29u\nIHRoYXQgY291bGQgY2F1c2UgdGhpcyBiZWhhdmlvcgogICAgICogaXMgYSBj\nb25jdXJyZW50IG91dC1vZi1iYW5kIG1vZGlmaWNhdGlvbiB0byB0aGUgZGF0\nYWJhc2UgdGhhdCB3YXMgbm90IAogICAgICogY29tbXVuaWNhdGVkIHRvIHRo\nZSBjYWNoZS4gVGhpcyBsb2dpYyBtYWtlcyBPcGVuSlBBJ3MgZGF0YSBjYWNo\nZSAKICAgICAqIHNvbWV3aGF0IHRvbGVyYW50IG9mIHN1Y2ggYmVoYXZpb3Is\nIGluIHRoYXQgdGhlIGNhY2hlIHdpbGwgYmUgY2xlYW5lZCAKICAgICAqIHVw\nIGFzIGZhaWx1cmVzIG9jY3VyLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nbm90aWZ5T3B0aW1pc3RpY0xvY2tGYWlsdXJlKE9wdGltaXN0aWNFeGNlcHRp\nb24gZSkgewogICAgICAgIE9iamVjdCBvID0gZS5nZXRGYWlsZWRPYmplY3Qo\nKTsKICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gX2N0eC5nZXRT\ndGF0ZU1hbmFnZXIobyk7CiAgICAgICAgaWYgKHNtID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICBPYmplY3Qgb2lkID0gc20uZ2V0SWQo\nKTsKICAgICAgICBib29sZWFuIHJlbW92ZTsKCiAgICAgICAgLy8gdGhpcyBs\nb2dpYyBjb3VsZCBiZSBtb3JlIGVmZmljaWVudCAtLSB3ZSBjb3VsZCBhZ2dy\nZWdhdGUKICAgICAgICAvLyBhbGwgdGhlIGNhY2hlLT5vaWQgY2hhbmdlcywg\nYW5kIHRoZW4gdXNlIERhdGFDYWNoZS5yZW1vdmVBbGwoKSAKICAgICAgICAv\nLyBhbmQgbGVzcyB3cml0ZSBsb2NrcyB0byBkbyB0aGUgbXV0YXRpb24uCiAg\nICAgICAgRGF0YUNhY2hlIGNhY2hlID0gX21nci5zZWxlY3RDYWNoZShzbSk7\nCiAgICAgICAgaWYgKGNhY2hlID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbjsKCiAgICAgICAgY2FjaGUud3JpdGVMb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgRGF0YUNhY2hlUENEYXRhIGRhdGEgPSBjYWNoZS5nZXQo\nb2lkKTsKICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHN3aXRjaCAoY29tcGFyZVZl\ncnNpb24oc20sIHNtLmdldFZlcnNpb24oKSwgZGF0YS5nZXRWZXJzaW9uKCkp\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIFN0b3JlTWFuYWdlci5WRVJTSU9O\nX0xBVEVSOgogICAgICAgICAgICAgICAgY2FzZSBTdG9yZU1hbmFnZXIuVkVS\nU0lPTl9TQU1FOgogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgdHgncyBj\ndXJyZW50IHZlcnNpb24gaXMgbGF0ZXIgdGhhbiBvciB0aGUgc2FtZSBhcyAK\nICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZGF0YSBjYWNoZSB2ZXJzaW9u\nLiBJbiB0aGlzIGNhc2UsIHRoZSBjb21taXQgc2hvdWxkIAogICAgICAgICAg\nICAgICAgICAgIC8vIGhhdmUgc3VjY2VlZGVkIGZyb20gdGhlIHN0YW5kcG9p\nbnQgb2YgdGhlIGNhY2hlLiBSZW1vdmUgCiAgICAgICAgICAgICAgICAgICAg\nLy8gdGhlIGluc3RhbmNlIGZyb20gY2FjaGUgaW4gdGhlIGhvcGVzIHRoYXQg\ndGhlIGNhY2hlIGlzIAogICAgICAgICAgICAgICAgICAgIC8vIG91dCBvZiBz\neW5jLgogICAgICAgICAgICAgICAgICAgIHJlbW92ZSA9IHRydWU7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFN0\nb3JlTWFuYWdlci5WRVJTSU9OX0VBUkxJRVI6CiAgICAgICAgICAgICAgICAg\nICAgLy8gVGhpcyB0eCdzIGN1cnJlbnQgdmVyc2lvbiBpcyBlYXJsaWVyIHRo\nYW4gdGhlIGRhdGEgCiAgICAgICAgICAgICAgICAgICAgLy8gY2FjaGUgdmVy\nc2lvbi4gVGhpcyBpcyBhIG5vcm1hbCBvcHRpbWlzdGljIGxvY2sgZmFpbHVy\nZS4gCiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGNsZWFuIHVwIHRo\nZSBjYWNoZTsgaXQgcHJvYmFibHkgYWxyZWFkeSBoYXMgdGhlIAogICAgICAg\nICAgICAgICAgICAgIC8vIHJpZ2h0IHZhbHVlcywgYW5kIGlmIG5vdCwgaXQn\nbGwgZ2V0IGNsZWFuZWQgdXAgYnkgYSB0eAogICAgICAgICAgICAgICAgICAg\nIC8vIHRoYXQgZmFpbHMgaW4gb25lIG9mIHRoZSBvdGhlciBjYXNlIHN0YXRl\nbWVudHMuCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlID0gZmFsc2U7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIFN0b3JlTWFuYWdlci5WRVJTSU9OX0RJRkZFUkVOVDoKICAgICAgICAgICAg\nICAgICAgICAvLyBUaGUgdmVyc2lvbiBzdHJhdGVneSBmb3IgdGhlIGZhaWxl\nZCBvYmplY3QgZG9lcyBub3QKICAgICAgICAgICAgICAgICAgICAvLyBzdG9y\nZSBlbm91Z2ggaW5mb3JtYXRpb24gdG8gb3B0aW1pemUgZm9yIGV4cGVjdGVk\nCiAgICAgICAgICAgICAgICAgICAgLy8gZmFpbHVyZXMuIENsZWFuIHVwIHRo\nZSBjYWNoZS4KICAgICAgICAgICAgICAgICAgICByZW1vdmUgPSB0cnVlOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgICAgICAgICAvLyBVbmV4cGVjdGVkIHJldHVy\nbiB2YWx1ZS4gUmVtb3ZlIHRvIGJlIGZ1dHVyZS1wcm9vZi4KICAgICAgICAg\nICAgICAgICAgICByZW1vdmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZW1vdmUp\nCiAgICAgICAgICAgICAgICAvLyByZW1vdmUgZGlyZWN0bHkgaW5zdGVhZCBv\nZiB2aWEgdGhlIFJlbW90ZUNvbW1pdExpc3RlbmVyCiAgICAgICAgICAgICAg\nICAvLyBzaW5jZSB3ZSBoYXZlIGEgd3JpdGUgbG9jayBoZXJlIGFscmVhZHks\nIHNvIHRoaXMgaXMgbW9yZQogICAgICAgICAgICAgICAgLy8gZWZmaWNpZW50\nIHRoYW4gcmVhZC1sb2NraW5nIGFuZCB0aGVuIHdyaXRlLWxvY2tpbmcgbGF0\nZXIuCiAgICAgICAgICAgICAgICBjYWNoZS5yZW1vdmUoc20uZ2V0SWQoKSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgY2FjaGUud3JpdGVV\nbmxvY2soKTsKICAgICAgICB9CgogICAgICAgIC8vIGZpcmUgb2ZmIGEgcmVt\nb3RlIGNvbW1pdCBzdGFsZW5lc3NzIGRldGVjdGlvbiBldmVudC4KICAgICAg\nICBfY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRSZW1vdGVDb21taXRFdmVu\ndE1hbmFnZXIoKQogICAgICAgICAgICAuZmlyZUxvY2FsU3RhbGVOb3RpZmlj\nYXRpb24ob2lkKTsKICAgIH0KCiAgICBwdWJsaWMgU3RvcmVRdWVyeSBuZXdR\ndWVyeShTdHJpbmcgbGFuZ3VhZ2UpIHsKICAgICAgICBTdG9yZVF1ZXJ5IHEg\nPSBzdXBlci5uZXdRdWVyeShsYW5ndWFnZSk7CgogICAgICAgIC8vIGlmIHRo\nZSBxdWVyeSBjYW4ndCBiZSBwYXJzZWQgb3IgaXQncyB1c2luZyBhIG5vbi1w\nYXJzZWQgbGFuZ3VhZ2UKICAgICAgICAvLyAob25lIGZvciB3aGljaCB0aGVy\nZSBpcyBubyBFeHByZXNzaW9uUGFyc2VyKSwgd2UgY2FuJ3QgY2FjaGUgaXQu\nCiAgICAgICAgaWYgKHEgPT0gbnVsbCB8fCBRdWVyeUxhbmd1YWdlcy5wYXJz\nZXJGb3JMYW5ndWFnZShsYW5ndWFnZSkgPT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIHE7CgogICAgICAgIFF1ZXJ5Q2FjaGUgcXVlcnlDYWNoZSA9IF9j\ndHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXREYXRhQ2Fj\naGVNYW5hZ2VySW5zdGFuY2UoKS5nZXRTeXN0ZW1RdWVyeUNhY2hlKCk7CiAg\nICAgICAgaWYgKHF1ZXJ5Q2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHE7CgogICAgICAgIHJldHVybiBuZXcgUXVlcnlDYWNoZVN0b3JlUXVl\ncnkocSwgcXVlcnlDYWNoZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBuZXcgY2FjaGVhYmxlIGluc3RhbmNlIGZvciB0aGUgZ2l2ZW4gc3Rh\ndGUgbWFuYWdlci4KICAgICAqLwogICAgcHJpdmF0ZSBEYXRhQ2FjaGVQQ0Rh\ndGEgbmV3UENEYXRhKE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAg\nICBDbGFzc01ldGFEYXRhIG1ldGEgPSBzbS5nZXRNZXRhRGF0YSgpOwogICAg\nICAgIGlmIChfZ2VuICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiAoRGF0\nYUNhY2hlUENEYXRhKSBfZ2VuLmdlbmVyYXRlUENEYXRhKHNtLmdldE9iamVj\ndElkKCksIG1ldGEpOwogICAgICAgIHJldHVybiBuZXcgRGF0YUNhY2hlUENE\nYXRhSW1wbChzbS5mZXRjaE9iamVjdElkKCksIG1ldGEsIF9tZ3Iuc2VsZWN0\nQ2FjaGUoc20pLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZmZpcm1zIGlmIGEgbG9hZCBvcGVyYXRpb24gbXVzdCBieXBhc3MgdGhlIEwy\nIGNhY2hlLgogICAgICogSWYgbG9jayBpcyBhY3RpdmUsIGFsd2F5cyBieXBh\nc3MuCiAgICAgKiAKICAgICAqLwogICAgYm9vbGVhbiBieXBhc3MoRmV0Y2hD\nb25maWd1cmF0aW9uIGZldGNoLCBpbnQgbG9hZCkgewogICAgICAgIC8vIE9y\nZGVyIG9mIGNoZWNrcyBhcmUgaW1wb3J0YW50CiAgICAgICAgaWYgKGlzTG9j\na2luZyhmZXRjaCkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIGlmIChfY3R4LmdldENvbmZpZ3VyYXRpb24oKS5nZXRSZWZyZXNoRnJvbURh\ndGFDYWNoZSgpKSAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIGlmIChmZXRjaC5nZXRDYWNoZVJldHJpZXZlTW9kZSgpID09IERhdGFDYWNo\nZVJldHJpZXZlTW9kZS5CWVBBU1MpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIGlmIChsb2FkID09IFN0b3JlTWFuYWdlci5GT1JDRV9MT0FE\nX1JFRlJFU0gpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHRoZSBjb250ZXh0IGlzIGxvY2tpbmcgbG9hZGVkIGRhdGEuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0xvY2tpbmcoRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAg\nICAgICAgICAgIGZldGNoID0gX2N0eC5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICByZXR1cm4gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpID4g\nTG9ja0xldmVscy5MT0NLX05PTkU7CiAgICB9ICAKICAgIAogICAgLyoqCiAg\nICAgKiBTdHJ1Y3R1cmUgdXNlZCBkdXJpbmcgdGhlIGNvbW1pdCBwcm9jZXNz\nIHRvIHRyYWNrIGNhY2hlIG1vZGlmaWNhdGlvbnMuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIE1vZGlmaWNhdGlvbnMgewoKICAgICAgICBw\ndWJsaWMgZmluYWwgTGlzdDxQQ0RhdGFIb2xkZXI+IGFkZGl0aW9ucyA9IG5l\ndyBBcnJheUxpc3Q8UENEYXRhSG9sZGVyPigpOwogICAgICAgIHB1YmxpYyBm\naW5hbCBMaXN0PFBDRGF0YUhvbGRlcj4gbmV3VXBkYXRlcyA9IG5ldyBBcnJh\neUxpc3Q8UENEYXRhSG9sZGVyPigpOwogICAgICAgIHB1YmxpYyBmaW5hbCBM\naXN0PFBDRGF0YUhvbGRlcj4gZXhpc3RpbmdVcGRhdGVzID0gbmV3IEFycmF5\nTGlzdDxQQ0RhdGFIb2xkZXI+KCk7CiAgICAgICAgcHVibGljIGZpbmFsIExp\nc3Q8T2JqZWN0PiBkZWxldGVzID0gbmV3IEFycmF5TGlzdDxPYmplY3Q+KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVdGlsaXR5IHN0cnVjdHVyZSBob2xk\ncyB0aGUgdHVwbGUgb2YgY2FjaGVhYmxlIGluc3RhbmNlIGFuZCBpdHMgY29y\ncmVzcG9uZGluZyBzdGF0ZSBtYW5hZ2VyLiAKICAgICAqCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIFBDRGF0YUhvbGRlciB7CgogICAgICAg\nIHB1YmxpYyBmaW5hbCBEYXRhQ2FjaGVQQ0RhdGEgcGNkYXRhOwogICAgICAg\nIHB1YmxpYyBmaW5hbCBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtOwoKICAgICAg\nICBwdWJsaWMgUENEYXRhSG9sZGVyKERhdGFDYWNoZVBDRGF0YSBwY2RhdGEs\nIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICAgICAgdGhpcy5w\nY2RhdGEgPSBwY2RhdGE7CiAgICAgICAgICAgIHRoaXMuc20gPSBzbTsKCQl9\nCgl9Cn0KCg==\n","encoding":"base64"}

