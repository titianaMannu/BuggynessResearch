{"sha":"c013c0d7680aa224223d82ce144c11101df45bbe","node_id":"MDQ6QmxvYjIwNjM2NDpjMDEzYzBkNzY4MGFhMjI0MjIzZDgyY2UxNDRjMTExMDFkZjQ1YmJl","size":24199,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/c013c0d7680aa224223d82ce144c11101df45bbe","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hlOwoKaW1wb3J0\nIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLnV0aWwuQWJzdHJhY3RMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5CaXRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuRGF0ZTsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLkxvY2FsZTsKaW1wb3J0IGphdmEudXRpbC5NYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5M\naW5rZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZGF0YWNhY2hl\nLkFic3RyYWN0UXVlcnlDYWNoZS5FdmljdFBvbGljeTsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5rZXJuZWwuRmV0Y2hDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5Mb2NrTGV2ZWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5PcGVuSlBBU3RhdGVNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5RdWVyeUNv\nbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlJlc3Vs\ndFNoYXBlOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5TdG9y\nZUNvbnRleHQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLlN0\nb3JlUXVlcnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4\ncHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5q\ncGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuUXVlcnlFeHByZXNzaW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9wLkxpc3RSZXN1bHRPYmpl\nY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIucm9w\nLlJlc3VsdE9iamVjdFByb3ZpZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLmxpYi51dGlsLk9yZGVyZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNlcHRpb247CgoKLyoq\nCiAqIEEge0BsaW5rIFN0b3JlUXVlcnl9IGltcGxlbWVudGF0aW9uIHRoYXQg\nY2FjaGVzIHRoZSBPSURzIGludm9sdmVkIGluCiAqIHRoZSBxdWVyeSwgYW5k\nIGNhbiBkZXRlcm1pbmUgd2hldGhlciBvciBub3QgdGhlIHF1ZXJ5IGhhcyBi\nZWVuIGRpcnRpZWQuCiAqCiAqIEBhdXRob3IgUGF0cmljayBMaW5za2V5CiAq\nIEBzaW5jZSAwLjIuNS4wCiAqLwpwdWJsaWMgY2xhc3MgUXVlcnlDYWNoZVN0\nb3JlUXVlcnkKICAgIGltcGxlbWVudHMgU3RvcmVRdWVyeSB7CgogICAgcHJp\ndmF0ZSBmaW5hbCBTdG9yZVF1ZXJ5IF9xdWVyeTsKICAgIHByaXZhdGUgZmlu\nYWwgUXVlcnlDYWNoZSBfY2FjaGU7CiAgICBwcml2YXRlIFN0b3JlQ29udGV4\ndCBfc2N0eDsKICAgIHByaXZhdGUgTWV0YURhdGFSZXBvc2l0b3J5IF9yZXBv\nczsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSB0aGF0\nIGRlbGVnYXRlcyB0byA8Y29kZT5xdWVyeTwvY29kZT4gaWYgbm8KICAgICAq\nIGNhY2hlZCByZXN1bHRzIGFyZSBhdmFpbGFibGUuCiAgICAgKi8KICAgIHB1\nYmxpYyBRdWVyeUNhY2hlU3RvcmVRdWVyeShTdG9yZVF1ZXJ5IHF1ZXJ5LCBR\ndWVyeUNhY2hlIGNhY2hlKSB7CiAgICAgICAgX3F1ZXJ5ID0gcXVlcnk7CiAg\nICAgICAgX2NhY2hlID0gY2FjaGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdGhlIHtAbGluayBRdWVyeUNhY2hlfSB0aGF0IHRoaXMgb2JqZWN0\nIGlzIGFzc29jaWF0ZWQgd2l0aC4KICAgICAqLwogICAgcHVibGljIFF1ZXJ5\nQ2FjaGUgZ2V0Q2FjaGUoKSB7CiAgICAgICAgcmV0dXJuIF9jYWNoZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlLgogICAgICovCiAgICBwdWJs\naWMgU3RvcmVRdWVyeSBnZXREZWxlZ2F0ZSgpIHsKICAgICAgICByZXR1cm4g\nX3F1ZXJ5OwogICAgfQoKICAgIC8qKgogICAgICogTG9vayBpbiB0aGUgcXVl\ncnkgY2FjaGUgZm9yIGEgcmVzdWx0IGZvciB0aGUgZ2l2ZW4gcXVlcnkKICAg\nICAqIGtleS4gT25seSBsb29rIGlmIHRoaXMgcXVlcnkgaXMgYmVpbmcgZXhl\nY3V0ZWQgb3V0c2lkZSBhCiAgICAgKiB0cmFuc2FjdGlvbiBvciBpbiBhIHRy\nYW5zYWN0aW9uIHdpdGggSWdub3JlQ2hhbmdlcyBzZXQgdG8gdHJ1ZQogICAg\nICogb3IgaW4gYSB0cmFuc2FjdGlvbiB3aXRoIElnbm9yZUNoYW5nZXMgc2V0\nIHRvIGZhbHNlIGJ1dCBpbiB3aGljaAogICAgICogbm9uZSBvZiB0aGUgY2xh\nc3NlcyBpbnZvbHZlZCBpbiB0aGlzIHF1ZXJ5IGhhdmUgYmVlbiB0b3VjaGVk\nLgogICAgICogIENhY2hpbmcgaXMgbm90IHVzZWQgd2hlbiB1c2luZyBvYmpl\nY3QgbG9ja2luZy4KICAgICAqIFRoaXMgaXMgYmVjYXVzZSB3ZSBtdXN0IG9i\ndGFpbiBsb2NrcyBvbiB0aGUKICAgICAqIGRhdGEsIGFuZCBpdCBpcyBsaWtl\nbHkgdGhhdCBtYWtpbmcgbiB0cmlwcyB0byB0aGUgZGF0YWJhc2UgdG8KICAg\nICAqIG1ha2UgdGhlIGxvY2tzIHdpbGwgYmUgc2xvd2VyIHRoYW4gcnVubmlu\nZyB0aGUgcXVlcnkgYWdhaW5zdAogICAgICogdGhlIGRhdGFiYXNlLgogICAg\nICogIElmIHRoZSBmZXRjaCBjb25maWd1cmF0aW9uIGhhcyBxdWVyeSBjYWNo\naW5nIGRpc2FibGVkLAogICAgICogdGhlbiB0aGlzIG1ldGhvZCByZXR1cm5z\nIDxjb2RlPm51bGw8L2NvZGU+LgogICAgICogIFJldHVybiB0aGUgbGlzdCBp\nZiB3ZSBtZWV0IHRoZSBhYm92ZSBjcml0ZXJpYSBhbmQgaWYgYSBsaXN0CiAg\nICAgKiBpcyBmb3VuZCBmb3IgPGNvZGU+cWs8L2NvZGU+LiBFbHNlLCByZXR1\ncm4KICAgICAqIDxjb2RlPm51bGw8L2NvZGU+LgogICAgICogIFRoaXMgaW1w\nbGVtZW50YXRpb24gbWVhbnMgdGhhdCBxdWVyaWVzIGFnYWluc3QgdGhlIGNh\nY2hlCiAgICAgKiBhcmUgb2YgUkVBRF9DT01NSVRURUQgaXNvbGF0aW9uIGxl\ndmVsLiBJdCdkIGJlIG5pY2UgdG8gc3VwcG9ydAogICAgICogUkVBRF9TRVJJ\nQUxJWkFCTEUgLS0gdG8gZG8gc28sIHdlJ2QganVzdCByZXR1cm4gZmFsc2Ug\nd2hlbiBpbgogICAgICogYSB0cmFuc2FjdGlvbi4KICAgICAqLwogICAgcHJp\ndmF0ZSBMaXN0PE9iamVjdD4gY2hlY2tDYWNoZShRdWVyeUtleSBxaykgewog\nICAgICAgIGlmIChxayA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2ggPSBnZXRDb250\nZXh0KCkuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgaWYgKCFm\nZXRjaC5nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICBpZiAoZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgp\nID4gTG9ja0xldmVscy5MT0NLX05PTkUpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICAvLyBnZXQgdGhlIGNhY2hlZCBkYXRhCiAgICAgICAg\nUXVlcnlSZXN1bHQgcmVzID0gX2NhY2hlLmdldChxayk7CiAgICAgICAgaWYg\nKHJlcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsgICAgICAg\nIAogICAgICAgIGlmIChyZXMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1\ncm4gQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CgogICAgICAgIC8vIHRoaXMg\naWYgYmxvY2sgaXMgaW52b2tlZCBpZiB0aGUgZXZpY3RPblRpbWVzdGFtcCBp\ncyBzZXQgdG8gdHJ1ZQogICAgICAgIGlmIChfY2FjaGUgaW5zdGFuY2VvZiBB\nYnN0cmFjdFF1ZXJ5Q2FjaGUpIHsKICAgICAgICAgICAgQWJzdHJhY3RRdWVy\neUNhY2hlIHFjYWNoZSA9IChBYnN0cmFjdFF1ZXJ5Q2FjaGUpIF9jYWNoZTsK\nICAgICAgICAgICAgaWYgKHFjYWNoZS5nZXRFdmljdFBvbGljeSgpID09IEV2\naWN0UG9saWN5LlRJTUVTVEFNUCkgewogICAgICAgICAgICAgICAgU2V0PFN0\ncmluZz4gY2xhc3NOYW1lcyA9IHFrLmdldEFjZXNzUGF0aENsYXNzTmFtZXMo\nKTsKICAgICAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBrZXlMaXN0ID0gbmV3\nIEFycmF5TGlzdDxTdHJpbmc+KCk7ICAgICAgCiAgICAgICAgICAgICAgICBr\nZXlMaXN0LmFkZEFsbChjbGFzc05hbWVzKTsKCiAgICAgICAgICAgICAgICBM\naXN0PExvbmc+IHRpbWVzdGFtcHMgPSAKICAgICAgICAgICAgICAgICAgICBx\nY2FjaGUuZ2V0QWxsRW50aXR5VGltZXN0YW1wKGtleUxpc3QpOwogICAgICAg\nICAgICAgICAgbG9uZyBxdWVyeVRTID0gcmVzLmdldFRpbWVzdGFtcCgpOwog\nICAgICAgICAgICAgICAgaWYgKHRpbWVzdGFtcHMgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGZvciAoTG9uZyB0czogdGltZXN0YW1wcykgewog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIHRydWUgd2Ug\naGF2ZSB0byBldmljdCB0aGUgcXVlcnkgCiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGZyb20gY2FjaGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHF1ZXJ5VFMgPCB0cykgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHFjYWNoZS5yZW1vdmUocWspOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIGludCBwcm9qcyA9IGdldENvbnRl\neHQoKS5nZXRQcm9qZWN0aW9uQWxpYXNlcygpLmxlbmd0aDsKICAgICAgICBp\nZiAocHJvanMgPT0gMCkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhl\nIGRhdGEgY2FjaGUgY29udGFpbnMgdGhlIG9pZHMgZm9yIHRoZSBxdWVyeSBy\nZXN1bHQ7CiAgICAgICAgICAgIC8vIGlmIGl0IGRvZXNuJ3QsIHRoZW4gdXNp\nbmcgdGhlIHJlc3VsdCBjb3VsZCBiZSBzbG93ZXIgdGhhbiBub3QKICAgICAg\nICAgICAgLy8gdXNpbmcgaXQgYmVjYXVzZSBvZiB0aGUgaW5kaXZpZHVhbCBi\neS1vaWQgbG9va3VwcwogICAgICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGEg\nPSBfcmVwb3MuZ2V0TWV0YURhdGEoZ2V0Q29udGV4dCgpLgogICAgICAgICAg\nICAgICAgZ2V0Q2FuZGlkYXRlVHlwZSgpLCBfc2N0eC5nZXRDbGFzc0xvYWRl\ncigpLCB0cnVlKTsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0RGF0YUNhY2hl\nKCkgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAg\nICAgICAgICAgQml0U2V0IGlkeHMgPSBtZXRhLmdldERhdGFDYWNoZSgpLmNv\nbnRhaW5zQWxsKHJlcyk7CgogICAgICAgICAgICAvLyBldmVudHVhbGx5IHdl\nIHNob3VsZCBvcHRpbWl6ZSB0aGlzIHRvIGZpZ3VyZSBvdXQgaG93IG1hbnkg\nb2JqZWN0cwogICAgICAgICAgICAvLyB0aGUgY2FjaGUgaXMgbWlzc2luZyBh\nbmQgaWYgb25seSBhIGZldyBkbyBhIGJ1bGsgZmV0Y2ggZm9yIHRoZW0KICAg\nICAgICAgICAgaW50IGxlbiA9IGlkeHMubGVuZ3RoKCk7CiAgICAgICAgICAg\nIGlmIChsZW4gPCByZXMuc2l6ZSgpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVuOyBp\nKyspCiAgICAgICAgICAgICAgICBpZiAoIWlkeHMuZ2V0KGkpKQogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbmV3IENhY2hlZExpc3QocmVzLCBwcm9qcyAhPSAwLCBfc2N0eCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXcmFwIHRoZSByZXN1bHQgb2JqZWN0\nIHByb3ZpZGVyIHJldHVybmVkIGJ5IG91ciBkZWxlZ2F0ZSBpbiBhCiAgICAg\nKiBjYWNoaW5nIHByb3ZpZGVyLgogICAgICovCiAgICBwcml2YXRlIFJlc3Vs\ndE9iamVjdFByb3ZpZGVyIHdyYXBSZXN1bHQoUmVzdWx0T2JqZWN0UHJvdmlk\nZXIgcm9wLAogICAgICAgIFF1ZXJ5S2V5IGtleSkgewogICAgICAgIGlmIChr\nZXkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHJvcDsKICAgICAgICBy\nZXR1cm4gbmV3IENhY2hpbmdSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIGdl\ndENvbnRleHQoKS4KICAgICAgICAgICAgZ2V0UHJvamVjdGlvbkFsaWFzZXMo\nKS5sZW5ndGggPiAwLCBrZXkpOwogICAgfQoKICAgIC8qKgogICAgICogQ29w\neSBhIHByb2plY3Rpb24gZWxlbWVudCBmb3IgY2FjaGluZyAvIHJldHVybmlu\nZy4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGNvcHlQcm9q\nZWN0aW9uKE9iamVjdCBvYmosIFN0b3JlQ29udGV4dCBjdHgpIHsKICAgICAg\nICBpZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIHN3aXRjaCAoSmF2YVR5cGVzLmdldFR5cGVDb2RlKG9iai5nZXRD\nbGFzcygpKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6\nCiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU5fT0JKOgogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRFX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRV9PQko6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkZMT0FUX09CSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09C\nSjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9OR19PQko6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUX09CSjoKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuQklHSU5URUdFUjoKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuT0lEOgogICAgICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAgICAgICAgIHJldHVy\nbiAoKERhdGUpIG9iaikuY2xvbmUoKTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9DQUxFOgogICAgICAgICAgICAgICAgcmV0dXJuICgoTG9jYWxl\nKSBvYmopLmNsb25lKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgQ2FjaGVkT2JqZWN0SWQpCiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZyb21PYmplY3RJZCgoKENhY2hl\nZE9iamVjdElkKSBvYmopLm9pZCwgY3R4KTsKICAgICAgICAgICAgICAgIE9i\namVjdCBvaWQgPSBjdHguZ2V0T2JqZWN0SWQob2JqKTsKICAgICAgICAgICAg\nICAgIGlmIChvaWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IENhY2hlZE9iamVjdElkKG9pZCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gb2JqOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiB0aGUgcmVzdWx0IG9iamVjdCBiYXNlZCBvbiBpdHMgY2FjaGVkIG9p\nZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IGZyb21PYmpl\nY3RJZChPYmplY3Qgb2lkLCBTdG9yZUNvbnRleHQgc2N0eCkgewogICAgICAg\nIGlmIChvaWQgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7Cgog\nICAgICAgIE9iamVjdCBvYmogPSBzY3R4LmZpbmQob2lkLCBudWxsLCBudWxs\nLCBudWxsLCAwKTsKICAgICAgICBpZiAob2JqID09IG51bGwpCiAgICAgICAg\nICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihvaWQpOwog\nICAgICAgIHJldHVybiBvYmo7CiAgICB9CgogICAgcHVibGljIE9iamVjdCB3\ncml0ZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBPYmplY3RTdHJlYW1FeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBfcXVlcnk7CiAgICB9CgogICAgcHVi\nbGljIFF1ZXJ5Q29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVy\nbiBfcXVlcnkuZ2V0Q29udGV4dCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldENvbnRleHQoUXVlcnlDb250ZXh0IHFjdHgpIHsKICAgICAgICBfcXVl\ncnkuc2V0Q29udGV4dChxY3R4KTsKICAgICAgICBfc2N0eCA9IHFjdHguZ2V0\nU3RvcmVDb250ZXh0KCk7CiAgICAgICAgX3JlcG9zID0gX3NjdHguZ2V0Q29u\nZmlndXJhdGlvbigpLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc2V0UXVlcnkoT2JqZWN0IHF1\nZXJ5KSB7CiAgICAgICAgcmV0dXJuIF9xdWVyeS5zZXRRdWVyeShxdWVyeSk7\nCiAgICB9CgogICAgcHVibGljIEZpbHRlckxpc3RlbmVyIGdldEZpbHRlckxp\nc3RlbmVyKFN0cmluZyB0YWcpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lmdl\ndEZpbHRlckxpc3RlbmVyKHRhZyk7CiAgICB9CgogICAgcHVibGljIEFnZ3Jl\nZ2F0ZUxpc3RlbmVyIGdldEFnZ3JlZ2F0ZUxpc3RlbmVyKFN0cmluZyB0YWcp\nIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LmdldEFnZ3JlZ2F0ZUxpc3RlbmVy\nKHRhZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdDb21waWxhdGlv\nbktleSgpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9u\nS2V5KCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBuZXdDb21waWxhdGlv\nbigpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5Lm5ld0NvbXBpbGF0aW9uKCk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcG9wdWxhdGVGcm9tQ29tcGlsYXRp\nb24oT2JqZWN0IGNvbXApIHsKICAgICAgICBfcXVlcnkucG9wdWxhdGVGcm9t\nQ29tcGlsYXRpb24oY29tcCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW52\nYWxpZGF0ZUNvbXBpbGF0aW9uKCkgewogICAgICAgIF9xdWVyeS5pbnZhbGlk\nYXRlQ29tcGlsYXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBz\ndXBwb3J0c0RhdGFTdG9yZUV4ZWN1dGlvbigpIHsKICAgICAgICByZXR1cm4g\nX3F1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCk7CiAgICB9Cgog\nICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNJbk1lbW9yeUV4ZWN1dGlvbigp\nIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVj\ndXRpb24oKTsKICAgIH0KCiAgICBwdWJsaWMgRXhlY3V0b3IgbmV3SW5NZW1v\ncnlFeGVjdXRvcihDbGFzc01ldGFEYXRhIG1ldGEsIGJvb2xlYW4gc3Vicykg\newogICAgICAgIHJldHVybiBfcXVlcnkubmV3SW5NZW1vcnlFeGVjdXRvciht\nZXRhLCBzdWJzKTsKICAgIH0KCiAgICBwdWJsaWMgRXhlY3V0b3IgbmV3RGF0\nYVN0b3JlRXhlY3V0b3IoQ2xhc3NNZXRhRGF0YSBtZXRhLCBib29sZWFuIHN1\nYnMpIHsKICAgICAgICBFeGVjdXRvciBleCA9IF9xdWVyeS5uZXdEYXRhU3Rv\ncmVFeGVjdXRvcihtZXRhLCBzdWJzKTsKICAgICAgICByZXR1cm4gbmV3IFF1\nZXJ5Q2FjaGVFeGVjdXRvcihleCwgbWV0YSwgc3VicywKICAgICAgICAgICAg\nICAgICAgICAgIGdldENvbnRleHQoKS5nZXRGZXRjaENvbmZpZ3VyYXRpb24o\nKSk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNBYnN0cmFj\ndEV4ZWN1dG9ycygpIHsKICAgICAgICByZXR1cm4gX3F1ZXJ5LnN1cHBvcnRz\nQWJzdHJhY3RFeGVjdXRvcnMoKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiByZXF1aXJlc0NhbmRpZGF0ZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIF9x\ndWVyeS5yZXF1aXJlc0NhbmRpZGF0ZVR5cGUoKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiByZXF1aXJlc1BhcmFtZXRlckRlY2xhcmF0aW9ucygpIHsK\nICAgICAgICByZXR1cm4gX3F1ZXJ5LnJlcXVpcmVzUGFyYW1ldGVyRGVjbGFy\nYXRpb25zKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNQ\nYXJhbWV0ZXJEZWNsYXJhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIF9xdWVy\neS5zdXBwb3J0c1BhcmFtZXRlckRlY2xhcmF0aW9ucygpOwogICAgfQogCiAg\nICBwdWJsaWMgT2JqZWN0IGV2YWx1YXRlKE9iamVjdCB2YWx1ZSwgT2JqZWN0\nIG9iLCBPYmplY3RbXSBwYXJhbXMsCiAgICAgICAgT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSkgewogICAgICAgIHJldHVybiBfcXVlcnkuZXZhbHVhdGUodmFs\ndWUsIG9iLCBwYXJhbXMsIHNtKTsgICAgICAgICAKICAgIH0KCiAgICAvKioK\nICAgICAqIENhY2hpbmcgZXhlY3V0b3IuCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFF1ZXJ5Q2FjaGVFeGVjdXRvcgogICAgICAgIGltcGxl\nbWVudHMgRXhlY3V0b3IgewoKICAgICAgICBwcml2YXRlIGZpbmFsIEV4ZWN1\ndG9yIF9leDsKICAgICAgICBwcml2YXRlIGZpbmFsIENsYXNzPD8+IF9jYW5k\naWRhdGU7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIF9zdWJzOwog\nICAgICAgIHByaXZhdGUgZmluYWwgRmV0Y2hDb25maWd1cmF0aW9uIF9mYzsK\nCiAgICAgICAgcHVibGljIFF1ZXJ5Q2FjaGVFeGVjdXRvcihFeGVjdXRvciBl\neCwgQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAgICAgICBib29sZWFuIHN1\nYnMsIEZldGNoQ29uZmlndXJhdGlvbiBmYykgewogICAgICAgICAgICBfZXgg\nPSBleDsKICAgICAgICAgICAgX2NhbmRpZGF0ZSA9IChtZXRhID09IG51bGwp\nID8gbnVsbCA6IG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAg\nICBfc3VicyA9IHN1YnM7CiAgICAgICAgICAgIF9mYyA9IGZjOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIFJlc3VsdE9iamVjdFByb3ZpZGVyIGV4ZWN1\ndGVRdWVyeShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAg\nICAgICAgUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgUXVlcnlDYWNoZVN0\nb3JlUXVlcnkgY3EgPSAoUXVlcnlDYWNoZVN0b3JlUXVlcnkpIHE7CiAgICAg\nICAgICAgIFF1ZXJ5S2V5IGtleSA9IFF1ZXJ5S2V5Lm5ld0luc3RhbmNlKGNx\nLmdldENvbnRleHQoKSwKICAgICAgICAgICAgICAgIF9leC5pc1BhY2tpbmco\ncSksIHBhcmFtcywgX2NhbmRpZGF0ZSwgX3N1YnMsIHJhbmdlLnN0YXJ0LCAK\nICAgICAgICAgICAgICAgIHJhbmdlLmVuZCk7CiAgICAgICAgICAgIExpc3Q8\nT2JqZWN0PiBjYWNoZWQgPSBjcS5jaGVja0NhY2hlKGtleSk7CiAgICAgICAg\nICAgIGlmIChjYWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgTGlzdFJlc3VsdE9iamVjdFByb3ZpZGVyKGNhY2hlZCk7CgogICAg\nICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlciByb3AgPSBfZXguZXhlY3V0\nZVF1ZXJ5KGNxLmdldERlbGVnYXRlKCksCiAgICAgICAgICAgICAgICBwYXJh\nbXMsIHJhbmdlKTsKICAgICAgICAgICAgaWYgKF9mYy5nZXRRdWVyeUNhY2hl\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIGNxLndyYXBSZXN1\nbHQocm9wLCBrZXkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICByZXR1cm4gcm9wOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwdWJs\naWMgUXVlcnlFeHByZXNzaW9uc1tdIGdldFF1ZXJ5RXhwcmVzc2lvbnMoKSB7\nCiAgICAgICAgICAgIHJldHVybiBfZXguZ2V0UXVlcnlFeHByZXNzaW9ucygp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXIgdGhl\nIGNhY2hlZCBxdWVyaWVzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWNjZXNzIHBh\ndGgKICAgICAgICAgKiBjbGFzc2VzIGluIHRoZSBxdWVyeS4gVGhpcyBpcyBk\nb25lIHdoZW4gYnVsayBvcGVyYXRpb25zCiAgICAgICAgICogKHN1Y2ggYXMg\nZGVsZXRlcyBvciB1cGRhdGVzKSBhcmUgcGVyZm9ybWVkIHNvIHRoYXQgdGhl\nCiAgICAgICAgICogY2FjaGUgcmVtYWlucyB1cC10by1kYXRlLgogICAgICAg\nICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBjbGVhckFjY2Vzc1BhdGgoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIGlmIChxID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICBDbGFzc01ldGFEYXRh\nW10gY21kID0gZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyhxKTsKICAgICAgICAg\nICAgaWYgKGNtZCA9PSBudWxsIHx8IGNtZC5sZW5ndGggPT0gMCkKICAgICAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIExpc3Q8Q2xhc3M8Pz4+\nIGNsYXNzZXMgPSBuZXcgQXJyYXlMaXN0PENsYXNzPD8+PihjbWQubGVuZ3Ro\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjbWQubGVuZ3Ro\nOyBpKyspCiAgICAgICAgICAgICAgICBjbGFzc2VzLmFkZChjbWRbaV0uZ2V0\nRGVzY3JpYmVkVHlwZSgpKTsKCiAgICAgICAgICAgIC8vIGV2aWN0IGZyb20g\ndGhlIHF1ZXJ5IGNhY2hlCiAgICAgICAgICAgIFF1ZXJ5Q2FjaGVTdG9yZVF1\nZXJ5IGNxID0gKFF1ZXJ5Q2FjaGVTdG9yZVF1ZXJ5KSBxOwogICAgICAgICAg\nICBjcS5nZXRDYWNoZSgpLm9uVHlwZXNDaGFuZ2VkKG5ldyBUeXBlc0NoYW5n\nZWRFdmVudAogICAgICAgICAgICAgICAgKHEuZ2V0Q29udGV4dCgpLCBjbGFz\nc2VzKSk7CgogICAgICAgICAgICAvLyBldmljdCBmcm9tIHRoZSBkYXRhIGNh\nY2hlCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY21kLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoY21kW2ldLmdldERhdGFD\nYWNoZSgpICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgY21kW2ldLmdl\ndERhdGFDYWNoZSgpLnJlbW92ZUFsbCgKICAgICAgICAgICAgICAgICAgICAg\nICAgY21kW2ldLmdldERlc2NyaWJlZFR5cGUoKSwgdHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOdW1iZXIgZXhlY3V0\nZURlbGV0ZShTdG9yZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcykgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9leC5leGVj\ndXRlRGVsZXRlKHVud3JhcChxKSwgcGFyYW1zKTsKICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgIGNsZWFyQWNjZXNzUGF0aChxKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIE51bWJl\nciBleGVjdXRlVXBkYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nX2V4LmV4ZWN1dGVVcGRhdGUodW53cmFwKHEpLCBwYXJhbXMpOwogICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgY2xlYXJBY2Nlc3NQ\nYXRoKHEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0aW9ucyhTdG9yZVF1ZXJ5IHEs\nIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgUmFuZ2UgcmFuZ2UpIHsK\nICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NUUklOR1M7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCB2YWxpZGF0ZShTdG9yZVF1ZXJ5IHEpIHsK\nICAgICAgICAgICAgX2V4LnZhbGlkYXRlKHVud3JhcChxKSk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHB1YmxpYyB2b2lkIGdldFJhbmdlKFN0b3Jl\nUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLCBSYW5nZSByYW5nZSkgewogICAg\nICAgICAgICBfZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5nZSk7IAogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXRPcmRlcmluZ1ZhbHVl\nKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1zLAogICAgICAgICAgICBP\nYmplY3QgcmVzdWx0T2JqZWN0LCBpbnQgb3JkZXJJbmRleCkgewogICAgICAg\nICAgICByZXR1cm4gX2V4LmdldE9yZGVyaW5nVmFsdWUodW53cmFwKHEpLCBw\nYXJhbXMsIHJlc3VsdE9iamVjdCwKICAgICAgICAgICAgICAgIG9yZGVySW5k\nZXgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW5bXSBnZXRB\nc2NlbmRpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0QXNjZW5kaW5nKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc1BhY2tpbmcoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXguaXNQYWNraW5nKHVud3JhcChxKSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldEFsaWFzKFN0b3Jl\nUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldEFsaWFzKHVu\nd3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3M8Pz4g\nZ2V0UmVzdWx0Q2xhc3MoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJl\ndHVybiBfZXguZ2V0UmVzdWx0Q2xhc3ModW53cmFwKHEpKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBSZXN1bHRTaGFwZTw/PiBnZXRSZXN1bHRTaGFw\nZShTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5nZXRS\nZXN1bHRTaGFwZShxKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVi\nbGljIFN0cmluZ1tdIGdldFByb2plY3Rpb25BbGlhc2VzKFN0b3JlUXVlcnkg\ncSkgewogICAgICAgICAgICByZXR1cm4gX2V4LmdldFByb2plY3Rpb25BbGlh\nc2VzKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xh\nc3M8Pz5bXSBnZXRQcm9qZWN0aW9uVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXguZ2V0UHJvamVjdGlvblR5cGVzKHVud3Jh\ncChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgQ2xhc3NNZXRhRGF0\nYVtdIGdldEFjY2Vzc1BhdGhNZXRhRGF0YXMoU3RvcmVRdWVyeSBxKSB7CiAg\nICAgICAgICAgIHJldHVybiBfZXguZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcyh1\nbndyYXAocSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBnZXRP\ncGVyYXRpb24oU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBf\nZXguZ2V0T3BlcmF0aW9uKHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc0FnZ3JlZ2F0ZShTdG9yZVF1ZXJ5IHEpIHsK\nICAgICAgICAgICAgcmV0dXJuIF9leC5pc0FnZ3JlZ2F0ZSh1bndyYXAocSkp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNEaXN0aW5j\ndChTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC5pc0Rp\nc3RpbmN0KHVud3JhcChxKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNHcm91cGluZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leC5oYXNHcm91cGluZyh1bndyYXAocSkpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIE9yZGVyZWRNYXA8T2JqZWN0LCBDbGFzczw/\nPj4gZ2V0T3JkZXJlZFBhcmFtZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkgewog\nICAgICAgICAgICByZXR1cm4gX2V4LmdldE9yZGVyZWRQYXJhbWV0ZXJUeXBl\ncyh1bndyYXAocSkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwdWJs\naWMgTGlua2VkTWFwIGdldFBhcmFtZXRlclR5cGVzKFN0b3JlUXVlcnkgcSkg\newogICAgICAgICAgICByZXR1cm4gX2V4LmdldFBhcmFtZXRlclR5cGVzKHVu\nd3JhcChxKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBP\nYmplY3RbXSB0b1BhcmFtZXRlckFycmF5KFN0b3JlUXVlcnkgcSwgTWFwIHVz\nZXJQYXJhbXMpIHsKICAgICAgICAgICAgcmV0dXJuIF9leC50b1BhcmFtZXRl\nckFycmF5KHEsIHVzZXJQYXJhbXMpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIE1hcCBnZXRVcGRhdGVzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gX2V4LmdldFVwZGF0ZXModW53cmFwKHEpKTsKICAgICAgICB9\nCgogICAgICAgIHByaXZhdGUgc3RhdGljIFN0b3JlUXVlcnkgdW53cmFwKFN0\nb3JlUXVlcnkgcSkgewogICAgICAgICAgICByZXR1cm4gKChRdWVyeUNhY2hl\nU3RvcmVRdWVyeSkgcSkuZ2V0RGVsZWdhdGUoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZXN1bHQgbGlzdCBpbXBsZW1lbnRhdGlvbiBm\nb3IgYSBjYWNoZWQgcXVlcnkgcmVzdWx0LiBQYWNrYWdlLXByb3RlY3RlZAog\nICAgICogZm9yIHRlc3RpbmcuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMg\nY2xhc3MgQ2FjaGVkTGlzdCBleHRlbmRzIEFic3RyYWN0TGlzdDxPYmplY3Q+\nCiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUgewoKICAgICAgICBw\ncml2YXRlIGZpbmFsIFF1ZXJ5UmVzdWx0IF9yZXM7CiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBib29sZWFuIF9wcm9qOwogICAgICAgIHByaXZhdGUgZmluYWwg\nU3RvcmVDb250ZXh0IF9zY3R4OwoKICAgICAgICBwdWJsaWMgQ2FjaGVkTGlz\ndChRdWVyeVJlc3VsdCByZXMsIGJvb2xlYW4gcHJvaiwgU3RvcmVDb250ZXh0\nIGN0eCkgewogICAgICAgICAgICBfcmVzID0gcmVzOwogICAgICAgICAgICBf\ncHJvaiA9IHByb2o7CiAgICAgICAgICAgIF9zY3R4ID0gY3R4OwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXQoaW50IGlkeCkgewogICAg\nICAgICAgICBpZiAoIV9wcm9qKQogICAgICAgICAgICAgICAgcmV0dXJuIGZy\nb21PYmplY3RJZChfcmVzLmdldChpZHgpLCBfc2N0eCk7CgogICAgICAgICAg\nICBPYmplY3RbXSBjYWNoZWQgPSAoT2JqZWN0W10pIF9yZXMuZ2V0KGlkeCk7\nCiAgICAgICAgICAgIGlmIChjYWNoZWQgPT0gbnVsbCkKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgICAgICBPYmplY3RbXSB1bmNhY2hl\nZCA9IG5ldyBPYmplY3RbY2FjaGVkLmxlbmd0aF07CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY2FjaGVkLmxlbmd0aDsgaSsrKQogICAgICAg\nICAgICAgICAgdW5jYWNoZWRbaV0gPSBjb3B5UHJvamVjdGlvbihjYWNoZWRb\naV0sIF9zY3R4KTsKICAgICAgICAgICAgcmV0dXJuIHVuY2FjaGVkOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAg\nICByZXR1cm4gX3Jlcy5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgICAgIHRocm93cyBP\nYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3\nIEFycmF5TGlzdDxPYmplY3Q+KHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEEgd3JhcHBlciBhcm91bmQgYSB7QGxpbmsgUmVzdWx0\nT2JqZWN0UHJvdmlkZXJ9IHRoYXQgYnVpbGRzIHVwIGEgbGlzdCBvZgogICAg\nICogYWxsIHRoZSBPSURzIGluIHRoaXMgbGlzdCBhbmQgcmVnaXN0ZXJzIHRo\nYXQgbGlzdCB3aXRoIHRoZQogICAgICogcXVlcnkgY2FjaGUuIEFiYW5kb25z\nIG1vbml0b3JpbmcgYW5kIHJlZ2lzdGVyaW5nIGlmIG9uZSBvZiB0aGUgY2xh\nc3NlcwogICAgICogaW4gdGhlIGFjY2VzcyBwYXRoIGlzIG1vZGlmaWVkIHdo\naWxlIHRoZSBxdWVyeSByZXN1bHRzIGFyZSBiZWluZyBsb2FkZWQuCiAgICAg\nKi8KICAgIHByaXZhdGUgY2xhc3MgQ2FjaGluZ1Jlc3VsdE9iamVjdFByb3Zp\nZGVyCiAgICAgICAgaW1wbGVtZW50cyBSZXN1bHRPYmplY3RQcm92aWRlciwg\nVHlwZXNDaGFuZ2VkTGlzdGVuZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFs\nIFJlc3VsdE9iamVjdFByb3ZpZGVyIF9yb3A7CiAgICAgICAgcHJpdmF0ZSBm\naW5hbCBib29sZWFuIF9wcm9qOwogICAgICAgIHByaXZhdGUgZmluYWwgUXVl\ncnlLZXkgX3FrOwogICAgICAgIHByaXZhdGUgZmluYWwgVHJlZU1hcDxJbnRl\nZ2VyLE9iamVjdD4gX2RhdGEgPSBuZXcgVHJlZU1hcDxJbnRlZ2VyLE9iamVj\ndD4oKTsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gX21haW50YWluQ2FjaGUg\nPSB0cnVlOwogICAgICAgIHByaXZhdGUgaW50IF9wb3MgPSAtMTsKCiAgICAg\nICAgLy8gdXNlZCB0byBkZXRlcm1pbmUgbGlzdCBzaXplIHdpdGhvdXQgbmVj\nZXNzYXJpbHkgY2FsbGluZyBzaXplKCksCiAgICAgICAgLy8gd2hpY2ggbWF5\nIHJlcXVpcmUgYSBEQiB0cmlwIG9yIHJldHVybiBJbnRlZ2VyLk1BWF9WQUxV\nRQogICAgICAgIHByaXZhdGUgaW50IF9tYXggPSAtMTsKICAgICAgICBwcml2\nYXRlIGludCBfc2l6ZSA9IEludGVnZXIuTUFYX1ZBTFVFOwoKICAgICAgICAv\nKioKICAgICAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGRlbGVnYXRlIHJl\nc3VsdCBwcm92aWRlciBhbmQgb3VyIHF1ZXJ5IGtleS4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgQ2FjaGluZ1Jlc3VsdE9iamVjdFByb3ZpZGVyKFJl\nc3VsdE9iamVjdFByb3ZpZGVyIHJvcCwKICAgICAgICAgICAgYm9vbGVhbiBw\ncm9qLCBRdWVyeUtleSBrZXkpIHsKICAgICAgICAgICAgX3JvcCA9IHJvcDsK\nICAgICAgICAgICAgX3Byb2ogPSBwcm9qOwogICAgICAgICAgICBfcWsgPSBr\nZXk7CiAgICAgICAgICAgIF9jYWNoZS5hZGRUeXBlc0NoYW5nZWRMaXN0ZW5l\ncih0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFN0\nb3AgY2FjaGluZy4KICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQg\nYWJvcnRDYWNoaW5nKCkgewogICAgICAgICAgICBpZiAoIV9tYWludGFpbkNh\nY2hlKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8g\ndGhpcyBjYW4gYmUgY2FsbGVkIHZpYSBhbiBldmVudCBmcm9tIGFub3RoZXIg\ndGhyZWFkCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAg\nICAgICAgICAgICAgLy8gaXQncyBpbXBvcnRhbnQgdGhhdCB3ZSBzZXQgdGhp\ncyBmbGFnIGZpcnN0IHNvIHRoYXQgYW55CiAgICAgICAgICAgICAgICAvLyBz\ndWJzZXF1ZW50IGNhbGxzIHRvIHRoaXMgb2JqZWN0IGFyZSBieXBhc3NlZC4K\nICAgICAgICAgICAgICAgIF9tYWludGFpbkNhY2hlID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICBfY2FjaGUucmVtb3ZlVHlwZXNDaGFuZ2VkTGlzdGVuZXIo\ndGhpcyk7CiAgICAgICAgICAgICAgICBfZGF0YS5jbGVhcigpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVj\nayB3aGV0aGVyIHdlJ3ZlIGJ1ZmZlcmVkIGFsbCByZXN1bHRzLCB3aGlsZSBv\ncHRpb25hbGx5IGFkZGluZwogICAgICAgICAqIHRoZSBnaXZlbiByZXN1bHQu\nCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIGNoZWNrRmluaXNo\nZWQoT2JqZWN0IG9iaiwgYm9vbGVhbiByZXN1bHQpIHsKICAgICAgICAgICAg\nLy8gdGhpcyBjYW4gYmUgY2FsbGVkIGF0IHRoZSBzYW1lIHRpbWUgYXMgYWJv\ncnRDYWNoaW5nIHZpYQogICAgICAgICAgICAvLyBhIHR5cGVzIGNoYW5nZWQg\nZXZlbnQKICAgICAgICAgICAgYm9vbGVhbiBmaW5pc2hlZCA9IGZhbHNlOwog\nICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAg\nICAgIGlmIChfbWFpbnRhaW5DYWNoZSkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgSW50ZWdl\nciBpbmRleCA9IF9wb3M7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgh\nX2RhdGEuY29udGFpbnNLZXkoaW5kZXgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBPYmplY3QgY2FjaGVkOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNhY2hlZCA9IG51bGw7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBlbHNlIGlmICghX3Byb2opCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY2FjaGVkID0gX3NjdHguZ2V0T2JqZWN0SWQob2Jq\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFtdIGFyciA9IChPYmpl\nY3RbXSkgb2JqOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9i\namVjdFtdIGNwID0gbmV3IE9iamVjdFthcnIubGVuZ3RoXTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFy\nci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY3BbaV0gPSBjb3B5UHJvamVjdGlvbihhcnJbaV0sIF9zY3R4KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWQgPSBjcDsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChjYWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBfZGF0YS5wdXQoaW5kZXgsIGNhY2hlZCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgZmluaXNoZWQgPSBfc2l6ZSA9PSBf\nZGF0YS5zaXplKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChmaW5pc2hlZCkgewogICAgICAgICAgICAgICAg\nLy8gYW4gYWJvcnRDYWNoaW5nIGNhbGwgY2FuIHNuZWFrIGluIGhlcmUgdmlh\nIG9uRXhwaXJlOyB0aGUKICAgICAgICAgICAgICAgIC8vIGNhY2hlIGlzIGxv\nY2tlZCBkdXJpbmcgZXZlbnQgZmlyaW5ncywgc28gdGhlIGxvY2sgaGVyZSB3\naWxsCiAgICAgICAgICAgICAgICAvLyB3YWl0IGZvciBpdCAob3Igd2lsbCBm\nb3JjZSB0aGUgbmV4dCBmaXJpbmcgdG8gd2FpdCkKICAgICAgICAgICAgICAg\nIF9jYWNoZS53cml0ZUxvY2soKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGRpZG4ndCBhYm9y\ndAogICAgICAgICAgICAgICAgICAgIGlmIChfbWFpbnRhaW5DYWNoZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBRdWVyeVJlc3VsdCByZXMgPSBudWxs\nOwogICAgICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IG5ldyBRdWVy\neVJlc3VsdChfcWssIF9kYXRhLnZhbHVlcygpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJlcy5zZXRUaW1lc3RhbXAoU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIF9jYWNoZS5wdXQoX3FrLCByZXMpOwogICAg\nICAgICAgICAgICAgICAgICAgICBhYm9ydENhY2hpbmcoKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBfY2FjaGUud3JpdGVV\nbmxvY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gc3VwcG9ydHNSYW5kb21B\nY2Nlc3MoKSB7CiAgICAgICAgICAgIHJldHVybiBfcm9wLnN1cHBvcnRzUmFu\nZG9tQWNjZXNzKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVuKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIF9yb3Aub3BlbigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9i\namVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0IG9iaiA9IF9yb3AuZ2V0UmVz\ndWx0T2JqZWN0KCk7CiAgICAgICAgICAgIGNoZWNrRmluaXNoZWQob2JqLCB0\ncnVlKTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBib29sZWFuIG5leHQoKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcysrOwogICAgICAgICAgICBi\nb29sZWFuIG5leHQgPSBfcm9wLm5leHQoKTsKICAgICAgICAgICAgaWYgKCFu\nZXh0ICYmIF9wb3MgPT0gX21heCArIDEpIHsKICAgICAgICAgICAgICAgIF9z\naXplID0gX3BvczsKICAgICAgICAgICAgICAgIGNoZWNrRmluaXNoZWQobnVs\nbCwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG5leHQgJiYgX3Bv\ncyA+IF9tYXgpCiAgICAgICAgICAgICAgICBfbWF4ID0gX3BvczsKICAgICAg\nICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBhYnNvbHV0ZShpbnQgcG9zKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgX3BvcyA9IHBvczsKICAgICAgICAg\nICAgYm9vbGVhbiB2YWxpZCA9IF9yb3AuYWJzb2x1dGUocG9zKTsKICAgICAg\nICAgICAgaWYgKCF2YWxpZCAmJiBfcG9zID09IF9tYXggKyAxKSB7CiAgICAg\nICAgICAgICAgICBfc2l6ZSA9IF9wb3M7CiAgICAgICAgICAgICAgICBjaGVj\na0ZpbmlzaGVkKG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIGlm\nICh2YWxpZCAmJiBfcG9zID4gX21heCkKICAgICAgICAgICAgICAgIF9tYXgg\nPSBfcG9zOwogICAgICAgICAgICByZXR1cm4gdmFsaWQ7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgaW50IHNpemUoKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKF9zaXplICE9IEludGVnZXIu\nTUFYX1ZBTFVFKQogICAgICAgICAgICAgICAgcmV0dXJuIF9zaXplOwogICAg\nICAgICAgICBpbnQgc2l6ZSA9IF9yb3Auc2l6ZSgpOwogICAgICAgICAgICBf\nc2l6ZSA9IHNpemU7CiAgICAgICAgICAgIGNoZWNrRmluaXNoZWQobnVsbCwg\nZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHJlc2V0KCkKICAgICAgICAgICAgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIF9yb3AucmVzZXQoKTsKICAgICAg\nICAgICAgX3BvcyA9IC0xOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgY2xvc2UoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgYWJvcnRDYWNoaW5nKCk7CiAgICAgICAgICAgIF9yb3AuY2xv\nc2UoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGhhbmRsZUNo\nZWNrZWRFeGNlcHRpb24oRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgX3Jv\ncC5oYW5kbGVDaGVja2VkRXhjZXB0aW9uKGUpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgb25UeXBlc0NoYW5nZWQoVHlwZXNDaGFuZ2VkRXZl\nbnQgZXYpIHsKICAgICAgICAgICAgaWYgKF9xay5jaGFuZ2VJbnZhbGlkYXRl\nc1F1ZXJ5KGV2LmdldFR5cGVzKCkpKQogICAgICAgICAgICAgICAgYWJvcnRD\nYWNoaW5nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3Ry\ndWN0IHRvIHJlY29nbml6ZSBjYWNoZWQgb2lkcy4KICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgY2xhc3MgQ2FjaGVkT2JqZWN0SWQgewoKICAgICAgICBw\ndWJsaWMgZmluYWwgT2JqZWN0IG9pZDsKCiAgICAgICAgcHVibGljIENhY2hl\nZE9iamVjdElkIChPYmplY3Qgb2lkKQogICAgICAgIHsKICAgICAgICAgICAg\ndGhpcy5vaWQgPSBvaWQ7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

