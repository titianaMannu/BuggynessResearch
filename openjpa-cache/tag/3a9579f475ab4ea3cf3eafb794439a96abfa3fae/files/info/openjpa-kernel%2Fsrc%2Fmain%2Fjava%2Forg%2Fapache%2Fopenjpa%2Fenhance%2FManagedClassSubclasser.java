{"sha":"89630dcc2ed96880caf74f22f1c436a3015727ab","node_id":"MDQ6QmxvYjIwNjM2NDo4OTYzMGRjYzJlZDk2ODgwY2FmNzRmMjJmMWM0MzZhMzAxNTcyN2Fi","size":14125,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/89630dcc2ed96880caf74f22f1c436a3015727ab","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlOwoKaW1wb3J0IGphdmEu\naW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBv\ncnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5saWIudXRpbC5KYXZhVmVyc2lvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmxpYi51dGlsLkZpbGVzOwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplci5NZXNzYWdlOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQWNjZXNzQ29kZTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0aW9uczsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkdlbmVyYXRlZENsYXNzZXM7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5NZXRhRGF0YUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNlcHRpb247\nCmltcG9ydCBzZXJwLmJ5dGVjb2RlLkJDQ2xhc3M7CgovKioKICogUmVkZWZp\nbmVzIHRoZSBtZXRob2QgYm9kaWVzIG9mIGV4aXN0aW5nIHVuZW5oYW5jZWQg\nY2xhc3NlcyB0byBtYWtlIHRoZW0KICogbm90aWZ5IHN0YXRlIG1hbmFnZXJz\nIG9mIG11dGF0aW9ucy4KICoKICogQHNpbmNlIDEuMC4wCiAqLwpwdWJsaWMg\nY2xhc3MgTWFuYWdlZENsYXNzU3ViY2xhc3NlciB7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNr\nYWdlKAogICAgICAgIE1hbmFnZWRDbGFzc1N1YmNsYXNzZXIuY2xhc3MpOwoK\nICAgIC8qKgogICAgICogRm9yIGVhY2ggZWxlbWVudCBpbiA8Y29kZT5jbGFz\nc2VzPC9jb2RlPiwgY3JlYXRlcyBhbmQgcmVnaXN0ZXJzIGEKICAgICAqIG5l\ndyBzdWJjbGFzcyB0aGF0IGltcGxlbWVudHMge0BsaW5rIFBlcnNpc3RlbmNl\nQ2FwYWJsZX0sIGFuZCBwcmVwYXJlcwogICAgICogT3BlbkpQQSB0byBoYW5k\nbGUgbmV3IGluc3RhbmNlcyBvZiB0aGUgdW5lbmhhbmNlZCB0eXBlLiBJZiB0\naGlzIGlzCiAgICAgKiBpbnZva2VkIGluIGEgSmF2YSA2IGVudmlyb25tZW50\nLCB0aGlzIG1ldGhvZCB3aWxsIHJlZGVmaW5lIHRoZSBtZXRob2RzCiAgICAg\nKiBmb3IgZWFjaCBjbGFzcyBpbiB0aGUgYXJndW1lbnQgbGlzdCBzdWNoIHRo\nYXQgZmllbGQgYWNjZXNzZXMgYXJlCiAgICAgKiBpbnRlcmNlcHRlZCBpbi1s\naW5lLiBJZiBpbnZva2VkIGluIGEgSmF2YSA1IGVudmlyb25tZW50LCB0aGlz\nCiAgICAgKiByZWRlZmluaXRpb24gaXMgbm90IHBvc3NpYmxlOyBpbiB0aGVz\nZSBjb250ZXh0cywgd2hlbiB1c2luZyBmaWVsZAogICAgICogYWNjZXNzLCBP\ncGVuSlBBIHdpbGwgbmVlZCB0byBkbyBzdGF0ZSBjb21wYXJpc29ucyB0byBk\nZXRlY3QgYW55IGNoYW5nZQogICAgICogdG8gYW55IGluc3RhbmNlIGF0IGFu\neSB0aW1lLCBhbmQgd2hlbiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIE9wZW5K\nUEEKICAgICAqIHdpbGwgbmVlZCB0byBkbyBzdGF0ZSBjb21wYXJpc29ucyB0\nbyBkZXRlY3QgY2hhbmdlcyB0byBuZXdseSBpbnNlcnRlZAogICAgICogaW5z\ndGFuY2VzIGFmdGVyIGEgZmx1c2ggaGFzIGJlZW4gY2FsbGVkLgogICAgICoK\nICAgICAqIEByZXR1cm4gdGhlIG5ldyBzdWJjbGFzc2VzLCBvciA8Y29kZT5u\ndWxsPC9jb2RlPiBpZiA8Y29kZT5jbGFzc2VzPC9jb2RlPgogICAgICogaXMg\nPGNvZGU+bnVsbDwvY29kZT4uCiAgICAgKiBAdGhyb3dzIFVzZXJFeGNlcHRp\nb24gaWYgPGNvZGU+Y29uZjwvY29kZT4gcmVxdWlyZXMgYnVpbGQtdGltZQog\nICAgICogZW5oYW5jZW1lbnQgYW5kIDxjb2RlPmNsYXNzZXM8L2NvZGU+IGlu\nY2x1ZGVzIHVuZW5oYW5jZWQgdHlwZXMuCiAgICAgKgogICAgICogQHNpbmNl\nIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxDbGFzczw/\nPj4gcHJlcGFyZVVuZW5oYW5jZWRDbGFzc2VzKAogICAgICAgIGZpbmFsIE9w\nZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgZmluYWwgQ29sbGVj\ndGlvbjw/IGV4dGVuZHMgQ2xhc3M8Pz4+IGNsYXNzZXMsCiAgICAgICAgZmlu\nYWwgQ2xhc3NMb2FkZXIgZW52TG9hZGVyKSB7CiAgICAgICAgaWYgKGNsYXNz\nZXMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\naWYgKGNsYXNzZXMuc2l6ZSgpID09IDApCiAgICAgICAgICAgIHJldHVybiBD\nb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsKCiAgICAgICAgTG9nIGxvZyA9IGNv\nbmYuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxPR19FTkhBTkNFKTsK\nICAgICAgICBpZiAoY29uZi5nZXRSdW50aW1lVW5lbmhhbmNlZENsYXNzZXND\nb25zdGFudCgpICE9IFJ1bnRpbWVVbmVuaGFuY2VkQ2xhc3Nlc01vZGVzLlNV\nUFBPUlRFRCkgewogICAgICAgICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiB1\nbmVuaGFuY2VkID0gbmV3IEFycmF5TGlzdDxDbGFzczw/Pj4oKTsKICAgICAg\nICAgICAgZm9yIChDbGFzczw/PiBjbHMgOiBjbGFzc2VzKQogICAgICAgICAg\nICAgICAgaWYgKCFQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3MuaXNBc3NpZ25h\nYmxlRnJvbShjbHMpKQogICAgICAgICAgICAgICAgICAgIHVuZW5oYW5jZWQu\nYWRkKGNscyk7CiAgICAgICAgICAgIGlmICh1bmVuaGFuY2VkLnNpemUoKSA+\nIDApIHsKICAgICAgICAgICAgICAgIGlmIChQQ0VuaGFuY2VyQWdlbnQuZ2V0\nTG9hZFN1Y2Nlc3NmdWwoKSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gVGhpcyBtZWFucyB0aGF0IHRoZSBlbmhhbmNlciBoYXMgYmVlbiBy\nYW4gYnV0IHdlCiAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSBzb21lIHVu\nZW5oYW5jZWQgY2xhc3Nlcy4gVGhpcyBjYW4gaGFwcGVuIGlmIGFuCiAgICAg\nICAgICAgICAgICAgICAgLy8gZW50aXR5IGlzIGxvYWRlZCBieSB0aGUgSlZN\nIGJlZm9yZSB0aGUgRW50aXR5TWFuZ2VyCiAgICAgICAgICAgICAgICAgICAg\nLy8gd2FzIGNyZWF0ZWQuIFdhcm4gdGhlIHVzZXIuCiAgICAgICAgICAgICAg\nICAgICAgaWYgKGxvZy5pc1dhcm5FbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nLndhcm4oX2xvYy5nZXQoImVudGl0aWVzLWxvYWRl\nZC1iZWZvcmUtZW0iKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2UoTWFuYWdlZENsYXNzU3Vi\nY2xhc3Nlci5jbGFzcy5nZXROYW1lKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIi5wcmVwYXJlVW5lbmhhbmNlZENsYXNzZXMoKSIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgIiAtIFRoZSBmb2xsb3dpbmcgY2xh\nc3NlcyBhcmUgdW5lbmhhbmNlZCAiCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArIHVuZW5oYW5jZWQudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTWVz\nc2FnZSBtc2cgPSBfbG9jLmdldCgicnVudGltZS1vcHRpbWl6YXRpb24tZGlz\nYWJsZWQiLCBFeGNlcHRpb25zLnRvQ2xhc3NOYW1lcyh1bmVuaGFuY2VkKSk7\nCiAgICAgICAgICAgICAgICBpZiAoY29uZi5nZXRSdW50aW1lVW5lbmhhbmNl\nZENsYXNzZXNDb25zdGFudCgpID09IFJ1bnRpbWVVbmVuaGFuY2VkQ2xhc3Nl\nc01vZGVzLldBUk4pIHsKICAgICAgICAgICAgICAgICAgICBsb2cud2Fybiht\nc2cpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihtc2cpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiByZWRlZmluZSA9IENsYXNz\nUmVkZWZpbmVyLmNhblJlZGVmaW5lQ2xhc3Nlcyhsb2cpOwogICAgICAgIGlm\nIChyZWRlZmluZSkgewogICAgICAgICAgICBsb2cuaW5mbyhfbG9jLmdldCgi\nZW5oYW5jZS1hbmQtc3ViY2xhc3MtYW5kLXJlZGVmLXN0YXJ0IiwgY2xhc3Nl\ncykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvZy5pbmZvKF9s\nb2MuZ2V0KCJlbmhhbmNlLWFuZC1zdWJjbGFzcy1uby1yZWRlZi1zdGFydCIs\nICBjbGFzc2VzKSk7CiAgICAgICAgfQogICAgICAgIGZpbmFsIE1hcDxDbGFz\nczw/PiwgYnl0ZVtdPiBtYXAgPSBuZXcgSGFzaE1hcDxDbGFzczw/PiwgYnl0\nZVtdPigpOwogICAgICAgIGZpbmFsIExpc3Q8Q2xhc3M8Pz4+IHN1YnMgPSBu\nZXcgQXJyYXlMaXN0PENsYXNzPD8+PihjbGFzc2VzLnNpemUoKSk7CiAgICAg\nICAgZmluYWwgTGlzdDxDbGFzczw/Pj4gaW50cyA9IG5ldyBBcnJheUxpc3Q8\nQ2xhc3M8Pz4+KGNsYXNzZXMuc2l6ZSgpKTsKICAgICAgICBTZXQ8Q2xhc3M8\nPz4+IHVuc3BlY2lmaWVkID0gbnVsbDsKICAgICAgICBmb3IgKENsYXNzPD8+\nIGNscyA6IGNsYXNzZXMpIHsKICAgICAgICAgICAgZmluYWwgQ2xhc3M8Pz4g\nYyA9IGNsczsKICAgICAgICAgICAgZmluYWwgUENFbmhhbmNlciBlbmhhbmNl\nciA9IG5ldyBQQ0VuaGFuY2VyKGNvbmYsIGNscyk7IAoKICAgICAgICAgICAg\nZW5oYW5jZXIuc2V0Qnl0ZWNvZGVXcml0ZXIobmV3IEJ5dGVjb2RlV3JpdGVy\nKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgd3JpdGUoQkNDbGFz\ncyBiYykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgICAg\nICBNYW5hZ2VkQ2xhc3NTdWJjbGFzc2VyLndyaXRlKGJjLCBlbmhhbmNlciwg\nbWFwLCBjLCBzdWJzLCBpbnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSk7CiAgICAgICAgICAgIGlmIChyZWRlZmluZSkgewogICAgICAg\nICAgICAgICAgZW5oYW5jZXIuc2V0UmVkZWZpbmUodHJ1ZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgZW5oYW5jZXIuc2V0Q3JlYXRlU3ViY2xhc3Mo\ndHJ1ZSk7CiAgICAgICAgICAgIGVuaGFuY2VyLnNldEFkZERlZmF1bHRDb25z\ndHJ1Y3Rvcih0cnVlKTsKCiAgICAgICAgICAgIC8vIHNldCB0aGlzIGJlZm9y\nZSBlbmhhbmNlbWVudCBhcyB3ZWxsIGFzIGFmdGVyIHNpbmNlIGVuaGFuY2Vt\nZW50CiAgICAgICAgICAgIC8vIHVzZXMgYSBkaWZmZXJlbnQgbWV0YWRhdGEg\ncmVwb3NpdG9yeSwgYW5kIHRoZSBtZXRhZGF0YSBjb25maWcKICAgICAgICAg\nICAgLy8gbWF0dGVycyBpbiB0aGUgZW5oYW5jZW1lbnQgY29udHJhY3QuIElu\nIG9yZGVyIHRvIGF2b2lkIGEgCiAgICAgICAgICAgIC8vIE51bGxQb2ludGVy\nRXhjZXB0aW9uLCBjaGVjayBmb3Igbm8gbWV0YWRhdGEgYW5kIHRocm93IGFu\nCiAgICAgICAgICAgIC8vIGV4Y2VwdGlvbiBpZiBub25lIGV4aXN0cy4gT3Ro\nZXJ3aXNlLCBkb24ndCBkbyBhbnkgd2FybmluZyBoZXJlLAogICAgICAgICAg\nICAvLyBzaW5jZSB3ZSdsbCBpc3N1ZSB3YXJuaW5ncyB3aGVuIHdlIGRvIHRo\nZSBmaW5hbCBtZXRhZGF0YQogICAgICAgICAgICAvLyByZWNvbmZpZ3VyYXRp\nb24gYXQgdGhlIGVuZCBvZiB0aGlzIG1ldGhvZC4KICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhID0gZW5oYW5jZXIuZ2V0TWV0YURhdGEoKTsKICAg\nICAgICAgICAgaWYgKG1ldGEgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE1ldGFEYXRhRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1tZXRh\nIiwgY2xzKSkuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY29uZmlndXJlTWV0YURhdGEobWV0YSwgY29uZiwgcmVkZWZpbmUs\nIGZhbHNlKTsKCiAgICAgICAgICAgIHVuc3BlY2lmaWVkID0gY29sbGVjdFJl\nbGF0ZWRVbnNwZWNpZmllZFR5cGVzKGVuaGFuY2VyLmdldE1ldGFEYXRhKCks\nIGNsYXNzZXMsIHVuc3BlY2lmaWVkKTsKCiAgICAgICAgICAgIGludCBydW5S\nZXN1bHQgPSBlbmhhbmNlci5ydW4oKTsKICAgICAgICAgICAgaWYgKHJ1blJl\nc3VsdCA9PSBQQ0VuaGFuY2VyLkVOSEFOQ0VfUEMpIHsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZXIucmVjb3Jk\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gb3VyIGltcGwgb2YgQnl0ZWNvZGVX\ncml0ZXIgZG9lc24ndCB0aHJvdyBJT0V4Y2VwdGlvbgogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYgKHVuc3BlY2lmaWVkICE9IG51bGwgJiYgIXVuc3BlY2lmaWVkLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoInVuc3BlY2lmaWVkLXVuZW5oYW5jZWQtdHlwZXMiLCBFeGNlcHRp\nb25zLnRvQ2xhc3NOYW1lcyhjbGFzc2VzKSwgCiAgICAgICAgICAgICAgICAg\nICAgdW5zcGVjaWZpZWQpKTsKCiAgICAgICAgQ2xhc3NSZWRlZmluZXIucmVk\nZWZpbmVDbGFzc2VzKGNvbmYsIG1hcCk7CiAgICAgICAgZm9yIChDbGFzczw/\nPiBjbHMgOiBtYXAua2V5U2V0KCkpIHsKICAgICAgICAgICAgc2V0SW50ZXJj\nZXB0aW5nKGNvbmYsIGVudkxvYWRlciwgY2xzKTsKICAgICAgICAgICAgY29u\nZmlndXJlTWV0YURhdGEoY29uZiwgZW52TG9hZGVyLCBjbHMsIHJlZGVmaW5l\nKTsKICAgICAgICB9CiAgICAgICAgZm9yIChDbGFzczw/PiBjbHMgOiBzdWJz\nKQogICAgICAgICAgICBjb25maWd1cmVNZXRhRGF0YShjb25mLCBlbnZMb2Fk\nZXIsIGNscywgcmVkZWZpbmUpOwogICAgICAgIGZvciAoQ2xhc3M8Pz4gY2xz\nIDogaW50cykKICAgICAgICAgICAgc2V0SW50ZXJjZXB0aW5nKGNvbmYsIGVu\ndkxvYWRlciwgY2xzKTsKCiAgICAgICAgcmV0dXJuIHN1YnM7CiAgICB9Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgU2V0PENsYXNzPD8+PiBjb2xsZWN0UmVsYXRl\nZFVuc3BlY2lmaWVkVHlwZXMoQ2xhc3NNZXRhRGF0YSBtZXRhLAogICAgICAg\nIENvbGxlY3Rpb248PyBleHRlbmRzIENsYXNzPD8+PiBjbGFzc2VzLCBTZXQ8\nQ2xhc3M8Pz4+IHVuc3BlY2lmaWVkKSB7CiAgICAgICAgdW5zcGVjaWZpZWQg\nPSBjb2xsZWN0VW5zcGVjaWZpZWRUeXBlKG1ldGEuZ2V0UENTdXBlcmNsYXNz\nKCksIGNsYXNzZXMsCiAgICAgICAgICAgIHVuc3BlY2lmaWVkKTsKCiAgICAg\nICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RmllbGRzKCkp\nIHsKICAgICAgICAgICAgaWYgKGZtZC5pc1RyYW5zaWVudCgpKQogICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGlmIChmbWQuaXNUeXBl\nUEMoKSkKICAgICAgICAgICAgICAgIHVuc3BlY2lmaWVkID0gY29sbGVjdFVu\nc3BlY2lmaWVkVHlwZShmbWQuZ2V0VHlwZSgpLCBjbGFzc2VzLAogICAgICAg\nICAgICAgICAgICAgIHVuc3BlY2lmaWVkKTsKICAgICAgICAgICAgaWYgKGZt\nZC5nZXRFbGVtZW50KCkgIT0gbnVsbCAmJiBmbWQuZ2V0RWxlbWVudCgpLmlz\nVHlwZVBDKCkpCiAgICAgICAgICAgICAgICB1bnNwZWNpZmllZCA9IGNvbGxl\nY3RVbnNwZWNpZmllZFR5cGUoZm1kLmdldEVsZW1lbnQoKS5nZXRUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgY2xhc3NlcywgdW5zcGVjaWZpZWQpOwog\nICAgICAgICAgICBpZiAoZm1kLmdldEtleSgpICE9IG51bGwgJiYgZm1kLmdl\ndEtleSgpLmlzVHlwZVBDKCkpCiAgICAgICAgICAgICAgICB1bnNwZWNpZmll\nZCA9IGNvbGxlY3RVbnNwZWNpZmllZFR5cGUoZm1kLmdldEtleSgpLmdldFR5\ncGUoKSwKICAgICAgICAgICAgICAgICAgICBjbGFzc2VzLCB1bnNwZWNpZmll\nZCk7CiAgICAgICAgICAgIGlmIChmbWQuZ2V0VmFsdWUoKSAhPSBudWxsICYm\nIGZtZC5nZXRWYWx1ZSgpLmlzVHlwZVBDKCkpCiAgICAgICAgICAgICAgICB1\nbnNwZWNpZmllZCA9IGNvbGxlY3RVbnNwZWNpZmllZFR5cGUoZm1kLmdldFZh\nbHVlKCkuZ2V0VHlwZSgpLAogICAgICAgICAgICAgICAgICAgIGNsYXNzZXMs\nIHVuc3BlY2lmaWVkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuc3Bl\nY2lmaWVkOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIFNldDxDbGFzczw/\nPj4gY29sbGVjdFVuc3BlY2lmaWVkVHlwZShDbGFzczw/PiBjbHMsCiAgICAg\nICAgQ29sbGVjdGlvbjw/IGV4dGVuZHMgQ2xhc3M8Pz4+IGNsYXNzZXMsIFNl\ndDxDbGFzczw/Pj4gdW5zcGVjaWZpZWQpIHsKICAgICAgICBpZiAoY2xzICE9\nIG51bGwgJiYgIWNsYXNzZXMuY29udGFpbnMoY2xzKQogICAgICAgICAgICAm\nJiAhSW1wbEhlbHBlci5pc01hbmFnZWRUeXBlKG51bGwsIGNscykKICAgICAg\nICAgICAgJiYgIWNscy5pc0ludGVyZmFjZSgpKSB7CiAgICAgICAgICAgIGlm\nICh1bnNwZWNpZmllZCA9PSBudWxsKQogICAgICAgICAgICAgICAgdW5zcGVj\naWZpZWQgPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4oKTsKICAgICAgICAgICAg\ndW5zcGVjaWZpZWQuYWRkKGNscyk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiB1bnNwZWNpZmllZDsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lk\nIGNvbmZpZ3VyZU1ldGFEYXRhKE9wZW5KUEFDb25maWd1cmF0aW9uIGNvbmYs\nCiAgICAgICAgQ2xhc3NMb2FkZXIgZW52TG9hZGVyLCBDbGFzczw/PiBjbHMs\nIGJvb2xlYW4gcmVkZWZpbmVBdmFpbGFibGUpIHsKICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSBjb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3Rh\nbmNlKCkKICAgICAgICAgICAgLmdldE1ldGFEYXRhKGNscywgZW52TG9hZGVy\nLCB0cnVlKTsKICAgICAgICBjb25maWd1cmVNZXRhRGF0YShtZXRhLCBjb25m\nLCByZWRlZmluZUF2YWlsYWJsZSwgdHJ1ZSk7CiAgICB9CgogICAgcHJpdmF0\nZSBzdGF0aWMgdm9pZCBjb25maWd1cmVNZXRhRGF0YShDbGFzc01ldGFEYXRh\nIG1ldGEsCiAgICAgICAgT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgYm9v\nbGVhbiByZWRlZmluZUF2YWlsYWJsZSwgYm9vbGVhbiB3YXJuKSB7CgogICAg\nICAgIHNldERldGFjaGVkU3RhdGUobWV0YSk7CgogICAgICAgIC8vIElmIHdh\ncm4gJiAoaW1wbGljaXQgZmllbGQgYWNjZXNzIHwgbWl4ZWQgYWNjZXNzKSAm\nIG5vcmVkZWYKICAgICAgICBpZiAod2FybiAmJiAoKEFjY2Vzc0NvZGUuaXNG\naWVsZChtZXRhLmdldEFjY2Vzc1R5cGUoKSkKICAgICAgICAgICAgJiYgIW1l\ndGEuaXNNaXhlZEFjY2VzcygpKSB8fCAgbWV0YS5pc01peGVkQWNjZXNzKCkp\nCiAgICAgICAgICAgICYmICFyZWRlZmluZUF2YWlsYWJsZSkgewogICAgICAg\nICAgICAvLyBvbmx5IHdhcm4gYWJvdXQgZGVjbGFyZWQgZmllbGRzOyBzdXBl\ncmNsYXNzIGZpZWxkcyB3aWxsIGJlCiAgICAgICAgICAgIC8vIHdhcm5lZCBh\nYm91dCB3aGVuIHRoZSBzdXBlcmNsYXNzIGlzIGhhbmRsZWQKICAgICAgICAg\nICAgZm9yIChGaWVsZE1ldGFEYXRhIGZtZCA6IG1ldGEuZ2V0RGVjbGFyZWRG\naWVsZHMoKSkgewogICAgICAgICAgICAgICAgaWYgKEFjY2Vzc0NvZGUuaXNQ\ncm9wZXJ0eShmbWQuZ2V0QWNjZXNzVHlwZSgpKSkKICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdl\ndFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgY2Fu\nIGxhemlseSBsb2FkIHRoZXNlLCBzaW5jZSB3ZSBvd24gdGhlCiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHJlbGF0aW9uc2hpcCBjb250YWluZXIKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmbWQu\naXNJbkRlZmF1bHRGZXRjaEdyb3VwKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICYmICEoZm1kLmlzVmVyc2lvbigpIHx8IGZtZC5pc1ByaW1hcnlL\nZXkoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZyBsb2cg\nPSBjb25mLmdldExvZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBPcGVuSlBBQ29uZmlndXJhdGlvbi5MT0dfRU5IQU5DRSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2cud2FybihfbG9jLmdldCgic3ViY2xh\nc3Nlci1mZXRjaC1ncm91cC1vdmVycmlkZSIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5nZXRO\nYW1lKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZtZC5zZXRJ\nbkRlZmF1bHRGZXRjaEdyb3VwKHRydWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCB3cml0ZShCQ0Ns\nYXNzIGJjLCBQQ0VuaGFuY2VyIGVuaGFuY2VyLAogICAgICAgIE1hcDxDbGFz\nczw/PiwgYnl0ZVtdPiBtYXAsIENsYXNzPD8+IGNscywgTGlzdDxDbGFzczw/\nPj4gc3VicywgTGlzdDxDbGFzczw/Pj4gaW50cykKICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewoKICAgICAgICBpZiAoYmMgPT0gZW5oYW5jZXIuZ2V0\nTWFuYWdlZFR5cGVCeXRlY29kZSgpKSB7CiAgICAgICAgICAgIC8vIGlmIGl0\nIHdhcyBhbHJlYWR5IGRlZmluZWQsIGRvbid0IHB1dCBpdCBpbiB0aGUgbWFw\nLAogICAgICAgICAgICAvLyBidXQgZG8gc2V0IHRoZSBtZXRhZGF0YSBhY2Nv\ncmRpbmdseS4KICAgICAgICAgICAgaWYgKGVuaGFuY2VyLmlzQWxyZWFkeVJl\nZGVmaW5lZCgpKQogICAgICAgICAgICAgICAgaW50cy5hZGQoYmMuZ2V0VHlw\nZSgpKTsKICAgICAgICAgICAgZWxzZSBpZiAoSmF2YVZlcnNpb25zLlZFUlNJ\nT04gPj0gNSkgewogICAgICAgICAgICAgICAgbWFwLnB1dChiYy5nZXRUeXBl\nKCksIGJjLnRvQnl0ZUFycmF5KCkpOwogICAgICAgICAgICAgICAgZGVidWdC\neXRlY29kZXMoYmMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgaWYgKCFlbmhhbmNlci5pc0FscmVhZHlTdWJjbGFzc2Vk\nKCkpIHsKICAgICAgICAgICAgICAgIGRlYnVnQnl0ZWNvZGVzKGJjKTsKICAg\nICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gdGhpcyBpcyB0aGUg\nbmV3IHN1YmNsYXNzCiAgICAgICAgICAgICAgICBDbGFzc0xvYWRlciBsb2Fk\nZXIgPSBHZW5lcmF0ZWRDbGFzc2VzLmdldE1vc3REZXJpdmVkTG9hZGVyKAog\nICAgICAgICAgICAgICAgICAgIGNscywgUGVyc2lzdGVuY2VDYXBhYmxlLmNs\nYXNzKTsKICAgICAgICAgICAgICAgIHN1YnMuYWRkKEdlbmVyYXRlZENsYXNz\nZXMubG9hZEJDQ2xhc3MoYmMsIGxvYWRlcikpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBkZWJ1Z0J5\ndGVjb2RlcyhCQ0NsYXNzIGJjKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIC8vIFdyaXRlIHRoZSBieXRlY29kZXMgdG8gZGlzayBmb3IgZGVidWdn\naW5nIHB1cnBvc2VzLgogICAgICAgIGlmICgidHJ1ZSIuZXF1YWxzKFN5c3Rl\nbS5nZXRQcm9wZXJ0eSgKICAgICAgICAgICAgTWFuYWdlZENsYXNzU3ViY2xh\nc3Nlci5jbGFzcy5nZXROYW1lKCkgKyAiLmR1bXBCeXRlY29kZXMiKSkpCiAg\nICAgICAgewogICAgICAgICAgICBGaWxlIHRtcCA9IG5ldyBGaWxlKFN5c3Rl\nbS5nZXRQcm9wZXJ0eSgiamF2YS5pby50bXBkaXIiKSk7CiAgICAgICAgICAg\nIEZpbGUgZGlyID0gbmV3IEZpbGUodG1wLCAib3BlbmpwYSIpOwogICAgICAg\nICAgICBkaXIgPSBuZXcgRmlsZShkaXIsICJwY3N1YmNsYXNzZXMiKTsKICAg\nICAgICAgICAgZGlyLm1rZGlycygpOwogICAgICAgICAgICBkaXIgPSBGaWxl\ncy5nZXRQYWNrYWdlRmlsZShkaXIsIGJjLmdldFBhY2thZ2VOYW1lKCksIHRy\ndWUpOwogICAgICAgICAgICBGaWxlIGYgPSBuZXcgRmlsZShkaXIsIGJjLmdl\ndENsYXNzTmFtZSgpICsgIi5jbGFzcyIpOwogICAgICAgICAgICBTeXN0ZW0u\nZXJyLnByaW50bG4oIldyaXRpbmcgdG8gIiArIGYpOwogICAgICAgICAgICBi\nYy53cml0ZShmKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgdm9pZCBzZXRJbnRlcmNlcHRpbmcoT3BlbkpQQUNvbmZpZ3VyYXRpb24g\nY29uZiwKICAgICAgICBDbGFzc0xvYWRlciBlbnZMb2FkZXIsIENsYXNzPD8+\nIGNscykgewogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGNvbmYuZ2V0\nTWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKQogICAgICAgICAgICAuZ2V0\nTWV0YURhdGEoY2xzLCBlbnZMb2FkZXIsIHRydWUpOwogICAgICAgIG1ldGEu\nc2V0SW50ZXJjZXB0aW5nKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICog\nSWYgdGhlIG1ldGFkYXRhIGlzIGNvbmZpZ3VyZWQgdG8gdXNlIGEgc3ludGhl\ndGljCiAgICAgKiBkZXRhY2hlZCBzdGF0ZSwgcmVzZXQgaXQgdG8gbm90IHVz\nZSBhIGRldGFjaGVkCiAgICAgKiBzdGF0ZSBmaWVsZCwgc2luY2Ugd2UgY2Fu\nJ3QgYWRkIGZpZWxkcyB3aGVuIHJlZGVmaW5pbmcuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIHZvaWQgc2V0RGV0YWNoZWRTdGF0ZShDbGFzc01ldGFE\nYXRhIG1ldGEpIHsKICAgICAgICBpZiAoQ2xhc3NNZXRhRGF0YS5TWU5USEVU\nSUMuZXF1YWxzKG1ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKSkKICAgICAgICAg\nICAgbWV0YS5zZXREZXRhY2hlZFN0YXRlKG51bGwpOwogICAgfQp9Cg==\n","encoding":"base64"}

