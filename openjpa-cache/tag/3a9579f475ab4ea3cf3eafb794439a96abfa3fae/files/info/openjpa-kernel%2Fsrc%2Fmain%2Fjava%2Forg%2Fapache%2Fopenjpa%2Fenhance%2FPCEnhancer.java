{"sha":"62b317fe33a4376ecb292031884c1578719c47ce","node_id":"MDQ6QmxvYjIwNjM2NDo2MmIzMTdmZTMzYTQzNzZlY2IyOTIwMzE4ODRjMTU3ODcxOWM0N2Nl","size":186796,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/62b317fe33a4376ecb292031884c1578719c47ce","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZTsKCmltcG9ydCBq\nYXZhLmlvLkV4dGVybmFsaXphYmxlOwppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2Jq\nZWN0SW5wdXQ7CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0U3RyZWFtOwpp\nbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXQ7CmltcG9ydCBqYXZhLmlvLk9i\namVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uT2JqZWN0U3RyZWFt\nQ2xhc3M7CmltcG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5n\nLnJlZmxlY3QuRmllbGQ7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5NZXRo\nb2Q7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1wb3J0\nIGphdmEubWF0aC5CaWdEZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0lu\ndGVnZXI7CmltcG9ydCBqYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7\nCmltcG9ydCBqYXZhLnNlY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTG9jYWxlOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5TZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU3Ry\naW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5PcGVu\nSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5j\nb25mLk9wZW5KUEFDb25maWd1cmF0aW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIuY29uZi5Db25maWd1cmF0aW9uczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIubG9nLkxvZzsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS5saWIubWV0YS5DbGFzc0FyZ1BhcnNlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5CeXRlY29kZVdyaXRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5GaWxlczsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5KMkRvUHJpdkhlbHBlcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuT3B0aW9uczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5TZXJ2aWNlczsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2NhbGl6ZXIu\nTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vz\nc0NvZGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRN\nZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFU\neXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRh\nUmVwb3NpdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZh\nbHVlU3RyYXRlZ2llczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLkdlbmVyYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5JbnRlcm5hbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJpZ0RlY2ltYWxJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJpZ0ludGVnZXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLkJ5dGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLkNoYXJJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRh\ndGVJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkRvdWJsZUlk\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRJZDsKaW1wb3J0IG9yZy5hcGFj\naGUub3BlbmpwYS51dGlsLkZsb2F0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5Mb25nSWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5PYmplY3RJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLlNob3J0SWQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5TdHJp\nbmdJZDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9wZW5KUEFF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2Vy\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW1w\nbEhlbHBlcjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuQkNDbGFzczsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuQkNGaWVsZDsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nQkNNZXRob2Q7CmltcG9ydCBzZXJwLmJ5dGVjb2RlLkNvZGU7CmltcG9ydCBz\nZXJwLmJ5dGVjb2RlLkNvbnN0YW50czsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUu\nRXhjZXB0aW9uczsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuRmllbGRJbnN0cnVj\ndGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuR2V0RmllbGRJbnN0cnVjdGlv\nbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuSWZJbnN0cnVjdGlvbjsKaW1wb3J0\nIHNlcnAuYnl0ZWNvZGUuSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVj\nb2RlLkp1bXBJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTG9h\nZEluc3RydWN0aW9uOwppbXBvcnQgc2VycC5ieXRlY29kZS5Mb29rdXBTd2l0\nY2hJbnN0cnVjdGlvbjsKaW1wb3J0IHNlcnAuYnl0ZWNvZGUuTWV0aG9kSW5z\ndHJ1Y3Rpb247CmltcG9ydCBzZXJwLmJ5dGVjb2RlLlByb2plY3Q7CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLlRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb247CmltcG9y\ndCBzZXJwLmJ5dGVjb2RlLkNsYXNzSW5zdHJ1Y3Rpb247CmltcG9ydCBzZXJw\nLnV0aWwuU3RyaW5nczsKCi8qKgogKiBCeXRlY29kZSBlbmhhbmNlciB1c2Vk\nIHRvIGVuaGFuY2UgcGVyc2lzdGVudCBjbGFzc2VzIGZyb20gbWV0YWRhdGEu\nIFRoZQogKiBlbmhhbmNlciBtdXN0IGJlIGludm9rZWQgb24gYWxsIHBlcnNp\nc3RlbmNlLWNhcGFibGUgYW5kIHBlcnNpc3RlbmNlIGF3YXJlCiAqIGNsYXNz\nZXMuCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpwdWJsaWMgY2xhc3Mg\nUENFbmhhbmNlciB7CiAgICAvLyBEZXNpZ25hdGVzIGEgdmVyc2lvbiBmb3Ig\nbWFpbnRhaW5pbmcgY29tcGF0YmlsaXR5IHdoZW4gUENFbmhhbmNlcgogICAg\nLy8gbW9kaWZpZXMgZW5oYW5jZW1lbnQgdGhhdCBjYW4gYnJlYWsgc2VyaWFs\naXphdGlvbiBvciBvdGhlciBjb250cmFjdHMKICAgIC8vIEVhY2ggZW5oYW5j\nZWQgY2xhc3Mgd2lsbCByZXR1cm4gdGhlIHZhbHVlIG9mIHRoaXMgZmllbGQg\ndmlhCiAgICAvLyBwdWJsaWMgaW50IGdldEVuaGFuY2VtZW50Q29udHJhY3RW\nZXJzaW9uKCkKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOSEFOQ0VS\nX1ZFUlNJT04gPSAyOwogICAgCiAgICBib29sZWFuIF9hZGRWZXJzaW9uSW5p\ndEZsYWcgPSB0cnVlOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVO\nSEFOQ0VfTk9ORSA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBF\nTkhBTkNFX0FXQVJFID0gMiA8PCAwOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5IQU5DRV9JTlRFUkZBQ0UgPSAyIDw8IDE7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBFTkhBTkNFX1BDID0gMiA8PCAyOwoKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFBSRSA9ICJwYyI7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIFN0cmluZyBJU0RFVEFDSEVEU1RBVEVERUZJTklU\nSVZFID0gUFJFIAogICAgICAgICsgImlzRGV0YWNoZWRTdGF0ZURlZmluaXRp\ndmUiOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENsYXNzIFBDVFlQRSA9\nIFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzczsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTTSA9IFBSRSArICJTdGF0ZU1hbmFnZXIiOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgU01UWVBFID0gU3RhdGVNYW5h\nZ2VyLmNsYXNzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIElO\nSEVSSVQgPSBQUkUgKyAiSW5oZXJpdGVkRmllbGRDb3VudCI7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ09OVEVYVE5BTUUgPSAiR2VuZXJp\nY0NvbnRleHQiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgVVNF\nUkVYQ0VQID0gVXNlckV4Y2VwdGlvbi5jbGFzczsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENsYXNzIElOVEVSTkVYQ0VQID0gSW50ZXJuYWxFeGNlcHRp\nb24uY2xhc3M7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbGFzcyBIRUxQ\nRVJUWVBFID0gUENSZWdpc3RyeS5jbGFzczsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBTVVBFUiA9IFBSRSArICJQQ1N1cGVyY2xhc3MiOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ2xhc3MgT0lERlNUWVBFID0gRmll\nbGRTdXBwbGllci5jbGFzczsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIENs\nYXNzIE9JREZDVFlQRSA9IEZpZWxkQ29uc3VtZXIuY2xhc3M7CiAgICAKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBWRVJTSU9OX0lOSVRfU1RS\nID0gIFBSRSArICJWZXJzaW9uSW5pdCI7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFja2FnZQog\nICAgICAgIChQQ0VuaGFuY2VyLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBSRURFRklORURfQVRUUklCVVRFCiAgICAgICAgPSBQ\nQ0VuaGFuY2VyLmNsYXNzLmdldE5hbWUoKSArICIjcmVkZWZpbmVkLXR5cGUi\nOwogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBBdXhpbGlhcnlFbmhh\nbmNlcltdIF9hdXhFbmhhbmNlcnM7CiAgICBzdGF0aWMgewogICAgICAgIENs\nYXNzW10gY2xhc3NlcyA9IFNlcnZpY2VzLmdldEltcGxlbWVudG9yQ2xhc3Nl\ncygKICAgICAgICAgICAgQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MsCiAgICAg\nICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24o\nQXV4aWxpYXJ5RW5oYW5jZXIuY2xhc3MpKSk7CiAgICAgICAgTGlzdCBhdXhF\nbmhhbmNlcnMgPSBuZXcgQXJyYXlMaXN0KGNsYXNzZXMubGVuZ3RoKTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF1eEVuaGFu\nY2Vycy5hZGQoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAg\nICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFuY2VBY3Rp\nb24oY2xhc3Nlc1tpXSkpKTsKICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dh\nYmxlIHQpIHsKICAgICAgICAgICAgICAgIC8vIGF1eCBlbmhhbmNlciBtYXkg\ncmVseSBvbiBub24tZXhpc3RhbnQgc3BlYyBjbGFzc2VzLCBldGMKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBfYXV4RW5oYW5jZXJzID0gKEF1\neGlsaWFyeUVuaGFuY2VyW10pIGF1eEVuaGFuY2Vycy50b0FycmF5CiAgICAg\nICAgKG5ldyBBdXhpbGlhcnlFbmhhbmNlclthdXhFbmhhbmNlcnMuc2l6ZSgp\nXSk7CiAgICB9CgogICAgcHJpdmF0ZSBCQ0NsYXNzIF9wYzsKICAgIHByaXZh\ndGUgZmluYWwgQkNDbGFzcyBfbWFuYWdlZFR5cGU7CiAgICBwcml2YXRlIGZp\nbmFsIE1ldGFEYXRhUmVwb3NpdG9yeSBfcmVwb3M7CiAgICBwcml2YXRlIGZp\nbmFsIENsYXNzTWV0YURhdGEgX21ldGE7CiAgICBwcml2YXRlIGZpbmFsIExv\nZyBfbG9nOwogICAgcHJpdmF0ZSBDb2xsZWN0aW9uIF9vaWRzID0gbnVsbDsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfZGVmQ29ucyA9IHRydWU7CiAgICBwcml2\nYXRlIGJvb2xlYW4gX3JlZGVmaW5lID0gZmFsc2U7CiAgICBwcml2YXRlIGJv\nb2xlYW4gX3N1YmNsYXNzID0gZmFsc2U7CiAgICBwcml2YXRlIGJvb2xlYW4g\nX2ZhaWwgPSBmYWxzZTsKICAgIHByaXZhdGUgU2V0IF92aW9sYXRpb25zID0g\nbnVsbDsKICAgIHByaXZhdGUgRmlsZSBfZGlyID0gbnVsbDsKICAgIHByaXZh\ndGUgQnl0ZWNvZGVXcml0ZXIgX3dyaXRlciA9IG51bGw7CiAgICBwcml2YXRl\nIE1hcCBfYmFja2luZ0ZpZWxkcyA9IG51bGw7IC8vIG1hcCBvZiBzZXQgLyBn\nZXQgbmFtZXMgPT4gZmllbGQgbmFtZXMKICAgIHByaXZhdGUgTWFwIF9hdHRy\nc1RvRmllbGRzID0gbnVsbDsgLy8gbWFwIG9mIGF0dHIgbmFtZXMgPT4gZmll\nbGQgbmFtZXMKICAgIHByaXZhdGUgTWFwIF9maWVsZHNUb0F0dHJzID0gbnVs\nbDsgLy8gbWFwIG9mIGZpZWxkIG5hbWVzID0+IGF0dHIgbmFtZXMKICAgIHBy\naXZhdGUgYm9vbGVhbiBfaXNBbHJlYWR5UmVkZWZpbmVkID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2lzQWxyZWFkeVN1YmNsYXNzZWQgPSBmYWxz\nZTsKICAgIHByaXZhdGUgYm9vbGVhbiBfYmNzQ29uZmlndXJlZCA9IGZhbHNl\nOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN1cHBseSBjb25maWd1\ncmF0aW9uIGFuZCB0eXBlIHRvIGVuaGFuY2UuIFRoaXMgd2lsbCBsb29rCiAg\nICAgKiB1cCB0aGUgbWV0YWRhdGEgZm9yIDxjb2RlPnR5cGU8L2NvZGU+IGZy\nb20gPGNvZGU+Y29uZjwvY29kZT4ncwogICAgICogcmVwb3NpdG9yeS4KICAg\nICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRp\nb24gY29uZiwgQ2xhc3MgdHlwZSkgewogICAgICAgIHRoaXMoY29uZiwgQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAg\nICAgICAgICAgLmxvYWRQcm9qZWN0Q2xhc3NBY3Rpb24obmV3IFByb2plY3Qo\nKSwgdHlwZSkpLAogICAgICAgICAgICAoTWV0YURhdGFSZXBvc2l0b3J5KSBu\ndWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBw\nbHkgY29uZmlndXJhdGlvbiBhbmQgdHlwZSB0byBlbmhhbmNlLiBUaGlzIHdp\nbGwgbG9vawogICAgICogdXAgdGhlIG1ldGFkYXRhIGZvciA8Y29kZT5tZXRh\nPC9jb2RlPiBieSBjb252ZXJ0aW5nIGJhY2sgdG8gYSBjbGFzcwogICAgICog\nYW5kIHRoZW4gbG9hZGluZyBmcm9tIDxjb2RlPmNvbmY8L2NvZGU+J3MgcmVw\nb3NpdG9yeS4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIoT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24gY29uZiwgQ2xhc3NNZXRhRGF0YSBtZXRhKSB7CiAg\nICAgICAgdGhpcyhjb25mLCBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdl\nZChKMkRvUHJpdkhlbHBlcgogICAgICAgICAgICAubG9hZFByb2plY3RDbGFz\nc0FjdGlvbihuZXcgUHJvamVjdCgpLCBtZXRhLmdldERlc2NyaWJlZFR5cGUo\nKSkpLAogICAgICAgICAgICBtZXRhLmdldFJlcG9zaXRvcnkoKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3Vy\nYXRpb24uCiAgICAgKgogICAgICogQHBhcmFtIHR5cGUgdGhlIGJ5dGVjb2Rl\nIHJlcHJlc2VudGF0aW9uIGZvIHRoZSB0eXBlIHRvCiAgICAgKiBlbmhhbmNl\nOyB0aGlzIGNhbiBiZSBjcmVhdGVkIGZyb20gYW55IHN0cmVhbSBvciBmaWxl\nCiAgICAgKiBAcGFyYW0gcmVwb3MgYSBtZXRhZGF0YSByZXBvc2l0b3J5IHRv\nIHVzZSBmb3IgbWV0YWRhdGEgYWNjZXNzLAogICAgICogb3IgbnVsbCB0byBj\ncmVhdGUgYSBuZXcgcmVwb3JpdG9yeTsgdGhlIHJlcG9zaXRvcnkKICAgICAq\nIGZyb20gdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24gaXNuJ3QgdXNlZCBieSBk\nZWZhdWx0CiAgICAgKiBiZWNhdXNlIHRoZSBjb25maWd1cmF0aW9uIG1pZ2h0\nIGJlIGFuCiAgICAgKiBpbXBsZW1lbnRhdGlvbi1zcGVjaWZpYyBzdWJjbGFz\ncyB3aG9zZSBtZXRhZGF0YQogICAgICogcmVxdWlyZWQgbW9yZSB0aGFuIGp1\nc3QgYmFzZSBtZXRhZGF0YSBmaWxlcwogICAgICogQGRlcHJlY2F0ZWQgdXNl\nIHtAbGluayAjUENFbmhhbmNlcihPcGVuSlBBQ29uZmlndXJhdGlvbiwgQkND\nbGFzcywKICAgICAgICBNZXRhRGF0YVJlcG9zaXRvcnksIENsYXNzTG9hZGVy\nKX0gaW5zdGVhZC4gCiAgICAgKi8KICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE9w\nZW5KUEFDb25maWd1cmF0aW9uIGNvbmYsIEJDQ2xhc3MgdHlwZSwKICAgICAg\nICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MpIHsKICAgICAgICB0aGlzKGNv\nbmYsIHR5cGUsIHJlcG9zLCBudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIENvbnN0cnVjdG9yLiBTdXBwbHkgY29uZmlndXJhdGlvbi4KICAgICAqCiAg\nICAgKiBAcGFyYW0gdHlwZSB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50YXRpb24g\nZm8gdGhlIHR5cGUgdG8KICAgICAqIGVuaGFuY2U7IHRoaXMgY2FuIGJlIGNy\nZWF0ZWQgZnJvbSBhbnkgc3RyZWFtIG9yIGZpbGUKICAgICAqIEBwYXJhbSBy\nZXBvcyBhIG1ldGFkYXRhIHJlcG9zaXRvcnkgdG8gdXNlIGZvciBtZXRhZGF0\nYSBhY2Nlc3MsCiAgICAgKiBvciBudWxsIHRvIGNyZWF0ZSBhIG5ldyByZXBv\ncml0b3J5OyB0aGUgcmVwb3NpdG9yeQogICAgICogZnJvbSB0aGUgZ2l2ZW4g\nY29uZmlndXJhdGlvbiBpc24ndCB1c2VkIGJ5IGRlZmF1bHQKICAgICAqIGJl\nY2F1c2UgdGhlIGNvbmZpZ3VyYXRpb24gbWlnaHQgYmUgYW4KICAgICAqIGlt\ncGxlbWVudGF0aW9uLXNwZWNpZmljIHN1YmNsYXNzIHdob3NlIG1ldGFkYXRh\nCiAgICAgKiByZXF1aXJlZCBtb3JlIHRoYW4ganVzdCBiYXNlIG1ldGFkYXRh\nIGZpbGVzCiAgICAgKiBAcGFyYW0gbG9hZGVyIHRoZSBlbnZpcm9ubWVudCBj\nbGFzc2xvYWRlciB0byB1c2UgZm9yIGxvYWRpbmcKICAgICAqIGNsYXNzZXMg\nYW5kIHJlc291cmNlcy4KICAgICAqLwogICAgcHVibGljIFBDRW5oYW5jZXIo\nT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQkNDbGFzcyB0eXBlLAogICAg\nICAgIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcywgQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgX21hbmFnZWRUeXBlID0gdHlwZTsKICAgICAgICBf\ncGMgPSB0eXBlOwoKICAgICAgICBfbG9nID0gY29uZi5nZXRMb2coT3BlbkpQ\nQUNvbmZpZ3VyYXRpb24uTE9HX0VOSEFOQ0UpOwoKICAgICAgICBpZiAocmVw\nb3MgPT0gbnVsbCkgewogICAgICAgICAgICBfcmVwb3MgPSBjb25mLm5ld01l\ndGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAgICAgICAgIF9yZXBv\ncy5zZXRTb3VyY2VNb2RlKE1ldGFEYXRhUmVwb3NpdG9yeS5NT0RFX01FVEEp\nOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICBfcmVwb3MgPSByZXBvczsK\nICAgICAgICBfbWV0YSA9IF9yZXBvcy5nZXRNZXRhRGF0YSh0eXBlLmdldFR5\ncGUoKSwgbG9hZGVyLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nb25zdHJ1Y3Rvci4gU3VwcGx5IHJlcG9zaXRvcnkuIFRoZSByZXBvc2l0b3J5\nJ3MgY29uZmlndXJhdGlvbiB3aWxsCiAgICAgKiBiZSB1c2VkLCBhbmQgdGhl\nIG1ldGFkYXRhIHBhc3NlZCBpbiB3aWxsIGJlIHVzZWQgYXMtaXMgd2l0aG91\ndCBkb2luZwogICAgICogYW55IGFkZGl0aW9uYWwgbG9va3Vwcy4gVGhpcyBp\ncyB1c2VmdWwgd2hlbiBydW5uaW5nIHRoZSBlbmhhbmNlcgogICAgICogZHVy\naW5nIG1ldGFkYXRhIGxvYWQuCiAgICAgKgogICAgICogQHBhcmFtIHJlcG9z\nIGEgbWV0YWRhdGEgcmVwb3NpdG9yeSB0byB1c2UgZm9yIG1ldGFkYXRhIGFj\nY2VzcywKICAgICAqIG9yIG51bGwgdG8gY3JlYXRlIGEgbmV3IHJlcG9yaXRv\ncnk7IHRoZSByZXBvc2l0b3J5CiAgICAgKiBmcm9tIHRoZSBnaXZlbiBjb25m\naWd1cmF0aW9uIGlzbid0IHVzZWQgYnkgZGVmYXVsdAogICAgICogYmVjYXVz\nZSB0aGUgY29uZmlndXJhdGlvbiBtaWdodCBiZSBhbgogICAgICogaW1wbGVt\nZW50YXRpb24tc3BlY2lmaWMgc3ViY2xhc3Mgd2hvc2UgbWV0YWRhdGEKICAg\nICAqIHJlcXVpcmVkIG1vcmUgdGhhbiBqdXN0IGJhc2UgbWV0YWRhdGEgZmls\nZXMKICAgICAqIEBwYXJhbSB0eXBlIHRoZSBieXRlY29kZSByZXByZXNlbnRh\ndGlvbiBmbyB0aGUgdHlwZSB0bwogICAgICogZW5oYW5jZTsgdGhpcyBjYW4g\nYmUgY3JlYXRlZCBmcm9tIGFueSBzdHJlYW0gb3IgZmlsZQogICAgICogQHBh\ncmFtIG1ldGEgdGhlIG1ldGFkYXRhIHRvIHVzZSBmb3IgcHJvY2Vzc2luZyB0\naGlzIHR5cGUuCiAgICAgKgogICAgICogQHNpbmNlIDEuMS4wCiAgICAgKi8K\nICAgIHB1YmxpYyBQQ0VuaGFuY2VyKE1ldGFEYXRhUmVwb3NpdG9yeSByZXBv\ncywgQkNDbGFzcyB0eXBlLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSkg\newogICAgICAgIF9tYW5hZ2VkVHlwZSA9IHR5cGU7CiAgICAgICAgX3BjID0g\ndHlwZTsKCiAgICAgICAgX2xvZyA9IHJlcG9zLmdldENvbmZpZ3VyYXRpb24o\nKQogICAgICAgICAgICAuZ2V0TG9nKE9wZW5KUEFDb25maWd1cmF0aW9uLkxP\nR19FTkhBTkNFKTsKCiAgICAgICAgX3JlcG9zID0gcmVwb3M7CiAgICAgICAg\nX21ldGEgPSBtZXRhOwogICAgfQoKICAgIHN0YXRpYyBTdHJpbmcgdG9QQ1N1\nYmNsYXNzTmFtZShDbGFzcyBjbHMpIHsKICAgICAgICByZXR1cm4gU3RyaW5n\ncy5nZXRQYWNrYWdlTmFtZShQQ0VuaGFuY2VyLmNsYXNzKSArICIuIgogICAg\nICAgICAgICArIGNscy5nZXROYW1lKCkucmVwbGFjZSgnLicsICckJykgKyAi\nJHBjc3ViY2xhc3MiOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBv\nciBub3QgPGNvZGU+Y2xhc3NOYW1lPC9jb2RlPiBpcyB0aGUgbmFtZSBmb3Ig\nYQogICAgICogZHluYW1pY2FsbHktY3JlYXRlZCBwZXJzaXN0ZW5jZS1jYXBh\nYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaXNQQ1N1YmNsYXNzTmFt\nZShTdHJpbmcgY2xhc3NOYW1lKSB7CiAgICAgICAgcmV0dXJuIGNsYXNzTmFt\nZS5zdGFydHNXaXRoKFN0cmluZ3MuZ2V0UGFja2FnZU5hbWUoUENFbmhhbmNl\nci5jbGFzcykpCiAgICAgICAgICAgICYmIGNsYXNzTmFtZS5lbmRzV2l0aCgi\nJHBjc3ViY2xhc3MiKTsKICAgIH0KCiAgICAvKioKICAgICAqIElmIDxjb2Rl\nPmNsYXNzTmFtZTwvY29kZT4gaXMgYSBkeW5hbWljYWxseS1jcmVhdGVkIHBl\ncnNpc3RlbmNlLWNhcGFibGUKICAgICAqIHN1YmNsYXNzIG5hbWUsIHJldHVy\nbnMgdGhlIG5hbWUgb2YgdGhlIGNsYXNzIHRoYXQgaXQgc3ViY2xhc3Nlcy4K\nICAgICAqIE90aGVyd2lzZSwgcmV0dXJucyA8Y29kZT5jbGFzc05hbWU8L2Nv\nZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIFN0cmluZyB0b01hbmFnZWRUeXBlTmFtZShTdHJpbmcg\nY2xhc3NOYW1lKSB7CiAgICAgICAgaWYgKGlzUENTdWJjbGFzc05hbWUoY2xh\nc3NOYW1lKSkgewogICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUu\nc3Vic3RyaW5nKAogICAgICAgICAgICAgICAgU3RyaW5ncy5nZXRQYWNrYWdl\nTmFtZShQQ0VuaGFuY2VyLmNsYXNzKS5sZW5ndGgoKSArIDEpOwogICAgICAg\nICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUuc3Vic3RyaW5nKDAsIGNsYXNz\nTmFtZS5sYXN0SW5kZXhPZigiJCIpKTsKICAgICAgICAgICAgLy8gdGhpcyBp\ncyBub3QgY29ycmVjdCBmb3IgbmVzdGVkIFBDcwogICAgICAgICAgICBjbGFz\nc05hbWUgPSBjbGFzc05hbWUucmVwbGFjZSgnJCcsICcuJyk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHJldHVybiBjbGFzc05hbWU7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4gU3VwcGx5IGNvbmZpZ3VyYXRp\nb24sIHR5cGUsIGFuZCBtZXRhZGF0YS4KICAgICAqLwogICAgcHVibGljIFBD\nRW5oYW5jZXIoT3BlbkpQQUNvbmZpZ3VyYXRpb24gY29uZiwgQkNDbGFzcyB0\neXBlLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIHRo\naXMoY29uZiwgdHlwZSwgbWV0YS5nZXRSZXBvc2l0b3J5KCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBieXRlY29kZSByZXByZXNlbnRh\ndGlvbiBvZiB0aGUgcGVyc2lzdGVuY2UtY2FwYWJsZSBjbGFzcwogICAgICog\nYmVpbmcgbWFuaXB1bGF0ZWQuCiAgICAgKi8KICAgIHB1YmxpYyBCQ0NsYXNz\nIGdldFBDQnl0ZWNvZGUoKSB7CiAgICAgICAgcmV0dXJuIF9wYzsKICAgIH0K\nCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYnl0ZWNvZGUgcmVwcmVzZW50\nYXRpb24gb2YgdGhlIG1hbmFnZWQgY2xhc3MgYmVpbmcKICAgICAqIG1hbmlw\ndWxhdGVkLiBUaGlzIGlzIHVzdWFsbHkgdGhlIHNhbWUgYXMge0BsaW5rICNn\nZXRQQ0J5dGVjb2RlfSwKICAgICAqIGV4Y2VwdCB3aGVuIHJ1bm5pbmcgdGhl\nIGVuaGFuY2VyIHRvIHJlZGVmaW5lIGFuZCBzdWJjbGFzcwogICAgICogZXhp\nc3RpbmcgcGVyc2lzdGVudCB0eXBlcy4KICAgICAqLwogICAgcHVibGljIEJD\nQ2xhc3MgZ2V0TWFuYWdlZFR5cGVCeXRlY29kZSgpIHsKICAgICAgICByZXR1\ncm4gX21hbmFnZWRUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIHRoZSBtZXRhZGF0YSBmb3IgdGhlIGNsYXNzIGJlaW5nIG1hbmlwdWxhdGVk\nLCBvciBudWxsIGlmIG5vdAogICAgICogYSBwZXJzaXN0ZW50IHR5cGUuCiAg\nICAgKi8KICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKCkg\newogICAgICAgIHJldHVybiBfbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGVuaGFuY2VyIHNo\nb3VsZCBhZGQgYSBuby1hcmdzCiAgICAgKiBjb25zdHJ1Y3RvciBpZiBvbmUg\naXMgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0aGUgY2xhc3MuIE9wZW5KUEEK\nICAgICAqIHJlcXVpcmVzIHRoYXQgYSBuby1hcmcgY29uc3RydWN0b3IgKHdo\nZXRoZXIgY3JlYXRlZCBieSB0aGUgY29tcGlsZXIKICAgICAqIG9yIGJ5IHRo\nZSB1c2VyKSBiZSBwcmVzZW50IGluIGEgUEMuCiAgICAgKi8KICAgIHB1Ymxp\nYyBib29sZWFuIGdldEFkZERlZmF1bHRDb25zdHJ1Y3RvcigpIHsKICAgICAg\nICByZXR1cm4gX2RlZkNvbnM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBIGJv\nb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBlbmhhbmNlciBzaG91bGQg\nYWRkIGEgbm8tYXJncwogICAgICogY29uc3RydWN0b3IgaWYgb25lIGlzIG5v\ndCBhbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNsYXNzLiBPcGVuSlBBCiAgICAg\nKiByZXF1aXJlcyB0aGF0IGEgbm8tYXJnIGNvbnN0cnVjdG9yICh3aGV0aGVy\nIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyCiAgICAgKiBvciBieSB0aGUgdXNl\ncikgYmUgcHJlc2VudCBpbiBhIFBDLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzZXRBZGREZWZhdWx0Q29uc3RydWN0b3IoYm9vbGVhbiBhZGREZWZhdWx0\nQ29uc3RydWN0b3IpIHsKICAgICAgICBfZGVmQ29ucyA9IGFkZERlZmF1bHRD\nb25zdHJ1Y3RvcjsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhl\nIGVuaGFuY2VyIHNob3VsZCBtdXRhdGUgaXRzIGFyZ3VtZW50cywgb3IganVz\ndCBydW4gdmFsaWRhdGlvbgogICAgICogYW5kIG9wdGlvbmFsIHN1YmNsYXNz\naW5nIGxvZ2ljIG9uIHRoZW0uIFVzdWFsbHkgdXNlZCBpbiBjb25qdW5jdGlv\nbiB3aXRoCiAgICAgKiA8Y29kZT5zZXRDcmVhdGVTdWJjbGFzcyh0cnVlKTwv\nY29kZT4uCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGdldFJlZGVmaW5lKCkgewogICAgICAgIHJldHVy\nbiBfcmVkZWZpbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\nZSBlbmhhbmNlciBzaG91bGQgbXV0YXRlIGl0cyBhcmd1bWVudHMsIG9yIGp1\nc3QgcnVuIHZhbGlkYXRpb24KICAgICAqIGFuZCBvcHRpb25hbCBzdWJjbGFz\nc2luZyBsb2dpYyBvbiB0aGVtLiBVc3VhbGx5IHVzZWQgaW4gY29uanVuY3Rp\nb24gd2l0aAogICAgICogPGNvZGU+c2V0Q3JlYXRlU3ViY2xhc3ModHJ1ZSk8\nL2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzZXRSZWRlZmluZShib29sZWFuIHJlZGVmaW5lKSB7\nCiAgICAgICAgX3JlZGVmaW5lID0gcmVkZWZpbmU7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhpcyBpbnN0YW5jZSBp\ncyBlbmhhbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAgICogcmVkZWZpbmVk\nLgogICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0FscmVhZHlSZWRlZmluZWQoKSB7CiAgICAgICAgcmV0\ndXJuIF9pc0FscmVhZHlSZWRlZmluZWQ7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaGV0aGVyIHRoZSB0eXBlIHRoYXQgdGhpcyBpbnN0YW5jZSBpcyBlbmhh\nbmNpbmcgaGFzIGFscmVhZHkgYmVlbgogICAgICogc3ViY2xhc3NlZCBpbiB0\naGlzIGluc3RhbmNlJ3MgZW52aXJvbm1lbnQgY2xhc3Nsb2FkZXIuCiAgICAg\nKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGlzQWxyZWFkeVN1YmNsYXNzZWQoKSB7CiAgICAgICAgcmV0dXJuIF9p\nc0FscmVhZHlTdWJjbGFzc2VkOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1ha2UgaXRzIGFyZ3VtZW50cyBw\nZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICogb3IgZ2VuZXJhdGUgYSBwZXJz\naXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgogICAgICoKICAgICAqIEBzaW5j\nZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRDcmVhdGVT\ndWJjbGFzcygpIHsKICAgICAgICByZXR1cm4gX3N1YmNsYXNzOwogICAgfQoK\nICAgIC8qKgogICAgICogV2hldGhlciB0aGUgZW5oYW5jZXIgc2hvdWxkIG1h\na2UgaXRzIGFyZ3VtZW50cyBwZXJzaXN0ZW5jZS1jYXBhYmxlLAogICAgICog\nb3IgZ2VuZXJhdGUgYSBwZXJzaXN0ZW5jZS1jYXBhYmxlIHN1YmNsYXNzLgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBzZXRDcmVhdGVTdWJjbGFzcyhib29sZWFuIHN1YmNsYXNzKSB7CiAg\nICAgICAgX3N1YmNsYXNzID0gc3ViY2xhc3M7CiAgICAgICAgX2FkZFZlcnNp\nb25Jbml0RmxhZyA9IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogV2hl\ndGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNlcyBwcm9w\nZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNpcyBzaG93\ncyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHByb3BlcnR5\nCiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBwdWJs\naWMgYm9vbGVhbiBnZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMoKSB7\nCiAgICAgICAgcmV0dXJuIF9mYWlsOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciB0byBmYWlsIGlmIHRoZSBwZXJzaXN0ZW50IHR5cGUgdXNlcyBw\ncm9wZXJ0eSBhY2Nlc3MgYW5kCiAgICAgKiBieXRlY29kZSBhbmFseXNpcyBz\naG93cyB0aGF0IGl0IG1heSBiZSB2aW9sYXRpbmcgT3BlbkpQQSdzIHByb3Bl\ncnR5CiAgICAgKiBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCBzZXRFbmZvcmNlUHJvcGVydHlSZXN0cmljdGlvbnMoYm9v\nbGVhbiBmYWlsKSB7CiAgICAgICAgX2ZhaWwgPSBmYWlsOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRvIGdlbmVy\nYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICogc3RydWN0\ndXJlIHdpbGwgYmUgY3JlYXRlZCBiZW5lYXRoIHRoaXMgZGlyZWN0b3J5LiBE\nZWZhdWx0cyB0bwogICAgICogb3ZlcndyaXRpbmcgdGhlIGV4aXN0aW5nIGNs\nYXNzIGZpbGUgaWYgbnVsbC4KICAgICAqLwogICAgcHVibGljIEZpbGUgZ2V0\nRGlyZWN0b3J5KCkgewogICAgICAgIHJldHVybiBfZGlyOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIGJhc2UgYnVpbGQgZGlyZWN0b3J5IHRvIGdlbmVy\nYXRlIGNvZGUgdG8uIFRoZSBwcm9wZXIgcGFja2FnZQogICAgICogc3RydWN0\ndXJlIHdpbGwgYmUgY3JlYWVkIGJlbmVhdGggdGhpcyBkaXJlY3RvcnkuIERl\nZmF1bHRzIHRvCiAgICAgKiBvdmVyd3JpdGluZyB0aGUgZXhpc3RpbmcgY2xh\nc3MgZmlsZSBpZiBudWxsLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzZXRE\naXJlY3RvcnkoRmlsZSBkaXIpIHsKICAgICAgICBfZGlyID0gZGlyOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjdXJyZW50IHtAbGluayBC\neXRlY29kZVdyaXRlcn0gdG8gd3JpdGUgdG8gb3IgbnVsbCBpZiBub25lLgog\nICAgICovCiAgICBwdWJsaWMgQnl0ZWNvZGVXcml0ZXIgZ2V0Qnl0ZWNvZGVX\ncml0ZXIoKSB7CiAgICAgICAgcmV0dXJuIF93cml0ZXI7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIHtAbGluayBCeXRlY29kZVdyaXRlcn0gdG8g\nd3JpdGUgdGhlIGJ5dGVjb2RlIHRvIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc2V0Qnl0ZWNvZGVXcml0ZXIoQnl0ZWNvZGVX\ncml0ZXIgd3JpdGVyKSB7CiAgICAgICAgX3dyaXRlciA9IHdyaXRlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gYnl0ZWNvZGUgZW5oYW5jZW1l\nbnRzLgogICAgICoKICAgICAqIEByZXR1cm4gPGNvZGU+RU5IQU5DRV8qPC9j\nb2RlPiBjb25zdGFudAogICAgICovCiAgICBwdWJsaWMgaW50IHJ1bigpIHsK\nICAgICAgICBDbGFzczw/PiB0eXBlID0gX21hbmFnZWRUeXBlLmdldFR5cGUo\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBtYW5hZ2VkIGlu\ndGVyZmFjZSwgc2tpcAogICAgICAgICAgICBpZiAoX3BjLmlzSW50ZXJmYWNl\nKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRU5IQU5DRV9JTlRFUkZBQ0U7\nCgogICAgICAgICAgICAvLyBjaGVjayBpZiBhbHJlYWR5IGVuaGFuY2VkCiAg\nICAgICAgICAgIENsYXNzTG9hZGVyIGxvYWRlciA9IEFjY2Vzc0NvbnRyb2xs\nZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKHR5cGUpKTsKICAgICAgICAgICAgZm9yIChDbGFzczw/PiBpZmFj\nZSA6IF9tYW5hZ2VkVHlwZS5nZXREZWNsYXJlZEludGVyZmFjZVR5cGVzKCkp\nIHsKICAgICAgICAgICAgICAgIGlmIChpZmFjZS5nZXROYW1lKCkuZXF1YWxz\nKFBDVFlQRS5nZXROYW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJwYy10eXBlIiwgdHlwZSwgbG9h\nZGVyKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBFTkhBTkNFX05PTkU7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgi\nZW5oYW5jZS1zdGFydCIsIHR5cGUsIGxvYWRlcikpOwogICAgICAgICAgICB9\nCgoKICAgICAgICAgICAgY29uZmlndXJlQkNzKCk7CgogICAgICAgICAgICAv\nLyB2YWxpZGF0ZSBwcm9wZXJ0aWVzIGJlZm9yZSByZXBsYWNpbmcgZmllbGQg\nYWNjZXNzIHNvIHRoYXQKICAgICAgICAgICAgLy8gd2UgYnVpbGQgdXAgYSBy\nZWNvcmQgb2YgYmFja2luZyBmaWVsZHMsIGV0YwogICAgICAgICAgICBpZiAo\naXNQcm9wZXJ0eUFjY2VzcyhfbWV0YSkpIHsKICAgICAgICAgICAgICAgIHZh\nbGlkYXRlUHJvcGVydGllcygpOwogICAgICAgICAgICAgICAgaWYgKGdldENy\nZWF0ZVN1YmNsYXNzKCkpCiAgICAgICAgICAgICAgICAgICAgYWRkQXR0cmli\ndXRlVHJhbnNsYXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2VzcygpOwogICAgICAgICAgICBw\ncm9jZXNzVmlvbGF0aW9ucygpOwoKICAgICAgICAgICAgaWYgKF9tZXRhICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGVuaGFuY2VDbGFzcygpOwogICAg\nICAgICAgICAgICAgYWRkRmllbGRzKCk7CiAgICAgICAgICAgICAgICBhZGRT\ndGF0aWNJbml0aWFsaXplcigpOwogICAgICAgICAgICAgICAgYWRkUENNZXRo\nb2RzKCk7CiAgICAgICAgICAgICAgICBhZGRBY2Nlc3NvcnMoKTsKICAgICAg\nICAgICAgICAgIGFkZEF0dGFjaERldGFjaENvZGUoKTsKICAgICAgICAgICAg\nICAgIGFkZFNlcmlhbGl6YXRpb25Db2RlKCk7CiAgICAgICAgICAgICAgICBh\nZGRDbG9uaW5nQ29kZSgpOwogICAgICAgICAgICAgICAgcnVuQXV4aWxpYXJ5\nRW5oYW5jZXJzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gRU5IQU5DRV9Q\nQzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKF9sb2cuaXNXYXJu\nRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0\nKCJwZXJzLWF3YXJlIiwgdHlwZSwgbG9hZGVyKSk7CiAgICAgICAgICAgIHJl\ndHVybiBFTkhBTkNFX0FXQVJFOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEdlbmVyYWxFeGNlcHRpb24oX2xvYy5nZXQoImVuaGFuY2UtZXJyb3IiLAog\nICAgICAgICAgICAgICAgdHlwZS5nZXROYW1lKCksIGUuZ2V0TWVzc2FnZSgp\nKSwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBjb25m\naWd1cmVCQ3MoKSB7CiAgICAgICAgaWYgKCFfYmNzQ29uZmlndXJlZCkgewog\nICAgICAgICAgICBpZiAoZ2V0UmVkZWZpbmUoKSkgewogICAgICAgICAgICAg\nICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXRBdHRyaWJ1dGUoUkVERUZJTkVEX0FU\nVFJJQlVURSkgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfbWFuYWdl\nZFR5cGUuYWRkQXR0cmlidXRlKFJFREVGSU5FRF9BVFRSSUJVVEUpOwogICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9pc0FscmVh\nZHlSZWRlZmluZWQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAg\nUENTdWJjbGFzc1ZhbGlkYXRvciB2YWwgPSBuZXcgUENTdWJjbGFzc1ZhbGlk\nYXRvcigKICAgICAgICAgICAgICAgICAgICBfbWV0YSwgX21hbmFnZWRUeXBl\nLCBfbG9nLCBfZmFpbCk7CiAgICAgICAgICAgICAgICB2YWwuYXNzZXJ0Q2Fu\nU3ViY2xhc3MoKTsKCiAgICAgICAgICAgICAgICBfcGMgPSBfbWFuYWdlZFR5\ncGUuZ2V0UHJvamVjdCgpLmxvYWRDbGFzcygKICAgICAgICAgICAgICAgICAg\nICB0b1BDU3ViY2xhc3NOYW1lKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCkpKTsK\nICAgICAgICAgICAgICAgIGlmIChfcGMuZ2V0U3VwZXJjbGFzc0JDKCkgIT0g\nX21hbmFnZWRUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgX3BjLnNldFN1\ncGVyY2xhc3MoX21hbmFnZWRUeXBlKTsKICAgICAgICAgICAgICAgICAgICBf\ncGMuc2V0QWJzdHJhY3QoX21hbmFnZWRUeXBlLmlzQWJzdHJhY3QoKSk7CiAg\nICAgICAgICAgICAgICAgICAgX3BjLmRlY2xhcmVJbnRlcmZhY2UoRHluYW1p\nY1BlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcyk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgIF9pc0FscmVhZHlTdWJjbGFz\nc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgX2Jjc0NvbmZpZ3VyZWQgPSB0cnVlOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBnZW5lcmF0ZWQgYnl0\nZWNvZGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlY29yZCgpCiAgICAg\nICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoX21hbmFnZWRU\neXBlICE9IF9wYyAmJiBnZXRSZWRlZmluZSgpKQogICAgICAgICAgICByZWNv\ncmQoX21hbmFnZWRUeXBlKTsKICAgICAgICByZWNvcmQoX3BjKTsKICAgICAg\nICBpZiAoX29pZHMgIT0gbnVsbCkKICAgICAgICAgICAgZm9yIChJdGVyYXRv\nciBpdHIgPSBfb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAg\nICAgICAgICAgICAgIHJlY29yZCgoQkNDbGFzcykgaXRyLm5leHQoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSB0aGUgZ2l2ZW4gY2xhc3MuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWNvcmQoQkNDbGFzcyBiYykKICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChfd3JpdGVy\nICE9IG51bGwpCiAgICAgICAgICAgIF93cml0ZXIud3JpdGUoYmMpOwogICAg\nICAgIGVsc2UgaWYgKF9kaXIgPT0gbnVsbCkKICAgICAgICAgICAgYmMud3Jp\ndGUoKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgRmlsZSBkaXIgPSBG\naWxlcy5nZXRQYWNrYWdlRmlsZShfZGlyLCBiYy5nZXRQYWNrYWdlTmFtZSgp\nLCB0cnVlKTsKICAgICAgICAgICAgYmMud3JpdGUobmV3IEZpbGUoZGlyLCBi\nYy5nZXRDbGFzc05hbWUoKSArICIuY2xhc3MiKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgdGhhdCB0aGUgbWV0aG9kcyB0\naGF0IHVzZSBhIHByb3BlcnR5LWFjY2VzcyBpbnN0YW5jZSBhcmUKICAgICAq\nIHdyaXR0ZW4gY29ycmVjdGx5LiBUaGlzIG1ldGhvZCBhbHNvIGdhdGhlcnMg\naW5mb3JtYXRpb24gb24gZWFjaAogICAgICogcHJvcGVydHkncyBiYWNraW5n\nIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmFsaWRhdGVQcm9w\nZXJ0aWVzKCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzOwogICAg\nICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygpKQogICAgICAgICAgICBmbWRz\nID0gX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBmbWRzID0gX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBN\nZXRob2QgbWV0aDsKICAgICAgICBCQ01ldGhvZCBnZXR0ZXIsIHNldHRlcjsK\nICAgICAgICBCQ0ZpZWxkIHJldHVybmVkLCBhc3NpZ25lZCA9IG51bGw7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7\nCgogICAgICAgICAgICBpZiAoIShmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIo\nKSBpbnN0YW5jZW9mIE1ldGhvZCkgKSB7CiAgICAgICAgICAgICAgICAvLyBJ\nZiBub3QgbWl4ZWQgYWNjZXNzIGlzIG5vdCBkZWZpbmVkLCBmbGFnIHRoZSBm\naWVsZCBtZW1iZXJzLCAKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBk\nbyBub3QgcHJvY2VzcyB0aGVtIGJlY2F1c2UgdGhleSBhcmUgdmFsaWQKICAg\nICAgICAgICAgICAgIC8vIHBlcnNpc3RlbnQgYXR0cmlidXRlcy4KICAgICAg\nICAgICAgICAgIGlmICghX21ldGEuaXNNaXhlZEFjY2VzcygpKSB7CiAgICAg\nICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1iYWQtbWVt\nYmVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBm\nbWRzW2ldLCBmbWRzW2ldLmdldEJhY2tpbmdNZW1iZXIoKSB9LAogICAgICAg\nICAgICAgICAgICAgICAgICB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIAogICAgICAgICAgICBtZXRoID0gKE1ldGhvZCkgZm1kc1tpXS5nZXRC\nYWNraW5nTWVtYmVyKCk7CiAgICAgICAgICAgIC8vICMjIyMjIHRoaXMgd2ls\nbCBmYWlsIGlmIHdlIG92ZXJyaWRlIGFuZCBkb24ndCBjYWxsIHN1cGVyLgog\nICAgICAgICAgICBCQ0NsYXNzIGRlY2xhcmluZ1R5cGUgPSBfbWFuYWdlZFR5\ncGUuZ2V0UHJvamVjdCgpCiAgICAgICAgICAgICAgICAubG9hZENsYXNzKGZt\nZHNbaV0uZ2V0RGVjbGFyaW5nVHlwZSgpKTsKICAgICAgICAgICAgZ2V0dGVy\nID0gZGVjbGFyaW5nVHlwZS5nZXREZWNsYXJlZE1ldGhvZChtZXRoLmdldE5h\nbWUoKSwKICAgICAgICAgICAgICAgIG1ldGguZ2V0UGFyYW1ldGVyVHlwZXMo\nKSk7CiAgICAgICAgICAgIGlmIChnZXR0ZXIgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0eS1uby1nZXR0ZXIiLCBu\nZXcgT2JqZWN0W117IGZtZHNbaV0gfSwKICAgICAgICAgICAgICAgICAgICB0\ncnVlKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybmVkID0gZ2V0UmV0dXJuZWRGaWVsZChnZXR0\nZXIpOwogICAgICAgICAgICBpZiAocmV0dXJuZWQgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJlZ2lzdGVyQmFja2luZ0ZpZWxkSW5mbyhmbWRzW2ldLCBn\nZXR0ZXIsIHJldHVybmVkKTsKCiAgICAgICAgICAgIHNldHRlciA9IGRlY2xh\ncmluZ1R5cGUuZ2V0RGVjbGFyZWRNZXRob2QoZ2V0U2V0dGVyTmFtZShmbWRz\nW2ldKSwKICAgICAgICAgICAgICAgIG5ldyBDbGFzc1tdeyBmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgICAgICBpZiAoc2V0dGVyID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkVmlvbGF0aW9uKCJwcm9wZXJ0\neS1uby1zZXR0ZXIiLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2Jq\nZWN0W117IGZtZHNbaV0gfSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFnZXRSZWRl\nZmluZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIHN5bnRo\nZXRpYyBzZXR0ZXIKICAgICAgICAgICAgICAgICAgICBzZXR0ZXIgPSBfbWFu\nYWdlZFR5cGUuZGVjbGFyZU1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZHNbaV0p\nLAogICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xh\nc3NbXXsgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICAg\nICAgICAgICAgICBzZXR0ZXIubWFrZVByaXZhdGUoKTsKICAgICAgICAgICAg\nICAgICAgICBDb2RlIGNvZGUgPSBzZXR0ZXIuZ2V0Q29kZSh0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0VGhpcygpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQocmV0\ndXJuZWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUudnJldHVybigpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fscygp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpZiAoc2V0dGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICBhc3NpZ25l\nZCA9IGdldEFzc2lnbmVkRmllbGQoc2V0dGVyKTsKCiAgICAgICAgICAgIGlm\nIChhc3NpZ25lZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0\ndGVyICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJCYWNr\naW5nRmllbGRJbmZvKGZtZHNbaV0sIHNldHRlciwgYXNzaWduZWQpOwoKICAg\nICAgICAgICAgICAgIGlmIChhc3NpZ25lZCAhPSByZXR1cm5lZCkKICAgICAg\nICAgICAgICAgICAgICBhZGRWaW9sYXRpb24oInByb3BlcnR5LXNldHRlci1n\nZXR0ZXItbWlzbWF0Y2giLCBuZXcgT2JqZWN0W10KICAgICAgICAgICAgICAg\nICAgICAgICAgeyBmbWRzW2ldLCBhc3NpZ25lZC5nZXROYW1lKCksIChyZXR1\ncm5lZCA9PSBudWxsKSAKICAgICAgICAgICAgICAgICAgICAgICAgPyBudWxs\nIDogcmV0dXJuZWQuZ2V0TmFtZSgpIH0sIGZhbHNlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVnaXN0ZXJC\nYWNraW5nRmllbGRJbmZvKEZpZWxkTWV0YURhdGEgZm1kLCBCQ01ldGhvZCBt\nZXRob2QsCiAgICAgICAgQkNGaWVsZCBmaWVsZCkgewogICAgICAgIGlmIChf\nYmFja2luZ0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBfYmFja2luZ0Zp\nZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2JhY2tpbmdGaWVsZHMu\ncHV0KG1ldGhvZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7CgogICAg\nICAgIGlmIChfYXR0cnNUb0ZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICBf\nYXR0cnNUb0ZpZWxkcyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAgX2F0dHJz\nVG9GaWVsZHMucHV0KGZtZC5nZXROYW1lKCksIGZpZWxkLmdldE5hbWUoKSk7\nCgogICAgICAgIGlmIChfZmllbGRzVG9BdHRycyA9PSBudWxsKQogICAgICAg\nICAgICBfZmllbGRzVG9BdHRycyA9IG5ldyBIYXNoTWFwKCk7CiAgICAgICAg\nX2ZpZWxkc1RvQXR0cnMucHV0KGZpZWxkLmdldE5hbWUoKSwgZm1kLmdldE5h\nbWUoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGFkZEF0dHJpYnV0ZVRy\nYW5zbGF0aW9uKCkgewoKICAgICAgICAvLyBHZXQgYWxsIGZpZWxkIG1ldGFk\nYXRhCiAgICAgICAgQXJyYXlMaXN0PEludGVnZXI+IHByb3BGbWRzID0gbmV3\nIEFycmF5TGlzdDxJbnRlZ2VyPigpOwogICAgICAgIEZpZWxkTWV0YURhdGFb\nXSBmbWRzID0gX21ldGEuZ2V0RmllbGRzKCk7CgogICAgICAgIGlmIChfbWV0\nYS5pc01peGVkQWNjZXNzKCkpIHsKICAgICAgICAgICAgLy8gU3RvcmVzIGlu\nZGV4ZXMgb2YgcHJvcGVydHkgYWNjZXNzIGZpZWxkcyB0byBiZSB1c2VkIGlu\nCiAgICAgICAgICAgIC8vIAogICAgICAgICAgICBwcm9wRm1kcyA9IG5ldyBB\ncnJheUxpc3Q8SW50ZWdlcj4oKTsKICAgICAgICAgICAgCiAgICAgICAgICAg\nIC8vIERldGVybWluZSB3aGljaCBmaWVsZHMgaGF2ZSBwcm9wZXJ0eSBhY2Nl\nc3MgYW5kIHNhdmUgdGhlaXIgCiAgICAgICAgICAgIC8vIGluZGV4ZXMKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNQcm9wZXJ0eUFjY2VzcyhmbWRz\nW2ldKSkKICAgICAgICAgICAgICAgICAgICBwcm9wRm1kcy5hZGQoaSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIG5vIGZpZWxkcyBoYXZl\nIHByb3BlcnR5IGFjY2VzcyBkbyBub3QgZG8gYXR0cmlidXRlIHRyYW5zbGF0\naW9uCiAgICAgICAgICAgIGlmIChwcm9wRm1kcy5zaXplKCkgPT0gMCkKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF9wYy5k\nZWNsYXJlSW50ZXJmYWNlKEF0dHJpYnV0ZVRyYW5zbGF0b3IuY2xhc3MpOwog\nICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJBdHRyaWJ1dGVJbmRleFRvRmllbGROYW1lIiwKICAgICAgICAgICAg\nU3RyaW5nLmNsYXNzLCBuZXcgQ2xhc3NbXSB7IGludC5jbGFzcyB9KTsKICAg\nICAgICBtZXRob2QubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzd2l0Y2ggKHZh\nbCkKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\naWYgKCFfbWV0YS5pc01peGVkQWNjZXNzKCkpIHsKICAgICAgICAgICAgLy8g\naWYgbm90IG1peGVkIGFjY2VzcyB1c2UgYSB0YWJsZSBzd2l0Y2ggb24gYWxs\nIHByb3BlcnR5LWJhc2VkIGZtZC4KICAgICAgICAgICAgLy8gYSB0YWJsZSBz\nd2l0Y2ggaXMgbW9yZSBlZmZpY2llbnQgd2l0aCArMSBpbmNyZW1lbnRhbCBv\ncGVyYXRpb25zCiAgICAgICAgICAgIFRhYmxlU3dpdGNoSW5zdHJ1Y3Rpb24g\ndGFiaW5zID0gY29kZS50YWJsZXN3aXRjaCgpOwogICAgICAgICAgICAKICAg\nICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5z\nLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIC8vIGNh\nc2UgaToKICAgICAgICAgICAgLy8gICAgIHJldHVybiA8X2F0dHJzVG9GaWVs\nZHMuZ2V0KGZtZHNbaV0uZ2V0TmFtZSgpKT4KICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICB0YWJpbnMuYWRkVGFyZ2V0KGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZSgKICAgICAgICAgICAgICAgICAgICBfYXR0cnNUb0ZpZWxkcy5nZXQoZm1k\nc1tpXS5nZXROYW1lKCkpKSk7CiAgICAgICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAgICAgICAv\nLyBkZWZhdWx0OiB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nICgpCiAgICAgICAgICAgIHRhYmlucy5zZXREZWZhdWx0VGFyZ2V0KHRocm93\nRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoY29kZSwgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uLmNsYXNzKSk7CiAgICAgICAgfQogICAgICAgIGVsc2Ug\newogICAgICAgICAgICAvLyBJbiBtaXhlZCBhY2Nlc3MgbW9kZSwgcHJvcGVy\ndHkgaW5kZXhlcyBhcmUgbm90ICsxIGluY3JlbWVudGFsIAogICAgICAgICAg\nICAvLyBhIGxvb2t1cCBzd2l0Y2ggbXVzdCBiZSB1c2VkIHRvIGRvIGluZGV4\nZWQgbG9va3VwLgogICAgICAgICAgICBMb29rdXBTd2l0Y2hJbnN0cnVjdGlv\nbiBsb29rdXBpbnMgPSBjb2RlLmxvb2t1cHN3aXRjaCgpOwogICAgICAgICAg\nICAKICAgICAgICAgICAgZm9yIChJbnRlZ2VyIGkgOiBwcm9wRm1kcykgewog\nICAgICAgICAgICAgICAgbG9va3VwaW5zLmFkZENhc2UoaSwKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoCiAgICAgICAg\nICAgICAgICAgICAgX2F0dHJzVG9GaWVsZHMuZ2V0KGZtZHNbaV0uZ2V0TmFt\nZSgpKSkpOwogICAgICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAg\nICAgICAgIH0gICAgICAgICAgICAKICAgICAgICAgICAgLy8gZGVmYXVsdDog\ndGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAg\nICAgICBsb29rdXBpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlv\nbgogICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbi5jbGFzcykpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nbmFtZSBvZiB0aGUgc2V0dGVyIG1ldGhvZCBmb3IgdGhlIGdpdmVuIGZpZWxk\nLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgZ2V0U2V0dGVy\nTmFtZShGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIHJldHVybiAic2V0\nIiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdldE5hbWUoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZpZWxkIHJldHVybmVk\nIGJ5IHRoZSBnaXZlbiBtZXRob2QsIG9yIG51bGwgaWYgbm9uZS4KICAgICAq\nIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBzdGF0aWMgZm9yIHRlc3RpbmcuCiAg\nICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxkIGdldFJldHVybmVkRmllbGQoQkNN\nZXRob2QgbWV0aCkgewogICAgICAgIHJldHVybiBmaW5kRmllbGQobWV0aCwg\nKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS54cmV0dXJuKCkKICAg\nICAgICAgICAgLnNldFR5cGUobWV0aC5nZXRSZXR1cm5UeXBlKCkpLCBmYWxz\nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGZpZWxkIGFz\nc2lnbmVkIGluIHRoZSBnaXZlbiBtZXRob2QsIG9yIG51bGwgaWYgbm9uZS4K\nICAgICAqIFBhY2thZ2UtcHJvdGVjdGVkIGFuZCBzdGF0aWMgZm9yIHRlc3Rp\nbmcuCiAgICAgKi8KICAgIHN0YXRpYyBCQ0ZpZWxkIGdldEFzc2lnbmVkRmll\nbGQoQkNNZXRob2QgbWV0aCkgewogICAgICAgIHJldHVybiBmaW5kRmllbGQo\nbWV0aCwgKEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICBKMkRvUHJpdkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpKS5wdXRmaWVs\nZCgpLCB0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\nZmllbGQgcmV0dXJuZWQgLyBhc3NpZ25lZCBieSA8Y29kZT5tZXRoPC9jb2Rl\nPi4gUmV0dXJucwogICAgICogbnVsbCBpZiBub24tZmllbGRzIChtZXRob2Rz\nLCBsaXRlcmFscywgcGFyYW1ldGVycywgdmFyaWFibGVzKSBhcmUKICAgICAq\nIHJldHVybmVkLCBvciBpZiBub24tcGFyYW1ldGVycyBhcmUgYXNzaWduZWQg\ndG8gZmllbGRzLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBCQ0ZpZWxk\nIGZpbmRGaWVsZChCQ01ldGhvZCBtZXRoLCBJbnN0cnVjdGlvbiB0ZW1wbGF0\nZSwKICAgICAgICBib29sZWFuIGZpbmRBY2Nlc3NlZCkgewogICAgICAgIC8v\nIGlnbm9yZSBhbnkgc3RhdGljIG1ldGhvZHMuIE9wZW5KUEEgb25seSBjdXJy\nZW50bHkgc3VwcG9ydHMKICAgICAgICAvLyBub24tc3RhdGljIHNldHRlcnMg\nYW5kIGdldHRlcnMKICAgICAgICBpZiAobWV0aC5pc1N0YXRpYygpKQogICAg\nICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgQ29kZSBjb2RlID0gbWV0\naC5nZXRDb2RlKGZhbHNlKTsKICAgICAgICBpZiAoY29kZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICBjb2RlLmJlZm9yZUZp\ncnN0KCk7CgogICAgICAgIEJDRmllbGQgZmllbGQgPSBudWxsLCBjdXI7CiAg\nICAgICAgSW5zdHJ1Y3Rpb24gdGVtcGxhdGVJbnMsIHByZXZJbnMsIGVhcmxp\nZXJJbnM7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNoRm9yd2FyZCh0ZW1w\nbGF0ZSkpIHsKICAgICAgICAgICAgaW50IGJhY2t1cENvdW50ID0gMzsKICAg\nICAgICAgICAgdGVtcGxhdGVJbnMgPSBjb2RlLnByZXZpb3VzKCk7CiAgICAg\nICAgICAgIGlmICghY29kZS5oYXNQcmV2aW91cygpKQogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHByZXZJbnMgPSBjb2RlLnBy\nZXZpb3VzKCk7CgogICAgICAgICAgICBpZiAocHJldklucyBpbnN0YW5jZW9m\nIENsYXNzSW5zdHJ1Y3Rpb24KICAgICAgICAgICAgICAgICYmIGNvZGUuaGFz\nUHJldmlvdXMoKSkgewogICAgICAgICAgICAgICAgcHJldklucyA9IGNvZGUu\ncHJldmlvdXMoKTsKICAgICAgICAgICAgICAgIGJhY2t1cENvdW50Kys7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghY29kZS5oYXNQcmV2aW91\ncygpKQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIGVhcmxpZXJJbnMgPSBjb2RlLnByZXZpb3VzKCk7CgogICAgICAgICAgICAv\nLyBpZiB0aGUgb3Bjb2RlIHR3byBiZWZvcmUgdGhlIHRlbXBsYXRlIHdhcyBh\nbiBhbG9hZF8wLCBjaGVjawogICAgICAgICAgICAvLyBhZ2FpbnN0IHRoZSBt\naWRkbGUgaW5zdHJ1Y3Rpb24gYmFzZWQgb24gd2hhdCB0eXBlIG9mIGZpbmQK\nICAgICAgICAgICAgLy8gd2UncmUgZG9pbmcKICAgICAgICAgICAgaWYgKCEo\nZWFybGllcklucyBpbnN0YW5jZW9mIExvYWRJbnN0cnVjdGlvbikKICAgICAg\nICAgICAgICAgIHx8ICEoKExvYWRJbnN0cnVjdGlvbikgZWFybGllcklucyku\naXNUaGlzKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAg\nICAgICAgIC8vIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGEgZ2V0\nZmllbGQsIHRoZW4gaXQncyB0aGUKICAgICAgICAgICAgLy8gZmllbGQgdGhh\ndCdzIGJlaW5nIGFjY2Vzc2VkCiAgICAgICAgICAgIGlmICghZmluZEFjY2Vz\nc2VkICYmIHByZXZJbnMgaW5zdGFuY2VvZiBHZXRGaWVsZEluc3RydWN0aW9u\nKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZQ\ncmV2SW5zID0gKEZpZWxkSW5zdHJ1Y3Rpb24pIHByZXZJbnM7CiAgICAgICAg\nICAgICAgICBjdXIgPSBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRGaWVsZElu\nc3RydWN0aW9uRmllbGRBY3Rpb24oZlByZXZJbnMpKTsKICAgICAgICAgICAg\nICAgIC8vIGlmIHRoZSBtaWRkbGUgaW5zdHJ1Y3Rpb24gd2FzIGFuIHhsb2Fk\nXzEsIHRoZW4gdGhlCiAgICAgICAgICAgICAgICAvLyBtYXRjaGVkIGluc3Ry\ndWN0aW9uIGlzIHRoZSBmaWVsZCB0aGF0J3MgYmVpbmcgc2V0LgogICAgICAg\nICAgICB9IGVsc2UgaWYgKGZpbmRBY2Nlc3NlZCAmJiBwcmV2SW5zIGluc3Rh\nbmNlb2YgTG9hZEluc3RydWN0aW9uCiAgICAgICAgICAgICAgICAmJiAoKExv\nYWRJbnN0cnVjdGlvbikgcHJldklucykuZ2V0UGFyYW0oKSA9PSAwKSB7CiAg\nICAgICAgICAgICAgICBmaW5hbCBGaWVsZEluc3RydWN0aW9uIGZUZW1wbGF0\nZUlucyA9CiAgICAgICAgICAgICAgICAgICAgKEZpZWxkSW5zdHJ1Y3Rpb24p\nIHRlbXBsYXRlSW5zOwogICAgICAgICAgICAgICAgY3VyID0gQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAg\nICAgICAgICAgICAuZ2V0RmllbGRJbnN0cnVjdGlvbkZpZWxkQWN0aW9uKGZU\nZW1wbGF0ZUlucykpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgaWYgKGZpZWxkICE9IG51\nbGwgJiYgY3VyICE9IGZpZWxkKQogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIGZpZWxkID0gY3VyOwoKICAgICAgICAgICAgLy8g\ncmVhZHkgZm9yIG5leHQgc2VhcmNoIGl0ZXJhdGlvbgogICAgICAgICAgICB3\naGlsZSAoYmFja3VwQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBjb2Rl\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGJhY2t1cENvdW50LS07CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZpZWxkOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVjb3JkIGEgdmlvbGF0aW9uIG9mIHRoZSBw\ncm9wZXJ0eSBhY2Nlc3MgcmVzdHJpY3Rpb25zLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkVmlvbGF0aW9uKFN0cmluZyBrZXksIE9iamVjdFtdIGFy\nZ3MsIGJvb2xlYW4gZmF0YWwpIHsKICAgICAgICBpZiAoX3Zpb2xhdGlvbnMg\nPT0gbnVsbCkKICAgICAgICAgICAgX3Zpb2xhdGlvbnMgPSBuZXcgSGFzaFNl\ndCgpOwogICAgICAgIF92aW9sYXRpb25zLmFkZChfbG9jLmdldChrZXksIGFy\nZ3MpKTsKICAgICAgICBfZmFpbCB8PSBmYXRhbDsKICAgIH0KCiAgICAvKioK\nICAgICAqIExvZyAvIHRocm93IHJlY29yZGVkIHByb3BlcnR5IGFjY2VzcyB2\naW9sYXRpb25zLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgcHJvY2Vzc1Zp\nb2xhdGlvbnMoKSB7CiAgICAgICAgaWYgKF92aW9sYXRpb25zID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU3RyaW5nIHNlcCA9IEoy\nRG9Qcml2SGVscGVyLmdldExpbmVTZXBhcmF0b3IoKTsKICAgICAgICBTdHJp\nbmdCdWlsZGVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAg\nZm9yIChJdGVyYXRvciBpdHIgPSBfdmlvbGF0aW9ucy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYuYXBwZW5kKGl0ci5u\nZXh0KCkpOwogICAgICAgICAgICBpZiAoaXRyLmhhc05leHQoKSkKICAgICAg\nICAgICAgICAgIGJ1Zi5hcHBlbmQoc2VwKTsKICAgICAgICB9CiAgICAgICAg\nTWVzc2FnZSBtc2cgPSBfbG9jLmdldCgicHJvcGVydHktdmlvbGF0aW9ucyIs\nIGJ1Zik7CgogICAgICAgIGlmIChfZmFpbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24obXNnKTsKICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgIF9sb2cud2Fybihtc2cpOwogICAg\nfQoKICAgIC8qKgogICAgICogUmVwbGFjZWQgYWxsIGRpcmVjdCBhY2Nlc3Mg\ndG8gbWFuYWdlZCBmaWVsZHMgd2l0aCB0aGUgYXBwcm9wcmlhdGUKICAgICAq\nIHBjR2V0L3BjU2V0IG1ldGhvZC4gTm90ZSB0aGF0IHRoaXMgaW5jbHVkZXMg\nYWNjZXNzIHRvIGZpZWxkcwogICAgICogb3duZWQgYnkgUGVyc2lzdGVuY2VD\nYXBhYmxlIGNsYXNzZXMgb3RoZXIgdGhhbiB0aGlzIG9uZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNz\nKCkgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nY3JlYXRlIHRlbXBsYXRlIHB1dGZpZWxkL2dldGZpZWxkIGluc3RydWN0aW9u\ncyB0byBzZWFyY2ggZm9yCiAgICAgICAgQ29kZSB0ZW1wbGF0ZSA9IEFjY2Vz\nc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdDb2RlQWN0aW9uKCkpOwogICAgICAgIEluc3RydWN0aW9u\nIHB1dCA9IHRlbXBsYXRlLnB1dGZpZWxkKCk7CiAgICAgICAgSW5zdHJ1Y3Rp\nb24gZ2V0ID0gdGVtcGxhdGUuZ2V0ZmllbGQoKTsKICAgICAgICBJbnN0cnVj\ndGlvbiBzdGF0ID0gdGVtcGxhdGUuaW52b2tlc3RhdGljKCk7CgogICAgICAg\nIC8vIGxvb2sgdGhyb3VnaCBhbGwgbWV0aG9kczsgdGhpcyBpcyBkb25lIGJl\nZm9yZSBhbnkgbWV0aG9kcyBhcmUgYWRkZWQKICAgICAgICAvLyBzbyB3ZSBk\nb24ndCBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBzeW50aGV0aWMg\nbWV0aG9kcy4KICAgICAgICBCQ01ldGhvZFtdIG1ldGhvZHMgPSBfbWFuYWdl\nZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2RzKCk7CiAgICAgICAgQ29kZSBjb2Rl\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBjb2RlID0gbWV0aG9kc1tpXS5nZXRDb2Rl\nKGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGRvbid0IG1vZGlmeSB0aGUgbWV0\naG9kcyBzcGVjaWZpZWQgYnkgdGhlIGF1eGlsaWFyeSBlbmhhbmNlcnMKICAg\nICAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCAmJiAhc2tpcEVuaGFuY2UobWV0\naG9kc1tpXSkpIHsKICAgICAgICAgICAgICAgIHJlcGxhY2VBbmRWYWxpZGF0\nZUZpZWxkQWNjZXNzKGNvZGUsIGdldCwgdHJ1ZSwgc3RhdCk7CiAgICAgICAg\nICAgICAgICByZXBsYWNlQW5kVmFsaWRhdGVGaWVsZEFjY2Vzcyhjb2RlLCBw\ndXQsIGZhbHNlLCBzdGF0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFJlcGxhY2VzIGFsbCBpbnN0cnVjdGlvbnMg\nbWF0Y2hpbmcgdGhlIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBnaXZlbgogICAg\nICogY29kZSBibG9jayB3aXRoIGNhbGxzIHRvIHRoZSBhcHByb3ByaWF0ZSBn\nZW5lcmF0ZWQgZ2V0dGVyL3NldHRlci4KICAgICAqCiAgICAgKiBAcGFyYW0g\nY29kZSB0aGUgY29kZSBibG9jayB0byBtb2RpZnk7IHRoZSBjb2RlIGl0ZXJh\ndG9yIHdpbGwKICAgICAqIGJlIHBsYWNlZCBiZWZvcmUgdGhlIGZpcnN0IGlu\nc3RydWN0aW9uIG9uIG1ldGhvZCBzdGFydCwKICAgICAqIGFuZCB3aWxsIGJl\nIGFmdGVyIHRoZSBsYXN0IGluc3RydWN0aW9uIG9uIG1ldGhvZCBjb21wbGV0\naW9uCiAgICAgKiBAcGFyYW0gaW5zIHRoZSB0ZW1wbGF0ZSBpbnN0cnVjdGlv\nbiB0byBzZWFyY2ggZm9yOyBlaXRoZXIgYQogICAgICogZ2V0ZmllbGQgb3Ig\ncHV0ZmllbGQgaW5zdHJ1Y3Rpb24KICAgICAqIEBwYXJhbSBnZXQgYm9vbGVh\nbiBpbmRpY2F0aW5nIGlmIHRoaXMgaXMgYSBnZXQgaW5zdHJ1Y3Rpb24KICAg\nICAqIEBwYXJhbSBzdGF0IHRlbXBsYXRlIGludm9rZXN0YXRpYyBpbnN0cnVj\ndGlvbiB0byByZXBsYWNlIHdpdGgKICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHJlcGxhY2VBbmRWYWxpZGF0ZUZpZWxkQWNjZXNzKENvZGUgY29kZSwgSW5z\ndHJ1Y3Rpb24gaW5zLAogICAgICAgIGJvb2xlYW4gZ2V0LCBJbnN0cnVjdGlv\nbiBzdGF0KSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICBjb2RlLmJlZm9yZUZpcnN0KCk7CgogICAgICAgIEZpZWxkSW5zdHJ1Y3Rp\nb24gZmk7CiAgICAgICAgTWV0aG9kSW5zdHJ1Y3Rpb24gbWk7CiAgICAgICAg\nQ2xhc3NNZXRhRGF0YSBvd25lcjsKICAgICAgICBTdHJpbmcgbmFtZSwgdHlw\nZU5hbWUsIG1ldGhvZE5hbWU7CiAgICAgICAgd2hpbGUgKGNvZGUuc2VhcmNo\nRm9yd2FyZChpbnMpKSB7CiAgICAgICAgICAgIC8vIGJhY2sgdXAgdG8gdGhl\nIG1hdGNoZWQgaW5zdHJ1Y3Rpb24KICAgICAgICAgICAgZmkgPSAoRmllbGRJ\nbnN0cnVjdGlvbikgY29kZS5wcmV2aW91cygpOwogICAgICAgICAgICBuYW1l\nID0gZmkuZ2V0RmllbGROYW1lKCk7CiAgICAgICAgICAgIHR5cGVOYW1lID0g\nZmkuZ2V0RmllbGRUeXBlTmFtZSgpOwogICAgICAgICAgICBvd25lciA9IGdl\ndFBlcnNpc3RlbmNlQ2FwYWJsZU93bmVyKG5hbWUsIGZpLmdldEZpZWxkRGVj\nbGFyZXJUeXBlKCkpOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIG93bmVyID09IG51bGwgPyBudWxsIDogb3duZXIuZ2V0RmllbGQobmFtZSk7\nCiAgICAgICAgICAgIGlmIChpc1Byb3BlcnR5QWNjZXNzKGZtZCkpIHsKICAg\nICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGRpcmVjdGx5IGFjY2Vzc2luZyBh\nIGZpZWxkIGluIGFub3RoZXIgY2xhc3MKICAgICAgICAgICAgICAgIC8vIGhp\nZXJhcmNoeSB0aGF0IHVzZXMgcHJvcGVydHkgYWNjZXNzLCBzb21ldGhpbmcg\naXMgd3JvbmcKICAgICAgICAgICAgICAgIGlmIChvd25lciAhPSBfbWV0YSAm\nJiBvd25lci5nZXREZWNsYXJlZEZpZWxkKG5hbWUpICE9IG51bGwgJiYKICAg\nICAgICAgICAgICAgICAgICBfbWV0YSAhPSBudWxsICYmICFvd25lci5nZXRE\nZXNjcmliZWRUeXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmlzQXNz\naWduYWJsZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdl\ndCgicHJvcGVydHktZmllbGQtYWNjZXNzIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdeyBfbWV0YSwgb3duZXIsIG5hbWUsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmdldE1ldGhvZCgpLmdldE5h\nbWUoKSB9KSk7CgogICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgZGlyZWN0\nbHkgYWNjZXNzaW5nIGEgcHJvcGVydHktYmFja2luZyBmaWVsZCBvdXRzaWRl\nCiAgICAgICAgICAgICAgICAvLyB0aGUgcHJvcGVydHkgaW4gb3VyIG93biBj\nbGFzcywgbm90aWZ5IHVzZXIKICAgICAgICAgICAgICAgIGlmIChpc0JhY2tp\nbmdGaWVsZE9mQW5vdGhlclByb3BlcnR5KG5hbWUsIGNvZGUpKQogICAgICAg\nICAgICAgICAgICAgIGFkZFZpb2xhdGlvbigicHJvcGVydHktZmllbGQtYWNj\nZXNzIiwgbmV3IE9iamVjdFtdeyBfbWV0YSwKICAgICAgICAgICAgICAgICAg\nICAgICAgb3duZXIsIG5hbWUsIGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFtZSgp\nIH0sIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG93\nbmVyID09IG51bGwgfHwKICAgICAgICAgICAgICAgIG93bmVyLmdldERlY2xh\ncmVkRmllbGQoZnJvbUJhY2tpbmdGaWVsZE5hbWUobmFtZSkpID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBwZXJzaXN0ZW50IGZpZWxkPwog\nICAgICAgICAgICAgICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0UmVkZWZpbmUo\nKSAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKQogICAgICAgICAgICAgICAgJiYg\naXNGaWVsZEFjY2VzcyhmbWQpKSB7CiAgICAgICAgICAgICAgICAvLyByZXBs\nYWNlIHRoZSBpbnN0cnVjdGlvbiB3aXRoIGEgY2FsbCB0byB0aGUgZ2VuZXJh\ndGVkIGFjY2VzcwogICAgICAgICAgICAgICAgLy8gbWV0aG9kCiAgICAgICAg\nICAgICAgICBtaSA9IChNZXRob2RJbnN0cnVjdGlvbikgY29kZS5zZXQoc3Rh\ndCk7CgogICAgICAgICAgICAgICAgLy8gaW52b2tlIHRoZSBwcm9wZXIgYWNj\nZXNzIG1ldGhvZCwgd2hldGhlciBnZXR0ZXIgb3Igc2V0dGVyCiAgICAgICAg\nICAgICAgICBTdHJpbmcgcHJlZml4ID0gKGdldCkgPyBQUkUgKyAiR2V0IiA6\nIFBSRSArICJTZXQiOwogICAgICAgICAgICAgICAgbWV0aG9kTmFtZSA9IHBy\nZWZpeCArIG5hbWU7CiAgICAgICAgICAgICAgICBpZiAoZ2V0KSB7CiAgICAg\nICAgICAgICAgICAgICAgbWkuc2V0TWV0aG9kKGdldFR5cGUob3duZXIpLmdl\ndE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZSwg\ndHlwZU5hbWUsIG5ldyBTdHJpbmdbXQogICAgICAgICAgICAgICAgICAgICAg\nICB7IGdldFR5cGUob3duZXIpLmdldE5hbWUoKSB9KTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWkuc2V0TWV0aG9k\nKGdldFR5cGUob3duZXIpLmdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgbWV0aG9kTmFtZSwgInZvaWQiLCBuZXcgU3RyaW5nW10KICAgICAg\nICAgICAgICAgICAgICAgICAgeyBnZXRUeXBlKG93bmVyKS5nZXROYW1lKCks\nIHR5cGVOYW1lIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgY29kZS5uZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2V0UmVk\nZWZpbmUoKSkgewogICAgICAgICAgICAgICAgbmFtZSA9IGZyb21CYWNraW5n\nRmllbGROYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKGdldCkgewog\nICAgICAgICAgICAgICAgICAgIGFkZE5vdGlmeUFjY2Vzcyhjb2RlLCBvd25l\nci5nZXRGaWVsZChuYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5u\nZXh0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIC8vIGluc2VydCB0aGUgc2V0IG9wZXJhdGlvbnMgYWZ0ZXIgdGhl\nIGZpZWxkIG11dGF0aW9uLCBidXQKICAgICAgICAgICAgICAgICAgICAvLyBm\naXJzdCBsb2FkIHRoZSBvbGQgdmFsdWUgZm9yIHVzZSBpbiB0aGUKICAgICAg\nICAgICAgICAgICAgICAvLyBTdGF0ZU1hbmFnZXIuc2V0dGluZ1hYWCBtZXRo\nb2QuCiAgICAgICAgICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgRmllbGRJ\nbnN0cnVjdGlvbiBmRmkgPSBmaTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmdldGZpZWxkKCkuc2V0RmllbGQoCiAgICAgICAgICAgICAgICAgICAgICAg\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKEoyRG9Qcml2SGVscGVy\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0RmllbGRJbnN0cnVj\ndGlvbkZpZWxkQWN0aW9uKGZGaSkpKTsKICAgICAgICAgICAgICAgICAgICBp\nbnQgdmFsID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLnhzdG9yZSgpLnNldExvY2FsKHZhbCkuc2V0VHlw\nZShmaS5nZXRGaWVsZFR5cGUoKSk7CgogICAgICAgICAgICAgICAgICAgIC8v\nIG1vdmUgcGFzdCB0aGUgcHV0ZmllbGQKICAgICAgICAgICAgICAgICAgICBj\nb2RlLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBhZGROb3RpZnlNdXRh\ndGlvbihjb2RlLCBvd25lci5nZXRGaWVsZChuYW1lKSwgdmFsLCAtMSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBjb2RlLm5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBhZGROb3RpZnlBY2Nlc3MoQ29kZSBjb2RlLCBGaWVsZE1l\ndGFEYXRhIGZtZCkgewogICAgICAgIC8vIFBDSGVscGVyLmFjY2Vzc2luZ0Zp\nZWxkKHRoaXMsIDxhYnNvbHV0ZS1pbmRleD4pOwogICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKGZtZC5nZXRJbmRleCgpKTsKICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsCiAgICAg\nICAgICAgICJhY2Nlc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAg\nICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG11c3QgYmUgY2FsbGVkIGFm\ndGVyIHNldHRpbmcgdGhlIHZhbHVlIGluIHRoZSBvYmplY3QuCiAgICAgKiAK\nICAgICAqIEBwYXJhbSBjb2RlCiAgICAgKiBAcGFyYW0gdmFsIHRoZSBwb3Np\ndGlvbiBpbiB0aGUgbG9jYWwgdmFyaWFibGUgdGFibGUgd2hlcmUgdGhlCiAg\nICAgKiBvbGQgdmFsdWUgaXMgc3RvcmVkCiAgICAgKiBAcGFyYW0gcGFyYW0g\ndGhlIHBhcmFtZXRlciBwb3NpdGlvbiBjb250YWluaW5nIHRoZSBuZXcgdmFs\ndWUsIG9yCiAgICAgKiAtMSBpZiB0aGUgbmV3IHZhbHVlIGlzIHVuYXZhaWxh\nYmxlIGFuZCBzaG91bGQgdGhlcmVmb3JlIGJlIGxvb2tlZAogICAgICogdXAu\nCiAgICAgKiBAdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkTm90aWZ5TXV0YXRpb24oQ29kZSBjb2Rl\nLCBGaWVsZE1ldGFEYXRhIGZtZCwgaW50IHZhbCwKICAgICAgICBpbnQgcGFy\nYW0pCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gUENIZWxwZXIuc2V0dGluZ0ZpZWxkKHRoaXMsIDxhYnNvbHV0\nZS1pbmRleD4sIG9sZCwgbmV3KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0\nVGhpcygpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShmbWQu\nZ2V0SW5kZXgoKSk7CiAgICAgICAgQ2xhc3MgdHlwZSA9IGZtZC5nZXREZWNs\nYXJlZFR5cGUoKTsKICAgICAgICAvLyB3ZSBvbmx5IGhhdmUgc3BlY2lhbCBz\naWduYXR1cmVzIGZvciBwcmltaXRpdmVzIGFuZCBTdHJpbmdzCiAgICAgICAg\naWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBTdHJpbmcuY2xh\nc3MpCiAgICAgICAgICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAg\nY29kZS54bG9hZCgpLnNldExvY2FsKHZhbCkuc2V0VHlwZSh0eXBlKTsKICAg\nICAgICBpZiAocGFyYW0gPT0gLTEpIHsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0ocGFyYW0pLnNldFR5\ncGUodHlwZSk7CiAgICAgICAgfQogICAgICAgIGNvZGUuaW52b2tlc3RhdGlj\nKCkuc2V0TWV0aG9kKFJlZGVmaW5pdGlvbkhlbHBlci5jbGFzcywgInNldHRp\nbmdGaWVsZCIsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\nIHsKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywgaW50LmNsYXNzLCB0\neXBlLCB0eXBlCiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiB0aGUgZ2l2ZW4gaW5zdHJ1Y3Rpb24gYWNjZXNzZXMg\nYSBmaWVsZCB0aGF0IGlzIGEgYmFja2luZwogICAgICogZmllbGQgb2YgYW5v\ndGhlciBwcm9wZXJ0eSBpbiB0aGlzIHByb3BlcnR5LWFjY2VzcyBjbGFzcy4K\nICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFuIGlzQmFja2luZ0ZpZWxkT2ZB\nbm90aGVyUHJvcGVydHkoU3RyaW5nIG5hbWUsIENvZGUgY29kZSkgewogICAg\nICAgIFN0cmluZyBtZXRoTmFtZSA9IGNvZGUuZ2V0TWV0aG9kKCkuZ2V0TmFt\nZSgpOwogICAgICAgIHJldHVybiAhIjxpbml0PiIuZXF1YWxzKG1ldGhOYW1l\nKQogICAgICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcyAhPSBudWxsCiAgICAg\nICAgICAgICYmICFuYW1lLmVxdWFscyhfYmFja2luZ0ZpZWxkcy5nZXQobWV0\naE5hbWUpKQogICAgICAgICAgICAmJiBfYmFja2luZ0ZpZWxkcy5jb250YWlu\nc1ZhbHVlKG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1l\ndGhvZCB0byByZXR1cm4gdGhlIGRlY2xhcmluZyBQZXJzaXN0ZW5jZUNhcGFi\nbGUgY2xhc3Mgb2YKICAgICAqIHRoZSBnaXZlbiBmaWVsZC4KICAgICAqCiAg\nICAgKiBAcGFyYW0gZmllbGROYW1lIHRoZSBuYW1lIG9mIHRoZSBmaWVsZAog\nICAgICogQHBhcmFtIG93bmVyIHRoZSBub21pbmFsIG93bmVyIG9mIHRoZSBm\naWVsZAogICAgICogQHJldHVybiB0aGUgbWV0YWRhdGEgZm9yIHRoZSBQZXJz\naXN0ZW5jZUNhcGFibGUgdHlwZSB0aGF0CiAgICAgKiBkZWNsYXJlcyB0aGUg\nZmllbGQgKGFuZCB0aGVyZWZvcmUgaGFzIHRoZSBzdGF0aWMgbWV0aG9kKSwg\nb3IgbnVsbCBpZiBub25lCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3NNZXRh\nRGF0YSBnZXRQZXJzaXN0ZW5jZUNhcGFibGVPd25lcihTdHJpbmcgZmllbGRO\nYW1lLAogICAgICAgIENsYXNzIG93bmVyKSB7CiAgICAgICAgLy8gZmluZCB0\naGUgYWN0dWFsIGFuY2VzdG9yIGNsYXNzIHRoYXQgZGVjbGFyZXMgdGhlIGZp\nZWxkLCB0aGVuCiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGNsYXNzIGlzIHBl\ncnNpc3RlbnQsIGFuZCBpZiB0aGUgZmllbGQgaXMgbWFuYWdlZAogICAgICAg\nIEZpZWxkIGYgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvd25lciwgZmllbGRO\nYW1lLCBmYWxzZSk7CiAgICAgICAgaWYgKGYgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIG1hbmFnZWQgaW50ZXJmYWNl\nCiAgICAgICAgaWYgKF9tZXRhICE9IG51bGwgJiYgX21ldGEuZ2V0RGVzY3Jp\nYmVkVHlwZSgpLmlzSW50ZXJmYWNlKCkpCiAgICAgICAgICAgIHJldHVybiBf\nbWV0YTsKCiAgICAgICAgcmV0dXJuIF9yZXBvcy5nZXRNZXRhRGF0YShmLmdl\ndERlY2xhcmluZ0NsYXNzKCksIG51bGwsIGZhbHNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZHMgYWxsIHN5bnRoZXRpYyBtZXRob2RzIHRvIHRoZSBi\neXRlY29kZSBieSBkZWxlZ2F0aW5nIHRvCiAgICAgKiB0aGUgdmFyaW91cyBh\nZGRYWFhNZXRob2RzICgpIGZ1bmN0aW9ucyBpbiB0aGlzIGNsYXNzLiBJbmNs\ndWRlcwogICAgICogYWxsIHN0YXRpYyBmaWVsZCBhY2Nlc3MgbWV0aG9kcy4K\nICAgICAqIE5vdGUgdGhhdCB0aGUgJ3N0b2NrJyBtZXRob2RzIGxpa2UgPGNv\nZGU+cGNJc1RyYW5zYWN0aW9uYWw8L2NvZGU+LAogICAgICogPGNvZGU+cGNG\nZXRjaE9iamVjdElkPC9jb2RlPiwgZXRjIGFyZSBkZWZpbmVkIG9ubHkgaW4g\ndGhlCiAgICAgKiBsZWFzdC1kZXJpdmVkIFBlcnNpc3RlbmNlQ2FwYWJsZSB0\neXBlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkUENNZXRob2RzKCkK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICBhZGRDbGVhckZpZWxkc01ldGhvZCgpOwogICAgICAgIGFkZE5ld0luc3Rh\nbmNlTWV0aG9kKHRydWUpOwogICAgICAgIGFkZE5ld0luc3RhbmNlTWV0aG9k\nKGZhbHNlKTsKICAgICAgICBhZGRNYW5hZ2VkRmllbGRDb3VudE1ldGhvZCgp\nOwogICAgICAgIGFkZFJlcGxhY2VGaWVsZHNNZXRob2RzKCk7CiAgICAgICAg\nYWRkUHJvdmlkZUZpZWxkc01ldGhvZHMoKTsKICAgICAgICBhZGRDb3B5Rmll\nbGRzTWV0aG9kKCk7CgogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xh\nc3MoKSA9PSBudWxsIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAg\nICAgICAgYWRkU3RvY2tNZXRob2RzKCk7CiAgICAgICAgICAgIGFkZEdldFZl\ncnNpb25NZXRob2QoKTsKICAgICAgICAgICAgYWRkUmVwbGFjZVN0YXRlTWFu\nYWdlck1ldGhvZCgpOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50\naXR5VHlwZSgpICE9IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAg\nICAgICAgICAgICAgICBhZGROb09wQXBwbGljYXRpb25JZGVudGl0eU1ldGhv\nZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCB0aGUgYXBwIGlkIG1l\ndGhvZHMgdG8gZWFjaCBzdWJjbGFzcyByYXRoZXIKICAgICAgICAvLyB0aGFu\nIGp1c3QgdGhlIHN1cGVyY2xhc3MsIHNpbmNlIGl0IGlzIHBvc3NpYmxlIHRv\nIGhhdmUKICAgICAgICAvLyBhIHN1YmNsYXNzIHdpdGggYW4gYXBwIGlkIGhp\nZXJhcmNoeSB0aGF0IG1hdGNoZXMgdGhlCiAgICAgICAgLy8gcGVyc2lzdGVu\ndCBjbGFzcyBpbmhlcml0YW5jZSBoaWVyYXJjaHkKICAgICAgICBpZiAoX21l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBM\nSUNBVElPTgogICAgICAgICAgICAmJiAoX21ldGEuZ2V0UENTdXBlcmNsYXNz\nKCkgPT0gbnVsbCB8fCBnZXRDcmVhdGVTdWJjbGFzcygpIHx8CiAgICAgICAg\nICAgICAgICBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSAhPQogICAgICAgICAg\nICAgICAgICAgIF9tZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkuZ2V0\nT2JqZWN0SWRUeXBlKCkpKSB7CiAgICAgICAgICAgIGFkZENvcHlLZXlGaWVs\nZHNUb09iamVjdElkTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRDb3B5\nS2V5RmllbGRzVG9PYmplY3RJZE1ldGhvZChmYWxzZSk7CiAgICAgICAgICAg\nIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2QodHJ1ZSk7CiAg\nICAgICAgICAgIGFkZENvcHlLZXlGaWVsZHNGcm9tT2JqZWN0SWRNZXRob2Qo\nZmFsc2UpOwogICAgICAgICAgICBpZiAoX21ldGEuaGFzQWJzdHJhY3RQS0Zp\nZWxkKCkgPT0gdHJ1ZSkgeyAKICAgICAgICAgICAgICAgIGFkZEdldElET3du\naW5nQ2xhc3MoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGROZXdP\nYmplY3RJZEluc3RhbmNlTWV0aG9kKHRydWUpOwogICAgICAgICAgICBhZGRO\nZXdPYmplY3RJZEluc3RhbmNlTWV0aG9kKGZhbHNlKTsKICAgICAgICB9CiAg\nICAgICAgZWxzZSBpZiAoX21ldGEuaGFzUEtGaWVsZHNGcm9tQWJzdHJhY3RD\nbGFzcygpKXsgCiAgICAgICAgICAgIGFkZEdldElET3duaW5nQ2xhc3MoKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBtZXRob2Qg\ndG8gY2xlYXIgYWxsIHBlcnNpc3RlbnQgZmllbGRzOyB3ZSdsbCBjYWxsIHRo\naXMgZnJvbQogICAgICogdGhlIG5ldyBpbnN0YW5jZSBtZXRob2QgdG8gZW5z\ndXJlIHRoYXQgdW5sb2FkZWQgZmllbGRzIGhhdmUKICAgICAqIGRlZmF1bHQg\ndmFsdWVzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQ2xlYXJGaWVs\nZHNNZXRob2QoKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gewogICAgICAgIC8vIHByb3RlY3RlZCB2b2lkIHBjQ2xlYXJGaWVsZHMg\nKCkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhv\nZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNsYXNzLAogICAgICAgICAg\nICBudWxsKTsKICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgpOwogICAg\nICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBzdXBlci5wY0NsZWFyRmllbGRzICgpCiAgICAgICAgaWYgKF9tZXRh\nLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNs\nYXNzKCkpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKGdl\ndFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xhc3NN\nZXRhRGF0YSgpKSwgUFJFICsgIkNsZWFyRmllbGRzIiwgdm9pZC5jbGFzcywK\nICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkg\nIT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfUEVSU0lTVEVOVCkKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIHN3aXRjaCAoZm1kc1tp\nXS5nZXREZWNsYXJlZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAgICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ0hBUjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKDBMKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYWRk\nU2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKICAgICAgICB9\nCgogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgPGNvZGU+cGNO\nZXdJbnN0YW5jZTwvY29kZT4gbWV0aG9kIHRvIHRoZSBieXRlY29kZS4KICAg\nICAqIFRoZXNlIG1ldGhvZHMgYXJlIHVzZWQgYnkgdGhlIGltcGwgaGVscGVy\nIHRvIGNyZWF0ZSBuZXcKICAgICAqIG1hbmFnZWQgaW5zdGFuY2VzIGVmZmlj\naWVudGx5IHdpdGhvdXQgcmVmbGVjdGlvbi4KICAgICAqCiAgICAgKiBAcGFy\nYW0gb2lkIHNldCB0byB0cnVlIHRvIG1pbWljIHRoZSBtZXRob2QgdmVyc2lv\nbiB0aGF0IHRha2VzCiAgICAgKiBhbiBvaWQgdmFsdWUgYXMgd2VsbCBhcyBh\nIHN0YXRlIG1hbmFnZXIKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5l\nd0luc3RhbmNlTWV0aG9kKGJvb2xlYW4gb2lkKSB7CiAgICAgICAgLy8gcHVi\nbGljIFBlcnNpc3RlbmNlQ2FwYWJsZSBwY05ld0luc3RhbmNlICguLi4pCiAg\nICAgICAgQ2xhc3NbXSBhcmdzID0KICAgICAgICAgICAgKG9pZCkgPyBuZXcg\nQ2xhc3NbXXsgU01UWVBFLCBPYmplY3QuY2xhc3MsIGJvb2xlYW4uY2xhc3Mg\nfQogICAgICAgICAgICAgICAgOiBuZXcgQ2xhc3NbXXsgU01UWVBFLCBib29s\nZWFuLmNsYXNzIH07CiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIk5ld0luc3RhbmNlIiwgUENUWVBFLCBhcmdz\nKTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsK\nCiAgICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgYWJzdHJhY3QsIHRocm93IGEg\nVXNlckV4Y2VwdGlvbgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKSB7\nCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIFVTRVJFWENFUCk7\nCiAgICAgICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICAvLyBYWFggcGMgPSBuZXcgWFhYICgpOwogICAgICAgIGNv\nZGUuYW5ldygpLnNldFR5cGUoX3BjKTsKICAgICAgICBjb2RlLmR1cCgpOwog\nICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+\nIiwgdm9pZC5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50IGluc3QgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuYXN0b3JlKCku\nc2V0TG9jYWwoaW5zdCk7CgogICAgICAgIC8vIGlmIChjbGVhcikKICAgICAg\nICAvLyAgIHBjLnBjQ2xlYXJGaWVsZHMgKCk7CiAgICAgICAgY29kZS5pbG9h\nZCgpLnNldFBhcmFtKChvaWQpID8gMiA6IDEpOwogICAgICAgIEp1bXBJbnN0\ncnVjdGlvbiBub2NsZWFyID0gY29kZS5pZmVxKCk7CiAgICAgICAgY29kZS5h\nbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChQUkUgKyAiQ2xlYXJGaWVsZHMiLCB2b2lkLmNs\nYXNzLCBudWxsKTsKCiAgICAgICAgLy8gcGMucGNTdGF0ZU1hbmFnZXIgPSBz\nbTsKICAgICAgICBub2NsZWFyLnNldFRhcmdldChjb2RlLmFsb2FkKCkuc2V0\nTG9jYWwoaW5zdCkpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQ\nRSk7CgogICAgICAgIC8vIGNvcHkga2V5IGZpZWxkcyBmcm9tIG9pZAogICAg\nICAgIGlmIChvaWQpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExv\nY2FsKGluc3QpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0o\nMSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gcmV0dXJuIHBjOwogICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpbnN0KTsKICAgICAgICBjb2RlLmFy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wcm90ZWN0ZWQgc3RhdGljIGlu\ndCBwY0dldE1hbmFnZWRGaWVsZENvdW50ICgpPC9jb2RlPgogICAgICogbWV0\naG9kIHRvIHRoZSBieXRlY29kZSwgcmV0dXJuaW5nIHRoZSBpbmhlcml0ZWQg\nZmllbGQgY291bnQgYWRkZWQKICAgICAqIHRvIHRoZSBudW1iZXIgb2YgbWFu\nYWdlZCBmaWVsZHMgaW4gdGhlIGN1cnJlbnQgUGVyc2lzdGVuY2VDYXBhYmxl\nIGNsYXNzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkTWFuYWdlZEZp\nZWxkQ291bnRNZXRob2QoKSB7CiAgICAgICAgLy8gcHJvdGVjdGVkIHN0YXRp\nYyBpbnQgcGNHZXRNYW5hZ2VkRmllbGRDb3VudCAoKQogICAgICAgIEJDTWV0\naG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJHZXRNYW5h\nZ2VkRmllbGRDb3VudCIsCiAgICAgICAgICAgIGludC5jbGFzcywgbnVsbCk7\nCiAgICAgICAgbWV0aG9kLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICBtZXRo\nb2QubWFrZVByb3RlY3RlZCgpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyByZXR1cm4gPGZpZWxkcz4g\nKyBwY0luaGVyaXRlZEZpZWxkQ291bnQKICAgICAgICAvLyBhd2hpdGU6IHRo\nZSBhYm92ZSBzaG91bGQgd29yaywgYnV0IEknbSBzZWVpbmcgYSBtZXNzZWQg\ndXAgc2l0dWF0aW9uCiAgICAgICAgLy8gYWxsIG9mIGEgc3VkZGVuIHdoZXJl\nIHdoZW4gYSBzdWJjbGFzcyBjYWxscyB0aGlzIG1ldGhvZCwgaXQgc29tZWhv\ndwogICAgICAgIC8vIGhhcHBlbnMgYmVmb3JlIDxjbGluaXQ+IGlzIGV2ZXIg\naW52b2tlZCwgYW5kIHNvIG91cgogICAgICAgIC8vIHBjSW5oZXJpdGVkRmll\nbGRDb3VudCBmaWVsZCBpc24ndCBpbml0aWFsaXplZCEgIHNvIGluc3RlYWQs\nCiAgICAgICAgLy8gcmV0dXJuIDxmaWVsZHM+ICsgPHN1cGVyY2xhc3M+LnBj\nR2V0TWFuYWdlZEZpZWxkQ291bnQgKCkKICAgICAgICBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKS5sZW5ndGgp\nOwogICAgICAgIGlmIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIENsYXNzIHN1cGVyQ2xhc3MgPSBnZXRUeXBlKF9t\nZXRhLmdldFBDU3VwZXJjbGFzc01ldGFEYXRhKCkpOwogICAgICAgICAgICBT\ndHJpbmcgc3VwZXJOYW1lID0gZ2V0Q3JlYXRlU3ViY2xhc3MoKSA/CiAgICAg\nICAgICAgICAgICBQQ0VuaGFuY2VyLnRvUENTdWJjbGFzc05hbWUoc3VwZXJD\nbGFzcykgOgogICAgICAgICAgICAgICAgc3VwZXJDbGFzcy5nZXROYW1lKCk7\nCiAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKHN1\ncGVyTmFtZSwKICAgICAgICAgICAgICAgIFBSRSArICJHZXRNYW5hZ2VkRmll\nbGRDb3VudCIsIGludC5jbGFzcy5nZXROYW1lKCksIG51bGwpOwogICAgICAg\nICAgICBjb2RlLmlhZGQoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5pcmV0\ndXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3RlbmNl\nQ2FwYWJsZSNwY1Byb3ZpZGVGaWVsZH0gYW5kCiAgICAgKiB7QGxpbmsgUGVy\nc2lzdGVuY2VDYXBhYmxlI3BjUHJvdmlkZUZpZWxkc30gbWV0aG9kcyB0byB0\naGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRQcm92\naWRlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhv\nZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNQcm92aWRl\nRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBCQ01ldGhvZCBtZXRo\nb2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUHJvdmlkZUZpZWxkIiwg\ndm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNzW117IGludC5jbGFz\ncyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3\naXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0\naG9kKFBSRSArICJQcm92aWRlRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8g\naWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRp\nb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1\nYmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9t\nZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVu\nZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAgICAgICAgICBjb2Rl\nLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICBUYWJs\nZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2go\nKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsKICAgICAgICAgICAg\ndGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAg\nIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5wcm92aWRlZDx0eXBlPkZp\nZWxkCiAgICAgICAgICAgIC8vICAgICAodGhpcywgZmllbGROdW1iZXIpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIHRhYmlucy5hZGRUYXJnZXQobG9hZE1h\nbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAgICAgICAgICAg\nY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAg\nICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsK\nICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\nZm1kc1tpXSk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFj\nZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1hbmFnZXJNZXRob2QKICAgICAgICAg\nICAgICAgICAgICAoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgInByb3Zp\nZGVkIiwgZmFsc2UsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVs\ndDogdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAg\nICAgICAgICB0YWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlv\nbgogICAgICAgICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbi5jbGFzcykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxh\ndGVNYXhTdGFjaygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxz\nKCk7CgogICAgICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbiht\nZXRob2QpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5r\nIFBlcnNpc3RlbmNlQ2FwYWJsZSNwY1JlcGxhY2VGaWVsZH0gYW5kCiAgICAg\nKiB7QGxpbmsgUGVyc2lzdGVuY2VDYXBhYmxlI3BjUmVwbGFjZUZpZWxkc30g\nbWV0aG9kcyB0byB0aGUgYnl0ZWNvZGUuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCBhZGRSZXBsYWNlRmllbGRzTWV0aG9kcygpCiAgICAgICAgdGhyb3dz\nIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHVibGljIHZv\naWQgcGNSZXBsYWNlRmllbGQgKGludCBmaWVsZE51bWJlcikKICAgICAgICBC\nQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiUmVw\nbGFjZUZpZWxkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNz\nW117IGludC5jbGFzcyB9KTsKICAgICAgICBDb2RlIGNvZGUgPSBtZXRob2Qu\nZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gYWRkcyBldmVyeXRoaW5nIHRo\ncm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAgIGludCByZWxMb2NhbCA9IGJl\nZ2luU3dpdGNoTWV0aG9kKFBSRSArICJSZXBsYWNlRmllbGQiLCBjb2RlKTsK\nCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRoaXMgaW5zdCwganVzdCB0\naHJvdyBleGNlcHRpb24KICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRGaWVsZHMoKQogICAg\nICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAg\naWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHRocm93RXhjZXB0\naW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3aXRjaCAodmFsKQogICAg\nICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAg\nICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9uIHRhYmlucyA9IGNvZGUu\ndGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFiaW5zLnNldExvdygwKTsK\nICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1kcy5sZW5ndGggLSAxKTsK\nCiAgICAgICAgICAgIC8vIDxmaWVsZD4gPSBwY1N0YXRlTWFuYWdlci5yZXBs\nYWNlPHR5cGU+RmllbGQKICAgICAgICAgICAgLy8gICh0aGlzLCBmaWVsZE51\nbWJlcik7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgLy8gZm9yIHRoZSBhZGRT\nZXRNYW5hZ2VkVmFsdWVDb2RlIGNhbGwgYmVsb3cuCiAgICAgICAgICAgICAg\nICB0YWJpbnMuYWRkVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UsIGZtZHNbaV0pKTsKCiAgICAgICAgICAgICAgICBsb2FkTWFuYWdl\nZEluc3RhbmNlKGNvZGUsIGZhbHNlLCBmbWRzW2ldKTsKICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Us\nIGZtZHNbaV0pOwogICAgICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2Uo\nKS5zZXRNZXRob2QoZ2V0U3RhdGVNYW5hZ2VyTWV0aG9kCiAgICAgICAgICAg\nICAgICAgICAgKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlKCksICJyZXBsYWNl\nIiwgdHJ1ZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgIGlmICghZm1kc1tp\nXS5nZXREZWNsYXJlZFR5cGUoKS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAg\nICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShmbWRzW2ldLmdl\ndERlY2xhcmVkVHlwZSgpKTsKCiAgICAgICAgICAgICAgICBhZGRTZXRNYW5h\nZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwogICAgICAgICAgICAgICAg\naWYoX2FkZFZlcnNpb25Jbml0RmxhZyl7CiAgICAgICAgICAgICAgICAgICAg\naWYoZm1kc1tpXS5pc1ZlcnNpb24oKSl7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIElmIHRoaXMgY2FzZSBpcyBzZXR0aW5nIHRoZSB2ZXJzaW9uIGZp\nZWxkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBjVmVyc2lvbkluaXQg\nPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBsb2FkTWFuYWdlZElu\nc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDEpOwogICAgICAgICAgICAgICAg\nICAgICAgICBwdXRmaWVsZChjb2RlLCBudWxsLCBWRVJTSU9OX0lOSVRfU1RS\nLCBib29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZGVmYXVsdDogdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiAoKQogICAgICAgICAgICB0\nYWJpbnMuc2V0RGVmYXVsdFRhcmdldCh0aHJvd0V4Y2VwdGlvbgogICAgICAg\nICAgICAgICAgKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFz\ncykpOwogICAgICAgIH0KCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIGFkZE11bHRpcGxlRmllbGRzTWV0aG9kVmVyc2lvbihtZXRob2QpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSNwY0NvcHlGaWVsZHN9IG1ldGhvZCB0byB0aGUgYnl0ZWNv\nZGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRDb3B5RmllbGRzTWV0\naG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlGaWVsZCAoT2JqZWN0IHBj\nLCBpbnQgZmllbGQpCiAgICAgICAgQkNNZXRob2QgbWV0aG9kID0gX3BjLmRl\nY2xhcmVNZXRob2QoUFJFICsgIkNvcHlGaWVsZCIsCiAgICAgICAgICAgIHZv\naWQuY2xhc3MuZ2V0TmFtZSgpLAogICAgICAgICAgICBuZXcgU3RyaW5nW117\nIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCksIGludC5jbGFzcy5nZXROYW1lKCkg\nfSk7CiAgICAgICAgbWV0aG9kLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBD\nb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8g\nYWRkcyBldmVyeXRoaW5nIHRocm91Z2ggdGhlIHN3aXRjaCAoKQogICAgICAg\nIGludCByZWxMb2NhbCA9IGJlZ2luU3dpdGNoTWV0aG9kKFBSRSArICJDb3B5\nRmllbGQiLCBjb2RlKTsKCiAgICAgICAgLy8gaWYgbm8gZmllbGRzIGluIHRo\naXMgaW5zdCwganVzdCB0aHJvdyBleGNlcHRpb24KICAgICAgICBGaWVsZE1l\ndGFEYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5n\nZXRGaWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmll\nbGRzKCk7CiAgICAgICAgaWYgKGZtZHMubGVuZ3RoID09IDApCiAgICAgICAg\nICAgIHRocm93RXhjZXB0aW9uKGNvZGUsIElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbi5jbGFzcyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIHN3\naXRjaCAodmFsKQogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwo\ncmVsTG9jYWwpOwogICAgICAgICAgICBUYWJsZVN3aXRjaEluc3RydWN0aW9u\nIHRhYmlucyA9IGNvZGUudGFibGVzd2l0Y2goKTsKICAgICAgICAgICAgdGFi\naW5zLnNldExvdygwKTsKICAgICAgICAgICAgdGFiaW5zLnNldEhpZ2goZm1k\ncy5sZW5ndGggLSAxKTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgLy8gPGZp\nZWxkPiA9IG90aGVyLjxmaWVsZD47CiAgICAgICAgICAgICAgICAvLyBvciBz\nZXQ8ZmllbGQ+IChvdGhlci5nZXQ8ZmllbGQ+KTsKICAgICAgICAgICAgICAg\nIHRhYmlucy5hZGRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBm\nYWxzZSwgZm1kc1tpXSkpOwogICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZh\nbHVlQ29kZShjb2RlLCBmbWRzW2ldLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZHNbaV0pOwoKICAg\nICAgICAgICAgICAgIC8vIGJyZWFrOwogICAgICAgICAgICAgICAgY29kZS52\ncmV0dXJuKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRlZmF1\nbHQ6IHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gKCkKICAg\nICAgICAgICAgdGFiaW5zLnNldERlZmF1bHRUYXJnZXQodGhyb3dFeGNlcHRp\nb24KICAgICAgICAgICAgICAgIChjb2RlLCBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24uY2xhc3MpKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwoKICAgICAgICBhZGRNdWx0aXBsZUZpZWxkc01ldGhvZFZlcnNpb24o\nbWV0aG9kKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2Qg\ndG8gYWRkIHRoZSBjb2RlIGNvbW1vbiB0byB0aGUgYmVnaW5uaW5nIG9mIGJv\ndGggdGhlCiAgICAgKiBwY1JlcGxhY2VGaWVsZCBtZXRob2QgYW5kIHRoZSBw\nY1Byb3ZpZGVGaWVsZCBtZXRob2QuIFRoaXMgaW5jbHVkZXMKICAgICAqIGNh\nbGN1bGF0aW5nIHRoZSByZWxhdGl2ZSBmaWVsZCBudW1iZXIgb2YgdGhlIGRl\nc2lyZWQgZmllbGQgYW5kIGNhbGxpbmcKICAgICAqIHRoZSBzdXBlcmNsYXNz\nIGlmIG5lY2Vzc2FyeS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBpbmRl\neCBpbiB3aGljaCB0aGUgbG9jYWwgdmFyaWFibGUgaG9sZGluZyB0aGUgcmVs\nYXRpdmUKICAgICAqIGZpZWxkIG51bWJlciBpcyBzdG9yZWQKICAgICAqLwog\nICAgcHJpdmF0ZSBpbnQgYmVnaW5Td2l0Y2hNZXRob2QoU3RyaW5nIG5hbWUs\nIENvZGUgY29kZSkgewogICAgICAgIGJvb2xlYW4gY29weSA9IChQUkUgKyAi\nQ29weUZpZWxkIikuZXF1YWxzKG5hbWUpOwogICAgICAgIGludCBmaWVsZE51\nbWJlciA9IChjb3B5KSA/IDEgOiAwOwoKICAgICAgICBpbnQgcmVsTG9jYWwg\nPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIGlmIChnZXRD\ncmVhdGVTdWJjbGFzcygpKSB7CiAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5z\nZXRQYXJhbShmaWVsZE51bWJlcik7CiAgICAgICAgICAgIGNvZGUuaXN0b3Jl\nKCkuc2V0TG9jYWwocmVsTG9jYWwpOwogICAgICAgICAgICByZXR1cm4gcmVs\nTG9jYWw7CiAgICAgICAgfQoKICAgICAgICAvLyBpbnQgcmVsID0gZmllbGRO\ndW1iZXIgLSBwY0luaGVyaXRlZEZpZWxkQ291bnQKICAgICAgICBjb2RlLmls\nb2FkKCkuc2V0UGFyYW0oZmllbGROdW1iZXIpOwogICAgICAgIGNvZGUuZ2V0\nc3RhdGljKCkuc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAg\nICBjb2RlLmlzdWIoKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2Fs\nKHJlbExvY2FsKTsKICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwocmVs\nTG9jYWwpOwoKICAgICAgICAvLyBzdXBlcjogaWYgKHJlbCA8IDApIHN1cGVy\nLnBjUmVwbGFjZUZpZWxkIChmaWVsZE51bWJlcik7IHJldHVybjsKICAgICAg\nICAvLyBubyBzdXBlcjogaWYgKHJlbCA8IDApIHRocm93IG5ldyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24gKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9u\nIGlmaW5zID0gY29kZS5pZmdlKCk7CiAgICAgICAgaWYgKF9tZXRhLmdldFBD\nU3VwZXJjbGFzcygpICE9IG51bGwpIHsKICAgICAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIFN0cmluZ1td\nIGFyZ3M7CiAgICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgICAg\nICBhcmdzID0gbmV3IFN0cmluZ1tdeyBnZXRUeXBlKF9tZXRhLmdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkpLgogICAgICAgICAgICAgICAgICAgIGdldE5h\nbWUoKSwgaW50LmNsYXNzLmdldE5hbWUoKSB9OwogICAgICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgICAgIGFyZ3MgPSBuZXcgU3RyaW5nW117IGludC5jbGFz\ncy5nZXROYW1lKCkgfTsKICAgICAgICAgICAgY29kZS5pbG9hZCgpLnNldFBh\ncmFtKGZpZWxkTnVtYmVyKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAg\nICBnZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksIG5hbWUs\nIAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3Mp\nOwogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICB9IGVsc2UK\nICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uLmNsYXNzKTsKCiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0\nKGNvZGUubm9wKCkpOwogICAgICAgIHJldHVybiByZWxMb2NhbDsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRoaXMgaGVscGVyIG1ldGhvZCwgZ2l2ZW4gdGhl\nIHBjUmVwbGFjZUZpZWxkIG9yIHBjUHJvdmlkZUZpZWxkCiAgICAgKiBtZXRo\nb2QsIGFkZHMgdGhlIGJ5dGVjb2RlIGZvciB0aGUgY29ycmVzcG9uZGluZyAn\ncGx1cmFsJyB2ZXJzaW9uCiAgICAgKiBvZiB0aGUgbWV0aG9kIC0tIHRoZSB2\nZXJzaW9uIHRoYXQgdGFrZXMgYW4gaW50W10gb2YgZmllbGRzIHRvCiAgICAg\nKiB0byBhY2Nlc3MgcmF0aGVyIHRoYW4gYSBzaW5nbGUgZmllbGQuIFRoZSBt\ndWx0aXBsZSBmaWVsZHMgdmVyc2lvbgogICAgICogc2ltcGx5IGxvb3BzIHRo\ncm91Z2ggdGhlIHByb3ZpZGVkIGluZGV4ZXMgYW5kIGRlbGVnYXRlcyB0byB0\naGUKICAgICAqIHNpbmd1bGFyIHZlcnNpb24gZm9yIGVhY2ggb25lLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgYWRkTXVsdGlwbGVGaWVsZHNNZXRob2RW\nZXJzaW9uKEJDTWV0aG9kIHNpbmdsZSkgewogICAgICAgIGJvb2xlYW4gY29w\neSA9IChQUkUgKyAiQ29weUZpZWxkIikuZXF1YWxzKHNpbmdsZS5nZXROYW1l\nKCkpOwoKICAgICAgICAvLyBwdWJsaWMgdm9pZCA8bWV0aG9kPnMgKGludFtd\nIGZpZWxkcykKICAgICAgICBDbGFzc1tdIGFyZ3MgPSAoY29weSkgPyBuZXcg\nQ2xhc3NbXXsgT2JqZWN0LmNsYXNzLCBpbnRbXS5jbGFzcyB9CiAgICAgICAg\nICAgIDogbmV3IENsYXNzW117IGludFtdLmNsYXNzIH07CiAgICAgICAgQkNN\nZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2Qoc2luZ2xlLmdldE5h\nbWUoKSArICJzIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgYXJncyk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAg\nICAgIGludCBmaWVsZE51bWJlcnMgPSAwOwogICAgICAgIGludCBpbnN0ID0g\nMDsKICAgICAgICBpZiAoY29weSkgewogICAgICAgICAgICBmaWVsZE51bWJl\ncnMgPSAxOwoKICAgICAgICAgICAgaWYgKGdldENyZWF0ZVN1YmNsYXNzKCkp\nIHsKICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgbWFuYWdlZCBpbnN0YW5j\nZSBpbnRvIHRoZSBsb2NhbCB2YXJpYWJsZSB0YWJsZQogICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICAgICAg\nY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRob2QoSW1wbEhlbHBlci5jbGFz\ncywKICAgICAgICAgICAgICAgICAgICAiZ2V0TWFuYWdlZEluc3RhbmNlIiwg\nT2JqZWN0LmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG5ldyBDbGFzc1td\nIHsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKF9tYW5hZ2VkVHlwZSk7CiAgICAgICAgICAgICAg\nICBpbnN0ID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAg\nICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwoaW5zdCk7CgogICAgICAg\nICAgICAgICAgLy8gdGhlcmUgbWlnaHQgYmUgYSBkaWZmZXJlbmNlIGJldHdl\nZW4gdGhlIGNsYXNzZXMgb2YgJ3RoaXMnCiAgICAgICAgICAgICAgICAvLyB2\ncyAnb3RoZXInIGluIHRoaXMgY29udGV4dDsgdXNlIHRoZSBQQyBtZXRob2Rz\nIHRvIGdldCB0aGUgU00KICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRU\naGlzKCk7CiAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0\nYXRpYygpLnNldE1ldGhvZChJbXBsSGVscGVyLmNsYXNzLAogICAgICAgICAg\nICAgICAgICAgICJ0b1BlcnNpc3RlbmNlQ2FwYWJsZSIsIFBlcnNpc3RlbmNl\nQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3Nb\nXSB7IE9iamVjdC5jbGFzcywgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoUGVyc2lz\ndGVuY2VDYXBhYmxlLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICJwY0dl\ndFN0YXRlTWFuYWdlciIsIFN0YXRlTWFuYWdlci5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBYWFggb3Ro\nZXIgPSAoWFhYKSBwYzsKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgwKTsKICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShfcGMpOwogICAgICAgICAgICAgICAgaW5zdCA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgICAgICAgICBjb2RlLmFzdG9y\nZSgpLnNldExvY2FsKGluc3QpOwoKICAgICAgICAgICAgICAgIC8vIGFjY2Vz\ncyB0aGUgb3RoZXIncyBzbSBmaWVsZCBkaXJlY3RseQogICAgICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgICAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiAob3RoZXIucGNTdGF0ZU1h\nbmFnZXIgIT0gcGNTdGF0ZU1hbmFnZXIpCiAgICAgICAgICAgIC8vCXRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24KCiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAg\nICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZhY21wZXEoKTsK\nICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24oY29kZSwgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAgICAgaWZpbnMuc2V0VGFy\nZ2V0KGNvZGUubm9wKCkpOwoKICAgICAgICAgICAgLy8gaWYgKHBjU3RhdGVN\nYW5hZ2VyID09IG51bGwpCiAgICAgICAgICAgIC8vICB0aHJvdyBuZXcgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxk\nKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGlmaW5zID0g\nY29kZS5pZm5vbm51bGwoKTsKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24o\nY29kZSwgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmNsYXNzKTsKICAgICAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gZm9yIChpbnQgaSA9IDA7CiAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDApOwogICAgICAgIGludCBpZHggPSBjb2RlLmdldE5l\neHRMb2NhbHNJbmRleCgpOwogICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9j\nYWwoaWR4KTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gdGVzdGlucyA9IGNv\nZGUuZ28yKCk7CgogICAgICAgIC8vIDxtZXRob2Q+IChmaWVsZHNbaV0pOwog\nICAgICAgIEluc3RydWN0aW9uIGJvZHlpbnMgPSBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBpZiAoY29weSkKICAgICAgICAg\nICAgY29kZS5hbG9hZCgpLnNldExvY2FsKGluc3QpOwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRQYXJhbShmaWVsZE51bWJlcnMpOwogICAgICAgIGNvZGUu\naWxvYWQoKS5zZXRMb2NhbChpZHgpOwogICAgICAgIGNvZGUuaWFsb2FkKCk7\nCiAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHNpbmds\nZSk7CgogICAgICAgIC8vIGkrKzsKICAgICAgICBjb2RlLmlpbmMoKS5zZXRJ\nbmNyZW1lbnQoMSkuc2V0TG9jYWwoaWR4KTsKCiAgICAgICAgLy8gaSA8IGZp\nZWxkcy5sZW5ndGgKICAgICAgICB0ZXN0aW5zLnNldFRhcmdldChjb2RlLmls\nb2FkKCkuc2V0TG9jYWwoaWR4KSk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNl\ndFBhcmFtKGZpZWxkTnVtYmVycyk7CiAgICAgICAgY29kZS5hcnJheWxlbmd0\naCgpOwogICAgICAgIGNvZGUuaWZpY21wbHQoKS5zZXRUYXJnZXQoYm9keWlu\ncyk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExv\nY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUgJ3N0b2Nr\nJyBtZXRob2RzIHRvIHRoZSBieXRlY29kZTsgdGhlc2UgaW5jbHVkZSBtZXRo\nb2RzCiAgICAgKiBsaWtlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNG\nZXRjaE9iamVjdElkfQogICAgICogYW5kIHtAbGluayBQZXJzaXN0ZW5jZUNh\ncGFibGUjcGNJc1RyYW5zYWN0aW9uYWx9LgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkU3RvY2tNZXRob2RzKCkKICAgICAgICB0aHJvd3MgTm9TdWNo\nTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBwY0dldEdlbmVyaWNDb250ZXh0CiAgICAgICAgICAgIHRyYW5zbGF0ZUZy\nb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICBBY2Nlc3ND\nb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgU01UWVBFLCAiZ2V0IiArIENPTlRFWFROQU1F\nLCAoQ2xhc3NbXSkgbnVsbCkpLCBmYWxzZSk7CiAgICAKICAgICAgICAgICAg\nLy8gcGNGZXRjaE9iamVjdElkCiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21T\ndGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICBBY2Nlc3NDb250\ncm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRv\nUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAg\nICAgICAgICAgICAgICAgU01UWVBFLCAiZmV0Y2hPYmplY3RJZCIsIChDbGFz\nc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lz\nRGVsZXRlZAogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2Vy\nTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAg\nICAgIFNNVFlQRSwgImlzRGVsZXRlZCIsIChDbGFzc1tdKSBudWxsKSksIGZh\nbHNlKTsKICAgIAogICAgICAgICAgICAvLyBwY0lzRGlydHkKICAgICAgICAg\nICAgdHJhbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAg\nICAgICAgIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9k\nQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJpc0Rp\ncnR5IiwgKENsYXNzW10pIG51bGwpKSwgdHJ1ZSk7CiAgICAKICAgICAgICAg\nICAgLy8gcGNJc05ldwogICAgICAgICAgICB0cmFuc2xhdGVGcm9tU3RhdGVN\nYW5hZ2VyTWV0aG9kKAogICAgICAgICAgICAgICAgQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZI\nZWxwZXIuZ2V0RGVjbGFyZWRNZXRob2RBY3Rpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIFNNVFlQRSwgImlzTmV3IiwgKENsYXNzW10pIG51bGwpKSwg\nZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjSXNQZXJzaXN0ZW50CiAg\nICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAg\nICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgK\nICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJl\nZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBF\nLCAiaXNQZXJzaXN0ZW50IiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwog\nICAgCiAgICAgICAgICAgIC8vIHBjSXNUcmFuc2FjdGlvbmFsCiAgICAgICAg\nICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1hbmFnZXJNZXRob2QoCiAgICAgICAg\nICAgICAgICBBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAg\nICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhv\nZEFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgU01UWVBFLCAiaXNU\ncmFuc2FjdGlvbmFsIiwgKENsYXNzW10pIG51bGwpKSwgZmFsc2UpOwogICAg\nCiAgICAgICAgICAgIC8vIHBjU2VyaWFsaXppbmcKICAgICAgICAgICAgdHJh\nbnNsYXRlRnJvbVN0YXRlTWFuYWdlck1ldGhvZCgKICAgICAgICAgICAgICAg\nIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAg\nICAgICAgIEoyRG9Qcml2SGVscGVyLmdldERlY2xhcmVkTWV0aG9kQWN0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICBTTVRZUEUsICJzZXJpYWxpemlu\nZyIsIChDbGFzc1tdKSBudWxsKSksIGZhbHNlKTsKICAgIAogICAgICAgICAg\nICAvLyBwY0RpcnR5CiAgICAgICAgICAgIHRyYW5zbGF0ZUZyb21TdGF0ZU1h\nbmFnZXJNZXRob2QoCiAgICAgICAgICAgICAgICBBY2Nlc3NDb250cm9sbGVy\nLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhl\nbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbigKICAgICAgICAgICAgICAg\nICAgICAgICAgU01UWVBFLCAiZGlydHkiLCBuZXcgQ2xhc3NbXXsgU3RyaW5n\nLmNsYXNzIH0pKSwgZmFsc2UpOwogICAgCiAgICAgICAgICAgIC8vIHBjR2V0\nU3RhdGVNYW5hZ2VyCiAgICAgICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMu\nZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0U3RhdGVNYW5hZ2VyIiwKICAgICAg\nICAgICAgICAgIFN0YXRlTWFuYWdlci5jbGFzcywgbnVsbCk7CiAgICAgICAg\nICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0cnVlKTsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU3RhdGVNYW5hZ2Vy\nLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAg\nICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgICAgICB9IGNhdGNoIChQcml2\naWxlZ2VkQWN0aW9uRXhjZXB0aW9uIHBhZSkgewogICAgICAgICAgICAgdGhy\nb3cgKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbikgcGFlLmdldEV4Y2VwdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRo\nb2QgdG8gYWRkIGEgc3RvY2sgbWV0aG9kIHRvIHRoZSBieXRlY29kZS4gRWFj\naAogICAgICogc3RvY2sgbWV0aG9kIHNpbXBseSBkZWxlZ2F0ZXMgdG8gYSBj\nb3JyZXNwb25kaW5nIFN0YXRlTWFuYWdlciBtZXRob2QuCiAgICAgKiBHaXZl\nbiB0aGUgU3RhdGVNYW5hZ2VyIG1ldGhvZCwgdGhlbiwgdGhpcyBmdW5jdGlv\nbiB0cmFuc2xhdGVzIGl0IGludG8KICAgICAqIHRoZSB3cmFwcGVyIG1ldGhv\nZCB0aGF0IHNob3VsZCBiZSBhZGRlZCB0byB0aGUgYnl0ZWNvZGUuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCB0cmFuc2xhdGVGcm9tU3RhdGVNYW5hZ2Vy\nTWV0aG9kKE1ldGhvZCBtLAogICAgICAgIGJvb2xlYW4gaXNEaXJ0eUNoZWNr\nTWV0aG9kKSB7CiAgICAgICAgLy8gZm9ybSB0aGUgbmFtZSBvZiB0aGUgbWV0\naG9kIGJ5IHByZXBlbmRpbmcgJ3BjJyB0byB0aGUgc20gbWV0aG9kCiAgICAg\nICAgU3RyaW5nIG5hbWUgPSBQUkUgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXpl\nKG0uZ2V0TmFtZSgpKTsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IG0uZ2V0\nUGFyYW1ldGVyVHlwZXMoKTsKICAgICAgICBDbGFzcyByZXR1cm5UeXBlID0g\nbS5nZXRSZXR1cm5UeXBlKCk7CgogICAgICAgIC8vIGFkZCB0aGUgbWV0aG9k\nIHRvIHRoZSBwYwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNs\nYXJlTWV0aG9kKG5hbWUsIHJldHVyblR5cGUsIHBhcmFtcyk7CiAgICAgICAg\nQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIC8v\nIGlmIChwY1N0YXRlTWFuYWdlciA9PSBudWxsKSByZXR1cm4gPGRlZmF1bHQ+\nOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2RlLmlmbm9ubnVs\nbCgpOwogICAgICAgIGlmIChyZXR1cm5UeXBlLmVxdWFscyhib29sZWFuLmNs\nYXNzKSkKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZh\nbHNlKTsKICAgICAgICBlbHNlIGlmICghcmV0dXJuVHlwZS5lcXVhbHModm9p\nZC5jbGFzcykpCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxs\nKCk7CiAgICAgICAgY29kZS54cmV0dXJuKCkuc2V0VHlwZShyZXR1cm5UeXBl\nKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyB0aGUgZGlydHktY2hlY2sgbWV0\naG9kIGFuZCB3ZSdyZSBzdWJjbGFzc2luZyBidXQgbm90CiAgICAgICAgLy8g\ncmVkZWZpbmluZywgaG9vayBpbnRvIFBDSGVscGVyIHRvIGRvIHRoZSBkaXJ0\neSBjaGVjawogICAgICAgIGlmIChpc0RpcnR5Q2hlY2tNZXRob2QgJiYgIWdl\ndFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgLy8gUmVkZWZpbml0aW9uSGVs\ncGVyLmRpcnR5Q2hlY2soc20pOwogICAgICAgICAgICBpZmlucy5zZXRUYXJn\nZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkpOwogICAgICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciB0aGUgcmV0dXJuIHN0YXRl\nbWVudCBiZWxvdwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChSZWRlZmluaXRpb25IZWxwZXIuY2xhc3MsIAogICAgICAgICAg\nICAgICAgImRpcnR5Q2hlY2siLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7\nIFNNVFlQRSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZmlu\ncy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSkp\nOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNN\nVFlQRSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHJldHVybiBw\nY1N0YXRlTWFuYWdlci48bWV0aG9kPiAoPGFyZ3M+KTsKICAgICAgICAvLyBt\nYW5hZ2VkIGluc3RhbmNlIGxvYWRlZCBhYm92ZSBpbiBpZi1lbHNlIGJsb2Nr\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJhbXMubGVuZ3RoOyBp\nKyspCiAgICAgICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShpKTsKICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChtKTsKICAg\nICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBlKHJldHVyblR5cGUpOwoKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5j\nYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgdGhlIHtAbGluayBQZXJzaXN0ZW5jZUNhcGFibGUjcGNHZXRWZXJzaW9u\nfSBtZXRob2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkR2V0VmVyc2lvbk1ldGhvZCgpCiAgICAgICAgdGhyb3dzIE5v\nU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkdldFZlcnNpb24iLCBPYmpl\nY3QuY2xhc3MsCiAgICAgICAgICAgIG51bGwpOwogICAgICAgIENvZGUgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiAocGNT\ndGF0ZU1hbmFnZXIgPT0gbnVsbCkKICAgICAgICBsb2FkTWFuYWdlZEluc3Rh\nbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0\nRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlm\naW5zID0gY29kZS5pZm5vbm51bGwoKTsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIHZlcnNpb25GaWVsZCA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwoKICAg\nICAgICBpZiAodmVyc2lvbkZpZWxkID09IG51bGwpCiAgICAgICAgICAgIGNv\nZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7IC8vIHJldHVybiBudWxsOwogICAg\nICAgIGVsc2UgewogICAgICAgICAgICAvLyByZXR1cm4gPHZlcnNpb25GaWVs\nZD47CiAgICAgICAgICAgIENsYXNzIHdyYXBwZXIgPSB0b1ByaW1pdGl2ZVdy\nYXBwZXIodmVyc2lvbkZpZWxkKTsKICAgICAgICAgICAgaWYgKHdyYXBwZXIg\nIT0gdmVyc2lvbkZpZWxkLmdldERlY2xhcmVkVHlwZSgpKSB7CiAgICAgICAg\nICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKHdyYXBwZXIpOwogICAgICAg\nICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCB2ZXJzaW9uRmllbGQp\nOwogICAgICAgICAgICBpZiAod3JhcHBlciAhPSB2ZXJzaW9uRmllbGQuZ2V0\nRGVjbGFyZWRUeXBlKCkpCiAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNw\nZWNpYWwoKS5zZXRNZXRob2Qod3JhcHBlciwgIjxpbml0PiIsIHZvaWQuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgbmV3IENsYXNzW117IHZlcnNpb25G\naWVsZC5nZXREZWNsYXJlZFR5cGUoKSB9KTsKICAgICAgICB9CiAgICAgICAg\nY29kZS5hcmV0dXJuKCk7CgogICAgICAgIC8vIHJldHVybiBwY1N0YXRlTWFu\nYWdlci5nZXRWZXJzaW9uICgpOwogICAgICAgIGlmaW5zLnNldFRhcmdldChs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAgICAgY29k\nZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKFNNVFlQRSwgImdldFZl\ncnNpb24iLCBPYmplY3QuY2xhc3MsCiAgICAgICAgICAgIG51bGwpOwogICAg\nICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdmVyc2lvbiBmaWVs\nZCB0eXBlIGFzIGEgcHJpbWl0aXZlIHdyYXBwZXIsIG9yIG51bGwgaWYKICAg\nICAqIHRoZSB2ZXJzaW9uIGZpZWxkIGlzIG5vdCBwcmltaXRpdmUuCiAgICAg\nKi8KICAgIHByaXZhdGUgQ2xhc3MgdG9QcmltaXRpdmVXcmFwcGVyKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFy\nZWRUeXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJP\nT0xFQU46CiAgICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi5jbGFzczsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAg\nICAgIHJldHVybiBCeXRlLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIENoYXJhY3Rlci5j\nbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFOgogICAg\nICAgICAgICAgICAgcmV0dXJuIERvdWJsZS5jbGFzczsKICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICByZXR1cm4g\nRmxvYXQuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBJbnRlZ2VyLmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5MT05HOgogICAgICAgICAgICAgICAgcmV0\ndXJuIExvbmcuY2xhc3M7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNI\nT1JUOgogICAgICAgICAgICAgICAgcmV0dXJuIFNob3J0LmNsYXNzOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZm1kLmdldERlY2xhcmVkVHlwZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogQWRkcyB0aGUge0BsaW5rIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSNwY1JlcGxhY2VTdGF0ZU1hbmFnZXJ9CiAgICAgKiBtZXRo\nb2QgdG8gdGhlIGJ5dGVjb2RlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYWRkUmVwbGFjZVN0YXRlTWFuYWdlck1ldGhvZCgpIHsKICAgICAgICAvLyBw\ndWJsaWMgdm9pZCBwY1JlcGxhY2VTdGF0ZU1hbmFnZXIgKFN0YXRlTWFuYWdl\nciBzbSkKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1l\ndGhvZChQUkUgKyAiUmVwbGFjZVN0YXRlTWFuYWdlciIsCiAgICAgICAgICAg\nIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBTTVRZUEUgfSk7CiAgICAgICAg\nbWV0aG9kLnNldFN5bmNocm9uaXplZCh0cnVlKTsKICAgICAgICBtZXRob2Qu\nZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24oU2VjdXJpdHlFeGNl\ncHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRD\nb2RlKHRydWUpOwoKICAgICAgICAvLyBpZiAocGNTdGF0ZU1hbmFnZXIgIT0g\nbnVsbCkKICAgICAgICAvLwlwY1N0YXRlTWFuYWdlciA9IHBjU3RhdGVNYW5h\nZ2VyLnJlcGxhY2VTdGF0ZU1hbmFnZXIoc20pOwogICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0Zmll\nbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZpbnMgPSBjb2RlLmlmbnVsbCgpOwogICAgICAgIGxvYWRNYW5h\nZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGxvYWRNYW5hZ2Vk\nSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLmFsb2FkKCku\nc2V0UGFyYW0oMCk7CiAgICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5z\nZXRNZXRob2QoU01UWVBFLCAicmVwbGFjZVN0YXRlTWFuYWdlciIsCiAgICAg\nICAgICAgIFNNVFlQRSwgbmV3IENsYXNzW117IFNNVFlQRSB9KTsKICAgICAg\nICBjb2RlLnB1dGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgY29kZS52cmV0dXJuKCk7CgogICAgICAgIC8vIFNlY3VyaXR5TWFuYWdl\nciBzZWMgPSBTeXN0ZW0uZ2V0U2VjdXJpdHlNYW5hZ2VyICgpOwogICAgICAg\nIC8vIGlmIChzZWMgIT0gbnVsbCkKICAgICAgICAvLwkJc2VjLmNoZWNrUGVy\nbWlzc2lvbiAoUGVybWlzc2lvbi5TRVRfU1RBVEVfTUFOQUdFUik7CiAgICAg\nICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0\naG9kKFN5c3RlbS5jbGFzcywKICAgICAgICAgICAgImdldFNlY3VyaXR5TWFu\nYWdlciIsIFNlY3VyaXR5TWFuYWdlci5jbGFzcywgbnVsbCkpOwoKICAgICAg\nICAvLyBwY1N0YXRlTWFuYWdlciA9IHNtOwogICAgICAgIGlmaW5zLnNldFRh\ncmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKSk7CiAgICAg\nICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIGNvZGUucHV0\nZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKCiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDcmVhdGVzIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgbWV0\naG9kcyBkZWFsaW5nIHdpdGggYXBwbGljYXRpb24KICAgICAqIGlkZW50aXR5\nIGFuZCBnaXZlcyB0aGVtIG5vLW9wIGltcGxlbWVudGF0aW9ucy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGFkZE5vT3BBcHBsaWNhdGlvbklkZW50aXR5\nTWV0aG9kcygpIHsKICAgICAgICAvLyBwdWJsaWMgdm9pZCBwY0NvcHlLZXlG\naWVsZHNUb09iamVjdElkIChPYmplY3RJZEZpZWxkU3VwcGxpZXIgZnMsCiAg\nICAgICAgLy8gCU9iamVjdCBvaWQpCiAgICAgICAgQkNNZXRob2QgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09i\namVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117\nIE9JREZTVFlQRSwgT2JqZWN0LmNsYXNzIH0pOwogICAgICAgIENvZGUgY29k\nZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUudnJldHVy\nbigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAg\nICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQg\nKE9iamVjdCBvaWQpCiAgICAgICAgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRo\nb2QoUFJFICsgIkNvcHlLZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAg\nICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsK\nICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAg\nY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2Nh\nbHMoKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNDb3B5S2V5RmllbGRz\nRnJvbU9iamVjdElkIChPYmplY3RJZEZpZWxkQ29uc3VtZXIgZmMsCiAgICAg\nICAgLy8JT2JqZWN0IG9pZCkKICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFy\nZU1ldGhvZChQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsCiAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyBPSURGQ1RZUEUs\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENv\nZGUodHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJuKCk7CiAgICAgICAgY29k\nZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAgICAgLy8gcHVibGljIHZv\naWQgcGNDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkIChPYmplY3Qgb2lkKQog\nICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5\nS2V5RmllbGRzRnJvbU9iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFz\ncywgbmV3IENsYXNzW117IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICBjb2Rl\nID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAgICAgICAgY29kZS52cmV0dXJu\nKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKCiAgICAg\nICAgLy8gcHVibGljIE9iamVjdCBwY05ld09iamVjdElkSW5zdGFuY2UgKCkK\nICAgICAgICBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3\nT2JqZWN0SWRJbnN0YW5jZSIsCiAgICAgICAgICAgIE9iamVjdC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwog\nICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7CiAgICAgICAgY29k\nZS5hcmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CgogICAgICAg\nIC8vIHB1YmxpYyBPYmplY3QgcGNOZXdPYmplY3RJZEluc3RhbmNlIChPYmpl\nY3Qgb2JqKQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBS\nRSArICJOZXdPYmplY3RJZEluc3RhbmNlIiwKICAgICAgICAgICAgT2JqZWN0\nLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNzIH0pOwogICAgICAg\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGNvZGUuYXJldHVybigpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2Rl\nLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICog\nQWRkcyB0aGUgPGNvZGU+cGNDb3B5S2V5RmllbGRzVG9PYmplY3RJZDwvY29k\nZT4gbWV0aG9kcwogICAgICogdG8gY2xhc3NlcyB1c2luZyBhcHBsaWNhdGlv\nbiBpZGVudGl0eS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZENvcHlL\nZXlGaWVsZHNUb09iamVjdElkTWV0aG9kKGJvb2xlYW4gZmllbGRNYW5hZ2Vy\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtleUZpZWxkc1RvT2JqZWN0SWQg\nKE9iamVjdElkRmllbGRTdXBwbGllciBmcywKICAgICAgICAvLwlPYmplY3Qg\nb2lkKQogICAgICAgIFN0cmluZ1tdIGFyZ3MgPSAoZmllbGRNYW5hZ2VyKSA/\nCiAgICAgICAgICAgIG5ldyBTdHJpbmdbXXsgT0lERlNUWVBFLmdldE5hbWUo\nKSwgT2JqZWN0LmNsYXNzLmdldE5hbWUoKSB9CiAgICAgICAgICAgIDogbmV3\nIFN0cmluZ1tdeyBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpIH07CiAgICAgICAg\nQkNNZXRob2QgbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIkNv\ncHlLZXlGaWVsZHNUb09iamVjdElkIiwKICAgICAgICAgICAgdm9pZC5jbGFz\ncy5nZXROYW1lKCksIGFyZ3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBzaW5nbGUgZmllbGQgaWRl\nbnRpdHkgYWx3YXlzIHRocm93cyBleGNlcHRpb24KICAgICAgICBpZiAoX21l\ndGEuaXNPcGVuSlBBSWRlbnRpdHkoKSkgewogICAgICAgICAgICB0aHJvd0V4\nY2VwdGlvbihjb2RlLCBJTlRFUk5FWENFUCk7CiAgICAgICAgICAgIGNvZGUu\ndnJldHVybigpOwoKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFj\naygpOwogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjYWxs\nIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9tZXRhLmdldFBDU3Vw\nZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1YmNsYXNzKCkpIHsK\nICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7\nIGkrKykKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbShp\nKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBnZXRQQ1N1cGVyY2xh\nc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICBQUkUg\nKyAiQ29weUtleUZpZWxkc1RvT2JqZWN0SWQiLCB2b2lkLmNsYXNzLmdldE5h\nbWUoKSwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICAvLyBPYmplY3QgaWQg\nPSBvaWQ7CiAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDEpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwoKICAgICAgICBpZiAo\nX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkgewogICAgICAgICAgICAv\nLyBvaWQgPSAoKE9iamVjdElkKSBpZCkuZ2V0SWQgKCk7CiAgICAgICAgICAg\nIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmplY3RJZC5jbGFzcyk7CiAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmpl\nY3RJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgIE9iamVjdC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICAvLyA8b2lkIHR5cGU+\nIGlkID0gKDxvaWQgdHlwZT4pIG9pZDsKICAgICAgICBpbnQgaWQgPSBjb2Rl\nLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAgICAgIENsYXNzIG9pZFR5cGUg\nPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKICAgICAgICBjb2RlLmNoZWNr\nY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAgICAgICAgY29kZS5hc3RvcmUo\nKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8vIGludCBpbmhlcml0ZWQgPSBw\nY0luaGVyaXRlZEZpZWxkQ291bnQ7CiAgICAgICAgaW50IGluaGVyaXRlZCA9\nIDA7CiAgICAgICAgaWYgKGZpZWxkTWFuYWdlcikgewogICAgICAgICAgICBj\nb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7\nCiAgICAgICAgICAgIGluaGVyaXRlZCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0lu\nZGV4KCk7CiAgICAgICAgICAgIGNvZGUuaXN0b3JlKCkuc2V0TG9jYWwoaW5o\nZXJpdGVkKTsKICAgICAgICB9CgogICAgICAgIC8vIGlkLjxmaWVsZD4gPSBm\ncy5mZXRjaDx0eXBlPkZpZWxkICg8aW5kZXg+KTsgb3IuLi4KICAgICAgICAv\nLyBpZC48ZmllbGQ+ID0gcGMuPGZpZWxkPjsKICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IGdldENyZWF0ZVN1YmNsYXNzKCkgPyBfbWV0YS5nZXRG\naWVsZHMoKQogICAgICAgICAgICA6IF9tZXRhLmdldERlY2xhcmVkRmllbGRz\nKCk7CiAgICAgICAgQ2xhc3MgdHlwZTsKICAgICAgICBTdHJpbmcgbmFtZTsK\nICAgICAgICBGaWVsZCBmaWVsZDsKICAgICAgICBNZXRob2Qgc2V0dGVyOwog\nICAgICAgIGJvb2xlYW4gcmVmbGVjdDsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFm\nbWRzW2ldLmlzUHJpbWFyeUtleSgpKQogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChpZCk7Cgog\nICAgICAgICAgICBuYW1lID0gZm1kc1tpXS5nZXROYW1lKCk7CiAgICAgICAg\nICAgIHR5cGUgPSBmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBlKCk7CiAg\nICAgICAgICAgIGlmIChpc0ZpZWxkQWNjZXNzKGZtZHNbaV0pKSB7CiAgICAg\nICAgICAgICAgICBzZXR0ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgZmll\nbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRUeXBlLCBuYW1lLCB0cnVl\nKTsKICAgICAgICAgICAgICAgIHJlZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJs\naWMoZmllbGQuZ2V0TW9kaWZpZXJzKCkpOwogICAgICAgICAgICAgICAgaWYg\nKHJlZmxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29u\nc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobmFtZSk7CiAgICAgICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9k\nKFJlZmxlY3Rpb24uY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAi\nZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3Mu\nY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywg\nYm9vbGVhbi5jbGFzcyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxkID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHNldHRlciA9IFJlZmxlY3Rpb24uZmluZFNldHRlcihv\naWRUeXBlLCBuYW1lLCB0eXBlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJl\nZmxlY3QgPSAhTW9kaWZpZXIuaXNQdWJsaWMoc2V0dGVyLmdldE1vZGlmaWVy\ncygpKTsKICAgICAgICAgICAgICAgIGlmIChyZWZsZWN0KSB7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3Mob2lk\nVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2xhc3Nj\nb25zdGFudCgpLnNldENsYXNzKHR5cGUpOwogICAgICAgICAgICAgICAgICAg\nIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChSZWZsZWN0\naW9uLmNsYXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgImZpbmRTZXR0\nZXIiLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsgQ2xhc3MuY2xhc3Ms\nCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5jbGFzcywgQ2xhc3Mu\nY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsK\nICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAg\nICAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZShpKTsKICAg\nICAgICAgICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChpbmhlcml0ZWQp\nOwogICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAgICAgICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZAogICAgICAgICAg\nICAgICAgICAgIChnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKHR5cGUpKTsKICAg\nICAgICAgICAgICAgIGlmIChmbWRzW2ldLmdldE9iamVjdElkRmllbGRUeXBl\nQ29kZSgpID09IEphdmFUeXBlcy5PQkpFQ1QgJiYKICAgICAgICAgICAgICAg\nICAgICAhZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKS5pc0VudW0oKSkgewog\nICAgICAgICAgICAgICAgCWNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShPYmpl\nY3RJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAJY29kZS5pbnZva2V2aXJ0\ndWFsKCkuc2V0TWV0aG9kKE9iamVjdElkLmNsYXNzLCAiZ2V0SWQiLCAKICAg\nICAgICAgICAgCQkJT2JqZWN0LmNsYXNzLCBudWxsKTsgICAgICAgICAgICAg\nICAgCQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlm\nIHRoZSB0eXBlIG9mIHRoaXMgZmllbGQgbWV0YSBkYXRhIGlzCiAgICAgICAg\nICAgICAgICAvLyBub24tcHJpbWl0aXZlIGFuZCBub24tc3RyaW5nLCBiZSBz\ndXJlIHRvIGNhc3QKICAgICAgICAgICAgICAgIC8vIHRvIHRoZSBhcHByb3By\naWF0ZSB0eXBlLgogICAgICAgICAgICAgICAgaWYgKCFyZWZsZWN0ICYmICF0\neXBlLmlzUHJpbWl0aXZlKCkKICAgICAgICAgICAgICAgICAgICAmJiAhdHlw\nZS5nZXROYW1lKCkuZXF1YWxzKFN0cmluZy5jbGFzcy5nZXROYW1lKCkpKQog\nICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZSh0\neXBlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsKCiAg\nICAgICAgICAgICAgICAvLyBnZXQgaWQvcGsgZnJvbSBwYyBpbnN0YW5jZQog\nICAgICAgICAgICAgICAgaWYgKGZtZHNbaV0uZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpID09IEphdmFUeXBlcy5QQykKICAgICAgICAgICAgICAgICAgICBhZGRF\neHRyYWN0T2JqZWN0SWRGaWVsZFZhbHVlQ29kZShjb2RlLCBmbWRzW2ldKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlZmxlY3QgJiYgZmll\nbGQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0\naWMoKS5zZXRNZXRob2QoUmVmbGVjdGlvbi5jbGFzcywgInNldCIsIAogICAg\nICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgT2Jq\nZWN0LmNsYXNzLCBGaWVsZC5jbGFzcywKICAgICAgICAgICAgICAgICAgICAo\ndHlwZS5pc1ByaW1pdGl2ZSgpKSA/IHR5cGUgOiBPYmplY3QuY2xhc3MgfSk7\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVmbGVjdCkgeyAKICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rp\nb24uY2xhc3MsICJzZXQiLCAKICAgICAgICAgICAgICAgICAgICB2b2lkLmNs\nYXNzLCBuZXcgQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgTWV0aG9kLmNsYXNz\nLAogICAgICAgICAgICAgICAgICAgICh0eXBlLmlzUHJpbWl0aXZlKCkpID8g\ndHlwZSA6IE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgfSBlbHNlIGlm\nIChmaWVsZCAhPSBudWxsKQogICAgICAgICAgICAgICAgY29kZS5wdXRmaWVs\nZCgpLnNldEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKHNldHRl\ncik7CiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwoKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBj\nb2RlIHRvIGV4dHJhY3QgdGhlIGlkIG9mIHRoZSBnaXZlbiBwcmltYXJ5IGtl\neSByZWxhdGlvbiBmaWVsZCBmb3IKICAgICAqIHNldHRpbmcgaW50byBhbiBv\nYmplY3RpZCBpbnN0YW5jZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZEV4dHJhY3RPYmplY3RJZEZpZWxkVmFsdWVDb2RlKENvZGUgY29kZSwgRmll\nbGRNZXRhRGF0YSBwaykgewogICAgICAgIC8vIGlmICh2YWwgIT0gbnVsbCkg\nCiAgICAgICAgLy8gIHZhbCA9ICgoUGVyc2lzdGVuY2VDYXBhYmxlKSB2YWwp\nLnBjRmV0Y2hPYmplY3RJZCgpOwogICAgICAgIGludCBwYyA9IGNvZGUuZ2V0\nTmV4dExvY2Fsc0luZGV4KCk7CiAgICAgICAgY29kZS5hc3RvcmUoKS5zZXRM\nb2NhbChwYyk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHBjKTsK\nICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gaWZudWxsMSA9IGNvZGUuaWZudWxs\nKCk7CiAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKHBjKTsKICAgICAg\nICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoUGVyc2lzdGVuY2VDYXBhYmxl\nLmNsYXNzKTsgCiAgICAgICAgaWYgKCFway5nZXRUeXBlTWV0YURhdGEoKS5p\nc09wZW5KUEFJZGVudGl0eSgpKQogICAgICAgICAgICBjb2RlLmludm9rZWlu\ndGVyZmFjZSgpLnNldE1ldGhvZChQZXJzaXN0ZW5jZUNhcGFibGUuY2xhc3Ms\nCiAgICAgICAgICAgICAgICBQUkUgKyAiRmV0Y2hPYmplY3RJZCIsIE9iamVj\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBjb2Rl\nLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChQZXJzaXN0ZW5jZUNhcGFi\nbGUuY2xhc3MsCiAgICAgICAgICAgICAgICBQUkUgKyAiTmV3T2JqZWN0SWRJ\nbnN0YW5jZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgIAog\nICAgICAgIGludCBvaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwog\nICAgICAgIGNvZGUuYXN0b3JlKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5zdHJ1\nY3Rpb24gaWZudWxsMiA9IGNvZGUuaWZudWxsKCk7IAoKICAgICAgICAvLyBm\nb3IgZGF0YXN0b3JlIC8gc2luZ2xlLWZpZWxkIGlkZW50aXR5OgogICAgICAg\nIC8vIGlmICh2YWwgIT0gbnVsbCkKICAgICAgICAvLyAgIHZhbCA9ICgoT3Bl\nbkpQQUlkKSB2YWwpLmdldElkKCk7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBw\na21ldGEgPSBway5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAg\nIGludCBwa2NvZGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlwZUNvZGUoKTsK\nICAgICAgICBDbGFzcyBwa3R5cGUgPSBway5nZXRPYmplY3RJZEZpZWxkVHlw\nZSgpOwogICAgICAgIGlmIChwa21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0g\nQ2xhc3NNZXRhRGF0YS5JRF9EQVRBU1RPUkUgCiAgICAgICAgICAgICYmIHBr\nY29kZSA9PSBKYXZhVHlwZXMuTE9ORykgewogICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKElkLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKElkLmNsYXNzLCAiZ2V0SWQiLCAKICAg\nICAgICAgICAgICAgIGxvbmcuY2xhc3MsIG51bGwpOwogICAgICAgIH0gZWxz\nZSBpZiAocGttZXRhLmdldElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURh\ndGEuSURfREFUQVNUT1JFKSB7CiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmlzT3Bl\nbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgc3dpdGNoIChwa2NvZGUp\nIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVfT0JKOgog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUoQnl0ZS5j\nbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuQllURToKICAgICAgICAgICAgICAgICAgICBjb2RlLmFs\nb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmNoZWNrY2FzdCgpLnNldFR5cGUoQnl0ZUlkLmNsYXNzKTsKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoQnl0\nZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBi\neXRlLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGtj\nb2RlID09IEphdmFUeXBlcy5CWVRFX09CSikKICAgICAgICAgICAgICAgICAg\nICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEJ5dGUuY2xh\nc3MsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9p\nZC5jbGFzcywgbmV3IENsYXNzW10ge2J5dGUuY2xhc3N9KTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLkNIQVJfT0JKOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygp\nLnNldFR5cGUoQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIGJyZWFr\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAg\nICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShDaGFy\nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChDaGFySWQuY2xhc3MsICJnZXRJZCIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIGNoYXIuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkNIQVJfT0JK\nKQogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwo\nKS5zZXRNZXRob2QoQ2hhcmFjdGVyLmNsYXNzLCAKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICI8aW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3Nb\nXSB7Y2hhci5jbGFzc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRE9VQkxFX09CSjoKICAg\nICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKERvdWJsZS5j\nbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAg\nICAgICAgICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2Fz\nZSBKYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNv\nZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShEb3VibGVJZC5jbGFzcyk7CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9k\nKERvdWJsZUlkLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAg\nICAgICBkb3VibGUuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChwa2NvZGUgPT0gSmF2YVR5cGVzLkRPVUJMRV9PQkopCiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lhbCgpLnNldE1ldGhv\nZChEb3VibGUuY2xhc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tde2RvdWJsZS5jbGFz\nc30pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAgICAgICAgICAgICAg\nICAgIGNvZGUuYW5ldygpLnNldFR5cGUoRmxvYXQuY2xhc3MpOwogICAgICAg\nICAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gbm8gYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZM\nT0FUOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2Nh\nbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCku\nc2V0VHlwZShGbG9hdElkLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBj\nb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoRmxvYXRJZC5jbGFzcywg\nImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQuY2xhc3Ms\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2\nYVR5cGVzLkZMT0FUX09CSikKICAgICAgICAgICAgICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKEZsb2F0LmNsYXNzLCAiPGlu\naXQ+IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkLmNsYXNz\nLCBuZXcgQ2xhc3NbXXtmbG9hdC5jbGFzc30pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5U\nX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBl\nKEludGVnZXIuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZHVw\nKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJlYWsKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoSW50SWQuY2xhc3MpOwog\nICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1l\ndGhvZChJbnRJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgaW50LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAocGtjb2RlID09IEphdmFUeXBlcy5JTlRfT0JKKQogICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoSW50\nZWdlci5jbGFzcywgIjxpbml0PiIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7aW50LmNsYXNzfSk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAgICAgICAgICAgICAgICBjb2Rl\nLmFuZXcoKS5zZXRUeXBlKExvbmcuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gYnJl\nYWsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAg\nICAgICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldExvY2FsKG9pZCk7CiAg\nICAgICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBlKExv\nbmdJZC5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKExvbmdJZC5jbGFzcywgImdldElkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9uZy5jbGFzcywgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHBrY29kZSA9PSBKYXZhVHlwZXMuTE9OR19P\nQkopCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlc3BlY2lh\nbCgpLnNldE1ldGhvZChMb25nLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHts\nb25nLmNsYXNzfSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5TSE9SVF9PQko6CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShTaG9ydC5jbGFzcyk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nICAgICAgICAvLyBubyBicmVhawogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuU0hPUlQ6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKFNob3J0SWQuY2xhc3MpOwogICAgICAgICAgICAg\nICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChTaG9ydElk\nLmNsYXNzLCAiZ2V0SWQiLAogICAgICAgICAgICAgICAgICAgICAgICBzaG9y\ndC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBrY29k\nZSA9PSBKYXZhVHlwZXMuU0hPUlRfT0JKKQogICAgICAgICAgICAgICAgICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoU2hvcnQuY2xh\nc3MsICI8aW5pdD4iLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG5ldyBDbGFzc1tde3Nob3J0LmNsYXNzfSk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5EQVRFOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShEYXRlSWQuY2xhc3MpOwogICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChEYXRlSWQuY2xh\nc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGUuY2xh\nc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGlmIChwa3R5cGUgIT0g\nRGF0ZS5jbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBqYXZh\nLnNxbC5EYXRlLmNsYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\nY2hlY2tjYXN0KCkuc2V0VHlwZShwa3R5cGUpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICAgICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoU3RyaW5nSWQuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNl\ndE1ldGhvZChTdHJpbmdJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgU3RyaW5nLmNsYXNzLCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJJR0RFQ0lNQUw6CiAgICAgICAgICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgICAgICAgICAgY29kZS5jaGVj\na2Nhc3QoKS5zZXRUeXBlKEJpZ0RlY2ltYWxJZC5jbGFzcyk7CiAgICAgICAg\nICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKEJp\nZ0RlY2ltYWxJZC5jbGFzcywgImdldElkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgQmlnRGVjaW1hbC5jbGFzcywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nSUdJTlRFR0VSOgogICAgICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRMb2NhbChvaWQpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuY2hlY2tj\nYXN0KCkuc2V0VHlwZShCaWdJbnRlZ2VySWQuY2xhc3MpOwogICAgICAgICAg\nICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChCaWdJ\nbnRlZ2VySWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgIEJpZ0ludGVnZXIuY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAg\nICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2JqZWN0\nSWQuY2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmly\ndHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFzcywgImdldElkIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxsKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAocGttZXRhLmdldE9iamVj\ndElkVHlwZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgY29kZS5hbG9hZCgp\nLnNldExvY2FsKG9pZCk7CiAgICAgICAgICAgIGlmIChwa2NvZGUgPT0gSmF2\nYVR5cGVzLk9CSkVDVCkgewogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nh\nc3QoKS5zZXRUeXBlKE9iamVjdElkLmNsYXNzKTsKICAgICAgICAgICAgICAg\nIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJZC5jbGFz\ncywgImdldElkIiwgCiAgICAgICAgICAgIAkJCU9iamVjdC5jbGFzcywgbnVs\nbCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0\nKCkuc2V0VHlwZShwa3R5cGUpOwogICAgICAgIH0gZWxzZQogICAgICAgICAg\nICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwob2lkKTsKICAgICAgICBKdW1wSW5z\ndHJ1Y3Rpb24gZ28yID0gY29kZS5nbzIoKTsKCiAgICAgICAgLy8gaWYgKHZh\nbCA9PSBudWxsKQogICAgICAgIC8vICAgdmFsID0gPGRlZmF1bHQ+OwogICAg\nICAgIEluc3RydWN0aW9uIGRlZjsKICAgICAgICBzd2l0Y2ggKHBrY29kZSkg\newogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09MRUFOOgogICAgICAg\nICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGZhbHNl\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5CWVRFOgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKChieXRlKSAwKTsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSOgogICAgICAg\nICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKChjaGFy\nKSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5ET1VCTEU6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoMEQpOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAg\nICAgICAgICAgZGVmID0gY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50\nKCkuc2V0VmFsdWUoMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgIGRl\nZiA9IGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6\nCiAgICAgICAgICAgICAgICBkZWYgPSBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoKHNob3J0KSAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZGVmID0gY29kZS5jb25z\ndGFudCgpLnNldE51bGwoKTsKICAgICAgICB9CiAgICAgICAgaWZudWxsMS5z\nZXRUYXJnZXQoZGVmKTsKICAgICAgICBpZm51bGwyLnNldFRhcmdldChkZWYp\nOwogICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGRzIHRoZSA8Y29kZT5wY0NvcHlLZXlGaWVsZHNG\ncm9tT2JqZWN0SWQ8L2NvZGU+IG1ldGhvZHMKICAgICAqIHRvIGNsYXNzZXMg\ndXNpbmcgYXBwbGljYXRpb24gaWRlbnRpdHkuCiAgICAgKi8KICAgIHByaXZh\ndGUgdm9pZCBhZGRDb3B5S2V5RmllbGRzRnJvbU9iamVjdElkTWV0aG9kKGJv\nb2xlYW4gZmllbGRNYW5hZ2VyKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIC8vIHB1YmxpYyB2b2lkIHBjQ29weUtl\neUZpZWxkc0Zyb21PYmplY3RJZCAoT2JqZWN0SWRGaWVsZENvbnN1bWVyIGZj\nLAogICAgICAgIC8vCU9iamVjdCBvaWQpCiAgICAgICAgU3RyaW5nW10gYXJn\ncyA9IChmaWVsZE1hbmFnZXIpIAogICAgICAgICAgICA/ICBuZXcgU3RyaW5n\nW117IE9JREZDVFlQRS5nZXROYW1lKCksIE9iamVjdC5jbGFzcy5nZXROYW1l\nKCkgfQogICAgICAgICAgICA6IG5ldyBTdHJpbmdbXXsgT2JqZWN0LmNsYXNz\nLmdldE5hbWUoKSB9OwogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5k\nZWNsYXJlTWV0aG9kKFBSRSArICJDb3B5S2V5RmllbGRzRnJvbU9iamVjdElk\nIiwKICAgICAgICAgICAgdm9pZC5jbGFzcy5nZXROYW1lKCksIGFyZ3MpOwog\nICAgICAgIENvZGUgY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwoKICAg\nICAgICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kCiAgICAgICAgaWYgKF9t\nZXRhLmdldFBDU3VwZXJjbGFzcygpICE9IG51bGwgJiYgIWdldENyZWF0ZVN1\nYmNsYXNzKCkpIHsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nYXJncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQo\nKS5zZXRQYXJhbShpKTsKICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKGdldFR5cGUoX21ldGEuCiAgICAgICAgICAgICAgICBn\nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAg\nICAgICAgICBQUkUgKyAiQ29weUtleUZpZWxkc0Zyb21PYmplY3RJZCIsIHZv\naWQuY2xhc3MuZ2V0TmFtZSgpLCBhcmdzKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChmaWVsZE1hbmFnZXIpCiAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5z\nZXRQYXJhbSgxKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuYWxv\nYWQoKS5zZXRQYXJhbSgwKTsKCiAgICAgICAgaWYgKCFfbWV0YS5pc09wZW5K\nUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0SWRUeXBlU2hhcmVkKCkp\nIHsKICAgICAgICAgICAgLy8gb2lkID0gKChPYmplY3RJZCkgaWQpLmdldElk\nICgpOwogICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoT2Jq\nZWN0SWQuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwo\nKS5zZXRNZXRob2QoT2JqZWN0SWQuY2xhc3MsICJnZXRJZCIsCiAgICAgICAg\nICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gPG9pZCB0eXBlPiBjYXN0ID0gKDxvaWQgdHlwZT4pIG9pZDsKICAg\nICAgICBpbnQgaWQgPSBjb2RlLmdldE5leHRMb2NhbHNJbmRleCgpOwogICAg\nICAgIENsYXNzIG9pZFR5cGUgPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsK\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUob2lkVHlwZSk7CiAg\nICAgICAgY29kZS5hc3RvcmUoKS5zZXRMb2NhbChpZCk7CgogICAgICAgIC8v\nIGZzLnN0b3JlPHR5cGU+RmllbGQgKDxpbmRleD4sIGlkLjxmaWVsZD4pOyBv\nci4uLgogICAgICAgIC8vIHRoaXMuPGZpZWxkPiA9IGlkLjxmaWVsZD4KICAg\nICAgICAvLyBvciBmb3Igc2luZ2xlIGZpZWxkIGlkZW50aXR5OiBpZC5nZXRJ\nZCAoKQogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSA/IF9tZXRhLmdldEZpZWxkcygpCiAgICAgICAgICAgIDog\nX21ldGEuZ2V0RGVjbGFyZWRGaWVsZHMoKTsKICAgICAgICBTdHJpbmcgbmFt\nZTsKICAgICAgICBDbGFzcyB0eXBlOwogICAgICAgIENsYXNzIHVud3JhcHBl\nZDsKICAgICAgICBGaWVsZCBmaWVsZDsKICAgICAgICBNZXRob2QgZ2V0dGVy\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5KCkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIG5hbWUg\nPSBmbWRzW2ldLmdldE5hbWUoKTsKICAgICAgICAgICAgdHlwZSA9IGZtZHNb\naV0uZ2V0T2JqZWN0SWRGaWVsZFR5cGUoKTsKICAgICAgICAgICAgaWYgKCFm\naWVsZE1hbmFnZXIgCiAgICAgICAgICAgICAgICAmJiBmbWRzW2ldLmdldERl\nY2xhcmVkVHlwZUNvZGUoKSA9PSBKYXZhVHlwZXMuUEMpIHsKICAgICAgICAg\nICAgICAgIC8vIGlmIChzbSA9PSBudWxsKSByZXR1cm47CiAgICAgICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBF\nKTsKICAgICAgICAgICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNv\nZGUuaWZub25udWxsKCk7CiAgICAgICAgICAgICAgICBjb2RlLnZyZXR1cm4o\nKTsKICAgICAgICAgICAgICAgIC8vIHNtLmdldFBDUHJpbWFyeUtleShvaWQs\nIGkgKyBwY0luaGVyaXRlZEZpZWxkQ291bnQpOyAKICAgICAgICAgICAgICAg\nIGlmaW5zLnNldFRhcmdldChsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZh\nbHNlKSk7CiAgICAgICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBsZWF2ZSBv\ncmlnIG9uIHN0YWNrIHRvIHNldCB2YWx1ZSBpbnRvCiAgICAgICAgICAgICAg\nICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAgICAg\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0TG9jYWwoaWQpOwogICAgICAg\nICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKGkpOwogICAgICAg\nICAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChJTkhFUklULCBp\nbnQuY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5pYWRkKCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChT\ndGF0ZU1hbmFnZXIuY2xhc3MsIAogICAgICAgICAgICAgICAgICAgICJnZXRQ\nQ1ByaW1hcnlLZXkiLCBPYmplY3QuY2xhc3MsIAogICAgICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdIHsgT2JqZWN0LmNsYXNzLCBpbnQuY2xhc3MgfSk7\nCiAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7\nIAogICAgICAgICAgICAgICAgdW53cmFwcGVkID0gKGZtZHNbaV0uZ2V0RGVj\nbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5QQykgCiAgICAgICAgICAg\nICAgICAgICAgPyB0eXBlIDogdW53cmFwU2luZ2xlRmllbGRJZGVudGl0eShm\nbWRzW2ldKTsKICAgICAgICAgICAgICAgIGlmIChmaWVsZE1hbmFnZXIpIHsK\nICAgICAgICAgICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVl\nKGkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmlhZGQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAg\nICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwoKICAgICAgICAgICAgICAgIGlmICh1bndyYXBwZWQgIT0gdHlwZSkgewog\nICAgICAgICAgICAgICAgICAgIGNvZGUuYW5ldygpLnNldFR5cGUodHlwZSk7\nCiAgICAgICAgICAgICAgICAgICAgY29kZS5kdXAoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGNvZGUuYWxvYWQoKS5zZXRMb2NhbChp\nZCk7CiAgICAgICAgICAgICAgICBpZiAoX21ldGEuaXNPcGVuSlBBSWRlbnRp\ndHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChvaWRUeXBlID09IE9i\namVjdElkLmNsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChvaWRUeXBlLCAiZ2V0SWQiLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNsYXNzLCBudWxs\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1hbmFnZXIg\nJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1kc1tpXS5nZXRE\nZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlm\nIChvaWRUeXBlID09IERhdGVJZC5jbGFzcykgewogICAgICAgICAgICAgICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qob2lkVHlw\nZSwgImdldElkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGUu\nY2xhc3MsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZp\nZWxkTWFuYWdlciAmJiB0eXBlICE9IERhdGUuY2xhc3MpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUoZm1k\nc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2V2\naXJ0dWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICJnZXRJZCIsIAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdW53cmFwcGVkLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcHBlZCAhPSB0eXBlKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCku\nc2V0TWV0aG9kKHR5cGUsICI8aW5pdD4iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdeyB1bndyYXBw\nZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChpc0ZpZWxkQWNjZXNzKGZtZHNbaV0pKSB7CiAgICAgICAg\nICAgICAgICAgICAgZmllbGQgPSBSZWZsZWN0aW9uLmZpbmRGaWVsZChvaWRU\neXBlLCBuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTW9k\naWZpZXIuaXNQdWJsaWMoZmllbGQuZ2V0TW9kaWZpZXJzKCkpKQogICAgICAg\nICAgICAgICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoZmll\nbGQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBSZWZsZWN0aW9uLmdldFhYWChvaWQsIFJlZmxlY3Rp\nb24uZmluZEZpZWxkKC4uLikpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb2RlLmNsYXNzY29uc3RhbnQoKS5zZXRDbGFzcyhvaWRUeXBlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKG5h\nbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNvbnN0YW50KCku\nc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQu\nY2xhc3MsIG5ldyBDbGFzc1tdIHsgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNsYXNz\nIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRp\nYygpLnNldE1ldGhvZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGdl\ndFJlZmxlY3Rpb25HZXR0ZXJNZXRob2QodHlwZSwgRmllbGQuY2xhc3MpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0eXBlLmlzUHJpbWl0aXZl\nKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICBnZXR0ZXIgPSBSZWZsZWN0aW9uLmZpbmRH\nZXR0ZXIob2lkVHlwZSwgbmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKE1vZGlmaWVyLmlzUHVibGljKGdldHRlci5nZXRNb2RpZmllcnMo\nKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVh\nbCgpLnNldE1ldGhvZChnZXR0ZXIpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWZsZWN0aW9uLmdl\ndFhYWChvaWQsIFJlZmxlY3Rpb24uZmluZEdldHRlciguLi4pKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xh\nc3Mob2lkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShuYW1lKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgY29kZS5jb25zdGFudCgpLnNldFZhbHVlKHRydWUpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNldE1ldGhvZChS\nZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nImZpbmRHZXR0ZXIiLCBNZXRob2QuY2xhc3MsIG5ldyBDbGFzc1tdIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcu\nY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvZGUuaW52b2tlc3RhdGljKCkuc2V0TWV0aG9kCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAoZ2V0UmVmbGVjdGlvbkdldHRlck1ldGhvZCh0\neXBlLCBNZXRob2QuY2xhc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKCF0eXBlLmlzUHJpbWl0aXZlKCkgJiYgdHlwZSAhPSBPYmplY3QuY2xh\nc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlLmNoZWNrY2Fz\ndCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nZmllbGRNYW5hZ2VyKQogICAgICAgICAgICAgICAgY29kZS5pbnZva2VpbnRl\ncmZhY2UoKS5zZXRNZXRob2QoZ2V0RmllbGRDb25zdW1lck1ldGhvZCh0eXBl\nKSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFkZFNldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kc1tpXSk7CiAgICAgICAgfQogICAg\nICAgIGNvZGUudnJldHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1h\neFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBpZiB0aGUgY2xhc3MgdXNl\ncyB0aGUgQ2xhc3MvU3RyaW5nIGNvbnN0cnVjdG9yCiAgICAgKiBpbnN0ZWFk\nIG9mIGp1c3QgU3RyaW5nLgogICAgICovCiAgICBwcml2YXRlIEJvb2xlYW4g\ndXNlc0NsYXNzU3RyaW5nSWRDb25zdHJ1Y3RvcigpIHsKICAgICAgICBpZiAo\nX21ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgIT0gQ2xhc3NNZXRhRGF0YS5JRF9B\nUFBMSUNBVElPTikKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7\nCgogICAgICAgIGlmIChfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpKSB7CiAg\nICAgICAgICAgIGlmIChfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSA9PSBPYmpl\nY3RJZC5jbGFzcykKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgICAgICByZXR1cm4gQm9vbGVhbi5UUlVFOwogICAgICAgIH0KCiAgICAg\nICAgQ2xhc3Mgb2lkVHlwZSA9IF9tZXRhLmdldE9iamVjdElkVHlwZSgpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9pZFR5cGUuZ2V0Q29uc3RydWN0\nb3IobmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmcuY2xhc3MgfSk7\nCiAgICAgICAgICAgIHJldHVybiBCb29sZWFuLlRSVUU7CiAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICB9CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgb2lkVHlwZS5nZXRDb25zdHJ1Y3RvcihuZXcgQ2xhc3Nb\nXXsgU3RyaW5nLmNsYXNzIH0pOwogICAgICAgICAgICByZXR1cm4gQm9vbGVh\nbi5GQUxTRTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIElmIHRoZSBnaXZlbiBmaWVsZCBpcyBhIHdyYXBwZXItdHlwZSBzaW5n\nbGUgZmllbGQgaWRlbnRpdHkgcHJpbWFyeSBrZXksCiAgICAgKiByZXR1cm4g\naXRzIGNvcnJlc3BvbmRpbmcgcHJpbWl0aXZlIGNsYXNzLiBFbHNlIHJldHVy\nbiB0aGUgZmllbGQgdHlwZS4KICAgICAqLwogICAgcHJpdmF0ZSBDbGFzcyB1\nbndyYXBTaW5nbGVGaWVsZElkZW50aXR5KEZpZWxkTWV0YURhdGEgZm1kKSB7\nCiAgICAgICAgaWYgKCFmbWQuZ2V0RGVmaW5pbmdNZXRhRGF0YSgpLmlzT3Bl\nbkpQQUlkZW50aXR5KCkpCiAgICAgICAgICAgIHJldHVybiBmbWQuZ2V0RGVj\nbGFyZWRUeXBlKCk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVk\nVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CWVRF\nX09CSjoKICAgICAgICAgICAgICAgIHJldHVybiBieXRlLmNsYXNzOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5DSEFSX09CSjoKICAgICAgICAgICAg\nICAgIHJldHVybiBjaGFyLmNsYXNzOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5ET1VCTEVfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIGRvdWJs\nZS5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JK\nOgogICAgICAgICAgICAgICAgcmV0dXJuIGZsb2F0LmNsYXNzOwogICAgICAg\nICAgICBjYXNlIEphdmFUeXBlcy5JTlRfT0JKOgogICAgICAgICAgICAgICAg\ncmV0dXJuIGludC5jbGFzczsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nU0hPUlRfT0JKOgogICAgICAgICAgICAgICAgcmV0dXJuIHNob3J0LmNsYXNz\nOwogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5MT05HX09CSjoKICAgICAg\nICAgICAgICAgIHJldHVybiBsb25nLmNsYXNzOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZtZC5nZXREZWNsYXJlZFR5\ncGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4g\ndGhlIHByb3BlciBnZXR0ZXIgbWV0aG9kIG9mIHRoZSB7QGxpbmsgUmVmbGVj\ndGlvbn0gaGVscGVyIGZvcgogICAgICogYSBmaWVsZCBvciBnZXR0ZXIgbWV0\naG9kIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAgICBwcml2YXRlIE1l\ndGhvZCBnZXRSZWZsZWN0aW9uR2V0dGVyTWV0aG9kKENsYXNzIHR5cGUsIENs\nYXNzIGFyZ1R5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU3RyaW5nIG5hbWUgPSAiZ2V0IjsKICAgICAgICBp\nZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICBuYW1lICs9IFN0\ncmluZ1V0aWxzLmNhcGl0YWxpemUodHlwZS5nZXROYW1lKCkpOwogICAgICAg\nIHJldHVybiBSZWZsZWN0aW9uLmNsYXNzLmdldE1ldGhvZChuYW1lLCBuZXcg\nQ2xhc3NbXSB7IE9iamVjdC5jbGFzcywgCiAgICAgICAgICAgIGFyZ1R5cGUg\nfSk7IAogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBwcm9wZXIg\nZmV0Y2ggbWV0aG9kIG9mIHRoZSBPYmplY3RJZEZpZWxkU3VwcGxpZXIgZm9y\nCiAgICAgKiBhIGZpZWxkIG9mIHRoZSBnaXZlbiB0eXBlLgogICAgICovCiAg\nICBwcml2YXRlIE1ldGhvZCBnZXRGaWVsZFN1cHBsaWVyTWV0aG9kKENsYXNz\nIHR5cGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIGdldE1ldGhvZChPSURGU1RZUEUsIHR5cGUsICJm\nZXRjaCIsIHRydWUsIGZhbHNlLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gdGhlIHByb3BlciBmZXRjaCBtZXRob2Qgb2YgdGhlIE9i\namVjdElkRmllbGRDb25zdW1lciBmb3IKICAgICAqIGEgZmllbGQgb2YgdGhl\nIGdpdmVuIHR5cGUuCiAgICAgKi8KICAgIHByaXZhdGUgTWV0aG9kIGdldEZp\nZWxkQ29uc3VtZXJNZXRob2QoQ2xhc3MgdHlwZSkKICAgICAgICB0aHJvd3Mg\nTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZ2V0TWV0\naG9kKE9JREZDVFlQRSwgdHlwZSwgInN0b3JlIiwgZmFsc2UsIGZhbHNlLCBm\nYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBwY05ld09i\namVjdElkSW5zdGFuY2UgbWV0aG9kIHRvIGNsYXNzZXMgdXNpbmcKICAgICAq\nIGFwcGxpY2F0aW9uIGlkZW50aXR5LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkTmV3T2JqZWN0SWRJbnN0YW5jZU1ldGhvZChib29sZWFuIG9iaikK\nICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBwdWJsaWMgT2JqZWN0IHBjTmV3T2JqZWN0SWRJbnN0YW5jZSAoKQog\nICAgICAgIENsYXNzW10gYXJncyA9IChvYmopID8gbmV3IENsYXNzW117IE9i\namVjdC5jbGFzcyB9IDogbnVsbDsKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiTmV3T2JqZWN0SWRJbnN0YW5j\nZSIsCiAgICAgICAgICAgIE9iamVjdC5jbGFzcywgYXJncyk7CiAgICAgICAg\nQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CgogICAgICAgIEJv\nb2xlYW4gdXNlc0Nsc1N0cmluZyA9IHVzZXNDbGFzc1N0cmluZ0lkQ29uc3Ry\ndWN0b3IoKTsKICAgICAgICBDbGFzcyBvaWRUeXBlID0gX21ldGEuZ2V0T2Jq\nZWN0SWRUeXBlKCk7CiAgICAgICAgaWYgKG9iaiAmJiB1c2VzQ2xzU3RyaW5n\nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gdGhyb3cgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbiAoLi4uKTsKICAgICAgICAgICAgU3RyaW5nIG1z\nZyA9IF9sb2MuZ2V0KCJzdHItY29ucyIsIG9pZFR5cGUsCiAgICAgICAgICAg\nICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpLmdldE1lc3NhZ2UoKTsK\nICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmR1cCgpOwog\nICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUobXNnKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbi5jbGFzcywKICAgICAgICAgICAgICAgICI8\naW5pdD4iLCB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgU3RyaW5nLmNsYXNz\nIH0pOwogICAgICAgICAgICBjb2RlLmF0aHJvdygpOwogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKCFfbWV0YS5pc09wZW5KUEFJZGVudGl0eSgpICYmIF9tZXRhLmlzT2JqZWN0\nSWRUeXBlU2hhcmVkKCkpIHsKICAgICAgICAgICAgLy8gbmV3IE9iamVjdElk\nIChjbHMsIG9pZCkKICAgICAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShP\nYmplY3RJZC5jbGFzcyk7CiAgICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAg\nICAgICAgIGlmKF9tZXRhLmlzRW1iZWRkZWRPbmx5KCkgfHwgX21ldGEuaGFz\nQWJzdHJhY3RQS0ZpZWxkKCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgICAgIGNvZGUu\naW52b2tldmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0SURPd25pbmdD\nbGFzcyIsCiAgICAgICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIG51bGwp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29kZS5j\nbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBuZXcgPG9pZCBjbGFz\ncz4gKCk7CiAgICAgICAgY29kZS5hbmV3KCkuc2V0VHlwZShvaWRUeXBlKTsK\nICAgICAgICBjb2RlLmR1cCgpOwogICAgICAgIGlmIChfbWV0YS5pc09wZW5K\nUEFJZGVudGl0eSgpIHx8IChvYmogJiYgdXNlc0Nsc1N0cmluZyA9PQogICAg\nICAgICAgICAgICAgICAgIEJvb2xlYW4uVFJVRSkpIHsKICAgICAgICAgICAg\naWYoX21ldGEuaXNFbWJlZGRlZE9ubHkoKSB8fCBfbWV0YS5oYXNBYnN0cmFj\ndFBLRmllbGQoKSA9PSB0cnVlICkgewogICAgICAgICAgICAgICAgY29kZS5h\nbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0SURPd25pbmdDbGFzcyIs\nCiAgICAgICAgICAgICAgICAgICAgQ2xhc3MuY2xhc3MsIG51bGwpOwogICAg\nICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICBjb2RlLmNsYXNzY29u\nc3RhbnQoKS5zZXRDbGFzcyhnZXRUeXBlKF9tZXRhKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaWYgKG9iaikgewogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuY2hl\nY2tjYXN0KCkuc2V0VHlwZShTdHJpbmcuY2xhc3MpOwogICAgICAgICAgICBp\nZiAodXNlc0Nsc1N0cmluZyA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAg\nICAgICBhcmdzID0gbmV3IENsYXNzW117IENsYXNzLmNsYXNzLCBTdHJpbmcu\nY2xhc3MgfTsKICAgICAgICAgICAgZWxzZSBpZiAodXNlc0Nsc1N0cmluZyA9\nPSBCb29sZWFuLkZBTFNFKQogICAgICAgICAgICAgICAgYXJncyA9IG5ldyBD\nbGFzc1tdeyBTdHJpbmcuY2xhc3MgfTsKICAgICAgICB9IGVsc2UgaWYgKF9t\nZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpIHsKICAgICAgICAgICAgLy8gbmV3\nIDx0eXBlPklkZW50aXR5IChYWFguY2xhc3MsIDxwaz4pOwogICAgICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YSBwayA9IF9tZXRhLmdldFByaW1hcnlLZXlGaWVs\nZHMoKVswXTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShj\nb2RlLCBwayk7CiAgICAgICAgICAgIGlmIChway5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkgPT0gSmF2YVR5cGVzLlBDKQogICAgICAgICAgICAgICAgYWRkRXh0\ncmFjdE9iamVjdElkRmllbGRWYWx1ZUNvZGUoY29kZSwgcGspOwogICAgICAg\nICAgICBpZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gT2JqZWN0SWQu\nY2xhc3MpCiAgICAgICAgICAgICAgICBhcmdzID0gbmV3IENsYXNzW117IENs\nYXNzLmNsYXNzLCBPYmplY3QuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZSBp\nZiAoX21ldGEuZ2V0T2JqZWN0SWRUeXBlKCkgPT0gRGF0ZS5jbGFzcykKICAg\nICAgICAgICAgICAgIGFyZ3MgPSBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3Ms\nIERhdGUuY2xhc3MgfTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAg\nICAgYXJncyA9IG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgcGsuZ2V0T2Jq\nZWN0SWRGaWVsZFR5cGUoKSB9OwogICAgICAgIH0KCiAgICAgICAgY29kZS5p\nbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKG9pZFR5cGUsICI8aW5pdD4iLCB2\nb2lkLmNsYXNzLCBhcmdzKTsKICAgICAgICBpZiAoIV9tZXRhLmlzT3BlbkpQ\nQUlkZW50aXR5KCkgJiYgX21ldGEuaXNPYmplY3RJZFR5cGVTaGFyZWQoKSkK\nICAgICAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKE9i\namVjdElkLmNsYXNzLCAiPGluaXQ+IiwKICAgICAgICAgICAgICAgIHZvaWQu\nY2xhc3MsIG5ldyBDbGFzc1tdeyBDbGFzcy5jbGFzcywgT2JqZWN0LmNsYXNz\nIH0pOwogICAgICAgIGNvZGUuYXJldHVybigpOwoKICAgICAgICBjb2RlLmNh\nbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhM\nb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZW4gY29tbXVuaWNh\ndGluZyB3aXRoIHRoZSBTdGF0ZU1hbmFnZXIsIG1hbnkgbWV0aG9kcyBhcmUg\ndXNlZAogICAgICogZGVwZW5kaW5nIG9uIHRoZSBjbGFzcyBvZiBzdGF0ZSBi\nZWluZyBwYXNzZWQuIFRoaXMgbWV0aG9kLAogICAgICogZ2l2ZW4gdGhlIHR5\ncGUgb2YgaW5mb3JtYXRpb24gYmVpbmcgcGFzc2VkIGFuZCB0aGUgcHJlZml4\nCiAgICAgKiAoJ3Byb3ZpZGVkJywgJ3JlcGxhY2UnLCBldGMpIG9mIHRoZSBt\nZXRob2QgdG8KICAgICAqIGNhbGwsIHJldHVybnMgdGhlIFN0YXRlTWFuYWdl\nciBtZXRob2QgdGhhdCBzaG91bGQgYmUgdXNlZC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gdHlwZSB0aGUgdHlwZSBvZiBzdGF0ZSBiZWluZyBwYXNzZWQKICAg\nICAqIEBwYXJhbSBwcmVmaXggdGhlIHByZWZpeCBvZiB0aGUgbWV0aG9kIHRv\nIGNhbGw7IGFsbCBtZXRob2RzCiAgICAgKiBlbmQgaW4gJ1tzdGF0ZSB0eXBl\nXUZpZWxkJzsgb25seSB0aGUgcHJlZml4IHZhcmllcwogICAgICogQHBhcmFt\nIGdldCB0cnVlIGlmIHJlY2VpdmluZyBpbmZvcm1hdGlvbiBmcm9tIHRoZQog\nICAgICogU3RhdGVNYW5hZ2VyLCBmYWxzZSBpZiBwYXNzaW5nIGl0IHRvIHRo\nZSBTTQogICAgICogQHBhcmFtIGN1clZhbHVlIHRydWUgaWYgdGhlIGN1cnJl\nbnQgc3RhdGUgdmFsdWUgaXMgcGFzc2VkIHRvCiAgICAgKiB0aGUgU3RhdGVN\nYW5hZ2VyIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8KICAgIHByaXZh\ndGUgTWV0aG9kIGdldFN0YXRlTWFuYWdlck1ldGhvZChDbGFzcyB0eXBlLCBT\ndHJpbmcgcHJlZml4LAogICAgICAgIGJvb2xlYW4gZ2V0LCBib29sZWFuIGN1\nclZhbHVlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBnZXRNZXRob2QoU01UWVBFLCB0eXBlLCBwcmVm\naXgsIGdldCwgdHJ1ZSwgY3VyVmFsdWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSBtZXRob2Qgb2YgdGhlIGdpdmVuIG93bmVyIHR5cGUg\nbWF0Y2hpbmcgdGhlIGdpdmVuIGNyaXRlcmlhLgogICAgICoKICAgICAqIEBw\nYXJhbSB0eXBlIHRoZSB0eXBlIG9mIHN0YXRlIGJlaW5nIHBhc3NlZAogICAg\nICogQHBhcmFtIHByZWZpeCB0aGUgcHJlZml4IG9mIHRoZSBtZXRob2QgdG8g\nY2FsbDsgYWxsIG1ldGhvZHMKICAgICAqIGVuZCBpbiAnW3N0YXRlIHR5cGVd\nRmllbGQnOyBvbmx5IHRoZSBwcmVmaXggdmFyaWVzCiAgICAgKiBAcGFyYW0g\nZ2V0IHRydWUgaWYgcmVjZWl2aW5nIGluZm9ybWF0aW9uIGZyb20gdGhlCiAg\nICAgKiBvd25lciwgZmFsc2UgaWYgcGFzc2luZyBpdCB0byB0aGUgb3duZXIK\nICAgICAqIEBwYXJhbSBoYXNwYyB0cnVlIGlmIHRoZSBwYyBpcyBwYXNzZWQg\nYXMgYW4gZXh0cmEgYXJndW1lbnQKICAgICAqIEBwYXJhbSBjdXJWYWx1ZSB0\ncnVlIGlmIHRoZSBjdXJyZW50IHN0YXRlIHZhbHVlIGlzIHBhc3NlZCB0bwog\nICAgICogdGhlIG93bmVyIGFzIGFuIGV4dHJhIGFyZ3VtZW50CiAgICAgKi8K\nICAgIHByaXZhdGUgTWV0aG9kIGdldE1ldGhvZChDbGFzcyBvd25lciwgQ2xh\nc3MgdHlwZSwgU3RyaW5nIHByZWZpeCwKICAgICAgICBib29sZWFuIGdldCwg\nYm9vbGVhbiBoYXNwYywgYm9vbGVhbiBjdXJWYWx1ZSkKICAgICAgICB0aHJv\nd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICAvLyBhbGwgbWV0\naG9kcyBlbmQgaW4gW2ZpZWxkIHR5cGVdRmllbGQsIHdoZXJlIHRoZSBmaWVs\nZCB0eXBlCiAgICAgICAgLy8gY2FuIGJlIGFueSBvZiB0aGUgcHJpbWl0dmUg\ndHlwZXMgKGJ1dCBjYXBpdGFsaXplZCksICdTdHJpbmcnLAogICAgICAgIC8v\nIG9yICdPYmplY3QnOyBmaWd1cmUgb3V0IHdoYXQgdHlwZSB0byB1c2UKICAg\nICAgICBTdHJpbmcgdHlwZU5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAg\nICBpZiAodHlwZS5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAgICB0eXBlTmFt\nZSA9IHR5cGVOYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZShMb2Nh\nbGUuRU5HTElTSCkKICAgICAgICAgICAgICAgICsgdHlwZU5hbWUuc3Vic3Ry\naW5nKDEpOwogICAgICAgIGVsc2UgaWYgKHR5cGUuZXF1YWxzKFN0cmluZy5j\nbGFzcykpCiAgICAgICAgICAgIHR5cGVOYW1lID0gIlN0cmluZyI7CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIHR5cGVOYW1lID0gIk9iamVjdCI7CiAg\nICAgICAgICAgIHR5cGUgPSBPYmplY3QuY2xhc3M7CiAgICAgICAgfQoKICAg\nICAgICAvLyB0aGUgZmllbGQgaW5kZXggaXMgYWx3YXlzIHBhc3NlZCBhcyBh\nbiBhcmc7IHRoZSBwYyBpbnN0YW5jZSBhbmQKICAgICAgICAvLyB0aGUgY3Vy\ncmVudCB2YWx1ZSBtYXkgYmUgcGFzc2VkOyBpZiBzZXR0aW5nIHRoZSBuZXcg\ndmFsdWUgaXMKICAgICAgICAvLyBhbHNvIHBhc3NlZAogICAgICAgIExpc3Qg\ncGxpc3QgPSBuZXcgQXJyYXlMaXN0KDQpOwogICAgICAgIGlmIChoYXNwYykK\nICAgICAgICAgICAgcGxpc3QuYWRkKFBDVFlQRSk7CiAgICAgICAgcGxpc3Qu\nYWRkKGludC5jbGFzcyk7CiAgICAgICAgaWYgKCFnZXQgfHwgY3VyVmFsdWUp\nCiAgICAgICAgICAgIHBsaXN0LmFkZCh0eXBlKTsKICAgICAgICBpZiAoIWdl\ndCAmJiBjdXJWYWx1ZSkgewogICAgICAgICAgICBwbGlzdC5hZGQodHlwZSk7\nCiAgICAgICAgICAgIHBsaXN0LmFkZChpbnQuY2xhc3MpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gdXNlIHJlZmxlY3Rpb24gdG8gcmV0dXJuIHRoZSByaWdo\ndCBtZXRob2QKICAgICAgICBTdHJpbmcgbmFtZSA9IHByZWZpeCArIHR5cGVO\nYW1lICsgIkZpZWxkIjsKICAgICAgICBDbGFzc1tdIHBhcmFtcyA9IChDbGFz\nc1tdKSBwbGlzdC50b0FycmF5KG5ldyBDbGFzc1twbGlzdC5zaXplKCldKTsK\nICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gQWNj\nZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICBK\nMkRvUHJpdkhlbHBlci5nZXREZWNsYXJlZE1ldGhvZEFjdGlvbihvd25lciwg\nbmFtZSwgcGFyYW1zKSk7CiAgICAgICAgfSBjYXRjaCAoUHJpdmlsZWdlZEFj\ndGlvbkV4Y2VwdGlvbiBwYWUpIHsKICAgICAgICAgICAgIHRocm93IChOb1N1\nY2hNZXRob2RFeGNlcHRpb24pIHBhZS5nZXRFeGNlcHRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGFk\nZCB0aGUgY29kZSBuZWNlc3NhcnkgdG8gdGhyb3cgdGhlIGdpdmVuCiAgICAg\nKiBleGNlcHRpb24gdHlwZSwgc2FucyBtZXNzYWdlLgogICAgICovCiAgICBw\ncml2YXRlIEluc3RydWN0aW9uIHRocm93RXhjZXB0aW9uKENvZGUgY29kZSwg\nQ2xhc3MgdHlwZSkgewogICAgICAgIEluc3RydWN0aW9uIGlucyA9IGNvZGUu\nYW5ldygpLnNldFR5cGUodHlwZSk7CiAgICAgICAgY29kZS5kdXAoKTsKICAg\nICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QodHlwZSwgIjxp\nbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNvZGUuYXRocm93\nKCk7CiAgICAgICAgcmV0dXJuIGluczsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZHMgdGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnRlcmZhY2UgdG8gdGhl\nIGNsYXNzIGJlaW5nCiAgICAgKiBlbmhhbmNlZCwgYW5kIGFkZHMgYSBkZWZh\ndWx0IGNvbnN0cnVjdG9yIGZvciB1c2UgYnkgT3BlbkpQQQogICAgICogaWYg\naXQgaXMgbm90IGFscmVhZHkgcHJlc2VudC4KICAgICAqLwogICAgcHJpdmF0\nZSB2b2lkIGVuaGFuY2VDbGFzcygpIHsKICAgICAgICAvLyBtYWtlIHRoZSBj\nbGFzcyBpbXBsZW1lbnQgUGVyc2lzdGVuY2VDYXBhYmxlCiAgICAgICAgX3Bj\nLmRlY2xhcmVJbnRlcmZhY2UoUENUWVBFKTsKCiAgICAgICAgLy8gYWRkIGEg\ndmVyc2lvbiBzdGFtcAogICAgICAgIGFkZEdldEVuaGFuY2VtZW50Q29udHJh\nY3RWZXJzaW9uTWV0aG9kKCk7CgogICAgICAgIC8vIGZpbmQgdGhlIGRlZmF1\nbHQgY29uc3RydWN0b3IKICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMu\nZ2V0RGVjbGFyZWRNZXRob2QoIjxpbml0PiIsIChTdHJpbmdbXSkgbnVsbCk7\nCgogICAgICAgIC8vIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciBpcyByZXF1aXJl\nZAogICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkgewogICAgICAgICAgICBT\ndHJpbmcgbmFtZSA9IF9wYy5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmICgh\nX2RlZkNvbnMpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgiZW5oYW5jZS1kZWZhdWx0Y29uc3QiLCBuYW1lKSk7\nCgogICAgICAgICAgICBtZXRob2QgPSBfcGMuYWRkRGVmYXVsdENvbnN0cnVj\ndG9yKCk7CiAgICAgICAgICAgIFN0cmluZyBhY2Nlc3M7CiAgICAgICAgICAg\nIGlmIChfbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICAgICAg\nLy8gZXh0ZXJuYWxpemFibGUgcmVxdWlyZXMgdGhhdCB0aGUgY29uc3RydWN0\nb3IKICAgICAgICAgICAgICAgIC8vIGJlIHB1YmxpYywgc28gbWFrZSB0aGUg\nYWRkZWQgY29uc3RydWN0b3IgcHVibGljCiAgICAgICAgICAgICAgICBtZXRo\nb2QubWFrZVB1YmxpYygpOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInB1\nYmxpYyI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3BjLmlzRmluYWwoKSkg\newogICAgICAgICAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAgICAg\nICAgICAgICAgICBhY2Nlc3MgPSAicHJpdmF0ZSI7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBtZXRob2QubWFrZVByb3RlY3RlZCgp\nOwogICAgICAgICAgICAgICAgYWNjZXNzID0gInByb3RlY3RlZCI7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKCEoX21ldGEuZ2V0RGVzY3JpYmVk\nVHlwZSgpLmlzSW50ZXJmYWNlKCkgfHwgZ2V0Q3JlYXRlU3ViY2xhc3MoKSkK\nICAgICAgICAgICAgICAgICYmIF9sb2cuaXNXYXJuRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNlLWFkZGRl\nZmF1bHRjb25zdCIsIG5hbWUsIGFjY2VzcykpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEFkZHMgdGhlIGZvbGxvd2luZyBmaWVsZHMgdG8g\ndGhlIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0YW5jZToKICAgICAqIDx1bD4K\nICAgICAqIDxsaT48Y29kZT5wcml2YXRlIHN0YXRpYyBpbnQgcGNJbmhlcml0\nZWRGaWVsZENvdW50PC9jb2RlPjwvbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJp\ndmF0ZSBzdGF0aWMgQ2xhc3MgcGNQQ1N1cGVyY2xhc3M8L2NvZGU+CiAgICAg\nKiA8L2xpPgogICAgICogPGxpPjxjb2RlPnByaXZhdGUgc3RhdGljIFN0cmlu\nZ1tdIHBjRmllbGROYW1lczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2Rl\nPnByaXZhdGUgc3RhdGljIENsYXNzW10gcGNGaWVsZFR5cGVzPC9jb2RlPjwv\nbGk+CiAgICAgKiA8bGk+PGNvZGU+cHJpdmF0ZSBzdGF0aWMgYnl0ZVtdIHBj\nRmllbGRGbGFnczwvY29kZT48L2xpPgogICAgICogPGxpPjxjb2RlPnByb3Rl\nY3RlZCB0cmFuc2llbnQgU3RhdGVNYW5hZ2VyIHBjU3RhdGVNYW5hZ2VyPC9j\nb2RlPgogICAgICogaWYgbm8gUGVyc2lzdGVuY2VDYXBhYmxlIHN1cGVyY2xh\nc3MgcHJlc2VudCk8L2xpPgogICAgICogPC91bD4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGFkZEZpZWxkcygpIHsKICAgICAgICBfcGMuZGVjbGFyZUZp\nZWxkKElOSEVSSVQsIGludC5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAg\nICAgIF9wYy5kZWNsYXJlRmllbGQoUFJFICsgIkZpZWxkTmFtZXMiLCBTdHJp\nbmdbXS5jbGFzcykuc2V0U3RhdGljKHRydWUpOwogICAgICAgIF9wYy5kZWNs\nYXJlRmllbGQoUFJFICsgIkZpZWxkVHlwZXMiLCBDbGFzc1tdLmNsYXNzKS5z\nZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgX3BjLmRlY2xhcmVGaWVsZChQUkUg\nKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcykuc2V0U3RhdGljKHRydWUp\nOwogICAgICAgIF9wYy5kZWNsYXJlRmllbGQoU1VQRVIsIENsYXNzLmNsYXNz\nKS5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgaWYoX2FkZFZlcnNpb25Jbml0\nRmxhZyAmJiBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKSE9bnVsbCl7CiAgICAg\nICAgICAgIC8vIHByb3RlY3RlZCB0cmFuc2llbnQgYm9vbGVhbiBwY1ZlcnNp\nb25Jbml0OwogICAgICAgICAgICBCQ0ZpZWxkIGZpZWxkID0gX3BjLmRlY2xh\ncmVGaWVsZChWRVJTSU9OX0lOSVRfU1RSLCBib29sZWFuLmNsYXNzKTsKICAg\nICAgICAgICAgZmllbGQubWFrZVByb3RlY3RlZCgpOwogICAgICAgICAgICBm\naWVsZC5zZXRUcmFuc2llbnQodHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlm\nIChfbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8IGdldENyZWF0\nZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9w\nYy5kZWNsYXJlRmllbGQoU00sIFNNVFlQRSk7CiAgICAgICAgICAgIGZpZWxk\nLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICAgICAgZmllbGQuc2V0VHJhbnNp\nZW50KHRydWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1v\nZGlmaWVzIHRoZSBjbGFzcyBpbml0aWFsaXphdGlvbiBtZXRob2QgKGNyZWF0\naW5nIG9uZSBpZiBuZWNlc3NhcnkpCiAgICAgKiB0byBpbml0aWFsaXplIHRo\nZSBzdGF0aWMgZmllbGRzIG9mIHRoZSBQZXJzaXN0ZW5jZUNhcGFibGUgaW5z\ndGFuY2UgYW5kCiAgICAgKiB0byByZWdpc3RlciBpdCB3aXRoIHRoZSBpbXBs\nIGhlbHBlci4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFN0YXRpY0lu\naXRpYWxpemVyKCkgewogICAgICAgIENvZGUgY29kZSA9IGdldE9yQ3JlYXRl\nQ2xhc3NJbml0Q29kZSh0cnVlKTsKICAgICAgICBpZiAoX21ldGEuZ2V0UENT\ndXBlcmNsYXNzKCkgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoZ2V0Q3Jl\nYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldFZhbHVlKDApOwogICAgICAgICAgICAgICAgY29kZS5wdXRzdGF0\naWMoKS5zZXRGaWVsZChJTkhFUklULCBpbnQuY2xhc3MpOwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gcGNJbmhlcml0ZWRGaWVs\nZENvdW50ID0gPHN1cGVyQ2xhc3M+LnBjR2V0TWFuYWdlZEZpZWxkQ291bnQo\nKQogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRNZXRo\nb2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgICAgICBnZXRQQ1N1\ncGVyY2xhc3NNZXRhRGF0YSgpKS5nZXROYW1lKCksCiAgICAgICAgICAgICAg\nICAgICAgUFJFICsgIkdldE1hbmFnZWRGaWVsZENvdW50IiwgaW50LmNsYXNz\nLmdldE5hbWUoKSwgbnVsbCk7CiAgICAgICAgICAgICAgICBjb2RlLnB1dHN0\nYXRpYygpLnNldEZpZWxkKElOSEVSSVQsIGludC5jbGFzcyk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIHBjUENTdXBlcmNsYXNzID0gPHN1cGVy\nQ2xhc3M+OwogICAgICAgICAgICAvLyB0aGlzIGludGVudGlvbmFsbHkgY2Fs\nbHMgZ2V0RGVzY3JpYmVkVHlwZSgpIGRpcmVjdGx5CiAgICAgICAgICAgIC8v\nIGluc3RlYWQgb2YgUENFbmhhbmNlci5nZXRUeXBlKCkKICAgICAgICAgICAg\nY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoCiAgICAgICAgICAgICAg\nICBfbWV0YS5nZXRQQ1N1cGVyY2xhc3NNZXRhRGF0YSgpLmdldERlc2NyaWJl\nZFR5cGUoKSk7CiAgICAgICAgICAgIGNvZGUucHV0c3RhdGljKCkuc2V0Rmll\nbGQoU1VQRVIsIENsYXNzLmNsYXNzKTsKICAgICAgICB9CgogICAgICAgIC8v\nIHBjRmllbGROYW1lcyA9IG5ldyBTdHJpbmdbXSB7ICI8bmFtZTE+IiwgIjxu\nYW1lMj4iLCAuLi4gfTsKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9\nIF9tZXRhLmdldERlY2xhcmVkRmllbGRzKCk7CiAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldFZhbHVlKGZtZHMubGVuZ3RoKTsKICAgICAgICBjb2RlLmFu\nZXdhcnJheSgpLnNldFR5cGUoU3RyaW5nLmNsYXNzKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgY29kZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNl\ndFZhbHVlKGkpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFs\ndWUoZm1kc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAgICBjb2RlLmFhc3Rv\ncmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5zZXRG\naWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNzKTsKCiAg\nICAgICAgLy8gcGNGaWVsZFR5cGVzID0gbmV3IENsYXNzW10geyA8dHlwZTE+\nLmNsYXNzLCA8dHlwZTI+LmNsYXNzLCAuLi4gfTsKICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUu\nYW5ld2FycmF5KCkuc2V0VHlwZShDbGFzcy5jbGFzcyk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXRWYWx1ZShpKTsKICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCku\nc2V0Q2xhc3MoZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAg\nICAgIGNvZGUuYWFzdG9yZSgpOwogICAgICAgIH0KICAgICAgICBjb2RlLnB1\ndHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJGaWVsZFR5cGVzIiwgQ2xhc3Nb\nXS5jbGFzcyk7CgogICAgICAgIC8vIHBjRmllbGRGbGFncyA9IG5ldyBieXRl\nW10geyA8ZmxhZzE+LCA8ZmxhZzI+LCAuLi4gfTsKICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoZm1kcy5sZW5ndGgpOwogICAgICAgIGNvZGUu\nbmV3YXJyYXkoKS5zZXRUeXBlKGJ5dGUuY2xhc3MpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBjb2RlLmR1cCgpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0\nVmFsdWUoaSk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1\nZShnZXRGaWVsZEZsYWcoZm1kc1tpXSkpOwogICAgICAgICAgICBjb2RlLmJh\nc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgY29kZS5wdXRzdGF0aWMoKS5z\nZXRGaWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5jbGFzcyk7Cgog\nICAgICAgIC8vIFBDUmVnaXN0cnkucmVnaXN0ZXIgKGNscywKICAgICAgICAv\nLwlwY0ZpZWxkTmFtZXMsIHBjRmllbGRUeXBlcywgcGNGaWVsZEZsYWdzLAog\nICAgICAgIC8vICBwY1BDU3VwZXJjbGFzcywgYWxpYXMsIG5ldyBYWFggKCkp\nOwogICAgICAgIGNvZGUuY2xhc3Njb25zdGFudCgpLnNldENsYXNzKF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMo\nKS5zZXRGaWVsZChQUkUgKyAiRmllbGROYW1lcyIsIFN0cmluZ1tdLmNsYXNz\nKTsKICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBSRSArICJG\naWVsZFR5cGVzIiwgQ2xhc3NbXS5jbGFzcyk7CiAgICAgICAgY29kZS5nZXRz\ndGF0aWMoKS5zZXRGaWVsZChQUkUgKyAiRmllbGRGbGFncyIsIGJ5dGVbXS5j\nbGFzcyk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChTVVBF\nUiwgQ2xhc3MuY2xhc3MpOwogICAgICAgIAogICAgICAgIGlmIChfbWV0YS5p\nc01hcHBlZCgpIHx8IF9tZXRhLmlzQWJzdHJhY3QoKSkKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKF9tZXRhLmdldFR5cGVBbGlhcygp\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5z\nZXROdWxsKCk7CgogICAgICAgIGlmIChfcGMuaXNBYnN0cmFjdCgpKQogICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0TnVsbCgpOwogICAgICAgIGVs\nc2UgewogICAgICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9wYyk7CiAg\nICAgICAgICAgIGNvZGUuZHVwKCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\nc3BlY2lhbCgpLnNldE1ldGhvZCgiPGluaXQ+Iiwgdm9pZC5jbGFzcywgbnVs\nbCk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChIRUxQRVJUWVBFLCAicmVnaXN0ZXIiLCB2b2lkLmNsYXNzLAog\nICAgICAgICAgICBuZXcgQ2xhc3NbXXsgQ2xhc3MuY2xhc3MsIFN0cmluZ1td\nLmNsYXNzLCBDbGFzc1tdLmNsYXNzLAogICAgICAgICAgICAgICAgYnl0ZVtd\nLmNsYXNzLCBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBQQ1RZUEUgfSk7\nCgogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgZmxhZyBmb3IgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBieXRlIGdldEZpZWxkRmxhZyhGaWVsZE1ldGFEYXRhIGZt\nZCkgewogICAgICAgIGlmIChmbWQuZ2V0TWFuYWdlbWVudCgpID09IEZpZWxk\nTWV0YURhdGEuTUFOQUdFX05PTkUpCiAgICAgICAgICAgIHJldHVybiAtMTsK\nCiAgICAgICAgYnl0ZSBmbGFncyA9IDA7CiAgICAgICAgaWYgKGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKS5pc1ByaW1pdGl2ZSgpCiAgICAgICAgICAgIHx8IFNl\ncmlhbGl6YWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKGZtZC5nZXREZWNs\nYXJlZFR5cGUoKSkpCiAgICAgICAgICAgIGZsYWdzID0gUGVyc2lzdGVuY2VD\nYXBhYmxlLlNFUklBTElaQUJMRTsKCiAgICAgICAgaWYgKGZtZC5nZXRNYW5h\nZ2VtZW50KCkgPT0gRmllbGRNZXRhRGF0YS5NQU5BR0VfVFJBTlNBQ1RJT05B\nTCkKICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNI\nRUNLX1dSSVRFOwogICAgICAgIGVsc2UgaWYgKCFmbWQuaXNQcmltYXJ5S2V5\nKCkgJiYgIWZtZC5pc0luRGVmYXVsdEZldGNoR3JvdXAoKSkKICAgICAgICAg\nICAgZmxhZ3MgfD0gUGVyc2lzdGVuY2VDYXBhYmxlLkNIRUNLX1dSSVRFCiAg\nICAgICAgICAgICAgICB8IFBlcnNpc3RlbmNlQ2FwYWJsZS5DSEVDS19SRUFE\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZmxhZ3MgfD0gUGVyc2lzdGVu\nY2VDYXBhYmxlLk1FRElBVEVfV1JJVEUKICAgICAgICAgICAgICAgIHwgUGVy\nc2lzdGVuY2VDYXBhYmxlLk1FRElBVEVfUkVBRDsKICAgICAgICByZXR1cm4g\nZmxhZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBjb2RlIHRv\nIHByb3Blcmx5IGhhbmRsZSBQZXJzaXN0ZW5jZUNhcGFibGUgc2VyaWFsaXph\ndGlvbgogICAgICogdG8gdGhlIGJ5dGVjb2RlLiBUaGlzIGluY2x1ZGVzIGNy\nZWF0aW5nIGFuZCBpbml0aWFsaXppbmcgdGhlCiAgICAgKiBzdGF0aWMgPGNv\nZGU+c2VyaWFsVmVyc2lvblVJRDwvY29kZT4gY29uc3RhbnQgaWYgbm90IGFs\ncmVhZHkgZGVmaW5lZCwKICAgICAqIGFzIHdlbGwgYXMgY3JlYXRpbmcgYSBj\ndXN0b20gPGNvZGU+d3JpdGVPYmplY3Q8L2NvZGU+IG1ldGhvZCBpZiB0aGUK\nICAgICAqIGNsYXNzIGlzIFNlcmlhbGl6YWJsZSBhbmQgZG9lcyBub3QgZGVm\naW5lIHRoZW0uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXJpYWxp\nemF0aW9uQ29kZSgpIHsKICAgICAgICBpZiAoZXh0ZXJuYWxpemVEZXRhY2hl\nZCgpCiAgICAgICAgICAgIHx8ICFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAg\nICAgICByZXR1cm47CgogICAgICAgIGlmIChnZXRDcmVhdGVTdWJjbGFzcygp\nKSB7CiAgICAgICAgICAgIC8vICMjIyMjIHdoYXQgc2hvdWxkIGhhcHBlbiBp\nZiBhIHR5cGUgaXMgRXh0ZXJuYWxpemFibGU/IEl0IGxvb2tzCiAgICAgICAg\nICAgIC8vICMjIyMjIGxpa2UgRXh0ZXJuYWxpemFibGUgY2xhc3NlcyB3aWxs\nIG5vdCBiZSBzZXJpYWxpemVkIGFzIFBDcwogICAgICAgICAgICAvLyAjIyMj\nIyBiYXNlZCBvbiB0aGlzIGxvZ2ljLgogICAgICAgICAgICBpZiAoIUV4dGVy\nbmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oCiAgICAgICAgICAg\nICAgICBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAgICAgICAg\nICAgYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29kZSgpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBub3QgYWxyZWFk\neSBwcmVzZW50LCBhZGQgYSBzZXJpYWxWZXJzaW9uVUlEIGZpZWxkOyBpZiB0\naGUgaW5zdGFuY2UKICAgICAgICAvLyBpcyBkZXRhY2hhYmxlIGFuZCB1c2Vz\nIGRldGFjaGVkIHN0YXRlIHdpdGhvdXQgYSBkZWNsYXJlZCBmaWVsZCwKICAg\nICAgICAvLyBjYW4ndCBhZGQgYSBzZXJpYWwgdmVyc2lvbiBVSUQgYmVjYXVz\nZSB3ZSdsbCBiZSBhZGRpbmcgZXh0cmEgZmllbGRzCiAgICAgICAgLy8gdG8g\ndGhlIGVuaGFuY2VkIHZlcnNpb24KICAgICAgICBCQ0ZpZWxkIGZpZWxkID0g\nX3BjLmdldERlY2xhcmVkRmllbGQoInNlcmlhbFZlcnNpb25VSUQiKTsKICAg\nICAgICBpZiAoZmllbGQgPT0gbnVsbCkgewogICAgICAgICAgICBMb25nIHVp\nZCA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB1\naWQgPSBPYmplY3RTdHJlYW1DbGFzcy5sb29rdXAKICAgICAgICAgICAgICAg\nICAgICAoX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKS5nZXRTZXJpYWxWZXJz\naW9uVUlEKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0KSB7\nCiAgICAgICAgICAgICAgICAvLyBsYXN0LWNoYW5jZSBjYXRjaCBmb3IgYnVn\nICMyODMgKHdoaWNoIGNhbiBoYXBwZW4KICAgICAgICAgICAgICAgIC8vIGlu\nIGEgdmFyaWV0eSBvZiBDbGFzc0xvYWRpbmcgZW52aXJvbm1lbnRzKQogICAg\nICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAg\nICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5nZXQoImVuaGFuY2UtdWlk\nLWFjY2VzcyIsIF9tZXRhKSwgdCk7CiAgICAgICAgICAgICAgICBlbHNlCiAg\nICAgICAgICAgICAgICAgICAgX2xvZy53YXJuKF9sb2MuZ2V0KCJlbmhhbmNl\nLXVpZC1hY2Nlc3MiLCBfbWV0YSkpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBhY2Nlc3MgdGhlIHNlcmlhbFZlcnNp\nb25VSUQsIHdlIHdpbGwgaGF2ZSB0bwogICAgICAgICAgICAvLyBza2lwIHRo\nZSBvdmVycmlkZSBvZiB0aGF0IGZpZWxkIGFuZCBub3QgYmUgc2VyaWFsaXph\ndGlvbgogICAgICAgICAgICAvLyBjb21wYXRpYmxlIHdpdGggbm9uLWVuaGFu\nY2VkIGNsYXNzZXMKICAgICAgICAgICAgaWYgKHVpZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQoInNlcmlh\nbFZlcnNpb25VSUQiLCBsb25nLmNsYXNzKTsKICAgICAgICAgICAgICAgIGZp\nZWxkLm1ha2VQcml2YXRlKCk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRT\ndGF0aWModHJ1ZSk7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRGaW5hbCh0\ncnVlKTsKCiAgICAgICAgICAgICAgICBDb2RlIGNvZGUgPSBnZXRPckNyZWF0\nZUNsYXNzSW5pdENvZGUoZmFsc2UpOwogICAgICAgICAgICAgICAgY29kZS5i\nZWZvcmVGaXJzdCgpOwogICAgICAgICAgICAgICAgY29kZS5jb25zdGFudCgp\nLnNldFZhbHVlKHVpZC5sb25nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBj\nb2RlLnB1dHN0YXRpYygpLnNldEZpZWxkKGZpZWxkKTsKCiAgICAgICAgICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIGFkZCB3cml0ZSBvYmplY3QgbWV0aG9k\nCiAgICAgICAgQkNNZXRob2Qgd3JpdGUgPSBfcGMuZ2V0RGVjbGFyZWRNZXRo\nb2QoIndyaXRlT2JqZWN0IiwKICAgICAgICAgICAgbmV3IENsYXNzW117IE9i\namVjdE91dHB1dFN0cmVhbS5jbGFzcyB9KTsKICAgICAgICBib29sZWFuIGZ1\nbGwgPSB3cml0ZSA9PSBudWxsOwogICAgICAgIGlmIChmdWxsKSB7CiAgICAg\nICAgICAgIC8vIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdCAoT2JqZWN0T3V0\ncHV0U3RyZWFtIG91dCkKICAgICAgICAgICAgd3JpdGUgPSBfcGMuZGVjbGFy\nZU1ldGhvZCgid3JpdGVPYmplY3QiLCB2b2lkLmNsYXNzLAogICAgICAgICAg\nICAgICAgbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9\nKTsKICAgICAgICAgICAgd3JpdGUuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRF\neGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICB3cml0\nZS5tYWtlUHJpdmF0ZSgpOwogICAgICAgIH0KICAgICAgICBtb2RpZnlXcml0\nZU9iamVjdE1ldGhvZCh3cml0ZSwgZnVsbCk7CgogICAgICAgIC8vIGFuZCBy\nZWFkIG9iamVjdAogICAgICAgIEJDTWV0aG9kIHJlYWQgPSBfcGMuZ2V0RGVj\nbGFyZWRNZXRob2QoInJlYWRPYmplY3QiLAogICAgICAgICAgICBuZXcgQ2xh\nc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAgICAgZnVs\nbCA9IHJlYWQgPT0gbnVsbDsKICAgICAgICBpZiAoZnVsbCkgewogICAgICAg\nICAgICAvLyBwcml2YXRlIHZvaWQgcmVhZE9iamVjdCAoT2JqZWN0SW5wdXRT\ndHJlYW0gaW4pCiAgICAgICAgICAgIHJlYWQgPSBfcGMuZGVjbGFyZU1ldGhv\nZCgicmVhZE9iamVjdCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAgICAgICBu\nZXcgQ2xhc3NbXXsgT2JqZWN0SW5wdXRTdHJlYW0uY2xhc3MgfSk7CiAgICAg\nICAgICAgIHJlYWQuZ2V0RXhjZXB0aW9ucyh0cnVlKS5hZGRFeGNlcHRpb24o\nSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgICAgICByZWFkLmdldEV4Y2Vw\ndGlvbnModHJ1ZSkuYWRkRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAoQ2xh\nc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAgICAgIHJlYWQu\nbWFrZVByaXZhdGUoKTsKICAgICAgICB9CiAgICAgICAgbW9kaWZ5UmVhZE9i\namVjdE1ldGhvZChyZWFkLCBmdWxsKTsKICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgYWRkU3ViY2xhc3NTZXJpYWxpemF0aW9uQ29kZSgpIHsKICAgICAgICAv\nLyBmb3IgZ2VuZXJhdGVkIHN1YmNsYXNzZXMsIHNlcmlhbGl6YXRpb24gbXVz\ndCB3cml0ZSBhbiBpbnN0YW5jZSBvZgogICAgICAgIC8vIHRoZSBzdXBlcmNs\nYXNzIGluc3RlYWQgb2YgdGhlIHN1YmNsYXNzLCBzbyB0aGF0IHRoZSBjbGll\nbnQgVk0gY2FuCiAgICAgICAgLy8gZGVzZXJpYWxpemUgc3VjY2Vzc2Z1bGx5\nLgoKICAgICAgICAvLyBwcml2YXRlIE9iamVjdCB3cml0ZVJlcGxhY2UoKSB0\naHJvd3MgT2JqZWN0U3RyZWFtRXhjZXB0aW9uCiAgICAgICAgQkNNZXRob2Qg\nbWV0aG9kID0gX3BjLmRlY2xhcmVNZXRob2QoIndyaXRlUmVwbGFjZSIsIE9i\namVjdC5jbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLmdldEV4Y2VwdGlv\nbnModHJ1ZSkuYWRkRXhjZXB0aW9uKE9iamVjdFN0cmVhbUV4Y2VwdGlvbi5j\nbGFzcyk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1\nZSk7CgogICAgICAgIC8vIE9iamVjdCBvID0gbmV3IDxtYW5hZ2VkLXR5cGU+\nKCkKICAgICAgICBjb2RlLmFuZXcoKS5zZXRUeXBlKF9tYW5hZ2VkVHlwZSk7\nIC8vIGZvciByZXR1cm4KICAgICAgICBjb2RlLmR1cCgpOyAvLyBmb3IgcG9z\ndC08aW5pdD4gd29yawogICAgICAgIGNvZGUuZHVwKCk7IC8vIGZvciA8aW5p\ndD4KICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2QoX21h\nbmFnZWRUeXBlLmdldFR5cGUoKSwgIjxpbml0PiIsCiAgICAgICAgICAgIHZv\naWQuY2xhc3MsIG51bGwpOwoKICAgICAgICAvLyBjb3B5IGFsbCB0aGUgZmll\nbGRzLgogICAgICAgIC8vICMjIyMjIGxpbWl0aW5nIHRvIEpQQSBAVHJhbnNp\nZW50IGxpbWl0YXRpb25zCiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMg\nPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZtZHNb\naV0uaXNUcmFuc2llbnQoKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAvLyBvLjxmaWVsZD4gPSB0aGlzLjxmaWVsZD4gKG9yIHJl\nZmxlY3RpdmUgYW5hbG9nKQogICAgICAgICAgICBjb2RlLmR1cCgpOyAvLyBm\nb3IgcHV0ZmllbGQKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMo\nKTsgLy8gZm9yIGdldGZpZWxkCiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUs\nIF9tYW5hZ2VkVHlwZSwgZm1kc1tpXS5nZXROYW1lKCkpOwogICAgICAgICAg\nICBwdXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUsIGZtZHNbaV0uZ2V0TmFt\nZSgpLAogICAgICAgICAgICAgICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUo\nKSk7CiAgICAgICAgfQoKICAgICAgICBjb2RlLmFyZXR1cm4oKS5zZXRUeXBl\nKE9iamVjdC5jbGFzcyk7CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9j\nYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAg\nfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgY2xhc3MgYmVpbmcgZW5o\nYW5jZWQgc2hvdWxkIGV4dGVybmFsaXplIHRvIGEgZGV0YWNoZWQKICAgICAq\nIGluc3RhbmNlIHJhdGhlciB0aGFuIHNlcmlhbGl6ZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGV4dGVybmFsaXplRGV0YWNoZWQoKSB7CiAgICAg\nICAgcmV0dXJuIENsYXNzTWV0YURhdGEuU1lOVEhFVElDLmVxdWFscyhfbWV0\nYS5nZXREZXRhY2hlZFN0YXRlKCkpCiAgICAgICAgICAgICYmIFNlcmlhbGl6\nYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSkKICAgICAgICAgICAgJiYgIV9yZXBvcy5nZXRDb25maWd1cmF0\naW9uKCkuZ2V0RGV0YWNoU3RhdGVJbnN0YW5jZSgpLgogICAgICAgICAgICBp\nc0RldGFjaGVkU3RhdGVUcmFuc2llbnQoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgYSBjdXN0b20gd3JpdGVPYmplY3QgbWV0aG9kIHRoYXQgZGVs\nZWdhdGVzIHRvIHRoZQogICAgICoge0BsaW5rIE9iamVjdE91dHB1dFN0cmVh\nbSNkZWZhdWx0V3JpdGVPYmplY3R9IG1ldGhvZCwKICAgICAqIGJ1dCBvbmx5\nIGFmdGVyIGNhbGxpbmcgdGhlIGludGVybmFsIDxjb2RlPnBjU2VyaWFsaXpp\nbmc8L2NvZGU+IG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIG1v\nZGlmeVdyaXRlT2JqZWN0TWV0aG9kKEJDTWV0aG9kIG1ldGhvZCwgYm9vbGVh\nbiBmdWxsKSB7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgY29kZS5iZWZvcmVGaXJzdCgpOwoKICAgICAgICAv\nLyBib29sIGNsZWFyID0gcGNTZXJpYWxpemluZyAoKTsKICAgICAgICBsb2Fk\nTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNlcmlhbGl6aW5nIiwK\nICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbnVsbCk7CiAgICAgICAgaW50\nIGNsZWFyID0gY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICBj\nb2RlLmlzdG9yZSgpLnNldExvY2FsKGNsZWFyKTsKCiAgICAgICAgaWYgKGZ1\nbGwpIHsKICAgICAgICAgICAgLy8gb3V0LmRlZmF1bHRXcml0ZU9iamVjdCAo\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoT2JqZWN0\nT3V0cHV0U3RyZWFtLmNsYXNzLAogICAgICAgICAgICAgICAgImRlZmF1bHRX\ncml0ZU9iamVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBj\nb2RlLnZyZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIEluc3RydWN0aW9u\nIHRtcGxhdGUgPSAoQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAg\nICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0NvZGVBY3Rpb24oKSkpLnZy\nZXR1cm4oKTsKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gdG9yZXQ7CiAgICAg\nICAgSW5zdHJ1Y3Rpb24gcmV0OwogICAgICAgIGNvZGUuYmVmb3JlRmlyc3Qo\nKTsKICAgICAgICB3aGlsZSAoY29kZS5zZWFyY2hGb3J3YXJkKHRtcGxhdGUp\nKSB7CiAgICAgICAgICAgIHJldCA9IGNvZGUucHJldmlvdXMoKTsKICAgICAg\nICAgICAgLy8gaWYgKGNsZWFyKSBwY1NldERldGFjaGVkU3RhdGUgKG51bGwp\nOwogICAgICAgICAgICBjb2RlLmlsb2FkKCkuc2V0TG9jYWwoY2xlYXIpOwog\nICAgICAgICAgICB0b3JldCA9IGNvZGUuaWZlcSgpOwogICAgICAgICAgICBs\nb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldE51bGwoKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArICJTZXREZXRhY2hlZFN0\nYXRlIiwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1td\neyBPYmplY3QuY2xhc3MgfSk7CiAgICAgICAgICAgIHRvcmV0LnNldFRhcmdl\ndChyZXQpOwogICAgICAgICAgICBjb2RlLm5leHQoKTsgLy8ganVtcCBvdmVy\nIHJldHVybgogICAgICAgIH0KICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBjdXN0b20gcmVhZE9iamVjdCBt\nZXRob2QgdGhhdCBkZWxlZ2F0ZXMgdG8gdGhlCiAgICAgKiB7QGxpbmsgT2Jq\nZWN0SW5wdXRTdHJlYW0jcmVhZE9iamVjdH0gbWV0aG9kLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgbW9kaWZ5UmVhZE9iamVjdE1ldGhvZChCQ01ldGhv\nZCBtZXRob2QsIGJvb2xlYW4gZnVsbCkgewogICAgICAgIENvZGUgY29kZSA9\nIG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuYmVmb3JlRmly\nc3QoKTsKCiAgICAgICAgLy8gaWYgdGhpcyBpbnN0YW5jZSB1c2VzIHN5bnRo\nZXRpYyBkZXRhY2hlZCBzdGF0ZSwgbm90ZSB0aGF0IGl0IGhhcwogICAgICAg\nIC8vIGJlZW4gZGVzZXJpYWxpemVkCiAgICAgICAgaWYgKENsYXNzTWV0YURh\ndGEuU1lOVEhFVElDLmVxdWFscyhfbWV0YS5nZXREZXRhY2hlZFN0YXRlKCkp\nKSB7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKFBl\ncnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAgICAgICAgICAgICJERVNF\nUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmlu\ndm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3Rh\ndGUiLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChmdWxs\nKSB7CiAgICAgICAgICAgIC8vIGluLmRlZmF1bHRSZWFkT2JqZWN0ICgpOwog\nICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAg\nICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhvZChPYmplY3RJbnB1\ndFN0cmVhbS5jbGFzcywKICAgICAgICAgICAgICAgICJkZWZhdWx0UmVhZE9i\namVjdCIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLnZy\nZXR1cm4oKTsKICAgICAgICB9CgogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyB0aGUgcGNJc0RldGFjaGVk\nKCkgbWV0aG9kIHRvIGRldGVybWluZSBpZiBhbiBpbnN0YW5jZQogICAgICog\naXMgZGV0YWNoZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRJc0Rl\ndGFjaGVkTWV0aG9kKCkKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBwdWJsaWMgYm9vbGVhbiBwY0lzRGV0YWNo\nZWQoKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0\naG9kKFBSRSArICJJc0RldGFjaGVkIiwKICAgICAgICAgICAgQm9vbGVhbi5j\nbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAg\nICAgICBDb2RlIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAg\nICBib29sZWFuIG5lZWRzRGVmaW5pdGl2ZU1ldGhvZCA9IHdyaXRlSXNEZXRh\nY2hlZE1ldGhvZChjb2RlKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0\nYWNrKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAg\nICAgICBpZiAoIW5lZWRzRGVmaW5pdGl2ZU1ldGhvZCkgCiAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgLy8gcHJpdmF0ZSBib29sZWFuIHBjSXNEZXRh\nY2hlZFN0YXRlRGVmaW5pdGl2ZSgpCiAgICAgICAgLy8gICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgLy8gYXV4aWxsaWFyeSBlbmhhbmNlcnMgbWF5IGNoYW5n\nZSB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoaXMgbWV0aG9kCiAgICAgICAgLy8g\naWYgdGhlaXIgc3BlY3MgY29uc2lkZXIgZGV0YWNoZWQgc3RhdGUgZGVmaW5p\ndGl2ZQogICAgICAgIG1ldGhvZCA9IF9wYy5kZWNsYXJlTWV0aG9kKElTREVU\nQUNIRURTVEFURURFRklOSVRJVkUsIGJvb2xlYW4uY2xhc3MsCiAgICAgICAg\nICAgIG51bGwpOwogICAgICAgIG1ldGhvZC5tYWtlUHJpdmF0ZSgpOwogICAg\nICAgIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUoZmFsc2UpOwogICAgICAgIGNvZGUuaXJl\ndHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAg\nICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlcyB0aGUgYm9keSBvZiB0aGUgcGNJc0RldGFjaGVk\nKCkgbWV0aG9kIHRvIGRldGVybWluZSBpZiBhbgogICAgICogaW5zdGFuY2Ug\naXMgZGV0YWNoZWQuCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIHdl\nIG5lZWQgYSBwY0lzRGV0YWNoZWRTdGF0ZURlZmluaXRpdmUgbWV0aG9kLCBm\nYWxzZQogICAgICogb3RoZXJ3aXNlCiAgICAgKi8KICAgIHByaXZhdGUgYm9v\nbGVhbiB3cml0ZUlzRGV0YWNoZWRNZXRob2QoQ29kZSBjb2RlKQogICAgICAg\nIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIG5v\ndCBkZXRhY2hhYmxlOiByZXR1cm4gQm9vbGVhbi5GQUxTRQogICAgICAgIGlm\nICghX21ldGEuaXNEZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiRkFMU0UiLCBC\nb29sZWFuLmNsYXNzKTsKICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8v\nIGlmIChzbSAhPSBudWxsKQogICAgICAgIC8vICAgICByZXR1cm4gKHNtLmlz\nRGV0YWNoZWQgKCkpID8gQm9vbGVhbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zID0gY29kZS5pZm51bGwoKTsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNlKTsKICAg\nICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQoU00sIFNNVFlQRSk7CiAg\nICAgICAgY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoU01UWVBF\nLCAiaXNEZXRhY2hlZCIsCiAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG51\nbGwpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmZhbHNlID0gY29kZS5p\nZmVxKCk7CiAgICAgICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29s\nZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgIGNv\nZGUuYXJldHVybigpOwogICAgICAgIGlmZmFsc2Uuc2V0VGFyZ2V0KGNvZGUu\nZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwK\nICAgICAgICAgICAgQm9vbGVhbi5jbGFzcykpOwogICAgICAgIGNvZGUuYXJl\ndHVybigpOwoKICAgICAgICAvLyBpZiB3ZSB1c2UgZGV0YWNoZWQgc3RhdGU6\nCiAgICAgICAgLy8gaWYgKHBjR2V0RGV0YWNoZWRTdGF0ZSAoKSAhPSBudWxs\nCiAgICAgICAgLy8gICAgICYmIHBjR2V0RGV0YWNoZWRTdGF0ZSAhPSBERVNF\nUklBTElaRUQpCiAgICAgICAgLy8gICAgIHJldHVybiBCb29sZWFuLlRSVUU7\nCiAgICAgICAgQm9vbGVhbiBzdGF0ZSA9IF9tZXRhLnVzZXNEZXRhY2hlZFN0\nYXRlKCk7CiAgICAgICAgSnVtcEluc3RydWN0aW9uIG5vdGRlc2VyID0gbnVs\nbDsKICAgICAgICBJbnN0cnVjdGlvbiB0YXJnZXQ7CiAgICAgICAgaWYgKHN0\nYXRlICE9IEJvb2xlYW4uRkFMU0UpIHsKICAgICAgICAgICAgaWZpbnMuc2V0\nVGFyZ2V0KGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpKTsKICAg\nICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSAr\nICJHZXREZXRhY2hlZFN0YXRlIiwKICAgICAgICAgICAgICAgIE9iamVjdC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGlmaW5zID0gY29kZS5pZm51bGwo\nKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxz\nZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgpLnNldE1ldGhv\nZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgICAgICBP\nYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZS5jbGFzcywKICAgICAg\nICAgICAgICAgICJERVNFUklBTElaRUQiLCBPYmplY3QuY2xhc3MpOwogICAg\nICAgICAgICBub3RkZXNlciA9IGNvZGUuaWZhY21wZXEoKTsKICAgICAgICAg\nICAgY29kZS5nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAi\nVFJVRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1\ncm4oKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBCb29sZWFuLlRSVUUp\nIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgdG8gdXNlIGRldGFj\naGVkIHN0YXRlOgogICAgICAgICAgICAgICAgLy8gcmV0dXJuIEJvb2xlYW4u\nRkFMU0U7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSBjb2RlLmdldHN0YXRp\nYygpLnNldEZpZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsCiAgICAgICAg\nICAgICAgICAgICAgQm9vbGVhbi5jbGFzcyk7CiAgICAgICAgICAgICAgICBp\nZmlucy5zZXRUYXJnZXQodGFyZ2V0KTsKICAgICAgICAgICAgICAgIG5vdGRl\nc2VyLnNldFRhcmdldCh0YXJnZXQpOwogICAgICAgICAgICAgICAgY29kZS5h\ncmV0dXJuKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBhcnRpZmlj\naWFsIHRhcmdldCB0byBzaW1wbGlmeQogICAgICAgIHRhcmdldCA9IGNvZGUu\nbm9wKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAg\nICAgaWYgKG5vdGRlc2VyICE9IG51bGwpCiAgICAgICAgICAgIG5vdGRlc2Vy\nLnNldFRhcmdldCh0YXJnZXQpOwoKICAgICAgICAvLyBhbGxvdyB1c2VycyB3\naXRoIHZlcnNpb24gb3IgYXV0by1hc3NpZ25lZCBwayBmaWVsZHMgdG8gbWFu\ndWFsbHkgCiAgICAgICAgLy8gY29uc3RydWN0IGEgImRldGFjaGVkIiBpbnN0\nYW5jZSwgc28gY2hlY2sgdGhlc2UgYmVmb3JlIHRha2luZyBpbnRvIAogICAg\nICAgIC8vIGFjY291bnQgbm9uLWV4aXN0ZW50IGRldGFjaGVkIHN0YXRlCgog\nICAgICAgIC8vIGNvbnNpZGVyIGRldGFjaGVkIGlmIHZlcnNpb24gaXMgbm9u\nLWRlZmF1bHQKICAgICAgICBGaWVsZE1ldGFEYXRhIHZlcnNpb24gPSBfbWV0\nYS5nZXRWZXJzaW9uRmllbGQoKTsKICAgICAgICBpZiAoc3RhdGUgIT0gQm9v\nbGVhbi5UUlVFICYmIHZlcnNpb24gIT0gbnVsbCkgewogICAgICAgICAgICAv\nLyBpZiAoPHZlcnNpb24+ICE9IDxkZWZhdWx0PikKICAgICAgICAgICAgLy8J\nCXJldHVybiB0cnVlOwogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdlZFZhbHVl\nQ29kZShjb2RlLCB2ZXJzaW9uKTsKICAgICAgICAgICAgaWZpbnMgPSBpZkRl\nZmF1bHRWYWx1ZShjb2RlLCB2ZXJzaW9uKTsKICAgICAgICAgICAgY29kZS5n\nZXRzdGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJv\nb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICAgICAgaWYgKCFfYWRkVmVyc2lvbkluaXRGbGFnKXsKICAgICAgICAg\nICAgICAgIC8vIGVsc2UgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\naWZpbnMuc2V0VGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9v\nbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcykpOwogICAgICAg\nICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgdmVy\nc2lvbkluaXQgPSBfbWV0YS5nZXREZWNsYXJlZEZpZWxkKFZFUlNJT05fSU5J\nVF9TVFIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBu\nb29wCiAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3Ao\nKSk7CiAgICAgICAgICAgICAgICAvLyBpZiAocGNWZXJzaW9uSW5pdCAhPSBm\nYWxzZSkKICAgICAgICAgICAgICAgIC8vIHJldHVybiB0cnVlCiAgICAgICAg\nICAgICAgICAvLyBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAg\nICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgdmVyc2lvbkluaXQuZ2V0TmFt\nZSgpKTsKICAgICAgICAgICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFsdWUo\nY29kZSwgdmVyc2lvbkluaXQpOwogICAgICAgICAgICAgICAgY29kZS5nZXRz\ndGF0aWMoKS5zZXRGaWVsZChCb29sZWFuLmNsYXNzLCAiVFJVRSIsIEJvb2xl\nYW4uY2xhc3MpOwogICAgICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAg\nICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQoY29kZS5ub3AoKSk7CiAg\nICAgICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xl\nYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAg\nICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29kZS5hcmV0dXJu\nKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIC8vIGNvbnNpZGVyIGRldGFjaGVkIGlmIGF1dG8tZ2VubmVkIHByaW1h\ncnkga2V5cyBhcmUgbm9uLWRlZmF1bHQKICAgICAgICBpZmlucyA9IG51bGw7\nCiAgICAgICAgSnVtcEluc3RydWN0aW9uIGlmaW5zMiA9IG51bGw7CiAgICAg\nICAgYm9vbGVhbiBoYXNBdXRvQXNzaWduZWRQSyA9IGZhbHNlOwogICAgICAg\nIGlmIChzdGF0ZSAhPSBCb29sZWFuLlRSVUUKICAgICAgICAgICAgJiYgX21l\ndGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBM\nSUNBVElPTikgewogICAgICAgICAgICAvLyBmb3IgZWFjaCBwayBmaWVsZDoK\nICAgICAgICAgICAgLy8gaWYgKDxwaz4gIT0gPGRlZmF1bHQ+IFsmJiAhIiIu\nZXF1YWxzICg8cGs+KV0pCiAgICAgICAgICAgIC8vCQlyZXR1cm4gQm9vbGVh\nbi5UUlVFOwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gcGtzID0gX21l\ndGEuZ2V0UHJpbWFyeUtleUZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IHBrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgaWYgKHBrc1tpXS5nZXRWYWx1ZVN0cmF0ZWd5KCkgPT0gVmFsdWVTdHJh\ndGVnaWVzLk5PTkUpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cgog\nICAgICAgICAgICAgICAgdGFyZ2V0ID0gbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoaWZpbnMgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBpZmlucy5zZXRUYXJnZXQodGFyZ2V0\nKTsKICAgICAgICAgICAgICAgIGlmIChpZmluczIgIT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICBpZmluczIuc2V0VGFyZ2V0KHRhcmdldCk7CiAgICAg\nICAgICAgICAgICBpZmluczIgPSBudWxsOwoKICAgICAgICAgICAgICAgIGFk\nZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwgcGtzW2ldKTsKICAgICAgICAg\nICAgICAgIGlmaW5zID0gaWZEZWZhdWx0VmFsdWUoY29kZSwgcGtzW2ldKTsK\nICAgICAgICAgICAgICAgIGlmIChwa3NbaV0uZ2V0RGVjbGFyZWRUeXBlQ29k\nZSgpID09IEphdmFUeXBlcy5TVFJJTkcpIHsKICAgICAgICAgICAgICAgICAg\nICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoIiIpOwogICAgICAgICAgICAg\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNvZGUoY29kZSwg\ncGtzW2ldKTsKICAgICAgICAgICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1\nYWwoKS5zZXRNZXRob2QoU3RyaW5nLmNsYXNzLCAiZXF1YWxzIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgYm9vbGVhbi5jbGFzcywgbmV3IENsYXNzW117\nIE9iamVjdC5jbGFzcyB9KTsKICAgICAgICAgICAgICAgICAgICBpZmluczIg\nPSBjb2RlLmlmbmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0RmllbGQoQm9vbGVhbi5jbGFzcywg\nIlRSVUUiLAogICAgICAgICAgICAgICAgICAgIEJvb2xlYW4uY2xhc3MpOwog\nICAgICAgICAgICAgICAgY29kZS5hcmV0dXJuKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8vIGNyZWF0ZSBhcnRpZmljaWFsIHRhcmdl\ndCB0byBzaW1wbGlmeQogICAgICAgIHRhcmdldCA9IGNvZGUubm9wKCk7CiAg\nICAgICAgaWYgKGlmaW5zICE9IG51bGwpCiAgICAgICAgICAgIGlmaW5zLnNl\ndFRhcmdldCh0YXJnZXQpOwogICAgICAgIGlmIChpZmluczIgIT0gbnVsbCkK\nICAgICAgICAgICAgaWZpbnMyLnNldFRhcmdldCh0YXJnZXQpOwoKICAgICAg\nICAvLyBpZiBoYXMgYXV0by1hc3NpZ25lZCBwayBhbmQgd2UgZ2V0IHRvIHRo\naXMgcG9pbnQsIG11c3QgaGF2ZSBkZWZhdWx0CiAgICAgICAgLy8gdmFsdWUs\nIHNvIG11c3QgYmUgbmV3IGluc3RhbmNlCiAgICAgICAgaWYgKGhhc0F1dG9B\nc3NpZ25lZFBLKSB7CiAgICAgICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoQm9vbGVhbi5jbGFzcywgIkZBTFNFIiwgQm9vbGVhbi5jbGFzcyk7\nCiAgICAgICAgICAgIGNvZGUuYXJldHVybigpOwogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBkZXRhY2hlZCBz\ndGF0ZSBpcyBub3QgZGVmaW5pdGl2ZSwganVzdCBnaXZlIHVwIG5vdyBhbmQg\ncmV0dXJuCiAgICAgICAgLy8gbnVsbCBzbyB0aGF0IHRoZSBydW50aW1lIHdp\nbGwgcGVyZm9ybSBhIERCIGxvb2t1cCB0byBkZXRlcm1pbmUKICAgICAgICAv\nLyB3aGV0aGVyIHdlJ3JlIGRldGFjaGVkIG9yIG5ldwogICAgICAgIGNvZGUu\nYWxvYWQoKS5zZXRUaGlzKCk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFs\nKCkuc2V0TWV0aG9kKElTREVUQUNIRURTVEFURURFRklOSVRJVkUsIGJvb2xl\nYW4uY2xhc3MsCiAgICAgICAgICAgIG51bGwpOwogICAgICAgIGlmaW5zID0g\nY29kZS5pZm5lKCk7CiAgICAgICAgY29kZS5jb25zdGFudCgpLnNldE51bGwo\nKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICBpZmlucy5zZXRU\nYXJnZXQoY29kZS5ub3AoKSk7CgogICAgICAgIC8vIG5vIGRldGFjaGVkIHN0\nYXRlOiBpZiBpbnN0YW5jZSB1c2VzIGRldGFjaGVkIHN0YXRlIGFuZCBpdCdz\nIG5vdAogICAgICAgIC8vIHN5bnRoZXRpYyBvciB0aGUgaW5zdGFuY2UgaXMg\nbm90IHNlcmlhbGl6YWJsZSBvciB0aGUgc3RhdGUgaXNuJ3QKICAgICAgICAv\nLyB0cmFuc2llbnQsIG11c3Qgbm90IGJlIGRldGFjaGVkCiAgICAgICAgaWYg\nKHN0YXRlID09IG51bGwKICAgICAgICAgICAgJiYgKCFDbGFzc01ldGFEYXRh\nLlNZTlRIRVRJQy5lcXVhbHMoX21ldGEuZ2V0RGV0YWNoZWRTdGF0ZSgpKQog\nICAgICAgICAgICB8fCAhU2VyaWFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJs\nZUZyb20oX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKQogICAgICAgICAgICB8\nfCAhX3JlcG9zLmdldENvbmZpZ3VyYXRpb24oKS5nZXREZXRhY2hTdGF0ZUlu\nc3RhbmNlKCkuCiAgICAgICAgICAgIGlzRGV0YWNoZWRTdGF0ZVRyYW5zaWVu\ndCgpKSkgewogICAgICAgICAgICAvLyByZXR1cm4gQm9vbGVhbi5GQUxTRQog\nICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZpZWxkKEJvb2xlYW4u\nY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwogICAgICAgICAgICBj\nb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQoKICAgICAgICAvLyBubyBkZXRhY2hlZCBzdGF0ZTogaWYgaW5zdGFu\nY2UgdXNlcyBkZXRhY2hlZCBzdGF0ZSAoYW5kIG11c3QgYmUKICAgICAgICAv\nLyBzeW50aGV0aWMgYW5kIHRyYW5zaWVudCBpbiBzZXJpYWxpemFibGUgaW5z\ndGFuY2UgYXQgdGhpcyBwb2ludCksCiAgICAgICAgLy8gbm90IGRldGFjaGVk\nIGlmIHN0YXRlIG5vdCBzZXQgdG8gREVTRVJJQUxJWkVECiAgICAgICAgaWYg\nKHN0YXRlID09IG51bGwpIHsKICAgICAgICAgICAgLy8gaWYgKHBjR2V0RGV0\nYWNoZWRTdGF0ZSAoKSA9PSBudWxsKSAvLyBpbnN0ZWFkIG9mIERFU0VSSUFM\nSVpFRAogICAgICAgICAgICAvLyAgICAgcmV0dXJuIEJvb2xlYW4uRkFMU0U7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2Qo\nUFJFICsgIkdldERldGFjaGVkU3RhdGUiLAogICAgICAgICAgICAgICAgT2Jq\nZWN0LmNsYXNzLCBudWxsKTsKICAgICAgICAgICAgaWZpbnMgPSBjb2RlLmlm\nbm9ubnVsbCgpOwogICAgICAgICAgICBjb2RlLmdldHN0YXRpYygpLnNldEZp\nZWxkKEJvb2xlYW4uY2xhc3MsICJGQUxTRSIsIEJvb2xlYW4uY2xhc3MpOwog\nICAgICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAgICAgICAgaWZpbnMu\nc2V0VGFyZ2V0KGNvZGUubm9wKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nZ2l2ZSB1cDsgd2UganVzdCBkb24ndCBrbm93CiAgICAgICAgY29kZS5jb25z\ndGFudCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbXBh\ncmUgdGhlIGdpdmVuIGZpZWxkIHRvIGl0cyBKYXZhIGRlZmF1bHQsIHJldHVy\nbmluZyB0aGUKICAgICAqIGNvbXBhcmlzb24gaW5zdHJ1Y3Rpb24uIFRoZSBm\naWVsZCB2YWx1ZSB3aWxsIGFscmVhZHkgYmUgb24gdGhlIHN0YWNrLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBKdW1wSW5zdHJ1Y3Rpb24gaWZEZWZh\ndWx0VmFsdWUoQ29kZSBjb2RlLAogICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nKSB7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgp\nKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xFQU46CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkNIQVI6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAg\nICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIGNvZGUuY29uc3Rh\nbnQoKS5zZXRWYWx1ZSgwRCk7CiAgICAgICAgICAgICAgICBjb2RlLmRjbXBs\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29kZS5pZmVxKCk7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAgICAgICAgICAgICAg\nY29kZS5jb25zdGFudCgpLnNldFZhbHVlKDBGKTsKICAgICAgICAgICAgICAg\nIGNvZGUuZmNtcGwoKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb2RlLmlm\nZXEoKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwTCk7CiAgICAg\nICAgICAgICAgICBjb2RlLmxjbXAoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgIHJldHVybiBjb2RlLmlmbnVsbCgpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gZ2V0IHRoZSBjb2Rl\nIGZvciB0aGUgY2xhc3MgaW5pdGlhbGl6ZXIgbWV0aG9kLAogICAgICogY3Jl\nYXRpbmcgdGhlIG1ldGhvZCBpZiBpdCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0\nLgogICAgICovCiAgICBwcml2YXRlIENvZGUgZ2V0T3JDcmVhdGVDbGFzc0lu\naXRDb2RlKGJvb2xlYW4gcmVwbGFjZUxhc3QpIHsKICAgICAgICBCQ01ldGhv\nZCBjbGluaXQgPSBfcGMuZ2V0RGVjbGFyZWRNZXRob2QoIjxjbGluaXQ+Iik7\nCiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIGlmIChjbGluaXQgIT0gbnVs\nbCkgewogICAgICAgICAgICBjb2RlID0gY2xpbml0LmdldENvZGUodHJ1ZSk7\nCiAgICAgICAgICAgIGlmIChyZXBsYWNlTGFzdCkgewogICAgICAgICAgICAg\nICAgQ29kZSB0ZW1wbGF0ZSA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLm5ld0Nv\nZGVBY3Rpb24oKSk7CiAgICAgICAgICAgICAgICBjb2RlLnNlYXJjaEZvcndh\ncmQodGVtcGxhdGUudnJldHVybigpKTsKICAgICAgICAgICAgICAgIGNvZGUu\ncHJldmlvdXMoKTsKICAgICAgICAgICAgICAgIGNvZGUuc2V0KHRlbXBsYXRl\nLm5vcCgpKTsKICAgICAgICAgICAgICAgIGNvZGUubmV4dCgpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2RlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gYWRkIHN0YXRpYyBpbml0aWFsaXplciBtZXRob2QgaWYgbm9u\nIGV4aXN0cwogICAgICAgIGNsaW5pdCA9IF9wYy5kZWNsYXJlTWV0aG9kKCI8\nY2xpbml0PiIsIHZvaWQuY2xhc3MsIG51bGwpOwogICAgICAgIGNsaW5pdC5t\nYWtlUGFja2FnZSgpOwogICAgICAgIGNsaW5pdC5zZXRTdGF0aWModHJ1ZSk7\nCiAgICAgICAgY2xpbml0LnNldEZpbmFsKHRydWUpOwoKICAgICAgICBjb2Rl\nID0gY2xpbml0LmdldENvZGUodHJ1ZSk7CiAgICAgICAgaWYgKCFyZXBsYWNl\nTGFzdCkgewogICAgICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAgICAg\nICAgY29kZS5wcmV2aW91cygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nY29kZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYnl0ZWNvZGUgbW9k\naWZ5aW5nIHRoZSBjbG9uaW5nIGJlaGF2aW9yIG9mIHRoZSBjbGFzcyBiZWlu\nZwogICAgICogZW5oYW5jZWQgdG8gY29ycmVjdGx5IHJlcGxhY2UgdGhlIDxj\nb2RlPnBjU3RhdGVNYW5hZ2VyPC9jb2RlPiAKICAgICAqIGluc3RhbmNlIGZp\nZWxkcyBvZiBhbnkgY2xvbmUgY3JlYXRlZCB3aXRoIHRoZWlyIGRlZmF1bHQg\ndmFsdWVzLiAKICAgICAqIEFsc28sIGlmIHRoaXMgY2xhc3MgaXMgdGhlIGJh\nc2UgUEMgdHlwZSBhbmQgZG9lcyBub3QgZGVjbGFyZWQgCiAgICAgKiBhIGNs\nb25lIG1ldGhvZCwgb25lIHdpbGwgYmUgYWRkZWQuIEFsc28sIGlmIF9wYyBp\ncyBhIHN5bnRoZXRpYwogICAgICogc3ViY2xhc3MsIGNyZWF0ZSB0aGUgY2xv\nbmUoKSBtZXRob2QgdGhhdCBjbGVhcnMgdGhlIHN0YXRlIG1hbmFnZXIKICAg\nICAqIHRoYXQgbWF5IGhhdmUgYmVlbiBpbml0aWFsaXplZCBpbiBhIHN1cGVy\nJ3MgY2xvbmUoKSBtZXRob2QuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBh\nZGRDbG9uaW5nQ29kZSgpIHsKICAgICAgICBpZiAoX21ldGEuZ2V0UENTdXBl\ncmNsYXNzKCkgIT0gbnVsbCAmJiAhZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBhZGQgdGhlIGNsb25lIG1l\ndGhvZCBpZiBuZWNlc3NhcnkKICAgICAgICBCQ01ldGhvZCBjbG9uZSA9IF9w\nYy5nZXREZWNsYXJlZE1ldGhvZCgiY2xvbmUiLCAKICAgICAgICAgICAgKFN0\ncmluZ1tdKSBudWxsKTsKICAgICAgICBTdHJpbmcgc3VwZXJOYW1lID0gX21h\nbmFnZWRUeXBlLmdldFN1cGVyY2xhc3NOYW1lKCk7CiAgICAgICAgQ29kZSBj\nb2RlID0gbnVsbDsKICAgICAgICBpZiAoY2xvbmUgPT0gbnVsbCkgewogICAg\nICAgICAgICAvLyBhZGQgY2xvbmUgc3VwcG9ydCBmb3IgYmFzZSBjbGFzc2Vz\nCiAgICAgICAgICAgIC8vIHdoaWNoIGFsc28gaW1wbGVtZW50IGNsb25lYWJs\nZQogICAgICAgICAgICBib29sZWFuIGlzQ2xvbmVhYmxlID0gQ2xvbmVhYmxl\nLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oCiAgICAgICAgICAgICAgICBfbWFu\nYWdlZFR5cGUuZ2V0VHlwZSgpKTsKICAgICAgICAgICAgYm9vbGVhbiBleHRl\nbmRzT2JqZWN0ID0KICAgICAgICAgICAgICAgIHN1cGVyTmFtZS5lcXVhbHMo\nT2JqZWN0LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgICAgICAgIGlmICghaXND\nbG9uZWFibGUgfHwgKCFleHRlbmRzT2JqZWN0ICYmICFnZXRDcmVhdGVTdWJj\nbGFzcygpKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAg\nIGlmICghZ2V0Q3JlYXRlU3ViY2xhc3MoKSkKICAgICAgICAgICAgICAgIGlm\nIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAg\nX2xvZy50cmFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQo\nImVuaGFuY2UtY2xvbmVhYmxlIiwgX21hbmFnZWRUeXBlLmdldE5hbWUoKSkp\nOwoKICAgICAgICAgICAgLy8gYWRkIGNsb25lIG1ldGhvZAogICAgICAgICAg\nICAvLyBwcm90ZWN0ZWQgT2JqZWN0IGNsb25lICgpIHRocm93cyBDbG9uZU5v\ndFN1cHBvcnRlZEV4Y2VwdGlvbgogICAgICAgICAgICBjbG9uZSA9IF9wYy5k\nZWNsYXJlTWV0aG9kKCJjbG9uZSIsIE9iamVjdC5jbGFzcywgbnVsbCk7CiAg\nICAgICAgICAgIGlmICghc2V0VmlzaWJpbGl0eVRvU3VwZXJNZXRob2QoY2xv\nbmUpKQogICAgICAgICAgICAgICAgY2xvbmUubWFrZVByb3RlY3RlZCgpOwog\nICAgICAgICAgICBjbG9uZS5nZXRFeGNlcHRpb25zKHRydWUpLmFkZEV4Y2Vw\ndGlvbgogICAgICAgICAgICAgICAgKENsb25lTm90U3VwcG9ydGVkRXhjZXB0\naW9uLmNsYXNzKTsKICAgICAgICAgICAgY29kZSA9IGNsb25lLmdldENvZGUo\ndHJ1ZSk7CgogICAgICAgICAgICAvLyByZXR1cm4gc3VwZXIuY2xvbmUgKCk7\nCiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2Up\nOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qo\nc3VwZXJOYW1lLCAiY2xvbmUiLAogICAgICAgICAgICAgICAgT2JqZWN0LmNs\nYXNzLmdldE5hbWUoKSwgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGdldCB0aGUg\nY2xvbmUgbWV0aG9kIGNvZGUKICAgICAgICAgICAgY29kZSA9IGNsb25lLmdl\ndENvZGUoZmFsc2UpOwogICAgICAgICAgICBpZiAoY29kZSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\nY3JlYXRlIHRlbXBsYXRlIHN1cGVyLmNsb25lICgpIGluc3RydWN0aW9uIHRv\nIG1hdGNoIGFnYWluc3QKICAgICAgICBJbnN0cnVjdGlvbiB0ZW1wbGF0ZSA9\nIChBY2Nlc3NDb250cm9sbGVyLmRvUHJpdmlsZWdlZCgKICAgICAgICAgICAg\nSjJEb1ByaXZIZWxwZXIubmV3Q29kZUFjdGlvbigpKSkuaW52b2tlc3BlY2lh\nbCgpCiAgICAgICAgICAgIC5zZXRNZXRob2Qoc3VwZXJOYW1lLCAiY2xvbmUi\nLCBPYmplY3QuY2xhc3MuZ2V0TmFtZSgpLCBudWxsKTsKCiAgICAgICAgLy8g\nZmluZCBjYWxscyB0byB0aGUgdGVtcGxhdGUgaW5zdHJ1Y3Rpb247IG9uIG1h\ndGNoCiAgICAgICAgLy8gY2xvbmUgd2lsbCBiZSBvbiBzdGFjawogICAgICAg\nIGNvZGUuYmVmb3JlRmlyc3QoKTsKICAgICAgICBpZiAoY29kZS5zZWFyY2hG\nb3J3YXJkKHRlbXBsYXRlKSkgewogICAgICAgICAgICAvLyAoKDx0eXBlPikg\nY2xvbmUpLnBjU3RhdGVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgY29k\nZS5kdXAoKTsKICAgICAgICAgICAgY29kZS5jaGVja2Nhc3QoKS5zZXRUeXBl\nKF9wYyk7CiAgICAgICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXROdWxsKCk7\nCiAgICAgICAgICAgIGNvZGUucHV0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01U\nWVBFKTsKCiAgICAgICAgICAgIC8vIGlmIG1vZGlmaWVkLCBpbmNyZWFzZSBz\ndGFjawogICAgICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogR2V0cyB0aGUgYXV4aWxpYXJ5IGVu\naGFuY2VycyByZWdpc3RlcmVkIGFzIHtAbGluayBTZXJ2aWNlcyBzZXJ2aWNl\nc30uCiAgICAgKi8KICAgIHB1YmxpYyBBdXhpbGlhcnlFbmhhbmNlcltdIGdl\ndEF1eGlsaWFyeUVuaGFuY2VycygpIHsKCQlyZXR1cm4gX2F1eEVuaGFuY2Vy\nczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBbGxvdyBhbnkgcmVnaXN0\nZXJlZCBhdXhpbGlhcnkgY29kZSBnZW5lcmF0b3JzIHRvIHJ1bi4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHJ1bkF1eGlsaWFyeUVuaGFuY2VycygpIHsK\nICAgIAlmb3IgKGludCBpID0gMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3Ro\nOyBpKyspCiAgICAJCV9hdXhFbmhhbmNlcnNbaV0ucnVuKF9wYywgX21ldGEp\nOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdp\ndmVuIG1ldGhvZCBiZSBza2lwcGVkLgogICAgICogCiAgICAgKiBAcGFyYW0g\nbWV0aG9kIG1ldGhvZCB0byBiZSBza2lwcGVkIG9yIG5vdAogICAgICogQHJl\ndHVybiB0cnVlIGlmIGFueSBvZiB0aGUgYXV4aWxpYXJ5IGVuaGFuY2VycyBz\na2lwcyB0aGUgZ2l2ZW4gbWV0aG9kLAogICAgICogb3IgaWYgdGhlIG1ldGhv\nZCBpcyBhIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVh\nbiBza2lwRW5oYW5jZShCQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBpZiAo\nIjxpbml0PiIuZXF1YWxzKG1ldGhvZC5nZXROYW1lKCkpKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IF9hdXhFbmhhbmNlcnMubGVuZ3RoOyBpKyspCiAgICAJCWlmIChf\nYXV4RW5oYW5jZXJzW2ldLnNraXBFbmhhbmNlKG1ldGhvZCkpCiAgICAJCQly\nZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHN5bnRoZXRpYyBmaWVsZCBhY2Nl\nc3MgbWV0aG9kcyB0aGF0IHdpbGwgcmVwbGFjZSBhbGwgZGlyZWN0CiAgICAg\nKiBmaWVsZCBhY2Nlc3Nlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFk\nZEFjY2Vzc29ycygpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBnZXRDcmVh\ndGVTdWJjbGFzcygpID8gX21ldGEuZ2V0RmllbGRzKCkKICAgICAgICAgICAg\nOiBfbWV0YS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSkgewogICAgICAgICAgICAgICAgaWYg\nKCFnZXRSZWRlZmluZSgpICYmIGlzUHJvcGVydHlBY2Nlc3MoZm1kc1tpXSkp\nIHsKICAgICAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc1NldE1ldGhvZChm\nbWRzW2ldKTsKICAgICAgICAgICAgICAgICAgICBhZGRTdWJjbGFzc0dldE1l\ndGhvZChmbWRzW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFkZEdldE1ldGhvZChpLCBmbWRz\nW2ldKTsKICAgICAgICAgICAgICAgIGFkZFNldE1ldGhvZChpLCBmbWRzW2ld\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZHMgYSBub24tc3RhdGljIHNldHRlciB0aGF0IGRlbGVnYXRlcyB0\nbyB0aGUgc3VwZXIgbWV0aG9kcywgYW5kCiAgICAgKiBwZXJmb3JtcyBhbnkg\nbmVjZXNzYXJ5IGZpZWxkIHRyYWNraW5nLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYWRkU3ViY2xhc3NTZXRNZXRob2QoRmllbGRNZXRhRGF0YSBmbWQp\nCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAg\nICAgQ2xhc3MgcHJvcFR5cGUgPSBmbWQuZ2V0RGVjbGFyZWRUeXBlKCk7CiAg\nICAgICAgU3RyaW5nIHNldHRlck5hbWUgPSBnZXRTZXR0ZXJOYW1lKGZtZCk7\nCiAgICAgICAgQkNNZXRob2Qgc2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2Qo\nc2V0dGVyTmFtZSwgdm9pZC5jbGFzcywKICAgICAgICAgICAgbmV3IENsYXNz\nW10geyBwcm9wVHlwZSB9KTsKICAgICAgICBzZXRWaXNpYmlsaXR5VG9TdXBl\nck1ldGhvZChzZXR0ZXIpOwogICAgICAgIENvZGUgY29kZSA9IHNldHRlci5n\nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBub3QgbmVjZXNzYXJ5IGlmIHdl\nJ3JlIGFscmVhZHkgdHJhY2tpbmcgYWNjZXNzIHZpYSByZWRlZmluaXRpb24K\nICAgICAgICBpZiAoIWdldFJlZGVmaW5lKCkpIHsKICAgICAgICAgICAgLy8g\nZ2V0IHRoZSBvcmlnIHZhbHVlIG9udG8gc3RhY2sKICAgICAgICAgICAgY29k\nZS5hbG9hZCgpLnNldFRoaXMoKTsKICAgICAgICAgICAgYWRkR2V0TWFuYWdl\nZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgICAgICBpbnQgdmFsID0g\nY29kZS5nZXROZXh0TG9jYWxzSW5kZXgoKTsKICAgICAgICAgICAgY29kZS54\nc3RvcmUoKS5zZXRMb2NhbCh2YWwpLnNldFR5cGUoZm1kLmdldERlY2xhcmVk\nVHlwZSgpKTsKICAgICAgICAgICAgYWRkTm90aWZ5TXV0YXRpb24oY29kZSwg\nZm1kLCB2YWwsIDApOwogICAgICAgIH0KCiAgICAgICAgLy8gIyMjIyMgdGVz\ndCBjYXNlOiBCIGV4dGVuZHMgQS4gTWV0aG9kcyBkZWZpbmVkIGluIEEuIFdo\nYXQKICAgICAgICAvLyAjIyMjIyBoYXBwZW5zPwogICAgICAgIC8vIHN1cGVy\nLnNldFhYWCguLi4pCiAgICAgICAgY29kZS5hbG9hZCgpLnNldFRoaXMoKTsK\nICAgICAgICBjb2RlLnhsb2FkKCkuc2V0UGFyYW0oMCkuc2V0VHlwZShwcm9w\nVHlwZSk7CiAgICAgICAgY29kZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9k\nKF9tYW5hZ2VkVHlwZS5nZXRUeXBlKCksCiAgICAgICAgICAgIHNldHRlck5h\nbWUsIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsgcHJvcFR5cGUgfSk7Cgog\nICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRl\nTWF4TG9jYWxzKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygp\nOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBzZXRWaXNpYmlsaXR5VG9T\ndXBlck1ldGhvZChCQ01ldGhvZCBtZXRob2QpIHsKICAgICAgICBCQ01ldGhv\nZFtdIG1ldGhvZHMgPSBfbWFuYWdlZFR5cGUuZ2V0TWV0aG9kcyhtZXRob2Qu\nZ2V0TmFtZSgpLAogICAgICAgICAgICBtZXRob2QuZ2V0UGFyYW1UeXBlcygp\nKTsKICAgICAgICBpZiAobWV0aG9kcy5sZW5ndGggPT0gMCkKICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWFjY2Vz\nc29yIiwKICAgICAgICAgICAgICAgIF9tYW5hZ2VkVHlwZS5nZXROYW1lKCks\nIG1ldGhvZC5nZXROYW1lKCkpKTsKICAgICAgICBCQ01ldGhvZCBzdXBlck1l\ndGggPSBtZXRob2RzWzBdOwogICAgICAgIGlmIChzdXBlck1ldGguaXNQcml2\nYXRlKCkpIHsKICAgICAgICAgICAgbWV0aG9kLm1ha2VQcml2YXRlKCk7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoc3Vw\nZXJNZXRoLmlzUGFja2FnZSgpKSB7CiAgICAgICAgICAgIG1ldGhvZC5tYWtl\nUGFja2FnZSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nIGVsc2UgaWYgKHN1cGVyTWV0aC5pc1Byb3RlY3RlZCgpKSB7CiAgICAgICAg\nICAgIG1ldGhvZC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJNZXRoLmlzUHVibGlj\nKCkpIHsKICAgICAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZHMgYSBub24tc3RhdGlj\nIGdldHRlciB0aGF0IGRlbGVnYXRlcyB0byB0aGUgc3VwZXIgbWV0aG9kcywg\nYW5kCiAgICAgKiBwZXJmb3JtcyBhbnkgbmVjZXNzYXJ5IGZpZWxkIHRyYWNr\naW5nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU3ViY2xhc3NHZXRN\nZXRob2QoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBTdHJpbmcgbWV0\naE5hbWUgPSAiZ2V0IiArIFN0cmluZ1V0aWxzLmNhcGl0YWxpemUoZm1kLmdl\ndE5hbWUoKSk7CiAgICAgICAgaWYgKF9tYW5hZ2VkVHlwZS5nZXRNZXRob2Rz\nKG1ldGhOYW1lLCBuZXcgQ2xhc3NbMF0pLmxlbmd0aCA9PSAwKQogICAgICAg\nICAgICBtZXRoTmFtZSA9ICJpcyIgKyBTdHJpbmdVdGlscy5jYXBpdGFsaXpl\nKGZtZC5nZXROYW1lKCkpOwogICAgICAgIEJDTWV0aG9kIGdldHRlciA9IF9w\nYy5kZWNsYXJlTWV0aG9kKG1ldGhOYW1lLCBmbWQuZ2V0RGVjbGFyZWRUeXBl\nKCksCiAgICAgICAgICAgIG51bGwpOwogICAgICAgIHNldFZpc2liaWxpdHlU\nb1N1cGVyTWV0aG9kKGdldHRlcik7CiAgICAgICAgZ2V0dGVyLm1ha2VQdWJs\naWMoKTsKICAgICAgICBDb2RlIGNvZGUgPSBnZXR0ZXIuZ2V0Q29kZSh0cnVl\nKTsKCiAgICAgICAgLy8gaWYgd2UncmUgbm90IGFscmVhZHkgdHJhY2tpbmcg\nZmllbGQgYWNjZXNzIHZpYSByZWZsZWN0aW9uLCB0aGVuIHdlCiAgICAgICAg\nLy8gbXVzdCBtYWtlIHRoZSBnZXR0ZXIgaG9vayBpbiBsYXp5IGxvYWRpbmcg\nYmVmb3JlIGFjY2Vzc2luZyB0aGUgc3VwZXIKICAgICAgICAvLyBtZXRob2Qu\nCiAgICAgICAgaWYgKCFnZXRSZWRlZmluZSgpKQogICAgICAgICAgICBhZGRO\nb3RpZnlBY2Nlc3MoY29kZSwgZm1kKTsKCiAgICAgICAgY29kZS5hbG9hZCgp\nLnNldFRoaXMoKTsKICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwgbWV0aE5hbWUsCiAgICAg\nICAgICAgIGZtZC5nZXREZWNsYXJlZFR5cGUoKSwgbnVsbCk7CiAgICAgICAg\nY29kZS54cmV0dXJuKCkuc2V0VHlwZShmbWQuZ2V0RGVjbGFyZWRUeXBlKCkp\nOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQWRkcyBhIHN0YXRpYyBnZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4g\nZmllbGQuCiAgICAgKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMg\nd2l0aCB0aGUgaW5zdGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVN\nYW5hZ2VyIHRvIGdldCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoK\nICAgICAqIEBwYXJhbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRo\nZSBmaWVsZAogICAgICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUg\nZmllbGQgdG8gZ2V0CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRHZXRN\nZXRob2QoaW50IGluZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0\naHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhv\nZCBtZXRob2QgPSBjcmVhdGVHZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2Rl\nIGNvZGUgPSBtZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gaWYg\ncmVhZHMgYXJlIG5vdCBjaGVja2VkLCBqdXN0IHJldHVybiB0aGUgdmFsdWUK\nICAgICAgICBieXRlIGZpZWxkRmxhZyA9IGdldEZpZWxkRmxhZyhmbWQpOwog\nICAgICAgIGlmICgoZmllbGRGbGFnICYgUGVyc2lzdGVuY2VDYXBhYmxlLkNI\nRUNLX1JFQUQpID09IDAKICAgICAgICAgICAgJiYgKGZpZWxkRmxhZyAmIFBl\ncnNpc3RlbmNlQ2FwYWJsZS5NRURJQVRFX1JFQUQpID09IDApIHsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQpOwog\nICAgICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7\nCiAgICAgICAgICAgIGNvZGUueHJldHVybigpLnNldFR5cGUoZm1kLmdldERl\nY2xhcmVkVHlwZSgpKTsKCiAgICAgICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMo\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\naWYgKGluc3QucGNTdGF0ZU1hbmFnZXIgPT0gbnVsbCkgcmV0dXJuIGluc3Qu\nPGZpZWxkPjsKICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRy\ndWUsIGZtZCk7CiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNN\nLCBTTVRZUEUpOwogICAgICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNv\nZGUuaWZub25udWxsKCk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCB0cnVlLCBmbWQpOwogICAgICAgIGFkZEdldE1hbmFnZWRWYWx1ZUNv\nZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnhyZXR1cm4oKS5zZXRUeXBl\nKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAgIC8vIGludCBmaWVs\nZCA9IHBjSW5oZXJpdGVkRmllbGRDb3VudCArIDxmaWVsZGluZGV4PjsKICAg\nICAgICBpbnQgZmllbGRMb2NhbCA9IGNvZGUuZ2V0TmV4dExvY2Fsc0luZGV4\nKCk7CiAgICAgICAgaWZpbnMuc2V0VGFyZ2V0KGNvZGUuZ2V0c3RhdGljKCku\nc2V0RmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKSk7CiAgICAgICAgY29kZS5j\nb25zdGFudCgpLnNldFZhbHVlKGluZGV4KTsKICAgICAgICBjb2RlLmlhZGQo\nKTsKICAgICAgICBjb2RlLmlzdG9yZSgpLnNldExvY2FsKGZpZWxkTG9jYWwp\nOwoKICAgICAgICAvLyBpbnN0LnBjU3RhdGVNYW5hZ2VyLmFjY2Vzc2luZ0Zp\nZWxkIChmaWVsZCk7CiAgICAgICAgLy8gcmV0dXJuIGluc3QuPGZpZWxkPjsK\nICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7\nCiAgICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUp\nOwogICAgICAgIGNvZGUuaWxvYWQoKS5zZXRMb2NhbChmaWVsZExvY2FsKTsK\nICAgICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChTTVRZ\nUEUsICJhY2Nlc3NpbmdGaWVsZCIsIHZvaWQuY2xhc3MsCiAgICAgICAgICAg\nIG5ldyBDbGFzc1tdeyBpbnQuY2xhc3MgfSk7CiAgICAgICAgbG9hZE1hbmFn\nZWRJbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQpOwogICAgICAgIGFkZEdldE1h\nbmFnZWRWYWx1ZUNvZGUoY29kZSwgZm1kKTsKICAgICAgICBjb2RlLnhyZXR1\ncm4oKS5zZXRUeXBlKGZtZC5nZXREZWNsYXJlZFR5cGUoKSk7CgogICAgICAg\nIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1\nbGF0ZU1heExvY2FscygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkcyBh\nIHN0YXRpYyBzZXR0ZXIgbWV0aG9kIGZvciB0aGUgZ2l2ZW4gZmllbGQuCiAg\nICAgKiBUaGUgZ2VuZXJhdGVkIG1ldGhvZCBpbnRlcmFjdHMgd2l0aCB0aGUg\naW5zdGFuY2Ugc3RhdGUgYW5kIHRoZQogICAgICogU3RhdGVNYW5hZ2VyIHRv\nIHNldCB0aGUgdmFsdWUgb2YgdGhlIGZpZWxkLgogICAgICoKICAgICAqIEBw\nYXJhbSBpbmRleCB0aGUgcmVsYXRpdmUgbnVtYmVyIG9mIHRoZSBmaWVsZAog\nICAgICogQHBhcmFtIGZtZCBtZXRhZGF0YSBhYm91dCB0aGUgZmllbGQgdG8g\nc2V0CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRTZXRNZXRob2QoaW50\nIGluZGV4LCBGaWVsZE1ldGFEYXRhIGZtZCkKICAgICAgICB0aHJvd3MgTm9T\ndWNoTWV0aG9kRXhjZXB0aW9uIHsKICAgICAgICBCQ01ldGhvZCBtZXRob2Qg\nPSBjcmVhdGVTZXRNZXRob2QoZm1kKTsKICAgICAgICBDb2RlIGNvZGUgPSBt\nZXRob2QuZ2V0Q29kZSh0cnVlKTsKCiAgICAgICAgLy8gUENFbmhhbmNlciB1\nc2VzIHN0YXRpYyBtZXRob2RzOyBQQ1N1YmNsYXNzZXIgZG9lcyBub3QuCiAg\nICAgICAgaW50IGZpcnN0UGFyYW1PZmZzZXQgPSBnZXRBY2Nlc3NvclBhcmFt\nZXRlck9mZnNldChmbWQpOwoKICAgICAgICAvLyBpZiAoaW5zdC5wY1N0YXRl\nTWFuYWdlciA9PSBudWxsKSBpbnN0LjxmaWVsZD4gPSB2YWx1ZTsKICAgICAg\nICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUsIGZtZCk7CiAgICAg\nICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwogICAg\nICAgIEp1bXBJbnN0cnVjdGlvbiBpZmlucyA9IGNvZGUuaWZub25udWxsKCk7\nCiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCB0cnVlLCBmbWQp\nOwogICAgICAgIGNvZGUueGxvYWQoKS5zZXRQYXJhbShmaXJzdFBhcmFtT2Zm\nc2V0KTsKICAgICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZt\nZCk7CiAgICAgICAgaWYoZm1kLmlzVmVyc2lvbigpPT10cnVlICYmIF9hZGRW\nZXJzaW9uSW5pdEZsYWcpewogICAgICAgICAgICAvLyBpZiB3ZSBhcmUgc2V0\ndGluZyB0aGUgdmVyc2lvbiwgZmxpcCB0aGUgdmVyc2lvbkluaXQgZmxhZyB0\nbyB0cnVlCiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgdiA9IF9tZXRhLmFk\nZERlY2xhcmVkRmllbGQoVkVSU0lPTl9JTklUX1NUUiwgYm9vbGVhbi5jbGFz\ncyk7CiAgICAgICAgICAgIHYuc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAg\nICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIHRydWUpOwogICAgICAg\nICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoMSk7CiAgICAgICAgICAg\nIC8vIHBjVmVyc2lvbkluaXQgPSB0cnVlOwogICAgICAgICAgICBwdXRmaWVs\nZChjb2RlLCBudWxsLCB2LmdldE5hbWUoKSwgdi5nZXREZWNsYXJlZFR5cGUo\nKSk7ICAgCiAgICAgICAgfQogICAgICAgIGNvZGUudnJldHVybigpOwoKICAg\nICAgICAvLyBpbnN0LnBjU3RhdGVNYW5hZ2VyLnNldHRpbmc8ZmllbGRUeXBl\nPkZpZWxkIChpbnN0LAogICAgICAgIC8vICAgICBwY0luaGVyaXRlZEZpZWxk\nQ291bnQgKyA8aW5kZXg+LCBpbnN0LjxmaWVsZD4sIHZhbHVlLCAwKTsKICAg\nICAgICBpZmlucy5zZXRUYXJnZXQobG9hZE1hbmFnZWRJbnN0YW5jZShjb2Rl\nLCB0cnVlLCBmbWQpKTsKICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0Rmll\nbGQoU00sIFNNVFlQRSk7CiAgICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShj\nb2RlLCB0cnVlLCBmbWQpOwogICAgICAgIGNvZGUuZ2V0c3RhdGljKCkuc2V0\nRmllbGQoSU5IRVJJVCwgaW50LmNsYXNzKTsKICAgICAgICBjb2RlLmNvbnN0\nYW50KCkuc2V0VmFsdWUoaW5kZXgpOwogICAgICAgIGNvZGUuaWFkZCgpOwog\nICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgdHJ1ZSwgZm1kKTsK\nICAgICAgICBhZGRHZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAg\nICAgICAgY29kZS54bG9hZCgpLnNldFBhcmFtKGZpcnN0UGFyYW1PZmZzZXQp\nOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRWYWx1ZSgwKTsKICAgICAg\nICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChnZXRTdGF0ZU1h\nbmFnZXJNZXRob2QKICAgICAgICAgICAgKGZtZC5nZXREZWNsYXJlZFR5cGUo\nKSwgInNldHRpbmciLCBmYWxzZSwgdHJ1ZSkpOwogICAgICAgIGNvZGUudnJl\ndHVybigpOwoKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAg\nICAgICAgY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIERldGVybWluZXMgd2hpY2ggYXR0YWNoIC8gZGV0YWNoIG1l\ndGhvZHMgdG8gdXNlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkQXR0\nYWNoRGV0YWNoQ29kZSgpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gc2VlIGlmIGFueSBzdXBlcmNsYXNzZXMg\nYXJlIGRldGFjaGFibGUKICAgICAgICBib29sZWFuIHBhcmVudERldGFjaGFi\nbGUgPSBmYWxzZTsKICAgICAgICBmb3IgKENsYXNzTWV0YURhdGEgcGFyZW50\nID0gX21ldGEuZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKTsKICAgICAgICAg\nICAgcGFyZW50ICE9IG51bGw7IHBhcmVudCA9IHBhcmVudC5nZXRQQ1N1cGVy\nY2xhc3NNZXRhRGF0YSgpKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnQuaXNE\nZXRhY2hhYmxlKCkpIHsKICAgICAgICAgICAgICAgIHBhcmVudERldGFjaGFi\nbGUgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIHBhcmVudCBub3QgZGV0YWNo\nYWJsZSwgd2UgbmVlZCB0byBhZGQgdGhlIGRldGFjaCBzdGF0ZSBmaWVsZHMg\nYW5kCiAgICAgICAgLy8gYWNjZXNzb3IgbWV0aG9kcwogICAgICAgIGlmIChf\nbWV0YS5nZXRQQ1N1cGVyY2xhc3MoKSA9PSBudWxsIHx8IGdldENyZWF0ZVN1\nYmNsYXNzKCkKICAgICAgICAgICAgfHwgcGFyZW50RGV0YWNoYWJsZSAhPSBf\nbWV0YS5pc0RldGFjaGFibGUoKSkgewogICAgICAgICAgICBhZGRJc0RldGFj\naGVkTWV0aG9kKCk7CiAgICAgICAgICAgIGFkZERldGFjaGVkU3RhdGVNZXRo\nb2RzKF9tZXRhLnVzZXNEZXRhY2hlZFN0YXRlKCkKICAgICAgICAgICAgICAg\nICE9IEJvb2xlYW4uRkFMU0UpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYg\nd2UgZGV0YWNoIG9uIHNlcmlhbGl6ZSwgd2UgYWxzbyBuZWVkIHRvIGltcGxl\nbWVudCB0aGUKICAgICAgICAvLyBleHRlcm5hbGl6YWJsZSBpbnRlcmZhY2Ug\ndG8gd3JpdGUganVzdCB0aGUgc3RhdGUgZm9yIHRoZSBmaWVsZHMKICAgICAg\nICAvLyBiZWluZyBkZXRhY2hlZAogICAgICAgIGlmIChleHRlcm5hbGl6ZURl\ndGFjaGVkKCkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGFkZERldGFjaEV4dGVybmFsaXplKHBhcmVudERldGFjaGFibGUsCiAgICAg\nICAgICAgICAgICAgICAgX21ldGEudXNlc0RldGFjaGVkU3RhdGUoKSAhPSBC\nb29sZWFuLkZBTFNFKTsKICAgICAgICAgICAgfSBjYXRjaCAoTm9TdWNoTWV0\naG9kRXhjZXB0aW9uIG5zbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBHZW5lcmFsRXhjZXB0aW9uKG5zbWUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRoZSBmaWVsZHMgdG8g\naG9sZCBkZXRhY2hlZCBzdGF0ZSBhbmQgdGhlaXIgYWNjZXNzb3IgbWV0aG9k\ncy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW1wbCB3aGV0aGVyIHRvIGZ1bGx5\nIGltcGxlbWVudCBkZXRhY2ggc3RhdGUgZnVuY3Rpb25hbGl0eQogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgYWRkRGV0YWNoZWRTdGF0ZU1ldGhvZHMoYm9v\nbGVhbiBpbXBsKSB7CiAgICAgICAgRmllbGQgZGV0YWNoRmllbGQgPSBfbWV0\nYS5nZXREZXRhY2hlZFN0YXRlRmllbGQoKTsKICAgICAgICBTdHJpbmcgbmFt\nZSA9IG51bGw7CiAgICAgICAgU3RyaW5nIGRlY2xhcmVyID0gbnVsbDsKICAg\nICAgICBpZiAoaW1wbCAmJiBkZXRhY2hGaWVsZCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIG5hbWUgPSBQUkUgKyAiRGV0YWNoZWRTdGF0ZSI7CiAgICAgICAg\nICAgIGRlY2xhcmVyID0gX3BjLmdldE5hbWUoKTsKICAgICAgICAgICAgQkNG\naWVsZCBmaWVsZCA9IF9wYy5kZWNsYXJlRmllbGQobmFtZSwgT2JqZWN0LmNs\nYXNzKTsKICAgICAgICAgICAgZmllbGQubWFrZVByaXZhdGUoKTsKICAgICAg\nICAgICAgZmllbGQuc2V0VHJhbnNpZW50KHRydWUpOwogICAgICAgIH0gZWxz\nZSBpZiAoaW1wbCkgewogICAgICAgICAgICBuYW1lID0gZGV0YWNoRmllbGQu\nZ2V0TmFtZSgpOwogICAgICAgICAgICBkZWNsYXJlciA9IGRldGFjaEZpZWxk\nLmdldERlY2xhcmluZ0NsYXNzKCkuZ2V0TmFtZSgpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gcHVibGljIE9iamVjdCBwY0dldERldGFjaGVkU3RhdGUgKCkK\nICAgICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQ\nUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAgICAgIE9iamVjdC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgbWV0aG9kLnNldFN0YXRpYyhmYWxzZSk7\nCiAgICAgICAgbWV0aG9kLm1ha2VQdWJsaWMoKTsKICAgICAgICBpbnQgYWNj\nZXNzID0gbWV0aG9kLmdldEFjY2Vzc0ZsYWdzKCk7CgogICAgICAgIENvZGUg\nY29kZSA9IG1ldGhvZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGlmIChpbXBs\nKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBwY0RldGFjaGVkU3RhdGU7CiAg\nICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwog\nICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBfbWFuYWdlZFR5cGUuZ2V0UHJv\namVjdCgpLmxvYWRDbGFzcyhkZWNsYXJlciksCiAgICAgICAgICAgICAgICBu\nYW1lKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY29kZS5jb25zdGFu\ndCgpLnNldE51bGwoKTsKICAgICAgICBjb2RlLmFyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgICAgIGNvZGUuY2Fs\nY3VsYXRlTWF4U3RhY2soKTsKCiAgICAgICAgLy8gcHVibGljIHZvaWQgcGNT\nZXREZXRhY2hlZFN0YXRlIChPYmplY3Qgc3RhdGUpCiAgICAgICAgbWV0aG9k\nID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNldERldGFjaGVkU3RhdGUi\nLAogICAgICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3MgW117IE9iamVj\ndC5jbGFzcyB9KTsKICAgICAgICBtZXRob2Quc2V0QWNjZXNzRmxhZ3MoYWNj\nZXNzKTsKICAgICAgICBjb2RlID0gbWV0aG9kLmdldENvZGUodHJ1ZSk7CiAg\nICAgICAgaWYgKGltcGwpIHsKICAgICAgICAgICAgLy8gcGNEZXRhY2hlZFN0\nYXRlID0gc3RhdGU7CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFy\nYW0oMCk7CiAgICAgICAgICAgIHB1dGZpZWxkKGNvZGUsIF9tYW5hZ2VkVHlw\nZS5nZXRQcm9qZWN0KCkubG9hZENsYXNzKGRlY2xhcmVyKSwKICAgICAgICAg\nICAgICAgIG5hbWUsIE9iamVjdC5jbGFzcyk7CiAgICAgICAgfQogICAgICAg\nIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3Rh\nY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAg\nfQoKICAgIC8qKgogICAgICogQWRkcyB0byA8Y29kZT5jb2RlPC9jb2RlPiB0\naGUgaW5zdHJ1Y3Rpb25zIHRvIGdldCBmaWVsZAogICAgICogPGNvZGU+YXR0\nck5hbWU8L2NvZGU+IGRlY2xhcmVkIGluIHR5cGUgPGNvZGU+ZGVjbGFyZXI8\nL2NvZGU+CiAgICAgKiBvbnRvIHRoZSB0b3Agb2YgdGhlIHN0YWNrLgogICAg\nICoKICAgICAqIFRoZSBpbnN0YW5jZSB0byBhY2Nlc3MgbXVzdCBhbHJlYWR5\nIGJlIG9uIHRoZSB0b3Agb2YgdGhlCiAgICAgKiBzdGFjayB3aGVuIHRoaXMg\naXMgaW52b2tlZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGdldGZpZWxk\nKENvZGUgY29kZSwgQkNDbGFzcyBkZWNsYXJlciwgU3RyaW5nIGF0dHJOYW1l\nKSB7CiAgICAgICAgaWYgKGRlY2xhcmVyID09IG51bGwpCiAgICAgICAgICAg\nIGRlY2xhcmVyID0gX21hbmFnZWRUeXBlOwoKICAgICAgICAvLyBmaXJzdCwg\nc2VlIGlmIHdlIGNhbiBjb252ZXJ0IHRoZSBhdHRyaWJ1dGUgbmFtZSB0byBh\nIGZpZWxkIG5hbWUKICAgICAgICBTdHJpbmcgZmllbGROYW1lID0gdG9CYWNr\naW5nRmllbGROYW1lKGF0dHJOYW1lKTsKCiAgICAgICAgLy8gbmV4dCwgZmlu\nZCB0aGUgZmllbGQgaW4gdGhlIG1hbmFnZWQgdHlwZSBoaWVyYXJjaHkKICAg\nICAgICBCQ0ZpZWxkIGZpZWxkID0gbnVsbDsKICAgICAgICBvdXRlcjogZm9y\nIChCQ0NsYXNzIGJjID0gX3BjOyBiYyAhPSBudWxsOyBiYyA9IGJjLmdldFN1\ncGVyY2xhc3NCQygpKSB7CiAgICAgICAgICAgIEJDRmllbGRbXSBmaWVsZHMg\nPSBBY2Nlc3NDb250cm9sbGVyCiAgICAgICAgICAgICAgICAuZG9Qcml2aWxl\nZ2VkKEoyRG9Qcml2SGVscGVyLmdldEJDQ2xhc3NGaWVsZHNBY3Rpb24oYmMs\nCiAgICAgICAgICAgICAgICAgICAgZmllbGROYW1lKSk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBmaWVsZCA9IGZpZWxkc1tpXTsKICAgICAgICAgICAg\nICAgIC8vIGlmIHdlIHJlYWNoIGEgZmllbGQgZGVjbGFyZWQgaW4gdGhpcyB0\neXBlLCB0aGVuIHRoaXMgaXMgdGhlCiAgICAgICAgICAgICAgICAvLyBtb3N0\nLW1hc2tpbmcgZmllbGQsIGFuZCBpcyB0aGUgb25lIHRoYXQgd2Ugd2FudC4K\nICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uZ2V0RGVjbGFyZXIoKSA9\nPSBkZWNsYXJlcikgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVy\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBpZiAoZ2V0Q3JlYXRlU3ViY2xhc3MoKSAmJiBjb2RlLmdldE1l\ndGhvZCgpLmdldERlY2xhcmVyKCkgPT0gX3BjCiAgICAgICAgICAgICYmIChm\naWVsZCA9PSBudWxsIHx8ICFmaWVsZC5pc1B1YmxpYygpKSkgewogICAgICAg\nICAgICAvLyB3ZSdyZSBjcmVhdGluZyB0aGUgc3ViY2xhc3MsIG5vdCByZWRl\nZmluaW5nIHRoZSB1c2VyIHR5cGUuCgogICAgICAgICAgICAvLyBSZWZsZWN0\naW9uLmdldFhYWCh0aGlzLCBSZWZsZWN0aW9uLmZpbmRGaWVsZCguLi4pKTsK\nICAgICAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCkuc2V0Q2xhc3MoZGVj\nbGFyZXIpOwogICAgICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUo\nZmllbGROYW1lKTsKICAgICAgICAgICAgY29kZS5jb25zdGFudCgpLnNldFZh\nbHVlKHRydWUpOwogICAgICAgICAgICBjb2RlLmludm9rZXN0YXRpYygpLnNl\ndE1ldGhvZChSZWZsZWN0aW9uLmNsYXNzLAogICAgICAgICAgICAgICAgImZp\nbmRGaWVsZCIsIEZpZWxkLmNsYXNzLCBuZXcgQ2xhc3NbXSB7CiAgICAgICAg\nICAgICAgICBDbGFzcy5jbGFzcywgU3RyaW5nLmNsYXNzLCBib29sZWFuLmNs\nYXNzIH0pOwogICAgICAgICAgICBDbGFzcyB0eXBlID0gX21ldGEuZ2V0Rmll\nbGQoYXR0ck5hbWUpLmdldERlY2xhcmVkVHlwZSgpOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzdGF0aWMoKS5zZXRN\nZXRob2QoCiAgICAgICAgICAgICAgICAgICAgZ2V0UmVmbGVjdGlvbkdldHRl\nck1ldGhvZCh0eXBlLCBGaWVsZC5jbGFzcykpOwogICAgICAgICAgICB9IGNh\ndGNoIChOb1N1Y2hNZXRob2RFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgLy8gc2hvdWxkIG5ldmVyIGhhcHBlbgogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0g\nT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgY29kZS5jaGVja2Nhc3Qo\nKS5zZXRUeXBlKHR5cGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGNvZGUuZ2V0ZmllbGQoKS5zZXRGaWVsZChkZWNsYXJlci5nZXROYW1lKCks\nIGZpZWxkTmFtZSwKICAgICAgICAgICAgICAgIGZpZWxkLmdldFR5cGUoKS5n\nZXROYW1lKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFk\nZHMgdG8gPGNvZGU+Y29kZTwvY29kZT4gdGhlIGluc3RydWN0aW9ucyB0byBz\nZXQgZmllbGQKICAgICAqIDxjb2RlPmF0dHJOYW1lPC9jb2RlPiBkZWNsYXJl\nZCBpbiB0eXBlIDxjb2RlPmRlY2xhcmVyPC9jb2RlPgogICAgICogdG8gdGhl\nIHZhbHVlIG9mIHR5cGUgPGNvZGU+ZmllbGRUeXBlPC9jb2RlPiBvbiB0aGUg\ndG9wIG9mIHRoZSBzdGFjay4KICAgICAqCiAgICAgKiBXaGVuIHRoaXMgbWV0\naG9kIGlzIGludm9rZWQsIHRoZSB2YWx1ZSB0byBsb2FkIG11c3QKICAgICAq\nIGFscmVhZHkgYmUgb24gdGhlIHRvcCBvZiB0aGUgc3RhY2sgaW4gPGNvZGU+\nY29kZTwvY29kZT4sCiAgICAgKiBhbmQgdGhlIGluc3RhbmNlIHRvIGxvYWQg\naW50byBtdXN0IGJlIHNlY29uZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHB1dGZpZWxkKENvZGUgY29kZSwgQkNDbGFzcyBkZWNsYXJlciwgU3RyaW5n\nIGF0dHJOYW1lLAogICAgICAgIENsYXNzIGZpZWxkVHlwZSkgewogICAgICAg\nIGlmIChkZWNsYXJlciA9PSBudWxsKQogICAgICAgICAgICBkZWNsYXJlciA9\nIF9tYW5hZ2VkVHlwZTsKCiAgICAgICAgU3RyaW5nIGZpZWxkTmFtZSA9IHRv\nQmFja2luZ0ZpZWxkTmFtZShhdHRyTmFtZSk7CgogICAgICAgIGlmIChnZXRS\nZWRlZmluZSgpIHx8IGdldENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAg\nICAgLy8gUmVmbGVjdGlvbi5zZXQodGhpcywgUmVmbGVjdGlvbi5maW5kRmll\nbGQoLi4uKSwgdmFsdWUpOwogICAgICAgICAgICBjb2RlLmNsYXNzY29uc3Rh\nbnQoKS5zZXRDbGFzcyhkZWNsYXJlcik7CiAgICAgICAgICAgIGNvZGUuY29u\nc3RhbnQoKS5zZXRWYWx1ZShmaWVsZE5hbWUpOwogICAgICAgICAgICBjb2Rl\nLmNvbnN0YW50KCkuc2V0VmFsdWUodHJ1ZSk7CiAgICAgICAgICAgIGNvZGUu\naW52b2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsCiAg\nICAgICAgICAgICAgICAiZmluZEZpZWxkIiwgRmllbGQuY2xhc3MsIG5ldyBD\nbGFzc1tdIHsKICAgICAgICAgICAgICAgIENsYXNzLmNsYXNzLCBTdHJpbmcu\nY2xhc3MsIGJvb2xlYW4uY2xhc3MgfSk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3RhdGljKCkuc2V0TWV0aG9kKFJlZmxlY3Rpb24uY2xhc3MsICJzZXQi\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywKICAgICAgICAgICAgICAg\nIG5ldyBDbGFzc1tdIHsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuY2xh\nc3MsCiAgICAgICAgICAgICAgICAgICAgZmllbGRUeXBlLmlzUHJpbWl0aXZl\nKCkgPyBmaWVsZFR5cGUgOiBPYmplY3QuY2xhc3MsIAogICAgICAgICAgICAg\nICAgICAgIEZpZWxkLmNsYXNzIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIGNvZGUucHV0ZmllbGQoKQogICAgICAgICAgICAgICAgLnNldEZp\nZWxkKGRlY2xhcmVyLmdldE5hbWUoKSwgZmllbGROYW1lLCBmaWVsZFR5cGUu\nZ2V0TmFtZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJ\nZiB1c2luZyBwcm9wZXJ0eSBhY2Nlc3MsIHNlZSBpZiB0aGVyZSBpcyBhIGRp\nZmZlcmVudCBiYWNraW5nIGZpZWxkCiAgICAgKiBuYW1lIGZvciB0aGUgcGVy\nc2lzdGVudCBhdHRyaWJ1dGUgPGNvZGU+bmFtZTwvY29kZT4uCiAgICAgKi8K\nICAgIHByaXZhdGUgU3RyaW5nIHRvQmFja2luZ0ZpZWxkTmFtZShTdHJpbmcg\nbmFtZSkgewogICAgICAgIC8vIG1ldGEgaXMgbnVsbCB3aGVuIGVuaGFuY2lu\nZyBwZXJzaXN0ZW5jZS1hd2FyZSAKICAgIAlGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9tZXRhID09IG51bGwgPyBudWxsIDogX21ldGEuZ2V0RmllbGQobmFtZSk7\nCiAgICAgICAgaWYgKF9tZXRhICE9IG51bGwgJiYgaXNQcm9wZXJ0eUFjY2Vz\ncyhmbWQpCiAgICAgICAgICAgICYmIF9hdHRyc1RvRmllbGRzICE9IG51bGwg\nJiYgX2F0dHJzVG9GaWVsZHMuY29udGFpbnNLZXkobmFtZSkpCiAgICAgICAg\nICAgIG5hbWUgPSAoU3RyaW5nKV9hdHRyc1RvRmllbGRzLmdldChuYW1lKTsK\nICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIElm\nIHVzaW5nIHByb3BlcnR5IGFjY2Vzcywgc2VlIGlmIHRoZXJlIGlzIGEgZGlm\nZmVyZW50IHBlcnNpc3RlbnQKICAgICAqIGF0dHJpYnV0ZSBuYW1lIGZvciB0\naGUgYmFja2luZyBmaWVsZCA8Y29kZT5uYW1lPC9jb2RlPi4KICAgICAqLwog\nICAgcHJpdmF0ZSBTdHJpbmcgZnJvbUJhY2tpbmdGaWVsZE5hbWUoU3RyaW5n\nIG5hbWUpIHsKICAgICAgICAvLyBtZXRhIGlzIG51bGwgd2hlbiBlbmhhbmNp\nbmcgcGVyc2lzdGVuY2UtYXdhcmUgCiAgICAJRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YSA9PSBudWxsID8gbnVsbCA6IF9tZXRhLmdldEZpZWxkKG5hbWUp\nOwogICAgICAgIGlmIChfbWV0YSAhPSBudWxsICYmIGlzUHJvcGVydHlBY2Nl\nc3MoZm1kKQogICAgICAgICAgICAmJiBfZmllbGRzVG9BdHRycyAhPSBudWxs\nICYmIF9maWVsZHNUb0F0dHJzLmNvbnRhaW5zS2V5KG5hbWUpKQogICAgICAg\nICAgICByZXR1cm4gKFN0cmluZylfZmllbGRzVG9BdHRycy5nZXQobmFtZSk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEltcGxlbWVudCB0aGUgZXh0ZXJuYWxpemFibGUg\naW50ZXJmYWNlIHRvIGRldGFjaCBvbiBzZXJpYWxpemUuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBhZGREZXRhY2hFeHRlcm5hbGl6ZShib29sZWFuIHBh\ncmVudERldGFjaGFibGUsCiAgICAgICAgYm9vbGVhbiBkZXRhY2hlZFN0YXRl\nKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAg\nICAgIC8vIGVuc3VyZSB0aGF0IHRoZSBkZWNsYXJlZCBkZWZhdWx0IGNvbnN0\ncnVjdG9yIGlzIHB1YmxpYyAKICAgICAgICAvLyBmb3IgZXh0ZXJuYWxpemF0\naW9uCiAgICAgICAgQkNNZXRob2QgbWV0aCA9IF9wYy5nZXREZWNsYXJlZE1l\ndGhvZCgiPGluaXQ+IiwgKFN0cmluZ1tdKSBudWxsKTsKICAgICAgICBpZiAo\nIW1ldGguaXNQdWJsaWMoKSkgewogICAgICAgICAgICBpZiAoX2xvZy5pc1dh\ncm5FbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLndhcm4oX2xvYy5n\nZXQoImVuaGFuY2UtZGVmY29ucy1leHRlcm4iLCAKICAgICAgICAgICAgICAg\nICAgX21ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSk7CiAgICAgICAgICAgIG1l\ndGgubWFrZVB1YmxpYygpOwogICAgICAgIH0KICAgICAgICAvLyBkZWNsYXJl\nIGV4dGVybmFsaXphYmxlIGludGVyZmFjZQogICAgICAgIGlmICghRXh0ZXJu\nYWxpemFibGUuY2xhc3MuaXNBc3NpZ25hYmxlRnJvbShfbWV0YS5nZXREZXNj\ncmliZWRUeXBlKCkpKQogICAgICAgICAgICBfcGMuZGVjbGFyZUludGVyZmFj\nZShFeHRlcm5hbGl6YWJsZS5jbGFzcyk7CgogICAgICAgIC8vIG1ha2Ugc3Vy\nZSB0aGUgdXNlciBkb2Vzbid0IGFscmVhZHkgaGF2ZSBjdXN0b20gZXh0ZXJu\nYWxpemF0aW9uIG9yCiAgICAgICAgLy8gc2VyaWFsaXphdGlvbiBtZXRob2Rz\nCiAgICAgICAgQ2xhc3NbXSBpbnB1dCA9IG5ldyBDbGFzc1tdeyBPYmplY3RJ\nbnB1dFN0cmVhbS5jbGFzcyB9OwogICAgICAgIENsYXNzW10gb3V0cHV0ID0g\nbmV3IENsYXNzW117IE9iamVjdE91dHB1dFN0cmVhbS5jbGFzcyB9OwogICAg\nICAgIGlmIChfbWFuYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRP\nYmplY3QiLCBpbnB1dCkgIT0gbnVsbAogICAgICAgICAgICB8fCBfbWFuYWdl\nZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoIndyaXRlT2JqZWN0Iiwgb3V0cHV0\nKSAhPSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgiZGV0YWNoLWN1c3RvbS1zZXIiLCBfbWV0YSkpOwogICAg\nICAgIGlucHV0WzBdID0gT2JqZWN0SW5wdXQuY2xhc3M7CiAgICAgICAgb3V0\ncHV0WzBdID0gT2JqZWN0T3V0cHV0LmNsYXNzOwogICAgICAgIGlmIChfbWFu\nYWdlZFR5cGUuZ2V0RGVjbGFyZWRNZXRob2QoInJlYWRFeHRlcm5hbCIsIGlu\ncHV0KSAhPSBudWxsCiAgICAgICAgICAgIHx8IF9tYW5hZ2VkVHlwZS5nZXRE\nZWNsYXJlZE1ldGhvZCgid3JpdGVFeHRlcm5hbCIsIG91dHB1dCkgIT0gbnVs\nbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoImRldGFjaC1jdXN0b20tZXh0ZXJuIiwgX21ldGEpKTsKCiAgICAgICAg\nLy8gY3JlYXRlIGxpc3Qgb2YgYWxsIHVubWFuYWdlZCBzZXJpYWxpemFibGUg\nZmllbGRzCiAgICAgICAgQkNGaWVsZFtdIGZpZWxkcyA9IF9tYW5hZ2VkVHlw\nZS5nZXREZWNsYXJlZEZpZWxkcygpOwogICAgICAgIENvbGxlY3Rpb24gdW5t\nZ2QgPSBuZXcgQXJyYXlMaXN0KGZpZWxkcy5sZW5ndGgpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAg\nICAgICAgIGlmICghZmllbGRzW2ldLmlzVHJhbnNpZW50KCkgJiYgIWZpZWxk\nc1tpXS5pc1N0YXRpYygpCiAgICAgICAgICAgICAgICAmJiAhZmllbGRzW2ld\nLmlzRmluYWwoKQogICAgICAgICAgICAgICAgJiYgIWZpZWxkc1tpXS5nZXRO\nYW1lKCkuc3RhcnRzV2l0aChQUkUpCiAgICAgICAgICAgICAgICAmJiBfbWV0\nYS5nZXREZWNsYXJlZEZpZWxkKGZpZWxkc1tpXS5nZXROYW1lKCkpID09IG51\nbGwpCiAgICAgICAgICAgICAgICB1bm1nZC5hZGQoZmllbGRzW2ldKTsKICAg\nICAgICB9CgogICAgICAgIGFkZFJlYWRFeHRlcm5hbChwYXJlbnREZXRhY2hh\nYmxlLCBkZXRhY2hlZFN0YXRlKTsKICAgICAgICBhZGRSZWFkVW5tYW5hZ2Vk\nKHVubWdkLCBwYXJlbnREZXRhY2hhYmxlKTsKICAgICAgICBhZGRXcml0ZUV4\ndGVybmFsKHBhcmVudERldGFjaGFibGUsIGRldGFjaGVkU3RhdGUpOwogICAg\nICAgIGFkZFdyaXRlVW5tYW5hZ2VkKHVubWdkLCBwYXJlbnREZXRhY2hhYmxl\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBjdXN0b20gcmVhZEV4dGVy\nbmFsIG1ldGhvZC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZFJlYWRF\neHRlcm5hbChib29sZWFuIHBhcmVudERldGFjaGFibGUsCiAgICAgICAgYm9v\nbGVhbiBkZXRhY2hlZFN0YXRlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIENsYXNzW10gaW5hcmdzID0gbmV3IENs\nYXNzW117IE9iamVjdElucHV0LmNsYXNzIH07CiAgICAgICAgQkNNZXRob2Qg\nbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKCJyZWFkRXh0ZXJuYWwiLCB2b2lk\nLmNsYXNzLCBpbmFyZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0g\nbWV0aC5nZXRFeGNlcHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRF\neGNlcHRpb24oSU9FeGNlcHRpb24uY2xhc3MpOwogICAgICAgIGV4Y2Vwcy5h\nZGRFeGNlcHRpb24oQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbi5jbGFzcyk7CiAg\nICAgICAgQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAg\nICAvLyBzdXBlci5yZWFkRXh0ZXJuYWwgKGluKTsKICAgICAgICBDbGFzcyBz\ndXAgPSBfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkuZ2V0U3VwZXJjbGFzcygp\nOwogICAgICAgIGlmICghcGFyZW50RGV0YWNoYWJsZSAmJiBFeHRlcm5hbGl6\nYWJsZS5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHN1cCkpIHsKICAgICAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\nICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29k\nZS5pbnZva2VzcGVjaWFsKCkuc2V0TWV0aG9kKHN1cCwgInJlYWRFeHRlcm5h\nbCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBpbmFyZ3MpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gcmVhZFVubWFuYWdlZCAoaW4pOwogICAgICAg\nIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgIGNv\nZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0YSksCiAgICAgICAgICAg\nIFBSRSArICJSZWFkVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgaW5hcmdzKTsK\nCiAgICAgICAgaWYgKGRldGFjaGVkU3RhdGUpIHsKICAgICAgICAgICAgLy8g\ncGNTZXREZXRhY2hlZFN0YXRlIChpbi5yZWFkT2JqZWN0ICgpKTsKICAgICAg\nICAgICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAg\nICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAg\nY29kZS5pbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQu\nY2xhc3MsICJyZWFkT2JqZWN0IiwKICAgICAgICAgICAgICAgIE9iamVjdC5j\nbGFzcywgbnVsbCk7CiAgICAgICAgICAgIGNvZGUuaW52b2tldmlydHVhbCgp\nLnNldE1ldGhvZChQUkUgKyAiU2V0RGV0YWNoZWRTdGF0ZSIsCiAgICAgICAg\nICAgICAgICB2b2lkLmNsYXNzLCBuZXcgQ2xhc3NbXXsgT2JqZWN0LmNsYXNz\nIH0pOwoKICAgICAgICAgICAgLy8gcGNSZXBsYWNlU3RhdGVNYW5hZ2VyICgo\nU3RhdGVNYW5hZ2VyKSBpbi5yZWFkT2JqZWN0ICgpKTsKICAgICAgICAgICAg\nbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAg\nIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAgICAgICAgY29kZS5p\nbnZva2VpbnRlcmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQuY2xhc3Ms\nICJyZWFkT2JqZWN0IiwKICAgICAgICAgICAgICAgIE9iamVjdC5jbGFzcywg\nbnVsbCk7CiAgICAgICAgICAgIGNvZGUuY2hlY2tjYXN0KCkuc2V0VHlwZShT\ndGF0ZU1hbmFnZXIuY2xhc3MpOwogICAgICAgICAgICBjb2RlLmludm9rZXZp\ncnR1YWwoKS5zZXRNZXRob2QoUFJFICsgIlJlcGxhY2VTdGF0ZU1hbmFnZXIi\nLAogICAgICAgICAgICAgICAgdm9pZC5jbGFzcywgbmV3IENsYXNzW117IFN0\nYXRlTWFuYWdlci5jbGFzcyB9KTsKICAgICAgICB9CgogICAgICAgIC8vIHJl\nYWQgbWFuYWdlZCBmaWVsZHMKICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1k\ncyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKCFmbWRz\nW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAgICAgICAgICByZWFkRXh0ZXJu\nYWwoY29kZSwgZm1kc1tpXS5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAg\nICAgZm1kc1tpXS5nZXREZWNsYXJlZFR5cGUoKSwgZm1kc1tpXSk7CgogICAg\nICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4\nU3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVhZCB1bm1hbmFnZWQgZmllbGRzIGZy\nb20gdGhlIHN0cmVhbSAocGNSZWFkVW5tYW5hZ2VkKS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGFkZFJlYWRVbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1n\nZCwgYm9vbGVhbiBwYXJlbnREZXRhY2hhYmxlKQogICAgICAgIHRocm93cyBO\nb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIENsYXNzW10gaW5hcmdz\nID0gbmV3IENsYXNzW117IE9iamVjdElucHV0LmNsYXNzIH07CiAgICAgICAg\nQkNNZXRob2QgbWV0aCA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArICJSZWFk\nVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgaW5hcmdzKTsK\nICAgICAgICBtZXRoLm1ha2VQcm90ZWN0ZWQoKTsKICAgICAgICBFeGNlcHRp\nb25zIGV4Y2VwcyA9IG1ldGguZ2V0RXhjZXB0aW9ucyh0cnVlKTsKICAgICAg\nICBleGNlcHMuYWRkRXhjZXB0aW9uKElPRXhjZXB0aW9uLmNsYXNzKTsKICAg\nICAgICBleGNlcHMuYWRkRXhjZXB0aW9uKENsYXNzTm90Rm91bmRFeGNlcHRp\nb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0Q29kZSh0\ncnVlKTsKCiAgICAgICAgLy8gc3VwZXIucmVhZFVubWFuYWdlZCAoaW4pOwog\nICAgICAgIGlmIChwYXJlbnREZXRhY2hhYmxlKSB7CiAgICAgICAgICAgIGxv\nYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICBj\nb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAgICAgICAgIGNvZGUuaW52\nb2tlc3BlY2lhbCgpLnNldE1ldGhvZChnZXRUeXBlKF9tZXRhLgogICAgICAg\nICAgICAgICAgZ2V0UENTdXBlcmNsYXNzTWV0YURhdGEoKSksIFBSRSArICJS\nZWFkVW5tYW5hZ2VkIiwgdm9pZC5jbGFzcywgCiAgICAgICAgICAgICAgICBp\nbmFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVhZCBkZWNsYXJlZCB1\nbm1hbmFnZWQgc2VyaWFsaXphYmxlIGZpZWxkcwogICAgICAgIEJDRmllbGQg\nZmllbGQ7CiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB1bm1nZC5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBmaWVsZCA9\nIChCQ0ZpZWxkKSBpdHIubmV4dCgpOwogICAgICAgICAgICByZWFkRXh0ZXJu\nYWwoY29kZSwgZmllbGQuZ2V0TmFtZSgpLCBmaWVsZC5nZXRUeXBlKCksIG51\nbGwpOwogICAgICAgIH0KICAgICAgICBjb2RlLnZyZXR1cm4oKTsKICAgICAg\nICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAgY29kZS5jYWxj\ndWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gcmVhZCBhIGZpZWxkIGZyb20gYW4gZXh0ZXJuYWxpemF0\naW9uIGlucHV0IHN0cmVhbS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJl\nYWRFeHRlcm5hbChDb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5hbWUsIENsYXNz\nIHR5cGUsCiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1l\ndGhOYW1lOwogICAgICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpIHsKICAg\nICAgICAgICAgbWV0aE5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICAg\nICAgbWV0aE5hbWUgPSBtZXRoTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBl\nckNhc2UoTG9jYWxlLkVOR0xJU0gpCiAgICAgICAgICAgICAgICArIG1ldGhO\nYW1lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSAicmVh\nZCIgKyBtZXRoTmFtZTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgbWV0\naE5hbWUgPSAicmVhZE9iamVjdCI7CgogICAgICAgIC8vIDxmaWVsZD4gPSBp\nbi5yZWFkPHR5cGU+ICgpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2Uo\nY29kZSwgZmFsc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgw\nKTsKICAgICAgICBDbGFzcyByZXQgPSAodHlwZS5pc1ByaW1pdGl2ZSgpKSA/\nIHR5cGUgOiBPYmplY3QuY2xhc3M7CiAgICAgICAgY29kZS5pbnZva2VpbnRl\ncmZhY2UoKS5zZXRNZXRob2QoT2JqZWN0SW5wdXQuY2xhc3MsIG1ldGhOYW1l\nLAogICAgICAgICAgICByZXQsIG51bGwpOwogICAgICAgIGlmICghdHlwZS5p\nc1ByaW1pdGl2ZSgpICYmIHR5cGUgIT0gT2JqZWN0LmNsYXNzKQogICAgICAg\nICAgICBjb2RlLmNoZWNrY2FzdCgpLnNldFR5cGUodHlwZSk7CiAgICAgICAg\naWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBwdXRmaWVsZChjb2RlLCBu\ndWxsLCBmaWVsZE5hbWUsIHR5cGUpOwogICAgICAgIGVsc2UgewogICAgICAg\nICAgICBhZGRTZXRNYW5hZ2VkVmFsdWVDb2RlKGNvZGUsIGZtZCk7CiAgICAg\nICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLk1BUDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5\ncGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNB\nTEVOREFSOgogICAgICAgICAgICAgICAgICAgIC8vIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIC8vICAgc20ucHJveHlEZXRhY2hlZERl\nc2VyaWFsaXplZCAoPGluZGV4Pik7CiAgICAgICAgICAgICAgICAgICAgbG9h\nZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICAgICAgY29kZS5nZXRmaWVsZCgpLnNldEZpZWxkKFNNLCBTTVRZUEUpOwog\nICAgICAgICAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZpbnMgPSBjb2Rl\nLmlmbnVsbCgpOwogICAgICAgICAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5z\ndGFuY2UoY29kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGNvZGUu\nZ2V0ZmllbGQoKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAg\nICAgICAgICBjb2RlLmNvbnN0YW50KCkuc2V0VmFsdWUoZm1kLmdldEluZGV4\nKCkpOwogICAgICAgICAgICAgICAgICAgIGNvZGUuaW52b2tlaW50ZXJmYWNl\nKCkuc2V0TWV0aG9kKFNNVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAg\nInByb3h5RGV0YWNoZWREZXNlcmlhbGl6ZWQiLCB2b2lkLmNsYXNzLAogICAg\nICAgICAgICAgICAgICAgICAgICBuZXcgQ2xhc3NbXXsgaW50LmNsYXNzIH0p\nOwogICAgICAgICAgICAgICAgICAgIGlmaW5zLnNldFRhcmdldChjb2RlLm5v\ncCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEFkZCBjdXN0b20gd3JpdGVFeHRlcm5hbCBtZXRob2QuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBhZGRXcml0ZUV4dGVybmFsKGJvb2xlYW4g\ncGFyZW50RGV0YWNoYWJsZSwKICAgICAgICBib29sZWFuIGRldGFjaGVkU3Rh\ndGUpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAg\nICAgICAgQ2xhc3NbXSBvdXRhcmdzID0gbmV3IENsYXNzW117IE9iamVjdE91\ndHB1dC5jbGFzcyB9OwogICAgICAgIEJDTWV0aG9kIG1ldGggPSBfcGMuZGVj\nbGFyZU1ldGhvZCgid3JpdGVFeHRlcm5hbCIsIHZvaWQuY2xhc3MsIG91dGFy\nZ3MpOwogICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gbWV0aC5nZXRFeGNl\ncHRpb25zKHRydWUpOwogICAgICAgIGV4Y2Vwcy5hZGRFeGNlcHRpb24oSU9F\neGNlcHRpb24uY2xhc3MpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGguZ2V0\nQ29kZSh0cnVlKTsKCiAgICAgICAgLy8gc3VwZXIud3JpdGVFeHRlcm5hbCAo\nb3V0KTsKICAgICAgICBDbGFzcyBzdXAgPSBnZXRUeXBlKF9tZXRhKS5nZXRT\ndXBlcmNsYXNzKCk7CiAgICAgICAgaWYgKCFwYXJlbnREZXRhY2hhYmxlICYm\nIEV4dGVybmFsaXphYmxlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oc3VwKSkg\newogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNlKGNvZGUsIGZhbHNl\nKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAg\nICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRNZXRob2Qoc3VwLCAi\nd3JpdGVFeHRlcm5hbCIsCiAgICAgICAgICAgICAgICB2b2lkLmNsYXNzLCBv\ndXRhcmdzKTsKICAgICAgICB9CgogICAgICAgIC8vIHdyaXRlVW5tYW5hZ2Vk\nIChvdXQpOwogICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZmFs\nc2UpOwogICAgICAgIGNvZGUuYWxvYWQoKS5zZXRQYXJhbSgwKTsKICAgICAg\nICBjb2RlLmludm9rZXZpcnR1YWwoKS5zZXRNZXRob2QoZ2V0VHlwZShfbWV0\nYSksCiAgICAgICAgICAgIFBSRSArICJXcml0ZVVubWFuYWdlZCIsIHZvaWQu\nY2xhc3MsIG91dGFyZ3MpOwoKICAgICAgICBKdW1wSW5zdHJ1Y3Rpb24gZ28y\nID0gbnVsbDsKICAgICAgICBpZiAoZGV0YWNoZWRTdGF0ZSkgewogICAgICAg\nICAgICAvLyBpZiAoc20gIT0gbnVsbCkKICAgICAgICAgICAgLy8gICBpZiAo\nc20ud3JpdGVEZXRhY2hlZCAob3V0KSkKICAgICAgICAgICAgLy8gICAgICBy\nZXR1cm47CiAgICAgICAgICAgIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwg\nZmFsc2UpOwogICAgICAgICAgICBjb2RlLmdldGZpZWxkKCkuc2V0RmllbGQo\nU00sIFNNVFlQRSk7CiAgICAgICAgICAgIElmSW5zdHJ1Y3Rpb24gaWZudWxs\nID0gY29kZS5pZm51bGwoKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJbnN0\nYW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuZ2V0ZmllbGQo\nKS5zZXRGaWVsZChTTSwgU01UWVBFKTsKICAgICAgICAgICAgY29kZS5hbG9h\nZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZWludGVy\nZmFjZSgpLnNldE1ldGhvZChTTVRZUEUsICJ3cml0ZURldGFjaGVkIiwKICAg\nICAgICAgICAgICAgIGJvb2xlYW4uY2xhc3MsIG91dGFyZ3MpOwogICAgICAg\nICAgICBnbzIgPSBjb2RlLmlmZXEoKTsKICAgICAgICAgICAgY29kZS52cmV0\ndXJuKCk7CgogICAgICAgICAgICAvLyBlbHNlCiAgICAgICAgICAgIC8vICAg\nb3V0LndyaXRlT2JqZWN0IChwY0dldERldGFjaGVkU3RhdGUgKCkpOwogICAg\nICAgICAgICBDbGFzc1tdIG9iamFyZ3MgPSBuZXcgQ2xhc3NbXXsgT2JqZWN0\nLmNsYXNzIH07CiAgICAgICAgICAgIGlmbnVsbC5zZXRUYXJnZXQoY29kZS5h\nbG9hZCgpLnNldFBhcmFtKDApKTsKICAgICAgICAgICAgbG9hZE1hbmFnZWRJ\nbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAgICAgIGNvZGUuaW52b2tl\ndmlydHVhbCgpLnNldE1ldGhvZChQUkUgKyAiR2V0RGV0YWNoZWRTdGF0ZSIs\nCiAgICAgICAgICAgICAgICBPYmplY3QuY2xhc3MsIG51bGwpOwogICAgICAg\nICAgICBjb2RlLmludm9rZWludGVyZmFjZSgpLnNldE1ldGhvZChPYmplY3RP\ndXRwdXQuY2xhc3MsCiAgICAgICAgICAgICAgICAid3JpdGVPYmplY3QiLCB2\nb2lkLmNsYXNzLCBvYmphcmdzKTsKICAgICAgICAgICAgLy8gICAgb3V0Lndy\naXRlT2JqZWN0IChudWxsKSAvLyBTdGF0ZU1hbmFnZXIKICAgICAgICAgICAg\nY29kZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgICAgICBjb2RlLmNv\nbnN0YW50KCkuc2V0VmFsdWUoKE9iamVjdCkgbnVsbCk7CiAgICAgICAgICAg\nIGNvZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1\ndC5jbGFzcywKICAgICAgICAgICAgICAgICJ3cml0ZU9iamVjdCIsIHZvaWQu\nY2xhc3MsIG9iamFyZ3MpOwogICAgICAgIH0KICAgICAgICBpZiAoZ28yICE9\nIG51bGwpCiAgICAgICAgICAgIGdvMi5zZXRUYXJnZXQoY29kZS5ub3AoKSk7\nCgogICAgICAgIC8vIHdyaXRlIG1hbmFnZWQgZmllbGRzCiAgICAgICAgRmll\nbGRNZXRhRGF0YVtdIGZtZHMgPSBfbWV0YS5nZXRGaWVsZHMoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspCiAgICAg\nICAgICAgIGlmICghZm1kc1tpXS5pc1RyYW5zaWVudCgpKQogICAgICAgICAg\nICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmbWRzW2ldLmdldE5hbWUoKSwK\nICAgICAgICAgICAgICAgICAgICBmbWRzW2ldLmdldERlY2xhcmVkVHlwZSgp\nLCBmbWRzW2ldKTsKCiAgICAgICAgLy8gcmV0dXJuCiAgICAgICAgY29kZS52\ncmV0dXJuKCk7CiAgICAgICAgY29kZS5jYWxjdWxhdGVNYXhTdGFjaygpOwog\nICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4TG9jYWxzKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBXcml0ZSB1bm1hbmFnZWQgZmllbGRzIHRvIHRoZSBzdHJl\nYW0gKHBjV3JpdGVVbm1hbmFnZWQpLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYWRkV3JpdGVVbm1hbmFnZWQoQ29sbGVjdGlvbiB1bm1nZCwgYm9vbGVh\nbiBwYXJlbnREZXRhY2hhYmxlKQogICAgICAgIHRocm93cyBOb1N1Y2hNZXRo\nb2RFeGNlcHRpb24gewogICAgICAgIENsYXNzW10gb3V0YXJncyA9IG5ldyBD\nbGFzc1tdeyBPYmplY3RPdXRwdXQuY2xhc3MgfTsKICAgICAgICBCQ01ldGhv\nZCBtZXRoID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIldyaXRlVW5tYW5h\nZ2VkIiwgdm9pZC5jbGFzcywKICAgICAgICAgICAgb3V0YXJncyk7CiAgICAg\nICAgbWV0aC5tYWtlUHJvdGVjdGVkKCk7CiAgICAgICAgRXhjZXB0aW9ucyBl\neGNlcHMgPSBtZXRoLmdldEV4Y2VwdGlvbnModHJ1ZSk7CiAgICAgICAgZXhj\nZXBzLmFkZEV4Y2VwdGlvbihJT0V4Y2VwdGlvbi5jbGFzcyk7CiAgICAgICAg\nQ29kZSBjb2RlID0gbWV0aC5nZXRDb2RlKHRydWUpOwoKICAgICAgICAvLyBz\ndXBlci53cml0ZVVubWFuYWdlZCAob3V0KTsKICAgICAgICBpZiAocGFyZW50\nRGV0YWNoYWJsZSkgewogICAgICAgICAgICBsb2FkTWFuYWdlZEluc3RhbmNl\nKGNvZGUsIGZhbHNlKTsKICAgICAgICAgICAgY29kZS5hbG9hZCgpLnNldFBh\ncmFtKDApOwogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoZ2V0VHlwZShfbWV0YS4KICAgICAgICAgICAgICAgIGdldFBDU3Vw\nZXJjbGFzc01ldGFEYXRhKCkpLCBQUkUgKyAiV3JpdGVVbm1hbmFnZWQiLCB2\nb2lkLmNsYXNzLCAKICAgICAgICAgICAgICAgIG91dGFyZ3MpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gd3JpdGUgZGVjbGFyZWQgdW5tYW5hZ2VkIHNlcmlh\nbGl6YWJsZSBmaWVsZHMKICAgICAgICBCQ0ZpZWxkIGZpZWxkOwogICAgICAg\nIGZvciAoSXRlcmF0b3IgaXRyID0gdW5tZ2QuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgZmllbGQgPSAoQkNGaWVsZCkgaXRy\nLm5leHQoKTsKICAgICAgICAgICAgd3JpdGVFeHRlcm5hbChjb2RlLCBmaWVs\nZC5nZXROYW1lKCksIGZpZWxkLmdldFR5cGUoKSwgbnVsbCk7CiAgICAgICAg\nfQogICAgICAgIGNvZGUudnJldHVybigpOwogICAgICAgIGNvZGUuY2FsY3Vs\nYXRlTWF4U3RhY2soKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2Fs\ncygpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byB3\ncml0ZSBhIGZpZWxkIHRvIGFuIGV4dGVybmFsaXphdGlvbiBvdXRwdXQgc3Ry\nZWFtLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgd3JpdGVFeHRlcm5hbChD\nb2RlIGNvZGUsIFN0cmluZyBmaWVsZE5hbWUsIENsYXNzIHR5cGUsCiAgICAg\nICAgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhyb3dzIE5vU3VjaE1l\ndGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1ldGhOYW1lOwogICAg\nICAgIGlmICh0eXBlLmlzUHJpbWl0aXZlKCkpIHsKICAgICAgICAgICAgbWV0\naE5hbWUgPSB0eXBlLmdldE5hbWUoKTsKICAgICAgICAgICAgbWV0aE5hbWUg\nPSBtZXRoTmFtZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoTG9jYWxl\nLkVOR0xJU0gpCiAgICAgICAgICAgICAgICArIG1ldGhOYW1lLnN1YnN0cmlu\nZygxKTsKICAgICAgICAgICAgbWV0aE5hbWUgPSAid3JpdGUiICsgbWV0aE5h\nbWU7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIG1ldGhOYW1lID0gIndy\naXRlT2JqZWN0IjsKCiAgICAgICAgLy8gb3V0LndyaXRlPHR5cGU+ICg8Zmll\nbGQ+KTsKICAgICAgICBjb2RlLmFsb2FkKCkuc2V0UGFyYW0oMCk7CiAgICAg\nICAgbG9hZE1hbmFnZWRJbnN0YW5jZShjb2RlLCBmYWxzZSk7CiAgICAgICAg\naWYgKGZtZCA9PSBudWxsKQogICAgICAgICAgICBnZXRmaWVsZChjb2RlLCBu\ndWxsLCBmaWVsZE5hbWUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgYWRk\nR2V0TWFuYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQpOwogICAgICAgIENsYXNz\nW10gYXJncyA9IG5ldyBDbGFzc1tdeyB0eXBlIH07CiAgICAgICAgaWYgKHR5\ncGUgPT0gYnl0ZS5jbGFzcyB8fCB0eXBlID09IGNoYXIuY2xhc3MgfHwgdHlw\nZSA9PSBzaG9ydC5jbGFzcykKICAgICAgICAgICAgYXJnc1swXSA9IGludC5j\nbGFzczsKICAgICAgICBlbHNlIGlmICghdHlwZS5pc1ByaW1pdGl2ZSgpKQog\nICAgICAgICAgICBhcmdzWzBdID0gT2JqZWN0LmNsYXNzOwogICAgICAgIGNv\nZGUuaW52b2tlaW50ZXJmYWNlKCkuc2V0TWV0aG9kKE9iamVjdE91dHB1dC5j\nbGFzcywgbWV0aE5hbWUsCiAgICAgICAgICAgIHZvaWQuY2xhc3MsIGFyZ3Mp\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBhZGRHZXRNYW5hZ2VkVmFsdWVD\nb2RlKENvZGUgY29kZSwgRmllbGRNZXRhRGF0YSBmbWQpCiAgICAgICAgdGhy\nb3dzIE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiB7CiAgICAgICAgYWRkR2V0TWFu\nYWdlZFZhbHVlQ29kZShjb2RlLCBmbWQsIHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogTG9hZCB0aGUgZmllbGQgdmFsdWUgc3BlY2lmaWVkIGJ5IDxj\nb2RlPmZtZDwvY29kZT4gb250byB0aGUgc3RhY2suCiAgICAgKiBCZWZvcmUg\ndGhpcyBtZXRob2QgaXMgY2FsbGVkLCB0aGUgb2JqZWN0IHRoYXQgdGhlIGRh\ndGEgc2hvdWxkIGJlIGxvYWRlZAogICAgICogZnJvbSB3aWxsIGJlIG9uIHRo\nZSB0b3Agb2YgdGhlIHN0YWNrLgogICAgICoKICAgICAqIEBwYXJhbSBmcm9t\nU2FtZUNsYXNzIGlmIDxjb2RlPnRydWU8L2NvZGU+LCB0aGVuIDxjb2RlPmZt\nZDwvY29kZT4gaXMKICAgICAqIGJlaW5nIGxvYWRlZCBmcm9tIGFuIGluc3Rh\nbmNlIG9mIHRoZSBzYW1lIGNsYXNzIGFzIHRoZSBjdXJyZW50IGV4ZWN1dGlv\nbgogICAgICogY29udGV4dC4gSWYgPGNvZGU+ZmFsc2U8L2NvZGU+LCB0aGVu\nIHRoZSBpbnN0YW5jZSBvbiB0aGUgdG9wIG9mIHRoZSBzdGFjawogICAgICog\nbWlnaHQgYmUgYSBzdXBlcmNsYXNzIG9mIHRoZSBjdXJyZW50IGV4ZWN1dGlv\nbiBjb250ZXh0J3MgJ3RoaXMnIGluc3RhbmNlLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgYWRkR2V0TWFuYWdlZFZhbHVlQ29kZShDb2RlIGNvZGUsIEZp\nZWxkTWV0YURhdGEgZm1kLAogICAgICAgIGJvb2xlYW4gZnJvbVNhbWVDbGFz\ncykKICAgICAgICB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBpZiByZWRlZmluaW5nLCB0aGVuIHdlIG11c3QgYWx3YXlzIHJl\nZmxlY3QgKG9yIGFjY2VzcyB0aGUgZmllbGQKICAgICAgICAvLyBkaXJlY3Rs\neSBpZiBhY2Nlc3NpYmxlKSwgc2luY2UgdGhlIHJlZGVmaW5lZCBtZXRob2Rz\nIHdpbGwgYWx3YXlzCiAgICAgICAgLy8gdHJpZ2dlciBtZXRob2QgY2FsbHMg\ndG8gU3RhdGVNYW5hZ2VyLCBldmVuIGZyb20gaW50ZXJuYWwgZGlyZWN0LQog\nICAgICAgIC8vIGFjY2VzcyB1c2FnZS4gV2UgY291bGQgd29yayBhcm91bmQg\ndGhpcyBieSBub3QgcmVkZWZpbmluZywgYW5kCiAgICAgICAgLy8ganVzdCBk\nbyBhIHN1YmNsYXNzIGFwcHJvYWNoIGluc3RlYWQuIEJ1dCB0aGlzIGlzIG5v\ndCBhIGdvb2Qgb3B0aW9uLAogICAgICAgIC8vIHNpbmNlIGl0IHdvdWxkIHNh\nY3JpZmljZSBsYXp5IGxvYWRpbmcgYW5kIGVmZmljaWVudCBkaXJ0eSB0cmFj\na2luZy4KCiAgICAgICAgaWYgKGdldFJlZGVmaW5lKCkgfHwgaXNGaWVsZEFj\nY2VzcyhmbWQpKSB7CiAgICAgICAgICAgIGdldGZpZWxkKGNvZGUsIG51bGws\nIGZtZC5nZXROYW1lKCkpOwogICAgICAgIH0gZWxzZSBpZiAoZ2V0Q3JlYXRl\nU3ViY2xhc3MoKSkgewogICAgICAgICAgICAvLyBwcm9wZXJ0eSBhY2Nlc3Ms\nIGFuZCB3ZSdyZSBub3QgcmVkZWZpbmluZy4gSWYgd2UncmUgb3BlcmF0aW5n\nCiAgICAgICAgICAgIC8vIG9uIGFuIGluc3RhbmNlIHRoYXQgaXMgZGVmaW5p\ndGVseSB0aGUgc2FtZSB0eXBlIGFzICd0aGlzJywgdGhlbgogICAgICAgICAg\nICAvLyBjYWxsIHN1cGVyY2xhc3MgbWV0aG9kIHRvIGJ5cGFzcyB0cmFja2lu\nZy4gT3RoZXJ3aXNlLCByZWZsZWN0CiAgICAgICAgICAgIC8vIHRvIGJvdGgg\nYnlwYXNzIHRyYWNraW5nIGFuZCBhdm9pZCBjbGFzcyB2ZXJpZmljYXRpb24g\nZXJyb3JzLgogICAgICAgICAgICBpZiAoZnJvbVNhbWVDbGFzcykgewogICAg\nICAgICAgICAgICAgTWV0aG9kIG1ldGggPSAoTWV0aG9kKSBmbWQuZ2V0QmFj\na2luZ01lbWJlcigpOwogICAgICAgICAgICAgICAgY29kZS5pbnZva2VzcGVj\naWFsKCkuc2V0TWV0aG9kKG1ldGgpOwogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgZ2V0ZmllbGQoY29kZSwgbnVsbCwgZm1kLmdldE5h\nbWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAvLyByZWd1bGFyIGVuaGFuY2VtZW50ICsgcHJvcGVydHkgYWNjZXNz\nCiAgICAgICAgICAgIE1ldGhvZCBtZXRoID0gKE1ldGhvZCkgZm1kLmdldEJh\nY2tpbmdNZW1iZXIoKTsKICAgICAgICAgICAgY29kZS5pbnZva2V2aXJ0dWFs\nKCkuc2V0TWV0aG9kKFBSRSArIG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAg\nICAgICAgbWV0aC5nZXRSZXR1cm5UeXBlKCksIG1ldGguZ2V0UGFyYW1ldGVy\nVHlwZXMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3Rv\ncmUgdGhlIHZhbHVlIGF0IHRoZSB0b3Agb2YgdGhlIHN0YWNrIGludG8gdGhl\nIGZpZWxkIHZhbHVlIHNwZWNpZmllZAogICAgICogYnkgPGNvZGU+Zm1kPC9j\nb2RlPi4gQmVmb3JlIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCwgdGhlIGRhdGEg\ndG8gbG9hZCB3aWxsCiAgICAgKiBiZSBvbiB0aGUgdG9wIG9mIHRoZSBzdGFj\nayBhbmQgdGhlIG9iamVjdCB0aGF0IHRoZSBkYXRhIHNob3VsZCBiZSBsb2Fk\nZWQKICAgICAqIGludG8gd2lsbCBiZSBzZWNvbmQgaW4gdGhlIHN0YWNrLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYWRkU2V0TWFuYWdlZFZhbHVlQ29k\nZShDb2RlIGNvZGUsIEZpZWxkTWV0YURhdGEgZm1kKQogICAgICAgIHRocm93\ncyBOb1N1Y2hNZXRob2RFeGNlcHRpb24gewogICAgICAgIC8vIGlmIHJlZGVm\naW5pbmcsIHRoZW4gd2UgbXVzdCBhbHdheXMgcmVmbGVjdCAob3IgYWNjZXNz\nIHRoZSBmaWVsZAogICAgICAgIC8vIGRpcmVjdGx5IGlmIGFjY2Vzc2libGUp\nLCBzaW5jZSB0aGUgcmVkZWZpbmVkIG1ldGhvZHMgd2lsbCBhbHdheXMKICAg\nICAgICAvLyB0cmlnZ2VyIG1ldGhvZCBjYWxscyB0byBTdGF0ZU1hbmFnZXIs\nIGV2ZW4gZnJvbSBpbnRlcm5hbCBkaXJlY3QtCiAgICAgICAgLy8gYWNjZXNz\nIHVzYWdlLiBXZSBjb3VsZCB3b3JrIGFyb3VuZCB0aGlzIGJ5IG5vdCByZWRl\nZmluaW5nLCBhbmQKICAgICAgICAvLyBqdXN0IGRvIGEgc3ViY2xhc3MgYXBw\ncm9hY2ggaW5zdGVhZC4gQnV0IHRoaXMgaXMgbm90IGEgZ29vZCBvcHRpb24s\nCiAgICAgICAgLy8gc2luY2UgaXQgd291bGQgc2FjcmlmaWNlIGxhenkgbG9h\nZGluZyBhbmQgZWZmaWNpZW50IGRpcnR5IHRyYWNraW5nLgoKICAgICAgICBp\nZiAoZ2V0UmVkZWZpbmUoKSB8fCBpc0ZpZWxkQWNjZXNzKGZtZCkpIHsKICAg\nICAgICAgICAgcHV0ZmllbGQoY29kZSwgbnVsbCwgZm1kLmdldE5hbWUoKSwg\nZm1kLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICB9IGVsc2UgaWYgKGdl\ndENyZWF0ZVN1YmNsYXNzKCkpIHsKICAgICAgICAgICAgLy8gcHJvcGVydHkg\nYWNjZXNzLCBhbmQgd2UncmUgbm90IHJlZGVmaW5pbmcuIGludm9rZSB0aGUK\nICAgICAgICAgICAgLy8gc3VwZXJjbGFzcyBtZXRob2QgdG8gYnlwYXNzIHRy\nYWNraW5nLgogICAgICAgICAgICBjb2RlLmludm9rZXNwZWNpYWwoKS5zZXRN\nZXRob2QoX21hbmFnZWRUeXBlLmdldFR5cGUoKSwKICAgICAgICAgICAgICAg\nIGdldFNldHRlck5hbWUoZm1kKSwgdm9pZC5jbGFzcywKICAgICAgICAgICAg\nICAgIG5ldyBDbGFzc1tdIHsgZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHJlZ3VsYXIgZW5oYW5j\nZW1lbnQgKyBwcm9wZXJ0eSBhY2Nlc3MKICAgICAgICAgICAgY29kZS5pbnZv\na2V2aXJ0dWFsKCkuc2V0TWV0aG9kKFBSRSArIGdldFNldHRlck5hbWUoZm1k\nKSwKICAgICAgICAgICAgICAgIHZvaWQuY2xhc3MsIG5ldyBDbGFzc1tdIHsg\nZm1kLmdldERlY2xhcmVkVHlwZSgpIH0pOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEFkZCB0aGUge0BsaW5rIEluc3RydWN0aW9ufXMgdG8g\nbG9hZCB0aGUgaW5zdGFuY2UgdG8gbW9kaWZ5IG9udG8gdGhlCiAgICAgKiBz\ndGFjaywgYW5kIHJldHVybiBpdC4gSWYgPGNvZGU+Zm9yU3RhdGljPC9jb2Rl\nPiBpcyBzZXQsIHRoZW4KICAgICAqIDxjb2RlPmNvZGU8L2NvZGU+IGlzIGlu\nIGFuIGFjY2Vzc29yIG1ldGhvZCBvciBhbm90aGVyIHN0YXRpYyBtZXRob2Q7\nCiAgICAgKiBvdGhlcndpc2UsIGl0IGlzIGluIG9uZSBvZiB0aGUgUEMtc3Bl\nY2lmaWVkIG1ldGhvZHMuCiAgICAgKgogICAgICogQHJldHVybiB0aGUgZmly\nc3QgaW5zdHJ1Y3Rpb24gYWRkZWQgdG8gPGNvZGU+Y29kZTwvY29kZT4uCiAg\nICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24gbG9hZE1hbmFnZWRJbnN0\nYW5jZShDb2RlIGNvZGUsIGJvb2xlYW4gZm9yU3RhdGljLAogICAgICAgICAg\nICBGaWVsZE1ldGFEYXRhIGZtZCkgewogICAgICAgIGlmIChmb3JTdGF0aWMg\nJiYgaXNGaWVsZEFjY2VzcyhmbWQpKQogICAgICAgICAgICByZXR1cm4gY29k\nZS5hbG9hZCgpLnNldFBhcmFtKDApOwogICAgICAgIHJldHVybiBjb2RlLmFs\nb2FkKCkuc2V0VGhpcygpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHRo\nZSB7QGxpbmsgSW5zdHJ1Y3Rpb259cyB0byBsb2FkIHRoZSBpbnN0YW5jZSB0\nbyBtb2RpZnkgb250byB0aGUKICAgICAqIHN0YWNrLCBhbmQgcmV0dXJuIGl0\nLiAgVGhpcyBtZXRob2Qgc2hvdWxkIG5vdCBiZSB1c2VkIHRvIGxvYWQgc3Rh\ndGljCiAgICAgKiBmaWVsZHMuCiAgICAgKgogICAgICogQHJldHVybiB0aGUg\nZmlyc3QgaW5zdHJ1Y3Rpb24gYWRkZWQgdG8gPGNvZGU+Y29kZTwvY29kZT4u\nCiAgICAgKi8KICAgIHByaXZhdGUgSW5zdHJ1Y3Rpb24gbG9hZE1hbmFnZWRJ\nbnN0YW5jZShDb2RlIGNvZGUsIGJvb2xlYW4gZm9yU3RhdGljKSB7CiAgICAJ\ncmV0dXJuIGxvYWRNYW5hZ2VkSW5zdGFuY2UoY29kZSwgZm9yU3RhdGljLCBu\ndWxsKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgZ2V0QWNjZXNzb3JQ\nYXJhbWV0ZXJPZmZzZXQoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgIHJl\ndHVybiBpc0ZpZWxkQWNjZXNzKGZtZCkgPyAxIDogMDsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFmZmlybXMgaWYgdGhlIGdpdmVuIGNsYXNzIGlzIHVzaW5n\nIGZpZWxkLWJhc2VkIGFjY2Vzcy4KICAgICAqLwogICAgYm9vbGVhbiBpc1By\nb3BlcnR5QWNjZXNzKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgCXJldHVy\nbiBtZXRhICE9IG51bGwgJiYgKG1ldGEuaXNNaXhlZEFjY2VzcygpIHx8IAog\nICAgCQlBY2Nlc3NDb2RlLmlzUHJvcGVydHkobWV0YS5nZXRBY2Nlc3NUeXBl\nKCkpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBBZmZpcm1zIGlmIHRo\nZSBnaXZlbiBmaWVsZCBpcyB1c2luZyBmaWVsZC1iYXNlZCBhY2Nlc3MuCiAg\nICAgKi8KICAgIGJvb2xlYW4gaXNQcm9wZXJ0eUFjY2VzcyhGaWVsZE1ldGFE\nYXRhIGZtZCkgewogICAgCXJldHVybiBmbWQgIT0gbnVsbCAmJiBBY2Nlc3ND\nb2RlLmlzUHJvcGVydHkoZm1kLmdldEFjY2Vzc1R5cGUoKSk7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogQWZmaXJtcyBpZiB0aGUgZ2l2ZW4gZmllbGQg\naXMgdXNpbmcgbWV0aG9kLWJhc2VkIGFjY2Vzcy4KICAgICAqLwogICAgYm9v\nbGVhbiBpc0ZpZWxkQWNjZXNzKEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAJ\ncmV0dXJuIGZtZCAhPSBudWxsICYmIEFjY2Vzc0NvZGUuaXNGaWVsZChmbWQu\nZ2V0QWNjZXNzVHlwZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0\nZSB0aGUgZ2VuZXJhdGVkIGdldHRlciB7QGxpbmsgQkNNZXRob2R9IGZvciA8\nY29kZT5mbWQ8L2NvZGU+LiBUaGUKICAgICAqIGNhbGxpbmcgZW52aXJvbm1l\nbnQgd2lsbCB0aGVuIHBvcHVsYXRlIHRoaXMgbWV0aG9kJ3MgY29kZSBibG9j\nay4KICAgICAqLwogICAgcHJpdmF0ZSBCQ01ldGhvZCBjcmVhdGVHZXRNZXRo\nb2QoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBCQ01ldGhvZCBnZXR0\nZXI7CiAgICAgICAgaWYgKGlzRmllbGRBY2Nlc3MoZm1kKSkgewogICAgICAg\nICAgICAvLyBzdGF0aWMgPGZpZWxkdHlwZT4gcGNHZXQ8ZmllbGQ+IChYWFgg\naW5zdCkKICAgICAgICAgICAgQkNGaWVsZCBmaWVsZCA9IF9wYy5nZXREZWNs\nYXJlZEZpZWxkKGZtZC5nZXROYW1lKCkpOwogICAgICAgICAgICBnZXR0ZXIg\nPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUgKyAiR2V0IiArIGZtZC5nZXROYW1l\nKCksIGZtZC4KICAgICAgICAgICAgICAgIGdldERlY2xhcmVkVHlwZSgpLmdl\ndE5hbWUoKSwgbmV3IFN0cmluZ1tdeyBfcGMuZ2V0TmFtZSgpIH0pOwogICAg\nICAgICAgICBnZXR0ZXIuc2V0QWNjZXNzRmxhZ3MoZmllbGQuZ2V0QWNjZXNz\nRmxhZ3MoKQogICAgICAgICAgICAgICAgJiB+Q29uc3RhbnRzLkFDQ0VTU19U\nUkFOU0lFTlQgJiB+Q29uc3RhbnRzLkFDQ0VTU19WT0xBVElMRSk7CiAgICAg\nICAgICAgIGdldHRlci5zZXRTdGF0aWModHJ1ZSk7CiAgICAgICAgICAgIGdl\ndHRlci5zZXRGaW5hbCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIGdldHRl\ncjsKICAgICAgICB9CgogICAgICAgIC8vIHByb3BlcnR5IGFjY2VzczoKICAg\nICAgICAvLyBjb3B5IHRoZSB1c2VyJ3MgZ2V0dGVyIG1ldGhvZCB0byBhIG5l\ndyBuYW1lOyB3ZSBjYW4ndCBqdXN0IHJlc2V0CiAgICAgICAgLy8gdGhlIG5h\nbWUsIGJlY2F1c2UgdGhhdCB3aWxsIGFsc28gcmVzZXQgYWxsIGNhbGxzIHRv\nIHRoZSBtZXRob2QKICAgICAgICBNZXRob2QgbWV0aCA9IChNZXRob2QpIGZt\nZC5nZXRCYWNraW5nTWVtYmVyKCk7CiAgICAgICAgZ2V0dGVyID0gX3BjLmdl\ndERlY2xhcmVkTWV0aG9kKG1ldGguZ2V0TmFtZSgpLAogICAgICAgICAgICBt\nZXRoLmdldFBhcmFtZXRlclR5cGVzKCkpOwogICAgICAgIEJDTWV0aG9kIG5l\nd2dldHRlciA9IF9wYy5kZWNsYXJlTWV0aG9kKFBSRSArIG1ldGguZ2V0TmFt\nZSgpLAogICAgICAgICAgICBtZXRoLmdldFJldHVyblR5cGUoKSwgbWV0aC5n\nZXRQYXJhbWV0ZXJUeXBlcygpKTsKICAgICAgICBuZXdnZXR0ZXIuc2V0QWNj\nZXNzRmxhZ3MoZ2V0dGVyLmdldEFjY2Vzc0ZsYWdzKCkpOwogICAgICAgIG5l\nd2dldHRlci5tYWtlUHJvdGVjdGVkKCk7IAogICAgICAgIHRyYW5zZmVyQ29k\nZUF0dHJpYnV0ZXMoZ2V0dGVyLCBuZXdnZXR0ZXIpOwogICAgICAgIHJldHVy\nbiBnZXR0ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgdGhlIGdl\nbmVyYXRlZCBzZXR0ZXIge0BsaW5rIEJDTWV0aG9kfSBmb3IgPGNvZGU+Zm1k\nPC9jb2RlPi4gVGhlCiAgICAgKiBjYWxsaW5nIGVudmlyb25tZW50IHdpbGwg\ndGhlbiBwb3B1bGF0ZSB0aGlzIG1ldGhvZCdzIGNvZGUgYmxvY2suCiAgICAg\nKi8KICAgIHByaXZhdGUgQkNNZXRob2QgY3JlYXRlU2V0TWV0aG9kKEZpZWxk\nTWV0YURhdGEgZm1kKSB7CiAgICAgICAgQkNNZXRob2Qgc2V0dGVyOwogICAg\nICAgIGlmIChpc0ZpZWxkQWNjZXNzKGZtZCkpIHsKICAgICAgICAgICAgLy8g\nc3RhdGljIHZvaWQgcGNTZXQ8ZmllbGQ+IChYWFggaW5zdCwgPGZpZWxkdHlw\nZT4gdmFsdWUpCiAgICAgICAgICAgIEJDRmllbGQgZmllbGQgPSBfcGMuZ2V0\nRGVjbGFyZWRGaWVsZChmbWQuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgc2V0\ndGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsgIlNldCIgKyBmbWQuZ2V0\nTmFtZSgpLCB2b2lkLmNsYXNzLAogICAgICAgICAgICAgICAgbmV3IENsYXNz\nW117IGdldFR5cGUoX21ldGEpLCBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7\nCiAgICAgICAgICAgIHNldHRlci5zZXRBY2Nlc3NGbGFncyhmaWVsZC5nZXRB\nY2Nlc3NGbGFncygpCiAgICAgICAgICAgICAgICAmIH5Db25zdGFudHMuQUND\nRVNTX1RSQU5TSUVOVCAmIH5Db25zdGFudHMuQUNDRVNTX1ZPTEFUSUxFKTsK\nICAgICAgICAgICAgc2V0dGVyLnNldFN0YXRpYyh0cnVlKTsKICAgICAgICAg\nICAgc2V0dGVyLnNldEZpbmFsKHRydWUpOwogICAgICAgICAgICByZXR1cm4g\nc2V0dGVyOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvcGVydHkgYWNjZXNz\nOgogICAgICAgIC8vIGNvcHkgdGhlIHVzZXIncyBnZXR0ZXIgbWV0aG9kIHRv\nIGEgbmV3IG5hbWU7IHdlIGNhbid0IGp1c3QgcmVzZXQKICAgICAgICAvLyB0\naGUgbmFtZSwgYmVjYXVzZSB0aGF0IHdpbGwgYWxzbyByZXNldCBhbGwgY2Fs\nbHMgdG8gdGhlIG1ldGhvZAogICAgICAgIHNldHRlciA9IF9wYy5nZXREZWNs\nYXJlZE1ldGhvZChnZXRTZXR0ZXJOYW1lKGZtZCksCiAgICAgICAgICAgIG5l\ndyBDbGFzc1tdeyBmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgfSk7CiAgICAgICAg\nQkNNZXRob2QgbmV3c2V0dGVyID0gX3BjLmRlY2xhcmVNZXRob2QoUFJFICsg\nc2V0dGVyLmdldE5hbWUoKSwKICAgICAgICAgICAgc2V0dGVyLmdldFJldHVy\nbk5hbWUoKSwgc2V0dGVyLmdldFBhcmFtTmFtZXMoKSk7CiAgICAgICAgbmV3\nc2V0dGVyLnNldEFjY2Vzc0ZsYWdzKHNldHRlci5nZXRBY2Nlc3NGbGFncygp\nKTsKICAgICAgICBuZXdzZXR0ZXIubWFrZVByb3RlY3RlZCgpOwogICAgICAg\nIHRyYW5zZmVyQ29kZUF0dHJpYnV0ZXMoc2V0dGVyLCBuZXdzZXR0ZXIpOwog\nICAgICAgIHJldHVybiBzZXR0ZXI7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGFkZEdldEVuaGFuY2VtZW50Q29udHJhY3RWZXJzaW9uTWV0aG9kKCkgewog\nICAgICAgIC8vIHB1YmxpYyBpbnQgZ2V0RW5oYW5jZW1lbnRDb250cmFjdFZl\ncnNpb24oKQogICAgICAgIEJDTWV0aG9kIG1ldGhvZCA9IF9wYy5kZWNsYXJl\nTWV0aG9kKFBSRSArIAogICAgICAgICAgICAgICAgIkdldEVuaGFuY2VtZW50\nQ29udHJhY3RWZXJzaW9uIiwgaW50LmNsYXNzLCBudWxsKTsKICAgICAgICBt\nZXRob2QubWFrZVB1YmxpYygpOwogICAgICAgIENvZGUgY29kZSA9IG1ldGhv\nZC5nZXRDb2RlKHRydWUpOwogICAgICAgIGNvZGUuY29uc3RhbnQoKS5zZXRW\nYWx1ZShFTkhBTkNFUl9WRVJTSU9OKTsKICAgICAgICBjb2RlLmlyZXR1cm4o\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heFN0YWNrKCk7CiAgICAgICAg\nY29kZS5jYWxjdWxhdGVNYXhMb2NhbHMoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgY29uY3JldGUgdHlwZSBmb3IgdGhlIGdpdmVuIGNs\nYXNzLCBpLmUuIGltcGwgZm9yIG1hbmFnZWQKICAgICAqIGludGVyZmFjZXMK\nICAgICAqLwogICAgcHVibGljIENsYXNzIGdldFR5cGUoQ2xhc3NNZXRhRGF0\nYSBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEuZ2V0SW50ZXJmYWNlSW1wbCgp\nICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBtZXRhLmdldEludGVyZmFj\nZUltcGwoKTsKICAgICAgICByZXR1cm4gbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNb3ZlIGNvZGUtcmVsYXRlZCBh\ndHRyaWJ1dGVzIGZyb20gb25lIG1ldGhvZCB0byBhbm90aGVyLgogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHRyYW5zZmVyQ29kZUF0dHJpYnV0\nZXMoQkNNZXRob2QgZnJvbSwgQkNNZXRob2QgdG8pIHsKICAgICAgICBDb2Rl\nIGNvZGUgPSBmcm9tLmdldENvZGUoZmFsc2UpOwogICAgICAgIGlmIChjb2Rl\nICE9IG51bGwpIHsKICAgICAgICAgICAgdG8uYWRkQXR0cmlidXRlKGNvZGUp\nOwogICAgICAgICAgICBmcm9tLnJlbW92ZUNvZGUoKTsKICAgICAgICB9Cgog\nICAgICAgIEV4Y2VwdGlvbnMgZXhjZXBzID0gZnJvbS5nZXRFeGNlcHRpb25z\nKGZhbHNlKTsKICAgICAgICBpZiAoZXhjZXBzICE9IG51bGwpCiAgICAgICAg\nICAgIHRvLmFkZEF0dHJpYnV0ZShleGNlcHMpOwogICAgfQoKICAgIC8qKgog\nICAgICogVXNhZ2U6IGphdmEgb3JnLmFwYWNoZS5vcGVuanBhLmVuaGFuY2Uu\nUENFbmhhbmNlciBbb3B0aW9uXSoKICAgICAqICZsdDtjbGFzcyBuYW1lIHwg\nLmphdmEgZmlsZSB8IC5jbGFzcyBmaWxlIHwgLmpkbyBmaWxlJmd0OysKICAg\nICAqICBXaGVyZSB0aGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIHJlY29nbml6\nZWQuCiAgICAgKiA8dWw+CiAgICAgKiA8bGk+PGk+LXByb3BlcnRpZXMvLXAg\nJmx0O3Byb3BlcnRpZXMgZmlsZSZndDs8L2k+OiBUaGUgcGF0aCB0byBhIE9w\nZW5KUEEKICAgICAqIHByb3BlcnRpZXMgZmlsZSBjb250YWluaW5nIGluZm9y\nbWF0aW9uIGFzIG91dGxpbmVkIGluCiAgICAgKiB7QGxpbmsgQ29uZmlndXJh\ndGlvbn07IG9wdGlvbmFsLjwvbGk+CiAgICAgKiA8bGk+PGk+LSZsdDtwcm9w\nZXJ0eSBuYW1lJmd0OyAmbHQ7cHJvcGVydHkgdmFsdWUmZ3Q7PC9pPjogQWxs\nIGJlYW4KICAgICAqIHByb3BlcnRpZXMgb2YgdGhlIHN0YW5kYXJkIE9wZW5K\nUEEge0BsaW5rIE9wZW5KUEFDb25maWd1cmF0aW9ufSBjYW4gYmUKICAgICAq\nIHNldCBieSB1c2luZyB0aGVpciBuYW1lcyBhbmQgc3VwcGx5aW5nIGEgdmFs\ndWU7IGZvciBleGFtcGxlOgogICAgICogPGxpPjxpPi1kaXJlY3RvcnkvLWQg\nJmx0O2J1aWxkIGRpcmVjdG9yeSZndDs8L2k+OiBUaGUgcGF0aCB0byB0aGUg\nYmFzZQogICAgICogZGlyZWN0b3J5IHdoZXJlIGVuaGFuY2VkIGNsYXNzZXMg\nYXJlIHN0b3JlZC4gQnkgZGVmYXVsdCwgdGhlCiAgICAgKiBlbmhhbmNlciBv\ndmVyd3JpdGVzIHRoZSBvcmlnaW5hbCAuY2xhc3MgZmlsZSB3aXRoIHRoZSBl\nbmhhbmNlZAogICAgICogdmVyc2lvbi4gVXNlIHRoaXMgb3B0aW9uIHRvIHN0\nb3JlIHRoZSBnZW5lcmF0ZWQgLmNsYXNzIGZpbGUgaW4KICAgICAqIGFub3Ro\nZXIgZGlyZWN0b3J5LiBUaGUgcGFja2FnZSBzdHJ1Y3R1cmUgd2lsbCBiZSBj\ncmVhdGVkIGJlbmVhdGgKICAgICAqIHRoZSBnaXZlbiBkaXJlY3RvcnkuPC9s\naT4KICAgICAqIDxsaT48aT4tYWRkRGVmYXVsdENvbnN0cnVjdG9yLy1hZGMg\nW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjogV2hldGhlciB0bwogICAgICogYWRk\nIGEgZGVmYXVsdCBjb25zdHJ1Y3RvciB0byBwZXJzaXN0ZW50IGNsYXNzZXMg\nbWlzc2luZyBvbmUsIGFzCiAgICAgKiBvcHBvc2VkIHRvIHRocm93aW5nIGFu\nIGV4Y2VwdGlvbi4gRGVmYXVsdHMgdG8gdHJ1ZS48L2xpPgogICAgICogPGxp\nPjxpPi10bXBDbGFzc0xvYWRlci8tdGNsIFt0cnVlL3QgfCBmYWxzZS9mXTwv\naT46IFdoZXRoZXIgdG8KICAgICAqIGxvYWQgdGhlIHByZS1lbmhhbmNlZCBj\nbGFzc2VzIHVzaW5nIGEgdGVtcG9yYXJ5IGNsYXNzIGxvYWRlci4KICAgICAq\nIERlZmF1bHRzIHRvIHRydWUuIFNldCB0aGlzIHRvIGZhbHNlIHdoZW4gYXR0\nZW1wdGluZyB0byBkZWJ1ZwogICAgICogY2xhc3MgbG9hZGluZyBlcnJvcnMu\nPC9saT4KICAgICAqIDxsaT48aT4tZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rp\nb25zLy1lcHIgW3RydWUvdCB8IGZhbHNlL2ZdPC9pPjoKICAgICAqIFdoZXRo\nZXIgdG8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgUFJPUEVSVFkgYWNjZXNz\nIGVudGl0eSBhcHBlYXJzCiAgICAgKiB0byBiZSB2aW9sYXRpbmcgc3RhbmRh\ncmQgcHJvcGVydHkgcmVzdHJpY3Rpb25zLiBEZWZhdWx0cyB0byBmYWxzZS48\nL2xpPgogICAgICogPC91bD4KICAgICAqICBFYWNoIGFkZGl0aW9uYWwgYXJn\ndW1lbnQgY2FuIGJlIGVpdGhlciB0aGUgZnVsbCBjbGFzcyBuYW1lIG9mIHRo\nZQogICAgICogdHlwZSB0byBlbmhhbmNlLCB0aGUgcGF0aCB0byB0aGUgLmph\ndmEgZmlsZSBmb3IgdGhlIHR5cGUsIHRoZSBwYXRoIHRvCiAgICAgKiB0aGUg\nLmNsYXNzIGZpbGUgZm9yIHRoZSB0eXBlLCBvciB0aGUgcGF0aCB0byBhIC5q\nZG8gZmlsZSBsaXN0aW5nIG9uZQogICAgICogb3IgbW9yZSB0eXBlcyB0byBl\nbmhhbmNlLgogICAgICogSWYgdGhlIHR5cGUgYmVpbmcgZW5oYW5jZWQgaGFz\nIG1ldGFkYXRhLCBpdCB3aWxsIGJlIGVuaGFuY2VkIGFzIGEKICAgICAqIHBl\ncnNpc3RlbmNlIGNhcGFibGUgY2xhc3MuIElmIG5vdCwgaXQgd2lsbCBiZSBj\nb25zaWRlcmVkIGEgcGVyc2lzdGVuY2UKICAgICAqIGF3YXJlIGNsYXNzLCBh\nbmQgYWxsIGFjY2VzcyB0byBmaWVsZHMgb2YgcGVyc2lzdGVuY2UgY2FwYWJs\nZSBjbGFzc2VzCiAgICAgKiB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRoZSBhcHBy\nb3ByaWF0ZQlnZXQvc2V0IG1ldGhvZC4gSWYgdGhlIHR5cGUKICAgICAqIGV4\ncGxpY2l0bHkgZGVjbGFyZXMgdGhlIHBlcnNpc3RlbmNlLWNhcGFibGUgaW50\nZXJmYWNlLCBpdCB3aWxsCiAgICAgKiBub3QgYmUgZW5oYW5jZWQuIFRodXMs\nIGl0IGlzIHNhZmUgdG8gaW52b2tlIHRoZSBlbmhhbmNlciBvbiBjbGFzc2Vz\nCiAgICAgKiB0aGF0IGFyZSBhbHJlYWR5IGVuaGFuY2VkLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB7CiAg\nICAgICAgT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBh\ncmdzID0gb3B0cy5zZXRGcm9tQ21kTGluZShhcmdzKTsKICAgICAgICBpZiAo\nIXJ1bihhcmdzLCBvcHRzKSkKICAgICAgICAgICAgU3lzdGVtLmVyci5wcmlu\ndGxuKF9sb2MuZ2V0KCJlbmhhbmNlLXVzYWdlIikpOwogICAgfQoKICAgIC8q\nKgogICAgICogUnVuIHRoZSB0b29sLiBSZXR1cm5zIGZhbHNlIGlmIGludmFs\naWQgb3B0aW9ucyBnaXZlbi4gUnVucyBhZ2FpbnN0IGFsbAogICAgICogdGhl\nIHBlcnNpc3RlbmNlIHVuaXRzIGRlZmluZWQgaW4gdGhlIHJlc291cmNlIHRv\nIHBhcnNlLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gcnVu\nKGZpbmFsIFN0cmluZ1tdIGFyZ3MsIE9wdGlvbnMgb3B0cykgewogICAgICAg\nIHJldHVybiBDb25maWd1cmF0aW9ucy5ydW5BZ2FpbnN0QWxsQW5jaG9ycyhv\ncHRzLAogICAgICAgICAgICBuZXcgQ29uZmlndXJhdGlvbnMuUnVubmFibGUo\nKSB7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bihPcHRpb25zIG9w\ndHMpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBPcGVu\nSlBBQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IE9wZW5KUEFDb25maWd1cmF0\naW9uSW1wbCgpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gUENFbmhhbmNlci5ydW4oY29uZiwgYXJncywgb3B0\ncyk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIGNvbmYuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogUnVu\nIHRoZSB0b29sLiBSZXR1cm5zIGZhbHNlIGlmIGludmFsaWQgb3B0aW9ucyBn\naXZlbi4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIHJ1bihP\ncGVuSlBBQ29uZmlndXJhdGlvbiBjb25mLCBTdHJpbmdbXSBhcmdzLAogICAg\nICAgIE9wdGlvbnMgb3B0cykKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIEZsYWdzIGZsYWdzID0gbmV3IEZsYWdzKCk7CiAgICAgICAg\nZmxhZ3MuZGlyZWN0b3J5ID0gRmlsZXMuZ2V0RmlsZShvcHRzLnJlbW92ZVBy\nb3BlcnR5KCJkaXJlY3RvcnkiLCAiZCIsCiAgICAgICAgICAgIG51bGwpLCBu\ndWxsKTsKICAgICAgICBmbGFncy5hZGREZWZhdWx0Q29uc3RydWN0b3IgPSBv\ncHRzLnJlbW92ZUJvb2xlYW5Qcm9wZXJ0eQogICAgICAgICAgICAoImFkZERl\nZmF1bHRDb25zdHJ1Y3RvciIsICJhZGMiLCBmbGFncy5hZGREZWZhdWx0Q29u\nc3RydWN0b3IpOwogICAgICAgIGZsYWdzLnRtcENsYXNzTG9hZGVyID0gb3B0\ncy5yZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJ0bXBDbGFz\nc0xvYWRlciIsICJ0Y2wiLCBmbGFncy50bXBDbGFzc0xvYWRlcik7CiAgICAg\nICAgZmxhZ3MuZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zID0gb3B0cy5y\nZW1vdmVCb29sZWFuUHJvcGVydHkKICAgICAgICAgICAgKCJlbmZvcmNlUHJv\ncGVydHlSZXN0cmljdGlvbnMiLCAiZXByIiwKICAgICAgICAgICAgICAgIGZs\nYWdzLmVuZm9yY2VQcm9wZXJ0eVJlc3RyaWN0aW9ucyk7CgogICAgICAgIC8v\nIGZvciB1bml0IHRlc3RpbmcKICAgICAgICBCeXRlY29kZVdyaXRlciB3cml0\nZXIgPSAoQnl0ZWNvZGVXcml0ZXIpIG9wdHMuZ2V0KAogICAgICAgICAgICBQ\nQ0VuaGFuY2VyLmNsYXNzLmdldE5hbWUoKSArICIjYnl0ZWNvZGVXcml0ZXIi\nKTsKCiAgICAgICAgQ29uZmlndXJhdGlvbnMucG9wdWxhdGVDb25maWd1cmF0\naW9uKGNvbmYsIG9wdHMpOwogICAgICAgIHJldHVybiBydW4oY29uZiwgYXJn\ncywgZmxhZ3MsIG51bGwsIHdyaXRlciwgbnVsbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBFbmhhbmNlIHRoZSBnaXZlbiBjbGFzc2VzLgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gcnVuKE9wZW5KUEFDb25maWd1cmF0\naW9uIGNvbmYsIFN0cmluZ1tdIGFyZ3MsCiAgICAgICAgRmxhZ3MgZmxhZ3Ms\nIE1ldGFEYXRhUmVwb3NpdG9yeSByZXBvcywgQnl0ZWNvZGVXcml0ZXIgd3Jp\ndGVyLAogICAgICAgIENsYXNzTG9hZGVyIGxvYWRlcikKICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChsb2FkZXIgPT0gbnVsbCkK\nICAgICAgICAgICAgbG9hZGVyID0gY29uZi5nZXRDbGFzc1Jlc29sdmVySW5z\ndGFuY2UoKS4KICAgICAgICAgICAgICAgIGdldENsYXNzTG9hZGVyKFBDRW5o\nYW5jZXIuY2xhc3MsIG51bGwpOwogICAgICAgIGlmIChmbGFncy50bXBDbGFz\nc0xvYWRlcikKICAgICAgICAgICAgbG9hZGVyID0gQWNjZXNzQ29udHJvbGxl\nci5kb1ByaXZpbGVnZWQoSjJEb1ByaXZIZWxwZXIKICAgICAgICAgICAgICAg\nIC5uZXdUZW1wb3JhcnlDbGFzc0xvYWRlckFjdGlvbihsb2FkZXIpKTsKCiAg\nICAgICAgaWYgKHJlcG9zID09IG51bGwpIHsKICAgICAgICAgICAgcmVwb3Mg\nPSBjb25mLm5ld01ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAg\nICAgICAgIHJlcG9zLnNldFNvdXJjZU1vZGUoTWV0YURhdGFSZXBvc2l0b3J5\nLk1PREVfTUVUQSk7CiAgICAgICAgfQoKICAgICAgICBMb2cgbG9nID0gY29u\nZi5nZXRMb2coT3BlbkpQQUNvbmZpZ3VyYXRpb24uTE9HX1RPT0wpOwogICAg\nICAgIENvbGxlY3Rpb24gY2xhc3NlczsKICAgICAgICBpZiAoYXJncyA9PSBu\ndWxsIHx8IGFyZ3MubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgbG9nLmlu\nZm8oX2xvYy5nZXQoInJ1bm5pbmctYWxsLWNsYXNzZXMiKSk7CiAgICAgICAg\nICAgIGNsYXNzZXMgPSByZXBvcy5nZXRQZXJzaXN0ZW50VHlwZU5hbWVzKHRy\ndWUsIGxvYWRlcik7CiAgICAgICAgICAgIGlmIChjbGFzc2VzID09IG51bGwp\nIHsKICAgICAgICAgICAgCWxvZy53YXJuKF9sb2MuZ2V0KCJuby1jbGFzcy10\nby1lbmhhbmNlIikpOwogICAgICAgICAgICAJcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgQ2xhc3NB\ncmdQYXJzZXIgY2FwID0gY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGFGYWN0b3J5KCku\nbmV3Q2xhc3NBcmdQYXJzZXIoKTsKICAgICAgICAgICAgY2FwLnNldENsYXNz\nTG9hZGVyKGxvYWRlcik7CiAgICAgICAgICAgIGNsYXNzZXMgPSBuZXcgSGFz\naFNldCgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGFyZ3Mu\nbGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBjbGFzc2VzLmFkZEFsbChB\ncnJheXMuYXNMaXN0KGNhcC5wYXJzZVR5cGVzKGFyZ3NbaV0pKSk7CiAgICAg\nICAgfQoKICAgICAgICBQcm9qZWN0IHByb2plY3QgPSBuZXcgUHJvamVjdCgp\nOwogICAgICAgIEJDQ2xhc3MgYmM7CiAgICAgICAgUENFbmhhbmNlciBlbmhh\nbmNlcjsKICAgICAgICBpbnQgc3RhdHVzOwogICAgICAgIGZvciAoSXRlcmF0\nb3IgaXRyID0gY2xhc3Nlcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBPYmplY3QgbyA9IGl0ci5uZXh0KCk7CiAgICAgICAg\nICAgIGlmIChsb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAg\nIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1ydW5uaW5nIiwgbykpOwoK\nICAgICAgICAgICAgaWYgKG8gaW5zdGFuY2VvZiBTdHJpbmcpCiAgICAgICAg\nICAgICAgICBiYyA9IHByb2plY3QubG9hZENsYXNzKChTdHJpbmcpIG8sIGxv\nYWRlcik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJjID0g\ncHJvamVjdC5sb2FkQ2xhc3MoKENsYXNzKSBvKTsKICAgICAgICAgICAgZW5o\nYW5jZXIgPSBuZXcgUENFbmhhbmNlcihjb25mLCBiYywgcmVwb3MsIGxvYWRl\ncik7CiAgICAgICAgICAgIGlmICh3cml0ZXIgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGVuaGFuY2VyLnNldEJ5dGVjb2RlV3JpdGVyKHdyaXRlcik7CiAg\nICAgICAgICAgIGVuaGFuY2VyLnNldERpcmVjdG9yeShmbGFncy5kaXJlY3Rv\ncnkpOwogICAgICAgICAgICBlbmhhbmNlci5zZXRBZGREZWZhdWx0Q29uc3Ry\ndWN0b3IoZmxhZ3MuYWRkRGVmYXVsdENvbnN0cnVjdG9yKTsKICAgICAgICAg\nICAgc3RhdHVzID0gZW5oYW5jZXIucnVuKCk7CiAgICAgICAgICAgIGlmIChz\ndGF0dXMgPT0gRU5IQU5DRV9OT05FKSB7CiAgICAgICAgICAgICAgICBpZiAo\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgbG9n\nLnRyYWNlKF9sb2MuZ2V0KCJlbmhhbmNlLW5vcnVuIikpOwogICAgICAgICAg\nICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBFTkhBTkNFX0lOVEVSRkFDRSkgewog\nICAgICAgICAgICAgICAgaWYgKGxvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgICAgIGxvZy50cmFjZShfbG9jLmdldCgiZW5oYW5jZS1p\nbnRlcmZhY2UiKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09\nIEVOSEFOQ0VfQVdBUkUpIHsKICAgICAgICAgICAgICAgIGlmIChsb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICBsb2cudHJhY2Uo\nX2xvYy5nZXQoImVuaGFuY2UtYXdhcmUiKSk7CiAgICAgICAgICAgICAgICBl\nbmhhbmNlci5yZWNvcmQoKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgICAgICBlbmhhbmNlci5yZWNvcmQoKTsKICAgICAgICAgICAgcHJvamVj\ndC5jbGVhcigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJ1biBmbGFncy4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBjbGFzcyBGbGFncyB7CgogICAgICAgIHB1YmxpYyBGaWxl\nIGRpcmVjdG9yeSA9IG51bGw7CiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRk\nRGVmYXVsdENvbnN0cnVjdG9yID0gdHJ1ZTsKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiB0bXBDbGFzc0xvYWRlciA9IHRydWU7CiAgICAgICAgcHVibGljIGJv\nb2xlYW4gZW5mb3JjZVByb3BlcnR5UmVzdHJpY3Rpb25zID0gZmFsc2U7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQbHVnaW4gaW50ZXJmYWNlIGZvciBhZGRp\ndGlvbmFsIGVuaGFuY2VtZW50LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGludGVyZmFjZSBBdXhpbGlhcnlFbmhhbmNlcgogICAgewogICAgICAgIHB1\nYmxpYyB2b2lkIHJ1biAoQkNDbGFzcyBiYywgQ2xhc3NNZXRhRGF0YSBtZXRh\nKTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBza2lwRW5oYW5jZShCQ01ldGhv\nZCBtKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGFkZEdldElET3du\naW5nQ2xhc3MoKSB0aHJvd3MgTm9TdWNoTWV0aG9kRXhjZXB0aW9uIHsKICAg\nICAgICBCQ01ldGhvZCBtZXRob2QgPSBfcGMuZGVjbGFyZU1ldGhvZChQUkUg\nKyAiR2V0SURPd25pbmdDbGFzcyIsIAogICAgICAgICAgICBDbGFzcy5jbGFz\ncywgbnVsbCk7CiAgICAgICAgQ29kZSBjb2RlID0gbWV0aG9kLmdldENvZGUo\ndHJ1ZSk7CiAgICAgICAgCiAgICAgICAgY29kZS5jbGFzc2NvbnN0YW50KCku\nc2V0Q2xhc3MoZ2V0VHlwZShfbWV0YSkpOwogICAgICAgIGNvZGUuYXJldHVy\nbigpOwogICAgICAgIAogICAgICAgIGNvZGUuY2FsY3VsYXRlTWF4U3RhY2so\nKTsKICAgICAgICBjb2RlLmNhbGN1bGF0ZU1heExvY2FscygpOwogICAgfQp9\nCg==\n","encoding":"base64"}

