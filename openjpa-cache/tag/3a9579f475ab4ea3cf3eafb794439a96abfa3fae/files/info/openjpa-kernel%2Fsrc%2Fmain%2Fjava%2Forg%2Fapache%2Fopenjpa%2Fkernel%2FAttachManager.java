{"sha":"3d1d73986f9f80c932f9a6564137696878059e68","node_id":"MDQ6QmxvYjIwNjM2NDozZDFkNzM5ODZmOWY4MGM5MzJmOWE2NTY0MTM3Njk2ODc4MDU5ZTY4","size":12366,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/3d1d73986f9f80c932f9a6564137696878059e68","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0Owpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwpp\nbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY29sbGVjdGlvbnMubWFwLklkZW50aXR5TWFwOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmVuaGFuY2UuUGVyc2lzdGVuY2VDYXBhYmxlOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50LkNhbGxiYWNrTW9kZXM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuTG9jYWxpemVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuQ2xhc3NNZXRhRGF0\nYTsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFE\nYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQ2FsbGJhY2tF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5FeGNl\ncHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3BlbkpQ\nQUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\ndGltaXN0aWNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Qcm94eU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\ndXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLnV0aWwuSW1wbEhlbHBlcjsKCi8qKgogKiBIYW5kbGVzIGF0dGFjaGluZyBp\nbnN0YW5jZXMuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAq\nLwpwdWJsaWMgY2xhc3MgQXR0YWNoTWFuYWdlciB7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBdHRhY2hNYW5hZ2VyLmNsYXNzKTsKCiAgICBwcml2\nYXRlIGZpbmFsIEJyb2tlckltcGwgX2Jyb2tlcjsKICAgIHByaXZhdGUgZmlu\nYWwgUHJveHlNYW5hZ2VyIF9wcm94eTsKICAgIHByaXZhdGUgZmluYWwgT3BD\nYWxsYmFja3MgX2NhbGw7CiAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX2Nv\ncHlOZXc7CiAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4gX2ZhaWxGYXN0Owog\nICAgcHJpdmF0ZSBmaW5hbCBJZGVudGl0eU1hcCBfYXR0YWNoZWQgPSBuZXcg\nSWRlbnRpdHlNYXAoKTsKICAgIHByaXZhdGUgZmluYWwgQ29sbGVjdGlvbiBf\ndmlzaXRlZE5vZGVzID0gbmV3IEFycmF5TGlzdCgpOwoKICAgIC8vIHJldXNh\nYmxlIHN0cmF0ZWdpZXMKICAgIHByaXZhdGUgQXR0YWNoU3RyYXRlZ3kgX3Zl\ncnNpb24gPSBudWxsOwogICAgcHJpdmF0ZSBBdHRhY2hTdHJhdGVneSBfZGV0\nYWNoID0gbnVsbDsKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yLiBTdXBw\nbHkgYnJva2VyIGF0dGFjaGluZyB0by4KICAgICAqLwogICAgcHVibGljIEF0\ndGFjaE1hbmFnZXIoQnJva2VySW1wbCBicm9rZXIsIGJvb2xlYW4gY29weU5l\ndywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIF9icm9rZXIgPSBicm9r\nZXI7CiAgICAgICAgX3Byb3h5ID0gYnJva2VyLmdldENvbmZpZ3VyYXRpb24o\nKS5nZXRQcm94eU1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9jYWxsID0g\nY2FsbDsKICAgICAgICBfY29weU5ldyA9IGNvcHlOZXc7CiAgICAgICAgX2Zh\naWxGYXN0ID0gKGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TWV0YURh\ndGFSZXBvc2l0b3J5SW5zdGFuY2UoKS4KICAgICAgICAgICAgZ2V0TWV0YURh\ndGFGYWN0b3J5KCkuZ2V0RGVmYXVsdHMoKS5nZXRDYWxsYmFja01vZGUoKQog\nICAgICAgICAgICAmIENhbGxiYWNrTW9kZXMuQ0FMTEJBQ0tfRkFJTF9GQVNU\nKSAhPSAwOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBiZWhh\ndmlvciBzdXBwbGllZCBvbiBjb25zdHJ1Y3Rpb24uCiAgICAgKi8KICAgIHB1\nYmxpYyBPcENhbGxiYWNrcyBnZXRCZWhhdmlvcigpIHsKICAgICAgICByZXR1\ncm4gX2NhbGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhl\nciB0byBjb3B5IG5ldyBpbnN0YW5jZXMgYmVpbmcgcGVyc2lzdGVkLgogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRDb3B5TmV3KCkgewogICAgICAg\nIHJldHVybiBfY29weU5ldzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiBhbiBhdHRhY2hlZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBpbnN0YW5jZS4K\nICAgICAqLwogICAgcHVibGljIE9iamVjdCBhdHRhY2goT2JqZWN0IHBjKSB7\nCiAgICAgICAgaWYgKHBjID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBu\ndWxsOwoKICAgICAgICBDYWxsYmFja0V4Y2VwdGlvbiBleGNlcCA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGF0dGFjaChwYywg\nbnVsbCwgbnVsbCwgbnVsbCwgdHJ1ZSk7CiAgICAgICAgfSBjYXRjaCAoQ2Fs\nbGJhY2tFeGNlcHRpb24gY2UpIHsKICAgICAgICAgICAgZXhjZXAgPSBjZTsK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIHdvbid0IGJlIHJlYWNoZWQg\nYXMgdGhlIGV4Y2VwcyB3aWxsIGJlIHJldGhyb3duCiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgTGlzdCBleGNlcHMgPSBudWxsOwogICAgICAg\nICAgICBpZiAoZXhjZXAgPT0gbnVsbCB8fCAhX2ZhaWxGYXN0KQogICAgICAg\nICAgICAgICAgZXhjZXBzID0gaW52b2tlQWZ0ZXJBdHRhY2gobnVsbCk7CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IENvbGxl\nY3Rpb25zLnNpbmdsZXRvbkxpc3QoZXhjZXApOwogICAgICAgICAgICBfYXR0\nYWNoZWQuY2xlYXIoKTsKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb25zKGV4\nY2VwcywgbnVsbCwgZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiBhdHRhY2hlZCB2ZXJzaW9ucyBvZiB0aGUgZ2l2ZW4g\naW5zdGFuY2VzLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0W10gYXR0YWNo\nQWxsKENvbGxlY3Rpb24gaW5zdGFuY2VzKSB7CiAgICAgICAgT2JqZWN0W10g\nYXR0YWNoZWQgPSBuZXcgT2JqZWN0W2luc3RhbmNlcy5zaXplKCldOwogICAg\nICAgIExpc3QgZXhjZXBzID0gbnVsbDsKICAgICAgICBMaXN0IGZhaWxlZCA9\nIG51bGw7CiAgICAgICAgYm9vbGVhbiBvcHQgPSB0cnVlOwogICAgICAgIGJv\nb2xlYW4gZmFpbEZhc3QgPSBmYWxzZTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRy\nID0gaW5zdGFuY2VzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7IGkrKykg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBh\ndHRhY2hlZFtpXSA9IGF0dGFjaChpdHIubmV4dCgpLCBudWxsLCBudWxsLCBu\ndWxsLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0cmFjayBl\neGNlcHRpb25zIGFuZCBvcHRpbWlzdGljIGZhaWxlZCBvYmplY3RzCiAgICAg\nICAgICAgICAgICAgICAgaWYgKG9wdCAmJiAhKGtlIGluc3RhbmNlb2YgT3B0\naW1pc3RpY0V4Y2VwdGlvbikpCiAgICAgICAgICAgICAgICAgICAgICAgIG9w\ndCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmIChvcHQgJiYga2Uu\nZ2V0RmFpbGVkT2JqZWN0KCkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgZmFpbGVkID0gYWRkKGZhaWxlZCwga2UuZ2V0RmFpbGVkT2JqZWN0\nKCkpOwogICAgICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMs\nIGtlKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGtlIGluc3RhbmNlb2Yg\nQ2FsbGJhY2tFeGNlcHRpb24gJiYgX2ZhaWxGYXN0KSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGZhaWxGYXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQo\nZXhjZXBzLCByZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyBpbnZva2UgcG9z\ndCBjYWxsYmFja3MgdW5sZXNzIGFsbCBmYWlsZWQKICAgICAgICAgICAgaWYg\nKCFmYWlsRmFzdCAmJiAoZXhjZXBzID09IG51bGwKICAgICAgICAgICAgICAg\nIHx8IGV4Y2Vwcy5zaXplKCkgPCBpbnN0YW5jZXMuc2l6ZSgpKSkKICAgICAg\nICAgICAgICAgIGV4Y2VwcyA9IGludm9rZUFmdGVyQXR0YWNoKGV4Y2Vwcyk7\nCiAgICAgICAgICAgIF9hdHRhY2hlZC5jbGVhcigpOwogICAgICAgIH0KICAg\nICAgICB0aHJvd0V4Y2VwdGlvbnMoZXhjZXBzLCBmYWlsZWQsIG9wdCk7CiAg\nICAgICAgcmV0dXJuIGF0dGFjaGVkOwogICAgfQoKICAgIC8qKgogICAgICog\nSW52b2tlIHBvc3RBdHRhY2goKSBvbiBhbnkgYXR0YWNoZWQgaW5zdGFuY2Vz\nIHRoYXQgaW1wbGVtZW50CiAgICAgKiBQb3N0QXR0YWNoQ2FsbGJhY2suIFRo\naXMgd2lsbCBiZSBkb25lIGFmdGVyIHRoZSBlbnRpcmUgZ3JhcGggaGFzCiAg\nICAgKiBiZWVuIGF0dGFjaGVkLgogICAgICovCiAgICBwcml2YXRlIExpc3Qg\naW52b2tlQWZ0ZXJBdHRhY2goTGlzdCBleGNlcHMpIHsKICAgICAgICBTZXQg\nZW50cmllcyA9IF9hdHRhY2hlZC5lbnRyeVNldCgpOwogICAgICAgIGZvciAo\nSXRlcmF0b3IgaSA9IGVudHJpZXMuaXRlcmF0b3IoKTsgaS5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlbnRyeSA9IChNYXAuRW50cnkp\nIGkubmV4dCgpOwogICAgICAgICAgICBPYmplY3QgYXR0YWNoZWQgPSBlbnRy\neS5nZXRWYWx1ZSgpOwogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNt\nID0gX2Jyb2tlci5nZXRTdGF0ZU1hbmFnZXJJbXBsKGF0dGFjaGVkLCB0cnVl\nKTsKICAgICAgICAgICAgaWYgKHNtLmlzTmV3KCkpCiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50KGF0dGFjaGVkLCBlbnRyeS5n\nZXRLZXkoKSwKICAgICAgICAgICAgICAgICAgICBzbS5nZXRNZXRhRGF0YSgp\nLCBMaWZlY3ljbGVFdmVudC5BRlRFUl9BVFRBQ0gpOwogICAgICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAg\nICBleGNlcHMgPSBhZGQoZXhjZXBzLCByZSk7CiAgICAgICAgICAgICAgICBp\nZiAoX2ZhaWxGYXN0ICYmIHJlIGluc3RhbmNlb2YgQ2FsbGJhY2tFeGNlcHRp\nb24pCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4Y2VwczsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBhbiBvYmplY3QgdG8gdGhlIGxpc3QuCiAgICAgKi8K\nICAgIHByaXZhdGUgTGlzdCBhZGQoTGlzdCBsaXN0LCBPYmplY3Qgb2JqKSB7\nCiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCkKICAgICAgICAgICAgbGlzdCA9\nIG5ldyBMaW5rZWRMaXN0KCk7CiAgICAgICAgbGlzdC5hZGQob2JqKTsKICAg\nICAgICByZXR1cm4gbGlzdDsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93\nIGV4Y2VwdGlvbiBmb3IgZmFpbHVyZXMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB0aHJvd0V4Y2VwdGlvbnMoTGlzdCBleGNlcHMsIExpc3QgZmFpbGVk\nLCBib29sZWFuIG9wdCkgewogICAgICAgIGlmIChleGNlcHMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChleGNlcHMuc2l6ZSgp\nID09IDEpCiAgICAgICAgICAgIHRocm93IChSdW50aW1lRXhjZXB0aW9uKSBl\neGNlcHMuZ2V0KDApOwoKICAgICAgICBUaHJvd2FibGVbXSB0ID0gKFRocm93\nYWJsZVtdKSBleGNlcHMudG9BcnJheQogICAgICAgICAgICAobmV3IFRocm93\nYWJsZVtleGNlcHMuc2l6ZSgpXSk7CiAgICAgICAgaWYgKG9wdCAmJiBmYWls\nZWQgIT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IE9wdGltaXN0aWNF\neGNlcHRpb24oZmFpbGVkLCB0KTsKICAgICAgICBpZiAob3B0KQogICAgICAg\nICAgICB0aHJvdyBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbih0KTsKICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibmVzdGVkLWV4\nY2VwcyIpKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyh0KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEF0dGFjaC4KICAgICAqCiAgICAgKiBA\ncGFyYW0gdG9BdHRhY2ggdGhlIGRldGFjaGVkIG9iamVjdAogICAgICogQHBh\ncmFtIGludG8gdGhlIGluc3RhbmNlIHdlJ3JlIGF0dGFjaGluZyBpbnRvCiAg\nICAgKiBAcGFyYW0gb3duZXIgc3RhdGUgbWFuYWdlciBmb3IgPGNvZGU+aW50\nbzwvY29kZT4KICAgICAqIEBwYXJhbSBvd25lck1ldGEgdGhlIGZpZWxkIHdl\nIHRyYXZlcnNlZCB0byBmaW5kIDxjb2RlPnRvQXR0YWNoPC9jb2RlPgogICAg\nICogQHBhcmFtIGV4cGxpY2l0IHdoZXRoZXIgdG8gbWFrZSBuZXcgaW5zdGFu\nY2VzIGV4cGxpY2l0bHkgcGVyc2lzdGVudAogICAgICovCiAgICBPYmplY3Qg\nYXR0YWNoKE9iamVjdCB0b0F0dGFjaCwgUGVyc2lzdGVuY2VDYXBhYmxlIGlu\ndG8sCiAgICAgICAgT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwgVmFsdWVN\nZXRhRGF0YSBvd25lck1ldGEsIGJvb2xlYW4gZXhwbGljaXQpIHsKICAgICAg\nICBpZiAodG9BdHRhY2ggPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CgogICAgICAgIC8vIGNoZWNrIGlmIGFscmVhZHkgYXR0YWNoZWQKICAg\nICAgICBPYmplY3QgYXR0YWNoZWQgPSBfYXR0YWNoZWQuZ2V0KHRvQXR0YWNo\nKTsKICAgICAgICBpZiAoYXR0YWNoZWQgIT0gbnVsbCkKICAgICAgICAgICAg\ncmV0dXJuIGF0dGFjaGVkOwoKICAgICAgICAvLyMjIyBuZWVkIHRvIGhhbmRs\nZSBBQ1RfQ0FTQ0FERQogICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJn\ndW1lbnQodG9BdHRhY2gpOwogICAgICAgIGlmICgoYWN0aW9uICYgT3BDYWxs\nYmFja3MuQUNUX1JVTikgPT0gMCAmJgogICAgICAgICAgICAoYWN0aW9uICYg\nT3BDYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApIHsKICAgICAgICAgICAg\naWYoX3Zpc2l0ZWROb2Rlcy5jb250YWlucyhfYnJva2VyLmdldFN0YXRlTWFu\nYWdlcih0b0F0dGFjaCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRvQXR0\nYWNoOwogICAgICAgICAgICByZXR1cm4gaGFuZGxlQ2FzY2FkZSh0b0F0dGFj\naCxvd25lcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoKGFjdGlvbiAmIE9w\nQ2FsbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgIHJldHVybiB0\nb0F0dGFjaDsKCiAgICAgICAgLy8jIyMgbmVlZCB0byBoYW5kbGUgQUNUX1JV\nTiB3aXRob3V0IGFsc28gQUNUX0NBU0NBREUKICAgICAgICBDbGFzc01ldGFE\nYXRhIG1ldGEgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAg\nICAgICAgZ2V0TWV0YURhdGFSZXBvc2l0b3J5SW5zdGFuY2UoKS5nZXRNZXRh\nRGF0YSgKICAgICAgICAgICAgICAgIEltcGxIZWxwZXIuZ2V0TWFuYWdlZElu\nc3RhbmNlKHRvQXR0YWNoKS5nZXRDbGFzcygpLAogICAgICAgICAgICAgICAg\nX2Jyb2tlci5nZXRDbGFzc0xvYWRlcigpLCB0cnVlKTsKICAgICAgICByZXR1\ncm4gZ2V0U3RyYXRlZ3kodG9BdHRhY2gpLmF0dGFjaCh0aGlzLCB0b0F0dGFj\naCwgbWV0YSwgaW50bywKICAgICAgICAgICAgb3duZXIsIG93bmVyTWV0YSwg\nZXhwbGljaXQpOwogICAgfQoKICAgIHByaXZhdGUgT2JqZWN0IGhhbmRsZUNh\nc2NhZGUoT2JqZWN0IHRvQXR0YWNoLCBPcGVuSlBBU3RhdGVNYW5hZ2VyIG93\nbmVyKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZpZWxkcyA9IF9icm9r\nZXIuZ2V0U3RhdGVNYW5hZ2VyKHRvQXR0YWNoKS5nZXRNZXRhRGF0YSgpCiAg\nICAgICAgICAgIC5nZXREZWZpbmVkRmllbGRzKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgRmllbGRNZXRhRGF0YSBmZCA9IChGaWVsZE1ldGFEYXRhKSBmaWVsZHNb\naV07CiAgICAgICAgICAgIGlmIChmZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2Fk\nZUF0dGFjaCgpID09IGZkLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAg\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gaW52ZXJzZUZpZWxkTWFwcGluZ3Mg\nPSBmZC5nZXRJbnZlcnNlTWV0YURhdGFzKCk7CiAgICAgICAgICAgICAgICBp\nZiAoaW52ZXJzZUZpZWxkTWFwcGluZ3MubGVuZ3RoICE9IDApIHsKICAgICAg\nICAgICAgICAgICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gX2Jyb2tl\nci5nZXRTdGF0ZU1hbmFnZXIodG9BdHRhY2gpOwogICAgICAgICAgICAgICAg\nICAgIF92aXNpdGVkTm9kZXMuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAg\nICBnZXRTdHJhdGVneSh0b0F0dGFjaCkuYXR0YWNoRmllbGQodGhpcywgdG9B\ndHRhY2gsCiAgICAgICAgICAgICAgICAgICAgICAgIF9icm9rZXIuZ2V0U3Rh\ndGVNYW5hZ2VySW1wbCh0b0F0dGFjaCwgdHJ1ZSksIGZkLCB0cnVlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdG9BdHRhY2g7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nRGV0ZXJtaW5lIHRoZSBhY3Rpb24gdG8gdGFrZSBvbiB0aGUgZ2l2ZW4gYXJn\ndW1lbnQuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHByb2Nlc3NBcmd1bWVu\ndChPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYgKF9jYWxsID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBPcENhbGxiYWNrcy5BQ1RfUlVOOwogICAgICAg\nIHJldHVybiBfY2FsbC5wcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1Bf\nQVRUQUNILCBvYmosCiAgICAgICAgICAgIF9icm9rZXIuZ2V0U3RhdGVNYW5h\nZ2VyKG9iaikpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHBy\nb3BlciBhdHRhY2ggc3RyYXRlZ3kgZm9yIGluc3RhbmNlLgogICAgICovCiAg\nICBwcml2YXRlIEF0dGFjaFN0cmF0ZWd5IGdldFN0cmF0ZWd5KE9iamVjdCB0\nb0F0dGFjaCkgewogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IElt\ncGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUodG9BdHRhY2gsCiAgICAg\nICAgICAgIGdldEJyb2tlcigpLmdldENvbmZpZ3VyYXRpb24oKSk7CiAgICAg\nICAgaWYgKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgaW5zdGFuY2VvZiBBdHRh\nY2hTdHJhdGVneSkKICAgICAgICAgICAgcmV0dXJuIChBdHRhY2hTdHJhdGVn\neSkgcGMucGNHZXRTdGF0ZU1hbmFnZXIoKTsKCiAgICAgICAgT2JqZWN0IG9i\naiA9IHBjLnBjR2V0RGV0YWNoZWRTdGF0ZSgpOwogICAgICAgIGlmIChvYmog\naW5zdGFuY2VvZiBBdHRhY2hTdHJhdGVneSkKICAgICAgICAgICAgcmV0dXJu\nIChBdHRhY2hTdHJhdGVneSkgb2JqOwogICAgICAgIGlmIChvYmogPT0gbnVs\nbCB8fCBvYmogPT0gUGVyc2lzdGVuY2VDYXBhYmxlLkRFU0VSSUFMSVpFRCkg\newogICAgICAgICAgICAvLyBuZXcgb3IgZGV0YWNoZWQgd2l0aG91dCBzdGF0\nZQogICAgICAgICAgICBpZiAoX3ZlcnNpb24gPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIF92ZXJzaW9uID0gbmV3IFZlcnNpb25BdHRhY2hTdHJhdGVneSgp\nOwogICAgICAgICAgICByZXR1cm4gX3ZlcnNpb247CiAgICAgICAgfQoKICAg\nICAgICAvLyBkZXRhY2hlZCBzdGF0ZQogICAgICAgIGlmIChfZGV0YWNoID09\nIG51bGwpCiAgICAgICAgICAgIF9kZXRhY2ggPSBuZXcgRGV0YWNoZWRTdGF0\nZUF0dGFjaFN0cmF0ZWd5KCk7CiAgICAgICAgcmV0dXJuIF9kZXRhY2g7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBPd25pbmcgYnJva2VyLgogICAgICovCiAg\nICBCcm9rZXJJbXBsIGdldEJyb2tlcigpIHsKICAgICAgICByZXR1cm4gX2Jy\nb2tlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFN5c3RlbSBwcm94eSBtYW5h\nZ2VyLgogICAgICovCiAgICBQcm94eU1hbmFnZXIgZ2V0UHJveHlNYW5hZ2Vy\nKCkgewogICAgICAgIHJldHVybiBfcHJveHk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0aGUgcGFzc2VkIGluIGFyZ3VtZW50IGhhcyBhbHJlYWR5IGJl\nZW4gYXR0YWNoZWQsIHJldHVybgogICAgICogdGhlIChjYWNoZWQpIGF0dGFj\naGVkIGNvcHkuCiAgICAgKi8KICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBnZXRB\ndHRhY2hlZENvcHkoT2JqZWN0IHBjKSB7CiAgICAgICAgcmV0dXJuIEltcGxI\nZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUoX2F0dGFjaGVkLmdldChwYyks\nCiAgICAgICAgICAgIGdldEJyb2tlcigpLmdldENvbmZpZ3VyYXRpb24oKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhlIGF0dGFjaGVkIGNv\ncHkgaW4gdGhlIGNhY2hlLgogICAgICovCiAgICB2b2lkIHNldEF0dGFjaGVk\nQ29weShPYmplY3QgZnJvbSwgUGVyc2lzdGVuY2VDYXBhYmxlIGludG8pIHsK\nICAgICAgICBfYXR0YWNoZWQucHV0KGZyb20sIGludG8pOwogICAgfQoKICAg\nIC8qKgogICAgICogRmlyZSBiZWZvcmUtYXR0YWNoIGV2ZW50LgogICAgICov\nCiAgICB2b2lkIGZpcmVCZWZvcmVBdHRhY2goT2JqZWN0IHBjLCBDbGFzc01l\ndGFEYXRhIG1ldGEpIHsKICAgICAgICBfYnJva2VyLmZpcmVMaWZlY3ljbGVF\ndmVudChwYywgbnVsbCwgbWV0YSwKICAgICAgICAgICAgTGlmZWN5Y2xlRXZl\nbnQuQkVGT1JFX0FUVEFDSCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1\ncm4gdGhlIGRldGFjaGVkIG9pZCBvZiB0aGUgZ2l2ZW4gaW5zdGFuY2UuCiAg\nICAgKi8KICAgIE9iamVjdCBnZXREZXRhY2hlZE9iamVjdElkKE9iamVjdCBw\nYykgewogICAgICAgIGlmIChwYyA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgICByZXR1cm4gZ2V0U3RyYXRlZ3kocGMpLmdldERl\ndGFjaGVkT2JqZWN0SWQodGhpcywgcGMpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBnaXZlbiBvYmplY3QgaXMg\nbm90IG1hbmFnZWQ7IG90aGVyd2lzZQogICAgICogcmV0dXJuIGl0cyBzdGF0\nZSBtYW5hZ2VyLgogICAgICovCiAgICBTdGF0ZU1hbmFnZXJJbXBsIGFzc2Vy\ndE1hbmFnZWQoT2JqZWN0IG9iaikgewogICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgc20gPSBfYnJva2VyLmdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVl\nKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vdC1tYW5hZ2VkIiwKICAg\nICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcob2JqKSkpLnNldEZh\naWxlZE9iamVjdCAob2JqKTsKCQlyZXR1cm4gc207Cgl9Cn0K\n","encoding":"base64"}

