{"sha":"391051211e233d9e748e1ccefc8ec0d11b86da00","node_id":"MDQ6QmxvYjIwNjM2NDozOTEwNTEyMTFlMjMzZDllNzQ4ZTFjY2VmYzhlYzBkMTFiODZkYTAw","size":172229,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/391051211e233d9e748e1ccefc8ec0d11b86da00","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk9iamVjdElucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5PYmplY3RPdXRwdXRTdHJlYW07Cmlt\ncG9ydCBqYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEubGFuZy5y\nZWZsZWN0Lk1vZGlmaWVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nlc3ND\nb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFic3RyYWN0Q29sbGVjdGlv\nbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGph\ndmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rp\nb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxp\nbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50TG9jazsKCmltcG9ydCBq\nYXZheC50cmFuc2FjdGlvbi5TdGF0dXM7CmltcG9ydCBqYXZheC50cmFuc2Fj\ndGlvbi5TeW5jaHJvbml6YXRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNvbGxlY3Rpb25zLml0ZXJhdG9ycy5JdGVyYXRvckNoYWluOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5JZGVudGl0\neU1hcDsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5t\nYXAuTGlua2VkTWFwOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbGxl\nY3Rpb25zLnNldC5NYXBCYWNrZWRTZXQ7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5jb25mLkNvbXBhdGliaWxpdHk7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEuY29uZi5PcGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5kYXRhY2FjaGUuRGF0YUNhY2hlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmVlLk1hbmFnZWRSdW50aW1lOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLmVuaGFuY2UuUENSZWdpc3RyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBlcnNpc3RlbmNlQ2FwYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlJlZmxlY3Rpb247\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZl\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xl\nRXZlbnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmV2ZW50\nLlJlbW90ZUNvbW1pdEV2ZW50TWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5ldmVudC5UcmFuc2FjdGlvbkV2ZW50OwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmV2ZW50LlRyYW5zYWN0aW9uRXZlbnRNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkV4cHJlc3Np\nb25QYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLmNvbmYu\nQ29uZmlndXJhdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLmxvZy5Mb2c7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nSjJEb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxp\nYi51dGlsLlJlZmVyZW5jZUhhc2hNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnV0aWwuUmVmZXJlbmNlSGFzaFNldDsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS5saWIudXRpbC5SZWZlcmVuY2VNYXA7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS5tZXRhLk1ldGFEYXRhUmVwb3NpdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlNlcXVlbmNlTWV0YURhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5WYWx1ZU1ldGFEYXRh\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVTdHJhdGVn\naWVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuQXBwbGljYXRp\nb25JZHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5DYWxsYmFj\na0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkV4\nY2VwdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5HZW5l\ncmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwu\nSW1wbEhlbHBlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLklu\ndGVybmFsRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuSW52YWxpZFN0YXRlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuTm9UcmFuc2FjdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdEV4aXN0c0V4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9iamVjdElkOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT2JqZWN0Tm90Rm91bmRFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5PcGVuSlBB\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuT3B0\naW1pc3RpY0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51\ndGlsLlByb3h5OwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuUnVu\ndGltZUV4Y2VwdGlvblRyYW5zbGF0b3I7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEudXRpbC5TdG9yZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS51dGlsLlVuc3VwcG9ydGVkRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5vcGVuanBhLnV0aWwuVXNlckV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUub3BlbmpwYS51dGlsLldyYXBwZWRFeGNlcHRpb247CgovKioK\nICogQ29uY3JldGUge0BsaW5rIEJyb2tlcn0uIFRoZSBicm9rZXIgaGFuZGxl\ncyBvYmplY3QtbGV2ZWwgYmVoYXZpb3IsCiAqIGJ1dCBsZWF2ZXMgYWxsIGlu\ndGVyYWN0aW9uIHdpdGggdGhlIGRhdGEgc3RvcmUgdG8gYSB7QGxpbmsgU3Rv\ncmVNYW5hZ2VyfQogKiB0aGF0IG11c3QgYmUgc3VwcGxpZWQgYXQgaW5pdGlh\nbGl6YXRpb24uCiAqCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqLwpAU3VwcHJl\nc3NXYXJuaW5ncygic2VyaWFsIikKcHVibGljIGNsYXNzIEJyb2tlckltcGwK\nICAgIGltcGxlbWVudHMgQnJva2VyLCBGaW5kQ2FsbGJhY2tzLCBDbG9uZWFi\nbGUsIFNlcmlhbGl6YWJsZSB7CgogICAgLyoqCiAgICAgKiBJbmNyZW1lbnRh\nbCBmbHVzaC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBp\nbnQgRkxVU0hfSU5DID0gMDsKCiAgICAvKioKICAgICAqIEZsdXNoIGluIHBy\nZXBhcmF0aW9uIG9mIGNvbW1pdC4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0\nYXRpYyBmaW5hbCBpbnQgRkxVU0hfQ09NTUlUID0gMTsKCiAgICAvKioKICAg\nICAqIEZsdXNoIHRvIGNoZWNrIGNvbnNpc3RlbmN5IG9mIGNhY2hlLCB0aGVu\nIGltbWVkaWF0ZWx5IHJvbGxiYWNrIGNoYW5nZXMuCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBzdGF0aWMgZmluYWwgaW50IEZMVVNIX1JPTExCQUNLID0gMjsK\nCiAgICAvKioKICAgICAqIFJ1biBwZXJzaXN0ZW5jZS1ieS1yZWFjaGFiaWxp\ndHkgYW5kIG90aGVyIGZsdXNoLXRpbWUgb3BlcmF0aW9ucyB3aXRob3V0CiAg\nICAgKiBhY2Nlc3NpbmcgdGhlIGRhdGFiYXNlLgogICAgICovCiAgICBwcm90\nZWN0ZWQgc3RhdGljIGZpbmFsIGludCBGTFVTSF9MT0dJQ0FMID0gMzsKCiAg\nICBzdGF0aWMgZmluYWwgaW50IFNUQVRVU19JTklUID0gMDsKICAgIHN0YXRp\nYyBmaW5hbCBpbnQgU1RBVFVTX1RSQU5TSUVOVCA9IDE7CiAgICBzdGF0aWMg\nZmluYWwgaW50IFNUQVRVU19PSURfQVNTSUdOID0gMjsKICAgIHN0YXRpYyBm\naW5hbCBpbnQgU1RBVFVTX0NPTU1JVF9ORVcgPSAzOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIGludCBGTEFHX0FDVElWRSA9IDIgPDwgMDsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1NUT1JFX0FDVElWRSA9IDIg\nPDwgMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0NMT1NF\nX0lOVk9LRUQgPSAyIDw8IDI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19QUkVTVE9SSU5HID0gMiA8PCAzOwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgaW50IEZMQUdfREVSRUZERUxFVElORyA9IDIgPDwgNDsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0ZMVVNISU5HID0gMiA8\nPCA1OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfU1RPUkVf\nRkxVU0hJTkcgPSAyIDw8IDY7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgRkxBR19GTFVTSEVEID0gMiA8PCA3OwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEZMQUdfRkxVU0hfUkVRVUlSRUQgPSAyIDw8IDg7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19SRU1PVEVfTElTVEVORVIg\nPSAyIDw8IDk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19S\nRVRBSU5FRF9DT05OID0gMiA8PCAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBGTEFHX1RSQU5TX0VORElORyA9IDIgPDwgMTE7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgT2JqZWN0W10gRU1QVFlfT0JKRUNUUyA9IG5l\ndyBPYmplY3RbMF07CiAgICAKICAgIHByaXZhdGUgU3RyaW5nIF9jb25uZWN0\naW9uRmFjdG9yeU5hbWUgPSAiIjsKICAgIHByaXZhdGUgU3RyaW5nIF9jb25u\nZWN0aW9uRmFjdG9yeTJOYW1lID0gIiI7CgogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTG9jYWxpemVyIF9sb2MgPQogICAgICAgIExvY2FsaXplci5mb3JQ\nYWNrYWdlKEJyb2tlckltcGwuY2xhc3MpOwoKICAgIC8vCXRoZSBzdG9yZSBt\nYW5hZ2VyIGluIHVzZTsgdGhpcyBtYXkgYmUgYSBkZWNvcmF0b3Igc3VjaCBh\ncyBhCiAgICAvLwlkYXRhIGNhY2hlIHN0b3JlIG1hbmFnZXIgYXJvdW5kIHRo\nZSBuYXRpdmUgc3RvcmUgbWFuYWdlcgogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nRGVsZWdhdGluZ1N0b3JlTWFuYWdlciBfc3RvcmUgPSBudWxsOwoKICAgIHBy\naXZhdGUgRmV0Y2hDb25maWd1cmF0aW9uIF9mYyA9IG51bGw7CiAgICBwcml2\nYXRlIFN0cmluZyBfdXNlciA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBf\ncGFzcyA9IG51bGw7CgogICAgLy8gdGhlc2UgbXVzdCBiZSByZWJ1aWx0IGJ5\nIHRoZSBmYWNhZGUgbGF5ZXIgZHVyaW5nIGl0cyBkZXNlcmlhbGl6YXRpb24K\nICAgIHByaXZhdGUgdHJhbnNpZW50IExvZyBfbG9nID0gbnVsbDsKICAgIHBy\naXZhdGUgdHJhbnNpZW50IENvbXBhdGliaWxpdHkgX2NvbXBhdCA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBNYW5hZ2VkUnVudGltZSBfcnVudGlt\nZSA9IG51bGw7CiAgICBwcml2YXRlIHRyYW5zaWVudCBMb2NrTWFuYWdlciBf\nbG0gPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgSW52ZXJzZU1hbmFn\nZXIgX2ltID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IFJlZW50cmFu\ndExvY2sgX2xvY2sgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgT3BD\nYWxsYmFja3MgX2NhbGwgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3IgX2V4dHJhbnMgPSBudWxsOwoK\nICAgIC8vIHJlZiB0byBwcm9kdWNpbmcgZmFjdG9yeSBhbmQgY29uZmlndXJh\ndGlvbgogICAgcHJpdmF0ZSB0cmFuc2llbnQgQWJzdHJhY3RCcm9rZXJGYWN0\nb3J5IF9mYWN0b3J5ID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IE9w\nZW5KUEFDb25maWd1cmF0aW9uIF9jb25mID0gbnVsbDsKCiAgICAvLyBjYWNo\nZSBjbGFzcyBsb2FkZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBicm9rZXIKICAg\nIHByaXZhdGUgdHJhbnNpZW50IENsYXNzTG9hZGVyIF9sb2FkZXIgPSBudWxs\nOwoKICAgIC8vIHVzZXIgc3RhdGUKICAgIHByaXZhdGUgU3luY2hyb25pemF0\naW9uIF9zeW5jID0gbnVsbDsKICAgIHByaXZhdGUgTWFwPE9iamVjdCwgT2Jq\nZWN0PiBfdXNlck9iamVjdHMgPSBudWxsOwoKICAgIC8vIG1hbmFnZWQgb2Jq\nZWN0IGNhY2hlcwogICAgcHJpdmF0ZSBNYW5hZ2VkQ2FjaGUgX2NhY2hlID0g\nbnVsbDsKICAgIHByaXZhdGUgVHJhbnNhY3Rpb25hbENhY2hlIF90cmFuc0Nh\nY2hlID0gbnVsbDsKICAgIHByaXZhdGUgU2V0PFN0YXRlTWFuYWdlckltcGw+\nIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CiAgICBwcml2YXRlIFNldDxTdGF0\nZU1hbmFnZXJJbXBsPiBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICBwcml2YXRl\nIFNldDxTdGF0ZU1hbmFnZXJJbXBsPiBfZGVyZWZBZGRpdGlvbnMgPSBudWxs\nOwoKICAgIC8vIHRoZXNlIGFyZSB1c2VkIGZvciBtZXRob2QtaW50ZXJuYWwg\nc3RhdGUgb25seQogICAgcHJpdmF0ZSB0cmFuc2llbnQgTWFwPE9iamVjdCwg\nU3RhdGVNYW5hZ2VySW1wbD4gX2xvYWRpbmcgPSBudWxsOwogICAgcHJpdmF0\nZSB0cmFuc2llbnQgU2V0PE9iamVjdD4gX29wZXJhdGluZyA9IG51bGw7Cgog\nICAgcHJpdmF0ZSBTZXQ8Q2xhc3M8Pz4+IF9wZXJzaXN0ZWRDbHNzID0gbnVs\nbDsKICAgIHByaXZhdGUgU2V0PENsYXNzPD8+PiBfdXBkYXRlZENsc3MgPSBu\ndWxsOwogICAgcHJpdmF0ZSBTZXQ8Q2xhc3M8Pz4+IF9kZWxldGVkQ2xzcyA9\nIG51bGw7CiAgICBwcml2YXRlIFNldDxTdGF0ZU1hbmFnZXJJbXBsPiBfcGVu\nZGluZyA9IG51bGw7CiAgICBwcml2YXRlIGludCBmaW5kQWxsRGVwdGggPSAw\nOwoKICAgIC8vIHRyYWNrIGluc3RhbmNlcyB0aGF0IGJlY29tZSB0cmFuc2Fj\ndGlvbmFsIGFmdGVyIHRoZSBmaXJzdCBzYXZlcG9pbnQKICAgIC8vICh0aGUg\nZmlyc3QgdXNlcyB0aGUgdHJhbnNhY3Rpb25hbCBjYWNoZSkKICAgIHByaXZh\ndGUgU2V0PFN0YXRlTWFuYWdlckltcGw+IF9zYXZlcG9pbnRDYWNoZSA9IG51\nbGw7CiAgICBwcml2YXRlIExpbmtlZE1hcCBfc2F2ZXBvaW50cyA9IG51bGw7\nCiAgICBwcml2YXRlIHRyYW5zaWVudCBTYXZlcG9pbnRNYW5hZ2VyIF9zcG0g\nPSBudWxsOwoKICAgIC8vIHRyYWNrIG9wZW4gcXVlcmllcyBhbmQgZXh0ZW50\ncyBzbyB3ZSBjYW4gZnJlZSB0aGVpciByZXNvdXJjZXMgb24gY2xvc2UKICAg\nIHByaXZhdGUgdHJhbnNpZW50IFJlZmVyZW5jZUhhc2hTZXQgX3F1ZXJpZXMg\nPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVmZXJlbmNlSGFzaFNl\ndCBfZXh0ZW50cyA9IG51bGw7CgogICAgLy8gdHJhY2sgb3BlcmF0aW9uIHN0\nYWNrIGRlcHRoLiBUcmFuc2llbnQgYmVjYXVzZSBvcGVyYXRpb25zIGNhbm5v\ndAogICAgLy8gc3BhbiBzZXJpYWxpemF0aW9uLgogICAgcHJpdmF0ZSB0cmFu\nc2llbnQgaW50IF9vcGVyYXRpb25Db3VudCA9IDA7CgogICAgLy8gb3B0aW9u\ncwogICAgcHJpdmF0ZSBib29sZWFuIF9ub250cmFuc1JlYWQgPSBmYWxzZTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBfbm9udHJhbnNXcml0ZSA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9yZXRhaW5TdGF0ZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBpbnQgX2F1dG9DbGVhciA9IENMRUFSX0RBVEFTVE9SRTsKICAg\nIHByaXZhdGUgaW50IF9yZXN0b3JlU3RhdGUgPSBSRVNUT1JFX0lNTVVUQUJM\nRTsKICAgIHByaXZhdGUgYm9vbGVhbiBfb3B0aW1pc3RpYyA9IGZhbHNlOwog\nICAgcHJpdmF0ZSBib29sZWFuIF9pZ25vcmVDaGFuZ2VzID0gZmFsc2U7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX211bHRpdGhyZWFkZWQgPSBmYWxzZTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBfbWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0\nZSBib29sZWFuIF9zeW5jTWFuYWdlZCA9IGZhbHNlOwogICAgcHJpdmF0ZSBp\nbnQgX2Nvbm5SZXRhaW5Nb2RlID0gQ09OTl9SRVRBSU5fREVNQU5EOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9ldmljdERhdGFDYWNoZSA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBib29sZWFuIF9wb3B1bGF0ZURhdGFDYWNoZSA9IHRydWU7CiAg\nICBwcml2YXRlIGJvb2xlYW4gX2xhcmdlVHJhbnNhY3Rpb24gPSBmYWxzZTsK\nICAgIHByaXZhdGUgaW50IF9hdXRvRGV0YWNoID0gMDsKICAgIHByaXZhdGUg\naW50IF9kZXRhY2hTdGF0ZSA9IERFVEFDSF9MT0FERUQ7CiAgICBwcml2YXRl\nIGJvb2xlYW4gX2RldGFjaGVkTmV3ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfb3JkZXJEaXJ0eSA9IGZhbHNlOwogICAgcHJpdmF0ZSBib29sZWFu\nIF9jYWNoZVByZXBhcmVkUXVlcnkgPSB0cnVlOwogICAgcHJpdmF0ZSBib29s\nZWFuIF9jYWNoZUZpbmRlclF1ZXJ5ID0gdHJ1ZTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBfc3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcgPSBmYWxzZTsKCiAgICAv\nLyBzdGF0dXMKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CgogICAgLy8g\ndGhpcyBpcyBub3QgaW4gc3RhdHVzIGJlY2F1c2UgaXQgc2hvdWxkIG5vdCBi\nZSBzZXJpYWxpemVkCiAgICBwcml2YXRlIHRyYW5zaWVudCBib29sZWFuIF9p\nc1NlcmlhbGl6aW5nID0gZmFsc2U7CgogICAgLy8gdHJhbnNpZW50IGJlY2F1\nc2UgY2xvc2VkIGJyb2tlcnMgY2FuJ3QgYmUgc2VyaWFsaXplZAogICAgcHJp\ndmF0ZSB0cmFuc2llbnQgYm9vbGVhbiBfY2xvc2VkID0gZmFsc2U7CiAgICBw\ncml2YXRlIHRyYW5zaWVudCBSdW50aW1lRXhjZXB0aW9uIF9jbG9zZWRFeGNl\ncHRpb24gPSBudWxsOwoKICAgIC8vIGV2ZW50IG1hbmFnZXJzCiAgICBwcml2\nYXRlIFRyYW5zYWN0aW9uRXZlbnRNYW5hZ2VyIF90cmFuc0V2ZW50TWFuYWdl\nciA9IG51bGw7CiAgICBwcml2YXRlIGludCBfdHJhbnNDYWxsYmFja01vZGUg\nPSAwOwogICAgcHJpdmF0ZSBMaWZlY3ljbGVFdmVudE1hbmFnZXIgX2xpZmVF\ndmVudE1hbmFnZXIgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQgX2xpZmVDYWxs\nYmFja01vZGUgPSAwOwoKICAgIHByaXZhdGUgdHJhbnNpZW50IERldGFjaE1h\nbmFnZXJMaXRlIF9kbUxpdGUgPSBuZXcgRGV0YWNoTWFuYWdlckxpdGUoKTsK\nICAgIAogICAgcHJpdmF0ZSB0cmFuc2llbnQgYm9vbGVhbiBfaW5pdGlhbGl6\nZVdhc0ludm9rZWQgPSBmYWxzZTsKICAgIHByaXZhdGUgdHJhbnNpZW50IGJv\nb2xlYW4gX2Zyb21Xcml0ZUJlaGluZENhbGxiYWNrID0gZmFsc2U7CiAgICBw\ncml2YXRlIExpbmtlZExpc3Q8RmV0Y2hDb25maWd1cmF0aW9uPiBfZmNzOwog\nICAgCiAgICAvLyBTZXQgb2Ygc3VwcG9ydGVkIHByb3BlcnR5IGtleXMuIFRo\nZSBrZXlzIGluIHRoaXMgc2V0IGNvcnJlc3BvbmQgdG8gYmVhbi1zdHlsZSBz\nZXR0ZXIgbWV0aG9kcwogICAgLy8gdGhhdCBjYW4gYmUgc2V0IGJ5IHJlZmxl\nY3Rpb24uIFRoZSBrZXlzIGFyZSBub3QgcXVhbGlmaWVkIGJ5IGFueSBwcmVm\naXguCiAgICBwcml2YXRlIHN0YXRpYyBTZXQ8U3RyaW5nPiBfc3VwcG9ydGVk\nUHJvcGVydHlOYW1lczsKICAgIHN0YXRpYyB7CiAgICAgICAgX3N1cHBvcnRl\nZFByb3BlcnR5TmFtZXMgPSBuZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAg\nICAgX3N1cHBvcnRlZFByb3BlcnR5TmFtZXMuYWRkQWxsKEFycmF5cy5hc0xp\nc3QobmV3IFN0cmluZ1tdIHsKICAgICAgICAgICAgICAgICJBdXRvQ2xlYXIi\nLCAKICAgICAgICAgICAgICAgICJBdXRvRGV0YWNoIiwgCiAgICAgICAgICAg\nICAgICAiQ2FjaGVGaW5kZXJRdWVyeSIsIAogICAgICAgICAgICAgICAgIkNh\nY2hlUHJlcGFyZWRRdWVyeSIsIAogICAgICAgICAgICAgICAgIkRldGFjaGVk\nTmV3IiwgCiAgICAgICAgICAgICAgICAiRGV0YWNoU3RhdGUiLCAKICAgICAg\nICAgICAgICAgICJFdmljdEZyb21EYXRhQ2FjaGUiLCAKICAgICAgICAgICAg\nICAgICJJZ25vcmVDaGFuZ2VzIiwgCiAgICAgICAgICAgICAgICAiTGlmZWN5\nY2xlTGlzdGVuZXJDYWxsYmFja01vZGUiLCAKICAgICAgICAgICAgICAgICJN\ndWx0aXRocmVhZGVkIiwgCiAgICAgICAgICAgICAgICAiTm9udHJhbnNhY3Rp\nb25hbFJlYWQiLCAKICAgICAgICAgICAgICAgICJOb250cmFuc2FjdGlvbmFs\nV3JpdGUiLCAKICAgICAgICAgICAgICAgICJPcHRpbWlzdGljIiwgCiAgICAg\nICAgICAgICAgICAiUG9wdWxhdGVEYXRhQ2FjaGUiLAogICAgICAgICAgICAg\nICAgIlJlc3RvcmVTdGF0ZSIsIAogICAgICAgICAgICAgICAgIlJldGFpblN0\nYXRlIiwKICAgICAgICAgICAgICAgIH0pKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFNldCB0aGUgcGVyc2lzdGVuY2UgbWFuYWdlcidzIGF1dGhlbnRpY2F0\naW9uLiBUaGlzIGlzIHRoZSBmaXJzdAogICAgICogbWV0aG9kIGNhbGxlZCBh\nZnRlciBjb25zdHJ1Y3Rpb24uCiAgICAgKgogICAgICogQHBhcmFtIHVzZXIg\ndGhlIHVzZXJuYW1lIHRoaXMgYnJva2VyIHJlcHJlc2VudHM7IHVzZWQgd2hl\nbiBwb29saW5nCiAgICAgKiBicm9rZXJzIHRvIG1ha2Ugc3VyZSB0aGF0IGEg\ncmVxdWVzdCB0byB0aGUgZmFjdG9yeSBmb3IKICAgICAqIGEgY29ubmVjdGlv\nbiB3aXRoIGFuIGV4cGxpY2l0IHVzZXIgaXMgZGVsZWdhdGVkIHRvIGEgc3Vp\ndGFibGUgYnJva2VyCiAgICAgKiBAcGFyYW0gcGFzcyB0aGUgcGFzc3dvcmQg\nZm9yIHRoZSBhYm92ZSB1c2VyCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNl\ndEF1dGhlbnRpY2F0aW9uKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFzcykgewog\nICAgICAgIF91c2VyID0gdXNlcjsKICAgICAgICBfcGFzcyA9IHBhc3M7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIHRoZSBwZXJzaXN0ZW5j\nZSBtYW5hZ2VyLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQKICAgICAqIGF1dG9t\nYXRpY2FsbHkgYnkgdGhlIGZhY3RvcnkgYmVmb3JlIHVzZS4KICAgICAqCiAg\nICAgKiBAcGFyYW0gZmFjdG9yeSB0aGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0\nZSB0aGlzIGJyb2tlcgogICAgICogQHBhcmFtIHNtIGEgY29uY3JldGUgU3Rv\ncmVNYW5hZ2VyIGltcGxlbWVudGF0aW9uIHRvCiAgICAgKiBoYW5kbGUgaW50\nZXJhY3Rpb24gd2l0aCB0aGUgZGF0YSBzdG9yZQogICAgICogQHBhcmFtIG1h\nbmFnZWQgdGhlIHRyYW5zYWN0aW9uIG1vZGUKICAgICAqIEBwYXJhbSBjb25u\nTW9kZSB0aGUgY29ubmVjdGlvbiByZXRhaW4gbW9kZQogICAgICogQHBhcmFt\nIGZyb21EZXNlcmlhbGl6YXRpb24gd2hldGhlciB0aGlzIGNhbGwgaGFwcGVu\nZWQgYmVjYXVzZSBvZiBhCiAgICAgKiBkZXNlcmlhbGl6YXRpb24gb3IgY3Jl\nYXRpb24gb2YgYSBuZXcgQnJva2VySW1wbC4KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgaW5pdGlhbGl6ZShBYnN0cmFjdEJyb2tlckZhY3RvcnkgZmFjdG9y\neSwKICAgICAgICBEZWxlZ2F0aW5nU3RvcmVNYW5hZ2VyIHNtLCBib29sZWFu\nIG1hbmFnZWQsIGludCBjb25uTW9kZSwKICAgICAgICBib29sZWFuIGZyb21E\nZXNlcmlhbGl6YXRpb24pIHsKICAgICAgICBpbml0aWFsaXplKGZhY3Rvcnks\nIHNtLCBtYW5hZ2VkLCBjb25uTW9kZSwgZnJvbURlc2VyaWFsaXphdGlvbiwg\nZmFsc2UpOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBpbml0aWFsaXpl\nKEFic3RyYWN0QnJva2VyRmFjdG9yeSBmYWN0b3J5LAogICAgICAgIERlbGVn\nYXRpbmdTdG9yZU1hbmFnZXIgc20sIGJvb2xlYW4gbWFuYWdlZCwgaW50IGNv\nbm5Nb2RlLAogICAgICAgIGJvb2xlYW4gZnJvbURlc2VyaWFsaXphdGlvbiwg\nYm9vbGVhbiBmcm9tV3JpdGVCZWhpbmRDYWxsYmFjaykgewogICAgICAgIF9m\ncm9tV3JpdGVCZWhpbmRDYWxsYmFjayA9IGZyb21Xcml0ZUJlaGluZENhbGxi\nYWNrOwogICAgICAgIF9pbml0aWFsaXplV2FzSW52b2tlZCA9IHRydWU7CiAg\nICAgICAgX2xvYWRlciA9IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2Vk\nKAogICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5nZXRDb250ZXh0Q2xhc3NM\nb2FkZXJBY3Rpb24oKSk7CiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxpemF0\naW9uKQogICAgICAgICAgICBfY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmlndXJh\ndGlvbigpOwogICAgICAgIF9jb21wYXQgPSBfY29uZi5nZXRDb21wYXRpYmls\naXR5SW5zdGFuY2UoKTsKICAgICAgICBfZmFjdG9yeSA9IGZhY3Rvcnk7CiAg\nICAgICAgX2xvZyA9IF9jb25mLmdldExvZyhPcGVuSlBBQ29uZmlndXJhdGlv\nbi5MT0dfUlVOVElNRSk7CiAgICAgICAgaWYgKCFmcm9tRGVzZXJpYWxpemF0\naW9uKQogICAgICAgICAgICBfY2FjaGUgPSBuZXcgTWFuYWdlZENhY2hlKHRo\naXMpOwogICAgICAgIGluaXRpYWxpemVPcGVyYXRpbmdTZXQoKTsKICAgICAg\nICBfY29ublJldGFpbk1vZGUgPSBjb25uTW9kZTsKICAgICAgICBfbWFuYWdl\nZCA9IG1hbmFnZWQ7CiAgICAgICAgaWYgKG1hbmFnZWQpCiAgICAgICAgICAg\nIF9ydW50aW1lID0gX2NvbmYuZ2V0TWFuYWdlZFJ1bnRpbWVJbnN0YW5jZSgp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX3J1bnRpbWUgPSBuZXcgTG9j\nYWxNYW5hZ2VkUnVudGltZSh0aGlzKTsKCiAgICAgICAgaWYgKCFmcm9tRGVz\nZXJpYWxpemF0aW9uKSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRNYW5hZ2Vy\nID0gX2NvbmYuZ2V0TGlmZWN5Y2xlRXZlbnRNYW5hZ2VySW5zdGFuY2UoKTsK\nICAgICAgICAgICAgX3RyYW5zRXZlbnRNYW5hZ2VyID0gbmV3IFRyYW5zYWN0\naW9uRXZlbnRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGludCBjbW9kZSA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YUZhY3RvcnkoKS5nZXREZWZhdWx0cygpLmdl\ndENhbGxiYWNrTW9kZSgpOwogICAgICAgICAgICBzZXRMaWZlY3ljbGVMaXN0\nZW5lckNhbGxiYWNrTW9kZShjbW9kZSk7CiAgICAgICAgICAgIHNldFRyYW5z\nYWN0aW9uTGlzdGVuZXJDYWxsYmFja01vZGUoY21vZGUpOwoKICAgICAgICAg\nICAgLy8gc2V0dXAgZGVmYXVsdCBvcHRpb25zCiAgICAgICAgICAgIF9mYWN0\nb3J5LmNvbmZpZ3VyZUJyb2tlcih0aGlzKTsKICAgICAgICB9CgogICAgICAg\nIC8vIG1ha2Ugc3VyZSB0byBkbyB0aGlzIGFmdGVyIGNvbmZpZ3VyaW5nIGJy\nb2tlciBzbyB0aGF0IHN0b3JlIG1hbmFnZXIKICAgICAgICAvLyBjYW4gbG9v\nayB0byBicm9rZXIgY29uZmlndXJhdGlvbjsgd2Ugc2V0IGJvdGggc3RvcmUg\nYW5kIGxvY2sgbWFuYWdlcnMKICAgICAgICAvLyBiZWZvcmUgaW5pdGlhbGl6\naW5nIHRoZW0gYmVjYXVzZSB0aGV5IG1heSBlYWNoIHRyeSB0byBhY2Nlc3Mg\ndGhlCiAgICAgICAgLy8gb3RoZXIgaW4gdGhlaXIgaW5pdGlhbGl6YXRpb24K\nICAgICAgICBfc3RvcmUgPSBzbTsKICAgICAgICBfbG0gPSBfY29uZi5uZXdM\nb2NrTWFuYWdlckluc3RhbmNlKCk7CiAgICAgICAgX2ltID0gX2NvbmYubmV3\nSW52ZXJzZU1hbmFnZXJJbnN0YW5jZSgpOwogICAgICAgIF9zcG0gPSBfY29u\nZi5nZXRTYXZlcG9pbnRNYW5hZ2VySW5zdGFuY2UoKTsKICAgICAgICBfc3Rv\ncmUuc2V0Q29udGV4dCh0aGlzKTsKICAgICAgICBfbG0uc2V0Q29udGV4dCh0\naGlzKTsKCiAgICAgICAgaWYgKF9jb25uUmV0YWluTW9kZSA9PSBDT05OX1JF\nVEFJTl9BTFdBWVMpCiAgICAgICAgICAgIHJldGFpbkNvbm5lY3Rpb24oKTsK\nICAgICAgICBpZiAoIWZyb21EZXNlcmlhbGl6YXRpb24pIHsKICAgICAgICAg\nICAgX2ZjID0gX3N0b3JlLm5ld0ZldGNoQ29uZmlndXJhdGlvbigpOwogICAg\nICAgICAgICBfZmMuc2V0Q29udGV4dCh0aGlzKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHN5bmNoIHdpdGggdGhlIGdsb2JhbCB0cmFuc2FjdGlvbiBpbiBw\ncm9ncmVzcywgaWYgYW55CiAgICAgICAgaWYgKF9mYWN0b3J5LnN5bmNXaXRo\nTWFuYWdlZFRyYW5zYWN0aW9uKHRoaXMsIGZhbHNlKSkKICAgICAgICAgICAg\nYmVnaW5JbnRlcm5hbCgpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBpbml0\naWFsaXplT3BlcmF0aW5nU2V0KCkgewogICAgICAgIF9vcGVyYXRpbmcgPSBN\nYXBCYWNrZWRTZXQuZGVjb3JhdGUobmV3IElkZW50aXR5TWFwKCkpOwogICAg\nfQogICAgCiAgICAvKioKICAgICAqIEdldHMgdGhlIHVubW9kaWZpYWJsZSBz\nZXQgb2YgaW5zdGFuY2VzIGJlaW5nIG9wZXJhdGVkLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgU2V0PE9iamVjdD4gZ2V0T3BlcmF0aW5nU2V0KCkgewogICAg\nCXJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVTZXQoX29wZXJhdGlu\nZyk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBjbG9uZSgpCiAgICAgICAg\ndGhyb3dzIENsb25lTm90U3VwcG9ydGVkRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoX2luaXRpYWxpemVXYXNJbnZva2VkKQogICAgICAgICAgICB0aHJvdyBu\nZXcgQ2xvbmVOb3RTdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEge0BsaW5rIE1hcH0g\ndG8gYmUgdXNlZCBmb3IgdGhlIHByaW1hcnkgbWFuYWdlZCBvYmplY3QgY2Fj\naGUuCiAgICAgKiBNYXBzIG9pZHMgdG8gc3RhdGUgbWFuYWdlcnMuIEJ5IGRl\nZmF1bHQsIHRoaXMgY3JlYXRlcyBhCiAgICAgKiB7QGxpbmsgUmVmZXJlbmNl\nTWFwfSB3aXRoIHNvZnQgdmFsdWVzLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nTWFwPD8sPz4gbmV3TWFuYWdlZE9iamVjdENhY2hlKCkgewogICAgICAgIHJl\ndHVybiBuZXcgUmVmZXJlbmNlSGFzaE1hcChSZWZlcmVuY2VNYXAuSEFSRCwg\nUmVmZXJlbmNlTWFwLlNPRlQpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEltcGxlbWVudGF0aW9uIG9m\nIFN0b3JlQ29udGV4dAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLwoKICAgIHB1YmxpYyBCcm9rZXIgZ2V0QnJva2VyKCkgewogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vCiAg\nICAvLyBQcm9wZXJ0aWVzCiAgICAvLy8vLy8vLy8vLy8vLwoKICAgIHB1Ymxp\nYyB2b2lkIHNldEltcGxpY2l0QmVoYXZpb3IoT3BDYWxsYmFja3MgY2FsbCwK\nICAgICAgICBSdW50aW1lRXhjZXB0aW9uVHJhbnNsYXRvciBleCkgewogICAg\nICAgIGlmIChfY2FsbCA9PSBudWxsKQogICAgICAgICAgICBfY2FsbCA9IGNh\nbGw7CiAgICAgICAgaWYgKF9leHRyYW5zID09IG51bGwpCiAgICAgICAgICAg\nIF9leHRyYW5zID0gZXg7CiAgICB9CgogICAgUnVudGltZUV4Y2VwdGlvblRy\nYW5zbGF0b3IgZ2V0SW5zdGFuY2VFeGNlcHRpb25UcmFuc2xhdG9yKCkgewog\nICAgICAgIHJldHVybiAoX29wZXJhdGlvbkNvdW50ID09IDApID8gX2V4dHJh\nbnMgOiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBCcm9rZXJGYWN0b3J5IGdl\ndEJyb2tlckZhY3RvcnkoKSB7CiAgICAgICAgcmV0dXJuIF9mYWN0b3J5Owog\nICAgfQoKICAgIHB1YmxpYyBPcGVuSlBBQ29uZmlndXJhdGlvbiBnZXRDb25m\naWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBfY29uZjsKICAgIH0KCiAg\nICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIGdldEZldGNoQ29uZmlndXJh\ndGlvbigpIHsKICAgICAgICByZXR1cm4gX2ZjOwogICAgfQoKICAgIHB1Ymxp\nYyBGZXRjaENvbmZpZ3VyYXRpb24gcHVzaEZldGNoQ29uZmlndXJhdGlvbigp\nIHsKICAgICAgICBpZiAoX2ZjcyA9PSBudWxsKQogICAgICAgICAgICBfZmNz\nID0gbmV3IExpbmtlZExpc3Q8RmV0Y2hDb25maWd1cmF0aW9uPigpOwogICAg\nICAgIF9mY3MuYWRkKF9mYyk7CiAgICAgICAgX2ZjID0gKEZldGNoQ29uZmln\ndXJhdGlvbikgX2ZjLmNsb25lKCk7CiAgICAgICAgcmV0dXJuIF9mYzsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBwb3BGZXRjaENvbmZpZ3VyYXRpb24oKSB7\nCiAgICAgICAgaWYgKF9mY3MgPT0gbnVsbCB8fCBfZmNzLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgICAgX2xvYy5nZXQoImZldGNoLWNvbmZpZ3VyYXRpb24tc3Rh\nY2stZW1wdHkiKSk7CiAgICAgICAgX2ZjID0gX2Zjcy5yZW1vdmVMYXN0KCk7\nCiAgICB9CgogICAgcHVibGljIGludCBnZXRDb25uZWN0aW9uUmV0YWluTW9k\nZSgpIHsKICAgICAgICByZXR1cm4gX2Nvbm5SZXRhaW5Nb2RlOwogICAgfQoK\nICAgIHB1YmxpYyBib29sZWFuIGlzTWFuYWdlZCgpIHsKICAgICAgICByZXR1\ncm4gX21hbmFnZWQ7CiAgICB9CgogICAgcHVibGljIE1hbmFnZWRSdW50aW1l\nIGdldE1hbmFnZWRSdW50aW1lKCkgewogICAgICAgIHJldHVybiBfcnVudGlt\nZTsKICAgIH0KCiAgICBwdWJsaWMgQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NMb2Fk\nZXIoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkZXI7CiAgICB9CgogICAgcHVi\nbGljIERlbGVnYXRpbmdTdG9yZU1hbmFnZXIgZ2V0U3RvcmVNYW5hZ2VyKCkg\newogICAgICAgIHJldHVybiBfc3RvcmU7CiAgICB9CgogICAgcHVibGljIExv\nY2tNYW5hZ2VyIGdldExvY2tNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBf\nbG07CiAgICB9CgogICAgcHVibGljIEludmVyc2VNYW5hZ2VyIGdldEludmVy\nc2VNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBfaW07CiAgICB9CgogICAg\ncHVibGljIFN0cmluZyBnZXRDb25uZWN0aW9uVXNlck5hbWUoKSB7CiAgICAg\nICAgcmV0dXJuIF91c2VyOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQ29ubmVjdGlvblBhc3N3b3JkKCkgewogICAgICAgIHJldHVybiBfcGFzczsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRNdWx0aXRocmVhZGVkKCkg\newogICAgICAgIHJldHVybiBfbXVsdGl0aHJlYWRlZDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRNdWx0aXRocmVhZGVkKGJvb2xlYW4gbXVsdGl0aHJl\nYWRlZCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfbXVsdGl0\naHJlYWRlZCA9IG11bHRpdGhyZWFkZWQ7CiAgICAgICAgaWYgKG11bHRpdGhy\nZWFkZWQgJiYgX2xvY2sgPT0gbnVsbCkKICAgICAgICAgICAgX2xvY2sgPSBu\nZXcgUmVlbnRyYW50TG9jaygpOwogICAgICAgIGVsc2UgaWYgKCFtdWx0aXRo\ncmVhZGVkKQogICAgICAgICAgICBfbG9jayA9IG51bGw7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsKICAgICAgICBy\nZXR1cm4gX2lnbm9yZUNoYW5nZXM7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0SWdub3JlQ2hhbmdlcyhib29sZWFuIHZhbCkgewogICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IHZhbDsKICAgIH0K\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb250cmFuc2FjdGlvbmFsUmVhZCgp\nIHsKICAgICAgICByZXR1cm4gX25vbnRyYW5zUmVhZDsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXROb250cmFuc2FjdGlvbmFsUmVhZChib29sZWFuIHZh\nbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoKF9mbGFn\ncyAmIEZMQUdfUFJFU1RPUklORykgIT0gMCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImlsbGVnYWwtb3AtaW4tcHJl\nc3RvcmUiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBz\ndXBwb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRl\nZE9wdGlvbnMoKS5jb250YWlucwogICAgICAgICAgICAoT3BlbkpQQUNvbmZp\nZ3VyYXRpb24uT1BUSU9OX05PTlRSQU5TX1JFQUQpKQogICAgICAgICAgICB0\naHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAg\nICAgICAgICAgICgibm9udHJhbnMtcmVhZC1ub3Qtc3VwcG9ydGVkIikpOwoK\nICAgICAgICBfbm9udHJhbnNSZWFkID0gdmFsOwogICAgfQoKICAgIHB1Ymxp\nYyBib29sZWFuIGdldE5vbnRyYW5zYWN0aW9uYWxXcml0ZSgpIHsKICAgICAg\nICByZXR1cm4gX25vbnRyYW5zV3JpdGU7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKGJvb2xlYW4gdmFsKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19QUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIp\nKTsKCiAgICAgICAgX25vbnRyYW5zV3JpdGUgPSB2YWw7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gZ2V0T3B0aW1pc3RpYygpIHsKICAgICAgICByZXR1\ncm4gX29wdGltaXN0aWM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T3B0\naW1pc3RpYyhib29sZWFuIHZhbCkgewogICAgICAgIGFzc2VydE9wZW4oKTsK\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJ0cmFucy1hY3RpdmUiLAogICAgICAgICAgICAgICAgIk9wdGltaXN0\naWMiKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBw\nb3J0cyBpdAogICAgICAgIGlmICh2YWwgJiYgIV9jb25mLnN1cHBvcnRlZE9w\ndGlvbnMoKS5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05f\nT1BUSU1JU1RJQykpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRl\nZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgKCJvcHRpbWlz\ndGljLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAgIF9vcHRpbWlzdGljID0g\ndmFsOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0UmVzdG9yZVN0YXRlKCkg\newogICAgICAgIHJldHVybiBfcmVzdG9yZVN0YXRlOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFJlc3RvcmVTdGF0ZShpbnQgdmFsKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDApCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQoInRyYW5zLWFjdGl2ZSIsCiAgICAgICAgICAg\nICAgICAiUmVzdG9yZSIpKTsKCiAgICAgICAgX3Jlc3RvcmVTdGF0ZSA9IHZh\nbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSZXRhaW5TdGF0ZSgp\nIHsKICAgICAgICByZXR1cm4gX3JldGFpblN0YXRlOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldFJldGFpblN0YXRlKGJvb2xlYW4gdmFsKSB7CiAgICAg\nICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19Q\nUkVTVE9SSU5HKSAhPSAwKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihfbG9jLmdldCgiaWxsZWdhbC1vcC1pbi1wcmVzdG9yZSIpKTsK\nICAgICAgICBfcmV0YWluU3RhdGUgPSB2YWw7CiAgICB9CgogICAgcHVibGlj\nIGludCBnZXRBdXRvQ2xlYXIoKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvQ2xl\nYXI7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0NsZWFyKGludCB2\nYWwpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2F1dG9DbGVh\nciA9IHZhbDsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEF1dG9EZXRhY2go\nKSB7CiAgICAgICAgcmV0dXJuIF9hdXRvRGV0YWNoOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldEF1dG9EZXRhY2goaW50IGRldGFjaEZsYWdzKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9hdXRvRGV0YWNoID0gZGV0\nYWNoRmxhZ3M7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0QXV0b0RldGFj\naChpbnQgZGV0YWNoRmxhZywgYm9vbGVhbiBvbikgewogICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICBpZiAob24pCiAgICAgICAgICAgIF9hdXRvRGV0\nYWNoIHw9IGRldGFjaEZsYWc7CiAgICAgICAgZWxzZQogICAgICAgICAgICBf\nYXV0b0RldGFjaCAmPSB+ZGV0YWNoRmxhZzsKICAgIH0KCiAgICBwdWJsaWMg\naW50IGdldERldGFjaFN0YXRlKCkgewogICAgICAgIHJldHVybiBfZGV0YWNo\nU3RhdGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoU3RhdGUo\naW50IG1vZGUpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgX2Rl\ndGFjaFN0YXRlID0gbW9kZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc0RldGFjaGVkTmV3KCkgewogICAgICAgIHJldHVybiBfZGV0YWNoZWROZXc7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0RGV0YWNoZWROZXcoYm9vbGVh\nbiBpc05ldykgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBfZGV0\nYWNoZWROZXcgPSBpc05ldzsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRTeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoKSB7CiAgICAgICAgcmV0\ndXJuIF9zeW5jTWFuYWdlZDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRT\neW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbnMoYm9vbGVhbiBzeW5jKSB7CiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5jTWFuYWdlZCA9IHN5\nbmM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0RXZpY3RGcm9tRGF0\nYUNhY2hlKCkgewogICAgICAgIHJldHVybiBfZXZpY3REYXRhQ2FjaGU7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgc2V0RXZpY3RGcm9tRGF0YUNhY2hlKGJv\nb2xlYW4gZXZpY3QpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nX2V2aWN0RGF0YUNhY2hlID0gZXZpY3Q7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gZ2V0UG9wdWxhdGVEYXRhQ2FjaGUoKSB7CiAgICAgICAgcmV0dXJu\nIF9wb3B1bGF0ZURhdGFDYWNoZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRQb3B1bGF0ZURhdGFDYWNoZShib29sZWFuIGNhY2hlKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIF9wb3B1bGF0ZURhdGFDYWNoZSA9IGNh\nY2hlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzVHJhY2tDaGFuZ2Vz\nQnlUeXBlKCkgewogICAgICAgIHJldHVybiBfbGFyZ2VUcmFuc2FjdGlvbjsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUcmFja0NoYW5nZXNCeVR5cGUo\nYm9vbGVhbiBsYXJnZVRyYW5zYWN0aW9uKSB7CiAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgIF9sYXJnZVRyYW5zYWN0aW9uID0gbGFyZ2VUcmFuc2Fj\ndGlvbjsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldFVzZXJPYmplY3Qo\nT2JqZWN0IGtleSkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF91c2VyT2JqZWN0\ncyA9PSBudWxsKSA/IG51bGwgOiBfdXNlck9iamVjdHMuZ2V0KGtleSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgcHV0VXNlck9i\namVjdChPYmplY3Qga2V5LCBPYmplY3QgdmFsKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICh2YWwgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiAoX3VzZXJP\nYmplY3RzID09IG51bGwpID8gbnVsbCA6IF91c2VyT2JqZWN0cy5yZW1vdmUo\na2V5KTsKCiAgICAgICAgICAgIGlmIChfdXNlck9iamVjdHMgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIF91c2VyT2JqZWN0cyA9IG5ldyBIYXNoTWFwPE9i\namVjdCwgT2JqZWN0PigpOwogICAgICAgICAgICByZXR1cm4gX3VzZXJPYmpl\nY3RzLnB1dChrZXksIHZhbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogR2V0IGN1cnJlbnQgY29uZmlndXJhdGlvbiBwcm9wZXJ0eSB2\nYWx1ZXMgdXNlZCBieSB0aGlzIGluc3RhbmNlLgogICAgICogVGhpcyB2YWx1\nZXMgYXJlIGNvbWJpbmF0aW9uIG9mIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRp\nb24gdmFsdWVzIAogICAgICogb3ZlcndyaXR0ZW4gYnkgdmFsdWVzIG1haW50\nYWluZWQgYnkgdGhpcyBpbnN0YW5jZSBzdWNoIGFzCiAgICAgKiBPcHRpbWlz\ndGljIGZsYWcuIAogICAgICovCiAgICBwdWJsaWMgTWFwPFN0cmluZywgT2Jq\nZWN0PiBnZXRQcm9wZXJ0aWVzKCkgewogICAgICAgIE1hcDxTdHJpbmcsIE9i\namVjdD4gcHJvcHMgPSBfY29uZi50b1Byb3BlcnRpZXModHJ1ZSk7CiAgICAg\nICAgZm9yIChTdHJpbmcgcyA6IF9zdXBwb3J0ZWRQcm9wZXJ0eU5hbWVzKSB7\nCiAgICAgICAgICAgIHByb3BzLnB1dCgib3BlbmpwYS4iICsgcywgUmVmbGVj\ndGlvbi5nZXRWYWx1ZSh0aGlzLCBzLCB0cnVlKSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBwcm9wczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBH\nZXRzIHRoZSBwcm9wZXJ0eSBuYW1lcyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNv\ncnJlc3BvbmRpbmcgc2V0dGVyIG1ldGhvZHMgb2YgdGhpcyByZWNlaXZlcgog\nICAgICogdG8gc2V0IGl0cyB2YWx1ZS4KICAgICAqLyAgICAKICAgIHB1Ymxp\nYyBTZXQ8U3RyaW5nPiBnZXRTdXBwb3J0ZWRQcm9wZXJ0aWVzKCkgewogICAg\nICAgIFNldDxTdHJpbmc+IGtleXMgPSBfY29uZi5nZXRQcm9wZXJ0eUtleXMo\nKTsKICAgICAgICBmb3IgKFN0cmluZyBzIDogX3N1cHBvcnRlZFByb3BlcnR5\nTmFtZXMpCiAgICAgICAgICAgIGtleXMuYWRkKCJvcGVuanBhLiIgKyBzKTsK\nICAgICAgICByZXR1cm4ga2V5czsKICAgIH0KCiAgICAvLyAvLy8vLy8vLwog\nICAgLy8gRXZlbnRzCiAgICAvLyAvLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lk\nIGFkZExpZmVjeWNsZUxpc3RlbmVyKE9iamVjdCBsaXN0ZW5lciwgQ2xhc3Nb\nXSBjbGFzc2VzKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRNYW5hZ2VyLmFk\nZExpc3RlbmVyKGxpc3RlbmVyLCBjbGFzc2VzKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlTGlmZWN5Y2xlTGlzdGVuZXIo\nT2JqZWN0IGxpc3RlbmVyKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFs\nc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9saWZlRXZlbnRNYW5h\nZ2VyLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIGludCBnZXRMaWZlY3ljbGVMaXN0ZW5lckNhbGxi\nYWNrTW9kZSgpIHsKICAgICAgICByZXR1cm4gX2xpZmVDYWxsYmFja01vZGU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TGlmZWN5Y2xlTGlzdGVuZXJD\nYWxsYmFja01vZGUoaW50IG1vZGUpIHsKICAgICAgICBiZWdpbk9wZXJhdGlv\nbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2xpZmVDYWxs\nYmFja01vZGUgPSBtb2RlOwogICAgICAgICAgICBfbGlmZUV2ZW50TWFuYWdl\nci5zZXRGYWlsRmFzdCgobW9kZSAmIENBTExCQUNLX0ZBSUxfRkFTVCkgIT0g\nMCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2l2ZSBz\ndGF0ZSBtYW5hZ2VycyBhY2Nlc3MgdG8gdGhlIGxpZmVjeWNsZSBldmVudCBt\nYW5hZ2VyLgogICAgICovCiAgICBwdWJsaWMgTGlmZWN5Y2xlRXZlbnRNYW5h\nZ2VyIGdldExpZmVjeWNsZUV2ZW50TWFuYWdlcigpIHsKICAgICAgICByZXR1\ncm4gX2xpZmVFdmVudE1hbmFnZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBG\naXJlIGdpdmVuIGxpZmVjeWNsZSBldmVudCwgaGFuZGxpbmcgYW55IGV4Y2Vw\ndGlvbnMgYXBwcm9wcmlhdGVseS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHdo\nZXRoZXIgZXZlbnRzIGFyZSBiZWluZyBwcm9jZXNzZWQgYXQgdGhpcyB0aW1l\nCiAgICAgKi8KICAgIGJvb2xlYW4gZmlyZUxpZmVjeWNsZUV2ZW50KE9iamVj\ndCBzcmMsIE9iamVjdCByZWxhdGVkLCBDbGFzc01ldGFEYXRhIG1ldGEsCiAg\nICAgICAgaW50IGV2ZW50VHlwZSkgewogICAgICAgIGlmIChfbGlmZUV2ZW50\nTWFuYWdlciA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7Cgog\nICAgICAgIGxvY2soKTsKICAgICAgICBFeGNlcHRpb25bXSBleHM7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZXhzID0gX2xpZmVFdmVudE1hbmFnZXIu\nZmlyZUV2ZW50KHNyYywgcmVsYXRlZCwgbWV0YSwgZXZlbnRUeXBlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAg\nICB9IAogICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0aW9ucyhleHMsIF9s\naWZlQ2FsbGJhY2tNb2RlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRha2UgYWN0aW9ucyBvbiBjYWxsYmFjayBleGNl\ncHRpb25zIGRlcGVuZGluZyBvbiBjYWxsYmFjayBtb2RlLgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgaGFuZGxlQ2FsbGJhY2tFeGNlcHRpb25zKEV4Y2Vw\ndGlvbltdIGV4Y2VwcywgaW50IG1vZGUpIHsKICAgICAgICBpZiAoZXhjZXBz\nLmxlbmd0aCA9PSAwIHx8IChtb2RlICYgQ0FMTEJBQ0tfSUdOT1JFKSAhPSAw\nKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIE9wZW5KUEFFeGNlcHRp\nb24gY2U7CiAgICAgICAgaWYgKGV4Y2Vwcy5sZW5ndGggPT0gMSkgewogICAg\nICAgICAgICAvLyBJZiB0aGUgZXhjZXB0aW9uIGlzIGFscmVhZHkgYSB3cmFw\ncGVkIGV4Y2VwdGlvbiB0aHJvdyB0aGUgCiAgICAgICAgICAgIC8vIGV4Y2Vw\ndGlvbiBpbnN0ZWFkIG9mIHdyYXBwaW5nIGl0IHdpdGggYSBjYWxsYmFjayBl\neGNlcHRpb24KICAgICAgICAgICAgaWYgKGV4Y2Vwc1swXSBpbnN0YW5jZW9m\nIFdyYXBwZWRFeGNlcHRpb24pCiAgICAgICAgICAgICAgICB0aHJvdyAoV3Jh\ncHBlZEV4Y2VwdGlvbilleGNlcHNbMF07CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIGNlID0gbmV3IENhbGxiYWNrRXhjZXB0aW9uKGV4Y2Vw\nc1swXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2UgPSBuZXcg\nQ2FsbGJhY2tFeGNlcHRpb24oX2xvYy5nZXQoImNhbGxiYWNrLWVyciIpKS4K\nICAgICAgICAgICAgICAgIHNldE5lc3RlZFRocm93YWJsZXMoZXhjZXBzKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKChtb2RlICYgQ0FMTEJBQ0tfUk9MTEJB\nQ0spICE9IDAgJiYgKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKSB7CiAg\nICAgICAgICAgIGNlLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBzZXRS\nb2xsYmFja09ubHlJbnRlcm5hbChjZSk7CiAgICAgICAgfQogICAgICAgIGlm\nICgobW9kZSAmIENBTExCQUNLX0xPRykgIT0gMCAmJiBfbG9nLmlzV2FybkVu\nYWJsZWQoKSkKICAgICAgICAgICAgX2xvZy53YXJuKGNlKTsKICAgICAgICBp\nZiAoKG1vZGUgJiBDQUxMQkFDS19SRVRIUk9XKSAhPSAwKQogICAgICAgICAg\nICB0aHJvdyBjZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRUcmFuc2Fj\ndGlvbkxpc3RlbmVyKE9iamVjdCB0bCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfdHJhbnNF\ndmVudE1hbmFnZXIuYWRkTGlzdGVuZXIodGwpOwogICAgICAgICAgICBpZiAo\ndGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1hbmFnZXIpCiAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRU1PVEVfTElTVEVORVI7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVRyYW5z\nYWN0aW9uTGlzdGVuZXIoT2JqZWN0IHRsKSB7CiAgICAgICAgYmVnaW5PcGVy\nYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChf\ndHJhbnNFdmVudE1hbmFnZXIucmVtb3ZlTGlzdGVuZXIodGwpCiAgICAgICAg\nICAgICAgICAmJiAodGwgaW5zdGFuY2VvZiBSZW1vdGVDb21taXRFdmVudE1h\nbmFnZXIpKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFTU9U\nRV9MSVNURU5FUjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBDb2xsZWN0aW9uPE9iamVjdD4gZ2V0VHJhbnNhY3Rpb25MaXN0ZW5lcnMo\nKSB7CiAgICAgICAgcmV0dXJuIF90cmFuc0V2ZW50TWFuYWdlci5nZXRMaXN0\nZW5lcnMoKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldFRyYW5zYWN0aW9u\nTGlzdGVuZXJDYWxsYmFja01vZGUoKSB7CiAgICAgICAgcmV0dXJuIF90cmFu\nc0NhbGxiYWNrTW9kZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRUcmFu\nc2FjdGlvbkxpc3RlbmVyQ2FsbGJhY2tNb2RlKGludCBtb2RlKSB7CiAgICAg\nICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSA9IG1vZGU7CiAgICAgICAgICAg\nIF90cmFuc0V2ZW50TWFuYWdlci5zZXRGYWlsRmFzdCgobW9kZSAmIENBTExC\nQUNLX0ZBSUxfRkFTVCkgIT0gMCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogRmlyZSBnaXZlbiB0cmFuc2FjdGlvbiBldmVudCwgaGFu\nZGxpbmcgYW55IGV4Y2VwdGlvbnMgYXBwcm9wcmlhdGVseS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGZpcmVUcmFuc2FjdGlvbkV2ZW50KFRyYW5zYWN0\naW9uRXZlbnQgdHJhbnMpIHsKICAgICAgICBpZiAoX3RyYW5zRXZlbnRNYW5h\nZ2VyICE9IG51bGwpCiAgICAgICAgICAgIGhhbmRsZUNhbGxiYWNrRXhjZXB0\naW9ucyhfdHJhbnNFdmVudE1hbmFnZXIuZmlyZUV2ZW50KHRyYW5zKSwKICAg\nICAgICAgICAgICAgIF90cmFuc0NhbGxiYWNrTW9kZSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgd2hldGhlciB0aGlzIEJyb2tlciB3aWxsIGdlbmVy\nYXRlIHZlcmJvc2Ugb3B0aW1pc3RpYyBsb2NrIGV4Y2VwdGlvbnMgd2hlbiBi\nYXRjaGluZwogICAgICogb3BlcmF0aW9ucy4gRGVmYXVsdHMgdG8gdHJ1ZS4K\nICAgICAqIAogICAgICogQHBhcmFtIGIKICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0U3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcoYm9vbGVhbiBiKSB7CiAg\nICAgICAgX3N1cHByZXNzQmF0Y2hPTEVMb2dnaW5nID0gYjsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBSZXR1cm4gd2hldGhlciB0aGlzIEJyb2tlciB3\naWxsIGdlbmVyYXRlIHZlcmJvc2Ugb3B0aW1pc3RpYyBsb2NrIGV4Y2VwdGlv\nbnMgd2hlbiBiYXRjaGluZwogICAgICogb3BlcmF0aW9ucy4KICAgICAqLwog\nICAgcHVibGljIGJvb2xlYW4gZ2V0U3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmco\nKSB7CiAgICAgICAgcmV0dXJuIF9zdXBwcmVzc0JhdGNoT0xFTG9nZ2luZzsK\nICAgIH0KICAgIC8vLy8vLy8vLy8vCiAgICAvLyBMb29rdXBzCiAgICAvLy8v\nLy8vLy8vLwoKICAgIHB1YmxpYyBPYmplY3QgZmluZChPYmplY3Qgb2lkLCBi\nb29sZWFuIHZhbGlkYXRlLCBGaW5kQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAg\nICBpbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9JRF9BTExPV19ORVcgfCBPSURf\nTk9ERUxFVEVEOwogICAgICAgIGlmICghdmFsaWRhdGUpCiAgICAgICAgICAg\nIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwogICAgICAgIHJldHVybiBmaW5k\nKG9pZCwgX2ZjLCBudWxsLCBudWxsLCBmbGFncywgY2FsbCk7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBmaW5kKE9iamVjdCBvaWQsIEZldGNoQ29uZmln\ndXJhdGlvbiBmZXRjaCwgQml0U2V0IGV4Y2x1ZGUsCiAgICAgICAgT2JqZWN0\nIGVkYXRhLCBpbnQgZmxhZ3MpIHsKICAgICAgICByZXR1cm4gZmluZChvaWQs\nIGZldGNoLCBleGNsdWRlLCBlZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoK\nICAgIC8qKgogICAgICogSW50ZXJuYWwgZmluZGVyLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgT2JqZWN0IGZpbmQoT2JqZWN0IG9pZCwgRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoLCBCaXRTZXQgZXhjbHVkZSwKICAgICAgICBPYmplY3Qg\nZWRhdGEsIGludCBmbGFncywgRmluZENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IHRoaXM7\nCiAgICAgICAgb2lkID0gY2FsbC5wcm9jZXNzQXJndW1lbnQob2lkKTsKICAg\nICAgICBpZiAob2lkID09IG51bGwpIHsKICAgICAgICAgICAgaWYgKChmbGFn\ncyAmIE9JRF9OT1ZBTElEQVRFKSA9PSAwKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxs\nLW9pZCIpKTsKICAgICAgICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVy\nbihvaWQsIG51bGwpOwogICAgICAgIH0KICAgICAgICBpZiAoZmV0Y2ggPT0g\nbnVsbCkKICAgICAgICAgICAgZmV0Y2ggPSBfZmM7CgogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFz\nc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAvLyBj\nYWNoZWQgaW5zdGFuY2U/CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsCiAgICAgICAgICAg\nICAgICAoZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwIHx8IGhhc0ZsdXNo\nZWQoKSk7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIXJlcXVpcmVzTG9hZChzbSwgdHJ1ZSwgZmV0Y2gsIGVk\nYXRhLCBmbGFncykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGwu\ncHJvY2Vzc1JldHVybihvaWQsIHNtKTsKCiAgICAgICAgICAgICAgICBpZiAo\nIXNtLmlzTG9hZGluZygpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFr\nZSBzdXJlIGFsbCB0aGUgY29uZmlndXJlZCBmaWVsZHMgYXJlIGxvYWRlZDsg\nZG8gdGhpcwogICAgICAgICAgICAgICAgICAgIC8vIGFmdGVyIG1ha2luZyBp\nbnN0YW5jZSB0cmFuc2FjdGlvbmFsIGZvciBsb2NraW5nCiAgICAgICAgICAg\nICAgICAgICAgaWYgKCFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB1c2VUcmFu\nc2FjdGlvbmFsU3RhdGUoZmV0Y2gpKQogICAgICAgICAgICAgICAgICAgICAg\nICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgYm9v\nbGVhbiBsb2FkZWQ7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgbG9hZGVkID0gc20ubG9hZChmZXRjaCwgU3Rh\ndGVNYW5hZ2VySW1wbC5MT0FEX0ZHUywgCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBleGNsdWRlLCBlZGF0YSwgZmFsc2UpOwogICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG9uZmUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAmIE9JRF9O\nT0RFTEVURUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8\nIChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8g\naWYgbm8gZGF0YSBuZWVkZWQgdG8gYmUgbG9hZGVkIGFuZCB0aGUgdXNlciB3\nYW50cyB0bwogICAgICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlLCBqdXN0\nIG1ha2Ugc3VyZSB0aGUgb2JqZWN0IGV4aXN0cwogICAgICAgICAgICAgICAg\nICAgIGlmICghbG9hZGVkICYmIChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSA9\nPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICYmIF9jb21wYXQuZ2V0VmFs\naWRhdGVUcnVlQ2hlY2tzU3RvcmUoKQogICAgICAgICAgICAgICAgICAgICAg\nICAmJiAhc20uaXNUcmFuc2FjdGlvbmFsKCkKICAgICAgICAgICAgICAgICAg\nICAgICAgJiYgIV9zdG9yZS5leGlzdHMoc20sIGVkYXRhKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgT0lEX05PREVMRVRFRCkg\nPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKF9sb2Mu\nZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoImRlbC1pbnN0YW5j\nZSIsIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBvaWQpKS4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChzbS5nZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBvYmpl\nY3Qgd2FzIGNhY2hlZCwgd2UgbWF5IG5lZWQgdG8gdXBncmFkZSBsb2NrCiAg\nICAgICAgICAgICAgICAvLyBpZiBjdXJyZW50IGxldmVsIGlzIGhpZ2hlciB0\naGFuIGxldmVsIG9mIGluaXRpYWwgbG9hZAogICAgICAgICAgICAgICAgaWYg\nKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAg\nICAgICAgIGludCBsZXZlbCA9IGZldGNoLmdldFJlYWRMb2NrTGV2ZWwoKTsK\nICAgICAgICAgICAgICAgICAgICBfbG0ubG9jayhzbSwgbGV2ZWwsIGZldGNo\nLmdldExvY2tUaW1lb3V0KCksIGVkYXRhKTsKICAgICAgICAgICAgICAgICAg\nICBzbS5yZWFkTG9ja2VkKGxldmVsLCBmZXRjaC5nZXRXcml0ZUxvY2tMZXZl\nbCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVy\nbiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBzbSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm8gY2FjaGVkIHNtIGZvciBh\nIG5ldy90cmFuc2llbnQgaWQgdHlwZSwgd2UKICAgICAgICAgICAgLy8gaXQg\nZGVmaW5pdGVseSBkb2Vzbid0IGV4aXN0CiAgICAgICAgICAgIGlmIChvaWQg\naW5zdGFuY2VvZiBTdGF0ZU1hbmFnZXJJZCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBjYWxsLnByb2Nlc3NSZXR1cm4ob2lkLCBudWxsKTsKCiAgICAgICAg\nICAgIC8vIGluaXRpYWxpemUgYSBuZXcgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGRhdGFzdG9yZSBpbnN0YW5jZQogICAgICAgICAgICBzbSA9IG5ld1N0YXRl\nTWFuYWdlckltcGwob2lkLCAoZmxhZ3MgJiBPSURfQ09QWSkgIT0gMCk7CiAg\nICAgICAgICAgIGJvb2xlYW4gbG9hZCA9IHJlcXVpcmVzTG9hZChzbSwgZmFs\nc2UsIGZldGNoLCBlZGF0YSwgZmxhZ3MpOwogICAgICAgICAgICBzbSA9IGlu\naXRpYWxpemUoc20sIGxvYWQsIGZldGNoLCBlZGF0YSk7CiAgICAgICAgICAg\nIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZsYWdz\nICYgT0lEX05PVkFMSURBVEUpICE9IDApCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKG9pZCk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVs\nbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBh\nbGwgY29uZmlndXJlZCBmaWVsZHMgd2VyZSBsb2FkZWQKICAgICAgICAgICAg\naWYgKGxvYWQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5hZ2VySW1wbC5MT0FE\nX0ZHUywgZXhjbHVkZSwKICAgICAgICAgICAgICAgICAgICAgICAgZWRhdGEs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE9iamVjdE5vdEZv\ndW5kRXhjZXB0aW9uIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nKGZsYWdzICYgT0lEX05PREVMRVRFRCkgIT0gMAogICAgICAgICAgICAgICAg\nICAgICAgICB8fCAoZmxhZ3MgJiBPSURfTk9WQUxJREFURSkgIT0gMCkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxp\nemUgYSBuZXdseS1jb25zdHJ1Y3RlZCBzdGF0ZSBtYW5hZ2VyLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgU3RhdGVNYW5hZ2VySW1wbCBpbml0aWFsaXplKFN0\nYXRlTWFuYWdlckltcGwgc20sIGJvb2xlYW4gbG9hZCwKICAgICAgICBGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSkgewogICAgICAg\nIGlmICghbG9hZCkgewogICAgICAgICAgICBzbS5pbml0aWFsaXplKHNtLmdl\ndE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpLAogICAgICAgICAgICAg\nICAgUENTdGF0ZS5IT0xMT1cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIFBDU3RhdGUgc3RhdGUgPSAodXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZl\ndGNoKSkKICAgICAgICAgICAgICAgID8gUENTdGF0ZS5QQ0xFQU4gOiBQQ1N0\nYXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgc20uc2V0TG9hZGluZyh0cnVl\nKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghX3N0\nb3JlLmluaXRpYWxpemUoc20sIHN0YXRlLCBmZXRjaCwgZWRhdGEpKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgc20uc2V0TG9hZGluZyhmYWxzZSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNtOwog\nICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxsKENvbGxlY3Rpb24g\nb2lkcywgYm9vbGVhbiB2YWxpZGF0ZSwKICAgICAgICBGaW5kQ2FsbGJhY2tz\nIGNhbGwpIHsKICAgICAgICBpbnQgZmxhZ3MgPSBPSURfQ09QWSB8IE9JRF9B\nTExPV19ORVcgfCBPSURfTk9ERUxFVEVEOwogICAgICAgIGlmICghdmFsaWRh\ndGUpCiAgICAgICAgICAgIGZsYWdzIHw9IE9JRF9OT1ZBTElEQVRFOwogICAg\nICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIF9mYywgbnVsbCwgbnVsbCwgZmxh\nZ3MsIGNhbGwpOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3RbXSBmaW5kQWxs\nKENvbGxlY3Rpb24gb2lkcywgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLAog\nICAgICAgIEJpdFNldCBleGNsdWRlLCBPYmplY3QgZWRhdGEsIGludCBmbGFn\ncykgewogICAgICAgIHJldHVybiBmaW5kQWxsKG9pZHMsIGZldGNoLCBleGNs\ndWRlLCBlZGF0YSwgZmxhZ3MsIG51bGwpOwogICAgfQoKICAgIC8qKgogICAg\nICogSW50ZXJuYWwgZmluZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2Jq\nZWN0W10gZmluZEFsbChDb2xsZWN0aW9uIG9pZHMsIEZldGNoQ29uZmlndXJh\ndGlvbiBmZXRjaCwKICAgICAgICBCaXRTZXQgZXhjbHVkZSwgT2JqZWN0IGVk\nYXRhLCBpbnQgZmxhZ3MsIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGZpbmRBbGxEZXB0aCArKzsKCiAgICAgICAgLy8gdGhyb3cgYW55IGV4Y2Vw\ndGlvbnMgZm9yIG51bGwgb2lkcyB1cCBpbW1lZGlhdGVseQogICAgICAgIGlm\nIChvaWRzID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigib2lkcyA9PSBudWxsIik7CiAgICAgICAgaWYgKChm\nbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwICYmIG9pZHMuY29udGFpbnMo\nbnVsbCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJudWxsLW9pZHMiKSk7CgogICAgICAgIC8vIHdlIGhhdmUgdG8g\ndXNlIGEgbWFwIG9mIG9pZC0+c20gcmF0aGVyIHRoYW4gYSBzaW1wbGUKICAg\nICAgICAvLyBhcnJheSwgc28gdGhhdCB3ZSBtYWtlIHN1cmUgbm90IHRvIGNy\nZWF0ZSBtdWx0aXBsZSBzbXMgZm9yIGVxdWl2YWxlbnQKICAgICAgICAvLyBv\naWRzIGlmIHRoZSB1c2VyIGhhcyBkdXBsaWNhdGVzIGluIHRoZSBnaXZlbiBh\ncnJheQogICAgICAgIGlmIChfbG9hZGluZyA9PSBudWxsKQogICAgICAgICAg\nICBfbG9hZGluZyA9IG5ldyBIYXNoTWFwPE9iamVjdCwgU3RhdGVNYW5hZ2Vy\nSW1wbD4oKGludCkgKG9pZHMuc2l6ZSgpICogMS4zMyArIDEpKTsKCiAgICAg\nICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAgY2FsbCA9IHRoaXM7\nCiAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAgICAgICAgIGZldGNo\nID0gX2ZjOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVh\nZCgpOwoKICAgICAgICAgICAgLy8gY29sbGVjdGlvbiBvZiBzdGF0ZSBtYW5h\nZ2VycyB0byBwYXNzIHRvIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAgTGlz\ndDxPcGVuSlBBU3RhdGVNYW5hZ2VyPiBsb2FkID0gbnVsbDsKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgYm9vbGVhbiBp\nbml0aWFsaXplZDsKICAgICAgICAgICAgYm9vbGVhbiB0cmFuc1N0YXRlID0g\ndXNlVHJhbnNhY3Rpb25hbFN0YXRlKGZldGNoKTsKICAgICAgICAgICAgT2Jq\nZWN0IG9iaiwgb2lkOwogICAgICAgICAgICBpbnQgaWR4ID0gMDsKICAgICAg\nICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBvaWRzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAvLyBp\nZiB3ZSd2ZSBhbHJlYWR5IHNlZW4gdGhpcyBvaWQsIHNraXAgcmVwZWF0cwog\nICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAg\nICAgIG9pZCA9IGNhbGwucHJvY2Vzc0FyZ3VtZW50KG9iaik7CiAgICAgICAg\nICAgICAgICBpZiAob2lkID09IG51bGwgfHwgX2xvYWRpbmcuY29udGFpbnNL\nZXkob2JqKSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAg\nICAgICAgICAgICAvLyBpZiB3ZSBkb24ndCBoYXZlIGEgY2FjaGVkIGluc3Rh\nbmNlIG9yIGl0IGlzIG5vdCB0cmFuc2FjdGlvbmFsCiAgICAgICAgICAgICAg\nICAvLyBhbmQgaXMgaG9sbG93IG9yIHdlIG5lZWQgdG8gdmFsaWRhdGUsIGxv\nYWQgaXQKICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1w\nbEJ5SWQob2lkLCAoZmxhZ3MgJiBPSURfQUxMT1dfTkVXKSAhPSAwCiAgICAg\nICAgICAgICAgICAgICAgfHwgaGFzRmx1c2hlZCgpKTsKICAgICAgICAgICAg\nICAgIGluaXRpYWxpemVkID0gc20gIT0gbnVsbDsKICAgICAgICAgICAgICAg\nIGlmICghaW5pdGlhbGl6ZWQpCiAgICAgICAgICAgICAgICAgICAgc20gPSBu\nZXdTdGF0ZU1hbmFnZXJJbXBsKG9pZCwgKGZsYWdzICYgT0lEX0NPUFkpICE9\nIDApOwoKICAgICAgICAgICAgICAgIF9sb2FkaW5nLnB1dChvYmosIHNtKTsK\nICAgICAgICAgICAgICAgIGlmIChyZXF1aXJlc0xvYWQoc20sIGluaXRpYWxp\nemVkLCBmZXRjaCwgZWRhdGEsIGZsYWdzKSkgewogICAgICAgICAgICAgICAg\nICAgIHRyYW5zU3RhdGUgPSB0cmFuc1N0YXRlIHx8IHVzZVRyYW5zYWN0aW9u\nYWxTdGF0ZShmZXRjaCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRp\nYWxpemVkICYmICFzbS5pc1RyYW5zYWN0aW9uYWwoKSAmJiB0cmFuc1N0YXRl\nKQogICAgICAgICAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPT0gbnVsbCkKICAgICAg\nICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJheUxpc3Q8T3BlbkpQ\nQVN0YXRlTWFuYWdlcj4ob2lkcy5zaXplKCkgLSBpZHgpOwogICAgICAgICAg\nICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSBpZiAoIWluaXRpYWxpemVkKQogICAgICAgICAgICAgICAgICAgIHNtLmlu\naXRpYWxpemUoc20uZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgIFBDU3RhdGUuSE9MTE9XKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcGFzcyBhbGwgc3RhdGUgbWFu\nYWdlcnMgaW4gbmVlZCBvZiBsb2FkaW5nIG9yIHZhbGlkYXRpb24gdG8gdGhl\nCiAgICAgICAgICAgIC8vIHN0b3JlIG1hbmFnZXIKICAgICAgICAgICAgaWYg\nKGxvYWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgUENTdGF0ZSBzdGF0\nZSA9ICh0cmFuc1N0YXRlKSA/IFBDU3RhdGUuUENMRUFOCiAgICAgICAgICAg\nICAgICAgICAgOiBQQ1N0YXRlLlBOT05UUkFOUzsKICAgICAgICAgICAgICAg\nIENvbGxlY3Rpb248T2JqZWN0PiBmYWlsZWQgPSBfc3RvcmUubG9hZEFsbChs\nb2FkLCBzdGF0ZSwKICAgICAgICAgICAgICAgICAgICBTdG9yZU1hbmFnZXIu\nRk9SQ0VfTE9BRF9OT05FLCBmZXRjaCwgZWRhdGEpOwoKICAgICAgICAgICAg\nICAgIC8vIHNldCBmYWlsZWQgaW5zdGFuY2VzIHRvIG51bGwKICAgICAgICAg\nICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlzRW1wdHko\nKSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9W\nQUxJREFURSkgIT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKTsKICAgICAgICAg\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPE9iamVjdD4gaXRyID0gZmFpbGVk\nLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAg\nICAgICAgICBfbG9hZGluZy5wdXQoaXRyLm5leHQoKSwgbnVsbCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNy\nZWF0ZSByZXN1bHRzIGFycmF5OyBtYWtlIHN1cmUgYWxsIGNvbmZpZ3VyZWQg\nZmllbGRzIGFyZQogICAgICAgICAgICAvLyBsb2FkZWQgaW4gZWFjaCBpbnN0\nYW5jZQogICAgICAgICAgICBPYmplY3RbXSByZXN1bHRzID0gbmV3IE9iamVj\ndFtvaWRzLnNpemUoKV07CiAgICAgICAgICAgIGJvb2xlYW4gYWN0aXZlID0g\nKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAgICAgICBpbnQg\nbGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCk7CiAgICAgICAgICAg\nIGlkeCA9IDA7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0g\nb2lkcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOyBpZHgrKykgewogICAg\nICAgICAgICAgICAgb2lkID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIHNtID0gX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgICAgICBpZiAo\nc20gIT0gbnVsbCAmJiByZXF1aXJlc0xvYWQoc20sIHRydWUsIGZldGNoLCBl\nZGF0YSwgZmxhZ3MpKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgc20ubG9hZChmZXRjaCwgU3RhdGVNYW5h\nZ2VySW1wbC5MT0FEX0ZHUywKICAgICAgICAgICAgICAgICAgICAgICAgCWV4\nY2x1ZGUsIGVkYXRhLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChhY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9s\nbS5sb2NrKHNtLCBsZXZlbCwgZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSwgZWRh\ndGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc20ucmVhZExvY2tl\nZChsZXZlbCwgZmV0Y2guZ2V0V3JpdGVMb2NrTGV2ZWwoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgY2F0Y2ggKE9iamVjdE5vdEZvdW5kRXhjZXB0aW9u\nIG9uZmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmbGFncyAm\nIE9JRF9OT0RFTEVURUQpICE9IDAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHx8IChmbGFncyAmIE9JRF9OT1ZBTElEQVRFKSAhPSAwKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgb25mZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgc20gPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdHNbaWR4\nXSA9IGNhbGwucHJvY2Vzc1JldHVybihvaWQsIHNtKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtl\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGZpbmRBbGxEZXB0aC0tOwog\nICAgICAgICAgICBpZiAoZmluZEFsbERlcHRoID09IDApCiAgICAgICAgICAg\nICAgICBfbG9hZGluZyA9IG51bGw7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gaGFz\nRmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxV\nU0hFRCkgIT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB3aGV0\naGVyIHRoZSBnaXZlbiBpbnN0YW5jZSBuZWVkcyBsb2FkaW5nIGJlZm9yZSBi\nZWluZyByZXR1cm5lZAogICAgICogdG8gdGhlIHVzZXIuCiAgICAgKi8KICAg\nIHByaXZhdGUgYm9vbGVhbiByZXF1aXJlc0xvYWQoT3BlbkpQQVN0YXRlTWFu\nYWdlciBzbSwgYm9vbGVhbiBpbml0aWFsaXplZCwKICAgICAgICBGZXRjaENv\nbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBlZGF0YSwgaW50IGZsYWdzKSB7\nCiAgICAgICAgaWYgKCFmZXRjaC5yZXF1aXJlc0xvYWQoKSkKICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICgoZmxhZ3MgJiBPSURfTk9W\nQUxJREFURSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgaWYgKGVkYXRhICE9IG51bGwpIC8vIHRha2UgYWR2YW50YWdlIG9mIGV4\naXN0aW5nIHJlc3VsdAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICBpZiAoaW5pdGlhbGl6ZWQgJiYgc20uZ2V0UENTdGF0ZSgpICE9IFBDU3Rh\ndGUuSE9MTE9XKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\naWYgKCFpbml0aWFsaXplZCAmJiBzbS5nZXRNZXRhRGF0YSgpLmdldFBDU3Vi\nY2xhc3NlcygpLmxlbmd0aCA+IDApCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIHJldHVybiAhX2NvbXBhdC5nZXRWYWxpZGF0ZUZhbHNlUmV0\ndXJuc0hvbGxvdygpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgdG8gdXNlIGEgdHJhbnNhY3Rpb25hbCBzdGF0ZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBib29sZWFuIHVzZVRyYW5zYWN0aW9uYWxTdGF0ZShGZXRj\naENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIEZMQUdfQUNUSVZFKSAhPSAwICYmICghX29wdGltaXN0aWMKICAgICAg\nICAgICAgfHwgX2F1dG9DbGVhciA9PSBDTEVBUl9BTEwKICAgICAgICAgICAg\nfHwgZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpICE9IExPQ0tfTk9ORSk7CiAg\nICB9CgogICAgcHVibGljIE9iamVjdCBmaW5kQ2FjaGVkKE9iamVjdCBvaWQs\nIEZpbmRDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChjYWxsID09IG51\nbGwpCiAgICAgICAgICAgIGNhbGwgPSB0aGlzOwogICAgICAgIG9pZCA9IGNh\nbGwucHJvY2Vzc0FyZ3VtZW50KG9pZCk7CiAgICAgICAgaWYgKG9pZCA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9p\nZCwgbnVsbCk7CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChvaWQsIHRydWUpOwogICAgICAgICAg\nICByZXR1cm4gY2FsbC5wcm9jZXNzUmV0dXJuKG9pZCwgc20pOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3M8Pz4gZ2V0T2JqZWN0SWRU\neXBlKENsYXNzPD8+IGNscykgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzc01l\ndGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0\nYW5jZSgpLgogICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoY2xzLCBfbG9h\nZGVyLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChtZXRhID09IG51bGwKICAg\nICAgICAgICAgICAgIHx8IG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xh\nc3NNZXRhRGF0YS5JRF9VTktOT1dOKQogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIGlmIChtZXRhLmdldElkZW50aXR5VHlwZSgp\nID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pCiAgICAgICAgICAg\nICAgICByZXR1cm4gbWV0YS5nZXRPYmplY3RJZFR5cGUoKTsKCiAgICAgICAg\nICAgIHJldHVybiBfc3RvcmUuZ2V0RGF0YVN0b3JlSWRUeXBlKG1ldGEpOwog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgbmV3T2JqZWN0SWQoQ2xhc3M8Pz4gY2xzLCBPYmplY3QgdmFsKSB7CiAg\nICAgICAgaWYgKHZhbCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVs\nbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdl\ndE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAg\nICBnZXRNZXRhRGF0YShjbHMsIF9sb2FkZXIsIHRydWUpOwogICAgICAgICAg\nICBzd2l0Y2ggKG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkpIHsKICAgICAgICAg\nICAgY2FzZSBDbGFzc01ldGFEYXRhLklEX0RBVEFTVE9SRToKICAgICAgICAg\nICAgICAgIC8vIGRlbGVnYXRlIHRvIHN0b3JlIG1hbmFnZXIgZm9yIGRhdGFz\ndG9yZSBpZHMKICAgICAgICAgICAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBT\ndHJpbmcKICAgICAgICAgICAgICAgICAgICAmJiAoKFN0cmluZykgdmFsKS5z\ndGFydHNXaXRoKFN0YXRlTWFuYWdlcklkLlNUUklOR19QUkVGSVgpKQogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdGVNYW5hZ2VySWQoKFN0\ncmluZykgdmFsKTsKICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUubmV3\nRGF0YVN0b3JlSWQodmFsLCBtZXRhKTsKICAgICAgICAgICAgY2FzZSBDbGFz\nc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OOgogICAgICAgICAgICAgICAgaWYg\nKEltcGxIZWxwZXIuaXNBc3NpZ25hYmxlKG1ldGEuZ2V0T2JqZWN0SWRUeXBl\nKCksIAogICAgICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFzcygpKSkgewog\nICAgICAgICAgICAgICAgICAgIGlmICghbWV0YS5pc09wZW5KUEFJZGVudGl0\neSgpIAogICAgICAgICAgICAgICAgICAgICAgICAmJiBtZXRhLmlzT2JqZWN0\nSWRUeXBlU2hhcmVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgT2JqZWN0SWQoY2xzLCB2YWwpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB2YWw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgLy8gc3RyaW5naWZpZWQgYXBwIGlkPwogICAgICAgICAgICAgICAgaWYg\nKHZhbCBpbnN0YW5jZW9mIFN0cmluZyAKICAgICAgICAgICAgICAgICAgICAm\nJiAhX2NvbmYuZ2V0Q29tcGF0aWJpbGl0eUluc3RhbmNlKCkuCiAgICAgICAg\nICAgICAgICAgICAgICAgIGdldFN0cmljdElkZW50aXR5VmFsdWVzKCkKICAg\nICAgICAgICAgICAgICAgICAmJiAhTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMu\nZ2V0TW9kaWZpZXJzKCkpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQ\nQ1JlZ2lzdHJ5Lm5ld09iamVjdElkKGNscywgKFN0cmluZykgdmFsKTsKCiAg\nICAgICAgICAgICAgICBPYmplY3RbXSBhcnIgPSAodmFsIGluc3RhbmNlb2Yg\nT2JqZWN0W10pID8gKE9iamVjdFtdKSB2YWwKICAgICAgICAgICAgICAgICAg\nICA6IG5ldyBPYmplY3RbXXsgdmFsIH07CiAgICAgICAgICAgICAgICByZXR1\ncm4gQXBwbGljYXRpb25JZHMuZnJvbVBLVmFsdWVzKGFyciwgbWV0YSk7CiAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVXNlckV4Y2VwdGlvbihfbG9jLmdldCgibWV0YS11bmtub3duaWQiLCBjbHMp\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbiBpYWUpIHsKICAgICAgICAJLy8gT1BFTkpQQS0zNjUK\nICAgICAgICAJdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoImJh\nZC1pZC12YWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAgIHZhbC5nZXRDbGFz\ncygpLmdldE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoaWFlKTsKICAgICAgICB9\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKENsYXNzQ2FzdEV4Y2VwdGlvbiBj\nY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoImJhZC1pZC12YWx1ZSIsIHZhbCwKICAgICAgICAgICAgICAgIHZh\nbC5nZXRDbGFzcygpLmdldE5hbWUoKSwgY2xzKSkuc2V0Q2F1c2UoY2NlKTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgc3Rh\ndGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZC4KICAgICAqLwogICAgcHJp\ndmF0ZSBTdGF0ZU1hbmFnZXJJbXBsIG5ld1N0YXRlTWFuYWdlckltcGwoT2Jq\nZWN0IG9pZCwgYm9vbGVhbiBjb3B5KSB7CiAgICAgICAgLy8gc2VlIGlmIHdl\nJ3JlIGluIHRoZSBwcm9jZXNzIG9mIGxvYWRpbmcgdGhpcyBvaWQgaW4gYSBs\nb2FkQWxsIGNhbGwKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAg\nICAgIGlmIChfbG9hZGluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIHNtID0g\nX2xvYWRpbmcuZ2V0KG9pZCk7CiAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nICYmIHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgpID09IG51bGwpCiAgICAg\nICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfQoKICAgICAgICAvLyBm\naW5kIG1ldGFkYXRhIGZvciB0aGUgb2lkCiAgICAgICAgQ2xhc3M8Pz4gcGNU\neXBlID0gX3N0b3JlLmdldE1hbmFnZWRUeXBlKG9pZCk7CiAgICAgICAgTWV0\nYURhdGFSZXBvc2l0b3J5IHJlcG9zID0gX2NvbmYuZ2V0TWV0YURhdGFSZXBv\nc2l0b3J5SW5zdGFuY2UoKTsKICAgICAgICBDbGFzc01ldGFEYXRhIG1ldGE7\nCiAgICAgICAgaWYgKHBjVHlwZSAhPSBudWxsKQogICAgICAgICAgICBtZXRh\nID0gcmVwb3MuZ2V0TWV0YURhdGEocGNUeXBlLCBfbG9hZGVyLCB0cnVlKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIG1ldGEgPSByZXBvcy5nZXRNZXRh\nRGF0YShvaWQsIF9sb2FkZXIsIHRydWUpOwoKICAgICAgICAvLyBjb3B5IHRo\nZSBvaWQgaWYgbmVlZGVkCiAgICAgICAgaWYgKGNvcHkgJiYgX2NvbXBhdC5n\nZXRDb3B5T2JqZWN0SWRzKCkpIHsKICAgICAgICAgICAgaWYgKG1ldGEuZ2V0\nSWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNBVElP\nTikKICAgICAgICAgICAgICAgIG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHko\nb2lkLCBtZXRhKTsKICAgICAgICAgICAgZWxzZSBpZiAobWV0YS5nZXRJZGVu\ndGl0eVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nbWV0YS11bmtub3duaWQiLCBtZXRhKSk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIG9pZCA9IF9zdG9yZS5jb3B5RGF0YVN0b3JlSWQob2lk\nLCBtZXRhKTsKICAgICAgICB9CgogICAgICAgIHNtID0gbmV3U3RhdGVNYW5h\nZ2VySW1wbChvaWQsIG1ldGEpOwogICAgICAgIHNtLnNldE9iamVjdElkKG9p\nZCk7CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgc3RhdGUgbWFuYWdlciBmb3IgdGhlIGdpdmVuIG9pZCBhbmQg\nbWV0YWRhdGEuCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFnZXJJ\nbXBsIG5ld1N0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9pZCwKICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEpIHsKICAgICAgICByZXR1cm4gbmV3IFN0YXRl\nTWFuYWdlckltcGwob2lkLCBtZXRhLCB0aGlzKTsKICAgIH0KCiAgICAvLy8v\nLy8vLy8vLy8vLy8KICAgIC8vIFRyYW5zYWN0aW9uCiAgICAvLy8vLy8vLy8v\nLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWdpbigpIHsKICAgICAgICBiZWdp\nbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBp\nZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgi\nYWN0aXZlIikpOwogICAgICAgICAgICBfZmFjdG9yeS5zeW5jV2l0aE1hbmFn\nZWRUcmFuc2FjdGlvbih0aGlzLCB0cnVlKTsKICAgICAgICAgICAgYmVnaW5J\nbnRlcm5hbCgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIE5vdGlmeSB0aGUgc3RvcmUgbWFuYWdlciBvZiBhIHRyYW5zYWN0aW9uLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVnaW5JbnRlcm5hbCgpIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBiZWdpblN0b3JlTWFuYWdlclRyYW5z\nYWN0aW9uKF9vcHRpbWlzdGljKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfQUNUSVZFOwoKICAgICAgICAgICAgLy8gc3RhcnQgbG9ja2luZwogICAg\nICAgICAgICBpZiAoIV9vcHRpbWlzdGljKSB7CiAgICAgICAgICAgICAgICBf\nZmMuc2V0UmVhZExvY2tMZXZlbChfY29uZi5nZXRSZWFkTG9ja0xldmVsQ29u\nc3RhbnQoKSk7CiAgICAgICAgICAgICAgICBfZmMuc2V0V3JpdGVMb2NrTGV2\nZWwoX2NvbmYuZ2V0V3JpdGVMb2NrTGV2ZWxDb25zdGFudCgpKTsKICAgICAg\nICAgICAgICAgIF9mYy5zZXRMb2NrVGltZW91dChfY29uZi5nZXRMb2NrVGlt\nZW91dCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfbG0uYmVnaW5U\ncmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgaWYgKF90cmFuc0V2ZW50TWFu\nYWdlci5oYXNCZWdpbkxpc3RlbmVycygpKQogICAgICAgICAgICAgICAgZmly\nZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywK\nICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0JF\nR0lOLCBudWxsLCBudWxsLCBudWxsLCBudWxsKSk7CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAvLyBpZiB3\nZSBhbHJlYWR5IHN0YXJ0ZWQgdGhlIHRyYW5zYWN0aW9uLCBkb24ndCBsZXQg\naXQgY29tbWl0CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpICE9IDApCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRl\ncm5hbChrZSk7CiAgICAgICAgICAgIHRocm93IGtlLnNldEZhdGFsKHRydWUp\nOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAg\nICAgICAgICAgLy8gaWYgd2UgYWxyZWFkeSBzdGFydGVkIHRoZSB0cmFuc2Fj\ndGlvbiwgZG9uJ3QgbGV0IGl0IGNvbW1pdAogICAgICAgICAgICBpZiAoKF9m\nbGFncyAmIEZMQUdfQUNUSVZFKSAhPSAwKQogICAgICAgICAgICAgICAgc2V0\nUm9sbGJhY2tPbmx5SW50ZXJuYWwocmUpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgU3RvcmVFeGNlcHRpb24ocmUpLnNldEZhdGFsKHRydWUpOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKF9wZW5kaW5nICE9IG51bGwpIHsKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdCA9IF9wZW5kaW5nLml0ZXJhdG9y\nKCk7IGl0Lmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHNtID0gKFN0\nYXRlTWFuYWdlckltcGwpIGl0Lm5leHQoKTsKICAgICAgICAgICAgICAgIHNt\nLnRyYW5zYWN0aW9uYWwoKTsKICAgICAgICAgICAgICAgIGlmIChzbS5pc0Rp\ncnR5KCkpCiAgICAgICAgICAgICAgICAgICAgc2V0RGlydHkoc20sIHRydWUp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9wZW5kaW5nID0gbnVsbDsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYmVnaW5TdG9yZSgp\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigpOwog\nICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfU1RPUkVfQUNUSVZFKSA9\nPSAwKQogICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1hbmFnZXJUcmFuc2Fj\ndGlvbihmYWxzZSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQmVnaW4gYSBzdG9yZSBtYW5hZ2VyIHRyYW5zYWN0aW9u\nLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYmVnaW5TdG9yZU1hbmFnZXJU\ncmFuc2FjdGlvbihib29sZWFuIG9wdGltaXN0aWMpIHsKICAgICAgICBpZiAo\nIW9wdGltaXN0aWMpIHsKICAgICAgICAgICAgcmV0YWluQ29ubmVjdGlvbigp\nOwogICAgICAgICAgICBfc3RvcmUuYmVnaW4oKTsKICAgICAgICAgICAgX2Zs\nYWdzIHw9IEZMQUdfU1RPUkVfQUNUSVZFOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIGlmIChfY29ublJldGFpbk1vZGUgPT0gQ09OTl9SRVRBSU5f\nVFJBTlMpCiAgICAgICAgICAgICAgICByZXRhaW5Db25uZWN0aW9uKCk7CiAg\nICAgICAgICAgIF9zdG9yZS5iZWdpbk9wdGltaXN0aWMoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGhlIGN1cnJlbnQgc3RvcmUg\nbWFuYWdlciB0cmFuc2FjdGlvbi4gVGhyb3dzIGFuCiAgICAgKiBleGNlcHRp\nb24gdG8gc2lnbmFsIGEgZm9yY2VkIHJvbGxiYWNrIGFmdGVyIGZhaWxlZCBj\nb21taXQsIG90aGVyd2lzZQogICAgICogcmV0dXJucyBhbnkgZXhjZXB0aW9u\nIGVuY291bnRlcmVkIGR1cmluZyB0aGUgZW5kIHByb2Nlc3MuCiAgICAgKi8K\nICAgIHByaXZhdGUgUnVudGltZUV4Y2VwdGlvbiBlbmRTdG9yZU1hbmFnZXJU\ncmFuc2FjdGlvbihib29sZWFuIHJvbGxiYWNrKSB7CiAgICAgICAgYm9vbGVh\nbiBmb3JjZWRSb2xsYmFjayA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4gcmVs\nZWFzZUNvbm4gPSBmYWxzZTsKICAgICAgICBSdW50aW1lRXhjZXB0aW9uIGVy\nciA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKChfZmxh\nZ3MgJiBGTEFHX1NUT1JFX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAg\nICAgcmVsZWFzZUNvbm4gPSBfY29ublJldGFpbk1vZGUgIT0gQ09OTl9SRVRB\nSU5fQUxXQVlTOwogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrKQogICAg\nICAgICAgICAgICAgICAgIF9zdG9yZS5yb2xsYmFjaygpOwogICAgICAgICAg\nICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIF9zdG9yZS5jb21taXQo\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbGVh\nc2VDb25uID0gX2Nvbm5SZXRhaW5Nb2RlID09IENPTk5fUkVUQUlOX1RSQU5T\nOwogICAgICAgICAgICAgICAgX3N0b3JlLnJvbGxiYWNrT3B0aW1pc3RpYygp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoIChSdW50\naW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmICghcm9sbGJhY2sp\nIHsKICAgICAgICAgICAgICAgIGZvcmNlZFJvbGxiYWNrID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgIHRyeSB7IF9zdG9yZS5yb2xsYmFjaygpOyB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlMikge30KICAgICAgICAgICAgfQogICAg\nICAgICAgICBlcnIgPSByZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfU1RPUkVfQUNUSVZFOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKHJlbGVhc2VDb25uKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICByZWxlYXNlQ29ubmVjdGlvbigpOwogICAgICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgICAgICBpZiAoZXJyID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAg\nZXJyID0gcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChmb3JjZWRSb2xsYmFjaykKICAgICAgICAgICAgdGhyb3cgZXJyOwogICAg\nICAgIHJldHVybiBlcnI7CiAgICB9CgogICAgcHVibGljIHZvaWQgY29tbWl0\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigp\nOwoKICAgICAgICAgICAgamF2YXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24g\ndHJhbnMgPQogICAgICAgICAgICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rp\nb25NYW5hZ2VyKCkuZ2V0VHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYg\nKHRyYW5zID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOwoK\nICAgICAgICAgICAgLy8gdGhpcyBjb21taXQgb24gdGhlIHRyYW5zYWN0aW9u\nIHdpbGwgY2F1c2Ugb3VyCiAgICAgICAgICAgIC8vIGJlZm9yZUNvbXBsZXRp\nb24gbWV0aG9kIHRvIGJlIGludm9rZWQKICAgICAgICAgICAgdHJhbnMuY29t\nbWl0KCk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAg\nICAgICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVy\ncm9yIiksIGtlKTsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNU\ncmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xv\nYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBlKTsKICAgICAgICAgICAgdGhy\nb3cgbmV3IFN0b3JlRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNz\nZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKTsKCiAgICAgICAgICAgIGphdmF4\nLnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAgICAg\nICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5z\nYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyAhPSBudWxsKQogICAg\nICAgICAgICAgICAgdHJhbnMucm9sbGJhY2soKTsKICAgICAgICB9IGNhdGNo\nIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGlmIChfbG9n\nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRyYWNl\nKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwga2UpOwogICAgICAgICAg\nICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgX2xvZy50cmFjZShfbG9jLmdldCgiZW5kLXRyYW5zLWVycm9y\nIiksIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVFeGNlcHRpb24o\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHN5\nbmNXaXRoTWFuYWdlZFRyYW5zYWN0aW9uKCkgewogICAgICAgIGFzc2VydE9w\nZW4oKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgIT0gMCkKICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoIV9tYW5hZ2Vk\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgidHJhbnMtbm90LW1hbmFnZWQiKSk7CiAgICAgICAg\nICAgIGlmIChfZmFjdG9yeS5zeW5jV2l0aE1hbmFnZWRUcmFuc2FjdGlvbih0\naGlzLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIGJlZ2luSW50ZXJuYWwo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgY29tbWl0QW5kUmVzdW1lKCkgewogICAgICAgIGVuZEFu\nZFJlc3VtZSh0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByb2xsYmFj\na0FuZFJlc3VtZSgpIHsKICAgICAgICBlbmRBbmRSZXN1bWUoZmFsc2UpOwog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBlbmRBbmRSZXN1bWUoYm9vbGVhbiBj\nb21taXQpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGNvbW1pdCkKICAgICAgICAgICAg\nICAgIGNvbW1pdCgpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICByb2xsYmFjaygpOwogICAgICAgICAgICBiZWdpbigpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRSb2xsYmFja09ubHko\nKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0g\nMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAg\nIGphdmF4LnRyYW5zYWN0aW9uLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAg\nICAgICAgICAgIF9ydW50aW1lLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdl\ndFRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0cmFucyA9PSBudWxs\nKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBy\nZXR1cm4gdHJhbnMuZ2V0U3RhdHVzKCkgPT0gU3RhdHVzLlNUQVRVU19NQVJL\nRURfUk9MTEJBQ0s7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJh\nbEV4Y2VwdGlvbihlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIFRocm93YWJsZSBnZXRSb2xsYmFja0NhdXNlKCkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIGphdmF4LnRyYW5zYWN0aW9u\nLlRyYW5zYWN0aW9uIHRyYW5zID0KICAgICAgICAgICAgICAgIF9ydW50aW1l\nLmdldFRyYW5zYWN0aW9uTWFuYWdlcigpLmdldFRyYW5zYWN0aW9uKCk7CiAg\nICAgICAgICAgIGlmICh0cmFucyA9PSBudWxsKQogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmICh0cmFucy5nZXRTdGF0dXMo\nKSA9PSBTdGF0dXMuU1RBVFVTX01BUktFRF9ST0xMQkFDSykKICAgICAgICAg\nICAgICAgIHJldHVybiBfcnVudGltZS5nZXRSb2xsYmFja0NhdXNlKCk7Cgog\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGNhdGNoIChPcGVu\nSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBHZW5lcmFsRXhjZXB0aW9uKGUpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZXRSb2xsYmFja09ubHkoKSB7CiAgICAgICAg\nc2V0Um9sbGJhY2tPbmx5KG5ldyBVc2VyRXhjZXB0aW9uKCkpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldFJvbGxiYWNrT25seShUaHJvd2FibGUgY2F1\nc2UpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBhc3NlcnRUcmFuc2FjdGlvbk9wZXJhdGlvbigp\nOwogICAgICAgICAgICBzZXRSb2xsYmFja09ubHlJbnRlcm5hbChjYXVzZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFyayB0aGUg\nY3VycmVudCB0cmFuc2FjdGlvbiBhcyByb2xsYmFjay1vbmx5LgogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgc2V0Um9sbGJhY2tPbmx5SW50ZXJuYWwoVGhy\nb3dhYmxlIGNhdXNlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgamF2\nYXgudHJhbnNhY3Rpb24uVHJhbnNhY3Rpb24gdHJhbnMgPQogICAgICAgICAg\nICAgICAgX3J1bnRpbWUuZ2V0VHJhbnNhY3Rpb25NYW5hZ2VyKCkuZ2V0VHJh\nbnNhY3Rpb24oKTsKICAgICAgICAgICAgaWYgKHRyYW5zID09IG51bGwpCiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJudWxsLXRyYW5zIikpOwogICAgICAgICAgICAvLyBlbnN1\ncmUgdHJhbiBpcyBpbiBhIHZhbGlkIHN0YXRlIHRvIGFjY2VwdCB0aGUgc2V0\nUm9sbGJhY2tPbmx5CiAgICAgICAgICAgIGludCB0cmFuU3RhdHVzID0gdHJh\nbnMuZ2V0U3RhdHVzKCk7CiAgICAgICAgICAgIGlmICgodHJhblN0YXR1cyAh\nPSBTdGF0dXMuU1RBVFVTX05PX1RSQU5TQUNUSU9OKQogICAgICAgICAgICAg\nICAgICAgICYmICh0cmFuU3RhdHVzICE9IFN0YXR1cy5TVEFUVVNfUk9MTEVE\nQkFDSykKICAgICAgICAgICAgICAgICAgICAmJiAodHJhblN0YXR1cyAhPSBT\ndGF0dXMuU1RBVFVTX0NPTU1JVFRFRCkpCiAgICAgICAgICAgICAgICBfcnVu\ndGltZS5zZXRSb2xsYmFja09ubHkoY2F1c2UpOwogICAgICAgICAgICBlbHNl\nIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBf\nbG9nLnRyYWNlKF9sb2MuZ2V0KCJpbnZhbGlkLXRyYW4tc3RhdHVzIiwgbmV3\nIEludGVnZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5TdGF0dXMp\nLCAic2V0Um9sbGJhY2tPbmx5IikpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5K\nUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEdlbmVyYWxFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHNldFNhdmVwb2ludChTdHJpbmcgbmFtZSkgewogICAg\nICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGFzc2VydEFjdGl2ZVRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAg\nIGlmIChfc2F2ZXBvaW50cyAhPSBudWxsICYmIF9zYXZlcG9pbnRzLmNvbnRh\naW5zS2V5KG5hbWUpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoInNhdmVwb2ludC1leGlzdHMiLCBuYW1lKSk7\nCgogICAgICAgICAgICBpZiAoaGFzRmx1c2hlZCgpICYmICFfc3BtLnN1cHBv\ncnRzSW5jcmVtZW50YWxGbHVzaCgpKQogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFVuc3VwcG9ydGVkRXhjZXB0aW9uKF9sb2MuZ2V0CiAgICAgICAgICAg\nICAgICAgICAgKCJzYXZlcG9pbnQtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsK\nCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQgc2F2ZSA9IF9zcG0ubmV3\nU2F2ZXBvaW50KG5hbWUsIHRoaXMpOwogICAgICAgICAgICBpZiAoX3NhdmVw\nb2ludHMgPT0gbnVsbCB8fCBfc2F2ZXBvaW50cy5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgICAgIHNhdmUuc2F2ZShnZXRUcmFuc2FjdGlvbmFsU3RhdGVz\nKCkpOwogICAgICAgICAgICAgICAgX3NhdmVwb2ludHMgPSBuZXcgTGlua2Vk\nTWFwKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBp\nZiAoX3NhdmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgc2F2ZS5zYXZlKENvbGxlY3Rpb25zLkVNUFRZX1NFVCk7CiAgICAgICAg\nICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzYXZlLnNhdmUo\nX3NhdmVwb2ludENhY2hlKTsKICAgICAgICAgICAgICAgICAgICBfc2F2ZXBv\naW50Q2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBfc2F2ZXBvaW50cy5wdXQobmFtZSwgc2F2ZSk7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihl\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRp\nb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVsZWFz\nZVNhdmVwb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09\nIG51bGwgfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3Rz\nYXZlcG9pbnQiKSk7CiAgICAgICAgICAgIHJlbGVhc2VTYXZlcG9pbnQoKFN0\ncmluZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3NhdmVw\nb2ludHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCByZWxlYXNlU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9pbnQp\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAg\nICAgICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxsKSA/\nIC0xCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yoc2F2\nZXBvaW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1z\nYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNsZWFy\nIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQg\nc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUoKSA+\nIGluZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVuSlBB\nU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAgICAg\nICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAg\nICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJl\nbW92ZShpbmRleCk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZSh0cnVlKTsK\nICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQogICAg\nICAgICAgICAgICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAgICAg\nfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0\naHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcm9sbGJhY2tUb1NhdmVw\nb2ludCgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zYXZlcG9pbnRzID09IG51bGwg\nfHwgX3NhdmVwb2ludHMuaXNFbXB0eSgpKQogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm5vLWxhc3RzYXZlcG9p\nbnQiKSk7CiAgICAgICAgICAgIHJvbGxiYWNrVG9TYXZlcG9pbnQoKFN0cmlu\nZykgX3NhdmVwb2ludHMuZ2V0CiAgICAgICAgICAgICAgICAoX3NhdmVwb2lu\ndHMuc2l6ZSgpIC0gMSkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByb2xsYmFja1RvU2F2ZXBvaW50KFN0cmluZyBzYXZlcG9pbnQp\nIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKCiAg\nICAgICAgICAgIGludCBpbmRleCA9IChfc2F2ZXBvaW50cyA9PSBudWxsKSA/\nIC0xCiAgICAgICAgICAgICAgICA6IF9zYXZlcG9pbnRzLmluZGV4T2Yoc2F2\nZXBvaW50KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1z\nYXZlcG9pbnQiLCBzYXZlcG9pbnQpKTsKCiAgICAgICAgICAgIC8vIGNsZWFy\nIG9sZCBpbiByZXZlcnNlCiAgICAgICAgICAgIE9wZW5KUEFTYXZlcG9pbnQg\nc2F2ZTsKICAgICAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzLnNpemUoKSA+\nIGluZGV4ICsgMSkgewogICAgICAgICAgICAgICAgc2F2ZSA9IChPcGVuSlBB\nU2F2ZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUKICAgICAgICAgICAgICAg\nICAgICAoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAg\nICBzYXZlLnJlbGVhc2UoZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBzYXZlID0gKE9wZW5KUEFTYXZlcG9pbnQpIF9zYXZlcG9pbnRzLnJl\nbW92ZShpbmRleCk7CiAgICAgICAgICAgIENvbGxlY3Rpb24gc2F2ZWQgPSBz\nYXZlLnJvbGxiYWNrKF9zYXZlcG9pbnRzLnZhbHVlcygpKTsKICAgICAgICAg\nICAgaWYgKF9zYXZlcG9pbnRDYWNoZSAhPSBudWxsKQogICAgICAgICAgICAg\nICAgX3NhdmVwb2ludENhY2hlLmNsZWFyKCk7CiAgICAgICAgICAgIGlmICho\nYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKSB7CiAgICAgICAgICAgICAgICAv\nLyBidWlsZCB1cCBhIG5ldyBjb2xsZWN0aW9uIG9mIHN0YXRlcwogICAgICAg\nICAgICAgICAgVHJhbnNhY3Rpb25hbENhY2hlIG9sZFRyYW5zQ2FjaGUgPSBf\ndHJhbnNDYWNoZTsKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uYWxDYWNo\nZSBuZXdUcmFuc0NhY2hlID0gbmV3IFRyYW5zYWN0aW9uYWxDYWNoZQogICAg\nICAgICAgICAgICAgICAgIChfb3JkZXJEaXJ0eSk7CiAgICAgICAgICAgICAg\nICBfdHJhbnNDYWNoZSA9IG51bGw7CgogICAgICAgICAgICAgICAgLy8gY3Vy\ncmVudGx5IHRoZXJlIGlzIHRoZSBhc3N1bXB0aW9uIHRoYXQgaW5jcmVtZW50\nYWwKICAgICAgICAgICAgICAgIC8vIGZsdXNoIGlzIGVpdGhlciBhKSBub3Qg\nYWxsb3dlZCwgb3IgYikgcmVxdWlyZWQKICAgICAgICAgICAgICAgIC8vIHBy\nZS1zYXZlcG9pbnQuICB0aGlzIHNvbHZlcyBhIG51bWJlciBvZiBpc3N1ZXMg\naW5jbHVkaW5nCiAgICAgICAgICAgICAgICAvLyBzdG9yaW5nIGZsdXNoZWQg\nc3RhdGVzIGFzIHdlbGwgYXMgT0lEIGhhbmRsaW5nLgogICAgICAgICAgICAg\nICAgLy8gaWYgZnV0dXJlIHBsdWdpbnMgZG8gbm90IGZvbGxvdyB0aGlzLCB3\nZSBuZWVkIHRvIGNhY2hlCiAgICAgICAgICAgICAgICAvLyBtb3JlIGluZm8g\ncGVyIHN0YXRlCiAgICAgICAgICAgICAgICBTYXZlcG9pbnRGaWVsZE1hbmFn\nZXIgZm07CiAgICAgICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwog\nICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIgPSBzYXZlZC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIGZtID0gKFNhdmVwb2ludEZpZWxkTWFuYWdlcikgaXRyLm5leHQoKTsK\nICAgICAgICAgICAgICAgICAgICBzbSA9IGZtLmdldFN0YXRlTWFuYWdlcigp\nOwogICAgICAgICAgICAgICAgICAgIHNtLnJvbGxiYWNrVG9TYXZlcG9pbnQo\nZm0pOwogICAgICAgICAgICAgICAgICAgIG9sZFRyYW5zQ2FjaGUucmVtb3Zl\nKHNtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEaXJ0eSgpKQog\nICAgICAgICAgICAgICAgICAgICAgICBuZXdUcmFuc0NhY2hlLmFkZERpcnR5\nKHNtKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICAgICAgICAgIG5ld1RyYW5zQ2FjaGUuYWRkQ2xlYW4oc20pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBp\ndHIgPSBvbGRUcmFuc0NhY2hlLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1w\nbCkgaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBzbS5yb2xsYmFj\naygpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21UcmFuc2FjdGlv\nbihzbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdHJh\nbnNDYWNoZSA9IG5ld1RyYW5zQ2FjaGU7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAg\nICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\nZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0\naW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGZsdXNo\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIHJldHVybiBzaWxlbnRseSBpZiBubyB0cmFu\ncyBpcyBhY3RpdmUsIG9yIGlmIHRoaXMgaXMgYSByZWVudHJhbnQKICAgICAg\nICAgICAgLy8gY2FsbCwgd2hpY2ggY2FuIGhhcHBlbiBpZiB0aGUgc3RvcmUg\nbWFuYWdlciB0cmllcyB0byBnZXQgYW4KICAgICAgICAgICAgLy8gYXV0by1p\nbmMgb2lkIGR1cmluZyBmbHVzaAogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSA9PSAwCiAgICAgICAgICAgICAgICB8fCAoX2ZsYWdz\nICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAgICAgICAgICAg\nIHJldHVybjsKCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGlt\nZSBzdXBwb3J0cyBpdAogICAgICAgICAgICBpZiAoIV9jb25mLnN1cHBvcnRl\nZE9wdGlvbnMoKS5jb250YWlucyhPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJ\nT05fSU5DX0ZMVVNIKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1\ncHBvcnRlZEV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAg\nICgiaW5jcmVtZW50YWwtZmx1c2gtbm90LXN1cHBvcnRlZCIpKTsKICAgICAg\nICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYgIV9zYXZlcG9pbnRz\nLmlzRW1wdHkoKQogICAgICAgICAgICAgICAgJiYgIV9zcG0uc3VwcG9ydHNJ\nbmNyZW1lbnRhbEZsdXNoKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAg\nICAgICAoInNhdmVwb2ludC1mbHVzaC1ub3Qtc3VwcG9ydGVkIikpOwoKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZsdXNoU2FmZShGTFVT\nSF9JTkMpOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfRkxVU0hF\nRDsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICAgICAgLy8gcm9sbGJhY2sgb24gZmx1c2ggZXJyb3I7\nIG9iamVjdHMgbWF5IGJlIGluIGluY29uc2lzdGVudCBzdGF0ZQogICAgICAg\nICAgICAgICAgc2V0Um9sbGJhY2tPbmx5KGtlKTsKICAgICAgICAgICAgICAg\nIHRocm93IGtlLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICAvLyBy\nb2xsYmFjayBvbiBmbHVzaCBlcnJvcjsgb2JqZWN0cyBtYXkgYmUgaW4gaW5j\nb25zaXN0ZW50IHN0YXRlCiAgICAgICAgICAgICAgICBzZXRSb2xsYmFja09u\nbHkocmUpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFN0b3JlRXhjZXB0\naW9uKHJlKS5zZXRGYXRhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHByZUZsdXNo\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpICE9\nIDApCiAgICAgICAgICAgICAgICBmbHVzaFNhZmUoRkxVU0hfTE9HSUNBTCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHZhbGlkYXRl\nQ2hhbmdlcygpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBubyB0cmFucywganVzdCBy\nZXR1cm47IGlmIGFjdGl2ZSBkYXRhc3RvcmUgdHJhbnMsIGZsdXNoCiAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApCiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19TVE9SRV9BQ1RJVkUpICE9IDApIHsKICAgICAgICAgICAgICAgIGZs\ndXNoKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcnVudGltZSBzdXBwb3J0\ncyBpbmMgZmx1c2gKICAgICAgICAgICAgaWYgKCFfY29uZi5zdXBwb3J0ZWRP\ncHRpb25zKCkuY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24uT1BUSU9O\nX0lOQ19GTFVTSCkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBw\nb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICAgICAo\nImluY3JlbWVudGFsLWZsdXNoLW5vdC1zdXBwb3J0ZWQiKSk7CgogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgZmx1c2hTYWZlKEZMVVNIX1JP\nTExCQUNLKTsKICAgICAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTdG9yZUV4Y2VwdGlvbihyZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0FjdGl2ZSgpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKF9mbGFncyAm\nIEZMQUdfQUNUSVZFKSAhPSAwOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1N0b3JlQWN0aXZlKCkgewogICAgICAgIC8vIHdl\nIG5lZWQgdG8gbG9jayBoZXJlLCBiZWNhdXNlIHdlIG1pZ2h0IGJlIGluIHRo\nZSBtaWRkbGUgb2YgYW4KICAgICAgICAvLyBhdG9taWMgdHJhbnNhY3Rpb24g\ncHJvY2VzcyAoZS5nLiwgY29tbWl0QW5kUmVzdW1lKQogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiAoX2ZsYWdzICYgRkxBR19TVE9SRV9BQ1RJVkUpICE9IDA7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIg\ndGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gaXMgZW5kaW5nLCBpLmUuIGluIHRo\nZSAybmQgcGhhc2UKICAgICAqIG9mIGEgY29tbWl0IG9yIHJvbGxiYWNrCiAg\nICAgKi8KICAgIGJvb2xlYW4gaXNUcmFuc2FjdGlvbkVuZGluZygpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfVFJBTlNfRU5ESU5HKSAhPSAw\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGJlZ2luT3BlcmF0aW9uKGJv\nb2xlYW4gc3luY1RyYW5zKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKCiAgICAgICAgICAgIGlm\nIChzeW5jVHJhbnMgJiYgX29wZXJhdGlvbkNvdW50ID09IDAgJiYgX3N5bmNN\nYW5hZ2VkCiAgICAgICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19BQ1RJ\nVkUpID09IDApCiAgICAgICAgICAgICAgICBzeW5jV2l0aE1hbmFnZWRUcmFu\nc2FjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gX29wZXJhdGlvbkNvdW50\nKysgPT0gMTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgICAgICB0aHJvdyBuZXcgR2Vu\nZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogTWFyayB0aGUgb3BlcmF0aW9uIG92ZXIuIElmIG91dGVybW9zdCBj\nYWxsZXIgb2Ygc3RhY2ssIHJldHVybnMgdHJ1ZQogICAgICogYW5kIHdpbGwg\nZGV0YWNoIG1hbmFnZWQgaW5zdGFuY2VzIGlmIG5lY2Vzc2FyeS4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gZW5kT3BlcmF0aW9uKCkgewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQgPT0gMSAm\nJiAoX2F1dG9EZXRhY2ggJiBERVRBQ0hfTk9OVFhSRUFEKSAhPSAwCiAgICAg\nICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19BQ1RJVkUpID09IDApIHsK\nICAgICAgICAgICAgICAgIGRldGFjaEFsbEludGVybmFsKG51bGwpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW9uQ291bnQgPCAx\nKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJtdWx0aS10aHJlYWRlZC1hY2Nlc3MiKSk7CiAgICAgICAg\nICAgIHJldHVybiBfb3BlcmF0aW9uQ291bnQgPT0gMTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9vcGVyYXRpb25Db3Vu\ndC0tOwogICAgICAgICAgICBpZiAoX29wZXJhdGlvbkNvdW50ID09IDApCiAg\nICAgICAgICAgICAgICBpbml0aWFsaXplT3BlcmF0aW5nU2V0KCk7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nU3luY2hyb25pemF0aW9uIGdldFN5bmNocm9uaXphdGlvbigpIHsKICAgICAg\nICByZXR1cm4gX3N5bmM7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0U3lu\nY2hyb25pemF0aW9uKFN5bmNocm9uaXphdGlvbiBzeW5jKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIF9zeW5jID0gc3luYzsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgU3luY2hyb25pemF0aW9u\nIGludGVyZmFjZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBiZWZvcmVDb21w\nbGV0aW9uKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyB1c2VyLXN1cHBsaWVkIHN5bmNo\ncm9uaXphdGlvbgogICAgICAgICAgICBpZiAoX3N5bmMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zeW5jLmJlZm9yZUNvbXBsZXRpb24oKTsKCiAgICAg\nICAgICAgIGZsdXNoU2FmZShGTFVTSF9DT01NSVQpOwogICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9s\nb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAgICAgICAgIF9sb2cudHJh\nY2UoX2xvYy5nZXQoImVuZC10cmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAg\nICAgIHRocm93IHRyYW5zbGF0ZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9u\nKGtlKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7\nCiAgICAgICAgICAgIGlmIChfbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAg\nICAgICAgICAgICBfbG9nLnRyYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJy\nb3IiKSwgcmUpOwogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2Vk\nQ29tcGxldGlvbkV4Y2VwdGlvbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24o\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgYWZ0ZXJDb21w\nbGV0aW9uKGludCBzdGF0dXMpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbihm\nYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0QWN0aXZl\nVHJhbnNhY3Rpb24oKTsKCiAgICAgICAgICAgIF9mbGFncyB8PSBGTEFHX1RS\nQU5TX0VORElORzsKICAgICAgICAgICAgZW5kVHJhbnNhY3Rpb24oc3RhdHVz\nKTsKICAgICAgICAgICAgaWYgKF9zeW5jICE9IG51bGwpCiAgICAgICAgICAg\nICAgICBfc3luYy5hZnRlckNvbXBsZXRpb24oc3RhdHVzKTsKCiAgICAgICAg\nICAgIGlmICgoX2F1dG9EZXRhY2ggJiBERVRBQ0hfQ09NTUlUKSAhPSAwKQog\nICAgICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWwobnVsbCk7CiAgICAg\nICAgICAgIGVsc2UgaWYgKHN0YXR1cyA9PSBTdGF0dXMuU1RBVFVTX1JPTExF\nREJBQ0sKICAgICAgICAgICAgICAgICYmIChfYXV0b0RldGFjaCAmIERFVEFD\nSF9ST0xMQkFDSykgIT0gMCkgewogICAgICAgICAgICAgICAgZGV0YWNoQWxs\nSW50ZXJuYWwobnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGluIGFuIGVlIGNvbnRleHQsIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgdXNl\nciB0cmllZCB0byBjbG9zZQogICAgICAgICAgICAvLyB1cyBidXQgd2UgZGlk\nbid0IGFjdHVhbGx5IGNsb3NlIGJlY2F1c2Ugd2Ugd2VyZSB3YWl0aW5nIG9u\nIHRoaXMKICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb247IGlmIHRoYXQncyB0\ncnVlLCB0aGVuIGNsb3NlIG5vdwogICAgICAgICAgICBpZiAoKF9mbGFncyAm\nIEZMQUdfQ0xPU0VfSU5WT0tFRCkgIT0gMAogICAgICAgICAgICAgICAgJiYg\nX2NvbXBhdC5nZXRDbG9zZU9uTWFuYWdlZENvbW1pdCgpKQogICAgICAgICAg\nICAgICAgZnJlZSgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQo\nKSkKICAgICAgICAgICAgICAgIF9sb2cudHJhY2UoX2xvYy5nZXQoImVuZC10\ncmFucy1lcnJvciIpLCBrZSk7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0\nZU1hbmFnZWRDb21wbGV0aW9uRXhjZXB0aW9uKGtlKTsKICAgICAgICB9IGNh\ndGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIGlmIChf\nbG9nLmlzVHJhY2VFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBfbG9nLnRy\nYWNlKF9sb2MuZ2V0KCJlbmQtdHJhbnMtZXJyb3IiKSwgcmUpOwogICAgICAg\nICAgICB0aHJvdyB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2VwdGlv\nbihuZXcgU3RvcmVFeGNlcHRpb24ocmUpKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfQUNUSVZFOwogICAgICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICAgICAgX2Zs\nYWdzICY9IH5GTEFHX1RSQU5TX0VORElORzsKCiAgICAgICAgICAgIC8vIGV2\nZW50IG1hbmFnZXIgbnVsbGVkIGlmIGZyZWVkIGJyb2tlcgogICAgICAgICAg\nICBpZiAoX3RyYW5zRXZlbnRNYW5hZ2VyICE9IG51bGwgCiAgICAgICAgICAg\nICAgICAmJiBfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkp\nIHsKICAgICAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBU\ncmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAgc3Rh\ndHVzID09IFN0YXR1cy5TVEFUVVNfQ09NTUlUVEVECiAgICAgICAgICAgICAg\nICAgICAgICAgID8gVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01NSVRfQ09N\nUExFVEUKICAgICAgICAgICAgICAgICAgICAgICAgOiBUcmFuc2FjdGlvbkV2\nZW50LkFGVEVSX1JPTExCQUNLX0NPTVBMRVRFLAogICAgICAgICAgICAgICAg\nICAgIG51bGwsIG51bGwsIG51bGwsIG51bGwpKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogSWYgd2UncmUgaW4gYSBtYW5hZ2VkIHRyYW5zYWN0\naW9uLCB1c2Ugb3VyIGltcGxpY2l0IGJlaGF2aW9yIGV4Y2VwdGlvbgogICAg\nICogdHJhbnNsYXRvciB0byB0cmFuc2xhdGUgYmVmb3JlL2FmdGVyQ29tcGxl\ndGlvbiBjYWxsYmFjayBlcnJvcnMuCiAgICAgKi8KICAgIHByaXZhdGUgUnVu\ndGltZUV4Y2VwdGlvbiB0cmFuc2xhdGVNYW5hZ2VkQ29tcGxldGlvbkV4Y2Vw\ndGlvbgogICAgICAgIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\ncmV0dXJuICghX21hbmFnZWQgfHwgX2V4dHJhbnMgPT0gbnVsbCkgPyByZSA6\nIF9leHRyYW5zLnRyYW5zbGF0ZShyZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGbHVzaCBzYWZlbHksIGNhdGNoaW5nIHJlZW50cmFudCBjYWxscy4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoU2FmZShpbnQgcmVhc29uKSB7\nCiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0ZMVVNISU5HKSAhPSAwKQog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJyZWVudHJhbnQtZmx1c2giKSk7CgogICAgICAgIF9mbGFncyB8\nPSBGTEFHX0ZMVVNISU5HOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZs\ndXNoKHJlYXNvbik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nX2ZsYWdzICY9IH5GTEFHX0ZMVVNISU5HOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEZsdXNoIHRoZSB0cmFuc2FjdGlvbmFsIHN0YXRlIHRv\nIHRoZSBkYXRhIHN0b3JlLiBTdWJjbGFzc2VzIHRoYXQKICAgICAqIGN1c3Rv\nbWl6ZSBjb21taXQgYmVoYXZpb3Igc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0\naG9kLiBUaGUgbWV0aG9kCiAgICAgKiBhc3N1bWVzIHRoYXQgdGhlIHBlcnNp\nc3RlbmNlIG1hbmFnZXIgaXMgbG9ja2VkLCBpcyBub3QgY2xvc2VkLAogICAg\nICogYW5kIGhhcyBhbiBhY3RpdmUgdHJhbnNhY3Rpb24uCiAgICAgKgogICAg\nICogQHBhcmFtIHJlYXNvbiBvbmUgb2Yge0BsaW5rICNGTFVTSF9JTkN9LCB7\nQGxpbmsgI0ZMVVNIX0NPTU1JVH0sCiAgICAgKiB7QGxpbmsgI0ZMVVNIX1JP\nTExCQUNLfSwgb3Ige0BsaW5rICNGTFVTSF9MT0dJQ0FMfQogICAgICogQHNp\nbmNlIDAuMi41CiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGZsdXNoKGlu\ndCByZWFzb24pIHsKICAgICAgICAvLyB0aGlzIHdpbGwgZW5saXN0IHByb3hp\nZWQgc3RhdGVzIGFzIG5lY2Vzc2FyeSBzbyB3ZSBrbm93IHdoZXRoZXIgd2UK\nICAgICAgICAvLyBoYXZlIGFueXRoaW5nIHRvIGZsdXNoCiAgICAgICAgQ29s\nbGVjdGlvbiB0cmFuc2FjdGlvbmFsID0gZ2V0VHJhbnNhY3Rpb25hbFN0YXRl\ncygpOwoKICAgICAgICAvLyBkbyB3ZSBhY3R1YWxseSBoYXZlIHRvIGZsdXNo\nPyAgb25seSBpZiBvdXIgZmxhZ3Mgc2F5IHNvLCBvciBpZgogICAgICAgIC8v\nIHdlIGhhdmUgdHJhbnNhY3Rpb24gbGlzdGVuZXJzIHRoYXQgbmVlZCB0byBi\nZSBpbnZva2VkIGZvciBjb21taXQKICAgICAgICAvLyAobm8gbmVlZCB0byBp\nbnZva2UgdGhlbSBvbiBpbmMgZmx1c2ggaWYgbm90aGluZyBpcyBkaXJ0eSku\nICB3ZQogICAgICAgIC8vIHNwZWNpYWwgY2FzZSB0aGUgcmVtb3RlIGNvbW1p\ndCBsaXN0ZW5lciB1c2VkIGJ5IHRoZSBkYXRhY2FjaGUgY2F1c2UKICAgICAg\nICAvLyB3ZSBrbm93IGl0IGRvZXNuJ3QgcmVxdWlyZSB0aGUgY29tbWl0IGV2\nZW50IHdoZW4gbm90aGluZyBjaGFuZ2VzCiAgICAgICAgYm9vbGVhbiBmbHVz\naCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJUkVEKSAhPSAwOwogICAg\nICAgIGJvb2xlYW4gbGlzdGVuZXJzID0gKF90cmFuc0V2ZW50TWFuYWdlci5o\nYXNGbHVzaExpc3RlbmVycygpCiAgICAgICAgICAgIHx8IF90cmFuc0V2ZW50\nTWFuYWdlci5oYXNFbmRMaXN0ZW5lcnMoKSkKICAgICAgICAgICAgJiYgKChf\nZmxhZ3MgJiBGTEFHX1JFTU9URV9MSVNURU5FUikgPT0gMAogICAgICAgICAg\nICB8fCBfdHJhbnNFdmVudE1hbmFnZXIuZ2V0TGlzdGVuZXJzKCkuc2l6ZSgp\nID4gMSk7CiAgICAgICAgaWYgKCFmbHVzaCAmJiAocmVhc29uICE9IEZMVVNI\nX0NPTU1JVCB8fCAhbGlzdGVuZXJzKSkKICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICBDb2xsZWN0aW9uIG1vYmpzID0gbnVsbDsKICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19QUkVTVE9SSU5HOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChmbHVzaCkgewogICAgICAgICAgICAgICAgLy8gY2FsbCBwcmUg\nc3RvcmUgb24gYWxsIGN1cnJlbnRseSB0cmFuc2FjdGlvbmFsIG9ianMKICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gdHJhbnNhY3Rpb25h\nbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAg\nICAgICAoKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCkpLmJlZm9yZUZs\ndXNoKHJlYXNvbiwgX2NhbGwpOwogICAgICAgICAgICAgICAgZmx1c2hBZGRp\ndGlvbnModHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaG9wZWZ1bGx5IG5vdyBhbGwgZGVwZW5kZW50IGlu\nc3RhbmNlcyB0aGF0IGFyZSBnb2luZyB0byBlbmQKICAgICAgICAgICAgLy8g\ndXAgcmVmZXJlbmNlZCBoYXZlIGJlZW4gbWFya2VkIGFzIHN1Y2g7IGRlbGV0\nZSB1bnJlZmVkCiAgICAgICAgICAgIC8vIGRlcGVuZGVudHMKICAgICAgICAg\nICAgX2ZsYWdzIHw9IEZMQUdfREVSRUZERUxFVElORzsKICAgICAgICAgICAg\naWYgKGZsdXNoICYmIF9kZXJlZkNhY2hlICE9IG51bGwgJiYgIV9kZXJlZkNh\nY2hlLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRv\ncjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBfZGVyZWZDYWNoZS5pdGVyYXRv\ncigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAgICBkZWxl\ndGVEZXJlZihpdHIubmV4dCgpKTsKICAgICAgICAgICAgICAgIGZsdXNoQWRk\naXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChyZWFzb24gIT0gRkxVU0hfTE9HSUNBTCkgewog\nICAgICAgICAgICAgICAgLy8gaWYgbm8gZGF0YXN0b3JlIHRyYW5zYWN0aW9u\nLCBzdGFydCBvbmU7IGV2ZW4gaWYgd2UgZG9uJ3QKICAgICAgICAgICAgICAg\nIC8vIHRoaW5rIHdlJ2xsIG5lZWQgdG8gZmx1c2ggYXQgdGhpcyBwb2ludCwg\nb3VyIHRyYW5zYWN0aW9uCiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5lcnMg\nbWlnaHQgaW50cm9kdWNlIHNvbWUgZGlydHkgb2JqZWN0cyBvciBpbnRlcmFj\ndAogICAgICAgICAgICAgICAgLy8gZGlyZWN0bHkgd2l0aCB0aGUgZGF0YWJh\nc2UKICAgICAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TVE9SRV9B\nQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICAgICAgYmVnaW5TdG9yZU1h\nbmFnZXJUcmFuc2FjdGlvbihmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYg\nKChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRmx1c2hMaXN0ZW5lcnMoKQogICAg\nICAgICAgICAgICAgICAgIHx8IF90cmFuc0V2ZW50TWFuYWdlci5oYXNFbmRM\naXN0ZW5lcnMoKSkKICAgICAgICAgICAgICAgICAgICAmJiAoZmx1c2ggfHwg\ncmVhc29uID09IEZMVVNIX0NPTU1JVCkpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyBmaXJlIGV2ZW50cwogICAgICAgICAgICAgICAgICAgIG1vYmpzID0g\nbmV3IE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKHRyYW5zYWN0aW9uYWwpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gPT0gRkxVU0hfQ09NTUlU\nCiAgICAgICAgICAgICAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdl\nci5oYXNFbmRMaXN0ZW5lcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBmaXJlVHJhbnNhY3Rpb25FdmVudChuZXcgVHJhbnNhY3Rpb25FdmVudCh0\naGlzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9u\nRXZlbnQuQkVGT1JFX0NPTU1JVCwgbW9ianMsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVs\nZXRlZENsc3MpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoQWRk\naXRpb25zKHRyYW5zYWN0aW9uYWwsIHJlYXNvbik7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGZsdXNoID0gKF9mbGFncyAmIEZMQUdfRkxVU0hfUkVRVUlS\nRUQpICE9IDA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgICAgICBpZiAoZmx1c2ggJiYgX3RyYW5zRXZlbnRNYW5hZ2VyLmhhc0Zs\ndXNoTGlzdGVuZXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmly\nZVRyYW5zYWN0aW9uRXZlbnQobmV3IFRyYW5zYWN0aW9uRXZlbnQodGhpcywg\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkV2ZW50\nLkJFRk9SRV9GTFVTSCwgbW9ianMsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBfcGVyc2lzdGVkQ2xzcywgX3VwZGF0ZWRDbHNzLCBfZGVsZXRlZENs\nc3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hBZGRpdGlvbnMo\ndHJhbnNhY3Rpb25hbCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19Q\nUkVTVE9SSU5HOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfREVSRUZE\nRUxFVElORzsKICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zID0gbnVsbDsK\nICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25zID0gbnVsbDsKCiAgICAgICAg\nICAgIC8vIGFsc28gY2xlYXIgZGVyZWZlZCBzZXQ7IHRoZSBkZWxldGVzIGhh\ndmUgYmVlbiByZWNvcmRlZAogICAgICAgICAgICBpZiAoX2RlcmVmQ2FjaGUg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9kZXJlZkNhY2hlID0gbnVsbDsK\nICAgICAgICB9CgogICAgICAgIC8vIGZsdXNoIHRvIHN0b3JlIG1hbmFnZXIK\nICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoZmx1c2ggJiYgcmVhc29uICE9IEZM\nVVNIX0xPR0lDQUwpIHsKICAgICAgICAgICAgICAgIF9mbGFncyB8PSBGTEFH\nX1NUT1JFX0ZMVVNISU5HOwogICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywKICAgICAgICAgICAgICAgICAgICBuZXdGbHVzaEV4Y2VwdGlv\nbihfc3RvcmUuZmx1c2godHJhbnNhY3Rpb25hbCkpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9mbGFncyAmPSB+\nRkxBR19TVE9SRV9GTFVTSElORzsKCiAgICAgICAgICAgIGlmIChyZWFzb24g\nPT0gRkxVU0hfUk9MTEJBQ0spCiAgICAgICAgICAgICAgICBleGNlcHMgPSBh\nZGQoZXhjZXBzLCBlbmRTdG9yZU1hbmFnZXJUcmFuc2FjdGlvbih0cnVlKSk7\nCiAgICAgICAgICAgIGVsc2UgaWYgKHJlYXNvbiAhPSBGTFVTSF9MT0dJQ0FM\nKQogICAgICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0ZMVVNIX1JFUVVJ\nUkVEOwoKICAgICAgICAgICAgLy8gbWFyayBzdGF0ZXMgYXMgZmx1c2hlZAog\nICAgICAgICAgICBpZiAoZmx1c2gpIHsKICAgICAgICAgICAgICAgIFN0YXRl\nTWFuYWdlckltcGwgc207CiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nIGl0ciA9IHRyYW5zYWN0aW9uYWwuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQo\nKTspIHsKICAgICAgICAgICAgICAgICAgICBzbSA9IChTdGF0ZU1hbmFnZXJJ\nbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzdGF0ZSBtYXkgaGF2ZSBi\nZWNvbWUgdHJhbnNpZW50LCBzdWNoIGFzIGlmCiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIGl0IGlzIGVtYmVkZGVkIGFuZCB0aGUgb3duZXIgaGFzIGJl\nZW4gZGVsZXRlZCBkdXJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\ndGhpcyBmbHVzaCBwcm9jZXNzOyBidWcgIzExMDAKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlRSQU5T\nSUVOVCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgc20uYWZ0ZXJGbHVzaChyZWFzb24p\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVhc29uID09IEZMVVNI\nX0lOQykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbm90\nIGFib3V0IHRvIGNsZWFyIHRyYW5zIGNhY2hlIGZvciBjb21taXQgCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBhbnl3YXksIHJlLWNhY2hlIGRp\ncnR5IG9iamVjdHMgd2l0aCBkZWZhdWx0IHNvZnQKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHJlZnM7IHdlIGRvbid0IG5lZWQgaGFyZCByZWZz\nIG5vdyB0aGF0IHRoZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGNoYW5nZXMgaGF2ZSBiZWVuIGZsdXNoZWQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHNtLnByb3h5RmllbGRzKHRydWUsIGZhbHNlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIF90cmFuc0NhY2hlLmZsdXNoZWQoc20p\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgZSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyB0aHJvdyBhbnkgZXhjZXB0aW9ucyB0byBzaG9y\ndGN1dCBsaXN0ZW5lcnMgb24gZmFpbAogICAgICAgIHRocm93TmVzdGVkRXhj\nZXB0aW9ucyhleGNlcHMsIHRydWUpOwoKICAgICAgICBpZiAoZmx1c2ggJiYg\ncmVhc29uICE9IEZMVVNIX1JPTExCQUNLICYmIHJlYXNvbiAhPSBGTFVTSF9M\nT0dJQ0FMCiAgICAgICAgICAgICYmIF90cmFuc0V2ZW50TWFuYWdlci5oYXNG\nbHVzaExpc3RlbmVycygpKSB7CiAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlv\nbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsCiAgICAgICAgICAg\nICAgICBUcmFuc2FjdGlvbkV2ZW50LkFGVEVSX0ZMVVNILCBtb2JqcywgX3Bl\ncnNpc3RlZENsc3MsCiAgICAgICAgICAgICAgICBfdXBkYXRlZENsc3MsIF9k\nZWxldGVkQ2xzcykpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEZsdXNoIG5ld2x5LXRyYW5zYWN0aW9uYWwgb2JqZWN0cy4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGZsdXNoQWRkaXRpb25zKENvbGxlY3Rpb24gdHJh\nbnNhY3Rpb25hbCwgaW50IHJlYXNvbikgewogICAgICAgIGJvb2xlYW4gbG9v\ncDsKICAgICAgICBkbyB7CiAgICAgICAgICAgIC8vIGZsdXNoIG5ldyB0cmFu\nc2FjdGlvbmFsIGluc3RhbmNlczsgbm90ZSBsb2dpY2FsIG9yCiAgICAgICAg\nICAgIGxvb3AgPSBmbHVzaFRyYW5zQWRkaXRpb25zKHRyYW5zYWN0aW9uYWws\nIHJlYXNvbikKICAgICAgICAgICAgICAgIHwgZGVsZXRlRGVyZWZBZGRpdGlv\nbnMoX2RlcmVmQ2FjaGUpOwogICAgICAgIH0gd2hpbGUgKGxvb3ApOwogICAg\nfQoKICAgIC8qKgogICAgICogRmx1c2ggdHJhbnNhY3Rpb25hbCBhZGRpdGlv\nbnMuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBmbHVzaFRyYW5zQWRk\naXRpb25zKENvbGxlY3Rpb24gdHJhbnNhY3Rpb25hbCwgaW50IHJlYXNvbikg\newogICAgICAgIGlmIChfdHJhbnNBZGRpdGlvbnMgPT0gbnVsbCB8fCBfdHJh\nbnNBZGRpdGlvbnMuaXNFbXB0eSgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIC8vIGtlZXAgbG9jYWwgdHJhbnNhY3Rpb25hbCBsaXN0\nIGNvcHkgdXAgdG8gZGF0ZQogICAgICAgIHRyYW5zYWN0aW9uYWwuYWRkQWxs\nKF90cmFuc0FkZGl0aW9ucyk7CgogICAgICAgIC8vIGNvcHkgdGhlIGNoYW5n\nZSBzZXQsIHRoZW4gY2xlYXIgaXQgZm9yIHRoZSBuZXh0IGl0ZXJhdGlvbgog\nICAgICAgIFN0YXRlTWFuYWdlckltcGxbXSBzdGF0ZXMgPSAoU3RhdGVNYW5h\nZ2VySW1wbFtdKSBfdHJhbnNBZGRpdGlvbnMuCiAgICAgICAgICAgIHRvQXJy\nYXkobmV3IFN0YXRlTWFuYWdlckltcGxbX3RyYW5zQWRkaXRpb25zLnNpemUo\nKV0pOwogICAgICAgIF90cmFuc0FkZGl0aW9ucyA9IG51bGw7CgogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICBzdGF0ZXNbaV0uYmVmb3JlRmx1c2gocmVhc29uLCBfY2FsbCk7\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\nZWxldGUgbmV3IGRlcmVmZXJlbmNlZCBvYmplY3RzLgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gZGVsZXRlRGVyZWZBZGRpdGlvbnMoQ29sbGVjdGlv\nbiBkZXJlZnMpIHsKICAgICAgICBpZiAoX2RlcmVmQWRkaXRpb25zID09IG51\nbGwgfHwgX2RlcmVmQWRkaXRpb25zLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyByZW1lbWJlciB0aGVzZSBhZGRp\ndGlvbnMgaW4gY2FzZSBvbmUgYmVjb21lcyBkZXJlZmVkIGFnYWluIGxhdGVy\nCiAgICAgICAgZGVyZWZzLmFkZEFsbChfZGVyZWZBZGRpdGlvbnMpOwoKICAg\nICAgICBTdGF0ZU1hbmFnZXJJbXBsW10gc3RhdGVzID0gKFN0YXRlTWFuYWdl\nckltcGxbXSkgX2RlcmVmQWRkaXRpb25zLgogICAgICAgICAgICB0b0FycmF5\nKG5ldyBTdGF0ZU1hbmFnZXJJbXBsW19kZXJlZkFkZGl0aW9ucy5zaXplKCld\nKTsKICAgICAgICBfZGVyZWZBZGRpdGlvbnMgPSBudWxsOwoKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IHN0YXRlcy5sZW5ndGg7IGkrKykKICAgICAg\nICAgICAgZGVsZXRlRGVyZWYoc3RhdGVzW2ldKTsKICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGRlcmVmZXJl\nbmNlZCBkZXBlbmRlbnQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkZWxl\ndGVEZXJlZihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAgICAgaW50IGFj\ndGlvbiA9IHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9ERUxFVEUs\nCiAgICAgICAgICAgIHNtLmdldE1hbmFnZWRJbnN0YW5jZSgpLCBzbSwgbnVs\nbCk7CiAgICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfUlVO\nKSAhPSAwKQogICAgICAgICAgICBzbS5kZWxldGUoKTsKICAgICAgICBpZiAo\nKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFDVF9DQVNDQURFKSAhPSAwKQogICAg\nICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKF9jYWxsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIERldGVybWluZSB0aGUgYWN0aW9uIHRvIHRha2UgYmFzZWQg\nb24gdGhlIHVzZXIncyBnaXZlbiBjYWxsYmFja3MgYW5kCiAgICAgKiBvdXIg\naW1wbGljaXQgYmVoYXZpb3IuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IHBy\nb2Nlc3NBcmd1bWVudChpbnQgb3AsIE9iamVjdCBvYmosIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgc20sCiAgICAgICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAg\nICAgIGlmIChjYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBjYWxs\nLnByb2Nlc3NBcmd1bWVudChvcCwgb2JqLCBzbSk7CiAgICAgICAgaWYgKF9j\nYWxsICE9IG51bGwpCiAgICAgICAgICAgIHJldHVybiBfY2FsbC5wcm9jZXNz\nQXJndW1lbnQob3AsIG9iaiwgc20pOwogICAgICAgIHJldHVybiBPcENhbGxi\nYWNrcy5BQ1RfUlVOIHwgT3BDYWxsYmFja3MuQUNUX0NBU0NBREU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlvbiBi\nYXNlZCBvbiB0aGUgZ2l2ZW4gc2V0IG9mIGZsdXNoIGVycm9ycywgb3IKICAg\nICAqIGRvIG5vdGhpbmcgaWYgbm8gZXJyb3JzIG9jY3VycmVkLgogICAgICov\nCiAgICBwcml2YXRlIE9wZW5KUEFFeGNlcHRpb24gbmV3Rmx1c2hFeGNlcHRp\nb24oQ29sbGVjdGlvbjxFeGNlcHRpb24+IGV4Y2VwcykgewogICAgICAgIGlm\nIChleGNlcHMgPT0gbnVsbCB8fCBleGNlcHMuaXNFbXB0eSgpKQogICAgICAg\nICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgVGhyb3dhYmxlW10gdCA9IGV4\nY2Vwcy50b0FycmF5KG5ldyBUaHJvd2FibGVbZXhjZXBzLnNpemUoKV0pOwog\nICAgICAgIExpc3Q8T2JqZWN0PiBmYWlsZWQgPSBuZXcgQXJyYXlMaXN0PE9i\namVjdD4odC5sZW5ndGgpOwoKICAgICAgICAvLyBjcmVhdGUgZmF0YWwgZXhj\nZXB0aW9uIHdpdGggbmVzdGVkIGV4Y2VwdGlvbnMgZm9yIGFsbCB0aGUgZmFp\nbGVkCiAgICAgICAgLy8gb2JqZWN0czsgaWYgYWxsIE9MIGV4Y2VwdGlvbnMs\nIHRocm93IGEgdG9wLWxldmVsIE9MIGV4Y2VwdGlvbgogICAgICAgIGJvb2xl\nYW4gb3B0ID0gdHJ1ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgb3B0ICYm\nIGkgPCB0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG9wdCA9IHRbaV0g\naW5zdGFuY2VvZiBPcHRpbWlzdGljRXhjZXB0aW9uOwogICAgICAgICAgICBp\nZiAob3B0KSB7CiAgICAgICAgICAgICAgICBPYmplY3QgZiA9ICgoT3B0aW1p\nc3RpY0V4Y2VwdGlvbikgdFtpXSkuZ2V0RmFpbGVkT2JqZWN0KCk7CiAgICAg\nICAgICAgICAgICBpZiAoZiAhPSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGZhaWxlZC5hZGQoZik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgaWYgKG9wdCAmJiAhZmFpbGVkLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICBpZihfc3VwcHJlc3NCYXRjaE9MRUxvZ2dpbmcgPT0gdHJ1ZSl7CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IE9wdGltaXN0aWNFeGNlcHRpb24oX2xv\nYy5nZXQoImJyb2tlci1zdXBwcmVzc2luZy1leGNlcHRpb25zIix0Lmxlbmd0\naCkpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbihmYWlsZWQsIHQpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHQpCiAgICAgICAgICAg\nIHJldHVybiBuZXcgT3B0aW1pc3RpY0V4Y2VwdGlvbih0KTsKICAgICAgICBy\nZXR1cm4gbmV3IFN0b3JlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyb2xsZWQtYmFj\nayIpKS4KICAgICAgICAgICAgc2V0TmVzdGVkVGhyb3dhYmxlcyh0KS5zZXRG\nYXRhbCh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuZCB0aGUgY3Vy\ncmVudCB0cmFuc2FjdGlvbiwgbWFraW5nIGFwcHJvcHJpYXRlIHN0YXRlIHRy\nYW5zaXRpb25zLgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBlbmRUcmFu\nc2FjdGlvbihpbnQgc3RhdHVzKSB7CiAgICAgICAgLy8gaWYgYSBkYXRhIHN0\nb3JlIHRyYW5zYWN0aW9uIHdhcyBpbiBwcm9ncmVzcywgZG8gdGhlCiAgICAg\nICAgLy8gYXBwcm9wcmlhdGUgdHJhbnNhY3Rpb24gY2hhbmdlCiAgICAgICAg\nYm9vbGVhbiByb2xsYmFjayA9IHN0YXR1cyAhPSBTdGF0dXMuU1RBVFVTX0NP\nTU1JVFRFRDsKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVs\nbDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2VwcywgZW5kU3RvcmVNYW5hZ2VyVHJhbnNhY3Rpb24ocm9sbGJhY2spKTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHJvbGxiYWNrID0gdHJ1ZTsKICAgICAgICAgICAgZXhjZXBzID0g\nYWRkKGV4Y2VwcywgcmUpOwogICAgICAgIH0KCiAgICAgICAgLy8gZ28gYmFj\nayB0byBkZWZhdWx0IG5vbmUgbG9jayBsZXZlbAogICAgICAgIF9mYy5zZXRS\nZWFkTG9ja0xldmVsKExPQ0tfTk9ORSk7CiAgICAgICAgX2ZjLnNldFdyaXRl\nTG9ja0xldmVsKExPQ0tfTk9ORSk7CiAgICAgICAgX2ZjLnNldExvY2tUaW1l\nb3V0KC0xKTsKCiAgICAgICAgQ29sbGVjdGlvbiB0cmFuc1N0YXRlczsKICAg\nICAgICBpZiAoaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSkKICAgICAgICAg\nICAgdHJhbnNTdGF0ZXMgPSBfdHJhbnNDYWNoZTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIHRyYW5zU3RhdGVzID0gQ29sbGVjdGlvbnMuRU1QVFlfU0VU\nOwoKICAgICAgICAvLyBmaXJlIGFmdGVyIHJvbGxiYWNrL2NvbW1pdCBldmVu\ndAogICAgICAgIENvbGxlY3Rpb24gbW9ianMgPSBudWxsOwogICAgICAgIGlm\nIChfdHJhbnNFdmVudE1hbmFnZXIuaGFzRW5kTGlzdGVuZXJzKCkpIHsKICAg\nICAgICAgICAgbW9ianMgPSBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24o\ndHJhbnNTdGF0ZXMpOwogICAgICAgICAgICBpbnQgZXZlbnRUeXBlID0gKHJv\nbGxiYWNrKSA/IFRyYW5zYWN0aW9uRXZlbnQuQUZURVJfUk9MTEJBQ0sKICAg\nICAgICAgICAgICAgIDogVHJhbnNhY3Rpb25FdmVudC5BRlRFUl9DT01NSVQ7\nCiAgICAgICAgICAgIGZpcmVUcmFuc2FjdGlvbkV2ZW50KG5ldyBUcmFuc2Fj\ndGlvbkV2ZW50KHRoaXMsIGV2ZW50VHlwZSwgbW9ianMsIAogICAgICAgICAg\nICAgICAgX3BlcnNpc3RlZENsc3MsIF91cGRhdGVkQ2xzcywgX2RlbGV0ZWRD\nbHNzKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBudWxsIHRyYW5zYWN0aW9u\nYWwgY2FjaGVzIG5vdyBzbyB0aGF0IGFsbCB0aGUgcmVtb3ZlRnJvbVRyYW5z\nYWN0aW9uCiAgICAgICAgLy8gY2FsbHMgYXMgd2UgdHJhbnNpdGlvbiBlYWNo\nIG9iamVjdCBkb24ndCBoYXZlIHRvIGRvIGFueSB3b3JrOyBkb24ndAogICAg\nICAgIC8vIGNsZWFyIHRyYW5zIGNhY2hlIG9iamVjdCBiZWNhdXNlIHdlIHN0\naWxsIG5lZWQgdGhlIHRyYW5zU3RhdGVzCiAgICAgICAgLy8gcmVmZXJlbmNl\nIHRvIGl0IGJlbG93CiAgICAgICAgX3RyYW5zQ2FjaGUgPSBudWxsOwogICAg\nICAgIGlmIChfcGVyc2lzdGVkQ2xzcyAhPSBudWxsKQogICAgICAgICAgICBf\ncGVyc2lzdGVkQ2xzcyA9IG51bGw7CiAgICAgICAgaWYgKF91cGRhdGVkQ2xz\ncyAhPSBudWxsKQogICAgICAgICAgICBfdXBkYXRlZENsc3MgPSBudWxsOwog\nICAgICAgIGlmIChfZGVsZXRlZENsc3MgIT0gbnVsbCkKICAgICAgICAgICAg\nX2RlbGV0ZWRDbHNzID0gbnVsbDsKCiAgICAgICAgLy8gbmV3IGNhY2hlIHdv\ndWxkIGdldCBjbGVhcmVkIGFueXdheSBkdXJpbmcgdHJhbnNpdGlvbnMsIGJ1\ndCBkb2luZyBzbwogICAgICAgIC8vIGltbWVkaWF0ZWx5IHNhdmVzIHVzIHNv\nbWUgbG9va3VwcwogICAgICAgIF9jYWNoZS5jbGVhck5ldygpOwoKICAgICAg\nICAvLyB0ZWxsIGFsbCBkZXJlZmVkIGluc3RhbmNlcyB0aGV5J3JlIG5vIGxv\nbmdlciBkZXJlZmVkOyB3ZSBjYW4ndAogICAgICAgIC8vIHJlbHkgb24gcm9s\nbGJhY2sgYW5kIGNvbW1pdCBjYWxscyBiZWxvdyBjYXVzZSBzb21lIGluc3Rh\nbmNlcyBtaWdodAogICAgICAgIC8vIG5vdCBiZSB0cmFuc2FjdGlvbmFsCiAg\nICAgICAgaWYgKF9kZXJlZkNhY2hlICE9IG51bGwgJiYgIV9kZXJlZkNhY2hl\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPFN0YXRl\nTWFuYWdlckltcGw+IGl0ciA9IF9kZXJlZkNhY2hlLml0ZXJhdG9yKCk7IGl0\nci5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaXRyLm5leHQoKS5zZXRE\nZXJlZmVyZW5jZWREZXBlbmRlbnQoZmFsc2UsIGZhbHNlKTsKICAgICAgICAg\nICAgX2RlcmVmQ2FjaGUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8g\ncGVyZm9ybSBjb21taXQgb3Igcm9sbGJhY2sgc3RhdGUgdHJhbnNpdGlvbnMg\nb24gZWFjaCBpbnN0YW5jZQogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207\nCiAgICAgICAgZm9yIChJdGVyYXRvciBpdHIgPSB0cmFuc1N0YXRlcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9IChT\ndGF0ZU1hbmFnZXJJbXBsKSBpdHIubmV4dCgpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgaWYgKHJvbGxiYWNrKSB7CiAgICAgICAgICAg\nICAgICAgICAgLy8gdGVsbCBvYmplY3RzIHRoYXQgbWF5IGhhdmUgYmVlbiBk\nZXJlZmVkIHRoZW4gZmx1c2hlZAogICAgICAgICAgICAgICAgICAgIC8vIChh\nbmQgdGhlcmVmb3JlIGRlbGV0ZWQpIHRvIHVuLWRlcmVmCiAgICAgICAgICAg\nICAgICAgICAgc20uc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KGZhbHNlLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgc20ucm9sbGJhY2soKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKHNtLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBORVdERUxFVEVEIHx8IHNt\nLmdldFBDU3RhdGUoKSA9PSBQQ1N0YXRlLlBERUxFVEVEKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChzbS5nZXRQZXJz\naXN0ZW5jZUNhcGFibGUoKSwgbnVsbCwgc20uZ2V0TWV0YURhdGEoKSwgCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMaWZlY3ljbGVFdmVudC5BRlRF\nUl9ERUxFVEVfUEVSRk9STUVEKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgc20uY29tbWl0KCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIHJlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90aWZ5IHRo\nZSBsb2NrIG1hbmFnZXIgdG8gY2xlYW4gdXAgYW5kIHJlbGVhc2UgcmVtYWlu\naW5nIGxvY2tzCiAgICAgICAgX2xtLmVuZFRyYW5zYWN0aW9uKCk7CgogICAg\nICAgIC8vIGNsZWFyIG9sZCBzYXZlcG9pbnRzIGluIHJldmVyc2UKICAgICAg\nICBPcGVuSlBBU2F2ZXBvaW50IHNhdmU7CiAgICAgICAgd2hpbGUgKF9zYXZl\ncG9pbnRzICE9IG51bGwgJiYgX3NhdmVwb2ludHMuc2l6ZSgpID4gMCkgewog\nICAgICAgICAgICBzYXZlID0KICAgICAgICAgICAgICAgIChPcGVuSlBBU2F2\nZXBvaW50KSBfc2F2ZXBvaW50cy5yZW1vdmUoX3NhdmVwb2ludHMuc2l6ZSgp\nIC0gMSk7CiAgICAgICAgICAgIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAg\nICAgfQogICAgICAgIF9zYXZlcG9pbnRzID0gbnVsbDsKICAgICAgICBfc2F2\nZXBvaW50Q2FjaGUgPSBudWxsOwoKICAgICAgICAvLyBmaXJlIGFmdGVyIHN0\nYXRlIGNoYW5nZSBldmVudAogICAgICAgIGlmIChfdHJhbnNFdmVudE1hbmFn\nZXIuaGFzRW5kTGlzdGVuZXJzKCkpCiAgICAgICAgICAgIGZpcmVUcmFuc2Fj\ndGlvbkV2ZW50KG5ldyBUcmFuc2FjdGlvbkV2ZW50KHRoaXMsIFRyYW5zYWN0\naW9uRXZlbnQuCiAgICAgICAgICAgICAgICBBRlRFUl9TVEFURV9UUkFOU0lU\nSU9OUywgbW9ianMsIG51bGwsIG51bGwsIG51bGwpKTsKCiAgICAgICAgLy8g\nbm93IGNsZWFyIHRyYW5zIGNhY2hlOyBrZWVwIGNsZWFyZWQgdmVyc2lvbiBy\nYXRoZXIgdGhhbgogICAgICAgIC8vIG51bGwgdG8gYXZvaWQgaGF2aW5nIHRv\nIHJlLWNyZWF0ZSB0aGUgc2V0IGxhdGVyOyBtb3JlIGVmZmljaWVudAogICAg\nICAgIGlmICh0cmFuc1N0YXRlcyAhPSBDb2xsZWN0aW9ucy5FTVBUWV9TRVQp\nIHsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSAoVHJhbnNhY3Rpb25hbENh\nY2hlKSB0cmFuc1N0YXRlczsKICAgICAgICAgICAgX3RyYW5zQ2FjaGUuY2xl\nYXIoKTsKICAgICAgICB9CgogICAgICAgIHRocm93TmVzdGVkRXhjZXB0aW9u\ncyhleGNlcHMsIHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBPYmplY3QgbGlmZWN5Y2xlCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLwoKICAgIHB1YmxpYyB2b2lkIHBlcnNpc3QoT2JqZWN0IG9iaiwg\nT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIHBlcnNpc3Qob2JqLCBudWxs\nLCB0cnVlLCBjYWxsKTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRl\nTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVjdCBpZCwKICAgICAg\nICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgcmV0dXJuIHBlcnNpc3Qo\nb2JqLCBpZCwgdHJ1ZSwgY2FsbCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncGVyc2lzdEFsbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwp\nIHsKICAgICAgICBwZXJzaXN0QWxsKG9ianMsIHRydWUsIGNhbGwpOwogICAg\nfQoKICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0cy4g\nIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVyc2lz\ndAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQTkVX\nUFJPVklTSU9OQUwpLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0\nQWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBleHBsaWNpdCwgCiAgICAg\nICAgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICBMaXN0PEV4Y2VwdGlvbj4gZXhjZXBzID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRXcml0ZU9w\nZXJhdGlvbigpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIg\nPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHBlcnNpc3QoaXRy\nLm5leHQoKSwgZXhwbGljaXQsIGNhbGwpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAg\nIGV4Y2VwcyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgICAgICB0aHJvd05lc3Rl\nZEV4Y2VwdGlvbnMoZXhjZXBzLCBmYWxzZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBub3QgbnVsbCwgYWRkIGl0\nIHRvIHRoZSBnaXZlbiBsaXN0LAogICAgICogY3JlYXRpbmcgdGhlIGxpc3Qg\naWYgbmVjZXNzYXJ5LgogICAgICovCiAgICBwcml2YXRlIExpc3Q8RXhjZXB0\naW9uPiBhZGQoTGlzdDxFeGNlcHRpb24+IGwsIEV4Y2VwdGlvbiBvKSB7CiAg\nICAgICAgaWYgKG8gPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGw7CiAg\nICAgICAgaWYgKGwgPT0gbnVsbCkKICAgICAgICAgICAgbCA9IG5ldyBMaW5r\nZWRMaXN0PEV4Y2VwdGlvbj4oKTsKICAgICAgICBsLmFkZChvKTsKICAgICAg\nICByZXR1cm4gbDsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4\nY2VwdGlvbiB3cmFwcGluZyB0aGUgZ2l2ZW4gbmVzdGVkIGV4Y2VwdGlvbnMu\nCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB0aHJvd05lc3RlZEV4Y2VwdGlv\nbnMoTGlzdDxFeGNlcHRpb24+IGV4Y2VwcywgYm9vbGVhbiBkYXRhc3RvcmUp\nIHsKICAgICAgICBpZiAoZXhjZXBzID09IG51bGwgfHwgZXhjZXBzLmlzRW1w\ndHkoKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmIChkYXRhc3Rv\ncmUgJiYgZXhjZXBzLnNpemUoKSA9PSAxKQogICAgICAgICAgICB0aHJvdyAo\nUnVudGltZUV4Y2VwdGlvbikgZXhjZXBzLmdldCgwKTsKCiAgICAgICAgYm9v\nbGVhbiBmYXRhbCA9IGZhbHNlOwogICAgICAgIFRocm93YWJsZVtdIHQgPSBl\neGNlcHMudG9BcnJheShuZXcgVGhyb3dhYmxlW2V4Y2Vwcy5zaXplKCldKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKHRbaV0gaW5zdGFuY2VvZiBPcGVuSlBBRXhjZXB0\naW9uCiAgICAgICAgICAgICAgICAmJiAoKE9wZW5KUEFFeGNlcHRpb24pIHRb\naV0pLmlzRmF0YWwoKSkKICAgICAgICAgICAgICAgIGZhdGFsID0gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgT3BlbkpQQUV4Y2VwdGlvbiBlcnI7CiAgICAg\nICAgaWYgKGRhdGFzdG9yZSkKICAgICAgICAgICAgZXJyID0gbmV3IFN0b3Jl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJuZXN0ZWQtZXhjZXBzIikpOwogICAgICAg\nIGVsc2UKICAgICAgICAgICAgZXJyID0gbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoIm5lc3RlZC1leGNlcHMiKSk7CiAgICAgICAgdGhyb3cgZXJyLnNl\ndE5lc3RlZFRocm93YWJsZXModCkuc2V0RmF0YWwoZmF0YWwpOwogICAgfQoK\nICAgIC8qKgogICAgICogUGVyc2lzdCB0aGUgZ2l2ZW4gb2JqZWN0LiAgSW5k\naWNhdGUgd2hldGhlciB0aGlzIHdhcyBhbiBleHBsaWNpdCBwZXJzaXN0CiAg\nICAgKiAoUE5FVykgb3IgYSBwcm92aXNvbmFsIHBlcnNpc3QgKFBORVdQUk9W\nSVNJT05BTCkKICAgICAqLwogICAgcHVibGljIHZvaWQgcGVyc2lzdChPYmpl\nY3Qgb2JqLCBib29sZWFuIGV4cGxpY2l0LCBPcENhbGxiYWNrcyBjYWxsKSB7\nCiAgICAgICAgcGVyc2lzdChvYmosIG51bGwsIGV4cGxpY2l0LCBjYWxsKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFBlcnNpc3QgdGhlIGdpdmVuIG9iamVj\ndC4gIEluZGljYXRlIHdoZXRoZXIgdGhpcyB3YXMgYW4gZXhwbGljaXQgcGVy\nc2lzdAogICAgICogKFBORVcpIG9yIGEgcHJvdmlzb25hbCBwZXJzaXN0IChQ\nTkVXUFJPVklTSU9OQUwpLgogICAgICogU2VlIHtAbGluayBCcm9rZXJ9IGZv\nciBkZXRhaWxzIG9uIHRoaXMgbWV0aG9kLgogICAgICovCiAgICBwdWJsaWMg\nT3BlbkpQQVN0YXRlTWFuYWdlciBwZXJzaXN0KE9iamVjdCBvYmosIE9iamVj\ndCBpZCwgYm9vbGVhbiBleHBsaWNpdCwKICAgICAgICBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRpb24o\nKTsKCiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0\nZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICghX29w\nZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgICAgIHJldHVybiBzbTsK\nCiAgICAgICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAg\nICAgIGlmIChhY3Rpb24gPT0gT3BDYWxsYmFja3MuQUNUX05PTkUpCiAgICAg\nICAgICAgICAgICByZXR1cm4gc207CgogICAgICAgICAgICAvLyBBQ1RfQ0FT\nQ0FERQogICAgICAgICAgICBpZiAoKGFjdGlvbiAmIE9wQ2FsbGJhY2tzLkFD\nVF9SVU4pID09IDApIHsKICAgICAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nKQogICAgICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwp\nOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNh\nc2NhZGVUcmFuc2llbnQoT3BDYWxsYmFja3MuT1BfUEVSU0lTVCwgb2JqLCBj\nYWxsLAogICAgICAgICAgICAgICAgICAgICAgICAicGVyc2lzdCIpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHNtOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBBQ1RfUlVOCiAgICAgICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJs\nZSBwYzsKICAgICAgICAgICAgaWYgKHNtICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlvbihfbG9jLmdldAog\nICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNpc3QtZGV0YWNoZWQiLCBF\neGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAgICAgICAgICAgICAg\nICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CgogICAgICAgICAgICAgICAg\naWYgKCFzbS5pc0VtYmVkZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBz\nbS5wZXJzaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgX2NhY2hlLnBlcnNp\nc3Qoc20pOwogICAgICAgICAgICAgICAgICAgIGlmICgoYWN0aW9uICYgT3BD\nYWxsYmFja3MuQUNUX0NBU0NBREUpICE9IDApCiAgICAgICAgICAgICAgICAg\nICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBzbTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyBhbiBlbWJlZGRlZCBmaWVsZDsgbm90aWZ5IHRoZSBvd25l\nciB0aGF0IHRoZSB2YWx1ZSBoYXMKICAgICAgICAgICAgICAgIC8vIGNoYW5n\nZWQgYnkgYmVjb21pbmcgaW5kZXBlbmRlbnRseSBwZXJzaXN0ZW50CiAgICAg\nICAgICAgICAgICBzbS5nZXRPd25lcigpLmRpcnR5KHNtLmdldE93bmVySW5k\nZXgoKSk7CiAgICAgICAgICAgICAgICBfY2FjaGUucGVyc2lzdChzbSk7CiAg\nICAgICAgICAgICAgICBwYyA9IHNtLmdldFBlcnNpc3RlbmNlQ2FwYWJsZSgp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGMgPSBh\nc3NlcnRQZXJzaXN0ZW5jZUNhcGFibGUob2JqKTsKICAgICAgICAgICAgICAg\nIGlmIChwYy5wY0lzRGV0YWNoZWQoKSA9PSBCb29sZWFuLlRSVUUpCiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE9iamVjdEV4aXN0c0V4Y2VwdGlv\nbihfbG9jLmdldAogICAgICAgICAgICAgICAgICAgICAgICAoInBlcnNpc3Qt\nZGV0YWNoZWQiLCBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaikpKS4KICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KG9iaik7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9j\nb25mLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAg\nICAgICAgICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwg\ndHJ1ZSk7CiAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChvYmosIG51\nbGwsIG1ldGEsIExpZmVjeWNsZUV2ZW50LkJFRk9SRV9QRVJTSVNUKTsKCiAg\nICAgICAgICAgIC8vIGNyZWF0ZSBpZCBmb3IgaW5zdGFuY2UKICAgICAgICAg\nICAgaWYgKGlkID09IG51bGwpIHsKICAgICAgICAgICAgCWludCBpZFR5cGUg\nPSBtZXRhLmdldElkZW50aXR5VHlwZSgpOwogICAgICAgICAgICAgICAgaWYg\nKGlkVHlwZSA9PSBDbGFzc01ldGFEYXRhLklEX0FQUExJQ0FUSU9OKQogICAg\nICAgICAgICAgICAgICAgIGlkID0gQXBwbGljYXRpb25JZHMuY3JlYXRlKHBj\nLCBtZXRhKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlkVHlwZSA9PSBD\nbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm1ldGEtdW5rbm93\nbmlkIiwgbWV0YSkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAg\nICAgICAgICAgIGlkID0gU3RhdGVNYW5hZ2VySWQubmV3SW5zdGFuY2UodGhp\ncyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3\nZSBkb24ndCBhbHJlYWR5IGhhdmUgdGhlIGluc3RhbmNlIGNhY2hlZAogICAg\nICAgICAgICBjaGVja0ZvckR1cGxpY2F0ZUlkKGlkLCBvYmopOwoKICAgICAg\nICAgICAgLy8gaWYgaGFkIGVtYmVkZGVkIHNtLCBudWxsIGl0CiAgICAgICAg\nICAgIGlmIChzbSAhPSBudWxsKQogICAgICAgICAgICAgICAgcGMucGNSZXBs\nYWNlU3RhdGVNYW5hZ2VyKG51bGwpOwoKICAgICAgICAgICAgLy8gY3JlYXRl\nIG5ldyBzbQogICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX0FDVElWRSkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGV4cGxp\nY2l0KQogICAgICAgICAgICAgICAgICAgIHNtLmluaXRpYWxpemUocGMsIFBD\nU3RhdGUuUE5FVyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAg\nICAgICAgICAgc20uaW5pdGlhbGl6ZShwYywgUENTdGF0ZS5QTkVXUFJPVklT\nSU9OQUwpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHNt\nLmluaXRpYWxpemUocGMsIFBDU3RhdGUuUE5PTlRSQU5TTkVXKTsKICAgICAg\nICAgICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkg\nIT0gMCkKICAgICAgICAgICAgICAgIHNtLmNhc2NhZGVQZXJzaXN0KGNhbGwp\nOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZW1wb3JhcmlseSBtYW5hZ2Ug\ndGhlIGdpdmVuIGluc3RhbmNlIGluIG9yZGVyIHRvIGNhc2NhZGUgdGhlIGdp\ndmVuCiAgICAgKiBvcGVyYXRpb24gdGhyb3VnaCBpdC4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGNhc2NhZGVUcmFuc2llbnQoaW50IG9wLCBPYmplY3Qg\nb2JqLCBPcENhbGxiYWNrcyBjYWxsLAogICAgICAgIFN0cmluZyBlcnJPcCkg\newogICAgICAgIFBlcnNpc3RlbmNlQ2FwYWJsZSBwYyA9IGFzc2VydFBlcnNp\nc3RlbmNlQ2FwYWJsZShvYmopOwoKICAgICAgICAvLyBpZiB1c2luZyBkZXRh\nY2hlZCBzdGF0ZSBtYW5hZ2VyLCBkb24ndCByZXBsYWNlCiAgICAgICAgaWYg\nKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgIT0gbnVsbCkKICAgICAgICAgICAg\ndGhyb3cgbmV3RGV0YWNoZWRFeGNlcHRpb24ob2JqLCBlcnJPcCk7CgogICAg\nICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgIGdldE1ldGFEYXRhKG9i\nai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICBTdGF0ZU1h\nbmFnZXJJbXBsIHNtID0gbmV3IFN0YXRlTWFuYWdlckltcGwoU3RhdGVNYW5h\nZ2VySWQuCiAgICAgICAgICAgIG5ld0luc3RhbmNlKHRoaXMpLCBtZXRhLCB0\naGlzKTsKICAgICAgICBzbS5pbml0aWFsaXplKHBjLCBQQ1N0YXRlLlRMT0FE\nRUQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN3aXRjaCAob3ApIHsK\nICAgICAgICAgICAgICAgIGNhc2UgT3BDYWxsYmFja3MuT1BfUEVSU0lTVDoK\nICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlUGVyc2lzdChjYWxsKTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNh\nc2UgT3BDYWxsYmFja3MuT1BfREVMRVRFOgogICAgICAgICAgICAgICAgICAg\nIHNtLmNhc2NhZGVEZWxldGUoY2FsbCk7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIE9wQ2FsbGJhY2tzLk9QX1JF\nRlJFU0g6CiAgICAgICAgICAgICAgICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJl\nZnJlc2goY2FsbCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbnRlcm5hbEV4Y2VwdGlvbihTdHJpbmcudmFsdWVPZihvcCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAg\nICAgICAgICBzbS5yZWxlYXNlKHRydWUpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBkZWxldGVBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3JpdGVPcGVyYXRp\nb24oKTsKCiAgICAgICAgICAgIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMgPSBu\ndWxsOwogICAgICAgICAgICBPYmplY3Qgb2JqOwogICAgICAgICAgICBmb3Ig\nKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAob2JqICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0\nZShvYmosIGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKSwgY2FsbCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7\nCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRocm93TmVzdGVkRXhjZXB0aW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsZXRlKE9iamVjdCBv\nYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0V3Jp\ndGVPcGVyYXRpb24oKTsKICAgICAgICAgICAgZGVsZXRlKG9iaiwgZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpLCBjYWxsKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGRl\nbGV0ZS4KICAgICAqLwogICAgdm9pZCBkZWxldGUoT2JqZWN0IG9iaiwgU3Rh\ndGVNYW5hZ2VySW1wbCBzbSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmICghX29wZXJhdGluZy5hZGQob2JqKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBpbnQgYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX0RFTEVURSwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgaWYg\nKGFjdGlvbiA9PSBPcENhbGxiYWNrcy5BQ1RfTk9ORSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICAvLyBBQ1RfQ0FTQ0FERQogICAgICAgIGlmICgo\nYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkgewogICAgICAg\nICAgICBpZiAoc20gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCFz\nbS5pc0VtYmVkZGVkKCkgfHwgIXNtLmdldERlcmVmZXJlbmNlZEVtYmVkRGVw\nZW5kZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVs\nZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNhc2NhZGVUcmFuc2ll\nbnQoT3BDYWxsYmFja3MuT1BfREVMRVRFLCBvYmosIGNhbGwsICJkZWxldGUi\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\nQUNUX1JVTgogICAgICAgIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGlmIChzbS5pc0RldGFjaGVkKCkpCiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxldGUiKTsKICAgICAgICAg\nICAgaWYgKChhY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgIT0g\nMCkgewogICAgICAgICAgICAgICAgaWYgKCFzbS5pc0VtYmVkZGVkKCkgfHwg\nIXNtLmdldERlcmVmZXJlbmNlZEVtYmVkRGVwZW5kZW50KCkpIHsKICAgICAg\nICAgICAgICAgICAgICBzbS5jYXNjYWRlRGVsZXRlKGNhbGwpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNtLmRlbGV0\nZSgpOwogICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBh\nYmxlKG9iaikucGNJc0RldGFjaGVkKCkgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlvbihvYmosICJkZWxl\ndGUiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRocm93IGFuIGV4Y2VwdGlv\nbiBpbmRpY2F0aW5nIHRoYXQgdGhlIGN1cnJlbnQgYWN0aW9uIGNhbid0IGJl\nCiAgICAgKiBwZXJmb3JtZWQgb24gYSBkZXRhY2hlZCBvYmplY3QuCiAgICAg\nKi8KICAgIHByaXZhdGUgT3BlbkpQQUV4Y2VwdGlvbiBuZXdEZXRhY2hlZEV4\nY2VwdGlvbihPYmplY3Qgb2JqLAogICAgICAgIFN0cmluZyBvcGVyYXRpb24p\nIHsKICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgi\nYmFkLWRldGFjaGVkLW9wIiwgb3BlcmF0aW9uLAogICAgICAgICAgICBFeGNl\ncHRpb25zLnRvU3RyaW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWxlYXNlQWxsKENvbGxlY3Rpb24g\nb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0\naW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBMaXN0PEV4\nY2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAgICAgICAgICAgZm9yIChJdGVy\nYXRvcjw/PiBpdHIgPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7\nKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJlbGVhc2UoaXRyLm5leHQoKSwgY2FsbCk7CiAgICAgICAgICAgICAgICB9\nIGNhdGNoIChVc2VyRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAg\nICAgZXhjZXBzID0gYWRkKGV4Y2VwcywgdWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93TmVzdGVkRXhjZXB0\naW9ucyhleGNlcHMsIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcmVsZWFzZShPYmplY3Qgb2JqLCBPcENhbGxiYWNrcyBj\nYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0\nU3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpbnQg\nYWN0aW9uID0gcHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFTEVB\nU0UsIG9iaiwgc20sIGNhbGwpOwoKICAgICAgICAgICAgaWYgKHNtID09IG51\nbGwpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmICgo\nYWN0aW9uICYgT3BDYWxsYmFja3MuQUNUX1JVTikgIT0gMCAmJiBzbS5pc1Bl\ncnNpc3RlbnQoKSkgewogICAgICAgICAgICAgICAgYm9vbGVhbiBwZW5kaW5n\nID0gc20uaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpOwogICAgICAgICAgICAg\nICAgc20ucmVsZWFzZSh0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChwZW5k\naW5nKQogICAgICAgICAgICAgICAgICAgIHJlbW92ZUZyb21QZW5kaW5nVHJh\nbnNhY3Rpb24oc20pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlv\nbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0YXRl\nTWFuYWdlciBlbWJlZChPYmplY3Qgb2JqLCBPYmplY3QgaWQsCiAgICAgICAg\nT3BlbkpQQVN0YXRlTWFuYWdlciBvd25lciwgVmFsdWVNZXRhRGF0YSBvd25l\nck1ldGEpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIG9yaWcgPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlm\nIChvcmlnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGFscmVh\nZHkgZW1iZWRkZWQsIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgICAgIGlm\nIChvcmlnLmdldE93bmVyKCkgPT0gb3duZXIgJiYgb3JpZy5nZXRNZXRhRGF0\nYSgpLgogICAgICAgICAgICAgICAgICAgIGdldEVtYmVkZGluZ01ldGFEYXRh\nKCkgPT0gb3duZXJNZXRhKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBv\ncmlnOwoKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBtYWtlIHN1cmUg\ncGMgaXMgZnVsbHkgbG9hZGVkIGZvciB3aGVuIHdlIGNvcHkgaXRzCiAgICAg\nICAgICAgICAgICAvLyBkYXRhIGJlbG93CiAgICAgICAgICAgICAgICBvcmln\nLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURfQUxMLCBudWxsLCBu\ndWxsLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNy\nZWF0ZSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGVtYmVkZGVkIG1ldGFkYXRh\nCiAgICAgICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IG93bmVyTWV0YS5n\nZXRFbWJlZGRlZE1ldGFEYXRhKCk7CiAgICAgICAgICAgIGlmIChtZXRhID09\nIG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNl\ncHRpb24oX2xvYy5nZXQoImJhZC1lbWJlZCIsIG93bmVyTWV0YSkpOwoKICAg\nICAgICAgICAgaWYgKGlkID09IG51bGwpCiAgICAgICAgICAgICAgICBpZCA9\nIFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRoaXMpOwoKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG5ldyBTdGF0ZU1hbmFnZXJJbXBs\nKGlkLCBtZXRhLCB0aGlzKTsKICAgICAgICAgICAgc20uc2V0T3duZXIoKFN0\nYXRlTWFuYWdlckltcGwpIG93bmVyLCBvd25lck1ldGEpOwoKICAgICAgICAg\nICAgUGVyc2lzdGVuY2VDYXBhYmxlIGNvcHk7CiAgICAgICAgICAgIFBDU3Rh\ndGUgc3RhdGU7CiAgICAgICAgICAgIENsYXNzPD8+IHR5cGUgPSBtZXRhLmdl\ndERlc2NyaWJlZFR5cGUoKTsKICAgICAgICAgICAgaWYgKG9iaiAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBnaXZlIGNvcHkgYW5kIHRoZSBvcmln\naW5hbCBpbnN0YW5jZSB0aGUgc2FtZSBzdGF0ZSBtYW5hZ2VyCiAgICAgICAg\nICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiBjb3B5IGZpZWxkcyBmcm9tIG9u\nZSB0byB0aGUgb3RoZXIKICAgICAgICAgICAgICAgIFN0YXRlTWFuYWdlcklt\ncGwgY29weVNNOwogICAgICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxl\nIHBjOwogICAgICAgICAgICAgICAgaWYgKG9yaWcgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIGNvcHlTTSA9IHNtOwogICAgICAgICAgICAgICAg\nICAgIHBjID0gYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaik7CiAgICAg\nICAgICAgICAgICAgICAgcGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHNtKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nY29weVNNID0gb3JpZzsKICAgICAgICAgICAgICAgICAgICBwYyA9IG9yaWcu\nZ2V0UGVyc2lzdGVuY2VDYXBhYmxlKCk7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBj\nb3B5IHRoZSBpbnN0YW5jZS4gIHdlIGRvIHRoaXMgZXZlbiBpZiBpdCBkb2Vz\nbid0IGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIGEgc3Rh\ndGUgbWFuYWdlciBpbiBjYXNlIGl0IGlzIGxhdGVyIGFzc2lnbmVkIHRvIGEK\nICAgICAgICAgICAgICAgICAgICAvLyBQQyBmaWVsZDsgYXQgdGhhdCBwb2lu\ndCBpdCdzIHRvbyBsYXRlIHRvIGNvcHkKICAgICAgICAgICAgICAgICAgICBj\nb3B5ID0gUENSZWdpc3RyeS5uZXdJbnN0YW5jZSh0eXBlLCBjb3B5U00sIGZh\nbHNlKTsKICAgICAgICAgICAgICAgICAgICBpbnRbXSBmaWVsZHMgPSBuZXcg\naW50W21ldGEuZ2V0RmllbGRzKCkubGVuZ3RoXTsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZpZWxkcy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzW2ldID0gaTsKICAgICAg\nICAgICAgICAgICAgICBjb3B5LnBjQ29weUZpZWxkcyhwYywgZmllbGRzKTsK\nICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IFBDU3RhdGUuRUNPUFk7CiAg\nICAgICAgICAgICAgICAgICAgY29weS5wY1JlcGxhY2VTdGF0ZU1hbmFnZXIo\nbnVsbCk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgICAgIC8vIGlmIHRoZSBpbnN0YW5jZSBkaWRuJ3QgaGF2ZSBhIHN0\nYXRlIG1hbmFnZXIgdG8gc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgLy8g\ncmV2ZXJ0IGl0IHRvIGJlaW5nIHRyYW5zaWVudAogICAgICAgICAgICAgICAg\nICAgIGlmIChvcmlnID09IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIHBjLnBjUmVwbGFjZVN0YXRlTWFuYWdlcihudWxsKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNv\ncHkgPSBQQ1JlZ2lzdHJ5Lm5ld0luc3RhbmNlKHR5cGUsIHNtLCBmYWxzZSk7\nCiAgICAgICAgICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfQUNUSVZFKSAh\nPSAwICYmICFfb3B0aW1pc3RpYykKICAgICAgICAgICAgICAgICAgICBzdGF0\nZSA9IFBDU3RhdGUuRUNMRUFOOwogICAgICAgICAgICAgICAgZWxzZQogICAg\nICAgICAgICAgICAgICAgIHN0YXRlID0gUENTdGF0ZS5FTk9OVFJBTlM7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHNtLmluaXRpYWxpemUoY29weSwg\nc3RhdGUpOwogICAgICAgICAgICByZXR1cm4gc207CiAgICAgICAgfSBjYXRj\naCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBr\nZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBub3QgYWxyZWFk\neSBjYWNoZWQsIGNyZWF0ZSBhbiBlbXB0eSBjb3B5IG9mIHRoZSBnaXZlbiBz\ndGF0ZQogICAgICogbWFuYWdlciBpbiB0aGUgZ2l2ZW4gc3RhdGUuCiAgICAg\nKi8KICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgY29weShPcGVuSlBBU3RhdGVN\nYW5hZ2VyIGNvcHksIFBDU3RhdGUgc3RhdGUpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3Nl\ncnRPcGVuKCk7CiAgICAgICAgICAgIE9iamVjdCBvaWQgPSBjb3B5LmZldGNo\nT2JqZWN0SWQoKTsKICAgICAgICAgICAgQ2xhc3M8Pz4gdHlwZSA9IGNvcHku\nZ2V0TWFuYWdlZEluc3RhbmNlKCkuZ2V0Q2xhc3MoKTsKICAgICAgICAgICAg\naWYgKG9pZCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIC8vIGNhY2hlZCBpbnN0\nYW5jZT8KICAgICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IG51bGw7\nCiAgICAgICAgICAgIGlmICghY29weS5pc0VtYmVkZGVkKCkpCiAgICAgICAg\nICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKG9pZCwgdHJ1\nZSk7CiAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBNZXRhRGF0YVJlcG9zaXRvcnkgcmVwb3MgPSBfY29uZi4KICAgICAg\nICAgICAgICAgICAgICBnZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgp\nOwogICAgICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVwb3Mu\nZ2V0TWV0YURhdGEodHlwZSwgX2xvYWRlciwgdHJ1ZSk7CiAgICAgICAgICAg\nICAgICAvLyBjb25zdHJ1Y3QgYSBuZXcgc3RhdGUgbWFuYWdlciB3aXRoIGFs\nbCBpbmZvIGtub3duCiAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1h\nbmFnZXJJbXBsKG9pZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICBz\nbS5zZXRPYmplY3RJZChvaWQpOwogICAgICAgICAgICAgICAgc20uaW5pdGlh\nbGl6ZShzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSwgc3Rh\ndGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzbTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsK\nICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHJlZnJlc2hB\nbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9ianMgPT0gbnVsbCB8fCBvYmpzLmlzRW1wdHkoKSkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnROb250cmFuc2FjdGlv\nbmFsUmVhZCgpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjw/PiBpdHIg\nPSBvYmpzLml0ZXJhdG9yKCk7IGl0ci5oYXNOZXh0KCk7KSAKICAgICAgICAg\nICAgICAgIGdhdGhlckNhc2NhZGVSZWZyZXNoKGl0ci5uZXh0KCksIGNhbGwp\nOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5pc0VtcHR5KCkpCiAgICAg\nICAgICAgIAlyZXR1cm47CiAgICAgICAgICAgIGlmIChfb3BlcmF0aW5nLnNp\nemUoKSA9PSAxKQogICAgICAgICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVy\nYXRpbmcuaXRlcmF0b3IoKS5uZXh0KCksIGNhbGwpOwogICAgICAgICAgICBl\nbHNlCiAgICAgICAgICAgIAlyZWZyZXNoSW50ZXJuYWwoX29wZXJhdGluZywg\nY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3Bl\ncmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJl\nZnJlc2goT2JqZWN0IG9iaiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAg\nIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAg\nICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBhc3NlcnROb250cmFuc2FjdGlvbmFsUmVhZCgpOwoKICAgICAgICAg\nICAgZ2F0aGVyQ2FzY2FkZVJlZnJlc2gob2JqLCBjYWxsKTsKICAgICAgICAg\nICAgaWYgKF9vcGVyYXRpbmcuaXNFbXB0eSgpKQogICAgICAgICAgICAJcmV0\ndXJuOwogICAgICAgICAgICBpZiAoX29wZXJhdGluZy5zaXplKCkgPT0gMSkK\nICAgICAgICAgICAgCXJlZnJlc2hJbnRlcm5hbChfb3BlcmF0aW5nLml0ZXJh\ndG9yKCkubmV4dCgpLCBjYWxsKTsKICAgICAgICAgICAgZWxzZQogICAgICAg\nICAgICAJcmVmcmVzaEludGVybmFsKF9vcGVyYXRpbmcsIGNhbGwpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlcnMgYWxsIG9i\namVjdHMgcmVhY2hhYmxlIHRocm91Z2ggY2FzY2FkZS1yZWZyZXNoIHJlbGF0\naW9ucwogICAgICogaW50byB0aGUgb3BlcmF0aW5nIHNldC4KICAgICAqLwog\nICAgdm9pZCBnYXRoZXJDYXNjYWRlUmVmcmVzaChPYmplY3Qgb2JqLCBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKCFfb3BlcmF0aW5nLmFkZChv\nYmopKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIFN0YXRlTWFuYWdl\nckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgZmFsc2UpOwog\nICAgICAgIGludCBhY3Rpb24gPSBwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFj\na3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCk7CiAgICAgICAgaWYgKChh\nY3Rpb24gJiBPcENhbGxiYWNrcy5BQ1RfQ0FTQ0FERSkgPT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoc20gIT0gbnVsbCkKICAgICAg\nICAgICAgc20uZ2F0aGVyQ2FzY2FkZVJlZnJlc2goY2FsbCk7CiAgICAgICAg\nZWxzZQogICAgICAgICAgICBjYXNjYWRlVHJhbnNpZW50KE9wQ2FsbGJhY2tz\nLk9QX1JFRlJFU0gsIG9iaiwgY2FsbCwgInJlZnJlc2giKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aXRoIHRoZSBm\ndWxsIHNldCBvZiBvYmplY3RzIHJlYWNoYWJsZSB2aWEKICAgICAqIGNhc2Nh\nZGUtcmVmcmVzaCByZWxhdGlvbnMgZnJvbSB0aGUgdXNlci1naXZlbiBpbnN0\nYW5jZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRl\ncm5hbChDb2xsZWN0aW9uIG9ianMsIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAg\nIAlpZiAob2JqcyA9PSBudWxsIHx8IG9ianMuaXNFbXB0eSgpKQogICAgCQly\nZXR1cm47CiAgICAgICAgTGlzdDxFeGNlcHRpb24+IGV4Y2VwcyA9IG51bGw7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBpbnN0YW5j\nZXMgdGhhdCBuZWVkIGEgcmVmcmVzaAogICAgICAgICAgICBDb2xsZWN0aW9u\nPE9wZW5KUEFTdGF0ZU1hbmFnZXI+IGxvYWQgPSBudWxsOwogICAgICAgICAg\nICBTdGF0ZU1hbmFnZXJJbXBsIHNtOwogICAgICAgICAgICBPYmplY3Qgb2Jq\nOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMuaXRl\ncmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgIG9i\naiA9IGl0ci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAob2JqID09IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRl\nTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoKHByb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRUZSRVNILCBv\nYmosIHNtLCBjYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9wQ2Fs\nbGJhY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hl\nZCgpKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0Rl\ndGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZWxzZSBpZiAoc20uYmVmb3JlUmVmcmVzaCh0cnVlKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAJaWYgKGxvYWQgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgICAgICAgICAgCQlsb2FkID0gbmV3IEFycmF5TGlz\ndDxPcGVuSlBBU3RhdGVNYW5hZ2VyPihvYmpzLnNpemUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2FkLmFkZChzbSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaW50IGxl\ndmVsID0gX2ZjLmdldFJlYWRMb2NrTGV2ZWwoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaW50IHRpbWVvdXQgPSBfZmMuZ2V0TG9ja1RpbWVvdXQoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCB0\naW1lb3V0LCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNtLnJlYWRMb2NrZWQobGV2ZWwsIGxldmVsKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmop\nLnBjSXNEZXRhY2hlZCgpCiAgICAgICAgICAgICAgICAgICAgICAgID09IEJv\nb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nRGV0YWNoZWRFeGNlcHRpb24ob2JqLCAicmVmcmVzaCIpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICAgICAgICAgIGV4Y2VwcyA9IGFkZChleGNlcHMsIGtlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmVm\ncmVzaCBhbGwKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgQ29sbGVjdGlvbjxPYmplY3Q+IGZhaWxlZCA9IF9zdG9y\nZS5sb2FkQWxsKGxvYWQsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgU3Rv\ncmVNYW5hZ2VyLkZPUkNFX0xPQURfUkVGUkVTSCwgX2ZjLCBudWxsKTsKICAg\nICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLCBuZXdPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihmYWlsZWQpKTsKCiAg\nICAgICAgICAgICAgICAvLyBwZXJmb3JtIHBvc3QtcmVmcmVzaCB0cmFuc2l0\naW9ucyBhbmQgbWFrZSBzdXJlIGFsbCBmZXRjaAogICAgICAgICAgICAgICAg\nLy8gZ3JvdXAgZmllbGRzIGFyZSBsb2FkZWQKICAgICAgICAgICAgICAgIGZv\nciAoSXRlcmF0b3I8T3BlbkpQQVN0YXRlTWFuYWdlcj4gaXRyID0gbG9hZC5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxlZC5j\nb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNtLmFmdGVyUmVmcmVzaCgpOwogICAgICAgICAg\nICAgICAgICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5M\nT0FEX0ZHUywgbnVsbCwgbnVsbCwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoT3Bl\nbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgICAgICBl\neGNlcHMgPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBub3cgaW52b2tlIHBvc3RSZWZyZXNoIG9uIGFsbCB0aGUgaW5zdGFu\nY2VzCiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jqcy5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdl\nckltcGwoaXRyLm5leHQoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHNtICE9IG51bGwgJiYgIXNtLmlzRGV0YWNoZWQoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KHNtLmdldE1hbmFn\nZWRJbnN0YW5jZSgpLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfUkVG\nUkVTSCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRkKGV4\nY2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0\naW9uKHJlKTsKICAgICAgICB9CiAgICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRp\nb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogT3B0\naW1pemF0aW9uIGZvciBzaW5nbGUtb2JqZWN0IHJlZnJlc2guCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHJlZnJlc2hJbnRlcm5hbChPYmplY3Qgb2Jq\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwo\nb2JqLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQo\nT3BDYWxsYmFja3MuT1BfUkVGUkVTSCwgb2JqLCBzbSwgY2FsbCkKICAgICAg\nICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIGlmIChzbSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQogICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0aW9uKG9i\naiwgInJlZnJlc2giKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNtLmJl\nZm9yZVJlZnJlc2goZmFsc2UpKSB7CiAgICAgICAgICAgICAgICAgICAgc20u\nbG9hZChfZmMsIFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MsIG51bGwsIG51\nbGwsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzbS5hZnRlclJlZnJl\nc2goKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGludCBs\nZXZlbCA9IF9mYy5nZXRSZWFkTG9ja0xldmVsKCk7CiAgICAgICAgICAgICAg\nICBpbnQgdGltZW91dCA9IF9mYy5nZXRMb2NrVGltZW91dCgpOwogICAgICAg\nICAgICAgICAgX2xtLmxvY2soc20sIGxldmVsLCB0aW1lb3V0LCBudWxsLCBm\nYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5yZWFkTG9ja2VkKGxldmVsLCBs\nZXZlbCk7CiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIG51bGwsCiAgICAgICAgICAgICAgICAg\nICAgc20uZ2V0TWV0YURhdGEoKSwgTGlmZWN5Y2xlRXZlbnQuQUZURVJfUkVG\nUkVTSCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVu\nY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAg\nID09IEJvb2xlYW4uVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0Rl\ndGFjaGVkRXhjZXB0aW9uKG9iaiwgInJlZnJlc2giKTsKICAgICAgICB9IGNh\ndGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93\nIGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwog\nICAgICAgIH0KICAgIH0KICAgIAogICAgCiAgICBwdWJsaWMgdm9pZCByZXRy\naWV2ZUFsbChDb2xsZWN0aW9uIG9ianMsIGJvb2xlYW4gZGZnT25seSwKICAg\nICAgICBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMgPT0g\nbnVsbCB8fCBvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAgICAgICAgIHJl\ndHJpZXZlKG9ianMuaXRlcmF0b3IoKS5uZXh0KCksIGRmZ09ubHksIGNhbGwp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBMaXN0\nPEV4Y2VwdGlvbj4gZXhjZXBzID0gbnVsbDsKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFk\nKCk7CgogICAgICAgICAgICAvLyBjb2xsZWN0IGFsbCBob2xsb3cgaW5zdGFu\nY2VzIGZvciBsb2FkCiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAg\nICAgIENvbGxlY3Rpb248T3BlbkpQQVN0YXRlTWFuYWdlcj4gbG9hZCA9IG51\nbGw7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAg\nICAgIENvbGxlY3Rpb248U3RhdGVNYW5hZ2VySW1wbD4gc21zID0gbmV3IEFy\ncmF5TGlzdDxTdGF0ZU1hbmFnZXJJbXBsPihvYmpzLnNpemUoKSk7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jqcy5pdGVyYXRvcigp\nOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgb2JqID0gaXRy\nLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nSW1wbChvYmosIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmICgocHJv\nY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1JFVFJJRVZFLCBvYmosIHNt\nLCBjYWxsKQogICAgICAgICAgICAgICAgICAgICAgICAmIE9wQ2FsbGJhY2tz\nLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc20gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoc20uaXNEZXRhY2hlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3RGV0YWNoZWRF\neGNlcHRpb24ob2JqLCAicmV0cmlldmUiKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBzbXMuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xM\nT1cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9h\nZCA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2FkID0gbmV3IEFycmF5TGlzdDxPcGVuSlBBU3RhdGVNYW5hZ2VyPigp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWQuYWRkKHNt\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo\nYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9iaikucGNJc0RldGFjaGVkKCkK\nICAgICAgICAgICAgICAgICAgICAgICAgPT0gQm9vbGVhbi5UUlVFKQogICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdEZXRhY2hlZEV4Y2VwdGlv\nbihvYmosICJyZXRyaWV2ZSIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nVXNlckV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgIGV4Y2Vw\ncyA9IGFkZChleGNlcHMsIHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbG9hZCBhbGwgaG9sbG93IGluc3Rh\nbmNlcwogICAgICAgICAgICBDb2xsZWN0aW9uPE9iamVjdD4gZmFpbGVkID0g\nbnVsbDsKICAgICAgICAgICAgaWYgKGxvYWQgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgaW50IG1vZGUgPSAoZGZnT25seSkgPyBTdG9yZU1hbmFnZXIu\nRk9SQ0VfTE9BRF9ERkcKICAgICAgICAgICAgICAgICAgICA6IFN0b3JlTWFu\nYWdlci5GT1JDRV9MT0FEX0FMTDsKICAgICAgICAgICAgICAgIGZhaWxlZCA9\nIF9zdG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIG1vZGUsIF9mYywgbnVsbCk7\nCiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkICE9IG51bGwgJiYgIWZhaWxl\nZC5pc0VtcHR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXhjZXBzID0gYWRk\nKGV4Y2VwcywgbmV3T2JqZWN0Tm90Rm91bmRFeGNlcHRpb24oZmFpbGVkKSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJldHJpZXZlIGFsbCBu\nb24tZmFpbGVkIGluc3RhbmNlcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nPFN0YXRlTWFuYWdlckltcGw+IGl0ciA9IHNtcy5pdGVyYXRvcigpOyBpdHIu\naGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSBpdHIubmV4dCgp\nOwogICAgICAgICAgICAgICAgaWYgKGZhaWxlZCAhPSBudWxsICYmIGZhaWxl\nZC5jb250YWlucyhzbS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICBpbnQgbW9kZSA9IChkZmdPbmx5\nKSA/IFN0YXRlTWFuYWdlckltcGwuTE9BRF9GR1MKICAgICAgICAgICAgICAg\nICAgICA6IFN0YXRlTWFuYWdlckltcGwuTE9BRF9BTEw7CiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJlYWQo\nLTEpOwogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2RlLCBu\ndWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgZXhj\nZXBzID0gYWRkKGV4Y2Vwcywga2UpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBH\nZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdGhy\nb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHJldHJpZXZlKE9iamVjdCBvYmosIGJvb2xlYW4gZGZn\nT25seSwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFk\nKCk7CgogICAgICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtID0gZ2V0U3Rh\ndGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwogICAgICAgICAgICBpZiAoKHBy\nb2Nlc3NBcmd1bWVudChPcENhbGxiYWNrcy5PUF9SRVRSSUVWRSwgb2JqLCBz\nbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JV\nTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAg\nIGlmIChzbSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNE\nZXRhY2hlZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFj\naGVkRXhjZXB0aW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgICAgICAg\nICBpZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAg\nICBpbnQgbW9kZSA9IChkZmdPbmx5KSA/IFN0YXRlTWFuYWdlckltcGwuTE9B\nRF9GR1MKICAgICAgICAgICAgICAgICAgICAgICAgOiBTdGF0ZU1hbmFnZXJJ\nbXBsLkxPQURfQUxMOwogICAgICAgICAgICAgICAgICAgIHNtLmJlZm9yZVJl\nYWQoLTEpOwogICAgICAgICAgICAgICAgICAgIHNtLmxvYWQoX2ZjLCBtb2Rl\nLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gZWxzZSBpZiAoYXNzZXJ0UGVyc2lzdGVuY2VDYXBhYmxlKG9i\naikucGNJc0RldGFjaGVkKCkKICAgICAgICAgICAgICAgID09IEJvb2xlYW4u\nVFJVRSkKICAgICAgICAgICAgICAgIHRocm93IG5ld0RldGFjaGVkRXhjZXB0\naW9uKG9iaiwgInJldHJpZXZlIik7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQ\nQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZXZpY3RBbGwoT3BDYWxsYmFja3Mg\nY2FsbCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBldmljdCBhbGwgUENsZWFuIGFuZCBQ\nTm9uVHJhbnMgb2JqZWN0cwogICAgICAgICAgICBDb2xsZWN0aW9uPFN0YXRl\nTWFuYWdlckltcGw+IGMgPSBnZXRNYW5hZ2VkU3RhdGVzKCk7CiAgICAgICAg\nICAgIFN0YXRlTWFuYWdlckltcGwgc207CiAgICAgICAgICAgIGZvciAoSXRl\ncmF0b3I8U3RhdGVNYW5hZ2VySW1wbD4gaXRyID0gYy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgc20gPSBpdHIubmV4\ndCgpOwogICAgICAgICAgICAgICAgaWYgKHNtLmlzUGVyc2lzdGVudCgpICYm\nICFzbS5pc0RpcnR5KCkpCiAgICAgICAgICAgICAgICAgICAgZXZpY3Qoc20u\nZ2V0TWFuYWdlZEluc3RhbmNlKCksIGNhbGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZXZp\nY3RBbGwoQ29sbGVjdGlvbiBvYmpzLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAg\nICAgICAgTGlzdDxFeGNlcHRpb24+IGV4Y2VwcyA9IG51bGw7CiAgICAgICAg\nYmVnaW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICBldmljdChpdHIubmV4dCgpLCBjYWxsKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsKICAgICAg\nICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICAg\nICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0QWxsKEV4dGVudCBleHRlbnQsIE9w\nQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAoZXh0ZW50ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRpb24o\nZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGV2aWN0IGFs\nbCBQQ2xlYW4gYW5kIFBOb25UcmFucyBvYmplY3RzIGluIGV4dGVudAogICAg\nICAgICAgICBDb2xsZWN0aW9uPFN0YXRlTWFuYWdlckltcGw+IGMgPSBnZXRN\nYW5hZ2VkU3RhdGVzKCk7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwg\nc207CiAgICAgICAgICAgIENsYXNzPD8+IGNsczsKICAgICAgICAgICAgZm9y\nIChJdGVyYXRvcjxTdGF0ZU1hbmFnZXJJbXBsPiBpdHIgPSBjLml0ZXJhdG9y\nKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBzbSA9IGl0\nci5uZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoc20uaXNQZXJzaXN0ZW50\nKCkgJiYgIXNtLmlzRGlydHkoKSkgewogICAgICAgICAgICAgICAgICAgIGNs\ncyA9IHNtLmdldE1ldGFEYXRhKCkuZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAg\nICAgICAgICAgICAgICAgIGlmIChjbHMgPT0gZXh0ZW50LmdldEVsZW1lbnRU\neXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGV4dGVudC5oYXNT\ndWJjbGFzc2VzKCkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgZXh0ZW50\nLmdldEVsZW1lbnRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShjbHMpKSkKICAg\nICAgICAgICAgICAgICAgICAgICAgZXZpY3Qoc20uZ2V0TWFuYWdlZEluc3Rh\nbmNlKCksIGNhbGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9u\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV2aWN0KE9i\namVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jq\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFN0\nYXRlTWFuYWdlckltcGwgc20gPSBnZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwg\ndHJ1ZSk7CiAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX0VWSUNULCBvYmosIHNtLCBjYWxsKQogICAgICAgICAgICAg\nICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc20gPT0gbnVsbCkKICAgICAg\nICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIHNtLmV2aWN0KCk7CiAg\nICAgICAgICAgIGlmIChfZXZpY3REYXRhQ2FjaGUgJiYgc20uZ2V0T2JqZWN0\nSWQoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBEYXRhQ2FjaGUgY2Fj\naGUgPSBfY29uZi5nZXREYXRhQ2FjaGVNYW5hZ2VySW5zdGFuY2UoKS5zZWxl\nY3RDYWNoZShzbSk7CiAgICAgICAgICAgICAgICBpZiAoY2FjaGUgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgICAgICBjYWNoZS5yZW1vdmUoc20uZ2V0T2Jq\nZWN0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZGV0YWNoKE9i\namVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jq\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChjYWxsID09IG51bGwpCiAgICAgICAgICAgIGNhbGwgPSBfY2FsbDsKCiAg\nICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBEZXRhY2hNYW5hZ2VyKHRoaXMsIGZhbHNl\nLCBjYWxsKS5kZXRhY2gob2JqKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAg\nIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0W10gZGV0YWNoQWxsKENvbGxlY3Rp\nb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmpz\nID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlm\nIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX09C\nSkVDVFM7CiAgICAgICAgaWYgKGNhbGwgPT0gbnVsbCkKICAgICAgICAgICAg\nY2FsbCA9IF9jYWxsOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gbmV3IERldGFjaE1h\nbmFnZXIodGhpcywgZmFsc2UsIGNhbGwpLmRldGFjaEFsbChvYmpzKTsKICAg\nICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRp\nb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRp\nb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9w\nZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBk\nZXRhY2hBbGwoT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGRldGFjaEFs\nbChjYWxsLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkZXRhY2hB\nbGwoT3BDYWxsYmFja3MgY2FsbCwgYm9vbGVhbiBmbHVzaCkgewogICAgICAg\nIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIC8vIElmIGEgZmx1c2ggaXMgZGVzaXJlZCAoYmFzZWQgb24gaW5wdXQg\ncGFybSksIHRoZW4gY2hlY2sgaWYgdGhlCiAgICAgICAgICAgIC8vICJkaXJ0\neSIgZmxhZyBpcyBzZXQgYmVmb3JlIGNhbGxpbmcgZmx1c2goKS4KICAgICAg\nICAgICAgaWYgKGZsdXNoICYmIChfZmxhZ3MgJiBGTEFHX0ZMVVNIX1JFUVVJ\nUkVEKSAhPSAwKQogICAgICAgICAgICAgICAgZmx1c2goKTsKICAgICAgICAg\nICAgZGV0YWNoQWxsSW50ZXJuYWwoY2FsbCk7CiAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsK\nICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFsbEludGVy\nbmFsKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZihfY29uZi5nZXRE\nZXRhY2hTdGF0ZUluc3RhbmNlKCkuZ2V0TGl0ZUF1dG9EZXRhY2goKSA9PSB0\ncnVlKXsKICAgICAgICAgICAgZGV0YWNoQWxsSW50ZXJuYWxMaXRlKCk7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgQ29sbGVjdGlv\nbjxTdGF0ZU1hbmFnZXJJbXBsPiBzdGF0ZXMgPSBnZXRNYW5hZ2VkU3RhdGVz\nKCk7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICBmb3Ig\nKEl0ZXJhdG9yPFN0YXRlTWFuYWdlckltcGw+IGl0ciA9IHN0YXRlcy5pdGVy\nYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBzbSA9IGl0\nci5uZXh0KCk7CiAgICAgICAgICAgIGlmICghc20uaXNQZXJzaXN0ZW50KCkp\nCiAgICAgICAgICAgICAgICBpdHIucmVtb3ZlKCk7CiAgICAgICAgICAgIGVs\nc2UgaWYgKCFzbS5nZXRNZXRhRGF0YSgpLmlzRGV0YWNoYWJsZSgpKSB7CiAg\nICAgICAgICAgICAgICBzbS5yZWxlYXNlKHRydWUpOyAKICAgICAgICAgICAg\nICAgIGl0ci5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoc3RhdGVzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJu\nOwoKICAgICAgICBpZiAoY2FsbCA9PSBudWxsKQogICAgICAgICAgICBjYWxs\nID0gX2NhbGw7CiAgICAgICAgLy8gTWFrZSBzdXJlIEFMTCBlbnRpdGllcyBh\ncmUgZGV0YWNoZWQsIGV2ZW4gbmV3IG9uZXMgdGhhdCBhcmUgbG9hZGVkCiAg\nICAgICAgLy8gZHVyaW5nIHRoZSBkZXRhY2ggcHJvY2Vzc2luZwogICAgICAg\nIGJvb2xlYW4gb3JpZ0Nhc2NhZGUgPSBfY29tcGF0LmdldENhc2NhZGVXaXRo\nRGV0YWNoKCk7CiAgICAgICAgX2NvbXBhdC5zZXRDYXNjYWRlV2l0aERldGFj\naCh0cnVlKTsgICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG5l\ndyBEZXRhY2hNYW5hZ2VyKHRoaXMsIHRydWUsIGNhbGwpCiAgICAgICAgICAg\nICAgICAuZGV0YWNoQWxsKG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihz\ndGF0ZXMpKTsKICAgICAgICB9IAogICAgICAgIGZpbmFsbHkgewogICAgICAg\nICAgICBfY29tcGF0LnNldENhc2NhZGVXaXRoRGV0YWNoKG9yaWdDYXNjYWRl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRldGFjaEFs\nbEludGVybmFsTGl0ZSgpIHsKICAgICAgICBNYW5hZ2VkQ2FjaGUgb2xkID0g\nX2NhY2hlOwogICAgICAgIF9jYWNoZSA9IG5ldyBNYW5hZ2VkQ2FjaGUodGhp\ncyk7CiAgICAgICAgLy8gVE9ETyA6IHNob3VsZCBJIGNhbGwgY2xlYXIgb24g\nb2xkIGNhY2hlIGZpcnN0PyBwZXJoYXBzIGEgbWVtb3J5IGxlYWs/CiAgICAg\nICAgQ29sbGVjdGlvbjxTdGF0ZU1hbmFnZXJJbXBsPiBzdGF0ZXMgPSBvbGQu\nY29weSgpOwogICAgICAgIAogICAgICAgIC8vIENsZWFyIG91dCBhbGwgcGVy\nc2lzdGVuY2UgY29udGV4dCBjYWNoZXMuICAgICAgICAKICAgICAgICBpZiAo\nX3RyYW5zQ2FjaGUgIT0gbnVsbCkgewogICAgICAgICAgICBfdHJhbnNDYWNo\nZS5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBpZiAoX3RyYW5zQWRkaXRp\nb25zICE9IG51bGwpIHsKICAgICAgICAgICAgX3RyYW5zQWRkaXRpb25zLmNs\nZWFyKCk7CiAgICAgICAgfQogICAgICAgIGlmIChfZG1MaXRlID09IG51bGwp\nIHsKICAgICAgICAgICAgX2RtTGl0ZSA9IG5ldyBEZXRhY2hNYW5hZ2VyTGl0\nZSgpOwogICAgICAgIH0KICAgICAgICBfZG1MaXRlLmRldGFjaEFsbChzdGF0\nZXMpOwogICAgfQogICAgcHVibGljIE9iamVjdCBhdHRhY2goT2JqZWN0IG9i\naiwgYm9vbGVhbiBjb3B5TmV3LCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAg\nICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vdCB0byB0cnkgdG8gc2V0IHJv\nbGxiYWNrIG9ubHkgaWYgdGhpcyBmYWlscwogICAgICAgICAgICBhc3NlcnRX\ncml0ZU9wZXJhdGlvbigpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBBdHRhY2hNYW5hZ2VyKHRoaXMsIGNvcHlOZXcs\nIGNhbGwpLmF0dGFjaChvYmopOwogICAgICAgICAgICB9IGNhdGNoIChPcHRp\nbWlzdGljRXhjZXB0aW9uIG9lKSB7CiAgICAgICAgICAgICAgICBzZXRSb2xs\nYmFja09ubHkob2UpOwogICAgICAgICAgICAgICAgdGhyb3cgb2Uuc2V0RmF0\nYWwodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0W10gYXR0YWNoQWxsKENvbGxlY3Rpb24gb2JqcywgYm9vbGVhbiBj\nb3B5TmV3LAogICAgICAgIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2JqcyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgICBpZiAob2Jqcy5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiBF\nTVBUWV9PQkpFQ1RTOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgbm90IHRv\nIHRyeSB0byBzZXQgcm9sbGJhY2sgb25seSBpZiB0aGlzIGZhaWxzCiAgICAg\nICAgICAgIGFzc2VydFdyaXRlT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEF0dGFjaE1hbmFnZXIo\ndGhpcywgY29weU5ldywgY2FsbCkuYXR0YWNoQWxsKG9ianMpOwogICAgICAg\nICAgICB9IGNhdGNoIChPcHRpbWlzdGljRXhjZXB0aW9uIG9lKSB7CiAgICAg\nICAgICAgICAgICBzZXRSb2xsYmFja09ubHkob2UpOwogICAgICAgICAgICAg\nICAgdGhyb3cgb2Uuc2V0RmF0YWwodHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IGtlOwogICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlu\nYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBub250cmFuc2FjdGlvbmFsQWxsKENv\nbGxlY3Rpb24gb2JqcywgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGJl\nZ2luT3BlcmF0aW9uKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIExpc3Q8RXhjZXB0aW9uPiBleGNlcHMgPSBudWxsOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IG9ianMuaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgbm9udHJhbnNhY3Rpb25hbChpdHIubmV4dCgpLCBjYWxsKTsK\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsK\nICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ndGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJhdGlvbigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBub250cmFuc2FjdGlvbmFs\nKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAo\nb2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVn\naW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nU3RhdGVNYW5hZ2VySW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKTsKICAgICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BD\nYWxsYmFja3MuT1BfTk9OVFJBTlNBQ1RJT05BTCwgb2JqLCBzbSwgY2FsbCkK\nICAgICAgICAgICAgICAgICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0gMCkK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKHNtICE9\nIG51bGwpCiAgICAgICAgICAgICAgICBzbS5ub250cmFuc2FjdGlvbmFsKCk7\nCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXhj\nZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNYWtlIHRoZSBnaXZlbiBpbnN0YW5jZXMgdHJhbnNhY3Rpb25hbC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgdHJhbnNhY3Rpb25hbEFsbChDb2xsZWN0\naW9uIG9ianMsIGJvb2xlYW4gdXBkYXRlVmVyc2lvbiwKICAgICAgICBPcENh\nbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgaWYgKG9ianMuaXNFbXB0eSgpKQog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKG9ianMuc2l6ZSgpID09\nIDEpIHsKICAgICAgICAgICAgdHJhbnNhY3Rpb25hbChvYmpzLml0ZXJhdG9y\nKCkubmV4dCgpLCB1cGRhdGVWZXJzaW9uLCBjYWxsKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5PcGVyYXRpb24odHJ1\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29sbGVjdCBhbGwg\naG9sbG93IGluc3RhbmNlcyBmb3IgbG9hZCwgYW5kIG1ha2UgdW5tYW5hbmdl\nZAogICAgICAgICAgICAvLyBpbnN0YW5jZXMgdHJhbnNpZW50LXRyYW5zYWN0\naW9uYWwKICAgICAgICAgICAgQ29sbGVjdGlvbjxPcGVuSlBBU3RhdGVNYW5h\nZ2VyPiBsb2FkID0gbnVsbDsKICAgICAgICAgICAgT2JqZWN0IG9iajsKICAg\nICAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBzbTsKICAgICAgICAgICAgQ2xh\nc3NNZXRhRGF0YSBtZXRhOwogICAgICAgICAgICBDb2xsZWN0aW9uPFN0YXRl\nTWFuYWdlckltcGw+IHNtcyA9IG5ldyBMaW5rZWRIYXNoU2V0PFN0YXRlTWFu\nYWdlckltcGw+KG9ianMuc2l6ZSgpKTsKICAgICAgICAgICAgTGlzdDxFeGNl\ncHRpb24+IGV4Y2VwcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoSXRlcmF0\nb3I8Pz4gaXRyID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykg\newogICAgICAgICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAg\nICAgICAgIGlmIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIHNtID0gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIHRydWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2Fs\nbGJhY2tzLk9QX1RSQU5TQUNUSU9OQUwsIG9iaiwgc20sCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNhbGwpICYgT3BDYWxsYmFja3MuQUNUX1JVTikgPT0g\nMCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAg\nICAgICAgICAgICAgIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIG1hbmFnZSB0cmFuc2llbnQgaW5zdGFuY2UKICAgICAg\nICAgICAgICAgICAgICAgICAgbWV0YSA9IF9jb25mLmdldE1ldGFEYXRhUmVw\nb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBnZXRNZXRhRGF0YShvYmouZ2V0Q2xhc3MoKSwgX2xvYWRlciwgdHJ1ZSk7\nCgogICAgICAgICAgICAgICAgICAgICAgICBzbSA9IG5ldyBTdGF0ZU1hbmFn\nZXJJbXBsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoU3RhdGVNYW5h\nZ2VySWQubmV3SW5zdGFuY2UodGhpcyksIG1ldGEsIHRoaXMpOwogICAgICAg\nICAgICAgICAgICAgICAgICBzbS5pbml0aWFsaXplKGFzc2VydFBlcnNpc3Rl\nbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nUENTdGF0ZS5UQ0xFQU4pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBp\nZiAoc20uaXNQZXJzaXN0ZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChzbS5nZXRQQ1N0YXRlKCkgPT0gUENTdGF0ZS5IT0xMT1cpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkID09IG51bGwpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZCA9IG5ldyBBcnJh\neUxpc3Q8T3BlbkpQQVN0YXRlTWFuYWdlcj4oKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxvYWQuYWRkKHNtKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgc20uc2V0Q2hlY2tW\nZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBk\nYXRlVmVyc2lvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtLnNl\ndFVwZGF0ZVZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX0ZMVVNIX1JFUVVJUkVEOyAvLyB2ZXJzaW9uIGNo\nZWNrL3VwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgY2F0Y2ggKFVzZXJFeGNlcHRpb24gdWUpIHsK\nICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhjZXBzLCB1ZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIGxvYWQgYWxsIGhvbGxvdyBpbnN0YW5jZXMKICAgICAgICAgICAgQ29s\nbGVjdGlvbjxPYmplY3Q+IGZhaWxlZCA9IG51bGw7CiAgICAgICAgICAgIGlm\nIChsb2FkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZhaWxlZCA9IF9z\ndG9yZS5sb2FkQWxsKGxvYWQsIG51bGwsIFN0b3JlTWFuYWdlci5GT1JDRV9M\nT0FEX05PTkUsCiAgICAgICAgICAgICAgICAgICAgX2ZjLCBudWxsKTsKICAg\nICAgICAgICAgICAgIGlmIChmYWlsZWQgIT0gbnVsbCAmJiAhZmFpbGVkLmlz\nRW1wdHkoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHMgPSBhZGQoZXhj\nZXBzLAogICAgICAgICAgICAgICAgICAgICAgICBuZXdPYmplY3ROb3RGb3Vu\nZEV4Y2VwdGlvbihmYWlsZWQpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgdHJhbnNhY3Rpb25hbFN0YXRlc0FsbChzbXMsIGZhaWxlZCwgZXhjZXBz\nKTsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVF\neGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxF\neGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGVuZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIE1ha2UgdGhlIGdpdmVuIGluc3RhbmNlcyB0cmFuc2FjdGlvbmFsLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCB0cmFuc2FjdGlvbmFsKE9iamVjdCBv\nYmosIGJvb2xlYW4gdXBkYXRlVmVyc2lvbiwKICAgICAgICBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKG9iaiA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm47CgogICAgICAgIGJlZ2luT3BlcmF0aW9uKHRydWUpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20gPSBn\nZXRTdGF0ZU1hbmFnZXJJbXBsKG9iaiwgdHJ1ZSk7CiAgICAgICAgICAgIGlm\nICgocHJvY2Vzc0FyZ3VtZW50KE9wQ2FsbGJhY2tzLk9QX1RSQU5TQUNUSU9O\nQUwsIG9iaiwgc20sIGNhbGwpCiAgICAgICAgICAgICAgICAmIE9wQ2FsbGJh\nY2tzLkFDVF9SVU4pID09IDApCiAgICAgICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgICAgICBpZiAoc20gIT0gbnVsbCAmJiBzbS5pc1BlcnNpc3RlbnQo\nKSkgewogICAgICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24o\nKTsKICAgICAgICAgICAgICAgIHNtLnRyYW5zYWN0aW9uYWwoKTsKICAgICAg\nICAgICAgICAgIHNtLmxvYWQoX2ZjLCBTdGF0ZU1hbmFnZXJJbXBsLkxPQURf\nRkdTLCBudWxsLCBudWxsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzbS5z\nZXRDaGVja1ZlcnNpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAodXBk\nYXRlVmVyc2lvbikKICAgICAgICAgICAgICAgICAgICBzbS5zZXRVcGRhdGVW\nZXJzaW9uKHRydWUpOwogICAgICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdf\nRkxVU0hfUkVRVUlSRUQ7IC8vIHZlcnNpb24gY2hlY2svdXAKICAgICAgICAg\nICAgfSBlbHNlIGlmIChzbSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAv\nLyBtYW5hZ2UgdHJhbnNpZW50IGluc3RhbmNlCiAgICAgICAgICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGEgPSBfY29uZi5nZXRNZXRhRGF0YVJlcG9zaXRv\ncnlJbnN0YW5jZSgpLgogICAgICAgICAgICAgICAgICAgIGdldE1ldGFEYXRh\nKG9iai5nZXRDbGFzcygpLCBfbG9hZGVyLCB0cnVlKTsKICAgICAgICAgICAg\nICAgIE9iamVjdCBpZCA9IFN0YXRlTWFuYWdlcklkLm5ld0luc3RhbmNlKHRo\naXMpOwogICAgICAgICAgICAgICAgc20gPSBuZXcgU3RhdGVNYW5hZ2VySW1w\nbChpZCwgbWV0YSwgdGhpcyk7CiAgICAgICAgICAgICAgICBzbS5pbml0aWFs\naXplKGFzc2VydFBlcnNpc3RlbmNlQ2FwYWJsZShvYmopLAogICAgICAgICAg\nICAgICAgICAgIFBDU3RhdGUuVENMRUFOKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewog\nICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1l\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFs\nRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUcmFuc2l0aW9uIHRoZSBnaXZlbiBzdGF0ZSBtYW5hZ2VycyB0byB0\ncmFuc2FjdGlvbmFsLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdHJhbnNh\nY3Rpb25hbFN0YXRlc0FsbChDb2xsZWN0aW9uIHNtcywgQ29sbGVjdGlvbiBm\nYWlsZWQsCiAgICAgICAgTGlzdDxFeGNlcHRpb24+IGV4Y2VwcykgewogICAg\nICAgIC8vIG1ha2UgaW5zdGFuY2VzIHRyYW5zYWN0aW9uYWwgYW5kIG1ha2Ug\nc3VyZSB0aGV5IGFyZSBsb2FkZWQKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBs\nIHNtOwogICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gc21zLml0ZXJh\ndG9yKCk7IGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIHNtID0gKFN0\nYXRlTWFuYWdlckltcGwpIGl0ci5uZXh0KCk7CiAgICAgICAgICAgIGlmIChm\nYWlsZWQgIT0gbnVsbCAmJiBmYWlsZWQuY29udGFpbnMoc20uZ2V0SWQoKSkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBzbS50cmFuc2FjdGlvbmFsKCk7CiAgICAgICAg\nICAgICAgICBzbS5sb2FkKF9mYywgU3RhdGVNYW5hZ2VySW1wbC5MT0FEX0ZH\nUywgbnVsbCwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICB9IGNhdGNoIChP\ncGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICBleGNlcHMg\nPSBhZGQoZXhjZXBzLCBrZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgdGhyb3dOZXN0ZWRFeGNlcHRpb25zKGV4Y2VwcywgZmFsc2UpOwog\nICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFeHRlbnQsIFF1\nZXJ5CiAgICAvLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBFeHRlbnQg\nbmV3RXh0ZW50KENsYXNzIHR5cGUsIGJvb2xlYW4gc3ViY2xhc3Nlcykgewog\nICAgICAgIHJldHVybiBuZXdFeHRlbnQodHlwZSwgc3ViY2xhc3NlcywgbnVs\nbCk7CiAgICB9CgogICAgcHJpdmF0ZSBFeHRlbnQgbmV3RXh0ZW50KENsYXNz\nIHR5cGUsIGJvb2xlYW4gc3ViY2xhc3NlcywKICAgICAgICBGZXRjaENvbmZp\nZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVl\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBFeHRlbnRJbXBsIGV4dGVu\ndCA9IG5ldyBFeHRlbnRJbXBsKHRoaXMsIHR5cGUsIHN1YmNsYXNzZXMsIGZl\ndGNoKTsKICAgICAgICAgICAgaWYgKF9leHRlbnRzID09IG51bGwpCiAgICAg\nICAgICAgICAgICBfZXh0ZW50cyA9IG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJl\nZmVyZW5jZUhhc2hTZXQuV0VBSyk7CiAgICAgICAgICAgIF9leHRlbnRzLmFk\nZChleHRlbnQpOwoKICAgICAgICAgICAgcmV0dXJuIGV4dGVudDsKICAgICAg\nICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAg\nIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24o\ncmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVuZE9wZXJh\ndGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgSXRlcmF0b3Ig\nZXh0ZW50SXRlcmF0b3IoQ2xhc3MgdHlwZSwgYm9vbGVhbiBzdWJjbGFzc2Vz\nLAogICAgICAgIEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCwgYm9vbGVhbiBp\nZ25vcmVDaGFuZ2VzKSB7CiAgICAgICAgRXh0ZW50IGV4dGVudCA9IG5ld0V4\ndGVudCh0eXBlLCBzdWJjbGFzc2VzLCBmZXRjaCk7CiAgICAgICAgZXh0ZW50\nLnNldElnbm9yZUNoYW5nZXMoaWdub3JlQ2hhbmdlcyk7CiAgICAgICAgcmV0\ndXJuIGV4dGVudC5pdGVyYXRvcigpOwogICAgfQoKICAgIHB1YmxpYyBRdWVy\neSBuZXdRdWVyeShTdHJpbmcgbGFuZywgQ2xhc3MgY2xzLCBPYmplY3QgcXVl\ncnkpIHsKICAgICAgICBRdWVyeSBxID0gbmV3UXVlcnkobGFuZywgcXVlcnkp\nOwogICAgICAgIHEuc2V0Q2FuZGlkYXRlVHlwZShjbHMsIHRydWUpOwogICAg\nICAgIHJldHVybiBxOwogICAgfQoKICAgIHB1YmxpYyBRdWVyeSBuZXdRdWVy\neShTdHJpbmcgbGFuZywgT2JqZWN0IHF1ZXJ5KSB7CiAgICAgICAgLy8gY29t\nbW9uIG1pc3Rha2VzCiAgICAgICAgaWYgKHF1ZXJ5IGluc3RhbmNlb2YgRXh0\nZW50IHx8IHF1ZXJ5IGluc3RhbmNlb2YgQ2xhc3MpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtbmV3LXF1ZXJ5\nIikpOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxzZSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgU3RvcmVRdWVyeSBzcSA9IF9zdG9yZS5uZXdR\ndWVyeShsYW5nKTsKICAgICAgICAgICAgaWYgKHNxID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIEV4cHJlc3Npb25QYXJzZXIgZXAgPSBRdWVyeUxhbmd1\nYWdlcy5wYXJzZXJGb3JMYW5ndWFnZShsYW5nKTsKICAgICAgICAgICAgICAg\nIGlmIChlcCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNxID0gbmV3\nIEV4cHJlc3Npb25TdG9yZVF1ZXJ5KGVwKTsKICAgICAgICAgICAgICAgIGVs\nc2UgaWYgKFF1ZXJ5TGFuZ3VhZ2VzLkxBTkdfTUVUSE9EUUwuZXF1YWxzKGxh\nbmcpKQogICAgICAgICAgICAgICAgICAgIHNxID0gbmV3IE1ldGhvZFN0b3Jl\nUXVlcnkoKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24obGFuZyk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIFF1ZXJ5IHEgPSBuZXdRdWVyeUlt\ncGwobGFuZywgc3EpOwogICAgICAgICAgICBxLnNldElnbm9yZUNoYW5nZXMo\nX2lnbm9yZUNoYW5nZXMpOwogICAgICAgICAgICBpZiAocXVlcnkgIT0gbnVs\nbCkKICAgICAgICAgICAgICAgIHEuc2V0UXVlcnkocXVlcnkpOwoKICAgICAg\nICAgICAgLy8gdHJhY2sgcXVlcmllcwogICAgICAgICAgICBpZiAoX3F1ZXJp\nZXMgPT0gbnVsbCkKICAgICAgICAgICAgICAgIF9xdWVyaWVzID0gbmV3IFJl\nZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNlSGFzaFNldC5XRUFLKTsKICAgICAg\nICAgICAgX3F1ZXJpZXMuYWRkKHEpOwogICAgICAgICAgICByZXR1cm4gcTsK\nICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNl\ncHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxFeGNl\ncHRpb24ocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGVu\nZE9wZXJhdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIENyZWF0ZSBhIG5ldyBxdWVyeS4KICAgICAqLwogICAgcHJvdGVjdGVkIFF1\nZXJ5SW1wbCBuZXdRdWVyeUltcGwoU3RyaW5nIGxhbmcsIFN0b3JlUXVlcnkg\nc3EpIHsKICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5SW1wbCh0aGlzLCBsYW5n\nLCBzcSk7CiAgICB9CgogICAgcHVibGljIFNlcSBnZXRJZGVudGl0eVNlcXVl\nbmNlKENsYXNzTWV0YURhdGEgbWV0YSkgewogICAgICAgIGlmIChtZXRhID09\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHJldHVy\nbiBnZXRTZXF1ZW5jZShtZXRhLCBudWxsKTsKICAgIH0KCiAgICBwdWJsaWMg\nU2VxIGdldFZhbHVlU2VxdWVuY2UoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAg\nICAgICBpZiAoZm1kID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIHJldHVybiBnZXRTZXF1ZW5jZShmbWQuZ2V0RGVmaW5pbmdN\nZXRhRGF0YSgpLCBmbWQpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\nIGEgc2VxdWVuY2UgZm9yIHRoZSBnaXZlbiBjbGFzcyBhbmQgb3B0aW9uYWwg\nZmllbGQuCiAgICAgKi8KICAgIHByaXZhdGUgU2VxIGdldFNlcXVlbmNlKENs\nYXNzTWV0YURhdGEgbWV0YSwgRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAg\nICAvLyBnZXQgc2VxdWVuY2Ugc3RyYXRlZ3kgZnJvbSBtZXRhZGF0YQogICAg\nICAgIGludCBzdHJhdGVneTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAg\nICAgICAgICAgIHN0cmF0ZWd5ID0gbWV0YS5nZXRJZGVudGl0eVN0cmF0ZWd5\nKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdHJhdGVneSA9IGZtZC5n\nZXRWYWx1ZVN0cmF0ZWd5KCk7CgogICAgICAgIC8vIHdlIGNhbiBoYW5kbGUg\nbm9uLW5hdGl2ZSBzdHJhdGVnaWVzIHdpdGhvdXQgdGhlIHN0b3JlIG1hbmFn\nZXIKICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7CiAgICAgICAgICAgIGNh\nc2UgVmFsdWVTdHJhdGVnaWVzLlVVSURfSEVYOgogICAgICAgICAgICAgICAg\ncmV0dXJuIFVVSURIZXhTZXEuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAg\nY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJRF9TVFJJTkc6CiAgICAgICAgICAg\nICAgICByZXR1cm4gVVVJRFN0cmluZ1NlcS5nZXRJbnN0YW5jZSgpOwogICAg\nICAgICAgICBjYXNlIFZhbHVlU3RyYXRlZ2llcy5VVUlEX1RZUEU0X0hFWDoK\nICAgICAgICAgICAgICAgIHJldHVybiBVVUlEVHlwZTRIZXhTZXEuZ2V0SW5z\ndGFuY2UoKTsKICAgICAgICAgICAgY2FzZSBWYWx1ZVN0cmF0ZWdpZXMuVVVJ\nRF9UWVBFNF9TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gVVVJRFR5\ncGU0U3RyaW5nU2VxLmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNhc2Ug\nVmFsdWVTdHJhdGVnaWVzLlNFUVVFTkNFOgogICAgICAgICAgICAgICAgU2Vx\ndWVuY2VNZXRhRGF0YSBzbWQgPSAoZm1kID09IG51bGwpCiAgICAgICAgICAg\nICAgICAgICAgPyBtZXRhLmdldElkZW50aXR5U2VxdWVuY2VNZXRhRGF0YSgp\nCiAgICAgICAgICAgICAgICAgICAgOiBmbWQuZ2V0VmFsdWVTZXF1ZW5jZU1l\ndGFEYXRhKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gc21kLmdldEluc3Rh\nbmNlKF9sb2FkZXIpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICAgICAgLy8gdXNlIHN0b3JlIG1hbmFnZXIgZm9yIG5hdGl2ZSBzZXF1ZW5j\nZQogICAgICAgICAgICAgICAgaWYgKGZtZCA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiBhIHNlcXVlbmNlIGV2\nZW4gZm9yIGFwcCBpZCBjbGFzc2VzLAogICAgICAgICAgICAgICAgICAgIC8v\nIHdoaWNoIGlzIHdoYXQgd2Ugd2FudCBmb3IgYmFja3dhcmRzLWNvbXBhdGli\naWxpdHkuCiAgICAgICAgICAgICAgICAgICAgLy8gRXZlbiBpZiB1c2VyIHVz\nZXMgQXBwbGljYXRpb24gSWRlbnRpdHksCiAgICAgICAgICAgICAgICAgICAg\nLy8gdXNlciBtaWdodCB1c2UgY3VzdG9tIHNlcXVlbmNlIGluZm9ybWF0aW9u\nLgogICAgICAgICAgICAgICAgICAgIC8vIFNvLCBmaXJzdCwgdGhlIHNlcXVl\nbmNlIHNob3VsZCBiZSBjaGVja2VkLgogICAgICAgICAgICAgICAgICAgIC8v\nIFRyeWluZyB0byBnZXQgcHJpbWFyeSBrZXkgZmllbGQgaWYgaXQgaGFzCiAg\nICAgICAgICAgICAgICAgICAgLy8gc2VxdWVuY2UgbWV0YSBkYXRhLgogICAg\nICAgICAgICAgICAgICAgIEZpZWxkTWV0YURhdGFbXSBwa3MgPSBtZXRhLmdl\ndFByaW1hcnlLZXlGaWVsZHMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\ncGtzICE9IG51bGwgJiYgcGtzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHNtZCA9IHBrc1swXS5nZXRWYWx1ZVNlcXVlbmNlTWV0\nYURhdGEoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBzbWQgPSBtZXRhLmdldElkZW50aXR5U2VxdWVu\nY2VNZXRhRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAgICAgaWYgKHNtZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBzbWQuZ2V0SW5zdGFuY2UoX2xvYWRlcik7CiAg\nICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIF9zdG9yZS5nZXREYXRhU3RvcmVJZFNlcXVlbmNlKG1l\ndGEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZ2V0VmFsdWVTZXF1ZW5j\nZShmbWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAg\nLy8gTG9ja2luZwogICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBs\nb2NrKE9iamVjdCBvYmosIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBp\nZiAob2JqID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAg\nYmVnaW5PcGVyYXRpb24odHJ1ZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2Nr\nIGxldmVsIGFsd2F5cyBOT05FCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nbG9jayhvYmosIF9mYy5nZXRXcml0ZUxvY2tMZXZlbCgpLCBfZmMuZ2V0TG9j\na1RpbWVvdXQoKSwgY2FsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGxvY2soT2JqZWN0IG9iaiwgaW50IGxldmVsLCBpbnQgdGlt\nZW91dCwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIGlmIChvYmogPT0g\nbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJh\ndGlvbih0cnVlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRB\nY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAgICAgICAgU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2JqLCB0cnVlKTsKICAg\nICAgICAgICAgaWYgKChwcm9jZXNzQXJndW1lbnQoT3BDYWxsYmFja3MuT1Bf\nTE9DSywgb2JqLCBzbSwgY2FsbCkKICAgICAgICAgICAgICAgICYgT3BDYWxs\nYmFja3MuQUNUX1JVTikgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgaWYgKHNtID09IG51bGwgfHwgIXNtLmlzUGVyc2lzdGVu\ndCgpKQogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX2xt\nLmxvY2soc20sIGxldmVsLCB0aW1lb3V0LCBudWxsKTsKICAgICAgICAgICAg\nc20ucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOyAvLyB1c2Ugc2FtZSBsZXZl\nbCBmb3IgZnV0dXJlIHdyaXRlCiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9\nIGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBHZW5lcmFsRXhjZXB0aW9uKHJlKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMs\nIE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBpZiAob2Jqcy5pc0VtcHR5\nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYmVnaW5PcGVyYXRp\nb24odHJ1ZSk7IC8vIGhhdmUgdG8gc3luYyBvciBsb2NrIGxldmVsIGFsd2F5\ncyBOT05FCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9ja0FsbChvYmpz\nLCBfZmMuZ2V0V3JpdGVMb2NrTGV2ZWwoKSwgX2ZjLmdldExvY2tUaW1lb3V0\nKCksCiAgICAgICAgICAgICAgICBjYWxsKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgbG9ja0FsbChDb2xsZWN0aW9uIG9ianMsIGlu\ndCBsZXZlbCwgaW50IHRpbWVvdXQsCiAgICAgICAgT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIGlmIChvYmpzLmlzRW1wdHkoKSkKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIGlmIChvYmpzLnNpemUoKSA9PSAxKSB7CiAgICAg\nICAgICAgIGxvY2sob2Jqcy5pdGVyYXRvcigpLm5leHQoKSwgbGV2ZWwsIHRp\nbWVvdXQsIGNhbGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBiZWdpbk9wZXJhdGlvbih0cnVlKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRBY3RpdmVUcmFuc2FjdGlvbigpOwoKICAgICAg\nICAgICAgQ29sbGVjdGlvbjxTdGF0ZU1hbmFnZXJJbXBsPiBzbXMgPSBuZXcg\nTGlua2VkSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPihvYmpzLnNpemUoKSk7\nCiAgICAgICAgICAgIE9iamVjdCBvYmo7CiAgICAgICAgICAgIFN0YXRlTWFu\nYWdlckltcGwgc207CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRy\nID0gb2Jqcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAg\nICAgICAgICAgb2JqID0gaXRyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nCiAgICAgICAgICAgICAgICBzbSA9IGdldFN0YXRlTWFuYWdlckltcGwob2Jq\nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmICgocHJvY2Vzc0FyZ3VtZW50\nKE9wQ2FsbGJhY2tzLk9QX0xPQ0ssIG9iaiwgc20sIGNhbGwpCiAgICAgICAg\nICAgICAgICAgICAgJiBPcENhbGxiYWNrcy5BQ1RfUlVOKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYg\nKHNtICE9IG51bGwgJiYgc20uaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAg\nICAgICAgICAgc21zLmFkZChzbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIF9sbS5sb2NrQWxsKHNtcywgbGV2ZWwsIHRpbWVvdXQsIG51bGwpOwog\nICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPFN0YXRlTWFuYWdlckltcGw+IGl0\nciA9IHNtcy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAg\nICAgICAgIGl0ci5uZXh0KCkucmVhZExvY2tlZChsZXZlbCwgbGV2ZWwpOwog\nICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsKICAgICAg\nICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2Vw\ndGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgR2VuZXJhbEV4Y2Vw\ndGlvbihyZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8v\nLy8vCiAgICAvLyBDb25uZWN0aW9uCiAgICAvLy8vLy8vLy8vLy8vLwoKICAg\nIHB1YmxpYyBib29sZWFuIGNhbmNlbEFsbCgpIHsKICAgICAgICAvLyB0aGlz\nIG1ldGhvZCBkb2VzIG5vdCBsb2NrLCBzaW5jZSB3ZSB3YW50IHRvIGFsbG93\nIGEgZGlmZmVyZW50CiAgICAgICAgLy8gdGhyZWFkIHRvIGJlIGFibGUgdG8g\nY2FuY2VsIG9uIGEgbG9ja2VkLXVwIHBlcnNpc3RlbmNlIG1hbmFnZXIKCiAg\nICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIGlmIHdlJ3JlIGZsdXNoaW5nLCBoYXZlIHRvIHNldCByb2xsYmFjayBv\nbmx5IC0tIGRvIHRoaXMgYmVmb3JlIHdlCiAgICAgICAgICAgIC8vIGF0dGVt\ncHQgdG8gY2FuY2VsLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgY2FuY2VsIG1p\nZ2h0IGNhc2UgdGhlCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHRvIGNv\nbXBsZXRlIGJlZm9yZSB3ZSBoYXZlIGEgY2hhbmNlIHRvIHNldCB0aGUKICAg\nICAgICAgICAgLy8gcm9sbGJhY2sgb25seSBmbGFnCiAgICAgICAgICAgIGlm\nICgoX2ZsYWdzICYgRkxBR19TVE9SRV9GTFVTSElORykgIT0gMCkKICAgICAg\nICAgICAgICAgIHNldFJvbGxiYWNrT25seUludGVybmFsKG5ldyBVc2VyRXhj\nZXB0aW9uKCkpOwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmNhbmNlbEFs\nbCgpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24ga2UpIHsK\nICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAoUnVudGlt\nZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgU3RvcmVF\neGNlcHRpb24ocmUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2Jq\nZWN0IGdldENvbm5lY3Rpb24oKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgIGlmICghX2NvbmYuc3VwcG9ydGVkT3B0aW9ucygpLmNvbnRhaW5z\nCiAgICAgICAgICAgIChPcGVuSlBBQ29uZmlndXJhdGlvbi5PUFRJT05fREFU\nQVNUT1JFX0NPTk5FQ1RJT04pKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5z\ndXBwb3J0ZWRFeGNlcHRpb24oX2xvYy5nZXQoImNvbm4tbm90LXN1cHBvcnRl\nZCIpKTsKCiAgICAgICAgcmV0dXJuIF9zdG9yZS5nZXRDbGllbnRDb25uZWN0\naW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaGFzQ29ubmVjdGlv\nbigpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIChf\nZmxhZ3MgJiBGTEFHX1JFVEFJTkVEX0NPTk4pICE9IDA7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUZWxsIHN0b3JlIHRvIHJldGFpbiBjb25uZWN0aW9uIGlm\nIHdlIGhhdmVuJ3QgYWxyZWFkeS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIHJldGFpbkNvbm5lY3Rpb24oKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBG\nTEFHX1JFVEFJTkVEX0NPTk4pID09IDApIHsKICAgICAgICAgICAgX3N0b3Jl\nLnJldGFpbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZM\nQUdfUkVUQUlORURfQ09OTjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUZWxsIHN0b3JlIHRvIHJlbGVhc2UgY29ubmVjdGlvbiBpZiB3ZSBo\nYXZlIHJldGFpbmVkIG9uZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJl\nbGVhc2VDb25uZWN0aW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxB\nR19SRVRBSU5FRF9DT05OKSAhPSAwKSB7CiAgICAgICAgICAgIF9zdG9yZS5y\nZWxlYXNlQ29ubmVjdGlvbigpOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZM\nQUdfUkVUQUlORURfQ09OTjsKICAgICAgICB9CiAgICB9CgogICAgLy8vLy8v\nLy8vCiAgICAvLyBDYWNoZQogICAgLy8vLy8vLy8vCgogICAgcHVibGljIENv\nbGxlY3Rpb24gZ2V0TWFuYWdlZE9iamVjdHMoKSB7CiAgICAgICAgYmVnaW5P\ncGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0TWFuYWdlZFN0\nYXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRP\ncGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENvbGxl\nY3Rpb24gZ2V0VHJhbnNhY3Rpb25hbE9iamVjdHMoKSB7CiAgICAgICAgYmVn\naW5PcGVyYXRpb24oZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBuZXcgTWFuYWdlZE9iamVjdENvbGxlY3Rpb24oZ2V0VHJhbnNh\nY3Rpb25hbFN0YXRlcygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENvbGxlY3Rpb24gZ2V0UGVuZGluZ1RyYW5zYWN0aW9uYWxPYmplY3Rz\nKCkgewogICAgICAgIGJlZ2luT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1hbmFnZWRPYmplY3RDb2xs\nZWN0aW9uCiAgICAgICAgICAgICAgICAoZ2V0UGVuZGluZ1RyYW5zYWN0aW9u\nYWxTdGF0ZXMoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nZW5kT3BlcmF0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBD\nb2xsZWN0aW9uIGdldERpcnR5T2JqZWN0cygpIHsKICAgICAgICBiZWdpbk9w\nZXJhdGlvbihmYWxzZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBNYW5hZ2VkT2JqZWN0Q29sbGVjdGlvbihnZXREaXJ0eVN0YXRl\ncygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBlbmRPcGVy\nYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nZ2V0T3JkZXJEaXJ0eU9iamVjdHMoKSB7CiAgICAgICAgcmV0dXJuIF9vcmRl\nckRpcnR5OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE9yZGVyRGlydHlP\nYmplY3RzKGJvb2xlYW4gb3JkZXIpIHsKICAgICAgICBfb3JkZXJEaXJ0eSA9\nIG9yZGVyOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgY29weSBv\nZiBhbGwgbWFuYWdlZCBzdGF0ZSBtYW5hZ2Vycy4KICAgICAqLwogICAgcHJv\ndGVjdGVkIENvbGxlY3Rpb24gZ2V0TWFuYWdlZFN0YXRlcygpIHsKICAgICAg\nICByZXR1cm4gX2NhY2hlLmNvcHkoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGNvcHkgb2YgYWxsIHRyYW5zYWN0aW9uYWwgc3RhdGUgbWFu\nYWdlcnMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9uPFN0YXRl\nTWFuYWdlckltcGw+IGdldFRyYW5zYWN0aW9uYWxTdGF0ZXMoKSB7CiAgICAg\nICAgaWYgKCFoYXNUcmFuc2FjdGlvbmFsT2JqZWN0cygpKQogICAgICAgICAg\nICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VUOwogICAgICAgIHJldHVy\nbiBfdHJhbnNDYWNoZS5jb3B5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBX\naGV0aGVyIG9yIG5vdCB0aGVyZSBhcmUgYW55IHRyYW5zYWN0aW9uYWwgb2Jq\nZWN0cyBpbiB0aGUgY3VycmVudAogICAgICogcGVyc2lzdGVuY2UgY29udGV4\ndC4gSWYgdGhlcmUgYXJlIGFueSBpbnN0YW5jZXMgd2l0aCB1bnRyYWNrZWQg\nc3RhdGUsCiAgICAgKiB0aGlzIG1ldGhvZCB3aWxsIGNhdXNlIHRob3NlIGlu\nc3RhbmNlcyB0byBiZSBzY2FubmVkLgogICAgICovCiAgICBwcml2YXRlIGJv\nb2xlYW4gaGFzVHJhbnNhY3Rpb25hbE9iamVjdHMoKSB7CiAgICAgICAgX2Nh\nY2hlLmRpcnR5Q2hlY2soKTsKICAgICAgICByZXR1cm4gX3RyYW5zQ2FjaGUg\nIT0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGNvcHkg\nb2YgYWxsIGRpcnR5IHN0YXRlIG1hbmFnZXJzLgogICAgICovCiAgICBwcm90\nZWN0ZWQgQ29sbGVjdGlvbiBnZXREaXJ0eVN0YXRlcygpIHsKICAgICAgICBp\nZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkpCiAgICAgICAgICAgIHJl\ndHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CgogICAgICAgIHJldHVybiBf\ndHJhbnNDYWNoZS5jb3B5RGlydHkoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGNvcHkgb2YgYWxsIHN0YXRlIG1hbmFnZXJzIHdoaWNoIHdp\nbGwgYmVjb21lCiAgICAgKiB0cmFuc2FjdGlvbmFsIHVwb24gdGhlIG5leHQg\ndHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHByb3RlY3RlZCBDb2xsZWN0aW9u\nIGdldFBlbmRpbmdUcmFuc2FjdGlvbmFsU3RhdGVzKCkgewogICAgICAgIGlm\nIChfcGVuZGluZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gQ29sbGVj\ndGlvbnMuRU1QVFlfU0VUOwogICAgICAgIHJldHVybiBuZXcgTGlua2VkSGFz\naFNldDxTdGF0ZU1hbmFnZXJJbXBsPihfcGVuZGluZyk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGNhY2hlZCBTdGF0ZU1hbmFnZXIgZm9yIHRo\nZSBpbnN0YW5jZSB0aGF0IGhhZCB0aGUgZ2l2ZW4gb2lkLgogICAgICogVGhp\ncyBtZXRob2QgbXVzdCBub3QgYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZv\nciBuZXcgaW5zdGFuY2VzLgogICAgICoKICAgICAqIEBwYXJhbSBpZCB0aGUg\naWQgcHJldmlvdXNseSB1c2VkIGJ5IHRoZSBpbnN0YW5jZQogICAgICogQHBh\ncmFtIHNtIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0aGUgaW5zdGFuY2U7IGlm\nIHRoZSBzdGF0ZQogICAgICogbWFuYWdlciBpcyB0cmFuc2llbnQsIHdlJ2xs\nIHN0b3AgbWFuYWdpbmcgdGhlIGluc3RhbmNlOwogICAgICogaWYgaXQgaGFz\nIHVwZGF0ZWQgaXRzIG9pZCwgd2UnbGwgcmUtY2FjaGUgdW5kZXIgdGhlIG5l\ndyBvaWQKICAgICAqIEBwYXJhbSBzdGF0dXMgb25lIG9mIG91ciBTVEFUVVMg\nY29uc3RhbnRzIGRlc2NyaWJpbmcgd2h5IHdlJ3JlCiAgICAgKiBzZXR0aW5n\nIHRoZSBzdGF0ZSBtYW5hZ2VyCiAgICAgKi8KICAgIHZvaWQgc2V0U3RhdGVN\nYW5hZ2VyKE9iamVjdCBpZCwgU3RhdGVNYW5hZ2VySW1wbCBzbSwgaW50IHN0\nYXR1cykgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICAgICAgICAgICAgY2FzZSBT\nVEFUVVNfSU5JVDoKICAgICAgICAgICAgICAgICAgICBfY2FjaGUuYWRkKHNt\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgU1RBVFVTX1RSQU5TSUVOVDoKICAgICAgICAgICAgICAgICAgICBf\nY2FjaGUucmVtb3ZlKGlkLCBzbSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIFNUQVRVU19PSURfQVNTSUdOOgog\nICAgICAgICAgICAgICAgICAgIGFzc2lnbk9iamVjdElkKF9jYWNoZSwgaWQs\nIHNtKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgU1RBVFVTX0NPTU1JVF9ORVc6CiAgICAgICAgICAgICAgICAg\nICAgX2NhY2hlLmNvbW1pdE5ldyhpZCwgc20pOwogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogTm90aWZ5IHRoZSBicm9rZXIgdGhhdCB0aGUgZ2l2ZW4gc3RhdGUgbWFu\nYWdlciBzaG91bGQKICAgICAqIGJlIGFkZGVkIHRvIHRoZSBzZXQgb2YgaW5z\ndGFuY2VzIGludm9sdmVkIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uLgog\nICAgICovCiAgICB2b2lkIGFkZFRvVHJhbnNhY3Rpb24oU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgIC8vIHdlIG9ubHkgYWRkIGNsZWFuIGluc3Rh\nbmNlcyBub3c7IGRpcnR5IGluc3RhbmNlcyBhcmUgYWRkZWQgaW4KICAgICAg\nICAvLyB0aGUgc2V0RGlydHkgY2FsbGJhY2sKICAgICAgICBpZiAoc20uaXNE\naXJ0eSgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9u\nYWxPYmplY3RzKCkpCiAgICAgICAgICAgICAgICBfdHJhbnNDYWNoZSA9IG5l\ndyBUcmFuc2FjdGlvbmFsQ2FjaGUoX29yZGVyRGlydHkpOwogICAgICAgICAg\nICBfdHJhbnNDYWNoZS5hZGRDbGVhbihzbSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIHRo\nYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSBy\nZW1vdmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4g\ndGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgcmVt\nb3ZlRnJvbVRyYW5zYWN0aW9uKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF90\ncmFuc0NhY2hlICE9IG51bGwpCiAgICAgICAgICAgICAgICAvLyBpbnRlbnRp\nb25hbCBkaXJlY3QgYWNjZXNzOyB3ZSBkb24ndCB3YW50IHRvIHJlY29tcHV0\nZQogICAgICAgICAgICAgICAgLy8gZGlydGluZXNzIHdoaWxlIHJlbW92aW5n\nIGluc3RhbmNlcyBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgICAgICAgICAg\nICAgX3RyYW5zQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9k\nZXJlZkNhY2hlICE9IG51bGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAg\nICAgICAgICAgICAgX2RlcmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUgZ2l2\nZW4gaW5zdGFuY2UgaGFzIGJlZW4gZGlydGllZC4gVGhpcwogICAgICogbm90\naWZpY2F0aW9uIGlzIGdpdmVuIHdoZW4gYW4gb2JqZWN0IGZpcnN0IHRyYW5z\naXRpb25zIHRvIGEgZGlydHkgc3RhdGUsCiAgICAgKiBhbmQgZXZlcnkgdGlt\nZSB0aGUgb2JqZWN0IGlzIG1vZGlmaWVkIGJ5IHRoZSB1c2VyIHRoZXJlYWZ0\nZXIuCiAgICAgKi8KICAgIHZvaWQgc2V0RGlydHkoU3RhdGVNYW5hZ2VySW1w\nbCBzbSwgYm9vbGVhbiBmaXJzdERpcnR5KSB7CiAgICAgICAgaWYgKHNtLmlz\nUGVyc2lzdGVudCgpKQogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVT\nSF9SRVFVSVJFRDsKCiAgICAgICAgaWYgKF9zYXZlcG9pbnRzICE9IG51bGwg\nJiYgIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBpZiAo\nX3NhdmVwb2ludENhY2hlID09IG51bGwpCiAgICAgICAgICAgICAgICBfc2F2\nZXBvaW50Q2FjaGUgPSBuZXcgSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPigp\nOwogICAgICAgICAgICBfc2F2ZXBvaW50Q2FjaGUuYWRkKHNtKTsKICAgICAg\nICB9CgogICAgICAgIGlmIChmaXJzdERpcnR5ICYmIHNtLmlzVHJhbnNhY3Rp\nb25hbCgpKSB7CiAgICAgICAgICAgIGxvY2soKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIC8vIGNhY2hlIGRpcnR5IGluc3RhbmNlCiAg\nICAgICAgICAgICAgICBpZiAoIWhhc1RyYW5zYWN0aW9uYWxPYmplY3RzKCkp\nCiAgICAgICAgICAgICAgICAgICAgX3RyYW5zQ2FjaGUgPSBuZXcgVHJhbnNh\nY3Rpb25hbENhY2hlKF9vcmRlckRpcnR5KTsKICAgICAgICAgICAgICAgIF90\ncmFuc0NhY2hlLmFkZERpcnR5KHNtKTsKCiAgICAgICAgICAgICAgICAvLyBh\nbHNvIHJlY29yZCB0aGF0IHRoZSBjbGFzcyBpcyBkaXJ0eQogICAgICAgICAg\nICAgICAgaWYgKHNtLmlzTmV3KCkpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoX3BlcnNpc3RlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAg\nICAgICAgX3BlcnNpc3RlZENsc3MgPSBuZXcgSGFzaFNldDxDbGFzczw/Pj4o\nKTsKICAgICAgICAgICAgICAgICAgICBfcGVyc2lzdGVkQ2xzcy5hZGQoc20u\nZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBlKCkpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIGlmIChzbS5pc0RlbGV0ZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChfZGVsZXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzID0gbmV3IEhhc2hTZXQ8Q2xh\nc3M8Pz4+KCk7CiAgICAgICAgICAgICAgICAgICAgX2RlbGV0ZWRDbHNzLmFk\nZChzbS5nZXRNZXRhRGF0YSgpLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChf\ndXBkYXRlZENsc3MgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAg\nX3VwZGF0ZWRDbHNzID0gbmV3IEhhc2hTZXQ8Q2xhc3M8Pz4+KCk7CiAgICAg\nICAgICAgICAgICAgICAgX3VwZGF0ZWRDbHNzLmFkZChzbS5nZXRNZXRhRGF0\nYSgpLmdldERlc2NyaWJlZFR5cGUoKSk7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgLy8gaWYgdHJhY2tpbmcgY2hhbmdlcyBhbmQgdGhp\ncyBpbnN0YW5jZSB3YXNuJ3QgYWxyZWFkeSBkaXJ0eSwKICAgICAgICAgICAg\nICAgIC8vIGFkZCB0byBjaGFuZ2VkIHNldDsgd2UgdXNlIHRoaXMgZm9yIGRl\ndGVjdGluZyBpbnN0YW5jZXMgdGhhdAogICAgICAgICAgICAgICAgLy8gZW50\nZXIgdGhlIHRyYW5zYWN0aW9uIGR1cmluZyBwcmUgc3RvcmUKICAgICAgICAg\nICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVTVE9SSU5HKSAhPSAwKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKF90cmFuc0FkZGl0aW9ucyA9PSBu\ndWxsKQogICAgICAgICAgICAgICAgICAgICAgICBfdHJhbnNBZGRpdGlvbnMg\nPSBuZXcgSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPigpOwogICAgICAgICAg\nICAgICAgICAgIF90cmFuc0FkZGl0aW9ucy5hZGQoc20pOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBOb3RpZnkgdGhlIGJyb2tlciB0aGF0IHRoZSBnaXZl\nbiBzdGF0ZSBtYW5hZ2VyIHNob3VsZAogICAgICogYmUgYWRkZWQgdG8gdGhl\nIHNldCBvZiBpbnN0YW5jZXMgdGhhdCB3aWxsIGJlY29tZSB0cmFuc2FjdGlv\nbmFsCiAgICAgKiBvbiB0aGUgbmV4dCB0cmFuc2FjdGlvbgogICAgICovCiAg\nICB2b2lkIGFkZFRvUGVuZGluZ1RyYW5zYWN0aW9uKFN0YXRlTWFuYWdlcklt\ncGwgc20pIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKF9wZW5kaW5nID09IG51bGwpCiAgICAgICAgICAgICAgICBf\ncGVuZGluZyA9IG5ldyBIYXNoU2V0PFN0YXRlTWFuYWdlckltcGw+KCk7CiAg\nICAgICAgICAgIF9wZW5kaW5nLmFkZChzbSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogTm90aWZ5IHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyIHRo\nYXQgdGhlIGdpdmVuIHN0YXRlIG1hbmFnZXIgc2hvdWxkCiAgICAgKiBiZSBy\nZW1vdmVkIGZyb20gdGhlIHNldCBvZiBpbnN0YW5jZXMgaW52b2x2ZWQgaW4g\ndGhlIG5leHQgdHJhbnNhY3Rpb24uCiAgICAgKi8KICAgIHZvaWQgcmVtb3Zl\nRnJvbVBlbmRpbmdUcmFuc2FjdGlvbihTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChfcGVuZGluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3BlbmRpbmcu\ncmVtb3ZlKHNtKTsKICAgICAgICAgICAgaWYgKF9kZXJlZkNhY2hlICE9IG51\nbGwgJiYgIXNtLmlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAgX2Rl\ncmVmQ2FjaGUucmVtb3ZlKHNtKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgYSBkZXJlZmVyZW5jZWQgZGVwZW5kZW50IG9iamVjdCB0byB0\naGUgcGVyc2lzdGVuY2UgbWFuYWdlcidzIGNhY2hlLgogICAgICogT24gZmx1\nc2gsIHRoZXNlIG9iamVjdHMgd2lsbCBiZSBkZWxldGVkLgogICAgICovCiAg\nICB2b2lkIGFkZERlcmVmZXJlbmNlZERlcGVuZGVudChTdGF0ZU1hbmFnZXJJ\nbXBsIHNtKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIC8vIGlmIHdlJ3JlIGluIHRoZSBtaWRkbGUgb2YgZmx1c2ggYW5k\nIGludHJvZHVjaW5nIG1vcmUgZGVyZWZzCiAgICAgICAgICAgIC8vIHZpYSBp\nbnN0YW5jZSBjYWxsYmFja3MsIGFkZCB0aGVtIHRvIHRoZSBzcGVjaWFsIGFk\nZGl0aW9ucyBzZXQKICAgICAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0RF\nUkVGREVMRVRJTkcpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmIChfZGVy\nZWZBZGRpdGlvbnMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfZGVy\nZWZBZGRpdGlvbnMgPSBuZXcgSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPigp\nOwogICAgICAgICAgICAgICAgX2RlcmVmQWRkaXRpb25zLmFkZChzbSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoX2RlcmVm\nQ2FjaGUgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfZGVyZWZDYWNo\nZSA9IG5ldyBIYXNoU2V0PFN0YXRlTWFuYWdlckltcGw+KCk7CiAgICAgICAg\nICAgICAgICBfZGVyZWZDYWNoZS5hZGQoc20pOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhl\nIGdpdmVuIHByZXZpb3VzbHkgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmpl\nY3QgZnJvbSB0aGUKICAgICAqIGNhY2hlLiBJdCBpcyBub3cgcmVmZXJlbmNl\nZC4KICAgICAqLwogICAgdm9pZCByZW1vdmVEZXJlZmVyZW5jZWREZXBlbmRl\nbnQoU3RhdGVNYW5hZ2VySW1wbCBzbSkgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIHJlbW92ZWQgPSBmYWxz\nZTsKICAgICAgICAgICAgaWYgKF9kZXJlZkFkZGl0aW9ucyAhPSBudWxsKQog\nICAgICAgICAgICAgICAgcmVtb3ZlZCA9IF9kZXJlZkFkZGl0aW9ucy5yZW1v\ndmUoc20pOwogICAgICAgICAgICBpZiAoIXJlbW92ZWQgJiYgKF9kZXJlZkNh\nY2hlID09IG51bGwgfHwgIV9kZXJlZkNhY2hlLnJlbW92ZShzbSkpKQogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihf\nbG9jLmdldCgibm90LWRlcmVmZWQiLAogICAgICAgICAgICAgICAgICAgIEV4\nY2VwdGlvbnMudG9TdHJpbmcoc20uZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSku\nCiAgICAgICAgICAgICAgICAgICAgc2V0RmFpbGVkT2JqZWN0KHNtLmdldE1h\nbmFnZWRJbnN0YW5jZSgpKS4KICAgICAgICAgICAgICAgICAgICBzZXRGYXRh\nbCh0cnVlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGlydHlU\neXBlKENsYXNzIGNscykgewogICAgICAgIGlmIChjbHMgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuOwoKICAgICAgICBiZWdpbk9wZXJhdGlvbihmYWxz\nZSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF91cGRhdGVkQ2xz\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgX3VwZGF0ZWRDbHNzID0gbmV3\nIEhhc2hTZXQ8Q2xhc3M8Pz4+KCk7CiAgICAgICAgICAgIF91cGRhdGVkQ2xz\ncy5hZGQoY2xzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBl\nbmRPcGVyYXRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIENv\nbGxlY3Rpb24gZ2V0UGVyc2lzdGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF9w\nZXJzaXN0ZWRDbHNzID09IG51bGwgfHwgX3BlcnNpc3RlZENsc3MuaXNFbXB0\neSgpKQogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlfU0VU\nOwogICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVDb2xs\nZWN0aW9uKF9wZXJzaXN0ZWRDbHNzKTsKICAgIH0KCiAgICBwdWJsaWMgQ29s\nbGVjdGlvbiBnZXRVcGRhdGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF91cGRh\ndGVkQ2xzcyA9PSBudWxsIHx8IF91cGRhdGVkQ2xzcy5pc0VtcHR5KCkpCiAg\nICAgICAgICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAg\nICAgcmV0dXJuIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24o\nX3VwZGF0ZWRDbHNzKTsKICAgIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbiBn\nZXREZWxldGVkVHlwZXMoKSB7CiAgICAgICAgaWYgKF9kZWxldGVkQ2xzcyA9\nPSBudWxsIHx8IF9kZWxldGVkQ2xzcy5pc0VtcHR5KCkpCiAgICAgICAgICAg\nIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgcmV0dXJu\nIENvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUNvbGxlY3Rpb24oX2RlbGV0ZWRD\nbHNzKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLwogICAgLy8gQ2xvc2luZwog\nICAgLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgp\nIHsKICAgICAgICByZXR1cm4gX2Nsb3NlZDsKICAgIH0KCiAgICBwdWJsaWMg\nYm9vbGVhbiBpc0Nsb3NlSW52b2tlZCgpIHsKICAgICAgICByZXR1cm4gX2Ns\nb3NlZCB8fCAoX2ZsYWdzICYgRkxBR19DTE9TRV9JTlZPS0VEKSAhPSAwOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGJlZ2lu\nT3BlcmF0aW9uKGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyB0aHJvdyBhbiBleGNlcHRpb24gaWYgY2xvc2luZyBpbiBhbiBhY3RpdmUg\nbG9jYWwgdHJhbnMKICAgICAgICAgICAgaWYgKCFfbWFuYWdlZCAmJiAoX2Zs\nYWdzICYgRkxBR19BQ1RJVkUpICE9IDApCiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJhY3RpdmUi\nKSk7CgogICAgICAgICAgICAvLyBvbmx5IGNsb3NlIGlmIG5vdCBhY3RpdmU7\nIGlmIGFjdGl2ZSBtYW5hZ2VkIHRyYW5zIHdhaXQKICAgICAgICAgICAgLy8g\nZm9yIGNvbXBsZXRpb24KICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfQ0xP\nU0VfSU5WT0tFRDsKCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDApCiAgICAgICAgICAgICAgICBmcmVlKCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgZW5kT3BlcmF0aW9uKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogRnJlZSB0aGUgcmVzb3VyY2Vz\nIHVzZWQgYnkgdGhpcyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICovCiAg\nICBwcm90ZWN0ZWQgdm9pZCBmcmVlKCkgewogICAgICAgIFJ1bnRpbWVFeGNl\ncHRpb24gZXJyID0gbnVsbDsKICAgICAgICBpZiAoKF9hdXRvRGV0YWNoICYg\nREVUQUNIX0NMT1NFKSAhPSAwKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBkZXRhY2hBbGxJbnRlcm5hbChfY2FsbCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAg\nICAgICAgIGVyciA9IHJlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBfc3luYyA9IG51bGw7CiAgICAgICAgX3VzZXJPYmplY3RzID0gbnVs\nbDsKICAgICAgICBfY2FjaGUuY2xlYXIoKTsKICAgICAgICBfdHJhbnNDYWNo\nZSA9IG51bGw7CiAgICAgICAgX3BlcnNpc3RlZENsc3MgPSBudWxsOwogICAg\nICAgIF91cGRhdGVkQ2xzcyA9IG51bGw7CiAgICAgICAgX2RlbGV0ZWRDbHNz\nID0gbnVsbDsKICAgICAgICBfZGVyZWZDYWNoZSA9IG51bGw7CiAgICAgICAg\nX3BlbmRpbmcgPSBudWxsOwogICAgICAgIF9sb2FkZXIgPSBudWxsOwogICAg\nICAgIF90cmFuc0V2ZW50TWFuYWdlciA9IG51bGw7CiAgICAgICAgX2xpZmVF\ndmVudE1hbmFnZXIgPSBudWxsOwoKICAgICAgICBPcGVuSlBBU2F2ZXBvaW50\nIHNhdmU7CiAgICAgICAgd2hpbGUgKF9zYXZlcG9pbnRzICE9IG51bGwgJiYg\nIV9zYXZlcG9pbnRzLmlzRW1wdHkoKSkgewogICAgICAgICAgICBzYXZlID0K\nICAgICAgICAgICAgICAgIChPcGVuSlBBU2F2ZXBvaW50KSBfc2F2ZXBvaW50\ncy5yZW1vdmUoX3NhdmVwb2ludHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAg\nIHNhdmUucmVsZWFzZShmYWxzZSk7CiAgICAgICAgfQogICAgICAgIF9zYXZl\ncG9pbnRzID0gbnVsbDsKICAgICAgICBfc2F2ZXBvaW50Q2FjaGUgPSBudWxs\nOwoKICAgICAgICBpZiAoX3F1ZXJpZXMgIT0gbnVsbCkgewogICAgICAgICAg\nICBmb3IgKEl0ZXJhdG9yPD8+IGl0ciA9IF9xdWVyaWVzLml0ZXJhdG9yKCk7\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgICgoUXVlcnkpIGl0ci5uZXh0KCkpLmNsb3NlUmVz\nb3VyY2VzKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhj\nZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgX3F1ZXJpZXMgPSBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKF9leHRlbnRzICE9IG51bGwpIHsKICAgICAgICAgICAgRXh0ZW50\nIGU7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8Pz4gaXRyID0gX2V4dGVu\ndHMuaXRlcmF0b3IoKTsgaXRyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIGUgPSAoRXh0ZW50KSBpdHIubmV4dCgpOwogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBlLmNsb3NlQWxsKCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2V4\ndGVudHMgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsgcmVsZWFz\nZUNvbm5lY3Rpb24oKTsgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiByZSkg\ne30KCiAgICAgICAgX2xtLmNsb3NlKCk7CiAgICAgICAgX3N0b3JlLmNsb3Nl\nKCk7CiAgICAgICAgX2ZsYWdzID0gMDsKICAgICAgICBfY2xvc2VkID0gdHJ1\nZTsKICAgICAgICBpZiAoX2xvZy5pc1RyYWNlRW5hYmxlZCgpKQogICAgICAg\nICAgICBfY2xvc2VkRXhjZXB0aW9uID0gbmV3IElsbGVnYWxTdGF0ZUV4Y2Vw\ndGlvbigpOwoKICAgICAgICBfZmFjdG9yeS5yZWxlYXNlQnJva2VyKHRoaXMp\nOwoKICAgICAgICBpZiAoZXJyICE9IG51bGwpCiAgICAgICAgICAgIHRocm93\nIGVycjsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBT\neW5jaHJvbml6YXRpb24KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBw\ndWJsaWMgdm9pZCBsb2NrKCkgewogICAgICAgIGlmIChfbG9jayAhPSBudWxs\nKSAKICAgICAgICAgICAgX2xvY2subG9jaygpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHVubG9jaygpIHsKICAgICAgICBpZiAoX2xvY2sgIT0gbnVsbCkK\nICAgICAgICAgICAgX2xvY2sudW5sb2NrKCk7CiAgICB9CiAgICAKICAgIC8v\nLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBTdGF0ZSBtYW5hZ2VtZW50CiAg\nICAvLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIHB1YmxpYyBPYmplY3QgbmV3\nSW5zdGFuY2UoQ2xhc3MgY2xzKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwoK\nICAgICAgICBpZiAoIWNscy5pc0ludGVyZmFjZSgpICYmIE1vZGlmaWVyLmlz\nQWJzdHJhY3QoY2xzLmdldE1vZGlmaWVycygpKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0\nCiAgICAgICAgICAgICAgICAoIm5ldy1hYnN0cmFjdCIsIGNscykuZ2V0TWVz\nc2FnZSgpKTsKCiAgICAgICAgLy8gMS41IGRvZXNuJ3QgaW5pdGlhbGl6ZSBj\nbGFzc2VzIHdpdGhvdXQgYSB0cnVlIENsYXNzLmZvck5hbWUKICAgICAgICBp\nZiAoIVBDUmVnaXN0cnkuaXNSZWdpc3RlcmVkKGNscykpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzLmdl\ndE5hbWUoKSwgdHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzQ29u\ndHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgICAg\nIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGNscykpKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKF9jb25mLmdldE1ldGFEYXRh\nUmVwb3NpdG9yeUluc3RhbmNlKCkuZ2V0TWV0YURhdGEoY2xzLAogICAgICAg\nICAgICBnZXRDbGFzc0xvYWRlcigpLCBmYWxzZSkgPT0gbnVsbCkKICAgICAg\nICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgIF9sb2MuZ2V0KCJuby1pbnRlcmZhY2UtbWV0YWRhdGEi\nLCBjbHMuZ2V0TmFtZSgpKS5nZXRNZXNzYWdlKCkpOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gUENSZWdpc3RyeS5uZXdJbnN0YW5jZShj\nbHMsIG51bGwsIGZhbHNlKTsKICAgICAgICB9IGNhdGNoIChJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24gaXNlKSB7CiAgICAgICAgICAgIElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbiBpYWUgPQogICAgICAgICAgICAgICAgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbihpc2UuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAg\nICAgaWFlLnNldFN0YWNrVHJhY2UoaXNlLmdldFN0YWNrVHJhY2UoKSk7CiAg\nICAgICAgICAgIHRocm93IGlhZTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIE9iamVjdCBnZXRPYmplY3RJZChPYmplY3Qgb2JqKSB7CiAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBsSGVscGVyLmlzTWFuYWdl\nYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4gKEltcGxIZWxwZXIudG9Q\nZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikpCiAgICAgICAgICAgICAg\nICAucGNGZXRjaE9iamVjdElkKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICB9CgogICAgcHVibGljIGludCBnZXRMb2NrTGV2ZWwoT2JqZWN0IG8pIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKG8gPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMuTE9DS19OT05FOwoKICAg\nICAgICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gZ2V0U3RhdGVNYW5hZ2Vy\nKG8pOwogICAgICAgIGlmIChzbSA9PSBudWxsKQogICAgICAgICAgICByZXR1\ncm4gTG9ja0xldmVscy5MT0NLX05PTkU7CiAgICAgICAgcmV0dXJuIGdldExv\nY2tNYW5hZ2VyKCkuZ2V0TG9ja0xldmVsKHNtKTsKICAgIH0KCiAgICBwdWJs\naWMgT2JqZWN0IGdldFZlcnNpb24oT2JqZWN0IG9iaikgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01hbmFnZWFi\nbGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVyLnRvUGVy\nc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS5wY0dldFZlcnNpb24oKTsK\nICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0RpcnR5KE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpIHsK\nICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBl\nci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsKICAgICAgICAg\nICAgcmV0dXJuIHBjLnBjSXNEaXJ0eSgpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFu\nc2FjdGlvbmFsKE9iamVjdCBvYmopIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAg\nICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2Fw\nYWJsZShvYmosIF9jb25mKSkKICAgICAgICAgICAgICAgIC5wY0lzVHJhbnNh\nY3Rpb25hbCgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1BlcnNpc3RlbnQoT2JqZWN0IG9iaikgewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBpZiAoSW1wbEhlbHBlci5pc01h\nbmFnZWFibGUob2JqKSkKICAgICAgICAgICAgcmV0dXJuIChJbXBsSGVscGVy\nLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iaiwgX2NvbmYpKS4KICAgICAgICAg\nICAgICAgICAgICBwY0lzUGVyc2lzdGVudCgpOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc05ldyhPYmplY3Qg\nb2JqKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIGlmIChJbXBs\nSGVscGVyLmlzTWFuYWdlYWJsZShvYmopKQogICAgICAgICAgICByZXR1cm4g\nKEltcGxIZWxwZXIudG9QZXJzaXN0ZW5jZUNhcGFibGUob2JqLCBfY29uZikp\nLnBjSXNOZXcoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAg\ncHVibGljIGJvb2xlYW4gaXNEZWxldGVkKE9iamVjdCBvYmopIHsKICAgICAg\nICBhc3NlcnRPcGVuKCk7CiAgICAgICAgaWYgKEltcGxIZWxwZXIuaXNNYW5h\nZ2VhYmxlKG9iaikpCiAgICAgICAgICAgIHJldHVybiAoSW1wbEhlbHBlci50\nb1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKSkucGNJc0RlbGV0ZWQo\nKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaXNEZXRhY2hlZChPYmplY3Qgb2JqKSB7CiAgICAgICAgaWYgKCEo\nSW1wbEhlbHBlci5pc01hbmFnZWFibGUob2JqKSkpCiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKCiAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIHBjID0g\nSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZShvYmosIF9jb25mKTsK\nICAgICAgICBCb29sZWFuIGRldGFjaGVkID0gcGMucGNJc0RldGFjaGVkKCk7\nCiAgICAgICAgaWYgKGRldGFjaGVkICE9IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBkZXRhY2hlZC5ib29sZWFuVmFsdWUoKTsKCiAgICAgICAgLy8gbGFz\ndCByZXNvcnQ6IGluc3RhbmNlIGlzIGRldGFjaGVkIGlmIGl0IGhhcyBhIHN0\nb3JlIHJlY29yZAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9jb25m\nLmdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCkuCiAgICAgICAgICAg\nIGdldE1ldGFEYXRhKEltcGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKHBj\nKS5nZXRDbGFzcygpLAogICAgICAgICAgICAgICAgX2xvYWRlciwgdHJ1ZSk7\nCiAgICAgICAgT2JqZWN0IG9pZCA9IEFwcGxpY2F0aW9uSWRzLmNyZWF0ZShw\nYywgbWV0YSk7CiAgICAgICAgaWYgKG9pZCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIGZpbmQob2lkLCBudWxs\nLCBFWENMVURFX0FMTCwgbnVsbCwgMCkgIT0gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgT3BlbkpQQVN0YXRlTWFuYWdlciBnZXRTdGF0ZU1hbmFnZXIoT2Jq\nZWN0IG9iaikgewogICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICByZXR1\ncm4gZ2V0U3RhdGVNYW5hZ2VySW1wbChvYmosIGZhbHNlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgc3RhdGUgbWFuYWdlciBmb3IgdGhl\nIGdpdmVuIGluc3RhbmNlLCBvciBudWxsLgogICAgICoKICAgICAqIEBwYXJh\nbSBhc3NlcnRUaGlzQ29udGV4dCBpZiB0cnVlLCB0aG93IGFuIGV4Y2VwdGlv\nbiBpZiB0aGUgZ2l2ZW4KICAgICAqIG9iamVjdCBpcyBtYW5hZ2VkIGJ5IGFu\nb3RoZXIgYnJva2VyCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1hbmFn\nZXJJbXBsIGdldFN0YXRlTWFuYWdlckltcGwoT2JqZWN0IG9iaiwKICAgICAg\nICBib29sZWFuIGFzc2VydFRoaXNDb250ZXh0KSB7CiAgICAgICAgaWYgKElt\ncGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpIHsKICAgICAgICAgICAgUGVy\nc2lzdGVuY2VDYXBhYmxlIHBjID0gSW1wbEhlbHBlci50b1BlcnNpc3RlbmNl\nQ2FwYWJsZShvYmosIF9jb25mKTsKICAgICAgICAgICAgQnJva2VySW1wbCBw\nY0Jyb2tlciA9IChCcm9rZXJJbXBsKXBjLnBjR2V0R2VuZXJpY0NvbnRleHQo\nKTsKICAgICAgICAgICAgaWYgKHBjQnJva2VyID09IHRoaXMgfHwgaXNGcm9t\nV3JpdGVCZWhpbmRDYWxsYmFjaygpKQogICAgICAgICAgICAgICAgcmV0dXJu\nIChTdGF0ZU1hbmFnZXJJbXBsKSBwYy5wY0dldFN0YXRlTWFuYWdlcigpOwog\nICAgICAgICAgICBpZiAoYXNzZXJ0VGhpc0NvbnRleHQgJiYgcGNCcm9rZXIg\nIT0gbnVsbCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0\naW9uKF9sb2MuZ2V0KCJub3QtbWFuYWdlZCIsCiAgICAgICAgICAgICAgICAg\nICAgRXhjZXB0aW9ucy50b1N0cmluZyhvYmopKSkuc2V0RmFpbGVkT2JqZWN0\nKG9iaik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoK\nICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGF0ZSBtYW5hZ2VyIGZvciB0\naGUgZ2l2ZW4gb2lkLgogICAgICoKICAgICAqIEBwYXJhbSBhbGxvd05ldyBp\nZiB0cnVlLCBvYmplY3RzIG1hZGUgcGVyc2lzdGVudCBpbiB0aGUgY3VycmVu\ndAogICAgICogdHJhbnNhY3Rpb24gd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUg\nc2VhcmNoOyBpZgogICAgICogbXVsdGlwbGUgbmV3IG9iamVjdHMgbWF0Y2gg\ndGhlIGdpdmVuIG9pZCwgaXQgaXMKICAgICAqIHVuZGVmaW5lZCB3aGljaCB3\naWxsIGJlIHJldHVybmVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBTdGF0ZU1h\nbmFnZXJJbXBsIGdldFN0YXRlTWFuYWdlckltcGxCeUlkKE9iamVjdCBvaWQs\nCiAgICAgICAgYm9vbGVhbiBhbGxvd05ldykgewogICAgICAgIHJldHVybiBf\nY2FjaGUuZ2V0QnlJZChvaWQsIGFsbG93TmV3KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJldHVybiB0aGUgZ2l2ZW4gaW5zdGFuY2UgYXMgYSB7QGxpbmsg\nUGVyc2lzdGVuY2VDYXBhYmxlfS4KICAgICAqIElmIHRoZSBpbnN0YW5jZSBp\ncyBub3QgbWFuYWdlYWJsZSB0aHJvdyB0aGUgcHJvcGVyIGV4Y2VwdGlvbi4K\nICAgICAqLwogICAgcHJvdGVjdGVkIFBlcnNpc3RlbmNlQ2FwYWJsZSBhc3Nl\ncnRQZXJzaXN0ZW5jZUNhcGFibGUoT2JqZWN0IG9iaikgewogICAgICAgIGlm\nIChvYmogPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgaWYgKEltcGxIZWxwZXIuaXNNYW5hZ2VhYmxlKG9iaikpCiAgICAgICAg\nICAgIHJldHVybiBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9i\naiwgX2NvbmYpOwoKICAgICAgICAvLyBjaGVjayBmb3IgZGlmZmVyZW50IGlu\nc3RhbmNlcyBvZiB0aGUgUGVyc2lzdGVuY2VDYXBhYmxlIGludGVyZmFjZQog\nICAgICAgIC8vIGFuZCB0aHJvdyBhIGJldHRlciBlcnJvciB0aGF0IG1lbnRp\nb25zIHRoZSBjbGFzcyBsb2FkZXJzCiAgICAgICAgQ2xhc3M8Pz5bXSBpbnRm\ncyA9IG9iai5nZXRDbGFzcygpLmdldEludGVyZmFjZXMoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaW50ZnMgIT0gbnVsbCAmJiBpIDwgaW50ZnMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGludGZzW2ldLmdldE5hbWUo\nKS5lcXVhbHMoUGVyc2lzdGVuY2VDYXBhYmxlLmNsYXNzLmdldE5hbWUoKSkp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJwYy1sb2FkZXItZGlmZmVyZW50IiwKICAgICAgICAgICAgICAg\nICAgICBFeGNlcHRpb25zLnRvU3RyaW5nKG9iaiksCiAgICAgICAgICAgICAg\nICAgICAgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAg\nICAgICAgICAgICAgICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVy\nQWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGVyc2lzdGVu\nY2VDYXBhYmxlLmNsYXNzKSksCiAgICAgICAgICAgICAgICAgICAgQWNjZXNz\nQ29udHJvbGxlci5kb1ByaXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAg\nICAgIEoyRG9Qcml2SGVscGVyLmdldENsYXNzTG9hZGVyQWN0aW9uKGludGZz\nW2ldKSkpKQogICAgICAgICAgICAgICAgICAgIC5zZXRGYWlsZWRPYmplY3Qo\nb2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90\nIGVuaGFuY2VkCiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xv\nYy5nZXQoInBjLWNhc3QiLAogICAgICAgICAgICBFeGNlcHRpb25zLnRvU3Ry\naW5nKG9iaikpKS5zZXRGYWlsZWRPYmplY3Qob2JqKTsKICAgIH0KCiAgICAv\nLy8vLy8vLy8KICAgIC8vIFV0aWxzCiAgICAvLy8vLy8vLy8KICAgIC8qKgog\nICAgICogVGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoZSBjb250ZXh0IGlzIGNs\nb3NlZC4gIFRoZSBleGFjdCBtZXNzYWdlIGFuZAogICAgICogY29udGVudCBv\nZiB0aGUgZXhjZXB0aW9uIHZhcmllcyB3aGV0aGVyIFRSQUNFIGlzIGVuYWJs\nZWQgb3Igbm90LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVu\nKCkgewogICAgICAgIGlmIChfY2xvc2VkKSB7CiAgICAgICAgICAgIGlmIChf\nY2xvc2VkRXhjZXB0aW9uID09IG51bGwpICAvLyBUUkFDRSBub3QgZW5hYmxl\nZAogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2Vw\ndGlvbihfbG9jLmdldCgiY2xvc2VkLW5vdHJhY2UiKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgLnNldEZhdGFsKHRydWUpOwogICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgIE9wZW5KUEFFeGNlcHRpb24gZSA9IG5ldyBJ\nbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgX2xv\nYy5nZXQoImNsb3NlZCIpLCBfY2xvc2VkRXhjZXB0aW9uKS5zZXRGYXRhbCh0\ncnVlKTsKICAgICAgICAgICAgICAgIGUuc2V0Q2F1c2UoX2Nsb3NlZEV4Y2Vw\ndGlvbik7CiAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydEFjdGl2\nZVRyYW5zYWN0aW9uKCkgewogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19B\nQ1RJVkUpID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0\naW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZlIikpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhyb3cgZXhjZXB0aW9uIGlmIGEgdHJhbnNhY3Rp\nb24tcmVsYXRlZCBvcGVyYXRpb24gaXMgYXR0ZW1wdGVkIGFuZAogICAgICog\nbm8gdHJhbnNhY3Rpb24gaXMgYWN0aXZlLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgYXNzZXJ0VHJhbnNhY3Rpb25PcGVyYXRpb24oKSB7CiAgICAgICAg\naWYgKChfZmxhZ3MgJiBGTEFHX0FDVElWRSkgPT0gMCkKICAgICAgICAgICAg\ndGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgibm90\nLWFjdGl2ZSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnROb250\ncmFuc2FjdGlvbmFsUmVhZCgpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSA9PSAwICYmICFfbm9udHJhbnNSZWFkKQogICAgICAgICAg\nICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJu\nb24tdHJhbnMtcmVhZCIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3Nl\ncnRXcml0ZU9wZXJhdGlvbigpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZM\nQUdfQUNUSVZFKSA9PSAwICYmICghX25vbnRyYW5zV3JpdGUKICAgICAgICAg\nICAgfHwgKF9hdXRvRGV0YWNoICYgREVUQUNIX05PTlRYUkVBRCkgIT0gMCkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBOb1RyYW5zYWN0aW9uRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJ3cml0ZS1vcGVyYXRpb24iKSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gYW4gb2JqZWN0IG5vdCBmb3VuZCBleGNlcHRpb24g\nY29udGFpbmluZyBuZXN0ZWQgZXhjZXB0aW9ucwogICAgICogZm9yIGFsbCBv\nZiB0aGUgZ2l2ZW4gZmFpbGVkIG9iamVjdHMuCiAgICAgKi8KICAgIHByaXZh\ndGUgc3RhdGljIE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uIG5ld09iamVjdE5v\ndEZvdW5kRXhjZXB0aW9uCiAgICAgICAgKENvbGxlY3Rpb24gZmFpbGVkKSB7\nCiAgICAgICAgVGhyb3dhYmxlW10gdCA9IG5ldyBUaHJvd2FibGVbZmFpbGVk\nLnNpemUoKV07CiAgICAgICAgaW50IGlkeCA9IDA7CiAgICAgICAgZm9yIChJ\ndGVyYXRvcjw/PiBpdHIgPSBmYWlsZWQuaXRlcmF0b3IoKTsgaXRyLmhhc05l\neHQoKTsgaWR4KyspCiAgICAgICAgICAgIHRbaWR4XSA9IG5ldyBPYmplY3RO\nb3RGb3VuZEV4Y2VwdGlvbihpdHIubmV4dCgpKTsKICAgICAgICByZXR1cm4g\nbmV3IE9iamVjdE5vdEZvdW5kRXhjZXB0aW9uKGZhaWxlZCwgdCk7CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8v\nIEZpbmRDYWxsYmFja3MgaW1wbGVtZW50YXRpb24KICAgIC8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgcHVibGljIE9iamVjdCBwcm9j\nZXNzQXJndW1lbnQoT2JqZWN0IG9pZCkgewogICAgICAgIHJldHVybiBvaWQ7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCBwcm9jZXNzUmV0dXJuKE9iamVj\ndCBvaWQsIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20pIHsKICAgICAgICByZXR1\ncm4gKHNtID09IG51bGwpID8gbnVsbCA6IHNtLmdldE1hbmFnZWRJbnN0YW5j\nZSgpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZU9iamVjdChPYmpl\nY3RPdXRwdXRTdHJlYW0gb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKGlzQWN0aXZlKCkpIHsKICAgICAgICAgICAg\nICAgIGlmICghZ2V0T3B0aW1pc3RpYygpKQogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9sb2MuZ2V0KCJjYW50LXNlcmlhbGl6ZS1wZXNzaW1p\nc3RpYy1icm9rZXIiKSk7CiAgICAgICAgICAgICAgICBpZiAoaGFzRmx1c2hl\nZCgpKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIF9sb2MuZ2V0\nKCJjYW50LXNlcmlhbGl6ZS1mbHVzaGVkLWJyb2tlciIpKTsKICAgICAgICAg\nICAgICAgIGlmIChoYXNDb25uZWN0aW9uKCkpCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAg\nICAgICAgICAgICAgICAgX2xvYy5nZXQoImNhbnQtc2VyaWFsaXplLWNvbm5l\nY3RlZC1icm9rZXIiKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBfaXNTZXJpYWxpemluZyA9IHRydWU7CiAg\nICAgICAgICAgICAgICBvdXQud3JpdGVPYmplY3QoX2ZhY3RvcnkuZ2V0UG9v\nbEtleSgpKTsKICAgICAgICAgICAgICAgIG91dC5kZWZhdWx0V3JpdGVPYmpl\nY3QoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAg\nIF9pc1NlcmlhbGl6aW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlYWRPYmplY3QoT2JqZWN0SW5w\ndXRTdHJlYW0gaW4pCiAgICAgICAgdGhyb3dzIENsYXNzTm90Rm91bmRFeGNl\ncHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3QgZmFjdG9yeUtl\neSA9IGluLnJlYWRPYmplY3QoKTsKICAgICAgICBBYnN0cmFjdEJyb2tlckZh\nY3RvcnkgZmFjdG9yeSA9CiAgICAgICAgICAgIEFic3RyYWN0QnJva2VyRmFj\ndG9yeS5nZXRQb29sZWRGYWN0b3J5Rm9yS2V5KGZhY3RvcnlLZXkpOwoKICAg\nICAgICAvLyB0aGlzIG5lZWRzIHRvIGhhcHBlbiBiZWZvcmUgZGVmYXVsdFJl\nYWRPYmplY3Qgc28gdGhhdCBpdCdzCiAgICAgICAgLy8gYXZhaWxhYmxlIGZv\nciBjYWxscyB0byBicm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpIGR1cmluZwog\nICAgICAgIC8vIFN0YXRlTWFuYWdlciBkZXNlcmlhbGl6YXRpb24KICAgICAg\nICBfY29uZiA9IGZhY3RvcnkuZ2V0Q29uZmlndXJhdGlvbigpOwogICAgICAg\nIAogICAgICAgIGluLmRlZmF1bHRSZWFkT2JqZWN0KCk7CiAgICAgICAgZmFj\ndG9yeS5pbml0aWFsaXplQnJva2VyKF9tYW5hZ2VkLCBfY29ublJldGFpbk1v\nZGUsIHRoaXMsIHRydWUpOwoKICAgICAgICAvLyByZS1pbml0aWFsaXplIHRo\nZSBsb2NrIGlmIG5lZWRlZC4KICAgICAgICBzZXRNdWx0aXRocmVhZGVkKF9t\ndWx0aXRocmVhZGVkKTsKCiAgICAgICAgaWYgKGlzQWN0aXZlKCkgJiYgX3J1\nbnRpbWUgaW5zdGFuY2VvZiBMb2NhbE1hbmFnZWRSdW50aW1lKQogICAgICAg\nICAgICAoKExvY2FsTWFuYWdlZFJ1bnRpbWUpIF9ydW50aW1lKS5iZWdpbigp\nOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBvciBub3QgdGhpcyBi\ncm9rZXIgaXMgaW4gdGhlIG1pZHN0IG9mIGJlaW5nIHNlcmlhbGl6ZWQuCiAg\nICAgKgogICAgICogQHNpbmNlIDEuMS4wIAogICAgICovCiAgICBib29sZWFu\nIGlzU2VyaWFsaXppbmcoKSB7CiAgICAgICAgcmV0dXJuIF9pc1NlcmlhbGl6\naW5nOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNhY3Rpb25hbCBjYWNo\nZSB0aGF0IGhvbGRzIHNvZnQgcmVmcyB0byBjbGVhbiBpbnN0YW5jZXMuCiAg\nICAgKi8KICAgIHN0YXRpYyBjbGFzcyBUcmFuc2FjdGlvbmFsQ2FjaGUKICAg\nICAgICBpbXBsZW1lbnRzIFNldCwgU2VyaWFsaXphYmxlIHsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBib29sZWFuIF9vcmRlckRpcnR5OwogICAgICAgIHBy\naXZhdGUgU2V0PFN0YXRlTWFuYWdlckltcGw+IF9kaXJ0eSA9IG51bGw7CiAg\nICAgICAgcHJpdmF0ZSBTZXQ8U3RhdGVNYW5hZ2VySW1wbD4gX2NsZWFuID0g\nbnVsbDsKCiAgICAgICAgcHVibGljIFRyYW5zYWN0aW9uYWxDYWNoZShib29s\nZWFuIG9yZGVyRGlydHkpIHsKICAgICAgICAgICAgX29yZGVyRGlydHkgPSBv\ncmRlckRpcnR5OwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nUmV0dXJuIGEgY29weSBvZiBhbGwgdHJhbnNhY3Rpb25hbCBzdGF0ZSBtYW5h\nZ2Vycy4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBj\nb3B5KCkgewogICAgICAgICAgICBpZiAoaXNFbXB0eSgpKQogICAgICAgICAg\nICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX1NFVDsKCiAgICAgICAg\nICAgIC8vIHNpemUgbWF5IG5vdCBiZSBlbnRpcmVseSBhY2N1cmF0ZSBkdWUg\ndG8gcmVmcyBleHBpcmluZywgc28KICAgICAgICAgICAgLy8gbWFudWFsbHkg\nY29weSBlYWNoIG9iamVjdDsgZG9lc24ndCBtYXR0ZXIgdGhpcyB3YXkgaWYg\nc2l6ZSB0b28KICAgICAgICAgICAgLy8gYmlnIGJ5IHNvbWUKICAgICAgICAg\nICAgU2V0IGNvcHkgPSBuZXcgTGlua2VkSGFzaFNldChzaXplKCkpOwogICAg\nICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yPFN0YXRlTWFuYWdlckltcGw+IGl0ciA9IF9kaXJ0eS5p\ndGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAgICAgICAgICAgICAg\nICBjb3B5LmFkZChpdHIubmV4dCgpKTsKICAgICAgICAgICAgaWYgKF9jbGVh\nbiAhPSBudWxsKQogICAgICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxTdGF0\nZU1hbmFnZXJJbXBsPiBpdHIgPSBfY2xlYW4uaXRlcmF0b3IoKTsgaXRyLmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICAgICAgY29weS5hZGQoaXRyLm5l\neHQoKSk7CiAgICAgICAgICAgIHJldHVybiBjb3B5OwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgY29weSBvZiBhbGwgZGly\ndHkgc3RhdGUgbWFuYWdlcnMuCiAgICAgICAgICovCiAgICAgICAgcHVibGlj\nIENvbGxlY3Rpb24gY29weURpcnR5KCkgewogICAgICAgICAgICBpZiAoX2Rp\ncnR5ID09IG51bGwgfHwgX2RpcnR5LmlzRW1wdHkoKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBDb2xsZWN0aW9ucy5FTVBUWV9TRVQ7CiAgICAgICAgICAg\nIHJldHVybiBuZXcgTGlua2VkSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBsPihf\nZGlydHkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVHJh\nbnNmZXIgdGhlIGdpdmVuIGluc3RhbmNlIGZyb20gdGhlIGRpcnR5IGNhY2hl\nIHRvIHRoZSBjbGVhbiBjYWNoZS4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgdm9pZCBmbHVzaGVkKFN0YXRlTWFuYWdlckltcGwgc20pIHsKICAgICAg\nICAgICAgaWYgKHNtLmlzRGlydHkoKSAmJiBfZGlydHkgIT0gbnVsbCAmJiBf\nZGlydHkucmVtb3ZlKHNtKSkKICAgICAgICAgICAgICAgIGFkZENsZWFuSW50\nZXJuYWwoc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICog\nQWRkIHRoZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgY2xlYW4gY2FjaGUuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkQ2xlYW4oU3RhdGVN\nYW5hZ2VySW1wbCBzbSkgewogICAgICAgICAgICBpZiAoYWRkQ2xlYW5JbnRl\ncm5hbChzbSkgJiYgX2RpcnR5ICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nZGlydHkucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBhZGRDbGVhbkludGVybmFsKFN0YXRlTWFuYWdlckltcGwgc20p\nIHsKICAgICAgICAgICAgaWYgKF9jbGVhbiA9PSBudWxsKQogICAgICAgICAg\nICAgICAgX2NsZWFuID0gbmV3IFJlZmVyZW5jZUhhc2hTZXQoUmVmZXJlbmNl\nSGFzaFNldC5TT0ZUKTsKICAgICAgICAgICAgcmV0dXJuIF9jbGVhbi5hZGQo\nc20pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQWRkIHRo\nZSBnaXZlbiBpbnN0YW5jZSB0byB0aGUgZGlydHkgY2FjaGUuCiAgICAgICAg\nICovCiAgICAgICAgcHVibGljIHZvaWQgYWRkRGlydHkoU3RhdGVNYW5hZ2Vy\nSW1wbCBzbSkgewogICAgICAgICAgICBpZiAoX2RpcnR5ID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGlmIChfb3JkZXJEaXJ0eSkKICAgICAgICAgICAg\nICAgICAgICBfZGlydHkgPSBNYXBCYWNrZWRTZXQuZGVjb3JhdGUobmV3IExp\nbmtlZE1hcCgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBfZGlydHkgPSBuZXcgSGFzaFNldDxTdGF0ZU1hbmFnZXJJbXBs\nPigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfZGlydHkuYWRk\nKHNtKSkKICAgICAgICAgICAgICAgIHJlbW92ZUNsZWFuSW50ZXJuYWwoc20p\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlIHRo\nZSBnaXZlbiBpbnN0YW5jZSBmcm9tIHRoZSBjYWNoZS4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmUoU3RhdGVNYW5hZ2VySW1w\nbCBzbSkgewogICAgICAgICAgICByZXR1cm4gcmVtb3ZlQ2xlYW5JbnRlcm5h\nbChzbSkKICAgICAgICAgICAgICAgIHx8IChfZGlydHkgIT0gbnVsbCAmJiBf\nZGlydHkucmVtb3ZlKHNtKSk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRl\nIGJvb2xlYW4gcmVtb3ZlQ2xlYW5JbnRlcm5hbChTdGF0ZU1hbmFnZXJJbXBs\nIHNtKSB7CiAgICAgICAgICAgIHJldHVybiBfY2xlYW4gIT0gbnVsbCAmJiBf\nY2xlYW4ucmVtb3ZlKHNtKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJ\ndGVyYXRvciBpdGVyYXRvcigpIHsKICAgICAgICAgICAgSXRlcmF0b3JDaGFp\nbiBjaGFpbiA9IG5ldyBJdGVyYXRvckNoYWluKCk7CiAgICAgICAgICAgIGlm\nIChfZGlydHkgIT0gbnVsbCAmJiAhX2RpcnR5LmlzRW1wdHkoKSkKICAgICAg\nICAgICAgICAgIGNoYWluLmFkZEl0ZXJhdG9yKF9kaXJ0eS5pdGVyYXRvcigp\nKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAhPSBudWxsICYmICFfY2xlYW4u\naXNFbXB0eSgpKQogICAgICAgICAgICAgICAgY2hhaW4uYWRkSXRlcmF0b3Io\nX2NsZWFuLml0ZXJhdG9yKCkpOwogICAgICAgICAgICByZXR1cm4gY2hhaW47\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhP\nYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIHJldHVybiAoX2RpcnR5ICE9IG51\nbGwgJiYgX2RpcnR5LmNvbnRhaW5zKG9iaikpCiAgICAgICAgICAgICAgICB8\nfCAoX2NsZWFuICE9IG51bGwgJiYgX2NsZWFuLmNvbnRhaW5zKG9iaikpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNBbGwo\nQ29sbGVjdGlvbiBjb2xsKSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8\nPz4gaXRyID0gY29sbC5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAg\nICAgICAgICAgICAgIGlmICghY29udGFpbnMoaXRyLm5leHQoKSkpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFy\nKCkgewogICAgICAgICAgICBpZiAoX2RpcnR5ICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBfZGlydHkgPSBudWxsOwogICAgICAgICAgICBpZiAoX2NsZWFu\nICE9IG51bGwpCiAgICAgICAgICAgICAgICBfY2xlYW4gPSBudWxsOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIChfZGlydHkgPT0gbnVsbCB8fCBfZGlydHkuaXNF\nbXB0eSgpKQogICAgICAgICAgICAgICAgJiYgKF9jbGVhbiA9PSBudWxsIHx8\nIF9jbGVhbi5pc0VtcHR5KCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGludCBzaXplKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAg\nICAgICAgIGlmIChfZGlydHkgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHNp\nemUgKz0gX2RpcnR5LnNpemUoKTsKICAgICAgICAgICAgaWYgKF9jbGVhbiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgc2l6ZSArPSBfY2xlYW4uc2l6ZSgp\nOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIGFkZChPYmplY3Qgb2JqKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKENvbGxl\nY3Rpb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIHJlbW92ZShPYmplY3Qgb2JqKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlQWxsKENv\nbGxlY3Rpb24gY29sbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBw\nb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIHJldGFpbkFsbChDb2xsZWN0aW9uIGMpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0\naW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9B\ncnJheSgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3Bl\ncmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nT2JqZWN0W10gdG9BcnJheShPYmplY3RbXSBhcnIpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5pcXVlIGlkIGZvciBz\ndGF0ZSBtYW5hZ2VycyBvZiBuZXcgZGF0YXN0b3JlIGluc3RhbmNlcyB3aXRo\nb3V0IGFzc2lnbmVkCiAgICAgKiBvYmplY3QgaWRzLgogICAgICovCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBTdGF0ZU1hbmFnZXJJZAogICAgICAgIGlt\ncGxlbWVudHMgU2VyaWFsaXphYmxlIHsKCiAgICAgICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBTdHJpbmcgU1RSSU5HX1BSRUZJWCA9ICJvcGVuanBhc206IjsK\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyBfZ2VuZXJhdG9yID0gMDsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgX2JoYXNoOwogICAgICAgIHBy\naXZhdGUgZmluYWwgbG9uZyBfaWQ7CgogICAgICAgIHB1YmxpYyBzdGF0aWMg\nU3RhdGVNYW5hZ2VySWQgbmV3SW5zdGFuY2UoQnJva2VyIGIpIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBTdGF0ZU1hbmFnZXJJZChTeXN0ZW0uaWRlbnRp\ndHlIYXNoQ29kZShiKSwgX2dlbmVyYXRvcisrKTsKICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgU3RhdGVNYW5hZ2VySWQoaW50IGJoYXNoLCBsb25nIGlk\nKSB7CiAgICAgICAgICAgIF9iaGFzaCA9IGJoYXNoOwogICAgICAgICAgICBf\naWQgPSBpZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdGF0ZU1hbmFn\nZXJJZChTdHJpbmcgc3RyKSB7CiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJz\ndHJpbmcoU1RSSU5HX1BSRUZJWC5sZW5ndGgoKSk7CiAgICAgICAgICAgIGlu\ndCBpZHggPSBzdHIuaW5kZXhPZignOicpOwogICAgICAgICAgICBfYmhhc2gg\nPSBJbnRlZ2VyLnBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMCwgaWR4KSk7CiAg\nICAgICAgICAgIF9pZCA9IExvbmcucGFyc2VMb25nKHN0ci5zdWJzdHJpbmco\naWR4ICsgMSkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvdGhlcikgewogICAgICAgICAgICBpZiAob3RoZXIg\nPT0gdGhpcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFN0YXRlTWFuYWdlcklkKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgU3Rh\ndGVNYW5hZ2VySWQgc2lkID0gKFN0YXRlTWFuYWdlcklkKSBvdGhlcjsKICAg\nICAgICAgICAgcmV0dXJuIF9iaGFzaCA9PSBzaWQuX2JoYXNoICYmIF9pZCA9\nPSBzaWQuX2lkOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGludCBoYXNo\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIChpbnQpIChfaWQgXiAoX2lk\nID4+PiAzMikpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyB0\nb1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIFNUUklOR19QUkVGSVgg\nKyBfYmhhc2ggKyAiOiIgKyBfaWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQ29sbGVjdGlvbiB0eXBlIHRoYXQgaG9sZHMgc3RhdGUgbWFu\nYWdlcnMgYnV0IHdob3NlIGludGVyZmFjZSBkZWFscwogICAgICogd2l0aCB0\naGUgY29ycmVzcG9uZGluZyBtYW5hZ2VkIG9iamVjdHMuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9u\nCiAgICAgICAgZXh0ZW5kcyBBYnN0cmFjdENvbGxlY3Rpb24gewoKICAgICAg\nICBwcml2YXRlIGZpbmFsIENvbGxlY3Rpb24gX3N0YXRlczsKCiAgICAgICAg\ncHVibGljIE1hbmFnZWRPYmplY3RDb2xsZWN0aW9uKENvbGxlY3Rpb24gc3Rh\ndGVzKSB7CiAgICAgICAgICAgIF9zdGF0ZXMgPSBzdGF0ZXM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgQ29sbGVjdGlvbiBnZXRTdGF0ZU1hbmFnZXJz\nKCkgewogICAgICAgICAgICByZXR1cm4gX3N0YXRlczsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9zdGF0ZXMuc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEl0\nZXJhdG9yIGl0ZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEl0\nZXJhdG9yKCkgewogICAgICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBJdGVy\nYXRvciBfaXRyID0gX3N0YXRlcy5pdGVyYXRvcigpOwoKICAgICAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIF9pdHIuaGFzTmV4dCgpOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIHB1YmxpYyBPYmplY3QgbmV4dCgpIHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gKChPcGVuSlBBU3RhdGVNYW5hZ2Vy\nKSBfaXRyLm5leHQoKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1h\nbmFnZWRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpIHsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBc3NpZ24gdGhlIG9iamVjdCBpZCB0byB0aGUgY2Fj\naGUuIEV4Y2VwdGlvbiB3aWxsIGJlCiAgICAgKiB0aHJvd24gaWYgdGhlIGlk\nIGFscmVhZHkgZXhpc3RzIGluIHRoZSBjYWNoZS4gCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIGFzc2lnbk9iamVjdElkKE9iamVjdCBjYWNoZSwgT2Jq\nZWN0IGlkLCAKICAgICAgICBTdGF0ZU1hbmFnZXJJbXBsIHNtKSB7CiAgICAg\nICAgKChNYW5hZ2VkQ2FjaGUpIGNhY2hlKS5hc3NpZ25PYmplY3RJZChpZCwg\nc20pOyAKICAgIH0KCiAgICAvKiogCiAgICAgKiBUaGlzIG1ldGhvZCBtYWtl\ncyBzdXJlIHdlIGRvbid0IGFscmVhZHkgaGF2ZSB0aGUgaW5zdGFuY2UgY2Fj\naGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGNoZWNrRm9yRHVwbGlj\nYXRlSWQoT2JqZWN0IGlkLCBPYmplY3Qgb2JqKSB7CiAgICAgICAgU3RhdGVN\nYW5hZ2VySW1wbCBvdGhlciA9IGdldFN0YXRlTWFuYWdlckltcGxCeUlkKGlk\nLCBmYWxzZSk7CiAgICAgICAgaWYgKG90aGVyICE9IG51bGwgJiYgIW90aGVy\nLmlzRGVsZXRlZCgpICYmICFvdGhlci5pc05ldygpKQogICAgICAgICAgICB0\naHJvdyBuZXcgT2JqZWN0RXhpc3RzRXhjZXB0aW9uKF9sb2MuZ2V0KCJjYWNo\nZS1leGlzdHMiLAogICAgICAgICAgICAgICAgb2JqLmdldENsYXNzKCkuZ2V0\nTmFtZSgpLCBpZCkpLnNldEZhaWxlZE9iamVjdChvYmopOwogICAgfQogICAg\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRDYWNoZVByZXBhcmVkUXVlcnkoKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBfY2FjaGVQcmVwYXJlZFF1ZXJ5IAogICAgICAgICAgICAgICAmJiBf\nY29uZi5nZXRRdWVyeVNRTENhY2hlSW5zdGFuY2UoKSAhPSBudWxsOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVQcmVwYXJl\nZFF1ZXJ5KGJvb2xlYW4gZmxhZykgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBfY2FjaGVQcmVwYXJlZFF1ZXJ5ID0gZmxh\nZzsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29sZWFuIGdldENh\nY2hlRmluZGVyUXVlcnkoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHJldHVybiBfY2FjaGVGaW5kZXJRdWVyeSAKICAg\nICAgICAgICAgICAgJiYgX2NvbmYuZ2V0RmluZGVyQ2FjaGVJbnN0YW5jZSgp\nICE9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCBz\nZXRDYWNoZUZpbmRlclF1ZXJ5KGJvb2xlYW4gZmxhZykgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBfY2FjaGVQcmVwYXJl\nZFF1ZXJ5ID0gZmxhZzsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBi\nb29sZWFuIGlzRnJvbVdyaXRlQmVoaW5kQ2FsbGJhY2soKSB7CiAgICAgICAg\ncmV0dXJuIF9mcm9tV3JpdGVCZWhpbmRDYWxsYmFjazsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybiB0aGUgJ0pUQScgY29ubmVjdGlvbkZhY3RvcnlO\nYW1lCiAgICAgKi8KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Q29ubmVjdGlvbkZh\nY3RvcnlOYW1lKCkgewogICAgICAgIHJldHVybiBfY29ubmVjdGlvbkZhY3Rv\ncnlOYW1lOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSAnSlRBJyBD\nb25uZWN0aW9uRmFjdG9yeU5hbWUuIElucHV0IHdpbGwgYmUgdHJpbW1lZCB0\nbyBudWxsIGJlZm9yZSBiZWluZyBzdG9yZWQuIAogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRDb25uZWN0aW9uRmFjdG9yeU5hbWUoU3RyaW5nIGNvbm5l\nY3Rpb25GYWN0b3J5TmFtZSkgewogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb25G\nYWN0b3J5TmFtZSA9IFN0cmluZ1V0aWxzLnRyaW1Ub051bGwoY29ubmVjdGlv\nbkZhY3RvcnlOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgJ05vbkpUQScgQ29ubmVjdGlvbkZhY3RvcnlOYW1lLgogICAgICovCiAg\nICBwdWJsaWMgU3RyaW5nIGdldENvbm5lY3Rpb25GYWN0b3J5Mk5hbWUoKSB7\nCiAgICAgICAgcmV0dXJuIF9jb25uZWN0aW9uRmFjdG9yeTJOYW1lOwogICAg\nfQoKICAgIC8qKgogICAgICogU2V0IHRoZSAnTm9uSlRBJyBDb25uZWN0aW9u\nRmFjdG9yeU5hbWUuIElucHV0IHdpbGwgYmUgdHJpbW1lZCB0byBudWxsIGJl\nZm9yZSBiZWluZyBzdG9yZWQuIAogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nZXRDb25uZWN0aW9uRmFjdG9yeTJOYW1lKFN0cmluZyBjb25uZWN0aW9uRmFj\ndG9yeTJOYW1lKSB7CiAgICAgICAgdGhpcy5fY29ubmVjdGlvbkZhY3Rvcnky\nTmFtZSA9IFN0cmluZ1V0aWxzLnRyaW1Ub051bGwoY29ubmVjdGlvbkZhY3Rv\ncnkyTmFtZSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJuIHRo\nZSAnSlRBJyBDb25uZWN0aW9uRmFjdG9yeSwgbG9va2luZyBpdCB1cCBmcm9t\nIEpOREkgaWYgbmVlZGVkLgogICAgICogCiAgICAgKiBAcmV0dXJuIHRoZSBK\nVEEgY29ubmVjdGlvbiBmYWN0b3J5IG9yIG51bGwgaWYgY29ubmVjdGlvbkZh\nY3RvcnlOYW1lIGlzIGJsYW5rLgogICAgICovCiAgICBwdWJsaWMgT2JqZWN0\nIGdldENvbm5lY3Rpb25GYWN0b3J5KCkgewogICAgICAgIGlmKFN0cmluZ1V0\naWxzLmlzTm90QmxhbmsoX2Nvbm5lY3Rpb25GYWN0b3J5TmFtZSkpIHsgCiAg\nICAgICAgICAgIHJldHVybiBDb25maWd1cmF0aW9ucy5sb29rdXAoX2Nvbm5l\nY3Rpb25GYWN0b3J5TmFtZSwgIm9wZW5qcGEuQ29ubmVjdGlvbkZhY3Rvcnki\nLCBfbG9nICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSAnTm9uSlRBJyBDb25uZWN0aW9uRmFjdG9yeSwg\nbG9va2luZyBpdCB1cCBmcm9tIEpOREkgaWYgbmVlZGVkLgogICAgICogCiAg\nICAgKiBAcmV0dXJuIHRoZSBOb25KVEEgY29ubmVjdGlvbiBmYWN0b3J5IG9y\nIG51bGwgaWYgY29ubmVjdGlvbkZhY3RvcnlOYW1lIGlzIGJsYW5rLgogICAg\nICovCiAgICBwdWJsaWMgT2JqZWN0IGdldENvbm5lY3Rpb25GYWN0b3J5Migp\nIHsgCiAgICAgICAgaWYoU3RyaW5nVXRpbHMuaXNOb3RCbGFuayhfY29ubmVj\ndGlvbkZhY3RvcnkyTmFtZSkpIHsgCiAgICAgICAgICAgIHJldHVybiAgQ29u\nZmlndXJhdGlvbnMubG9va3VwKF9jb25uZWN0aW9uRmFjdG9yeTJOYW1lLCAi\nb3BlbmpwYS5Db25uZWN0aW9uRmFjdG9yeTIiLCBfbG9nKTsKICAgICAgICB9\nCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

