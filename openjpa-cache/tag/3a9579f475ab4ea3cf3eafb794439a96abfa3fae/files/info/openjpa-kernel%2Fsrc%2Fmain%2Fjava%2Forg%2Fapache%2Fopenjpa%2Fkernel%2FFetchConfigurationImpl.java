{"sha":"8bea486fdd0efcb88e61444c681e47aa3b269a9d","node_id":"MDQ6QmxvYjIwNjM2NDo4YmVhNDg2ZmRkMGVmY2I4OGU2MTQ0NGM2ODFlNDdhYTNiMjY5YTlk","size":35517,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/8bea486fdd0efcb88e61444c681e47aa3b269a9d","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3Qu\nTWV0aG9kOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5FYWdlclJl\nc3VsdExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5M\naXN0UmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5TaW1wbGVSZXN1bHRMaXN0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuV2luZG93UmVzdWx0\nTGlzdDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5Mb2Nh\nbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01l\ndGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hH\ncm91cDsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0\nYURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlw\nZXM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbXBsSGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuSW50ZXJuYWxFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob1RyYW5z\nYWN0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0\naWwuVXNlckV4Y2VwdGlvbjsKCi8qKgogKiBBbGxvd3MgY29uZmlndXJhdGlv\nbiBhbmQgb3B0aW1pemF0aW9uIG9mIGhvdyBvYmplY3RzIGFyZSBsb2FkZWQg\nZnJvbQogKiB0aGUgZGF0YSBzdG9yZS4KICoKICogQHNpbmNlIDAuMy4wCiAq\nIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBhdXRob3IgUGluYWtpIFBvZGRhcgog\nKiBAbm9qYXZhZG9jCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikK\ncHVibGljIGNsYXNzIEZldGNoQ29uZmlndXJhdGlvbkltcGwKICAgIGltcGxl\nbWVudHMgRmV0Y2hDb25maWd1cmF0aW9uLCBDbG9uZWFibGUgewoKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVy\nLmZvclBhY2thZ2UoRmV0Y2hDb25maWd1cmF0aW9uSW1wbC5jbGFzcyk7CiAg\nICBwcml2YXRlIHN0YXRpYyBNYXA8U3RyaW5nLCBNZXRob2Q+IF9oaW50U2V0\ndGVycyA9IG5ldyBIYXNoTWFwPFN0cmluZywgTWV0aG9kPigpOwogICAgCiAg\nICAvKiogCiAgICAgKiBSZWdpc3RlcnMgaGludCBrZXlzIHRoYXQgaGF2ZSBh\nIGNvcnJlc3BvbmRpbmcgc2V0dGVyIG1ldGhvZC4KICAgICAqIFRoZSBoaW50\nIGtleXMgYXJlIHJlZ2lzdGVyZWQgaW4gPGNvZGU+b3BlbmpwYS5GZXRjaFBs\nYW48L2NvZGU+IGFuZCA8Y29kZT5vcGVuanBhPC9jb2RlPiBhcyBwcmVmaXgu\nCiAgICAgKiBBbHNvIHNvbWUga2V5cyBhcmUgcmVnaXN0ZXJlZCBpbiA8Y29k\nZT5qYXZheC5wZXJzaXN0ZW5jZTwvY29kZT4gbmFtZXNwYWNlLgogICAgICov\nCiAgICBzdGF0aWMgewogICAgICAgICAgICBTdHJpbmdbXSBwcmVmaXhlcyA9\nIHsib3BlbmpwYS5GZXRjaFBsYW4iLCAib3BlbmpwYSJ9OwogICAgICAgICAg\nICBDbGFzczw/PiB0YXJnZXQgPSBGZXRjaENvbmZpZ3VyYXRpb24uY2xhc3M7\nCiAgICAgICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJFeHRl\nbmRlZFBhdGhMb29rdXAiLCBib29sZWFuLmNsYXNzLCBwcmVmaXhlcyk7CiAg\nICAgICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJGZXRjaEJh\ndGNoU2l6ZSIsIGludC5jbGFzcywgcHJlZml4ZXMpOwogICAgICAgICAgICBw\nb3B1bGF0ZUhpbnRTZXR0ZXIodGFyZ2V0LCAiRmx1c2hCZWZvcmVRdWVyaWVz\nIiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAgICAgICAgIHBvcHVsYXRl\nSGludFNldHRlcih0YXJnZXQsICJMb2NrU2NvcGUiLCBpbnQuY2xhc3MsIHBy\nZWZpeGVzKTsKICAgICAgICAgICAgcG9wdWxhdGVIaW50U2V0dGVyKHRhcmdl\ndCwgIkxvY2tUaW1lb3V0IiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAg\nICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJzZXRMb2NrVGlt\nZW91dCIsICJ0aW1lb3V0IiwgaW50LmNsYXNzLCAiamF2YXgucGVyc2lzdGVu\nY2UubG9jayIpOwogICAgICAgICAgICBwb3B1bGF0ZUhpbnRTZXR0ZXIodGFy\nZ2V0LCAiTWF4RmV0Y2hEZXB0aCIsIGludC5jbGFzcywgcHJlZml4ZXMpOwog\nICAgICAgICAgICBwb3B1bGF0ZUhpbnRTZXR0ZXIodGFyZ2V0LCAiUXVlcnlU\naW1lb3V0IiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAgICAgICAgIHBv\ncHVsYXRlSGludFNldHRlcih0YXJnZXQsICJzZXRRdWVyeVRpbWVvdXQiLCAi\ndGltZW91dCIsIGludC5jbGFzcywgImphdmF4LnBlcnNpc3RlbmNlLnF1ZXJ5\nIik7CiAgICAgICAgICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJS\nZWFkTG9ja0xldmVsIiwgaW50LmNsYXNzLCBwcmVmaXhlcyk7CiAgICAgICAg\nICAgIHBvcHVsYXRlSGludFNldHRlcih0YXJnZXQsICJzZXRSZWFkTG9ja0xl\ndmVsIiwgIlJlYWRMb2NrTW9kZSIsIGludC5jbGFzcywgcHJlZml4ZXMpOwog\nICAgICAgICAgICBwb3B1bGF0ZUhpbnRTZXR0ZXIodGFyZ2V0LCAiV3JpdGVM\nb2NrTGV2ZWwiLCBpbnQuY2xhc3MsIHByZWZpeGVzKTsKICAgICAgICAgICAg\ncG9wdWxhdGVIaW50U2V0dGVyKHRhcmdldCwgInNldFdyaXRlTG9ja0xldmVs\nIiwgIldyaXRlTG9ja01vZGUiLCBpbnQuY2xhc3MsIHByZWZpeGVzKTsKICAg\nIH0KICAgIAogICAgLyoqCiAgICAgKiBQb3B1bGF0ZSBzdGF0aWMgcmVnaXN0\ncnkgb2YgaGludHMuCiAgICAgKiAgCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRo\nZSBuYW1lIG9mIHRoZSB0YXJnZXQgY2xhc3MgdGhhdCB3aWxsIHJlY2VpdmUg\ndGhpcyBoaW50LiAKICAgICAqIEBwYXJhbSBoaW50IHRoZSBzaW1wbGUgbmFt\nZSBvZiB0aGUgaGludCB3aXRob3V0IGEgcHJlZml4LiAKICAgICAqIEBwYXJh\nbSB0eXBlIHRoZSB2YWx1ZSBhcmd1bWVudCB0eXBlIG9mIHRoZSB0YXJnZXQg\nc2V0dGVyIG1ldGhvZC4gCiAgICAgKiBAcGFyYW0gcHJlZml4ZXMgdGhlIHBy\nZWZpeGVzIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHNpbXBsZSBoaW50IG5hbWUu\nIAogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIHZvaWQgcG9wdWxhdGVI\naW50U2V0dGVyKENsYXNzPD8+IHRhcmdldCwgU3RyaW5nIGhpbnQsIENsYXNz\nPD8+IHR5cGUsIFN0cmluZy4uLnByZWZpeGVzKSB7CiAgICAgICAgcG9wdWxh\ndGVIaW50U2V0dGVyKHRhcmdldCwgInNldCIgKyBoaW50LCBoaW50LCB0eXBl\nLCBwcmVmaXhlcyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUG9wdWxh\ndGUgc3RhdGljIHJlZ2lzdHJ5IG9mIGhpbnRzLgogICAgICogIAogICAgICog\nQHBhcmFtIHRhcmdldCBUaGUgbmFtZSBvZiB0aGUgdGFyZ2V0IGNsYXNzIHRo\nYXQgd2lsbCByZWNlaXZlIHRoaXMgaGludC4gCiAgICAgKiBAcGFyYW0gbWV0\naG9kIFRoZSBuYW1lIG9mIHRoZSBtZXRob2QgaW4gdGhlIHRhcmdldCBjbGFz\ncyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGlzIGhpbnQuIAogICAgICogQHBhcmFt\nIGhpbnQgdGhlIHNpbXBsZSBuYW1lIG9mIHRoZSBoaW50IHdpdGhvdXQgYSBw\ncmVmaXguIAogICAgICogQHBhcmFtIHR5cGUgdGhlIHZhbHVlIGFyZ3VtZW50\nIHR5cGUgb2YgdGhlIHRhcmdldCBzZXR0ZXIgbWV0aG9kLiAKICAgICAqIEBw\nYXJhbSBwcmVmaXhlcyB0aGUgcHJlZml4ZXMgd2lsbCBiZSBhZGRlZCB0byB0\naGUgc2ltcGxlIGhpbnQgbmFtZS4gCiAgICAgKi8KICAgIHByb3RlY3RlZCBz\ndGF0aWMgdm9pZCBwb3B1bGF0ZUhpbnRTZXR0ZXIoQ2xhc3M8Pz4gdGFyZ2V0\nLCBTdHJpbmcgbWV0aG9kLCBTdHJpbmcgaGludCwgQ2xhc3M8Pz4gdHlwZSwg\nCiAgICAgICAgICAgIFN0cmluZy4uLnByZWZpeGVzKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgTWV0aG9kIHNldHRlciA9IHRhcmdldC5nZXRNZXRo\nb2QobWV0aG9kLCB0eXBlKTsKICAgICAgICAgICAgZm9yIChTdHJpbmcgcHJl\nZml4IDogcHJlZml4ZXMpIHsKICAgICAgICAgICAgICAgIF9oaW50U2V0dGVy\ncy5wdXQocHJlZml4ICsgIi4iICsgaGludCwgc2V0dGVyKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIC8vIHNob3VsZCBub3QgcmVhY2gKICAgICAgICAgICAgdGhyb3cgbmV3\nIEludGVybmFsRXhjZXB0aW9uKCJzZXR0ZXIgZm9yICIgKyBoaW50ICsgIiB3\naXRoIGFyZ3VtZW50ICIgKyB0eXBlICsgIiBkb2VzIG5vdCBleGlzdCIpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbmZpZ3VyYWJsZSBz\ndGF0ZSBzaGFyZWQgdGhyb3VnaG91dCBhIHRyYXZlcnNhbCBjaGFpbi4KICAg\nICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBDb25maWd1cmF0aW9u\nU3RhdGUKICAgICAgICBpbXBsZW1lbnRzIFNlcmlhbGl6YWJsZQogICAgewog\nICAgICAgIHB1YmxpYyB0cmFuc2llbnQgU3RvcmVDb250ZXh0IGN0eCA9IG51\nbGw7CiAgICAgICAgcHVibGljIGludCBmZXRjaEJhdGNoU2l6ZSA9IDA7CiAg\nICAgICAgcHVibGljIGludCBtYXhGZXRjaERlcHRoID0gMTsKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBxdWVyeUNhY2hlID0gdHJ1ZTsKICAgICAgICBwdWJs\naWMgaW50IGZsdXNoUXVlcnkgPSAwOwogICAgICAgIHB1YmxpYyBpbnQgbG9j\na1RpbWVvdXQgPSAtMTsKICAgICAgICBwdWJsaWMgaW50IHF1ZXJ5VGltZW91\ndCA9IC0xOwogICAgICAgIHB1YmxpYyBpbnQgbG9ja1Njb3BlID0gTE9DS1ND\nT1BFX05PUk1BTDsKICAgICAgICBwdWJsaWMgaW50IHJlYWRMb2NrTGV2ZWwg\nPSBMT0NLX05PTkU7CiAgICAgICAgcHVibGljIGludCB3cml0ZUxvY2tMZXZl\nbCA9IExPQ0tfTk9ORTsKICAgICAgICBwdWJsaWMgU2V0PFN0cmluZz4gZmV0\nY2hHcm91cHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBm\naWVsZHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBTZXQ8Q2xhc3M8Pz4+IHJv\nb3RDbGFzc2VzOwogICAgICAgIHB1YmxpYyBTZXQ8T2JqZWN0PiByb290SW5z\ndGFuY2VzOwogICAgICAgIHB1YmxpYyBNYXA8U3RyaW5nLE9iamVjdD4gaGlu\ndHMgPSBudWxsOwogICAgICAgIHB1YmxpYyBib29sZWFuIGZldGNoR3JvdXBD\nb250YWluc0RlZmF1bHQgPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBmZXRjaEdyb3VwQ29udGFpbnNBbGwgPSBmYWxzZTsKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBleHRlbmRlZFBhdGhMb29rdXAgPSBmYWxzZTsKICAgICAg\nICBwdWJsaWMgRGF0YUNhY2hlUmV0cmlldmVNb2RlIGNhY2hlUmV0cmlldmVN\nb2RlOwogICAgICAgIHB1YmxpYyBEYXRhQ2FjaGVTdG9yZU1vZGUgY2FjaGVT\ndG9yZU1vZGU7ICAgICAgICAKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIENv\nbmZpZ3VyYXRpb25TdGF0ZSBfc3RhdGU7CiAgICBwcml2YXRlIEZldGNoQ29u\nZmlndXJhdGlvbkltcGwgX3BhcmVudDsKICAgIHByaXZhdGUgU3RyaW5nIF9m\ncm9tRmllbGQ7CiAgICBwcml2YXRlIENsYXNzPD8+IF9mcm9tVHlwZTsKICAg\nIHByaXZhdGUgU3RyaW5nIF9kaXJlY3RSZWxhdGlvbk93bmVyOwogICAgcHJp\ndmF0ZSBib29sZWFuIF9sb2FkID0gdHJ1ZTsKICAgIHByaXZhdGUgaW50IF9h\ndmFpbGFibGVSZWN1cnNpb247CiAgICBwcml2YXRlIGludCBfYXZhaWxhYmxl\nRGVwdGg7CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbkltcGwoKSB7\nCiAgICAgICAgdGhpcyhudWxsKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgRmV0\nY2hDb25maWd1cmF0aW9uSW1wbChDb25maWd1cmF0aW9uU3RhdGUgc3RhdGUp\nIHsKICAgICAgICBfc3RhdGUgPSAoc3RhdGUgPT0gbnVsbCkgPyBuZXcgQ29u\nZmlndXJhdGlvblN0YXRlKCkgOiBzdGF0ZTsKICAgICAgICBfYXZhaWxhYmxl\nRGVwdGggPSBfc3RhdGUubWF4RmV0Y2hEZXB0aDsKICAgIH0gCgogICAgcHVi\nbGljIFN0b3JlQ29udGV4dCBnZXRDb250ZXh0KCkgewogICAgICAgIHJldHVy\nbiBfc3RhdGUuY3R4OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENvbnRl\neHQoU3RvcmVDb250ZXh0IGN0eCkgewogICAgICAgIC8vIGNhbid0IHJlc2V0\nIG5vbi1udWxsIGNvbnRleHQgdG8gYW5vdGhlciBjb250ZXh0CiAgICAgICAg\naWYgKGN0eCAhPSBudWxsICYmIF9zdGF0ZS5jdHggIT0gbnVsbCAmJiBjdHgg\nIT0gX3N0YXRlLmN0eCkKICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICAgICAgX3N0YXRlLmN0eCA9IGN0eDsKICAgICAg\nICBpZiAoY3R4ID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gaW5pdGlhbGl6ZSB0byBjb25mIGluZm8KICAgICAgICBPcGVuSlBB\nQ29uZmlndXJhdGlvbiBjb25mID0gY3R4LmdldENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBzZXRGZXRjaEJhdGNoU2l6ZShjb25mLmdldEZldGNoQmF0Y2hT\naXplKCkpOwogICAgICAgIHNldEZsdXNoQmVmb3JlUXVlcmllcyhjb25mLmdl\ndEZsdXNoQmVmb3JlUXVlcmllc0NvbnN0YW50KCkpOwogICAgICAgIHNldExv\nY2tUaW1lb3V0KGNvbmYuZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgc2V0\nUXVlcnlUaW1lb3V0KGNvbmYuZ2V0UXVlcnlUaW1lb3V0KCkpOwogICAgICAg\nIGNsZWFyRmV0Y2hHcm91cHMoKTsKICAgICAgICBhZGRGZXRjaEdyb3VwcyhB\ncnJheXMuYXNMaXN0KGNvbmYuZ2V0RmV0Y2hHcm91cHNMaXN0KCkpKTsKICAg\nICAgICBzZXRNYXhGZXRjaERlcHRoKGNvbmYuZ2V0TWF4RmV0Y2hEZXB0aCgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb25lIHRoaXMgaW5zdGFuY2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBPYmplY3QgY2xvbmUoKSB7CiAgICAgICAg\nRmV0Y2hDb25maWd1cmF0aW9uSW1wbCBjbG9uZSA9IG5ld0luc3RhbmNlKG51\nbGwpOwogICAgICAgIGNsb25lLl9zdGF0ZS5jdHggPSBfc3RhdGUuY3R4Owog\nICAgICAgIGNsb25lLl9wYXJlbnQgPSBfcGFyZW50OwogICAgICAgIGNsb25l\nLl9mcm9tRmllbGQgPSBfZnJvbUZpZWxkOwogICAgICAgIGNsb25lLl9mcm9t\nVHlwZSA9IF9mcm9tVHlwZTsKICAgICAgICBjbG9uZS5fZGlyZWN0UmVsYXRp\nb25Pd25lciA9IF9kaXJlY3RSZWxhdGlvbk93bmVyOwogICAgICAgIGNsb25l\nLl9sb2FkID0gX2xvYWQ7CiAgICAgICAgY2xvbmUuX2F2YWlsYWJsZVJlY3Vy\nc2lvbiA9IF9hdmFpbGFibGVSZWN1cnNpb247CiAgICAgICAgY2xvbmUuX2F2\nYWlsYWJsZURlcHRoID0gX2F2YWlsYWJsZURlcHRoOwogICAgICAgIGNsb25l\nLmNvcHkodGhpcyk7CiAgICAgICAgcmV0dXJuIGNsb25lOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIGEgbmV3IGhvbGxvdyBpbnN0YW5jZS4KICAg\nICAqLwogICAgcHJvdGVjdGVkIEZldGNoQ29uZmlndXJhdGlvbkltcGwgbmV3\nSW5zdGFuY2UoQ29uZmlndXJhdGlvblN0YXRlIHN0YXRlKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBGZXRjaENvbmZpZ3VyYXRpb25JbXBsKHN0YXRlKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBjb3B5KEZldGNoQ29uZmlndXJhdGlvbiBm\nZXRjaCkgewogICAgICAgIHNldEZldGNoQmF0Y2hTaXplKGZldGNoLmdldEZl\ndGNoQmF0Y2hTaXplKCkpOwogICAgICAgIHNldE1heEZldGNoRGVwdGgoZmV0\nY2guZ2V0TWF4RmV0Y2hEZXB0aCgpKTsKICAgICAgICBzZXRRdWVyeUNhY2hl\nRW5hYmxlZChmZXRjaC5nZXRRdWVyeUNhY2hlRW5hYmxlZCgpKTsKICAgICAg\nICBzZXRGbHVzaEJlZm9yZVF1ZXJpZXMoZmV0Y2guZ2V0Rmx1c2hCZWZvcmVR\ndWVyaWVzKCkpOwogICAgICAgIHNldEV4dGVuZGVkUGF0aExvb2t1cChmZXRj\naC5nZXRFeHRlbmRlZFBhdGhMb29rdXAoKSk7CiAgICAgICAgc2V0TG9ja1Rp\nbWVvdXQoZmV0Y2guZ2V0TG9ja1RpbWVvdXQoKSk7CiAgICAgICAgc2V0UXVl\ncnlUaW1lb3V0KGZldGNoLmdldFF1ZXJ5VGltZW91dCgpKTsKICAgICAgICBz\nZXRMb2NrU2NvcGUoZmV0Y2guZ2V0TG9ja1Njb3BlKCkpOwogICAgICAgIGNs\nZWFyRmV0Y2hHcm91cHMoKTsKICAgICAgICBhZGRGZXRjaEdyb3VwcyhmZXRj\naC5nZXRGZXRjaEdyb3VwcygpKTsKICAgICAgICBjbGVhckZpZWxkcygpOwog\nICAgICAgIGNvcHlIaW50cyhmZXRjaCk7CiAgICAgICAgc2V0Q2FjaGVSZXRy\naWV2ZU1vZGUoZmV0Y2guZ2V0Q2FjaGVSZXRyaWV2ZU1vZGUoKSk7CiAgICAg\nICAgc2V0Q2FjaGVTdG9yZU1vZGUoZmV0Y2guZ2V0Q2FjaGVTdG9yZU1vZGUo\nKSk7CiAgICAgICAgYWRkRmllbGRzKGZldGNoLmdldEZpZWxkcygpKTsKCiAg\nICAgICAgLy8gZG9uJ3QgdXNlIHNldHRlcnMgYmVjYXVzZSByZXF1aXJlIGFj\ndGl2ZSB0cmFuc2FjdGlvbgogICAgICAgIF9zdGF0ZS5yZWFkTG9ja0xldmVs\nID0gZmV0Y2guZ2V0UmVhZExvY2tMZXZlbCgpOwogICAgICAgIF9zdGF0ZS53\ncml0ZUxvY2tMZXZlbCA9IGZldGNoLmdldFdyaXRlTG9ja0xldmVsKCk7CiAg\nICB9CgogICAgCiAgICB2b2lkIGNvcHlIaW50cyhGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBpZiAoZmV0Y2ggaW5zdGFuY2VvZiBGZXRj\naENvbmZpZ3VyYXRpb25JbXBsID09IGZhbHNlKQogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uSW1wbCBmcm9tID0gKEZl\ndGNoQ29uZmlndXJhdGlvbkltcGwpZmV0Y2g7CiAgICAgICAgaWYgKGZyb20u\nX3N0YXRlID09IG51bGwgfHwgZnJvbS5fc3RhdGUuaGludHMgPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICh0aGlzLl9zdGF0ZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHRoaXMu\nX3N0YXRlLmhpbnRzID09IG51bGwpCiAgICAgICAgICAgIHRoaXMuX3N0YXRl\nLmhpbnRzID0gbmV3IEhhc2hNYXA8U3RyaW5nLE9iamVjdD4oKTsKICAgICAg\nICB0aGlzLl9zdGF0ZS5oaW50cy5wdXRBbGwoZnJvbS5fc3RhdGUuaGludHMp\nOwogICAgfQogICAgCiAgICBwdWJsaWMgaW50IGdldEZldGNoQmF0Y2hTaXpl\nKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuZmV0Y2hCYXRjaFNpemU7CiAg\nICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBzZXRGZXRjaEJh\ndGNoU2l6ZShpbnQgZmV0Y2hCYXRjaFNpemUpIHsKICAgICAgICBpZiAoZmV0\nY2hCYXRjaFNpemUgPT0gREVGQVVMVCAmJiBfc3RhdGUuY3R4ICE9IG51bGwp\nCiAgICAgICAgICAgIGZldGNoQmF0Y2hTaXplID0gX3N0YXRlLmN0eC5nZXRD\nb25maWd1cmF0aW9uKCkuZ2V0RmV0Y2hCYXRjaFNpemUoKTsKICAgICAgICBp\nZiAoZmV0Y2hCYXRjaFNpemUgIT0gREVGQVVMVCkKICAgICAgICAgICAgX3N0\nYXRlLmZldGNoQmF0Y2hTaXplID0gZmV0Y2hCYXRjaFNpemU7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRNYXhGZXRj\naERlcHRoKCkgewogICAgICAgIHJldHVybiBfc3RhdGUubWF4RmV0Y2hEZXB0\naDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNldE1h\neEZldGNoRGVwdGgoaW50IGRlcHRoKSB7CiAgICAgICAgaWYgKGRlcHRoID09\nIERFRkFVTFQgJiYgX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBk\nZXB0aCA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLmdldE1heEZl\ndGNoRGVwdGgoKTsKICAgICAgICBpZiAoZGVwdGggIT0gREVGQVVMVCkKICAg\nICAgICB7CiAgICAgICAgICAgIF9zdGF0ZS5tYXhGZXRjaERlcHRoID0gZGVw\ndGg7CiAgICAgICAgICAgIGlmIChfcGFyZW50ID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfYXZhaWxhYmxlRGVwdGggPSBkZXB0aDsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nZ2V0UXVlcnlDYWNoZUVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0\nZS5xdWVyeUNhY2hlOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gc2V0UXVlcnlDYWNoZUVuYWJsZWQoYm9vbGVhbiBjYWNoZSkgewog\nICAgICAgIF9zdGF0ZS5xdWVyeUNhY2hlID0gY2FjaGU7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIGludCBnZXRGbHVzaEJlZm9y\nZVF1ZXJpZXMoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5mbHVzaFF1ZXJ5\nOwogICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRFeHRlbmRlZFBh\ndGhMb29rdXAoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5leHRlbmRlZFBh\ndGhMb29rdXA7CiAgICB9CiAgICAKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3Vy\nYXRpb24gc2V0RXh0ZW5kZWRQYXRoTG9va3VwKGJvb2xlYW4gZmxhZykgewog\nICAgICAgIF9zdGF0ZS5leHRlbmRlZFBhdGhMb29rdXAgPSBmbGFnOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZp\nZ3VyYXRpb24gc2V0Rmx1c2hCZWZvcmVRdWVyaWVzKGludCBmbHVzaCkgewog\nICAgICAgIGlmIChmbHVzaCAhPSBERUZBVUxUCiAgICAgICAgICAgICYmIGZs\ndXNoICE9IFF1ZXJ5Rmx1c2hNb2Rlcy5GTFVTSF9UUlVFCiAgICAgICAgICAg\nICYmIGZsdXNoICE9IFF1ZXJ5Rmx1c2hNb2Rlcy5GTFVTSF9GQUxTRQogICAg\nICAgICAgICAmJiBmbHVzaCAhPSBRdWVyeUZsdXNoTW9kZXMuRkxVU0hfV0lU\nSF9DT05ORUNUSU9OKQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAgICAgICAgImJh\nZC1mbHVzaC1iZWZvcmUtcXVlcmllcyIsIG5ldyBJbnRlZ2VyKGZsdXNoKSku\nZ2V0TWVzc2FnZSgpKTsKCiAgICAgICAgaWYgKGZsdXNoID09IERFRkFVTFQg\nJiYgX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBfc3RhdGUuZmx1\nc2hRdWVyeSA9IF9zdGF0ZS5jdHguZ2V0Q29uZmlndXJhdGlvbigpLgogICAg\nICAgICAgICAgICAgZ2V0Rmx1c2hCZWZvcmVRdWVyaWVzQ29uc3RhbnQoKTsK\nICAgICAgICBlbHNlIGlmIChmbHVzaCAhPSBERUZBVUxUKQogICAgICAgICAg\nICBfc3RhdGUuZmx1c2hRdWVyeSA9IGZsdXNoOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBTZXQ8U3RyaW5nPiBnZXRGZXRjaEdy\nb3VwcygpIHsKICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3JvdXBzID09IG51\nbGwpIHJldHVybiBDb2xsZWN0aW9ucy5lbXB0eVNldCgpOwogICAgICAgIHJl\ndHVybiBfc3RhdGUuZmV0Y2hHcm91cHM7CiAgICB9CgogICAgcHVibGljIGJv\nb2xlYW4gaGFzRmV0Y2hHcm91cChTdHJpbmcgZ3JvdXApIHsKICAgICAgICBy\nZXR1cm4gX3N0YXRlLmZldGNoR3JvdXBzICE9IG51bGwKICAgICAgICAgICAg\nJiYgKF9zdGF0ZS5mZXRjaEdyb3Vwcy5jb250YWlucyhncm91cCkKICAgICAg\nICAgICAgfHwgX3N0YXRlLmZldGNoR3JvdXBzLmNvbnRhaW5zKEZldGNoR3Jv\ndXAuTkFNRV9BTEwpKTsKICAgIH0KCiAgICAgcHVibGljIGJvb2xlYW4gaGFz\nRmV0Y2hHcm91cERlZmF1bHQoKSB7CiAgICAgICAgIC8vIEZldGNoIGdyb3Vw\nIEFsbCBpbmNsdWRlcyBmZXRjaCBncm91cCBEZWZhdWx0IGJ5IGRlZmluaXRp\nb24KICAgICAgICAgcmV0dXJuIF9zdGF0ZS5mZXRjaEdyb3VwQ29udGFpbnNE\nZWZhdWx0IHx8IAogICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250\nYWluc0FsbDsKICAgICB9CiAgICAgCiAgICAgcHVibGljIGJvb2xlYW4gaGFz\nRmV0Y2hHcm91cEFsbCgpIHsKICAgICAgICAgcmV0dXJuIF9zdGF0ZS5mZXRj\naEdyb3VwQ29udGFpbnNBbGw7CiAgICAgfQogICAgIAogICAgcHVibGljIEZl\ndGNoQ29uZmlndXJhdGlvbiBhZGRGZXRjaEdyb3VwKFN0cmluZyBuYW1lKSB7\nCiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkobmFtZSkpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJudWxs\nLWZnIikpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKF9zdGF0ZS5mZXRjaEdyb3VwcyA9PSBudWxsKQogICAgICAg\nICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBzID0gbmV3IEhhc2hTZXQ8U3Ry\naW5nPigpOwogICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91cHMuYWRkKG5h\nbWUpOwogICAgICAgICAgICBpZiAoRmV0Y2hHcm91cC5OQU1FX0FMTC5lcXVh\nbHMobmFtZSkpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91cENv\nbnRhaW5zQWxsID0gdHJ1ZTsKICAgICAgICAgICAgZWxzZSBpZiAoRmV0Y2hH\ncm91cC5OQU1FX0RFRkFVTFQuZXF1YWxzKG5hbWUpKQogICAgICAgICAgICAg\nICAgX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0RlZmF1bHQgPSB0cnVlOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMg\nRmV0Y2hDb25maWd1cmF0aW9uIGFkZEZldGNoR3JvdXBzKENvbGxlY3Rpb248\nU3RyaW5nPiBncm91cHMpIHsKICAgICAgICBpZiAoZ3JvdXBzID09IG51bGwg\nfHwgZ3JvdXBzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgZm9yIChTdHJpbmcgZ3JvdXAgOiBncm91cHMpCiAgICAgICAg\nICAgIGFkZEZldGNoR3JvdXAoZ3JvdXApOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVtb3Zl\nRmV0Y2hHcm91cChTdHJpbmcgZ3JvdXApIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0ZS5mZXRjaEdyb3Vw\ncyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBfc3RhdGUuZmV0Y2hHcm91\ncHMucmVtb3ZlKGdyb3VwKTsKICAgICAgICAgICAgICAgIGlmIChGZXRjaEdy\nb3VwLk5BTUVfQUxMLmVxdWFscyhncm91cCkpCiAgICAgICAgICAgICAgICAg\nICAgX3N0YXRlLmZldGNoR3JvdXBDb250YWluc0FsbCA9IGZhbHNlOwogICAg\nICAgICAgICAgICAgZWxzZSBpZiAoRmV0Y2hHcm91cC5OQU1FX0RFRkFVTFQu\nZXF1YWxzKGdyb3VwKSkKICAgICAgICAgICAgICAgICAgICBfc3RhdGUuZmV0\nY2hHcm91cENvbnRhaW5zRGVmYXVsdCA9IGZhbHNlOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1Ymxp\nYyBGZXRjaENvbmZpZ3VyYXRpb24gcmVtb3ZlRmV0Y2hHcm91cHMoQ29sbGVj\ndGlvbjxTdHJpbmc+IGdyb3VwcykgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3JvdXBzICE9\nIG51bGwgJiYgZ3JvdXBzICE9IG51bGwpCiAgICAgICAgICAgICAgICBmb3Ig\nKFN0cmluZyBncm91cCA6IGdyb3VwcykKICAgICAgICAgICAgICAgICAgICBy\nZW1vdmVGZXRjaEdyb3VwKGdyb3VwKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBj\nbGVhckZldGNoR3JvdXBzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZldGNoR3JvdXBzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIF9zdGF0ZS5mZXRjaEdyb3Vwcy5jbGVh\ncigpOwogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3JvdXBDb250YWlu\nc0FsbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgX3N0YXRlLmZldGNoR3Jv\ndXBDb250YWluc0RlZmF1bHQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBGZXRj\naENvbmZpZ3VyYXRpb24gcmVzZXRGZXRjaEdyb3VwcygpIHsKICAgICAgICBj\nbGVhckZldGNoR3JvdXBzKCk7CiAgICAgICAgaWYgKF9zdGF0ZS5jdHggIT0g\nbnVsbCkKICAgICAgICAgICAgYWRkRmV0Y2hHcm91cHMoQXJyYXlzLmFzTGlz\ndChfc3RhdGUuY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAg\nICAgIGdldEZldGNoR3JvdXBzTGlzdCgpKSk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICB9CgogICAgcHVibGljIFNldDxTdHJpbmc+IGdldEZpZWxkcygp\nIHsKICAgICAgICBpZiAoX3N0YXRlLmZpZWxkcyA9PSBudWxsKSByZXR1cm4g\nQ29sbGVjdGlvbnMuZW1wdHlTZXQoKTsKICAgICAgICByZXR1cm4gX3N0YXRl\nLmZpZWxkczsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBoYXNGaWVsZChT\ndHJpbmcgZmllbGQpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmZpZWxkcyAh\nPSBudWxsICYmIF9zdGF0ZS5maWVsZHMuY29udGFpbnMoZmllbGQpOwogICAg\nfQoKICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gYWRkRmllbGQoU3Ry\naW5nIGZpZWxkKSB7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHko\nZmllbGQpKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgibnVsbC1maWVsZCIpKTsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUuZmllbGRzID09IG51\nbGwpCiAgICAgICAgICAgICAgICBfc3RhdGUuZmllbGRzID0gbmV3IEhhc2hT\nZXQ8U3RyaW5nPigpOwogICAgICAgICAgICBfc3RhdGUuZmllbGRzLmFkZChm\naWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAg\nIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gYWRkRmllbGRzKENvbGxlY3Rp\nb248U3RyaW5nPiBmaWVsZHMpIHsKICAgICAgICBpZiAoZmllbGRzID09IG51\nbGwgfHwgZmllbGRzLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoX3N0YXRlLmZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAg\nX3N0YXRlLmZpZWxkcyA9IG5ldyBIYXNoU2V0PFN0cmluZz4oKTsKICAgICAg\nICAgICAgX3N0YXRlLmZpZWxkcy5hZGRBbGwoZmllbGRzKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29u\nZmlndXJhdGlvbiByZW1vdmVGaWVsZChTdHJpbmcgZmllbGQpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9zdGF0\nZS5maWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9zdGF0ZS5maWVs\nZHMucmVtb3ZlKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiByZW1vdmVG\naWVsZHMoQ29sbGVjdGlvbjxTdHJpbmc+IGZpZWxkcykgewogICAgICAgIGxv\nY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX3N0YXRlLmZp\nZWxkcyAhPSBudWxsKQogICAgICAgICAgICAgICAgX3N0YXRlLmZpZWxkcy5y\nZW1vdmVBbGwoZmllbGRzKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBjbGVhckZp\nZWxkcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKF9zdGF0ZS5maWVsZHMgIT0gbnVsbCkKICAgICAgICAgICAg\nICAgIF9zdGF0ZS5maWVsZHMuY2xlYXIoKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICB9CgogICAgcHVibGljIERhdGFDYWNoZVJldHJpZXZl\nTW9kZSBnZXRDYWNoZVJldHJpZXZlTW9kZSgpIHsKICAgICAgICByZXR1cm4g\nX3N0YXRlLmNhY2hlUmV0cmlldmVNb2RlOwogICAgfQoKICAgIHB1YmxpYyBE\nYXRhQ2FjaGVTdG9yZU1vZGUgZ2V0Q2FjaGVTdG9yZU1vZGUoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5jYWNoZVN0b3JlTW9kZTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBzZXRDYWNoZVJldHJpZXZlTW9kZShEYXRhQ2FjaGVSZXRy\naWV2ZU1vZGUgbW9kZSkgewogICAgICAgIF9zdGF0ZS5jYWNoZVJldHJpZXZl\nTW9kZSA9IG1vZGU7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FjaGVT\ndG9yZU1vZGUoRGF0YUNhY2hlU3RvcmVNb2RlIG1vZGUpIHsKICAgICAgICBf\nc3RhdGUuY2FjaGVTdG9yZU1vZGUgPSBtb2RlOwogICAgfQoKICAgIHB1Ymxp\nYyBpbnQgZ2V0TG9ja1RpbWVvdXQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0\nZS5sb2NrVGltZW91dDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1\ncmF0aW9uIHNldExvY2tUaW1lb3V0KGludCB0aW1lb3V0KSB7CiAgICAgICAg\naWYgKHRpbWVvdXQgPT0gREVGQVVMVCAmJiBfc3RhdGUuY3R4ICE9IG51bGwp\nCiAgICAgICAgICAgIF9zdGF0ZS5sb2NrVGltZW91dCA9IF9zdGF0ZS5jdHgu\nZ2V0Q29uZmlndXJhdGlvbigpLmdldExvY2tUaW1lb3V0KCk7CiAgICAgICAg\nZWxzZSBpZiAodGltZW91dCAhPSBERUZBVUxUKSB7CiAgICAgICAgICAgIGlm\nICh0aW1lb3V0IDwgLTEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoImludmFsaWQtdGlt\nZW91dCIsIAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQpLmdldE1lc3Nh\nZ2UoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBf\nc3RhdGUubG9ja1RpbWVvdXQgPSB0aW1lb3V0OwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgCiAgICBw\ndWJsaWMgaW50IGdldFF1ZXJ5VGltZW91dCgpIHsKICAgICAgICByZXR1cm4g\nX3N0YXRlLnF1ZXJ5VGltZW91dDsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hD\nb25maWd1cmF0aW9uIHNldFF1ZXJ5VGltZW91dChpbnQgdGltZW91dCkgewog\nICAgICAgIGlmICh0aW1lb3V0ID09IERFRkFVTFQgJiYgX3N0YXRlLmN0eCAh\nPSBudWxsKQogICAgICAgICAgICBfc3RhdGUucXVlcnlUaW1lb3V0ID0gX3N0\nYXRlLmN0eC5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgICAgICBn\nZXRRdWVyeVRpbWVvdXQoKTsKICAgICAgICBlbHNlIGlmICh0aW1lb3V0ICE9\nIERFRkFVTFQpIHsKICAgICAgICAgICAgaWYgKHRpbWVvdXQgPCAtMSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbihfbG9jLmdldCgiaW52YWxpZC10aW1lb3V0IiwgCiAgICAgICAgICAg\nICAgICAgICAgdGltZW91dCkuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9zdGF0ZS5xdWVyeVRpbWVvdXQg\nPSB0aW1lb3V0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0TG9ja1Njb3Bl\nKCkgewogICAgICAgIHJldHVybiBfc3RhdGUubG9ja1Njb3BlOwogICAgfQoK\nICAgIHB1YmxpYyBGZXRjaENvbmZpZ3VyYXRpb24gc2V0TG9ja1Njb3BlKGlu\ndCBzY29wZSkgewogICAgICAgIGlmIChzY29wZSAhPSBERUZBVUxUCiAgICAg\nICAgICAgICAgICAmJiBzY29wZSAhPSBMb2NrU2NvcGVzLkxPQ0tTQ09QRV9O\nT1JNQUwKICAgICAgICAgICAgICAgICYmIHNjb3BlICE9IExvY2tTY29wZXMu\nTE9DS1NDT1BFX0VYVEVOREVEKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihfbG9jLmdldCgKICAgICAgICAg\nICAgICAgICAgICAiYmFkLWxvY2stc2NvcGUiLCBuZXcgSW50ZWdlcihzY29w\nZSkpLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgaWYgKHNjb3BlID09IERFRkFV\nTFQgKQogICAgICAgICAgICBfc3RhdGUubG9ja1Njb3BlID0gTE9DS1NDT1BF\nX05PUk1BTDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zdGF0ZS5sb2Nr\nU2NvcGUgPSBzY29wZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldFJlYWRMb2NrTGV2ZWwoKSB7CiAgICAgICAgcmV0\ndXJuIF9zdGF0ZS5yZWFkTG9ja0xldmVsOwogICAgfQoKICAgIHB1YmxpYyBG\nZXRjaENvbmZpZ3VyYXRpb24gc2V0UmVhZExvY2tMZXZlbChpbnQgbGV2ZWwp\nIHsKICAgICAgICBpZiAoX3N0YXRlLmN0eCA9PSBudWxsKQogICAgICAgICAg\nICByZXR1cm4gdGhpczsKCiAgICAgICAgaWYgKGxldmVsICE9IERFRkFVTFQK\nICAgICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tf\nTk9ORQogICAgICAgICAgICAmJiBsZXZlbCAhPSBNaXhlZExvY2tMZXZlbHMu\nTE9DS19SRUFECiAgICAgICAgICAgICYmIGxldmVsICE9IE1peGVkTG9ja0xl\ndmVscy5MT0NLX09QVElNSVNUSUMKICAgICAgICAgICAgJiYgbGV2ZWwgIT0g\nTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfV1JJVEUKICAgICAgICAgICAgJiYgbGV2\nZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfT1BUSU1JU1RJQ19GT1JDRV9J\nTkNSRU1FTlQKICAgICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2\nZWxzLkxPQ0tfUEVTU0lNSVNUSUNfUkVBRAogICAgICAgICAgICAmJiBsZXZl\nbCAhPSBNaXhlZExvY2tMZXZlbHMuTE9DS19QRVNTSU1JU1RJQ19XUklURQog\nICAgICAgICAgICAmJiBsZXZlbCAhPSBNaXhlZExvY2tMZXZlbHMuTE9DS19Q\nRVNTSU1JU1RJQ19GT1JDRV9JTkNSRU1FTlQpCiAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oX2xvYy5nZXQoCiAgICAg\nICAgICAgICAgICAiYmFkLWxvY2stbGV2ZWwiLCBuZXcgSW50ZWdlcihsZXZl\nbCkpLmdldE1lc3NhZ2UoKSk7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAobGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxz\nLkxPQ0tfTk9ORSkKICAgICAgICAgICAgICAgIGFzc2VydEFjdGl2ZVRyYW5z\nYWN0aW9uKCk7CiAgICAgICAgICAgIGlmIChsZXZlbCA9PSBERUZBVUxUKQog\nICAgICAgICAgICAgICAgX3N0YXRlLnJlYWRMb2NrTGV2ZWwgPSBfc3RhdGUu\nY3R4LmdldENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgICAgICBn\nZXRSZWFkTG9ja0xldmVsQ29uc3RhbnQoKTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgX3N0YXRlLnJlYWRMb2NrTGV2ZWwgPSBsZXZlbDsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcHVibGlj\nIGludCBnZXRXcml0ZUxvY2tMZXZlbCgpIHsKICAgICAgICByZXR1cm4gX3N0\nYXRlLndyaXRlTG9ja0xldmVsOwogICAgfQoKICAgIHB1YmxpYyBGZXRjaENv\nbmZpZ3VyYXRpb24gc2V0V3JpdGVMb2NrTGV2ZWwoaW50IGxldmVsKSB7CiAg\nICAgICAgaWYgKF9zdGF0ZS5jdHggPT0gbnVsbCkKICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CgogICAgICAgIGlmIChsZXZlbCAhPSBERUZBVUxUCiAgICAg\nICAgICAgICYmIGxldmVsICE9IE1peGVkTG9ja0xldmVscy5MT0NLX05PTkUK\nICAgICAgICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tf\nUkVBRAogICAgICAgICAgICAmJiBsZXZlbCAhPSBNaXhlZExvY2tMZXZlbHMu\nTE9DS19PUFRJTUlTVElDCiAgICAgICAgICAgICYmIGxldmVsICE9IE1peGVk\nTG9ja0xldmVscy5MT0NLX1dSSVRFCiAgICAgICAgICAgICYmIGxldmVsICE9\nIE1peGVkTG9ja0xldmVscy5MT0NLX09QVElNSVNUSUNfRk9SQ0VfSU5DUkVN\nRU5UCiAgICAgICAgICAgICYmIGxldmVsICE9IE1peGVkTG9ja0xldmVscy5M\nT0NLX1BFU1NJTUlTVElDX1JFQUQKICAgICAgICAgICAgJiYgbGV2ZWwgIT0g\nTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfUEVTU0lNSVNUSUNfV1JJVEUKICAgICAg\nICAgICAgJiYgbGV2ZWwgIT0gTWl4ZWRMb2NrTGV2ZWxzLkxPQ0tfUEVTU0lN\nSVNUSUNfRk9SQ0VfSU5DUkVNRU5UKQogICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAg\nICAgICAgImJhZC1sb2NrLWxldmVsIiwgbmV3IEludGVnZXIobGV2ZWwpKS5n\nZXRNZXNzYWdlKCkpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAg\nICAgICAgaWYgKGxldmVsID09IERFRkFVTFQpCiAgICAgICAgICAgICAgICBf\nc3RhdGUud3JpdGVMb2NrTGV2ZWwgPSBfc3RhdGUuY3R4LmdldENvbmZpZ3Vy\nYXRpb24oKS4KICAgICAgICAgICAgICAgICAgICBnZXRXcml0ZUxvY2tMZXZl\nbENvbnN0YW50KCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAg\nIF9zdGF0ZS53cml0ZUxvY2tMZXZlbCA9IGxldmVsOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgUmVzdWx0TGlzdDw/\nPiBuZXdSZXN1bHRMaXN0KFJlc3VsdE9iamVjdFByb3ZpZGVyIHJvcCkgewog\nICAgICAgIGlmIChyb3AgaW5zdGFuY2VvZiBMaXN0UmVzdWx0T2JqZWN0UHJv\ndmlkZXIpCiAgICAgICAgICAgIHJldHVybiBuZXcgU2ltcGxlUmVzdWx0TGlz\ndChyb3ApOwogICAgICAgIGlmIChfc3RhdGUuZmV0Y2hCYXRjaFNpemUgPCAw\nKQogICAgICAgICAgICByZXR1cm4gbmV3IEVhZ2VyUmVzdWx0TGlzdChyb3Ap\nOwogICAgICAgIGlmIChyb3Auc3VwcG9ydHNSYW5kb21BY2Nlc3MoKSkKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTaW1wbGVSZXN1bHRMaXN0KHJvcCk7CiAg\nICAgICAgcmV0dXJuIG5ldyBXaW5kb3dSZXN1bHRMaXN0KHJvcCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaHJvdyBhbiBleGNlcHRpb24gaWYgbm8gdHJh\nbnNhY3Rpb24gaXMgYWN0aXZlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQg\nYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKSB7CiAgICAgICAgaWYgKCFpc0Fj\ndGl2ZVRyYW5zYWN0aW9uKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBOb1Ry\nYW5zYWN0aW9uRXhjZXB0aW9uKF9sb2MuZ2V0KCJub3QtYWN0aXZlIikpOwog\nICAgfQogICAgCiAgICBwcml2YXRlIGJvb2xlYW4gaXNBY3RpdmVUcmFuc2Fj\ndGlvbigpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5jdHggIT0gbnVsbCAm\nJiBfc3RhdGUuY3R4LmlzQWN0aXZlKCkpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIEdldHMgdGhlIGN1cnJlbnQgaGludHMgc2V0IG9uIHRoaXMgcmVj\nZWl2ZXIuIAogICAgICogVGhlIHZhbHVlcyBkZXNpZ25hdGUgdGhlIGFjdHVh\nbCB2YWx1ZSBzcGVjaWZpZWQgYnkgdGhlIGNhbGxlciBhbmQgbm90IHRoZSB2\nYWx1ZXMKICAgICAqIHRoYXQgbWF5IGhhdmUgYmVlbiBhY3R1YWxseSBzZXQg\nb24gdGhlIHN0YXRlIHZhcmlhYmxlcyBvZiB0aGlzIHJlY2VpdmVyLgogICAg\nICogCiAgICAgKi8KICAgIHB1YmxpYyBNYXA8U3RyaW5nLE9iamVjdD4gZ2V0\nSGludHMoKSB7CiAgICAgICAgaWYgKF9zdGF0ZS5oaW50cyA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuZW1wdHlNYXAoKTsKICAg\nICAgICByZXR1cm4gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTWFwKF9zdGF0\nZS5oaW50cyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQWZmaXJtcyBp\nZiB0aGUgZ2l2ZW4ga2V5IGlzIHNldCBhcyBhIGhpbnQuCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzSGludFNldChTdHJpbmcga2V5KSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5oaW50cyAhPSBudWxsICYmIF9zdGF0ZS5oaW50\ncy5jb250YWluc0tleShrZXkpOwogICAgfQogICAgCiAgICAvKioKICAgICAq\nIFJlbW92ZXMgdGhlIGdpdmVuIGtleXMgYW5kIHRoZWlyIGhpbnQgdmFsdWUu\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlbW92ZUhpbnQoU3RyaW5nLi4u\na2V5cykgewogICAgICAgIGlmIChrZXlzID09IG51bGwgfHwgX3N0YXRlLmhp\nbnRzID09IG51bGwgKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZm9y\nIChTdHJpbmcga2V5IDoga2V5cykgewogICAgICAgICAgICBfc3RhdGUuaGlu\ndHMucmVtb3ZlKGtleSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJs\naWMgQ29sbGVjdGlvbjxTdHJpbmc+IGdldFN1cHBvcnRlZEhpbnRzKCkgewog\nICAgICAgIHJldHVybiBfaGludFNldHRlcnMua2V5U2V0KCk7CiAgICB9CiAg\nICAKICAgIC8qKgogICAgICogU2FtZSBhcyA8Y29kZT5zZXRIaW50KGtleSwg\ndmFsdWUsIHZhbHVlKTwvY29kZT4uCiAgICAgKiAKICAgICAqIEBzZWUgI3Nl\ndEhpbnQoU3RyaW5nLCBPYmplY3QsIE9iamVjdCkKICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc2V0SGludChTdHJpbmcga2V5LCBPYmplY3QgdmFsdWUpIHsK\nICAgICAgICBzZXRIaW50KGtleSwgdmFsdWUsIHZhbHVlKTsKICAgIH0KICAg\nIAogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoaW50IHRvIHRoZSBnaXZlbiB2\nYWx1ZS4KICAgICAqIElmIHRoZSBrZXkgY29ycmVzcG9uZHMgdG8gYSBrbm93\nbiBrZXksIHRoZW4gdGhhdCB2YWx1ZSBpcyBzZXQgdmlhIHRoZSBzZXR0ZXIg\nbWV0aG9kLgogICAgICogT3RoZXJ3aXNlIGl0IGlzIHB1dCBpbnRvIG9wYXF1\nZSBoaW50cyBtYXAuICAKICAgICAqIDxicj4KICAgICAqIEluIGVpdGhlciBj\nYXNlLCB0aGUgb3JpZ2luYWwgdmFsdWUgaXMgcHV0IGluIHRoZSBoaW50cyBt\nYXAuCiAgICAgKiBTbyBlc3NlbnRpYWwgZGlmZmVyZW5jZSBiZXR3ZWVuIHNl\ndHRpbmcgYSB2YWx1ZSBkaXJlY3RseSBieSBhIHNldHRlciBhbmQgdmlhIGEg\naGludCBpcyB0aGUgbWVtb3J5CiAgICAgKiBvZiB0aGlzIG9yaWdpbmFsIHZh\nbHVlLgogICAgICogPGJyPgogICAgICogVGhlIG90aGVyIGltcG9ydGFudCBk\naWZmZXJlbmNlIGlzIHNldHRpbmcgbG9jayBsZXZlbHMuIFNldHRpbmcgb2Yg\nbG9jayBsZXZlbCB2aWEgc2V0dGVyIG1ldGhvZCBuZWVkcwogICAgICogYWN0\naXZlIHRyYW5zYWN0aW9uLiBCdXQgc2V0dGluZyB2aWEgaGludCBkb2VzIG5v\ndC4gCiAgICAgKiBAcGFyYW0ga2V5IGEgaGludCBrZXkuIElmIGl0IGlzIG9u\nZSBvZiB0aGUgc3RhdGljYWxseSByZWdpc3RlcmVkIGhpbnQga2V5IHRoZW4g\ndGhlIHNldHRlciBpcyBjYWxsZWQuCiAgICAgKiBAcGFyYW0gdmFsdWUgdG8g\nYmUgc2V0LiBUaGUgZ2l2ZW4gdmFsdWUgdHlwZSBtdXN0IG1hdGNoIHRoZSBh\ncmd1bWVudCB0eXBlIG9mIHRoZSBzZXR0ZXIsIGlmIG9uZSBleGlzdHMuCiAg\nICAgKiBAcGFyYW0gb3JpZ2luYWwgdmFsdWUgYXMgc3BlY2lmaWVkIGJ5IHRo\nZSBjYWxsZXIuIFRoaXMgdmFsdWUgaXMgcHV0IGluIHRoZSBoaW50cyBtYXAu\nCiAgICAgKiAKICAgICAqIEBleGNlcHRpb24gSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uIGlmIHRoZSBnaXZlbiB2YWx1ZSBpcyBub3QgYWNjZXB0YWJsZSBi\neSB0aGUgc2V0dGVyIG1ldGhvZCwgaWYgb25lCiAgICAgKiBleGlzdHMgY29y\ncmVzcG9uZHMgdGhlIGdpdmVuIGhpbnQga2V5LgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzZXRIaW50KFN0cmluZyBrZXksIE9iamVjdCB2YWx1ZSwgT2Jq\nZWN0IG9yaWdpbmFsKSB7CiAgICAgICAgaWYgKGtleSA9PSBudWxsKQogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKF9oaW50U2V0dGVycy5jb250\nYWluc0tleShrZXkpKSB7CiAgICAgICAgICAgIE1ldGhvZCBzZXR0ZXIgPSBf\naGludFNldHRlcnMuZ2V0KGtleSk7CiAgICAgICAgICAgIFN0cmluZyBtZXRo\nb2ROYW1lID0gc2V0dGVyLmdldE5hbWUoKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGlmICgic2V0UmVhZExvY2tMZXZlbCIuZXF1YWxz\nKG1ldGhvZE5hbWUpICYmICFpc0FjdGl2ZVRyYW5zYWN0aW9uKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBfc3RhdGUucmVhZExvY2tMZXZlbCA9IChJbnRl\nZ2VyKXZhbHVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgic2V0V3Jp\ndGVMb2NrTGV2ZWwiLmVxdWFscyhtZXRob2ROYW1lKSAmJiAhaXNBY3RpdmVU\ncmFuc2FjdGlvbigpKSB7CiAgICAgICAgICAgICAgICAgICAgX3N0YXRlLndy\naXRlTG9ja0xldmVsID0gKEludGVnZXIpdmFsdWU7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNldHRlci5pbnZva2Uo\ndGhpcywgRmlsdGVycy5jb252ZXJ0VG9NYXRjaE1ldGhvZEFyZ3VtZW50KHZh\nbHVlLCBzZXR0ZXIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIFN0cmlu\nZyBtZXNzYWdlID0gX2xvYy5nZXQoImJhZC1oaW50LXZhbHVlIiwga2V5LCB0\nb1N0cmluZyh2YWx1ZSksIHRvU3RyaW5nKG9yaWdpbmFsKSkuZ2V0TWVzc2Fn\nZSgpOwogICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKG1lc3NhZ2UpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbihtZXNzYWdlLCBlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBhZGRIaW50KGtleSwgb3JpZ2luYWwpOwog\nICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgYWRkSGludChTdHJpbmcgbmFt\nZSwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChfc3RhdGUuaGludHMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zdGF0ZS5oaW50cyA9IG5ldyBIYXNoTWFwPFN0cmlu\nZyxPYmplY3Q+KCk7CiAgICAgICAgICAgIF9zdGF0ZS5oaW50cy5wdXQobmFt\nZSwgdmFsdWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdl\ndEhpbnQoU3RyaW5nIG5hbWUpIHsKICAgICAgICByZXR1cm4gKF9zdGF0ZS5o\naW50cyA9PSBudWxsKSA/IG51bGwgOiBfc3RhdGUuaGludHMuZ2V0KG5hbWUp\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgcmVtb3ZlSGludChTdHJpbmcg\nbmFtZSkgewogICAgICAgIHJldHVybiAoX3N0YXRlLmhpbnRzID09IG51bGwp\nID8gbnVsbCA6IF9zdGF0ZS5oaW50cy5yZW1vdmUobmFtZSk7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBTZXQ8Q2xhc3M8Pz4+IGdldFJvb3RDbGFzc2VzKCkg\newogICAgICAgIGlmIChfc3RhdGUucm9vdENsYXNzZXMgPT0gbnVsbCkgcmV0\ndXJuIENvbGxlY3Rpb25zLmVtcHR5U2V0KCk7IAogICAgICAgIHJldHVybiBf\nc3RhdGUucm9vdENsYXNzZXM7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29u\nZmlndXJhdGlvbiBzZXRSb290Q2xhc3NlcyhDb2xsZWN0aW9uPENsYXNzPD8+\nPiBjbGFzc2VzKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChfc3RhdGUucm9vdENsYXNzZXMgIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9zdGF0ZS5yb290Q2xhc3Nlcy5jbGVhcigpOwogICAg\nICAgICAgICBpZiAoY2xhc3NlcyAhPSBudWxsICYmICFjbGFzc2VzLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgaWYgKF9zdGF0ZS5yb290Q2xhc3Nl\ncyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgIF9zdGF0ZS5yb290Q2xh\nc3NlcyA9IG5ldyBIYXNoU2V0PENsYXNzPD8+PihjbGFzc2VzKTsKICAgICAg\nICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAgX3N0YXRlLnJv\nb3RDbGFzc2VzLmFkZEFsbChjbGFzc2VzKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBwdWJsaWMgU2V0\nPE9iamVjdD4gZ2V0Um9vdEluc3RhbmNlcygpIHsKICAgICAgICBpZiAoX3N0\nYXRlLnJvb3RJbnN0YW5jZXMgPT0gbnVsbCkgcmV0dXJuIENvbGxlY3Rpb25z\nLmVtcHR5U2V0KCk7IAogICAgICAgIHJldHVybiBfc3RhdGUucm9vdEluc3Rh\nbmNlczsKICAgIH0KCiAgICBwdWJsaWMgRmV0Y2hDb25maWd1cmF0aW9uIHNl\ndFJvb3RJbnN0YW5jZXMoQ29sbGVjdGlvbjw/PiBpbnN0YW5jZXMpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKF9z\ndGF0ZS5yb290SW5zdGFuY2VzICE9IG51bGwpCiAgICAgICAgICAgICAgICBf\nc3RhdGUucm9vdEluc3RhbmNlcy5jbGVhcigpOwogICAgICAgICAgICBpZiAo\naW5zdGFuY2VzICE9IG51bGwgJiYgIWluc3RhbmNlcy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICAgIGlmIChfc3RhdGUucm9vdEluc3RhbmNlcyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgX3N0YXRlLnJvb3RJbnN0YW5j\nZXMgPSBuZXcgSGFzaFNldDxPYmplY3Q+KGluc3RhbmNlcyk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgICAgICAgICBfc3RhdGUu\ncm9vdEluc3RhbmNlcy5hZGRBbGwoaW5zdGFuY2VzKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp\nczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBsb2NrKCkgewogICAgICAgIGlm\nIChfc3RhdGUuY3R4ICE9IG51bGwpCiAgICAgICAgICAgIF9zdGF0ZS5jdHgu\nbG9jaygpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVubG9jaygpIHsKICAg\nICAgICBpZiAoX3N0YXRlLmN0eCAhPSBudWxsKQogICAgICAgICAgICBfc3Rh\ndGUuY3R4LnVubG9jaygpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8KICAg\nIC8vIFRyYXZlcnNhbAogICAgLy8vLy8vLy8vLy8vLwogICAgCiAgICBwdWJs\naWMgaW50IHJlcXVpcmVzRmV0Y2goRmllbGRNZXRhRGF0YSBmbSkgewogICAg\nICAgIGlmICghaW5jbHVkZXMoZm0pKQogICAgICAgICAgICByZXR1cm4gRkVU\nQ0hfTk9ORTsKICAgICAgICAKICAgICAgICBDbGFzczw/PiB0eXBlID0gZ2V0\nUmVsYXRpb25UeXBlKGZtKTsKICAgICAgICBpZiAodHlwZSA9PSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gRkVUQ0hfTE9BRDsKICAgICAgICBpZiAoX2F2\nYWlsYWJsZURlcHRoID09IDApCiAgICAgICAgICAgIHJldHVybiBGRVRDSF9O\nT05FOwoKICAgICAgICAvLyB3ZSBjYW4gc2tpcCBjYWxjdWxhdGluZyByZWN1\ncnNpb24gZGVwdGggaWYgdGhpcyBpcyBhIHRvcC1sZXZlbCBjb25mOgogICAg\nICAgIC8vIHRoZSBmaWVsZCBpcyBpbiBvdXIgZmV0Y2ggZ3JvdXBzLCBzbyBj\nYW4ndCBwb3NzaWJseSBub3Qgc2VsZWN0CiAgICAgICAgaWYgKF9wYXJlbnQg\nPT0gbnVsbCkgCiAgICAgICAgICAgIHJldHVybiBGRVRDSF9MT0FEOwogICAg\nICAgIAogICAgICAgIFN0cmluZyBmaWVsZE5hbWUgPSBmbS5nZXRGdWxsTmFt\nZShmYWxzZSk7CiAgICAgICAgaW50IHJkZXB0aCA9IGdldEF2YWlsYWJsZVJl\nY3Vyc2lvbkRlcHRoKGZtLCB0eXBlLCBmaWVsZE5hbWUsIGZhbHNlKTsKICAg\nICAgICBpZiAocmRlcHRoICE9IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUg\nJiYgcmRlcHRoIDw9IDApCiAgICAgICAgICAgIHJldHVybiBGRVRDSF9OT05F\nOwoKICAgICAgICBpZiAoU3RyaW5nVXRpbHMuZXF1YWxzKF9kaXJlY3RSZWxh\ndGlvbk93bmVyLCBmaWVsZE5hbWUpKQogICAgICAgICAgICByZXR1cm4gRkVU\nQ0hfUkVGOwogICAgICAgIHJldHVybiBGRVRDSF9MT0FEOwogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIHJlcXVpcmVzTG9hZCgpIHsKICAgICAgICByZXR1\ncm4gX2xvYWQ7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlv\nbiB0cmF2ZXJzZShGaWVsZE1ldGFEYXRhIGZtKSB7CiAgICAgICAgQ2xhc3M8\nPz4gdHlwZSA9IGdldFJlbGF0aW9uVHlwZShmbSk7CiAgICAgICAgaWYgKHR5\ncGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAg\nIEZldGNoQ29uZmlndXJhdGlvbkltcGwgY2xvbmUgPSBuZXdJbnN0YW5jZShf\nc3RhdGUpOwogICAgICAgIGNsb25lLl9wYXJlbnQgPSB0aGlzOwogICAgICAg\nIGNsb25lLl9hdmFpbGFibGVEZXB0aCA9IHJlZHVjZShfYXZhaWxhYmxlRGVw\ndGgpOwogICAgICAgIGNsb25lLl9mcm9tRmllbGQgPSBmbS5nZXRGdWxsTmFt\nZShmYWxzZSk7CiAgICAgICAgY2xvbmUuX2Zyb21UeXBlID0gdHlwZTsKICAg\nICAgICBjbG9uZS5fYXZhaWxhYmxlUmVjdXJzaW9uID0gZ2V0QXZhaWxhYmxl\nUmVjdXJzaW9uRGVwdGgoZm0sIHR5cGUsIGZtLmdldEZ1bGxOYW1lKGZhbHNl\nKSwgdHJ1ZSk7CiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmVxdWFscyhfZGly\nZWN0UmVsYXRpb25Pd25lciwgZm0uZ2V0RnVsbE5hbWUoZmFsc2UpKSkKICAg\nICAgICAgICAgY2xvbmUuX2xvYWQgPSBmYWxzZTsKICAgICAgICBlbHNlCiAg\nICAgICAgICAgIGNsb25lLl9sb2FkID0gX2xvYWQ7CgogICAgICAgIEZpZWxk\nTWV0YURhdGEgb3duZXIgPSBmbS5nZXRNYXBwZWRCeU1ldGFEYXRhKCk7CiAg\nICAgICAgaWYgKG93bmVyICE9IG51bGwgJiYgb3duZXIuZ2V0VHlwZUNvZGUo\nKSA9PSBKYXZhVHlwZXMuUEMpCiAgICAgICAgICAgIGNsb25lLl9kaXJlY3RS\nZWxhdGlvbk93bmVyID0gb3duZXIuZ2V0RnVsbE5hbWUoZmFsc2UpOwogICAg\nICAgIAogICAgICAgIHJldHVybiBjbG9uZTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFdoZXRoZXIgb3VyIGNvbmZpZ3VyYXRpb24gc3RhdGUgaW5jbHVkZXMg\ndGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2YXRlIGJvb2xlYW4g\naW5jbHVkZXMoRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBpZiAoKGhh\nc0ZldGNoR3JvdXBEZWZhdWx0KCkgJiYgZm1kLmlzSW5EZWZhdWx0RmV0Y2hH\ncm91cCgpKSAKICAgICAgICB8fCBoYXNGZXRjaEdyb3VwQWxsKCkKICAgICAg\nICB8fCBoYXNGaWVsZChmbWQuZ2V0RnVsbE5hbWUoZmFsc2UpKQogICAgICAg\nIHx8IGhhc0V4dGVuZGVkTG9va3VwUGF0aChmbWQpKQogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICBTdHJpbmdbXSBmZ3MgPSBmbWQuZ2V0Q3Vz\ndG9tRmV0Y2hHcm91cHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGhhc0ZldGNoR3Jv\ndXAoZmdzW2ldKSkKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIHJldHVybiBmYWxzZTsgCiAgICB9CiAgICAKICAgIHByaXZhdGUgYm9v\nbGVhbiBoYXNFeHRlbmRlZExvb2t1cFBhdGgoRmllbGRNZXRhRGF0YSBmbWQp\nIHsKICAgICAgICByZXR1cm4gZ2V0RXh0ZW5kZWRQYXRoTG9va3VwKCkKICAg\nICAgICAgICAgJiYgKGhhc0ZpZWxkKGZtZC5nZXRSZWFsTmFtZSgpKQogICAg\nICAgICAgICAgICAgfHwgKF9mcm9tRmllbGQgIT0gbnVsbCAKICAgICAgICAg\nICAgICAgICYmIGhhc0ZpZWxkKF9mcm9tRmllbGQgKyAiLiIgKyBmbWQuZ2V0\nTmFtZSgpKSkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBh\ndmFpbGFibGUgcmVjdXJzaW9uIGRlcHRoIHZpYSB0aGUgZ2l2ZW4gZmllbGQg\nZm9yIHRoZQogICAgICogZ2l2ZW4gdHlwZS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gdHJhdmVyc2Ugd2hldGhlciB3ZSdyZSB0cmF2ZXJzaW5nIHRoZSBmaWVs\nZAogICAgICovCiAgICBwcml2YXRlIGludCBnZXRBdmFpbGFibGVSZWN1cnNp\nb25EZXB0aChGaWVsZE1ldGFEYXRhIGZtLCBDbGFzczw/PiB0eXBlLCBTdHJp\nbmcgZnJvbUZpZWxkLAogICAgICAgIGJvb2xlYW4gdHJhdmVyc2UpIHsKICAg\nICAgICAvLyBzZWUgaWYgdGhlcmUncyBhIHByZXZpb3VzIGxpbWl0CiAgICAg\nICAgaW50IGF2YWlsID0gSW50ZWdlci5NSU5fVkFMVUU7CiAgICAgICAgZm9y\nIChGZXRjaENvbmZpZ3VyYXRpb25JbXBsIGYgPSB0aGlzOyBmICE9IG51bGw7\nIGYgPSBmLl9wYXJlbnQpIHsKICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxz\nLmVxdWFscyhmLl9mcm9tRmllbGQsIGZyb21GaWVsZCkgCiAgICAgICAgICAg\nICAgICAmJiBJbXBsSGVscGVyLmlzQXNzaWduYWJsZShmLl9mcm9tVHlwZSwg\ndHlwZSkpIHsKICAgICAgICAgICAgICAgIGF2YWlsID0gZi5fYXZhaWxhYmxl\nUmVjdXJzaW9uOwogICAgICAgICAgICAgICAgaWYgKHRyYXZlcnNlKQogICAg\nICAgICAgICAgICAgICAgIGF2YWlsID0gcmVkdWNlKGF2YWlsKTsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGlmIChhdmFpbCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKICAg\nICAgICAKICAgICAgICAvLyBjYWxjdWxhdGUgZmV0Y2ggZ3JvdXBzIG1heAog\nICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IGZtLmdldERlZmluaW5nTWV0\nYURhdGEoKTsKICAgICAgICBpbnQgbWF4ID0gSW50ZWdlci5NSU5fVkFMVUU7\nCiAgICAgICAgaWYgKGZtLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpKQogICAg\nICAgICAgICBtYXggPSBtZXRhLmdldEZldGNoR3JvdXAoRmV0Y2hHcm91cC5O\nQU1FX0RFRkFVTFQpLgogICAgICAgICAgICAgICAgZ2V0UmVjdXJzaW9uRGVw\ndGgoZm0pOwogICAgICAgIFN0cmluZ1tdIGdyb3VwcyA9IGZtLmdldEN1c3Rv\nbUZldGNoR3JvdXBzKCk7CiAgICAgICAgaW50IGN1cjsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgbWF4ICE9IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUg\nCiAgICAgICAgICAgICYmIGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgLy8gaWdub3JlIGN1c3RvbSBncm91cHMgdGhhdCBhcmUgaW5h\nY3RpdmUgaW4gdGhpcyBjb25maWd1cmF0aW9uCiAgICAgICAgICAgIGlmICgh\ndGhpcy5oYXNGZXRjaEdyb3VwKGdyb3Vwc1tpXSkpIGNvbnRpbnVlOwogICAg\nICAgICAgICBjdXIgPSBtZXRhLmdldEZldGNoR3JvdXAoZ3JvdXBzW2ldKS5n\nZXRSZWN1cnNpb25EZXB0aChmbSk7CiAgICAgICAgICAgIGlmIChjdXIgPT0g\nRmV0Y2hHcm91cC5ERVBUSF9JTkZJTklURSB8fCBjdXIgPiBtYXgpIAogICAg\nICAgICAgICAgICAgbWF4ID0gY3VyOwogICAgICAgIH0KICAgICAgICAvLyBy\nZWR1Y2UgbWF4IGlmIHdlJ3JlIHRyYXZlcnNpbmcgYSBzZWxmLXR5cGUgcmVs\nYXRpb24KICAgICAgICBpZiAodHJhdmVyc2UgJiYgbWF4ICE9IEludGVnZXIu\nTUlOX1ZBTFVFCiAgICAgICAgICAgICYmIEltcGxIZWxwZXIuaXNBc3NpZ25h\nYmxlKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCB0eXBlKSkKICAgICAgICAg\nICAgbWF4ID0gcmVkdWNlKG1heCk7CgogICAgICAgIC8vIHRha2UgbWluL2Rl\nZmluZWQgb2YgcHJldmlvdXMgYXZhaWwgYW5kIGZldGNoIGdyb3VwIG1heAog\nICAgICAgIGlmIChhdmFpbCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSAmJiBtYXgg\nPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAgICAgICAgICAgaW50IGRlZiA9\nIEZldGNoR3JvdXAuUkVDVVJTSU9OX0RFUFRIX0RFRkFVTFQ7CiAgICAgICAg\nICAgIHJldHVybiAodHJhdmVyc2UgJiYgSW1wbEhlbHBlci5pc0Fzc2lnbmFi\nbGUoCiAgICAgICAgICAgICAgICAgICAgbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCksIHR5cGUpKSA/IGRlZiAtIDEgOiBkZWY7CiAgICAgICAgfQogICAgICAg\nIGlmIChhdmFpbCA9PSBJbnRlZ2VyLk1JTl9WQUxVRSB8fCBhdmFpbCA9PSBG\nZXRjaEdyb3VwLkRFUFRIX0lORklOSVRFKQogICAgICAgICAgICByZXR1cm4g\nbWF4OwogICAgICAgIGlmIChtYXggPT0gSW50ZWdlci5NSU5fVkFMVUUgfHwg\nbWF4ID09IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUpCiAgICAgICAgICAg\nIHJldHVybiBhdmFpbDsKICAgICAgICByZXR1cm4gTWF0aC5taW4obWF4LCBh\ndmFpbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHJlbGF0\naW9uIHR5cGUgb2YgdGhlIGdpdmVuIGZpZWxkLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBDbGFzczw/PiBnZXRSZWxhdGlvblR5cGUoRmllbGRNZXRh\nRGF0YSBmbSkgewogICAgICAgIGlmIChmbS5pc0RlY2xhcmVkVHlwZVBDKCkp\nCiAgICAgICAgICAgIHJldHVybiBmbS5nZXREZWNsYXJlZFR5cGUoKTsKICAg\nICAgICBpZiAoZm0uZ2V0RWxlbWVudCgpLmlzRGVjbGFyZWRUeXBlUEMoKSkK\nICAgICAgICAgICAgcmV0dXJuIGZtLmdldEVsZW1lbnQoKS5nZXREZWNsYXJl\nZFR5cGUoKTsKICAgICAgICBpZiAoZm0uZ2V0S2V5KCkuaXNEZWNsYXJlZFR5\ncGVQQygpKQogICAgICAgICAgICByZXR1cm4gZm0uZ2V0S2V5KCkuZ2V0RGVj\nbGFyZWRUeXBlKCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZWR1Y2UgdGhlIGdpdmVuIGxvZ2ljYWwgZGVwdGggYnkg\nMS4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHJlZHVjZShpbnQg\nZCkgewogICAgICAgIGlmIChkID09IDApCiAgICAgICAgICAgIHJldHVybiAw\nOwogICAgICAgIGlmIChkICE9IEZldGNoR3JvdXAuREVQVEhfSU5GSU5JVEUp\nCiAgICAgICAgICAgIGQtLTsKICAgICAgICByZXR1cm4gZDsKICAgIH0KCiAg\nICAvLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRGVidWcgbWV0aG9kcwogICAg\nLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBGZXRjaENvbmZpZ3VyYXRpb24gZ2V0\nUGFyZW50KCkgewogICAgICAgIHJldHVybiBfcGFyZW50OwogICAgfQogICAg\nCiAgICBib29sZWFuIGlzUm9vdCgpIHsKICAgICAgICByZXR1cm4gX3BhcmVu\ndCA9PSBudWxsOwogICAgfQogICAgCiAgICBGZXRjaENvbmZpZ3VyYXRpb24g\nZ2V0Um9vdCgpIHsKICAgICAgICByZXR1cm4gKGlzUm9vdCgpKSA/IHRoaXMg\nOiBfcGFyZW50LmdldFJvb3QoKTsKICAgIH0KCiAgICBpbnQgZ2V0QXZhaWxh\nYmxlRmV0Y2hEZXB0aCgpIHsKICAgICAgICByZXR1cm4gX2F2YWlsYWJsZURl\ncHRoOwogICAgfQoKICAgIGludCBnZXRBdmFpbGFibGVSZWN1cnNpb25EZXB0\naCgpIHsKICAgICAgICByZXR1cm4gX2F2YWlsYWJsZVJlY3Vyc2lvbjsKICAg\nIH0KCiAgICBTdHJpbmcgZ2V0VHJhdmVyc2VkRnJvbUZpZWxkKCkgewogICAg\nICAgIHJldHVybiBfZnJvbUZpZWxkOwogICAgfQoKICAgIENsYXNzPD8+IGdl\ndFRyYXZlcnNlZEZyb21UeXBlKCkgewogICAgICAgIHJldHVybiBfZnJvbVR5\ncGU7CiAgICB9CgogICAgTGlzdDxGZXRjaENvbmZpZ3VyYXRpb25JbXBsPiBn\nZXRQYXRoKCkgewogICAgICAgIGlmIChpc1Jvb3QoKSkKICAgICAgICAgICAg\ncmV0dXJuIENvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgICAgIHJldHVy\nbiB0cmFja1BhdGgobmV3IEFycmF5TGlzdDxGZXRjaENvbmZpZ3VyYXRpb25J\nbXBsPigpKTsKICAgIH0KICAgIAogICAgTGlzdDxGZXRjaENvbmZpZ3VyYXRp\nb25JbXBsPiB0cmFja1BhdGgoTGlzdDxGZXRjaENvbmZpZ3VyYXRpb25JbXBs\nPiBwYXRoKSB7CiAgICAgICAgaWYgKF9wYXJlbnQgIT0gbnVsbCkKICAgICAg\nICAgICAgX3BhcmVudC50cmFja1BhdGgocGF0aCk7CiAgICAgICAgcGF0aC5h\nZGQodGhpcyk7CiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICB9CiAgICAgICAK\nICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJu\nICJGZXRjaENvbmZpZ3VyYXRpb25AIiArIFN5c3RlbS5pZGVudGl0eUhhc2hD\nb2RlKHRoaXMpIAogICAgICAgICAgICArICIgKCIgKyBfYXZhaWxhYmxlRGVw\ndGggKyAiKSIgKyBnZXRQYXRoU3RyaW5nKCk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgU3RyaW5nIGdldFBhdGhTdHJpbmcoKSB7CiAgICAgICAgTGlzdDxG\nZXRjaENvbmZpZ3VyYXRpb25JbXBsPiBwYXRoID0gZ2V0UGF0aCgpOwogICAg\nICAgIGlmIChwYXRoLmlzRW1wdHkoKSkKICAgICAgICAgICAgcmV0dXJuICIi\nOwogICAgICAgIFN0cmluZ0J1aWxkZXIgYnVmID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKS5hcHBlbmQgKCI6ICIpOwogICAgICAgIGZvciAoSXRlcmF0b3I8RmV0\nY2hDb25maWd1cmF0aW9uSW1wbD4gaXRyID0gcGF0aC5pdGVyYXRvcigpOyBp\ndHIuaGFzTmV4dCgpOykgewogICAgICAgICAgICBidWYuYXBwZW5kKGl0ci5u\nZXh0KCkuZ2V0VHJhdmVyc2VkRnJvbUZpZWxkKCkpOwogICAgICAgICAgICBp\nZiAoaXRyLmhhc05leHQoKSkKICAgICAgICAgICAgICAgIGJ1Zi5hcHBlbmQo\nIi0+Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWYudG9TdHJpbmco\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3RyaW5nIHRvU3RyaW5nKE9iamVj\ndCBvKSB7CiAgICAgICAgcmV0dXJuIG8gPT0gbnVsbCA/ICJudWxsIiA6IG8u\ndG9TdHJpbmcoKSArICJbIiArIG8uZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyAi\nXSI7CiAgICB9Cn0K\n","encoding":"base64"}

