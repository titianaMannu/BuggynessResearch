{"sha":"e00aa4b2de9515081cf3d7aac7d7975906ea61cb","node_id":"MDQ6QmxvYjIwNjM2NDplMDBhYTRiMmRlOTUxNTA4MWNmM2Q3YWFjN2Q3OTc1OTA2ZWE2MWNi","size":37282,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/e00aa4b2de9515081cf3d7aac7d7975906ea61cb","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0Lk1ldGhvZDsKaW1wb3J0IGphdmEubWF0aC5CaWdE\nZWNpbWFsOwppbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBq\nYXZhLnNlY3VyaXR5LkFjY2Vzc0NvbnRyb2xsZXI7CmltcG9ydCBqYXZhLnNl\nY3VyaXR5LlByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb247CmltcG9ydCBqYXZh\nLnNxbC5UaW1lOwppbXBvcnQgamF2YS5zcWwuVGltZXN0YW1wOwppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5DYWxlbmRh\ncjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWZsZWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBh\nLmtlcm5lbC5leHBzLkFnZ3JlZ2F0ZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLkZpbHRlckxpc3RlbmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkoyRG9Qcml2SGVscGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXpl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkNsYXNzTWV0YURh\ndGE7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLlVzZXJFeGNl\ncHRpb247CmltcG9ydCBzZXJwLnV0aWwuU3RyaW5nczsKCi8qKgogKiBIZWxw\nZXIgbWV0aG9kcyBmb3IgZGVhbGluZyB3aXRoIHF1ZXJ5IGZpbHRlcnMuCiAq\nCiAqIEBhdXRob3IgQWJlIFdoaXRlCiAqIEBub2phdmFkb2MKICovCnB1Ymxp\nYyBjbGFzcyBGaWx0ZXJzIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBC\naWdEZWNpbWFsIFpFUk9fQklHREVDSU1BTCA9IG5ldyBCaWdEZWNpbWFsKDBE\nKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEJpZ0ludGVnZXIgWkVST19C\nSUdJTlRFR0VSID0gbmV3IEJpZ0ludGVnZXIoIjAiKTsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgT1BfQUREID0gMDsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGludCBPUF9TVUJUUkFDVCA9IDE7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgT1BfTVVMVElQTFkgPSAyOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IE9QX0RJVklERSA9IDM7CiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBpbnQgT1BfTU9EID0gNDsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NhbGl6ZXIgX2xvYyA9IExvY2FsaXplci5mb3JQYWNrYWdl\nKEZpbHRlcnMuY2xhc3MpOwoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBj\nb3JyZWN0IHdyYXBwZXIgdHlwZSBmb3IgdGhlIGdpdmVuIGNsYXNzLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIENsYXNzPD8+IHdyYXAoQ2xhc3M8Pz4g\nYykgewogICAgICAgIGlmICghYy5pc1ByaW1pdGl2ZSgpKQogICAgICAgICAg\nICByZXR1cm4gYzsKICAgICAgICBpZiAoYyA9PSBpbnQuY2xhc3MpCiAgICAg\nICAgICAgIHJldHVybiBJbnRlZ2VyLmNsYXNzOwogICAgICAgIGlmIChjID09\nIGZsb2F0LmNsYXNzKQogICAgICAgICAgICByZXR1cm4gRmxvYXQuY2xhc3M7\nCiAgICAgICAgaWYgKGMgPT0gZG91YmxlLmNsYXNzKQogICAgICAgICAgICBy\nZXR1cm4gRG91YmxlLmNsYXNzOwogICAgICAgIGlmIChjID09IGxvbmcuY2xh\nc3MpCiAgICAgICAgICAgIHJldHVybiBMb25nLmNsYXNzOwogICAgICAgIGlm\nIChjID09IGJvb2xlYW4uY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBCb29s\nZWFuLmNsYXNzOwogICAgICAgIGlmIChjID09IHNob3J0LmNsYXNzKQogICAg\nICAgICAgICByZXR1cm4gU2hvcnQuY2xhc3M7CiAgICAgICAgaWYgKGMgPT0g\nYnl0ZS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIEJ5dGUuY2xhc3M7CiAg\nICAgICAgaWYgKGMgPT0gY2hhci5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nIENoYXJhY3Rlci5jbGFzczsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJldHVybiB0aGUgY29ycmVjdCBwcmltaXRpdmUgdHlw\nZSBmb3IgdGhlIGdpdmVuIGNsYXNzLCBpZiBpdCBpcyBhCiAgICAgKiB3cmFw\ncGVyLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIENsYXNzPD8+IHVud3Jh\ncChDbGFzczw/PiBjKSB7CiAgICAgICAgaWYgKGMuaXNQcmltaXRpdmUoKSB8\nfCBjID09IFN0cmluZy5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGM7CiAg\nICAgICAgaWYgKGMgPT0gSW50ZWdlci5jbGFzcykKICAgICAgICAgICAgcmV0\ndXJuIGludC5jbGFzczsKICAgICAgICBpZiAoYyA9PSBGbG9hdC5jbGFzcykK\nICAgICAgICAgICAgcmV0dXJuIGZsb2F0LmNsYXNzOwogICAgICAgIGlmIChj\nID09IERvdWJsZS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGRvdWJsZS5j\nbGFzczsKICAgICAgICBpZiAoYyA9PSBMb25nLmNsYXNzKQogICAgICAgICAg\nICByZXR1cm4gbG9uZy5jbGFzczsKICAgICAgICBpZiAoYyA9PSBCb29sZWFu\nLmNsYXNzKQogICAgICAgICAgICByZXR1cm4gYm9vbGVhbi5jbGFzczsKICAg\nICAgICBpZiAoYyA9PSBTaG9ydC5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nIHNob3J0LmNsYXNzOwogICAgICAgIGlmIChjID09IEJ5dGUuY2xhc3MpCiAg\nICAgICAgICAgIHJldHVybiBieXRlLmNsYXNzOwogICAgICAgIGlmIChjID09\nIENoYXJhY3Rlci5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGNoYXIuY2xh\nc3M7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAgKiBH\naXZlbiB0d28gdHlwZXMsIHJldHVybiB0eXBlIHRoZXkgc2hvdWxkIGJvdGgg\nYmUgY29udmVydGVkCiAgICAgKiB0byBiZWZvcmUgcGVyZm9ybWluZyBhbnkg\nb3BlcmF0aW9ucyBiZXR3ZWVuIHRoZW0uCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgQ2xhc3M8Pz4gcHJvbW90ZShDbGFzczw/PiBjMSwgQ2xhc3M8Pz4g\nYzIpIHsKICAgICAgICBpZiAoYzEgPT0gYzIpCiAgICAgICAgICAgIHJldHVy\nbiB1bndyYXAoYzEpOwogICAgICAgIENsYXNzPD8+IHcxID0gd3JhcChjMSk7\nCiAgICAgICAgQ2xhc3M8Pz4gdzIgPSB3cmFwKGMyKTsKICAgICAgICBpZiAo\ndzEgPT0gdzIpCiAgICAgICAgICAgIHJldHVybiB1bndyYXAoYzEpOwoKICAg\nICAgICAvLyBub3QgbnVtYmVycz8KICAgICAgICBib29sZWFuIHcxTnVtYmVy\nID0gTnVtYmVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odzEpOwogICAgICAg\nIGJvb2xlYW4gdzJOdW1iZXIgPSBOdW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbSh3Mik7CiAgICAgICAgaWYgKCF3MU51bWJlciB8fCAhdzJOdW1iZXIp\nIHsKICAgICAgICAgICAgLy8gdGhlIG9ubHkgbm9uLW51bWVyaWMgcHJvbW90\naW9uIHdlIGRvIGlzIHN0cmluZyB0byBjaGFyLAogICAgICAgICAgICAvLyBv\nciBmcm9tIGNoYXIvc3RyaW5nIHRvIG51bWJlcgogICAgICAgICAgICBpZiAo\nIXcxTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBpZiAodzJOdW1iZXIgJiYg\nKHcxID09IENoYXJhY3Rlci5jbGFzcyB8fCB3MSA9PSBTdHJpbmcuY2xhc3Mp\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAodzIgPT0gQnl0ZS5jbGFz\ncyB8fCB3MiA9PSBTaG9ydC5jbGFzcykKICAgICAgICAgICAgICAgICAgICAg\nICAgPyBJbnRlZ2VyLmNsYXNzIDogdW53cmFwKGMyKTsKICAgICAgICAgICAg\nICAgIGlmICghdzJOdW1iZXIgJiYgdzEgPT0gQ2hhcmFjdGVyLmNsYXNzICYm\nIHcyID09IFN0cmluZy5jbGFzcykKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gU3RyaW5nLmNsYXNzOwogICAgICAgICAgICAgICAgaWYgKHcyTnVtYmVy\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAoYzIpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmICghdzJOdW1iZXIpIHsKICAgICAg\nICAgICAgICAgIGlmICh3MU51bWJlciAmJiAodzIgPT0gQ2hhcmFjdGVyLmNs\nYXNzIHx8IHcyID09IFN0cmluZy5jbGFzcykpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuICh3MSA9PSBCeXRlLmNsYXNzIHx8IHcxID09IFNob3J0LmNs\nYXNzKQogICAgICAgICAgICAgICAgICAgICAgICA/IEludGVnZXIuY2xhc3Mg\nOiB1bndyYXAoYzEpOwogICAgICAgICAgICAgICAgaWYgKCF3MU51bWJlciAm\nJiB3MiA9PSBDaGFyYWN0ZXIuY2xhc3MgJiYgdzEgPT0gU3RyaW5nLmNsYXNz\nKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuY2xhc3M7CiAg\nICAgICAgICAgICAgICBpZiAodzFOdW1iZXIpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHVud3JhcChjMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIGlmIG5laXRoZXIgYXJlIG51bWJlcnMsIHVzZSBsZWFzdC1kZXJp\ndmVkIG9mIHRoZSB0d28uICBpZiBuZWl0aGVyCiAgICAgICAgICAgIC8vIGlz\nIGFzc2lnbmFibGUgZnJvbSB0aGUgb3RoZXIgYnV0IG9uZSBpcyBhIHN0YW5k\nYXJkIHR5cGUsIGFzc3VtZQogICAgICAgICAgICAvLyB0aGUgb3RoZXIgY2Fu\nIGJlIGNvbnZlcnRlZCB0byB0aGF0IHN0YW5kYXJkIHR5cGUKICAgICAgICAg\nICAgaWYgKCF3MU51bWJlciAmJiAhdzJOdW1iZXIpIHsKICAgICAgICAgICAg\nICAgIGlmICh3MSA9PSBPYmplY3QuY2xhc3MpCiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHVud3JhcChjMik7CiAgICAgICAgICAgICAgICBpZiAodzIg\nPT0gT2JqZWN0LmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1\nbndyYXAoYzEpOwogICAgICAgICAgICAgICAgaWYgKHcxLmlzQXNzaWduYWJs\nZUZyb20odzIpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAo\nYzEpOwogICAgICAgICAgICAgICAgaWYgKHcyLmlzQXNzaWduYWJsZUZyb20o\ndzEpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB1bndyYXAoYzIpOwog\nICAgICAgICAgICAgICAgaWYgKGlzTm9uc3RhbmRhcmRUeXBlKHcxKSkKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gKGlzTm9uc3RhbmRhcmRUeXBlKHcy\nKSkgPyBPYmplY3QuY2xhc3MgOiB1bndyYXAoYzIpOwogICAgICAgICAgICAg\nICAgaWYgKGlzTm9uc3RhbmRhcmRUeXBlKHcyKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gKGlzTm9uc3RhbmRhcmRUeXBlKHcxKSkgPyBPYmplY3Qu\nY2xhc3MgOiB1bndyYXAoYzEpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHJldHVybiBPYmplY3QuY2xhc3M7CiAgICAgICAgfQoKICAgICAgICBpZiAo\ndzEgPT0gQmlnRGVjaW1hbC5jbGFzcyB8fCB3MiA9PSBCaWdEZWNpbWFsLmNs\nYXNzKQogICAgICAgICAgICByZXR1cm4gQmlnRGVjaW1hbC5jbGFzczsKICAg\nICAgICBpZiAodzEgPT0gQmlnSW50ZWdlci5jbGFzcykgewogICAgICAgICAg\nICBpZiAodzIgPT0gRmxvYXQuY2xhc3MgfHwgdzIgPT0gRG91YmxlLmNsYXNz\nKQogICAgICAgICAgICAgICAgcmV0dXJuIEJpZ0RlY2ltYWwuY2xhc3M7CiAg\nICAgICAgICAgIHJldHVybiBCaWdJbnRlZ2VyLmNsYXNzOwogICAgICAgIH0K\nICAgICAgICBpZiAodzIgPT0gQmlnSW50ZWdlci5jbGFzcykgewogICAgICAg\nICAgICBpZiAodzEgPT0gRmxvYXQuY2xhc3MgfHwgdzEgPT0gRG91YmxlLmNs\nYXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIEJpZ0RlY2ltYWwuY2xhc3M7\nCiAgICAgICAgICAgIHJldHVybiBCaWdJbnRlZ2VyLmNsYXNzOwogICAgICAg\nIH0KICAgICAgICBpZiAodzEgPT0gRG91YmxlLmNsYXNzIHx8IHcyID09IERv\ndWJsZS5jbGFzcykKICAgICAgICAgICAgcmV0dXJuIGRvdWJsZS5jbGFzczsK\nICAgICAgICBpZiAodzEgPT0gRmxvYXQuY2xhc3MgfHwgdzIgPT0gRmxvYXQu\nY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBmbG9hdC5jbGFzczsKICAgICAg\nICBpZiAodzEgPT0gTG9uZy5jbGFzcyB8fCB3MiA9PSBMb25nLmNsYXNzKQog\nICAgICAgICAgICByZXR1cm4gbG9uZy5jbGFzczsKICAgICAgICByZXR1cm4g\naW50LmNsYXNzOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRo\nZXIgdGhlIGdpdmVuIHR5cGUgaXMgbm90IGEgc3RhbmRhcmQgcGVyc2lzdGVu\ndCB0eXBlLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGlz\nTm9uc3RhbmRhcmRUeXBlKENsYXNzPD8+IGMpIHsKICAgICAgICBzd2l0Y2gg\nKEphdmFUeXBlcy5nZXRUeXBlQ29kZShjKSkKICAgICAgICB7CiAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQVJSQVk6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ09MTEVDVElPTjoKICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6CiAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nUENfVU5UWVBFRDoKICAgICAgICBjYXNlIEphdmFUeXBlcy5PSUQ6CiAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuT0JKRUNUOgogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHdo\nZXRoZXIgYW4gaW5zdGFuY2Ugb2YgdGhlIGZpcnN0IGNsYXNzIGNhbiBiZSBj\nb252ZXJ0ZWQgdG8KICAgICAqIGFuIGluc3RhbmNlIG9mIHRoZSBzZWNvbmQu\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBjYW5Db252ZXJ0\nKENsYXNzPD8+IGMxLCBDbGFzczw/PiBjMiwgYm9vbGVhbiBzdHJpY3QpIHsK\nICAgICAgICBpZiAoYzEgPT0gYzIpCiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIGMxID0gd3JhcChjMSk7CiAgICAgICAgYzIgPSB3cmFwKGMy\nKTsKICAgICAgICBpZiAoYzIuaXNBc3NpZ25hYmxlRnJvbShjMSkpCiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICBib29sZWFuIGMxTnVtYmVy\nID0gTnVtYmVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oYzEpOwogICAgICAg\nIGJvb2xlYW4gYzJOdW1iZXIgPSBOdW1iZXIuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbShjMik7CiAgICAgICAgaWYgKGMxTnVtYmVyICYmIGMyTnVtYmVyKQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoKGMxTnVtYmVy\nICYmIChjMiA9PSBDaGFyYWN0ZXIuY2xhc3MKICAgICAgICAgICAgfHwgKCFz\ndHJpY3QgJiYgYzIgPT0gU3RyaW5nLmNsYXNzKSkpCiAgICAgICAgICAgIHx8\nIChjMk51bWJlciAmJiAoYzEgPT0gQ2hhcmFjdGVyLmNsYXNzCiAgICAgICAg\nICAgIHx8ICghc3RyaWN0ICYmIGMxID09IFN0cmluZy5jbGFzcykpKSkKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGMxID09IFN0cmlu\nZy5jbGFzcyAmJiBjMiA9PSBDaGFyYWN0ZXIuY2xhc3MpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIGlmIChjMiA9PSBTdHJpbmcuY2xhc3Mp\nCiAgICAgICAgICAgIHJldHVybiAhc3RyaWN0OwogICAgICAgIGlmIChjMSA9\nPSBTdHJpbmcuY2xhc3MgJiYgaXNUZW1wb3JhbFR5cGUoYzIpKQogICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoKGMxID09IGphdmEudXRp\nbC5EYXRlLmNsYXNzIHx8YzEgPT0gamF2YS5zcWwuVGltZS5jbGFzcykgJiYg\nYzIgPT0gamF2YS5zcWwuVGltZXN0YW1wLmNsYXNzKQogICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKChjMSA9PSBqYXZhLnV0aWwuRGF0\nZS5jbGFzcyB8fGMxID09IGphdmEuc3FsLlRpbWVzdGFtcC5jbGFzcykgJiYg\nYzIgPT0gamF2YS5zcWwuVGltZS5jbGFzcykKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGlmIChpc1RlbXBvcmFsVHlwZShjMSkgJiYgaXNU\nZW1wb3JhbFR5cGUoYzIpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8qKgogICAgICog\nQ29udmVydCB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2ggdGhlIGdpdmVuIChw\ncmVzdW1hYmx5IGEgc2V0dGVyKSBtZXRob2QgYXJndW1lbnQgdHlwZS4KICAg\nICAqICAKICAgICAqIEBwYXJhbSBvIGdpdmVuIHZhbHVlCiAgICAgKiBAcGFy\nYW0gbWV0aG9kIGEgcHJlc3VtYWJseSBzZXR0ZXIgbWV0aG9kIAogICAgICog\nCiAgICAgKiBAcmV0dXJuIHRoZSBzYW1lIHZhbHVlIGlmIHRoZSBtZXRob2Qg\nZG9lcyBub3QgaGF2ZSBvbmUgYW5kIG9ubHkgb25lIGlucHV0IGFyZ3VtZW50\nLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBjb252ZXJ0VG9N\nYXRjaE1ldGhvZEFyZ3VtZW50KE9iamVjdCBvLCBNZXRob2QgbWV0aG9kKSB7\nCiAgICAgICAgaWYgKG1ldGhvZCA9PSBudWxsIHx8IG1ldGhvZC5nZXRQYXJh\nbWV0ZXJUeXBlcygpLmxlbmd0aCAhPSAxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBvOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY29udmVydChvLCBtZXRo\nb2QuZ2V0UGFyYW1ldGVyVHlwZXMoKVswXSwgdHJ1ZSk7CiAgICB9CgogICAg\ncHVibGljIHN0YXRpYyBPYmplY3QgY29udmVydChPYmplY3QgbywgQ2xhc3M8\nPz4gdHlwZSkgewogICAgICAgIHJldHVybiBjb252ZXJ0KG8sIHR5cGUsIGZh\nbHNlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBn\naXZlbiB2YWx1ZSB0byB0aGUgZ2l2ZW4gdHlwZS4KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyBPYmplY3QgY29udmVydChPYmplY3QgbywgQ2xhc3M8Pz4g\ndHlwZSwgYm9vbGVhbiBzdHJpY3ROdW1lcmljQ29udmVyc2lvbikgewogICAg\nICAgIGlmIChvID09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgIGlmIChvLmdldENsYXNzKCkgPT0gdHlwZSkKICAgICAgICAgICAg\ncmV0dXJuIG87CgogICAgICAgIHR5cGUgPSB3cmFwKHR5cGUpOwogICAgICAg\nIGlmICh0eXBlLmlzQXNzaWduYWJsZUZyb20oby5nZXRDbGFzcygpKSkKICAg\nICAgICAgICAgcmV0dXJuIG87CgogICAgICAgIC8vIHRoZSBub24tbnVtZXJp\nYyBjb252ZXJzaW9ucyB3ZSBkbyBhcmUgdG8gc3RyaW5nLCBvciBmcm9tCiAg\nICAgICAgLy8gc3RyaW5nL2NoYXIgdG8gbnVtYmVyLCBvciBjYWxlbmRhci9k\nYXRlCiAgICAgICAgLy8gU3RyaW5nIHRvIEJvb2xlYW4KICAgICAgICAvLyBT\ndHJpbmcgdG8gSW50ZWdlcgogICAgICAgIGJvb2xlYW4gbnVtID0gbyBpbnN0\nYW5jZW9mIE51bWJlcjsKICAgICAgICBpZiAoIW51bSkgewogICAgICAgICAg\nICBpZiAodHlwZSA9PSBTdHJpbmcuY2xhc3MpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gby50b1N0cmluZygpOwogICAgICAgICAgICBlbHNlIGlmICh0eXBl\nID09IEJvb2xlYW4uY2xhc3MgJiYgbyBpbnN0YW5jZW9mIFN0cmluZykgCiAg\nICAgICAgICAgICAgICByZXR1cm4gQm9vbGVhbi52YWx1ZU9mKG8udG9TdHJp\nbmcoKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT0gSW50ZWdlci5j\nbGFzcyAmJiBvIGluc3RhbmNlb2YgU3RyaW5nKQogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludGVnZXIo\nby50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE51bWJl\nckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IENsYXNzQ2FzdEV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1jb252\nZXJ0IiwgbywKICAgICAgICAgICAgICAgICAgICAgICAgby5nZXRDbGFzcygp\nLCB0eXBlKS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICBlbHNlIGlmICh0eXBlID09IENoYXJhY3Rlci5jbGFzcykgewog\nICAgICAgICAgICAgICAgU3RyaW5nIHN0ciA9IG8udG9TdHJpbmcoKTsKICAg\nICAgICAgICAgICAgIGlmIChzdHIgIT0gbnVsbCAmJiBzdHIubGVuZ3RoKCkg\nPT0gMSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENoYXJhY3Rl\ncihzdHIuY2hhckF0KDApKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChDYWxl\nbmRhci5jbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpICYmCiAgICAgICAg\nICAgICAgICBvIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgICAgICAg\nQ2FsZW5kYXIgY2FsID0gQ2FsZW5kYXIuZ2V0SW5zdGFuY2UoKTsKICAgICAg\nICAgICAgICAgIGNhbC5zZXRUaW1lKChEYXRlKSBvKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBjYWw7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoRGF0ZS5j\nbGFzcy5pc0Fzc2lnbmFibGVGcm9tKHR5cGUpICYmCiAgICAgICAgICAgICAg\nICBvIGluc3RhbmNlb2YgQ2FsZW5kYXIpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiAoKENhbGVuZGFyKSBvKS5nZXRUaW1lKCk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoTnVtYmVyLmNsYXNzLmlzQXNzaWduYWJsZUZyb20odHlwZSkp\nIHsKICAgICAgICAgICAgICAgIEludGVnZXIgaSA9IG51bGw7CiAgICAgICAg\nICAgICAgICBpZiAobyBpbnN0YW5jZW9mIENoYXJhY3RlcikgewogICAgICAg\nICAgICAgICAgICAgIGkgPSBJbnRlZ2VyLnZhbHVlT2YoKENoYXJhY3Rlcilv\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYg\nKG8gaW5zdGFuY2VvZiBTdHJpbmcgJiYgKChTdHJpbmcpIG8pLmxlbmd0aCgp\nID09IDEpCiAgICAgICAgICAgICAgICAgICAgaSA9IEludGVnZXIudmFsdWVP\nZigoKFN0cmluZylvKSk7CgogICAgICAgICAgICAgICAgaWYgKGkgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09IEludGVnZXIu\nY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAg\nICAgICAgICAgICAgICAgIG51bSA9IHRydWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gZWxzZSBpZiAobyBpbnN0YW5jZW9mIFN0cmluZyAm\nJiBpc0pEQkNUZW1wb3JhbFN5bnRheChvLnRvU3RyaW5nKCkpKSB7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdCB0\nZW1wb3JhbCA9IHBhcnNlSkRCQ1RlbXBvcmFsU3ludGF4KG8udG9TdHJpbmco\nKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBvcmFsICE9IG51bGwg\nJiYgdHlwZS5pc0Fzc2lnbmFibGVGcm9tKHRlbXBvcmFsLmdldENsYXNzKCkp\nKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcG9yYWw7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghbnVtKQog\nICAgICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJjYW50LWNvbnZlcnQiLCBvLAogICAgICAgICAgICAgICAgby5nZXRD\nbGFzcygpLCB0eXBlKS5nZXRNZXNzYWdlKCkpOwoKICAgICAgICBpZiAodHlw\nZSA9PSBJbnRlZ2VyLmNsYXNzICYmIGFsbG93TnVtZXJpY0NvbnZlcnNpb24o\nby5nZXRDbGFzcygpLCB0eXBlLCBzdHJpY3ROdW1lcmljQ29udmVyc2lvbikp\nIHsKICAgICAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBvKS5pbnRWYWx1ZSgp\nOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBGbG9hdC5jbGFzcyAmJiBh\nbGxvd051bWVyaWNDb252ZXJzaW9uKG8uZ2V0Q2xhc3MoKSwgdHlwZSwgc3Ry\naWN0TnVtZXJpY0NvbnZlcnNpb24pKSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgRmxvYXQoKChOdW1iZXIpIG8pLmZsb2F0VmFsdWUoKSk7CiAgICAgICAg\nfSBlbHNlIGlmICh0eXBlID09IERvdWJsZS5jbGFzcykgewogICAgICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZSgoKE51bWJlcikgbykuZG91YmxlVmFsdWUo\nKSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IExvbmcuY2xhc3MgJiYg\nYWxsb3dOdW1lcmljQ29udmVyc2lvbihvLmdldENsYXNzKCksIHR5cGUsIHN0\ncmljdE51bWVyaWNDb252ZXJzaW9uKSkgewogICAgICAgICAgICByZXR1cm4g\nKChOdW1iZXIpIG8pLmxvbmdWYWx1ZSgpOwogICAgICAgIH0gZWxzZSBpZiAo\ndHlwZSA9PSBCaWdEZWNpbWFsLmNsYXNzKSB7CiAgICAgICAgICAgIC8vIHRo\nZSBCaWdEZWNpbWFsIGNvbnN0cnVjdG9yIGRvZXNuJ3QgaGFuZGxlIHRoZQog\nICAgICAgICAgICAvLyAiTmFOIiBzdHJpbmcgdmVyc2lvbiBvZiBEb3VibGUu\nTmFOIGFuZCBGbG9hdC5OYU4sIG5vcgogICAgICAgICAgICAvLyBkb2VzIGl0\nIGhhbmRsZSBpbmZpbml0eTsgd2UgbmVlZCB0byBpbnN0ZWFkIHVzZSB0aGUg\nRG91YmxlCiAgICAgICAgICAgIC8vIGFuZCBGbG9hdCB2ZXJzaW9ucywgZGVz\ncGl0ZSB3YW50aW5nIHRvIGNhc3QgaXQgdG8gQmlnRGVjaW1hbAogICAgICAg\nICAgICBkb3VibGUgZHZhbCA9ICgoTnVtYmVyKSBvKS5kb3VibGVWYWx1ZSgp\nOwogICAgICAgICAgICBpZiAoRG91YmxlLmlzTmFOKGR2YWwpIHx8IERvdWJs\nZS5pc0luZmluaXRlKGR2YWwpKQogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBEb3VibGUoZHZhbCk7CgogICAgICAgICAgICBmbG9hdCBmdmFsID0gKChO\ndW1iZXIpIG8pLmZsb2F0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKEZsb2F0\nLmlzTmFOKGZ2YWwpIHx8IEZsb2F0LmlzSW5maW5pdGUoZnZhbCkpCiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KGZ2YWwpOwoKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBCaWdEZWNpbWFsKG8udG9TdHJpbmcoKSk7CiAgICAg\nICAgfSBlbHNlIGlmICh0eXBlID09IEJpZ0ludGVnZXIuY2xhc3MpIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBCaWdJbnRlZ2VyKG8udG9TdHJpbmcoKSk7\nCiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IFNob3J0LmNsYXNzICYmIGFs\nbG93TnVtZXJpY0NvbnZlcnNpb24oby5nZXRDbGFzcygpLCB0eXBlLCBzdHJp\nY3ROdW1lcmljQ29udmVyc2lvbikpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBTaG9ydCgoKE51bWJlcikgbykuc2hvcnRWYWx1ZSgpKTsKICAgICAgICB9\nIGVsc2UgaWYgKHR5cGUgPT0gQnl0ZS5jbGFzcyAmJiBhbGxvd051bWVyaWND\nb252ZXJzaW9uKG8uZ2V0Q2xhc3MoKSwgdHlwZSwgc3RyaWN0TnVtZXJpY0Nv\nbnZlcnNpb24pKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZSgoKE51\nbWJlcikgbykuYnl0ZVZhbHVlKCkpOwogICAgICAgIH0gZWxzZSBpZiAoIXN0\ncmljdE51bWVyaWNDb252ZXJzaW9uKSB7CiAgICAgICAgICAgIHJldHVybiAo\nKE51bWJlcikgbykuaW50VmFsdWUoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICB0aHJvdyBuZXcgQ2xhc3NDYXN0RXhjZXB0aW9uKF9sb2MuZ2V0\nKCJjYW50LWNvbnZlcnQiLCBvLCBvLmdldENsYXNzKCksIHR5cGUpLmdldE1l\nc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIHN0\nYXRpYyBib29sZWFuIGFsbG93TnVtZXJpY0NvbnZlcnNpb24oQ2xhc3M8Pz4g\nYWN0dWFsLCBDbGFzczw/PiB0YXJnZXQsIGJvb2xlYW4gc3RyaWN0KSB7CiAg\nICAgICAgaWYgKCFzdHJpY3QgfHwgYWN0dWFsID09IHRhcmdldCkKICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGFjdHVhbCA9PSBCeXRl\nLmNsYXNzKSAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGFjdHVhbCA9\nPSBEb3VibGUuY2xhc3MpICByZXR1cm4gdGFyZ2V0ID09IEZsb2F0LmNsYXNz\nOwogICAgICAgIGlmIChhY3R1YWwgPT0gRmxvYXQuY2xhc3MpICAgcmV0dXJu\nIHRhcmdldCA9PSBEb3VibGUuY2xhc3M7CiAgICAgICAgaWYgKGFjdHVhbCA9\nPSBJbnRlZ2VyLmNsYXNzKSByZXR1cm4gdGFyZ2V0ID09IExvbmcuY2xhc3Mg\nfHwgdGFyZ2V0ID09IFNob3J0LmNsYXNzOwogICAgICAgIGlmIChhY3R1YWwg\nPT0gTG9uZy5jbGFzcykgICAgcmV0dXJuIHRhcmdldCA9PSBJbnRlZ2VyLmNs\nYXNzIHx8IHRhcmdldCA9PSBTaG9ydC5jbGFzczsKICAgICAgICBpZiAoYWN0\ndWFsID09IFNob3J0LmNsYXNzKSAgIHJldHVybiB0YXJnZXQgPT0gTG9uZy5j\nbGFzcyB8fCB0YXJnZXQgPT0gSW50ZWdlci5jbGFzczsKICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgYWRk\nKE9iamVjdCBvMSwgQ2xhc3M8Pz4gYzEsIE9iamVjdCBvMiwgQ2xhc3M8Pz4g\nYzIpIHsKICAgICAgICByZXR1cm4gb3AobzEsIGMxLCBvMiwgYzIsIE9QX0FE\nRCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdWJ0cmFjdCB0aGUgZ2l2ZW4g\ndmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9iamVjdCBzdWJ0\ncmFjdChPYmplY3QgbzEsIENsYXNzPD8+IGMxLCBPYmplY3QgbzIsIENsYXNz\nPD8+IGMyKSB7CiAgICAgICAgcmV0dXJuIG9wKG8xLCBjMSwgbzIsIGMyLCBP\nUF9TVUJUUkFDVCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0\naGUgZ2l2ZW4gdmFsdWVzLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIE9i\namVjdCBtdWx0aXBseShPYmplY3QgbzEsIENsYXNzPD8+IGMxLCBPYmplY3Qg\nbzIsIENsYXNzPD8+IGMyKSB7CiAgICAgICAgcmV0dXJuIG9wKG8xLCBjMSwg\nbzIsIGMyLCBPUF9NVUxUSVBMWSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBE\naXZpZGUgdGhlIGdpdmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgZGl2aWRlKE9iamVjdCBvMSwgQ2xhc3M8Pz4gYzEsIE9i\namVjdCBvMiwgQ2xhc3M8Pz4gYzIpIHsKICAgICAgICByZXR1cm4gb3AobzEs\nIGMxLCBvMiwgYzIsIE9QX0RJVklERSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBNb2QgdGhlIGdpdmVuIHZhbHVlcy4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBPYmplY3QgbW9kKE9iamVjdCBvMSwgQ2xhc3M8Pz4gYzEsIE9iamVj\ndCBvMiwgQ2xhc3M8Pz4gYzIpIHsKICAgICAgICByZXR1cm4gb3AobzEsIGMx\nLCBvMiwgYzIsIE9QX01PRCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJm\nb3JtIHRoZSBnaXZlbiBvcGVyYXRpb24gb24gdHdvIG51bWJlcnMuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBvcChPYmplY3QgbzEsIENs\nYXNzPD8+IGMxLCBPYmplY3QgbzIsIENsYXNzPD8+IGMyLCBpbnQgb3ApIHsK\nICAgICAgICBDbGFzczw/PiBwcm9tb3RlID0gcHJvbW90ZShjMSwgYzIpOwog\nICAgICAgIGlmIChwcm9tb3RlID09IGludC5jbGFzcykgewogICAgICAgICAg\nICBpbnQgbjEgPSAobzEgPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIG8xKS5p\nbnRWYWx1ZSgpOwogICAgICAgICAgICBpbnQgbjIgPSAobzIgPT0gbnVsbCkg\nPyAwIDogKChOdW1iZXIpIG8yKS5pbnRWYWx1ZSgpOwogICAgICAgICAgICBy\nZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAgICAgfQogICAgICAgIGlmIChw\ncm9tb3RlID09IGZsb2F0LmNsYXNzKSB7CiAgICAgICAgICAgIGZsb2F0IG4x\nID0gKG8xID09IG51bGwpID8gMEYgOiAoKE51bWJlcikgbzEpLmZsb2F0VmFs\ndWUoKTsKICAgICAgICAgICAgZmxvYXQgbjIgPSAobzIgPT0gbnVsbCkgPyAw\nRiA6ICgoTnVtYmVyKSBvMikuZmxvYXRWYWx1ZSgpOwogICAgICAgICAgICBy\nZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAgICAgfQogICAgICAgIGlmIChw\ncm9tb3RlID09IGRvdWJsZS5jbGFzcykgewogICAgICAgICAgICBkb3VibGUg\nbjEgPSAobzEgPT0gbnVsbCkgPyAwRCA6ICgoTnVtYmVyKSBvMSkuZG91Ymxl\nVmFsdWUoKTsKICAgICAgICAgICAgZG91YmxlIG4yID0gKG8yID09IG51bGwp\nID8gMEQgOiAoKE51bWJlcikgbzIpLmRvdWJsZVZhbHVlKCk7CiAgICAgICAg\nICAgIHJldHVybiBvcChuMSwgbjIsIG9wKTsKICAgICAgICB9CiAgICAgICAg\naWYgKHByb21vdGUgPT0gbG9uZy5jbGFzcykgewogICAgICAgICAgICBsb25n\nIG4xID0gKG8xID09IG51bGwpID8gMEwgOiAoKE51bWJlcikgbzEpLmxvbmdW\nYWx1ZSgpOwogICAgICAgICAgICBsb25nIG4yID0gKG8yID09IG51bGwpID8g\nMEwgOiAoKE51bWJlcikgbzIpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICBy\nZXR1cm4gb3AobjEsIG4yLCBvcCk7CiAgICAgICAgfQogICAgICAgIGlmIChw\ncm9tb3RlID09IEJpZ0RlY2ltYWwuY2xhc3MpIHsKICAgICAgICAgICAgQmln\nRGVjaW1hbCBuMSA9IChvMSA9PSBudWxsKSA/IFpFUk9fQklHREVDSU1BTAog\nICAgICAgICAgICAgICAgOiAoQmlnRGVjaW1hbCkgY29udmVydChvMSwgcHJv\nbW90ZSk7CiAgICAgICAgICAgIEJpZ0RlY2ltYWwgbjIgPSAobzIgPT0gbnVs\nbCkgPyBaRVJPX0JJR0RFQ0lNQUwKICAgICAgICAgICAgICAgIDogKEJpZ0Rl\nY2ltYWwpIGNvbnZlcnQobzIsIHByb21vdGUpOwogICAgICAgICAgICByZXR1\ncm4gb3AobjEsIG4yLCBvcCk7CiAgICAgICAgfQogICAgICAgIGlmIChwcm9t\nb3RlID09IEJpZ0ludGVnZXIuY2xhc3MpIHsKICAgICAgICAgICAgQmlnSW50\nZWdlciBuMSA9IChvMSA9PSBudWxsKSA/IFpFUk9fQklHSU5URUdFUgogICAg\nICAgICAgICAgICAgOiAoQmlnSW50ZWdlcikgY29udmVydChvMSwgcHJvbW90\nZSk7CiAgICAgICAgICAgIEJpZ0ludGVnZXIgbjIgPSAobzIgPT0gbnVsbCkg\nPyBaRVJPX0JJR0lOVEVHRVIKICAgICAgICAgICAgICAgIDogKEJpZ0ludGVn\nZXIpIGNvbnZlcnQobzIsIHByb21vdGUpOwogICAgICAgICAgICByZXR1cm4g\nb3AobjEsIG4yLCBvcCk7CiAgICAgICAgfQogICAgICAgIC8vIGRlZmF1bHQg\ndG8gaW50CiAgICAgICAgaW50IG4xID0gKG8xID09IG51bGwpID8gMCA6ICgo\nTnVtYmVyKSBvMSkuaW50VmFsdWUoKTsKICAgICAgICBpbnQgbjIgPSAobzIg\nPT0gbnVsbCkgPyAwIDogKChOdW1iZXIpIG8yKS5pbnRWYWx1ZSgpOwogICAg\nICAgIHJldHVybiBvcChuMSwgbjIsIG9wKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiB0aGUgcmVzdWx0IG9mIGEgbWF0aGVtYXRpY2FsIG9wZXJh\ndGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IG9wKGlu\ndCBuMSwgaW50IG4yLCBpbnQgb3ApIHsKICAgICAgICBpbnQgdG90OwogICAg\nICAgIHN3aXRjaCAob3ApIHsKICAgICAgICAgICAgY2FzZSBPUF9BREQ6CiAg\nICAgICAgICAgICAgICB0b3QgPSBuMSArIG4yOwogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1BfU1VCVFJBQ1Q6CiAgICAgICAg\nICAgICAgICB0b3QgPSBuMSAtIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIGNhc2UgT1BfTVVMVElQTFk6CiAgICAgICAgICAgICAg\nICB0b3QgPSBuMSAqIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgT1BfRElWSURFOgogICAgICAgICAgICAgICAgdG90ID0g\nbjEgLyBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBj\nYXNlIE9QX01PRDoKICAgICAgICAgICAgICAgIHRvdCA9IG4xICUgbjI7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdG90OwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSByZXN1bHQgb2YgYSBtYXRoZW1hdGljYWwgb3Bl\ncmF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3Ao\nZmxvYXQgbjEsIGZsb2F0IG4yLCBpbnQgb3ApIHsKICAgICAgICBmbG9hdCB0\nb3Q7CiAgICAgICAgc3dpdGNoIChvcCkgewogICAgICAgICAgICBjYXNlIE9Q\nX0FERDoKICAgICAgICAgICAgICAgIHRvdCA9IG4xICsgbjI7CiAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9TVUJUUkFDVDoK\nICAgICAgICAgICAgICAgIHRvdCA9IG4xIC0gbjI7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9NVUxUSVBMWToKICAgICAg\nICAgICAgICAgIHRvdCA9IG4xICogbjI7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBPUF9ESVZJREU6CiAgICAgICAgICAgICAg\nICB0b3QgPSBuMSAvIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIGNhc2UgT1BfTU9EOgogICAgICAgICAgICAgICAgdG90ID0gbjEg\nJSBuMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZh\ndWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0\naW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgRmxvYXQodG90\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgcmVzdWx0IG9m\nIGEgbWF0aGVtYXRpY2FsIG9wZXJhdGlvbi4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgT2JqZWN0IG9wKGRvdWJsZSBuMSwgZG91YmxlIG4yLCBpbnQg\nb3ApIHsKICAgICAgICBkb3VibGUgdG90OwogICAgICAgIHN3aXRjaCAob3Ap\nIHsKICAgICAgICAgICAgY2FzZSBPUF9BREQ6CiAgICAgICAgICAgICAgICB0\nb3QgPSBuMSArIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIGNhc2UgT1BfU1VCVFJBQ1Q6CiAgICAgICAgICAgICAgICB0b3QgPSBu\nMSAtIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNh\nc2UgT1BfTVVMVElQTFk6CiAgICAgICAgICAgICAgICB0b3QgPSBuMSAqIG4y\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT1Bf\nRElWSURFOgogICAgICAgICAgICAgICAgdG90ID0gbjEgLyBuMjsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE9QX01PRDoKICAg\nICAgICAgICAgICAgIHRvdCA9IG4xICUgbjI7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbmV3IERvdWJsZSh0b3QpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJuIHRoZSByZXN1bHQgb2YgYSBtYXRoZW1hdGljYWwgb3BlcmF0\naW9uLgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBPYmplY3Qgb3AobG9u\nZyBuMSwgbG9uZyBuMiwgaW50IG9wKSB7CiAgICAgICAgbG9uZyB0b3Q7CiAg\nICAgICAgc3dpdGNoIChvcCkgewogICAgICAgICAgICBjYXNlIE9QX0FERDoK\nICAgICAgICAgICAgICAgIHRvdCA9IG4xICsgbjI7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUF9TVUJUUkFDVDoKICAgICAg\nICAgICAgICAgIHRvdCA9IG4xIC0gbjI7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgY2FzZSBPUF9NVUxUSVBMWToKICAgICAgICAgICAg\nICAgIHRvdCA9IG4xICogbjI7CiAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgY2FzZSBPUF9ESVZJREU6CiAgICAgICAgICAgICAgICB0b3Qg\nPSBuMSAvIG4yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIGNhc2UgT1BfTU9EOgogICAgICAgICAgICAgICAgdG90ID0gbjEgJSBuMjsK\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludGVybmFsRXhjZXB0aW9uKCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0b3Q7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHJlc3VsdCBvZiBhIG1hdGhlbWF0aWNhbCBv\ncGVyYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBv\ncChCaWdEZWNpbWFsIG4xLCBCaWdEZWNpbWFsIG4yLCBpbnQgb3ApIHsKICAg\nICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgIGNhc2UgT1BfQUREOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG4xLmFkZChuMik7CiAgICAgICAgICAg\nIGNhc2UgT1BfU1VCVFJBQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gbjEu\nc3VidHJhY3QobjIpOwogICAgICAgICAgICBjYXNlIE9QX01VTFRJUExZOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG4xLm11bHRpcGx5KG4yKTsKICAgICAg\nICAgICAgY2FzZSBPUF9ESVZJREU6CiAgICAgICAgICAgICAgICBpbnQgc2Nh\nbGUgPSBNYXRoLm1heChuMS5zY2FsZSgpLCBuMi5zY2FsZSgpKTsKICAgICAg\nICAgICAgICAgIHJldHVybiBuMS5kaXZpZGUobjIsIHNjYWxlLCBCaWdEZWNp\nbWFsLlJPVU5EX0hBTEZfVVApOwogICAgICAgICAgICBjYXNlIE9QX01PRDoK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2Mu\nZ2V0KCJtb2QtYmlnZGVjaW1hbCIpKTsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUg\ncmVzdWx0IG9mIGEgbWF0aGVtYXRpY2FsIG9wZXJhdGlvbi4KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgT2JqZWN0IG9wKEJpZ0ludGVnZXIgbjEsIEJp\nZ0ludGVnZXIgbjIsIGludCBvcCkgewogICAgICAgIHN3aXRjaCAob3ApIHsK\nICAgICAgICAgICAgY2FzZSBPUF9BREQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gbjEuYWRkKG4yKTsKICAgICAgICAgICAgY2FzZSBPUF9TVUJUUkFDVDoK\nICAgICAgICAgICAgICAgIHJldHVybiBuMS5zdWJ0cmFjdChuMik7CiAgICAg\nICAgICAgIGNhc2UgT1BfTVVMVElQTFk6CiAgICAgICAgICAgICAgICByZXR1\ncm4gbjEubXVsdGlwbHkobjIpOwogICAgICAgICAgICBjYXNlIE9QX0RJVklE\nRToKICAgICAgICAgICAgICAgIHJldHVybiBuMS5kaXZpZGUobjIpOwogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUGFyc2VzIHRoZSBnaXZlbiBkZWNsYXJhdGlvbnMgaW50byBhIGxp\nc3Qgb2YgdHlwZSwgbmFtZSwgdHlwZSwgbmFtZS4uLgogICAgICogUmV0dXJu\ncyBudWxsIGlmIG5vIGRlY2xhcmF0aW9ucy4gQXNzdW1lcyBkZWNsYXJhdGlv\nbiBpcyBub3QgYW4gZW1wdHkKICAgICAqIHN0cmluZyBhbmQgaXMgYWxyZWFk\neSB0cmltbWVkICh2YWxpZCBhc3N1bXB0aW9ucyBnaXZlbiB0aGUgY2hlY2tz\nIG1hZGUKICAgICAqIGluIG91ciBzZXR0ZXJzKS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZGVjVHlwZSB0aGUgdHlwZSBvZiBkZWNsYXJhdGlvbiBiZWluZyBw\nYXJzZWQsIGZvciB1c2UgaW4KICAgICAqIGVycm9yIG1lc3NhZ2VzCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxTdHJpbmc+IHBhcnNlRGVjbGFy\nYXRpb24oU3RyaW5nIGRlYywgY2hhciBzcGxpdCwgU3RyaW5nIGRlY1R5cGUp\nIHsKICAgICAgICBpZiAoZGVjID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwoKICAgICAgICAvLyB3YXRjaCBmb3IgY29tbW9uIG1peHVwcyBi\nZXR3ZWVuIGNvbW1hcyBhbmQgc2VtaXMKICAgICAgICBjaGFyIGJhZCA9IChj\naGFyKSAwOwogICAgICAgIGlmIChzcGxpdCA9PSAnLCcpCiAgICAgICAgICAg\nIGJhZCA9ICc7JzsKICAgICAgICBlbHNlIGlmIChzcGxpdCA9PSAnOycpCiAg\nICAgICAgICAgIGJhZCA9ICcsJzsKCiAgICAgICAgY2hhciBzZW50aW5hbCA9\nICcgJzsKICAgICAgICBjaGFyIGN1cjsKICAgICAgICBpbnQgc3RhcnQgPSAw\nOwogICAgICAgIGJvb2xlYW4gc2tpcFNwYWNlID0gZmFsc2U7CiAgICAgICAg\nTGlzdDxTdHJpbmc+IHJlc3VsdHMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4o\nNik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWMubGVuZ3RoKCk7\nIGkrKykgewogICAgICAgICAgICBjdXIgPSBkZWMuY2hhckF0KGkpOwogICAg\nICAgICAgICBpZiAoY3VyID09IGJhZCkKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGVjIiwgZGVjLCBk\nZWNUeXBlKSk7CiAgICAgICAgICAgIGlmIChjdXIgPT0gJyAnICYmIHNraXBT\ncGFjZSkgewogICAgICAgICAgICAgICAgc3RhcnQrKzsKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBza2lw\nU3BhY2UgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGN1ciAhPSBzZW50aW5h\nbCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8g\naWYgbG9va2luZyBmb3Igc3BhY2VzLCBsb29rIGZvciBzcGxpdCBjaGFyLCBv\nciB2aWNlIHZlcnNhCiAgICAgICAgICAgIHNlbnRpbmFsID0gKHNlbnRpbmFs\nID09ICcgJykgPyBzcGxpdCA6ICcgJzsKICAgICAgICAgICAgcmVzdWx0cy5h\nZGQoZGVjLnN1YnN0cmluZyhzdGFydCwgaSkudHJpbSgpKTsKICAgICAgICAg\nICAgc3RhcnQgPSBpICsgMTsKICAgICAgICAgICAgc2tpcFNwYWNlID0gdHJ1\nZTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCBsYXN0IHRva2VuLCBpZiBh\nbnkKICAgICAgICBpZiAoc3RhcnQgPCBkZWMubGVuZ3RoKCkpCiAgICAgICAg\nICAgIHJlc3VsdHMuYWRkKGRlYy5zdWJzdHJpbmcoc3RhcnQpKTsKCiAgICAg\nICAgLy8gaWYgbm90IGFuIGV2ZW4gbnVtYmVyIG9mIGVsZW1lbnRzLCBzb21l\ndGhpbmcgaXMgd3JvbmcKICAgICAgICBpZiAocmVzdWx0cy5pc0VtcHR5KCkg\nfHwgcmVzdWx0cy5zaXplKCkgJSAyICE9IDApCiAgICAgICAgICAgIHRocm93\nIG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZGVjIiwgZGVjLCBk\nZWNUeXBlKSk7CgogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgfQoKICAg\nIC8qKgogICAgICogU3BsaXQgdGhlIGdpdmVuIGV4cHJlc3Npb24gbGlzdCBp\nbnRvIGRpc3RpbmN0IGV4cHJlc3Npb25zLiBBc3N1bWVzIHRoZQogICAgICog\nZ2l2ZW4gc3RyaW5nIGlzIG5vdCBudWxsIG9yIG9mIHplcm8gbGVuZ3RoIGFu\nZCBpcyBhbHJlYWR5IHRyaW1tZWQKICAgICAqICh2YWxpZCBhc3N1bXB0aW9u\ncyBnaXZlbiB0aGUgY2hlY2tzIGluIG91ciBzZXR0ZXJzIGFuZCBiZWZvcmUK\nICAgICAqIHRoaXMgbWV0aG9kIGNhbGwpLgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIExpc3Q8U3RyaW5nPiBzcGxpdEV4cHJlc3Npb25zKFN0cmluZyBz\ndHIsIGNoYXIgc3BsaXQsIGludCBleHBlY3RlZCkgewogICAgICAgIGlmIChz\ndHIgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAg\nIExpc3Q8U3RyaW5nPiBleHBzID0gbnVsbDsKICAgICAgICBpbnQgcGFyZW5E\nZXB0aCA9IDA7CiAgICAgICAgaW50IGJlZ2luID0gMCwgcG9zID0gMDsKICAg\nICAgICBib29sZWFuIGVzY2FwZSA9IGZhbHNlOwogICAgICAgIGJvb2xlYW4g\nc3RyaW5nID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBub25zcGFjZSA9IGZh\nbHNlOwogICAgICAgIGNoYXIgcXVvdGUgPSAwOwogICAgICAgIGZvciAoY2hh\nciBjOyBwb3MgPCBzdHIubGVuZ3RoKCk7IHBvcysrKSB7CiAgICAgICAgICAg\nIGMgPSBzdHIuY2hhckF0KHBvcyk7CiAgICAgICAgICAgIGlmIChjID09ICdc\nXCcpIHsKICAgICAgICAgICAgICAgIGVzY2FwZSA9ICFlc2NhcGU7CiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAoZXNjYXBlKSB7CiAgICAgICAgICAgICAgICBlc2NhcGUgPSBmYWxz\nZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nJ1wnJzoKICAgICAgICAgICAgICAgIGNhc2UgJyInOgogICAgICAgICAgICAg\nICAgICAgIGlmIChzdHJpbmcgJiYgcXVvdGUgPT0gYykKICAgICAgICAgICAg\nICAgICAgICAgICAgc3RyaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAg\nICAgZWxzZSBpZiAoIXN0cmluZykgewogICAgICAgICAgICAgICAgICAgICAg\nICBxdW90ZSA9IGM7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyA9\nIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIG5vbnNwYWNlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgJygnOgogICAgICAgICAgICAgICAg\nICAgIGlmICghc3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICBwYXJl\nbkRlcHRoKys7CiAgICAgICAgICAgICAgICAgICAgbm9uc3BhY2UgPSB0cnVl\nOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nY2FzZSAnKSc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdHJpbmcpCiAg\nICAgICAgICAgICAgICAgICAgICAgIHBhcmVuRGVwdGgtLTsKICAgICAgICAg\nICAgICAgICAgICBub25zcGFjZSA9IHRydWU7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcgJzoKICAgICAgICAg\nICAgICAgIGNhc2UgJ1x0JzoKICAgICAgICAgICAgICAgIGNhc2UgJ1xuJzoK\nICAgICAgICAgICAgICAgIGNhc2UgJ1xyJzoKICAgICAgICAgICAgICAgICAg\nICBpZiAoYyA9PSBzcGxpdCAmJiAhc3RyaW5nICYmIHBhcmVuRGVwdGggPT0g\nMCAmJiBub25zcGFjZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nZXhwcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhw\ncyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPihleHBlY3RlZCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGV4cHMuYWRkKHN0ci5zdWJzdHJpbmcoYmVnaW4s\nIHBvcykudHJpbSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW4g\nPSBwb3MgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBub25zcGFjZSA9\nIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGMgPT0gc3BsaXQgJiYgIXN0cmluZyAmJiBwYXJl\nbkRlcHRoID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4\ncHMgPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHMg\nPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oZXhwZWN0ZWQpOwogICAgICAgICAg\nICAgICAgICAgICAgICBleHBzLmFkZChzdHIuc3Vic3RyaW5nKGJlZ2luLCBw\nb3MpLnRyaW0oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJlZ2luID0g\ncG9zICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgbm9uc3BhY2UgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGVzY2FwZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGV4\ncHMgPT0gbnVsbCkgewogICAgICAgICAgICBleHBzID0gQ29sbGVjdGlvbnMu\nc2luZ2xldG9uTGlzdChzdHIpOwogICAgICAgICAgICByZXR1cm4gZXhwczsK\nICAgICAgICB9CgogICAgICAgIC8vIGFkZCBsYXN0IGV4cHJlc3Npb24gYW5k\nIHJldHVybiBhcnJheQogICAgICAgIFN0cmluZyBsYXN0ID0gc3RyLnN1YnN0\ncmluZyhiZWdpbikudHJpbSgpOwogICAgICAgIGlmIChsYXN0Lmxlbmd0aCgp\nID4gMCkKICAgICAgICAgICAgZXhwcy5hZGQobGFzdCk7CiAgICAgICAgcmV0\ndXJuIGV4cHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgdGhlIGdpdmVu\nIGFjY2VzcyBwYXRoIG1ldGFkYXRhcyB0byB0aGUgZnVsbCBwYXRoIGxpc3Qs\nIG1ha2luZyBzdXJlCiAgICAgKiB0byBtYWludGFpbiBvbmx5IGJhc2UgbWV0\nYWRhdGFzIGluIHRoZSBsaXN0LiBUaGUgZ2l2ZW4gbGlzdCBtYXkgYmUgbnVs\nbC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBMaXN0PENsYXNzTWV0YURh\ndGE+IGFkZEFjY2Vzc1BhdGhNZXRhRGF0YXMoTGlzdDxDbGFzc01ldGFEYXRh\nPiBtZXRhcywgQ2xhc3NNZXRhRGF0YVtdIHBhdGgpIHsKICAgICAgICBpZiAo\ncGF0aCA9PSBudWxsIHx8IHBhdGgubGVuZ3RoID09IDApCiAgICAgICAgICAg\nIHJldHVybiBtZXRhczsKCiAgICAgICAgLy8gY3JlYXRlIHNldCBvZiBiYXNl\nIGNsYXNzIG1ldGFkYXRhcyBpbiBhY2Nlc3MgcGF0aAogICAgICAgIGlmICht\nZXRhcyA9PSBudWxsKQogICAgICAgICAgICBtZXRhcyA9IG5ldyBBcnJheUxp\nc3Q8Q2xhc3NNZXRhRGF0YT4oKTsKICAgICAgICBpbnQgbGFzdCA9IG1ldGFz\nLnNpemUoKTsKCiAgICAgICAgLy8gZm9yIGV2ZXJ5IGVsZW1lbnQgaW4gdGhl\nIHBhdGggb2YgdGhpcyBleGVjdXRvciwgY29tcGFyZSBpdAogICAgICAgIC8v\nIHRvIGFscmVhZHktZ2F0aGVyZWQgZWxlbWVudHMgdG8gc2VlIGlmIGl0IHNo\nb3VsZCByZXBsYWNlCiAgICAgICAgLy8gYSBzdWJjbGFzcyBpbiB0aGUgbGlz\ndCBvciBzaG91bGQgYmUgYWRkZWQgYXMgYSBuZXcgYmFzZTsKICAgICAgICAv\nLyBhdCBsZWFzdCBpdCdzIG5eMiBvZiBhIHNtYWxsIG4uLi4KICAgICAgICBD\nbGFzc01ldGFEYXRhIG1ldGE7CiAgICAgICAgYm9vbGVhbiBhZGQ7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgIGFkZCA9IHRydWU7CiAgICAgICAgICAgIGZvciAoaW50IGog\nPSAwOyBhZGQgJiYgaiA8IGxhc3Q7IGorKykgewogICAgICAgICAgICAgICAg\nbWV0YSA9IG1ldGFzLmdldChqKTsKCiAgICAgICAgICAgICAgICBpZiAobWV0\nYS5nZXREZXNjcmliZWRUeXBlKCkuaXNBc3NpZ25hYmxlRnJvbShwYXRoW2ld\nLmdldERlc2NyaWJlZFR5cGUoKSkpIHsKICAgICAgICAgICAgICAgICAgICAv\nLyBsaXN0IGFscmVhZHkgY29udGFpbnMgYmFzZSBjbGFzcwogICAgICAgICAg\nICAgICAgICAgIGFkZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNl\nIGlmIChwYXRoW2ldLmdldERlc2NyaWJlZFR5cGUoKS5pc0Fzc2lnbmFibGVG\ncm9tKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpKSkgewogICAgICAgICAgICAg\nICAgICAgIC8vIHRoaXMgZWxlbWVudCByZXBsYWNlcyBpdHMgc3ViY2xhc3MK\nICAgICAgICAgICAgICAgICAgICBhZGQgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgICAgICBtZXRhcy5zZXQoaiwgcGF0aFtpXSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIG5vIGJhc2Ug\nY2xhc3Mgb2YgY3VycmVudCBwYXRoIGVsZW1lbnQgYWxyZWFkeSBpbgogICAg\nICAgICAgICAvLyBsaXN0IGFuZCBwYXRoIGVsZW1lbnQgZGlkbid0IHJlcGxh\nY2UgYSBzdWJjbGFzcyBpbiB0aGUKICAgICAgICAgICAgLy8gbGlzdCwgdGhl\nbiBhZGQgaXQgbm93IGFzIGEgbmV3IGJhc2UKICAgICAgICAgICAgaWYgKGFk\nZCkKICAgICAgICAgICAgICAgIG1ldGFzLmFkZChwYXRoW2ldKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG1ldGFzOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgdXNlci1naXZlbiBoaW50IHZhbHVlIHRvIGFuIGFn\nZ3JlZ2F0ZSBsaXN0ZW5lci4KICAgICAqIFRoZSBoaW50IGNhbiBiZSBhbiBh\nZ2dyZWdhdGUgbGlzdGVuZXIgaW5zdGFuY2Ugb3IgY2xhc3MgbmFtZS4KICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBBZ2dyZWdhdGVMaXN0ZW5lciBoaW50\nVG9BZ2dyZWdhdGVMaXN0ZW5lcihPYmplY3QgaGludCwgQ2xhc3NMb2FkZXIg\nbG9hZGVyKSB7CiAgICAgICAgaWYgKGhpbnQgPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBB\nZ2dyZWdhdGVMaXN0ZW5lcikKICAgICAgICAgICAgcmV0dXJuIChBZ2dyZWdh\ndGVMaXN0ZW5lcikgaGludDsKCiAgICAgICAgRXhjZXB0aW9uIGNhdXNlID0g\nbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9mIFN0cmluZykgewog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIChBZ2dy\nZWdhdGVMaXN0ZW5lcikgQWNjZXNzQ29udHJvbGxlci5kb1ByaXZpbGVnZWQo\nCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIubmV3SW5zdGFu\nY2VBY3Rpb24oQ2xhc3MuZm9yTmFtZSgoU3RyaW5nKSBoaW50LCB0cnVlLCBs\nb2FkZXIpKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByaXZpbGVnZWRB\nY3Rpb25FeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgZSA9ICgoUHJp\ndmlsZWdlZEFjdGlvbkV4Y2VwdGlvbikgZSkuZ2V0RXhjZXB0aW9uKCk7CiAg\nICAgICAgICAgICAgICBjYXVzZSA9IGU7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nImJhZC1hZ2ctbGlzdGVuZXItaGludCIsIGhpbnQsCiAgICAgICAgICAgIGhp\nbnQuZ2V0Q2xhc3MoKSkpLnNldENhdXNlKGNhdXNlKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIHVzZXItZ2l2ZW4gaGludCB2YWx1ZSB0\nbyBhbiBhcnJheSBvZiBhZ2dyZWdhdGUgbGlzdGVuZXJzLgogICAgICogVGhl\nIGhpbnQgY2FuIGJlIGFuIGFnZ3JlZ2F0ZSBsaXN0ZW5lciwgYWdncmVnYXRl\nIGxpc3RlbmVyIGFycmF5LAogICAgICogY29sbGVjdGlvbiwgb3IgY29tbWEt\nc2VwYXJhdGVkIGNsYXNzIG5hbWVzLgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIEFnZ3JlZ2F0ZUxpc3RlbmVyW10gaGludFRvQWdncmVnYXRlTGlzdGVu\nZXJzKE9iamVjdCBoaW50LCBDbGFzc0xvYWRlciBsb2FkZXIpIHsKICAgICAg\nICBpZiAoaGludCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9mIEFnZ3JlZ2F0ZUxpc3RlbmVy\nW10pCiAgICAgICAgICAgIHJldHVybiAoQWdncmVnYXRlTGlzdGVuZXJbXSkg\naGludDsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9mIEFnZ3JlZ2F0ZUxp\nc3RlbmVyKQogICAgICAgICAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUxpc3Rl\nbmVyW117IChBZ2dyZWdhdGVMaXN0ZW5lcikgaGludCB9OwogICAgICAgIGlm\nIChoaW50IGluc3RhbmNlb2YgQ29sbGVjdGlvbikgewogICAgICAgICAgICBD\nb2xsZWN0aW9uPEFnZ3JlZ2F0ZUxpc3RlbmVyPiBjID0gKENvbGxlY3Rpb248\nQWdncmVnYXRlTGlzdGVuZXI+KSBoaW50OwogICAgICAgICAgICByZXR1cm4g\nYy50b0FycmF5KG5ldyBBZ2dyZWdhdGVMaXN0ZW5lcltjLnNpemUoKV0pOwog\nICAgICAgIH0KCiAgICAgICAgRXhjZXB0aW9uIGNhdXNlID0gbnVsbDsKICAg\nICAgICBpZiAoaGludCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAg\nICBTdHJpbmdbXSBjbHNzID0gU3RyaW5ncy5zcGxpdCgoU3RyaW5nKSBoaW50\nLCAiLCIsIDApOwogICAgICAgICAgICBBZ2dyZWdhdGVMaXN0ZW5lcltdIGFn\nZ3MgPSBuZXcgQWdncmVnYXRlTGlzdGVuZXJbY2xzcy5sZW5ndGhdOwogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBjbHNzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAgICAgICAgIGFn\nZ3NbaV0gPSAoQWdncmVnYXRlTGlzdGVuZXIpIEFjY2Vzc0NvbnRyb2xsZXIu\nZG9Qcml2aWxlZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJp\ndkhlbHBlci5uZXdJbnN0YW5jZUFjdGlvbigKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIENsYXNzLmZvck5hbWUoY2xzc1tpXSwgdHJ1ZSwgbG9hZGVy\nKSkpOyAKICAgICAgICAgICAgICAgIHJldHVybiBhZ2dzOwogICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgaWYg\nKGUgaW5zdGFuY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAg\nICAgICAgICAgICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRp\nb24pIGUpLmdldEV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgY2F1c2Ug\nPSBlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5l\ndyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJiYWQtYWdnLWxpc3RlbmVyLWhp\nbnQiLCBoaW50LAogICAgICAgICAgICBoaW50LmdldENsYXNzKCkpKS5zZXRD\nYXVzZShjYXVzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRo\nZSB1c2VyLWdpdmVuIGhpbnQgdmFsdWUgdG8gYSBmaWx0ZXIgbGlzdGVuZXIu\nCiAgICAgKiBUaGUgaGludCBjYW4gYmUgYSBmaWx0ZXIgbGlzdGVuZXIgaW5z\ndGFuY2Ugb3IgY2xhc3MgbmFtZS4KICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyBGaWx0ZXJMaXN0ZW5lciBoaW50VG9GaWx0ZXJMaXN0ZW5lcihPYmplY3Qg\naGludCwgQ2xhc3NMb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgaWYgKGhpbnQg\nPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYg\nKGhpbnQgaW5zdGFuY2VvZiBGaWx0ZXJMaXN0ZW5lcikKICAgICAgICAgICAg\ncmV0dXJuIChGaWx0ZXJMaXN0ZW5lcikgaGludDsKCiAgICAgICAgRXhjZXB0\naW9uIGNhdXNlID0gbnVsbDsKICAgICAgICBpZiAoaGludCBpbnN0YW5jZW9m\nIFN0cmluZykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIChGaWx0ZXJMaXN0ZW5lcikgQWNjZXNzQ29udHJvbGxlci5kb1By\naXZpbGVnZWQoCiAgICAgICAgICAgICAgICAgICAgSjJEb1ByaXZIZWxwZXIu\nbmV3SW5zdGFuY2VBY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIENs\nYXNzLmZvck5hbWUoKFN0cmluZykgaGludCwgdHJ1ZSwgbG9hZGVyKSkpOyAK\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIGlmIChlIGluc3RhbmNlb2YgUHJpdmlsZWdlZEFjdGlvbkV4Y2Vw\ndGlvbikKICAgICAgICAgICAgICAgICAgICBlID0gKChQcml2aWxlZ2VkQWN0\naW9uRXhjZXB0aW9uKSBlKS5nZXRFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nICAgIGNhdXNlID0gZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgiYmFkLWZpbHRl\nci1saXN0ZW5lci1oaW50IiwgaGludCwKICAgICAgICAgICAgaGludC5nZXRD\nbGFzcygpKSkuc2V0Q2F1c2UoY2F1c2UpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ29udmVydCB0aGUgdXNlci1naXZlbiBoaW50IHZhbHVlIHRvIGFuIGFy\ncmF5IG9mIGZpbHRlciBsaXN0ZW5lcnMuCiAgICAgKiBUaGUgaGludCBjYW4g\nYmUgYSBmaWx0ZXIgbGlzdGVuZXIsIGZpbHRlciBsaXN0ZW5lciBhcnJheSwK\nICAgICAqIGNvbGxlY3Rpb24sIG9yIGNvbW1hLXNlcGFyYXRlZCBjbGFzcyBu\nYW1lcy4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBGaWx0ZXJMaXN0ZW5l\ncltdIGhpbnRUb0ZpbHRlckxpc3RlbmVycyhPYmplY3QgaGludCwgQ2xhc3NM\nb2FkZXIgbG9hZGVyKSB7CiAgICAgICAgaWYgKGhpbnQgPT0gbnVsbCkKICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFu\nY2VvZiBGaWx0ZXJMaXN0ZW5lcltdKQogICAgICAgICAgICByZXR1cm4gKEZp\nbHRlckxpc3RlbmVyW10pIGhpbnQ7CiAgICAgICAgaWYgKGhpbnQgaW5zdGFu\nY2VvZiBGaWx0ZXJMaXN0ZW5lcikKICAgICAgICAgICAgcmV0dXJuIG5ldyBG\naWx0ZXJMaXN0ZW5lcltdeyAoRmlsdGVyTGlzdGVuZXIpIGhpbnQgfTsKICAg\nICAgICBpZiAoaGludCBpbnN0YW5jZW9mIENvbGxlY3Rpb24pIHsKICAgICAg\nICAgICAgQ29sbGVjdGlvbjxGaWx0ZXJMaXN0ZW5lcj4gYyA9IChDb2xsZWN0\naW9uPEZpbHRlckxpc3RlbmVyPikgaGludDsKICAgICAgICAgICAgcmV0dXJu\nIGMudG9BcnJheShuZXcgRmlsdGVyTGlzdGVuZXJbYy5zaXplKCldKTsKICAg\nICAgICB9CgogICAgICAgIEV4Y2VwdGlvbiBjYXVzZSA9IG51bGw7CiAgICAg\nICAgaWYgKGhpbnQgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgICAg\nU3RyaW5nW10gY2xzcyA9IFN0cmluZ3Muc3BsaXQoKFN0cmluZykgaGludCwg\nIiwiLCAwKTsKICAgICAgICAgICAgRmlsdGVyTGlzdGVuZXJbXSBmaWx0cyA9\nIG5ldyBGaWx0ZXJMaXN0ZW5lcltjbHNzLmxlbmd0aF07CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNs\nc3MubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgZmlsdHNbaV0g\nPSAoRmlsdGVyTGlzdGVuZXIpIEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxl\nZ2VkKAogICAgICAgICAgICAgICAgICAgICAgICBKMkRvUHJpdkhlbHBlci5u\nZXdJbnN0YW5jZUFjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIENsYXNzLmZvck5hbWUoY2xzc1tpXSwgdHJ1ZSwgbG9hZGVyKSkpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGZpbHRzOwogICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgaWYgKGUgaW5zdGFu\nY2VvZiBQcml2aWxlZ2VkQWN0aW9uRXhjZXB0aW9uKQogICAgICAgICAgICAg\nICAgICAgIGUgPSAoKFByaXZpbGVnZWRBY3Rpb25FeGNlcHRpb24pIGUpLmdl\ndEV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgY2F1c2UgPSBlOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKF9sb2MuZ2V0KCJiYWQtZmlsdGVyLWxpc3RlbmVyLWhpbnQiLCBo\naW50LAogICAgICAgICAgICBoaW50LmdldENsYXNzKCkpKS5zZXRDYXVzZShj\nYXVzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHZhbHVl\nIG9mIHRoZSBwcm9wZXJ0eSBuYW1lZCBieSB0aGUgaGludCBrZXkuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgT2JqZWN0IGhpbnRUb0dldHRlcihPYmpl\nY3QgdGFyZ2V0LCBTdHJpbmcgaGludEtleSkgewogICAgICAgIGlmICh0YXJn\nZXQgPT0gbnVsbCB8fCBoaW50S2V5ID09IG51bGwpCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwoKICAgICAgICBNZXRob2QgZ2V0dGVyID0gUmVmbGVjdGlv\nbi5maW5kR2V0dGVyKHRhcmdldC5nZXRDbGFzcygpLCBoaW50S2V5LCB0cnVl\nKTsKICAgICAgICByZXR1cm4gUmVmbGVjdGlvbi5nZXQodGFyZ2V0LCBnZXR0\nZXIpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBvZiB0\naGUgcHJvcGVydHkgbmFtZWQgYnkgdGhlIGhpbnQga2V5LgogICAgICovCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgaGludFRvU2V0dGVyKE9iamVjdCB0YXJn\nZXQsIFN0cmluZyBoaW50S2V5LAogICAgICAgIE9iamVjdCB2YWx1ZSkgewog\nICAgICAgIGlmICh0YXJnZXQgPT0gbnVsbCB8fCBoaW50S2V5ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgTWV0aG9kIHNldHRlciA9\nIFJlZmxlY3Rpb24uZmluZFNldHRlcih0YXJnZXQuZ2V0Q2xhc3MoKSwgaGlu\ndEtleSwgdHJ1ZSk7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU3Ry\naW5nKSB7CiAgICAgICAgICAgIGlmICgibnVsbCIuZXF1YWxzKHZhbHVlKSkK\nICAgICAgICAgICAgICAgIHZhbHVlID0gbnVsbDsKICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHZhbHVlID0gU3RyaW5ncy5wYXJzZSgoU3RyaW5nKSB2YWx1ZSwKICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0dGVyLmdldFBhcmFtZXRlclR5cGVzKClb\nMF0pOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihf\nbG9jLmdldCgiYmFkLXNldHRlci1oaW50LWFyZyIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGhpbnRLZXksIHZhbHVlLCBzZXR0ZXIuZ2V0UGFyYW1ldGVy\nVHlwZXMoKVswXSkpLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRDYXVz\nZShlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBSZWZsZWN0aW9uLnNldCh0YXJnZXQsIHNldHRlciwgdmFs\ndWUpOwoJfQogICAgCiAgICAvKioKICAgICAqIFBhcnNlcyB0aGUgZ2l2ZW4g\nc3RyaW5nIGFzc3VtaW5nIGl0IGlzIGEgSkRCQyBrZXkgZXhwcmVzc2lvbi4g\nRXh0cmFjdHMgdGhlIAogICAgICogZGF0YSBwb3J0aW9uIGFuZCBiYXNlZCBv\nbiB0aGUga2V5LCBjYWxscyBzdGF0aWMgamF2YS5zcWwuRGF0ZS9UaW1lL1Rp\nbWVzdGFtcC52YWx1ZU9mKFN0cmluZykKICAgICAqIG1ldGhvZCB0byBjb252\nZXJ0IHRvIGEgamF2YS5zcWwuRGF0ZS9UaW1lL1RpbWVzdGFtcCBpbnN0YW5j\nZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBPYmplY3QgcGFyc2VKREJD\nVGVtcG9yYWxTeW50YXgoU3RyaW5nIHMpIHsKICAgICAgICBzID0gY2xpcChz\nLnRyaW0oKSwgInsiLCAifSIsIHRydWUpOwogICAgICAgIGlmIChzLnN0YXJ0\nc1dpdGgoInRzIikpIHsKICAgICAgICAgICAgcmV0dXJuIGphdmEuc3FsLlRp\nbWVzdGFtcC52YWx1ZU9mKGNsaXAocy5zdWJzdHJpbmcoMikudHJpbSgpLCAi\nJyIsICInIiwgZmFsc2UpKTsKICAgICAgICB9IGVsc2UgaWYgKHMuc3RhcnRz\nV2l0aCgiZCIpKSB7CiAgICAgICAgICAgIHJldHVybiBqYXZhLnNxbC5EYXRl\nLnZhbHVlT2YoY2xpcChzLnN1YnN0cmluZygxKS50cmltKCksICInIiwgIici\nLCBmYWxzZSkpOwogICAgICAgIH0gZWxzZSBpZiAocy5zdGFydHNXaXRoKCJ0\nIikpIHsKICAgICAgICAgICAgcmV0dXJuIGphdmEuc3FsLlRpbWUudmFsdWVP\nZihjbGlwKHMuc3Vic3RyaW5nKDIpLnRyaW0oKSwgIiciLCAiJyIsIGZhbHNl\nKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEFmZmlybXMg\naWYgdGhlIGdpdmVuIFN0cmluZyBpcyBlbmNsb3NlZCBpbiB7fS4KICAgICAq\nIAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaXNKREJDVGVt\ncG9yYWxTeW50YXgoU3RyaW5nIHMpIHsKICAgICAgICBpZiAocyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIHMgPSBzLnRyaW0oKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHMgIT0gbnVsbCAmJiBzLnN0YXJ0c1dpdGgoInsiKSAmJiBz\nLmVuZHNXaXRoKCJ9Iik7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmVt\nb3ZlcyB0aGUgZmlyc3QgYW5kIGxhc3Qgc3RyaW5nIGlmIHRoZXkgYXJlIHRo\nZSB0ZXJtaW5hbCBzZXF1ZW5jZSBpbiB0aGUgZ2l2ZW4gc3RyaW5nLgogICAg\nICogCiAgICAgKiBAcGFyYW0gcyBhIHN0cmluZyB0byBiZSBleGFtaW5lZAog\nICAgICogQHBhcmFtIGZpcnN0IHRoZSBjaGFyYWN0ZXJzIGluIHRoZSBiZWdp\nbm5pbmcgb2YgdGhlIGdpdmVuIHN0cmluZwogICAgICogQHBhcmFtIGxhc3Qg\ndGhlIGNoYXJhY3RlcnMgaW4gdGhlIGVuZCBvZiB0aGUgZ2l2ZW4gc3RyaW5n\nCiAgICAgKiBAcGFyYW0gZmFpbCBpZiB0cnVlIHRocm93cyBleGNlcHRpb24g\naWYgdGhlIGdpdmVuIHN0cmluZyBkb2VzIG5vdCBoYXZlIHRoZSBnaXZlbiB0\nZXJtaW5hbCBzZXF1ZW5jZXMuCiAgICAgKiBAcmV0dXJuIHRoZSBzdHJpbmcg\nd2l0aCB0ZXJtaW5hbCBzZXF1ZW5jZXMgcmVtb3ZlZC4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBTdHJpbmcgY2xpcChTdHJpbmcgcywgU3RyaW5nIGZp\ncnN0LCBTdHJpbmcgbGFzdCwgYm9vbGVhbiBmYWlsKSB7CiAgICAgICAgaWYg\nKHMgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgaWYg\nKHMuc3RhcnRzV2l0aChmaXJzdCkgJiYgcy5lbmRzV2l0aChsYXN0KSkgewog\nICAgICAgICAgICByZXR1cm4gcy5zdWJzdHJpbmcoZmlyc3QubGVuZ3RoKCks\nIHMubGVuZ3RoKCktbGFzdC5sZW5ndGgoKSkudHJpbSgpOwogICAgICAgIH0K\nICAgICAgICBpZiAoZmFpbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKHMgKyAiIGlzIG5vdCB2YWxpZCBlc2Nh\ncGUgc3ludGF4IGZvciBKREJDIik7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBzOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhl\nIGdpdmVuIGNsYXNzIGlzIERhdGEsIFRpbWUgb3IgVGltZXN0YW1wLgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaXNUZW1wb3JhbFR5cGUo\nQ2xhc3M8Pz4gYykgewogICAgICAgIHJldHVybiBjICE9IG51bGwgCiAgICAg\nICAgICAgICYmIChEYXRlLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oYykgCiAg\nICAgICAgICAgICB8fCBUaW1lLmNsYXNzLmlzQXNzaWduYWJsZUZyb20oYykg\nCiAgICAgICAgICAgICB8fCBUaW1lc3RhbXAuY2xhc3MuaXNBc3NpZ25hYmxl\nRnJvbShjKQogICAgICAgICAgICAgfHwgQ2FsZW5kYXIuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShjKSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nT2JqZWN0IGdldERlZmF1bHRGb3JOdWxsKENsYXNzPD8+IG5UeXBlKSB7CiAg\nICAgICAgaWYgKG5UeXBlID09IExvbmcuY2xhc3MpIAogICAgICAgICAgICBy\nZXR1cm4gbmV3IExvbmcoMCk7CiAgICAgICAgaWYgKG5UeXBlID09IEludGVn\nZXIuY2xhc3MpCiAgICAgICAgICAgIHJldHVybiBuZXcgSW50ZWdlcigwKTsK\nICAgICAgICBpZiAoblR5cGUgPT0gRG91YmxlLmNsYXNzKSAKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBEb3VibGUoMC4wKTsKICAgICAgICBpZiAoblR5cGUg\nPT0gRmxvYXQuY2xhc3MpIAogICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0\nKDAuMCk7CiAgICAgICAgaWYgKG5UeXBlID09IFNob3J0LmNsYXNzKSAKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydCgoc2hvcnQpMCk7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

