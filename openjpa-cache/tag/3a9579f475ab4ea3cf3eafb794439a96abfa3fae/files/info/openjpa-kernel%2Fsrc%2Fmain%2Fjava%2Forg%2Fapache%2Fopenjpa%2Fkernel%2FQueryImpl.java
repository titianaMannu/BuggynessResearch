{"sha":"811cb9019011c28cd2f376abd91cd99e2fcc996b","node_id":"MDQ6QmxvYjIwNjM2NDo4MTFjYjkwMTkwMTFjMjhjZDJmMzc2YWJkOTFjZDk5ZTJmY2M5OTZi","size":75314,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/811cb9019011c28cd2f376abd91cd99e2fcc996b","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uU2VyaWFsaXphYmxlOwppbXBvcnQgamF2YS5zZWN1cml0eS5BY2Nl\nc3NDb250cm9sbGVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdEl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LmxvY2tzLlJlZW50cmFudExvY2s7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MaW5rZWRNYXA7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5PYmplY3RVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmNvbmYuT3BlbkpQQUNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5QZXJzaXN0\nZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVs\nLmV4cHMuQWdncmVnYXRlTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEua2VybmVsLmV4cHMuQ29uc3RhbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEua2VybmVsLmV4cHMuRmlsdGVyTGlzdGVuZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuTGl0ZXJhbDsKaW1wb3J0\nIG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwuZXhwcy5QYXRoOwppbXBvcnQg\nb3JnLmFwYWNoZS5vcGVuanBhLmtlcm5lbC5leHBzLlF1ZXJ5RXhwcmVzc2lv\nbnM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHMuVmFs\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5sb2cuTG9nOwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuRWFnZXJSZXN1bHRMaXN0\nOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuTGlzdFJlc3Vs\ndExpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5NZXJn\nZWRSZXN1bHRPYmplY3RQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5saWIucm9wLlJhbmdlUmVzdWx0T2JqZWN0UHJvdmlkZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnJvcC5SZXN1bHRMaXN0OwppbXBv\ncnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi5yb3AuUmVzdWx0T2JqZWN0UHJv\ndmlkZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwuSjJE\nb1ByaXZIZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0\naWwuTG9jYWxpemVyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51\ndGlsLk9yZGVyZWRNYXA7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuUmVmZXJlbmNlSGFzaFNldDsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLkNsYXNzTWV0YURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5GaWVsZE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuSmF2YVR5cGVzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLm1ldGEuTWV0YURhdGFSZXBvc2l0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5vcGVuanBhLnV0aWwuR2VuZXJhbEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEudXRpbC5JbnZhbGlkU3RhdGVFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Ob1Jlc3VsdEV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk5vblVuaXF1ZVJlc3Vs\ndEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLk9w\nZW5KUEFFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRp\nbC5VbnN1cHBvcnRlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS51dGlsLlVzZXJFeGNlcHRpb247CgppbXBvcnQgc2VycC51dGlsLlN0\ncmluZ3M7CgovKioKICogSW1wbGVtZW50YXRpb24gb2YgdGhlIHtAbGluayBR\ndWVyeX0gaW50ZXJmYWNlLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKiBA\nbm9qYXZhZG9jCiAqLwpAU3VwcHJlc3NXYXJuaW5ncygic2VyaWFsIikKcHVi\nbGljIGNsYXNzIFF1ZXJ5SW1wbAogICAgaW1wbGVtZW50cyBRdWVyeSB7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2Nh\nbGl6ZXIuZm9yUGFja2FnZShRdWVyeUltcGwuY2xhc3MpOwoKICAgIHByaXZh\ndGUgZmluYWwgU3RyaW5nIF9sYW5ndWFnZTsKICAgIHByaXZhdGUgZmluYWwg\nU3RvcmVRdWVyeSBfc3RvcmVRdWVyeTsKICAgIHByaXZhdGUgdHJhbnNpZW50\nIGZpbmFsIEJyb2tlckltcGwgX2Jyb2tlcjsKICAgIHByaXZhdGUgdHJhbnNp\nZW50IGZpbmFsIExvZyBfbG9nOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ2xh\nc3NMb2FkZXIgX2xvYWRlciA9IG51bGw7CgogICAgLy8gcXVlcnkgaGFzIGl0\ncyBvd24gaW50ZXJuYWwgbG9jawogICAgcHJpdmF0ZSBSZWVudHJhbnRMb2Nr\nIF9sb2NrOwoKICAgIC8vIHVucGFyc2VkIHN0YXRlCiAgICBwcml2YXRlIENs\nYXNzPD8+IF9jbGFzcyA9IG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gX3N1\nYmNsYXNzZXMgPSB0cnVlOwogICAgcHJpdmF0ZSBib29sZWFuIF9yZWFkT25s\neSA9IGZhbHNlOwogICAgcHJpdmF0ZSBTdHJpbmcgX3F1ZXJ5ID0gbnVsbDsK\nICAgIHByaXZhdGUgU3RyaW5nIF9wYXJhbXMgPSBudWxsOwoKICAgIC8vIHBh\ncnNlZCBzdGF0ZQogICAgcHJpdmF0ZSB0cmFuc2llbnQgQ29tcGlsYXRpb24g\nX2NvbXBpbGVkID0gbnVsbDsKICAgIHByaXZhdGUgdHJhbnNpZW50IGJvb2xl\nYW4gX2NvbXBpbGluZyA9IGZhbHNlOwogICAgcHJpdmF0ZSB0cmFuc2llbnQg\nUmVzdWx0UGFja2VyIF9wYWNrZXIgPSBudWxsOwoKICAgIC8vIGNhbmRpZGF0\nZXMKICAgIHByaXZhdGUgdHJhbnNpZW50IENvbGxlY3Rpb248Pz4gX2NvbGxl\nY3Rpb24gPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgRXh0ZW50IF9l\neHRlbnQgPSBudWxsOwoKICAgIC8vIGxpc3RlbmVycwogICAgcHJpdmF0ZSBN\nYXA8U3RyaW5nLEZpbHRlckxpc3RlbmVyPiBfZmlsdExpc3RlbmVycyA9IG51\nbGw7CiAgICBwcml2YXRlIE1hcDxTdHJpbmcsQWdncmVnYXRlTGlzdGVuZXI+\nIF9hZ2dMaXN0ZW5lcnMgPSBudWxsOwoKICAgIC8vIGNvbmZpZ3VyYXRpb24g\nZm9yIGxvYWRpbmcgb2JqZWN0cwogICAgcHJpdmF0ZSBGZXRjaENvbmZpZ3Vy\nYXRpb24gX2ZjID0gbnVsbDsKICAgIHByaXZhdGUgYm9vbGVhbiBfaWdub3Jl\nQ2hhbmdlcyA9IGZhbHNlOwogICAgcHJpdmF0ZSBDbGFzczw/PiBfcmVzdWx0\nTWFwcGluZ1Njb3BlID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIF9yZXN1\nbHRNYXBwaW5nTmFtZSA9IG51bGw7CgogICAgLy8gdGhlc2UgZmllbGRzIHNo\nb3VsZCBvbmx5IGJlIHVzZWQgZGlyZWN0bHkgYWZ0ZXIgd2UgaGF2ZSBhIGNv\nbXBpbGF0aW9uLAogICAgLy8gYmVjYXVzZSB0aGVpciB2YWx1ZXMgbWF5IGJl\nIGVuY29kZWQgaW4gdGhlIHF1ZXJ5IHN0cmluZwogICAgcHJpdmF0ZSBCb29s\nZWFuIF91bmlxdWUgPSBudWxsOwogICAgcHJpdmF0ZSBDbGFzczw/PiBfcmVz\ndWx0Q2xhc3MgPSBudWxsOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBf\nc3RhcnRJZHggPSAwOwogICAgcHJpdmF0ZSB0cmFuc2llbnQgbG9uZyBfZW5k\nSWR4ID0gTG9uZy5NQVhfVkFMVUU7CiAgICBwcml2YXRlIHRyYW5zaWVudCBi\nb29sZWFuIF9yYW5nZVNldCA9IGZhbHNlOwoKICAgIC8vIHJlbWVtYmVyIHRo\nZSBsaXN0IG9mIGFsbCB0aGUgcmVzdWx0cyB3ZSBoYXZlIHJldHVybmVkIHNv\nIHdlCiAgICAvLyBjYW4gZnJlZSB0aGVpciByZXNvdXJjZXMgd2hlbiBjbG9z\nZSBvciBjbG9zZUFsbCBpcyBjYWxsZWQKICAgIHByaXZhdGUgdHJhbnNpZW50\nIGZpbmFsIENvbGxlY3Rpb248UmVtb3ZlT25DbG9zZVJlc3VsdExpc3Q+IF9y\nZXN1bHRMaXN0cyA9IAogICAgICAgIG5ldyBSZWZlcmVuY2VIYXNoU2V0KFJl\nZmVyZW5jZUhhc2hTZXQuV0VBSyk7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1\nY3QgYSBxdWVyeSBtYW5hZ2VkIGJ5IHRoZSBnaXZlbiBicm9rZXIuCiAgICAg\nKi8KICAgIHB1YmxpYyBRdWVyeUltcGwoQnJva2VyIGJyb2tlciwgU3RyaW5n\nIGxhbmd1YWdlLCBTdG9yZVF1ZXJ5IHN0b3JlUXVlcnkpIHsKICAgICAgICBf\nYnJva2VyID0gKEJyb2tlckltcGwpIGJyb2tlcjsKICAgICAgICBfbGFuZ3Vh\nZ2UgPSBsYW5ndWFnZTsKICAgICAgICBfc3RvcmVRdWVyeSA9IHN0b3JlUXVl\ncnk7CiAgICAgICAgX2ZjID0gKEZldGNoQ29uZmlndXJhdGlvbikgYnJva2Vy\nLmdldEZldGNoQ29uZmlndXJhdGlvbigpLmNsb25lKCk7CiAgICAgICAgX2xv\nZyA9IGJyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TG9nKE9wZW5KUEFD\nb25maWd1cmF0aW9uLkxPR19RVUVSWSk7CiAgICAgICAgX3N0b3JlUXVlcnku\nc2V0Q29udGV4dCh0aGlzKTsKCiAgICAgICAgaWYgKF9icm9rZXIgIT0gbnVs\nbCAmJiBfYnJva2VyLmdldE11bHRpdGhyZWFkZWQoKSkKICAgICAgICAgICAg\nX2xvY2sgPSBuZXcgUmVlbnRyYW50TG9jaygpOwogICAgfQoKICAgIC8qKgog\nICAgICogSW50ZXJuYWwgc3RvcmUgcXVlcnkuCiAgICAgKi8KICAgIHB1Ymxp\nYyBTdG9yZVF1ZXJ5IGdldFN0b3JlUXVlcnkoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdG9yZVF1ZXJ5OwogICAgfQoKICAgIHB1YmxpYyBCcm9rZXIgZ2V0QnJv\na2VyKCkgewogICAgICAgIHJldHVybiBfYnJva2VyOwogICAgfQoKICAgIHB1\nYmxpYyBRdWVyeSBnZXRRdWVyeSgpIHsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgU3RvcmVDb250ZXh0IGdldFN0b3JlQ29udGV4\ndCgpIHsKICAgICAgICByZXR1cm4gX2Jyb2tlcjsKICAgIH0KCiAgICBwdWJs\naWMgU3RyaW5nIGdldExhbmd1YWdlKCkgewogICAgICAgIHJldHVybiBfbGFu\nZ3VhZ2U7CiAgICB9CgogICAgcHVibGljIEZldGNoQ29uZmlndXJhdGlvbiBn\nZXRGZXRjaENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIF9mYzsK\nICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFF1ZXJ5U3RyaW5nKCkgewog\nICAgICAgIHJldHVybiBfcXVlcnk7CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gZ2V0SWdub3JlQ2hhbmdlcygpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7\nCiAgICAgICAgcmV0dXJuIF9pZ25vcmVDaGFuZ2VzOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHNldElnbm9yZUNoYW5nZXMoYm9vbGVhbiBmbGFnKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2Vy\ndE9wZW4oKTsKICAgICAgICAgICAgLy8gYWxsb3dlZCBtb2RpZmljYXRpb246\nIG5vIHJlYWQtb25seSBjaGVjawogICAgICAgICAgICBfaWdub3JlQ2hhbmdl\ncyA9IGZsYWc7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nUmVhZE9ubHkoKSB7CiAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgIHJl\ndHVybiBfcmVhZE9ubHk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVh\nZE9ubHkoYm9vbGVhbiBmbGFnKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAg\nX3JlYWRPbmx5ID0gZmxhZzsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgYWRkRmlsdGVyTGlzdGVuZXIoRmlsdGVyTGlzdGVuZXIgbGlzdGVuZXIp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgp\nOwogICAgICAgICAgICBpZiAoX2ZpbHRMaXN0ZW5lcnMgPT0gbnVsbCkKICAg\nICAgICAgICAgICAgIF9maWx0TGlzdGVuZXJzID0gbmV3IEhhc2hNYXA8U3Ry\naW5nLEZpbHRlckxpc3RlbmVyPig1KTsKICAgICAgICAgICAgX2ZpbHRMaXN0\nZW5lcnMucHV0KGxpc3RlbmVyLmdldFRhZygpLCBsaXN0ZW5lcik7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZUZpbHRlckxpc3RlbmVy\nKEZpbHRlckxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgaWYgKF9m\naWx0TGlzdGVuZXJzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfZmlsdExp\nc3RlbmVycy5yZW1vdmUobGlzdGVuZXIuZ2V0VGFnKCkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxGaWx0ZXJMaXN0ZW5lcj4gZ2V0\nRmlsdGVyTGlzdGVuZXJzKCkgewogICAgICAgIGlmIChfZmlsdExpc3RlbmVy\ncyA9PSBudWxsKSAKICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLmVt\ncHR5TGlzdCgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIF9m\naWx0TGlzdGVuZXJzLnZhbHVlcygpOwogICAgfQoKICAgIHB1YmxpYyBGaWx0\nZXJMaXN0ZW5lciBnZXRGaWx0ZXJMaXN0ZW5lcihTdHJpbmcgdGFnKSB7CiAg\nICAgICAgLy8gZmlyc3QgY2hlY2sgbGlzdGVuZXJzIGZvciB0aGlzIHF1ZXJ5\nCiAgICAgICAgaWYgKF9maWx0TGlzdGVuZXJzICE9IG51bGwpIHsKICAgICAg\nICAgICAgRmlsdGVyTGlzdGVuZXIgbGlzdGVuID0gKEZpbHRlckxpc3RlbmVy\nKSBfZmlsdExpc3RlbmVycy5nZXQodGFnKTsKICAgICAgICAgICAgaWYgKGxp\nc3RlbiAhPSBudWxsKQogICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RlbjsK\nICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIHVzZXItZGVmaW5lZCBsaXN0\nZW5lcnMgZnJvbSBjb25maWd1cmF0aW9uCiAgICAgICAgRmlsdGVyTGlzdGVu\nZXJbXSBjb25mTGlzdGVuZXJzID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9u\nKCkuCiAgICAgICAgICAgIGdldEZpbHRlckxpc3RlbmVySW5zdGFuY2VzKCk7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb25mTGlzdGVuZXJzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoY29uZkxpc3RlbmVyc1tpXS5n\nZXRUYWcoKS5lcXVhbHModGFnKSkKICAgICAgICAgICAgICAgIHJldHVybiBj\nb25mTGlzdGVuZXJzW2ldOwoKICAgICAgICAvLyBjaGVjayBzdG9yZSBsaXN0\nZW5lcnMKICAgICAgICByZXR1cm4gX3N0b3JlUXVlcnkuZ2V0RmlsdGVyTGlz\ndGVuZXIodGFnKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRBZ2dyZWdh\ndGVMaXN0ZW5lcihBZ2dyZWdhdGVMaXN0ZW5lciBsaXN0ZW5lcikgewogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRP\ncGVuKCk7CiAgICAgICAgICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAg\nICAgICAgIGlmIChfYWdnTGlzdGVuZXJzID09IG51bGwpCiAgICAgICAgICAg\nICAgICBfYWdnTGlzdGVuZXJzID0gbmV3IEhhc2hNYXA8U3RyaW5nLEFnZ3Jl\nZ2F0ZUxpc3RlbmVyPig1KTsKICAgICAgICAgICAgX2FnZ0xpc3RlbmVycy5w\ndXQobGlzdGVuZXIuZ2V0VGFnKCksIGxpc3RlbmVyKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIHZvaWQgcmVtb3ZlQWdncmVnYXRlTGlzdGVuZXIoQWdn\ncmVnYXRlTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAg\nICAgICBhc3NlcnROb3RSZWFkT25seSgpOwogICAgICAgICAgICBpZiAoX2Fn\nZ0xpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2FnZ0xpc3Rl\nbmVycy5yZW1vdmUobGlzdGVuZXIuZ2V0VGFnKCkpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgQ29sbGVjdGlvbjxBZ2dyZWdhdGVMaXN0ZW5lcj4gZ2V0\nQWdncmVnYXRlTGlzdGVuZXJzKCkgewogICAgICAgIGlmIChfYWdnTGlzdGVu\nZXJzID09IG51bGwpIAogICAgICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMu\nZW1wdHlMaXN0KCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4g\nX2FnZ0xpc3RlbmVycy52YWx1ZXMoKTsKICAgIH0KCiAgICBwdWJsaWMgQWdn\ncmVnYXRlTGlzdGVuZXIgZ2V0QWdncmVnYXRlTGlzdGVuZXIoU3RyaW5nIHRh\nZykgewogICAgICAgIC8vIGZpcnN0IGNoZWNrIGxpc3RlbmVycyBmb3IgdGhp\ncyBxdWVyeQogICAgICAgIGlmIChfYWdnTGlzdGVuZXJzICE9IG51bGwpIHsK\nICAgICAgICAgICAgQWdncmVnYXRlTGlzdGVuZXIgbGlzdGVuID0gKEFnZ3Jl\nZ2F0ZUxpc3RlbmVyKSBfYWdnTGlzdGVuZXJzLgogICAgICAgICAgICAgICAg\nZ2V0KHRhZyk7CiAgICAgICAgICAgIGlmIChsaXN0ZW4gIT0gbnVsbCkKICAg\nICAgICAgICAgICAgIHJldHVybiBsaXN0ZW47CiAgICAgICAgfQoKICAgICAg\nICAvLyBjaGVjayB1c2VyLWRlZmluZWQgbGlzdGVuZXJzIGZyb20gY29uZmln\ndXJhdGlvbgogICAgICAgIEFnZ3JlZ2F0ZUxpc3RlbmVyW10gY29uZkxpc3Rl\nbmVycyA9IF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAg\nICBnZXRBZ2dyZWdhdGVMaXN0ZW5lckluc3RhbmNlcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgY29uZkxpc3RlbmVycy5sZW5ndGg7IGkrKykK\nICAgICAgICAgICAgaWYgKGNvbmZMaXN0ZW5lcnNbaV0uZ2V0VGFnKCkuZXF1\nYWxzKHRhZykpCiAgICAgICAgICAgICAgICByZXR1cm4gY29uZkxpc3RlbmVy\nc1tpXTsKCiAgICAgICAgLy8gY2hlY2sgc3RvcmUgbGlzdGVuZXJzCiAgICAg\nICAgcmV0dXJuIF9zdG9yZVF1ZXJ5LmdldEFnZ3JlZ2F0ZUxpc3RlbmVyKHRh\nZyk7CiAgICB9CgogICAgcHVibGljIEV4dGVudCBnZXRDYW5kaWRhdGVFeHRl\nbnQoKSB7CiAgICAgICAgLy8gaWYganVzdCB0aGUgY2xhc3MgaXMgc2V0LCBm\nZXRjaCB0aGUgY29ycmVzcG9uZGluZyBleHRlbnQ7IGlmIHRoZQogICAgICAg\nIC8vIGV4dGVudCBpcyBhbHJlYWR5IHNldCBidXQgaXRzIGlnbm9yZSBjYWNo\nZSBzZXR0aW5nIGlzIHdyb25nLAogICAgICAgIC8vIGdldCBhIG5ldyBleHRl\nbnQgd2l0aCB0aGUgY29ycmVjdCBzZXR0aW5nIChkb24ndCBtb2RpZnkgb3Jp\nZyBleHRlbnQKICAgICAgICAvLyBpbiBjYXNlIHRoZSB1c2VyIGhhcyBhIHJl\nZmVyZW5jZSB0byBpdCBhbmQgbWlnaHQgdXNlIGl0KQogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFzczw/PiBjbHMgPSBn\nZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAgICAgICAgIGlmIChfZXh0ZW50ID09\nIG51bGwgJiYgX2NvbGxlY3Rpb24gPT0gbnVsbCAmJiBfYnJva2VyICE9IG51\nbGwKICAgICAgICAgICAgICAgICYmIGNscyAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBfZXh0ZW50ID0gX2Jyb2tlci5uZXdFeHRlbnQoY2xzLCBfc3Vi\nY2xhc3Nlcyk7CiAgICAgICAgICAgICAgICBfZXh0ZW50LnNldElnbm9yZUNo\nYW5nZXMoX2lnbm9yZUNoYW5nZXMpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKF9leHRlbnQgIT0gbnVsbAogICAgICAgICAgICAgICAgJiYgX2V4dGVudC5n\nZXRJZ25vcmVDaGFuZ2VzKCkgIT0gX2lnbm9yZUNoYW5nZXMgJiYgY2xzICE9\nIG51bGwpewogICAgICAgICAgICAgICAgX2V4dGVudCA9IF9icm9rZXIubmV3\nRXh0ZW50KGNscywgX2V4dGVudC5oYXNTdWJjbGFzc2VzKCkpOwogICAgICAg\nICAgICAgICAgX2V4dGVudC5zZXRJZ25vcmVDaGFuZ2VzKF9pZ25vcmVDaGFu\nZ2VzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX2V4dGVu\ndDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0Q2FuZGlkYXRl\nRXh0ZW50KEV4dGVudCBjYW5kaWRhdGVFeHRlbnQpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwog\nICAgICAgICAgICBhc3NlcnROb3RSZWFkT25seSgpOwoKICAgICAgICAgICAg\naWYgKGNhbmRpZGF0ZUV4dGVudCA9PSBfZXh0ZW50KQogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoY2FuZGlkYXRlRXh0ZW50ID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIF9leHRlbnQgPSBudWxsOwogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBpZiBleHRlbnQgdGhlbiBub3QgY29sbGVjdGlvbgogICAgICAgICAg\nICBfZXh0ZW50ID0gY2FuZGlkYXRlRXh0ZW50OwogICAgICAgICAgICBfY29s\nbGVjdGlvbiA9IG51bGw7CgogICAgICAgICAgICBib29sZWFuIGludmFsaWRh\ndGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKF9leHRlbnQuZ2V0RWxlbWVu\ndFR5cGUoKSAhPSBfY2xhc3MpIHsKICAgICAgICAgICAgICAgIF9jbGFzcyA9\nIF9leHRlbnQuZ2V0RWxlbWVudFR5cGUoKTsKICAgICAgICAgICAgICAgIF9s\nb2FkZXIgPSBudWxsOwogICAgICAgICAgICAgICAgaW52YWxpZGF0ZSA9IHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9leHRlbnQuaGFz\nU3ViY2xhc3NlcygpICE9IF9zdWJjbGFzc2VzKSB7CiAgICAgICAgICAgICAg\nICBfc3ViY2xhc3NlcyA9IF9leHRlbnQuaGFzU3ViY2xhc3NlcygpOwogICAg\nICAgICAgICAgICAgaW52YWxpZGF0ZSA9IHRydWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKGludmFsaWRhdGUpCiAgICAgICAgICAgICAgICBp\nbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENvbGxlY3Rpb248Pz4gZ2V0Q2FuZGlkYXRlQ29sbGVjdGlvbigpIHsK\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgcmV0dXJuIF9jb2xsZWN0\naW9uOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldENhbmRpZGF0ZUNvbGxl\nY3Rpb24oQ29sbGVjdGlvbjw/PiBjYW5kaWRhdGVDb2xsZWN0aW9uKSB7CiAg\nICAgICAgaWYgKCFfc3RvcmVRdWVyeS5zdXBwb3J0c0luTWVtb3J5RXhlY3V0\naW9uKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2Vw\ndGlvbihfbG9jLmdldCgicXVlcnktbm9zdXBwb3J0IiwKICAgICAgICAgICAg\nICAgIF9sYW5ndWFnZSkpOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwoKICAgICAgICAgICAgLy8g\naWYgY29sbGVjdGlvbiB0aGVuIG5vdCBleHRlbnQKICAgICAgICAgICAgX2Nv\nbGxlY3Rpb24gPSBjYW5kaWRhdGVDb2xsZWN0aW9uOwogICAgICAgICAgICBp\nZiAoX2NvbGxlY3Rpb24gIT0gbnVsbCkKICAgICAgICAgICAgICAgIF9leHRl\nbnQgPSBudWxsOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQ2xhc3MgZ2V0\nQ2FuZGlkYXRlVHlwZSgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAgICBpZiAo\nX2NsYXNzICE9IG51bGwgfHwgX2NvbXBpbGVkICE9IG51bGwgfHwgX3F1ZXJ5\nID09IG51bGwKICAgICAgICAgICAgICAgIHx8IF9icm9rZXIgPT0gbnVsbCkK\nICAgICAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CgogICAgICAgICAgICAv\nLyBjaGVjayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2Rl\nZCBpbiBzdHJpbmcKICAgICAgICAgICAgY29tcGlsZUZvckNvbXBpbGF0aW9u\nKCk7CiAgICAgICAgICAgIHJldHVybiBfY2xhc3M7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHNldENhbmRpZGF0ZVR5cGUoQ2xhc3MgY2FuZGlk\nYXRlQ2xhc3MsIGJvb2xlYW4gc3VicykgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nICAgIGFzc2VydE5vdFJlYWRPbmx5KCk7CiAgICAgICAgICAgIF9jbGFzcyA9\nIGNhbmRpZGF0ZUNsYXNzOwogICAgICAgICAgICBfc3ViY2xhc3NlcyA9IHN1\nYnM7CiAgICAgICAgICAgIF9sb2FkZXIgPSBudWxsOwogICAgICAgICAgICBp\nbnZhbGlkYXRlQ29tcGlsYXRpb24oKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3ViY2xhc3NlcygpIHsKICAgICAgICByZXR1cm4g\nX3N1YmNsYXNzZXM7CiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRSZXN1\nbHRNYXBwaW5nTmFtZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgcmV0dXJuIF9yZXN1bHRNYXBwaW5nTmFtZTsKICAgIH0KCiAgICBwdWJs\naWMgQ2xhc3MgZ2V0UmVzdWx0TWFwcGluZ1Njb3BlKCkgewogICAgICAgIGFz\nc2VydE9wZW4oKTsKICAgICAgICByZXR1cm4gX3Jlc3VsdE1hcHBpbmdTY29w\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRSZXN1bHRNYXBwaW5nKENs\nYXNzPD8+IHNjb3BlLCBTdHJpbmcgbmFtZSkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgICAgIF9yZXN1bHRNYXBwaW5nU2NvcGUgPSBzY29wZTsKICAgICAgICAg\nICAgX3Jlc3VsdE1hcHBpbmdOYW1lID0gbmFtZTsKICAgICAgICAgICAgX3Bh\nY2tlciA9IG51bGw7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzVW5pcXVlKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfdW5p\ncXVlICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX3VuaXF1ZS5i\nb29sZWFuVmFsdWUoKTsKICAgICAgICAgICAgaWYgKChfcXVlcnkgPT0gbnVs\nbCAmJiBfbGFuZ3VhZ2UuZW5kc1dpdGgoIkpQUUwiKSkgfHwgX2NvbXBpbGlu\nZyB8fCBfYnJva2VyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgICAgICAvLyBjaGVjayBhZ2FpbiBhZnRlciBjb21w\naWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBzdHJpbmcKICAgICAgICAgICAg\naWYgKF9jb21waWxlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb21w\naWxlRm9yQ29tcGlsYXRpb24oKTsKICAgICAgICAgICAgICAgIGlmIChfdW5p\ncXVlICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF91bmlx\ndWUuYm9vbGVhblZhbHVlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIG5vIGV4cGxpY2l0IHNldHRpbmc7IGRlZmF1bHQKICAgICAgICAgICAg\nU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigp\nOwogICAgICAgICAgICBpZiAoIWV4LmlzQWdncmVnYXRlKF9zdG9yZVF1ZXJ5\nKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\ncmV0dXJuICFleC5oYXNHcm91cGluZyhfc3RvcmVRdWVyeSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQogICAgCiAgICAvKioKICAgICAqIEFmZmlybXMgaWYgdGhpcyBxdWVy\neSBoYXMgb3JpZ2luYXRlZCBieSBwYXJzaW5nIGEgc3RyaW5nLWJhc2VkIHF1\nZXJ5LgogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BhcnNlZFF1ZXJ5\nKCkgewogICAgICAgIHJldHVybiBnZXRRdWVyeVN0cmluZygpICE9IG51bGw7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VW5pcXVlKGJvb2xlYW4gdW5p\ncXVlKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAgYXNzZXJ0Tm90UmVhZE9u\nbHkoKTsKICAgICAgICAgICAgX3VuaXF1ZSA9ICh1bmlxdWUpID8gQm9vbGVh\nbi5UUlVFIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENsYXNzIGdldFJlc3VsdFR5cGUoKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAg\nICAgICAgaWYgKF9yZXN1bHRDbGFzcyAhPSBudWxsIHx8IF9jb21waWxlZCAh\nPSBudWxsIHx8IF9xdWVyeSA9PSBudWxsCiAgICAgICAgICAgICAgICB8fCBf\nYnJva2VyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gX3Jlc3Vs\ndENsYXNzOwoKICAgICAgICAgICAgLy8gY2hlY2sgYWdhaW4gYWZ0ZXIgY29t\ncGlsYXRpb247IG1heWJlIGVuY29kZWQgaW4gc3RyaW5nCiAgICAgICAgICAg\nIGNvbXBpbGVGb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICByZXR1cm4g\nX3Jlc3VsdENsYXNzOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\nZXRSZXN1bHRUeXBlKENsYXNzIGNscykgewogICAgICAgIGxvY2soKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAg\nICAgIC8vIGFsbG93ZWQgbW9kaWZpY2F0aW9uOiBubyByZWFkLW9ubHkgY2hl\nY2sKICAgICAgICAgICAgX3Jlc3VsdENsYXNzID0gY2xzOwogICAgICAgICAg\nICBfcGFja2VyID0gbnVsbDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxv\nbmcgZ2V0U3RhcnRSYW5nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAg\nICAgICAgcmV0dXJuIF9zdGFydElkeDsKICAgIH0KCiAgICBwdWJsaWMgbG9u\nZyBnZXRFbmRSYW5nZSgpIHsKICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAg\nICAgcmV0dXJuIF9lbmRJZHg7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0\nUmFuZ2UobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsKICAgICAgICBpZiAoc3Rh\ncnQgPCAwIHx8IGVuZCA8IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2Vy\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbnZhbGlkLXJhbmdlIiwKICAgICAgICAg\nICAgICAgIFN0cmluZy52YWx1ZU9mKHN0YXJ0KSwgU3RyaW5nLnZhbHVlT2Yo\nZW5kKSkpOwoKICAgICAgICBpZiAoZW5kIC0gc3RhcnQgPiBJbnRlZ2VyLk1B\nWF9WQUxVRSAmJiBlbmQgIT0gTG9uZy5NQVhfVkFMVUUpCiAgICAgICAgICAg\nIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJyYW5nZS10b28t\nYmlnIiwKICAgICAgICAgICAgICAgIFN0cmluZy52YWx1ZU9mKHN0YXJ0KSwg\nU3RyaW5nLnZhbHVlT2YoZW5kKSkpOwoKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0T3BlbigpOwogICAgICAgICAg\nICAvLyBhbGxvd2VkIG1vZGlmaWNhdGlvbjogbm8gcmVhZC1vbmx5IGNoZWNr\nCiAgICAgICAgICAgIF9zdGFydElkeCA9IHN0YXJ0OwogICAgICAgICAgICBf\nZW5kSWR4ID0gZW5kOwogICAgICAgICAgICBfcmFuZ2VTZXQgPSB0cnVlOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFBhcmFtZXRlckRl\nY2xhcmF0aW9uKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgIGlmIChfcGFy\nYW1zICE9IG51bGwgfHwgX2NvbXBpbGVkICE9IG51bGwgfHwgX2NvbXBpbGlu\nZwogICAgICAgICAgICAgICAgfHwgX2Jyb2tlciA9PSBudWxsKQogICAgICAg\nICAgICAgICAgcmV0dXJuIF9wYXJhbXM7CgogICAgICAgICAgICAvLyBjaGVj\nayBhZ2FpbiBhZnRlciBjb21waWxhdGlvbjsgbWF5YmUgZW5jb2RlZCBpbiBz\ndHJpbmcKICAgICAgICAgICAgY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAg\nICAgICAgICAgIHJldHVybiBfcGFyYW1zOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCBkZWNsYXJlUGFyYW1ldGVycyhTdHJpbmcgcGFyYW1zKSB7\nCiAgICAgICAgaWYgKCFfc3RvcmVRdWVyeS5zdXBwb3J0c1BhcmFtZXRlckRl\nY2xhcmF0aW9ucygpKQogICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0\nZWRFeGNlcHRpb24oX2xvYy5nZXQoInF1ZXJ5LW5vc3VwcG9ydCIsCiAgICAg\nICAgICAgICAgICBfbGFuZ3VhZ2UpKTsKCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAg\nICAgYXNzZXJ0Tm90UmVhZE9ubHkoKTsKICAgICAgICAgICAgX3BhcmFtcyA9\nIFN0cmluZ1V0aWxzLnRyaW1Ub051bGwocGFyYW1zKTsKICAgICAgICAgICAg\naW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIGNvbXBpbGUoKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGFzc2VydE9wZW4oKTsKICAgICAgICAgICAg\nU3RvcmVRdWVyeS5FeGVjdXRvciBleCA9IGNvbXBpbGVGb3JFeGVjdXRvcigp\nOwogICAgICAgICAgICBnZXRSZXN1bHRQYWNrZXIoX3N0b3JlUXVlcnksIGV4\nKTsKICAgICAgICAgICAgZXgudmFsaWRhdGUoX3N0b3JlUXVlcnkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldENvbXBpbGF0aW9uKCkg\newogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nZXR1cm4gY29tcGlsZUZvckNvbXBpbGF0aW9uKCkuc3RvcmVEYXRhOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbXBpbGUgcXVlcnkgcHJvcGVy\ndGllcy4KICAgICAqLwogICAgcHJpdmF0ZSBDb21waWxhdGlvbiBjb21waWxl\nRm9yQ29tcGlsYXRpb24oKSB7CiAgICAgICAgaWYgKF9jb21waWxlZCAhPSBu\ndWxsIHx8IF9jb21waWxpbmcpCiAgICAgICAgICAgIHJldHVybiBfY29tcGls\nZWQ7CgogICAgICAgIGFzc2VydE5vdFNlcmlhbGl6ZWQoKTsKICAgICAgICBh\nc3NlcnRPcGVuKCk7CgogICAgICAgIGJvb2xlYW4gcmVhZE9ubHkgPSBfcmVh\nZE9ubHk7CiAgICAgICAgX3JlYWRPbmx5ID0gZmFsc2U7CiAgICAgICAgX2Nv\nbXBpbGluZyA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX2Nv\nbXBpbGVkID0gY29tcGlsYXRpb25Gcm9tQ2FjaGUoKTsKICAgICAgICAgICAg\ncmV0dXJuIF9jb21waWxlZDsKICAgICAgICB9IGNhdGNoIChPcGVuSlBBRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0g\nY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEdlbmVyYWxFeGNlcHRpb24ocmUpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIF9jb21waWxpbmcgPSBmYWxzZTsKICAgICAgICAg\nICAgX3JlYWRPbmx5ID0gcmVhZE9ubHk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogRmluZCB0aGUgY2FjaGVkIGNvbXBpbGF0aW9uIGZvciB0\naGUgY3VycmVudCBxdWVyeSwgY3JlYXRpbmcgb25lIGlmIGl0CiAgICAgKiBk\nb2VzIG5vdCBleGlzdC4KICAgICAqLwogICAgcHJvdGVjdGVkIENvbXBpbGF0\naW9uIGNvbXBpbGF0aW9uRnJvbUNhY2hlKCkgewogICAgICAgIE1hcCBjb21w\nQ2FjaGUgPQogICAgICAgICAgICBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24o\nKS5nZXRRdWVyeUNvbXBpbGF0aW9uQ2FjaGVJbnN0YW5jZSgpOwogICAgICAg\nIGlmIChjb21wQ2FjaGUgPT0gbnVsbCB8fCAhaXNQYXJzZWRRdWVyeSgpKSB7\nCiAgICAgICAgICAgIHJldHVybiBuZXdDb21waWxhdGlvbigpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIENvbXBpbGF0aW9uS2V5IGtleSA9IG5l\ndyBDb21waWxhdGlvbktleSgpOwogICAgICAgICAgICBrZXkucXVlcnlUeXBl\nID0gX3N0b3JlUXVlcnkuZ2V0Q2xhc3MoKTsKICAgICAgICAgICAga2V5LmNh\nbmRpZGF0ZVR5cGUgPSBnZXRDYW5kaWRhdGVUeXBlKCk7CiAgICAgICAgICAg\nIGtleS5zdWJjbGFzc2VzID0gaGFzU3ViY2xhc3NlcygpOwogICAgICAgICAg\nICBrZXkucXVlcnkgPSBnZXRRdWVyeVN0cmluZygpOwogICAgICAgICAgICBr\nZXkubGFuZ3VhZ2UgPSBnZXRMYW5ndWFnZSgpOwogICAgICAgICAgICBrZXku\nc3RvcmVLZXkgPSBfc3RvcmVRdWVyeS5uZXdDb21waWxhdGlvbktleSgpOwog\nICAgICAgICAgICBDb21waWxhdGlvbiBjb21wID0gKENvbXBpbGF0aW9uKSBj\nb21wQ2FjaGUuZ2V0KGtleSk7CgogICAgICAgICAgICAvLyBwYXJzZSBkZWNs\nYXJhdGlvbnMgaWYgbmVlZGVkCiAgICAgICAgICAgIGJvb2xlYW4gY2FjaGUg\nPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGNvbXAgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgY29tcCA9IG5ld0NvbXBpbGF0aW9uKCk7CiAgICAgICAg\nICAgICAgICAvLyBvbmx5IGNhY2hlIHRob3NlIHF1ZXJpZXMgdGhhdCBjYW4g\nYmUgY29tcGlsZWQKICAgICAgICAgICAgICAgIGNhY2hlID0gY29tcC5zdG9y\nZURhdGEgIT0gbnVsbDsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAg\nICAgICBfc3RvcmVRdWVyeS5wb3B1bGF0ZUZyb21Db21waWxhdGlvbihjb21w\nLnN0b3JlRGF0YSk7CgogICAgICAgICAgICAvLyBjYWNoZSBwYXJzZWQgc3Rh\ndGUgaWYgbmVlZGVkCiAgICAgICAgICAgIGlmIChjYWNoZSkKICAgICAgICAg\nICAgICAgIGNvbXBDYWNoZS5wdXQoa2V5LCBjb21wKTsKICAgICAgICAgICAg\ncmV0dXJuIGNvbXA7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAg\nICAqIENyZWF0ZSBhbmQgcG9wdWxhdGUgYSBuZXcgY29tcGlsYXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgQ29tcGlsYXRpb24gbmV3Q29tcGlsYXRpb24o\nKSB7CiAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9IG5ldyBDb21waWxhdGlv\nbigpOwogICAgICAgIGNvbXAuc3RvcmVEYXRhID0gX3N0b3JlUXVlcnkubmV3\nQ29tcGlsYXRpb24oKTsKICAgICAgICBfc3RvcmVRdWVyeS5wb3B1bGF0ZUZy\nb21Db21waWxhdGlvbihjb21wLnN0b3JlRGF0YSk7CiAgICAgICAgcmV0dXJu\nIGNvbXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21waWxlIGZvciBleGVj\ndXRpb24sIGNob29zaW5nIGJldHdlZW4gZGF0YXN0b3JlIGFuZCBpbi1tZW0K\nICAgICAqIGNvbXBpbGF0aW9uIGJhc2VkIG9uIHdoYXQgd2Ugc3VwcG9ydCBh\nbmQgb3VyIHNldHRpbmdzLgogICAgICovCiAgICBwcml2YXRlIFN0b3JlUXVl\ncnkuRXhlY3V0b3IgY29tcGlsZUZvckV4ZWN1dG9yKCkgewogICAgICAgIENv\nbXBpbGF0aW9uIGNvbXAgPSBjb21waWxlRm9yQ29tcGlsYXRpb24oKTsKICAg\nICAgICBpZiAoX2NvbGxlY3Rpb24gPT0gbnVsbCkgewogICAgICAgICAgICBp\nZiAoY29tcC5kYXRhc3RvcmUgIT0gbnVsbCkKICAgICAgICAgICAgICAgIHJl\ndHVybiBjb21wLmRhdGFzdG9yZTsKICAgICAgICAgICAgaWYgKGNvbXAubWVt\nb3J5ICE9IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gY29tcC5tZW1v\ncnk7CiAgICAgICAgICAgIGlmIChfc3RvcmVRdWVyeS5zdXBwb3J0c0RhdGFT\ndG9yZUV4ZWN1dGlvbigpKQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBp\nbGVGb3JEYXRhU3RvcmUoY29tcCk7CiAgICAgICAgICAgIHJldHVybiBjb21w\naWxlRm9ySW5NZW1vcnkoY29tcCk7CiAgICAgICAgfQoKICAgICAgICBpZiAo\nY29tcC5tZW1vcnkgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIGNvbXAu\nbWVtb3J5OwogICAgICAgIGlmIChjb21wLmRhdGFzdG9yZSAhPSBudWxsKQog\nICAgICAgICAgICByZXR1cm4gY29tcC5kYXRhc3RvcmU7CiAgICAgICAgaWYg\nKF9zdG9yZVF1ZXJ5LnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAg\nICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JJbk1lbW9yeShjb21wKTsKICAg\nICAgICByZXR1cm4gY29tcGlsZUZvckRhdGFTdG9yZShjb21wKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhbiBleHByZXNzaW9uIHRyZWUgZm9y\nIGRhdGFzdG9yZSBleGVjdXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgU3Rv\ncmVRdWVyeS5FeGVjdXRvciBjb21waWxlRm9yRGF0YVN0b3JlKENvbXBpbGF0\naW9uIGNvbXApIHsKICAgICAgICBpZiAoY29tcC5kYXRhc3RvcmUgPT0gbnVs\nbCkKICAgICAgICAgICAgY29tcC5kYXRhc3RvcmUgPSBjcmVhdGVFeGVjdXRv\ncihmYWxzZSk7CiAgICAgICAgcmV0dXJuIGNvbXAuZGF0YXN0b3JlOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGFuIGV4cHJlc3Npb24gdHJlZSBm\nb3IgaW4tbWVtb3J5IGV4ZWN1dGlvbi4KICAgICAqLwogICAgcHJpdmF0ZSBT\ndG9yZVF1ZXJ5LkV4ZWN1dG9yIGNvbXBpbGVGb3JJbk1lbW9yeShDb21waWxh\ndGlvbiBjb21wKSB7CiAgICAgICAgaWYgKGNvbXAubWVtb3J5ID09IG51bGwp\nCiAgICAgICAgICAgIGNvbXAubWVtb3J5ID0gY3JlYXRlRXhlY3V0b3IodHJ1\nZSk7CiAgICAgICAgcmV0dXJuIGNvbXAubWVtb3J5OwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJuIGEgcXVlcnkgZXhlY3V0b3Igb2YgdGhlIHByb3Bl\nciB0eXBlLgogICAgICovCiAgICBwcml2YXRlIFN0b3JlUXVlcnkuRXhlY3V0\nb3IgY3JlYXRlRXhlY3V0b3IoYm9vbGVhbiBpbk1lbSkgewogICAgICAgIGFz\nc2VydENhbmRpZGF0ZVR5cGUoKTsKCiAgICAgICAgTWV0YURhdGFSZXBvc2l0\nb3J5IHJlcG9zID0gX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuCiAgICAg\nICAgICAgIGdldE1ldGFEYXRhUmVwb3NpdG9yeUluc3RhbmNlKCk7CiAgICAg\nICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcmVwb3MuZ2V0TWV0YURhdGEoX2Ns\nYXNzLAogICAgICAgICAgICBfYnJva2VyLmdldENsYXNzTG9hZGVyKCksIGZh\nbHNlKTsKCiAgICAgICAgQ2xhc3NNZXRhRGF0YVtdIG1ldGFzOwogICAgICAg\nIGlmIChfY2xhc3MgPT0gbnVsbCB8fCBfc3RvcmVRdWVyeS5zdXBwb3J0c0Fi\nc3RyYWN0RXhlY3V0b3JzKCkpCiAgICAgICAgICAgIG1ldGFzID0gbmV3IENs\nYXNzTWV0YURhdGFbXXsgbWV0YSB9OwogICAgICAgIGVsc2UgaWYgKF9zdWJj\nbGFzc2VzICYmIChtZXRhID09IG51bGwgfHwgbWV0YS5pc01hbmFnZWRJbnRl\ncmZhY2UoKSkpCiAgICAgICAgICAgIG1ldGFzID0gcmVwb3MuZ2V0SW1wbGVt\nZW50b3JNZXRhRGF0YXMoX2NsYXNzLAogICAgICAgICAgICAgICAgX2Jyb2tl\nci5nZXRDbGFzc0xvYWRlcigpLCB0cnVlKTsKICAgICAgICBlbHNlIGlmICht\nZXRhICE9IG51bGwgJiYgKF9zdWJjbGFzc2VzIHx8IG1ldGEuaXNNYXBwZWQo\nKSkpCiAgICAgICAgICAgIG1ldGFzID0gbmV3IENsYXNzTWV0YURhdGFbXXsg\nbWV0YSB9OwogICAgICAgIGVsc2UKICAgICAgICAgICAgbWV0YXMgPSBTdG9y\nZVF1ZXJ5LkVNUFRZX01FVEFTOwoKICAgICAgICBpZiAobWV0YXMubGVuZ3Ro\nID09IDApCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9s\nb2MuZ2V0KCJuby1pbXBscyIsIF9jbGFzcykpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChtZXRhcy5sZW5ndGggPT0gMSkgewogICAgICAgICAg\nICAgICAgaWYgKGluTWVtKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBf\nc3RvcmVRdWVyeS5uZXdJbk1lbW9yeUV4ZWN1dG9yKG1ldGFzWzBdLAogICAg\nICAgICAgICAgICAgICAgICAgICBfc3ViY2xhc3Nlcyk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gX3N0b3JlUXVlcnkubmV3RGF0YVN0b3JlRXhlY3V0b3Io\nbWV0YXNbMF0sIF9zdWJjbGFzc2VzKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gbXVsdGlwbGUgaW1wbGVtZW50b3JzCiAgICAgICAgICAgIFN0\nb3JlUXVlcnkuRXhlY3V0b3JbXSBlcyA9IG5ldyBTdG9yZVF1ZXJ5LkV4ZWN1\ndG9yW21ldGFzLmxlbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChp\nbk1lbSkKICAgICAgICAgICAgICAgICAgICBlc1tpXSA9IF9zdG9yZVF1ZXJ5\nLm5ld0luTWVtb3J5RXhlY3V0b3IobWV0YXNbaV0sIHRydWUpOwogICAgICAg\nICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGVzW2ldID0gX3N0\nb3JlUXVlcnkubmV3RGF0YVN0b3JlRXhlY3V0b3IobWV0YXNbaV0sIHRydWUp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgTWVyZ2Vk\nRXhlY3V0b3IoZXMpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgR2VuZXJhbEV4Y2VwdGlvbihyZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQ2xlYXIgYW55IGNvbXBpbGF0aW9uLCBmb3JjaW5nIHRo\naXMgcXVlcnkgdG8gYmUgcmVjb21waWxlZAogICAgICogbmV4dCB0aW1lIGl0\nJ3MgZXhlY3V0ZWQuIFRoaXMgc2hvdWxkIGJlIGludm9rZWQgd2hlbmV2ZXIg\nYW55CiAgICAgKiBzdGF0ZSBjaGFuZ2VzIHRoYXQgd291bGQgY2F1c2UgdGhl\nIHVuZGVybHlpbmcgcXVlcnkKICAgICAqIHJlcHJlc2VudGF0aW9uIHRvIGNo\nYW5nZS4KICAgICAqCiAgICAgKiBAc2luY2UgMC4zLjAKICAgICAqLwogICAg\ncHJpdmF0ZSBib29sZWFuIGludmFsaWRhdGVDb21waWxhdGlvbigpIHsKICAg\nICAgICBpZiAoX2NvbXBpbGluZykKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIF9zdG9yZVF1ZXJ5LmludmFsaWRhdGVDb21waWxhdGlvbigp\nOwogICAgICAgIF9jb21waWxlZCA9IG51bGw7CiAgICAgICAgX3BhY2tlciA9\nIG51bGw7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBleGVjdXRlKCkgewogICAgICAgIHJldHVybiBleGVjdXRlKChP\nYmplY3RbXSkgbnVsbCk7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBleGVj\ndXRlKE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIHJldHVybiBleGVjdXRl\nKE9QX1NFTEVDVCwgcGFyYW1zKTsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0\nIGV4ZWN1dGUoTWFwIHBhcmFtcykgewogICAgICAgIHJldHVybiBleGVjdXRl\nKE9QX1NFTEVDVCwgcGFyYW1zKTsKICAgIH0KCiAgICBwcml2YXRlIE9iamVj\ndCBleGVjdXRlKGludCBvcGVyYXRpb24sIE9iamVjdFtdIHBhcmFtcykgewog\nICAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkKICAgICAgICAgICAgcGFyYW1z\nID0gU3RvcmVRdWVyeS5FTVBUWV9PQkpFQ1RTOwoKICAgICAgICBsb2NrKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXNzZXJ0Tm90U2VyaWFsaXpl\nZCgpOwogICAgICAgICAgICBfYnJva2VyLmJlZ2luT3BlcmF0aW9uKHRydWUp\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXNzZXJ0T3Bl\nbigpOwogICAgICAgICAgICAgICAgX2Jyb2tlci5hc3NlcnROb250cmFuc2Fj\ndGlvbmFsUmVhZCgpOwoKICAgICAgICAgICAgICAgIC8vIGdldCBleGVjdXRv\ncgogICAgICAgICAgICAgICAgQ29tcGlsYXRpb24gY29tcCA9IGNvbXBpbGVG\nb3JDb21waWxhdGlvbigpOwogICAgICAgICAgICAgICAgU3RvcmVRdWVyeS5F\neGVjdXRvciBleCA9IChpc0luTWVtb3J5KG9wZXJhdGlvbikpCiAgICAgICAg\nICAgICAgICAgICAgPyBjb21waWxlRm9ySW5NZW1vcnkoY29tcCkgOiBjb21w\naWxlRm9yRGF0YVN0b3JlKGNvbXApOwoKICAgICAgICAgICAgICAgIGFzc2Vy\ndFBhcmFtZXRlcnMoX3N0b3JlUXVlcnksIGV4LCBwYXJhbXMpOwogICAgICAg\nICAgICAgICAgaWYgKF9sb2cuaXNUcmFjZUVuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICBsb2dFeGVjdXRpb24ob3BlcmF0aW9uLCBleC5nZXRPcmRl\ncmVkUGFyYW1ldGVyVHlwZXMoX3N0b3JlUXVlcnkpLAogICAgICAgICAgICAg\nICAgICAgICAgICBwYXJhbXMpOwoKICAgICAgICAgICAgICAgIGlmIChvcGVy\nYXRpb24gPT0gT1BfU0VMRUNUKQogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBleGVjdXRlKF9zdG9yZVF1ZXJ5LCBleCwgcGFyYW1zKTsKICAgICAgICAg\nICAgICAgIGlmIChvcGVyYXRpb24gPT0gT1BfREVMRVRFKQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBkZWxldGUoX3N0b3JlUXVlcnksIGV4LCBwYXJh\nbXMpOwogICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiA9PSBPUF9VUERB\nVEUpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZShfc3RvcmVR\ndWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nVW5zdXBwb3J0ZWRFeGNlcHRpb24oKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nT3BlbkpQQUV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\na2U7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9icm9rZXIuZW5k\nT3BlcmF0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcml2YXRlIE9iamVjdCBleGVjdXRlKGludCBvcGVyYXRpb24s\nIE1hcCBwYXJhbXMpIHsKICAgICAgICBpZiAocGFyYW1zID09IG51bGwpCiAg\nICAgICAgICAgIHBhcmFtcyA9IENvbGxlY3Rpb25zLkVNUFRZX01BUDsKCiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9icm9r\nZXIuYmVnaW5PcGVyYXRpb24odHJ1ZSk7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBhc3NlcnROb3RTZXJpYWxpemVkKCk7CiAgICAgICAg\nICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAgICAgICBfYnJva2Vy\nLmFzc2VydE5vbnRyYW5zYWN0aW9uYWxSZWFkKCk7CgogICAgICAgICAgICAg\nICAgLy8gZ2V0IGV4ZWN1dG9yCiAgICAgICAgICAgICAgICBDb21waWxhdGlv\nbiBjb21wID0gY29tcGlsZUZvckNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAg\nICAgICBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4ID0gKGlzSW5NZW1vcnkob3Bl\ncmF0aW9uKSkKICAgICAgICAgICAgICAgICAgICA/IGNvbXBpbGVGb3JJbk1l\nbW9yeShjb21wKSA6IGNvbXBpbGVGb3JEYXRhU3RvcmUoY29tcCk7CgogICAg\nICAgICAgICAgICAgYXNzZXJ0UGFyYW1ldGVycyhfc3RvcmVRdWVyeSwgZXgs\nIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBPYmplY3RbXSBhcnIgPSAocGFy\nYW1zLmlzRW1wdHkoKSkgPyBTdG9yZVF1ZXJ5LkVNUFRZX09CSkVDVFMgOgog\nICAgICAgICAgICAgICAgICAgIGV4LnRvUGFyYW1ldGVyQXJyYXkoX3N0b3Jl\nUXVlcnksIHBhcmFtcyk7CiAgICAgICAgICAgICAgICBpZiAoX2xvZy5pc1Ry\nYWNlRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZ0V4ZWN1dGlv\nbihvcGVyYXRpb24sIHBhcmFtcyk7CgogICAgICAgICAgICAgICAgaWYgKG9w\nZXJhdGlvbiA9PSBPUF9TRUxFQ1QpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIGV4ZWN1dGUoX3N0b3JlUXVlcnksIGV4LCBhcnIpOwogICAgICAgICAg\nICAgICAgaWYgKG9wZXJhdGlvbiA9PSBPUF9ERUxFVEUpCiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGRlbGV0ZShfc3RvcmVRdWVyeSwgZXgsIGFycik7\nCiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09IE9QX1VQREFURSkK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlKF9zdG9yZVF1ZXJ5\nLCBleCwgYXJyKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBv\ncnRlZEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9IGNhdGNoIChPcGVuSlBB\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJxdWVyeS1l\neGVjdXRpb24tZXJyb3IiLCAKICAgICAgICAgICAgICAgIAkJX3F1ZXJ5KSwg\nZSk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBf\nYnJva2VyLmVuZE9wZXJhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZGVsZXRlQWxsKCkgewog\nICAgICAgIHJldHVybiBkZWxldGVBbGwoKE9iamVjdFtdKSBudWxsKTsKICAg\nIH0KCiAgICBwdWJsaWMgbG9uZyBkZWxldGVBbGwoT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBleGVjdXRlKE9QX0RFTEVU\nRSwgcGFyYW1zKSkubG9uZ1ZhbHVlKCk7CiAgICB9CgogICAgcHVibGljIGxv\nbmcgZGVsZXRlQWxsKE1hcCBwYXJhbXMpIHsKICAgICAgICByZXR1cm4gKChO\ndW1iZXIpIGV4ZWN1dGUoT1BfREVMRVRFLCBwYXJhbXMpKS5sb25nVmFsdWUo\nKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyB1cGRhdGVBbGwoKSB7CiAgICAg\nICAgcmV0dXJuIHVwZGF0ZUFsbCgoT2JqZWN0W10pIG51bGwpOwogICAgfQoK\nICAgIHB1YmxpYyBsb25nIHVwZGF0ZUFsbChPYmplY3RbXSBwYXJhbXMpIHsK\nICAgICAgICByZXR1cm4gKChOdW1iZXIpIGV4ZWN1dGUoT1BfVVBEQVRFLCBw\nYXJhbXMpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyB1\ncGRhdGVBbGwoTWFwIHBhcmFtcykgewogICAgICAgIHJldHVybiAoKE51bWJl\ncikgZXhlY3V0ZShPUF9VUERBVEUsIHBhcmFtcykpLmxvbmdWYWx1ZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ29udmVydHMgdGhlIHZhbHVlcyBvZiBn\naXZlbiA8Y29kZT5wYXJhbXM8L2NvZGU+IE1hcCBpbnRvIGFuIGFycmF5IGlu\nCiAgICAgKiBjb25zdWx0YXRpb24gb2YgdGhlIDxjb2RlPnBhcmFtVHlwZXM8\nL2NvZGU+IE1hcC4KICAgICAqIAogICAgICogVGhlIGluZGV4aW5nIG9mIHRo\nZSByZXN1bHRhbnQgYXJyYXkgaXMgc2lnbmlmaWNhbnQgZm9yIGZvbGxvd2lu\nZyAKICAgICAqIGludGVycmVsYXRlZCBidXQgdGFjaXQgYXNzdW1wdGlvbnM6\nCiAgICAgKiBUaGUgdmFsdWVzIGluIHRoZSByZXR1cm5lZCBPYmplY3RbXSBp\ncyBjb25zdW1lZCBieSB7QGxpbmsgUGFyYW1ldGVyfQogICAgICogZXhwcmVz\nc2lvbnMuIFF1ZXJ5IHBhcnNpbmcgY3JlYXRlcyB0aGVzZSBQYXJhbWV0ZXJz\nIGFuZCBzZXRzIHRoZWlyCiAgICAgKiBrZXkgYW5kIGluZGV4LiBUaGUgaW5k\nZXggc2V0IG9uIHRoZSBQYXJhbWV0ZXIgYnkgdGhlIHBhcnNlciBpcyB0aGUK\nICAgICAqIHNhbWUgaW5kZXggdXNlZCB0byBhY2Nlc3MgdGhlIE9iamVjdFtd\nIGVsZW1lbnRzIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kLgogICAgICogCiAg\nICAgKiB7QGxpbmsgSlBRTEV4cHJlc3Npb25CdWlsZGVyfSBjcmVhdGVzIGFu\nZCBwb3B1bGF0ZXMgcGFyYW1ldGVycyBhcwogICAgICogZm9sbG93czogCiAg\nICAgKiBUaGUgcGFyYW1ldGVyIGtleSBpcyBub3QgdGhlIHRva2VuIGVuY291\nbnRlcmVkIGJ5IHRoZSBwYXJzZXIsIGJ1dCAKICAgICAqIGNvbnZlcnRlZCB0\nbyBJbnRlZ2VyIG9yIFN0cmluZyBiYXNlZCBvbiB0aGUgY29udGV4dCBpbiB3\naGljaCB0aGUgdG9rZW4gCiAgICAgKiBhcHBlYXJlZC4gCiAgICAgKiBUaGUg\naW5kZXggZm9yIHBvc2l0aW9uYWwgKEludGVnZXIpIHBhcmFtZXRlciBpcyB0\naGUgdmFsdWUgb2YgdGhlIGtleSAgIAogICAgICogbWludXMgMS4gCiAgICAg\nKiBUaGUgaW5kZXggZm9yIG5hbWVkIChTdHJpbmcpIHBhcmFtZXRlciBpcyB0\naGUgb3JkZXIgaW4gd2hpY2ggdGhlICAKICAgICAqIHRva2VuIGFwcGVhcmVk\nIHRvIHBhcnNlciBkdXJpbmcgc2Nhbm5pbmcuIAogICAgICogCiAgICAgKiAK\nICAgICAqIFRoZSBmaXJzdCBMaW5rZWRNYXAgYXJndW1lbnQgdG8gdGhpcyBt\nZXRob2QgaXMgdGhlIHJlc3VsdCBvZiBwYXJzaW5nLgogICAgICogVGhpcyBM\naW5rZWRNYXAgY29udGFpbnMgdGhlIHBhcmFtZXRlciBrZXkgYW5kIHRoZWly\nIGV4cGVjdGVkIAogICAgICogKGlmIGRldGVybWluYWJsZSkgdmFsdWUgdHlw\nZXMuIFRoYXQgaXQgaXMgYSBMaW5rZWRNYXAgcG9pbnRzIHRvIHRoZSAKICAg\nICAqIGZhY3QgdGhhdCBhbiBvcmRlcmluZyBpcyBpbXBsaWNpdC4gVGhlIG9y\nZGVyaW5nIG9mIHRoZSBrZXlzIGluIHRoaXMgTWFwIAogICAgICogaXMgdGhl\nIHNhbWUgYXMgdGhlIG9yZGVyIGluIHdoaWNoIHBhcnNlciBlbmNvdW50ZXJl\nZCB0aGUgcGFyYW1ldGVyCiAgICAgKiB0b2tlbnMuCiAgICAgKiAKICAgICAq\nIEZvciBleGFtcGxlLCBwYXJzaW5nIHJlc3VsdCBvZiB0aGUgZm9sbG93aW5n\nIHR3byBKUFFMIHF1ZXJpZXMKICAgICAqICAgYSkgVVBEQVRFIENvbXBVc2Vy\nIGUgU0VUIGUubmFtZT0gPzEsIGUuYWdlID0gPzIgV0hFUkUgZS51c2VyaWQg\nPSA/MwogICAgICogICBiKSBVUERBVEUgQ29tcFVzZXIgZSBTRVQgZS5uYW1l\nPSA6bmFtZSwgZS5hZ2UgPSA6YWdlIFdIRVJFIGUudXNlcmlkID0KICAgICAq\nICAgICAgICAgIDppZAogICAgICogVGhlIHBhcmFtZXRlciBrZXlzIHdpbGwg\nYXBwZWFyIGluIHRoZSBvcmRlciAoMywyLDEpIG9yICg6aWQsIDpuYW1lLCA6\nYWdlKQogICAgICogaW4gdGhlIGdpdmVuIExpbmtlZE1hcCBiZWNhdXNlIFdI\nRVJFIGNsYXVzZSBpcyBwYXJzZWQgYmVmb3JlIFNFVCBjbGF1c2UuCiAgICAg\nKiBUaGUgY29ycmVzcG9uZGluZyBQYXJhbWV0ZXIgRXhwcmVzc2lvbnMgY3Jl\nYXRlZCBieSB0aGUgcGFyc2VyIHdpbGwgaGF2ZQogICAgICogZm9sbG93aW5n\nIGtleSBhbmQgaW5kZXg6CiAgICAgKiAgICBhKSAxOjAsIDI6MSwgMzoyCiAg\nICAgKiAgICBiKSBuYW1lOjEsIGFnZToyLCBpZDowCiAgICAgKiAgICAKICAg\nICAqIFRoZSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvIHByb2R1Y2Ug\nYW4gT2JqZWN0W10gd2l0aCBhbiBpbmRleGluZwogICAgICogc2NoZW1lIHRo\nYXQgbWF0Y2hlcyB0aGUgaW5kZXhpbmcgb2YgdGhlIFBhcmFtZXRlciBFeHBy\nZXNzaW9uLgogICAgICogVGhlIHVzZXIgbWFwICh0aGUgc2Vjb25kIGFyZ3Vt\nZW50KSBzaG91bGQgcHJvZHVjZSB0aGUgZm9sbG93aW5nIE9iamVjdFtdCiAg\nICAgKiBpbiB0d28gYWJvdmUtbWVudGlvbmVkIGNhc2VzCiAgICAgKiAgIGEp\nIHsxOiJTaGFubm9uIiwyOjI5LDM6NTAzMn0gLS0+IFsiU2hhbm5vbiIsIDI5\nLCA1MDMyXQogICAgICogICBiKSB7Im5hbWUiOiJTaGFubm9uIiwgImFnZSI6\nMjksICJpZCI6NTAzMn0gLS0+IFs1MDMyLCAiU2hhbm5vbiIsIDI5XQogICAg\nICogICAKICAgICAqLwoKICAgIC8qKgogICAgICogUmV0dXJuIHdoZXRoZXIg\nd2Ugc2hvdWxkIGV4ZWN1dGUgdGhpcyBxdWVyeSBpbiBtZW1vcnkuCiAgICAg\nKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0luTWVtb3J5KGludCBvcGVyYXRp\nb24pIHsKICAgICAgICAvLyBpZiB0aGVyZSBhcmUgYW55IGRpcnR5IGluc3Rh\nbmNlcyBpbiB0aGUgY3VycmVudCB0cmFucyB0aGF0IGFyZQogICAgICAgIC8v\nIGludm9sdmVkIGluIHRoaXMgcXVlcnksIHdlIGhhdmUgdG8gZXhlY3V0ZSBp\nbiBtZW1vcnkgb3IgZmx1c2gKICAgICAgICBib29sZWFuIGluTWVtID0gIV9z\ndG9yZVF1ZXJ5LnN1cHBvcnRzRGF0YVN0b3JlRXhlY3V0aW9uKCkKICAgICAg\nICAgICAgfHwgX2NvbGxlY3Rpb24gIT0gbnVsbDsKICAgICAgICBpZiAoIWlu\nTWVtICYmICghX2lnbm9yZUNoYW5nZXMgfHwgb3BlcmF0aW9uICE9IE9QX1NF\nTEVDVCkKICAgICAgICAgICAgJiYgX2Jyb2tlci5pc0FjdGl2ZSgpICYmIGlz\nQWNjZXNzUGF0aERpcnR5KCkpIHsKICAgICAgICAgICAgaW50IGZsdXNoID0g\nX2ZjLmdldEZsdXNoQmVmb3JlUXVlcmllcygpOwogICAgICAgICAgICBpZiAo\nKGZsdXNoID09IEZMVVNIX1RSVUUKICAgICAgICAgICAgICAgIHx8IChmbHVz\naCA9PSBGTFVTSF9XSVRIX0NPTk5FQ1RJT04gJiYgX2Jyb2tlci5oYXNDb25u\nZWN0aW9uKCkpCiAgICAgICAgICAgICAgICB8fCBvcGVyYXRpb24gIT0gT1Bf\nU0VMRUNUCiAgICAgICAgICAgICAgICB8fCAhX3N0b3JlUXVlcnkuc3VwcG9y\ndHNJbk1lbW9yeUV4ZWN1dGlvbigpKQogICAgICAgICAgICAgICAgJiYgX2Jy\nb2tlci5nZXRDb25maWd1cmF0aW9uKCkuc3VwcG9ydGVkT3B0aW9ucygpLgog\nICAgICAgICAgICAgICAgY29udGFpbnMoT3BlbkpQQUNvbmZpZ3VyYXRpb24u\nT1BUSU9OX0lOQ19GTFVTSCkpIHsKICAgICAgICAgICAgICAgIF9icm9rZXIu\nZmx1c2goKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGlmIChfbG9nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBfbG9nLmluZm8oX2xvYy5nZXQoImZvcmNlLWluLW1lbSIsIF9jbGFzcykp\nOwogICAgICAgICAgICAgICAgaW5NZW0gPSB0cnVlOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAoaW5NZW0gJiYgIV9zdG9yZVF1ZXJ5\nLnN1cHBvcnRzSW5NZW1vcnlFeGVjdXRpb24oKSkKICAgICAgICAgICAgdGhy\nb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdldCgiY2FudC1l\neGVjLWlubWVtIiwKICAgICAgICAgICAgICAgIF9sYW5ndWFnZSkpOwogICAg\nICAgIHJldHVybiBpbk1lbTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4ZWN1\ndGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBnaXZlbiBjb21waWxhdGlvbiwgZXhl\nY3V0b3IsIGFuZCBwYXJhbWV0ZXIKICAgICAqIHZhbHVlcy4gQWxsIG90aGVy\nIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0ZSB0byB0aGlzIG9uZSBvciB0bwog\nICAgICoge0BsaW5rICNleGVjdXRlKFN0b3JlUXVlcnkuRXhlY3V0b3IsTWFw\nKX0gYWZ0ZXIgdmFsaWRhdGlvbiBhbmQgbG9ja2luZy4KICAgICAqLwogICAg\ncHJpdmF0ZSBPYmplY3QgZXhlY3V0ZShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVl\ncnkuRXhlY3V0b3IgZXgsIAogICAgICAgIE9iamVjdFtdIHBhcmFtcykKICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBpZiB0aGlzIGlz\nIGFuIGltcG9zc2libGUgcmVzdWx0IHJhbmdlLCByZXR1cm4gbnVsbCAvIGVt\ncHR5IGxpc3QKICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJhbmdlID0gbmV3\nIFN0b3JlUXVlcnkuUmFuZ2UoX3N0YXJ0SWR4LCBfZW5kSWR4KTsKICAgICAg\nICBpZiAoIV9yYW5nZVNldCkKICAgICAgICAgICAgZXguZ2V0UmFuZ2UocSwg\ncGFyYW1zLCByYW5nZSk7CiAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ID49IHJh\nbmdlLmVuZCkKICAgICAgICAgICAgcmV0dXJuIGVtcHR5UmVzdWx0KHEsIGV4\nKTsKCiAgICAgICAgLy8gZXhlY3V0ZTsgaWYgd2UgaGF2ZSBhIHJlc3VsdCBj\nbGFzcyBvciB3ZSBoYXZlIG9ubHkgb25lIHJlc3VsdAogICAgICAgIC8vIGFu\nZCBzbyBuZWVkIHRvIHJlbW92ZSBpdCBmcm9tIGl0cyBhcnJheSwgd3JhcCBp\nbiBhIHBhY2tpbmcgcm9wCiAgICAgICAgcmFuZ2UubHJzID0gaXNMUlMocmFu\nZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7CiAgICAgICAgUmVzdWx0T2JqZWN0UHJv\ndmlkZXIgcm9wID0gZXguZXhlY3V0ZVF1ZXJ5KHEsIHBhcmFtcywgcmFuZ2Up\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiB0b1Jlc3VsdChx\nLCBleCwgcm9wLCByYW5nZSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgaWYgKHJvcCAhPSBudWxsKQogICAgICAgICAg\nICAgICAgdHJ5IHsgcm9wLmNsb3NlKCk7IH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nMikge30KICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxldGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBnaXZl\nbiBleGVjdXRvciwgYW5kIHBhcmFtZXRlcgogICAgICogdmFsdWVzLiBBbGwg\nb3RoZXIgZXhlY3V0ZSBtZXRob2RzIGRlbGVnYXRlIHRvIHRoaXMgb25lIG9y\nIHRvCiAgICAgKiB7QGxpbmsgI2RlbGV0ZShTdG9yZVF1ZXJ5LkV4ZWN1dG9y\nLE1hcCl9IGFmdGVyIHZhbGlkYXRpb24gYW5kIGxvY2tpbmcuCiAgICAgKiBU\naGUgcmV0dXJuIHZhbHVlIHdpbGwgYmUgYSBOdW1iZXIgaW5kaWNhdGluZyB0\naGUgbnVtYmVyIG9mCiAgICAgKiBpbnN0YW5jZXMgZGVsZXRlZC4KICAgICAq\nLwogICAgcHJpdmF0ZSBOdW1iZXIgZGVsZXRlKFN0b3JlUXVlcnkgcSwgU3Rv\ncmVRdWVyeS5FeGVjdXRvciBleCwgT2JqZWN0W10gcGFyYW1zKQogICAgICAg\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGFzc2VydEJ1bGtNb2RpZnko\ncSwgZXgsIHBhcmFtcyk7CiAgICAgICAgcmV0dXJuIGV4LmV4ZWN1dGVEZWxl\ndGUocSwgcGFyYW1zKTsKICAgIH0KCiAgICBwdWJsaWMgTnVtYmVyIGRlbGV0\nZUluTWVtb3J5KFN0b3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBl\neGVjdXRvciwKICAgICAgICBPYmplY3RbXSBwYXJhbXMpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBPYmplY3QgbyA9IGV4ZWN1dGUocSwgZXhlY3V0\nb3IsIHBhcmFtcyk7CiAgICAgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBD\nb2xsZWN0aW9uKSkKICAgICAgICAgICAgICAgIG8gPSBDb2xsZWN0aW9ucy5z\naW5nbGV0b24obyk7CgogICAgICAgICAgICBpbnQgc2l6ZSA9IDA7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3IgaSA9ICgoQ29sbGVjdGlvbikgbykuaXRl\ncmF0b3IoKTsgaS5oYXNOZXh0KCk7IHNpemUrKykKICAgICAgICAgICAgICAg\nIF9icm9rZXIuZGVsZXRlKGkubmV4dCgpLCBudWxsKTsKICAgICAgICAgICAg\ncmV0dXJuIHNpemU7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlv\nbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4\nY2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBV\ncGRhdGUgdGhlIHF1ZXJ5IHVzaW5nIHRoZSBnaXZlbiBjb21waWxhdGlvbiwg\nZXhlY3V0b3IsIGFuZCBwYXJhbWV0ZXIKICAgICAqIHZhbHVlcy4gQWxsIG90\naGVyIGV4ZWN1dGUgbWV0aG9kcyBkZWxlZ2F0ZSB0byB0aGlzIG9uZSBvciB0\nbwogICAgICoge0BsaW5rICN1cGRhdGUoU3RvcmVRdWVyeS5FeGVjdXRvcixN\nYXApfSBhZnRlciB2YWxpZGF0aW9uIGFuZCBsb2NraW5nLgogICAgICogVGhl\nIHJldHVybiB2YWx1ZSB3aWxsIGJlIGEgTnVtYmVyIGluZGljYXRpbmcgdGhl\nIG51bWJlciBvZgogICAgICogaW5zdGFuY2VzIHVwZGF0ZWQuCiAgICAgKi8K\nICAgIHByaXZhdGUgTnVtYmVyIHVwZGF0ZShTdG9yZVF1ZXJ5IHEsIFN0b3Jl\nUXVlcnkuRXhlY3V0b3IgZXgsIE9iamVjdFtdIHBhcmFtcykKICAgICAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRCdWxrTW9kaWZ5KHEs\nIGV4LCBwYXJhbXMpOwogICAgICAgIHJldHVybiBleC5leGVjdXRlVXBkYXRl\nKHEsIHBhcmFtcyk7CiAgICB9CgogICAgcHVibGljIE51bWJlciB1cGRhdGVJ\nbk1lbW9yeShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXhl\nY3V0b3IsCiAgICAgICAgT2JqZWN0W10gcGFyYW1zKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgT2JqZWN0IG8gPSBleGVjdXRlKHEsIGV4ZWN1dG9y\nLCBwYXJhbXMpOwogICAgICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ29s\nbGVjdGlvbikpCiAgICAgICAgICAgICAgICBvID0gQ29sbGVjdGlvbnMuc2lu\nZ2xldG9uKG8pOwoKICAgICAgICAgICAgaW50IHNpemUgPSAwOwogICAgICAg\nICAgICBmb3IgKEl0ZXJhdG9yIGkgPSAoKENvbGxlY3Rpb24pIG8pLml0ZXJh\ndG9yKCk7IGkuaGFzTmV4dCgpOyBzaXplKyspCiAgICAgICAgICAgICAgICB1\ncGRhdGVJbk1lbW9yeShpLm5leHQoKSwgcGFyYW1zLCBxKTsKICAgICAgICAg\nICAgcmV0dXJuIHNpemU7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICB0aHJvdyBrZTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVXNl\nckV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIHZhbHVlcyBmb3IgdGhlIHVwZGF0ZXMgaW4gbWVtb3J5Lgog\nICAgICoKICAgICAqIEBwYXJhbSBvYiB0aGUgcGVyc2lzdGVudCBpbnN0YW5j\nZSB0byBjaGFuZ2UKICAgICAqIEBwYXJhbSBwYXJhbXMgdGhlIHBhcmFtZXRl\ncnMgcGFzc2VkIHRvIHRoZSBxdWVyeQogICAgICovCiAgICBwcml2YXRlIHZv\naWQgdXBkYXRlSW5NZW1vcnkoT2JqZWN0IG9iLCBPYmplY3RbXSBwYXJhbXMs\nIFN0b3JlUXVlcnkgcSkgewogICAgICAgIGZvciAoSXRlcmF0b3IgaXQgPSBn\nZXRVcGRhdGVzKCkuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAg\nICBpdC5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgIE1hcC5FbnRyeSBlID0g\nKE1hcC5FbnRyeSkgaXQubmV4dCgpOwogICAgICAgICAgICBQYXRoIHBhdGgg\nPSAoUGF0aCkgZS5nZXRLZXkoKTsKICAgICAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSAoRmllbGRNZXRhRGF0YSkgcGF0aC5sYXN0KCk7CiAgICAgICAg\nICAgIE9wZW5KUEFTdGF0ZU1hbmFnZXIgc20gPSBfYnJva2VyLmdldFN0YXRl\nTWFuYWdlcihvYik7CgogICAgICAgICAgICBPYmplY3QgdmFsOwogICAgICAg\nICAgICBPYmplY3QgdmFsdWUgPSBlLmdldFZhbHVlKCk7CiAgICAgICAgICAg\nIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFZhbCkgewogICAgICAgICAgICAgICAg\ndmFsID0gKChWYWwpIHZhbHVlKS4KICAgICAgICAgICAgICAgICAgICBldmFs\ndWF0ZShvYiwgbnVsbCwgZ2V0U3RvcmVDb250ZXh0KCksIHBhcmFtcyk7CiAg\nICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBMaXRlcmFs\nKSB7CiAgICAgICAgICAgICAgICB2YWwgPSAoKExpdGVyYWwpIHZhbHVlKS5n\nZXRWYWx1ZSgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3Rh\nbmNlb2YgQ29uc3RhbnQpIHsKICAgICAgICAgICAgICAgIHZhbCA9ICgoQ29u\nc3RhbnQpIHZhbHVlKS5nZXRWYWx1ZShwYXJhbXMpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICB2YWwgPSBxLmV2YWx1YXRlKHZhbHVlLCBvYiwgcGFyYW1zLCBzbSk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChVbnN1cHBvcnRlZEV4Y2VwdGlv\nbiBlMSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xvYy5nZXQo\nImZhaWwtdG8tZ2V0LXVwZGF0ZS12YWx1ZSIpKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50IGkgPSBmbWQuZ2V0\nSW5kZXgoKTsKICAgICAgICAgICAgUGVyc2lzdGVuY2VDYXBhYmxlIGludG8g\nPSBJbXBsSGVscGVyLnRvUGVyc2lzdGVuY2VDYXBhYmxlKG9iLAogICAgICAg\nICAgICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkpOwoKICAgICAg\nICAgICAgLy8gc2V0IHRoZSBhY3R1YWwgZmllbGQgaW4gdGhlIGluc3RhbmNl\nCiAgICAgICAgICAgIGludCBzZXQgPSBPcGVuSlBBU3RhdGVNYW5hZ2VyLlNF\nVF9VU0VSOwogICAgICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5\ncGVDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJP\nT0xFQU46CiAgICAgICAgICAgICAgICAgICAgc20uc2V0dGluZ0Jvb2xlYW5G\naWVsZChpbnRvLCBpLCBzbS5mZXRjaEJvb2xlYW5GaWVsZChpKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgdmFsID09IG51bGwgPyBmYWxzZSA6ICgoQm9v\nbGVhbikgdmFsKS5ib29sZWFuVmFsdWUoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAg\nICAgICAgc20uc2V0dGluZ0J5dGVGaWVsZChpbnRvLCBpLCBzbS5mZXRjaEJ5\ndGVGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsID09IG51\nbGwgPyAwIDogKChOdW1iZXIpIHZhbCkuYnl0ZVZhbHVlKCksIHNldCk7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DSEFSOgogICAgICAgICAgICAgICAgICAgIHNtLnNldHRp\nbmdDaGFyRmllbGQoaW50bywgaSwgc20uZmV0Y2hDaGFyRmllbGQoaSksCiAg\nICAgICAgICAgICAgICAgICAgICAgIHZhbCA9PSBudWxsID8gMCA6IHZhbC50\nb1N0cmluZygpLmNoYXJBdCgwKSwgc2V0KTsKICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRPVUJM\nRToKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nRG91YmxlRmllbGQo\naW50bywgaSwgc20uZmV0Y2hEb3VibGVGaWVsZChpKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCku\nZG91YmxlVmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkZMT0FUOgogICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdGbG9hdEZpZWxkKGludG8sIGks\nIHNtLmZldGNoRmxvYXRGaWVsZChpKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuZmxvYXRWYWx1\nZSgpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UOgogICAgICAgICAgICAgICAg\nICAgIHNtLnNldHRpbmdJbnRGaWVsZChpbnRvLCBpLCBzbS5mZXRjaEludEZp\nZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/\nIDAgOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpLCBzZXQpOwogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuTE9ORzoKICAgICAgICAgICAgICAgICAgICBzbS5zZXR0aW5nTG9u\nZ0ZpZWxkKGludG8sIGksIHNtLmZldGNoTG9uZ0ZpZWxkKGkpLAogICAgICAg\nICAgICAgICAgICAgICAgICB2YWwgPT0gbnVsbCA/IDAgOiAoKE51bWJlcikg\ndmFsKS5sb25nVmFsdWUoKSwgc2V0KTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICAgICAgICAgIHNtLnNldHRpbmdTaG9ydEZpZWxkKGludG8s\nIGksIHNtLmZldGNoU2hvcnRGaWVsZChpKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgdmFsID09IG51bGwgPyAwIDogKChOdW1iZXIpIHZhbCkuc2hvcnRW\nYWx1ZSgpLCBzZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU1RSSU5HOgogICAgICAgICAg\nICAgICAgICAgIHNtLnNldHRpbmdTdHJpbmdGaWVsZChpbnRvLCBpLCBzbS5m\nZXRjaFN0cmluZ0ZpZWxkKGkpLAogICAgICAgICAgICAgICAgICAgICAgICB2\nYWwgPT0gbnVsbCA/IG51bGwgOiB2YWwudG9TdHJpbmcoKSwgc2V0KTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5OVU1CRVI6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5CT09M\nRUFOX09CSjoKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJZVEVf\nT0JKOgogICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0hBUl9PQko6\nCiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5ET1VCTEVfT0JKOgog\nICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuRkxPQVRfT0JKOgogICAg\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuSU5UX09CSjoKICAgICAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkxPTkdfT0JKOgogICAgICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuU0hPUlRfT0JKOgogICAgICAgICAgICAgICAg\nY2FzZSBKYXZhVHlwZXMuQklHREVDSU1BTDoKICAgICAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkJJR0lOVEVHRVI6CiAgICAgICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5MT0NBTEU6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5PQkpFQ1Q6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5P\nSUQ6CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5FTlVNOgogICAg\nICAgICAgICAgICAgICAgIHNtLnNldHRpbmdPYmplY3RGaWVsZChpbnRvLCBp\nLCBzbS5mZXRjaE9iamVjdEZpZWxkKGkpLCB2YWwsCiAgICAgICAgICAgICAg\nICAgICAgICAgIHNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJvbmx5LXVwZGF0ZS1w\ncmltaXRpdmVzIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVHJhY2UgbG9nIHRoYXQgdGhlIHF1ZXJ5IGlzIGV4\nZWN1dGluZy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGxvZ0V4ZWN1dGlv\nbihpbnQgb3AsIE9yZGVyZWRNYXA8T2JqZWN0LCBDbGFzczw/Pj4gdHlwZXMs\nIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIE9yZGVyZWRNYXA8T2JqZWN0\nLCBPYmplY3Q+IHBtYXAgPSBuZXcgT3JkZXJlZE1hcDxPYmplY3QsIE9iamVj\ndD4oKTsKICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA+IDApIHsKICAgICAg\nICAgICAgaWYgKHR5cGVzICE9IG51bGwgJiYgdHlwZXMuc2l6ZSgpID09IHBh\ncmFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGludCBpID0gMDsKICAg\nICAgICAgICAgICAgIGZvciAoSXRlcmF0b3I8T2JqZWN0PiBpdHIgPSB0eXBl\ncy5rZXlTZXQoKS5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykKICAgICAg\nICAgICAgICAgICAgICBwbWFwLnB1dChpdHIubmV4dCgpLCBwYXJhbXNbaSsr\nXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykKICAgICAgICAg\nICAgICAgICAgICBwbWFwLnB1dChTdHJpbmcudmFsdWVPZihpKSwgcGFyYW1z\nW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb2dFeGVj\ndXRpb24ob3AsIHBtYXApOwogICAgfQoKICAgIC8qKgogICAgICogVHJhY2Ug\nbG9nIHRoYXQgdGhlIHF1ZXJ5IGlzIGV4ZWN1dGluZy4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGxvZ0V4ZWN1dGlvbihpbnQgb3AsIE1hcDw/LCA/PiBw\nYXJhbXMpIHsKICAgICAgICBTdHJpbmcgcyA9IF9xdWVyeTsKICAgICAgICBp\nZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShzKSkKICAgICAgICAgICAgcyA9IHRv\nU3RyaW5nKCk7CgogICAgICAgIFN0cmluZyBtc2cgPSAiZXhlY3V0aW5nLXF1\nZXJ5IjsKICAgICAgICBpZiAoIXBhcmFtcy5pc0VtcHR5KCkpCiAgICAgICAg\nICAgIG1zZyArPSAiLXdpdGgtcGFyYW1zIjsKCiAgICAgICAgX2xvZy50cmFj\nZShfbG9jLmdldChtc2csIHMsIHBhcmFtcykpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHdoZXRoZXIgdGhpcyBzaG91bGQgYmUgdHJlYXRlZCBh\ncyBhIHBvdGVudGlhbCBsYXJnZSByZXN1bHQgc2V0LgogICAgICovCiAgICBw\ncml2YXRlIGJvb2xlYW4gaXNMUlMobG9uZyBzdGFydCwgbG9uZyBlbmQpIHsK\nICAgICAgICBsb25nIHJhbmdlID0gZW5kIC0gc3RhcnQ7CiAgICAgICAgcmV0\ndXJuIF9mYy5nZXRGZXRjaEJhdGNoU2l6ZSgpID49IDAKICAgICAgICAgICAg\nJiYgIShyYW5nZSA8PSBfZmMuZ2V0RmV0Y2hCYXRjaFNpemUoKQogICAgICAg\nICAgICB8fCAoX2ZjLmdldEZldGNoQmF0Y2hTaXplKCkgPT0gMCAmJiByYW5n\nZSA8PSA1MCkpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBx\ndWVyeSByZXN1bHQgZm9yIHRoZSBnaXZlbiByZXN1bHQgb2JqZWN0IHByb3Zp\nZGVyLgogICAgICovCiAgICBwcm90ZWN0ZWQgT2JqZWN0IHRvUmVzdWx0KFN0\nb3JlUXVlcnkgcSwgU3RvcmVRdWVyeS5FeGVjdXRvciBleCwgCiAgICAgICAg\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgcm9wLCBTdG9yZVF1ZXJ5LlJhbmdlIHJh\nbmdlKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIHBh\nY2sgcHJvamVjdGlvbnMgaWYgbmVjZXNzYXJ5CiAgICAgICAgU3RyaW5nW10g\nYWxpYXNlcyA9IGV4LmdldFByb2plY3Rpb25BbGlhc2VzKHEpOwogICAgICAg\nIGlmICghZXguaXNQYWNraW5nKHEpKSB7CiAgICAgICAgICAgIFJlc3VsdFBh\nY2tlciBwYWNrZXIgPSBnZXRSZXN1bHRQYWNrZXIocSwgZXgpOwogICAgICAg\nICAgICBpZiAocGFja2VyICE9IG51bGwgfHwgYWxpYXNlcy5sZW5ndGggPT0g\nMSkKICAgICAgICAgICAgICAgIHJvcCA9IG5ldyBQYWNraW5nUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIocm9wLCBwYWNrZXIsCiAgICAgICAgICAgICAgICAgICAg\nYWxpYXNlcy5sZW5ndGgpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgc2lu\nZ2xlIHJlc3VsdCwgZXh0cmFjdCBpdAogICAgICAgIGlmIChfdW5pcXVlID09\nIEJvb2xlYW4uVFJVRSB8fCAoYWxpYXNlcy5sZW5ndGggPiAwCiAgICAgICAg\nICAgICYmICFleC5oYXNHcm91cGluZyhxKSAmJiBleC5pc0FnZ3JlZ2F0ZShx\nKSkpCiAgICAgICAgICAgIHJldHVybiBzaW5nbGVSZXN1bHQocm9wLCByYW5n\nZSk7CgogICAgICAgIC8vIG5vdyB0aGF0IHdlJ3ZlIGV4ZWN1dGVkIHRoZSBx\ndWVyeSwgd2UgY2FuIGNhbGwgaXNBZ2dyZWdhdGUgYW5kCiAgICAgICAgLy8g\naGFzR3JvdXBpbmcgZWZmaWNpZW50bHkKICAgICAgICBib29sZWFuIGRldGFj\naCA9IChfYnJva2VyLmdldEF1dG9EZXRhY2goKSAmCiAgICAgICAgICAgIEF1\ndG9EZXRhY2guREVUQUNIX05PTlRYUkVBRCkgPiAwICYmICFfYnJva2VyLmlz\nQWN0aXZlKCk7CiAgICAgICAgYm9vbGVhbiBscnMgPSByYW5nZS5scnMgJiYg\nIWV4LmlzQWdncmVnYXRlKHEpICYmICFleC5oYXNHcm91cGluZyhxKTsKICAg\nICAgICBSZXN1bHRMaXN0PD8+IHJlcyA9IG5ldyBMaXN0UmVzdWx0TGlzdChD\nb2xsZWN0aW9ucy5lbXB0eUxpc3QoKSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgcmVzID0gKCFkZXRhY2ggJiYgbHJzKSA/IF9mYy5uZXdSZXN1bHRM\naXN0KHJvcCkgOiBuZXcgRWFnZXJSZXN1bHRMaXN0KHJvcCk7CiAgICAgICAg\nICAgIHJlcy5zZXRVc2VyT2JqZWN0KG5ldyBPYmplY3RbXXtyb3AsZXh9KTsK\nICAgICAgICAgICAgX3Jlc3VsdExpc3RzLmFkZChkZWNvcmF0ZVJlc3VsdExp\nc3QocmVzKSk7CiAgICAgICAgfSBjYXRjaCAoT3BlbkpQQUV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIGlmIChlLmdldEZhaWxlZE9iamVjdCgpID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGUuc2V0RmFpbGVkT2JqZWN0KGdldFF1\nZXJ5U3RyaW5nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93\nIGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBPcHRpb25hbGx5IGRlY29yYXRlIHRoZSBuYXRpdmUgcmVz\ndWx0LgogICAgICovCiAgICBwcm90ZWN0ZWQgUmVtb3ZlT25DbG9zZVJlc3Vs\ndExpc3QgZGVjb3JhdGVSZXN1bHRMaXN0KFJlc3VsdExpc3Q8Pz4gcmVzKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdmVPbkNsb3NlUmVzdWx0TGlzdChy\nZXMpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgcmVzdWx0IHBh\nY2tlciBmb3IgdGhpcyBwcm9qZWN0aW9uLCBvciBudWxsLgogICAgICovCiAg\nICBwcml2YXRlIFJlc3VsdFBhY2tlciBnZXRSZXN1bHRQYWNrZXIoU3RvcmVR\ndWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9yIGV4KSB7CiAgICAgICAgaWYg\nKF9wYWNrZXIgIT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIF9wYWNrZXI7\nCgogICAgICAgIENsYXNzPD8+IHJlc3VsdENsYXNzID0gKF9yZXN1bHRDbGFz\ncyAhPSBudWxsKSA/IF9yZXN1bHRDbGFzcwogICAgICAgICAgICA6IGV4Lmdl\ndFJlc3VsdENsYXNzKHEpOwogICAgICAgIGlmIChyZXN1bHRDbGFzcyA9PSBu\ndWxsKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgU3RyaW5n\nW10gYWxpYXNlcyA9IGV4LmdldFByb2plY3Rpb25BbGlhc2VzKHEpOwogICAg\nICAgIFJlc3VsdFNoYXBlPD8+IHNoYXBlID0gZXguZ2V0UmVzdWx0U2hhcGUo\ncSk7CiAgICAgICAgaWYgKHNoYXBlICE9IG51bGwpIHsgLy8gdXNpbmcgSlBB\nMi4wIHN0eWxlIHJlc3VsdCBzaGFwZSBmb3IgcGFja2luZwogICAgICAgICAg\nICBpZiAoYWxpYXNlcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAg\nX3BhY2tlciA9IG5ldyBSZXN1bHRTaGFwZVBhY2tlcihuZXcgQ2xhc3NbXXtf\nY2xhc3N9LCBuZXcgU3RyaW5nW117IiJ9LCByZXN1bHRDbGFzcywgc2hhcGUp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3BhY2tl\nciA9IG5ldyBSZXN1bHRTaGFwZVBhY2tlcihleC5nZXRQcm9qZWN0aW9uVHlw\nZXMocSksIGFsaWFzZXMsIHJlc3VsdENsYXNzLCBzaGFwZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoYWxpYXNl\ncy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgLy8gcmVzdWx0IGNs\nYXNzIGJ1dCBubyByZXN1bHQ7IG1lYW5zIGNhbmRpZGF0ZSBpcyBiZWluZyBz\nZXQKICAgICAgICAgICAgICAgIC8vIGludG8gc29tZSByZXN1bHQgY2xhc3MK\nICAgICAgICAgICAgICAgIF9wYWNrZXIgPSBuZXcgUmVzdWx0UGFja2VyKF9j\nbGFzcywgZ2V0QWxpYXMoKSwgcmVzdWx0Q2xhc3MpOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKHJlc3VsdENsYXNzICE9IG51bGwpIHsgLy8gcHJvamVjdGlv\nbgogICAgICAgICAgICAgICAgQ2xhc3M8Pz5bXSB0eXBlcyA9IGV4LmdldFBy\nb2plY3Rpb25UeXBlcyhxKTsKICAgICAgICAgICAgICAgIF9wYWNrZXIgPSBu\nZXcgUmVzdWx0UGFja2VyKHR5cGVzLCBhbGlhc2VzLCByZXN1bHRDbGFzcyk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9wYWNr\nZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYW4gZW1wdHkgcmVz\ndWx0IGZvciB0aGlzIHF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIE9iamVj\ndCBlbXB0eVJlc3VsdChTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0\nb3IgZXgpIHsKICAgICAgICBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUg\nfHwgKF91bmlxdWUgPT0gbnVsbAogICAgICAgICAgICAmJiAhZXguaGFzR3Jv\ndXBpbmcocSkgJiYgZXguaXNBZ2dyZWdhdGUocSkpKQogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICByZXR1cm4gQ29sbGVjdGlvbnMuRU1QVFlf\nTElTVDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgYW4gZXhwZWN0\nZWQgc2luZ2xlIHJlc3VsdCBmcm9tIHRoZSBnaXZlbiBwcm92aWRlci4gVXNl\nZCB3aGVuCiAgICAgKiB0aGUgcmVzdWx0IGlzIGFuIHVuZ3JvdXBlZCBhZ2dy\nZWdhdGUgb3IgdGhlIHVuaXF1ZSBmbGFnIGlzIHNldCB0byB0cnVlLgogICAg\nICovCiAgICBwcml2YXRlIE9iamVjdCBzaW5nbGVSZXN1bHQoUmVzdWx0T2Jq\nZWN0UHJvdmlkZXIgcm9wLCAKICAgICAgICBTdG9yZVF1ZXJ5LlJhbmdlIHJh\nbmdlKQogICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHJvcC5v\ncGVuKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gbW92ZSB0byBl\neHBlY3RlZCByZXN1bHQKICAgICAgICAgICAgYm9vbGVhbiBuZXh0ID0gcm9w\nLm5leHQoKTsKCiAgICAgICAgICAgIC8vIGV4dHJhY3Qgc2luZ2xlIHJlc3Vs\ndDsgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIG11bHRpcGxlIHJlc3VsdHMKICAg\nICAgICAgICAgLy8gbWF0Y2ggYW5kIG5vdCBjb25zdHJhaW50ZWQgYnkgcmFu\nZ2UsIG9yIGlmIGEgdW5pcXVlIHF1ZXJ5IHdpdGgKICAgICAgICAgICAgLy8g\nbm8gcmVzdWx0cwogICAgICAgICAgICBPYmplY3Qgc2luZ2xlID0gbnVsbDsK\nICAgICAgICAgICAgaWYgKG5leHQpIHsKICAgICAgICAgICAgICAgIHNpbmds\nZSA9IHJvcC5nZXRSZXN1bHRPYmplY3QoKTsKICAgICAgICAgICAgICAgIGlm\nIChyYW5nZS5lbmQgIT0gcmFuZ2Uuc3RhcnQgKyAxICYmIHJvcC5uZXh0KCkp\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vblVuaXF1ZVJlc3Vs\ndEV4Y2VwdGlvbihfbG9jLmdldCgibm90LXVuaXF1ZSIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIF9jbGFzcywgX3F1ZXJ5KSk7CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAoX3VuaXF1ZSA9PSBCb29sZWFuLlRSVUUpCiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTm9SZXN1bHRFeGNlcHRpb24oX2xvYy5nZXQoIm5v\nLXJlc3VsdCIsIAogICAgICAgICAgICAgICAgICAgIF9jbGFzcywgX3F1ZXJ5\nKSk7CgogICAgICAgICAgICAvLyBpZiB1bmlxdWUgc2V0IHRvIGZhbHNlLCB1\nc2UgY29sbGVjdGlvbgogICAgICAgICAgICBpZiAoX3VuaXF1ZSA9PSBCb29s\nZWFuLkZBTFNFKSB7CiAgICAgICAgICAgICAgICBpZiAoIW5leHQpCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25zLkVNUFRZX0xJU1Q7\nCiAgICAgICAgICAgICAgICAvLyBDb2xsZWN0aW9ucy5zaW5nbGV0b25MaXN0\nIGlzIEpESyAxLjMsIHNvLi4uCiAgICAgICAgICAgICAgICByZXR1cm4gQXJy\nYXlzLmFzTGlzdChuZXcgT2JqZWN0W117IHNpbmdsZSB9KTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gcmV0dXJuIHNpbmds\nZSByZXN1bHQKICAgICAgICAgICAgcmV0dXJuIHNpbmdsZTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICByb3AuY2xvc2UoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIHdoZXRoZXIgdGhl\nIGFjY2VzcyBwYXRoIG9mIHRoaXMgcXVlcnkgaW50ZXJzZWN0cyB3aXRoCiAg\nICAgKiBhbnkgZGlydHkgb2JqZWN0cyBpbiB0aGUgdHJhbnNhY3Rpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBpc0FjY2Vzc1BhdGhEaXJ0eSgp\nIHsKICAgICAgICByZXR1cm4gaXNBY2Nlc3NQYXRoRGlydHkoX2Jyb2tlciwg\nZ2V0QWNjZXNzUGF0aE1ldGFEYXRhcygpKTsKICAgIH0KCiAgICBwdWJsaWMg\nc3RhdGljIGJvb2xlYW4gaXNBY2Nlc3NQYXRoRGlydHkoQnJva2VyIGJyb2tl\nciwKICAgICAgICBDbGFzc01ldGFEYXRhW10gYWNjZXNzTWV0YXMpIHsKICAg\nICAgICBDb2xsZWN0aW9uPENsYXNzPD8+PiBwZXJzaXN0ZWQgPSBicm9rZXIu\nZ2V0UGVyc2lzdGVkVHlwZXMoKTsKICAgICAgICBDb2xsZWN0aW9uPENsYXNz\nPD8+PiB1cGRhdGVkID0gYnJva2VyLmdldFVwZGF0ZWRUeXBlcygpOwogICAg\nICAgIENvbGxlY3Rpb248Q2xhc3M8Pz4+IGRlbGV0ZWQgPSBicm9rZXIuZ2V0\nRGVsZXRlZFR5cGVzKCk7CiAgICAgICAgaWYgKHBlcnNpc3RlZC5pc0VtcHR5\nKCkgJiYgdXBkYXRlZC5pc0VtcHR5KCkgJiYgZGVsZXRlZC5pc0VtcHR5KCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gaWYgbm8g\nYWNjZXNzIG1ldGFzLCBhc3N1bWUgZXZlcnkgZGlydHkgb2JqZWN0IGFmZmVj\ndHMgcGF0aCBqdXN0CiAgICAgICAgLy8gdG8gYmUgc2FmZQogICAgICAgIGlm\nIChhY2Nlc3NNZXRhcy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CgogICAgICAgIC8vIGNvbXBhcmUgZGlydHkgY2xhc3NlcyB0byB0\naGUgYWNjZXNzIHBhdGggY2xhc3NlcwogICAgICAgIENsYXNzPD8+IGFjY0Ns\nYXNzOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYWNjZXNzTWV0YXMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFjY2Vzc01ldGFzW2ld\nID09IG51bGwpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgLy8gc2hvcnRjdXQgaWYgYWN0dWFsIGNsYXNzIGlzIGRpcnR5CiAgICAg\nICAgICAgIGFjY0NsYXNzID0gYWNjZXNzTWV0YXNbaV0uZ2V0RGVzY3JpYmVk\nVHlwZSgpOwogICAgICAgICAgICBpZiAocGVyc2lzdGVkLmNvbnRhaW5zKGFj\nY0NsYXNzKSB8fCB1cGRhdGVkLmNvbnRhaW5zKGFjY0NsYXNzKQogICAgICAg\nICAgICAgICAgfHwgZGVsZXRlZC5jb250YWlucyhhY2NDbGFzcykpCiAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgICAgIC8vIGNoZWNr\nIGZvciBkaXJ0eSBzdWJjbGFzcwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9y\nPENsYXNzPD8+PiBkaXJ0eSA9IHBlcnNpc3RlZC5pdGVyYXRvcigpOyBkaXJ0\neS5oYXNOZXh0KCk7KQogICAgICAgICAgICAgICAgaWYgKGFjY0NsYXNzLmlz\nQXNzaWduYWJsZUZyb20oZGlydHkubmV4dCgpKSkKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxD\nbGFzczw/Pj4gZGlydHkgPSB1cGRhdGVkLml0ZXJhdG9yKCk7IGRpcnR5Lmhh\nc05leHQoKTspCiAgICAgICAgICAgICAgICBpZiAoYWNjQ2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShkaXJ0eS5uZXh0KCkpKQogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPENsYXNz\nPD8+PiBkaXJ0eSA9IGRlbGV0ZWQuaXRlcmF0b3IoKTsgZGlydHkuaGFzTmV4\ndCgpOykKICAgICAgICAgICAgICAgIGlmIChhY2NDbGFzcy5pc0Fzc2lnbmFi\nbGVGcm9tKGRpcnR5Lm5leHQoKSkpCiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBubyBpbnRlcnNlY3Rp\nb24KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIHZv\naWQgY2xvc2VBbGwoKSB7CiAgICAgICAgY2xvc2VSZXN1bHRzKHRydWUpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlUmVzb3VyY2VzKCkgewogICAg\nICAgIGNsb3NlUmVzdWx0cyhmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbG9zZSBvcGVuIHJlc3VsdHMuCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBjbG9zZVJlc3VsdHMoYm9vbGVhbiBmb3JjZSkgewogICAgICAgIGxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7Cgog\nICAgICAgICAgICBSZW1vdmVPbkNsb3NlUmVzdWx0TGlzdCByZXM7CiAgICAg\nICAgICAgIGZvciAoSXRlcmF0b3I8UmVtb3ZlT25DbG9zZVJlc3VsdExpc3Q+\nIGl0ciA9IF9yZXN1bHRMaXN0cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgp\nOykgewogICAgICAgICAgICAgICAgcmVzID0gaXRyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIGlmIChmb3JjZSB8fCByZXMuaXNQcm92aWRlck9wZW4oKSkK\nICAgICAgICAgICAgICAgICAgICByZXMuY2xvc2UoZmFsc2UpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIF9yZXN1bHRMaXN0cy5jbGVhcigpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nW10gZ2V0RGF0YVN0b3JlQWN0\naW9ucyhNYXAgcGFyYW1zKSB7CiAgICAgICAgaWYgKHBhcmFtcyA9PSBudWxs\nKQogICAgICAgICAgICBwYXJhbXMgPSBDb2xsZWN0aW9ucy5FTVBUWV9NQVA7\nCgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBh\nc3NlcnROb3RTZXJpYWxpemVkKCk7CiAgICAgICAgICAgIGFzc2VydE9wZW4o\nKTsKCiAgICAgICAgICAgIFN0b3JlUXVlcnkuRXhlY3V0b3IgZXggPSBjb21w\naWxlRm9yRXhlY3V0b3IoKTsKICAgICAgICAgICAgYXNzZXJ0UGFyYW1ldGVy\ncyhfc3RvcmVRdWVyeSwgZXgsIHBhcmFtcyk7CiAgICAgICAgICAgIE9iamVj\ndFtdIGFyciA9IGV4LnRvUGFyYW1ldGVyQXJyYXkoX3N0b3JlUXVlcnksIHBh\ncmFtcyk7CiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UgPSBu\nZXcgU3RvcmVRdWVyeS5SYW5nZShfc3RhcnRJZHgsIF9lbmRJZHgpOwogICAg\nICAgICAgICBpZiAoIV9yYW5nZVNldCkKICAgICAgICAgICAgICAgIGV4Lmdl\ndFJhbmdlKF9zdG9yZVF1ZXJ5LCBhcnIsIHJhbmdlKTsKICAgICAgICAgICAg\ncmV0dXJuIGV4LmdldERhdGFTdG9yZUFjdGlvbnMoX3N0b3JlUXVlcnksIGFy\nciwgcmFuZ2UpOwogICAgICAgIH0gY2F0Y2ggKE9wZW5KUEFFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgdGhyb3cga2U7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNl\ncHRpb24oZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIHNl\ndFF1ZXJ5KE9iamVjdCBxdWVyeSkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBhc3NlcnRPcGVuKCk7CiAgICAgICAgICAg\nIGFzc2VydE5vdFJlYWRPbmx5KCk7CgogICAgICAgICAgICBpZiAocXVlcnkg\nPT0gbnVsbCB8fCBxdWVyeSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAg\nICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAgICAgICAg\nICAgICBfcXVlcnkgPSAoU3RyaW5nKSBxdWVyeTsKICAgICAgICAgICAgICAg\nIGlmIChfcXVlcnkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBfcXVl\ncnkgPSBfcXVlcnkudHJpbSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEocXVlcnkgaW5z\ndGFuY2VvZiBRdWVyeUltcGwpKQogICAgICAgICAgICAgICAgcmV0dXJuIF9z\ndG9yZVF1ZXJ5LnNldFF1ZXJ5KHF1ZXJ5KTsKCiAgICAgICAgICAgIC8vIGNv\ncHkgYWxsIG5vbi10cmFuc2llbnQgc3RhdGUgZnJvbSB0aGUgZ2l2ZW4gcXVl\ncnkKICAgICAgICAgICAgaW52YWxpZGF0ZUNvbXBpbGF0aW9uKCk7CiAgICAg\nICAgICAgIFF1ZXJ5SW1wbCBxID0gKFF1ZXJ5SW1wbCkgcXVlcnk7CiAgICAg\nICAgICAgIF9jbGFzcyA9IHEuX2NsYXNzOwogICAgICAgICAgICBfc3ViY2xh\nc3NlcyA9IHEuX3N1YmNsYXNzZXM7CiAgICAgICAgICAgIF9xdWVyeSA9IHEu\nX3F1ZXJ5OwogICAgICAgICAgICBfaWdub3JlQ2hhbmdlcyA9IHEuX2lnbm9y\nZUNoYW5nZXM7CiAgICAgICAgICAgIF91bmlxdWUgPSBxLl91bmlxdWU7CiAg\nICAgICAgICAgIF9yZXN1bHRDbGFzcyA9IHEuX3Jlc3VsdENsYXNzOwogICAg\nICAgICAgICBfcGFyYW1zID0gcS5fcGFyYW1zOwogICAgICAgICAgICBfcmVz\ndWx0TWFwcGluZ1Njb3BlID0gcS5fcmVzdWx0TWFwcGluZ1Njb3BlOwogICAg\nICAgICAgICBfcmVzdWx0TWFwcGluZ05hbWUgPSBxLl9yZXN1bHRNYXBwaW5n\nTmFtZTsKICAgICAgICAgICAgX3JlYWRPbmx5ID0gcS5fcmVhZE9ubHk7Cgog\nICAgICAgICAgICAvLyBkb24ndCBzaGFyZSBtdXRhYmxlIG9iamVjdHMKICAg\nICAgICAgICAgX2ZjLmNvcHkocS5fZmMpOwogICAgICAgICAgICBpZiAocS5f\nZmlsdExpc3RlbmVycyAhPSBudWxsKQogICAgICAgICAgICAgICAgX2ZpbHRM\naXN0ZW5lcnMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsRmlsdGVyTGlzdGVuZXI+\nKHEuX2ZpbHRMaXN0ZW5lcnMpOwogICAgICAgICAgICBpZiAocS5fYWdnTGlz\ndGVuZXJzICE9IG51bGwpCiAgICAgICAgICAgICAgICBfYWdnTGlzdGVuZXJz\nID0gbmV3IEhhc2hNYXA8U3RyaW5nLEFnZ3JlZ2F0ZUxpc3RlbmVyPihxLl9h\nZ2dMaXN0ZW5lcnMpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXRBbGlhcygpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5nIGFs\naWFzID0gY29tcGlsZUZvckV4ZWN1dG9yKCkuZ2V0QWxpYXMoX3N0b3JlUXVl\ncnkpOwogICAgICAgICAgICBpZiAoYWxpYXMgPT0gbnVsbCkKICAgICAgICAg\nICAgICAgIGFsaWFzID0gU3RyaW5ncy5nZXRDbGFzc05hbWUoX2NsYXNzKTsK\nICAgICAgICAgICAgcmV0dXJuIGFsaWFzOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgU3RyaW5nW10gZ2V0UHJvamVjdGlvbkFsaWFzZXMoKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBj\nb21waWxlRm9yRXhlY3V0b3IoKS5nZXRQcm9qZWN0aW9uQWxpYXNlcyhfc3Rv\ncmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBDbGFzczw/Pltd\nIGdldFByb2plY3Rpb25UeXBlcygpIHsKICAgICAgICBsb2NrKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVjdXRv\ncigpLmdldFByb2plY3Rpb25UeXBlcyhfc3RvcmVRdWVyeSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0T3BlcmF0aW9uKCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29t\ncGlsZUZvckV4ZWN1dG9yKCkuZ2V0T3BlcmF0aW9uKF9zdG9yZVF1ZXJ5KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNBZ2dyZWdhdGUo\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJldHVybiBjb21waWxlRm9yRXhlY3V0b3IoKS5pc0FnZ3JlZ2F0ZShfc3Rv\ncmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5s\nb2NrKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc0Rpc3RpbmN0KCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4ZWN1dG9yKCkuaXNE\naXN0aW5jdChfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJs\naWMgYm9vbGVhbiBoYXNHcm91cGluZygpIHsKICAgICAgICBsb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVGb3JFeGVj\ndXRvcigpLmhhc0dyb3VwaW5nKF9zdG9yZVF1ZXJ5KTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIENsYXNzTWV0YURhdGFbXSBnZXRBY2Nlc3NQYXRoTWV0\nYURhdGFzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBDbGFzc01ldGFEYXRhW10gbWV0YXMgPSBjb21waWxlRm9yRXhl\nY3V0b3IoKS4KICAgICAgICAgICAgICAgIGdldEFjY2Vzc1BhdGhNZXRhRGF0\nYXMoX3N0b3JlUXVlcnkpOwogICAgICAgICAgICByZXR1cm4gKG1ldGFzID09\nIG51bGwpID8gU3RvcmVRdWVyeS5FTVBUWV9NRVRBUyA6IG1ldGFzOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgT3JkZXJlZE1hcDxPYmplY3QsQ2xhc3M8\nPz4+IGdldE9yZGVyZWRQYXJhbWV0ZXJUeXBlcygpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBpbGVG\nb3JFeGVjdXRvcigpLmdldE9yZGVyZWRQYXJhbWV0ZXJUeXBlcyhfc3RvcmVR\ndWVyeSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgTGlua2VkTWFw\nIGdldFBhcmFtZXRlclR5cGVzKCkgewogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBMaW5rZWRNYXAgd3JhcCA9IG5ldyBMaW5r\nZWRNYXAoKTsKICAgICAgICAgICAgd3JhcC5wdXRBbGwoY29tcGlsZUZvckV4\nZWN1dG9yKCkuZ2V0T3JkZXJlZFBhcmFtZXRlclR5cGVzKF9zdG9yZVF1ZXJ5\nKSk7CiAgICAgICAgICAgIHJldHVybiB3cmFwOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCgog\nICAgcHVibGljIE1hcCBnZXRVcGRhdGVzKCkgewogICAgICAgIGxvY2soKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gY29tcGlsZUZvckV4\nZWN1dG9yKCkuZ2V0VXBkYXRlcyhfc3RvcmVRdWVyeSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGxvY2soKSB7CiAgICAgICAgaWYgKF9sb2Nr\nICE9IG51bGwpCiAgICAgICAgICAgIF9sb2NrLmxvY2soKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCB1bmxvY2soKSB7CiAgICAgICAgaWYgKF9sb2NrICE9\nIG51bGwpCiAgICAgICAgICAgIF9sb2NrLnVubG9jaygpOwogICAgfQogICAg\nCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgc3RhcnRMb2NraW5nKCkg\newogICAgCWlmIChfbG9jayA9PSBudWxsKSB7CiAgICAJCV9sb2NrID0gbmV3\nIFJlZW50cmFudExvY2soKTsKICAgIAl9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBzeW5jaHJvbml6ZWQgdm9pZCBzdG9wTG9ja2luZygpIHsKICAgIAlpZiAo\nX2xvY2sgIT0gbnVsbCAmJiAhX2Jyb2tlci5nZXRNdWx0aXRocmVhZGVkKCkp\nCiAgICAJCV9sb2NrID0gbnVsbDsKICAgIH0KICAgIAogICAgCgogICAgLy8v\nLy8vLy8vCiAgICAvLyBVdGlscwogICAgLy8vLy8vLy8vCgogICAgcHVibGlj\nIENsYXNzIGNsYXNzRm9yTmFtZShTdHJpbmcgbmFtZSwgU3RyaW5nW10gaW1w\nb3J0cykgewogICAgICAgIC8vIGZ1bGwgY2xhc3MgbmFtZSBvciBwcmltaXRp\ndmUgdHlwZT8KICAgICAgICBDbGFzcyB0eXBlID0gdG9DbGFzcyhuYW1lKTsK\nICAgICAgICBpZiAodHlwZSAhPSBudWxsKQogICAgICAgICAgICByZXR1cm4g\ndHlwZTsKCiAgICAgICAgLy8gZmlyc3QgY2hlY2sgdGhlIGFsaWFzZXMgbWFw\nIGluIHRoZSBNZXRhRGF0YVJlcG9zaXRvcnkKICAgICAgICBDbGFzc0xvYWRl\nciBsb2FkZXIgPSAoX2NsYXNzID09IG51bGwpID8gX2xvYWRlcgogICAgICAg\nICAgICA6IEFjY2Vzc0NvbnRyb2xsZXIuZG9Qcml2aWxlZ2VkKAogICAgICAg\nICAgICAgICAgSjJEb1ByaXZIZWxwZXIuZ2V0Q2xhc3NMb2FkZXJBY3Rpb24o\nX2NsYXNzKSk7IAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0YSA9IF9icm9r\nZXIuZ2V0Q29uZmlndXJhdGlvbigpLgogICAgICAgICAgICBnZXRNZXRhRGF0\nYVJlcG9zaXRvcnlJbnN0YW5jZSgpLmdldE1ldGFEYXRhKG5hbWUsIGxvYWRl\nciwgZmFsc2UpOwogICAgICAgIGlmIChtZXRhICE9IG51bGwpCiAgICAgICAg\nICAgIHJldHVybiBtZXRhLmdldERlc2NyaWJlZFR5cGUoKTsKCiAgICAgICAg\nLy8gdHJ5IHRoZSBuYW1lIGluIHRoZSBwYWNrYWdlIG9mIHRoZSBjYW5kaWRh\ndGUgY2xhc3MKICAgICAgICBpZiAoX2NsYXNzICE9IG51bGwpIHsKICAgICAg\nICAgICAgU3RyaW5nIGZ1bGxOYW1lID0gX2NsYXNzLmdldE5hbWUoKS5zdWJz\ndHJpbmcKICAgICAgICAgICAgICAgICgwLCBfY2xhc3MuZ2V0TmFtZSgpLmxh\nc3RJbmRleE9mKCcuJykgKyAxKSArIG5hbWU7CiAgICAgICAgICAgIHR5cGUg\nPSB0b0NsYXNzKGZ1bGxOYW1lKTsKICAgICAgICAgICAgaWYgKHR5cGUgIT0g\nbnVsbCkKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgIH0K\nCiAgICAgICAgLy8gdHJ5IGphdmEubGFuZwogICAgICAgIHR5cGUgPSB0b0Ns\nYXNzKCJqYXZhLmxhbmcuIiArIG5hbWUpOwogICAgICAgIGlmICh0eXBlICE9\nIG51bGwpCiAgICAgICAgICAgIHJldHVybiB0eXBlOwoKICAgICAgICAvLyB0\ncnkgZWFjaCBpbXBvcnQKICAgICAgICBpZiAoaW1wb3J0cyAhPSBudWxsICYm\nIGltcG9ydHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBTdHJpbmcgZG90\nTmFtZSA9ICIuIiArIG5hbWU7CiAgICAgICAgICAgIFN0cmluZyBpbXBvcnRO\nYW1lOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGltcG9ydHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGltcG9ydE5hbWUgPSBp\nbXBvcnRzW2ldOwoKICAgICAgICAgICAgICAgIC8vIGZ1bGwgY2xhc3MgbmFt\nZSBpbXBvcnQKICAgICAgICAgICAgICAgIGlmIChpbXBvcnROYW1lLmVuZHNX\naXRoKGRvdE5hbWUpKQogICAgICAgICAgICAgICAgICAgIHR5cGUgPSB0b0Ns\nYXNzKGltcG9ydE5hbWUpOwogICAgICAgICAgICAgICAgICAgIC8vIHdpbGRj\nYXJkOyBzdHJpcCB0byBwYWNrYWdlCiAgICAgICAgICAgICAgICBlbHNlIGlm\nIChpbXBvcnROYW1lLmVuZHNXaXRoKCIuKiIpKSB7CiAgICAgICAgICAgICAg\nICAgICAgaW1wb3J0TmFtZSA9IGltcG9ydE5hbWUuc3Vic3RyaW5nCiAgICAg\nICAgICAgICAgICAgICAgICAgICgwLCBpbXBvcnROYW1lLmxlbmd0aCgpIC0g\nMSk7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRvQ2xhc3MoaW1wb3J0\nTmFtZSArIG5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaWYgKHR5cGUgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gdHlwZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUge0Bs\naW5rIENsYXNzfSBmb3IgdGhlIGdpdmVuIG5hbWUsIG9yIG51bGwgaWYgbmFt\nZSBub3QgdmFsaWQuCiAgICAgKi8KICAgIHByaXZhdGUgQ2xhc3MgdG9DbGFz\ncyhTdHJpbmcgbmFtZSkgewogICAgICAgIGlmIChfbG9hZGVyID09IG51bGwp\nCiAgICAgICAgICAgIF9sb2FkZXIgPSBfYnJva2VyLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXRDbGFzc1Jlc29sdmVySW5zdGFuY2UoKS4KICAgICAgICAgICAg\nICAgIGdldENsYXNzTG9hZGVyKF9jbGFzcywgX2Jyb2tlci5nZXRDbGFzc0xv\nYWRlcigpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gU3Ry\naW5ncy50b0NsYXNzKG5hbWUsIF9sb2FkZXIpOwogICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICB9IGNhdGNoIChOb0Ns\nYXNzRGVmRm91bmRFcnJvciBuY2RmZSkgewogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3NlcnRPcGVu\nKCkgewogICAgICAgIGlmIChfYnJva2VyICE9IG51bGwpCiAgICAgICAgICAg\nIF9icm9rZXIuYXNzZXJ0T3BlbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzc2VydE5vdFJlYWRPbmx5KCkgewogICAgICAgIGlmIChfcmVhZE9ubHkp\nCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRpb24o\nX2xvYy5nZXQoInJlYWQtb25seSIpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBhc3NlcnROb3RTZXJpYWxpemVkKCkgewogICAgICAgIGlmIChfYnJva2Vy\nID09IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVF\neGNlcHRpb24oX2xvYy5nZXQoInNlcmlhbGl6ZWQiKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDaGVjayB0aGF0IGEgY2FuZGlkYXRlIGNsYXNzIGhhcyBi\nZWVuIHNldCBmb3IgdGhlIHF1ZXJ5LgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgYXNzZXJ0Q2FuZGlkYXRlVHlwZSgpIHsKICAgICAgICBpZiAoX2NsYXNz\nID09IG51bGwgJiYgX3N0b3JlUXVlcnkucmVxdWlyZXNDYW5kaWRhdGVUeXBl\nKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoIm5vLWNsYXNzIikpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ2hlY2sgdGhhdCB3ZSBhcmUgaW4gYSBzdGF0ZSB0byBiZSBhYmxlIHRv\nIHBlcmZvcm0gYSBidWxrIG9wZXJhdGlvbjsKICAgICAqIGFsc28gZmx1c2gg\ndGhlIGN1cnJlbnQgbW9kZmljYXRpb25zIGlmIGFueSBlbGVtZW50cyBhcmUg\nY3VycmVudGx5IGRpcnR5LgogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNz\nZXJ0QnVsa01vZGlmeShTdG9yZVF1ZXJ5IHEsIFN0b3JlUXVlcnkuRXhlY3V0\nb3IgZXgsIAogICAgICAgIE9iamVjdFtdIHBhcmFtcykgewogICAgICAgIF9i\ncm9rZXIuYXNzZXJ0QWN0aXZlVHJhbnNhY3Rpb24oKTsKICAgICAgICBpZiAo\nX3N0YXJ0SWR4ICE9IDAgfHwgX2VuZElkeCAhPSBMb25nLk1BWF9WQUxVRSkK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vLW1vZGlmeS1yYW5nZSIpKTsKICAgICAgICBpZiAoX3Jlc3VsdENsYXNz\nICE9IG51bGwpCiAgICAgICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9u\nKF9sb2MuZ2V0KCJuby1tb2RpZnktcmVzdWx0Y2xhc3MiKSk7CiAgICAgICAg\nU3RvcmVRdWVyeS5SYW5nZSByYW5nZSA9IG5ldyBTdG9yZVF1ZXJ5LlJhbmdl\nKCk7CiAgICAgICAgZXguZ2V0UmFuZ2UocSwgcGFyYW1zLCByYW5nZSk7CiAg\nICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDAgfHwgcmFuZ2UuZW5kICE9IExv\nbmcuTUFYX1ZBTFVFKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tbW9kaWZ5LXJhbmdlIikpOwogICAgfQoKICAg\nIC8qKgogICAgICogQ2hlY2tzIHRoYXQgdGhlIHBhc3NlZCBwYXJhbWV0ZXJz\nIG1hdGNoIHRoZSBkZWNsYXJhdGlvbnMuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGFzc2VydFBhcmFtZXRlcnMoU3RvcmVRdWVyeSBxLCBTdG9yZVF1\nZXJ5LkV4ZWN1dG9yIGV4LCAKICAgICAgICBPYmplY3RbXSBwYXJhbXMpIHsK\nICAgICAgICBpZiAoIXEucmVxdWlyZXNQYXJhbWV0ZXJEZWNsYXJhdGlvbnMo\nKSB8fCAhaXNQYXJzZWRRdWVyeSgpKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIE9yZGVyZWRNYXA8T2JqZWN0LENsYXNzPD8+PiBwYXJhbVR5cGVz\nID0gZXguZ2V0T3JkZXJlZFBhcmFtZXRlclR5cGVzKHEpOwogICAgICAgIGlu\ndCB0eXBlQ291bnQgPSBwYXJhbVR5cGVzLnNpemUoKTsKICAgICAgICBpZiAo\ndHlwZUNvdW50ID4gcGFyYW1zLmxlbmd0aCkKICAgICAgICAgICAgdGhyb3cg\nbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoInVuYm91bmQtcGFyYW1zIiwK\nICAgICAgICAgICAgICAgIHBhcmFtVHlwZXMua2V5U2V0KCkpKTsKCiAgICAg\nICAgSXRlcmF0b3I8TWFwLkVudHJ5PE9iamVjdCxDbGFzczw/Pj4+IGl0ciA9\nIHBhcmFtVHlwZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIE1h\ncC5FbnRyeTxPYmplY3QsQ2xhc3M8Pz4+IGVudHJ5OwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpdHIuaGFzTmV4dCgpOyBpKyspIHsKICAgICAgICAgICAg\nZW50cnkgPSBpdHIubmV4dCgpOwogICAgICAgICAgICBpZiAoZW50cnkuZ2V0\nVmFsdWUoKS5pc1ByaW1pdGl2ZSgpICYmIHBhcmFtc1tpXSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5n\nZXQoIm51bGwtcHJpbWl0aXZlLXBhcmFtIiwgZW50cnkuZ2V0S2V5KCkpKTsK\nICAgICAgICB9CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCB2b2lkIGFzc2Vy\ndFBhcmFtZXRlcnMoU3RvcmVRdWVyeSBxLCBTdG9yZVF1ZXJ5LkV4ZWN1dG9y\nIGV4LCBNYXAgcGFyYW1zKSB7CiAgICAgICAgaWYgKCFxLnJlcXVpcmVzUGFy\nYW1ldGVyRGVjbGFyYXRpb25zKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAg\nICAgICAgT3JkZXJlZE1hcDxPYmplY3QsQ2xhc3M8Pz4+IHBhcmFtVHlwZXMg\nPSBleC5nZXRPcmRlcmVkUGFyYW1ldGVyVHlwZXMocSk7CiAgICAgICAgZm9y\nIChPYmplY3QgYWN0dWFsIDogcGFyYW1zLmtleVNldCgpKSB7CiAgICAgICAg\nICAgIGlmICghcGFyYW1UeXBlcy5jb250YWluc0tleShhY3R1YWwpKQogICAg\nICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldCgidW5i\nb3VuZC1wYXJhbXMiLAogICAgICAgICAgICAgICAgYWN0dWFsLCBwYXJhbVR5\ncGVzLmtleVNldCgpKSk7CiAgICAgICAgfQogICAgICAgIGZvciAoT2JqZWN0\nIGV4cGVjdGVkIDogcGFyYW1UeXBlcy5rZXlTZXQoKSkgewogICAgICAgICAg\nICBpZiAoIXBhcmFtcy5jb250YWluc0tleShleHBlY3RlZCkpCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJ1bmJvdW5k\nLXBhcmFtcyIsCiAgICAgICAgICAgICAgICBleHBlY3RlZCwgcGFyYW1UeXBl\ncy5rZXlTZXQoKSkpOwogICAgICAgIH0KCiAgICAgICAgSXRlcmF0b3I8TWFw\nLkVudHJ5PE9iamVjdCwgQ2xhc3M8Pz4+PiBpdHIgPSBwYXJhbVR5cGVzLmVu\ndHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICBNYXAuRW50cnk8T2JqZWN0\nLCBDbGFzczw/Pj4gZW50cnk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGl0\nci5oYXNOZXh0KCk7IGkrKykgewogICAgICAgICAgICBlbnRyeSA9IGl0ci5u\nZXh0KCk7CiAgICAgICAgICAgIGlmIChlbnRyeS5nZXRWYWx1ZSgpLmlzUHJp\nbWl0aXZlKCkgCiAgICAgICAgICAgICAgICAmJiBwYXJhbXMuZ2V0KGVudHJ5\nLmdldEtleSgpKSA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVzZXJFeGNlcHRpb24oX2xvYy5nZXQoIm51bGwtcHJpbWl0aXZlLXBhcmFt\nIiwgZW50cnkuZ2V0S2V5KCkpKTsKICAgICAgICB9CiAgICB9CgoKICAgIHB1\nYmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgU3RyaW5nQnVpbGRl\nciBidWYgPSBuZXcgU3RyaW5nQnVpbGRlcigyNTUpOwogICAgICAgIGJ1Zi5h\ncHBlbmQoIlF1ZXJ5OiAiKS5hcHBlbmQoc3VwZXIudG9TdHJpbmcoKSk7CiAg\nICAgICAgYnVmLmFwcGVuZCgiOyBjYW5kaWRhdGUgY2xhc3M6ICIpLmFwcGVu\nZChfY2xhc3MpOwogICAgICAgIGJ1Zi5hcHBlbmQoIjsgcXVlcnk6ICIpLmFw\ncGVuZChfcXVlcnkpOwogICAgICAgIHJldHVybiBidWYudG9TdHJpbmcoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFN0cnVjdCBvZiBjb21waWxlZCBxdWVy\neSBwcm9wZXJ0aWVzLgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGNs\nYXNzIENvbXBpbGF0aW9uCiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFi\nbGUgewoKICAgICAgICBwdWJsaWMgU3RvcmVRdWVyeS5FeGVjdXRvciBtZW1v\ncnkgPSBudWxsOwogICAgICAgIHB1YmxpYyBTdG9yZVF1ZXJ5LkV4ZWN1dG9y\nIGRhdGFzdG9yZSA9IG51bGw7CiAgICAgICAgcHVibGljIE9iamVjdCBzdG9y\nZURhdGEgPSBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogU3RydWN0IHRv\nIGhvbGQgdGhlIHVucGFyc2VkIHByb3BlcnRpZXMgYXNzb2NpYXRlZCB3aXRo\nIGEgcXVlcnkuCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIENv\nbXBpbGF0aW9uS2V5CiAgICAgICAgaW1wbGVtZW50cyBTZXJpYWxpemFibGUg\newoKICAgICAgICBwdWJsaWMgQ2xhc3MgcXVlcnlUeXBlID0gbnVsbDsKICAg\nICAgICBwdWJsaWMgQ2xhc3MgY2FuZGlkYXRlVHlwZSA9IG51bGw7CiAgICAg\nICAgcHVibGljIGJvb2xlYW4gc3ViY2xhc3NlcyA9IHRydWU7CiAgICAgICAg\ncHVibGljIFN0cmluZyBxdWVyeSA9IG51bGw7CiAgICAgICAgcHVibGljIFN0\ncmluZyBsYW5ndWFnZSA9IG51bGw7CiAgICAgICAgcHVibGljIE9iamVjdCBz\ndG9yZUtleSA9IG51bGw7CgogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUo\nKSB7CiAgICAgICAgICAgIGludCBycyA9IDE3OwogICAgICAgICAgICBycyA9\nIDM3ICogcnMgKyAoKHF1ZXJ5VHlwZSA9PSBudWxsKSA/IDAgOiBxdWVyeVR5\ncGUuaGFzaENvZGUoKSk7CiAgICAgICAgICAgIHJzID0gMzcgKiBycyArICgo\ncXVlcnkgPT0gbnVsbCkgPyAwIDogcXVlcnkuaGFzaENvZGUoKSk7CiAgICAg\nICAgICAgIHJzID0gMzcgKiBycyArICgobGFuZ3VhZ2UgPT0gbnVsbCkgPyAw\nIDogbGFuZ3VhZ2UuaGFzaENvZGUoKSk7CiAgICAgICAgICAgIHJzID0gMzcg\nKiBycyArICgoc3RvcmVLZXkgPT0gbnVsbCkgPyAwIDogc3RvcmVLZXkuaGFz\naENvZGUoKSk7CiAgICAgICAgICAgIGlmIChzdWJjbGFzc2VzKQogICAgICAg\nICAgICAgIHJzKys7CiAgICAgICAgICAgIHJldHVybiByczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb3RoZXIp\nIHsKICAgICAgICAgICAgaWYgKG90aGVyID09IHRoaXMpCiAgICAgICAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKG90aGVyID09IG51\nbGwgfHwgb3RoZXIuZ2V0Q2xhc3MoKSAhPSBnZXRDbGFzcygpKQogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgQ29tcGlsYXRp\nb25LZXkga2V5ID0gKENvbXBpbGF0aW9uS2V5KSBvdGhlcjsKICAgICAgICAg\nICAgaWYgKGtleS5xdWVyeVR5cGUgIT0gcXVlcnlUeXBlCiAgICAgICAgICAg\nICAgICB8fCAhU3RyaW5nVXRpbHMuZXF1YWxzKGtleS5xdWVyeSwgcXVlcnkp\nCiAgICAgICAgICAgICAgICB8fCAhU3RyaW5nVXRpbHMuZXF1YWxzKGtleS5s\nYW5ndWFnZSwgbGFuZ3VhZ2UpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICBpZiAoa2V5LnN1YmNsYXNzZXMgIT0gc3ViY2xh\nc3NlcykKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgaWYgKCFPYmplY3RVdGlscy5lcXVhbHMoa2V5LnN0b3JlS2V5LCBzdG9y\nZUtleSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAg\nICAgICAvLyBhbGxvdyBlaXRoZXIgY2FuZGlkYXRlIHR5cGUgdG8gYmUgbnVs\nbCBiZWNhdXNlIGl0IG1pZ2h0IGJlCiAgICAgICAgICAgIC8vIGVuY29kZWQg\naW4gdGhlIHF1ZXJ5IHN0cmluZywgYnV0IGlmIGJvdGggYXJlIHNldCB0aGVu\nIHRoZXkKICAgICAgICAgICAgLy8gbXVzdCBiZSBlcXVhbAogICAgICAgICAg\nICByZXR1cm4ga2V5LmNhbmRpZGF0ZVR5cGUgPT0gbnVsbCB8fCBjYW5kaWRh\ndGVUeXBlID09IG51bGwKICAgICAgICAgICAgICAgIHx8IGtleS5jYW5kaWRh\ndGVUeXBlID09IGNhbmRpZGF0ZVR5cGU7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogQSBtZXJnZWQgZXhlY3V0b3IgZXhlY3V0ZXMgbXVsdGlw\nbGUgUXVlcmllcyBhbmQgcmV0dXJucwogICAgICogYSBtZXJnZWQgcmVzdWx0\nIGxpc3Qgd2l0aCB0aGUgYXBwcm9wcmlhdGUgb3JkZXJpbmcgKGlmIG1vcmUg\ndGhhbgogICAgICogb25lIHF1ZXJ5IG5lZWRzIHRvIGJlIGV4ZWN1dGVkKS4g\nVGhpcyBleGVjdXRvciBoYXMgdGhlIGZvbGxvd2luZwogICAgICogbGltaXRh\ndGlvbnM6CiAgICAgKiA8dWw+CiAgICAgKiA8bGk+SXQgY2Fubm90IGNvbWJp\nbmUgYWdncmVnYXRlcy4KICAgICAqIDxsaT5JdCBjYW5ub3QgY29sbGF0ZSB0\naGUgcmVzdWx0IGxpc3RzIGlmIG9yZGVyaW5nIGlzIHNwZWNpZmllZCBhbmQK\nICAgICAqIGEgcmVzdWx0IHN0cmluZyBpcyBnaXZlbiwgYnV0IGRvZXMgbm90\nIGluY2x1ZGUgdGhlIG9yZGVyaW5nCiAgICAgKiBjcml0ZXJpYS48L2xpPgog\nICAgICogPGxpPkl0IGNhbm5vdCBmaWx0ZXIgZHVwbGljYXRlIHJlc3VsdHMg\nZnJvbSBkaWZmZXJlbnQgcmVzdWx0IGxpc3RzIGlmCiAgICAgKiB0aGUgcmVz\ndWx0IGlzIG1hcmtlZCBkaXN0aW5jdC4gVGhpcyB3b3VsZCByZXF1aXJlIHRy\nYWNraW5nIGFsbAogICAgICogcHJldmlvdXMgcmVzdWx0cywgd2hpY2ggd291\nbGQgaW50ZXJmZXJlIHdpdGggbGFyZ2UgcmVzdWx0IHNldAogICAgICogaGFu\nZGxpbmcuPC9saT4KICAgICAqIDwvdWw+CiAgICAgKgogICAgICogQGF1dGhv\nciBNYXJjIFBydWQnaG9tbWVhdXgKICAgICAqIEBub2phdmFkb2MKICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgTWVyZ2VkRXhlY3V0b3IKICAg\nICAgICBpbXBsZW1lbnRzIFN0b3JlUXVlcnkuRXhlY3V0b3IgewoKICAgICAg\nICBwcml2YXRlIGZpbmFsIFN0b3JlUXVlcnkuRXhlY3V0b3JbXSBfZXhlY3V0\nb3JzOwoKICAgICAgICBwdWJsaWMgTWVyZ2VkRXhlY3V0b3IoU3RvcmVRdWVy\neS5FeGVjdXRvcltdIGV4ZWN1dG9ycykgewogICAgICAgICAgICBfZXhlY3V0\nb3JzID0gZXhlY3V0b3JzOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBw\ndWJsaWMgUXVlcnlFeHByZXNzaW9uc1tdIGdldFF1ZXJ5RXhwcmVzc2lvbnMo\nKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFF1ZXJ5\nRXhwcmVzc2lvbnMoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZXN1\nbHRPYmplY3RQcm92aWRlciBleGVjdXRlUXVlcnkoU3RvcmVRdWVyeSBxLAog\nICAgICAgICAgICBPYmplY3RbXSBwYXJhbXMsIFN0b3JlUXVlcnkuUmFuZ2Ug\ncmFuZ2UpIHsKICAgICAgICAgICAgaWYgKF9leGVjdXRvcnMubGVuZ3RoID09\nIDEpCiAgICAgICAgICAgICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5leGVj\ndXRlUXVlcnkocSwgcGFyYW1zLCByYW5nZSk7CgogICAgICAgICAgICAvLyB1\nc2UgbHJzIHNldHRpbmdzIGlmIHdlIGNvdWxkbid0IHRha2UgYWR2YW50YWdl\nIG9mIHRoZSBzdGFydCBpbmRleAogICAgICAgICAgICAvLyBzbyB0aGF0IGhv\ncGVmdWxseSB0aGUgc2tpcCB0byB0aGUgc3RhcnQgd2lsbCBiZSBlZmZpY2ll\nbnQKICAgICAgICAgICAgU3RvcmVRdWVyeS5SYW5nZSByb3BSYW5nZSA9IG5l\ndyBTdG9yZVF1ZXJ5LlJhbmdlKDAsIHJhbmdlLmVuZCk7CiAgICAgICAgICAg\nIHJvcFJhbmdlLmxycyA9IHJhbmdlLmxycyB8fCAocmFuZ2Uuc3RhcnQgPiAw\nICYmIHEuZ2V0Q29udGV4dCgpLgogICAgICAgICAgICAgICAgZ2V0RmV0Y2hD\nb25maWd1cmF0aW9uKCkuZ2V0RmV0Y2hCYXRjaFNpemUoKSA+PSAwKTsKCiAg\nICAgICAgICAgIC8vIGV4ZWN1dGUgdGhlIHF1ZXJ5OyB3ZSBjYW5ub3QgdXNl\nIHRoZSBsb3dlciBib3VuZCBvZiB0aGUgcmVzdWx0CiAgICAgICAgICAgIC8v\nIHJhbmdlLCBidXQgd2UgY2FuIHRha2UgYWR2YW50YWdlIG9mIHRoZSB1cHBl\nciBib3VuZAogICAgICAgICAgICBSZXN1bHRPYmplY3RQcm92aWRlcltdIHJv\ncHMgPQogICAgICAgICAgICAgICAgbmV3IFJlc3VsdE9iamVjdFByb3ZpZGVy\nW19leGVjdXRvcnMubGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICAg\nICAgcm9wc1tpXSA9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZVF1ZXJ5KHEsIHBh\ncmFtcywgcm9wUmFuZ2UpOwoKICAgICAgICAgICAgYm9vbGVhbltdIGFzYyA9\nIF9leGVjdXRvcnNbMF0uZ2V0QXNjZW5kaW5nKHEpOwogICAgICAgICAgICBS\nZXN1bHRPYmplY3RQcm92aWRlciByb3A7CiAgICAgICAgICAgIGlmIChhc2Mu\nbGVuZ3RoID09IDApCiAgICAgICAgICAgICAgICByb3AgPSBuZXcgTWVyZ2Vk\nUmVzdWx0T2JqZWN0UHJvdmlkZXIocm9wcyk7CiAgICAgICAgICAgIGVsc2UK\nICAgICAgICAgICAgICAgIHJvcCA9IG5ldyBPcmRlcmluZ01lcmdlZFJlc3Vs\ndE9iamVjdFByb3ZpZGVyKHJvcHMsIGFzYywKICAgICAgICAgICAgICAgICAg\nICBfZXhlY3V0b3JzLCBxLCBwYXJhbXMpOwoKICAgICAgICAgICAgLy8gaWYg\ndGhlcmUgaXMgYSBsb3dlciBib3VuZCwgd3JhcCBpbiByYW5nZSByb3AKICAg\nICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IDApCiAgICAgICAgICAgICAg\nICByb3AgPSBuZXcgUmFuZ2VSZXN1bHRPYmplY3RQcm92aWRlcihyb3AsIHJh\nbmdlLnN0YXJ0LCAKICAgICAgICAgICAgICAgICAgICByYW5nZS5lbmQpOwog\nICAgICAgICAgICByZXR1cm4gcm9wOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIE51bWJlciBleGVjdXRlRGVsZXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0\nW10gcGFyYW1zKSB7CiAgICAgICAgICAgIGxvbmcgbnVtID0gMDsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsg\naSsrKQogICAgICAgICAgICAgICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhl\nY3V0ZURlbGV0ZShxLCBwYXJhbXMpLmxvbmdWYWx1ZSgpOwogICAgICAgICAg\nICByZXR1cm4gbnVtOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE51bWJl\nciBleGVjdXRlVXBkYXRlKFN0b3JlUXVlcnkgcSwgT2JqZWN0W10gcGFyYW1z\nKSB7CiAgICAgICAgICAgIGxvbmcgbnVtID0gMDsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBfZXhlY3V0b3JzLmxlbmd0aDsgaSsrKQogICAg\nICAgICAgICAgICAgbnVtICs9IF9leGVjdXRvcnNbaV0uZXhlY3V0ZVVwZGF0\nZShxLCBwYXJhbXMpLmxvbmdWYWx1ZSgpOwogICAgICAgICAgICByZXR1cm4g\nbnVtOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZ1tdIGdldERh\ndGFTdG9yZUFjdGlvbnMoU3RvcmVRdWVyeSBxLCBPYmplY3RbXSBwYXJhbXMs\nCiAgICAgICAgICAgIFN0b3JlUXVlcnkuUmFuZ2UgcmFuZ2UpIHsKICAgICAg\nICAgICAgaWYgKF9leGVjdXRvcnMubGVuZ3RoID09IDEpCiAgICAgICAgICAg\nICAgICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXREYXRhU3RvcmVBY3Rpb25z\nKHEsIHBhcmFtcywgcmFuZ2UpOwoKICAgICAgICAgICAgTGlzdCByZXN1bHRz\nID0gbmV3IEFycmF5TGlzdChfZXhlY3V0b3JzLmxlbmd0aCk7CiAgICAgICAg\nICAgIFN0b3JlUXVlcnkuUmFuZ2Ugcm9wUmFuZ2UgPSBuZXcgU3RvcmVRdWVy\neS5SYW5nZSgwTCwgcmFuZ2UuZW5kKTsKICAgICAgICAgICAgU3RyaW5nW10g\nYWN0aW9uczsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBfZXhl\nY3V0b3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBhY3Rpb25z\nID0gX2V4ZWN1dG9yc1tpXS5nZXREYXRhU3RvcmVBY3Rpb25zKHEsIHBhcmFt\ncyxyb3BSYW5nZSk7CiAgICAgICAgICAgICAgICBpZiAoYWN0aW9ucyAhPSBu\ndWxsICYmIGFjdGlvbnMubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAg\nICByZXN1bHRzLmFkZEFsbChBcnJheXMuYXNMaXN0KGFjdGlvbnMpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKFN0cmluZ1tdKSByZXN1\nbHRzLnRvQXJyYXkobmV3IFN0cmluZ1tyZXN1bHRzLnNpemUoKV0pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgdmFsaWRhdGUoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIF9leGVjdXRvcnNbMF0udmFsaWRhdGUocSk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBnZXRSYW5nZShTdG9y\nZVF1ZXJ5IHEsIE9iamVjdFtdIHBhcmFtcywgCiAgICAgICAgICAgIFN0b3Jl\nUXVlcnkuUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAgICAgX2V4ZWN1dG9yc1sw\nXS5nZXRSYW5nZShxLCBwYXJhbXMsIHJhbmdlKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBPYmplY3QgZ2V0T3JkZXJpbmdWYWx1ZShTdG9yZVF1ZXJ5\nIHEsIE9iamVjdFtdIHBhcmFtcywKICAgICAgICAgICAgT2JqZWN0IHJlc3Vs\ndE9iamVjdCwgaW50IGlkeCkgewogICAgICAgICAgICAvLyB1bmZvcnR1bmF0\nZWx5LCBhdCB0aGlzIHBvaW50IChtdXN0IGJlIGEgbWVyZ2VkIHJvcCBjb250\nYWluaW5nCiAgICAgICAgICAgIC8vIG90aGVyIG1lcmdlZCByb3BzKSB3ZSBo\nYXZlIG5vIGlkZWEgd2hpY2ggZXhlY3V0b3IgdG8gZXh0cmFjdAogICAgICAg\nICAgICAvLyB0aGUgdmFsdWUgZnJvbQogICAgICAgICAgICByZXR1cm4gX2V4\nZWN1dG9yc1swXS5nZXRPcmRlcmluZ1ZhbHVlKHEsIHBhcmFtcywgcmVzdWx0\nT2JqZWN0LCBpZHgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xl\nYW5bXSBnZXRBc2NlbmRpbmcoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAg\nIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldEFzY2VuZGluZyhxKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0QWxpYXMoU3RvcmVRdWVy\neSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldEFs\naWFzKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZ1tdIGdl\ndFByb2plY3Rpb25BbGlhc2VzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAg\nICByZXR1cm4gX2V4ZWN1dG9yc1swXS5nZXRQcm9qZWN0aW9uQWxpYXNlcyhx\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDbGFzcyBnZXRSZXN1bHRD\nbGFzcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJuIF9leGVj\ndXRvcnNbMF0uZ2V0UmVzdWx0Q2xhc3MocSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgUmVzdWx0U2hhcGU8Pz4gZ2V0UmVzdWx0U2hhcGUoU3RvcmVR\ndWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdl\ndFJlc3VsdFNoYXBlKHEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBw\ndWJsaWMgQ2xhc3NbXSBnZXRQcm9qZWN0aW9uVHlwZXMoU3RvcmVRdWVyeSBx\nKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBdLmdldFByb2pl\nY3Rpb25UeXBlcyhxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzUGFja2luZyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9leGVjdXRvcnNbMF0uaXNQYWNraW5nKHEpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIENsYXNzTWV0YURhdGFbXSBnZXRBY2Nlc3NQYXRoTWV0\nYURhdGFzKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBpZiAoX2V4ZWN1\ndG9ycy5sZW5ndGggPT0gMSkKICAgICAgICAgICAgICAgIHJldHVybiBfZXhl\nY3V0b3JzWzBdLmdldEFjY2Vzc1BhdGhNZXRhRGF0YXMocSk7CgogICAgICAg\nICAgICAvLyBjcmVhdGUgc2V0IG9mIGJhc2UgY2xhc3MgbWV0YWRhdGFzIGlu\nIGFjY2VzcyBwYXRoCiAgICAgICAgICAgIExpc3QgbWV0YXMgPSBudWxsOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IF9leGVjdXRvcnMubGVu\nZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBtZXRhcyA9IEZpbHRlcnMuYWRk\nQWNjZXNzUGF0aE1ldGFEYXRhcyhtZXRhcywgX2V4ZWN1dG9yc1tpXS4KICAg\nICAgICAgICAgICAgICAgICBnZXRBY2Nlc3NQYXRoTWV0YURhdGFzKHEpKTsK\nICAgICAgICAgICAgaWYgKG1ldGFzID09IG51bGwpCiAgICAgICAgICAgICAg\nICByZXR1cm4gU3RvcmVRdWVyeS5FTVBUWV9NRVRBUzsKICAgICAgICAgICAg\ncmV0dXJuIChDbGFzc01ldGFEYXRhW10pIG1ldGFzLnRvQXJyYXkKICAgICAg\nICAgICAgICAgIChuZXcgQ2xhc3NNZXRhRGF0YVttZXRhcy5zaXplKCldKTsK\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzQWdncmVnYXRl\nKFN0b3JlUXVlcnkgcSkgewogICAgICAgICAgICBpZiAoIV9leGVjdXRvcnNb\nMF0uaXNBZ2dyZWdhdGUocSkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgICAgICAvLyB3ZSBjYW4ndCBtZXJnZSBhZ2dyZWdhdGVz\nCiAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEV4Y2VwdGlvbihf\nbG9jLmdldCgibWVyZ2VkLWFnZ3JlZ2F0ZSIsCiAgICAgICAgICAgICAgICBx\nLmdldENvbnRleHQoKS5nZXRDYW5kaWRhdGVUeXBlKCksCiAgICAgICAgICAg\nICAgICBxLmdldENvbnRleHQoKS5nZXRRdWVyeVN0cmluZygpKSk7CiAgICAg\nICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBib29sZWFuIGlzRGlzdGlu\nY3QoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0\nb3JzWzBdLmlzRGlzdGluY3QocSk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgaW50IGdldE9wZXJhdGlvbihTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9leGVjdXRvcnNbMF0uZ2V0T3BlcmF0aW9uKHEpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzR3JvdXBpbmcoU3Rv\ncmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhlY3V0b3JzWzBd\nLmhhc0dyb3VwaW5nKHEpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9y\nZGVyZWRNYXA8T2JqZWN0LENsYXNzPD8+PiBnZXRPcmRlcmVkUGFyYW1ldGVy\nVHlwZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVybiBfZXhl\nY3V0b3JzWzBdLmdldE9yZGVyZWRQYXJhbWV0ZXJUeXBlcyhxKTsKICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIExpbmtlZE1hcCBnZXRQYXJh\nbWV0ZXJUeXBlcyhTdG9yZVF1ZXJ5IHEpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9leGVjdXRvcnNbMF0uZ2V0UGFyYW1ldGVyVHlwZXMocSk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b1BhcmFtZXRl\nckFycmF5KFN0b3JlUXVlcnkgcSwgTWFwIHVzZXJQYXJhbXMpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9leGVjdXRvcnNbMF0udG9QYXJhbWV0ZXJBcnJheShx\nLCB1c2VyUGFyYW1zKTsKICAgICAgICB9CgoKICAgICAgICBwdWJsaWMgTWFw\nIGdldFVwZGF0ZXMoU3RvcmVRdWVyeSBxKSB7CiAgICAgICAgICAgIHJldHVy\nbiBfZXhlY3V0b3JzWzBdLmdldFVwZGF0ZXMocSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogUmVzdWx0IG9iamVjdCBwcm92aWRlciB0aGF0\nIHBhY2tzIHJlc3VsdHMgYmVmb3JlIHJldHVybmluZyB0aGVtLgogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFBhY2tpbmdSZXN1bHRPYmplY3RQ\ncm92aWRlcgogICAgICAgIGltcGxlbWVudHMgUmVzdWx0T2JqZWN0UHJvdmlk\nZXIgewoKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdE9iamVjdFByb3Zp\nZGVyIF9kZWxlZ2F0ZTsKICAgICAgICBwcml2YXRlIGZpbmFsIFJlc3VsdFBh\nY2tlciBfcGFja2VyOwogICAgICAgIHByaXZhdGUgZmluYWwgaW50IF9sZW47\nCgogICAgICAgIHB1YmxpYyBQYWNraW5nUmVzdWx0T2JqZWN0UHJvdmlkZXIo\nUmVzdWx0T2JqZWN0UHJvdmlkZXIgZGVsZWdhdGUsCiAgICAgICAgICAgIFJl\nc3VsdFBhY2tlciBwYWNrZXIsIGludCByZXN1bHRMZW5ndGgpIHsKICAgICAg\nICAgICAgX2RlbGVnYXRlID0gZGVsZWdhdGU7CiAgICAgICAgICAgIF9wYWNr\nZXIgPSBwYWNrZXI7CiAgICAgICAgICAgIF9sZW4gPSByZXN1bHRMZW5ndGg7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBzdXBwb3J0c1Jh\nbmRvbUFjY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5z\ndXBwb3J0c1JhbmRvbUFjY2VzcygpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgb3BlbigpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgICAgICBfZGVsZWdhdGUub3BlbigpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE9iamVjdCBnZXRSZXN1bHRPYmplY3QoKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgT2JqZWN0IG9i\nID0gX2RlbGVnYXRlLmdldFJlc3VsdE9iamVjdCgpOwogICAgICAgICAgICBp\nZiAoX3BhY2tlciA9PSBudWxsICYmIF9sZW4gPT0gMSkKICAgICAgICAgICAg\nICAgIHJldHVybiAoKE9iamVjdFtdKSBvYilbMF07CiAgICAgICAgICAgIGlm\nIChfcGFja2VyID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4gb2I7\nCiAgICAgICAgICAgIGlmIChfbGVuID09IDApCiAgICAgICAgICAgICAgICBy\nZXR1cm4gX3BhY2tlci5wYWNrKG9iKTsKICAgICAgICAgICAgcmV0dXJuIF9w\nYWNrZXIucGFjaygoT2JqZWN0W10pIG9iKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIG5leHQoKQogICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5uZXh0KCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhYnNvbHV0ZShp\nbnQgcG9zKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgcmV0dXJuIF9kZWxlZ2F0ZS5hYnNvbHV0ZShwb3MpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGludCBzaXplKCkKICAgICAgICAgICAgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBfZGVsZWdhdGUu\nc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVzZXQo\nKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nX2RlbGVnYXRlLnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\ndm9pZCBjbG9zZSgpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgICAgICBfZGVsZWdhdGUuY2xvc2UoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGhhbmRsZUNoZWNrZWRFeGNlcHRpb24oRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgX2RlbGVnYXRlLmhhbmRsZUNoZWNrZWRF\neGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1Ymxp\nYyBSZXN1bHRPYmplY3RQcm92aWRlciBnZXREZWxlZ2F0ZSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIF9kZWxlZ2F0ZTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBSZXN1bHQgbGlzdCB0aGF0IHJlbW92ZXMgaXRzZWxmIGZy\nb20gdGhlIHF1ZXJ5J3Mgb3BlbiByZXN1bHQgbGlzdAogICAgICogd2hlbiBp\ndCBpcyBjbG9zZWQuIFB1YmxpYyBmb3IgdGVzdGluZy4KICAgICAqLwogICAg\ncHVibGljIGNsYXNzIFJlbW92ZU9uQ2xvc2VSZXN1bHRMaXN0CiAgICAgICAg\naW1wbGVtZW50cyBSZXN1bHRMaXN0IHsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBSZXN1bHRMaXN0IF9yZXM7CgogICAgICAgIHB1YmxpYyBSZW1vdmVPbkNs\nb3NlUmVzdWx0TGlzdChSZXN1bHRMaXN0IHJlcykgewogICAgICAgICAgICBf\ncmVzID0gcmVzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJlc3VsdExp\nc3QgZ2V0RGVsZWdhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNQcm92aWRlck9w\nZW4oKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmlzUHJvdmlkZXJPcGVu\nKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBPYmplY3Qg\nZ2V0VXNlck9iamVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuZ2V0\nVXNlck9iamVjdCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwdWJs\naWMgdm9pZCBzZXRVc2VyT2JqZWN0KE9iamVjdCBvcGFxdWUpIHsKICAgICAg\nICAgICAgX3Jlcy5zZXRVc2VyT2JqZWN0KG9wYXF1ZSk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIF9yZXMuaXNDbG9zZWQoKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgICAgICBjbG9zZSh0cnVl\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKGJvb2xl\nYW4gcmVtb3ZlKSB7CiAgICAgICAgICAgIGlmIChpc0Nsb3NlZCgpKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgX3Jlcy5jbG9zZSgp\nOwogICAgICAgICAgICBpZiAoIXJlbW92ZSkKICAgICAgICAgICAgICAgIHJl\ndHVybjsKCiAgICAgICAgICAgIGxvY2soKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIC8vIGRvbid0IHVzZSBzdGFuZGFyZCBfcmVzdWx0\nTGlzdHMucmVtb3ZlIG1ldGhvZCBiL2MgcmVsaWVzIG9uCiAgICAgICAgICAg\nICAgICAvLyBjb2xsZWN0aW9uIGVxdWFsaXR5LCB3aGljaCByZWxpZXMgb24g\nZWxlbWVudCBlcXVhbGl0eSwgd2hpY2gKICAgICAgICAgICAgICAgIC8vIG1l\nYW5zIHdlIGVuZCB1cCB0cmF2ZXJzaW5nIGVudGlyZSByZXN1bHQgbGlzdHMh\nCiAgICAgICAgICAgICAgICBmb3IgKEl0ZXJhdG9yIGl0ciA9IF9yZXN1bHRM\naXN0cy5pdGVyYXRvcigpOyBpdHIuaGFzTmV4dCgpOykgewogICAgICAgICAg\nICAgICAgICAgIGlmIChpdHIubmV4dCgpID09IHRoaXMpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaXRyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGludCBzaXplKCkgewogICAgICAgICAgICByZXR1cm4gX3Jl\ncy5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5pc0VtcHR5KCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjb250YWlucyhP\nYmplY3QgbykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5jb250YWlucyhv\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBJdGVyYXRvciBpdGVyYXRv\ncigpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuaXRlcmF0b3IoKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3RbXSB0b0FycmF5KCkgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy50b0FycmF5KCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgT2JqZWN0W10gdG9BcnJheShPYmplY3RbXSBhKSB7\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLnRvQXJyYXkoYSk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhZGQoT2JqZWN0IG8pIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMuYWRkKG8pOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gcmVtb3ZlKE9iamVjdCBvKSB7CiAgICAgICAg\nICAgIHJldHVybiBfcmVzLnJlbW92ZShvKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zQWxsKENvbGxlY3Rpb24gYykgewog\nICAgICAgICAgICByZXR1cm4gX3Jlcy5jb250YWluc0FsbChjKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGFkZEFsbChDb2xsZWN0aW9u\nIGMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZXMuYWRkQWxsKGMpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gYWRkQWxsKGludCBpZHgs\nIENvbGxlY3Rpb24gYykgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5hZGRB\nbGwoaWR4LCBjKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIHJlbW92ZUFsbChDb2xsZWN0aW9uIGMpIHsKICAgICAgICAgICAgcmV0dXJu\nIF9yZXMucmVtb3ZlQWxsKGMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gcmV0YWluQWxsKENvbGxlY3Rpb24gYykgewogICAgICAgICAg\nICByZXR1cm4gX3Jlcy5yZXRhaW5BbGwoYyk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBjbGVhcigpIHsKICAgICAgICAgICAgX3Jlcy5jbGVh\ncigpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE9iamVjdCBnZXQoaW50\nIGlkeCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5nZXQoaWR4KTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBPYmplY3Qgc2V0KGludCBpZHgsIE9i\namVjdCBvKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnNldChpZHgsIG8p\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgYWRkKGludCBpZHgs\nIE9iamVjdCBvKSB7CiAgICAgICAgICAgIF9yZXMuYWRkKGlkeCwgbyk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgT2JqZWN0IHJlbW92ZShpbnQgaWR4\nKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLnJlbW92ZShpZHgpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBpbmRleE9mKE9iamVjdCBvKSB7\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLmluZGV4T2Yobyk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgaW50IGxhc3RJbmRleE9mKE9iamVjdCBvKSB7\nCiAgICAgICAgICAgIHJldHVybiBfcmVzLmxhc3RJbmRleE9mKG8pOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIExpc3RJdGVyYXRvciBsaXN0SXRlcmF0\nb3IoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVzLmxpc3RJdGVyYXRvcigp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIExpc3RJdGVyYXRvciBsaXN0\nSXRlcmF0b3IoaW50IGlkeCkgewogICAgICAgICAgICByZXR1cm4gX3Jlcy5s\naXN0SXRlcmF0b3IoaWR4KTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBM\naXN0IHN1Ykxpc3QoaW50IHN0YXJ0LCBpbnQgZW5kKSB7CiAgICAgICAgICAg\nIHJldHVybiBfcmVzLnN1Ykxpc3Qoc3RhcnQsIGVuZCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAg\nICAgICAgICAgcmV0dXJuIF9yZXMuZXF1YWxzKG8pOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIF9yZXMuaGFzaENvZGUoKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBTdHJpbmcgdG9TdHJpbmcgKCkKCQl7CgkJCXJldHVybiBfcmVzLnRvU3Ry\naW5nICgpOwoJCX0KCgkJcHVibGljIE9iamVjdCB3cml0ZVJlcGxhY2UgKCkK\nCQl7CgkJCXJldHVybiBfcmVzOwoJCX0KCX0KfQo=\n","encoding":"base64"}

