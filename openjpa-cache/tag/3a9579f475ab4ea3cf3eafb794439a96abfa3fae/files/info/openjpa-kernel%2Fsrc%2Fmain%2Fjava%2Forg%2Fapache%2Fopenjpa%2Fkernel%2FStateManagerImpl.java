{"sha":"bb2869075f5d9255558cf420dd86d1da4f8aee02","node_id":"MDQ6QmxvYjIwNjM2NDpiYjI4NjkwNzVmNWQ5MjU1NTU4Y2Y0MjBkZDg2ZDFkYTRmOGFlZTAy","size":115017,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/bb2869075f5d9255558cf420dd86d1da4f8aee02","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk5vdFNlcmlhbGl6\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJl\nYW07CmltcG9ydCBqYXZhLmlvLk9iamVjdE91dHB1dDsKaW1wb3J0IGphdmEu\naW8uT2JqZWN0T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5TZXJpYWxp\nemFibGU7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5Nb2RpZmllcjsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkJpdFNldDsKaW1wb3J0IGphdmEudXRp\nbC5DYWxlbmRhcjsKaW1wb3J0IGphdmEudXRpbC5Db21wYXJhdG9yOwppbXBv\ncnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsK\naW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5M\naXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5U\naW1lWm9uZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmxvY2tzLlJl\nZW50cmFudExvY2s7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmcu\nU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuY29uZi5P\ncGVuSlBBQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3Blbmpw\nYS5lbmhhbmNlLkR5bmFtaWNQZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5GaWVsZE1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5NYW5hZ2VkSW5zdGFuY2VQ\ncm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5lbmhhbmNlLlBD\nUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEuZW5oYW5jZS5Q\nZXJzaXN0ZW5jZUNhcGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEu\nZW5oYW5jZS5SZWRlZmluaXRpb25IZWxwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEuZW5oYW5jZS5TdGF0ZU1hbmFnZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLm9wZW5qcGEuZXZlbnQuTGlmZWN5Y2xlRXZlbnRNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLmxpYi51dGlsLkxvY2FsaXplcjsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkFjY2Vzc0NvZGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuRmV0Y2hHcm91cDsKaW1w\nb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLkZpZWxkTWV0YURhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5KYXZhVHlwZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEubWV0YS5VcGRhdGVTdHJhdGVnaWVzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLm1ldGEuVmFsdWVNZXRhRGF0YTsK\naW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5tZXRhLlZhbHVlU3RyYXRlZ2ll\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkFwcGxpY2F0aW9u\nSWRzOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVuanBhLnV0aWwuRXhjZXB0aW9u\nczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkltcGxIZWxwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5JbnRlcm5hbEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGlsLkludmFsaWRT\ndGF0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS51dGls\nLk9iamVjdE5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLnV0aWwuT3BlbkpQQUlkOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuUHJveHlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuUnVudGltZUV4Y2VwdGlvblRyYW5zbGF0b3I7CmltcG9ydCBv\ncmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwoKLyoqCiAq\nIEltcGxlbWVudGF0aW9uIG9mIHRoZSB7QGxpbmsgT3BlbkpQQVN0YXRlTWFu\nYWdlcn0gaW50ZXJmYWNlIGZvciB1c2UKICogd2l0aCB0aGlzIHJ1bnRpbWUu\nIEVhY2ggc3RhdGUgbWFuYWdlciBtYW5hZ2VzIHRoZSBzdGF0ZSBvZiBhIHNp\nbmdsZQogKiBwZXJzaXN0ZW5jZSBjYXBhYmxlIGluc3RhbmNlLiBUaGUgc3Rh\ndGUgbWFuYWdlciBpcyBhbHNvIHJlc3BvbnNpYmxlIGZvcgogKiBhbGwgY29t\nbXVuaWNhdGlvbnMgYWJvdXQgdGhlIGluc3RhbmNlIHRvIHRoZSB7QGxpbmsg\nU3RvcmVNYW5hZ2VyfS4KICogIFRoZSBzdGF0ZSBtYW5hZ2VyIHVzZXMgdGhl\nIFN0YXRlIHBhdHRlcm4gaW4gYm90aCBpdHMgaW50ZXJhY3Rpb24gd2l0aAog\nKiB0aGUgZ292ZXJuZWQgaW5zdGFuY2UgYW5kIGl0cyBpbnRlcmFjdGlvbiB3\naXRoIHRoZSBicm9rZXIuCiAqIEluIGl0cyBpbnRlcmFjdGlvbnMgd2l0aCB0\naGUgcGVyc2lzdGVuY2UgY2FwYWJsZSBpbnN0YW5jZSwgaXQgdXNlcyB0aGUK\nICoge0BsaW5rIEZpZWxkTWFuYWdlcn0gaW50ZXJmYWNlLiBTaW1pbGFybHks\nIHdoZW4gaW50ZXJhY3Rpbmcgd2l0aCB0aGUKICogYnJva2VyLCBpdCB1c2Vz\nIHRoZSB7QGxpbmsgUENTdGF0ZX0gc2luZ2xldG9uIHRoYXQgcmVwcmVzZW50\ncwogKiB0aGUgY3VycmVudCBsaWZlY3ljbGUgc3RhdGUgb2YgdGhlIGluc3Rh\nbmNlLgogKgogKiBAYXV0aG9yIEFiZSBXaGl0ZQogKi8KcHVibGljIGNsYXNz\nIFN0YXRlTWFuYWdlckltcGwKICAgIGltcGxlbWVudHMgT3BlbkpQQVN0YXRl\nTWFuYWdlciwgU2VyaWFsaXphYmxlIHsKCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBMT0FEX0ZHUyA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBMT0FEX0FMTCA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu\ndCBMT0FEX1NFUklBTElaRSA9IDI7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgaW50IEZMQUdfU0FWRSA9IDIgPDwgMDsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBGTEFHX0RFUkVGID0gMiA8PCAxOwogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgaW50IEZMQUdfTE9BREVEID0gMiA8PCAyOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUkVBRF9MT0NLRUQgPSAyIDw8\nIDM7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19XUklURV9M\nT0NLRUQgPSAyIDw8IDQ7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQg\nRkxBR19PSURfQVNTSUdORUQgPSAyIDw8IDU7CiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBpbnQgRkxBR19MT0FESU5HID0gMiA8PCA2OwogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfUFJFX0RFTEVUSU5HID0gMiA8PCA3\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZMQUdfRkxVU0hFRCA9\nIDIgPDwgODsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX1BS\nRV9GTFVTSEVEID0gMiA8PCA5OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfRkxVU0hFRF9ESVJUWSA9IDIgPDwgMTA7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19JTVBMX0NBQ0hFID0gMiA8PCAxMTsK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX0lOVkVSU0VTID0g\nMiA8PCAxMjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBGTEFHX05P\nX1VOUFJPWFkgPSAyIDw8IDEzOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\naW50IEZMQUdfVkVSU0lPTl9DSEVDSyA9IDIgPDwgMTQ7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19WRVJTSU9OX1VQREFURSA9IDIgPDwg\nMTU7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgRkxBR19ERVRBQ0hJ\nTkcgPSAyIDw8IDE2OwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEZM\nQUdfRU1CRURfREVSRUYgPSAyIDw8IDE3OwoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvY2FsaXplciBfbG9jID0gTG9jYWxpemVyLmZvclBhY2thZ2UK\nICAgICAgICAoU3RhdGVNYW5hZ2VySW1wbC5jbGFzcyk7CgogICAgLy8gaW5m\nb3JtYXRpb24gYWJvdXQgdGhlIGluc3RhbmNlCiAgICBwcml2YXRlIHRyYW5z\naWVudCBQZXJzaXN0ZW5jZUNhcGFibGUgX3BjID0gbnVsbDsKICAgIHByaXZh\ndGUgdHJhbnNpZW50IENsYXNzTWV0YURhdGEgX21ldGEgPSBudWxsOwogICAg\ncHJpdmF0ZSBCaXRTZXQgX2xvYWRlZCA9IG51bGw7CiAgICBwcml2YXRlIEJp\ndFNldCBfZGlydHkgPSBudWxsOwogICAgcHJpdmF0ZSBCaXRTZXQgX2ZsdXNo\nID0gbnVsbDsKICAgIHByaXZhdGUgaW50IF9mbGFncyA9IDA7CgogICAgLy8g\naWQgaXMgdGhlIHN0YXRlIG1hbmFnZXIgaWRlbnRpdHk7IG9pZCBpcyB0aGUg\ncGVyc2lzdGVudCBpZGVudGl0eS4gIG9pZAogICAgLy8gbWF5IGJlIG51bGwg\nZm9yIGVtYmVkZGVkIGFuZCB0cmFuc2llbnQtdHJhbnNhY3Rpb25hbCBvYmpl\nY3RzIG9yIG5ldwogICAgLy8gaW5zdGFuY2VzIHRoYXQgaGF2ZW4ndCBiZWVu\nIGFzc2lnbmVkIGFuIG9pZC4gIGlkIGlzIHJlYXNzaWduZWQgdG8gb2lkCiAg\nICAvLyBvbiBzdWNjZXNzZnVsIG9pZCBhc3NpZ25tZW50IChvciBmbHVzaCBj\nb21wbGV0aW9uIGlmIGFzc2lnbm1lbnQgaXMKICAgIC8vIGR1cmluZyBmbHVz\naCkKICAgIHByaXZhdGUgT2JqZWN0IF9pZCA9IG51bGw7CiAgICBwcml2YXRl\nIE9iamVjdCBfb2lkID0gbnVsbDsKCiAgICAvLyB0aGUgbWFuYWdpbmcgcGVy\nc2lzdGVuY2UgbWFuYWdlciBhbmQgbGlmZWN5Y2xlIHN0YXRlCiAgICBwcml2\nYXRlIHRyYW5zaWVudCBCcm9rZXJJbXBsIF9icm9rZXI7IC8vIHRoaXMgaXMg\nc2VyaWFsaXplZCBzcGVjaWFsbHkKICAgIHByaXZhdGUgUENTdGF0ZSBfc3Rh\ndGUgPSBQQ1N0YXRlLlRSQU5TSUVOVDsKCiAgICAvLyB0aGUgY3VycmVudCBh\nbmQgbGFzdCBsb2FkZWQgdmVyc2lvbiBpbmRpY2F0b3JzLCBhbmQgdGhlIGxv\nY2sgb2JqZWN0CiAgICBwcml2YXRlIE9iamVjdCBfdmVyc2lvbiA9IG51bGw7\nCiAgICBwcml2YXRlIE9iamVjdCBfbG9hZFZlcnNpb24gPSBudWxsOwogICAg\ncHJpdmF0ZSBPYmplY3QgX2xvY2sgPSBudWxsOwogICAgcHJpdmF0ZSBpbnQg\nX3JlYWRMb2NrTGV2ZWwgPSAtMTsKICAgIHByaXZhdGUgaW50IF93cml0ZUxv\nY2tMZXZlbCA9IC0xOwoKICAgIC8vIGRlbGVnYXRlcyB3aGVuIHByb3ZpZGlu\nZy9yZXBsYWNpbmcgaW5zdGFuY2UgZGF0YQogICAgcHJpdmF0ZSBTaW5nbGVG\naWVsZE1hbmFnZXIgX3NpbmdsZSA9IG51bGw7CiAgICBwcml2YXRlIFNhdmVG\naWVsZE1hbmFnZXIgX3NhdmVkID0gbnVsbDsKICAgIHByaXZhdGUgRmllbGRN\nYW5hZ2VyIF9mbSA9IG51bGw7CgogICAgLy8gaW1wbGRhdGE7IGZpZWxkIGlt\ncGxkYXRhIGFuZCBpbnRlcm1lZGlhdGUgZGF0YSBzaGFyZSB0aGUgc2FtZSBh\ncnJheQogICAgcHJpdmF0ZSBPYmplY3QgX2ltcGwgPSBudWxsOwogICAgcHJp\ndmF0ZSBPYmplY3RbXSBfZmllbGRJbXBsID0gbnVsbDsKCiAgICAvLyBpbmZv\ncm1hdGlvbiBhYm91dCB0aGUgb3duZXIgb2YgdGhpcyBpbnN0YW5jZSwgaWYg\naXQgaXMgZW1iZWRkZWQKICAgIHByaXZhdGUgU3RhdGVNYW5hZ2VySW1wbCBf\nb3duZXIgPSBudWxsOwogICAgLy8gZm9yIGVtYmVkZGFibGUgb2JqZWN0IGZy\nb20gcXVlcnkgcmVzdWx0CiAgICBwcml2YXRlIE9iamVjdCBfb3duZXJJZCA9\nIG51bGw7CiAgICBwcml2YXRlIGludCBfb3duZXJJbmRleCA9IC0xOwogICAg\ncHJpdmF0ZSBMaXN0PEZpZWxkTWV0YURhdGE+IF9tYXBwZWRCeUlkRmllbGRz\nID0gbnVsbDsKICAgIAogICAgcHJpdmF0ZSB0cmFuc2llbnQgUmVlbnRyYW50\nTG9jayBfaW5zdGFuY2VMb2NrID0gbnVsbDsKCiAgICAvKioKICAgICAqIENv\nbnN0cnVjdG9yOyBzdXBwbHkgaWQsIHR5cGUgbWV0YWRhdGEsIGFuZCBvd25p\nbmcgcGVyc2lzdGVuY2UgbWFuYWdlci4KICAgICAqLwogICAgcHJvdGVjdGVk\nIFN0YXRlTWFuYWdlckltcGwoT2JqZWN0IGlkLCBDbGFzc01ldGFEYXRhIG1l\ndGEsIAogICAgICAgIEJyb2tlckltcGwgYnJva2VyKSB7CiAgICAgICAgX2lk\nID0gaWQ7CiAgICAgICAgX21ldGEgPSBtZXRhOwogICAgICAgIF9icm9rZXIg\nPSBicm9rZXI7CiAgICAgICAgX3NpbmdsZSA9IG5ldyBTaW5nbGVGaWVsZE1h\nbmFnZXIodGhpcywgYnJva2VyKTsKICAgICAgICBpZiAoYnJva2VyLmdldE11\nbHRpdGhyZWFkZWQoKSkKICAgICAgICAJX2luc3RhbmNlTG9jayA9IG5ldyBS\nZWVudHJhbnRMb2NrKCk7CgogICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0\neVR5cGUoKSA9PSBDbGFzc01ldGFEYXRhLklEX1VOS05PV04pCiAgICAgICAg\nICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJtZXRhLXVu\na25vd25pZCIsIF9tZXRhKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVh\ndGUgYSBuZXcgU3RhdGVNYW5hZ2VyIGluc3RhbmNlIGJhc2VkIG9uIHRoZSBT\ndGF0ZU1hbmFnZXIgcHJvdmlkZWQuIEEKICAgICAqIG5ldyBQZXJzaXN0ZW5j\nZUNhcGFibGUgaW5zdGFuY2Ugd2lsbCBiZSBjcmVhdGVkIGFuZCBhc3NvY2lh\ndGVkIHdpdGggdGhlCiAgICAgKiBuZXcgU3RhdGVNYW5hZ2VyLiBBbGwgZmll\nbGRzIHdpbGwgYmUgY29waWVkIGludG8gdGhlIG5lIFBDIGluc3RhbmNlIGFz\nCiAgICAgKiB3ZWxsIGFzIHRoZSBkaXJ0eSwgbG9hZGVkLCBhbmQgZmx1c2hl\nZCBiaXRzZXRzLgogICAgICogCiAgICAgKiBAcGFyYW0gc20gQSBzdGF0ZW1h\nbmFnZXIgaW5zdGFuY2Ugd2hpY2ggd2lsbCBlZmZlY3RpdmVseSBiZSBjbG9u\nZWQuCiAgICAgKi8KICAgIHB1YmxpYyBTdGF0ZU1hbmFnZXJJbXBsKFN0YXRl\nTWFuYWdlckltcGwgc20pIHsKICAgICAgICB0aGlzKHNtLCBzbS5nZXRQQ1N0\nYXRlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IFN0\nYXRlTWFuYWdlciBpbnN0YW5jZSwgb3B0aW9uYWxseSBvdmVycmlkaW5nIHRo\nZSBzdGF0ZQogICAgICogKEZMVVNIRUQsIERFTEVURUQsIGV0Yykgb2YgdGhl\nIHVuZGVybHlpbmcgUGVyc2lzdGVuY2VDYXBhYmxlIGluc3RhbmNlKS4KICAg\nICAqIAogICAgICogQHBhcmFtIHNtCiAgICAgKiAgICAgICAgICAgIEEgc3Rh\ndGVtYW5hZ2VyIGluc3RhbmNlIHdoaWNoIHdpbGwgZWZmZWN0aXZlbHkgYmUg\nY2xvbmVkLgogICAgICogQHBhcmFtIG5ld1N0YXRlCiAgICAgKiAgICAgICAg\nICAgIFRoZSBuZXcgc3RhdGUgb2YgdGhlIHVuZGVybHlpbmcgcGVyc2lzdGVu\nY2UgY2FwYWJsZSBvYmplY3QuCiAgICAgKi8KICAgIHB1YmxpYyBTdGF0ZU1h\nbmFnZXJJbXBsKFN0YXRlTWFuYWdlckltcGwgc20sIFBDU3RhdGUgbmV3U3Rh\ndGUpIHsgCiAgICAgICAgdGhpcyhzbS5nZXRJZCgpLCBzbS5nZXRNZXRhRGF0\nYSgpLCBzbS5nZXRCcm9rZXIoKSk7CgogICAgICAgIFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBvcmlnUEMgPSBzbS5nZXRQZXJzaXN0ZW5jZUNhcGFibGUoKTsKICAg\nICAgICBfcGMgPSBvcmlnUEMucGNOZXdJbnN0YW5jZShzbSwgZmFsc2UpOwog\nICAgICAgIAogICAgICAgIGludFtdIGZpZWxkcyA9IG5ldyBpbnRbc20uZ2V0\nTWV0YURhdGEoKS5nZXRGaWVsZHMoKS5sZW5ndGhdOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGZpZWxkc1tpXSA9IGk7CiAgICAgICAgfQogICAgICAgIF9wYy5wY0Nv\ncHlGaWVsZHMob3JpZ1BDLCBmaWVsZHMpOwogICAgICAgIF9wYy5wY1JlcGxh\nY2VTdGF0ZU1hbmFnZXIodGhpcyk7CiAgICAgICAgX3N0YXRlID0gbmV3U3Rh\ndGU7CgogICAgICAgIC8vIGNsb25lIHRoZSBmaWVsZCBiaXRzZXRzLiAKICAg\nICAgICBfZGlydHk9KEJpdFNldClzbS5nZXREaXJ0eSgpLmNsb25lKCk7CiAg\nICAgICAgX2xvYWRlZCA9IChCaXRTZXQpc20uZ2V0TG9hZGVkKCkuY2xvbmUo\nKTsKICAgICAgICBfZmx1c2ggPSAoQml0U2V0KSBzbS5nZXRGbHVzaGVkKCku\nY2xvbmUoKTsKICAgICAgICBfdmVyc2lvbiA9IHNtLmdldFZlcnNpb24oKTsK\nICAgICAgICAKICAgICAgICBfb2lkID0gc20uZ2V0T2JqZWN0SWQoKTsgCiAg\nICAgICAgX2lkID0gc20uZ2V0SWQoKTsKICAgICAgICAKICAgICAgICAvLyBt\nb3JlIGRhdGEgbWF5IG5lZWQgdG8gYmUgY29waWVkLiAKICAgIH0KCiAgICAv\nKioKICAgICAqIFNldCB0aGUgb3duaW5nIHN0YXRlIGFuZCBmaWVsZCBpZiB0\naGlzIGlzIGFuIGVtYmVkZGVkIGluc3RhbmNlLgogICAgICovCiAgICB2b2lk\nIHNldE93bmVyKFN0YXRlTWFuYWdlckltcGwgb3duZXIsIFZhbHVlTWV0YURh\ndGEgb3duZXJNZXRhKSB7CiAgICAgICAgX293bmVyID0gb3duZXI7CiAgICAg\nICAgX293bmVySW5kZXggPSBvd25lck1ldGEuZ2V0RmllbGRNZXRhRGF0YSgp\nLmdldEluZGV4KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRo\naXMgc3RhdGUgbWFuYWdlciBpcyBpbiB0aGUgbWlkZGxlIG9mIGEgbG9hZC4K\nICAgICAqLwogICAgYm9vbGVhbiBpc0xvYWRpbmcoKSB7CiAgICAgICAgcmV0\ndXJuIChfZmxhZ3MgJiBGTEFHX0xPQURJTkcpID4gMDsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgdGhpcyBzdGF0ZSBtYW5hZ2VyIGlzIGluIHRo\nZSBtaWRkbGUgb2YgYSBsb2FkIGluaXRpYXRlZAogICAgICogYnkgb3V0c2lk\nZSBjb2RlOyBmb3IgYW55IGludGVybmFsIG1ldGhvZHMgdGhhdCBjYXVzZSBs\nb2FkaW5nLCB0aGUKICAgICAqIGxvYWRpbmcgZmxhZyBpcyBzZXQgYXV0b21h\ndGljYWxseS4KICAgICAqLwogICAgdm9pZCBzZXRMb2FkaW5nKGJvb2xlYW4g\nbG9hZGluZykgewogICAgICAgIGlmIChsb2FkaW5nKQogICAgICAgICAgICBf\nZmxhZ3MgfD0gRkxBR19MT0FESU5HOwogICAgICAgIGVsc2UKICAgICAgICAg\nICAgX2ZsYWdzICY9IH5GTEFHX0xPQURJTkc7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTZXQgb3IgcmVzZXQgdGhlIGxpZmVjeWNsZSBzdGF0ZSBvZiB0aGUg\nbWFuYWdlZCBpbnN0YW5jZS4gSWYgdGhlCiAgICAgKiB0cmFuc2FjdGlvbmFs\nIHN0YXRlIG9mIHRoZSBpbnN0YW5jZSBjaGFuZ2VzLCBpdCB3aWxsIGJlIGVu\nbGlzdGVkLwogICAgICogZGVsaXN0ZWQgZnJvbSB0aGUgY3VycmVudCB0cmFu\nc2FjdGlvbiBhcyBuZWNlc3NhcnkuIFRoZSBnaXZlbgogICAgICogc3RhdGUg\nd2lsbCBiZSBpbml0aWFsaXplZCBhZnRlciBiZWluZyBzZXQuIElmIHRoZSBn\naXZlbiBzdGF0ZQogICAgICogaXMgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQg\nc3RhdGUsIHRoaXMgbWV0aG9kIHdpbGwgaGF2ZSBubyBlZmZlY3QuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBzZXRQQ1N0YXRlKFBDU3RhdGUgc3RhdGUp\nIHsKICAgICAgICBpZiAoX3N0YXRlID09IHN0YXRlKQogICAgICAgICAgICBy\nZXR1cm47CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBub3RpZnkgdGhlIHN0b3JlIG1hbmFnZXIgdGhhdCB3ZSdyZSBj\naGFuZ2luZyBzdGF0ZXM7IGNhbiB2ZXRvCiAgICAgICAgICAgIF9icm9rZXIu\nZ2V0U3RvcmVNYW5hZ2VyKCkuYmVmb3JlU3RhdGVDaGFuZ2UodGhpcywgX3N0\nYXRlLCBzdGF0ZSk7CgogICAgICAgICAgICAvLyByZXBsYWNlIHN0YXRlCiAg\nICAgICAgICAgIGJvb2xlYW4gd2FzRGVsZXRlZCA9IF9zdGF0ZS5pc0RlbGV0\nZWQoKTsKICAgICAgICAgICAgYm9vbGVhbiB3YXNEaXJ0eSA9IF9zdGF0ZS5p\nc0RpcnR5KCk7CiAgICAgICAgICAgIGJvb2xlYW4gd2FzUGVuZGluZyA9IF9z\ndGF0ZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFsKCk7CiAgICAgICAgICAgIF9z\ndGF0ZSA9IHN0YXRlOwoKICAgICAgICAgICAgLy8gZW5saXN0L2RlbGlzdCBm\ncm9tIHRyYW5zYWN0aW9uCiAgICAgICAgICAgIGlmIChfc3RhdGUuaXNUcmFu\nc2FjdGlvbmFsKCkpIHsKICAgICAgICAgICAgICAgIF9icm9rZXIuYWRkVG9U\ncmFuc2FjdGlvbih0aGlzKTsKICAgICAgICAgICAgICAgIGlmIChfc3RhdGUu\naXNEZWxldGVkKCkgIT0gd2FzRGVsZXRlZCkKICAgICAgICAgICAgICAgICAg\nICBfYnJva2VyLnNldERpcnR5KHRoaXMsICF3YXNEaXJ0eSB8fCBpc0ZsdXNo\nZWQoKSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChfc3RhdGUuaXNEaXJ0\neSgpICYmICF3YXNEaXJ0eSkKICAgICAgICAgICAgICAgICAgICBfYnJva2Vy\nLnNldERpcnR5KHRoaXMsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKCF3YXNQZW5kaW5nICYmIF9zdGF0ZS5pc1BlbmRpbmdUcmFuc2FjdGlvbmFs\nKCkpCiAgICAgICAgICAgICAgICBfYnJva2VyLmFkZFRvUGVuZGluZ1RyYW5z\nYWN0aW9uKHRoaXMpOwogICAgICAgICAgICBlbHNlIGlmICh3YXNQZW5kaW5n\nICYmICFfc3RhdGUuaXNQZW5kaW5nVHJhbnNhY3Rpb25hbCgpKQogICAgICAg\nICAgICAgICAgX2Jyb2tlci5yZW1vdmVGcm9tUGVuZGluZ1RyYW5zYWN0aW9u\nKHRoaXMpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBfYnJv\na2VyLnJlbW92ZUZyb21UcmFuc2FjdGlvbih0aGlzKTsKCiAgICAgICAgICAg\nIC8vIGluaXRpYWxpemUKICAgICAgICAgICAgX3N0YXRlLmluaXRpYWxpemUo\ndGhpcyk7CiAgICAgICAgICAgIGlmIChfc3RhdGUuaXNEZWxldGVkKCkgJiYg\nIXdhc0RlbGV0ZWQpCiAgICAgICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZl\nbnQoTGlmZWN5Y2xlRXZlbnQuQUZURVJfREVMRVRFKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9\nCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIE9wZW5KUEFTdGF0ZU1hbmFnZXIgaW1wbGVtZW50YXRpb24KICAg\nIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAg\ncHVibGljIHZvaWQgaW5pdGlhbGl6ZShDbGFzcyBjbHMsIFBDU3RhdGUgc3Rh\ndGUpIHsKICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgb3VyIGN1cnJlbnQg\nb2JqZWN0IGlkIGluc3RhbmNlIGlzIHRoZQogICAgICAgIC8vIGNvcnJlY3Qg\naWQgdHlwZSBmb3IgdGhlIHNwZWNpZmllZCBjbGFzczsgdGhpcyBpcyBmb3Ig\nY2FzZXMKICAgICAgICAvLyB3aGVuIHdlIGhhdmUgYW4gYXBwbGljYXRpb24g\naWQgaGllcmFyY2h5IGFuZCB3ZSBoYWQgc2V0IHRoZQogICAgICAgIC8vIG1l\ndGFkYXRhIHRvIGEgc3VwZXJjbGFzcyBpZCAtLSB0aGUgc3ViY2xhc3MnIGlk\nIG1heSBiZSBhCiAgICAgICAgLy8gZGlmZmVyZW50IGNsYXNzLCBzbyB3ZSBu\nZWVkIHRvIHJlc2V0IGl0CiAgICAgICAgaWYgKF9tZXRhLmdldERlc2NyaWJl\nZFR5cGUoKSAhPSBjbHMpIHsKICAgICAgICAgICAgQ2xhc3NNZXRhRGF0YSBz\ndWIgPSBfbWV0YS5nZXRSZXBvc2l0b3J5KCkuZ2V0TWV0YURhdGEKICAgICAg\nICAgICAgICAgIChjbHMsIF9icm9rZXIuZ2V0Q2xhc3NMb2FkZXIoKSwgdHJ1\nZSk7CiAgICAgICAgICAgIGlmIChfb2lkICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLklEX0RBVEFTVE9SRSkKICAgICAgICAgICAgICAgICAgICBfb2lk\nID0gX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5jb3B5RGF0YVN0b3JlSWQo\nX29pZCwKICAgICAgICAgICAgICAgICAgICAgICAgc3ViKTsKICAgICAgICAg\nICAgICAgIGVsc2UgaWYgKF9tZXRhLmlzT3BlbkpQQUlkZW50aXR5KCkpCiAg\nICAgICAgICAgICAgICAgICAgX29pZCA9IEFwcGxpY2F0aW9uSWRzLmNvcHko\nX29pZCwgc3ViKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN1Yi5nZXRP\nYmplY3RJZFR5cGUoKSAhPSBfbWV0YS5nZXRPYmplY3RJZFR5cGUoKSkgewog\nICAgICAgICAgICAgICAgICAgIE9iamVjdFtdIHBrRmllbGRzID0gQXBwbGlj\nYXRpb25JZHMudG9QS1ZhbHVlcyhfb2lkLCBfbWV0YSk7CiAgICAgICAgICAg\nICAgICAgICAgX29pZCA9IEFwcGxpY2F0aW9uSWRzLmZyb21QS1ZhbHVlcyhw\na0ZpZWxkcywgc3ViKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBfbWV0YSA9IHN1YjsKICAgICAgICB9CgogICAgICAg\nIFBlcnNpc3RlbmNlQ2FwYWJsZSBpbnN0ID0gUENSZWdpc3RyeS5uZXdJbnN0\nYW5jZShjbHMsIHRoaXMsIF9vaWQsIHRydWUpOwogICAgICAgIGlmIChpbnN0\nID09IG51bGwpIHsKICAgICAgICAgICAgLy8gdGhlIGluc3RhbmNlIHdhcyBu\ndWxsOiBjaGVjayB0byBzZWUgaWYgdGhlIGluc3RhbmNlIGlzCiAgICAgICAg\nICAgIC8vIGFic3RyYWN0IChhcyBjYW4gc29tZXRpbWVzIGJlIHRoZSBjYXNl\nIHdoZW4gdGhlCiAgICAgICAgICAgIC8vIGNsYXNzIGRpc2NyaW1pbmF0b3Ig\nc3RyYXRlZ3kgaXMgbm90IGNvbmZpZ3VyZWQgY29ycmVjdGx5KQogICAgICAg\nICAgICBpZiAoTW9kaWZpZXIuaXNBYnN0cmFjdChjbHMuZ2V0TW9kaWZpZXJz\nKCkpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImluc3RhbnRpYXRlLWFic3RyYWN0IiwKICAgICAgICAgICAg\nICAgICAgICBjbHMuZ2V0TmFtZSgpLCBfb2lkKSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBJbnRlcm5hbEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAg\nICAgaW5pdGlhbGl6ZShpbnN0LCBzdGF0ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBJbml0aWFsaXplIHdpdGggdGhlIGdpdmVuIGluc3RhbmNlIGFuZCBz\ndGF0ZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgaW5pdGlhbGl6ZShQ\nZXJzaXN0ZW5jZUNhcGFibGUgcGMsIFBDU3RhdGUgc3RhdGUpIHsKICAgICAg\nICBpZiAocGMgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJF\neGNlcHRpb24oX2xvYy5nZXQoImluaXQtbnVsbC1wYyIsIF9tZXRhKSk7CiAg\nICAgICAgaWYgKHBjLnBjR2V0U3RhdGVNYW5hZ2VyKCkgIT0gbnVsbCAmJiBw\nYy5wY0dldFN0YXRlTWFuYWdlcigpICE9IHRoaXMpCiAgICAgICAgICAgIHRo\ncm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJpbml0LXNtLXBjIiwK\nICAgICAgICAgICAgICAgIEV4Y2VwdGlvbnMudG9TdHJpbmcocGMpKSkuc2V0\nRmFpbGVkT2JqZWN0KHBjKTsKICAgICAgICBwYy5wY1JlcGxhY2VTdGF0ZU1h\nbmFnZXIodGhpcyk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0g\nX21ldGEuZ2V0RmllbGRzKCk7CiAgICAgICAgX2xvYWRlZCA9IG5ldyBCaXRT\nZXQoZm1kcy5sZW5ndGgpOwogICAgICAgIF9mbHVzaCA9IG5ldyBCaXRTZXQo\nZm1kcy5sZW5ndGgpOwogICAgICAgIF9kaXJ0eSA9IG5ldyBCaXRTZXQoZm1k\ncy5sZW5ndGgpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMu\nbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgLy8gbWFyayBwcmltYXJ5IGtl\neSBhbmQgbm9uLXBlcnNpc3RlbnQgZmllbGRzIGFzIGxvYWRlZAogICAgICAg\nICAgICBpZiAoZm1kc1tpXS5pc1ByaW1hcnlLZXkoKQogICAgICAgICAgICAg\nICAgfHwgZm1kc1tpXS5nZXRNYW5hZ2VtZW50KCkgIT0gZm1kc1tpXS5NQU5B\nR0VfUEVSU0lTVEVOVCkKICAgICAgICAgICAgICAgIF9sb2FkZWQuc2V0KGkp\nOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKF9tZXRhLmdldElkZW50\naXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfQVBQTElDQVRJT04pIHsK\nICAgICAgICAgICAgICAgIFN0cmluZyBtYXBwZWRCeUlkVmFsdWUgPSBmbWRz\nW2ldLmdldE1hcHBlZEJ5SWRWYWx1ZSgpOyAKICAgICAgICAgICAgICAgIGlm\nIChtYXBwZWRCeUlkVmFsdWUgIT0gbnVsbCkgeyAKICAgICAgICAgICAgICAg\nICAgICBpZiAoIUFwcGxpY2F0aW9uSWRzLmlzSWRTZXQoX2lkLCBfbWV0YSwg\nbWFwcGVkQnlJZFZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoX21hcHBlZEJ5SWRGaWVsZHMgPT0gbnVsbCkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIF9tYXBwZWRCeUlkRmllbGRzID0gbmV3IEFycmF5TGlz\ndDxGaWVsZE1ldGFEYXRhPigpOwogICAgICAgICAgICAgICAgICAgICAgICBf\nbWFwcGVkQnlJZEZpZWxkcy5hZGQoZm1kc1tpXSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIC8vIHJlY29yZCB3aGV0aGVyIHRoZXJlIGFyZSBhbnkgbWFuYWdl\nZCBpbnZlcnNlIGZpZWxkcwogICAgICAgICAgICBpZiAoX2Jyb2tlci5nZXRJ\nbnZlcnNlTWFuYWdlcigpICE9IG51bGwKICAgICAgICAgICAgICAgICYmIGZt\nZHNbaV0uZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0aCA+IDApCiAgICAg\nICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19JTlZFUlNFUzsKICAgICAgICB9\nCgogICAgICAgIHBjLnBjU2V0RGV0YWNoZWRTdGF0ZShudWxsKTsKICAgICAg\nICBfcGMgPSBwYzsKCiAgICAgICAgaWYgKF9vaWQgaW5zdGFuY2VvZiBPcGVu\nSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQQUlkKSBfb2lkKS5zZXRNYW5h\nZ2VkSW5zdGFuY2VUeXBlKF9tZXRhLmdldERlc2NyaWJlZFR5cGUoKSk7Cgog\nICAgICAgIC8vIGluaXRpYWxpemUgb3VyIHN0YXRlIGFuZCBhZGQgb3Vyc2Vs\ndmVzIHRvIHRoZSBicm9rZXIncyBjYWNoZQogICAgICAgIHNldFBDU3RhdGUo\nc3RhdGUpOwogICAgICAgIGlmICggX29pZCA9PSBudWxsIHx8ICAKICAgICAg\nICAgICAgX2Jyb2tlci5nZXRTdGF0ZU1hbmFnZXJJbXBsQnlJZChfb2lkLCBm\nYWxzZSkgPT0gbnVsbCkgewogICAgICAgIAlfYnJva2VyLnNldFN0YXRlTWFu\nYWdlcihfaWQsIHRoaXMsIEJyb2tlckltcGwuU1RBVFVTX0lOSVQpOwogICAg\nICAgIH0KICAgICAgICBpZiAoc3RhdGUgPT0gUENTdGF0ZS5QTkVXKQogICAg\nICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xlRXZlbnQuQUZU\nRVJfUEVSU0lTVCk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSBub24tdHJh\nY2tpbmcgUEMsIGFkZCBhIGhhcmQgcmVmIHRvIHRoZSBhcHByb3ByaWF0ZSBk\nYXRhCiAgICAgICAgLy8gc2V0cyBhbmQgZ2l2ZSBpdCBhbiBvcHBvcnR1bml0\neSB0byBtYWtlIGEgc3RhdGUgc25hcHNob3QuCiAgICAgICAgaWYgKCFpc0lu\ndGVyY2VwdGluZygpKSB7CiAgICAgICAgICAgIHNhdmVGaWVsZHModHJ1ZSk7\nCiAgICAgICAgICAgIGlmICghaXNOZXcoKSkKICAgICAgICAgICAgICAgIFJl\nZGVmaW5pdGlvbkhlbHBlci5hc3NpZ25MYXp5TG9hZFByb3hpZXModGhpcyk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBvciBu\nb3QgZGF0YSBhY2Nlc3MgaW4gdGhpcyBpbnN0YW5jZSBpcyBpbnRlcmNlcHRl\nZC4gVGhpcyBkaWZmZXJzCiAgICAgKiBmcm9tIHtAbGluayBDbGFzc01ldGFE\nYXRhI2lzSW50ZXJjZXB0aW5nKCl9IGluIHRoYXQgaXQgY2hlY2tzIGZvcgog\nICAgICogcHJvcGVydHkgYWNjZXNzICsgc3ViY2xhc3NpbmcgaW4gYWRkaXRp\nb24gdG8gdGhlIHJlZGVmaW5pdGlvbiAvCiAgICAgKiBlbmhhbmNlbWVudCBj\naGVja3MuCiAgICAgKgogICAgICogQHNpbmNlIDEuMC4wCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzSW50ZXJjZXB0aW5nKCkgewogICAgICAgIGlm\nIChnZXRNZXRhRGF0YSgpLmlzSW50ZXJjZXB0aW5nKCkpCiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIC8vIFRPRE86SlJCIEludGVyY2VwdGlu\nZyAKICAgICAgICBpZiAoQWNjZXNzQ29kZS5pc1Byb3BlcnR5KGdldE1ldGFE\nYXRhKCkuZ2V0QWNjZXNzVHlwZSgpKQogICAgICAgICAgICAmJiBfcGMgaW5z\ndGFuY2VvZiBEeW5hbWljUGVyc2lzdGVuY2VDYXBhYmxlKQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBGaXJlIHRoZSBnaXZlbiBsaWZlY3ljbGUgZXZlbnQg\ndG8gYWxsIGxpc3RlbmVycy4KICAgICAqLwogICAgcHJpdmF0ZSBib29sZWFu\nIGZpcmVMaWZlY3ljbGVFdmVudChpbnQgdHlwZSkgewogICAgICAgIGlmICh0\neXBlID09IExpZmVjeWNsZUV2ZW50LkFGVEVSX1BFUlNJU1QKICAgICAgICAg\nICAgICAgICYmIF9icm9rZXIuZ2V0Q29uZmlndXJhdGlvbigpLmdldENhbGxi\nYWNrT3B0aW9uc0luc3RhbmNlKCkuZ2V0UG9zdFBlcnNpc3RDYWxsYmFja0lt\nbWVkaWF0ZSgpKSB7CiAgICAgICAgICAgIGZldGNoT2JqZWN0SWQoKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2\nZW50KGdldE1hbmFnZWRJbnN0YW5jZSgpLCBudWxsLCBfbWV0YSwgdHlwZSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgbG9hZChGZXRjaENvbmZpZ3VyYXRp\nb24gZmV0Y2gpIHsKICAgICAgICBsb2FkKGZldGNoLCBMT0FEX0ZHUywgbnVs\nbCwgbnVsbCwgZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0\naGUgc3RhdGUgb2YgdGhpcyBpbnN0YW5jZSBiYXNlZCBvbiB0aGUgZ2l2ZW4g\nZmV0Y2ggY29uZmlndXJhdGlvbgogICAgICogYW5kIGxvYWQgbW9kZS4gUmV0\ndXJuIHRydWUgaWYgYW55IGRhdGEgd2FzIGxvYWRlZCwgZmFsc2Ugb3RoZXJ3\naXNlLgogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBsb2FkKEZldGNo\nQ29uZmlndXJhdGlvbiBmZXRjaCwgaW50IGxvYWRNb2RlLAogICAgICAgIEJp\ndFNldCBleGNsdWRlLCBPYmplY3Qgc2RhdGEsIGJvb2xlYW4gZm9yV3JpdGUp\nIHsKICAgICAgICBpZiAoIWZvcldyaXRlCiAgICAgICAgICAgICYmICghaXNQ\nZXJzaXN0ZW50KCkgfHwgKGlzTmV3KCkgJiYgIWlzRmx1c2hlZCgpKSB8fCBp\nc0RlbGV0ZWQoKSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAg\nICAgLy8gaWYgYW55IGZpZWxkcyBiZWluZyBsb2FkZWQsIGRvIHN0YXRlIHRy\nYW5zaXRpb25zIGZvciByZWFkCiAgICAgICAgQml0U2V0IGZpZWxkcyA9IGdl\ndFVubG9hZGVkSW50ZXJuYWwoZmV0Y2gsIGxvYWRNb2RlLCBleGNsdWRlKTsK\nICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9rZXIuaXNBY3RpdmUoKTsK\nICAgICAgICBpZiAoIWZvcldyaXRlICYmIGZpZWxkcyAhPSBudWxsKQogICAg\nICAgICAgICBiZWZvcmVSZWFkKC0xKTsKCiAgICAgICAgLy8gY2FsbCBsb2Fk\nIGV2ZW4gaWYgbm8gZmllbGRzIGFyZSBiZWluZyBsb2FkZWQsIGJlY2F1c2Ug\naXQgdGFrZXMKICAgICAgICAvLyBjYXJlIG9mIGNoZWNraW5nIGlmIHRoZSBE\nRkcgaXMgbG9hZGVkLCBtYWtpbmcgc3VyZSB2ZXJzaW9uIGluZm8KICAgICAg\nICAvLyBpcyBsb2FkZWQsIGV0YwogICAgICAgIGludCBsb2NrTGV2ZWwgPSBj\nYWxjdWxhdGVMb2NrTGV2ZWwoYWN0aXZlLCBmb3JXcml0ZSwgZmV0Y2gpOwog\nICAgICAgIGJvb2xlYW4gcmV0ID0gbG9hZEZpZWxkcyhmaWVsZHMsIGZldGNo\nLCBsb2NrTGV2ZWwsIHNkYXRhKTsKICAgICAgICBvYnRhaW5Mb2NrcyhhY3Rp\ndmUsIGZvcldyaXRlLCBsb2NrTGV2ZWwsIGZldGNoLCBzZGF0YSk7CiAgICAg\nICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICBwdWJsaWMgT2JqZWN0IGdldE1h\nbmFnZWRJbnN0YW5jZSgpIHsKICAgICAgICBpZiAoX3BjIGluc3RhbmNlb2Yg\nTWFuYWdlZEluc3RhbmNlUHJvdmlkZXIpCiAgICAgICAgICAgIHJldHVybiAo\nKE1hbmFnZWRJbnN0YW5jZVByb3ZpZGVyKSBfcGMpLmdldE1hbmFnZWRJbnN0\nYW5jZSgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIF9wYzsK\nICAgIH0KCiAgICBwdWJsaWMgUGVyc2lzdGVuY2VDYXBhYmxlIGdldFBlcnNp\nc3RlbmNlQ2FwYWJsZSgpIHsKICAgICAgICByZXR1cm4gX3BjOwogICAgfQoK\nICAgIHB1YmxpYyBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKCkgewogICAg\nICAgIHJldHVybiBfbWV0YTsKICAgIH0KCiAgICBwdWJsaWMgT3BlbkpQQVN0\nYXRlTWFuYWdlciBnZXRPd25lcigpIHsKICAgICAgICByZXR1cm4gX293bmVy\nOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0T3duZXJJbmRleCgpIHsKICAg\nICAgICByZXR1cm4gX293bmVySW5kZXg7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0T3duZXIoT2JqZWN0IG9pZCkgewogICAgICAgIF9vd25lcklkID0g\nb2lkOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRW1iZWRkZWQoKSB7\nCiAgICAgICAgLy8gX293bmVyIG1heSBub3QgYmUgc2V0IGlmIGVtYmVkIG9i\namVjdCBpcyBmcm9tIHF1ZXJ5IHJlc3VsdAogICAgICAgIHJldHVybiBfb3du\nZXIgIT0gbnVsbCB8fCBfc3RhdGUgaW5zdGFuY2VvZiBFTm9uVHJhbnNTdGF0\nZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ZsdXNoZWQoKSB7CiAg\nICAgICAgcmV0dXJuIChfZmxhZ3MgJiBGTEFHX0ZMVVNIRUQpID4gMDsKICAg\nIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0ZsdXNoZWREaXJ0eSgpIHsKICAg\nICAgICByZXR1cm4gKF9mbGFncyAmIEZMQUdfRkxVU0hFRF9ESVJUWSkgPiAw\nOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQgZ2V0TG9hZGVkKCkgewogICAg\nICAgIHJldHVybiBfbG9hZGVkOwogICAgfQoKICAgIHB1YmxpYyBCaXRTZXQg\nZ2V0Rmx1c2hlZCgpIHsKICAgICAgICByZXR1cm4gX2ZsdXNoOwogICAgfQoK\nICAgIHB1YmxpYyBCaXRTZXQgZ2V0RGlydHkoKSB7CiAgICAgICAgcmV0dXJu\nIF9kaXJ0eTsKICAgIH0KCiAgICBwdWJsaWMgQml0U2V0IGdldFVubG9hZGVk\nKEZldGNoQ29uZmlndXJhdGlvbiBmZXRjaCkgewogICAgICAgIC8vIGNvbGxl\nY3QgZmllbGRzIHRvIGxvYWQgZnJvbSBkYXRhIHN0b3JlIGJhc2VkIG9uIGZl\ndGNoIGNvbmZpZ3VyYXRpb24KICAgICAgICBCaXRTZXQgZmllbGRzID0gZ2V0\nVW5sb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9GR1MsIG51bGwpOwogICAg\nICAgIHJldHVybiAoZmllbGRzID09IG51bGwpID8gbmV3IEJpdFNldCgwKSA6\nIGZpZWxkczsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIHZlcnNp\nb24gb2Yge0BsaW5rIE9wZW5KUEFTdGF0ZU1hbmFnZXIjZ2V0VW5sb2FkZWR9\nIHRoYXQgYXZvaWRzCiAgICAgKiBjcmVhdGluZyBhbiBlbXB0eSBiaXQgc2V0\nIGJ5IHJldHVybmluZyBudWxsIHdoZW4gdGhlcmUgYXJlIG5vIHVubG9hZGVk\nCiAgICAgKiBmaWVsZHMuCiAgICAgKi8KICAgIHByaXZhdGUgQml0U2V0IGdl\ndFVubG9hZGVkSW50ZXJuYWwoRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoLCBp\nbnQgbW9kZSwKICAgICAgICBCaXRTZXQgZXhjbHVkZSkgewogICAgICAgIGlm\nIChleGNsdWRlID09IFN0b3JlQ29udGV4dC5FWENMVURFX0FMTCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIEJpdFNldCBmaWVsZHMgPSBu\ndWxsOwogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgYm9vbGVhbiBsb2FkOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewogICAgICAgICAg\nICBpZiAoX2xvYWRlZC5nZXQoaSkgfHwgKGV4Y2x1ZGUgIT0gbnVsbCAmJiBl\neGNsdWRlLmdldChpKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAg\nICAgICAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgICAgICAgICAgY2Fz\nZSBMT0FEX1NFUklBTElaRToKICAgICAgICAgICAgICAgICAgICBsb2FkID0g\nIWZtZHNbaV0uaXNUcmFuc2llbnQoKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGNhc2UgTE9BRF9GR1M6CiAgICAgICAg\nICAgICAgICAgICAgbG9hZCA9IGZldGNoID09IG51bGwgfHwgZmV0Y2gucmVx\ndWlyZXNGZXRjaChmbWRzW2ldKSAKICAgICAgICAgICAgICAgICAgICAgICAg\nIT0gRmV0Y2hDb25maWd1cmF0aW9uLkZFVENIX05PTkU7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiAvLyBM\nT0FEX0FMTAogICAgICAgICAgICAgICAgICAgIGxvYWQgPSB0cnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAobG9hZCkgewogICAgICAgICAg\nICAgICAgaWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAg\nIGZpZWxkcyA9IG5ldyBCaXRTZXQoZm1kcy5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgZmllbGRzLnNldChpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZmllbGRzOwogICAgfQoKICAgIHB1YmxpYyBTdG9y\nZUNvbnRleHQgZ2V0Q29udGV4dCgpIHsKICAgICAgICByZXR1cm4gX2Jyb2tl\ncjsKICAgIH0KCiAgICAvKioKICAgICAqIE1hbmFnaW5nIGJyb2tlci4KICAg\nICAqLwogICAgQnJva2VySW1wbCBnZXRCcm9rZXIoKSB7CiAgICAgICAgcmV0\ndXJuIF9icm9rZXI7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRJZCgp\nIHsKICAgICAgICByZXR1cm4gX2lkOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZ2V0T2JqZWN0SWQoKSB7CiAgICAgICAgU3RhdGVNYW5hZ2VySW1wbCBz\nbSA9IHRoaXM7CiAgICAgICAgd2hpbGUgKHNtLmdldE93bmVyKCkgIT0gbnVs\nbCkKICAgICAgICAgICAgc20gPSAoU3RhdGVNYW5hZ2VySW1wbCkgc20uZ2V0\nT3duZXIoKTsKICAgICAgICBpZiAoc20uaXNFbWJlZGRlZCgpICYmIHNtLmdl\ndE93bmVyKCkgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuIHNtLl9vd25l\ncklkOwogICAgICAgIHJldHVybiBzbS5fb2lkOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldE9iamVjdElkKE9iamVjdCBvaWQpIHsKICAgICAgICBfb2lk\nID0gb2lkOwogICAgICAgIGlmIChfcGMgIT0gbnVsbCAmJiBvaWQgaW5zdGFu\nY2VvZiBPcGVuSlBBSWQpCiAgICAgICAgICAgICgoT3BlbkpQQUlkKSBvaWQp\nLnNldE1hbmFnZWRJbnN0YW5jZVR5cGUoX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpKTsKICAgIH0KCiAgICBwdWJsaWMgU3RhdGVNYW5hZ2VySW1wbCBnZXRP\nYmplY3RJZE93bmVyKCkgewogICAgICAgIFN0YXRlTWFuYWdlckltcGwgc20g\nPSB0aGlzOwogICAgICAgIHdoaWxlIChzbS5nZXRPd25lcigpICE9IG51bGwp\nCiAgICAgICAgICAgIHNtID0gKFN0YXRlTWFuYWdlckltcGwpIHNtLmdldE93\nbmVyKCk7CiAgICAgICAgcmV0dXJuIHNtOwogICAgfQogICAgcHVibGljIGJv\nb2xlYW4gYXNzaWduT2JqZWN0SWQoYm9vbGVhbiBmbHVzaCkgewogICAgICAg\nIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gYXNz\naWduT2JqZWN0SWQoZmx1c2gsIGZhbHNlKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBc2sgc3RvcmUgbWFuYWdlciB0byBhc3NpZ24gb3VyIG9p\nZCwgb3B0aW9uYWxseSBmbHVzaGluZyBhbmQKICAgICAqIG9wdGlvbmFsbHkg\ncmVjYWNoaW5nIG9uIHRoZSBuZXcgb2lkLgogICAgICovCiAgICBib29sZWFu\nIGFzc2lnbk9iamVjdElkKGJvb2xlYW4gZmx1c2gsIGJvb2xlYW4gcHJlRmx1\nc2hpbmcpIHsKICAgICAgICBpZiAoX29pZCAhPSBudWxsIHx8IGlzRW1iZWRk\nZWQoKSB8fCAhaXNQZXJzaXN0ZW50KCkpCiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwoKICAgICAgICBpZiAoX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5h\nc3NpZ25PYmplY3RJZCh0aGlzLCBwcmVGbHVzaGluZykpIHsKICAgICAgICAg\nICAgaWYgKCFwcmVGbHVzaGluZykKICAgICAgICAgICAgICAgIGFzc2VydE9i\namVjdElkQXNzaWduZWQodHJ1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChmbHVz\naCkKICAgICAgICAgICAgX2Jyb2tlci5mbHVzaCgpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSBzdXJlIHdlIHdlcmUgYXNz\naWduZWQgYW4gb2lkLCBhbmQgcGVyZm9ybSBhY3Rpb25zIHRvIG1ha2UgaXQK\nICAgICAqIHBlcm1hbmVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gcmVjYWNo\nZSB3aGV0aGVyIHRvIHJlY2FjaGUgb3Vyc2VsZiBvbiB0aGUgbmV3IG9pZAog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYXNzZXJ0T2JqZWN0SWRBc3NpZ25l\nZChib29sZWFuIHJlY2FjaGUpIHsKICAgICAgICBpZiAoIWlzTmV3KCkgfHwg\naXNEZWxldGVkKCkgfHwgaXNQcm92aXNpb25hbCgpIAogICAgICAgICAgICB8\nfCAoX2ZsYWdzICYgRkxBR19PSURfQVNTSUdORUQpICE9IDApCiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICBpZiAoX29pZCA9PSBudWxsKSB7CiAgICAg\nICAgICAgIGlmIChfbWV0YS5nZXRJZGVudGl0eVR5cGUoKSA9PSBDbGFzc01l\ndGFEYXRhLklEX0RBVEFTVE9SRSkKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnRlcm5hbEV4Y2VwdGlvbihFeGNlcHRpb25zLnRvU3RyaW5nCiAgICAg\nICAgICAgICAgICAgICAgKGdldE1hbmFnZWRJbnN0YW5jZSgpKSk7CiAgICAg\nICAgICAgIF9vaWQgPSBBcHBsaWNhdGlvbklkcy5jcmVhdGUoX3BjLCBfbWV0\nYSk7CiAgICAgICAgfQoKICAgICAgICBPYmplY3Qgb3JpZyA9IF9pZDsKICAg\nICAgICBfaWQgPSBfb2lkOwogICAgICAgIGlmIChyZWNhY2hlKSB7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBfYnJva2VyLnNldFN0YXRl\nTWFuYWdlcihvcmlnLCB0aGlzLAogICAgICAgICAgICAgICAgICAgIEJyb2tl\nckltcGwuU1RBVFVTX09JRF9BU1NJR04pOwogICAgICAgICAgICB9IGNhdGNo\nIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgICAgICBfaWQg\nPSBvcmlnOwogICAgICAgICAgICAgICAgX29pZCA9IG51bGw7CiAgICAgICAg\nICAgICAgICB0aHJvdyByZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBfZmxhZ3MgfD0gRkxBR19PSURfQVNTSUdORUQ7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBc3NpZ24gdGhlIHByb3BlciBnZW5lcmF0ZWQgdmFsdWUg\ndG8gdGhlIGdpdmVuIGZpZWxkIGJhc2VkIG9uIGl0cwogICAgICogdmFsdWUt\nc3RyYXRlZ3kuCiAgICAgKi8KICAgIHByaXZhdGUgYm9vbGVhbiBhc3NpZ25G\naWVsZChpbnQgZmllbGQsIGJvb2xlYW4gcHJlRmx1c2hpbmcpIHsKICAgICAg\nICBPcGVuSlBBU3RhdGVNYW5hZ2VyIHNtID0gdGhpczsKICAgICAgICB3aGls\nZSAoc20gIT0gbnVsbCAmJiBzbS5pc0VtYmVkZGVkKCkpCiAgICAgICAgICAg\nIHNtID0gc20uZ2V0T3duZXIoKTsKICAgICAgICBpZiAoc20gPT0gbnVsbCkK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghc20uaXNO\nZXcoKSB8fCBzbS5pc0ZsdXNoZWQoKSB8fCBzbS5pc0RlbGV0ZWQoKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBzcGVjaWFsLWNh\nc2Ugb2lkIGZpZWxkcywgd2hpY2ggcmVxdWlyZSB1cyB0byBsb29rIGluc2lk\nZSB0aGUgb2lkCiAgICAgICAgLy8gb2JqZWN0CiAgICAgICAgRmllbGRNZXRh\nRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYg\nKGZtZC5nZXREZWNsYXJlZFR5cGVDb2RlKCkgPT0gSmF2YVR5cGVzLk9JRCkg\newogICAgICAgICAgICAvLyB0cnkgdG8gc2hvcnRjdXQgaWYgcG9zc2libGUK\nICAgICAgICAgICAgaWYgKF9vaWQgIT0gbnVsbCB8fCBpc0VtYmVkZGVkKCkg\nfHwgIWlzUGVyc2lzdGVudCgpKQogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CgogICAgICAgICAgICAvLyBjaGVjayBlbWJlZGRlZCBmaWVsZHMgb2Yg\nb2lkIGZvciB2YWx1ZSBzdHJhdGVneSArIGRlZmF1bHQgdmFsdWUKICAgICAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIHBrcyA9IGZtZC5nZXRFbWJlZGRlZE1l\ndGFEYXRhKCkuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIE9wZW5KUEFTdGF0\nZU1hbmFnZXIgb2lkc20gPSBudWxsOwogICAgICAgICAgICBib29sZWFuIGFz\nc2lnbiA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgIWFz\nc2lnbiAmJiBpIDwgcGtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBpZiAocGtzW2ldLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0\nZWdpZXMuTk9ORSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgICAgIGlmIChvaWRzbSA9PSBudWxsKQogICAgICAgICAgICAg\nICAgICAgIG9pZHNtID0gbmV3IE9iamVjdElkU3RhdGVNYW5hZ2VyKGZldGNo\nT2JqZWN0RmllbGQoZmllbGQpLAogICAgICAgICAgICAgICAgICAgICAgICB0\naGlzLCBmbWQpOwogICAgICAgICAgICAgICAgYXNzaWduID0gb2lkc20uaXNE\nZWZhdWx0VmFsdWUoaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIGFzc2lnbiAmJiBhc3NpZ25PYmplY3RJZCghcHJlRmx1c2hpbmcsIHBy\nZUZsdXNoaW5nKTsKICAgICAgICB9CgogICAgICAgIC8vIEp1c3QgcmV0dXJu\nIGlmIHRoZXJlJ3Mgbm8gdmFsdWUgZ2VuZXJhdGlvbiBzdHJhdGVneQogICAg\nICAgIGlmIChmbWQuZ2V0VmFsdWVTdHJhdGVneSgpID09IFZhbHVlU3RyYXRl\nZ2llcy5OT05FKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nCiAgICAgICAgLy8gVGhyb3cgZXhjZXB0aW9uIGlmIGZpZWxkIGFscmVhZHkg\naGFzIGEgdmFsdWUgYXNzaWduZWQuCiAgICAgICAgLy8gQEdlbmVyYXRlZFZh\nbHVlIG92ZXJyaWRlcyBQT0pPIGluaXRpYWwgdmFsdWVzIGFuZCBzZXR0ZXIg\nbWV0aG9kcwogICAgICAgIGlmICghZm1kLmlzVmFsdWVHZW5lcmF0ZWQoKSAm\nJiAhaXNEZWZhdWx0VmFsdWUoZmllbGQpKQogICAgICAgICAgICB0aHJvdyBu\nZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KAogICAgICAgICAg\nICAgICAgImV4aXN0aW5nLXZhbHVlLW92ZXJyaWRlLWV4Y2VwIiwgZm1kLmdl\ndEZ1bGxOYW1lKGZhbHNlKSkpOwoKICAgICAgICAvLyBmb3IgcHJpbWFyeSBr\nZXkgZmllbGRzLCBhc3NpZ24gdGhlIG9iamVjdCBpZCBhbmQgcmVjYWNoZSBz\nbyB0aGF0CiAgICAgICAgLy8gdG8gdGhlIHVzZXIsIHNvIGl0IGxvb2tzIGxp\na2UgdGhlIG9pZCBhbHdheXMgbWF0Y2hlcyB0aGUgcGsgZmllbGRzCiAgICAg\nICAgaWYgKGZtZC5pc1ByaW1hcnlLZXkoKSAmJiAhaXNFbWJlZGRlZCgpKQog\nICAgICAgICAgICByZXR1cm4gYXNzaWduT2JqZWN0SWQoIXByZUZsdXNoaW5n\nLCBwcmVGbHVzaGluZyk7CgogICAgICAgIC8vIGZvciBvdGhlciBmaWVsZHMg\nanVzdCBhc3NpZ24gdGhlIGZpZWxkIG9yIGZsdXNoIGlmIG5lZWRlZAogICAg\nICAgIGlmIChfYnJva2VyLmdldFN0b3JlTWFuYWdlcigpLmFzc2lnbkZpZWxk\nKHRoaXMsIGZpZWxkLCBwcmVGbHVzaGluZykpIHsKICAgICAgICAgICAgZm1k\nLnNldFZhbHVlR2VuZXJhdGVkKHRydWUpOwogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFwcmVGbHVzaGluZykKICAg\nICAgICAgICAgX2Jyb2tlci5mbHVzaCgpOwogICAgICAgIHJldHVybiAhcHJl\nRmx1c2hpbmc7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBnZXRMb2NrKCkg\newogICAgICAgIHJldHVybiBfbG9jazsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBzZXRMb2NrKE9iamVjdCBsb2NrKSB7CiAgICAgICAgX2xvY2sgPSBsb2Nr\nOwogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZ2V0VmVyc2lvbigpIHsKICAg\nICAgICByZXR1cm4gX3ZlcnNpb247CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2V0VmVyc2lvbihPYmplY3QgdmVyc2lvbikgewogICAgICAgIF9sb2FkVmVy\nc2lvbiA9IHZlcnNpb247CiAgICAgICAgYXNzaWduVmVyc2lvbkZpZWxkKHZl\ncnNpb24pOwogICAgfQoKICAgIE9iamVjdCBnZXRMb2FkVmVyc2lvbigpIHsK\nICAgICAgICByZXR1cm4gX2xvYWRWZXJzaW9uOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHNldE5leHRWZXJzaW9uKE9iamVjdCB2ZXJzaW9uKSB7CiAgICAg\nICAgYXNzaWduVmVyc2lvbkZpZWxkKHZlcnNpb24pOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBhc3NpZ25WZXJzaW9uRmllbGQoT2JqZWN0IHZlcnNpb24p\nIHsKICAgICAgICBfdmVyc2lvbiA9IHZlcnNpb247CiAgICAgICAgRmllbGRN\nZXRhRGF0YSB2ZmllbGQgPSBfbWV0YS5nZXRWZXJzaW9uRmllbGQoKTsKICAg\nICAgICBpZiAodmZpZWxkICE9IG51bGwpCiAgICAgICAgICAgIHN0b3JlKHZm\naWVsZC5nZXRJbmRleCgpLCBKYXZhVHlwZXMuY29udmVydCh2ZXJzaW9uLAog\nICAgICAgICAgICAgICAgdmZpZWxkLmdldFR5cGVDb2RlKCkpKTsKICAgIH0K\nCiAgICBwdWJsaWMgUENTdGF0ZSBnZXRQQ1N0YXRlKCkgewogICAgICAgIHJl\ndHVybiBfc3RhdGU7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBP\nYmplY3QgZ2V0SW1wbERhdGEoKSB7CiAgICAgICAgcmV0dXJuIF9pbXBsOwog\nICAgfQoKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgT2JqZWN0IHNldEltcGxE\nYXRhKE9iamVjdCBkYXRhLCBib29sZWFuIGNhY2hlYWJsZSkgewogICAgICAg\nIE9iamVjdCBvbGQgPSBfaW1wbDsKICAgICAgICBfaW1wbCA9IGRhdGE7CiAg\nICAgICAgaWYgKGNhY2hlYWJsZSAmJiBkYXRhICE9IG51bGwpCiAgICAgICAg\nICAgIF9mbGFncyB8PSBGTEFHX0lNUExfQ0FDSEU7CiAgICAgICAgZWxzZQog\nICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfSU1QTF9DQUNIRTsKICAgICAg\nICByZXR1cm4gb2xkOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzSW1w\nbERhdGFDYWNoZWFibGUoKSB7CiAgICAgICAgcmV0dXJuIChfZmxhZ3MgJiBG\nTEFHX0lNUExfQ0FDSEUpICE9IDA7CiAgICB9CgogICAgcHVibGljIE9iamVj\ndCBnZXRJbXBsRGF0YShpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gZ2V0\nRXh0cmFGaWVsZERhdGEoZmllbGQsIHRydWUpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3Qgc2V0SW1wbERhdGEoaW50IGZpZWxkLCBPYmplY3QgZGF0YSkg\newogICAgICAgIHJldHVybiBzZXRFeHRyYUZpZWxkRGF0YShmaWVsZCwgZGF0\nYSwgdHJ1ZSk7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9uaXplZCBib29s\nZWFuIGlzSW1wbERhdGFDYWNoZWFibGUoaW50IGZpZWxkKSB7CiAgICAgICAg\naWYgKF9maWVsZEltcGwgPT0gbnVsbCB8fCAhX2xvYWRlZC5nZXQoZmllbGQp\nKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKF9tZXRh\nLmdldEZpZWxkKGZpZWxkKS51c2VzSW1wbERhdGEoKSAhPSBudWxsKQogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgaW50IGlkeCA9IF9tZXRh\nLmdldEV4dHJhRmllbGREYXRhSW5kZXgoZmllbGQpOwogICAgICAgIHJldHVy\nbiBpZHggIT0gLTEgJiYgX2ZpZWxkSW1wbFtpZHhdICE9IG51bGw7CiAgICB9\nCgogICAgcHVibGljIE9iamVjdCBnZXRJbnRlcm1lZGlhdGUoaW50IGZpZWxk\nKSB7CiAgICAgICAgcmV0dXJuIGdldEV4dHJhRmllbGREYXRhKGZpZWxkLCBm\nYWxzZSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0SW50ZXJtZWRpYXRl\nKGludCBmaWVsZCwgT2JqZWN0IGRhdGEpIHsKICAgICAgICBzZXRFeHRyYUZp\nZWxkRGF0YShmaWVsZCwgZGF0YSwgZmFsc2UpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBkYXRhIGZyb20gdGhlIHByb3BlciBpbmRleCBv\nZiB0aGUgZXh0cmEgZmllbGQgZGF0YSBhcnJheS4KICAgICAqLwogICAgcHJp\ndmF0ZSBzeW5jaHJvbml6ZWQgT2JqZWN0IGdldEV4dHJhRmllbGREYXRhKGlu\ndCBmaWVsZCwgYm9vbGVhbiBpc0xvYWRlZCkgewogICAgICAgIC8vIG9ubHkg\ncmV0dXJuIHRoZSBmaWVsZCBkYXRhIGlmIHRoZSBmaWVsZCBpcyBpbiB0aGUg\ncmlnaHQgbG9hZGVkCiAgICAgICAgLy8gc3RhdGU7IG90aGVyd2lzZSB3ZSBt\naWdodCByZXR1cm4gaW50ZXJtZWRpYXRlIGZvciBpbXBsIGRhdGEgb3IKICAg\nICAgICAvLyB2aWNlIHZlcnNhCiAgICAgICAgaWYgKF9maWVsZEltcGwgPT0g\nbnVsbCB8fCBfbG9hZGVkLmdldChmaWVsZCkgIT0gaXNMb2FkZWQpCiAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGludCBpZHggPSBfbWV0YS5n\nZXRFeHRyYUZpZWxkRGF0YUluZGV4KGZpZWxkKTsKICAgICAgICByZXR1cm4g\nKGlkeCA9PSAtMSkgPyBudWxsIDogX2ZpZWxkSW1wbFtpZHhdOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBkYXRhIGZyb20gdG8gcHJvcGVyIGlu\nZGV4IG9mIHRoZSBleHRyYSBmaWVsZCBkYXRhIGFycmF5LgogICAgICovCiAg\nICBwcml2YXRlIHN5bmNocm9uaXplZCBPYmplY3Qgc2V0RXh0cmFGaWVsZERh\ndGEoaW50IGZpZWxkLCBPYmplY3QgZGF0YSwKICAgICAgICBib29sZWFuIGxv\nYWRlZCkgewogICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZpZWxk\nRGF0YUluZGV4KGZpZWxkKTsKICAgICAgICBpZiAoaWR4ID09IC0xKQogICAg\nICAgICAgICB0aHJvdyBuZXcgSW50ZXJuYWxFeGNlcHRpb24oU3RyaW5nLnZh\nbHVlT2YoX21ldGEuZ2V0RmllbGQoZmllbGQpKSk7CgogICAgICAgIE9iamVj\ndCBvbGQgPSAoX2ZpZWxkSW1wbCA9PSBudWxsKSA/IG51bGwgOiBfZmllbGRJ\nbXBsW2lkeF07CiAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICAg\nICAgICAvLyBjYW5ub3Qgc2V0IGlmIGZpZWxkIGluIHdyb25nIGxvYWRlZCBz\ndGF0ZQogICAgICAgICAgICBpZiAoX2xvYWRlZC5nZXQoZmllbGQpICE9IGxv\nYWRlZCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnRlcm5hbEV4Y2Vw\ndGlvbihTdHJpbmcudmFsdWVPZihfbWV0YS5nZXRGaWVsZAogICAgICAgICAg\nICAgICAgICAgIChmaWVsZCkpKTsKCiAgICAgICAgICAgIC8vIHNldCBkYXRh\nCiAgICAgICAgICAgIGlmIChfZmllbGRJbXBsID09IG51bGwpCiAgICAgICAg\nICAgICAgICBfZmllbGRJbXBsID0gbmV3IE9iamVjdFtfbWV0YS5nZXRFeHRy\nYUZpZWxkRGF0YUxlbmd0aCgpXTsKICAgICAgICAgICAgX2ZpZWxkSW1wbFtp\nZHhdID0gZGF0YTsKICAgICAgICB9IGVsc2UgaWYgKF9maWVsZEltcGwgIT0g\nbnVsbCAmJiBfbG9hZGVkLmdldChmaWVsZCkgPT0gbG9hZGVkKQogICAgICAg\nICAgICBfZmllbGRJbXBsW2lkeF0gPSBudWxsOwogICAgICAgIHJldHVybiBv\nbGQ7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaChpbnQgZmllbGQp\nIHsKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFs\nc2UpOwogICAgICAgIHJldHVybiBfbWV0YS5nZXRGaWVsZChmaWVsZCkuZ2V0\nRXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1Ymxp\nYyBPYmplY3QgZmV0Y2hGaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gdHJhbnNp\ndGlvbnMpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdl\ndEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoZm1kID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IG5ldyBVc2VyRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1m\naWVsZCIsCiAgICAgICAgICAgICAgICBTdHJpbmcudmFsdWVPZihmaWVsZCks\nIGdldE1hbmFnZWRJbnN0YW5jZSgpLmdldENsYXNzKCkpKS4KICAgICAgICAg\nICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7\nCgogICAgICAgIC8vIGRvIG5vcm1hbCBzdGF0ZSB0cmFuc2l0aW9ucwogICAg\nICAgIGlmICghZm1kLmlzUHJpbWFyeUtleSgpICYmIHRyYW5zaXRpb25zKQog\nICAgICAgICAgICBhY2Nlc3NpbmdGaWVsZChmaWVsZCk7CgogICAgICAgIHN3\naXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUoKSkgewogICAgICAgICAg\nICBjYXNlIEphdmFUeXBlcy5TVFJJTkc6CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmV0Y2hTdHJpbmdGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLk9CSkVDVDoKICAgICAgICAgICAgICAgIHJldHVybiBmZXRj\naE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQk9PTEVBTjoKICAgICAgICAgICAgICAgIHJldHVybiAoZmV0Y2hCb29s\nZWFuRmllbGQoZmllbGQpKSA/IEJvb2xlYW4uVFJVRQogICAgICAgICAgICAg\nICAgICAgIDogQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgY2FzZSBKYXZh\nVHlwZXMuQllURToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZShm\nZXRjaEJ5dGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5DSEFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGFyYWN0\nZXIoZmV0Y2hDaGFyRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBK\nYXZhVHlwZXMuRE9VQkxFOgogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBE\nb3VibGUoZmV0Y2hEb3VibGVGaWVsZChmaWVsZCkpOwogICAgICAgICAgICBj\nYXNlIEphdmFUeXBlcy5GTE9BVDoKICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgRmxvYXQoZmV0Y2hGbG9hdEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAg\nIGNhc2UgSmF2YVR5cGVzLklOVDoKICAgICAgICAgICAgICAgIHJldHVybiBm\nZXRjaEludEZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuTE9ORzoKICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaExvbmdGaWVs\nZChmaWVsZCk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNIT1JUOgog\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTaG9ydChmZXRjaFNob3J0Rmll\nbGQoZmllbGQpKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nICAgIHJldHVybiBmZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmUoaW50IGZpZWxkLCBPYmpl\nY3QgdmFsKSB7CiAgICAgICAgdmFsID0gX21ldGEuZ2V0RmllbGQoZmllbGQp\nLmdldEZpZWxkVmFsdWUodmFsLCBfYnJva2VyKTsKICAgICAgICBzdG9yZUZp\nZWxkKGZpZWxkLCB2YWwpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3Jl\nRmllbGQoaW50IGZpZWxkLCBPYmplY3QgdmFsKSB7CiAgICAgICAgc3RvcmVG\naWVsZChmaWVsZCwgdmFsLCB0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIDxwPkNoZWNrcyB3aGV0aGVyIG9yIG5vdCA8Y29kZT5fcGM8L2NvZGU+IGlz\nIGRpcnR5LiBJbiB0aGUgY2FzZXMgd2hlcmUKICAgICAqIGZpZWxkIHRyYWNr\naW5nIGlzIG5vdCBoYXBwZW5pbmcgKHNlZSBiZWxvdyksIHRoaXMgbWV0aG9k\nIHdpbGwgZG8gYQogICAgICogc3RhdGUgY29tcGFyaXNvbiB0byBmaW5kIHdo\nZXRoZXIgPGNvZGU+X3BjPC9jb2RlPiBpcyBkaXJ0eSwgYW5kIHdpbGwKICAg\nICAqIHVwZGF0ZSB0aGlzIGluc3RhbmNlIHdpdGggdGhpcyBpbmZvcm1hdGlv\nbi4gSW4gdGhlIGNhc2VzIHdoZXJlIGZpZWxkCiAgICAgKiB0cmFja2luZyBp\ncyBoYXBwZW5pbmcsIHRoaXMgbWV0aG9kIGlzIGEgbm8tb3AuPC9wPgogICAg\nICoKICAgICAqIDxwPkZpZWxkcyBhcmUgdHJhY2tlZCBmb3IgYWxsIGNsYXNz\nZXMgdGhhdCBhcmUgcnVuIHRocm91Z2ggdGhlIE9wZW5KUEEKICAgICAqIGVu\naGFuY2VyIHByaW9yIHRvIG9yIGR1cmluZyBkZXBsb3ltZW50LCBhbmQgYWxs\nIGNsYXNzZXMgKGVuaGFuY2VkIG9yCiAgICAgKiB1bmVuaGFuY2VkKSBpbiBh\nIEphdmEgNiBlbnZpcm9ubWVudCBvciBuZXdlci48L3A+CiAgICAgKgogICAg\nICogPHA+SW4gYSBKYXZhIDUgVk0gb3Igb2xkZXI6CiAgICAgKiA8YnI+LSBp\nbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2VzIHRoYXQgdXNlCiAgICAg\nKiBwcm9wZXJ0eSBhY2Nlc3MgYW5kIG9iZXkgdGhlIHByb3BlcnR5IGFjY2Vz\ncyBsaW1pdGF0aW9ucyBhcmUgdHJhY2tlZAogICAgICogd2hlbiB0aGUgaW5z\ndGFuY2VzIGFyZSBsb2FkZWQgZnJvbSB0aGUgZGF0YWJhc2UgYnkgT3BlbkpQ\nQSwgYW5kIGFyZQogICAgICogbm90IHRyYWNrZWQgd2hlbiB0aGUgaW5zdGFu\nY2VzIGFyZSBjcmVhdGVkIGJ5IGFwcGxpY2F0aW9uIGNvZGUuCiAgICAgKiA8\nYnI+LSBpbnN0YW5jZXMgb2YgdW5lbmhhbmNlZCBjbGFzc2VzIHRoYXQgdXNl\nIGZpZWxkIGFjY2VzcyBhcmUKICAgICAqIG5ldmVyIHRyYWNrZWQuPC9wPgog\nICAgICoKICAgICAqIEBzaW5jZSAxLjAuMAogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBkaXJ0eUNoZWNrKCkgewogICAgICAgIGlmICghbmVlZHNEaXJ0eUNo\nZWNrKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgU2F2ZUZpZWxk\nTWFuYWdlciBzYXZlZCA9IGdldFNhdmVGaWVsZE1hbmFnZXIoKTsKICAgICAg\nICBpZiAoc2F2ZWQgPT0gbnVsbCkKICAgICAgICAgICAgdGhyb3cgbmV3IElu\ndGVybmFsRXhjZXB0aW9uKF9sb2MuZ2V0KCJuby1zYXZlZC1maWVsZHMiLAog\nICAgICAgICAgICAgICAgZ2V0TWV0YURhdGEoKS5nZXREZXNjcmliZWRUeXBl\nKCkuZ2V0TmFtZSgpKSk7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRz\nID0gZ2V0TWV0YURhdGEoKS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAg\nLy8gcGsgYW5kIHZlcnNpb24gZmllbGRzIGNhbm5vdCBiZSBtdXRhdGVkOyBk\nb24ndCBtYXJrIHRoZW0KICAgICAgICAgICAgLy8gYXMgc3VjaC4gIyMjIyMg\ndmFsaWRhdGU/CiAgICAgICAgICAgIGlmICghZm1kc1tpXS5pc1ByaW1hcnlL\nZXkoKSAmJiAhZm1kc1tpXS5pc1ZlcnNpb24oKQogICAgICAgICAgICAgICAg\nJiYgX2xvYWRlZC5nZXQoaSkpIHsKICAgICAgICAgICAgICAgIGlmICghc2F2\nZWQuaXNGaWVsZEVxdWFsKGksIGZldGNoKGkpKSkgewogICAgICAgICAgICAg\nICAgICAgIGRpcnR5KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBuZWVk\nc0RpcnR5Q2hlY2soKSB7CiAgICAgICAgaWYgKGlzSW50ZXJjZXB0aW5nKCkp\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoaXNEZWxl\ndGVkKCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAo\naXNOZXcoKSAmJiAhaXNGbHVzaGVkKCkpCiAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMg\nT2JqZWN0IGZldGNoSW5pdGlhbEZpZWxkKGludCBmaWVsZCkgewogICAgICAg\nIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwog\nICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgpID09IFJlc3Rv\ncmVTdGF0ZS5SRVNUT1JFX05PTkUKICAgICAgICAgICAgJiYgKChfZmxhZ3Mg\nJiBGTEFHX0lOVkVSU0VTKSA9PSAwCiAgICAgICAgICAgIHx8IGZtZC5nZXRJ\nbnZlcnNlTWV0YURhdGFzKCkubGVuZ3RoID09IDApKQogICAgICAgICAgICB0\naHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9sb2MuZ2V0KCJyZXN0\nb3JlLXVuc2V0IikpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJl\nZFR5cGVDb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFU\nRToKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ0FMRU5EQVI6CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZOgogICAgICAgICAgICBjYXNl\nIEphdmFUeXBlcy5DT0xMRUNUSU9OOgogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5NQVA6CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLk9CSkVDVDoK\nICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIG5vdCBzYXZpbmcgbXV0YWJs\nZSB0eXBlcywgdGhyb3cgYW4gZXhjZXB0aW9uCiAgICAgICAgICAgICAgICBp\nZiAoX2Jyb2tlci5nZXRSZXN0b3JlU3RhdGUoKSAhPSBSZXN0b3JlU3RhdGUu\nUkVTVE9SRV9BTEwKICAgICAgICAgICAgICAgICAgICAmJiAoKF9mbGFncyAm\nIEZMQUdfSU5WRVJTRVMpID09IDAKICAgICAgICAgICAgICAgICAgICB8fCBm\nbWQuZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0aCA9PSAwKSkKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9u\nKF9sb2MuZ2V0CiAgICAgICAgICAgICAgICAgICAgICAgICgibXV0YWJsZS1y\nZXN0b3JlLXVuc2V0IikpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChfc2F2ZWQgPT0gbnVsbCB8\nfCAhX2xvYWRlZC5nZXQoZmllbGQpIHx8ICFfZGlydHkuZ2V0KGZpZWxkKSkK\nICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaEZpZWxkKGZpZWxkLCBmYWxz\nZSk7CgogICAgICAgICAgICAvLyBpZiB0aGUgZmllbGQgaXMgZGlydHkgYnV0\nIHdlIG5ldmVyIGxvYWRlZCBpdCwgd2UgY2FuJ3QgcmVzdG9yZSBpdAogICAg\nICAgICAgICBpZiAoX3NhdmVkLmdldFVubG9hZGVkKCkuZ2V0KGZpZWxkKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3RhdGVFeGNlcHRp\nb24oX2xvYy5nZXQoImluaXRpYWwtdW5sb2FkZWQiLAogICAgICAgICAgICAg\nICAgICAgIGZtZCkpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9zYXZl\nZC5nZXRTdGF0ZSgpLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHJl\ndHVybiBmZXRjaEZpZWxkKF9zaW5nbGUsIGZtZCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogRmV0Y2ggdGhlIHNwZWNpZmllZCBmaWVsZCBmcm9t\nIHRoZSBzcGVjaWZpZWQgZmllbGQgbWFuYWdlciwgd3JhcHBpbmcgaXQKICAg\nICAqIGluIGFuIG9iamVjdCBpZiBpdCdzIGEgcHJpbWl0aXZlLiBBIGZpZWxk\nIHNob3VsZCBiZSBwcm92aWRlZCB0byB0aGUKICAgICAqIGZpZWxkIG1hbmFn\nZXIgYmVmb3JlIHRoaXMgY2FsbCBpcyBtYWRlLgogICAgICovCiAgICBwcml2\nYXRlIHN0YXRpYyBPYmplY3QgZmV0Y2hGaWVsZChGaWVsZE1hbmFnZXIgZm0s\nIEZpZWxkTWV0YURhdGEgZm1kKSB7CiAgICAgICAgaW50IGZpZWxkID0gZm1k\nLmdldEluZGV4KCk7CiAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRU\neXBlQ29kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkJPT0xF\nQU46CiAgICAgICAgICAgICAgICByZXR1cm4gKGZtLmZldGNoQm9vbGVhbkZp\nZWxkKGZpZWxkKSkgPyBCb29sZWFuLlRSVUUKICAgICAgICAgICAgICAgICAg\nICA6IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkJZVEU6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJ5dGUoZm0uZmV0\nY2hCeXRlRmllbGQoZmllbGQpKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlw\nZXMuQ0hBUjoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhcmFjdGVy\nKGZtLmZldGNoQ2hhckZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLkRPVUJMRToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\nRG91YmxlKGZtLmZldGNoRG91YmxlRmllbGQoZmllbGQpKTsKICAgICAgICAg\nICAgY2FzZSBKYXZhVHlwZXMuRkxPQVQ6CiAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IEZsb2F0KGZtLmZldGNoRmxvYXRGaWVsZChmaWVsZCkpOwogICAg\nICAgICAgICBjYXNlIEphdmFUeXBlcy5JTlQ6CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZm0uZmV0Y2hJbnRGaWVsZChmaWVsZCk7CiAgICAgICAgICAgIGNh\nc2UgSmF2YVR5cGVzLkxPTkc6CiAgICAgICAgICAgICAgICByZXR1cm4gZm0u\nZmV0Y2hMb25nRmllbGQoZmllbGQpOwogICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5TSE9SVDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2hvcnQo\nZm0uZmV0Y2hTaG9ydEZpZWxkKGZpZWxkKSk7CiAgICAgICAgICAgIGNhc2Ug\nSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAgICAgIHJldHVybiBmbS5m\nZXRjaFN0cmluZ0ZpZWxkKGZpZWxkKTsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIHJldHVybiBmbS5mZXRjaE9iamVjdEZpZWxkKGZp\nZWxkKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0UmVt\nb3RlKGludCBmaWVsZCwgT2JqZWN0IHZhbHVlKSB7CiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRp\ncnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBmYWxzZSk7CiAgICAgICAgICAg\nIHN0b3JlRmllbGQoZmllbGQsIHZhbHVlLCBfc2luZ2xlKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTGlmZWN5Y2xlIG9wZXJhdGlv\nbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAg\nICogTm90aWZpY2F0aW9uIHRoYXQgdGhlIG9iamVjdCBpcyBhYm91dCB0byBi\nZSBhY2Nlc3NlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gZmllbGQgdGhlIGZp\nZWxkIG51bWJlciBiZWluZyByZWFkLCBvciAtMSBpZiBub3QgYSBzaW5nbGUK\nICAgICAqIGZpZWxkIHJlYWQKICAgICAqLwogICAgdm9pZCBiZWZvcmVSZWFk\nKGludCBmaWVsZCkgewogICAgICAgIC8vIGFsbG93IHVubWVkaWF0ZWQgcmVh\nZHMgb2YgcHJpbWFyeSBrZXkgZmllbGRzCiAgICAgICAgaWYgKGZpZWxkICE9\nIC0xICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXkoKSkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX2Jyb2tlci5pc0Fj\ndGl2ZSgpICYmICFfYnJva2VyLmlzVHJhbnNhY3Rpb25FbmRpbmcoKSkgewog\nICAgICAgICAgICBpZiAoX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAg\nICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVPcHRpbWlzdGlj\nUmVhZCh0aGlzLCBmaWVsZCkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVSZWFkKHRoaXMsIGZp\nZWxkKSk7CiAgICAgICAgfSBlbHNlIGlmIChfYnJva2VyLmdldE5vbnRyYW5z\nYWN0aW9uYWxSZWFkKCkpCiAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRl\nLmJlZm9yZU5vbnRyYW5zYWN0aW9uYWxSZWFkKHRoaXMsIGZpZWxkKSk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN0YXRl\nRXhjZXB0aW9uKF9sb2MuZ2V0KCJub24tdHJhbnMtcmVhZCIpKS4KICAgICAg\nICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2Uo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1\ncnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI2JlZm9y\nZUZsdXNoCiAgICAgKi8KICAgIHZvaWQgYmVmb3JlRmx1c2goaW50IHJlYXNv\nbiwgT3BDYWxsYmFja3MgY2FsbCkgewogICAgICAgIF9zdGF0ZS5iZWZvcmVG\nbHVzaCh0aGlzLCByZWFzb24gPT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FM\nLCBjYWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0\naGUgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUj\nZmx1c2gKICAgICAqLwogICAgdm9pZCBhZnRlckZsdXNoKGludCByZWFzb24p\nIHsKICAgICAgICAvLyBub3RoaW5nIGhhcHBlbnMgd2hlbiB3ZSBmbHVzaCBu\nb24tcGVyc2lzdGVudCBzdGF0ZXMKICAgICAgICBpZiAoIWlzUGVyc2lzdGVu\ndCgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChyZWFzb24g\nIT0gQnJva2VySW1wbC5GTFVTSF9ST0xMQkFDSwogICAgICAgICAgICAmJiBy\nZWFzb24gIT0gQnJva2VySW1wbC5GTFVTSF9MT0dJQ0FMKSB7CiAgICAgICAg\nICAgIC8vIGFuYWx5emUgcHJldmlvdXMgc3RhdGUgZm9yIGxhdGVyCiAgICAg\nICAgICAgIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKTsKICAgICAgICAgICAg\nYm9vbGVhbiB3YXNGbHVzaGVkID0gaXNGbHVzaGVkKCk7CiAgICAgICAgICAg\nIGJvb2xlYW4gd2FzRGVsZXRlZCA9IGlzRGVsZXRlZCgpOwogICAgICAgICAg\nICBib29sZWFuIG5lZWRQb3N0VXBkYXRlID0gISh3YXNOZXcgJiYgIXdhc0Zs\ndXNoZWQpCiAgICAgICAgICAgICAgICAgICAgJiYgKEltcGxIZWxwZXIuZ2V0\nVXBkYXRlRmllbGRzKHRoaXMpICE9IG51bGwpOwoKICAgICAgICAgICAgLy8g\nYWxsIGRpcnR5IGZpZWxkcyB3ZXJlIGZsdXNoZWQKICAgICAgICAgICAgX2Zs\ndXNoLm9yKF9kaXJ0eSk7CgogICAgICAgICAgICAvLyBpbXBvcnRhbnQgdG8g\nc2V0IGZsdXNoZWQgYml0IGFmdGVyIGNhbGxpbmcgX3N0YXRlLmZsdXNoIHNv\nCiAgICAgICAgICAgIC8vIHRoYXQgdGhlIHN0YXRlIGNhbiB0ZWxsIHdoZXRo\nZXIgdGhpcyBpcyB0aGUgZmlyc3QgZmx1c2gKICAgICAgICAgICAgc2V0UENT\ndGF0ZShfc3RhdGUuZmx1c2godGhpcykpOwogICAgICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19GTFVTSEVEOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgICAgIF9mbGFncyAmPSB+RkxBR19W\nRVJTSU9OX0NIRUNLOwogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfVkVS\nU0lPTl9VUERBVEU7CgogICAgICAgICAgICAvLyBpZiB0aGlzIHdhcyBhbiBp\nbmMgZmx1c2ggZHVyaW5nIHdoaWNoIHdlIGhhZCBvdXIgaWRlbnRpdHkKICAg\nICAgICAgICAgLy8gYXNzaWduZWQsIHRlbGwgdGhlIGJyb2tlciB0byBjYWNo\nZSB1cyB1bmRlciBvdXIgZmluYWwgb2lkCiAgICAgICAgICAgIGlmIChyZWFz\nb24gPT0gQnJva2VySW1wbC5GTFVTSF9JTkMpCiAgICAgICAgICAgICAgICBh\nc3NlcnRPYmplY3RJZEFzc2lnbmVkKHRydWUpOwoKICAgICAgICAgICAgLy8g\naWYgdGhpcyBvYmplY3Qgd2FzIHN0b3JlZCB3aXRoIHByZUZsdXNoLCBkbyBw\nb3N0LXN0b3JlIGNhbGxiYWNrCiAgICAgICAgICAgIGlmICgoX2ZsYWdzICYg\nRkxBR19QUkVfRkxVU0hFRCkgPiAwKQogICAgICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1NUT1JFKTsKCiAg\nICAgICAgICAgIC8vIGRvIHBvc3QtdXBkYXRlIGFzIG5lZWRlZAogICAgICAg\nICAgICBpZiAod2FzTmV3ICYmICF3YXNGbHVzaGVkKQogICAgICAgICAgICAg\nICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX1BF\nUlNJU1RfUEVSRk9STUVEKTsKICAgICAgICAgICAgZWxzZSBpZiAod2FzRGVs\nZXRlZCkKICAgICAgICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZl\nY3ljbGVFdmVudC5BRlRFUl9ERUxFVEVfUEVSRk9STUVEKTsKICAgICAgICAg\nICAgZWxzZSBpZiAobmVlZFBvc3RVcGRhdGUpCiAgICAgICAgICAgICAgICAv\nLyB1cGRhdGVzIGFuZCBuZXctZmx1c2hlZCB3aXRoIGNoYW5nZXMKICAgICAg\nICAgICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5B\nRlRFUl9VUERBVEVfUEVSRk9STUVEKTsKICAgICAgICB9IGVsc2UgaWYgKHJl\nYXNvbiA9PSBCcm9rZXJJbXBsLkZMVVNIX1JPTExCQUNLKSB7CiAgICAgICAg\nICAgIC8vIHJldmVydCB0byBsYXN0IGxvYWRlZCB2ZXJzaW9uIGFuZCBvcmln\naW5hbCBvaWQKICAgICAgICAgICAgYXNzaWduVmVyc2lvbkZpZWxkKF9sb2Fk\nVmVyc2lvbik7CiAgICAgICAgICAgIGlmIChpc05ldygpICYmIChfZmxhZ3Mg\nJiBGTEFHX09JRF9BU1NJR05FRCkgPT0gMCkKICAgICAgICAgICAgICAgIF9v\naWQgPSBudWxsOwogICAgICAgIH0KICAgICAgICBfZmxhZ3MgJj0gfkZMQUdf\nUFJFX0ZMVVNIRUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMg\ndG8gdGhlIGN1cnJlbnQgc3RhdGUgYWZ0ZXIgY2hlY2tpbmcgdGhlIHZhbHVl\nCiAgICAgKiBvZiB0aGUgUmV0YWluU3RhdGUgZmxhZy4KICAgICAqCiAgICAg\nKiBAc2VlIFBDU3RhdGUjY29tbWl0CiAgICAgKiBAc2VlIFBDU3RhdGUjY29t\nbWl0UmV0YWluCiAgICAgKi8KICAgIHZvaWQgY29tbWl0KCkgewogICAgICAg\nIC8vIHJlbGVhc2UgbG9ja3MgYmVmb3JlIG9pZCB1cGRhdGVkCiAgICAgICAg\ncmVsZWFzZUxvY2tzKCk7CgogICAgICAgIC8vIHVwZGF0ZSB2ZXJzaW9uIGFu\nZCBvaWQgaW5mb3JtYXRpb24KICAgICAgICBzZXRWZXJzaW9uKF92ZXJzaW9u\nKTsKICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBf\nZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgT2JqZWN0\nIG9yaWcgPSBfaWQ7CiAgICAgICAgYXNzZXJ0T2JqZWN0SWRBc3NpZ25lZChm\nYWxzZSk7CgogICAgICAgIGJvb2xlYW4gd2FzTmV3ID0gaXNOZXcoKSAmJiAh\naXNEZWxldGVkKCkgJiYgIWlzUHJvdmlzaW9uYWwoKTsKICAgICAgICBpZiAo\nX2Jyb2tlci5nZXRSZXRhaW5TdGF0ZSgpKQogICAgICAgICAgICBzZXRQQ1N0\nYXRlKF9zdGF0ZS5jb21taXRSZXRhaW4odGhpcykpOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgc2V0UENTdGF0ZShfc3RhdGUuY29tbWl0KHRoaXMpKTsK\nCiAgICAgICAgLy8gYXNrIHRoZSBicm9rZXIgdG8gcmUtY2FjaGUgdXMgaWYg\nd2Ugd2VyZSBuZXcgcHJldmlvdXNseQogICAgICAgIGlmICh3YXNOZXcpCiAg\nICAgICAgICAgIF9icm9rZXIuc2V0U3RhdGVNYW5hZ2VyKG9yaWcsIHRoaXMs\nIEJyb2tlckltcGwuU1RBVFVTX0NPTU1JVF9ORVcpOwogICAgfQoKICAgIC8q\nKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0YXRlIGFmdGVy\nIGNoZWNraW5nIHRoZSB2YWx1ZQogICAgICogb2YgdGhlIFJldGFpblN0YXRl\nIGZsYWcuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3JvbGxiYWNrCiAg\nICAgKiBAc2VlIFBDU3RhdGUjcm9sbGJhY2tSZXN0b3JlCiAgICAgKi8KICAg\nIHZvaWQgcm9sbGJhY2soKSB7CiAgICAgICAgLy8gcmVsZWFzZSBsb2Nrcwog\nICAgICAgIHJlbGVhc2VMb2NrcygpOwogICAgICAgIF9mbGFncyAmPSB+RkxB\nR19GTFVTSEVEOwogICAgICAgIF9mbGFncyAmPSB+RkxBR19GTFVTSEVEX0RJ\nUlRZOwogICAgICAgIGFmdGVyRmx1c2goQnJva2VySW1wbC5GTFVTSF9ST0xM\nQkFDSyk7CgogICAgICAgIGlmIChfYnJva2VyLmdldFJlc3RvcmVTdGF0ZSgp\nICE9IFJlc3RvcmVTdGF0ZS5SRVNUT1JFX05PTkUpCiAgICAgICAgICAgIHNl\ndFBDU3RhdGUoX3N0YXRlLnJvbGxiYWNrUmVzdG9yZSh0aGlzKSk7CiAgICAg\nICAgZWxzZQogICAgICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5yb2xsYmFj\nayh0aGlzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSb2xsYmFjayBzdGF0\nZSBvZiB0aGUgbWFuYWdlZCBpbnN0YW5jZSB0byB0aGUgZ2l2ZW4gc2F2ZXBv\naW50LgogICAgICovCiAgICB2b2lkIHJvbGxiYWNrVG9TYXZlcG9pbnQoU2F2\nZXBvaW50RmllbGRNYW5hZ2VyIHNhdmVwb2ludCkgewogICAgICAgIF9zdGF0\nZSA9IHNhdmVwb2ludC5nZXRQQ1N0YXRlKCk7CiAgICAgICAgQml0U2V0IGxv\nYWRlZCA9IHNhdmVwb2ludC5nZXRMb2FkZWQoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMCwgbGVuID0gbG9hZGVkLmxlbmd0aCgpOyBpIDwgbGVuOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGxvYWRlZC5nZXQoaSkgJiYgc2F2ZXBvaW50\nLnJlc3RvcmVGaWVsZChpKSkgewogICAgICAgICAgICAgICAgcHJvdmlkZUZp\nZWxkKHNhdmVwb2ludC5nZXRDb3B5KCksIHNhdmVwb2ludCwgaSk7CiAgICAg\nICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBzYXZlcG9pbnQsIGkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9sb2FkZWQgPSBsb2Fk\nZWQ7CiAgICAgICAgX2RpcnR5ID0gc2F2ZXBvaW50LmdldERpcnR5KCk7CiAg\nICAgICAgX2ZsdXNoID0gc2F2ZXBvaW50LmdldEZsdXNoZWQoKTsKICAgICAg\nICBfdmVyc2lvbiA9IHNhdmVwb2ludC5nZXRWZXJzaW9uKCk7CiAgICAgICAg\nX2xvYWRWZXJzaW9uID0gc2F2ZXBvaW50LmdldExvYWRWZXJzaW9uKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQg\nc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI3BlcnNpc3QKICAg\nICAqIEBzZWUgQnJva2VyI3BlcnNpc3QKICAgICAqLwogICAgdm9pZCBwZXJz\naXN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLnBlcnNpc3QodGhp\ncykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBj\ndXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNkZWxl\ndGUKICAgICAqIEBzZWUgQnJva2VyI2RlbGV0ZQogICAgICovCiAgICB2b2lk\nIGRlbGV0ZSgpIHsKICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5kZWxldGUo\ndGhpcykpOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRo\nZSBjdXJyZW50IHN0YXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNu\nb250cmFuc2FjdGlvbmFsCiAgICAgKiBAc2VlIEJyb2tlciNub250cmFuc2Fj\ndGlvbmFsCiAgICAgKi8KICAgIHZvaWQgbm9udHJhbnNhY3Rpb25hbCgpIHsK\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5ub250cmFuc2FjdGlvbmFsKHRo\naXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIERlbGVnYXRlcyB0byB0aGUg\nY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAc2VlIFBDU3RhdGUjdHJh\nbnNhY3Rpb25hbAogICAgICogQHNlZSBCcm9rZXIjdHJhbnNhY3Rpb25hbAog\nICAgICovCiAgICB2b2lkIHRyYW5zYWN0aW9uYWwoKSB7CiAgICAgICAgc2V0\nUENTdGF0ZShfc3RhdGUudHJhbnNhY3Rpb25hbCh0aGlzKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMgdG8gdGhlIGN1cnJlbnQgc3RhdGUu\nCiAgICAgKgogICAgICogQHNlZSBQQ1N0YXRlI25vbnByb3Zpc2lvbmFsCiAg\nICAgKi8KICAgIHZvaWQgbm9ucHJvdmlzaW9uYWwoYm9vbGVhbiBsb2dpY2Fs\nLCBPcENhbGxiYWNrcyBjYWxsKSB7CiAgICAgICAgc2V0UENTdGF0ZShfc3Rh\ndGUubm9ucHJvdmlzaW9uYWwodGhpcywgbG9naWNhbCwgY2FsbCkpOwogICAg\nfQoKICAgIC8qKgogICAgICogRGVsZWdhdGVzIHRvIHRoZSBjdXJyZW50IHN0\nYXRlLgogICAgICoKICAgICAqIEBzZWUgUENTdGF0ZSNyZWxlYXNlCiAgICAg\nKiBAc2VlIEJyb2tlciNyZWxlYXNlCiAgICAgKi8KICAgIHZvaWQgcmVsZWFz\nZShib29sZWFuIHVucHJveHkpIHsKICAgICAgICByZWxlYXNlKHVucHJveHks\nIGZhbHNlKTsKICAgIH0KCiAgICB2b2lkIHJlbGVhc2UoYm9vbGVhbiB1bnBy\nb3h5LCBib29sZWFuIGZvcmNlKSB7CiAgICAgICAgLy8gb3B0aW1pemF0aW9u\nIGZvciBkZXRhY2gtaW4tcGxhY2Ugc3BlY2lhbCBjYXNlIHdoZW4gZmllbGRz\nIGFyZQogICAgICAgIC8vIGFscmVhZHkgKHVuKXByb3hpZWQgY29ycmVjdGx5\nCiAgICAgICAgaWYgKCF1bnByb3h5KQogICAgICAgICAgICBfZmxhZ3MgfD0g\nRkxBR19OT19VTlBST1hZOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nIChmb3JjZSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoUENTdGF0ZS5U\nUkFOU0lFTlQpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBz\nZXRQQ1N0YXRlKF9zdGF0ZS5yZWxlYXNlKHRoaXMpKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfTk9fVU5QUk9Y\nWTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxlZ2F0ZXMg\ndG8gdGhlIGN1cnJlbnQgc3RhdGUuCiAgICAgKgogICAgICogQHNlZSBQQ1N0\nYXRlI2V2aWN0CiAgICAgKiBAc2VlIEJyb2tlciNldmljdAogICAgICovCiAg\nICB2b2lkIGV2aWN0KCkgewogICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmV2\naWN0KHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdhdGhlciByZWxh\ndGlvbnMgcmVhY2hhYmxlIGZyb20gdmFsdWVzIHVzaW5nCiAgICAgKiB7QGxp\nbmsgVmFsdWVNZXRhRGF0YSNDQVNDQURFX0lNTUVESUFURX0uCiAgICAgKi8K\nICAgIHZvaWQgZ2F0aGVyQ2FzY2FkZVJlZnJlc2goT3BDYWxsYmFja3MgY2Fs\nbCkgewogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkp\nCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmIChm\nbWRzW2ldLmdldENhc2NhZGVSZWZyZXNoKCkgPT0gVmFsdWVNZXRhRGF0YS5D\nQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAgICAgfHwgZm1kc1tpXS5n\nZXRLZXkoKS5nZXRDYXNjYWRlUmVmcmVzaCgpCiAgICAgICAgICAgICAgICA9\nPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAg\nICAgICB8fCBmbWRzW2ldLmdldEVsZW1lbnQoKS5nZXRDYXNjYWRlUmVmcmVz\naCgpCiAgICAgICAgICAgICAgICA9PSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVf\nSU1NRURJQVRFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0b3JlT2Jq\nZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChpLCBmYWxzZSkpOwogICAgICAgICAg\nICAgICAgX3NpbmdsZS5nYXRoZXJDYXNjYWRlUmVmcmVzaChjYWxsKTsKICAg\nICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBiZWZvcmVSZWZy\nZXNoKGJvb2xlYW4gcmVmcmVzaEFsbCkgewogICAgICAgIC8vIG5vdGU6IGFs\nbCBsb2dpYyBwbGFjZWQgaGVyZSByYXRoZXIgdGhhbiBpbiB0aGUgc3RhdGVz\nIGZvcgogICAgICAgIC8vIG9wdGltaXphdGlvbjsgdGhpcyBtZXRob2QgcHVi\nbGljIGIvYyB1c2VkIGJ5IHJlbW90ZSBwYWNrYWdlCgogICAgICAgIC8vIG5v\ndGhpbmcgdG8gZG8gZm9yIG5vbiBwZXJzaXN0ZW50IG9yIG5ldyB1bmZsdXNo\nZWQgaW5zdGFuY2VzCiAgICAgICAgaWYgKCFpc1BlcnNpc3RlbnQoKSB8fCAo\naXNOZXcoKSAmJiAhaXNGbHVzaGVkKCkpKQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBpZiBkaXJ0eSBuZWVkIHRvIGNsZWFyIGZpZWxkcwogICAgICAg\nICAgICBpZiAoaXNEaXJ0eSgpKSB7CiAgICAgICAgICAgICAgICBjbGVhckZp\nZWxkcygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHNvbWUgZmllbGRzIGhhdmUgYmVl\nbiBsb2FkZWQgYnV0IHRoZSBpbnN0YW5jZSBpcyBvdXQgb2YKICAgICAgICAg\nICAgLy8gZGF0ZSBvciB0aGlzIGlzIHBhcnQgb2YgYSByZWZyZXNoQWxsKCkg\nYW5kIHdlIGRvbid0IHdhbnQgdG8KICAgICAgICAgICAgLy8gdGFrZSB0aGUg\nZXh0cmEgaGl0IHRvIHNlZSBpZiB0aGUgaW5zdGFuY2UgaXMgb3V0IG9mIGRh\ndGUsIGNsZWFyCiAgICAgICAgICAgIGlmIChfbG9hZGVkLmxlbmd0aCgpID4g\nMCAmJiAocmVmcmVzaEFsbCB8fCBpc0VtYmVkZGVkKCkKICAgICAgICAgICAg\nICAgIHx8ICFzeW5jVmVyc2lvbihudWxsKSkpIHsKICAgICAgICAgICAgICAg\nIE9iamVjdCB2ZXJzaW9uID0gX3ZlcnNpb247CiAgICAgICAgICAgICAgICBj\nbGVhckZpZWxkcygpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHN5bmNWZXJz\naW9uIGp1c3QgcmVwbGFjZWQgdGhlIHZlcnNpb24sIHJlc2V0IGl0CiAgICAg\nICAgICAgICAgICBpZiAoIXJlZnJlc2hBbGwgJiYgIWlzRW1iZWRkZWQoKSkK\nICAgICAgICAgICAgICAgICAgICBzZXRWZXJzaW9uKHZlcnNpb24pOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFBlcmZvcm0gc3RhdGUgdHJhbnNpdGlvbnMgYWZ0ZXIgcmVmcmVzaC4g\nVGhpcyBtZXRob2QgaXMgb25seQogICAgICogY2FsbGVkIGlmIHtAbGluayAj\nYmVmb3JlUmVmcmVzaH0gcmV0dXJucyB0cnVlLgogICAgICovCiAgICB2b2lk\nIGFmdGVyUmVmcmVzaCgpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gdHJhbnNpdGlvbiB0byBjbGVhbiBvciBub250\ncmFuc2FjdGlvbmFsIGRlcGVuZGluZyBvbiB0cmFucyBzdGF0dXMKICAgICAg\nICAgICAgaWYgKCFfYnJva2VyLmlzQWN0aXZlKCkpCiAgICAgICAgICAgICAg\nICBzZXRQQ1N0YXRlKF9zdGF0ZS5hZnRlck5vbnRyYW5zYWN0aW9uYWxSZWZy\nZXNoKCkpOwogICAgICAgICAgICBlbHNlIGlmIChfYnJva2VyLmdldE9wdGlt\naXN0aWMoKSkKICAgICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFm\ndGVyT3B0aW1pc3RpY1JlZnJlc2goKSk7CiAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgIHNldFBDU3RhdGUoX3N0YXRlLmFmdGVyUmVmcmVzaCgp\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIHRoaXMgb2Jq\nZWN0IGFzIGEgZGVyZWZlcmVuY2VkIGRlcGVuZGVudCBvYmplY3QuCiAgICAg\nKi8KICAgIHZvaWQgc2V0RGVyZWZlcmVuY2VkRGVwZW5kZW50KGJvb2xlYW4g\nZGVyZWYsIGJvb2xlYW4gbm90aWZ5KSB7CiAgICAgICAgaWYgKCFkZXJlZiAm\nJiAoX2ZsYWdzICYgRkxBR19ERVJFRikgPiAwKSB7CiAgICAgICAgICAgIGlm\nIChub3RpZnkpCiAgICAgICAgICAgICAgICBfYnJva2VyLnJlbW92ZURlcmVm\nZXJlbmNlZERlcGVuZGVudCh0aGlzKTsKICAgICAgICAgICAgX2ZsYWdzICY9\nIH5GTEFHX0RFUkVGOwogICAgICAgIH0gZWxzZSBpZiAoZGVyZWYgJiYgKF9m\nbGFncyAmIEZMQUdfREVSRUYpID09IDApIHsKICAgICAgICAgICAgX2ZsYWdz\nIHw9IEZMQUdfREVSRUY7CiAgICAgICAgICAgIGlmIChub3RpZnkpCiAgICAg\nICAgICAgICAgICBfYnJva2VyLmFkZERlcmVmZXJlbmNlZERlcGVuZGVudCh0\naGlzKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHZvaWQgc2V0RGVyZWZl\ncmVuY2VkRW1iZWREZXBlbmRlbnQoYm9vbGVhbiBkZXJlZikgewogICAgICAg\nIGlmICghZGVyZWYgJiYgKF9mbGFncyAmIEZMQUdfRU1CRURfREVSRUYpID4g\nMCkgewogICAgICAgICAgICBfZmxhZ3MgJj0gfkZMQUdfRU1CRURfREVSRUY7\nCiAgICAgICAgfSBlbHNlIGlmIChkZXJlZiAmJiAoX2ZsYWdzICYgRkxBR19F\nTUJFRF9ERVJFRikgPT0gMCkgewogICAgICAgICAgICBfZmxhZ3MgfD0gRkxB\nR19FTUJFRF9ERVJFRjsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBib29sZWFuIGdldERlcmVmZXJlbmNlZEVtYmVkRGVwZW5kZW50KCkgewog\nICAgICAgIHJldHVybiAoKF9mbGFncyAmIEZMQUdfRU1CRURfREVSRUYpID09\nIDAgPyBmYWxzZSA6IHRydWUpOwogICAgfQoKICAgIC8vLy8vLy8vLy8vCiAg\nICAvLyBMb2NraW5nCiAgICAvLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nTm90aWZpY2F0aW9uIHRoYXQgd2UndmUgYmVlbiByZWFkLWxvY2tlZC4gUGFz\ncyBpbiB0aGUgbGV2ZWwgYXQgd2hpY2gKICAgICAqIHdlIHdlcmUgbG9ja2Vk\nIGFuZCB0aGUgbGV2ZWwgYXQgd2hpY2ggd2Ugc2hvdWxkIHdyaXRlIGxvY2sg\nb3Vyc2VsdmVzCiAgICAgKiBvbiBkaXJ0eS4KICAgICAqLwogICAgdm9pZCBy\nZWFkTG9ja2VkKGludCByZWFkTG9ja0xldmVsLCBpbnQgd3JpdGVMb2NrTGV2\nZWwpIHsKICAgICAgICAvLyBtYWtlIHN1cmUgb2JqZWN0IGlzIGFkZGVkIHRv\nIHRyYW5zYWN0aW9uIHNvIGxvY2sgd2lsbCBnZXQKICAgICAgICAvLyBjbGVh\ncmVkIG9uIGNvbW1pdC9yb2xsYmFjawogICAgICAgIGlmIChyZWFkTG9ja0xl\ndmVsICE9IExvY2tMZXZlbHMuTE9DS19OT05FKQogICAgICAgICAgICB0cmFu\nc2FjdGlvbmFsKCk7CgogICAgICAgIF9yZWFkTG9ja0xldmVsID0gcmVhZExv\nY2tMZXZlbDsKICAgICAgICBfd3JpdGVMb2NrTGV2ZWwgPSB3cml0ZUxvY2tM\nZXZlbDsKICAgICAgICBfZmxhZ3MgfD0gRkxBR19SRUFEX0xPQ0tFRDsKICAg\nICAgICBfZmxhZ3MgJj0gfkZMQUdfV1JJVEVfTE9DS0VEOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJuIHRoZSBsb2NrIGxldmVsIHRvIHVzZSB3aGVu\nIGxvYWRpbmcgc3RhdGUuCiAgICAgKi8KICAgIHByaXZhdGUgaW50IGNhbGN1\nbGF0ZUxvY2tMZXZlbChib29sZWFuIGFjdGl2ZSwgYm9vbGVhbiBmb3JXcml0\nZSwKICAgICAgICBGZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gpIHsKICAgICAg\nICBpZiAoIWFjdGl2ZSkKICAgICAgICAgICAgcmV0dXJuIExvY2tMZXZlbHMu\nTE9DS19OT05FOwogICAgICAgIGlmIChmZXRjaCA9PSBudWxsKQogICAgICAg\nICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7\nCgogICAgICAgIGlmIChfcmVhZExvY2tMZXZlbCA9PSAtMSkKICAgICAgICAg\nICAgX3JlYWRMb2NrTGV2ZWwgPSBmZXRjaC5nZXRSZWFkTG9ja0xldmVsKCk7\nCiAgICAgICAgaWYgKF93cml0ZUxvY2tMZXZlbCA9PSAtMSkKICAgICAgICAg\nICAgX3dyaXRlTG9ja0xldmVsID0gZmV0Y2guZ2V0V3JpdGVMb2NrTGV2ZWwo\nKTsKICAgICAgICByZXR1cm4gKGZvcldyaXRlKSA/IF93cml0ZUxvY2tMZXZl\nbCA6IF9yZWFkTG9ja0xldmVsOwogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSBzdXJlIHdlJ3JlIGxvY2tlZCBhdCB0aGUgZ2l2ZW4gbGV2ZWwuCiAgICAg\nKi8KICAgIHByaXZhdGUgdm9pZCBvYnRhaW5Mb2Nrcyhib29sZWFuIGFjdGl2\nZSwgYm9vbGVhbiBmb3JXcml0ZSwgaW50IGxvY2tMZXZlbCwKICAgICAgICBG\nZXRjaENvbmZpZ3VyYXRpb24gZmV0Y2gsIE9iamVjdCBzZGF0YSkgewogICAg\nICAgIGlmICghYWN0aXZlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIGlmIHdlIGhhdmVuJ3QgYmVlbiBsb2NrZWQgeWV0LCBsb2NrIG5vdyBh\ndCB0aGUgZ2l2ZW4gbGV2ZWwKICAgICAgICBpbnQgZmxhZyA9IChmb3JXcml0\nZSkgPyBGTEFHX1dSSVRFX0xPQ0tFRCA6IEZMQUdfUkVBRF9MT0NLRUQ7CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBmbGFnKSA9PSAwKSB7CiAgICAgICAgICAg\nIC8vIG1ha2Ugc3VyZSBvYmplY3QgaXMgYWRkZWQgdG8gdHJhbnNhY3Rpb24g\nc28gbG9jayB3aWxsIGdldAogICAgICAgICAgICAvLyBjbGVhcmVkIG9uIGNv\nbW1pdC9yb2xsYmFjawogICAgICAgICAgICBpZiAobG9ja0xldmVsICE9IExv\nY2tMZXZlbHMuTE9DS19OT05FKQogICAgICAgICAgICAgICAgdHJhbnNhY3Rp\nb25hbCgpOwoKICAgICAgICAgICAgaWYgKGZldGNoID09IG51bGwpCiAgICAg\nICAgICAgICAgICBmZXRjaCA9IF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgICAgIF9icm9rZXIuZ2V0TG9ja01hbmFnZXIoKS5s\nb2NrKHRoaXMsIGxvY2tMZXZlbCwKICAgICAgICAgICAgICAgIGZldGNoLmdl\ndExvY2tUaW1lb3V0KCksIHNkYXRhKTsKICAgICAgICAgICAgX2ZsYWdzIHw9\nIEZMQUdfUkVBRF9MT0NLRUQ7CiAgICAgICAgICAgIF9mbGFncyB8PSBmbGFn\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgbG9j\na3MuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCByZWxlYXNlTG9ja3MoKSB7\nCiAgICAgICAgaWYgKF9sb2NrICE9IG51bGwpCiAgICAgICAgICAgIF9icm9r\nZXIuZ2V0TG9ja01hbmFnZXIoKS5yZWxlYXNlKHRoaXMpOwogICAgICAgIF9y\nZWFkTG9ja0xldmVsID0gLTE7CiAgICAgICAgX3dyaXRlTG9ja0xldmVsID0g\nLTE7CiAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1JFQURfTE9DS0VEOwogICAg\nICAgIF9mbGFncyAmPSB+RkxBR19XUklURV9MT0NLRUQ7CiAgICB9CgogICAg\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIFN0YXRlTWFuYWdlciBpbnRlcmZh\nY2UKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHdoZXRoZXIgb3Igbm90\nIHVubG9hZGVkIGZpZWxkcyBzaG91bGQgYmUgY2xvc2VkLgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBzZXJpYWxpemluZygpIHsKICAgICAgICAvLyBp\nZiB0aGUgYnJva2VyIGlzIGluIHRoZSBtaWRzdCBvZiBhIHNlcmlhbGl6YXRp\nb24sIHRoZW4gbm8gc3BlY2lhbAogICAgICAgIC8vIGhhbmRsaW5nIHNob3Vs\nZCBiZSBwZXJmb3JtZWQgb24gdGhlIGluc3RhbmNlLCBhbmQgbm8gc3Vic2Vx\ndWVudAogICAgICAgIC8vIGxvYWQgc2hvdWxkIGhhcHBlbgogICAgICAgIGlm\nIChfYnJva2VyLmlzU2VyaWFsaXppbmcoKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoX21ldGEu\naXNEZXRhY2hhYmxlKCkpCiAgICAgICAgICAgICAgICByZXR1cm4gRGV0YWNo\nTWFuYWdlci5wcmVTZXJpYWxpemUodGhpcyk7CgogICAgICAgICAgICBsb2Fk\nKF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCksIExPQURfU0VSSUFM\nSVpFLCBudWxsLCBudWxsLCAKICAgICAgICAgICAgICAgIGZhbHNlKTsKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gY2F0Y2ggKFJ1bnRp\nbWVFeGNlcHRpb24gcmUpIHsKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRl\nKHJlKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gd3Jp\ndGVEZXRhY2hlZChPYmplY3RPdXRwdXQgb3V0KQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgQml0U2V0IGlkeHMgPSBuZXcgQml0U2V0\nKF9tZXRhLmdldEZpZWxkcygpLmxlbmd0aCk7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gZGV0c20gPSBEZXRh\nY2hNYW5hZ2VyLndyaXRlRGV0YWNoZWRTdGF0ZSh0aGlzLCBvdXQsIGlkeHMp\nOwogICAgICAgICAgICBpZiAoZGV0c20pCiAgICAgICAgICAgICAgICBfZmxh\nZ3MgfD0gRkxBR19ERVRBQ0hJTkc7CgogICAgICAgICAgICBGaWVsZE1ldGFE\nYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGlmIChmbWRzW2ldLmlzVHJhbnNpZW50KCkpCiAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBwcm92aWRl\nRmllbGQoX3BjLCBfc2luZ2xlLCBpKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuc2VyaWFsaXplKG91dCwgIWlkeHMuZ2V0KGkpKTsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFH\nX0RFVEFDSElORzsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHByb3h5RGV0YWNoZWREZXNlcmlhbGl6\nZWQoaW50IGlkeCkgewogICAgICAgIC8vIHdlIGRvbid0IHNlcmlhbGl6ZSBz\ndGF0ZSBtYW5hZ2VyIGltcGxzCiAgICAgICAgdGhyb3cgbmV3IEludGVybmFs\nRXhjZXB0aW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNUcmFu\nc2FjdGlvbmFsKCkgewogICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgVENM\nRUFOLCB3aGljaCB3ZSB3YW50IHRvIGFwcGVhciBub24tdHJhbnMgdG8KICAg\nICAgICAvLyBpbnRlcm5hbCBjb2RlLCBidXQgd2hpY2ggcHVibGljbHkgc2hv\ndWxkIGJlIHRyYW5zYWN0aW9uYWwKICAgICAgICByZXR1cm4gX3N0YXRlID09\nIFBDU3RhdGUuVENMRUFOIHx8IF9zdGF0ZS5pc1RyYW5zYWN0aW9uYWwoKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1BlbmRpbmdUcmFuc2FjdGlv\nbmFsKCkgewogICAgICAgIHJldHVybiBfc3RhdGUuaXNQZW5kaW5nVHJhbnNh\nY3Rpb25hbCgpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUHJvdmlz\naW9uYWwoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0ZS5pc1Byb3Zpc2lvbmFs\nKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNQZXJzaXN0ZW50KCkg\newogICAgICAgIHJldHVybiBfc3RhdGUuaXNQZXJzaXN0ZW50KCk7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNOZXcoKSB7CiAgICAgICAgcmV0dXJu\nIF9zdGF0ZS5pc05ldygpOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlz\nRGVsZXRlZCgpIHsKICAgICAgICByZXR1cm4gX3N0YXRlLmlzRGVsZXRlZCgp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzRGlydHkoKSB7CiAgICAg\nICAgcmV0dXJuIF9zdGF0ZS5pc0RpcnR5KCk7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNEZXRhY2hlZCgpIHsKICAgICAgICByZXR1cm4gKF9mbGFn\ncyAmIEZMQUdfREVUQUNISU5HKSAhPSAwOwogICAgfQoKICAgIHB1YmxpYyBP\nYmplY3QgZ2V0R2VuZXJpY0NvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIF9i\ncm9rZXI7CiAgICB9CgogICAgcHVibGljIE9iamVjdCBmZXRjaE9iamVjdElk\nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChoYXNHZW5lcmF0\nZWRLZXkoKSAmJiBfc3RhdGUgaW5zdGFuY2VvZiBQTmV3U3RhdGUgJiYgCiAg\nICAgICAgICAgICAgICBfb2lkID09IG51bGwpIAogICAgICAgICAgICAgICAg\ncmV0dXJuIF9vaWQ7CiAgICAgICAgICAgIGFzc2lnbk9iamVjdElkKHRydWUp\nOwogICAgICAgICAgICBpZiAoX29pZCA9PSBudWxsIHx8ICFfYnJva2VyLmdl\ndENvbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgICAgIGdldENvbXBhdGli\naWxpdHlJbnN0YW5jZSgpLmdldENvcHlPYmplY3RJZHMoKSkKICAgICAgICAg\nICAgICAgIHJldHVybiBfb2lkOwoKICAgICAgICAgICAgaWYgKF9tZXRhLmdl\ndElkZW50aXR5VHlwZSgpID09IENsYXNzTWV0YURhdGEuSURfREFUQVNUT1JF\nKQogICAgICAgICAgICAgICAgcmV0dXJuIF9icm9rZXIuZ2V0U3RvcmVNYW5h\nZ2VyKCkuY29weURhdGFTdG9yZUlkKF9vaWQsIF9tZXRhKTsKICAgICAgICAg\nICAgcmV0dXJuIEFwcGxpY2F0aW9uSWRzLmNvcHkoX29pZCwgX21ldGEpOwog\nICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24gcmUpIHsKICAgICAg\nICAgICAgdGhyb3cgdHJhbnNsYXRlKHJlKTsKICAgICAgICB9CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNHZW5lcmF0ZWRLZXkoKSB7CiAg\nICAgICAgRmllbGRNZXRhRGF0YVtdIHBrRmllbGRzID0gX21ldGEuZ2V0UHJp\nbWFyeUtleUZpZWxkcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\ncGtGaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBrRmll\nbGRzW2ldLmdldFZhbHVlU3RyYXRlZ3koKSA9PSBWYWx1ZVN0cmF0ZWdpZXMu\nQVVUT0FTU0lHTikKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGlj\nIE9iamVjdCBnZXRQQ1ByaW1hcnlLZXkoT2JqZWN0IG9pZCwgaW50IGZpZWxk\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgT2JqZWN0IHBrID0gQXBwbGljYXRpb25JZHMu\nZ2V0KG9pZCwgZm1kKTsKICAgICAgICBpZiAocGsgPT0gbnVsbCkKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIENsYXNzTWV0YURhdGEgcmVs\nbWV0YSA9IGZtZC5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgpOwogICAgICAg\nIHBrID0gQXBwbGljYXRpb25JZHMud3JhcChyZWxtZXRhLCBwayk7CiAgICAg\nICAgaWYgKHJlbG1ldGEuZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRh\nRGF0YS5JRF9EQVRBU1RPUkUKICAgICAgICAgICAgJiYgZm1kLmdldE9iamVj\ndElkRmllbGRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5MT05HKQogICAgICAg\nICAgICBwayA9IF9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkubmV3RGF0YVN0\nb3JlSWQocGssIHJlbG1ldGEpOwogICAgICAgIGVsc2UgaWYgKHJlbG1ldGEu\nZ2V0SWRlbnRpdHlUeXBlKCkgPT0gQ2xhc3NNZXRhRGF0YS5JRF9BUFBMSUNB\nVElPTiAKICAgICAgICAgICAgJiYgZm1kLmdldE9iamVjdElkRmllbGRUeXBl\nKCkgIT0gcmVsbWV0YS5nZXRPYmplY3RJZFR5cGUoKSkKICAgICAgICAgICAg\ncGsgPSBBcHBsaWNhdGlvbklkcy5mcm9tUEtWYWx1ZXMobmV3IE9iamVjdFtd\nIHsgcGsgfSwgcmVsbWV0YSk7CiAgICAgICAgcmV0dXJuIF9icm9rZXIuZmlu\nZChwaywgZmFsc2UsIG51bGwpOwogICAgfQoKICAgIHB1YmxpYyBieXRlIHJl\ncGxhY2VGbGFncygpIHsKICAgICAgICAvLyB3ZSBhbHdheXMgdXNlIGxvYWQg\ncmVxdWlyZWQgc28gdGhhdCB3ZSBjYW4gZGV0ZWN0IHdoZW4gb2JqZWN0cwog\nICAgICAgIC8vIGFyZSB0b3VjaGVkIGZvciBsb2NraW5nIG9yIG1ha2luZyB0\ncmFuc2FjdGlvbmFsCiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlQ2FwYWJs\nZS5MT0FEX1JFUVVJUkVEOwogICAgfQoKICAgIHB1YmxpYyBTdGF0ZU1hbmFn\nZXIgcmVwbGFjZVN0YXRlTWFuYWdlcihTdGF0ZU1hbmFnZXIgc20pIHsKICAg\nICAgICByZXR1cm4gc207CiAgICB9CgogICAgcHVibGljIHZvaWQgYWNjZXNz\naW5nRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgLy8gcG9zc2libHkgY2hh\nbmdlIHN0YXRlCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmVmb3JlUmVh\nZChmaWVsZCk7CiAgICAgICAgICAgIGJlZm9yZUFjY2Vzc0ZpZWxkKGZpZWxk\nKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIHJlKSB7CiAg\nICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2ZW4gZmllbGQgYmVmb3Jl\nIGFjY2Vzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYmVmb3JlQWNj\nZXNzRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGJvb2xlYW4gYWN0aXZlID0gX2Jyb2tlci5p\nc0FjdGl2ZSgpOwogICAgICAgICAgICBpbnQgbG9ja0xldmVsID0gY2FsY3Vs\nYXRlTG9ja0xldmVsKGFjdGl2ZSwgZmFsc2UsIG51bGwpOwogICAgICAgICAg\nICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxv\nYWRGaWVsZChmaWVsZCwgbG9ja0xldmVsLCBmYWxzZSwgdHJ1ZSk7CiAgICAg\nICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGFzc2lnbkZpZWxkKGZpZWxk\nLCBmYWxzZSk7CiAgICAgICAgICAgIG9idGFpbkxvY2tzKGFjdGl2ZSwgZmFs\nc2UsIGxvY2tMZXZlbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFu\nc2xhdGUocmUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkaXJ0\neShTdHJpbmcgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9\nIF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoZm1kID09IG51\nbGwpCiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShuZXcgVXNlckV4Y2Vw\ndGlvbihfbG9jLmdldCgibm8tZmllbGQiLCBmaWVsZCwKICAgICAgICAgICAg\nICAgIEltcGxIZWxwZXIuZ2V0TWFuYWdlZEluc3RhbmNlKF9wYykuZ2V0Q2xh\nc3MoKSkpCiAgICAgICAgICAgICAgICAuc2V0RmFpbGVkT2JqZWN0KGdldE1h\nbmFnZWRJbnN0YW5jZSgpKSk7CgogICAgICAgIGRpcnR5KGZtZC5nZXRJbmRl\neCgpLCBudWxsLCB0cnVlKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBkaXJ0\neShpbnQgZmllbGQpIHsKICAgICAgICBkaXJ0eShmaWVsZCwgbnVsbCwgdHJ1\nZSk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzRW1iZWRkZWROb3RV\ncGRhdGFibGUoKSB7CiAgICAgICAgLy8gZW1iZWRkYWJsZSBvYmplY3QgcmV0\ndXJuZWQgZnJvbSBxdWVyeSByZXN1bHQgaXMgbm90IHVwdGFibGUKICAgICAg\nICByZXR1cm4gKF9vd25lciA9PSBudWxsICYmIF9vd25lcklkICE9IG51bGwp\nOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZSB0aGUgZ2l2ZW4gZmllbGQg\nZGlydHkuCiAgICAgKgogICAgICogQHBhcmFtIG11dGF0ZSBpZiBudWxsLCBt\nYXkgYmUgYW4gU0NPIG11dGF0aW9uOyBpZiB0cnVlLCBpcyBjZXJ0YWlubHkK\nICAgICAqIGEgbXV0YXRpb24gKG9yIGF0IGxlYXN0IHRyZWF0IGFzIG9uZSkK\nICAgICAqIEByZXR1cm4ge0BsaW5rIEJvb2xlYW4jRkFMU0V9IGlmIHRoaXMg\naW5zdGFuY2Ugd2FzIGFscmVhZHkgZGlydHksCiAgICAgKiA8Y29kZT5udWxs\nPC9jb2RlPiBpZiBpdCB3YXMgZGlydHkgYnV0IG5vdCBzaW5jZSBmbHVzaCwg\nYW5kCiAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBpZiBpdCB3YXMgbm90\nIGRpcnR5CiAgICAgKi8KICAgIHByaXZhdGUgQm9vbGVhbiBkaXJ0eShpbnQg\nZmllbGQsIEJvb2xlYW4gbXV0YXRlLCBib29sZWFuIGxvYWRGZXRjaEdyb3Vw\nKSB7CiAgICAgICAgYm9vbGVhbiBsb2NrZWQgPSBmYWxzZTsKICAgICAgICBi\nb29sZWFuIG5ld0ZsdXNoID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBjbGVh\nbiA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpZWxkTWV0\nYURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgICAg\nICBpZiAoIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRhdGVTdHJh\ndGVnaWVzLlJFU1RSSUNUKQogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkU3RhdGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAg\nICAgICAgICAgICAgKCJ1cGRhdGUtcmVzdHJpY3QiLCBmbWQpKTsKICAgICAg\nICAgICAgICAgIGlmIChmbWQuZ2V0VXBkYXRlU3RyYXRlZ3koKSA9PSBVcGRh\ndGVTdHJhdGVnaWVzLklHTk9SRSkKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gQm9vbGVhbi5GQUxTRTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKGlzRW1iZWRkZWQoKSkgewogICAgICAgICAgICAgICAgaWYgKGlzRW1i\nZWRkZWROb3RVcGRhdGFibGUoKSkKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgVXNlckV4Y2VwdGlvbihfbG9jLmdldAogICAgICAgICAgICAgICAg\nICAgICAgICAoImNhbnQtdXBkYXRlLWVtYmVkLWluLXF1ZXJ5LXJlc3VsdCIp\nKS5zZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgKGdl\ndE1hbmFnZWRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAg\nICAgICAgICAgICAgICAgICAvLyBub3RpZnkgb3duZXIgb2YgY2hhbmdlCiAg\nICAgICAgICAgICAgICAgICAgX293bmVyLmRpcnR5KF9vd25lckluZGV4LCBC\nb29sZWFuLlRSVUUsIGxvYWRGZXRjaEdyb3VwKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gaXMgdGhpcyBhIGRpcmVjdCBtdXRhdGlvbiBvZiBh\nbiBzY28gZmllbGQ/CiAgICAgICAgICAgIGlmIChtdXRhdGUgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgc3dpdGNoIChmbWQuZ2V0RGVjbGFyZWRUeXBl\nQ29kZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nQ09MTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBl\ncy5NQVA6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQVJS\nQVk6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToK\nICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5DQUxFTkRBUjoK\nICAgICAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5PQkpFQ1Q6CiAg\nICAgICAgICAgICAgICAgICAgICAgIG11dGF0ZSA9IEJvb2xlYW4uVFJVRTsK\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSBKYXZhVHlwZXMuUEM6CiAgICAgICAgICAgICAgICAgICAg\nICAgIG11dGF0ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZm1k\nLmlzRW1iZWRkZWQoKSkgPyBCb29sZWFuLlRSVUUgOiBCb29sZWFuLkZBTFNF\nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBtdXRh\ndGUgPSBCb29sZWFuLkZBTFNFOyAvLyBub3Qgc2NvCiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHBvc3NpYmx5IGNo\nYW5nZSBzdGF0ZQogICAgICAgICAgICBib29sZWFuIGFjdGl2ZSA9IF9icm9r\nZXIuaXNBY3RpdmUoKTsKICAgICAgICAgICAgY2xlYW4gPSAhX3N0YXRlLmlz\nRGlydHkoKTsgLy8gaW50ZW50aW9uYWwgZGlyZWN0IGFjY2VzcwoKICAgICAg\nICAgICAgLy8gZmlyZSBldmVudCBmYXN0IGJlZm9yZSBzdGF0ZSBjaGFuZ2Uu\nCiAgICAgICAgICAgIGlmIChjbGVhbikKICAgICAgICAgICAgICAgIGZpcmVM\naWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5CRUZPUkVfRElSVFkpOwog\nICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgICBpZiAo\nX2Jyb2tlci5nZXRPcHRpbWlzdGljKCkpCiAgICAgICAgICAgICAgICAgICAg\nc2V0UENTdGF0ZShfc3RhdGUuYmVmb3JlT3B0aW1pc3RpY1dyaXRlKHRoaXMs\nIGZpZWxkLAogICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGUuYm9vbGVh\nblZhbHVlKCkpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAg\nICAgICAgICBzZXRQQ1N0YXRlKF9zdGF0ZS5iZWZvcmVXcml0ZSh0aGlzLCBm\naWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5W\nYWx1ZSgpKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm1kLmdldE1hbmFn\nZW1lbnQoKSA9PSBGaWVsZE1ldGFEYXRhLk1BTkFHRV9QRVJTSVNURU5UKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaXNQZXJzaXN0ZW50KCkgJiYgIV9icm9r\nZXIuZ2V0Tm9udHJhbnNhY3Rpb25hbFdyaXRlKCkpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEludmFsaWRTdGF0ZUV4Y2VwdGlvbihfbG9jLmdl\ndAogICAgICAgICAgICAgICAgICAgICAgICAoIm5vbi10cmFucy13cml0ZSIp\nKS5zZXRGYWlsZWRPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgKGdl\ndE1hbmFnZWRJbnN0YW5jZSgpKTsKCiAgICAgICAgICAgICAgICBzZXRQQ1N0\nYXRlKF9zdGF0ZS5iZWZvcmVOb250cmFuc2FjdGlvbmFsV3JpdGUodGhpcywg\nZmllbGQsCiAgICAgICAgICAgICAgICAgICAgbXV0YXRlLmJvb2xlYW5WYWx1\nZSgpKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoX2ZsYWdz\nICYgRkxBR19GTFVTSEVEKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBuZXdG\nbHVzaCA9IChfZmxhZ3MgJiBGTEFHX0ZMVVNIRURfRElSVFkpID09IDA7CiAg\nICAgICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19GTFVTSEVEX0RJUlRZOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NrKCk7CiAgICAgICAgICAg\nIGxvY2tlZCA9IHRydWU7CgogICAgICAgICAgICAvLyBub3RlIHRoYXQgdGhl\nIGZpZWxkIGlzIGluIG5lZWQgb2YgZmx1c2hpbmcgYWdhaW4sIGFuZCB0ZWxs\nIHRoZQogICAgICAgICAgICAvLyBicm9rZXIgdG9vCiAgICAgICAgICAgIF9m\nbHVzaC5jbGVhcihmaWVsZCk7CiAgICAgICAgICAgIF9icm9rZXIuc2V0RGly\ndHkodGhpcywgbmV3Rmx1c2ggJiYgIWNsZWFuKTsKCiAgICAgICAgICAgIC8v\nIHNhdmUgdGhlIGZpZWxkIGZvciByb2xsYmFjayBpZiBuZWVkZWQKICAgICAg\nICAgICAgc2F2ZUZpZWxkKGZpZWxkKTsKCiAgICAgICAgICAgIC8vIGRpcnR5\nIHRoZSBmaWVsZCBhbmQgbWFyayBsb2FkZWQ7IGxvYWQgZmV0Y2ggZ3JvdXAg\naWYgbmVlZGVkCiAgICAgICAgICAgIGludCBsb2NrTGV2ZWwgPSBjYWxjdWxh\ndGVMb2NrTGV2ZWwoYWN0aXZlLCB0cnVlLCBudWxsKTsKICAgICAgICAgICAg\naWYgKCFfZGlydHkuZ2V0KGZpZWxkKSkgewogICAgICAgICAgICAgICAgc2V0\nTG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgICAgIF9kaXJ0eS5z\nZXQoZmllbGQpOwoKICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUg\nZmllbGQncyBmZXRjaCBncm91cCBpcyBsb2FkZWQKICAgICAgICAgICAgICAg\nIGlmIChsb2FkRmV0Y2hHcm91cCAmJiBpc1BlcnNpc3RlbnQoKQogICAgICAg\nICAgICAgICAgICAgICYmIGZtZC5nZXRNYW5hZ2VtZW50KCkgPT0gZm1kLk1B\nTkFHRV9QRVJTSVNURU5UKQogICAgICAgICAgICAgICAgICAgIGxvYWRGaWVs\nZChmaWVsZCwgbG9ja0xldmVsLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBvYnRhaW5Mb2NrcyhhY3RpdmUsIHRydWUsIGxvY2tM\nZXZlbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4\nY2VwdGlvbiByZSkgewogICAgICAgICAgICB0aHJvdyB0cmFuc2xhdGUocmUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsb2NrZWQp\nCiAgICAgICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CgogICAgICAg\nIGlmIChjbGVhbikKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4uVFJVRTsK\nICAgICAgICBpZiAobmV3Rmx1c2gpIHsKICAgICAgICAgICAgLy8gdGhpcyBl\ndmVudCBjYW4gYmUgZmlyZWQgbGF0ZXIgY2F1c2Ugd2UncmUgYWxyZWFkeSBk\naXJ0eS4KICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNs\nZUV2ZW50LkJFRk9SRV9ESVJUWV9GTFVTSEVEKTsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBCb29sZWFuLkZB\nTFNFOwogICAgfQoKICAgIC8qKgogICAgICogRmlyZSBwb3N0LWRpcnR5IGV2\nZW50cyBhZnRlciBmaWVsZCB2YWx1ZSBjaGFuZ2VzLgogICAgICoKICAgICAq\nIEBwYXJhbSBzdGF0dXMgcmV0dXJuIHZhbHVlIGZyb20ge0BsaW5rICNkaXJ0\neShpbnQsIEJvb2xlYW4sIGJvb2xlYW4pfQogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgcG9zdERpcnR5KEJvb2xlYW4gc3RhdHVzKSB7CiAgICAgICAgaWYg\nKEJvb2xlYW4uVFJVRS5lcXVhbHMoc3RhdHVzKSkKICAgICAgICAgICAgZmly\nZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZKTsK\nICAgICAgICBlbHNlIGlmIChzdGF0dXMgPT0gbnVsbCkKICAgICAgICAgICAg\nZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkFGVEVSX0RJUlRZ\nX0ZMVVNIRUQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZWQoaW50\nIGZpZWxkLCBPYmplY3QgcmVtb3ZlZCwgYm9vbGVhbiBrZXkpIHsKICAgICAg\nICBpZiAocmVtb3ZlZCA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGRlcmVmZXJlbmNlIGRlcGVu\nZGVudCBmaWVsZHMsIGRlbGV0ZSBlbWJlZGRlZAogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAg\nICAgICAgVmFsdWVNZXRhRGF0YSB2bWQgPSAoa2V5KSA/IGZtZC5nZXRLZXko\nKSA6IGZtZC5nZXRFbGVtZW50KCk7CiAgICAgICAgICAgIGlmICh2bWQuaXNF\nbWJlZGRlZFBDKCkpCiAgICAgICAgICAgICAgICBfc2luZ2xlLmRlbGV0ZSh2\nbWQsIHJlbW92ZWQsIG51bGwpOwogICAgICAgICAgICBlbHNlIGlmICh2bWQu\nZ2V0Q2FzY2FkZURlbGV0ZSgpID09IFZhbHVlTWV0YURhdGEuQ0FTQ0FERV9B\nVVRPKQogICAgICAgICAgICAgICAgX3NpbmdsZS5kZXJlZmVyZW5jZURlcGVu\nZGVudChyZW1vdmVkKTsKICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0\naW9uIHJlKSB7CiAgICAgICAgICAgIHRocm93IHRyYW5zbGF0ZShyZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgbmV3UHJveHkoaW50\nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgcmV0dXJuIG5ld0ZpZWxkUHJveHkoZmllbGQp\nOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXRUeXBlQ29kZSgpKSB7CiAgICAg\nICAgICAgIGNhc2UgSmF2YVR5cGVzLkRBVEU6CiAgICAgICAgICAgICAgICBp\nZiAoZm1kLmdldERlY2xhcmVkVHlwZSgpID09IGphdmEuc3FsLkRhdGUuY2xh\nc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBqYXZhLnNxbC5E\nYXRlKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAgICAgICAg\nICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkgPT0gamF2YS5zcWwuVGlt\nZXN0YW1wLmNsYXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcg\namF2YS5zcWwuVGltZXN0YW1wKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nKTsKICAgICAgICAgICAgICAgIGlmIChmbWQuZ2V0RGVjbGFyZWRUeXBlKCkg\nPT0gamF2YS5zcWwuVGltZS5jbGFzcykKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IGphdmEuc3FsLlRpbWUoU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNBTEVOREFSOgogICAgICAgICAg\nICAgICAgcmV0dXJuIENhbGVuZGFyLmdldEluc3RhbmNlKCk7CiAgICAgICAg\nICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJT046CiAgICAgICAgICAgICAg\nICByZXR1cm4gbmV3IEFycmF5TGlzdCgpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hN\nYXAoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cgog\nICAgcHVibGljIE9iamVjdCBuZXdGaWVsZFByb3h5KGludCBmaWVsZCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIFByb3h5TWFuYWdlciBtZ3IgPSBfYnJva2VyLmdldENv\nbmZpZ3VyYXRpb24oKS4KICAgICAgICAgICAgZ2V0UHJveHlNYW5hZ2VySW5z\ndGFuY2UoKTsKICAgICAgICBPYmplY3QgaW5pdCA9IGZtZC5nZXRJbml0aWFs\naXplcigpOwoKICAgICAgICBzd2l0Y2ggKGZtZC5nZXREZWNsYXJlZFR5cGVD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuREFURToKICAg\nICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3RGF0ZVByb3h5KGZtZC5nZXRE\nZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNB\nTEVOREFSOgogICAgICAgICAgICAgICAgcmV0dXJuIG1nci5uZXdDYWxlbmRh\nclByb3h5KGZtZC5nZXREZWNsYXJlZFR5cGUoKSwKICAgICAgICAgICAgICAg\nICAgICBpbml0IGluc3RhbmNlb2YgVGltZVpvbmUgPyAoVGltZVpvbmUpIGlu\naXQgOiBudWxsKTsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuQ09MTEVD\nVElPTjoKICAgICAgICAgICAgICAgIHJldHVybiBtZ3IubmV3Q29sbGVjdGlv\nblByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICBmbWQuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZSgpLAogICAgICAg\nICAgICAgICAgICAgIGluaXQgaW5zdGFuY2VvZiBDb21wYXJhdG9yID8gKENv\nbXBhcmF0b3IpIGluaXQgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAg\nICBfYnJva2VyLmdldENvbmZpZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5\nSW5zdGFuY2UoKS5nZXRBdXRvT2ZmKCkpOwogICAgICAgICAgICBjYXNlIEph\ndmFUeXBlcy5NQVA6CiAgICAgICAgICAgICAgICByZXR1cm4gbWdyLm5ld01h\ncFByb3h5KGZtZC5nZXRQcm94eVR5cGUoKSwKICAgICAgICAgICAgICAgICAg\nICBmbWQuZ2V0S2V5KCkuZ2V0RGVjbGFyZWRUeXBlKCksCiAgICAgICAgICAg\nICAgICAgICAgZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGUoKSwK\nICAgICAgICAgICAgICAgICAgICBpbml0IGluc3RhbmNlb2YgQ29tcGFyYXRv\nciA/IChDb21wYXJhdG9yKSBpbml0IDogbnVsbCwKICAgICAgICAgICAgICAg\nICAgICAgICAgX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0Q29tcGF0\naWJpbGl0eUluc3RhbmNlKCkuZ2V0QXV0b09mZigpKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\naXNEZWZhdWx0VmFsdWUoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICBib29sZWFuIHJldCA9IF9zaW5nbGUuaXNEZWZhdWx0VmFs\ndWUoKTsKICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAg\nICByZXR1cm4gcmV0OwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8K\nICAgIC8vIFJlY29yZCB0aGF0IHRoZSBmaWVsZCBpcyBkaXJ0eSAod2hpY2gg\nbWlnaHQgbG9hZCBERkcpCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMg\ndm9pZCBzZXR0aW5nQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIGJvb2xlYW4gY3VyVmFsLCBib29sZWFu\nIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0gU0VUX1JF\nTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZhbCAmJiBf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAg\nICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xlYW4uRkFM\nU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5nbGUuc3Rv\ncmVCb29sZWFuRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBw\nb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldHRpbmdCeXRlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQg\nZmllbGQsCiAgICAgICAgYnl0ZSBjdXJWYWwsIGJ5dGUgbmV3VmFsLCBpbnQg\nc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAg\nICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQuZ2V0KGZp\nZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYXNz\nZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9CgogICAg\nICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29sZWFu\nIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0ID09IFNF\nVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZUJ5dGVGaWVsZChm\naWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKHBjLCBf\nc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0eShzdGF0KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGluZ0NoYXJGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBj\naGFyIGN1clZhbCwgY2hhciBuZXdWYWwsIGludCBzZXQpIHsKICAgICAgICBp\nZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYgKG5ld1Zh\nbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1hcnlLZXlD\naGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZp\nZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwogICAgICAg\nICAgICBfc2luZ2xlLnN0b3JlQ2hhckZpZWxkKGZpZWxkLCBuZXdWYWwpOwog\nICAgICAgICAgICByZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgcG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzZXR0aW5nRG91YmxlRmllbGQoUGVyc2lzdGVuY2VD\nYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgZG91YmxlIGN1clZhbCwg\nZG91YmxlIG5ld1ZhbCwgaW50IHNldCkgewogICAgICAgIGlmIChzZXQgIT0g\nU0VUX1JFTU9URSkgewogICAgICAgICAgICBpZiAobmV3VmFsID09IGN1clZh\nbCAmJiBfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIGFzc2VydE5vUHJpbWFyeUtleUNoYW5nZShmaWVs\nZCk7CiAgICAgICAgfQoKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgQm9vbGVhbiBzdGF0ID0gZGlydHkoZmllbGQsIEJvb2xl\nYW4uRkFMU0UsIHNldCA9PSBTRVRfVVNFUik7CiAgICAgICAgICAgIF9zaW5n\nbGUuc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAg\nICAgcmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAg\nICAgIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc2V0dGluZ0Zsb2F0RmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBj\nLCBpbnQgZmllbGQsCiAgICAgICAgZmxvYXQgY3VyVmFsLCBmbG9hdCBuZXdW\nYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUp\nIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRl\nZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICBhc3NlcnROb1ByaW1hcnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAg\nIH0KCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIEJvb2xlYW4gc3RhdCA9IGRpcnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBz\nZXQgPT0gU0VUX1VTRVIpOwogICAgICAgICAgICBfc2luZ2xlLnN0b3JlRmxv\nYXRGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHBvc3REaXJ0\neShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0dGlu\nZ0ludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAog\nICAgICAgIGludCBjdXJWYWwsIGludCBuZXdWYWwsIGludCBzZXQpIHsKICAg\nICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUpIHsKICAgICAgICAgICAgaWYg\nKG5ld1ZhbCA9PSBjdXJWYWwgJiYgX2xvYWRlZC5nZXQoZmllbGQpKQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhc3NlcnROb1ByaW1h\ncnlLZXlDaGFuZ2UoZmllbGQpOwogICAgICAgIH0KCiAgICAgICAgbG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2xlYW4gc3RhdCA9IGRp\ncnR5KGZpZWxkLCBCb29sZWFuLkZBTFNFLCBzZXQgPT0gU0VUX1VTRVIpOwog\nICAgICAgICAgICBfc2luZ2xlLnN0b3JlSW50RmllbGQoZmllbGQsIG5ld1Zh\nbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdMb25nRmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgbG9uZyBjdXJWYWws\nIGxvbmcgbmV3VmFsLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBT\nRVRfUkVNT1RFKSB7CiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFs\nICYmIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxk\nKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVh\nbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3Npbmds\nZS5zdG9yZUxvbmdGaWVsZChmaWVsZCwgbmV3VmFsKTsKICAgICAgICAgICAg\ncmVwbGFjZUZpZWxkKHBjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHBvc3REaXJ0eShzdGF0KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0dGluZ09iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwsIE9iamVjdCBuZXdW\nYWwsIGludCBzZXQpIHsKICAgICAgICBpZiAoc2V0ICE9IFNFVF9SRU1PVEUp\nIHsKICAgICAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVs\nZCkpIHsKICAgICAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsKQog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAv\nLyBvbmx5IGNvbXBhcmUgbmV3IHRvIG9sZCB2YWx1ZXMgaWYgdGhlIGNvbXBh\ncmlzb24gaXMgZ29pbmcgdG8KICAgICAgICAgICAgICAgIC8vIGJlIGNoZWFw\nIC0tIGRvbid0IGNvbXBhcmUgY29sbGVjdGlvbnMsIG1hcHMsIFVEVHMKICAg\nICAgICAgICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xhcmVkVHlwZUNvZGUo\nKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkFSUkFZ\nOgogICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNPTExFQ1RJ\nT046CiAgICAgICAgICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTUFQOgog\nICAgICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDOgogICAgICAg\nICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlBDX1VOVFlQRUQ6CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWwg\nIT0gbnVsbCAmJiBuZXdWYWwuZXF1YWxzKGN1clZhbCkpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlz\nIGlzIGEgZGVwZW5kZW50IHVubG9hZGVkIGZpZWxkLCBtYWtlIHN1cmUgdG8g\nbG9hZAogICAgICAgICAgICAgICAgLy8gaXQgbm93CiAgICAgICAgICAgICAg\nICBpZiAoZm1kLmdldENhc2NhZGVEZWxldGUoKSA9PSBWYWx1ZU1ldGFEYXRh\nLkNBU0NBREVfQVVUTwogICAgICAgICAgICAgICAgICAgIHx8IGZtZC5nZXRL\nZXkoKS5nZXRDYXNjYWRlRGVsZXRlKCkKICAgICAgICAgICAgICAgICAgICA9\nPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfQVVUTwogICAgICAgICAgICAgICAg\nICAgIHx8IGZtZC5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAg\nICAgICAgICAgICAgICAgICAgPT0gVmFsdWVNZXRhRGF0YS5DQVNDQURFX0FV\nVE8pCiAgICAgICAgICAgICAgICAgICAgY3VyVmFsID0gZmV0Y2hPYmplY3RG\naWVsZChmaWVsZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzc2Vy\ndE5vUHJpbWFyeUtleUNoYW5nZShmaWVsZCk7CiAgICAgICAgICAgIGlmIChm\nbWQuZ2V0RGVjbGFyZWRUeXBlQ29kZSgpID09IEphdmFUeXBlcy5PSUQpCiAg\nICAgICAgICAgICAgICBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQobmV3VmFs\nKTsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVh\nbi5GQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgaWYgKHNl\ndCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAgICAgICAgICBfc2luZ2xlLnN0\nb3JlT2JqZWN0RmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAgICAgICAgICAg\nICBfc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\nZGVyZWZlcmVuY2VEZXBlbmRlbnQoKTsKICAgICAgICAgICAgICAgIF9zaW5n\nbGUuY2xlYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfc2luZ2xl\nLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAg\nIHJlcGxhY2VGaWVsZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAg\nICBwb3N0RGlydHkoc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNldHRpbmdTaG9ydEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywg\naW50IGZpZWxkLAogICAgICAgIHNob3J0IGN1clZhbCwgc2hvcnQgbmV3VmFs\nLCBpbnQgc2V0KSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7\nCiAgICAgICAgICAgIGlmIChuZXdWYWwgPT0gY3VyVmFsICYmIF9sb2FkZWQu\nZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsKICAgICAgICB9\nCgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBC\nb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5GQUxTRSwgc2V0\nID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5zdG9yZVNob3J0\nRmllbGQoZmllbGQsIG5ld1ZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVs\nZChwYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICBwb3N0RGlydHko\nc3RhdCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldHRpbmdT\ndHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCwK\nICAgICAgICBTdHJpbmcgY3VyVmFsLCBTdHJpbmcgbmV3VmFsLCBpbnQgc2V0\nKSB7CiAgICAgICAgaWYgKHNldCAhPSBTRVRfUkVNT1RFKSB7CiAgICAgICAg\nICAgIGlmIChTdHJpbmdVdGlscy5lcXVhbHMobmV3VmFsLCBjdXJWYWwpICYm\nIF9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgYXNzZXJ0Tm9QcmltYXJ5S2V5Q2hhbmdlKGZpZWxkKTsK\nICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBCb29sZWFuIHN0YXQgPSBkaXJ0eShmaWVsZCwgQm9vbGVhbi5G\nQUxTRSwgc2V0ID09IFNFVF9VU0VSKTsKICAgICAgICAgICAgX3NpbmdsZS5z\ndG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBuZXdWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQocGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncG9zdERpcnR5KHN0YXQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIERpc2FsbG93cyBjaGFuZ2luZyBwcmltYXJ5IGtleSBmaWVsZHMgZm9yIGlu\nc3RhbmNlcy4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFzc2VydE5vUHJp\nbWFyeUtleUNoYW5nZShpbnQgZmllbGQpIHsKICAgICAgICBpZiAoX29pZCAh\nPSBudWxsICYmIF9tZXRhLmdldEZpZWxkKGZpZWxkKS5pc1ByaW1hcnlLZXko\nKSkKICAgICAgICAgICAgdGhyb3cgdHJhbnNsYXRlKG5ldyBJbnZhbGlkU3Rh\ndGVFeGNlcHRpb24oX2xvYy5nZXQKICAgICAgICAgICAgICAgICgiY2hhbmdl\nLWlkZW50aXR5IikpLnNldEZhaWxlZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFu\nY2UoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogRGlzYWxsb3dzIHNldHRp\nbmcgYW4gb2JqZWN0IGlkIGZpZWxkIHRvIGEgbWFuYWdlZCBpbnN0YW5jZS4K\nICAgICAqLwogICAgdm9pZCBhc3NlcnROb3RNYW5hZ2VkT2JqZWN0SWQoT2Jq\nZWN0IHZhbCkgewogICAgICAgIGlmICh2YWwgIT0gbnVsbAogICAgICAgICAg\nICAmJiAoSW1wbEhlbHBlci50b1BlcnNpc3RlbmNlQ2FwYWJsZSh2YWwsCiAg\nICAgICAgICAgICAgICAgZ2V0Q29udGV4dCgpLmdldENvbmZpZ3VyYXRpb24o\nKSkpLnBjR2V0R2VuZXJpY0NvbnRleHQoKSE9IG51bGwpCiAgICAgICAgICAg\nIHRocm93IHRyYW5zbGF0ZShuZXcgSW52YWxpZFN0YXRlRXhjZXB0aW9uKF9s\nb2MuZ2V0CiAgICAgICAgICAgICAgICAoIm1hbmFnZWQtb2lkIiwgRXhjZXB0\naW9ucy50b1N0cmluZyh2YWwpLAogICAgICAgICAgICAgICAgICAgIEV4Y2Vw\ndGlvbnMudG9TdHJpbmcoZ2V0TWFuYWdlZEluc3RhbmNlKCkpKSkuCiAgICAg\nICAgICAgICAgICBzZXRGYWlsZWRPYmplY3QoZ2V0TWFuYWdlZEluc3RhbmNl\nKCkpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nCiAgICAvLyBEZWxlZ2F0ZSB0byBGaWVsZE1hbmFnZXIKICAgIC8vLy8vLy8v\nLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRl\nZEJvb2xlYW5GaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVs\nZCwKICAgICAgICBib29sZWFuIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9y\nZUJvb2xlYW5GaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBwcm92aWRlZEJ5dGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUg\ncGMsIGludCBmaWVsZCwKICAgICAgICBieXRlIGN1clZhbCkgewogICAgICAg\nIF9mbS5zdG9yZUJ5dGVGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBwcm92aWRlZENoYXJGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIGludCBmaWVsZCwKICAgICAgICBjaGFyIGN1clZhbCkgewog\nICAgICAgIF9mbS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZERvdWJsZUZpZWxkKFBlcnNp\nc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIGRvdWJsZSBj\ndXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwg\nY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZEZsb2F0\nRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAg\nICAgZmxvYXQgY3VyVmFsKSB7CiAgICAgICAgX2ZtLnN0b3JlRmxvYXRGaWVs\nZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92\naWRlZEludEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nLAogICAgICAgIGludCBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVJbnRG\naWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBw\ncm92aWRlZExvbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCwKICAgICAgICBsb25nIGN1clZhbCkgewogICAgICAgIF9mbS5zdG9y\nZUxvbmdGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBwcm92aWRlZE9iamVjdEZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBw\nYywgaW50IGZpZWxkLAogICAgICAgIE9iamVjdCBjdXJWYWwpIHsKICAgICAg\nICBfZm0uc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFNob3J0RmllbGQoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQsCiAgICAgICAgc2hvcnQgY3VyVmFs\nKSB7CiAgICAgICAgX2ZtLnN0b3JlU2hvcnRGaWVsZChmaWVsZCwgY3VyVmFs\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcm92aWRlZFN0cmluZ0ZpZWxk\nKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkLAogICAgICAgIFN0\ncmluZyBjdXJWYWwpIHsKICAgICAgICBfZm0uc3RvcmVTdHJpbmdGaWVsZChm\naWVsZCwgY3VyVmFsKTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiByZXBs\nYWNlQm9vbGVhbkZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZp\nZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaEJvb2xlYW5GaWVsZChm\naWVsZCk7CiAgICB9CgogICAgcHVibGljIGJ5dGUgcmVwbGFjZUJ5dGVGaWVs\nZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAg\nIHJldHVybiBfZm0uZmV0Y2hCeXRlRmllbGQoZmllbGQpOwogICAgfQoKICAg\nIHB1YmxpYyBjaGFyIHJlcGxhY2VDaGFyRmllbGQoUGVyc2lzdGVuY2VDYXBh\nYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICByZXR1cm4gX2ZtLmZldGNo\nQ2hhckZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIHJl\ncGxhY2VEb3VibGVGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGludCBm\naWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hEb3VibGVGaWVsZChm\naWVsZCk7CiAgICB9CgogICAgcHVibGljIGZsb2F0IHJlcGxhY2VGbG9hdEZp\nZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAg\nICAgcmV0dXJuIF9mbS5mZXRjaEZsb2F0RmllbGQoZmllbGQpOwogICAgfQoK\nICAgIHB1YmxpYyBpbnQgcmVwbGFjZUludEZpZWxkKFBlcnNpc3RlbmNlQ2Fw\nYWJsZSBwYywgaW50IGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRj\naEludEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyByZXBs\nYWNlTG9uZ0ZpZWxkKFBlcnNpc3RlbmNlQ2FwYWJsZSBwYywgaW50IGZpZWxk\nKSB7CiAgICAgICAgcmV0dXJuIF9mbS5mZXRjaExvbmdGaWVsZChmaWVsZCk7\nCiAgICB9CgogICAgcHVibGljIE9iamVjdCByZXBsYWNlT2JqZWN0RmllbGQo\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBpbnQgZmllbGQpIHsKICAgICAgICBy\nZXR1cm4gX2ZtLmZldGNoT2JqZWN0RmllbGQoZmllbGQpOwogICAgfQoKICAg\nIHB1YmxpYyBzaG9ydCByZXBsYWNlU2hvcnRGaWVsZChQZXJzaXN0ZW5jZUNh\ncGFibGUgcGMsIGludCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0\nY2hTaG9ydEZpZWxkKGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5n\nIHJlcGxhY2VTdHJpbmdGaWVsZChQZXJzaXN0ZW5jZUNhcGFibGUgcGMsIGlu\ndCBmaWVsZCkgewogICAgICAgIHJldHVybiBfZm0uZmV0Y2hTdHJpbmdGaWVs\nZChmaWVsZCk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8v\nLy8vLy8vLy8vLwogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgRmllbGRNYW5h\nZ2VyCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgog\nICAgcHVibGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuKGludCBmaWVsZCkgewog\nICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmll\nbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAg\nICAgICAgIHJldHVybiBmZXRjaEJvb2xlYW5GaWVsZChmaWVsZCk7CgogICAg\nICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBmYWxzZSk7CiAg\nICAgICAgcmV0dXJuICgoQm9vbGVhbikgZm1kLmdldEV4dGVybmFsVmFsdWUo\ndmFsLCBfYnJva2VyKSkuYm9vbGVhblZhbHVlKCk7CiAgICB9CgogICAgcHVi\nbGljIGJvb2xlYW4gZmV0Y2hCb29sZWFuRmllbGQoaW50IGZpZWxkKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgh\nX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxk\nKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsK\nCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hCb29sZWFuRmll\nbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYnl0ZSBmZXRj\naEJ5dGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNF\neHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoQnl0ZUZp\nZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNoRmllbGQo\nZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKChOdW1iZXIpIGZtZC5n\nZXRFeHRlcm5hbFZhbHVlKHZhbCwgX2Jyb2tlcikpLmJ5dGVWYWx1ZSgpOwog\nICAgfQoKICAgIHB1YmxpYyBieXRlIGZldGNoQnl0ZUZpZWxkKGludCBmaWVs\nZCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoIV9sb2FkZWQuZ2V0KGZpZWxkKSkKICAgICAgICAgICAgICAgIGxv\nYWRGaWVsZChmaWVsZCwgTG9ja0xldmVscy5MT0NLX05PTkUsIGZhbHNlLCBm\nYWxzZSk7CgogICAgICAgICAgICBwcm92aWRlRmllbGQoX3BjLCBfc2luZ2xl\nLCBmaWVsZCk7CiAgICAgICAgICAgIHJldHVybiBfc2luZ2xlLmZldGNoQnl0\nZUZpZWxkKGZpZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGNoYXIg\nZmV0Y2hDaGFyKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1k\nLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaENo\nYXJGaWVsZChmaWVsZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZp\nZWxkKGZpZWxkLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuICgoQ2hhcmFjdGVy\nKSBmbWQuZ2V0RXh0ZXJuYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5jaGFyVmFs\ndWUoKTsKICAgIH0KCiAgICBwdWJsaWMgY2hhciBmZXRjaENoYXJGaWVsZChp\nbnQgZmllbGQpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgaWYgKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAg\nICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBm\nYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywg\nX3NpbmdsZSwgZmllbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5m\nZXRjaENoYXJGaWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBkb3VibGUgZmV0Y2hEb3VibGUoaW50IGZpZWxkKSB7CiAgICAgICAgRmll\nbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAg\nICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0\ndXJuIGZldGNoRG91YmxlRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3Qg\ndmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVy\nbiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2Vy\nKSkuZG91YmxlVmFsdWUoKTsKICAgIH0KCiAgICBwdWJsaWMgZG91YmxlIGZl\ndGNoRG91YmxlRmllbGQoaW50IGZpZWxkKSB7CiAgICAgICAgbG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmll\nbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZpZWxkLCBMb2NrTGV2\nZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAgIHBy\nb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\ncmV0dXJuIF9zaW5nbGUuZmV0Y2hEb3VibGVGaWVsZChmaWVsZCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBmbG9hdCBmZXRjaEZsb2F0KGludCBmaWVs\nZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0Rmll\nbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkp\nCiAgICAgICAgICAgIHJldHVybiBmZXRjaEZsb2F0RmllbGQoZmllbGQpOwoK\nICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVsZChmaWVsZCwgZmFsc2Up\nOwogICAgICAgIHJldHVybiAoKE51bWJlcikgZm1kLmdldEV4dGVybmFsVmFs\ndWUodmFsLCBfYnJva2VyKSkuZmxvYXRWYWx1ZSgpOwogICAgfQoKICAgIHB1\nYmxpYyBmbG9hdCBmZXRjaEZsb2F0RmllbGQoaW50IGZpZWxkKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghX2xv\nYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZpZWxkKGZp\nZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNlKTsKCiAg\nICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsK\nICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hGbG9hdEZpZWxkKGZp\nZWxkKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGludCBmZXRjaEludChp\nbnQgZmllbGQpIHsKICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRh\nLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFs\naXplZCgpKQogICAgICAgICAgICByZXR1cm4gZmV0Y2hJbnRGaWVsZChmaWVs\nZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5pbnRWYWx1ZSgpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZmV0Y2hJbnRGaWVsZChpbnQgZmllbGQpIHsKICAgICAg\nICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9h\nZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmll\nbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAg\nICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwog\nICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaEludEZpZWxkKGZpZWxk\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGxvbmcgZmV0Y2hMb25nKGlu\ndCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEgZm1kID0gX21ldGEu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1kLmlzRXh0ZXJuYWxp\nemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaExvbmdGaWVsZChmaWVs\nZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5sb25nVmFsdWUoKTsKICAgIH0KCiAg\nICBwdWJsaWMgbG9uZyBmZXRjaExvbmdGaWVsZChpbnQgZmllbGQpIHsKICAg\nICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFf\nbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQo\nZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoK\nICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQp\nOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaExvbmdGaWVsZChm\naWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBPYmplY3QgZmV0Y2hP\nYmplY3QoaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQg\nPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNF\neHRlcm5hbGl6ZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoT2JqZWN0\nRmllbGQoZmllbGQpOwoKICAgICAgICBPYmplY3QgdmFsID0gZmV0Y2hGaWVs\nZChmaWVsZCwgZmFsc2UpOwogICAgICAgIHJldHVybiBmbWQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIF9icm9rZXIpOwogICAgfQoKICAgIHB1YmxpYyBPYmpl\nY3QgZmV0Y2hPYmplY3RGaWVsZChpbnQgZmllbGQpIHsKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVkLmdl\ndChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExv\nY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAg\nICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAgICAg\nICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaE9iamVjdEZpZWxkKGZpZWxkKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHNob3J0IGZldGNoU2hvcnQoaW50\nIGZpZWxkKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgcmV0dXJuIGZldGNoU2hvcnRGaWVsZChmaWVs\nZCk7CgogICAgICAgIE9iamVjdCB2YWwgPSBmZXRjaEZpZWxkKGZpZWxkLCBm\nYWxzZSk7CiAgICAgICAgcmV0dXJuICgoTnVtYmVyKSBmbWQuZ2V0RXh0ZXJu\nYWxWYWx1ZSh2YWwsIF9icm9rZXIpKS5zaG9ydFZhbHVlKCk7CiAgICB9Cgog\nICAgcHVibGljIHNob3J0IGZldGNoU2hvcnRGaWVsZChpbnQgZmllbGQpIHsK\nICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYg\nKCFfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAgICAgICAgICBsb2FkRmll\nbGQoZmllbGQsIExvY2tMZXZlbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2Up\nOwoKICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICByZXR1cm4gX3NpbmdsZS5mZXRjaFNob3J0Rmll\nbGQoZmllbGQpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVu\nbG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGZl\ndGNoU3RyaW5nKGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGlmICghZm1k\nLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHJldHVybiBmZXRjaFN0\ncmluZ0ZpZWxkKGZpZWxkKTsKCiAgICAgICAgT2JqZWN0IHZhbCA9IGZldGNo\nRmllbGQoZmllbGQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gKFN0cmluZykg\nZm1kLmdldEV4dGVybmFsVmFsdWUodmFsLCBfYnJva2VyKTsKICAgIH0KCiAg\nICBwdWJsaWMgU3RyaW5nIGZldGNoU3RyaW5nRmllbGQoaW50IGZpZWxkKSB7\nCiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICghX2xvYWRlZC5nZXQoZmllbGQpKQogICAgICAgICAgICAgICAgbG9hZEZp\nZWxkKGZpZWxkLCBMb2NrTGV2ZWxzLkxPQ0tfTk9ORSwgZmFsc2UsIGZhbHNl\nKTsKCiAgICAgICAgICAgIHByb3ZpZGVGaWVsZChfcGMsIF9zaW5nbGUsIGZp\nZWxkKTsKICAgICAgICAgICAgcmV0dXJuIF9zaW5nbGUuZmV0Y2hTdHJpbmdG\naWVsZChmaWVsZCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlQm9vbGVhbihpbnQgZmllbGQsIGJvb2xlYW4gZXh0ZXJuYWxWYWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICBzdG9yZUJvb2xlYW5GaWVsZChmaWVsZCwgZXh0ZXJuYWxWYWwp\nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBPYmplY3QgdmFsID0gKGV4\ndGVybmFsVmFsKSA/IEJvb2xlYW4uVFJVRSA6IEJvb2xlYW4uRkFMU0U7CiAg\nICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVl\nKHZhbCwgX2Jyb2tlcikpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9yZUJvb2xlYW5GaWVsZChpbnQgZmllbGQsIGJvb2xlYW4gY3Vy\nVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIF9zaW5nbGUuc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGN1clZhbCk7\nCiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxk\nKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAg\nICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzdG9yZUJ5dGUoaW50IGZpZWxkLCBieXRlIGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVCeXRlRmllbGQoZmllbGQsIGV4dGVy\nbmFsVmFsKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQo\nZmllbGQsIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBCeXRlKGV4dGVybmFsVmFs\nKSwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZUJ5dGVGaWVsZChpbnQgZmllbGQsIGJ5dGUgY3VyVmFs\nKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIF9zaW5nbGUuc3RvcmVCeXRlRmllbGQoZmllbGQsIGN1clZhbCk7CiAgICAg\nICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAg\nICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAg\ncG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdG9yZUNoYXIoaW50IGZpZWxkLCBjaGFyIGV4dGVybmFsVmFs\nKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRGaWVs\nZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQoKSkK\nICAgICAgICAgICAgc3RvcmVDaGFyRmllbGQoZmllbGQsIGV4dGVybmFsVmFs\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQs\nIGZtZC5nZXRGaWVsZFZhbHVlKG5ldyBDaGFyYWN0ZXIoZXh0ZXJuYWxWYWwp\nLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlQ2hhckZpZWxkKGludCBmaWVsZCwgY2hhciBjdXJWYWwp\nIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nX3NpbmdsZS5zdG9yZUNoYXJGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAg\nICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmllbGQpOwogICAg\nICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAgICAgICAgICBw\nb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHN0b3JlRG91YmxlKGludCBmaWVsZCwgZG91YmxlIGV4dGVybmFs\nVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5nZXRG\naWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6ZWQo\nKSkKICAgICAgICAgICAgc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZXh0ZXJu\nYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChm\naWVsZCwgZm1kLmdldEZpZWxkVmFsdWUobmV3IERvdWJsZShleHRlcm5hbFZh\nbCksCiAgICAgICAgICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RvcmVEb3VibGVGaWVsZChpbnQgZmllbGQsIGRvdWJsZSBj\ndXJWYWwpIHsKICAgICAgICBsb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgX3NpbmdsZS5zdG9yZURvdWJsZUZpZWxkKGZpZWxkLCBjdXJWYWwp\nOwogICAgICAgICAgICByZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVs\nZCk7CiAgICAgICAgICAgIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAg\nICAgICAgIHBvc3RMb2FkKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3RvcmVGbG9hdChpbnQgZmllbGQsIGZsb2F0IGV4\ndGVybmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0\nYS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5h\nbGl6ZWQoKSkKICAgICAgICAgICAgc3RvcmVGbG9hdEZpZWxkKGZpZWxkLCBl\neHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZp\nZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShuZXcgRmxvYXQoZXh0ZXJu\nYWxWYWwpLAogICAgICAgICAgICAgICAgX2Jyb2tlcikpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHN0b3JlRmxvYXRGaWVsZChpbnQgZmllbGQsIGZsb2F0\nIGN1clZhbCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBfc2luZ2xlLnN0b3JlRmxvYXRGaWVsZChmaWVsZCwgY3VyVmFs\nKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3NpbmdsZSwgZmll\nbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRydWUpOwogICAg\nICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHN0b3JlSW50KGludCBmaWVsZCwgaW50IGV4dGVy\nbmFsVmFsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YSBmbWQgPSBfbWV0YS5n\nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKCFmbWQuaXNFeHRlcm5hbGl6\nZWQoKSkKICAgICAgICAgICAgc3RvcmVJbnRGaWVsZChmaWVsZCwgZXh0ZXJu\nYWxWYWwpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgc3RvcmVGaWVsZChm\naWVsZCwgZm1kLmdldEZpZWxkVmFsdWUoZXh0ZXJuYWxWYWwsCiAgICAgICAg\nICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVJbnRGaWVsZChpbnQgZmllbGQsIGludCBjdXJWYWwpIHsKICAgICAgICBs\nb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgX3NpbmdsZS5zdG9y\nZUludEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICByZXBsYWNl\nRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAgIHNldExv\nYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2FkKGZpZWxk\nLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxv\nY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcmVM\nb25nKGludCBmaWVsZCwgbG9uZyBleHRlcm5hbFZhbCkgewogICAgICAgIEZp\nZWxkTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAg\nICAgIGlmICghZm1kLmlzRXh0ZXJuYWxpemVkKCkpCiAgICAgICAgICAgIHN0\nb3JlTG9uZ0ZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxz\nZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRW\nYWx1ZShleHRlcm5hbFZhbCwKICAgICAgICAgICAgICAgIF9icm9rZXIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZUxvbmdGaWVsZChpbnQgZmll\nbGQsIGxvbmcgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVMb25nRmllbGQoZmllbGQs\nIGN1clZhbCk7CiAgICAgICAgICAgIHJlcGxhY2VGaWVsZChfcGMsIF9zaW5n\nbGUsIGZpZWxkKTsKICAgICAgICAgICAgc2V0TG9hZGVkKGZpZWxkLCB0cnVl\nKTsKICAgICAgICAgICAgcG9zdExvYWQoZmllbGQsIG51bGwpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9yZU9iamVjdChpbnQgZmllbGQs\nIE9iamVjdCBleHRlcm5hbFZhbCkgewogICAgICAgIEZpZWxkTWV0YURhdGEg\nZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAgIGV4dGVybmFs\nVmFsID0gZm1kLm9yZGVyKGV4dGVybmFsVmFsKTsKICAgICAgICBpZiAoIWZt\nZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAgICAgICBzdG9yZU9iamVjdEZp\nZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7CiAgICAgICAgZWxzZQogICAgICAg\nICAgICBzdG9yZUZpZWxkKGZpZWxkLCBmbWQuZ2V0RmllbGRWYWx1ZShleHRl\ncm5hbFZhbCwgX2Jyb2tlcikpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0\nb3JlT2JqZWN0RmllbGQoaW50IGZpZWxkLCBPYmplY3QgY3VyVmFsKSB7CiAg\nICAgICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5n\nbGUuc3RvcmVPYmplY3RGaWVsZChmaWVsZCwgY3VyVmFsKTsKICAgICAgICAg\nICAgX3NpbmdsZS5wcm94eSh0cnVlLCBmYWxzZSk7CiAgICAgICAgICAgIHJl\ncGxhY2VGaWVsZChfcGMsIF9zaW5nbGUsIGZpZWxkKTsKICAgICAgICAgICAg\nc2V0TG9hZGVkKGZpZWxkLCB0cnVlKTsKICAgICAgICAgICAgcG9zdExvYWQo\nZmllbGQsIG51bGwpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndG9yZVNob3J0KGludCBmaWVsZCwgc2hvcnQgZXh0ZXJuYWxWYWwpIHsKICAg\nICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxk\nKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAgICAg\nICAgICBzdG9yZVNob3J0RmllbGQoZmllbGQsIGV4dGVybmFsVmFsKTsKICAg\nICAgICBlbHNlCiAgICAgICAgICAgIHN0b3JlRmllbGQoZmllbGQsIGZtZC5n\nZXRGaWVsZFZhbHVlKG5ldyBTaG9ydChleHRlcm5hbFZhbCksCiAgICAgICAg\nICAgICAgICBfYnJva2VyKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rv\ncmVTaG9ydEZpZWxkKGludCBmaWVsZCwgc2hvcnQgY3VyVmFsKSB7CiAgICAg\nICAgbG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIF9zaW5nbGUu\nc3RvcmVTaG9ydEZpZWxkKGZpZWxkLCBjdXJWYWwpOwogICAgICAgICAgICBy\nZXBsYWNlRmllbGQoX3BjLCBfc2luZ2xlLCBmaWVsZCk7CiAgICAgICAgICAg\nIHNldExvYWRlZChmaWVsZCwgdHJ1ZSk7CiAgICAgICAgICAgIHBvc3RMb2Fk\nKGZpZWxkLCBudWxsKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB1bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc3RvcmVTdHJpbmcoaW50IGZpZWxkLCBTdHJpbmcgZXh0ZXJuYWxWYWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZp\nZWxkKTsKICAgICAgICBpZiAoIWZtZC5pc0V4dGVybmFsaXplZCgpKQogICAg\nICAgICAgICBzdG9yZVN0cmluZ0ZpZWxkKGZpZWxkLCBleHRlcm5hbFZhbCk7\nCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9yZUZpZWxkKGZpZWxkLCBm\nbWQuZ2V0RmllbGRWYWx1ZShleHRlcm5hbFZhbCwgX2Jyb2tlcikpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3JlU3RyaW5nRmllbGQoaW50IGZpZWxk\nLCBTdHJpbmcgY3VyVmFsKSB7CiAgICAgICAgbG9jaygpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIF9zaW5nbGUuc3RvcmVTdHJpbmdGaWVsZChmaWVs\nZCwgY3VyVmFsKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywgX3Np\nbmdsZSwgZmllbGQpOwogICAgICAgICAgICBzZXRMb2FkZWQoZmllbGQsIHRy\ndWUpOwogICAgICAgICAgICBwb3N0TG9hZChmaWVsZCwgbnVsbCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIGdpdmVuIGZpZWxk\nIHZhbHVlIGludG8gdGhlIGdpdmVuIGZpZWxkIG1hbmFnZXIuCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBzdG9yZUZpZWxkKGludCBmaWVsZCwgT2JqZWN0\nIHZhbCwgRmllbGRNYW5hZ2VyIGZtKSB7CiAgICAgICAgRmllbGRNZXRhRGF0\nYSBmbWQgPSBfbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBuZXcgVXNlckV4Y2VwdGlv\nbihfbG9jLmdldCgibm8tZmllbGQtaW5kZXgiLAogICAgICAgICAgICAgICAg\nU3RyaW5nLnZhbHVlT2YoZmllbGQpLCBfbWV0YS5nZXREZXNjcmliZWRUeXBl\nKCkpKS4KICAgICAgICAgICAgICAgIHNldEZhaWxlZE9iamVjdChnZXRNYW5h\nZ2VkSW5zdGFuY2UoKSk7CgogICAgICAgIHN3aXRjaCAoZm1kLmdldERlY2xh\ncmVkVHlwZUNvZGUoKSkgewogICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5C\nT09MRUFOOgogICAgICAgICAgICAgICAgYm9vbGVhbiBib29sID0gdmFsICE9\nIG51bGwgJiYgKChCb29sZWFuKSB2YWwpLmJvb2xlYW5WYWx1ZSgpOwogICAg\nICAgICAgICAgICAgZm0uc3RvcmVCb29sZWFuRmllbGQoZmllbGQsIGJvb2wp\nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2\nYVR5cGVzLkJZVEU6CiAgICAgICAgICAgICAgICBieXRlIGIgPSAodmFsID09\nIG51bGwpID8gMCA6ICgoTnVtYmVyKSB2YWwpLmJ5dGVWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgZm0uc3RvcmVCeXRlRmllbGQoZmllbGQsIGIpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVz\nLkNIQVI6CiAgICAgICAgICAgICAgICBjaGFyIGMgPSAodmFsID09IG51bGwp\nID8gMCA6ICgoQ2hhcmFjdGVyKSB2YWwpLmNoYXJWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgZm0uc3RvcmVDaGFyRmllbGQoZmllbGQsIGMpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkRP\nVUJMRToKICAgICAgICAgICAgICAgIGRvdWJsZSBkID0gKHZhbCA9PSBudWxs\nKSA/IDAgOiAoKE51bWJlcikgdmFsKS5kb3VibGVWYWx1ZSgpOwogICAgICAg\nICAgICAgICAgZm0uc3RvcmVEb3VibGVGaWVsZChmaWVsZCwgZCk7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMu\nRkxPQVQ6CiAgICAgICAgICAgICAgICBmbG9hdCBmID0gKHZhbCA9PSBudWxs\nKSA/IDAgOiAoKE51bWJlcikgdmFsKS5mbG9hdFZhbHVlKCk7CiAgICAgICAg\nICAgICAgICBmbS5zdG9yZUZsb2F0RmllbGQoZmllbGQsIGYpOwogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLklO\nVDoKICAgICAgICAgICAgICAgIGludCBpID0gKHZhbCA9PSBudWxsKSA/IDAg\nOiAoKE51bWJlcikgdmFsKS5pbnRWYWx1ZSgpOwogICAgICAgICAgICAgICAg\nZm0uc3RvcmVJbnRGaWVsZChmaWVsZCwgaSk7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuTE9ORzoKICAgICAg\nICAgICAgICAgIGxvbmcgbCA9ICh2YWwgPT0gbnVsbCkgPyAwIDogKChOdW1i\nZXIpIHZhbCkubG9uZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9y\nZUxvbmdGaWVsZChmaWVsZCwgbCk7CiAgICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgY2FzZSBKYXZhVHlwZXMuU0hPUlQ6CiAgICAgICAgICAg\nICAgICBzaG9ydCBzID0gKHZhbCA9PSBudWxsKSA/IDAgOiAoKE51bWJlcikg\ndmFsKS5zaG9ydFZhbHVlKCk7CiAgICAgICAgICAgICAgICBmbS5zdG9yZVNo\nb3J0RmllbGQoZmllbGQsIHMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLlNUUklORzoKICAgICAgICAgICAg\nICAgIGZtLnN0b3JlU3RyaW5nRmllbGQoZmllbGQsIChTdHJpbmcpIHZhbCk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgICAgIGZtLnN0b3JlT2JqZWN0RmllbGQoZmllbGQsIHZh\nbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8KICAgIC8v\nIFV0aWxpdGllcwogICAgLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICog\nRXJhc2UgdGhlIGZhY3QgdGhhdCB0aGlzIGluc3RhbmNlIGhhcyBiZWVuIGZs\ndXNoZWQuCiAgICAgKi8KICAgIHZvaWQgZXJhc2VGbHVzaCgpIHsKICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfRkxVU0hFRDsKICAgICAgICBfZmxhZ3MgJj0g\nfkZMQUdfRkxVU0hFRF9ESVJUWTsKCiAgICAgICAgaW50IGZtZHMgPSBfbWV0\nYS5nZXRGaWVsZHMoKS5sZW5ndGg7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBmbWRzOyBpKyspCiAgICAgICAgICAgIF9mbHVzaC5jbGVhcihpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlY29yZHMgdGhhdCBhbGwgaW5zdGFu\nY2UgZmllbGRzIGFyZS9hcmUgbm90IGxvYWRlZC4KICAgICAqIFByaW1hcnkg\na2V5IGFuZCBub24tcGVyc2lzdGVudCBmaWVsZHMgYXJlIG5vdCBhZmZlY3Rl\nZC4KICAgICAqLwogICAgdm9pZCBzZXRMb2FkZWQoYm9vbGVhbiB2YWwpIHsK\nICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxk\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7\nIGkrKykgewogICAgICAgICAgICBpZiAoIWZtZHNbaV0uaXNQcmltYXJ5S2V5\nKCkKICAgICAgICAgICAgICAgICYmIGZtZHNbaV0uZ2V0TWFuYWdlbWVudCgp\nID09IGZtZHNbaV0uTUFOQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAg\nICBzZXRMb2FkZWQoaSwgdmFsKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF2\nYWwpIHsKICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX0xPQURFRDsKICAg\nICAgICAgICAgc2V0RGlydHkoZmFsc2UpOwogICAgICAgIH0gZWxzZQogICAg\nICAgICAgICBfZmxhZ3MgfD0gRkxBR19MT0FERUQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWNvcmRzIHRoYXQgYWxsIGluc3RhbmNlIGZpZWxkcyBhcmUv\nYXJlIG5vdCBkaXJ0eSwKICAgICAqIGFuZCBjaGFuZ2VzIHRoZSBmbGFncyBv\nZiB0aGUgaW5zdGFuY2UgYWNjb3JkaW5nbHkuCiAgICAgKi8KICAgIHZvaWQg\nc2V0RGlydHkoYm9vbGVhbiB2YWwpIHsKICAgICAgICBGaWVsZE1ldGFEYXRh\nW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAgICAgIGJvb2xlYW4g\ndXBkYXRlID0gIWlzTmV3KCkgfHwgaXNGbHVzaGVkKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmICh2YWwgJiYgKCF1cGRhdGUKICAgICAgICAgICAgICAgIHx8IGZt\nZHNbaV0uZ2V0VXBkYXRlU3RyYXRlZ3koKSAhPSBVcGRhdGVTdHJhdGVnaWVz\nLklHTk9SRSkpCiAgICAgICAgICAgICAgICBfZGlydHkuc2V0KGkpOwogICAg\nICAgICAgICBlbHNlIGlmICghdmFsKSB7CiAgICAgICAgICAgICAgICAvLyB3\nZSBuZXZlciBjb25zaWRlciBjbGVhbiBmaWVsZHMgZmx1c2hlZDsgdGhpcyBh\nbHNvIHRha2VzCiAgICAgICAgICAgICAgICAvLyBjYXJlIG9mIGNsZWFyaW5n\nIHRoZSBmbHVzaGVkIGZpZWxkcyBvbiBjb21taXQvcm9sbGJhY2sKICAgICAg\nICAgICAgICAgIF9mbHVzaC5jbGVhcihpKTsKICAgICAgICAgICAgICAgIF9k\naXJ0eS5jbGVhcihpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYgKHZhbCkKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9BREVE\nOwogICAgfQoKICAgIC8qKgogICAgICogRXhlY3V0ZXMgcHJlLWNsZWFyIGNh\nbGxiYWNrcywgY2xlYXJzIGFsbCBtYW5hZ2VkIGZpZWxkcywgYW5kIGNhbGxz\nIHRoZQogICAgICoge0BsaW5rICNzZXRMb2FkZWR9IG1ldGhvZCB3aXRoIGEg\ndmFsdWUgb2YgZmFsc2UuIFByaW1hcnkga2V5IGZpZWxkcwogICAgICogYXJl\nIG5vdCBjbGVhcmVkLgogICAgICovCiAgICB2b2lkIGNsZWFyRmllbGRzKCkg\newogICAgICAgIGlmICghaXNJbnRlcmNlcHRpbmcoKSkKICAgICAgICAgICAg\ncmV0dXJuOwoKICAgICAgICBmaXJlTGlmZWN5Y2xlRXZlbnQoTGlmZWN5Y2xl\nRXZlbnQuQkVGT1JFX0NMRUFSKTsKCiAgICAgICAgLy8gdW5wcm94eSBhbGwg\nZmllbGRzCiAgICAgICAgdW5wcm94eUZpZWxkcygpOwoKICAgICAgICBsb2Nr\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY2xlYXIgbm9uLXBr\nIGZpZWxkcwogICAgICAgICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9t\nZXRhLmdldEZpZWxkcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICgh\nZm1kc1tpXS5pc1ByaW1hcnlLZXkoKSAmJiBmbWRzW2ldLmdldE1hbmFnZW1l\nbnQoKQogICAgICAgICAgICAgICAgICAgID09IEZpZWxkTWV0YURhdGEuTUFO\nQUdFX1BFUlNJU1RFTlQpCiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUZp\nZWxkKF9wYywgQ2xlYXJGaWVsZE1hbmFnZXIuZ2V0SW5zdGFuY2UoKSwgaSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZvcmdldCB2ZXJzaW9u\nIGluZm8gYW5kIGltcGwgZGF0YSBzbyB3ZSByZS1yZWFkIG5leHQgdGltZQog\nICAgICAgICAgICBzZXRMb2FkZWQoZmFsc2UpOwogICAgICAgICAgICBfdmVy\nc2lvbiA9IG51bGw7CiAgICAgICAgICAgIF9sb2FkVmVyc2lvbiA9IG51bGw7\nCiAgICAgICAgICAgIGlmIChfZmllbGRJbXBsICE9IG51bGwpCiAgICAgICAg\nICAgICAgICBBcnJheXMuZmlsbChfZmllbGRJbXBsLCBudWxsKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2soKTsKICAgICAgICB9\nCgogICAgICAgIGZpcmVMaWZlY3ljbGVFdmVudChMaWZlY3ljbGVFdmVudC5B\nRlRFUl9DTEVBUik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNvcmQgdGhh\ndCB3ZSBzaG91bGQgc2F2ZSBhbnkgZmllbGRzIHRoYXQgY2hhbmdlIGZyb20g\ndGhpcyBwb2ludAogICAgICogZm9yd2FyZC4KICAgICAqLwogICAgdm9pZCBz\nYXZlRmllbGRzKGJvb2xlYW4gaW1tZWRpYXRlKSB7CiAgICAgICAgaWYgKF9i\ncm9rZXIuZ2V0UmVzdG9yZVN0YXRlKCkgPT0gUmVzdG9yZVN0YXRlLlJFU1RP\nUkVfTk9ORQogICAgICAgICAgICAmJiAoX2ZsYWdzICYgRkxBR19JTlZFUlNF\nUykgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBfZmxhZ3Mg\nfD0gRkxBR19TQVZFOwogICAgICAgIGlmIChpbW1lZGlhdGUpIHsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2FkZWQubGVuZ3RoKCk7\nIGkgPCBsZW47IGkrKykKICAgICAgICAgICAgICAgIHNhdmVGaWVsZChpKTsK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1NBVkU7CiAgICAgICAgICAg\nIC8vIE9QRU5KUEEtNjU5CiAgICAgICAgICAgIC8vIHJlY29yZCBhIHNhdmVk\nIGZpZWxkIG1hbmFnZXIgZXZlbiBpZiBubyBmaWVsZCBpcyBjdXJyZW50bHkg\nbG9hZGVkCiAgICAgICAgICAgIC8vIGFzIGV4aXN0ZW5jZSBvZiBhIFNhdmVG\naWVsZE1hbmFnZXIgaXMgY3JpdGljYWwgZm9yIGEgZGlydHkgY2hlY2sKICAg\nICAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxsKQogICAgICAgICAgICAJX3Nh\ndmVkID0gbmV3IFNhdmVGaWVsZE1hbmFnZXIodGhpcywgZ2V0UGVyc2lzdGVu\nY2VDYXBhYmxlKCksIAogICAgICAgICAgICAJCQkJX2RpcnR5KTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiB0aGUgZmllbGQgaXNuJ3Qg\nYWxyZWFkeSBzYXZlZCwgc2F2ZXMgdGhlIGN1cnJlbnRseSBsb2FkZWQgZmll\nbGQKICAgICAqIHN0YXRlIG9mIHRoZSBpbnN0YW5jZS4gVGhlIHNhdmVkIHZh\nbHVlcyBjYW4gYWxsIGJlIHJlc3RvcmVkIHZpYQogICAgICoge0BsaW5rICNy\nZXN0b3JlRmllbGRzfS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHNhdmVG\naWVsZChpbnQgZmllbGQpIHsKICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdf\nU0FWRSkgPT0gMCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBp\nZiB0aGlzIGlzIGEgbWFuYWdlZCBpbnZlcnNlIGZpZWxkLCBsb2FkIGl0IHNv\nIHdlJ3JlIHN1cmUgdG8gaGF2ZQogICAgICAgIC8vIHRoZSBvcmlnaW5hbCB2\nYWx1ZQogICAgICAgIGlmICghX2xvYWRlZC5nZXQoZmllbGQpICYmICgoX2Zs\nYWdzICYgRkxBR19JTlZFUlNFUykgIT0gMAogICAgICAgICAgICAmJiBfbWV0\nYS5nZXRGaWVsZChmaWVsZCkuZ2V0SW52ZXJzZU1ldGFEYXRhcygpLmxlbmd0\naCA+IDApKQogICAgICAgICAgICBsb2FkRmllbGQoZmllbGQsIExvY2tMZXZl\nbHMuTE9DS19OT05FLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAvLyBkb24n\ndCBib3RoZXIgY3JlYXRpbmcgdGhlIHNhdmUgZmllbGQgbWFuYWdlciBpZiB3\nZSdyZSBub3QgZ29pbmcgdG8KICAgICAgICAvLyBzYXZlIHRoZSBvbGQgZmll\nbGQgdmFsdWUgYW55d2F5CiAgICAgICAgaWYgKF9zYXZlZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgIGlmIChfbG9hZGVkLmdldChmaWVsZCkpCiAgICAgICAg\nICAgICAgICBfc2F2ZWQgPSBuZXcgU2F2ZUZpZWxkTWFuYWdlcih0aGlzLCBu\ndWxsLCBfZGlydHkpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjb3B5IHRoZSBmaWVs\nZCB0byBzYXZlIGZpZWxkIG1hbmFnZXI7IGlmIHRoZSBmaWVsZCBpcyBub3Qg\nZGlyZWN0bHkKICAgICAgICAvLyBjb3B5YWJsZSwgaW1tZWRpYXRlbHkgcHJv\ndmlkZSBhbmQgcmVwbGFjZSBpdCB2aWEgdGhlIHNhdmUgZmllbGQKICAgICAg\nICAvLyBtYW5hZ2VyLCB3aGljaCB3aWxsIGNvcHkgdGhlIG11dGFibGUgdmFs\ndWUgdG8gcHJldmVudCBieS1yZWYgbW9kcwogICAgICAgIGlmIChfc2F2ZWQu\nc2F2ZUZpZWxkKGZpZWxkKSkgewogICAgICAgICAgICBwcm92aWRlRmllbGQo\nX3BjLCBfc2F2ZWQsIGZpZWxkKTsKICAgICAgICAgICAgcmVwbGFjZUZpZWxk\nKF9zYXZlZC5nZXRTdGF0ZSgpLCBfc2F2ZWQsIGZpZWxkKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBOb3RpZmljYXRpb24gdGhhdCB0aGUg\nc3RhdGUgd2lsbCBub3QgbmVlZCB0byBiZSByb2xsZWQgYmFjawogICAgICog\ndG8gdGhhdCBvZiB0aGUgbGFzdCBjYWxsIHRvIHtAbGluayAjc2F2ZUZpZWxk\nc30uCiAgICAgKi8KICAgIHZvaWQgY2xlYXJTYXZlZEZpZWxkcygpIHsKICAg\nICAgICBpZiAoaXNJbnRlcmNlcHRpbmcoKSkgewogICAgICAgICAgICBfZmxh\nZ3MgJj0gfkZMQUdfU0FWRTsKICAgICAgICAgICAgX3NhdmVkID0gbnVsbDsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIFNhdmVGaWVsZE1hbmFnZXIg\nZ2V0U2F2ZUZpZWxkTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gX3NhdmVk\nOwogICAgfQoKICAgIC8qKgogICAgICogUm9sbGJhY2sgdGhlIHN0YXRlIG9m\nIHRoZSBpbnN0YW5jZSB0byB0aGUgc2F2ZWQgc3RhdGUgZnJvbSB0aGUKICAg\nICAqIGxhc3QgY2FsbCB0byB7QGxpbmsgI3NhdmVGaWVsZHN9LCBvciB0byBk\nZWZhdWx0IHZhbHVlcyBpZiBuZXZlciBzYXZlZC4KICAgICAqLwogICAgdm9p\nZCByZXN0b3JlRmllbGRzKCkgewogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoX3NhdmVkID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19TQVZFKSA9PSAwKQogICAg\nICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7CiAgICAgICAgICAgICAg\nICBlbHNlIC8vIG9ubHkgdW5sb2FkZWQgZmllbGRzIHdlcmUgZGlydGllZAog\nICAgICAgICAgICAgICAgICAgIF9sb2FkZWQuYW5kTm90KF9sb2FkZWQpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHdlIGRpcmVjdCBzdGF0ZSB0\ncmFuc2l0aW9ucyBiYXNlZCBvbiBvdXIgb3duIGdldFJlc3RvcmVTdGF0ZQog\nICAgICAgICAgICAvLyBtZXRob2QsIGJ1dCB0byBkZWNpZGUgd2hldGhlciB0\nbyBhY3R1YWxseSByb2xsYmFjayBmaWVsZAogICAgICAgICAgICAvLyB2YWx1\nZXMsIHdlIGNvbnN1bHQgdGhlIGJyb2tlciBmb3IgdGhlIHVzZXIncyBzZXR0\naW5nCiAgICAgICAgICAgIGVsc2UgaWYgKF9icm9rZXIuZ2V0UmVzdG9yZVN0\nYXRlKCkgIT0gUmVzdG9yZVN0YXRlLlJFU1RPUkVfTk9ORSkgewogICAgICAg\nICAgICAgICAgLy8gcm9sbGJhY2sgYWxsIGN1cnJlbnRseS1sb2FkZWQgZmll\nbGRzCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMCwgbGVuID0gX2xv\nYWRlZC5sZW5ndGgoKTsgaSA8IGxlbjsgaSsrKQogICAgICAgICAgICAgICAg\nICAgIGlmIChfbG9hZGVkLmdldChpKSAmJiBfc2F2ZWQucmVzdG9yZUZpZWxk\nKGkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlRmllbGQoX3Bj\nLCBfc2F2ZWQsIGkpOwoKICAgICAgICAgICAgICAgIC8vIHJvbGxiYWNrIGxv\nYWRlZCBzZXQKICAgICAgICAgICAgICAgIF9sb2FkZWQuYW5kTm90KF9zYXZl\nZC5nZXRVbmxvYWRlZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgdW5sb2NrKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVwbGFjZXMgYWxsIHNlY29uZCBj\nbGFzcyBvYmplY3QgZmllbGRzIHdpdGggZnJlc2ggcHJveGllZCBpbnN0YW5j\nZXMKICAgICAqIGNvbnRhaW5pbmcgdGhlIHNhbWUgaW5mb3JtYXRpb24gYXMg\ndGhlIG9yaWdpbmFscy4KICAgICAqLwogICAgdm9pZCBwcm94eUZpZWxkcyhi\nb29sZWFuIHJlc2V0LCBib29sZWFuIHJlcGxhY2VOdWxsKSB7CiAgICAgICAg\nLy8gd2Ugb25seSByZXBsYWNlIG51bGxzIGlmIHRoZSBydW50aW1lIGNhbid0\nIGRpZmZlcmVudGlhdGUgYmV0d2VlbgogICAgICAgIC8vIG51bGwgYW5kIGVt\ncHR5IGNvbnRhaW5lcnMuICB3ZSByZXBsYWNlIG51bGxzIGluIHRoaXMgY2Fz\nZSB0bwogICAgICAgIC8vIG1haW50YWluIGNvbnNpc3RlbmN5IHdoZXRoZXIg\ndmFsdWVzIGFyZSBiZWluZyByZXRhaW5lZCBvciBub3QKICAgICAgICBpZiAo\ncmVwbGFjZU51bGwpCiAgICAgICAgICAgIHJlcGxhY2VOdWxsID0gIV9icm9r\nZXIuZ2V0Q29uZmlndXJhdGlvbigpLnN1cHBvcnRlZE9wdGlvbnMoKS4KICAg\nICAgICAgICAgICAgIGNvbnRhaW5zKE9wZW5KUEFDb25maWd1cmF0aW9uLk9Q\nVElPTl9OVUxMX0NPTlRBSU5FUik7CgogICAgICAgIGxvY2soKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmb3IgKEZpZWxkTWV0YURhdGEgZm1kIDog\nX21ldGEuZ2V0UHJveHlGaWVsZHMoKSkgewogICAgICAgICAgICAgICAgaW50\nIGluZGV4ID0gZm1kLmdldEluZGV4KCk7CiAgICAgICAgICAgICAgICBpZiAo\nX2xvYWRlZC5nZXQoaW5kZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJv\ndmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaW5kZXgpOwogICAgICAgICAgICAg\nICAgICAgIGlmIChfc2luZ2xlLnByb3h5KHJlc2V0LCByZXBsYWNlTnVsbCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZUZpZWxkKF9wYywg\nX3NpbmdsZSwgaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIF9zaW5nbGUuY2xlYXIoKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB1bmxvY2so\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVbnByb3h5IGFs\nbCBmaWVsZHMuCiAgICAgKi8KICAgIHZvaWQgdW5wcm94eUZpZWxkcygpIHsK\nICAgICAgICBpZiAoKF9mbGFncyAmIEZMQUdfTk9fVU5QUk9YWSkgIT0gMCkK\nICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBsb2NrKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDAsIGxlbiA9IF9sb2Fk\nZWQubGVuZ3RoKCk7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAg\ncHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7CiAgICAgICAgICAgICAg\nICBfc2luZ2xlLnVucHJveHkoKTsKICAgICAgICAgICAgICAgIF9zaW5nbGUu\ncmVsZWFzZUVtYmVkZGVkKCk7CiAgICAgICAgICAgICAgICBfc2luZ2xlLmNs\nZWFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmluYWxs\neSB7CiAgICAgICAgICAgIHVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEdldCByZWFkeSBmb3IgYSBmbHVzaC4gUGVyc2lzdHMg\nYWxsIHBlcnNpc3RlbmNlLWNhcGFibGUgb2JqZWN0IGZpZWxkcywKICAgICAq\nIGFuZCBjaGVja3MgZm9yIGlsbGVnYWwgbnVsbCB2YWx1ZXMuIEFsc28gYXNz\naWducyBvaWRzIGFuZCBmaWVsZCB2YWx1ZXMKICAgICAqIGZvciBhbGwgc3Ry\nYXRlZ2llcyB0aGF0IGRvbid0IHJlcXVpcmUgZmx1c2hpbmcuCiAgICAgKi8K\nICAgIHZvaWQgcHJlRmx1c2goYm9vbGVhbiBsb2dpY2FsLCBPcENhbGxiYWNr\ncyBjYWxsKSB7CiAgICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX1BSRV9GTFVT\nSEVEKSAhPSAwKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChp\nc1BlcnNpc3RlbnQoKSkgewogICAgICAgICAgICBmaXJlTGlmZWN5Y2xlRXZl\nbnQoTGlmZWN5Y2xlRXZlbnQuQkVGT1JFX1NUT1JFKTsKICAgICAgICAgICAg\nLy8gQkVGT1JFX1BFUlNJU1QgaXMgaGFuZGxlZCBkdXJpbmcgQnJva2VyLnBl\ncnNpc3QgYW5kIEJyb2tlci5hdHRhY2gKICAgICAgICAgICAgaWYgKGlzRGVs\nZXRlZCgpKQogICAgICAgICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExp\nZmVjeWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwogICAgICAgICAgICBlbHNl\nIGlmICghKGlzTmV3KCkgJiYgIWlzRmx1c2hlZCgpKQoJCQkJJiYgKEltcGxI\nZWxwZXIuZ2V0VXBkYXRlRmllbGRzKHRoaXMpICE9IG51bGwpKQogICAgICAg\nICAgICAgICAgZmlyZUxpZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJF\nRk9SRV9VUERBVEUpOwogICAgICAgICAgICBfZmxhZ3MgfD0gRkxBR19QUkVf\nRkxVU0hFRDsKICAgICAgICB9CgogICAgICAgIGxvY2soKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoIWxvZ2ljYWwpCiAgICAgICAgICAgICAg\nICBhc3NpZ25PYmplY3RJZChmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwLCBsZW4gPSBfbWV0YS5nZXRGaWVsZHMoKS5sZW5ndGg7\nIGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgaWYgKChsb2dpY2Fs\nIHx8ICFhc3NpZ25GaWVsZChpLCB0cnVlKSkgJiYgIV9mbHVzaC5nZXQoaSkK\nICAgICAgICAgICAgICAgICAgICAmJiBfZGlydHkuZ2V0KGkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgcHJvdmlkZUZpZWxkKF9wYywgX3NpbmdsZSwgaSk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKF9zaW5nbGUucHJlRmx1c2gobG9n\naWNhbCwgY2FsbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VG\naWVsZChfcGMsIF9zaW5nbGUsIGkpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2UKICAgICAgICAgICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBk\naXJ0eUNoZWNrKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\ndW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWFr\nZSBjYWxsYmFja3MgZm9yIGRlbGV0aW9uLgogICAgICovCiAgICB2b2lkIHBy\nZURlbGV0ZSgpIHsKICAgICAgICAvLyBzZXQgYSBmbGFnIHdoaWxlIGNhbGwg\ncHJlIGRlbGV0ZSBjYWxsYmFjayBzbyB0aGF0IHVzZXIgY2FuJ3QKICAgICAg\nICAvLyBnZXQgaW50byBpbmZpbml0ZSByZWN1cnNpb24gYnkgY2FsbGluZyBk\nZWxldGUodGhpcykKICAgICAgICAvLyB3aXRoaW4gaGlzIGNhbGxiYWNrIG1l\ndGhvZAogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19QUkVfREVMRVRJTkcp\nID09IDApIHsKICAgICAgICAgICAgX2ZsYWdzIHw9IEZMQUdfUFJFX0RFTEVU\nSU5HOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmlyZUxp\nZmVjeWNsZUV2ZW50KExpZmVjeWNsZUV2ZW50LkJFRk9SRV9ERUxFVEUpOwog\nICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2ZsYWdz\nICY9IH5GTEFHX1BSRV9ERUxFVElORzsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIENhc2NhZGUgZGVsZXRlcyBhbmQg\nZGVyZWZlcmVuY2UgZGVwZW5kZW50IGZpZWxkcy4KICAgICAqLwogICAgdm9p\nZCBjYXNjYWRlRGVsZXRlKE9wQ2FsbGJhY2tzIGNhbGwpIHsKICAgICAgICBG\naWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZm1kcy5sZW5ndGg7IGkrKykgewog\nICAgICAgICAgICBpZiAoZm1kc1tpXS5nZXRDYXNjYWRlRGVsZXRlKCkgIT0g\nVmFsdWVNZXRhRGF0YS5DQVNDQURFX05PTkUKICAgICAgICAgICAgICAgIHx8\nIGZtZHNbaV0uZ2V0S2V5KCkuZ2V0Q2FzY2FkZURlbGV0ZSgpCiAgICAgICAg\nICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NBREVfTk9ORQogICAgICAg\nICAgICAgICAgfHwgZm1kc1tpXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZURl\nbGV0ZSgpCiAgICAgICAgICAgICAgICAhPSBWYWx1ZU1ldGFEYXRhLkNBU0NB\nREVfTk9ORSkgewogICAgICAgICAgICAgICAgX3NpbmdsZS5zdG9yZU9iamVj\ndEZpZWxkKGksIGZldGNoRmllbGQoaSwgZmFsc2UpKTsKICAgICAgICAgICAg\nICAgIF9zaW5nbGUuZGVsZXRlKGNhbGwpOwogICAgICAgICAgICAgICAgX3Np\nbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogQ2FsbGVkIGFmdGVyIGFuIGluc3RhbmNlIGlzIHBl\ncnNpc3RlZCBieSBhIHVzZXIgdGhyb3VnaCB0aGUgYnJva2VyLgogICAgICog\nQ2FzY2FkZXMgdGhlIHBlcnNpc3Qgb3BlcmF0aW9uIHRvIGZpZWxkcyBtYXJr\nZWQKICAgICAqIHtAbGluayBWYWx1ZU1ldGFEYXRhI0NBU0NBREVfSU1NRURJ\nQVRFfS4KICAgICAqLwogICAgdm9pZCBjYXNjYWRlUGVyc2lzdChPcENhbGxi\nYWNrcyBjYWxsKSB7CiAgICAgICAgRmllbGRNZXRhRGF0YVtdIGZtZHMgPSBf\nbWV0YS5nZXRGaWVsZHMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGZtZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFfbG9hZGVk\nLmdldChpKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAg\nICAgaWYgKGZtZHNbaV0uZ2V0Q2FzY2FkZVBlcnNpc3QoKSA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFCiAgICAgICAgICAgICB8fCBmbWRz\nW2ldLmdldEtleSgpLmdldENhc2NhZGVQZXJzaXN0KCkgPT0gVmFsdWVNZXRh\nRGF0YS5DQVNDQURFX0lNTUVESUFURQogICAgICAgICAgICAgfHwgZm1kc1tp\nXS5nZXRFbGVtZW50KCkuZ2V0Q2FzY2FkZVBlcnNpc3QoKSA9PSBWYWx1ZU1l\ndGFEYXRhLkNBU0NBREVfSU1NRURJQVRFKSB7CiAgICAgICAgICAgICAgICBf\nc2luZ2xlLnN0b3JlT2JqZWN0RmllbGQoaSwgZmV0Y2hGaWVsZChpLCBmYWxz\nZSkpOwogICAgICAgICAgICAgICAgX3NpbmdsZS5wZXJzaXN0KGNhbGwpOwog\nICAgICAgICAgICAgICAgX3NpbmdsZS5jbGVhcigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTG9hZCB0aGUgZ2l2\nZW4gZmllbGQgc2V0IGZyb20gdGhlIGRhdGEgc3RvcmUgaW50byB0aGUgaW5z\ndGFuY2UuCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBhbnkgZGF0YSBpcyBsb2Fk\nZWQsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgYm9vbGVhbiBsb2Fk\nRmllbGRzKEJpdFNldCBmaWVsZHMsIEZldGNoQ29uZmlndXJhdGlvbiBmZXRj\naCwgaW50IGxvY2tMZXZlbCwKICAgICAgICBPYmplY3Qgc2RhdGEpIHsKICAg\nICAgICAvLyBjYW4ndCBsb2FkIHZlcnNpb24gZmllbGQgZnJvbSBzdG9yZQog\nICAgICAgIGlmIChmaWVsZHMgIT0gbnVsbCkgewogICAgICAgICAgICBGaWVs\nZE1ldGFEYXRhIHZmaWVsZCA9IF9tZXRhLmdldFZlcnNpb25GaWVsZCgpOwog\nICAgICAgICAgICBpZiAodmZpZWxkICE9IG51bGwpCiAgICAgICAgICAgICAg\nICBmaWVsZHMuY2xlYXIodmZpZWxkLmdldEluZGV4KCkpOwogICAgICAgIH0K\nCiAgICAgICAgYm9vbGVhbiByZXQgPSBmYWxzZTsKICAgICAgICBzZXRMb2Fk\naW5nKHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGlmIGFu\neSBmaWVsZHMgZ2l2ZW4sIGxvYWQgdGhlbQogICAgICAgICAgICBpbnQgbGVu\nID0gKGZpZWxkcyA9PSBudWxsKSA/IDAgOiBmaWVsZHMubGVuZ3RoKCk7CiAg\nICAgICAgICAgIGlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAo\nZmV0Y2ggPT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmZXRjaCA9IF9i\ncm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgICAg\nICBpZiAoIV9icm9rZXIuZ2V0U3RvcmVNYW5hZ2VyKCkubG9hZCh0aGlzLCBm\naWVsZHMsIGZldGNoLCBsb2NrTGV2ZWwsIHNkYXRhKSkgewogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBPYmplY3ROb3RGb3VuZEV4Y2VwdGlvbihf\nbG9jLmdldCgiZGVsLWluc3RhbmNlIiwgX21ldGEuZ2V0RGVzY3JpYmVkVHlw\nZSgpLCBfb2lkKSkuCiAgICAgICAgICAgICAgICAgICAgICAgIHNldEZhaWxl\nZE9iamVjdChnZXRNYW5hZ2VkSW5zdGFuY2UoKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdmVyc2lvbiBpbmZvcm1hdGlv\nbiBoYXMgYmVlbiBzZXQ7IHZlcnNpb24gaW5mbyBtdXN0CiAgICAgICAgICAg\nIC8vIGFsd2F5cyBiZSBzZXQgYWZ0ZXIgdGhlIGZpcnN0IHN0YXRlIGxvYWQg\nb3Igc2V0ICh3aGljaCBpcyB3aHkKICAgICAgICAgICAgLy8gd2UgZG8gdGhp\ncyBldmVuIGlmIG5vIGZpZWxkcyB3ZXJlIGxvYWRlZCAtLSBjb3VsZCBiZSB0\naGF0IHRoaXMKICAgICAgICAgICAgLy8gbWV0aG9kIGlzIGJlaW5nIGNhbGxl\nZCBhZnRlciBhIGZpZWxkIGlzIHNldCkKICAgICAgICAgICAgaWYgKF9sb2Fk\nVmVyc2lvbiA9PSBudWxsICYmIChfbWV0YSA9PSBudWxsIHx8IF9tZXRhLmdl\ndFZlcnNpb25GaWVsZCgpICE9IG51bGwpKSB7CiAgICAgICAgICAgICAgICBz\neW5jVmVyc2lvbihzZGF0YSk7CiAgICAgICAgICAgICAgICByZXQgPSByZXQg\nfHwgX2xvYWRWZXJzaW9uICE9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgZmluYWxseSB7CiAgICAgICAgICAgIHNldExvYWRpbmco\nZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgLy8gc2VlIGlmIHRoZSBkZmcg\naXMgbm93IGxvYWRlZDsgZG8gdGhpcyByZWdhcmRsZXNzIG9mIHdoZXRoZXIg\nd2UKICAgICAgICAvLyBsb2FkZWQgYW55IGZpZWxkcywgY2F1c2UgbWF5IGFs\ncmVhZHkgaGF2ZSBiZWVuIGxvYWRlZCBieQogICAgICAgIC8vIFN0b3JlTWFu\nYWdlciBkdXJpbmcgaW5pdGlhbGl6YXRpb24KICAgICAgICBwb3N0TG9hZCgt\nMSwgZmV0Y2gpOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBMb2FkIHRoZSBnaXZlbiBmaWVsZCdzIGZldGNoIGdyb3VwOyB0\naGUgZmllbGQgaXRzZWxmIG1heSBhbHJlYWR5IGJlCiAgICAgKiBsb2FkZWQg\naWYgaXQgaXMgYmVpbmcgc2V0IGJ5IHRoZSB1c2VyLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgdm9pZCBsb2FkRmllbGQoaW50IGZpZWxkLCBpbnQgbG9ja0xl\ndmVsLCBib29sZWFuIGZvcldyaXRlLAogICAgICAgIGJvb2xlYW4gZmdzKSB7\nCiAgICAgICAgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoID0gX2Jyb2tlci5n\nZXRGZXRjaENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBGaWVsZE1ldGFEYXRh\nIGZtZCA9IF9tZXRhLmdldEZpZWxkKGZpZWxkKTsKICAgICAgICBCaXRTZXQg\nZmllbGRzID0gbnVsbDsKCiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIGRmZyBm\naWVsZCBvciB3ZSBuZWVkIHRvIGxvYWQgb3VyIGRmZywgZG8gc28KICAgICAg\nICBpZiAoZmdzICYmIChfZmxhZ3MgJiBGTEFHX0xPQURFRCkgPT0gMCkKICAg\nICAgICAgICAgZmllbGRzID0gZ2V0VW5sb2FkZWRJbnRlcm5hbChmZXRjaCwg\nTE9BRF9GR1MsIG51bGwpOwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGZv\nciBsb2FkIGZldGNoIGdyb3VwCiAgICAgICAgU3RyaW5nIGxmZyA9IGZtZC5n\nZXRMb2FkRmV0Y2hHcm91cCgpOwogICAgICAgIGJvb2xlYW4gbGZnQWRkZWQg\nPSBmYWxzZTsKICAgICAgICBpZiAobGZnICE9IG51bGwpIHsgIAogICAgICAg\nICAgICBGaWVsZE1ldGFEYXRhW10gZm1kcyA9IF9tZXRhLmdldEZpZWxkcygp\nOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGZtZHMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmICghX2xvYWRlZC5nZXQoaSkg\nJiYgKGkgPT0gZmllbGQKICAgICAgICAgICAgICAgICAgICB8fCBmbWRzW2ld\nLmlzSW5GZXRjaEdyb3VwKGxmZykpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGZpZWxkcyA9PSBudWxsKQogICAgICAgICAgICAgICAgICAgICAgICBm\naWVsZHMgPSBuZXcgQml0U2V0KGZtZHMubGVuZ3RoKTsKICAgICAgICAgICAg\nICAgICAgICBmaWVsZHMuc2V0KGkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyByZWxhdGlvbiBmaWVsZCBpcyBs\nb2FkZWQgd2l0aCB0aGUgbG9hZC1mZXRjaC1ncm91cAogICAgICAgICAgICAv\nLyBidXQgdGhpcyBhZGRpdGlvbiBtdXN0IGJlIHJldmVydGVkIG9uY2UgdGhl\nIGxvYWQgaXMgb3ZlcgogICAgICAgICAgICBpZiAoIWZldGNoLmhhc0ZldGNo\nR3JvdXAobGZnKSkgewogICAgICAgICAgICAgICAgZmV0Y2guYWRkRmV0Y2hH\ncm91cChsZmcpOwogICAgICAgICAgICAgICAgbGZnQWRkZWQgPSB0cnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChmbWQuaXNJbkRlZmF1\nbHRGZXRjaEdyb3VwKCkgJiYgZmllbGRzID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gbm8gbG9hZCBncm91cCBidXQgZGZnOiBhZGQgZGZnIGZpZWxkcyBp\nZiB3ZSBoYXZlbid0IGFscmVhZHkKICAgICAgICAgICAgZmllbGRzID0gZ2V0\nVW5sb2FkZWRJbnRlcm5hbChmZXRjaCwgTE9BRF9GR1MsIG51bGwpOwogICAg\nICAgIH0gZWxzZSBpZiAoIV9sb2FkZWQuZ2V0KGZtZC5nZXRJbmRleCgpKSkg\newogICAgICAgICAgICAvLyBubyBsb2FkIGdyb3VwIG9yIGRmZzogbG9hZCBp\nbmRpdmlkdWFsIGZpZWxkCiAgICAgICAgICAgIGlmIChmaWVsZHMgPT0gbnVs\nbCkKICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ldyBCaXRTZXQoKTsKICAg\nICAgICAgICAgZmllbGRzLnNldChmbWQuZ2V0SW5kZXgoKSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBjYWxsIHRoaXMgbWV0aG9kIGV2ZW4gaWYgdGhlcmUg\nYXJlIG5vIHVubG9hZGVkIGZpZWxkczsgbG9hZEZpZWxkcwogICAgICAgIC8v\nIHRha2VzIGNhcmUgb2YgdGhpbmdzIGxpa2UgbG9hZGluZyB2ZXJzaW9uIGlu\nZm8gYW5kIHNldHRpbmcgUEMgZmxhZ3MKICAgICAgICB0cnkgewogICAgICAg\nICAgICBsb2FkRmllbGRzKGZpZWxkcywgZmV0Y2gsIGxvY2tMZXZlbCwgbnVs\nbCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGxmZ0Fk\nZGVkKQogICAgICAgICAgICAgICAgZmV0Y2gucmVtb3ZlRmV0Y2hHcm91cChs\nZmcpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBt\nZXRob2QgdG8gcHJvdmlkZSB0aGUgZ2l2ZW4gZmllbGQgbnVtYmVyIHRvIHRo\nZSBnaXZlbgogICAgICogZmllbGQgbWFuYWdlci4KICAgICAqLwogICAgdm9p\nZCBwcm92aWRlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBGaWVsZE1h\nbmFnZXIgc3RvcmUsIGludCBmaWVsZCkgewogICAgICAgIEZpZWxkTWFuYWdl\nciBiZWZvcmVGTSA9IF9mbTsKICAgICAgICBfZm0gPSBzdG9yZTsKICAgICAg\nICBwYy5wY1Byb3ZpZGVGaWVsZChmaWVsZCk7CiAgICAgICAgLy8gUmV0YWlu\naW5nIG9yaWdpbmFsIEZNIGJlY2F1c2Ugb2YgdGhlIHBvc3NpYmlsaXR5IG9m\nIHJlZW50cmFudCBjYWxscwogICAgICAgIGlmIChiZWZvcmVGTSAhPSBudWxs\nKSBfZm0gPSBiZWZvcmVGTTsKICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gcmVwbGFjZSB0aGUgZ2l2ZW4gZmllbGQgbnVtYmVyIHRv\nIHRoZSBnaXZlbgogICAgICogZmllbGQgbWFuYWdlci4KICAgICAqLwogICAg\ndm9pZCByZXBsYWNlRmllbGQoUGVyc2lzdGVuY2VDYXBhYmxlIHBjLCBGaWVs\nZE1hbmFnZXIgbG9hZCwgaW50IGZpZWxkKSB7CiAgICAgICAgRmllbGRNYW5h\nZ2VyIGJlZm9yZUZNID0gX2ZtOwogICAgICAgIF9mbSA9IGxvYWQ7CiAgICAg\nICAgcGMucGNSZXBsYWNlRmllbGQoZmllbGQpOwogICAgICAgIC8vIFJldGFp\nbmluZyBvcmlnaW5hbCBGTSBiZWNhdXNlIG9mIHRoZSBwb3NzaWJpbGl0eSBv\nZiByZWVudHJhbnQgY2FsbHMKICAgICAgICBpZiAoYmVmb3JlRk0gIT0gbnVs\nbCkgX2ZtID0gYmVmb3JlRk07CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJr\nIHRoZSBmaWVsZCBhcyBsb2FkZWQgb3IgdW5sb2FkZWQuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBzZXRMb2FkZWQoaW50IGZpZWxkLCBib29sZWFuIGlz\nTG9hZGVkKSB7CiAgICAgICAgLy8gZG9uJ3QgY29udGludWUgaWYgbG9hZGVk\nIHN0YXRlIGlzIGFscmVhZHkgY29ycmVjdDsgb3RoZXJ3aXNlIHdlCiAgICAg\nICAgLy8gY2FuIGVuZCB1cCBjbGVhcmluZyBfZmllbGRJbXBsIHdoZW4gd2Ug\nc2hvdWxkbid0CiAgICAgICAgaWYgKF9sb2FkZWQuZ2V0KGZpZWxkKSA9PSBp\nc0xvYWRlZCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpZiBs\nb2FkaW5nLCBjbGVhciBpbnRlcm1lZGlhdGUgZGF0YTsgaWYgdW5sb2FkaW5n\nLCBjbGVhciBpbXBsIGRhdGEKICAgICAgICBpZiAoX2ZpZWxkSW1wbCAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGludCBpZHggPSBfbWV0YS5nZXRFeHRyYUZp\nZWxkRGF0YUluZGV4KGZpZWxkKTsKICAgICAgICAgICAgaWYgKGlkeCAhPSAt\nMSkKICAgICAgICAgICAgICAgIF9maWVsZEltcGxbaWR4XSA9IG51bGw7CiAg\nICAgICAgfQoKICAgICAgICBpZiAoaXNMb2FkZWQpCiAgICAgICAgICAgIF9s\nb2FkZWQuc2V0KGZpZWxkKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9s\nb2FkZWQuY2xlYXIoZmllbGQpOwogICAgfQoKICAgIC8qKgogICAgICogUGVy\nZm9ybSBwb3N0LWxvYWQgc3RlcHMsIGluY2x1ZGluZyB0aGUgcG9zdCBsb2Fk\nIGNhbGxiYWNrLgogICAgICogV2UgaGF2ZSB0byBjaGVjayB0aGUgZGZnIGFm\ndGVyIGFsbCBmaWVsZCBsb2FkcyBiZWNhdXNlIGl0IG1pZ2h0IGJlCiAgICAg\nKiBsb2FkZWQgaW4gbXVsdGlwbGUgc3RlcHMgd2hlbiBwYWdpbmcgaXMgaW52\nb2x2ZWQ7IHRoZSBpbml0aWFsIGxvYWQKICAgICAqIG1pZ2h0IGV4Y2x1ZGUg\nc29tZSBmaWVsZHMgd2hpY2ggYXJlIHRoZW4gaW1tZWRpYXRlbHkgbG9hZGVk\nIGluIGEKICAgICAqIHNlcGFyYXRlIHN0ZXAgYmVmb3JlIGJlaW5nIHJldHVy\nbmVkIHRvIHRoZSB1c2VyLgogICAgICoKICAgICAqIEBwYXJhbSBmaWVsZCB0\naGUgZmllbGQgaW5kZXggdGhhdCB3YXMgbG9hZGVkLCBvciAtMSB0byBpbmRp\nY2F0ZQogICAgICogdGhhdCBhIGdyb3VwIG9mIHBvc3NpYmx5IHVua25vd24g\nZmllbGRzIHdhcyBsb2FkZWQKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHBv\nc3RMb2FkKGludCBmaWVsZCwgRmV0Y2hDb25maWd1cmF0aW9uIGZldGNoKSB7\nCiAgICAgICAgLy8gbm8gbmVlZCBmb3IgcG9zdExvYWQgY2FsbGJhY2s/CiAg\nICAgICAgaWYgKChfZmxhZ3MgJiBGTEFHX0xPQURFRCkgIT0gMCkKICAgICAg\nICAgICAgcmV0dXJuOwoKICAgICAgICAvLyBpbiB0aGUgbWlkZGxlIG9mIGEg\nZ3JvdXAgbG9hZCwgYWZ0ZXIgd2hpY2ggdGhpcyBtZXRob2Qgd2lsbCBiZQog\nICAgICAgIC8vIGNhbGxlZCBhZ2Fpbj8KICAgICAgICBpZiAoZmllbGQgIT0g\nLTEgJiYgaXNMb2FkaW5nKCkpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAg\nICAgLy8gbm8gbGlzdGVuZXJzPwogICAgICAgIExpZmVjeWNsZUV2ZW50TWFu\nYWdlciBtZ3IgPSBfYnJva2VyLmdldExpZmVjeWNsZUV2ZW50TWFuYWdlcigp\nOwogICAgICAgIGlmIChtZ3IgPT0gbnVsbCB8fCAhbWdyLmhhc0xvYWRMaXN0\nZW5lcnMoZ2V0TWFuYWdlZEluc3RhbmNlKCksIF9tZXRhKSkKICAgICAgICAg\nICAgcmV0dXJuOwoKICAgICAgICBpZiAoZmV0Y2ggPT0gbnVsbCkKICAgICAg\nICAgICAgZmV0Y2ggPSBfYnJva2VyLmdldEZldGNoQ29uZmlndXJhdGlvbigp\nOwogICAgICAgIC8vIGlzIHRoaXMgZmllbGQgYSBwb3N0LWxvYWQgZmllbGQ/\nCiAgICAgICAgaWYgKGZpZWxkICE9IC0xKSB7CiAgICAgICAgICAgIEZpZWxk\nTWV0YURhdGEgZm1kID0gX21ldGEuZ2V0RmllbGQoZmllbGQpOwogICAgICAg\nICAgICBpZiAoZm1kLmlzSW5EZWZhdWx0RmV0Y2hHcm91cCgpIAogICAgICAg\nICAgICAgICAgJiYgZmV0Y2guaGFzRmV0Y2hHcm91cChGZXRjaEdyb3VwLk5B\nTUVfREVGQVVMVCkKICAgICAgICAgICAgICAgICYmIHBvc3RMb2FkKEZldGNo\nR3JvdXAuTkFNRV9ERUZBVUxULCBmZXRjaCkpCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIFN0cmluZ1tdIGZncyA9IGZtZC5nZXRDdXN0\nb21GZXRjaEdyb3VwcygpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IGZncy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmIChmZXRj\naC5oYXNGZXRjaEdyb3VwKGZnc1tpXSkgJiYgcG9zdExvYWQoZmdzW2ldLCBm\nZXRjaCkpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXRyID0gZmV0Y2gu\nZ2V0RmV0Y2hHcm91cHMoKS5pdGVyYXRvcigpOyAKICAgICAgICAgICAgICAg\nIGl0ci5oYXNOZXh0KCk7KSB7CiAgICAgICAgICAgICAgICBpZiAocG9zdExv\nYWQoKFN0cmluZykgaXRyLm5leHQoKSwgZmV0Y2gpKQogICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFBlcmZvcm0gcG9zdC1sb2FkIGFjdGlvbnMgaWYg\ndGhlIGdpdmVuIGZldGNoIGdyb3VwIGlzIGEgcG9zdC1sb2FkIGdyb3VwCiAg\nICAgKiBhbmQgaXMgZnVsbHkgbG9hZGVkLgogICAgICovCiAgICBwcml2YXRl\nIGJvb2xlYW4gcG9zdExvYWQoU3RyaW5nIGZnTmFtZSwgRmV0Y2hDb25maWd1\ncmF0aW9uIGZldGNoKSB7CiAgICAgICAgRmV0Y2hHcm91cCBmZyA9IF9tZXRh\nLmdldEZldGNoR3JvdXAoZmdOYW1lKTsKICAgICAgICBpZiAoZmcgPT0gbnVs\nbCB8fCAhZmcuaXNQb3N0TG9hZCgpKQogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CgogICAgICAgIEZpZWxkTWV0YURhdGFbXSBmbWRzID0gX21ldGEuZ2V0\nRmllbGRzKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBmbWRzLmxl\nbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoIV9sb2FkZWQuZ2V0KGkpICYm\nIGZtZHNbaV0uaXNJbkZldGNoR3JvdXAoZmdOYW1lKSkKICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgX2ZsYWdzIHw9IEZMQUdfTE9B\nREVEOwogICAgICAgIF9icm9rZXIuZmlyZUxpZmVjeWNsZUV2ZW50KGdldE1h\nbmFnZWRJbnN0YW5jZSgpLCBmZXRjaCwgX21ldGEsIAogICAgICAgIAlMaWZl\nY3ljbGVFdmVudC5BRlRFUl9MT0FEKTsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFN5bmNocm9uaXplIG91ciB2ZXJzaW9u\nIG9iamVjdCB3aXRoIHRoZSBkYXRhc3RvcmUuCiAgICAgKi8KICAgIHByaXZh\ndGUgYm9vbGVhbiBzeW5jVmVyc2lvbihPYmplY3Qgc2RhdGEpIHsKICAgICAg\nICByZXR1cm4gX2Jyb2tlci5nZXRTdG9yZU1hbmFnZXIoKS5zeW5jVmVyc2lv\nbih0aGlzLCBzZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5z\nIHdoZXRoZXIgdGhpcyBpbnN0YW5jZSBuZWVkcyBhIHZlcnNpb24gY2hlY2su\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzVmVyc2lvbkNoZWNrUmVx\ndWlyZWQoKSB7CiAgICAgICAgLy8gZXhwbGljaXQgZmxhZyBmb3IgdmVyc2lv\nbiBjaGVjawogICAgICAgIGlmICgoX2ZsYWdzICYgRkxBR19WRVJTSU9OX0NI\nRUNLKSAhPSAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAg\naWYgKCFfYnJva2VyLmdldE9wdGltaXN0aWMoKSAmJiAhX2Jyb2tlci5nZXRD\nb25maWd1cmF0aW9uKCkuCiAgICAgICAgICAgIGdldENvbXBhdGliaWxpdHlJ\nbnN0YW5jZSgpLmdldE5vbk9wdGltaXN0aWNWZXJzaW9uQ2hlY2soKSkKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBfc3RhdGUu\naXNWZXJzaW9uQ2hlY2tSZXF1aXJlZCh0aGlzKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNldCB3aGV0aGVyIHRoaXMgaW5zdGFuY2UgcmVxdWlyZXMgYSB2\nZXJzaW9uIGNoZWNrIG9uIHRoZSBuZXh0IGZsdXNoLgogICAgICovCiAgICB2\nb2lkIHNldENoZWNrVmVyc2lvbihib29sZWFuIHZlcnNpb25DaGVjaykgewog\nICAgICAgIGlmICh2ZXJzaW9uQ2hlY2spCiAgICAgICAgICAgIF9mbGFncyB8\nPSBGTEFHX1ZFUlNJT05fQ0hFQ0s7CiAgICAgICAgZWxzZQogICAgICAgICAg\nICBfZmxhZ3MgJj0gfkZMQUdfVkVSU0lPTl9DSEVDSzsKICAgIH0KCiAgICAv\nKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGlzIGluc3RhbmNlIG5lZWRz\nIGEgdmVyc2lvbiB1cGRhdGUuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzVmVyc2lvblVwZGF0ZVJlcXVpcmVkKCkgewogICAgICAgIHJldHVybiAo\nX2ZsYWdzICYgRkxBR19WRVJTSU9OX1VQREFURSkgPiAwOwogICAgfQoKICAg\nIC8qKgogICAgICogU2V0IHdoZXRoZXIgdGhpcyBpbnN0YW5jZSByZXF1aXJl\ncyBhIHZlcnNpb24gdXBkYXRlIG9uIHRoZSBuZXh0IGZsdXNoLgogICAgICov\nCiAgICB2b2lkIHNldFVwZGF0ZVZlcnNpb24oYm9vbGVhbiB2ZXJzaW9uVXBk\nYXRlKSB7CiAgICAgICAgaWYgKHZlcnNpb25VcGRhdGUpCiAgICAgICAgICAg\nIF9mbGFncyB8PSBGTEFHX1ZFUlNJT05fVVBEQVRFOwogICAgICAgIGVsc2UK\nICAgICAgICAgICAgX2ZsYWdzICY9IH5GTEFHX1ZFUlNJT05fVVBEQVRFOwog\nICAgfQoKICAgIC8qKgogICAgICogVHJhbnNsYXRlIHRoZSBnaXZlbiBleGNl\ncHRpb24gYmFzZWQgb24gdGhlIGJyb2tlcidzIGltcGxpY2l0IGJlaGF2aW9y\nLgogICAgICogVHJhbnNsYXRpb24gb25seSBvY2N1cnMgaWYgdGhlIGV4Y2Vw\ndGlvbiBpcyBpbml0aWF0ZWQgYnkgYSB1c2VyIGFjdGlvbgogICAgICogb24g\nYW4gaW5zdGFuY2UsIGFuZCB0aGVyZWZvcmUgd2lsbCBub3QgYmUgY2F1Z2h0\nIGFuZCB0cmFuc2xhdGVkIGJ5IHRoZQogICAgICogYnJva2VyLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgUnVudGltZUV4Y2VwdGlvbiB0cmFuc2xhdGUoUnVu\ndGltZUV4Y2VwdGlvbiByZSkgewogICAgICAgIFJ1bnRpbWVFeGNlcHRpb25U\ncmFuc2xhdG9yIHRyYW5zID0gX2Jyb2tlci5nZXRJbnN0YW5jZUV4Y2VwdGlv\nblRyYW5zbGF0b3IoKTsKICAgICAgICByZXR1cm4gKHRyYW5zID09IG51bGwp\nID8gcmUgOiB0cmFucy50cmFuc2xhdGUocmUpOwogICAgfQoKICAgIC8qKgog\nICAgICogTG9jayB0aGUgc3RhdGUgbWFuYWdlciBpZiB0aGUgbXVsdGl0aHJl\nYWRlZCBvcHRpb24gaXMgc2V0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBsb2NrKCkgewogICAgICAgIGlmIChfaW5zdGFuY2VMb2NrICE9IG51bGwp\nCiAgICAgICAgCV9pbnN0YW5jZUxvY2subG9jaygpOwogICAgfQoKICAgIC8q\nKgogICAgICogVW5sb2NrIHRoZSBzdGF0ZSBtYW5hZ2VyLgogICAgICovCglw\ncm90ZWN0ZWQgdm9pZCB1bmxvY2sgKCkgewogICAgICAgIGlmIChfaW5zdGFu\nY2VMb2NrICE9IG51bGwpCiAgICAgICAgCV9pbnN0YW5jZUxvY2sudW5sb2Nr\nKCk7Cgl9CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlT2JqZWN0KE9iamVjdE91\ndHB1dFN0cmVhbSBvb3MpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nb29zLndyaXRlT2JqZWN0KF9icm9rZXIpOwogICAgICAgIG9vcy5kZWZhdWx0\nV3JpdGVPYmplY3QoKTsKICAgICAgICBvb3Mud3JpdGVPYmplY3QoX21ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpKTsKICAgICAgICB3cml0ZVBDKG9vcywgX3Bj\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIDxjb2RlPnBjPC9jb2Rl\nPiB0byA8Y29kZT5vb3M8L2NvZGU+LCBoYW5kbGluZyBpbnRlcm5hbC1mb3Jt\nCiAgICAgKiBzZXJpYWxpemF0aW9uLiA8Y29kZT5wYzwvY29kZT4gbXVzdCBi\nZSBvZiB0aGUgc2FtZSB0eXBlIHRoYXQgdGhpcwogICAgICogc3RhdGUgbWFu\nYWdlciBtYW5hZ2VzLgogICAgICoKICAgICAqIEBzaW5jZSAxLjEuMAogICAg\nICovCiAgICB2b2lkIHdyaXRlUEMoT2JqZWN0T3V0cHV0U3RyZWFtIG9vcywg\nUGVyc2lzdGVuY2VDYXBhYmxlIHBjKQogICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKCFTZXJpYWxpemFibGUuY2xhc3MuaXNBc3Np\nZ25hYmxlRnJvbShfbWV0YS5nZXREZXNjcmliZWRUeXBlKCkpKQogICAgICAg\nICAgICB0aHJvdyBuZXcgTm90U2VyaWFsaXphYmxlRXhjZXB0aW9uKF9tZXRh\nLmdldERlc2NyaWJlZFR5cGUoKS5nZXROYW1lKCkpOwoKICAgICAgICBvb3Mu\nd3JpdGVPYmplY3QocGMpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWFk\nT2JqZWN0KE9iamVjdElucHV0U3RyZWFtIGluKQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAg\nX2Jyb2tlciA9IChCcm9rZXJJbXBsKSBpbi5yZWFkT2JqZWN0KCk7CiAgICAg\nICAgaW4uZGVmYXVsdFJlYWRPYmplY3QoKTsKCiAgICAgICAgLy8gd2UgbmVl\nZCB0byBzdG9yZSB0aGUgY2xhc3MgYmVmb3JlIHRoZSBwYyBpbnN0YW5jZSBz\nbyB0aGF0IHdlIGNhbgogICAgICAgIC8vIGNyZWF0ZSBfbWV0YSBiZWZvcmUg\nY2FsbGluZyByZWFkUEMoKSwgd2hpY2ggcmVsaWVzIG9uIF9tZXRhIGJlaW5n\nCiAgICAgICAgLy8gbm9uLW51bGwgd2hlbiByZWNvbnN0aXR1dGluZyBSZWZs\nZWN0aW5nUEMgaW5zdGFuY2VzLiBTYWRseSwgdGhpcwogICAgICAgIC8vIHBl\nbmFsaXplcyB0aGUgc2VyaWFsaXphdGlvbiBmb290cHJpbnQgb2Ygbm9uLVJl\nZmxlY3RpbmdQQyBTTXMgYWxzby4KICAgICAgICBDbGFzcyBtYW5hZ2VkVHlw\nZSA9IChDbGFzcykgaW4ucmVhZE9iamVjdCgpOwogICAgICAgIF9tZXRhID0g\nX2Jyb2tlci5nZXRDb25maWd1cmF0aW9uKCkuZ2V0TWV0YURhdGFSZXBvc2l0\nb3J5SW5zdGFuY2UoKQogICAgICAgICAgICAuZ2V0TWV0YURhdGEobWFuYWdl\nZFR5cGUsIG51bGwsIHRydWUpOwoKICAgICAgICBfcGMgPSByZWFkUEMoaW4p\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydHMgdGhlIGRlc2VyaWFs\naXplZCA8Y29kZT5vPC9jb2RlPiB0byBhIHtAbGluayBQZXJzaXN0ZW5jZUNh\ncGFibGV9CiAgICAgKiBpbnN0YW5jZSBhcHByb3ByaWF0ZSBmb3Igc3Rvcmlu\nZyBpbiA8Y29kZT5fcGM8L2NvZGU+LgogICAgICoKICAgICAqIEBzaW5jZSAx\nLjEuMAogICAgICovCiAgICBQZXJzaXN0ZW5jZUNhcGFibGUgcmVhZFBDKE9i\namVjdElucHV0U3RyZWFtIGluKQogICAgICAgIHRocm93cyBDbGFzc05vdEZv\ndW5kRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgT2JqZWN0IG8g\nPSBpbi5yZWFkT2JqZWN0KCk7CgogICAgICAgIGlmIChvID09IG51bGwpCiAg\nICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICBQZXJzaXN0ZW5jZUNh\ncGFibGUgcGM7CiAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIFBlcnNpc3Rl\nbmNlQ2FwYWJsZSkpCiAgICAgICAgICAgIHBjID0gSW1wbEhlbHBlci50b1Bl\ncnNpc3RlbmNlQ2FwYWJsZShvLCB0aGlzKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIHBjID0gKFBlcnNpc3RlbmNlQ2FwYWJsZSkgbzsKCiAgICAgICAg\ncGMucGNSZXBsYWNlU3RhdGVNYW5hZ2VyKHRoaXMpOwogICAgICAgIHJldHVy\nbiBwYzsKICAgIH0KICAgIAogICAgcHVibGljIExpc3Q8RmllbGRNZXRhRGF0\nYT4gZ2V0TWFwcGVkQnlJZEZpZWxkcygpIHsKICAgICAgICByZXR1cm4gX21h\ncHBlZEJ5SWRGaWVsZHM7CiAgICB9CiAgICAKICAgIHB1YmxpYyBib29sZWFu\nIHJlcXVpcmVzRmV0Y2goRmllbGRNZXRhRGF0YSBmbWQpIHsKICAgICAgICBy\nZXR1cm4gKF9icm9rZXIuZ2V0RmV0Y2hDb25maWd1cmF0aW9uKCkucmVxdWly\nZXNGZXRjaChmbWQpICE9IEZldGNoQ29uZmlndXJhdGlvbi5GRVRDSF9OT05F\nKTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgc2V0UGMoUGVyc2lzdGVu\nY2VDYXBhYmxlIHBjKSB7CiAgICAgICAgX3BjID0gcGM7CiAgICB9Cn0K\n","encoding":"base64"}

