{"sha":"470e7745a267fb4c5e7a35dfb18facbad4320ab3","node_id":"MDQ6QmxvYjIwNjM2NDo0NzBlNzc0NWEyNjdmYjRjNWU3YTM1ZGZiMThmYWNiYWQ0MzIwYWIz","size":19894,"url":"https://api.github.com/repos/apache/openjpa/git/blobs/470e7745a267fb4c5e7a35dfb18facbad4320ab3","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5v\ncmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVk\nIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAog\nKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBk\naXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdB\nUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVy\nIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuICAgIAogKi8K\ncGFja2FnZSBvcmcuYXBhY2hlLm9wZW5qcGEua2VybmVsLmV4cHM7CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZh\nLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5rZXJuZWwu\nRmlsdGVyczsKaW1wb3J0IG9yZy5hcGFjaGUub3BlbmpwYS5saWIudXRpbC5M\nb2NhbGl6ZXI7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGliLnV0aWwu\nU3RyaW5nRGlzdGFuY2U7CmltcG9ydCBvcmcuYXBhY2hlLm9wZW5qcGEubGli\nLnV0aWwuTG9jYWxpemVyLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLm9w\nZW5qcGEubWV0YS5DbGFzc01ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5v\ncGVuanBhLm1ldGEuRmllbGRNZXRhRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUu\nb3BlbmpwYS5tZXRhLkphdmFUeXBlczsKaW1wb3J0IG9yZy5hcGFjaGUub3Bl\nbmpwYS5tZXRhLlhNTE1ldGFEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5vcGVu\nanBhLnV0aWwuSW50ZXJuYWxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLm9wZW5qcGEudXRpbC5PcGVuSlBBRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5vcGVuanBhLnV0aWwuVW5zdXBwb3J0ZWRFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLm9wZW5qcGEudXRpbC5Vc2VyRXhjZXB0aW9uOwppbXBv\ncnQgc2VycC51dGlsLlN0cmluZ3M7CgovKioKICogQWJzdHJhY3QgYmFzZSBj\nbGFzcyB0byBoZWxwIGJ1aWxkIGV4cHJlc3Npb25zLiBQcm92aWRlcwogKiBn\nZW5lcmljIGxhbmd1YWdlLWluZGVwZW5kZW50IHN1cHBvcnQgZm9yIHZhcmlh\nYmxlIHJlc29sdXRpb24sCiAqIHBhdGggdHJhdmVyc2FsLCBhbmQgZXJyb3Ig\nbWVzc2FnZXMuCiAqCiAqIEBhdXRob3IgTWFyYyBQcnVkJ2hvbW1lYXV4CiAq\nIEBub2phdmFkb2MKICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFj\ndEV4cHJlc3Npb25CdWlsZGVyIHsKCiAgICAvLyB1c2VkIGZvciBlcnJvciBt\nZXNzYWdlcwogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBpbnQgRVhfVVNF\nUiA9IDA7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBFWF9GQVRB\nTCA9IDE7CiAgICBwcm90ZWN0ZWQgc3RhdGljIGZpbmFsIGludCBFWF9VTlNV\nUFBPUlRFRCA9IDI7CgogICAgLy8gY29tbW9uIGltcGxpY2l0IHR5cGUgc2V0\ndGluZ3MKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgQ2xhc3M8T2JqZWN0PiBU\nWVBFX09CSkVDVCA9IE9iamVjdC5jbGFzczsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgQ2xhc3M8U3RyaW5nPiBUWVBFX1NUUklORyA9IFN0cmluZy5jbGFz\nczsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgQ2xhc3M8Q2hhcmFjdGVyPiBU\nWVBFX0NIQVJfT0JKID0gQ2hhcmFjdGVyLmNsYXNzOwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBDbGFzczxOdW1iZXI+IFRZUEVfTlVNQkVSID0gTnVtYmVy\nLmNsYXNzOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBDbGFzczxDb2xsZWN0\naW9uPiBUWVBFX0NPTExFQ1RJT04gPSBDb2xsZWN0aW9uLmNsYXNzOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBDbGFzczxNYXA+IFRZUEVfTUFQID0gTWFw\nLmNsYXNzOwoKICAgIC8vIGNvbnRhaW5zIHR5cGVzIGZvciBzZXRJbXBsaWNp\ndFR5cGVzCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDT05UQUlOU19U\nWVBFX0VMRU1FTlQgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nQ09OVEFJTlNfVFlQRV9LRVkgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgQ09OVEFJTlNfVFlQRV9WQUxVRSA9IDM7CgogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9jYWxpemVyIF9sb2MgPSBMb2NhbGl6ZXIuZm9yUGFj\na2FnZQogICAgICAgIChBYnN0cmFjdEV4cHJlc3Npb25CdWlsZGVyLmNsYXNz\nKTsKCiAgICBwcm90ZWN0ZWQgZmluYWwgUmVzb2x2ZXIgcmVzb2x2ZXI7CiAg\nICBwcm90ZWN0ZWQgRXhwcmVzc2lvbkZhY3RvcnkgZmFjdG9yeTsKCiAgICBw\ncml2YXRlIGZpbmFsIFNldDxDbGFzc01ldGFEYXRhPiBfYWNjZXNzUGF0aCA9\nIG5ldyBIYXNoU2V0PENsYXNzTWV0YURhdGE+KCk7CiAgICBwcml2YXRlIE1h\ncDxTdHJpbmcsVmFsdWU+IF9zZWVuVmFycyA9IG51bGw7CiAgICBwcml2YXRl\nIFNldDxWYWx1ZT4gX2JvdW5kVmFycyA9IG51bGw7CgogICAgLyoqCiAgICAg\nKiBDb25zdHJ1Y3Rvci4KICAgICAqCiAgICAgKiBAcGFyYW0gZmFjdG9yeSB0\naGUgZXhwcmVzc2lvbiBmYWN0b3J5IHRvIHVzZQogICAgICogQHBhcmFtIHJl\nc29sdmVyIHVzZWQgdG8gcmVzb2x2ZSB2YXJpYWJsZXMsIHBhcmFtZXRlcnMs\nIGFuZCBjbGFzcwogICAgICogbmFtZXMgdXNlZCBpbiB0aGUgcXVlcnkKICAg\nICAqLwogICAgcHVibGljIEFic3RyYWN0RXhwcmVzc2lvbkJ1aWxkZXIoRXhw\ncmVzc2lvbkZhY3RvcnkgZmFjdG9yeSwKICAgICAgICBSZXNvbHZlciByZXNv\nbHZlcikgewogICAgICAgIHRoaXMuZmFjdG9yeSA9IGZhY3Rvcnk7CiAgICAg\nICAgdGhpcy5yZXNvbHZlciA9IHJlc29sdmVyOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJucyB0aGUgY2xhc3MgbG9hZGVyIHRoYXQgc2hvdWxkIGJl\nIHVzZWQgZm9yIHJlc29sdmluZwogICAgICogY2xhc3MgbmFtZXMgKGluIGFk\nZGl0aW9uIHRvIHRoZSByZXNvbHZlciBpbiB0aGUgcXVlcnkpLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgQ2xhc3NMb2FkZXIgZ2V0Q2xhc3NM\nb2FkZXIoKTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIHByb3BlciBwYXJz\nZSBleGNlcHRpb24gZm9yIHRoZSBnaXZlbiByZWFzb24uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBPcGVuSlBBRXhjZXB0aW9uIHBhcnNlRXhjZXB0aW9uKGlu\ndCBlLCBTdHJpbmcgdG9rZW4sCiAgICAgICAgT2JqZWN0W10gYXJncywKICAg\nICAgICBFeGNlcHRpb24gbmVzdCkgewogICAgICAgIFN0cmluZyBhcmdTdHI7\nCiAgICAgICAgaWYgKGFyZ3MgPT0gbnVsbCkKICAgICAgICAgICAgYXJnU3Ry\nID0gZ2V0TG9jYWxpemVyKCkuZ2V0KHRva2VuKS5nZXRNZXNzYWdlKCk7CiAg\nICAgICAgZWxzZQogICAgICAgICAgICBhcmdTdHIgPSBnZXRMb2NhbGl6ZXIo\nKS5nZXQodG9rZW4sIGFyZ3MpLmdldE1lc3NhZ2UoKTsKCiAgICAgICAgTWVz\nc2FnZSBtc2cgPSBfbG9jLmdldCgicGFyc2UtZXJyb3IiLCBhcmdTdHIsIGN1\ncnJlbnRRdWVyeSgpKTsKCiAgICAgICAgc3dpdGNoIChlKSB7CiAgICAgICAg\nICAgIGNhc2UgRVhfRkFUQUw6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSW50ZXJuYWxFeGNlcHRpb24obXNnLCBuZXN0KTsKICAgICAgICAgICAgY2Fz\nZSBFWF9VTlNVUFBPUlRFRDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBV\nbnN1cHBvcnRlZEV4Y2VwdGlvbihtc2csIG5lc3QpOwogICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRp\nb24obXNnLCBuZXN0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZWdpc3RlciB0aGUgc3BlY2lmaWVkIG1ldGFkYXRhIGFzIGJlaW5nIGlu\nIHRoZSBxdWVyeSdzIGFjY2VzcyBwYXRoLgogICAgICovCiAgICBwcm90ZWN0\nZWQgQ2xhc3NNZXRhRGF0YSBhZGRBY2Nlc3NQYXRoKENsYXNzTWV0YURhdGEg\nbWV0YSkgewogICAgICAgIF9hY2Nlc3NQYXRoLmFkZChtZXRhKTsKICAgICAg\nICByZXR1cm4gbWV0YTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0\naGUgcmVjb3JkZWQgcXVlcnkgYWNjZXNzIHBhdGguCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBDbGFzc01ldGFEYXRhW10gZ2V0QWNjZXNzUGF0aCgpIHsKICAg\nICAgICByZXR1cm4gKENsYXNzTWV0YURhdGFbXSkgX2FjY2Vzc1BhdGgudG9B\ncnJheQogICAgICAgICAgICAobmV3IENsYXNzTWV0YURhdGFbX2FjY2Vzc1Bh\ndGguc2l6ZSgpXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdHJ1\nZSBpZiB0aGUgZ2l2ZW4gdmFyaWFibGUgaGFzIGJlZW4gYm91bmQuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzQm91bmQoVmFsdWUgdmFyKSB7\nCiAgICAgICAgcmV0dXJuIF9ib3VuZFZhcnMgIT0gbnVsbCAmJiBfYm91bmRW\nYXJzLmNvbnRhaW5zKHZhcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNv\ncmQgdGhhdCB0aGUgZ2l2ZW4gdmFyaWFibGUgaXMgYm91bmQuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGJpbmQoVmFsdWUgdmFyKSB7CiAgICAgICAg\naWYgKF9ib3VuZFZhcnMgPT0gbnVsbCkKICAgICAgICAgICAgX2JvdW5kVmFy\ncyA9IG5ldyBIYXNoU2V0PFZhbHVlPigpOwogICAgICAgIF9ib3VuZFZhcnMu\nYWRkKHZhcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgdmFs\ndWUgZm9yIHRoZSBnaXZlbiBpZC4KICAgICAqLwogICAgcHJvdGVjdGVkIFZh\nbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCwgYm9vbGVhbiBiaW5kKSB7CiAg\nICAgICAgLy8gY2hlY2sgZm9yIGFscmVhZHkgY29uc3RydWN0ZWQgdmFyCiAg\nICAgICAgaWYgKGlzU2VlblZhcmlhYmxlKGlkKSkKICAgICAgICAgICAgcmV0\ndXJuIGdldFZhcmlhYmxlKGlkKTsKCiAgICAgICAgcmV0dXJuIGNyZWF0ZVZh\ncmlhYmxlKGlkLCBiaW5kKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgVmFsdWUg\nY3JlYXRlVmFyaWFibGUoU3RyaW5nIGlkLCBib29sZWFuIGJpbmQpIHsKICAg\nICAgICAvLyBjcmVhdGUgYW5kIGNhY2hlIHZhcgogICAgICAgIENsYXNzPD8+\nIHR5cGUgPSBnZXREZWNsYXJlZFZhcmlhYmxlVHlwZShpZCk7CgogICAgICAg\nIC8vIGFkZCB0aGlzIHR5cGUgdG8gdGhlIHNldCBvZiBjbGFzc2VzIGluIHRo\nZSBmaWx0ZXIncyBhY2Nlc3MgcGF0aAogICAgICAgIENsYXNzTWV0YURhdGEg\nbWV0YSA9IG51bGw7CiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkKICAgICAg\nICAgICAgdHlwZSA9IFRZUEVfT0JKRUNUOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgbWV0YSA9IGdldE1ldGFEYXRhKHR5cGUsIGZhbHNlKTsKICAgICAg\nICBpZiAobWV0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIGFkZEFjY2Vzc1Bh\ndGgobWV0YSk7CiAgICAgICAgICAgIGFkZFNjaGVtYVRvQ29udGV4dChpZCwg\nbWV0YSk7CiAgICAgICAgfQoKICAgICAgICBWYWx1ZSB2YXIgPSBudWxsOwog\nICAgICAgIGlmIChiaW5kKQogICAgICAgICAgICB2YXIgPSBmYWN0b3J5Lm5l\nd0JvdW5kVmFyaWFibGUoaWQsIHR5cGUpOwogICAgICAgIGVsc2UKICAgICAg\nICAgICAgdmFyID0gZmFjdG9yeS5uZXdVbmJvdW5kVmFyaWFibGUoaWQsIHR5\ncGUpOwogICAgICAgIHZhci5zZXRNZXRhRGF0YShtZXRhKTsKCiAgICAgICAg\naWYgKF9zZWVuVmFycyA9PSBudWxsKQogICAgICAgICAgICBfc2VlblZhcnMg\nPSBuZXcgSGFzaE1hcDxTdHJpbmcsVmFsdWU+KCk7CiAgICAgICAgX3NlZW5W\nYXJzLnB1dChpZCwgdmFyKTsKCiAgICAgICAgYWRkVmFyaWFibGVUb0NvbnRl\neHQoaWQsIHZhcik7CiAgICAgICAgcmV0dXJuIHZhcjsKICAgIH0KCiAgICAv\nKioKICAgICAqIFZhbGlkYXRlIHRoYXQgYWxsIHVuYm91bmQgdmFyaWFibGVz\nIGFyZSBvZiBhIFBDIHR5cGUuIElmIG5vdCwgYXNzdW1lCiAgICAgKiB0aGF0\nIHRoZSB1c2VyIGFjdHVhbGx5IG1hZGUgYSB0eXBvIHRoYXQgd2UgdG9vayBm\nb3IgYW4gaW1wbGljaXQKICAgICAqIHVuYm91bmQgdmFyaWFibGUuCiAgICAg\nKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydFVuYm91bmRWYXJpYWJsZXNW\nYWxpZCgpIHsKICAgICAgICBpZiAoX3NlZW5WYXJzID09IG51bGwpCiAgICAg\nICAgICAgIHJldHVybjsKCiAgICAgICAgVmFsdWUgdmFyOwogICAgICAgIGZv\nciAoTWFwLkVudHJ5PFN0cmluZyxWYWx1ZT4gZW50cnkgOiBfc2VlblZhcnMu\nZW50cnlTZXQoKSkgewogICAgICAgICAgICB2YXIgPSBlbnRyeS5nZXRWYWx1\nZSgpOwogICAgICAgICAgICBpZiAodmFyLmdldE1ldGFEYXRhKCkgPT0gbnVs\nbCAmJiAhaXNCb3VuZCh2YXIpCiAgICAgICAgICAgICAgICAmJiAhaXNEZWNs\nYXJlZFZhcmlhYmxlKGVudHJ5LmdldEtleSgpKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgcGFyc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vdC11bmJvdW5k\nLXZhciIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBlbnRy\neS5nZXRLZXkoKSB9LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgc3Bl\nY2lmaWVkIHZhcmlhYmxlIG5hbWUgaGFzIGJlZW4gZXhwbGljaXRseQogICAg\nICogZGVjbGFyZWQuIE5vdGUgYWxsIHF1ZXJ5IGxhbmd1YWdlcyBuZWNlc3Nh\ncmlseSBzdXBwb3J0IGRlY2xhcmluZwogICAgICogdmFyaWFibGVzLgogICAg\nICoKICAgICAqIEBwYXJhbSBpZCB0aGUgdmFyaWFibGUgdG8gY2hlY2sKICAg\nICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdmFyaWFiZSBoYXMgYmVlbiBleHBs\naWNpdGVseSBkZWNsYXJlZAogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJh\nY3QgYm9vbGVhbiBpc0RlY2xhcmVkVmFyaWFibGUoU3RyaW5nIGlkKTsKCiAg\nICAvKioKICAgICAqIFJldHVybiB3aGV0aGVyIHRoZSBnaXZlbiBpZCBoYXMg\nYmVlbiB1c2VkIGFzIGEgdmFyaWFibGUuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCBib29sZWFuIGlzU2VlblZhcmlhYmxlKFN0cmluZyBpZCkgewogICAgICAg\nIHJldHVybiBfc2VlblZhcnMgIT0gbnVsbCAmJiBfc2VlblZhcnMuY29udGFp\nbnNLZXkoaWQpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2Ug\nbWV0aG9kIHRvIGdldCBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRh\nKENsYXNzPD8+IGMsIGJvb2xlYW4gcmVxdWlyZWQpIHsKICAgICAgICByZXR1\ncm4gZ2V0TWV0YURhdGEoYywgcmVxdWlyZWQsIGdldENsYXNzTG9hZGVyKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVuY2UgbWV0aG9kIHRv\nIGdldCBtZXRhZGF0YSBmb3IgdGhlIGdpdmVuIHR5cGUuCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBDbGFzc01ldGFEYXRhIGdldE1ldGFEYXRhKENsYXNzPD8+\nIGMsIGJvb2xlYW4gcmVxdWlyZWQsCiAgICAgICAgQ2xhc3NMb2FkZXIgbG9h\nZGVyKSB7CiAgICAgICAgcmV0dXJuIHJlc29sdmVyLmdldENvbmZpZ3VyYXRp\nb24oKS5nZXRNZXRhRGF0YVJlcG9zaXRvcnlJbnN0YW5jZSgpLgogICAgICAg\nICAgICBnZXRNZXRhRGF0YShjLCBsb2FkZXIsIHJlcXVpcmVkKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRyYXZlcnNlIHRoZSBnaXZlbiBmaWVsZCBpbiB0\naGUgZ2l2ZW4gcGF0aC4KICAgICAqLwogICAgcHJvdGVjdGVkIFZhbHVlIHRy\nYXZlcnNlUGF0aChQYXRoIHBhdGgsIFN0cmluZyBmaWVsZCkgewogICAgICAg\nIHJldHVybiB0cmF2ZXJzZVBhdGgocGF0aCwgZmllbGQsIGZhbHNlLCBmYWxz\nZSk7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBWYWx1ZSB0cmF2ZXJzZVhQ\nYXRoKFBhdGggcGF0aCwgU3RyaW5nIGZpZWxkKSB7CiAgICAgICAgWE1MTWV0\nYURhdGEgbWV0YSA9IHBhdGguZ2V0WG1sTWFwcGluZygpOwogICAgICAgIGlm\nIChtZXRhLmdldEZpZWxkTWFwcGluZyhmaWVsZCkgPT0gbnVsbCkgewogICAg\nICAgICAgICB0aHJvdyBwYXJzZUV4Y2VwdGlvbihFWF9VU0VSLCAibm8tZmll\nbGQiLAogICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXsgbWV0YS5n\nZXRUeXBlKCksIGZpZWxkIH0sIG51bGwpOwogICAgICAgIH0KICAgICAgICBl\nbHNlIHsKICAgICAgICAgICAgLy8gY29sbGVjdGlvbi12YWx1ZWQgeHBhdGgg\naXMgbm90IGFsbG93ZWQKICAgICAgICAgICAgaW50IHR5cGUgPSBtZXRhLmdl\ndEZpZWxkTWFwcGluZyhmaWVsZCkuZ2V0VHlwZUNvZGUoKTsKICAgICAgICAg\nICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIEphdmFU\neXBlcy5BUlJBWToKICAgICAgICAgICAgICAgIGNhc2UgSmF2YVR5cGVzLkNP\nTExFQ1RJT046CiAgICAgICAgICAgICAgICBjYXNlIEphdmFUeXBlcy5NQVA6\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24o\nX2xvYy5nZXQoImNvbGxlY3Rpb24tdmFsdWVkLXBhdGgiLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmllbGQpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBwYXRoLmdldChtZXRhLCBmaWVsZCk7CiAgICAgICAg\ncmV0dXJuIHBhdGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmF2ZXJzZSB0\naGUgZ2l2ZW4gZmllbGQgaW4gdGhlIGdpdmVuIHBhdGguCiAgICAgKi8KICAg\nIHByb3RlY3RlZCBWYWx1ZSB0cmF2ZXJzZVBhdGgoUGF0aCBwYXRoLCBTdHJp\nbmcgZmllbGQsIGJvb2xlYW4gcGNPbmx5LAogICAgICAgIGJvb2xlYW4gYWxs\nb3dOdWxsKSB7CiAgICAgICAgQ2xhc3NNZXRhRGF0YSBtZXRhID0gcGF0aC5n\nZXRNZXRhRGF0YSgpOwogICAgICAgIGlmIChtZXRhID09IG51bGwpCiAgICAg\nICAgICAgIHRocm93IHBhcnNlRXhjZXB0aW9uKEVYX1VTRVIsICJwYXRoLW5v\nLW1ldGEiLAogICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdeyBmaWVsZCwg\ncGF0aC5nZXRUeXBlKCkgfSwgbnVsbCk7CgogICAgICAgIEZpZWxkTWV0YURh\ndGEgZm1kID0gbWV0YS5nZXRGaWVsZChmaWVsZCk7CiAgICAgICAgaWYgKGZt\nZCA9PSBudWxsKSB7CiAgICAgICAgICAgIE9iamVjdCB2YWwgPSB0cmF2ZXJz\nZVN0YXRpY0ZpZWxkKG1ldGEuZ2V0RGVzY3JpYmVkVHlwZSgpLCBmaWVsZCk7\nCiAgICAgICAgICAgIGlmICh2YWwgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgaWYgKGlzTXVsdGlWYWx1ZWRUcmF2ZXJzYWxBdHRlbXB0KHBhdGgsIGZp\nZWxkKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IHBhcnNlRXhjZXB0\naW9uKEVYX1VTRVIsICJtdWx0aS12YWx1ZWQtdHJhdmVzYWwiLCBuZXcgT2Jq\nZWN0W117ZmllbGQsIHBhdGgubGFzdCgpfSwgbnVsbCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIAlTdHJpbmdbXSBhbGwgPSBtZXRhLmdldEZp\nZWxkTmFtZXMoKTsKICAgICAgICAgICAgCUNsYXNzPD8+IGNscyA9IG1ldGEu\nZ2V0RGVzY3JpYmVkVHlwZSgpOwogICAgICAgICAgICAgICAgdGhyb3cgcGFy\nc2VFeGNlcHRpb24oRVhfVVNFUiwgIm5vLWZpZWxkIiwKICAgICAgICAgICAg\nICAgICAgICBuZXcgT2JqZWN0W10ge2ZpZWxkLCBjbHMuZ2V0U2ltcGxlTmFt\nZSgpLCAKICAgICAgICAgICAgICAgICAgICBTdHJpbmdEaXN0YW5jZS5nZXRD\nbG9zZXN0TGV2ZW5zaHRlaW5EaXN0YW5jZShmaWVsZCwgYWxsKSwgCiAgICAg\nICAgICAgICAgICAJY2xzLmdldE5hbWUoKSwgQXJyYXlzLnRvU3RyaW5nKGFs\nbCl9LCBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJu\nIGZhY3RvcnkubmV3TGl0ZXJhbCh2YWwsIExpdGVyYWwuVFlQRV9VTktOT1dO\nKTsKICAgICAgICB9CgogICAgICAgIGlmIChmbWQuaXNFbWJlZGRlZCgpKQog\nICAgICAgICAgICBtZXRhID0gZm1kLmdldEVtYmVkZGVkTWV0YURhdGEoKTsK\nICAgICAgICBlbHNlCiAgICAgICAgICAgIG1ldGEgPSBmbWQuZ2V0RGVjbGFy\nZWRUeXBlTWV0YURhdGEoKTsKICAgICAgICBpZiAobWV0YSAhPSBudWxsKSB7\nCiAgICAgICAgICAgIGFkZEFjY2Vzc1BhdGgobWV0YSk7CiAgICAgICAgICAg\nIHBhdGguc2V0TWV0YURhdGEobWV0YSk7CiAgICAgICAgfQogICAgICAgIGVs\nc2UgewogICAgICAgICAgICAvLyB4bWxzdXBwb3J0IHhwYXRoCiAgICAgICAg\nICAgIFhNTE1ldGFEYXRhIHhtbG1ldGEgPSBmbWQuZ2V0UmVwb3NpdG9yeSgp\nLmdldFhNTE1ldGFEYXRhKGZtZCk7CiAgICAgICAgICAgIGlmICh4bWxtZXRh\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHBhdGguZ2V0KGZtZCwgeG1s\nbWV0YSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1ldGEgIT0gbnVsbCB8fCAh\ncGNPbmx5KSAKICAgICAgICAgICAgcGF0aC5nZXQoZm1kLCBhbGxvd051bGwp\nOwoKICAgICAgICByZXR1cm4gcGF0aDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybiBhIGNvbnN0YW50IGNvbnRhaW5pbmcgdGhlIHZhbHVlIG9mIHRo\nZSBnaXZlbiBzdGF0aWMgZmllbGQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBP\nYmplY3QgdHJhdmVyc2VTdGF0aWNGaWVsZChDbGFzczw/PiBjbHMsIFN0cmlu\nZyBmaWVsZCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBj\nbHMuZ2V0RmllbGQoZmllbGQpLmdldChudWxsKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBjb3VudCBub3QgbG9j\nYXRlIHRoZSBmaWVsZDogcmV0dXJuIG51bGwKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIGJvb2xl\nYW4gaXNNdWx0aVZhbHVlZFRyYXZlcnNhbEF0dGVtcHQoUGF0aCBwYXRoLCBT\ndHJpbmcgZmllbGQpIHsKICAgICAgICBpZiAocGF0aCA9PSBudWxsKSByZXR1\ncm4gZmFsc2U7CiAgICAgICAgaWYgKHBhdGgubGFzdCgpID09IG51bGwpIHJl\ndHVybiBmYWxzZTsKICAgICAgICBpZiAocGF0aC5sYXN0KCkuZ2V0RWxlbWVu\ndCgpID09IG51bGwpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAocGF0aC5s\nYXN0KCkuZ2V0RWxlbWVudCgpLmdldERlY2xhcmVkVHlwZU1ldGFEYXRhKCkg\nPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChwYXRoLmxhc3Qo\nKS5nZXRFbGVtZW50KCkuZ2V0RGVjbGFyZWRUeXBlTWV0YURhdGEoKS5nZXRG\naWVsZChmaWVsZCkgPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUg\ndHlwZSBvZiB0aGUgbmFtZWQgdmFyaWFibGUgaWYgaXQgaGFzIGJlZW4gZGVj\nbGFyZWQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBDbGFzczw/\nPiBnZXREZWNsYXJlZFZhcmlhYmxlVHlwZShTdHJpbmcgbmFtZSk7CgogICAg\nLyoqCiAgICAgKiBTZXQgdGhlIGltcGxpY2l0IHR5cGVzIG9mIHRoZSBnaXZl\nbiB2YWx1ZXMgYmFzZWQgb24gdGhlIGZhY3QgdGhhdAogICAgICogdGhleSdy\nZSB1c2VkIHRvZ2V0aGVyLCBhbmQgYmFzZWQgb24gdGhlIG9wZXJhdG9yIHR5\ncGUuCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldEltcGxpY2l0VHlw\nZXMoVmFsdWUgdmFsMSwgVmFsdWUgdmFsMiwKICAgICAgICBDbGFzczw/PiBl\neHBlY3RlZCkgewogICAgICAgIHNldEltcGxpY2l0VHlwZXModmFsMSwgdmFs\nMiwgZXhwZWN0ZWQsIHJlc29sdmVyKTsKICAgIH0KICAgIHByb3RlY3RlZCBz\ndGF0aWMgdm9pZCBzZXRJbXBsaWNpdFR5cGVzKFZhbHVlIHZhbDEsIFZhbHVl\nIHZhbDIsCiAgICAgICAgQ2xhc3M8Pz4gZXhwZWN0ZWQsIFJlc29sdmVyIHJl\nc29sdmVyKSB7CiAgICAgICAgQ2xhc3M8Pz4gYzEgPSB2YWwxLmdldFR5cGUo\nKTsKICAgICAgICBDbGFzczw/PiBjMiA9IHZhbDIuZ2V0VHlwZSgpOwogICAg\nICAgIGJvb2xlYW4gbzEgPSBjMSA9PSBUWVBFX09CSkVDVDsKICAgICAgICBi\nb29sZWFuIG8yID0gYzIgPT0gVFlQRV9PQkpFQ1Q7CgogICAgICAgIGlmIChv\nMSAmJiAhbzIpIHsKICAgICAgICAgICAgdmFsMS5zZXRJbXBsaWNpdFR5cGUo\nYzIpOwogICAgICAgICAgICBpZiAodmFsMS5nZXRNZXRhRGF0YSgpID09IG51\nbGwgJiYgIXZhbDEuaXNYUGF0aCgpKQogICAgICAgICAgICAgICAgdmFsMS5z\nZXRNZXRhRGF0YSh2YWwyLmdldE1ldGFEYXRhKCkpOwogICAgICAgIH0gZWxz\nZSBpZiAoIW8xICYmIG8yKSB7CiAgICAgICAgICAgIHZhbDIuc2V0SW1wbGlj\naXRUeXBlKGMxKTsKICAgICAgICAgICAgaWYgKHZhbDIuZ2V0TWV0YURhdGEo\nKSA9PSBudWxsICYmICF2YWwxLmlzWFBhdGgoKSkKICAgICAgICAgICAgICAg\nIHZhbDIuc2V0TWV0YURhdGEodmFsMS5nZXRNZXRhRGF0YSgpKTsKICAgICAg\nICB9IGVsc2UgaWYgKG8xICYmIG8yICYmIGV4cGVjdGVkICE9IG51bGwpIHsK\nICAgICAgICAgICAgLy8gd2UgbmV2ZXIgZXhwZWN0IGEgcGMgdHlwZSwgc28g\nZG9uJ3QgYm90aGVyIHdpdGggbWV0YWRhdGEKICAgICAgICAgICAgdmFsMS5z\nZXRJbXBsaWNpdFR5cGUoZXhwZWN0ZWQpOwogICAgICAgICAgICB2YWwyLnNl\ndEltcGxpY2l0VHlwZShleHBlY3RlZCk7CiAgICAgICAgfSBlbHNlIGlmIChp\nc051bWVyaWModmFsMS5nZXRUeXBlKCkpICE9IGlzTnVtZXJpYyh2YWwyLmdl\ndFR5cGUoKSkpIHsKICAgICAgICAgICAgaWYgKHJlc29sdmVyLmdldENvbmZp\nZ3VyYXRpb24oKS5nZXRDb21wYXRpYmlsaXR5SW5zdGFuY2UoKS4KICAgICAg\nICAgICAgICAgIGdldFF1b3RlZE51bWJlcnNJblF1ZXJpZXMoKSkKICAgICAg\nICAgICAgICAgIGNvbnZlcnRUeXBlc1F1b3RlZE51bWJlcnModmFsMSwgdmFs\nMik7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNvbnZlcnRU\neXBlcyh2YWwxLCB2YWwyKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQZXJmb3JtIGNvbnZlcnNpb25zIHRvIG1ha2UgdmFsdWVzIGNvbXBh\ndGlibGUuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjb252ZXJ0\nVHlwZXMoVmFsdWUgdmFsMSwgVmFsdWUgdmFsMikgewogICAgICAgIENsYXNz\nPD8+IHQxID0gdmFsMS5nZXRUeXBlKCk7CiAgICAgICAgQ2xhc3M8Pz4gdDIg\nPSB2YWwyLmdldFR5cGUoKTsKCiAgICAgICAgLy8gYWxsb3cgc3RyaW5nLXRv\nLWNoYXIgY29udmVyc2lvbnMKICAgICAgICBpZiAodDEgPT0gVFlQRV9TVFJJ\nTkcgJiYgKEZpbHRlcnMud3JhcCh0MikgPT0gVFlQRV9DSEFSX09CSgogICAg\nICAgICAgICAmJiAhKHZhbDIgaW5zdGFuY2VvZiBQYXRoKSkpIHsKICAgICAg\nICAgICAgdmFsMi5zZXRJbXBsaWNpdFR5cGUoU3RyaW5nLmNsYXNzKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodDIgPT0g\nVFlQRV9TVFJJTkcgJiYgKEZpbHRlcnMud3JhcCh0MSkgPT0gVFlQRV9DSEFS\nX09CSikKICAgICAgICAgICAgJiYgISh2YWwxIGluc3RhbmNlb2YgUGF0aCkp\nIHsKICAgICAgICAgICAgdmFsMS5zZXRJbXBsaWNpdFR5cGUoU3RyaW5nLmNs\nYXNzKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gaWYgdGhlIG5vbi1udW1lcmljIHNpZGUgaXMgYSBzdHJpbmcgb2YgbGVu\nZ3RoIDEsIGNhc3QgaXQKICAgICAgICAvLyB0byBhIGNoYXJhY3RlcgogICAg\nICAgIGlmICh0MSA9PSBUWVBFX1NUUklORyAmJiB2YWwxIGluc3RhbmNlb2Yg\nTGl0ZXJhbAogICAgICAgICAgICAmJiAoKFN0cmluZykgKChMaXRlcmFsKSB2\nYWwxKS5nZXRWYWx1ZSgpKS5sZW5ndGgoKSA9PSAxKSB7CiAgICAgICAgICAg\nIHZhbDEuc2V0SW1wbGljaXRUeXBlKENoYXJhY3Rlci5jbGFzcyk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHQyID09IFRZ\nUEVfU1RSSU5HICYmIHZhbDIgaW5zdGFuY2VvZiBMaXRlcmFsCiAgICAgICAg\nICAgICYmICgoU3RyaW5nKSAoKExpdGVyYWwpIHZhbDIpLmdldFZhbHVlKCkp\nLmxlbmd0aCgpID09IDEpIHsKICAgICAgICAgICAgdmFsMi5zZXRJbXBsaWNp\ndFR5cGUoQ2hhcmFjdGVyLmNsYXNzKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gZXJyb3IKICAgICAgICBTdHJpbmcgbGVm\ndDsKICAgICAgICBTdHJpbmcgcmlnaHQ7CiAgICAgICAgaWYgKHZhbDEgaW5z\ndGFuY2VvZiBQYXRoICYmICgoUGF0aCkgdmFsMSkubGFzdCgpICE9IG51bGwp\nCiAgICAgICAgICAgIGxlZnQgPSBfbG9jLmdldCgibm9uLW51bWVyaWMtcGF0\naCIsICgoUGF0aCkgdmFsMSkubGFzdCgpLgogICAgICAgICAgICAgICAgZ2V0\nTmFtZSgpLCB0MS5nZXROYW1lKCkpLmdldE1lc3NhZ2UoKTsKICAgICAgICBl\nbHNlCiAgICAgICAgICAgIGxlZnQgPSBfbG9jLmdldCgibm9uLW51bWVyaWMt\ndmFsdWUiLCB0MS5nZXROYW1lKCkpLmdldE1lc3NhZ2UoKTsKICAgICAgICBp\nZiAodmFsMiBpbnN0YW5jZW9mIFBhdGggJiYgKChQYXRoKSB2YWwyKS5sYXN0\nKCkgIT0gbnVsbCkKICAgICAgICAgICAgcmlnaHQgPSBfbG9jLmdldCgibm9u\nLW51bWVyaWMtcGF0aCIsICgoUGF0aCkgdmFsMikubGFzdCgpLgogICAgICAg\nICAgICAgICAgZ2V0TmFtZSgpLCB0Mi5nZXROYW1lKCkpLmdldE1lc3NhZ2Uo\nKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJpZ2h0ID0gX2xvYy5nZXQo\nIm5vbi1udW1lcmljLXZhbHVlIiwgdDIuZ2V0TmFtZSgpKS5nZXRNZXNzYWdl\nKCk7CiAgICAgICAgdGhyb3cgbmV3IFVzZXJFeGNlcHRpb24oX2xvYy5nZXQo\nIm5vbi1udW1lcmljLWNvbXBhcmlzb24iLAogICAgICAgICAgICBsZWZ0LCBy\naWdodCkpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBjb252ZXJz\naW9ucyB0byBtYWtlIHZhbHVlcyBjb21wYXRpYmxlLgogICAgICovCiAgICBw\ndWJsaWMgc3RhdGljIHZvaWQgY29udmVydFR5cGVzUXVvdGVkTnVtYmVycyhW\nYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyKSB7CiAgICAgICAgQ2xhc3M8Pz4gdDEg\nPSB2YWwxLmdldFR5cGUoKTsKICAgICAgICBDbGFzczw/PiB0MiA9IHZhbDIu\nZ2V0VHlwZSgpOwoKICAgICAgICAvLyBpZiB3ZSdyZSBjb21wYXJpbmcgdG8g\nYSBzaW5nbGUtcXVvdGVkIHN0cmluZywgY29udmVydAogICAgICAgIC8vIHRo\nZSB2YWx1ZSBhY2NvcmRpbmcgdG8gdGhlIDMuMSBydWxlcy4KICAgICAgICBp\nZiAodDEgPT0gVFlQRV9TVFJJTkcgJiYgdmFsMSBpbnN0YW5jZW9mIExpdGVy\nYWwKICAgICAgICAgICAgJiYgKChMaXRlcmFsKSB2YWwxKS5nZXRQYXJzZVR5\ncGUoKSA9PSBMaXRlcmFsLlRZUEVfU1FfU1RSSU5HKSB7CiAgICAgICAgICAg\nIFN0cmluZyBzID0gKFN0cmluZykgKChMaXRlcmFsKSB2YWwxKS5nZXRWYWx1\nZSgpOwogICAgICAgICAgICBpZiAocy5sZW5ndGgoKSA+IDEpIHsKICAgICAg\nICAgICAgICAgICgoTGl0ZXJhbCkgdmFsMSkuc2V0VmFsdWUocy5zdWJzdHJp\nbmcoMCwgMSkpOwogICAgICAgICAgICAgICAgdmFsMS5zZXRJbXBsaWNpdFR5\ncGUoQ2hhcmFjdGVyLlRZUEUpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGlmICh0MiA9PSBUWVBFX1NUUklORyAmJiB2YWwyIGluc3RhbmNl\nb2YgTGl0ZXJhbAogICAgICAgICAgICAmJiAoKExpdGVyYWwpIHZhbDIpLmdl\ndFBhcnNlVHlwZSgpID09IExpdGVyYWwuVFlQRV9TUV9TVFJJTkcpIHsKICAg\nICAgICAgICAgU3RyaW5nIHMgPSAoU3RyaW5nKSAoKExpdGVyYWwpIHZhbDIp\nLmdldFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzLmxlbmd0aCgpID4gMSkg\newogICAgICAgICAgICAgICAgKChMaXRlcmFsKSB2YWwyKS5zZXRWYWx1ZShz\nLnN1YnN0cmluZygwLCAxKSk7CiAgICAgICAgICAgICAgICB2YWwyLnNldElt\ncGxpY2l0VHlwZShDaGFyYWN0ZXIuVFlQRSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHdlJ3JlIGNvbXBhcmluZyB0byBhIGRv\ndWJsZS1xdW90ZWQgc3RyaW5nLCBjb252ZXJ0IHRoZQogICAgICAgIC8vIHZh\nbHVlIGRpcmVjdGx5IHRvIGEgbnVtYmVyCiAgICAgICAgaWYgKHQxID09IFRZ\nUEVfU1RSSU5HICYmIHZhbDEgaW5zdGFuY2VvZiBMaXRlcmFsCiAgICAgICAg\nICAgICYmICgoTGl0ZXJhbCkgdmFsMSkuZ2V0UGFyc2VUeXBlKCkgPT0gTGl0\nZXJhbC5UWVBFX1NUUklORykgewogICAgICAgICAgICBTdHJpbmcgcyA9IChT\ndHJpbmcpICgoTGl0ZXJhbCkgdmFsMSkuZ2V0VmFsdWUoKTsKICAgICAgICAg\nICAgKChMaXRlcmFsKSB2YWwxKS5zZXRWYWx1ZShTdHJpbmdzLnBhcnNlKHMs\nIEZpbHRlcnMud3JhcCh0MikpKTsKICAgICAgICAgICAgdmFsMS5zZXRJbXBs\naWNpdFR5cGUodDIpOwogICAgICAgIH0KICAgICAgICBpZiAodDIgPT0gVFlQ\nRV9TVFJJTkcgJiYgdmFsMiBpbnN0YW5jZW9mIExpdGVyYWwKICAgICAgICAg\nICAgJiYgKChMaXRlcmFsKSB2YWwyKS5nZXRQYXJzZVR5cGUoKSA9PSBMaXRl\ncmFsLlRZUEVfU1RSSU5HKSB7CiAgICAgICAgICAgIFN0cmluZyBzID0gKFN0\ncmluZykgKChMaXRlcmFsKSB2YWwyKS5nZXRWYWx1ZSgpOwogICAgICAgICAg\nICAoKExpdGVyYWwpIHZhbDIpLnNldFZhbHVlKFN0cmluZ3MucGFyc2Uocywg\nRmlsdGVycy53cmFwKHQxKSkpOwogICAgICAgICAgICB2YWwyLnNldEltcGxp\nY2l0VHlwZSh0MSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmV0dXJuIHRydWUgaWYgZ2l2ZW4gY2xhc3MgY2FuIGJlIHVzZWQgYXMgYSBu\ndW1iZXIuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc051\nbWVyaWMoQ2xhc3M8Pz4gdHlwZSkgewogICAgICAgIHR5cGUgPSBGaWx0ZXJz\nLndyYXAodHlwZSk7CiAgICAgICAgcmV0dXJuIE51bWJlci5jbGFzcy5pc0Fz\nc2lnbmFibGVGcm9tKHR5cGUpCiAgICAgICAgICAgIHx8IHR5cGUgPT0gQ2hh\ncmFjdGVyLlRZUEUgfHwgdHlwZSA9PSBUWVBFX0NIQVJfT0JKOwogICAgfQoK\nICAgIC8qKgogICAgICogU2V0IHRoZSBpbXBsaWNpdCB0eXBlcyBvZiB0aGUg\nZ2l2ZW4gdmFsdWVzIGJhc2VkIG9uIHRoZSBmYWN0IHRoYXQKICAgICAqIHRo\nZSBmaXJzdCBpcyBzdXBwb3NlZCB0byBjb250YWluIHRoZSBzZWNvbmQuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHNldEltcGxpY2l0Q29udGFpbnNU\neXBlcyhWYWx1ZSB2YWwxLCBWYWx1ZSB2YWwyLCBpbnQgb3ApIHsKICAgICAg\nICBpZiAodmFsMS5nZXRUeXBlKCkgPT0gVFlQRV9PQkpFQ1QpIHsKICAgICAg\nICAgICAgaWYgKG9wID09IENPTlRBSU5TX1RZUEVfRUxFTUVOVCkKICAgICAg\nICAgICAgICAgIHZhbDEuc2V0SW1wbGljaXRUeXBlKENvbGxlY3Rpb24uY2xh\nc3MpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB2YWwxLnNl\ndEltcGxpY2l0VHlwZShNYXAuY2xhc3MpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKHZhbDIuZ2V0VHlwZSgpID09IFRZUEVfT0JKRUNUICYmIHZhbDEgaW5z\ndGFuY2VvZiBQYXRoKSB7CiAgICAgICAgICAgIEZpZWxkTWV0YURhdGEgZm1k\nID0gKChQYXRoKSB2YWwxKS5sYXN0KCk7CiAgICAgICAgICAgIENsYXNzTWV0\nYURhdGEgbWV0YTsKICAgICAgICAgICAgaWYgKGZtZCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAob3AgPT0gQ09OVEFJTlNfVFlQRV9FTEVNRU5U\nIHx8IG9wID09IENPTlRBSU5TX1RZUEVfVkFMVUUpIHsKICAgICAgICAgICAg\nICAgICAgICB2YWwyLnNldEltcGxpY2l0VHlwZShmbWQuZ2V0RWxlbWVudCgp\nLmdldERlY2xhcmVkVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICBtZXRh\nID0gZm1kLmdldEVsZW1lbnQoKS5nZXREZWNsYXJlZFR5cGVNZXRhRGF0YSgp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXRhICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgdmFsMi5zZXRNZXRhRGF0YShtZXRhKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgYWRkQWNjZXNzUGF0aChtZXRhKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIHZhbDIuc2V0SW1wbGljaXRUeXBlKGZt\nZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgbWV0YSA9IGZtZC5nZXRLZXkoKS5nZXREZWNsYXJlZFR5cGVNZXRh\nRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXRhICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsMi5zZXRNZXRhRGF0YSht\nZXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkQWNjZXNzUGF0aCht\nZXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZXQgdGhlIGltcGxpY2l0IHR5cGUgb2YgdGhlIGdpdmVuIHZhbHVlIHRv\nIHRoZSBnaXZlbiBjbGFzcy4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRp\nYyB2b2lkIHNldEltcGxpY2l0VHlwZShWYWx1ZSB2YWwsIENsYXNzPD8+IGV4\ncGVjdGVkKSB7CiAgICAgICAgLy8gd2UgbmV2ZXIgZXhwZWN0IGEgcGMgdHlw\nZSwgc28gbm8gbmVlZCB0byB3b3JyeSBhYm91dCBtZXRhZGF0YQogICAgICAg\nIGlmICh2YWwuZ2V0VHlwZSgpID09IFRZUEVfT0JKRUNUKQogICAgICAgICAg\nICB2YWwuc2V0SW1wbGljaXRUeXBlKGV4cGVjdGVkKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFVzZWQgZm9yIG9idGFpbmluZyB0aGUge0BsaW5rIExvY2Fs\naXplcn0gdG8gdXNlIGZvciB0cmFuc2xhdGluZwogICAgICogZXJyb3IgbWVz\nc2FnZXMuCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBMb2NhbGl6\nZXIgZ2V0TG9jYWxpemVyKCk7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRo\nZSBjdXJyZW50IHN0cmluZyBiZWluZyBwYXJzZWQ7IHVzZWQgZm9yIGVycm9y\nIG1lc3NhZ2VzLgoJICovCglwcm90ZWN0ZWQgYWJzdHJhY3QgU3RyaW5nIGN1\ncnJlbnRRdWVyeSAoKTsKCiAgICAvKioKICAgICAqIFJlZ2lzdGVyIHRoZSBz\nY2hlbWEgYWxpYXMgdG8gdGhlIGN1cnJlbnQgSlBRTCBxdWVyeSBjb250ZXh0\nLgogICAgICogQHBhcmFtIGFsaWFzCiAgICAgKiBAcGFyYW0gbWV0YQogICAg\nICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCBhZGRTY2hlbWFUb0Nv\nbnRleHQoU3RyaW5nIGFsaWFzLAogICAgICAgIENsYXNzTWV0YURhdGEgbWV0\nYSk7CgogICAgLyoqCiAgICAgKiBSZWdpc3RlciB0aGUgdmFyaWFibGUgYXNz\nb2NpYXRlZCB3aXRoIHRoZSBzY2hlbWEgYWxpYXMgKGlkKSB0bwogICAgICog\ndGhlIGN1cnJlbnQgSlBRTCBxdWVyeSBjb250ZXh0LgogICAgICogQHBhcmFt\nIGlkCiAgICAgKiBAcGFyYW0gdmFyCiAgICAgKi8KICAgIHByb3RlY3RlZCBh\nYnN0cmFjdCB2b2lkIGFkZFZhcmlhYmxlVG9Db250ZXh0KFN0cmluZyBpZCwg\nVmFsdWUgdmFyKTsKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHZhcmlh\nYmxlIGFzc29jaWF0ZWQgd2l0aCB0aGUgc2NoZW1hIGFsaWFzIChpZCkuCiAg\nICAgKiBAcGFyYW0gaWQKICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHJv\ndGVjdGVkIGFic3RyYWN0IFZhbHVlIGdldFZhcmlhYmxlKFN0cmluZyBpZCk7\nCn0KCg==\n","encoding":"base64"}

